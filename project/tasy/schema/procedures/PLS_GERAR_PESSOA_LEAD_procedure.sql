-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gerar_pessoa_lead ( nr_seq_solicitacao_p bigint, nm_usuario_p text, nm_pessoa_fisica_p text, cd_pessoa_fisica_p INOUT text) AS $body$
DECLARE


cd_pessoa_fisica_w	pessoa_fisica.cd_pessoa_fisica%type;
nm_pessoa_fisica_w	pls_solicitacao_comercial.nm_pessoa_fisica%type;
cd_cep_w		pls_solicitacao_comercial.cd_cep%type;
ds_endereco_w		pls_solicitacao_comercial.ds_endereco%type;
nr_endereco_w		pls_solicitacao_comercial.nr_endereco%type;
ds_bairro_w		pls_solicitacao_comercial.ds_bairro%type;
ds_complemento_w	pls_solicitacao_comercial.ds_complemento%type;
cd_municipio_ibge_w	pls_solicitacao_comercial.cd_municipio_ibge%type;
ds_uf_w			pls_solicitacao_comercial.sg_uf_municipio%type;
dt_nascimento_w		pls_solicitacao_comercial.dt_nascimento%type;
nr_ddi_w		pls_solicitacao_comercial.nr_ddi%type;
nr_ddd_w		pls_solicitacao_comercial.nr_ddd%type;
nr_telefone_w		pls_solicitacao_comercial.nr_telefone%type;
ds_email_w		pls_solicitacao_comercial.ds_email%type;
nr_celular_w		pls_solicitacao_comercial.nr_celular%type;
nr_cpf_w		pls_solicitacao_comercial.nr_cpf%type;
cd_nacionalidade_w	pls_solicitacao_comercial.cd_nacionalidade%type;


BEGIN

select	nextval('pessoa_fisica_seq')
into STRICT	cd_pessoa_fisica_w
;

select	substr(nm_pessoa_fisica,1,60),
	cd_cep,
	ds_endereco,
	nr_endereco,
	ds_bairro,
	ds_complemento,
	cd_municipio_ibge,
	sg_uf_municipio,
	dt_nascimento,
	nr_ddi,
	nr_ddd,
	nr_telefone,
	ds_email,
	nr_celular,
	nr_cpf,
	cd_nacionalidade
into STRICT	nm_pessoa_fisica_w,
	cd_cep_w,
	ds_endereco_w,
	nr_endereco_w,
	ds_bairro_w,
	ds_complemento_w,
	cd_municipio_ibge_w,
	ds_uf_w,
	dt_nascimento_w,
	nr_ddi_w,
	nr_ddd_w,
	nr_telefone_w,
	ds_email_w,
	nr_celular_w,
	nr_cpf_w,
	cd_nacionalidade_w
from	pls_solicitacao_comercial
where	nr_sequencia	= nr_seq_solicitacao_p;

if (length(nm_pessoa_fisica_w) <= 5) then
	nm_pessoa_fisica_w	:= nm_pessoa_fisica_w || nm_pessoa_fisica_w;
end if;

insert	into	pessoa_fisica(	cd_pessoa_fisica, nm_pessoa_fisica, cd_nacionalidade,
		dt_nascimento, nr_cpf, nr_telefone_celular,
		ie_tipo_pessoa, dt_atualizacao, nm_usuario)
	values (	cd_pessoa_fisica_w, nm_pessoa_fisica_w, cd_nacionalidade_w,
		dt_nascimento_w, nr_cpf_w, nr_celular_w,
		2, clock_timestamp(), nm_usuario_p);

insert	into	compl_pessoa_fisica(	nr_sequencia, cd_pessoa_fisica, cd_cep,
		ds_endereco, nr_endereco, ds_complemento,
		ds_bairro, cd_municipio_ibge, sg_estado,
		nr_ddi_telefone, nr_ddd_telefone, nr_telefone,
		ds_email, ie_tipo_complemento, dt_atualizacao,
		nm_usuario)
	values (	1, cd_pessoa_fisica_w, cd_cep_w,
		ds_endereco_w, nr_endereco_w, ds_complemento_w,
		ds_bairro_w, cd_municipio_ibge_w, ds_uf_w,
		nr_ddi_w, nr_ddd_w, nr_telefone_w,
		ds_email_w, 1, clock_timestamp(),
		nm_usuario_p);

cd_pessoa_fisica_p := cd_pessoa_fisica_w;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_pessoa_lead ( nr_seq_solicitacao_p bigint, nm_usuario_p text, nm_pessoa_fisica_p text, cd_pessoa_fisica_p INOUT text) FROM PUBLIC;

