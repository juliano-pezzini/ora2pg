-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_itens_opme ( nr_cot_compra_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
cd_material_w		integer;
qt_material_w		double precision;
vl_preco_total_w		double precision;
cd_cgc_fornecedor_w	varchar(14);
vl_unitario_material_w	double precision;
nr_seq_agenda_pac_w	bigint;

C01 CURSOR FOR 
	SELECT a.cd_cgc_fornecedor,  
		a.cd_material, 
		a.qt_material, 
		a.vl_unitario_material, 
		a.nr_seq_agenda_pac 
	from 	cot_compra_resumo_v a 
	where 	a.nr_cot_compra   = nr_cot_compra_p;


BEGIN 
	 
open C01;
loop 
fetch C01 into	 
	cd_cgc_fornecedor_w, 
	cd_material_w, 
	qt_material_w, 
	vl_unitario_material_w, 
	nr_seq_agenda_pac_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin 
	 
	vl_preco_total_w := (vl_unitario_material_w * qt_material_w);
	 
	update	agenda_pac_opme 
	set	vl_unitario_item = vl_unitario_material_w, 
		vl_desconto 	 = vl_preco_total_w, 
		cd_cgc		 = cd_cgc_fornecedor_w 
	where	nr_seq_agenda 	 = nr_seq_agenda_pac_w;
		 
	end;
end loop;
close C01;	
	 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_itens_opme ( nr_cot_compra_p bigint, nm_usuario_p text) FROM PUBLIC;

