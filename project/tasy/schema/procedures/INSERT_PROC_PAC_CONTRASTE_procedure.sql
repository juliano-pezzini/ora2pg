-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_proc_pac_contraste ( nr_seq_proc_pac_contr_p proc_paciente_contraste.nr_sequencia%type ) AS $body$
DECLARE


proc_pac_w              procedimento_paciente%ROWTYPE;
proc_pac_contr_w        proc_paciente_contraste%ROWTYPE;
nr_seq_proc_interno_w   contraste_proc_int_med.nr_seq_proc_interno%TYPE;


BEGIN
    -- buscamos a linha para pegar dados sobre o procedimento_paciente e o proc_interno
    SELECT *
    INTO STRICT proc_pac_contr_w
    FROM proc_paciente_contraste
    WHERE nr_sequencia = nr_seq_proc_pac_contr_p  LIMIT 1;

    -- buscamos os dados do procedimento_paciente associado
    SELECT *
    INTO STRICT proc_pac_w
    FROM procedimento_paciente
    WHERE nr_sequencia = proc_pac_contr_w.nr_seq_propaci  LIMIT 1;

    -- pegamos o nr_sequencia do procedimento_interno
    SELECT MAX(nr_seq_proc_interno)
    INTO STRICT nr_seq_proc_interno_w
    FROM contraste_proc_int_med
    WHERE nr_sequencia = proc_pac_contr_w.nr_seq_cont_proc_int_med;

    insert into procedimento_paciente(
			nr_sequencia,
			nr_atendimento,
			dt_entrada_unidade,
			cd_procedimento,
			dt_procedimento,
			cd_convenio,
			cd_categoria,
			nr_doc_convenio,
			ie_tipo_guia,
			cd_senha,
			ie_auditoria,
			ie_emite_conta,
			cd_cgc_prestador,
			ie_origem_proced,
			nr_seq_exame,
			nr_seq_proc_interno,
			qt_procedimento,
			cd_setor_atendimento,
			nr_seq_atepacu,
			nr_seq_cor_exec,
			ie_funcao_medico,
			ie_proc_princ_atend,
			ie_video,
			ie_valor_informado,
			ie_guia_informada,
			cd_situacao_glosa,
			nm_usuario_original,
			ds_observacao,
			dt_atualizacao,
			nm_usuario,
			cd_pessoa_fisica,
			cd_medico_executor,
			nr_interno_conta)
		values (
			nextval('procedimento_paciente_seq'),
			proc_pac_w.nr_atendimento,
			proc_pac_w.dt_entrada_unidade,
			proc_pac_w.cd_procedimento,
			proc_pac_w.dt_procedimento,
			proc_pac_w.cd_convenio,
			proc_pac_w.cd_categoria,
			proc_pac_w.nr_doc_convenio,
			proc_pac_w.ie_tipo_guia,
			proc_pac_w.cd_senha,
			proc_pac_w.ie_auditoria,
			proc_pac_w.ie_emite_conta,
			proc_pac_w.cd_cgc_prestador,
			proc_pac_w.ie_origem_proced,
			proc_pac_w.nr_seq_exame,
			nr_seq_proc_interno_w,
			proc_pac_w.qt_procedimento,
			proc_pac_w.cd_setor_atendimento,
			proc_pac_w.nr_seq_atepacu,
			proc_pac_w.nr_seq_cor_exec,
			proc_pac_w.ie_funcao_medico,
			proc_pac_w.ie_proc_princ_atend,
			proc_pac_w.ie_video,
			proc_pac_w.ie_valor_informado,
			proc_pac_w.ie_guia_informada,
			proc_pac_w.cd_situacao_glosa,
			proc_pac_w.nm_usuario_original,
			proc_pac_w.ds_observacao,
			clock_timestamp(),
			proc_pac_contr_w.nm_usuario,
			proc_pac_w.cd_pessoa_fisica,
			proc_pac_w.cd_medico_executor,
			proc_pac_w.nr_interno_conta);
    commit;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_proc_pac_contraste ( nr_seq_proc_pac_contr_p proc_paciente_contraste.nr_sequencia%type ) FROM PUBLIC;

