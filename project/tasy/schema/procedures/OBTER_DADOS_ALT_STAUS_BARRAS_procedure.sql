-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_dados_alt_staus_barras ( nr_controle_p bigint, nr_seq_etiqueta_p bigint, ie_status_atend_p bigint, ie_mostra_nome_pessoa_p text, lista_status_seq_p text, ie_status_prescr_p INOUT bigint, nr_prescricao_p INOUT bigint, nr_atendimento_p INOUT bigint, nm_pessoa_fisica_p INOUT text, ds_status_p INOUT text, ie_status_sem_amostra_p INOUT text ) AS $body$
DECLARE


    nr_prescricao_w           bigint;
    nr_atendimento_w          bigint;
    ie_status_prescr_w        bigint;
    ds_status_w               varchar(255);
    nm_pessoa_fisica_w        varchar(255);
    ie_status_sem_amostra_w   varchar(1);

BEGIN

    ie_status_prescr_w := obter_status_barras_prescr(
        nr_controle_p        => nr_controle_p,
        nr_seq_etiqueta_p    => nr_seq_etiqueta_p,
        cd_unidade_fleury_p  => NULL,
        cd_estabelecimento_p => NULL
    );

    SELECT nr_prescricao
    INTO STRICT nr_prescricao_w
    FROM prescr_medica
    WHERE nr_controle = nr_controle_p;

    IF ( nr_prescricao_w > 0 ) THEN
        SELECT nr_atendimento
        INTO STRICT nr_atendimento_w
        FROM prescr_medica
        WHERE nr_prescricao = nr_prescricao_w;

        nm_pessoa_fisica_w := obter_nome_prescricao(nr_prescricao_w, ie_mostra_nome_pessoa_p);
    END IF;

    SELECT substr(obter_valor_dominio_status_lis(ie_status_atend_p), 1, 255)
    INTO STRICT ds_status_w
;

    IF (lista_status_seq_p IS NOT NULL AND lista_status_seq_p::text <> '') THEN
        ie_status_sem_amostra_w := obter_se_contido(ie_status_atend_p, lista_status_seq_p);
    ELSE
        ie_status_sem_amostra_w := 'N';
    END IF;

    ie_status_prescr_p      := ie_status_prescr_w;
    nr_prescricao_p         := nr_prescricao_w;
    nr_atendimento_p        := nr_atendimento_w;
    nm_pessoa_fisica_p      := nm_pessoa_fisica_w;
    ds_status_p             := ds_status_w;
    ie_status_sem_amostra_p := ie_status_sem_amostra_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_dados_alt_staus_barras ( nr_controle_p bigint, nr_seq_etiqueta_p bigint, ie_status_atend_p bigint, ie_mostra_nome_pessoa_p text, lista_status_seq_p text, ie_status_prescr_p INOUT bigint, nr_prescricao_p INOUT bigint, nr_atendimento_p INOUT bigint, nm_pessoa_fisica_p INOUT text, ds_status_p INOUT text, ie_status_sem_amostra_p INOUT text ) FROM PUBLIC;

