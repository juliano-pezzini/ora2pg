-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_atestado_receita () AS $body$
DECLARE

 
qt_existe_w	bigint;


BEGIN 
 
delete	FROM atestado_paciente 
where	coalesce(cd_pessoa_fisica::text, '') = '' 
and	coalesce(nr_atendimento::text, '') = '';
 
update	atestado_paciente 
set	cd_pessoa_fisica = Obter_Pessoa_Atendimento(nr_atendimento,'C') 
where	(nr_atendimento IS NOT NULL AND nr_atendimento::text <> '') 
and	coalesce(cd_pessoa_fisica::text, '') = '';
 
select	count(*) 
into STRICT	qt_existe_w 
from	atestado_paciente 
where	coalesce(cd_pessoa_fisica::text, '') = '';
 
if (qt_existe_w = 0) then 
	CALL Exec_sql_Dinamico('Edilson','alter table atestado_paciente modify cd_pessoa_fisica varchar2(10) not null');
end if;
	 
 
delete	FROM med_receita 
where	coalesce(cd_pessoa_fisica::text, '') = '' 
and	coalesce(nr_atendimento_hosp::text, '') = '' 
and	coalesce(nr_seq_cliente::text, '') = '';
 
update	med_receita 
set	cd_pessoa_fisica = Obter_Pessoa_Atendimento(nr_atendimento_hosp,'C') 
where	(nr_atendimento_hosp IS NOT NULL AND nr_atendimento_hosp::text <> '') 
and	coalesce(cd_pessoa_fisica::text, '') = '';
 
update	med_receita a 
set	a.cd_pessoa_fisica = (	SELECT	b.cd_pessoa_fisica 
				from	med_cliente b 
				where	b.nr_sequencia = a.nr_seq_cliente) 
where	coalesce(a.nr_atendimento_hosp::text, '') = '' 
and	(a.nr_seq_cliente IS NOT NULL AND a.nr_seq_cliente::text <> '') 
and	coalesce(a.cd_pessoa_fisica::text, '') = '';
 
select	count(*) 
into STRICT	qt_existe_w 
from	med_receita 
where	coalesce(cd_pessoa_fisica::text, '') = '';
 
if (qt_existe_w = 0) then 
	CALL Exec_sql_Dinamico('Edilson','alter table med_receita modify cd_pessoa_fisica varchar2(10) not null');
end if;
 
commit;
 
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_atestado_receita () FROM PUBLIC;

