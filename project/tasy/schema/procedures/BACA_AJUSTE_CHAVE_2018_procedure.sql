-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_ajuste_chave_2018 () AS $body$
DECLARE

 
rowid_w		oid;
nr_sequencia_w	bigint;
nr_reg_w		bigint;

retorno_w		bigint;

C01 CURSOR FOR 
SELECT oid 
from 	Unidade_atendimento 
where coalesce(nr_seq_interno::text, '') = '';

C02 CURSOR FOR 
SELECT oid 
from 	Atend_paciente_unidade 
where coalesce(nr_seq_interno::text, '') = '';

C03 CURSOR FOR 
SELECT oid 
from 	Atend_categoria_convenio 
where coalesce(nr_seq_interno::text, '') = '';

 
 

BEGIN 
 
OPEN C01;
LOOP 
FETCH C01 into	rowid_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin 
	select nextval('unidade_atendimento_seq') 
	into STRICT nr_sequencia_w 
	;
	update unidade_atendimento 
	set	nr_seq_interno	= nr_sequencia_w 
	where rowid = rowid_w;
	end;
END LOOP;
close c01;
 
commit;
 
/* Atend Paciente_unidade */
 
 
nr_reg_w	:= 0;
lock table atend_paciente_unidade IN EXCLUSIVE MODE NOWAIT;
lock table atendimento_paciente IN EXCLUSIVE MODE NOWAIT;
retorno_w := executar_sql_dinamico('alter trigger atend_paciente_unidade_update disable', retorno_w);
 
OPEN C02;
LOOP 
FETCH C02 into	rowid_w;
EXIT WHEN NOT FOUND; /* apply on C02 */
	begin 
	nr_reg_w	:= nr_reg_w + 1;
	select nextval('atend_paciente_unidade_seq') 
	into STRICT nr_sequencia_w 
	;
	update atend_paciente_unidade 
	set	nr_seq_interno	= nr_sequencia_w 
	where rowid = rowid_w;
	if (nr_reg_w > 5000) then 
		exit;
	end if;
	end;
END LOOP;
close c02;
commit;
retorno_w := executar_sql_dinamico('alter trigger atend_paciente_unidade_update enable', retorno_w);
 
 
/* Atend Categoria Convenio */
 
 
nr_reg_w	:= 0;
 
lock table atend_categoria_convenio IN EXCLUSIVE MODE NOWAIT;
lock table atendimento_paciente IN EXCLUSIVE MODE NOWAIT;
retorno_w := executar_sql_dinamico('alter trigger atend_categ_convenio_update disable', retorno_w);
 
OPEN C03;
LOOP 
FETCH C03 into	rowid_w;
EXIT WHEN NOT FOUND; /* apply on C03 */
	begin 
	nr_reg_w	:= nr_reg_w + 1;
	select nextval('atend_categoria_convenio_seq') 
	into STRICT nr_sequencia_w 
	;
	update Atend_categoria_convenio 
	set	nr_seq_interno	= nr_sequencia_w 
	where rowid = rowid_w;
	if (nr_reg_w > 5000) then 
		exit;
	end if;
	end;
END LOOP;
close c03;
commit;
 
retorno_w := executar_sql_dinamico('alter trigger atend_categ_convenio_update enable', retorno_w);
 
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_ajuste_chave_2018 () FROM PUBLIC;

