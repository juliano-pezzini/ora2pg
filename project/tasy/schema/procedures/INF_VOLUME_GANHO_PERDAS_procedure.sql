-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inf_volume_ganho_perdas ( nr_seq_tipo_p bigint, dt_medida_p timestamp, nm_usuario_p text, hint_p INOUT text, qt_perda_ganho_p INOUT bigint, ds_informacao_p INOUT text, ie_obrigatorio_p INOUT text, nr_seq_inf_tipo_p INOUT bigint, nr_sequencia_p INOUT bigint, ie_inf_adic_p INOUT text, hora_p INOUT text, ie_desabilitar_p INOUT text ) AS $body$
DECLARE



hint_w			varchar(1);
hora_w			varchar(20);
qt_perda_ganho_w	bigint;
ds_informacao_w		varchar(255);
ie_obrigatorio_w	varchar(1);
nr_seq_inf_tipo_w	bigint;
nr_sequencia_w		bigint;
ie_inf_adic_w		varchar(1) := 'N';
ie_desabilitar_w	varchar(1) := 'N';


BEGIN

select 	max(coalesce(ie_volume_ocorrencia,'V')), max(coalesce(ie_desabilitar_campos,'N'))
into STRICT	hint_w, ie_desabilitar_w
from 	tipo_perda_ganho
where 	nr_sequencia = nr_seq_tipo_p;

select 	count(*)
into STRICT	qt_perda_ganho_w
from 	perda_ganho_inf_adic_tipo
where 	nr_seq_tipo = nr_seq_tipo_p;

/*
select 	to_char(round(dt_medida_p,'hh24'),'hh24')
into	hora_w
from 	dual;*/
select	max(to_char(Obter_Hora_Apap_GP(dt_medida_p)))
into STRICT	hora_w
;

begin
	select	b.nr_sequencia,
		b.ds_informacao,
		a.ie_obrigatorio,
		a.nr_sequencia
	into STRICT
		nr_sequencia_w,
		ds_informacao_w,
		ie_obrigatorio_w,
		nr_seq_inf_tipo_w
	from	perda_ganho_inf_adic_tipo a,
		perda_ganho_inf_adic b
	where	a.nr_seq_inf_adic = b.nr_sequencia
	and	b.ie_situacao = 'A'
	and	a.nr_seq_tipo = nr_seq_tipo_p
	order by	coalesce(a.nr_seq_apresentacao, b.nr_seq_apresentacao), b.ds_informacao;
	ie_inf_adic_w := 'S';
exception
	when others then
	ie_inf_adic_w := 'N';
end;

hint_p 			:= hint_w;
hora_p 			:= hora_w;
qt_perda_ganho_p 	:= qt_perda_ganho_w;
ds_informacao_p 	:= ds_informacao_w;
ie_obrigatorio_p 	:= ie_obrigatorio_w;
nr_seq_inf_tipo_p 	:= nr_seq_inf_tipo_w;
nr_sequencia_p 		:= nr_sequencia_w;
ie_inf_adic_p		:= ie_inf_adic_w;
ie_desabilitar_p	:= ie_desabilitar_w;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inf_volume_ganho_perdas ( nr_seq_tipo_p bigint, dt_medida_p timestamp, nm_usuario_p text, hint_p INOUT text, qt_perda_ganho_p INOUT bigint, ds_informacao_p INOUT text, ie_obrigatorio_p INOUT text, nr_seq_inf_tipo_p INOUT bigint, nr_sequencia_p INOUT bigint, ie_inf_adic_p INOUT text, hora_p INOUT text, ie_desabilitar_p INOUT text ) FROM PUBLIC;

