-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_dt_ini_real_cicl_onc_md ( ie_interv_ciclo_P text, qt_dias_intervalo_pp bigint, qt_dias_intervalo_p bigint, qt_nao_util_p bigint, cd_protocolo_p bigint, ds_protocolo_mes_p text, dt_mes_seguinte_p timestamp, DT_PREVISTA_FINAL_P timestamp, DT_ULTIMA_DT_REAL_P timestamp, dt_inicio_p INOUT timestamp, dt_inicio_dt_real_p INOUT timestamp ) AS $body$
DECLARE


qt_dias_mes_seguinte_w  	integer;

BEGIN

	if (ie_interv_ciclo_P	= 'I') then
		dt_inicio_p	:= (dt_inicio_p + coalesce(qt_dias_intervalo_pp,qt_dias_intervalo_p)) + coalesce(qt_nao_util_p,0);
		dt_inicio_dt_real_p	:= (dt_inicio_dt_real_p + coalesce(qt_dias_intervalo_pp,qt_dias_intervalo_p)) + coalesce(qt_nao_util_p,0);
	elsif (ie_interv_ciclo_P	= 'U') then
		dt_inicio_p	:= (DT_PREVISTA_FINAL_P + coalesce(qt_dias_intervalo_pp,qt_dias_intervalo_p)) + coalesce(qt_nao_util_p,0);
		dt_inicio_dt_real_p	:= (DT_ULTIMA_DT_REAL_P + coalesce(qt_dias_intervalo_pp,qt_dias_intervalo_p)) + coalesce(qt_nao_util_p,0);
	end if;

	if (obter_se_contido(cd_protocolo_p, ds_protocolo_mes_p) = 'S' and pkg_date_utils.extract_field('MONTH', dt_mes_seguinte_p) <> pkg_date_utils.extract_field('MONTH', dt_inicio_p)) then

		qt_dias_mes_seguinte_w := pkg_date_utils.get_diffdate(dt_inicio_p, dt_mes_seguinte_p, 'DAY');
		dt_inicio_p := dt_inicio_p + coalesce(qt_dias_mes_seguinte_w,0);
		dt_inicio_dt_real_p := dt_inicio_dt_real_p + coalesce(qt_dias_mes_seguinte_w,0);

	end if;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_dt_ini_real_cicl_onc_md ( ie_interv_ciclo_P text, qt_dias_intervalo_pp bigint, qt_dias_intervalo_p bigint, qt_nao_util_p bigint, cd_protocolo_p bigint, ds_protocolo_mes_p text, dt_mes_seguinte_p timestamp, DT_PREVISTA_FINAL_P timestamp, DT_ULTIMA_DT_REAL_P timestamp, dt_inicio_p INOUT timestamp, dt_inicio_dt_real_p INOUT timestamp ) FROM PUBLIC;

