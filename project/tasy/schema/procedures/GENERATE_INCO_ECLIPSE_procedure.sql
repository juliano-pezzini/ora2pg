-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE generate_inco_eclipse ( entity_id bigint, nr_seq_inco_p eclipse_inco_account.nr_seq_inconsistency%type, ds_detail_p eclipse_inco_account.ds_action_user%type, nm_usuario_p eclipse_inco_account.nm_usuario%type, entity_name text default('ACCOUNT')) AS $body$
DECLARE

		
nr_sequencia_w 		eclipse_inco_account.nr_sequencia%type;
ds_action_user_w	eclipse_inconsistency.ds_inconsistency%type;
cd_pessoa_fisica_w	varchar(10);
nr_atendiment_w		bigint;
nr_seq_account_w	bigint;

BEGIN

select  max(ds_action_user)
into STRICT    ds_action_user_w
from    eclipse_inconsistency
where   nr_sequencia = nr_seq_inco_p;

select	nextval('eclipse_inco_account_seq')
into STRICT	nr_sequencia_w
;

if (entity_name = 'ACCOUNT')then

	nr_seq_account_w:= entity_id;
	
elsif (entity_name = 'PERSON') then

	cd_pessoa_fisica_w:= TO_CHAR(entity_id);

elsif (entity_name = 'ENCOUNTER') then
  
	nr_atendiment_w := entity_id;
	
end if;

insert into eclipse_inco_account(nr_sequencia,
				nr_interno_conta,
				nr_seq_inconsistency,
				dt_atualizacao,
				nm_usuario,
				ds_action_user,
				nr_atendiment,               
				cd_pessoa_fisica)
values (nr_sequencia_w,
				nr_seq_account_w,
				nr_seq_inco_p,
				clock_timestamp(),
				nm_usuario_p,
				ds_detail_p || ' ' || ds_action_user_w,
				nr_atendiment_w,
				cd_pessoa_fisica_w);
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE generate_inco_eclipse ( entity_id bigint, nr_seq_inco_p eclipse_inco_account.nr_seq_inconsistency%type, ds_detail_p eclipse_inco_account.ds_action_user%type, nm_usuario_p eclipse_inco_account.nm_usuario%type, entity_name text default('ACCOUNT')) FROM PUBLIC;

