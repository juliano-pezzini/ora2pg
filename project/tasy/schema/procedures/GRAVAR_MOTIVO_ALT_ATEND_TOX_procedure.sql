-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gravar_motivo_alt_atend_tox ( nr_seq_motivo_p bigint, ds_justificativa_p text, cd_profissional_p text, nm_usuario_p text, nr_seq_item_p bigint, ie_identificador_p text default 'D') AS $body$
BEGIN
/*As mesmas alterações realizadas nesta procedure devem ser realizadas na procedure 'gerar_mensagem_dose_espa'*/
 
 
if (ie_identificador_p <> 'D' and coalesce(nr_seq_motivo_p::text, '') = '') and (coalesce(ds_justificativa_p::text, '') = '') then 
	-- É necessário inserir uma justificativa, ou um motivo padrão. #@#@' 
	CALL Wheb_mensagem_pck.exibir_mensagem_abort(264501);
end if;
 
insert into atend_toxina_item_hist(nr_sequencia, 
					dt_atualizacao, 
					nm_usuario, 
					dt_atualizacao_nrec, 
					nm_usuario_nrec, 
					cd_profissional, 
					ds_justificativa, 
					nr_seq_motivo, 
					nr_seq_item, 
					ie_identificador) 
		values ( nextval('atend_toxina_item_hist_seq'), 
					clock_timestamp(), 
					nm_usuario_p, 
					clock_timestamp(), 
					nm_usuario_p, 
					coalesce(cd_profissional_p,obter_pessoa_fisica_usuario(nm_usuario_p,'C')), 
					ds_justificativa_p, 
					CASE WHEN nr_seq_motivo_p=0 THEN CASE WHEN ie_identificador_p='D' THEN 0  ELSE null END   ELSE nr_seq_motivo_p END , 
					CASE WHEN nr_seq_item_p=0 THEN CASE WHEN ie_identificador_p='D' THEN 0  ELSE null END   ELSE coalesce(nr_seq_item_p,0) END , 
					ie_identificador_p);		
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gravar_motivo_alt_atend_tox ( nr_seq_motivo_p bigint, ds_justificativa_p text, cd_profissional_p text, nm_usuario_p text, nr_seq_item_p bigint, ie_identificador_p text default 'D') FROM PUBLIC;

