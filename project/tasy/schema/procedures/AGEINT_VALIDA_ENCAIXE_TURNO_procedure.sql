-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ageint_valida_encaixe_turno (CD_AGENDA_P bigint, DT_ENCAIXE_P timestamp) AS $body$
DECLARE

  NR_SEQ_TURNO_W AGENDA_TURNO.NR_SEQUENCIA%TYPE;
  IE_PERM_ENCAIXE_TURNO_W AGENDA_TURNO.IE_ENCAIXE%TYPE;
  ie_regra_horario_turno_w 		varchar(1);

BEGIN
  ie_regra_horario_turno_w := Obter_Param_Usuario(821, 219, obter_perfil_ativo, obter_usuario_ativo, obter_estabelecimento_ativo, ie_regra_horario_turno_w);
  ie_regra_horario_turno_w := coalesce(ie_regra_horario_turno_w,'N');

  if (ie_regra_horario_turno_w = 'T') then
	select	obter_turno_encaixe_d_agecons(CD_AGENDA_P,DT_ENCAIXE_P,'N')
	into STRICT	nr_seq_turno_w
	;	
  else
	select	obter_turno_encaixe_agecons(CD_AGENDA_P,DT_ENCAIXE_P)
	into STRICT	nr_seq_turno_w
	;
  end if;

  SELECT coalesce(MAX(IE_ENCAIXE), 'S')
  INTO STRICT IE_PERM_ENCAIXE_TURNO_W
  FROM AGENDA_TURNO
  WHERE NR_SEQUENCIA = NR_SEQ_TURNO_W;

  IF (IE_PERM_ENCAIXE_TURNO_W = 'N') THEN
     CALL WHEB_MENSAGEM_PCK.EXIBIR_MENSAGEM_ABORT(224365);
  END IF;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ageint_valida_encaixe_turno (CD_AGENDA_P bigint, DT_ENCAIXE_P timestamp) FROM PUBLIC;

