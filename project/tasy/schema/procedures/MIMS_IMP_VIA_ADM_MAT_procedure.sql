-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE mims_imp_via_adm_mat ( cd_material_p bigint, ie_via_aplicacao_p text, ds_via_aplicacao_p text, nm_usuario_p text, nr_mims_ver_p bigint) AS $body$
DECLARE


 

				

qt_reg_w		bigint;

mat_via_aplic_w		imp_mat_via_aplic%rowtype;




BEGIN



select	count(1)

into STRICT	qt_reg_w

from	imp_mat_via_aplic

where	cd_material		= cd_material_p

and	ie_via_aplicacao	= ie_via_aplicacao_p
and nr_seq_mims_version = nr_mims_ver_p;



if (qt_reg_w	= 0) then

	CALL mims_imp_via_adm(ie_via_aplicacao_p,coalesce(ds_via_aplicacao_p,ie_via_aplicacao_p),nm_usuario_p,nr_mims_ver_p);

	

	select 	nextval('imp_mat_via_aplic_seq')

	into STRICT 	mat_via_aplic_w.nr_sequencia

	;

	

	mat_via_aplic_w.cd_material			:= cd_material_p;

	mat_via_aplic_w.ie_via_aplicacao	:= ie_via_aplicacao_p;

	mat_via_aplic_w.nm_usuario			:= nm_usuario_p;

	mat_via_aplic_w.nm_usuario_nrec		:= nm_usuario_p;

	mat_via_aplic_w.dt_atualizacao		:= clock_timestamp();

	mat_via_aplic_w.dt_atualizacao_nrec	:= clock_timestamp();

  mat_via_aplic_w.NR_SEQ_MIMS_VERSION := nr_mims_ver_p;

	insert into imp_mat_via_aplic values (mat_via_aplic_w.*);

end if;





end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE mims_imp_via_adm_mat ( cd_material_p bigint, ie_via_aplicacao_p text, ds_via_aplicacao_p text, nm_usuario_p text, nr_mims_ver_p bigint) FROM PUBLIC;

