-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cp_copiar_prescr_proc ( NR_SEQ_PRESCR_NEW_P PE_PRESCRICAO.NR_SEQUENCIA%TYPE, NR_SEQ_PRESCR_ANT_P PE_PRESCRICAO.NR_SEQUENCIA%TYPE, NR_SEQ_PAT_CP_INTERV_NEW_P cp_intervention.NR_SEQUENCIA%TYPE, NR_SEQ_PAT_CP_INTERV_ANT_P cp_intervention.NR_SEQUENCIA%TYPE, NR_SEQ_PRESCR_DIAG_NEW_P PE_PRESCR_DIAG.NR_SEQUENCIA%TYPE, NR_SEQ_PRESCR_DIAG_ANT_P PE_PRESCR_DIAG.NR_SEQUENCIA%TYPE, NM_USUARIO_P text ) AS $body$
BEGIN
    Insert
        into PE_PRESCR_PROC(
            NR_SEQUENCIA, DT_ATUALIZACAO, NM_USUARIO,
            NR_SEQ_PROC,  NR_SEQ_PRESCR,  QT_PONTUACAO,
            DS_ORIGEM,    NR_SEQ_APRES,   CD_INTERVALO,
            DS_HORARIOS,  QT_INTERVENCAO, HR_PRIM_HORARIO,
            IE_SE_NECESSARIO, DS_OBSERVACAO, DT_ATUALIZACAO_NREC,
            NM_USUARIO_NREC, IE_SUSPENSO, IE_ADEP,NR_SEQ_TOPOGRAFIA,
            DT_SUSPENSAO,NM_USUARIO_SUSP,IE_LADO,
            NR_OCORRENCIA,IE_PERMITE_EXCLUSAO,IE_AGORA,
            NR_SEQ_PROT_PROC,HR_HORARIO_ESPEC,IE_INTERV_ESPEC_AGORA,
            NR_SEQ_DIAG,NR_SEQ_ITEM,NR_SEQ_RESULT,
            IE_ACM,CD_RESPONSAVEL,IE_FAOSE,IE_PROFISSIONAL,
            IE_AUXILIAR,IE_ENCAMINHAR,IE_FAZER,
            IE_ORIENTAR,IE_SUPERVISIONAR,IE_CONFIRMADA,
            DS_JUSTIFICATIVA,NR_SEQ_CPOE_INTERV,DT_FIM,
            DT_INICIO,DT_PRIMEIRO_HORARIO,DT_HORARIO_ESPEC,
            NR_SEQ_PAT_CP_INTERV,NR_SEQ_PAT_CP_PROBLEM,NR_SEQ_REL_DIAG,
            IE_RELATED_PROBLEM,DS_DISPLAY_NAME,IE_CLASSIF_OTE,IE_FREE_ITEM)
        SELECT
            nextval('pe_prescr_proc_seq') NR_SEQUENCIA, DT_ATUALIZACAO, NM_USUARIO,
            NR_SEQ_PROC,  NR_SEQ_PRESCR,  QT_PONTUACAO,
            DS_ORIGEM,    NR_SEQ_APRES,   CD_INTERVALO,
            DS_HORARIOS,  QT_INTERVENCAO, HR_PRIM_HORARIO,
            IE_SE_NECESSARIO, DS_OBSERVACAO, DT_ATUALIZACAO_NREC,
            NM_USUARIO_NREC, IE_SUSPENSO, IE_ADEP,NR_SEQ_TOPOGRAFIA,
            DT_SUSPENSAO,NM_USUARIO_SUSP,IE_LADO,
            NR_OCORRENCIA,IE_PERMITE_EXCLUSAO,IE_AGORA,
            NR_SEQ_PROT_PROC,HR_HORARIO_ESPEC,IE_INTERV_ESPEC_AGORA,
            NR_SEQ_DIAG,NR_SEQ_ITEM,NR_SEQ_RESULT,
            IE_ACM,CD_RESPONSAVEL,IE_FAOSE,IE_PROFISSIONAL,
            IE_AUXILIAR,IE_ENCAMINHAR,IE_FAZER,
            IE_ORIENTAR,IE_SUPERVISIONAR,IE_CONFIRMADA,
            DS_JUSTIFICATIVA,NR_SEQ_CPOE_INTERV,DT_FIM,
            DT_INICIO,DT_PRIMEIRO_HORARIO,DT_HORARIO_ESPEC,
            NR_SEQ_PAT_CP_INTERV,NR_SEQ_PAT_CP_PROBLEM,NR_SEQ_REL_DIAG,
            IE_RELATED_PROBLEM,DS_DISPLAY_NAME,IE_CLASSIF_OTE,IE_FREE_ITEM
        FROM (
            SELECT
                null NR_SEQUENCIA, 
                clock_timestamp() DT_ATUALIZACAO, 
                NM_USUARIO_P NM_USUARIO,
                a.NR_SEQ_PROC,  
                NR_SEQ_PRESCR_NEW_P NR_SEQ_PRESCR,  
                a.QT_PONTUACAO,
                a.DS_ORIGEM,    
                a.NR_SEQ_APRES,   
                a.CD_INTERVALO,
                a.DS_HORARIOS,  
                a.QT_INTERVENCAO, 
                a.HR_PRIM_HORARIO,
                a.IE_SE_NECESSARIO, 
                a.DS_OBSERVACAO, 
                clock_timestamp() DT_ATUALIZACAO_NREC,
                NM_USUARIO_P NM_USUARIO_NREC, 
                a.IE_SUSPENSO, 
                a.IE_ADEP,
                a.NR_SEQ_TOPOGRAFIA,
                null DT_SUSPENSAO,
                null NM_USUARIO_SUSP,
                a.IE_LADO,
                a.NR_OCORRENCIA,
                a.IE_PERMITE_EXCLUSAO,
                a.IE_AGORA,
                a.NR_SEQ_PROT_PROC,
                a.HR_HORARIO_ESPEC,
                a.IE_INTERV_ESPEC_AGORA,
                a.NR_SEQ_DIAG, 
                a.NR_SEQ_ITEM, 
                a.NR_SEQ_RESULT,
                a.IE_ACM, 
                a.CD_RESPONSAVEL, 
                a.IE_FAOSE, 
                a.IE_PROFISSIONAL,
                a.IE_AUXILIAR, 
                a.IE_ENCAMINHAR, 
                a.IE_FAZER,
                a.IE_ORIENTAR, 
                a.IE_SUPERVISIONAR, 
                a.IE_CONFIRMADA,
                a.DS_JUSTIFICATIVA, 
                a.NR_SEQ_CPOE_INTERV, 
                a.DT_FIM,
                b.DT_PRESCRICAO DT_INICIO, 
                a.DT_PRIMEIRO_HORARIO, 
                a.DT_HORARIO_ESPEC,
                NR_SEQ_PAT_CP_INTERV_NEW_P NR_SEQ_PAT_CP_INTERV, 
                a.NR_SEQ_PAT_CP_PROBLEM, 
                a.NR_SEQ_REL_DIAG,
                NR_SEQ_PRESCR_DIAG_NEW_P IE_RELATED_PROBLEM, 
                a.DS_DISPLAY_NAME, 
                NULL IE_CLASSIF_OTE, 
                a.IE_FREE_ITEM
            FROM PE_PRESCR_PROC a 
            INNER JOIN PE_PRESCRICAO b ON
                a.NR_SEQ_PRESCR = b.NR_SEQUENCIA
            WHERE
                a.NR_SEQ_PRESCR = NR_SEQ_PRESCR_ANT_P AND (coalesce(NR_SEQ_PAT_CP_INTERV_ANT_P::text, '') = '' OR NR_SEQ_PAT_CP_INTERV = NR_SEQ_PAT_CP_INTERV_ANT_P) AND (coalesce(NR_SEQ_PRESCR_DIAG_ANT_P::text, '') = '' OR IE_RELATED_PROBLEM = NR_SEQ_PRESCR_DIAG_ANT_P)
            ) alias8;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cp_copiar_prescr_proc ( NR_SEQ_PRESCR_NEW_P PE_PRESCRICAO.NR_SEQUENCIA%TYPE, NR_SEQ_PRESCR_ANT_P PE_PRESCRICAO.NR_SEQUENCIA%TYPE, NR_SEQ_PAT_CP_INTERV_NEW_P cp_intervention.NR_SEQUENCIA%TYPE, NR_SEQ_PAT_CP_INTERV_ANT_P cp_intervention.NR_SEQUENCIA%TYPE, NR_SEQ_PRESCR_DIAG_NEW_P PE_PRESCR_DIAG.NR_SEQUENCIA%TYPE, NR_SEQ_PRESCR_DIAG_ANT_P PE_PRESCR_DIAG.NR_SEQUENCIA%TYPE, NM_USUARIO_P text ) FROM PUBLIC;

