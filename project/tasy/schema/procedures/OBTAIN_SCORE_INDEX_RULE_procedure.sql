-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obtain_score_index_rule ( nr_atendimento_p bigint, nr_tree_node_p bigint, nr_seq_grupo_p bigint, ie_escala_p text, ie_readonly_p INOUT text) AS $body$
DECLARE

nr_seq_group_scl_w  grupo_escala_indice_item.nr_sequencia%type;
ie_blocked_enc_w            varchar(1) := 'S';

BEGIN
    ie_blocked_enc_w := Obter_se_bloqueio_atendimento(nr_atendimento_p);

    if (ie_blocked_enc_w = 'S') then
        ie_readonly_p := 'N';
    end if;
    if (nr_tree_node_p = 374) then
        select  coalesce(max(ie_atualizar),'S')
        into STRICT    ie_readonly_p
        from    perfil_escala_indice b
        where   b.nr_seq_grupo  = nr_seq_grupo_p
        and b.cd_perfil = wheb_usuario_pck.get_cd_perfil;
        if (ie_readonly_p = 'S') then
            select  max(nr_sequencia)
            into STRICT    nr_seq_group_scl_w
            from    grupo_escala_indice_item
            where   nr_seq_grupo = nr_seq_grupo_p
            and     ie_escala = ie_escala_p;
            ie_readonly_p := Obter_se_regra_item_escala(nr_seq_group_scl_w, ie_readonly_p);

        end if;
    else
        ie_readonly_p := 'S';
    end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obtain_score_index_rule ( nr_atendimento_p bigint, nr_tree_node_p bigint, nr_seq_grupo_p bigint, ie_escala_p text, ie_readonly_p INOUT text) FROM PUBLIC;

