-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ctb_organizar_lcmt_import ( nr_lote_contabil_p bigint) AS $body$
DECLARE

 
nr_lancamento_w			ctb_movimento.nr_agrup_sequencial%type;
			
c_movimentos CURSOR FOR 
	SELECT 	nr_seq_agrupamento 
	from	ctb_movimento 
	where	nr_lote_contabil = nr_lote_contabil_p;

vet01  	c_movimentos%Rowtype;


BEGIN 
 
open c_movimentos;
loop 
fetch c_movimentos into	 
	vet01;
EXIT WHEN NOT FOUND; /* apply on c_movimentos */
	begin 
	 
	select	ctb_obter_lancamento_contabil(nr_lote_contabil_p) 
	into STRICT	nr_lancamento_w 
	;
	 
	update	ctb_movimento 
	set	nr_agrup_sequencial	= nr_lancamento_w 
	where	nr_seq_agrupamento	= vet01.nr_seq_agrupamento 
	and	nr_lote_contabil	= nr_lote_contabil_p;
	 
	end;
end loop;
close c_movimentos;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ctb_organizar_lcmt_import ( nr_lote_contabil_p bigint) FROM PUBLIC;

