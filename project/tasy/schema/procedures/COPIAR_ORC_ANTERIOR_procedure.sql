-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copiar_orc_anterior ( cd_estabelecimento_p bigint, cd_tabela_copia_p bigint, cd_tabela_Nova_p bigint, ie_zerado_p text, nm_usuario_p text) AS $body$
BEGIN

delete	from orcamento_custo
where	cd_estabelecimento	= cd_estabelecimento_p
and	cd_tabela_custo	= cd_tabela_nova_p;

insert into orcamento_custo(
	nr_sequencia,
	cd_estabelecimento,
	cd_tabela_custo,
	cd_centro_controle,
	cd_natureza_gasto,
	dt_atualizacao,
	nm_usuario,
	vl_orcado,
	vl_avista,
	vl_distribuido,
	vl_receb_distrib,
	qt_dias_prazo,
	vl_a_distribuir,
	ie_tipo_gasto,
	nr_seq_ng)
SELECT	nextval('orcamento_custo_seq'),
	cd_estabelecimento_p,
	cd_tabela_nova_p,
	cd_centro_controle,
	cd_natureza_gasto,
	clock_timestamp(),
	nm_usuario_p,
	CASE WHEN ie_zerado_p='S' THEN 0  ELSE vl_orcado END ,
	null,
	null,
	null,
	qt_dias_prazo,
	0,
	ie_tipo_gasto,
	nr_seq_ng
from	orcamento_custo
where	cd_estabelecimento		= cd_estabelecimento_p
and	cd_tabela_custo		= cd_tabela_copia_p
and	coalesce(vl_distribuido,0)		= 0
and	coalesce(vl_receb_distrib,0)	= 0;

commit;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copiar_orc_anterior ( cd_estabelecimento_p bigint, cd_tabela_copia_p bigint, cd_tabela_Nova_p bigint, ie_zerado_p text, nm_usuario_p text) FROM PUBLIC;

