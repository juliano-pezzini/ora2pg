-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE nut_duplicar_planejamento (nr_sequencia_p bigint, nm_usuario_p text) AS $body$
DECLARE


	nr_seq_composicao_w	bigint;
	nr_seq_receita_w       	bigint;
	dt_atualizacao_w        timestamp;
	dt_atualizacao_nrec_w   timestamp;
	nm_usuario_nrec_w       varchar(15);
	nr_seq_opcao_sel_w      bigint;
	nr_seq_servico_dia_w    bigint;
	ie_receita_especial_w   varchar(1);
	nr_seq_acompanhante_w   bigint;
 	cd_acompanhante_w       varchar(10);
	nr_seq_cardapio_dia_w   bigint;
	ie_tipo_cardapio_w      varchar(2);
	nr_seq_cardapio_w       bigint;
	qt_refeicao_w           bigint;
	cd_dieta_w              bigint;
	nr_seq_refeicao_w       bigint;
	nr_nova_seq_card_dia_w  bigint;


C001 CURSOR FOR
	SELECT  nr_seq_composicao,
		nr_seq_receita,         
		dt_atualizacao,         
		dt_atualizacao_nrec,
		nm_usuario_nrec,        
		nr_seq_opcao_sel,       
		nr_seq_servico_dia,    
		ie_receita_especial,
		nr_seq_acompanhante,
		cd_acompanhante,        
		nr_seq_cardapio_dia,
		ie_tipo_cardapio,       
		nr_seq_cardapio,        
		qt_refeicao,            
		cd_dieta,               
		nr_seq_refeicao
	from 	nut_pac_opcao_rec  
	where   nr_seq_cardapio_dia = nr_sequencia_p;


BEGIN
   if nr_sequencia_p > 0 then

      select nextval('nut_cardapio_dia_seq')
      into STRICT   nr_nova_seq_card_dia_w
;		

   
      insert into nut_cardapio_dia(	  	
			nr_sequencia,           
			cd_estabelecimento,     
			dt_atualizacao,
			nm_usuario,             
			nr_seq_servico,         
			dt_cardapio,            
			qt_pessoa_atend,       
			dt_atualizacao_nrec,    
			nm_usuario_nrec,        
			nr_seq_opcao,           
			ie_dia_semana,          
			ie_semana,              
			dt_vigencia_inicial,    
			dt_vigencia_final,      
			cd_dieta,               
			qt_pessoa_atend_real,   
			nr_seq_local,           
			nr_seq_nome_cardapio,   
			dt_liberacao,           
			nm_usuario_liberacao,   
			ie_tipo_cardapio,       
			nr_seq_grupo_producao,
			ie_cardapio_padrao,
			nr_seq_cycle,
                                                nr_seq_cycle_day )

       (        SELECT 	nr_nova_seq_card_dia_w,           
			cd_estabelecimento,     
			dt_atualizacao,         
			nm_usuario_p,             
			nr_seq_servico,         
			dt_cardapio,            
			qt_pessoa_atend,        
			null,    
			nm_usuario_p,        
			nr_seq_opcao,           
			ie_dia_semana,         
			ie_semana,              
			dt_vigencia_inicial,    
			dt_vigencia_final,      
			cd_dieta,               
			qt_pessoa_atend_real,   
			nr_seq_local,           
			nr_seq_nome_cardapio,   
			null,           
			null,   
			ie_tipo_cardapio,       
			nr_seq_grupo_producao,
			ie_cardapio_padrao,
                                                nr_seq_cycle,
                                                nr_seq_cycle_day
	        from	nut_cardapio_dia			
		where 	nr_sequencia = nr_sequencia_p);
	
	open C001;
	loop
	fetch C001 into	
		nr_seq_composicao_w,
		nr_seq_receita_w,
		dt_atualizacao_w,
		dt_atualizacao_nrec_w,
		nm_usuario_nrec_w,
		nr_seq_opcao_sel_w,
		nr_seq_servico_dia_w,
		ie_receita_especial_w,
		nr_seq_acompanhante_w,
		cd_acompanhante_w,
		nr_seq_cardapio_dia_w,
		ie_tipo_cardapio_w,
		nr_seq_cardapio_w,
		qt_refeicao_w,
		cd_dieta_w,
		nr_seq_refeicao_w;
	EXIT WHEN NOT FOUND; /* apply on C001 */
		begin
		
		  insert into nut_pac_opcao_rec(
				
			  	nr_sequencia,           
				nr_seq_composicao,      
				nr_seq_receita,         
				dt_atualizacao,         
				nm_usuario,          
				dt_atualizacao_nrec,
				nm_usuario_nrec,        
				nr_seq_opcao_sel,       
				nr_seq_servico_dia,    
				dt_liberacao,           
				ie_receita_especial,
				nr_seq_acompanhante,
				cd_acompanhante,        
				nr_seq_cardapio_dia,
				ie_tipo_cardapio,       
				nr_seq_cardapio,        
				qt_refeicao,            
				cd_dieta,               
				nr_seq_refeicao)
		  values (
			        nextval('nut_pac_opcao_rec_seq'),
				nr_seq_composicao_w,
				nr_seq_receita_w,
				dt_atualizacao_w,
				nm_usuario_p,
				dt_atualizacao_nrec_w,
				nm_usuario_p,
				nr_seq_opcao_sel_w,
				nr_seq_servico_dia_w,
				null,
				ie_receita_especial_w,
				nr_seq_acompanhante_w,
				cd_acompanhante_w,
				nr_nova_seq_card_dia_w,
				ie_tipo_cardapio_w,
				nr_seq_cardapio_w,
				qt_refeicao_w,
				cd_dieta_w,
				nr_seq_refeicao_w);
		
		end;
	end loop;
	close C001;


   end if;



end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE nut_duplicar_planejamento (nr_sequencia_p bigint, nm_usuario_p text) FROM PUBLIC;

