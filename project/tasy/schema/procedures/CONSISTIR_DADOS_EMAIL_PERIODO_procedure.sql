-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consistir_dados_email_periodo ( cd_agenda_p bigint, dt_agenda_p timestamp, dt_agenda_fim_p timestamp, ie_dt_fim_visible_p text, ds_conteudo_p INOUT text, ds_endereco_p INOUT text, cd_profissional_p INOUT text) AS $body$
DECLARE

cd_profissional_w	varchar(10);
ds_conteudo_w		varchar(6000);
ds_endereco_dest_w	varchar(255);

BEGIN
if (cd_agenda_p IS NOT NULL AND cd_agenda_p::text <> '') then 
	begin 
	 
	select	coalesce(cd_pessoa_fisica,'') 
	into STRICT	cd_profissional_w 
	from 	agenda 
	where	cd_agenda = cd_agenda_p;
	 
	if (cd_profissional_w IS NOT NULL AND cd_profissional_w::text <> '') then 
		begin 
		if (dt_agenda_p IS NOT NULL AND dt_agenda_p::text <> '') then 
			begin 
			if (ie_dt_fim_visible_p = 'S') and (dt_agenda_fim_p IS NOT NULL AND dt_agenda_fim_p::text <> '') then			 
				begin			 
				ds_conteudo_w := obter_cont_email_periodo_exa(dt_agenda_p, cd_agenda_p, dt_agenda_fim_p);
				end;
			else 
				begin 
				ds_conteudo_w := obter_cont_email_periodo_exa(dt_agenda_p, cd_agenda_p);
				end;
			end if;
			end;		
		end if;
		 
		select	max(ds_email) 
		into STRICT	ds_endereco_dest_w 
		from	usuario 
		where	cd_pessoa_fisica = cd_profissional_w;
		end;
	end if;	
	 
	ds_conteudo_p := ds_conteudo_w;
	ds_endereco_p := ds_endereco_dest_w;
	cd_profissional_p := cd_profissional_w;
	end;
end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consistir_dados_email_periodo ( cd_agenda_p bigint, dt_agenda_p timestamp, dt_agenda_fim_p timestamp, ie_dt_fim_visible_p text, ds_conteudo_p INOUT text, ds_endereco_p INOUT text, cd_profissional_p INOUT text) FROM PUBLIC;

