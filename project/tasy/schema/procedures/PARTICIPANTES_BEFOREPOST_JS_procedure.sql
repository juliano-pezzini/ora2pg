-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE participantes_beforepost_js ( cd_pessoa_fisica_p text, ie_funcao_p text, nm_usuario_p text, cd_estabelecimento_p bigint, ds_erro_p INOUT text) AS $body$
DECLARE

 
ie_especialidade_w			varchar(1);
ie_anestesista_w			varchar(1);
ie_Lib_Funcao_Espec_Medico	varchar(2);
ie_cod_espec_anestesista_w		varchar(255);


BEGIN		 
 
ds_erro_p := '';
 
ie_cod_espec_anestesista_w := obter_param_usuario(900, 255, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, ie_cod_espec_anestesista_w);	
ie_Lib_Funcao_Espec_Medico := obter_param_usuario(900, 401, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, ie_Lib_Funcao_Espec_Medico);
 
if (ie_Lib_Funcao_Espec_Medico = 'S') and (ie_funcao_p IS NOT NULL AND ie_funcao_p::text <> '') and (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') and (obter_lib_funcao_medic_espec(ie_funcao_p,cd_pessoa_fisica_p) = 'N')then 
	CALL WHEB_MENSAGEM_PCK.Exibir_Mensagem_Abort(839077);
end if;
				 
if (ie_cod_espec_anestesista_w IS NOT NULL AND ie_cod_espec_anestesista_w::text <> '') and (ie_funcao_p IS NOT NULL AND ie_funcao_p::text <> '') and (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') then 
	begin 
	 
	select	coalesce(ie_anestesista,'N') 
	into STRICT	ie_anestesista_w 
	from  funcao_medico 
	where	cd_funcao = ie_funcao_p;
	 
		                         
	if (ie_anestesista_w = 'S') then 
		begin 
		ie_especialidade_w := obter_se_especialidade_medico(cd_pessoa_fisica_p,ie_cod_espec_anestesista_w);
		 
		if (ie_especialidade_w = 'N') then 
			begin 
			CALL WHEB_MENSAGEM_PCK.Exibir_Mensagem_Abort(839078);			
			end;
		end if;
		end;
	end if;
	end;
end if;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE participantes_beforepost_js ( cd_pessoa_fisica_p text, ie_funcao_p text, nm_usuario_p text, cd_estabelecimento_p bigint, ds_erro_p INOUT text) FROM PUBLIC;

