-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gera_cad_cid_monitoramento (ds_conteudo_p text, ie_executou_p INOUT text, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE


ds_conteudo_w	text;
nr_id_cid_w		bigint;
cd_cid_w		varchar(10);
ds_cid_w		varchar(128);
index_w	 		integer := 0;
ds_valor_w 		varchar(128);
qt_registros_cad_w	integer := 0;


BEGIN

	if (ie_executou_p = 'N') then
		delete from pls_cad_cid_monitoramento;
	end if;

	ds_conteudo_w := ds_conteudo_p;
	index_w := 0;

	--navegação entre as "colunas" em cada linha do arquivo
	index_w := 0;
	while(ds_conteudo_w IS NOT NULL AND ds_conteudo_w::text <> '') loop

		if (position(';' in ds_conteudo_w) = 0) then
			ds_valor_w	:= ds_conteudo_w;
			ds_conteudo_w	:= null;
		else
			ds_valor_w := substr(ds_conteudo_w, 1, position(';' in ds_conteudo_w) -1);
			ds_conteudo_w := substr(ds_conteudo_w,position(';' in ds_conteudo_w) + 1,length(ds_conteudo_w));
		end if;

		index_w := index_w + 1;
		if (index_w = 1) then
			nr_id_cid_w := ds_valor_w;
		elsif (index_w = 2) then
			cd_cid_w := ds_valor_w;
		elsif (index_w = 3) then
			ds_cid_w := ds_valor_w;
		end if;

	end loop;

	insert into pls_cad_cid_monitoramento(	nr_sequencia, nr_id_cid_10, cd_cid,
												ds_cid, dt_atualizacao, dt_atualizacao_nrec,
												nm_usuario, nm_usuario_nrec)
		values (	nextval('pls_cad_cid_monitoramento_seq'), nr_id_cid_w, cd_cid_w,
				ds_cid_w, clock_timestamp(), clock_timestamp(), nm_usuario_p, nm_usuario_p);
	commit;
	ie_executou_p := 'S';

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gera_cad_cid_monitoramento (ds_conteudo_p text, ie_executou_p INOUT text, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;

