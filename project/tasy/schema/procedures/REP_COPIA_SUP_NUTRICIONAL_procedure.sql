-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE rep_copia_sup_nutricional ( nr_prescricao_orig_p bigint, nr_prescricao_p bigint, nr_seq_regra_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_seq_nut_pac_w	bigint;
nr_seq_nut_pac_ww	bigint;
ie_copiar_w		varchar(10);
ie_copia_valid_igual_w	varchar(1);
dt_prescricao_www	timestamp;
dt_primeiro_horario_w	timestamp;
dt_inicio_prescr_w	timestamp;
nr_horas_validade_w	integer;
ie_prim_horario_setor_w	varchar(10);
hr_setor_w		varchar(10);
cd_setor_atendimento_w	bigint;
cd_estabelecimento_w	smallint;
nr_atendimento_w	bigint;
dt_validade_origem_w	timestamp;
dt_validade_nova_w	timestamp;

c02 CURSOR FOR
SELECT	nr_sequencia
from	nut_paciente
where	nr_prescricao = nr_prescricao_orig_p
and	nr_sequencia = (select	min(b.nr_sequencia)
			from	nut_paciente b
			where	b.nr_prescricao = nr_prescricao_orig_p);


BEGIN

Select	nextval('nut_paciente_seq')
into STRICT	nr_seq_nut_pac_w
;

Insert	into Nut_Paciente(
	nr_sequencia,
	nr_atendimento,
	dt_atualizacao,
	nm_usuario,
	qt_peso,
	qt_idade_ano,
	qt_altura_cm,
	nr_seq_fator_ativ,
	nr_seq_fator_stress,
	pr_proteina,
	pr_lipidio,
	pr_carboidrato,
	qt_kcal_total,
	qt_kcal_prot,
	qt_kcal_lipidio,
	qt_kcal_carboidrato,
	qt_kcal_kg,
	qt_grama_prot_kg_dia,
	pr_npt,
	qt_fase_npt,
	qt_gotejamento_npt,
	nr_prescricao,
	ie_bomba_infusao,
	ie_npt_adulta,
	ie_suspenso,
	nr_prescricao_original,
	IE_CALC_AUTOMATICO,
	QT_VOLUME_TOTAL)
SELECT	nr_seq_nut_pac_w,
	nr_atendimento,
	clock_timestamp(),
	nm_usuario_p,
	qt_peso,
	qt_idade_ano,
	qt_altura_cm,
	nr_seq_fator_ativ,
	nr_seq_fator_stress,
	pr_proteina,
	pr_lipidio,
	pr_carboidrato,
	qt_kcal_total,
	qt_kcal_prot,
	qt_kcal_lipidio,
	qt_kcal_carboidrato,
	qt_kcal_kg,
	qt_grama_prot_kg_dia,
	pr_npt,
	qt_fase_npt,
	qt_gotejamento_npt,
	nr_prescricao_p,
	ie_bomba_infusao,
	ie_npt_adulta,
	'N',
	nr_prescricao_orig_p,
	IE_CALC_AUTOMATICO,
	QT_VOLUME_TOTAL
from	nut_paciente
where	nr_prescricao = nr_prescricao_orig_p
and	nr_sequencia = (select	min(b.nr_sequencia)
			from	nut_paciente b
			where	b.nr_prescricao = nr_prescricao_orig_p);

open c02;
loop
fetch c02 into
	nr_seq_nut_pac_ww;
EXIT WHEN NOT FOUND; /* apply on c02 */

	Insert	into Nut_Paciente_Elemento(
		nr_sequencia,
		nr_seq_nut_pac,
		nr_seq_elemento,
		dt_atualizacao,
		nm_usuario,
		qt_kcal,
		qt_elemento,
		nr_seq_elem_unid_med,
		nr_seq_elem_mat,
		qt_volume,
		cd_unid_med_prescr,
		qt_prescricao,
		qt_dispensar,
		qt_vol_1_fase,
		qt_vol_2_fase,
		qt_vol_3_fase)
	SELECT	nextval('nut_paciente_elemento_seq'),
		nr_seq_nut_pac_w,
		nr_seq_elemento,
		clock_timestamp(),
		nm_usuario_p,
		qt_kcal,
		qt_elemento,
		nr_seq_elem_unid_med,
		nr_seq_elem_mat,
		qt_volume,
		cd_unid_med_prescr,
		qt_prescricao,
		qt_dispensar,
		qt_vol_1_fase,
		qt_vol_2_fase,
		qt_vol_3_fase
	from	nut_paciente_elemento
	where	nr_seq_nut_pac = nr_seq_nut_pac_ww;

end loop;
close c02;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE rep_copia_sup_nutricional ( nr_prescricao_orig_p bigint, nr_prescricao_p bigint, nr_seq_regra_p bigint, nm_usuario_p text) FROM PUBLIC;

