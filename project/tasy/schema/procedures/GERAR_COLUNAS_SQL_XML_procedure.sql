-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_colunas_sql_xml (nr_sequencia_p bigint, nm_usuario_p text) AS $body$
DECLARE


    col_cnt            integer;
    campos_w           dbms_sql.desc_tab;
    cursor_w           integer;
    i                  integer;
    ds_sql_w           varchar(10000);
    ds_erro_w          varchar(2000);
    ds_tipo_dado_w     varchar(10);
    ds_mascara_w       varchar(12);
    nr_sequencia_rem_w bigint;


BEGIN

    select ds_sql into STRICT ds_sql_w from xml_elemento where nr_sequencia = nr_sequencia_p;

    begin
        cursor_w := dbms_sql.open_cursor;
        dbms_sql.parse(cursor_w, ds_sql_w, dbms_sql.native);
        dbms_sql.describe_columns(cursor_w, col_cnt, campos_w);
    exception
        when others then
            ds_erro_w := sqlerrm(SQLSTATE);
            CALL wheb_mensagem_pck.exibir_mensagem_abort(279345, 'DS_ERRO_P=' || ds_erro_w);
    end;
    for i in 1 .. col_cnt loop
        begin
            ds_mascara_w := '';

            if (campos_w[i].col_type = 1) then
                ds_tipo_dado_w := 'VARCHAR2';
            elsif (campos_w[i].col_type = 2) then
                ds_tipo_dado_w := 'NUMBER';
            elsif (campos_w[i].col_type = 12) then
                ds_tipo_dado_w := 'DATE';
                ds_mascara_w   := 'dd/mm/yyyy';
            end if;

            $if $$tasy_local_dict=true $then
            nr_sequencia_rem_w := get_remote_sequence('seq:xml_atributo_seq');
            $else
            select nextval('xml_atributo_seq') into STRICT nr_sequencia_rem_w;
            $end

            insert into xml_atributo(nr_sequencia,
                 nr_seq_elemento,
                 nr_seq_apresentacao,
                 nm_atributo_xml,
                 nm_atributo,
                 ie_criar_nulo,
                 ie_obrigatorio,
                 ie_tipo_atributo,
                 nm_usuario,
                 dt_atualizacao,
                 nm_usuario_nrec,
                 dt_atualizacao_nrec,
                 ie_criar_atributo,
                 ie_controle_pb,
                 ds_mascara)
            values (nr_sequencia_rem_w, --xml_atributo_seq.nextval,
                 nr_sequencia_p,
                 i * 5,
                 campos_w[i].col_name,
                 campos_w[i].col_name,
                 'S',
                 'S',
                 ds_tipo_dado_w,
                 nm_usuario_p,
                 clock_timestamp(),
                 nm_usuario_p,
                 clock_timestamp(),
                 'S',
                 'N',
                 ds_mascara_w);
        end;
    end loop;

    dbms_sql.close_cursor(cursor_w);

    commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_colunas_sql_xml (nr_sequencia_p bigint, nm_usuario_p text) FROM PUBLIC;

