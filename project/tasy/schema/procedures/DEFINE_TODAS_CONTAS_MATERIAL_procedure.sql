-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE define_todas_contas_material (CD_ESTABELECIMENTO_P bigint, CD_MATERIAL_P bigint, CD_CONTA_RECEITA_P INOUT text, CD_CONTA_ESTOQUE_P INOUT text, CD_CONTA_PASSAG_DIRETA_P INOUT text, CD_CENTRO_CUSTO_P INOUT bigint, CD_LOCAL_ESTOQUE_P INOUT bigint) AS $body$
DECLARE


CD_CLASSE_MATERIAL_W      integer  := 0;
CD_SUBGRUPO_MATERIAL_W    smallint  := 0;
CD_GRUPO_MATERIAL_W       smallint  := 0;
CD_CONTA_RECEITA_W        varchar(20);
CD_CONTA_ESTOQUE_W        varchar(20);
CD_CONTA_PASSAG_DIRETA_W  varchar(20);
cd_empresa_w		smallint;



BEGIN
select	max(cd_empresa)
into STRICT	cd_empresa_w
from	estabelecimento
where	cd_estabelecimento = CD_ESTABELECIMENTO_P;

/*      Obter Estrutura Material */

begin
select		a.cd_classe_material,
		b.cd_subgrupo_material,
		c.cd_grupo_material
into STRICT		cd_classe_material_w,
		cd_subgrupo_material_w,
		cd_grupo_material_w
from		material a,
		classe_material b,
		subgrupo_material c
where		a.cd_material	 	= cd_material_p
and		a.cd_classe_material	= b.cd_classe_material
and		b.cd_subgrupo_material	= c.cd_subgrupo_material;
exception
    		when others then
			cd_classe_material_w := 0;
end;


/* Obter contas do material  */

begin
select		cd_conta_receita,
		cd_conta_estoque,
		cd_conta_passag_direta
into STRICT 		cd_conta_receita_w,
		cd_conta_estoque_w,
		cd_conta_passag_direta_w
from 		parametros_conta_contabil
where 		cd_material  		= cd_material_p
and 		cd_classe_material	= cd_classe_material_w
and 		cd_subgrupo_material	= cd_subgrupo_material_w
and		cd_local_estoque 	= cd_local_estoque_p
and 		cd_grupo_material	= cd_grupo_material_w
and		cd_empresa		= cd_empresa_w
and		coalesce(cd_estabelecimento, cd_estabelecimento_p) = cd_estabelecimento_p;
exception
    		when others then
         	begin
		select		cd_conta_receita,
				cd_conta_estoque,
				cd_conta_passag_direta
		into STRICT 		cd_conta_receita_w,
				cd_conta_estoque_w,
				cd_conta_passag_direta_w
		from 		parametros_conta_contabil
		where 		cd_empresa		= cd_empresa_w
		and		coalesce(cd_estabelecimento, cd_estabelecimento_p) = cd_estabelecimento_p
		and 		coalesce(cd_material::text, '') = ''
		and 		cd_classe_material	= cd_classe_material_w
		and		cd_local_estoque 	= cd_local_estoque_p
		and 		cd_subgrupo_material	= cd_subgrupo_material_w
		and 		cd_grupo_material	= cd_grupo_material_w;
	 	exception
	         		when others then
                      	begin
				select		cd_conta_receita,
						cd_conta_estoque,
						cd_conta_passag_direta
				into STRICT 		cd_conta_receita_w,
						cd_conta_estoque_w,
						cd_conta_passag_direta_w
				from 		parametros_conta_contabil
				where 		cd_empresa		= cd_empresa_w
				and		coalesce(cd_estabelecimento, cd_estabelecimento_p) = cd_estabelecimento_p
				and 		coalesce(cd_material::text, '') = ''
				and 		coalesce(cd_classe_material::text, '') = ''
				and		cd_local_estoque 	= cd_local_estoque_p
				and 		cd_subgrupo_material	= cd_subgrupo_material_w
				and 		cd_grupo_material	= cd_grupo_material_w;
	 			exception
	         				when others then
                      			begin
						select		cd_conta_receita,
								cd_conta_estoque,
								cd_conta_passag_direta
						into STRICT 		cd_conta_receita_w,
								cd_conta_estoque_w,
								cd_conta_passag_direta_w
						from 		parametros_conta_contabil
						where 		cd_empresa		= cd_empresa_w
						and		coalesce(cd_estabelecimento, cd_estabelecimento_p) = cd_estabelecimento_p
						and 		coalesce(cd_material::text, '') = ''
						and 		coalesce(cd_classe_material::text, '') = ''
						and 		coalesce(cd_subgrupo_material::text, '') = ''
						and		cd_local_estoque 	= cd_local_estoque_p
						and 		cd_grupo_material	= cd_grupo_material_w;
	 					exception
	         						when others then
								begin
								cd_conta_receita_w	 := '';
								cd_conta_estoque_w	 := '';
								cd_conta_passag_direta_w := '';
								end;
                               	end;
                      	end;
         	end;
end;

CD_CONTA_RECEITA_P       := cd_conta_receita_w;
CD_CONTA_ESTOQUE_P       := cd_conta_estoque_w;
CD_CONTA_PASSAG_DIRETA_P := cd_conta_passag_direta_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE define_todas_contas_material (CD_ESTABELECIMENTO_P bigint, CD_MATERIAL_P bigint, CD_CONTA_RECEITA_P INOUT text, CD_CONTA_ESTOQUE_P INOUT text, CD_CONTA_PASSAG_DIRETA_P INOUT text, CD_CENTRO_CUSTO_P INOUT bigint, CD_LOCAL_ESTOQUE_P INOUT bigint) FROM PUBLIC;

