-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_atualiza_receb_ptu_fatura (nr_seq_fatura_p ptu_fatura.nr_sequencia%type, dt_recebimento_p timestamp, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE


ie_inconsistencia_w 		varchar(1);
dt_emissao_w    			timestamp;
ie_emissao_igual_receb_w 	varchar(1);


BEGIN

ie_inconsistencia_w := pls_consistir_dt_receb_fatura(dt_recebimento_p, ie_inconsistencia_w);

if 'S' = ie_inconsistencia_w then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(1037212);
end if;

ie_emissao_igual_receb_w := obter_param_usuario(1293, 21, obter_perfil_ativo, nm_usuario_p, wheb_usuario_pck.get_cd_estabelecimento, ie_emissao_igual_receb_w);
if ('S' = ie_emissao_igual_receb_w) then
	dt_emissao_w := dt_recebimento_p;
end if;

if coalesce(nr_seq_fatura_p, 0) > 0 then
	update	ptu_fatura
	set 	dt_recebimento_fatura 	= coalesce(dt_recebimento_p,dt_recebimento_fatura),
		dt_emissao_fatura 	= coalesce(dt_emissao_w,dt_emissao_fatura)
	where 	nr_sequencia 		= nr_seq_fatura_p;
end if;
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_atualiza_receb_ptu_fatura (nr_seq_fatura_p ptu_fatura.nr_sequencia%type, dt_recebimento_p timestamp, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;

