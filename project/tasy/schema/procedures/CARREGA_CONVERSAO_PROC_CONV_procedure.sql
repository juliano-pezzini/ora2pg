-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE carrega_conversao_proc_conv ( cd_convenio_p bigint, cd_proc_convenio_p text, cd_procedimento_p bigint, ie_origem_proced_p bigint, ds_proc_convenio_p text, cd_grupo_p text, tx_conversao_qtde_p bigint, cd_unidade_convenio_p text, ie_situacao_p text, cd_especialidade_medica_p bigint, ie_tipo_atendimento_p bigint, ie_pacote_p text, cd_setor_atendimento_p bigint, nm_usuario_p text, dt_ini_vig_p timestamp, ds_observacao_p text ) AS $body$
DECLARE


qt_proc_w		bigint;
	

BEGIN

if (cd_convenio_p IS NOT NULL AND cd_convenio_p::text <> '') and (cd_procedimento_p IS NOT NULL AND cd_procedimento_p::text <> '') and (cd_proc_convenio_p IS NOT NULL AND cd_proc_convenio_p::text <> '') and (ie_origem_proced_p IS NOT NULL AND ie_origem_proced_p::text <> '') and (ie_situacao_p IS NOT NULL AND ie_situacao_p::text <> '') then
	begin
	
	select	count(*)
	into STRICT	qt_proc_w
	from	procedimento
	where	cd_procedimento		= cd_procedimento_p;

	if (qt_proc_w <> 0) then

		insert into conversao_proc_convenio(	
			nr_sequencia,
			cd_convenio,
			cd_proc_convenio,
			dt_atualizacao,
			nm_usuario,
			cd_area_proced,
			cd_especial_proced,
			cd_grupo_proced,
			cd_procedimento,
			ie_origem_proced,
			ds_proc_convenio,
			cd_grupo,
			tx_conversao_qtde,
			cd_unidade_convenio,
			ie_situacao,
			cd_especialidade_medica,
			ie_tipo_atendimento,
			ie_pacote,
			cd_setor_atendimento,
			dt_inicio_vigencia,
			ds_observacao
			)
		values (	
			nextval('conversao_proc_convenio_seq'),
			cd_convenio_p,
			substr(cd_proc_convenio_p,1,20),
			clock_timestamp(),
			nm_usuario_p,
			null,
			null,
			null,
			cd_procedimento_p,
			ie_origem_proced_p,
			substr(ds_proc_convenio_p,1,240),
			substr(cd_grupo_p,1,10),
			CASE WHEN tx_conversao_qtde_p=0 THEN  null  ELSE tx_conversao_qtde_p END ,
			substr(cd_unidade_convenio_p,1,5),
			substr(ie_situacao_p,1,5),
			CASE WHEN cd_especialidade_medica_p=0 THEN  null  ELSE cd_especialidade_medica_p END ,
			CASE WHEN ie_tipo_atendimento_p=0 THEN  null  ELSE ie_tipo_atendimento_p END ,
			substr(ie_pacote_p,1,5),
			CASE WHEN cd_setor_atendimento_p=0 THEN  null  ELSE cd_setor_atendimento_p END ,
			dt_ini_vig_p,
            		substr(ds_observacao_p,1,255)
			);

	end if;
	end;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE carrega_conversao_proc_conv ( cd_convenio_p bigint, cd_proc_convenio_p text, cd_procedimento_p bigint, ie_origem_proced_p bigint, ds_proc_convenio_p text, cd_grupo_p text, tx_conversao_qtde_p bigint, cd_unidade_convenio_p text, ie_situacao_p text, cd_especialidade_medica_p bigint, ie_tipo_atendimento_p bigint, ie_pacote_p text, cd_setor_atendimento_p bigint, nm_usuario_p text, dt_ini_vig_p timestamp, ds_observacao_p text ) FROM PUBLIC;

