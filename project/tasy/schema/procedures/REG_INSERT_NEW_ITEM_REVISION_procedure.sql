-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE reg_insert_new_item_revision ( nr_seq_item_p bigint , ie_doc_type_p text ) AS $body$
DECLARE


c_table_fields CURSOR(ds_table_name_p	text) FOR
	SELECT	column_name
	FROM	user_tab_columns
	WHERE	table_name = ds_table_name_p
	AND	UPPER(column_name) <> 'NR_SEQUENCIA';


ds_table_w		varchar(30);
ds_hist_table_w		varchar(30);
ds_hist_fk_w		varchar(30);
ds_table_fields_w	varchar(1000);

BEGIN

	IF (ie_doc_type_p = 'PR') THEN
		ds_table_w := 'reg_product_requirement';
		ds_hist_table_w := 'reg_pr_history';
		ds_hist_fk_w := 'nr_seq_pr';
	ELSIF (ie_doc_type_p = 'CR') THEN
		ds_table_w := 'reg_customer_requirement';
		ds_hist_table_w := 'reg_cr_history';
		ds_hist_fk_w := 'nr_seq_cr';
	ELSIF (ie_doc_type_p = 'AR') THEN
		ds_table_w := 'reg_area_customer';
		ds_hist_table_w := 'reg_area_history';
		ds_hist_fk_w := 'nr_seq_area_customer';
	ELSIF (ie_doc_type_p = 'FE') THEN
		ds_table_w := 'reg_features_customer';
		ds_hist_table_w := 'reg_features_history';
		ds_hist_fk_w := 'nr_seq_feature';
	ELSIF (ie_doc_type_p = 'IU') THEN
		ds_table_w := 'reg_intencao_uso';
		ds_hist_table_w := 'reg_int_use_history';
		ds_hist_fk_w := 'nr_seq_int_use';
	END IF;

	FOR	field in c_table_fields(ds_table_w)
	LOOP
		ds_table_fields_w := ds_table_fields_w || field.column_name || ',';
	END LOOP;

	EXECUTE
		'INSERT INTO	'||ds_hist_table_w||'('||ds_table_fields_w||','||ds_hist_fk_w||')
		SELECT	'||ds_hist_table_w||'_seq.NextVal nr_sequencia, '||ds_table_fields_w||' nr_sequencia
		FROM	'||ds_table_w||'
		WHERE	nr_sequencia = '||nr_seq_item_p;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE reg_insert_new_item_revision ( nr_seq_item_p bigint , ie_doc_type_p text ) FROM PUBLIC;

