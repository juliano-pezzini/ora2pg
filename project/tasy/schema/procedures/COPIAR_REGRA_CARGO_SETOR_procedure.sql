-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copiar_regra_cargo_setor (cd_cargo_origem_p bigint, cd_cargo_destino_p bigint, nm_usuario_p text) AS $body$
DECLARE


cd_setor_atendimento_w	integer;
nr_seq_regra_w		bigint;
nr_seq_regra_gerada_w	bigint;
cd_perfil_w		integer;
cd_setor_atendimento_lib_w	integer;

c01 CURSOR FOR
SELECT	a.cd_setor_atendimento,
	a.nr_sequencia
from	regra_cargo_setor a
where	a.cd_cargo	= cd_cargo_origem_p;

c02 CURSOR FOR
SELECT	a.cd_perfil
from	regra_cargo_perfil_lib a
where	a.nr_seq_regra_cargo	= nr_seq_regra_w;

c03 CURSOR FOR
SELECT	a.cd_setor_atendimento
from	regra_cargo_setor_lib a
where	a.nr_seq_regra_cargo	= nr_seq_regra_w;


BEGIN

open c01;
loop
fetch c01 into
	cd_setor_atendimento_w,
	nr_seq_regra_w;
EXIT WHEN NOT FOUND; /* apply on c01 */

	select	nextval('regra_cargo_setor_seq')
	into STRICT	nr_seq_regra_gerada_w
	;

	insert	into regra_cargo_setor(cd_cargo,
		cd_setor_atendimento,
		dt_atualizacao,
		nm_usuario,
		nr_sequencia)
	values (cd_cargo_destino_p,
		cd_setor_atendimento_w,
		clock_timestamp(),
		nm_usuario_p,
		nr_seq_regra_gerada_w);

	open c02;
	loop
	fetch c02 into
		cd_perfil_w;
	EXIT WHEN NOT FOUND; /* apply on c02 */

		insert	into regra_cargo_perfil_lib(cd_perfil,
			dt_atualizacao,
			nm_usuario,
			nr_seq_regra_cargo,
			nr_sequencia)
		values (cd_perfil_w,
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_regra_gerada_w,
			nextval('regra_cargo_perfil_lib_seq'));

	end loop;
	close c02;

	open c03;
	loop
	fetch c03 into
		cd_setor_atendimento_lib_w;
	EXIT WHEN NOT FOUND; /* apply on c03 */

		insert	into regra_cargo_setor_lib(cd_setor_atendimento,
			dt_atualizacao,
			nm_usuario,
			nr_seq_regra_cargo,
			nr_sequencia)
		values (cd_setor_atendimento_lib_w,
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_regra_gerada_w,
			nextval('regra_cargo_setor_lib_seq'));

	end loop;
	close c03;

end loop;
close c01;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copiar_regra_cargo_setor (cd_cargo_origem_p bigint, cd_cargo_destino_p bigint, nm_usuario_p text) FROM PUBLIC;

