-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE verifica_cargo_usuario ( nm_usuario_p text, ie_opcao_p text) AS $body$
DECLARE

/*
E - Estagiário (133)
S - Suporte (72,75,76,241,503,62,501,502)
P - Programador (66,69,73,80,251)
A - Analista (61,221,113,822,825, 1324, 1430, 1393, 1428)
G - Gerente (63,231,232,112,1350,1395)
I - Instrutor (181,183,184,185,272)
D - Diretor (791)
R - Documentador (1093,1101,1111)
08/06/2015 - Inclusão dos usuários da AMcom - Outsourcing que irá desenvolver as integrações. Desenvolvedores incluídos como analistas.
*/
            
ie_libera_w	boolean := false;
cd_cargo_w	bigint;
ie_lib_w	varchar(1);


BEGIN
select	max(b.cd_cargo)
into STRICT	cd_cargo_w
from	usuario a,
	pessoa_fisica b
where	a.cd_pessoa_fisica = b.cd_pessoa_fisica
and	upper(a.nm_usuario) = upper(nm_usuario_p);

if (position('S' in ie_opcao_p) > 0) then
     ie_libera_w := cd_cargo_w in (72,75,76,241,503,62,501,502);
	
	 if not ie_libera_w then
		select CASE WHEN count(1)=0 THEN  'N'  ELSE 'S' END 
		into STRICT	ie_lib_w	
		from	man_ordem_serv_deleg
		where	nm_usuario_deleg = nm_usuario_p
		and		cd_cargo in (72,75,76,241,503,62,501,502)
		and		clock_timestamp() between pkg_date_utils.start_of(dt_inicio_vigencia,'DAY') and pkg_date_utils.end_of(coalesce(dt_fim_vigencia, clock_timestamp()), 'DAY');
		
		ie_libera_w := ie_lib_w = 'S';
	 end if;
elsif (position('P' in ie_opcao_p) > 0) then
     ie_libera_w := cd_cargo_w in (66,69,73,80,251);
	
	 if  not ie_libera_w then
		select CASE WHEN count(1)=0 THEN  'N'  ELSE 'S' END 
		into STRICT	ie_lib_w	
		from	man_ordem_serv_deleg
		where	nm_usuario_deleg = nm_usuario_p
		and		cd_cargo in (66,69,73,80,251)
		and		clock_timestamp() between pkg_date_utils.start_of(dt_inicio_vigencia,'DAY') and pkg_date_utils.end_of(coalesce(dt_fim_vigencia, clock_timestamp()), 'DAY');
		
		ie_libera_w := ie_lib_w = 'S';
	 end if;
elsif (position('A' in ie_opcao_p) > 0) then
    ie_libera_w := ((cd_cargo_w in (61,221,113,371,822,825,1354,1324,1430,1393,1428)) or (nm_usuario_p in ('Eberns', 'bcgucowski', 'aarbigaus','Jonas','Felipe','Juliane','crhobus',
                                    'amleicht', 'Jerusa', 'dsilva', 'Maicon', 'srcunha', 'cmmissel',
                                    'ralves','asilveira',  'lhalves','gfsantos','mmmacedo','amramos', 'pmfugimoto', 'PMFUGIMOTO',
                                    'wcsilva','cetrentin','ahoffelder','alcornetet','gfraupp','lcunha','rfoliveira','RFOLIVEIRA',
                                    'jojunior', 'vhkrausser', 'lbecker', 'adgirardi', 'gaschafer', 'rnffilho', 'dylsantos', 'fkoliveira',
                                    'fcvargas', 'rrother','Rrother','ldpereira','lafeller','ncachoeira','cpdias','crdossi', 'afstringari',
                                     'alheckmann', 'dsilva', 'cscaleiro', 'hhlopes', 'jojunior', 'vhkrausser', 'afaraujo','JFEPUSCHEL', 'mvassuiti','mhfischer', 'jlweigmann',
                                     'easantos', 'dsantos', 'emafezzoli', 'CRMULLER', 'rasantos', 'jgvalerio', 'lfhinckel', 'khalid','dutpadel','jcbandeira','ctarruda','rzimmermann', 'emaffezzoli', 'jcaraujo',
                                     'ddallabona', 'tblima', 'JVVPPEREIRA', 'jvvppereira', 'allaus','algiovanini','jbneto','fsgoertmann', 'rcorrea', 'aamfirmo', 'acolzani', 'abortoloso')));

	if  not ie_libera_w then
		select CASE WHEN count(1)=0 THEN  'N'  ELSE 'S' END 
		into STRICT	ie_lib_w	
		from	man_ordem_serv_deleg
		where	nm_usuario_deleg = nm_usuario_p
		and		cd_cargo in (61,221,113,371,822,825,1354,1324,1430,1393,1428)
		and		clock_timestamp() BETWEEN PKG_DATE_UTILS.start_of(dt_inicio_vigencia,'DAY') and pkg_date_utils.end_of(coalesce(dt_fim_vigencia, clock_timestamp()), 'DAY');
		
		ie_libera_w := ie_lib_w = 'S';
	end if;
elsif (position('G' in ie_opcao_p) > 0) then
    ie_libera_w := cd_cargo_w in (112, 63,231,232,1350, 1395);
	
	if  not ie_libera_w then
		select CASE WHEN count(1)=0 THEN  'N'  ELSE 'S' END
		into STRICT	ie_lib_w	
		from	man_ordem_serv_deleg
		where	nm_usuario_deleg = nm_usuario_p
		and		cd_cargo in (112, 63,231,232,1350, 1395)
		and		clock_timestamp() between pkg_date_utils.start_of(dt_inicio_vigencia,'DAY') and pkg_date_utils.end_of(coalesce(dt_fim_vigencia, clock_timestamp()), 'DAY');
		
		ie_libera_w := ie_lib_w = 'S';
	end if;
elsif (position('I' in ie_opcao_p) > 0) then
    ie_libera_w := cd_cargo_w in (181,183,184,185,272);
	
	if  not ie_libera_w then
		select CASE WHEN count(1)=0 THEN  'N'  ELSE 'S' END
		into STRICT	ie_lib_w	
		from	man_ordem_serv_deleg
		where	nm_usuario_deleg = nm_usuario_p
		and		cd_cargo in (181,183,184,185,272)
		and		clock_timestamp() between pkg_date_utils.start_of(dt_inicio_vigencia,'DAY') and pkg_date_utils.end_of(coalesce(dt_fim_vigencia, clock_timestamp()), 'DAY');
		
		ie_libera_w := ie_lib_w = 'S';
	end if;
elsif (position('D' in ie_opcao_p) > 0) then
    ie_libera_w := cd_cargo_w = 791;
	
	if  not ie_libera_w then
		select CASE WHEN count(1)=0 THEN  'N'  ELSE 'S' END
		into STRICT	ie_lib_w	
		from	man_ordem_serv_deleg
		where	nm_usuario_deleg = nm_usuario_p
		and		cd_cargo = 791
		and		clock_timestamp() between pkg_date_utils.start_of(dt_inicio_vigencia,'DAY') and pkg_date_utils.end_of(coalesce(dt_fim_vigencia, clock_timestamp()), 'DAY');
		
		ie_libera_w := ie_lib_w = 'S';
	end if;
elsif (position('R' in ie_opcao_p) > 0) then
    ie_libera_w := cd_cargo_w in (1093,1101,1111);
	
	if  not ie_libera_w then
		select CASE WHEN count(1)=0 THEN  'N'  ELSE 'S' END
		into STRICT	ie_lib_w	
		from	man_ordem_serv_deleg
		where	nm_usuario_deleg = nm_usuario_p
		and		cd_cargo in (1093,1101,1111)
		and		clock_timestamp() between pkg_date_utils.start_of(dt_inicio_vigencia,'DAY') and pkg_date_utils.end_of(coalesce(dt_fim_vigencia, clock_timestamp()), 'DAY');
		
		ie_libera_w := ie_lib_w = 'S';
	end if;
end if;
if (not ie_libera_w) then
    CALL Wheb_mensagem_pck.exibir_mensagem_abort(279069);
end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE verifica_cargo_usuario ( nm_usuario_p text, ie_opcao_p text) FROM PUBLIC;

