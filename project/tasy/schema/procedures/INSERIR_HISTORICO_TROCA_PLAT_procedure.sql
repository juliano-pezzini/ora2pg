-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_historico_troca_plat ( nm_usuario_p text, nr_seq_ordem_serv_p bigint, new_value_p text, old_value_p text ) AS $body$
DECLARE




ds_relat_tecnico_w	text := wheb_mensagem_pck.get_texto(1043735,'NEW_VALUE_W=' || OBTER_VALOR_DOMINIO(2811, new_value_p) || ';' ||
															'OLD_VALUE_W=' || OBTER_VALOR_DOMINIO(2811, old_value_p) || ';'  || 'NM_USUARIO_P=' || Obter_Pessoa_Fisica_Usuario(nm_usuario_p, 'X') || ';');
nm_user_w			varchar(30);



BEGIN

select	username
into STRICT	nm_user_w
from	user_users;

if (nm_user_w = 'CORP') then
	begin
		insert into	man_ordem_serv_tecnico(nr_sequencia,
							nr_seq_ordem_serv,
							dt_atualizacao,
							nm_usuario,
							ds_relat_tecnico,
							dt_liberacao,
							nm_usuario_lib,
							dt_historico,
							nr_seq_tipo,
							ie_origem)
					values (nextval('man_ordem_serv_tecnico_seq'),
							nr_seq_ordem_serv_p,
							clock_timestamp(),
							nm_usuario_p,
							ds_relat_tecnico_w,
							clock_timestamp(),
							nm_usuario_p,
							clock_timestamp(),
							7, --Dialogo Interno
							'I');
		commit;

	end;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_historico_troca_plat ( nm_usuario_p text, nr_seq_ordem_serv_p bigint, new_value_p text, old_value_p text ) FROM PUBLIC;

