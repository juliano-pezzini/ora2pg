-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_aval_dor_toracica ( nr_atendimento_p bigint, nm_usuario_p text, nr_sequencia_p INOUT bigint) AS $body$
DECLARE

 
nr_sequencia_w	bigint;


BEGIN 
select	coalesce(max(nr_sequencia),0) 
into STRICT	nr_sequencia_w 
from	med_avaliacao_paciente 
where	nr_seq_tipo_avaliacao = 9482 
and	nr_atendimento = nr_atendimento_p 
and	(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '') 
and	coalesce(dt_inativacao::text, '') = '';
 
if (nr_sequencia_w > 0) then 
	CALL duplicar_avaliacao(nr_sequencia_w,nm_usuario_p,nr_atendimento_p);
	 
	nr_sequencia_w := 0;
	select	coalesce(max(nr_sequencia),0) 
	into STRICT	nr_sequencia_w 
	from	med_avaliacao_paciente 
	where	nr_seq_tipo_avaliacao = 326 -- Código da avaliação na base do cliente Real Sociedade Portuguesa de Beneficiencia 
	and	nr_atendimento = nr_atendimento_p 
	and	coalesce(dt_liberacao::text, '') = '';
end if;
 
nr_sequencia_p := nr_sequencia_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_aval_dor_toracica ( nr_atendimento_p bigint, nm_usuario_p text, nr_sequencia_p INOUT bigint) FROM PUBLIC;

