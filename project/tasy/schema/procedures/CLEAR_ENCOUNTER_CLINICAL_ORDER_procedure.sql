-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE clear_encounter_clinical_order (nr_atendimento_p atendimento_paciente.nr_atendimento%type, ie_commit_p text ) AS $body$
DECLARE


	procedure clear_dep_sp_equipe_atend is
	;
BEGIN

		delete
		  from sp_prof_atend
		 where nr_seq_atend	in (SELECT distinct x.nr_sequencia from sp_equipe_atend x where x.nr_atendimento = nr_atendimento_p);

	end;

	procedure clear_dep_adep_irrigacao is
	begin

		delete
		  from adep_irrigacao_etapa
		 where nr_seq_irrigacao	in (SELECT distinct x.nr_sequencia from adep_irrigacao x where x.nr_atendimento = nr_atendimento_p);

	end;

	procedure clear_dep_atend_pac_disp is
	begin

		update pep_item_pendente	
		   set nr_seq_dispositivo  = NULL
		 where nr_seq_dispositivo in (SELECT distinct x.nr_sequencia from atend_pac_dispositivo x where x.nr_atendimento = nr_atendimento_p);

		update wl_worklist
		   set nr_seq_disp_pac  = NULL
		 where nr_seq_disp_pac in (SELECT distinct x.nr_sequencia from atend_pac_dispositivo x where x.nr_atendimento = nr_atendimento_p);

		delete
		  from cih_ficha_ocorrencia_disp 
		 where nr_seq_atend_disp in (SELECT distinct x.nr_sequencia from atend_pac_dispositivo x where x.nr_atendimento = nr_atendimento_p);

	end;

	procedure clear_dep_adep_processo is
	begin

		/* Dependencies of ADEP_PROCESSO_FRAC */

		update adep_processo_item	
		   set nr_seq_frac  = NULL
		 where nr_seq_frac in (SELECT distinct y.nr_sequencia from adep_processo x, adep_processo_frac y where x.nr_sequencia = y.nr_seq_processo and x.nr_atendimento = nr_atendimento_p);

		update prescr_mat_hor
		   set nr_seq_etiqueta_reaprov  = NULL
		 where nr_seq_etiqueta_reaprov in (SELECT distinct y.nr_sequencia from adep_processo x, adep_processo_frac y where x.nr_sequencia = y.nr_seq_processo and x.nr_atendimento = nr_atendimento_p);

		update prescr_mat_hor
		   set nr_seq_etiqueta  = NULL
		 where nr_seq_etiqueta in (SELECT distinct y.nr_sequencia from adep_processo x, adep_processo_frac y where x.nr_sequencia = y.nr_seq_processo and x.nr_atendimento = nr_atendimento_p);

		/* Dependencies of ADEP_PROCESSO */

		update prescr_proc_hor
		   set nr_seq_processo  = NULL
		 where nr_seq_processo in (SELECT distinct x.nr_sequencia from adep_processo x where x.nr_atendimento = nr_atendimento_p);

		update lp_individual
		   set nr_seq_processo  = NULL
		 where nr_seq_processo in (SELECT distinct x.nr_sequencia from adep_processo x where x.nr_atendimento = nr_atendimento_p);

		update adep_processo_area
		   set nr_seq_processo  = NULL
		 where nr_seq_processo in (SELECT distinct x.nr_sequencia from adep_processo x where x.nr_atendimento = nr_atendimento_p);

		update adep_processo
		   set nr_seq_processo  = NULL
		 where nr_seq_processo in (SELECT distinct x.nr_sequencia from adep_processo x where x.nr_atendimento = nr_atendimento_p);

		update prescr_mat_hor
		   set nr_seq_processo  = NULL
		 where nr_seq_processo in (SELECT distinct x.nr_sequencia from adep_processo x where x.nr_atendimento = nr_atendimento_p);

		update material_atend_paciente
		   set nr_seq_processo  = NULL
		 where nr_seq_processo in (SELECT distinct x.nr_sequencia from adep_processo x where x.nr_atendimento = nr_atendimento_p);

		update gedipa_intervencao_preparo
		   set nr_seq_processo  = NULL
		 where nr_seq_processo in (SELECT distinct x.nr_sequencia from adep_processo x where x.nr_atendimento = nr_atendimento_p);

		update justificativa_revalidacao
		   set nr_seq_processo  = NULL
		 where nr_seq_processo in (SELECT distinct x.nr_sequencia from adep_processo x where x.nr_atendimento = nr_atendimento_p);

		delete
		  from adep_processo_frac
		 where nr_seq_processo in (SELECT distinct x.nr_sequencia from adep_processo x where x.nr_atendimento = nr_atendimento_p);

		delete
		  from adep_processo_controle
		 where nr_seq_processo in (SELECT distinct x.nr_sequencia from adep_processo x where x.nr_atendimento = nr_atendimento_p);

	end;

begin
	if (nr_atendimento_p IS NOT NULL AND nr_atendimento_p::text <> '') then

		/* Tables you can just update */

		
		update TRANSCRICAO_PRESCRICAO set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;
		update HSL_RELAT_GLICEMIA set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;

		update CONSULTA_ONCOLOGICA set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;
		update ONC_CONSULTA set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;

		update LOG_CONFIRMAR_PACIENTE set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;
		update ADMINISTRACAO_LOTE_FORNEC set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;
		update REQUISICAO_ITEM set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;

		update PRESCR_SOLUCAO_EVENTO set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;
		update PRESCR_MEDICA_ORDEM set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;
		update PRESCR_MAT_JUST_DOSE set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;

		update GPT_HIST_ANALISE_PLANO set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;
		update GPT_REVALIDATION_EVENTS set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;

		update CPOE_DIALISE set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;
		update CPOE_INTERVENCAO set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;
		update CPOE_HEMOTERAPIA set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;
		update CPOE_GASOTERAPIA set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;
		update CPOE_MATERIAL set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;
		update CPOE_DIALISE_PERIT set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;
		update CPOE_PAC_DOSE_MATERIAL set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;
		update CPOE_PROC_GLIC set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;
		update CPOE_REVALIDATION_EVENTS set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;
		update CPOE_PLAN_PROTOCOL set nr_atendimento  = NULL where nr_atendimento = nr_atendimento_p;

		/* Tables you can delete */

		clear_dep_atend_pac_disp;
		delete from ATEND_PAC_DISPOSITIVO where nr_atendimento = nr_atendimento_p;
		
		clear_dep_sp_equipe_atend;
		delete from SP_EQUIPE_ATEND where nr_atendimento = nr_atendimento_p;

		clear_dep_adep_irrigacao;
		delete from ADEP_IRRIGACAO where nr_atendimento = nr_atendimento_p;

		clear_dep_adep_processo;
		delete from ADEP_PROCESSO where nr_atendimento = nr_atendimento_p;

		delete from GEDI_MEDIC_ATEND where nr_atendimento = nr_atendimento_p;

		delete from HSL_PERGUNTA_GLICEMIA where nr_atendimento = nr_atendimento_p;

		delete from ATENDIMENTO_GLICEMIA_EXC where nr_atendimento = nr_atendimento_p;
		delete from ATENDIMENTO_CIG_EXC where nr_atendimento = nr_atendimento_p;
		delete from ATENDIMENTO_GLICEMIA where nr_atendimento = nr_atendimento_p;
		delete from ATENDIMENTO_CIG where nr_atendimento = nr_atendimento_p;
		delete from ATEND_GLICEMIA where nr_atendimento = nr_atendimento_p;

		delete from DISPOSITIVO_INF_ADIC where nr_atendimento = nr_atendimento_p;

		delete from ADEP_ELIMINACAO where nr_atendimento = nr_atendimento_p;
		delete from ADEP_RESIDUO_GASTRICO where nr_atendimento = nr_atendimento_p;

		delete from REP_RESULT_VANCO where nr_atendimento = nr_atendimento_p;
		delete from REP_HORARIO_HOR_PAC where nr_atendimento = nr_atendimento_p;
		delete from REP_CONTROLE_ATB where nr_atendimento = nr_atendimento_p;

		delete from PRESCR_MEDICA_CPOE_CONF where nr_atendimento = nr_atendimento_p;

		delete from CPOE_INTERACAO where nr_atendimento = nr_atendimento_p;
		delete from CPOE_INCONSISTENCY where nr_atendimento = nr_atendimento_p;

		delete from LOG_CPOE where nr_atendimento = nr_atendimento_p;
		delete from LOG_ERRO_CBL where nr_atendimento = nr_atendimento_p;

		delete from W_CPOE_PROC_GLIC where nr_atendimento = nr_atendimento_p;
		delete from W_ADEP_OXIGENIO where nr_atendimento = nr_atendimento_p;
		delete from W_KIT_MODIFICADO where nr_atendimento = nr_atendimento_p;
		delete from W_INCONSISTENCIAS_ONCO where nr_atendimento = nr_atendimento_p;
		delete from W_RELAT_HOR_CPOE where nr_atendimento = nr_atendimento_p;

		if (ie_commit_p = 'S') then
			commit;
		end if;

	end if;	
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE clear_encounter_clinical_order (nr_atendimento_p atendimento_paciente.nr_atendimento%type, ie_commit_p text ) FROM PUBLIC;

