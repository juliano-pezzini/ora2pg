-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerarpropriedadespadroesno ( nr_seq_no_p bigint, nm_usuario_p text, nr_seq_propery_p bigint default 0) AS $body$
DECLARE


nr_sequencia_w	bigint;
cd_component_w  bigint;

c01 CURSOR FOR
	SELECT	a.nr_sequencia
	from	component_property a
	where	a.ie_situacao = 'A'
	and 	a.cd_component = cd_component_w
	and 	a.nr_sequencia not in (SELECT b.NR_SEQ_PROPERTY from detail_node_property b where b.NR_SEQ_node = nr_seq_no_p)
	and     ((nr_seq_propery_p = 0 and a.ie_required = 'S') or a.nr_sequencia = nr_seq_propery_p)
	order by nr_sequencia;


BEGIN
	Select CD_COMPONENT_TYPE
	into STRICT cd_component_w
	from detail_node
	where nr_sequencia = nr_seq_no_p;

	open C01;
	loop
	fetch C01 into
		nr_sequencia_w;
	EXIT WHEN NOT FOUND; /* apply on c01 */
		begin

		insert into detail_node_property(nr_sequencia, dt_atualizacao_nrec, nm_usuario_nrec, dt_atualizacao, nm_usuario, nr_seq_node, nr_seq_property) values (nextval('detail_node_property_seq'), clock_timestamp(), nm_usuario_p, clock_timestamp(), nm_usuario_p, nr_seq_no_p, nr_sequencia_w);


		end;
	end loop;
	close C01;
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerarpropriedadespadroesno ( nr_seq_no_p bigint, nm_usuario_p text, nr_seq_propery_p bigint default 0) FROM PUBLIC;

