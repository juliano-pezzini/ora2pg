-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consistir_gerar_prescricao_js ( nr_atendimento_p bigint, ie_momento_p text, ie_prescricao_alta_p text, dt_prescricao_p timestamp, ds_mensagem_p INOUT text, ie_acao_p INOUT text, ie_anamnese_p INOUT text, ie_evolucao_p INOUT text, ie_posicionar_pep_p INOUT regra_consiste_inf_rep.ie_posicionar_pep%type, cd_setor_atendimento_p bigint, cd_estabelecimento_p bigint, cd_perfil_p bigint, nm_usuario_p text) AS $body$
DECLARE


ie_acao_w		varchar(10);
ds_mensagem_w		varchar(255);		
ds_mensagem_adic_w	varchar(255);
ie_anamnese_w		varchar(1);
ie_evolucao_w		varchar(1);
ie_diagnostico_w		varchar(1);
ie_recomendacao_w	varchar(1);
ie_escala_indice_w		varchar(10);
ie_receita_w		varchar(1);
ie_parecer_w		varchar(1);
ie_aval_w		varchar(1);
ie_peso_w		varchar(1);
cd_protocolo_w		bigint;
ie_sus_w			varchar(1);
ie_autorizacao_w		varchar(1);
ie_item_prontuario_w 	varchar(5);
ie_posicionar_pep_w 	varchar(1);


BEGIN

CALL consistir_prescr_apos_alta(nr_atendimento_p,nm_usuario_p);

SELECT * FROM consiste_regra_inf_rep(
	cd_estabelecimento_p, nr_atendimento_p, cd_setor_atendimento_p, cd_perfil_p, ie_momento_p, ie_prescricao_alta_p, dt_prescricao_p, nm_usuario_p, ds_mensagem_w, ds_mensagem_adic_w, ie_acao_w, ie_anamnese_w, ie_evolucao_w, ie_receita_w, ie_diagnostico_w, ie_escala_indice_w, null, null, null, ie_recomendacao_w, cd_protocolo_w, ie_parecer_w, ie_peso_w, ie_autorizacao_w, ie_sus_w, ie_aval_w, ie_item_prontuario_w, ie_posicionar_pep_w) INTO STRICT ds_mensagem_w, ds_mensagem_adic_w, ie_acao_w, ie_anamnese_w, ie_evolucao_w, ie_receita_w, ie_diagnostico_w, ie_escala_indice_w, ie_recomendacao_w, cd_protocolo_w, ie_parecer_w, ie_peso_w, ie_autorizacao_w, ie_sus_w, ie_aval_w, ie_item_prontuario_w, ie_posicionar_pep_w;

commit;
ie_acao_p	:= ie_acao_w;
ds_mensagem_p	:= substr(ds_mensagem_w,1,255);
ie_anamnese_p	:= ie_anamnese_w;
ie_evolucao_p	:= ie_evolucao_w;
ie_posicionar_pep_p := ie_posicionar_pep_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consistir_gerar_prescricao_js ( nr_atendimento_p bigint, ie_momento_p text, ie_prescricao_alta_p text, dt_prescricao_p timestamp, ds_mensagem_p INOUT text, ie_acao_p INOUT text, ie_anamnese_p INOUT text, ie_evolucao_p INOUT text, ie_posicionar_pep_p INOUT regra_consiste_inf_rep.ie_posicionar_pep%type, cd_setor_atendimento_p bigint, cd_estabelecimento_p bigint, cd_perfil_p bigint, nm_usuario_p text) FROM PUBLIC;

