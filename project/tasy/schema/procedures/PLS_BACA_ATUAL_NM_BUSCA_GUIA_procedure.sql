-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_baca_atual_nm_busca_guia () AS $body$
DECLARE


nm_medico_ou_prestador_w	varchar(2000);

C01 CURSOR FOR
	SELECT	x.nr_sequencia,
		null ie_prefixo_guia_medico,
		(SELECT	a.ds_razao_social
		from	pessoa_juridica a
		where 	a.cd_cgc 	= x.cd_cgc) nm_prestador,
		(select	a.nm_fantasia
		from	pessoa_juridica a
		where 	a.cd_cgc 	= x.cd_cgc) nm_usual,
		x.nm_interno,
		x.nm_adic_guia_medico
	from	pls_prestador x
	where	(x.cd_cgc IS NOT NULL AND x.cd_cgc::text <> '')
	and	coalesce(x.nm_busca_guia_medico::text, '') = ''
	
union

	select	x.nr_sequencia,
		x.ie_prefixo_guia_medico,
		(select	b.nm_pessoa_fisica
		from	pessoa_fisica b
		where 	b.cd_pessoa_fisica 	 = x.cd_pessoa_fisica) nm_prestador,
		(select	c.nm_guerra
		FROM medico c
LEFT OUTER JOIN pessoa_fisica b ON (c.cd_pessoa_fisica = b.cd_pessoa_fisica)
WHERE b.cd_pessoa_fisica 	= x.cd_pessoa_fisica ) nm_usual,
		x.nm_interno,
		x.nm_adic_guia_medico
	from	pls_prestador x
	where	(x.cd_pessoa_fisica IS NOT NULL AND x.cd_pessoa_fisica::text <> '')
	and	coalesce(x.nm_busca_guia_medico::text, '') = '';

C02 CURSOR FOR
	SELECT	x.nr_sequencia,
		(SELECT	b.nm_pessoa_fisica
		from	pessoa_fisica b
		where 	b.cd_pessoa_fisica 	 = x.cd_medico) nm_medico,
		(select	c.nm_guerra
		FROM medico c
LEFT OUTER JOIN pessoa_fisica b ON (c.cd_pessoa_fisica = b.cd_pessoa_fisica)
WHERE b.cd_pessoa_fisica 	= x.cd_medico ) nm_guerra
	from	pls_prestador_medico x
	where	coalesce(nm_busca_guia_medico::text, '') = '';
BEGIN

for r_c01_w in c01 loop
	begin
	nm_medico_ou_prestador_w	:= pls_obter_nome_busca_guia(	r_c01_w.ie_prefixo_guia_medico,
									r_c01_w.nm_prestador,
									r_c01_w.nm_usual,
									r_c01_w.nm_interno,
									r_c01_w.nm_adic_guia_medico);

	update	pls_prestador
	set	nm_busca_guia_medico	= nm_medico_ou_prestador_w
	where	nr_sequencia	= r_c01_w.nr_sequencia;
	end;
end loop;

for r_c02_w in c02 loop
	begin
		nm_medico_ou_prestador_w	:= pls_obter_nome_busca_guia(	null,
										r_c02_w.nm_medico,
										r_c02_w.nm_guerra,
										null,
										null);
		update	pls_prestador_medico
		set	nm_busca_guia_medico	= nm_medico_ou_prestador_w
		where	nr_sequencia		= r_c02_w.nr_sequencia;

	end;
end loop;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_baca_atual_nm_busca_guia () FROM PUBLIC;

