-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';



CREATE TYPE tabela_pls_guia_plano AS ( 
	nr_sequencia			pls_util_cta_pck.t_number_table, 
	cd_ans_imp           pls_util_cta_pck.t_varchar2_table_20, 
	cd_cbo_saude_imp        pls_util_cta_pck.t_varchar2_table_50, 
	cd_cgc_solicitado_imp      pls_util_cta_pck.t_varchar2_table_15, 
	cd_cgc_prestador_imp      	pls_util_cta_pck.t_varchar2_table_15, 
	cd_cnes_imp           pls_util_cta_pck.t_varchar2_table_50, 
	nr_cartao_nac_sus_imp		pls_util_cta_pck.t_varchar2_table_50, 
	cd_conselho_prof_solic		pls_util_cta_pck.t_varchar2_table_2, 
	nr_conselho_prof_solic		pls_util_cta_pck.t_varchar2_table_15, 
	cd_cpf_prestador_imp      pls_util_cta_pck.t_varchar2_table_15, 
	cd_guia_prestador        pls_util_cta_pck.t_varchar2_table_20, 
	cd_guia_principal_imp      pls_util_cta_pck.t_varchar2_table_20, 
	nr_seq_prestador_imp      pls_util_cta_pck.t_varchar2_table_20, 
	cd_tipo_acomodacao       pls_util_cta_pck.t_varchar2_table_2, 
	uf_crm_imp           pls_util_cta_pck.t_varchar2_table_2, 
	cd_usuario_plano_imp      pls_util_cta_pck.t_varchar2_table_50, 
	cd_versao            pls_util_cta_pck.t_varchar2_table_200, 
	ds_indicacao_clinica_imp    pls_util_cta_pck.t_varchar2_table_4000, 
	ds_observacao_imp        pls_util_cta_pck.t_varchar2_table_4000, 
	dt_atualizacao         	pls_util_cta_pck.t_date_table, 
	dt_atualizacao_nrec       pls_util_cta_pck.t_date_table, 
	dt_importacao			pls_util_cta_pck.t_date_table,	 
	dt_solicitacao_imp       pls_util_cta_pck.t_date_table, 
	dt_internacao_imp        pls_util_cta_pck.t_date_table, 
	ie_anexo_guia          pls_util_cta_pck.t_varchar2_table_1, 
	ie_carater_internacao_imp    pls_util_cta_pck.t_varchar2_table_1, 
	ie_indicacao_opme_imp      pls_util_cta_pck.t_varchar2_table_1, 
	ie_indicacao_quimio_imp     pls_util_cta_pck.t_varchar2_table_1, 
	ie_recem_nascido_imp      pls_util_cta_pck.t_varchar2_table_1, 
	ie_regime_internacao_imp    pls_util_cta_pck.t_varchar2_table_1, 
	ie_status            pls_util_cta_pck.t_varchar2_table_1, 
	ie_tipo_guia          pls_util_cta_pck.t_varchar2_table_1, 
	ie_tipo_intercambio       pls_util_cta_pck.t_varchar2_table_15, 
	nm_segurado_imp         pls_util_cta_pck.t_varchar2_table_255, 
	nm_prestador_imp        pls_util_cta_pck.t_varchar2_table_255, 
	nm_medico_solicitante_imp    pls_util_cta_pck.t_varchar2_table_255, 
	nm_usuario           pls_util_cta_pck.t_varchar2_table_15, 
	nm_usuario_nrec         pls_util_cta_pck.t_varchar2_table_15, 
	qt_dia_autorizado_imp      pls_util_cta_pck.t_varchar2_table_5 
);
CREATE TYPE tabela_pls_diagnostico AS ( 
	nr_sequencia			pls_util_cta_pck.t_number_table, 
	cd_doenca_imp          pls_util_cta_pck.t_varchar2_table_15, 
	dt_atualizacao         	pls_util_cta_pck.t_date_table, 
	dt_atualizacao_nrec       pls_util_cta_pck.t_date_table, 
	ie_indicacao_acidente_imp    pls_util_cta_pck.t_varchar2_table_1, 
	nm_usuario           	pls_util_cta_pck.t_varchar2_table_15, 
	nm_usuario_nrec         pls_util_cta_pck.t_varchar2_table_15, 
	nr_seq_guia_plano_imp     	pls_util_cta_pck.t_number_table 
);
CREATE TYPE tabela_pls_guia_glosa AS ( 
	nr_sequencia			pls_util_cta_pck.t_number_table, 
	ds_motivo_glosa			pls_util_cta_pck.t_varchar2_table_255,				 
	dt_atualizacao         	pls_util_cta_pck.t_date_table, 
	dt_atualizacao_nrec       pls_util_cta_pck.t_date_table, 
	nm_usuario           	pls_util_cta_pck.t_varchar2_table_15, 
	nm_usuario_nrec         pls_util_cta_pck.t_varchar2_table_15, 
	nr_seq_guia_plano_imp      pls_util_cta_pck.t_number_table, 
	nr_seq_motivo_glosa      	pls_util_cta_pck.t_number_table, 
	ds_observacao			pls_util_cta_pck.t_varchar2_table_4000 
);


CREATE OR REPLACE PROCEDURE pls_baca_autorizacao_imp () AS $body$
DECLARE

 
nr_seq_guia_proc_imp_w		pls_guia_plano_proc_imp.nr_sequencia%type;
nr_seq_guia_mat_imp_w		pls_guia_plano_mat_imp.nr_sequencia%type;

qt_reg_commit_w	integer := 2000;

tb_pls_guia_plano_w tabela_pls_guia_plano;

tb_pls_diagnostico_w	tabela_pls_diagnostico;

tb_pls_guia_glosa_w	tabela_pls_guia_glosa;	
 
--Busca os registros para inserir na tabela pls_guia_plano_imp 
c01 CURSOR FOR 
	SELECT	a.nr_sequencia,			 
		a.cd_ans_imp,  
	    substr(a.cd_cbo_saude_imp,1,6) cd_cbo_saude_imp,         
	    a.cd_cgc_solicitado_imp,      
	    a.cd_cgc_prestador_imp,      	 
	    substr(a.cd_cnes_imp,1,7) cd_cnes_imp,            
	    substr(a.nr_cartao_nac_sus_imp,1,15) nr_cartao_nac_sus_imp,		 
	    substr(a.ds_conselho_profissional_imp,1,2) cd_conselho_prof_solic, 
	    substr(a.ds_conselho_profissional_imp,1,15) nr_conselho_prof_solic,		 
	    substr(a.cd_cpf_prestador_imp,1,11) cd_cpf_prestador_imp,  
	    a.cd_guia_prestador,        
	    a.cd_guia_principal_imp, 
	    substr(a.nr_seq_prestador_imp,1,14) nr_seq_prestador_imp, 
	    a.cd_tipo_acomodacao, 
	    a.uf_crm_imp,           
	    substr(a.cd_usuario_plano_imp,1,20) cd_usuario_plano_imp, 
	    a.cd_versao,            
	    substr(a.ds_indicacao_clinica_imp,1, 500) ds_indicacao_clinica_imp,  
	    substr(a.ds_observacao_imp,1,1000) ds_observacao_imp, 
	    a.dt_atualizacao,         	 
	    a.dt_atualizacao_nrec, 
		coalesce(a.dt_atualizacao_nrec, a.dt_atualizacao) dt_importacao, 
	    a.dt_solicitacao_imp,        
	    a.dt_internacao_imp,        
	    a.ie_anexo_guia,          
	    a.ie_carater_internacao_imp,    
	    a.ie_indicacao_opme_imp,      
	    a.ie_indicacao_quimio_imp,     
	    a.ie_recem_nascido_imp,       
	    a.ie_regime_internacao_imp,     
	    a.ie_status,            
	    a.ie_tipo_guia,           
	    substr(a.ie_tipo_intercambio,1,2) ie_tipo_intercambio, 
	    substr(a.nm_segurado_imp,1,70) nm_segurado_imp,  
	    substr(a.nm_prestador_imp,1,70) nm_prestador_imp, 
	    substr(a.nm_medico_solicitante_imp,1,70) nm_medico_solicitante_imp, 
	    a.nm_usuario,            
	    'TASY_IMP' nm_usuario_nrec,         
	    (a.qt_dia_autorizado_imp)::numeric  qt_dia_autorizado_imp   
	from	pls_guia_plano a 
	where	not exists (	SELECT	1 
				from	pls_guia_plano_imp b 
				where	b.nr_seq_guia_plano = a.nr_sequencia) 
	and	a.ie_tipo_processo = 'E' 
	and	a.ie_origem_solic = 'E';

--Busca os registros para inserir na tabela pls_guia_plano_proc_imp	 
C02 CURSOR FOR	 
	SELECT	b.nr_sequencia nr_seq_guia_plano_proc,     
		substr(b.cd_procedimento_imp,1,10) cd_procedimento_imp,  
		substr(b.cd_tipo_tabela_imp,1,2) cd_tipo_tabela_imp,   
		substr(b.ds_procedimento_imp,1,150) ds_procedimento_imp,  
		b.dt_atualizacao,    
		b.dt_atualizacao_nrec,  
		b.nm_usuario,      
		'TASY_IMP' nm_usuario_nrec,    
		a.nr_sequencia nr_seq_guia_plano_imp,      
		b.qt_solicitada_imp 
	from	pls_guia_plano_imp a, 
		pls_guia_plano_proc b 
	where	a.nr_seq_guia_plano = b.nr_seq_guia 
	and	a.nm_usuario_nrec = 'TASY_IMP';

--Busca os registros para inserir na tabela pls_guia_plano_glosa_imp 
C03 CURSOR( 	nr_seq_proc_pc 		pls_guia_plano_proc.nr_sequencia%type, 
		nr_seq_mat_pc		pls_guia_plano_mat.nr_sequencia%type) FOR 
		 
	SELECT	a.nr_sequencia, 
		substr(tiss_obter_motivo_glosa(a.nr_seq_motivo_glosa,'D'),1,255) ds_motivo_glosa, 
		a.dt_atualizacao,   
		a.dt_atualizacao_nrec, 
		a.nm_usuario,     
		'TASY_IMP' nm_usuario_nrec, 
		a.nr_seq_motivo_glosa, 
		a.ds_observacao 
	from	pls_guia_glosa a 
	where	a.nr_seq_guia_proc	= nr_seq_proc_pc 
	and	coalesce(a.ie_origem::text, '') = '' 
	
union
 
	SELECT	a.nr_sequencia, 
		substr(tiss_obter_motivo_glosa(a.nr_seq_motivo_glosa,'D'),1,255) ds_motivo_glosa, 
		a.dt_atualizacao,   
		a.dt_atualizacao_nrec, 
		a.nm_usuario,     
		'TASY_IMP' nm_usuario_nrec, 
		a.nr_seq_motivo_glosa, 
		a.ds_observacao 
	from	pls_guia_glosa a 
	where	a.nr_seq_guia_mat	= nr_seq_mat_pc 
	and	coalesce(a.ie_origem::text, '') = '';

--Busca os registros para inserir na tabela pls_guia_plano_diag_imp	 
C04 CURSOR FOR 
	SELECT	b.nr_sequencia, 
		b.cd_doenca_imp,       
		b.dt_atualizacao,      
		b.dt_atualizacao_nrec,    
		b.ie_indicacao_acidente_imp, 
		b.nm_usuario,        
		'TASY_IMP' nm_usuario_nrec,      
		a.nr_sequencia nr_seq_guia_plano_imp 
	from	pls_guia_plano_imp a, 
		pls_diagnostico b 
	where	a.nr_seq_guia_plano = b.nr_seq_guia 
	and	a.nm_usuario_nrec = 'TASY_IMP';

--Busca os registros para inserir na tabela pls_guia_plano_mat_imp	 
C05 CURSOR FOR 
	SELECT	b.nr_sequencia nr_seq_guia_plano_mat, 
		substr(b.cd_material_imp,1,10) cd_material_imp, 
		substr(b.cd_tipo_tabela_imp,1,2) cd_tipo_tabela_imp,    
		substr(b.ds_material_imp,1,150) ds_material_imp, 
		b.dt_atualizacao,      
		b.dt_atualizacao_nrec,   
		b.nm_usuario,   
		'TASY_IMP' nm_usuario_nrec, 
		a.nr_sequencia nr_seq_guia_plano_imp,     
		b.qt_solicitada_imp 
	from	pls_guia_plano_imp a, 
		pls_guia_plano_mat b 
	where	b.nr_seq_guia 		= a.nr_seq_guia_plano 
	and	a.nm_usuario_nrec 	= 'TASY_IMP';

--Insere na pls_guia_plano_glosa_imp os registros que não contem nr_seq_guia_proc e nr_seq_guia_mat.	 
C06 CURSOR FOR 
	SELECT	a.nr_sequencia, 
		substr(tiss_obter_motivo_glosa(a.nr_seq_motivo_glosa,'D'),1,255) ds_motivo_glosa, 
		a.dt_atualizacao,   
		a.dt_atualizacao_nrec, 
		a.nm_usuario,     
		'TASY_IMP' nm_usuario_nrec, 
		b.nr_sequencia nr_seq_guia_plano_imp, 
		a.nr_seq_motivo_glosa, 
		a.ds_observacao 
	from	pls_guia_glosa a, 
		pls_guia_plano_imp b 
	where 	a.nr_seq_guia = b.nr_seq_guia_plano 
	and	coalesce(a.nr_seq_guia_proc::text, '') = '' 
	and	coalesce(a.nr_seq_guia_mat::text, '') = '' 
	and	coalesce(a.ie_origem::text, '') = '' 
	and	a.nm_usuario_nrec = 'TASY_IMP';
	
BEGIN 
-- Insert na tabela pls_guia_plano_imp 
open c01;
loop 
--Limpa a tabela depois de inserir os registros para carregar novo registro 
if (tb_pls_guia_plano_w.nr_sequencia.count > 0) then 
	tb_pls_guia_plano_w.nr_sequencia.delete;			
	tb_pls_guia_plano_w.cd_ans_imp.delete;	
	tb_pls_guia_plano_w.cd_cbo_saude_imp.delete;
	tb_pls_guia_plano_w.cd_cgc_solicitado_imp.delete;
	tb_pls_guia_plano_w.cd_cgc_prestador_imp.delete;
	tb_pls_guia_plano_w.cd_cnes_imp.delete;
	tb_pls_guia_plano_w.nr_cartao_nac_sus_imp.delete;		
	tb_pls_guia_plano_w.cd_conselho_prof_solic.delete;
	tb_pls_guia_plano_w.nr_conselho_prof_solic.delete;
	tb_pls_guia_plano_w.cd_cpf_prestador_imp.delete;
	tb_pls_guia_plano_w.cd_guia_prestador.delete;
	tb_pls_guia_plano_w.cd_guia_principal_imp.delete;
	tb_pls_guia_plano_w.nr_seq_prestador_imp.delete;
	tb_pls_guia_plano_w.cd_tipo_acomodacao.delete;
	tb_pls_guia_plano_w.uf_crm_imp.delete;
	tb_pls_guia_plano_w.cd_usuario_plano_imp.delete;
	tb_pls_guia_plano_w.cd_versao.delete;
	tb_pls_guia_plano_w.ds_indicacao_clinica_imp.delete;
	tb_pls_guia_plano_w.ds_observacao_imp.delete;
	tb_pls_guia_plano_w.dt_atualizacao.delete;        	
	tb_pls_guia_plano_w.dt_atualizacao_nrec.delete;
	tb_pls_guia_plano_w.dt_importacao.delete;
	tb_pls_guia_plano_w.dt_solicitacao_imp.delete;
	tb_pls_guia_plano_w.dt_internacao_imp.delete;
	tb_pls_guia_plano_w.ie_anexo_guia.delete;
	tb_pls_guia_plano_w.ie_carater_internacao_imp.delete;
	tb_pls_guia_plano_w.ie_indicacao_opme_imp.delete;
	tb_pls_guia_plano_w.ie_indicacao_quimio_imp.delete;
	tb_pls_guia_plano_w.ie_recem_nascido_imp.delete;
	tb_pls_guia_plano_w.ie_regime_internacao_imp.delete;
	tb_pls_guia_plano_w.ie_status.delete;
	tb_pls_guia_plano_w.ie_tipo_guia.delete;
	tb_pls_guia_plano_w.ie_tipo_intercambio.delete;
	tb_pls_guia_plano_w.nm_segurado_imp.delete;
	tb_pls_guia_plano_w.nm_prestador_imp.delete;
	tb_pls_guia_plano_w.nm_medico_solicitante_imp.delete;
	tb_pls_guia_plano_w.nm_usuario.delete;
	tb_pls_guia_plano_w.nm_usuario_nrec.delete;
	tb_pls_guia_plano_w.qt_dia_autorizado_imp.delete; 	
end if;
 
fetch c01 bulk collect	into	 
	tb_pls_guia_plano_w.nr_sequencia, tb_pls_guia_plano_w.cd_ans_imp, tb_pls_guia_plano_w.cd_cbo_saude_imp, 
	tb_pls_guia_plano_w.cd_cgc_solicitado_imp, tb_pls_guia_plano_w.cd_cgc_prestador_imp, tb_pls_guia_plano_w.cd_cnes_imp,      
	tb_pls_guia_plano_w.nr_cartao_nac_sus_imp, tb_pls_guia_plano_w.cd_conselho_prof_solic, tb_pls_guia_plano_w.nr_conselho_prof_solic, tb_pls_guia_plano_w.cd_cpf_prestador_imp,       
	tb_pls_guia_plano_w.cd_guia_prestador, tb_pls_guia_plano_w.cd_guia_principal_imp, tb_pls_guia_plano_w.nr_seq_prestador_imp,       
	tb_pls_guia_plano_w.cd_tipo_acomodacao, tb_pls_guia_plano_w.uf_crm_imp, tb_pls_guia_plano_w.cd_usuario_plano_imp,       
	tb_pls_guia_plano_w.cd_versao, tb_pls_guia_plano_w.ds_indicacao_clinica_imp, tb_pls_guia_plano_w.ds_observacao_imp,        
	tb_pls_guia_plano_w.dt_atualizacao, tb_pls_guia_plano_w.dt_atualizacao_nrec, tb_pls_guia_plano_w.dt_importacao,	 
	tb_pls_guia_plano_w.dt_solicitacao_imp, tb_pls_guia_plano_w.dt_internacao_imp, tb_pls_guia_plano_w.ie_anexo_guia,          
	tb_pls_guia_plano_w.ie_carater_internacao_imp, tb_pls_guia_plano_w.ie_indicacao_opme_imp, tb_pls_guia_plano_w.ie_indicacao_quimio_imp,     
	tb_pls_guia_plano_w.ie_recem_nascido_imp, tb_pls_guia_plano_w.ie_regime_internacao_imp, tb_pls_guia_plano_w.ie_status,            
	tb_pls_guia_plano_w.ie_tipo_guia, tb_pls_guia_plano_w.ie_tipo_intercambio, tb_pls_guia_plano_w.nm_segurado_imp,         
	tb_pls_guia_plano_w.nm_prestador_imp, tb_pls_guia_plano_w.nm_medico_solicitante_imp, tb_pls_guia_plano_w.nm_usuario,            
	tb_pls_guia_plano_w.nm_usuario_nrec, tb_pls_guia_plano_w.qt_dia_autorizado_imp 
limit	qt_reg_commit_w;
	 
exit when tb_pls_guia_plano_w.nr_sequencia.count = 0;
	 
	forall i in tb_pls_guia_plano_w.nr_sequencia.first..tb_pls_guia_plano_w.nr_sequencia.last 
 
		insert into pls_guia_plano_imp(nr_sequencia, cd_ans, cd_cbo_saude, cd_cgc_prest_exec,      
		cd_cgc_prest_solic, cd_cnes_prest_exec, cd_cns,       
		cd_conselho_prof_solic, cd_cpf_prest_solic, cd_guia_prestador,      
		cd_guia_principal, cd_prestador_exec, cd_prestador_solic,      
		cd_tipo_acomodacao, cd_uf_conselho_prof_solic, cd_usuario_plano,       
		cd_versao, ds_indicacao_clinica, ds_observacao, 
		dt_atualizacao, dt_atualizacao_nrec, dt_importacao,        
		dt_solicitacao, dt_sugerida_internacao, ie_anexo_guia,        
		ie_carater_atendimento, ie_indicacao_opm, ie_indicacao_quimio,     
		ie_recem_nascido, ie_regime_internacao, ie_status,          
		ie_tipo_guia, ie_tipo_internacao, nm_beneficiario,       
		nm_prestador_exec, nm_prestador_solic, nm_profissional_solic,    
		nm_usuario, nm_usuario_nrec, nr_conselho_prof_solic,    
		nr_seq_guia_plano, nr_seq_requisicao, qt_diaria_solic) 
	values (nextval('pls_guia_plano_imp_seq'),			 
		tb_pls_guia_plano_w.cd_ans_imp(i), tb_pls_guia_plano_w.cd_cbo_saude_imp(i), tb_pls_guia_plano_w.cd_cgc_solicitado_imp(i), 
		tb_pls_guia_plano_w.cd_cgc_prestador_imp(i), tb_pls_guia_plano_w.cd_cnes_imp(i), tb_pls_guia_plano_w.nr_cartao_nac_sus_imp(i), 
		tb_pls_guia_plano_w.cd_conselho_prof_solic(i), tb_pls_guia_plano_w.cd_cpf_prestador_imp(i), tb_pls_guia_plano_w.cd_guia_prestador(i),        
		tb_pls_guia_plano_w.cd_guia_principal_imp(i), tb_pls_guia_plano_w.nr_seq_prestador_imp(i), tb_pls_guia_plano_w.nr_seq_prestador_imp(i),       
		tb_pls_guia_plano_w.cd_tipo_acomodacao(i),tb_pls_guia_plano_w.uf_crm_imp(i), tb_pls_guia_plano_w.cd_usuario_plano_imp(i),       
		tb_pls_guia_plano_w.cd_versao(i), tb_pls_guia_plano_w.ds_indicacao_clinica_imp(i), tb_pls_guia_plano_w.ds_observacao_imp(i),        
		tb_pls_guia_plano_w.dt_atualizacao(i), tb_pls_guia_plano_w.dt_atualizacao_nrec(i), tb_pls_guia_plano_w.dt_importacao(i),	 
		tb_pls_guia_plano_w.dt_solicitacao_imp(i), tb_pls_guia_plano_w.dt_internacao_imp(i), tb_pls_guia_plano_w.ie_anexo_guia(i),          
		tb_pls_guia_plano_w.ie_carater_internacao_imp(i), tb_pls_guia_plano_w.ie_indicacao_opme_imp(i), tb_pls_guia_plano_w.ie_indicacao_quimio_imp(i),     
		tb_pls_guia_plano_w.ie_recem_nascido_imp(i), tb_pls_guia_plano_w.ie_regime_internacao_imp(i), tb_pls_guia_plano_w.ie_status(i),            
		tb_pls_guia_plano_w.ie_tipo_guia(i), tb_pls_guia_plano_w.ie_tipo_intercambio(i), tb_pls_guia_plano_w.nm_segurado_imp(i),         
		tb_pls_guia_plano_w.nm_prestador_imp(i), tb_pls_guia_plano_w.nm_prestador_imp(i), tb_pls_guia_plano_w.nm_medico_solicitante_imp(i),    
		tb_pls_guia_plano_w.nm_usuario(i), tb_pls_guia_plano_w.nm_usuario_nrec(i), tb_pls_guia_plano_w.nr_conselho_prof_solic(i), 
		tb_pls_guia_plano_w.nr_sequencia(i), null, tb_pls_guia_plano_w.qt_dia_autorizado_imp(i));
	commit;
end loop;
close c01;
 
--Insere na tabela pls_guia_plano_proc_imp e já insere os valores da tabela pls_guia_glosa e a sequencia da pls_guia_plano_proc_imp na tabela pls_guia_plano_glosa_imp 
for r_C02 in C02 loop 
	insert into pls_guia_plano_proc_imp(nr_sequencia, cd_procedimento, cd_tabela,       
		ds_procedimento, dt_atualizacao, dt_atualizacao_nrec,  
		nm_usuario, nm_usuario_nrec, nr_seq_guia_plano_imp, 
		qt_solicitada) 
	values (nextval('pls_guia_plano_proc_imp_seq'), 
		r_C02.cd_procedimento_imp, r_C02.cd_tipo_tabela_imp, r_C02.ds_procedimento_imp, 
		r_C02.dt_atualizacao, r_C02.dt_atualizacao_nrec, r_C02.nm_usuario, 
		r_C02.nm_usuario_nrec, r_C02.nr_seq_guia_plano_imp, r_C02.qt_solicitada_imp) 
	returning nr_sequencia into nr_seq_guia_proc_imp_w;
	commit;
		 
	for r_C03 in C03(r_C02.nr_seq_guia_plano_proc, null) loop 
		insert into pls_guia_plano_glosa_imp(nr_sequencia, ds_motivo_glosa,	dt_atualizacao, 
			dt_atualizacao_nrec, nm_usuario, nm_usuario_nrec, 
			nr_seq_guia_plano_imp, nr_seq_guia_plano_mat_imp, 
			nr_seq_guia_plano_proc_imp, nr_seq_motivo_glosa, ds_observacao) 
		values (nextval('pls_guia_plano_glosa_imp_seq'), 
			r_C03.ds_motivo_glosa, r_C03.dt_atualizacao, r_C03.dt_atualizacao_nrec, 
			r_C03.nm_usuario, r_C03.nm_usuario_nrec, r_C02.nr_seq_guia_plano_imp,       
			null, nr_seq_guia_proc_imp_w, r_C03.nr_seq_motivo_glosa, 
			r_C03.ds_observacao);
		commit;
	end loop;
end loop;
 
--Insert na tabela pls_guia_plano_diag_imp 
open c04;
loop 
--Limpa a tabela depois de inserir os registros para carregar novo registro 
if (tb_pls_diagnostico_w.nr_sequencia.count > 0) then 
	tb_pls_diagnostico_w.nr_sequencia.delete;			
	tb_pls_diagnostico_w.cd_doenca_imp.delete;
	tb_pls_diagnostico_w.dt_atualizacao.delete;         	
	tb_pls_diagnostico_w.dt_atualizacao_nrec.delete;
	tb_pls_diagnostico_w.ie_indicacao_acidente_imp.delete;
	tb_pls_diagnostico_w.nm_usuario.delete;           	
	tb_pls_diagnostico_w.nm_usuario_nrec.delete;
	tb_pls_diagnostico_w.nr_seq_guia_plano_imp.delete;          	
end if;
 
fetch c04 bulk collect	into 
	tb_pls_diagnostico_w.nr_sequencia, tb_pls_diagnostico_w.cd_doenca_imp, tb_pls_diagnostico_w.dt_atualizacao,         	 
	tb_pls_diagnostico_w.dt_atualizacao_nrec, tb_pls_diagnostico_w.ie_indicacao_acidente_imp, tb_pls_diagnostico_w.nm_usuario,           	 
	tb_pls_diagnostico_w.nm_usuario_nrec, tb_pls_diagnostico_w.nr_seq_guia_plano_imp	 
limit	qt_reg_commit_w;
	 
exit when tb_pls_diagnostico_w.nr_sequencia.count = 0;
	 
	forall i in tb_pls_diagnostico_w.nr_sequencia.first .. tb_pls_diagnostico_w.nr_sequencia.last 
		 
	insert into pls_guia_plano_diag_imp(nr_sequencia, cd_doenca, dt_atualizacao, 
		dt_atualizacao_nrec, ie_indicador_acidente, nm_usuario, 
		nm_usuario_nrec, nr_seq_guia_plano_imp) 
	values (nextval('pls_guia_plano_diag_imp_seq'), 
		tb_pls_diagnostico_w.cd_doenca_imp(i), tb_pls_diagnostico_w.dt_atualizacao(i), tb_pls_diagnostico_w.dt_atualizacao_nrec(i),       
		tb_pls_diagnostico_w.ie_indicacao_acidente_imp(i), tb_pls_diagnostico_w.nm_usuario(i), tb_pls_diagnostico_w.nm_usuario_nrec(i),         
		tb_pls_diagnostico_w.nr_seq_guia_plano_imp(i));
	commit;
end loop;
close c04;
 
--Insere valores na tabela pls_guia_plano_mat_imp e já insere na tabela pls_guia_plano_glosa_imp os valores da pls_guia_glosa e a sequencia da pls_guia_plano_mat_imp 
for r_C05 in C05 loop 
	insert into pls_guia_plano_mat_imp(nr_sequencia, cd_material, cd_tabela,       
		ds_material, dt_atualizacao, dt_atualizacao_nrec,  
		nm_usuario, nm_usuario_nrec, nr_seq_guia_plano_imp, 
		qt_solicitada) 
	values (nextval('pls_guia_plano_mat_imp_seq'),     
		r_C05.cd_material_imp, r_C05.cd_tipo_tabela_imp, r_C05.ds_material_imp, 
		r_C05.dt_atualizacao, r_C05.dt_atualizacao_nrec, r_C05.nm_usuario, 
		r_C05.nm_usuario_nrec, r_C05.nr_seq_guia_plano_imp, r_C05.qt_solicitada_imp) 
	returning nr_sequencia into nr_seq_guia_mat_imp_w;
	commit;
 
	for r_C03 in C03(null, r_C05.nr_seq_guia_plano_mat) loop 
		insert into pls_guia_plano_glosa_imp(nr_sequencia, ds_motivo_glosa, dt_atualizacao, 
			dt_atualizacao_nrec, nm_usuario, nm_usuario_nrec, 
			nr_seq_guia_plano_imp, nr_seq_guia_plano_mat_imp, nr_seq_guia_plano_proc_imp, 
			nr_seq_motivo_glosa, ds_observacao) 
		values (nextval('pls_guia_plano_glosa_imp_seq'), 
			r_C03.ds_motivo_glosa, r_C03.dt_atualizacao, r_C03.dt_atualizacao_nrec, 
			r_C03.nm_usuario, r_C03.nm_usuario_nrec, r_C05.nr_seq_guia_plano_imp,       
			nr_seq_guia_mat_imp_w, null, r_C03.nr_seq_motivo_glosa, 
			r_C03.ds_observacao);
		commit;
	end loop;
end loop;
 
--Insert na tabela pls_guia_plano-glosa_imp 
open c06;
loop 
--Limpa a tabela depois de inserir os registros para carregar novo registro 
if (tb_pls_guia_glosa_w.nr_sequencia.count > 0) then 
	tb_pls_guia_glosa_w.nr_sequencia.delete;		
	tb_pls_guia_glosa_w.ds_motivo_glosa.delete;		
	tb_pls_guia_glosa_w.dt_atualizacao.delete;
	tb_pls_guia_glosa_w.dt_atualizacao_nrec.delete;
	tb_pls_guia_glosa_w.nm_usuario.delete;
	tb_pls_guia_glosa_w.nm_usuario_nrec.delete;
	tb_pls_guia_glosa_w.nr_seq_guia_plano_imp.delete;
    tb_pls_guia_glosa_w.nr_seq_motivo_glosa.delete;
	tb_pls_guia_glosa_w.ds_observacao.delete;
end if;
 
fetch c06 bulk collect	into 
	tb_pls_guia_glosa_w.nr_sequencia, tb_pls_guia_glosa_w.ds_motivo_glosa, tb_pls_guia_glosa_w.dt_atualizacao,      
	tb_pls_guia_glosa_w.dt_atualizacao_nrec, tb_pls_guia_glosa_w.nm_usuario, tb_pls_guia_glosa_w.nm_usuario_nrec,     
	tb_pls_guia_glosa_w.nr_seq_guia_plano_imp, tb_pls_guia_glosa_w.nr_seq_motivo_glosa, tb_pls_guia_glosa_w.ds_observacao 
limit	qt_reg_commit_w;
	 
exit when tb_pls_guia_glosa_w.nr_sequencia.count = 0;
	 
	forall i in tb_pls_guia_glosa_w.nr_sequencia.first .. tb_pls_guia_glosa_w.nr_sequencia.last 
		 
	insert into pls_guia_plano_glosa_imp(nr_sequencia, ds_motivo_glosa, dt_atualizacao, 
		dt_atualizacao_nrec, nm_usuario, nm_usuario_nrec, 
		nr_seq_guia_plano_imp, nr_seq_guia_plano_mat_imp, nr_seq_guia_plano_proc_imp, 
		nr_seq_motivo_glosa, ds_observacao) 
	values (nextval('pls_guia_plano_glosa_imp_seq'), 
		tb_pls_guia_glosa_w.ds_motivo_glosa(i), tb_pls_guia_glosa_w.dt_atualizacao(i), tb_pls_guia_glosa_w.dt_atualizacao_nrec(i),   
		tb_pls_guia_glosa_w.nm_usuario(i), tb_pls_guia_glosa_w.nm_usuario_nrec(i), tb_pls_guia_glosa_w.nr_seq_guia_plano_imp(i),       
		null, null, tb_pls_guia_glosa_w.nr_seq_motivo_glosa(i), 
		tb_pls_guia_glosa_w.ds_observacao(i));
	commit;
end loop;
close c06;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_baca_autorizacao_imp () FROM PUBLIC;

