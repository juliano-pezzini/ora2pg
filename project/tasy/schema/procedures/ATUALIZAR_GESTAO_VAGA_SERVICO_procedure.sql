-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_gestao_vaga_servico (nr_seq_agenda_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
					 
cd_medico_w		  	varchar(10);
cd_tipo_acomodacao_w		smallint;
cd_procedimento_w		bigint;
cd_convenio_w			integer;
cd_categoria_w			varchar(10);
cd_plano_w			varchar(10);
cd_usuario_convenio_w		varchar(30);
dt_validade_carteira_w		timestamp;
dt_agenda_w			timestamp;
qt_diaria_prev_w		smallint;
cd_pessoa_fisica_w		varchar(10);
nm_paciente_w			varchar(255);
nr_telefone_w			varchar(255);
nr_seq_gestao_vaga_w		bigint := 0;				
					 

BEGIN 
 
begin 
select 	distinct 
	a.cd_medico, 
	a.cd_tipo_acomodacao, 
	a.cd_procedimento, 
	a.cd_convenio, 
	a.cd_categoria, 
	a.cd_plano, 
	a.cd_usuario_convenio, 
	a.dt_validade_carteira, 
	a.dt_agenda, 
	a.qt_diaria_prev, 
	a.cd_pessoa_fisica, 
	a.nm_paciente, 
	a.nr_telefone, 
	b.nr_sequencia 
into STRICT	cd_medico_w, 
	cd_tipo_acomodacao_w, 
	cd_procedimento_w, 
	cd_convenio_w, 
	cd_categoria_w, 
	cd_plano_w, 
	cd_usuario_convenio_w, 
	dt_validade_carteira_w, 
	dt_agenda_w, 
	qt_diaria_prev_w, 
	cd_pessoa_fisica_w, 
	nm_paciente_w, 
	nr_telefone_w, 
	nr_seq_gestao_vaga_w 
from 	agenda_consulta a, 
	gestao_vaga b 
where 	a.nr_sequencia 	= b.nr_seq_agenda 
and a.nr_sequencia 	= nr_seq_agenda_p;
exception 
when others then 
	nr_seq_gestao_vaga_w	:= 0;
end;
 
if (nr_seq_gestao_vaga_w > 0) then 
	update 	gestao_vaga 
	set	cd_medico			= cd_medico_w, 
		cd_tipo_acomod_atual		= cd_tipo_acomodacao_w, 
		cd_procedimento			= cd_procedimento_w, 
		cd_convenio			= coalesce(cd_convenio_w,cd_convenio), 
		cd_categoria			= coalesce(cd_categoria_w,cd_categoria), 
		cd_plano_convenio		= coalesce(cd_plano_w,cd_plano_convenio), 
		ds_cod_usuario			= coalesce(cd_usuario_convenio_w, ds_cod_usuario), 
		dt_validade			= dt_validade_carteira_w, 
		dt_prevista			= dt_agenda_w,	 
		qt_dia				= qt_diaria_prev_w, 
		cd_pessoa_fisica 		= cd_pessoa_fisica_w, 
		nm_paciente 			= nm_paciente_w, 
		nr_telefone 			= nr_telefone_w 
	where	nr_sequencia			= nr_seq_gestao_vaga_w;
end if;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_gestao_vaga_servico (nr_seq_agenda_p bigint, nm_usuario_p text) FROM PUBLIC;

