-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE kill_session_java (nm_usuario_p text) AS $body$
DECLARE


sid_w				gv$session.sid%type;
serial_w			gv$session.serial#%type;

sessions CURSOR FOR
	SELECT gv.sid, gv.serial#
	from gv$session gv
	where program = 'Tasy JAVA'
	and coalesce(substr(gv.client_info,regexp_instr(gv.client_info,'=')+1,regexp_instr(gv.client_info,';')-(regexp_instr(gv.client_info,'=')+1)),gv.client_info) = nm_usuario_p;


BEGIN

open sessions;
loop
	fetch sessions into
			sid_w,
			serial_w;
	EXIT WHEN NOT FOUND; /* apply on sessions */
    	begin
        	CALL tasy_kill_session(sid_w, serial_w);
    	exception
		when no_data_found then
               		null;
    		when others then
        		CALL gravar_log_tasy(35, 'ERROR: '||SQLERRM, nm_usuario_p);
    	end;
end loop;
close sessions;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE kill_session_java (nm_usuario_p text) FROM PUBLIC;

