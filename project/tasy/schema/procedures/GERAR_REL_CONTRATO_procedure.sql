-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_rel_contrato ( sql_p text, nm_usuario_p text) AS $body$
DECLARE


c01			integer;
contador_w		bigint;
ds_comando_w		varchar(8000);
nr_sequencia_w		bigint;
qt_registros_w		bigint;
retorno_w			integer;
sql_w			varchar(8000);


BEGIN
delete	from w_rel_contrato
where	nm_usuario = nm_usuario_p;
commit;

/* Forma o comando select com os campos necessarios para a geracao do relatorio */

sql_w := replace(sql_p,':nm_usuario', '''' || nm_usuario_p || '''');
ds_comando_w := 'select nr_sequencia from (' || replace(sql_w,':cd_estabelecimento', wheb_usuario_pck.get_cd_estabelecimento) || ')';

c01 := dbms_sql.open_cursor;
dbms_sql.parse(c01, ds_comando_w, dbms_sql.native);
dbms_sql.define_column(c01, 1, nr_sequencia_w);
retorno_w := dbms_sql.execute(c01);

while(dbms_sql.fetch_rows(c01) > 0 ) loop
	begin
	
	dbms_sql.column_value(c01, 1, nr_sequencia_w);
	
	insert into w_rel_contrato(	nr_seq_contrato,
					nm_usuario)
			values (	nr_sequencia_w,
					nm_usuario_p);
	
	contador_w := contador_w + 1;

	if (mod(contador_w, 100) = 0) then
		commit;
	end if;

	end;
	
end loop;					

dbms_sql.close_cursor(c01);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_rel_contrato ( sql_p text, nm_usuario_p text) FROM PUBLIC;

