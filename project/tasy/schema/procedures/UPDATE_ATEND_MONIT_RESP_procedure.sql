-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE update_atend_monit_resp ( nr_seq_sinal_vital_p bigint, nm_campo_tabela_p text, nr_valor_p text ) AS $body$
DECLARE



c001				integer;

retorno_w			integer;
ds_sql_w			varchar(500);
qt_atendimento_monit_resp_w	bigint;
nr_seq_atend_monit_resp_w 	bigint;

ie_valor_executa_w		varchar(1);


BEGIN


select	count(*)
into STRICT	qt_atendimento_monit_resp_w
from	atendimento_monit_resp
where	nr_seq_sinal_vital 	= nr_seq_sinal_vital_p;

if (qt_atendimento_monit_resp_w > 0) then

	select	max(nr_sequencia)
	into STRICT	nr_seq_atend_monit_resp_w
	from	atendimento_monit_resp
	where	nr_seq_sinal_vital	= nr_seq_sinal_vital_p;

else

	select	nextval('atendimento_monit_resp_seq')
	into STRICT	nr_seq_atend_monit_resp_w
	;


	insert	into 	atendimento_monit_resp(
		nr_sequencia,
		nr_atendimento,
		dt_atualizacao,
		nm_usuario,
		dt_monitorizacao,
		dt_liberacao,
		nr_seq_sinal_vital
		)
		(
		SELECT 	nr_seq_atend_monit_resp_w ,
			nr_atendimento,
			dt_atualizacao,
			nm_usuario,
			dt_sinal_vital,
			dt_liberacao,
			nr_sequencia
		from	atendimento_sinal_vital
		where	nr_sequencia 	= nr_seq_sinal_vital_p
		);

end if;


ie_valor_executa_w := wheb_usuario_pck.get_ie_executar_trigger;

CALL wheb_usuario_pck.set_ie_executar_trigger('N');


C001 := DBMS_SQL.OPEN_CURSOR;
DBMS_SQL.PARSE(C001, ' update atendimento_monit_resp set  '||nm_campo_tabela_p||' = :nr_valor where nr_sequencia = :nr_seq_atendimento_monit_resp ' , dbms_sql.Native);

DBMS_SQL.BIND_VARIABLE(C001, 'nr_seq_atendimento_monit_resp', nr_seq_atend_monit_resp_w);
DBMS_SQL.BIND_VARIABLE(C001, 'nr_valor', nr_valor_p);

retorno_w := DBMS_SQL.EXECUTE(c001);
DBMS_SQL.CLOSE_CURSOR(c001);

CALL wheb_usuario_pck.set_ie_executar_trigger(ie_valor_executa_w);

commit;


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE update_atend_monit_resp ( nr_seq_sinal_vital_p bigint, nm_campo_tabela_p text, nr_valor_p text ) FROM PUBLIC;

