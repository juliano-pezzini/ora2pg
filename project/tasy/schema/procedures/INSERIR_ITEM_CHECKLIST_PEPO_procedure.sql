-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_item_checklist_pepo (nr_cirurgia_p bigint, nr_seq_item_checklist_p bigint, nm_usuario_p text, ie_excluir_item_p text default 'N') AS $body$
DECLARE


cd_profissional_w checklist_cirurgia.cd_profissional%type;
								

BEGIN

cd_profissional_w := OBTER_PESSOA_FISICA_USUARIO(nm_usuario_p, 'C');

if (nr_seq_item_checklist_p IS NOT NULL AND nr_seq_item_checklist_p::text <> '') then

		if (ie_excluir_item_p = 'S') then
			delete FROM checklist_cirurgia
			where nr_cirurgia = nr_cirurgia_p
			and	  nr_seq_item_checklist = nr_seq_item_checklist_p;
		else
			insert into checklist_cirurgia(
				nr_sequencia,
				cd_profissional,
				nr_cirurgia,
				dt_registro,
				nm_usuario,
				dt_atualizacao,
				nm_usuario_nrec,
				dt_atualizacao_nrec,
				nr_seq_item_checklist)
			values (
				nextval('checklist_cirurgia_seq'),
				cd_profissional_w,
				nr_cirurgia_p,
				clock_timestamp(),
				nm_usuario_p,
				clock_timestamp(),
				nm_usuario_p,
				clock_timestamp(),
				nr_seq_item_checklist_p);
		end if;
		
		commit;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_item_checklist_pepo (nr_cirurgia_p bigint, nr_seq_item_checklist_p bigint, nm_usuario_p text, ie_excluir_item_p text default 'N') FROM PUBLIC;

