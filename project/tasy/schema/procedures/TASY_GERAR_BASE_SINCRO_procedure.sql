-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE tasy_gerar_base_sincro () AS $body$
DECLARE


nm_tabela_w            		varchar(50)      := null;
ds_comando_w			varchar(2000);
vl_retorno_w			varchar(255);
ds_tabelas_w			varchar(2000);
ds_virgula_w			varchar(1)       := '';

C020 CURSOR FOR
SELECT
	a.nm_tabela
FROM 	tabela_sistema a
where (nr_seq_sincro IS NOT NULL AND nr_seq_sincro::text <> '')
order by nr_seq_sincro;


BEGIN
ds_virgula_w			:= '';

CALL Tasy_Excluir_Base_Sincro();

OPEN C020;
LOOP
	FETCH C020 INTO 	nm_tabela_w;
	EXIT WHEN NOT FOUND; /* apply on C020 */
		begin
		ds_comando_w	:= 'create table S_' || nm_tabela_w ||
					' as select * from ' || nm_tabela_w;
		CALL exec_sql_Dinamico(nm_tabela_w, ds_comando_w);
		ds_tabelas_w	:= ds_tabelas_w || ds_virgula_w || 'S_' ||nm_tabela_w;
		ds_virgula_w	:= ',';
		end;
END LOOP;
CLOSE C020;
ds_comando_w	:= 'exp80.exe tasy/aloisk@wheb file=expwheb.dmp ' ||
             	' log= expwheb.log buffer=4096000 recordlength=32768 ' ||
			' TABLES=' || ds_tabelas_w;
/*delete from log_tasy where cd_log = 665;
insert into log_tasy values(sysdate, 'Export', 665, ds_comando_w);*/
commit;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tasy_gerar_base_sincro () FROM PUBLIC;

