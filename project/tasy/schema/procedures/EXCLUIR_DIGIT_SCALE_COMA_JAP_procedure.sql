-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE excluir_digit_scale_coma_jap ( nr_atendimento_p atendimento_paciente.nr_atendimento%TYPE, nm_atributo_tabela_p w_apap_pac_informacao.nm_atributo_linked%TYPE, nr_seq_documento_p w_apap_pac.nr_seq_documento%TYPE, dt_registro_p w_apap_pac_registro.dt_registro%TYPE ) AS $body$
DECLARE

    nr_seq_inf_w w_apap_pac_informacao.nr_sequencia%TYPE := NULL;
    nr_seq_reg_w w_apap_pac_registro.nr_sequencia%TYPE := NULL;
    nm_usuario_w usuario.nm_usuario%TYPE := null;

BEGIN
    nm_usuario_w := wheb_usuario_pck.get_nm_usuario();

    IF (nm_atributo_tabela_p LIKE 'IE_DIGIT_GRADE%') THEN
        DELETE 
            FROM w_apap_pac_registro A 
            WHERE 
                A.nm_usuario = nm_usuario_w AND
                A.dt_registro = TRUNC(dt_registro_p, 'MI') AND 
                EXISTS (
                    SELECT 
                        1 
                    FROM w_apap_pac_informacao b        
                    INNER JOIN w_apap_pac_grupo C ON 
                        b.nr_seq_apap_grupo = C.nr_sequencia AND
                        C.nr_seq_linked_data = 563
                    INNER JOIN w_apap_pac D ON
                        D.nr_sequencia = C.nr_seq_mod_apap
                    WHERE
                        A.nr_seq_apap_inf = b.nr_sequencia AND
                        D.nr_atendimento = nr_atendimento_p AND
                        b.nm_atributo_linked LIKE 'IE_DIGIT_GRADE%' AND 
                        b.nm_atributo_linked <> nm_atributo_tabela_p AND
                        D.nr_seq_documento = nr_seq_documento_p
                );
    END IF;

    COMMIT;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE excluir_digit_scale_coma_jap ( nr_atendimento_p atendimento_paciente.nr_atendimento%TYPE, nm_atributo_tabela_p w_apap_pac_informacao.nm_atributo_linked%TYPE, nr_seq_documento_p w_apap_pac.nr_seq_documento%TYPE, dt_registro_p w_apap_pac_registro.dt_registro%TYPE ) FROM PUBLIC;

