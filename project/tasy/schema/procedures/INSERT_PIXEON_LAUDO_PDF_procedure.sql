-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_pixeon_laudo_pdf (nr_acesso_dicom_p text, nr_seq_laudo_p bigint, ds_laudo_p text, cd_pessoa_fisica_p text, nm_usuario_p text, cd_procedimento_p text, nr_prescricao_p text, ie_valida_param char, cd_estabelecimento_p bigint) AS $body$
DECLARE


ie_continua_w  char;


BEGIN
  begin
    ie_continua_w := 'S';

    if (ie_valida_param = 'S') then
      select  coalesce(ie_pdf_pixeon,'N') ie_pdf_pixeon
      into STRICT ie_continua_w
      from   parametro_integracao_pacs
      where  cd_estabelecimento  = cd_estabelecimento_p;
    end if;

    if (ie_continua_w = 'S') then
      delete from laudo_paciente_pdf_serial
      where nr_seq_laudo = nr_seq_laudo_p;

      insert into laudo_paciente_pdf_serial
      values (nextval('laudo_paciente_pdf_serial_seq'), clock_timestamp(), nm_usuario_p, clock_timestamp(),
              nm_usuario_p, nr_acesso_dicom_p, nr_seq_laudo_p, ds_laudo_p,
              cd_pessoa_fisica_p, cd_procedimento_p, null, null, null, nr_prescricao_p);
      commit;
    end if;
  end;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_pixeon_laudo_pdf (nr_acesso_dicom_p text, nr_seq_laudo_p bigint, ds_laudo_p text, cd_pessoa_fisica_p text, nm_usuario_p text, cd_procedimento_p text, nr_prescricao_p text, ie_valida_param char, cd_estabelecimento_p bigint) FROM PUBLIC;

