-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ehr_consulta_por_elementos ( nr_seq_conteudo_p bigint, nm_usuario_p text, ds_sequencias_p text default null) AS $body$
DECLARE


nr_seq_elemento_w	bigint;

C01 CURSOR FOR
	SELECT	*
	from	ehr_elemento_result
	where	nr_seq_elemento = nr_seq_elemento_w
	and	position(','||to_char(nr_sequencia)||',' in ','||ds_sequencias_p||',') > 0
	order by 1;

c01_w	c01% rowtype;


BEGIN

select	nr_seq_elemento
into STRICT	nr_seq_elemento_w
from	ehr_template_conteudo
where	nr_sequencia = nr_seq_conteudo_p;

open C01;
loop
fetch C01 into
	c01_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin
	insert into ehr_template_cont_item(
						nr_sequencia,
						nr_seq_item,
						dt_atualizacao,
						nm_usuario,
						dt_atualizacao_nrec,
						nm_usuario_nrec,
						nr_seq_apres,
						cd_resultado,
						ds_resultado,
						vl_resultado
						)
					values (
						nextval('ehr_template_cont_item_seq'),
						nr_seq_conteudo_p,
						clock_timestamp(),
						nm_usuario_p,
						clock_timestamp(),
						nm_usuario_p,
						c01_w.nr_seq_apres,
						c01_w.cd_resultado,
						c01_w.ds_resultado,
						c01_w.vl_resultado
						);
	end;
end loop;
close C01;


commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ehr_consulta_por_elementos ( nr_seq_conteudo_p bigint, nm_usuario_p text, ds_sequencias_p text default null) FROM PUBLIC;

