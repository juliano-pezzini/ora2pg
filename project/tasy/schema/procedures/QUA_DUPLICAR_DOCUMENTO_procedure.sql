-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE qua_duplicar_documento ( nr_seq_documento_p bigint, cd_documento_p text, nm_usuario_p text, nr_seq_doc_novo_p INOUT bigint) AS $body$
DECLARE


nr_seq_doc_novo_w	bigint;
qt_existe_w		bigint;
cd_estabelecimento_w	smallint;


BEGIN

select	cd_estabelecimento
into STRICT	cd_estabelecimento_w
from	qua_documento
where	nr_sequencia		= nr_seq_documento_p;

select	count(*)
into STRICT	qt_existe_w
from	qua_documento
where	cd_documento 		= cd_documento_p
and	cd_estabelecimento		= cd_estabelecimento_w;

if (qt_existe_w > 0) then
	/*(-20011,'Já existe um documento com este código para este estabelecimento.');*/

	CALL wheb_mensagem_pck.exibir_mensagem_abort(263174);
end if;

select	nextval('qua_documento_seq')
into STRICT	nr_seq_doc_novo_w
;

insert into qua_documento(
		nr_sequencia,
		cd_estabelecimento,
		nr_seq_tipo,
		dt_atualizacao,
		nm_usuario,
		cd_documento,
		nm_documento,
		cd_setor_atendimento,
		dt_emissao,
		ds_arquivo,
		ds_palavra_chave,
		nr_seq_loc,
		ie_situacao,
		ie_status,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		ie_forma_armazenamento,
		ds_forma_recuperacao,
		ie_forma_descarte,
		ie_tempo_retencao,
		qt_tempo_retencao,
		ds_forma_protecao,
		qt_dias_revisao,
		ie_permite_email,
		nr_seq_tipo_ref_doc)
	SELECT	nr_seq_doc_novo_w,
		cd_estabelecimento,
		nr_seq_tipo,
		clock_timestamp(),
		nm_usuario_p,
		cd_documento_p,
		nm_documento,
		cd_setor_atendimento,
		clock_timestamp(),
		ds_arquivo,
		ds_palavra_chave,
		nr_seq_loc,
		ie_situacao,
		'P',
		clock_timestamp(),
		nm_usuario_p,
		ie_forma_armazenamento,
		ds_forma_recuperacao,
		ie_forma_descarte,
		ie_tempo_retencao,
		qt_tempo_retencao,
		ds_forma_protecao,
		qt_dias_revisao,
		ie_permite_email,
		nr_seq_tipo_ref_doc
	from	qua_documento
	where	nr_sequencia = nr_seq_documento_p;

insert into qua_doc_setor_adic(
		nr_sequencia,
		cd_setor_atendimento,
		dt_atualizacao,
		dt_atualizacao_nrec,
		nm_usuario,
		nm_usuario_nrec,
		nr_seq_doc)
	SELECT	nextval('qua_doc_setor_adic_seq'),
		cd_setor_atendimento,
		clock_timestamp(),
		clock_timestamp(),
		nm_usuario_p,
		nm_usuario_p,
		nr_seq_doc_novo_w
	from	qua_doc_setor_adic
	where	nr_seq_doc = nr_seq_documento_p;

nr_seq_doc_novo_p := nr_seq_doc_novo_w;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE qua_duplicar_documento ( nr_seq_documento_p bigint, cd_documento_p text, nm_usuario_p text, nr_seq_doc_novo_p INOUT bigint) FROM PUBLIC;

