-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_autor_cir_agenda (nr_seq_autorizacao_p bigint) AS $body$
DECLARE


cd_tipo_acomodacao_w	smallint;
nr_doc_convenio_w	varchar(20);
ds_senha_w		varchar(20);
qt_diaria_prev_w		smallint;
cd_medico_solicitante_w	varchar(10);
ie_tipo_guia_w		varchar(10);
ie_carater_cirurgia_w	varchar(5);


BEGIN

if (nr_seq_autorizacao_p IS NOT NULL AND nr_seq_autorizacao_p::text <> '') then

	select	b.cd_tipo_acomodacao,
		b.nr_doc_convenio,
		b.ds_senha,
		b.qt_diaria_prev,
		b.cd_medico,
		b.ie_tipo_guia,
		CASE WHEN b.ie_carater_cirurgia='A' THEN null  ELSE b.ie_carater_cirurgia END
	into STRICT	cd_tipo_acomodacao_w,
		nr_doc_convenio_w,
		ds_senha_w,
		qt_diaria_prev_w,
		cd_medico_solicitante_w,
		ie_tipo_guia_w,
		ie_carater_cirurgia_w
	from	agenda_paciente b,
		autorizacao_convenio a
	where	a.nr_sequencia	= nr_seq_autorizacao_p
	and	a.nr_seq_agenda	= b.nr_sequencia;

	/* s√≥ altera se os campos estiverem vazios */

	update	autorizacao_convenio
	set	cd_tipo_acomodacao	= coalesce(cd_tipo_acomodacao,cd_tipo_acomodacao_w),
		cd_autorizacao		= coalesce(cd_autorizacao,nr_doc_convenio_w),
		cd_senha		= coalesce(cd_senha,ds_senha_w),
		qt_dia_solicitado	= coalesce(qt_dia_solicitado,qt_diaria_prev_w),
		cd_medico_solicitante	= coalesce(cd_medico_solicitante, cd_medico_solicitante_w),
		ie_tipo_guia		= coalesce(ie_tipo_guia, ie_tipo_guia_w),
		ie_carater_int_tiss	= coalesce(ie_carater_int_tiss,ie_carater_cirurgia_w)
	where	nr_sequencia		= nr_seq_autorizacao_p;


	commit;

end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_autor_cir_agenda (nr_seq_autorizacao_p bigint) FROM PUBLIC;

