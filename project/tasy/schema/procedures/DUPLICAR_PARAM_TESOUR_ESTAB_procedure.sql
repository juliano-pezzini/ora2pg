-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_param_tesour_estab ( cd_estabelecimento_p bigint, nm_usuario_p text, cd_estab_duplic_p bigint ) AS $body$
DECLARE


count_w 			bigint;
CD_ESTABELECIMENTO_W 		smallint;
CD_HISTORICO_W                  bigint;
CD_HISTORICO_CRED_W             bigint;
DT_ATUALIZACAO_W           	timestamp;
DT_ATUALIZACAO_NREC_W           timestamp;
IE_AGRUPA_LANC_CAIXA_DIA_W 	varchar(1);
IE_AGRUPA_TRANS_CONTAB_W   	varchar(1);
IE_BAIXA_LOTE_CP_W              varchar(5);
IE_BAIXA_LOTE_CR_W              varchar(5);
IE_CANC_CR_BAIXA_W              varchar(1);
IE_CENTRO_CUSTO_TIT_PAGAR_W	varchar(1);
IE_COMPL_HISTORICO_W            varchar(3);
IE_CONTAB_CP_W             	varchar(1);
IE_CONTAB_CR_W             	varchar(1);
IE_CONTAB_MONET_DOCTO_W    	varchar(1);
IE_CONTAB_MONET_REGRA_W    	varchar(1);
IE_CONTAB_NEG_CHEQUE_W     	varchar(1);
IE_CONTAB_TRANSF_CAIXA_W   	varchar(1);
IE_CONTA_CONTAB_TIT_PAGAR_W	varchar(1);
IE_DATA_DEVOL_CHEQUE_W     	varchar(15);
IE_DT_CONTAB_TESOURARIA_W       varchar(1);
IE_RECEB_SEM_TIT_W         	varchar(1);
IE_SALDO_DEP_CHEQUE_W      	varchar(1);
IE_SALDO_NEGATIVO_W        	varchar(1);
IE_USUARIO_CAIXA_W         	varchar(2);
NM_USUARIO_W               	varchar(15);
NM_USUARIO_NREC_W               varchar(15);
NR_RPS_ATUAL_W                  bigint;
NR_SEQ_CHEQUE_CP_W              bigint;
NR_SEQ_CHEQUE_CR_W              bigint;
NR_SEQ_CHEQUE_DEVOL_W      	bigint;
NR_SEQ_ESPECIE_CP_W             bigint;
NR_SEQ_ESPECIE_CR_W             bigint;
NR_SEQ_TRANS_ACRES_NEG_W        bigint;
NR_SEQ_TRANS_ESCRIT_W      	bigint;
NR_SEQ_TRANS_TROCO_W       	bigint;


BEGIN

select	count(*)
into STRICT	count_w
from	PARAMETRO_TESOURARIA
where	cd_estabelecimento = cd_estab_duplic_p;

if (count_w = 0) then
	insert into 	PARAMETRO_TESOURARIA(CD_ESTABELECIMENTO,
			CD_HISTORICO,
			CD_HISTORICO_CRED,
			DT_ATUALIZACAO,
			DT_ATUALIZACAO_NREC,
			IE_AGRUPA_LANC_CAIXA_DIA,
			IE_AGRUPA_TRANS_CONTAB,
			IE_BAIXA_LOTE_CP,
			IE_BAIXA_LOTE_CR,
			IE_CANC_CR_BAIXA,
			IE_CENTRO_CUSTO_TIT_PAGAR,
			IE_COMPL_HISTORICO,
			IE_CONTAB_CP,
			IE_CONTAB_CR,
			IE_CONTAB_MONET_DOCTO,
			IE_CONTAB_MONET_REGRA,
			IE_CONTAB_NEG_CHEQUE,
			IE_CONTAB_TRANSF_CAIXA,
			IE_CONTA_CONTAB_TIT_PAGAR,
			IE_DATA_DEVOL_CHEQUE,
			IE_DT_CONTAB_TESOURARIA,
			IE_RECEB_SEM_TIT,
			IE_SALDO_DEP_CHEQUE,
			IE_SALDO_NEGATIVO,
			IE_USUARIO_CAIXA,
			NM_USUARIO,
			NM_USUARIO_NREC,
			NR_RPS_ATUAL,
			NR_SEQ_CHEQUE_CP,
			NR_SEQ_CHEQUE_CR,
			NR_SEQ_CHEQUE_DEVOL,
			NR_SEQ_ESPECIE_CP,
			NR_SEQ_ESPECIE_CR,
			NR_SEQ_TRANS_ACRES_NEG,
			NR_SEQ_TRANS_ESCRIT,
			NR_SEQ_TRANS_TROCO)
	SELECT	 	CD_ESTAB_DUPLIC_P,
			CD_HISTORICO,
			CD_HISTORICO_CRED,
			clock_timestamp(),
			clock_timestamp(),
			IE_AGRUPA_LANC_CAIXA_DIA,
			IE_AGRUPA_TRANS_CONTAB,
			IE_BAIXA_LOTE_CP,
			IE_BAIXA_LOTE_CR,
			IE_CANC_CR_BAIXA,
			IE_CENTRO_CUSTO_TIT_PAGAR,
			IE_COMPL_HISTORICO,
			IE_CONTAB_CP,
			IE_CONTAB_CR,
			IE_CONTAB_MONET_DOCTO,
			IE_CONTAB_MONET_REGRA,
			IE_CONTAB_NEG_CHEQUE,
			IE_CONTAB_TRANSF_CAIXA,
			IE_CONTA_CONTAB_TIT_PAGAR,
			IE_DATA_DEVOL_CHEQUE,
			IE_DT_CONTAB_TESOURARIA,
			IE_RECEB_SEM_TIT,
			IE_SALDO_DEP_CHEQUE,
			IE_SALDO_NEGATIVO,
			IE_USUARIO_CAIXA,
			NM_USUARIO_P,
			NM_USUARIO_P,
			NR_RPS_ATUAL,
			NR_SEQ_CHEQUE_CP,
			NR_SEQ_CHEQUE_CR,
			NR_SEQ_CHEQUE_DEVOL,
			NR_SEQ_ESPECIE_CP,
			NR_SEQ_ESPECIE_CR,
			NR_SEQ_TRANS_ACRES_NEG,
			NR_SEQ_TRANS_ESCRIT,
			NR_SEQ_TRANS_TROCO
	FROM 		PARAMETRO_TESOURARIA A
	WHERE 		A.CD_ESTABELECIMENTO	= CD_ESTABELECIMENTO_P;
ELSE
	SELECT 		CD_HISTORICO,
			CD_HISTORICO_CRED,
			DT_ATUALIZACAO,
			DT_ATUALIZACAO_NREC,
			IE_AGRUPA_LANC_CAIXA_DIA,
			IE_AGRUPA_TRANS_CONTAB,
			IE_BAIXA_LOTE_CP,
			IE_BAIXA_LOTE_CR,
			IE_CANC_CR_BAIXA,
			IE_CENTRO_CUSTO_TIT_PAGAR,
			IE_COMPL_HISTORICO,
			IE_CONTAB_CP,
			IE_CONTAB_CR,
			IE_CONTAB_MONET_DOCTO,
			IE_CONTAB_MONET_REGRA,
			IE_CONTAB_NEG_CHEQUE,
			IE_CONTAB_TRANSF_CAIXA,
			IE_CONTA_CONTAB_TIT_PAGAR,
			IE_DATA_DEVOL_CHEQUE,
			IE_DT_CONTAB_TESOURARIA,
			IE_RECEB_SEM_TIT,
			IE_SALDO_DEP_CHEQUE,
			IE_SALDO_NEGATIVO,
			IE_USUARIO_CAIXA,
			NM_USUARIO,
			NM_USUARIO_NREC,
			NR_RPS_ATUAL,
			NR_SEQ_CHEQUE_CP,
			NR_SEQ_CHEQUE_CR,
			NR_SEQ_CHEQUE_DEVOL,
			NR_SEQ_ESPECIE_CP,
			NR_SEQ_ESPECIE_CR,
			NR_SEQ_TRANS_ACRES_NEG,
			NR_SEQ_TRANS_ESCRIT,
			NR_SEQ_TRANS_TROCO
	INTO STRICT 		CD_HISTORICO_W,
			CD_HISTORICO_CRED_W,
			DT_ATUALIZACAO_W,
			DT_ATUALIZACAO_NREC_W,
			IE_AGRUPA_LANC_CAIXA_DIA_W,
			IE_AGRUPA_TRANS_CONTAB_W,
			IE_BAIXA_LOTE_CP_W,
			IE_BAIXA_LOTE_CR_W,
			IE_CANC_CR_BAIXA_W,
			IE_CENTRO_CUSTO_TIT_PAGAR_W,
			IE_COMPL_HISTORICO_W,
			IE_CONTAB_CP_W,
			IE_CONTAB_CR_W,
			IE_CONTAB_MONET_DOCTO_W,
			IE_CONTAB_MONET_REGRA_W,
			IE_CONTAB_NEG_CHEQUE_W,
			IE_CONTAB_TRANSF_CAIXA_W,
			IE_CONTA_CONTAB_TIT_PAGAR_W,
			IE_DATA_DEVOL_CHEQUE_W,
			IE_DT_CONTAB_TESOURARIA_W,
			IE_RECEB_SEM_TIT_W,
			IE_SALDO_DEP_CHEQUE_W,
			IE_SALDO_NEGATIVO_W,
			IE_USUARIO_CAIXA_W,
			NM_USUARIO_W,
			NM_USUARIO_NREC_W,
			NR_RPS_ATUAL_W,
			NR_SEQ_CHEQUE_CP_W,
			NR_SEQ_CHEQUE_CR_W,
			NR_SEQ_CHEQUE_DEVOL_W,
			NR_SEQ_ESPECIE_CP_W,
			NR_SEQ_ESPECIE_CR_W,
			NR_SEQ_TRANS_ACRES_NEG_W,
			NR_SEQ_TRANS_ESCRIT_W,
			NR_SEQ_TRANS_TROCO_W
	FROM 		PARAMETRO_TESOURARIA A
	WHERE 		A.CD_ESTABELECIMENTO = CD_ESTABELECIMENTO_P;

	UPDATE 		PARAMETRO_TESOURARIA
	SET		CD_HISTORICO			= CD_HISTORICO_W,
			CD_HISTORICO_CRED		= CD_HISTORICO_CRED_w,
			DT_ATUALIZACAO			= clock_timestamp(),
			DT_ATUALIZACAO_NREC		= clock_timestamp(),
			IE_AGRUPA_LANC_CAIXA_DIA	= IE_AGRUPA_LANC_CAIXA_DIA_W,
			IE_AGRUPA_TRANS_CONTAB		= IE_AGRUPA_TRANS_CONTAB_W,
			IE_BAIXA_LOTE_CP		= IE_BAIXA_LOTE_CP_W,
			IE_BAIXA_LOTE_CR		= IE_BAIXA_LOTE_CR_W,
			IE_CANC_CR_BAIXA		= IE_CANC_CR_BAIXA_W,
			IE_CENTRO_CUSTO_TIT_PAGAR	= IE_CENTRO_CUSTO_TIT_PAGAR_W,
			IE_COMPL_HISTORICO  		= IE_COMPL_HISTORICO_W,
			IE_CONTAB_CP			= IE_CONTAB_CP_W,
			IE_CONTAB_CR			= IE_CONTAB_CR_W,
			IE_CONTAB_MONET_DOCTO		= IE_CONTAB_MONET_DOCTO_W,
			IE_CONTAB_MONET_REGRA		= IE_CONTAB_MONET_REGRA_W,
			IE_CONTAB_NEG_CHEQUE     	= IE_CONTAB_NEG_CHEQUE_W,
			IE_CONTAB_TRANSF_CAIXA		= IE_CONTAB_TRANSF_CAIXA_W,
			IE_CONTA_CONTAB_TIT_PAGAR	= IE_CONTA_CONTAB_TIT_PAGAR_W,
			IE_DATA_DEVOL_CHEQUE		= IE_DATA_DEVOL_CHEQUE_W,
			IE_DT_CONTAB_TESOURARIA 	= IE_DT_CONTAB_TESOURARIA_W,
			IE_RECEB_SEM_TIT  		= IE_RECEB_SEM_TIT_W,
			IE_SALDO_DEP_CHEQUE		= IE_SALDO_DEP_CHEQUE_W,
			IE_SALDO_NEGATIVO		= IE_SALDO_NEGATIVO_W,
			IE_USUARIO_CAIXA 		= IE_USUARIO_CAIXA_W,
			NM_USUARIO			= NM_USUARIO_W,
			NM_USUARIO_NREC			= NM_USUARIO_NREC_W,
			NR_RPS_ATUAL			= NR_RPS_ATUAL_W,
			NR_SEQ_CHEQUE_CP         	= NR_SEQ_CHEQUE_CP_W,
			NR_SEQ_CHEQUE_CR  		= NR_SEQ_CHEQUE_CR_W,
			NR_SEQ_CHEQUE_DEVOL		= NR_SEQ_CHEQUE_DEVOL_W,
			NR_SEQ_ESPECIE_CP		= NR_SEQ_ESPECIE_CP_W,
			NR_SEQ_ESPECIE_CR		= NR_SEQ_ESPECIE_CR_W,
			NR_SEQ_TRANS_ACRES_NEG		= NR_SEQ_TRANS_ACRES_NEG_W,
			NR_SEQ_TRANS_ESCRIT  		= NR_SEQ_TRANS_ESCRIT_W,
			NR_SEQ_TRANS_TROCO		= NR_SEQ_TRANS_TROCO_W
	WHERE 		CD_ESTABELECIMENTO 		= CD_ESTAB_DUPLIC_P;
END IF;

COMMIT;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_param_tesour_estab ( cd_estabelecimento_p bigint, nm_usuario_p text, cd_estab_duplic_p bigint ) FROM PUBLIC;

