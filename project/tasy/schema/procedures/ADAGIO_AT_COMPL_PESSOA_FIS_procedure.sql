-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE adagio_at_compl_pessoa_fis ( cd_pessoa_fisica_p compl_pessoa_fisica.cd_pessoa_fisica%type, nr_sequencia_p compl_pessoa_fisica.nr_sequencia%type, ie_tipo_complemento_p compl_pessoa_fisica.ie_tipo_complemento%type, nm_usuario_p compl_pessoa_fisica.nm_usuario%type, cd_cep_p compl_pessoa_fisica.cd_cep%type, ds_bairro_p compl_pessoa_fisica.ds_bairro%type, ds_complemento_p compl_pessoa_fisica.ds_complemento%type, ds_endereco_p compl_pessoa_fisica.ds_endereco%type, ds_municipio_p compl_pessoa_fisica.ds_municipio%type, nr_endereco_p compl_pessoa_fisica.nr_endereco%type, nr_seq_pais_p compl_pessoa_fisica.nr_seq_pais%type, sg_estado_p compl_pessoa_fisica.sg_estado%type, acao text ) AS $body$
DECLARE


    nr_sequencia_w     compl_pessoa_fisica.nr_sequencia%type;


BEGIN

  case acao

    when 'INSERT' then
      select  coalesce(max(nr_sequencia),0) + 1
                into STRICT  nr_sequencia_w
                from  compl_pessoa_fisica
      where  cd_pessoa_fisica  = cd_pessoa_fisica_p;

      insert into compl_pessoa_fisica(
        nr_sequencia,
        cd_pessoa_fisica,
        dt_atualizacao,
        nm_usuario,
        ie_tipo_complemento,
        cd_cep,
        ds_bairro,
        ds_complemento,
        ds_endereco,
        ds_municipio,
        nr_endereco,
        nr_seq_pais,
        sg_estado
      ) values (
        nr_sequencia_w,
        cd_pessoa_fisica_p,
        clock_timestamp(),
        nm_usuario_p,
        ie_tipo_complemento_p,
        cd_cep_p,
        ds_bairro_p,
        ds_complemento_p,
        ds_endereco_p,
        ds_municipio_p,
        nr_endereco_p,
        nr_seq_pais_p,
        sg_estado_p
      );

    when 'DELETE' then

      delete from compl_pessoa_fisica
      where cd_pessoa_fisica    = cd_pessoa_fisica_p;

	when 'UPDATE' then
		update compl_pessoa_fisica 
		set	cd_cep            = cd_cep_p,
			ds_bairro           = ds_bairro_p,
			ds_complemento      = ds_complemento_p,
			ds_endereco			    = ds_endereco_p,
			ds_municipio		    = ds_municipio_p,
			nr_endereco			    = nr_endereco_p,
			nr_seq_pais			    = nr_seq_pais_p,
			sg_estado			      = sg_estado,
			dt_atualizacao      = clock_timestamp(),
			nm_usuario          = nm_usuario_p
		where cd_pessoa_fisica  = cd_pessoa_fisica_p;	
	
    end case;
  commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE adagio_at_compl_pessoa_fis ( cd_pessoa_fisica_p compl_pessoa_fisica.cd_pessoa_fisica%type, nr_sequencia_p compl_pessoa_fisica.nr_sequencia%type, ie_tipo_complemento_p compl_pessoa_fisica.ie_tipo_complemento%type, nm_usuario_p compl_pessoa_fisica.nm_usuario%type, cd_cep_p compl_pessoa_fisica.cd_cep%type, ds_bairro_p compl_pessoa_fisica.ds_bairro%type, ds_complemento_p compl_pessoa_fisica.ds_complemento%type, ds_endereco_p compl_pessoa_fisica.ds_endereco%type, ds_municipio_p compl_pessoa_fisica.ds_municipio%type, nr_endereco_p compl_pessoa_fisica.nr_endereco%type, nr_seq_pais_p compl_pessoa_fisica.nr_seq_pais%type, sg_estado_p compl_pessoa_fisica.sg_estado%type, acao text ) FROM PUBLIC;

