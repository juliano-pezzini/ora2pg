-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_oft_consulta (nr_sequencia_p bigint, nm_usuario_p text, nr_atendimento_p bigint default null) AS $body$
DECLARE


nr_sequencia_w		bigint;
cd_profissional_w	varchar(10);


BEGIN

select	nextval('oft_consulta_medica_seq')
into STRICT	nr_sequencia_w
;

if (obter_se_usuario_medico(nm_usuario_p) = 'S') then
	cd_profissional_w	:= obter_pessoa_fisica_usuario(nm_usuario_p, 'C');
end if;

INSERT INTO OFT_CONSULTA_MEDICA(
	NR_SEQUENCIA,
	DT_ATUALIZACAO,
	NM_USUARIO,
	DT_ATUALIZACAO_NREC,
	NM_USUARIO_NREC,
	DT_CONSULTA,
	CD_PROFISSIONAL,
	NR_ATENDIMENTO,
	DS_QUEIXA_PACIENTE,
	VL_PRESSAO_OD,
	VL_PRESSAO_OE,
	HR_PRESSAO,
	DS_AV_SC_OD,
	DS_AV_CC_OD,
	DS_AV_SC_OE,
	DS_AV_CC_OE,
	DS_MEO,
	VL_DE_RD_OD,
	VL_DC_RD_OD,
	VL_EIXO_RD_OD,
	DS_VISAO_RD_OD,
	VL_VISAO_RD_OD,
	VL_DE_RD_OE,
	VL_DC_RD_OE,
	VL_EIXO_RD_OE,
	DS_VISAO_RD_OE,
	VL_VISAO_RD_OE,
	VL_DE_RE_OD,
	VL_DC_RE_OD,
	VL_EIXO_RE_OD,
	DS_VISAO_RE_OD,
	VL_VISAO_RE_OD,
	VL_DE_RE_OE,
	VL_DC_RE_OE,
	VL_EIXO_RE_OE,
	DS_VISAO_RE_OE,
	VL_DE_RECEITA_OD,
	VL_VISAO_RE_OE,
	VL_DC_RECEITA_OD,
	VL_EIXO_RECEITA_OD,
	DS_VISAO_RECEITA_OD,
	VL_DE_RECEITA_OE,
	VL_VISAO_RECEITA_OD,
	VL_DC_RECEITA_OE,
	VL_EIXO_RECEITA_OE,
	DS_VISAO_RECEITA_OE,
	VL_ADICAO_OD,
	VL_VISAO_RECEITA_OE,
	VL_ADICAO_OE,
	IE_DINAMICA,
	IE_ESTATICA,
	IE_RECEITA,
	IE_ADICAO,
	DS_FUNDOSCOPIA,
	IE_TIPO_FUNDOSCOPIA,
	DS_BIOMICROSCOPIA,
	DS_OUTROS_EXAMES,
	DS_CONDUTA,
	DT_LIBERACAO,
	IE_BASE_ADICAO,
	DS_OBS_RECEITA,
	NR_SEQ_RETORNO,
	IE_SITUACAO,
	DT_INATIVACAO,
	NM_USUARIO_INATIVACAO,
	DS_JUSTIFICATIVA,
	CD_PERFIL_ATIVO)
 SELECT
	nr_sequencia_w,
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	coalesce(cd_profissional_w,CD_PROFISSIONAL),
	coalesce(nr_atendimento_p,NR_ATENDIMENTO),
	DS_QUEIXA_PACIENTE,
	VL_PRESSAO_OD,
	VL_PRESSAO_OE,
	clock_timestamp(),
	DS_AV_SC_OD,
	DS_AV_CC_OD,
	DS_AV_SC_OE,
	DS_AV_CC_OE,
	DS_MEO,
	VL_DE_RD_OD,
	VL_DC_RD_OD,
	VL_EIXO_RD_OD,
	DS_VISAO_RD_OD,
	VL_VISAO_RD_OD,
	VL_DE_RD_OE,
	VL_DC_RD_OE,
	VL_EIXO_RD_OE,
	DS_VISAO_RD_OE,
	VL_VISAO_RD_OE,
	VL_DE_RE_OD,
	VL_DC_RE_OD,
	VL_EIXO_RE_OD,
	DS_VISAO_RE_OD,
	VL_VISAO_RE_OD,
	VL_DE_RE_OE,
	VL_DC_RE_OE,
	VL_EIXO_RE_OE,
	DS_VISAO_RE_OE,
	VL_DE_RECEITA_OD,
	VL_VISAO_RE_OE,
	VL_DC_RECEITA_OD,
	VL_EIXO_RECEITA_OD,
	DS_VISAO_RECEITA_OD,
	VL_DE_RECEITA_OE,
	VL_VISAO_RECEITA_OD,
	VL_DC_RECEITA_OE,
	VL_EIXO_RECEITA_OE,
	DS_VISAO_RECEITA_OE,
	VL_ADICAO_OD,
	VL_VISAO_RECEITA_OE,
	VL_ADICAO_OE,
	IE_DINAMICA,
	IE_ESTATICA,
	IE_RECEITA,
	IE_ADICAO,
	DS_FUNDOSCOPIA,
	IE_TIPO_FUNDOSCOPIA,
	DS_BIOMICROSCOPIA,
	DS_OUTROS_EXAMES,
	DS_CONDUTA,
	null,--DT_LIBERACAO,
	IE_BASE_ADICAO,
	DS_OBS_RECEITA,
	null, --NR_SEQ_RETORNO,
	'A', --IE_SITUACAO,
	null, --DT_INATIVACAO,
	null, --NM_USUARIO_INATIVACAO,
	null, --DS_JUSTIFICATIVA,
	CD_PERFIL_ATIVO
from	oft_consulta_medica
where	nr_sequencia	= nr_sequencia_p;

insert into OFT_CONSULTA_COMPLEMENTO(
	NR_SEQUENCIA,
	DT_COMPLEMENTO,
	NR_SEQ_CONS_MED,
	DS_COMPLEMENTO,
	DT_ATUALIZACAO,
	NM_USUARIO,
	DT_ATUALIZACAO_NREC,
	NM_USUARIO_NREC,
	CD_PESSOA_FISICA)
SELECT	nextval('oft_consulta_complemento_seq'),
	clock_timestamp(),
	nr_sequencia_w,
	DS_COMPLEMENTO,
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	CD_PESSOA_FISICA
from	OFT_CONSULTA_COMPLEMENTO
where	nr_seq_cons_med	= nr_sequencia_p;

insert into OFT_CONSULTA_LENTE(
	NR_SEQUENCIA,
	DT_ATUALIZACAO,
	NM_USUARIO,
	DT_ATUALIZACAO_NREC,
	NM_USUARIO_NREC,
	NR_SEQ_CONS_MED,
	IE_LADO,
	NR_SEQ_LENTE,
	NR_SEQ_CONSULTA,
	QT_GRAU,
	QT_GRAU_ESFERICO,
	QT_GRAU_CILINDRICO,
	QT_GRAU_LONGE,
	QT_EIXO,
	QT_ADICAO,
	DT_LANCAMENTO)
SELECT	nextval('oft_consulta_lente_seq'),
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	nr_sequencia_w,
	IE_LADO,
	NR_SEQ_LENTE,
	null, --NR_SEQ_CONSULTA,
	QT_GRAU,
	QT_GRAU_ESFERICO,
	QT_GRAU_CILINDRICO,
	QT_GRAU_LONGE,
	QT_EIXO,
	QT_ADICAO,
	null --DT_LANCAMENTO
from	oft_consulta_lente
where	nr_seq_cons_med	= nr_sequencia_p;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_oft_consulta (nr_sequencia_p bigint, nm_usuario_p text, nr_atendimento_p bigint default null) FROM PUBLIC;

