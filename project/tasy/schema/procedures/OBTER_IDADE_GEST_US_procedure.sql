-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_idade_gest_us ( nr_sequencia_p bigint, qt_ig_sem_us_p INOUT bigint, qt_ig_dia_us_p INOUT bigint) AS $body$
DECLARE


dt_us_w		timestamp;
qt_ig_sem_us_w	bigint;
qt_ig_dia_us_w	bigint;
qt_total_dia_w	bigint;

BEGIN
select	max(dt_us),
	max(qt_ig_sem_us),
	max(qt_ig_dia_us)
into STRICT	dt_us_w,
	qt_ig_sem_us_w,
	qt_ig_dia_us_w
from	MED_PAC_PRE_NATAL
where	nr_sequencia	= nr_sequencia_p;

if (dt_us_w IS NOT NULL AND dt_us_w::text <> '') then
	qt_total_dia_w	:= coalesce(qt_ig_sem_us_w,0) * 7 + coalesce(qt_ig_dia_us_w,0);

	qt_total_dia_w	:= qt_total_dia_w + (clock_timestamp() - dt_us_w);

	qt_ig_sem_us_p	:= trunc(dividir(qt_total_dia_w,7));
	qt_ig_dia_us_p	:= qt_total_dia_w - (qt_ig_sem_us_p * 7);

end if;


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_idade_gest_us ( nr_sequencia_p bigint, qt_ig_sem_us_p INOUT bigint, qt_ig_dia_us_p INOUT bigint) FROM PUBLIC;

