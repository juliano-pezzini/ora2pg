-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_unidade_medida ( nr_sequencia_p text) AS $body$
DECLARE


umc_w 			conversao_material_convenio.cd_unidade_convenio%type;
qtde_w 			conversao_material_convenio.tx_conversao_qtde%type;
cd_material_w 		conversao_material_convenio.cd_material%type;
cd_convenio_w 		conversao_material_convenio.cd_convenio%type;
cd_item_convenio_w 	conversao_material_convenio.cd_material_convenio%type;


BEGIN

select 	cd_material,
	cd_convenio,
	cd_material_convenio
into STRICT 	cd_material_w,
	cd_convenio_w,
	cd_item_convenio_w
from 	conversao_material_convenio
where 	nr_sequencia = nr_sequencia_p;

select  	max(cd_unid_med_convenio)
into STRICT 	umc_w
from    	convenio_carga_preco
where   	cd_convenio = cd_convenio_w
and     	cd_item_convenio = cd_item_convenio_w;

select 	max(qt_conversao)
into STRICT 	qtde_w
from    	material_conversao_unidade
where 	cd_material = cd_material_w
and   	cd_unidade_medida = umc_w;

if (qtde_w > 0) then
	update 	conversao_material_convenio
	set 	tx_conversao_qtde = qtde_w,
		cd_unidade_convenio = umc_w
	where 	nr_sequencia = nr_sequencia_p;

	commit;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_unidade_medida ( nr_sequencia_p text) FROM PUBLIC;

