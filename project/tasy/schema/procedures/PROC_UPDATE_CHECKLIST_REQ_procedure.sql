-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';



CREATE TYPE latam_req_rec AS (
    ie_em_execucao  LATAM_REQUISITO.IE_EM_EXECUCAO%type,
    ie_ppt_apresent LATAM_REQUISITO.IE_PPT_APRESENT%type,
    ie_aprov_intern LATAM_REQUISITO.IE_APROV_INTERN%type,
    ie_aprov_ext    LATAM_REQUISITO.IE_APROV_EXT%type,
    ie_prd_concl    LATAM_REQUISITO.IE_PRD_CONCL%type,
    ie_em_desenv    LATAM_REQUISITO.IE_EM_DESENV%type,
    ie_desenv_concl LATAM_REQUISITO.IE_DESENV_CONCL%type,
    ie_doc_entrega  LATAM_REQUISITO.IE_DOC_ENTREGA%type
);


CREATE OR REPLACE PROCEDURE proc_update_checklist_req ( nr_sequencia_p LATAM_REQUISITO.NR_SEQUENCIA%type, ie_em_execucao_p LATAM_REQUISITO.IE_EM_EXECUCAO%type, ie_ppt_apresent_p LATAM_REQUISITO.IE_PPT_APRESENT%type, ie_aprov_intern_p LATAM_REQUISITO.IE_APROV_INTERN%type, ie_aprov_ext_p LATAM_REQUISITO.IE_APROV_EXT%type, ie_prd_concl_p LATAM_REQUISITO.IE_PRD_CONCL%type, ie_em_desenv_p LATAM_REQUISITO.IE_EM_DESENV%type, ie_desenv_concl_p LATAM_REQUISITO.IE_DESENV_CONCL%type, ie_doc_entrega_p LATAM_REQUISITO.IE_DOC_ENTREGA%type ) AS $body$
DECLARE

TYPE latam_req_tab  IS TABLE OF latam_req_rec;
latam_req_tab_w     latam_req_tab;


BEGIN
    SELECT
        coalesce(a.ie_em_execucao,  'N') IE_EM_EXECUCAO,
        coalesce(a.ie_ppt_apresent, 'N') IE_PPT_APRESENT,
        coalesce(a.ie_aprov_intern, 'N') IE_APROV_INTERN,
        coalesce(a.ie_aprov_ext,    'N') IE_APROV_EXT,
        coalesce(a.ie_prd_concl,    'N') IE_PRD_CONCL,
        coalesce(a.ie_em_desenv,    'N') IE_EM_DESENV,
        coalesce(a.ie_desenv_concl, 'N') IE_DESENV_CONCL,
        coalesce(a.ie_doc_entrega,  'N') IE_DOC_ENTREGA
    BULK COLLECT INTO STRICT latam_req_tab_w
    FROM
        latam_requisito a
    WHERE a.nr_sequencia = nr_sequencia_p;

    IF (coalesce(ie_em_execucao_p, 'N') = 'S' AND latam_req_tab_w[1].ie_em_execucao = 'N') THEN
        UPDATE latam_requisito
        SET    
            ie_em_execucao = ie_em_execucao_p,
            dt_em_execucao = clock_timestamp(),
            nm_em_execucao = wheb_usuario_pck.get_nm_usuario
        WHERE nr_sequencia = nr_sequencia_p;
    END IF;

    IF (coalesce(ie_ppt_apresent_p, 'N') = 'S' AND latam_req_tab_w[1].ie_ppt_apresent = 'N') THEN
        UPDATE latam_requisito 
        SET    
            ie_ppt_apresent = ie_ppt_apresent_p,
            dt_ppt_apresent = clock_timestamp(),
            nm_ppt_apresent = wheb_usuario_pck.get_nm_usuario
        WHERE nr_sequencia = nr_sequencia_p;
    END IF;

    IF (coalesce(ie_aprov_intern_p, 'N') = 'S' AND latam_req_tab_w[1].ie_aprov_intern = 'N') THEN
        UPDATE latam_requisito 
        SET    
            ie_aprov_intern = ie_aprov_intern_p,
            dt_aprov_intern = clock_timestamp(),
            nm_aprov_intern = wheb_usuario_pck.get_nm_usuario
        WHERE nr_sequencia = nr_sequencia_p;
    END IF;

    IF (coalesce(ie_aprov_ext_p, 'N') = 'S' AND latam_req_tab_w[1].ie_aprov_ext = 'N') THEN
        UPDATE latam_requisito 
        SET    
            ie_aprov_ext = ie_aprov_ext_p,
            dt_aprov_ext = clock_timestamp(),
            nm_aprov_ext = wheb_usuario_pck.get_nm_usuario
        WHERE nr_sequencia = nr_sequencia_p;
    END IF;

    IF (coalesce(ie_prd_concl_p, 'N') = 'S' AND latam_req_tab_w[1].ie_prd_concl = 'N') THEN
        UPDATE latam_requisito 
        SET    
            ie_prd_concl = ie_prd_concl_p,
            dt_prd_concl = clock_timestamp(),
            nm_prd_concl = wheb_usuario_pck.get_nm_usuario
        WHERE nr_sequencia = nr_sequencia_p;
    END IF;

    IF (coalesce(ie_em_desenv_p, 'N') = 'S' AND latam_req_tab_w[1].ie_em_desenv = 'N') THEN
        UPDATE latam_requisito 
        SET    
            ie_em_desenv = ie_em_desenv_p,
            dt_em_desenv = clock_timestamp(),
            nm_em_desenv = wheb_usuario_pck.get_nm_usuario
        WHERE nr_sequencia = nr_sequencia_p;
    END IF;

    IF (coalesce(ie_desenv_concl_p, 'N') = 'S' AND latam_req_tab_w[1].ie_desenv_concl = 'N') THEN
        UPDATE latam_requisito 
        SET    
            ie_desenv_concl = ie_desenv_concl_p,
            dt_desenv_concl = clock_timestamp(),
            nm_desenv_concl = wheb_usuario_pck.get_nm_usuario
        WHERE nr_sequencia = nr_sequencia_p;
    END IF;

    IF (coalesce(ie_doc_entrega_p, 'N') = 'S' AND latam_req_tab_w[1].ie_doc_entrega = 'N') THEN
        UPDATE latam_requisito 
        SET    
            ie_doc_entrega = ie_doc_entrega_p,
            dt_doc_entrega = clock_timestamp(),
            nm_doc_entrega = wheb_usuario_pck.get_nm_usuario
        WHERE nr_sequencia = nr_sequencia_p;
    END IF;
    
    COMMIT;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE proc_update_checklist_req ( nr_sequencia_p LATAM_REQUISITO.NR_SEQUENCIA%type, ie_em_execucao_p LATAM_REQUISITO.IE_EM_EXECUCAO%type, ie_ppt_apresent_p LATAM_REQUISITO.IE_PPT_APRESENT%type, ie_aprov_intern_p LATAM_REQUISITO.IE_APROV_INTERN%type, ie_aprov_ext_p LATAM_REQUISITO.IE_APROV_EXT%type, ie_prd_concl_p LATAM_REQUISITO.IE_PRD_CONCL%type, ie_em_desenv_p LATAM_REQUISITO.IE_EM_DESENV%type, ie_desenv_concl_p LATAM_REQUISITO.IE_DESENV_CONCL%type, ie_doc_entrega_p LATAM_REQUISITO.IE_DOC_ENTREGA%type ) FROM PUBLIC;

