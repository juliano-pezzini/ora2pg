-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE protocol_engine_integration (nr_atendimento_p text, cd_evento_p integer, nr_seq_sv integer default null, nr_seq_exame_p integer default null, ds_frase_p text default null) AS $body$
DECLARE

 
  -- Constantes 
  initiateSuspitionPatientFlow   integer   := 548;
  identifiedSuspitionPatientVS   integer   := 554;
  identifiedSuspitionPatientEX   integer   := 555;
  medicalEvaluetion        integer   := 563;
  nm_usuario_integrar_w      varchar(15) := 'zhristov';

  -- variaveis 
  nm_usuario_w		      varchar(15);
  ds_param_integ_hl7_w	    varchar(4000) := null;
  cd_setor_Atendimento_w	    integer;
  nr_result_lab_exame_w		  bigint;
  qt_hora_exame_w				  smallint;
  qt_resultado_exame_w			double precision;
  nr_seq_exame_w				  bigint   := null;
  nr_tipo_exame_w         integer    := null;


BEGIN 
   
  nm_usuario_w := wheb_usuario_pck.get_nm_usuario;
  if nm_usuario_w = nm_usuario_integrar_w then 
   
    select Obter_Setor_Atendimento(nr_atendimento_p) 
    into STRICT  cd_setor_Atendimento_w 
;
        
    case cd_evento_p 
     
      when initiateSuspitionPatientFlow then 
         
        if (ds_frase_p IS NOT NULL AND ds_frase_p::text <> '') then 
          ds_param_integ_hl7_w := 'nr_atendimento=' || nr_atendimento_p || ';' || 
                      'ds_frase=true;';
        end if;
         
      when identifiedSuspitionPatientVS then 
         
        ds_param_integ_hl7_w := 'nr_atendimento=' || nr_atendimento_p || ';' || 
                    'nr_sequencia='  || nr_seq_sv     || ';';
         
      when identifiedSuspitionPatientEX then 
        
        ds_param_integ_hl7_w := protocol_engine_integration_ex(nr_atendimento_p, cd_evento_p, nr_seq_sv, nr_seq_exame_p);
 
      when medicalEvaluetion then 
        if (ds_frase_p IS NOT NULL AND ds_frase_p::text <> '') then 
          ds_param_integ_hl7_w := 'nr_atendimento=' || nr_atendimento_p || ';' || 
                      'ds_frase='    || ds_frase_p    || ';';
        end if;
 
    end case;
     
    if (ds_param_integ_hl7_w IS NOT NULL AND ds_param_integ_hl7_w::text <> '') then 
      CALL gravar_agend_integracao(cd_evento_p, ds_param_integ_hl7_w, cd_setor_atendimento_w);
    end if;
     
  end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE protocol_engine_integration (nr_atendimento_p text, cd_evento_p integer, nr_seq_sv integer default null, nr_seq_exame_p integer default null, ds_frase_p text default null) FROM PUBLIC;

