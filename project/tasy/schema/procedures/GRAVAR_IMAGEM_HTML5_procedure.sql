-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gravar_imagem_html5 ( nr_sequencia_p bigint, ds_titulo_p text, ds_arquivo_p text, ds_arquivo_backup_p text, ds_extensao_p text, nm_usuario_p text, nm_tabela_p text, cd_estabelecimento_p bigint, nm_arquivo_ret_p INOUT text, nm_tabela_ret_p INOUT text, nr_sequencia_ret_p INOUT bigint, ds_AuxPk_p text default null, ie_atualiza_p text default 'N') AS $body$
DECLARE


nr_sequencia_w		bigint;
nr_atendimento_w	varchar(10);
ds_parametro_w		varchar(15) := 'N';
nm_paciente_w		varchar(255);
ie_ds_arquivo		varchar(2);
nr_prescricao_w		bigint;
ie_padrao_laudo_w		varchar(2);
nm_arquivo_w		varchar(100);
ds_AuxPk_w			varchar(30);
nm_tabela_w			varchar(100);


BEGIN

ds_parametro_w := obter_param_usuario(0, 103, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, ds_parametro_w);
ie_ds_arquivo := obter_param_usuario(3010, 48, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, ie_ds_arquivo);
ie_padrao_laudo_w := obter_param_usuario(28, 280, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, ie_padrao_laudo_w);

nm_tabela_w := nm_tabela_p;

if (ds_AuxPk_p IS NOT NULL AND ds_AuxPk_p::text <> '') then
	ds_AuxPk_w := ds_AuxPk_p;
elsif (upper(nm_tabela_w) = 'OFT_DALTONISMO') then
	ds_AuxPk_w := 'NR_SEQ_DALTONISMO';
	nm_tabela_w := 'oft_consulta_imagem';
elsif (upper(nm_tabela_w) = 'OFT_FUNDOSCOPIA') then
	ds_AuxPk_w := 'NR_SEQ_OFT_FUNDOSCOPIA';
	nm_tabela_w := 'oft_consulta_imagem';
elsif (upper(nm_tabela_w) = 'OFT_BIOMICROSCOPIA') then
	ds_AuxPk_w := 'NR_SEQ_BIOMICROSCOPIA';
	nm_tabela_w := 'oft_consulta_imagem';
elsif (upper(nm_tabela_w) = 'OFT_IRIDECTOMIA') then
	ds_AuxPk_w := 'NR_SEQ_IRIDECTOMIA';
	nm_tabela_w := 'oft_consulta_imagem';	
elsif (upper(nm_tabela_w) = 'OFT_EXAME_EXTERNO') then
	ds_AuxPk_w := 'NR_SEQ_EXAME_EXTERNO';
	nm_tabela_w := 'oft_consulta_imagem';	
elsif (upper(nm_tabela_w) = 'OFT_ANGIO_RETINO') then
	ds_AuxPk_w := 'NR_SEQ_ANGIO_RETINO';
	nm_tabela_w := 'oft_consulta_imagem';	
elsif (upper(nm_tabela_w) = 'OFT_OCT') then
	ds_AuxPk_w := 'NR_SEQ_OCT';
	nm_tabela_w := 'oft_consulta_imagem';	
elsif (upper(nm_tabela_w) = 'OFT_IMAGEM') then
	ds_AuxPk_w :=  null;
	nm_tabela_w := 'oft_consulta_imagem';	
elsif (upper(nm_tabela_w) = 'MED_AVALIACAO_PACIENTE') then
	ds_AuxPk_w := 'NR_SEQ_AVALIACAO';
	nm_tabela_w := 'oft_consulta_imagem';
elsif (upper(nm_tabela_w) = 'OFT_FOTOCOAGULACAO_LASER') then
	ds_AuxPk_w := 'NR_SEQ_FOT_LASER';
	nm_tabela_w := 'oft_consulta_imagem';	
elsif (upper(nm_tabela_w) = 'OFT_CAPSULOTOMIA') then
	ds_AuxPk_w := 'NR_SEQ_CAPSULOTOMIA';
	nm_tabela_w := 'oft_consulta_imagem';	
elsif (upper(nm_tabela_w) = 'OFT_GONIOSCOPIA') then
	ds_AuxPk_w := 'NR_SEQ_GONIOSCOPIA';
	nm_tabela_w := 'oft_consulta_imagem';
elsif (upper(nm_tabela_w) = 'OFT_ULTRASSONOGRAFIA') then
	ds_AuxPk_w := 'NR_SEQ_ULTRASSONOGRAFIA';
	nm_tabela_w := 'oft_consulta_imagem';
elsif (upper(nm_tabela_w) = 'OFT_MAPEAMENTO_RETINA') then
	ds_AuxPk_w := 'NR_SEQ_MAPEAMENTO';
	nm_tabela_w := 'oft_consulta_imagem';	
elsif (upper(nm_tabela_w) = 'OFT_ABERROMETRIA') then
	ds_AuxPk_w := 'NR_SEQ_ABERROMETRIA';
	nm_tabela_w := 'oft_consulta_imagem';	
end if;

if (nm_tabela_w = 'can_loco_reg_imagem') then

	select	nextval('can_loco_reg_imagem_seq')
	into STRICT	nr_sequencia_w
	;

	if (ds_parametro_w = 'S') then	
		select 	nr_atendimento
		into STRICT	nr_atendimento_w
		from	can_loco_regional
		where	nr_sequencia = nr_sequencia_p;
		if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
			nr_atendimento_w := nr_atendimento_w || '_';
		end if;
	end if;

	insert	into can_loco_reg_imagem(nr_sequencia,
		nr_seq_loco_reg,
		ds_titulo,
		ds_arquivo,
		ds_arquivo_backup,
		dt_atualizacao,
		nm_usuario)
	values (nr_sequencia_w,
		nr_sequencia_p,
		ds_titulo_p,
		ds_arquivo_p || nr_atendimento_w || to_char(nr_sequencia_w) || ds_extensao_p,
		ds_arquivo_backup_p,
		clock_timestamp(),
		nm_usuario_p);


elsif (nm_tabela_w = 'atend_marcacao_imagem') then

	select	nextval('atend_marcacao_imagem_seq')
	into STRICT	nr_sequencia_w
	;

	if (ds_parametro_w = 'S') then	
		select 	nr_atendimento
		into STRICT	nr_atendimento_w
		from	atendimento_marcacao
		where	nr_sequencia = nr_sequencia_p;
		if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
			nr_atendimento_w := nr_atendimento_w || '_';
		end if;
	end if;

	insert	into atend_marcacao_imagem(nr_sequencia,
		nr_seq_marcacao,
		ds_titulo,
		ds_arquivo,
		ds_arquivo_backup,
		dt_atualizacao,
		nm_usuario)
	values (nr_sequencia_w,
		nr_sequencia_p,
		ds_titulo_p,
		ds_arquivo_p || nr_atendimento_w || to_char(nr_sequencia_w) || ds_extensao_p,
		ds_arquivo_backup_p,
		clock_timestamp(),
		nm_usuario_p);
elsif (nm_tabela_w = 'med_avaliacao_pac_imagem') then

	select	nextval('med_avaliacao_pac_imagem_seq')
	into STRICT	nr_sequencia_w
	;

	if (ds_parametro_w = 'S') then	
		select 	nr_atendimento
		into STRICT	nr_atendimento_w
		from	med_avaliacao_paciente
		where	nr_sequencia = nr_sequencia_p;
		if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
			nr_atendimento_w := nr_atendimento_w || '_';
		end if;
	end if;

	insert	into med_avaliacao_pac_imagem(nr_sequencia,
		nr_seq_aval_pac,
		ds_titulo,
		ds_arquivo,
		ds_arquivo_backup,
		dt_atualizacao,
		nm_usuario)
	values (nr_sequencia_w,
		nr_sequencia_p,
		ds_titulo_p,
		ds_arquivo_p || nr_atendimento_w || to_char(nr_sequencia_w) || ds_extensao_p,
		ds_arquivo_backup_p,
		clock_timestamp(),
		nm_usuario_p);
elsif (nm_tabela_w = 'evolucao_paciente_imagem') then

	select	nextval('evolucao_paciente_imagem_seq')
	into STRICT	nr_sequencia_w
	;

	if (ds_parametro_w = 'S') then	

		select 	max(nr_atendimento)
		into STRICT	nr_atendimento_w
		from	evolucao_paciente
		where	cd_evolucao = nr_sequencia_p;

		if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
			nr_atendimento_w := nr_atendimento_w || '_';
		end if;
	end if;

	insert	into evolucao_paciente_imagem(nr_sequencia,
		cd_evolucao,
		ds_titulo,
		ds_arquivo,
		ds_arquivo_backup,
		dt_atualizacao,
		nm_usuario)
	values (nr_sequencia_w,
		nr_sequencia_p,
		ds_titulo_p,
		ds_arquivo_p || nr_atendimento_w || to_char(nr_sequencia_w) || ds_extensao_p,
		ds_arquivo_backup_p,
		clock_timestamp(),
		nm_usuario_p);

elsif (upper(nm_tabela_w) = 'PACIENTE_IMAGEM')	then

if (ie_atualiza_p = 'S') then
	update paciente_imagem
	set    ds_arquivo = ds_arquivo_p || to_char(nr_sequencia_p) || ds_extensao_p,
		   nm_usuario = nm_usuario_p,
		   dt_atualizacao = clock_timestamp(),
		   DT_IMAGEM = clock_timestamp()
	where  nr_sequencia = nr_sequencia_p;

	nr_sequencia_w := nr_sequencia_p;

else
	select	nextval('paciente_imagem_seq')
	into STRICT	nr_sequencia_w
	;


	insert into paciente_imagem(nr_sequencia,		--1
		dt_atualizacao,		--2
		nm_usuario,			--3
		dt_atualizacao_nrec,--4
		nm_usuario_nrec,	--5
		ds_arquivo,			--6
		cd_evolucao,		--9	
		ds_titulo,			--11
		DT_IMAGEM)
		values (
		nr_sequencia_w,		--1
		clock_timestamp(),			--2
		nm_usuario_p,			--3
		clock_timestamp(),			--4
		nm_usuario_p,			--5
		ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p, --6
		ds_AuxPk_p,		--9
		ds_titulo_p,		--11
		clock_timestamp()
	);
end if;

elsif (nm_tabela_w = 'rxt_trat_fase_imagem') then

	select	nextval('rxt_trat_fase_imagem_seq')
	into STRICT	nr_sequencia_w
	;

	insert	into rxt_trat_fase_imagem(nr_sequencia,
		nr_seq_fase,
		ds_titulo,
		ds_arquivo,
		ds_arquivo_backup,
		dt_atualizacao,
		nm_usuario)
	values (nr_sequencia_w,
		nr_sequencia_p,
		ds_titulo_p,
		ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p,
		ds_arquivo_backup_p,
		clock_timestamp(),
		nm_usuario_p);
elsif (nm_tabela_w = 'protocolo_cir_banco_imagem') then

	select	nextval('protocolo_cir_banco_imagem_seq')
	into STRICT	nr_sequencia_w
	;

	insert into protocolo_cir_banco_imagem(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		ds_arquivo,
		ds_titulo,
		nr_seq_protocolo,
		ds_arquivo_backup)
	values (
		nr_sequencia_w,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p,
		ds_titulo_p,
		nr_sequencia_p,
		ds_arquivo_backup_p);

elsif (nm_tabela_w = 'imagem_cirurgia') then

	select	nextval('imagem_cirurgia_seq')
	into STRICT	nr_sequencia_w
	;

	insert into imagem_cirurgia(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_prot_cirurgia,
		ds_titulo,
		ds_arquivo,
		ds_arquivo_backup)
	values (
		nr_sequencia_w,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		nr_sequencia_p,
		ds_titulo_p,
		ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p,
		ds_arquivo_backup_p);
elsif (nm_tabela_w = 'laudo_pac_imagem_edicao') then

	select	nextval('laudo_pac_imagem_edicao_seq')
	into STRICT	nr_sequencia_w
	;

	nm_arquivo_w := ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p;

	if (ie_padrao_laudo_w IS NOT NULL AND ie_padrao_laudo_w::text <> '') then

		select	nr_atendimento,
				nr_prescricao
		into STRICT	nr_atendimento_w,
				nr_prescricao_w
		from	laudo_paciente
		where	nr_sequencia = nr_sequencia_p;

		if (ie_padrao_laudo_w = 'A') and (nm_tabela_w = 'laudo_pac_imagem_edicao') then
				nm_arquivo_w	:= ds_arquivo_p || nr_atendimento_w || ' - ' || to_char(nr_sequencia_w) || ds_extensao_p;
		elsif (ie_padrao_laudo_w = 'P') and (nm_tabela_w = 'laudo_pac_imagem_edicao') then
				nm_arquivo_w	:= ds_arquivo_p || to_char(nr_prescricao_w) || ' - ' || to_char(nr_sequencia_w) || ds_extensao_p;
		elsif (ie_padrao_laudo_w = 'AP') and (nm_tabela_w = 'laudo_pac_imagem_edicao') then
				nm_arquivo_w	:= ds_arquivo_p || nr_atendimento_w || '-' || to_char(nr_prescricao_w) || ' - ' || to_char(nr_sequencia_w) || ds_extensao_p;
		end if;

	end if;

	insert into laudo_pac_imagem_edicao(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_laudo,
		ds_titulo,
		ds_arquivo)
	values (
		nr_sequencia_w,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		nr_sequencia_p,
		ds_titulo_p,
		nm_arquivo_w);
elsif (nm_tabela_w = 'oft_consulta_imagem') then

	select	nextval('oft_consulta_imagem_seq')
	into STRICT	nr_sequencia_w
	;

	if (coalesce(ds_AuxPk_w::text, '') = '' ) then
		insert into oft_consulta_imagem(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			ds_titulo,
			ds_arquivo,
			ds_arquivo_backup,
			nr_seq_cons_med)
		values (
			nr_sequencia_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			ds_titulo_p,
			ds_arquivo_p || to_char(nr_sequencia_w)|| ds_extensao_p,
			ds_arquivo_backup_p,
			nr_sequencia_p);
	elsif (ds_AuxPk_w = 'NR_SEQ_OFT_FUNDOSCOPIA') then

		if (ie_ds_arquivo = 'NS') then
			SELECT  nr_atendimento,
				(SUBSTR(obter_nome_pf(coalesce(b.cd_pessoa_fisica,obter_pessoa_atendimento(b.nr_atendimento,'C'))),1,255))
			into STRICT	nr_atendimento_w,
				nm_paciente_w
			FROM    OFT_FUNDOSCOPIA a,
				OFT_CONSULTA b
			WHERE   a.nr_seq_consulta = b.nr_sequencia
			AND     a.nr_sequencia    = nr_sequencia_p;
			if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
				nr_atendimento_w := nr_atendimento_w || '_';
			end if;
			if (nm_paciente_w IS NOT NULL AND nm_paciente_w::text <> '') then
				nm_paciente_w := nm_paciente_w || '_';
			end if;
		end if;


		insert into oft_consulta_imagem(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			ds_titulo,
			ds_arquivo,
			ds_arquivo_backup,
			NR_SEQ_OFT_FUNDOSCOPIA)
		values (
			nr_sequencia_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			ds_titulo_p,
			CASE WHEN ie_ds_arquivo='S' THEN ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p  ELSE ds_arquivo_p || nr_atendimento_w || nm_paciente_w || to_char(nr_sequencia_w) || ds_extensao_p END ,
			ds_arquivo_backup_p,
			nr_sequencia_p);
	elsif (ds_AuxPk_w = 'NR_SEQ_BIOMICROSCOPIA') then

		if (ie_ds_arquivo = 'NS') then
			SELECT  max(nr_atendimento),
				max(SUBSTR(obter_nome_pf(coalesce(b.cd_pessoa_fisica,obter_pessoa_atendimento(b.nr_atendimento,'C'))),1,255))
			into STRICT	nr_atendimento_w,
				nm_paciente_w
			FROM    OFT_BIOMICROSCOPIA a,
				OFT_CONSULTA b
			WHERE   a.nr_seq_consulta = b.nr_sequencia 
			AND     a.nr_sequencia    = nr_sequencia_p;
			if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
				nr_atendimento_w := nr_atendimento_w || '_';
			end if;
			if (nm_paciente_w IS NOT NULL AND nm_paciente_w::text <> '') then
				nm_paciente_w := nm_paciente_w || '_';
			end if;
		end if;

		insert into oft_consulta_imagem(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			ds_titulo,
			ds_arquivo,
			ds_arquivo_backup,
			NR_SEQ_BIOMICROSCOPIA)
		values (
			nr_sequencia_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			ds_titulo_p,
			CASE WHEN ie_ds_arquivo='S' THEN ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p  ELSE ds_arquivo_p || nr_atendimento_w || nm_paciente_w || to_char(nr_sequencia_w) || ds_extensao_p END ,
			ds_arquivo_backup_p,
			nr_sequencia_p);
	elsif (ds_AuxPk_w = 'NR_SEQ_EXAME_EXTERNO') then

		if (ie_ds_arquivo = 'NS') then
			SELECT  max(nr_atendimento),
				max(SUBSTR(obter_nome_pf(coalesce(b.cd_pessoa_fisica,obter_pessoa_atendimento(b.nr_atendimento,'C'))),1,255))
			into STRICT	nr_atendimento_w,
				nm_paciente_w
			FROM    OFT_EXAME_EXTERNO a,
				OFT_CONSULTA b
			WHERE   a.nr_seq_consulta = b.nr_sequencia 
			AND     a.nr_sequencia    = nr_sequencia_p;
			if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
				nr_atendimento_w := nr_atendimento_w || '_';
			end if;
			if (nm_paciente_w IS NOT NULL AND nm_paciente_w::text <> '') then
				nm_paciente_w := nm_paciente_w || '_';
			end if;
		end if;

		insert into oft_consulta_imagem(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			ds_titulo,
			ds_arquivo,
			ds_arquivo_backup,
			NR_SEQ_EXAME_EXTERNO)
		values (
			nr_sequencia_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			ds_titulo_p,
			CASE WHEN ie_ds_arquivo='S' THEN ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p  ELSE ds_arquivo_p || nr_atendimento_w || nm_paciente_w || to_char(nr_sequencia_w) || ds_extensao_p END ,
			ds_arquivo_backup_p,
			nr_sequencia_p);
	elsif (ds_AuxPk_w = 'NR_SEQ_IRIDECTOMIA') then

		if (ie_ds_arquivo = 'NS') then
			SELECT  max(nr_atendimento),
				max(SUBSTR(obter_nome_pf(coalesce(b.cd_pessoa_fisica,obter_pessoa_atendimento(b.nr_atendimento,'C'))),1,255))
			into STRICT	nr_atendimento_w,
				nm_paciente_w
			FROM    OFT_IRIDECTOMIA a,
				OFT_CONSULTA b
			WHERE   a.nr_seq_consulta = b.nr_sequencia 
			AND     a.nr_sequencia    = nr_sequencia_p;
			if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
				nr_atendimento_w := nr_atendimento_w || '_';
			end if;
			if (nm_paciente_w IS NOT NULL AND nm_paciente_w::text <> '') then
				nm_paciente_w := nm_paciente_w || '_';
			end if;
		end if;

		insert into oft_consulta_imagem(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			ds_titulo,
			ds_arquivo,
			ds_arquivo_backup,
			NR_SEQ_IRIDECTOMIA)
		values (
			nr_sequencia_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			ds_titulo_p,
			CASE WHEN ie_ds_arquivo='S' THEN ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p  ELSE ds_arquivo_p || nr_atendimento_w || nm_paciente_w || to_char(nr_sequencia_w) || ds_extensao_p END ,
			ds_arquivo_backup_p,
			nr_sequencia_p);

	elsif (ds_AuxPk_w = 'NR_SEQ_FOT_LASER') then

		if (ie_ds_arquivo = 'NS') then
			SELECT  max(nr_atendimento),
				max(SUBSTR(obter_nome_pf(coalesce(b.cd_pessoa_fisica,obter_pessoa_atendimento(b.nr_atendimento,'C'))),1,255))
			into STRICT	nr_atendimento_w,
					nm_paciente_w
			FROM    OFT_FOTOCOAGULACAO_LASER a,
				OFT_CONSULTA b
			WHERE   a.nr_seq_consulta = b.nr_sequencia 
			AND     a.nr_sequencia    = nr_sequencia_p;
			if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
				nr_atendimento_w := nr_atendimento_w || '_';
			end if;
			if (nm_paciente_w IS NOT NULL AND nm_paciente_w::text <> '') then
				nm_paciente_w := nm_paciente_w || '_';
			end if;
		end if;

		insert into oft_consulta_imagem(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			ds_titulo,
			ds_arquivo,
			ds_arquivo_backup,
			NR_SEQ_FOT_LASER)
		values (
			nr_sequencia_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			ds_titulo_p,
			CASE WHEN ie_ds_arquivo='S' THEN ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p  ELSE ds_arquivo_p || nr_atendimento_w || nm_paciente_w || to_char(nr_sequencia_w) || ds_extensao_p END ,
			ds_arquivo_backup_p,
			nr_sequencia_p);			

	elsif (ds_AuxPk_w = 'NR_SEQ_CAPSULOTOMIA') then

		if (ie_ds_arquivo = 'NS') then
			SELECT  max(nr_atendimento),
				max(SUBSTR(obter_nome_pf(coalesce(b.cd_pessoa_fisica,obter_pessoa_atendimento(b.nr_atendimento,'C'))),1,255))
			into STRICT	nr_atendimento_w,
					nm_paciente_w
			FROM    OFT_CAPSULOTOMIA a,
				OFT_CONSULTA b
			WHERE   a.nr_seq_consulta = b.nr_sequencia 
			AND     a.nr_sequencia    = nr_sequencia_p;
			if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
				nr_atendimento_w := nr_atendimento_w || '_';
			end if;
			if (nm_paciente_w IS NOT NULL AND nm_paciente_w::text <> '') then
				nm_paciente_w := nm_paciente_w || '_';
			end if;
		end if;

		insert into oft_consulta_imagem(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			ds_titulo,
			ds_arquivo,
			ds_arquivo_backup,
			NR_SEQ_CAPSULOTOMIA)
		values (
			nr_sequencia_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			ds_titulo_p,
			CASE WHEN ie_ds_arquivo='S' THEN ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p  ELSE ds_arquivo_p || nr_atendimento_w || nm_paciente_w || to_char(nr_sequencia_w) || ds_extensao_p END ,
			ds_arquivo_backup_p,
			nr_sequencia_p);					

	elsif (ds_AuxPk_w = 'NR_SEQ_GONIOSCOPIA') then

		if (ie_ds_arquivo = 'NS') then
			SELECT  max(nr_atendimento),
				max(SUBSTR(obter_nome_pf(coalesce(b.cd_pessoa_fisica,obter_pessoa_atendimento(b.nr_atendimento,'C'))),1,255))
			into STRICT	nr_atendimento_w,
					nm_paciente_w
			FROM    OFT_GONIOSCOPIA a,
					OFT_CONSULTA b
			WHERE   a.nr_seq_consulta = b.nr_sequencia 
			AND     a.nr_sequencia    = nr_sequencia_p;
			if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
				nr_atendimento_w := nr_atendimento_w || '_';
			end if;
			if (nm_paciente_w IS NOT NULL AND nm_paciente_w::text <> '') then
				nm_paciente_w := nm_paciente_w || '_';
			end if;
		end if;

		insert into oft_consulta_imagem(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			ds_titulo,
			ds_arquivo,
			ds_arquivo_backup,
			NR_SEQ_GONIOSCOPIA)
		values (
			nr_sequencia_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			ds_titulo_p,
			CASE WHEN ie_ds_arquivo='S' THEN ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p  ELSE ds_arquivo_p || nr_atendimento_w || nm_paciente_w || to_char(nr_sequencia_w) || ds_extensao_p END ,
			ds_arquivo_backup_p,
			nr_sequencia_p);					

	elsif (ds_AuxPk_w = 'NR_SEQ_ANGIO_RETINO') then

		if (ie_ds_arquivo = 'NS') then
			SELECT  max(nr_atendimento),
				max(SUBSTR(obter_nome_pf(coalesce(b.cd_pessoa_fisica,obter_pessoa_atendimento(b.nr_atendimento,'C'))),1,255))
			into STRICT	nr_atendimento_w,
				nm_paciente_w
			FROM    OFT_ANGIO_RETINO a,
				OFT_CONSULTA b
			WHERE   a.nr_seq_consulta = b.nr_sequencia 
			AND     a.nr_sequencia    = nr_sequencia_p;
			if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
				nr_atendimento_w := nr_atendimento_w || '_';
			end if;
			if (nm_paciente_w IS NOT NULL AND nm_paciente_w::text <> '') then
				nm_paciente_w := nm_paciente_w || '_';
			end if;
		end if;

		insert into oft_consulta_imagem(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			ds_titulo,
			ds_arquivo,
			ds_arquivo_backup,
			NR_SEQ_ANGIO_RETINO)
		values (
			nr_sequencia_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			ds_titulo_p,
			CASE WHEN ie_ds_arquivo='S' THEN ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p  ELSE ds_arquivo_p || nr_atendimento_w || nm_paciente_w || to_char(nr_sequencia_w) || ds_extensao_p END ,
			ds_arquivo_backup_p,
			nr_sequencia_p);
	elsif (ds_AuxPk_w = 'NR_SEQ_OCT') then

		if (ie_ds_arquivo = 'NS') then
			SELECT  max(nr_atendimento),
				max(SUBSTR(obter_nome_pf(coalesce(b.cd_pessoa_fisica,obter_pessoa_atendimento(b.nr_atendimento,'C'))),1,255))
			into STRICT	nr_atendimento_w,
				nm_paciente_w
			FROM    OFT_OCT a,
				OFT_CONSULTA b
			WHERE   a.nr_seq_consulta = b.nr_sequencia 
			AND     a.nr_sequencia    = nr_sequencia_p;
			if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
				nr_atendimento_w := nr_atendimento_w || '_';
			end if;
			if (nm_paciente_w IS NOT NULL AND nm_paciente_w::text <> '') then
				nm_paciente_w := nm_paciente_w || '_';
			end if;
		end if;

		insert into oft_consulta_imagem(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			ds_titulo,
			ds_arquivo,
			ds_arquivo_backup,
			NR_SEQ_OCT)
		values (
			nr_sequencia_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			ds_titulo_p,
			CASE WHEN ie_ds_arquivo='S' THEN ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p  ELSE ds_arquivo_p || nr_atendimento_w || nm_paciente_w || to_char(nr_sequencia_w) || ds_extensao_p END ,
			ds_arquivo_backup_p,
			nr_sequencia_p);			
	elsif (ds_AuxPk_w = 'NR_SEQ_IRIDECTOMIA') then

		if (ie_ds_arquivo = 'NS') then
			SELECT  max(nr_atendimento),
				max(SUBSTR(obter_nome_pf(coalesce(b.cd_pessoa_fisica,obter_pessoa_atendimento(b.nr_atendimento,'C'))),1,255))
			into STRICT	nr_atendimento_w,
				nm_paciente_w
			FROM    OFT_IRIDECTOMIA a,
				OFT_CONSULTA b
			WHERE   a.nr_seq_consulta = b.nr_sequencia 
			AND     a.nr_sequencia    = nr_sequencia_p;
			if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
				nr_atendimento_w := nr_atendimento_w || '_';
			end if;
			if (nm_paciente_w IS NOT NULL AND nm_paciente_w::text <> '') then
				nm_paciente_w := nm_paciente_w || '_';
			end if;
		end if;

		insert into oft_consulta_imagem(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			ds_titulo,
			ds_arquivo,
			ds_arquivo_backup,
			NR_SEQ_IRIDECTOMIA)
		values (
			nr_sequencia_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			ds_titulo_p,
			CASE WHEN ie_ds_arquivo='S' THEN ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p  ELSE ds_arquivo_p || nr_atendimento_w || nm_paciente_w || to_char(nr_sequencia_w) || ds_extensao_p END ,
			ds_arquivo_backup_p,
			nr_sequencia_p);			
	elsif (ds_AuxPk_w = 'NR_SEQ_AVALIACAO') then

		if (ie_ds_arquivo = 'NS') then
			SELECT  MAX(nr_atendimento),
				MAX(SUBSTR(obter_nome_pf(coalesce(cd_pessoa_fisica,obter_pessoa_atendimento(nr_atendimento,'C'))),1,255))
			into STRICT	nr_atendimento_w,
				nm_paciente_w
			FROM    MED_AVALIACAO_PACIENTE
			WHERE   nr_sequencia    = nr_sequencia_p;
			if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
				nr_atendimento_w := nr_atendimento_w || '_';
			end if;
			if (nm_paciente_w IS NOT NULL AND nm_paciente_w::text <> '') then
				nm_paciente_w := nm_paciente_w || '_';
			end if;
		end if;

		insert into oft_consulta_imagem(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			ds_titulo,
			ds_arquivo,
			ds_arquivo_backup,
			NR_SEQ_AVALIACAO)
		values (
			nr_sequencia_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			ds_titulo_p,
			CASE WHEN ie_ds_arquivo='S' THEN ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p  ELSE ds_arquivo_p || nr_atendimento_w || nm_paciente_w || to_char(nr_sequencia_w) || ds_extensao_p END ,
			ds_arquivo_backup_p,
			nr_sequencia_p);
	elsif (ds_AuxPk_w = 'NR_SEQ_DALTONISMO') then
		insert into oft_consulta_imagem(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			ds_titulo,
			ds_arquivo,
			ds_arquivo_backup,
			nr_seq_daltonismo)
		values (
			nr_sequencia_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			ds_titulo_p,
			CASE WHEN ie_ds_arquivo='S' THEN ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p  ELSE ds_arquivo_p || nr_atendimento_w || nm_paciente_w || to_char(nr_sequencia_w) || ds_extensao_p END ,
			ds_arquivo_backup_p,
			nr_sequencia_p);

	elsif (ds_AuxPk_w = 'NR_SEQ_ULTRASSONOGRAFIA') then

		if (ie_ds_arquivo = 'NS') then
			SELECT   max(nr_atendimento),
					   max(SUBSTR(obter_nome_pf(coalesce(b.cd_pessoa_fisica,obter_pessoa_atendimento(b.nr_atendimento,'C'))),1,255))
			into STRICT		nr_atendimento_w,
						nm_paciente_w
			FROM  	OFT_ULTRASSONOGRAFIA a,
						OFT_CONSULTA b
			WHERE    a.nr_seq_consulta = b.nr_sequencia 
			AND      a.nr_sequencia    = nr_sequencia_p;
			if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
				nr_atendimento_w := nr_atendimento_w || '_';
			end if;
			if (nm_paciente_w IS NOT NULL AND nm_paciente_w::text <> '') then
				nm_paciente_w := nm_paciente_w || '_';
			end if;
		end if;

		insert into oft_consulta_imagem(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			ds_titulo,
			ds_arquivo,
			ds_arquivo_backup,
			NR_SEQ_ULTRASSONOGRAFIA)
		values (
			nr_sequencia_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			ds_titulo_p,
			CASE WHEN ie_ds_arquivo='S' THEN ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p  ELSE ds_arquivo_p || nr_atendimento_w || nm_paciente_w || to_char(nr_sequencia_w) || ds_extensao_p END ,
			ds_arquivo_backup_p,
			nr_sequencia_p);

	elsif (ds_AuxPk_w = 'NR_SEQ_MAPEAMENTO') then

		if (ie_ds_arquivo = 'NS') then
			SELECT   max(nr_atendimento),
					   max(SUBSTR(obter_nome_pf(coalesce(b.cd_pessoa_fisica,obter_pessoa_atendimento(b.nr_atendimento,'C'))),1,255))
			into STRICT		nr_atendimento_w,
						nm_paciente_w
			FROM  	OFT_MAPEAMENTO_RETINA a,
						OFT_CONSULTA b
			WHERE    a.nr_seq_consulta = b.nr_sequencia 
			AND      a.nr_sequencia    = nr_sequencia_p;
			if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
				nr_atendimento_w := nr_atendimento_w || '_';
			end if;
			if (nm_paciente_w IS NOT NULL AND nm_paciente_w::text <> '') then
				nm_paciente_w := nm_paciente_w || '_';
			end if;
		end if;

		insert into oft_consulta_imagem(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			ds_titulo,
			ds_arquivo,
			ds_arquivo_backup,
			NR_SEQ_MAPEAMENTO)
		values (
			nr_sequencia_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			ds_titulo_p,
			CASE WHEN ie_ds_arquivo='S' THEN ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p  ELSE ds_arquivo_p || nr_atendimento_w || nm_paciente_w || to_char(nr_sequencia_w) || ds_extensao_p END ,
			ds_arquivo_backup_p,
			nr_sequencia_p);

  elsif (ds_AuxPk_w = 'NR_SEQ_ABERROMETRIA') then 

		if (ie_ds_arquivo = 'NS') then
			SELECT   max(nr_atendimento),
					   max(SUBSTR(obter_nome_pf(coalesce(b.cd_pessoa_fisica,obter_pessoa_atendimento(b.nr_atendimento,'C'))),1,255))
			into STRICT		nr_atendimento_w,
						nm_paciente_w
			FROM  	OFT_ABERROMETRIA a,
						OFT_CONSULTA b
			WHERE    a.nr_seq_consulta = b.nr_sequencia 
			AND      a.nr_sequencia    = nr_sequencia_p;
			if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
				nr_atendimento_w := nr_atendimento_w || '_';
			end if;
			if (nm_paciente_w IS NOT NULL AND nm_paciente_w::text <> '') then
				nm_paciente_w := nm_paciente_w || '_';
			end if;
		end if;

		insert into oft_consulta_imagem(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			ds_titulo,
			ds_arquivo,
			ds_arquivo_backup,
			NR_SEQ_ABERROMETRIA)
		values (
			nr_sequencia_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			ds_titulo_p,
			CASE WHEN ie_ds_arquivo='S' THEN ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p  ELSE ds_arquivo_p || nr_atendimento_w || nm_paciente_w || to_char(nr_sequencia_w) || ds_extensao_p END ,
			ds_arquivo_backup_p,
			nr_sequencia_p);

	end if;	

elsif	((nm_tabela_w = 'cur_ferida_imagem')  or (nm_tabela_w = 'cur_imagem'))then

	select	nextval('oft_consulta_imagem_seq')
	into STRICT	nr_sequencia_w
	;
	insert into cur_ferida_imagem(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		ds_titulo,
		ds_arquivo,
		ds_arquivo_backup,
		nr_seq_ferida)
	values (
		nr_sequencia_w,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		ds_titulo_p,
		ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p,
		ds_arquivo_backup_p,
		nr_sequencia_p);
elsif	((upper(nm_tabela_w) = 'CPOE_PROC_IMAGES')  or (upper(nm_tabela_w) = 'CPOE_RULE_IMAGES'))then

	select	nextval('cpoe_proc_images_seq')
	into STRICT	nr_sequencia_w
	;
	insert into cpoe_proc_images(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		ds_titulo,
		ds_arquivo,
		nr_seq_proc_cpoe,
		nr_seq_proc_cpoe_edit)values (
		nr_sequencia_w,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		ds_titulo_p,
		ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p,
		nr_sequencia_p,
		nr_sequencia_p);
elsif (nm_tabela_w = 'rxt_trat_campo_roen_imagem') then

	select	nextval('rxt_trat_campo_roen_imagem_seq')
	into STRICT	nr_sequencia_w
	;

	insert	into rxt_trat_campo_roen_imagem(nr_sequencia,
		nr_seq_campo_trat,
		ds_titulo,
		ds_arquivo,
		ds_arquivo_backup,
		dt_atualizacao,
		nm_usuario)
	values (nr_sequencia_w,
		nr_sequencia_p,
		ds_titulo_p,
		ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p,
		ds_arquivo_backup_p,
		clock_timestamp(),
		nm_usuario_p);
elsif (upper(nm_tabela_w) = 'PAC_CI_IMAGEM') then

	select	nextval('pac_ci_imagem_seq')
	into STRICT	nr_sequencia_w
	;

	insert	into pac_ci_imagem(nr_sequencia,
		nr_seq_consent,
		ds_titulo,
		ds_arquivo,
		dt_atualizacao,
		nm_usuario)
	values (nr_sequencia_w,
		nr_sequencia_p,
		ds_titulo_p,
		ds_arquivo_p,
		clock_timestamp(),
		nm_usuario_p);
elsif (upper(nm_tabela_w) = 'EXT_REF_IMAGEM') then

	select	nextval('rl_ref_from_hosp_inform_seq')
	into STRICT	nr_sequencia_w
	;

	insert	into ext_ref_imagem(nr_sequencia,
		nr_seq_ext_ref1,
		ds_titulo,
		ds_arquivo,
		dt_atualizacao,
		nm_usuario)
	values (nr_sequencia_w,
		nr_sequencia_p,
		ds_titulo_p,
		ds_arquivo_p,
		clock_timestamp(),
		nm_usuario_p);
elsif (upper(nm_tabela_w) = 'EXT_REF_IMAGEM1') then

	select	nextval('ext_ref_imagem1_seq')
	into STRICT	nr_sequencia_w
	;

	insert	into ext_ref_imagem1(nr_sequencia,
		nr_seq_ext_ref2,
		ds_titulo,
		ds_arquivo,
		dt_atualizacao,
		nm_usuario)
	values (nr_sequencia_w,
		nr_sequencia_p,
		ds_titulo_p,
		ds_arquivo_p,
		clock_timestamp(),
		nm_usuario_p);
elsif (upper(nm_tabela_w) = 'EXT_REF_IMAGEM3') then
	select	nextval('ext_ref_imagem3_seq')
	into STRICT	nr_sequencia_w
	;

	insert	into ext_ref_imagem3(nr_sequencia,
		nr_seq_ext_ref3,
		ds_titulo,
		ds_arquivo,
		dt_atualizacao,
		nm_usuario)
	values (nr_sequencia_w,
		nr_sequencia_p,
		ds_titulo_p,
		ds_arquivo_p,
		clock_timestamp(),
		nm_usuario_p);
elsif (upper(nm_tabela_w) = 'EXT_REF_IMAGEM4') then
	select	nextval('ext_ref_imagem4_seq')
	into STRICT	nr_sequencia_w
	;

	insert	into ext_ref_imagem4(nr_sequencia,
		nr_seq_ext_ref4,
		ds_titulo,
		ds_arquivo,
		dt_atualizacao,
		nm_usuario)
	values (nr_sequencia_w,
		nr_sequencia_p,
		ds_titulo_p,
		ds_arquivo_p,
		clock_timestamp(),
		nm_usuario_p);
end if;

commit;

if (ie_padrao_laudo_w = 'A') and (nm_tabela_w = 'laudo_pac_imagem_edicao') then
	nm_arquivo_ret_p	:= ds_arquivo_p || nr_atendimento_w || ' - ' || to_char(nr_sequencia_w) || ds_extensao_p;
elsif (ie_padrao_laudo_w = 'P') and (nm_tabela_w = 'laudo_pac_imagem_edicao') then
	nm_arquivo_ret_p	:= ds_arquivo_p || to_char(nr_prescricao_w) || ' - ' || to_char(nr_sequencia_w) || ds_extensao_p;
elsif (ie_padrao_laudo_w = 'AP') and (nm_tabela_w = 'laudo_pac_imagem_edicao') then
	nm_arquivo_ret_p	:= ds_arquivo_p || nr_atendimento_w || '-' || to_char(nr_prescricao_w) || ' - ' || to_char(nr_sequencia_w) || ds_extensao_p;
elsif (ie_ds_arquivo = 'S') then
	nm_arquivo_ret_p	:= ds_arquivo_p || nr_atendimento_w || to_char(nr_sequencia_w) || ds_extensao_p;
elsif (upper(nm_tabela_w) = 'PACIENTE_IMAGEM') then
	nm_arquivo_ret_p	:= ds_arquivo_p || to_char(nr_sequencia_w) || ds_extensao_p	;
else
	nm_arquivo_ret_p	:= ds_arquivo_p || nr_atendimento_w || nm_paciente_w || to_char(nr_sequencia_w) || ds_extensao_p;
end if;

nm_tabela_ret_p			:= nm_tabela_w;
nr_sequencia_ret_p		:= nr_sequencia_w;

end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gravar_imagem_html5 ( nr_sequencia_p bigint, ds_titulo_p text, ds_arquivo_p text, ds_arquivo_backup_p text, ds_extensao_p text, nm_usuario_p text, nm_tabela_p text, cd_estabelecimento_p bigint, nm_arquivo_ret_p INOUT text, nm_tabela_ret_p INOUT text, nr_sequencia_ret_p INOUT bigint, ds_AuxPk_p text default null, ie_atualiza_p text default 'N') FROM PUBLIC;

