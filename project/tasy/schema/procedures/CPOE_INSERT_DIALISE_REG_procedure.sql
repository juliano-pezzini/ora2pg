-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cpoe_insert_dialise_reg ( nr_atendimento_p atendimento_paciente.nr_atendimento%type, cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%type, nr_prescricao_p prescr_medica.nr_prescricao%type, nr_sequencia_p cpoe_dialise.nr_sequencia%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, cd_perfil_p perfil.cd_perfil%type, nm_usuario_p usuario.nm_usuario%type, dt_inicio_prescr_p timestamp, dt_inicio_ret_p INOUT timestamp) AS $body$
DECLARE


ie_categoria_w				cpoe_dialise.ie_categoria%type;
ie_tipo_hemodialise_w		cpoe_dialise.ie_tipo_hemodialise%type;
qt_fluxo_sangue_w			cpoe_dialise.qt_fluxo_sangue%type;
nr_seq_mod_dialisador_w		cpoe_dialise.nr_seq_mod_dialisador%type;
ie_cateter_w 				cpoe_dialise.ie_cateter%type;
qt_peso_pos_w 				cpoe_dialise.qt_peso_pos%type;
qt_peso_atual_w 			cpoe_dialise.qt_peso_atual%type;
qt_peso_ideal_w				cpoe_dialise.qt_peso_ideal%type;
ie_ultrafiltracao_w			cpoe_dialise.ie_ultrafiltracao%type;
qt_ultrafiltracao_w			cpoe_dialise.qt_ultrafiltracao%type;
nr_seq_diametro_agulha_w	cpoe_dialise.nr_seq_diametro_agulha%type;
nr_seq_tipo_agulha_w		cpoe_dialise.nr_seq_tipo_agulha%type;
nr_seq_tipo_agulha_art_w	cpoe_dialise.nr_seq_tipo_agulha_art%type;
nr_seq_ultra_w				cpoe_dialise.nr_seq_ultra%type;
nr_seq_perfil_sodio_w		cpoe_dialise.nr_seq_perfil_sodio%type;
qt_zero_um_w				cpoe_dialise.qt_zero_um%type;
qt_um_dois_w				cpoe_dialise.qt_um_dois%type;
qt_dois_tres_w				cpoe_dialise.qt_dois_tres%type;	
qt_tres_quatro_w			cpoe_dialise.qt_tres_quatro%type;
qt_quatro_cinco_w			cpoe_dialise.qt_quatro_cinco%type;
qt_cinco_seis_w				cpoe_dialise.qt_cinco_seis%type;
qt_sodio_w					cpoe_dialise.qt_sodio%type;
qt_calcio_w					cpoe_dialise.qt_calcio%type;
qt_bicarbonato_w			cpoe_dialise.qt_bicarbonato%type;
ie_ligar_prime_w			cpoe_dialise.ie_ligar_prime%type;	
qt_volume_prime_w			cpoe_dialise.qt_volume_prime%type;
nm_usuario_w				cpoe_dialise.nm_usuario%type;
nm_usuario_nrec_w			cpoe_dialise.nm_usuario_nrec%type;
dt_atualizacao_w 			cpoe_dialise.dt_atualizacao%type;
dt_atualizacao_nrec_w 		cpoe_dialise.dt_atualizacao_nrec%type;
ie_tipo_dialise_w 			cpoe_dialise.ie_tipo_dialise%type;
ie_tipo_peritoneal_w		cpoe_dialise.ie_tipo_peritoneal%type;
nr_ciclos_w					cpoe_dialise.nr_ciclos%type;
qt_volume_ciclo_w			cpoe_dialise.qt_volume_ciclo%type;
nr_seq_maq_cicladora_w		cpoe_dialise.nr_seq_maq_cicladora%type;
nr_serie_w					cpoe_dialise.nr_serie%type;
qt_volume_total_di_w		cpoe_dialise.qt_volume_total_di%type;
qt_minimo_volume_w			cpoe_dialise.qt_minimo_volume%type;
ie_perm_inteligente_w		cpoe_dialise.ie_perm_inteligente%type;
ie_apagar_visor_w			cpoe_dialise.ie_apagar_visor%type;
ie_modo_dialise_w			cpoe_dialise.ie_modo_dialise%type;
qt_tempo_min_drenagem_w		cpoe_dialise.qt_tempo_min_drenagem%type;
qt_limite_uf_negativo_w		cpoe_dialise.qt_limite_uf_negativo%type;
qt_limite_uf_positivo_w		cpoe_dialise.qt_limite_uf_positivo%type;
ie_ausente_w				cpoe_dialise.ie_ausente%type;
dt_inicio_dialise_w			cpoe_dialise.dt_inicio%type;
dt_fim_dialise_w			cpoe_dialise.dt_fim%type;
ie_volume_alarm_w			cpoe_dialise.ie_volume_alarme%type;
ie_administracao_w			cpoe_dialise.ie_administracao%type;
nr_seq_perfil_bic_w			cpoe_dialise.nr_seq_perfil_bic%type;	
qt_zero_um_bic_w			cpoe_dialise.qt_zero_um_bic%type;
qt_um_dois_bic_w			cpoe_dialise.qt_um_dois_bic%type;
qt_dois_tres_bic_w			cpoe_dialise.qt_dois_tres_bic%type;
qt_tres_quatro_bic_w		cpoe_dialise.qt_tres_quatro_bic%type;
qt_quatro_cinco_bic_w		cpoe_dialise.qt_quatro_cinco_bic%type;
qt_cinco_seis_bic_w			cpoe_dialise.qt_cinco_seis_bic%type;	

--vinculo 1
nr_seq_protocolo_w			cpoe_dialise.nr_seq_protocolo%type;
ie_tipo_solucao_w			cpoe_dialise.ie_tipo_solucao%type;
qt_solucao_total_w			cpoe_dialise.qt_solucao_total%type;
qt_temp_solucao_w			cpoe_dialise.qt_temp_solucao%type;
qt_dosagem_w				cpoe_dialise.qt_dosagem%type;
ie_unid_vel_inf_w			cpoe_dialise.ie_unid_vel_inf%type;
ie_bomba_infusao_w			cpoe_dialise.ie_bomba_infusao%type;
qt_dose_ataque_w			cpoe_dialise.qt_dose_ataque%type;
ds_orientacao_w				cpoe_dialise.ds_orientacao%type;
cd_mat_soluc1_w				cpoe_dialise.cd_mat_soluc1%type;
qt_dose_soluc1_w			cpoe_dialise.qt_dose_soluc1%type;
cd_unid_med_dose_sol1_w		cpoe_dialise.cd_unid_med_dose_sol1%type;
cd_mat_soluc2_w				cpoe_dialise.cd_mat_soluc2%type;
qt_dose_soluc2_w			cpoe_dialise.qt_dose_soluc2%type;
cd_unid_med_dose_sol2_w		cpoe_dialise.cd_unid_med_dose_sol2%type;
cd_mat_soluc3_w				cpoe_dialise.cd_mat_soluc3%type;
qt_dose_soluc3_w			cpoe_dialise.qt_dose_soluc3%type;
cd_unid_med_dose_sol3_w		cpoe_dialise.cd_unid_med_dose_sol3%type;
cd_mat_soluc4_w				cpoe_dialise.cd_mat_soluc4%type;
qt_dose_soluc4_w			cpoe_dialise.qt_dose_soluc4%type;
cd_unid_med_dose_sol4_w		cpoe_dialise.cd_unid_med_dose_sol4%type;
cd_mat_soluc5_w				cpoe_dialise.cd_mat_soluc5%type;
qt_dose_soluc5_w			cpoe_dialise.qt_dose_soluc5%type;
cd_unid_med_dose_sol5_w		cpoe_dialise.cd_unid_med_dose_sol5%type;
cd_mat_soluc6_w				cpoe_dialise.cd_mat_soluc6%type;
qt_dose_soluc6_w			cpoe_dialise.qt_dose_soluc6%type;
cd_unid_med_dose_sol6_w		cpoe_dialise.cd_unid_med_dose_sol6%type;
cd_mat_soluc7_w				cpoe_dialise.cd_mat_soluc7%type;
qt_dose_soluc7_w			cpoe_dialise.qt_dose_soluc7%type;
cd_unid_med_dose_sol7_w		cpoe_dialise.cd_unid_med_dose_sol7%type;
--vinculo 2 
nr_seq_protocolo2_w			cpoe_dialise.nr_seq_protocolo2%type;
ie_tipo_solucao2_w			cpoe_dialise.ie_tipo_solucao2%type;
qt_solucao_total2_w			cpoe_dialise.qt_solucao_total2%type;
qt_temp_solucao2_w			cpoe_dialise.qt_temp_solucao2%type;
qt_dosagem2_w				cpoe_dialise.qt_dosagem2%type;
ie_unid_vel_inf2_w			cpoe_dialise.ie_unid_vel_inf2%type;
ie_bomba_infusao2_w			cpoe_dialise.ie_bomba_infusao2%type;
qt_dose_ataque2_w			cpoe_dialise.qt_dose_ataque2%type;
ds_orientacao2_w			cpoe_dialise.ds_orientacao2%type;
cd_mat_soluc1_2_w			cpoe_dialise.cd_mat_soluc1_2%type;
qt_dose_soluc1_2_w			cpoe_dialise.qt_dose_soluc1_2%type;
cd_unid_med_dose_sol1_2_w	cpoe_dialise.cd_unid_med_dose_sol1_2%type;
cd_mat_soluc2_2_w			cpoe_dialise.cd_mat_soluc2_2%type;
qt_dose_soluc2_2_w			cpoe_dialise.qt_dose_soluc2_2%type;
cd_unid_med_dose_sol2_2_w	cpoe_dialise.cd_unid_med_dose_sol2_2%type;
cd_mat_soluc3_2_w			cpoe_dialise.cd_mat_soluc3_2%type;
qt_dose_soluc3_2_w			cpoe_dialise.qt_dose_soluc3_2%type;
cd_unid_med_dose_sol3_2_w	cpoe_dialise.cd_unid_med_dose_sol3_2%type;
cd_mat_soluc4_2_w			cpoe_dialise.cd_mat_soluc4_2%type;
qt_dose_soluc4_2_w			cpoe_dialise.qt_dose_soluc4_2%type;
cd_unid_med_dose_sol4_2_w	cpoe_dialise.cd_unid_med_dose_sol4_2%type;
cd_mat_soluc5_2_w			cpoe_dialise.cd_mat_soluc5_2%type;
qt_dose_soluc5_2_w			cpoe_dialise.qt_dose_soluc5_2%type;
cd_unid_med_dose_sol5_2_w	cpoe_dialise.cd_unid_med_dose_sol5_2%type;
cd_mat_soluc6_2_w			cpoe_dialise.cd_mat_soluc6_2%type;
qt_dose_soluc6_2_w			cpoe_dialise.qt_dose_soluc6_2%type;
cd_unid_med_dose_sol6_2_w	cpoe_dialise.cd_unid_med_dose_sol6_2%type;
cd_mat_soluc7_2_w			cpoe_dialise.cd_mat_soluc7_2%type;
qt_dose_soluc7_2_w			cpoe_dialise.qt_dose_soluc7_2%type;
cd_unid_med_dose_sol7_2_w	cpoe_dialise.cd_unid_med_dose_sol7_2%type;
--vinculo 3
nr_seq_protocolo3_w			cpoe_dialise.nr_seq_protocolo3%type;
ie_tipo_solucao3_w			cpoe_dialise.ie_tipo_solucao3%type;
qt_solucao_total3_w			cpoe_dialise.qt_solucao_total3%type;
qt_temp_solucao3_w			cpoe_dialise.qt_temp_solucao3%type;
qt_dosagem3_w				cpoe_dialise.qt_dosagem3%type;
ie_unid_vel_inf3_w			cpoe_dialise.ie_unid_vel_inf3%type;
ie_bomba_infusao3_w			cpoe_dialise.ie_bomba_infusao3%type;
qt_dose_ataque3_w			cpoe_dialise.qt_dose_ataque3%type;
ds_orientacao3_w			cpoe_dialise.ds_orientacao3%type;
cd_mat_soluc1_3_w			cpoe_dialise.cd_mat_soluc1_3%type;
qt_dose_soluc1_3_w			cpoe_dialise.qt_dose_soluc1_3%type;
cd_unid_med_dose_sol1_3_w	cpoe_dialise.cd_unid_med_dose_sol1_3%type;
cd_mat_soluc2_3_w			cpoe_dialise.cd_mat_soluc2_3%type;
qt_dose_soluc2_3_w			cpoe_dialise.qt_dose_soluc2_3%type;
cd_unid_med_dose_sol2_3_w	cpoe_dialise.cd_unid_med_dose_sol2_3%type;
cd_mat_soluc3_3_w			cpoe_dialise.cd_mat_soluc3_3%type;
qt_dose_soluc3_3_w			cpoe_dialise.qt_dose_soluc3_3%type;
cd_unid_med_dose_sol3_3_w	cpoe_dialise.cd_unid_med_dose_sol3_3%type;
cd_mat_soluc4_3_w			cpoe_dialise.cd_mat_soluc4_3%type;
qt_dose_soluc4_3_w			cpoe_dialise.qt_dose_soluc4_3%type;
cd_unid_med_dose_sol4_3_w	cpoe_dialise.cd_unid_med_dose_sol4_3%type;
cd_mat_soluc5_3_w			cpoe_dialise.cd_mat_soluc5_3%type;
qt_dose_soluc5_3_w			cpoe_dialise.qt_dose_soluc5_3%type;
cd_unid_med_dose_sol5_3_w	cpoe_dialise.cd_unid_med_dose_sol5_3%type;
cd_mat_soluc6_3_w			cpoe_dialise.cd_mat_soluc6_3%type;
qt_dose_soluc6_3_w			cpoe_dialise.qt_dose_soluc6_3%type;
cd_unid_med_dose_sol6_3_w	cpoe_dialise.cd_unid_med_dose_sol6_3%type;
cd_mat_soluc7_3_w			cpoe_dialise.cd_mat_soluc7_3%type;
qt_dose_soluc7_3_w			cpoe_dialise.qt_dose_soluc7_3%type;
cd_unid_med_dose_sol7_3_w	cpoe_dialise.cd_unid_med_dose_sol7_3%type;
--vinculo 4
nr_seq_protocolo4_w			cpoe_dialise.nr_seq_protocolo4%type;
ie_tipo_solucao4_w			cpoe_dialise.ie_tipo_solucao4%type;
qt_solucao_total4_w			cpoe_dialise.qt_solucao_total4%type;
qt_temp_solucao4_w			cpoe_dialise.qt_temp_solucao4%type;
qt_dosagem4_w				cpoe_dialise.qt_dosagem4%type;
ie_unid_vel_inf4_w			cpoe_dialise.ie_unid_vel_inf4%type;
ie_bomba_infusao4_w			cpoe_dialise.ie_bomba_infusao4%type;
qt_dose_ataque4_w			cpoe_dialise.qt_dose_ataque4%type;
ds_orientacao4_w			cpoe_dialise.ds_orientacao4%type;
cd_mat_soluc1_4_w			cpoe_dialise.cd_mat_soluc1_4%type;
qt_dose_soluc1_4_w			cpoe_dialise.qt_dose_soluc1_4%type;
cd_unid_med_dose_sol1_4_w	cpoe_dialise.cd_unid_med_dose_sol1_4%type;
cd_mat_soluc2_4_w			cpoe_dialise.cd_mat_soluc2_4%type;
qt_dose_soluc2_4_w			cpoe_dialise.qt_dose_soluc2_4%type;
cd_unid_med_dose_sol2_4_w	cpoe_dialise.cd_unid_med_dose_sol2_4%type;
cd_mat_soluc3_4_w			cpoe_dialise.cd_mat_soluc3_4%type;
qt_dose_soluc3_4_w			cpoe_dialise.qt_dose_soluc3_4%type;
cd_unid_med_dose_sol3_4_w	cpoe_dialise.cd_unid_med_dose_sol3_4%type;
cd_mat_soluc4_4_w			cpoe_dialise.cd_mat_soluc4_4%type;
qt_dose_soluc4_4_w			cpoe_dialise.qt_dose_soluc4_4%type;
cd_unid_med_dose_sol4_4_w	cpoe_dialise.cd_unid_med_dose_sol4_4%type;
cd_mat_soluc5_4_w			cpoe_dialise.cd_mat_soluc5_4%type;
qt_dose_soluc5_4_w			cpoe_dialise.qt_dose_soluc5_4%type;
cd_unid_med_dose_sol5_4_w	cpoe_dialise.cd_unid_med_dose_sol5_4%type;
cd_mat_soluc6_4_w			cpoe_dialise.cd_mat_soluc6_4%type;
qt_dose_soluc6_4_w			cpoe_dialise.qt_dose_soluc6_4%type;
cd_unid_med_dose_sol6_4_w	cpoe_dialise.cd_unid_med_dose_sol6_4%type;
cd_mat_soluc7_4_w			cpoe_dialise.cd_mat_soluc7_4%type;
qt_dose_soluc7_4_w			cpoe_dialise.qt_dose_soluc7_4%type;
cd_unid_med_dose_sol7_4_w	cpoe_dialise.cd_unid_med_dose_sol7_4%type;
--vinculo 5
nr_seq_protocolo5_w			cpoe_dialise.nr_seq_protocolo5%type;
ie_tipo_solucao5_w			cpoe_dialise.ie_tipo_solucao5%type;
qt_solucao_total5_w			cpoe_dialise.qt_solucao_total5%type;
qt_temp_solucao5_w			cpoe_dialise.qt_temp_solucao5%type;
qt_dosagem5_w				cpoe_dialise.qt_dosagem5%type;
ie_unid_vel_inf5_w			cpoe_dialise.ie_unid_vel_inf5%type;
ie_bomba_infusao5_w			cpoe_dialise.ie_bomba_infusao5%type;
qt_dose_ataque5_w			cpoe_dialise.qt_dose_ataque5%type;
ds_orientacao5_w			cpoe_dialise.ds_orientacao5%type;
cd_mat_soluc1_5_w			cpoe_dialise.cd_mat_soluc1_5%type;
qt_dose_soluc1_5_w			cpoe_dialise.qt_dose_soluc1_5%type;
cd_unid_med_dose_sol1_5_w	cpoe_dialise.cd_unid_med_dose_sol1_5%type;
cd_mat_soluc2_5_w			cpoe_dialise.cd_mat_soluc2_5%type;
qt_dose_soluc2_5_w			cpoe_dialise.qt_dose_soluc2_5%type;
cd_unid_med_dose_sol2_5_w	cpoe_dialise.cd_unid_med_dose_sol2_5%type;
cd_mat_soluc3_5_w			cpoe_dialise.cd_mat_soluc3_5%type;
qt_dose_soluc3_5_w			cpoe_dialise.qt_dose_soluc3_5%type;
cd_unid_med_dose_sol3_5_w	cpoe_dialise.cd_unid_med_dose_sol3_5%type;
cd_mat_soluc4_5_w			cpoe_dialise.cd_mat_soluc4_5%type;
qt_dose_soluc4_5_w			cpoe_dialise.qt_dose_soluc4_5%type;
cd_unid_med_dose_sol4_5_w	cpoe_dialise.cd_unid_med_dose_sol4_5%type;
cd_mat_soluc5_5_w			cpoe_dialise.cd_mat_soluc5_5%type;
qt_dose_soluc5_5_w			cpoe_dialise.qt_dose_soluc5_5%type;
cd_unid_med_dose_sol5_5_w	cpoe_dialise.cd_unid_med_dose_sol5_5%type;
cd_mat_soluc6_5_w			cpoe_dialise.cd_mat_soluc6_5%type;
qt_dose_soluc6_5_w			cpoe_dialise.qt_dose_soluc6_5%type;
cd_unid_med_dose_sol6_5_w	cpoe_dialise.cd_unid_med_dose_sol6_5%type;
cd_mat_soluc7_5_w			cpoe_dialise.cd_mat_soluc7_5%type;
qt_dose_soluc7_5_w			cpoe_dialise.qt_dose_soluc7_5%type;
cd_unid_med_dose_sol7_5_w	cpoe_dialise.cd_unid_med_dose_sol7_5%type;
--Fim
ie_hemodialise_w			cpoe_dialise.ie_hemodialise%type;
qt_tempo_infusao_w			cpoe_dialise.qt_tempo_infusao%type;
qt_tempo_perm_hor_w			cpoe_dialise.qt_tempo_permanencia%type;
qt_tempo_permanencia_w		cpoe_dialise.qt_tempo_permanencia%type;
qt_tempo_drenagem_w			cpoe_dialise.qt_tempo_drenagem%type;
hr_inicio_capd_w			cpoe_dialise.hr_inicio_capd%type;
hr_fim_capd_w				cpoe_dialise.hr_fim_capd%type;
qt_volume_sol_w				cpoe_dialise.qt_volume_sol%type;
qt_volume_sol2_w			cpoe_dialise.qt_volume_sol2%type;
qt_volume_sol3_w			cpoe_dialise.qt_volume_sol3%type;
qt_volume_sol4_w			cpoe_dialise.qt_volume_sol4%type;
qt_volume_sol5_w			cpoe_dialise.qt_volume_sol5%type;
ie_ultima_bolsa_w			cpoe_dialise.ie_ultima_bolsa%type;
ie_ultima_bolsa2_w			cpoe_dialise.ie_ultima_bolsa2%type;
ie_ultima_bolsa3_w			cpoe_dialise.ie_ultima_bolsa3%type;
ie_ultima_bolsa4_w			cpoe_dialise.ie_ultima_bolsa4%type;
ie_ultima_bolsa5_w			cpoe_dialise.ie_ultima_bolsa5%type;
ie_tidal_w					cpoe_dialise.ie_tidal%type;
ie_tidal2_w					cpoe_dialise.ie_tidal2%type;
ie_tidal3_w					cpoe_dialise.ie_tidal3%type;
ie_tidal4_w					cpoe_dialise.ie_tidal4%type;
ie_tidal5_w					cpoe_dialise.ie_tidal5%type;
ie_lavar_linhas_w			cpoe_dialise.ie_lavar_linhas%type;
ie_lavar_linhas2_w			cpoe_dialise.ie_lavar_linhas2%type;
ie_lavar_linhas3_w			cpoe_dialise.ie_lavar_linhas3%type;
ie_lavar_linhas4_w			cpoe_dialise.ie_lavar_linhas4%type;
ie_lavar_linhas5_w			cpoe_dialise.ie_lavar_linhas5%type;
ds_observacao_w				cpoe_dialise.ds_observacao%type;
pr_concentracao_w 			cpoe_dialise.pr_concentracao%type;
pr_concentracao2_w 			cpoe_dialise.pr_concentracao2%type;
pr_concentracao3_w 			cpoe_dialise.pr_concentracao3%type;
pr_concentracao4_w 			cpoe_dialise.pr_concentracao4%type;
pr_concentracao5_w 			cpoe_dialise.pr_concentracao5%type;
nr_sequencia_orig_w			cpoe_dialise.nr_sequencia%type;
dt_prox_geracao_w			cpoe_dialise.dt_prox_geracao%type;

nr_prescricao_orig_w		prescr_medica.nr_prescricao%type;

nr_sequencia_hd_w			hd_prescricao.nr_sequencia%type;

cd_pessoa_fisica_w			pessoa_fisica.cd_pessoa_fisica%type;

nr_seq_solucao_w 			prescr_solucao.nr_seq_solucao%type;	

dt_inicio_w 				timestamp;
dt_proxima_dose_w			timestamp;
dt_inicio_base_w			timestamp;
nr_horas_prox_geracao_w		bigint;
qt_hora_min_sessao_w		varchar(255);
qt_min_sessao_w				varchar(255);
qt_hora_min_duracao_w		varchar(255);
qt_min_duracao_w			varchar(255);
ds_erro_w					varchar(2000);

C01 CURSOR FOR
	SELECT	ie_categoria,
			ie_tipo_hemodialise, 
			qt_fluxo_sangue,
			substr(qt_hora_min_sessao,1,2) qt_hora_min_sessao,
			substr(qt_hora_min_sessao,4,5) qt_min_sessao,
			nr_seq_mod_dialisador, 
			ie_cateter, 
			qt_peso_pos, 
			qt_peso_atual, 
			qt_peso_ideal, 
			ie_ultrafiltracao, 
			qt_ultrafiltracao, 
			nr_seq_diametro_agulha, 
			nr_seq_tipo_agulha, 
			nr_seq_tipo_agulha_art, 
			nr_seq_ultra, 
			nr_seq_perfil_sodio, 
			qt_zero_um, 
			qt_um_dois, 
			qt_dois_tres, 
			qt_tres_quatro, 
			qt_quatro_cinco,
			qt_cinco_seis, 
			qt_sodio, 
			qt_calcio, 
			qt_bicarbonato, 
			ie_ligar_prime, 
			qt_volume_prime, 
			nm_usuario, 
			nm_usuario_nrec,
			dt_atualizacao, 
			dt_atualizacao_nrec,
			ie_tipo_dialise, 
            ie_tipo_peritoneal,
            nr_ciclos,
            qt_volume_ciclo,            		    			
			substr(qt_hora_min_duracao,1,2) qt_hora_min_duracao,
			substr(qt_hora_min_duracao,4,5) qt_min_duracao,			
			nr_seq_maq_cicladora,
            nr_serie,
            qt_volume_total_di,
            qt_minimo_volume,
            ie_perm_inteligente,
            ie_apagar_visor,
            ie_modo_dialise,
            qt_tempo_min_drenagem,
            qt_limite_uf_negativo,
            qt_limite_uf_positivo,
            ie_ausente,
            dt_inicio,
            dt_fim,
            ie_volume_alarme,
			coalesce(ie_administracao,'P'),
			nr_seq_protocolo,
			ie_tipo_solucao,
			qt_solucao_total,
			qt_temp_solucao,
			qt_dosagem,
			ie_unid_vel_inf,
			ie_bomba_infusao,
			qt_dose_ataque,
			ds_orientacao,
			cd_mat_soluc1,
			qt_dose_soluc1,
			cd_unid_med_dose_sol1,
			cd_mat_soluc2,
			qt_dose_soluc2,
			cd_unid_med_dose_sol2,
			cd_mat_soluc3,
			qt_dose_soluc3,
			cd_unid_med_dose_sol3,
			cd_mat_soluc4,
			qt_dose_soluc4,
			cd_unid_med_dose_sol4,
			cd_mat_soluc5,
			qt_dose_soluc5,
			cd_unid_med_dose_sol5,
			cd_mat_soluc6,
			qt_dose_soluc6,
			cd_unid_med_dose_sol6,
			cd_mat_soluc7,
			qt_dose_soluc7,
			cd_unid_med_dose_sol7,
			nr_seq_protocolo2,
			ie_tipo_solucao2,
			qt_solucao_total2,
			qt_temp_solucao2,
			qt_dosagem2,
			ie_unid_vel_inf2,
			ie_bomba_infusao2,
			qt_dose_ataque2,
			ds_orientacao2,
			cd_mat_soluc1_2,
			qt_dose_soluc1_2,
			cd_unid_med_dose_sol1_2,
			cd_mat_soluc2_2,
			qt_dose_soluc2_2,
			cd_unid_med_dose_sol2_2,
			cd_mat_soluc3_2,
			qt_dose_soluc3_2,
			cd_unid_med_dose_sol3_2,
			cd_mat_soluc4_2,
			qt_dose_soluc4_2,
			cd_unid_med_dose_sol4_2,
			cd_mat_soluc5_2,
			qt_dose_soluc5_2,
			cd_unid_med_dose_sol5_2,
			cd_mat_soluc6_2,
			qt_dose_soluc6_2,
			cd_unid_med_dose_sol6_2,
			cd_mat_soluc7_2,
			qt_dose_soluc7_2,
			cd_unid_med_dose_sol7_2,
			nr_seq_protocolo3,
			ie_tipo_solucao3,
			qt_solucao_total3,
			qt_temp_solucao3,
			qt_dosagem3,
			ie_unid_vel_inf3,
			ie_bomba_infusao3,
			qt_dose_ataque3,
			ds_orientacao3,
			cd_mat_soluc1_3,
			qt_dose_soluc1_3,
			cd_unid_med_dose_sol1_3,
			cd_mat_soluc2_3,
			qt_dose_soluc2_3,
			cd_unid_med_dose_sol2_3,
			cd_mat_soluc3_3,
			qt_dose_soluc3_3,
			cd_unid_med_dose_sol3_3,
			cd_mat_soluc4_3,
			qt_dose_soluc4_3,
			cd_unid_med_dose_sol4_3,
			cd_mat_soluc5_3,
			qt_dose_soluc5_3,
			cd_unid_med_dose_sol5_3,
			cd_mat_soluc6_3,
			qt_dose_soluc6_3,
			cd_unid_med_dose_sol6_3,
			cd_mat_soluc7_3,
			qt_dose_soluc7_3,
			cd_unid_med_dose_sol7_3,
			nr_seq_protocolo4,
			ie_tipo_solucao4,
			qt_solucao_total4,
			qt_temp_solucao4,
			qt_dosagem4,
			ie_unid_vel_inf4,
			ie_bomba_infusao4,
			qt_dose_ataque4,
			ds_orientacao4,
			cd_mat_soluc1_4,
			qt_dose_soluc1_4,
			cd_unid_med_dose_sol1_4,
			cd_mat_soluc2_4,
			qt_dose_soluc2_4,
			cd_unid_med_dose_sol2_4,
			cd_mat_soluc3_4,
			qt_dose_soluc3_4,
			cd_unid_med_dose_sol3_4,
			cd_mat_soluc4_4,
			qt_dose_soluc4_4,
			cd_unid_med_dose_sol4_4,
			cd_mat_soluc5_4,
			qt_dose_soluc5_4,
			cd_unid_med_dose_sol5_4,
			cd_mat_soluc6_4,
			qt_dose_soluc6_4,
			cd_unid_med_dose_sol6_4,
			cd_mat_soluc7_4,
			qt_dose_soluc7_4,
			cd_unid_med_dose_sol7_4,
			nr_seq_protocolo5,
			ie_tipo_solucao5,
			qt_solucao_total5,
			qt_temp_solucao5,
			qt_dosagem5,
			ie_unid_vel_inf5,
			ie_bomba_infusao5,
			qt_dose_ataque5,
			ds_orientacao5,
			cd_mat_soluc1_5,
			qt_dose_soluc1_5,
			cd_unid_med_dose_sol1_5,
			cd_mat_soluc2_5,
			qt_dose_soluc2_5,
			cd_unid_med_dose_sol2_5,
			cd_mat_soluc3_5,
			qt_dose_soluc3_5,
			cd_unid_med_dose_sol3_5,
			cd_mat_soluc4_5,
			qt_dose_soluc4_5,
			cd_unid_med_dose_sol4_5,
			cd_mat_soluc5_5,
			qt_dose_soluc5_5,
			cd_unid_med_dose_sol5_5,
			cd_mat_soluc6_5,
			qt_dose_soluc6_5,
			cd_unid_med_dose_sol6_5,
			cd_mat_soluc7_5,
			qt_dose_soluc7_5,
			cd_unid_med_dose_sol7_5,
			ie_hemodialise,
			qt_tempo_infusao,
			qt_tempo_permanencia,
			qt_tempo_drenagem,
			hr_inicio_capd,
			hr_fim_capd,
			qt_volume_sol,
			qt_volume_sol2,
			qt_volume_sol3,
			qt_volume_sol4,
			qt_volume_sol5,
			ie_ultima_bolsa,
			ie_ultima_bolsa2,
			ie_ultima_bolsa3,
			ie_ultima_bolsa4,
			ie_ultima_bolsa5,
			ie_tidal,
			ie_tidal2,
			ie_tidal3,
			ie_tidal4,
			ie_tidal5,
			ie_lavar_linhas,
			ie_lavar_linhas2,
			ie_lavar_linhas3,
			ie_lavar_linhas4,
			ie_lavar_linhas5,
			ds_observacao,
			pr_concentracao,
			pr_concentracao2,
			pr_concentracao3,
			pr_concentracao4,
			pr_concentracao5,
			nr_seq_perfil_bic,
			qt_zero_um_bic,
			qt_um_dois_bic,
			qt_dois_tres_bic,
			qt_tres_quatro_bic,
			qt_quatro_cinco_bic,
			qt_cinco_seis_bic
	from	cpoe_dialise
	where	nr_sequencia = nr_sequencia_p
	and		((CASE WHEN coalesce(dt_lib_suspensao::text, '') = '' THEN  dt_fim  ELSE coalesce(dt_suspensao,dt_fim) END  >= clock_timestamp()) or (CASE WHEN coalesce(dt_lib_suspensao::text, '') = '' THEN  dt_fim  ELSE coalesce(dt_suspensao,dt_fim) coalesce(END::text, '') = '') or (coalesce(ie_retrogrado,'N') = 'S' AND dt_inicio >= dt_inicio_prescr_p)) -- retrograde/backward item
	order 	by nr_sequencia;		
	
	procedure Localizar_ultimo_item is
	;
BEGIN
		nr_prescricao_orig_w	:= null;
		nr_sequencia_orig_w		:= null;
		
		if (nr_atendimento_p IS NOT NULL AND nr_atendimento_p::text <> '') then
			-- Localizar ultima prescricao
			select	max(a.nr_prescricao)
			into STRICT	nr_prescricao_orig_w
			from	prescr_medica a
			where	a.nr_atendimento = nr_atendimento_p
			and		a.dt_prescricao > dt_inicio_base_w - 10
			and		exists (	SELECT	1
							from	hd_prescricao b
							where	b.nr_seq_dialise_cpoe = nr_sequencia_p
							and		b.nr_prescricao = a.nr_prescricao );

			if (nr_prescricao_orig_w IS NOT NULL AND nr_prescricao_orig_w::text <> '') then
				
				-- Localizar ultimo item
				select	min(b.nr_sequencia)
				into STRICT	nr_sequencia_orig_w
				from	hd_prescricao b
				where	b.nr_seq_dialise_cpoe = nr_sequencia_p
				and		b.nr_prescricao = nr_prescricao_orig_w;
			else
				nr_sequencia_orig_w	:= null;
			end if;
		end if;
	end;	
	
procedure gerar_componente_material(	cd_material_p 			number,
										cd_unid_med_dose_sol_p 	varchar2,
										qt_dose_p				number) is 
	nr_sequencia_mat_w 	prescr_material.nr_sequencia%type;
	begin
	
		select coalesce(max(nr_sequencia),0) + 1
		into STRICT nr_sequencia_mat_w
		from   prescr_material
		where  nr_prescricao = nr_prescricao_p;
		
		begin
			insert into prescr_material(   cd_material,
										   cd_unidade_medida_dose,
										   qt_dose,
										   ds_observacao,
										   nr_sequencia,
										   cd_unidade_medida,
										   ie_origem_inf,
										   nm_usuario_nrec, 
										   nm_usuario, 
										   nr_prescricao, 
										   dt_atualizacao, 
										   dt_atualizacao_nrec, 
										   nr_sequencia_solucao, 
										   qt_material,
										   qt_unitaria, 
										   ie_agrupador)
								 values (
										   cd_material_p,
										   cd_unid_med_dose_sol_p,
										   qt_dose_p,
										   '',
										   nr_sequencia_mat_w,
										   cd_unid_med_dose_sol_p,
										   1, 
										   nm_usuario_p, 
										   nm_usuario_p, 
										   nr_prescricao_p,
										   clock_timestamp(), 
										   clock_timestamp(), 
										   nr_seq_solucao_w, 
										   qt_dose_p,
										   qt_dose_p, 
										   13);
		exception when others then									
				CALL gravar_log_tasy(10007,
					substr('Dialise gerar_componente_material '
											|| substr(to_char(sqlerrm),1,2000)
											||'//cd_material_p : ' 			|| cd_material_p
											||' cd_unid_med_dose_sol_p : '	|| cd_unid_med_dose_sol_p
											||' qt_dose_p : ' 				|| qt_dose_p
											||' nr_sequencia_mat_w : ' 		|| nr_sequencia_mat_w
											||' nr_prescricao_p : '			|| nr_prescricao_p
											||' nm_usuario_p : '			|| nm_usuario_p,1,2000),
							nm_usuario_p);
		end;		
	end;	
	
	procedure inserir_solucao_dialise(  ie_bomba_infusao_p 	varchar2,
										ie_tipo_solucao_p 	varchar2,
										nr_seq_protocol_p 	number,
										qt_solucao_total_p 	number,
										qt_dosagem_p 		number,
										qt_dose_ataque_p 	number,
										ie_unid_vel_inf_p	varchar2,
										qt_temp_solucao_p	number,
										qt_volume_p			number,
										ie_ultima_bolsa_p	varchar2,
										ie_tidal_p			varchar2,
										ie_lavar_linhas_p	varchar2,
										ds_observacao_p		varchar,
										pr_concentracao_p	number) is 	
	
	ie_hemodialise_w prescr_solucao.ie_hemodialise%type;
	
	begin

		nr_seq_solucao_w := null;
	
		select coalesce(max(nr_seq_solucao),0) + 1
		into STRICT   nr_seq_solucao_w
		from   prescr_solucao
		where  nr_prescricao = nr_prescricao_p;
		
		begin
			if (qt_tempo_infusao_w IS NOT NULL AND qt_tempo_infusao_w::text <> '') then
				qt_tempo_infusao_w :=  (((substr(qt_tempo_infusao_w,1,2))::numeric  * 60) + (substr(qt_tempo_infusao_w,4,5))::numeric );
			end if;
			
			if (qt_tempo_permanencia_w IS NOT NULL AND qt_tempo_permanencia_w::text <> '') then
				qt_tempo_perm_hor_w := (substr(qt_tempo_permanencia_w,1,2))::numeric;
				qt_tempo_permanencia_w := (substr(qt_tempo_permanencia_w,4,5))::numeric;
			end if;
			
			if (qt_tempo_drenagem_w IS NOT NULL AND qt_tempo_drenagem_w::text <> '') then
				qt_tempo_drenagem_w := (((substr(qt_tempo_drenagem_w,1,2))::numeric  * 60) + (substr(qt_tempo_drenagem_w,4,5))::numeric );
			end if;				
		exception when others then		
		qt_tempo_infusao_w := 0;
		qt_tempo_perm_hor_w := 0;
		qt_tempo_permanencia_w := 0;
		qt_tempo_drenagem_w := 0;
		CALL gravar_log_tasy(10007,
					substr('Dialise inserir_solucao_dialise '
											|| substr(to_char(sqlerrm),1,2000)
											||'//qt_tempo_infusao_w : ' 	|| qt_tempo_infusao_w
											||' qt_tempo_permanencia_w : '	|| qt_tempo_permanencia_w
											||' qt_tempo_drenagem_w : ' 	|| qt_tempo_drenagem_w,1,2000),
							nm_usuario_p);
		end;	

		if (ie_tipo_dialise_w = 'H') then
			ie_hemodialise_w := 'S';
		else
			ie_hemodialise_w := 'P';
		end if;
		
		begin		
			insert into prescr_solucao( nr_seq_solucao,
										ie_bomba_infusao,
										ie_tipo_solucao,
										nr_seq_protocolo,
										qt_solucao_total,
										qt_dosagem,
										qt_dose_ataque,
										ie_unid_vel_inf,
										ie_via_aplicacao,
										ie_tipo_dosagem,
										cd_unidade_medida,
										qt_temp_solucao,
										ds_orientacao,
										nm_usuario,
										dt_atualizacao,
										nr_prescricao,
										ie_hemodialise,
										nr_seq_dialise_cpoe,
										nr_seq_dialise,
										pr_concentracao,
										qt_tempo_infusao,
										qt_tempo_perm_hor,
										qt_tempo_permanencia,
										qt_tempo_drenagem,
										hr_inicio_capd,
										hr_fim_capd,
										qt_volume,
										ie_ultima_bolsa,
										ie_tidal,
										ie_lavar_linhas,
										nr_seq_fabric)
							 values (
										nr_seq_solucao_w,
										ie_bomba_infusao_p,
										ie_tipo_solucao_p,
										nr_seq_protocol_p,
										qt_solucao_total_p,
										qt_dosagem_p,
										qt_dose_ataque_p,
										ie_unid_vel_inf_p,
										upper(obter_via_usuario('IV')),
										'mlh',
										lower(obter_unid_med_usua('ml')),
										qt_temp_solucao_p,
										ds_observacao_p,
										nm_usuario_p,
										clock_timestamp(),
										nr_prescricao_p,
										ie_hemodialise_w,
										nr_sequencia_p,
										nr_sequencia_hd_w,
										pr_concentracao_p,
										qt_tempo_infusao_w,
										qt_tempo_perm_hor_w,
										qt_tempo_permanencia_w,
										qt_tempo_drenagem_w,
										hr_inicio_capd_w,
										hr_fim_capd_w,
										qt_volume_p,
										ie_ultima_bolsa_p,
										ie_tidal_p,
										ie_lavar_linhas_p,
										null);	
		exception when others then									
		CALL gravar_log_tasy(10007,
			substr('Dialise insert prescr_solucao '
									|| substr(to_char(sqlerrm),1,2000)
									||'//nr_sequencia_hd_w : ' 	|| nr_sequencia_hd_w
									||' nr_sequencia_p : '	 	|| nr_sequencia_p
									||' ie_bomba_infusao_p : ' 	|| ie_bomba_infusao_p
									||' ie_tipo_solucao_p : ' 	|| ie_tipo_solucao_p
									||' nr_seq_protocol_p : '	|| nr_seq_protocol_p
									||' qt_solucao_total_p : '	|| qt_solucao_total_p
									||' qt_dosagem_p : '		|| qt_dosagem_p
									||' qt_dose_ataque_p : '	|| qt_dose_ataque_p
									||' ie_unid_vel_inf_p : '	|| ie_unid_vel_inf_p	
									||' qt_temp_solucao_p : '	|| qt_temp_solucao_p
									||' qt_volume_p : '			|| qt_volume_p
									||' ie_ultima_bolsa_p : '	|| ie_ultima_bolsa_p
									||' ie_tidal_p : '			|| ie_tidal_p
									||' ie_lavar_linhas_p : '	|| ie_lavar_linhas_p
									||' ds_observacao_p : '		|| ds_observacao_p
									||' pr_concentracao_p : '	|| pr_concentracao_p
									||' hr_inicio_capd_w : '	|| hr_inicio_capd_w
									||' hr_fim_capd_w : '		|| hr_fim_capd_w
									||' qt_tempo_infusao_w : '	|| qt_tempo_infusao_w
									||' qt_tempo_perm_hor_w : '	|| qt_tempo_perm_hor_w
									||' qt_tempo_permanencia_w : '	|| qt_tempo_permanencia_w
									||' qt_tempo_drenagem_w : '	|| qt_tempo_drenagem_w,1,2000),
					nm_usuario_p);
		end;	
	end;	
	
begin

dt_inicio_base_w		:= trunc(dt_inicio_prescr_p,'mi');
nr_horas_prox_geracao_w	:= get_qt_hours_after_copy_cpoe(cd_perfil_p, nm_usuario_p, cd_estabelecimento_p);

if (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') then
	cd_pessoa_fisica_w	:= cd_pessoa_fisica_p;
else
	select	max(cd_pessoa_fisica)
	into STRICT	cd_pessoa_fisica_w
	from	atendimento_paciente
	where	nr_atendimento = nr_atendimento_p;
end if;

open C01;
loop
fetch C01 into	
	ie_categoria_w,
	ie_tipo_hemodialise_w,
	qt_fluxo_sangue_w,
	qt_hora_min_sessao_w,
	qt_min_sessao_w,
	nr_seq_mod_dialisador_w,
	ie_cateter_w,
	qt_peso_pos_w,
	qt_peso_atual_w,
	qt_peso_ideal_w,
	ie_ultrafiltracao_w,
	qt_ultrafiltracao_w,
	nr_seq_diametro_agulha_w,
	nr_seq_tipo_agulha_w,
	nr_seq_tipo_agulha_art_w,
	nr_seq_ultra_w,
	nr_seq_perfil_sodio_w,
	qt_zero_um_w,
	qt_um_dois_w,
	qt_dois_tres_w,
	qt_tres_quatro_w,
	qt_quatro_cinco_w,
	qt_cinco_seis_w,
	qt_sodio_w,
	qt_calcio_w,
	qt_bicarbonato_w,
	ie_ligar_prime_w,
	qt_volume_prime_w,
	nm_usuario_w,
	nm_usuario_nrec_w,
	dt_atualizacao_w,
	dt_atualizacao_nrec_w,
	ie_tipo_dialise_w,
	ie_tipo_peritoneal_w,
	nr_ciclos_w,
	qt_volume_ciclo_w,
	qt_hora_min_duracao_w,
	qt_min_duracao_w,
	nr_seq_maq_cicladora_w,
	nr_serie_w,
	qt_volume_total_di_w,
	qt_minimo_volume_w,
	ie_perm_inteligente_w,
	ie_apagar_visor_w,
	ie_modo_dialise_w,
	qt_tempo_min_drenagem_w,
	qt_limite_uf_negativo_w,
	qt_limite_uf_positivo_w,
	ie_ausente_w,
	dt_inicio_dialise_w,
	dt_fim_dialise_w,
	ie_volume_alarm_w,
	ie_administracao_w,
	nr_seq_protocolo_w,
	ie_tipo_solucao_w,
	qt_solucao_total_w,
	qt_temp_solucao_w,
	qt_dosagem_w,
	ie_unid_vel_inf_w,
	ie_bomba_infusao_w,
	qt_dose_ataque_w,
	ds_orientacao_w,
	cd_mat_soluc1_w,
	qt_dose_soluc1_w,
	cd_unid_med_dose_sol1_w,
	cd_mat_soluc2_w,
	qt_dose_soluc2_w,
	cd_unid_med_dose_sol2_w,
	cd_mat_soluc3_w,
	qt_dose_soluc3_w,
	cd_unid_med_dose_sol3_w,
	cd_mat_soluc4_w,
	qt_dose_soluc4_w,
	cd_unid_med_dose_sol4_w,
	cd_mat_soluc5_w,
	qt_dose_soluc5_w,
	cd_unid_med_dose_sol5_w,
	cd_mat_soluc6_w,
	qt_dose_soluc6_w,
	cd_unid_med_dose_sol6_w,
	cd_mat_soluc7_w,
	qt_dose_soluc7_w,
	cd_unid_med_dose_sol7_w,
	nr_seq_protocolo2_w,
	ie_tipo_solucao2_w,
	qt_solucao_total2_w,
	qt_temp_solucao2_w,
	qt_dosagem2_w,
	ie_unid_vel_inf2_w,
	ie_bomba_infusao2_w,
	qt_dose_ataque2_w,
	ds_orientacao2_w,
	cd_mat_soluc1_2_w,
	qt_dose_soluc1_2_w,
	cd_unid_med_dose_sol1_2_w,
	cd_mat_soluc2_2_w,
	qt_dose_soluc2_2_w,
	cd_unid_med_dose_sol2_2_w,
	cd_mat_soluc3_2_w,
	qt_dose_soluc3_2_w,
	cd_unid_med_dose_sol3_2_w,
	cd_mat_soluc4_2_w,
	qt_dose_soluc4_2_w,
	cd_unid_med_dose_sol4_2_w,
	cd_mat_soluc5_2_w,
	qt_dose_soluc5_2_w,
	cd_unid_med_dose_sol5_2_w,
	cd_mat_soluc6_2_w,
	qt_dose_soluc6_2_w,
	cd_unid_med_dose_sol6_2_w,
	cd_mat_soluc7_2_w,
	qt_dose_soluc7_2_w,
	cd_unid_med_dose_sol7_2_w,
	nr_seq_protocolo3_w,
	ie_tipo_solucao3_w,
	qt_solucao_total3_w,
	qt_temp_solucao3_w,
	qt_dosagem3_w,
	ie_unid_vel_inf3_w,
	ie_bomba_infusao3_w,
	qt_dose_ataque3_w,
	ds_orientacao3_w,
	cd_mat_soluc1_3_w,
	qt_dose_soluc1_3_w,
	cd_unid_med_dose_sol1_3_w,
	cd_mat_soluc2_3_w,
	qt_dose_soluc2_3_w,
	cd_unid_med_dose_sol2_3_w,
	cd_mat_soluc3_3_w,
	qt_dose_soluc3_3_w,
	cd_unid_med_dose_sol3_3_w,
	cd_mat_soluc4_3_w,
	qt_dose_soluc4_3_w,
	cd_unid_med_dose_sol4_3_w,
	cd_mat_soluc5_3_w,
	qt_dose_soluc5_3_w,
	cd_unid_med_dose_sol5_3_w,
	cd_mat_soluc6_3_w,
	qt_dose_soluc6_3_w,
	cd_unid_med_dose_sol6_3_w,
	cd_mat_soluc7_3_w,
	qt_dose_soluc7_3_w,
	cd_unid_med_dose_sol7_3_w,
	nr_seq_protocolo4_w,
	ie_tipo_solucao4_w,
	qt_solucao_total4_w,
	qt_temp_solucao4_w,
	qt_dosagem4_w,
	ie_unid_vel_inf4_w,
	ie_bomba_infusao4_w,
	qt_dose_ataque4_w,
	ds_orientacao4_w,
	cd_mat_soluc1_4_w,
	qt_dose_soluc1_4_w,
	cd_unid_med_dose_sol1_4_w,
	cd_mat_soluc2_4_w,
	qt_dose_soluc2_4_w,
	cd_unid_med_dose_sol2_4_w,
	cd_mat_soluc3_4_w,
	qt_dose_soluc3_4_w,
	cd_unid_med_dose_sol3_4_w,
	cd_mat_soluc4_4_w,
	qt_dose_soluc4_4_w,
	cd_unid_med_dose_sol4_4_w,
	cd_mat_soluc5_4_w,
	qt_dose_soluc5_4_w,
	cd_unid_med_dose_sol5_4_w,
	cd_mat_soluc6_4_w,
	qt_dose_soluc6_4_w,
	cd_unid_med_dose_sol6_4_w,
	cd_mat_soluc7_4_w,
	qt_dose_soluc7_4_w,
	cd_unid_med_dose_sol7_4_w,
	nr_seq_protocolo5_w,
	ie_tipo_solucao5_w,
	qt_solucao_total5_w,
	qt_temp_solucao5_w,
	qt_dosagem5_w,
	ie_unid_vel_inf5_w,
	ie_bomba_infusao5_w,
	qt_dose_ataque5_w,
	ds_orientacao5_w,
	cd_mat_soluc1_5_w,
	qt_dose_soluc1_5_w,
	cd_unid_med_dose_sol1_5_w,
	cd_mat_soluc2_5_w,
	qt_dose_soluc2_5_w,
	cd_unid_med_dose_sol2_5_w,
	cd_mat_soluc3_5_w,
	qt_dose_soluc3_5_w,
	cd_unid_med_dose_sol3_5_w,
	cd_mat_soluc4_5_w,
	qt_dose_soluc4_5_w,
	cd_unid_med_dose_sol4_5_w,
	cd_mat_soluc5_5_w,
	qt_dose_soluc5_5_w,
	cd_unid_med_dose_sol5_5_w,
	cd_mat_soluc6_5_w,
	qt_dose_soluc6_5_w,
	cd_unid_med_dose_sol6_5_w,
	cd_mat_soluc7_5_w,
	qt_dose_soluc7_5_w,
	cd_unid_med_dose_sol7_5_w,
	ie_hemodialise_w,
	qt_tempo_infusao_w,
	qt_tempo_permanencia_w,
	qt_tempo_drenagem_w,
	hr_inicio_capd_w,
	hr_fim_capd_w,
	qt_volume_sol_w,
	qt_volume_sol2_w,
	qt_volume_sol3_w,
	qt_volume_sol4_w,
	qt_volume_sol5_w,
	ie_ultima_bolsa_w,
	ie_ultima_bolsa2_w,
	ie_ultima_bolsa3_w,
	ie_ultima_bolsa4_w,
	ie_ultima_bolsa5_w,
	ie_tidal_w,
	ie_tidal2_w,
	ie_tidal3_w,
	ie_tidal4_w,
	ie_tidal5_w,
	ie_lavar_linhas_w,
	ie_lavar_linhas2_w,
	ie_lavar_linhas3_w,
	ie_lavar_linhas4_w,
	ie_lavar_linhas5_w,
	ds_observacao_w,
	pr_concentracao_w,
	pr_concentracao2_w,
	pr_concentracao3_w,
	pr_concentracao4_w,
	pr_concentracao5_w,
	nr_seq_perfil_bic_w,
	qt_zero_um_bic_w,
	qt_um_dois_bic_w,
	qt_dois_tres_bic_w,
	qt_tres_quatro_bic_w,
	qt_quatro_cinco_bic_w,
	qt_cinco_seis_bic_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin	
	
	dt_inicio_w	:= dt_inicio_dialise_w;
	
	if (dt_inicio_w < dt_inicio_base_w) then
	
		dt_inicio_w := to_date(to_char(dt_inicio_base_w,'dd/mm/yyyy')||' '||to_char(dt_inicio_dialise_w,'hh24:mi:ss'),'dd/mm/yyyy hh24:mi:ss');
	
		if (dt_inicio_w < dt_inicio_base_w) then
			dt_inicio_w	:= dt_inicio_w + 1;
		end if;
	end if;	
	
	dt_proxima_dose_w	:= dt_inicio_w;
	
	-- Localizar ultima prescricao e item principal vinculado ao registro da CPOE
	begin
		Localizar_ultimo_item;		
	exception when others then
	CALL gravar_log_tasy(10007,
			substr('Dialise Localizar_ultimo_item :'
									|| substr(to_char(sqlerrm),1,2000)
									||'nr_atendimento_p:'    || nr_atendimento_p
									||' dt_inicio_base_w : ' || to_char(dt_inicio_base_w,'dd/mm/yyyy hh24:mi:ss')
									||' nr_prescricao_p : '  || nr_prescricao_p
									||' nr_seq_mat_cpoe_w :' || nr_sequencia_p
									||' cd_perfil_p: ' || cd_perfil_p,1,2000),
					nm_usuario_p);	
	end;

	dt_prox_geracao_w	:= null;	
	
	-- Caso a data de inicio do item maior que data fim de base do item, reprogramar geracao do item. 

	--  A prescricao deste item, deve ser gerada diariamente, independente de sua administracao.
	if ( dt_proxima_dose_w > dt_inicio_base_w + 1 - 1/86400) then
		begin
		-- Se a data de inicio do item for superior a data de inicio da prescricao adicionando 1 dia (totalizando 24h),

		--  e nao existe nenhuma prescricao gerada anteriormente, quer dizer que e um novo item.

		--  sendo assim, deve-se programar a geracao de uma prescricao para este.
		if ( coalesce(nr_prescricao_orig_w::text, '') = '') then				
			begin
				update	cpoe_dialise
				set		dt_prox_geracao = trunc(dt_proxima_dose_w,'hh24') - (nr_horas_prox_geracao_w/24)
				where	nr_sequencia = nr_sequencia_p;
				commit;
			exception when others then
				CALL gravar_log_tasy(10007,
					substr('Dialise dt_proxima_dose_w > dt_inicio_base_w+1 - UPDATE :'
											|| substr(to_char(sqlerrm),1,2000)
											||'//dt_proxima_dose_w : ' || to_char(dt_proxima_dose_w,'dd/mm/yyyy hh24:mi:ss')
											||' dt_proxima_dose_new : ' || to_char(trunc(dt_proxima_dose_w,'hh24') - (nr_horas_prox_geracao_w/24),'dd/mm/yyyy hh24:mi:ss')
											||' dt_inicio_base_w : ' || to_char(dt_inicio_base_w,'dd/mm/yyyy hh24:mi:ss')
											||' nr_prescricao_p : ' || nr_prescricao_p
											||' nr_seq_mat_cpoe_w :' || nr_sequencia_p
											||' cd_perfil_p: ' || cd_perfil_p,1,2000),
							nm_usuario_p);	
			end;				
			goto proximo_item;				
		else
			dt_prox_geracao_w	:= trunc(dt_inicio_base_w + abs(mod(dt_proxima_dose_w - dt_inicio_base_w,24))/24 + 1,'hh24');

			begin
				update	cpoe_dialise
				set		dt_prox_geracao = dt_prox_geracao_w
				where	nr_sequencia = nr_sequencia_p;
				commit;
			exception when others then
			CALL gravar_log_tasy(10007,
				substr('Dialise dt_proxima_dose_w > dt_inicio_base_w+1d, UPDATE '
										|| substr(to_char(sqlerrm),1,2000)
										||'//dt_proxima_dose_w : ' || to_char(dt_proxima_dose_w,'dd/mm/yyyy hh24:mi:ss')
										||' dt_prox_geracao_w : ' || to_char(dt_prox_geracao_w,'dd/mm/yyyy hh24:mi:ss')
										||' dt_inicio_base_w : ' || to_char(dt_inicio_base_w,'dd/mm/yyyy hh24:mi:ss')
										||' dt_inicio_w : ' || to_char(dt_inicio_w,'dd/mm/yyyy hh24:mi:ss')
										||' nr_prescricao_orig_w : ' || nr_prescricao_orig_w
										||' nr_sequencia_orig_w : ' || nr_sequencia_orig_w
										||' nr_prescricao_p : ' || nr_prescricao_p
										||' nr_seq_mat_cpoe_w :' || nr_sequencia_p
										||' cd_perfil_p: ' || cd_perfil_p,1,2000),
						nm_usuario_p);
			end;

			goto proximo_item;
		end if;
		end;			
	else
		dt_inicio_w			:= dt_proxima_dose_w;
		dt_proxima_dose_w	:= null;
	end if;	
	
	-- Se o inicio do item for apos a data de fim, definida para o mesmo, este item nao deve ser mais copiado.
	if (dt_fim_dialise_w IS NOT NULL AND dt_fim_dialise_w::text <> '') and (dt_fim_dialise_w <= dt_inicio_w) then		
		CALL gravar_log_tasy(10007, substr('MEDIC dt_fim_dialise_w <= dt_inicio_w :'
									||'//dt_inicio_base_w : ' || to_char(dt_inicio_base_w,'dd/mm/yyyy hh24:mi:ss')
									||' dt_inicio_w : ' || to_char(dt_inicio_w,'dd/mm/yyyy hh24:mi:ss')
									||' dt_fim_dialise_w : ' || to_char(dt_fim_dialise_w,'dd/mm/yyyy hh24:mi:ss')
									||' nr_prescricao_p : ' || nr_prescricao_p
									||' nr_seq_mat_cpoe_w :' || nr_sequencia_p
									||' cd_perfil_p: ' || cd_perfil_p,1,2000),
					nm_usuario_p);
		
		goto proximo_item;		
	end if;	
	
	-- Retornar a maior data de inicio dos itens.
	if	((coalesce(dt_inicio_ret_p::text, '') = '') or (dt_inicio_w > dt_inicio_ret_p)) then
		dt_inicio_ret_p	:= dt_inicio_w;
	end if;	
	
	if (ie_tipo_dialise_w = 'DI') then
		ie_tipo_dialise_w := 'H';
	elsif (ie_tipo_dialise_w = 'DP') then
		ie_tipo_dialise_w := 'P';
	end if;
	
	select nextval('hd_prescricao_seq')
	into STRICT   nr_sequencia_hd_w
	;	
	
	begin
		insert into hd_prescricao(	nr_sequencia,
									ie_categoria, 
									ie_tipo_hemodialise, 
									qt_fluxo_sangue, 
									qt_hora_sessao, 
									qt_min_sessao, 
									nr_seq_mod_dialisador, 
									ie_cateter, 
									qt_peso_pos, 
									qt_peso_atual, 
									qt_peso_ideal, 
									ie_ultrafiltracao, 
									qt_ultrafiltracao, 
									nr_seq_diametro_agulha, 
									nr_seq_tipo_agulha, 
									nr_seq_tipo_agulha_art, 
									nr_seq_ultra, 
									nr_seq_perfil_sodio, 
									qt_zero_um, 
									qt_um_dois, 
									qt_dois_tres, 
									qt_tres_quatro, 
									qt_seto_oito, 
									qt_cinco_seis, 
									qt_sodio, 
									qt_calcio, 
									qt_bicarbonato, 
									ie_ligar_prime, 
									qt_volume_prime, 
									nm_usuario, 
									nm_usuario_nrec, 
									nr_prescricao, 
									dt_atualizacao, 
									dt_atualizacao_nrec, 
									nr_seq_dialise_cpoe, 
									ie_tipo_dialise, 
									ds_observacao,
									ie_tipo_peritoneal,
									nr_ciclos,
									qt_volume_ciclo,
									qt_hora_duracao,
									qt_min_duracao,
									nr_seq_maq_cicladora,
									nr_serie,
									qt_volume_total,
									qt_minimo_volume,								
									ie_perm_inteligente,
									ie_apagar_visor,
									ie_modo_dialise,
									qt_tempo_min_drenagem,
									qt_limite_uf_negativo,
									qt_limite_uf_positivo,
									ie_ausente,
									dt_inicio_dialise,
									dt_fim_dialise,
									ie_volume_alarme,
									nr_seq_perfil_bic,
									qt_zero_um_bic,
									qt_um_dois_bic,
									qt_dois_tres_bic,
									qt_tres_quatro_bic,
									qt_quatro_cinco_bic,
									qt_cinco_seis_bic)
							values (
									nr_sequencia_hd_w,
									ie_categoria_w,
									ie_tipo_hemodialise_w,
									qt_fluxo_sangue_w,
									qt_hora_min_sessao_w,
									qt_min_sessao_w,
									nr_seq_mod_dialisador_w,
									ie_cateter_w,
									qt_peso_pos_w,
									qt_peso_atual_w,
									qt_peso_ideal_w,
									ie_ultrafiltracao_w,
									qt_ultrafiltracao_w,
									nr_seq_diametro_agulha_w,
									nr_seq_tipo_agulha_w,
									nr_seq_tipo_agulha_art_w,
									nr_seq_ultra_w,
									nr_seq_perfil_sodio_w,
									qt_zero_um_w,
									qt_um_dois_w,
									qt_dois_tres_w,
									qt_tres_quatro_w,
									qt_quatro_cinco_w,
									qt_cinco_seis_w,
									qt_sodio_w,
									qt_calcio_w,
									qt_bicarbonato_w,
									ie_ligar_prime_w,
									qt_volume_prime_w,
									nm_usuario_w,
									nm_usuario_nrec_w,
									nr_prescricao_p,
									dt_atualizacao_w,
									dt_atualizacao_nrec_w,
									nr_sequencia_p,
									ie_tipo_dialise_w,
									ds_observacao_w,
									ie_tipo_peritoneal_w,
									nr_ciclos_w,
									qt_volume_ciclo_w,
									qt_hora_min_duracao_w,
									qt_min_duracao_w,
									nr_seq_maq_cicladora_w,
									nr_serie_w,
									qt_volume_total_di_w,
									qt_minimo_volume_w,								
									ie_perm_inteligente_w,
									ie_apagar_visor_w,
									ie_modo_dialise_w,
									qt_tempo_min_drenagem_w,
									qt_limite_uf_negativo_w,
									qt_limite_uf_positivo_w,
									ie_ausente_w,
									dt_inicio_w,
									dt_fim_dialise_w,								
									ie_volume_alarm_w,
									nr_seq_perfil_bic_w,
									qt_zero_um_bic_w,
									qt_um_dois_bic_w,
									qt_dois_tres_bic_w,
									qt_tres_quatro_bic_w,
									qt_quatro_cinco_bic_w,
									qt_cinco_seis_bic_w);
	exception when others then
	CALL gravar_log_tasy(10007,
		substr('Dialise insert hd_prescricao'
								|| substr(to_char(sqlerrm),1,2000)
								||'//nr_atendimento_p : ' 	|| nr_atendimento_p
								||' nr_prescricao_p : '	 	|| nr_prescricao_p
								||' nr_sequencia_p : ' 		|| nr_sequencia_p
								||' dt_inicio_prescr_p : ' 	|| to_char(dt_inicio_prescr_p,'dd/mm/yyyy hh24:mi:ss')
								||' cd_pessoa_fisica_p : '	|| cd_pessoa_fisica_p
								||' nm_usuario_p : '		|| nm_usuario_p
								||' cd_estabelecimento_p : '|| cd_estabelecimento_p
								||' cd_perfil_p: ' 			|| cd_perfil_p,1,2000),
				nm_usuario_p);
	end;

	if (nr_seq_protocolo_w IS NOT NULL AND nr_seq_protocolo_w::text <> '') then
		inserir_solucao_dialise(ie_bomba_infusao_w, ie_tipo_solucao_w, nr_seq_protocolo_w, qt_solucao_total_w, qt_dosagem_w, qt_dose_ataque_w, ie_unid_vel_inf_w,qt_temp_solucao_w, qt_volume_sol_w, ie_ultima_bolsa_w, ie_tidal_w, ie_lavar_linhas_w, ds_orientacao_w, pr_concentracao_w);
		
		if (coalesce(cd_mat_soluc1_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc1_w, cd_unid_med_dose_sol1_w, qt_dose_soluc1_w);
		end if;
		
		if (coalesce(cd_mat_soluc2_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc2_w, cd_unid_med_dose_sol2_w, qt_dose_soluc3_w);
		end if;
		
		if (coalesce(cd_mat_soluc3_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc3_w, cd_unid_med_dose_sol3_w, qt_dose_soluc3_w);
		end if;
		
		if (coalesce(cd_mat_soluc4_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc4_w, cd_unid_med_dose_sol4_w, qt_dose_soluc4_w);
		end if;
		
		if (coalesce(cd_mat_soluc5_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc5_w, cd_unid_med_dose_sol5_w, qt_dose_soluc5_w);
		end if;		
		
		if (coalesce(cd_mat_soluc6_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc6_w, cd_unid_med_dose_sol6_w, qt_dose_soluc6_w);
		end if;	
		
		if (coalesce(cd_mat_soluc7_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc7_w, cd_unid_med_dose_sol7_w, qt_dose_soluc7_w);
		end if;		
	end if;
	
	if (nr_seq_protocolo2_w IS NOT NULL AND nr_seq_protocolo2_w::text <> '') then
		inserir_solucao_dialise(ie_bomba_infusao2_w, ie_tipo_solucao2_w, nr_seq_protocolo2_w, qt_solucao_total2_w, qt_dosagem2_w, qt_dose_ataque2_w, ie_unid_vel_inf2_w, qt_temp_solucao2_w, qt_volume_sol2_w, ie_ultima_bolsa2_w, ie_tidal2_w, ie_lavar_linhas2_w, ds_orientacao2_w, pr_concentracao2_w);
	
		if (coalesce(cd_mat_soluc1_2_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc1_2_w, cd_unid_med_dose_sol1_2_w, qt_dose_soluc1_2_w);
		end if;
		
		if (coalesce(cd_mat_soluc2_2_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc2_2_w, cd_unid_med_dose_sol2_2_w, qt_dose_soluc2_2_w);
		end if;
		
		if (coalesce(cd_mat_soluc3_2_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc3_2_w, cd_unid_med_dose_sol3_2_w, qt_dose_soluc3_2_w);
		end if;
		
		if (coalesce(cd_mat_soluc4_2_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc4_2_w, cd_unid_med_dose_sol4_2_w, qt_dose_soluc4_2_w);
		end if;
		
		if (coalesce(cd_mat_soluc5_2_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc5_2_w, cd_unid_med_dose_sol5_2_w, qt_dose_soluc5_2_w);
		end if;
		
		if (coalesce(cd_mat_soluc6_2_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc6_2_w, cd_unid_med_dose_sol6_2_w, qt_dose_soluc6_2_w);
		end if;
		
		if (coalesce(cd_mat_soluc7_2_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc7_2_w, cd_unid_med_dose_sol7_2_w, qt_dose_soluc7_2_w);
		end if;
	end if;
	
	if (nr_seq_protocolo3_w IS NOT NULL AND nr_seq_protocolo3_w::text <> '') then
		inserir_solucao_dialise(ie_bomba_infusao3_w, ie_tipo_solucao3_w, nr_seq_protocolo3_w, qt_solucao_total3_w, qt_dosagem3_w, qt_dose_ataque3_w, ie_unid_vel_inf3_w,qt_temp_solucao3_w, qt_volume_sol3_w, ie_ultima_bolsa3_w, ie_tidal3_w, ie_lavar_linhas3_w, ds_orientacao3_w, pr_concentracao3_w);
		
		if (coalesce(cd_mat_soluc1_3_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc1_3_w, cd_unid_med_dose_sol1_3_w, qt_dose_soluc1_3_w);
		end if;
		
		if (coalesce(cd_mat_soluc2_3_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc2_3_w, cd_unid_med_dose_sol2_3_w, qt_dose_soluc2_3_w);
		end if;
		
		if (coalesce(cd_mat_soluc3_3_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc3_3_w, cd_unid_med_dose_sol3_3_w, qt_dose_soluc3_3_w);
		end if;
		
		if (coalesce(cd_mat_soluc4_3_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc4_3_w, cd_unid_med_dose_sol4_3_w, qt_dose_soluc4_3_w);
		end if;
		
		if (coalesce(cd_mat_soluc5_3_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc5_3_w, cd_unid_med_dose_sol5_3_w, qt_dose_soluc5_3_w);
		end if;	
		
		if (coalesce(cd_mat_soluc6_3_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc6_3_w, cd_unid_med_dose_sol6_3_w, qt_dose_soluc6_3_w);
		end if;	
		
		if (coalesce(cd_mat_soluc7_3_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc7_3_w, cd_unid_med_dose_sol7_3_w, qt_dose_soluc7_3_w);
		end if;	
	end if;
	
	if (nr_seq_protocolo4_w IS NOT NULL AND nr_seq_protocolo4_w::text <> '') then
		inserir_solucao_dialise(ie_bomba_infusao4_w, ie_tipo_solucao4_w, nr_seq_protocolo4_w, qt_solucao_total4_w, qt_dosagem4_w, qt_dose_ataque4_w, ie_unid_vel_inf4_w,qt_temp_solucao4_w, qt_volume_sol4_w, ie_ultima_bolsa4_w, ie_tidal4_w, ie_lavar_linhas4_w, ds_orientacao4_w, pr_concentracao4_w);

		if (coalesce(cd_mat_soluc1_4_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc1_4_w, cd_unid_med_dose_sol1_4_w, qt_dose_soluc1_4_w);
		end if;
		
		if (coalesce(cd_mat_soluc2_4_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc2_4_w, cd_unid_med_dose_sol2_4_w, qt_dose_soluc2_4_w);
		end if;
		
		if (coalesce(cd_mat_soluc3_4_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc3_4_w, cd_unid_med_dose_sol3_4_w, qt_dose_soluc3_4_w);
		end if;
		
		if (coalesce(cd_mat_soluc4_4_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc4_4_w, cd_unid_med_dose_sol4_4_w, qt_dose_soluc4_4_w);
		end if;
		
		if (coalesce(cd_mat_soluc5_4_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc5_4_w, cd_unid_med_dose_sol5_4_w, qt_dose_soluc5_4_w);
		end if;		
		
		
		if (coalesce(cd_mat_soluc6_4_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc6_4_w, cd_unid_med_dose_sol6_4_w, qt_dose_soluc6_4_w);
		end if;
		
		if (coalesce(cd_mat_soluc7_4_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc7_4_w, cd_unid_med_dose_sol7_4_w, qt_dose_soluc7_4_w);
		end if;

	end if;	

	if (nr_seq_protocolo5_w IS NOT NULL AND nr_seq_protocolo5_w::text <> '') then
		inserir_solucao_dialise(ie_bomba_infusao5_w, ie_tipo_solucao5_w, nr_seq_protocolo5_w, qt_solucao_total5_w, qt_dosagem5_w, qt_dose_ataque5_w, ie_unid_vel_inf5_w,qt_temp_solucao5_w, qt_volume_sol5_w, ie_ultima_bolsa5_w, ie_tidal5_w, ie_lavar_linhas5_w, ds_orientacao5_w, pr_concentracao5_w);

		if (coalesce(cd_mat_soluc1_5_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc1_5_w, cd_unid_med_dose_sol1_5_w, qt_dose_soluc1_5_w);
		end if;
		
		if (coalesce(cd_mat_soluc2_5_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc2_5_w, cd_unid_med_dose_sol2_5_w, qt_dose_soluc2_5_w);
		end if;
		
		if (coalesce(cd_mat_soluc3_5_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc3_5_w, cd_unid_med_dose_sol3_5_w, qt_dose_soluc3_5_w);
		end if;
		
		if (coalesce(cd_mat_soluc4_5_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc4_5_w, cd_unid_med_dose_sol4_5_w, qt_dose_soluc4_5_w);
		end if;
		
		if (coalesce(cd_mat_soluc5_5_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc5_5_w, cd_unid_med_dose_sol5_5_w, qt_dose_soluc5_5_w);
		end if;		
		
		if (coalesce(cd_mat_soluc6_5_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc6_5_w, cd_unid_med_dose_sol6_5_w, qt_dose_soluc6_5_w);
		end if;
		
		if (coalesce(cd_mat_soluc7_5_w,0) > 0) then
			gerar_componente_material(cd_mat_soluc7_5_w, cd_unid_med_dose_sol7_5_w, qt_dose_soluc7_5_w);
		end if;

	end if;

	if (ie_tipo_dialise_w = 'H')  then
		update prescr_medica
		set	   ie_hemodialise = 'S'
		where  nr_prescricao = nr_prescricao_p;		
	end if;
	<<proximo_item>>	
	null;
	end;
end loop;
close C01;

commit;

exception when others then
	ds_erro_w	:= substr(to_char(sqlerrm),1,2000);

	CALL gravar_log_tasy(10007,
					substr(/*'Erro'*/
obter_desc_expressao(289370)||/*' Dialise:'*/ PERFORM obter_desc_expressao(287725)||ds_erro_w 	
										||'STACK ' || dbms_utility.format_call_stack
										||'//nr_sequencia_p:'||nr_sequencia_p||'nr_prescricao_p:'||nr_prescricao_p
									    ||'nr_atendimento_p:'||nr_atendimento_p||'cd_estabelecimento_p'||cd_estabelecimento_p
									    ||'cd_perfil_p:'||cd_perfil_p||'nm_usuario_p : '||nm_usuario_p
									    ||'dt_inicio_prescr_p :'||to_char(dt_inicio_prescr_p,'dd/mm/yyyy hh24:mi:ss')
									    ||'dt_inicio_ret_p :'||to_char(dt_inicio_ret_p,'dd/mm/yyyy hh24:mi:ss')
										||'cd_pessoa_fisica_p'||cd_pessoa_fisica_p,1,2000),
					nm_usuario_p);


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_insert_dialise_reg ( nr_atendimento_p atendimento_paciente.nr_atendimento%type, cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%type, nr_prescricao_p prescr_medica.nr_prescricao%type, nr_sequencia_p cpoe_dialise.nr_sequencia%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, cd_perfil_p perfil.cd_perfil%type, nm_usuario_p usuario.nm_usuario%type, dt_inicio_prescr_p timestamp, dt_inicio_ret_p INOUT timestamp) FROM PUBLIC;

