-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cpoe_insert_soluc_comp (nr_sequencia_p bigint, ds_list_components_p text) AS $body$
DECLARE


xml_w				xml;

c01 CURSOR FOR
SELECT  row_number() OVER () AS seq,
	cd_item,
	qt_dose,
	cd_unidade_medida
from	xmltable(
			'LIST_COMPONENTS/COMPONENT' passing xml_w columns
			cd_item		varchar(32)	path	'CD_ITEM',
			qt_dose	varchar(32)	path	'QT_DOSE',
			cd_unidade_medida	varchar(32)		path	'CD_UNIDADE_MEDIDA');

BEGIN

  xml_w := xmlparse(DOCUMENT, convert_from(, 'utf-8'));

  for c01_w in c01 loop
      insert into cpoe_material_add_comp(
        nr_sequencia,
        nm_usuario,
        dt_atualizacao,
        nm_usuario_nrec,
        dt_atualizacao_nrec,
        nr_seq_cpoe_material,
        nr_additional,
        cd_material,
        qt_dose,
        cd_unidade_medida)
      values (
        nextval('cpoe_material_add_comp_seq'),
        wheb_usuario_pck.get_nm_usuario(),
        clock_timestamp(),
        wheb_usuario_pck.get_nm_usuario(),
        clock_timestamp(),
        nr_sequencia_p,
        c01_w.seq,
        c01_w.cd_item,
        c01_w.qt_dose,
        c01_w.cd_unidade_medida);
  end loop;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_insert_soluc_comp (nr_sequencia_p bigint, ds_list_components_p text) FROM PUBLIC;

