-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_proc_pront_protoc ( nr_seq_proc_p bigint, cd_protocolo_p bigint, nr_sequencia_p bigint, nr_seq_paciente_p bigint, cd_intervalo_p text, ds_dias_aplicacao_p text, ds_ciclos_aplicacao_p text, nm_usuario_p text, qt_procedimento_p bigint, ie_lado_p text, nr_agrupamento_p bigint default null) AS $body$
DECLARE




nr_seq_procedimento_w	bigint;
ie_gerar_pend_quimio_w		varchar(1);


BEGIN

ie_gerar_pend_quimio_w := obter_param_usuario(865, 255, obter_perfil_ativo, nm_usuario_p, wheb_usuario_pck.get_cd_estabelecimento, ie_gerar_pend_quimio_w);

select	coalesce(max(nr_seq_procedimento),0) +1
into STRICT	nr_seq_procedimento_w
from	paciente_protocolo_proc
where	nr_seq_paciente	= nr_seq_paciente_p;

insert into paciente_protocolo_proc(
							nr_seq_paciente,
							nr_seq_procedimento,
							cd_procedimento,
							ie_origem_proced,
							qt_procedimento,
							ds_dias_aplicacao,
							dt_atualizacao,
							nm_usuario,
							dt_atualizacao_nrec,
							cd_intervalo,
							nm_usuario_nrec,
							nr_agrupamento,
							ie_se_necessario,
							ie_acm,
							nr_seq_proc_interno,
							ie_lado,
							ds_ciclos_aplicacao,
							ie_local_adm)
SELECT 	  nr_seq_paciente_p,
		  nr_seq_procedimento_w,
		  cd_procedimento,
		  ie_origem_proced,
		  coalesce(qt_procedimento_p,qt_procedimento),
		  coalesce(ds_dias_aplicacao_p,ds_dias_aplicacao),
		  clock_timestamp(),
		  nm_usuario_p,
		  clock_timestamp(),
		  coalesce(cd_intervalo_p,cd_intervalo),
		  nm_usuario_p,
		  nr_agrupamento_p,
		  ie_se_necessario,
		  ie_acm,
		  nr_seq_proc_interno,
		  coalesce(ie_lado_p,ie_lado),
		  coalesce(ds_ciclos_aplicacao_p,ds_ciclos_aplicacao),
		  CASE WHEN ie_gerar_pend_quimio_w='S' THEN  coalesce(IE_LOCAL_ADM,'H')  ELSE coalesce(IE_LOCAL_ADM,'') END
FROM 	PROTOCOLO_MEDIC_PROC
WHERE	nr_seq_proc = nr_seq_proc_p
and		cd_protocolo = cd_protocolo_p
and		nr_sequencia = nr_sequencia_p;


commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_proc_pront_protoc ( nr_seq_proc_p bigint, cd_protocolo_p bigint, nr_sequencia_p bigint, nr_seq_paciente_p bigint, cd_intervalo_p text, ds_dias_aplicacao_p text, ds_ciclos_aplicacao_p text, nm_usuario_p text, qt_procedimento_p bigint, ie_lado_p text, nr_agrupamento_p bigint default null) FROM PUBLIC;

