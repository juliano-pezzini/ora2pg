-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE excluir_pendencia_assinatura ( dt_parametro_p timestamp, nm_usuario_p text) AS $body$
BEGIN

--- Avaliação
delete from   pep_item_pendente a
where  a.ie_tipo_pendencia = 'A'
and    (a.nr_seq_avaliacao IS NOT NULL AND a.nr_seq_avaliacao::text <> '')
and    exists ( SELECT 1
       	        from   MED_AVALIACAO_PACIENTE b
	        where    a.nr_seq_avaliacao = b.nr_sequencia
	        and    (OBTER_DATA_ASSINATURA_DIGITAL(b.nr_seq_assinatura) IS NOT NULL AND (OBTER_DATA_ASSINATURA_DIGITAL(b.nr_seq_assinatura))::text <> ''));			
			
commit;


--- Avaliação Analgesia
delete from   pep_item_pendente a
where  a.ie_tipo_pendencia = 'A'
and    (a.NR_SEQ_ATEND_AVAL_ANALGESIA IS NOT NULL AND a.NR_SEQ_ATEND_AVAL_ANALGESIA::text <> '')
and    exists ( SELECT 1
       	        from   ATEND_AVAL_ANALGESIA b
	        where    a.NR_SEQ_ATEND_AVAL_ANALGESIA = b.nr_sequencia
	        and    (OBTER_DATA_ASSINATURA_DIGITAL(b.nr_seq_assinatura) IS NOT NULL AND (OBTER_DATA_ASSINATURA_DIGITAL(b.nr_seq_assinatura))::text <> ''));			
			
commit;


--- SV Monit Resp
delete from   pep_item_pendente a
where  a.ie_tipo_pendencia = 'A'
and    (a.nr_seq_atend_monit_resp IS NOT NULL AND a.nr_seq_atend_monit_resp::text <> '')
and    exists ( SELECT 1
       	        from   atendimento_monit_resp b
	        where    a.nr_seq_atend_monit_resp = b.nr_sequencia
	        and    (OBTER_DATA_ASSINATURA_DIGITAL(b.nr_seq_assinatura) IS NOT NULL AND (OBTER_DATA_ASSINATURA_DIGITAL(b.nr_seq_assinatura))::text <> ''));			
			
commit;

--- SV Monit Hemo
delete from   pep_item_pendente a
where  a.ie_tipo_pendencia = 'A'
and    (a.NR_SEQ_ATEND_MONIT_HEMO IS NOT NULL AND a.NR_SEQ_ATEND_MONIT_HEMO::text <> '')
and    exists ( SELECT 1
       	        from   Atend_monit_hemod b
	        where    a.NR_SEQ_ATEND_MONIT_HEMO = b.nr_sequencia
	        and    (OBTER_DATA_ASSINATURA_DIGITAL(b.nr_seq_assinatura) IS NOT NULL AND (OBTER_DATA_ASSINATURA_DIGITAL(b.nr_seq_assinatura))::text <> ''));			
			
commit;


--- Template
delete from   pep_item_pendente a
where  a.ie_tipo_pendencia = 'A'
and    (a.NR_SEQ_EHR_REG IS NOT NULL AND a.NR_SEQ_EHR_REG::text <> '')
and    exists ( SELECT 1
       	        from   ehr_registro b
	        where    a.NR_SEQ_EHR_REG = b.nr_sequencia
	        and    (OBTER_DATA_ASSINATURA_DIGITAL(b.nr_seq_assinatura) IS NOT NULL AND (OBTER_DATA_ASSINATURA_DIGITAL(b.nr_seq_assinatura))::text <> ''));			
			
commit;


--- Diagnostico Tumor
delete from   pep_item_pendente a
where  a.ie_tipo_pendencia = 'A'
and    (a.nr_seq_loco_reg IS NOT NULL AND a.nr_seq_loco_reg::text <> '')
and    exists ( SELECT 1
       	        from   CAN_LOCO_REGIONAL b
	        where    a.nr_seq_loco_reg = b.nr_sequencia
	        and    (OBTER_DATA_ASSINATURA_DIGITAL(b.nr_seq_assinatura) IS NOT NULL AND (OBTER_DATA_ASSINATURA_DIGITAL(b.nr_seq_assinatura))::text <> ''));			
			
commit;

--- Evolução
delete from   pep_item_pendente a
where  a.ie_tipo_pendencia = 'A'
and    (a.cd_evolucao IS NOT NULL AND a.cd_evolucao::text <> '')
and    exists ( SELECT 1
       	        from   evolucao_paciente b
	        where    a.cd_evolucao = b.cd_evolucao
	        and    (OBTER_DATA_ASSINATURA_DIGITAL(b.nr_seq_assinatura) IS NOT NULL AND (OBTER_DATA_ASSINATURA_DIGITAL(b.nr_seq_assinatura))::text <> ''));			
			
commit;


--- Ganhos e Perdas.
delete from   pep_item_pendente a
where  a.ie_tipo_pendencia = 'A'
and    (a.NR_SEQ_PERDA_GANHO IS NOT NULL AND a.NR_SEQ_PERDA_GANHO::text <> '')
and    exists ( SELECT 1
       	        from   ATENDIMENTO_PERDA_GANHO b
	        where    a.NR_SEQ_PERDA_GANHO = b.nr_sequencia
	        and    (OBTER_DATA_ASSINATURA_DIGITAL(b.nr_seq_assinatura) IS NOT NULL AND (OBTER_DATA_ASSINATURA_DIGITAL(b.nr_seq_assinatura))::text <> ''));			
			
commit;


--- Sinais Vitais
delete from   pep_item_pendente a
where  a.ie_tipo_pendencia = 'A'
and    (a.NR_SEQ_SINAL_VITAL IS NOT NULL AND a.NR_SEQ_SINAL_VITAL::text <> '')
and    exists ( SELECT 1
       	        from   ATENDIMENTO_SINAL_VITAL b
	        where    a.NR_SEQ_SINAL_VITAL = b.nr_sequencia
	        and    (OBTER_DATA_ASSINATURA_DIGITAL(b.nr_seq_assinatura) IS NOT NULL AND (OBTER_DATA_ASSINATURA_DIGITAL(b.nr_seq_assinatura))::text <> ''));			
			
commit;



--- Boletins informativos
delete from   pep_item_pendente a
where  a.ie_tipo_pendencia = 'A'
and    (a.nr_seq_registro IS NOT NULL AND a.nr_seq_registro::text <> '')
and    a.IE_TIPO_REGISTRO = 'LBI'
and    exists ( SELECT 1
       	        from   ATENDIMENTO_BOLETIM b
	        where    a.nr_seq_registro = b.nr_sequencia
	        and    (OBTER_DATA_ASSINATURA_DIGITAL(b.nr_seq_assinatura) IS NOT NULL AND (OBTER_DATA_ASSINATURA_DIGITAL(b.nr_seq_assinatura))::text <> ''));			
			
commit;


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE excluir_pendencia_assinatura ( dt_parametro_p timestamp, nm_usuario_p text) FROM PUBLIC;

