-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cpoe_calcular_horario_prescr ( nr_atendimento_p bigint, cd_intervalo_p text, cd_material_p bigint, dt_hora_inicio_p timestamp, qt_hora_intervalo_p bigint, qt_min_intervalo_p bigint, nr_intervalo_p INOUT bigint, ds_horarios_p INOUT text, ds_horarios2_p INOUT text, nm_usuario_p text, cd_estabelecimento_p bigint, cd_perfil_p bigint, ds_dose_diferenciada_p text, ie_exclui_hor_dd_zerados_p text DEFAULT NULL, cd_procedimento_p bigint DEFAULT NULL, ie_origem_proced_p bigint DEFAULT NULL, nr_seq_proc_interno_p bigint DEFAULT NULL, nr_hora_validade_p bigint DEFAULT NULL, dt_fim_validade_p timestamp DEFAULT NULL, qt_operacao_p bigint DEFAULT NULL) AS $body$
DECLARE


    dt_validade_prescr_w      prescr_medica.dt_validade_prescr%TYPE;
    dt_inicio_prescr_w        prescr_medica.dt_inicio_prescr%TYPE;
    ie_operacao_w             intervalo_prescricao.ie_operacao%TYPE;
    qt_operacao_w             intervalo_prescricao.qt_operacao%TYPE;
    ds_prescricao_w           intervalo_prescricao.ds_prescricao%TYPE;
    ie_dose_diferenciada_w    intervalo_prescricao.ie_dose_diferenciada%TYPE;
    ie_utiliza_quantidade_w   intervalo_prescricao.ie_utiliza_quantidade%TYPE;
    si_manual_input_w         intervalo_prescricao.si_manual_input%type;
    cd_setor_atend_prescr_w   setor_atendimento.cd_setor_atendimento%TYPE;
    dt_horario_w              timestamp;
    hr_prescricao_w           timestamp;
    hr_dose_w                 timestamp;
    dt_hora_inicio_w          timestamp;
    dt_medic_w                timestamp;
    ds_dt_prescr_w            varchar(255);
    dt_prox_horario_w         timestamp;
    k                         integer;
    nr_hora_validade_w        double precision;
    ie_utiliza_mascara_w      varchar(1);
    ie_virgula_w              varchar(1);
    ds_hora_w                 varchar(7);
    hr_horario_setor_w        varchar(10);
    mascara_data_w            varchar(10);
    ds_dose_diferenciada_w    varchar(255);
    ds_caracter_espaco_w      varchar(5);
    ds_horarios_param_w       varchar(2000);
    ds_hora_aux_w             varchar(255);
    ds_dose_w                 varchar(255);
    ds_horarios_fixo_w        varchar(255);
    ds_erro_w                 varchar(2000);
    ds_horarios_w             varchar(4000);
    ds_horarios_aux_w         varchar(4000);
    ie_controle_w             smallint := 0;
    if_cont_w                 integer;
    qt_doses_w                integer;
    nr_horas_intervalo_w      double precision;
    qt_dia_adic_w             bigint := 0;
    qt_hora_intervalo_w       double precision;
    qt_min_intervalo_regra_w  double precision;
    qt_min_intervalo_w        double precision;
    ds_horario_mat_set_w      varchar(2000);
    sql_w                     varchar(200);
    qt_min_intervalo_aux_w    double precision := NULL;
    ds_parametros_w           varchar(4000);
    cd_unidade_basica_w       atend_paciente_unidade.cd_unidade_basica%type;

    c01 CURSOR FOR
    SELECT
        qt_min_intervalo
    FROM
        intervalo_minuto
    WHERE
        cd_intervalo = cd_intervalo_p
    ORDER BY
        nr_seq_apres;


BEGIN
    ds_caracter_espaco_w := ' ';
    ds_horarios_param_w := trim(both cpoe_substr_horario(trim(both ds_horarios_p)));
--INICIO MD1
--OBTER_MIN_INTERVALO_PRESCR_MD (VERIFICAR SE JA NAO EXISTE UM OBJETO QUE FACA EXATAMENTE A MESMA TRATATIVA)
--RETORNOAR QT_MIN_INTERVALO_W
    BEGIN
        sql_w := 'CALL OBTER_MIN_INTERVALO_PRESCR_MD(:1, :2) INTO :qt_min_intervalo_w';
        EXECUTE sql_w
            USING IN qt_hora_intervalo_p, IN qt_min_intervalo_p, OUT qt_min_intervalo_w;
    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := ('nr_atendimento_p: '||nr_atendimento_p||'-'||'dt_hora_inicio_p: '||dt_hora_inicio_p||'-'||'cd_procedimento_p: '||cd_procedimento_p||'-'||
                          'ie_exclui_hor_dd_zerados_p: '||ie_exclui_hor_dd_zerados_p||'-'||'ie_origem_proced_p: '||ie_origem_proced_p||'-'||'ds_prescricao_w: '||ds_prescricao_w||'-'||
                          'qt_min_intervalo_regra_w: '||qt_min_intervalo_regra_w||'-'||'qt_min_intervalo_w: '||qt_min_intervalo_w||'-'||'ds_horario_mat_set_w: '||ds_horario_mat_set_w||'-'||
                          'qt_hora_intervalo_p: '||qt_hora_intervalo_p||'-'||'qt_min_intervalo_p: '||qt_min_intervalo_p||'-'||'qt_min_intervalo_w: '||qt_min_intervalo_w);
      CALL gravar_log_medical_device('cpoe_calcular_horario_prescr','OBTER_MIN_INTERVALO_PRESCR_MD'
                                 ,ds_parametros_w,ds_erro_w,nm_usuario_p,'S');
        
            qt_min_intervalo_w := NULL;
    END;
--FIM MD1
-- INICIO: Rotina para calcular a validade da prescricao
--INICIO MD 2
--CALCULAR_VALIDADE_PRESCR_MD
    BEGIN
        sql_w := 'begin CALCULAR_VALIDADE_PRESCR_MD  (:1, :2, :3, :4, :5, :6, :7, :8, :9, :10); end;';
        EXECUTE sql_w
            USING IN nr_hora_validade_p, IN pkg_i18n.get_user_locale(), IN dt_fim_validade_p, IN nr_atendimento_p, IN dt_hora_inicio_p,
            OUT dt_hora_inicio_w, OUT nr_hora_validade_w, OUT dt_validade_prescr_w, OUT ds_dt_prescr_w, OUT dt_inicio_prescr_w;

    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := ('nr_atendimento_p: '||nr_atendimento_p||'-'||'dt_hora_inicio_p: '||dt_hora_inicio_p||'-'||'cd_procedimento_p: '||cd_procedimento_p||'-'||
                          'ie_exclui_hor_dd_zerados_p: '||ie_exclui_hor_dd_zerados_p||'-'||'ie_origem_proced_p: '||ie_origem_proced_p||'-'||'ds_prescricao_w: '||ds_prescricao_w||'-'||
                          'qt_min_intervalo_regra_w: '||qt_min_intervalo_regra_w||'-'||'qt_min_intervalo_w: '||qt_min_intervalo_w||'-'||'ds_horario_mat_set_w: '||ds_horario_mat_set_w||'-'||
                          'nr_hora_validade_p: '||qt_hora_intervalo_p||'-'||'pkg_i18n.get_user_locale(): '||pkg_i18n.get_user_locale()||'-'||'dt_fim_validade_p: '||dt_fim_validade_p||'-'||
                          'dt_hora_inicio_w: '||dt_hora_inicio_w||'-'||'nr_hora_validade_w: '||nr_hora_validade_w||'-'||'dt_validade_prescr_w: '||dt_validade_prescr_w||'-'||
                          'ds_dt_prescr_w: '||ds_dt_prescr_w||'-'||'dt_inicio_prescr_w: '||dt_inicio_prescr_w);
      CALL gravar_log_medical_device('cpoe_calcular_horario_prescr','CALCULAR_VALIDADE_PRESCR_MD'
                                 ,ds_parametros_w,ds_erro_w,nm_usuario_p,'S');
        
            dt_hora_inicio_w := NULL;
            nr_hora_validade_w := NULL;
            dt_validade_prescr_w := NULL;
            ds_dt_prescr_w := NULL;
            dt_inicio_prescr_w := NULL;
    END;
--FIM MD 2
-- FIM: Rotina para calcular a validade da prescricao
    ds_dt_prescr_w		:= to_char(dt_inicio_prescr_w,'dd/mm/yyyy');
--INICIO MD 3
--OBTER_DT_HORA_INICIO
--RETORNAR DT_HORA_INICIO_W E DT_MEDIC_W
    BEGIN
        sql_w := 'begin OBTER_DT_HORA_INICIO_MD(:1, :2, :3, :4, :5); end;';
        EXECUTE sql_w USING IN dt_hora_inicio_p,
                                      IN ds_horarios_param_w, 
                                      IN dt_inicio_prescr_w, 
                                      IN OUT dt_hora_inicio_w, 
                                      OUT dt_medic_w;

    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := ('nr_atendimento_p: '||nr_atendimento_p||'-'||'dt_hora_inicio_p: '||dt_hora_inicio_p||'-'||'cd_procedimento_p: '||cd_procedimento_p||'-'||
                          'ie_exclui_hor_dd_zerados_p: '||ie_exclui_hor_dd_zerados_p||'-'||'ie_origem_proced_p: '||ie_origem_proced_p||'-'||'ds_prescricao_w: '||ds_prescricao_w||'-'||
                          'qt_min_intervalo_regra_w: '||qt_min_intervalo_regra_w||'-'||'qt_min_intervalo_w: '||qt_min_intervalo_w||'-'||'ds_horario_mat_set_w: '||ds_horario_mat_set_w||'-'||
                          'dt_hora_inicio_p: '||dt_hora_inicio_p||'-'||'ds_horarios_param_w: '||ds_horarios_param_w||'-'||'dt_inicio_prescr_w: '||dt_inicio_prescr_w||'-'||
                          'dt_hora_inicio_w: '||dt_hora_inicio_w||'-'||'dt_medic_w: '||dt_medic_w);
      CALL gravar_log_medical_device('cpoe_calcular_horario_prescr','OBTER_DT_HORA_INICIO_MD'
                                 ,ds_parametros_w,ds_erro_w,nm_usuario_p,'S');
        
            dt_hora_inicio_w := NULL;
            dt_medic_w := NULL;
    END;

--FIM MD 3
    select	max(b.cd_unidade_basica)
	into STRICT	cd_unidade_basica_w
	from	atendimento_paciente a,
			atend_paciente_unidade b
	where	a.nr_atendimento = b.nr_atendimento
	and		a.nr_atendimento = nr_atendimento_p
	and		b.nr_seq_interno = obter_atepacu_paciente(a.nr_atendimento, 'A');

    cd_setor_atend_prescr_w := cpoe_obter_setor_atend_prescr(nr_atendimento_p,cd_estabelecimento_p,cd_perfil_p,nm_usuario_p);

    select	coalesce(max(b.ds_horarios), ds_horario_mat_set_w)
    into STRICT	ds_horario_mat_set_w
    from	intervalo_setor b
    where	b.cd_intervalo = cd_intervalo_p
    and		((coalesce(b.cd_setor_atendimento::text, '') = '') or (b.cd_setor_atendimento = cd_setor_atend_prescr_w))
    and		((coalesce(b.cd_estab::text, '') = '') or (b.cd_estab = cd_estabelecimento_p))
    and		((coalesce(b.cd_material::text, '') = '') or (b.cd_material = cd_material_p))
    and		((coalesce(b.cd_unidade_basica::text, '') = '') or (b.cd_unidade_basica = cd_unidade_basica_w));

    IF (cd_material_p IS NOT NULL AND cd_material_p::text <> '') THEN
        SELECT
            MAX(ds_horarios)
        INTO STRICT ds_horario_mat_set_w
        FROM
            intervalo_material
        WHERE
                cd_intervalo = cd_intervalo_p
            AND cd_material = cd_material_p;

    END IF;

    IF ( coalesce(ds_horario_mat_set_w::text, '') = '' ) THEN
        SELECT
            MAX(ds_horarios)
        INTO STRICT ds_horario_mat_set_w
        FROM
            intervalo_setor
        WHERE
                cd_intervalo = cd_intervalo_p
            AND cd_material = cd_material_p;

    END IF;

    SELECT
        coalesce(MAX(coalesce(ds_horario_mat_set_w, ds_horarios)), ''),
        coalesce(MAX(ie_operacao), ''),
        coalesce(MAX(qt_operacao), 1),
        coalesce(MAX(ds_prescricao), ''),
        coalesce(MAX(ie_dose_diferenciada), 'N'),
        coalesce(MAX(ie_utiliza_quantidade), 'N'),
        coalesce(MAX(qt_min_intervalo), 0),
		coalesce(max(SI_MANUAL_INPUT),'N')
    INTO STRICT
        ds_horarios_w,
        ie_operacao_w,
        qt_operacao_w,
        ds_prescricao_w,
        ie_dose_diferenciada_w,
        ie_utiliza_quantidade_w,
        qt_min_intervalo_w,
		si_manual_input_w
    FROM
        intervalo_prescricao
    WHERE
        cd_intervalo = cd_intervalo_p;
	
    IF ( (qt_operacao_p IS NOT NULL AND qt_operacao_p::text <> '') AND PKG_I18N.get_user_locale = 'ja_JP' AND si_manual_input_w = 'S' ) THEN
        qt_operacao_w := qt_operacao_p;
    END IF;

    IF ( ie_utiliza_quantidade_w = 'N' )
        AND (cd_procedimento_p IS NOT NULL AND cd_procedimento_p::text <> '')
    THEN
        ie_utiliza_quantidade_w := obter_se_intervalo_operacao(cd_procedimento_p, ie_origem_proced_p, nr_seq_proc_interno_p, cd_intervalo_p);
    END IF;

    IF ( coalesce(cd_material_p::text, '') = '' )
        AND ( ie_operacao_w <> 'X' )
    THEN
        qt_min_intervalo_w := NULL;
    END IF;

    IF ( to_char(dt_hora_inicio_w, 'mi') <> '00' ) OR (
        ( coalesce(qt_min_intervalo_w, 0) > 0 )
        AND ( ie_operacao_w = 'X' )
    ) THEN
        mascara_data_w := 'hh24:mi';
    ELSE
        mascara_data_w := 'hh24';
    END IF;

    BEGIN
        ds_dose_diferenciada_w := ds_dose_diferenciada_p;
        qt_doses_w := 0;

--INICIO MD 4
--CALCULA_HORARIO_PRESCR_MD
    OPEN c01;
    LOOP
        FETCH c01 INTO qt_min_intervalo_regra_w;
        EXIT WHEN NOT FOUND; /* apply on c01 */
        IF ( coalesce(qt_min_intervalo_aux_w::text, '') = '' ) THEN
            qt_min_intervalo_aux_w := to_char(coalesce(qt_min_intervalo_regra_w, 0));
        ELSE
            qt_min_intervalo_aux_w := qt_min_intervalo_aux_w
                                      || ','
                                      || to_char(coalesce(qt_min_intervalo_regra_w, 0));
        END IF;

    END LOOP;

    CLOSE c01;

        BEGIN
            sql_w := 'begin CALCULA_HORARIO_PRESCR_MD  (:1, :2, :3, :4, :5, :6, :7, :8, :9, :10, :11, :12, :13, :14, :15, :16, :17, :18, :19, :20, :21); end;';
            EXECUTE sql_w USING IN OUT ds_dose_diferenciada_w,
                                          IN ie_dose_diferenciada_w, 
                                          IN ie_operacao_w, 
                                          IN OUT qt_operacao_W, 
                                          IN ds_caracter_espaco_w,
                                          IN dt_medic_w,
                                          IN mascara_data_w, 
                                          IN ie_exclui_hor_dd_zerados_p, 
                                          IN dt_hora_inicio_w, 
                                          IN OUT qt_doses_w,
                                          IN ds_dt_prescr_w, 
                                          IN dt_inicio_prescr_w, 
                                          IN qt_min_intervalo_w, 
                                          IN ie_utiliza_quantidade_w,
                                          IN nr_hora_validade_w, 
                                          IN qt_min_intervalo_aux_w, 
                                          IN dt_validade_prescr_w, 
                                          OUT ds_horarios_fixo_w,
                                          IN OUT ds_horarios_w, 
                                          IN OUT nr_intervalo_p, 
                                          OUT hr_prescricao_w;
        EXCEPTION
            WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := ('nr_atendimento_p: '||nr_atendimento_p||'-'||'dt_hora_inicio_p: '||dt_hora_inicio_p||'-'||'cd_procedimento_p: '||cd_procedimento_p||'-'||
                          'ie_exclui_hor_dd_zerados_p: '||ie_exclui_hor_dd_zerados_p||'-'||'ie_origem_proced_p: '||ie_origem_proced_p||'-'||'ds_prescricao_w: '||ds_prescricao_w||'-'||
                          'qt_min_intervalo_regra_w: '||qt_min_intervalo_regra_w||'-'||'qt_min_intervalo_w: '||qt_min_intervalo_w||'-'||'ds_horario_mat_set_w: '||ds_horario_mat_set_w||'-'||
                          'ds_dose_diferenciada_w: '||ds_dose_diferenciada_w||'-'||'ie_dose_diferenciada_w: '||ie_dose_diferenciada_w||'-'||'ie_operacao_w: '||ie_operacao_w||'-'||
                          'qt_operacao_W: '||qt_operacao_W||'-'||'ds_caracter_espaco_w: '||ds_caracter_espaco_w||'-'||'dt_medic_w: '||dt_medic_w||'-'||
                          'mascara_data_w: '||mascara_data_w||'-'||'ie_exclui_hor_dd_zerados_p: '||ie_exclui_hor_dd_zerados_p||'-'||'dt_hora_inicio_w: '||dt_hora_inicio_w||'-'||
                          'qt_doses_w: '||qt_doses_w||'-'||'ds_dt_prescr_w: '||ds_dt_prescr_w||'-'||'dt_inicio_prescr_w: '||dt_inicio_prescr_w||'-'||
                          'qt_min_intervalo_w: '||qt_min_intervalo_w||'-'||'ie_utiliza_quantidade_w: '||ie_utiliza_quantidade_w||'-'||'nr_hora_validade_w: '||nr_hora_validade_w||'-'||
                          'qt_min_intervalo_aux_w: '||qt_min_intervalo_aux_w||'-'||'dt_validade_prescr_w: '||dt_validade_prescr_w||'-'||'ds_horarios_fixo_w: '||ds_horarios_fixo_w||'-'||
                          'ds_horarios_w: '||ds_horarios_w||'-'||'nr_intervalo_p: '||nr_intervalo_p||'-'||'hr_prescricao_w: '||hr_prescricao_w);

      CALL gravar_log_medical_device('cpoe_calcular_horario_prescr','CALCULA_HORARIO_PRESCR_MD'
                                 ,ds_parametros_w,ds_erro_w,nm_usuario_p,'S');
            
                ds_dose_diferenciada_w := NULL;
                qt_operacao_W := NULL;
                qt_doses_w := NULL;
                ds_horarios_fixo_w := NULL;
                ds_horarios_w := NULL;
                nr_intervalo_p := NULL;
                hr_prescricao_w := NULL;
        END;

--FIM MD4
--INICIO MD 5
--VERIFICAR_SE_VALIDADE_MD
-- Tratamento para verificar se esta na validade
    BEGIN
        sql_w := 'begin VERIFICAR_SE_VALIDADE_MD(:1, :2, :3, :4, :5, :6, :7, :8, :9, :10); end;';
        EXECUTE sql_w USING IN ds_dose_diferenciada_p,
                                      IN ie_dose_diferenciada_w, 
                                      IN ie_operacao_w, 
                                      IN dt_medic_w, 
                                      IN ds_caracter_espaco_w, 
                                      IN dt_inicio_prescr_w, 
                                      IN dt_validade_prescr_w, 
                                      IN ds_horarios_fixo_w, 
                                      IN OUT nr_intervalo_p,
                                      IN OUT ds_horarios_w;

    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := ('nr_atendimento_p: '||nr_atendimento_p||'-'||'dt_hora_inicio_p: '||dt_hora_inicio_p||'-'||'cd_procedimento_p: '||cd_procedimento_p||'-'||
                          'ie_exclui_hor_dd_zerados_p: '||ie_exclui_hor_dd_zerados_p||'-'||'ie_origem_proced_p: '||ie_origem_proced_p||'-'||'ds_prescricao_w: '||ds_prescricao_w||'-'||
                          'qt_min_intervalo_regra_w: '||qt_min_intervalo_regra_w||'-'||'qt_min_intervalo_w: '||qt_min_intervalo_w||'-'||'ds_horario_mat_set_w: '||ds_horario_mat_set_w||'-'||
                          'ds_dose_diferenciada_p: '||ds_dose_diferenciada_p||'-'||'ie_dose_diferenciada_w: '||ie_dose_diferenciada_w||'-'||'ie_operacao_w: '||ie_operacao_w||'-'||
                          'dt_medic_w: '||dt_medic_w||'-'||'ds_caracter_espaco_w: '||ds_caracter_espaco_w||'-'||'dt_inicio_prescr_w: '||dt_inicio_prescr_w||'-'||
                          'dt_validade_prescr_w: '||dt_validade_prescr_w||'-'||'ds_horarios_fixo_w: '||ds_horarios_fixo_w||'-'||
                          'nr_intervalo_p: '||nr_intervalo_p||'-'||'ds_horarios_w: '||ds_horarios_w);

      CALL gravar_log_medical_device('cpoe_calcular_horario_prescr','VERIFICAR_SE_VALIDADE_MD'
                                 ,ds_parametros_w,ds_erro_w,nm_usuario_p,'S');
        
            ds_horarios_w := NULL;
            nr_intervalo_p := NULL;
    END;

--FIM MD 5
        IF ( nr_intervalo_p = 0 ) THEN
            nr_intervalo_p := 1;
        END IF;
        ds_horarios_p := trim(both cpoe_substr_horario(trim(both replace(ds_horarios_w,' ',ds_caracter_espaco_w)),2000));
        ds_horarios2_p := '';
        IF ( nr_intervalo_p < 0 ) THEN
            nr_intervalo_p := 0;
        END IF;
        IF ( nr_intervalo_p = 0 ) OR ( coalesce(nr_intervalo_p::text, '') = '' ) THEN
            nr_intervalo_p := 1;
        END IF;

    EXCEPTION
        WHEN OTHERS THEN
            ds_erro_w := sqlerrm;
	CALL gravar_log_tasy(10007,
		substr('CPOE_CALCULAR_HORARIO_PRESCR line 464 - '
							||' sqlerrm ' || ds_erro_w
							||' STACK ' || dbms_utility.format_call_stack
							||' //nr_atendimento_p: '||nr_atendimento_p
							||' cd_intervalo_p:'||cd_intervalo_p
							||' cd_material_p:'||cd_material_p
							||' dt_hora_inicio_p:'||PKG_DATE_FORMATERS_TZ.TO_VARCHAR(dt_hora_inicio_p, 'timestamp', ESTABLISHMENT_TIMEZONE_UTILS.getTimeZone)
							||' qt_hora_intervalo_p: ' || qt_hora_intervalo_p
							||' qt_min_intervalo_p: ' || qt_min_intervalo_p
							||' nr_intervalo_p: ' || nr_intervalo_p
							||' ds_horarios_p: ' || ds_horarios_p
							||' ds_horarios2_p: ' || ds_horarios2_p
							||' nm_usuario_p: ' || nm_usuario_p
							||' cd_estabelecimento_p: ' || cd_estabelecimento_p
							||' cd_perfil_p: ' || cd_perfil_p
							||' ds_dose_diferenciada_p: ' || ds_dose_diferenciada_p
							||' ie_exclui_hor_dd_zerados_p: ' || ie_exclui_hor_dd_zerados_p
							||' cd_procedimento_p: ' || cd_procedimento_p
							||' ie_origem_proced_p: ' || ie_origem_proced_p
							||' nr_seq_proc_interno_p: ' || nr_seq_proc_interno_p
							||' nr_hora_validade_p: ' || nr_hora_validade_p
							,1,2000), nm_usuario_p);		


    END;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_calcular_horario_prescr ( nr_atendimento_p bigint, cd_intervalo_p text, cd_material_p bigint, dt_hora_inicio_p timestamp, qt_hora_intervalo_p bigint, qt_min_intervalo_p bigint, nr_intervalo_p INOUT bigint, ds_horarios_p INOUT text, ds_horarios2_p INOUT text, nm_usuario_p text, cd_estabelecimento_p bigint, cd_perfil_p bigint, ds_dose_diferenciada_p text, ie_exclui_hor_dd_zerados_p text DEFAULT NULL, cd_procedimento_p bigint DEFAULT NULL, ie_origem_proced_p bigint DEFAULT NULL, nr_seq_proc_interno_p bigint DEFAULT NULL, nr_hora_validade_p bigint DEFAULT NULL, dt_fim_validade_p timestamp DEFAULT NULL, qt_operacao_p bigint DEFAULT NULL) FROM PUBLIC;

