-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE sus_atual_aih_dados_conta ( nr_atendimento_p bigint, nr_aih_p bigint, nr_seq_aih_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_interno_conta_w		bigint;
ie_codigo_autorizacao_ww	smallint;
ie_codigo_autorizacao_w	smallint;
cd_motivo_cobranca_ww	smallint;
cd_motivo_cobranca_w	smallint;
cd_cid_causa_morte_w	varchar(10);
cd_cid_causa_morte_ww	varchar(10);


BEGIN

begin
select	x.nr_interno_conta,
	x.ie_codigo_autorizacao,
	x.cd_motivo_cobranca,
	x.cd_cid_causa_morte
into STRICT	nr_interno_conta_w,
	ie_codigo_autorizacao_w,
	cd_motivo_cobranca_w,
	cd_cid_causa_morte_w
from 	sus_aih_unif x
where 	x.nr_atendimento = nr_atendimento_p
and	x.nr_sequencia = nr_seq_aih_p
and	x.nr_aih = nr_aih_p;
exception
when others then
	nr_interno_conta_w := 0;
end;

if (coalesce(nr_interno_conta_w,0) <> 0) then
	begin

	begin
	select	ie_codigo_autorizacao,
		cd_motivo_cobranca,
		cd_cid_causa_morte
	into STRICT	ie_codigo_autorizacao_ww,
		cd_motivo_cobranca_ww,
		cd_cid_causa_morte_ww
	from	sus_dados_aih_conta
	where	nr_interno_conta = nr_interno_conta_w;
	exception
	when others then
		ie_codigo_autorizacao_ww	:= ie_codigo_autorizacao_w;
		cd_motivo_cobranca_ww		:= cd_motivo_cobranca_w;
		cd_cid_causa_morte_ww		:= cd_cid_causa_morte_w;
	end;


	update	sus_aih_unif
	set 	ie_codigo_autorizacao = coalesce(ie_codigo_autorizacao_ww,ie_codigo_autorizacao_w),
		cd_motivo_cobranca = coalesce(cd_motivo_cobranca_ww,cd_motivo_cobranca_w),
		cd_cid_causa_morte = coalesce(cd_cid_causa_morte_ww,cd_cid_causa_morte_w)
	where	nr_interno_conta = nr_interno_conta_w;
	end;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE sus_atual_aih_dados_conta ( nr_atendimento_p bigint, nr_aih_p bigint, nr_seq_aih_p bigint, nm_usuario_p text) FROM PUBLIC;

