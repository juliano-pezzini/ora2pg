-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copiar_pessoa_juridica_estab ( cd_estab_origem_p bigint, cd_estab_destino_p bigint, nm_usuario_p text) AS $body$
DECLARE


cd_cgc_w			varchar(14);
nm_pessoa_contato_w		varchar(255);
ds_email_w			varchar(255);
nr_ramal_contato_w		integer;
cd_cond_pagto_w			bigint;
qt_dia_prazo_entrega_w		smallint;
vl_minimo_nf_w			double precision;
ie_qualidade_w			varchar(06);
cd_referencia_fornec_w		varchar(20);
ie_forma_pagto_w			varchar(15);
ie_conta_dif_nf_w			varchar(01);
cd_interno_lab_w			varchar(20);
cd_interf_lab_lote_envio_w		bigint;
cd_interf_lab_lote_ret_w		bigint;
nr_seq_xml_lab_envio_w		bigint;
nr_seq_xml_lab_ret_w		bigint;
cd_portador_w			bigint;
cd_tipo_portador_w			integer;
cd_tipo_baixa_w			integer;
qt_existe_w			bigint;
cd_interface_pls_mensalidade_w	bigint;
ie_rateio_adiant_w		varchar(2);
ie_retem_iss_w			varchar(1);
tx_desc_ordem_w			double precision;
pr_desc_financeiro_w		double precision;
ie_endereco_correspondencia_w	smallint;

c01 CURSOR FOR
SELECT	cd_cgc,
	nm_pessoa_contato,
	nr_ramal_contato,
	ds_email,
	cd_cond_pagto,
	qt_dia_prazo_entrega,
	vl_minimo_nf,
	ie_qualidade,
	cd_referencia_fornec,
	ie_forma_pagto,
	ie_conta_dif_nf,
	cd_interno_lab,
	cd_interf_lab_lote_envio,
	cd_interf_lab_lote_ret,
	nr_seq_xml_lab_envio,
	nr_seq_xml_lab_ret,
	cd_portador,
	cd_tipo_portador,
	cd_tipo_baixa,
	cd_interf_pls_mensalidade,
	ie_rateio_adiant,
	ie_retem_iss,
	tx_desc_ordem,
	pr_desc_financeiro,
	ie_endereco_correspondencia
from	pessoa_juridica_estab
where	cd_estabelecimento = cd_estab_origem_p;


BEGIN

open C01;
loop
fetch C01 into
	cd_cgc_w,
	nm_pessoa_contato_w,
	nr_ramal_contato_w,
	ds_email_w,
	cd_cond_pagto_w,
	qt_dia_prazo_entrega_w,
	vl_minimo_nf_w,
	ie_qualidade_w,
	cd_referencia_fornec_w,
	ie_forma_pagto_w,
	ie_conta_dif_nf_w,
	cd_interno_lab_w,
	cd_interf_lab_lote_envio_w,
	cd_interf_lab_lote_ret_w,
	nr_seq_xml_lab_envio_w,
	nr_seq_xml_lab_ret_w,
	cd_portador_w,
	cd_tipo_portador_w,
	cd_tipo_baixa_w,
	cd_interface_pls_mensalidade_w,
	ie_rateio_adiant_w,
	ie_retem_iss_w,
	tx_desc_ordem_w,
	pr_desc_financeiro_w,
	ie_endereco_correspondencia_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin

	select	count(*)
	into STRICT	qt_existe_w
	from	pessoa_juridica_estab
	where	cd_cgc = cd_cgc_w
	and	cd_estabelecimento = cd_estab_destino_p;

	if (qt_existe_w = 0) then
		begin
		insert into pessoa_juridica_estab(
			nr_sequencia,
			cd_cgc,
			cd_estabelecimento,
			dt_atualizacao,
			nm_usuario,
			nm_pessoa_contato,
			nr_ramal_contato,
			ds_email,
			cd_cond_pagto,
			qt_dia_prazo_entrega,
			vl_minimo_nf,
			ie_qualidade,
			cd_referencia_fornec,
			ie_forma_pagto,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			ie_conta_dif_nf,
			cd_interno_lab,
			cd_interf_lab_lote_envio,
			cd_interf_lab_lote_ret,
			nr_seq_xml_lab_envio,
			nr_seq_xml_lab_ret,
			cd_portador,
			cd_tipo_portador,
			cd_tipo_baixa,
			cd_interf_pls_mensalidade,
			ie_rateio_adiant,
			ie_retem_iss,
			tx_desc_ordem,
			pr_desc_financeiro,
			ie_endereco_correspondencia)
		values (	nextval('pessoa_juridica_estab_seq'),
			cd_cgc_w,
			cd_estab_destino_p,
			clock_timestamp(),
			nm_usuario_p,
			nm_pessoa_contato_w,
			nr_ramal_contato_w,
			ds_email_w,
			cd_cond_pagto_w,
			qt_dia_prazo_entrega_w,
			vl_minimo_nf_w,
			ie_qualidade_w,
			cd_referencia_fornec_w,
			ie_forma_pagto_w,
			clock_timestamp(),
			nm_usuario_p,
			ie_conta_dif_nf_w,
			cd_interno_lab_w,
			cd_interf_lab_lote_envio_w,
			cd_interf_lab_lote_ret_w,
			nr_seq_xml_lab_envio_w,
			nr_seq_xml_lab_ret_w,
			cd_portador_w,
			cd_tipo_portador_w,
			cd_tipo_baixa_w,
			cd_interface_pls_mensalidade_w,
			ie_rateio_adiant_w,
			ie_retem_iss_w,
			tx_desc_ordem_w,
			pr_desc_financeiro_w,
			ie_endereco_correspondencia_w);
		end;
	end if;
	end;
end loop;
close C01;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copiar_pessoa_juridica_estab ( cd_estab_origem_p bigint, cd_estab_destino_p bigint, nm_usuario_p text) FROM PUBLIC;

