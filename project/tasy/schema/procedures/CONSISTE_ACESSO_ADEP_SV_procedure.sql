-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consiste_acesso_adep_sv ( cd_estabelecimento_p bigint, nr_atendimento_p bigint, cd_pessoa_fisica_p text, --- Do usuário 
 nm_usuario_p text, dt_logon_p timestamp, ie_permite_p INOUT text, nr_mensagem_p INOUT text) AS $body$
DECLARE

 
cd_paciente_w		varchar(20); --- Do paciente 
ie_permite_w		varchar(2);
nr_seq_mensagem_w	varchar(20);

BEGIN
--- Busca o código de pessoa fisica do paciente 
select	max(obter_dados_atendimento(nr_atendimento_p,'CP')) 
into STRICT	cd_paciente_w
;
--- Execulta a procedure 
 
SELECT * FROM Consistir_acesso_ADEP(cd_estabelecimento_p, nr_atendimento_p, cd_paciente_w, cd_pessoa_fisica_p, nm_usuario_p, dt_logon_p, ie_permite_w, nr_seq_mensagem_w) INTO STRICT ie_permite_w, nr_seq_mensagem_w;
 
if (ie_permite_w = 'S') then 
	SELECT * FROM Consistir_acesso_ADEP_item(cd_estabelecimento_p, nr_atendimento_p, cd_paciente_w, cd_pessoa_fisica_p, nm_usuario_p, dt_logon_p, 13, ie_permite_w, nr_seq_mensagem_w) INTO STRICT ie_permite_w, nr_seq_mensagem_w;
end if;
if (ie_permite_w = 'S') and (nr_seq_mensagem_w = 0) then 
	nr_seq_mensagem_w := null;
end if;
 
ie_permite_p		:= ie_permite_w;
nr_mensagem_p		:= nr_seq_mensagem_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consiste_acesso_adep_sv ( cd_estabelecimento_p bigint, nr_atendimento_p bigint, cd_pessoa_fisica_p text, nm_usuario_p text, dt_logon_p timestamp, ie_permite_p INOUT text, nr_mensagem_p INOUT text) FROM PUBLIC;

