-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consistir_funcao_cargo_pf ( cd_pessoa_fisica_p text, cd_funcao_p bigint, ds_inconsistencia_p INOUT text ) AS $body$
DECLARE

 
cd_cargo_w	bigint;
cd_cargo_pf_w	bigint;
dt_obito_w	timestamp;
					

BEGIN 
 
if (cd_funcao_p > 0) and (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') then 
 
	select	coalesce(max(cd_cargo),0) 
	into STRICT	cd_cargo_w 
	from	funcao_medico 
	where	cd_funcao	=	cd_funcao_p;
	 
	select	dt_obito 
	into STRICT	dt_obito_w 
	from	pessoa_fisica 
	where	cd_pessoa_fisica	=	cd_pessoa_fisica_p;
	 
	if (dt_obito_w IS NOT NULL AND dt_obito_w::text <> '') then 
		ds_inconsistencia_p := WHEB_MENSAGEM_PCK.get_texto(955872);
	end if;
	 
	if (cd_cargo_w > 0) then 
		select	cd_cargo 
		into STRICT	cd_cargo_pf_w 
		from	pessoa_fisica 
		where	cd_pessoa_fisica	=	cd_pessoa_fisica_p;
		 
		if (coalesce(cd_cargo_w,0) <> coalesce(cd_cargo_pf_w,0)) then 
			if (coalesce(ds_inconsistencia_p,'') <> '') then 
				ds_inconsistencia_p	:= ds_inconsistencia_p || chr(10) || WHEB_MENSAGEM_PCK.get_texto(955873, 'DS_CARGO='||obter_desc_cargo(cd_cargo_w));
			else 
				ds_inconsistencia_p	:= WHEB_MENSAGEM_PCK.get_texto(955873, 'DS_CARGO='||obter_desc_cargo(cd_cargo_w));
			end if;
		end if;
	end if;
end if;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consistir_funcao_cargo_pf ( cd_pessoa_fisica_p text, cd_funcao_p bigint, ds_inconsistencia_p INOUT text ) FROM PUBLIC;

