-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_ajustar_protocolo_equip () AS $body$
BEGIN

	INSERT	INTO RXT_PROTOCOLO_EQUIP(nr_sequencia,
	dt_atualizacao,
	nm_usuario,
	dt_atualizacao_nrec,
	nm_usuario_nrec,
	nr_seq_equipamento,
	nr_seq_protocolo,
	ie_situacao
	)
	(SELECT	nextval('rxt_protocolo_equip_seq'),
	a.dt_atualizacao,
	'TASY',
	a.dt_atualizacao_nrec,
	a.nm_usuario_nrec,
	c.nr_seq_equipamento,
	a.nr_sequencia,
	'A'
	FROM rxt_protocolo a,
		   	      rxt_tipo b,
				  rxt_equip_tipo c
	WHERE a.nr_seq_tipo = b.nr_Sequencia
	AND c.nr_seq_tipo = a.nr_seq_tipo
	and	not exists (select	1
			from		rxt_protocolo_equip x
			where		x.nr_seq_protocolo = a.nr_sequencia
			and		c.nr_seq_equipamento = x.nr_seq_equipamento)
	);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_ajustar_protocolo_equip () FROM PUBLIC;

