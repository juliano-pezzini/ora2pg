-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_sql_rel_mov_est ( nm_filtro_p text, cd_perfil_p bigint, ds_sql_p INOUT funcao_filtro.ds_sql%type , ds_sql_entrada_p text, ie_opcao_p text, nm_usuario_p text) AS $body$
DECLARE



qt_registro_w	bigint;
ds_sql_w	funcao_filtro.ds_sql%type;
nr_sequencia_w	funcao_filtro.nr_sequencia%type;


BEGIN


select 		count(*),
		ds_sql,
		nr_sequencia
into STRICT  		qt_registro_w,
		ds_sql_w,
		nr_sequencia_w
from		funcao_filtro
where 		cd_funcao = 141
and		ds_filtro = 'EtqRel_ME'
and		ie_tipo_filtro = 'D'
and		nr_seq_filtro = 394386
and		nm_filtro = nm_filtro_p
and		cd_perfil = cd_perfil_p
and 		ds_campo =  'FILTROS_ME'
group by 1,ds_sql,nr_sequencia;

if (qt_registro_w > 0) and (ie_opcao_p = 'S') then

	begin

		update 		funcao_filtro
		set 		ds_sql = ds_sql_entrada_p
		where 		cd_funcao = 141
		and		ds_filtro = 'EtqRel_ME'
		and		ie_tipo_filtro = 'D'
		and		nr_seq_filtro = 394386
		and		nm_filtro = nm_filtro_p
		and		cd_perfil = cd_perfil_p
		and 		ds_campo =  'FILTROS_ME';

		commit;

	end;

end if;

ds_sql_p	:= substr(ds_sql_w,1,2000);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_sql_rel_mov_est ( nm_filtro_p text, cd_perfil_p bigint, ds_sql_p INOUT funcao_filtro.ds_sql%type , ds_sql_entrada_p text, ie_opcao_p text, nm_usuario_p text) FROM PUBLIC;

