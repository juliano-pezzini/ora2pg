-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_tit_receber_classif (nr_titulo_p bigint, nm_usuario_p text) AS $body$
DECLARE


cd_estabelecimento_w	smallint;
cd_cgc_w		varchar(14);
cd_pessoa_fisica_w	varchar(255);
nr_seq_conta_financ_w	bigint;
nr_seq_proj_rec_w		bigint;
vl_titulo_w		double precision;
ie_origem_titulo_w	varchar(10);
nr_seq_classe_tit_rec_w	bigint;
nr_seq_trans_fin_w	bigint;
ie_tipo_titulo_rec_w	titulo_receber.ie_tipo_titulo%type;
cd_moeda_w		titulo_receber.cd_moeda%type;


BEGIN

if (nr_titulo_p IS NOT NULL AND nr_titulo_p::text <> '') then

	select	a.cd_estabelecimento,
		a.cd_cgc,
		a.nr_seq_proj_rec,
		a.vl_titulo,
		a.cd_pessoa_fisica,
		a.ie_origem_titulo,
		a.nr_seq_classe,
		a.nr_seq_trans_fin_contab,
		a.ie_tipo_titulo,
		a.cd_moeda
	into STRICT	cd_estabelecimento_w,
		cd_cgc_w,
		nr_seq_proj_rec_w,
		vl_titulo_w,
		cd_pessoa_fisica_w,
		ie_origem_titulo_w,
		nr_seq_classe_tit_rec_w,
		nr_seq_trans_fin_w,
		ie_tipo_titulo_rec_w,
		cd_moeda_w
	from	titulo_receber a
	where	a.nr_titulo		= nr_titulo_p;

	nr_seq_conta_financ_w := obter_conta_financeira(	'E', cd_estabelecimento_w, null, null, null, null, null, cd_cgc_w, null, nr_seq_conta_financ_w, null, null, null, null, null, nr_seq_proj_rec_w, null, cd_pessoa_fisica_w, ie_origem_titulo_w, null, nr_seq_classe_tit_rec_w, null, null, nr_seq_trans_fin_w, null, null, null, ie_tipo_titulo_rec_w, cd_moeda_w);

	if (coalesce(nr_seq_conta_financ_w, 0) > 0) then

		insert	into	titulo_receber_classif(cd_centro_custo,
			cd_conta_contabil,
			dt_atualizacao,
			nm_usuario,
			cd_conta_financ,
			nr_sequencia,
			nr_titulo,
			vl_desconto,
			vl_original,
			vl_classificacao)
		values (null,
			null,
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_conta_financ_w,
			1,
			nr_titulo_p,
			0,
			0,
			vl_titulo_w);
	end if;
end if;

commit;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_tit_receber_classif (nr_titulo_p bigint, nm_usuario_p text) FROM PUBLIC;

