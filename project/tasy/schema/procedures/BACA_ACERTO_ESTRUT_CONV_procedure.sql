-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_acerto_estrut_conv (nm_usuario_p text) AS $body$
DECLARE



nr_sequencia_w		bigint;
cd_convenio_w		bigint;
qt_registro_w		bigint;
nr_seq_atributo_w	bigint;

c01 CURSOR FOR
	SELECT	nr_sequencia,
		cd_convenio
	from	convenio_estrutura_conta a
	where	cd_estrutura	= 12
	and	not exists (SELECT 1
		from 	convenio_estrut_atrib x
		where	x.nr_sequencia	= a.nr_sequencia
		and	x.nm_atributo	= 'NR_NOTA_CAB');



BEGIN

select	count(*)
into STRICT	qt_registro_w
from	log_tasy
where	cd_log = 7225;

if (qt_registro_w = 0) then
	begin

	open	c01;
	loop
	fetch	c01 into
		nr_sequencia_w,
		cd_convenio_w;
	EXIT WHEN NOT FOUND; /* apply on c01 */
		begin

		select	coalesce(max(nr_seq_atributo),0) + 1
		into STRICT	nr_seq_atributo_w
		from	convenio_estrut_atrib
		where	nr_sequencia	= nr_sequencia_w;


		insert 	into convenio_estrut_atrib(NR_SEQUENCIA          ,
			NM_ATRIBUTO            ,
			NR_SEQ_ATRIBUTO        ,
			DT_ATUALIZACAO         ,
			NM_USUARIO             ,
			NM_ALIAS               ,
			DS_MASCARA             ,
			IE_TOTALIZA            ,
			IE_QUEBRA              ,
			QT_TAMANHO             ,
			IE_IMPRIME             ,
			IE_SOMA_TOTAL          ,
			IE_CONVERSAO           ,
			NM_TABELA_CONVERSAO    ,
			NM_ATRIBUTO_CONVERSAO  ,
			IE_SOMA_ESTRUTURA      ,
			QT_TAM_FONTE           ,
			NR_SEQ_INTERNO		   ,
			IE_ESTENDER)
		values (nr_sequencia_w,
			'NR_NOTA_CAB', nr_seq_atributo_w,
			clock_timestamp(), nm_usuario_p,
			null, null, 'N', 'N', 10,
			'S', 'N', 'S', null, null, 'N',
			8, nextval('convenio_estrut_atrib_seq'),
			'N');


		end;
	end loop;
	close c01;
	end;
end if;


/*insert into logxxxx_tasy
	(dt_atualizacao, nm_usuario, cd_log, ds_log)
values
	(sysdate, nm_usuario_p, 7225, 'Acerto estrutura conta (Not fiscal no cabe√ßalho)');*/
commit;


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_acerto_estrut_conv (nm_usuario_p text) FROM PUBLIC;

