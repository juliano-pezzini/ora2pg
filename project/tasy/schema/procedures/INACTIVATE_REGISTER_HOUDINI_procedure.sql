-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inactivate_register_houdini ( NM_TABELA_P text, NR_SEQ_ORIGEM_P bigint, IE_DELETAR_APAP_W text DEFAULT 'N') AS $body$
DECLARE

    ds_comando_w text := '';
    COLUMN_NAME_STATUS_W varchar(40) := null;
    COLUMN_NAME_USER_W varchar(400) := null;

BEGIN
    if ((NR_SEQ_ORIGEM_P IS NOT NULL AND NR_SEQ_ORIGEM_P::text <> '') and NR_SEQ_ORIGEM_P <> -1) THEN
        if (UPPER(IE_DELETAR_APAP_W) = 'S' ) THEN

            DELETE FROM W_APAP_PAC_REGISTRO
            WHERE
                NR_SEQUENCIA IN (
                    SELECT
                        a.NR_SEQUENCIA
                    FROM W_APAP_PAC_REGISTRO a
                    INNER JOIN W_APAP_PAC_INFORMACAO b ON
                        a.NR_SEQ_APAP_INF = b.NR_SEQUENCIA
                    WHERE
                        a.NR_SEQ_ORIGEM  = NR_SEQ_ORIGEM_P AND
                        b.NM_TABELA = NM_TABELA_P
                );
        END IF;
		
		CALL inativar_informacao(UPPER(NM_TABELA_P),'NR_SEQUENCIA',NR_SEQ_ORIGEM_P,null,wheb_usuario_pck.get_nm_usuario);

        
    END IF;
commit;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inactivate_register_houdini ( NM_TABELA_P text, NR_SEQ_ORIGEM_P bigint, IE_DELETAR_APAP_W text DEFAULT 'N') FROM PUBLIC;

