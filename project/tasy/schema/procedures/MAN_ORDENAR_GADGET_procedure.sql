-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE man_ordenar_gadget ( nr_gadget_p bigint, nr_gadget_original_p bigint, nr_dashboard_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_ordenacao_original_w		bigint;
nr_ordenacao_w			bigint;


BEGIN

select	coalesce(nr_ordenacao,0)
into STRICT	nr_ordenacao_original_w
from	desenv_dashboard_gadget
where	nr_sequencia = nr_gadget_original_p;

select	coalesce(nr_ordenacao,0)
into STRICT	nr_ordenacao_w
from	desenv_dashboard_gadget
where	nr_sequencia = nr_gadget_p;

if (nr_ordenacao_original_w > nr_ordenacao_w) then
	nr_ordenacao_w := nr_ordenacao_original_w + 1;
else
	nr_ordenacao_w := nr_ordenacao_original_w;
end if;

update	desenv_dashboard_gadget
set	nr_ordenacao = coalesce(nr_ordenacao,0) + 1
where	coalesce(nr_ordenacao,0) >= nr_ordenacao_w
and	nr_dashboard = nr_dashboard_p;

update	desenv_dashboard_gadget
set	nr_ordenacao = nr_ordenacao_w
where	nr_sequencia = nr_gadget_p;

update	desenv_dashboard_gadget
set	nr_ordenacao = row_number() OVER () AS where	nr_dashboard = nr_dashboard_p;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE man_ordenar_gadget ( nr_gadget_p bigint, nr_gadget_original_p bigint, nr_dashboard_p bigint, nm_usuario_p text) FROM PUBLIC;

