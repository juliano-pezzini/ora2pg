-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gravar_log_tasy ( cd_log_p bigint, ds_log_p text, nm_usuario_p text) AS $body$
DECLARE

dt_fim_geracao_w	timestamp;


BEGIN
begin
	select	coalesce(DT_FIM_GERACAO, clock_timestamp())
	into STRICT	dt_fim_geracao_w
	from	tipo_log_tasy
	where	cd_log = cd_log_p;
exception
	When no_data_found then
		dt_fim_geracao_w := clock_timestamp();
end;

if	pkg_date_utils.start_of(dt_fim_geracao_w,'DD',0) >= pkg_date_utils.start_of(clock_timestamp(),'DD',0) then
	insert into log_tasy(  dt_atualizacao,
				nm_usuario,
				cd_log,
				ds_log)
		values ( 	clock_timestamp(),
				nm_usuario_p,
				cd_log_p,
				substr(ds_log_p,1,2000));
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gravar_log_tasy ( cd_log_p bigint, ds_log_p text, nm_usuario_p text) FROM PUBLIC;

