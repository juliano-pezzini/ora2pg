-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copiar_sinais_vitais ( nr_sequencia_p bigint, nr_atendimento_p text, nm_usuario_p text) AS $body$
DECLARE


/* med_consulta */

nr_seq_sinal_w		bigint;
qt_pa_diastolica_w	smallint;
qt_pa_sistolica_w	smallint;
ie_pressao_w		varchar(1);
qt_freq_resp_w		smallint;
qt_freq_cardiaca_w	smallint;
qt_temp_w		real;
qt_peso_w		double precision;
qt_superf_corporia_w	double precision;
qt_imc_w		real;
qt_altura_cm_w		real;
cd_pessoa_fisica_w	varchar(10);


c01 CURSOR FOR
	SELECT	max(coalesce(nr_sequencia,0)),
			qt_pa_diastolica,
			qt_pa_sistolica,
			ie_pressao,
			qt_freq_cardiaca,
			qt_freq_resp,
			qt_temp,
			qt_peso,
			qt_superf_corporia,
			qt_imc
	from		atendimento_sinal_vital
	where		nr_atendimento		= nr_atendimento_p
	group by	qt_pa_diastolica,
			qt_pa_sistolica,
			ie_pressao,
			qt_freq_cardiaca,
			qt_freq_resp,
			qt_temp,
			qt_peso,
			qt_superf_corporia,
			qt_imc
	order by	1;


BEGIN

open c01;
loop
	fetch c01 into
		nr_seq_sinal_w,
		qt_pa_diastolica_w,
		qt_pa_sistolica_w,
		ie_pressao_w,
		qt_freq_cardiaca_w,
		qt_freq_resp_w,
		qt_temp_w,
		qt_peso_w,
		qt_superf_corporia_w,
		qt_imc_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
END LOOP;
CLOSE C01;

Select	cd_pessoa_fisica
into STRICT	cd_pessoa_fisica_w
from	atendimento_paciente
where	nr_atendimento = nr_atendimento_p;

Select	coalesce(qt_altura_cm,0)
into STRICT	qt_altura_cm_w
from	pessoa_fisica
where	cd_pessoa_fisica = cd_pessoa_fisica_w;


if (nr_seq_sinal_w  <> 0) then
	begin
	update 	med_consulta
	set		qt_pa_diastolica	= qt_pa_diastolica_w,
			qt_pa_sistolica		= qt_pa_sistolica_w,
			ie_pressao		= ie_pressao_w,
			qt_freq_resp		= qt_freq_resp_w,
			qt_freq_cardiaca	= qt_freq_cardiaca_w,
			qt_temp			= qt_temp_w,
			qt_peso			= qt_peso_w,
			qt_superf_corporia	= qt_superf_corporia_w,
			qt_imc			= qt_imc_w,
			qt_altura_cm		= qt_altura_cm_w,
			dt_atualizacao		= clock_timestamp()
	where		nr_sequencia		= nr_sequencia_p;
	end;
end if;

commit;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copiar_sinais_vitais ( nr_sequencia_p bigint, nr_atendimento_p text, nm_usuario_p text) FROM PUBLIC;

