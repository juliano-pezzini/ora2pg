-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_copiar_hist_benef_depend ( nr_seq_historico_p pls_segurado_historico.nr_sequencia%type, nr_seq_titular_p pls_segurado.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
Copiar o histórico do titular para os dependentes
-------------------------------------------------------------------------------------------------------------------

Locais de chamada direta: 
[  ]  Objetos do dicionário [ x] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------

Pontos de atenção:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
 

C01 CURSOR FOR
	SELECT	nr_sequencia nr_seq_segurado
	from	pls_segurado
	where	nr_seq_titular	= nr_seq_titular_p;

BEGIN

for C01_w in C01 loop
	begin
	insert into pls_segurado_historico( 	nr_sequencia, dt_atualizacao, nm_usuario,
						dt_atualizacao_nrec, nm_usuario_nrec, nr_seq_segurado,
						dt_historico, ds_historico, ds_observacao, 
						ie_tipo_historico, ie_historico_situacao, nm_usuario_historico, 
						nr_seq_tipo_historico, ds_titulo, dt_liberacao_hist, 
						nm_usuario_liberacao, ie_envio_sib, ie_tipo_segurado, 
						ie_tipo_segurado_ant, ie_situacao_compartilhamento)
					SELECT	nextval('pls_segurado_historico_seq'), clock_timestamp(), nm_usuario_p,
						clock_timestamp(), nm_usuario_p, C01_w.nr_seq_segurado, 
						dt_historico, ds_historico, ds_observacao, 
						ie_tipo_historico, ie_historico_situacao, nm_usuario_historico, 
						nr_seq_tipo_historico, ds_titulo, clock_timestamp(), 
						nm_usuario_liberacao, ie_envio_sib, ie_tipo_segurado, 
						ie_tipo_segurado_ant, ie_situacao_compartilhamento
					from	pls_segurado_historico
					where	nr_sequencia	= nr_seq_historico_p;		
	end;
end loop;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_copiar_hist_benef_depend ( nr_seq_historico_p pls_segurado_historico.nr_sequencia%type, nr_seq_titular_p pls_segurado.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;

