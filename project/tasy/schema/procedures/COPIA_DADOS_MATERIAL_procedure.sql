-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copia_dados_material ( cd_material_origem_p bigint, cd_material_destino_p bigint, ie_int_medic_p text, nm_usuario_p text) AS $body$
DECLARE


cd_grupo_material_w			smallint;
cd_subgrupo_material_w		smallint;
cd_estabelecimento_w		smallint;
cd_classe_material_w		integer;
nr_seq_int_medic_w			bigint;
nr_seq_ficha_w				bigint;
nr_seq_ficha_interacao_w	bigint;
cd_material_interacao_w		bigint;
ie_possui_int_medic_w		varchar(1);
ie_exibir_gravidade_w		varchar(1);
ie_consistir_w				varchar(1);
ie_mensagem_cadastrada_w	varchar(1);
ie_gravar_w					varchar(1);
ie_severidade_w				varchar(3);
ie_classificacao_w			varchar(15);
ds_tipo_w					varchar(255);
ds_orientacao_w				varchar(2000);
ds_ref_bibliografica_w		varchar(4000);

C01 CURSOR FOR /* Interação medicamentosa */
SELECT	cd_material_interacao,
		ds_tipo,
		ds_orientacao,
		ie_classificacao,
		ie_severidade,
		ie_exibir_gravidade,
		ie_consistir,
		ie_mensagem_cadastrada,
		ie_gravar,
		ds_ref_bibliografica,
		nr_seq_ficha,
		nr_seq_ficha_interacao,
		cd_grupo_material,
		cd_subgrupo_material,
		cd_classe_material,
		cd_estabelecimento
from	material_interacao_medic
where	cd_material = cd_material_origem_p;


BEGIN

if (coalesce(ie_int_medic_p,'N') = 'S') then
	select	coalesce(max('S'),'N')
	into STRICT	ie_possui_int_medic_w
	from	material_interacao_medic
	where	cd_material = cd_material_origem_p;

	if (ie_possui_int_medic_w <> 'S') then
		CALL wheb_mensagem_pck.Exibir_mensagem_abort(236465);
	end if;

	delete
	from	material_interacao_medic
	where	cd_material = cd_material_destino_p;

	open C01;
	loop
	fetch C01 into
		cd_material_interacao_w,
		ds_tipo_w,
		ds_orientacao_w,
		ie_classificacao_w,
		ie_severidade_w,
		ie_exibir_gravidade_w,
		ie_consistir_w,
		ie_mensagem_cadastrada_w,
		ie_gravar_w,
		ds_ref_bibliografica_w,
		nr_seq_ficha_w,
		nr_seq_ficha_interacao_w,
		cd_grupo_material_w,
		cd_subgrupo_material_w,
		cd_classe_material_w,
		cd_estabelecimento_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */

		select	nextval('material_interacao_medic_seq')
		into STRICT	nr_seq_int_medic_w
		;

		insert into material_interacao_medic(	nr_sequencia,
												cd_material,
												dt_atualizacao,
												nm_usuario,
												dt_atualizacao_nrec,
												nm_usuario_nrec,
												cd_material_interacao,
												ie_severidade,
												ds_tipo,
												nr_seq_ficha,
												nr_seq_ficha_interacao,
												ds_orientacao,
												cd_grupo_material,
												cd_subgrupo_material,
												cd_classe_material,
												ie_exibir_gravidade,
												ie_mensagem_cadastrada,
												ds_ref_bibliografica,
												ie_consistir,
												ie_gravar,
												ie_classificacao,
												cd_estabelecimento)
									  values (	nr_seq_int_medic_w,
									  			cd_material_destino_p,
												clock_timestamp(),
												nm_usuario_p,
												clock_timestamp(),
												nm_usuario_p,
												cd_material_interacao_w,
												ie_severidade_w,
												ds_tipo_w,
												nr_seq_ficha_w,
												nr_seq_ficha_interacao_w,
												ds_orientacao_w,
												cd_grupo_material_w,
												cd_subgrupo_material_w,
												cd_classe_material_w,
												ie_exibir_gravidade_w,
												ie_mensagem_cadastrada_w,
												ds_ref_bibliografica_w,
												ie_consistir_w,
												ie_gravar_w,
												ie_classificacao_w,
												cd_estabelecimento_w);

	end loop;
	close C01;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copia_dados_material ( cd_material_origem_p bigint, cd_material_destino_p bigint, ie_int_medic_p text, nm_usuario_p text) FROM PUBLIC;

