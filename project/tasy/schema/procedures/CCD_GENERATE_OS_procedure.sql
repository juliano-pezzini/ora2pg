-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ccd_generate_os ( cd_request_user_p text, nm_request_user_p text, ds_dano_breve_p text, ds_dano_p text, nr_seq_gerencia_p bigint, nr_seq_grupo_desenv_p bigint, ie_classification_p text, nm_exec_user_p text, nr_seq_order_p INOUT bigint) AS $body$
DECLARE


nr_seq_ordem_w			man_ordem_servico.nr_sequencia%type;
nr_seq_estagio_w		man_ordem_servico.nr_seq_estagio%type;

BEGIN

nr_seq_estagio_w	:= 1051; --Desenv aguardando triagem
if (nr_seq_gerencia_p = 2) then
	nr_seq_estagio_w	:= 1731; -- Tec aguardando triagem
end if;

select	nextval('man_ordem_servico_seq')
into STRICT	nr_seq_ordem_w
;

insert into man_ordem_servico(
	nr_sequencia,
	dt_ordem_servico,
	cd_pessoa_solicitante,
	nr_seq_localizacao,
	nr_seq_equipamento,
	ds_dano_breve,
	ie_prioridade,
	ds_dano,
	nr_seq_grupo_des,
	ie_classificacao,
	ie_tipo_ordem,
	ie_status_ordem,
	dt_inicio_previsto,
	dt_fim_previsto,
	dt_inicio_desejado,
	dt_conclusao_desejada,
	nr_seq_estagio,
	nr_grupo_trabalho,
	nr_grupo_planej,
	nm_usuario,
	dt_atualizacao,
	nm_usuario_nrec,
	dt_atualizacao_nrec,
	ie_parado,
	ie_obriga_news,
	ie_exclusiva,
	ie_atualizacao_migracao,
	ie_resp_teste,
	ie_plataforma,
	nr_seq_complex,
	ie_origem_os,
	ie_os_relatorio,
	ie_obrigar_avaliacao,
	ie_gerado_projeto)
values (
	nr_seq_ordem_w,
	clock_timestamp(),
	cd_request_user_p,
	41,
	41,
	ds_dano_breve_p,
	'M',
	ds_dano_p,
	nr_seq_grupo_desenv_p,
	ie_classification_p,
	1,
	'1',
	clock_timestamp(),
	clock_timestamp() + interval '7 days',
	clock_timestamp(),
	clock_timestamp() + interval '7 days',
	nr_seq_estagio_w,
	1,
	1,
	'Tasy',
	clock_timestamp(),
	'Tasy',
	clock_timestamp(),
	'N',
	'N',
	'G',
	'P',
	'A',
	'H',
	2,
	1,
	'N',
	'N',
	'N');

if (nm_request_user_p IS NOT NULL AND nm_request_user_p::text <> '') then
	insert into man_ordem_servico_exec(
			nr_sequencia,
			nr_seq_ordem,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nm_usuario_exec,
			qt_min_prev,
			nr_seq_tipo_exec)
	values (nextval('man_ordem_servico_exec_seq'),
			nr_seq_ordem_w,
			clock_timestamp(),
			'Tasy',
			clock_timestamp(),
			'Tasy',
			nm_request_user_p,
			10,
			5);
end if;

insert into man_ordem_servico_exec(
	nr_sequencia,
	nr_seq_ordem,
	dt_atualizacao,
	nm_usuario,
	dt_atualizacao_nrec,
	nm_usuario_nrec,
	nm_usuario_exec,
	qt_min_prev,
	nr_seq_tipo_exec)
values (nextval('man_ordem_servico_exec_seq'),
	nr_seq_ordem_w,
	clock_timestamp(),
	'Tasy',
	clock_timestamp(),
	'Tasy',
	nm_exec_user_p,
	30,
	2);

nr_seq_order_p	:= nr_seq_ordem_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ccd_generate_os ( cd_request_user_p text, nm_request_user_p text, ds_dano_breve_p text, ds_dano_p text, nr_seq_gerencia_p bigint, nr_seq_grupo_desenv_p bigint, ie_classification_p text, nm_exec_user_p text, nr_seq_order_p INOUT bigint) FROM PUBLIC;

