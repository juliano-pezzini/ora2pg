-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_material_barras_conta (nr_atendimento_p bigint, nr_seq_atepacu_p bigint, nr_interno_conta_p bigint, cd_material_p bigint, qt_material_p bigint, dt_atendimento_p timestamp, cd_unidade_medida_p text, nr_prescricao_p bigint, nr_seq_prescr_p bigint, cd_cgc_fornec_p text, cd_local_estoque_p bigint, nr_seq_lote_fornec_p text, ie_auditoria_p text, nr_serie_p text, nm_usuario_p text, ds_observacao_p text, nr_sequencia_p INOUT bigint) AS $body$
DECLARE

 
dt_entrada_unidade_w		timestamp;
cd_setor_atendimento_w		bigint;
nr_sequencia_w			bigint;
cd_convenio_w			bigint;
cd_categoria_w			varchar(20);
nr_doc_convenio_w		varchar(20);
ie_tipo_guia_w			varchar(20);
cd_senha_w			varchar(20);


BEGIN 
 
select	max(dt_entrada_unidade), 
	max(cd_setor_atendimento) 
into STRICT	dt_entrada_unidade_w, 
	cd_setor_atendimento_w 
from	atend_paciente_unidade 
where	nr_seq_interno		= nr_seq_atepacu_p;
 
if (dt_entrada_unidade_w IS NOT NULL AND dt_entrada_unidade_w::text <> '') then 
	begin 
 
	SELECT * FROM Obter_Convenio_Execucao(nr_atendimento_p, dt_atendimento_p, cd_convenio_w, cd_categoria_w, nr_doc_convenio_w, ie_tipo_guia_w, cd_senha_w) INTO STRICT cd_convenio_w, cd_categoria_w, nr_doc_convenio_w, ie_tipo_guia_w, cd_senha_w;
 
 
	select	nextval('material_atend_paciente_seq') 
	into STRICT	nr_sequencia_w 
	;
 
 
	insert	into material_atend_paciente(NR_SEQUENCIA, 
		NR_ATENDIMENTO, 
		DT_ENTRADA_UNIDADE, 
		CD_MATERIAL, 
		DT_ATENDIMENTO, 
		CD_UNIDADE_MEDIDA, 
		QT_MATERIAL, 
		DT_ATUALIZACAO, 
		NM_USUARIO, 
		CD_CONVENIO, 
		CD_CATEGORIA, 
		DT_PRESCRICAO, 
		CD_MATERIAL_PRESCRICAO, 
		IE_VIA_APLICACAO, 
		DS_OBSERVACAO, 
		VL_MATERIAL, 
		CD_TAB_PRECO_MATERIAL, 
		DT_VIGENCIA_TABELA, 
		DT_ACERTO_CONTA, 
		DT_ACERTO_CONVENIO, 
		NR_PRESCRICAO, 
		NR_SEQUENCIA_PRESCRICAO, 
		CD_MOTIVO_EXC_CONTA, 
		DS_COMPL_MOTIVO_EXCON, 
		CD_LOCAL_ESTOQUE, 
		DT_ATUALIZACAO_ESTOQUE, 
		CD_ACAO, 
		CD_SETOR_ATENDIMENTO, 
		QT_DEVOLVIDA, 
		CD_MOTIVO_DEVOLUCAO, 
		NR_CIRURGIA, 
		NR_DOC_CONVENIO, 
		QT_EXECUTADA, 
		DT_CONTA, 
		VL_UNITARIO, 
		CD_PROCED_REFERENCIA, 
		CD_CONTA_CONTABIL, 
		QT_AJUSTE_CONTA, 
		NR_AIH, 
		IE_VALOR_INFORMADO, 
		CD_ESTABELECIMENTO_CUSTO, 
		CD_TABELA_CUSTO, 
		CD_SITUACAO_GLOSA, 
		NR_LOTE_CONTABIL, 
		CD_MATERIAL_CONVENIO, 
		NR_SEQ_AUTORIZACAO, 
		NR_INTERNO_CONTA, 
		NR_SEQ_PROC_PRINC, 
		IE_GUIA_INFORMADA, 
		CD_ESPECIALIDADE, 
		NM_USUARIO_ORIGINAL, 
		NR_SEQ_PROC_PACOTE, 
		VL_TABELA_ORIGINAL, 
		IE_EMITE_CONTA, 
		CD_SETOR_RECEITA, 
		CD_CGC_FORNECEDOR, 
		NR_SEQ_LOTE_FORNEC, 
		CD_MATERIAL_EXEC, 
		NR_SEQ_ATEPACU, 
		IE_TIPO_GUIA, 
		NR_DOC_INTERNO, 
		IE_AUDITORIA, 
		NR_SEQ_GRUPO_REC, 
		CD_MOTIVO_AJUSTE, 
		NR_SEQ_TIPO_BAIXA, 
		NR_SEQ_COR_EXEC, 
		NR_SEQ_ORIGEM, 
		IE_DISPERSAO, 
		NR_SEQ_CONTA_ORIGEM, 
		CD_SETOR_PACIENTE, 
		NR_SEQ_PARCIAL, 
		CD_CGC_PRESTADOR, 
		NR_SEQ_AIH, 
		DT_CONFERENCIA, 
		NR_SERIE_MATERIAL, 
		NR_SEQ_REGRA_LANC, 
		NR_SEQ_ORDEM_PROD, 
		NR_RECEITA, 
		DT_ATUALIZACAO_NREC, 
		NM_USUARIO_NREC, 
		IE_ORIGEM_PRECO, 
		QT_ESTOQUE, 
		NR_SEQ_TISS_TABELA, 
		IE_RESPONSAVEL_CREDITO, 
		IE_TISS_TIPO_GUIA_DESP, 
		IE_TISS_TIPO_DESPESA, 
		CD_CGC_PRESTADOR_TISS, 
		CD_SENHA, 
		IE_ESTORNO_CONTA, 
		CD_MATERIAL_TISS, 
		DS_MATERIAL_TISS, 
		NR_SEQ_MAT_AUTOR, 
		CD_KIT_MATERIAL, 
		CD_TAB_CUSTO_PRECO) 
	values (NR_SEQUENCIA_w, 
		NR_ATENDIMENTO_p, 
		DT_ENTRADA_UNIDADE_w, 
		CD_MATERIAL_p, 
		DT_ATENDIMENTO_p, 
		CD_UNIDADE_MEDIDA_p, 
		QT_MATERIAL_p, 
		clock_timestamp(), 
		nm_usuario_p, 
		CD_CONVENIO_w, 
		CD_CATEGORIA_w, 
		null, 
		null, 
		null, 
		DS_OBSERVACAO_p, 
		null, 
		null, 
		null, 
		null, 
		null, 
		CASE WHEN NR_PRESCRICAO_p=0 THEN  null  ELSE nr_prescricao_p END , 
		CASE WHEN nr_seq_prescr_p=0 THEN  null  ELSE nr_seq_prescr_p END , 
		null, 
		null, 
		CD_LOCAL_ESTOQUE_p, 
		clock_timestamp(), 
		1, 
		CD_SETOR_ATENDIMENTO_w, 
		null, 
		null, 
		null, 
		NR_DOC_CONVENIO_w, 
		qt_material_p, 
		dt_atendimento_p, 
		0, 
		null, 
		null, 
		0, 
		null, 
		'N', 
		null, 
		null, 
		0, 
		null, 
		null, 
		null, 
		CASE WHEN NR_INTERNO_CONTA_p=0 THEN  null  ELSE nr_interno_conta_p END , 
		null, 
		'N', 
		null, 
		nm_usuario_p, 
		null, 
		null, 
		null, 
		null, 
		cd_cgc_fornec_p, 
		NR_SEQ_LOTE_FORNEC_p, 
		null, 
		NR_SEQ_ATEPACU_P, 
		IE_TIPO_GUIA_w, 
		null, 
		IE_AUDITORIA_p, 
		null, 
		null, 
		null, 
		96, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		clock_timestamp(), 
		nm_usuario_p, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		CD_SENHA_w, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null);
 
	CALL atualiza_preco_material(nr_sequencia_w, nm_usuario_p);
 
	end;
end if;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_material_barras_conta (nr_atendimento_p bigint, nr_seq_atepacu_p bigint, nr_interno_conta_p bigint, cd_material_p bigint, qt_material_p bigint, dt_atendimento_p timestamp, cd_unidade_medida_p text, nr_prescricao_p bigint, nr_seq_prescr_p bigint, cd_cgc_fornec_p text, cd_local_estoque_p bigint, nr_seq_lote_fornec_p text, ie_auditoria_p text, nr_serie_p text, nm_usuario_p text, ds_observacao_p text, nr_sequencia_p INOUT bigint) FROM PUBLIC;

