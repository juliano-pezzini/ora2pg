-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copiar_conta_contabil_empresa (cd_empresa_origem_p bigint, cd_empresa_destino_p bigint, nm_usuario_p text) AS $body$
BEGIN

insert into conta_contabil(
	cd_conta_contabil,
	ds_conta_contabil,
	ie_situacao,
	dt_atualizacao,
	nm_usuario,
	ie_centro_custo,
	ie_tipo,
	cd_classificacao,
	cd_grupo,
	cd_empresa,
	cd_centro_custo,
	cd_sistema_contabil,
	nr_seq_crit_rateio,
	cd_plano_ans,
	ds_orientacao,
	ie_compensacao,
	dt_inicio_vigencia,
	dt_fim_vigencia,
	dt_atualizacao_nrec,
	nm_usuario_nrec,
	ie_diops,
	ie_natureza_sped,
	ie_deducao_acomp_orc
	)
(SELECT substr(cd_empresa_destino_p || '.' || cd_conta_contabil,1,20),
    ds_conta_contabil,
    ie_situacao,
    clock_timestamp(),
    nm_usuario_p,
    ie_centro_custo,
    ie_tipo,
    cd_classificacao,
    cd_grupo,
    cd_empresa_destino_p,
    cd_centro_custo,	
    cd_sistema_contabil,
    nr_seq_crit_rateio,
    cd_plano_ans,
    ds_orientacao,
    ie_compensacao,
    dt_inicio_vigencia,
    dt_fim_vigencia,
    clock_timestamp(),
    nm_usuario_p,
    ie_diops,
    ie_natureza_sped,
    ie_deducao_acomp_orc
from	conta_contabil
where	cd_empresa = cd_empresa_origem_p
and	    cd_empresa_destino_p || '.' || cd_conta_contabil not in (select	cd_conta_contabil
	   	   		   			                                    from  	conta_contabil));

insert into conta_contabil_classif_ecd(
            cd_conta_contabil,
            dt_atualizacao,
            nm_usuario,
            ie_situacao,
            nr_sequencia,
            cd_centro_custo,
            dt_atualizacao_nrec,
            nm_usuario_nrec,
            cd_classif_ecd,	
            dt_inicio_vigencia,				
            dt_fim_vigencia,
            cd_versao)
(SELECT  substr(cd_empresa_destino_p || '.' || e.cd_conta_contabil,1,20) cd_conta_contabil,
		 clock_timestamp(),
		 nm_usuario_p,
		 e.ie_situacao,
		 nextval('conta_contabil_classif_ecd_seq'),
		 e.cd_centro_custo,
		 clock_timestamp(),
		 nm_usuario_p,
		 e.cd_classif_ecd,
		 e.dt_inicio_vigencia,	
		 e.dt_fim_vigencia,
		 e.cd_versao
from 	conta_contabil_classif_ecd e,
		conta_contabil c
where	e.cd_conta_contabil = c.cd_conta_contabil
and     c.cd_empresa = cd_empresa_origem_p
and     not exists (select  1
                    from    conta_contabil_classif_ecd a
                    where   a.cd_conta_contabil = substr(cd_empresa_destino_p || '.' || e.cd_conta_contabil,1,20)));

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copiar_conta_contabil_empresa (cd_empresa_origem_p bigint, cd_empresa_destino_p bigint, nm_usuario_p text) FROM PUBLIC;

