-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pepo_registrar_impressao_rel (nr_cirurgia_p cirurgia.nr_cirurgia%type, nm_usuario_p cirurgia.nm_usuario_imp_pepo%type, nr_seq_pepo_p cirurgia.nr_seq_pepo%type) AS $body$
BEGIN
    if (nr_cirurgia_p IS NOT NULL AND nr_cirurgia_p::text <> '' AND nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') then

        update  cirurgia
        set     nm_usuario_imp_pepo = nm_usuario_p,
                dt_impressao_pepo = clock_timestamp()
        where   nr_cirurgia = nr_cirurgia_p;
        commit;

	if  (coalesce((pkg_i18n.get_user_locale()), 'pt_BR') = 'de_AT')  then
            CALL pepo_atualizar_status_doc(nr_cirurgia_p,4,'C', nm_usuario_p, nr_seq_pepo_p);
        end if;
    end if;

    if ((nr_seq_pepo_p IS NOT NULL AND nr_seq_pepo_p::text <> '') and coalesce(nr_cirurgia_p::text, '') = ''  and (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') ) then

			update  cirurgia
			set     nm_usuario_imp_pepo = nm_usuario_p,
					dt_impressao_pepo = clock_timestamp()
			where   nr_seq_pepo = nr_seq_pepo_p;
			commit;	
			if  (coalesce((pkg_i18n.get_user_locale()), 'pt_BR') = 'de_AT')  then
					CALL pepo_atualizar_status_doc(nr_cirurgia_p,4,'C', nm_usuario_p, nr_seq_pepo_p);
			end if;			
    end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pepo_registrar_impressao_rel (nr_cirurgia_p cirurgia.nr_cirurgia%type, nm_usuario_p cirurgia.nm_usuario_imp_pepo%type, nr_seq_pepo_p cirurgia.nr_seq_pepo%type) FROM PUBLIC;

