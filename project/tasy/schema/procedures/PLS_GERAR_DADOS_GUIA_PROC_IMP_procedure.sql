-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gerar_dados_guia_proc_imp ( cd_procedimento_imp_p pls_guia_plano_proc_imp.cd_procedimento%type, cd_tabela_imp_p pls_guia_plano_proc_imp.cd_tabela%Type, nr_seq_prestador_imp_p pls_prestador.nr_sequencia%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, cd_procedimento_p INOUT procedimento.cd_procedimento%type, ie_origem_proced_p INOUT procedimento.ie_origem_proced%type) AS $body$
DECLARE



/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: Realizar as conversões nos procedimentos, para retornar o código e a origem
correta dos mesmos
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ x] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
dados_tipo_conv_tiss_w		pls_cta_valorizacao_pck.dados_tipo_conv_tiss;
ie_origem_proced_w		procedimento.ie_origem_proced%type;
cd_procedimento_w		procedimento.cd_procedimento%type;


BEGIN

if (cd_procedimento_imp_p IS NOT NULL AND cd_procedimento_imp_p::text <> '' AND cd_tabela_imp_p IS NOT NULL AND cd_tabela_imp_p::text <> '') then

	dados_tipo_conv_tiss_w	:= pls_obter_conversao_tab_tiss(cd_tabela_imp_p, cd_estabelecimento_p, cd_procedimento_imp_p, '', 'A', nr_seq_prestador_imp_p, null);

	if ( dados_tipo_conv_tiss_w.ie_tipo_tabela in ('06')) then
		ie_origem_proced_w	:= 5; --CBHPM
	elsif ( dados_tipo_conv_tiss_w.ie_tipo_tabela in ('18','22')) then
		ie_origem_proced_w	:= 8; --TUSS
	elsif (dados_tipo_conv_tiss_w.ie_tipo_tabela in ('90','98','00')) then
		ie_origem_proced_w	:= 4; --PROPRIO
	end if;
	cd_procedimento_w :=  cd_procedimento_imp_p;


	/* Tratar a conversão de procedimentos TUSS - OPS - Cadastro de Regras / Procedimentos TUSS */

	if ( ie_origem_proced_w	= 8) then
		SELECT * FROM pls_converte_codigo_tuss( cd_procedimento_w, ie_origem_proced_w, cd_procedimento_w, ie_origem_proced_w) INTO STRICT cd_procedimento_w, ie_origem_proced_w;
	end if;
end if;

cd_procedimento_p	:= cd_procedimento_w;
ie_origem_proced_p	:= ie_origem_proced_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_dados_guia_proc_imp ( cd_procedimento_imp_p pls_guia_plano_proc_imp.cd_procedimento%type, cd_tabela_imp_p pls_guia_plano_proc_imp.cd_tabela%Type, nr_seq_prestador_imp_p pls_prestador.nr_sequencia%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, cd_procedimento_p INOUT procedimento.cd_procedimento%type, ie_origem_proced_p INOUT procedimento.ie_origem_proced%type) FROM PUBLIC;

