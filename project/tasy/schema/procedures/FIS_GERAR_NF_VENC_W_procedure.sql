-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE fis_gerar_nf_venc_w (nr_seq_transmissao_p bigint, nm_usuario_p text) AS $body$
DECLARE


				
nr_seq_nota_w			nota_fiscal.nr_sequencia%type;


c_nota_fiscal_venc CURSOR FOR
	SELECT	a.nr_sequencia,
		a.nr_sequencia_nf,
		a.vl_vencimento,
		a.dt_vencimento,
		a.nr_titulo_pagar,
		a.nr_titulo_vinc,
		a.ds_observacao,
		a.vl_base_venc,
		a.vl_desconto
	from  	nota_fiscal_venc a
	where 	nr_sequencia = nr_seq_nota_w;

				
BEGIN

select	a.nr_sequencia
into STRICT 	nr_seq_nota_w
from 	nota_fiscal a,
	    nfe_transmissao_nf b
where	b.nr_seq_nota_fiscal	= a.nr_sequencia
and	    b.nr_seq_transmissao	= nr_seq_transmissao_p;


for fis_nota_fiscal_venc in c_nota_fiscal_venc loop
	begin
	 nr_seq_nota_w:= fis_nota_fiscal_venc.nr_sequencia;
	 insert into fis_nf_venc_w(	nr_sequencia,
					nr_seq_nota,
					nr_sequencia_nf,
					dt_vencimento,
					vl_vencimento,
					nr_titulo_pagar,
					nr_titulo_vinc,
					ds_observacao,
					vl_base_venc,
					vl_desconto,
					dt_atualizacao,
					nm_usuario,
					nr_seq_transmissao)
				values (nextval('fis_nf_venc_w_seq'),
					nr_seq_nota_w,
					fis_nota_fiscal_venc.nr_sequencia_nf,
					fis_nota_fiscal_venc.dt_vencimento,
					fis_nota_fiscal_venc.vl_vencimento,
					fis_nota_fiscal_venc.nr_titulo_pagar,
					fis_nota_fiscal_venc.nr_titulo_vinc,
					fis_nota_fiscal_venc.ds_observacao,
					fis_nota_fiscal_venc.vl_base_venc,
					fis_nota_fiscal_venc.vl_desconto,
					clock_timestamp(),
					nm_usuario_p,
					nr_seq_transmissao_p
					);
	end;
end loop;
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE fis_gerar_nf_venc_w (nr_seq_transmissao_p bigint, nm_usuario_p text) FROM PUBLIC;

