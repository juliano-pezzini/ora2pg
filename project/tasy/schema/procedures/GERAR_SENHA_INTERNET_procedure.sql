-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_senha_internet ( nr_atendimento_p bigint, dt_alta_p timestamp, dt_cancelamento_p timestamp, dt_exclusao_p timestamp, ds_senha_p text, ie_acao_p text) AS $body$
DECLARE


ds_senha_w		varchar(20);
nm_usuario_w		varchar(15);

dt_exclusao_w		timestamp;
dt_alta_w               timestamp;
dt_cancelamento_w	timestamp;
nr_atendimento_w	bigint;


/*
ie_acao_p

GA - Gerar alta

CA - Cancelar atendimento

EA - Excluir atendimento
*/
BEGIN
nm_usuario_w		:= coalesce(wheb_usuario_pck.get_nm_usuario, 'Tasy_integracao');
nr_atendimento_w	:= nr_atendimento_p;
dt_alta_w		:= null;
dt_cancelamento_w	:= null;
dt_exclusao_w		:= null;


if (ie_acao_p =  'GA') then
	dt_alta_w	:= dt_alta_p;
elsif (ie_acao_p =  'CA') then
	dt_cancelamento_w	:= dt_cancelamento_p;
elsif (ie_acao_p =  'EA') then
	dt_exclusao_w := 	dt_exclusao_p;
end if;

insert into  atend_senha_internet(	nr_sequencia,
					dt_atualizacao,
					nm_usuario,
					dt_atualizacao_nrec,
					nm_usuario_nrec,
					ds_senha,
					dt_leitura,
					dt_alta,
					dt_cancelamento,
					dt_exclusao,
					nr_atendimento )
			values (		nextval('atend_senha_internet_seq'),
					clock_timestamp(),
					nm_usuario_w,
					clock_timestamp(),
					nm_usuario_w,
					ds_senha_p,
					null,
					dt_alta_w,
					dt_cancelamento_w,
					dt_exclusao_w,
					nr_atendimento_w );

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_senha_internet ( nr_atendimento_p bigint, dt_alta_p timestamp, dt_cancelamento_p timestamp, dt_exclusao_p timestamp, ds_senha_p text, ie_acao_p text) FROM PUBLIC;

