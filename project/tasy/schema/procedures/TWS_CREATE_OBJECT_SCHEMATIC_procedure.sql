-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE tws_create_object_schematic ( cd_funcao_p funcao.cd_funcao%type, nr_seq_funcao_schematic_p funcao_schematic.nr_sequencia%type, nr_seq_tipo_schematic_p tipo_schematic.nr_sequencia%type, nr_seq_superior_p objeto_schematic.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type, nr_seq_obj_schematic_p INOUT objeto_schematic.nr_seq_obj_sup%type) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: Adicionar objetos na função do schematic Gerenciador do Schematic
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
Tasy HTML5
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
nr_seq_apres_w			objeto_schematic.nr_seq_apres%type;
cd_exp_desc_obj_w		dic_expressao.cd_expressao%type;
ds_exp_desc_obj_w		dic_expressao.ds_expressao_br%type;
ie_tipo_objeto_w		tipo_schematic.ie_tipo_objeto%type;
nr_seq_obj_schematic_w     	objeto_schematic.nr_seq_obj_sup%type;
nr_seq_obj_sch_children_w  	objeto_schematic.nr_seq_obj_sup%type;
ie_tipo_componente_w	   	tipo_schematic.ie_tipo_componente%type;
ie_tipo_obj_navegador_w		tipo_schematic.ie_tipo_obj_navegador%type;




BEGIN

if ( (cd_funcao_p IS NOT NULL AND cd_funcao_p::text <> '') and (nr_seq_funcao_schematic_p IS NOT NULL AND nr_seq_funcao_schematic_p::text <> '') and (nr_seq_tipo_schematic_p IS NOT NULL AND nr_seq_tipo_schematic_p::text <> '') ) then

	select	a.cd_exp_desc_obj,
		obter_desc_expressao(a.cd_exp_desc_obj,null) ds_expressao,
		a.ie_tipo_objeto,
		a.ie_tipo_componente,
		(select	coalesce(max(b.nr_seq_apres),0) + 1
		from	objeto_schematic b
		where	b.nr_seq_funcao_schematic = nr_seq_funcao_schematic_p
		and (coalesce(nr_seq_superior_p::text, '') = '' or b.nr_seq_obj_sup = nr_seq_superior_p )) nr_seq_apres,
		ie_tipo_obj_navegador
	into STRICT	cd_exp_desc_obj_w,
		ds_exp_desc_obj_w,
		ie_tipo_objeto_w,
		ie_tipo_componente_w,
		nr_seq_apres_w,
		ie_tipo_obj_navegador_w
	from	tipo_schematic a
	where	a.nr_sequencia = nr_seq_tipo_schematic_p;

	insert into objeto_schematic(
			nr_sequencia, dt_atualizacao_nrec, nm_usuario_nrec,
			dt_atualizacao, nm_usuario, cd_funcao,
			ds_objeto, ie_tipo_objeto, nr_seq_obj_sup,
			ie_tipo_obj_navegador, nr_seq_funcao_schematic, nr_seq_apres,
			nr_seq_tipo_schematic, cd_exp_desc_obj, ie_tipo_componente )
	  values (	nextval('objeto_schematic_seq'), clock_timestamp(), nm_usuario_p,
			clock_timestamp(), nm_usuario_p, cd_funcao_p,
			ds_exp_desc_obj_w,ie_tipo_objeto_w, nr_seq_superior_p,
			ie_tipo_obj_navegador_w, nr_seq_funcao_schematic_p, nr_seq_apres_w,
			nr_seq_tipo_schematic_p, cd_exp_desc_obj_w, ie_tipo_componente_w ) returning nr_sequencia into nr_seq_obj_schematic_w;

	commit;


	--Adiciona Header e Content se o tipo componente for page
	if (ie_tipo_componente_w = 'PAGE') then
		nr_seq_obj_sch_children_w := tws_create_object_schematic( cd_funcao_p, nr_seq_funcao_schematic_p, 183, nr_seq_obj_schematic_w, nm_usuario_p, nr_seq_obj_sch_children_w);
		nr_seq_obj_sch_children_w := tws_create_object_schematic( cd_funcao_p, nr_seq_funcao_schematic_p, 185, nr_seq_obj_schematic_w, nm_usuario_p, nr_seq_obj_sch_children_w);
	end if;

end if;

nr_seq_obj_schematic_p	:= nr_seq_obj_schematic_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tws_create_object_schematic ( cd_funcao_p funcao.cd_funcao%type, nr_seq_funcao_schematic_p funcao_schematic.nr_sequencia%type, nr_seq_tipo_schematic_p tipo_schematic.nr_sequencia%type, nr_seq_superior_p objeto_schematic.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type, nr_seq_obj_schematic_p INOUT objeto_schematic.nr_seq_obj_sup%type) FROM PUBLIC;

