-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE get_ihc_rem ( nr_sequencia_p bigint, nm_usuario_p text) AS $body$
DECLARE

			
ds_observacao_w		protocolo_convenio.ds_observacao%type;
nr_account_w		ihc_claim.nr_account%type;


BEGIN

select max(nr_account)
into STRICT   nr_account_w
from   ihc_claim
where  nr_sequencia = nr_sequencia_p;

select	substr(max(a.ds_observacao),1,500)
into STRICT	ds_observacao_w
from    protocolo_convenio a,
	conta_paciente b
where	a.nr_seq_protocolo = b.nr_seq_protocolo
and	b.nr_interno_conta = nr_account_w;

	if (ds_observacao_w IS NOT NULL AND ds_observacao_w::text <> '') and (BILLING_I18N_PCK.GET_VALIDATE_ECLIPSE() = 'N') then
	
	     insert into ihc_rem(ds_text,
				 nr_seq_claim,
				 nr_sequencia,
				 nm_usuario,
				 nm_usuario_nrec,
				 dt_atualizacao,
				 dt_atualizacao_nrec)
			values (ds_observacao_w,
				 nr_sequencia_p,
				 nextval('ihc_rem_seq'),
				 nm_usuario_p,
				 nm_usuario_p,
				 clock_timestamp(),
				 clock_timestamp());
				
	end if;
	
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE get_ihc_rem ( nr_sequencia_p bigint, nm_usuario_p text) FROM PUBLIC;

