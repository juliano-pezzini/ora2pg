-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE km_gerar_avaliacao_usuario ( nr_seq_questionario_p km_questionario.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE


/*
	++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	Objective: N/A
	------------------------------------------------------------------------
	Direct call: 
	[   ] Dictionary objects
	[ X ] Tasy (Delphi/Java/HTML5)
	[   ] Portal
	[   ] Reports
	[   ] Others:
	 -----------------------------------------------------------------------
	Attention points: N/A
	------------------------------------------------------------------------
	References:
		Tables: N/A
		Objects: N/A
	------------------------------------------------------------------------
	Called in:
		Java: N/A
		HTML5: N/A
		Object: N/A
	++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
*/
c01 CURSOR FOR
SELECT	*
from	km_questionario_item kqi
where	kqi.nr_seq_questionario = nr_seq_questionario_p
order by kqi.nr_seq_apres;

nr_seq_avaliacao_w	km_avaliacao.nr_sequencia%type;

BEGIN


if (nr_seq_questionario_p IS NOT NULL AND nr_seq_questionario_p::text <> '') then
	begin
	
	select	nextval('km_avaliacao_seq')
	into STRICT	nr_seq_avaliacao_w
	;
	
	insert into km_avaliacao(
		nr_sequencia,
		nr_seq_questionario,
		cd_setor_atendimento,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		ie_situacao)
	values (nr_seq_avaliacao_w,
		nr_seq_questionario_p,
		wheb_usuario_pck.get_cd_setor_atendimento,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		'A');
	
	for reg01 in c01 loop
	begin
		insert into km_avaliacao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_avaliacao,
			nr_seq_item_quest)
		values (nextval('km_avaliacao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_avaliacao_w,
			reg01.nr_sequencia);
	end;
	end loop;
	
	commit;
	end;
end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE km_gerar_avaliacao_usuario ( nr_seq_questionario_p km_questionario.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;

