-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ctb_copiar_regra_distr_saldo ( nr_seq_regra_grupo_distrib_p bigint, cd_empresa_origem_p bigint, cd_estab_origem_p bigint, cd_estab_destino_p bigint, ie_copiar_todos_estab_p text, nm_usuario_p text) AS $body$
DECLARE


c_estabelecimento CURSOR FOR
	SELECT	cd_estabelecimento
	from	estabelecimento
	where	cd_empresa = cd_empresa_origem_p
	and	((cd_estabelecimento = cd_estab_destino_p
	and	ie_copiar_todos_estab_p = 'N')
	or (ie_copiar_todos_estab_p = 'S'
	and	cd_estabelecimento <> cd_estab_origem_p));

vet_estabelecimento c_estabelecimento%rowtype;


BEGIN

open c_estabelecimento;
loop
fetch c_estabelecimento into
	vet_estabelecimento;
EXIT WHEN NOT FOUND; /* apply on c_estabelecimento */
	begin

	insert into ctb_regra_rateio_grupo(	nr_sequencia,
		nm_usuario,
		nm_usuario_nrec,
		dt_atualizacao,
		dt_atualizacao_nrec,
		cd_estabelecimento,
		dt_fim_vigencia,
		dt_inicio_vigencia,
		nr_seq_grupo,
		pr_rateio)
	(SELECT nextval('ctb_regra_rateio_grupo_seq'),
		nm_usuario_p,
		nm_usuario_p,
		clock_timestamp(),
		clock_timestamp(),
		vet_estabelecimento.cd_estabelecimento,
		dt_fim_vigencia,
		dt_inicio_vigencia,
		nr_seq_grupo,
		pr_rateio
	from	ctb_regra_rateio_grupo
	where	nr_sequencia = nr_seq_regra_grupo_distrib_p);
	end;

end loop;
close c_estabelecimento;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ctb_copiar_regra_distr_saldo ( nr_seq_regra_grupo_distrib_p bigint, cd_empresa_origem_p bigint, cd_estab_origem_p bigint, cd_estab_destino_p bigint, ie_copiar_todos_estab_p text, nm_usuario_p text) FROM PUBLIC;

