-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gc_gerar_cirurgia ( ie_Gerar_Cirurgia_Prescricao_p text, nr_seq_agenda_p bigint, nr_prescricao_p INOUT bigint, cd_estabelecimento_p bigint, ie_Gerar_Prescr_OPME_agenda_p text, cd_setor_atendimento_p bigint, ie_Gerar_Prescricao_Cirurgia_p text, ie_origem_inf_p bigint, nr_doc_interno_p bigint, cd_perfil_p bigint, nr_doc_interno_aux_p bigint, ie_tipo_doc_interno_p text, ie_tipo_doc_interno_aux_p text, ie_Gerar_Prescr_Patologia_p text, nm_usuario_p text) AS $body$
DECLARE

nr_prescricao_w		bigint;

BEGIN
if ( ie_Gerar_Cirurgia_Prescricao_p = 'N') then 
	nr_prescricao_w := Gerar_Prescricao_Agenda(nr_seq_agenda_p, nm_usuario_p, nr_prescricao_w, cd_estabelecimento_p );
end if;	
if ( ie_Gerar_Prescr_OPME_agenda_p <> 'N')then 
	CALL gerar_opme_materias_esp_agenda(	nr_seq_agenda_p,nm_usuario_p,cd_estabelecimento_p );
end if;
 
CALL Gerar_Cirurgia_Agenda(	cd_estabelecimento_p,nr_seq_agenda_p,nm_usuario_p,cd_setor_atendimento_p );
if ( ie_Gerar_Cirurgia_Prescricao_p = 'N') and (nr_prescricao_w IS NOT NULL AND nr_prescricao_w::text <> '')then 
	CALL Gerar_Proc_Agenda_Cirurgia( nr_seq_agenda_p,nr_prescricao_w,nm_usuario_p );
	if (ie_Gerar_Prescricao_Cirurgia_p = 'S') then 
	CALL gerar_prescricao_cirurgia( 0,0,0,nr_seq_agenda_p,ie_origem_inf_p,nm_usuario_p,nr_prescricao_w,nr_doc_interno_p, 
		0,900,cd_perfil_p,0,nr_doc_interno_aux_p,ie_tipo_doc_interno_p,ie_tipo_doc_interno_aux_p);
	end if;
end if;	
if (ie_Gerar_Prescr_Patologia_p = 'S') then 
	CALL gerar_prescr_patologia_cirur( nr_seq_agenda_p,nm_usuario_p,cd_estabelecimento_p );
end if;	
 
nr_prescricao_p := nr_prescricao_w;	
 
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gc_gerar_cirurgia ( ie_Gerar_Cirurgia_Prescricao_p text, nr_seq_agenda_p bigint, nr_prescricao_p INOUT bigint, cd_estabelecimento_p bigint, ie_Gerar_Prescr_OPME_agenda_p text, cd_setor_atendimento_p bigint, ie_Gerar_Prescricao_Cirurgia_p text, ie_origem_inf_p bigint, nr_doc_interno_p bigint, cd_perfil_p bigint, nr_doc_interno_aux_p bigint, ie_tipo_doc_interno_p text, ie_tipo_doc_interno_aux_p text, ie_Gerar_Prescr_Patologia_p text, nm_usuario_p text) FROM PUBLIC;

