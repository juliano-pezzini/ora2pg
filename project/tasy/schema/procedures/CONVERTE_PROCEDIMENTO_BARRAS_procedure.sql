-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE converte_procedimento_barras ( cd_barra_proc_p text, cd_procedimento_p INOUT bigint, ds_procedimento_p INOUT text, qt_procedimento_p INOUT bigint, ie_origem_proced_p INOUT bigint, nr_seq_exame_p INOUT bigint, nr_seq_proc_interno_p INOUT bigint, cd_exame_p INOUT bigint, ie_status_p INOUT text) AS $body$
DECLARE



/** Fernando Piccini/ Juliane Menin Faz a conversão do código do procedimento */

BEGIN
ie_status_p		:= 'N';
nr_seq_proc_interno_p	:= Null;
ds_procedimento_p	:= NUll;
if (length(cd_barra_proc_p) = 10) and (cd_barra_proc_p > 0) then
	begin
	if (substr(cd_barra_proc_p,1,2) = '77') then
		begin
		nr_seq_exame_p	:= Substr(cd_barra_proc_p,3,8);
      		select	cd_procedimento,
			ie_origem_proced,
			cd_exame,
			nm_exame
		into STRICT	cd_procedimento_p,
			ie_origem_proced_p,
			cd_exame_p,
			ds_procedimento_p
		from	exame_laboratorio
		where	nr_seq_exame =	nr_seq_exame_p;
		end;
  	elsif (substr(cd_barra_proc_p,1,2) = '88') then
		begin
		nr_seq_proc_interno_p	:= substr(cd_barra_proc_p,3,8);
		select	a.cd_procedimento,
			a.ie_origem_proced,
			a.ds_proc_exame
		into STRICT	cd_procedimento_p,
			ie_origem_proced_p,
			ds_procedimento_p
		from	procedimento b,
			proc_interno a
		where	a.cd_procedimento	= b.cd_procedimento
		and	a.ie_origem_proced	= b.ie_origem_proced
		and	a.nr_sequencia		= nr_seq_proc_interno_p;
		end;
	else
		begin
      		cd_procedimento_p	:= substr(cd_barra_proc_p,3,10);
		ie_origem_proced_p	:= substr(cd_barra_proc_p,1,1);
		select	ds_procedimento
		into STRICT	ds_procedimento_p
		from	procedimento
		where	cd_procedimento		= cd_procedimento_p
		and	ie_origem_proced	= ie_origem_proced_p;
      		end;
	end	if;

	select	qt_exec_barra
	into STRICT	qt_procedimento_p
	from	procedimento
	where	cd_procedimento		= cd_procedimento_p
	and	ie_origem_proced	= ie_origem_proced_p;
	if (ds_procedimento_p IS NOT NULL AND ds_procedimento_p::text <> '')	then
      		ie_status_p := 'S';
	end	if;
	end;
end	if;
commit;
end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE converte_procedimento_barras ( cd_barra_proc_p text, cd_procedimento_p INOUT bigint, ds_procedimento_p INOUT text, qt_procedimento_p INOUT bigint, ie_origem_proced_p INOUT bigint, nr_seq_exame_p INOUT bigint, nr_seq_proc_interno_p INOUT bigint, cd_exame_p INOUT bigint, ie_status_p INOUT text) FROM PUBLIC;

