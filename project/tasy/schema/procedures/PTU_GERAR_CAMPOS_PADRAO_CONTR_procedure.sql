-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ptu_gerar_campos_padrao_contr ( nr_seq_intercambio_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_seq_grupo_intercambio_w	bigint;
ie_tipo_contrato_w		varchar(10);
ie_controle_carteira_w		varchar(10);

c01 CURSOR FOR
	SELECT	ie_controle_carteira
	from	pls_regra_padrao_inter
	where	((nr_seq_grupo_intercambio	= nr_seq_grupo_intercambio_w) or (coalesce(nr_seq_grupo_intercambio::text, '') = ''))
	and	((ie_tipo_contrato		= ie_tipo_contrato_w) or (coalesce(ie_tipo_contrato::text, '') = ''))
	and	ie_situacao			= 'A'
	order by nr_seq_grupo_intercambio,
		ie_tipo_contrato;



BEGIN

select	nr_seq_grupo_intercambio,
	ie_tipo_contrato
into STRICT	nr_seq_grupo_intercambio_w,
	ie_tipo_contrato_w
from	pls_intercambio
where	nr_sequencia	= nr_seq_intercambio_p;

open C01;
loop
fetch C01 into
	ie_controle_carteira_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
end loop;
close C01;

ie_controle_carteira_w	:=  coalesce(ie_controle_carteira_w,'A');

update	pls_intercambio
set	ie_controle_carteira	= ie_controle_carteira_w
where	nr_sequencia		= nr_seq_intercambio_p;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ptu_gerar_campos_padrao_contr ( nr_seq_intercambio_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

