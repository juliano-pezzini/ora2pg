-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_reserva_recurso (nr_seq_agenda_p bigint, cd_equipamento_p bigint, cd_equipamento_agenda_p bigint, cd_estab_destino_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE

nr_seq_evento_w	bigint;				
				 

BEGIN 
 
insert	into	reserva_agenda_equip(nr_sequencia, 
		dt_atualizacao, 
		nm_usuario, 
		dt_atualizacao_nrec, 
		nm_usuario_nrec, 
		nr_seq_agenda, 
		cd_estab_destino, 
		cd_equipamento_agenda, 
		cd_equipamento)	 
values (nextval('reserva_agenda_equip_seq'), 
		clock_timestamp(), 
		nm_usuario_p, 
		clock_timestamp(), 
		nm_usuario_p, 
		nr_seq_agenda_p, 
		cd_estab_destino_p, 
		cd_equipamento_agenda_p, 
		cd_equipamento_p);
commit;		
 
select	max(nr_seq_evento) 
into STRICT	nr_seq_evento_w 
from	regra_envio_sms 
where	cd_estabelecimento		= cd_estabelecimento_p 
and	ie_evento_disp			= 'ASEA' 
and	coalesce(ie_situacao,'A') = 'A';
 
if (nr_seq_evento_w IS NOT NULL AND nr_seq_evento_w::text <> '') then 
	CALL gerar_evento_agenda_cirurgica(nr_seq_evento_w,nr_seq_agenda_p,0,cd_equipamento_p,nm_usuario_p,cd_estabelecimento_p,'N');
end if;	
 
end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_reserva_recurso (nr_seq_agenda_p bigint, cd_equipamento_p bigint, cd_equipamento_agenda_p bigint, cd_estab_destino_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

