-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cme_ajusta_tamanho_campos () AS $body$
DECLARE


qt_registro_w	bigint;


BEGIN

/*Cria tabela de backup*/

select	count(*)
into STRICT	qt_registro_w
from	user_tables
where	table_name = 'CM_CONJUNTO_BKP';

if (qt_registro_w = 0) then
	CALL Exec_Sql_Dinamico('Maicon', 'create table CM_CONJUNTO_BKP as select * from CM_CONJUNTO');
else
	CALL Exec_Sql_Dinamico('Maicon', 'drop table CM_CONJUNTO_BKP');
	CALL Exec_Sql_Dinamico('Maicon', 'create table CM_CONJUNTO_BKP as select * from CM_CONJUNTO');
end if;
/*Fim*/

/*Cria coluna NR_LARGURA2*/

select	count(*)
into STRICT	qt_registro_w
from	user_tab_columns
where	table_name	= 'CM_CONJUNTO'
and	column_name	= 'NR_LARGURA2';
if (qt_registro_w = 0) then
	CALL Exec_Sql_Dinamico('Maicon', 'alter table CM_CONJUNTO add NR_LARGURA2 number(13)');
else
	CALL Exec_Sql_Dinamico('Maicon', 'alter table CM_CONJUNTO drop column NR_LARGURA2');
	CALL Exec_Sql_Dinamico('Maicon', 'alter table CM_CONJUNTO add NR_LARGURA2 number(13)');
end if;
/*Fim*/

/*Cria coluna NR_ALTURA2*/

select	count(*)
into STRICT	qt_registro_w
from	user_tab_columns
where	table_name	= 'CM_CONJUNTO'
and	column_name	= 'NR_ALTURA2';

if (qt_registro_w = 0) then
	CALL Exec_Sql_Dinamico('Maicon', 'alter table CM_CONJUNTO add NR_ALTURA2 number(13)');
else
	CALL Exec_Sql_Dinamico('Maicon', 'alter table CM_CONJUNTO drop column NR_ALTURA2');
	CALL Exec_Sql_Dinamico('Maicon', 'alter table CM_CONJUNTO add NR_ALTURA2 number(13)');
end if;
/*Fim*/

/*Cria coluna NR_COMPRIMENTO2*/

select	count(*)
into STRICT	qt_registro_w
from	user_tab_columns
where	table_name	= 'CM_CONJUNTO'
and	column_name	= 'NR_COMPRIMENTO2';

if (qt_registro_w = 0) then
	CALL Exec_Sql_Dinamico('Maicon', 'alter table CM_CONJUNTO add NR_COMPRIMENTO2 number(13)');
else
	CALL Exec_Sql_Dinamico('Maicon', 'alter table CM_CONJUNTO drop column NR_COMPRIMENTO2');
	CALL Exec_Sql_Dinamico('Maicon', 'alter table CM_CONJUNTO add NR_COMPRIMENTO2 number(13)');
end if;
/*Fim*/

/*Cria coluna VL_VOLUME2*/

select	count(*)
into STRICT	qt_registro_w
from	user_tab_columns
where	table_name	= 'CM_CONJUNTO'
and	column_name	= 'VL_VOLUME2';

if (qt_registro_w = 0) then
	CALL Exec_Sql_Dinamico('Maicon', 'alter table CM_CONJUNTO add VL_VOLUME2 number(13)');
else
	CALL Exec_Sql_Dinamico('Maicon', 'alter table CM_CONJUNTO drop column VL_VOLUME2');
	CALL Exec_Sql_Dinamico('Maicon', 'alter table CM_CONJUNTO add VL_VOLUME2 number(13)');
end if;
/*Fim*/

CALL Exec_Sql_Dinamico('Maicon', ' update CM_CONJUNTO set NR_LARGURA2 = NR_LARGURA,NR_ALTURA2 = NR_ALTURA,NR_COMPRIMENTO2 = NR_COMPRIMENTO,VL_VOLUME2 = VL_VOLUME');
CALL Exec_Sql_Dinamico('Maicon', ' update CM_CONJUNTO set NR_LARGURA = null,NR_ALTURA = null,NR_COMPRIMENTO = null,VL_VOLUME = null');

CALL Exec_Sql_Dinamico('Maicon', 'alter table CM_CONJUNTO modify NR_LARGURA number(13,4)');
CALL Exec_Sql_Dinamico('Maicon', 'alter table CM_CONJUNTO modify NR_ALTURA number(13,4)');
CALL Exec_Sql_Dinamico('Maicon', 'alter table CM_CONJUNTO modify NR_COMPRIMENTO number(13,4)');
CALL Exec_Sql_Dinamico('Maicon', 'alter table CM_CONJUNTO modify VL_VOLUME number(13,4)');

CALL Exec_Sql_Dinamico('Maicon', ' update CM_CONJUNTO set NR_LARGURA = NR_LARGURA2,NR_ALTURA = NR_ALTURA2,NR_COMPRIMENTO = NR_COMPRIMENTO2,VL_VOLUME = VL_VOLUME2');

CALL Exec_Sql_Dinamico('Maicon', 'alter table CM_CONJUNTO drop column NR_LARGURA2');
CALL Exec_Sql_Dinamico('Maicon', 'alter table CM_CONJUNTO drop column NR_ALTURA2');
CALL Exec_Sql_Dinamico('Maicon', 'alter table CM_CONJUNTO drop column NR_COMPRIMENTO2');
CALL Exec_Sql_Dinamico('Maicon', 'alter table CM_CONJUNTO drop column VL_VOLUME2');

CALL valida_objetos_sistema();

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cme_ajusta_tamanho_campos () FROM PUBLIC;

