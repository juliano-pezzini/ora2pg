-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pat_gerar_man_equipamento ( nr_sequencia_p bigint, nr_grupo_planej_p bigint, nr_grupo_trabalho_p bigint, nm_equip_format_p text, nm_usuario_p text) AS $body$
DECLARE


cd_centro_custo_w			bigint;
cd_estabelecimento_w			bigint;
nr_seq_local_manutencao_w		bigint;
nr_seq_local_w				bigint;	
nr_seq_tipo_equip_w			bigint;
nr_seq_tipo_w				bigint;
qt_registro_w				bigint;


BEGIN

select	count(*)
into STRICT	qt_registro_w
from	man_equipamento
where	nr_seq_bem	= nr_sequencia_p;

if (qt_registro_w > 0) then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(266504);
	/*JÃ¡ existe um equipamento vinculado a este Bem.#@#@');*/

end if;

select	cd_estabelecimento,
	nr_seq_tipo,
	nr_seq_local
into STRICT	cd_estabelecimento_w,
	nr_seq_tipo_w,
	nr_seq_local_w
from	pat_bem
where	nr_sequencia	=	nr_sequencia_p;

select	max(cd_centro_custo)
into STRICT	cd_centro_custo_w
from	pat_local
where	nr_sequencia	= nr_seq_local_w;



CALL pat_gerar_man_tipo_equip(nr_seq_tipo_w, nm_usuario_p);
CALL pat_gerar_man_localizacao(nr_seq_local_w, nm_usuario_p);

select	max(nr_seq_tipo_equip)
into STRICT	nr_seq_tipo_equip_w
from	pat_tipo_bem
where	nr_sequencia	= nr_seq_tipo_w;

select	max(nr_seq_local_manutencao)
into STRICT	nr_seq_local_manutencao_w
from	pat_local
where	nr_sequencia	= nr_seq_local_manutencao_w;

CALL man_integrar_pat_manutencao(	nr_sequencia_p,
				cd_estabelecimento_w,
				nm_usuario_p,
				nr_seq_local_manutencao_w,
				cd_centro_custo_w,
				nr_seq_tipo_equip_w,
				nr_grupo_planej_p,
				nr_grupo_trabalho_p,
				null,
				null,
				nm_equip_format_p);
				
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pat_gerar_man_equipamento ( nr_sequencia_p bigint, nr_grupo_planej_p bigint, nr_grupo_trabalho_p bigint, nm_equip_format_p text, nm_usuario_p text) FROM PUBLIC;

