-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_fila_impressao_adt (nr_atendimnento_p bigint, ie_operacao_p bigint) AS $body$
DECLARE


c01 CURSOR FOR
    SELECT  imp.nr_sequencia
      FROM  relatorio_auto_imp imp
     WHERE  imp.ie_regra_repet = 'ADT'
       AND  imp.ie_tipo_acao_adt = 'A'
	   AND  (imp.nr_Seq_scheduler IS NOT NULL AND imp.nr_Seq_scheduler::text <> '');

c02 CURSOR FOR
    SELECT  imp.nr_sequencia
      FROM  relatorio_auto_imp imp
     WHERE  imp.ie_regra_repet = 'ADT'
       AND  imp.ie_tipo_acao_adt = 'T'
	   AND  (imp.nr_Seq_scheduler IS NOT NULL AND imp.nr_Seq_scheduler::text <> '');

c03 CURSOR FOR
    SELECT  imp.nr_sequencia
      FROM  relatorio_auto_imp imp
     WHERE  imp.ie_regra_repet = 'ADT'
       AND  imp.ie_tipo_acao_adt = 'D'
	   AND  (imp.nr_Seq_scheduler IS NOT NULL AND imp.nr_Seq_scheduler::text <> '');

BEGIN
--1 admissao
--2 transferencia
--3 alta
    IF ie_operacao_p = 1 THEN
        FOR c01_w IN c01
                    LOOP
                        INSERT INTO fila_impressao_adt(
                                    nr_sequencia,
                                    nr_atendimento,
                                    nr_seq_relatorio_auto_imp,
                                    dt_atualizacao
                            ) VALUES (
                                    nextval('fila_impressao_adt_seq'),
                                    nr_atendimnento_p,
                                    c01_w.nr_sequencia,
                                    clock_timestamp()
                                );
                    END LOOP;

    ELSIF ie_operacao_p = 2 THEN   
        FOR c02_w IN c02
                    LOOP
                        INSERT INTO fila_impressao_adt(
                                    nr_sequencia,
                                    nr_atendimento,
                                    nr_seq_relatorio_auto_imp,
                                    dt_atualizacao
                            ) VALUES (
                                    nextval('fila_impressao_adt_seq'),
                                    nr_atendimnento_p,
                                    c02_w.nr_sequencia,
                                    clock_timestamp()
                                );
                    END LOOP;
                    
    ELSIF ie_operacao_p = 3 THEN   
        FOR c03_w IN c03
                    LOOP
                        INSERT INTO fila_impressao_adt(
                                    nr_sequencia,
                                    nr_atendimento,
                                    nr_seq_relatorio_auto_imp,
                                    dt_atualizacao
                            ) VALUES (
                                    nextval('fila_impressao_adt_seq'),
                                    nr_atendimnento_p,
                                    c03_w.nr_sequencia,
                                    clock_timestamp()
                                );
                    END LOOP;
    END IF;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_fila_impressao_adt (nr_atendimnento_p bigint, ie_operacao_p bigint) FROM PUBLIC;

