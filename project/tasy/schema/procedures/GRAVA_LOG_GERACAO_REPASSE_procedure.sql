-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE grava_log_geracao_repasse ( nr_atendimento_p bigint, nr_interno_conta_p bigint, nr_seq_procedimento_p bigint, nr_seq_partic_p bigint, cd_procedimento_p bigint, ie_origem_proced_p bigint, nr_seq_material_p bigint, cd_material_p bigint, ds_log_p text, nm_usuario_p text, nr_seq_protocolo_p bigint) AS $body$
BEGIN

if (nr_seq_procedimento_p IS NOT NULL AND nr_seq_procedimento_p::text <> '') then

	if (coalesce(nr_seq_partic_p,0) > 0) then
		begin
		delete 	from procedimento_repasse_log
		where	nr_seq_participante = nr_seq_partic_p
		and	nr_seq_procedimento = nr_seq_procedimento_p;
		end;
	else
		begin
		delete 	from procedimento_repasse_log
		where	nr_seq_procedimento = nr_seq_procedimento_p;
		end;
	end if;

	insert	into	procedimento_repasse_log(nr_sequencia,
						dt_atualizacao,
						nm_usuario,
						nr_interno_conta,
						nr_seq_procedimento,
						ds_log,
						nr_atendimento,
						cd_procedimento,
						ie_origem_proced,
						nr_seq_participante,
						nr_seq_proc_partic,
						nr_seq_protocolo)
		values (				nextval('procedimento_repasse_log_seq'),
						clock_timestamp(),
						nm_usuario_p,
						nr_interno_conta_p,
						nr_seq_procedimento_p,
						ds_log_p,
						nr_atendimento_p,
						cd_procedimento_p,
						ie_origem_proced_p,
						CASE WHEN nr_seq_partic_p=0 THEN null  ELSE nr_seq_partic_p END ,
						CASE WHEN nr_seq_partic_p=0 THEN null  ELSE nr_seq_procedimento_p END ,
						nr_seq_protocolo_p);
elsif (nr_seq_material_p IS NOT NULL AND nr_seq_material_p::text <> '') then

	delete	from material_repasse_log
	where	nr_seq_material = nr_seq_material_p;

	insert	into	material_repasse_log(	nr_sequencia,
						dt_atualizacao,
						nm_usuario,
						ds_log,
						nr_seq_material,
						nr_interno_conta,
						cd_material,
						nr_atendimento,
						nr_seq_protocolo)
		values (				nextval('material_repasse_log_seq'),
						clock_timestamp(),
						nm_usuario_p,
						ds_log_p,
						nr_seq_material_p,
						nr_interno_conta_p,
						cd_material_p,
						nr_atendimento_p,
						nr_seq_protocolo_p);
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE grava_log_geracao_repasse ( nr_atendimento_p bigint, nr_interno_conta_p bigint, nr_seq_procedimento_p bigint, nr_seq_partic_p bigint, cd_procedimento_p bigint, ie_origem_proced_p bigint, nr_seq_material_p bigint, cd_material_p bigint, ds_log_p text, nm_usuario_p text, nr_seq_protocolo_p bigint) FROM PUBLIC;

