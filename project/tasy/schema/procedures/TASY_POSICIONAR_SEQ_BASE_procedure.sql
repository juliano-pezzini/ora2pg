-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE tasy_posicionar_seq_base () AS $body$
DECLARE


nm_tabela_w			varchar(50);
nm_atributo_w		varchar(50);
qt_processo_total_w	bigint;
qt_processado_w		bigint := 0;

C01 CURSOR FOR
SELECT	a.nm_tabela,
		a.nm_atributo
from	tabela_atributo a,
		tabela_sistema b
where	a.nm_tabela = b.nm_tabela
and		gerar_objeto_aplicacao(b.ds_aplicacao) = 'S'
and		a.qt_seq_inicio 	 >0
and		a.qt_seq_incremento >0
and		length(b.nm_tabela) + 4 < 31
and	a.nm_tabela	not in ('APLICACAO_TASY',
				'CLASSIFICACAO_PARAMETRO',
				'DIC_EXPRESSAO',
				'DIC_MASCARA',
				'DIC_OBJETO',
				'DIC_OBJETO_FILTRO',
				'DIC_OBJETO_FILTRO_GRUPO',
				'DIC_PANEL',
				'DIC_PANEL_ELEMENT',
				'DOMINIO',
				'FUNCAO',
				'FUNCAO_CHAMADA_EXTERNA',
				'FUNCAO_GRUPO_PARAM',
				'FUNCAO_PARAMETRO',
				'FUNCAO_SCHEMATIC',
				'INDICE',
				'INDICE_ATRIBUTO',
				'INTEGRIDADE_ATRIBUTO',
				'INTEGRIDADE_REFERENCIAL',
				'INTERFACE',
				'MODULO_IMPLANTACAO',
				'MODULO_TASY',
				'OBJETO_SCHEMATIC',
				'OBJETO_SCHEMATIC_ATIV',
				'OBJETO_SCHEMATIC_LEGENDA',
				'OBJETO_SCHEMATIC_PARAM',
				'OBJETO_SCHEMATIC_PROP',
				'OBJETO_SISTEMA',
				'OBJETO_SISTEMA_PARAM',
				'OBJ_SCHEMATIC_ATIV_PARAM',
				'OBJ_SCHEMATIC_EVENTO',
				'OBJ_SCHEMATIC_EVENTO_ACAO',
				'OPCOES_CRUD',
				'REGRA_CONDICAO',
				'REGRA_CONDICAO_ITEM',
				'REGRA_SCHEMATIC',
				'REGRA_SCHEMATIC_OBJ',
				'REGRA_SCHEMATIC_OBJ_FILHO',
				'RELATORIO',
				'SCHEMATIC_RELATORIO',
				'TABELA_ATRIBUTO',
				'TABELA_SISTEMA',
				'TABELA_SISTEMA_ATIVACAO',
				'TABELA_VISAO',
				'TABELA_VISAO_ATRIBUTO',
				'TABELA_VISAO_GRUPO',
				'TASY_LEGENDA',
				'TASY_PADRAO_COR',
				'TASY_PAIS',
				'TASY_PROJETO_ASSINATURA',
				'TIPO_LOCALIZAR',
				'TIPO_SCHEMATIC',
				'VALOR_DOMINIO',
				'XML_PROJETO')

union

select	'PESSOA_FISICA' nm_tabela,
	'NR_PRONTUARIO' nm_atributo
;

BEGIN

select 	count(*)
into STRICT 	qt_processo_total_w
from	tabela_atributo
where	(qt_seq_inicio IS NOT NULL AND qt_seq_inicio::text <> '')
and		(qt_seq_incremento IS NOT NULL AND qt_seq_incremento::text <> '');

CALL gravar_processo_longo('','TASY_POSICIONAR_SEQ_BASE',0);

open c01;
loop
fetch c01 into 	nm_tabela_w,
			nm_atributo_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin
		qt_processado_w := qt_processado_w + 1;
		CALL gravar_processo_longo('Tab->'|| nm_tabela_w ||'('||nm_atributo_w||')('||qt_processado_w||'/'||qt_processo_total_w||')','TASY_POSICIONAR_SEQ_BASE',qt_processado_w);
		CALL Tasy_Posicionar_Sequence(nm_tabela_w, nm_atributo_w, 'R');
	exception
		when others then
			null;
	end;
end loop;
close c01;

CALL gravar_processo_longo('','',0);

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tasy_posicionar_seq_base () FROM PUBLIC;

