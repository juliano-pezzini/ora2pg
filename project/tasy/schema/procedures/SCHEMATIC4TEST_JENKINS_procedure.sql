-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE schematic4test_jenkins (NR_SEQ_PACOTE_P bigint, NR_SEQ_URL_P bigint, DS_URL_P text) AS $body$
DECLARE

usuarioJenkins varchar(15);
NR_SEQ_URL_W bigint;
IE_STATUS_W varchar(255);
DS_VERSION_W varchar(255);


BEGIN
    --procedure that execute package by jenkins
	IF (NR_SEQ_PACOTE_P IS NOT NULL AND NR_SEQ_PACOTE_P::text <> '') THEN
		IF (NR_SEQ_PACOTE_P <> 29) THEN
			usuarioJenkins := 'Tec-Jenkins';
			IE_STATUS_W := '1';
			DS_VERSION_W := '0';
		ELSE
			usuarioJenkins := 'Dev-NightBuild';
			IE_STATUS_W := '10';
			DS_VERSION_W := '0.0.0-SNAPSHOT.0';
		END IF;

		IF (NR_SEQ_URL_P IS NOT NULL AND NR_SEQ_URL_P::text <> '') THEN
        BEGIN
          UPDATE SCHEM_TEST_URL SET DS_URL = DS_URL_P WHERE NR_SEQUENCIA = NR_SEQ_URL_P;
          COMMIT;
          EXCEPTION  WHEN others THEN
            RAISE NOTICE 'Error: URL not updateted.';
        END;
	ELSE 
        SELECT nextval('schem_test_url_seq')
            INTO STRICT NR_SEQ_URL_W
        FROM SCHEM_TEST_URL LIMIT 1;

        INSERT INTO SCHEM_TEST_URL(NR_SEQUENCIA, DS_URL, IE_SITUACAO, IE_STATUS, DT_ATUALIZACAO_NREC, DT_ATUALIZACAO, NM_USUARIO, NM_USUARIO_NREC) 
            VALUES (NR_SEQ_URL_W, DS_URL_P, 'A', '1', clock_timestamp(), clock_timestamp(), usuarioJenkins, usuarioJenkins);

        UPDATE SCHEM_TEST_PACKAGE_ITEM SET NR_SEQ_URL = NR_SEQ_URL_W WHERE NR_SEQ_PACKAGE = NR_SEQ_PACOTE_P;
        COMMIT;
    END IF;
	
    BEGIN
        INSERT INTO SCHEM_TEST_PACKAGE_SCHED(nr_sequencia, nr_seq_package, nm_owner, ds_info, DT_ATUALIZACAO_NREC, DT_ATUALIZACAO,NM_USUARIO_NREC, NM_USUARIO, IE_STATUS, DT_SCHEDULE, IE_ESTAG_EXEC, IE_VIDEO, DS_VERSION, IE_AUTO_RESTORE)
             VALUES (nextval('schem_test_package_sched_seq'), NR_SEQ_PACOTE_P, usuarioJenkins, 'By '||usuarioJenkins, clock_timestamp(), clock_timestamp(), usuarioJenkins, usuarioJenkins, IE_STATUS_W, clock_timestamp(), '0', 'N', DS_VERSION_W, 'N');
        COMMIT;
    EXCEPTION  WHEN others THEN
        RAISE NOTICE 'Error: Activity group not scheduled.';
    END;
  END IF;
  EXCEPTION
  WHEN no_data_found THEN
    RAISE NOTICE 'Erro: Data not found';
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE schematic4test_jenkins (NR_SEQ_PACOTE_P bigint, NR_SEQ_URL_P bigint, DS_URL_P text) FROM PUBLIC;

