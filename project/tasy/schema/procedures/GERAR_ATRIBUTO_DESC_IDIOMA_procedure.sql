-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_atributo_desc_idioma ( nr_seq_idioma_p bigint, nm_usuario_p text) AS $body$
DECLARE


nm_tabela_w	varchar(50);
nm_atributo_w	varchar(50);
ds_atributo_w	varchar(4000);

C01 CURSOR FOR
	SELECT	a.nm_tabela,
		a.nm_atributo,
		b.ds_atributo
	from	tab_atributo_idioma a,
		tabela_atributo b
	where	a.nm_atributo = b.nm_atributo
	and	a.nm_tabela = b.nm_tabela
	and	a.nm_atributo_traducao = 'DS_LABEL'
	and	(b.ds_atributo IS NOT NULL AND b.ds_atributo::text <> '')
	and	not exists (
			SELECT	1
			from	tab_atributo_desc_idioma x
			where	x.nm_tabela = a.nm_tabela
			and	x.nm_atributo = a.nm_atributo)
	order by nm_tabela, nm_atributo;


BEGIN

open C01;
loop
fetch C01 into
	nm_tabela_w,
	nm_atributo_w,
	ds_atributo_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin

	insert into tab_atributo_desc_idioma(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nm_tabela,
		nm_atributo,
		ds_atributo,
		ds_traducao,
		nr_seq_idioma,
		ie_necessita_revisao
	) values (
		nextval('tab_atributo_desc_idioma_seq'),
		clock_timestamp(),
		'epmallmann',
		clock_timestamp(),
		'epmallmann',
		nm_tabela_w,
		nm_atributo_w,
		ds_atributo_w,
		' ',
		nr_seq_idioma_p,
		'S'
	);

	end;
end loop;
close C01;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_atributo_desc_idioma ( nr_seq_idioma_p bigint, nm_usuario_p text) FROM PUBLIC;

