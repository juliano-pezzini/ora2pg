-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE tiss_gerar_dem_conta ( nr_seq_lote_p bigint, nr_guia_prestador_p text, nr_guia_operadora_p text, cd_usuario_convenio_p text, nm_usuario_convenio_p text, ds_plano_p text, dt_realizacao_p timestamp, vl_processado_p bigint, vl_liberado_p bigint, vl_glosado_p bigint, vl_informado_p bigint, nm_usuario_p text, nr_seq_conta_p INOUT bigint, dt_inicio_fat_p timestamp default null, dt_hora_ini_fat_p text default null, dt_fim_fat_p timestamp default null, dt_hora_fim_fat_p text default null, cd_senha_p text default null) AS $body$
DECLARE


nr_sequencia_w			bigint;
dt_ini_fat_w			varchar(20);
dt_fim_fat_w			varchar(20);
cd_estabelecimento_w		estabelecimento.cd_estabelecimento%type := wheb_usuario_pck.get_cd_Estabelecimento;


BEGIN

if ((dt_inicio_fat_p IS NOT NULL AND dt_inicio_fat_p::text <> '') and
	(dt_fim_fat_p IS NOT NULL AND dt_fim_fat_p::text <> '') and
	Obter_Valor_Param_Usuario(27, 296, Obter_Perfil_Ativo, nm_usuario_p, cd_estabelecimento_w) = 'S') then

	dt_ini_fat_w := to_char(dt_inicio_fat_p,'dd/mm/yyyy')||' ' || dt_hora_ini_fat_p;
	dt_fim_fat_w := to_char(dt_fim_fat_p,'dd/mm/yyyy')|| ' ' || dt_hora_fim_fat_p;
end if;

select	nextval('tiss_dem_conta_seq')
into STRICT	nr_sequencia_w
;



insert into tiss_dem_conta(nr_sequencia,
          dt_atualizacao,
          nm_usuario,
          nr_seq_lote,
          nr_guia_prestador,
          nr_guia_operadora,
          cd_usuario_convenio,
          nm_usuario_convenio,
          ds_plano,
          dt_realizacao,
          vl_processado,
          vl_liberado,
          vl_glosado,
	  vl_informado,
	  dt_importacao,
	  dt_inicio_faturamento,
	  dt_fim_faturamento,
	  cd_senha)
	values (
	  nr_sequencia_w,
	  clock_timestamp(),
	  nm_usuario_p,
	  nr_seq_lote_p,
	  nr_guia_prestador_p,
	  nr_guia_operadora_p,
	  cd_usuario_convenio_p,
	  nm_usuario_convenio_p,
	  ds_plano_p,
	  dt_realizacao_p,
	  vl_processado_p,
	  vl_liberado_p,
	  vl_glosado_p,
	  vl_informado_p,
	  null,
	  coalesce(to_date(dt_ini_fat_w,'dd/mm/yyyy hh24:mi:ss'),null),
	  coalesce(to_date(dt_fim_fat_w,'dd/mm/yyyy hh24:mi:ss'),null),
	  cd_senha_p);

nr_seq_conta_p	:= nr_sequencia_w;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tiss_gerar_dem_conta ( nr_seq_lote_p bigint, nr_guia_prestador_p text, nr_guia_operadora_p text, cd_usuario_convenio_p text, nm_usuario_convenio_p text, ds_plano_p text, dt_realizacao_p timestamp, vl_processado_p bigint, vl_liberado_p bigint, vl_glosado_p bigint, vl_informado_p bigint, nm_usuario_p text, nr_seq_conta_p INOUT bigint, dt_inicio_fat_p timestamp default null, dt_hora_ini_fat_p text default null, dt_fim_fat_p timestamp default null, dt_hora_fim_fat_p text default null, cd_senha_p text default null) FROM PUBLIC;

