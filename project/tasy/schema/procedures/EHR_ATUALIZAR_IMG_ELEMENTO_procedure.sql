-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ehr_atualizar_img_elemento ( nr_seq_template_p bigint, nr_seq_reg_template_p bigint, nr_seq_elemento_p bigint, ds_resultado_p text, nm_usuario_p text, nr_sequencia_p INOUT bigint) AS $body$
DECLARE

qt_reg_w	smallint;
nr_sequencia_w	bigint;


BEGIN

/* Verifica se já existe um registro do componente TStringGrid (Cluster) na tabela de valores */

begin

	select	nr_sequencia
	into STRICT	nr_sequencia_w
	from	ehr_reg_elemento
	where	nr_seq_reg_template = nr_seq_reg_template_p
	and	nr_seq_elemento  = nr_seq_elemento_p
	and	coalesce(nr_seq_elem_cluster::text, '') = '';
	exception
	when others then
		nr_sequencia_w := null;
end;

/* Caso não existir um registro do componente TStringGrid (Cluster) na tabela de valores,
   insere-se um registro para poder adicionar as imagens */
if (coalesce(nr_sequencia_w::text, '') = '') then

	select	nextval('ehr_reg_elemento_seq')
	into STRICT	nr_sequencia_w
  	;

  	insert into ehr_reg_elemento(
	   	nr_sequencia,
		nr_seq_reg_template,
		dt_atualizacao,
		nm_usuario,
   		dt_atualizacao_nrec,
   		nm_usuario_nrec,
	   	nr_seq_elemento)
  	values (nr_sequencia_w,
		nr_seq_reg_template_p,
   		clock_timestamp(),
   		nm_usuario_p,
	   	clock_timestamp(),
		nm_usuario_p,
	   	nr_seq_elemento_p);
end	if;

/* Caso já existir um registro do componente TStringGrid (Cluster) na tabela de valores,
   insere-se apenas a(s) imagen(s) */
select	nextval('ehr_reg_elemento_seq')
into STRICT	nr_sequencia_p
;

insert	into ehr_reg_elemento(
	nr_sequencia,
	nr_seq_reg_template,
	dt_atualizacao,
	nm_usuario,
	dt_atualizacao_nrec,
	nm_usuario_nrec,
	nr_seq_elemento,
	ds_resultado,
	nr_seq_elem_cluster)
values (nr_sequencia_p,
	nr_seq_reg_template_p,
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	nr_seq_elemento_p,
	ds_resultado_p,
	nr_sequencia_w);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ehr_atualizar_img_elemento ( nr_seq_template_p bigint, nr_seq_reg_template_p bigint, nr_seq_elemento_p bigint, ds_resultado_p text, nm_usuario_p text, nr_sequencia_p INOUT bigint) FROM PUBLIC;

