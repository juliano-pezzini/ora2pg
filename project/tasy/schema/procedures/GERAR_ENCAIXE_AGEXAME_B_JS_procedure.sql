-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_encaixe_agexame_b_js ( cd_agenda_p text, dt_agenda_p timestamp, dt_encaixe_p timestamp, qt_duracao_p bigint, cd_pessoa_encaixe_p text, nm_pessoa_encaixe_p text, cd_setor_atendimento_p text, cd_convenio_p text, cd_categoria_p text, ie_forma_agendamento_p text, cd_requisitante_p text, cd_executor_p text, cd_procedimento_p text, ie_origem_proced_p text, nr_seq_proc_interno_p text, ie_lado_p text, ds_observacao_p text, cd_estabelecimento_p bigint, cd_perfil_p bigint, nr_seq_classif_p bigint, nm_usuario_p text, nr_seq_encaixe_p INOUT bigint, ds_carteiras_selec_p INOUT text, cd_plano_p text default null, nr_seq_segurado_p bigint default null, dt_val_carteira_p timestamp default null, cd_usuario_convenio_p text default null, cd_empresa_ref_p bigint default null) AS $body$
DECLARE


nr_seq_encaixe_w			bigint;
ie_busca_cod_usuario_w		varchar(255);
ds_carteiras_selec_w		varchar(255);


BEGIN

nr_seq_encaixe_w := gerar_encaixe_agenda_exame(	cd_estabelecimento_p, cd_agenda_p, dt_agenda_p, dt_encaixe_p, qt_duracao_p, cd_pessoa_encaixe_p, nm_pessoa_encaixe_p, cd_convenio_p, cd_categoria_p, cd_requisitante_p, cd_executor_p, cd_procedimento_p, ie_origem_proced_p, nr_seq_proc_interno_p, ie_lado_p, ds_observacao_p, nm_usuario_p, cd_setor_atendimento_p, ie_forma_agendamento_p, cd_plano_p, null, nr_seq_classif_p, nr_seq_encaixe_w, nr_seq_segurado_p, dt_val_carteira_p, cd_usuario_convenio_p, cd_empresa_ref_p);

ie_busca_cod_usuario_w := Obter_Param_Usuario(820, 117, cd_perfil_p, nm_usuario_p, cd_estabelecimento_p, ie_busca_cod_usuario_w);

if (nr_seq_encaixe_w IS NOT NULL AND nr_seq_encaixe_w::text <> '') and (ie_busca_cod_usuario_w = 'S') then
	begin
	ds_carteiras_selec_w := gera_usu_conv_ops_agepac(nr_seq_encaixe_w, cd_estabelecimento_p, ds_carteiras_selec_w);

	if (coalesce(ds_carteiras_selec_w::text, '') = '') then
		CALL gera_plano_ops_agepac(nr_seq_encaixe_w);
	end if;

	end;
end if;

nr_seq_encaixe_p		:= nr_seq_encaixe_w;
ds_carteiras_selec_p	:= ds_carteiras_selec_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_encaixe_agexame_b_js ( cd_agenda_p text, dt_agenda_p timestamp, dt_encaixe_p timestamp, qt_duracao_p bigint, cd_pessoa_encaixe_p text, nm_pessoa_encaixe_p text, cd_setor_atendimento_p text, cd_convenio_p text, cd_categoria_p text, ie_forma_agendamento_p text, cd_requisitante_p text, cd_executor_p text, cd_procedimento_p text, ie_origem_proced_p text, nr_seq_proc_interno_p text, ie_lado_p text, ds_observacao_p text, cd_estabelecimento_p bigint, cd_perfil_p bigint, nr_seq_classif_p bigint, nm_usuario_p text, nr_seq_encaixe_p INOUT bigint, ds_carteiras_selec_p INOUT text, cd_plano_p text default null, nr_seq_segurado_p bigint default null, dt_val_carteira_p timestamp default null, cd_usuario_convenio_p text default null, cd_empresa_ref_p bigint default null) FROM PUBLIC;

