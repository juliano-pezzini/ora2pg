-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE add_manually_eligibility ( ds_message_p tiss_retorno_elegibilidade.ds_mensagem_glosa%type, nr_atendimento_p atendimento_paciente.nr_atendimento%type) AS $body$
DECLARE


cd_estabelecimento_w    atendimento_paciente.cd_estabelecimento%type;
cd_pessoa_fisica_w      atendimento_paciente.cd_pessoa_fisica%type;


BEGIN

select max(cd_estabelecimento),
       max(cd_pessoa_fisica)
into STRICT   cd_estabelecimento_w,
       cd_pessoa_fisica_w
from   atendimento_paciente
where  nr_atendimento = nr_atendimento_p;

insert into tiss_retorno_elegibilidade(
  nr_sequencia,
  dt_atualizacao,
  dt_atualizacao_nrec,
  cd_usuario_convenio,
  cd_estabelecimento,
  nm_usuario_nrec,
  nm_usuario,
  nr_atendimento,
  ds_mensagem_glosa,
  cd_pessoa_fisica
) values (
  nextval('tiss_retorno_elegibilidade_seq'),
  clock_timestamp(),
  clock_timestamp(),
  0,
  cd_estabelecimento_w,
  wheb_usuario_pck.get_nm_usuario,
  wheb_usuario_pck.get_nm_usuario,
  nr_atendimento_p,
  ds_message_p,
  cd_pessoa_fisica_w
);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE add_manually_eligibility ( ds_message_p tiss_retorno_elegibilidade.ds_mensagem_glosa%type, nr_atendimento_p atendimento_paciente.nr_atendimento%type) FROM PUBLIC;

