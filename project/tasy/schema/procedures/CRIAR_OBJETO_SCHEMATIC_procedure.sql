-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE criar_objeto_schematic ( cd_funcao_p bigint, nr_seq_funcao_schematic_p bigint, nr_seq_tipo_schematic_p bigint, ds_objeto_p text, ie_tipo_componente_p text, nr_seq_superior_p bigint, nm_tabela_p text, nr_seq_visao_p bigint, nr_seq_dic_objeto_p bigint, cd_exp_desc_obj_p bigint, nm_usuario_p text, nr_seq_gerado_p INOUT bigint ) AS $body$
DECLARE




nr_sequencia_w	bigint;
nr_seq_apres_w	bigint;
nr_seq_visao_w	bigint;
nr_seq_dic_objeto_w	bigint;
ie_dinamicform_w	varchar(10)	:= 'N';
cd_exp_desc_obj_w	bigint;


BEGIN

select	nextval('objeto_schematic_seq')
into STRICT	nr_sequencia_w
;

select	coalesce(max(nr_seq_apres),0) + 10
into STRICT	nr_seq_apres_w
from	OBJETO_SCHEMATIC
where	nr_seq_funcao_schematic = nr_seq_funcao_schematic_p
and (coalesce(nr_seq_superior_p::text, '') = '' or NR_SEQ_OBJ_SUP = nr_seq_superior_p);

select	max(CD_EXP_INFORMACAO)
into STRICT	cd_exp_desc_obj_w
from	DIC_OBJETO
where	nr_sequencia = cd_exp_desc_obj_p;

if (ie_tipo_componente_p = 'WDBP') and (nm_tabela_p IS NOT NULL AND nm_tabela_p::text <> '') then
	nr_seq_visao_w := Duplicar_Visao_Para_Gwt(coalesce(nr_seq_visao_p,0), nm_usuario_p, nr_seq_visao_w, nm_tabela_p);
elsif (nr_seq_dic_objeto_p IS NOT NULL AND nr_seq_dic_objeto_p::text <> '') then
	if (ie_tipo_componente_p = 'WDF') then
		ie_dinamicform_w	:= 'S';
	end if;

	nr_seq_dic_objeto_w := copiar_dic_objeto(cd_funcao_p, nr_seq_dic_objeto_p, nm_usuario_p, ie_dinamicform_w, nr_seq_dic_objeto_w);
end if;

insert into OBJETO_SCHEMATIC(
			 NR_SEQUENCIA,
			 DT_ATUALIZACAO_NREC,
			 NM_USUARIO_NREC,
			 DT_ATUALIZACAO,
			 NM_USUARIO,
			 CD_FUNCAO,
			 DS_OBJETO,
			 IE_TIPO_OBJETO,
			 NR_SEQ_OBJ_SUP,
			 IE_TIPO_OBJ_PAINEL,
			 IE_TIPO_OBJ_NAVEGADOR,
			 IE_TIPO_OBJ_MASTER_REGIAO,
			 NR_SEQ_FUNCAO_SCHEMATIC,
			 NR_SEQ_APRES,
			 IE_TIPO_COMPONENTE,
			 NR_SEQ_DIC_OBJETO,
			 NM_TABELA,
			 NR_SEQ_VISAO,
			 NR_SEQ_TIPO_SCHEMATIC,
			 CD_EXP_DESC_OBJ,
			 NR_SEQ_ATIVACAO,
			 NR_SEQ_OBJ_PADRAO,
			 IE_TIPO_OBJ_BUTTON,
			 NR_SEQ_OBJ_SUP_ATIV,
			 IE_HERDAR_PERMISSOES,
			 IE_POPUP_HANDLE)

		values (
			 nr_sequencia_w,
			 clock_timestamp(),
			 nm_usuario_p,
			 clock_timestamp(),
			 nm_usuario_p,
			 CD_FUNCAO_p,
			 DS_OBJETO_p,
			 'C',
			 nr_seq_superior_p,
			 null,
			 null,
			 null,
			 nr_seq_funcao_schematic_p,
			 nr_seq_apres_w,
			 IE_TIPO_COMPONENTE_p,
			 nr_seq_dic_objeto_w,
			 NM_TABELA_p,
			 NR_SEQ_VISAO_w,
			 nr_seq_tipo_schematic_p,
			 cd_exp_desc_obj_w,
			 null,
			 null,
			 null,
			 null,
			 null,
			 null);

if (IE_TIPO_COMPONENTE_p	= 'WDLG') then

insert into objeto_schematic(
			nr_sequencia,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			dt_atualizacao,
			nm_usuario,
			cd_funcao,
			ds_objeto,
			ie_tipo_objeto,
			nr_seq_obj_sup,
			ie_tipo_obj_painel,
			ie_tipo_obj_navegador,
			ie_tipo_obj_master_regiao,
			nr_seq_funcao_schematic,
			nr_seq_apres,
			ie_tipo_componente,
			nr_seq_dic_objeto,
			nm_tabela,
			nr_seq_visao,
			nr_seq_tipo_schematic,
			cd_exp_desc_obj,
			nr_seq_ativacao,
			nr_seq_obj_padrao,
			ie_tipo_obj_button,
			nr_seq_obj_sup_ativ,
			ie_herdar_permissoes,
			ie_popup_handle )
	values ( 	nextval('objeto_schematic_seq'),
				clock_timestamp(),
				nm_usuario_p,
				clock_timestamp(),
				nm_usuario_p,
				cd_funcao_p,
				'OK',
				'BTN',
				nr_sequencia_w,
				NULL,
				NULL,
				NULL,
				nr_seq_funcao_schematic_p,
				2,
				886,
				NULL,
				NULL,
				NULL,
				NULL,
				311702,
				NULL,
				NULL,
				'OK',
				NULL,
				NULL,
				NULL);



	insert into objeto_schematic(
			nr_sequencia,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			dt_atualizacao,
			nm_usuario,
			cd_funcao,
			ds_objeto,
			ie_tipo_objeto,
			nr_seq_obj_sup,
			ie_tipo_obj_painel,
			ie_tipo_obj_navegador,
			ie_tipo_obj_master_regiao,
			nr_seq_funcao_schematic,
			nr_seq_apres,
			ie_tipo_componente,
			nr_seq_dic_objeto,
			nm_tabela,
			nr_seq_visao,
			nr_seq_tipo_schematic,
			cd_exp_desc_obj,
			nr_seq_ativacao,
			nr_seq_obj_padrao,
			ie_tipo_obj_button,
			nr_seq_obj_sup_ativ,
			ie_herdar_permissoes,
			ie_popup_handle )
	values (
			nextval('objeto_schematic_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			cd_funcao_p,
			'Cancel',
			'BTN',
			nr_sequencia_w,
			NULL,
			NULL,
			NULL,
			nr_seq_funcao_schematic_p,
			1,
			886,
			NULL,
			NULL,
			NULL,
			NULL,
			302745,
			NULL,
			NULL,
			'CANCEL',
			NULL,
			NULL,
			NULL);

end if;

nr_seq_gerado_p	:= nr_sequencia_w;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE criar_objeto_schematic ( cd_funcao_p bigint, nr_seq_funcao_schematic_p bigint, nr_seq_tipo_schematic_p bigint, ds_objeto_p text, ie_tipo_componente_p text, nr_seq_superior_p bigint, nm_tabela_p text, nr_seq_visao_p bigint, nr_seq_dic_objeto_p bigint, cd_exp_desc_obj_p bigint, nm_usuario_p text, nr_seq_gerado_p INOUT bigint ) FROM PUBLIC;

