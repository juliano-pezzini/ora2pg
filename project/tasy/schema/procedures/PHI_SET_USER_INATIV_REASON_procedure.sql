-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE phi_set_user_inativ_reason ( nr_seq_usuario_grupo_p bigint, ie_motivo_inativacao_p usuario_grupo_des.ie_motivo_inativacao%type, ie_tipo_grupo_p text default null, nm_usuario_p usuario.nm_usuario%type DEFAULT NULL) AS $body$
DECLARE


/*
	++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	Objective: set the reason why the end date were informed.
	------------------------------------------------------------------------
	Direct call: 
	[   ] Dictionary objects
	[ X ] Tasy (Delphi/Java/HTML5)
	[   ] Portal
	[   ] Reports
	[   ] Others:
	 -----------------------------------------------------------------------
	Attention points: Needs to execute BEFORE the function that delete the
	profiles from that user
	------------------------------------------------------------------------
	Parameters:
		IE_TIPO_GRUPO_P: ('D'-Devlopment, 'S'-Support, 'G'-Management)
	++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
*/
BEGIN

if (nr_seq_usuario_grupo_p IS NOT NULL AND nr_seq_usuario_grupo_p::text <> '' AND ie_motivo_inativacao_p IS NOT NULL AND ie_motivo_inativacao_p::text <> '') then
	begin
	
	if (ie_tipo_grupo_p = 'D') then
		begin
		update	usuario_grupo_des
		set	ie_motivo_inativacao = ie_motivo_inativacao_p,
			dt_atualizacao = clock_timestamp(),
			nm_usuario = nm_usuario_p
		where	nr_sequencia = nr_seq_usuario_grupo_p;
		end;
	elsif (ie_tipo_grupo_p = 'S') then
		begin
		update	usuario_grupo_sup
		set	ie_motivo_inativacao = ie_motivo_inativacao_p,
			dt_atualizacao = clock_timestamp(),
			nm_usuario = nm_usuario_p
		where	nr_sequencia = nr_seq_usuario_grupo_p;
		end;
	elsif (ie_tipo_grupo_p = 'G') then
		begin
		update	gerencia_wheb_grupo_usu
		set	ie_motivo_inativacao = ie_motivo_inativacao_p,
			dt_atualizacao = clock_timestamp(),
			nm_usuario = nm_usuario_p
		where	nr_sequencia = nr_seq_usuario_grupo_p;
		end;
	end if;
	
	end;
	
	commit;
--	phi_remove_profiles(nr_seq_usuario_grupo_p, ie_tipo_grupo_p);
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE phi_set_user_inativ_reason ( nr_seq_usuario_grupo_p bigint, ie_motivo_inativacao_p usuario_grupo_des.ie_motivo_inativacao%type, ie_tipo_grupo_p text default null, nm_usuario_p usuario.nm_usuario%type DEFAULT NULL) FROM PUBLIC;

