-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gravar_log_med_result_exame (nr_seq_cliente_p bigint, dt_exame_p text, nm_usuario_p text) AS $body$
DECLARE


nr_sequencia_w bigint;
nr_atendimento_w  bigint;
nr_seq_exame_w  bigint;


BEGIN



select	coalesce(max(nr_sequencia),0),
		coalesce(max(nr_atendimento),0),
		coalesce(max(nr_seq_exame),0)
into STRICT	nr_sequencia_w,
		nr_atendimento_w,
		nr_seq_exame_w
from	med_result_exame
where	nr_seq_cliente = nr_seq_cliente_p
and		dt_exame =  to_date(dt_exame_p,'dd/mm/yyyy');

if (nr_sequencia_w > 0) then

	CALL gravar_log_exclusao('MED_RESULT_EXAME', nm_usuario_p,
						'NR_SEQUENCIA= '||nr_sequencia_w  ||' ' ||
						', NR_ATENDIMENTO='||nr_atendimento_w||' ' ||
						', NR_SEQ_EXAME= '||nr_seq_exame_w  ||' ' ||
						', DT_EXAME='	||to_date(dt_exame_p,'dd/mm/yyyy'),'S');
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gravar_log_med_result_exame (nr_seq_cliente_p bigint, dt_exame_p text, nm_usuario_p text) FROM PUBLIC;

