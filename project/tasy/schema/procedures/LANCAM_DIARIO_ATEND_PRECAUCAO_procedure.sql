-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE lancam_diario_atend_precaucao ( nm_usuario_p text ) AS $body$
DECLARE


c01 CURSOR FOR
  SELECT  a.nr_atendimento,
    b.nr_seq_precaucao,
    b.nr_seq_motivo_isol
  from    atendimento_paciente a,
          atendimento_precaucao b
  where   a.nr_atendimento = b.nr_atendimento
  and     coalesce(a.dt_alta::text, '') = ''
  and     (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '')
  and (coalesce(b.dt_termino::text, '') = '' or b.dt_termino > clock_timestamp())
  and     coalesce(b.dt_inativacao::text, '') = ''
  and     coalesce(b.dt_final_precaucao::text, '') = ''
  and     coalesce(a.dt_fim_conta::text, '') = '';

BEGIN

for r_c01_w in c01 loop
  CALL gerar_lancamento_automatico(r_c01_w.nr_atendimento, null, 623, nm_usuario_p, null, r_c01_w.nr_seq_precaucao, r_c01_w.nr_seq_motivo_isol, null, null, null);
end loop;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE lancam_diario_atend_precaucao ( nm_usuario_p text ) FROM PUBLIC;

