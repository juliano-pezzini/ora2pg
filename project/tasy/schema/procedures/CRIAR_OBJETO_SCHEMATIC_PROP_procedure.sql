-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE criar_objeto_schematic_prop (nr_seq_objeto_p bigint, nr_seq_legenda_p bigint, nm_usuario_p text, qt_max_registro_p bigint, ie_multiselect_p text, ie_somente_detalhe_p text, ie_ativar_detalhe_p text, ie_ativar_vazio_p text, ie_grid_edit_p text, ie_primeiro_registro_p text, nm_atrib_locate_p text, ie_readonly_p text, ie_posicao_tela_p text, qt_largura_p bigint, qt_altura_p bigint) AS $body$
DECLARE


    nr_sequencia_prop_w  bigint;
    ie_existe_legenda_w  varchar(1) := 'N';
    ie_habilita_modal_w  varchar(1);
    ie_responsivo_w      varchar(1) := 'N';
    ie_tipo_componente_w varchar(50);
    qt_altura_w          bigint := qt_altura_p;
    nr_sequencia_rem_w   bigint;


BEGIN
    if (nr_seq_objeto_p IS NOT NULL AND nr_seq_objeto_p::text <> '') and (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') then
        begin

            select max(ie_tipo_componente)
              into STRICT ie_tipo_componente_w
              from objeto_schematic
             where nr_sequencia = nr_seq_objeto_p;

            if (ie_tipo_componente_w = 'WDLG') then
                ie_habilita_modal_w := 'S';

                if (qt_altura_w IS NOT NULL AND qt_altura_w::text <> '') and (qt_altura_w < 250) then
                    qt_altura_w := 250;
                end if;

            elsif (ie_tipo_componente_w = 'WDBP') then
                ie_responsivo_w := 'S';
            end if;

            $if $$tasy_local_dict=true $then
            nr_sequencia_prop_w := get_remote_sequence('seq:objeto_schematic_prop_seq');
            $else
            select nextval('objeto_schematic_prop_seq') into STRICT nr_sequencia_prop_w;
            $end

            insert into objeto_schematic_prop(nr_sequencia,
                 dt_atualizacao,
                 nm_usuario,
                 dt_atualizacao_nrec,
                 nm_usuario_nrec,
                 nr_seq_objeto,
                 qt_max_registro,
                 ie_multiselect,
                 ie_somente_detalhe,
                 ie_ativar_detalhe,
                 ie_ativar_vazio,
                 ie_grid_edit,
                 ie_primeiro_registro,
                 nm_atrib_locate,
                 ie_readonly,
                 ie_posicao_tela,
                 qt_largura,
                 qt_altura,
                 ie_habilita_modal,
                 ie_responsivo)
            values (nr_sequencia_prop_w,
                 clock_timestamp(),
                 nm_usuario_p,
                 clock_timestamp(),
                 nm_usuario_p,
                 nr_seq_objeto_p,
                 qt_max_registro_p,
                 ie_multiselect_p,
                 ie_somente_detalhe_p,
                 ie_ativar_detalhe_p,
                 ie_ativar_vazio_p,
                 ie_grid_edit_p,
                 ie_primeiro_registro_p,
                 nm_atrib_locate_p,
                 ie_readonly_p,
                 ie_posicao_tela_p,
                 qt_largura_p,
                 qt_altura_w,
                 ie_habilita_modal_w,
                 ie_responsivo_w);

            commit;

            if (nr_seq_legenda_p IS NOT NULL AND nr_seq_legenda_p::text <> '') then
                begin
                    select CASE WHEN count(*)=0 THEN  'N'  ELSE 'S' END 
                      into STRICT ie_existe_legenda_w
                      from tasy_legenda
                     where nr_sequencia = nr_seq_legenda_p;

                    if (ie_existe_legenda_w = 'S') then
                        begin
                            $if $$tasy_local_dict=true $then
                            nr_sequencia_rem_w := get_remote_sequence('seq:objeto_schematic_legenda_seq');
                            $else
                            select nextval('objeto_schematic_legenda_seq') into STRICT nr_sequencia_rem_w;
                            $end

                            insert into objeto_schematic_legenda(nr_sequencia,
                                 nr_seq_objeto,
                                 ie_aplicacao,
                                 dt_atualizacao,
                                 nm_usuario,
                                 dt_atualizacao_nrec,
                                 nm_usuario_nrec,
                                 nr_seq_apres,
                                 nr_seq_dic_objeto,
                                 nr_seq_legenda,
                                 nm_atributo,
                                 ie_forma_apres,
                                 nm_atributo_cor,
                                 ie_situacao,
                                 nm_atributo_chave)
                            values (nr_sequencia_rem_w, --objeto_schematic_legenda_seq.nextval,
                                 nr_seq_objeto_p,
                                 'L',
                                 clock_timestamp(),
                                 nm_usuario_p,
                                 clock_timestamp(),
                                 nm_usuario_p,
                                 1,
                                 null,
                                 nr_seq_legenda_p,
                                 null,
                                 'STA',
                                 null,
                                 'S',
                                 null);
                            commit;
                        end;
                    end if;
                end;
            end if;
        end;
    end if;
    commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE criar_objeto_schematic_prop (nr_seq_objeto_p bigint, nr_seq_legenda_p bigint, nm_usuario_p text, qt_max_registro_p bigint, ie_multiselect_p text, ie_somente_detalhe_p text, ie_ativar_detalhe_p text, ie_ativar_vazio_p text, ie_grid_edit_p text, ie_primeiro_registro_p text, nm_atrib_locate_p text, ie_readonly_p text, ie_posicao_tela_p text, qt_largura_p bigint, qt_altura_p bigint) FROM PUBLIC;

