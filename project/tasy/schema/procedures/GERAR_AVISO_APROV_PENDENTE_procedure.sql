-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_aviso_aprov_pendente ( cd_pessoa_fisica_p text, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
qt_existe_w			bigint;


BEGIN 
 
select	count(*) 
into STRICT	qt_existe_w 
from	valor_dominio b, 
	usuario_aviso a 
where 	((a.nm_usuario_aviso = nm_usuario_p) or (obter_se_perfil_usuario(a.cd_perfil, nm_usuario_p) = 'S') or 
	 ((coalesce(a.cd_perfil::text, '') = '') and (coalesce(a.nm_usuario_aviso::text, '') = '')))  
and 	b.vl_dominio	= a.cd_aviso 
and 	b.cd_dominio = 2412 
and 	a.cd_aviso <> 'CI';
 
if (qt_existe_w > 0) then 
	 
	CALL gerar_aprovacoes_pendentes( 
			cd_pessoa_fisica_p, 
			cd_estabelecimento_p, 
			nm_usuario_p);
 
end if;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_aviso_aprov_pendente ( cd_pessoa_fisica_p text, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

