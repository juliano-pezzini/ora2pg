-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE grava_prescr_nao_copiados ( nr_prescricao_p bigint, nr_prescricao_orig_p bigint, nr_sequencia_orig_p bigint, cd_material_p bigint, ie_situacao_p text, ie_suspenso_p text, ie_prescricao_p text, ie_disponivel_mercado_p text default 'S', ie_copiar_p text default 'S') AS $body$
DECLARE


ie_motivo_w			varchar(255);


BEGIN

if (nr_prescricao_p IS NOT NULL AND nr_prescricao_p::text <> '') and (nr_prescricao_orig_p IS NOT NULL AND nr_prescricao_orig_p::text <> '') and (cd_material_p IS NOT NULL AND cd_material_p::text <> '') then

	-- Domínio 5534
	ie_motivo_w		:= wheb_mensagem_pck.get_texto(307949); -- Outros
	if (ie_situacao_p = 'I') then
		ie_motivo_w		:= wheb_mensagem_pck.get_texto(307950); -- Inativado
	elsif (ie_prescricao_p = 'N') then
		ie_motivo_w		:= wheb_mensagem_pck.get_texto(307951); -- Não pode ser prescrito
	elsif (ie_suspenso_p = 'S') then
		ie_motivo_w		:= wheb_mensagem_pck.get_texto(307952); -- Suspenso
	elsif (ie_disponivel_mercado_p = 'N') then
		ie_motivo_w		:= wheb_mensagem_pck.get_texto(150666); -- Este material não está disponível no mercado.
    	elsif (ie_copiar_p = 'N') then
		ie_motivo_w		:= wheb_mensagem_pck.get_texto(407316); -- Regra cópia prescrição.
	end if;

	insert into w_prescr_mat_nao_copia(
			nr_prescricao,
			nr_sequencia,
			nr_prescricao_origem,
			nr_sequencia_origem,
			cd_material,
			ie_motivo)
	values (
			nr_prescricao_p,
			null,
			nr_prescricao_orig_p,
			nr_sequencia_orig_p,
			cd_material_p,
			ie_motivo_w);

end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE grava_prescr_nao_copiados ( nr_prescricao_p bigint, nr_prescricao_orig_p bigint, nr_sequencia_orig_p bigint, cd_material_p bigint, ie_situacao_p text, ie_suspenso_p text, ie_prescricao_p text, ie_disponivel_mercado_p text default 'S', ie_copiar_p text default 'S') FROM PUBLIC;

