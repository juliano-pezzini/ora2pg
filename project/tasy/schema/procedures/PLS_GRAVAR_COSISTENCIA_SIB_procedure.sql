-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gravar_cosistencia_sib ( nr_seq_segurado_p bigint, cd_beneficiario_p text, nr_seq_lote_sib_p bigint, nr_seq_contrato_p bigint, nr_seq_proposta_p bigint, ds_observacao_p text, nm_usuario_p text, cd_inconsistencia_p bigint, ie_origem_consistencia_p text) AS $body$
DECLARE


nr_seq_inconsistencia_w		bigint	:= null;
ds_inconsistencia_w		varchar(255)	:= '';
ie_situacao_w			varchar(2)	:= null;
nr_seq_lote_inconsistencia_w	bigint;
ie_consistir_rescisao_w		varchar(10);
ie_tipo_reg_w			varchar(10);
ie_consiste_w			varchar(10);


BEGIN

ie_consiste_w	:= 'S';

begin
select	nr_sequencia,
	ds_inconsistencia,
	ie_situacao,
	coalesce(ie_consistir_rescisao,'S')
into STRICT	nr_seq_inconsistencia_w,
	ds_inconsistencia_w,
	ie_situacao_w,
	ie_consistir_rescisao_w
from	sib_inconsistencia
where	cd_inconsistencia	= cd_inconsistencia_p;
exception
when others then
	ds_inconsistencia_w	:= '';
end;

/*aaschlote 07/12/2011 OS - 389115*/

if (ie_origem_consistencia_p = 'B') then
	begin
	select	ie_tipo_reg
	into STRICT	ie_tipo_reg_w
	from	pls_interf_sib
	where	nr_seq_lote_sib	= nr_seq_lote_sib_p
	and	nr_seq_segurado	= nr_seq_segurado_p;
	exception
	when others then
		ie_tipo_reg_w	:= 1;
	end;

	if (ie_consistir_rescisao_w = 'N') and (ie_tipo_reg_w = 7) then
		ie_consiste_w	:= 'N';
	end if;
end if;

if (ie_situacao_w = 'A') and (ie_consiste_w = 'S') then

	select	nextval('pls_lote_consistencia_sib_seq')
	into STRICT	nr_seq_lote_inconsistencia_w
	;

	insert into pls_lote_consistencia_sib(nr_sequencia, ds_consistencia, dt_atualizacao,
		nm_usuario, dt_atualizacao_nrec,nm_usuario_nrec,
		nr_seq_lote_sib, nr_seq_segurado, nr_seq_contrato,
		nr_seq_proposta, cd_beneficiario, nr_seq_inconsistencia,
		ie_origem_consistencia)
	values (nr_seq_lote_inconsistencia_w, ds_inconsistencia_w, clock_timestamp(),
		nm_usuario_p, clock_timestamp(), nm_usuario_p,
		nr_seq_lote_sib_p, nr_seq_segurado_p, nr_seq_contrato_p,
		nr_seq_proposta_p, cd_beneficiario_p, nr_seq_inconsistencia_w,
		ie_origem_consistencia_p);
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gravar_cosistencia_sib ( nr_seq_segurado_p bigint, cd_beneficiario_p text, nr_seq_lote_sib_p bigint, nr_seq_contrato_p bigint, nr_seq_proposta_p bigint, ds_observacao_p text, nm_usuario_p text, cd_inconsistencia_p bigint, ie_origem_consistencia_p text) FROM PUBLIC;

