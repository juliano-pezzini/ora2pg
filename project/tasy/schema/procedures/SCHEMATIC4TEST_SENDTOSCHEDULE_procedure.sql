-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE schematic4test_sendtoschedule (NR_SEQ_SUITE_P bigint, NR_SEQ_URL_P bigint) AS $body$
DECLARE

NR_SEQUENCIA_W bigint;
NR_SEQ_PRESET_W bigint;
NR_SEQ_URL_W bigint;
NR_SEQ_BROWSER_W bigint;
NR_SEQ_SERVICE_W bigint;
NR_SEQ_ROBOT_W bigint;
NR_SEQ_GRID_W bigint;
NR_SEQ_URL_W2 bigint;
QTD_W bigint;


BEGIN
  --procedure that schedule suitte to run by hour
  SELECT COUNT(suite.NR_SEQ_PRESET) NR_SEQ_PRESET
      INTO STRICT QTD_W 
  FROM SCHEM_TEST_SUITE suite 
  WHERE suite.NR_SEQUENCIA = NR_SEQ_SUITE_P 
  AND (suite.NR_SEQ_PRESET IS NOT NULL AND suite.NR_SEQ_PRESET::text <> '');

  IF (QTD_W <> 0) THEN
      SELECT suite.NR_SEQ_PRESET NR_SEQ_PRESET
          INTO STRICT NR_SEQ_PRESET_W 
      FROM SCHEM_TEST_SUITE suite 
      WHERE suite.NR_SEQUENCIA = NR_SEQ_SUITE_P 
      AND (suite.NR_SEQ_PRESET IS NOT NULL AND suite.NR_SEQ_PRESET::text <> '');

      SELECT preset.NR_SEQ_URL NR_SEQ_URL, preset.NR_SEQ_BROWSER NR_SEQ_BROWSER, preset.NR_SEQ_SERVICE NR_SEQ_SERVICE,	preset.NR_SEQ_ROBOT NR_SEQ_ROBOT, preset.NR_SEQ_GRID NR_SEQ_GRID
          INTO STRICT NR_SEQ_URL_W, NR_SEQ_BROWSER_W, NR_SEQ_SERVICE_W, NR_SEQ_ROBOT_W, NR_SEQ_GRID_W
			FROM SCHEM_TEST_PRESET preset 
      WHERE preset.NR_SEQUENCIA = NR_SEQ_PRESET_W;
			
	IF (NR_SEQ_URL_P = 0)  THEN
          NR_SEQ_URL_W2 := NR_SEQ_URL_W;
     ELSE
          NR_SEQ_URL_W2 := NR_SEQ_URL_P;
	END IF;

			INSERT INTO SCHEM_TEST_SCHEDULE(nr_sequencia, dt_schedule, ie_status, nm_owner, nr_seq_suite, dt_atualizacao, nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec, nr_seq_url, nr_seq_service, nr_seq_browser, ie_jobs)
            VALUES (nextval('schem_test_schedule_seq'), clock_timestamp(), '1', 'Auto Robot', NR_SEQ_SUITE_P, clock_timestamp(), 'Auto Robot', clock_timestamp(), 'Auto Robot', NR_SEQ_URL_W2, NR_SEQ_SERVICE_W, NR_SEQ_BROWSER_W, '0');
      COMMIT;
    END IF;
  EXCEPTION
  WHEN no_data_found THEN
    RAISE NOTICE 'Erro: Data not found';
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE schematic4test_sendtoschedule (NR_SEQ_SUITE_P bigint, NR_SEQ_URL_P bigint) FROM PUBLIC;

