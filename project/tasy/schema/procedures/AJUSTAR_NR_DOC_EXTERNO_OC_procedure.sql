-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ajustar_nr_doc_externo_oc () AS $body$
DECLARE



data_type_w	user_tab_columns.data_type%type;


BEGIN

select	data_type
into STRICT	data_type_w
from	user_tab_columns
where	table_name = 'ORDEM_COMPRA'
and	column_name = 'NR_DOCUMENTO_EXTERNO';

if (upper(data_type_w) = 'NUMBER') then

	CALL Exec_Sql_Dinamico('Maicon', 'alter table ORDEM_COMPRA add NR_DOCUMENTO_EXTERNO2 NUMBER(10)');


	CALL Exec_Sql_Dinamico('Maicon', 'update ordem_compra set	nr_documento_externo2 = nr_documento_externo, nr_documento_externo = null where	nr_documento_externo is not null');


	CALL Exec_Sql_Dinamico('Maicon', 'alter table ORDEM_COMPRA MODIFY NR_DOCUMENTO_EXTERNO VARCHAR2(40)');


	CALL Exec_Sql_Dinamico('Maicon', 'update ordem_compra set nr_documento_externo = nr_documento_externo2 where	nr_documento_externo2 is not null');


	CALL Exec_Sql_Dinamico('Maicon', 'alter table ORDEM_COMPRA DROP COLUMN NR_DOCUMENTO_EXTERNO2');

end if;

select	data_type
into STRICT	data_type_w
from	user_tab_columns
where	table_name = 'SOLIC_COMPRA'
and	column_name = 'NR_DOCUMENTO_EXTERNO';

if (upper(data_type_w) = 'NUMBER') then

	CALL Exec_Sql_Dinamico('Maicon', 'alter table SOLIC_COMPRA add NR_DOCUMENTO_EXTERNO2 NUMBER(10)');


	CALL Exec_Sql_Dinamico('Maicon', 'update SOLIC_COMPRA set	nr_documento_externo2 = nr_documento_externo, nr_documento_externo = null where	nr_documento_externo is not null');


	CALL Exec_Sql_Dinamico('Maicon', 'alter table SOLIC_COMPRA MODIFY NR_DOCUMENTO_EXTERNO VARCHAR2(40)');


	CALL Exec_Sql_Dinamico('Maicon', 'update SOLIC_COMPRA set nr_documento_externo = nr_documento_externo2 where	nr_documento_externo2 is not null');


	CALL Exec_Sql_Dinamico('Maicon', 'alter table SOLIC_COMPRA DROP COLUMN NR_DOCUMENTO_EXTERNO2');

end if;


commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ajustar_nr_doc_externo_oc () FROM PUBLIC;

