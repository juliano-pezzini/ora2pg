-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_hdm_diagnostico_proced (Acao_P text, seq_HDM_CONTA_CUBO_p bigint, Nm_Usuario_P text Default Null, Cd_Doenca_P text default null, Ie_Origem_P text Default Null, Ds_Procedimento_P text Default Null, Dt_Procedimento_P timestamp Default Null, Qt_Procedimento_P bigint Default Null, Cd_Procedimento_P bigint default null, Ie_Origem_Proced_P text Default Null) AS $body$
DECLARE

Valida_Insercao_W bigint;
sql_errm_w	varchar(255);


BEGIN

If (Acao_P = 'DIAGNOSTICO') Then
	select coalesce(max(nr_sequencia),0)
	into STRICT valida_insercao_W
	from hdm_diagnostico_cubo
	where Nr_Seq_Conta_Cubo = seq_HDM_CONTA_CUBO_p
	and cd_doenca = cd_doenca_p;

        If (Valida_Insercao_W = 0) Then
		begin
                Insert Into Hdm_Diagnostico_Cubo(Nr_Sequencia,
			Ds_Doenca,
			Nr_Seq_Conta_Cubo,
			Nm_Usuario,
			nm_usuario_nrec,
			Cd_Doenca,
			Dt_Atualizacao,
			Dt_Atualizacao_nrec,
			Ie_Origem)
                Values (nextval('hdm_diagnostico_cubo_seq'),
			Obter_Desc_CID_Doenca(cd_doenca_p),
			Seq_Hdm_Conta_Cubo_P,
			Nm_Usuario_P,
			Nm_Usuario_P,
			Cd_Doenca_P,
			clock_timestamp(),
			clock_timestamp(),
			Ie_Origem_P);

		Exception
		When Others Then
		Sql_Errm_W	:= Sqlerrm;

		Insert Into Hdm_Log_Integracao(Nr_Sequencia,
			Dt_Atualizacao,
			Nm_Usuario,
			Dt_Atualizacao_Nrec,
			Nm_Usuario_Nrec,
			Ie_Tipo_Log,
			Ds_Titulo,
			Ds_Log_Hdm)
		Values (nextval('hdm_log_integracao_seq'),
			clock_timestamp(),
			Nm_Usuario_P,
			clock_timestamp(),
			Nm_Usuario_P,
			'I',
			'Inserir HDM_DIAGNOSTICO_CUBO (Diagnostico)',
			Sql_Errm_W);
		end;
        end if;

elsif (Acao_P = 'PROCEDIMENTO') Then

	select coalesce(max(nr_sequencia),0)
        Into STRICT Valida_Insercao_W
        From Hdm_Conta_Proc_Cubo
        Where Nr_Seq_Conta_Cubo = seq_HDM_CONTA_CUBO_p
        and cd_procedimento = cd_procedimento_p
        and ie_origem_proced = ie_origem_proced_p;

        if (valida_insercao_w = 0) then
		Begin
		Insert Into Hdm_Conta_Proc_Cubo(Nr_Sequencia,
			Ds_Procedimento,
			Dt_Atualizacao,
			Dt_Atualizacao_nrec,
			Dt_Procedimento,
			Qt_Procedimento,
			Nm_Usuario,
			Nm_Usuario_nrec,
			Nr_Seq_Conta_Cubo,
			Cd_Procedimento,
			Ie_Origem_Proced,
			Ie_Origem)
		values (nextval('hdm_conta_proc_cubo_seq'),
			DS_PROCEDIMENTO_p,
			clock_timestamp(),
			clock_timestamp(),
			DT_PROCEDIMENTO_p,
			Qt_Procedimento_P,
			NM_USUARIO_p,
			nm_usuario_p,
			Seq_Hdm_Conta_Cubo_P,
			Cd_Procedimento_P,
			Ie_Origem_Proced_p,
			IE_ORIGEM_p);

		Exception
		When Others Then
		Sql_Errm_W	:= Sqlerrm;
		Insert Into Hdm_Log_Integracao(Nr_Sequencia,
			Dt_Atualizacao,
			Nm_Usuario,
			Dt_Atualizacao_Nrec,
			Nm_Usuario_Nrec,
			Ie_Tipo_Log,
			Ds_Titulo,
			Ds_Log_Hdm)
		Values (nextval('hdm_log_integracao_seq'),
			clock_timestamp(),
			Nm_Usuario_P,
			clock_timestamp(),
			Nm_Usuario_P,
			'I',
			'Inserir HDM_CONTA_PROC_CUBO (Procedimento)',
			Sql_Errm_W);
		end;
	end if;
End If;
End;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_hdm_diagnostico_proced (Acao_P text, seq_HDM_CONTA_CUBO_p bigint, Nm_Usuario_P text Default Null, Cd_Doenca_P text default null, Ie_Origem_P text Default Null, Ds_Procedimento_P text Default Null, Dt_Procedimento_P timestamp Default Null, Qt_Procedimento_P bigint Default Null, Cd_Procedimento_P bigint default null, Ie_Origem_Proced_P text Default Null) FROM PUBLIC;

