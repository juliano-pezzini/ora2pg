-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inst_master_data_birth ( cd_estabelecimento_p bigint, nm_usuario_p master_data_birth.nm_usuario%type, nm_usuario_nrec_p master_data_birth.nm_usuario_nrec%type ) AS $body$
DECLARE

  ds_street_name master_data_birth.ds_street_name%type;
  nr_street_number master_data_birth.nr_street_number%type;
  ds_locality master_data_birth.ds_locality%type;
  cd_postal_code master_data_birth.cd_postal_code%type;
  ds_city master_data_birth.ds_city%type;
  cd_community_code master_data_birth.cd_community_code%type;
  ds_state master_data_birth.ds_state%type;
  ds_country master_data_birth.ds_country%type;
  cd_country_code master_data_birth.cd_country_code%type;
  count_p bigint;

BEGIN
  SELECT COUNT(1)
  INTO STRICT count_p
  FROM master_data_birth
  WHERE cd_estabelecimento = cd_estabelecimento_p;
  IF (count_p               = 0)THEN
    SELECT obter_dados_pf_pj(NULL, obter_cnpj_estabelecimento(cd_estabelecimento_p),'R'),
      obter_dados_pf_pj(NULL, obter_cnpj_estabelecimento(cd_estabelecimento_p),'NR'),
      obter_dados_pf_pj(NULL, obter_cnpj_estabelecimento(cd_estabelecimento_p),'B'),
      obter_dados_pf_pj(NULL, obter_cnpj_estabelecimento(cd_estabelecimento_p),'CEP'),
      obter_dados_pf_pj(NULL, obter_cnpj_estabelecimento(cd_estabelecimento_p),'CI'),
      obter_dados_pf_pj(NULL, obter_cnpj_estabelecimento(cd_estabelecimento_p),'UF'),
      obter_dados_pf_pj(NULL, obter_cnpj_estabelecimento(cd_estabelecimento_p),'DS_UF'),
      obter_dados_pf_pj(NULL, obter_cnpj_estabelecimento(cd_estabelecimento_p),'PAIS'),
      obter_dados_pf_pj(NULL, obter_cnpj_estabelecimento(cd_estabelecimento_p),'P')
    INTO STRICT ds_street_name,
      nr_street_number,
      ds_locality,
      cd_postal_code,
      ds_city,
      cd_community_code,
      ds_state,
      ds_country,
      cd_country_code
;
    INSERT
    INTO master_data_birth(
        nr_sequencia,
        dt_atualizacao ,
        nm_usuario,
        dt_atualizacao_nrec,
        nm_usuario_nrec,
        ds_street_name,
        nr_street_number,
        ds_locality,
        cd_postal_code,
        ds_city,
        cd_community_code,
        ds_state,
        ds_country,
        cd_country_code,
        cd_estabelecimento
      )
      VALUES (
        nextval('master_data_birth_seq'),
        clock_timestamp(),
        nm_usuario_p,
        clock_timestamp(),
        nm_usuario_nrec_p,
        ds_street_name,
        nr_street_number,
        ds_locality,
        cd_postal_code,
        ds_city,
        cd_community_code,
        ds_state,
        ds_country,
        cd_country_code,
        cd_estabelecimento_p
      );
  END IF;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inst_master_data_birth ( cd_estabelecimento_p bigint, nm_usuario_p master_data_birth.nm_usuario%type, nm_usuario_nrec_p master_data_birth.nm_usuario_nrec%type ) FROM PUBLIC;

