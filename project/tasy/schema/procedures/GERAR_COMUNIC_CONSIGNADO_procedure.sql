-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_comunic_consignado ( nm_usuario_p text, nm_usuario_dest_p text, ds_mensagem_p text, ds_perfil_adicional_p text) AS $body$
DECLARE


nr_seq_comunicacao_w 	bigint;
nm_usuario_destino_w	varchar(15);
cd_perfil_comunic_w	varchar(10);


BEGIN

if (coalesce(ds_perfil_adicional_p,0) > 0) then
	cd_perfil_comunic_w := substr(ds_perfil_adicional_p || ',',1,10);
end if;

if (nm_usuario_dest_p IS NOT NULL AND nm_usuario_dest_p::text <> '') or (coalesce(ds_perfil_adicional_p,0) > 0) then
 	begin

	select nextval('comunic_interna_seq')
 	into STRICT nr_seq_comunicacao_w
 	;

	insert into comunic_interna(dt_comunicado,
  				ds_titulo,
				ds_comunicado,
  				nm_usuario,
  				dt_atualizacao,
  				ie_geral,
  				nm_usuario_destino,
  				cd_perfil,
  				nr_sequencia,
  				ie_gerencial,
  				nr_seq_classif,
  				ds_perfil_adicional,
  				cd_setor_destino,
  				cd_estab_destino,
  				ds_setor_adicional,
  				dt_liberacao)
	values (clock_timestamp(),
  				wheb_mensagem_pck.get_Texto(311898), /*'Consumo de item consignado',*/
  				ds_mensagem_p,
  				nm_usuario_p,
  				clock_timestamp(),
  				'N',
  				nm_usuario_dest_p,
  				null,
  				nr_seq_comunicacao_w,
  				'N', null, cd_perfil_comunic_w, null, null, null, clock_timestamp());
  	end;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_comunic_consignado ( nm_usuario_p text, nm_usuario_dest_p text, ds_mensagem_p text, ds_perfil_adicional_p text) FROM PUBLIC;

