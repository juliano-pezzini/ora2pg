-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ehr_aprovar_sug_elem (nr_sequencia_p bigint, nm_usuario_p text) AS $body$
DECLARE


    nr_seq_elemento_w  bigint;
    nr_sequencia_rem_w bigint;

    c01 CURSOR FOR
        SELECT * from ehr_sugestao_elemento where nr_sequencia = nr_sequencia_p;
  r RECORD;

BEGIN

    for c01_w in c01 loop

        $if $$tasy_local_dict=true $then
        nr_seq_elemento_w := get_remote_sequence('seq:ehr_elemento_seq');
        $else
        select nextval('ehr_elemento_seq') into STRICT nr_seq_elemento_w;
        $end

        insert into ehr_elemento(nr_sequencia,
             dt_atualizacao,
             nm_usuario,
             dt_atualizacao_nrec,
             nm_usuario_nrec,
             nr_seq_apres,
             nr_seq_tipo_dado,
             ie_tipo,
             nm_elemento,
             ds_elemento,
             ie_componente,
             qt_tam_tela,
             qt_tam_grid,
             ds_label_tela,
             ds_label_grid,
             qt_altura,
             ie_origem_inf,
             vl_minimo,
             nr_seq_grupo,
             vl_maximo,
             qt_max_dec,
             dt_liberacao,
             nr_seq_entidade,
             ds_palavra_chave,
             nr_seq_cefalocaudal,
             nr_seq_subgrupo,
             ie_cliente_cadastra,
             ds_elemento_ehr)
        values (nr_seq_elemento_w,
             clock_timestamp(),
             nm_usuario_p,
             clock_timestamp(),
             nm_usuario_p,
             c01_w.nr_seq_apres,
             c01_w.nr_seq_tipo_dado,
             c01_w.ie_tipo,
             c01_w.nm_elemento,
             ' ',
             c01_w.ie_componente,
             c01_w.qt_tam_tela,
             c01_w.qt_tam_grid,
             c01_w.ds_label_tela,
             c01_w.ds_label_grid,
             c01_w.qt_altura,
             c01_w.ie_origem_inf,
             c01_w.vl_minimo,
             c01_w.nr_seq_grupo,
             c01_w.vl_maximo,
             c01_w.qt_max_dec,
             null,
             c01_w.nr_seq_entidade,
             c01_w.ds_palavra_chave,
             c01_w.nr_seq_cefalocaudal,
             c01_w.nr_seq_subgrupo,
             c01_w.ie_cliente_cadastra,
             c01_w.ds_elemento);

        for r in (SELECT nr_seq_apres,
                         cd_resultado,
                         ds_resultado,
                         vl_resultado
                    from ehr_sugestao_result
                   where nr_seq_sugestao = c01_w.nr_sequencia) loop
        
            $if $$tasy_local_dict=true $then
            nr_sequencia_rem_w := get_remote_sequence('seq:ehr_elemento_result_seq');
            $else
            select nextval('ehr_elemento_result_seq') into STRICT nr_sequencia_rem_w;
            $end

            insert into ehr_elemento_result(nr_sequencia,
                 nr_seq_elemento,
                 dt_atualizacao,
                 nm_usuario,
                 dt_atualizacao_nrec,
                 nm_usuario_nrec,
                 nr_seq_apres,
                 cd_resultado,
                 ds_resultado,
                 vl_resultado)
            values (nr_sequencia_rem_w, --ehr_elemento_result_seq.nextval,
                 nr_seq_elemento_w,
                 clock_timestamp(),
                 nm_usuario_p,
                 clock_timestamp(),
                 nm_usuario_p,
                 r.nr_seq_apres,
                 r.cd_resultado,
                 r.ds_resultado,
                 r.vl_resultado);
        end loop;

    end loop;

    update ehr_sugestao_elemento
       set dt_aprovacao         = clock_timestamp(),
           nm_usuario_aprovacao = nm_usuario_p
     where nr_sequencia = nr_sequencia_p;

    commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ehr_aprovar_sug_elem (nr_sequencia_p bigint, nm_usuario_p text) FROM PUBLIC;

