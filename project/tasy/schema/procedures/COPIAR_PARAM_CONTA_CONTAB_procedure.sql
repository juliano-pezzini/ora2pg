-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copiar_param_conta_contab ( cd_estabelecimento_p bigint, cd_sequencia_parametro_p bigint, nm_usuario_p text) AS $body$
DECLARE


cd_empresa_w				integer;
cd_estabelecimento_w			integer;
ds_observacao_w				varchar(255);
nm_estab_origem_w			varchar(80);
dt_atualizacao_w				varchar(110);

c01 CURSOR FOR
SELECT	cd_estabelecimento
from	estabelecimento
where	ie_situacao		= 'A'
and	cd_empresa		= cd_empresa_w
and	cd_estabelecimento	<> cd_estabelecimento_p
order by 1;


BEGIN

cd_empresa_w		:= obter_empresa_estab(cd_estabelecimento_p);
dt_atualizacao_w	:= to_char(clock_timestamp(),'dd/mm/yyyy hh24:mi:ss');
nm_estab_origem_w	:= substr(obter_nome_estabelecimento(cd_estabelecimento_p),1,80);

ds_observacao_w		:= substr(wheb_mensagem_pck.get_texto(298058, 'DT_ATUALIZACAO_W=' || dt_atualizacao_w || ';NM_USUARIO_P=' || nm_usuario_p || ';NM_ESTAB_ORIGEM_W=' || nm_estab_origem_w),1,255);

open C01;
loop
fetch C01 into
	cd_estabelecimento_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin

	insert into parametros_conta_contabil(
		cd_sequencia_parametro,
		cd_estabelecimento,
		cd_conta_receita,
		cd_conta_estoque,
		cd_conta_passag_direta,
		cd_grupo_material,
		cd_subgrupo_material,
		cd_classe_material,
		cd_material,
		cd_area_proced,
		cd_especial_proced,
		cd_grupo_proced,
		cd_procedimento,
		nm_usuario,
		dt_atualizacao,
		ie_origem_proced,
		cd_conta_despesa,
		cd_setor_atendimento,
		ie_tipo_atendimento,
		ie_classif_convenio,
		cd_convenio,
		ie_clinica,
		cd_local_estoque,
		cd_operacao_estoque,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		cd_centro_custo,
		dt_inicio_vigencia,
		dt_fim_vigencia,
		nr_seq_grupo,
		nr_seq_subgrupo,
		nr_seq_forma_org,
		ds_observacao,
		cd_categoria_convenio,
		ie_tipo_convenio,
		cd_plano,
		cd_empresa,
		nr_seq_motivo_solic,
		cd_conta_redut_receita,
		cd_conta_gratuidade,
		ie_complexidade_sus,
		ie_tipo_financ_sus,
		cd_centro_custo_receita,
		cd_conta_rec_pacote,
		ie_tipo_centro,
		ie_tipo_tributo_item,
		cd_conta_ajuste_prod,
		cd_historico,
		cd_conta_desp_pre_fatur,
		nr_seq_regra_valor)
	SELECT	nextval('parametros_conta_contabil_seq'),
		cd_estabelecimento_w,
		cd_conta_receita,
		cd_conta_estoque,
		cd_conta_passag_direta,
		cd_grupo_material,
		cd_subgrupo_material,
		cd_classe_material,
		cd_material,
		cd_area_proced,
		cd_especial_proced,
		cd_grupo_proced,
		cd_procedimento,
		nm_usuario_p,
		clock_timestamp(),
		ie_origem_proced,
		cd_conta_despesa,
		cd_setor_atendimento,
		ie_tipo_atendimento,
		ie_classif_convenio,
		cd_convenio,
		ie_clinica,
		cd_local_estoque,
		cd_operacao_estoque,
		clock_timestamp(),
		nm_usuario_p,
		cd_centro_custo,
		dt_inicio_vigencia,
		dt_fim_vigencia,
		nr_seq_grupo,
		nr_seq_subgrupo,
		nr_seq_forma_org,
		substr(ds_observacao_w || chr(13) || chr(10) || ds_observacao,1,255),
		cd_categoria_convenio,
		ie_tipo_convenio,
		cd_plano,
		cd_empresa,
		nr_seq_motivo_solic,
		cd_conta_redut_receita,
		cd_conta_gratuidade,
		ie_complexidade_sus,
		ie_tipo_financ_sus,
		cd_centro_custo_receita,
		cd_conta_rec_pacote,
		ie_tipo_centro,
		ie_tipo_tributo_item,
		cd_conta_ajuste_prod,
		cd_historico,
		cd_conta_desp_pre_fatur,
		nr_seq_regra_valor
	from	parametros_conta_contabil
	where	cd_sequencia_parametro	= cd_sequencia_parametro_p;

	end;
end loop;
close C01;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copiar_param_conta_contab ( cd_estabelecimento_p bigint, cd_sequencia_parametro_p bigint, nm_usuario_p text) FROM PUBLIC;

