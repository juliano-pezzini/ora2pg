-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_avalicao_nivel ( nr_seq_nivel_p bigint, cd_consultor_p bigint, dt_mud_nivel_p timestamp) AS $body$
DECLARE


nr_sequencia_w			bigint;
nr_seq_modelo_w 		bigint;
ie_regime_contr_w		varchar(15);
nr_seq_nivel_consultor_w	bigint;
ie_funcao_exec_w		varchar(15);
ie_complexidade_w		varchar(15);
nr_seq_proj_w			bigint;
nr_seq_cliente_w		bigint;
dt_inicio_validade_w		timestamp;
dt_avaliacao_w			timestamp;
qt_ponto_w			bigint;
dt_aprovacao_w			timestamp;
nm_usuario_aprov_w		varchar(255);
nm_usuario_w			varchar(255);
vl_hora_w			double precision;
cd_empresa_w			bigint;



BEGIN

SELECT     nr_sequencia,
	   nr_seq_modelo,
	   ie_regime_contr,
	   nr_seq_nivel_consultor,
	   ie_funcao_exec,
	   ie_complexidade,
	   nr_seq_proj,
	   nr_seq_cliente,
	   dt_inicio_validade,
	   dt_avaliacao,
	   qt_ponto,
	   dt_aprovacao,
	   nm_usuario_aprov,
	   nm_usuario,
	   vl_hora,
	   cd_empresa
into STRICT	   nr_sequencia_w,
	   nr_seq_modelo_w,
	   ie_regime_contr_w,
	   nr_seq_nivel_consultor_w,
	   ie_funcao_exec_w,
	   ie_complexidade_w,
	   nr_seq_proj_w,
	   nr_seq_cliente_w,
 	   dt_inicio_validade_w,
	   dt_avaliacao_w,
 	   qt_ponto_w,
	   dt_aprovacao_w,
	   nm_usuario_aprov_w,
	   nm_usuario_w,
	   vl_hora_w,
           cd_empresa_w
FROM   	   proj_consultor_aval a
WHERE      cd_consultor = cd_consultor_p
AND	   nr_sequencia = (SELECT MAX(nr_sequencia)
	   		   FROM 	  proj_consultor_aval x
			  WHERE	  a.cd_consultor = x.cd_consultor);


	begin

	insert into	proj_consultor_aval(nr_sequencia,
						nr_seq_modelo,
	   					ie_regime_contr,
	   					nr_seq_nivel_consultor,
	  					ie_funcao_exec,
	   					ie_complexidade,
	   					nr_seq_proj,
	  					nr_seq_cliente,
	  					dt_inicio_validade,
	  					dt_avaliacao,
	   					qt_ponto,
	   					dt_aprovacao,
	   					nm_usuario_aprov,
						cd_consultor,
						dt_atualizacao,
						nm_usuario,
						vl_hora,
						cd_empresa
						)
					values (nextval('proj_consultor_aval_seq'),
						nr_seq_modelo_w,
	   					ie_regime_contr_w,
	   					nr_seq_nivel_p,
	   					ie_funcao_exec_w,
	   					ie_complexidade_w,
	   					nr_seq_proj_w,
	   					nr_seq_cliente_w,
	   					dt_inicio_validade_w,
						dt_mud_nivel_p,
	   					qt_ponto_w,
	  					dt_aprovacao_w,
	   					nm_usuario_aprov_w,
						cd_consultor_p,
						clock_timestamp(),
						nm_usuario_w,
						vl_hora_w,
						cd_empresa_w);
	commit;
	end;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_avalicao_nivel ( nr_seq_nivel_p bigint, cd_consultor_p bigint, dt_mud_nivel_p timestamp) FROM PUBLIC;

