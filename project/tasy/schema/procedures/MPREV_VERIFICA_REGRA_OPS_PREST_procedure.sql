-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE mprev_verifica_regra_ops_prest ( nr_sequencia_p bigint, ie_opcao_p text, ds_retorno_p INOUT bigint) AS $body$
DECLARE


nr_seq_regra_cubo_w     mprev_regra_cubo.nr_sequencia%type;
ds_retorno_w		bigint := 0;


BEGIN
	if (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '') then

		select	max(b.nr_sequencia)
		into STRICT	nr_seq_regra_cubo_w
		from 	mprev_populacao_alvo	a,
			mprev_regra_cubo	b
		where   b.nr_sequencia 		= a.nr_seq_regra_cubo
		and 	a.nr_sequencia		= nr_sequencia_p;

		if (nr_seq_regra_cubo_w > 0) then

			if (ie_opcao_p = 'P') then

				select 	count(1)
				into STRICT 	ds_retorno_w
				from 	hdm_regra_cubo_atend_eup
				where 	nr_seq_regra_cubo	 = nr_seq_regra_cubo_w;

				if (ds_retorno_w = 0) then

					select 	count(1)
					into STRICT 	ds_retorno_w
					from 	mprev_regra_cubo_diag
					where 	ie_origem_dados	 = 'P'
					and	nr_seq_regra_cubo	 = nr_seq_regra_cubo_w;

				end if;

				if (ds_retorno_w = 0) then

					select 	count(1)
					into STRICT 	ds_retorno_w
					from 	hdm_regra_cubo_lista_prob
					where 	nr_seq_regra_cubo	 = nr_seq_regra_cubo_w;

				end if;

				if (ds_retorno_w = 0) then

					select 	count(1)
					into STRICT 	ds_retorno_w
					from 	mprev_regra_cubo_proc
					where 	ie_origem_dados		= 'P'
					and 	nr_seq_regra_cubo	 = nr_seq_regra_cubo_w;

				end if;

				if (ds_retorno_w = 0) then

					select 	count(1)
					into STRICT 	ds_retorno_w
					from 	hdm_regra_cubo_trat
					where 	nr_seq_regra_cubo	 = nr_seq_regra_cubo_w;

				end if;

				if (ds_retorno_w = 0) then

					select 	count(1)
					into STRICT 	ds_retorno_w
					from 	hdm_regra_cubo_medic
					where 	nr_seq_regra_cubo	 = nr_seq_regra_cubo_w;

				end if;
			end if;

			if (ie_opcao_p = 'O') then

				select 	count(1)
				into STRICT 	ds_retorno_w
				from 	mprev_regra_cubo_benef
				where 	nr_seq_regra_cubo	 = nr_seq_regra_cubo_w;

				if (ds_retorno_w = 0) then

					select 	count(1)
					into STRICT 	ds_retorno_w
					from 	mprev_regra_cubo_custo
					where 	nr_seq_regra_cubo	 = nr_seq_regra_cubo_w;

				end if;

				if (ds_retorno_w = 0) then

					select 	count(1)
					into STRICT 	ds_retorno_w
					from 	mprev_regra_cubo_atend
					where 	nr_seq_regra_cubo	 = nr_seq_regra_cubo_w;

				end if;

				if (ds_retorno_w = 0) then

					select 	count(1)
					into STRICT 	ds_retorno_w
					from 	mprev_regra_cubo_diag
					where 	ie_origem_dados	 = 'O'
					and 	nr_seq_regra_cubo	 = nr_seq_regra_cubo_w;

				end if;

				if (ds_retorno_w = 0) then

					select 	count(1)
					into STRICT 	ds_retorno_w
					from 	mprev_regra_cubo_proc
					where 	ie_origem_dados		= 'O'
					and 	nr_seq_regra_cubo	= nr_seq_regra_cubo_w;

				end if;

			end if;

		end if;

	end if;

	ds_retorno_p :=	ds_retorno_w;

end 	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE mprev_verifica_regra_ops_prest ( nr_sequencia_p bigint, ie_opcao_p text, ds_retorno_p INOUT bigint) FROM PUBLIC;

