-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE generate_so_blackduck ( NR_SEQUENCIA_P bigint, DS_DAMAGE_P text, DS_DAMAGE_BRIEF_P text, CD_PESSOA_FISICA_P text, NM_REQUEST_USER_P text, NR_SEQ_ORDEM_SERV_P INOUT bigint ) AS $body$
DECLARE


NM_EXEC_USER_W		varchar(50);
NR_SEQ_ORDEM_SERV_W	bigint;
					

BEGIN

	begin
	
	select OBTER_USUARIO_PF(CD_PESSOA_FISICA_P)
	into STRICT NM_EXEC_USER_W
	;
	
	NR_SEQ_ORDEM_SERV_W := GENERATE_SO(NM_REQUEST_USER_P, NM_EXEC_USER_W, 'S', DS_DAMAGE_P, DS_DAMAGE_BRIEF_P, '', 'H', NR_SEQ_ORDEM_SERV_W);
	CALL UPDATE_BLACKDUCK_STATUS(NR_SEQUENCIA_P, 'R');
	CALL UPDATE_BLACKDUCK_SO(NR_SEQUENCIA_P, NR_SEQ_ORDEM_SERV_W);
	
	NR_SEQ_ORDEM_SERV_P	:= NR_SEQ_ORDEM_SERV_W;
	end;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE generate_so_blackduck ( NR_SEQUENCIA_P bigint, DS_DAMAGE_P text, DS_DAMAGE_BRIEF_P text, CD_PESSOA_FISICA_P text, NM_REQUEST_USER_P text, NR_SEQ_ORDEM_SERV_P INOUT bigint ) FROM PUBLIC;

