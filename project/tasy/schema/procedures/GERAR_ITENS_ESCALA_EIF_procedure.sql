-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_itens_escala_eif ( nr_seq_escala_p bigint, nr_sequencia_p bigint, nm_usuario_p text, ie_commitar_p text default 'S') AS $body$
DECLARE


nr_seq_sessao_w	ESCALA_EIF_ITEM.nr_seq_sessao%type := 0;

C01 CURSOR FOR
	SELECT	nr_sequencia,
		nr_seq_escala,
		ds_item,
		nr_seq_apres,
		coalesce(ie_titulo,'N') ie_titulo
	from	eif_escala_item
	where	nr_seq_escala = nr_seq_escala_p
	and	coalesce(ie_situacao,'A') = 'A'
	order by	nr_seq_apres;

BEGIN

for itens in c01 loop

	begin

	if (itens.ie_titulo = 'S') then
		nr_seq_sessao_w := nr_seq_sessao_w + 1;
	end if;
	
	insert into ESCALA_EIF_ITEM(
		nr_sequencia,
		dt_atualizacao, 
		nm_usuario, 
		dt_atualizacao_nrec, 
		nm_usuario_nrec, 
		nr_seq_item, 
		ie_resultado,
		nr_seq_escala,
		ie_habilitado,
		ie_titulo,
		nr_seq_sessao)
	values (
		nextval('escala_eif_item_seq'),
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		itens.nr_sequencia,
		'N',
		nr_sequencia_p,
		'S',
		itens.ie_titulo,
		nr_seq_sessao_w);
	end;

end loop;

if (ie_commitar_p = 'S') then
   commit;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_itens_escala_eif ( nr_seq_escala_p bigint, nr_sequencia_p bigint, nm_usuario_p text, ie_commitar_p text default 'S') FROM PUBLIC;

