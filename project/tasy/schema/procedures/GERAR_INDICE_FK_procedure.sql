-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_indice_fk ( nm_tabela_ref_p text, nm_integr_ref_p text, nm_usuario_p text) AS $body$
DECLARE


nm_tabela_w			varchar(50);
nm_atributo_W		varchar(50);
nm_integr_ref_w		varchar(50);
ie_seq_criacao_W		bigint;


C01 CURSOR FOR
	SELECT
		nm_tabela,
		nm_atributo,
		nm_integridade_referencial,
		ie_sequencia_criacao
	from 	integridade_atributo
	where	nm_integridade_referencial = nm_integr_ref_p;



BEGIN

insert into indice(
		nm_tabela,
		nm_indice,
		ie_tipo,
		dt_atualizacao,
		nm_usuario,
		ds_indice,
		ie_criar_alterar,
		ie_situacao,
		dt_criacao)
values (
		nm_tabela_ref_p,
		nm_integr_ref_p||'_I',
		'I',
		clock_timestamp(),
		nm_usuario_p,
		' ',
		'I',
		'A',
		clock_timestamp());


OPEN C01;
LOOP
FETCH C01 into
	nm_tabela_w,
	nm_atributo_W,
	nm_integr_ref_w,
	ie_seq_criacao_W;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin
	insert into indice_atributo(
		nm_tabela,
		nm_indice,
		nr_sequencia,
		nm_atributo,
		dt_atualizacao,
		nm_usuario)
	values (
		nm_tabela_w,
		nm_integr_ref_w||'_I',
		ie_seq_criacao_w,
		nm_atributo_w,
		clock_timestamp(),
		nm_usuario_p);
	end;
END LOOP;
Close C01;

commit;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_indice_fk ( nm_tabela_ref_p text, nm_integr_ref_p text, nm_usuario_p text) FROM PUBLIC;

