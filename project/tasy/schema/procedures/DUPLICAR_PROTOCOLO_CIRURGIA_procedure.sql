-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_protocolo_cirurgia ( nr_sequencia_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_sequencia_w			bigint;
nm_cirurgia_w			varchar(80);
ds_diagnostico_w		varchar(2000);
ds_resumo_cirurgia_w	varchar(2000);
ds_diagnostico_pos_w	varchar(2000);
ds_exame_rad_w			varchar(2000);
ds_exame_anatomo_w		varchar(2000);
ds_achados_operat_w		varchar(2000);
ds_cirurgia_w			text;
cd_estabelecimento_w	smallint;
ie_situacao_w			varchar(1);
cd_medico_w				varchar(10);
ds_intercorrencia_w 	varchar(2000);
ds_po_imediato_w 		varchar(2000);
cd_doenca_cid_w 		varchar(10);
cd_especialidade_w		integer;
cd_doenca_cid_pre_w  varchar(10);



BEGIN

select	nextval('cirurgia_protocolo_seq')
into STRICT	nr_sequencia_w
;

select	p.nm_cirurgia,
	p.ds_diagnostico,
	p.ds_resumo_cirurgia,
	p.ds_diagnostico_pos,
	p.ds_exame_rad,
	p.ds_exame_anatomo,
	p.ds_achados_operatorios,
	p.cd_estabelecimento,
	p.ie_situacao,
	p.cd_medico,
	p.ds_intercorrencia,
	p.ds_po_imediato,
	p.cd_doenca_cid,
	p.cd_especialidade,
   	p.cd_doenca_cid_pre
into STRICT	nm_cirurgia_w,
	ds_diagnostico_w,
	ds_resumo_cirurgia_w,
	ds_diagnostico_pos_w,
	ds_exame_rad_w,
	ds_exame_anatomo_w,
	ds_achados_operat_w,
	cd_estabelecimento_w,
	ie_situacao_w,
	cd_medico_w,
	ds_intercorrencia_w,
	ds_po_imediato_w,
	cd_doenca_cid_w,
	cd_especialidade_w,
   cd_doenca_cid_pre_w
from	cirurgia_protocolo p
where	p.nr_sequencia = nr_sequencia_p;

insert	into cirurgia_protocolo(
	nr_sequencia,
	nm_cirurgia,
	dt_atualizacao,
	nm_usuario,
	ds_diagnostico,
	ds_resumo_cirurgia,
	ds_diagnostico_pos,
	ds_exame_rad,
	ds_exame_anatomo,
	ds_achados_operatorios,
	ds_cirurgia,

	cd_medico,
	cd_estabelecimento,
	ie_situacao,
	ds_intercorrencia,
	ds_po_imediato,
	cd_doenca_cid,
	cd_especialidade,
   	cd_doenca_cid_pre)
values (nr_sequencia_w,
	nm_cirurgia_w,
	clock_timestamp(),
	nm_usuario_p,
	ds_diagnostico_w,
	ds_resumo_cirurgia_w,
	ds_diagnostico_pos_w,
	ds_exame_rad_w,
	ds_exame_anatomo_w,
	ds_achados_operat_w,
	' ',

	cd_medico_w, --null,
	cd_estabelecimento_w,
	ie_situacao_w,
	ds_intercorrencia_w,
	ds_po_imediato_w,
	cd_doenca_cid_w,
	cd_especialidade_w,
   	cd_doenca_cid_pre_w);

commit;

copia_campo_long_de_para_Java(	'CIRURGIA_PROTOCOLO',
				'DS_CIRURGIA',
				' where nr_sequencia = :nr_sequencia',
				'nr_sequencia='||nr_sequencia_p,
				'CIRURGIA_PROTOCOLO',
				'DS_CIRURGIA',
				' where nr_sequencia = :nr_sequencia',
				'nr_sequencia='||nr_sequencia_w,
				'L');

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_protocolo_cirurgia ( nr_sequencia_p bigint, nm_usuario_p text) FROM PUBLIC;

