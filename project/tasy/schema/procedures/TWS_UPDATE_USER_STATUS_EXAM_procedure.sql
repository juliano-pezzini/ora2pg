-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE tws_update_user_status_exam ( ds_login_p text, nr_prescricao_p bigint, nr_sequencia_p bigint) AS $body$
DECLARE

  qt_registros_w bigint;

BEGIN
  IF (nr_prescricao_p IS NOT NULL AND nr_prescricao_p::text <> '') AND (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '') THEN
    SELECT COUNT(*)
    INTO STRICT qt_registros_w
    FROM wsuite_user_status_exam
    WHERE ds_login          = ds_login_p
    AND nr_prescricao       = nr_prescricao_p
    AND nr_sequencia_prescr = nr_sequencia_p;
    IF (qt_registros_w      = 0) THEN
      INSERT
      INTO wsuite_user_status_exam(
          nr_sequencia,
          dt_atualizacao,
          ds_login,
          nr_prescricao,
          nr_sequencia_prescr,
          dt_leitura
        )
        VALUES (
          nextval('wsuite_user_status_exam_seq'),
          clock_timestamp(),
          ds_login_p,
          nr_prescricao_p,
          nr_sequencia_p,
          clock_timestamp()
        );
    ELSE
      UPDATE wsuite_user_status_exam
      SET dt_leitura    = clock_timestamp()
      WHERE ds_login    = ds_login_p
      AND nr_prescricao = nr_prescricao_p
      AND nr_sequencia_prescr  = nr_sequencia_p;
    END IF;
  END IF;
  COMMIT;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tws_update_user_status_exam ( ds_login_p text, nr_prescricao_p bigint, nr_sequencia_p bigint) FROM PUBLIC;

