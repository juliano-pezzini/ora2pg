-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pep_inativar_item ( ds_justificativa_p text, nr_sequencia_p bigint, dt_diagnostico_p timestamp, cd_evolucao_p bigint, cd_pasta_p bigint, nr_parecer_p bigint, nm_tabela_p text, nr_atendimento_p bigint, nm_usuario_p text, cd_doenca_p text) AS $body$
DECLARE


cd_evolucao_sae_w		bigint;
nr_sequencia_w			varchar(50);
dt_liberacao_evol_sae_w timestamp;


BEGIN

if (cd_pasta_p = 9466) or (cd_pasta_p =  9526) or (cd_pasta_p = 1123) then --Evoluções
	update 	evolucao_paciente
        set 	ie_situacao 		= 'I',
		dt_inativacao 		= clock_timestamp(),
                nm_usuario_inativacao 	= nm_usuario_p,
                ds_justificativa 	= ds_justificativa_p
	where 	cd_evolucao 		= cd_evolucao_p;
	CALL excluir_itens_conta_evol(cd_evolucao_p,nm_usuario_p);
elsif (cd_pasta_p = 9462) then --Atestados
	update 	atestado_paciente
	set 	ie_situacao 		= 'I',
		dt_inativacao 		= clock_timestamp(),
		nm_usuario_inativacao 	= nm_usuario_p,
		ds_justificativa 	= ds_justificativa_p
        where 	nr_sequencia 		= nr_sequencia_p;
elsif (cd_pasta_p = 9463) then --Avaliações
	update 	med_avaliacao_paciente
	set 	ie_situacao 		= 'I',
		dt_inativacao 		= clock_timestamp(),
		nm_usuario_inativacao 	= nm_usuario_p,
		ds_justificativa 	= ds_justificativa_p
        where 	nr_sequencia 		= nr_sequencia_p;
elsif (cd_pasta_p = 9500) then --SV e monit geral
	update 	atendimento_sinal_vital
	set 	ie_situacao 		= 'I',
		dt_inativacao 		= clock_timestamp() ,
		nm_usuario_inativacao 	= nm_usuario_p,
		ds_justificativa 	= ds_justificativa_p
	where 	nr_sequencia 		= nr_sequencia_p;
elsif (cd_pasta_p = 9550) then -- Consulta Diagnostico
	update 	diagnostico_doenca
	set 	ie_situacao 		= 'I',
		dt_inativacao 		= clock_timestamp(),
		nm_usuario_inativacao 	= nm_usuario_p,		
		ds_justificativa 		= ds_justificativa_p
        where 	nr_atendimento 		= nr_atendimento_p
	and 	dt_diagnostico 		= dt_diagnostico_p
	and	cd_doenca		= cd_doenca_p;
elsif (cd_pasta_p = 9482) then --Ganhos e perdas
	update 	atendimento_perda_ganho
	set 	ie_situacao 		= 'I',
		dt_inativacao 		= clock_timestamp(),
		nm_usuario_inativacao 	= nm_usuario_p,
		ds_justificativa 	= ds_justificativa_p
        where 	nr_sequencia 		= nr_sequencia_p;
elsif (cd_pasta_p = 9589) OR (CD_PASTA_P	= 115288) or (CD_PASTA_P = 115454) then --Parecer médico	
	if (nm_tabela_p = 'PARECER_MEDICO') then
		update 	parecer_medico
		set 	ie_situacao 		= 'I',
			dt_inativacao 		= clock_timestamp(),
			nm_usuario_inativacao 	= nm_usuario_p,
			ds_justificativa 	= ds_justificativa_p
		where 	nr_parecer 		= nr_parecer_p
		and   	nr_sequencia 		= nr_sequencia_p;
	elsif (nm_tabela_p = 'PARECER_MEDICO_REQ') then
		update 	parecer_medico_req
		set 	ie_situacao 		= 'I',
			dt_inativacao 		= clock_timestamp(), 
			nm_usuario_inativacao 	= nm_usuario_p,
			ds_justificativa 	= ds_justificativa_p
		where 	nr_parecer 		= nr_parecer_p;
	elsif (nm_tabela_p = 'PARECER_MEDICO_CONTATO') then 
		update 	parecer_medico_contato
		set 	ie_situacao 		= 'I',
			dt_inativacao 		= clock_timestamp(), 
			nm_usuario_inativacao 	= nm_usuario_p,
			ds_justificativa 	= ds_justificativa_p
		where 	nr_parecer 		= nr_parecer_p
		and   	nr_sequencia 		= nr_sequencia_p; 	
	end if;
elsif (cd_pasta_p = 9506) then --Anamnese
	update 	anamnese_paciente
	set 	ie_situacao 			= 'I',
		dt_inativacao 			= clock_timestamp() ,
		nm_usuario_inativacao 		= nm_usuario_p,
		ds_justificativa 		= ds_justificativa_p
        where 	nr_sequencia 			= nr_sequencia_p;
elsif (cd_pasta_p = 9488) then --Doenças prévias e atuais
	update 	paciente_antec_clinico
	set 	dt_inativacao 			= clock_timestamp(),
		nm_usuario_inativacao 		= nm_usuario_p,
		ds_justificativa 		= ds_justificativa_p
	where 	nr_sequencia 			= nr_sequencia_p;
elsif (cd_pasta_p = 9486) then --Alergia / Reações adversas
	update 	paciente_alergia
	set 	dt_inativacao 			= clock_timestamp(),
		nm_usuario_inativacao 		= nm_usuario_p,
		ds_justificativa 		= ds_justificativa_p
	where 	nr_sequencia 			= nr_sequencia_p;
elsif (cd_pasta_p = 9489) then -- Hábitos
	update 	paciente_habito_vicio
	set 	dt_inativacao 			= clock_timestamp(),
		nm_usuario_inativacao 		= nm_usuario_p,
		ds_justificativa 		= ds_justificativa_p
	where 	nr_sequencia 			= nr_sequencia_p;
elsif (cd_pasta_p = 9490) then --Medicamentos em uso
	update 	paciente_medic_uso
	set 	dt_inativacao 			= clock_timestamp(), 
		nm_usuario_inativacao 		= nm_usuario_p,
		ds_justificativa 		= ds_justificativa_p
        where 	nr_sequencia 			= nr_sequencia_p;
elsif (cd_pasta_p = 9487) then --Cirurgias
	update 	historico_saude_cirurgia
	set 	dt_inativacao 			= clock_timestamp(),
		nm_usuario_inativacao 		= nm_usuario_p,
		ds_justificativa 		= ds_justificativa_p
        where 	nr_sequencia 			= nr_sequencia_p;	
elsif (cd_pasta_p = 9499) then  --Monitoramento respiratória
	update 	atendimento_monit_resp
        set 	ie_situacao 			= 'I',
		dt_inativacao 			= clock_timestamp(),
		nm_usuario_inativacao 		= nm_usuario_p,
		ds_justificativa 		= ds_justificativa_p
        where 	nr_sequencia 			= nr_sequencia_p;
elsif (cd_pasta_p = 9488) then --Monit hemodinâmica
	update 	atend_monit_hemod
        set 	ie_situacao 			= 'I',
		dt_inativacao 			= clock_timestamp(),
		nm_usuario_inativacao 		= nm_usuario_p,
		ds_justificativa 		= ds_justificativa_p
        where 	nr_sequencia 			= nr_sequencia_p;
elsif (cd_pasta_p = 9497) then --Monit analgesia
	update 	atend_aval_analgesia
	set 	ie_situacao 			= 'I',
		dt_inativacao 			= clock_timestamp(),
		nm_usuario_inativacao 		= nm_usuario_p,
                ds_justificativa 		= ds_justificativa_p
        where 	nr_sequencia 			= nr_sequencia_p;
elsif (cd_pasta_p = 9496) then --Analisador bioquímico portátil
	update 	atend_anal_bioq_port
	set 	ie_situacao 			= 'I',
		dt_inativacao 			= clock_timestamp(), 
                nm_usuario_inativacao 		= nm_usuario_p,
                ds_justificativa 		= ds_justificativa_p
        where 	nr_sequencia 			= nr_sequencia_p;
elsif (cd_pasta_p = 9624) or (cd_pasta_p = 10700) or (cd_pasta_p = 10709) or (cd_pasta_p = 10701) or (cd_pasta_p = 42095) or (cd_pasta_P = 10706) or (cd_pasta_p = 10708) or (cd_pasta_P = 199186) or (cd_pasta_p = 10702) then --SAE - Sistematização da Assistência de enfermagem
	update 	pe_prescricao
	set 	dt_inativacao 			= clock_timestamp(),
		ie_situacao 			= 'I',
                nm_usuario_inativacao 		= nm_usuario_p,
                ds_justificativa 		= ds_justificativa_p
	where 	nr_sequencia 			= nr_sequencia_p;

	select	coalesce(max(cd_evolucao),0)
	into STRICT	cd_evolucao_sae_w
	from	evolucao_paciente
	where	nr_seq_sae = nr_sequencia_p;

	if (cd_evolucao_sae_w > 0) then

		select	max(dt_liberacao)
		into STRICT	dt_liberacao_evol_sae_w
		from	evolucao_paciente
		where	nr_seq_sae = nr_sequencia_p;

		if (coalesce(dt_liberacao_evol_sae_w::text, '') = '') then

			delete from evolucao_paciente where	nr_seq_sae = nr_sequencia_p;

		else

			update 	evolucao_paciente
			set 	ie_situacao 		= 'I',
					dt_inativacao 		= clock_timestamp(),
					nm_usuario_inativacao 	= nm_usuario_p,
					ds_justificativa 	= ds_justificativa_p
			where 	cd_evolucao 		= cd_evolucao_sae_w;

			CALL delete_assinat_inativa('EVOLUCAO_PACIENTE','',cd_evolucao_sae_w);

		end if;

	end if;

elsif (cd_pasta_p = 10700) then --Anamnese / Exame físico
	update 	evolucao_paciente
	set 	ie_situacao 			= 'I',
		dt_inativacao 			= clock_timestamp(), 
		nm_usuario_inativacao 		= nm_usuario_p,
		ds_justificativa 		= ds_justificativa_p
        where 	cd_evolucao 			= cd_evolucao_p;
elsif (cd_pasta_p = 9414) then --Justificativas
	update 	paciente_justificativa
	set 	ie_situacao 			= 'I',
		dt_inativacao 			= clock_timestamp(),
		nm_usuario_inativacao 		= nm_usuario_p,
		ds_justificativa_inativacao 	= ds_justificativa_p
	where 	nr_sequencia 			= nr_sequencia_p;
elsif (cd_pasta_p = 9491) then --Ocorrências	
	update 	paciente_ocorrencia
	set 	dt_inativacao 			= clock_timestamp(),
		nm_usuario_inativacao 		= nm_usuario_p,
		ds_justificativa 		= ds_justificativa_p
	where 	nr_sequencia 			= nr_sequencia_p;
elsif (cd_pasta_p = 11715) then --História familiar
	update 	paciente_antec_clinico
	set 	dt_inativacao 			= clock_timestamp(),
		nm_usuario_inativacao 		= nm_usuario_p,
		ds_justificativa 		= ds_justificativa_p
	where 	nr_sequencia 			= nr_sequencia_p;
elsif (cd_pasta_p = 13645) then --Fatores de risco
	update 	cih_pac_fat_risco
	set 	dt_inativacao 			= clock_timestamp(),
		nm_usuario_inativacao 		= nm_usuario_p,
		ds_observacao	 		= ds_justificativa_p
	where 	nr_sequencia 			= nr_sequencia_p;
elsif (cd_pasta_p = 19289) then -- Anestesia PEPO - Maycon 01/07/2010
	if (nm_tabela_p = 'CIRURGIA_TEC_ANESTESICA') then
		update 	cirurgia_tec_anestesica
		set 	dt_inativacao 		= clock_timestamp(),
			nm_usuario_inativacao 	= nm_usuario_p,
			ie_situacao 		= 'I',
			ds_justificativa 	= ds_justificativa_p
		where 	nr_sequencia 		= nr_sequencia_p;
	else
		update	anestesia_descricao
		set 	dt_inativacao 		= clock_timestamp(), 
			nm_usuario_inativacao 	= nm_usuario_p,
			ie_situacao 		= 'I', 
			ds_justificativa 	= ds_justificativa_p
		where 	nr_sequencia 		= nr_sequencia_p;
	end if;
elsif (cd_pasta_p = 19303) then -- Relatório cirurgia - Maycon 01/07/2010
	update	cirurgia_descricao
	set	ie_situacao 		= 'I',
		dt_inativacao 		= clock_timestamp(),
		nm_usuario_inativacao 	= nm_usuario_p, 
		ds_justificativa 	= ds_justificativa_p
	where	nr_sequencia 		= nr_sequencia_p;
elsif (cd_pasta_p = 19332) then -- Participantes -  Maycon 01/07/2010
	update 	cirurgia_participante
	set 	dt_inativacao 		= clock_timestamp(),
		nm_usuario_inativacao 	= nm_usuario_p,
		ie_situacao 		= 'I',
		ds_justificativa 	= ds_justificativa_p
	where nr_seq_interno 		= nr_sequencia_p;
elsif (cd_pasta_p = 19296) then --Tempos e movimentos - Maycon 01/07/2010
	update 	evento_cirurgia_paciente
	set 	dt_inativacao 		= clock_timestamp(),
		nm_usuario_inativacao 	= nm_usuario_p,
		ie_situacao 		= 'I',
		ds_justificativa 	= ds_justificativa_p
	where 	nr_sequencia 		= nr_sequencia_p;	
elsif (cd_pasta_p = 19305) then	-- Interna - João Paulo Weiss 21/02/2011
	update	atend_aval_srpa
	set	dt_inativacao =		clock_timestamp(),
		nm_usuario_inativacao = nm_usuario_p,
		ie_situacao =		'I',
		ds_justificativa = 	ds_justificativa_p
	where	nr_sequencia =		nr_sequencia_p;
elsif (cd_pasta_p = 19350) then	-- Faturamento médico - Luciano Wilbert 04/01/2012
	update	pep_med_fatur
	set	dt_inativacao =		clock_timestamp(),
		nm_usuario_inativacao = nm_usuario_p,
		ie_situacao =		'I',
		ds_justificativa = 	ds_justificativa_p
	where	nr_sequencia =		nr_sequencia_p;
elsif (cd_pasta_p = 9625) then -- Solic externa Exame / Proced / Cirurgia
	update	pedido_exame_externo
	set		dt_inativacao = clock_timestamp(),
			nm_usuario_inativacao = nm_usuario_p,
			ie_situacao = 'I',
			ds_justificativa_inativacao = ds_justificativa_p
	where 	nr_sequencia = nr_sequencia_p;
elsif (cd_pasta_p = 271727) then -- Escala EAT
	update	escala_eat
	set		dt_inativacao = clock_timestamp(),
			nm_usuario_inativacao = nm_usuario_p,
			ie_situacao = 'I',
			ds_justificativa = ds_justificativa_p
	where 	nr_sequencia = nr_sequencia_p;	
else
	CALL Inativar_informacao(nm_tabela_p, 'NR_SEQUENCIA', nr_sequencia_p, ds_justificativa_p, nm_usuario_p);
end if;

commit;

if (cd_evolucao_p > 0 ) then
	nr_sequencia_w := cd_evolucao_p;
elsif (nr_parecer_p > 0) then
	nr_sequencia_w := nr_parecer_p;
else
	nr_sequencia_w := nr_sequencia_p;
end if;

CALL delete_assinat_inativa(nm_tabela_p,'',nr_sequencia_w);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pep_inativar_item ( ds_justificativa_p text, nr_sequencia_p bigint, dt_diagnostico_p timestamp, cd_evolucao_p bigint, cd_pasta_p bigint, nr_parecer_p bigint, nm_tabela_p text, nr_atendimento_p bigint, nm_usuario_p text, cd_doenca_p text) FROM PUBLIC;

