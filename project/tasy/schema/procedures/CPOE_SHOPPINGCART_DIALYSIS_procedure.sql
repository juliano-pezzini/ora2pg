-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cpoe_shoppingcart_dialysis (nr_sequencia_p bigint, ie_retrogrado_p text, ds_retorno_p INOUT text) AS $body$
DECLARE


ie_return_value_w varchar(1) := 'N';
nr_return_value_w	bigint;
active_ingred_consist_w varchar(255);

ie_continuo_w	varchar(1) := 'N';
ds_alergia_w	varchar(4000);
ie_severidade_w	paciente_alergia.ie_intensidade%type;
nr_seq_reacao_w	paciente_alergia.nr_seq_reacao%type;
nr_seq_ficha_tecnica_w	paciente_alergia.nr_seq_ficha_tecnica%type;

c01 CURSOR FOR
SELECT  a.*,  obter_setor_atendimento(nr_atendimento) cd_setor_atend
from 	cpoe_dialise a
where	nr_sequencia = nr_sequencia_p;

BEGIN

ds_retorno_p := 'S';
if (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '') then
	for r_c01_w in C01
	loop
		if (r_c01_w.dt_fim IS NOT NULL AND r_c01_w.dt_fim::text <> '') then
			ie_continuo_w := 'S';
		end if;
		--CUSTOM VALIDATOR
		if (((r_c01_w.cd_mat_soluc1 IS NOT NULL AND r_c01_w.cd_mat_soluc1::text <> '') and (coalesce(r_c01_w.qt_dose_soluc1,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol1::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc2 IS NOT NULL AND r_c01_w.cd_mat_soluc2::text <> '') and (coalesce(r_c01_w.qt_dose_soluc2,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol2::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc3 IS NOT NULL AND r_c01_w.cd_mat_soluc3::text <> '') and (coalesce(r_c01_w.qt_dose_soluc3,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol3::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc4 IS NOT NULL AND r_c01_w.cd_mat_soluc4::text <> '') and (coalesce(r_c01_w.qt_dose_soluc4,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol4::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc5 IS NOT NULL AND r_c01_w.cd_mat_soluc5::text <> '') and (coalesce(r_c01_w.qt_dose_soluc5,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol5::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc6 IS NOT NULL AND r_c01_w.cd_mat_soluc6::text <> '') and (coalesce(r_c01_w.qt_dose_soluc6,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol6::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc7 IS NOT NULL AND r_c01_w.cd_mat_soluc7::text <> '') and (coalesce(r_c01_w.qt_dose_soluc7,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol7::text, '') = ''))

			or ((r_c01_w.cd_mat_soluc1_2 IS NOT NULL AND r_c01_w.cd_mat_soluc1_2::text <> '') and (coalesce(r_c01_w.qt_dose_soluc1_2,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol1_2::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc2_2 IS NOT NULL AND r_c01_w.cd_mat_soluc2_2::text <> '') and (coalesce(r_c01_w.qt_dose_soluc2_2,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol2_2::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc3_2 IS NOT NULL AND r_c01_w.cd_mat_soluc3_2::text <> '') and (coalesce(r_c01_w.qt_dose_soluc3_2,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol3_2::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc4_2 IS NOT NULL AND r_c01_w.cd_mat_soluc4_2::text <> '') and (coalesce(r_c01_w.qt_dose_soluc4_2,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol4_2::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc5_2 IS NOT NULL AND r_c01_w.cd_mat_soluc5_2::text <> '') and (coalesce(r_c01_w.qt_dose_soluc5_2,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol5_2::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc6_2 IS NOT NULL AND r_c01_w.cd_mat_soluc6_2::text <> '') and (coalesce(r_c01_w.qt_dose_soluc6_2,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol6_2::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc7_2 IS NOT NULL AND r_c01_w.cd_mat_soluc7_2::text <> '') and (coalesce(r_c01_w.qt_dose_soluc7_2,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol7_2::text, '') = ''))

			or ((r_c01_w.cd_mat_soluc1_3 IS NOT NULL AND r_c01_w.cd_mat_soluc1_3::text <> '') and (coalesce(r_c01_w.qt_dose_soluc1_3,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol1_3::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc2_3 IS NOT NULL AND r_c01_w.cd_mat_soluc2_3::text <> '') and (coalesce(r_c01_w.qt_dose_soluc2_3,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol2_3::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc3_3 IS NOT NULL AND r_c01_w.cd_mat_soluc3_3::text <> '') and (coalesce(r_c01_w.qt_dose_soluc3_3,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol3_3::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc4_3 IS NOT NULL AND r_c01_w.cd_mat_soluc4_3::text <> '') and (coalesce(r_c01_w.qt_dose_soluc4_3,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol4_3::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc5_3 IS NOT NULL AND r_c01_w.cd_mat_soluc5_3::text <> '') and (coalesce(r_c01_w.qt_dose_soluc5_3,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol5_3::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc6_3 IS NOT NULL AND r_c01_w.cd_mat_soluc6_3::text <> '') and (coalesce(r_c01_w.qt_dose_soluc6_3,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol6_3::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc7_3 IS NOT NULL AND r_c01_w.cd_mat_soluc7_3::text <> '') and (coalesce(r_c01_w.qt_dose_soluc7_3,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol7_3::text, '') = ''))

			or ((r_c01_w.cd_mat_soluc1_4 IS NOT NULL AND r_c01_w.cd_mat_soluc1_4::text <> '') and (coalesce(r_c01_w.qt_dose_soluc1_4,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol1_4::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc2_4 IS NOT NULL AND r_c01_w.cd_mat_soluc2_4::text <> '') and (coalesce(r_c01_w.qt_dose_soluc2_4,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol2_4::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc3_4 IS NOT NULL AND r_c01_w.cd_mat_soluc3_4::text <> '') and (coalesce(r_c01_w.qt_dose_soluc3_4,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol3_4::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc4_4 IS NOT NULL AND r_c01_w.cd_mat_soluc4_4::text <> '') and (coalesce(r_c01_w.qt_dose_soluc4_4,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol4_4::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc5_4 IS NOT NULL AND r_c01_w.cd_mat_soluc5_4::text <> '') and (coalesce(r_c01_w.qt_dose_soluc5_4,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol5_4::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc6_4 IS NOT NULL AND r_c01_w.cd_mat_soluc6_4::text <> '') and (coalesce(r_c01_w.qt_dose_soluc6_4,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol6_4::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc7_4 IS NOT NULL AND r_c01_w.cd_mat_soluc7_4::text <> '') and (coalesce(r_c01_w.qt_dose_soluc7_4,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol7_4::text, '') = ''))

			or ((r_c01_w.cd_mat_soluc1_5 IS NOT NULL AND r_c01_w.cd_mat_soluc1_5::text <> '') and (coalesce(r_c01_w.qt_dose_soluc1_5,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol1_5::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc2_5 IS NOT NULL AND r_c01_w.cd_mat_soluc2_5::text <> '') and (coalesce(r_c01_w.qt_dose_soluc2_5,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol2_5::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc3_5 IS NOT NULL AND r_c01_w.cd_mat_soluc3_5::text <> '') and (coalesce(r_c01_w.qt_dose_soluc3_5,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol3_5::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc4_5 IS NOT NULL AND r_c01_w.cd_mat_soluc4_5::text <> '') and (coalesce(r_c01_w.qt_dose_soluc4_5,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol4_5::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc5_5 IS NOT NULL AND r_c01_w.cd_mat_soluc5_5::text <> '') and (coalesce(r_c01_w.qt_dose_soluc5_5,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol5_5::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc6_5 IS NOT NULL AND r_c01_w.cd_mat_soluc6_5::text <> '') and (coalesce(r_c01_w.qt_dose_soluc6_5,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol6_5::text, '') = ''))
			or ((r_c01_w.cd_mat_soluc7_5 IS NOT NULL AND r_c01_w.cd_mat_soluc7_5::text <> '') and (coalesce(r_c01_w.qt_dose_soluc7_5,0) = 0 or coalesce(r_c01_w.cd_unid_med_dose_sol7_5::text, '') = ''))) then
			ds_retorno_p := 'N';
			goto return_value;
		end if;
		--FIM CUSTOM VALIDATOR
		if (r_c01_w.ie_tipo_dialise = 'DI') then
			--CAMPOS OBRIGATORIOS
			if (coalesce(r_c01_w.ie_tipo_dialise::text, '') = '' or coalesce(r_c01_w.ie_categoria::text, '') = '' or coalesce(r_c01_w.ie_tipo_hemodialise::text, '') = '' or coalesce(r_c01_w.qt_hora_min_sessao::text, '') = '' or coalesce(r_c01_w.qt_fluxo_sangue::text, '') = ''
					or coalesce(r_c01_w.cd_mat_soluc1::text, '') = '' or coalesce(r_c01_w.qt_dose_soluc1::text, '') = '' or coalesce(r_c01_w.cd_unid_med_dose_sol1::text, '') = '' or coalesce(r_c01_w.ie_tipo_solucao::text, '') = '') then
				ds_retorno_p := 'N';
				goto return_value;
			end if;

			if (cpoe_shoppingcart_vigencia(null, 'P', r_c01_w.dt_inicio, 'N', r_c01_w.ie_duracao, r_c01_w.dt_fim, 'N', ie_retrogrado_p) = 'S') then
				ds_retorno_p := 'N';
				goto return_value;
			end if;
			--FIM CAMPOS OBRIGATORIOS

			--INCONSISTENCIA DA CPOE (BARRA VERMELHA)
			select	CASE WHEN count(*)=0 THEN  'N'  ELSE 'S' END  ie_duplicado
			into STRICT	ie_return_value_w
			from	cpoe_dialise a
			where	a.nr_sequencia <> coalesce(r_c01_w.nr_sequencia,0)
			and		obter_se_cpoe_regra_duplic('DI', wheb_usuario_pck.get_cd_perfil, r_c01_w.cd_setor_atend) = 'S'
			and		a.ie_hemodialise = r_c01_w.ie_hemodialise
			and		a.ie_tipo_dialise = 'DI'
			and		((a.nr_atendimento = r_c01_w.nr_atendimento) or (a.cd_pessoa_fisica = r_c01_w.cd_pessoa_fisica and coalesce(a.nr_atendimento::text, '') = ''))
			and		(((a.dt_lib_suspensao IS NOT NULL AND a.dt_lib_suspensao::text <> '') and (a.dt_suspensao > clock_timestamp())) or (coalesce(a.dt_lib_suspensao::text, '') = ''))
			and 	((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or (a.nm_usuario = wheb_usuario_pck.get_nm_usuario))
			and 	((a.dt_inicio between r_c01_w.dt_inicio and r_c01_w.dt_fim) or (a.dt_fim between r_c01_w.dt_inicio and r_c01_w.dt_fim) or (coalesce(a.dt_fim::text, '') = '' and a.dt_inicio < r_c01_w.dt_inicio) or (a.dt_fim > r_c01_w.dt_fim and a.dt_inicio < r_c01_w.dt_inicio) or	
					 (((a.dt_inicio >  r_c01_w.dt_inicio) and (coalesce(ie_continuo_w,'N') = 'S')) or ((coalesce(ie_continuo_w,'N') = 'N') and (r_c01_w.dt_inicio <= a.dt_inicio)  and r_c01_w.dt_fim > a.dt_inicio)) or (a.ie_retrogrado = 'S' and coalesce(a.dt_liberacao::text, '') = ''));
					
			if (ie_return_value_w = 'S') then
				ds_retorno_p := 'N';
				goto return_value;
			end if;
			--FIM INCONSISTENCIA DA CPOE (BARRA VERMELHA)
		elsif (r_c01_w.ie_tipo_dialise = 'DP') then
			--CAMPOS OBRIGATORIOS
			if (coalesce(r_c01_w.ie_tipo_dialise::text, '') = '' or coalesce(r_c01_w.ie_tipo_peritoneal::text, '') = '' or coalesce(r_c01_w.qt_hora_min_sessao::text, '') = '' or coalesce(r_c01_w.nr_seq_protocolo::text, '') = ''
				or coalesce(r_c01_w.cd_mat_soluc1::text, '') = '' or coalesce(r_c01_w.qt_dose_soluc1::text, '') = '' or coalesce(r_c01_w.cd_unid_med_dose_sol1::text, '') = '' or coalesce(r_c01_w.ie_tipo_solucao::text, '') = '') then
				ds_retorno_p := 'N';
				goto return_value;
			end if;

			if (cpoe_shoppingcart_vigencia(null, 'P', r_c01_w.dt_inicio, 'N', r_c01_w.ie_duracao,r_c01_w.dt_fim, 'N', ie_retrogrado_p) = 'S') then
				ds_retorno_p := 'N';
				goto return_value;
			end if;
			--FIM CAMPOS OBRIGATORIOS

			--INCONSISTENCIA DA CPOE (BARRA VERMELHA)
			select	CASE WHEN count(*)=0 THEN  'N'  ELSE 'S' END  ie_duplicado
			into STRICT	ie_return_value_w
			from 	cpoe_dialise a
			where	a.nr_sequencia <> coalesce(r_c01_w.nr_sequencia,0)
			and		obter_se_cpoe_regra_duplic('DP', wheb_usuario_pck.get_cd_perfil, r_c01_w.cd_setor_atend) = 'S'
			and		a.ie_tipo_dialise = 'DP'
			and		((a.nr_atendimento = r_c01_w.nr_atendimento) or (a.cd_pessoa_fisica = r_c01_w.cd_pessoa_fisica and coalesce(a.nr_atendimento::text, '') = ''))
			and		(((a.dt_lib_suspensao IS NOT NULL AND a.dt_lib_suspensao::text <> '') and (a.dt_suspensao > clock_timestamp())) or (coalesce(a.dt_lib_suspensao::text, '') = ''))
			and 	((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or (a.nm_usuario = wheb_usuario_pck.get_nm_usuario))		
			and 	((a.dt_inicio between r_c01_w.dt_inicio and r_c01_w.dt_fim) or (a.dt_fim between r_c01_w.dt_inicio and r_c01_w.dt_fim) or (coalesce(a.dt_fim::text, '') = '' and a.dt_inicio < r_c01_w.dt_inicio) or (a.dt_fim > r_c01_w.dt_fim and a.dt_inicio < r_c01_w.dt_inicio) or	
					 (((a.dt_inicio >  r_c01_w.dt_inicio) and (coalesce(ie_continuo_w,'N') = 'S')) or ((coalesce(ie_continuo_w,'N') = 'N') and (r_c01_w.dt_inicio <= a.dt_inicio)  and r_c01_w.dt_fim > a.dt_inicio)) or (a.ie_retrogrado = 'S' and coalesce(a.dt_liberacao::text, '') = ''));
					
			if (ie_return_value_w = 'S') then
				ds_retorno_p := 'N';
				goto return_value;
			end if;
			--DUPLICIDADE MEDICAMENTO ASSOCIADO
			if (cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc1, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc2, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc3, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc4, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc5, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc6, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc7, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'

				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc1_2, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc2_2, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc3_2, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc4_2, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc5_2, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc6_2, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc7_2, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'

				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc1_3, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc2_3, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc3_3, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc4_3, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc5_3, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc6_3, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc7_3, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'

				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc1_4, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc2_4, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc3_4, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc4_4, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc5_4, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc6_4, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc7_4, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'

				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc1_5, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc2_5, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc3_5, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc4_5, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc5_5, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc6_5, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S'
				or cpoe_shoppingcart_medic_duplic(r_c01_w.nr_sequencia, r_c01_w.cd_setor_atend, r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc7_5, r_c01_w.dt_inicio, r_c01_w.dt_fim) = 'S') then
				ds_retorno_p := 'N';
				goto return_value;
			end if;
			--NAO PADRONIZADO
			if (cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc1, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc2, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc3, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc4, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc5, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc6, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc7, 'N') = 'N'

				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc1_2, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc2_2, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc3_2, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc4_2, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc5_2, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc6_2, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc7_2, 'N') = 'N'

				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc1_3, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc2_3, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc3_3, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc4_3, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc5_3, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc6_3, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc7_3, 'N') = 'N'

				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc1_4, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc2_4, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc3_4, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc4_4, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc5_4, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc6_4, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc7_4, 'N') = 'N'

				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc1_5, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc2_5, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc3_5, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc4_5, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc5_5, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc6_5, 'N') = 'N'
				or cpoe_obter_se_mat_padronizado(wheb_usuario_pck.get_cd_estabelecimento, r_c01_w.cd_mat_soluc7_5, 'N') = 'N') then
				ds_retorno_p := 'N';
				goto return_value;
			end if;
			--DOSE MIN E MAX
			SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT11', r_c01_w.cd_mat_soluc1, r_c01_w.qt_dose_soluc1, null, r_c01_w.cd_unid_med_dose_sol1, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT21', r_c01_w.cd_mat_soluc2, r_c01_w.qt_dose_soluc2, null, r_c01_w.cd_unid_med_dose_sol2, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;			

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT31', r_c01_w.cd_mat_soluc3, r_c01_w.qt_dose_soluc3, null, r_c01_w.cd_unid_med_dose_sol3, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT41', r_c01_w.cd_mat_soluc4, r_c01_w.qt_dose_soluc4, null, r_c01_w.cd_unid_med_dose_sol4, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT51', r_c01_w.cd_mat_soluc5, r_c01_w.qt_dose_soluc5, null, r_c01_w.cd_unid_med_dose_sol5, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT61', r_c01_w.cd_mat_soluc6, r_c01_w.qt_dose_soluc6, null, r_c01_w.cd_unid_med_dose_sol6, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;		
											
			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT71', r_c01_w.cd_mat_soluc7, r_c01_w.qt_dose_soluc7, null, r_c01_w.cd_unid_med_dose_sol7, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;	
			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT12', r_c01_w.cd_mat_soluc1_2, r_c01_w.qt_dose_soluc1_2, null, r_c01_w.cd_unid_med_dose_sol1_2, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;
			
			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT22', r_c01_w.cd_mat_soluc2_2, r_c01_w.qt_dose_soluc2_2, null, r_c01_w.cd_unid_med_dose_sol2_2, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;		

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT32', r_c01_w.cd_mat_soluc3_2, r_c01_w.qt_dose_soluc3_2, null, r_c01_w.cd_unid_med_dose_sol3_2, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;
			
			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT42', r_c01_w.cd_mat_soluc4_2, r_c01_w.qt_dose_soluc4_2, null, r_c01_w.cd_unid_med_dose_sol4_2, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;
			
			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT52', r_c01_w.cd_mat_soluc5_2, r_c01_w.qt_dose_soluc5_2, null, r_c01_w.cd_unid_med_dose_sol5_2, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;
			
			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT62', r_c01_w.cd_mat_soluc6_2, r_c01_w.qt_dose_soluc6_2, null, r_c01_w.cd_unid_med_dose_sol6_2, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;
			
			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT72', r_c01_w.cd_mat_soluc7_2, r_c01_w.qt_dose_soluc7_2, null, r_c01_w.cd_unid_med_dose_sol7_2, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;
			
			
			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT13', r_c01_w.cd_mat_soluc1_3, r_c01_w.qt_dose_soluc1_3, null, r_c01_w.cd_unid_med_dose_sol1_3, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT23', r_c01_w.cd_mat_soluc2_3, r_c01_w.qt_dose_soluc2_3, null, r_c01_w.cd_unid_med_dose_sol2_3, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;	
			
			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT33', r_c01_w.cd_mat_soluc3_3, r_c01_w.qt_dose_soluc3_3, null, r_c01_w.cd_unid_med_dose_sol3_3, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;
			
			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT43', r_c01_w.cd_mat_soluc4_3, r_c01_w.qt_dose_soluc4_3, null, r_c01_w.cd_unid_med_dose_sol4_3, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;
			
			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT53', r_c01_w.cd_mat_soluc5_3, r_c01_w.qt_dose_soluc5_3, null, r_c01_w.cd_unid_med_dose_sol5_3, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT63', r_c01_w.cd_mat_soluc6_3, r_c01_w.qt_dose_soluc6_3, null, r_c01_w.cd_unid_med_dose_sol6_3, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT73', r_c01_w.cd_mat_soluc7_3, r_c01_w.qt_dose_soluc7_3, null, r_c01_w.cd_unid_med_dose_sol7_3, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT14', r_c01_w.cd_mat_soluc1_4, r_c01_w.qt_dose_soluc1_4, null, r_c01_w.cd_unid_med_dose_sol1_4, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT24', r_c01_w.cd_mat_soluc2_4, r_c01_w.qt_dose_soluc2_4, null, r_c01_w.cd_unid_med_dose_sol2_4, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT34', r_c01_w.cd_mat_soluc3_4, r_c01_w.qt_dose_soluc3_4, null, r_c01_w.cd_unid_med_dose_sol3_4, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT44', r_c01_w.cd_mat_soluc4_4, r_c01_w.qt_dose_soluc4_4, null, r_c01_w.cd_unid_med_dose_sol4_4, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT54', r_c01_w.cd_mat_soluc5_4, r_c01_w.qt_dose_soluc5_4, null, r_c01_w.cd_unid_med_dose_sol5_4, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT64', r_c01_w.cd_mat_soluc6_4, r_c01_w.qt_dose_soluc6_4, null, r_c01_w.cd_unid_med_dose_sol6_4, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT74', r_c01_w.cd_mat_soluc7_4, r_c01_w.qt_dose_soluc7_4, null, r_c01_w.cd_unid_med_dose_sol7_4, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT15', r_c01_w.cd_mat_soluc1_5, r_c01_w.qt_dose_soluc1_5, null, r_c01_w.cd_unid_med_dose_sol1_5, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT25', r_c01_w.cd_mat_soluc2_5, r_c01_w.qt_dose_soluc2_5, null, r_c01_w.cd_unid_med_dose_sol2_5, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT35', r_c01_w.cd_mat_soluc3_5, r_c01_w.qt_dose_soluc3_5, null, r_c01_w.cd_unid_med_dose_sol3_5, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT45', r_c01_w.cd_mat_soluc4_5, r_c01_w.qt_dose_soluc4_5, null, r_c01_w.cd_unid_med_dose_sol4_5, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT55', r_c01_w.cd_mat_soluc5_5, r_c01_w.qt_dose_soluc5_5, null, r_c01_w.cd_unid_med_dose_sol5_5, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT65', r_c01_w.cd_mat_soluc6_5, r_c01_w.qt_dose_soluc6_5, null, r_c01_w.cd_unid_med_dose_sol6_5, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;

			if (coalesce(nr_return_value_w::text, '') = '' or nr_return_value_w = 0) then
				SELECT * FROM cpoe_shoppingcart_dose_max_min(r_c01_w.nr_atendimento, r_c01_w.nr_sequencia, 'HMAT75', r_c01_w.cd_mat_soluc7_5, r_c01_w.qt_dose_soluc7_5, null, r_c01_w.cd_unid_med_dose_sol7_5, null, r_c01_w.cd_pessoa_fisica, null, null, null, null, null, null, null, null, null, r_c01_w.dt_inicio, r_c01_w.dt_fim, r_c01_w.ie_duracao, null, null, 'A') INTO STRICT nr_return_value_w, active_ingred_consist_w;
			end if;

			if ((nr_return_value_w IS NOT NULL AND nr_return_value_w::text <> '') and nr_return_value_w > 0) then
				ds_retorno_p := 'N';
				goto return_value;
			end if;
			--ALERGIA
			SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc1, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			
			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc2, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;	

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc3, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;	

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc4, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;	

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc5, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;	

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc6, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;	

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc7, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;	

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc1_2, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;	

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc2_2, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;	

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc3_2, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;	

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc4_2, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;	

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc5_2, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;	

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc6_2, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;	

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc7_2, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;	

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc1_3, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc2_3, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc3_3, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc4_3, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc5_3, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc6_3, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc7_3, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc1_4, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc2_4, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc3_4, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc4_4, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc5_4, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc6_4, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc7_4, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc1_5, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc2_5, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc3_5, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc4_5, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc5_5, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc6_5, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;

			if (ie_return_value_w = 'N') then
				SELECT * FROM cpoe_verifica_se_pac_alergico(r_c01_w.cd_pessoa_fisica, r_c01_w.cd_mat_soluc7_5, ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, 'N', nr_seq_ficha_tecnica_w) INTO STRICT ie_return_value_w, ds_alergia_w, ie_severidade_w, nr_seq_reacao_w, nr_seq_ficha_tecnica_w;
			end if;

			if (ie_return_value_w = 'S') then
				ds_retorno_p := 'N';
				goto return_value;
			end if;
			--INTERACAO FARMACO X FARMACO
			if (cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc1, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc2, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc3, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc4, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc5, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc6, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc7, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'

				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc1_2, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc2_2, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc3_2, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc4_2, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc5_2, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc6_2, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc7_2, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'

				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc1_3, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc2_3, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc3_3, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc4_3, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc5_3, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc6_3, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc7_3, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'

				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc1_4, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc2_4, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc3_4, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc4_4, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc5_4, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc6_4, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc7_4, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'

				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc1_5, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc2_5, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc3_5, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc4_5, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc5_5, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc6_5, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S'
				or cpoe_obter_se_interacao_medic(r_c01_w.cd_mat_soluc7_5, r_c01_w.nr_atendimento, r_c01_w.cd_pessoa_fisica, r_c01_w.nr_sequencia) = 'S') then
				ds_retorno_p := 'N';
				goto return_value;
			end if;
			--LATEX MEDICAMENTO ASSOCIADO
			if (cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc1, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc2, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc3, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc4, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc5, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc6, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc7, r_c01_w.cd_pessoa_fisica) = 'S'

				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc1_2, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc2_2, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc3_2, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc4_2, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc5_2, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc6_2, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc7_2, r_c01_w.cd_pessoa_fisica) = 'S'

				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc1_3, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc2_3, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc3_3, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc4_3, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc5_3, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc6_3, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc7_3, r_c01_w.cd_pessoa_fisica) = 'S'

				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc1_4, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc2_4, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc3_4, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc4_4, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc5_4, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc6_4, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc7_4, r_c01_w.cd_pessoa_fisica) = 'S'

				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc1_5, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc2_5, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc3_5, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc4_5, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc5_5, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc6_5, r_c01_w.cd_pessoa_fisica) = 'S'
				or cpoe_shoppingcart_se_latex(r_c01_w.cd_mat_soluc7_5, r_c01_w.cd_pessoa_fisica) = 'S') then

				ds_retorno_p := 'N';
				goto return_value;
			end if;
			--FIM INCONSISTENCIA DA CPOE (BARRA VERMELHA)
		end if;
	end loop;
end if;

<<return_value>>
 null;
exception when others then
	CALL gravar_log_cpoe(substr('CPOE_SHOPPINGCART_DIALYSIS EXCEPTION:'|| substr(to_char(sqlerrm),1,2000) || '//nr_sequencia_p: '|| nr_sequencia_p,1,40000));
	ds_retorno_p := 'N';
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_shoppingcart_dialysis (nr_sequencia_p bigint, ie_retrogrado_p text, ds_retorno_p INOUT text) FROM PUBLIC;

