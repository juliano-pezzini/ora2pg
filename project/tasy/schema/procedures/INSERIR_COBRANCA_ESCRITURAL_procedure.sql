-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_cobranca_escritural ( nr_seq_cobranca_p bigint, nr_titulo_p bigint, vl_cobranca_p bigint, cd_banco_p bigint, vl_acrescimo_p bigint, vl_desconto_p bigint, cd_ocorrencia_p text, qt_dias_instrucao_p bigint, nm_usuario_p text, ds_mensagem_p INOUT text) AS $body$
DECLARE


cd_agencia_bancaria_w	varchar(8);
cd_conta_w		banco_estabelecimento.cd_conta%type;
ie_digito_conta_w	varchar(2);


BEGIN

	select	a.cd_agencia_bancaria,
		a.cd_conta,
		coalesce(a.ie_digito_conta,null) ie_digito_conta
	into STRICT 	cd_agencia_bancaria_w,
		cd_conta_w,
		ie_digito_conta_w
	from	banco_estabelecimento_v a,
		cobranca_escritural b
	where	b.nr_seq_conta_banco = a.nr_sequencia
	and	b.nr_sequencia = nr_seq_cobranca_p;

	insert into 	titulo_receber_cobr(nr_seq_cobranca,
			nr_titulo,
			vl_cobranca,
			dt_atualizacao,
			nm_usuario,
			cd_banco,
			vl_acrescimo,
			vl_desconto,
			cd_ocorrencia,
			cd_agencia_bancaria,
			nr_conta,
			ie_digito_conta,
			nr_seq_ocorrencia_ret,
			qt_dias_instrucao,
			nr_sequencia)
		values (nr_seq_cobranca_p,
			nr_titulo_p,
			vl_cobranca_p,
			clock_timestamp(),
			nm_usuario_p,
			cd_banco_p,
			vl_acrescimo_p,
			vl_desconto_p,
			cd_ocorrencia_p,
			cd_agencia_bancaria_w,
			cd_conta_w,
			ie_digito_conta_w,
			null,
			qt_dias_instrucao_p,
			nextval('titulo_receber_cobr_seq'));

commit;

ds_mensagem_p := obter_texto_tasy(175196, wheb_usuario_pck.get_nr_seq_idioma);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_cobranca_escritural ( nr_seq_cobranca_p bigint, nr_titulo_p bigint, vl_cobranca_p bigint, cd_banco_p bigint, vl_acrescimo_p bigint, vl_desconto_p bigint, cd_ocorrencia_p text, qt_dias_instrucao_p bigint, nm_usuario_p text, ds_mensagem_p INOUT text) FROM PUBLIC;

