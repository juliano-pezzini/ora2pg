-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE remover_dados_qb_ld_dar (nr_seq_qb_dados_p bigint) AS $body$
BEGIN

	DELETE
	FROM QUERY_BUILDER_DISPLAY qbdi
	WHERE EXISTS (
		SELECT
			1 
		from
			query_builder_dados qbda 
		where
			qbdi.nm_tabela = qbda.nm_tabela
			and qbdi.nr_seq_elemento = qbda.nr_seq_elemento 
			and qbda.nr_sequencia = nr_seq_qb_dados_p
	);

    DELETE FROM DAR_QUERY_CONDITIONS WHERE NR_SEQUENCIA IN (SELECT dqc.nr_sequencia FROM 
		DAR_QUERY_CONDITIONS dqc,
		tabela_atributo_linked tal,
		ehr_template_conteudo etc, 
		ehr_template et
		WHERE tal.nr_sequencia = dqc.nr_seq_tab_atrib_link
		AND tal.nr_seq_elemento = etc.nr_sequencia 
		AND etc.nr_seq_template = et.nr_sequencia
		AND EXISTS (
			SELECT
				1 
			from
				query_builder_dados qbda 
			where
				dqc.nm_tabela = qbda.nm_tabela
				and etc.nr_sequencia = qbda.nr_seq_elemento 
				and qbda.nr_sequencia = nr_seq_qb_dados_p
		)
	);

    DELETE 
	FROM DAR_QUERY_FILTER_DATE dqfd
	WHERE EXISTS (
		SELECT
			1 
		from
			query_builder_dados qbda 
		where
			dqfd.nm_tabela = qbda.nm_tabela
			and dqfd.nr_seq_elemento = qbda.nr_seq_elemento 
			and qbda.nr_sequencia = nr_seq_qb_dados_p
	);

    DELETE FROM QUERY_BUILDER_DADOS WHERE NR_SEQUENCIA = nr_seq_qb_dados_p;

    commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE remover_dados_qb_ld_dar (nr_seq_qb_dados_p bigint) FROM PUBLIC;

