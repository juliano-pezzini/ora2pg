-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_estrutura_conta ( nr_sequencia_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_sequencia_w			bigint := 0;
nr_seq_anterior_w		bigint := 0;
cd_estrutura_w			integer := 0;
ds_titulo_w			varchar(80) := '';
nr_seq_conta_w			integer := 0;
ie_nova_pagina_w		varchar(1)  := '';
ie_soma_total_w			varchar(1)  := '';
ie_sintetico_w			varchar(1)  := '';
ie_toda_pagina_w		varchar(1)  := '';
ie_total_estrut_w		varchar(1)  := 'N';
ie_imprime_zerado_w		varchar(1)  := 'N';
ie_imprime_item_zerado_w	varchar(1)  := 'N';
ie_status_conta_w		smallint;
ie_custo_oper_zerado_w		varchar(01);
ie_total_desconto_w		varchar(01)	:= 'N';
ie_protocolo_w			varchar(1);
cd_convenio_w			integer;
cd_estabelecimento_w		smallint;
IE_SOMENTE_TOTAL_ESTRUT_w	varchar(1);

c01 CURSOR FOR
SELECT 	nr_sequencia,
	cd_estrutura,
	ds_titulo,
	nr_seq_conta,
	ie_nova_pagina,
	ie_soma_total,
	ie_sintetico,
	ie_toda_pagina,
	ie_total_estrut,
	ie_imprime_zerado,
	ie_imprime_item_zerado,
	ie_status_conta,
	ie_custo_oper_zerado,
	ie_total_desconto,
	ie_protocolo,
	cd_convenio,
	cd_estabelecimento,
	IE_SOMENTE_TOTAL_ESTRUT
from 	convenio_estrutura_conta
where 	nr_sequencia = nr_sequencia_p;


BEGIN

open c01;
loop
fetch c01 into
        nr_seq_anterior_w,
	cd_estrutura_w,
	ds_titulo_w,
	nr_seq_conta_w,
	ie_nova_pagina_w,
	ie_soma_total_w,
	ie_sintetico_w,
	ie_toda_pagina_w,
	ie_total_estrut_w,
	ie_imprime_zerado_w,
	ie_imprime_item_zerado_w,
	ie_status_conta_w,
	ie_custo_oper_zerado_w,
	ie_total_desconto_w,
	ie_protocolo_w,
	cd_convenio_w,
	cd_estabelecimento_w,
	IE_SOMENTE_TOTAL_ESTRUT_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin
	select 	max(nr_sequencia) + 1
       	into STRICT 	nr_sequencia_w
       	from 	convenio_estrutura_conta;

	insert into convenio_estrutura_conta(nr_sequencia,
		cd_estrutura,
		cd_convenio,
		ds_titulo,
		nr_seq_conta,
		ie_nova_pagina,
		nm_usuario,
		dt_atualizacao,
		ie_soma_total,
		ie_sintetico,
		ie_toda_pagina,
		ie_total_estrut,
		ie_imprime_zerado,
		ie_imprime_item_zerado,
		ie_status_conta,
		ie_custo_oper_zerado,
		ie_total_desconto,
		ie_protocolo,
		cd_estabelecimento,
		IE_SOMENTE_TOTAL_ESTRUT)
	values (nr_sequencia_w,
		cd_estrutura_w,
		cd_convenio_w,
		ds_titulo_w,
		nr_seq_conta_w,
		ie_nova_pagina_w,
		nm_usuario_p,
		clock_timestamp(),
		ie_soma_total_w,
		ie_sintetico_w,
		ie_toda_pagina_w,
		ie_total_estrut_w,
		ie_imprime_zerado_w,
		ie_imprime_item_zerado_w,
		ie_status_conta_w,
		ie_custo_oper_zerado_w,
		ie_total_desconto_w,
		ie_protocolo_w,
		cd_estabelecimento_w,
		coalesce(IE_SOMENTE_TOTAL_ESTRUT_W,'N'));

	insert into convenio_estrut_atrib(nr_sequencia,
		nm_atributo,
		nr_seq_atributo,
		dt_atualizacao,
		nm_usuario,
		nm_alias,
		ds_mascara,
		ie_totaliza,
		ie_quebra,
		qt_tamanho,
		ie_imprime,
		ie_soma_total,
		ie_soma_estrutura,
		qt_tam_fonte,
		nr_seq_interno,
		ie_estender,
		nm_tabela_conversao,
		nm_atributo_conversao,
		nr_seq_ordem,
		ie_ordena_decrescente)
		SELECT	nr_sequencia_w,
			nm_atributo,
			nr_seq_atributo,
			clock_timestamp(),
			nm_usuario_p,
			nm_alias,
			ds_mascara,
			ie_totaliza,
			ie_quebra,
			qt_tamanho,
			ie_imprime,
			ie_soma_total,
			ie_soma_estrutura,
			qt_tam_fonte,
			nextval('convenio_estrut_atrib_seq'),
			ie_estender,
			nm_tabela_conversao,
			nm_atributo_conversao,
			nr_seq_ordem,
			ie_ordena_decrescente
		from convenio_estrut_atrib
		where nr_sequencia = nr_seq_anterior_w;
	end;
end loop;
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_estrutura_conta ( nr_sequencia_p bigint, nm_usuario_p text) FROM PUBLIC;

