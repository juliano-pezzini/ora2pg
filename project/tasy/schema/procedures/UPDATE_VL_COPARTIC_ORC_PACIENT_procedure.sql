-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE update_vl_copartic_orc_pacient (nr_seq_orcamento_p orcamento_paciente.nr_sequencia_orcamento%type, nm_usuario_p orcamento_paciente.nm_usuario%type) AS $body$
DECLARE


nr_sequencia_w orcamento_paciente_proc.nr_sequencia%type;
vl_coparticipacao_w procedimento_guia_wint.vl_coparticipacao%type;

c_proced_orc_pacient CURSOR FOR
SELECT  b.nr_sequencia,
        c.vl_coparticipacao
from    orcamento_paciente a,
        orcamento_paciente_proc b,
        procedimento_guia_wint c
where   a.nr_sequencia_orcamento = b.nr_sequencia_orcamento
and     b.nr_sequencia_orcamento = c.nr_sequencia_orcamento
and     b.nr_sequencia = c.nr_seq_proc_orc
and     a.nr_sequencia_orcamento = nr_seq_orcamento_p;


BEGIN

open c_proced_orc_pacient;
loop
        fetch c_proced_orc_pacient into
                nr_sequencia_w,
                vl_coparticipacao_w;
        EXIT WHEN NOT FOUND; /* apply on c_proced_orc_pacient */

        update  orcamento_paciente_proc a
        set     a.vl_coparticipacao = vl_coparticipacao_w,
                a.nm_usuario = nm_usuario_p,
                a.dt_atualizacao = clock_timestamp()
        where   a.nr_sequencia = nr_sequencia_w;

        commit;
end loop;
close c_proced_orc_pacient;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE update_vl_copartic_orc_pacient (nr_seq_orcamento_p orcamento_paciente.nr_sequencia_orcamento%type, nm_usuario_p orcamento_paciente.nm_usuario%type) FROM PUBLIC;

