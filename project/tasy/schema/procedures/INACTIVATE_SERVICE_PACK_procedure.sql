-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inactivate_service_pack (NR_SERVICE_PACK_P Man_Service_Pack_Versao.Nr_Service_Pack%TYPE, IE_SITUACAO_INATIVO_P Man_Service_Pack_Versao.Ie_Situacao_Service_Pack%TYPE, CD_VERSAO_P Man_Service_Pack_Versao.Cd_Versao%TYPE, NM_USUARIO_P Man_Service_Pack_Versao.Nm_Usuario%TYPE) AS $body$
DECLARE


  
  ds_mail_orig CONSTANT varchar(50) := 'support.informatics@philips.com';
  ie_platform CONSTANT varchar(1) := 'H';

  ds_mail_destino_w varchar(2000);
  cd_complete_version_w varchar(500);
  ds_mensagem_w varchar(2000);
  ds_title_w varchar(500);

  err_msg varchar(1000);

BEGIN

  update MAN_SERVICE_PACK_VERSAO
  set ie_situacao_service_pack = IE_SITUACAO_INATIVO_P,
  nm_usuario = nm_usuario_p,
  dt_atualizacao = clock_timestamp()
  where nr_service_pack = NR_SERVICE_PACK_P 
  and cd_versao = CD_VERSAO_P;


  insert into
  TASY_BLOCK_BUILD(nr_sequencia,
  dt_atualizacao,
  nm_usuario,
  dt_atualizacao_nrec,
  nm_usuario_nrec,
  cd_versao,
  cd_build,
  ie_aplicacao)
  values (nextval('tasy_block_build_seq'),
  clock_timestamp(), 
  NM_USUARIO_P,
  clock_timestamp(), 
  NM_USUARIO_P,
  CD_VERSAO_P, 
  NR_SERVICE_PACK_P,
  ie_platform);
  commit;

  cd_complete_version_w := CD_VERSAO_P||'.'||lpad(NR_SERVICE_PACK_P, 2, '0');
  ds_title_w := Wheb_Mensagem_Pck.Get_Texto(1108136,'CD_VERSION_SP='||cd_complete_version_W);
  EXECUTE 'get_emails_build(build_pendente => ''N'',
                                        liberacao_build => ''N'',
                                        solicitacao_emer => ''N'',
                                        solicitacao_pmo => ''N'',
                                        build_fila => ''N'',
                                        inativa_sp => ''S'')' into STRICT ds_mail_destino_w;

  ds_mensagem_w := Wheb_Mensagem_Pck.Get_Texto(1122158,'CD_VERSION_SP='||cd_complete_version_W)||' User: '||NM_USUARIO_P|| Chr(13);


  CALL enviar_email(	ds_title_w, ds_mensagem_w, ds_mail_orig, 	ds_mail_destino_w, 'Tasy', null);
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inactivate_service_pack (NR_SERVICE_PACK_P Man_Service_Pack_Versao.Nr_Service_Pack%TYPE, IE_SITUACAO_INATIVO_P Man_Service_Pack_Versao.Ie_Situacao_Service_Pack%TYPE, CD_VERSAO_P Man_Service_Pack_Versao.Cd_Versao%TYPE, NM_USUARIO_P Man_Service_Pack_Versao.Nm_Usuario%TYPE) FROM PUBLIC;

