-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE nut_reserva_pf_before_delete ( nr_seq_nut_reserva_p bigint, nr_sequencia_p bigint, ie_reserva_p INOUT text, qt_data_p INOUT bigint, cd_estabelecimento_p bigint, nr_tempo_exclusao_p bigint, nm_usuario_p text) AS $body$
DECLARE


ie_reserva_w	varchar(1);
qt_data_w	bigint;
vl_parametro_w	integer;




BEGIN

if (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') then
	begin

	ie_reserva_w := obter_se_bloqueia_reserva( nr_seq_nut_reserva_p);


	select obter_min_entre_datas(clock_timestamp(), to_date(substr(obter_dados_nut_reserva(nr_seq_nut_reserva,'D'),1,80) ||  ' ' ||
        substr(obter_dados_nut_reserva(nr_seq_nut_reserva,'I'),1,10),'dd/mm/yyyy hh24:mi:ss'), 1)
	into STRICT	qt_data_w
	from 	nut_reserva_pf
	where 	nr_sequencia = nr_sequencia_p;

	if (nr_tempo_exclusao_p IS NOT NULL AND nr_tempo_exclusao_p::text <> '') and (qt_data_w < nr_tempo_exclusao_p) then
		begin
		CALL Wheb_mensagem_pck.exibir_mensagem_abort(53323);
		end;
	end if;

	end;
end if;

ie_reserva_p	:= ie_reserva_w;
qt_data_p	:= qt_data_w;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE nut_reserva_pf_before_delete ( nr_seq_nut_reserva_p bigint, nr_sequencia_p bigint, ie_reserva_p INOUT text, qt_data_p INOUT bigint, cd_estabelecimento_p bigint, nr_tempo_exclusao_p bigint, nm_usuario_p text) FROM PUBLIC;

