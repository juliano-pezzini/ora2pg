-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE generate_con_cod_medida ( nr_sequencia_p COD_CON_DATA.NR_SEQUENCIA%TYPE) AS $body$
DECLARE


TYPE cod_con_medida_type IS TABLE OF COD_CON_MEDIDA%ROWTYPE INDEX BY integer;
TYPE cod_con_registro_type IS TABLE OF COD_CON_REGISTRO%ROWTYPE INDEX BY integer;

cod_con_medida_row       cod_con_medida_type;
cod_con_registro_row     cod_con_registro_type;
dt_atual_s               CONSTANT COD_CON_MEDIDA.DT_ATUALIZACAO%TYPE := clock_timestamp();
			
BEGIN

  SELECT *
  BULK COLLECT INTO STRICT cod_con_registro_row
  FROM COD_CON_REGISTRO a
  ORDER BY CAST(a.CD_NUMMED as integer);

  IF (cod_con_registro_row.FIRST IS NOT NULL AND cod_con_registro_row.FIRST::text <> '') THEN
    FOR registro_index_w IN cod_con_registro_row.FIRST..cod_con_registro_row.LAST LOOP
        cod_con_medida_row[registro_index_w].nr_sequencia := obter_nextval_sequence('COD_CON_MEDIDA');
        cod_con_medida_row[registro_index_w].dt_atualizacao := dt_atual_s;
        cod_con_medida_row[registro_index_w].dt_atualizacao_nrec := dt_atual_s;
        cod_con_medida_row[registro_index_w].nm_usuario := wheb_usuario_pck.get_nm_usuario;
        cod_con_medida_row[registro_index_w].nm_usuario_nrec := wheb_usuario_pck.get_nm_usuario;
        cod_con_medida_row[registro_index_w].nr_seq_cod_con_data := nr_sequencia_p;
        cod_con_medida_row[registro_index_w].ds_pergunta := cod_con_registro_row[registro_index_w].ds_question;
        cod_con_medida_row[registro_index_w].cd_nummed := cod_con_registro_row[registro_index_w].cd_nummed;
    END LOOP;
  END IF;

  IF (cod_con_medida_row.FIRST IS NOT NULL AND cod_con_medida_row.FIRST::text <> '') THEN
    FORALL i IN cod_con_medida_row.FIRST..cod_con_medida_row.LAST  
    INSERT INTO COD_CON_MEDIDA VALUES cod_con_medida_row(i);
  END IF;

  COMMIT;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE generate_con_cod_medida ( nr_sequencia_p COD_CON_DATA.NR_SEQUENCIA%TYPE) FROM PUBLIC;

