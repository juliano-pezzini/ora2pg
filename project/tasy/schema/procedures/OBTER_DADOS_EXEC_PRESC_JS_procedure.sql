-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_dados_exec_presc_js ( nr_prescricao_p bigint, cd_setor_p bigint, cd_procedimento_p bigint, nr_atendimento_p bigint, ie_origem_proced_p text, ds_convenio_p INOUT text, ds_setor_atend_p INOUT text, nr_fone_celular_p INOUT text, cd_cep_p INOUT text, ds_bairro_p INOUT text, ds_endereco_p INOUT text, ds_exame_p INOUT text, ds_tipo_exame_p INOUT text, cd_pessoa_fisica_p INOUT text, nm_paciente_p INOUT text, ds_setor_exec_p INOUT text, nm_usuario_p text) AS $body$
DECLARE

 
ie_proced_exec_w	varchar(2000);

BEGIN
if (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') then 
	begin 
 
	select	cd_pessoa_fisica 
	into STRICT	cd_pessoa_fisica_p 
	from	prescr_medica 
	where	nr_prescricao = nr_prescricao_p;
 
	select	'R.N. ' 
	into STRICT	nm_paciente_p 
	from	prescr_medica 
	where	ie_recem_nato = 'S' 
	and	nr_prescricao = nr_prescricao_p;
 
	select	ds_setor_atendimento 
	into STRICT	ds_setor_exec_p 
	from	setor_atendimento 
	where	cd_setor_atendimento = cd_setor_p;
 
	ie_proced_exec_w := obter_param_usuario(24, 85, obter_perfil_ativo, nm_usuario_p, wheb_usuario_pck.get_cd_estabelecimento, ie_proced_exec_w);
 
	if (ie_proced_exec_w = 'S')	then 
		ds_tipo_exame_p	:= Obter_Desc_Tipo_Procedimento(cd_procedimento_p, ie_origem_proced_p);
	else 
		begin 
		ds_exame_p := obter_exames_prescricao(nr_prescricao_p, cd_setor_p, 'D', 'S');
		ds_tipo_exame_p := obter_exames_prescricao(nr_prescricao_p, cd_setor_p, 'TSR', 'N');
		end;
	end if;
 
	ds_endereco_p	:= substr(obter_compl_pf(cd_pessoa_fisica_p, 1, 'EN'), 1, 255);
	ds_bairro_p	:= substr(obter_compl_pf(cd_pessoa_fisica_p, 1, 'B'), 1, 100);
	cd_cep_p	:= substr(obter_compl_pf(cd_pessoa_fisica_p, 1, 'CEP'), 1, 50);
	nr_fone_celular_p	:= substr(obter_dados_pf(cd_pessoa_fisica_p, 'TC'), 1, 100);
	ds_setor_atend_p	:= substr(obter_nome_setor(obter_setor_atendimento(nr_atendimento_p)), 1, 100);
	ds_convenio_p	:= substr(obter_nome_convenio(obter_convenio_atendimento(nr_atendimento_p)), 1, 100);
 
	end;
end if;
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_dados_exec_presc_js ( nr_prescricao_p bigint, cd_setor_p bigint, cd_procedimento_p bigint, nr_atendimento_p bigint, ie_origem_proced_p text, ds_convenio_p INOUT text, ds_setor_atend_p INOUT text, nr_fone_celular_p INOUT text, cd_cep_p INOUT text, ds_bairro_p INOUT text, ds_endereco_p INOUT text, ds_exame_p INOUT text, ds_tipo_exame_p INOUT text, cd_pessoa_fisica_p INOUT text, nm_paciente_p INOUT text, ds_setor_exec_p INOUT text, nm_usuario_p text) FROM PUBLIC;

