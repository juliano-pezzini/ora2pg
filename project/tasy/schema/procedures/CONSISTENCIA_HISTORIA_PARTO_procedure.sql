-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consistencia_historia_parto ( nr_atendimento_p bigint, dt_admissao_p timestamp, ie_parto_normal_p text, ie_parto_cesaria_p text, ie_laqueadura_p text, ie_parto_analgesia_p text, ie_parto_episio_p text, dt_inicio_parto_p timestamp) AS $body$
DECLARE

										
dt_entrada_w	timestamp;
cd_estabelecimento_w integer;
										

BEGIN

select	max(dt_entrada)
into STRICT	dt_entrada_w
from	atendimento_paciente
where	nr_atendimento = nr_atendimento_p;

select cd_estabelecimento
into STRICT cd_estabelecimento_w
from atendimento_paciente
where	nr_atendimento = nr_atendimento_p;

if (dt_entrada_w IS NOT NULL AND dt_entrada_w::text <> '') then
	begin
	if (dt_admissao_p IS NOT NULL AND dt_admissao_p::text <> '') and (dt_admissao_p < dt_entrada_w) then
		
		CALL Wheb_mensagem_pck.exibir_mensagem_abort(263516);
	end if;
	if (coalesce((pkg_i18n.get_user_locale()), 'pt_BR') <> 'de_AT') then
		if (coalesce(OBTER_UTILIZA_NOM(cd_estabelecimento_w),'N') = 'N') and (coalesce(ie_parto_normal_p,'N') = 'N') and (coalesce(ie_parto_cesaria_p,'N') = 'N') then
			
			CALL Wheb_mensagem_pck.exibir_mensagem_abort(263517);
		end if;

		if (coalesce(ie_parto_normal_p,'N') = 'S') and (coalesce(ie_laqueadura_p,'N') = 'S') then
			
			CALL Wheb_mensagem_pck.exibir_mensagem_abort(263525);
		end if;
		if (coalesce(ie_parto_cesaria_p,'N') = 'S') and (coalesce(ie_parto_analgesia_p,'N') = 'S') then
			
			CALL Wheb_mensagem_pck.exibir_mensagem_abort(263526);
		end if;
		if (coalesce(ie_parto_cesaria_p,'N') = 'S') and (coalesce(ie_parto_episio_p,'N') = 'S') then
			
			CALL Wheb_mensagem_pck.exibir_mensagem_abort(263528);
		end if;
	end if;
	if (dt_inicio_parto_p > clock_timestamp()) then
		begin
		
		CALL Wheb_mensagem_pck.exibir_mensagem_abort(263529);
		end;
	end if;

	if (dt_admissao_p IS NOT NULL AND dt_admissao_p::text <> '') and (dt_admissao_p > clock_timestamp()) then
		begin
		
		CALL Wheb_mensagem_pck.exibir_mensagem_abort(263530);
		end;
	end if;

	end;
	end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consistencia_historia_parto ( nr_atendimento_p bigint, dt_admissao_p timestamp, ie_parto_normal_p text, ie_parto_cesaria_p text, ie_laqueadura_p text, ie_parto_analgesia_p text, ie_parto_episio_p text, dt_inicio_parto_p timestamp) FROM PUBLIC;

