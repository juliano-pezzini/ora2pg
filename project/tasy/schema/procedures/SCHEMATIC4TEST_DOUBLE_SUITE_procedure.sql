-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE schematic4test_double_suite (NR_SEQUENCIA_P bigint, NM_USUARIO_P text) AS $body$
DECLARE

NR_SEQUENCIA_TEST_W bigint;
NR_SEQ_EXECUTION_W bigint;
NR_SEQ_SCRIPT_W bigint;
NR_SEQ_ROBOT_W bigint;
NR_SEQ_GRID_W bigint;
NR_SEQUENCIA_W bigint;
NR_SEQ_PRESET_W bigint;
IE_JOBS_W  varchar(255);
IE_SWITCH_W varchar(255);
IE_TEST_LOCAL_W  varchar(255);
NM_SUITE_W varchar(255);
NM_SUITE_W2 varchar(255);
ie_situacao_w varchar(255);
NEWSEQUENCESUITE bigint;
NEWSEQUENCETEST bigint;
DS_VERSION_W varchar(255);

C01 CURSOR FOR  --loop tests
SELECT tests.NR_SEQUENCIA NR_SEQUENCIA_TEST, tests.NR_SEQ_EXECUTION NR_SEQ_EXECUTION, tests.NR_SEQ_SCRIPT NR_SEQ_SCRIPT, tests.NR_SEQ_ROBOT NR_SEQ_ROBOT, tests.NR_SEQ_GRID NR_SEQ_GRID, tests.ie_switch
  INTO STRICT NR_SEQUENCIA_TEST_W, NR_SEQ_EXECUTION_W, NR_SEQ_SCRIPT_W, NR_SEQ_ROBOT_W, NR_SEQ_GRID_W, IE_SWITCH_W
FROM SCHEM_TEST_TEST tests
WHERE tests.NR_SEQ_SUITE = NR_SEQUENCIA_W
ORDER BY tests.NR_SEQ_EXECUTION ASC;


BEGIN
    --procedure to duplicate suite	
	INSERT INTO SCHEM_TEST_BEHOLDER(nr_sequencia, nm_usuario, dt_atualizacao, nm_usuario_nrec, dt_atualizacao_nrec, ds_interaction, ds_param_a)
	VALUES (nextval('schem_test_beholder_seq'), NM_USUARIO_P, clock_timestamp(), 'Robot', clock_timestamp(), 'SCHEMATIC4TEST_DOUBLE_SUITE',
	'NR_SEQUENCIA_P as '||NR_SEQUENCIA_P);
	
     SELECT suite.NR_SEQUENCIA NR_SEQUENCIA, suite.NR_SEQ_PRESET NR_SEQ_PRESET, suite.NM_SUITE NM_SUITE, suite.IE_JOBS IE_JOBS, suite.IE_TEST_LOCAL IE_TEST_LOCAL, suite.ie_situacao ie_situacao, suite.DS_VERSION DS_VERSION
        INTO STRICT NR_SEQUENCIA_W, NR_SEQ_PRESET_W, NM_SUITE_W, IE_JOBS_W, IE_TEST_LOCAL_W, ie_situacao_w, DS_VERSION_W
     FROM SCHEM_TEST_SUITE suite WHERE suite.NR_SEQUENCIA = NR_SEQUENCIA_P;

    IF (NR_SEQUENCIA_W IS NOT NULL AND NR_SEQUENCIA_W::text <> '') THEN        
        NM_SUITE_W2 := 'COPY OF ' || NM_SUITE_W;
 
      SELECT nextval('schem_test_suite_seq') SEQUENCIA 
        INTO STRICT NEWSEQUENCESUITE
;

      INSERT INTO SCHEM_TEST_SUITE(nr_sequencia, nm_suite, ds_version, ie_runtype, nm_owner, dt_atualizacao, nm_usuario, nm_usuario_nrec, dt_atualizacao_nrec, nr_seq_preset, ds_repo, ie_jobs, ie_test_local, ie_situacao) 
          VALUES (NEWSEQUENCESUITE, NM_SUITE_W2, DS_VERSION_W, 1, NM_USUARIO_P, clock_timestamp(), NM_USUARIO_P, NM_USUARIO_P, clock_timestamp(), NR_SEQ_PRESET_W, '0', IE_JOBS_W, IE_TEST_LOCAL_W, ie_situacao_w);
				
      COMMIT;
    END IF;

    OPEN C01;
        LOOP
          FETCH C01 INTO	
            NR_SEQUENCIA_TEST_W,
            NR_SEQ_EXECUTION_W, 
            NR_SEQ_SCRIPT_W, 
            NR_SEQ_ROBOT_W, 
            NR_SEQ_GRID_W,
            IE_SWITCH_W;
        EXIT WHEN NOT FOUND; /* apply on C01 */
        BEGIN	
          SELECT nextval('schem_test_test_seq')
            INTO STRICT NEWSEQUENCETEST
;
    
         INSERT INTO SCHEM_TEST_TEST(nr_sequencia, nr_seq_execution, nr_seq_script, nr_seq_suite, nr_seq_robot, nr_seq_grid, dt_atualizacao, nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec, ie_jobs, ie_switch) 
              VALUES (NEWSEQUENCETEST, NR_SEQ_EXECUTION_W, NR_SEQ_SCRIPT_W, NEWSEQUENCESUITE, NR_SEQ_ROBOT_W, NR_SEQ_GRID_W, clock_timestamp(), NM_USUARIO_P, clock_timestamp(), NM_USUARIO_P, '0', IE_SWITCH_W);
          COMMIT;
        END;
      END LOOP;
      CLOSE C01;
      EXCEPTION
      WHEN no_data_found THEN
        RAISE NOTICE 'Erro: Data not found';
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE schematic4test_double_suite (NR_SEQUENCIA_P bigint, NM_USUARIO_P text) FROM PUBLIC;

