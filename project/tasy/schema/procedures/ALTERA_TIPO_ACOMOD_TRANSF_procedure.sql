-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE altera_tipo_acomod_transf ( nr_atendimento_p bigint, cd_tipo_novo_p bigint, nr_seq_transf_p bigint) AS $body$
DECLARE


ds_acomodacao_w		varchar(100);


BEGIN

	if (nr_atendimento_p > 0) then
		select	coalesce(max(a.ds_tipo_acomodacao),'')
		into STRICT	ds_acomodacao_w
		from	tipo_acomodacao a,
			atend_paciente_unidade b
		where	a.cd_tipo_acomodacao = b.cd_tipo_acomodacao
		and 	b.nr_sequencia = nr_seq_transf_p
		and	b.nr_atendimento = nr_atendimento_p;

		update 	atend_paciente_unidade
		set 	cd_tipo_acomodacao = cd_tipo_novo_p
		where 	nr_atendimento = nr_atendimento_p
		and 	nr_sequencia = nr_seq_transf_p;

		commit;

		/*insert into logxxxxxx_tasy values(sysdate,Wheb_usuario_pck.get_nm_usuario,1355,
		'Tipo de acomodação alterada. Atend.: ' || nr_atendimento_p || ' ' || ds_acomodacao_w  || ' -> ' || obter_desc_tipo_acomodacao(cd_tipo_novo_p) || '.');*/
	end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE altera_tipo_acomod_transf ( nr_atendimento_p bigint, cd_tipo_novo_p bigint, nr_seq_transf_p bigint) FROM PUBLIC;

