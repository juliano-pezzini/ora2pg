-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_exame_externo_item_oft ( nr_atendimento_p bigint, nr_seq_exame_lab_p bigint, cd_procedimento_p INOUT bigint, ie_origem_proced_p INOUT bigint, ds_procedimento_p INOUT text, ds_erro_p INOUT text) AS $body$
DECLARE

 
ie_tipo_atendimento_w	smallint;
cd_estabelecimento_w	smallint;
ie_tipo_convenio_w	smallint;
ie_origem_proced_w	bigint;
cd_procedimento_w	bigint;
cd_convenio_w		integer;
cd_setor_w		integer;	
ds_procedimento_w	PROCEDIMENTO.DS_PROCEDIMENTO%type;
cd_categoria_w		varchar(10);
ds_erro_w		varchar(255);
nr_seq_proc_interno_aux_w	bigint;
cd_plano_convenio_w	varchar(10);


BEGIN 
if (nr_atendimento_p IS NOT NULL AND nr_atendimento_p::text <> '') and (nr_seq_exame_lab_p IS NOT NULL AND nr_seq_exame_lab_p::text <> '') then 
	begin 
	select	ie_tipo_atendimento, 
		ie_tipo_convenio, 
		cd_convenio, 
		cd_categoria, 
		cd_estabelecimento, 
		cd_plano_convenio 
	into STRICT	ie_tipo_atendimento_w, 
		ie_tipo_convenio_w, 
		cd_convenio_w, 
		cd_categoria_w, 
		cd_estabelecimento_w, 
		cd_plano_convenio_w 
	from	atendimento_paciente_v 
	where	nr_atendimento = nr_atendimento_p;
	 
	SELECT * FROM obter_exame_lab_convenio( 
		nr_seq_exame_lab_p, cd_convenio_w, cd_categoria_w, ie_tipo_atendimento_w, cd_estabelecimento_w, ie_tipo_convenio_w, null, null, cd_plano_convenio_w, cd_setor_w, cd_procedimento_w, ie_origem_proced_w, ds_erro_w, nr_seq_proc_interno_aux_w) INTO STRICT cd_setor_w, cd_procedimento_w, ie_origem_proced_w, ds_erro_w, nr_seq_proc_interno_aux_w;
			 
	if (cd_procedimento_w IS NOT NULL AND cd_procedimento_w::text <> '') then 
		begin 
		select	ds_procedimento 
		into STRICT	ds_procedimento_w 
		from	procedimento 
		where	cd_procedimento		= cd_procedimento_w 
		and	ie_origem_proced	= ie_origem_proced_w;		
		end;
	end if;		
	end;
end if;
ds_erro_p		:= ds_erro_w;
cd_procedimento_p	:= cd_procedimento_w;
ie_origem_proced_p	:= ie_origem_proced_w;
ds_procedimento_p	:= ds_procedimento_w;
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_exame_externo_item_oft ( nr_atendimento_p bigint, nr_seq_exame_lab_p bigint, cd_procedimento_p INOUT bigint, ie_origem_proced_p INOUT bigint, ds_procedimento_p INOUT text, ds_erro_p INOUT text) FROM PUBLIC;

