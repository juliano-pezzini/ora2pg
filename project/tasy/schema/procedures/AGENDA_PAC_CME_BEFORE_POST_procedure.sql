-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE agenda_pac_cme_before_post ( nr_seq_agenda_p bigint, nr_seq_conjunto_p bigint, nr_seq_proc_interno_p bigint, ie_novo_p text, nm_usuario_p text, ds_erro_p INOUT text, ie_status_cme_p INOUT text) AS $body$
DECLARE

qt_registro_w bigint := 0;
ie_consist_lanc_w varchar(255);
ie_disp_cme_w varchar(255);

BEGIN
if (nr_seq_agenda_p IS NOT NULL AND nr_seq_agenda_p::text <> '') and (nr_seq_conjunto_p IS NOT NULL AND nr_seq_conjunto_p::text <> '') then 
	begin 
	ie_consist_lanc_w := obter_parametro(871, 477, wheb_usuario_pck.get_cd_perfil, ie_consist_lanc_w);
	if (ie_consist_lanc_w = 'S') and (nr_seq_proc_interno_p IS NOT NULL AND nr_seq_proc_interno_p::text <> '') then 
		begin 
		select	count(*) 
		into STRICT	qt_registro_w 
		from	agenda_pac_cme 
		where	ie_origem_inf = 'I' 
		and	nr_seq_agenda = nr_seq_agenda_p 
		and	nr_seq_conjunto = nr_seq_conjunto_p;
	 
		if (qt_registro_w > 0) then 
			begin 
			CALL Wheb_mensagem_pck.exibir_mensagem_abort(68872);
			end;
		end if;
		end;
	end if;
	ie_disp_cme_w := obter_parametro(871, 101, wheb_usuario_pck.get_cd_perfil, ie_disp_cme_w);
	if (ie_disp_cme_w <> 'N') then 
		begin 
		ds_erro_p := cme_consistir_conj_agenda( 
				nr_seq_agenda_p, nr_seq_conjunto_p, ie_novo_p, nm_usuario_p, wheb_usuario_pck.get_cd_estabelecimento, ds_erro_p);
		if (ds_erro_p IS NOT NULL AND ds_erro_p::text <> '') then 
			begin 
			ie_status_cme_p := obter_status_cme_agenda(nr_seq_agenda_p, nr_seq_conjunto_p, 'S');
			end;
		end if;
		end;
	end if;	
	end;
end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE agenda_pac_cme_before_post ( nr_seq_agenda_p bigint, nr_seq_conjunto_p bigint, nr_seq_proc_interno_p bigint, ie_novo_p text, nm_usuario_p text, ds_erro_p INOUT text, ie_status_cme_p INOUT text) FROM PUBLIC;

