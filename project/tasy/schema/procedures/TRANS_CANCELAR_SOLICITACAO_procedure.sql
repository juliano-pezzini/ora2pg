-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE trans_cancelar_solicitacao ( nr_sequencia_p bigint, nr_seq_motivo_cancel_p bigint DEFAULT NULL, ds_motivo_cancel_p text DEFAULT NULL, nm_usuario_p text DEFAULT NULL) AS $body$
BEGIN
IF ((obter_valor_param_usuario(10050, 7, obter_perfil_ativo, nm_usuario_p, wheb_usuario_pck.get_cd_estabelecimento)) = 'S') THEN
 UPDATE transportador
 SET ie_status_recurso = 1
 WHERE cd_pessoa_fisica = (SELECT s.cd_transportador FROM trans_solicitacao s
						 WHERE (s.cd_transportador IS NOT NULL AND s.cd_transportador::text <> '')
 					     AND s.nr_sequencia = nr_sequencia_p);
END IF;

UPDATE	trans_solicitacao
SET	dt_cancelamento = clock_timestamp(),
	cd_motivo_cancelamento = nr_seq_motivo_cancel_p,
	ds_obs_cancelamento = ds_motivo_cancel_p,
	ie_status = 9,
	dt_atualizacao = clock_timestamp(),
	nm_usuario = nm_usuario_p
WHERE	nr_sequencia = nr_sequencia_p;

COMMIT;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE trans_cancelar_solicitacao ( nr_sequencia_p bigint, nr_seq_motivo_cancel_p bigint DEFAULT NULL, ds_motivo_cancel_p text DEFAULT NULL, nm_usuario_p text DEFAULT NULL) FROM PUBLIC;

