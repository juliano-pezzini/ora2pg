-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualiza_status_lista_agexame ( ds_lista_agenda_exame_p text, ie_status_agenda_p text, nm_usuario_p text) AS $body$
DECLARE

 
nr_sequencia_w		bigint;
nr_atendimento_w	bigint;
ds_lista_w		varchar(1000);
tam_lista_w		bigint;
ie_pos_virgula_w	smallint;
cd_agenda_w		bigint;


BEGIN 
 
ds_lista_w := ds_lista_agenda_exame_p;	
 
if (substr(ds_lista_w,length(ds_lista_w) - 1, length(ds_lista_w))	<> ',') then 
	ds_lista_w	:= ds_lista_w ||',';
end if;
 
while(ds_lista_w IS NOT NULL AND ds_lista_w::text <> '') loop 
	begin 
	 
	tam_lista_w		:= length(ds_lista_w);
	ie_pos_virgula_w	:= position(',' in ds_lista_w);
	 
	if (ie_pos_virgula_w <> 0) then 
		nr_sequencia_w		:= (substr(ds_lista_w,1,(ie_pos_virgula_w - 1)))::numeric;
		ds_lista_w		:= substr(ds_lista_w,(ie_pos_virgula_w + 1),tam_lista_w);
	end if;
	 
	select	max(a.cd_agenda)		 
	into STRICT	cd_agenda_w 
	from	agenda_paciente a 
	where	a.nr_sequencia	= nr_sequencia_w;
	 
	CALL Alterar_status_agenda(cd_agenda_w, 
				nr_sequencia_w, 
				ie_status_agenda_p, 
				'', 
				'', 
				'', 
				nm_usuario_p);		
	end;
end loop;
 
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualiza_status_lista_agexame ( ds_lista_agenda_exame_p text, ie_status_agenda_p text, nm_usuario_p text) FROM PUBLIC;

