-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_notes_element_template ( nr_atendimento_p ehr_registro_observacao.nr_atendimento%type, cd_pessoa_fisica_p ehr_registro_observacao.cd_pessoa_fisica%type, nr_seq_template_p ehr_registro_observacao.nr_seq_template%type, nr_seq_reg_template_p ehr_registro_observacao.nr_seq_reg_template%type, nr_seq_elemento_p ehr_registro_observacao.nr_seq_elemento%type, nm_usuario_p ehr_registro_observacao.nm_usuario%type, ds_observacao_p ehr_registro_observacao.ds_observacao%type, nm_atributo_p ehr_registro_observacao.nm_atributo%type) AS $body$
BEGIN

    update ehr_registro_observacao
       set dt_inativacao = establishment_timezone_utils.getcurrentdate,
           nm_usuario_inativacao = nm_usuario_p,
           ie_situacao = 'I'
     where nr_seq_reg_template = nr_seq_reg_template_p
       and nr_seq_elemento = nr_seq_elemento_p
       and ( (coalesce(nm_atributo::text, '') = '' and coalesce(nm_atributo_p::text, '') = '') or nm_atributo_p = nm_atributo )
       and coalesce(ie_situacao, 'A') = 'A';

    insert into ehr_registro_observacao(nr_sequencia,
        dt_atualizacao,
        nm_usuario,
        dt_atualizacao_nrec,
        nm_usuario_nrec,
        nr_atendimento,
        cd_pessoa_fisica,
        nr_seq_elemento,
        nr_seq_template,
        nr_seq_reg_template,
        cd_profissional,
        ds_observacao,
        nm_atributo,
        ie_situacao,
        dt_liberacao)
    values (nextval('ehr_registro_observacao_seq'),
        establishment_timezone_utils.getcurrentdate,
        nm_usuario_p,
        establishment_timezone_utils.getcurrentdate,
        nm_usuario_p,
        nr_atendimento_p,
        cd_pessoa_fisica_p,
        nr_seq_elemento_p,
        nr_seq_template_p,
        nr_seq_reg_template_p,
        null,
        ds_observacao_p,
        nm_atributo_p,
        'A',
        establishment_timezone_utils.getcurrentdate);
    commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_notes_element_template ( nr_atendimento_p ehr_registro_observacao.nr_atendimento%type, cd_pessoa_fisica_p ehr_registro_observacao.cd_pessoa_fisica%type, nr_seq_template_p ehr_registro_observacao.nr_seq_template%type, nr_seq_reg_template_p ehr_registro_observacao.nr_seq_reg_template%type, nr_seq_elemento_p ehr_registro_observacao.nr_seq_elemento%type, nm_usuario_p ehr_registro_observacao.nm_usuario%type, ds_observacao_p ehr_registro_observacao.ds_observacao%type, nm_atributo_p ehr_registro_observacao.nm_atributo%type) FROM PUBLIC;

