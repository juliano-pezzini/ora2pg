-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consistir_geracao_apae ( cd_pessoa_fisica_p text, ds_retorno_p INOUT text) AS $body$
DECLARE

 
qt_registro_w		bigint;
ds_procedimento_w		procedimento.ds_procedimento%TYPE;
dt_agenda_w		timestamp;


BEGIN 
 
-- Consistir se hÃ¡ agenda para o paciente 
begin 
select	substr(obter_descricao_procedimento(cd_procedimento, ie_origem_proced),1,240), 
	hr_inicio 
into STRICT	ds_procedimento_w, 
	dt_agenda_w 
from	agenda_paciente 
where	cd_pessoa_fisica		= cd_pessoa_fisica_p 
and	dt_agenda			>= trunc(clock_timestamp(),'dd') 
and	obter_tipo_agenda(cd_agenda)	= 1 
and	dt_agenda	=	(	SELECT	min(dt_agenda) 
					from	agenda_paciente 
					where	cd_pessoa_fisica		= cd_pessoa_fisica_p 
					and	dt_agenda			>= trunc(clock_timestamp(),'dd') 
					and	obter_tipo_agenda(cd_agenda)	= 1);
exception 
when others then 
	dt_agenda_W	:= null;
end;
	 
 
if (dt_agenda_W IS NOT NULL AND dt_agenda_W::text <> '') then 
	ds_retorno_p	:= 	wheb_mensagem_pck.get_texto(300360, 'DS_PROCEDIMENTO_W=' || ds_procedimento_w || 
			';DT_AGENDA_W=' || to_char(dt_agenda_w,'dd/mm/yyyy hh24:mi:ss'));
end if;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consistir_geracao_apae ( cd_pessoa_fisica_p text, ds_retorno_p INOUT text) FROM PUBLIC;

