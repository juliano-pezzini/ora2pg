-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_sinal_vital () AS $body$
DECLARE


ds_sinal_vital_w	varchar(60);
nr_sequencia_w		bigint;
qt_registro_w		smallint;
c01	  		integer;
retorno_w		integer;
ds_comando_w		varchar(2000);


BEGIN

ds_comando_w := ' select	ds_sinal_vital,'||
		'		nr_sequencia'||
		' from		tasy_versao.sinal_vital';

C01 := DBMS_SQL.OPEN_CURSOR;
DBMS_SQL.PARSE(C01, ds_comando_w, dbms_sql.Native);
DBMS_SQL.DEFINE_COLUMN(C01, 1, ds_sinal_vital_w,60);
DBMS_SQL.DEFINE_COLUMN(C01, 2, nr_sequencia_w);
retorno_w := DBMS_SQL.execute(C01);

while( DBMS_SQL.FETCH_ROWS(C01) > 0 ) loop
	BEGIN

	DBMS_SQL.COLUMN_VALUE(C01, 1, ds_sinal_vital_w);
	DBMS_SQL.COLUMN_VALUE(C01, 2, nr_sequencia_w);

	select	count(*)
	into STRICT	qt_registro_w
	from	sinal_vital
	where	nr_sequencia = nr_sequencia_w;

	if (qt_registro_w > 0) then
		update	sinal_vital
		set	ds_sinal_vital	= ds_sinal_vital_w
		where	nr_sequencia	= nr_sequencia_w;
	else
		begin

		ds_comando_w := ' insert into sinal_vital( ' ||
				'		ds_sinal_vital,'||
				'		nr_sequencia,'||
				'		dt_atualizacao,'||
				'		nm_usuario,'||
				'		qt_minimo,'||
				'		vl_maximo,'||
				'		qt_min_aviso,'||
				'		qt_max_aviso)'||
				' select	ds_sinal_vital,'||
				'		nr_sequencia,'||
				'		dt_atualizacao,'||
				'		nm_usuario,'||
				'		0,'||
				'		0,'||
				'		0,'||
				'		0'||
				' from		tasy_versao.sinal_vital'||
				' where	nr_sequencia	= :nr_sequencia';
		CALL exec_sql_dinamico_bv(obter_desc_expressao(298525)/*'Sinal Vital'*/
,ds_comando_w,'nr_sequencia='||nr_sequencia_w);
		end;
	end if;

	end;
END LOOP;
DBMS_SQL.CLOSE_CURSOR(C01);
commit;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_sinal_vital () FROM PUBLIC;

