-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cpoe_inserir_exame_anat_rotina ( nr_atendimento_p cpoe_anatomia_patologica.nr_atendimento%type, nr_seq_produto_p cpoe_anatomia_patologica.nr_sequencia%type, cd_protocolo_p protocolo_medic_proc.cd_protocolo%type, nr_seq_protocolo_p protocolo_medic_proc.nr_sequencia%type default null, nr_seq_proc_p protocolo_medic_proc.nr_seq_proc%type default null, cd_estabelecimento_p convenio_amb.cd_estabelecimento%type DEFAULT NULL, cd_perfil_p cpoe_anatomia_patologica.cd_perfil_ativo%type DEFAULT NULL, nm_usuario_p cpoe_anatomia_patologica.nm_usuario%type DEFAULT NULL, cd_pessoa_fisica_p cpoe_anatomia_patologica.cd_pessoa_fisica%type DEFAULT NULL, nr_seq_item_gerado_p INOUT bigint DEFAULT NULL, nr_seq_transcricao_p cpoe_anatomia_patologica.nr_seq_transcricao%type default null, cd_medico_p cpoe_anatomia_patologica.cd_medico%type default null, ie_retrogrado_p cpoe_anatomia_patologica.ie_retrogrado%type default 'N', dt_inicio_p cpoe_anatomia_patologica.dt_inicio%type default null, nr_seq_pepo_p cpoe_anatomia_patologica.nr_seq_pepo%type default null, nr_cirurgia_p cpoe_anatomia_patologica.nr_cirurgia%type default null, nr_cirurgia_patologia_p cpoe_anatomia_patologica.nr_cirurgia_patologia%type default null, nr_seq_agenda_p cpoe_anatomia_patologica.nr_seq_agenda%type default null, nr_seq_conclusao_apae_p cpoe_anatomia_patologica.nr_seq_conclusao_apae%type default null, ie_futuro_p cpoe_anatomia_patologica.ie_futuro%type default 'N', nr_seq_cpoe_order_unit_p cpoe_order_unit.nr_sequencia%type default null, cd_convenio_p exame_lab_convenio.cd_convenio%type default null, cd_categoria_convenio_p exame_lab_convenio.cd_categoria%type default null, ie_tipo_convenio_p regra_origem_proced.ie_tipo_convenio%type DEFAULT NULL, ie_tipo_atendimento_p exame_lab_convenio.ie_tipo_atendimento%type default 'N', cd_plano_convenio_p exame_lab_convenio.cd_plano_convenio%type default null, cd_setor_atendimento_p protocolo_medic_proc.cd_setor_atendimento%type default null, nr_seq_cpoe_rp_p cpoe_rp.nr_sequencia%type default null) AS $body$
DECLARE

							
nr_seq_proc_w			protocolo_medic_proc.nr_seq_proc%type;
cd_protocolo_w			protocolo_medic_proc.cd_protocolo%type;
nr_seq_protocolo_w		protocolo_medic_proc.nr_sequencia%type;

c01 CURSOR FOR
SELECT  a.nr_seq_proc,
        a.cd_protocolo,
        a.nr_sequencia nr_seq_protocolo
from    protocolo_medic_proc a
where  	a.nr_sequencia = nr_seq_produto_p
and     coalesce(a.nr_seq_solic_bs::text, '') = ''
and	    (a.nr_seq_proc_interno IS NOT NULL AND a.nr_seq_proc_interno::text <> '')
and	    a.cd_protocolo = cd_protocolo_p
and	    a.nr_seq_proc = coalesce(nr_seq_protocolo_p, a.nr_seq_proc)
and 	coalesce(a.ie_anatomia,'N') = 'S'
and 	coalesce(a.ie_rotina,'N') = 'S'
order by a.nr_seq_apres;


BEGIN
			
open c01;
loop
fetch c01 into	nr_seq_proc_w,
				cd_protocolo_w,
				nr_seq_protocolo_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin
	  nr_seq_item_gerado_p := CPOE_Gerar_prot_anatomia(cd_estabelecimento_p, cd_perfil_p, nm_usuario_p, cd_convenio_p, cd_categoria_convenio_p, ie_tipo_atendimento_p, ie_tipo_convenio_p, 0, cd_protocolo_w, nr_seq_protocolo_w, nr_seq_proc_w, cd_setor_atendimento_p, nr_atendimento_p, null, null, dt_inicio_p, nr_seq_item_gerado_p, nr_seq_transcricao_p, ie_retrogrado_p, cd_medico_p, nr_cirurgia_patologia_p, nr_cirurgia_p, nr_seq_pepo_p, nr_seq_agenda_p, nr_seq_conclusao_apae_p, cd_pessoa_fisica_p, ie_futuro_p, nr_seq_cpoe_rp_p, nr_seq_cpoe_order_unit_p);
	end;
end loop;
close c01;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_inserir_exame_anat_rotina ( nr_atendimento_p cpoe_anatomia_patologica.nr_atendimento%type, nr_seq_produto_p cpoe_anatomia_patologica.nr_sequencia%type, cd_protocolo_p protocolo_medic_proc.cd_protocolo%type, nr_seq_protocolo_p protocolo_medic_proc.nr_sequencia%type default null, nr_seq_proc_p protocolo_medic_proc.nr_seq_proc%type default null, cd_estabelecimento_p convenio_amb.cd_estabelecimento%type DEFAULT NULL, cd_perfil_p cpoe_anatomia_patologica.cd_perfil_ativo%type DEFAULT NULL, nm_usuario_p cpoe_anatomia_patologica.nm_usuario%type DEFAULT NULL, cd_pessoa_fisica_p cpoe_anatomia_patologica.cd_pessoa_fisica%type DEFAULT NULL, nr_seq_item_gerado_p INOUT bigint DEFAULT NULL, nr_seq_transcricao_p cpoe_anatomia_patologica.nr_seq_transcricao%type default null, cd_medico_p cpoe_anatomia_patologica.cd_medico%type default null, ie_retrogrado_p cpoe_anatomia_patologica.ie_retrogrado%type default 'N', dt_inicio_p cpoe_anatomia_patologica.dt_inicio%type default null, nr_seq_pepo_p cpoe_anatomia_patologica.nr_seq_pepo%type default null, nr_cirurgia_p cpoe_anatomia_patologica.nr_cirurgia%type default null, nr_cirurgia_patologia_p cpoe_anatomia_patologica.nr_cirurgia_patologia%type default null, nr_seq_agenda_p cpoe_anatomia_patologica.nr_seq_agenda%type default null, nr_seq_conclusao_apae_p cpoe_anatomia_patologica.nr_seq_conclusao_apae%type default null, ie_futuro_p cpoe_anatomia_patologica.ie_futuro%type default 'N', nr_seq_cpoe_order_unit_p cpoe_order_unit.nr_sequencia%type default null, cd_convenio_p exame_lab_convenio.cd_convenio%type default null, cd_categoria_convenio_p exame_lab_convenio.cd_categoria%type default null, ie_tipo_convenio_p regra_origem_proced.ie_tipo_convenio%type DEFAULT NULL, ie_tipo_atendimento_p exame_lab_convenio.ie_tipo_atendimento%type default 'N', cd_plano_convenio_p exame_lab_convenio.cd_plano_convenio%type default null, cd_setor_atendimento_p protocolo_medic_proc.cd_setor_atendimento%type default null, nr_seq_cpoe_rp_p cpoe_rp.nr_sequencia%type default null) FROM PUBLIC;

