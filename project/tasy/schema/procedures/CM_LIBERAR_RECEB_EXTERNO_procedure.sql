-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cm_liberar_receb_externo ( nr_seq_receb_p bigint, cd_setor_p bigint, ie_opcao_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE


/*Opção:
1 = Liberar;
2 = Estornar.
3 = Libera dt entrega
4 = Estorna dt entrega
*/
ie_gera_conj_recebimento_w		varchar(1);


BEGIN
ie_gera_conj_recebimento_w := obter_param_usuario(406, 209, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, ie_gera_conj_recebimento_w);

if (ie_opcao_p = 1) then

	update	cm_receb_externo
	set	dt_liberacao = clock_timestamp(),
		dt_atualizacao = clock_timestamp(),
		nm_usuario = nm_usuario_p
	where	nr_sequencia = nr_seq_receb_p;

	if (ie_gera_conj_recebimento_w = 'S') then
		CALL cm_gerar_conj_ester_recebe_ext(nr_seq_receb_p,cd_setor_p,cd_estabelecimento_p,nm_usuario_p,'G');
	end if;

elsif (ie_opcao_p = 2) then

	update	cm_receb_externo
	set	dt_liberacao  = NULL,
		dt_atualizacao = clock_timestamp(),
		nm_usuario = nm_usuario_p
	where	nr_sequencia = nr_seq_receb_p;

elsif (ie_opcao_p = 3) then

	update	cm_receb_externo
	set	dt_lib_entrega = clock_timestamp(),
		dt_atualizacao = clock_timestamp(),
		nm_usuario = nm_usuario_p
	where	nr_sequencia = nr_seq_receb_p;

	if (ie_gera_conj_recebimento_w = 'S') then
		CALL cm_gerar_conj_ester_recebe_ext(nr_seq_receb_p,cd_setor_p,cd_estabelecimento_p,nm_usuario_p,'E');
	end if;

elsif (ie_opcao_p = 4) then

	update	cm_receb_externo
	set	dt_lib_entrega  = NULL,
		dt_atualizacao = clock_timestamp(),
		nm_usuario = nm_usuario_p
	where	nr_sequencia = nr_seq_receb_p;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cm_liberar_receb_externo ( nr_seq_receb_p bigint, cd_setor_p bigint, ie_opcao_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

