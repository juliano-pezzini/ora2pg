-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE latam_gerar_modulo ( nr_seq_gap_p bigint, ds_conteudo_p text, nm_usuario_p text) AS $body$
DECLARE


i			integer	:=	0;
lista_modulos_w		dbms_sql.varchar2_table;
nr_seq_hospital_w	bigint;
nr_seq_pais_w		bigint;


BEGIN

begin
select 	nr_seq_hospital,
	nr_seq_pais
into STRICT	nr_seq_hospital_w,
	nr_seq_pais_w
from 	latam_gap
where	nr_sequencia = nr_seq_gap_p;
exception
when others then
	nr_seq_pais_w := null;
end;


  if (ds_conteudo_p IS NOT NULL AND ds_conteudo_p::text <> '' AND nr_seq_pais_w IS NOT NULL AND nr_seq_pais_w::text <> '')	then

    lista_modulos_w := obter_lista_string(ds_conteudo_p, ',');

    for i in 1..lista_modulos_w.count loop
    begin
        INSERT INTO LATAM_MODULO(
          NR_SEQUENCIA,
          NR_SEQ_HOSPITAL,
          NM_USUARIO,
          DT_ATUALIZACAO_NREC,
          NR_SEQ_MODULO,
          NR_SEQ_PAIS,
          NR_SEQ_GAP,
          NM_USUARIO_NREC,
          DT_ATUALIZACAO )
        VALUES (
          nextval('latam_modulo_seq'),
          nr_seq_hospital_w,
          nm_usuario_p,
          clock_timestamp() ,
          lista_modulos_w(i),
          nr_seq_pais_w,
          nr_seq_gap_p,
          nm_usuario_p,
          clock_timestamp());
      end;
    end loop;
  end if;
  commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE latam_gerar_modulo ( nr_seq_gap_p bigint, ds_conteudo_p text, nm_usuario_p text) FROM PUBLIC;

