-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_anexo_compras (nm_usuario_p text, nr_documento_p bigint, ds_arquivo_p text, nr_item_documento_p bigint, ie_tipo_documento_p text) AS $body$
DECLARE


/* ie_tipo_documento_p
O	-	Ordem compra
S	-	Solicitação de compra
C	-	Cotação de compra
N	-	Nota fiscal
L	-	Licitação
*/
BEGIN
if (ie_tipo_documento_p = 'O') then

	insert into ordem_compra_anexo(
		nr_sequencia,
		nr_ordem_compra,
		dt_atualizacao,
		nm_usuario,
		ds_arquivo,
		ie_anexar_email)
	values (	nextval('ordem_compra_anexo_seq'),
		nr_documento_p,
		clock_timestamp(),
		nm_usuario_p,
		ds_arquivo_p,
		'S');

elsif (ie_tipo_documento_p = 'S') then
	if (nr_item_documento_p = 0) then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(239581);
	end if;

	insert into solic_compra_item_anexo(
		nr_sequencia,
		nr_solic_compra,
		nr_item_solic_compra,
		nm_usuario_nrec,
		nm_usuario,
		dt_atualizacao_nrec,
		dt_atualizacao,
		ds_observacao,
		ds_arquivo)
	values (	nextval('solic_compra_item_anexo_seq'),
		nr_documento_p,
		nr_item_documento_p,
		nm_usuario_p,
		nm_usuario_p,
		clock_timestamp(),
		clock_timestamp(),
		null,
		ds_arquivo_p);

elsif (ie_tipo_documento_p = 'C') then

	insert into cot_compra_anexo(
		nr_sequencia,
		nr_seq_parecer,
		nr_seq_cot_forn,
		nr_item_cot_compra,
		nr_cot_compra,
		nm_usuario_nrec,
		nm_usuario,
		ie_origem,
		ie_envio_retorno_parecer,
		ie_enviar,
		dt_atualizacao_nrec,
		dt_atualizacao,
		ds_arquivo)
	values (	nextval('cot_compra_anexo_seq'),
		null,
		null,
		nr_item_documento_p,
		nr_documento_p,
		nm_usuario_p,
		nm_usuario_p,
		'U',
		null,
		'S',
		clock_timestamp(),
		clock_timestamp(),
		ds_arquivo_p);

elsif (ie_tipo_documento_p = 'N') then

	insert into nota_fiscal_anexo(
		nr_sequencia,
		nr_seq_nota,
		nm_usuario_nrec,
		nm_usuario,
		dt_atualizacao_nrec,
		dt_atualizacao,
		ds_arquivo)
	values (	nextval('nota_fiscal_anexo_seq'),
		nr_documento_p,
		nm_usuario_p,
		nm_usuario_p,
		clock_timestamp(),
		clock_timestamp(),
		ds_arquivo_p);

elsif (ie_tipo_documento_p = 'L') then

	insert into reg_lic_anexo(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_licitacao,
		nm_titulo,
		ds_arquivo,
		nr_seq_tipo_anexo)
	values (	nextval('reg_lic_anexo_seq'),
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		nr_documento_p,
		null,
		ds_arquivo_p,
		null);
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_anexo_compras (nm_usuario_p text, nr_documento_p bigint, ds_arquivo_p text, nr_item_documento_p bigint, ie_tipo_documento_p text) FROM PUBLIC;

