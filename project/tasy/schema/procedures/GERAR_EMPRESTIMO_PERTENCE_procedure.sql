-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_emprestimo_pertence ( nr_seq_registro_p bigint, nr_sequencia_p bigint, cd_setor_atendimento_p bigint, qt_envio_p text, nm_usuario_p text) AS $body$
DECLARE




qt_item_w		pertence_pac_item_evento.qt_transacao%type;

BEGIN

qt_item_w := qt_envio_p;

if (coalesce(qt_item_w::text, '') = '') then
	select	coalesce(max(qt_item),1)
	into STRICT	qt_item_w
	from	PERTENCE_PACIENTE_ITEM
	where	nr_sequencia = nr_sequencia_p
	and	nr_seq_pertence_paciente = nr_seq_registro_p;
end if;

insert into	pertence_pac_item_evento(
				nr_sequencia,
				nr_seq_pert_pac,
				dt_atualizacao,
				nm_usuario,
				dt_atualizacao_nrec,
				nm_usuario_nrec,
				cd_tipo_evento,
				qt_transacao,
				cd_setor_atendimento)
			values (
				nextval('pertence_pac_item_evento_seq'),
				nr_sequencia_p,
				clock_timestamp(),
				nm_usuario_p,
				clock_timestamp(),
				nm_usuario_p,
				'S',
				qt_item_w,
				cd_setor_atendimento_p);
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_emprestimo_pertence ( nr_seq_registro_p bigint, nr_sequencia_p bigint, cd_setor_atendimento_p bigint, qt_envio_p text, nm_usuario_p text) FROM PUBLIC;

