-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ajustar_ata_proj_migr_audit ( nr_seq_projeto_p bigint, dt_atualizacao_p timestamp, nm_usuario_p text) AS $body$
DECLARE

		 
nr_seq_ata_w			bigint;
cd_gerente_w			varchar(10);
nr_seq_ata_pauta_w		bigint;
nr_seq_ata_conteudo_w		bigint;
nr_seq_ata_participante_w	bigint;
nm_participante_w		varchar(60);

c01 CURSOR FOR 
SELECT	obter_nome_pf(b.cd_pessoa_fisica) 
from	proj_equipe_papel b, 
	proj_equipe a 
where	a.nr_sequencia = b.nr_seq_equipe 
and	a.nr_seq_equipe_funcao = 11 
and	a.nr_seq_proj = nr_seq_projeto_p 
order by 
	b.nr_seq_apres;
	

BEGIN 
if (nr_seq_projeto_p IS NOT NULL AND nr_seq_projeto_p::text <> '') and (dt_atualizacao_p IS NOT NULL AND dt_atualizacao_p::text <> '') and (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') then 
	begin 
	select	nextval('proj_ata_seq') 
	into STRICT	nr_seq_ata_w 
	;
 
	select	cd_gerente_cliente 
	into STRICT	cd_gerente_w 
	from	proj_projeto 
	where	nr_sequencia = nr_seq_projeto_p;
 
	insert into proj_ata( 
		nr_sequencia, 
		cd_estabelecimento, 
		dt_atualizacao, 
		nm_usuario, 
		dt_atualizacao_nrec, 
		nm_usuario_nrec, 
		nr_seq_cliente, 
		dt_ata, 
		dt_liberacao, 
		ds_ata, 
		cd_consultor, 
		dt_recebimento, 
		nr_seq_projeto, 
		nr_seq_proj_gpi, 
		ie_tipo_ata, 
		nr_seq_canal) 
	values ( 
		nr_seq_ata_w, 
		1, 
		dt_atualizacao_p, 
		nm_usuario_p, 
		dt_atualizacao_p, 
		nm_usuario_p, 
		1800, 
		dt_atualizacao_p, 
		dt_atualizacao_p, 
		'Reunião de Implementação do Projeto', 
		cd_gerente_w, 
		null, 
		nr_seq_projeto_p, 
		null, 
		null, 
		null);
		 
	select	nextval('proj_ata_pauta_seq') 
	into STRICT	nr_seq_ata_pauta_w 
	;
		 
	insert into proj_ata_pauta( 
		nr_sequencia, 
		dt_atualizacao, 
		nm_usuario, 
		dt_atualizacao_nrec, 
		nm_usuario_nrec, 
		nr_seq_ata, 
		ds_pauta) 
	values ( 
		nr_seq_ata_pauta_w, 
		dt_atualizacao_p, 
		nm_usuario_p, 
		dt_atualizacao_p, 
		nm_usuario_p, 
		nr_seq_ata_w, 
		'Reunião de Implementação do Projeto');
		 
	select	nextval('proj_ata_conteudo_seq') 
	into STRICT	nr_seq_ata_conteudo_w 
	;
 
	insert into proj_ata_conteudo( 
		nr_sequencia, 
		dt_atualizacao, 
		nm_usuario, 
		dt_atualizacao_nrec, 
		nm_usuario_nrec, 
		nr_seq_ata, 
		ds_conteudo, 
		ds_titulo) 
	values ( 
		nr_seq_ata_conteudo_w, 
		dt_atualizacao_p, 
		nm_usuario_p, 
		dt_atualizacao_p, 
		nm_usuario_p, 
		nr_seq_ata_w, 
		'Foi realizada a reunião de implementação para a apresentação do projeto aos envolvidos.' || chr(13) || chr(10) || 
		'Na oportunidade foram apresentados / esclarecidos os seguintes pontos: ' || chr(13) || chr(10) || 
		' - As regras de negócio e/ou conceitos relacionados à função a ser migrada.' || chr(13) || chr(10) ||	 
		' - O escopo do projeto e o(s) requisito(s) a ser(em) atendido(s).' || chr(13) || chr(10) || 
		' - O cronograma de execução.' || chr(13) || chr(10) || 
		' - A metodologia de desenvolvimento.',	 
		'Reunião de Implementação do Projeto');
		 
	open c01;
	loop 
	fetch c01 into nm_participante_w;
	EXIT WHEN NOT FOUND; /* apply on c01 */
		begin 
		select	nextval('proj_ata_participante_seq') 
		into STRICT	nr_seq_ata_participante_w 
		;
		 
		insert into proj_ata_participante( 
			nr_sequencia, 
			dt_atualizacao, 
			nm_usuario, 
			dt_atualizacao_nrec, 
			nm_usuario_nrec, 
			nr_seq_ata, 
			ie_faltou, 
			nm_pessoa_participante, 
			ds_setor) 
		values ( 
			nr_seq_ata_participante_w, 
			dt_atualizacao_p, 
			nm_usuario_p, 
			dt_atualizacao_p, 
			nm_usuario_p, 
			nr_seq_ata_w, 
			'N', 
			nm_participante_w, 
			'Desenvolvimento');
		end;
	end loop;
	close c01;
	end;
end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ajustar_ata_proj_migr_audit ( nr_seq_projeto_p bigint, dt_atualizacao_p timestamp, nm_usuario_p text) FROM PUBLIC;

