-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE marcar_todos_transf_pend ( nr_seq_movto_transf_p bigint, ie_movto_lote_p text, ie_conferido_p text, cd_trans_pend_p bigint DEFAULT 0) AS $body$
DECLARE


c01 CURSOR FOR
SELECT	a.nr_sequencia
from     	transacao_financeira b,
       	movto_trans_financ a
where	a.nr_seq_trans_financ	= b.nr_sequencia
   and	a.nr_seq_movto_transf	= nr_seq_movto_transf_p

union

select	a.nr_sequencia
from	transacao_financeira b,
        	movto_trans_financ a
where	a.nr_seq_trans_financ	= b.nr_sequencia
   and	exists (select	1
                	from	movto_trans_financ x
                	where	x.nr_seq_movto_transf 	= nr_seq_movto_transf_p
                  	   and	x.nr_seq_lote 		= a.nr_seq_lote
                  	   and	x.nr_seq_saldo_caixa	= a.nr_seq_saldo_caixa)
   and	'S'  = ie_movto_lote_p
order by	nr_sequencia;

BEGIN

IF (cd_trans_pend_p > 0) then
	UPDATE movto_trans_financ SET ie_conferido = ie_conferido_p WHERE nr_sequencia = cd_trans_pend_p;
else
	FOR c in c01 LOOP
		UPDATE movto_trans_financ SET ie_conferido = ie_conferido_p WHERE nr_sequencia = c.nr_sequencia;
	END LOOP;
end if;


COMMIT;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE marcar_todos_transf_pend ( nr_seq_movto_transf_p bigint, ie_movto_lote_p text, ie_conferido_p text, cd_trans_pend_p bigint DEFAULT 0) FROM PUBLIC;

