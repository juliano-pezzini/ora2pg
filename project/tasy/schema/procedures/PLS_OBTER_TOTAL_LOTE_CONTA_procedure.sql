-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_obter_total_lote_conta ( nr_seq_lib_fat_p pls_lib_fat_conta.nr_seq_lib_fat%type, vl_benef_taxa_p INOUT bigint, vl_faturado_p INOUT bigint, vl_pendente_p INOUT bigint) AS $body$
DECLARE


vl_benef_taxa_w		double precision;
vl_faturado_w		double precision;
vl_pendente_w		double precision;


BEGIN

vl_benef_taxa_p := 0;
vl_faturado_p := 0;
vl_pendente_p := 0;

-- valor do beneficiario com taxa
select
    coalesce(sum(coalesce(a.vl_beneficiario, 0) + coalesce(a.vl_administracao, 0)), 0)
    into STRICT vl_benef_taxa_w
from
    pls_conta_pos_estabelecido a
where
    a.nr_seq_conta in (
        SELECT
            x.nr_seq_conta
        from
            pls_lib_fat_conta x
        where
            x.nr_seq_lib_fat = nr_seq_lib_fat_p
    )
    and ie_status_faturamento = 'L';
-- valor faturado
select
    coalesce(sum(coalesce(vl_beneficiario, 0) + coalesce(vl_administracao, 0)), 0)
    into STRICT vl_faturado_w
from
    pls_conta_pos_estabelecido a
where
    nr_seq_conta in (
        SELECT
            nr_seq_conta
        from
            pls_lib_fat_conta
        where
            nr_seq_lib_fat = nr_seq_lib_fat_p
    )
    and (nr_seq_lote_fat IS NOT NULL AND nr_seq_lote_fat::text <> '')
    and ie_status_faturamento = 'L';
-- valor pendente
select
    coalesce(sum(coalesce(vl_beneficiario, 0) + coalesce(vl_administracao, 0)), 0)
    into STRICT vl_pendente_w
from
    pls_conta_pos_estabelecido a
where
    nr_seq_conta in (
        SELECT
            nr_seq_conta
        from
            pls_lib_fat_conta
        where
            nr_seq_lib_fat = nr_seq_lib_fat_p
    )
    and coalesce(nr_seq_lote_fat::text, '') = ''
    and ie_status_faturamento = 'L';

if (vl_benef_taxa_w IS NOT NULL AND vl_benef_taxa_w::text <> '') then
	vl_benef_taxa_p := vl_benef_taxa_w;
end if;

if (vl_faturado_w IS NOT NULL AND vl_faturado_w::text <> '') then
	vl_faturado_p := vl_faturado_w;
end if;

if (vl_pendente_w IS NOT NULL AND vl_pendente_w::text <> '') then
	vl_pendente_p := vl_pendente_w;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_obter_total_lote_conta ( nr_seq_lib_fat_p pls_lib_fat_conta.nr_seq_lib_fat%type, vl_benef_taxa_p INOUT bigint, vl_faturado_p INOUT bigint, vl_pendente_p INOUT bigint) FROM PUBLIC;

