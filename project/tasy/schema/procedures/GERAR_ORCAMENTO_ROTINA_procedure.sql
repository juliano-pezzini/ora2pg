-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_orcamento_rotina ( nr_seq_orcamento_p bigint, nm_usuario_p text, cd_medico_exec_p text, qt_procedimento_p bigint) AS $body$
DECLARE

 
						 
nr_seq_proc_rotina_w		bigint;
ds_lista_mat_exame_w		varchar(2000);
cd_material_exame_w			varchar(20);
ie_tipo_w					bigint;
cd_material_w				varchar(20);
ie_pos_virgula_w			bigint;

c01 CURSOR FOR 
SELECT	nr_seq_proc_rotina, 
		ds_lista_mat_exame, 
		cd_material_exame, 
		ie_tipo 
from	w_proc_rotina_esp_t 
where	nm_usuario = nm_usuario_p 
and		coalesce(ie_marcado,'N') = 'S';


BEGIN 
open c01;
loop 
fetch c01 into	nr_seq_proc_rotina_w, 
				ds_lista_mat_exame_w, 
				cd_material_exame_w, 
				ie_tipo_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin 
	 
	if (coalesce(ds_lista_mat_exame_w::text, '') = '') then 
		cd_material_w := coalesce(cd_material_exame_w,'0');
	else 
		ie_pos_virgula_w := position(';' in ds_lista_mat_exame_w);
		cd_material_w := substr(ds_lista_mat_exame_w,1,ie_pos_virgula_w);
	end if;
	 
	CALL Gerar_Exame_Rotina_Orcamento(	nr_seq_orcamento_p, 
									nr_seq_proc_rotina_w, 
									ie_tipo_w, 
									nm_usuario_p, 
									cd_material_w, 
									cd_medico_exec_p, 
									qt_procedimento_p);
	end;
end loop;
close c01;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_orcamento_rotina ( nr_seq_orcamento_p bigint, nm_usuario_p text, cd_medico_exec_p text, qt_procedimento_p bigint) FROM PUBLIC;

