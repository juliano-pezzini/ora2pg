-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE trocar_local_paciente_ge ( nr_atendimento_p bigint, nr_seq_local_pa_p bigint, nm_usuario_p text) AS $body$
DECLARE

				
NR_SEQ_PROCESSO_w	pa_local.NR_SEQ_PROCESSO%type;
NR_SEQ_STATUS_w		pa_local.NR_SEQ_STATUS%type;


BEGIN

select 	max(NR_SEQ_PROCESSO),
		max(NR_SEQ_STATUS)
into STRICT	NR_SEQ_PROCESSO_w,
		NR_SEQ_STATUS_w
from	pa_local
where	nr_sequencia = nr_Seq_local_pa_p;

	
update 	atendimento_paciente
set 	dt_chamada_paciente  = clock_timestamp(),         
		nr_seq_local_pa      = nr_seq_local_pa_p,
		nm_usuario           = nm_usuario_p,     
		dt_atualizacao       = clock_timestamp()          
where  	nr_atendimento       = nr_atendimento_p;

commit;

if (COALESCE(NR_SEQ_PROCESSO_w,0) > 0) then
	
		CALL alterar_status_pa_atend(NR_SEQ_PROCESSO_w,nr_atendimento_p,NR_SEQ_STATUS_w);

end if;		


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE trocar_local_paciente_ge ( nr_atendimento_p bigint, nr_seq_local_pa_p bigint, nm_usuario_p text) FROM PUBLIC;

