-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cus_consistir_orcamento ( cd_estabelecimento_p bigint, cd_tabela_custo_p bigint, cd_centro_controle_p bigint, cd_natureza_gasto_p bigint, nr_seq_tabela_p bigint, nr_seq_linha_p bigint, ds_retorno_p INOUT text) AS $body$
DECLARE


cd_centro_controle_w	integer;
ie_tipo_gasto_w		varchar(2);
nr_seq_ng_w		bigint;
ds_retorno_w		varchar(4000);
cd_empresa_w		tabela_custo.cd_empresa%type;


BEGIN

cd_empresa_w := obter_empresa_estab(cd_estabelecimento_p);

begin
	select	nr_sequencia
	into STRICT	nr_seq_ng_w
	from	natureza_gasto
	where	cd_natureza_gasto = cd_natureza_gasto_p
	and	cd_empresa = cd_empresa_w
	and	coalesce(cd_estabelecimento, cd_estabelecimento_p) = cd_estabelecimento_p
	and	ie_situacao = 'A';
exception
when no_data_found then
	begin
	ds_retorno_w := wheb_mensagem_pck.get_texto(389067, 'CD_NATUREZA_GASTO_P=' || cd_natureza_gasto_p||';CD_ESTABELECIMENTO_P=' || cd_estabelecimento_p);
	end;
when too_many_rows then
	begin
	ds_retorno_w := wheb_mensagem_pck.get_texto(389068, 'CD_NATUREZA_GASTO_P=' || cd_natureza_gasto_p||';CD_ESTABELECIMENTO_P=' || cd_estabelecimento_p);
	end;
end;

if (coalesce(ds_retorno_w, 'X') = 'X') then
	begin
		select	cd_centro_controle
		into STRICT	cd_centro_controle_w
		from	centro_controle
		where	cd_centro_controle	= cd_centro_controle_p
		and	cd_estabelecimento	= cd_estabelecimento_p;		
	exception
	when no_data_found then
		begin
		ds_retorno_w := wheb_mensagem_pck.get_texto(389055, 'CD_CENTRO_CONTROLE_P=' || cd_centro_controle_p||';CD_ESTABELECIMENTO_P=' || cd_estabelecimento_p);
		end;
	when too_many_rows then
		begin
		ds_retorno_w := wheb_mensagem_pck.get_texto(389056, 'CD_CENTRO_CONTROLE_P=' || cd_centro_controle_p||';CD_ESTABELECIMENTO_P=' || cd_estabelecimento_p);
		end;
	end;
end if;

if (coalesce(ds_retorno_w, 'X') = 'X') then
	begin
	ie_tipo_gasto_w	:= substr(cus_obter_tipo_gasto_centro(cd_estabelecimento_p, cd_centro_controle_p, null, cd_natureza_gasto_p,nr_seq_ng_w),1,1);

	if (ie_tipo_gasto_w not in ('V','F','R')) then
		begin
		ds_retorno_w := wheb_mensagem_pck.get_texto(389069);
		end;
	end if;
	end;
end if;

if (coalesce(ds_retorno_w, 'X') <> 'X') then
	begin
	ds_retorno_p := wheb_mensagem_pck.get_texto(389089, 'NR_SEQ_LINHA_P=' || nr_seq_linha_p||';DS_RETORNO_P=' || ds_retorno_w);
	end;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cus_consistir_orcamento ( cd_estabelecimento_p bigint, cd_tabela_custo_p bigint, cd_centro_controle_p bigint, cd_natureza_gasto_p bigint, nr_seq_tabela_p bigint, nr_seq_linha_p bigint, ds_retorno_p INOUT text) FROM PUBLIC;

