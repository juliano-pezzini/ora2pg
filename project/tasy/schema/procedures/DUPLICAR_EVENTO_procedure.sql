-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_evento ( nr_sequencia_p bigint, nr_atendimento_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_seq_evento_w		bigint;
cd_estabelecimento_w	bigint;
nr_atendimento_w	bigint;
cd_pessoa_duplica_w bigint;
			

BEGIN

select	nextval('qua_evento_paciente_seq')
into STRICT	nr_seq_evento_w
;

select max(cd_pessoa_fisica)
    into STRICT cd_pessoa_duplica_w
    from usuario where upper(nm_usuario) = upper(nm_usuario_p);

nr_atendimento_w	:= nr_atendimento_p;
if (not nr_atendimento_w > 0) then
	nr_atendimento_w := null;
end if;

cd_estabelecimento_w := wheb_usuario_pck.get_cd_estabelecimento;

insert into qua_evento_paciente(
	nr_sequencia,
	cd_estabelecimento,
	dt_atualizacao,
	nm_usuario,
	nr_atendimento,
	nr_seq_evento,
	dt_evento,
	ie_classificacao,
	ds_evento,
	cd_setor_atendimento,
	dt_cadastro,
	nm_usuario_origem,
	dt_atualizacao_nrec,
	nm_usuario_nrec,
	nr_seq_classif_evento,
	dt_analise,
	nm_usuario_reg,
	nr_seq_disp_pac,
	ie_situacao,
	nr_cirurgia,
	cd_pessoa_fisica,
	nr_seq_pepo,
	cd_perfil_ativo,
	cd_profissional,
	ie_status,
	nr_seq_gravidade,
	ie_origem,
	nr_seq_tipo_evento,
	nr_seq_motivo_cancel,
	ie_restrito_usuario,
	ie_tipo_evento,
	nr_seq_modelo,
	nm_usuario_analise,
	ds_observacao,
	cd_funcao_ativa)
SELECT	nr_seq_evento_w,
	cd_estabelecimento_w,
	clock_timestamp(),
	nm_usuario_p,
	nr_atendimento_w,
	nr_seq_evento,
	clock_timestamp(),
	ie_classificacao,
	ds_evento,
	cd_setor_atendimento,
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	nr_seq_classif_evento,
	dt_analise,
	nm_usuario_p,
	nr_seq_disp_pac,
	'A',
	nr_cirurgia,
	cd_pessoa_fisica,
	nr_seq_pepo,
	cd_perfil_ativo,
	cd_pessoa_duplica_w,
	ie_status,
	nr_seq_gravidade,
	ie_origem,
	nr_seq_tipo_evento,
	nr_seq_motivo_cancel,
	ie_restrito_usuario,
	ie_tipo_evento,
	nr_seq_modelo,
	nm_usuario_analise,
	ds_observacao,
	cd_funcao_ativa
from	qua_evento_paciente
where	nr_sequencia = nr_sequencia_p;	
	

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_evento ( nr_sequencia_p bigint, nr_atendimento_p bigint, nm_usuario_p text) FROM PUBLIC;

