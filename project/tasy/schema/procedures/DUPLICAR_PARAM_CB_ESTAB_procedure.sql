-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_param_cb_estab ( cd_estabelecimento_p bigint, cd_estab_duplic_p bigint, nm_usuario_p text ) AS $body$
DECLARE


count_w				bigint;
IE_ABRIR_SALDO_w		varchar(1);
IE_AGRUPA_TRANS_CONTAB_w	varchar(1);
IE_CONTAB_BORDERO_w		varchar(1);
IE_CONTAB_CP_NO_CB_w		varchar(1);
IE_CONTAB_CR_NO_CB_w		varchar(1);
IE_CONTAB_VL_ESTORNO_w		varchar(1);
IE_DATA_CONTABIL_w		varchar(1);
IE_HIST_CONTABIL_w		varchar(1);
nm_usuario_p_w			varchar(15);
nm_usuario_p_nrec_w		varchar(15);
IE_AGRUP_MOVTO_TRANSF_w		varchar(15);
IE_CONTAB_CONCIL_w		varchar(1);
IE_CONTAB_BORDERO_CP_w		varchar(1);
IE_BAIXA_LOTE_CP_w		varchar(5);
IE_BAIXA_LOTE_CR_w		varchar(5);
IE_CONTAB_TRANSIT_CR_w		varchar(1);
IE_ESTORNO_CONCIL_PEND_w	varchar(1);
IE_CONSISTE_NF_w		varchar(1);
IE_VARIACAO_CAMBIAL_w		varchar(1);
NR_RECIBO_ATUAL_w		bigint;
IE_CONTAB_TRANSIT_TF_w		varchar(1);
IE_COMPL_HISTORICO_W		varchar(3);

BEGIN

select	count(*)
into STRICT	count_w
from	PARAMETRO_CONTROLE_BANC
where	cd_estabelecimento = cd_estab_duplic_p;

if (count_w = 0) then
	insert into PARAMETRO_CONTROLE_BANC(CD_ESTABELECIMENTO,
		DT_ATUALIZACAO,
		DT_ATUALIZACAO_NREC,
		IE_ABRIR_SALDO,
		IE_AGRUPA_TRANS_CONTAB,
		IE_COMPL_HISTORICO,
		IE_CONTAB_BORDERO,
		IE_CONTAB_CP_NO_CB,
		IE_CONTAB_CR_NO_CB,
		IE_CONTAB_VL_ESTORNO,
		IE_DATA_CONTABIL,
		IE_HIST_CONTABIL,
		NM_USUARIO,
		NM_USUARIO_NREC,
		IE_AGRUP_MOVTO_TRANSF,
		IE_CONTAB_CONCIL,
		IE_CONTAB_BORDERO_CP,
		IE_BAIXA_LOTE_CP,
		IE_BAIXA_LOTE_CR,
		IE_CONTAB_TRANSIT_CR,
		IE_ESTORNO_CONCIL_PEND,
		IE_CONSISTE_NF,
		IE_VARIACAO_CAMBIAL,
		NR_RECIBO_ATUAL,
		IE_CONTAB_TRANSIT_TF)
	SELECT	cd_estab_duplic_p,
		clock_timestamp(),
		clock_timestamp(),
		IE_ABRIR_SALDO,
		IE_AGRUPA_TRANS_CONTAB,
		IE_COMPL_HISTORICO,
		IE_CONTAB_BORDERO,
		IE_CONTAB_CP_NO_CB,
		IE_CONTAB_CR_NO_CB,
		IE_CONTAB_VL_ESTORNO,
		IE_DATA_CONTABIL,
		IE_HIST_CONTABIL,
		nm_usuario_p,
		nm_usuario_p,
		IE_AGRUP_MOVTO_TRANSF,
		IE_CONTAB_CONCIL,
		IE_CONTAB_BORDERO_CP,
		IE_BAIXA_LOTE_CP,
		IE_BAIXA_LOTE_CR,
		IE_CONTAB_TRANSIT_CR,
		IE_ESTORNO_CONCIL_PEND,
		IE_CONSISTE_NF,
		IE_VARIACAO_CAMBIAL,
		NR_RECIBO_ATUAL,
		IE_CONTAB_TRANSIT_TF
	from	parametro_controle_banc a
	where	a.cd_estabelecimento	= cd_estabelecimento_p;
else

	select	IE_ABRIR_SALDO,
		IE_AGRUPA_TRANS_CONTAB,
		IE_COMPL_HISTORICO,
		IE_CONTAB_BORDERO,
		IE_CONTAB_CP_NO_CB,
		IE_CONTAB_CR_NO_CB,
		IE_CONTAB_VL_ESTORNO,
		IE_DATA_CONTABIL,
		IE_HIST_CONTABIL,
		nm_usuario_p,
		nm_usuario_p,
		IE_AGRUP_MOVTO_TRANSF,
		IE_CONTAB_CONCIL,
		IE_CONTAB_BORDERO_CP,
		IE_BAIXA_LOTE_CP,
		IE_BAIXA_LOTE_CR,
		IE_CONTAB_TRANSIT_CR,
		IE_ESTORNO_CONCIL_PEND,
		IE_CONSISTE_NF,
		IE_VARIACAO_CAMBIAL,
		NR_RECIBO_ATUAL,
		IE_CONTAB_TRANSIT_TF
	into STRICT	IE_ABRIR_SALDO_w,
		IE_AGRUPA_TRANS_CONTAB_w,
		IE_COMPL_HISTORICO_W,
		IE_CONTAB_BORDERO_w,
		IE_CONTAB_CP_NO_CB_w,
		IE_CONTAB_CR_NO_CB_w,
		IE_CONTAB_VL_ESTORNO_w,
		IE_DATA_CONTABIL_w,
		IE_HIST_CONTABIL_w,
		nm_usuario_p_w,
		nm_usuario_p_nrec_w,
		IE_AGRUP_MOVTO_TRANSF_w,
		IE_CONTAB_CONCIL_w,
		IE_CONTAB_BORDERO_CP_w,
		IE_BAIXA_LOTE_CP_w,
		IE_BAIXA_LOTE_CR_w,
		IE_CONTAB_TRANSIT_CR_w,
		IE_ESTORNO_CONCIL_PEND_w,
		IE_CONSISTE_NF_w,
		IE_VARIACAO_CAMBIAL_w,
		NR_RECIBO_ATUAL_w,
		IE_CONTAB_TRANSIT_TF_w
	from	parametro_controle_banc a
	where	a.cd_estabelecimento	= cd_estabelecimento_p;

	update	PARAMETRO_CONTROLE_BANC
	set	DT_ATUALIZACAO		= clock_timestamp(),
		DT_ATUALIZACAO_NREC	= clock_timestamp(),
		IE_ABRIR_SALDO		= IE_ABRIR_SALDO_W,
		IE_AGRUPA_TRANS_CONTAB	= IE_AGRUPA_TRANS_CONTAB_W,
		IE_COMPL_HISTORICO	= IE_COMPL_HISTORICO_W,
		IE_CONTAB_BORDERO	= IE_CONTAB_BORDERO_W,
		IE_CONTAB_CP_NO_CB	= IE_CONTAB_CP_NO_CB_W,
		IE_CONTAB_CR_NO_CB	= IE_CONTAB_CR_NO_CB_W,
		IE_CONTAB_VL_ESTORNO	= IE_CONTAB_VL_ESTORNO_W,
		IE_DATA_CONTABIL	= IE_DATA_CONTABIL_W,
		IE_HIST_CONTABIL	= IE_HIST_CONTABIL_W,
		NM_USUARIO		= nm_usuario_p_W,
		NM_USUARIO_NREC		= nm_usuario_p_nrec_w,
		IE_AGRUP_MOVTO_TRANSF	= IE_AGRUP_MOVTO_TRANSF_W,
		IE_CONTAB_CONCIL	= IE_CONTAB_CONCIL_W,
		IE_CONTAB_BORDERO_CP	= IE_CONTAB_BORDERO_CP_W,
		IE_BAIXA_LOTE_CP	= IE_BAIXA_LOTE_CP_W,
		IE_BAIXA_LOTE_CR	= IE_BAIXA_LOTE_CR_W,
		IE_CONTAB_TRANSIT_CR	= IE_CONTAB_TRANSIT_CR_W,
		IE_ESTORNO_CONCIL_PEND	= IE_ESTORNO_CONCIL_PEND_W,
		IE_CONSISTE_NF		= IE_CONSISTE_NF_W,
		IE_VARIACAO_CAMBIAL	= IE_VARIACAO_CAMBIAL_W,
		NR_RECIBO_ATUAL		= NR_RECIBO_ATUAL_W,
		IE_CONTAB_TRANSIT_TF	= IE_CONTAB_TRANSIT_TF_W
	where	cd_estabelecimento	= cd_estab_duplic_p;
end if;

commit;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_param_cb_estab ( cd_estabelecimento_p bigint, cd_estab_duplic_p bigint, nm_usuario_p text ) FROM PUBLIC;

