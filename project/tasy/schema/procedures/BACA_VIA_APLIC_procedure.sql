-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_via_aplic () AS $body$
DECLARE


nr_prescricao_w		bigint;
nr_sequencia_w		integer;
ie_via_aplicacao_w		varchar(05);

c01 CURSOR FOR
SELECT nr_prescricao,
	nr_sequencia,
	ie_via_aplicacao
from	prescr_material a
where	(ie_via_aplicacao IS NOT NULL AND ie_via_aplicacao::text <> '')
and	not exists (
    	SELECT 1 from via_aplicacao b
	where a.ie_via_aplicacao = b.ie_via_aplicacao);


BEGIN

update material
set ie_via_aplicacao  = NULL
where ie_via_aplicacao = '0';
commit;

update paciente_protocolo_medic
set ie_via_aplicacao  = NULL
where ie_via_aplicacao = '0';
commit;

update protocolo_medic_material
set ie_via_aplicacao  = NULL
where ie_via_aplicacao = '0';
update protocolo_medic_material
set ie_via_aplicacao = 'VO'
where upper(ie_via_aplicacao) = 'ORAL';
update protocolo_medic_material
set ie_via_aplicacao = 'IV'
where ie_via_aplicacao = 'EV';
commit;

update paciente_atend_medic
set ie_via_aplicacao  = NULL
where ie_via_aplicacao = '0';
update paciente_atend_medic
set ie_via_aplicacao = 'VO'
where upper(ie_via_aplicacao) = 'ORAL';
update paciente_atend_medic
set ie_via_aplicacao = 'IV'
where ie_via_aplicacao = 'EV';
commit;

OPEN C01;
LOOP
FETCH C01 INTO
	nr_prescricao_w,
	nr_sequencia_w,
	ie_via_aplicacao_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	if (ie_via_aplicacao_w = 'im') then
		ie_via_aplicacao_w	:= 'IM';
	elsif (ie_via_aplicacao_w = 'IM ') then
		ie_via_aplicacao_w	:= 'IM';
	elsif (ie_via_aplicacao_w = 'EV') then
		ie_via_aplicacao_w	:= 'IM';
	elsif (ie_via_aplicacao_w = 'IM,') then
		ie_via_aplicacao_w	:= 'IM';
	elsif (ie_via_aplicacao_w = 'IM ') then
		ie_via_aplicacao_w	:= 'IM';
	elsif (ie_via_aplicacao_w = 'I M') then
		ie_via_aplicacao_w	:= 'IM';
	elsif (ie_via_aplicacao_w = 'Im') then
		ie_via_aplicacao_w	:= 'IM';
	elsif (ie_via_aplicacao_w = 'Im') then
		ie_via_aplicacao_w	:= 'IM';
	elsif (ie_via_aplicacao_w = 'iv') then
		ie_via_aplicacao_w	:= 'IV';
	elsif (ie_via_aplicacao_w = 'vo') then
		ie_via_aplicacao_w	:= 'VO';
	elsif (ie_via_aplicacao_w = 'EV') then
		ie_via_aplicacao_w	:= 'IV';
	elsif (upper(ie_via_aplicacao_w) = 'ORAL') then
		ie_via_aplicacao_w	:= 'VO';
	elsif (upper(ie_via_aplicacao_w) = 'SLIN') then
		ie_via_aplicacao_w	:= 'SL';
	elsif (upper(ie_via_aplicacao_w) = 'SCUT') then
		ie_via_aplicacao_w	:= 'SC';
	elsif (ie_via_aplicacao_w = 'sc') then
		ie_via_aplicacao_w	:= 'SC';
	elsif (ie_via_aplicacao_w = 's c') then
		ie_via_aplicacao_w	:= 'SC';
	elsif (ie_via_aplicacao_w = 'SC ') then
		ie_via_aplicacao_w	:= 'SC';
	elsif (ie_via_aplicacao_w = '0') then
		ie_via_aplicacao_w	:= '';
	elsif (substr(upper(ie_via_aplicacao_w),1,2) = 'TO') then
		ie_via_aplicacao_w	:= 'UT';
	end if;
	update prescr_material
	set	ie_via_aplicacao	= ie_via_aplicacao_w
	where	nr_prescricao		= nr_prescricao_w
	and	nr_sequencia		= nr_sequencia_w;
END LOOP;
CLOSE c01;
Commit;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_via_aplic () FROM PUBLIC;

