-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE suspender_horarios_pendentes ( ie_tipo_item_p text, nr_atendimento_p bigint, nr_prescricao_p bigint, nr_seq_proced_p text, nm_usuario_p text) AS $body$
DECLARE

 
nr_seq_proc_hor_w	bigint;
dt_horario_proc_w	timestamp;
cd_procedimento_w	bigint;
ie_ctrl_glic_w		varchar(15);
ie_tipo_item_w		varchar(10);

c01 CURSOR FOR 
SELECT	a.nr_sequencia, 
		a.dt_horario, 
		a.cd_procedimento, 
		obter_ctrl_glic_proc(nr_seq_proc_interno) 
from	prescr_proc_hor a 
where	a.nr_prescricao		= nr_prescricao_p 
and		a.nr_seq_procedimento 	= nr_seq_proced_p 
and		coalesce(a.dt_suspensao::text, '') = '' 
and 	coalesce(a.dt_fim_horario::text, '') = '';


BEGIN 
if (ie_tipo_item_p = 'G') then 
	open C01;
	loop 
	fetch C01 into	 
		nr_seq_proc_hor_w, 
		dt_horario_proc_w, 
		cd_procedimento_w, 
		ie_ctrl_glic_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */
		begin 
		if (ie_ctrl_glic_w = 'CCG') then 
			ie_tipo_item_w	:= 'G';
		else	 
			ie_tipo_item_w	:= 'C';
		end if;	
				 
		if (nr_seq_proc_hor_w IS NOT NULL AND nr_seq_proc_hor_w::text <> '') then 
			CALL suspender_prescr_proc_hor(nr_seq_proc_hor_w, nm_usuario_p);
			CALL Gerar_Alter_Hor_Prescr_Adep(nr_atendimento_p, ie_tipo_item_w, cd_procedimento_w, nr_prescricao_p, nr_seq_proced_p, nr_seq_proc_hor_w,dt_horario_proc_w, 12, null, obter_desc_expressao(729667), null, nm_usuario_p);
		end if;
		end;
	end loop;
	close C01;	
end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE suspender_horarios_pendentes ( ie_tipo_item_p text, nr_atendimento_p bigint, nr_prescricao_p bigint, nr_seq_proced_p text, nm_usuario_p text) FROM PUBLIC;

