-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE registrar_sm_body_location (nm_usuario_p text, nr_seq_location_p bigint, ds_body_model_p text, ie_age_p text, ie_gender_p text, ie_weight_p text, ds_side_p text, id_area_p text, ie_operacao_p bigint) AS $body$
DECLARE


existe_body_w varchar(1);
nr_seq_body_location_w bigint;
nr_seq_body_area_w     bigint;


BEGIN

    IF ie_operacao_p = 1 THEN
    
        SELECT nextval('sm_body_location_seq') 
          INTO STRICT nr_seq_body_location_w
;

        SELECT coalesce(MAX(1),0), coalesce(max(body_.nr_sequencia), nr_seq_body_location_w)
          INTO STRICT existe_body_w, nr_seq_body_location_w
          FROM sm_body_location body_
         WHERE body_.nr_seq_location = nr_seq_location_p
           AND body_.ie_gender = ie_gender_p
           AND body_.ds_side = ds_side_p;

        IF existe_body_w < 1 THEN
            INSERT INTO SM_BODY_LOCATION(
                nr_sequencia,
                dt_atualizacao,
                nm_usuario,
                dt_atualizacao_nrec,
                nm_usuario_nrec,
                nr_seq_location,
                ds_body_model,
                ie_age,
                ie_gender,
                ie_weight,
                ds_side
            ) VALUES (
                nr_seq_body_location_w,
                TRUNC(clock_timestamp()),
                nm_usuario_p,
                NULL,
                NULL,
                nr_seq_location_p,
                ds_body_model_p,
                ie_age_p,
                ie_gender_p,
                ie_weight_p,
                ds_side_p);
            COMMIT;
        END IF;

        DELETE 
          FROM SM_BODY_AREA
         WHERE nr_seq_body_location = nr_seq_body_location_w;
         COMMIT;

        INSERT INTO SM_BODY_AREA(
            nr_sequencia,
            dt_atualizacao,
            nm_usuario,
            dt_atualizacao_nrec,
            nm_usuario_nrec,
            ds_area,
            nr_seq_body_location
        ) VALUES (
            nextval('sm_body_area_seq'),
            TRUNC(clock_timestamp()),
            nm_usuario_p,
            NULL,
            NULL,
            id_area_p,
            nr_seq_body_location_w);
            COMMIT;
    end IF;
    IF ie_operacao_p = 2 THEN

    SELECT area.nr_Sequencia, body_.nr_sequencia
      INTO STRICT nr_seq_body_area_w, nr_seq_body_location_w
      FROM sm_body_location body_, sm_body_area area
     WHERE body_.nr_sequencia = area.nr_Seq_body_location
       and body_.nr_seq_location = nr_seq_location_p 
       and body_.ie_gender = ie_gender_p
       and body_.ds_side = ds_side_p
       
       and area.ds_area = id_area_p;

        DELETE FROM SM_BODY_AREA
         WHERE SM_BODY_AREA.nr_sequencia = nr_Seq_body_area_w;
        COMMIT;

        DELETE FROM SM_BODY_LOCATION
         WHERE SM_BODY_LOCATION.nr_sequencia = nr_seq_body_location_w
           AND SM_BODY_LOCATION.ie_gender = ie_gender_p;
        COMMIT;

    END IF;
    
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE registrar_sm_body_location (nm_usuario_p text, nr_seq_location_p bigint, ds_body_model_p text, ie_age_p text, ie_gender_p text, ie_weight_p text, ds_side_p text, id_area_p text, ie_operacao_p bigint) FROM PUBLIC;

