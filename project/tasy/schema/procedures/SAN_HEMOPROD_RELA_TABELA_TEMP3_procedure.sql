-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE san_hemoprod_rela_tabela_temp3 ( dt_inicio_p text, dt_final_p timestamp, ie_opcao_p text) AS $body$
DECLARE

 
ds_campo_w	varchar(255);
ie_opcao_w	varchar(15);			
ds_resultado_w	varchar(255);
qt_resultado_w	bigint;
qt_resultado2_w	bigint;
qt1_w		bigint;
qt2_w		bigint;
qt3_w		bigint;
qt_result1_w	varchar(15);
qt_result2_w	varchar(15);
qt_result3_w	varchar(15);
dt_inicio_w	timestamp;
dt_final_w	timestamp;

C01 CURSOR FOR 
	SELECT	a.vl_dominio, 
		CASE WHEN a.vl_dominio='S' THEN 'Repetição'  ELSE a.ds_valor_dominio END  ds_valor_dominio 
	from 	valor_dominio a 
	where	cd_dominio 	= 2936 
	and	ie_opcao_p 	in ('T','A');
	
 
C02 CURSOR FOR 
	SELECT	a.vl_dominio, 
		a.ds_valor_dominio 
	from 	valor_dominio a 
	where	cd_dominio = 4 and a.ds_valor_dominio not in ('Indeterminado') 
	and	ie_opcao_p in ('T','A');

C03 CURSOR FOR 
	SELECT	1 cd_faixa, 
		'18 até 29 anos' ds_faixa 
	 
	where 	ie_opcao_p in ('T','A') 
	
union
 
	SELECT	2 cd_faixa, 
		'Acima de 29 anos' ds_faixa 
	 
	where	ie_opcao_p in ('T','A');
	
	 
 
C04 CURSOR FOR 
	SELECT	'Anemia' ds 
	 
	
union
 
	SELECT	'Hipertensão' 
	  	   
	
union
								 
	select	'Hipotensão' 
									 
	
union
								 
	select	'Alcoolismo' 
			 
	
union
								 
	select	'Comportamento de risco para DST' 
	 
	
union
								 
	select	'Uso de drogas' 
	 
	
union
								 
	select	'Hepatite' 
	 
	
union
								 
	select	'Doença de Chagas' 
	 
	
union
								 
	select	'Malária' 
	;
	
	 
C05 CURSOR FOR 
	SELECT	'Dificuldade de Punção Venosa' ds 
	  	   
	
union
								 
	SELECT	'Reação Vagal' 
									 
	
union
								 
	select	'Outros' 
	;

C06 CURSOR FOR 
	SELECT	'Doença de Chagas' ds 
	 
	
union
 
	SELECT	'HIV' 
	  	   
	
union
								 
	select	'Sífilis' 
									 
	
union
								 
	select	'Hepatite B' 
			 
	
union
								 
	select	'HBs Ag.' 
	 
	
union
								 
	select	'Anti HBc' 
	 
	
union
								 
	select	'Hepatite C' 
	 
	
union
								 
	select	'HTLV I e II' 
	 
	
union
								 
	select	'ALT/TGP' 
											 
	
union
								 
	select	'Malária' 
	;

C07 CURSOR FOR 
	SELECT	a.ds_valor_dominio||b.ds ds_sangue 
	from (SELECT	ds_valor_dominio 
		from 	valor_dominio a 
		where	cd_dominio = 1173) a, 
		(select	'+' ds 
		 
		
union
 
		select	'-' ds 
		) b 
	where	ie_opcao_p in ('E','A') 
	order by ds_sangue;
	
C08 CURSOR FOR 
	SELECT	nr_sequencia, 
		ds_derivado 
	from	san_derivado 
	where	ie_situacao = 'A' 
	and	ie_opcao_p in ('P','A');
	
	/*select	 ie_tipo_derivado, 
		ds_tipo_derivado ds_tipo_derivado 
	from 	(select distinct	decode(a.nr_sequencia,15,'-3',16,'-3', a.ie_tipo_derivado) ie_tipo_derivado, 
			 	decode(a.nr_sequencia,15,'Plaquetaferese',16,'Plaquetaferese', ds_derivado) ds_tipo_derivado 
		from 	san_derivado a 
		where	ie_situacao = 'A' 
		union 
		select	 '-1', 
			 'Concentrado de Hemácias sem buffy coat' 
		from	 dual 
		union 
		select	 '-2', 
			 'Concentrado de Plaquetas sem buffy coat' 
		from	 dual) 
	where	ie_tipo_derivado is not null 
	and	ie_opcao_p in ('P','A');*/
 
 
C09 CURSOR FOR 
	SELECT 	distinct nr_seq_derivado, 
		a.ds_derivado 
	from	san_producao b, 
		san_derivado a 
	where	b.nr_seq_derivado = a.nr_sequencia 
	and	a.ie_situacao = 'A' 
	and	ie_opcao_p in ('P','A') 
	order by ds_derivado;

 
C10 CURSOR FOR 
	SELECT 	DISTINCT 
		x.ds_derivado ds_derivado, 
		--NVL(b.qt_ambulatorio,0) qt_ambulatorio, 
		'', 
		coalesce(c.qt_entidade,0) qt_hospitalar 			 
	FROM san_derivado x
LEFT OUTER JOIN (	SELECT	COUNT(*) qt_ambulatorio, 
				b.nr_seq_derivado 
			FROM	san_derivado c, 
				atendimento_paciente d, 
				san_producao b, 
				san_transfusao a 
			WHERE	1 = 1 
			and	c.ie_situacao = 'A' 
			AND	a.nr_sequencia = b.nr_seq_transfusao 
			AND	b.nr_seq_derivado = c.nr_sequencia 
			AND	a.nr_atendimento = d.nr_atendimento 
			AND	ie_tipo_atendimento = 8 
			and	b.nr_seq_derivado not in (17,19) 
			AND	to_char(a.dt_transfusao,'mm/yyyy') = dt_inicio_p 
			GROUP BY	c.ds_derivado, 
				b.nr_seq_derivado 
		) b ON (x.nr_sequencia = b.nr_seq_derivado)
LEFT OUTER JOIN (	SELECT	COUNT(*) qt_entidade, 
				b.nr_seq_derivado 
			FROM	san_derivado c, 
				atendimento_paciente d, 
				san_producao b, 
				san_transfusao a 
			WHERE	1 = 1 
			and	c.ie_situacao = 'A' 
			AND	a.nr_sequencia = b.nr_seq_transfusao 
			AND	b.nr_seq_derivado = c.nr_sequencia 
			AND	a.nr_atendimento = d.nr_atendimento 
			and	c.ie_situacao = 'A' 
			--AND	ie_tipo_atendimento <> 8 
			--and	b.nr_seq_derivado not in (17,19) 
			AND	to_char(a.dt_transfusao,'mm/yyyy') = dt_inicio_p 
			GROUP BY	c.ds_derivado, 
				b.nr_seq_derivado 
		) c ON (x.nr_sequencia = c.nr_seq_derivado)
WHERE 1 = 1 and x.ie_situacao = 'A'   --and	x.nr_sequencia not in (17,19) 
  and ie_opcao_p in ('P','A') ORDER BY	ds_derivado;
	
C11 CURSOR FOR 
	SELECT 	distinct nr_sequencia, 
		ds_derivado 
	from	san_derivado a 
	where	ie_situacao = 'A' 
	and	ie_opcao_p in ('P','A');
	
C12 CURSOR FOR 
	SELECT distinct nr_sequencia, 
		ds_tipo_reacao 
	from  san_tipo_reacao 
	where ie_situacao = 'A' 
	and	ie_opcao_p in ('R','A') 
	order by ds_tipo_reacao;

C13 CURSOR FOR 
	SELECT nr_sequencia, 
		ds_derivado 
	from  san_derivado 
	where nr_sequencia in (3,12) 
	and ie_opcao_p in ('V','A') 
	order by ds_derivado;	
 
/*Cursor C14 is 
	select	a.vl_dominio, 
		a.ds_valor_dominio ds_valor_dominio 
	from 	valor_dominio a 
	where	a.cd_dominio = 1353 
	and	a.vl_dominio = 1 
	and	ie_opcao_p in ('C','A') 
	order by 2;	*/
 
	 

BEGIN 
 
/*dt_inicio_w 	:= trunc(dt_inicio_p); 
dt_final_w	:= trunc(dt_inicio_p) + 86399/86400;*/
 
 
delete		 
from	W_HEMOPROD_T;
 
 
if (ie_opcao_p IS NOT NULL AND ie_opcao_p::text <> '') and (dt_inicio_p IS NOT NULL AND dt_inicio_p::text <> '')then 
	 
	/*insert into W_HEMOPROD_T 
		(ie_tipo_informacao, 
		ds_resultado, 
		ie_tipo) 
	values	('2', 
		'1 - Identificação do Serviço de Hemoterápica', 
		'TI');*/
 
	 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('2', 
		'1 - Identificação do Serviço de Hemoterápica', 
		'2.0', 
		'S');
	 
	insert into W_HEMOPROD_T(qt_resultado_1,		 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('', 
		'2.0', 
		'2', 
		'L', 
		0);
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values ('', 
		'2.0', 
		0, 
		'R', 
		'Código do Sistema de Cadastro(ANVISA)', 
		'2');
		 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values ('AGENCIA TRANSFUSIONAL DO HOSPITAL SANTA MARTA', 
		'2.0', 
		0, 
		'R', 
		'Razão Social', 
		'2');
 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values ('LAPAC', 
		'2.0', 
		0, 
		'R', 
		'Nome Fantasia', 
		'2');
 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values ('PRIVADA', 
		'2.0', 
		0, 
		'R', 
		'Natureza da Instituição', 
		'2');	
		 
	if (ie_opcao_p = 'T') or (ie_opcao_p = 'A') then 
	 
	-- Titulo Triagem 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ie_tipo) 
	values ('2', 
		--'2 - Triagem', 
		'', 
		'TI');
	 
	-- Titulo Triagem subtitulos 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('2', 
		'2 - Triagem', 
		'2.9', 
		'S');
	 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('2', 
		'2.1 - Candidato quanto ao tipo de doação', 
		'2.1', 
		'S');
		 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('2', 
		'2.2 - Candidato quanto ao tipo de doação', 
		'2.2', 
		'S');
	 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('2', 
		'2.3 - Candidato quanto ao gênero do doador', 
		'2.3', 
		'S');
	 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('2', 
		'2.4 - Candidato quanto a idade do doador', 
		'2.4', 
		'S');
	 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('2', 
		'2.5 - Inaptidão na triagem', 
		'2.5', 
		'S');
	 
	-- Titulos Triagem label 
	insert into W_HEMOPROD_T(qt_resultado_1, 
		qt_resultado_2, 
		qt_resultado_3, 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('Total', 
		'Apto', 
		'Inapto', 
		'2.1', 
		'2', 
		'L', 
		3);
	 
	insert into W_HEMOPROD_T(qt_resultado_1, 
		qt_resultado_2, 
		qt_resultado_3, 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('Total', 
		'Apto', 
		'Inapto', 
		'2.2', 
		'2', 
		'L', 
		3);
		 
	insert into W_HEMOPROD_T(qt_resultado_1, 
		qt_resultado_2, 
		qt_resultado_3, 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('Total', 
		'Apto', 
		'Inapto', 
		'2.3', 
		'2', 
		'L', 
		3);
			 
	insert into W_HEMOPROD_T(qt_resultado_1, 
		qt_resultado_2, 
		qt_resultado_3, 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('Total', 
		'Apto', 
		'Inapto', 
		'2.4', 
		'2', 
		'L', 
		3);	
		 
	insert into W_HEMOPROD_T(qt_resultado_1, 
		qt_resultado_2, 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('Feminino', 
		'Masculino', 
		'2.5', 
		'2', 
		'L', 
		2);		
 
	 
	 
	 
	 
	/*--Total Dados 1 triagem 2.1 
	select	 count(*) qt 
	into	 qt_result1_w 
	from 	 san_doacao a 
	where	 a.dt_doacao between dt_inicio_w and dt_final_w 
	and	 a.nr_seq_tipo in (1,4); 
	 
	--Apto Dados 1 triagem 2.1 
	select	 count(*) qt 
	into	 qt_result2_w 
	from 	 san_doacao a 
	where	 a.dt_doacao between dt_inicio_w and dt_final_w 
	and	 a.nr_seq_tipo in (1,4) 
	and	 nvl(a.ie_avaliacao_final,'I') = 'A';			 
	 
	-- Inapto Dados 1 triagem 2.1 
	select	 count(*) qt 
	into	 qt_result3_w 
	from 	 san_doacao a 
	where	 a.dt_doacao between dt_inicio_w and dt_final_w 
	and	 a.nr_seq_tipo in (1,4) 
	and	 nvl(a.ie_avaliacao_final,'I') = 'I';*/
 
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		qt_resultado_2, 
		qt_resultado_3, 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values ('', 
		'', 
		'', 
		'2.1', 
		3, 
		'R', 
		'Espontânea', 
		'2');
	 
	--Total Dados 2 triagem 2.1 
	/*select	 count(*) qt 
	into	 qt_result1_w 
	from 	 san_doacao a 
	where	 a.dt_doacao between dt_inicio_w and dt_final_w 
	and	 a.nr_seq_tipo in (2,3,5,7); 
	 
	--Apto Dados 2 triagem 2.1				 
	select	 count(*) qt 
	into	 qt_result2_w 
	from 	 san_doacao a 
	where	 a.dt_doacao between dt_inicio_w and dt_final_w 
	and	 a.nr_seq_tipo in (2,3,5,7) 
	and	 nvl(a.ie_avaliacao_final,'I') = 'A'; 
	 
		 
	--Inapto Dados 2 triagem 2.1	 
	select	 count(*) qt 
	into	 qt_result3_w 
	from 	 san_doacao a 
	where	 a.dt_doacao between dt_inicio_w and dt_final_w 
	and	 a.nr_seq_tipo in (2,3,5,7) 
	and	 nvl(a.ie_avaliacao_final,'I') = 'I';		*/
 
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		qt_resultado_2, 
		qt_resultado_3, 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values ('', 
		'', 
		'', 
		'2.1', 
		3, 
		'R', 
		'Reposição', 
		'2');
	 
	 
	--Total Dados 3 triagem 2.1 
	/*select	 count(*) qt 
	into	 qt_result1_w 
	from 	 san_doacao a 
	where	 a.dt_doacao between dt_inicio_w and dt_final_w 
	and	 a.nr_seq_tipo in (6);			 
 
	--Apto Dados 3 triagem 2.1 
	select	 count(*) qt 
	into	 qt_result2_w 
	from 	 san_doacao a 
	where	 a.dt_doacao between dt_inicio_w and dt_final_w 
	and	 a.nr_seq_tipo in (6) 
	and	 nvl(a.ie_avaliacao_final,'I') = 'A'; 
		 
	--Inapto Dados 3 triagem 2.1	 
	select	 count(*) qt 
	into	 qt_result3_w 
	from 	 san_doacao a 
	where	 a.dt_doacao between dt_inicio_w and dt_final_w 
	and	 a.nr_seq_tipo in (6) 
	and	 nvl(a.ie_avaliacao_final,'I') = 'I';*/
 
 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		qt_resultado_2, 
		qt_resultado_3, 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values ('', 
		'', 
		'', 
		'2.1', 
		3, 
		'R', 
		'Autóloga', 
		'2');
		 
	/*--Total Total triagem 2.1 
	select	 count(*) qt 
	into	 qt_result1_w 
	from 	 san_doacao a 
	where	 a.dt_doacao between dt_inicio_w and dt_final_w; 
		 
		 
	--Apto Total triagem 2.1		 
	select	 count(*) qt 
	into	 qt_result2_w 
	from 	 san_doacao a 
	where	 a.dt_doacao between dt_inicio_w and dt_final_w 
	and	 nvl(a.ie_avaliacao_final,'I') = 'A'; 
	 
		 
	-- Inapto Total triagem 2.1			 
	select	 count(*) qt 
	into	 qt_result3_w 
	from 	 san_doacao a 
	where	 a.dt_doacao between dt_inicio_w and dt_final_w 
	and	 nvl(a.ie_avaliacao_final,'I') = 'I';	*/
 
			 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		qt_resultado_2, 
		qt_resultado_3, 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values ('', 
		'', 
		'', 
		'2.1', 
		3, 
		'T', 
		'Total', 
		'2');
	 
	-- Dados 1 triagem 2.2	 
	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;
	 
	open C01;
	loop 
	fetch C01 into	 
		ie_opcao_w, 
		ds_campo_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */
		begin 
		 
		/*select	 count(*) 
		into	 qt_result1_w 
		from 	 san_doacao a 
		where	 a.dt_doacao between dt_inicio_w and dt_final_w 
		and	 nvl(a.IE_TIPO_DOADOR,0) = ie_opcao_w; 
		 
		qt1_w := qt_result1_w + qt1_w; 
				 
	 
		select	 count(*) 
		into	 qt_result2_w 
		from 	 san_doacao a 
		where	 a.dt_doacao between dt_inicio_w and dt_final_w 
		and	 nvl(a.IE_TIPO_DOADOR,0) = ie_opcao_w 
		and	 nvl(a.ie_avaliacao_final,'I') = 'A'; 
		 
		qt2_w := qt_result2_w + qt2_w; 
		 
		 
		select	count(*) 
		into	qt_result3_w 
		from 	san_doacao a 
		where	a.dt_doacao between dt_inicio_w and dt_final_w 
		and	nvl(a.IE_TIPO_DOADOR,0) = ie_opcao_w 
		and	nvl(a.ie_avaliacao_final,'I') = 'I'; 
		 
		qt3_w := qt_result3_w + qt3_w;*/
 
		 
		insert into W_HEMOPROD_T(qt_resultado_1,	 
			qt_resultado_2, 
			qt_resultado_3, 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values ('', 
			'', 
			'', 
			'2.2', 
			3, 
			'R', 
			ds_campo_w, 
			'2');
		 
		end;	
		 
		 
	end loop;
	close C01;
		 
	--Total triagem 2.2 
	 
	/*select	 count(*) qt 
	into	 ds_campo_w 
	from 	 san_doacao a 
	where	 a.dt_doacao between dt_inicio_w and dt_final_w 
	and not 	 ie_tipo_doador is null;*/
 
		 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		qt_resultado_2, 
		qt_resultado_3, 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values ('', 
		'', 
		'', 
		'2.2', 
		3, 
		'T', 
		'Total', 
		'2');	
		 
	/*select	 count(*) qt 
	into	 ds_campo_w 
	from 	 san_doacao a 
	where	 a.dt_doacao between dt_inicio_w and dt_final_w 
	and	 nvl(a.ie_avaliacao_final,'I') = 'A' 
	and not ie_tipo_doador is null;*/
			 
	 
		 
		 
	/*select	 count(*) qt 
	into	 ds_campo_w 
	from 	 san_doacao a 
	where	 a.dt_doacao between dt_inicio_w and dt_final_w 
	and	 nvl(a.ie_avaliacao_final,'I') = 'I' 
	and not ie_tipo_doador is null;*/
	 
	 
	 
 
	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;
	--Dados 1 triagem 2.3 
	open C02;
	loop 
	fetch C02 into	 
		ie_opcao_w, 
		ds_campo_w;
	EXIT WHEN NOT FOUND; /* apply on C02 */
		begin 
		 
		/*select	 count(*) qt 
		into	 qt_result1_w 
		from 	 pessoa_fisica b, 
			 san_doacao a 
		where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica 
		and	 a.dt_doacao between dt_inicio_w and dt_final_w 
		and	 b.ie_sexo = ie_opcao_w; 
	 
		qt1_w := qt_result1_w + qt1_w; 
			 
	 
		select	count(*) qt 
		into	qt_result2_w 
		from 	pessoa_fisica b, 
			san_doacao a 
		where	a.cd_pessoa_fisica = b.cd_pessoa_fisica 
		and	a.dt_doacao between dt_inicio_w and dt_final_w 
		and	b.ie_sexo = ie_opcao_w 
		and	nvl(a.ie_avaliacao_final,'I') = 'A'; 
		 
		qt2_w := qt_result2_w + qt2_w;	 
			 
		 
		select	count(*) qt 
		into	qt_result3_w 
		from 	pessoa_fisica b, 
			san_doacao a		 
		where	a.cd_pessoa_fisica = b.cd_pessoa_fisica 
		and	a.dt_doacao between dt_inicio_w and dt_final_w 
		and	b.ie_sexo = ie_opcao_w 
		and	nvl(a.ie_avaliacao_final,'I') = 'I'; 
		 
		qt3_w := qt_result3_w + qt3_w;	*/
 
		 
		insert into W_HEMOPROD_T(qt_resultado_1,	 
			qt_resultado_2, 
			qt_resultado_3, 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values ('', 
			'', 
			'', 
			'2.3', 
			3, 
			'R', 
			ds_campo_w, 
			'2');
			 
		end;	
		 
		 
	end loop;
	close C02;
	 
	 
	 
	-- Total triagem 2.3 
	/*select	 count(*) qt 
	into	 ds_campo_w 
	from 	 pessoa_fisica b, 
		san_doacao a 
	where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica 
	and	 a.dt_doacao between dt_inicio_w and dt_final_w 
	and		 b.ie_sexo not in ('I') 
	and		 nvl(a.ie_avaliacao_final,'I') = 'I';*/
 
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		qt_resultado_2, 
		qt_resultado_3, 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values ('', 
		'', 
		'', 
		'2.3', 
		3, 
		'T', 
		'Total', 
		'2');
		 
	/*select	 count(*) qt 
	into	 ds_campo_w 
	from 	 pessoa_fisica b, 
		san_doacao a		 
	where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica 
	and	 a.dt_doacao between dt_inicio_w and dt_final_w 
	and		 b.ie_sexo not in ('I');*/
		 
	 
 
	/*select	 count(*) qt 
	into	 ds_campo_w 
	from 	pessoa_fisica b, 
		san_doacao a		 
	where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica 
	and	 a.dt_doacao between dt_inicio_w and dt_final_w 
	and	 b.ie_sexo not in ('I') 
	and	 nvl(a.ie_avaliacao_final,'I') = 'A';*/
		 
 
	 
	--Dados 1 triagem 2.4			 
	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;
	 
	open C03;
	loop 
	fetch C03 into	 
		ie_opcao_w, 
		ds_campo_w;		
	EXIT WHEN NOT FOUND; /* apply on C03 */
		begin 
		 
		/*select	count(*) 
		into	qt_result1_w 
		from 	pessoa_fisica b, 
			san_doacao a		 
		where	a.cd_pessoa_fisica = b.cd_pessoa_fisica 
		and	a.dt_doacao between dt_inicio_w and dt_final_w 
		and	(((ie_opcao_w = 1) and (trunc(((sysdate-b.dt_nascimento)/365)) < 18)) or 
			((ie_opcao_w = 2) and (trunc(((sysdate-b.dt_nascimento)/365)) between 18 and 29)) or 
			((ie_opcao_w = 3) and (trunc(((sysdate-b.dt_nascimento)/365)) > 29))); 
		 
		qt1_w := qt1_w + qt_result1_w; 
				 
	 
		select	 count(*) qt 
		into	 qt_result2_w 
		from 	 pessoa_fisica b, 
			san_doacao a 
		where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica 
		and	 a.dt_doacao between dt_inicio_w and dt_final_w 
		and	(((ie_opcao_w = 1) and (trunc(((sysdate-b.dt_nascimento)/365)) < 18)) or 
			((ie_opcao_w = 2) and (trunc(((sysdate-b.dt_nascimento)/365)) between 18 and 29)) or 
			((ie_opcao_w = 3) and (trunc(((sysdate-b.dt_nascimento)/365)) > 29))) 
		and		 nvl(a.ie_avaliacao_final,'I') = 'A'; 
		 
		qt2_w := qt2_w + qt_result2_w;			 
		 
		select	 count(*) qt 
		into	qt_result3_w 
		from 	pessoa_fisica b , 
			san_doacao a	 
		where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica 
		and	 a.dt_doacao between dt_inicio_w and dt_final_w 
		and	(((ie_opcao_w = 1) and (trunc(((sysdate-b.dt_nascimento)/365)) < 18)) or 
			((ie_opcao_w = 2) and (trunc(((sysdate-b.dt_nascimento)/365)) between 18 and 29)) or 
			((ie_opcao_w = 3) and (trunc(((sysdate-b.dt_nascimento)/365)) > 29))) 
		and	 nvl(a.ie_avaliacao_final,'I') = 'I'; 
		 
		qt3_w := qt3_w + qt_result3_w; */
 
		 
		insert into W_HEMOPROD_T(qt_resultado_1,	 
			qt_resultado_2, 
			qt_resultado_3, 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values ('', 
			'', 
			'', 
			'2.4', 
			3, 
			'R', 
			ds_campo_w, 
			'2');
		 
		end;	
		 
		 
	end loop;
	close C03;
 
 
	--Total Triagem 2.4 
	/*select	 count(*) qt 
	into	 ds_campo_w 
	from 	 pessoa_fisica b, 
		 san_doacao a		 
	where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica 
	and	a.dt_doacao between dt_inicio_w and dt_final_w 
	and	(((1 = 1) and (trunc(((sysdate-b.dt_nascimento)/365)) < 18)) or 
		((2 = 2) and (trunc(((sysdate-b.dt_nascimento)/365)) between 18 and 29)) or 
		((3 = 3) and (trunc(((sysdate-b.dt_nascimento)/365)) > 29))); 
	--and	 trunc(((sysdate-b.dt_nascimento)/365)) >= 18;*/ 
		 
	insert into W_HEMOPROD_T 
		(qt_resultado_1,	 
		qt_resultado_2, 
		qt_resultado_3, 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values	('', 
		'', 
		'', 
		'2.4', 
		3, 
		'T', 
		'Total', 
		'2');			 
		 
	/*select	 count(*) qt 
	into	 ds_campo_w 
	from 	pessoa_fisica b, 
		san_doacao a		 
	where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica 
	and	a.dt_doacao between dt_inicio_w and dt_final_w 
	and	(((1 = 1) and (trunc(((sysdate-b.dt_nascimento)/365)) < 18)) or 
		((2 = 2) and (trunc(((sysdate-b.dt_nascimento)/365)) between 18 and 29)) or 
		((3 = 3) and (trunc(((sysdate-b.dt_nascimento)/365)) > 29))) 
	and		 nvl(a.ie_avaliacao_final,'I') = 'A';*/
	 
		 
 
	/*select	 count(*) qt 
	into	 ds_campo_w 
	from 	pessoa_fisica b, 
		san_doacao a		 
	where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica 
	and	a.dt_doacao between dt_inicio_w and dt_final_w 
	and	(((1 = 1) and (trunc(((sysdate-b.dt_nascimento)/365)) < 18)) or 
		((2 = 2) and (trunc(((sysdate-b.dt_nascimento)/365)) between 18 and 29)) or 
		((3 = 3) and (trunc(((sysdate-b.dt_nascimento)/365)) > 29))) 
	and		 nvl(a.ie_avaliacao_final,'I') = 'I';*/
	 
			 
	 
	-- Dados 1 triagem 2.5 
	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;
	 
	open C04;
	loop 
	fetch C04 into	 
		ds_campo_w;
	EXIT WHEN NOT FOUND; /* apply on C04 */
		begin 
		 
			 
		insert into W_HEMOPROD_T(qt_resultado_1,	 
			qt_resultado_2, 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values ('', 
			'', 
			'2.5', 
			2, 
			'R', 
			ds_campo_w, 
			'2');
		 
		 
		 
		end;	
		 
		 
	end loop;
	close C04;
	 
	 
 
	-- Outros Triagem 2.5 
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
			qt_resultado_2, 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values ('', 
			'', 
			'2.5', 
			2, 
			'R', 
			'Outros', 
			'2');
	 
	 
	-- Total triagem 2.5 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		qt_resultado_2, 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values ('', 
		'', 
		'2.5', 
		2, 
		'T', 
		'Total', 
		'2');	
																				 
	end if;	
	 
	if (ie_opcao_p = 'C') or (ie_opcao_p = 'A') then 
	-- Titulo Coleta 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ie_tipo) 
	values ('3', 
		'3 - Coleta', 
		'TI');		
	 
	-- Titulo Coleta subtitulos 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('3', 
		' ', 
		'3.1', 
		'S');
	 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('3', 
		'3.2 - Interrupções na coleta', 
		'3.2', 
		'S');
	 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('3', 
		'3.3 - Total coletas', 
		'3.3', 
		'S');
	 
	-- Titulos Coleta label 
	insert into W_HEMOPROD_T(qt_resultado_1,		 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('Total',		 
		'3.1', 
		'3', 
		'L', 
		1);
		 
	insert into W_HEMOPROD_T(qt_resultado_1,		 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('Total',		 
		'3.2', 
		'3', 
		'L', 
		1);
	 
	insert into W_HEMOPROD_T(qt_resultado_1,		 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('Total',		 
		'3.3', 
		'3', 
		'L', 
		1);	
	 
	--Titulo Coleta 3.1 
	/*select	count(*)	 
	into	qt_result1_w 
	from 	san_doacao a 
	where	a.nr_motivo_desistencia is not null 
	and	a.dt_doacao between dt_inicio_w and dt_final_w;*/
 
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values ('',		 
		'3.1', 
		1, 
		'R', 
		'3.1 - Desistência:' , 
		'3');
					 
	--Dados coleta 3.2 
	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;
	 
	open C05;
	loop 
	fetch C05 into	 
		ds_campo_w;
	EXIT WHEN NOT FOUND; /* apply on C05 */
		begin 
		 
			 
		insert into W_HEMOPROD_T(qt_resultado_1,	 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values ('',		 
			'3.2', 
			1, 
			'R', 
			ds_campo_w, 
			'3');
	 
		 
		 
		end;	
		 
		 
	end loop;
	close C05;
					 
	--Total coleta 3.2 
	/*select	count(*) 
	into	ds_campo_w 
	from	san_doacao a, 
		SAN_DOACAO_REACAO b, 
		san_tipo_reacao c 
	where	a.nr_sequencia = b.nr_seq_doacao 
	and	b.nr_seq_reacao = c.nr_sequencia 
	and	a.dt_doacao between dt_inicio_w and dt_final_w 
	and	c.nr_seq_grupo_reacao is not null;*/
 
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values ('',		 
		'3.2', 
		1, 
		'T', 
		'Total', 
		'3');
	 
	 
	-- DAdos sangue total coleta 3.3 
	/*open C14; 
	loop 
	fetch C14 into	 
		ie_opcao_w, 
		ds_campo_w; 
	exit when C14%notfound; 
		begin 
		 
		select	 count(*) 
		into	qt_result1_w 
		from 	 san_doacao a 
		where	 a.dt_doacao between dt_inicio_w and dt_final_w 
		and	a.ie_tipo_coleta = ie_opcao_w; 
	 
		qt1_w := qt_result1_w + qt1_w; 
		 
		insert into W_HEMOPROD_T 
			(qt_resultado_1,	 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values	('',		 
			'3.3', 
			1, 
			'R', 
			ds_campo_w, 
			'3'); 
	 
		 
		 
		end;	 
		 
		 
	end loop; 
	close C14;*/
 
	 
	-- Sangue total coleta 3.3 
	/*select	 count(*) 
	into	qt_result1_w 
	from 	 san_doacao a 
	where	 a.dt_doacao between dt_inicio_w and dt_final_w 
	and	a.ie_tipo_coleta in (0,2);*/
 
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values ('',		 
			'3.3', 
			1, 
			'R', 
			'Sangue total', 
			'3');
					 
						 
	--Total coleta 3.3 
	select	 count(*) 
	into STRICT	qt_result1_w 
	from 	 san_doacao a 
	where	 to_char(a.dt_doacao,'mm/yyyy') = dt_inicio_p 
	and	(a.IE_TIPO_COLETA IS NOT NULL AND a.IE_TIPO_COLETA::text <> '');
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values ('',		 
		'3.3', 
		1, 
		'R', 
		'Por aférese', 
		'3');
	 
	 
	 
	end if;
	 
	 
	if (ie_opcao_p = 'E') or (ie_opcao_p = 'A') then 
	 
	-- Titulo Triagem 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ie_tipo) 
	values ('4', 
		'4 - Exames realizados', 
		'TI');
	 
	 
	-- Titulo Triagem subtitulos 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('4', 
		'4.1 - Triagem de doenças transmissíveis pelo sangue', 
		'4.1', 
		'S');
			 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('4', 
		'4.2 - ImunoHematologia', 
		'4.2', 
		'S');	
		 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('4', 
		'4.3 - Outros tipos de pesquisa', 
		'4.3', 
		'S');	
	 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('4', 
		'4.4 - Inaptidão na triagem dos exames', 
		'4.4', 
		'S');
	 
	-- Titulos Triagem label 
	insert into W_HEMOPROD_T(qt_resultado_1, 
		qt_resultado_2, 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('Testadas', 
		'Reagentes', 
		'4.1', 
		'4', 
		'L', 
		2);
	 
	insert into W_HEMOPROD_T(qt_resultado_1, 
		qt_resultado_2, 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('Doador', 
		'Receptor', 
		'4.2', 
		'4', 
		'L', 
		2);	
	 
	insert into W_HEMOPROD_T(qt_resultado_1, 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('Total', 
		'4.3', 
		'4', 
		'L', 
		1);
		 
	insert into W_HEMOPROD_T(qt_resultado_1, 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('Total', 
		'4.4', 
		'4', 
		'L', 
		1);	
	 
	--Dados E.R 4.1	 
	open C06;
	loop 
	fetch C06 into	 
		ds_campo_w;
	EXIT WHEN NOT FOUND; /* apply on C06 */
		begin 
		 
		 
		 
		insert into W_HEMOPROD_T(qt_resultado_1,	 
			qt_resultado_2, 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values ('', 
			'', 
			'4.1', 
			2, 
			'R', 
			ds_campo_w,			 
			'4');
			 
		 
		end;	
		 
		 
	end loop;
	close C06;
	 
	--Total E.R 4.1 
	 
			 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		qt_resultado_2, 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values ('', 
		'', 
		'4.1', 
		2, 
		'T', 
		'Total', 
		'4');
					 
	--E.R 4.2 Sangue				 
	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;	
	 
	open C07;
	loop 
	fetch C07 into	 
		ie_opcao_w;
	EXIT WHEN NOT FOUND; /* apply on C07 */
		begin 
		 
		select	 count(*) ds 
		into STRICT	qt_result1_w 
		from 	 pessoa_fisica b, 
			san_doacao a 
		where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica 
		and	 ie_avaliacao_final = 'A' 
		and	 b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = ie_opcao_w 
		and	 to_char(a.dt_coleta,'mm/yyyy') = dt_inicio_p;
		 
		qt1_w := qt_result1_w + qt1_w;
 
	 
		select	 count(*) ds 
		into STRICT	qt_result2_w 
		from	 pessoa_fisica b , 
			san_transfusao a 
		where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica 
		and		 to_char(a.dt_transfusao,'mm/yyyy') = dt_inicio_p 
		and		 b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = ie_opcao_w;
		 
		qt2_w := qt_result2_w + qt2_w;
		 
		insert into W_HEMOPROD_T(qt_resultado_1,	 
			qt_resultado_2, 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values (qt_result1_w, 
			qt_result2_w, 
			'4.2', 
			2, 
			'R', 
			ie_opcao_w, 
			'4');
			 
		 
		end;	
		 
		 
	end loop;
	close C07;
	 
	--E.R 4.2 Total sangue 
	/*select	count(*) 
	into	ds_campo_w	 
	from	san_doacao a, 
		pessoa_fisica b 
	where	a.cd_pessoa_fisica = b.cd_pessoa_fisica 
	and	ie_avaliacao_final = 'A' 
	and	b.ie_tipo_sangue is not null 
	and	a.dt_coleta between trunc(dt_inicio_w,'dd') and trunc(dt_final_p,'dd') + 86399/86400;*/
 
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		qt_resultado_2, 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values (qt1_w, 
		qt2_w, 
		'4.2', 
		2, 
		'R', 
		'Total', 
		'4');
					 
	/*select	 count(*) ds 
	into	ds_campo_w 
	from 	 pessoa_fisica b, 
		san_transfusao a 
	where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica 
	and	 a.dt_transfusao between trunc(dt_inicio_w,'dd') and trunc(dt_final_p,'dd') + 86399/86400 
	and b.ie_tipo_sangue is not null;*/
			 
 
	 
	--E.R 4.2 Indefinido 
	/*select	 count(*) 
	into	ds_campo_w 
	from 	 pessoa_fisica b, 
		san_transfusao a 
	where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica 
	and		 a.dt_transfusao between trunc(dt_inicio_w,'dd') and trunc 
(dt_final_p,'dd') + 86399/86400 
	and		 ((b.ie_tipo_sangue is null) and (b.ie_fator_rh is null)); 
	 
	insert into W_HEMOPROD_T (	QT_RESULTADO,	 
					IE_TIPO) 
			values		(ds_campo_w,		 
					'D_Indefinido_4_2');*/
 
	 
	--E.R 4.2 D Fraco 
 
	/*select count(*) 
	into	qt_result1_w 
	from 	 san_doacao a, 
		pessoa_fisica b, 
		 san_exame_lote c, 
		 san_exame_realizado d 
	where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica 
	and		 a.nr_sequencia = c.nr_seq_doacao 
	and		 d.nr_seq_exame_lote = c.nr_sequencia 
	and		 d.nr_seq_exame = 11 
	and		 ie_avaliacao_final = 'A' 
	and		 ((b.ie_tipo_sangue||nvl(b.ie_fator_rh,'-') = 'A+') or (b.ie_tipo_sangue||nvl(b.ie_fator_rh,'-') = 'A-') or 
			(b.ie_tipo_sangue||nvl(b.ie_fator_rh,'-') = 'AB+') or (b.ie_tipo_sangue||nvl(b.ie_fator_rh,'-') = 'AB-') or 
			(b.ie_tipo_sangue||nvl(b.ie_fator_rh,'-') = 'B+') or (b.ie_tipo_sangue||nvl(b.ie_fator_rh,'-') = 'B-') or 
			(b.ie_tipo_sangue||nvl(b.ie_fator_rh,'-') = 'O+') or (b.ie_tipo_sangue||nvl(b.ie_fator_rh,'-') = 'O-'))	 
	and		 to_char(a.dt_coleta,'mm/yyyy') = dt_inicio_p 
	and		 ((upper(d.ds_resultado) = 'POSITIVO') or (upper(d.ds_resultado) = 'REAGENTE'));	*/
 
	 
		insert into W_HEMOPROD_T(qt_resultado_1,	 
			qt_resultado_2, 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values ('-', 
			' - ', 
			'4.2', 
			2, 
			'R', 
			'D Fraco:', 
			'4');	
					 
	--E.R 4.2 Coomps 
	/*select	 count(*) qt 
	into	qt_result2_w 
	from 	 san_transfusao a, 
		 pessoa_fisica b, 
		 san_exame_lote c, 
		 san_exame_realizado d 
	where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica 
	and		 a.nr_sequencia = c.nr_seq_transfusao 
	and		 d.nr_seq_exame_lote = c.nr_sequencia 
	and		 d.nr_seq_exame = 15 
	and		 ((b.ie_tipo_sangue||nvl(b.ie_fator_rh,'-') = 'A+') or (b.ie_tipo_sangue||nvl(b.ie_fator_rh,'-') = 'A-') or 
			(b.ie_tipo_sangue||nvl(b.ie_fator_rh,'-') = 'AB+') or (b.ie_tipo_sangue||nvl(b.ie_fator_rh,'-') = 'AB-') or 
			(b.ie_tipo_sangue||nvl(b.ie_fator_rh,'-') = 'B+') or (b.ie_tipo_sangue||nvl(b.ie_fator_rh,'-') = 'B-') or 
			(b.ie_tipo_sangue||nvl(b.ie_fator_rh,'-') = 'O+') or (b.ie_tipo_sangue||nvl(b.ie_fator_rh,'-') = 'O-'))			 
	and		 to_char(a.dt_transfusao,'mm/yyyy') = dt_inicio_p 
	and		 ((upper(d.ds_resultado) = 'POSITIVO') or (upper(d.ds_resultado) = 'REAGENTE'));	*/
 
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
			qt_resultado_2, 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values (' - ', 
			' - ', 
			'4.2', 
			2, 
			'R', 
			'Coombs:', 
			'4');	
					 
	--E.R 4.2 PAI 
	/*SELECT	 COUNT(*) qtd 
	into	 qt_result2_w 
	FROM 	 san_transfusao a, 
		 pessoa_fisica b, 
		 san_exame_lote c, 
		 san_exame_realizado d 
	WHERE	 a.cd_pessoa_fisica = b.cd_pessoa_fisica 
	AND	 a.nr_sequencia = c.nr_seq_transfusao 
	AND	 d.nr_seq_exame_lote = c.nr_sequencia 
	AND	 d.nr_seq_exame = 10 
	AND	 ((b.ie_tipo_sangue||NVL(b.ie_fator_rh,'-') = 'A+') OR (b.ie_tipo_sangue||NVL(b.ie_fator_rh,'-') = 'A-') OR 
		 (b.ie_tipo_sangue||NVL(b.ie_fator_rh,'-') = 'AB+') OR (b.ie_tipo_sangue||NVL(b.ie_fator_rh,'-') = 'AB-') OR 
		 (b.ie_tipo_sangue||NVL(b.ie_fator_rh,'-') = 'B+') OR (b.ie_tipo_sangue||NVL(b.ie_fator_rh,'-') = 'B-') OR 
		 (b.ie_tipo_sangue||NVL(b.ie_fator_rh,'-') = 'O+') OR (b.ie_tipo_sangue||NVL(b.ie_fator_rh,'-') = 'O-'))			 
	AND	 to_char(a.dt_transfusao,'mm/yyyy') = dt_inicio_p 
	and	 ((upper(d.ds_resultado) = 'POSITIVO') or (upper(d.ds_resultado) = 'REAGENTE'));	*/
 
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
			qt_resultado_2, 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values (' - ', 
			' - ', 
			'4.2', 
			2, 
			'R', 
			'Pai:', 
			'4');	
	 
	--E.R 4.2 Abo 
	/*SELECT	 COUNT(*) qt 
	into	qt_result1_w 
		FROM 	 san_doacao a, 
				 pessoa_fisica b 
		WHERE	 a.cd_pessoa_fisica = b.cd_pessoa_fisica 
		AND		 ie_avaliacao_final = 'A' 
		AND		 to_char(a.dt_coleta,'mm/yyyy') = dt_inicio_p 
		AND		 ((b.ie_tipo_sangue||NVL(b.ie_fator_rh,'-') = 'O-') OR	(b.ie_tipo_sangue||NVL(b.ie_fator_rh,'-') = 'AB-') 
		or	(b.ie_tipo_sangue||NVL(b.ie_fator_rh,'-') = 'A-') or (b.ie_tipo_sangue||NVL(b.ie_fator_rh,'-') = 'B-')); 
		 
	 
	SELECT	 COUNT(*) qt 
	into	qt_result2_w 
		FROM 	 san_transfusao a, 
				 pessoa_fisica b 
		WHERE	 a.cd_pessoa_fisica = b.cd_pessoa_fisica 
		AND		 to_char(a.dt_transfusao,'mm/yyyy') = dt_inicio_p 
		AND		 ((b.ie_tipo_sangue||NVL(b.ie_fator_rh,'-') = 'O-') OR (b.ie_tipo_sangue||NVL(b.ie_fator_rh,'-') = 'AB-') 
		or	(b.ie_tipo_sangue||NVL(b.ie_fator_rh,'-') = 'A-') or (b.ie_tipo_sangue||NVL(b.ie_fator_rh,'-') = 'B-'));*/
 
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
			qt_resultado_2, 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values ('-', 
			'-', 
			'4.2', 
			2, 
			'R', 
			'Fenotipagem - Soma do ABO Neg:', 
			'4');	
					 
	 
	--E.R 4.3 Titulo campos 
 
	/*select	count(*) 
	into	qt_result1_w 
	from	san_doacao a, 
		san_exame_lote b, 
		san_exame_realizado c 
	where	b.nr_seq_doacao = a.nr_sequencia 
	and	c.nr_seq_exame_lote = b.nr_sequencia 
	and	c.nr_seq_exame = 9 
	and 	c.ds_resultado is not null 
	and	a.dt_doacao between trunc(dt_inicio_w,'dd') and trunc(dt_final_p,'dd') + 86399/86400;	*/
 
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values ('', 
			'4.3', 
			1, 
			'R', 
			'Pesquisa de Hb S no doador - ', 
			'4');	
 
	--Dados 1 ER 4.4 
	/*select	count(distinct a.nr_sequencia) 
	into	qt_result1_w 
	from	san_doacao a, 
		san_exame_lote b, 
		san_exame_realizado c, 
		san_exame d 
	where	b.nr_seq_doacao = a.nr_sequencia 
	and	c.nr_seq_exame_lote = b.nr_sequencia 
	and	c.nr_seq_exame = d.nr_sequencia 
	--and	a.ie_avaliacao_final = 'A' 
	--and 	d.ie_exige_senha = 'S' 
	--and	((upper(c.ds_resultado) = 'POSITIVO') or (upper(c.ds_resultado) = 'REAGENTE')) 
	and	c.ds_resultado is not null 
	and	a.dt_coleta between trunc(dt_inicio_w,'dd') and trunc(dt_final_p,'dd') + 86399/86400;*/
 
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values ('', 
			'4.4', 
			1, 
			'R', 
			'Número total de bolsas testadas', 
			'4');	
					 
						 
	--Dados 2 ER 4.4 
	/*select	count(distinct a.nr_sequencia) 
	into	qt_result1_w 
	from	san_doacao a, 
		san_exame_lote b, 
		san_exame_realizado c, 
		san_exame d 
	where	b.nr_seq_doacao = a.nr_sequencia 
	and	c.nr_seq_exame_lote = b.nr_sequencia 
	and	c.nr_seq_exame = d.nr_sequencia 
	--and	a.ie_avaliacao_final = 'A' 
	--and 	san_obter_destino_exame(c.nr_seq_exame,3) = 'S' 
	--and	d.ie_exige_senha = 'S'*/ 
	/*and 	(select	count(*) 
		from	san_exame_realizado y, 
			san_exame z 
		where	y.nr_seq_exame_lote = b.nr_sequencia 
		and	y.nr_seq_exame = z.nr_sequencia 
		and	a.dt_coleta between trunc(dt_inicio_w,'dd') and trunc(dt_final_p,'dd') + 86399/86400 
		and	((upper(y.ds_resultado) = 'POSITIVO') or (upper(y.ds_resultado) = 'REAGENTE')) 
		and 	z.ie_exige_senha = 'S') > 1	*/
		 	   
	/*and	replace(upper(ds_resultado),' ','') in ('POSITIVO','REAGENTE') 
	and	a.dt_coleta between dt_inicio_w and dt_final_w;*/
 
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values ('', 
			'4.4', 
			1, 
			'R', 
			'Total bolsas reagente p/ 1 ou + marcadores no mesmo período', 
			'4');
	 
	 
	end if;
	 
	if (ie_opcao_p = 'D') or (ie_opcao_p = 'A') then 
	-- descarte 
	 
	-- Titulo Descarte 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ie_tipo) 
	values ('5', 
		'5 - Descarte de bolsa', 
		'TI');
	 
	-- Titulo Descarte subtitulos 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('5', 
		' ', 
		'5.1', 
		'S');
	 
	-- Titulos Descarte label 
	insert into W_HEMOPROD_T(qt_resultado_1,		 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('Total', 
		'5.1', 
		'5', 
		'L', 
		1);
	 
	-- Dados 
	/*select 	count(*) 
	into 	qt_result1_w 
	from 	SAN_INUTILIZACAO a, 
   		San_Producao b 
	where 	a.nr_seq_motivo_inutil = 8 		 
	and 	a.DT_INUTILIZACAO between dt_inicio_w and trunc(dt_final_p) + 86399/86400 
	and 	a.nr_sequencia = b.nr_seq_inutil; */
 
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values ('', 
			'5.1', 
			1, 
			'R', 
			'5.1 Bolsas descartadas por auto-exclusão ', 
			'5');
					 
					 
	end if;
	 
	if (ie_opcao_p = 'P') or (ie_opcao_p = 'A') then 
	 
	-- Titulo Produção 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ie_tipo) 
	values ('6', 
		'6 - Produção hemoterápica', 
		'TI');
	 
	-- Titulo Triagem subtitulos 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('6', 
		'6.1 - Entradas / Perdas / Transfusões / Distribuição para outros serviços', 
		'6.1', 
		'S');
	 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo, 
		ie_quebra) 
	values ('6', 
		'Perdas', 
		'6.2', 
		'S', 
		'S');
		 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('6', 
		'Transfusão', 
		'6.3', 
		'S');	
		 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo, 
		ie_quebra) 
	values ('6', 
		'Distribuidas a outros setores', 
		'6.4', 
		'S', 
		'S');	
	 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('6', 
		'6.2 - Procedimentos de modificação dos hemocomponentes', 
		'6.5', 
		'S');	
	 
		 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('6', 
		' ', 
		'6.7', 
		'S');	
	 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('6', 
		' ', 
		'6.6', 
		'S');	
		 
	 
	 
	-- Titulo label produção 
	 
	insert into W_HEMOPROD_T(qt_resultado_1, 
		qt_resultado_2, 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('Produção', 
		'Recebidas', 
		'6.1', 
		'6', 
		'L', 
		2);
	 
	insert into W_HEMOPROD_T(qt_resultado_1, 
		qt_resultado_2, 
		qt_resultado_3, 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('Rompimento', 
		'Vencida', 
		'Outros', 
		'6.2', 
		'6', 
		'L', 
		3);
	 
	insert into W_HEMOPROD_T(qt_resultado_1, 
		qt_resultado_2, 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('Ambulatório', 
		'Hospitalar', 
		'6.3', 
		'6', 
		'L', 
		2);
	 
	insert into W_HEMOPROD_T(qt_resultado_1, 
		qt_resultado_2, 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('S/ exames pré transf', 
		'C/ exames pré-transf', 
		'6.4', 
		'6', 
		'L', 
		2);
	 
	insert into W_HEMOPROD_T(qt_resultado_1, 
		qt_resultado_2, 
		qt_resultado_3, 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('Irradiação', 
		'Lavagem', 
		'Filtração', 
		'6.5', 
		'6', 
		'L', 
		3);
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		qt_resultado_2, 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('Plaquetas', 
		'C.Hemaceas', 
		'6.7', 
		'6', 
		'L', 
		2);
	 
	insert into W_HEMOPROD_T(qt_resultado_1,		 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('Total', 
		'6.6', 
		'6', 
		'L', 
		1);		
		 
		 
	 
	 
	--Dados 1 Produção 6.1 
	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;
	 
	open C08;
	loop 
	fetch C08 into	 
		ie_opcao_w, 
		ds_campo_w;
	EXIT WHEN NOT FOUND; /* apply on C08 */
		begin 
		 
		/*select	 count(*) 
		into	qt_result1_w 
		from 	 san_producao a, 
			san_doacao b, 
			san_derivado c 
		where	 a.nr_seq_doacao = b.nr_sequencia 
		and	 a.nr_seq_derivado = c.nr_sequencia 
		and	 a.nr_seq_emp_ent is null 
		and	 to_char(b.dt_doacao,'mm/yyyy') = dt_inicio_p 
		and	 ((c.ie_tipo_derivado = ie_opcao_w and c.nr_sequencia not in(15,16)) or (ie_opcao_w = '-3' and c.nr_sequencia in (15,16))); 
		 
		qt1_w := qt1_w + qt_result1_w;*/
 
				 
	 
		select	 count(*) 
		into STRICT	qt_result2_w 
		from 	 san_producao a, 
			 san_emprestimo b, 
			 san_derivado c 
		where	 a.nr_seq_emp_ent = b.nr_sequencia 
		and	 a.nr_seq_derivado = c.nr_sequencia 
		and	 (a.nr_seq_emp_ent IS NOT NULL AND a.nr_seq_emp_ent::text <> '') 
		and	 to_char(b.dt_emprestimo,'mm/yyyy') = dt_inicio_p 
		and	c.nr_sequencia = ie_opcao_w;
		 
		qt2_w := qt2_w + qt_result2_w;
		 
		insert into W_HEMOPROD_T(qt_resultado_1,	 
			qt_resultado_2, 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values ('', 
			qt_result2_w, 
			'6.1', 
			2, 
			'R', 
			ds_campo_w, 
			'6');	
		 
		 
		end;	
		 
		 
	end loop;
	close C08;
	 
	--Total 1 Produção 6.1 
	/*select	 count(*) 
		into	ds_campo_w 
		from 	 san_producao a, 
			san_doacao b, 
			san_derivado c 
		where	 a.nr_seq_doacao = b.nr_sequencia 
		and	 a.nr_seq_derivado = c.nr_sequencia 
		and	 a.nr_seq_emp_ent is null 
		and	 b.dt_doacao between dt_inicio_w and dt_final_w;*/
 
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		qt_resultado_2, 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values ('', 
		qt2_w, 
		'6.1', 
		2, 
		'T', 
		'Total', 
		'6');
	 
	 
	/*select	 count(*) 
		into	ds_campo_w 
		from 	 san_producao a, 
			 san_emprestimo b, 
			 san_derivado c 
		where	 a.nr_seq_emp_ent = b.nr_sequencia 
		and	 a.nr_seq_derivado = c.nr_sequencia 
		and	 a.nr_seq_emp_ent is not null 
		and	 b.dt_emprestimo between dt_inicio_w and dt_final_w;*/
 
	 
	 
	 
	--Dados 2 Produção 6.1 
	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;
	 
	open C09;
	loop 
	fetch C09 into	 
		ie_opcao_w, 
		ds_campo_w;
	EXIT WHEN NOT FOUND; /* apply on C09 */
		begin 
				 
		insert into W_HEMOPROD_T(qt_resultado_1,	 
			qt_resultado_2, 
			qt_resultado_3, 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values ('', 
			'', 
			'', 
			'6.2', 
			3, 
			'R', 
			ds_campo_w, 
			'6');	
		 
		 
		end;	
		 
		 
	end loop;
	close C09;
	 
	-- Total 2 Producao 6.2 
	 
	/*select Count(*) 
	into	ds_campo_w 
	from  san_inutilizacao a, 
	    san_producao b 
	where a.nr_sequencia = b.nr_seq_inutil 
	and  b.nr_seq_derivado in (6,3,12,1,7,5,19) 
	and  a.nr_seq_motivo_inutil not in (33,1) 
	and  a.dt_inutilizacao between dt_inicio_w and dt_final_w;*/
 
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		qt_resultado_2, 
		qt_resultado_3, 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values ('', 
		'', 
		'', 
		'6.2', 
		3, 
		'T', 
		'Total', 
		'6');
	 
	 
	/*select Count(*) 
	into	ds_campo_w 
	from  san_inutilizacao a, 
	    san_producao b 
	where a.nr_sequencia = b.nr_seq_inutil 
	and  b.nr_seq_derivado in (6,3,12,1,7,5,19) 
	and  a.nr_seq_motivo_inutil = 33 
	and  a.dt_inutilizacao between dt_inicio_w and dt_final_w;*/
 
	 
					 
	/*select Count(*) 
	into	ds_campo_w 
	from  san_inutilizacao a, 
	    san_producao b 
	where a.nr_sequencia = b.nr_seq_inutil 
	and  b.nr_seq_derivado in (6,3,12,1,7,5,19) 
	and  a.nr_seq_motivo_inutil = 1 
	and  a.dt_inutilizacao between dt_inicio_w and dt_final_w;*/
 
 
	 
	 
	--Dados 3 Produção 6.1 
	open C10;
	loop 
	fetch C10 into	 
		ds_campo_w, 
		qt_result1_w, 
		qt_result2_w;
	EXIT WHEN NOT FOUND; /* apply on C10 */
		begin 
		/*insert into W_HEMOPROD_T (	DS_RESULTADO, 
					QT_RESULTADO,	 
					QT_RESULTADO_1, 
					ie_tipo) 
			values		(ds_resultado_w, 
					qt_resultado_w, 
					qt_resultado2_w, 
					'D3_Dados_6_2');*/
 
					 
		insert into W_HEMOPROD_T(qt_resultado_1,	 
			qt_resultado_2, 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values (qt_result1_w, 
			qt_result2_w, 
			'6.3', 
			2, 
			'R', 
			ds_campo_w, 
			'6');				
		 
		 
		end;
	end loop;
	close C10;
	 
	 
	 
	--Total 3 Produção 6.1 
	/*SELECT	COUNT(*) qt_ambulatorio 
	into	qt_result1_w 
	FROM	san_derivado c, 
		atendimento_paciente d, 
		san_producao b, 
		san_transfusao a 
	WHERE	1 = 1 
	and	c.ie_situacao = 'A' 
	AND	a.nr_sequencia = b.nr_seq_transfusao 
	AND	b.nr_seq_derivado = c.nr_sequencia 
	AND	a.nr_atendimento = d.nr_atendimento 
	AND	ie_tipo_atendimento = 8 
	AND	to_char(a.dt_transfusao,'mm/yyyy') = dt_inicio_p;*/
 
					 
						 
 
	SELECT	COUNT(*) qt_entidade 
	into STRICT	qt_result2_w 
	FROM	san_derivado c, 
		atendimento_paciente d, 
		san_producao b, 
		san_transfusao a 
	WHERE	1 = 1 
	and	c.ie_situacao = 'A' 
	AND	a.nr_sequencia = b.nr_seq_transfusao 
	AND	b.nr_seq_derivado = c.nr_sequencia 
	AND	a.nr_atendimento = d.nr_atendimento 
	and	c.ie_situacao = 'A' 
	AND	ie_tipo_atendimento <> 8 
	AND	to_char(a.dt_transfusao,'mm/yyyy') = dt_inicio_p;
 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		qt_resultado_2, 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values ('', 
		qt_result2_w,		 
		'6.3', 
		2, 
		'T', 
		'Total', 
		'6');
	 
	 
	 
	--Dados 4 Produção 6.1 
	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;
	 
	open C11;
	loop 
	fetch C11 into	 
		ie_opcao_w, 
		ds_campo_w;
	EXIT WHEN NOT FOUND; /* apply on C11 */
		begin 
		 
	 
		 
		insert into W_HEMOPROD_T(qt_resultado_1,	 
			qt_resultado_2, 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values ('', 
			'', 
			'6.4', 
			2, 
			'R', 
			ds_campo_w, 
			'6');				
	 
		 
		 
		end;	
		 
		 
	end loop;
	close C11;
	 
	--Total 4 Produção 6.1 
	/*select sum(qt) 
	into	ds_campo_w 
	from(select  count(*) qt	 
	from	san_transfusao a, 
		san_producao d 
	where  d.nr_seq_transfusao = a.nr_sequencia   
	and	 exists (select 1 
		      from	 san_exame_lote b, 
		  	   	 san_exame_realizado c 
		    	 where  b.nr_seq_producao = d.nr_sequencia 
			 and	c.ds_resultado is null 
		      and   c.nr_seq_exame_lote = b.nr_sequencia) 
	and	not exists (select 1 
		      from	 san_exame_lote b, 
		  	   	 san_exame_realizado c 
		    	 where  b.nr_seq_producao = d.nr_sequencia 
			 and	c.ds_resultado is not null 
		      and   c.nr_seq_exame_lote = b.nr_sequencia)		  
	and	dt_transfusao between dt_inicio_w and dt_final_w 
	union all 
		select count(*) qt 
			from  	san_reserva a, 
				san_reserva_prod g, 
				san_producao v 
			where 	dt_reserva between dt_inicio_w and dt_final_w 
			and  	a.nr_sequencia = g.nr_seq_reserva 
			and  	g.nr_seq_producao = v.nr_sequencia 
			and   exists (select 1 
			from  	san_exame_lote b, 
				san_exame_realizado c 
			where  	b.nr_seq_res_prod = g.nr_sequencia 
			and	c.ds_resultado is null 
			and   	c.nr_seq_exame_lote = b.nr_sequencia) 
			and   not exists (select 1 
			from  	san_exame_lote b, 
				san_exame_realizado c 
			where  	b.nr_seq_res_prod = g.nr_sequencia 
			and	c.ds_resultado is not null 
			and   	c.nr_seq_exame_lote = b.nr_sequencia));*/
 
				 
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		qt_resultado_2, 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values ('', 
		'',		 
		'6.4', 
		2, 
		'T', 
		'Total', 
		'6');			
		 
	 
	 
	/*select sum(qt) 
	into	ds_campo_w 
	from(select  count(*) qt	 
	from	san_transfusao a, 
		san_producao d 
	where  d.nr_seq_transfusao = a.nr_sequencia   
	and	 exists (select 1 
		      from	 san_exame_lote b, 
		  	   	 san_exame_realizado c 
		    	 where  b.nr_seq_producao = d.nr_sequencia 
			 and	c.ds_resultado is not null 
		      and   c.nr_seq_exame_lote = b.nr_sequencia) 
	and	dt_transfusao between dt_inicio_w and dt_final_w 
	union all 
		select count(*) qt 
			from  	san_reserva a, 
				san_reserva_prod g, 
				san_producao v 
			where 	dt_reserva between dt_inicio_w and dt_final_w 
			and  	a.nr_sequencia = g.nr_seq_reserva 
			and  	g.nr_seq_producao = v.nr_sequencia 
			and   exists (select 1 
			from  	san_exame_lote b, 
				san_exame_realizado c 
			where  	b.nr_seq_res_prod = g.nr_sequencia 
			and	c.ds_resultado is not null 
			and   	c.nr_seq_exame_lote = b.nr_sequencia));*/
 
	 
		 
		 
	 
	 
	 
	--Total Producao 6.2 
	SELECT 	COUNT(a.nr_seq_derivado) 
	into STRICT	qt_result1_w 
	FROM	san_producao a, 
		san_transfusao b 
	WHERE	a.nr_seq_transfusao = b.nr_sequencia 
	and	to_char(b.dt_transfusao,'mm/yyyy') = dt_inicio_p 
	AND 	a.ie_filtrado = 'S';	
 
					 
	SELECT COUNT(a.nr_seq_derivado) 
	into STRICT	qt_result2_w 
	FROM san_producao a, 
		san_transfusao b 
	WHERE	a.nr_seq_transfusao = b.nr_sequencia 
	and	to_char(b.dt_transfusao,'mm/yyyy') = dt_inicio_p 
	AND a.ie_irradiado = 'S';
 
 
	/*SELECT COUNT (nr_seq_derivado) 
	into	qt_result3_w 
	FROM san_producao	  
	WHERE dt_producao between dt_inicio_w and dt_final_p 
	AND ie_lavado = 'S';				*/
 
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
			qt_resultado_2, 
			qt_resultado_3, 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values (qt_result2_w, 
			'', 
			qt_result1_w, 
			'6.5', 
			2, 
			'R', 
			'Total', 
			'6');
	 
	 
	 
	--Sub Producao 6.2 
	SELECT COUNT(nr_seq_derivado) 
	into STRICT qt_result1_w 
	FROM san_producao a, 
	   san_derivado b	  
	WHERE to_char(a.dt_producao,'mm/yyyy') = dt_inicio_p 
	and  a.nr_Seq_derivado = b.nr_sequencia 
	AND ie_filtrado = 'S' 
	and coalesce(b.ie_tipo_derivado,b.ie_tipo_hemocomponente) = 'CP';	
					 
					 
	SELECT COUNT(nr_seq_derivado) 
	into STRICT qt_result2_w 
	FROM san_producao a, 
	   san_derivado b	  
	WHERE to_char(a.dt_producao,'mm/yyyy') = dt_inicio_p 
	and  a.nr_Seq_derivado = b.nr_sequencia 
	AND ie_filtrado = 'S' 
	and coalesce(b.ie_tipo_derivado,b.ie_tipo_hemocomponente) = 'CH';
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
			qt_resultado_2, 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values (qt_result1_w, 
			qt_result2_w, 
			'6.7', 
			2, 
			'R', 
			'Filtração', 
			'6');
	 
	 
	--Titulo producao 6.2.4 
	select	count(*) 
	into STRICT	qt_result1_w 
	from 	san_producao a 
	where	ie_aliquotado = 'S' 
	and to_char(dt_producao,'mm/yyyy') = dt_inicio_p;
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values (qt_result1_w, 
			'6.6', 
			1, 
			'R', 
			'6.2.4 - Fracionamento pediátrico', 
			'6');
	 
	 
	 
	 
	end if;	
	 
	if (ie_opcao_p = 'R') or (ie_opcao_p = 'A') then 
	 
	-- Titulo reações transfusionais 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ie_tipo) 
	values ('7', 
		'7 - Reações transfusionais', 
		'TI');
	 
	-- Titulo reações transfusionais subtitulos 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('7', 
		' ', 
		'7.1', 
		'S');
	 
	-- Titulos Triagem label 
	insert into W_HEMOPROD_T(qt_resultado_1, 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('Total', 
		'7.1', 
		'7', 
		'L', 
		1);
	 
	--Dados reações transfusionais 7.0 
	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;
	 
	open C12;
	loop 
	fetch C12 into	 
		ie_opcao_w, 
		ds_campo_w;
	EXIT WHEN NOT FOUND; /* apply on C12 */
		begin 
		 
		select count(*) 
		into STRICT	qt_result1_w 
		from  SAN_TRANS_REACAO a, 
		    san_producao b, 
		    san_transfusao c 
		where a.nr_seq_producao = b.nr_sequencia 
		and  b.nr_seq_transfusao = c.nr_sequencia 
		and  a.nr_seq_reacao = ie_opcao_w 
		and  to_char(c.dt_transfusao,'mm/yyyy') = dt_inicio_p;
		 
		qt1_w := qt_result1_w + qt1_w;
		 
		insert into W_HEMOPROD_T(qt_resultado_1,	 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values (qt_result1_w, 
			'7.1', 
			1, 
			'R', 
			ds_campo_w, 
			'7');
		 
		end;	
		 
		 
	end loop;
	close C12;
	 
	 
	--Outros Reações transfusionais 7.0 
	/*select count(*) 
	into	ds_campo_w 
	from  SAN_TRANS_REACAO a, 
	    san_producao b, 
	    san_transfusao c 
	where a.nr_seq_producao = b.nr_sequencia 
	and  b.nr_seq_transfusao = c.nr_sequencia 
	and  a.nr_seq_reacao not in (43,42,45,47,54,49) 
	and  c.dt_transfusao between dt_inicio_w and dt_final_w;*/
 
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values (qt1_w, 
		'7.1', 
		1, 
		'T', 
		'Total', 
		'7');
	 
	 
	end if;
 
	if (ie_opcao_p = 'V') or (ie_opcao_p = 'A') then 
	-- Titulo Envio 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ie_tipo) 
	values ('8', 
		'8 - Envio de plasma para produção de hemoderivados', 
		'TI');
	 
	-- Titulo Triagem subtitulos 
	insert into W_HEMOPROD_T(ie_tipo_informacao, 
		ds_resultado, 
		ds_banda_superior, 
		ie_tipo) 
	values ('8', 
		' ', 
		'8.1', 
		'S');
	 
	-- Titulos Triagem label 
	insert into W_HEMOPROD_T(qt_resultado_1, 
		ds_banda_superior, 
		ie_tipo_informacao, 
		ie_tipo, 
		qt_coluna) 
	values ('Total', 
		'8.1', 
		'8', 
		'L', 
		1);
	 
	--Dados envio 8.1 
	/*open C13; 
	loop 
	fetch C13 into	 
		ie_opcao_w, 
		ds_campo_w; 
	exit when C13%notfound; 
		begin 
		 
		select count(*) 
		into	qt_result1_w 
		from  san_emprestimo a, 
		    san_producao b 
		where b.nr_seq_emp_saida = a.nr_sequencia 
		and  b.nr_seq_derivado = ie_opcao_w 
		and	a.dt_emprestimo between dt_inicio_w and dt_final_w; 
    
		 
		insert into W_HEMOPROD_T 
			(qt_resultado_1,	 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values	(qt_result1_w, 
			'8.1', 
			1, 
			'R', 
			ds_campo_w, 
			'8'); 
		 
		end;	 
		 
		 
	end loop; 
	close C13;*/
 
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values ('', 
			'8.1', 
			1, 
			'R', 
			'Plasma Fresco Congelado', 
			'8');
    	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
			ds_banda_superior, 
			qt_coluna, 
			ie_tipo, 
			ds_resultado, 
			ie_tipo_informacao) 
		values ('', 
			'8.1', 
			1, 
			'R', 
			'Plasma Normal', 
			'8');
	 
	insert into W_HEMOPROD_T(qt_resultado_1,	 
		ds_banda_superior, 
		qt_coluna, 
		ie_tipo, 
		ds_resultado, 
		ie_tipo_informacao) 
	values ('',		 
		'8.1', 
		1, 
		'T', 
		'Total', 
		'8');			
	 
	end if;
	 
end if;		
 
		 
		 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE san_hemoprod_rela_tabela_temp3 ( dt_inicio_p text, dt_final_p timestamp, ie_opcao_p text) FROM PUBLIC;

