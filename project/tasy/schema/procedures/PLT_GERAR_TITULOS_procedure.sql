-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE plt_gerar_titulos ( nm_usuario_p text, cd_estabelecimento_p bigint, cd_setor_atendimento_p bigint, cd_perfil_p bigint, nr_seq_regra_p bigint) AS $body$
DECLARE


cont_w				bigint;
nr_seq_wrep_w			bigint;
ie_copiar_w			varchar(5);
ie_regra_inclusao_w		varchar(1);
ie_regra_incl_dieta_oral_w	varchar(15)	:= 'S';
ie_regra_incl_supl_oral_w	varchar(15)	:= 'S';
ie_regra_incl_leite_w		varchar(15)	:= 'N';
ie_regra_incl_solucao_w		varchar(15)	:= 'S';
ie_regra_incl_medicamento_w	varchar(15)	:= 'S';
ie_regra_incl_material_w	varchar(15)	:= 'R';
ie_regra_incl_procedimento_w	varchar(15)	:= 'S';
ie_regra_incl_coleta_w		varchar(15)	:= 'S';
ie_regra_incl_ccg_w		varchar(15)	:= 'S';
ie_regra_incl_cig_w		varchar(15)	:= 'S';
ie_regra_incl_recomendacao_w	varchar(15)	:= 'S';
ie_regra_incl_intervencao_w	varchar(15)	:= 'S';
ie_regra_incl_ivc_w		varchar(15)	:= 'N';
ie_regra_incl_gas_w		varchar(15)	:= 'N';
ie_regra_incl_hemoterapia_w	varchar(15)	:= 'N';
ie_regra_incl_jejum_w		varchar(15)	:= 'S';
ie_regra_incl_sne_w		varchar(15)	:= 'N';
ie_regra_incl_npt_adulta_w	varchar(15)	:= 'N';
ie_regra_incl_npt_pedia_w	varchar(15)	:= 'N';
ie_regra_incl_npt_neonatal_w	varchar(15)	:= 'N';
ie_regra_incl_dialise_w		varchar(15)	:= 'N';
ds_cor_titulo_w			varchar(20);

c01 CURSOR FOR
SELECT	coalesce(ie_dieta_oral,'S'),
	coalesce(ie_suplemento_oral,'S'),
	coalesce(ie_solucao,'S'),
	coalesce(ie_medicamento,'S'),
	coalesce(ie_material,'R'),
	coalesce(ie_procedimento,'S'),
	coalesce(ie_coleta,'S'),
	coalesce(ie_ccg,'S'),
	coalesce(ie_cig,'S'),
	coalesce(ie_recomendacao,'S'),
	coalesce(ie_sae,'S'),
	coalesce(ie_ivc,'N'),
	coalesce(ie_oxigenio,'N'),
	coalesce(ie_hemoterapia,'N'),
	coalesce(ie_sup_nutricional,'N'),
	coalesce(ie_npt_adulta,'N'),
	coalesce(ie_npt_neonatal,'N'),
	coalesce(ie_dialise,'N'),
	coalesce(ie_leite_deriv,'N'),
	coalesce(ie_npt_pediatrica,'N')
from	adep_regra_inclusao
where	cd_estabelecimento				= cd_estabelecimento_p
and	coalesce(cd_setor_atendimento,cd_setor_atendimento_p)	= cd_setor_atendimento_p
and	coalesce(cd_perfil,cd_perfil_p)			= cd_perfil_p
order by
	coalesce(cd_setor_atendimento,99999) desc,
	coalesce(cd_perfil,99999) desc,
	nr_sequencia;


BEGIN
ie_regra_inclusao_w := obter_param_usuario(950, 143, cd_perfil_p, nm_usuario_p, cd_estabelecimento_p, ie_regra_inclusao_w);

if (ie_regra_inclusao_w = 'S') then

	open c01;
	loop
	fetch c01 into	ie_regra_incl_dieta_oral_w,
			ie_regra_incl_supl_oral_w,
			ie_regra_incl_solucao_w,
			ie_regra_incl_medicamento_w,
			ie_regra_incl_material_w,
			ie_regra_incl_procedimento_w,
			ie_regra_incl_coleta_w,
			ie_regra_incl_ccg_w,
			ie_regra_incl_cig_w,
			ie_regra_incl_recomendacao_w,
			ie_regra_incl_intervencao_w,
			ie_regra_incl_ivc_w,
			ie_regra_incl_gas_w,
			ie_regra_incl_hemoterapia_w,
			ie_regra_incl_sne_w,
			ie_regra_incl_npt_adulta_w,
			ie_regra_incl_npt_neonatal_w,
			ie_regra_incl_dialise_w,
			ie_regra_incl_leite_w,
			ie_regra_incl_npt_pedia_w;
	EXIT WHEN NOT FOUND; /* apply on c01 */
		begin
		ie_regra_incl_dieta_oral_w	:= ie_regra_incl_dieta_oral_w;
		ie_regra_incl_supl_oral_w	:= ie_regra_incl_supl_oral_w;
		ie_regra_incl_solucao_w		:= ie_regra_incl_solucao_w;
		ie_regra_incl_medicamento_w	:= ie_regra_incl_medicamento_w;
		ie_regra_incl_material_w	:= ie_regra_incl_material_w;
		ie_regra_incl_procedimento_w	:= ie_regra_incl_procedimento_w;
		ie_regra_incl_coleta_w		:= ie_regra_incl_coleta_w;
		ie_regra_incl_ccg_w		:= ie_regra_incl_ccg_w;
		ie_regra_incl_cig_w		:= ie_regra_incl_cig_w;
		ie_regra_incl_recomendacao_w	:= ie_regra_incl_recomendacao_w;
		ie_regra_incl_intervencao_w	:= ie_regra_incl_intervencao_w;
		ie_regra_incl_ivc_w		:= ie_regra_incl_ivc_w;
		ie_regra_incl_gas_w		:= ie_regra_incl_gas_w;
		ie_regra_incl_hemoterapia_w	:= ie_regra_incl_hemoterapia_w;
		ie_regra_incl_jejum_w		:= ie_regra_incl_dieta_oral_w;
		ie_regra_incl_sne_w		:= ie_regra_incl_sne_w;
		ie_regra_incl_npt_adulta_w	:= ie_regra_incl_npt_adulta_w;
		ie_regra_incl_npt_neonatal_w	:= ie_regra_incl_npt_neonatal_w;
		ie_regra_incl_dialise_w		:= ie_regra_incl_dialise_w;
		ie_regra_incl_leite_w		:= ie_regra_incl_leite_w;
		ie_regra_incl_npt_pedia_w	:= ie_regra_incl_npt_pedia_w;
		end;
	end loop;
	close c01;
else
	ie_regra_incl_dieta_oral_w	:= 'S';
	ie_regra_incl_supl_oral_w	:= 'S';
	ie_regra_incl_solucao_w		:= 'S';
	ie_regra_incl_medicamento_w	:= 'S';
	ie_regra_incl_material_w	:= 'S';
	ie_regra_incl_procedimento_w	:= 'S';
	ie_regra_incl_coleta_w		:= 'S';
	ie_regra_incl_ccg_w		:= 'S';
	ie_regra_incl_cig_w		:= 'S';
	ie_regra_incl_recomendacao_w	:= 'S';
	ie_regra_incl_intervencao_w	:= 'S';
	ie_regra_incl_ivc_w		:= 'S';
	ie_regra_incl_gas_w		:= 'S';
	ie_regra_incl_hemoterapia_w	:= 'S';
	ie_regra_incl_jejum_w		:= 'S';
	ie_regra_incl_sne_w		:= 'S';
	ie_regra_incl_npt_adulta_w	:= 'S';
	ie_regra_incl_npt_neonatal_w	:= 'S';
	ie_regra_incl_dialise_w		:= 'S';
	ie_regra_incl_leite_w		:= 'S';
	ie_regra_incl_npt_pedia_w	:= 'S';
end if;

/*Jejum*/

select	count(*)
into STRICT	cont_w
from	w_rep_t
where	ie_tipo_item = 'J';

if (cont_w = 0) and (ie_regra_incl_jejum_w <> 'N') then
	select	nextval('w_rep_t_seq')
	into STRICT	nr_seq_wrep_w
	;

	ie_copiar_w := plt_obter_se_item_marcado('J', nr_seq_regra_p);
	ds_cor_titulo_w := plt_obter_cor_titulo('J',nr_seq_regra_p);

	insert into w_rep_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item,
		ie_copiar,
		ds_cor_titulo)
	values (nr_seq_wrep_w,
		nm_usuario_p,
		'J',
		ie_copiar_w,
		ds_cor_titulo_w);
end if;

/*Suplemento*/

select	count(*)
into STRICT	cont_w
from	w_rep_t
where	ie_tipo_item = 'S';

if (cont_w = 0) and (ie_regra_incl_supl_oral_w <> 'N') then
	select	nextval('w_rep_t_seq')
	into STRICT	nr_seq_wrep_w
	;

	ie_copiar_w := plt_obter_se_item_marcado('S', nr_seq_regra_p);
	ds_cor_titulo_w := plt_obter_cor_titulo('S',nr_seq_regra_p);

	insert into w_rep_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item,
		ie_copiar,
		ds_cor_titulo)
	values (nr_seq_wrep_w,
		nm_usuario_p,
		'S',
		ie_copiar_w,
		ds_cor_titulo_w);
end if;

/*SNE*/

select	count(*)
into STRICT	cont_w
from	w_rep_t
where	ie_tipo_item = 'SNE';

if (cont_w = 0) and (ie_regra_incl_sne_w <> 'N') then
	select	nextval('w_rep_t_seq')
	into STRICT	nr_seq_wrep_w
	;

	ie_copiar_w := plt_obter_se_item_marcado('SNE', nr_seq_regra_p);
	ds_cor_titulo_w := plt_obter_cor_titulo('SNE',nr_seq_regra_p);

	insert into w_rep_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item,
		ie_copiar,
		ds_cor_titulo)
	values (nr_seq_wrep_w,
		nm_usuario_p,
		'SNE',
		ie_copiar_w,
		ds_cor_titulo_w);
end if;

/*Dieta*/

select	count(*)
into STRICT	cont_w
from	w_rep_t
where	ie_tipo_item = 'D';

if (cont_w = 0) and (ie_regra_incl_dieta_oral_w <> 'N') then
	select	nextval('w_rep_t_seq')
	into STRICT	nr_seq_wrep_w
	;

	ie_copiar_w := plt_obter_se_item_marcado('D', nr_seq_regra_p);
	ds_cor_titulo_w := plt_obter_cor_titulo('D',nr_seq_regra_p);

	insert into w_rep_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item,
		ie_copiar,
		ds_cor_titulo)
	values (nr_seq_wrep_w,
		nm_usuario_p,
		'D',
		ie_copiar_w,
		ds_cor_titulo_w);
end if;

/*NPT adulta*/

select	count(*)
into STRICT	cont_w
from	w_rep_t
where	ie_tipo_item = 'NAN';

if (cont_w = 0) and (ie_regra_incl_npt_adulta_w <> 'N') then
	select	nextval('w_rep_t_seq')
	into STRICT	nr_seq_wrep_w
	;

	ie_copiar_w := plt_obter_se_item_marcado('NAN', nr_seq_regra_p);
	ds_cor_titulo_w	:= plt_obter_cor_titulo('NAN',nr_seq_regra_p);

	insert into w_rep_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item,
		ie_copiar,
		ds_cor_titulo)
	values (nr_seq_wrep_w,
		nm_usuario_p,
		'NAN',
		ie_copiar_w,
		ds_cor_titulo_w);
end if;

/*NPT Pediatrica*/

select	count(*)
into STRICT	cont_w
from	w_rep_t
where	ie_tipo_item = 'NPP';

if (cont_w = 0) and (ie_regra_incl_npt_pedia_w <> 'N') then
	select	nextval('w_rep_t_seq')
	into STRICT	nr_seq_wrep_w
	;

	ie_copiar_w := plt_obter_se_item_marcado('NPP', nr_seq_regra_p);
	ds_cor_titulo_w := plt_obter_cor_titulo('NPP',nr_seq_regra_p);

	insert into w_rep_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item,
		ie_copiar,
		ds_cor_titulo)
	values (nr_seq_wrep_w,
		nm_usuario_p,
		'NPP',
		ie_copiar_w,
		ds_cor_titulo_w);
end if;

/*Soluções*/

select	count(*)
into STRICT	cont_w
from	w_rep_t
where	ie_tipo_item = 'SOL';

if (cont_w = 0) and (ie_regra_incl_solucao_w <> 'N') then
	select	nextval('w_rep_t_seq')
	into STRICT	nr_seq_wrep_w
	;

	ie_copiar_w := plt_obter_se_item_marcado('SOL', nr_seq_regra_p);
	ds_cor_titulo_w := plt_obter_cor_titulo('SOL',nr_seq_regra_p);

	insert into w_rep_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item,
		ie_copiar,
		ds_cor_titulo)
	values (nr_seq_wrep_w,
		nm_usuario_p,
		'SOL',
		ie_copiar_w,
		ds_cor_titulo_w);
end if;

/*Medicamentos*/

select	count(*)
into STRICT	cont_w
from	w_rep_t
where	ie_tipo_item = 'M';

if (cont_w = 0) and (ie_regra_incl_medicamento_w <> 'N') then
	select	nextval('w_rep_t_seq')
	into STRICT	nr_seq_wrep_w
	;

	ie_copiar_w := plt_obter_se_item_marcado('M', nr_seq_regra_p);
	ds_cor_titulo_w := plt_obter_cor_titulo('M',nr_seq_regra_p);

	insert into w_rep_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item,
		ie_copiar,
		ds_cor_titulo)
	values (nr_seq_wrep_w,
		nm_usuario_p,
		'M',
		ie_copiar_w,
		ds_cor_titulo_w);
end if;

/*Controle de glicemia*/

select	count(*)
into STRICT	cont_w
from	w_rep_t
where	ie_tipo_item = 'G';

if (cont_w = 0) and
	((ie_regra_incl_ccg_w <> 'N') or (ie_regra_incl_cig_w <> 'N')) then
	select	nextval('w_rep_t_seq')
	into STRICT	nr_seq_wrep_w
	;

	ie_copiar_w := plt_obter_se_item_marcado('G', nr_seq_regra_p);
	ds_cor_titulo_w := plt_obter_cor_titulo('G',nr_seq_regra_p);

	insert into w_rep_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item,
		ie_copiar,
		ds_cor_titulo)
	values (nr_seq_wrep_w,
		nm_usuario_p,
		'G',
		ie_copiar_w,
		ds_cor_titulo_w);
end if;

/*Hemoterapias*/

select	count(*)
into STRICT	cont_w
from	w_rep_t
where	ie_tipo_item = 'HM';

if (cont_w = 0) and (ie_regra_incl_hemoterapia_w <> 'N') then
	select	nextval('w_rep_t_seq')
	into STRICT	nr_seq_wrep_w
	;

	ie_copiar_w := plt_obter_se_item_marcado('HM', nr_seq_regra_p);
	ds_cor_titulo_w := plt_obter_cor_titulo('HM',nr_seq_regra_p);

	insert into w_rep_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item,
		ie_copiar,
		ds_cor_titulo)
	values (nr_seq_wrep_w,
		nm_usuario_p,
		'HM',
		ie_copiar_w,
		ds_cor_titulo_w);
end if;

/*Recomendações*/

select	count(*)
into STRICT	cont_w
from	w_rep_t
where	ie_tipo_item = 'R';

if (cont_w = 0) and (ie_regra_incl_recomendacao_w <> 'N') then
	select	nextval('w_rep_t_seq')
	into STRICT	nr_seq_wrep_w
	;

	ie_copiar_w := plt_obter_se_item_marcado('R', nr_seq_regra_p);
	ds_cor_titulo_w := plt_obter_cor_titulo('R',nr_seq_regra_p);

	insert into w_rep_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item,
		ie_copiar,
		ds_cor_titulo)
	values (nr_seq_wrep_w,
		nm_usuario_p,
		'R',
		ie_copiar_w,
		ds_cor_titulo_w);
end if;

/*Procedimentos*/

select	count(*)
into STRICT	cont_w
from	w_rep_t
where	ie_tipo_item = 'P'
and 	ie_classif_adep <> 'SADT';

if (cont_w = 0) and (ie_regra_incl_procedimento_w <> 'N') then
	select	nextval('w_rep_t_seq')
	into STRICT	nr_seq_wrep_w
	;

	ie_copiar_w := plt_obter_se_item_marcado('P', nr_seq_regra_p);
	ds_cor_titulo_w := plt_obter_cor_titulo('P',nr_seq_regra_p);

	insert into w_rep_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item,
		ie_classif_adep,
		ie_copiar,
		ds_cor_titulo)
	values (nr_seq_wrep_w,
		nm_usuario_p,
		'P',
		'P',
		ie_copiar_w,
		ds_cor_titulo_w);
end if;

/*Gasoterapia*/

select	count(*)
into STRICT	cont_w
from	w_rep_t
where	ie_tipo_item = 'O';

if (cont_w = 0) and (ie_regra_incl_gas_w <> 'N') then
	select	nextval('w_rep_t_seq')
	into STRICT	nr_seq_wrep_w
	;

	ie_copiar_w := plt_obter_se_item_marcado('O', nr_seq_regra_p);
	ds_cor_titulo_w := plt_obter_cor_titulo('O',nr_seq_regra_p);

	insert into w_rep_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item,
		ie_copiar,
		ds_cor_titulo)
	values (nr_seq_wrep_w,
		nm_usuario_p,
		'O',
		ie_copiar_w,
		ds_cor_titulo_w);
end if;

/*Coletas*/

select	count(*)
into STRICT	cont_w
from	w_rep_t
where	ie_tipo_item = 'L';

if (cont_w = 0) and (ie_regra_incl_coleta_w <> 'N') then
	select	nextval('w_rep_t_seq')
	into STRICT	nr_seq_wrep_w
	;

	ie_copiar_w := plt_obter_se_item_marcado('L', nr_seq_regra_p);
	ds_cor_titulo_w := plt_obter_cor_titulo('L',nr_seq_regra_p);

	insert into w_rep_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item,
		ie_copiar,
		ds_cor_titulo)
	values (nr_seq_wrep_w,
		nm_usuario_p,
		'L',
		ie_copiar_w,
		ds_cor_titulo_w);
end if;

/*IVC*/

select	count(*)
into STRICT	cont_w
from	w_rep_t
where	ie_tipo_item = 'I';

if (cont_w = 0) and (ie_regra_incl_ivc_w <> 'N') then
	select	nextval('w_rep_t_seq')
	into STRICT	nr_seq_wrep_w
	;

	ie_copiar_w := plt_obter_se_item_marcado('I', nr_seq_regra_p);
	ds_cor_titulo_w := plt_obter_cor_titulo('I',nr_seq_regra_p);

	insert into w_rep_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item,
		ie_copiar,
		ds_cor_titulo)
	values (nr_seq_wrep_w,
		nm_usuario_p,
		'I',
		ie_copiar_w,
		ds_cor_titulo_w);
end if;

/*NPT Neonatal*/

select	count(*)
into STRICT	cont_w
from	w_rep_t
where	ie_tipo_item = 'NPN';

if (cont_w = 0) and (ie_regra_incl_npt_neonatal_w <> 'N') then
	select	nextval('w_rep_t_seq')
	into STRICT	nr_seq_wrep_w
	;

	ie_copiar_w := plt_obter_se_item_marcado('NPN', nr_seq_regra_p);
	ds_cor_titulo_w := plt_obter_cor_titulo('NPN',nr_seq_regra_p);

	insert into w_rep_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item,
		ie_copiar,
		ds_cor_titulo)
	values (nr_seq_wrep_w,
		nm_usuario_p,
		'NPN',
		ie_copiar_w,
		ds_cor_titulo_w);
end if;

/*Leites e Derivados*/

select	count(*)
into STRICT	cont_w
from	w_rep_t
where	ie_tipo_item = 'LD';

if (cont_w = 0) and (ie_regra_incl_leite_w <> 'N') then
	select	nextval('w_rep_t_seq')
	into STRICT	nr_seq_wrep_w
	;

	ie_copiar_w := plt_obter_se_item_marcado('LD', nr_seq_regra_p);
	ds_cor_titulo_w := plt_obter_cor_titulo('LD',nr_seq_regra_p);

	insert into w_rep_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item,
		ie_copiar,
		ds_cor_titulo)
	values (nr_seq_wrep_w,
		nm_usuario_p,
		'LD',
		ie_copiar_w,
		ds_cor_titulo_w);
end if;

/*Diálise*/

select	count(*)
into STRICT	cont_w
from	w_rep_t
where	ie_tipo_item = 'DI';

if (cont_w = 0) and (ie_regra_incl_dialise_w <> 'N') then
	select	nextval('w_rep_t_seq')
	into STRICT	nr_seq_wrep_w
	;

	ie_copiar_w := plt_obter_se_item_marcado('DI', nr_seq_regra_p);
	ds_cor_titulo_w := plt_obter_cor_titulo('DI',nr_seq_regra_p);

	insert into w_rep_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item,
		ie_copiar,
		ds_cor_titulo)
	values (nr_seq_wrep_w,
		nm_usuario_p,
		'DI',
		ie_copiar_w,
		ds_cor_titulo_w);
end if;

/*Materiais*/

select	count(*)
into STRICT	cont_w
from	w_rep_t
where	ie_tipo_item = 'MAT';

if (cont_w = 0) and (ie_regra_incl_material_w <> 'N') then
	select	nextval('w_rep_t_seq')
	into STRICT	nr_seq_wrep_w
	;

	ie_copiar_w := plt_obter_se_item_marcado('MAT', nr_seq_regra_p);
	ds_cor_titulo_w := plt_obter_cor_titulo('MAT',nr_seq_regra_p);

	insert into w_rep_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item,
		ie_copiar,
		ds_cor_titulo)
	values (nr_seq_wrep_w,
		nm_usuario_p,
		'MAT',
		ie_copiar_w,
		ds_cor_titulo_w);
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE plt_gerar_titulos ( nm_usuario_p text, cd_estabelecimento_p bigint, cd_setor_atendimento_p bigint, cd_perfil_p bigint, nr_seq_regra_p bigint) FROM PUBLIC;

