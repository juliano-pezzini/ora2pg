-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_viagem (nr_sequencia_p bigint, cd_pessoa_fisica_p text, dt_saida_prev_p timestamp, dt_retorno_prev_p timestamp, nm_usuario_p text) AS $body$
DECLARE


nr_seq_viagem_w		bigint;


BEGIN

select 	nextval('via_viagem_seq')
into STRICT	nr_seq_viagem_w
;

/* Viagem */

insert into via_viagem(
	NR_SEQUENCIA,
	CD_ESTABELECIMENTO,
	DT_ATUALIZACAO,
	NM_USUARIO,
	DT_ATUALIZACAO_NREC,
	NM_USUARIO_NREC,
	CD_PESSOA_FISICA,
	DT_SAIDA_PREV,
	DT_RETORNO_PREV,
	DT_SAIDA_REAL,
	DT_RETORNO_REAL,
	DT_AUTORIZACAO,
	NM_USUARIO_AUTOR,
	IE_ETAPA_VIAGEM,
	DT_CONFIRMACAO,
	NM_USUARIO_CONFIR)
SELECT 	nr_seq_viagem_w,
	CD_ESTABELECIMENTO,
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	cd_pessoa_fisica_p,
	DT_SAIDA_PREV_p,
	DT_RETORNO_PREV_p,
	DT_SAIDA_REAL,
	DT_RETORNO_REAL,
	null,
	null,
	'0',
	null,
	null
from	via_viagem
where 	nr_sequencia = nr_sequencia_p;

/* Transporte (Itiner√°rio) */

insert	into  via_transporte(
	NR_SEQUENCIA,
	NR_SEQ_VIAGEM,
	DT_ATUALIZACAO,
	NM_USUARIO,
	DT_ATUALIZACAO_NREC,
	NM_USUARIO_NREC,
	NR_SEQ_MEIO_TRANSP,
	NR_SEQ_VEICULO,
	CD_CNPJ,
	NR_SEQ_LOC_ORIGEM,
	NR_SEQ_LOC_DESTINO,
	DT_CHEGADA,
	DT_SAIDA_PREV,
	DT_CHEGADA_PREV,
	DT_SAIDA,
	QT_DIAS_HOSPEDAGEM,
	NR_SEQ_TIPO_COBRANCA,
	NR_SEQ_HOTEL,
	VL_PREVISTO,
	VL_PREVISTO_HOTEL,
	NR_VOO)
SELECT 	nextval('via_transporte_seq'),
	nr_seq_viagem_w,
	clock_timestamp(),
	NM_USUARIO_p,
	clock_timestamp(),
	NM_USUARIO_p,
	NR_SEQ_MEIO_TRANSP,
	NR_SEQ_VEICULO,
	CD_CNPJ,
	NR_SEQ_LOC_ORIGEM,
	NR_SEQ_LOC_DESTINO,
	DT_CHEGADA,
	DT_SAIDA_PREV_p,
	Null,
	DT_SAIDA,
	QT_DIAS_HOSPEDAGEM,
	NR_SEQ_TIPO_COBRANCA,
	NR_SEQ_HOTEL,
	VL_PREVISTO,
	VL_PREVISTO_HOTEL,
	NR_VOO
from	via_transporte
where	nr_seq_viagem = nr_sequencia_p;


/*  Pessoas Adicionais */

insert into via_pf_adic(
	NR_SEQUENCIA,
	NR_SEQ_VIAGEM,
	DT_ATUALIZACAO,
	NM_USUARIO,
	DT_ATUALIZACAO_NREC,
	NM_USUARIO_NREC,
	CD_PESSOA_FISICA)
SELECT 	nextval('via_pf_adic_seq'),
	nr_seq_viagem_w,
	clock_timestamp(),
	NM_USUARIO_P,
	clock_timestamp(),
	NM_USUARIO_P,
	CD_PESSOA_FISICA
from 	via_pf_adic
where 	nr_seq_viagem = nr_sequencia_p;


/*  Destinos */

insert into via_destino(
	NR_SEQUENCIA,
	NR_SEQ_VIAGEM,
	DT_ATUALIZACAO,
	NM_USUARIO,
	DT_ATUALIZACAO_NREC,
	NM_USUARIO_NREC,
	CD_CNPJ,
	DS_DESTINO,
	NR_SEQ_PROJ)
SELECT 	nextval('via_destino_seq'),
	NR_seq_viagem_w,
	clock_timestamp(),
	NM_USUARIO_P,
	clock_timestamp(),
	NM_USUARIO_P,
	CD_CNPJ,
	DS_DESTINO,
	nr_seq_proj
from 	via_destino
where 	nr_seq_viagem = nr_sequencia_p;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_viagem (nr_sequencia_p bigint, cd_pessoa_fisica_p text, dt_saida_prev_p timestamp, dt_retorno_prev_p timestamp, nm_usuario_p text) FROM PUBLIC;

