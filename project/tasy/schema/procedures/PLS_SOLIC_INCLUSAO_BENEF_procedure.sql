-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_solic_inclusao_benef ( nm_pessoa_fisica_p text, nm_abreviado_p text, dt_nascimento_p text, ie_estado_civil_p text, nr_cpf_p text, nr_identidade_p text, dt_emissao_ci_p text, ds_orgao_emissor_ci_p pessoa_fisica.ds_orgao_emissor_ci%type, sg_emissora_ci_p text, nr_seq_pais_p bigint, nr_reg_geral_estrang_p text, nr_telefone_celular_p text, cd_nacionalidade_p text, ie_sexo_p text, cd_cep_p text, ds_endereco_p text, nr_endereco_p text, ds_complemento_p text, ds_bairro_p text, sg_estado_p text, nr_ddi_telefone_p text, nr_ddd_telefone_p text, nr_telefone_p text, ds_email_p text, cd_municipio_ibge_p text, nr_seq_contrato_p bigint, nm_mae_p text, nr_seq_titular_contrato_p bigint, nr_seq_canal_venda_p bigint, dt_admissao_p text, cd_cbo_p text, nr_seq_vinculo_estip_p bigint, cd_matricula_est_p text, nr_seq_parentesco_p bigint, dt_adocao_p text, nr_ctps_p pls_inclusao_beneficiario.nr_ctps%type, nr_serie_ctps_p pls_inclusao_beneficiario.nr_serie_ctps%type, uf_emissora_ctps_p text, nr_seq_plano_p bigint, nr_seq_subestipulante_p bigint, dt_contratacao_p text, nr_seq_congenere_p text, ie_tipo_repasse_p text, ie_gerar_homonimos_p text, ie_consiste_sib_p text, ie_consiste_endereco_p text, cd_estabelecimento_p bigint, nm_usuario_p text, nm_titular_inclusao_p text, nr_seq_titular_solic_p bigint, nr_cartao_nac_sus_p text, cd_declaracao_nasc_vivo_p bigint, nr_pis_pasep_p text, cd_carteira_ant_p text, nr_contrato_sistema_ant_p bigint, dt_casamento_p text, nr_cert_casamento_p text, nr_seq_contrato_int_p bigint, nr_seq_inclusao_p INOUT bigint, nr_ddi_celular_p text, nr_ddd_celular_p text, nr_titulo_eleitor_p text, cd_tipo_logradouro_p text, nm_pai_p text, ds_municipio_nasc_p text, sg_estado_nasc_p text, ds_municipio_nasc_estrang_p pls_inclusao_beneficiario.ds_municipio_nasc_estrangeiro%type, ds_observacao_p pls_inclusao_beneficiario.ds_observacao%type, ie_forma_liberacao_p text, nr_nivel_faixa_salarial_p pls_inclusao_beneficiario.nr_nivel_faixa_salarial%type, nr_seq_localizacao_benef_p pls_inclusao_beneficiario.nr_seq_localizacao_benef%type, nr_seq_tabela_p pls_inclusao_beneficiario.nr_seq_tabela%type, nr_seq_operadora_ant_p pls_inclusao_beneficiario.nr_seq_operadora_ant%type, nr_seq_proposta_web_p pls_inclusao_beneficiario.nr_seq_proposta_web%type, nr_seq_motivo_inclusao_p pls_inclusao_beneficiario.nr_seq_motivo_inclusao%type, nr_seq_solic_ant_p pls_inclusao_beneficiario.nr_seq_solic_ant%type, nm_social_p pessoa_fisica.nm_social%type, nr_protocolo_portabilidade_p pls_inclusao_beneficiario.nr_protocolo_portabilidade%type, dt_inclusao_ops_origem_p pls_inclusao_beneficiario.dt_inclusao_ops_origem%type, vl_preco_plano_origem_p pls_inclusao_beneficiario.vl_preco_plano_origem%type, dt_emissao_prot_portab_p pls_inclusao_beneficiario.dt_emissao_prot_portab%type, nr_registro_ops_ans_p pls_inclusao_beneficiario.nr_registro_ops_ans%type, ie_abrangencia_plano_origem_p pls_inclusao_beneficiario.ie_abrangencia_plano_origem%type, nr_registro_plano_origem_p pls_inclusao_beneficiario.nr_registro_plano_origem%type, ie_tp_contr_plano_origem_p pls_inclusao_beneficiario.ie_tp_contratacao_plano_origem%type, dt_inclusao_operadora_p pls_inclusao_beneficiario.dt_inclusao_operadora%type) AS $body$
DECLARE


qt_homonimos_w			bigint;
nr_seq_inclusao_w		bigint;
nr_seq_vendedor_pf_w		bigint;
ds_municipio_w			varchar(255);
nr_seq_canal_venda_w		bigint;
ie_status_w			varchar(2) := 'P';
ie_status_intercambio_w		varchar(2) := 'P';
ie_etapa_solic_intercambio_w	varchar(2) := 'AG';
nr_seq_faixa_salarial_w		pls_faixa_salarial.nr_sequencia%type;
dt_adocao_w			timestamp;
cd_municipio_ibge_nasc_w	sus_municipio.cd_municipio_ibge%type;


BEGIN

if (nr_seq_contrato_p IS NOT NULL AND nr_seq_contrato_p::text <> '') then
	if (coalesce(pls_obter_dados_contrato(nr_seq_contrato_p, 'AR'),'A') in ('A','P')) then
		nr_seq_canal_venda_w := pls_obter_regra_lancamento(nr_seq_contrato_p,dt_contratacao_p,'CV');
		if (coalesce(nr_seq_canal_venda_w::text, '') = '' or nr_seq_canal_venda_w = 0) then
			nr_seq_canal_venda_w	:= nr_seq_canal_venda_p;
			nr_seq_vendedor_pf_w	:= pls_obter_padrao_vend_canal(nr_seq_canal_venda_p);
		else
			nr_seq_vendedor_pf_w	:= coalesce(pls_obter_regra_lancamento(nr_seq_contrato_p,dt_contratacao_p,'V'),pls_obter_padrao_vend_canal(nr_seq_canal_venda_w));
		end if;
	end if;
	
	ie_status_intercambio_w := null;
	ie_etapa_solic_intercambio_w := null;
else
	ie_status_w := null;
end if;

if (cd_municipio_ibge_p IS NOT NULL AND cd_municipio_ibge_p::text <> '') then
	ds_municipio_w	:= obter_desc_municipio_ibge(cd_municipio_ibge_p);
end if;

if (nr_nivel_faixa_salarial_p IS NOT NULL AND nr_nivel_faixa_salarial_p::text <> '') then
	select	max(nr_sequencia)
	into STRICT	nr_seq_faixa_salarial_w
	from	pls_faixa_salarial
	where	nr_nivel = nr_nivel_faixa_salarial_p;
end if;

select	nextval('pls_inclusao_beneficiario_seq')
into STRICT	nr_seq_inclusao_w
;

if (dt_adocao_p <> '' and (dt_adocao_p IS NOT NULL AND dt_adocao_p::text <> '')) then
	dt_adocao_w := dt_adocao_p;
end if;	

if (ds_municipio_nasc_p IS NOT NULL AND ds_municipio_nasc_p::text <> '') then
	select	max(cd_municipio_ibge)
	into STRICT	cd_municipio_ibge_nasc_w
	from	sus_municipio
	where	upper(ds_municipio) = trim(both upper(ds_municipio_nasc_p))
	and	upper(ds_unidade_federacao) = trim(both upper(sg_estado_nasc_p));
else
	cd_municipio_ibge_nasc_w	:= null;
end if;

insert	into pls_inclusao_beneficiario(nr_sequencia, nm_pessoa_fisica, cd_estabelecimento,
					ie_status, dt_solicitacao, nr_seq_contrato,
					dt_nascimento, cd_nacionalidade, nm_mae,
					cd_pessoa_fisica, nr_cpf, nr_seq_congenere,
					ie_estado_civil, ie_sexo, ds_email,
					nr_identidade, dt_emissao_ci, sg_emissora_ci,
					nr_seq_pais, ds_orgao_emissor_ci, nr_reg_geral_estrang,
					cd_cep, ds_endereco, nr_endereco,
					ds_complemento, ds_bairro, cd_municipio_ibge,
					sg_estado, nr_ddd_telefone, nr_ddi_telefone,
					nr_telefone, nr_telefone_celular, nr_seq_motivo_rejeicao,
					nr_seq_vendedor_canal, nr_seq_vendedor_pf, nr_seq_titular_contrato,
					nr_seq_proposta, dt_admissao, cd_cbo,
					cd_matricula_est, nr_seq_vinculo_estip, nr_seq_parentesco, dt_adocao,
					nr_ctps, nr_serie_ctps, uf_emissora_ctps,
					nr_seq_plano, nr_seq_subestipulante, nr_seq_proposta_benef,
					ie_processo, nr_seq_lote_inclusao, nr_seq_titular_prop,
					dt_contratacao, ie_etapa_solicitacao, ie_tipo_inclusao,
					nm_titular_inclusao, ds_plano_carteira, dt_validade_carteira,
					nm_empresa, nm_abreviado, ie_tipo_repasse,
					ie_pcmso, ie_custo_oper_intercambio, ie_abrangencia,
					nr_seq_tipo_acomodacao, cd_operadora_empresa, ie_abrangencia_intercambio,
					dt_atualizacao, nm_usuario, dt_atualizacao_nrec,
					nm_usuario_nrec, nr_seq_titular_solic, nr_cartao_nac_sus,
					cd_declaracao_nasc_vivo, nr_pis_pasep, cd_carteira_ant,
					nm_usuario_inclusao, nr_contrato_sistema_ant, ds_municipio,
					nr_seq_intercambio, ie_status_intercambio, ie_etapa_solic_intercambio,
					dt_emissao_cert_casamento, nr_cert_casamento, nr_ddi_celular,
					nr_ddd_celular,nr_titulo_eleitor, cd_tipo_logradouro,
					nm_pai,ds_municipio_nasc,sg_estado_nasc, nr_nivel_faixa_salarial,
					nr_seq_localizacao_benef, nr_seq_tabela, nr_seq_operadora_ant,
					nr_seq_faixa_salarial, ds_municipio_nasc_estrangeiro,ds_observacao,
					nr_seq_motivo_inclusao, cd_municipio_ibge_nasc,nr_seq_proposta_web,
					nr_seq_solic_ant, nm_social, nr_protocolo_portabilidade,
					dt_inclusao_ops_origem, vl_preco_plano_origem, dt_emissao_prot_portab,
					nr_registro_ops_ans, ie_abrangencia_plano_origem, nr_registro_plano_origem, 
					ie_tp_contratacao_plano_origem, dt_inclusao_operadora)
			values (	nr_seq_inclusao_w, nm_pessoa_fisica_p, cd_estabelecimento_p,
					ie_status_w, clock_timestamp(), nr_seq_contrato_p,
					to_date(dt_nascimento_p,'dd/mm/yyyy'), cd_nacionalidade_p, nm_mae_p,
					null, nr_cpf_p, nr_seq_congenere_p,
					ie_estado_civil_p, ie_sexo_p, ds_email_p,
					nr_identidade_p, to_date(dt_emissao_ci_p,'dd/mm/yyyy'), sg_emissora_ci_p,
					nr_seq_pais_p, ds_orgao_emissor_ci_p, nr_reg_geral_estrang_p,
					cd_cep_p, ds_endereco_p, nr_endereco_p,
					ds_complemento_p, ds_bairro_p, cd_municipio_ibge_p,
					sg_estado_p, nr_ddd_telefone_p, nr_ddi_telefone_p,
					nr_telefone_p, nr_telefone_celular_p, null,
					nr_seq_canal_venda_w, nr_seq_vendedor_pf_w, nr_seq_titular_contrato_p,
					null, to_date(dt_admissao_p,'dd/mm/yyyy'), cd_cbo_p,
					cd_matricula_est_p, nr_seq_vinculo_estip_p, nr_seq_parentesco_p, dt_adocao_w,
					nr_ctps_p, nr_serie_ctps_p, uf_emissora_ctps_p,
					nr_seq_plano_p, nr_seq_subestipulante_p, null,
					'W', null, null,
					to_date(dt_contratacao_p,'dd/mm/yyyy'), null,'P',
					nm_titular_inclusao_p, null, null,
					null, nm_abreviado_p, ie_tipo_repasse_p,
					null, null, null,
					null, null, null,
					clock_timestamp(), nm_usuario_p, clock_timestamp(),
					nm_usuario_p, nr_seq_titular_solic_p, nr_cartao_nac_sus_p,
					cd_declaracao_nasc_vivo_p, nr_pis_pasep_p, cd_carteira_ant_p,
					nm_usuario_p, nr_contrato_sistema_ant_p, ds_municipio_w,
					nr_seq_contrato_int_p, ie_status_intercambio_w, ie_etapa_solic_intercambio_w,
					to_date(dt_casamento_p,'dd/mm/yyyy'), nr_cert_casamento_p, nr_ddi_celular_p,
					nr_ddd_celular_p,nr_titulo_eleitor_p, cd_tipo_logradouro_p, nm_pai_p,
					ds_municipio_nasc_p, sg_estado_nasc_p, nr_nivel_faixa_salarial_p,
					nr_seq_localizacao_benef_p, nr_seq_tabela_p, nr_seq_operadora_ant_p,
					nr_seq_faixa_salarial_w, ds_municipio_nasc_estrang_p,ds_observacao_p,
					nr_seq_motivo_inclusao_p, cd_municipio_ibge_nasc_w,nr_seq_proposta_web_p,
					nr_seq_solic_ant_p, nm_social_p, nr_protocolo_portabilidade_p,
					dt_inclusao_ops_origem_p, vl_preco_plano_origem_p, dt_emissao_prot_portab_p,
					nr_registro_ops_ans_p, ie_abrangencia_plano_origem_p, nr_registro_plano_origem_p,
					ie_tp_contr_plano_origem_p, dt_inclusao_operadora_p);

if (nr_seq_contrato_p IS NOT NULL AND nr_seq_contrato_p::text <> '') then
	if (ie_gerar_homonimos_p	= 'S') then
		pls_gerar_homonimo_pf(nm_pessoa_fisica_p, dt_nascimento_p, nr_cpf_p,
							  nr_seq_inclusao_w, nm_usuario_p);
	end if;
end if;

nr_seq_inclusao_p := nr_seq_inclusao_w;

if (nr_seq_inclusao_w IS NOT NULL AND nr_seq_inclusao_w::text <> '') then
	CALL pls_gerar_ci_solic_portal_web(	2, null, nr_seq_inclusao_w,
					null, null, null,
					nm_usuario_p);
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_solic_inclusao_benef ( nm_pessoa_fisica_p text, nm_abreviado_p text, dt_nascimento_p text, ie_estado_civil_p text, nr_cpf_p text, nr_identidade_p text, dt_emissao_ci_p text, ds_orgao_emissor_ci_p pessoa_fisica.ds_orgao_emissor_ci%type, sg_emissora_ci_p text, nr_seq_pais_p bigint, nr_reg_geral_estrang_p text, nr_telefone_celular_p text, cd_nacionalidade_p text, ie_sexo_p text, cd_cep_p text, ds_endereco_p text, nr_endereco_p text, ds_complemento_p text, ds_bairro_p text, sg_estado_p text, nr_ddi_telefone_p text, nr_ddd_telefone_p text, nr_telefone_p text, ds_email_p text, cd_municipio_ibge_p text, nr_seq_contrato_p bigint, nm_mae_p text, nr_seq_titular_contrato_p bigint, nr_seq_canal_venda_p bigint, dt_admissao_p text, cd_cbo_p text, nr_seq_vinculo_estip_p bigint, cd_matricula_est_p text, nr_seq_parentesco_p bigint, dt_adocao_p text, nr_ctps_p pls_inclusao_beneficiario.nr_ctps%type, nr_serie_ctps_p pls_inclusao_beneficiario.nr_serie_ctps%type, uf_emissora_ctps_p text, nr_seq_plano_p bigint, nr_seq_subestipulante_p bigint, dt_contratacao_p text, nr_seq_congenere_p text, ie_tipo_repasse_p text, ie_gerar_homonimos_p text, ie_consiste_sib_p text, ie_consiste_endereco_p text, cd_estabelecimento_p bigint, nm_usuario_p text, nm_titular_inclusao_p text, nr_seq_titular_solic_p bigint, nr_cartao_nac_sus_p text, cd_declaracao_nasc_vivo_p bigint, nr_pis_pasep_p text, cd_carteira_ant_p text, nr_contrato_sistema_ant_p bigint, dt_casamento_p text, nr_cert_casamento_p text, nr_seq_contrato_int_p bigint, nr_seq_inclusao_p INOUT bigint, nr_ddi_celular_p text, nr_ddd_celular_p text, nr_titulo_eleitor_p text, cd_tipo_logradouro_p text, nm_pai_p text, ds_municipio_nasc_p text, sg_estado_nasc_p text, ds_municipio_nasc_estrang_p pls_inclusao_beneficiario.ds_municipio_nasc_estrangeiro%type, ds_observacao_p pls_inclusao_beneficiario.ds_observacao%type, ie_forma_liberacao_p text, nr_nivel_faixa_salarial_p pls_inclusao_beneficiario.nr_nivel_faixa_salarial%type, nr_seq_localizacao_benef_p pls_inclusao_beneficiario.nr_seq_localizacao_benef%type, nr_seq_tabela_p pls_inclusao_beneficiario.nr_seq_tabela%type, nr_seq_operadora_ant_p pls_inclusao_beneficiario.nr_seq_operadora_ant%type, nr_seq_proposta_web_p pls_inclusao_beneficiario.nr_seq_proposta_web%type, nr_seq_motivo_inclusao_p pls_inclusao_beneficiario.nr_seq_motivo_inclusao%type, nr_seq_solic_ant_p pls_inclusao_beneficiario.nr_seq_solic_ant%type, nm_social_p pessoa_fisica.nm_social%type, nr_protocolo_portabilidade_p pls_inclusao_beneficiario.nr_protocolo_portabilidade%type, dt_inclusao_ops_origem_p pls_inclusao_beneficiario.dt_inclusao_ops_origem%type, vl_preco_plano_origem_p pls_inclusao_beneficiario.vl_preco_plano_origem%type, dt_emissao_prot_portab_p pls_inclusao_beneficiario.dt_emissao_prot_portab%type, nr_registro_ops_ans_p pls_inclusao_beneficiario.nr_registro_ops_ans%type, ie_abrangencia_plano_origem_p pls_inclusao_beneficiario.ie_abrangencia_plano_origem%type, nr_registro_plano_origem_p pls_inclusao_beneficiario.nr_registro_plano_origem%type, ie_tp_contr_plano_origem_p pls_inclusao_beneficiario.ie_tp_contratacao_plano_origem%type, dt_inclusao_operadora_p pls_inclusao_beneficiario.dt_inclusao_operadora%type) FROM PUBLIC;

