-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gerar_guia_lote_canc_web ( ie_tipo_guia_imp_p text, cd_cgc_prestador_imp_p text, nr_protocolo_imp_p text, cd_guia_prestador_imp_p text, cd_prestador_imp_p text, cd_cpf_prestador_imp_p text, nm_contratado_imp_p text, nm_usuario_p text, nr_lote_cta_p pls_guia_plano_lote_cancel.nr_lote_imp%type default null, ie_tipo_lote_canc_p pls_guia_plano_lote_cancel.ie_tipo_lote_cancelamento%type default null, nr_seq_lote_p INOUT bigint DEFAULT NULL) AS $body$
DECLARE

			
nr_seq_lote_cancel_w	bigint;
nr_seq_prestador_w	bigint;


BEGIN

select	nextval('pls_guia_plano_lote_cancel_seq')
into STRICT	nr_seq_lote_cancel_w
;


/*begin
	select	nr_sequencia
	into	nr_seq_prestador_w
	from	pls_prestador
	where	nr_Sequencia = to_number(cd_prestador_imp_p);
exception
when others then
	select	max(nr_sequencia)
	into	nr_seq_prestador_w
	from	pls_prestador
	where	cd_prestador = cd_prestador_imp_p
	and    ((cd_cgc is not null 
	and    cd_cgc = nvl(cd_cgc_prestador_imp_p,cd_cgc))
	or     (cd_pessoa_fisica is not null
	and	obter_dados_pf(cd_pessoa_fisica, 'CPF') = nvl(cd_cpf_prestador_imp_p,obter_dados_pf(cd_pessoa_fisica, 'CPF'))));
end;
*/
/* Function utilizada para obter a sequencia do prestador na base  */

nr_seq_prestador_w := pls_obter_prestador_imp(cd_cgc_prestador_imp_p, cd_cpf_prestador_imp_p, cd_prestador_imp_p, '', '', '', 'G', null);

insert into pls_guia_plano_lote_cancel( nr_sequencia, dt_atualizacao, nm_usuario,
					dt_atualizacao_nrec, nm_usuario_nrec, ie_tipo_guia_imp,
					nr_protocolo_imp, cd_prestador_imp, cd_cgc_prestador_imp,
					cd_cpf_prestador_imp, dt_geracao_lote, nr_seq_prestador,
					nr_lote_imp, ie_tipo_lote_cancelamento)
				values ( nr_seq_lote_cancel_w, clock_timestamp(), nm_usuario_p,
					clock_timestamp(), nm_usuario_p, ie_tipo_guia_imp_p,
					nr_protocolo_imp_p, cd_prestador_imp_p, cd_cgc_prestador_imp_p,
					cd_cpf_prestador_imp_p, clock_timestamp(), nr_seq_prestador_w,
					nr_lote_cta_p, ie_tipo_lote_canc_p);

nr_seq_lote_p := nr_seq_lote_cancel_w;
	
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_guia_lote_canc_web ( ie_tipo_guia_imp_p text, cd_cgc_prestador_imp_p text, nr_protocolo_imp_p text, cd_guia_prestador_imp_p text, cd_prestador_imp_p text, cd_cpf_prestador_imp_p text, nm_contratado_imp_p text, nm_usuario_p text, nr_lote_cta_p pls_guia_plano_lote_cancel.nr_lote_imp%type default null, ie_tipo_lote_canc_p pls_guia_plano_lote_cancel.ie_tipo_lote_cancelamento%type default null, nr_seq_lote_p INOUT bigint DEFAULT NULL) FROM PUBLIC;

