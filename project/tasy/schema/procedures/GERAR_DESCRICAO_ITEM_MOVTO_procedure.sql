-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_descricao_item_movto (nr_seq_retorno_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
cd_item_w		bigint;
ds_item_w		varchar(240);
nr_seq_movto_w	bigint;		
 
 
C01 CURSOR FOR 
	SELECT cd_item, 
		substr(obter_desc_item_conta(coalesce(nr_conta, (substr(obter_dados_ret_convenio(nr_seq_ret_item,1),1,10))::numeric ), cd_item),1,240) DS_ITEM, 
		nr_sequencia 
	from 	convenio_retorno_movto 
	where	nr_seq_retorno = nr_seq_retorno_p 
	and	coalesce(ds_item_retorno::text, '') = '' 
	and 	substr(obter_desc_item_conta(coalesce(nr_conta, (substr(obter_dados_ret_convenio(nr_seq_ret_item,1),1,10))::numeric ), cd_item),1,240) is not null 
	order by nr_sequencia;


BEGIN 
 
 
OPEN C01;
LOOP 
FETCH C01 into 
	cd_item_w, 
	ds_item_w, 
	nr_seq_movto_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin 
 
	update convenio_retorno_movto 
	set	ds_item_retorno = ds_item_w 
	where	nr_sequencia = nr_seq_movto_w;
 
	commit;
 
	end;
END LOOP;
CLOSE C01;
	 
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_descricao_item_movto (nr_seq_retorno_p bigint, nm_usuario_p text) FROM PUBLIC;

