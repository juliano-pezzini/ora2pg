-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copia_gabarito_outro_pacote ( nr_seq_pacote_orig_p bigint, nr_seq_acomod_orig_p bigint, nr_seq_pacote_dest_p text, cd_convenio_p bigint, ie_regra_p bigint, nm_usuario_p text) AS $body$
DECLARE



nr_seq_regra_w			bigint;
ie_inclui_exclui_w		varchar(01);
ie_excedente_w			smallint;
cd_grupo_material_w		smallint;
cd_subgrupo_material_w		smallint;
cd_classe_material_w		integer;
cd_material_w			integer;
qt_limite_w			double precision;
ie_tipo_atendimento_w		smallint;
cd_setor_atendimento_w		integer;
cd_area_proced_w		bigint;
cd_especial_proced_w		bigint;
cd_grupo_proced_w		bigint;
cd_procedimento_w		bigint;
ie_origem_proced_w		bigint;
ie_considera_honorario_w	varchar(01);
ie_calcula_honorario_w		varchar(01);
ie_calcula_custo_oper_w		varchar(01);
ie_valor_w			varchar(01);
vl_minimo_w			double precision;
vl_maximo_w			double precision;
pr_desconto_w			double precision;
ie_tipo_setor_w			varchar(3);
nr_seq_pacote_w			bigint;
nr_seq_acomod_dest_w		bigint;
nr_seq_familia_w  		bigint;
cd_centro_custo_w		integer;
ie_ratear_item_w		varchar(1);
vl_negociado_w			double precision;
nr_seq_classif_w		bigint;
nr_seq_estrutura_w		bigint;
cd_local_estoque_w		pacote_material.cd_local_estoque%type;
ie_valida_limite_proc_w		pacote_procedimento.ie_valida_limite_proc%type;
nr_seq_estrutura_proc_w		pacote_procedimento.nr_seq_estrutura%type;

/* 	0 Material
  	1 Procedimento
	2 Ambos
*/
c01 CURSOR FOR
	SELECT 	ie_inclui_exclui,
		ie_excedente,
		cd_grupo_material,
		cd_subgrupo_material,
		cd_classe_material,
		cd_material,
		qt_limite,
		ie_tipo_atendimento,
		cd_setor_atendimento,
		ie_valor,
		vl_minimo,
		vl_maximo,
		pr_desconto,
		ie_tipo_setor,
		nr_seq_familia,
		cd_centro_custo,
		ie_ratear_item,
		vl_negociado,
		nr_seq_estrutura,
		cd_local_estoque
	from 	pacote_material
	where 	nr_seq_pac_acomod = nr_seq_acomod_orig_p
	and 	nr_seq_pacote = nr_seq_pacote_orig_p;

c02 CURSOR FOR
	SELECT 	ie_inclui_exclui,
		ie_excedente,
		cd_area_proced,
		cd_especial_proced,
		cd_grupo_proced,
		cd_procedimento,
		ie_origem_proced,
		qt_limite,
		ie_considera_honorario,
		cd_setor_atendimento,
		ie_tipo_atendimento,
		ie_calcula_honorario,
		ie_calcula_custo_oper,
		pr_desconto,
		cd_centro_custo,
		nr_seq_classif,
		ie_ratear_item,
		ie_valida_limite_proc,
		nr_seq_estrutura
	from 	pacote_procedimento
	where 	nr_seq_pac_acomod = nr_seq_acomod_orig_p
	and 	nr_seq_pacote = nr_seq_pacote_orig_p;

c03 CURSOR FOR
	SELECT	nr_seq_pacote
	from	pacote
	where	obter_se_contido(nr_seq_pacote, elimina_aspas(nr_seq_pacote_dest_p)) = 'S'
	and	cd_convenio = cd_convenio_p
	and 	ie_situacao = 'A';


c04 CURSOR FOR
	SELECT 	IE_TIPO_ACOMOD          ,
		QT_DIAS_PACOTE          ,       
		QT_DIAS_HOSPITAL        ,       
		QT_DIAS_UTI             ,       
		IE_EXCEDENTE            ,       
		CD_PROCEDIMENTO         ,       
		IE_ORIGEM_PROCED        ,       
		VL_PACOTE               ,       
		VL_HONORARIO            ,       
		QT_PONTO_PACOTE         ,       
		QT_PONTO_HONORARIO      ,       
		CD_ESTRUTURA_CONTA      ,       
		IE_CLASSIFICACAO        ,       
		NR_SEQUENCIA            ,       
		CD_CATEGORIA            ,       
		DT_VIGENCIA             ,       
		IE_EXIGE_GABARITO       ,       
		IE_REGRA_HORA_INICIO    ,       
		IE_REGRA_HORA_FIM       ,       
		IE_SITUACAO             ,       
		QT_IDADE_MIN            ,       
		QT_IDADE_MAX            ,       
		IE_RATEAR_REPASSE       ,       
		DT_VIGENCIA_FINAL       ,      
		IE_TIPO_ATENDIMENTO     ,       
		QT_DIAS_INTER_INICIO    ,      
		QT_DIAS_INTER_FINAL     ,        
		IE_GERAR_PROCED_NEGATIVO,
		VL_ANESTESISTA          ,       
		IE_ATEND_RETORNO        ,       
		IE_TIPO_ANESTESIA       ,       
		HR_FINAL_PACOTE         ,       
		PR_FATURAR_PACOTE       ,       
		IE_ATEND_ACOMP          ,
		CD_SETOR_ATENDIMENTO	,
		NR_SEQ_PROC_INTERNO	,
		CD_MEDICO_EXECUTOR	,
		IE_CLINICA		,
		VL_MATERIAIS		,
		IE_CONSISTE_CIRURGIA	,
		IE_EXIGE_ITEM_CONTA	,
		VL_AUXILIARES		,
		DS_OBSERVACAO		,
		IE_SEXO			,
		PR_ACRESCIMO_RN		,
		IE_LADO			,
		IE_SETOR_LANC_EXCLUSIVO	,
		QT_PROCEDIMENTO		,
		CD_PLANO		,
		IE_TIPO_ATEND_CONTA	,
		cd_centro_custo		,	
		ie_credenciado		,
		qt_hora                 ,
                ie_carater_inter_sus
	from 	pacote_tipo_acomodacao
	where 	nr_seq_pacote = nr_seq_pacote_orig_p
	and 	nr_sequencia  = nr_seq_acomod_orig_p;

c04_w	c04%rowtype;




BEGIN	
	

open	c03;
loop
fetch	c03 into
	nr_seq_pacote_w;
EXIT WHEN NOT FOUND; /* apply on c03 */
	begin
	
	open c04;
	loop
	fetch c04 into c04_w;
	EXIT WHEN NOT FOUND; /* apply on c04 */
		
		select 	nextval('pacote_tipo_acomodacao_seq')
		into STRICT	nr_seq_acomod_dest_w
		;
		

		insert into pacote_tipo_acomodacao(NR_SEQ_PACOTE             ,
						IE_TIPO_ACOMOD                , 
						DT_ATUALIZACAO                , 
						NM_USUARIO                    , 
						QT_DIAS_PACOTE                , 
						QT_DIAS_HOSPITAL              , 
						QT_DIAS_UTI                   , 
						IE_EXCEDENTE                  , 
						CD_PROCEDIMENTO               , 
						IE_ORIGEM_PROCED              , 
						VL_PACOTE                     , 
						VL_HONORARIO                  , 
						QT_PONTO_PACOTE               , 
						QT_PONTO_HONORARIO            , 
						CD_ESTRUTURA_CONTA            , 
						IE_CLASSIFICACAO              , 
						NR_SEQUENCIA                  , 
						CD_CATEGORIA                  ,
						DT_VIGENCIA                   , 	
						IE_EXIGE_GABARITO             , 
						IE_REGRA_HORA_INICIO          , 
						IE_REGRA_HORA_FIM             , 
						IE_SITUACAO                   , 
						QT_IDADE_MIN                  , 
						QT_IDADE_MAX                  , 
						IE_RATEAR_REPASSE             , 
						DT_VIGENCIA_FINAL             , 
						IE_TIPO_ATENDIMENTO           , 
						QT_DIAS_INTER_INICIO          , 
						QT_DIAS_INTER_FINAL           , 
						IE_GERAR_PROCED_NEGATIVO      ,	
						VL_ANESTESISTA                , 
						IE_ATEND_RETORNO              , 
						IE_TIPO_ANESTESIA             , 
						HR_FINAL_PACOTE               , 
						PR_FATURAR_PACOTE             ,
						IE_ATEND_ACOMP		,
						CD_SETOR_ATENDIMENTO	,
						NR_SEQ_PROC_INTERNO	,
						CD_MEDICO_EXECUTOR	,
						IE_CLINICA		,
						VL_MATERIAIS		,
						IE_CONSISTE_CIRURGIA	,
						IE_EXIGE_ITEM_CONTA	,
						VL_AUXILIARES		,
						DS_OBSERVACAO		,
						IE_SEXO			,
						PR_ACRESCIMO_RN		,
						IE_LADO			,
						IE_SETOR_LANC_EXCLUSIVO	,
						QT_PROCEDIMENTO,
						CD_PLANO,
						IE_TIPO_ATEND_CONTA,
						cd_centro_custo,
						ie_credenciado,
						qt_hora,
                                                ie_carater_inter_sus)
				values (	nr_seq_pacote_w		  	 ,
						c04_w.IE_TIPO_ACOMOD    	  ,             
						clock_timestamp()			   	  ,
						NM_USUARIO_p            	  ,         
						c04_w.QT_DIAS_PACOTE              ,  
						c04_w.QT_DIAS_HOSPITAL            ,     
						c04_w.QT_DIAS_UTI                 ,     
						c04_w.IE_EXCEDENTE                ,     
						c04_w.CD_PROCEDIMENTO             ,     
						c04_w.IE_ORIGEM_PROCED            ,     
						c04_w.VL_PACOTE                   ,      
						c04_w.VL_HONORARIO                ,       
						c04_w.QT_PONTO_PACOTE             ,     
						c04_w.QT_PONTO_HONORARIO          ,     
						c04_w.CD_ESTRUTURA_CONTA          ,     
						c04_w.IE_CLASSIFICACAO            ,     
						nr_seq_acomod_dest_w		  ,
						c04_w.CD_CATEGORIA                ,   
						c04_w.DT_VIGENCIA                 ,   
						c04_w.IE_EXIGE_GABARITO           ,   
						c04_w.IE_REGRA_HORA_INICIO        ,   
						c04_w.IE_REGRA_HORA_FIM           ,   
						c04_w.IE_SITUACAO                 ,   
						c04_w.QT_IDADE_MIN                ,   
						c04_w.QT_IDADE_MAX                ,   
						c04_w.IE_RATEAR_REPASSE           ,   
						c04_w.DT_VIGENCIA_FINAL           ,   
						c04_w.IE_TIPO_ATENDIMENTO         ,  
						c04_w.QT_DIAS_INTER_INICIO        ,   
						c04_w.QT_DIAS_INTER_FINAL         ,   
						c04_w.IE_GERAR_PROCED_NEGATIVO    ,
						c04_w.VL_ANESTESISTA              ,   
						c04_w.IE_ATEND_RETORNO            ,   
						c04_w.IE_TIPO_ANESTESIA           ,   
						c04_w.HR_FINAL_PACOTE             ,   
						c04_w.PR_FATURAR_PACOTE           ,   
						c04_w.IE_ATEND_ACOMP              ,
						c04_w.CD_SETOR_ATENDIMENTO	,
						c04_w.NR_SEQ_PROC_INTERNO	,
						c04_w.CD_MEDICO_EXECUTOR	,
						c04_w.IE_CLINICA		,
						c04_w.VL_MATERIAIS		,
						c04_w.IE_CONSISTE_CIRURGIA	,
						c04_w.IE_EXIGE_ITEM_CONTA	,
						c04_w.VL_AUXILIARES		,
						c04_w.DS_OBSERVACAO		,
						c04_w.IE_SEXO			,
						c04_w.PR_ACRESCIMO_RN		,
						c04_w.IE_LADO			,
						c04_w.IE_SETOR_LANC_EXCLUSIVO	,
						c04_w.QT_PROCEDIMENTO		,
						c04_w.CD_PLANO			,
						c04_w.IE_TIPO_ATEND_CONTA	,
						c04_w.cd_centro_custo		,
						c04_w.ie_credenciado		,
						c04_w.qt_hora                   ,
                                                c04_w.ie_carater_inter_sus);

	if (ie_regra_p in (0,2)) then
	

		open	c01;
		loop
		fetch	c01 into	
			ie_inclui_exclui_w,
			ie_excedente_w,
			cd_grupo_material_w,
			cd_subgrupo_material_w,
			cd_classe_material_w,
			cd_material_w,
			qt_limite_w,
			ie_tipo_atendimento_w,
			cd_setor_atendimento_w,
			ie_valor_w,
			vl_minimo_w,
			vl_maximo_w,
			pr_desconto_w,
			ie_tipo_setor_w,
			nr_seq_familia_w,
			cd_centro_custo_w,
			ie_ratear_item_w,
			vl_negociado_w,
			nr_seq_estrutura_w,
			cd_local_estoque_w;
		EXIT WHEN NOT FOUND; /* apply on c01 */
			begin

			select	nextval('pacote_material_seq')
			into STRICT	nr_seq_regra_w
			;

			insert into pacote_material(nr_seq_pacote,
				nr_sequencia,
				ie_inclui_exclui,
				dt_atualizacao,
				nm_usuario,
				ie_excedente,
				cd_grupo_material,
				cd_subgrupo_material,
				cd_classe_material,
				cd_material,
				qt_limite,
				ie_tipo_atendimento,
				cd_setor_atendimento,
				nr_seq_pac_acomod,
				ie_valor,
				vl_minimo,
				vl_maximo,
				pr_desconto,
				ie_tipo_setor,
				nr_seq_familia,
				cd_centro_custo,
				ie_ratear_item,
				vl_negociado,
				nr_seq_estrutura,
				cd_local_estoque)
			values (nr_seq_pacote_w,
				nr_seq_regra_w,
				ie_inclui_exclui_w,
				clock_timestamp(),
				nm_usuario_p,
				ie_excedente_w,
				cd_grupo_material_w,
				cd_subgrupo_material_w,
				cd_classe_material_w,
				cd_material_w,
				qt_limite_w,
				ie_tipo_atendimento_w,
				cd_setor_atendimento_w,
				nr_seq_acomod_dest_w,
				ie_valor_w,
				vl_minimo_w,
				vl_maximo_w,
				pr_desconto_w,
				ie_tipo_setor_w,
				nr_seq_familia_w,
				cd_centro_custo_w,
				ie_ratear_item_w,
				vl_negociado_w,
				nr_seq_estrutura_w,
				cd_local_estoque_w);
			end;
		end loop;
		close c01;

	end if;

	if (ie_regra_p in (1,2)) then


		open	c02;
		loop
		fetch	c02 into
			ie_inclui_exclui_w,
			ie_excedente_w,
			cd_area_proced_w,
			cd_especial_proced_w,
			cd_grupo_proced_w,
			cd_procedimento_w,
			ie_origem_proced_w,
			qt_limite_w,
			ie_considera_honorario_w,
			cd_setor_atendimento_w,
			ie_tipo_atendimento_w,
			ie_calcula_honorario_w,
			ie_calcula_custo_oper_w,
			pr_desconto_w,
			cd_centro_custo_w,
			nr_seq_classif_w,
			ie_ratear_item_w,
			ie_valida_limite_proc_w,
			nr_seq_estrutura_proc_w;
		EXIT WHEN NOT FOUND; /* apply on c02 */
			begin

			select	nextval('pacote_procedimento_seq')
			into STRICT	nr_seq_regra_w
			;

			insert into pacote_procedimento(nr_seq_pacote,
				nr_sequencia,
				ie_inclui_exclui,
				dt_atualizacao,
				nm_usuario,
				ie_excedente,
				cd_area_proced,
				cd_especial_proced,
				cd_grupo_proced,
				cd_procedimento,
				ie_origem_proced,
				qt_limite,
				ie_considera_honorario,
				cd_setor_atendimento,
				ie_tipo_atendimento,
				ie_calcula_honorario,
				ie_calcula_custo_oper,
				nr_seq_pac_acomod,
				pr_desconto,
				cd_centro_custo,
				nr_seq_classif,
				ie_ratear_item,
				ie_valida_limite_proc,
				nr_seq_estrutura)
			values (nr_seq_pacote_w,
				nr_seq_regra_w,
				ie_inclui_exclui_w,
				clock_timestamp(),
				nm_usuario_p,
				ie_excedente_w,
				cd_area_proced_w,
				cd_especial_proced_w,
				cd_grupo_proced_w,
				cd_procedimento_w,
				ie_origem_proced_w,
				qt_limite_w,
				ie_considera_honorario_w,
				cd_setor_atendimento_w,
				ie_tipo_atendimento_w,
				ie_calcula_honorario_w,
				ie_calcula_custo_oper_w,
				nr_seq_acomod_dest_w,
				pr_desconto_w,
				cd_centro_custo_w,
				nr_seq_classif_w,
				ie_ratear_item_w,
				ie_valida_limite_proc_w,
				nr_seq_estrutura_proc_w);
			end;
		end loop;
		close c02;

	end if;
	
	end loop;
	close c04;


	end;

end loop;
close c03;


commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copia_gabarito_outro_pacote ( nr_seq_pacote_orig_p bigint, nr_seq_acomod_orig_p bigint, nr_seq_pacote_dest_p text, cd_convenio_p bigint, ie_regra_p bigint, nm_usuario_p text) FROM PUBLIC;

