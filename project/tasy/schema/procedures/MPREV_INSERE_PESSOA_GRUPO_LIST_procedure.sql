-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE mprev_insere_pessoa_grupo_list (nr_seq_captacao_p bigint, ds_seq_grupo_list_p text, cd_pessoa_fisica_p text, ie_motivo_inclusao_p text, ds_motivo_inclusao_p text, nm_usuario_p text) AS $body$
DECLARE


ds_seq_grupo_list_w varchar(2000);
ie_final_w          varchar(1);
tam_lista_w		    bigint;
ie_pos_virgula_w	smallint;
nr_seq_grupo_cont_w	bigint;


BEGIN

if (ds_seq_grupo_list_p IS NOT NULL AND ds_seq_grupo_list_p::text <> '') and (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') and (ie_motivo_inclusao_p IS NOT NULL AND ie_motivo_inclusao_p::text <> '') then

    ds_seq_grupo_list_w := ds_seq_grupo_list_p;
    tam_lista_w := length(ds_seq_grupo_list_w);
    if (substr(ds_seq_grupo_list_w, tam_lista_w-1, tam_lista_w) = ',') then
        ds_seq_grupo_list_w := substr(ds_seq_grupo_list_w, 1, length(ds_seq_grupo_list_w)-1);
    end if;

    ie_final_w          := 'N';

	while (ds_seq_grupo_list_w IS NOT NULL AND ds_seq_grupo_list_w::text <> '') loop
        begin
            nr_seq_grupo_cont_w := 0;
            tam_lista_w	:= length(ds_seq_grupo_list_w);
            ie_pos_virgula_w	:= position(',' in ds_seq_grupo_list_w);
            if (ie_pos_virgula_w = 0) then
                ie_final_w := 'S';
                nr_seq_grupo_cont_w := (ds_seq_grupo_list_w)::numeric;
                ds_seq_grupo_list_w := null;
            elsif (ie_pos_virgula_w = 1) then
                ds_seq_grupo_list_w	:= substr(ds_seq_grupo_list_w, (ie_pos_virgula_w + 1), tam_lista_w);
            else
                nr_seq_grupo_cont_w	:= (substr(ds_seq_grupo_list_w, 1, (ie_pos_virgula_w - 1)))::numeric;
                ds_seq_grupo_list_w	:= substr(ds_seq_grupo_list_w, (ie_pos_virgula_w + 1), tam_lista_w);
            end if;

            if ((nr_seq_grupo_cont_w IS NOT NULL AND nr_seq_grupo_cont_w::text <> '') and nr_seq_grupo_cont_w > 0) then
                CALL mprev_insere_pessoa_grupo_cont( nr_seq_captacao_p,
                                                nr_seq_grupo_cont_w,
                                                cd_pessoa_fisica_p,
                                                ie_motivo_inclusao_p,
                                                ds_motivo_inclusao_p,
                                                nm_usuario_p,
                                                ie_final_w);
            end if;

        end;
    end loop;

end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE mprev_insere_pessoa_grupo_list (nr_seq_captacao_p bigint, ds_seq_grupo_list_p text, cd_pessoa_fisica_p text, ie_motivo_inclusao_p text, ds_motivo_inclusao_p text, nm_usuario_p text) FROM PUBLIC;

