-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_kit_material (cd_kit_material_p bigint, nm_usuario_p text) AS $body$
DECLARE


cd_kit_material_w	integer;
ds_kit_material_w	varchar(80);
ie_situacao_w		varchar(1);
ie_tipo_w		varchar(1);
ie_forma_baixa_w	varchar(1);
ie_material_pai_w	varchar(1);
cd_estab_exclusivo_w	kit_material.cd_estab_exclusivo%type;


BEGIN

select	max(cd_kit_material) + 1
into STRICT	cd_kit_material_w
from 	kit_material;

select	ds_kit_material,
	ie_situacao,
	ie_tipo,
	ie_forma_baixa,
	ie_material_pai,
	cd_estab_exclusivo
into STRICT	ds_kit_material_w,
	ie_situacao_w,
	ie_tipo_w,
	ie_forma_baixa_w,
	ie_material_pai_w,
	cd_estab_exclusivo_w
from	kit_material
where 	cd_kit_material = cd_kit_material_p;

insert	into kit_material(
	cd_kit_material,
	ds_kit_material,
	ie_situacao,
	dt_atualizacao,
	nm_usuario,
	ie_tipo,
	ie_forma_baixa,
	ie_material_pai,
	cd_estab_exclusivo)
values (cd_kit_material_w,
	wheb_mensagem_pck.get_Texto(311905, 'DS_KIT_MATERIAL_W='|| DS_KIT_MATERIAL_W),
	ie_situacao_w,
	clock_timestamp(),
	nm_usuario_p,
	ie_tipo_w,
	ie_forma_baixa_w,
	ie_material_pai_w,
	cd_estab_exclusivo_w);


insert	into componente_kit(
	cd_kit_material,
	nr_sequencia,
	cd_material,
	ie_via_aplicacao,
	ie_tipo_paciente,
	qt_material,
	ie_situacao,
	dt_atualizacao,
	nm_usuario,
	qt_volume_min,
	qt_volume_max,
	ie_baixa_estoque,
	cd_medico,
	cd_convenio,
	ie_tipo_convenio,
	ie_dispensavel,
	ie_video,
	CD_FORNECEDOR,
	QT_IDADE_MINIMA,
	QT_IDADE_MAXIMA,
	IE_CALCULA_PRECO,
	IE_ENTRA_CONTA,
	IE_DUPLICA_PRESCR,
	IE_MULTIPLICA_DOSE)
SELECT	cd_kit_material_w,
	nr_sequencia,
	cd_material,
	ie_via_aplicacao,
	ie_tipo_paciente,
	qt_material,
	ie_situacao,
	clock_timestamp(),
	nm_usuario_p,
	qt_volume_min,
	qt_volume_max,
	ie_baixa_estoque,
	cd_medico,
	cd_convenio,
	ie_tipo_convenio,
	ie_dispensavel,
	ie_video,
	CD_FORNECEDOR,
	QT_IDADE_MINIMA,
	QT_IDADE_MAXIMA,
	IE_CALCULA_PRECO,
	IE_ENTRA_CONTA,
	coalesce(IE_DUPLICA_PRESCR,'S'),
	coalesce(IE_MULTIPLICA_DOSE,'N')
from	componente_kit
where	cd_kit_material = cd_kit_material_p;

insert	into componente_kit_opcao(
	nr_sequencia,
	dt_atualizacao,
	nm_usuario,
	cd_kit_material,
	nr_seq_componente,
	cd_material)
(SELECT nextval('componente_kit_opcao_seq'),
	clock_timestamp(),
	nm_usuario_p,
	cd_kit_material_w,
	nr_seq_componente,
	cd_material
from	componente_kit_opcao
where	cd_kit_material = cd_kit_material_p);

COMMIT;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_kit_material (cd_kit_material_p bigint, nm_usuario_p text) FROM PUBLIC;

