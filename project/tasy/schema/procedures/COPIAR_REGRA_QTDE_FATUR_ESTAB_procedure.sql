-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copiar_regra_qtde_fatur_estab ( cd_estab_origem_p bigint, cd_estab_destino_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_sequencia_w		bigint;
				
C01 CURSOR FOR
	SELECT	*
	from	material_regra_qt_fat
	where	cd_estabelecimento = cd_estab_origem_p;
	
c01_w	c01%rowtype;
	

BEGIN
open C01;
loop
fetch C01 into
	C01_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin
	
	select 	nextval('material_regra_qt_fat_seq')
	into STRICT	nr_sequencia_w
	;
	
	insert into material_regra_qt_fat(
				nr_sequencia, 		  cd_estabelecimento,		dt_atualizacao,			nm_usuario,
				ie_regra_disp,		  cd_material,			cd_convenio,			cd_setor_atendimento,
				dt_atualizacao_nrec,	  nm_usuario_nrec,		qt_limite,			qt_limite_max,
				cd_kit_material,	  cd_categoria,			nr_multiplo,			dt_inicio_vigencia,
				dt_final_vigencia,	  ie_tipo_data,			cd_grupo_material,		cd_subgrupo_material,
				cd_classe_material,	  cd_perfil,                    cd_funcao)
			values (nr_sequencia_w,		  cd_estab_destino_p,		clock_timestamp(),			nm_usuario_p,
				C01_w.ie_regra_disp, 	  C01_w.cd_material,		C01_w.cd_convenio, 		C01_w.cd_setor_atendimento,
				clock_timestamp(),		  nm_usuario_p,			C01_w.qt_limite,		C01_w.qt_limite_max,
				C01_w.cd_kit_material,	  C01_w.cd_categoria,		C01_w.nr_multiplo,		C01_w.dt_inicio_vigencia,
				C01_w.dt_final_vigencia,  C01_w.ie_tipo_data,		C01_w.cd_grupo_material,	C01_w.cd_subgrupo_material,
				C01_w.cd_classe_material, C01_w.cd_perfil,              C01_w.cd_funcao);
	end;
end loop;
close C01;
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copiar_regra_qtde_fatur_estab ( cd_estab_origem_p bigint, cd_estab_destino_p bigint, nm_usuario_p text) FROM PUBLIC;

