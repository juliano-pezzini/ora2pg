-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE tasy_gerar_dump () AS $body$
DECLARE


v_sid 		bigint;
v_serial 	bigint;
v_module 	varchar(48);
v_process 	bigint;
v_machine 	varchar(64);
cd_cnpj_w	varchar(15);

BEGIN
	begin


	select 	cd_cgc
	into STRICT	cd_cnpj_w
	from	estabelecimento
	where	cd_estabelecimento = 1;

	if ( '01880344000103' = cd_cnpj_w) then

		select distinct s.SID,
						s.SERIAL#,
						s.module,
						p.SPID,
						s.machine
		into STRICT 	v_sid,
				v_serial,
				v_module,
				v_process,
				v_machine
		from 	v$session s,
				v$process p
		where 	s.PADDR = p.ADDR
		and 	s.STATUS = 'ACTIVE'
		and 	s.AUDSID = USERENV('SESSIONID');

	    EXECUTE 'alter session set statistics_level=ALL';
		EXECUTE 'alter session set tracefile_identifier='''||v_sid||'.'||v_serial||'.'||v_process||'.'||v_machine||'.ADEP''';
		EXECUTE 'alter session set max_dump_file_size=UNLIMITED';
		EXECUTE 'alter session set events ''10046 trace name context forever, level 8''';
	end if;

	exception
	when others then
				v_module := '';
	end;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tasy_gerar_dump () FROM PUBLIC;

