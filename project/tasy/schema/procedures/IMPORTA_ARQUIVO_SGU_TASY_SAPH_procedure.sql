-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE importa_arquivo_sgu_tasy_saph ( nm_usuario_p text, cd_estabelecimento_p text, singular_p text, cod_unimed_contrato_p text, cod_unimed_familia_p text, cod_unimed_dep_p text, cod_digito_verific_p text, nm_pessoa_fisica_p text, ie_sexo_p text, ie_estado_civil_p text, dt_nascimento_p timestamp, ie_tipo_cliente_p text, nr_cpf_p text, nm_plano_unimed_p text, ie_tipo_acom_integ_p text, ie_possui_sos_p text, dt_inclusao_sos_p text, dt_exclusao_sos_p text, dt_inclusao_transp_p text, dt_exclusao_transp_p text, ie_funcionario_p text, nr_ddd_celular_p text, nr_telefone_celular_p text, nm_contato_p text, nr_ddd_telefone_p text, nr_telefone_p text, ds_endereco_res_p text, ds_bairro_res_p text, cd_cep_res_p text, ds_municipio_res_p text, sg_estado_res_p text, ds_complemento_res_p text, nr_ddd_fone_res_p text, nr_telefone_res_p text, ds_endereco_com_p text, ds_bairro_com_p text, cd_cep_com_p text, ds_municipio_com_p text, sg_estado_com_p text, ds_complemento_com_p text, nr_ddd_fone_com_p text, nr_telefone_com_p text, nm_mae_p text, dt_atualizacao_integracao_p timestamp, cd_unisanta_p bigint, ie_status_p text, ie_nivel_dependencia_p text, ie_plano_regulamentado_p text ) AS $body$
DECLARE


nr_seq_compl_Pes_w      	bigint;
cd_pessoa_fisica_w      	varchar(20);
nr_sequencia_cont_w     	bigint;
nr_seq_pf_contrato_w		bigint;
nr_seq_contrato_w       	bigint;
cd_cod_convenio_w       	varchar(14);
cd_cod_convenio_compl_w 	varchar(18);
cd_pf_titular_w			varchar(10);
dt_atualizacao_w		timestamp;
nr_seq_cobertura_w		bigint;
nr_seq_contrato_titular_w	bigint;
cd_seq_dependente_w		varchar(3);
ie_estado_civil_w		pessoa_fisica.ie_estado_civil%type;


BEGIN
	cd_cod_convenio_w := singular_p || cod_unimed_contrato_p || cod_unimed_familia_p;
	cd_cod_convenio_compl_w  := singular_p || cod_unimed_contrato_p || cod_unimed_familia_p || cod_unimed_dep_p;

	IF (nr_cpf_p = '00000000000') THEN

		SELECT  MAX(coalesce(cd_pf_titular, cd_pessoa_fisica))
		INTO STRICT	cd_pessoa_fisica_w
		FROM	eme_pf_contrato
		WHERE 	SUBSTR(cd_codigo_convenio,1,16) = cd_cod_convenio_compl_w;

	ELSE
		SELECT  MAX(cd_pessoa_fisica)
		INTO STRICT	cd_pessoa_fisica_w
		FROM	pessoa_fisica
		WHERE	nr_cpf = nr_cpf_p
		AND 	dt_nascimento = dt_nascimento_p;
	END IF;





	if (ie_estado_civil_p IS NOT NULL AND ie_estado_civil_p::text <> '') then
		if (ie_estado_civil_p = 'C') then
			ie_estado_civil_w := '2';
		elsif (ie_estado_civil_p = 'D') then
			ie_estado_civil_w := '3';
		elsif (ie_estado_civil_p = 'S') then
			ie_estado_civil_w := '1';
		elsif (ie_estado_civil_p = 'V') then
			ie_estado_civil_w := '5';
		elsif (ie_estado_civil_p = 'O') then
			ie_estado_civil_w := '9';
		end if;
	end if;

	IF (cd_pessoa_fisica_w IS NOT NULL AND cd_pessoa_fisica_w::text <> '') THEN

		SELECT 	MAX(dt_atualizacao_integracao)
		INTO STRICT	dt_atualizacao_w
		FROM	eme_pf_contrato
		WHERE 	coalesce(cd_pf_titular, cd_pessoa_fisica) = cd_pessoa_fisica_w
		AND 	SUBSTR(cd_codigo_convenio,1,16) = cd_cod_convenio_compl_w;

		IF (dt_atualizacao_integracao_p IS NOT NULL AND dt_atualizacao_integracao_p::text <> '') AND (dt_atualizacao_integracao_p > dt_atualizacao_w) THEN

			UPDATE 	pessoa_fisica
			SET	ie_funcionario      = coalesce(ie_funcionario_p,ie_funcionario),
				nr_ddd_celular      = coalesce(nr_ddd_celular_p,nr_ddd_celular),
				nr_telefone_celular = coalesce(nr_telefone_celular_p,nr_telefone_celular),
				ie_estado_civil     = coalesce(ie_estado_civil_w,ie_estado_civil),
				dt_atualizacao	    = clock_timestamp(),
				nm_usuario          = nm_usuario_p
			WHERE 	cd_pessoa_fisica = cd_pessoa_fisica_w;

			SELECT 	MAX(nr_sequencia)
			INTO STRICT	nr_seq_compl_Pes_w
			FROM	compl_pessoa_fisica
			WHERE	cd_pessoa_fisica = cd_pessoa_fisica_w
			AND 	ie_tipo_complemento = 1;

			IF (nr_seq_compl_Pes_w IS NOT NULL AND nr_seq_compl_Pes_w::text <> '') THEN

				UPDATE 	compl_pessoa_fisica
				SET	dt_atualizacao   = clock_timestamp(),
					nm_usuario       = nm_usuario_p,
					nr_ddd_telefone  = coalesce(nr_ddd_fone_res_p,nr_ddd_telefone),
					nr_telefone      = coalesce(nr_telefone_res_p,nr_telefone),
					ds_endereco      = coalesce(ds_endereco_res_p,ds_endereco),
					ds_bairro        = coalesce(ds_bairro_res_p,ds_bairro),
					cd_cep           = coalesce(cd_cep_res_p,cd_cep),
					ds_municipio     = coalesce(ds_municipio_res_p,ds_municipio),
					sg_estado        = coalesce(sg_estado_res_p,sg_estado),
					ds_complemento   = coalesce(ds_complemento_res_p,ds_complemento),
					nr_ddd_fone_adic = coalesce(nr_ddd_telefone_p,nr_ddd_fone_adic),
					ds_fone_adic     = coalesce(nr_telefone_p,ds_fone_adic)
				WHERE 	cd_pessoa_fisica = cd_pessoa_fisica_w
				AND 	ie_tipo_complemento = 1
				AND 	nr_sequencia = nr_seq_compl_Pes_w;

			END IF;

			SELECT 	MAX(nr_sequencia)
			INTO STRICT	nr_seq_compl_Pes_w
			FROM	compl_pessoa_fisica
			WHERE	cd_pessoa_fisica = cd_pessoa_fisica_w
			AND 	ie_tipo_complemento = 2;

			IF (nr_seq_compl_Pes_w IS NOT NULL AND nr_seq_compl_Pes_w::text <> '') THEN

				UPDATE compl_pessoa_fisica
				SET	dt_atualizacao   = clock_timestamp(),
					nm_usuario       = nm_usuario_p,
					nr_ddd_telefone  = coalesce(nr_ddd_fone_com_p,nr_ddd_telefone),
					nr_telefone      = coalesce(nr_telefone_com_p,nr_telefone),
					ds_endereco      = coalesce(ds_endereco_com_p,ds_endereco),
					ds_bairro        = coalesce(ds_bairro_com_p,ds_bairro),
					cd_cep           = coalesce(cd_cep_com_p,cd_cep),
					ds_municipio     = coalesce(ds_municipio_com_p,ds_municipio),
					sg_estado        = coalesce(sg_estado_com_p,sg_estado),
					ds_complemento   = coalesce(ds_complemento_com_p,ds_complemento),
					nr_ddd_fone_adic = coalesce(nr_ddd_telefone_p,nr_ddd_fone_adic),
					ds_fone_adic     = coalesce(nr_telefone_p,ds_fone_adic)
				WHERE 	cd_pessoa_fisica = cd_pessoa_fisica_w
				AND 	ie_tipo_complemento = 2
				AND 	nr_sequencia = nr_seq_compl_Pes_w;

			END IF;

			SELECT 	MAX(nr_sequencia)
			INTO STRICT	nr_seq_compl_Pes_w
			FROM	compl_pessoa_fisica
			WHERE	cd_pessoa_fisica = cd_pessoa_fisica_w
			AND 	ie_tipo_complemento = 5;

			IF (nr_seq_compl_Pes_w IS NOT NULL AND nr_seq_compl_Pes_w::text <> '') THEN

				UPDATE compl_pessoa_fisica
				SET	dt_atualizacao   = clock_timestamp(),
					nm_usuario       = nm_usuario_p,
					nm_contato       = coalesce(nm_mae_p,nm_contato)
				WHERE 	cd_pessoa_fisica = cd_pessoa_fisica_w
				AND 	ie_tipo_complemento = 5
				AND 	nr_sequencia = nr_seq_compl_Pes_w;

			END IF;

			SELECT 	MAX(nr_sequencia)
			INTO STRICT	nr_seq_compl_Pes_w
			FROM	compl_pessoa_fisica
			WHERE	cd_pessoa_fisica = cd_pessoa_fisica_w
			AND 	ie_tipo_complemento = 9;

			IF (nr_seq_compl_Pes_w IS NOT NULL AND nr_seq_compl_Pes_w::text <> '') THEN

				UPDATE compl_pessoa_fisica
				SET	dt_atualizacao   = clock_timestamp(),
					nm_usuario       = nm_usuario_p,
					nm_contato       = coalesce(nm_contato_p,nm_contato),
					nr_ddd_telefone  = coalesce(nr_ddd_telefone_p,nr_ddd_telefone),
					nr_telefone      = coalesce(nr_telefone_p,nr_telefone)
				WHERE 	cd_pessoa_fisica = cd_pessoa_fisica_w
				AND 	ie_tipo_complemento = 9
				AND 	nr_sequencia = nr_seq_compl_Pes_w;

			END IF;

		END IF;

	ELSE

		SELECT 	nextval('pessoa_fisica_seq')
		INTO STRICT  	cd_pessoa_fisica_w
		;

		INSERT INTO pessoa_fisica(cd_pessoa_fisica,
					  nm_pessoa_fisica,
					  dt_nascimento,
					  ie_sexo,
					  nr_cpf,
					  ie_tipo_pessoa,
					  dt_atualizacao,
					  dt_atualizacao_nrec,
					  nm_usuario,
					  nm_usuario_nrec,
					  ie_funcionario,
					  nr_ddd_celular,
					  nr_telefone_celular,
					  ie_estado_civil)
				VALUES (cd_pessoa_fisica_w,
					  nm_pessoa_fisica_p,
					  dt_nascimento_p,
					  ie_sexo_p,
					  nr_cpf_p,
					  1,
					  clock_timestamp(),
					  clock_timestamp(),
					  nm_usuario_p,
					  nm_usuario_p,
					  ie_funcionario_p,
					  nr_ddd_celular_p,
					  nr_telefone_celular_p,
					  ie_estado_civil_w);

	END IF;

	IF (nr_ddd_fone_res_p IS NOT NULL AND nr_ddd_fone_res_p::text <> '') OR (nr_telefone_res_p IS NOT NULL AND nr_telefone_res_p::text <> '') OR (ds_endereco_res_p IS NOT NULL AND ds_endereco_res_p::text <> '')  OR (ds_bairro_res_p IS NOT NULL AND ds_bairro_res_p::text <> '')  OR (cd_cep_res_p IS NOT NULL AND cd_cep_res_p::text <> '')     OR (ds_municipio_res_p IS NOT NULL AND ds_municipio_res_p::text <> '') OR (sg_estado_res_p IS NOT NULL AND sg_estado_res_p::text <> '')   OR (ds_complemento_res_p IS NOT NULL AND ds_complemento_res_p::text <> '') THEN

		SELECT 	MAX(nr_sequencia)
		INTO STRICT	nr_seq_compl_Pes_w
		FROM	compl_pessoa_fisica
		WHERE	cd_pessoa_fisica = cd_pessoa_fisica_w
		AND 	ie_tipo_complemento = 1;

		IF (coalesce(nr_seq_compl_Pes_w::text, '') = '') THEN

			SELECT	coalesce(MAX(nr_sequencia),0) + 1
			INTO STRICT	nr_seq_compl_Pes_w
			FROM	compl_pessoa_fisica
			WHERE	cd_pessoa_fisica = cd_pessoa_fisica_w;

			INSERT INTO compl_pessoa_fisica(cd_pessoa_fisica,
							 nr_sequencia,
							 ie_tipo_complemento,
							 dt_atualizacao,
							 nm_usuario,
							 nr_ddd_telefone,
							 nr_telefone,
							 ds_endereco,
							 ds_bairro,
							 cd_cep,
							 ds_municipio,
							 sg_estado,
							 ds_complemento,
							 nr_ddd_fone_adic,
							 ds_fone_adic)
						VALUES (cd_pessoa_fisica_w,
							 nr_seq_compl_Pes_w,
							 1,
							 clock_timestamp(),
							 nm_usuario_p,
							 nr_ddd_fone_res_p,
							 nr_telefone_res_p,
							 ds_endereco_res_p,
							 ds_bairro_res_p,
							 cd_cep_res_p,
							 ds_municipio_res_p,
							 sg_estado_res_p,
							 ds_complemento_res_p,
							 nr_ddd_telefone_p,
							 nr_telefone_p);
		END IF;

	END IF;

	IF (nr_ddd_fone_com_p IS NOT NULL AND nr_ddd_fone_com_p::text <> '') OR (nr_telefone_com_p IS NOT NULL AND nr_telefone_com_p::text <> '') OR (ds_endereco_com_p IS NOT NULL AND ds_endereco_com_p::text <> '')  OR (ds_bairro_com_p IS NOT NULL AND ds_bairro_com_p::text <> '')  OR (cd_cep_com_p IS NOT NULL AND cd_cep_com_p::text <> '')     OR (ds_municipio_com_p IS NOT NULL AND ds_municipio_com_p::text <> '') OR (sg_estado_com_p IS NOT NULL AND sg_estado_com_p::text <> '')   OR (ds_complemento_com_p IS NOT NULL AND ds_complemento_com_p::text <> '') THEN

		SELECT 	MAX(nr_sequencia)
		INTO STRICT	nr_seq_compl_Pes_w
		FROM	compl_pessoa_fisica
		WHERE	cd_pessoa_fisica = cd_pessoa_fisica_w
		AND 	ie_tipo_complemento = 2;

		IF (coalesce(nr_seq_compl_Pes_w::text, '') = '') THEN

			SELECT	coalesce(MAX(nr_sequencia),0) + 1
			INTO STRICT	nr_seq_compl_Pes_w
			FROM	compl_pessoa_fisica
			WHERE	cd_pessoa_fisica = cd_pessoa_fisica_w;

			INSERT INTO compl_pessoa_fisica(cd_pessoa_fisica,
							 nr_sequencia,
							 ie_tipo_complemento,
							 dt_atualizacao,
							 nm_usuario,
							 nr_ddd_telefone,
							 nr_telefone,
							 ds_endereco,
							 ds_bairro,
							 cd_cep,
							 ds_municipio,
							 sg_estado,
							 ds_complemento,
							 nr_ddd_fone_adic,
							 ds_fone_adic)
						VALUES (cd_pessoa_fisica_w,
							 nr_seq_compl_Pes_w,
							 2,
							 clock_timestamp(),
							 nm_usuario_p,
							 nr_ddd_fone_com_p,
							 nr_telefone_com_p,
							 ds_endereco_com_p,
							 ds_bairro_com_p,
							 cd_cep_com_p,
							 ds_municipio_com_p,
							 sg_estado_com_p,
							 ds_complemento_com_p,
							 nr_ddd_telefone_p,
							 nr_telefone_p);
		END IF;

	END IF;

	IF (nm_mae_p IS NOT NULL AND nm_mae_p::text <> '') THEN

		SELECT 	MAX(nr_sequencia)
		INTO STRICT	nr_seq_compl_Pes_w
		FROM	compl_pessoa_fisica
		WHERE	cd_pessoa_fisica = cd_pessoa_fisica_w
		AND 	ie_tipo_complemento = 5;

		IF (coalesce(nr_seq_compl_Pes_w::text, '') = '') THEN

			SELECT	coalesce(MAX(nr_sequencia),0) + 1
			INTO STRICT	nr_seq_compl_Pes_w
			FROM	compl_pessoa_fisica
			WHERE	cd_pessoa_fisica = cd_pessoa_fisica_w;

			INSERT INTO compl_pessoa_fisica(cd_pessoa_fisica,
								 nr_sequencia,
								 ie_tipo_complemento,
								 dt_atualizacao,
								 nm_usuario,
								 nm_contato)
							VALUES (cd_pessoa_fisica_w,
								 nr_seq_compl_Pes_w,
								 5,
								 clock_timestamp(),
								 nm_usuario_p,
								 nm_mae_p);
		END IF;

	END IF;

	IF (nm_contato_p IS NOT NULL AND nm_contato_p::text <> '') THEN

		SELECT 	MAX(nr_sequencia)
		INTO STRICT	nr_seq_compl_Pes_w
		FROM	compl_pessoa_fisica
		WHERE	cd_pessoa_fisica = cd_pessoa_fisica_w
		AND 	ie_tipo_complemento = 9;

		IF (coalesce(nr_seq_compl_Pes_w::text, '') = '') THEN

			SELECT	coalesce(MAX(nr_sequencia),0) + 1
			INTO STRICT	nr_seq_compl_Pes_w
			FROM	compl_pessoa_fisica
			WHERE	cd_pessoa_fisica = cd_pessoa_fisica_w;

			INSERT INTO compl_pessoa_fisica(cd_pessoa_fisica,
								 nr_sequencia,
								 ie_tipo_complemento,
								 dt_atualizacao,
								 nm_usuario,
								 nm_contato,
                         nr_ddd_telefone,
   							 nr_telefone)
							VALUES (cd_pessoa_fisica_w,
								 nr_seq_compl_Pes_w,
								 9,
								 clock_timestamp(),
								 nm_usuario_p,
								 nm_contato_p,
                         nr_ddd_telefone_p,
							    nr_telefone_p);
		END IF;

	END IF;

	IF (coalesce(dt_inclusao_sos_p::text, '') = '') THEN

		SELECT 	MAX(nr_sequencia)
		INTO STRICT	nr_sequencia_cont_w
		FROM	eme_pf_contrato
		WHERE (cd_pessoa_fisica = cd_pessoa_fisica_w
		OR	cd_pf_titular = cd_pessoa_fisica_w)
		AND 	SUBSTR(cd_codigo_convenio,1,14) = cd_cod_convenio_w
		AND 	IE_POSSUI_SOS = ie_possui_sos_p
		AND	coalesce(dt_inclusao_sos::text, '') = '';

	ELSE

		SELECT 	MAX(nr_sequencia)
		INTO STRICT	nr_sequencia_cont_w
		FROM	eme_pf_contrato
		WHERE (cd_pessoa_fisica = cd_pessoa_fisica_w
		OR	cd_pf_titular = cd_pessoa_fisica_w)
		AND 	SUBSTR(cd_codigo_convenio,1,14) = cd_cod_convenio_w
		AND 	IE_POSSUI_SOS = ie_possui_sos_p
		AND	dt_inclusao_sos = dt_inclusao_sos_p;

	END IF;

	IF (coalesce(nr_sequencia_cont_w::text, '') = '') THEN

		SELECT 	coalesce(MIN(SUBSTR(cd_codigo_convenio,15,2)), '999')
		INTO STRICT	cd_seq_dependente_w
		FROM	eme_pf_contrato
		WHERE 	SUBSTR(cd_codigo_convenio,1,14) = cd_cod_convenio_w
		AND	ie_possui_sos = ie_possui_sos_p;

		SELECT 	MAX(nr_seq_contrato)
		INTO STRICT	nr_seq_contrato_titular_w
		FROM	eme_pf_contrato
		WHERE 	cd_codigo_convenio = cd_cod_convenio_w || cd_seq_dependente_w
		AND	ie_possui_sos = ie_possui_sos_p;

		IF (cd_seq_dependente_w = '999') THEN

			IF (ie_possui_sos_p = 'S') THEN
				nr_seq_cobertura_w := 21;
			ELSIF (ie_possui_sos_p = 'N') THEN
				nr_seq_cobertura_w := 31;
			END IF;

			SELECT	nextval('eme_contrato_seq')
			INTO STRICT	nr_sequencia_cont_w
			;

			INSERT INTO eme_contrato(
				nr_sequencia,
				cd_estabelecimento,
				cd_contrato,
				nm_contrato,
				nr_seq_cobertura,
				dt_contrato,
				cd_cgc,
				cd_pessoa_fisica,
				nr_seq_regra_preco,
				qt_dia_vencimento,
				ie_reajuste,
				dt_atualizacao,
				dt_cancelamento,
				nm_usuario,
				ie_origem,
				ie_tipo_acom_integ,
				cd_convenio,
				cd_categoria)
			VALUES (nr_sequencia_cont_w,
				cd_estabelecimento_p,
				nr_sequencia_cont_w,
				nm_plano_unimed_p,
				nr_seq_cobertura_w,
				clock_timestamp(),
				NULL,
				cd_pessoa_fisica_w,
				21,

				1,
				'S',

				clock_timestamp(),
				dt_exclusao_sos_p,
				nm_usuario_p,
				1,
				ie_tipo_acom_integ_p,
				CASE WHEN ie_plano_regulamentado_p='S' THEN  18  ELSE null END ,
				CASE WHEN ie_plano_regulamentado_p='S' THEN  1  ELSE null END );
		ELSE
			nr_sequencia_cont_w := nr_seq_contrato_titular_w;
		END IF;

		IF (ie_nivel_dependencia_p = 'T') THEN

			SELECT	nextval('eme_pf_contrato_seq')
			INTO STRICT	nr_seq_pf_contrato_w
			;

			INSERT INTO eme_pf_contrato(
				nr_sequencia,
				nr_seq_contrato,
				nr_seq_tipo_servico,
				dt_atualizacao,
				nm_usuario,
				cd_pessoa_fisica,
				cd_codigo_convenio,
				dt_cancelamento,
				dt_inclusao,
				cd_pf_titular,
				dt_inclusao_sos,
				ie_possui_sos,
				dt_inclusao_transporte,
				dt_exclusao_transporte,
				cd_unisanta,
				ie_status_int)
			VALUES ( nr_seq_pf_contrato_w,
				nr_sequencia_cont_w,
				11,

				clock_timestamp(),
				nm_usuario_p,
				NULL,
				cd_cod_convenio_compl_w,
				dt_exclusao_sos_p,
				clock_timestamp(),
				cd_pessoa_fisica_w,
				dt_inclusao_sos_p,
				ie_possui_sos_p,
				dt_inclusao_transp_p,
				dt_exclusao_transp_p,
				cd_unisanta_p,
				ie_status_p);

			IF ((nr_seq_contrato_titular_w IS NOT NULL AND nr_seq_contrato_titular_w::text <> '') and cd_seq_dependente_w <> '999') THEN

				UPDATE	eme_contrato
				SET	cd_pessoa_fisica 	= cd_pessoa_fisica_w
				WHERE	nr_sequencia = nr_seq_contrato_titular_w;

			END IF;

		ELSE

			SELECT	MAX(nr_seq_contrato)
			INTO STRICT	nr_seq_contrato_w
			FROM 	eme_pf_contrato
			WHERE	SUBSTR(cd_codigo_convenio,1,14) = cd_cod_convenio_w
			AND	ie_possui_sos = ie_possui_sos_p;

			if (coalesce(nr_seq_contrato_w,0) = 0) then
				SELECT	MAX(nr_seq_contrato)
				INTO STRICT	nr_seq_contrato_w
				FROM 	eme_pf_contrato
				WHERE	SUBSTR(cd_codigo_convenio,1,14) = cd_cod_convenio_w;
			end if;

			SELECT	nextval('eme_pf_contrato_seq')
			INTO STRICT	nr_seq_pf_contrato_w
			;

			INSERT INTO eme_pf_contrato(
				nr_sequencia,
				nr_seq_contrato,
				nr_seq_tipo_servico,
				dt_atualizacao,
				nm_usuario,
				cd_pessoa_fisica,
				cd_codigo_convenio,
				dt_cancelamento,
				dt_inclusao,
				cd_pf_titular,
				dt_inclusao_sos,
				ie_possui_sos,
				dt_inclusao_transporte,
				dt_exclusao_transporte,
				cd_unisanta,
				ie_status_int)
			VALUES ( nr_seq_pf_contrato_w,
				coalesce(nr_seq_contrato_w,nr_sequencia_cont_w),
				11,

				clock_timestamp(),
				nm_usuario_p,
				cd_pessoa_fisica_w,
				cd_cod_convenio_compl_w,
				dt_exclusao_sos_p,
				clock_timestamp(),
				NULL,
				dt_inclusao_sos_p,
				ie_possui_sos_p,
				dt_inclusao_transp_p,
				dt_exclusao_transp_p,
				cd_unisanta_p,
				ie_status_p);

		END IF;

	ELSE 	IF (dt_exclusao_sos_p IS NOT NULL AND dt_exclusao_sos_p::text <> '') AND (ie_possui_sos_p = 'S') THEN

			UPDATE eme_pf_contrato
			SET	dt_atualizacao	 = clock_timestamp(),
				nm_usuario       = nm_usuario_p,
				dt_cancelamento  = dt_exclusao_sos_p
			WHERE 	nr_sequencia = nr_sequencia_cont_w;
		END IF;
		IF (dt_inclusao_transp_p IS NOT NULL AND dt_inclusao_transp_p::text <> '') or (dt_exclusao_transp_p IS NOT NULL AND dt_exclusao_transp_p::text <> '') then

			UPDATE 	eme_pf_contrato
			SET	dt_atualizacao	 	= clock_timestamp(),
				nm_usuario       	= nm_usuario_p,
				dt_inclusao_transporte  = coalesce(dt_inclusao_transp_p, dt_inclusao_transporte),
				dt_exclusao_transporte  = coalesce(dt_exclusao_transp_p, dt_exclusao_transporte),
				cd_unisanta		= cd_unisanta_p,
				ie_status_int	= ie_status_p
			WHERE 	nr_sequencia = nr_sequencia_cont_w;
		END IF;

	END IF;

	COMMIT;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE importa_arquivo_sgu_tasy_saph ( nm_usuario_p text, cd_estabelecimento_p text, singular_p text, cod_unimed_contrato_p text, cod_unimed_familia_p text, cod_unimed_dep_p text, cod_digito_verific_p text, nm_pessoa_fisica_p text, ie_sexo_p text, ie_estado_civil_p text, dt_nascimento_p timestamp, ie_tipo_cliente_p text, nr_cpf_p text, nm_plano_unimed_p text, ie_tipo_acom_integ_p text, ie_possui_sos_p text, dt_inclusao_sos_p text, dt_exclusao_sos_p text, dt_inclusao_transp_p text, dt_exclusao_transp_p text, ie_funcionario_p text, nr_ddd_celular_p text, nr_telefone_celular_p text, nm_contato_p text, nr_ddd_telefone_p text, nr_telefone_p text, ds_endereco_res_p text, ds_bairro_res_p text, cd_cep_res_p text, ds_municipio_res_p text, sg_estado_res_p text, ds_complemento_res_p text, nr_ddd_fone_res_p text, nr_telefone_res_p text, ds_endereco_com_p text, ds_bairro_com_p text, cd_cep_com_p text, ds_municipio_com_p text, sg_estado_com_p text, ds_complemento_com_p text, nr_ddd_fone_com_p text, nr_telefone_com_p text, nm_mae_p text, dt_atualizacao_integracao_p timestamp, cd_unisanta_p bigint, ie_status_p text, ie_nivel_dependencia_p text, ie_plano_regulamentado_p text ) FROM PUBLIC;

