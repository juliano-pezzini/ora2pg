-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_se_ha_exames_suspensos ( ds_lista_exames_p text, ie_exame_suspenso_p INOUT text) AS $body$
DECLARE


  dt_suspensao_w      varchar(16);
  ds_lista_w          varchar(255);
  tam_lista_w         bigint;
  qt_existe_virgula_w bigint;
  ie_pos_virgula_w    smallint;
  nr_seq_interno_w     bigint;


BEGIN
  ds_lista_w := ds_lista_exames_p;

  IF (ds_lista_w IS NOT NULL AND ds_lista_w::text <> '') THEN
    BEGIN
      WHILE(ds_lista_w IS NOT NULL AND ds_lista_w::text <> '') LOOP
        BEGIN
          SELECT position(',' in ds_lista_w)
          INTO STRICT qt_existe_virgula_w
;

          IF (qt_existe_virgula_w = 0) THEN
            ds_lista_w := ds_lista_w || ',';
          END IF;

          tam_lista_w := LENGTH(ds_lista_w);
          ie_pos_virgula_w := position(',' in ds_lista_w);

          IF (ie_pos_virgula_w  <> 0) THEN
            nr_seq_interno_w := (SUBSTR(ds_lista_w,1,(ie_pos_virgula_w - 1)))::numeric;
            ds_lista_w := SUBSTR(ds_lista_w,(ie_pos_virgula_w + 1),tam_lista_w);
          END IF;

          SELECT a.dt_suspensao
          INTO STRICT dt_suspensao_w
          FROM prescr_procedimento a
          WHERE nr_seq_interno = nr_seq_interno_w;

          IF (dt_suspensao_w IS NOT NULL AND dt_suspensao_w::text <> '')THEN
            EXIT;
          END IF;

        END;
      END LOOP;
    END;

    IF (dt_suspensao_w IS NOT NULL AND dt_suspensao_w::text <> '')THEN
      ie_exame_suspenso_p := 'S';
    ELSE
      ie_exame_suspenso_p := 'N';
    END IF;

  END IF;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_se_ha_exames_suspensos ( ds_lista_exames_p text, ie_exame_suspenso_p INOUT text) FROM PUBLIC;

