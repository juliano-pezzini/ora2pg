-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copiar_param_funcao ( cd_funcao_orig_p bigint, nr_seq_orig_p bigint, cd_funcao_dest_p bigint, nr_seq_dest_p bigint) AS $body$
DECLARE


cd_perfil_w		perfil.cd_perfil%type;
dt_atualizacao_w		timestamp;
nm_usuario_w		usuario.nm_usuario%type;
dt_atualizacao_nrec_w	timestamp;
nm_usuario_nrec_w		usuario.nm_usuario%type;
vl_parametro_w		funcao_param_perfil.vl_parametro%type;
ds_observacao_w		funcao_param_perfil.ds_observacao%type;
cd_estabelecimento_w	estabelecimento.cd_estabelecimento%type;
nr_seq_interno_w		bigint;
nm_usuario_param_w	usuario.nm_usuario%type;
ie_tipo_w			varchar(1);

c01 CURSOR FOR
SELECT	'E' ie_tipo,
	cd_estabelecimento,
	null cd_perfil,
	null nm_usuario_param,
	vl_parametro,
	ds_observacao,
	nr_sequencia nr_seq_interno,
	dt_atualizacao,
	nm_usuario,
	dt_atualizacao_nrec,
	nm_usuario_nrec
from	funcao_param_estab
where	cd_funcao = cd_funcao_orig_p
and	nr_seq_param = nr_seq_orig_p

union all

select	'P' ie_tipo,
	cd_estabelecimento,
	cd_perfil,
	null nm_usuario_param,
	vl_parametro,
	ds_observacao,
	nr_seq_interno,
	dt_atualizacao,
	nm_usuario,
	null dt_atualizacao_nrec,
	null nm_usuario_nrec
from	funcao_param_perfil
where	cd_funcao = cd_funcao_orig_p
and	nr_sequencia = nr_seq_orig_p

union all

select	'U' ie_tipo,
	null cd_estabelecimento,
	null cd_perfil,
	nm_usuario_param,
	vl_parametro,
	ds_observacao,
	nr_seq_interno,
	dt_atualizacao,
	nm_usuario,
	null dt_atualizacao_nrec,
	null nm_usuario_nrec
from	funcao_param_usuario
where	cd_funcao = cd_funcao_orig_p
and	nr_sequencia = nr_seq_orig_p;


BEGIN

begin
select	vl_parametro
into STRICT	vl_parametro_w
from	funcao_parametro
where	cd_funcao = cd_funcao_orig_p
and	nr_sequencia = nr_seq_orig_p;

update	funcao_parametro
set	vl_parametro = vl_parametro_w
where	cd_funcao = cd_funcao_dest_p
and	nr_sequencia = nr_seq_dest_p;
exception
when others then
	null;
end;

delete	FROM funcao_param_estab
where	cd_funcao = cd_funcao_dest_p
and	nr_seq_param = nr_seq_dest_p;

delete	FROM funcao_param_perfil
where	cd_funcao = cd_funcao_dest_p
and	nr_sequencia = nr_seq_dest_p;

delete	FROM funcao_param_usuario
where	cd_funcao = cd_funcao_dest_p
and	nr_sequencia = nr_seq_dest_p;

open c01;
loop
fetch c01 into
	ie_tipo_w,
	cd_estabelecimento_w,
	cd_perfil_w,
	nm_usuario_param_w,
	vl_parametro_w,
	ds_observacao_w,
	nr_seq_interno_w,
	dt_atualizacao_w,
	nm_usuario_w,
	dt_atualizacao_nrec_w,
	nm_usuario_nrec_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin
	if (ie_tipo_w = 'E') then
		begin
		insert into funcao_param_estab(
			cd_funcao,
			nr_seq_param,
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			vl_parametro,
			ds_observacao,
			cd_estabelecimento)
		values (	cd_funcao_dest_p,
			nr_seq_dest_p,
			nextval('funcao_param_estab_seq'),
			dt_atualizacao_w,
			nm_usuario_w,
			dt_atualizacao_nrec_w,
			nm_usuario_nrec_w,
			vl_parametro_w,
			ds_observacao_w,
			cd_estabelecimento_w);
		end;
	elsif (ie_tipo_w = 'P') then
		begin
		insert into funcao_param_perfil(
			cd_funcao,
			nr_sequencia,
			cd_perfil,
			dt_atualizacao,
			nm_usuario,
			vl_parametro,
			ds_observacao,
			cd_estabelecimento)
		values (	cd_funcao_dest_p,
			nr_seq_dest_p,
			cd_perfil_w,
			dt_atualizacao_w,
			nm_usuario_w,
			vl_parametro_w,
			ds_observacao_w,
			cd_estabelecimento_w);
		end;
	elsif (ie_tipo_w = 'U') then
		begin
		insert into funcao_param_usuario(
			cd_funcao,
			nr_sequencia,
			nm_usuario_param,
			dt_atualizacao,
			nm_usuario,
			vl_parametro,
			ds_observacao)
		values (	cd_funcao_dest_p,
			nr_seq_dest_p,
			nm_usuario_param_w,
			dt_atualizacao_w,
			nm_usuario_w,
			vl_parametro_w,
			ds_observacao_w);
		end;
	end if;
	end;
end loop;
close c01;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copiar_param_funcao ( cd_funcao_orig_p bigint, nr_seq_orig_p bigint, cd_funcao_dest_p bigint, nr_seq_dest_p bigint) FROM PUBLIC;

