-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE alterar_coluna_inventario ( nr_sequencia_p bigint, ie_coluna_p text, nm_usuario_p text) AS $body$
DECLARE


ds_descricao_w		varchar(255);
ie_contagem_atual_w	varchar(15);
qt_max_definir_w	inventario.qt_max_definir%type;


BEGIN

select	ie_contagem_atual,
		qt_max_definir
into STRICT	ie_contagem_atual_w,
		qt_max_definir_w
from	inventario
where	nr_sequencia	= nr_sequencia_p;

if (ie_coluna_p <= qt_max_definir_w) then
	update	inventario
	set	ie_contagem_atual	= ie_coluna_p
	where	nr_sequencia	= nr_sequencia_p;

	ds_descricao_w	:= WHEB_MENSAGEM_PCK.get_texto(819375, 'IE_CONTAGEM_ATUAL=' || ie_contagem_atual_w || ';IE_CONTAGEM_ALTERACAO=' || ie_coluna_p);
	/* 'Alterado da coluna #@IE_CONTAGEM_ATUAL#@ para a coluna #@IE_CONTAGEM_ALTERACAO#@'  */

	insert into inventario_arq(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_inventario,
		ds_arquivo,
		ds_conteudo,
		ie_envio_retorno)
	values (	nextval('inventario_arq_seq'),
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		nr_sequencia_p,
		WHEB_MENSAGEM_PCK.get_texto(819376), /*'Log de alteracao da coluna contagem'*/
		WHEB_MENSAGEM_PCK.get_texto(819377)  /*'Efetuada a troca da coluna de contagem'*/
 || chr(13) || chr(10) || ds_descricao_w,
		'R');

	commit;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE alterar_coluna_inventario ( nr_sequencia_p bigint, ie_coluna_p text, nm_usuario_p text) FROM PUBLIC;

