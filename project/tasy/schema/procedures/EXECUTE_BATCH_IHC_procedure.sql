-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE execute_batch_ihc ( nr_seq_protocolo_p conta_paciente.nr_seq_protocolo%type, ie_validate_p text, nm_usuario_p conta_paciente.nm_usuario%type ) AS $body$
DECLARE



c1 CURSOR FOR
SELECT   a.nr_interno_conta
from     conta_paciente a
where    a.nr_seq_protocolo   = nr_seq_protocolo_p
order by a.nr_atendimento;
c1_w c1%rowtype;

qt_inconsistencies_w eclipse_inco_account.nr_sequencia%type;


BEGIN


  open c1;
  loop
  fetch c1 into c1_w;
  EXIT WHEN NOT FOUND; /* apply on c1 */
    CALL get_ihc_claim(c1_w.nr_interno_conta, 
                  obter_estabelecimento_ativo(), 
                  nm_usuario_p,
                  ie_validate_p);
  end loop;
  close c1;

  select  count(a.nr_sequencia) qt_inconsistencies
  into STRICT    qt_inconsistencies_w
  from    eclipse_inco_account a,
          conta_paciente b
  where   a.nr_interno_conta = b.nr_interno_conta
  and     b.nr_seq_protocolo = nr_seq_protocolo_p;

  if (qt_inconsistencies_w > 0) then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(1106787, 'QT_INCONSISTENCIA=' || qt_inconsistencies_w);
  end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE execute_batch_ihc ( nr_seq_protocolo_p conta_paciente.nr_seq_protocolo%type, ie_validate_p text, nm_usuario_p conta_paciente.nm_usuario%type ) FROM PUBLIC;

