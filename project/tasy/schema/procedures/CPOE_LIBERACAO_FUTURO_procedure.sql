-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cpoe_liberacao_futuro ( itens_liberar_p text, nm_usuario_p usuario.nm_usuario%type ) AS $body$
DECLARE


nr_seq_reg_item_w		cpoe_dieta.nr_sequencia%type;
ie_opcao_prescr_ww		varchar(2000);
item_w					varchar(255);
ie_opcao_prescr_w		varchar(255);


BEGIN

	ie_opcao_prescr_ww := itens_liberar_p;

	while(ie_opcao_prescr_ww IS NOT NULL AND ie_opcao_prescr_ww::text <> '') loop
		if (position(';' in ie_opcao_prescr_ww) = 0) and (ie_opcao_prescr_ww IS NOT NULL AND ie_opcao_prescr_ww::text <> '') then
			ie_opcao_prescr_ww := ie_opcao_prescr_ww || ';';
		end if;

		item_w := substr(ie_opcao_prescr_ww, 1, position(';' in ie_opcao_prescr_ww) - 1);
		ie_opcao_prescr_w := substr(item_w, 1, position(',' in item_w) - 1);
		nr_seq_reg_item_w := (substr(item_w, position(',' in item_w) + 1, length(item_w)))::numeric;
		ie_opcao_prescr_ww := substr(ie_opcao_prescr_ww, position(';' in ie_opcao_prescr_ww) + 1, length(ie_opcao_prescr_ww));

		if (ie_opcao_prescr_w IS NOT NULL AND ie_opcao_prescr_w::text <> '') then
			case ie_opcao_prescr_w
				when 'MA' then -- Material
				begin
					update	cpoe_material
					set		dt_liberacao_fut = clock_timestamp(),
							nm_usuario_lib_fut = nm_usuario_p
					where	nr_sequencia = nr_seq_reg_item_w;
				end;
				when 'M' then -- Medicine
				begin
					update	cpoe_material
					set		dt_liberacao_fut = clock_timestamp(),
							nm_usuario_lib_fut = nm_usuario_p
					where	nr_sequencia = nr_seq_reg_item_w;
				end;
				when 'N' then -- Nutrition
				begin
					update	cpoe_dieta
					set		dt_liberacao_fut = clock_timestamp(),
							nm_usuario_lib_fut = nm_usuario_p
					where	nr_sequencia = nr_seq_reg_item_w;
				end;
				when 'P' then -- Procedure
				begin
					update	cpoe_procedimento
					set		dt_liberacao_fut = clock_timestamp(),
							nm_usuario_lib_fut = nm_usuario_p
					where	nr_sequencia = nr_seq_reg_item_w;
				end;
				when 'G' then -- Gasotherapy
				begin
					update	cpoe_gasoterapia
					set		dt_liberacao_fut = clock_timestamp(),
							nm_usuario_lib_fut = nm_usuario_p
					where	nr_sequencia = nr_seq_reg_item_w;
				end;
				when 'R' then -- Recommendation
				begin
					update	cpoe_recomendacao
					set		dt_liberacao_fut = clock_timestamp(),
							nm_usuario_lib_fut = nm_usuario_p
					where	nr_sequencia = nr_seq_reg_item_w;
				end;
				when 'H' then -- Hemotherapy
				begin
					update	cpoe_hemoterapia
					set		dt_liberacao_fut = clock_timestamp(),
							nm_usuario_lib_fut = nm_usuario_p
					where	nr_sequencia = nr_seq_reg_item_w;
				end;
				when 'DI' then -- Dialysis
				begin
					update	cpoe_dialise
					set		dt_liberacao_fut = clock_timestamp(),
							nm_usuario_lib_fut = nm_usuario_p
					where	nr_sequencia = nr_seq_reg_item_w;
				end;
				when 'AP' then -- Anatomical Pathology
				begin
					update	cpoe_anatomia_patologica
					set		dt_liberacao_fut = clock_timestamp(),
							nm_usuario_lib_fut = nm_usuario_p
					where	nr_sequencia = nr_seq_reg_item_w;
				end;
			end case;
		end if;
	end loop;

	commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_liberacao_futuro ( itens_liberar_p text, nm_usuario_p usuario.nm_usuario%type ) FROM PUBLIC;

