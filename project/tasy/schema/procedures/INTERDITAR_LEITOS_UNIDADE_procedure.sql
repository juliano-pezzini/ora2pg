-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE interditar_leitos_unidade ( cd_unidade_basica_p text, cd_unidade_compl_p text, cd_setor_atendimento_p bigint, nr_seq_superior_p bigint, nm_usuario_p text ) AS $body$
DECLARE

 
cd_motivo_w		bigint;
nr_seq_interno_w	bigint;


BEGIN 
 
begin 
select	max(cd_motivo) 
into STRICT	cd_motivo_w 
from	motivo_interdicao_leito 
where	ie_ajuste_acomodacao	=	'S';
exception 
when others then 
	cd_motivo_w	:= null;
end;
 
update	unidade_atendimento 
set	ie_status_unidade	=	'I', 
	cd_motivo_interdicao	=	cd_motivo_w, 
	dt_atualizacao		=	clock_timestamp(), 
	nm_usuario		=	nm_usuario_p, 
	nr_seq_superior		=	nr_seq_superior_p 
where	cd_unidade_basica	=	cd_unidade_basica_p 
and	cd_unidade_compl	=	cd_unidade_compl_p 
and	cd_setor_atendimento	=	cd_setor_atendimento_p;
 
select	max(nr_seq_interno) 
into STRICT	nr_seq_interno_w 
from	unidade_atendimento 
where	cd_unidade_basica	=	cd_unidade_basica_p 
and	cd_unidade_compl	=	cd_unidade_compl_p 
and	cd_setor_atendimento	=	cd_setor_atendimento_p;
 
if (nr_seq_interno_w > 0) then 
	CALL gerar_higienizacao_leito_unid(clock_timestamp(),nm_usuario_p,null,'IL',nr_seq_interno_w,null);
end if;
 
if (coalesce(wheb_usuario_pck.get_ie_commit, 'S') = 'S') then commit; end if;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE interditar_leitos_unidade ( cd_unidade_basica_p text, cd_unidade_compl_p text, cd_setor_atendimento_p bigint, nr_seq_superior_p bigint, nm_usuario_p text ) FROM PUBLIC;

