-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE excluir_itens_auditoria ( nr_sequencia_p bigint, ie_tipo_p text) AS $body$
DECLARE



/* IE_TIPO_P
	'M' - Material
	'P' - Procedimento
*/
nr_seq_auditoria_w		bigint;
nr_seq_matpaci_w		bigint;
nr_seq_propaci_w		bigint;
ie_repasse_gerado_w		varchar(10);
ie_pacote_w				varchar(1);


BEGIN

if (ie_tipo_p 	= 'M') then
	select	nr_seq_auditoria,
			nr_seq_matpaci
	into STRICT	nr_seq_auditoria_w,
			nr_seq_matpaci_w
	from	auditoria_matpaci
	where	nr_sequencia	=  nr_sequencia_p;

	ie_repasse_gerado_w	:= substr(obter_se_proc_mat_repasse(nr_seq_matpaci_w,'M'),1,1);

	if (ie_repasse_gerado_w	= 'N') then
		ie_pacote_w	:= obter_se_item_pacote(nr_seq_matpaci_w,2);

		if (ie_pacote_w = 'S') then
			CALL Wheb_mensagem_pck.exibir_mensagem_abort(167833,null);
		end if;

		delete	from auditoria_matpaci
		where	nr_sequencia = nr_sequencia_p;

		CALL Excluir_matproc_auditoria(nr_seq_matpaci_w,ie_tipo_p,nr_seq_auditoria_w);
	end if;
elsif (ie_tipo_p 	= 'P') then
	select	nr_seq_auditoria,
			nr_seq_propaci
	into STRICT	nr_seq_auditoria_w,
			nr_seq_propaci_w
	from	auditoria_propaci
	where	nr_sequencia	=  nr_sequencia_p;

	ie_repasse_gerado_w	:= substr(obter_se_proc_mat_repasse(nr_seq_propaci_w,'P'),1,1);

	if (ie_repasse_gerado_w	= 'N') then
		ie_pacote_w	:= obter_se_item_pacote(nr_seq_propaci_w,1);

		if (ie_pacote_w = 'S') then
			CALL Wheb_mensagem_pck.exibir_mensagem_abort(167838,null);
		end if;

		delete	from auditoria_propaci
		where	nr_sequencia = nr_sequencia_p;

		CALL Excluir_matproc_auditoria(nr_seq_propaci_w,ie_tipo_p,nr_seq_auditoria_w);
	end if;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE excluir_itens_auditoria ( nr_sequencia_p bigint, ie_tipo_p text) FROM PUBLIC;

