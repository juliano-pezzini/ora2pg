-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_ajustar_psf_pessoa_fisica () AS $body$
DECLARE


qt_registro_w	bigint;


BEGIN

if (clock_timestamp() < to_date('31/01/2007','dd/mm/yyyy')) then
	/* micro área */

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name	= 'PSF_PESSOA_FISICA'
	and	column_name	= 'CD_MICRO_AREA';

	if (qt_registro_w > 0) then
		begin
		CALL exec_sql_dinamico('Rafael', 'alter table psf_pessoa_fisica drop column CD_MICRO_AREA'); /* atributo */
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_cons_columns
	where	constraint_name = 'PSFPESFI_PSFMAREA_FK'
	and	column_name	= 'CD_MICRO_AREA';

	if (qt_registro_w > 0) then
		begin
		CALL exec_sql_dinamico('Rafael', 'alter table psf_pessoa_fisica drop constraint PSFPESFI_PSFMAREA_FK'); /* integridade */
		CALL exec_sql_dinamico('Rafael', 'drop index PSFPESFI_PSFMAREA_FK_I'); /* índice */
		end;
	end if;

	/* área */

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name	= 'PSF_PESSOA_FISICA'
	and	column_name	= 'CD_AREA';

	if (qt_registro_w > 0) then
		begin
		CALL exec_sql_dinamico('Rafael', 'alter table psf_pessoa_fisica drop column CD_AREA'); /* atributo */
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_cons_columns
	where	constraint_name = 'PSFPESFI_PSFAREA_FK'
	and	column_name	= 'CD_AREA';

	if (qt_registro_w > 0) then
		begin
		CALL exec_sql_dinamico('Rafael', 'alter table psf_pessoa_fisica drop constraint PSFPESFI_PSFAREA_FK'); /* integridade */
		CALL exec_sql_dinamico('Rafael', 'drop index PSFPESFI_PSFAREA_FK_I'); /* índice */
		end;
	end if;

	/* tabelas cadastros gerais */

	/* pessoa família - recriar integridade referencial */

	select	count(*)
	into STRICT	qt_registro_w
	from	user_cons_columns
	where	constraint_name = 'PSFPESFI_PSFFAMILIA_FK'
	and	column_name	= 'CD_FAMILIA';

	if (qt_registro_w > 0) then
		begin
		CALL exec_sql_dinamico('Rafael', 'alter table psf_pessoa_fisica drop constraint PSFPESFI_PSFFAMILIA_FK'); /* integridade */
		CALL exec_sql_dinamico('Rafael', 'drop index PSFPESFI_PSFFAMILIA_FK_I'); /* índice */
		end;
	end if;

	/* família - recriar primary key */

	CALL exec_sql_dinamico('Rafael', 'alter table psf_familia drop constraint PSFFAMILIA_PK'); /* primary key */
	/* família - recriar integridade referencial */

	select	count(*)
	into STRICT	qt_registro_w
	from	user_cons_columns
	where	constraint_name = 'PSFFAMILIA_PSFMAREA_FK'
	and	column_name	= 'CD_MICRO_AREA';

	if (qt_registro_w > 0) then
		begin
		CALL exec_sql_dinamico('Rafael', 'alter table psf_familia drop constraint PSFFAMILIA_PSFMAREA_FK'); /* integridade */
		CALL exec_sql_dinamico('Rafael', 'drop index PSFFAMILIA_PSFMAREA_FK_I'); /* índice */
		end;
	end if;

	/* micro área - recriar primary key */

	CALL exec_sql_dinamico('Rafael', 'alter table psf_micro_area drop constraint PSFMAREA_PK'); /* primary key */
	/* micro área - recriar integridade referencial */

	select	count(*)
	into STRICT	qt_registro_w
	from	user_cons_columns
	where	constraint_name = 'PSFMAREA_PSFAREA_FK'
	and	column_name	= 'CD_AREA';

	if (qt_registro_w > 0) then
		begin
		CALL exec_sql_dinamico('Rafael', 'alter table psf_micro_area drop constraint PSFMAREA_PSFAREA_FK'); /* integridade */
		CALL exec_sql_dinamico('Rafael', 'drop index PSFMAREA_PSFAREA_FK_I'); /* índice */
		end;
	end if;

	/* área - recriar primary key */

	CALL exec_sql_dinamico('Rafael', 'alter table psf_area drop constraint PSFAREA_PK'); /* primary key */
	/* recriar primary keys */

	CALL exec_sql_dinamico('Rafael',	' ALTER TABLE PSF_FAMILIA ADD ( ' ||
					' CONSTRAINT PSFFAMILIA_PK Primary Key ( NR_SEQUENCIA ) ' ||
					' USING INDEX Tablespace TASY_INDEX) '); /* família */
	CALL exec_sql_dinamico('Rafael',	' ALTER TABLE PSF_MICRO_AREA ADD ( ' ||
					' CONSTRAINT PSFMAREA_PK Primary Key ( NR_SEQUENCIA ) ' ||
					' USING INDEX Tablespace TASY_INDEX) '); /* micro área */
	CALL exec_sql_dinamico('Rafael',	' ALTER TABLE PSF_AREA ADD ( ' ||
					' CONSTRAINT PSFAREA_PK Primary Key ( NR_SEQUENCIA ) ' ||
					' USING INDEX Tablespace TASY_INDEX) '); /* área */
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_ajustar_psf_pessoa_fisica () FROM PUBLIC;

