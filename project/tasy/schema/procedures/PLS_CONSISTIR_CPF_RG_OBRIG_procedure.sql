-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_consistir_cpf_rg_obrig ( nr_cpf_p text, nr_identidade_p text, cd_nacionalidade_p text, qt_idade_pf_p bigint, ds_erro_p INOUT text, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE


qt_idade_minima_w		bigint;
ie_consiste_doc_obrig_w		varchar(10);
ie_brasileiro_w			varchar(10) := 'N';
ds_erro_w			varchar(255);


BEGIN

if (cd_nacionalidade_p IS NOT NULL AND cd_nacionalidade_p::text <> '') then
	select	max(ie_brasileiro)
	into STRICT	ie_brasileiro_w
	from	nacionalidade
	where	cd_nacionalidade	= cd_nacionalidade_p;
end if;

qt_idade_minima_w	:= coalesce(obter_valor_param_usuario(1220, 29, Obter_Perfil_Ativo, nm_usuario_p, cd_estabelecimento_p), 999);
ie_consiste_doc_obrig_w	:= coalesce(obter_valor_param_usuario(1220, 30, Obter_Perfil_Ativo, nm_usuario_p, cd_estabelecimento_p),'C');
if (ie_brasileiro_w	= 'S') then
	if (qt_idade_minima_w <> 999) then
		if (qt_idade_pf_p >= qt_idade_minima_w) then
			if (ie_consiste_doc_obrig_w = 'C') or (ie_consiste_doc_obrig_w = 'A') then
				if (coalesce(trim(both nr_cpf_p)::text, '') = '') then
					ds_erro_w	:= wheb_mensagem_pck.get_texto(280492, 'QT_IDADE_MINIMA_P=' || qt_idade_minima_w);
				end if;
			end if;
			if (ie_consiste_doc_obrig_w = 'R') or (ie_consiste_doc_obrig_w = 'A') then
				if (coalesce(trim(both nr_identidade_p)::text, '') = '') then
					ds_erro_w	:= wheb_mensagem_pck.get_texto(280493, 'QT_IDADE_MINIMA_P=' || qt_idade_minima_w);
				end if;
			end if;
			if (ie_consiste_doc_obrig_w = 'O') then
				if (coalesce(trim(both nr_identidade_p)::text, '') = '') and (coalesce(trim(both nr_cpf_p)::text, '') = '') then
					ds_erro_w	:= wheb_mensagem_pck.get_texto(280494, 'QT_IDADE_MINIMA_P=' || qt_idade_minima_w);
				end if;
			end if;
		end if;
	end if;
end if;

ds_erro_p	:= ds_erro_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_consistir_cpf_rg_obrig ( nr_cpf_p text, nr_identidade_p text, cd_nacionalidade_p text, qt_idade_pf_p bigint, ds_erro_p INOUT text, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

