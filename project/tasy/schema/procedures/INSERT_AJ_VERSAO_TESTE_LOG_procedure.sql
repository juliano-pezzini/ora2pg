-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_aj_versao_teste_log (nm_usuario_p text, nr_seq_aj_versao_p bigint) AS $body$
DECLARE


  i RECORD;

BEGIN

for i in (select	CASE WHEN ie_severidade='G' THEN obter_desc_expressao(724031) WHEN ie_severidade='A' THEN obter_desc_expressao(283347) END  ds_tipo,
	obter_valor_dominio(8988,ie_tipo) ds_problema,
	a.nm_tabela,
	a.ds_valor, 
	a.nm_tabela_sup,
	a.ds_valor_sup
from	ajuste_versao_inconsist a
where	a.nr_seq_ajuste_versao = nr_seq_aj_versao_p
order by	CASE WHEN ie_severidade='G' THEN 0  ELSE 1 END , ds_problema, nm_tabela) 
Loop


  insert into AJUSTE_VERSAO_TESTE_LOG(
    nr_sequencia,
    dt_atualizacao,
    nm_usuario, 
    nr_seq_ajuste_versao,
    ds_tipo,
    ds_problema,
    nm_tabela, 
    ds_valor,
    nm_tabela_sup
  )
  values (
    nextval('ajuste_versao_teste_log_seq'),
    clock_timestamp(), 
    nm_usuario_p,
    nr_seq_aj_versao_p,
    i.ds_tipo,
    i.ds_problema,
    i.nm_tabela,
    i.ds_valor,
    i.nm_tabela_sup
  );
    commit;
  end loop;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_aj_versao_teste_log (nm_usuario_p text, nr_seq_aj_versao_p bigint) FROM PUBLIC;

