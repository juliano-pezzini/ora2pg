-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE nicu_insert_clinical_rule ( NM_USUARIO_P text, DT_ATUALIZACAO_P timestamp, IE_CATEGORY_P text, IE_APP_P text, ID_RULE_P text, IE_RULE_TYPE_P text, CD_SNOMED_OUT_P text, DS_LABEL_P text, QT_DATA_LOAD_P bigint, IE_DATA_LOAD_TYPE_P text, CD_UOFM_SNM_P text, DS_UOFM_LABEL_P text, DS_OUTBOUND_DATA_VALUE_P text, CD_BODY_SYSTEM_SNM_P text, IE_BODY_SYSTEM_P text, CD_CARD_COLUMN_SNM_P text, IE_CARD_COLUMN_P text, CD_BODY_SUB_SNM_P text, DS_BODY_SUB_P text, NR_SEQ_ORDEM_P text, CD_PANEL_SNM_P text, DS_PANEL_LABEL_P text, CD_TOOLTIP_SNM_P text, DS_TOOLTIP_P text, CD_SNOMED_IN_P text, DS_TRIGGER_LABEL_P text, CD_SNOMED_UOFM_IN_P text, DS_UOFM_IN_P text, IE_SOURCE_P text, DS_OBX_SNM_MAP_P text, DS_LABEL_IN_P text, ID_AGING_TYPE_P bigint, ID_DECIMATION_TYPE_P bigint) AS $body$
DECLARE

			      
CD_EXISTE     bigint;


BEGIN
	
   	SELECT coalesce(MAX(1), 0) INTO STRICT CD_EXISTE FROM NICU_CLINICAL_RULE WHERE ID_RULE = ID_RULE_P;

    IF (CD_EXISTE = 0) THEN
        	INSERT INTO NICU_CLINICAL_RULE(
	            NR_SEQUENCIA,  
	            NM_USUARIO,
	            DT_ATUALIZACAO,
              NM_USUARIO_NREC,
	            DT_ATUALIZACAO_NREC,
	            IE_CATEGORY,
	            IE_APP,
	            ID_RULE,
	            IE_RULE_TYPE,
	            CD_SNOMED_OUT,
	            DS_LABEL,
	            QT_DATA_LOAD,
	            IE_DATA_LOAD_TYPE,
	            CD_UOFM_SNM,
	            DS_UOFM_LABEL,
	            DS_OUTBOUND_DATA_VALUE,
	            CD_BODY_SYSTEM_SNM,
	            IE_BODY_SYSTEM,
	            CD_CARD_COLUMN_SNM,
	            IE_CARD_COLUMN,
	            CD_BODY_SUB_SNM,
	            DS_BODY_SUB,
	            NR_SEQ_ORDEM,
	            CD_PANEL_SNM,
	            DS_PANEL_LABEL,
	            CD_TOOLTIP_SNM,
	            DS_TOOLTIP,
	            CD_SNOMED_IN,
	            DS_TRIGGER_LABEL,
	            CD_SNOMED_UOFM_IN,
	            DS_UOFM_IN,
	            IE_SOURCE,
	            DS_OBX_SNM_MAP,
	            DS_LABEL_IN,
	            ID_AGING_TYPE ,
	            ID_DECIMATION_TYPE           
        	) VALUES (
        		nextval('nicu_clinical_rule_seq'),
	            NM_USUARIO_P,
	            DT_ATUALIZACAO_P,
              NM_USUARIO_P,
	            DT_ATUALIZACAO_P,
	            IE_CATEGORY_P,
	            IE_APP_P,
	            ID_RULE_P,
	            IE_RULE_TYPE_P,
	            CD_SNOMED_OUT_P,
	            DS_LABEL_P,
	            QT_DATA_LOAD_P,
	            IE_DATA_LOAD_TYPE_P,
	            CD_UOFM_SNM_P,
	            DS_UOFM_LABEL_P,
	            DS_OUTBOUND_DATA_VALUE_P,
	            CD_BODY_SYSTEM_SNM_P,
	            IE_BODY_SYSTEM_P,
	            CD_CARD_COLUMN_SNM_P,
	            IE_CARD_COLUMN_P,
	            CD_BODY_SUB_SNM_P,
	            DS_BODY_SUB_P,
	            NR_SEQ_ORDEM_P,
	            CD_PANEL_SNM_P,
	            DS_PANEL_LABEL_P,
	            CD_TOOLTIP_SNM_P,
	            DS_TOOLTIP_P,
	            CD_SNOMED_IN_P,
	            DS_TRIGGER_LABEL_P,
	            CD_SNOMED_UOFM_IN_P,
	            DS_UOFM_IN_P,
	            IE_SOURCE_P,
	            DS_OBX_SNM_MAP_P,
	            DS_LABEL_IN_P,
	            ID_AGING_TYPE_P,
	            ID_DECIMATION_TYPE_P  
        	);
			CALL NICU_INSERT_CLINICAl_ATTRIBUTE(ID_RULE_P,NM_USUARIO_P);
			CALL NICU_INSERT_CLINICAl_PARAMETER(ID_RULE_P,NM_USUARIO_P);
    ELSE
        	UPDATE NICU_CLINICAL_RULE SET
              NM_USUARIO = NM_USUARIO_P,
	            DT_ATUALIZACAO = DT_ATUALIZACAO_P,
	            IE_CATEGORY =  IE_CATEGORY_P,
	            IE_APP = IE_APP_P,
	            IE_RULE_TYPE = IE_RULE_TYPE_P,
	            CD_SNOMED_OUT = CD_SNOMED_OUT_P,
              DS_LABEL = DS_LABEL_P,
	            QT_DATA_LOAD = QT_DATA_LOAD_P,
	            IE_DATA_LOAD_TYPE = IE_DATA_LOAD_TYPE_P,
	            CD_UOFM_SNM = CD_UOFM_SNM_P,
	            DS_UOFM_LABEL =  DS_UOFM_LABEL_P,
	            DS_OUTBOUND_DATA_VALUE = DS_OUTBOUND_DATA_VALUE_P,
	            CD_BODY_SYSTEM_SNM = CD_BODY_SYSTEM_SNM_P,
	            IE_BODY_SYSTEM = IE_BODY_SYSTEM_P,
	            CD_CARD_COLUMN_SNM = CD_CARD_COLUMN_SNM_P,
	            IE_CARD_COLUMN = IE_CARD_COLUMN_P,
	            CD_BODY_SUB_SNM = CD_BODY_SUB_SNM_P,
	            DS_BODY_SUB = DS_BODY_SUB_P,
	            NR_SEQ_ORDEM = NR_SEQ_ORDEM_P,
	            CD_PANEL_SNM = CD_PANEL_SNM_P,
	            DS_PANEL_LABEL = DS_PANEL_LABEL_P,
	            CD_TOOLTIP_SNM = CD_TOOLTIP_SNM_P,
	            DS_TOOLTIP = DS_TOOLTIP_P,
	            CD_SNOMED_IN = CD_SNOMED_IN_P,
	            DS_TRIGGER_LABEL = DS_TRIGGER_LABEL_P ,
              CD_SNOMED_UOFM_IN = CD_SNOMED_UOFM_IN_P,
	            DS_UOFM_IN = DS_UOFM_IN_P,
	            IE_SOURCE = IE_SOURCE_P,
	            DS_OBX_SNM_MAP = DS_OBX_SNM_MAP_P,
	            DS_LABEL_IN = DS_LABEL_IN_P,
	            ID_AGING_TYPE = ID_AGING_TYPE_P,
	            ID_DECIMATION_TYPE = ID_DECIMATION_TYPE_P
        	WHERE ID_RULE = ID_RULE_P;
    END IF;
COMMIT;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE nicu_insert_clinical_rule ( NM_USUARIO_P text, DT_ATUALIZACAO_P timestamp, IE_CATEGORY_P text, IE_APP_P text, ID_RULE_P text, IE_RULE_TYPE_P text, CD_SNOMED_OUT_P text, DS_LABEL_P text, QT_DATA_LOAD_P bigint, IE_DATA_LOAD_TYPE_P text, CD_UOFM_SNM_P text, DS_UOFM_LABEL_P text, DS_OUTBOUND_DATA_VALUE_P text, CD_BODY_SYSTEM_SNM_P text, IE_BODY_SYSTEM_P text, CD_CARD_COLUMN_SNM_P text, IE_CARD_COLUMN_P text, CD_BODY_SUB_SNM_P text, DS_BODY_SUB_P text, NR_SEQ_ORDEM_P text, CD_PANEL_SNM_P text, DS_PANEL_LABEL_P text, CD_TOOLTIP_SNM_P text, DS_TOOLTIP_P text, CD_SNOMED_IN_P text, DS_TRIGGER_LABEL_P text, CD_SNOMED_UOFM_IN_P text, DS_UOFM_IN_P text, IE_SOURCE_P text, DS_OBX_SNM_MAP_P text, DS_LABEL_IN_P text, ID_AGING_TYPE_P bigint, ID_DECIMATION_TYPE_P bigint) FROM PUBLIC;

