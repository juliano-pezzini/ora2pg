-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copiar_compl_pf (cd_pessoa_origem_p text, cd_pessoa_destino_p text, ie_tipo_complemento_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
qt_compl_w		bigint;
nr_sequencia_w	bigint;


BEGIN 
if (cd_pessoa_origem_p IS NOT NULL AND cd_pessoa_origem_p::text <> '') and (cd_pessoa_destino_p IS NOT NULL AND cd_pessoa_destino_p::text <> '') and (cd_pessoa_origem_p	<> cd_pessoa_destino_p) then 
	select	coalesce(count(*),0) 
	into STRICT	qt_compl_w 
	from	compl_pessoa_fisica 
	where	cd_pessoa_fisica	= cd_pessoa_origem_p 
	and	ie_tipo_complemento	= ie_tipo_complemento_p;
 
	if (coalesce(qt_compl_w,0) > 0) then 
		select	coalesce(max(nr_sequencia),0) + 1 
		into STRICT 	nr_sequencia_w 
		from 	compl_pessoa_fisica 
		where 	cd_pessoa_fisica = cd_pessoa_destino_p;
 
		insert into compl_pessoa_fisica( 
							cd_pessoa_fisica, 
							nr_sequencia,	 
							ie_tipo_complemento, 
							dt_atualizacao, 
							nm_usuario, 
							nm_contato, 
							cd_cep, 
							ds_endereco, 
							ds_complemento, 
							nr_endereco, 
							ds_bairro, 
							ds_municipio, 
							cd_municipio_ibge, 
							sg_estado, 
							nr_telefone, 
							nr_ramal, 
							ds_fone_adic, 
							ds_fax, 
							ds_observacao) 
							(SELECT	cd_pessoa_destino_p, 
									nr_sequencia_w, 
									b.ie_tipo_complemento, 
									clock_timestamp(), 
									nm_usuario_p, 
									substr(obter_nome_pf(cd_pessoa_origem_p),1,150),	 
									b.cd_cep,	 
									b.ds_endereco, 
									b.ds_complemento, 
									b.nr_endereco, 
									b.ds_bairro, 
									b.ds_municipio, 
									b.cd_municipio_ibge, 
									b.sg_estado, 
									b.nr_telefone, 
									b.nr_ramal, 
									b.ds_fone_adic, 
									b.ds_fax, 
									b.ds_observacao 
							from		compl_pessoa_fisica b 
							where		b.cd_pessoa_fisica		= cd_pessoa_origem_p 
							and		b.ie_tipo_complemento	= ie_tipo_complemento_p);
	end if;
end if;
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copiar_compl_pf (cd_pessoa_origem_p text, cd_pessoa_destino_p text, ie_tipo_complemento_p bigint, nm_usuario_p text) FROM PUBLIC;

