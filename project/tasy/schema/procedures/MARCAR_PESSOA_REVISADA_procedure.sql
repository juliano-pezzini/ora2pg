-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE marcar_pessoa_revisada ( cd_pessoa_destino_p text, dt_acerto_p timestamp, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [ X ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
-------------------------------------------------------------------------------------------------------------------
Referências:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
BEGIN
update	pessoa_fisica
set	ie_revisar		= 'U'
where	cd_pessoa_fisica	= cd_pessoa_destino_p;

update  tasy_log_alteracao
set 	ds_descricao		= substr(CASE WHEN ds_descricao = NULL THEN wheb_mensagem_pck.get_texto(451002) || ' ' || wheb_mensagem_pck.get_texto(793114) || ' ' || obter_nome_usuario(nm_usuario)  ELSE wheb_mensagem_pck.get_texto(451002) ||  ' ' || wheb_mensagem_pck.get_texto(793114) || ' '  || obter_nome_usuario(nm_usuario) || ' - ' || ds_descricao END ,1,255)
where 	nm_tabela		= 'PESSOA_FISICA'
and 	ds_chave_simples	= cd_pessoa_destino_p
and 	dt_atualizacao between dt_acerto_p and clock_timestamp();

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE marcar_pessoa_revisada ( cd_pessoa_destino_p text, dt_acerto_p timestamp, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

