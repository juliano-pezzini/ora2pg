-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cpoe_rep_gerar_mat_assoc_gas ( nr_prescricao_p bigint, nr_atendimento_p bigint, nr_seq_gasoterapia_p bigint, nr_seq_gas_cpoe_p bigint) AS $body$
DECLARE



cd_material_w			prescr_material.cd_material%type;
qt_dose_w				prescr_material.qt_dose%type;
cd_unidade_medida_w		prescr_material.cd_unidade_medida%type;
qt_mat_gas_w			integer;

c01 CURSOR FOR
SELECT	cd_material,
		qt_dose,
		cd_unidade_medida
from	prescr_material
where 	nr_prescricao = nr_prescricao_p
and		nr_seq_gasoterapia = nr_seq_gasoterapia_p
and		ie_agrupador = 15  LIMIT 3;

BEGIN

qt_mat_gas_w := 1;

open c01;
loop
fetch c01 into	cd_material_w,
				qt_dose_w,
				cd_unidade_medida_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin
	case qt_mat_gas_w
		when 1 then
			begin
			update	cpoe_gasoterapia
			set		cd_mat_equip1 		= cd_material_w,
					cd_unid_med_dose1	= cd_unidade_medida_w,
					qt_dose_mat1		= qt_dose_w
			where	nr_sequencia		= nr_seq_gas_cpoe_p
			and		nr_atendimento		= nr_atendimento_p;
			end;
		when 2 then
			begin
			update	cpoe_gasoterapia
			set		cd_mat_equip2 		= cd_material_w,
					cd_unid_med_dose2	= cd_unidade_medida_w,
					qt_dose_mat2		= qt_dose_w
			where	nr_sequencia		= nr_seq_gas_cpoe_p
			and		nr_atendimento		= nr_atendimento_p;
			end;
		when 3 then
			begin
			update	cpoe_gasoterapia
			set		cd_mat_equip3 		= cd_material_w,
					cd_unid_med_dose3	= cd_unidade_medida_w,
					qt_dose_mat3		= qt_dose_w
			where	nr_sequencia		= nr_seq_gas_cpoe_p
			and		nr_atendimento		= nr_atendimento_p;
			end;
		else
			begin
			return;
			end;
	end case;

	qt_mat_gas_w	:= qt_mat_gas_w+1;
	end;
end loop;
close c01;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_rep_gerar_mat_assoc_gas ( nr_prescricao_p bigint, nr_atendimento_p bigint, nr_seq_gasoterapia_p bigint, nr_seq_gas_cpoe_p bigint) FROM PUBLIC;

