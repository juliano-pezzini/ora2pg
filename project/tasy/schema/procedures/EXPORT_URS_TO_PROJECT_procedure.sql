-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE export_urs_to_project ( NR_SEQ_PROJ_P bigint, NR_SEQ_CRS_P bigint, NM_USUARIO_P text, NR_SEQ_REG_CUSTOMER INOUT bigint) AS $body$
DECLARE


  w_urs_nm_curto      REG_CUSTOMER_REQUIREMENT.NM_CURTO%TYPE;
  w_nr_seq_des_req    DES_REQUISITO.NR_SEQUENCIA%TYPE;


BEGIN

  BEGIN
    SELECT nextval('des_requisito_seq') INTO STRICT W_NR_SEQ_DES_REQ;

    SELECT nm_curto INTO STRICT w_urs_nm_curto FROM REG_CUSTOMER_REQUIREMENT WHERE nr_sequencia = NR_SEQ_CRS_P;

  EXCEPTION
    WHEN Others THEN
      NULL;
  END;


  BEGIN

    INSERT INTO DES_REQUISITO(
                                nr_sequencia,
                                nr_seq_projeto, 
                                ds_titulo, 
                                cd_analista, 
                                dt_requisito, 
                                dt_atualizacao, 
                                nm_usuario, 
                                dt_atualizacao_nrec, 
                                nm_usuario_nrec, 
                                ie_cliente_wheb, 
                                nr_seq_apresentacao, 
                                dt_aprovacao, 
                                nr_seq_ordem_serv, 
                                ie_relatorio, 
                                nr_seq_cr, 
                                ie_risco 
                              )
                                VALUES (
                              w_nr_seq_des_req,--nr_sequencia, 
                              nr_seq_proj_p,--nr_seq_projeto, 
                              w_urs_nm_curto ,--ds_titulo, 
                              OBTER_PESSOA_FISICA_USUARIO(NM_USUARIO_P, 'C') ,--cd_analista, 
                              clock_timestamp(),--dt_requisito, 
                              clock_timestamp(),--dt_atualizacao, 
                              NM_USUARIO_P,--nm_usuario, 
                              clock_timestamp(),--dt_atualizacao_nrec, 
                              NM_USUARIO_P,--nm_usuario_nrec, 
                              'C',--ie_cliente_wheb, 
                              100,--nr_seq_apresentacao, 
                              NULL,--dt_aprovacao, 
                              NULL,--nr_seq_ordem_serv, 
                              'S',--ie_relatorio, 
                              NR_SEQ_CRS_P,--nr_seq_cr, 
                              NULL --ie_risco
                              );
  EXCEPTION
    WHEN Others THEN
      NULL;
  END;
  NR_SEQ_REG_CUSTOMER := W_NR_SEQ_DES_REQ;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE export_urs_to_project ( NR_SEQ_PROJ_P bigint, NR_SEQ_CRS_P bigint, NM_USUARIO_P text, NR_SEQ_REG_CUSTOMER INOUT bigint) FROM PUBLIC;

