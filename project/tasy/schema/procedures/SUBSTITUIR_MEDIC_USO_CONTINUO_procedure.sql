-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE substituir_medic_uso_continuo (cd_pessoa_fisica_p text, ie_uso_continuo_p text, ie_laudo_lme_p text, cd_cid_principal_p text, cd_cid_secundario_p text, cd_intervalo_p text, ie_via_aplicacao_p text, cd_material_p bigint, qt_dose_p bigint, cd_unidade_medida_p text, nr_dias_uso_p bigint, nr_seq_motivo_p bigint, nr_seq_medic_ant_p bigint, dt_inicio_p timestamp, nm_usuario_p text) AS $body$
BEGIN
if (nr_seq_motivo_p = 0) then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(198078);
elsif (cd_material_p = 0) then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(198079);
elsif (qt_dose_p = 0) then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(198080);
elsif (coalesce(cd_intervalo_p::text, '') = '') then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(198081);
elsif (coalesce(cd_unidade_medida_p::text, '') = '') then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(198082);
else
	insert into medic_uso_continuo(
					nr_sequencia,
					dt_atualizacao,
					nm_usuario,
					dt_atualizacao_nrec,
					nm_usuario_nrec,
					cd_pessoa_fisica,
					dt_inicio,
					cd_material,
					qt_dose,
					cd_unidade_medida,
					nr_dias_uso,
					ie_uso_continuo,
					ie_laudo_lme,
					cd_cid_principal,
					cd_cid_secundario,
					cd_intervalo,
					ie_via_aplicacao,
					ds_observacao,
					nr_seq_medic_subst)
				values (nextval('medic_uso_continuo_seq'),
					clock_timestamp(),
					nm_usuario_p,
					clock_timestamp(),
					nm_usuario_p,
					cd_pessoa_fisica_p,
					dt_inicio_p,
					cd_material_p,
					qt_dose_p,
					cd_unidade_medida_p,
					CASE WHEN nr_dias_uso_p=0 THEN null  ELSE nr_dias_uso_p END ,
					ie_uso_continuo_p,
					ie_laudo_lme_p,
					cd_cid_principal_p,
					cd_cid_secundario_p,
					cd_intervalo_p,
					ie_via_aplicacao_p,
					-- Medicamento substitu√≠do em
					wheb_mensagem_pck.get_texto(455790) || PKG_DATE_FORMATERS.to_varchar(clock_timestamp(), 'shortDate', WHEB_USUARIO_PCK.GET_CD_ESTABELECIMENTO, nm_usuario_p),
					nr_seq_medic_ant_p);

	update	medic_uso_continuo
	set	dt_suspensao		= clock_timestamp(),
		nm_usuario_susp 	= nm_usuario_p,
		nr_seq_motivo_susp	= nr_seq_motivo_p,
		dt_atualizacao		= clock_timestamp()
	where	nr_sequencia		= nr_seq_medic_ant_p;

	commit;

end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE substituir_medic_uso_continuo (cd_pessoa_fisica_p text, ie_uso_continuo_p text, ie_laudo_lme_p text, cd_cid_principal_p text, cd_cid_secundario_p text, cd_intervalo_p text, ie_via_aplicacao_p text, cd_material_p bigint, qt_dose_p bigint, cd_unidade_medida_p text, nr_dias_uso_p bigint, nr_seq_motivo_p bigint, nr_seq_medic_ant_p bigint, dt_inicio_p timestamp, nm_usuario_p text) FROM PUBLIC;

