-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_calculos_advisory ( nr_seq_calculo_p bigint, nm_usuario_p text, cd_pessoa_fisica_p text, nr_atendimento_p bigint ) AS $body$
DECLARE


 ie_situacao_w varchar(1):= 'A';
 ie_exibe_alerta_w varchar(1);
 ds_titulo_w calculos_advisory.ds_titulo%type;
 ds_alerta_w calculos_advisory.ds_alerta%type;
 ie_advisory_severity_w calculos_advisory.ie_advisory_severity%type;

c01 CURSOR FOR
  SELECT IE_EXIBE_ALERTA, 
  ds_titulo,
  ds_alerta,
  ie_advisory_severity 
  from CALCULOS_ENGINE_ADVISORY 
  where nr_seq_calculo = nr_seq_calculo_p;

  
BEGIN
  
open C01;

loop

fetch C01 into	
  ie_exibe_alerta_w,
  ds_titulo_w,
  ds_alerta_w,
  ie_advisory_severity_w;

EXIT WHEN NOT FOUND; /* apply on C01 */

	begin	

	insert into
    calculos_advisory(
    nr_sequencia, 
    nr_seq_calculo, 
    dt_atualizacao_nrec, 
    nm_usuario_nrec, 
    cd_pessoa_fisica, 
    nr_atendimento, 
    ds_titulo, 
    ds_alerta, 
    ie_advisory_severity, 
    ie_situacao,
    ie_exibe_alerta
  )  
  values (
    nextval('calculos_advisory_seq'), 
    nr_seq_calculo_p, 
    clock_timestamp(), 
    nm_usuario_p, 
    cd_pessoa_fisica_p, 
    nr_atendimento_p, 
    ds_titulo_w, 
    ds_alerta_w, 
    ie_advisory_severity_w, 
    ie_situacao_w,
    ie_exibe_alerta_w
  );
	end;

end loop;
close C01;	
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_calculos_advisory ( nr_seq_calculo_p bigint, nm_usuario_p text, cd_pessoa_fisica_p text, nr_atendimento_p bigint ) FROM PUBLIC;

