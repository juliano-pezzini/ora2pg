-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_baca_gerar_dados_rn405 () AS $body$
DECLARE


cd_estabelecimento_w			estabelecimento.cd_estabelecimento%type := pls_obter_cd_estab_ops;
nr_seq_atrib_qualif_prest_w		pls_instituicao_acred.nr_seq_atrib_qualif_prest%type;
nr_seq_instituicao_acred_w		pls_instituicao_acred.nr_sequencia%type;
qt_registro_w				integer;

c01 CURSOR FOR
	SELECT	nr_seq_prestador,
		nr_sequencia,
		ie_acreditacao,
		ie_nivel_acred_ona,
		dt_fim_vigencia
	from	pls_prestador_qualif
	where	coalesce(nr_seq_instituicao_acred::text, '') = ''
	and	(ie_acreditacao IS NOT NULL AND ie_acreditacao::text <> '');

BEGIN
select	count(1)
into STRICT	qt_registro_w
from	pls_atrib_qualif_prest;

if (qt_registro_w = 0) then

	begin
	insert into PLS_ATRIB_QUALIF_PREST(NR_SEQUENCIA, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, IE_ATRIB_QUALIF, DS_ATRIB_QUALIF, DT_INICIO_VIGENCIA, DT_FIM_VIGENCIA, DS_OBSERVACAO, IE_CADASTRO)
	values (2, to_date('15-10-2016 11:18:58', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', to_date('15-10-2016 10:40:40', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', 'A', 'Programa de acreditação', to_date('15-10-2016', 'dd-mm-yyyy'), null, 'Certificado de Acreditação emitido pelas Entidades Acreditadoras de Serviços de Saúde ou pelo INMETRO', 'S');
	exception
	when others then
		null;
	end;

	begin
	insert into PLS_ATRIB_QUALIF_PREST(NR_SEQUENCIA, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, IE_ATRIB_QUALIF, DS_ATRIB_QUALIF, DT_INICIO_VIGENCIA, DT_FIM_VIGENCIA, DS_OBSERVACAO, IE_CADASTRO)
	values (3, to_date('15-10-2016 11:19:12', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', to_date('15-10-2016 10:41:06', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', 'G', 'Certificações de Entidades Gestoras de Outros Programas de Qualidade', to_date('15-10-2016', 'dd-mm-yyyy'), null, 'Certificado ou documento equivalente emitido pelas Entidades Gestoras de Outros Programas de Qualidade', 'S');
	exception
	when others then
		null;
	end;

	begin
	insert into PLS_ATRIB_QUALIF_PREST(NR_SEQUENCIA, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, IE_ATRIB_QUALIF, DS_ATRIB_QUALIF, DT_INICIO_VIGENCIA, DT_FIM_VIGENCIA, DS_OBSERVACAO, IE_CADASTRO)
	values (4, to_date('15-10-2016 11:19:14', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', to_date('15-10-2016 10:41:46', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', 'I', 'Certificação ISO9001', to_date('15-10-2016', 'dd-mm-yyyy'), null, 'Certificado ABNT NBR ISO 9001 - Sistema de Gestão de Qualidade, emitido por organismo de certificação acreditado pelo INMETRO, quando abranger a totalidade do escopo dos serviços de saúde prestados', 'S');
	exception
	when others then
		null;
	end;

	begin
	insert into PLS_ATRIB_QUALIF_PREST(NR_SEQUENCIA, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, IE_ATRIB_QUALIF, DS_ATRIB_QUALIF, DT_INICIO_VIGENCIA, DT_FIM_VIGENCIA, DS_OBSERVACAO, IE_CADASTRO)
	values (5, to_date('15-10-2016 11:19:15', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', to_date('15-10-2016 10:42:26', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', 'N', 'Comunicação de eventos adversos', to_date('15-10-2016', 'dd-mm-yyyy'), null, 'Participação no Sistema de Notificação de Eventos Adversos - Notivisa/ANVISA', 'N');
	exception
	when others then
		null;
	end;

	begin
	insert into PLS_ATRIB_QUALIF_PREST(NR_SEQUENCIA, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, IE_ATRIB_QUALIF, DS_ATRIB_QUALIF, DT_INICIO_VIGENCIA, DT_FIM_VIGENCIA, DS_OBSERVACAO, IE_CADASTRO)
	values (6, to_date('15-10-2016 11:19:17', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', to_date('15-10-2016 10:43:21', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', 'P', 'Profissional com especialização', to_date('15-10-2016', 'dd-mm-yyyy'), null, 'Pósgraduação com no mínimo 360 h (trezentos e sessenta horas) reconhecida pelo Ministério da Educação MEC, exceto para profissionais médicos', 'N');
	exception
	when others then
		null;
	end;

	begin
	insert into PLS_ATRIB_QUALIF_PREST(NR_SEQUENCIA, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, IE_ATRIB_QUALIF, DS_ATRIB_QUALIF, DT_INICIO_VIGENCIA, DT_FIM_VIGENCIA, DS_OBSERVACAO, IE_CADASTRO)
	values (7, to_date('15-10-2016 11:19:18', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', to_date('15-10-2016 10:43:48', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', 'R', 'Profissional com residência', to_date('15-10-2016', 'dd-mm-yyyy'), null, 'Residência em saúde reconhecida pelo MEC', 'N');
	exception
	when others then
		null;
	end;

	begin
	insert into PLS_ATRIB_QUALIF_PREST(NR_SEQUENCIA, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, IE_ATRIB_QUALIF, DS_ATRIB_QUALIF, DT_INICIO_VIGENCIA, DT_FIM_VIGENCIA, DS_OBSERVACAO, IE_CADASTRO)
	values (8, to_date('15-10-2016 11:19:20', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', to_date('15-10-2016 10:44:03', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', 'E', 'Título de Especialista', to_date('15-10-2016', 'dd-mm-yyyy'), null, 'Título de especialista outorgado pela sociedade de especialidade e/ou Conselho Profissional da categoria', 'N');
	exception
	when others then
		null;
	end;

	begin
	insert into PLS_ATRIB_QUALIF_PREST(NR_SEQUENCIA, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, IE_ATRIB_QUALIF, DS_ATRIB_QUALIF, DT_INICIO_VIGENCIA, DT_FIM_VIGENCIA, DS_OBSERVACAO, IE_CADASTRO)
	values (9, to_date('15-10-2016 11:19:29', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', to_date('15-10-2016 10:44:31', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', 'Q', 'Qualidade monitorada', to_date('15-10-2016', 'dd-mm-yyyy'), null, 'Certificado de Qualidade Monitorada obtido no Programa de Monitoramento de Indicadores da Qualidade de Prestadores de Serviços de Saúde - PMQUALISS, emitido pelas Entidades Colaboradoras', 'N');
	exception
	when others then
		null;
	end;

	begin
	insert into PLS_ATRIB_QUALIF_PREST(NR_SEQUENCIA, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, IE_ATRIB_QUALIF, DS_ATRIB_QUALIF, DT_INICIO_VIGENCIA, DT_FIM_VIGENCIA, DS_OBSERVACAO, IE_CADASTRO)
	values (10, to_date('15-10-2016 11:19:31', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', to_date('15-10-2016 10:44:48', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', 'D', 'Profissional com Doutorado ou PósDoutorado', to_date('15-10-2016', 'dd-mm-yyyy'), null, 'Doutorado ou Pósdoutorado em saúde reconhecido pelo MEC', 'N');
	exception
	when others then
		null;
	end;
end if;

select	max(nr_sequencia)
into STRICT	nr_seq_atrib_qualif_prest_w
from	pls_atrib_qualif_prest
where	ie_atrib_qualif	= 'A';

if (nr_seq_atrib_qualif_prest_w IS NOT NULL AND nr_seq_atrib_qualif_prest_w::text <> '') then

	begin
	insert into PLS_INSTITUICAO_ACRED(NR_SEQUENCIA, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, DS_INSTITUICAO_ACRED, DT_INICIO_VIGENCIA, DT_FIM_VIGENCIA, NR_SEQ_ATRIB_QUALIF_PREST, CD_ESTABELECIMENTO)
	values (1, to_date('15-10-2016 11:32:12', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', to_date('15-10-2016 11:32:05', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', 'Consórcio Brasileiro de Acreditação (CBA)', to_date('01-01-2017', 'dd-mm-yyyy'), null, nr_seq_atrib_qualif_prest_w, cd_estabelecimento_w);
	exception
	when others then
		null;
	end;

	begin
	insert into PLS_INSTITUICAO_ACRED(NR_SEQUENCIA, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, DS_INSTITUICAO_ACRED, DT_INICIO_VIGENCIA, DT_FIM_VIGENCIA, NR_SEQ_ATRIB_QUALIF_PREST, CD_ESTABELECIMENTO)
	values (2, to_date('15-10-2016 11:32:29', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', to_date('15-10-2016 11:32:23', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', 'Instituto Qualisa de Gestão (IQG) Nível 1', to_date('01-01-2017', 'dd-mm-yyyy'), null, nr_seq_atrib_qualif_prest_w, cd_estabelecimento_w);
	exception
	when others then
		null;
	end;

	begin
	insert into PLS_INSTITUICAO_ACRED(NR_SEQUENCIA, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, DS_INSTITUICAO_ACRED, DT_INICIO_VIGENCIA, DT_FIM_VIGENCIA, NR_SEQ_ATRIB_QUALIF_PREST, CD_ESTABELECIMENTO)
	values (3, to_date('15-10-2016 11:32:46', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', to_date('15-10-2016 11:32:41', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', 'Instituto Qualisa de Gestão (IQG) Nível 2 ', to_date('01-01-2017', 'dd-mm-yyyy'), null, nr_seq_atrib_qualif_prest_w, cd_estabelecimento_w);
	exception
	when others then
		null;
	end;

	begin
	insert into PLS_INSTITUICAO_ACRED(NR_SEQUENCIA, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, DS_INSTITUICAO_ACRED, DT_INICIO_VIGENCIA, DT_FIM_VIGENCIA, NR_SEQ_ATRIB_QUALIF_PREST, CD_ESTABELECIMENTO)
	values (4, to_date('15-10-2016 11:33:12', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', to_date('15-10-2016 11:33:06', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', 'Instituto Qualisa de Gestão (IQG) Nível 3', to_date('01-01-2017', 'dd-mm-yyyy'), null, nr_seq_atrib_qualif_prest_w, cd_estabelecimento_w);
	exception
	when others then
		null;
	end;

	begin
	insert into PLS_INSTITUICAO_ACRED(NR_SEQUENCIA, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, DS_INSTITUICAO_ACRED, DT_INICIO_VIGENCIA, DT_FIM_VIGENCIA, NR_SEQ_ATRIB_QUALIF_PREST, CD_ESTABELECIMENTO)
	values (5, to_date('15-10-2016 11:33:23', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', to_date('15-10-2016 11:33:18', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', 'Organização Nacional de Acreditação (ONA) Nível 1', to_date('01-01-2017', 'dd-mm-yyyy'), null, nr_seq_atrib_qualif_prest_w, cd_estabelecimento_w);
	exception
	when others then
		null;
	end;

	begin
	insert into PLS_INSTITUICAO_ACRED(NR_SEQUENCIA, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, DS_INSTITUICAO_ACRED, DT_INICIO_VIGENCIA, DT_FIM_VIGENCIA, NR_SEQ_ATRIB_QUALIF_PREST, CD_ESTABELECIMENTO)
	values (6, to_date('15-10-2016 11:33:36', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', to_date('15-10-2016 11:33:30', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', 'Organização Nacional de Acreditação (ONA) Nível 2', to_date('01-01-2017', 'dd-mm-yyyy'), null, nr_seq_atrib_qualif_prest_w, cd_estabelecimento_w);
	exception
	when others then
		null;
	end;

	begin
	insert into PLS_INSTITUICAO_ACRED(NR_SEQUENCIA, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, DS_INSTITUICAO_ACRED, DT_INICIO_VIGENCIA, DT_FIM_VIGENCIA, NR_SEQ_ATRIB_QUALIF_PREST, CD_ESTABELECIMENTO)
	values (7, to_date('15-10-2016 11:34:02', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', to_date('15-10-2016 11:33:57', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', 'Organização Nacional de Acreditação (ONA) Nível 3', to_date('01-01-2017', 'dd-mm-yyyy'), null, nr_seq_atrib_qualif_prest_w, cd_estabelecimento_w);
	exception
	when others then
		null;
	end;

	begin
	insert into PLS_INSTITUICAO_ACRED(NR_SEQUENCIA, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, DS_INSTITUICAO_ACRED, DT_INICIO_VIGENCIA, DT_FIM_VIGENCIA, NR_SEQ_ATRIB_QUALIF_PREST, CD_ESTABELECIMENTO)
	values (8, to_date('15-10-2016 11:34:15', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', to_date('15-10-2016 11:34:10', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', 'Programa de Acreditação de Laboratórios Clínicos (APALC)', to_date('01-01-2017', 'dd-mm-yyyy'), null, nr_seq_atrib_qualif_prest_w, cd_estabelecimento_w);
	exception
	when others then
		null;
	end;

	begin
	insert into PLS_INSTITUICAO_ACRED(NR_SEQUENCIA, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, DS_INSTITUICAO_ACRED, DT_INICIO_VIGENCIA, DT_FIM_VIGENCIA, NR_SEQ_ATRIB_QUALIF_PREST, CD_ESTABELECIMENTO)
	values (9, to_date('15-10-2016 11:34:26', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', to_date('15-10-2016 11:34:21', 'dd-mm-yyyy hh24:mi:ss'), 'wcbernardino', 'Sistema Nacional de Acreditação (DICQ)', to_date('01-01-2017', 'dd-mm-yyyy'), null, nr_seq_atrib_qualif_prest_w, cd_estabelecimento_w);
	exception
	when others then
		null;
	end;

	begin
	insert into PLS_INSTITUICAO_ACRED(NR_SEQUENCIA,DT_INICIO_VIGENCIA,DT_FIM_VIGENCIA,DS_INSTITUICAO_ACRED,NR_SEQ_ATRIB_QUALIF_PREST,CD_ESTABELECIMENTO,DT_ATUALIZACAO,NM_USUARIO,DT_ATUALIZACAO_NREC,NM_USUARIO_NREC)
	values (10,TO_DATE('01/01/2017','dd/mm/yyyy'),null,'Instituto Qualisa de Gestão (IQG)',2,1,TO_DATE('22/10/2016 11:25:38','dd/mm/yyyy hh24:mi:ss'),'wcbernardino',TO_DATE('22/10/2016 11:25:24','dd/mm/yyyy hh24:mi:ss'),'wcbernardino');
	exception
	when others then
		null;
	end;

	begin
	insert into PLS_INSTITUICAO_ACRED(NR_SEQUENCIA,DT_INICIO_VIGENCIA,DT_FIM_VIGENCIA,DS_INSTITUICAO_ACRED,NR_SEQ_ATRIB_QUALIF_PREST,CD_ESTABELECIMENTO,DT_ATUALIZACAO,NM_USUARIO,DT_ATUALIZACAO_NREC,NM_USUARIO_NREC)
	values (11,TO_DATE('01/01/2017','dd/mm/yyyy'),null,'Organização Nacional de Acreditação (ONA)',2,1,TO_DATE('22/10/2016 11:25:51','dd/mm/yyyy hh24:mi:ss'),'wcbernardino',TO_DATE('22/10/2016 11:25:44','dd/mm/yyyy hh24:mi:ss'),'wcbernardino');
	exception
	when others then
		null;
	end;
end if;

for r_c01_w in c01 loop
	if (coalesce(r_c01_w.dt_fim_vigencia::text, '') = '') or (trunc(r_c01_w.dt_fim_vigencia) > to_date('01/01/2017')) then
		nr_seq_instituicao_acred_w := null;
		if (r_c01_w.ie_acreditacao = 'ACBA') then -- Acreditação: Consórcio Brasileiro de Acreditação (CBA)
			nr_seq_instituicao_acred_w := 1;

		elsif (r_c01_w.ie_acreditacao = 'AIQG') and (coalesce(r_c01_w.ie_nivel_acred_ona::text, '') = '') then -- Acreditação: Instituto Qualisa de Gestão (IQG)
			nr_seq_instituicao_acred_w := 10;

		elsif (r_c01_w.ie_acreditacao = 'AIQG') and (r_c01_w.ie_nivel_acred_ona = 1) then -- Acreditação: Instituto Qualisa de Gestão (IQG) Nível 1
			nr_seq_instituicao_acred_w := 2;

		elsif (r_c01_w.ie_acreditacao = 'AIQG') and (r_c01_w.ie_nivel_acred_ona = 2) then -- Acreditação: Instituto Qualisa de Gestão (IQG) Nível 2
			nr_seq_instituicao_acred_w := 3;

		elsif (r_c01_w.ie_acreditacao = 'AIQG') and (r_c01_w.ie_nivel_acred_ona = 3) then  -- Acreditação: Instituto Qualisa de Gestão (IQG) Nível 3
			nr_seq_instituicao_acred_w := 4;

		elsif (r_c01_w.ie_acreditacao = 'AONA') and (coalesce(r_c01_w.ie_nivel_acred_ona::text, '') = '') then -- Acreditação: Organização Nacional de Acreditação (ONA)
			nr_seq_instituicao_acred_w := 11;

		elsif (r_c01_w.ie_acreditacao = 'AONA') and (r_c01_w.ie_nivel_acred_ona = 1) then -- Acreditação: Organização Nacional de Acreditação (ONA) Nível 1
			nr_seq_instituicao_acred_w := 5;

		elsif (r_c01_w.ie_acreditacao = 'AONA') and (r_c01_w.ie_nivel_acred_ona = 2) then -- Acreditação: Organização Nacional de Acreditação (ONA) Nível 2
			nr_seq_instituicao_acred_w := 6;

		elsif (r_c01_w.ie_acreditacao = 'AONA') and (r_c01_w.ie_nivel_acred_ona = 3) then -- Acreditação: Organização Nacional de Acreditação (ONA) Nível 3
			nr_seq_instituicao_acred_w := 7;

		elsif (r_c01_w.ie_acreditacao = 'APALC') then -- Programa de Acreditação de Laboratórios Clínicos (APALC)
			nr_seq_instituicao_acred_w := 8;

		elsif (r_c01_w.ie_acreditacao = 'ADICQ') then -- Sistema Nacional de Acreditação (DICQ)
			nr_seq_instituicao_acred_w := 9;

		end if;

		update	pls_prestador_qualif
		set	dt_fim_vigencia	= to_date('31/12/2016')
		where	coalesce(dt_fim_vigencia::text, '') = ''
		and	nr_sequencia	= r_c01_w.nr_sequencia;

		if (nr_seq_instituicao_acred_w IS NOT NULL AND nr_seq_instituicao_acred_w::text <> '') then
			insert	into pls_prestador_qualif(nr_sequencia,
				dt_atualizacao,
				nm_usuario,
				dt_atualizacao_nrec,
				nm_usuario_nrec,
				nr_seq_prestador,
				ie_acreditacao,
				dt_inicio_vigencia,
				dt_fim_vigencia,
				ie_nivel_acred_ona,
				nr_seq_instituicao_acred)
			values (nextval('pls_prestador_qualif_seq'),
				clock_timestamp(),
				'TasyPLS',
				clock_timestamp(),
				'TasyPLS',
				r_c01_w.nr_seq_prestador,
				null,
				to_date('01/01/2017'),
				null,
				null,
				nr_seq_instituicao_acred_w);
		end if;
	end if;
end loop;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_baca_gerar_dados_rn405 () FROM PUBLIC;

