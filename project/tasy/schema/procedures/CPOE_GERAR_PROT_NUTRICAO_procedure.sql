-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cpoe_gerar_prot_nutricao ( cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, cd_perfil_p perfil.cd_perfil%type, nm_usuario_p usuario.nm_usuario%type, cd_protocolo_p protocolo.cd_protocolo%type, nr_seq_protocolo_p protocolo_medicacao.nr_sequencia%type, nr_seq_item_p bigint, nr_atendimento_p atendimento_paciente.nr_atendimento%type, ie_tipo_dieta_p text, cd_paciente_p cpoe_dieta.cd_pessoa_fisica%type, nr_seq_item_gerado_p INOUT cpoe_dieta.nr_sequencia%type, nr_seq_transcricao_p bigint default null, ie_item_alta_p text default 'N', ie_prescritor_aux_p text default 'N', cd_medico_p bigint default null, ie_retrogrado_p text default 'N', dt_inicio_p timestamp default null, nr_seq_pepo_p bigint default null, nr_cirurgia_p bigint default null, nr_cirurgia_patologia_p bigint default null, nr_seq_agenda_p bigint default null, nr_seq_conclusao_apae_p bigint default null, dt_fim_presc_p timestamp default null, dt_inicio_presc_p timestamp default null, ie_futuro_p text default 'N', nr_seq_cpoe_rp_p cpoe_rp.nr_sequencia%type default null, nr_seq_cpoe_order_unit_p cpoe_order_unit.nr_sequencia%type default null) AS $body$
BEGIN
if (ie_tipo_dieta_p = 'J') then
	nr_seq_item_gerado_p := CPOE_Gerar_prot_dieta_jejum(	cd_estabelecimento_p, cd_perfil_p, nm_usuario_p, cd_protocolo_p, nr_seq_protocolo_p, nr_seq_item_p, nr_atendimento_p, nr_seq_item_gerado_p, cd_paciente_p, null, ie_item_alta_p, ie_prescritor_aux_p, cd_medico_p, ie_retrogrado_p, dt_inicio_p, null, null, null, null, null, null, 'P', dt_fim_presc_p, dt_inicio_presc_p, ie_futuro_p, nr_seq_cpoe_rp_p, nr_seq_cpoe_order_unit_p);
elsif (ie_tipo_dieta_p = 'E') then
	nr_seq_item_gerado_p := CPOE_Gerar_prot_dieta_enteral(	cd_estabelecimento_p, cd_perfil_p, nm_usuario_p, cd_protocolo_p, nr_seq_protocolo_p, nr_seq_item_p, nr_atendimento_p, nr_seq_item_gerado_p, cd_paciente_p, null, ie_item_alta_p, ie_prescritor_aux_p, cd_medico_p, ie_retrogrado_p, dt_inicio_p, null, null, null, null, null, null, 'P', dt_fim_presc_p, dt_inicio_presc_p, ie_futuro_p, nr_seq_cpoe_rp_p, nr_seq_cpoe_order_unit_p);
elsif (ie_tipo_dieta_p = 'S') then
	nr_seq_item_gerado_p := CPOE_Gerar_prot_suplementar(	cd_estabelecimento_p, cd_perfil_p, nm_usuario_p, cd_protocolo_p, nr_seq_protocolo_p, nr_seq_item_p, nr_atendimento_p, nr_seq_item_gerado_p, cd_paciente_p, null, ie_item_alta_p, ie_prescritor_aux_p, cd_medico_p, ie_retrogrado_p, dt_inicio_p, null, null, null, null, null, null, 'P', dt_fim_presc_p, dt_inicio_presc_p, ie_futuro_p, nr_seq_cpoe_rp_p, nr_seq_cpoe_order_unit_p);
elsif (ie_tipo_dieta_p = 'O') then
	nr_seq_item_gerado_p := CPOE_Gerar_prot_dieta_oral(	cd_estabelecimento_p, cd_perfil_p, nm_usuario_p, cd_protocolo_p, nr_seq_protocolo_p, nr_seq_item_p, nr_atendimento_p, nr_seq_item_gerado_p, cd_paciente_p, null, ie_item_alta_p, ie_prescritor_aux_p, cd_medico_p, ie_retrogrado_p, dt_inicio_p, null, null, null, null, null, null, 'P', dt_fim_presc_p, dt_inicio_presc_p, ie_futuro_p, nr_seq_cpoe_rp_p, nr_seq_cpoe_order_unit_p);
elsif (ie_tipo_dieta_p = 'L') then
	nr_seq_item_gerado_p := cpoe_gerar_prot_dieta_leites(	cd_estabelecimento_p, cd_perfil_p, nm_usuario_p, cd_protocolo_p, nr_seq_protocolo_p, nr_seq_item_p, nr_atendimento_p, nr_seq_item_gerado_p, cd_paciente_p, null, ie_item_alta_p, ie_prescritor_aux_p, cd_medico_p, ie_retrogrado_p, dt_inicio_p, null, null, null, null, null, null, 'P', dt_fim_presc_p, dt_inicio_presc_p, ie_futuro_p, nr_seq_cpoe_rp_p, nr_seq_cpoe_order_unit_p);
end if;

if (ie_tipo_dieta_p IS NOT NULL AND ie_tipo_dieta_p::text <> '') and (coalesce(nr_seq_item_gerado_p,0) > 0)then
	
	update cpoe_dieta
	set nr_seq_transcricao 		= nr_seq_transcricao_p,
		nr_seq_pepo 			= nr_seq_pepo_p,
		nr_cirurgia 			= nr_cirurgia_p,
		nr_cirurgia_patologia	= nr_cirurgia_patologia_p,
		nr_seq_agenda 			= nr_seq_agenda_p,
		nr_seq_conclusao_apae 	= nr_seq_conclusao_apae_p,
		cd_protocolo			= cd_protocolo_p,
		nr_seq_protocolo_prescr = nr_seq_protocolo_p,
		nr_seq_cpoe_order_unit = nr_seq_cpoe_order_unit_p
	where nr_sequencia = nr_seq_item_gerado_p
	and nr_atendimento = nr_atendimento_p;
	
	commit;
	
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_gerar_prot_nutricao ( cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, cd_perfil_p perfil.cd_perfil%type, nm_usuario_p usuario.nm_usuario%type, cd_protocolo_p protocolo.cd_protocolo%type, nr_seq_protocolo_p protocolo_medicacao.nr_sequencia%type, nr_seq_item_p bigint, nr_atendimento_p atendimento_paciente.nr_atendimento%type, ie_tipo_dieta_p text, cd_paciente_p cpoe_dieta.cd_pessoa_fisica%type, nr_seq_item_gerado_p INOUT cpoe_dieta.nr_sequencia%type, nr_seq_transcricao_p bigint default null, ie_item_alta_p text default 'N', ie_prescritor_aux_p text default 'N', cd_medico_p bigint default null, ie_retrogrado_p text default 'N', dt_inicio_p timestamp default null, nr_seq_pepo_p bigint default null, nr_cirurgia_p bigint default null, nr_cirurgia_patologia_p bigint default null, nr_seq_agenda_p bigint default null, nr_seq_conclusao_apae_p bigint default null, dt_fim_presc_p timestamp default null, dt_inicio_presc_p timestamp default null, ie_futuro_p text default 'N', nr_seq_cpoe_rp_p cpoe_rp.nr_sequencia%type default null, nr_seq_cpoe_order_unit_p cpoe_order_unit.nr_sequencia%type default null) FROM PUBLIC;

