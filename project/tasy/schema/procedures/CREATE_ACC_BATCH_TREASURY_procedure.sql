-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE create_acc_batch_treasury ( cd_estabelecimento_p bigint, ds_classicacao_caixa_p text, nm_usuario_p text) AS $body$
DECLARE


					

		
nr_lote_contabil_w	bigint;
lista_w			lista_varchar_pck.tabela_varchar;
					

					
BEGIN

CALL wheb_usuario_pck.set_nm_usuario(nm_usuario_p);
CALL wheb_usuario_pck.set_cd_estabelecimento(cd_estabelecimento_p);
CALL philips_param_pck.set_nr_seq_idioma(9);

nr_lote_contabil_w	:= techone_pck.create_batch(	cd_estabelecimento_p,
							10,
							clock_timestamp(),
							nm_usuario_p);
							
if (nr_lote_contabil_w IS NOT NULL AND nr_lote_contabil_w::text <> '') then
					
					
	if (ds_classicacao_caixa_p IS NOT NULL AND ds_classicacao_caixa_p::text <> '') then
		lista_w := OBTER_LISTA_STRING2(ds_classicacao_caixa_p,',');
		
		if (lista_w IS NOT NULL AND lista_w::text <> '') then
		
			for	i in lista_w.first..lista_w.last loop						 						
			
				CALL techone_pck.insert_param_items(nr_lote_contabil_w,1,lista_w(i),nm_usuario_p);
				
			end loop;
		
		
		end if;
		
	end if;
					
	CALL techone_pck.Generate_batch(	nr_lote_contabil_w,
					nm_usuario_p,
					'N');		

	CALL techone_pck.send_integration(	nr_lote_contabil_w,
					nm_usuario_p);
	
end if;
	




commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE create_acc_batch_treasury ( cd_estabelecimento_p bigint, ds_classicacao_caixa_p text, nm_usuario_p text) FROM PUBLIC;

