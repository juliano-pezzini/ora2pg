-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE scheduler_move_to_now ( NR_SEQUENCIA_P bigint, RESP_P INOUT text ) AS $body$
DECLARE

	 ID_STATUS_W bigint;
	 exeption_w exception;


BEGIN
	select ID_STATUS into STRICT ID_STATUS_W
	from NICU_SCHEDULE_PATIENT 
	where NR_SEQUENCIA = NR_SEQUENCIA_P 
	order by NR_SEQUENCIA desc;	
	IF ID_STATUS_W <> 1 THEN
		UPDATE NICU_SCHEDULE_PATIENT SET DT_SCHEDULE = clock_timestamp(), ID_STATUS = '3' WHERE NR_SEQUENCIA = NR_SEQUENCIA_P;
		COMMIT;
		RESP_P := 'Successful';
	ELSE
		RESP_P := 'Failed';
	END IF;		

EXCEPTION
	when exeption_w then
		ROLLBACK;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE scheduler_move_to_now ( NR_SEQUENCIA_P bigint, RESP_P INOUT text ) FROM PUBLIC;

