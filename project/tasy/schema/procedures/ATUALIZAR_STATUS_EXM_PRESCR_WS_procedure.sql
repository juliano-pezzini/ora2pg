-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_status_exm_prescr_ws ( nr_acesso_dicom_p prescr_procedimento.nr_acesso_dicom%TYPE ) AS $body$
DECLARE


    nr_prescricao_w         prescr_procedimento.nr_prescricao%TYPE;
    nr_seq_prescricao_w     prescr_procedimento.nr_sequencia%TYPE;
    nm_usuario_w prescr_procedimento.nm_usuario%type;
    cd_estabelecimento_w prescr_medica.cd_estabelecimento%TYPE;

BEGIN
    BEGIN
        SELECT
            a.nr_prescricao,
            a.nr_sequencia,
            b.cd_estabelecimento
        INTO STRICT
            nr_prescricao_w,
            nr_seq_prescricao_w,
            cd_estabelecimento_w
        FROM
            prescr_procedimento   a,
            prescr_medica         b
        WHERE
            a.nr_acesso_dicom = nr_acesso_dicom_p
            AND a.nr_prescricao = b.nr_prescricao;

    EXCEPTION
        WHEN no_data_found THEN
            CALL wheb_mensagem_pck.exibir_mensagem_abort(192827, 'NR_ACESSO_DICOM_P=' || nr_acesso_dicom_p);
    END;

    select obter_desc_expressao(847019)
    into STRICT nm_usuario_w
;

    CALL atualizar_status_exame_prescr(nr_prescricao_w, nr_seq_prescricao_w, 'I', nm_usuario_w, cd_estabelecimento_w);
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_status_exm_prescr_ws ( nr_acesso_dicom_p prescr_procedimento.nr_acesso_dicom%TYPE ) FROM PUBLIC;

