-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE importar_cheque_cr (cd_banco_p bigint, cd_agencia_bancaria_p text, nm_usuario_p text, nr_conta_p text, nr_cheque_p text, vl_cheque_p bigint, dt_vencimento_p timestamp, cd_estabelecimento_p bigint, cd_pessoa_fisica_p text, cd_cgc_p text) AS $body$
DECLARE



nr_sequencia_w			bigint;
qt_reg_w			bigint;

ds_erro_w			varchar(255);

pr_taxa_juro_padrao_w		double precision	:= null;
pr_taxa_multa_padrao_w		double precision	:= null;
cd_tipo_taxa_juro_w		bigint	:= null;
cd_tipo_taxa_multa_w		bigint	:= null;


BEGIN

select 	count(*)
into STRICT	qt_reg_w
from 	cheque_cr
where 	cd_banco 		= cd_banco_p
and   	cd_agencia_bancaria 	= cd_agencia_bancaria_p
and   	nr_conta 		= nr_conta_p
and   	nr_cheque 		= nr_cheque_p;

if (qt_reg_w = 0) then
	begin
	select	max(pr_juro_padrao),
		max(pr_multa_padrao),
		max(cd_tipo_taxa_juro),
		max(cd_tipo_taxa_multa)
	into STRICT	pr_taxa_juro_padrao_w,
		pr_taxa_multa_padrao_w,
		cd_tipo_taxa_juro_w,
		cd_tipo_taxa_multa_w
	from	parametro_contas_receber
	where	cd_estabelecimento	= cd_estabelecimento_p;

	select 	nextval('cheque_cr_seq')
	into STRICT	nr_sequencia_w
	;

	insert into cheque_cr(cd_cgc,
		cd_pessoa_fisica,
		cd_banco,
		cd_agencia_bancaria,
		nr_conta,
		nr_cheque,
		vl_cheque,
		dt_vencimento,
		nr_seq_cheque,
		dt_atualizacao,
		nm_usuario,
		cd_moeda,
		vl_terceiro,
		dt_contabil,
		cd_estabelecimento,
		ie_lib_caixa,
		tx_juros_cobranca,
		tx_multa_cobranca,
		cd_tipo_taxa_juros,
		cd_tipo_taxa_multa)
	values (cd_cgc_p,
		cd_pessoa_fisica_p,
		cd_banco_p,
		cd_agencia_bancaria_p,
		nr_conta_p,
		nr_cheque_p,
		vl_cheque_p,
		dt_vencimento_p,
		nr_sequencia_w,
		clock_timestamp(),
		nm_usuario_p,
		1,
		0,
		clock_timestamp(),
		cd_estabelecimento_p,
		'S',
		pr_taxa_juro_padrao_w,
		pr_taxa_multa_padrao_w,
		cd_tipo_taxa_juro_w,
		cd_tipo_taxa_multa_w);
	exception when others then
		null;
		/*ds_erro_w		:= SQLERRM(sqlcode);
		insert into logxxx_tasy	(dt_atualizacao,
					nm_usuario,
					cd_log,
					ds_log)
			values		(sysdate,
					nm_usuario_p,
					55766,
					ds_erro_w);*/
	end;

/*else

	insert into logxxx_tasy	(dt_atualizacao,
				nm_usuario,
				cd_log,
				ds_log)
		values		(sysdate,
				nm_usuario_p,
				55766,
				'Já foi encontrado um cheque cadastrado com os mesmos dados!' 	|| chr(13) ||
				'Código banco: '	|| cd_banco_p 				|| chr(13) ||
				'Código agência: '	|| cd_agencia_bancaria_p 		|| chr(13) ||
				'Número conta: ' 	|| nr_conta_p				|| chr(13) ||
				'Número cheque: ' 	||nr_cheque_p);*/
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE importar_cheque_cr (cd_banco_p bigint, cd_agencia_bancaria_p text, nm_usuario_p text, nr_conta_p text, nr_cheque_p text, vl_cheque_p bigint, dt_vencimento_p timestamp, cd_estabelecimento_p bigint, cd_pessoa_fisica_p text, cd_cgc_p text) FROM PUBLIC;

