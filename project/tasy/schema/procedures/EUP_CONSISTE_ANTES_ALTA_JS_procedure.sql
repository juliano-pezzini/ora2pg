-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE eup_consiste_antes_alta_js ( cd_setor_usuario_p bigint, nr_atendimento_p bigint, nm_usuario_p text, ie_chamar_tit_rec_p INOUT text, nr_seq_interno_conta_p INOUT bigint) AS $body$
DECLARE

 
					 
ds_regra_alta_cpf_w			varchar(255);	
ie_consiste_cpf_pac_alta_w 		varchar(1);				
					 
					 

BEGIN 
 
 
ie_consiste_cpf_pac_alta_w := Obter_param_Usuario(916, 573, obter_perfil_ativo, nm_usuario_p, obter_estabelecimento_ativo, ie_consiste_cpf_pac_alta_w);
 
if ie_consiste_cpf_pac_alta_w = 'S' then 
	ds_regra_alta_cpf_w := consistir_regra_alta_CPF(nr_atendimento_p);
 
	if (ds_regra_alta_cpf_w IS NOT NULL AND ds_regra_alta_cpf_w::text <> '') then 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(183208, 'DS_ERRO_P='||ds_regra_alta_cpf_w);
	end if;
end if;
 
select 	coalesce(obter_se_gera_tit_rec(obter_Convenio_atendimento(a.nr_atendimento), a.cd_estabelecimento, a.ie_tipo_atendimento), 'N') 
into STRICT	ie_chamar_tit_rec_p 
from  atendimento_paciente a 
where 	a.nr_atendimento = nr_atendimento_p;
 
select coalesce(max(a.nr_interno_conta),0) 
into STRICT	nr_seq_interno_conta_p 
from  conta_paciente a 
where  a.nr_atendimento = nr_atendimento_p 
and   a.ie_status_acerto = 2;
 
 
CALL Saida_Setor_Servico(nr_atendimento_p, cd_setor_usuario_p, null, null, nm_usuario_p);
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eup_consiste_antes_alta_js ( cd_setor_usuario_p bigint, nr_atendimento_p bigint, nm_usuario_p text, ie_chamar_tit_rec_p INOUT text, nr_seq_interno_conta_p INOUT bigint) FROM PUBLIC;

