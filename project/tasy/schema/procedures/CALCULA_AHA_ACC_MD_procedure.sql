-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE calcula_aha_acc_md ( ie_cirurgia_emergencia_p INOUT text, ie_condicao_cardiaca_p INOUT text, ie_cir_baixo_risco_p INOUT text, ie_classe_funcional_p INOUT text, ie_fat_risco_p INOUT text, ie_cardiomiopatia_p text, ie_isquemica_p text, ie_insuf_cardiaca_p text, ie_diabete_p text, ie_insuf_renal_p text, ie_cerebrovascular_p text, ie_tipo_cirurgia_p bigint, ie_risco_p INOUT text, ds_resultado_p INOUT text ) AS $body$
DECLARE

    qt_fator_risco_w	bigint := 0;
    ds_tipo_cirurgia_w	varchar(2);


BEGIN
    if (coalesce(ie_cirurgia_emergencia_p::text, '') = '') then
        ie_cirurgia_emergencia_p := 'S';
    elsif (coalesce(ie_condicao_cardiaca_p::text, '') = '') and (ie_cirurgia_emergencia_p = 'N')then
        ie_condicao_cardiaca_p := 'S';
    elsif (coalesce(ie_cir_baixo_risco_p::text, '') = '') and (ie_condicao_cardiaca_p = 'N') then
        ie_cir_baixo_risco_p := 'S';
    elsif (coalesce(ie_classe_funcional_p::text, '') = '') and (ie_cir_baixo_risco_p = 'N') then
        ie_classe_funcional_p := 'S';
    elsif (coalesce(ie_fat_risco_p::text, '') = '') and (ie_classe_funcional_p = 'N') then
        ie_fat_risco_p := 'N';
    end if;

    if (ie_cirurgia_emergencia_p = 'S') then
        ds_resultado_p := wheb_mensagem_pck.get_texto(811209);
    elsif (ie_condicao_cardiaca_p = 'S') then
        ds_resultado_p := wheb_mensagem_pck.get_texto(811205);
    elsif (ie_cir_baixo_risco_p = 'S') then
        ds_resultado_p := wheb_mensagem_pck.get_texto(811203);
    elsif (ie_classe_funcional_p = 'S') then
        ds_resultado_p := wheb_mensagem_pck.get_texto(811203);
    elsif (ie_fat_risco_p = 'N') then
        ds_resultado_p := wheb_mensagem_pck.get_texto(811203);
    else
        if (ie_cardiomiopatia_p = 'S') then
            qt_fator_risco_w := qt_fator_risco_w + 1;
        end if;
        if (ie_isquemica_p = 'S') then
            qt_fator_risco_w := qt_fator_risco_w + 1;
        end if;
        if (ie_insuf_cardiaca_p = 'S') then
            qt_fator_risco_w := qt_fator_risco_w + 1;
        end if;
        if (ie_diabete_p = 'S') then
            qt_fator_risco_w := qt_fator_risco_w + 1;
        end if;
        if (ie_insuf_renal_p = 'S') then
            qt_fator_risco_w := qt_fator_risco_w + 1;
        end if;
        if (ie_cerebrovascular_p = 'S') then
            qt_fator_risco_w := qt_fator_risco_w + 1;
        end if;

        if ( qt_fator_risco_w = 0) then
            ds_resultado_p := wheb_mensagem_pck.get_texto(811203);
        else
            if (ie_tipo_cirurgia_p IS NOT NULL AND ie_tipo_cirurgia_p::text <> '') then
                if (ie_tipo_cirurgia_p < 15) then
                    ds_tipo_cirurgia_w	:= 'A';
                elsif (ie_tipo_cirurgia_p < 40) then
                    ds_tipo_cirurgia_w := 'I';
                else
                    ds_tipo_cirurgia_w := 'B';
                end if;
            end if;

            ie_risco_p := ds_tipo_cirurgia_w;

            if (ds_tipo_cirurgia_w = 'B') then
                ds_resultado_p := wheb_mensagem_pck.get_texto(811203);
            elsif (ds_tipo_cirurgia_w = 'A') and ( qt_fator_risco_w >= 3 ) then
                ds_resultado_p := wheb_mensagem_pck.get_texto(811208);
            else
                ds_resultado_p := wheb_mensagem_pck.get_texto(811212);
            end if;
        end if;
    end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE calcula_aha_acc_md ( ie_cirurgia_emergencia_p INOUT text, ie_condicao_cardiaca_p INOUT text, ie_cir_baixo_risco_p INOUT text, ie_classe_funcional_p INOUT text, ie_fat_risco_p INOUT text, ie_cardiomiopatia_p text, ie_isquemica_p text, ie_insuf_cardiaca_p text, ie_diabete_p text, ie_insuf_renal_p text, ie_cerebrovascular_p text, ie_tipo_cirurgia_p bigint, ie_risco_p INOUT text, ds_resultado_p INOUT text ) FROM PUBLIC;

