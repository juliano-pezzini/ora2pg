-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE eup_focuslost_senha_js ( cd_categoria_p text, cd_procedencia_p bigint, nr_seq_classificacao_p bigint, ie_carater_inter_sus_p text, ie_clinica_p bigint, cd_plano_convenio_p text, cd_convenio_p bigint, ie_tipo_atendimento_p text, cd_senha_p text, cd_estabelecimento_p bigint, nm_usuario_p text, cd_senha_ret_p INOUT text, ie_copia_senha_guia_p INOUT text, ds_msg_digito_senha_p INOUT text, ie_exige_conf_guia_p INOUT text) AS $body$
DECLARE

 
			 
 
ie_completa_zero_esq_w		varchar(1);
cd_senha_ret_w			varchar(20);
ie_tipo_atend_copia_senha_w	varchar(50);
ds_rotina_senha_w		varchar(50);
ie_consiste_guia_prescr_w	varchar(3);
ie_exige_conf_guia_w		varchar(1);
qt_tamanho_w			bigint;
			

BEGIN 
 
ie_copia_senha_guia_p := 'N';
 
ie_consiste_guia_prescr_w := Obter_param_Usuario(916, 159, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, ie_consiste_guia_prescr_w);
ie_exige_conf_guia_w := Obter_param_Usuario(916, 183, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, ie_exige_conf_guia_w);
ie_completa_zero_esq_w := Obter_param_Usuario(916, 438, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, ie_completa_zero_esq_w);
ie_tipo_atend_copia_senha_w := Obter_param_Usuario(916, 759, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, ie_tipo_atend_copia_senha_w);
 
 
if (cd_senha_p IS NOT NULL AND cd_senha_p::text <> '') then 
 
	if (ie_completa_zero_esq_w = 'S') then 
		select 	length(coalesce(ds_mascara_senha, cd_senha_p)) 
		into STRICT 	qt_tamanho_w 
		from 	convenio 
		where 	cd_convenio = cd_convenio_p;	
	 
		select	lpad(ltrim(cd_senha_p),qt_tamanho_w,0) 
		into STRICT	cd_senha_ret_w 
		;
		 
		if (cd_senha_ret_w IS NOT NULL AND cd_senha_ret_w::text <> '') then 
			cd_senha_ret_p := cd_senha_ret_w;
		end if;
	end if;
 
	if (ie_tipo_atendimento_p IS NOT NULL AND ie_tipo_atendimento_p::text <> '') and (obter_se_contido(ie_tipo_atendimento_p, ie_tipo_atend_copia_senha_w) = 'S') then 
		 
		select	coalesce(ie_copia_senha_guia,'N') 
		into STRICT	ie_copia_senha_guia_p 
        from 	convenio_estabelecimento  
		where 	cd_convenio = cd_convenio_p 
		and  	cd_estabelecimento = cd_estabelecimento_p;
		 
	end if;	
	 
	if (ie_consiste_guia_prescr_w <> 'N') and (ie_exige_conf_guia_w = 'S') then 
	 
		ie_exige_conf_guia_p := substr(obter_se_exige_guia_senha(cd_convenio_p, ie_tipo_atendimento_p, 1, 'S', cd_estabelecimento_p, ie_carater_inter_sus_p, ie_clinica_p, null, null, nr_seq_classificacao_p, null, cd_categoria_p, cd_plano_convenio_p, cd_procedencia_p),1,1);
	 
	end if;
	/* 
	ROTINA CONSISTE DIGITO 
	 
	select 	ds_rotina_senha 
	into	ds_rotina_senha_w 
	from 	convenio 
	where 	cd_convenio = cd_convenio_p; 
	 
		if (not Consiste_Digitos(Obter_DBPanel_Categoria.DataSet.FieldByName('CD_SENHA').asString, 
			Obter_Valor_Atrib_Tabela('DS_ROTINA_SENHA','CONVENIO','AND CD_CONVENIO = ' + 
			Obter_DBPanel_Categoria.DataSet.FieldByName('CD_CONVENIO').AsString))) and 
			(Consiste_rotina( Obter_DBPanel_Categoria.DataSet.FieldByName('cd_convenio').AsString, 
					 Obter_DBPanel_Categoria.DataSet.FieldByName('cd_plano_convenio').AsString)) then 
		  begin 
 
		  if (MessageDlg('O dígito de controle está incorreto! Você deseja redigitar ?',MtInformation, [mbYes, mbNo], 0) = mrYes) then 
		   TDBEdit(Sender).setfocus 
 
		  end; 
 
	    end; */
 
	 --ds_msg_digito_senha_p := substr(obter_texto_tasy(88970, wheb_usuario_pck.get_nr_seq_idioma),1,255); 
	    
 
end if;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eup_focuslost_senha_js ( cd_categoria_p text, cd_procedencia_p bigint, nr_seq_classificacao_p bigint, ie_carater_inter_sus_p text, ie_clinica_p bigint, cd_plano_convenio_p text, cd_convenio_p bigint, ie_tipo_atendimento_p text, cd_senha_p text, cd_estabelecimento_p bigint, nm_usuario_p text, cd_senha_ret_p INOUT text, ie_copia_senha_guia_p INOUT text, ds_msg_digito_senha_p INOUT text, ie_exige_conf_guia_p INOUT text) FROM PUBLIC;

