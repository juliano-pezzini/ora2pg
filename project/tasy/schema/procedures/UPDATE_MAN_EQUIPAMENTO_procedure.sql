-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE update_man_equipamento ( serial_w man_equipamento_bomba.ds_numero_serial%type, old_channel_w man_equipamento_bomba.ds_canal%type, channel_w man_equipamento_bomba.ds_canal%type, resultado_erro INOUT text) AS $body$
DECLARE

				
				id_man_equipamento_w man_equipamento_bomba.nr_equipamento%type;


BEGIN
	select min(nr_equipamento) id
		into STRICT id_man_equipamento_w
	from man_equipamento_bomba
	where ds_numero_serial = serial_w
	and ds_canal = old_channel_w;

	if (coalesce(id_man_equipamento_w::text, '') = '') then
		resultado_erro := 'Error when updating equipment, it is necessary to have an active equipment record';
		
	else
		update
			man_equipamento_bomba
		set
			dt_atualizacao_nrec = clock_timestamp(),
			nm_usuario_nrec = 'tasy',
			ds_canal = channel_w
		where nr_equipamento = id_man_equipamento_w
		  and ds_canal = old_channel_w;
	end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE update_man_equipamento ( serial_w man_equipamento_bomba.ds_numero_serial%type, old_channel_w man_equipamento_bomba.ds_canal%type, channel_w man_equipamento_bomba.ds_canal%type, resultado_erro INOUT text) FROM PUBLIC;

