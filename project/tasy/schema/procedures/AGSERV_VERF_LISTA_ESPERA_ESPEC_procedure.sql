-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE agserv_verf_lista_espera_espec ( cd_agenda_p bigint, cd_pessoa_fisica_p text, nm_pessoa_lista_p text, dt_desejada_p timestamp, ds_consistencia_p INOUT text) AS $body$
DECLARE

 
qt_agendamentos_w	bigint;
ds_mensagem_w		varchar(2000);
			

BEGIN 
ds_consistencia_p := null;
SELECT	COUNT(*) 
INTO STRICT	qt_agendamentos_w 
FROM 	agenda_lista_espera a, 
	agenda b 
WHERE	a.cd_agenda = b.cd_agenda 
AND	a.cd_agenda <> cd_agenda_p 
AND	b.cd_especialidade = obter_especialidade_agenda(cd_agenda_p) 
AND	a.dt_desejada BETWEEN TRUNC(dt_desejada_p) AND fim_dia(dt_desejada_p) 
AND	((a.cd_pessoa_fisica = cd_pessoa_fisica_p) 
OR (a.nm_pessoa_lista = nm_pessoa_lista_p));
 
if (qt_agendamentos_w > 0) then	 
	ds_mensagem_w := obter_desc_expressao(774835);	
end if;
 
ds_consistencia_p := ds_mensagem_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE agserv_verf_lista_espera_espec ( cd_agenda_p bigint, cd_pessoa_fisica_p text, nm_pessoa_lista_p text, dt_desejada_p timestamp, ds_consistencia_p INOUT text) FROM PUBLIC;

