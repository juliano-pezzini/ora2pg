-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copy_team_med_treatment_plan ( nr_sequencia_p bigint, nr_atendimento_p bigint, nm_usuario_p text) AS $body$
DECLARE


cd_physician_w bigint;
cd_person_w bigint;
cd_position_w bigint;
si_person_type_w varchar(1);
med_treatment_plan_team_seq_w bigint;

cursor01 CURSOR FOR
  SELECT a.cd_physician, a.cd_person, a.cd_position, a.si_person_type
  from med_treatment_plan_team a
  where a.nr_seq_med_treat_plan = (SELECT max(nr_sequencia) from MED_TREATMENT_PLAN where nr_atendimento = nr_atendimento_p and SI_TYPE_FORM = '1');


BEGIN
  if (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '') then
    open cursor01;
    loop
    fetch cursor01 into
    cd_physician_w,
    cd_person_w,
    cd_position_w,
    si_person_type_w;

    EXIT WHEN NOT FOUND; /* apply on cursor01 */
      begin
        select  nextval('med_treatment_plan_team_seq')
        into STRICT  med_treatment_plan_team_seq_w
;

        insert into med_treatment_plan_team(
          nr_sequencia,
          nr_seq_med_treat_plan,
          cd_physician,
          cd_person, 
          cd_position, 
          si_person_type,
		  dt_atualizacao,
		  nm_usuario
          )
        values (med_treatment_plan_team_seq_w, nr_sequencia_p, cd_physician_w, cd_person_w, cd_position_w, si_person_type_w, clock_timestamp(), nm_usuario_p);
      end;
    end loop;
    commit;
  end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copy_team_med_treatment_plan ( nr_sequencia_p bigint, nr_atendimento_p bigint, nm_usuario_p text) FROM PUBLIC;

