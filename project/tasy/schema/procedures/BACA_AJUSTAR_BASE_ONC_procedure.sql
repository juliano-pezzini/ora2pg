-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_ajustar_base_onc () AS $body$
DECLARE


cd_cgc_w		varchar(14);
ds_sep_bv_w		varchar(10);
qt_registro_w		bigint;
ie_base_wheb_w		boolean := false;
ie_base_corp_w		boolean := false;
ie_base_cliente_w	boolean := false;
nm_user_w		varchar(60);

c01 CURSOR FOR
	SELECT	cd_cgc
	from	estabelecimento;


BEGIN

ds_sep_bv_w := obter_separador_bv;

qt_registro_w := obter_valor_dinamico_bv('select 1 from estabelecimento where cd_cgc = :cd_cgc and cd_estabelecimento = :cd_estabelecimento and ie_situacao = :ie_situacao', 'cd_cgc=01950338000177'|| ds_sep_bv_w || 'cd_estabelecimento=1' ||ds_sep_bv_w|| 'ie_situacao=A', qt_registro_w);

if ( qt_registro_w > 0 ) then
	ie_base_wheb_w := true;
	select	substr(user,1,4)
	into STRICT	nm_user_w
	;
	if ( nm_user_w = 'CORP' ) then
		ie_base_corp_w := true;
		ie_base_wheb_w := false;
	elsif ( nm_user_w = 'CLIE') then
		ie_base_cliente_w := true;
		ie_base_corp_w := false;
		ie_base_wheb_w := false;
	end if;
end if;


open c01;
loop

	fetch c01 into	cd_cgc_w;
		EXIT WHEN NOT FOUND; /* apply on c01 */

	ds_sep_bv_w := obter_separador_bv;

	if (cd_cgc_w <> '61590410000124') and (not ie_base_wheb_w) and (not ie_base_corp_w) and (not ie_base_cliente_w) then

		CALL Exec_sql_Dinamico('oicorrea', ' drop procedure onc_copiar_dados_tipo_consulta'
);
		CALL Exec_sql_Dinamico('oicorrea', ' drop procedure onc_liberar_diagnostico'
);
		CALL Exec_sql_Dinamico('oicorrea', ' drop procedure onc_inserir_parametro'
);
		CALL Exec_sql_Dinamico('oicorrea', ' drop procedure onc_inserir_parametro_medico'
);
		CALL Exec_sql_Dinamico('oicorrea', ' drop procedure onc_inserir_parametro_medico'
);
		CALL Exec_sql_Dinamico('oicorrea', ' drop procedure onc_inserir_sinais_vitais'
);
		CALL Exec_sql_Dinamico('oicorrea', ' drop function onc_obter_desc_intencao'
);
		CALL Exec_sql_Dinamico('oicorrea', ' drop function onc_obter_desc_local_cons'
);
		CALL Exec_sql_Dinamico('oicorrea', ' drop function onc_obter_desc_plan_utilizado'
);
		CALL Exec_sql_Dinamico('oicorrea', ' drop function onc_obter_desc_parametro'
);
		CALL Exec_sql_Dinamico('oicorrea', ' drop function onc_obter_dados_ult_exame_fis'
);

		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_ACESSORIO			drop constraint ONCACES_PK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_COMPLEXIDADE		drop constraint ONCCOMP_PK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_EQUIPAMENTO			drop constraint ONCEQUI_PK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_DIAGNOSTICO			drop constraint ONCDIAG_ONCINTE_FK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_INTENCAO			drop constraint ONCINTE_PK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_DIAGNOSTICO			drop constraint ONCDIAG_ONCLOCC_FK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_LOCAL_CONSULTA		drop constraint ONCLOCC_PK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_DIAGNOSTICO			drop constraint ONCDIAG_ONCPLAN_FK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_PLANEJAMENTO_UTILIZADO	drop constraint ONCPLAN_PK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_REGIAO_ORGAO		drop constraint ONCREOR_PK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_TECNICA			drop constraint ONCTECN_PK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_PARAMETRO			drop constraint ONCPARA_DOMINIO_FK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_PARAMETRO			drop constraint ONCPARA_PK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_PARAMETRO_MEDICO		drop constraint ONCPARM_MEDICO_FK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_PARAMETRO_MEDICO		drop constraint ONCPARM_PK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_EVOLUCAO			drop constraint ONCEVOL_ONCDIAG_FK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_EXAME_FISICO		drop constraint ONCEXAM_ONCDIAG_FK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_IMPRESSAO_CONDUTA		drop constraint ONCIMPE_ONCDIAG_FK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_DIAGNOSTICO			drop constraint ONCDIAG_PESFISI_FK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_DIAGNOSTICO			drop constraint ONCDIAG_MEDICO_FK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_DIAGNOSTICO			drop constraint ONCDIAG_PK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_EVOLUCAO			drop constraint ONCEVOL_PESFISI_FK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_EVOLUCAO			drop constraint ONCEVOL_MEDICO_FK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_EVOLUCAO			drop constraint ONCEVOL_PK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_ANTECEDENTE			drop constraint ONCANTE_PESFISI_FK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_ANTECEDENTE			drop constraint ONCANTE_MEDICO_FK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_ANTECEDENTE			drop constraint ONCANTE_PK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_EXAME_FISICO		drop constraint ONCEXAM_PESFISI_FK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_EXAME_FISICO		drop constraint ONCEXAM_MEDICO_FK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_EXAME_FISICO		drop constraint ONCEXAM_NIVCAFE_FK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_EXAME_FISICO		drop constraint ONCEXAM_PK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_IMPRESSAO_CONDUTA		drop constraint ONCIMPE_PESFISI_FK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_IMPRESSAO_CONDUTA		drop constraint ONCIMPE_MEDICO_FK');
		CALL Exec_sql_Dinamico('oicorrea', ' alter table ONC_IMPRESSAO_CONDUTA		drop constraint ONCIMPE_PK');

		CALL Exec_sql_Dinamico('oicorrea', ' drop table ONC_ACESSORIO');
		CALL Exec_sql_Dinamico('oicorrea', ' drop table ONC_COMPLEXIDADE');
		CALL Exec_sql_Dinamico('oicorrea', ' drop table ONC_EQUIPAMENTO');
		CALL Exec_sql_Dinamico('oicorrea', ' drop table ONC_DIAGNOSTICO');
		CALL Exec_sql_Dinamico('oicorrea', ' drop table ONC_INTENCAO');
		CALL Exec_sql_Dinamico('oicorrea', ' drop table ONC_LOCAL_CONSULTA');
		CALL Exec_sql_Dinamico('oicorrea', ' drop table ONC_PLANEJAMENTO_UTILIZADO');
		CALL Exec_sql_Dinamico('oicorrea', ' drop table ONC_REGIAO_ORGAO');
		CALL Exec_sql_Dinamico('oicorrea', ' drop table ONC_TECNICA');
		CALL Exec_sql_Dinamico('oicorrea', ' drop table ONC_PARAMETRO');
		CALL Exec_sql_Dinamico('oicorrea', ' drop table ONC_PARAMETRO_MEDICO');
		CALL Exec_sql_Dinamico('oicorrea', ' drop table ONC_EVOLUCAO');
		CALL Exec_sql_Dinamico('oicorrea', ' drop table ONC_IMPRESSAO_CONDUTA');
		CALL Exec_sql_Dinamico('oicorrea', ' drop table ONC_ANTECEDENTE');
		CALL Exec_sql_Dinamico('oicorrea', ' drop table ONC_EXAME_FISICO');


		CALL Exec_sql_Dinamico('oicorrea', ' drop sequence ONC_ACESSORIO_SEQ ');
		CALL Exec_sql_Dinamico('oicorrea', ' drop sequence ONC_COMPLEXIDADE_SEQ ');
		CALL Exec_sql_Dinamico('oicorrea', ' drop sequence ONC_EQUIPAMENTO_SEQ ');
		CALL Exec_sql_Dinamico('oicorrea', ' drop sequence ONC_DIAGNOSTICO_SEQ ');
		CALL Exec_sql_Dinamico('oicorrea', ' drop sequence ONC_INTENCAO_SEQ ');
		CALL Exec_sql_Dinamico('oicorrea', ' drop sequence ONC_LOCAL_CONSULTA_seq ');
		CALL Exec_sql_Dinamico('oicorrea', ' drop sequence ONC_PLANEJAMENTO_UTILIZADO_seq ');
		CALL Exec_sql_Dinamico('oicorrea', ' drop sequence ONC_REGIAO_ORGAO_seq ');
		CALL Exec_sql_Dinamico('oicorrea', ' drop sequence ONC_TECNICA_seq ');
		CALL Exec_sql_Dinamico('oicorrea', ' drop sequence ONC_PARAMETRO_seq ');
		CALL Exec_sql_Dinamico('oicorrea', ' drop sequence ONC_PARAMETRO_MEDICO_seq ');
		CALL Exec_sql_Dinamico('oicorrea', ' drop sequence ONC_EVOLUCAO_seq ');
		CALL Exec_sql_Dinamico('oicorrea', ' drop sequence ONC_IMPRESSAO_CONDUTA_seq ');
		CALL Exec_sql_Dinamico('oicorrea', ' drop sequence ONC_ANTECEDENTE_seq ');
		CALL Exec_sql_Dinamico('oicorrea', ' drop sequence ONC_EXAME_FISICO_seq ');
	end if;

end loop;
close c01;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_ajustar_base_onc () FROM PUBLIC;

