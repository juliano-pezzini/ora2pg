-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE desfazer_processo_conciliacao (nr_sequencia_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
nr_seq_concil_w		bigint;
nr_seq_conta_w		bigint;


BEGIN 
 
select	coalesce(max(nr_sequencia), 0) 
into STRICT	nr_seq_concil_w 
from	concil_banc_movto 
where	nr_seq_conciliacao	= nr_sequencia_p;
 
CALL desconciliar_banco(nr_seq_concil_w, 'T', nm_usuario_p);
 
update	movto_trans_financ 
set	ie_conciliacao	= 'N' 
where	nr_sequencia		in (SELECT	x.nr_seq_movto_trans 
	from		concil_banc_pend_tasy x 
	where		x.nr_seq_conciliacao	= nr_sequencia_p);
 
delete	from concil_banc_pend_tasy 
where	nr_seq_conciliacao	= nr_sequencia_p;
 
update	banco_extrato_lanc 
set	ie_conciliacao	= 'N' 
where	nr_sequencia	in (SELECT	x.nr_seq_lanc_extrato 
	from		concil_banc_pend_bco x 
	where		x.nr_seq_conciliacao	= nr_sequencia_p);
 
delete	from concil_banc_pend_bco 
where	nr_seq_conciliacao	= nr_sequencia_p;
 
select	max(a.nr_seq_conta) 
into STRICT	nr_seq_conta_w 
from	conciliacao_bancaria a 
where	a.nr_sequencia	= nr_sequencia_p;
 
delete	from conciliacao_bancaria 
where	nr_sequencia		= nr_sequencia_p;
 
CALL gravar_log_exclusao('CONCILIACAO_BANCARIA',nm_usuario_p,'NR_SEQ_CONTA=' || nr_seq_conta_w || ';NR_SEQUENCIA='|| nr_sequencia_p,'N');
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE desfazer_processo_conciliacao (nr_sequencia_p bigint, nm_usuario_p text) FROM PUBLIC;

