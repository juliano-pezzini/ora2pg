-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE diops_cadastral_gravar_telfax ( nr_seq_operadora_p bigint, nr_seq_periodo_p bigint, cd_pessoa_fisica_p text, cd_cgc_p text, ie_tipo_telefone_p text, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
Finalidade: Gerar as informações de FAX 
------------------------------------------------------------------------------------------------------------------- 
Locais de chamada direta: 
[ X ] Objetos do dicionário [ ] Tasy (Delphi/Java) [ ] Portal [ ] Relatórios [ ] Outros: 
 ------------------------------------------------------------------------------------------------------------------ 
Pontos de atenção: 
	ie_tipo_telefone 
		TO - Telefone Operadora 
		FO - Fax Operadora 
		TR - Telefone Representante 
		FR - Fax Representante 
		TRN - Telefone Representante RN117 
		FRN - Fax Representante RN117 
		TE - Telefone Empresa dependente 
		TF - Fax Empresa dependente 
------------------------------------------------------------------------------------------------------------------- 
Referências: 
	DIOPS_CADASTRAL_GERAR_TELFAX 
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
 
 
nr_telefone_w		varchar(15);
nr_fax_w		varchar(15);
nr_ddi_telefone_w	varchar(3);
nr_ddd_telefone_w	varchar(3);
nr_ddi_fax_w		varchar(3);
nr_ddd_fax_w		varchar(3);
nr_ramal_w		integer;


BEGIN 
if (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') then 
	select	nr_ddi_telefone, 
		nr_ddd_telefone, 
		nr_telefone, 
		nr_ramal, 
		nr_ddi_fax, 
		nr_ddd_fax, 
		ds_fax 
	into STRICT	nr_ddi_telefone_w, 
		nr_ddd_telefone_w, 
		nr_telefone_w, 
		nr_ramal_w, 
		nr_ddi_fax_w, 
		nr_ddd_fax_w, 
		nr_fax_w 
	from	compl_pessoa_fisica 
	where	cd_pessoa_fisica	= cd_pessoa_fisica_p 
	and	ie_tipo_complemento	= 1;
elsif (cd_cgc_p IS NOT NULL AND cd_cgc_p::text <> '') then /* Obter dados da pessoa jurídica */
 
	select	nr_ddi_telefone, 
		nr_ddd_telefone, 
		nr_telefone, 
		nr_ddi_fax, 
		nr_ddd_fax, 
		nr_fax 
	into STRICT	nr_ddi_telefone_w, 
		nr_ddd_telefone_w, 
		nr_telefone_w, 
		nr_ddi_fax_w, 
		nr_ddd_fax_w, 
		nr_fax_w 
	from	pessoa_juridica 
	where	cd_cgc	= cd_cgc_p;
	 
	begin 
	nr_ramal_w	:= substr(obter_dados_pf_pj_estab(cd_estabelecimento_p, '', cd_cgc_p, 'ENR'),1,60);
	exception 
	when others then 
		nr_ramal_w	:= null;
	end;
end if;
 
if (substr(ie_tipo_telefone_p, 1, 1) = 'F') then 
	nr_ddi_telefone_w	:= nr_ddi_fax_w;
	nr_ddd_telefone_w	:= nr_ddd_fax_w;
	nr_telefone_w		:= nr_fax_w;
end if;
 
insert into w_diops_cad_telfax(nr_sequencia, 
	nr_seq_operadora, 
	ie_tipo_telefone, 
	nr_ddi_telefone, 
	nr_ddd_telefone, 
	nr_telefone, 
	nr_ramal_contato, 
	cd_estabelecimento, 
	dt_atualizacao, 
	nm_usuario, 
	cd_pessoa_fisica, 
	cd_cgc, 
	nr_seq_periodo) 
values (nextval('w_diops_cad_telfax_seq'), 
	nr_seq_operadora_p, 
	ie_tipo_telefone_p, 
	nr_ddi_telefone_w, 
	nr_ddd_telefone_w, 
	nr_telefone_w, 
	nr_ramal_w, 
	cd_estabelecimento_p, 
	clock_timestamp(), 
	nm_usuario_p, 
	cd_pessoa_fisica_p, 
	cd_cgc_p, 
	nr_seq_periodo_p);
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE diops_cadastral_gravar_telfax ( nr_seq_operadora_p bigint, nr_seq_periodo_p bigint, cd_pessoa_fisica_p text, cd_cgc_p text, ie_tipo_telefone_p text, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

