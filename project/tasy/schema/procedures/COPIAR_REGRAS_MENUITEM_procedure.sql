-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copiar_regras_menuitem (nr_seq_obj_schematic_p bigint, nr_seq_menu_item_p bigint, nr_seq_obj_schematic_dest_p bigint, nr_seq_menu_dest_p bigint, nm_usuario_p text) AS $body$
DECLARE


    nr_seq_regra_w bigint;

    c01 CURSOR FOR
        SELECT a.*
          from regra_condicao a
         where nr_seq_objeto_schematic = nr_seq_obj_schematic_p
           and nr_seq_objeto = nr_seq_menu_item_p
         order by nr_ordem_execucao;

    c01_w c01%rowtype;

    c02 CURSOR FOR
        SELECT a.* from regra_condicao_item a where nr_seq_regra = c01_w.nr_sequencia;

    c02_w c02%rowtype;

    nr_sequencia_rem_w bigint;


BEGIN

    for c01_w in c01 loop

        $if $$tasy_local_dict=true $then
        nr_seq_regra_w := get_remote_sequence('SEQ:REGRA_CONDICAO_SEQ');
        $else
        select nextval('regra_condicao_seq') into STRICT nr_seq_regra_w;
        $end

        insert into regra_condicao(nr_sequencia,
             nr_seq_legenda,
             dt_atualizacao,
             nm_condicao,
             dt_atualizacao_nrec,
             nm_usuario,
             nm_usuario_nrec,
             nr_seq_objeto,
             nr_seq_objeto_schematic,
             nr_seq_opcao_crud,
             nr_ordem_execucao,
             ds_resultado_condicao,
             cd_exp_msg_regra,
             nr_seq_obj_sch_leg)
        values (nr_seq_regra_w,
             c01_w.nr_seq_legenda,
             clock_timestamp(),
             c01_w.nm_condicao,
             clock_timestamp(),
             nm_usuario_p,
             nm_usuario_p,
             nr_seq_menu_dest_p,
             nr_seq_obj_schematic_dest_p,
             c01_w.nr_seq_opcao_crud,
             c01_w.nr_ordem_execucao,
             c01_w.ds_resultado_condicao,
             c01_w.cd_exp_msg_regra,
             c01_w.nr_seq_obj_sch_leg);

        for c02_w in c02 loop
            $if $$tasy_local_dict=true $then
            nr_sequencia_rem_w := get_remote_sequence('SEQ:REGRA_CONDICAO_ITEM_SEQ');
            $else
            select nextval('regra_condicao_item_seq') into STRICT nr_sequencia_rem_w;
            $end
            insert into regra_condicao_item(nr_sequencia,
                 dt_atualizacao,
                 dt_atualizacao_nrec,
                 ie_condicao,
                 ie_opcao_comparacao,
                 ie_valor,
                 nm_atributo,
                 nm_atributo_base,
                 nm_usuario,
                 nm_usuario_nrec,
                 vl_parametro,
                 cd_funcao,
                 nr_seq_param,
                 nr_seq_regra,
                 ie_grid_detalhe,
                 ie_edit,
                 ie_insert,
                 ie_browser,
                 ie_qtdade_registro_selec,
                 nr_seq_objeto_schematic,
                 nm_variavel_sistema)
            values (nr_sequencia_rem_w, --regra_condicao_item_seq.nextval,
                 clock_timestamp(),
                 clock_timestamp(),
                 c02_w.ie_condicao,
                 c02_w.ie_opcao_comparacao,
                 c02_w.ie_valor,
                 c02_w.nm_atributo,
                 c02_w.nm_atributo_base,
                 nm_usuario_p,
                 nm_usuario_p,
                 c02_w.vl_parametro,
                 c02_w.cd_funcao,
                 c02_w.nr_seq_param,
                 nr_seq_regra_w,
                 c02_w.ie_grid_detalhe,
                 c02_w.ie_edit,
                 c02_w.ie_insert,
                 c02_w.ie_browser,
                 c02_w.ie_qtdade_registro_selec,
                 c02_w.nr_seq_objeto_schematic,
                 c02_w.nm_variavel_sistema);
        end loop;
    end loop;
    commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copiar_regras_menuitem (nr_seq_obj_schematic_p bigint, nr_seq_menu_item_p bigint, nr_seq_obj_schematic_dest_p bigint, nr_seq_menu_dest_p bigint, nm_usuario_p text) FROM PUBLIC;

