-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_historico_req_mat_med ( nr_seq_requisicao_p bigint, nr_seq_material_p bigint, ie_acao_p bigint, nm_usuario_p text) AS $body$
DECLARE


--ie_acao =  1 - Gerar entrega
--ie_acao =  2- cancelar entrega
--ie_acao =  4 - gerar devolução
--ie_acao =  3- desfazer entrega
ds_historico_w	varchar(4000);
ds_acao_w	varchar(30);
ds_material_w	varchar(256);
cd_material_ops_w	varchar(256);

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [ x Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
BEGIN

if (ie_acao_p = 1)then
ds_acao_w := 'Material entregue';
end if;
if (ie_acao_p = 2)then
ds_acao_w := 'Entrega cancelada';
end if;
if (ie_acao_p = 3)then
ds_acao_w := 'Entrega desfeita';
end if;
if (ie_acao_p = 4)then
ds_acao_w := 'Material devolvido';
end if;

cd_material_ops_w :=	substr(pls_obter_seq_codigo_material(nr_seq_material_p,''),1,255);
ds_material_w	  :=	substr(obter_descricao_padrao('PLS_MATERIAL','DS_MATERIAL',nr_seq_material_p),1,255);
ds_historico_w := 	to_char(clock_timestamp(),'dd/mm/yyyy hh24:mi:ss')||' - '||nm_usuario_p||chr(10)||
			'Gestão do Cadastro de Materiais / Solicitação entrega mat/med.' ||chr(10)||
			'Material: '||cd_material_ops_w||' - '||ds_material_w||chr(10)||
			'Ação: '||ds_acao_w;

CALL pls_requisicao_gravar_hist(nr_seq_requisicao_p, 'L', ds_historico_w, null, nm_usuario_p);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_historico_req_mat_med ( nr_seq_requisicao_p bigint, nr_seq_material_p bigint, ie_acao_p bigint, nm_usuario_p text) FROM PUBLIC;

