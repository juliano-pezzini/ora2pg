-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE fis_efd_icmsipi_calcula_e210 (vl_retencao_st_p bigint, vl_out_deb_st_p bigint, vl_aj_debitos_st_p bigint, vl_sld_cred_ant_st_p bigint, vl_devol_st_p bigint, vl_ressarc_st_p bigint, vl_out_cred_st_p bigint, vl_aj_creditos_st_p bigint, vl_deducoes_st_p bigint, vl_sld_dev_ant_st_p INOUT bigint, vl_icms_recol_st_p INOUT bigint, vl_sld_cred_st_transportar_p INOUT bigint, ie_mov_st_p INOUT bigint) AS $body$
DECLARE

  vl_sld_dev_ant_st_w		double precision	:= 0;
  vl_icms_recol_st_w 		double precision	:= 0;
  vl_sld_cred_st_transportar_w	double precision 	:= 0;
  ie_mov_st_w 			smallint	:= 0;

BEGIN

	--Saldo apurado
	vl_sld_dev_ant_st_w := coalesce((vl_retencao_st_p + vl_out_deb_st_p + vl_aj_debitos_st_p) -
		     (vl_sld_cred_ant_st_p + vl_devol_st_p + vl_ressarc_st_p + vl_out_cred_st_p + vl_aj_creditos_st_p),0);

	if vl_sld_dev_ant_st_w >= 0 then
		vl_sld_cred_st_transportar_w := 0;
	else
		vl_sld_dev_ant_st_w := 0;
		vl_sld_cred_st_transportar_w := abs(vl_sld_cred_st_transportar_w);
	end if;

	-- VL_ICMS_RECOL_ST
	vl_icms_recol_st_w := (vl_sld_dev_ant_st_w) - (vl_deducoes_st_p);

	--vl_sld_cred_st_transportar_w
	vl_sld_cred_st_transportar_w :=  (vl_retencao_st_p + vl_out_deb_st_p + vl_aj_debitos_st_p) -
                                   (vl_sld_cred_ant_st_p + vl_devol_st_p + vl_ressarc_st_p + vl_out_cred_st_p + vl_aj_creditos_st_p);

	if vl_sld_cred_st_transportar_w >= 0 then
		vl_sld_cred_st_transportar_w := 0;
	else
		vl_sld_cred_st_transportar_w := abs(vl_sld_cred_st_transportar_w);
	end if;

	if (vl_retencao_st_p <> 0) or (vl_out_deb_st_p <> 0) or (vl_aj_debitos_st_p <> 0) or (vl_sld_cred_ant_st_p <> 0) or (vl_devol_st_p <> 0) or (vl_ressarc_st_p <> 0) or (vl_out_cred_st_p <> 0) or (vl_aj_creditos_st_p <> 0) or (vl_deducoes_st_p <> 0) or (vl_sld_dev_ant_st_w <> 0) or (vl_icms_recol_st_w <> 0) or (vl_sld_cred_st_transportar_w <> 0) then
		ie_mov_st_w := 1;
	end if;

	/**/

	vl_sld_dev_ant_st_p		:= coalesce(vl_sld_dev_ant_st_w,0);
	vl_icms_recol_st_p		:= coalesce(vl_icms_recol_st_w,0);
	vl_sld_cred_st_transportar_p	:= coalesce(vl_sld_cred_st_transportar_w,0);
	ie_mov_st_p                     := ie_mov_st_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE fis_efd_icmsipi_calcula_e210 (vl_retencao_st_p bigint, vl_out_deb_st_p bigint, vl_aj_debitos_st_p bigint, vl_sld_cred_ant_st_p bigint, vl_devol_st_p bigint, vl_ressarc_st_p bigint, vl_out_cred_st_p bigint, vl_aj_creditos_st_p bigint, vl_deducoes_st_p bigint, vl_sld_dev_ant_st_p INOUT bigint, vl_icms_recol_st_p INOUT bigint, vl_sld_cred_st_transportar_p INOUT bigint, ie_mov_st_p INOUT bigint) FROM PUBLIC;

