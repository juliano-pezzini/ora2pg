-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_altera_ordem_regras_sip ( nr_seq_item_p sip_item_assistencial.nr_sequencia%type, ds_item_p sip_item_assistencial.ds_item%type, ie_ordem_p sip_item_assistencial.ie_ordem_aplicacao_regra%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: Alterar a ordenação das regras do SIP.
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[ ]  Objetos do dicionário [ x ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
-------------------------------------------------------------------------------------------------------------------
Pontos de atenção:

Alterações:
-------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
ie_ordem_internacao_w	sip_item_assistencial.ie_ordem_aplicacao_regra%type;
ie_ordem_w		sip_item_assistencial.ie_ordem_aplicacao_regra%type;
ds_item_w		sip_item_assistencial.ds_item%type;

c01 CURSOR FOR
	SELECT	ie_ordem_aplicacao_regra,
		ds_item
	from	sip_item_assistencial
	where 	nr_sequencia in (83, 88, 108);


BEGIN
if (nr_seq_item_p IS NOT NULL AND nr_seq_item_p::text <> '') then

	if (nr_seq_item_p in (83, 88, 108)) then
		select	ie_ordem_aplicacao_regra
		into STRICT	ie_ordem_internacao_w
		from	sip_item_assistencial
		where	nr_sequencia = 65;

		if (ie_ordem_p < ie_ordem_internacao_w)then
			CALL wheb_mensagem_pck.exibir_mensagem_abort(347823, 'DS_ITEM_P=' || ds_item_p);
		end if;
	end if;

	if (nr_seq_item_p = 65) then
		open c01;
		loop
		fetch C01 into
			ie_ordem_w,
			ds_item_w;
		EXIT WHEN NOT FOUND; /* apply on c01 */
			begin
				if (ie_ordem_p > ie_ordem_w) then
					CALL wheb_mensagem_pck.exibir_mensagem_abort(347920, 'DS_ITEM_P=' || ds_item_w);
				end if;
			end;
		end loop;
		close c01;
	end if;

	if (ie_ordem_p IS NOT NULL AND ie_ordem_p::text <> '') then
		update	sip_item_assistencial
		set	ie_ordem_aplicacao_regra = ie_ordem_p,
			nm_usuario 		 = nm_usuario_p,
			dt_atualizacao		 = clock_timestamp()
		where	nr_sequencia = nr_seq_item_p;
	end if;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_altera_ordem_regras_sip ( nr_seq_item_p sip_item_assistencial.nr_sequencia%type, ds_item_p sip_item_assistencial.ds_item%type, ie_ordem_p sip_item_assistencial.ie_ordem_aplicacao_regra%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;

