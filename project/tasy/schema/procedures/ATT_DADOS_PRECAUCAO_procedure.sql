-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE att_dados_precaucao ( nr_atendimento_p bigint, dt_prevista_p timestamp, ds_observacao_p text, ie_probabilidade_alta_p text, nr_dias_prev_alta_p bigint, nr_seq_classif_medico_p bigint, nm_usuario_p text) AS $body$
DECLARE

nr_telefone_w	varchar(60);

BEGIN
 
if (coalesce(nr_atendimento_p,0) > 0) and (coalesce(nr_seq_classif_medico_p,0) > 0) then 
 
	select	substr(max(obter_telefone_pf(obter_pessoa_atendimento(nr_atendimento_p,'C'),1)),1,60) 
	into STRICT	nr_telefone_w 
	;
	 
	insert into atend_prob_alta_hist(	dt_atualizacao, 
			dt_historico, 
			nm_usuario, 
			nr_atendimento, 
			nr_sequencia, 
			ds_historico, 
			dt_atualizacao_nrec, 
			dt_prevista_alta, 
			ie_probabilidade_alta, 
			ie_tipo_probabilidade, 
			nm_usuario_nrec, 
			nr_dias_prev_alta, 
			nr_seq_classif_medico, 
			nr_telefone) 
	values (	clock_timestamp(), 
			clock_timestamp(), 
			nm_usuario_p, 
			nr_atendimento_p, 
			nextval('atend_prob_alta_hist_seq'), 
			ds_observacao_p, 
			clock_timestamp(), 
			dt_prevista_p, 
			ie_probabilidade_alta_p,			 
			'S',			 
			nm_usuario_p, 
			nr_dias_prev_alta_p, 
			nr_seq_classif_medico_p, 
			nr_telefone_w 
			);
end if;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE att_dados_precaucao ( nr_atendimento_p bigint, dt_prevista_p timestamp, ds_observacao_p text, ie_probabilidade_alta_p text, nr_dias_prev_alta_p bigint, nr_seq_classif_medico_p bigint, nm_usuario_p text) FROM PUBLIC;

