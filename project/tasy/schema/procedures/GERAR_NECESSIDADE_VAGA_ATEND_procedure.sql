-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_necessidade_vaga_atend ( nr_atendimento_p bigint, ie_solicitacao_p text, ie_tipo_vaga_p text, cd_motivo_transf_p bigint, cd_setor_desejado_p bigint, cd_acomodacao_desejada_p bigint, cd_estabelecimento_p bigint, cd_convenio_p bigint, cd_categoria_p text, cd_plano_p text, ds_hd_p text, cd_procedimento_p bigint, ie_origem_proced_p bigint, nm_usuario_p text, nr_seq_proc_interno_p bigint, cd_medico_resp_p text, ie_clinica_p bigint, cd_cid_principal_p text, ie_necessita_isolamento_p text, ie_necessita_dialise_p text, cd_funcionario_p text default null, nr_seq_classif_medico_p bigint default null, qt_dia_p bigint default null, ie_opme_p text default null, ie_quimioterapia_p text default null, qt_acompanhante_p bigint default null, cd_departamento_desejado_p bigint default null) AS $body$
DECLARE


nr_atend_alta_w	bigint;
nr_sequencia_w gestao_vaga.nr_sequencia%TYPE;


BEGIN
if (nr_atendimento_p IS NOT NULL AND nr_atendimento_p::text <> '') and (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') then
	begin
	
	select	coalesce(max(nr_atendimento), nr_atendimento_p)
	into STRICT	nr_atend_alta_w
	from	atendimento_paciente
	where	nr_atend_alta = nr_atendimento_p;
	
	nr_sequencia_w := gerar_necessidade_vaga(
		nr_atend_alta_w, ie_solicitacao_p, ie_tipo_vaga_p, cd_motivo_transf_p, cd_setor_desejado_p, cd_acomodacao_desejada_p, cd_estabelecimento_p, cd_convenio_p, cd_categoria_p, cd_plano_p, ds_hd_p, cd_procedimento_p, ie_origem_proced_p, nm_usuario_p, nr_seq_proc_interno_p, cd_medico_resp_p, ie_clinica_p, cd_cid_principal_p, ie_necessita_isolamento_p, ie_necessita_dialise_p, null, null, cd_funcionario_p, nr_seq_classif_medico_p, qt_dia_p, ie_opme_p, ie_quimioterapia_p, null, qt_acompanhante_p, cd_departamento_desejado_p, null, null, null, null, null, null, null, null, null, null, null, nr_sequencia_w);	
	end;
end if;

commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_necessidade_vaga_atend ( nr_atendimento_p bigint, ie_solicitacao_p text, ie_tipo_vaga_p text, cd_motivo_transf_p bigint, cd_setor_desejado_p bigint, cd_acomodacao_desejada_p bigint, cd_estabelecimento_p bigint, cd_convenio_p bigint, cd_categoria_p text, cd_plano_p text, ds_hd_p text, cd_procedimento_p bigint, ie_origem_proced_p bigint, nm_usuario_p text, nr_seq_proc_interno_p bigint, cd_medico_resp_p text, ie_clinica_p bigint, cd_cid_principal_p text, ie_necessita_isolamento_p text, ie_necessita_dialise_p text, cd_funcionario_p text default null, nr_seq_classif_medico_p bigint default null, qt_dia_p bigint default null, ie_opme_p text default null, ie_quimioterapia_p text default null, qt_acompanhante_p bigint default null, cd_departamento_desejado_p bigint default null) FROM PUBLIC;

