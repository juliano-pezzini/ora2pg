-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE update_dt_alta_automatic ( cd_pessoa_fisica_p text, cd_motivo_alta_p bigint) AS $body$
DECLARE


nr_atendimento_w atendimento_paciente.nr_atendimento%type;
ds_return_w varchar(255);
w_gerar_alta_automatica varchar(2);
w_cd_motivo_alta bigint;
C01 CURSOR FOR
	SELECT nr_atendimento
      from atendimento_paciente
     where cd_pessoa_fisica = cd_pessoa_fisica_p
       and ie_tipo_atendimento = 1
       and coalesce(dt_alta::text, '') = '';
BEGIN	
	w_gerar_alta_automatica := Obter_param_usuario(916, 1248, obter_perfil_ativo, obter_usuario_ativo, wheb_usuario_pck.get_cd_estabelecimento, w_gerar_alta_automatica);
	w_cd_motivo_alta := Obter_param_usuario(916, 664, obter_perfil_ativo, obter_usuario_ativo, wheb_usuario_pck.get_cd_estabelecimento, w_cd_motivo_alta);
	if (w_gerar_alta_automatica = 'S') then
		for c01_w in c01
		loop
			begin
				ds_return_w := gerar_estornar_alta(c01_w.nr_atendimento, 'A', null, coalesce(cd_motivo_alta_p, w_cd_motivo_alta), clock_timestamp(), obter_usuario_ativo, ds_return_w, 0, null, null);
			exception
				when no_data_found then
					null;
				when others then
					null;					
			end;
		end loop;

		commit;
	end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE update_dt_alta_automatic ( cd_pessoa_fisica_p text, cd_motivo_alta_p bigint) FROM PUBLIC;

