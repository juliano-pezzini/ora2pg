-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consistir_evento_reinf_4000 ( nr_seq_lote_p bigint, ie_utilizacao_p text, ie_tp_consist_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_seq_4010_w  		fis_reinf_r4010_evento.nr_sequencia%type;
nr_seq_4020_w  		fis_reinf_r4020_evento.nr_sequencia%type;
nr_seq_dados_w		fis_reinf_r4010_dados.nr_sequencia%type;
nr_seq_inf_pg_ext_w 	fis_reinf_r4010_inf_pg_ext.nr_sequencia%type;
nr_seq_op_saude_w 	fis_reinf_r4010_op_saude.nr_sequencia%type;
nr_seq_det_ded_w		fis_reinf_r4010_det_ded.nr_sequencia%type;
nr_seq_rend_isen_w	fis_reinf_r4010_rend_isen.nr_sequencia%type;
nr_seq_proc_ret_w		fis_reinf_r4010_proc_ret.nr_sequencia%type;
nr_seq_info_rra_w		fis_reinf_r4010_info_rra.nr_sequencia%type;
nr_seq_proc_jud_w		fis_reinf_r4010_proc_jud.nr_sequencia%type;
nr_seq_benef_pen_w	fis_reinf_r4010_benef_pen.nr_sequencia%type;
nr_seq_dpj_or_rra_w	fis_reinf_r4010_dpj_or_rra.nr_sequencia%type;
nr_seq_ideadv_rra_w	fis_reinf_r4010_ideadv_rra.nr_sequencia%type;
nr_seq_dpj_orec_w		fis_reinf_r4010_dpj_orec.nr_sequencia%type;
nr_seq_ideadv_pj_w	fis_reinf_r4010_ideadv_pj.nr_sequencia%type;
nr_seq_reemb_tit_w		fis_reinf_r4010_reemb_tit.nr_sequencia%type;
nr_seq_depend_pl_w	fis_reinf_r4010_depend_pl.nr_sequencia%type;
nr_seq_reemb_dep_w	fis_reinf_r4010_reemb_dep.nr_sequencia%type;
nr_seq_inf_pg_ext_4020_w 	fis_reinf_r4020_inf_pg_ext.nr_sequencia%type;
nr_seq_dados_4020_w	fis_reinf_r4020_dados.nr_sequencia%type;
nr_seq_proc_jud_4020_w 	fis_reinf_r4020_proc_jud.nr_sequencia%type;
nr_seq_proc_ret_4020_w 	fis_reinf_r4020_proc_ret.nr_sequencia%type;
nr_seq_ideadv_pj_4020_w 	fis_reinf_r4020_ideadv_pj.nr_sequencia%type;
nr_seq_dpj_orec_4020_w 	fis_reinf_r4020_dpj_orec.nr_sequencia%type;
nr_seq_4040_w		fis_reinf_r4040_evento.nr_sequencia%type;
nr_seq_dados_4040_w	fis_reinf_r4040_dados.nr_sequencia%type;

/* Begin Registro 4010 */

c10 CURSOR FOR
    SELECT	nr_sequencia
    from	fis_reinf_r4010_evento
    where	nr_seq_lote = nr_seq_lote_p
    and     ie_selecionado = 'S';

c11 CURSOR FOR
    SELECT	nr_sequencia
    from	fis_reinf_r4010_dados
    where	nr_seq_evento = nr_seq_4010_w;
	
c111 CURSOR FOR
	SELECT	nr_sequencia
    from	fis_reinf_r4010_det_ded
    where	nr_seq_dados = nr_seq_dados_w;
	
c1111 CURSOR FOR
	SELECT	nr_sequencia
    from	fis_reinf_r4010_benef_pen
    where	nr_seq_superior = nr_seq_det_ded_w;
	
c112 CURSOR FOR
	SELECT	nr_sequencia
    from	fis_reinf_r4010_rend_isen
    where	nr_seq_dados = nr_seq_dados_w;

c113 CURSOR FOR
	SELECT	nr_sequencia
    from	fis_reinf_r4010_proc_ret
    where	nr_seq_dados = nr_seq_dados_w;
	
c114 CURSOR FOR
	SELECT	nr_sequencia
    from	fis_reinf_r4010_info_rra
    where	nr_seq_dados = nr_seq_dados_w;
	
c1141 CURSOR FOR
	SELECT	nr_sequencia
    from	fis_reinf_r4010_dpj_or_rra
    where	nr_seq_superior = nr_seq_info_rra_w;

c11411 CURSOR FOR
	SELECT	nr_sequencia
    from	fis_reinf_r4010_ideadv_rra
    where	nr_seq_superior = nr_seq_dpj_or_rra_w;		
	
c115 CURSOR FOR
	SELECT	nr_sequencia
    from	fis_reinf_r4010_proc_jud
    where	nr_seq_dados = nr_seq_dados_w;
	
c1151 CURSOR FOR
	SELECT	nr_sequencia
    from	fis_reinf_r4010_dpj_orec
    where	nr_seq_superior = nr_seq_proc_jud_w;
	
c11511 CURSOR FOR
	SELECT	nr_sequencia
    from	fis_reinf_r4010_ideadv_pj
    where	nr_seq_superior = nr_seq_dpj_orec_w;
	
c12 CURSOR FOR
    SELECT	nr_sequencia
    from	fis_reinf_r4010_inf_pg_ext
	where	nr_seq_evento = nr_seq_4010_w;
	
c13 CURSOR FOR
    SELECT	nr_sequencia
    from	fis_reinf_r4010_op_saude
	where	nr_seq_evento = nr_seq_4010_w;
	
c131 CURSOR FOR
    SELECT	nr_sequencia
    from	fis_reinf_r4010_reemb_tit
	where	nr_seq_superior = nr_seq_op_saude_w;	

c132 CURSOR FOR
    SELECT	nr_sequencia
    from	fis_reinf_r4010_depend_pl
	where	nr_seq_superior = nr_seq_op_saude_w;	

c1321 CURSOR FOR
    SELECT	nr_sequencia
    from	fis_reinf_r4010_reemb_dep
	where	nr_seq_superior = nr_seq_depend_pl_w;
	
/* End Registro 4010 */



/* Begin Registro 4020 */
	

c20 CURSOR FOR
    SELECT	nr_sequencia
    from	fis_reinf_r4020_evento
    where	nr_seq_lote = nr_seq_lote_p
    and     ie_selecionado = 'S';

c21 CURSOR FOR
    SELECT	nr_sequencia
    from	fis_reinf_r4020_dados
    where	nr_seq_evento = nr_seq_4020_w;
	
c211 CURSOR FOR
	SELECT	nr_sequencia
    from	fis_reinf_r4020_proc_jud
    where	nr_seq_dados = nr_seq_dados_4020_w;
	
c2111 CURSOR FOR
	SELECT	nr_sequencia
    from	fis_reinf_r4020_dpj_orec
    where	nr_seq_superior = nr_seq_proc_jud_4020_w;

c21111 CURSOR FOR
	SELECT	nr_sequencia
    from	fis_reinf_r4020_ideadv_pj
    where	nr_seq_superior = nr_seq_proc_jud_4020_w;

c212 CURSOR FOR
	SELECT	nr_sequencia
    from	fis_reinf_r4020_proc_ret
    where	nr_seq_dados = nr_seq_dados_4020_w;
	
c22 CURSOR FOR
    SELECT	nr_sequencia
    from	fis_reinf_r4020_inf_pg_ext
    where	nr_seq_evento = nr_seq_4020_w;
	

/* End Registro 4020 */



/* Begin Registro 4040 */

c30 CURSOR FOR
    SELECT	nr_sequencia
    from	fis_reinf_r4040_evento
    where	nr_seq_lote = nr_seq_lote_p
    and     ie_selecionado = 'S';
	
c31 CURSOR FOR
    SELECT	nr_sequencia
    from	fis_reinf_r4040_dados
    where	nr_seq_evento = nr_seq_4020_w;	


/* End Registro 4040 */

BEGIN

	delete from fis_reinf_consist where nm_usuario = nm_usuario_p and cd_registro = ie_tp_consist_p and nr_seq_lote = nr_seq_lote_p;
	commit;

	if (ie_tp_consist_p = 4010) then
		begin
		
		open c10;
		loop
		fetch c10 into
			nr_seq_4010_w;
		EXIT WHEN NOT FOUND; /* apply on c10 */
			begin
						
				open c11;
				loop
				fetch c11 into
					nr_seq_dados_w;
				EXIT WHEN NOT FOUND; /* apply on c11 */
					
					CALL fis_consist_reinf_4000(nr_seq_dados_w, ie_utilizacao_p, 'fis_reinf_r4010_dados', 4010, nr_seq_4010_w, nr_seq_lote_p, nm_usuario_p); --Todas Plataformas;
				
					open c111;
					loop
					fetch c111 into
						nr_seq_det_ded_w;
					EXIT WHEN NOT FOUND; /* apply on c111 */
					
						CALL fis_consist_reinf_4000(nr_seq_det_ded_w, ie_utilizacao_p, 'fis_reinf_r4010_det_ded', 4010, nr_seq_4010_w, nr_seq_lote_p, nm_usuario_p, 1); --Todas Plataformas
						
						open c1111;
						loop
						fetch c1111 into
							nr_seq_benef_pen_w;
						EXIT WHEN NOT FOUND; /* apply on c1111 */
					
							CALL fis_consist_reinf_4000(nr_seq_benef_pen_w, ie_utilizacao_p, 'fis_reinf_r4010_benef_pen', 4010, nr_seq_4010_w, nr_seq_lote_p, nm_usuario_p, 1); --Todas Plataformas
					
						end loop;
						close c1111;
					
					end loop;
					close c111;
					
					open c112;
					loop
					fetch c112 into
						nr_seq_rend_isen_w;
					EXIT WHEN NOT FOUND; /* apply on c112 */
					
						CALL fis_consist_reinf_4000(nr_seq_rend_isen_w, ie_utilizacao_p, 'fis_reinf_r4010_rend_isen', 4010, nr_seq_4010_w, nr_seq_lote_p, nm_usuario_p, 1); --Todas Plataformas
					
					end loop;
					close c112;
					
					open c113;
					loop
					fetch c113 into
						nr_seq_proc_ret_w;
					EXIT WHEN NOT FOUND; /* apply on c113 */
					
						CALL fis_consist_reinf_4000(nr_seq_proc_ret_w, ie_utilizacao_p, 'fis_reinf_r4010_proc_ret', 4010, nr_seq_4010_w, nr_seq_lote_p, nm_usuario_p, 1); --Todas Plataformas
					
					end loop;
					close c113;
					
					open c114;
					loop
					fetch c114 into
						nr_seq_info_rra_w;
					EXIT WHEN NOT FOUND; /* apply on c114 */
					
						CALL fis_consist_reinf_4000(nr_seq_info_rra_w, ie_utilizacao_p, 'fis_reinf_r4010_info_rra', 4010, nr_seq_4010_w, nr_seq_lote_p, nm_usuario_p, 1); --Todas Plataformas
	
						open c1141;
						loop
						fetch c1141 into
							nr_seq_dpj_or_rra_w;
						EXIT WHEN NOT FOUND; /* apply on c1141 */
						
							CALL fis_consist_reinf_4000(nr_seq_dpj_or_rra_w, ie_utilizacao_p, 'fis_reinf_r4010_dpj_or_rra', 4010, nr_seq_4010_w, nr_seq_lote_p, nm_usuario_p, 1); -- Todas Plataformas
							
							open c11411;
							loop
							fetch c11411 into
								nr_seq_ideadv_rra_w;
							EXIT WHEN NOT FOUND; /* apply on c11411 */
						
								CALL fis_consist_reinf_4000(nr_seq_ideadv_rra_w, ie_utilizacao_p, 'fis_reinf_r4010_ideadv_rra', 4010, nr_seq_4010_w, nr_seq_lote_p, nm_usuario_p, 1); -- Todas Plataformas
							
							end loop;
							close c11411;						
							
						end loop;
						close c1141;
							
					end loop;
					close c114;
					
					open c115;
					loop
					fetch c115 into
						nr_seq_proc_jud_w;
					EXIT WHEN NOT FOUND; /* apply on c115 */
					
						CALL fis_consist_reinf_4000(nr_seq_proc_jud_w, ie_utilizacao_p, 'fis_reinf_r4010_proc_jud', 4010, nr_seq_4010_w, nr_seq_lote_p, nm_usuario_p, 1); -- Todas Plataformas
						
						open c1151;
						loop
						fetch c1151 into
							nr_seq_dpj_orec_w;
						EXIT WHEN NOT FOUND; /* apply on c1151 */
					
							CALL fis_consist_reinf_4000(nr_seq_dpj_orec_w, ie_utilizacao_p, 'fis_reinf_r4010_dpj_orec', 4010, nr_seq_4010_w, nr_seq_lote_p, nm_usuario_p, 1); -- Todas Plataformas
							
							open c11511;
							loop
							fetch c11511 into
								nr_seq_ideadv_pj_w;
							EXIT WHEN NOT FOUND; /* apply on c11511 */
					
								CALL fis_consist_reinf_4000(nr_seq_ideadv_pj_w, ie_utilizacao_p, 'fis_reinf_r4010_ideadv_pj', 4010, nr_seq_4010_w, nr_seq_lote_p, nm_usuario_p, 1); -- Todas Plataformas
													
							end loop;
							close c11511;					
					
						end loop;
						close c1151;
					
					end loop;
					close c115;
					
					
				end loop;
				close c11;
				
				open c12;
				loop
				fetch c12 into
					nr_seq_inf_pg_ext_w;
				EXIT WHEN NOT FOUND; /* apply on c12 */				
					
					CALL fis_consist_reinf_4000(nr_seq_inf_pg_ext_w, ie_utilizacao_p, 'fis_reinf_r4010_inf_pg_ext', 4010, nr_seq_4010_w, nr_seq_lote_p, nm_usuario_p); -- Todas Plataformas
					
				end loop;
				close c12;
				
				open c13;
				loop
				fetch c13 into
					nr_seq_op_saude_w;
				EXIT WHEN NOT FOUND; /* apply on c13 */
					
					CALL fis_consist_reinf_4000(nr_seq_op_saude_w, ie_utilizacao_p, 'fis_reinf_r4010_op_saude', 4010, nr_seq_4010_w, nr_seq_lote_p, nm_usuario_p); -- Todas Plataformas
					
					open c131;
					loop
					fetch c131 into
						nr_seq_reemb_tit_w;
					EXIT WHEN NOT FOUND; /* apply on c131 */
					
						CALL fis_consist_reinf_4000(nr_seq_reemb_tit_w, ie_utilizacao_p, 'fis_reinf_r4010_reemb_tit', 4010, nr_seq_4010_w, nr_seq_lote_p, nm_usuario_p); -- Todas Plataformas
	
					end loop;
					close c131;
					
					open c132;
					loop
					fetch c132 into
						nr_seq_depend_pl_w;
					EXIT WHEN NOT FOUND; /* apply on c132 */
					
						CALL fis_consist_reinf_4000(nr_seq_depend_pl_w, ie_utilizacao_p, 'fis_reinf_r4010_depend_pl', 4010, nr_seq_4010_w, nr_seq_lote_p, nm_usuario_p); -- Todas Plataformas
						
						open c1321;
						loop
						fetch c1321 into
							nr_seq_reemb_dep_w;
						EXIT WHEN NOT FOUND; /* apply on c1321 */
					
							CALL fis_consist_reinf_4000(nr_seq_reemb_dep_w, ie_utilizacao_p, 'fis_reinf_r4010_reemb_dep', 4010, nr_seq_4010_w, nr_seq_lote_p, nm_usuario_p); -- Todas Plataformas
	
						end loop;
						close c1321;
	
					end loop;
					close c132;
									
				end loop;
				close c13;
			end;
		end loop;
		close c10;
			
		end;
	elsif (ie_tp_consist_p = 4020) then
		begin
		
			open c20;
			loop
			fetch c20 into
				nr_seq_4020_w;
			EXIT WHEN NOT FOUND; /* apply on c20 */
				
				open c21;
				loop
				fetch c21 into
					nr_seq_dados_4020_w;
				EXIT WHEN NOT FOUND; /* apply on c21 */
				
					CALL fis_consist_reinf_4000(nr_seq_dados_4020_w, ie_utilizacao_p, 'fis_reinf_r4020_dados', 4020, nr_seq_4020_w, nr_seq_lote_p, nm_usuario_p); -- Todas Plataformas
					
					open c211;
					loop
					fetch c211 into
						nr_seq_proc_jud_4020_w;
					EXIT WHEN NOT FOUND; /* apply on c211 */
				
						CALL fis_consist_reinf_4000(nr_seq_proc_jud_4020_w, ie_utilizacao_p, 'fis_reinf_r4020_proc_jud', 4020, nr_seq_4020_w, nr_seq_lote_p, nm_usuario_p, 1); -- Todas Plataformas
						
						open c2111;
						loop
						fetch c2111 into
							nr_seq_dpj_orec_4020_w;
						EXIT WHEN NOT FOUND; /* apply on c2111 */
				
							CALL fis_consist_reinf_4000(nr_seq_dpj_orec_4020_w, ie_utilizacao_p, 'fis_reinf_r4020_dpj_orec', 4020, nr_seq_4020_w, nr_seq_lote_p, nm_usuario_p, 1); -- Todas Plataformas
						
							open c21111;
							loop
							fetch c21111 into
								nr_seq_ideadv_pj_4020_w;
							EXIT WHEN NOT FOUND; /* apply on c21111 */
				
								CALL fis_consist_reinf_4000(nr_seq_ideadv_pj_4020_w, ie_utilizacao_p, 'fis_reinf_r4020_ideadv_pj', 4020, nr_seq_4020_w, nr_seq_lote_p, nm_usuario_p, 1); -- Todas Plataformas
				
							end loop;
							close c21111;
			
						end loop;
						close c2111;
									
					end loop;
					close c211;
					
					open c212;
					loop
					fetch c212 into
						nr_seq_proc_ret_4020_w;
					EXIT WHEN NOT FOUND; /* apply on c212 */
				
						CALL fis_consist_reinf_4000(nr_seq_proc_ret_4020_w, ie_utilizacao_p, 'fis_reinf_r4020_proc_ret', 4020, nr_seq_4020_w, nr_seq_lote_p, nm_usuario_p); -- Todas Plataformas
											
					end loop;
					close c212;
									
				end loop;
				close c21;
				
				open c22;
				loop
				fetch c22 into
					nr_seq_inf_pg_ext_4020_w;
				EXIT WHEN NOT FOUND; /* apply on c22 */
				
					CALL fis_consist_reinf_4000(nr_seq_inf_pg_ext_4020_w, ie_utilizacao_p, 'fis_reinf_r4020_inf_pg_ext', 4020, nr_seq_4020_w, nr_seq_lote_p, nm_usuario_p);
									
				end loop;
				close c22;
									
			end loop;
			close c20;
					
		end;
	elsif (ie_tp_consist_p = 4040) then
		begin
		
			open c30;
			loop
			fetch c30 into
				nr_seq_4040_w;
			EXIT WHEN NOT FOUND; /* apply on c30 */
				open c31;
				loop
				fetch c31 into
					nr_seq_dados_4040_w;
				EXIT WHEN NOT FOUND; /* apply on c31 */
					
					CALL fis_consist_reinf_4000(nr_seq_dados_4040_w, ie_utilizacao_p, 'fis_reinf_r4040_dados', 4040, nr_seq_4040_w, nr_seq_lote_p, nm_usuario_p);
					
				end loop;
				close c31;
				
			end loop;
			close c30;
		end;
	end if;
	
	commit;
	
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consistir_evento_reinf_4000 ( nr_seq_lote_p bigint, ie_utilizacao_p text, ie_tp_consist_p bigint, nm_usuario_p text) FROM PUBLIC;

