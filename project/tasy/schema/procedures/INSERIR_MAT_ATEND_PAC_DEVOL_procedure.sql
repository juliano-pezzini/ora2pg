-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_mat_atend_pac_devol ( nr_atendimento_p bigint, cd_material_p bigint, cd_unidade_medida_p text, cd_setor_atendimento_p bigint, dt_atendimento_p timestamp, qt_material_p bigint, nr_seq_atepacu_p bigint, dt_entrada_unidade_p timestamp, nr_sequencia_prescricao_p bigint, nr_cirurgia_p bigint, nr_prescricao_p bigint, nm_usuario_p text, cd_material_exec_p bigint, dt_conta_p timestamp , cd_cgc_fornecedor_p text, nr_serie_material_p text, nr_seq_cor_exec_p bigint, cd_material_prescricao_p bigint, ie_via_aplicacao_p text, cd_local_estoque_p bigint, qt_executada_p bigint, dt_prescricao_p timestamp, nr_seq_lote_fornec_p bigint, ds_observacao_p text, qt_devolvida_p bigint, cd_motivo_devolucao_p bigint, nr_seq_tipo_baixa_p bigint) AS $body$
DECLARE

					nr_sequencia_p			bigint;
		
cd_convenio_w			material_atend_paciente.cd_convenio%type;
cd_categoria_w			material_atend_paciente.cd_categoria%type;
nr_doc_convenio_w		material_atend_paciente.nr_doc_convenio%type;
ie_tipo_guia_w			material_atend_paciente.ie_tipo_guia%type;
cd_senha_w			material_atend_paciente.cd_senha%type;
ie_tipo_lancamento_mat_w	varchar(10);
					

BEGIN 
 
SELECT * FROM obter_convenio_execucao(nr_atendimento_p, dt_atendimento_p, cd_convenio_w, cd_categoria_w, nr_doc_convenio_w, ie_tipo_guia_w, cd_senha_w) INTO STRICT cd_convenio_w, cd_categoria_w, nr_doc_convenio_w, ie_tipo_guia_w, cd_senha_w;
ie_tipo_lancamento_mat_w := obter_param_usuario(36, 157, obter_perfil_ativo, nm_usuario_p, wheb_usuario_pck.get_cd_estabelecimento, ie_tipo_lancamento_mat_w);
 
select	nextval('material_atend_paciente_seq') 
into STRICT	nr_sequencia_p
;
 
if (nr_atendimento_p IS NOT NULL AND nr_atendimento_p::text <> '') and (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '') and (dt_entrada_unidade_p IS NOT NULL AND dt_entrada_unidade_p::text <> '') and (dt_atendimento_p IS NOT NULL AND dt_atendimento_p::text <> '') and (cd_unidade_medida_p IS NOT NULL AND cd_unidade_medida_p::text <> '') and (qt_material_p IS NOT NULL AND qt_material_p::text <> '') and (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') and (cd_setor_atendimento_p IS NOT NULL AND cd_setor_atendimento_p::text <> '') and (nr_seq_atepacu_p IS NOT NULL AND nr_seq_atepacu_p::text <> '') and (cd_material_p IS NOT NULL AND cd_material_p::text <> '') then 
	begin 
	 
	insert 	into material_atend_paciente( 
			nm_usuario, 
			dt_atualizacao, 
			cd_acao, 
			nr_sequencia, 
			nr_atendimento, 
			cd_material, 
			cd_unidade_medida, 
			cd_setor_atendimento, 
			dt_atendimento, 
			nr_seq_atepacu, 
			qt_material, 
			dt_entrada_unidade, 
			nr_sequencia_prescricao, 
			nr_cirurgia, 
			nr_prescricao,			 
			cd_material_exec, 
			dt_conta, 
			cd_cgc_fornecedor, 
			nr_serie_material, 
			nr_seq_cor_exec, 
			cd_material_prescricao, 
			ie_via_aplicacao, 
			cd_local_estoque, 
			qt_executada, 
			dt_prescricao, 
			nr_seq_lote_fornec, 
			cd_convenio, 
			cd_categoria, 
			nr_doc_convenio, 
			ie_tipo_guia, 
			cd_senha, 
			vl_unitario, 
			qt_ajuste_conta, 
			ie_valor_informado, 
			ie_guia_informada, 
			ie_auditoria, 
			nm_usuario_original, 
			cd_situacao_glosa, 
			ds_observacao, 
			qt_devolvida, 
			cd_motivo_devolucao, 
			nr_seq_tipo_baixa) 
		values (nm_usuario_p, 
			clock_timestamp(), 
			'1', 
			nr_sequencia_p, 
			nr_atendimento_p, 
			cd_material_p, 
			cd_unidade_medida_p, 
			cd_setor_atendimento_p, 
			dt_atendimento_p, 
			nr_seq_atepacu_p, 
			qt_material_p, 
			dt_entrada_unidade_p, 
			nr_sequencia_prescricao_p, 
			CASE WHEN coalesce(nr_cirurgia_p,0)=0 THEN null  ELSE nr_cirurgia_p END , 
			nr_prescricao_p, 
			cd_material_exec_p, 
			dt_conta_p, 
			cd_cgc_fornecedor_p, 
			nr_serie_material_p, 
			nr_seq_cor_exec_p, 
			cd_material_prescricao_p, 
			ie_via_aplicacao_p, 
			cd_local_estoque_p, 
			qt_executada_p, 
			dt_prescricao_p, 
			nr_seq_lote_fornec_p, 
			cd_convenio_w, 
			cd_categoria_w,	 
			nr_doc_convenio_w, 
			ie_tipo_guia_w, 
			cd_senha_w, 
			0, 
			0, 
			'N', 
			'N', 
			'N', 
			nm_usuario_p, 
			0, 
			ds_observacao_p, 
			qt_devolvida_p, 
			cd_motivo_devolucao_p, 
			nr_seq_tipo_baixa_p);			
		 
	commit;
	end;
end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_mat_atend_pac_devol ( nr_atendimento_p bigint, cd_material_p bigint, cd_unidade_medida_p text, cd_setor_atendimento_p bigint, dt_atendimento_p timestamp, qt_material_p bigint, nr_seq_atepacu_p bigint, dt_entrada_unidade_p timestamp, nr_sequencia_prescricao_p bigint, nr_cirurgia_p bigint, nr_prescricao_p bigint, nm_usuario_p text, cd_material_exec_p bigint, dt_conta_p timestamp , cd_cgc_fornecedor_p text, nr_serie_material_p text, nr_seq_cor_exec_p bigint, cd_material_prescricao_p bigint, ie_via_aplicacao_p text, cd_local_estoque_p bigint, qt_executada_p bigint, dt_prescricao_p timestamp, nr_seq_lote_fornec_p bigint, ds_observacao_p text, qt_devolvida_p bigint, cd_motivo_devolucao_p bigint, nr_seq_tipo_baixa_p bigint) FROM PUBLIC;

