-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE aut_duplicar_receita_farmacia ( nr_sequencia_p aut_receita_farmacia.nr_sequencia%type, nr_atendimento_p aut_receita_farmacia.nr_atendimento%type, nm_usuario_p aut_receita_farmacia.nm_usuario%type ) AS $body$
DECLARE

    nr_sequencia_w aut_receita_farmacia.nr_sequencia%type;

BEGIN

    select nextval('aut_receita_farmacia_seq')
    into STRICT   nr_sequencia_w
;

    insert into aut_receita_farmacia(
           nr_sequencia,
           cd_estabelecimento,
           cd_medico,
           cd_pessoa_fisica,
           ds_justificativa,
           nr_atendimento,
           nm_usuario,
           dt_atualizacao,
           nm_usuario_nrec,
           dt_atualizacao_nrec,
           dt_liberacao,
           nm_usuario_inativacao,
           dt_inativacao)
    SELECT nr_sequencia_w,
           cd_estabelecimento,
           cd_medico,
           cd_pessoa_fisica,
           ds_justificativa,
           nr_atendimento_p,
           nm_usuario_p,
           clock_timestamp(),
           nm_usuario_p,
           clock_timestamp(),
           null,
           null,
           null
    from   aut_receita_farmacia
    where  nr_sequencia = nr_sequencia_p;

    insert into aut_receita_farmacia_item(
           nr_sequencia,
           nr_seq_receita,
           cd_intervalo,
           cd_material,
           cd_material_prescrito,
           cd_unidade_medida,
           ds_dose_diferenciada,
           ds_inconsistencia,
           ds_material_pac,
           ie_via_aplicacao,
           qt_dose,
           qt_dose_almoco,
           qt_dose_manha,
           qt_dose_noite,
           qt_dose_tarde,
           qt_pacote,
           nm_usuario,
           dt_atualizacao,
           nm_usuario_nrec,
           dt_atualizacao_nrec)
    SELECT nextval('aut_receita_farmacia_item_seq'),
           nr_sequencia_w,
           cd_intervalo,
           cd_material,
           cd_material_prescrito,
           cd_unidade_medida,
           ds_dose_diferenciada,
           ds_inconsistencia,
           ds_material_pac,
           ie_via_aplicacao,
           qt_dose,
           qt_dose_almoco,
           qt_dose_manha,
           qt_dose_noite,
           qt_dose_tarde,
           qt_pacote,
           nm_usuario_p,
           clock_timestamp(),
           nm_usuario_p,
           clock_timestamp()
    from   aut_receita_farmacia_item
    where  nr_seq_receita = nr_sequencia_p;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE aut_duplicar_receita_farmacia ( nr_sequencia_p aut_receita_farmacia.nr_sequencia%type, nr_atendimento_p aut_receita_farmacia.nr_atendimento%type, nm_usuario_p aut_receita_farmacia.nm_usuario%type ) FROM PUBLIC;

