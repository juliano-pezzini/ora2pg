-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gng_excluir_integridade_ant () AS $body$
DECLARE


qt_registro_w	bigint;

BEGIN

/* ================= INICIO - Eliminar INTEGRIDADES ANTIGAS PARA SUBSTITUIR ===============*/

/* CUS_CENTRO_TERC_CRIT */

select	count(*)
into STRICT	qt_registro_w
from	user_cons_columns a
where	a.constraint_name 	= 'CUSCETC_GRUNAGA_FK'
and	a.table_name		= 'CUS_CENTRO_TERC_CRIT'
and	a.column_name		= 'NR_SEQ_GNG';

if (qt_registro_w = 0) then
	CALL exec_sql_dinamico('BACA_GNG_PK','alter table cus_centro_terc_crit drop constraint CUSCETC_GRUNAGA_FK');
end if;

/* CUS_REGRA_IMP_CONTAB*/

select	count(*)
into STRICT	qt_registro_w
from	user_cons_columns a
where	a.constraint_name 	= 'CUSREIC_GRUNAGA_FK'
and	a.table_name		= 'CUS_REGRA_IMP_CONTAB'
and	a.column_name		= 'NR_SEQ_GNG';

if (qt_registro_w = 0) then
	CALL exec_sql_dinamico('BACA_GNG_PK','alter table CUS_REGRA_IMP_CONTAB drop constraint CUSREIC_GRUNAGA_FK');
end if;

/*CENTRO_CONTROLE_TIPO_GASTO*/

select	count(*)
into STRICT	qt_registro_w
from	user_cons_columns a
where	a.constraint_name 	= 'CENTPGA_GRUNAGA_FK'
and	a.table_name		= 'CENTRO_CONTROLE_TIPO_GASTO'
and	a.column_name		= 'NR_SEQ_GNG';

if (qt_registro_w = 0) then
	CALL exec_sql_dinamico('BACA_GNG_PK','alter table CENTRO_CONTROLE_TIPO_GASTO drop constraint CENTPGA_GRUNAGA_FK');
end if;

/* CRITERIO_DISTR_ORC*/

select	count(*)
into STRICT	qt_registro_w
from	user_cons_columns
where	table_name = 'CRITERIO_DISTR_ORC'
and	constraint_name = 'CRIDIOR_GRUNAGA_FK'
and	column_name	= 'NR_SEQ_GNG';

if (qt_registro_w = 0) then
	CALL exec_sql_dinamico('BACA_GNG_PK','alter table CRITERIO_DISTR_ORC drop constraint CRIDIOR_GRUNAGA_FK');
end if;

select	count(*)
into STRICT	qt_registro_w
from	user_cons_columns
where	table_name = 'CRITERIO_DISTR_ORC'
and	constraint_name = 'CRIDIOR_GRUNAGA_FK4'
and	column_name	= 'NR_SEQ_GNG_REF';

if (qt_registro_w = 0) then
	CALL exec_sql_dinamico('BACA_GNG_PK','alter table CRITERIO_DISTR_ORC drop constraint CRIDIOR_GRUNAGA_FK4');
end if;

/* NATUREZA_GASTO */

select	count(*)
into STRICT	qt_registro_w
from	user_cons_columns
where	table_name = 'NATUREZA_GASTO'
and	constraint_name = 'NATGAST_GRUNAGA_FK'
and	column_name	= 'NR_SEQ_GNG';

if (qt_registro_w = 0) then
	CALL exec_sql_dinamico('BACA_GNG_PK','alter table NATUREZA_GASTO drop constraint NATGAST_GRUNAGA_FK');
end if;

/*REGRA_CALC_ORC_CUSTO*/

select	count(*)
into STRICT	qt_registro_w
from	user_cons_columns
where	table_name = 'REGRA_CALC_ORC_CUSTO'
and	constraint_name = 'REGCAOC_GRUNAGA_FK'
and	column_name	= 'NR_SEQ_GNG';

if (qt_registro_w = 0) then
	CALL exec_sql_dinamico('BACA_GNG_PK','alter table REGRA_CALC_ORC_CUSTO drop constraint REGCAOC_GRUNAGA_FK');
end if;

/*TAXA_CUSTO*/

select	count(*)
into STRICT	qt_registro_w
from	user_cons_columns
where	table_name = 'TAXA_CUSTO'
and	constraint_name = 'TAXCUST_GRUNAGA_FK'
and	column_name	= 'NR_SEQ_GNG';

if (qt_registro_w = 0) then
	CALL exec_sql_dinamico('BACA_GNG_PK','alter table TAXA_CUSTO drop constraint TAXCUST_GRUNAGA_FK');
end if;

/* TAXA_CUSTO_NAT */

select	count(*)
into STRICT	qt_registro_w
from	user_cons_columns
where	table_name = 'TAXA_CUSTO_NAT'
and	constraint_name = 'TAXCUNA_GRUNAGA_FK'
and	column_name	= 'NR_SEQ_GNG';

if (qt_registro_w = 0) then
	CALL exec_sql_dinamico('BACA_GNG_PK','alter table TAXA_CUSTO_NAT drop constraint TAXCUNA_GRUNAGA_FK');
end if;
/* ========================= FIM Exclusão Integridades ====================================== */

/* =================== Exclusão CHAVE Primária da GRUPO_NATUREZA_GASTO (CD_ESTABELECIMENTO, CD_GRUPO_NATUREZA_GASTO) === */

select	count(*)
into STRICT	qt_registro_w
from	user_cons_columns
where	table_name	= 'GRUPO_NATUREZA_GASTO'
and	constraint_name	= 'GRUNAGA_PK'
and	column_name	= 'NR_SEQUENCIA';

if (qt_registro_w = 0) then
	CALL exec_sql_dinamico('BACA_GNG_PK','alter table GRUPO_NATUREZA_GASTO drop constraint GRUNAGA_PK');
	CALL exec_sql_dinamico('BACA_GNG_PK','drop index GRUNAGA_PK');
end if;

/*====================== FIM EXCLUSÂO CHAVE PRIMARIA GNG ===================================*/

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gng_excluir_integridade_ant () FROM PUBLIC;

