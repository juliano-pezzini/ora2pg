-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ptu_gerar_trailer_fatura_pre ( nr_seq_fatura_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE


vl_tot_mensalidade_original_w	double precision;
vl_tot_inscricao_original_w	double precision;
vl_tot_mensalidade_cobrado_w	double precision;
vl_tot_inscricao_cobrado_w	double precision;
qt_tot_beneficiarios_w		bigint;
vl_tot_total_ajuste_w		double precision;


BEGIN

select	sum(vl_mensalidade_original),
	sum(vl_inscricao_original),
	sum(vl_mensalidade_cobrado),
	sum(vl_inscricao_cobrado),
	sum(vl_ajuste_cobrado)
into STRICT	vl_tot_mensalidade_original_w,
	vl_tot_inscricao_original_w,
	vl_tot_mensalidade_cobrado_w,
	vl_tot_inscricao_cobrado_w,
	vl_tot_total_ajuste_w
from	ptu_fatura_pre_cobranca
where	nr_seq_fatura	= nr_seq_fatura_p;

select	count(*)
into STRICT	qt_tot_beneficiarios_w
from	ptu_fatura_pre_cobranca
where	nr_seq_fatura	= nr_seq_fatura_p;

insert into ptu_fatura_pre_total(	nr_sequencia,dt_atualizacao,nm_usuario,dt_atualizacao_nrec,nm_usuario_nrec,
		nr_seq_fatura,vl_tot_mens_original,vl_tot_insc_original,vl_total_mensalidade,vl_total_inscricao,
		vl_total_ajuste,qt_total_r802,tp_registro	)
values (	nextval('ptu_fatura_pre_total_seq'),clock_timestamp(),nm_usuario_p,clock_timestamp(),nm_usuario_p,
		nr_seq_fatura_p,coalesce(vl_tot_mensalidade_original_w,0),coalesce(vl_tot_inscricao_original_w,0),coalesce(vl_tot_mensalidade_cobrado_w,0),coalesce(vl_tot_inscricao_cobrado_w,0),
		coalesce(vl_tot_total_ajuste_w,0),qt_tot_beneficiarios_w,9);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ptu_gerar_trailer_fatura_pre ( nr_seq_fatura_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

