-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE save_transmit_era ( ie_response_p text, ds_response_p text, account_reference_id_p bigint, charge_amount_decimal_p bigint, claim_fund_assessment_p text, claim_fund_assessment_cde_p bigint, co_payment_amount_p bigint, dc_claim_id_p bigint, dva_claim_id_p bigint, excess_amount_p text, excess_amount_decimal_p bigint, facility_p text, fund_benefit_amount_decimal_p bigint, fund_brand_id_p bigint, fund_claim_explanations_p text, fund_explanations_p text, fund_referenceid_p bigint, fund_service_explanations_p text, fund_status_code_p bigint, invoice_p bigint, invoice_id_p bigint, number_of_services_p bigint, service_details_p text, total_benefit_amount_p bigint, total_charge_amount_p bigint, total_payment_p bigint, transaction_id_p bigint) AS $body$
DECLARE

  /*
  ie_response_p
  S - Success
  F - Failed
  */
  ie_exists_response_w smallint;

BEGIN
  select coalesce(max(1),0)
  into STRICT ie_exists_response_w
  from era_response
  where invoice_id         = invoice_id_p
  and nr_claim_id          = dc_claim_id_p;
  if (ie_exists_response_w = 0) then
    insert
    into era_response(
        ie_response,
        ds_response,
        account_reference_id,
        charge_amount_decimal,
        claim_fund_assessment,
        claim_fund_assessment_cde,
        co_payment_amount,
        dc_claim_id,
        dva_claim_id,
        excess_amount,
        excess_amount_decimal,
        facility,
        fund_benefit_amount_decimal,
        fund_brand_id,
        fund_claim_explanations,
        fund_explanations,
        fund_referenceid,
        fund_service_explanations,
        fund_status_code,
        invoice,
        invoice_id,
        number_of_services,
        service_details,
        total_benefit_amount,
        total_charge_amount,
        total_payment,
        transaction_id
      )
      values (
        ie_response_p,
        substr(ds_response_p,1,4000),
        account_reference_id_p,
        charge_amount_decimal_p,
        claim_fund_assessment_p,
        claim_fund_assessment_cde_p,
        co_payment_amount_p,
        dc_claim_id_p,
        dva_claim_id_p,
        excess_amount_p,
        excess_amount_decimal_p,
        facility_p,
        fund_benefit_amount_decimal_p,
        fund_brand_id_p,
        fund_claim_explanations_p,
        fund_explanations_p,
        fund_referenceid_p,
        fund_service_explanations_p,
        fund_status_code_p,
        invoice_p,
        invoice_id_p,
        number_of_services_p,
        service_details_p,
        total_benefit_amount_p,
        total_charge_amount_p,
        total_payment_p,
        transaction_id_p
      );
    commit;
  end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE save_transmit_era ( ie_response_p text, ds_response_p text, account_reference_id_p bigint, charge_amount_decimal_p bigint, claim_fund_assessment_p text, claim_fund_assessment_cde_p bigint, co_payment_amount_p bigint, dc_claim_id_p bigint, dva_claim_id_p bigint, excess_amount_p text, excess_amount_decimal_p bigint, facility_p text, fund_benefit_amount_decimal_p bigint, fund_brand_id_p bigint, fund_claim_explanations_p text, fund_explanations_p text, fund_referenceid_p bigint, fund_service_explanations_p text, fund_status_code_p bigint, invoice_p bigint, invoice_id_p bigint, number_of_services_p bigint, service_details_p text, total_benefit_amount_p bigint, total_charge_amount_p bigint, total_payment_p bigint, transaction_id_p bigint) FROM PUBLIC;

