-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cus_inserir_ficha_tecnica ( nm_usuario_p ficha_tecnica_componente.nm_usuario%type, cd_estabelecimento_p ficha_tecnica_componente.cd_estabelecimento%type, nr_ficha_tecnica_p ficha_tecnica_componente.nr_ficha_tecnica%type, ie_tipo_componente_p ficha_tecnica_componente.ie_tipo_componente%type, qt_variavel_p ficha_tecnica_componente.qt_variavel%type, qt_fixa_p ficha_tecnica_componente.qt_fixa%type, pr_quebra_variavel_p ficha_tecnica_componente.pr_quebra_variavel%type, dt_inicio_vigencia_p ficha_tecnica_componente.dt_inicio_vigencia%type, dt_fim_vigencia_p ficha_tecnica_componente.dt_fim_vigencia%type, cd_material_p ficha_tecnica_componente.cd_material%type, qt_material_p ficha_tecnica_componente.qt_material%type, qt_dose_p ficha_tecnica_componente.qt_dose%type, cd_unidade_medida_dose_p ficha_tecnica_componente.cd_unidade_medida_dose%type, cd_procedimento_p ficha_tecnica_componente.cd_procedimento%type, ie_origem_proced_p ficha_tecnica_componente.ie_origem_proced%type, nr_seq_exame_p ficha_tecnica_componente.nr_seq_exame%type, nr_seq_proc_interno_p ficha_tecnica_componente.nr_seq_proc_interno%type, cd_centro_controle_p ficha_tecnica_componente.cd_centro_controle%type, ie_necessita_disp_p ficha_tecnica_componente.ie_necessita_disp%type ) AS $body$
DECLARE


nr_seq_componente_w	ficha_tecnica_componente.nr_seq_componente%type;


BEGIN

select	coalesce(max(a.nr_seq_componente),0)
into STRICT	nr_seq_componente_w
from	ficha_tecnica_componente a
where	a.nr_ficha_tecnica = nr_ficha_tecnica_p;

insert into ficha_tecnica_componente(
	nr_seq_componente,
	nr_ficha_tecnica,
	dt_alteracao,
	cd_estabelecimento,
	nm_usuario,
	dt_atualizacao,
	nm_usuario_nrec,
	dt_atualizacao_nrec,
	ie_situacao,
	ie_tipo_componente,
	qt_variavel,
	qt_fixa,
	pr_quebra_variavel,
	dt_inicio_vigencia,
	dt_fim_vigencia,
	cd_material,
	qt_material,
	qt_dose,
	cd_unidade_medida_dose,
	cd_procedimento,
	ie_origem_proced,
	nr_seq_exame,
	nr_seq_proc_interno,
	cd_centro_controle,
	ie_necessita_disp)
values (	nr_seq_componente_w + 1,
	nr_ficha_tecnica_p,
	clock_timestamp(),
	cd_estabelecimento_p,
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	'A',
	ie_tipo_componente_p,
	qt_variavel_p,
	qt_fixa_p,
	pr_quebra_variavel_p,
	dt_inicio_vigencia_p,
	dt_fim_vigencia_p,
	cd_material_p,
	qt_material_p,
	qt_dose_p,
	cd_unidade_medida_dose_p,
	CASE WHEN cd_procedimento_p=0 THEN null  ELSE cd_procedimento_p END ,
	CASE WHEN ie_origem_proced_p=0 THEN null  ELSE ie_origem_proced_p END ,
	CASE WHEN nr_seq_exame_p=0 THEN null  ELSE nr_seq_exame_p END ,
	CASE WHEN nr_seq_proc_interno_p=0 THEN null  ELSE nr_seq_proc_interno_p END ,
	CASE WHEN cd_centro_controle_p=0 THEN null  ELSE cd_centro_controle_p END ,
	ie_necessita_disp_p);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cus_inserir_ficha_tecnica ( nm_usuario_p ficha_tecnica_componente.nm_usuario%type, cd_estabelecimento_p ficha_tecnica_componente.cd_estabelecimento%type, nr_ficha_tecnica_p ficha_tecnica_componente.nr_ficha_tecnica%type, ie_tipo_componente_p ficha_tecnica_componente.ie_tipo_componente%type, qt_variavel_p ficha_tecnica_componente.qt_variavel%type, qt_fixa_p ficha_tecnica_componente.qt_fixa%type, pr_quebra_variavel_p ficha_tecnica_componente.pr_quebra_variavel%type, dt_inicio_vigencia_p ficha_tecnica_componente.dt_inicio_vigencia%type, dt_fim_vigencia_p ficha_tecnica_componente.dt_fim_vigencia%type, cd_material_p ficha_tecnica_componente.cd_material%type, qt_material_p ficha_tecnica_componente.qt_material%type, qt_dose_p ficha_tecnica_componente.qt_dose%type, cd_unidade_medida_dose_p ficha_tecnica_componente.cd_unidade_medida_dose%type, cd_procedimento_p ficha_tecnica_componente.cd_procedimento%type, ie_origem_proced_p ficha_tecnica_componente.ie_origem_proced%type, nr_seq_exame_p ficha_tecnica_componente.nr_seq_exame%type, nr_seq_proc_interno_p ficha_tecnica_componente.nr_seq_proc_interno%type, cd_centro_controle_p ficha_tecnica_componente.cd_centro_controle%type, ie_necessita_disp_p ficha_tecnica_componente.ie_necessita_disp%type ) FROM PUBLIC;

