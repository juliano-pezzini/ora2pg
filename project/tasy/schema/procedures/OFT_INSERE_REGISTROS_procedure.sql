-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE oft_insere_registros ( nr_seq_consulta_p bigint, nr_seq_consulta_form_ant_p bigint, vLista strRecTypeFormOft) AS $body$
DECLARE


vOftAnamnese_w						strRecTypeFormOft := strRecTypeFormOft();
vOftAutoRefracao_w				strRecTypeFormOft := strRecTypeFormOft();
xOftTonometriaAplanacao_w		strRecTypeFormOft := strRecTypeFormOft();
xOftTonometriaPneumatica_w		strRecTypeFormOft := strRecTypeFormOft();
vOftRefracao_w						strRecTypeFormOft := strRecTypeFormOft();
vOftBiomicroscopia_w				strRecTypeFormOft := strRecTypeFormOft();
vOftFundoscopia_w					strRecTypeFormOft := strRecTypeFormOft();
vOftConduta_w						strRecTypeFormOft := strRecTypeFormOft();
vOftAngiofluorsceinografia_w  strRecTypeFormOft := strRecTypeFormOft();
vOftRetinografia_w            strRecTypeFormOft := strRecTypeFormOft();
vOftBiometria_w					strRecTypeFormOft := strRecTypeFormOft();
vOftCampimetria_w					strRecTypeFormOft := strRecTypeFormOft();
vOftCapsulotomia_w				strRecTypeFormOft := strRecTypeFormOft();
vOftCerastocopia_w				strRecTypeFormOft := strRecTypeFormOft();
vOftConsultaLente_w				strRecTypeFormOft := strRecTypeFormOft();
vOftCurvaTencional_w				strRecTypeFormOft := strRecTypeFormOft();
vOftDaltonismo_w					strRecTypeFormOft := strRecTypeFormOft();
vOftDiagnosticoFamiliar_w		strRecTypeFormOft := strRecTypeFormOft();
vOftDiagnosticoPaciente_w1		strRecTypeFormOft := strRecTypeFormOft();
vOftDiagnosticoPaciente_w2		strRecTypeFormOft := strRecTypeFormOft();
vOftDiagnosticoPaciente_w3		strRecTypeFormOft := strRecTypeFormOft();
vOftDiagnosticoPaciente_w4		strRecTypeFormOft := strRecTypeFormOft();
vOftDiagnosticoPaciente_w5		strRecTypeFormOft := strRecTypeFormOft();
vOftDiagnosticoPaciente_w6		strRecTypeFormOft := strRecTypeFormOft();
vOftDiagnosticoPaciente_w7		strRecTypeFormOft := strRecTypeFormOft();
vOftDnp_w							strRecTypeFormOft := strRecTypeFormOft();
vOftExameExterno_w				strRecTypeFormOft := strRecTypeFormOft();
vOftFotocoagulacaoLaser_w		strRecTypeFormOft := strRecTypeFormOft();
vOftGonioscopia_w					strRecTypeFormOft := strRecTypeFormOft();
vOftIridectomia_w					strRecTypeFormOft := strRecTypeFormOft();
vOftMapeamentoRetina_w			strRecTypeFormOft := strRecTypeFormOft();
vOftMicroscopiaEspecular_w		strRecTypeFormOft := strRecTypeFormOft();
vOftMotilidadeOcular_w			strRecTypeFormOft := strRecTypeFormOft();
vOftOct_w							strRecTypeFormOft := strRecTypeFormOft();
vOftOculos_w						strRecTypeFormOft := strRecTypeFormOft();
vOftOlhoSeco_w						strRecTypeFormOft := strRecTypeFormOft();
vOftPaquimetria_w					strRecTypeFormOft := strRecTypeFormOft();
vOftPaquimetriaUltra_w			strRecTypeFormOft := strRecTypeFormOft();
vOftPotencialAcuidade_w			strRecTypeFormOft := strRecTypeFormOft();
vOftPupilometria_w				strRecTypeFormOft := strRecTypeFormOft();
vOftSobrecargaHidrica_w			strRecTypeFormOft := strRecTypeFormOft();
vOftTomografiaOlho_w				strRecTypeFormOft := strRecTypeFormOft();
vOftUltrassonografia_w			strRecTypeFormOft := strRecTypeFormOft();
vOftCorrecaoAmbos_w				strRecTypeFormOft := strRecTypeFormOft();
vOftCorrecaoContato_w			strRecTypeFormOft := strRecTypeFormOft();
vOftCorrecaoSem_w					strRecTypeFormOft := strRecTypeFormOft();
vOftCorrecaoOculos_w				strRecTypeFormOft := strRecTypeFormOft();
vOftAcuidadeVisual_w				strRecTypeFormOft := strRecTypeFormOft();
vOftDiagDoenca_w					strRecTypeFormOft := strRecTypeFormOft();
vOftAcuidadeCorrecao_w        strRecTypeFormOft := strRecTypeFormOft();
vOftAberrometria_w            strRecTypeFormOft := strRecTypeFormOft();
vOftPatientComplaints_w strRecTypeFormOft := strRecTypeFormOft();
vOftRedDotTest_w strRecTypeFormOft        := strRecTypeFormOft();
vOftGradeAmsler_w strRecTypeFormOft       := strRecTypeFormOft();
nr_seq_regra_form_w 				bigint;
ie_registrar_w						varchar(1)	:=	'S';
dt_liberacao_w						timestamp;
nr_seq_consulta_form_w			oft_consulta_formulario.nr_sequencia%TYPE;
nr_seq_consulta_form_ww			oft_consulta_formulario.nr_sequencia%TYPE;
nm_usuario_w					usuario.nm_usuario%TYPE := wheb_usuario_pck.get_nm_usuario;
nr_seq_tipo_conuslta_w			oft_consulta.nr_seq_tipo_consulta%TYPE;
nr_encounter_w bigint;

c01 CURSOR FOR
	SELECT	dt_liberacao,
				nr_sequencia
	FROM		oft_consulta_formulario
	WHERE		nr_seq_consulta 	= 	nr_seq_consulta_p
	AND		nr_seq_regra_form	=	nr_seq_regra_form_w
	and ((dt_liberacao IS NOT NULL AND dt_liberacao::text <> '') or nm_usuario = nm_usuario_w)
	ORDER BY dt_liberacao DESC;



BEGIN
CALL wheb_usuario_pck.set_ie_commit('N');

FOR i IN 1..vLista.COUNT LOOP
	BEGIN
	CASE UPPER(vLista[i].nm_tabela)
		WHEN 'GRADE_AMSLER' THEN
            BEGIN
            vOftGradeAmsler_w.EXTEND;
            vOftGradeAmsler_w(vOftGradeAmsler_w.last) := vLista(i);
            nr_encounter_w                            := vLista[i].nr_aux_2;
            END;
        WHEN 'EXAME_PONTOS_VERMELHOS' THEN
        	BEGIN
          	vOftRedDotTest_w.EXTEND;
          	vOftRedDotTest_w(vOftRedDotTest_w.last) := vLista(i);
          	nr_encounter_w                          := vLista[i].nr_aux_2;
        	END;
	    WHEN 'ATEND_QUEIXA_PACIENTE' THEN
			BEGIN
			vOftPatientComplaints_w.EXTEND;
			vOftPatientComplaints_w(vOftPatientComplaints_w.last) := vLista(i);
      		nr_encounter_w := vLista[i].nr_aux_2;
			END;
		WHEN 'OFT_ACUIDADE_VISUAL' THEN
			BEGIN
			vOftAcuidadeVisual_w.EXTEND;
			vOftAcuidadeVisual_w(vOftAcuidadeVisual_w.last) := vLista(i);
			END;
		WHEN 'DIAGNOSTICO_DOENCA' THEN
			BEGIN
			vOftDiagDoenca_w.EXTEND;
			vOftDiagDoenca_w(vOftDiagDoenca_w.last) := vLista(i);
			END;				
		WHEN 'OFT_ANAMNESE' THEN
			BEGIN
			vOftAnamnese_w.EXTEND;
			vOftAnamnese_w(vOftAnamnese_w.last) := vLista(i);
			END;
		WHEN 'OFT_AUTO_REFRACAO' THEN
			BEGIN
			vOftAutoRefracao_w.EXTEND;
			vOftAutoRefracao_w(vOftAutoRefracao_w.last) := vLista(i);
			END;
		WHEN 'OFT_TONOMETRIA' THEN
			BEGIN
			IF (vLista[i].nr_seq_visao IN (21953,88268)) THEN
				xOftTonometriaAplanacao_w.EXTEND;
				xOftTonometriaAplanacao_w(xOftTonometriaAplanacao_w.last) := vLista(i);
			ELSIF (vLista[i].nr_seq_visao = 86159) THEN
				xOftTonometriaPneumatica_w.EXTEND;
				xOftTonometriaPneumatica_w(xOftTonometriaPneumatica_w.last) := vLista(i);
			END IF;
			END;
		WHEN 'OFT_REFRACAO' THEN
			BEGIN
			vOftRefracao_w.EXTEND;
			vOftRefracao_w(vOftRefracao_w.last) := vLista(i);
			END;
		WHEN 'OFT_CORRECAO_ATUAL' THEN
			BEGIN
			IF (vLista[i].nr_seq_visao = 90600) THEN
				vOftCorrecaoAmbos_w.EXTEND;
				vOftCorrecaoAmbos_w(vOftCorrecaoAmbos_w.last) := vLista(i);
			ELSIF (vLista[i].nr_seq_visao = 90638) THEN
				vOftCorrecaoContato_w.EXTEND;
				vOftCorrecaoContato_w(vOftCorrecaoContato_w.last) := vLista(i);
			ELSIF (vLista[i].nr_seq_visao = 90593) THEN
				vOftCorrecaoSem_w.EXTEND;
				vOftCorrecaoSem_w(vOftCorrecaoSem_w.last) := vLista(i);
			ELSIF (vLista[i].nr_seq_visao = 90637) THEN
				vOftCorrecaoOculos_w.EXTEND;
				vOftCorrecaoOculos_w(vOftCorrecaoOculos_w.last) := vLista(i);
			ELSIF (vLista[i].nr_seq_visao = 86090) THEN
				vOftAcuidadeCorrecao_w.EXTEND;
				vOftAcuidadeCorrecao_w(vOftAcuidadeCorrecao_w.last) := vLista(i);
			END IF;
			END;
		WHEN 'OFT_BIOMICROSCOPIA' THEN
			BEGIN
			vOftBiomicroscopia_w.EXTEND;
			vOftBiomicroscopia_w(vOftBiomicroscopia_w.last) := vLista(i);
			END;
		WHEN 'OFT_FUNDOSCOPIA' THEN
			BEGIN
			vOftFundoscopia_w.EXTEND;
			vOftFundoscopia_w(vOftFundoscopia_w.last) := vLista(i);
			END;
		WHEN 'OFT_CONDUTA' THEN
			BEGIN
			vOftConduta_w.EXTEND;
			vOftConduta_w(vOftConduta_w.last) := vLista(i);
			END;
		WHEN 'OFT_ANGIO_RETINO' THEN
			BEGIN
         IF (vLista[i].nr_seq_visao = 86068) THEN
				vOftAngiofluorsceinografia_w.EXTEND;
            vOftAngiofluorsceinografia_w(vOftAngiofluorsceinografia_w.last) := vLista(i);
			ELSIF (vLista[i].nr_seq_visao = 101309) THEN
				vOftRetinografia_w.EXTEND;
				vOftRetinografia_w(vOftRetinografia_w.last) := vLista(i);
         end if;
			END;
		WHEN 'OFT_BIOMETRIA' THEN
			BEGIN
			vOftBiometria_w.EXTEND;
			vOftBiometria_w(vOftBiometria_w.last) := vLista(i);
			END;
		WHEN 'OFT_CAMPIMETRIA' THEN
			BEGIN
			vOftCampimetria_w.EXTEND;
			vOftCampimetria_w(vOftCampimetria_w.last) := vLista(i);
			END;
		WHEN 'OFT_CAPSULOTOMIA' THEN
			BEGIN
			vOftCapsulotomia_w.EXTEND;
			vOftCapsulotomia_w(vOftCapsulotomia_w.last) := vLista(i);
			END;
		WHEN 'OFT_CERASTOCOPIA' THEN
			BEGIN
			vOftCerastocopia_w.EXTEND;
			vOftCerastocopia_w(vOftCerastocopia_w.last) := vLista(i);
			END;
		WHEN 'OFT_CONSULTA_LENTE' THEN
			BEGIN
			vOftConsultaLente_w.EXTEND;
			vOftConsultaLente_w(vOftConsultaLente_w.last) := vLista(i);
			END;
		WHEN 'OFT_CURVA_TENCIONAL' THEN
			BEGIN
			vOftCurvaTencional_w.EXTEND;
			vOftCurvaTencional_w(vOftCurvaTencional_w.last) := vLista(i);
			END;
		WHEN 'OFT_DALTONISMO' THEN
			BEGIN
			vOftDaltonismo_w.EXTEND;
			vOftDaltonismo_w(vOftDaltonismo_w.last) := vLista(i);
			END;
		WHEN 'OFT_DIAGNOSTICO' THEN
			BEGIN
			IF (vLista[i].nr_seq_visao = 86093) THEN
				IF (vLista[i].nr_aux_1 = 1) THEN
					vOftDiagnosticoPaciente_w1.EXTEND;
					vOftDiagnosticoPaciente_w1(vOftDiagnosticoPaciente_w1.last) := vLista(i);
				ELSIF (vLista[i].nr_aux_1 = 2) THEN
					vOftDiagnosticoPaciente_w2.EXTEND;
					vOftDiagnosticoPaciente_w2(vOftDiagnosticoPaciente_w2.last) := vLista(i);
				ELSIF (vLista[i].nr_aux_1 = 3) THEN
					vOftDiagnosticoPaciente_w3.EXTEND;
					vOftDiagnosticoPaciente_w3(vOftDiagnosticoPaciente_w3.last) := vLista(i);
				ELSIF (vLista[i].nr_aux_1 = 4) THEN
					vOftDiagnosticoPaciente_w4.EXTEND;
					vOftDiagnosticoPaciente_w4(vOftDiagnosticoPaciente_w4.last) := vLista(i);
				ELSIF (vLista[i].nr_aux_1 = 5) THEN
					vOftDiagnosticoPaciente_w5.EXTEND;
					vOftDiagnosticoPaciente_w5(vOftDiagnosticoPaciente_w5.last) := vLista(i);
				ELSIF (vLista[i].nr_aux_1 = 6) THEN
					vOftDiagnosticoPaciente_w6.EXTEND;
					vOftDiagnosticoPaciente_w6(vOftDiagnosticoPaciente_w6.last) := vLista(i);
				ELSIF (vLista[i].nr_aux_1 = 7) THEN
					vOftDiagnosticoPaciente_w7.EXTEND;
					vOftDiagnosticoPaciente_w7(vOftDiagnosticoPaciente_w7.last) := vLista(i);
				END IF;
			ELSIF (vLista[i].nr_seq_visao = 86094) THEN
				vOftDiagnosticoFamiliar_w.EXTEND;
				vOftDiagnosticoFamiliar_w(vOftDiagnosticoFamiliar_w.last) := vLista(i);
			end if;	
			END;
		WHEN 'OFT_DNP' THEN
			BEGIN
			vOftDnp_w.EXTEND;
			vOftDnp_w(vOftDnp_w.last) := vLista(i);
			END;
		WHEN 'OFT_EXAME_EXTERNO' THEN
			BEGIN
			vOftExameExterno_w.EXTEND;
			vOftExameExterno_w(vOftExameExterno_w.last) := vLista(i);
			END;
		WHEN 'OFT_FOTOCOAGULACAO_LASER' THEN
			BEGIN
			vOftFotocoagulacaoLaser_w.EXTEND;
			vOftFotocoagulacaoLaser_w(vOftFotocoagulacaoLaser_w.last) := vLista(i);
			END;
		WHEN 'OFT_GONIOSCOPIA' THEN
			BEGIN
			vOftGonioscopia_w.EXTEND;
			vOftGonioscopia_w(vOftGonioscopia_w.last) := vLista(i);
			END;
		WHEN 'OFT_IRIDECTOMIA' THEN
			BEGIN
			vOftIridectomia_w.EXTEND;
			vOftIridectomia_w(vOftIridectomia_w.last) := vLista(i);
			END;
		WHEN 'OFT_MAPEAMENTO_RETINA' THEN
			BEGIN
			vOftMapeamentoRetina_w.EXTEND;
			vOftMapeamentoRetina_w(vOftMapeamentoRetina_w.last) := vLista(i);
			END;
		WHEN 'OFT_MICROSCOPIA_ESPECULAR' THEN
			BEGIN
			vOftMicroscopiaEspecular_w.EXTEND;
			vOftMicroscopiaEspecular_w(vOftMicroscopiaEspecular_w.last) := vLista(i);
			END;
		WHEN 'OFT_MOTILIDADE_OCULAR' THEN
			BEGIN
			vOftMotilidadeOcular_w.EXTEND;
			vOftMotilidadeOcular_w(vOftMotilidadeOcular_w.last) := vLista(i);
			END;
		WHEN 'OFT_OCT' THEN
			BEGIN
			vOftOct_w.EXTEND;
			vOftOct_w(vOftOct_w.last) := vLista(i);
			END;
		WHEN 'OFT_OCULOS' THEN
			BEGIN
			vOftOculos_w.EXTEND;
			vOftOculos_w(vOftOculos_w.last) := vLista(i);
			END;
		WHEN 'OFT_OLHO_SECO' THEN
			BEGIN
			vOftOlhoSeco_w.EXTEND;
			vOftOlhoSeco_w(vOftOlhoSeco_w.last) := vLista(i);
			END;
		WHEN 'OFT_PAQUIMETRIA' THEN
			BEGIN
			IF (vLista[i].nr_seq_visao = 86143) THEN
				vOftPaquimetria_w.EXTEND;
				vOftPaquimetria_w(vOftPaquimetria_w.last) := vLista(i);
			ELSIF (vLista[i].nr_seq_visao = 86144) THEN
				vOftPaquimetriaUltra_w.EXTEND;
				vOftPaquimetriaUltra_w(vOftPaquimetriaUltra_w.last) := vLista(i);
			END IF;
			END;
		WHEN 'OFT_POTENCIAL_ACUIDADE' THEN
			BEGIN
			vOftPotencialAcuidade_w.EXTEND;
			vOftPotencialAcuidade_w(vOftPotencialAcuidade_w.last) := vLista(i);
			END;
		WHEN 'OFT_PUPILOMETRIA' THEN
			BEGIN
			vOftPupilometria_w.EXTEND;
			vOftPupilometria_w(vOftPupilometria_w.last) := vLista(i);
			END;
		WHEN 'OFT_SOBRECARGA_HIDRICA' THEN
			BEGIN
			vOftSobrecargaHidrica_w.EXTEND;
			vOftSobrecargaHidrica_w(vOftSobrecargaHidrica_w.last) := vLista(i);
			END;
		WHEN 'OFT_TOMOGRAFIA_OLHO' THEN
			BEGIN
			vOftTomografiaOlho_w.EXTEND;
			vOftTomografiaOlho_w(vOftTomografiaOlho_w.last) := vLista(i);
			END;
		WHEN 'OFT_ULTRASSONOGRAFIA' THEN
			BEGIN
			vOftUltrassonografia_w.EXTEND;
			vOftUltrassonografia_w(vOftUltrassonografia_w.last) := vLista(i);
			END;
		WHEN 'OFT_ABERROMETRIA' THEN
			BEGIN
			vOftAberrometria_w.EXTEND;
			vOftAberrometria_w(vOftAberrometria_w.last) := vLista(i);
			END;
		else
			null;	
	END CASE;
	END;
END LOOP;

SELECT 	MAX(nr_seq_tipo_consulta)
INTO STRICT 		nr_seq_tipo_conuslta_w
FROM 		oft_consulta
WHERE 	nr_sequencia = nr_seq_consulta_p;

nr_seq_regra_form_w 	:= oft_obter_formulario(nr_seq_tipo_conuslta_w);
ie_registrar_w			:=	'S';

OPEN C01;
LOOP
FETCH C01 INTO
	dt_liberacao_w,
	nr_seq_consulta_form_ww;
EXIT WHEN NOT FOUND; /* apply on C01 */
	BEGIN
	IF (coalesce(dt_liberacao_w::text, '') = '') THEN
		ie_registrar_w 			:= 'N';
		nr_seq_consulta_form_w 	:=	nr_seq_consulta_form_ww;
	END IF;
	END;
END LOOP;
CLOSE C01;

begin
IF (ie_registrar_w = 'S') THEN
	SELECT	nextval('oft_consulta_formulario_seq')
	INTO STRICT		nr_seq_consulta_form_w
	;

	INSERT INTO oft_consulta_formulario(	nr_sequencia,
														dt_atualizacao,
														nm_usuario,
														dt_atualizacao_nrec,
														nm_usuario_nrec,
														nr_seq_consulta,
														nr_seq_regra_form)
	VALUES (	nr_seq_consulta_form_w,
														clock_timestamp(),
														nm_usuario_w,
														clock_timestamp(),
														nm_usuario_w,
														nr_seq_consulta_p,
														nr_seq_regra_form_w);
END IF;
exception
when others then
	nr_seq_consulta_form_w := null;
end;

if (nr_seq_consulta_form_w IS NOT NULL AND nr_seq_consulta_form_w::text <> '') then
	IF (vOftGradeAmsler_w.COUNT > 0) THEN
      	CALL oft_insert_amsler_grid(nr_encounter_w,nr_seq_consulta_p, nr_seq_consulta_form_w, vOftGradeAmsler_w);
    END IF;
    IF (vOftRedDotTest_w.COUNT > 0) THEN
      	CALL oft_insert_red_dot_test(nr_encounter_w,nr_seq_consulta_p, nr_seq_consulta_form_w, vOftRedDotTest_w);
    END IF;
	IF (vOftPatientComplaints_w.COUNT > 0) THEN
		CALL oft_insert_patient_complaints(nr_encounter_w, nr_seq_consulta_p, nr_seq_consulta_form_w, vOftPatientComplaints_w);
	END IF;
	IF (vOftDiagDoenca_w.COUNT > 0) THEN
		CALL oft_insere_diag_doenca(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftDiagDoenca_w);
	END IF;

	IF (vOftAcuidadeVisual_w.COUNT > 0) THEN
		CALL oft_insere_acuidade(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftAcuidadeVisual_w);
	END IF;

	IF (vOftAnamnese_w.COUNT > 0) THEN
		CALL oft_insere_anamnese(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftAnamnese_w);
	END IF;

	IF (vOftAutoRefracao_w.COUNT > 0) THEN
		CALL oft_insere_auto_refracao(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftAutoRefracao_w);
	END IF;

	IF (xOftTonometriaAplanacao_w.COUNT > 0) THEN
		CALL oft_insere_tonometria(nr_seq_consulta_p,nr_seq_consulta_form_w,xOftTonometriaAplanacao_w);
	END IF;

	IF (xOftTonometriaPneumatica_w.COUNT > 0) THEN
		CALL oft_insere_tonometria(nr_seq_consulta_p,nr_seq_consulta_form_w,xOftTonometriaPneumatica_w);
	END IF;

	IF (vOftRefracao_w.COUNT > 0) THEN
		CALL oft_insere_refracao(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftRefracao_w);
	END IF;

	IF (vOftBiomicroscopia_w.COUNT > 0) THEN
		CALL oft_insere_biomicroscopia(nr_seq_consulta_p,nr_seq_consulta_form_w,nr_seq_consulta_form_ant_p,vOftBiomicroscopia_w);
	END IF;

	IF (vOftCorrecaoAmbos_w.COUNT > 0) THEN
		CALL oft_insere_correcao_atual(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftCorrecaoAmbos_w);
	END IF;

	IF (vOftCorrecaoContato_w.COUNT > 0) THEN
		CALL oft_insere_correcao_atual(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftCorrecaoContato_w);
	END IF;

	IF (vOftCorrecaoSem_w.COUNT > 0) THEN
		CALL oft_insere_correcao_atual(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftCorrecaoSem_w);
	END IF;

	IF (vOftCorrecaoOculos_w.COUNT > 0) THEN
		CALL oft_insere_correcao_atual(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftCorrecaoOculos_w);
	END IF;

   IF (vOftAcuidadeCorrecao_w.COUNT > 0) THEN
		CALL oft_insere_correcao_atual(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftAcuidadeCorrecao_w);
	END IF;

	IF (vOftFundoscopia_w.COUNT > 0) THEN
		CALL oft_insere_fundoscopia(nr_seq_consulta_p,nr_seq_consulta_form_w,nr_seq_consulta_form_ant_p,vOftFundoscopia_w);
	END IF;

	IF (vOftConduta_w.COUNT > 0) THEN
		CALL oft_insere_conduta(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftConduta_w);
	END IF;

	IF (vOftAngiofluorsceinografia_w.COUNT > 0) THEN
		CALL oft_insere_angio_retino(nr_seq_consulta_p,nr_seq_consulta_form_w,nr_seq_consulta_form_ant_p,vOftAngiofluorsceinografia_w);
	END IF;

   IF (vOftRetinografia_w.COUNT > 0) THEN
		CALL oft_insere_angio_retino(nr_seq_consulta_p,nr_seq_consulta_form_w,nr_seq_consulta_form_ant_p,vOftRetinografia_w);
	END IF;

	IF (vOftBiometria_w.COUNT > 0) THEN
		CALL oft_insere_biometria(nr_seq_consulta_p,nr_seq_consulta_form_w,nr_seq_consulta_form_ant_p,vOftBiometria_w);
	END IF;

	IF (vOftCampimetria_w.COUNT > 0) THEN
		CALL oft_insere_campimetria(nr_seq_consulta_p,nr_seq_consulta_form_w,nr_seq_consulta_form_ant_p,vOftCampimetria_w);
	END IF;

	IF (vOftCapsulotomia_w.COUNT > 0) THEN
		CALL oft_insere_capsulotomia(nr_seq_consulta_p,nr_seq_consulta_form_w,nr_seq_consulta_form_ant_p,vOftCapsulotomia_w);
	END IF;

	IF (vOftCerastocopia_w.COUNT > 0) THEN
		CALL oft_insere_ceratometria(nr_seq_consulta_p,nr_seq_consulta_form_w,nr_seq_consulta_form_ant_p,vOftCerastocopia_w);
	END IF;

	IF (vOftConsultaLente_w.COUNT > 0) THEN
		CALL oft_insere_consulta_lente(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftConsultaLente_w);
	END IF;

	IF (vOftCurvaTencional_w.COUNT > 0) THEN
		CALL oft_insere_curva_tencional(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftCurvaTencional_w);
	END IF;

	IF (vOftDaltonismo_w.COUNT > 0) THEN
		CALL oft_insere_daltonismo(nr_seq_consulta_p,nr_seq_consulta_form_w,nr_seq_consulta_form_ant_p,vOftDaltonismo_w);
	END IF;

	IF (vOftDnp_w.COUNT > 0) THEN
		CALL oft_insere_dnp(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftDnp_w);
	END IF;

	IF (vOftExameExterno_w.COUNT > 0) THEN
		CALL oft_insere_exame_externo(nr_seq_consulta_p,nr_seq_consulta_form_w,nr_seq_consulta_form_ant_p,vOftExameExterno_w);
	END IF;

	IF (vOftFotocoagulacaoLaser_w.COUNT > 0) THEN
		CALL oft_insere_fotocoagulacao(nr_seq_consulta_p,nr_seq_consulta_form_w,nr_seq_consulta_form_ant_p,vOftFotocoagulacaoLaser_w);
	END IF;

	IF (vOftGonioscopia_w.COUNT > 0) THEN
		CALL oft_insere_gonioscopia(nr_seq_consulta_p,nr_seq_consulta_form_w,nr_seq_consulta_form_ant_p,vOftGonioscopia_w);
	END IF;

	IF (vOftIridectomia_w.COUNT > 0) THEN
		CALL oft_insere_iridectomia(nr_seq_consulta_p,nr_seq_consulta_form_w,nr_seq_consulta_form_ant_p,vOftIridectomia_w);
	END IF;

	IF (vOftMapeamentoRetina_w.COUNT > 0) THEN
		CALL oft_insere_mapeamento_retina(nr_seq_consulta_p,nr_seq_consulta_form_w,nr_seq_consulta_form_ant_p,vOftMapeamentoRetina_w);
	END IF;

	IF (vOftMicroscopiaEspecular_w.COUNT > 0) THEN
		CALL oft_insere_microscopia(nr_seq_consulta_p,nr_seq_consulta_form_w,nr_seq_consulta_form_ant_p,vOftMicroscopiaEspecular_w);
	END IF;

	IF (vOftMotilidadeOcular_w.COUNT > 0) THEN
		CALL oft_insere_motilidade_ocular(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftMotilidadeOcular_w);
	END IF;

	IF (vOftOct_w.COUNT > 0) THEN
		CALL oft_insere_oct(nr_seq_consulta_p,nr_seq_consulta_form_w,nr_seq_consulta_form_ant_p,vOftOct_w);
	END IF;

	IF (vOftOculos_w.COUNT > 0) THEN
		CALL oft_insere_oculos(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftOculos_w);
	END IF;

	IF (vOftOlhoSeco_w.COUNT > 0) THEN
		CALL oft_insere_olho_seco(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftOlhoSeco_w);
	END IF;

	IF (vOftPaquimetria_w.COUNT > 0) THEN
		CALL oft_insere_paquimetria(nr_seq_consulta_p,nr_seq_consulta_form_w,nr_seq_consulta_form_ant_p,vOftPaquimetria_w);
	END IF;

	IF (vOftPaquimetriaUltra_w.COUNT > 0) THEN
		CALL oft_insere_paquimetria(nr_seq_consulta_p,nr_seq_consulta_form_w,nr_seq_consulta_form_ant_p,vOftPaquimetriaUltra_w);
	END IF;

	IF (vOftPotencialAcuidade_w.COUNT > 0) THEN
		CALL oft_insere_potencial_acuidade(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftPotencialAcuidade_w);
	END IF;

	IF (vOftPupilometria_w.COUNT > 0) THEN
		CALL oft_insere_pupilometria(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftPupilometria_w);
	END IF;

	IF (vOftSobrecargaHidrica_w.COUNT > 0) THEN
		CALL oft_insere_sobrecarga_hidrica(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftSobrecargaHidrica_w);
	END IF;

	IF (vOftTomografiaOlho_w.COUNT > 0) THEN
		CALL oft_insere_tomografia(nr_seq_consulta_p,nr_seq_consulta_form_w,nr_seq_consulta_form_ant_p,vOftTomografiaOlho_w);
	END IF;

	IF (vOftUltrassonografia_w.COUNT > 0) THEN
		CALL oft_insere_ultrassonografia(nr_seq_consulta_p,nr_seq_consulta_form_w,nr_seq_consulta_form_ant_p,vOftUltrassonografia_w);
	END IF;

	IF (vOftDiagnosticoPaciente_w1.COUNT > 0) THEN
		CALL oft_insere_diagnostico(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftDiagnosticoPaciente_w1);
	END IF;
	
	IF (vOftDiagnosticoPaciente_w2.COUNT > 0) THEN
		CALL oft_insere_diagnostico(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftDiagnosticoPaciente_w2);
	END IF;
	
	IF (vOftDiagnosticoPaciente_w3.COUNT > 0) THEN
		CALL oft_insere_diagnostico(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftDiagnosticoPaciente_w3);
	END IF;
	
	IF (vOftDiagnosticoPaciente_w4.COUNT > 0) THEN
		CALL oft_insere_diagnostico(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftDiagnosticoPaciente_w4);
	END IF;
	
	IF (vOftDiagnosticoPaciente_w5.COUNT > 0) THEN
		CALL oft_insere_diagnostico(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftDiagnosticoPaciente_w5);
	END IF;
	
	IF (vOftDiagnosticoPaciente_w6.COUNT > 0) THEN
		CALL oft_insere_diagnostico(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftDiagnosticoPaciente_w6);
	END IF;
	
	IF (vOftDiagnosticoPaciente_w7.COUNT > 0) THEN
		CALL oft_insere_diagnostico(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftDiagnosticoPaciente_w7);
	END IF;

	IF (vOftDiagnosticoFamiliar_w.COUNT > 0) THEN
		CALL oft_insere_diagnostico(nr_seq_consulta_p,nr_seq_consulta_form_w,vOftDiagnosticoFamiliar_w);
	END IF;

   IF (vOftAberrometria_w.COUNT > 0) THEN
		CALL oft_insere_aberrometria(nr_seq_consulta_p,nr_seq_consulta_form_w,nr_seq_consulta_form_ant_p,vOftAberrometria_w);
	END IF;

	if (wheb_usuario_pck.get_ie_commit = 'S') then
		commit;
	else
		rollback;
	end if;	
end if;	

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE oft_insere_registros ( nr_seq_consulta_p bigint, nr_seq_consulta_form_ant_p bigint, vLista strRecTypeFormOft) FROM PUBLIC;

