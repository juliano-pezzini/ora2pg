-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_contrato_titulo ( nr_seq_contrato_p bigint, nr_titulo_p bigint, nm_usuario_p text, ds_msg_p INOUT text) AS $body$
DECLARE


vl_saldo_titulo_w   titulo_receber.vl_saldo_titulo%type;


BEGIN
	
	if (nr_seq_contrato_p IS NOT NULL AND nr_seq_contrato_p::text <> '') and (nr_titulo_p IS NOT NULL AND nr_titulo_p::text <> '') then
		
		vl_saldo_titulo_w := 0;
		
		select vl_titulo
		  into STRICT vl_saldo_titulo_w
		  from titulo_receber
		 where nr_titulo = nr_titulo_p;
		
		CALL gerenciamento_contrato_pck.consistir_tit_receber_contrato(nr_seq_contrato_p, nr_titulo_p, vl_saldo_titulo_w, nm_usuario_p, 'N');
	
		update	titulo_receber
		set	nr_seq_contrato	= nr_seq_contrato_p,
			nm_usuario	= nm_usuario_p,
			dt_atualizacao	= clock_timestamp()
		where	nr_titulo	= nr_titulo_p;

	commit;
	
	ds_msg_p :=	obter_texto_tasy(176055, wheb_usuario_pck.get_nr_seq_idioma);
	
	end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_contrato_titulo ( nr_seq_contrato_p bigint, nr_titulo_p bigint, nm_usuario_p text, ds_msg_p INOUT text) FROM PUBLIC;

