-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE man_gerar_justif_os ( nr_seq_ordem_p bigint, ie_tipo_justificativa_p text, ds_justificativa_p text, nm_usuario_p text) AS $body$
DECLARE


nm_user_w			varchar(30);
nr_seq_tipo_w			bigint;
ds_mensagem_w			varchar(4000);


BEGIN
select	username
into STRICT	nm_user_w
from	user_users;

if (nm_user_w = 'CORP') then
	nr_seq_tipo_w	:= 148;
end if;

select	substr(max(obter_desc_expressao_idioma(cd_exp_informacao, ds_informacao,man_obter_idioma_os_local(nr_seq_ordem_p))) || substr(ds_justificativa_p,1,255),1,4000)
into STRICT	ds_mensagem_w
from	dic_objeto
where	nr_sequencia = 305600
and	ie_tipo_objeto = 'T';

insert into man_ordem_justificativa(nr_sequencia,
	nr_seq_ordem,
	ie_tipo_justificativa,
	dt_atualizacao,
	nm_usuario,
	dt_atualizacao_nrec,
	nm_usuario_nrec,
	ds_justificativa)
values (nextval('man_ordem_justificativa_seq'),
	nr_seq_ordem_p,
	ie_tipo_justificativa_p,
	clock_timestamp(), nm_usuario_p,
	clock_timestamp(), nm_usuario_p,
	substr(ds_justificativa_p,1,255));

insert into man_ordem_serv_tecnico(nr_sequencia,
	nr_seq_ordem_serv,
	dt_atualizacao,
	nm_usuario,
	ds_relat_tecnico,
	dt_historico,
	ie_origem,
	nr_seq_tipo,
	dt_liberacao,
	nm_usuario_lib)
values (nextval('man_ordem_serv_tecnico_seq'),
	nr_seq_ordem_p,
	clock_timestamp(),
	nm_usuario_p,
	ds_mensagem_w,
	clock_timestamp(),
	'I',
	nr_seq_tipo_w,
	clock_timestamp(),
	nm_usuario_p);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE man_gerar_justif_os ( nr_seq_ordem_p bigint, ie_tipo_justificativa_p text, ds_justificativa_p text, nm_usuario_p text) FROM PUBLIC;

