-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE dar_excluir_app (nr_sequencia_p INOUT dar_app.nr_sequencia%type) AS $body$
DECLARE

   nr_seq_ligacao_w dar_app_datamodels.nr_seq_ligacao%type;
   nr_seq_filter_w bigint;
   nr_seq_global_filter_w bigint;

BEGIN

   /* Verifica se possui dependencias geradas em dar_app_datamodels */
   select max(nr_seq_ligacao)
     into STRICT nr_seq_ligacao_w
     from dar_app_datamodels
    where nr_seq_app = nr_sequencia_p;
	
	select max(a.nr_sequencia)
	 into STRICT nr_seq_filter_w
	 from dar_dashboard_filter a,
			dar_dashboard b
	where a.nr_seq_dashboard = b.nr_sequencia
	and   b.nr_seq_app = nr_sequencia_p;
	
	select max(nr_sequencia)
	 into STRICT nr_seq_global_filter_w
	 from dar_dash_global_filter
	where nr_seq_app = nr_sequencia_p;

   -- Se possui dependencias
   if (coalesce(nr_seq_ligacao_w, 0) > 0) then
   
      --Exclusao de fields gerados na juncao de dataModels
      delete FROM dar_tab_control_fields where nr_seq_table_control = nr_seq_ligacao_w;

      --Exclusao de tabbles_control gerado para a juncao
      delete FROM dar_tables_control where nr_sequencia = nr_seq_ligacao_w;

   End if;

   -- Se possui dependencias de filtro
   if (coalesce(nr_seq_filter_w, 0) > 0) then
      
      --Exclusao de tabbles_control gerado para a juncao
      delete FROM dar_dashboard_filter where nr_sequencia = nr_seq_filter_w;

   End if;

   -- Se possui dependencias de filtro
   if (coalesce(nr_seq_global_filter_w, 0) > 0) then
      
      --Exclusao de tabbles_control gerado para a juncao
      delete FROM dar_dash_global_filter where nr_seq_app = nr_sequencia_p;

   End if;

   -- Exclui dar_app_control_fields
   delete FROM dar_app_control_fields where nr_seq_app = nr_sequencia_p;
   -- Exclui dar_app_datamodels
   delete FROM dar_app_datamodels where nr_seq_app = nr_sequencia_p;
   -- Exclui dar_dashboard
   delete FROM dar_dashboard where nr_seq_app = nr_sequencia_p;
   -- Exclui dar_app
   delete FROM dar_app where nr_sequencia = nr_sequencia_p;

   --
   commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE dar_excluir_app (nr_sequencia_p INOUT dar_app.nr_sequencia%type) FROM PUBLIC;

