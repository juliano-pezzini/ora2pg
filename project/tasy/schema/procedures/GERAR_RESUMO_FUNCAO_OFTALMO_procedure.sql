-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_resumo_funcao_oftalmo ( cd_estabelecimento_p bigint, nr_seq_consulta_p bigint, cd_pessoa_fisica_p text, nm_usuario_p text, ie_mostra_todos_p text) AS $body$
DECLARE


ds_resumo_w		text;
ds_ger_anamnese_w	varchar(32000);
ds_acuidade_visual_w	varchar(32000);
ds_potencial_acuidade_visual_w	varchar(32000);
ds_correcao_optica_w	varchar(32000);
ds_fundoscopia_w		varchar(32000);
ds_tonometria_w		varchar(32000);
ds_tonometria_2_w	varchar(32000);
ds_dnp_w		varchar(32000);
biomicroscopia_w		varchar(32000);
ds_auto_refracao_w	varchar(32000);
ds_refracao_w		varchar(32000);
ds_ceratometria_w		varchar(32000);
ds_angio_retino_w	varchar(32000);
ds_gonioscopia_w	varchar(32000);
ds_motilidade_ocupar_w	varchar(32000);
ds_paquimetria_w	varchar(32000);
ds_paquimetria_ultra_w	varchar(32000);
ds_exame_externo_w	varchar(32000);
ds_observacao_w		varchar(4000);
ds_enter_w		varchar(30)	:=  chr(13) || chr(10);
dt_anamnese_w		varchar(30);
ds_anamnese_w		varchar(1000);
ds_historia_ocular_w	varchar(1000);
ds_medicamentos_w	varchar(1000);
ds_alergia_w		varchar(1000);
nm_profissional_w		varchar(255);
ds_profissional_w		varchar(255);
dt_registro_w		varchar(30);
vl_potencial_od_w		varchar(40);
vl_potencial_oe_w		varchar(40);
vl_od_pl_av_cc_w		varchar(40);
vl_od_pl_av_sc_w		varchar(40);
vl_oe_pl_av_cc_w		varchar(40);
vl_oe_pl_av_sc_w		varchar(40);
vl_od_pp_av_w		varchar(40);
vl_oe_pp_av_w		varchar(40);
ds_tipo_lente_w		varchar(80);
qt_tempo_uso_w		varchar(10);
ds_unidade_tempo_w	varchar(255);
vl_od_pl_dio_esf_w		varchar(10);
vl_od_pl_dio_cil_w		varchar(10);
vl_od_pl_eixo_w		varchar(10);
vl_od_pl_adicao_w		varchar(10);
vl_oe_pl_dio_esf_w		varchar(10);
vl_oe_pl_dio_cil_w		varchar(10);
vl_oe_pl_eixo_w		varchar(10);
vl_od_pp_dio_esf_w	varchar(10);
vl_od_pp_dio_cil_w		varchar(10);
vl_od_pp_eixo_w		varchar(10);
vl_oe_pp_dio_esf_w	varchar(10);
vl_oe_pp_dio_cil_w		varchar(10);
vl_oe_pp_eixo_w		varchar(10);
ds_fundoscopia_oe_w 	varchar(1000);
ds_fundoscopia_od_w	varchar(1000);
ds_curva_tensional_oe_w varchar(1000);
ds_curva_tensional_od_w varchar(1000);
vl_pressao_od_w		varchar(10);
vl_pressao_oe_w		varchar(10);
vl_od_ard_dnp_w		varchar(10);
vl_oe_ard_dnp_w		varchar(10);
vl_ard_dp_w		varchar(10);
vl_od_ard_esf_w		varchar(10);
vl_od_ard_cil_w		varchar(10);
vl_od_ard_eixo_w		varchar(10);
qt_reflexo_od_w		varchar(10);
vl_oe_ard_esf_w		varchar(10);
vl_oe_ard_cil_w		varchar(10);
vl_oe_ard_eixo_w		varchar(10);
qt_reflexo_oe_w		varchar(10);
qt_distancia_np_w		varchar(10);
vl_od_are_esf_w		varchar(10);
vl_od_are_cil_w		varchar(10);
vl_od_are_eixo_w		varchar(10);
qt_reflexo_are_od_w 	varchar(10);
vl_oe_are_esf_w		varchar(10);
vl_oe_are_cil_w		varchar(10);
vl_oe_are_eixo_w		varchar(10);
qt_reflexo_are_oe_w	varchar(10);
vl_od_pl_ard_esf_w		varchar(10);
vl_od_pl_ard_cil_w		varchar(10);
vl_od_pl_ard_eixo_w	varchar(10);
vl_od_pl_ard_av_sc_w	varchar(40);
vl_adicao_w		varchar(10);
vl_adicao_oe_w		varchar(10);
vl_oe_pl_ard_esf_w		varchar(10);
vl_oe_pl_ard_cil_w		varchar(10);
vl_oe_pl_ard_eixo_w	varchar(10);
vl_oe_pl_ard_av_sc_w	varchar(40);
vl_od_pp_ard_esf_w	varchar(10);
vl_od_pp_ard_cil_w		varchar(10);
vl_od_pp_ard_eixo_w	varchar(10);
vl_od_pp_ard_av_sc_w	varchar(40);
vl_oe_pp_ard_esf_w	varchar(10);
vl_oe_pp_ard_cil_w		varchar(10);
vl_oe_pp_ard_eixo_w	varchar(10);
vl_oe_pp_ard_av_sc_w	varchar(40);
vl_od_pl_are_esf_w		varchar(10);
vl_od_pl_are_cil_w		varchar(10);
vl_od_pl_are_eixo_w	varchar(10);
vl_od_pl_are_av_sc_w	varchar(40);
vl_oe_pl_are_esf_w		varchar(10);
vl_oe_pl_are_cil_w		varchar(10);
vl_oe_pl_are_eixo_w	varchar(10);
vl_oe_pl_are_av_sc_w	varchar(40);
vl_od_pp_are_esf_w	varchar(10);
vl_od_pp_are_cil_w		varchar(10);
vl_od_pp_are_eixo_w	varchar(10);
vl_od_pp_are_av_sc_w	varchar(40);
vl_oe_pp_are_esf_w	varchar(10);
vl_oe_pp_are_cil_w		varchar(10);
vl_oe_pp_are_eixo_w	varchar(10);
vl_oe_pp_are_av_sc_w	varchar(40);
qt_cur_horizontal_od_w 	varchar(15);
qt_cur_vertical_od_w  	varchar(15);
qt_eixo_horizontal_od_w 	varchar(15);
qt_eixo_vertical_od_w  	varchar(15);
qt_cur_horizontal_oe_w  	varchar(15);
qt_cur_vertical_oe_w  	varchar(15);
qt_eixo_horizontal_oe_w 	varchar(15);
ds_curva_tensional_w	varchar(32000);
qt_eixo_vertical_oe_w	varchar(15);
/*ds_quebra_w		varchar(255) 	:=	lpad(' ',93,'_');*/

ds_quebra_w		varchar(255) 	:=  	chr(13) || chr(10);
ds_biomicroscopia_oe_w 	varchar(1000);
ds_biomicroscopia_od_w	varchar(1000);
ds_espaco_w		varchar(255)	:= 	lpad(' ',30,' ');
ds_espaco_20_w		varchar(255) 	:= 	lpad(' ',1,' ');
ds_espaco_15_w		varchar(255)	:= 	lpad(' ',10,' ');
ds_espaco_16_w		varchar(255)	:= 	lpad(' ',8,' ');
ds_sublinhado_w		varchar(255)	:=	lpad(' ',70,'*');
qt_od_acd_inter_w	varchar(10);
qt_od_eixo_inter_w	varchar(10);
qt_od_emt_inter_w	varchar(10);
ie_od_formula_inter_w	varchar(10);
qt_od_acd_ultra_w	varchar(10);
qt_od_eixo_ultra_w	varchar(10);
qt_od_emt_ultra_w	varchar(10);
ie_od_formula_ultra_w	varchar(10);
ds_biometria_w		varchar(32000);
qt_oe_acd_inter_w	varchar(10);
qt_oe_eixo_inter_w	varchar(10);
qt_oe_emt_inter_w	varchar(10);
ie_oe_formula_inter_w	varchar(10);
qt_oe_acd_ultra_w	varchar(10);
qt_oe_eixo_ultra_w	varchar(10);
qt_oe_emt_ultra_w	varchar(10);
ie_oe_formula_ultra_w	varchar(10);
qt_od_microscopia_w	varchar(10);
qt_oe_microscopia_w	varchar(10);
ds_microscopia_w	varchar(32000);
qt_od_pupilometria_w	varchar(10);
qt_oe_pupilometria_w	varchar(10);
ds_pupilometria_w		varchar(32000);
ds_angiografia_w		varchar(1000);
ds_oe_angiografia_w		varchar(1000);
ds_retinografia_w		varchar(1000);
ds_oe_retinografia_w		varchar(1000);
ds_exame_exter_od_w	varchar(1000);
ds_exame_exter_oe_w	varchar(1000);
ds_geral_w		varchar(32000);
ds_orientacao_w		varchar(32000);
nr_sequencia_item_w	bigint;
nr_seq_rtf_srtring_w	bigint;
qt_existe_w		bigint;
ds_atestado_w		varchar(32000);
ds_conduta_w		varchar(32000);
nr_atendimento_w	bigint;
ds_consentimento_w	varchar(32000);
ds_diagnosticos_oft_w	varchar(32000);
desc_diagnostico_w	varchar(255);
ds_diagnostico_w	varchar(32000);
desc_lente_w		varchar(255);
ds_lado_w		varchar(255);
qt_grau_lente_w		double precision;
qt_grau_esferico_w	double precision;
qt_grau_cilindrico_w	double precision;
qt_grau_longe_w		double precision;
qt_eixo_w		double precision;
qt_adicao_w		double precision;
ds_lentes_w		varchar(32000);
--vl_od_pl_dio_esf_w	number(5,2);
--vl_od_pl_dio_cil_w	number(5,2);
--vl_od_pl_eixo_w		number(5,2);
--vl_od_pl_adicao_w	number(5,2);
--vl_oe_pl_dio_esf_w	number(5,2);
--vl_oe_pl_dio_cil_w	number(5,2);
--vl_oe_pl_eixo_w		number(5,2);
vl_oe_pl_adicao_w	real;
--vl_od_pp_dio_esf_w	number(5,2);
--vl_od_pp_dio_cil_w	number(5,2);
--vl_od_pp_eixo_w		number(5,2);
vl_od_pp_adicao_w	real;
--vl_oe_pp_dio_esf_w	number(5,2);
--vl_oe_pp_dio_cil_w	number(5,2);
--vl_oe_pp_eixo_w		number(5,2);
vl_oe_pp_adicao_w	real;
vl_od_in_dio_esf_w	real;
vl_od_in_dio_cil_w	real;
vl_od_in_eixo_w		real;
vl_od_in_adicao_w	real;
vl_oe_in_dio_esf_w	real;
vl_oe_in_dio_cil_w	real;
vl_oe_in_eixo_w		real;
vl_oe_in_adicao_w	real;
ds_oculos_w		varchar(32000);
nr_prescricao_w		bigint;
dt_prescricao_w		timestamp;
ds_itens_prescr_w	varchar(255);
ds_prescricao_w		varchar(32000);
ds_receita_w		varchar(32000);
cd_perfil_w		bigint;
ds_instituicao_w	varchar(40);
vl_od_lenso_esf_w 	real;
vl_od_lenso_cil_w	real;
vl_od_lenso_eixo_w	smallint;
vl_adicao_lanso_w  	real;
vl_oe_lenso_esf_w	real;
vl_oe_lenso_cil_w	real;
vl_oe_lenso_eixo_w	smallint;
ds_segmento_w		varchar(255);
ie_tipo_tonometria_w	smallint;

ds_od_formula_inter_w	varchar(255);
ds_od_formula_ultra_w	varchar(255);
ds_oe_formula_inter_w	varchar(255);
ds_oe_formula_ultra_w	varchar(255);
ie_tela_nova_lente_w	varchar(1);
qt_curva_base_w		double precision;
qt_curva_base_um_w    	double precision;
qt_curva_base_dois_w	double precision;
qt_diametro_w	 	double precision;
ie_oculta_inf_refracao_w varchar(1);




C01 CURSOR FOR
SELECT 	obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	to_char(dt_anamnese,'dd/mm/yyyy hh24:mi:ss') dt_anamnese,
	ds_anamnese,
	ds_historia_ocular,
	ds_medicamentos,
	ds_alergia
from   	oft_anamnese,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
and	coalesce(ie_situacao,'A') = 'A'
and	cd_profissional = x.cd_pessoa_fisica
order 	by dt_anamnese desc;

C02 CURSOR FOR
SELECT to_char(dt_registro,'dd/mm/yyyy hh24:mi:ss'),
	   obter_nome_pf(cd_profissional) nm_profissional,
	   substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	   obter_desc_tipo_acuidade(vl_od_pl_av_cc) vl_od_pl_av_cc,
	   obter_desc_tipo_acuidade(vl_od_pl_av_sc) vl_od_pl_av_sc,
	   obter_desc_tipo_acuidade(vl_oe_pl_av_cc) vl_oe_pl_av_cc,
	   obter_desc_tipo_acuidade(vl_oe_pl_av_sc) vl_oe_pl_av_sc,
	   obter_desc_tipo_acuidade(vl_od_pp_av) vl_od_pp_av,
	   obter_desc_tipo_acuidade(vl_oe_pp_av) vl_oe_pp_av,
	   a.ds_observacao
from    oft_acuidade_visual a,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
and 	cd_profissional 	= 	x.cd_pessoa_fisica
and	coalesce(ie_situacao,'A') = 'A'
order   by dt_registro desc;

C03 CURSOR FOR
SELECT obter_nome_pf(cd_profissional) nm_profissional,
	   substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	   to_char(dt_registro,'dd/mm/yyyy hh24:mi:ss'),
	   obter_desc_tipo_lente(nr_seq_tipo_lente) ds_tipo_lente,
	   qt_tempo_uso,
	   obter_valor_dominio(1913,ie_unidade_tempo) ds_unidade_tempo,
	   vl_od_pl_dio_esf,
	   vl_od_pl_dio_cil,
	   vl_od_pl_eixo,
	   vl_od_pl_adicao,
	   vl_oe_pl_dio_esf,
	   vl_oe_pl_dio_cil,
	   vl_oe_pl_eixo,
	   vl_od_pp_dio_esf,
	   vl_od_pp_dio_cil,
	   vl_od_pp_eixo,
	   vl_oe_pp_dio_esf,
	   vl_oe_pp_dio_cil,
	   vl_oe_pp_eixo,
	   a.ds_observacao
from    oft_correcao_atual a,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
and	coalesce(ie_situacao,'A') = 'A'
and 	cd_profissional 	= 	x.cd_pessoa_fisica
order   BY dt_registro desc;

C04 CURSOR FOR
SELECT obter_nome_pf(cd_profissional) nm_profissional,
		substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	   to_char(dt_exame,'dd/mm/yyyy hh24:mi:ss'),
	   ds_fundoscopia_oe,
	   ds_fundoscopia_od,
	   a.ds_observacao
from   oft_fundoscopia a,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
and    coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
order  by dt_exame desc;

C05 CURSOR FOR
SELECT obter_nome_pf(cd_profissional) nm_profissional,
	   substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	   to_char(dt_exame,'dd/mm/yyyy hh24:mi:ss'),
	   vl_pressao_od,
	   vl_pressao_oe,
	   ie_tipo_tonometria
from   oft_tonometria,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
and    coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
order  by dt_exame desc;

C06 CURSOR FOR
SELECT obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	   to_char(dt_exame,'dd/mm/yyyy hh24:mi:ss'),
	   vl_od_ard_dnp,
	   vl_oe_ard_dnp,
	   vl_ard_dp,
	   a.ds_observacao
from   oft_dnp a,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
and    coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
order  by dt_exame desc;

C07 CURSOR FOR
SELECT obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	   to_char(dt_exame,'dd/mm/yyyy hh24:mi:ss'),
	   ds_biomicroscopia_od,
	   ds_biomicroscopia_oe,
	   a.ds_observacao,
	   substr(OBTER_VALOR_DOMINIO(3738,ie_segmento),1,255) ds_segmento
from   oft_biomicroscopia a,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
and    coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
order  by dt_exame desc;

C08 CURSOR FOR
SELECT obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	   to_char(dt_exame,'dd/mm/yyyy hh24:mi:ss'),
	   vl_od_ard_esf,
	   vl_od_ard_cil,
	   vl_od_ard_eixo,
	   qt_reflexo_od,
	   vl_oe_ard_esf,
	   vl_oe_ard_cil,
	   vl_oe_ard_eixo,
	   qt_reflexo_oe,
	   qt_distancia_np,
	   vl_od_are_esf,
	   vl_od_are_cil,
	   vl_od_are_eixo,
	   qt_reflexo_are_od,
	   vl_oe_are_esf,
	   vl_oe_are_cil,
	   vl_oe_are_eixo,
	   qt_reflexo_are_oe,
	   a.ds_observacao,
	   vl_od_lenso_esf,
	   vl_od_lenso_cil,
	   vl_od_lenso_eixo,
	   vl_adicao,
	   vl_oe_lenso_esf,
	   vl_oe_lenso_cil,
	   vl_oe_lenso_eixo
from   oft_auto_refracao a,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
and    coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
order  by dt_exame desc;

C09 CURSOR FOR
SELECT obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	   to_char(dt_exame,'dd/mm/yyyy hh24:mi:ss'),
	   vl_od_pl_ard_esf,
	   vl_od_pl_ard_cil,
	   vl_od_pl_ard_eixo,
	   obter_desc_tipo_acuidade(vl_od_pl_ard_av_sc) vl_od_pl_ard_av_sc,
	   vl_adicao,
	   vl_adicao_oe,
	   vl_oe_pl_ard_esf,
	   vl_oe_pl_ard_cil,
	   vl_oe_pl_ard_eixo,
	   obter_desc_tipo_acuidade(vl_oe_pl_ard_av_sc) vl_oe_pl_ard_av_sc,
	   vl_od_pp_ard_esf,
	   vl_od_pp_ard_cil,
	   vl_od_pp_ard_eixo,
	   obter_desc_tipo_acuidade(vl_od_pp_ard_av_sc) vl_od_pp_ard_av_sc,
	   vl_oe_pp_ard_esf,
	   vl_oe_pp_ard_cil,
	   vl_oe_pp_ard_eixo,
	   obter_desc_tipo_acuidade(vl_oe_pp_ard_av_sc) vl_oe_pp_ard_av_sc,
	   vl_od_pl_are_esf,
	   vl_od_pl_are_cil,
	   vl_od_pl_are_eixo,
	   obter_desc_tipo_acuidade(vl_od_pl_are_av_sc) vl_od_pl_are_av_sc,
	   vl_oe_pl_are_esf,
	   vl_oe_pl_are_cil,
	   vl_oe_pl_are_eixo,
	   obter_desc_tipo_acuidade(vl_oe_pl_are_av_sc) vl_oe_pl_are_av_sc,
	   vl_od_pp_are_esf,
	   vl_od_pp_are_cil,
	   vl_od_pp_are_eixo,
	   obter_desc_tipo_acuidade(vl_od_pp_are_av_sc) vl_od_pp_are_av_sc,
	   vl_oe_pp_are_esf,
	   vl_oe_pp_are_cil,
	   vl_oe_pp_are_eixo,
	   obter_desc_tipo_acuidade(vl_oe_pp_are_av_sc) vl_oe_pp_are_av_sc
from   oft_refracao,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
and    coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
order  by dt_exame desc;

C10 CURSOR FOR
SELECT obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	   to_char(dt_exame,'dd/mm/yyyy hh24:mi:ss'),
	   qt_cur_horizontal_od,
	   qt_cur_vertical_od,
	   qt_eixo_horizontal_od,
	   qt_eixo_vertical_od,
	   qt_cur_horizontal_oe,
	   qt_cur_vertical_oe,
	   qt_eixo_horizontal_oe,
	   qt_eixo_vertical_oe
from   oft_ceratometria ,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
and    coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
order  by dt_exame desc;

C11 CURSOR FOR
SELECT 	obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	TO_CHAR(dt_registro,'dd/mm/yyyy hh24:mi:ss'),
	vl_oe_ct,
	vl_od_ct
from	oft_curva_tencional,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))

and	coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
order by dt_registro desc;

C12 CURSOR FOR
SELECT obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	  TO_CHAR(dt_registro,'dd/mm/yyyy hh24:mi:ss'),
	  qt_od_acd_inter,
	  qt_od_eixo_inter,
	  qt_od_emt_inter,
	  obter_valor_dominio(3950,ie_od_formula_inter) ds_formula1,
	  qt_od_acd_ultra,
	  qt_od_eixo_ultra,
	  qt_od_emt_ultra,
	  obter_valor_dominio(3950,ie_od_formula_ultra) ds_formula2,
	  qt_oe_acd_inter,
	  qt_oe_eixo_inter,
	  qt_oe_emt_inter,
	  obter_valor_dominio(3950,ie_oe_formula_inter) ds_formula3,
	  a.ds_observacao,
	  qt_oe_acd_ultra,
	  qt_oe_eixo_ultra,
	  qt_oe_emt_ultra,
	  obter_valor_dominio(3950,ie_oe_formula_ultra) ds_formula4
FROM   oft_biometria a,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
and    coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
ORDER  BY dt_registro desc;

C13 CURSOR FOR
SELECT obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	TO_CHAR(dt_registro,'dd/mm/yyyy hh24:mi:ss'),
	qt_od_microscopia,
	qt_oe_microscopia,
	a.ds_observacao
FROM   oft_microscopia_especular a,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
and    coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
ORDER  BY dt_registro desc;

C14 CURSOR FOR
SELECT obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	TO_CHAR(dt_registro,'dd/mm/yyyy hh24:mi:ss'),
	qt_od_pupilometria,
	qt_oe_pupilometria,
	a.ds_observacao
FROM   oft_pupilometria a,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
and    coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
ORDER  BY dt_registro;

C15 CURSOR FOR
SELECT obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	   TO_CHAR(dt_registro,'dd/mm/yyyy hh24:mi:ss'),
	   ds_angiografia,
	   ds_oe_angiografia,
	   ds_retinografia,    ds_angio_retino_w
	   ds_oe_retinografia,
	   a.ds_observacao
FROM   OFT_ANGIO_RETINO a,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
AND    coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
ORDER  BY dt_registro desc;

C16 CURSOR FOR
SELECT 	obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	   TO_CHAR(dt_registro,'dd/mm/yyyy hh24:mi:ss')
FROM    oft_gonioscopia,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
AND	coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
ORDER   BY dt_registro desc;

C17 CURSOR FOR
SELECT 	obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	TO_CHAR(dt_exame,'dd/mm/yyyy hh24:mi:ss')
FROM	oft_motilidade_ocular,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
AND	coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
ORDER   BY dt_exame desc;

C18 CURSOR FOR
SELECT 	obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	TO_CHAR(dt_registro,'dd/mm/yyyy hh24:mi:ss')
FROM	oft_paquimetria,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
AND	coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
and    ((IE_TIPO_PAQUIMETRIA = 'S') OR (coalesce(IE_TIPO_PAQUIMETRIA::text, '') = ''))
ORDER   BY dt_registro desc;

C19 CURSOR FOR
SELECT	obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	TO_CHAR(dt_exame,'dd/mm/yyyy hh24:mi:ss'),
	ds_exame_exter_od,
	ds_exame_exter_oe,
	a.ds_observacao
FROM	OFT_EXAME_EXTERNO a,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
AND	coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
ORDER   BY dt_exame desc;

C20 CURSOR FOR
SELECT	obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	TO_CHAR(dt_registro,'dd/mm/yyyy hh24:mi:ss'),
	nr_sequencia
FROM	PEP_ORIENTACAO_GERAL,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
AND	coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
ORDER   BY dt_registro desc;

C21 CURSOR FOR
SELECT	obter_nome_pf(a.cd_medico) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	TO_CHAR(dt_atestado,'dd/mm/yyyy hh24:mi:ss'),
	nr_sequencia
FROM	ATESTADO_PACIENTE a,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
AND	coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	a.cd_medico
ORDER   BY dt_atestado desc;

C22 CURSOR FOR
SELECT	obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	TO_CHAR(dt_registro,'dd/mm/yyyy hh24:mi:ss'),
	nr_sequencia
FROM	OFT_CONDUTA,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
AND	coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
ORDER   BY dt_registro desc;

C23 CURSOR FOR
SELECT	obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	TO_CHAR(a.dt_atualizacao,'dd/mm/yyyy hh24:mi:ss'),
	nr_sequencia
FROM	PEP_PAC_CI a,
	pessoa_fisica x
WHERE   nr_atendimento = nr_atendimento_w
AND	coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	a.cd_profissional
ORDER   BY a.dt_atualizacao desc;

C24 CURSOR FOR
SELECT	obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	TO_CHAR(dt_registro,'dd/mm/yyyy hh24:mi:ss'),
	SUBSTR(obter_descricao_padrao( 'OFT_TIPO_DIAGNOSTICO', 'DS_DIAGNOSTICO', NR_SEQ_DIAG),1,100) desc_diagnostico_w,
	DS_DIAGNOSTICO,
	a.DS_OBSERVACAO
FROM	OFT_DIAGNOSTICO a,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
AND		coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
ORDER   BY dt_registro desc;

C25 CURSOR FOR
SELECT  TO_CHAR(a.dt_atualizacao,'dd/mm/yyyy hh24:mi:ss'),
	SUBSTR(obter_desc_lente_contato(nr_seq_lente),1,255) desc_lente,
	SUBSTR(obter_valor_dominio(1372,IE_LADO),1,255) ds_lado,
	QT_GRAU,
	QT_GRAU_ESFERICO,
	QT_GRAU_CILINDRICO,
	QT_GRAU_LONGE,
	QT_EIXO,
	QT_ADICAO,
	obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	qt_curva_base,
	qt_curva_base_um,
	qt_curva_base_dois,
	qt_diametro
FROM	OFT_CONSULTA_LENTE a,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
AND	coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
ORDER   BY a.dt_atualizacao, ds_lado desc;

C26 CURSOR FOR
SELECT	obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	TO_CHAR(dt_registro,'dd/mm/yyyy hh24:mi:ss'),
	SUBSTR( obter_desc_tipo_lente(nr_seq_tipo_lente),1,255) desc_tipo_lente,
	VL_OD_PL_DIO_ESF,
	VL_OD_PL_DIO_CIL,
	VL_OD_PL_EIXO,
	VL_OD_PL_ADICAO,
	VL_OE_PL_DIO_ESF,
	VL_OE_PL_DIO_CIL,
	VL_OE_PL_EIXO,
	VL_OE_PL_ADICAO,
	VL_OD_PP_DIO_ESF,
	VL_OD_PP_DIO_CIL,
	VL_OD_PP_EIXO,
	VL_OD_PP_ADICAO,
	VL_OE_PP_DIO_ESF,
	VL_OE_PP_DIO_CIL,
	VL_OE_PP_EIXO,
	VL_OE_PP_ADICAO,
	VL_OD_IN_DIO_ESF,
	VL_OD_IN_DIO_CIL,
	VL_OD_IN_EIXO,
	VL_OD_IN_ADICAO,
	VL_OE_IN_DIO_ESF,
	VL_OE_IN_DIO_CIL,
	VL_OE_IN_EIXO,
	VL_OE_IN_ADICAO,
	a.DS_OBSERVACAO
FROM	OFT_OCULOS a,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
AND	coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
ORDER   BY dt_registro desc;

C27 CURSOR FOR
SELECT   a.dt_prescricao,
	 a.nr_prescricao,
	 SUBSTR(Obter_nome_medico(A.CD_MEDICO,'N'),1,150) NM_MEDICO,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	 substr(obter_itens_prescr(a.nr_prescricao, a.ds_itens_prescr),1,255) ds_itens_prescr
FROM	 prescr_medica a ,
	pessoa_fisica x
WHERE (a.nr_atendimento = nr_atendimento_w)
and      coalesce(a.dt_suspensao::text, '') = ''
and 	x.cd_pessoa_fisica 	=	a.cd_medico
order by a.nr_prescricao desc;

C28 CURSOR FOR
SELECT   TO_CHAR(dt_receita,'dd/mm/yyyy hh24:mi:ss'),
	 obter_nome_pf(a.CD_MEDICO) nm_profissional,
	 substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	 nr_sequencia
FROM  	 med_receita a,
	pessoa_fisica x
WHERE 	 nr_atendimento_hosp = nr_atendimento_w
AND	 coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	a.CD_MEDICO
ORDER BY dt_receita DESC;

C29 CURSOR FOR
SELECT 	obter_nome_pf(cd_profissional) nm_profissional,
	substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	TO_CHAR(dt_registro,'dd/mm/yyyy hh24:mi:ss')
FROM	oft_paquimetria,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
AND	coalesce(ie_situacao,'A') = 'A'
and 	x.cd_pessoa_fisica 	=	cd_profissional
and (IE_TIPO_PAQUIMETRIA = 'U')
ORDER   BY dt_registro desc;

C30 CURSOR FOR
SELECT to_char(dt_registro,'dd/mm/yyyy hh24:mi:ss'),
	   obter_nome_pf(cd_profissional) nm_profissional,
	   substr(obter_desc_cargo(x.cd_cargo),1,255) ds_profissional,
	   obter_desc_tipo_acuidade(vl_potencial_od) vl_potencial_od,
	   obter_desc_tipo_acuidade(vl_potencial_oe) vl_potencial_oe,
	   a.ds_observacao
from    OFT_POTENCIAL_ACUIDADE a,
	pessoa_fisica x
WHERE  	((nr_seq_consulta = nr_seq_consulta_p) OR ((ie_mostra_todos_p = 'S') AND  nr_seq_consulta IN (SELECT c.nr_sequencia
                                                                        	 	  	      FROM    atendimento_paciente b,
                                                                              				      oft_consulta c
                                                                       				      WHERE   c.nr_atendimento = b.nr_atendimento
                                                                        			      AND    b.cd_pessoa_fisica = cd_pessoa_fisica_p)))
and 	cd_profissional 	= 	x.cd_pessoa_fisica
and	coalesce(ie_situacao,'A') = 'A'
order   by dt_registro desc;



BEGIN

ie_tela_nova_lente_w := obter_param_usuario(3010, 62, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, ie_tela_nova_lente_w);
ie_oculta_inf_refracao_w := obter_param_usuario(3010, 57, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, ie_oculta_inf_refracao_w);

if (nr_seq_consulta_p IS NOT NULL AND nr_seq_consulta_p::text <> '') then
	SELECT MAX(nr_atendimento)
	into STRICT  nr_atendimento_w
	FROM  oft_consulta
	WHERE nr_sequencia = nr_seq_consulta_p;
end if;

cd_perfil_w := obter_perfil_ativo;

open C01;
loop
	fetch C01 into
		nm_profissional_w,
		ds_profissional_w,
		dt_anamnese_w,
		ds_anamnese_w,
		ds_historia_ocular_w,
		ds_medicamentos_w,
		ds_alergia_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */
	begin
	ds_ger_anamnese_w	:= 	ds_ger_anamnese_w || 'DATA: '|| dt_anamnese_w || ds_espaco_20_w ||
							'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w || ds_enter_w ||
							'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w ||
							'QUEIXA: ' || ds_anamnese_w ||ds_enter_w|| ds_enter_w ||
							'HIST. OFTALMOLÓGICA: ' || ds_historia_ocular_w || ds_enter_w|| ds_enter_w ||
							'MEDICAMENTOS: ' || ds_medicamentos_w || ds_enter_w|| ds_enter_w ||
							'ALERGIAS: ' || ds_alergia_w || ds_enter_w||ds_enter_w;
	ds_ger_anamnese_w 	:= ds_ger_anamnese_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C01;
open C02;
loop
	fetch C02 into
		dt_registro_w,
		nm_profissional_w,
		ds_profissional_w,
		vl_od_pl_av_cc_w,
		vl_od_pl_av_sc_w,
		vl_oe_pl_av_cc_w,
		vl_oe_pl_av_sc_w,
		vl_od_pp_av_w,
		vl_oe_pp_av_w,
		ds_observacao_w;
	EXIT WHEN NOT FOUND; /* apply on C02 */
	begin
	ds_acuidade_visual_w	:= 	ds_acuidade_visual_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
								'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w ||ds_enter_w ||
								'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
	ds_acuidade_visual_w	:= 	ds_acuidade_visual_w || 'PARA LONGE' ||	ds_enter_w;

	if (vl_od_pl_av_cc_w IS NOT NULL AND vl_od_pl_av_cc_w::text <> '') or (vl_od_pl_av_sc_w IS NOT NULL AND vl_od_pl_av_sc_w::text <> '') then
		ds_acuidade_visual_w	:= ds_acuidade_visual_w ||lpad('OD    AV/CC: ',15,' ')||vl_od_pl_av_cc_w ||ds_espaco_20_w;
		ds_acuidade_visual_w	:= ds_acuidade_visual_w ||lpad('OD    AV/SC: ',15,' ')||vl_od_pl_av_sc_w ||ds_enter_w;
	end if;

	if (vl_oe_pl_av_cc_w IS NOT NULL AND vl_oe_pl_av_cc_w::text <> '') or (vl_oe_pl_av_sc_w IS NOT NULL AND vl_oe_pl_av_sc_w::text <> '') then
		ds_acuidade_visual_w	:= ds_acuidade_visual_w ||lpad('OE    AV/CC: ',15,' ')||vl_oe_pl_av_cc_w ||ds_espaco_20_w;
		ds_acuidade_visual_w	:= ds_acuidade_visual_w ||lpad('OE    AV/SC: ',15,' ')||vl_oe_pl_av_sc_w ||ds_enter_w;
	end if;

	ds_acuidade_visual_w	:= 	ds_acuidade_visual_w || ds_enter_w|| 'PARA PERTO' ||ds_enter_w;

	if (vl_od_pp_av_w IS NOT NULL AND vl_od_pp_av_w::text <> '') or (vl_oe_pp_av_w IS NOT NULL AND vl_oe_pp_av_w::text <> '') then
		ds_acuidade_visual_w	:= ds_acuidade_visual_w ||lpad('OD    AV: ',15,' ')||vl_od_pp_av_w ||ds_enter_w;
		ds_acuidade_visual_w	:= ds_acuidade_visual_w ||lpad('OE    AV: ',15,' ')||vl_oe_pp_av_w ||ds_enter_w;
	end if;
    ds_acuidade_visual_w := ds_acuidade_visual_w || ds_enter_w || 'OBSERVAÇÃO: ' || ds_observacao_w ||ds_enter_w;
	ds_acuidade_visual_w := ds_acuidade_visual_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C02;

open C03;
loop
	fetch C03 into
		nm_profissional_w,
		ds_profissional_w,
		dt_registro_w,
		ds_tipo_lente_w,
		qt_tempo_uso_w,
		ds_unidade_tempo_w,
		vl_od_pl_dio_esf_w,
		vl_od_pl_dio_cil_w,
		vl_od_pl_eixo_w,
		vl_od_pl_adicao_w,
		vl_oe_pl_dio_esf_w,
		vl_oe_pl_dio_cil_w,
		vl_oe_pl_eixo_w,
		vl_od_pp_dio_esf_w,
		vl_od_pp_dio_cil_w,
		vl_od_pp_eixo_w,
		vl_oe_pp_dio_esf_w,
		vl_oe_pp_dio_cil_w,
		vl_oe_pp_eixo_w,
		ds_observacao_w;
	EXIT WHEN NOT FOUND; /* apply on C03 */
	begin
	ds_correcao_optica_w	:= 	ds_correcao_optica_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
								'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w ||ds_enter_w ||
								'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
	ds_correcao_optica_w	:= ds_correcao_optica_w ||'TIPO DE LENTE : '||ds_tipo_lente_w ||ds_enter_w;
	ds_correcao_optica_w	:= ds_correcao_optica_w ||'TEMPO DE USO  : '||qt_tempo_uso_w || ' ' || ds_unidade_tempo_w || ds_enter_w||ds_enter_w;

	if (vl_od_pl_dio_esf_w IS NOT NULL AND vl_od_pl_dio_esf_w::text <> '') or (vl_od_pl_dio_cil_w IS NOT NULL AND vl_od_pl_dio_cil_w::text <> '') or (vl_od_pl_eixo_w IS NOT NULL AND vl_od_pl_eixo_w::text <> '') 	 or (vl_od_pl_adicao_w IS NOT NULL AND vl_od_pl_adicao_w::text <> '') then
		ds_correcao_optica_w	:= ds_correcao_optica_w || 'PARA LONGE' || ds_enter_w;
		ds_correcao_optica_w	:= ds_correcao_optica_w ||lpad('OD DE: ',15,' ')||vl_od_pl_dio_esf_w;
		ds_correcao_optica_w	:= ds_correcao_optica_w ||lpad('DC: ',15,' ')||vl_od_pl_dio_cil_w;
		ds_correcao_optica_w	:= ds_correcao_optica_w ||lpad('EIXO: ',15,' ')||vl_od_pl_eixo_w;
		ds_correcao_optica_w	:= ds_correcao_optica_w ||lpad('ADIÇÃO: ',15,' ')||vl_od_pl_adicao_w ||ds_enter_w;
	end if;

	if (vl_oe_pl_dio_esf_w IS NOT NULL AND vl_oe_pl_dio_esf_w::text <> '') or (vl_oe_pl_dio_cil_w IS NOT NULL AND vl_oe_pl_dio_cil_w::text <> '') or (vl_oe_pl_eixo_w IS NOT NULL AND vl_oe_pl_eixo_w::text <> '') 	 then
		ds_correcao_optica_w	:= ds_correcao_optica_w ||lpad('OE DE: ',15,' ')||vl_oe_pl_dio_esf_w;
		ds_correcao_optica_w	:= ds_correcao_optica_w ||lpad('DC: ',15,' ')||vl_oe_pl_dio_cil_w;
		ds_correcao_optica_w	:= ds_correcao_optica_w ||lpad('EIXO: ',15,' ')||vl_oe_pl_eixo_w ||ds_enter_w;
	end if;

	if (vl_od_pp_dio_esf_w IS NOT NULL AND vl_od_pp_dio_esf_w::text <> '') or (vl_od_pp_dio_cil_w IS NOT NULL AND vl_od_pp_dio_cil_w::text <> '') or (vl_od_pp_eixo_w IS NOT NULL AND vl_od_pp_eixo_w::text <> '') 	 then
		ds_correcao_optica_w	:= ds_correcao_optica_w || ds_enter_w || 'PARA PERTO' || ds_enter_w;
		ds_correcao_optica_w	:= ds_correcao_optica_w ||lpad('OD DE: ',15,' ')||vl_od_pp_dio_esf_w;
		ds_correcao_optica_w	:= ds_correcao_optica_w ||lpad('DC: ',15,' ')||vl_od_pp_dio_cil_w;
		ds_correcao_optica_w	:= ds_correcao_optica_w ||lpad('EIXO: ',15,' ')||vl_od_pp_eixo_w ||ds_enter_w;
	end if;

	if (vl_oe_pp_dio_esf_w IS NOT NULL AND vl_oe_pp_dio_esf_w::text <> '') or (vl_oe_pp_dio_cil_w IS NOT NULL AND vl_oe_pp_dio_cil_w::text <> '') or (vl_oe_pp_eixo_w IS NOT NULL AND vl_oe_pp_eixo_w::text <> '') 	 then
		ds_correcao_optica_w	:= ds_correcao_optica_w ||lpad('OE DE: ',15,' ')||vl_oe_pp_dio_esf_w;
		ds_correcao_optica_w	:= ds_correcao_optica_w ||lpad('DC: ',15,' ')||vl_oe_pp_dio_cil_w;
		ds_correcao_optica_w	:= ds_correcao_optica_w ||lpad('EIXO: ',15,' ')||vl_oe_pp_eixo_w ||ds_enter_w;
	end if;
	ds_correcao_optica_w := ds_correcao_optica_w || ds_enter_w || 'OBSERVAÇÃO: ' || ds_observacao_w ||ds_enter_w;
	ds_correcao_optica_w := ds_correcao_optica_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C03;
open C04;
loop
	fetch C04 into
		nm_profissional_w,
		ds_profissional_w,
		dt_registro_w,
		ds_fundoscopia_oe_w,
		ds_fundoscopia_od_w,
		ds_observacao_w;
	EXIT WHEN NOT FOUND; /* apply on C04 */
	begin
	ds_fundoscopia_w	:= 	ds_fundoscopia_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
							'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w ||ds_enter_w ||
							'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
	ds_fundoscopia_w	:= ds_fundoscopia_w ||lpad('FO OD: ',15,' ')||ds_fundoscopia_od_w || ds_enter_w;
	ds_fundoscopia_w	:= ds_fundoscopia_w ||lpad('FO OE: ',15,' ')||ds_fundoscopia_oe_w || ds_enter_w;
	ds_fundoscopia_w 	:= ds_fundoscopia_w || ds_enter_w || 'OBSERVAÇÃO: ' || ds_observacao_w ||ds_enter_w;
	ds_fundoscopia_w	:= ds_fundoscopia_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C04;

open C05;
loop
	fetch C05 into
		nm_profissional_w,
		ds_profissional_w,
		dt_registro_w,
		vl_pressao_oe_w,
		vl_pressao_od_w,
		ie_tipo_tonometria_w;
	EXIT WHEN NOT FOUND; /* apply on C05 */
	begin

	if (ie_tipo_tonometria_w = 2) then
		ds_tonometria_w	:= 	ds_tonometria_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
						'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w||ds_enter_w ||
						'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
		ds_tonometria_w	:= ds_tonometria_w ||lpad('OD (mmHg): ',15,' ')||vl_pressao_oe_w || ds_enter_w;
		ds_tonometria_w	:= ds_tonometria_w ||lpad('OE (mmHg): ',15,' ')||vl_pressao_od_w || ds_enter_w;
		ds_tonometria_w := ds_tonometria_w || ds_quebra_w || ds_enter_w;
	end if;


	if (ie_tipo_tonometria_w = 1) then
		ds_tonometria_2_w	:= 	ds_tonometria_2_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
						'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w||ds_enter_w ||
						'PROFISSÃO:' || ds_profissional_w || ds_enter_w || ds_enter_w;
		ds_tonometria_2_w	:= ds_tonometria_2_w ||lpad('OD (mmHg): ',15,' ')||vl_pressao_oe_w || ds_enter_w;
		ds_tonometria_2_w	:= ds_tonometria_2_w ||lpad('OE (mmHg): ',15,' ')||vl_pressao_od_w || ds_enter_w;
		ds_tonometria_2_w	 := ds_tonometria_2_w || ds_quebra_w || ds_enter_w;

	end if;

	end;
end loop;
close C05;

open C06;
loop
	fetch C06 into
		nm_profissional_w,
		ds_profissional_w,
		dt_registro_w,
		vl_od_ard_dnp_w,
		vl_oe_ard_dnp_w,
		vl_ard_dp_w,
		ds_observacao_w;
	EXIT WHEN NOT FOUND; /* apply on C06 */
	begin
	ds_dnp_w	:= 	ds_dnp_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
					'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w || ds_enter_w ||
					'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
	ds_dnp_w	:= ds_dnp_w ||lpad('OD (mm): ',15,' ')||vl_od_ard_dnp_w || ds_enter_w;
	ds_dnp_w	:= ds_dnp_w ||lpad('OE (mm): ',15,' ')||vl_oe_ard_dnp_w || ds_enter_w;
	ds_dnp_w	:= ds_dnp_w ||lpad('DP (mm): ',15,' ')||vl_ard_dp_w || ds_enter_w;
	ds_dnp_w 	:= ds_dnp_w || ds_enter_w || 'OBSERVAÇÃO: ' || ds_observacao_w ||ds_enter_w;
	ds_dnp_w 	:= ds_dnp_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C06;

open C07;
loop
	fetch C07 into
		nm_profissional_w,
		ds_profissional_w,
		dt_registro_w,
		ds_biomicroscopia_od_w,
		ds_biomicroscopia_oe_w,
		ds_observacao_w,
		ds_segmento_w;
	EXIT WHEN NOT FOUND; /* apply on C07 */
	begin
	biomicroscopia_w	:= 	biomicroscopia_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
							'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w ||ds_enter_w ||
							'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
	biomicroscopia_w	:= biomicroscopia_w ||ds_segmento_w || ds_enter_w||ds_enter_w;
	biomicroscopia_w	:= biomicroscopia_w ||lpad('Biomicroscopia OD: ',19,' ')||ds_biomicroscopia_od_w || ds_enter_w;
	biomicroscopia_w	:= biomicroscopia_w ||lpad('Biomicroscopia OE: ',19,' ')||ds_biomicroscopia_oe_w || ds_enter_w||ds_enter_w;
	biomicroscopia_w 	:= biomicroscopia_w || ds_enter_w || 'OBSERVAÇÃO: ' || ds_observacao_w ||ds_enter_w;
	biomicroscopia_w 	:= biomicroscopia_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C07;

open C08;
loop
	fetch C08 into
		nm_profissional_w,
		ds_profissional_w,
		dt_registro_w,
		vl_od_ard_esf_w,
		vl_od_ard_cil_w,
		vl_od_ard_eixo_w,
		qt_reflexo_od_w,
		vl_oe_ard_esf_w,
		vl_oe_ard_cil_w,
		vl_oe_ard_eixo_w,
		qt_reflexo_oe_w,
		qt_distancia_np_w,
		vl_od_are_esf_w,
		vl_od_are_cil_w,
		vl_od_are_eixo_w,
		qt_reflexo_are_od_w,
		vl_oe_are_esf_w,
		vl_oe_are_cil_w,
		vl_oe_are_eixo_w,
		qt_reflexo_are_oe_w,
		ds_observacao_w,
		vl_od_lenso_esf_w,
		vl_od_lenso_cil_w,
		vl_od_lenso_eixo_w,
		vl_adicao_lanso_w,
		vl_oe_lenso_esf_w,
		vl_oe_lenso_cil_w,
		vl_oe_lenso_eixo_w;
	EXIT WHEN NOT FOUND; /* apply on C08 */
	begin
	ds_auto_refracao_w	:= 	ds_auto_refracao_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
							'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w || ds_enter_w ||
							'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
	ds_auto_refracao_w	:= ds_auto_refracao_w ||'AUTO REFRAÇÃO DINÂMICA'||ds_enter_w;
	if (vl_od_ard_esf_w IS NOT NULL AND vl_od_ard_esf_w::text <> '') or (vl_od_ard_cil_w IS NOT NULL AND vl_od_ard_cil_w::text <> '') or (vl_od_ard_eixo_w IS NOT NULL AND vl_od_ard_eixo_w::text <> '') or (qt_reflexo_od_w IS NOT NULL AND qt_reflexo_od_w::text <> '')	then
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('OD DE: ',12,' ')||vl_od_ard_esf_w;
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('DC: ',12,' ')||vl_od_ard_cil_w;
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('EIXO: ',12,' ')||vl_od_ard_eixo_w;
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('Reflexo: ',12,' ')||qt_reflexo_od_w;
	end if;

	if (qt_distancia_np_w IS NOT NULL AND qt_distancia_np_w::text <> '') then
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('DNP: ',10,' ')||qt_distancia_np_w ||ds_enter_w;
	else
		ds_auto_refracao_w	:= ds_auto_refracao_w ||ds_enter_w;
	end if;

	if (vl_oe_ard_esf_w IS NOT NULL AND vl_oe_ard_esf_w::text <> '') or (vl_oe_ard_cil_w IS NOT NULL AND vl_oe_ard_cil_w::text <> '') or (vl_oe_ard_eixo_w IS NOT NULL AND vl_oe_ard_eixo_w::text <> '') or (qt_reflexo_oe_w IS NOT NULL AND qt_reflexo_oe_w::text <> '')	then
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('OE DE: ',12,' ')||vl_oe_ard_esf_w;
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('DC: ',12,' ')||vl_oe_ard_cil_w;
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('EIXO: ',12,' ')||vl_oe_ard_eixo_w;
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('Reflexo: ',12,' ')||qt_reflexo_oe_w ||ds_enter_w;
	end if;

	ds_auto_refracao_w	:= ds_auto_refracao_w || ds_enter_w|| 'AUTO REFRAÇÃO ESTÁTICA'||ds_enter_w;

	if (vl_od_are_esf_w IS NOT NULL AND vl_od_are_esf_w::text <> '') or (vl_od_are_cil_w IS NOT NULL AND vl_od_are_cil_w::text <> '') or (vl_od_are_eixo_w IS NOT NULL AND vl_od_are_eixo_w::text <> '') or (qt_reflexo_are_od_w IS NOT NULL AND qt_reflexo_are_od_w::text <> '')	then
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('OD DE: ',12,' ')||vl_od_are_esf_w;
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('DC: ',12,' ')||vl_od_are_cil_w;
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('EIXO: ',12,' ')||vl_od_are_eixo_w;
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('Reflexo: ',12,' ')||qt_reflexo_are_od_w ||ds_enter_w;
	end if;

	if (vl_oe_are_esf_w IS NOT NULL AND vl_oe_are_esf_w::text <> '') or (vl_oe_are_cil_w IS NOT NULL AND vl_oe_are_cil_w::text <> '') or (vl_oe_are_eixo_w IS NOT NULL AND vl_oe_are_eixo_w::text <> '') or (qt_reflexo_are_oe_w IS NOT NULL AND qt_reflexo_are_oe_w::text <> '')	then
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('OE DE: ',12,' ')||vl_oe_are_esf_w;
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('DC: ',12,' ')||vl_oe_are_cil_w;
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('EIXO: ',12,' ')||vl_oe_are_eixo_w;
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('Reflexo: ',12,' ')||qt_reflexo_are_oe_w ||ds_enter_w;
	end if;

	ds_auto_refracao_w	:= ds_auto_refracao_w || ds_enter_w|| 'LANSOMETRIA'||ds_enter_w;

	if (vl_od_lenso_esf_w IS NOT NULL AND vl_od_lenso_esf_w::text <> '') or (vl_od_lenso_cil_w IS NOT NULL AND vl_od_lenso_cil_w::text <> '') or (vl_od_lenso_eixo_w IS NOT NULL AND vl_od_lenso_eixo_w::text <> '') or (vl_adicao_lanso_w IS NOT NULL AND vl_adicao_lanso_w::text <> '')	then
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('OD DE: ',12,' ')||vl_od_lenso_esf_w;
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('DC: ',12,' ')||vl_od_lenso_cil_w;
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('EIXO: ',12,' ')||vl_od_lenso_eixo_w;
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('ADIÇÃO: ',12,' ')||vl_adicao_lanso_w ||ds_enter_w;
	end if;

	if (vl_oe_lenso_esf_w IS NOT NULL AND vl_oe_lenso_esf_w::text <> '') or (vl_oe_lenso_cil_w IS NOT NULL AND vl_oe_lenso_cil_w::text <> '') or (vl_oe_lenso_eixo_w IS NOT NULL AND vl_oe_lenso_eixo_w::text <> '') then
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('OE DE: ',12,' ')|| vl_oe_lenso_esf_w;
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('DC: ',12,' ')|| vl_oe_lenso_cil_w;
		ds_auto_refracao_w	:= ds_auto_refracao_w ||lpad('EIXO: ',12,' ')|| vl_oe_lenso_eixo_w ||ds_enter_w;
	end if;

	ds_auto_refracao_w 	:= ds_auto_refracao_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C08;

open C09;
loop
	fetch C09 into
		nm_profissional_w,
		ds_profissional_w,
		dt_registro_w,
		vl_od_pl_ard_esf_w,
		vl_od_pl_ard_cil_w,
		vl_od_pl_ard_eixo_w,
		vl_od_pl_ard_av_sc_w,
		vl_adicao_w,
		vl_adicao_oe_w,
		vl_oe_pl_ard_esf_w,
		vl_oe_pl_ard_cil_w,
		vl_oe_pl_ard_eixo_w,
		vl_oe_pl_ard_av_sc_w,
		vl_od_pp_ard_esf_w,
		vl_od_pp_ard_cil_w,
		vl_od_pp_ard_eixo_w,
		vl_od_pp_ard_av_sc_w,
		vl_oe_pp_ard_esf_w,
		vl_oe_pp_ard_cil_w,
		vl_oe_pp_ard_eixo_w,
		vl_oe_pp_ard_av_sc_w,
		vl_od_pl_are_esf_w,
		vl_od_pl_are_cil_w,
		vl_od_pl_are_eixo_w,
		vl_od_pl_are_av_sc_w,
		vl_oe_pl_are_esf_w,
		vl_oe_pl_are_cil_w,
		vl_oe_pl_are_eixo_w,
		vl_oe_pl_are_av_sc_w,
		vl_od_pp_are_esf_w,
		vl_od_pp_are_cil_w,
		vl_od_pp_are_eixo_w,
		vl_od_pp_are_av_sc_w,
		vl_oe_pp_are_esf_w,
		vl_oe_pp_are_cil_w,
		vl_oe_pp_are_eixo_w,
		vl_oe_pp_are_av_sc_w;
    EXIT WHEN NOT FOUND; /* apply on C09 */
	begin
	ds_refracao_w	:= 	ds_refracao_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
						'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w||ds_enter_w ||
						'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
	ds_refracao_w	:= ds_refracao_w ||'REFRAÇÃO DINÂMICA PARA LONGE'||ds_enter_w;
	if (vl_od_pl_ard_esf_w IS NOT NULL AND vl_od_pl_ard_esf_w::text <> '') or (vl_od_pl_ard_cil_w IS NOT NULL AND vl_od_pl_ard_cil_w::text <> '') or (vl_od_pl_ard_eixo_w IS NOT NULL AND vl_od_pl_ard_eixo_w::text <> '') or (vl_od_pl_ard_av_sc_w IS NOT NULL AND vl_od_pl_ard_av_sc_w::text <> '')	then
		ds_refracao_w	:= ds_refracao_w ||lpad('OD DE: ',12,' ')||oft_obter_valor_com_sinal(vl_od_pl_ard_esf_w);
		if (ie_oculta_inf_refracao_w = 'S') then
			ds_refracao_w	:= ds_refracao_w ||lpad('DC: ',12,' ')||oft_obter_valor_com_sinal_neg(vl_od_pl_ard_cil_w);
		else
			ds_refracao_w	:= ds_refracao_w ||lpad('DC: ',12,' ')||oft_obter_valor_com_sinal(vl_od_pl_ard_cil_w);
		end if;
		ds_refracao_w	:= ds_refracao_w ||lpad('EIXO: ',12,' ')||vl_od_pl_ard_eixo_w;
		ds_refracao_w	:= ds_refracao_w ||lpad('AV: ',12,' ')||vl_od_pl_ard_av_sc_w;
	end if;

	if (vl_adicao_w IS NOT NULL AND vl_adicao_w::text <> '') then
		ds_refracao_w	:= ds_refracao_w ||lpad('Adição: ',12,' ')||vl_adicao_w ||ds_enter_w;
	else
		ds_refracao_w	:= ds_refracao_w ||ds_enter_w;
	end if;

	if (vl_oe_pl_ard_esf_w IS NOT NULL AND vl_oe_pl_ard_esf_w::text <> '') or (vl_oe_pl_ard_cil_w IS NOT NULL AND vl_oe_pl_ard_cil_w::text <> '') or (vl_oe_pl_ard_eixo_w IS NOT NULL AND vl_oe_pl_ard_eixo_w::text <> '') or (vl_oe_pl_ard_av_sc_w IS NOT NULL AND vl_oe_pl_ard_av_sc_w::text <> '')	then
		ds_refracao_w	:= ds_refracao_w ||lpad('OE DE: ',12,' ')||oft_obter_valor_com_sinal(vl_oe_pl_ard_esf_w);
		if (ie_oculta_inf_refracao_w = 'S') then
			ds_refracao_w	:= ds_refracao_w ||lpad('DC: ',12,' ')||oft_obter_valor_com_sinal_neg(vl_oe_pl_ard_cil_w);
		else
			ds_refracao_w	:= ds_refracao_w ||lpad('DC: ',12,' ')||oft_obter_valor_com_sinal(vl_oe_pl_ard_cil_w);
		end if;
		ds_refracao_w	:= ds_refracao_w ||lpad('EIXO: ',12,' ')||vl_oe_pl_ard_eixo_w;
		ds_refracao_w	:= ds_refracao_w ||lpad('AV: ',12,' ')||vl_oe_pl_ard_av_sc_w;
	end if;

	if (vl_adicao_oe_w IS NOT NULL AND vl_adicao_oe_w::text <> '') then
		ds_refracao_w	:= ds_refracao_w ||lpad('Adição: ',12,' ')||vl_adicao_oe_w ||ds_enter_w;
	else
		ds_refracao_w	:= ds_refracao_w ||ds_enter_w;
	end if;


	ds_refracao_w	:= ds_refracao_w || ds_enter_w || 'REFRAÇÃO DINÂMICA PARA PERTO'||ds_enter_w;

	if (vl_od_pp_ard_esf_w IS NOT NULL AND vl_od_pp_ard_esf_w::text <> '') or (vl_od_pp_ard_cil_w IS NOT NULL AND vl_od_pp_ard_cil_w::text <> '') or (vl_od_pp_ard_eixo_w IS NOT NULL AND vl_od_pp_ard_eixo_w::text <> '') or (vl_od_pp_ard_av_sc_w IS NOT NULL AND vl_od_pp_ard_av_sc_w::text <> '')	then
		ds_refracao_w	:= ds_refracao_w ||lpad('OD DE: ',12,' ')||oft_obter_valor_com_sinal(vl_od_pp_ard_esf_w);
		if (ie_oculta_inf_refracao_w = 'S') then
			ds_refracao_w	:= ds_refracao_w ||lpad('DC: ',12,' ')||oft_obter_valor_com_sinal_neg(vl_od_pp_ard_cil_w);
		else
			ds_refracao_w	:= ds_refracao_w ||lpad('DC: ',12,' ')||oft_obter_valor_com_sinal(vl_od_pp_ard_cil_w);
		end if;
		ds_refracao_w	:= ds_refracao_w ||lpad('EIXO: ',12,' ')||vl_od_pp_ard_eixo_w;
		ds_refracao_w	:= ds_refracao_w ||lpad('AV: ',12,' ')||vl_od_pp_ard_av_sc_w ||ds_enter_w;
	end if;

	if (vl_oe_pp_ard_esf_w IS NOT NULL AND vl_oe_pp_ard_esf_w::text <> '') or (vl_oe_pp_ard_cil_w IS NOT NULL AND vl_oe_pp_ard_cil_w::text <> '') or (vl_oe_pp_ard_eixo_w IS NOT NULL AND vl_oe_pp_ard_eixo_w::text <> '') or (vl_oe_pp_ard_av_sc_w IS NOT NULL AND vl_oe_pp_ard_av_sc_w::text <> '')	then
		ds_refracao_w	:= ds_refracao_w ||lpad('OE DE: ',12,' ')||oft_obter_valor_com_sinal(vl_oe_pp_ard_esf_w);
		if (ie_oculta_inf_refracao_w = 'S') then
			ds_refracao_w	:= ds_refracao_w ||lpad('DC: ',12,' ')||oft_obter_valor_com_sinal_neg(vl_oe_pp_ard_cil_w);
		else
			ds_refracao_w	:= ds_refracao_w ||lpad('DC: ',12,' ')||oft_obter_valor_com_sinal(vl_oe_pp_ard_cil_w);
		end if;
		ds_refracao_w	:= ds_refracao_w ||lpad('EIXO: ',12,' ')||vl_oe_pp_ard_eixo_w;
		ds_refracao_w	:= ds_refracao_w ||lpad('AV: ',12,' ')||vl_oe_pp_ard_av_sc_w ||ds_enter_w;
	end if;

	ds_refracao_w	:= ds_refracao_w || ds_enter_w || 'REFRAÇÃO ESTÁTICA PARA LONGE'||ds_enter_w;

	if (vl_od_pl_are_esf_w IS NOT NULL AND vl_od_pl_are_esf_w::text <> '') or (vl_od_pl_are_cil_w IS NOT NULL AND vl_od_pl_are_cil_w::text <> '') or (vl_od_pl_are_eixo_w IS NOT NULL AND vl_od_pl_are_eixo_w::text <> '') or (vl_od_pl_are_av_sc_w IS NOT NULL AND vl_od_pl_are_av_sc_w::text <> '')	then
		ds_refracao_w	:= ds_refracao_w ||lpad('OD DE: ',12,' ')||oft_obter_valor_com_sinal(vl_od_pl_are_esf_w);
		if (ie_oculta_inf_refracao_w = 'S') then
			ds_refracao_w	:= ds_refracao_w ||lpad('DC: ',12,' ')||oft_obter_valor_com_sinal_neg(vl_od_pl_are_cil_w);
		else
			ds_refracao_w	:= ds_refracao_w ||lpad('DC: ',12,' ')||oft_obter_valor_com_sinal(vl_od_pl_are_cil_w);
		end if;
		ds_refracao_w	:= ds_refracao_w ||lpad('EIXO: ',12,' ')||vl_od_pl_are_eixo_w;
		ds_refracao_w	:= ds_refracao_w ||lpad('AV: ',12,' ')||vl_od_pl_are_av_sc_w ||ds_enter_w;
	end if;

	if (vl_oe_pl_are_esf_w IS NOT NULL AND vl_oe_pl_are_esf_w::text <> '') or (vl_oe_pl_are_cil_w IS NOT NULL AND vl_oe_pl_are_cil_w::text <> '') or (vl_oe_pl_are_eixo_w IS NOT NULL AND vl_oe_pl_are_eixo_w::text <> '') or (vl_oe_pl_are_av_sc_w IS NOT NULL AND vl_oe_pl_are_av_sc_w::text <> '')	then
		ds_refracao_w	:= ds_refracao_w ||lpad('OE DE: ',12,' ')||oft_obter_valor_com_sinal(vl_oe_pl_are_esf_w);
		if (ie_oculta_inf_refracao_w = 'S') then
			ds_refracao_w	:= ds_refracao_w ||lpad('DC: ',12,' ')||oft_obter_valor_com_sinal_neg(vl_oe_pl_are_cil_w);
		else
			ds_refracao_w	:= ds_refracao_w ||lpad('DC: ',12,' ')||oft_obter_valor_com_sinal(vl_oe_pl_are_cil_w);
		end if;
		ds_refracao_w	:= ds_refracao_w ||lpad('EIXO: ',12,' ')||vl_oe_pl_are_eixo_w;
		ds_refracao_w	:= ds_refracao_w ||lpad('AV: ',12,' ')||vl_oe_pl_are_av_sc_w ||ds_enter_w;
	end if;

	ds_refracao_w	:= ds_refracao_w || ds_enter_w || 'REFRAÇÃO ESTÁTICA PARA PERTO'||ds_enter_w;

	if (vl_od_pp_are_esf_w IS NOT NULL AND vl_od_pp_are_esf_w::text <> '') or (vl_od_pp_are_cil_w IS NOT NULL AND vl_od_pp_are_cil_w::text <> '') or (vl_od_pp_are_eixo_w IS NOT NULL AND vl_od_pp_are_eixo_w::text <> '') or (vl_od_pp_are_av_sc_w IS NOT NULL AND vl_od_pp_are_av_sc_w::text <> '')	then
		ds_refracao_w	:= ds_refracao_w ||lpad('OD DE: ',12,' ')||oft_obter_valor_com_sinal(vl_od_pp_are_esf_w);
		if (ie_oculta_inf_refracao_w = 'S') then
			ds_refracao_w	:= ds_refracao_w ||lpad('DC: ',12,' ')||oft_obter_valor_com_sinal_neg(vl_od_pp_are_cil_w);
		else
			ds_refracao_w	:= ds_refracao_w ||lpad('DC: ',12,' ')||oft_obter_valor_com_sinal(vl_od_pp_are_cil_w);
		end if;
		ds_refracao_w	:= ds_refracao_w ||lpad('EIXO: ',12,' ')||vl_od_pp_are_eixo_w;
		ds_refracao_w	:= ds_refracao_w ||lpad('AV: ',12,' ')||vl_od_pp_are_av_sc_w ||ds_enter_w;
	end if;

	if (vl_oe_pp_are_esf_w IS NOT NULL AND vl_oe_pp_are_esf_w::text <> '') or (vl_oe_pp_are_cil_w IS NOT NULL AND vl_oe_pp_are_cil_w::text <> '') or (vl_oe_pp_are_eixo_w IS NOT NULL AND vl_oe_pp_are_eixo_w::text <> '') or (vl_oe_pp_are_av_sc_w IS NOT NULL AND vl_oe_pp_are_av_sc_w::text <> '')	then
		ds_refracao_w	:= ds_refracao_w ||lpad('OE DE: ',12,' ')||oft_obter_valor_com_sinal(vl_oe_pp_are_esf_w);
		if (ie_oculta_inf_refracao_w = 'S') then
			ds_refracao_w	:= ds_refracao_w ||lpad('DC: ',12,' ')||oft_obter_valor_com_sinal_neg(vl_oe_pp_are_cil_w);
		else
			ds_refracao_w	:= ds_refracao_w ||lpad('DC: ',12,' ')||oft_obter_valor_com_sinal(vl_oe_pp_are_cil_w);
		end if;
		ds_refracao_w	:= ds_refracao_w ||lpad('EIXO: ',12,' ')||vl_oe_pp_are_eixo_w;
		ds_refracao_w	:= ds_refracao_w ||lpad('AV: ',12,' ')||vl_oe_pp_are_av_sc_w ||ds_enter_w;
	end if;
	ds_refracao_w := ds_refracao_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C09;

open C10;
loop
	fetch C10 into
		nm_profissional_w,
		ds_profissional_w,
		dt_registro_w,
		qt_cur_horizontal_od_w,
		qt_cur_vertical_od_w,
		qt_eixo_horizontal_od_w,
		qt_eixo_vertical_od_w,
		qt_cur_horizontal_oe_w,
		qt_cur_vertical_oe_w,
		qt_eixo_horizontal_oe_w,
		qt_eixo_vertical_oe_w;
    EXIT WHEN NOT FOUND; /* apply on C10 */
	begin
	ds_ceratometria_w	:= 	ds_ceratometria_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
							'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w||ds_enter_w ||
							'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
	if (qt_cur_horizontal_od_w IS NOT NULL AND qt_cur_horizontal_od_w::text <> '') or (qt_cur_vertical_od_w IS NOT NULL AND qt_cur_vertical_od_w::text <> '') or (qt_eixo_horizontal_od_w IS NOT NULL AND qt_eixo_horizontal_od_w::text <> '') or (qt_eixo_vertical_od_w IS NOT NULL AND qt_eixo_vertical_od_w::text <> '')	then
		ds_ceratometria_w	:= ds_ceratometria_w ||lpad('CURV H OD: ',15,' ')||qt_cur_horizontal_od_w;
		ds_ceratometria_w	:= ds_ceratometria_w ||lpad('CURV V: ',13,' ')||qt_cur_vertical_od_w;
		ds_ceratometria_w	:= ds_ceratometria_w ||lpad('EIXO H: ',13,' ')||qt_eixo_horizontal_od_w;
		ds_ceratometria_w	:= ds_ceratometria_w ||lpad('EIXO V: ',13,' ')||qt_eixo_vertical_od_w ||ds_enter_w;
	end if;

	if (qt_cur_horizontal_oe_w IS NOT NULL AND qt_cur_horizontal_oe_w::text <> '') or (qt_cur_vertical_oe_w IS NOT NULL AND qt_cur_vertical_oe_w::text <> '') or (qt_eixo_horizontal_oe_w IS NOT NULL AND qt_eixo_horizontal_oe_w::text <> '') or (qt_eixo_vertical_oe_w IS NOT NULL AND qt_eixo_vertical_oe_w::text <> '')	then
		ds_ceratometria_w	:= ds_ceratometria_w ||lpad('CURV H OE: ',15,' ')||qt_cur_horizontal_oe_w;
		ds_ceratometria_w	:= ds_ceratometria_w ||lpad('CURV V: ',13,' ')||qt_cur_vertical_oe_w;
		ds_ceratometria_w	:= ds_ceratometria_w ||lpad('EIXO H: ',13,' ')||qt_eixo_horizontal_oe_w;
		ds_ceratometria_w	:= ds_ceratometria_w ||lpad('EIXO V: ',13,' ')||qt_eixo_vertical_oe_w ||ds_enter_w;
	end if;
	ds_ceratometria_w := ds_ceratometria_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C10;

open C11;
loop
	fetch C11 into
		nm_profissional_w,
		ds_profissional_w,
		dt_registro_w,
		ds_curva_tensional_oe_w,
		ds_curva_tensional_od_w;
	EXIT WHEN NOT FOUND; /* apply on C11 */
	begin
	ds_curva_tensional_w	:= 	ds_curva_tensional_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
							     'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w||ds_enter_w ||
							     'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;

	ds_curva_tensional_w	:= ds_curva_tensional_w ||lpad('OD: ',15,' ')||ds_curva_tensional_od_w || ds_enter_w;
	ds_curva_tensional_w	:= ds_curva_tensional_w ||lpad('OE: ',15,' ')||ds_curva_tensional_oe_w || ds_enter_w;
	ds_curva_tensional_w	:= ds_curva_tensional_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C11;

open C12;
loop
fetch C12 into
	   nm_profissional_w,
	   ds_profissional_w,
	   dt_registro_w,
	   qt_od_acd_inter_w,
	   qt_od_eixo_inter_w,
	   qt_od_emt_inter_w,
	   ds_od_formula_inter_w,
	   qt_od_acd_ultra_w,
	   qt_od_eixo_ultra_w,
	   qt_od_emt_ultra_w,
	   ds_od_formula_ultra_w,
	   qt_oe_acd_inter_w,
	   qt_oe_eixo_inter_w,
	   qt_oe_emt_inter_w,
	   ds_oe_formula_inter_w,
	   ds_observacao_w,
	   qt_oe_acd_ultra_w,
	   qt_oe_eixo_ultra_w,
	   qt_oe_emt_ultra_w,
           ds_oe_formula_ultra_w;
EXIT WHEN NOT FOUND; /* apply on C12 */
	begin
		ds_biometria_w	:= 	ds_biometria_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
							'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w || ds_enter_w ||
							'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
	        ds_biometria_w	:= ds_biometria_w ||'INTERFEROMETRIA'||ds_enter_w;
	if (qt_od_acd_inter_w IS NOT NULL AND qt_od_acd_inter_w::text <> '') or (qt_od_eixo_inter_w IS NOT NULL AND qt_od_eixo_inter_w::text <> '') or (qt_od_emt_inter_w IS NOT NULL AND qt_od_emt_inter_w::text <> '') or (ds_od_formula_inter_w IS NOT NULL AND ds_od_formula_inter_w::text <> '')	then
		ds_biometria_w	:= ds_biometria_w ||lpad('OD ACD: ',12,' ')||qt_od_acd_inter_w;
		ds_biometria_w	:= ds_biometria_w ||lpad('Eixo: ',12,' ')||qt_od_eixo_inter_w;
		ds_biometria_w	:= ds_biometria_w ||lpad('EMT: ',12,' ')||qt_od_emt_inter_w;
		ds_biometria_w	:= ds_biometria_w ||lpad('Fórmula: ',12,' ')||ds_od_formula_inter_w|| ds_enter_w;
	end if;

	if (qt_oe_acd_inter_w IS NOT NULL AND qt_oe_acd_inter_w::text <> '') or (qt_oe_eixo_inter_w IS NOT NULL AND qt_oe_eixo_inter_w::text <> '') or (qt_oe_emt_inter_w IS NOT NULL AND qt_oe_emt_inter_w::text <> '') or (ds_oe_formula_inter_w IS NOT NULL AND ds_oe_formula_inter_w::text <> '')	then
		ds_biometria_w	:= ds_biometria_w ||lpad('OE ACD: ',12,' ')||qt_oe_acd_inter_w;
		ds_biometria_w	:= ds_biometria_w ||lpad('Eixo: ',12,' ')||qt_oe_eixo_inter_w;
		ds_biometria_w	:= ds_biometria_w ||lpad('EMT: ',12,' ')||qt_oe_emt_inter_w;
		ds_biometria_w	:= ds_biometria_w ||lpad('Fórmula: ',12,' ')||ds_oe_formula_inter_w ||ds_enter_w;
	end if;

	ds_biometria_w	:= ds_biometria_w || ds_enter_w || 'ULTRASSONICA'||ds_enter_w;

	if (qt_od_acd_ultra_w IS NOT NULL AND qt_od_acd_ultra_w::text <> '') or (qt_od_eixo_ultra_w IS NOT NULL AND qt_od_eixo_ultra_w::text <> '') or (qt_od_emt_ultra_w IS NOT NULL AND qt_od_emt_ultra_w::text <> '') or (ds_od_formula_ultra_w IS NOT NULL AND ds_od_formula_ultra_w::text <> '')	then
		ds_biometria_w	:= ds_biometria_w ||lpad('OD ACD: ',12,' ')||qt_od_acd_ultra_w;
		ds_biometria_w	:= ds_biometria_w ||lpad('Eixo: ',12,' ')||qt_od_eixo_ultra_w;
		ds_biometria_w	:= ds_biometria_w ||lpad('EMT: ',12,' ')||qt_od_emt_ultra_w;
		ds_biometria_w	:= ds_biometria_w ||lpad('Fórmula: ',12,' ')||ds_od_formula_ultra_w ||ds_enter_w;
	end if;

	if (qt_oe_acd_ultra_w IS NOT NULL AND qt_oe_acd_ultra_w::text <> '') or (qt_oe_eixo_ultra_w IS NOT NULL AND qt_oe_eixo_ultra_w::text <> '') or (qt_oe_emt_ultra_w IS NOT NULL AND qt_oe_emt_ultra_w::text <> '') or (ds_oe_formula_ultra_w IS NOT NULL AND ds_oe_formula_ultra_w::text <> '')	then
		ds_biometria_w	:= ds_biometria_w ||lpad('OE ACD: ',12,' ')||qt_oe_acd_ultra_w;
		ds_biometria_w	:= ds_biometria_w ||lpad('Eixo: ',12,' ')||qt_oe_eixo_ultra_w;
		ds_biometria_w	:= ds_biometria_w ||lpad('EMT: ',12,' ')||qt_oe_emt_ultra_w;
		ds_biometria_w	:= ds_biometria_w ||lpad('Fórmula: ',12,' ')||ds_oe_formula_ultra_w ||ds_enter_w;
	end if;
	ds_biometria_w := ds_biometria_w || ds_enter_w || 'OBSERVAÇÃO: ' || ds_observacao_w ||ds_enter_w;
	ds_biometria_w := ds_biometria_w || ds_quebra_w || ds_enter_w;

	end;
end loop;
close C12;

open C13;
loop
fetch C13 into
	nm_profissional_w,
	ds_profissional_w,
	dt_registro_w,
	qt_od_microscopia_w,
	qt_oe_microscopia_w,
	ds_observacao_w;
EXIT WHEN NOT FOUND; /* apply on C13 */
	begin
	ds_microscopia_w	:= 	ds_microscopia_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
						'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w||ds_enter_w ||
						'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
	ds_microscopia_w	:= ds_microscopia_w ||lpad('OD (cél/mm2): ',15,' ')||qt_od_microscopia_w || ds_enter_w;
	ds_microscopia_w	:= ds_microscopia_w ||lpad('OE (cél/mm2): ',15,' ')||qt_oe_microscopia_w || ds_enter_w;
	ds_microscopia_w := ds_microscopia_w || ds_enter_w || 'OBSERVAÇÃO: ' || ds_observacao_w ||ds_enter_w;
	ds_microscopia_w := ds_microscopia_w || ds_quebra_w || ds_enter_w;

	end;
end loop;
close C13;

open C14;
loop
fetch C14 into
	nm_profissional_w,
	ds_profissional_w,
	dt_registro_w,
	qt_od_pupilometria_w,
	qt_oe_pupilometria_w,
	ds_observacao_w;
EXIT WHEN NOT FOUND; /* apply on C14 */
	begin
	ds_pupilometria_w	:= 	ds_pupilometria_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
						'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w||ds_enter_w ||
						'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
	ds_pupilometria_w := ds_pupilometria_w ||lpad('OD (mm): ',15,' ')||qt_od_pupilometria_w || ds_enter_w;
	ds_pupilometria_w := ds_pupilometria_w ||lpad('OE (mm): ',15,' ')||qt_oe_pupilometria_w|| ds_enter_w;
	ds_pupilometria_w := ds_pupilometria_w || ds_enter_w || 'OBSERVAÇÃO: ' || ds_observacao_w ||ds_enter_w;
	ds_pupilometria_w := ds_pupilometria_w || ds_quebra_w || ds_enter_w;

	end;
end loop;
close C14;

open C15;
loop
	fetch C15 into
		nm_profissional_w,
		ds_profissional_w,
		dt_registro_w,
		ds_angiografia_w,
		ds_oe_angiografia_w,
		ds_retinografia_w,
		ds_oe_retinografia_w,
		ds_observacao_w;
	EXIT WHEN NOT FOUND; /* apply on C15 */
	begin
	ds_angio_retino_w	:= 	ds_angio_retino_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
								'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w ||ds_enter_w ||
								'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
	if (ds_angiografia_w IS NOT NULL AND ds_angiografia_w::text <> '') then
		ds_angio_retino_w	:= ds_angio_retino_w || 'ANGIOFLUORESCEINOGRAFIA OD: ' || ds_angiografia_w ||ds_enter_w;
	end if;

	if (ds_oe_angiografia_w IS NOT NULL AND ds_oe_angiografia_w::text <> '') then
		ds_angio_retino_w	:= ds_angio_retino_w || 'ANGIOFLUORESCEINOGRAFIA OE: ' || ds_oe_angiografia_w ||ds_enter_w;
	end if;

	if (ds_retinografia_w IS NOT NULL AND ds_retinografia_w::text <> '') then
		ds_angio_retino_w	:= ds_angio_retino_w || 'RETINOGRAFIA OD : ' || ds_retinografia_w ||ds_enter_w;
	end if;

	if (ds_oe_retinografia_w IS NOT NULL AND ds_oe_retinografia_w::text <> '') then
		ds_angio_retino_w	:= ds_angio_retino_w || 'RETINOGRAFIA OD : ' || ds_oe_retinografia_w ||ds_enter_w;
	end if;

	ds_angio_retino_w := ds_angio_retino_w || ds_enter_w || 'OBSERVAÇÃO: ' || ds_observacao_w ||ds_enter_w;
	ds_angio_retino_w := ds_angio_retino_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C15;

open C16;
loop
	fetch C16 into
		nm_profissional_w,
		ds_profissional_w,
		dt_registro_w;
	EXIT WHEN NOT FOUND; /* apply on C16 */
	begin
	ds_gonioscopia_w	:= 	ds_gonioscopia_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
								'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w ||
								'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
	ds_gonioscopia_w	:=	ds_gonioscopia_w || 'Visualização não disponivel, favor consultar o item no Prontuário.' || ds_enter_w;
	ds_gonioscopia_w 	:= 	ds_gonioscopia_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C16;

open C17;
loop
fetch C17 into
	nm_profissional_w,
	ds_profissional_w,
	dt_registro_w;
EXIT WHEN NOT FOUND; /* apply on C17 */
	begin
	ds_motilidade_ocupar_w	:= 	ds_motilidade_ocupar_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
						'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w||ds_enter_w ||
						'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
	ds_motilidade_ocupar_w	:=	ds_motilidade_ocupar_w || 'Visualização não disponivel, favor consultar o item no Prontuário.' || ds_enter_w;
	ds_motilidade_ocupar_w  :=	ds_motilidade_ocupar_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C17;

open C18;
loop
fetch C18 into
	nm_profissional_w,
	ds_profissional_w,
	dt_registro_w;
EXIT WHEN NOT FOUND; /* apply on C18 */
	begin
	ds_paquimetria_w	:= 	ds_paquimetria_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
						'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w||ds_enter_w ||
						'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
	ds_paquimetria_w	:=	ds_paquimetria_w || 'Visualização não disponivel, favor consultar o item no Prontuário.' || ds_enter_w;
	ds_paquimetria_w  	:=	ds_paquimetria_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C18;

open C19;
loop
	fetch C19 into
		nm_profissional_w,
		ds_profissional_w,
		dt_registro_w,
		ds_exame_exter_od_w,
		ds_exame_exter_oe_w,
		ds_observacao_w;
	EXIT WHEN NOT FOUND; /* apply on C19 */
	begin
	ds_exame_externo_w	:= 	ds_exame_externo_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
								'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w ||ds_enter_w ||
								'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
	if (ds_exame_exter_od_w IS NOT NULL AND ds_exame_exter_od_w::text <> '') then
		ds_exame_externo_w	:= ds_exame_externo_w || 'EXAME EXTERNO OD: ' || ds_exame_exter_od_w ||ds_enter_w;
	end if;

	if (ds_exame_exter_oe_w IS NOT NULL AND ds_exame_exter_oe_w::text <> '') then
		ds_exame_externo_w	:= ds_exame_externo_w || 'EXAME EXTERNO OE: ' || ds_exame_exter_oe_w ||ds_enter_w;
	end if;

	ds_exame_externo_w := ds_exame_externo_w || ds_enter_w || 'OBSERVAÇÃO: ' || ds_observacao_w ||ds_enter_w;
	ds_exame_externo_w := ds_exame_externo_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C19;

open C20;
loop
fetch C20 into
	nm_profissional_w,
	ds_profissional_w,
	dt_registro_w,
	nr_sequencia_item_w;
EXIT WHEN NOT FOUND; /* apply on C20 */
	begin
	ds_orientacao_w	:= 	ds_orientacao_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
								'PROFISSIONAL: ' || nm_profissional_w || ds_enter_w ||ds_enter_w ||
								'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
			select	count(*)
			into STRICT	qt_existe_w
			from	PEP_ORIENTACAO_GERAL
			where	nr_sequencia = nr_sequencia_item_w
			and	(ds_orientacao_geral IS NOT NULL AND ds_orientacao_geral::text <> '');

			if ( qt_existe_w > 0 ) then
				begin
				nr_seq_rtf_srtring_w  := converte_rtf_string('select	ds_orientacao_geral
								from	PEP_ORIENTACAO_GERAL
								where	nr_sequencia = :nr_sequencia_p', nr_sequencia_item_w, nm_usuario_p, nr_seq_rtf_srtring_w );
				select	ds_texto
				into STRICT	ds_geral_w
				from	tasy_conversao_rtf
				where	nr_sequencia = nr_seq_rtf_srtring_w;
				end;
				ds_orientacao_w := ds_orientacao_w || ds_geral_w || ds_enter_w;
			end if;

	ds_orientacao_w := ds_orientacao_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C20;

open C21;
loop
fetch C21 into
	nm_profissional_w,
	ds_profissional_w,
	dt_registro_w,
	nr_sequencia_item_w;
EXIT WHEN NOT FOUND; /* apply on C21 */
	begin
	ds_atestado_w	:= 	ds_atestado_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
								'PROFISSIONAL: ' || nm_profissional_w || ds_enter_w ||ds_enter_w ||
								'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
			select	count(*)
			into STRICT	qt_existe_w
			from	ATESTADO_PACIENTE
			where	nr_sequencia = nr_sequencia_item_w
			and	(DS_ATESTADO IS NOT NULL AND DS_ATESTADO::text <> '');

			if ( qt_existe_w > 0 ) then
				begin
				nr_seq_rtf_srtring_w  := converte_rtf_string('select	DS_ATESTADO
								from	ATESTADO_PACIENTE
								where	nr_sequencia = :nr_sequencia_p', nr_sequencia_item_w, nm_usuario_p, nr_seq_rtf_srtring_w );
				select	ds_texto
				into STRICT	ds_geral_w
				from	tasy_conversao_rtf
				where	nr_sequencia = nr_seq_rtf_srtring_w;
				end;
				ds_atestado_w := ds_atestado_w || ds_geral_w || ds_enter_w;
			end if;

	ds_atestado_w := ds_atestado_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C21;

open C22;
loop
fetch C22 into
	nm_profissional_w,
	ds_profissional_w,
	dt_registro_w,
	nr_sequencia_item_w;
EXIT WHEN NOT FOUND; /* apply on C22 */
	begin
	ds_conduta_w	:= 	ds_conduta_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
								'PROFISSIONAL: ' || nm_profissional_w || ds_enter_w ||ds_enter_w ||
								'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
			select	count(*)
			into STRICT	qt_existe_w
			from	OFT_CONDUTA
			where	nr_sequencia = nr_sequencia_item_w
			and	(DS_CONDUTA IS NOT NULL AND DS_CONDUTA::text <> '');

			if ( qt_existe_w > 0 ) then
				begin
				nr_seq_rtf_srtring_w  := converte_rtf_string('select	DS_CONDUTA
								from	OFT_CONDUTA
								where	nr_sequencia = :nr_sequencia_p', nr_sequencia_item_w, nm_usuario_p, nr_seq_rtf_srtring_w );
				select	ds_texto
				into STRICT	ds_geral_w
				from	tasy_conversao_rtf
				where	nr_sequencia = nr_seq_rtf_srtring_w;
				end;
				ds_conduta_w := ds_conduta_w || ds_geral_w || ds_enter_w;
			end if;

	ds_conduta_w := ds_conduta_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C22;

open C23;
loop
fetch C23 into
	nm_profissional_w,
	ds_profissional_w,
	dt_registro_w,
	nr_sequencia_item_w;
EXIT WHEN NOT FOUND; /* apply on C23 */
	begin
	ds_consentimento_w	:= 	ds_consentimento_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
								'PROFISSIONAL: ' || nm_profissional_w || ds_enter_w ||ds_enter_w ||
								'PROFISSÃO: '  || ds_profissional_w || ds_enter_w || ds_enter_w;
			select	count(*)
			into STRICT	qt_existe_w
			from	PEP_PAC_CI
			where	nr_sequencia = nr_sequencia_item_w
			and	(DS_TEXTO IS NOT NULL AND DS_TEXTO::text <> '');

			if ( qt_existe_w > 0 ) then
				begin
				nr_seq_rtf_srtring_w  := converte_rtf_string('select	DS_TEXTO
								from	PEP_PAC_CI
								where	nr_sequencia = :nr_sequencia_p', nr_sequencia_item_w, nm_usuario_p, nr_seq_rtf_srtring_w );
				select	ds_texto
				into STRICT	ds_geral_w
				from	tasy_conversao_rtf
				where	nr_sequencia = nr_seq_rtf_srtring_w;
				end;
				ds_consentimento_w := ds_consentimento_w || ds_geral_w || ds_enter_w;
			end if;

	ds_consentimento_w := ds_consentimento_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C23;

open C24;
loop
	fetch C24 into
		nm_profissional_w,
		ds_profissional_w,
		dt_registro_w,
		desc_diagnostico_w,
		ds_diagnostico_w,
		ds_observacao_w;
	EXIT WHEN NOT FOUND; /* apply on C24 */
	begin
	ds_diagnosticos_oft_w	:= 	ds_diagnosticos_oft_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
								'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w ||ds_enter_w ||
								'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
	if (desc_diagnostico_w IS NOT NULL AND desc_diagnostico_w::text <> '') then
		ds_diagnosticos_oft_w	:= ds_diagnosticos_oft_w || 'DIAGNÓSTICO: ' || desc_diagnostico_w ||ds_enter_w;
	end if;

	if (ds_diagnostico_w IS NOT NULL AND ds_diagnostico_w::text <> '') then
		ds_diagnosticos_oft_w	:= ds_diagnosticos_oft_w || 'HIPÓTESE: ' || ds_diagnostico_w ||ds_enter_w;
	end if;

	ds_diagnosticos_oft_w := ds_diagnosticos_oft_w || ds_enter_w || 'OBSERVAÇÃO: ' || ds_observacao_w ||ds_enter_w;
	ds_diagnosticos_oft_w := ds_diagnosticos_oft_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C24;

open C25;
loop
	fetch C25 into
		dt_registro_w,
		desc_lente_w,
		ds_lado_w,
		qt_grau_lente_w,
		qt_grau_esferico_w,
		qt_grau_cilindrico_w,
		qt_grau_longe_w,
		qt_eixo_w,
		qt_adicao_w,
		nm_profissional_w,
		ds_profissional_w,
		qt_curva_base_w,
		qt_curva_base_um_w,
		qt_curva_base_dois_w,
		qt_diametro_w;
	EXIT WHEN NOT FOUND; /* apply on C25 */
	begin

	if (ie_tela_nova_lente_w = 'S') then
		ds_lentes_w	:= 	ds_lentes_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
					       'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w ||ds_enter_w ||
					       'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;

		ds_lentes_w	:= ds_lentes_w ||'LENTE : '||desc_lente_w ||ds_enter_w;
		ds_lentes_w	:= ds_lentes_w ||'OLHO  : '||ds_lado_w || ds_enter_w;


		if (qt_curva_base_w IS NOT NULL AND qt_curva_base_w::text <> '') or (qt_curva_base_um_w IS NOT NULL AND qt_curva_base_um_w::text <> '')  or (qt_curva_base_dois_w IS NOT NULL AND qt_curva_base_dois_w::text <> '') then
			ds_lentes_w	:= ds_lentes_w ||lpad('CB: ',18,' ')||to_char(qt_curva_base_w, 'fm999990.00')||ds_espaco_20_w;
			ds_lentes_w	:= ds_lentes_w ||lpad('CB1: ',18,' ')||to_char(qt_curva_base_um_w, 'fm999990.00')||ds_espaco_20_w;
			ds_lentes_w	:= ds_lentes_w ||lpad('CB2:  ',18,' ')||to_char(qt_curva_base_dois_w, 'fm999990.00')||ds_enter_w;
		end if;

		if (qt_grau_esferico_w IS NOT NULL AND qt_grau_esferico_w::text <> '')  or (qt_grau_cilindrico_w IS NOT NULL AND qt_grau_cilindrico_w::text <> '') or (qt_diametro_w IS NOT NULL AND qt_diametro_w::text <> '')	then
			ds_lentes_w	:= ds_lentes_w ||lpad('DIÂMETRO: ',18,' ')||to_char(qt_diametro_w, 'fm999990.00')||ds_espaco_20_w;
			ds_lentes_w	:= ds_lentes_w ||lpad('GRAU ESFÉRICO: ',18,' ')||oft_obter_valor_com_sinal(qt_grau_esferico_w)||ds_espaco_20_w;
			ds_lentes_w	:= ds_lentes_w ||lpad('GRAU CILÍNDRICO:  ',18,' ')||to_char(qt_grau_cilindrico_w, 'fm999990.00')||ds_enter_w;
		end if;

		if (qt_eixo_w IS NOT NULL AND qt_eixo_w::text <> '') or (qt_adicao_w IS NOT NULL AND qt_adicao_w::text <> '') then
			ds_lentes_w	:= ds_lentes_w ||lpad('EIXO: ',18,' ')||(qt_eixo_w);
			ds_lentes_w	:= ds_lentes_w ||lpad('ADIÇÃO: ',18,' ')||oft_obter_valor_com_sinal(qt_adicao_w) ||ds_enter_w;
		end if;

		ds_lentes_w := ds_lentes_w || ds_quebra_w || ds_enter_w;

	elsif (ie_tela_nova_lente_w = 'N') then
		ds_lentes_w	:= 	ds_lentes_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
					       'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w ||ds_enter_w ||
					       'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;

		ds_lentes_w	:= ds_lentes_w ||'LENTE : '||desc_lente_w ||ds_enter_w;
		ds_lentes_w	:= ds_lentes_w ||'OLHO  : '||ds_lado_w || ds_enter_w;

		if (qt_grau_lente_w IS NOT NULL AND qt_grau_lente_w::text <> '') or (qt_grau_esferico_w IS NOT NULL AND qt_grau_esferico_w::text <> '')  or (qt_grau_cilindrico_w IS NOT NULL AND qt_grau_cilindrico_w::text <> '') then
			ds_lentes_w	:= ds_lentes_w ||lpad('GRAU: ',18,' ')||qt_grau_lente_w||ds_espaco_20_w;
			ds_lentes_w	:= ds_lentes_w ||lpad('GRAU ESFÉRICO: ',18,' ')||qt_grau_esferico_w||ds_espaco_20_w;
			ds_lentes_w	:= ds_lentes_w ||lpad('GRAU CILÍNDRICO:  ',18,' ')||qt_grau_cilindrico_w||ds_enter_w;
		end if;

		if (qt_grau_longe_w IS NOT NULL AND qt_grau_longe_w::text <> '') or (qt_eixo_w IS NOT NULL AND qt_eixo_w::text <> '') or (qt_adicao_w IS NOT NULL AND qt_adicao_w::text <> '') 	 then
			ds_lentes_w	:= ds_lentes_w ||lpad('GRAU LONGE: ',18,' ')||qt_grau_longe_w;
			ds_lentes_w	:= ds_lentes_w ||lpad('EIXO: ',18,' ')||qt_eixo_w;
			ds_lentes_w	:= ds_lentes_w ||lpad('ADIÇÃO: ',18,' ')||qt_adicao_w ||ds_enter_w;
		end if;

		ds_lentes_w := ds_lentes_w || ds_quebra_w || ds_enter_w;
	end if;
	end;
end loop;
close C25;

open C26;
loop
	fetch C26 into
		nm_profissional_w,
		ds_profissional_w,
		dt_registro_w,
		ds_tipo_lente_w,
		vl_od_pl_dio_esf_w,
		vl_od_pl_dio_cil_w,
		vl_od_pl_eixo_w,
		vl_od_pl_adicao_w,
		vl_oe_pl_dio_esf_w,
		vl_oe_pl_dio_cil_w,
		vl_oe_pl_eixo_w,
		vl_oe_pl_adicao_w,
		vl_od_pp_dio_esf_w,
		vl_od_pp_dio_cil_w,
		vl_od_pp_eixo_w,
		vl_od_pp_adicao_w,
		vl_oe_pp_dio_esf_w,
		vl_oe_pp_dio_cil_w,
		vl_oe_pp_eixo_w,
		vl_oe_pp_adicao_w,
		vl_od_in_dio_esf_w,
		vl_od_in_dio_cil_w,
		vl_od_in_eixo_w,
		vl_od_in_adicao_w,
		vl_oe_in_dio_esf_w,
		vl_oe_in_dio_cil_w,
		vl_oe_in_eixo_w,
		vl_oe_in_adicao_w,
		ds_observacao_w;
	EXIT WHEN NOT FOUND; /* apply on C26 */
	begin
	ds_oculos_w	:= 	ds_oculos_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
								'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w ||ds_enter_w ||
								'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
	ds_oculos_w	:= ds_oculos_w ||'TIPO DE LENTE : '||ds_tipo_lente_w ||ds_enter_w;


	if (vl_od_pl_dio_esf_w IS NOT NULL AND vl_od_pl_dio_esf_w::text <> '') or (vl_od_pl_dio_cil_w IS NOT NULL AND vl_od_pl_dio_cil_w::text <> '') or (vl_od_pl_eixo_w IS NOT NULL AND vl_od_pl_eixo_w::text <> '') 	 or (vl_od_pl_adicao_w IS NOT NULL AND vl_od_pl_adicao_w::text <> '') then
		ds_oculos_w	:= ds_oculos_w || 'PARA LONGE' || ds_enter_w;
		ds_oculos_w	:= ds_oculos_w ||lpad('OD DE: ',15,' ')||vl_od_pl_dio_esf_w;
		ds_oculos_w	:= ds_oculos_w ||lpad('DC: ',15,' ')||vl_od_pl_dio_cil_w;
		ds_oculos_w	:= ds_oculos_w ||lpad('EIXO: ',15,' ')||vl_od_pl_eixo_w;
		ds_oculos_w	:= ds_oculos_w ||lpad('ADIÇÃO: ',15,' ')||vl_od_pl_adicao_w ||ds_enter_w;
	end if;

	if (vl_oe_pl_dio_esf_w IS NOT NULL AND vl_oe_pl_dio_esf_w::text <> '') or (vl_oe_pl_dio_cil_w IS NOT NULL AND vl_oe_pl_dio_cil_w::text <> '') or (vl_oe_pl_eixo_w IS NOT NULL AND vl_oe_pl_eixo_w::text <> '') 	 or (vl_oe_pl_adicao_w IS NOT NULL AND vl_oe_pl_adicao_w::text <> '') then
		ds_oculos_w	:= ds_oculos_w ||lpad('OE DE: ',15,' ')||vl_oe_pl_dio_esf_w;
		ds_oculos_w	:= ds_oculos_w ||lpad('DC: ',15,' ')||vl_oe_pl_dio_cil_w;
		ds_oculos_w	:= ds_oculos_w ||lpad('EIXO: ',15,' ')||vl_oe_pl_eixo_w;
		ds_oculos_w	:= ds_oculos_w ||lpad('ADIÇÃO: ',15,' ')||vl_oe_pl_adicao_w ||ds_enter_w;
	end if;

	if (vl_od_pp_dio_esf_w IS NOT NULL AND vl_od_pp_dio_esf_w::text <> '') or (vl_od_pp_dio_cil_w IS NOT NULL AND vl_od_pp_dio_cil_w::text <> '') or (vl_od_pp_eixo_w IS NOT NULL AND vl_od_pp_eixo_w::text <> '') or (vl_od_pp_adicao_w IS NOT NULL AND vl_od_pp_adicao_w::text <> '') then
		ds_oculos_w	:= ds_oculos_w || ds_enter_w || 'PARA PERTO' || ds_enter_w;
		ds_oculos_w	:= ds_oculos_w ||lpad('OD DE: ',15,' ')||vl_od_pp_dio_esf_w;
		ds_oculos_w	:= ds_oculos_w ||lpad('DC: ',15,' ')||vl_od_pp_dio_cil_w;
		ds_oculos_w	:= ds_oculos_w ||lpad('EIXO: ',15,' ')||vl_od_pp_eixo_w;
		ds_oculos_w	:= ds_oculos_w ||lpad('ADIÇÃO: ',15,' ')||vl_od_pp_adicao_w ||ds_enter_w;
	end if;

	if (vl_oe_pp_dio_esf_w IS NOT NULL AND vl_oe_pp_dio_esf_w::text <> '') or (vl_oe_pp_dio_cil_w IS NOT NULL AND vl_oe_pp_dio_cil_w::text <> '') or (vl_oe_pp_eixo_w IS NOT NULL AND vl_oe_pp_eixo_w::text <> '') or (vl_oe_pp_adicao_w IS NOT NULL AND vl_oe_pp_adicao_w::text <> '') then
		ds_oculos_w	:= ds_oculos_w ||lpad('OE DE: ',15,' ')||vl_oe_pp_dio_esf_w;
		ds_oculos_w	:= ds_oculos_w ||lpad('DC: ',15,' ')||vl_oe_pp_dio_cil_w;
		ds_oculos_w	:= ds_oculos_w ||lpad('EIXO: ',15,' ')||vl_oe_pp_eixo_w;
		ds_oculos_w	:= ds_oculos_w ||lpad('ADIÇÃO: ',15,' ')||vl_oe_pp_adicao_w ||ds_enter_w;
	end if;

	if (vl_od_in_dio_esf_w IS NOT NULL AND vl_od_in_dio_esf_w::text <> '') or (vl_od_in_dio_cil_w IS NOT NULL AND vl_od_in_dio_cil_w::text <> '') or (vl_od_in_eixo_w IS NOT NULL AND vl_od_in_eixo_w::text <> '') or (vl_od_in_adicao_w IS NOT NULL AND vl_od_in_adicao_w::text <> '') then
		ds_oculos_w	:= ds_oculos_w || ds_enter_w || 'INTERMEDIÁRIO' || ds_enter_w;
		ds_oculos_w	:= ds_oculos_w ||lpad('OD DE: ',15,' ')||vl_od_in_dio_esf_w;
		ds_oculos_w	:= ds_oculos_w ||lpad('DC: ',15,' ')||vl_od_in_dio_cil_w;
		ds_oculos_w	:= ds_oculos_w ||lpad('EIXO: ',15,' ')||vl_od_in_eixo_w;
		ds_oculos_w	:= ds_oculos_w ||lpad('ADIÇÃO: ',15,' ')||vl_od_in_adicao_w ||ds_enter_w;
	end if;

	if (vl_oe_in_dio_esf_w IS NOT NULL AND vl_oe_in_dio_esf_w::text <> '') or (vl_oe_in_dio_cil_w IS NOT NULL AND vl_oe_in_dio_cil_w::text <> '') or (vl_oe_in_eixo_w IS NOT NULL AND vl_oe_in_eixo_w::text <> '') or (vl_oe_in_adicao_w IS NOT NULL AND vl_oe_in_adicao_w::text <> '') then
		ds_oculos_w	:= ds_oculos_w ||lpad('OE DE: ',15,' ')||vl_oe_in_dio_esf_w;
		ds_oculos_w	:= ds_oculos_w ||lpad('DC: ',15,' ')||vl_oe_in_dio_cil_w;
		ds_oculos_w	:= ds_oculos_w ||lpad('EIXO: ',15,' ')||vl_oe_in_eixo_w;
		ds_oculos_w	:= ds_oculos_w ||lpad('ADIÇÃO: ',15,' ')||vl_oe_in_adicao_w ||ds_enter_w;
	end if;

	ds_oculos_w := ds_oculos_w || ds_enter_w || 'OBSERVAÇÃO: ' || ds_observacao_w ||ds_enter_w;
	ds_oculos_w := ds_oculos_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C26;

open C27;
loop
	fetch C27 into
		dt_prescricao_w,
		nr_prescricao_w,
		nm_profissional_w,
		ds_profissional_w,
		ds_itens_prescr_w;
	EXIT WHEN NOT FOUND; /* apply on C27 */
	begin
	ds_prescricao_w		:= 	ds_prescricao_w	 || 'DATA: ' || dt_prescricao_w || ds_espaco_20_w ||
								'PRESCRIÇÃO: '||nr_prescricao_w||ds_espaco_20_w ||
								'PROFISSIONAL: ' ||nm_profissional_w ||ds_espaco_20_w ||
								'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w ||
								'ITENS PRESCRIÇÃO: ' || ds_itens_prescr_w || ds_enter_w;
	ds_prescricao_w	 := ds_prescricao_w	 || ds_quebra_w;
	end;
end loop;
close C27;

open C28;
loop
fetch C28 into
	dt_registro_w,
	nm_profissional_w,
	ds_profissional_w,
	nr_sequencia_item_w;
EXIT WHEN NOT FOUND; /* apply on C28 */
	begin
	ds_receita_w	:= 	ds_receita_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
								'PROFISSIONAL: ' || nm_profissional_w || ds_enter_w ||ds_enter_w ||
								'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
			select	count(*)
			into STRICT	qt_existe_w
			from	med_receita
			where	nr_sequencia = nr_sequencia_item_w
			and	(ds_receita IS NOT NULL AND ds_receita::text <> '');

			if ( qt_existe_w > 0 ) then
				begin
				nr_seq_rtf_srtring_w  := converte_rtf_string('select	ds_receita
								from	med_receita
								where	nr_sequencia = :nr_sequencia_p', nr_sequencia_item_w, nm_usuario_p, nr_seq_rtf_srtring_w );
				select	ds_texto
				into STRICT	ds_geral_w
				from	tasy_conversao_rtf
				where	nr_sequencia = nr_seq_rtf_srtring_w;
				end;
				ds_receita_w := ds_receita_w || ds_geral_w || ds_enter_w;
			end if;

	ds_receita_w := ds_receita_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C28;

open C29;
loop
fetch C29 into
	nm_profissional_w,
	ds_profissional_w,
	dt_registro_w;
EXIT WHEN NOT FOUND; /* apply on C29 */
	begin
	ds_paquimetria_ultra_w	:= 	ds_paquimetria_ultra_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
						'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w||ds_enter_w ||
						'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
	ds_paquimetria_ultra_w	:=	ds_paquimetria_ultra_w || 'Visualização não disponivel, favor consultar o item no Prontuário.' || ds_enter_w;
	ds_paquimetria_ultra_w  	:=	ds_paquimetria_ultra_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C29;

open C30;
loop
	fetch C30 into
		dt_registro_w,
		nm_profissional_w,
		ds_profissional_w,
		vl_potencial_od_w,
		vl_potencial_oe_w,
		ds_observacao_w;
	EXIT WHEN NOT FOUND; /* apply on C30 */
	begin
	ds_potencial_acuidade_visual_w	:= 	ds_potencial_acuidade_visual_w || 'DATA: ' || dt_registro_w || ds_espaco_20_w ||
								'PROFISSIONAL: ' ||nm_profissional_w || ds_enter_w ||ds_enter_w ||
								'PROFISSÃO: ' || ds_profissional_w || ds_enter_w || ds_enter_w;
	if (vl_potencial_od_w IS NOT NULL AND vl_potencial_od_w::text <> '') or (vl_potencial_oe_w IS NOT NULL AND vl_potencial_oe_w::text <> '') then
		ds_potencial_acuidade_visual_w	:= ds_potencial_acuidade_visual_w ||lpad('Potencial OD: ',15,' ')||vl_potencial_od_w ||ds_espaco_20_w;
		ds_potencial_acuidade_visual_w	:= ds_potencial_acuidade_visual_w ||lpad('Potencial OE: ',15,' ')||vl_potencial_oe_w ||ds_enter_w;
	end if;


	ds_potencial_acuidade_visual_w := ds_potencial_acuidade_visual_w || ds_enter_w || 'OBSERVAÇÃO: ' || ds_observacao_w ||ds_enter_w;
	ds_potencial_acuidade_visual_w := ds_potencial_acuidade_visual_w || ds_quebra_w || ds_enter_w;
	end;
end loop;
close C30;

if (ds_acuidade_visual_w IS NOT NULL AND ds_acuidade_visual_w::text <> '') then
	SELECT   UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 20;
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_acuidade_visual_w ||ds_enter_w,1,32000);
	ds_acuidade_visual_w := null;
end if;

if (ds_ger_anamnese_w IS NOT NULL AND ds_ger_anamnese_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 2;

	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_ger_anamnese_w ||ds_enter_w,1,32000);
	ds_ger_anamnese_w := null;
end if;

if (ds_angio_retino_w IS NOT NULL AND ds_angio_retino_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 71;
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_angio_retino_w ||ds_enter_w,1,32000);
	ds_angio_retino_w := null;
end if;

if (ds_atestado_w IS NOT NULL AND ds_atestado_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 28;
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_atestado_w ||ds_enter_w,1,32000);
	ds_atestado_w := null;
end if;

if (ds_auto_refracao_w IS NOT NULL AND ds_auto_refracao_w::text <> '') then
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || 'AUTO-REFRAÇÃO' ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_auto_refracao_w ||ds_enter_w,1,32000);
	ds_auto_refracao_w 	:= null;
end if;

if (ds_refracao_w IS NOT NULL AND ds_refracao_w::text <> '') then
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || 'REFRAÇÃO' ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_refracao_w ||ds_enter_w,1,32000);
	ds_refracao_w	:= null;
end if;

if (ds_biometria_w IS NOT NULL AND ds_biometria_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 78;
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_biometria_w ||ds_enter_w,1,32000);
	ds_biometria_w	:= null;
end if;

if (biomicroscopia_w IS NOT NULL AND biomicroscopia_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 10;
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || biomicroscopia_w ||ds_enter_w,1,32000);
	biomicroscopia_w 	:= null;
end if;

if (ds_ceratometria_w IS NOT NULL AND ds_ceratometria_w::text <> '') then
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || 'CERATOMETRIA' ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_ceratometria_w ||ds_enter_w,1,32000);
	ds_ceratometria_w	:= null;
end if;

if (ds_conduta_w IS NOT NULL AND ds_conduta_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 24;
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_conduta_w ||ds_enter_w,1,32000);
	ds_conduta_w := null;
end if;

if (ds_consentimento_w IS NOT NULL AND ds_consentimento_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 21;
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_consentimento_w ||ds_enter_w,1,32000);
	ds_consentimento_w := null;
end if;

if (ds_correcao_optica_w IS NOT NULL AND ds_correcao_optica_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 19;

	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_correcao_optica_w ||ds_enter_w,1,32000);
	ds_correcao_optica_w := null;
end if;

if (ds_curva_tensional_w IS NOT NULL AND ds_curva_tensional_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 69;
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_curva_tensional_w ||ds_enter_w,1,32000);
	ds_curva_tensional_w	:= null;
end if;

if (ds_diagnosticos_oft_w IS NOT NULL AND ds_diagnosticos_oft_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 12;
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_diagnosticos_oft_w ||ds_enter_w,1,32000);
	ds_diagnosticos_oft_w := null;
end if;

if (ds_dnp_w IS NOT NULL AND ds_dnp_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 17;
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_dnp_w ||ds_enter_w,1,32000);
	ds_dnp_w 	:= null;
end if;

if (ds_exame_externo_w IS NOT NULL AND ds_exame_externo_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 6;
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_exame_externo_w ||ds_enter_w,1,32000);
	ds_exame_externo_w := null;
end if;

if (ds_fundoscopia_w IS NOT NULL AND ds_fundoscopia_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 9;
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_fundoscopia_w ||ds_enter_w,1,32000);
	ds_fundoscopia_w := null;
end if;

if (ds_gonioscopia_w IS NOT NULL AND ds_gonioscopia_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 73;
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_gonioscopia_w ||ds_enter_w,1,32000);
	ds_gonioscopia_w := null;
end if;

if (ds_lentes_w IS NOT NULL AND ds_lentes_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 14;
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_lentes_w ||ds_enter_w,1,32000);
	ds_lentes_w := null;
end if;

if (ds_microscopia_w IS NOT NULL AND ds_microscopia_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 80;
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_microscopia_w ||ds_enter_w,1,32000);
	ds_microscopia_w := null;
end if;

if (ds_motilidade_ocupar_w IS NOT NULL AND ds_motilidade_ocupar_w::text <> '') then
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w ||  'MOTILIDADE OCULAR' ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_motilidade_ocupar_w ||ds_enter_w,1,32000);
	ds_motilidade_ocupar_w := null;
end if;

if (ds_oculos_w IS NOT NULL AND ds_oculos_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 13;
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_oculos_w ||ds_enter_w,1,32000);
	ds_oculos_w := null;
end if;

if (ds_orientacao_w IS NOT NULL AND ds_orientacao_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 160;
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_orientacao_w ||ds_enter_w,1,32000);
	ds_orientacao_w := null;
end if;

if (ds_paquimetria_w IS NOT NULL AND ds_paquimetria_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 84;
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_paquimetria_w ||ds_enter_w,1,32000);
	ds_paquimetria_w := null;
end if;

if (ds_prescricao_w IS NOT NULL AND ds_prescricao_w::text <> '') then
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || 'PRESCRIÇÃO' ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_prescricao_w ||ds_enter_w,1,32000);
	ds_prescricao_w := null;
end if;

if (ds_pupilometria_w IS NOT NULL AND ds_pupilometria_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 82;
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_pupilometria_w ||ds_enter_w,1,32000);
	ds_pupilometria_w := null;
end if;

if (ds_receita_w IS NOT NULL AND ds_receita_w::text <> '') then
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || 'RECEITA' ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_receita_w ||ds_enter_w,1,32000);
	ds_receita_w := null;
end if;


if (ds_tonometria_w IS NOT NULL AND ds_tonometria_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 23;


	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_tonometria_w ||ds_enter_w,1,32000);
	ds_tonometria_w := null;
end if;

if (ds_tonometria_2_w IS NOT NULL AND ds_tonometria_2_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 8;


	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_tonometria_2_w ||ds_enter_w,1,32000);
	ds_tonometria_2_w := null;
end if;

if (ds_paquimetria_ultra_w IS NOT NULL AND ds_paquimetria_ultra_w::text <> '') then
	SELECT   max(UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item)))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 84;
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || 'PAQUIMETRIA ULTRASSôNICA' ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_paquimetria_ultra_w ||ds_enter_w,1,32000);
	ds_paquimetria_ultra_w := null;
end if;

if (ds_potencial_acuidade_visual_w IS NOT NULL AND ds_potencial_acuidade_visual_w::text <> '') then
	SELECT   UPPER(coalesce(B.DS_INSTITUICAO,obter_desc_expressao(a.cd_exp_desc_item,a.ds_item))) ds_item
	into STRICT	 ds_instituicao_w
	FROM     perfil_item_oftalmologia b,
		 oftalmologia_item a
	WHERE    a.nr_sequencia  = b.nr_seq_item
	AND      b.cd_perfil     = cd_perfil_w
	AND      a.nr_sequencia  = 236;
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_espaco_w || ds_instituicao_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_sublinhado_w ||ds_enter_w,1,32000);
	ds_resumo_w := substr(ds_resumo_w || ds_potencial_acuidade_visual_w ||ds_enter_w,1,32000);
	ds_potencial_acuidade_visual_w := null;
end if;

update 	oft_consulta
set 	ds_resumo = ds_resumo_w
where	nr_sequencia = nr_seq_consulta_p;
/*
insert into w_oft_resumo_consulta(
		nr_sequencia,
		nr_atendimento,
		dt_atendimento,
		cd_pessoa_fisica,
		nm_usuario,
		ds_resumo)
	values (
		w_oft_resumo_consulta_Seq.nextval,
		66,
		sysdate,
		cd_pessoa_fisica_p,
		nm_usuario_p,
		ds_resumo_w);
*/
	commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_resumo_funcao_oftalmo ( cd_estabelecimento_p bigint, nr_seq_consulta_p bigint, cd_pessoa_fisica_p text, nm_usuario_p text, ie_mostra_todos_p text) FROM PUBLIC;

