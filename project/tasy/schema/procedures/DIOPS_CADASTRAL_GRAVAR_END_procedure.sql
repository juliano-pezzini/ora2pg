-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE diops_cadastral_gravar_end ( nr_seq_operadora_p bigint, nr_seq_periodo_p bigint, cd_pessoa_fisica_p text, cd_cgc_p text, ie_tipo_endereco_p text, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
Finalidade: Gerar as informações cadastrais de endereço do DIOPS 
------------------------------------------------------------------------------------------------------------------- 
Locais de chamada direta: 
[ X ] Objetos do dicionário [ ] Tasy (Delphi/Java) [ ] Portal [ ] Relatórios [ ] Outros: 
 ------------------------------------------------------------------------------------------------------------------ 
Pontos de atenção: 
	ie_tipo_endereco_p 
		M - Matriz 
		C - Correspondência 
		R - Representante 
		RN - Representante RN117 
		E - Empresa dependente 
------------------------------------------------------------------------------------------------------------------- 
Referências: 
	DIOPS_CADASTRAL_GERAR_ENDERECO 
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
 
	 
ds_endereco_w			varchar(100);
ds_bairro_w			varchar(80);
ds_complemento_w			varchar(20);
cd_cep_w			varchar(15);
nr_endereco_w			varchar(10);
cd_municipio_ibge_w		varchar(6);
sg_estado_w			compl_pessoa_fisica.sg_estado%type;


BEGIN 
if (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') then 
	begin 
	select	ds_endereco, 
		nr_endereco, 
		ds_complemento, 
		ds_bairro, 
		cd_municipio_ibge, 
		sg_estado, 
		cd_cep 
	into STRICT	ds_endereco_w, 
		nr_endereco_w, 
		ds_complemento_w, 
		ds_bairro_w, 
		cd_municipio_ibge_w, 
		sg_estado_w, 
		cd_cep_w 
	from	compl_pessoa_fisica 
	where	cd_pessoa_fisica	= cd_pessoa_fisica_p 
	and	ie_tipo_complemento	= 1;
	exception 
	when others then 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(243220, 'CD_PESSOA=' || cd_pessoa_fisica_p);
	end;
elsif (cd_cgc_p IS NOT NULL AND cd_cgc_p::text <> '') then 
	if (ie_tipo_endereco_p in ('M','E')) then 
		/* Obter dados da pessoa jurídica */
 
		select	ds_endereco, 
			nr_endereco, 
			ds_complemento, 
			ds_bairro, 
			cd_municipio_ibge, 
			sg_estado, 
			cd_cep 
		into STRICT	ds_endereco_w, 
			nr_endereco_w, 
			ds_complemento_w, 
			ds_bairro_w, 
			cd_municipio_ibge_w, 
			sg_estado_w, 
			cd_cep_w 
		from	pessoa_juridica 
		where	cd_cgc	= cd_cgc_p;
	elsif (ie_tipo_endereco_p = 'C') then 
		/* Obter dados do complemento da pessoa juridica */
 
		begin 
		select	ds_endereco, 
			nr_endereco, 
			ds_complemento, 
			ds_bairro, 
			cd_municipio_ibge, 
			sg_estado, 
			cd_cep 
		into STRICT	ds_endereco_w, 
			nr_endereco_w, 
			ds_complemento_w, 
			ds_bairro_w, 
			cd_municipio_ibge_w, 
			sg_estado_w, 
			cd_cep_w 
		from	pessoa_juridica_compl 
		where	cd_cgc 			= cd_cgc_p 
		and	ie_tipo_complemento	= 1;
		exception 
		when others then 
			ds_endereco_w		:= '';
			nr_endereco_w		:= '';
			ds_complemento_w	:= '';
			ds_bairro_w		:= '';
			cd_municipio_ibge_w	:= '';
			sg_estado_w		:= '';
			cd_cep_w		:= '';
		end;
	end if;
end if;
 
insert into w_diops_cad_endereco(nr_sequencia, 
	nr_seq_operadora, 
	ie_tipo_endereco, 
	ds_logradouro, 
	nr_logradouro, 
	ds_complemento, 
	ds_bairro, 
	cd_municipio_ibge, 
	sg_uf, 
	cd_cep, 
	dt_atualizacao, 
	nm_usuario, 
	cd_estabelecimento, 
	cd_cgc, 
	cd_pessoa_fisica, 
	nr_seq_periodo) 
values (nextval('w_diops_cad_endereco_seq'), 
	nr_seq_operadora_p, 
	ie_tipo_endereco_p, 
	ds_endereco_w, 
	nr_endereco_w, 
	ds_complemento_w, 
	substr(ds_bairro_w,1,40), 
	cd_municipio_ibge_w, 
	sg_estado_w, 
	cd_cep_w, 
	clock_timestamp(), 
	nm_usuario_p, 
	cd_estabelecimento_p, 
	cd_cgc_p, 
	cd_pessoa_fisica_p, 
	nr_seq_periodo_p);
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE diops_cadastral_gravar_end ( nr_seq_operadora_p bigint, nr_seq_periodo_p bigint, cd_pessoa_fisica_p text, cd_cgc_p text, ie_tipo_endereco_p text, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

