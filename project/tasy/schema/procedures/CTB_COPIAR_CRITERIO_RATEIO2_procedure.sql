-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ctb_copiar_criterio_rateio2 ( nr_sequencia_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint, ie_commit text default null) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
-------------------------------------------------------------------------------------------------------------------

Locais de chamada direta: 
[  ]  Objetos do dicionário [  ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------

Pontos de atenção:
-------------------------------------------------------------------------------------------------------------------

Referências:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
nr_sequencia_w			bigint;


BEGIN
select	nextval('ctb_criterio_rateio_seq')
into STRICT	nr_sequencia_w
;

insert into ctb_criterio_rateio(nr_sequencia,
	ds_criterio,
	dt_atualizacao,
	nm_usuario,
	dt_atualizacao_nrec,
	nm_usuario_nrec,
	cd_estabelecimento,
	ie_situacao,
	ie_nota_fiscal,
	ie_solic_compra)
SELECT	nr_sequencia_w,
	substr(wheb_mensagem_pck.get_texto(298835) || ds_criterio,1,255),
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	cd_estabelecimento_p,
	'A',
	ie_nota_fiscal,
        coalesce(ie_solic_compra,'N')
from	ctb_criterio_rateio
where	nr_sequencia	= nr_sequencia_p;

insert into ctb_criterio_rateio_item(nr_sequencia,
	nr_seq_criterio,
	dt_atualizacao,
	nm_usuario,
	cd_centro_custo,
	cd_conta_contabil, 
	cd_conta_financ,
	pr_rateio,
	dt_atualizacao_nrec, 
	nm_usuario_nrec,
	dt_inicio_vigencia,
	dt_fim_vigencia)
SELECT	nextval('ctb_criterio_rateio_item_seq'),
	nr_sequencia_w,
	clock_timestamp(), 
	nm_usuario_p,
	cd_centro_custo,
	cd_conta_contabil, 
	cd_conta_financ,
	pr_rateio,
	clock_timestamp(), 
	nm_usuario_p,
	dt_inicio_vigencia,
	dt_fim_vigencia
from	ctb_criterio_rateio_item
where	nr_seq_criterio	= nr_sequencia_p;


if coalesce(ie_commit::text, '') = '' then
	commit;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ctb_copiar_criterio_rateio2 ( nr_sequencia_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint, ie_commit text default null) FROM PUBLIC;

