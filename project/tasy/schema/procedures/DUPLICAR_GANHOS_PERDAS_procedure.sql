-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_ganhos_perdas ( nr_sequencia_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_sequencia_w		bigint;
nr_seq_atend_pg_inf_w	bigint;
nr_seq_inf_adic_w	bigint;
nr_seq_inf_adic_item_w	bigint;
cd_pessoa_duplica_w usuario.cd_pessoa_fisica%type;

c01 CURSOR FOR
	SELECT 	nextval('atend_perda_ganho_inf_adic_seq'),
		NR_SEQ_INF_ADIC,
		NR_SEQ_INF_ADIC_ITEM
	from ATEND_PERDA_GANHO_INF_ADIC
	where nr_seq_atend_pg = nr_sequencia_p;


BEGIN

select	nextval('atendimento_perda_ganho_seq')
into STRICT	nr_sequencia_w
;

select max(cd_pessoa_fisica)
into STRICT cd_pessoa_duplica_w
from usuario where upper(nm_usuario) = upper(nm_usuario_p);

insert into ATENDIMENTO_PERDA_GANHO(
	NR_SEQUENCIA,
	NR_ATENDIMENTO,
	DT_ATUALIZACAO,
	NM_USUARIO,
	NR_SEQ_TIPO,
	QT_VOLUME,
	DS_OBSERVACAO,
	DT_MEDIDA,
	CD_TURNO,
	CD_SETOR_ATENDIMENTO,
	NR_CIRURGIA,
	IE_ORIGEM,
	DT_REFERENCIA,
	CD_PROFISSIONAL,
	NR_HORA,
	IE_SITUACAO,
	DT_APAP,
	QT_OCORRENCIA,
	NR_SEQ_EVENTO_ADEP,
	NR_SEQ_PEPO,
	CD_PERFIL_ATIVO,
	IE_RECEM_NATO,
	QT_PESO,
	NR_SEQ_EVENTO_IVC,
	NR_SEQ_TOPOGRAFIA,
	IE_LADO,
	NR_SEQ_ASPECTO,
	IE_INTENSIDADE,
	NR_SEQ_HORARIO,
	DS_UTC,
	IE_HORARIO_VERAO,
	DS_UTC_ATUALIZACAO)
SELECT  nr_sequencia_w,
	NR_ATENDIMENTO,
	clock_timestamp(),
	nm_usuario_p,
	NR_SEQ_TIPO,
	QT_VOLUME,
	DS_OBSERVACAO,
	clock_timestamp(),
	CD_TURNO,
	CD_SETOR_ATENDIMENTO,
	NR_CIRURGIA,
	IE_ORIGEM,
	DT_REFERENCIA,
	cd_pessoa_duplica_w,
	(to_char(round(clock_timestamp(),'hh24'),'hh24'))::numeric ,
	'A',
	DT_APAP,
	QT_OCORRENCIA,
	NR_SEQ_EVENTO_ADEP,
	NR_SEQ_PEPO,
	CD_PERFIL_ATIVO,
	IE_RECEM_NATO,
	QT_PESO,
	NR_SEQ_EVENTO_IVC,
	NR_SEQ_TOPOGRAFIA,
	IE_LADO,
	NR_SEQ_ASPECTO,
	IE_INTENSIDADE,
	NR_SEQ_HORARIO,
	DS_UTC,
	IE_HORARIO_VERAO,
	DS_UTC_ATUALIZACAO
	from ATENDIMENTO_PERDA_GANHO 
	where nr_sequencia = nr_sequencia_p;
	commit;
	
OPEN c01;
LOOP
FETCH c01 INTO
	nr_seq_atend_pg_inf_w,
	nr_seq_inf_adic_w,
	nr_seq_inf_adic_item_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
BEGIN
	insert into ATEND_PERDA_GANHO_INF_ADIC(
		NR_SEQUENCIA,
		DT_ATUALIZACAO,
		NM_USUARIO,
		DT_ATUALIZACAO_NREC,
		NM_USUARIO_NREC,
		NR_SEQ_ATEND_PG,
		NR_SEQ_INF_ADIC,
		NR_SEQ_INF_ADIC_ITEM
	) values (
		nr_seq_atend_pg_inf_w,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		nr_sequencia_w,
		nr_seq_inf_adic_w,
		nr_seq_inf_adic_item_w
	);
END;
END LOOP;
CLOSE c01;

commit;			

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_ganhos_perdas ( nr_sequencia_p bigint, nm_usuario_p text) FROM PUBLIC;

