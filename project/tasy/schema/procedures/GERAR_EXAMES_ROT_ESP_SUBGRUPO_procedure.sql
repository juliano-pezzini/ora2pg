-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_exames_rot_esp_subgrupo ( nm_usuario_p text, cd_perfil_p bigint, cd_medico_p text, cd_setor_atendimento_p bigint, cd_estabelecimento_p bigint, ie_consiste_convenio_p text, cd_classif_setor_pac_p bigint, ie_clinica_p bigint, cd_setor_prescr_p bigint, ie_tipo_atendimento_p bigint, cd_convenio_p bigint, ie_sem_grupo_p text, ie_so_convenio_p text, cd_categoria_p bigint, ie_origem_proced_p bigint, ie_tipo_convenio_p bigint, varie_tipo_p text, ie_maiuscula_p text, ie_pasta_p bigint, ie_restringe_estab_p text, qt_reg_coluna_p bigint, ie_todos_p text, ie_ordem_seq_p text, ie_tabela_interna_p text, ie_tipo_p text ) AS $body$
DECLARE



c01 REFCURSOR;
c02 REFCURSOR;
c03 REFCURSOR;

nr_seq_grupo_w					bigint;
nr_seq_subgrupo_w				bigint;
ie_tipo_apresent_grupo_w		varchar(1);
ds_subgrupo_w					varchar(255);
nr_seq_apresentacao_subgrupo_w	bigint;
ie_tipo_apresent_subgrupo_w		varchar(1);
ds_grupo_w						varchar(255);
nr_seq_apresentacao_w			bigint;
nr_sequencia_w					bigint;
nr_seq_subgrupo_ww				bigint := 1;
qt_registro_w					bigint := 0;
nr_seq_coluna_w					bigint := 1;
ie_tipo_w						bigint;
nr_seq_ordem_w 					bigint;
ie_exige_justificativa_w		varchar(1);
nr_sequencia_ww					bigint;
nr_seq_proc_rotina_w			bigint;
ds_prescricao_w 				varchar(255);
cd_grupo_proc_w 				bigint;
ie_rotina_uti_w 				varchar(1);
ie_exige_lado_w 				varchar(1);
ie_ctrl_glic_w 					varchar(3);
ie_topografia_w 				varchar(1);
cd_especialidade_w 				bigint;
nr_seq_apres_w 					integer;
ds_cor_w 						varchar(15);
ds_cor_grupo_w 					varchar(15);
cd_intervalo_w 					varchar(7);
nr_seq_material_w 				bigint;
ie_frase_w 						varchar(1);
ie_setor_w 						varchar(1);
ds_inf_adicional_w 				varchar(2000);
ie_exige_indicacao_w 			varchar(1);
ie_orientacao_w 				varchar(1);
ie_observacao_w 				varchar(1);
ie_intervalo_w 					varchar(1);
ie_exige_condicao_w 			varchar(1);
nr_seq_prot_glic_w 				bigint;
ie_medico_exec_w 				varchar(1);
ie_questionar_forma_w 			varchar(1);
ie_outro_exame_w 				varchar(1);
ie_contraste_w 					varchar(1);
ie_questionar_resumo_w 			varchar(1);
ie_tela_unica_w 				varchar(1);
ie_tipo_apresent_w				varchar(1);
sql_consulta_sub_w				varchar(20000);
sql_consulta_grupo_w			varchar(20000);
sql_consulta_proced_w			varchar(20000);
sql_perfil_excl_w				varchar(6000);
sql_tipo_atend_w				varchar(6000);
sql_consiste_conv_sub_w			varchar(6000);
sql_so_convenio_sub_w			varchar(6000);
sql_convenio_sub_w				varchar(6000);
sql_setor_prescr_w				varchar(6000);
sql_sem_grupo_w					varchar(6000);
sql_clinica_w					varchar(6000);
sql_estabelecimento_w			varchar(6000);
sql_perfil_w					varchar(6000);
sql_origem_tipo_atend_w			varchar(6000);

BEGIN

delete	from w_proc_rotina_esp_t
where	nm_usuario = nm_usuario_p
and		ie_pasta = ie_pasta_p;

delete	from w_subgrupo_proc_rot_t
where	nm_usuario = nm_usuario_p
and		ie_pasta = ie_pasta_p;

delete	from w_grupo_proc_rot_t
where	nm_usuario = nm_usuario_p
and		ie_pasta = ie_pasta_p;

commit;

if (cd_perfil_p IS NOT NULL AND cd_perfil_p::text <> '') then
	sql_perfil_excl_w := ' and ((a.cd_perfil_excl <> '||cd_perfil_p||') or (a.cd_perfil_excl is null))'||chr(10);
end if;

if (coalesce(ie_tipo_atendimento_p::text, '') = '') then
	sql_tipo_atend_w := ' and a.ie_tipo_atendimento is null '||chr(10);
elsif (ie_tipo_atendimento_p <> 0) then
	sql_tipo_atend_w := ' and ((a.ie_tipo_atendimento = '||ie_tipo_atendimento_p||') or (a.ie_tipo_atendimento is null)) '||chr(10);
end if;

if (ie_consiste_convenio_p = 'S') then
	sql_consiste_conv_sub_w := ' and obter_se_exame_rotina('''||cd_medico_p||''', '''||ie_tipo_atendimento_p||''', '''||cd_setor_atendimento_p||''', '''||cd_classif_setor_pac_p||''', '''||ie_clinica_p||''', '''||cd_setor_prescr_p||''', a.nr_sequencia, '''||cd_perfil_p||''', '''||cd_estabelecimento_p||''', '''||cd_convenio_p||''') = ''S'' '||chr(10);
end if;

if (coalesce(cd_setor_prescr_p::text, '') = '') then
	sql_setor_prescr_w := ' and a.cd_setor_prescr is null '||chr(10);
elsif (cd_setor_prescr_p <> 0) then
	sql_setor_prescr_w := ' and ((a.cd_setor_prescr = '||cd_setor_prescr_p||') or (a.cd_setor_prescr is null)) '||chr(10);
end if;

if (ie_so_convenio_p = 'S') then
	sql_so_convenio_sub_w := ' and obter_se_exame_convenio('''||cd_estabelecimento_p||''', c.nr_seq_exame, c.cd_procedimento, c.ie_origem_proced, '''||ie_tipo_atendimento_p||''', '''||coalesce(cd_convenio_p,0)||''', '''||coalesce(cd_categoria_p,0)||''',sysdate) = ''S'' '||chr(10);
end if;

if (ie_sem_grupo_p = 'N') then
	sql_sem_grupo_w := ' and nvl(a.nr_seq_grupo,v.nr_seq_grupo) is not null '||chr(10);
end if;

if (coalesce(ie_clinica_p::text, '') = '') then
	sql_clinica_w := ' and a.ie_clinica is null '||chr(10);
elsif (cd_setor_prescr_p <> 0) then
	sql_clinica_w := ' and ((a.ie_clinica = '||ie_clinica_p||') or (a.ie_clinica is null)) '||chr(10);
end if;

if (coalesce(cd_convenio_p::text, '') = '') then
	sql_convenio_sub_w := ' and a.cd_convenio is null '||chr(10);
elsif (cd_convenio_p <> 0) then
	sql_convenio_sub_w := ' and ((a.cd_convenio = '||cd_convenio_p||') or (a.cd_convenio is null)) '||chr(10);
end if;

if (coalesce(cd_estabelecimento_p::text, '') = '') then
	sql_estabelecimento_w := ' and a.cd_estabelecimento is null '||chr(10);
else
	sql_estabelecimento_w := ' and ((a.cd_estabelecimento is null) or (a.cd_estabelecimento = '||cd_estabelecimento_p||')) '||chr(10);
end if;

if (coalesce(cd_perfil_p::text, '') = '') then
	sql_perfil_w := ' and a.cd_perfil is null '||chr(10);
else
	sql_perfil_w := ' and ((a.cd_perfil is null) or (a.cd_perfil = '||cd_perfil_p||')) '||chr(10);
end if;

if (coalesce(ie_tipo_atendimento_p::text, '') = '') then
	sql_origem_tipo_atend_w := ' and ((a.nr_proc_interno is not null) or (y.ie_ignora_origem = ''S''))'||chr(10);
elsif (ie_tipo_atendimento_p <> 0) then
	sql_origem_tipo_atend_w := ' and ((a.ie_origem_proced = '''||ie_origem_proced_p||''') or (a.nr_proc_interno is not null) or (y.ie_ignora_origem = ''S'')) '||chr(10);
end if;

sql_consulta_grupo_w := 'select	distinct nvl(a.nr_seq_grupo,nvl(v.nr_seq_grupo,0)) nr_seq_grupo, '||chr(10)||
								' nvl(obter_desc_grupo_rotina(nvl(a.nr_seq_grupo,nvl(v.nr_seq_grupo,0))),''obter_desc_expressao(342888)'') ds_grupo, '||chr(10)||
								' obter_seq_apres_grupo(nvl(a.nr_seq_grupo,nvl(v.nr_seq_grupo,0)), 9999) nr_seq_apresentacao, '||chr(10)||
								' obter_cor_grupo(nvl(a.nr_seq_grupo,nvl(v.nr_seq_grupo,0))) ds_cor, '||chr(10)||
								' ''L'' ie_tipo_apresent '||chr(10)||
						' from exame_laboratorio c, '||chr(10)||
							' exame_rotina_grupo v, '||chr(10)||
							' exame_lab_rotina a '||chr(10)||
						' where a.nr_seq_exame = c.nr_seq_exame '||chr(10)||
						' and a.nr_sequencia = v.nr_seq_rotina(+) '||chr(10)||
						' and nvl(c.ie_situacao,''A'') = ''A'' '||chr(10)||
						' and nvl(a.ie_situacao,''A'') = ''A'' '||chr(10)||
						' and ((a.cd_especialidade is null) or (a.cd_especialidade in ( select cd_especialidade from medico_especialidade where cd_pessoa_fisica = '''||cd_medico_p||'''))) '||chr(10)||
						' and a.cd_classif_setor_pac IS null '||chr(10)||
						' and obter_se_exibe_grupo(nvl(a.nr_seq_grupo,nvl(v.nr_seq_grupo,0)), '''||cd_perfil_p||''', '''||cd_setor_atendimento_p||''') = ''S'' '||chr(10)||
						sql_perfil_excl_w||
						sql_tipo_atend_w||
						' and lab_obter_se_exame_lib(c.nr_seq_exame,'''||cd_estabelecimento_p||''') = ''S'' '||chr(10)||
						sql_consiste_conv_sub_w||
						' and a.nr_seq_rotina is null '||chr(10)||
						sql_setor_prescr_w||
						sql_so_convenio_sub_w||
						sql_sem_grupo_w||
						sql_clinica_w||
						sql_convenio_sub_w||
						sql_estabelecimento_w||
						sql_perfil_w||
						' and obter_se_exame_lib_medico('''||cd_medico_p||''', a.nr_sequencia, null) = ''S'' '||chr(10)||
						' and nvl('''||ie_tipo_apresent_grupo_w||''',''L'') = ''L'' '||chr(10)||
						' union '||chr(10)||
						' select distinct nvl(a.nr_seq_grupo,nvl(v.nr_seq_grupo,0)) nr_seq_grupo, '||chr(10)||
							' nvl(obter_desc_grupo_rotina(nvl(a.nr_seq_grupo,nvl(v.nr_seq_grupo,0))),''obter_desc_expressao(342888)'') ds_grupo, '||chr(10)||
							' obter_seq_apres_grupo(nvl(a.nr_seq_grupo,nvl(v.nr_seq_grupo,0)), 9999) nr_seq_apresentacao, '||chr(10)||
							' obter_cor_grupo(nvl(a.nr_seq_grupo,nvl(v.nr_seq_grupo,0))) ds_cor, '||chr(10)||
							' ''P'' ie_tipo_apresent '||chr(10)||
						' from procedimento y, '||chr(10)||
							' procedimento_rotina_grupo v, '||chr(10)||
							' estrutura_procedimento_v x, '||chr(10)||
							' procedimento_rotina a '||chr(10)||
						' where a.cd_procedimento = x.cd_procedimento '||chr(10)||
						' and a.nr_sequencia = v.nr_seq_procedimento(+) '||chr(10)||
						' and a.ie_origem_proced = x.ie_origem_proced '||chr(10)||
						' and a.cd_procedimento = y.cd_procedimento '||chr(10)||
						' and a.ie_origem_proced = y.ie_origem_proced '||chr(10)||
						' and nvl(y.ie_situacao,''A'') = ''A'' '||chr(10)||
						sql_origem_tipo_atend_w||
						sql_tipo_atend_w||
						sql_convenio_sub_w||
						sql_clinica_w||
						sql_sem_grupo_w||
						' and obter_se_exibe_grupo(nvl(a.nr_seq_grupo,nvl(v.nr_seq_grupo,0)), '''||cd_perfil_p||''', '''||cd_setor_atendimento_p||''') = ''S'' '||chr(10)||
						' and obter_se_proc_rotina('''||cd_medico_p||''','''||ie_tipo_atendimento_p||''', '''||cd_setor_atendimento_p||''', '''||cd_classif_setor_pac_p||''', '''||ie_clinica_p||''', '''||cd_setor_prescr_p||''', '''||cd_convenio_p||''',a.nr_sequencia, '''||cd_estabelecimento_p||''', '''||cd_perfil_p||''', '''||ie_tipo_convenio_p||''') = ''S'' '||chr(10)||
						' and obter_se_proc_interno_ativo(a.nr_proc_interno) = ''A'' '||chr(10)||
						sql_perfil_excl_w||
						' and a.cd_classif_setor_pac is null '||chr(10)||
						' and obter_se_exame_lib_medico('''||cd_medico_p ||''', null, a.nr_sequencia) = ''S'' '||chr(10)||
						' and a.nr_seq_grupo_rotina is null '||chr(10)||
						' and a.nr_seq_rotina is null '||chr(10)||
						' and a.nr_proc_interno is null '||chr(10)||
						sql_estabelecimento_w||
						sql_perfil_w||
						' and ((a.cd_especialidade is null) or (a.cd_especialidade in (select	cd_especialidade from medico_especialidade where	cd_pessoa_fisica = '''||cd_medico_p||'''))) '||chr(10)||
						' union '||chr(10)||
						' select distinct nvl(a.nr_seq_grupo,nvl(v.nr_seq_grupo,0)) nr_seq_grupo, '||chr(10)||
							' nvl(obter_desc_grupo_rotina(nvl(a.nr_seq_grupo,nvl(v.nr_seq_grupo,0))),''obter_desc_expressao(342888)'') ds_grupo, '||chr(10)||
							' obter_seq_apres_grupo(nvl(a.nr_seq_grupo,nvl(v.nr_seq_grupo,0)), 9999) nr_seq_apresentacao, '||chr(10)||
							' obter_cor_grupo(nvl(a.nr_seq_grupo,nvl(v.nr_seq_grupo,0))) ds_cor, '||chr(10)||
							' ''P'' ie_tipo_apresent '||chr(10)||
						' from procedimento_rotina a, '||chr(10)||
							' procedimento_rotina_grupo v '||chr(10)||
						' where a.nr_sequencia = v.nr_seq_procedimento(+) '||chr(10)||
						' and a.cd_classif_setor_pac is null '||chr(10)||
						' and a.nr_seq_rotina is null '||chr(10)||
						' and a.nr_proc_interno is not null '||chr(10)||
						sql_perfil_excl_w||
						sql_estabelecimento_w||
						sql_tipo_atend_w||
						sql_clinica_w||
						sql_setor_prescr_w||
						sql_convenio_sub_w||
						sql_sem_grupo_w||
						' and obter_se_exibe_grupo(nvl(a.nr_seq_grupo,nvl(v.nr_seq_grupo,0)), '''||cd_perfil_p||''', '''||cd_setor_atendimento_p||''') = ''S'' '||chr(10)||
						sql_perfil_w||
						' and obter_se_exame_lib_medico('''||cd_medico_p||''', null, a.nr_sequencia) = ''S'' '||chr(10)||
						' and a.nr_seq_grupo_rotina is null '||chr(10)||
						' and Obter_se_proc_interno_ativo(a.nr_proc_interno) = ''A'' '||chr(10)||
						' and obter_se_proc_rotina('''||cd_medico_p||''', '''||ie_tipo_atendimento_p||''', '''||cd_setor_atendimento_p||''', '''||cd_classif_setor_pac_p||''', '''||ie_clinica_p||''', '''||cd_setor_prescr_p||''', '''||cd_convenio_p||''', a.nr_sequencia, '''||cd_estabelecimento_p||''', '''||cd_perfil_p||''', '''||ie_tipo_convenio_p||''') = ''S'' '||chr(10)||
						' and ((a.cd_especialidade is null) or (a.cd_especialidade in (select	b.cd_especialidade from medico_especialidade b where	b.cd_pessoa_fisica = '''||cd_medico_p||'''))) '||chr(10)||
						' order by	nr_seq_apresentacao, '||chr(10)||
						' ds_grupo desc';

open c01 for EXECUTE sql_consulta_grupo_w;
loop
fetch c01 into	nr_seq_grupo_w,
				ds_grupo_w,
				nr_seq_apresentacao_w,
				ds_cor_grupo_w,
				ie_tipo_apresent_grupo_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin
		insert into w_grupo_proc_rot_t(
						nr_sequencia,
						nr_seq_grupo,
						ds_grupo,
						nr_seq_apresentacao,
						nm_usuario,
						nm_usuario_nrec,
						dt_atualizacao,
						dt_atualizacao_nrec,
						ds_cor,
						ie_pasta,
						ie_tipo_apresent,
						nr_seq_coluna)
				values (
						nextval('w_grupo_proc_rot_t_seq'),
						nr_seq_grupo_w,
						ds_grupo_w,
						nr_seq_apresentacao_w,
						nm_usuario_p,
						nm_usuario_p,
						clock_timestamp(),
						clock_timestamp(),
						ds_cor_grupo_w,
						ie_pasta_p,
						ie_tipo_apresent_grupo_w,
						1);
	commit;
	sql_consulta_sub_w := 	'select	distinct nvl(a.nr_seq_subgrupo,0) nr_seq_subgrupo, '||chr(10)||
							' obter_desc_subgrupo_rotina(nvl(a.nr_seq_subgrupo,0)) ds_subgrupo, '||chr(10)||
							' nvl(obter_ordem_apres_subgrupo(a.nr_seq_subgrupo),999) nr_seq_apresentacao, '||chr(10)||
							' ''L'' ie_tipo_apresent '||chr(10)||
							' from exame_laboratorio c, '||chr(10)||
							' exame_rotina_grupo v, '||chr(10)||
							' exame_lab_rotina a '||chr(10)||
							' where	a.nr_seq_exame  = c.nr_seq_exame '||chr(10)||
							' and a.nr_sequencia = v.nr_seq_rotina(+) '||chr(10)||
							' and nvl(c.ie_situacao,''A'') = ''A'' '||chr(10)||
							' and nvl(a.ie_situacao,''A'') = ''A'' '||chr(10)||
							' and ((a.cd_especialidade is null) or (a.cd_especialidade in (	select	cd_especialidade from	medico_especialidade where	cd_pessoa_fisica = '||cd_medico_p||'))) '||chr(10)||
							' and a.cd_classif_setor_pac IS null'||chr(10)||
							' and Obter_se_exibe_grupo(nvl(a.nr_seq_grupo,nvl(v.nr_seq_grupo,0)), '''||cd_perfil_p||''', '''||cd_setor_atendimento_p||''') = ''S'' '||chr(10)||
							sql_perfil_excl_w||
							sql_tipo_atend_w||
							' and lab_obter_se_exame_lib(c.nr_seq_exame,'''||cd_estabelecimento_p||''') = ''S'' '||
							sql_consiste_conv_sub_w||
							' and a.nr_seq_rotina is null '||chr(10)||
							' and nvl(a.nr_seq_grupo,nvl(v.nr_seq_grupo,0)) = '||nr_seq_grupo_w||chr(10)||
							sql_setor_prescr_w||
							sql_so_convenio_sub_w||
							sql_sem_grupo_w||
							sql_clinica_w||
							sql_convenio_sub_w||
							sql_estabelecimento_w||
							sql_perfil_w||
							' and obter_se_exame_lib_medico('''||cd_medico_p||''', a.nr_sequencia, null) = ''S'' '||chr(10)||
							' and nvl('''||ie_tipo_apresent_grupo_w||''',''L'') = ''L'' '||chr(10)||
							' union '||chr(10)||
							' select distinct nvl(a.nr_seq_subgrupo,0) nr_seq_subgrupo, '||chr(10)||
							' obter_desc_subgrupo_rotina(nvl(a.nr_seq_subgrupo,0)) ds_subgrupo, '||chr(10)||
							' nvl(obter_ordem_apres_subgrupo(a.nr_seq_subgrupo),999) nr_seq_apresentacao, '||chr(10)||
							' ''P'' ie_tipo_apresent '||chr(10)||
							' from	procedimento y, '||chr(10)||
							' procedimento_rotina_grupo v, '||chr(10)||
							' estrutura_procedimento_v x, '||chr(10)||
							' procedimento_rotina a '||chr(10)||
							' where a.cd_procedimento = x.cd_procedimento '||chr(10)||
							' and a.nr_sequencia = v.nr_seq_procedimento(+) '||chr(10)||
							' and a.ie_origem_proced = x.ie_origem_proced '||chr(10)||
							' and a.cd_procedimento	= y.cd_procedimento '||chr(10)||
							' and a.ie_origem_proced = y.ie_origem_proced '||chr(10)||
							' and nvl(y.ie_situacao,''A'') = ''A'' '||chr(10)||
							sql_origem_tipo_atend_w||
							sql_tipo_atend_w||
							sql_convenio_sub_w||
							sql_clinica_w||
							' and nvl(a.nr_seq_grupo,nvl(v.nr_seq_grupo,0)) = '||nr_seq_grupo_w||chr(10)||
							sql_setor_prescr_w||
							sql_sem_grupo_w||
							' and obter_se_exibe_grupo(nvl(a.nr_seq_grupo,nvl(v.nr_seq_grupo,0)), '''||cd_perfil_p||''', '''||cd_setor_atendimento_p||''') = ''S'' '||chr(10)||
							' and obter_se_proc_rotina('''||cd_medico_p||''', '''||ie_tipo_atendimento_p||''', '''||cd_setor_atendimento_p||''', '''||cd_classif_setor_pac_p||''', '''||ie_clinica_p||''', '''||cd_setor_prescr_p||''', '''||cd_convenio_p||''', a.nr_sequencia, '''||cd_estabelecimento_p||''', '''||cd_perfil_p||''', '''||ie_tipo_convenio_p||''') = ''S'' '||chr(10)||
							' and obter_se_proc_interno_ativo(a.nr_proc_interno) = ''A'' '||chr(10)||
							sql_perfil_excl_w||
							' and a.cd_classif_setor_pac is null '||chr(10)||
							' and obter_se_exame_lib_medico('''||cd_medico_p||''', null, a.nr_sequencia) = ''S'' '||chr(10)||
							' and a.nr_seq_grupo_rotina is null '||chr(10)||
							' and a.nr_seq_rotina is null '||chr(10)||
							' and a.nr_proc_interno is null '||chr(10)||
							sql_estabelecimento_w||
							sql_perfil_w||
							' and ((a.cd_especialidade is null) or (a.cd_especialidade in (select	cd_especialidade from medico_especialidade where	cd_pessoa_fisica = '''||cd_medico_p||'''))) '||chr(10)||
							' and nvl('''||ie_tipo_apresent_grupo_w||''',''P'') = ''P'' '||chr(10)||
							' union '||chr(10)||
							' select distinct nvl(a.nr_seq_subgrupo,0) nr_seq_subgrupo, '||chr(10)||
							' obter_desc_subgrupo_rotina(nvl(a.nr_seq_subgrupo,0)) ds_subgrupo, '||chr(10)||
							' nvl(obter_ordem_apres_subgrupo(a.nr_seq_subgrupo),999) nr_seq_apresentacao, '||chr(10)||
							' ''P'' ie_tipo_apresent '||chr(10)||
							' from procedimento_rotina a, '||chr(10)||
							' procedimento_rotina_grupo v '||chr(10)||
							' where a.nr_sequencia = v.nr_seq_procedimento(+) '||chr(10)||
							' and a.cd_classif_setor_pac is null '||chr(10)||
							' and a.nr_seq_rotina is null '||chr(10)||
							' and a.nr_proc_interno is not null '||chr(10)||
							' and nvl(a.nr_seq_grupo,nvl(v.nr_seq_grupo,0)) = '||nr_seq_grupo_w||chr(10)||
							sql_perfil_excl_w||
							sql_estabelecimento_w||
							sql_tipo_atend_w||
							sql_clinica_w||
							sql_setor_prescr_w||
							sql_convenio_sub_w||
							sql_sem_grupo_w||
							' and obter_se_exibe_grupo(nvl(a.nr_seq_grupo,nvl(v.nr_seq_grupo,0)), '''||cd_perfil_p||''', '''||cd_setor_atendimento_p||''') = ''S'' '||chr(10)||
							sql_perfil_w||
							' and obter_se_exame_lib_medico('''||cd_medico_p||''', null, a.nr_sequencia) = ''S'' '||chr(10)||
							' and a.nr_seq_grupo_rotina is null '||chr(10)||
							' and obter_se_proc_interno_ativo(a.nr_proc_interno) = ''A'' '||chr(10)||
							' and obter_se_proc_rotina('''||cd_medico_p||''', '''||ie_tipo_atendimento_p||''', '''||cd_setor_atendimento_p||''', '''||cd_classif_setor_pac_p||''', '''||ie_clinica_p||''', '''||cd_setor_prescr_p||''', '''||cd_convenio_p||''', a.nr_sequencia, '''||cd_estabelecimento_p||''', '''||cd_perfil_p||''', '''||ie_tipo_convenio_p||''') = ''S'' '||chr(10)||
							' and ((a.cd_especialidade is null) or (a.cd_especialidade in (select	b.cd_especialidade from medico_especialidade b where b.cd_pessoa_fisica = '''||cd_medico_p||'''))) '||chr(10)||
							' and nvl('''||ie_tipo_apresent_grupo_w||''',''P'') = ''P'' '||chr(10)||
							' order by	nr_seq_apresentacao, '||chr(10)||
							' ds_subgrupo desc';
	open c02 for EXECUTE sql_consulta_sub_w;
	loop
	fetch c02 into	nr_seq_subgrupo_w,
					ds_subgrupo_w,
					nr_seq_apresentacao_subgrupo_w,
					ie_tipo_apresent_subgrupo_w;
	EXIT WHEN NOT FOUND; /* apply on c02 */
		begin

		insert into w_subgrupo_proc_rot_t(
						nr_sequencia,
						nr_seq_subgrupo,
						nr_seq_grupo,
						ds_subgrupo,
						nr_seq_apresentacao,
						nm_usuario,
						nm_usuario_nrec,
						dt_atualizacao,
						dt_atualizacao_nrec,
						ie_pasta,
						ie_tipo_apresent,
						nr_seq_coluna)
				values (
						nextval('w_subgrupo_proc_rot_t_seq'),
						nr_seq_subgrupo_w,
						nr_seq_grupo_w,
						ds_subgrupo_w,
						nr_seq_apresentacao_subgrupo_w,
						nm_usuario_p,
						nm_usuario_p,
						clock_timestamp(),
						clock_timestamp(),
						ie_pasta_p,
						ie_tipo_apresent_subgrupo_w,
						1);
		commit;
		qt_registro_w := 0;
		nr_seq_subgrupo_ww := 0;
		nr_seq_coluna_w := 1;
		sql_consulta_proced_w := 	' select distinct 0 ie_tipo, '||chr(10)||
										' decode('''||varie_tipo_p||''',''S'',0,1) nr_seq_ordem, '||chr(10)||
										' nvl(a.ie_exige_justificativa,''N'') ie_exige_justificativa, '||chr(10)||
										' min(a.nr_sequencia) nr_sequencia, '||chr(10)||
										' decode('''||ie_maiuscula_p||''',''N'',a.ds_prescricao,initcap(a.ds_prescricao)) ds_prescricao, '||chr(10)||
										' 0 cd_grupo_proc, '||chr(10)||
										' a.ie_rotina_uti, '||chr(10)||
										' a.ie_lado, '||chr(10)||
										' ''NC'' ie_ctrl_glic, '||chr(10)||
										' nvl(c.ie_topografia,''N'') ie_topografia, '||chr(10)||
										' 0 cd_especialidade, '||chr(10)||
										' a.nr_seq_apres, '||chr(10)||
										' a.ds_cor, '||chr(10)||
										' a.cd_intervalo, '||chr(10)||
										' a.nr_seq_material, '||chr(10)||
										' nvl(a.ie_frase,''N'') ie_frase, '||chr(10)||
										' ''N'' ie_setor, '||chr(10)||
										' obter_inf_exame_rotina(a.nr_seq_rotina) ds_inf_adicional, '||chr(10)||
										' nvl(a.ie_exige_indicacao,''N'') ie_indicacao, '||chr(10)||
										' nvl(a.ie_orientacao,''N'') ie_orientacao, '||chr(10)||
										' nvl(a.ie_observacao,''N'') ie_observacao, '||chr(10)||
										' a.ie_intervalo, '||chr(10)||
										' ''N'' ie_exige_condicao, '||chr(10)||
										' null nr_seq_prot_glic, '||chr(10)||
										' nvl(a.ie_medico_exec,''N'') ie_medico_exec, '||chr(10)||
										' nvl(a.ie_questionar_forma,''N'') ie_questionar_forma, '||chr(10)||
										' nvl(a.ie_outro_exame,''N'') ie_outro_exame, '||chr(10)||
										' ''N'' ie_contraste, '||chr(10)||
										' ''N'' ie_questionar_resumo, '||chr(10)||
										' ''N'' ie_tela_unica, '||chr(10)||
										' ''L'' ie_tipo_apresent '||chr(10)||
									' from exame_laboratorio c, '||chr(10)||
											' exame_rotina_grupo v, '||chr(10)||
											' exame_lab_rotina a '||chr(10)||
									' where a.nr_seq_exame  = c.nr_seq_exame '||chr(10)||
									' and a.nr_sequencia = v.nr_seq_rotina(+) '||chr(10)||
									' and nvl(c.ie_situacao,''A'') = ''A'' '||chr(10)||
									' and nvl(a.ie_situacao,''A'') = ''A'' '||chr(10)||
									' and ((a.cd_especialidade is null) or (a.cd_especialidade in (select cd_especialidade from medico_especialidade where cd_pessoa_fisica = '''||cd_medico_p||'''))) '||chr(10)||
									' and a.cd_classif_setor_pac is null '||chr(10)||
									' and nvl(v.nr_seq_grupo,nvl(a.nr_seq_grupo,0)) = '||coalesce(nr_seq_grupo_w,0)||chr(10)||
									' and nvl(a.nr_seq_subgrupo,0) = '||coalesce(nr_seq_subgrupo_w,0)||chr(10)||
									sql_perfil_excl_w||
									' and lab_obter_se_exame_lib(c.nr_seq_exame, '''||cd_estabelecimento_p||''') = ''S'' '||chr(10)||
									sql_sem_grupo_w||
									sql_clinica_w||
									sql_so_convenio_sub_w||
									sql_tipo_atend_w||
									sql_setor_prescr_w||
									sql_consiste_conv_sub_w||
									' and a.nr_seq_rotina is null '||chr(10)||
									sql_convenio_sub_w||
									sql_estabelecimento_w||
									sql_perfil_w||
									' and obter_se_exame_lib_medico('''||cd_medico_p||''', a.nr_sequencia, null) = ''S'' '||chr(10)||
									' and nvl('''||ie_tipo_apresent_grupo_w||''',''L'') = ''L'' '||chr(10)||
									' group by '||chr(10)||
											' a.ds_prescricao, '||chr(10)||
											' a.ie_rotina_uti, '||chr(10)||
											' initcap(a.ds_prescricao), '||chr(10)||
											' a.ie_lado, '||chr(10)||
											' ''NC'', '||chr(10)||
											' ''N'', '||chr(10)||
											' a.nr_seq_apres, '||chr(10)||
											' a.ds_cor, '||chr(10)||
											' a.cd_intervalo, '||chr(10)||
											' a.nr_seq_material, '||chr(10)||
											' a.ie_frase, '||chr(10)||
											' obter_inf_exame_rotina(a.nr_seq_rotina), '||chr(10)||
											' nvl(a.ie_exige_indicacao,''N''), '||chr(10)||
											' nvl(c.ie_topografia,''N''), '||chr(10)||
											' nvl(a.ie_exige_justificativa,''N''), '||chr(10)||
											' nvl(a.ie_orientacao,''N''), '||chr(10)||
											' nvl(a.ie_observacao,''N''), '||chr(10)||
											' a.ie_intervalo, '||chr(10)||
											' nvl(a.ie_medico_exec,''N''), '||chr(10)||
											' nvl(a.ie_questionar_forma,''N''), '||chr(10)||
											' nvl(a.ie_outro_exame,''N''), '||chr(10)||
											' ''L'' '||chr(10)||
									' union '||chr(10)||
									' select	distinct 1 ie_tipo,  '||chr(10)||
										' decode('''||varie_tipo_p||''',''S'',1,0) nr_seq_ordem, '||chr(10)||
										' nvl(a.ie_exige_justificativa,''N'') ie_exige_justificativa, '||chr(10)||
										' min(a.nr_sequencia), '||chr(10)||
										' decode('''||ie_maiuscula_p||''',''N'',nvl(a.ds_reduzida, a.ds_prescricao),initcap(nvl(a.ds_reduzida, a.ds_prescricao))) ds_prescricao, '||chr(10)||
										' x.cd_grupo_proc, '||chr(10)||
										' a.ie_rotina_uti, '||chr(10)||
										' a.ie_lado, '||chr(10)||
										' substr(obter_ctrl_glic_proc(a.nr_proc_interno),1,3) ie_ctrl_glic, '||chr(10)||
										' decode(nvl(a.ie_topografia,''N''),''S'',''S'',substr(obter_regra_topog_proc_int(a.nr_proc_interno),1,1)) ie_topografia, '||chr(10)||
										' max(x.cd_especialidade) cd_especialidade, '||chr(10)||
										' a.nr_seq_apres, '||chr(10)||
										' a.ds_cor, '||chr(10)||
										' a.cd_intervalo, '||chr(10)||
										' 0 nr_seq_material, '||chr(10)||
										' nvl(ie_frase,''N'') ie_frase, '||chr(10)||
										' nvl(a.ie_setor,''N'') ie_setor,'||chr(10)||
										' obter_inf_exame_rotina(a.nr_seq_rotina) ds_inf_adicional, '||chr(10)||
										' nvl(a.ie_exige_indicacao,''N''), '||chr(10)||
										' ''N'' ie_orientacao, '||chr(10)||
										' nvl(a.ie_observacao,''N'') ie_observacao, '||chr(10)||
										' a.ie_intervalo, '||chr(10)||
										' nvl(a.ie_exige_condicao, ''N'') ie_exige_condicao, '||chr(10)||
										' obter_dados_proc_interno(a.nr_proc_interno,''G''), '||chr(10)||
										' nvl(a.ie_medico_exec,''N'') ie_medico_exec, '||chr(10)||
										' nvl(a.ie_questionar_forma,''N'') ie_questionar_forma, '||chr(10)||
										' nvl(a.ie_outro_exame,''N'') ie_outro_exame, '||chr(10)||
										' nvl(a.ie_contraste,''N'') ie_contraste, '||chr(10)||
										' nvl(a.ie_questionar_resumo,''N''), '||chr(10)||
										' nvl(a.ie_tela_unica,''N'') ie_tela_unica, '||chr(10)||
										' ''P'' ie_tipo_apresent '||chr(10)||
									' from	procedimento y, '||chr(10)||
											' procedimento_rotina_grupo v, '||chr(10)||
											' estrutura_procedimento_v x, '||chr(10)||
											' procedimento_rotina a '||chr(10)||
									' where	a.cd_procedimento = x.cd_procedimento '||chr(10)||
									' and a.nr_sequencia = v.nr_seq_procedimento(+) '||chr(10)||
									' and a.ie_origem_proced = x.ie_origem_proced '||chr(10)||
									' and a.cd_procedimento = y.cd_procedimento '||chr(10)||
									' and a.ie_origem_proced = y.ie_origem_proced '||chr(10)||
									' and nvl(y.ie_situacao,''A'') = ''A'' '||chr(10)||
									' and nvl(v.nr_seq_grupo,nvl(a.nr_seq_grupo,0)) = '||coalesce(nr_seq_grupo_w,0)||chr(10)||
									' and nvl(a.nr_seq_subgrupo,0) = '||coalesce(nr_seq_subgrupo_w,0)||chr(10)||
									sql_sem_grupo_w||
									sql_origem_tipo_atend_w||
									sql_tipo_atend_w||
									' and obter_se_proc_rotina('''||cd_medico_p||''', '''||ie_tipo_atendimento_p||''', '''||cd_setor_atendimento_p||''', '''||cd_classif_setor_pac_p||''', '''||ie_clinica_p||''', '''||cd_setor_prescr_p||''', '''||cd_convenio_p||''', a.nr_sequencia, '''||cd_estabelecimento_p||''', '''||cd_perfil_p||''', '''||ie_tipo_convenio_p||''') = ''S'' '||chr(10)||
									' and obter_se_proc_interno_ativo(a.nr_proc_interno) = ''A'' '||chr(10)||
									sql_clinica_w||
									sql_setor_prescr_w||
									sql_perfil_excl_w||
									' and a.cd_classif_setor_pac is null '||chr(10)||
									' and obter_se_exame_lib_medico('''||cd_medico_p||''', null, a.nr_sequencia) = ''S'' '||chr(10)||
									' and a.nr_seq_grupo_rotina is null '||chr(10)||
									' and a.nr_seq_rotina is null '||chr(10)||
									sql_convenio_sub_w||
									' and a.nr_proc_interno is null '||
									sql_estabelecimento_w||
									sql_perfil_w||
									' and ((a.cd_especialidade is null) or (a.cd_especialidade in (select	cd_especialidade from medico_especialidade where cd_pessoa_fisica = '''||cd_medico_p||'''))) '||chr(10)||
									' and nvl('''||ie_tipo_apresent_grupo_w||''',''P'') = ''P'' '||chr(10)||
									' group by '||chr(10)||
											' nvl(a.ds_reduzida, a.ds_prescricao), '||chr(10)||
											' x.cd_grupo_proc, '||chr(10)||
											' obter_dados_proc_interno(a.nr_proc_interno,''G''), '||chr(10)||
											' nvl(a.ie_exige_justificativa,''N''), '||chr(10)||
											' initcap(nvl(a.ds_reduzida, a.ds_prescricao)), '||chr(10)||
											' a.ie_rotina_uti, '||chr(10)||
											' a.ie_lado, '||chr(10)||
											' substr(obter_ctrl_glic_proc(a.nr_proc_interno),1,3), '||chr(10)||
											' decode(nvl(a.ie_topografia,''N''),''S'',''S'',substr(obter_regra_topog_proc_int(a.nr_proc_interno),1,1)), '||chr(10)||
											' a.nr_seq_apres, '||chr(10)||
											' a.ds_cor, '||chr(10)||
											' a.cd_intervalo, '||chr(10)||
											' ie_frase, '||chr(10)||
											' nvl(a.ie_setor,''N''), '||chr(10)||
											' obter_inf_exame_rotina(a.nr_seq_rotina), '||chr(10)||
											' nvl(a.ie_exige_indicacao,''N''), '||chr(10)||
											' nvl(a.IE_EXIGE_CONDICAO, ''N''), '||chr(10)||
											' nvl(a.ie_observacao,''N''), '||chr(10)||
											' a.ie_intervalo, '||chr(10)||
											' nvl(a.ie_medico_exec,''N''), '||chr(10)||
											' nvl(a.ie_questionar_forma,''N''), '||chr(10)||
											' nvl(a.ie_outro_exame,''N''),'||chr(10)||
											' nvl(a.ie_contraste,''N''), '||chr(10)||
											' nvl(a.ie_questionar_resumo,''N''), '||chr(10)||
											' nvl(a.ie_tela_unica,''N''), '||chr(10)||
											' ''P'' '||chr(10)||
									' union '||chr(10)||
									' select	distinct 1 ie_tipo, '||chr(10)||
										' decode('''||varie_tipo_p||''',''S'',1,0) nr_seq_ordem, '||chr(10)||
										' nvl(a.ie_exige_justificativa,''N'') ie_exige_justificativa, '||chr(10)||
										' min(a.nr_sequencia), '||chr(10)||
										' decode('''||ie_maiuscula_p||''',''N'',nvl(a.ds_reduzida, a.ds_prescricao),initcap(nvl(a.ds_reduzida, a.ds_prescricao))) ds_prescricao, '||chr(10)||
										' 0 cd_grupo_proc, '||chr(10)||
										' a.ie_rotina_uti, '||chr(10)||
										' a.ie_lado, '||chr(10)||
										' substr(obter_ctrl_glic_proc(a.nr_proc_interno),1,3) ie_ctrl_glic, '||chr(10)||
										' decode(nvl(a.ie_topografia,''N''),''S'',''S'',substr(obter_regra_topog_proc_int(a.nr_proc_interno),1,1)) ie_topografia, '||chr(10)||
										' 0 cd_especialidade, '||chr(10)||
										' a.nr_seq_apres, '||chr(10)||
										' a.ds_cor, '||chr(10)||
										' a.cd_intervalo, '||chr(10)||
										' 0 nr_seq_material, '||chr(10)||
										' nvl(ie_frase,''N'') ie_frase, '||chr(10)||
										' nvl(a.ie_setor,''N'') ie_setor, '||chr(10)||
										' obter_inf_exame_rotina(a.nr_seq_rotina) ds_inf_adicional, '||chr(10)||
										' nvl(a.ie_exige_indicacao,''N''), '||chr(10)||
										' ''N'' ie_orientacao, '||chr(10)||
										' nvl(a.ie_observacao,''N'') ie_observacao, '||chr(10)||
										' a.ie_intervalo, '||chr(10)||
										' nvl(a.ie_exige_condicao, ''N'') ie_exige_condicao, '||chr(10)||
										' obter_dados_proc_interno(a.nr_proc_interno,''G''), '||chr(10)||
										' nvl(a.ie_medico_exec,''N'') ie_medico_exec, '||chr(10)||
										' nvl(a.ie_questionar_forma,''N'') ie_questionar_forma, '||chr(10)||
										' nvl(a.ie_outro_exame,''N'') ie_outro_exame, '||chr(10)||
										' nvl(a.ie_contraste,''N'') ie_contraste, '||chr(10)||
										' nvl(a.ie_questionar_resumo,''N''), '||chr(10)||
										' nvl(a.ie_tela_unica,''N'') ie_tela_unica, '||chr(10)||
										' ''P'' ie_tipo_apresent '||chr(10)||
									' from	procedimento_rotina a, '||chr(10)||
											' procedimento_rotina_grupo v '||chr(10)||
									' where a.nr_sequencia = v.nr_seq_procedimento(+) '||chr(10)||
									' and a.cd_classif_setor_pac is null '||chr(10)||
									' and a.nr_seq_rotina is null '||chr(10)||
									' and a.nr_proc_interno is not null '||chr(10)||
									sql_perfil_excl_w||
									sql_sem_grupo_w||
									sql_tipo_atend_w||
									sql_estabelecimento_w||
									' and nvl(v.nr_seq_grupo,nvl(a.nr_seq_grupo,0)) = '||coalesce(nr_seq_grupo_w,0)||chr(10)||
									' and nvl(a.nr_seq_subgrupo,0) = '||coalesce(nr_seq_subgrupo_w,0)||chr(10)||
									sql_perfil_w||
									' and obter_se_exame_lib_medico('''||cd_medico_p||''', null, a.nr_sequencia) = ''S'' '||chr(10)||
									' and a.nr_seq_grupo_rotina is null '||chr(10)||
									sql_clinica_w||
									sql_setor_prescr_w||
									sql_convenio_sub_w||
									' and obter_se_proc_interno_ativo(a.nr_proc_interno) = ''A'' '||chr(10)||
									' and obter_se_proc_rotina('''||cd_medico_p||''', '''||ie_tipo_atendimento_p||''', '''||cd_setor_atendimento_p||''', '''||cd_classif_setor_pac_p||''', '''||ie_clinica_p||''', '''||cd_setor_prescr_p||''', '''||cd_convenio_p||''', a.nr_sequencia, '''||cd_estabelecimento_p||''', '''||cd_perfil_p||''', '''||ie_tipo_convenio_p||''') = ''S'' '||chr(10)||
									' and	((a.cd_especialidade is null) or (a.cd_especialidade in (select	b.cd_especialidade from	medico_especialidade b where	b.cd_pessoa_fisica = '''||cd_medico_p||'''))) '||chr(10)||
									' and	nvl('''||ie_tipo_apresent_grupo_w||''',''P'') = ''P'' '||chr(10)||
									' group by '||chr(10)||
											' nvl(a.ds_reduzida, a.ds_prescricao), '||chr(10)||
											' 0, '||chr(10)||
											' obter_dados_proc_interno(a.nr_proc_interno,''G''), '||chr(10)||
											' a.ie_rotina_uti, '||chr(10)||
											' nvl(a.ie_exige_justificativa,''N''), '||chr(10)||
											' a.ie_lado, '||chr(10)||
											' initcap(nvl(a.ds_reduzida, a.ds_prescricao)), '||chr(10)||
											' substr(obter_ctrl_glic_proc(a.nr_proc_interno),1,3), '||chr(10)||
											' decode(nvl(a.ie_topografia,''N''),''S'',''S'',substr(obter_regra_topog_proc_int(a.nr_proc_interno),1,1)), '||chr(10)||
											' a.nr_seq_apres, '||chr(10)||
											' a.ds_cor, '||chr(10)||
											' a.cd_intervalo, '||chr(10)||
											' ie_frase, '||chr(10)||
											' nvl(a.ie_setor,''N''), '||chr(10)||
											' obter_inf_exame_rotina(a.nr_seq_rotina), '||chr(10)||
											' nvl(a.ie_exige_indicacao,''N''), '||chr(10)||
											' nvl(a.IE_EXIGE_CONDICAO, ''N''), '||chr(10)||
											' nvl(a.ie_observacao,''N''), '||chr(10)||
											' a.ie_intervalo, '||chr(10)||
											' nvl(a.ie_medico_exec,''N''), '||chr(10)||
											' nvl(a.ie_questionar_forma,''N''), '||chr(10)||
											' nvl(a.ie_outro_exame,''N''), '||chr(10)||
											' nvl(a.ie_contraste,''N''), '||chr(10)||
											' nvl(a.ie_questionar_resumo,''N''), '||chr(10)||
											' nvl(a.ie_tela_unica,''N''), '||chr(10)||
											' ''P'' '||chr(10)||
											' ORDER BY '||chr(10)||
											' nr_seq_apres, '||chr(10)||
											' nr_seq_ordem, '||chr(10)||
											' ie_tipo, '||chr(10)||
											' cd_especialidade, '||chr(10)||
											' ds_prescricao ';
		open c03 for EXECUTE sql_consulta_proced_w;
		loop
		fetch c03 into	ie_tipo_w,
						nr_seq_ordem_w,
						ie_exige_justificativa_w,
						nr_seq_proc_rotina_w,
						ds_prescricao_w,
						cd_grupo_proc_w,
						ie_rotina_uti_w,
						ie_exige_lado_w,
						ie_ctrl_glic_w,
						ie_topografia_w,
						cd_especialidade_w,
						nr_seq_apres_w,
						ds_cor_w,
						cd_intervalo_w,
						nr_seq_material_w,
						ie_frase_w,
						ie_setor_w,
						ds_inf_adicional_w,
						ie_exige_indicacao_w,
						ie_orientacao_w,
						ie_observacao_w,
						ie_intervalo_w,
						ie_exige_condicao_w,
						nr_seq_prot_glic_w,
						ie_medico_exec_w,
						ie_questionar_forma_w,
						ie_outro_exame_w,
						ie_contraste_w,
						ie_questionar_resumo_w,
						ie_tela_unica_w,
						ie_tipo_apresent_w;
		EXIT WHEN NOT FOUND; /* apply on c03 */
			begin
			qt_registro_w := qt_registro_w + 1;
			if (qt_registro_w > qt_reg_coluna_p) then
				qt_registro_w   := 1;
				nr_seq_subgrupo_ww := nr_seq_subgrupo_ww +1;
				nr_seq_coluna_w := nr_seq_coluna_w + 1;

				if (nr_seq_subgrupo_w > 0) then
					nr_seq_subgrupo_w := nr_seq_subgrupo_w||nr_seq_subgrupo_ww;
				else
					nr_seq_subgrupo_w := 999||nr_seq_subgrupo_ww;
				end if;

				insert into w_subgrupo_proc_rot_t(
								nr_sequencia,
								nr_seq_subgrupo,
								nr_seq_grupo,
								ds_subgrupo,
								nr_seq_apresentacao,
								nm_usuario,
								nm_usuario_nrec,
								dt_atualizacao,
								dt_atualizacao_nrec,
								ie_pasta,
								ie_tipo_apresent,
								nr_seq_coluna)
						values (
								nextval('w_subgrupo_proc_rot_t_seq'),
								nr_seq_subgrupo_w,
								nr_seq_grupo_w,
								ds_subgrupo_w,
								nr_seq_apresentacao_subgrupo_w,
								nm_usuario_p,
								nm_usuario_p,
								clock_timestamp(),
								clock_timestamp(),
								ie_pasta_p,
								ie_tipo_apresent_subgrupo_w,
								1);
				commit;
			end if;

			insert into	w_proc_rotina_esp_t(
							ie_tipo,
							nr_seq_ordem,
							ie_exige_justificativa,
							nr_sequencia,
							nr_seq_proc_rotina,
							ds_prescricao,
							cd_grupo_proc,
							ie_rotina_uti,
							ie_exige_lado,
							ie_ctrl_glic,
							ie_topografia,
							cd_especialidade,
							nr_seq_apres,
							ds_cor,
							cd_intervalo,
							nr_seq_material,
							ie_frase,
							ie_setor,
							ds_inf_adicional,
							ie_exige_indicacao,
							ie_orientacao,
							ie_observacao,
							ie_intervalo,
							ie_exige_condicao,
							nr_seq_prot_glic,
							ie_medico_exec,
							ie_questionar_forma,
							ie_outro_exame,
							ie_contraste,
							ie_questionar_resumo,
							ie_tela_unica,
							nm_usuario,
							nr_seq_grupo,
							nm_usuario_nrec,
							dt_atualizacao,
							dt_atualizacao_nrec,
							ie_pasta,
							ie_marcado,
							ie_tipo_apresent,
							nr_seq_subgrupo)
					values (
							ie_tipo_w,
							nr_seq_ordem_w,
							ie_exige_justificativa_w,
							nextval('w_proc_rotina_esp_t_seq'),
							nr_seq_proc_rotina_w,
							ds_prescricao_w,
							cd_grupo_proc_w,
							ie_rotina_uti_w,
							ie_exige_lado_w,
							ie_ctrl_glic_w,
							ie_topografia_w,
							cd_especialidade_w,
							nr_seq_apres_w,
							ds_cor_w,
							cd_intervalo_w,
							nr_seq_material_w,
							ie_frase_w,
							ie_setor_w,
							ds_inf_adicional_w,
							ie_exige_indicacao_w,
							ie_orientacao_w,
							ie_observacao_w,
							ie_intervalo_w,
							ie_exige_condicao_w,
							nr_seq_prot_glic_w,
							ie_medico_exec_w,
							ie_questionar_forma_w,
							ie_outro_exame_w,
							ie_contraste_w,
							ie_questionar_resumo_w,
							ie_tela_unica_w,
							nm_usuario_p,
							nr_seq_grupo_w,
							nm_usuario_p,
							clock_timestamp(),
							clock_timestamp(),
							ie_pasta_p,
							'N',
							ie_tipo_apresent_w,
							nr_seq_subgrupo_w);
			commit;
			end;
		end loop;
		close c03;
		end;
	end loop;
	close c02;
	end;
end loop;
close c01;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_exames_rot_esp_subgrupo ( nm_usuario_p text, cd_perfil_p bigint, cd_medico_p text, cd_setor_atendimento_p bigint, cd_estabelecimento_p bigint, ie_consiste_convenio_p text, cd_classif_setor_pac_p bigint, ie_clinica_p bigint, cd_setor_prescr_p bigint, ie_tipo_atendimento_p bigint, cd_convenio_p bigint, ie_sem_grupo_p text, ie_so_convenio_p text, cd_categoria_p bigint, ie_origem_proced_p bigint, ie_tipo_convenio_p bigint, varie_tipo_p text, ie_maiuscula_p text, ie_pasta_p bigint, ie_restringe_estab_p text, qt_reg_coluna_p bigint, ie_todos_p text, ie_ordem_seq_p text, ie_tabela_interna_p text, ie_tipo_p text ) FROM PUBLIC;

