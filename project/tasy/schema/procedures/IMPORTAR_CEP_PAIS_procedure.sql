-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE importar_cep_pais ( nm_pais_p text, sg_pais_p text, nm_usuario_p text) AS $body$
DECLARE


ds_parametros_w		varchar(2000);
ds_insert_w		varchar(2000) := 	'pais_seq.nextval,' ||
						'sysdate,' ||
						'sysdate,' ||
						':nm_usuario_p,' ||
						':nm_usuario_nrec_p,' ||
						':nm_pais_p,' ||
						':sg_pais_p,' ||
						':ie_situacao_p';

ds_comando_w		varchar(2000) := 	'insert	into pais' ||
							'(nr_sequencia,' ||
							'dt_atualizacao,' ||
							'dt_atualizacao_nrec,' ||
							'nm_usuario,' ||
							'nm_usuario_nrec,' ||
							'nm_pais,' ||
							'sg_pais,' ||
							'ie_situacao) ' ||
						'select ' || ds_insert_w || ' from dual ' ||
						'where not exists (select 1 from pais a where a.sg_pais = :sg_pais_p)';
						

BEGIN

if (nm_pais_p IS NOT NULL AND nm_pais_p::text <> '') then	
	
	ds_parametros_w := 'NM_USUARIO_P=' || nm_usuario_p || ';' || 'NM_USUARIO_NREC_P=' || nm_usuario_p || ';' || 'NM_PAIS_P=' || nm_pais_p || ';' || 'SG_PAIS_P=' || sg_pais_p || ';' || 'IE_SITUACAO_P=A;';
	
	CALL gravar_processo_longo(ds_comando_w,'IMPORTAR_CEP_PAIS',null);
	CALL Exec_Sql_Dinamico_bv('Insert pais: ' || nm_pais_p, ds_comando_w,ds_parametros_w);
		
	commit;
end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE importar_cep_pais ( nm_pais_p text, sg_pais_p text, nm_usuario_p text) FROM PUBLIC;

