-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ctb_ignorar_lancamento_doc ( nr_seq_doc_p ctb_documento.nr_sequencia%type, nm_atributo_p ctb_documento.nm_atributo%type, nm_tabela_p ctb_documento.nm_tabela%type, cd_tipo_lote_contabil_p ctb_documento.cd_tipo_lote_contabil%type, dt_inicial_p timestamp, dt_final_p timestamp, ie_tipo_execucao_p text, nm_usuario_p text) AS $body$
BEGIN

if (ie_tipo_execucao_p = 'A') then
	begin

	if (coalesce(nr_seq_doc_p,0) = 0 ) then
		begin
		CALL wheb_mensagem_pck.exibir_mensagem_abort(1031618, '');
		end;
	else
		begin

		update	movimento_contabil_doc
		set	nr_seq_ctb_documento	 = NULL,
			nm_usuario		= nm_usuario_p,
			dt_atualizacao		= clock_timestamp()
		where	nr_seq_ctb_documento	= nr_seq_doc_p;

		delete	from ctb_documento
		where	nr_sequencia	= nr_seq_doc_p;

		end;
	end if;

	end;
elsif (ie_tipo_execucao_p = 'T') then
	begin

	if (coalesce(nm_atributo_p, 'X') = 'X') then
		begin
		CALL wheb_mensagem_pck.exibir_mensagem_abort(1031621, '');
		null;
		end;
	else
		begin

		update	movimento_contabil_doc
		set	nr_seq_ctb_documento	 = NULL,
			nm_usuario		=	nm_usuario_p,
			dt_atualizacao		=	clock_timestamp()
		where	nr_seq_ctb_documento	in (	SELECT	nr_sequencia
								from	ctb_documento
								where	nm_atributo 		= nm_atributo_p
								and	nm_tabela		= nm_tabela_p
								and	cd_tipo_lote_contabil 	= cd_tipo_lote_contabil_p
								and 	dt_competencia between dt_inicial_p and dt_final_p);

		delete	from ctb_documento
		where	nm_atributo 		= nm_atributo_p
		and	nm_tabela		= nm_tabela_p
		and	cd_tipo_lote_contabil 	= cd_tipo_lote_contabil_p
		and 	dt_competencia between 	dt_inicial_p and dt_final_p;

		end;
	end if;

	end;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ctb_ignorar_lancamento_doc ( nr_seq_doc_p ctb_documento.nr_sequencia%type, nm_atributo_p ctb_documento.nm_atributo%type, nm_tabela_p ctb_documento.nm_tabela%type, cd_tipo_lote_contabil_p ctb_documento.cd_tipo_lote_contabil%type, dt_inicial_p timestamp, dt_final_p timestamp, ie_tipo_execucao_p text, nm_usuario_p text) FROM PUBLIC;

