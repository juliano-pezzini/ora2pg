-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consiste_fechar_saldo_caixa ( nr_sequencia_p bigint, ds_retorno_p INOUT text) AS $body$
DECLARE


IE_PERMITE_FECHAR_SALDO_W		varchar(2);
ds_retorno_w				varchar(255) := '';
count_w					smallint;

/*
1 - consite fechamento do caixa
*/
BEGIN

select	coalesce(a.IE_PERMITE_FECHAR_SALDO,'N')
into STRICT	IE_PERMITE_FECHAR_SALDO_W
from	caixa a,
	caixa_saldo_diario b
where   b.nr_seq_caixa = a.nr_sequencia
and	b.nr_sequencia = nr_sequencia_p;

if (coalesce(IE_PERMITE_FECHAR_SALDO_W,'N') = 'S') then

	select	count(*)
	into STRICT 	count_w
	from	caixa_saldo_diario a
	where	round((a.vl_saldo_inicial)::numeric,2)  	<	round((a.vl_saldo)::numeric,2)
	and	coalesce(a.dt_fechamento::text, '') = ''
	and 	a.nr_sequencia	=	nr_sequencia_p;

end if;

ds_retorno_p := count_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consiste_fechar_saldo_caixa ( nr_sequencia_p bigint, ds_retorno_p INOUT text) FROM PUBLIC;

