-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_alertas_anestesia ( CD_PESSOA_FISICA_P text, CD_PROFISSIONAL_P text, IE_TIPO_ALERTA_P text, NM_USUARIO_P text, DS_LISTA_P text) AS $body$
DECLARE


ds_lista_w 		varchar(10000) := '';
posicao_virgula_w 	integer := 0;
nr_max_loop_w 		integer := 10000;
nr_sequencia_w   	bigint := 0;
ds_observacao_w    varchar(2000);
tamanho_lista_w		bigint;

			

BEGIN
ds_lista_w := DS_LISTA_P;

while 	(ds_lista_w IS NOT NULL AND ds_lista_w::text <> '') and
	nr_max_loop_w > 0 loop
	begin
	tamanho_lista_w := length(ds_lista_w);
	posicao_virgula_w := position(',' in ds_lista_w);
	
	if (posicao_virgula_w > 1) and ((substr(ds_lista_w, 1, posicao_virgula_w - 1) IS NOT NULL AND (substr(ds_lista_w, 1, posicao_virgula_w - 1))::text <> '')) then
		begin
		nr_sequencia_w := (substr(ds_lista_w, 1, posicao_virgula_w -1))::numeric;
		ds_lista_w := substr(ds_lista_w, (posicao_virgula_w +1), tamanho_lista_w);
		end;
	elsif (ds_lista_w IS NOT NULL AND ds_lista_w::text <> '') then
		nr_sequencia_w := (replace(ds_lista_w, ',', ''))::numeric;
		ds_lista_w := '';
	end if;
	
	if (nr_sequencia_w IS NOT NULL AND nr_sequencia_w::text <> '') and (nr_sequencia_w > 0) then
		begin	
            if (IE_TIPO_ALERTA_P = '0') then
                Select ds_observacao
                into STRICT ds_observacao_w 
                from alerta_anestesia 
                where nr_sequencia  =  nr_sequencia_w;

                INSERT INTO ALERTA_ANESTESIA_APAE(NR_SEQUENCIA, CD_PESSOA_FISICA, CD_PROFISSIONAL, DT_ALERTA, DT_ATUALIZACAO, IE_TIPO_ALERTA, IE_SITUACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, NR_SEQ_ALERTA, DS_OBSERVACAO)
                VALUES (nextval('alerta_anestesia_apae_seq'), CD_PESSOA_FISICA_P, CD_PROFISSIONAL_P, clock_timestamp(), clock_timestamp(), coalesce(IE_TIPO_ALERTA_P, 0), 'A', NM_USUARIO_P, clock_timestamp(), NM_USUARIO_P, nr_sequencia_w, ds_observacao_w);
                commit;
            else
                INSERT INTO ALERTA_ANESTESIA_APAE(NR_SEQUENCIA, CD_PESSOA_FISICA, CD_PROFISSIONAL, DT_ALERTA, DT_ATUALIZACAO, IE_TIPO_ALERTA, IE_SITUACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, NR_SEQ_ALERTA, NR_SEQ_DIAG,DS_OBSERVACAO)
                VALUES (nextval('alerta_anestesia_apae_seq'), CD_PESSOA_FISICA_P, CD_PROFISSIONAL_P, clock_timestamp(), clock_timestamp(), coalesce(IE_TIPO_ALERTA_P, 0), 'A', NM_USUARIO_P, clock_timestamp(), NM_USUARIO_P, null, nr_sequencia_w, null);
                commit;
            end if;

		end;
	end if;
	nr_max_loop_w := nr_max_loop_w -1;
	end;
end loop;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_alertas_anestesia ( CD_PESSOA_FISICA_P text, CD_PROFISSIONAL_P text, IE_TIPO_ALERTA_P text, NM_USUARIO_P text, DS_LISTA_P text) FROM PUBLIC;

