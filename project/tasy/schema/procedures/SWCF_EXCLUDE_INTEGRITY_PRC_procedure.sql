-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE swcf_exclude_integrity_prc ( NR_SEQ_SMARTLINK_P swcf_smartlink_integrit.nr_seq_smartlink%type) AS $body$
BEGIN

    DELETE FROM swcf_smartlink_integrit ss where ss.nr_seq_smartlink = NR_SEQ_SMARTLINK_P AND ss.NR_SEQUENCIA IN (
        SELECT distinct e.nr_sequencia
        from integridade_referencial a, integridade_atributo b, Indice_Atributo c, indice d, swcf_smartlink_integrit e
        where a.nm_integridade_referencial = b.nm_integridade_referencial
        and b.ie_sequencia_criacao = c.nr_sequencia
        and d.nm_tabela     = a.nm_tabela_referencia
        and d.nm_indice     = c.nm_indice
        and d.nm_tabela     = c.nm_tabela
        and d.ie_tipo       = 'PK'
        and a.nm_tabela = e.nm_tabela
        and e.nr_seq_smartlink = NR_SEQ_SMARTLINK_P
        and a.nm_integridade_referencial in (SELECT ssi.nm_fk from swcf_smartlink_integrit ssi where ssi.nr_seq_smartlink = NR_SEQ_SMARTLINK_P)
        and e.ie_selecionado = 'S'
        and a.nm_integridade_referencial not in (
                select distinct a.nm_integridade_referencial
                from integridade_referencial a, integridade_atributo b, Indice_Atributo c, indice d, swcf_smartlink_columns e
                where a.nm_integridade_referencial = b.nm_integridade_referencial
                and b.ie_sequencia_criacao = c.nr_sequencia
                and d.nm_tabela     = a.nm_tabela_referencia
                and d.nm_indice     = c.nm_indice
                and d.nm_tabela     = c.nm_tabela
                and d.ie_tipo       = 'PK'
                and a.nm_tabela = e.table_name
                and e.nr_seq_smartlink = NR_SEQ_SMARTLINK_P
                and a.nm_tabela_referencia in ( select t.table_name from swcf_smartlink_columns t 
                                                where t.nr_seq_smartlink = NR_SEQ_SMARTLINK_P and t.table_name <> e.table_name)));
        COMMIT;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE swcf_exclude_integrity_prc ( NR_SEQ_SMARTLINK_P swcf_smartlink_integrit.nr_seq_smartlink%type) FROM PUBLIC;

