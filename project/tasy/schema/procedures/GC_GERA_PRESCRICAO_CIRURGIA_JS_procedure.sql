-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gc_gera_prescricao_cirurgia_js ( cd_medico_p text, cd_procedimento_p text, nr_seq_agenda_p bigint, nr_doc_interno_p bigint, nr_doc_interno_aux_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint, ie_origem_inf_p text ) AS $body$
DECLARE

 
nr_prescricao_w			bigint;
gerar_prescr_patologia_w	varchar(1);
ds_erro_w		varchar(255);


BEGIN 
 
gerar_prescr_patologia_w := obter_param_usuario(871, 405, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, gerar_prescr_patologia_w);
 
if (coalesce(cd_medico_p::text, '') = '') then 
	CALL Wheb_mensagem_pck.exibir_mensagem_abort(358458,'DS_ERRO='||ds_erro_w);
elsif (coalesce(cd_procedimento_p::text, '') = '') then 
	CALL Wheb_mensagem_pck.exibir_mensagem_abort(358451,'DS_ERRO='||ds_erro_w);
else 
	begin 
 
	nr_prescricao_w := gerar_prescricao_agenda(nr_seq_agenda_p, nm_usuario_p, nr_prescricao_w, cd_estabelecimento_p);
 
	exception 
	when others then 
	--(-20011, substr(obter_texto_tasy (52030, wheb_usuario_pck.get_nr_seq_idioma),1,255) || '#@#@'); 
	ds_erro_w	:= sqlerrm(SQLSTATE);
	CALL Wheb_mensagem_pck.exibir_mensagem_abort(52030,'DS_ERRO='||ds_erro_w);
	end;
 
	CALL gerar_proc_agenda_cirurgia(nr_seq_agenda_p,nr_prescricao_w,nm_usuario_p);
 
	CALL gerar_prescricao_cirurgia(0,0,0,nr_seq_agenda_p,ie_origem_inf_p,nm_usuario_p,nr_prescricao_w,nr_doc_interno_p,null,900,obter_perfil_ativo,null,nr_doc_interno_aux_p,null,null);
 
	if (gerar_prescr_patologia_w = 'S') then 
		begin 
 
		CALL gerar_prescr_patologia_cirur(nr_seq_agenda_p,nm_usuario_p,cd_estabelecimento_p);
 
		end;
	end if;
 
	commit;
end if;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gc_gera_prescricao_cirurgia_js ( cd_medico_p text, cd_procedimento_p text, nr_seq_agenda_p bigint, nr_doc_interno_p bigint, nr_doc_interno_aux_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint, ie_origem_inf_p text ) FROM PUBLIC;

