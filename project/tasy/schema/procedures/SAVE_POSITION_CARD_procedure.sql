-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE save_position_card ( nr_seq_card_p text, ds_hub_x_p bigint, ds_hub_y_p bigint, nm_usuario_nrec_p text, nr_seq_model_p bigint ) AS $body$
DECLARE


qtd_cards_w  bigint;
nr_seq_save_sorting_w bigint;


BEGIN

      select count(*)
        into STRICT qtd_cards_w
        from wp_save_sorting
       where nm_usuario = nm_usuario_nrec_p
         and nr_seq_card = nr_seq_card_p
	 and nr_seq_model = nr_seq_model_p;

    if (qtd_cards_w > 0 )then
      update wp_save_sorting
         set ds_hub_x = ds_hub_x_p , 
             ds_hub_y = ds_hub_y_p  
       where nm_usuario = nm_usuario_nrec_p
         and nr_seq_card  = nr_seq_card_p
	 and nr_seq_model = nr_seq_model_p;
    end if;

    if (qtd_cards_w = 0 ) then
	
     select nextval('wp_save_sorting_seq')
       into STRICT nr_seq_save_sorting_w
;
	
	   
      insert into wp_save_sorting(
          nr_sequencia,
          ds_hub_x, 
          ds_hub_y, 
          nr_seq_card, 
          dt_atualizacao,
          nm_usuario,
	  nr_seq_model
		
    ) values (
         nr_seq_save_sorting_w,
         ds_hub_x_p,
         ds_hub_y_p,
         nr_seq_card_p, 
         clock_timestamp(),
         nm_usuario_nrec_p,
	 nr_seq_model_p
    );
   end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE save_position_card ( nr_seq_card_p text, ds_hub_x_p bigint, ds_hub_y_p bigint, nm_usuario_nrec_p text, nr_seq_model_p bigint ) FROM PUBLIC;

