-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_conta_lp ( nr_atendimento_p bigint, nm_usuario_p text, dt_atualizacao_p timestamp) AS $body$
DECLARE


cd_proc_integracao_w 	parametro_faturamento.cd_proc_integracao%type;
ie_origem_proc_int_w 	parametro_faturamento.ie_origem_proc_int%type;
cd_convenio_partic_w 	parametro_faturamento.cd_convenio_partic%type;
cd_categoria_partic_w 	parametro_faturamento.cd_categoria_partic%type;
cd_setor_atendimento_w	atend_paciente_unidade.cd_setor_atendimento%type;
nr_seq_interno_w 		atend_paciente_unidade.nr_seq_interno%type;
nr_seq_proc_paciente_w  procedimento_paciente.nr_sequencia%type;
vl_procedimento_w 		integer;
vl_custo_operacional_w 	integer;
cd_estabelecimento_w 	atendimento_paciente.cd_estabelecimento%type;


BEGIN

	select cd_estabelecimento
	into STRICT cd_estabelecimento_w
	from atendimento_paciente
	where nr_atendimento = nr_atendimento_p;
	
	select 	CD_PROC_INTEGRACAO,
			IE_ORIGEM_PROC_INT,
			CD_CONVENIO_PARTIC,
			CD_CATEGORIA_PARTIC
	into STRICT 	cd_proc_integracao_w,
			ie_origem_proc_int_w,
			cd_convenio_partic_w,
			cd_categoria_partic_w
	from PARAMETRO_FATURAMENTO
	where cd_estabelecimento = cd_estabelecimento_w;

	vl_procedimento_w := 10;		--fixed value, waiting for Finnegans integration
	vl_custo_operacional_w := 10;	--fixed value, waiting for Finnegans integration
	cd_setor_atendimento_w := OBTER_SETOR_ATENDIMENTO(nr_atendimento_p);
	nr_seq_interno_w := OBTER_ATEPACU_PACIENTE(nr_atendimento_p, 'A');

	nr_seq_proc_paciente_w := INSERIR_PROCEDIMENTO_PACIENTE(	cd_proc_integracao_w, 1, null, null, ie_origem_proc_int_w, cd_setor_atendimento_w, nr_atendimento_p, cd_estabelecimento_w, nm_usuario_p, null, 'S', null, nr_seq_interno_w, clock_timestamp(), cd_convenio_partic_w, cd_categoria_partic_w, nr_seq_proc_paciente_w, null, null, vl_procedimento_w, vl_custo_operacional_w, null, null, null, null, 'gerar_conta_lp');
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_conta_lp ( nr_atendimento_p bigint, nm_usuario_p text, dt_atualizacao_p timestamp) FROM PUBLIC;

