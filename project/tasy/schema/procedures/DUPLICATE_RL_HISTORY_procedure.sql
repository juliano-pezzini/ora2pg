-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicate_rl_history ( nr_sequencia_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_seq_rl_rep_to_hosp_w         rl_history.nr_seq_rl_rep_to_hosp%type;
nr_seq_rl_ref_to_hosp_w         rl_history.nr_seq_rl_ref_to_hosp%type;
nr_seq_rl_ref_from_hosp_w       rl_history.nr_seq_rl_ref_from_hosp%type;
nr_seq_rl_rep_from_hosp_w       rl_history.nr_seq_rl_rep_from_hosp%type;


BEGIN

        begin
                SELECT
                    coalesce(nr_seq_rl_rep_to_hosp, 0),
                    coalesce(nr_seq_rl_ref_to_hosp, 0),
                    coalesce(nr_seq_rl_ref_from_hosp, 0),
                    coalesce(nr_seq_rl_rep_from_hosp, 0)
                INTO STRICT
                    nr_seq_rl_rep_to_hosp_w,
                    nr_seq_rl_ref_to_hosp_w,
                    nr_seq_rl_ref_from_hosp_w,
                    nr_seq_rl_rep_from_hosp_w
                FROM
                    rl_history
                WHERE
                    nr_sequencia = nr_sequencia_p;
                exception
                   when no_data_found or too_many_rows then
                        nr_seq_rl_rep_to_hosp_w := 0;
                        nr_seq_rl_ref_to_hosp_w := 0;
                        nr_seq_rl_ref_from_hosp_w := 0;
                        nr_seq_rl_rep_from_hosp_w := 0;
        end;

    IF ( nr_seq_rl_rep_to_hosp_w != 0 ) THEN
        INSERT
            INTO rl_rep_to_hospital(
                nr_sequencia,
                dt_atualizacao,
                nm_usuario,
                dt_atualizacao_nrec,
                nm_usuario_nrec,
                nr_atendimento,
                ie_document_type,
                dt_reference,
                cd_referred_department,
                cd_postal,
                nr_seq_response_classif,
                cd_medical_institution,
                cd_medical_department,
                cd_referring_doctor,
                nr_ddi_phone,
                nr_ddd_phone,
                nr_phone,
                nr_ddi_fax,
                nr_ddd_fax,
                nr_fax,
                ds_address,
                nr_seq_calculation_type,
                dt_calculation_type,
                ie_delivery_type,
                ie_document_attachment,
                dt_liberacao,
                cd_evolucao,
                cd_setor_atendimento,
                ds_information,
                nr_seq_med_gui,
                nm_referring_doctor,
                ds_medical_dept

        )

        SELECT
            nextval('rl_rep_to_hospital_seq'),
            clock_timestamp(),
            nm_usuario,
            clock_timestamp(),
            nm_usuario_nrec,
            nr_atendimento,
            ie_document_type,
            dt_reference,
            cd_referred_department,
            cd_postal,
            nr_seq_response_classif,
            cd_medical_institution,
            cd_medical_department,
            cd_referring_doctor,
            nr_ddi_phone,
            nr_ddd_phone,
            nr_phone,
            nr_ddi_fax,
            nr_ddd_fax,
            nr_fax,
            ds_address,
            nr_seq_calculation_type,
            dt_calculation_type,
            ie_delivery_type,
            ie_document_attachment,
            NULL,
            cd_evolucao,
            cd_setor_atendimento,
            ds_information,
            nr_seq_med_gui,
            nm_referring_doctor,
            ds_medical_dept
        FROM
            rl_rep_to_hospital
        WHERE
            nr_sequencia = nr_seq_rl_rep_to_hosp_w;
    END IF;

        IF ( nr_seq_rl_ref_to_hosp_w != 0 ) THEN
        INSERT
            INTO rl_ref_to_hospital(
           nr_sequencia,
            dt_atualizacao,
            nm_usuario,
            dt_atualizacao_nrec,
            nm_usuario_nrec,
            nr_atendimento,
            ie_document_type,
            dt_reference,
            cd_referred_department,
            nr_seq_reason_ref,
            nr_seq_grounds_ref,
            cd_medical_institution,
            cd_medical_department,
            cd_referring_doctor,
            nr_ddi_phone,
            nr_ddd_phone,
            nr_phone,
            cd_postal,
            nr_ddi_fax,
            nr_ddd_fax,
            nr_fax,
            ds_address,
            nr_seq_calculation_type,
            dt_calculation_type,
            dt_liberacao,
            cd_evolucao,
            cd_setor_atendimento,
            ds_information,
            nr_seq_med_gui,
            cd_referred_physician,
            nm_referred_physician,
            ds_medical_dept

        )

        SELECT
            nextval('rl_ref_to_hospital_seq'),
            clock_timestamp(),
            nm_usuario,
            clock_timestamp(),
            nm_usuario_nrec,
            nr_atendimento,
            ie_document_type,
            dt_reference,
            cd_referred_department,
            nr_seq_reason_ref,
            nr_seq_grounds_ref,
            cd_medical_institution,
            cd_medical_department,
            cd_referring_doctor,
            nr_ddi_phone,
            nr_ddd_phone,
            nr_phone,
            cd_postal,
            nr_ddi_fax,
            nr_ddd_fax,
            nr_fax,
            ds_address,
            nr_seq_calculation_type,
            dt_calculation_type,
            NULL,
            cd_evolucao,
            cd_setor_atendimento,
            ds_information,
            nr_seq_med_gui,
            cd_referred_physician,
            nm_referred_physician,
            ds_medical_dept
        FROM
            rl_ref_to_hospital
        WHERE
            nr_sequencia = nr_seq_rl_ref_to_hosp_w;
    END IF;

        IF ( nr_seq_rl_ref_from_hosp_w != 0 ) THEN
        INSERT
            INTO rl_ref_from_hospital(
            nr_sequencia,
            dt_atualizacao,
            nm_usuario,
            dt_atualizacao_nrec,
            nm_usuario_nrec,
            dt_reference,
            cd_referred_department,
            cd_referred_doctor,
            cd_medical_institution,
            cd_medical_department,
            cd_referring_doctor,
            cd_postal,
            ds_address,
            nr_ddi_phone,
            nr_ddd_phone,
            nr_phone,
            nr_ddi_fax,
            nr_ddd_fax,
            nr_fax,
            nr_seq_calculation_type,
            dt_calculation_type,
            dt_liberacao,
            nr_atendimento,
            cd_evolucao,
            cd_setor_atendimento,
            ds_information,
            nr_seq_med_gui,
            ds_medical_dept,
            nm_referring_doctor

        )

        SELECT
            nextval('rl_ref_from_hospital_seq'),
            clock_timestamp(),
            nm_usuario,
            clock_timestamp(),
            nm_usuario_nrec,
            dt_reference,
            cd_referred_department,
            cd_referred_doctor,
            cd_medical_institution,
            cd_medical_department,
            cd_referring_doctor,
            cd_postal,
            ds_address,
            nr_ddi_phone,
            nr_ddd_phone,
            nr_phone,
            nr_ddi_fax,
            nr_ddd_fax,
            nr_fax,
            nr_seq_calculation_type,
            dt_calculation_type,
            NULL,
            nr_atendimento,
            cd_evolucao,
            cd_setor_atendimento,
            ds_information,
            nr_seq_med_gui,
            ds_medical_dept,
            nm_referring_doctor
        FROM
            rl_ref_from_hospital
        WHERE
            nr_sequencia = nr_seq_rl_ref_from_hosp_w;
    END IF;

        IF ( nr_seq_rl_rep_from_hosp_w != 0 ) THEN
        INSERT
            INTO rl_rep_from_hospital(
            nr_sequencia,
            dt_atualizacao,
            nm_usuario,
            dt_atualizacao_nrec,
            nm_usuario_nrec,
            nr_atendimento,
            dt_reception,
            cd_referred_department,
            cd_referred_doctor,
            cd_medical_institution,
            cd_medical_department,
            cd_referring_doctor,
            cd_postal,
            ds_address,
            nr_ddi_phone,
            nr_ddd_phone,
            nr_phone,
            nr_ddi_fax,
            nr_ddd_fax,
            nr_fax,
            dt_liberacao,
            cd_evolucao,
            cd_setor_atendimento,
            ds_information,
            nm_referred_doctor,
            ds_medical_dept
        )

        SELECT
            nextval('rl_rep_from_hospital_seq'),
            clock_timestamp(),
            nm_usuario,
            clock_timestamp(),
            nm_usuario_nrec,
            nr_atendimento,
            dt_reception,
            cd_referred_department,
            cd_referred_doctor,
            cd_medical_institution,
            cd_medical_department,
            cd_referring_doctor,
            cd_postal,
            ds_address,
            nr_ddi_phone,
            nr_ddd_phone,
            nr_phone,
            nr_ddi_fax,
            nr_ddd_fax,
            nr_fax,
            NULL,
            cd_evolucao,
            cd_setor_atendimento,
            ds_information,
            nm_referred_doctor,
            ds_medical_dept
        FROM
            rl_rep_from_hospital
        WHERE
            nr_sequencia = nr_seq_rl_rep_from_hosp_w;
    END IF;

	commit;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicate_rl_history ( nr_sequencia_p bigint, nm_usuario_p text) FROM PUBLIC;

