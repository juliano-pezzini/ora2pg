-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_pag_banco_brasil_240_v08 (nr_seq_envio_p bigint, cd_estabelecimento_p text, nm_usuario_p text) AS $body$
DECLARE

 
/*Header do Arquivo*/
 
nr_seq_registro_w		varchar(10) := 0;
ds_conteudo_w			varchar(240);
nr_seq_arquivo_w		bigint	:= 0;
nr_inscricao_w			varchar(14);
cd_convenio_banco_w		varchar(20);
cd_agencia_w			varchar(5);
cd_conta_w			varchar(12);
nr_digito_conta_w		varchar(1);	
nm_empresa_w			varchar(30);
ds_banco_w			varchar(30);
dt_arquivo_w			varchar(8);
hr_arquivo_w			varchar(6);
nm_pessoa_w			varchar(30);

/*Header do Lote*/
 
ie_forma_lancamento_w		varchar(2);
nr_inscricao_lote_w		varchar(14);
ds_endereco_w			varchar(30);
nr_endereco_w			varchar(5);
ds_complemento_w		varchar(15);
ds_cidade_w			varchar(20);
cd_cep_w			varchar(8);
sg_estado_w			varchar(15);	
ds_ocorrencia_w			varchar(10);
nr_lote_w			varchar(4)	:= 0;
nr_seq_lote_a_w			varchar(5)	:= 0;

/*Detalhe Documento - Segmento A*/
 
cd_compensacao_w		varchar(3);
cd_banco_favorecido_w		varchar(3);	
cd_agencia_favorecido_w		varchar(5);
ie_digito_agencia_w		varchar(1);
nr_conta_favorecido_w		varchar(12);	
nr_digito_agencia_w		varchar(1);
nm_favorecido_w			varchar(30);
nr_documento_w			varchar(20);
dt_pagamento_w			varchar(8);
vl_pagamento_w			varchar(15);
nr_documento_banco_w		varchar(20);
dt_real_pagamento_w		varchar(8);
vl_real_pagamento_w		varchar(15);
cd_tipo_movimento_w		varchar(1);
--cd_finalidade_w			varchar2(2); 
vl_pagamento_number_w		double precision;

/*Detalhe Documento - Segmento B*/
 
ie_tipo_favorecido_w		varchar(1);	
cd_favorecido_w			varchar(14);
ds_bairro_w			varchar(15);
cd_cep_b_w			varchar(8);						
dt_vencimento_w			varchar(8);
vl_documento_w			varchar(15);
vl_liquidacao_w			varchar(15);
vl_acrescimo_w			varchar(15);
vl_desconto_w			varchar(15);
vl_multa_w			varchar(15);
nr_seq_lote_b_w			varchar(5)	:= 1;
qt_cursor_w			smallint 	:= 0;
vl_documento_number_w		double precision;

/*Trailer do Lote*/
 
nr_titulo_w			bigint;
vl_detalhes_w			double precision	:= 0;
vl_total_detalhes_w		double precision	:= 0;	
 
/*Trailer do Arquivo*/
 
qt_registros_lote_w		bigint	:= 0;
qt_registros_total_w		bigint	:= 0;

/*Brancos*/
 
ds_brancos_9_w			varchar(9);
ds_brancos_19_w			varchar(19);
ds_brancos_20_w			varchar(20);
ds_brancos_40_w			varchar(40);	
ds_brancos_8_w			varchar(8);	
ds_brancos_10_w			varchar(10);	
ds_brancos_3_w			varchar(3);
ds_brancos_11_w			varchar(11);
ds_brancos_211_w		varchar(211);	
ds_brancos_165_w		varchar(165);
ds_brancos_54_w			varchar(54);
ds_brancos_2_w			varchar(2);
ds_brancos_15_w			varchar(15);
ds_brancos_12_w			varchar(12);
ds_brancos_6_w			varchar(6);
nr_sequencia_w			bigint;
cd_banco_w			varchar(5);

/*Detalhe Documento - Segmento A*/
 
C02 CURSOR FOR	 
	SELECT	d.nr_titulo nr_titulo, 
		lpad(CASE WHEN coalesce(c.ie_tipo_pagamento::text, '') = '' THEN cd_camara_compensacao WHEN c.ie_tipo_pagamento='DOC' THEN 700  ELSE 18 END ,3,' ')	cd_compensacao, 
		lpad(coalesce(d.cd_banco_favorecido,'0'),3,'0') cd_banco_favorecido, 
		lpad(coalesce(d.cd_agencia_favorecido,'0'),5,'0') cd_agencia_favorecido, 
		coalesce(substr(c.ie_digito_agencia,1,1),'0') ie_digito_agencia, 
		lpad(coalesce(d.nr_conta_favorecido,'0'),12,'0') nr_conta_favorecido, 
		coalesce(substr(c.ie_digito_conta,1,1),'0') nr_digito_conta, 
		coalesce(substr(c.ie_digito_agencia,1,1),'0') nr_digito_agencia, 
		rpad(upper(substr(coalesce(d.nm_favorecido,' '),1,30)),30,' ') nm_favorecido, 
		lpad(coalesce(d.nr_titulo,'0'),20,'0') nr_documento, 
		to_char(clock_timestamp(), 'DDMMYYYY') dt_pagamento, 
		replace(to_char(coalesce((c.vl_escritural + c.vl_acrescimo - c.vl_desconto + coalesce(c.vl_juros,0) + coalesce(c.vl_multa,0)),0), 'fm0000000000000.00'),'.','') vl_pagamento, 
		lpad(coalesce(d.nr_documento,'0'),20,'0') nr_documento_banco, 
		to_char(clock_timestamp(), 'DDMMYYYY') dt_real_pagamento, 
		replace(to_char(coalesce((c.vl_escritural + c.vl_acrescimo - c.vl_desconto + coalesce(c.vl_juros,0) + coalesce(c.vl_multa,0)),0), 'fm0000000000000.00'),'.','') vl_real_pagamento, 
		lpad(coalesce(CASE WHEN coalesce(c.cd_ocorrencia_ret::text, '') = '' THEN '0' WHEN c.cd_ocorrencia_ret=01 THEN '0' WHEN c.cd_ocorrencia_ret=02 THEN '5' WHEN c.cd_ocorrencia_ret=03 THEN '9' END ,'0'),1,'0') cd_tipo_movimento, 
		--lpad(nvl(decode(c.ie_tipo_pagamento,null,decode(c.ie_tipo_servico,null,'00','00010', '04','00020', '07', 
		--									'00030', '06'),'CC','01'),'00'),2,' ') cd_finalidade, 
		(c.vl_escritural + c.vl_acrescimo - c.vl_desconto + coalesce(c.vl_juros,0) + coalesce(c.vl_multa,0))	vl_pagamento_number 
	from	estabelecimento e, 
		banco_estabelecimento_v b, 
		banco_escritural a, 
		titulo_pagar_v2 d, 
		titulo_pagar_escrit c 
	where	c.nr_titulo		= d.nr_titulo 
	and	a.nr_sequencia		= c.nr_seq_escrit 
	and	a.cd_estabelecimento	= e.cd_estabelecimento 
	and	b.nr_sequencia		= a.nr_seq_conta_banco 
	and	a.nr_sequencia		= nr_seq_envio_p;
	
/*Detalhe Documento - Segmento B*/
 
C03 CURSOR FOR		 
	SELECT	coalesce(d.ie_tipo_favorecido,'0') ie_tipo_favorecido, 
		lpad(coalesce(d.cd_favorecido, ' '),14, '0') cd_favorecido, 
		rpad(upper(coalesce(substr(d.ds_endereco,1,30),' ')),30, ' ') ds_endereco, 
		rpad(coalesce(d.nr_endereco,'0'),5,' ') nr_endereco, 
		rpad(upper(coalesce(substr(d.ds_bairro,1,15),' ')),15,' ') ds_bairro, 
		rpad(upper(coalesce(substr(d.ds_cidade,1,20),' ')),20,' ') ds_cidade, 
		lpad(coalesce(d.cd_cep, ' '),8,' ') cd_cep, 
		coalesce(d.ds_estado,' ') sg_estado, 
		to_char(coalesce(d.dt_vencimento_atual,clock_timestamp()),'DDMMYYYY') dt_vencimento, 
		replace(to_char(coalesce(d.vl_saldo_titulo,0), 'fm0000000000000.00'),'.','')	vl_documento, 
		replace(to_char(coalesce(c.vl_liquidacao,0), 'fm0000000000000.00'),'.','') vl_liquidacao, 
		replace(to_char(coalesce(c.vl_acrescimo,0), 'fm0000000000000.00'),'.','') vl_acrescimo, 
		replace(to_char(coalesce(c.vl_desconto,0), 'fm0000000000000.00'),'.','') vl_desconto, 
		replace(to_char(coalesce(c.vl_multa,0), 'fm0000000000000.00'),'.','') vl_multa, 
		d.vl_saldo_titulo vl_documento_number 
	from	estabelecimento e, 
		banco_estabelecimento_v b, 
		banco_escritural a, 
		titulo_pagar_v2 d, 
		titulo_pagar_escrit c 
	where	c.nr_titulo		= d.nr_titulo 
	and	a.nr_sequencia		= c.nr_seq_escrit 
	and	a.cd_estabelecimento	= e.cd_estabelecimento 
	and	b.nr_sequencia		= a.nr_seq_conta_banco 
	and (c.ie_tipo_pagamento 	= 'DOC' or c.ie_tipo_pagamento = 'TED') 
	and	a.nr_sequencia		= nr_seq_envio_p 
	and	c.nr_titulo		= nr_titulo_w;	
 

BEGIN 
delete from w_envio_banco 
where nm_usuario = nm_usuario_p;
 
select	lpad(' ',9,' '), 
	lpad(' ',19,' '), 
	lpad(' ',20,' '), 
	lpad(' ',40,' '), 
	lpad(' ',8,' '), 
	lpad(' ',10,' '), 
	lpad(' ',3,' '), 
	lpad(' ',11,' '), 
	lpad(' ',211,' '), 
	lpad(' ',165,' '), 
	lpad(' ',54,' '), 
	lpad(' ',2,' '), 
	lpad(' ',15,' '), 
	lpad(' ',12,' '), 
	lpad(' ',6,' ') 
into STRICT	ds_brancos_9_w, 
	ds_brancos_19_w, 
	ds_brancos_20_w, 
	ds_brancos_40_w, 
	ds_brancos_8_w, 
	ds_brancos_10_w, 
	ds_brancos_3_w, 
	ds_brancos_11_w, 
	ds_brancos_211_w, 
	ds_brancos_165_w, 
	ds_brancos_54_w, 
	ds_brancos_2_w, 
	ds_brancos_15_w, 
	ds_brancos_12_w, 
	ds_brancos_6_w
;
 
/*Header do Arquivo*/
 
select	lpad(coalesce(a.cd_cgc,'0'),14,'0') nr_inscricao, 
	lpad(g.cd_convenio_banco,20,'0') cd_convenio_banco, 
	lpad(somente_numero(coalesce(g.cd_agencia_bancaria,0)),5,'0') cd_agencia, 
	lpad(coalesce(g.cd_conta,'0'),12,'0') cd_conta, 
	coalesce(substr(g.ie_digito_conta,1,1),' ') nr_digito_conta, 
	rpad(coalesce(substr(upper(p.ds_razao_social),1,30),' '),30,' ') nm_empresa, 
	rpad(coalesce(substr(upper(g.ds_banco),1,30),' '),30,' ')	ds_banco, 
	to_char(clock_timestamp(),'DDMMYYYY') dt_arquivo, 
	to_char(clock_timestamp(),'HH24MISS') hr_arquivo, 
	e.cd_banco 
into STRICT	nr_inscricao_w, 
	cd_convenio_banco_w, 
	cd_agencia_w, 
	cd_conta_w, 
	nr_digito_conta_w, 
	nm_empresa_w, 
	ds_banco_w, 
	dt_arquivo_w, 
	hr_arquivo_w, 
	cd_banco_w 
from	estabelecimento a, 
	banco_estabelecimento_v g, 
	pessoa_juridica p, 
	banco_escritural e 
where	e.cd_estabelecimento  	= a.cd_estabelecimento 
and	a.cd_cgc		= p.cd_cgc 
and	g.nr_sequencia		= e.nr_seq_conta_banco 
and	e.nr_sequencia		= nr_seq_envio_p;
 
select	nextval('w_envio_banco_seq') 
into STRICT	nr_sequencia_w
;
 
nr_seq_arquivo_w := nr_seq_arquivo_w + 1;
 
ds_conteudo_w :=	lpad(cd_banco_w,3,'0') || '0000' || '0' || ds_brancos_9_w || '2' || nr_inscricao_w || cd_convenio_banco_w || 
			cd_agencia_w || '2' || cd_conta_w || nr_digito_conta_w || ' ' || nm_empresa_w || ds_banco_w || ds_brancos_10_w || '1' || 
			dt_arquivo_w || hr_arquivo_w || lpad(nr_seq_arquivo_w,6,'0') || '084' || '00000' || ds_brancos_54_w || '  ' || 
			ds_brancos_12_w;
 
insert into w_envio_banco(	nr_sequencia, 
		dt_atualizacao, 
		nm_usuario, 
		dt_atualizacao_nrec, 
		nm_usuario_nrec, 
		cd_estabelecimento, 
		ds_conteudo, 
		nr_seq_apres) 
values (	nr_sequencia_w, 
		clock_timestamp(), 
		nm_usuario_p, 
		clock_timestamp(), 
		nm_usuario_p, 
		cd_estabelecimento_p, 
		ds_conteudo_w, 
		1);
 
qt_registros_total_w := qt_registros_total_w + 1;			
/*Fim - Header do Arquivo*/
 
 
/*Header do Lote*/
 
select	'01' ie_forma_lancamento, 
	lpad(coalesce(e.cd_cgc,'0'),14,'0') nr_inscricao, 
	lpad(b.cd_convenio_banco,20,'0') cd_convenio_banco, 
	lpad(somente_numero(coalesce(b.cd_agencia_bancaria,0)),5,'0') cd_agencia, 
	lpad((coalesce(b.cd_conta,0))::numeric ,12,'0') cd_conta, 
	coalesce(substr(b.ie_digito_conta,1,1),' ') nr_digito_conta, 
	rpad(coalesce(substr(upper(j.ds_razao_social),1,30),' '),30,' ') nm_empresa, 
	rpad(coalesce(substr(upper(j.ds_endereco),1,30),' '),30,' ') ds_endereco, 
	lpad(coalesce(substr(j.nr_endereco,1,5),' '),5,'0') nr_endereco, 
	rpad(coalesce(substr(j.ds_complemento,1,15), ' '),15,' ') ds_complemento, 
	rpad(coalesce(substr(j.ds_municipio,1,20), ' '),20,' ') ds_cidade, 
	rpad(coalesce(substr(somente_numero(j.cd_cep),1,8),' '),8,' ') cd_cep, 
	coalesce(j.sg_estado,' ') sg_estado 
into STRICT	ie_forma_lancamento_w, 
	nr_inscricao_lote_w, 
	cd_convenio_banco_w, 
	cd_agencia_w, 
	cd_conta_w, 
	nr_digito_conta_w, 
	nm_empresa_w, 
	ds_endereco_w, 
	nr_endereco_w, 
	ds_complemento_w, 
	ds_cidade_w, 
	cd_cep_w, 
	sg_estado_w 
from	pessoa_juridica j, 
	estabelecimento e, 
	banco_estabelecimento_v b, 
	banco_escritural a 
where	e.cd_cgc		= j.cd_cgc 
and	a.cd_estabelecimento  = e.cd_estabelecimento 
and	b.nr_sequencia		= a.nr_seq_conta_banco 
and	a.nr_sequencia		= nr_seq_envio_p;
 
select	nextval('w_envio_banco_seq') 
into STRICT	nr_sequencia_w
;
 
nr_lote_w := nr_lote_w + 1;
 
ds_conteudo_w :=	lpad(cd_banco_w,3,'0') || lpad(nr_lote_w,4,'0') || '1' || 'C' || '20'|| '01' || '043' || ' ' || '2' || 
			nr_inscricao_lote_w || cd_convenio_banco_w || cd_agencia_w || '2' || cd_conta_w || nr_digito_conta_w || ' ' || 
			nm_empresa_w || ds_brancos_40_w || ds_endereco_w || nr_endereco_w || ds_complemento_w || ds_cidade_w || cd_cep_w || 
			substr(sg_estado_w,1,2) || ds_brancos_8_w || ds_brancos_10_w;
 
insert into w_envio_banco(	nr_sequencia, 
		dt_atualizacao, 
		nm_usuario, 
		dt_atualizacao_nrec, 
		nm_usuario_nrec, 
		cd_estabelecimento, 
		ds_conteudo, 
		nr_seq_apres) 
values (	nr_sequencia_w, 
		clock_timestamp(), 
		nm_usuario_p, 
		clock_timestamp(), 
		nm_usuario_p, 
		cd_estabelecimento_p, 
		ds_conteudo_w, 
		2);	
		 
qt_registros_total_w 	:= qt_registros_total_w + 1;
qt_registros_lote_w 	:= qt_registros_lote_w + 1;		
/*Fim - Header do Lote*/
 
 
vl_total_detalhes_w := 0;
vl_pagamento_number_w := 0;
vl_detalhes_w := 0;
 
/*Detalhe Documento - Segmento A*/
 
open C02;
loop 
fetch C02 into	 
	nr_titulo_w, 
	cd_compensacao_w, 
	cd_banco_favorecido_w, 
	cd_agencia_favorecido_w, 
	ie_digito_agencia_w, 
	nr_conta_favorecido_w, 
	nr_digito_conta_w, 
	nr_digito_agencia_w, 
	nm_favorecido_w, 
	nr_documento_w, 
	dt_pagamento_w, 
	vl_pagamento_w, 
	nr_documento_banco_w, 
	dt_real_pagamento_w, 
	vl_real_pagamento_w, 
	cd_tipo_movimento_w, 
	--cd_finalidade_w, 
	vl_pagamento_number_w;
EXIT WHEN NOT FOUND; /* apply on C02 */
	begin 
	vl_detalhes_w	:= vl_detalhes_w + vl_pagamento_number_w;
	vl_total_detalhes_w	:= vl_total_detalhes_w + vl_pagamento_number_w;
	 
	nr_seq_registro_w := nr_seq_registro_w + 1;
	nr_seq_lote_a_w := nr_seq_lote_a_w + 1;
	 
	ds_conteudo_w :=	lpad(cd_banco_w,3,'0') || lpad(nr_seq_lote_a_w,4,'0') || '3' || lpad(nr_seq_registro_w,5,'0') || 'A' || '0' 
				|| '00' ||'000' || cd_banco_favorecido_w || cd_agencia_favorecido_w || ie_digito_agencia_w || 
				nr_conta_favorecido_w || nr_digito_conta_w || ' ' || nm_favorecido_w || lpad(nr_titulo_w,20,' ') || 
				dt_real_pagamento_w || 'BRL' || '000000000000000' || 
				rpad(replace(to_char(coalesce(vl_pagamento_number_w,'0'), 'fm0000000000000.00'),'.',''),15,'0') || 
				'00000000000000000000' || '00000000' || '000000000000000' || ds_brancos_40_w || ds_brancos_2_w || ds_brancos_10_w || 
				'0' || ds_brancos_10_w;
				 
	select	nextval('w_envio_banco_seq') 
	into STRICT	nr_sequencia_w 
	;
	 
	insert into w_envio_banco(	nr_sequencia, 
			dt_atualizacao, 
			nm_usuario, 
			dt_atualizacao_nrec, 
			nm_usuario_nrec, 
			cd_estabelecimento, 
			ds_conteudo, 
			nr_seq_apres) 
	values (	nr_sequencia_w, 
			clock_timestamp(), 
			nm_usuario_p, 
			clock_timestamp(), 
			nm_usuario_p, 
			cd_estabelecimento_p, 
			ds_conteudo_w, 
			3);
	 
	qt_registros_lote_w	:= qt_registros_lote_w + 1;
	qt_registros_total_w 	:= qt_registros_total_w + 1;
	 
	/*Detalhe Documento - Segmento B*/
 
	open C03;
	loop 
	fetch C03 into	 
		ie_tipo_favorecido_w, 
		cd_favorecido_w, 
		ds_endereco_w, 
		nr_endereco_w, 
		ds_bairro_w, 
		ds_cidade_w, 
		cd_cep_b_w, 
		sg_estado_w, 
		dt_vencimento_w, 
		vl_documento_w, 
		vl_liquidacao_w, 
		vl_acrescimo_w, 
		vl_desconto_w, 
		vl_multa_w, 
		vl_documento_number_w;
	EXIT WHEN NOT FOUND; /* apply on C03 */
		begin 
		vl_total_detalhes_w	:= vl_total_detalhes_w + vl_documento_number_w;
		 
		select	nextval('w_envio_banco_seq') 
		into STRICT	nr_sequencia_w 
		;
		 
		qt_cursor_w := qt_cursor_w + 1;
		if (qt_cursor_w > 3) then 
			qt_cursor_w := 1;
		end if;
		 
		if (nr_seq_lote_b_w = nr_seq_lote_a_w) and (qt_cursor_w = nr_seq_lote_a_w) then 
			 
			nr_seq_registro_w := nr_seq_registro_w + 1;
			 
			ds_conteudo_w :=	lpad(cd_banco_w,3,'0') || lpad(nr_seq_lote_a_w,4,'0') || '3' || lpad(nr_seq_registro_w,5,'0') || 
						'B' || ds_brancos_3_w || ie_tipo_favorecido_w || cd_favorecido_w || ds_endereco_w || 
						nr_endereco_w ||ds_brancos_15_w || ds_bairro_w || ds_cidade_w || cd_cep_b_w || substr(sg_estado_w,1,2) || 
						dt_vencimento_w ||vl_documento_w || vl_liquidacao_w || vl_desconto_w || vl_acrescimo_w || 
						vl_multa_w ||lpad(cd_favorecido_w,15,' ') || ' ' || '000000' || ds_brancos_8_w;
			 
			insert into w_envio_banco(nr_sequencia, 
				dt_atualizacao, 
				nm_usuario, 
				dt_atualizacao_nrec, 
				nm_usuario_nrec, 
				cd_estabelecimento, 
				ds_conteudo, 
				nr_seq_apres) 
			values (nr_sequencia_w, 
				clock_timestamp(), 
				nm_usuario_p, 
				clock_timestamp(), 
				nm_usuario_p, 
				cd_estabelecimento_p, 
				ds_conteudo_w, 
				4);
			 
			 
			qt_registros_total_w 	:= qt_registros_total_w + 1;
			nr_seq_lote_b_w := nr_seq_lote_b_w + 1;
		end if;
		end;
	end loop;
	close C03;
	/*Fim - Detalhe Documento - Segmento B*/
 
	end;
end loop;
close C02;
/*Fim - Detalhe Documento - Segmento A*/
 
 
 
 
/*Trailler do Lote*/
	 
select	nextval('w_envio_banco_seq') 
into STRICT	nr_sequencia_w
;
 
qt_registros_lote_w	:= qt_registros_lote_w + 1;
qt_registros_total_w := qt_registros_total_w + 1;
 
ds_conteudo_w := 	lpad(cd_banco_w,3,'0') || lpad(nr_lote_w,4, '0') || '5' || ds_brancos_9_w || lpad(qt_registros_lote_w,6,'0') || 
			replace(to_char(coalesce(vl_total_detalhes_w,0), 'fm0000000000000000.00'),'.','') || 
			replace(to_char(coalesce(vl_detalhes_w,0), 'fm0000000000000.00000'),'.','') || ds_brancos_6_w || ds_brancos_165_w || 
			ds_brancos_10_w;
 
insert into w_envio_banco(nr_sequencia, 
	dt_atualizacao, 
	nm_usuario, 
	dt_atualizacao_nrec, 
	nm_usuario_nrec, 
	cd_estabelecimento, 
	ds_conteudo, 
	nr_seq_apres) 
values (nr_sequencia_w, 
	clock_timestamp(), 
	nm_usuario_p, 
	clock_timestamp(), 
	nm_usuario_p, 
	cd_estabelecimento_p, 
	ds_conteudo_w, 
	5);	
/*Fim - Trailler do Lote*/
	 
 
/*Trailer do Arquivo*/
 
select	nextval('w_envio_banco_seq') 
into STRICT	nr_sequencia_w
;
		 
		 
qt_registros_total_w := qt_registros_total_w + 1;
 
ds_conteudo_w := 	lpad(cd_banco_w,3,'0') || '9999' || '9' || ds_brancos_9_w || '000001' || lpad(qt_registros_total_w,6,'0') || 
			ds_brancos_211_w;
		 
insert into w_envio_banco(	nr_sequencia, 
		dt_atualizacao, 
		nm_usuario, 
		dt_atualizacao_nrec, 
		nm_usuario_nrec, 
		cd_estabelecimento, 
		ds_conteudo, 
		nr_seq_apres) 
values (	nr_sequencia_w, 
		clock_timestamp(), 
		nm_usuario_p, 
		clock_timestamp(), 
		nm_usuario_p, 
		cd_estabelecimento_p, 
		ds_conteudo_w, 
		9);
/*Fim - Trailer do Arquivo*/
		 
  
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_pag_banco_brasil_240_v08 (nr_seq_envio_p bigint, cd_estabelecimento_p text, nm_usuario_p text) FROM PUBLIC;

