-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consulta_dados_proc_rot ( nr_sequencia_p bigint, ie_contraste_p INOUT text, ie_ctrl_glic_p INOUT text, ie_exige_condicao_p INOUT text, ie_exige_indicacao_p INOUT text, ie_exige_justificativa_p INOUT text, ie_frase_p INOUT text, ie_intervalo_p INOUT text, ie_lado_p INOUT text, ie_medico_exec_p INOUT text, ie_observacao_p INOUT text, ie_orientacao_p INOUT text, ie_outro_exame_p INOUT text, ie_questionar_forma_p INOUT text, ie_questionar_resumo_p INOUT text, ie_rotina_uti_p INOUT text, ie_setor_p INOUT text, ie_tela_unica_p INOUT text, ie_topografia_p INOUT text, ie_tipo_p INOUT bigint, cd_procedimento_p INOUT bigint, ie_origem_proced_p INOUT bigint, cd_especialidade_p INOUT text, cd_grupo_p INOUT text, cd_area_p INOUT text, nr_seq_exame_p INOUT bigint, nr_seq_proc_interno_p INOUT bigint, cd_intervalo_p INOUT text, ie_questiona_agora_p INOUT text, cd_kit_material_p INOUT bigint, nr_seq_contraste_p INOUT bigint, nr_seq_rotina_p INOUT bigint, nr_seq_prot_glic_p INOUT bigint, cd_material_exame_p INOUT text, ie_material_especial_p INOUT text, ie_mat_especial_p INOUT text, ds_cor_p INOUT text) AS $body$
DECLARE


ie_tipo_w				bigint;
nr_seq_proc_rotina_w	bigint;
cd_procedimento_w		bigint;
ie_origem_proced_w		bigint;
cd_especialidade_w		varchar(15);
cd_grupo_w				varchar(15);
cd_area_w				varchar(15);
nr_seq_proc_interno_w	bigint;
nr_seq_exame_w			bigint;
qt_w					bigint;
ie_mat_especial_w		varchar(1);
cd_material_exame_w		varchar(20);
ie_material_especial_w	varchar(1) := 'N';
ie_quest_agora_w		varchar(1) := 'N';

BEGIN

select	coalesce(max(ie_contraste),'N'),
		coalesce(max(ie_ctrl_glic),'N'),
		coalesce(max(ie_exige_condicao),'N'),
		coalesce(max(ie_exige_indicacao),'N'),
		coalesce(max(ie_exige_justificativa),'N'),
		coalesce(max(ie_frase),'N'),
		coalesce(max(ie_intervalo),'N'),
		coalesce(max(ie_exige_lado),'N'),
		coalesce(max(ie_medico_exec),'N'),
		coalesce(max(ie_observacao),'N'),
		coalesce(max(ie_orientacao),'N'),
		coalesce(max(ie_outro_exame),'N'),
		coalesce(max(ie_questionar_forma),'N'),
		coalesce(max(ie_questionar_resumo),'N'),
		coalesce(max(ie_rotina_uti),'N'),
		coalesce(max(ie_setor),'N'),
		coalesce(max(ie_tela_unica),'N'),
		coalesce(max(ie_topografia),'N'),
		max(ds_cor),
		max(ie_tipo),
		max(nr_seq_proc_rotina),
		max(cd_intervalo),
		coalesce(max(nr_seq_prot_glic),0),
		coalesce(max(cd_material_exame),'0'),
		coalesce(max(ie_quest_agora),'N')
into STRICT	ie_contraste_p,
		ie_ctrl_glic_p,
		ie_exige_condicao_p,
		ie_exige_indicacao_p,
		ie_exige_justificativa_p,
		ie_frase_p,
		ie_intervalo_p,
		ie_lado_p,
		ie_medico_exec_p,
		ie_observacao_p,
		ie_orientacao_p,
		ie_outro_exame_p,
		ie_questionar_forma_p,
		ie_questionar_resumo_p,
		ie_rotina_uti_p,
		ie_setor_p,
		ie_tela_unica_p,
		ie_topografia_p,
		ds_cor_p,
		ie_tipo_w,
		nr_seq_proc_rotina_w,
		cd_intervalo_p,
		nr_seq_prot_glic_p,
		cd_material_exame_w,
		ie_quest_agora_w
from	w_proc_rotina_esp_t
where	nr_sequencia = nr_sequencia_p;

ie_questiona_agora_p := 'N';
if (ie_tipo_w = 0) then

	select	coalesce(max(b.cd_procedimento),0),
			coalesce(max(b.ie_origem_proced),0),
			coalesce(max(c.cd_especialidade),0),
			coalesce(max(c.cd_grupo_proc),0),
			coalesce(max(c.cd_area_procedimento),0),
			coalesce(max(a.ie_questiona_agora),'N')
	into STRICT	cd_procedimento_w,
			ie_origem_proced_w,
			cd_especialidade_w,
			cd_grupo_w,
			cd_area_w,
			ie_questiona_agora_p
	from	exame_lab_rotina  a,
			exame_laboratorio b,
			estrutura_procedimento_v c
	where	a.nr_seq_exame = b.nr_seq_exame
	and		b.cd_procedimento = c.cd_procedimento
	and		b.ie_origem_proced = c.ie_origem_proced
	and		a.nr_sequencia = nr_seq_proc_rotina_w;

	select  coalesce(max(m.ie_material_especial),'N')
	into STRICT	ie_material_especial_w
    from    exame_lab_rotina e,
			material_exame_lab m
    where   e.nr_seq_material = m.nr_sequencia
	and     e.nr_sequencia    = nr_seq_proc_rotina_w;

	select	coalesce(max(a.nr_sequencia),0)
	into STRICT	nr_seq_proc_interno_w
	from	proc_interno a
	where	a.cd_procedimento = cd_procedimento_w;

elsif (ie_tipo_w = 1) then

	select	coalesce(max(a.nr_proc_interno),0),
			coalesce(max(a.cd_procedimento),0),
			coalesce(max(a.ie_origem_proced),0),
			coalesce(max(a.ie_questiona_agora),'N'),
			max(a.cd_kit_material)
	into STRICT	nr_seq_proc_interno_w,
			cd_procedimento_w,
			ie_origem_proced_w,
			ie_questiona_agora_p,
			cd_kit_material_p
	from	procedimento_rotina a
	where	a.nr_sequencia = nr_seq_proc_rotina_w;

	select	coalesce(max(b.cd_especialidade),0),
			coalesce(max(b.cd_grupo_proc),0),
			coalesce(max(b.cd_area_procedimento),0)
	into STRICT	cd_especialidade_w,
			cd_grupo_w,
			cd_area_w
	from	estrutura_procedimento_v b
	where	b.cd_procedimento = cd_procedimento_w
	and		b.ie_origem_proced = ie_origem_proced_w;

	if (nr_seq_proc_interno_w > 0) and (cd_procedimento_w = 0) and (ie_origem_proced_w = 0) then
		select	coalesce(max(a.cd_procedimento),0),
				coalesce(max(a.ie_origem_proced),0)
		into STRICT	cd_procedimento_w,
				ie_origem_proced_w
		from	proc_interno a
		where	a.nr_sequencia = nr_seq_proc_interno_w;
	end if;
elsif (ie_tipo_w = 2) then

	select	coalesce(max(a.nr_seq_exame),0),
			coalesce(max(a.cd_procedimento),0),
			coalesce(max(a.ie_origem_proced),0),
			coalesce(max(b.cd_especialidade),0),
			coalesce(max(b.cd_grupo_proc),0),
			coalesce(max(b.cd_area_procedimento),0),
			coalesce(max(a.ie_questionar_agora),'N')
	into STRICT	nr_seq_exame_w,
			cd_procedimento_w,
			ie_origem_proced_w,
			cd_especialidade_w,
			cd_grupo_w,
			cd_area_w,
			ie_questiona_agora_p
	from	exame_laboratorio  a,
			estrutura_procedimento_v b
	where	a.nr_seq_exame = nr_seq_proc_rotina_w
	and		a.cd_procedimento = b.cd_procedimento
	and		a.ie_origem_proced = b.ie_origem_proced;

	select	coalesce(max(b.ie_material_especial),'N')
	into STRICT	ie_material_especial_w
	from	material_exame_lab b,
			exame_lab_material a
	where	a.nr_seq_material 	= b.nr_sequencia
	and		a.nr_seq_exame 		= nr_seq_exame_w
	and		a.ie_situacao		= 'A'
	and		ie_prioridade		= (	SELECT	min(ie_prioridade)
									from	exame_lab_material x
									where	nr_seq_exame	= nr_seq_exame_w
									and		x.ie_situacao	= 'A');

	if (cd_material_exame_w <> '') and (cd_material_exame_w <> '0') then
		select	coalesce(max(ie_material_especial),'N')
		into STRICT	ie_mat_especial_w
		from	material_exame_lab b
		where	b.cd_material_exame = cd_material_exame_w;
	end if;

	select	coalesce(max(nr_sequencia),0)
	into STRICT	nr_seq_proc_interno_w
	from	proc_interno
	where	cd_procedimento = cd_procedimento_w;
elsif (ie_tipo_w = 4) then
	ie_questiona_agora_p := ie_quest_agora_w;
end if;

select 	coalesce(max(nr_seq_contraste),0)
into STRICT	nr_seq_contraste_p
from 	procedimento_rotina
where 	nr_sequencia = nr_seq_proc_rotina_w;

ie_tipo_p 				:= ie_tipo_w;
cd_procedimento_p 		:= cd_procedimento_w;
ie_origem_proced_p		:= ie_origem_proced_w;
cd_especialidade_p		:= cd_especialidade_w;
cd_grupo_p		    	:= cd_grupo_p;
cd_area_p		    	:= cd_area_w;
nr_seq_exame_p	    	:= coalesce(nr_seq_exame_w,0);
nr_seq_proc_interno_p	:= coalesce(nr_seq_proc_interno_w,0);
nr_seq_rotina_p			:= coalesce(nr_seq_proc_rotina_w,0);
ie_material_especial_p	:= coalesce(ie_material_especial_w,'N');
cd_material_exame_p		:= coalesce(cd_material_exame_w,'0');
ie_mat_especial_p		:= coalesce(ie_mat_especial_w,'N');

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consulta_dados_proc_rot ( nr_sequencia_p bigint, ie_contraste_p INOUT text, ie_ctrl_glic_p INOUT text, ie_exige_condicao_p INOUT text, ie_exige_indicacao_p INOUT text, ie_exige_justificativa_p INOUT text, ie_frase_p INOUT text, ie_intervalo_p INOUT text, ie_lado_p INOUT text, ie_medico_exec_p INOUT text, ie_observacao_p INOUT text, ie_orientacao_p INOUT text, ie_outro_exame_p INOUT text, ie_questionar_forma_p INOUT text, ie_questionar_resumo_p INOUT text, ie_rotina_uti_p INOUT text, ie_setor_p INOUT text, ie_tela_unica_p INOUT text, ie_topografia_p INOUT text, ie_tipo_p INOUT bigint, cd_procedimento_p INOUT bigint, ie_origem_proced_p INOUT bigint, cd_especialidade_p INOUT text, cd_grupo_p INOUT text, cd_area_p INOUT text, nr_seq_exame_p INOUT bigint, nr_seq_proc_interno_p INOUT bigint, cd_intervalo_p INOUT text, ie_questiona_agora_p INOUT text, cd_kit_material_p INOUT bigint, nr_seq_contraste_p INOUT bigint, nr_seq_rotina_p INOUT bigint, nr_seq_prot_glic_p INOUT bigint, cd_material_exame_p INOUT text, ie_material_especial_p INOUT text, ie_mat_especial_p INOUT text, ds_cor_p INOUT text) FROM PUBLIC;

