-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ins_cpoe_weekday_proc (nr_seq_cpoe_order_unit_p bigint, ds_seq_proc_list_p text, nm_usuario_p text) AS $body$
DECLARE


qt_count_w				bigint;
nm_tabela_w				varchar(255);

  rec_w RECORD;

BEGIN

select 		count(1)
into STRICT		qt_count_w
from 		cpoe_weekday_proc a
where 		nr_seq_cpoe_order_unit = nr_seq_cpoe_order_unit_p
and 		nm_usuario = nm_usuario_p;

if (qt_count_w = 0) then	

insert into cpoe_weekday_proc(nr_sequencia,dt_atualizacao,nm_usuario,dt_atualizacao_nrec,nm_usuario_nrec, nr_seq_cpoe_order_unit,ie_domingo,ie_segunda,ie_terca,ie_quarta ,ie_quinta,ie_sexta,ie_sabado) values ( nextval('cpoe_weekday_proc_seq'),clock_timestamp(), nm_usuario_p, clock_timestamp(),nm_usuario_p, nr_seq_cpoe_order_unit_p ,'S', 'N', 'N', 'N', 'N', 'N', 'N');

insert into cpoe_weekday_proc(nr_sequencia,dt_atualizacao,nm_usuario,dt_atualizacao_nrec,nm_usuario_nrec, nr_seq_cpoe_order_unit,ie_domingo,ie_segunda,ie_terca,ie_quarta ,ie_quinta,ie_sexta,ie_sabado) values ( nextval('cpoe_weekday_proc_seq'),clock_timestamp(), nm_usuario_p, clock_timestamp(),nm_usuario_p, nr_seq_cpoe_order_unit_p ,'N', 'S', 'N', 'N', 'N', 'N', 'N');

insert into cpoe_weekday_proc(nr_sequencia,dt_atualizacao,nm_usuario,dt_atualizacao_nrec,nm_usuario_nrec, nr_seq_cpoe_order_unit,ie_domingo,ie_segunda,ie_terca,ie_quarta ,ie_quinta,ie_sexta,ie_sabado) values ( nextval('cpoe_weekday_proc_seq'),clock_timestamp(), nm_usuario_p, clock_timestamp(),nm_usuario_p, nr_seq_cpoe_order_unit_p ,'N', 'N', 'S', 'N', 'N', 'N', 'N');

insert into cpoe_weekday_proc(nr_sequencia,dt_atualizacao,nm_usuario,dt_atualizacao_nrec,nm_usuario_nrec, nr_seq_cpoe_order_unit,ie_domingo,ie_segunda,ie_terca,ie_quarta ,ie_quinta,ie_sexta,ie_sabado) values ( nextval('cpoe_weekday_proc_seq'),clock_timestamp(), nm_usuario_p, clock_timestamp(),nm_usuario_p, nr_seq_cpoe_order_unit_p ,'N', 'N', 'N', 'S', 'N', 'N', 'N');

insert into cpoe_weekday_proc(nr_sequencia,dt_atualizacao,nm_usuario,dt_atualizacao_nrec,nm_usuario_nrec, nr_seq_cpoe_order_unit,ie_domingo,ie_segunda,ie_terca,ie_quarta ,ie_quinta,ie_sexta,ie_sabado) values ( nextval('cpoe_weekday_proc_seq'),clock_timestamp(), nm_usuario_p, clock_timestamp(),nm_usuario_p, nr_seq_cpoe_order_unit_p ,'N', 'N', 'N', 'N', 'S', 'N', 'N');

insert into cpoe_weekday_proc(nr_sequencia,dt_atualizacao,nm_usuario,dt_atualizacao_nrec,nm_usuario_nrec, nr_seq_cpoe_order_unit,ie_domingo,ie_segunda,ie_terca,ie_quarta ,ie_quinta,ie_sexta,ie_sabado) values ( nextval('cpoe_weekday_proc_seq'),clock_timestamp(), nm_usuario_p, clock_timestamp(),nm_usuario_p, nr_seq_cpoe_order_unit_p ,'N', 'N', 'N', 'N', 'N', 'S', 'N');

insert into cpoe_weekday_proc(nr_sequencia,dt_atualizacao,nm_usuario,dt_atualizacao_nrec,nm_usuario_nrec, nr_seq_cpoe_order_unit,ie_domingo,ie_segunda,ie_terca,ie_quarta ,ie_quinta,ie_sexta,ie_sabado) values ( nextval('cpoe_weekday_proc_seq'),clock_timestamp(), nm_usuario_p, clock_timestamp(),nm_usuario_p, nr_seq_cpoe_order_unit_p ,'N', 'N', 'N', 'N', 'N', 'N', 'S');


end if;

for rec_w in (select 		a.nr_sequencia,
			b.nr_registro
from 		cpoe_weekday_proc a,
			table(lista_pck.obter_lista(ds_seq_proc_list_p,',')) b
where 		nr_seq_cpoe_order_unit = nr_seq_cpoe_order_unit_p
and 		nm_usuario = nm_usuario_p
and 		not exists (select  1
						from	cpoe_weekday_proc_item c
						where	c.nr_seq_proc_interno = b.nr_registro
						and		a.nr_sequencia = c.nr_seq_cpoe_weekday_proc)			
order by	nr_sequencia) loop 
	insert into cpoe_weekday_proc_item(	nr_sequencia,        
										dt_atualizacao,         
										nm_usuario,     
										dt_atualizacao_nrec,
										nm_usuario_nrec, 
										nr_seq_cpoe_weekday_proc,
										nr_seq_proc_interno,
										ie_selected)          
								values (	nextval('cpoe_weekday_proc_item_seq'),
										clock_timestamp(),
										nm_usuario_p,
										clock_timestamp(),
										nm_usuario_p,
										rec_w.nr_sequencia,
										rec_w.nr_registro,
										'S');

end loop;

delete from cpoe_weekday_proc_item
where	nr_sequencia in (SELECT distinct b.nr_sequencia
from	cpoe_weekday_proc a,
		cpoe_weekday_proc_item b
where	a.nr_sequencia = b.NR_SEQ_CPOE_WEEKDAY_PROC
and		a.nr_seq_cpoe_order_unit = nr_seq_cpoe_order_unit_p
and		Obter_Se_Contido(b.nr_seq_proc_interno, ds_seq_proc_list_p) != 'S');

commit;


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ins_cpoe_weekday_proc (nr_seq_cpoe_order_unit_p bigint, ds_seq_proc_list_p text, nm_usuario_p text) FROM PUBLIC;

