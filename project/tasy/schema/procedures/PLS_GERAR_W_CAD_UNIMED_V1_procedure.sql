-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gerar_w_cad_unimed_v1 ( ds_linha_p text, nr_seq_lote_p bigint, nm_usuario_p text) AS $body$
DECLARE


ds_linha_w			varchar(4000);
ds_endereco_w			varchar(4000);
ds_conteudo_w			varchar(4000);
ds_area_acao_w			varchar(4000);
ds_valor_w			varchar(4000);
ds_valor_ww			varchar(2000);
ds_grupo_w			varchar(255);
ds_razao_social_w		varchar(255);
nm_fantasia_w			varchar(255);
ds_hierarquia_1_w		varchar(255);
ds_hierarquia_2_w		varchar(255);
ds_hierarquia_3_w		varchar(255);
ds_hierarquia_4_w		varchar(255);
ds_hierarquia_5_w		varchar(255);
ds_bairro_w			varchar(255);
ds_cidade_w			varchar(255);
cd_ans_w			varchar(255);
ds_email_w			varchar(255);
ds_site_w			varchar(255);
ds_dirigente_w			varchar(255);
ds_cargo_dirigente_w		varchar(255);
ds_tipo_prestador_w		varchar(255);
ie_tipo_fone_1_w		varchar(100);
ie_tipo_fone_w			varchar(100);
nr_telefone_1_w			varchar(40);
nr_telefone_2_w			varchar(40);
nr_inscr_estadual_w		varchar(30);
nr_inscr_municipal_w		varchar(30);
cd_cep_w			varchar(15);
cd_cgc_w			varchar(14);
cd_complexo_w			varchar(10);
ds_codigo_w			varchar(3);
sg_estado_w			pessoa_juridica.sg_estado%type;
ie_existente_w			varchar(1);
qt_cooperados_w			bigint;
qt_usuarios_w			bigint;
qt_funcionarios_w		bigint;
nr_seq_conteudo			bigint;
contador_w  			integer	:= 0;
contador_coop_w			integer	:= 0;
ie_layout_w			smallint	:= null;
dt_fundacao_w			timestamp;
dt_inicio_mandato_w		timestamp;
dt_fim_mandato_w		timestamp;


BEGIN
ds_linha_w	:= ds_linha_p;

while(ds_linha_w IS NOT NULL AND ds_linha_w::text <> '') and (contador_w < 255) loop
	begin

	if (position(';' in ds_linha_w) = 0) then
		ds_valor_w	:= ds_linha_w;
		ds_linha_w	:= null;
	else
		ds_valor_w	:= substr(ds_linha_w,1,position(';' in ds_linha_w) - 1);
		ds_linha_w	:= substr(ds_linha_w,position(';' in ds_linha_w) + 1,length(ds_linha_w));
	end if;

	-- GRUPO
	if (contador_w = 0) then
		ds_grupo_w	:= ltrim(ds_valor_w);
	end if;

	-- COD_COMPLEXO
	if (contador_w = 1) then
		if (length(ds_valor_w) < 4) then
			ds_valor_w	:= lpad(ds_valor_w, 4, '0');
		end if;
		begin
		cd_complexo_w	:= substr(ltrim(ds_valor_w),1, 10);
		exception
			when others then
			-- Erro: #@DS_ERRO#@
			CALL wheb_mensagem_pck.exibir_mensagem_abort(266799, 'DS_ERRO=' || ds_valor_w);
		end;
	end if;

	-- RAZAO_SOCIAL
	if (contador_w = 2) then
		ds_razao_social_w	:= ltrim(ds_valor_w);
	end if;

	-- NOME_FANTASIA
	if (contador_w = 3) then
		nm_fantasia_w		:= ltrim(ds_valor_w);
	end if;
	
	-- TIPO_OPERADORA
	if (contador_w = 4) then
		ds_tipo_prestador_w	:= ltrim(ds_valor_w);
	end if;

	--HIERARQUIA1
	if (contador_w = 5) then
		ds_hierarquia_1_w	:= ltrim(ds_valor_w);
	end if;
	
	--HIERARQUIA2
	if (contador_w = 6) then
		ds_hierarquia_2_w	:= ltrim(ds_valor_w);
	end if;

	--HIERARQUIA3
	if (contador_w = 7) then
		ds_hierarquia_3_w	:= ltrim(ds_valor_w);
	end if;

	--HIERARQUIA4
	if (contador_w = 8) then
		ds_hierarquia_4_w	:= ltrim(ds_valor_w);
	end if;

	--HIERARQUIA5
	if (contador_w = 9) then
		ds_hierarquia_5_w	:= ltrim(ds_valor_w);
	end if;

	-- ENDERECO
	if (contador_w = 10) then
		ds_endereco_w		:= ltrim(ds_valor_w);
	end if;

	-- BAIRRO
	if (contador_w = 11) then
		ds_bairro_w		:= ltrim(ds_valor_w);
	end if;

	-- CIDADE
	if (contador_w = 12) then
		ds_cidade_w		:= ltrim(ds_valor_w);
	end if;

	-- ESTADO
	if (contador_w = 13) then
		sg_estado_w		:= ltrim(ds_valor_w);
	end if;
	
	-- CEP
	if (contador_w = 14) then
		cd_cep_w		:= ltrim(ds_valor_w);
	end if;

	-- CNPJ
	if (contador_w = 15) then
		cd_cgc_w		:= ltrim(ds_valor_w);
	end if;

	-- INSCRICAO_ESTADUAL
	if (contador_w = 16) then
		nr_inscr_estadual_w	:= ltrim(ds_valor_w);
	end if;

	-- INSCRICAO_MUNICIPAL
	if (contador_w = 17) then
		nr_inscr_municipal_w	:= ltrim(ds_valor_w);
	end if;

	-- REGISTRO_ANS
	if (contador_w = 18) then
		cd_ans_w		:= ltrim(ds_valor_w);
	end if;

	-- DATA_FUNDACAO
	if (contador_w = 19) then
		dt_fundacao_w		:= to_Date(ltrim(ds_valor_w),'dd/mm/yyyy');
	end if;

	-- TELEFONE1
	if (contador_w = 20) then
		nr_telefone_1_w		:= ltrim(ds_valor_w);
	end if;

	-- TIPO_TELEFONE1
	if (contador_w = 21) then
		ie_tipo_fone_1_w	:= ltrim(ds_valor_w);
	end if;

	-- TELEFONE2
	if (contador_w = 22) then
		nr_telefone_2_w		:= ltrim(ds_valor_w);
	end if;

	-- TIPO_TELEFONE2
	if (contador_w = 23) then
		ie_tipo_fone_w		:= ltrim(ds_valor_w);
	end if;
	
	-- EMAIL
	if (contador_w = 24) then
		ds_email_w		:= ltrim(ds_valor_w);
	end if;

	-- WEB_SITE
	if (contador_w = 25) then
		ds_site_w		:= ltrim(ds_valor_w);
	end if;

	-- PRESIDENTE
	if (contador_w = 26) then
		ds_dirigente_w		:= ltrim(ds_valor_w);
	end if;

	-- CARGO_PRESIDENTE
	if (contador_w = 27) then
		ds_cargo_dirigente_w	:= ltrim(ds_valor_w);
	end if;

	-- DATA_INICIO_MANDATO
	if (contador_w = 28) then
		dt_inicio_mandato_w	:= to_Date(ltrim(ds_valor_w),'dd/mm/yyyy');
	end if;

	-- DATA_FIM_MANDATO
	if (contador_w = 29) then
		dt_fim_mandato_w	:= to_Date(ltrim(ds_valor_w),'dd/mm/yyyy');
	end if;

	-- AREA_ACAO
	if (contador_w = 30) then
		ds_area_acao_w		:= ltrim(ds_valor_w);
	end if;

	-- QUANT_COOPERADOS
	if (contador_w = 31) then
		qt_cooperados_w		:= (ltrim(ds_valor_w))::numeric;
	end if;

	-- QUANT_USUARIOS
	if (contador_w = 32) then
		qt_usuarios_w		:= (ltrim(ds_valor_w))::numeric;
	end if;

	-- QUANT_FUNCIONARIOS
	if (contador_w = 33) then
		qt_funcionarios_w	:= (ltrim(ds_valor_w))::numeric;
	end if;

	contador_w := contador_w + 1;
	end;
end loop;

select	count(*)
into STRICT	contador_coop_w
from	pls_congenere a
where	a.cd_cgc	= cd_cgc_w;

if (contador_coop_w > 0) then
	ie_existente_w	:= 'S';
else
	ie_existente_w	:= 'N';
end if;

insert into pls_w_import_cad_unimed(nr_sequencia,
	nm_usuario,
	dt_atualizacao,
	nm_usuario_nrec,
	dt_atualizacao_nrec,
	ds_grupo,
	cd_complexo,
	ds_razao_social,
	nm_fantasia,
	ds_hierarquia_1,
	ds_hierarquia_2,
	ds_hierarquia_3,
	ds_hierarquia_4,
	ds_hierarquia_5,
	ds_endereco,
	ds_bairro,
	ds_cidade,
	sg_estado,
	cd_cep,
	cd_cgc,
	nr_inscr_estadual,
	nr_inscr_municipal,
	cd_ans,
	dt_fundacao,
	nr_telefone_1,
	ie_tipo_fone_1,
	nr_telefone_2,
	ie_tipo_fone,
	ds_email,
	ds_site,
	ds_dirigente,
	ds_cargo_dirigente,
	dt_inicio_mandato,
	dt_fim_mandato,
	ds_area_acao,
	qt_cooperados,
	qt_usuarios,
	qt_funcionarios,
	ds_tipo_prestador,
	nr_seq_lote,
	ie_existente)
values (nextval('pls_w_import_cad_unimed_seq'),
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	ds_grupo_w,
	cd_complexo_w,
	ds_razao_social_w,
	nm_fantasia_w,
	ds_hierarquia_1_w,
	ds_hierarquia_2_w,
	ds_hierarquia_3_w,
	ds_hierarquia_4_w,
	ds_hierarquia_5_w,
	ds_endereco_w,
	ds_bairro_w,
	ds_cidade_w,
	sg_estado_w,
	cd_cep_w,
	cd_cgc_w,
	nr_inscr_estadual_w,
	nr_inscr_municipal_w,
	cd_ans_w,
	dt_fundacao_w,
	nr_telefone_1_w,
	ie_tipo_fone_1_w,
	nr_telefone_2_w,
	ie_tipo_fone_w,
	ds_email_w,
	ds_site_w,
	ds_dirigente_w,
	ds_cargo_dirigente_w,
	dt_inicio_mandato_w,
	dt_fim_mandato_w,
	ds_area_acao_w,
	qt_cooperados_w,
	qt_usuarios_w,
	qt_funcionarios_w,
	ds_tipo_prestador_w,
	nr_seq_lote_p,
	ie_existente_w);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_w_cad_unimed_v1 ( ds_linha_p text, nr_seq_lote_p bigint, nm_usuario_p text) FROM PUBLIC;

