-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE carrega_proc_conv ( cd_convenio_p text, cd_procedimento_p text, cd_proc_co_p text, tx_conv_qt_p text, cd_espec_m_p text, ie_tipo_at_p text, cd_setor_a_p text, ie_pacote_p text, ie_situacao_p text, cd_unid_co_p text, cd_grupo_p text, ds_proc_co_p text, ie_origem_p text, nm_usuario_p text, dt_ini_vig_p timestamp, ds_observacao_p text ) AS $body$
DECLARE


 nr_proced bigint;

 
BEGIN
 
 select count(*) 
 into STRICT 	nr_proced
 from 	procedimento 
 where 	cd_procedimento = cd_procedimento_p 
		and ie_origem_proced = ie_origem_p;


if (nr_proced <> 0) and (coalesce(cd_procedimento_p,'X') <> 'X') and (coalesce(cd_proc_co_p,'X') <> 'X') and (coalesce(ie_origem_p,'X') <> 'X') and (coalesce(ie_situacao_p,'X') <> 'X') then
	begin
	insert into conversao_proc_convenio(nr_sequencia,
										cd_convenio,
										cd_proc_convenio,
										dt_atualizacao,
										nm_usuario,
										cd_area_proced,
										cd_especial_proced,
										cd_grupo_proced,
										cd_procedimento,
										ie_origem_proced,
										ds_proc_convenio,
										cd_grupo,
										tx_conversao_qtde,
										cd_unidade_convenio,
										ie_situacao,
										cd_especialidade_medica,
										ie_tipo_atendimento,
										ie_pacote,
										cd_setor_atendimento,
										dt_inicio_vigencia,
                    ds_observacao)
								values (	nextval('conversao_proc_convenio_seq'),
										(cd_convenio_p)::numeric ,
										(cd_proc_co_p)::numeric ,
										clock_timestamp(),
										nm_usuario_p,
										null,
										null,
										null,
										(cd_procedimento_p)::numeric ,
										(ie_origem_p)::numeric ,
										ds_proc_co_p,
										(cd_grupo_p)::numeric ,
										(tx_conv_qt_p)::numeric ,
										cd_unid_co_p,
										ie_situacao_p,
										(cd_espec_m_p)::numeric ,
										(ie_tipo_at_p)::numeric ,
										ie_pacote_p,
										(cd_setor_a_p)::numeric ,
										dt_ini_vig_p,
                    substr(ds_observacao_p,1,255)
								);

	end;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE carrega_proc_conv ( cd_convenio_p text, cd_procedimento_p text, cd_proc_co_p text, tx_conv_qt_p text, cd_espec_m_p text, ie_tipo_at_p text, cd_setor_a_p text, ie_pacote_p text, ie_situacao_p text, cd_unid_co_p text, cd_grupo_p text, ds_proc_co_p text, ie_origem_p text, nm_usuario_p text, dt_ini_vig_p timestamp, ds_observacao_p text ) FROM PUBLIC;

