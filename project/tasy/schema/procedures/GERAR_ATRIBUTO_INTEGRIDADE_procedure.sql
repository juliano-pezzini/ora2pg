-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_atributo_integridade ( NM_TABELA_P text, NM_INTEGRIDADE_REFERENCIAL_P text, NM_USUARIO_P text, NM_TABELA_REFERENCIAL_P text ) AS $body$
DECLARE


POS_I_W integer := 1;
INTEGRIDADE_COUNT_W INTEGRIDADE_ATRIBUTO.NM_TABELA%TYPE;

C01 CURSOR FOR
  SELECT B.NM_ATRIBUTO
  FROM INDICE_ATRIBUTO B,
  INDICE A
  WHERE A.NM_INDICE = B.NM_INDICE
  AND A.NM_TABELA = NM_TABELA_REFERENCIAL_P
  AND A.IE_TIPO = 'PK'
  AND B.NM_ATRIBUTO <> 'NR_SEQUENCIA';

INDICE_CURSOR C01%ROWTYPE;

BEGIN
    OPEN C01;
    LOOP
      FETCH C01
      INTO INDICE_CURSOR;
      EXIT WHEN NOT FOUND; /* apply on C01 */

          INSERT INTO INTEGRIDADE_ATRIBUTO(
            NM_TABELA, 
            NM_INTEGRIDADE_REFERENCIAL, 
            NM_ATRIBUTO,
            IE_SEQUENCIA_CRIACAO, 
            DT_ATUALIZACAO, 
            NM_USUARIO) 
          VALUES (
              NM_TABELA_P,
              NM_INTEGRIDADE_REFERENCIAL_P,
              INDICE_CURSOR.NM_ATRIBUTO,
              POS_I_W,
              clock_timestamp(),
              NM_USUARIO_P
          );
          POS_I_W := POS_I_W + 1;
    END LOOP;
    CLOSE C01;
  COMMIT;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_atributo_integridade ( NM_TABELA_P text, NM_INTEGRIDADE_REFERENCIAL_P text, NM_USUARIO_P text, NM_TABELA_REFERENCIAL_P text ) FROM PUBLIC;

