-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE apap_gera_valor_padrao ( nr_seq_documento_p documento.nr_sequencia%type, nr_atendimento_p atendimento_paciente.nr_atendimento%type, cd_pessoa_fisica_p atendimento_paciente.cd_pessoa_fisica%type) AS $body$
DECLARE


ds_lista_tabela_w	varchar(4000);
ds_lista_template_w	varchar(4000);
nm_usuario_w		usuario.nm_usuario%type;


BEGIN
nm_usuario_w	:=	wheb_usuario_pck.get_nm_usuario;

ds_lista_tabela_w	:=	Obter_select_concatenado_bv('select  distinct c.nm_tabela '||
													'from    w_apap_pac a, '||
													'		w_apap_pac_grupo b, '||
													'		w_apap_pac_informacao c, '||
													'		linked_data_ativacao d '||
													'where   a.nr_sequencia      = b.nr_seq_mod_apap '||
													'and     b.nr_sequencia      = c.nr_seq_apap_grupo '||
													'and     c.nr_seq_linked_data= d.nr_seq_linked_data '||
													'and     a.nr_seq_documento  = :nr_seq_documento_p '||
													'and     a.nm_usuario        = :nm_usuario_p '||
													'and     a.nr_atendimento    = :nr_atendimento_p ',
													'nr_atendimento_p='||to_char(nr_atendimento_p)||
													';nm_usuario_p='||nm_usuario_w||
													';nr_seq_documento_p='||to_char(nr_seq_documento_p),',');
														
ds_lista_template_w	:=	Obter_select_concatenado_bv('select  distinct d.nr_seq_template  '||
													'from    w_apap_pac a, '||
													'		w_apap_pac_grupo b, '||
													'		w_apap_pac_informacao c, '||
													'		ehr_template_conteudo d '||
													'where   a.nr_sequencia      = b.nr_seq_mod_apap '||
													'and     b.nr_sequencia      = c.nr_seq_apap_grupo '||
													'and     c.nr_seq_temp_conteudo  = d.nr_sequencia '||
													'and     a.nr_seq_documento  = :nr_seq_documento_p '||
													'and     a.nm_usuario        = :nm_usuario_p '||
													'and     a.nr_atendimento    = :nr_atendimento_p ',
													'nr_atendimento_p='||to_char(nr_atendimento_p)||
													';nm_usuario_p='||nm_usuario_w||
													';nr_seq_documento_p='||to_char(nr_seq_documento_p),',');
						
CALL his_rule_value_default_pck.reset_dados();
CALL his_rule_value_default_pck.gerar_dados(nr_atendimento_p,cd_pessoa_fisica_p,ds_lista_tabela_w,ds_lista_template_w);

end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE apap_gera_valor_padrao ( nr_seq_documento_p documento.nr_sequencia%type, nr_atendimento_p atendimento_paciente.nr_atendimento%type, cd_pessoa_fisica_p atendimento_paciente.cd_pessoa_fisica%type) FROM PUBLIC;

