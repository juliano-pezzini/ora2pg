-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cpoe_get_rule_filter_lexcomp (cd_perfil_p bigint, ie_drug_interaction_sl_p INOUT bigint, ie_drug_interaction_dl_p INOUT bigint, ie_drug_ic10_sl_p INOUT bigint, ie_plag_sl_p INOUT bigint, ie_route_sl_p INOUT bigint) AS $body$
DECLARE


nr_sequencia_w				cpoe_presentation_rule.nr_sequencia%type;

ie_drug_interaction_sl_w	rule_integration_lexcomp.ie_drug_interaction_sl%type;
ie_drug_interaction_dl_w	rule_integration_lexcomp.ie_drug_interaction_dl%type;
ie_drug_ic10_sl_w			rule_integration_lexcomp.ie_drug_ic10_sl%type;
ie_plag_sl_w				rule_integration_lexcomp.ie_plag_sl%type;
ie_route_sl_w				rule_integration_lexcomp.ie_route_sl%type;


BEGIN

	select	coalesce(max(nr_sequencia),0)
	into STRICT	nr_sequencia_w
	from (SELECT nr_sequencia
		from	cpoe_presentation_rule
		where 	coalesce(cd_perfil, coalesce(cd_perfil_p,0)) = coalesce(cd_perfil_p,0)
		and	coalesce(cd_estabelecimento, coalesce(wheb_usuario_pck.get_cd_estabelecimento,0)) = coalesce(wheb_usuario_pck.get_cd_estabelecimento,0)
		order by cd_perfil, cd_estabelecimento) alias8 LIMIT 1;

	if (nr_sequencia_w > 0) then
		select	max(ie_drug_interaction_sl),
				max(ie_drug_interaction_dl),
				max(ie_drug_ic10_sl),
				max(ie_plag_sl),
				max(ie_route_sl)
		into STRICT	ie_drug_interaction_sl_w,
				ie_drug_interaction_dl_w,
				ie_drug_ic10_sl_w,
				ie_plag_sl_w,
				ie_route_sl_w
		from	rule_integration_lexcomp
		where	nr_seq_rule = nr_sequencia_w;
	end if;

	ie_drug_interaction_sl_p	:=	ie_drug_interaction_sl_w;
	ie_drug_interaction_dl_p	:=	ie_drug_interaction_dl_w;	
	ie_drug_ic10_sl_p			:=	ie_drug_ic10_sl_w;
	ie_plag_sl_p				:=	ie_plag_sl_w;
	ie_route_sl_p				:=	ie_route_sl_w;


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_get_rule_filter_lexcomp (cd_perfil_p bigint, ie_drug_interaction_sl_p INOUT bigint, ie_drug_interaction_dl_p INOUT bigint, ie_drug_ic10_sl_p INOUT bigint, ie_plag_sl_p INOUT bigint, ie_route_sl_p INOUT bigint) FROM PUBLIC;

