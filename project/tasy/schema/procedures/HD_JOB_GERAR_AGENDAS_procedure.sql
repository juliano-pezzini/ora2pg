-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE hd_job_gerar_agendas () AS $body$
DECLARE

result_out_w varchar(1000);
  i RECORD;

BEGIN

    BEGIN
        FOR i IN (SELECT c.nr_sequencia FROM hd_ponto_acesso c WHERE coalesce(cd_agenda::text, '') = '') LOOP
            -- Cria Agenda de Servico
            CALL hd_gerar_agenda_servico(nr_seq_ponto_p => i.nr_sequencia);
        END LOOP;
        COMMIT;
    END;

    BEGIN
        FOR i IN (SELECT prc.cd_pessoa_fisica FROM hd_pac_renal_cronico prc) LOOP
            -- Cria Agenda de Hemodialise  (AtepacHD)
			result_out_p =>result_out_w := hd_gerar_agenda(cd_pessoa_fisica_p => i.cd_pessoa_fisica, result_out_p =>result_out_w);

        END LOOP;
        COMMIT;
    END;

    BEGIN
        FOR i IN (SELECT had.nr_sequencia FROM hd_agenda_dialise had WHERE coalesce(had.nr_seq_agenda::text, '') = '') LOOP
            -- Gera Agendamento de "Servico" (AtepacAN)
            CALL hd_gerar_agendamento_servico(nr_seq_agenda_dialise_p => i.nr_sequencia);
        END LOOP;
        COMMIT;
    END;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE hd_job_gerar_agendas () FROM PUBLIC;

