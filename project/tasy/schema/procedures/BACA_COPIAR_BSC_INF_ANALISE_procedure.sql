-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_copiar_bsc_inf_analise () AS $body$
DECLARE



ds_analise_w			bsc_ind_inf.ds_analise%type;
dt_atualizacao_analise_w	bsc_ind_inf.dt_atualizacao_analise%type;
dt_lib_analise_w		bsc_ind_inf.dt_lib_analise%type;
nm_usuario_analise_w		bsc_ind_inf.nm_usuario_analise%type;
nm_usuario_w			bsc_ind_inf.nm_usuario%type;
nr_seq_ind_inf_w		bsc_ind_inf.nr_sequencia%type;
qt_registro_w			bigint;

c_analise CURSOR FOR
SELECT	a.nr_sequencia,
	a.dt_atualizacao_analise,
	a.nm_usuario_analise,
	a.nm_usuario,
	a.dt_lib_analise,
	a.ds_analise
from	bsc_ind_inf a
where	(a.ds_analise IS NOT NULL AND a.ds_analise::text <> '');


BEGIN

open c_analise;
loop
fetch c_analise into
	nr_seq_ind_inf_w,
	dt_atualizacao_analise_w,
	nm_usuario_analise_w,
	nm_usuario_w,
	dt_lib_analise_w,
	ds_analise_w;
EXIT WHEN NOT FOUND; /* apply on c_analise */
	begin

	select	count(nr_sequencia)
	into STRICT	qt_registro_w
	from	bsc_ind_inf_analise a
	where	a.nr_seq_inf	= nr_seq_ind_inf_w
	and	a.nm_usuario_nrec = 'Tasy';

	if (qt_registro_w = 0) then
		begin
		insert into bsc_ind_inf_analise(
			nr_sequencia,
			nr_seq_inf,
			ds_analise,
			nm_usuario,
			dt_atualizacao,
			nm_usuario_nrec,
			dt_atualizacao_nrec,
			dt_liberacao,
			nm_usuario_lib)
		values (	nextval('bsc_ind_inf_analise_seq'),
			nr_seq_ind_inf_w,
			ds_analise_w,
			coalesce(nm_usuario_analise_w,nm_usuario_w),
			clock_timestamp(),
			'Tasy',
			clock_timestamp(),
			dt_lib_analise_w,
			nm_usuario_analise_w);
		end;
	end if;
	end;
end loop;
close c_analise;


commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_copiar_bsc_inf_analise () FROM PUBLIC;

