-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_implementacao_template ( cd_funcao_p bigint, ie_template_p text, cd_classe_p bigint, nm_usuario_p text) AS $body$
DECLARE


ds_imports_declaration_w	text;
ds_variables_declaration_w	text;
ds_implementation_w		text;
ds_evt_state_changed_w		text;

tab_w				varchar(4) := '    ';

nr_seq_classe_w			bigint;
nm_classe_w			varchar(50);
nm_variavel_classe_w		varchar(50);
nm_package_w			varchar(50);
ds_package_w			varchar(50);

ds_set_tabs_w			text;
ds_add_tabs_w			text;
ds_imports_tabs_w		text;
ds_variables_tabs_w		text;
ds_getter_w			text;
ds_setter_w			text;
ds_getters_setters_w		text;
ds_evt_tab_w			text;

ie_last_level_w			varchar(1) := 'N';

c01 CURSOR FOR
SELECT	nr_sequencia,
	nm_objeto,
	obter_initcap_var_classe_java(nm_objeto),
	gerar_nome_package_java(nm_objeto)
from	dic_objeto
where	cd_funcao = cd_funcao_p
and	ie_tipo_objeto = 'P'
and	(((ie_template_p = 'F') and (coalesce(nr_seq_obj_sup::text, '') = '')) or
	 (ie_template_p = 'C' AND nr_seq_obj_sup = cd_classe_p))
order by
	nr_seq_apres;


BEGIN
if (cd_funcao_p IS NOT NULL AND cd_funcao_p::text <> '') and (ie_template_p IS NOT NULL AND ie_template_p::text <> '') and (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') then
	begin
	CALL exec_sql_dinamico(nm_usuario_p, 'truncate table w_implementacao_wjpum');

	if (ie_template_p = 'F') then
		begin
		ds_package_w := 'import br.com.' || obter_form_funcao(cd_funcao_p);
		end;
	else
		begin
		select	'import br.com.' || obter_form_funcao(cd_funcao_p) || '.' || gerar_nome_package_java(nm_objeto),
			obter_se_wjpanel_ultimo_nivel(nr_sequencia)
		into STRICT	ds_package_w,
			ie_last_level_w
		from	dic_objeto
		where	nr_sequencia = cd_classe_p;
		end;
	end if;

	ds_imports_declaration_w	:= ds_imports_declaration_w || 'import br.com.wheb.cliente.WhebCliente;' || chr(10);
	ds_imports_declaration_w	:= ds_imports_declaration_w || 'import br.com.tasy.system.generic.UGeneric;' || chr(10);
	ds_imports_declaration_w	:= ds_imports_declaration_w || 'import br.com.wheb.funcoes.Funcoes;' || chr(10);

	ds_variables_declaration_w	:= ds_variables_declaration_w || 'private WhebCliente cliente = null;' || chr(10);
	ds_variables_declaration_w	:= ds_variables_declaration_w || 'private boolean isTabsCriadas = false;' || chr(10);

	ds_implementation_w		:= ds_implementation_w || 'public void ativar() {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || 'try {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,2) || 'if (!isTabsCriadas) {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,3) || 'criarTabs();' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,3) || 'registrarComportamentosMenus();' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,3) || 'ativarFiltros();' || chr(10);
	if (ie_last_level_w = 'N') then
		begin
		ds_implementation_w	:= ds_implementation_w || tab_char(tab_w,3) || 'containerWJTPWStateChanged(null);' || chr(10);
		end;
	end if;
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || '} catch (Exception ex) {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,2) || 'UGeneric.tratarErro(this, ex);' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || '}' || chr(10);
	ds_implementation_w		:= ds_implementation_w || '}' || chr(10);

	ds_implementation_w		:= ds_implementation_w || chr(10);

	ds_implementation_w		:= ds_implementation_w || 'public WhebCliente getCliente() {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || 'try {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,2) || 'if (cliente == null) {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,3) || 'cliente = new WhebCliente(getUsuario());' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,2) || '}' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || '} catch (Exception ex) {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,2) || 'UGeneric.tratarErro(this, ex);' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || '}' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || 'return cliente;' || chr(10);
	ds_implementation_w		:= ds_implementation_w || '}' || chr(10);

	ds_implementation_w		:= ds_implementation_w || chr(10);

	ds_implementation_w		:= ds_implementation_w || 'public void criarTabs() {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || 'try {' || chr(10);
	open c01;
	loop
	fetch c01 into	nr_seq_classe_w,
			nm_classe_w,
			nm_variavel_classe_w,
			nm_package_w;
	EXIT WHEN NOT FOUND; /* apply on c01 */
		begin
		ds_set_tabs_w		:= ds_set_tabs_w || tab_char(tab_w,2) || 'set' || nm_classe_w || '(new ' || nm_classe_w || '(this));' || chr(10);

		ds_add_tabs_w 		:= ds_add_tabs_w || tab_char(tab_w,2) ||
					   'containerWJTP.addTab(' || to_char(nr_seq_classe_w) || ', ' || 'get' || nm_classe_w || '());' || chr(10);

		ds_imports_tabs_w	:= ds_imports_tabs_w || ds_package_w || '.' || nm_package_w || '.' || nm_classe_w || ';' || chr(10);

		ds_variables_tabs_w	:= ds_variables_tabs_w || 'private ' || nm_classe_w || ' ' || nm_variavel_classe_w || ' = null;' || chr(10);

		ds_getter_w 		:= 'public ' || nm_classe_w || ' get' || nm_classe_w || '() {' || chr(10);
		ds_getter_w 		:= ds_getter_w || tab_char(tab_w,1) || 'return this.' || nm_variavel_classe_w || ';' || chr(10);
		ds_getter_w 		:= ds_getter_w || '}' || chr(10);

		ds_setter_w 		:= 'public void set' || nm_classe_w || '(' || nm_classe_w || ' ' || nm_variavel_classe_w ||') {' || chr(10);
		ds_setter_w 		:= ds_setter_w || tab_char(tab_w,1) || 'this.' || nm_variavel_classe_w || ' = ' || nm_variavel_classe_w || ';' || chr(10);
		ds_setter_w 		:= ds_setter_w || '}' || chr(10);

		ds_getters_setters_w 	:= ds_getters_setters_w || ds_getter_w || ds_setter_w;

		if (coalesce(ds_evt_tab_w::text, '') = '') then
			begin
			ds_evt_tab_w 	:= ds_evt_tab_w || tab_char(tab_w,1) || 'if (' || nm_variavel_classe_w || '.equals(containerWJTP.getSelectedComponent())) {' || chr(10);
			ds_evt_tab_w 	:= ds_evt_tab_w || tab_char(tab_w,2) || nm_variavel_classe_w || '.ativar();' || chr(10);
			ds_evt_tab_w 	:= ds_evt_tab_w || tab_char(tab_w,1) || '}';
			end;
		else
			begin
			ds_evt_tab_w 	:= ds_evt_tab_w || ' else if (' || nm_variavel_classe_w || '.equals(containerWJTP.getSelectedComponent())) {' || chr(10);
			ds_evt_tab_w 	:= ds_evt_tab_w || tab_char(tab_w,3) || nm_variavel_classe_w || '.ativar();' || chr(10);
			ds_evt_tab_w 	:= ds_evt_tab_w || tab_char(tab_w,1) || '}';
			end;
		end if;
		end;
	end loop;
	close c01;
	ds_implementation_w		:= ds_implementation_w || ds_set_tabs_w || chr(10);
	ds_implementation_w		:= ds_implementation_w || ds_add_tabs_w || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,2) || 'isTabsCriadas = true;' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || '} catch (Exception ex) {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,2) || 'UGeneric.tratarErro(this, ex);' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || '}' || chr(10);
	ds_implementation_w		:= ds_implementation_w || '}' || chr(10);

	ds_implementation_w		:= ds_implementation_w || chr(10);

	ds_implementation_w		:= ds_implementation_w || 'public void registrarComportamentosMenus() {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || 'try {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || '} catch (Exception ex) {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,2) || 'UGeneric.tratarErro(this, ex);' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || '}' || chr(10);
	ds_implementation_w		:= ds_implementation_w || '}' || chr(10);

	ds_implementation_w		:= ds_implementation_w || chr(10);

	ds_implementation_w		:= ds_implementation_w || 'public void ativarFiltros() {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || 'try {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || '} catch (Exception ex) {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,2) || 'UGeneric.tratarErro(this, ex);' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || '}' || chr(10);
	ds_implementation_w		:= ds_implementation_w || '}' || chr(10);

	ds_implementation_w		:= ds_implementation_w || chr(10);

	ds_implementation_w		:= ds_implementation_w || 'public Long getParametroAsLong(Integer nrParametro) {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || 'try {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,2) ||
					   'return Funcoes.validaLong(getUsuario().getVariaveisSistema().getParametrosFuncao(nrParametro));' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || '} catch (Exception ex) {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,2) || 'UGeneric.tratarErro(this, ex);' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || '}' || chr(10);
	ds_implementation_w		:= ds_implementation_w || '}' || chr(10);

	ds_implementation_w		:= ds_implementation_w || chr(10);

	ds_implementation_w		:= ds_implementation_w || 'public Long getParametroAsString(Integer nrParametro) {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || 'try {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,2) ||
					   'return Funcoes.validaString(getUsuario().getVariaveisSistema().getParametrosFuncao(nrParametro));' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || '} catch (Exception ex) {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,2) || 'UGeneric.tratarErro(this, ex);' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || '}' || chr(10);
	ds_implementation_w		:= ds_implementation_w || '}' || chr(10);

	ds_implementation_w		:= ds_implementation_w || chr(10);

	ds_implementation_w		:= ds_implementation_w || 'public Long getParametroAsObject(Integer nrParametro) {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || 'try {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,2) ||
					   'return getUsuario().getVariaveisSistema().getParametrosFuncao(nrParametro);' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || '} catch (Exception ex) {' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,2) || 'UGeneric.tratarErro(this, ex);' || chr(10);
	ds_implementation_w		:= ds_implementation_w || tab_char(tab_w,1) || '}' || chr(10);
	ds_implementation_w		:= ds_implementation_w || '}' || chr(10);

	ds_implementation_w		:= ds_implementation_w || chr(10);

	ds_implementation_w		:= ds_implementation_w || ds_getters_setters_w;

	ds_implementation_w		:= ds_implementation_w || chr(10);

	ds_imports_declaration_w	:= ds_imports_declaration_w || ds_imports_tabs_w;

	ds_variables_declaration_w	:= ds_variables_declaration_w || ds_variables_tabs_w;

	ds_evt_state_changed_w		:= ds_evt_state_changed_w || 'if (!containerWJTP.isMontandoTabs()) {' || chr(10);
	ds_evt_state_changed_w		:= ds_evt_state_changed_w || ds_evt_tab_w || chr(10);
	ds_evt_state_changed_w		:= ds_evt_state_changed_w || '}';

	insert into w_implementacao_wjpum(
		ds_implementacao,
		id)
	values (
		ds_imports_declaration_w,
		'IMPORT');

	insert into w_implementacao_wjpum(
		ds_implementacao,
		id)
	values (
		ds_variables_declaration_w,
		'VAR');

	insert into w_implementacao_wjpum(
		ds_implementacao,
		id)
	values (
		ds_implementation_w,
		'IMPL');

	if (ie_last_level_w = 'N') then
		begin
		insert into w_implementacao_wjpum(
			ds_implementacao,
			id)
		values (
			ds_evt_state_changed_w,
			'EVT');
		end;
	end if;
	end;
end if;
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_implementacao_template ( cd_funcao_p bigint, ie_template_p text, cd_classe_p bigint, nm_usuario_p text) FROM PUBLIC;

