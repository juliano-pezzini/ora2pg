-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE intpd_receiving_legal_entity ( nr_sequencia_p bigint, xml_p xml) AS $body$
DECLARE



_ora2pg_r RECORD;
ie_conversao_w    intpd_eventos_sistema.ie_conversao%type;
nr_seq_projeto_xml_w  intpd_eventos_sistema.nr_seq_projeto_xml%type;
nr_seq_sistema_w    intpd_eventos_sistema.nr_seq_sistema%type;
ie_sistema_externo_w  varchar(15);
reg_integracao_w    gerar_int_padrao.reg_integracao_conv;
nr_seq_regra_w    conversao_meio_externo.nr_seq_regra%type;
ds_erro_w   varchar(4000);
ie_erro_w   varchar(1) := 'N';
i     integer;
nr_doc_externo_w  pessoa_juridica.cd_sistema_ant%type;
qt_registros_w    bigint;
ie_exception_w      varchar(1) := 'N';
cd_regra_w        smallint;

pessoa_juridica_w pessoa_juridica%rowtype;
pessoa_juridica_estab_w pessoa_juridica_estab%rowtype;
pessoa_juridica_compl_w pessoa_juridica_compl%rowtype;
pessoa_juridica_conta_w pessoa_juridica_conta%rowtype;
pessoa_jur_resp_w pessoa_jur_resp%rowtype;
ie_ajustar_ins_upd_w  intpd_eventos_sistema.ie_ajustar_ins_upd%type;
ie_ajustar_upd_ins_w  intpd_eventos_sistema.ie_ajustar_upd_ins%type;

c01 CURSOR FOR
SELECT  *
from  xmltable('/STRUCTURE/LEGAL_ENTITY' passing xml_p columns
  ie_action     varchar(15)    path    'IE_ACTION',
  cd_ans        varchar(20)    path    'CD_ANS_CODE',
  cd_cep        varchar(15)    path    'CD_ZIP_CODE',
  cd_cgc        varchar(14)    path    'CD_GTR',
  cd_cgc_mantenedora    varchar(14)    path    'CD_MAINTAINER',
  cd_cnes       varchar(20)    path    'CD_CNES',
  cd_cnpj_raiz      varchar(8)   path    'CD_GTR_ORIGIN',
  cd_cond_pagto     varchar(40)    path    'CD_PAYMENT_CONDITION',
  cd_conta_contabil   varchar(20)    path    'CD_ACCOUNT',
  cd_curp       varchar(18)    path    'CD_CURP',
  cd_cvm        varchar(40)    path    'CD_CVM',
  cd_internacional    varchar(20)    path    'CD_INTERNATIONAL_CODE',
  cd_municipio_ibge   varchar(6)   path    'CD_IBGE',
  cd_operadora_empresa    varchar(40)    path    'CD_COMPANY',
  cd_pf_resp_tecnico    varchar(10)    path    'CD_RESPTECH',
  cd_portador     varchar(40)    path    'CD_CARRIER',
  cd_referencia_fornec    varchar(20)    path    'CD_SUPPLIER_REFERENCE',
  cd_rfc        varchar(13)    path    'CD_RFC',
  cd_sistema_ant      varchar(20)    path    'CD_OLD_SYSTEM',
  cd_tipo_pessoa      varchar(40)    path    'CD_ENTITY_TYPE',
  cd_tipo_portador    varchar(40)    path    'CD_CARRIER_TYPE',
  ds_bairro     varchar(40)    path    'DS_NEIGHBORHOOD',
  ds_complemento      varchar(255)   path    'DS_COMPLEMENT',
  ds_email      varchar(60)    path    'DS_EMAIL',
  ds_endereco     varchar(40)    path    'DS_ADDRESS',
  ds_municipio      varchar(40)    path    'DS_MUNICIPALITY',
  ds_nome_abrev     varchar(18)    path    'DS_ABBREVIATION',
  ds_observacao     varchar(4000)    path    'DS_NOTE',
  ds_observacao_compl   varchar(4000)    path    'DS_ADDITIONAL_NOTE',
  ds_orgao_reg_resp_tecnico varchar(10)    path    'DS_RECORD_ENTITY_RESP',
  ds_orientacao_cobranca    varchar(4000)    path    'DS_CHARGING_ORIENTATION',
  ds_razao_social     varchar(255)    path    'DS_COMPANY_NAME',
  ds_resp_tecnico     varchar(255)   path    'DS_RESP_TECH_NAME',
  ds_senha      varchar(20)    path    'DS_PASSWORD',
  ds_site_internet    varchar(255)   path    'DS_WEBSITE',
  dt_criacao      varchar(40)    path    'DT_CREATION_DATE',
  dt_integracao     varchar(40)    path    'DT_INTEGRATION_DATE',
  dt_integracao_externa   varchar(40)    path    'DT_EXTERNAL_INT_DATE',
  dt_ultima_revisao   varchar(40)    path    'DT_LAST_REVISION',
  dt_validade_alvara_munic  varchar(40)    path    'DT_MUNICIPAL_SANITARY_VALIDITY',
  dt_validade_alvara_sanit  varchar(40)    path    'DT_SANITARY_VALIDITY',
  dt_validade_autor_func    varchar(40)    path    'DT_AUTOR_VALIDITY',
  dt_validade_cert_boas_prat  varchar(40)    path    'DT_CERTIFICATE_VALIDITY',
  dt_validade_resp_tecnico  varchar(40)    path    'DT_RESP_TECH_VALIDITY',
  ie_alterar_senha    varchar(1)   path    'IE_CHANGE_PASSWORD',
  ie_empreendedor_individual  varchar(15)    path    'IE_INDIVIDUAL_ENTREPRENEUR',
  ie_forma_revisao    varchar(15)    path    'IE_REVISION_METHOD',
  ie_fornecedor_opme    varchar(15)    path    'IE_OPME_SUPPLIER',
  ie_prod_fabric      varchar(3)   path    'IE_PROD_MANUF',
  ie_qualidade      varchar(3)   path    'IE_QUALITY',
  ie_situacao     varchar(1)   path    'IE_STATUS',
  ie_status_envio     varchar(15)    path    'IE_SENDER_STARUS',
  ie_status_exportar    varchar(1)   path    'IE_SENDING_STATUS',
  ie_tipo_trib_municipal    varchar(2)   path    'IE_MUNICIPALITY_TAX_TYPE',
  ie_tipo_tributacao    varchar(15)    path    'IE_TAX_TYPE',
  ie_transporte     varchar(1)   path    'IE_TRANSPORTATION',
  nm_fantasia     varchar(80)    path    'NM_TRADING_NAME',
  nm_pessoa_contato   varchar(255)   path    'NM_CONTACT_NAME',
  nm_usuario_revisao    varchar(15)    path    'NM_REVISION_USER',
  nr_alvara_sanitario   varchar(20)    path    'NR_AUTHORIZATION',
  nr_alvara_sanitario_munic varchar(20)    path    'NR_MUNICIPALITY_AUTHORIZATION',
  nr_autor_func     varchar(30)    path    'NR_RUNNING_AUTHORIZATION',
  nr_ccm        varchar(40)    path    'NR_CCM',
  nr_cei        varchar(50)    path    'NR_CEO',
  nr_certificado_boas_prat  varchar(20)    path    'NR_GREAT_PRACTICES_CERTIFICATE',
  nr_ddd_fax      varchar(3)   path    'NR_FAX_AREA_CODE',
  nr_ddd_telefone     varchar(3)   path    'NR_PHONE_AREA_CODE',
  nr_ddi_fax      varchar(3)   path    'NR_FAX_COUNTRY_CODE',
  nr_ddi_telefone     varchar(3)   path    'NR_PHONE_COUNTRY_CODE',
  nr_endereco     varchar(10)    path    'NR_ADDRESS',
  nr_fax        varchar(15)    path    'NR_FAX',
  nr_inscricao_estadual   varchar(20)    path    'NR_STATE_REGISTRATION',
  nr_inscricao_municipal    varchar(20)    path    'NR_MUNICIPALITY_REGISTRATION',
  nr_matricula_cei    varchar(15)    path    'NR_CEI_REGISTRATION',
  nr_ramal_contato    varchar(4)   path    'NR_PHONE_EXTENSION',
  nr_registro_pls     varchar(20)    path    'NR_OPS_REGISTRATION',
  nr_registro_resp_tecnico  varchar(20)    path    'NR_RESP_TECH_REGISTRATION',
  nr_seq_idioma     varchar(10)    path    'NR_LANGUAGE',
  nr_seq_pais     varchar(5)   path    'NR_COUNTRY',
  nr_telefone     varchar(15)    path    'NR_PHONE',
  qt_dia_prazo_entrega    varchar(3)   path    'QT_PAYMENT_TERM',
  sg_estado     varchar(15)    path    'SG_STATE',
  vl_minimo_nf      varchar(40)    path    'VL_MINIMUM_INVOICE_VALUE',
  xml_establishments    xml     path    'ESTABLISHMENTS',
  xml_complements     xml     path    'COMPLEMENTS',
  xml_accounts      xml     path    'ACCOUNTS',
  xml_responsibles    xml     path    'RESPONSIBLES');

c01_w c01%rowtype;

c02 CURSOR FOR
SELECT  *
from  xmltable('/ESTABLISHMENTS/ESTABLISHMENT' passing c01_w.xml_establishments columns
  ie_action     varchar(15)    path    'IE_ACTION',
  cd_cgc        varchar(14)    path    'CD_GTR',
  cd_cond_pagto     varchar(40)    path    'CD_PAYMENT_CONDITION',
  cd_estabelecimento    varchar(40)    path    'CD_ESTABLISHMENT',
  cd_interno_lab      varchar(20)    path    'CD_INTERNAL_LABORATORY',
  cd_operacao_nf      varchar(40)    path    'CD_INVOICE_OPERATION',
  cd_portador     varchar(40)    path    'CD_CARRIER',
  cd_referencia_fornec    varchar(20)    path    'CD_SUPPLIER_REFERENCE',
  cd_sistema_ant      varchar(255)   path    'CD_OLD_SYSTEM',
  cd_tipo_baixa     varchar(40)    path    'CD_SETTLEMENT_TYPE',
  cd_tipo_portador    varchar(40)    path    'CD_CARRIER_TYPE',
  ds_email      varchar(255)   path    'DS_EMAIL',
  ie_baixa_abat     varchar(1)   path    'IE_SETTLE_DISCOUNT',
  ie_consiste_nr_serie_nf   varchar(1)   path    'IE_VALIDATE_INVOICE',
  ie_conta_dif_nf     varchar(1)   path    'IE_ADDITIONAL_ACCOUNT',
  ie_endereco_correspondencia smallint   path    'IE_CORRESPONDENCE_ADDRESS',
  ie_exige_anexo_nf   varchar(15)    path    'IE_INVOICE_ATTACHMENT',
  ie_exige_ordem_compra   varchar(1)   path    'IE_PURCHASE_ORDER',
  ie_forma_pagto      varchar(15)    path    'IE_PAYMENT_METHOD',
  ie_frete      varchar(1)   path    'IE_FREIGHT',
  ie_moeda_estrangeira    varchar(1)   path    'IE_FOREIGN_CURRENCY',
  ie_qualidade      varchar(6)   path    'IE_QUALITY',
  ie_rateio_adiant    varchar(2)   path    'IE_ADVANCE_ASSESSMENT',
  ie_rec_email_comercial    varchar(1)   path    'IE_RECEIVE_COMMERCIAL_EMAIL',
  ie_retem_iss      varchar(1)   path    'IE_RETAIN_ISS',
  ie_status_apenado   varchar(15)    path    'IE_PENALITY_STATUS',
  nm_pessoa_contato   varchar(255)   path    'NM_CONTACT_NAME',
  nr_codigo_serv_prest    varchar(10)    path    'NR_CARRIED_SERVICE',
  nr_ramal_contato    varchar(40)    path    'NR_CONTACT_BRANCH',
  pr_desc_financeiro    varchar(40)    path    'PR_DISCOUNT_PERCENTAGE',
  qt_dia_prazo_entrega    varchar(3)   path    'QT_DELIVERY_TIME',
  tx_desc_antecipacao   varchar(40)    path    'TX_ANTICIPATION_DISCOUNT',
  tx_desc_assiduidade   varchar(40)    path    'TX_ATTENDANCE_DISCOUNT',
  tx_desc_ordem     varchar(40)    path    'TX_ORDER_DISCOUNT',
  vl_minimo_nf      varchar(40)    path    'VL_MINIMUM_INVOICE');


c02_w c02%rowtype;

c03 CURSOR FOR
SELECT  *
from  xmltable('/COMPLEMENTS/COMPLEMENT' passing c01_w.xml_complements columns
  ie_action     varchar(15)    path    'IE_ACTION',
  cd_cbo_red      varchar(40)    path    'CD_CBO_POSITION',
  cd_cep        varchar(15)    path    'CD_ZIP_CODE',
  cd_cgc        varchar(14)    path    'CD_GTR',
  cd_municipio_ibge   varchar(6)   path    'CD_MUNICIPALITY',
  cd_pessoa_fisica_canal    varchar(10)    path    'CD_CHANNEL_PERSON',
  ds_bairro     varchar(40)    path    'DS_NEIGHBORHOOD',
  ds_cargo      varchar(255)   path    'DS_ROLE',
  ds_complemento      varchar(100)   path    'DS_COMPLEMENT',
  ds_email      varchar(80)    path    'DS_EMAIL',
  ds_endereco     varchar(60)    path    'DS_ADDRESS',
  ds_identific_complemento  varchar(255)   path    'DS_ADDRESS_IDENTIFICATION',
  ds_municipio      varchar(40)    path    'DS_MUNICIPALITY',
  ds_observacao     varchar(2000)    path    'DS_OBSERVATION',
  ds_setor_contato    varchar(255)   path    'DS_CONTACT_SECTOR',
  ie_contato_ref      varchar(1)   path    'IE_REFERENTIAL_CONTACT',
  ie_gerente_canal    varchar(1)   path    'IE_CHANNEL_MANAGER',
  ie_participa_eventos    varchar(1)   path    'IE_EVENT_PARTICIPANT',
  ie_plc_customer_sponsor   varchar(1)   path    'IE_CUSTOMER_SPONSOR',
  ie_plc_plataform_manager  varchar(1)   path    'IE_PLATAFORM_MANAGER',
  ie_pls        varchar(1)   path    'IE_OPS',
  ie_recebe_prop      varchar(1)   path    'IE_RECEIVE_PROPOSE',
  ie_tipo_complemento   smallint   path    'IE_COMPLEMENT_TYPE',
  nm_pessoa_contato   varchar(40)    path    'NM_CONTACT_PERSON',
  nr_ddd_telefone     varchar(3)   path    'NR_PHONE_DDD',
  nr_endereco     varchar(10)    path    'NR_ADDRESS_NUMBER',
  nr_fax        varchar(15)    path    'NR_FAX',
  nr_ramal_contato    varchar(5)   path    'NR_CONTACT_BRANCH',
  nr_telefone     varchar(15)    path    'NR_PHONE',
  nr_telefone_celular   varchar(20)    path    'NR_CELLPHONE',
  sg_estado     varchar(15)    path    'SG_STATE');

c03_w c03%rowtype;

c04 CURSOR FOR
SELECT  *
from  xmltable('/ACCOUNTS/ACCOUNT' passing c01_w.xml_accounts columns
  ie_action     varchar(15)    path    'IE_ACTION',
  cd_agencia_bancaria   varchar(8)   path    'CD_BANK_AGENCY',
  cd_banco      varchar(40)    path    'CD_BANK',
  cd_camara_compensacao   varchar(40)    path    'CD_COMPENSATION_CHAMBER',
  cd_cgc        varchar(14)    path    'CD_GTR',
  cd_codigo_identificacao   varchar(20)    path    'CD_IDENTIFIER',
  ds_observacao     varchar(255)   path    'DS_OBSERVATION',
  ie_conta_pagamento    varchar(1)   path    'IE_PAYMENT_ACCOUNT',
  ie_conta_repasse    varchar(1)   path    'IE_DISCUSSES_ACCOUNT',
  ie_digito_agencia   varchar(2)   path    'IE_AGENCY_DIGIT',
  ie_prestador_pls    varchar(1)   path    'IE_OPS_SUPPLIER',
  ie_propriedade_conta    varchar(3)   path    'IE_ACCOUNT_PROPERTY',
  ie_situacao     varchar(1)   path    'IE_SITUATION',
  ie_tipo_conta     varchar(3)   path    'IE_ACCOUNT_TYPE',
  nr_conta      varchar(20)    path    'NR_ACCOUNT_NUMBER',
  nr_digito_conta     varchar(2)   path    'NR_ACCOUNT_DIGIT');

c04_w c04%rowtype;

c05 CURSOR FOR
SELECT  *
from  xmltable('/RESPONSIBLES/RESPONSIBLE' passing c01_w.xml_responsibles columns
  ie_action     varchar(15)    path    'IE_ACTION',
  cd_cargo      varchar(40)    path    'CD_POSITION',
  cd_cgc        varchar(14)    path    'CD_GTR',
  cd_pessoa_fisica    varchar(10)    path    'CD_PERSON',
  ie_avaliacao_fornecedor   varchar(15)    path    'IE_SUPPLIER_EVALUATION',
  ie_representante_legal    varchar(1)   path    'IE_LEGAL_REPRESENTANT',
  ie_resp_cadastro    varchar(1)   path    'IE_RESP_RECORD');

c05_w c05%rowtype;


BEGIN

update  intpd_fila_transmissao
set ie_status = 'R'
where nr_sequencia = nr_sequencia_p;

commit;

begin
select  coalesce(b.ie_conversao,'I'),
  nr_seq_sistema,
  nr_seq_projeto_xml,
  nr_seq_regra_conv,
  ie_ajustar_ins_upd,
  ie_ajustar_upd_ins
into STRICT  ie_conversao_w,
  nr_seq_sistema_w,
  nr_seq_projeto_xml_w,
  nr_seq_regra_w,
  ie_ajustar_ins_upd_w,
  ie_ajustar_upd_ins_w
from  intpd_fila_transmissao a,
  intpd_eventos_sistema b
where a.nr_seq_evento_sistema = b.nr_sequencia
and a.nr_sequencia = nr_sequencia_p;

ie_sistema_externo_w  :=  nr_seq_sistema_w;

reg_integracao_w.nr_seq_fila_transmissao  :=  nr_sequencia_p;
reg_integracao_w.ie_envio_recebe    :=  'R';
reg_integracao_w.ie_sistema_externo   :=  ie_sistema_externo_w;
reg_integracao_w.ie_conversao     :=  ie_conversao_w;
reg_integracao_w.nr_seq_projeto_xml   :=  nr_seq_projeto_xml_w;
reg_integracao_w.nr_seq_regra_conversao   :=  nr_seq_regra_w;
reg_integracao_w.intpd_log_receb.delete;
reg_integracao_w.qt_reg_log     :=  0;

open c01;
loop
fetch c01 into
  c01_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
  begin
  ie_erro_w       :=  'N';
  reg_integracao_w.nm_tabela    :=  'PESSOA_JURIDICA';
  reg_integracao_w.nm_elemento    :=  'LEGAL_ENTITY';
  reg_integracao_w.nr_seq_visao   :=  5177;

  if (upper(coalesce(c01_w.ie_action,'INSERT')) <> 'DELETE') THEN
    begin
    if (upper(coalesce(c01_w.ie_action,'INSERT')) = 'UPDATE') and (c01_w.cd_cgc IS NOT NULL AND c01_w.cd_cgc::text <> '') then
      begin
      /*'Busca o registro atual do Tasy pela PK'
      Esse tratamento foi necessario porque quando e update, o sistema externo so envia as informacoes alteradas e o restante dos campos eles mandam vazio. Entao temos que buscar a informacao que ja esta gravada na tabela.*/
      select  *
      into STRICT  pessoa_juridica_w
      from  pessoa_juridica
      where   cd_cgc = c01_w.cd_cgc;
      exception
      when others then
        null;
      end;
    end if;

    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_ANS', c01_w.CD_ANS, 'N', pessoa_juridica_w.CD_ANS) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.CD_ANS := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_CEP', c01_w.CD_CEP, 'N', pessoa_juridica_w.CD_CEP) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.CD_CEP := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_CGC_MANTENEDORA', c01_w.CD_CGC_MANTENEDORA, 'N', pessoa_juridica_w.CD_CGC_MANTENEDORA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.CD_CGC_MANTENEDORA := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_CNES', c01_w.CD_CNES, 'N', pessoa_juridica_w.CD_CNES) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.CD_CNES := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_CNPJ_RAIZ', c01_w.CD_CNPJ_RAIZ, 'N', pessoa_juridica_w.CD_CNPJ_RAIZ) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.CD_CNPJ_RAIZ := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_COND_PAGTO', c01_w.CD_COND_PAGTO, 'SS', pessoa_juridica_w.CD_COND_PAGTO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.CD_COND_PAGTO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_CONTA_CONTABIL', c01_w.CD_CONTA_CONTABIL, 'S', pessoa_juridica_w.CD_CONTA_CONTABIL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.CD_CONTA_CONTABIL := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_CURP', c01_w.CD_CURP, 'N', pessoa_juridica_w.CD_CURP) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.CD_CURP := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_CVM', c01_w.CD_CVM, 'N', pessoa_juridica_w.CD_CVM) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.CD_CVM := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_INTERNACIONAL', c01_w.CD_INTERNACIONAL, 'N', pessoa_juridica_w.CD_INTERNACIONAL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.CD_INTERNACIONAL := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_MUNICIPIO_IBGE', c01_w.CD_MUNICIPIO_IBGE, 'S', pessoa_juridica_w.CD_MUNICIPIO_IBGE) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.CD_MUNICIPIO_IBGE := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_OPERADORA_EMPRESA', c01_w.CD_OPERADORA_EMPRESA, 'N', pessoa_juridica_w.CD_OPERADORA_EMPRESA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.CD_OPERADORA_EMPRESA := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_PF_RESP_TECNICO', c01_w.CD_PF_RESP_TECNICO, 'S', pessoa_juridica_w.CD_PF_RESP_TECNICO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.CD_PF_RESP_TECNICO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_PORTADOR', c01_w.CD_PORTADOR, 'N', pessoa_juridica_w.CD_PORTADOR) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.CD_PORTADOR := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_REFERENCIA_FORNEC', c01_w.CD_REFERENCIA_FORNEC, 'N', pessoa_juridica_w.CD_REFERENCIA_FORNEC) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.CD_REFERENCIA_FORNEC := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_RFC', c01_w.CD_RFC, 'N', pessoa_juridica_w.CD_RFC) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.CD_RFC := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_SISTEMA_ANT', c01_w.CD_SISTEMA_ANT, 'N', pessoa_juridica_w.CD_SISTEMA_ANT) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.CD_SISTEMA_ANT := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_TIPO_PESSOA', c01_w.CD_TIPO_PESSOA, 'N', pessoa_juridica_w.CD_TIPO_PESSOA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.CD_TIPO_PESSOA := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_TIPO_PORTADOR', c01_w.CD_TIPO_PORTADOR, 'N', pessoa_juridica_w.CD_TIPO_PORTADOR) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.CD_TIPO_PORTADOR := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_BAIRRO', c01_w.DS_BAIRRO, 'N', pessoa_juridica_w.DS_BAIRRO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DS_BAIRRO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_COMPLEMENTO', c01_w.DS_COMPLEMENTO, 'N', pessoa_juridica_w.DS_COMPLEMENTO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DS_COMPLEMENTO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_EMAIL', c01_w.DS_EMAIL, 'N', pessoa_juridica_w.DS_EMAIL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DS_EMAIL := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_ENDERECO', c01_w.DS_ENDERECO, 'N', pessoa_juridica_w.DS_ENDERECO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DS_ENDERECO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_MUNICIPIO', c01_w.DS_MUNICIPIO, 'N', pessoa_juridica_w.DS_MUNICIPIO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DS_MUNICIPIO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_NOME_ABREV', c01_w.DS_NOME_ABREV, 'N', pessoa_juridica_w.DS_NOME_ABREV) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DS_NOME_ABREV := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_OBSERVACAO', c01_w.DS_OBSERVACAO, 'N', pessoa_juridica_w.DS_OBSERVACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DS_OBSERVACAO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_OBSERVACAO_COMPL', c01_w.DS_OBSERVACAO_COMPL, 'N', pessoa_juridica_w.DS_OBSERVACAO_COMPL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DS_OBSERVACAO_COMPL := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_ORGAO_REG_RESP_TECNICO', c01_w.DS_ORGAO_REG_RESP_TECNICO, 'N', pessoa_juridica_w.DS_ORGAO_REG_RESP_TECNICO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DS_ORGAO_REG_RESP_TECNICO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_ORIENTACAO_COBRANCA', c01_w.DS_ORIENTACAO_COBRANCA, 'N', pessoa_juridica_w.DS_ORIENTACAO_COBRANCA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DS_ORIENTACAO_COBRANCA := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_RAZAO_SOCIAL', c01_w.DS_RAZAO_SOCIAL, 'N', pessoa_juridica_w.DS_RAZAO_SOCIAL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DS_RAZAO_SOCIAL := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_RESP_TECNICO', c01_w.DS_RESP_TECNICO, 'N', pessoa_juridica_w.DS_RESP_TECNICO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DS_RESP_TECNICO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_SENHA', c01_w.DS_SENHA, 'N', pessoa_juridica_w.DS_SENHA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DS_SENHA := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_SITE_INTERNET', c01_w.DS_SITE_INTERNET, 'N', pessoa_juridica_w.DS_SITE_INTERNET) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DS_SITE_INTERNET := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_CRIACAO', c01_w.DT_CRIACAO, 'N', pessoa_juridica_w.DT_CRIACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DT_CRIACAO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_INTEGRACAO', c01_w.DT_INTEGRACAO, 'N', pessoa_juridica_w.DT_INTEGRACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DT_INTEGRACAO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_INTEGRACAO_EXTERNA', c01_w.DT_INTEGRACAO_EXTERNA, 'N', pessoa_juridica_w.DT_INTEGRACAO_EXTERNA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DT_INTEGRACAO_EXTERNA := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_ULTIMA_REVISAO', c01_w.DT_ULTIMA_REVISAO, 'N', pessoa_juridica_w.DT_ULTIMA_REVISAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DT_ULTIMA_REVISAO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_VALIDADE_ALVARA_MUNIC', c01_w.DT_VALIDADE_ALVARA_MUNIC, 'N', pessoa_juridica_w.DT_VALIDADE_ALVARA_MUNIC) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DT_VALIDADE_ALVARA_MUNIC := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_VALIDADE_ALVARA_SANIT', c01_w.DT_VALIDADE_ALVARA_SANIT, 'N', pessoa_juridica_w.DT_VALIDADE_ALVARA_SANIT) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DT_VALIDADE_ALVARA_SANIT := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_VALIDADE_AUTOR_FUNC', c01_w.DT_VALIDADE_AUTOR_FUNC, 'N', pessoa_juridica_w.DT_VALIDADE_AUTOR_FUNC) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DT_VALIDADE_AUTOR_FUNC := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_VALIDADE_CERT_BOAS_PRAT', c01_w.DT_VALIDADE_CERT_BOAS_PRAT, 'N', pessoa_juridica_w.DT_VALIDADE_CERT_BOAS_PRAT) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DT_VALIDADE_CERT_BOAS_PRAT := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_VALIDADE_RESP_TECNICO', c01_w.DT_VALIDADE_RESP_TECNICO, 'N', pessoa_juridica_w.DT_VALIDADE_RESP_TECNICO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.DT_VALIDADE_RESP_TECNICO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_ALTERAR_SENHA', c01_w.IE_ALTERAR_SENHA, 'N', pessoa_juridica_w.IE_ALTERAR_SENHA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.IE_ALTERAR_SENHA := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_EMPREENDEDOR_INDIVIDUAL', c01_w.IE_EMPREENDEDOR_INDIVIDUAL, 'N', pessoa_juridica_w.IE_EMPREENDEDOR_INDIVIDUAL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.IE_EMPREENDEDOR_INDIVIDUAL := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_FORMA_REVISAO', c01_w.IE_FORMA_REVISAO, 'N', pessoa_juridica_w.IE_FORMA_REVISAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.IE_FORMA_REVISAO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_FORNECEDOR_OPME', c01_w.IE_FORNECEDOR_OPME, 'N', pessoa_juridica_w.IE_FORNECEDOR_OPME) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.IE_FORNECEDOR_OPME := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_PROD_FABRIC', c01_w.IE_PROD_FABRIC, 'N', pessoa_juridica_w.IE_PROD_FABRIC) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.IE_PROD_FABRIC := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_QUALIDADE', c01_w.IE_QUALIDADE, 'N', pessoa_juridica_w.IE_QUALIDADE) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.IE_QUALIDADE := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_SITUACAO', c01_w.IE_SITUACAO, 'N', pessoa_juridica_w.IE_SITUACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.IE_SITUACAO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_STATUS_ENVIO', c01_w.IE_STATUS_ENVIO, 'N', pessoa_juridica_w.IE_STATUS_ENVIO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.IE_STATUS_ENVIO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_STATUS_EXPORTAR', c01_w.IE_STATUS_EXPORTAR, 'N', pessoa_juridica_w.IE_STATUS_EXPORTAR) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.IE_STATUS_EXPORTAR := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_TIPO_TRIB_MUNICIPAL', c01_w.IE_TIPO_TRIB_MUNICIPAL, 'N', pessoa_juridica_w.IE_TIPO_TRIB_MUNICIPAL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.IE_TIPO_TRIB_MUNICIPAL := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_TIPO_TRIBUTACAO', c01_w.IE_TIPO_TRIBUTACAO, 'N', pessoa_juridica_w.IE_TIPO_TRIBUTACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.IE_TIPO_TRIBUTACAO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_TRANSPORTE', c01_w.IE_TRANSPORTE, 'N', pessoa_juridica_w.IE_TRANSPORTE) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.IE_TRANSPORTE := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NM_FANTASIA', c01_w.NM_FANTASIA, 'N', pessoa_juridica_w.NM_FANTASIA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NM_FANTASIA := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NM_PESSOA_CONTATO', c01_w.NM_PESSOA_CONTATO, 'N', pessoa_juridica_w.NM_PESSOA_CONTATO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NM_PESSOA_CONTATO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NM_USUARIO_REVISAO', c01_w.NM_USUARIO_REVISAO, 'N', pessoa_juridica_w.NM_USUARIO_REVISAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NM_USUARIO_REVISAO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_ALVARA_SANITARIO', c01_w.NR_ALVARA_SANITARIO, 'N', pessoa_juridica_w.NR_ALVARA_SANITARIO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NR_ALVARA_SANITARIO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_ALVARA_SANITARIO_MUNIC', c01_w.NR_ALVARA_SANITARIO_MUNIC, 'N', pessoa_juridica_w.NR_ALVARA_SANITARIO_MUNIC) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NR_ALVARA_SANITARIO_MUNIC := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_AUTOR_FUNC', c01_w.NR_AUTOR_FUNC, 'N', pessoa_juridica_w.NR_AUTOR_FUNC) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NR_AUTOR_FUNC := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_CCM', c01_w.NR_CCM, 'N', pessoa_juridica_w.NR_CCM) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NR_CCM := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_CEI', c01_w.NR_CEI, 'N', pessoa_juridica_w.NR_CEI) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NR_CEI := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_CERTIFICADO_BOAS_PRAT', c01_w.NR_CERTIFICADO_BOAS_PRAT, 'N', pessoa_juridica_w.NR_CERTIFICADO_BOAS_PRAT) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NR_CERTIFICADO_BOAS_PRAT := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_DDD_FAX', c01_w.NR_DDD_FAX, 'N', pessoa_juridica_w.NR_DDD_FAX) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NR_DDD_FAX := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_DDD_TELEFONE', c01_w.NR_DDD_TELEFONE, 'N', pessoa_juridica_w.NR_DDD_TELEFONE) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NR_DDD_TELEFONE := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_DDI_FAX', c01_w.NR_DDI_FAX, 'N', pessoa_juridica_w.NR_DDI_FAX) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NR_DDI_FAX := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_DDI_TELEFONE', c01_w.NR_DDI_TELEFONE, 'N', pessoa_juridica_w.NR_DDI_TELEFONE) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NR_DDI_TELEFONE := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_ENDERECO', c01_w.NR_ENDERECO, 'N', pessoa_juridica_w.NR_ENDERECO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NR_ENDERECO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_FAX', c01_w.NR_FAX, 'N', pessoa_juridica_w.NR_FAX) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NR_FAX := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_INSCRICAO_ESTADUAL', c01_w.NR_INSCRICAO_ESTADUAL, 'N', pessoa_juridica_w.NR_INSCRICAO_ESTADUAL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NR_INSCRICAO_ESTADUAL := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_INSCRICAO_MUNICIPAL', c01_w.NR_INSCRICAO_MUNICIPAL, 'N', pessoa_juridica_w.NR_INSCRICAO_MUNICIPAL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NR_INSCRICAO_MUNICIPAL := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_MATRICULA_CEI', c01_w.NR_MATRICULA_CEI, 'N', pessoa_juridica_w.NR_MATRICULA_CEI) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NR_MATRICULA_CEI := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_RAMAL_CONTATO', c01_w.NR_RAMAL_CONTATO, 'N', pessoa_juridica_w.NR_RAMAL_CONTATO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NR_RAMAL_CONTATO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_REGISTRO_PLS', c01_w.NR_REGISTRO_PLS, 'N', pessoa_juridica_w.NR_REGISTRO_PLS) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NR_REGISTRO_PLS := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_REGISTRO_RESP_TECNICO', c01_w.NR_REGISTRO_RESP_TECNICO, 'N', pessoa_juridica_w.NR_REGISTRO_RESP_TECNICO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NR_REGISTRO_RESP_TECNICO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_IDIOMA', c01_w.NR_SEQ_IDIOMA, 'N', pessoa_juridica_w.NR_SEQ_IDIOMA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NR_SEQ_IDIOMA := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_PAIS', c01_w.NR_SEQ_PAIS, 'S', pessoa_juridica_w.NR_SEQ_PAIS) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NR_SEQ_PAIS := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_TELEFONE', c01_w.NR_TELEFONE, 'N', pessoa_juridica_w.NR_TELEFONE) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.NR_TELEFONE := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'QT_DIA_PRAZO_ENTREGA', c01_w.QT_DIA_PRAZO_ENTREGA, 'N', pessoa_juridica_w.QT_DIA_PRAZO_ENTREGA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.QT_DIA_PRAZO_ENTREGA := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'SG_ESTADO', c01_w.SG_ESTADO, 'N', pessoa_juridica_w.SG_ESTADO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.SG_ESTADO := _ora2pg_r.ds_valor_retorno_p;
    SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'VL_MINIMO_NF', c01_w.VL_MINIMO_NF, 'N', pessoa_juridica_w.VL_MINIMO_NF) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.VL_MINIMO_NF := _ora2pg_r.ds_valor_retorno_p;
    pessoa_juridica_w.nm_usuario    := 'TASY';
    pessoa_juridica_w.dt_atualizacao  := clock_timestamp();
    pessoa_juridica_w.nm_usuario_nrec := 'TASY';
    pessoa_juridica_w.dt_atualizacao_nrec := clock_timestamp();


    /*Espanhol  - Mexico(MX)
    No mexico nao tem CNPJ, por isso esse tratamento para gerar o CNPJ automatico.
    O tratamento deve ser feito pelo RFC.*/
    if (pessoa_juridica_w.cd_rfc IS NOT NULL AND pessoa_juridica_w.cd_rfc::text <> '') then
      nr_doc_externo_w := pessoa_juridica_w.cd_rfc;

      if (reg_integracao_w.qt_reg_log = 0) then

        pessoa_juridica_w.cd_cgc := c01_w.cd_cgc;

        select  count(*)
        into STRICT  qt_registros_w
        from  pessoa_juridica
        where cd_cgc = pessoa_juridica_w.cd_cgc  LIMIT 1;

        if (coalesce(upper(c01_w.ie_action),'INSERT') = 'UPDATE') then
          begin

          if (ie_ajustar_upd_ins_w = 'N') and /*Quando o sistema externo manda um UPDATE mas o registro nao existe no Tasy. Neste caso se o campo IE_AJUSTAR_UPD_INS_W esta para N, retornaremos mensagem de erro para o sistema externo.*/
            (qt_registros_w = 0) then
            /*Nao ha no sistema pessoa juridica com este codigo, portanto nao e possivel realizar a alteracao. Favor enviar uma operacao "Insert" caso queira adicionar este registro no Tasy.*/

            intpd_gravar_log_recebimento(nr_sequencia_p,wheb_mensagem_pck.get_texto(1050901),'INTPDTASY','0013');
            ie_erro_w := 'S';
          end if;
          end;

        elsif (coalesce(upper(c01_w.ie_action),'INSERT') = 'INSERT') then
          begin

          if (ie_ajustar_ins_upd_w = 'N') and /*Quando o sistema externo manda um INSERT mas o registro ja existe no Tasy. Neste caso se o campo IE_AJUSTAR_INS_UPD esta para N, retornaremos mensagem de erro para o sistema externo.*/
            (qt_registros_w > 0) then
            /*Ja ha pessoa juridica cadastrada com esses dados, portanto nao e possivel realizar a insercao. Favor enviar uma operacao "Update" caso queira atualizar este registro no Tasy.*/

            intpd_gravar_log_recebimento(nr_sequencia_p,wheb_mensagem_pck.get_texto(1050906),'INTPDTASY','0014');
            ie_erro_w := 'S';
          end if;
          end;
        end if;

        if (ie_erro_w = 'N') then
          begin
          if (qt_registros_w > 0) then
            update  pessoa_juridica
            set row = pessoa_juridica_w
            where cd_cgc = pessoa_juridica_w.cd_cgc;
          else
            /*CD_CGC nulo, parametro OUT, codigo gerado pela procedure*/

            pessoa_juridica_w.cd_cgc := gerar_codigo_pj_int(pessoa_juridica_w.cd_cgc, 2, pessoa_juridica_w.nm_usuario);

            -- Verifica se ha regra de pre cadastro para o tipo de pessoa juridica
            select coalesce(max(cd_tipo_pessoa),0)
              into STRICT cd_regra_w
              from ( SELECT cd_tipo_pessoa
                       from regra_pre_cad_pj
                      where cd_tipo_pessoa = pessoa_juridica_w.cd_tipo_pessoa
                        and ie_exige_aprov_cadastro = 'S'

union

                     SELECT cd_tipo_pessoa
                       from regra_pre_cad_pj
                      where coalesce(cd_tipo_pessoa::text, '') = ''
                        and ie_exige_aprov_cadastro = 'S' ) alias3;

            -- Se houver, insere na tabela PRE_PESSOA_JURIDICA
            if cd_regra_w <> 0 then

              insert into pre_pessoa_juridica(
                  cd_ans
                , cd_cep
                , cd_cgc
                , cd_cgc_mantenedora
                , cd_cnes
                , cd_cnpj_raiz
                , cd_cond_pagto
                , cd_conta_contabil
                , cd_curp
                , cd_cvm
                , cd_internacional
                , cd_municipio_ibge
                , cd_operadora_empresa
                , cd_pf_resp_tecnico
                , cd_portador
                , cd_referencia_fornec
                , cd_rfc
                , cd_sistema_ant
                , cd_tipo_pessoa
                , cd_tipo_portador
                , ds_bairro
                , ds_complemento
                , ds_email
                , ds_endereco
                , ds_municipio
                , ds_nome_abrev
                , ds_observacao
                , ds_observacao_compl
                , ds_orgao_reg_resp_tecnico
                , ds_orientacao_cobranca
                , ds_razao_social
                , ds_resp_tecnico
                , cd_pj_cod
                , ds_site_internet
                , dt_criacao
                , dt_integracao
                , dt_integracao_externa
                , dt_ultima_revisao
                , dt_validade_alvara_munic
                , dt_validade_alvara_sanit
                , dt_validade_autor_func
                , dt_validade_cert_boas_prat
                , dt_validade_resp_tecnico
                , ie_alterar_senha
                , ie_empreendedor_individual
                , ie_forma_revisao
                , ie_fornecedor_opme
                , ie_prod_fabric
                , ie_qualidade
                , ie_situacao
                , ie_status_envio
                , ie_status_exportar
                , ie_tipo_trib_municipal
                , ie_tipo_tributacao
                , ie_transporte
                , nm_fantasia
                , nm_pessoa_contato
                , nm_usuario_revisao
                , nr_alvara_sanitario
                , nr_alvara_sanitario_munic
                , nr_autor_func
                , nr_ccm
                , nr_cei
                , nr_certificado_boas_prat
                , nr_ddd_fax
                , nr_ddd_telefone
                , nr_ddi_fax
                , nr_ddi_telefone
                , nr_endereco
                , nr_fax
                , nr_inscricao_estadual
                , nr_inscricao_municipal
                , nr_matricula_cei
                , nr_ramal_contato
                , nr_registro_pls
                , nr_registro_resp_tecnico
                , nr_seq_idioma
                , nr_seq_pais
                , nr_telefone
                , qt_dia_prazo_entrega
                , sg_estado
                , vl_minimo_nf
                , nm_usuario
                , dt_atualizacao
                , nm_usuario_nrec
                , dt_atualizacao_nrec
                , nm_usuario_lib
                , dt_liberacao
                , nr_sequencia)
              values (
                  pessoa_juridica_w.cd_ans
                , pessoa_juridica_w.cd_cep
                , pessoa_juridica_w.cd_cgc
                , pessoa_juridica_w.cd_cgc_mantenedora
                , pessoa_juridica_w.cd_cnes
                , pessoa_juridica_w.cd_cnpj_raiz
                , pessoa_juridica_w.cd_cond_pagto
                , pessoa_juridica_w.cd_conta_contabil
                , pessoa_juridica_w.cd_curp
                , pessoa_juridica_w.cd_cvm
                , pessoa_juridica_w.cd_internacional
                , pessoa_juridica_w.cd_municipio_ibge
                , pessoa_juridica_w.cd_operadora_empresa
                , pessoa_juridica_w.cd_pf_resp_tecnico
                , pessoa_juridica_w.cd_portador
                , pessoa_juridica_w.cd_referencia_fornec
                , pessoa_juridica_w.cd_rfc
                , pessoa_juridica_w.cd_sistema_ant
                , pessoa_juridica_w.cd_tipo_pessoa
                , pessoa_juridica_w.cd_tipo_portador
                , pessoa_juridica_w.ds_bairro
                , pessoa_juridica_w.ds_complemento
                , pessoa_juridica_w.ds_email
                , pessoa_juridica_w.ds_endereco
                , pessoa_juridica_w.ds_municipio
                , pessoa_juridica_w.ds_nome_abrev
                , pessoa_juridica_w.ds_observacao
                , pessoa_juridica_w.ds_observacao_compl
                , pessoa_juridica_w.ds_orgao_reg_resp_tecnico
                , pessoa_juridica_w.ds_orientacao_cobranca
                , pessoa_juridica_w.ds_razao_social
                , pessoa_juridica_w.ds_resp_tecnico
                , null
                , pessoa_juridica_w.ds_site_internet
                , pessoa_juridica_w.dt_criacao
                , pessoa_juridica_w.dt_integracao
                , pessoa_juridica_w.dt_integracao_externa
                , pessoa_juridica_w.dt_ultima_revisao
                , pessoa_juridica_w.dt_validade_alvara_munic
                , pessoa_juridica_w.dt_validade_alvara_sanit
                , pessoa_juridica_w.dt_validade_autor_func
                , pessoa_juridica_w.dt_validade_cert_boas_prat
                , pessoa_juridica_w.dt_validade_resp_tecnico
                , pessoa_juridica_w.ie_alterar_senha
                , pessoa_juridica_w.ie_empreendedor_individual
                , pessoa_juridica_w.ie_forma_revisao
                , pessoa_juridica_w.ie_fornecedor_opme
                , pessoa_juridica_w.ie_prod_fabric
                , pessoa_juridica_w.ie_qualidade
                , pessoa_juridica_w.ie_situacao
                , pessoa_juridica_w.ie_status_envio
                , pessoa_juridica_w.ie_status_exportar
                , pessoa_juridica_w.ie_tipo_trib_municipal
                , pessoa_juridica_w.ie_tipo_tributacao
                , pessoa_juridica_w.ie_transporte
                , pessoa_juridica_w.nm_fantasia
                , pessoa_juridica_w.nm_pessoa_contato
                , pessoa_juridica_w.nm_usuario_revisao
                , pessoa_juridica_w.nr_alvara_sanitario
                , pessoa_juridica_w.nr_alvara_sanitario_munic
                , pessoa_juridica_w.nr_autor_func
                , pessoa_juridica_w.nr_ccm
                , pessoa_juridica_w.nr_cei
                , pessoa_juridica_w.nr_certificado_boas_prat
                , pessoa_juridica_w.nr_ddd_fax
                , pessoa_juridica_w.nr_ddd_telefone
                , pessoa_juridica_w.nr_ddi_fax
                , pessoa_juridica_w.nr_ddi_telefone
                , pessoa_juridica_w.nr_endereco
                , pessoa_juridica_w.nr_fax
                , pessoa_juridica_w.nr_inscricao_estadual
                , pessoa_juridica_w.nr_inscricao_municipal
                , pessoa_juridica_w.nr_matricula_cei
                , pessoa_juridica_w.nr_ramal_contato
                , pessoa_juridica_w.nr_registro_pls
                , pessoa_juridica_w.nr_registro_resp_tecnico
                , pessoa_juridica_w.nr_seq_idioma
                , pessoa_juridica_w.nr_seq_pais
                , pessoa_juridica_w.nr_telefone
                , pessoa_juridica_w.qt_dia_prazo_entrega
                , pessoa_juridica_w.sg_estado
                , pessoa_juridica_w.vl_minimo_nf
                , pessoa_juridica_w.nm_usuario
                , pessoa_juridica_w.dt_atualizacao
                , pessoa_juridica_w.nm_usuario_nrec
                , pessoa_juridica_w.dt_atualizacao_nrec
                , pessoa_juridica_w.nm_usuario
                , clock_timestamp()
                , nextval('pre_pessoa_juridica_seq'));
            else
              insert into pessoa_juridica values (pessoa_juridica_w.*);
            end if;

          end if;

          /*'Registra a conversao que podera ser utilizada em outros pontos de integracao e para somente atualizar (update) num recebimento futuro do mesmo registro.'*/

          if (nr_seq_regra_w > 0) then
            CALL gerar_conv_meio_externo(null, 'PESSOA_JURIDICA', 'CD_CGC', pessoa_juridica_w.cd_cgc, c01_w.CD_RFC, null, nr_seq_regra_w, 'A', pessoa_juridica_w.nm_usuario);
          end if;
          end;
        end if;
      end if;
    else

      SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_CGC', c01_w.CD_CGC, 'N', pessoa_juridica_w.CD_CGC) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_w.CD_CGC := _ora2pg_r.ds_valor_retorno_p;
      nr_doc_externo_w := coalesce(pessoa_juridica_w.CD_SISTEMA_ANT, pessoa_juridica_w.CD_CGC);

      if (reg_integracao_w.qt_reg_log = 0) then

        select  count(*)
        into STRICT  qt_registros_w
        from  pessoa_juridica
        where cd_cgc = pessoa_juridica_w.cd_cgc;

        if (coalesce(upper(c01_w.ie_action),'INSERT') = 'UPDATE') then
          begin

          if (ie_ajustar_upd_ins_w = 'N') and /*Quando o sistema externo manda um UPDATE mas o registro nao existe no Tasy. Neste caso se o campo IE_AJUSTAR_UPD_INS_W esta para N, retornaremos mensagem de erro para o sistema externo.*/
            (qt_registros_w = 0) then
            /*Nao ha no sistema pessoa juridica com este codigo, portanto nao e possivel realizar a alteracao. Favor enviar uma operacao "Insert" caso queira adicionar este registro no Tasy.*/

            intpd_gravar_log_recebimento(nr_sequencia_p,wheb_mensagem_pck.get_texto(1050901),'INTPDTASY','0013');
            ie_erro_w := 'S';
          end if;
          end;

        elsif (coalesce(upper(c01_w.ie_action),'INSERT') = 'INSERT') then
          begin
          if (ie_ajustar_ins_upd_w = 'N') and /*Quando o sistema externo manda um INSERT mas o registro ja existe no Tasy. Neste caso se o campo IE_AJUSTAR_INS_UPD esta para N, retornaremos mensagem de erro para o sistema externo.*/
            (qt_registros_w > 0) then
            /*Ja ha pessoa juridica cadastrada com esses dados, portanto nao e possivel realizar a insercao. Favor enviar uma operacao "Update" caso queira atualizar este registro no Tasy.*/

            intpd_gravar_log_recebimento(nr_sequencia_p,wheb_mensagem_pck.get_texto(1050906),'INTPDTASY','0014');
            ie_erro_w := 'S';
          end if;
          end;
        end if;

        if (ie_erro_w = 'N') then
          begin

          if (qt_registros_w > 0) then
            update  pessoa_juridica
            set row = pessoa_juridica_w
            where cd_cgc = pessoa_juridica_w.cd_cgc;
          else
            -- Verifica se ha regra de pre cadastro para o tipo de pessoa juridica
            select coalesce(max(cd_tipo_pessoa),0)
              into STRICT cd_regra_w
              from ( SELECT cd_tipo_pessoa
                       from regra_pre_cad_pj
                      where cd_tipo_pessoa = pessoa_juridica_w.cd_tipo_pessoa
                        and ie_exige_aprov_cadastro = 'S'

union

                     SELECT cd_tipo_pessoa
                       from regra_pre_cad_pj
                      where coalesce(cd_tipo_pessoa::text, '') = ''
                        and ie_exige_aprov_cadastro = 'S' ) alias3;

            -- Se houver, insere na tabela PRE_PESSOA_JURIDICA
            if cd_regra_w <> 0 then

              insert into pre_pessoa_juridica(
                  cd_ans
                , cd_cep
                , cd_cgc
                , cd_cgc_mantenedora
                , cd_cnes
                , cd_cnpj_raiz
                , cd_cond_pagto
                , cd_conta_contabil
                , cd_curp
                , cd_cvm
                , cd_internacional
                , cd_municipio_ibge
                , cd_operadora_empresa
                , cd_pf_resp_tecnico
                , cd_portador
                , cd_referencia_fornec
                , cd_rfc
                , cd_sistema_ant
                , cd_tipo_pessoa
                , cd_tipo_portador
                , ds_bairro
                , ds_complemento
                , ds_email
                , ds_endereco
                , ds_municipio
                , ds_nome_abrev
                , ds_observacao
                , ds_observacao_compl
                , ds_orgao_reg_resp_tecnico
                , ds_orientacao_cobranca
                , ds_razao_social
                , ds_resp_tecnico
                , cd_pj_cod
                , ds_site_internet
                , dt_criacao
                , dt_integracao
                , dt_integracao_externa
                , dt_ultima_revisao
                , dt_validade_alvara_munic
                , dt_validade_alvara_sanit
                , dt_validade_autor_func
                , dt_validade_cert_boas_prat
                , dt_validade_resp_tecnico
                , ie_alterar_senha
                , ie_empreendedor_individual
                , ie_forma_revisao
                , ie_fornecedor_opme
                , ie_prod_fabric
                , ie_qualidade
                , ie_situacao
                , ie_status_envio
                , ie_status_exportar
                , ie_tipo_trib_municipal
                , ie_tipo_tributacao
                , ie_transporte
                , nm_fantasia
                , nm_pessoa_contato
                , nm_usuario_revisao
                , nr_alvara_sanitario
                , nr_alvara_sanitario_munic
                , nr_autor_func
                , nr_ccm
                , nr_cei
                , nr_certificado_boas_prat
                , nr_ddd_fax
                , nr_ddd_telefone
                , nr_ddi_fax
                , nr_ddi_telefone
                , nr_endereco
                , nr_fax
                , nr_inscricao_estadual
                , nr_inscricao_municipal
                , nr_matricula_cei
                , nr_ramal_contato
                , nr_registro_pls
                , nr_registro_resp_tecnico
                , nr_seq_idioma
                , nr_seq_pais
                , nr_telefone
                , qt_dia_prazo_entrega
                , sg_estado
                , vl_minimo_nf
                , nm_usuario
                , dt_atualizacao
                , nm_usuario_nrec
                , dt_atualizacao_nrec
                , nm_usuario_lib
                , dt_liberacao
                , nr_sequencia)
              values (
                  pessoa_juridica_w.cd_ans
                , pessoa_juridica_w.cd_cep
                , pessoa_juridica_w.cd_cgc
                , pessoa_juridica_w.cd_cgc_mantenedora
                , pessoa_juridica_w.cd_cnes
                , pessoa_juridica_w.cd_cnpj_raiz
                , pessoa_juridica_w.cd_cond_pagto
                , pessoa_juridica_w.cd_conta_contabil
                , pessoa_juridica_w.cd_curp
                , pessoa_juridica_w.cd_cvm
                , pessoa_juridica_w.cd_internacional
                , pessoa_juridica_w.cd_municipio_ibge
                , pessoa_juridica_w.cd_operadora_empresa
                , pessoa_juridica_w.cd_pf_resp_tecnico
                , pessoa_juridica_w.cd_portador
                , pessoa_juridica_w.cd_referencia_fornec
                , pessoa_juridica_w.cd_rfc
                , pessoa_juridica_w.cd_sistema_ant
                , pessoa_juridica_w.cd_tipo_pessoa
                , pessoa_juridica_w.cd_tipo_portador
                , pessoa_juridica_w.ds_bairro
                , pessoa_juridica_w.ds_complemento
                , pessoa_juridica_w.ds_email
                , pessoa_juridica_w.ds_endereco
                , pessoa_juridica_w.ds_municipio
                , pessoa_juridica_w.ds_nome_abrev
                , pessoa_juridica_w.ds_observacao
                , pessoa_juridica_w.ds_observacao_compl
                , pessoa_juridica_w.ds_orgao_reg_resp_tecnico
                , pessoa_juridica_w.ds_orientacao_cobranca
                , pessoa_juridica_w.ds_razao_social
                , pessoa_juridica_w.ds_resp_tecnico
                , null
                , pessoa_juridica_w.ds_site_internet
                , pessoa_juridica_w.dt_criacao
                , pessoa_juridica_w.dt_integracao
                , pessoa_juridica_w.dt_integracao_externa
                , pessoa_juridica_w.dt_ultima_revisao
                , pessoa_juridica_w.dt_validade_alvara_munic
                , pessoa_juridica_w.dt_validade_alvara_sanit
                , pessoa_juridica_w.dt_validade_autor_func
                , pessoa_juridica_w.dt_validade_cert_boas_prat
                , pessoa_juridica_w.dt_validade_resp_tecnico
                , pessoa_juridica_w.ie_alterar_senha
                , pessoa_juridica_w.ie_empreendedor_individual
                , pessoa_juridica_w.ie_forma_revisao
                , pessoa_juridica_w.ie_fornecedor_opme
                , pessoa_juridica_w.ie_prod_fabric
                , pessoa_juridica_w.ie_qualidade
                , pessoa_juridica_w.ie_situacao
                , pessoa_juridica_w.ie_status_envio
                , pessoa_juridica_w.ie_status_exportar
                , pessoa_juridica_w.ie_tipo_trib_municipal
                , pessoa_juridica_w.ie_tipo_tributacao
                , pessoa_juridica_w.ie_transporte
                , pessoa_juridica_w.nm_fantasia
                , pessoa_juridica_w.nm_pessoa_contato
                , pessoa_juridica_w.nm_usuario_revisao
                , pessoa_juridica_w.nr_alvara_sanitario
                , pessoa_juridica_w.nr_alvara_sanitario_munic
                , pessoa_juridica_w.nr_autor_func
                , pessoa_juridica_w.nr_ccm
                , pessoa_juridica_w.nr_cei
                , pessoa_juridica_w.nr_certificado_boas_prat
                , pessoa_juridica_w.nr_ddd_fax
                , pessoa_juridica_w.nr_ddd_telefone
                , pessoa_juridica_w.nr_ddi_fax
                , pessoa_juridica_w.nr_ddi_telefone
                , pessoa_juridica_w.nr_endereco
                , pessoa_juridica_w.nr_fax
                , pessoa_juridica_w.nr_inscricao_estadual
                , pessoa_juridica_w.nr_inscricao_municipal
                , pessoa_juridica_w.nr_matricula_cei
                , pessoa_juridica_w.nr_ramal_contato
                , pessoa_juridica_w.nr_registro_pls
                , pessoa_juridica_w.nr_registro_resp_tecnico
                , pessoa_juridica_w.nr_seq_idioma
                , pessoa_juridica_w.nr_seq_pais
                , pessoa_juridica_w.nr_telefone
                , pessoa_juridica_w.qt_dia_prazo_entrega
                , pessoa_juridica_w.sg_estado
                , pessoa_juridica_w.vl_minimo_nf
                , pessoa_juridica_w.nm_usuario
                , pessoa_juridica_w.dt_atualizacao
                , pessoa_juridica_w.nm_usuario_nrec
                , pessoa_juridica_w.dt_atualizacao_nrec
                , pessoa_juridica_w.nm_usuario
                , clock_timestamp()
                , nextval('pre_pessoa_juridica_seq'));
            else
              insert into pessoa_juridica values (pessoa_juridica_w.*);
            end if;
          end if;

          /*'Registra a conversao que podera ser utilizada em outros pontos de integracao e para somente atualizar (update) num recebimento futuro do mesmo registro.'*/

          if (nr_seq_regra_w > 0) then
            CALL gerar_conv_meio_externo(null, 'PESSOA_JURIDICA', 'CD_CGC', pessoa_juridica_w.cd_cgc, c01_w.cd_cgc, null, nr_seq_regra_w, 'A', pessoa_juridica_w.nm_usuario);
          end if;

          end;
        end if;
      end if;
    end if;

    if (ie_erro_w = 'N') then

      open c02;
      loop
      fetch c02 into
        c02_w;
      EXIT WHEN NOT FOUND; /* apply on c02 */
        begin

        reg_integracao_w.nm_tabela    :=  'PESSOA_JURIDICA_ESTAB';
        reg_integracao_w.nm_elemento    :=      'ESTABLISHMENT';
        reg_integracao_w.nr_seq_visao   :=  5178;

        pessoa_juridica_estab_w.cd_cgc    :=  pessoa_juridica_w.cd_cgc;

        if (upper(coalesce(c02_w.ie_action,'INSERT')) <> 'DELETE') THEN
          begin

          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_ESTABELECIMENTO', c02_w.CD_ESTABELECIMENTO, 'S', pessoa_juridica_estab_w.CD_ESTABELECIMENTO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.CD_ESTABELECIMENTO := _ora2pg_r.ds_valor_retorno_p;

          if (upper(coalesce(c02_w.ie_action,'INSERT')) = 'UPDATE') then
            begin
            /*'Busca o registro atual do Tasy pela PK'
            Esse tratamento foi necessario porque quando e update, o sistema externo so envia as informacoes alteradas e o restante dos campos eles mandam vazio. Entao temos que buscar a informacao que ja esta gravada na tabela.*/
            select  *
            into STRICT  pessoa_juridica_estab_w
            from  pessoa_juridica_estab
            where cd_cgc      = pessoa_juridica_estab_w.cd_cgc
            and cd_estabelecimento  = pessoa_juridica_estab_w.cd_estabelecimento  LIMIT 1;
            exception
            when others then
              null;
            end;
          end if;

          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_COND_PAGTO', c02_w.CD_COND_PAGTO, 'S', pessoa_juridica_estab_w.CD_COND_PAGTO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.CD_COND_PAGTO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_INTERNO_LAB', c02_w.CD_INTERNO_LAB, 'N', pessoa_juridica_estab_w.CD_INTERNO_LAB) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.CD_INTERNO_LAB := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_OPERACAO_NF', c02_w.CD_OPERACAO_NF, 'S', pessoa_juridica_estab_w.CD_OPERACAO_NF) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.CD_OPERACAO_NF := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_PORTADOR', c02_w.CD_PORTADOR, 'S', pessoa_juridica_estab_w.CD_PORTADOR) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.CD_PORTADOR := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_REFERENCIA_FORNEC', c02_w.CD_REFERENCIA_FORNEC, 'N', pessoa_juridica_estab_w.CD_REFERENCIA_FORNEC) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.CD_REFERENCIA_FORNEC := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_SISTEMA_ANT', c02_w.CD_SISTEMA_ANT, 'N', pessoa_juridica_estab_w.CD_SISTEMA_ANT) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.CD_SISTEMA_ANT := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_TIPO_BAIXA', c02_w.CD_TIPO_BAIXA, 'S', pessoa_juridica_estab_w.CD_TIPO_BAIXA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.CD_TIPO_BAIXA := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_TIPO_PORTADOR', c02_w.CD_TIPO_PORTADOR, 'N', pessoa_juridica_estab_w.CD_TIPO_PORTADOR) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.CD_TIPO_PORTADOR := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_EMAIL', c02_w.DS_EMAIL, 'N', pessoa_juridica_estab_w.DS_EMAIL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.DS_EMAIL := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_BAIXA_ABAT', c02_w.IE_BAIXA_ABAT, 'N', pessoa_juridica_estab_w.IE_BAIXA_ABAT) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.IE_BAIXA_ABAT := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_CONSISTE_NR_SERIE_NF', c02_w.IE_CONSISTE_NR_SERIE_NF, 'N', pessoa_juridica_estab_w.IE_CONSISTE_NR_SERIE_NF) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.IE_CONSISTE_NR_SERIE_NF := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_CONTA_DIF_NF', c02_w.IE_CONTA_DIF_NF, 'N', pessoa_juridica_estab_w.IE_CONTA_DIF_NF) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.IE_CONTA_DIF_NF := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_ENDERECO_CORRESPONDENCIA', c02_w.IE_ENDERECO_CORRESPONDENCIA, 'N', pessoa_juridica_estab_w.IE_ENDERECO_CORRESPONDENCIA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.IE_ENDERECO_CORRESPONDENCIA := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_EXIGE_ANEXO_NF', c02_w.IE_EXIGE_ANEXO_NF, 'N', pessoa_juridica_estab_w.IE_EXIGE_ANEXO_NF) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.IE_EXIGE_ANEXO_NF := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_EXIGE_ORDEM_COMPRA', c02_w.IE_EXIGE_ORDEM_COMPRA, 'N', pessoa_juridica_estab_w.IE_EXIGE_ORDEM_COMPRA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.IE_EXIGE_ORDEM_COMPRA := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_FORMA_PAGTO', c02_w.IE_FORMA_PAGTO, 'N', pessoa_juridica_estab_w.IE_FORMA_PAGTO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.IE_FORMA_PAGTO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_FRETE', c02_w.IE_FRETE, 'N', pessoa_juridica_estab_w.IE_FRETE) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.IE_FRETE := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_MOEDA_ESTRANGEIRA', c02_w.IE_MOEDA_ESTRANGEIRA, 'N', pessoa_juridica_estab_w.IE_MOEDA_ESTRANGEIRA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.IE_MOEDA_ESTRANGEIRA := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_QUALIDADE', c02_w.IE_QUALIDADE, 'N', pessoa_juridica_estab_w.IE_QUALIDADE) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.IE_QUALIDADE := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_RATEIO_ADIANT', c02_w.IE_RATEIO_ADIANT, 'N', pessoa_juridica_estab_w.IE_RATEIO_ADIANT) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.IE_RATEIO_ADIANT := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_REC_EMAIL_COMERCIAL', c02_w.IE_REC_EMAIL_COMERCIAL, 'N', pessoa_juridica_estab_w.IE_REC_EMAIL_COMERCIAL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.IE_REC_EMAIL_COMERCIAL := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_RETEM_ISS', c02_w.IE_RETEM_ISS, 'N', pessoa_juridica_estab_w.IE_RETEM_ISS) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.IE_RETEM_ISS := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_STATUS_APENADO', c02_w.IE_STATUS_APENADO, 'N', pessoa_juridica_estab_w.IE_STATUS_APENADO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.IE_STATUS_APENADO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NM_PESSOA_CONTATO', c02_w.NM_PESSOA_CONTATO, 'N', pessoa_juridica_estab_w.NM_PESSOA_CONTATO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.NM_PESSOA_CONTATO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_CODIGO_SERV_PREST', c02_w.NR_CODIGO_SERV_PREST, 'N', pessoa_juridica_estab_w.NR_CODIGO_SERV_PREST) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.NR_CODIGO_SERV_PREST := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_RAMAL_CONTATO', c02_w.NR_RAMAL_CONTATO, 'N', pessoa_juridica_estab_w.NR_RAMAL_CONTATO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.NR_RAMAL_CONTATO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'PR_DESC_FINANCEIRO', c02_w.PR_DESC_FINANCEIRO, 'N', pessoa_juridica_estab_w.PR_DESC_FINANCEIRO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.PR_DESC_FINANCEIRO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'QT_DIA_PRAZO_ENTREGA', c02_w.QT_DIA_PRAZO_ENTREGA, 'N', pessoa_juridica_estab_w.QT_DIA_PRAZO_ENTREGA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.QT_DIA_PRAZO_ENTREGA := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'TX_DESC_ANTECIPACAO', c02_w.TX_DESC_ANTECIPACAO, 'N', pessoa_juridica_estab_w.TX_DESC_ANTECIPACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.TX_DESC_ANTECIPACAO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'TX_DESC_ASSIDUIDADE', c02_w.TX_DESC_ASSIDUIDADE, 'N', pessoa_juridica_estab_w.TX_DESC_ASSIDUIDADE) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.TX_DESC_ASSIDUIDADE := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'TX_DESC_ORDEM', c02_w.TX_DESC_ORDEM, 'N', pessoa_juridica_estab_w.TX_DESC_ORDEM) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.TX_DESC_ORDEM := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'VL_MINIMO_NF', c02_w.VL_MINIMO_NF, 'N', pessoa_juridica_estab_w.VL_MINIMO_NF) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.VL_MINIMO_NF := _ora2pg_r.ds_valor_retorno_p;
          pessoa_juridica_estab_w.nm_usuario    := 'TASY';
          pessoa_juridica_estab_w.dt_atualizacao    := clock_timestamp();
          pessoa_juridica_estab_w.nm_usuario_nrec   := 'TASY';
          pessoa_juridica_estab_w.dt_atualizacao_nrec := clock_timestamp();

          if (reg_integracao_w.qt_reg_log = 0) then
            begin
            select  coalesce(max(nr_sequencia),0)
            into STRICT  qt_registros_w
            from  pessoa_juridica_estab
            where cd_cgc      = pessoa_juridica_estab_w.cd_cgc
            and cd_estabelecimento  = pessoa_juridica_estab_w.cd_estabelecimento  LIMIT 1;

            if (qt_registros_w > 0) then

              pessoa_juridica_estab_w.nr_sequencia := qt_registros_w;

              update  pessoa_juridica_estab
              set row     = pessoa_juridica_estab_w
              where cd_cgc      = pessoa_juridica_estab_w.cd_cgc
              and cd_estabelecimento  = pessoa_juridica_estab_w.cd_estabelecimento;
            else
              if cd_regra_w <> 0 then
                insert into pre_pessoa_juridica_estab(
                  cd_cgc,
                  cd_estabelecimento,
                  cd_cond_pagto,
                  cd_interno_lab,
                  cd_operacao_nf,
                  cd_portador,
                  cd_referencia_fornec,
                  cd_sistema_ant,
                  cd_tipo_baixa,
                  cd_tipo_portador,
                  ds_email,
                  ie_baixa_abat,
                  ie_consiste_nr_serie_nf,
                  ie_conta_dif_nf,
                  ie_endereco_correspondencia,
                  ie_exige_anexo_nf,
                  ie_exige_ordem_compra,
                  ie_forma_pagto,
                  ie_frete,
                  ie_moeda_estrangeira,
                  ie_qualidade,
                  ie_rateio_adiant,
                  ie_rec_email_comercial,
                  ie_retem_iss,
                  ie_status_apenado,
                  nm_pessoa_contato,
                  nr_codigo_serv_prest,
                  nr_ramal_contato,
                  pr_desc_financeiro,
                  qt_dia_prazo_entrega,
                  tx_desc_antecipacao,
                  tx_desc_assiduidade,
                  tx_desc_ordem,
                  vl_minimo_nf,
                  nm_usuario,
                  dt_atualizacao,
                  nm_usuario_nrec,
                  dt_atualizacao_nrec,
                  nr_seq_pre_pj)
                values (
                  pessoa_juridica_estab_w.cd_cgc,
                  pessoa_juridica_estab_w.cd_estabelecimento,
                  pessoa_juridica_estab_w.cd_cond_pagto,
                  pessoa_juridica_estab_w.cd_interno_lab,
                  pessoa_juridica_estab_w.cd_operacao_nf,
                  pessoa_juridica_estab_w.cd_portador,
                  pessoa_juridica_estab_w.cd_referencia_fornec,
                  pessoa_juridica_estab_w.cd_sistema_ant,
                  pessoa_juridica_estab_w.cd_tipo_baixa,
                  pessoa_juridica_estab_w.cd_tipo_portador,
                  pessoa_juridica_estab_w.ds_email,
                  pessoa_juridica_estab_w.ie_baixa_abat,
                  pessoa_juridica_estab_w.ie_consiste_nr_serie_nf,
                  pessoa_juridica_estab_w.ie_conta_dif_nf,
                  pessoa_juridica_estab_w.ie_endereco_correspondencia,
                  pessoa_juridica_estab_w.ie_exige_anexo_nf,
                  pessoa_juridica_estab_w.ie_exige_ordem_compra,
                  pessoa_juridica_estab_w.ie_forma_pagto,
                  pessoa_juridica_estab_w.ie_frete,
                  pessoa_juridica_estab_w.ie_moeda_estrangeira,
                  pessoa_juridica_estab_w.ie_qualidade,
                  pessoa_juridica_estab_w.ie_rateio_adiant,
                  pessoa_juridica_estab_w.ie_rec_email_comercial,
                  pessoa_juridica_estab_w.ie_retem_iss,
                  pessoa_juridica_estab_w.ie_status_apenado,
                  pessoa_juridica_estab_w.nm_pessoa_contato,
                  pessoa_juridica_estab_w.nr_codigo_serv_prest,
                  pessoa_juridica_estab_w.nr_ramal_contato,
                  pessoa_juridica_estab_w.pr_desc_financeiro,
                  pessoa_juridica_estab_w.qt_dia_prazo_entrega,
                  pessoa_juridica_estab_w.tx_desc_antecipacao,
                  pessoa_juridica_estab_w.tx_desc_assiduidade,
                  pessoa_juridica_estab_w.tx_desc_ordem,
                  pessoa_juridica_estab_w.vl_minimo_nf,
                  pessoa_juridica_estab_w.nm_usuario,
                  pessoa_juridica_estab_w.dt_atualizacao,
                  pessoa_juridica_estab_w.nm_usuario_nrec,
                  pessoa_juridica_estab_w.dt_atualizacao_nrec,
                  currval('pre_pessoa_juridica_seq'));
              else
                select  nextval('pessoa_juridica_estab_seq')
                into STRICT  pessoa_juridica_estab_w.nr_sequencia
;

                insert into pessoa_juridica_estab values (pessoa_juridica_estab_w.*);
              end if;
            end if;
            end;
          end if;
          end;
        else
          begin
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_ESTABELECIMENTO', c02_w.CD_ESTABELECIMENTO, 'S', pessoa_juridica_estab_w.CD_ESTABELECIMENTO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_estab_w.CD_ESTABELECIMENTO := _ora2pg_r.ds_valor_retorno_p;

          if (reg_integracao_w.qt_reg_log = 0) then

            delete  FROM pessoa_juridica_estab
            where cd_cgc      = pessoa_juridica_w.cd_cgc
            and cd_estabelecimento  = pessoa_juridica_estab_w.CD_ESTABELECIMENTO;
          end if;
          end;
        end if;
        end;
      end loop;
      close c02;

      open c03;
      loop
      fetch c03 into
        c03_w;
      EXIT WHEN NOT FOUND; /* apply on c03 */
        begin
        reg_integracao_w.nm_tabela    :=  'PESSOA_JURIDICA_COMPL';
        reg_integracao_w.nm_elemento    :=  'COMPLEMENT';
        reg_integracao_w.nr_seq_visao   :=  8467;

        pessoa_juridica_compl_w.cd_cgc    :=  pessoa_juridica_w.cd_cgc;

        if (upper(coalesce(c03_w.ie_action,'INSERT')) <> 'DELETE') THEN
          begin
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_TIPO_COMPLEMENTO', c03_w.IE_TIPO_COMPLEMENTO, 'N', pessoa_juridica_compl_w.IE_TIPO_COMPLEMENTO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.IE_TIPO_COMPLEMENTO := _ora2pg_r.ds_valor_retorno_p;

          if (upper(coalesce(c03_w.ie_action,'INSERT')) = 'UPDATE') then
            begin
            /*'Busca o registro atual do Tasy pela PK'
            Esse tratamento foi necessario porque quando e update, o sistema externo so envia as informacoes alteradas e o restante dos campos eles mandam vazio. Entao temos que buscar a informacao que ja esta gravada na tabela.*/
            select  *
            into STRICT  pessoa_juridica_compl_w
            from  pessoa_juridica_compl
            where cd_cgc      = pessoa_juridica_compl_w.cd_cgc
            and ie_tipo_complemento = pessoa_juridica_compl_w.ie_tipo_complemento  LIMIT 1;
            exception
            when others then
              null;
            end;
          end if;


          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_CBO_RED', c03_w.CD_CBO_RED, 'S', pessoa_juridica_compl_w.CD_CBO_RED) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.CD_CBO_RED := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_CEP', c03_w.CD_CEP, 'N', pessoa_juridica_compl_w.CD_CEP) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.CD_CEP := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_MUNICIPIO_IBGE', c03_w.CD_MUNICIPIO_IBGE, 'S', pessoa_juridica_compl_w.CD_MUNICIPIO_IBGE) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.CD_MUNICIPIO_IBGE := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_PESSOA_FISICA_CANAL', c03_w.CD_PESSOA_FISICA_CANAL, 'S', pessoa_juridica_compl_w.CD_PESSOA_FISICA_CANAL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.CD_PESSOA_FISICA_CANAL := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_BAIRRO', c03_w.DS_BAIRRO, 'N', pessoa_juridica_compl_w.DS_BAIRRO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.DS_BAIRRO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_CARGO', c03_w.DS_CARGO, 'N', pessoa_juridica_compl_w.DS_CARGO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.DS_CARGO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_COMPLEMENTO', c03_w.DS_COMPLEMENTO, 'N', pessoa_juridica_compl_w.DS_COMPLEMENTO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.DS_COMPLEMENTO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_EMAIL', c03_w.DS_EMAIL, 'N', pessoa_juridica_compl_w.DS_EMAIL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.DS_EMAIL := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_ENDERECO', c03_w.DS_ENDERECO, 'N', pessoa_juridica_compl_w.DS_ENDERECO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.DS_ENDERECO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_IDENTIFIC_COMPLEMENTO', c03_w.DS_IDENTIFIC_COMPLEMENTO, 'N', pessoa_juridica_compl_w.DS_IDENTIFIC_COMPLEMENTO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.DS_IDENTIFIC_COMPLEMENTO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_MUNICIPIO', c03_w.DS_MUNICIPIO, 'N', pessoa_juridica_compl_w.DS_MUNICIPIO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.DS_MUNICIPIO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_OBSERVACAO', c03_w.DS_OBSERVACAO, 'N', pessoa_juridica_compl_w.DS_OBSERVACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.DS_OBSERVACAO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_SETOR_CONTATO', c03_w.DS_SETOR_CONTATO, 'N', pessoa_juridica_compl_w.DS_SETOR_CONTATO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.DS_SETOR_CONTATO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_CONTATO_REF', c03_w.IE_CONTATO_REF, 'N', pessoa_juridica_compl_w.IE_CONTATO_REF) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.IE_CONTATO_REF := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_GERENTE_CANAL', c03_w.IE_GERENTE_CANAL, 'N', pessoa_juridica_compl_w.IE_GERENTE_CANAL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.IE_GERENTE_CANAL := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_PARTICIPA_EVENTOS', c03_w.IE_PARTICIPA_EVENTOS, 'N', pessoa_juridica_compl_w.IE_PARTICIPA_EVENTOS) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.IE_PARTICIPA_EVENTOS := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_PLC_CUSTOMER_SPONSOR', c03_w.IE_PLC_CUSTOMER_SPONSOR, 'N', pessoa_juridica_compl_w.IE_PLC_CUSTOMER_SPONSOR) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.IE_PLC_CUSTOMER_SPONSOR := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_PLC_PLATAFORM_MANAGER', c03_w.IE_PLC_PLATAFORM_MANAGER, 'N', pessoa_juridica_compl_w.IE_PLC_PLATAFORM_MANAGER) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.IE_PLC_PLATAFORM_MANAGER := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_PLS', c03_w.IE_PLS, 'N', pessoa_juridica_compl_w.IE_PLS) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.IE_PLS := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_RECEBE_PROP', c03_w.IE_RECEBE_PROP, 'N', pessoa_juridica_compl_w.IE_RECEBE_PROP) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.IE_RECEBE_PROP := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NM_PESSOA_CONTATO', c03_w.NM_PESSOA_CONTATO, 'N', pessoa_juridica_compl_w.NM_PESSOA_CONTATO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.NM_PESSOA_CONTATO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_DDD_TELEFONE', c03_w.NR_DDD_TELEFONE, 'N', pessoa_juridica_compl_w.NR_DDD_TELEFONE) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.NR_DDD_TELEFONE := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_ENDERECO', c03_w.NR_ENDERECO, 'N', pessoa_juridica_compl_w.NR_ENDERECO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.NR_ENDERECO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_FAX', c03_w.NR_FAX, 'N', pessoa_juridica_compl_w.NR_FAX) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.NR_FAX := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_RAMAL_CONTATO', c03_w.NR_RAMAL_CONTATO, 'N', pessoa_juridica_compl_w.NR_RAMAL_CONTATO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.NR_RAMAL_CONTATO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_TELEFONE', c03_w.NR_TELEFONE, 'N', pessoa_juridica_compl_w.NR_TELEFONE) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.NR_TELEFONE := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_TELEFONE_CELULAR', c03_w.NR_TELEFONE_CELULAR, 'N', pessoa_juridica_compl_w.NR_TELEFONE_CELULAR) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.NR_TELEFONE_CELULAR := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'SG_ESTADO', c03_w.SG_ESTADO, 'N', pessoa_juridica_compl_w.SG_ESTADO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.SG_ESTADO := _ora2pg_r.ds_valor_retorno_p;
          pessoa_juridica_compl_w.nm_usuario    := 'TASY';
          pessoa_juridica_compl_w.dt_atualizacao    := clock_timestamp();
          pessoa_juridica_compl_w.nm_usuario_nrec   := 'TASY';
          pessoa_juridica_compl_w.dt_atualizacao_nrec := clock_timestamp();

          if (reg_integracao_w.qt_reg_log = 0) then

            select  coalesce(max(nr_sequencia),0)
            into STRICT  pessoa_juridica_compl_w.nr_sequencia
            from  pessoa_juridica_compl
            where cd_cgc      = pessoa_juridica_compl_w.cd_cgc
            and ie_tipo_complemento = pessoa_juridica_compl_w.ie_tipo_complemento  LIMIT 1;

            if (pessoa_juridica_compl_w.nr_sequencia > 0) then

              update  pessoa_juridica_compl
              set row     = pessoa_juridica_compl_w
              where cd_cgc      = pessoa_juridica_compl_w.cd_cgc
              and ie_tipo_complemento = pessoa_juridica_compl_w.ie_tipo_complemento;
            else
              if cd_regra_w <> 0 then
                insert into pre_pessoa_juridica_compl(
                  cd_cgc,
                  ie_tipo_complemento,
                  cd_cbo_red,
                  cd_cep,
                  cd_municipio_ibge,
                  cd_pessoa_fisica_canal,
                  ds_bairro,
                  ds_cargo,
                  ds_complemento,
                  ds_email,
                  ds_endereco,
                  ds_identific_complemento,
                  ds_municipio,
                  ds_observacao,
                  ds_setor_contato,
                  ie_contato_ref,
                  ie_gerente_canal,
                  ie_participa_eventos,
                  ie_plc_customer_sponsor,
                  ie_plc_plataform_manager,
                  ie_pls,
                  ie_recebe_prop,
                  nm_pessoa_contato,
                  nr_ddd_telefone,
                  nr_endereco,
                  nr_fax,
                  nr_ramal_contato,
                  nr_telefone,
                  nr_telefone_celular,
                  sg_estado,
                  nm_usuario,
                  dt_atualizacao,
                  nm_usuario_nrec,
                  dt_atualizacao_nrec,
                  nr_seq_pre_pj)
                values (
                  pessoa_juridica_compl_w.cd_cgc,
                  pessoa_juridica_compl_w.ie_tipo_complemento,
                  pessoa_juridica_compl_w.cd_cbo_red,
                  pessoa_juridica_compl_w.cd_cep,
                  pessoa_juridica_compl_w.cd_municipio_ibge,
                  pessoa_juridica_compl_w.cd_pessoa_fisica_canal,
                  pessoa_juridica_compl_w.ds_bairro,
                  pessoa_juridica_compl_w.ds_cargo,
                  pessoa_juridica_compl_w.ds_complemento,
                  pessoa_juridica_compl_w.ds_email,
                  pessoa_juridica_compl_w.ds_endereco,
                  pessoa_juridica_compl_w.ds_identific_complemento,
                  pessoa_juridica_compl_w.ds_municipio,
                  pessoa_juridica_compl_w.ds_observacao,
                  pessoa_juridica_compl_w.ds_setor_contato,
                  pessoa_juridica_compl_w.ie_contato_ref,
                  pessoa_juridica_compl_w.ie_gerente_canal,
                  pessoa_juridica_compl_w.ie_participa_eventos,
                  pessoa_juridica_compl_w.ie_plc_customer_sponsor,
                  pessoa_juridica_compl_w.ie_plc_plataform_manager,
                  pessoa_juridica_compl_w.ie_pls,
                  pessoa_juridica_compl_w.ie_recebe_prop,
                  pessoa_juridica_compl_w.nm_pessoa_contato,
                  pessoa_juridica_compl_w.nr_ddd_telefone,
                  pessoa_juridica_compl_w.nr_endereco,
                  pessoa_juridica_compl_w.nr_fax,
                  pessoa_juridica_compl_w.nr_ramal_contato,
                  pessoa_juridica_compl_w.nr_telefone,
                  pessoa_juridica_compl_w.nr_telefone_celular,
                  pessoa_juridica_compl_w.sg_estado,
                  pessoa_juridica_compl_w.nm_usuario,
                  pessoa_juridica_compl_w.dt_atualizacao,
                  pessoa_juridica_compl_w.nm_usuario_nrec,
                  pessoa_juridica_compl_w.dt_atualizacao_nrec,
                  currval('pre_pessoa_juridica_seq'));
              else
                select  nextval('pessoa_juridica_compl_seq')
                into STRICT  pessoa_juridica_compl_w.nr_sequencia
;

                insert into pessoa_juridica_compl values (pessoa_juridica_compl_w.*);
              end if;
            end if;
          end if;
          end;
        else
          begin
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_TIPO_COMPLEMENTO', c03_w.IE_TIPO_COMPLEMENTO, 'N', pessoa_juridica_compl_w.IE_TIPO_COMPLEMENTO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_compl_w.IE_TIPO_COMPLEMENTO := _ora2pg_r.ds_valor_retorno_p;

          if (reg_integracao_w.qt_reg_log = 0) then
            delete  FROM pessoa_juridica_compl
            where cd_cgc      = pessoa_juridica_compl_w.cd_cgc
            and ie_tipo_complemento = pessoa_juridica_compl_w.IE_TIPO_COMPLEMENTO;
          end if;
          end;
        end if;
        end;
      end loop;
      close c03;

      open c04;
      loop
      fetch c04 into
        c04_w;
      EXIT WHEN NOT FOUND; /* apply on c04 */
        begin

        reg_integracao_w.nm_tabela    :=  'PESSOA_JURIDICA_CONTA';
        reg_integracao_w.nm_elemento    :=  'ACCOUNT';
        reg_integracao_w.nr_seq_visao   :=  8472;

        pessoa_juridica_conta_w.cd_cgc    :=  pessoa_juridica_w.cd_cgc;

        if (upper(coalesce(c04_w.ie_action,'INSERT')) <> 'DELETE') THEN
          begin
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_CGC', c04_w.cd_cgc, 'N', pessoa_juridica_conta_w.cd_cgc) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_conta_w.cd_cgc := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_BANCO', c04_w.CD_BANCO, 'N', pessoa_juridica_conta_w.CD_BANCO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_conta_w.CD_BANCO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_AGENCIA_BANCARIA', c04_w.CD_AGENCIA_BANCARIA, 'N', pessoa_juridica_conta_w.CD_AGENCIA_BANCARIA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_conta_w.CD_AGENCIA_BANCARIA := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_CONTA', c04_w.NR_CONTA, 'N', pessoa_juridica_conta_w.NR_CONTA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_conta_w.NR_CONTA := _ora2pg_r.ds_valor_retorno_p;

          if (upper(coalesce(c04_w.ie_action,'INSERT')) = 'UPDATE') then
            begin
            /*'Busca o registro atual do Tasy pela PK'
            Esse tratamento foi necessario porque quando e update, o sistema externo so envia as informacoes alteradas e o restante dos campos eles mandam vazio. Entao temos que buscar a informacao que ja esta gravada na tabela.*/
            select  *
            into STRICT  pessoa_juridica_conta_w
            from  pessoa_juridica_conta
            where cd_cgc      = pessoa_juridica_conta_w.cd_cgc
            and cd_banco    = pessoa_juridica_conta_w.cd_banco
            and cd_agencia_bancaria = pessoa_juridica_conta_w.cd_agencia_bancaria
            and nr_conta    = pessoa_juridica_conta_w.nr_conta  LIMIT 1;
            exception
            when others then
              null;
            end;
          end if;

          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_CAMARA_COMPENSACAO', c04_w.CD_CAMARA_COMPENSACAO, 'N', pessoa_juridica_conta_w.CD_CAMARA_COMPENSACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_conta_w.CD_CAMARA_COMPENSACAO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_CODIGO_IDENTIFICACAO', c04_w.CD_CODIGO_IDENTIFICACAO, 'N', pessoa_juridica_conta_w.CD_CODIGO_IDENTIFICACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_conta_w.CD_CODIGO_IDENTIFICACAO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_OBSERVACAO', c04_w.DS_OBSERVACAO, 'N', pessoa_juridica_conta_w.DS_OBSERVACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_conta_w.DS_OBSERVACAO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_CONTA_PAGAMENTO', c04_w.IE_CONTA_PAGAMENTO, 'N', pessoa_juridica_conta_w.IE_CONTA_PAGAMENTO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_conta_w.IE_CONTA_PAGAMENTO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_CONTA_REPASSE', c04_w.IE_CONTA_REPASSE, 'N', pessoa_juridica_conta_w.IE_CONTA_REPASSE) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_conta_w.IE_CONTA_REPASSE := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_DIGITO_AGENCIA', c04_w.IE_DIGITO_AGENCIA, 'N', pessoa_juridica_conta_w.IE_DIGITO_AGENCIA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_conta_w.IE_DIGITO_AGENCIA := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_PRESTADOR_PLS', c04_w.IE_PRESTADOR_PLS, 'N', pessoa_juridica_conta_w.IE_PRESTADOR_PLS) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_conta_w.IE_PRESTADOR_PLS := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_PROPRIEDADE_CONTA', c04_w.IE_PROPRIEDADE_CONTA, 'N', pessoa_juridica_conta_w.IE_PROPRIEDADE_CONTA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_conta_w.IE_PROPRIEDADE_CONTA := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_SITUACAO', c04_w.IE_SITUACAO, 'N', pessoa_juridica_conta_w.IE_SITUACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_conta_w.IE_SITUACAO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_TIPO_CONTA', c04_w.IE_TIPO_CONTA, 'N', pessoa_juridica_conta_w.IE_TIPO_CONTA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_conta_w.IE_TIPO_CONTA := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_DIGITO_CONTA', c04_w.NR_DIGITO_CONTA, 'N', pessoa_juridica_conta_w.NR_DIGITO_CONTA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_conta_w.NR_DIGITO_CONTA := _ora2pg_r.ds_valor_retorno_p;
          pessoa_juridica_conta_w.nm_usuario    := 'TASY';
          pessoa_juridica_conta_w.dt_atualizacao    := clock_timestamp();

          if (reg_integracao_w.qt_reg_log = 0) then
            begin

            select  coalesce(max(nr_sequencia),0)
            into STRICT  qt_registros_w
            from  pessoa_juridica_conta
            where cd_cgc      = pessoa_juridica_conta_w.cd_cgc
            and cd_banco    = pessoa_juridica_conta_w.cd_banco
            and cd_agencia_bancaria = pessoa_juridica_conta_w.cd_agencia_bancaria
            and nr_conta    = pessoa_juridica_conta_w.nr_conta  LIMIT 1;

            if (qt_registros_w > 0) then

              pessoa_juridica_conta_w.nr_sequencia := qt_registros_w;

              update  pessoa_juridica_conta
              set row     = pessoa_juridica_conta_w
              where cd_cgc      = pessoa_juridica_conta_w.cd_cgc
              and cd_banco    = pessoa_juridica_conta_w.cd_banco
              and cd_agencia_bancaria = pessoa_juridica_conta_w.cd_agencia_bancaria
              and nr_conta    = pessoa_juridica_conta_w.nr_conta;

            else
              if cd_regra_w <> 0 then
                insert into pre_pessoa_juridica_conta(
                  cd_cgc,
                  cd_banco,
                  cd_agencia_bancaria,
                  nr_conta,
                  cd_camara_compensacao,
                  cd_codigo_identificacao,
                  ds_observacao,
                  ie_conta_pagamento,
                  ie_conta_repasse,
                  ie_digito_agencia,
                  ie_prestador_pls,
                  ie_propriedade_conta,
                  ie_situacao,
                  ie_tipo_conta,
                  nr_digito_conta,
                  nm_usuario,
                  dt_atualizacao,
                  nr_seq_pre_pj)
                values (
                  pessoa_juridica_conta_w.cd_cgc,
                  pessoa_juridica_conta_w.cd_banco,
                  pessoa_juridica_conta_w.cd_agencia_bancaria,
                  pessoa_juridica_conta_w.nr_conta,
                  pessoa_juridica_conta_w.cd_camara_compensacao,
                  pessoa_juridica_conta_w.cd_codigo_identificacao,
                  pessoa_juridica_conta_w.ds_observacao,
                  pessoa_juridica_conta_w.ie_conta_pagamento,
                  pessoa_juridica_conta_w.ie_conta_repasse,
                  pessoa_juridica_conta_w.ie_digito_agencia,
                  pessoa_juridica_conta_w.ie_prestador_pls,
                  pessoa_juridica_conta_w.ie_propriedade_conta,
                  pessoa_juridica_conta_w.ie_situacao,
                  pessoa_juridica_conta_w.ie_tipo_conta,
                  pessoa_juridica_conta_w.nr_digito_conta,
                  pessoa_juridica_conta_w.nm_usuario,
                  pessoa_juridica_conta_w.dt_atualizacao,
                  currval('pre_pessoa_juridica_seq'));
              else
                select  nextval('pessoa_juridica_conta_seq')
                into STRICT  pessoa_juridica_conta_w.nr_sequencia
;

                insert into pessoa_juridica_conta values (pessoa_juridica_conta_w.*);
              end if;
            end if;
            end;
          end if;
          end;
        else
          begin
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_BANCO', c04_w.CD_BANCO, 'N', pessoa_juridica_conta_w.CD_BANCO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_conta_w.CD_BANCO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_AGENCIA_BANCARIA', c04_w.CD_AGENCIA_BANCARIA, 'N', pessoa_juridica_conta_w.CD_AGENCIA_BANCARIA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_conta_w.CD_AGENCIA_BANCARIA := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_CONTA', c04_w.NR_CONTA, 'N', pessoa_juridica_conta_w.NR_CONTA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_juridica_conta_w.NR_CONTA := _ora2pg_r.ds_valor_retorno_p;

          if (reg_integracao_w.qt_reg_log = 0) then

            delete  FROM pessoa_juridica_conta
            where cd_cgc      = pessoa_juridica_w.cd_cgc
            and cd_banco    = pessoa_juridica_conta_w.CD_BANCO
            and cd_agencia_bancaria = pessoa_juridica_conta_w.CD_AGENCIA_BANCARIA
            and nr_conta    = pessoa_juridica_conta_w.NR_CONTA;
          end if;
          end;
        end if;

        end;
      end loop;
      close c04;

      open c05;
      loop
      fetch c05 into
        c05_w;
      EXIT WHEN NOT FOUND; /* apply on c05 */
        begin
        reg_integracao_w.nm_tabela    :=  'PESSOA_JUR_RESP';
        reg_integracao_w.nm_elemento    :=  'RESPONSIBLE';
        reg_integracao_w.nr_seq_visao   :=  8483;

        pessoa_jur_resp_w.cd_cgc    :=  pessoa_juridica_w.cd_cgc;

        if (upper(coalesce(c05_w.ie_action,'INSERT')) <> 'DELETE') then
          begin
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_PESSOA_FISICA', c05_w.CD_PESSOA_FISICA, 'S', pessoa_jur_resp_w.CD_PESSOA_FISICA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_jur_resp_w.CD_PESSOA_FISICA := _ora2pg_r.ds_valor_retorno_p;

          if (upper(coalesce(c05_w.ie_action,'INSERT')) = 'UPDATE') then
            begin
            /*'Busca o registro atual do Tasy pela PK'
            Esse tratamento foi necessario porque quando e update, o sistema externo so envia as informacoes alteradas e o restante dos campos eles mandam vazio. Entao temos que buscar a informacao que ja esta gravada na tabela.*/
            select  *
            into STRICT  pessoa_jur_resp_w
            from  pessoa_jur_resp
            where cd_cgc = pessoa_jur_resp_w.cd_cgc
            and cd_pessoa_fisica = pessoa_jur_resp_w.cd_pessoa_fisica  LIMIT 1;
            exception
            when others then
              null;
            end;
          end if;

          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_CARGO', c05_w.CD_CARGO, 'S', pessoa_jur_resp_w.CD_CARGO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_jur_resp_w.CD_CARGO := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_CGC', c05_w.cd_cgc, 'S', c05_w.cd_cgc) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; c05_w.cd_cgc := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_AVALIACAO_FORNECEDOR', c05_w.IE_AVALIACAO_FORNECEDOR, 'N', pessoa_jur_resp_w.IE_AVALIACAO_FORNECEDOR) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_jur_resp_w.IE_AVALIACAO_FORNECEDOR := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_REPRESENTANTE_LEGAL', c05_w.IE_REPRESENTANTE_LEGAL, 'N', pessoa_jur_resp_w.IE_REPRESENTANTE_LEGAL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_jur_resp_w.IE_REPRESENTANTE_LEGAL := _ora2pg_r.ds_valor_retorno_p;
          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_RESP_CADASTRO', c05_w.IE_RESP_CADASTRO, 'N', pessoa_jur_resp_w.IE_RESP_CADASTRO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_jur_resp_w.IE_RESP_CADASTRO := _ora2pg_r.ds_valor_retorno_p;
          pessoa_jur_resp_w.nm_usuario  := 'TASY';
          pessoa_jur_resp_w.dt_atualizacao  := clock_timestamp();

          if (reg_integracao_w.qt_reg_log = 0) then
            begin
            select coalesce(max(nr_sequencia), 0)
            into STRICT  pessoa_jur_resp_w.nr_sequencia
            from  pessoa_jur_resp
            where cd_cgc = pessoa_jur_resp_w.cd_cgc
            and cd_pessoa_fisica = pessoa_jur_resp_w.cd_pessoa_fisica  LIMIT 1;

            if (pessoa_jur_resp_w.nr_sequencia > 0) then
              update  pessoa_jur_resp
              set row = pessoa_jur_resp_w
              where nr_sequencia = pessoa_jur_resp_w.nr_sequencia;
            else
              if cd_regra_w <> 0 then
                insert into pre_pessoa_jur_resp(
                  cd_cgc,
                  cd_pessoa_fisica,
                  cd_cargo,
                  ie_avaliacao_fornecedor,
                  ie_representante_legal,
                  ie_resp_cadastro,
                  nm_usuario,
                  dt_atualizacao,
                  nr_seq_pre_pj)
                values (
                  pessoa_jur_resp_w.cd_cgc,
                  pessoa_jur_resp_w.cd_pessoa_fisica,
                  pessoa_jur_resp_w.cd_cargo,
                  pessoa_jur_resp_w.ie_avaliacao_fornecedor,
                  pessoa_jur_resp_w.ie_representante_legal,
                  pessoa_jur_resp_w.ie_resp_cadastro,
                  pessoa_jur_resp_w.nm_usuario,
                  pessoa_jur_resp_w.dt_atualizacao,
                  currval('pre_pessoa_juridica_seq'));
              else
                select  nextval('pessoa_jur_resp_seq')
                into STRICT  pessoa_jur_resp_w.nr_sequencia
;

                insert into pessoa_jur_resp values (pessoa_jur_resp_w.*);
              end if;
            end if;
            end;
          end if;
          end;
        else

          SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_PESSOA_FISICA', c05_w.CD_PESSOA_FISICA, 'S', pessoa_jur_resp_w.CD_PESSOA_FISICA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; pessoa_jur_resp_w.CD_PESSOA_FISICA := _ora2pg_r.ds_valor_retorno_p;

          if (reg_integracao_w.qt_reg_log = 0) then
            delete from pessoa_jur_resp
            where cd_cgc = pessoa_juridica_w.cd_cgc
            and cd_pessoa_fisica = c05_w.cd_pessoa_fisica;
          end if;
        end if;
        end;
      end loop;
      close c05;
    end if;
    end;
  else
    begin
    nr_doc_externo_w    := coalesce(c01_w.cd_rfc, coalesce(c01_w.cd_sistema_ant,c01_w.cd_cgc));
    pessoa_juridica_w.CD_CGC  := c01_w.cd_cgc;

    select  count(*)
    into STRICT  qt_registros_w
    from  pessoa_juridica
    where cd_cgc = c01_w.cd_cgc  LIMIT 1;

    if (qt_registros_w > 0) then
      update  pessoa_juridica
      set   ie_situacao = 'I'
      where cd_cgc = c01_w.cd_cgc;

    else
      /*Codigo da pessoa juridica invalido ou inexistente no Tasy para alteracao ou exclusao do registro.*/

      intpd_gravar_log_recebimento(nr_sequencia_p,wheb_mensagem_pck.get_texto(1017949),'INTPDTASY','0004');
      ie_erro_w := 'S';
    end if;
    end;
  end if;
  end;
end loop;
close c01;
exception
when others then
  begin
  ds_erro_w := substr(dbms_utility.format_error_backtrace || chr(13) || chr(10) || sqlerrm,1,4000);
  rollback;
  update  intpd_fila_transmissao
  set ie_status = 'E',
    cd_default_message  = CASE WHEN ds_erro_w = NULL THEN null  ELSE '0005' END ,
    ds_log = ds_erro_w
  where nr_sequencia = nr_sequencia_p;

  ie_exception_w := 'S';

  end;
end;

if (ie_exception_w = 'N') then

  if  ((reg_integracao_w.qt_reg_log > 0) or (ie_erro_w = 'S')) then
    begin
    rollback;

    update  intpd_fila_transmissao
    set ie_status = 'E',
      cd_default_message  = CASE WHEN ds_erro_w = NULL THEN null  ELSE '0005' END ,
      ds_log = ds_erro_w,
      nr_doc_externo  = nr_doc_externo_w
    where nr_sequencia  = nr_sequencia_p;

    for i in 0..reg_integracao_w.qt_reg_log-1 loop
      intpd_gravar_log_recebimento(nr_sequencia_p,reg_integracao_w.intpd_log_receb[i].ds_log,'INTPDTASY',reg_integracao_w.intpd_log_receb[i].cd_default_message);
    end loop;
    end;
  else
    update  intpd_fila_transmissao
    set ie_status = 'S',
      cd_default_message  = '0000',
      nr_seq_documento  = pessoa_juridica_w.CD_CGC,
      nr_doc_externo    = nr_doc_externo_w
    where nr_sequencia = nr_sequencia_p;
  end if;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE intpd_receiving_legal_entity ( nr_sequencia_p bigint, xml_p xml) FROM PUBLIC;

