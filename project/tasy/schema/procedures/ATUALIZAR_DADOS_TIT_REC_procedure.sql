-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_dados_tit_rec (dt_inicio_p timestamp) AS $body$
DECLARE

 
nr_titulo_w			bigint;
dt_conta_w			timestamp;
cd_convenio_w			integer;

c01 CURSOR FOR 
	SELECT	 
		nr_titulo, 
		obter_convenio_tit_rec(nr_titulo) 
	from	titulo_receber 
	where	dt_emissao	>= dt_inicio_p 
	and	coalesce(cd_convenio_conta::text, '') = '';

c02 CURSOR FOR 
	SELECT	 
		nr_titulo, 
		obter_mesano_conta_tit_rec(nr_titulo) 
	from	titulo_receber 
	where	dt_emissao	>= dt_inicio_p 
	and	coalesce(dt_ref_conta::text, '') = '';
		

BEGIN 
 
OPEN	C01;
LOOP 
FETCH	C01 	into	 
		nr_titulo_w, 
		cd_convenio_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	if (coalesce(cd_convenio_w,0) > 0) then 
		update titulo_receber 
		set	cd_convenio_conta	= cd_convenio_w 
		where	nr_titulo		= nr_titulo_w;
	end if;
end loop;
close c01;
commit;
 
OPEN	C02;
LOOP 
FETCH	C02 	into	 
		nr_titulo_w, 
		dt_conta_w;
EXIT WHEN NOT FOUND; /* apply on c02 */
	update titulo_receber 
	set	dt_ref_conta		= dt_conta_w 
	where	nr_titulo		= nr_titulo_w;
end loop;
close c02;
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_dados_tit_rec (dt_inicio_p timestamp) FROM PUBLIC;

