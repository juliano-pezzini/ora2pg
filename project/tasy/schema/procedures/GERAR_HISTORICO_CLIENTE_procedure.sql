-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_historico_cliente ( nr_seq_cliente_p bigint, nr_seq_tipo_p bigint, nm_usuario_p text, ds_historico_p text, ds_titulo_p text, ie_liberar_p text default 'N', nr_seq_proj_p bigint default null) AS $body$
DECLARE

		
nr_seq_hist_w	com_cliente_hist.nr_sequencia%type;		
ds_titulo_w 	com_cliente_hist.ds_titulo%type;
		

BEGIN

select 	nextval('com_cliente_hist_seq')
into STRICT 	nr_seq_hist_w
;

	IF ds_titulo_p = '' THEN
          		ds_titulo_w := obter_desc_expressao(940942, ds_titulo_p);
        	ELSE
          		ds_titulo_w := ds_titulo_p;
	END IF;

insert into com_cliente_hist(
			nr_sequencia,
			nr_seq_tipo, 
			nr_seq_cliente, 
			nm_usuario, 
			dt_historico, 
			dt_atualizacao, 
			ds_historico, 
			nm_usuario_nrec, 
			dt_atualizacao_nrec, 
			ds_titulo,
			nr_seq_projeto)
	values (nr_seq_hist_w,
			nr_seq_tipo_p,
			nr_seq_cliente_p,
			nm_usuario_p,
			clock_timestamp(),
			clock_timestamp(),
			ds_historico_p,
			nm_usuario_p,
			clock_timestamp(),
			ds_titulo_w,
			nr_seq_proj_p);

if (ie_liberar_p = 'S') then
	update 	com_cliente_hist
	set 	dt_liberacao = clock_timestamp()
	where 	nr_sequencia = nr_seq_hist_w;
end if;
	
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_historico_cliente ( nr_seq_cliente_p bigint, nr_seq_tipo_p bigint, nm_usuario_p text, ds_historico_p text, ds_titulo_p text, ie_liberar_p text default 'N', nr_seq_proj_p bigint default null) FROM PUBLIC;

