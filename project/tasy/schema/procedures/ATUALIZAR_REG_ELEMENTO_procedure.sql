-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_reg_elemento ( nr_seq_temp_conteudo_p bigint, nr_seq_reg_template_p bigint, nr_seq_elemento_p bigint, nm_usuario_p text, ds_resultado_p text, vl_resultado_p bigint, dt_resultado_p timestamp, ds_estatistica_p text, nr_registro_cluster_p bigint, nr_sequencia_p INOUT bigint) AS $body$
DECLARE

qt_reg_w	smallint;


BEGIN
if (nr_seq_temp_conteudo_p = 0) then
	select	count(*)
	into STRICT	qt_reg_w
	from	ehr_reg_elemento
	where	nr_seq_reg_template	= nr_seq_reg_template_p
	and	nr_seq_elemento		= nr_seq_elemento_p;
else
	if (coalesce(nr_registro_cluster_p::text, '') = '' or nr_registro_cluster_p = 0) then
		select	count(*)
		into STRICT	qt_reg_w
		from	ehr_reg_elemento
		where	nr_seq_reg_template	= nr_seq_reg_template_p
		and	nr_seq_elemento		= nr_seq_elemento_p
		and	NR_SEQ_TEMP_CONTEUDO	= NR_SEQ_TEMP_CONTEUDO_P;
	else
		select	count(*)
		into STRICT	qt_reg_w
		from	ehr_reg_elemento
		where	nr_seq_reg_template	= nr_seq_reg_template_p
		and	nr_seq_elemento		= nr_seq_elemento_p
		and	NR_SEQ_TEMP_CONTEUDO	= NR_SEQ_TEMP_CONTEUDO_P
		and	nr_registro_cluster	= nr_registro_cluster_p;
	end	if;
end	if;

if (qt_reg_w > 0) then
	nr_sequencia_p	:= 0;
	if (nr_seq_temp_conteudo_p = 0) then

		update	ehr_reg_elemento
		set	ds_resultado		= ds_resultado_p,
			vl_resultado		= vl_resultado_p,
			dt_resultado		= dt_resultado_p,
			ds_estatistica		= ds_estatistica_p
		where	nr_seq_reg_template	= nr_seq_reg_template_p
		and	nr_seq_elemento		= nr_seq_elemento_p;
	else
		if (coalesce(nr_registro_cluster_p::text, '') = '' or nr_registro_cluster_p = 0) then
			update	ehr_reg_elemento
			set	ds_resultado		= ds_resultado_p,
				vl_resultado		= vl_resultado_p,
				dt_resultado		= dt_resultado_p,
				ds_estatistica		= ds_estatistica_p
			where	nr_seq_reg_template	= nr_seq_reg_template_p
			and	nr_seq_elemento		= nr_seq_elemento_p
			and	NR_SEQ_TEMP_CONTEUDO	= NR_SEQ_TEMP_CONTEUDO_P;
		else
			update	ehr_reg_elemento
			set	ds_resultado		= ds_resultado_p,
				vl_resultado		= vl_resultado_p,
				dt_resultado		= dt_resultado_p,
				ds_estatistica		= ds_estatistica_p
			where	nr_seq_reg_template	= nr_seq_reg_template_p
			and	nr_seq_elemento		= nr_seq_elemento_p
			and	NR_SEQ_TEMP_CONTEUDO	= NR_SEQ_TEMP_CONTEUDO_P
			and	nr_registro_cluster	= nr_registro_cluster_p;
		end	if;
	end	if;
else
	if (coalesce(nr_seq_elemento_p,0) > 0) then
		select	nextval('ehr_reg_elemento_seq')
		into STRICT	nr_sequencia_p
		;
		insert into ehr_reg_elemento(
			NR_SEQUENCIA,
			NR_SEQ_REG_TEMPLATE,
			DT_ATUALIZACAO,
			NM_USUARIO,
			DT_ATUALIZACAO_NREC,
			NM_USUARIO_NREC,
			NR_SEQ_ELEMENTO,
			DS_RESULTADO,
			VL_RESULTADO,
			DT_RESULTADO,
			DS_ESTATISTICA,
			NR_SEQ_TEMP_CONTEUDO,
			NR_REGISTRO_CLUSTER
		)
		values (nr_sequencia_p,
			nr_seq_reg_template_p,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_elemento_p,
			ds_resultado_p,
			vl_resultado_p,
			dt_resultado_p,
			ds_estatistica_p,
			CASE WHEN nr_seq_temp_conteudo_p=0 THEN null  ELSE nr_seq_temp_conteudo_p END ,
			nr_registro_cluster_p
		);

		commit;
	end	if;
end	if;

commit;

end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_reg_elemento ( nr_seq_temp_conteudo_p bigint, nr_seq_reg_template_p bigint, nr_seq_elemento_p bigint, nm_usuario_p text, ds_resultado_p text, vl_resultado_p bigint, dt_resultado_p timestamp, ds_estatistica_p text, nr_registro_cluster_p bigint, nr_sequencia_p INOUT bigint) FROM PUBLIC;

