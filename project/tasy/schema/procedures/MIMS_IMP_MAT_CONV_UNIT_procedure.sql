-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE mims_imp_mat_conv_unit ( cd_material_p bigint, cd_unidade_medida_p text, ds_unidade_medida_p text, qt_conversao_p bigint, ie_prioridade_p bigint, nm_usuario_p text, nr_mims_ver_p bigint) AS $body$
DECLARE




material_conversao_unidade_w  IMP_MATERIAL_CONV_UNIDADE%rowtype;



qt_reg_w	bigint;




BEGIN



select	count(1)

into STRICT	qt_reg_w

from	IMP_MATERIAL_CONV_UNIDADE

where	cd_material		= cd_material_p

and	cd_unidade_medida	= cd_unidade_medida_p;



CALL mims_import_unit(cd_unidade_medida_p,coalesce(ds_unidade_medida_p,cd_unidade_medida_p),nm_usuario_p,nr_mims_ver_p);





if (qt_reg_w	= 0) then

	material_conversao_unidade_w.cd_material		:= cd_material_p;

	material_conversao_unidade_w.cd_unidade_medida		:= cd_unidade_medida_p;

	material_conversao_unidade_w.dt_atualizacao		:= clock_timestamp();

	material_conversao_unidade_w.dt_atualizacao_nrec	:= clock_timestamp();

	material_conversao_unidade_w.nm_usuario			:= nm_usuario_p;

	material_conversao_unidade_w.nm_usuario_nrec		:= nm_usuario_p;

	material_conversao_unidade_w.ie_prioridade		:= ie_prioridade_p;

	material_conversao_unidade_w.qt_conversao		:= qt_conversao_p;

	material_conversao_unidade_w.nr_seq_mims_version := nr_mims_ver_p;															


	insert into IMP_MATERIAL_CONV_UNIDADE	 values (material_conversao_unidade_w.*);

	--commit;
end if;





  



end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE mims_imp_mat_conv_unit ( cd_material_p bigint, cd_unidade_medida_p text, ds_unidade_medida_p text, qt_conversao_p bigint, ie_prioridade_p bigint, nm_usuario_p text, nr_mims_ver_p bigint) FROM PUBLIC;

