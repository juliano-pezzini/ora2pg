-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE safety_alerts_cards_position ( nm_usuario_p text, nr_seq_obj_p bigint, qt_x_p bigint, qt_y_p bigint, ie_type_p text, ds_title_p text) AS $body$
DECLARE

			
record_exists_w	bigint;
core_table_settings_record_w	bigint;
nr_seq_w	safety_warnings_position.nr_sequencia%type;	


BEGIN
	
	
	if (ie_type_p = 'AD') then
	
		begin
		select	count(*)
		into STRICT	core_table_settings_record_w
		from	safety_warnings_position
		where	nr_object_schematic = nr_seq_obj_p
		and	nm_usuario = nm_usuario_p
		and	ds_title = ds_title_p;
		exception
		when others then
			record_exists_w := 0;
		end;
	end if;
	
	if (ie_type_p <> 'AD') then
	
		begin
		select	count(*)
		into STRICT	record_exists_w
		from	safety_warnings_position
		where	nr_object_schematic = nr_seq_obj_p
		and	nm_usuario = nm_usuario_p;
		exception
		when others then
			record_exists_w := 0;
		end;
	end if;
	
	if (record_exists_w = 0 or core_table_settings_record_w = 0) then
	
		select	nextval('safety_warnings_position_seq')
		into STRICT	nr_seq_w
		;
	
		insert into	safety_warnings_position(
					nr_sequencia,
					dt_atualizacao,
					nm_usuario,
					dt_atualizacao_nrec,
					nm_usuario_nrec,
					nr_object_schematic,
					qt_position_x,
					qt_position_y,
					ie_type,
					ds_title)
		values (nr_seq_w,
					clock_timestamp(),
					nm_usuario_p,
					clock_timestamp(),
					nm_usuario_p,
					nr_seq_obj_p,
					qt_x_p,
					qt_y_p,
					ie_type_p,
					ds_title_p);
	end if;
	
	if (core_table_settings_record_w > 0) then

		update	safety_warnings_position
		set	dt_atualizacao = clock_timestamp(),
			qt_position_x = qt_x_p,
			qt_position_y = qt_y_p
		where	nr_object_schematic = nr_seq_obj_p
		and	nm_usuario = nm_usuario_p
		and	ds_title = ds_title_p;
	end if;

	
	if (record_exists_w > 0) then
		
		update	safety_warnings_position
		set	dt_atualizacao = clock_timestamp(),
			qt_position_x = qt_x_p,
			qt_position_y = qt_y_p
		where	nr_object_schematic = nr_seq_obj_p
		and	nm_usuario = nm_usuario_p;
	end if;
	
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE safety_alerts_cards_position ( nm_usuario_p text, nr_seq_obj_p bigint, qt_x_p bigint, qt_y_p bigint, ie_type_p text, ds_title_p text) FROM PUBLIC;

