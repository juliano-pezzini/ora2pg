-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_exame_lab_convenio_js ( nr_atendimento_p bigint, nr_seq_exame_p bigint, cd_convenio_p bigint, cd_categoria_p text, nr_seq_proc_interno_p bigint, ie_somente_erro_p text, cd_estabelecimento_p bigint, cd_material_exame_p text default null, cd_setor_p INOUT bigint DEFAULT NULL, cd_procedimento_p INOUT bigint DEFAULT NULL, ds_procedimento_p INOUT text DEFAULT NULL, ie_origem_proced_p INOUT bigint DEFAULT NULL, ds_erro_p INOUT text DEFAULT NULL) AS $body$
DECLARE

 
ie_tipo_atendimento_w	smallint;
ie_tipo_convenio_w		smallint;
nr_seq_proc_interno_aux_w	bigint;
cd_plano_convenio_w		varchar(10);


BEGIN 
 
select	obter_tipo_atendimento(nr_atendimento_p) 
into STRICT	ie_tipo_atendimento_w
;
 
select	obter_tipo_convenio(cd_convenio_p) 
into STRICT	ie_tipo_convenio_w
;
 
select	obter_plano_conv_atend(nr_atendimento_p) 
into STRICT	cd_plano_convenio_w
;
 
SELECT * FROM obter_exame_lab_convenio( 
	nr_seq_exame_p, cd_convenio_p, cd_categoria_p, ie_tipo_atendimento_w, cd_estabelecimento_p, ie_tipo_convenio_w, nr_seq_proc_interno_p, cd_material_exame_p, cd_plano_convenio_w, cd_setor_p, cd_procedimento_p, ie_origem_proced_p, ds_erro_p, nr_seq_proc_interno_aux_w) INTO STRICT cd_setor_p, cd_procedimento_p, ie_origem_proced_p, ds_erro_p, nr_seq_proc_interno_aux_w;
 
if	((coalesce(ie_somente_erro_p::text, '') = '') or (ie_somente_erro_p <> 'S')) and (cd_procedimento_p > 0) then 
	ds_erro_p	:= ds_erro_p || substr(obter_texto_tasy(48124, wheb_usuario_pck.get_nr_seq_idioma),1,255);
end if;
 
ds_procedimento_p	:= substr(coalesce(obter_desc_proc_interno(nr_seq_proc_interno_p), obter_descricao_procedimento(cd_procedimento_p, ie_origem_proced_p)),1,240);
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_exame_lab_convenio_js ( nr_atendimento_p bigint, nr_seq_exame_p bigint, cd_convenio_p bigint, cd_categoria_p text, nr_seq_proc_interno_p bigint, ie_somente_erro_p text, cd_estabelecimento_p bigint, cd_material_exame_p text default null, cd_setor_p INOUT bigint DEFAULT NULL, cd_procedimento_p INOUT bigint DEFAULT NULL, ds_procedimento_p INOUT text DEFAULT NULL, ie_origem_proced_p INOUT bigint DEFAULT NULL, ds_erro_p INOUT text DEFAULT NULL) FROM PUBLIC;

