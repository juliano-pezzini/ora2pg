-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_banda_relat ( nr_seq_relatorio_p bigint, nr_seq_banda_p INOUT bigint, nm_usuario_p text) AS $body$
DECLARE
 	

nr_seq_banda_new_w	bigint;	
nr_seq_campo_w		bigint;
nr_seq_campo_new_w	bigint;


c01 CURSOR FOR
	SELECT  nr_sequencia
	from	banda_relat_campo
	where	nr_seq_banda = 	nr_seq_banda_p;



BEGIN

select	nextval('banda_relatorio_seq')
into STRICT	nr_seq_banda_new_w
;

--Inserir nova banda
insert into banda_relatorio(
	nr_sequencia,
	ie_tipo_banda,
	ds_banda,
	dt_atualizacao,
	nm_usuario,
	qt_altura,
	ds_cor_fundo,
	ie_quebra_pagina,
	ie_reimprime_nova_pagina,
	ie_alterna_cor_fundo,
	ie_imprime_vazio,
	ie_imprime_primeiro,
	ie_borda_sup,
	ie_borda_inf,
	ie_borda_esq,
	ie_borda_dir,
	nr_seq_banda_superior,
	nr_seq_relatorio,
	nm_tabela,
	ds_sql,
	ds_expressao,
	nr_seq_apresentacao,
	ds_cor_header,
	ds_cor_footer,
	ds_cor_quebra,
	ds_regra,
	ie_banda_padrao,
	qt_max_registro,
	ie_direction) 
SELECT	nr_seq_banda_new_w,
	ie_tipo_banda,
	substr(ds_banda, 1, 25) || ' (cp)',
	clock_timestamp(),
	nm_usuario_p,
	qt_altura,
	ds_cor_fundo,
	ie_quebra_pagina,
	ie_reimprime_nova_pagina,
	ie_alterna_cor_fundo,
	ie_imprime_vazio,
	ie_imprime_primeiro,
	ie_borda_sup,
	ie_borda_inf,
	ie_borda_esq,
	ie_borda_dir,
	nr_seq_banda_superior,
	nr_seq_relatorio,
	nm_tabela,
	ds_sql,
	ds_expressao,
	nr_seq_apresentacao + 1,
	ds_cor_header,
	ds_cor_footer,
	ds_cor_quebra,
	ds_regra,
	ie_banda_padrao,
	qt_max_registro,
	ie_direction
from	banda_relatorio
where	nr_seq_relatorio	= nr_seq_relatorio_p
and	nr_sequencia 		= nr_seq_banda_p;


open c01;
loop
fetch c01 into
	nr_seq_campo_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin

	select nextval('banda_relat_campo_seq')
	into STRICT  nr_seq_campo_new_w
	;

	--Copiar campos para a banda nova
	insert into  banda_relat_campo(
		nr_sequencia,
		nr_seq_banda,
		ds_campo,
		nr_seq_apresentacao,
		ie_tipo_campo,
		dt_atualizacao,
		nm_usuario,
		ie_borda_sup,
		ie_borda_inf,
		ie_borda_esq,
		ie_borda_dir,
		ie_totalizar,
		ie_campo_quebra,
		ie_quebra_pagina,
		ie_zera_apos_imprimir,
		ie_transparente,
		ie_alinhamento,
		ie_ajustar_tamanho,
		ie_estender,
		ie_alinhar_banda,
		qt_altura,
		qt_tamanho,
		qt_topo,
		qt_esquerda,
		ds_label,
		nm_atributo,
		ds_conteudo,
		ds_expressao,
		ds_mascara,
		ds_sql,
		ds_cor_fundo,
		qt_tam_fonte,
		ds_cor_fonte,
		ds_tipo_fonte,
		ds_estilo_fonte,
		ie_tipo_barcode,
		ie_humano_barcode,
		pr_altura_barcode,
		qt_fonte_barcode,
		ds_cor_label,
		ie_altera_valor,
		ie_metodo_estender)
	SELECT	nr_seq_campo_new_w,
		nr_seq_banda_new_w,
		ds_campo,
		nr_seq_apresentacao,
		ie_tipo_campo,
		clock_timestamp(),
		nm_usuario_p,
		ie_borda_sup,
		ie_borda_inf,
		ie_borda_esq,
		ie_borda_dir,
		ie_totalizar,
		ie_campo_quebra,
		ie_quebra_pagina,
		ie_zera_apos_imprimir,
		ie_transparente,
		ie_alinhamento,
		ie_ajustar_tamanho,
		ie_estender,
		ie_alinhar_banda,
		qt_altura,
		qt_tamanho,
		qt_topo,
		qt_esquerda,
		ds_label,
		nm_atributo,
		ds_conteudo,
		ds_expressao,
		ds_mascara,
		ds_sql,
		ds_cor_fundo,
		qt_tam_fonte,
		ds_cor_fonte,
		ds_tipo_fonte,
		ds_estilo_fonte,
		ie_tipo_barcode,
		ie_humano_barcode,
		pr_altura_barcode,
		qt_fonte_barcode,
		ds_cor_label,
		ie_altera_valor,
		ie_metodo_estender
	from	banda_relat_campo
	where	nr_seq_banda = 	nr_seq_banda_p
	and    nr_sequencia = nr_seq_campo_w;


	insert into banda_relat_campo_longo(
	   nr_sequencia,
	   nr_seq_banda_relat_campo, 
	   dt_atualizacao, 
	   nm_usuario, 
	   dt_atualizacao_nrec, 
	   nm_usuario_nrec, 
	   ds_conteudo)
	SELECT nextval('banda_relat_campo_longo_seq'), 
	   nr_seq_campo_new_w,
	   a.dt_atualizacao, 
	   a.nm_usuario, 
	   a.dt_atualizacao_nrec, 
	   a.nm_usuario_nrec, 
	   a.ds_conteudo
	from  banda_relat_campo_longo a 	   
	where  nr_seq_banda_relat_campo = nr_seq_campo_w;

end;
end loop;
close c01;	

commit;

nr_seq_banda_p :=  nr_seq_banda_new_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_banda_relat ( nr_seq_relatorio_p bigint, nr_seq_banda_p INOUT bigint, nm_usuario_p text) FROM PUBLIC;

