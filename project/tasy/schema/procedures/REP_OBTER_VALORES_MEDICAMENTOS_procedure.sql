-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE rep_obter_valores_medicamentos ( nr_prescricao_p bigint, cd_setor_p bigint, cd_material_p bigint, ie_via_aplicacao_p text, ie_se_necessario_p text, nr_sequencia_p INOUT bigint, ie_prescr_medica_erro_p INOUT text, ie_prox_agrup_medic_p INOUT bigint, ie_marca_agora_p INOUT text, ie_atualiza_campo_p INOUT text, classif_setor_p INOUT bigint) AS $body$
DECLARE

 
nr_sequencia_w			prescr_material.nr_sequencia%type;
ie_prox_agrup_medic_w	prescr_material.nr_agrupamento%type;
ie_prescr_medica_erro_w	char(1) := 'N';
ie_marca_agora_w		char(1) := 'N';
ie_atualiza_campo_w		char(1) := 'N';
classif_setor_w			integer := 0;


BEGIN 
 
if (nr_prescricao_p IS NOT NULL AND nr_prescricao_p::text <> '') then 
	begin	 
	select	coalesce(max(nr_sequencia),0) 
	into STRICT	nr_sequencia_w 
	from	prescr_material 
	where 	nr_prescricao = nr_prescricao_p;
 
	select	coalesce(max('S'),'N') 
	into STRICT	ie_prescr_medica_erro_w 
	from	prescr_medica_erro where		nr_seq_medic > nr_sequencia_w 
	and		nr_prescricao = nr_prescricao_p LIMIT 1;
 
	ie_prox_agrup_medic_w	:= obter_proximo_agrup_medic(nr_prescricao_p);
	ie_marca_agora_w		:= obter_se_marca_agora(cd_setor_p);
	ie_atualiza_campo_w		:= coalesce(obter_se_atualiza_campo(nr_prescricao_p, cd_material_p, ie_via_aplicacao_p, ie_se_necessario_p), 'N');
	classif_setor_w			:= coalesce(obter_classif_setor(cd_setor_p), 0);
 
	nr_sequencia_p			:= nr_sequencia_w;
	ie_prescr_medica_erro_p	:= ie_prescr_medica_erro_w;
	ie_prox_agrup_medic_p	:= ie_prox_agrup_medic_w;
	ie_marca_agora_p		:= ie_marca_agora_w;
	ie_atualiza_campo_p		:= ie_atualiza_campo_w;
	classif_setor_p			:= classif_setor_w;
	end;
end if;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE rep_obter_valores_medicamentos ( nr_prescricao_p bigint, cd_setor_p bigint, cd_material_p bigint, ie_via_aplicacao_p text, ie_se_necessario_p text, nr_sequencia_p INOUT bigint, ie_prescr_medica_erro_p INOUT text, ie_prox_agrup_medic_p INOUT bigint, ie_marca_agora_p INOUT text, ie_atualiza_campo_p INOUT text, classif_setor_p INOUT bigint) FROM PUBLIC;

