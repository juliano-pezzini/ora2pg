-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE definir_status_item_processo (nr_seq_processo_p bigint, nr_seq_horario_p bigint, ie_status_p INOUT text) AS $body$
DECLARE

 
ie_tipo_item_w	varchar(1);
cd_item_w		varchar(15);
cd_intervalo_w	varchar(7);
qt_dose_w		double precision;
cd_um_dose_w		varchar(30);

ie_status_w		varchar(1);


BEGIN 
if (nr_seq_processo_p IS NOT NULL AND nr_seq_processo_p::text <> '') and (nr_seq_horario_p IS NOT NULL AND nr_seq_horario_p::text <> '') then 
 
	/* obter dados horário */
 
	select	ie_tipo_item, 
		cd_item, 
		cd_intervalo, 
		qt_dose, 
		cd_unidade_medida_dose 
	into STRICT	ie_tipo_item_w, 
		cd_item_w, 
		cd_intervalo_w, 
		qt_dose_w, 
		cd_um_dose_w 
	from	adep_pend_v 
	where	nr_seq_horario	= nr_seq_horario_p 
	and	ie_tipo_item	= 'M';
 
	/* obter status horário x item x processo*/
 
	select	CASE WHEN count(*)=0 THEN 'N'  ELSE 'S' END  
	into STRICT	ie_status_w 
	from	adep_pend_v b, 
		adep_processo_item a 
	where	b.nr_seq_horario 		= a.nr_seq_horario 
	and	b.ie_tipo_item		= ie_tipo_item_w 
	and	b.cd_item			= cd_item_w 
	and	coalesce(b.cd_intervalo,'XPTO')	= coalesce(cd_intervalo_w,'XPTO') 
	--and	b.qt_dose			= qt_dose_w 
	--and	b.cd_unidade_medida_dose	= cd_um_dose_w 
	and	a.ie_suspenso			<> 'S' 
	and	a.nr_seq_horario		<> nr_seq_horario_p 
	and	a.nr_seq_processo		= nr_seq_processo_p;
 
end if;
 
ie_status_p := ie_status_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE definir_status_item_processo (nr_seq_processo_p bigint, nr_seq_horario_p bigint, ie_status_p INOUT text) FROM PUBLIC;

