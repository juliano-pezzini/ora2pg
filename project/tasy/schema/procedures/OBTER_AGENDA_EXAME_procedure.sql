-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_agenda_exame ( nr_sequencia_p bigint, cd_pessoa_fisica_p INOUT agenda_paciente.cd_pessoa_fisica%TYPE, nr_minuto_duracao_p INOUT agenda_paciente.nr_minuto_duracao%TYPE, nr_atendimento_p INOUT agenda_paciente.nr_atendimento%TYPE, nm_paciente_p INOUT agenda_paciente.nm_paciente%TYPE, qt_anos_p INOUT bigint, dt_nascimento_p INOUT timestamp, qt_idade_mes_p INOUT bigint, cd_convenio_p INOUT bigint, ds_exame_agenda_p INOUT text, ds_nome_medico_p INOUT text, ds_observacao_p INOUT text, cd_medico_p INOUT agenda_paciente.cd_medico%TYPE, cd_procedimento_p INOUT bigint, ie_origem_proced_p INOUT text, nr_seq_proc_interno_P INOUT bigint ) AS $body$
DECLARE


cd_pessoa_fisica_w		agenda_paciente.cd_pessoa_fisica%TYPE;
nr_minuto_duracao_w     agenda_paciente.nr_minuto_duracao%TYPE;
nr_atendimento_w        agenda_paciente.nr_atendimento%TYPE;
nm_paciente_w 			agenda_paciente.nm_paciente%TYPE;
qt_anos_w				integer;
dt_nascimento_w			timestamp;
qt_idade_mes_w			bigint;
cd_convenio_w			convenio.cd_convenio%TYPE;
ds_exame_agenda_w		varchar(240);
ds_nome_medico_w		varchar(255);
ds_observacao_w			agenda_paciente.ds_observacao%TYPE;
cd_medico_w				agenda_paciente.cd_medico%TYPE;
cd_procedimento_w		procedimento.cd_procedimento%TYPE;
nr_seq_proc_interno_w	proc_interno.nr_sequencia%TYPE;
ie_origem_proced_w		procedimento.ie_origem_proced%TYPE;


BEGIN
	select 	cd_pessoa_fisica,
			nr_minuto_duracao,
			nr_atendimento, 
			nm_paciente, 
			obter_dados_pf(cd_pessoa_fisica, 'I'),
			obter_dados_pf_dt(cd_pessoa_fisica, 'DN'),
			obter_idade(obter_data_nascto_pf(cd_pessoa_fisica),clock_timestamp(),'MM'),
			cd_convenio,
			substr(obter_exame_agenda(cd_procedimento, ie_origem_proced, nr_seq_proc_interno),1,240),
			substr(obter_nome_medico(cd_medico,'NC'),1,60),		
			substr(ds_observacao,1,255),
			cd_medico,
			cd_procedimento,
			nr_seq_proc_interno,
			ie_origem_proced
	into STRICT 	cd_pessoa_fisica_w, 
			nr_minuto_duracao_w,
			nr_atendimento_w,
			nm_paciente_w,
			qt_anos_w,
			dt_nascimento_w,
			qt_idade_mes_w,
			cd_convenio_w,
			ds_exame_agenda_w,
			ds_nome_medico_w,
			ds_observacao_w,
			cd_medico_w,
			cd_procedimento_w,
			nr_seq_proc_interno_w,
			ie_origem_proced_w
	from   	agenda_paciente
	where  	nr_sequencia = nr_sequencia_p;

	cd_pessoa_fisica_p		:= cd_pessoa_fisica_w;
	nr_minuto_duracao_p 	:= nr_minuto_duracao_w;
	nr_atendimento_p    	:= nr_atendimento_w;
	nm_paciente_p 			:= nm_paciente_w;
	qt_anos_p				:= qt_anos_w;
	dt_nascimento_p			:= dt_nascimento_w;
	qt_idade_mes_p			:= qt_idade_mes_w;
	cd_convenio_p			:= cd_convenio_w;
	ds_exame_agenda_p		:= ds_exame_agenda_w;
	ds_nome_medico_p		:= ds_nome_medico_w;
	ds_observacao_p			:= ds_observacao_w;
	cd_medico_p				:= cd_medico_w;
	cd_procedimento_p		:= cd_procedimento_w;
	ie_origem_proced_p		:= ie_origem_proced_w;
	nr_seq_proc_interno_p	:= nr_seq_proc_interno_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_agenda_exame ( nr_sequencia_p bigint, cd_pessoa_fisica_p INOUT agenda_paciente.cd_pessoa_fisica%TYPE, nr_minuto_duracao_p INOUT agenda_paciente.nr_minuto_duracao%TYPE, nr_atendimento_p INOUT agenda_paciente.nr_atendimento%TYPE, nm_paciente_p INOUT agenda_paciente.nm_paciente%TYPE, qt_anos_p INOUT bigint, dt_nascimento_p INOUT timestamp, qt_idade_mes_p INOUT bigint, cd_convenio_p INOUT bigint, ds_exame_agenda_p INOUT text, ds_nome_medico_p INOUT text, ds_observacao_p INOUT text, cd_medico_p INOUT agenda_paciente.cd_medico%TYPE, cd_procedimento_p INOUT bigint, ie_origem_proced_p INOUT text, nr_seq_proc_interno_P INOUT bigint ) FROM PUBLIC;

