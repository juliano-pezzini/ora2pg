-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE tasy_ajustar_semantica_char () AS $body$
DECLARE


  alterCommand		varchar(500);
  encode varchar(100);

  owner all_tab_columns.owner%TYPE;
  table_name all_tab_columns.table_name%TYPE;
  column_name all_tab_columns.column_name%TYPE;
  data_type all_tab_columns.data_type%TYPE;
  char_length all_tab_columns.char_length%TYPE;

  -- Seleciona todas as colunas que est√£o com semanatica de Byte no owner recebido por parametro na para procedure
  cursor_columns CURSOR FOR
  SELECT c.owner, c.table_name, c.column_name, c.data_type, c.char_length
  from all_tab_columns C
  WHERE C.data_type IN ('VARCHAR2', 'CHAR') and C.char_used = 'B' and C.owner = 'TASY_VERSAO'
  --and c.table_name in (select NM_TABELA from TABELA_SISTEMA)
  and c.table_name not in (SELECT view_name from all_views where owner = 'TASY_VERSAO');

BEGIN

  RAISE NOTICE 'TASY_AJUSTAR_SEMANTICA_CHAR';

  select value into STRICT encode from nls_database_parameters where parameter='NLS_CHARACTERSET';
  RAISE NOTICE '%', encode;
  if encode = 'AL32UTF8' then
    open cursor_columns;
      loop
      fetch cursor_columns into
        owner, table_name, column_name, data_type, char_length;
        EXIT WHEN NOT FOUND; /* apply on cursor_columns */
        RAISE NOTICE 'loop';
        alterCommand := 'ALTER TABLE ' || 'TASY_VERSAO' || '.' || table_name || ' MODIFY('|| column_name || ' ' || data_type || '(' || char_length || ' CHAR))';
        RAISE NOTICE '%', alterCommand;
        EXECUTE alterCommand;

      end loop;
      RAISE NOTICE 'end loop';
    close cursor_columns;
  end if;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tasy_ajustar_semantica_char () FROM PUBLIC;

