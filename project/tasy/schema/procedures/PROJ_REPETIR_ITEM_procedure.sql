-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE proj_repetir_item ( nr_seq_item_p bigint, nr_seq_index_coluna_p text, nm_usuario_p text) AS $body$
DECLARE


nm_responsavel_w		varchar(80);
ie_parametrizado_w		varchar(1);
ie_multiplicador_w		varchar(1);
ie_recurso_tecnico_w	varchar(1);
ie_usuario_treinado_w	varchar(1);
nr_seq_rot_cli_w		bigint;
nr_seq_cliente_w		bigint;
nr_seq_roteiro_w		bigint;
pr_efetividade_w		bigint;
ie_resultado_w			varchar(80);


BEGIN

select	nm_responsavel,
	ie_parametrizado,
	ie_multiplicador,
	ie_recurso_tecnico,
	ie_usuario_treinado,
	nr_seq_rot_cli,
	pr_efetividade,
	ie_resultado
into STRICT	nm_responsavel_w,
	ie_parametrizado_w,
	ie_multiplicador_w,
	ie_recurso_tecnico_w,
	ie_usuario_treinado_w,
	nr_seq_rot_cli_w,
	pr_efetividade_w,
	ie_resultado_w
from	proj_tp_cli_rot_item
where	nr_sequencia = nr_seq_item_p;

select	nr_seq_cliente,
	nr_seq_roteiro
into STRICT	nr_seq_cliente_w,
	nr_seq_roteiro_w
from	proj_tp_cli_rot
where	nr_sequencia = nr_seq_rot_cli_w;

if (nr_seq_index_coluna_p = 'NM_RESPONSAVEL') then
	begin
	update	proj_tp_cli_rot_item
	set	nm_responsavel	= nm_responsavel_w,
		nm_usuario	= nm_usuario_p,
		dt_atualizacao	= clock_timestamp()
	where	nr_sequencia	in (
				SELECT	a.nr_sequencia
				from	proj_tp_cli_rot b,
					proj_tp_cli_rot_item a
				where	a.nr_seq_rot_cli = b.nr_sequencia
				and	b.nr_seq_roteiro = nr_seq_roteiro_w
				and	b.nr_seq_cliente = nr_seq_cliente_w)
	and	coalesce(nm_responsavel::text, '') = '';
	end;
elsif (nr_seq_index_coluna_p = 'IE_PARAMETRIZADO') then
	begin
	update	proj_tp_cli_rot_item
	set	ie_parametrizado = ie_parametrizado_w,
		nm_usuario	= nm_usuario_p,
		dt_atualizacao	= clock_timestamp()
	where	nr_sequencia	in (
				SELECT	a.nr_sequencia
				from	proj_tp_cli_rot b,
					proj_tp_cli_rot_item a
				where	a.nr_seq_rot_cli = b.nr_sequencia
				and	b.nr_seq_roteiro = nr_seq_roteiro_w
				and	b.nr_seq_cliente = nr_seq_cliente_w)
	and	coalesce(ie_parametrizado::text, '') = '';
	end;
elsif (nr_seq_index_coluna_p = 'IE_MULTIPLICADOR') then
	begin
	update	proj_tp_cli_rot_item
	set	ie_multiplicador= ie_multiplicador_w,
		nm_usuario	= nm_usuario_p,
		dt_atualizacao	= clock_timestamp()
	where	nr_sequencia	in (
				SELECT	a.nr_sequencia
				from	proj_tp_cli_rot b,
					proj_tp_cli_rot_item a
				where	a.nr_seq_rot_cli = b.nr_sequencia
				and	b.nr_seq_roteiro = nr_seq_roteiro_w
				and	b.nr_seq_cliente = nr_seq_cliente_w)
	and	coalesce(ie_multiplicador::text, '') = '';
	end;
elsif (nr_seq_index_coluna_p = 'IE_RECURSO_TECNICO') then
	begin
	update	proj_tp_cli_rot_item
	set	ie_recurso_tecnico = ie_recurso_tecnico_w,
		nm_usuario	= nm_usuario_p,
		dt_atualizacao	= clock_timestamp()
	where	nr_sequencia	in (
				SELECT	a.nr_sequencia
				from	proj_tp_cli_rot b,
					proj_tp_cli_rot_item a
				where	a.nr_seq_rot_cli = b.nr_sequencia
				and	b.nr_seq_roteiro = nr_seq_roteiro_w
				and	b.nr_seq_cliente = nr_seq_cliente_w)
	and	coalesce(ie_recurso_tecnico::text, '') = '';
	end;
elsif (nr_seq_index_coluna_p = 'IE_USUARIO_TREINADO') then
	begin
	update	proj_tp_cli_rot_item
	set	ie_usuario_treinado= ie_usuario_treinado_w,
		nm_usuario	= nm_usuario_p,
		dt_atualizacao	= clock_timestamp()
	where	nr_sequencia	in (
				SELECT	a.nr_sequencia
				from	proj_tp_cli_rot b,
					proj_tp_cli_rot_item a
				where	a.nr_seq_rot_cli = b.nr_sequencia
				and	b.nr_seq_roteiro = nr_seq_roteiro_w
				and	b.nr_seq_cliente = nr_seq_cliente_w)
	and	coalesce(ie_usuario_treinado::text, '') = '';
	end;
elsif (nr_seq_index_coluna_p = 'PR_EFETIVIDADE') then
	begin
	update	proj_tp_cli_rot_item
	set	pr_efetividade = pr_efetividade_w,
		nm_usuario	= nm_usuario_p,
		dt_atualizacao	= clock_timestamp()
	where	nr_sequencia	in (
				SELECT	a.nr_sequencia
				from	proj_tp_cli_rot b,
					proj_tp_cli_rot_item a
				where	a.nr_seq_rot_cli = b.nr_sequencia
				and	b.nr_seq_roteiro = nr_seq_roteiro_w
				and	b.nr_seq_cliente = nr_seq_cliente_w)
	and	coalesce(pr_efetividade::text, '') = '';
	end;
elsif (nr_seq_index_coluna_p = 'DS_RESULTADO') then
	begin
	update	proj_tp_cli_rot_item
	set	ie_resultado = ie_resultado_w,
		nm_usuario	= nm_usuario_p,
		dt_atualizacao	= clock_timestamp()
	where	nr_sequencia	in (
				SELECT	a.nr_sequencia
				from	proj_tp_cli_rot b,
					proj_tp_cli_rot_item a
				where	a.nr_seq_rot_cli = b.nr_sequencia
				and	b.nr_seq_roteiro = nr_seq_roteiro_w
				and	b.nr_seq_cliente = nr_seq_cliente_w)
	and	coalesce(ie_resultado::text, '') = '';
	end;
end if;

commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE proj_repetir_item ( nr_seq_item_p bigint, nr_seq_index_coluna_p text, nm_usuario_p text) FROM PUBLIC;

