-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE liberar_bomba_infusao (nr_seq_mat_cpoe_p bomba_infusao.nr_seq_mat_cpoe%type) AS $body$
BEGIN

  begin
    update bomba_infusao_interface bii
       set ie_em_uso = 'N'
     where exists (SELECT 1
              from bomba_infusao b
             where b.nr_seq_bomba_interface = bii.nr_sequencia
               and b.ie_ativo = 'S'
               and nr_seq_mat_cpoe = NR_SEQ_MAT_CPOE_P);
  end;

  begin
    update bomba_infusao
       set ie_ativo = 'N', 
       ie_status = 'DS', 
       dt_fim_infusao = clock_timestamp()
     where nr_seq_mat_cpoe = NR_SEQ_MAT_CPOE_P;
  end;

  commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE liberar_bomba_infusao (nr_seq_mat_cpoe_p bomba_infusao.nr_seq_mat_cpoe%type) FROM PUBLIC;

