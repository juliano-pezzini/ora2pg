-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';



CREATE TYPE t_dias_rec_w AS (
    ie_escalado varchar(15),
    ds_cor      varchar(15));


CREATE OR REPLACE PROCEDURE gerar_w_escala_plantao ( dt_dia_inicio_p text, dt_dia_fim_p text, cd_mes_p text, cd_ano_p text, nm_usuario_p text, nr_seq_classif_p text, nr_seq_grupo_p text, nr_seq_escala_p text, ie_setor_liberado_p text, ie_situacao_p text, dt_ref_ini_p text, dt_ref_fim_p text, cd_pf_p text, cd_estab_p bigint, cd_estab_logado_p bigint, ie_html_p text DEFAULT 'N') AS $body$
DECLARE

  /* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  Finalidade:
  -------------------------------------------------------------------------------------------------------------------

  Locais de chamada direta:
  [  ]  Objetos do dicion?rio [ X ] Tasy (Delphi/Java) [  ] Portal [  ]  Relat?rios [ ] Outros:
  ------------------------------------------------------------------------------------------------------------------

  Pontos de aten??o:
  3009 - [15] - Forma de gera??o da aus?ncia do profissional da escala.
  - Dom?nio 6659
  3009 - [33] - Considera regra de libera??o das escalas por perfil na pasta 'Controle de Escalas (Nova)'
  - Dom?nio 6
  -------------------------------------------------------------------------------------------------------------------

  Refer?ncias:
  ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
  hora_ini_w               varchar(255);
  hora_fim_w               varchar(255);
  data_ref_w               varchar(255);
  dt_escala_w              timestamp := NULL;
  cd_pessoa_fisica_w       varchar(10);
  ds_periodo_w             varchar(15);
  ds_conselho_prof_w       varchar(150);
  ds_classificacao_w       varchar(60);
  ds_grupo_w               varchar(60);
  ds_escala_w              varchar(60);
  nr_seq_escala_w          bigint;
  ie_dia_util_w            varchar(15) := 'S';
  ie_adic_w                varchar(1);
  dt_inicio_w              timestamp;
  dt_fim_w                 timestamp;
  nm_profissional_w        varchar(120);
  nr_seq_motivo_afast_w    bigint;
  cd_perfil_w              integer := obter_perfil_ativo;
  cd_estabelecimento_w     smallint := coalesce(wheb_usuario_pck.get_cd_estabelecimento,cd_estab_logado_p);
  ie_escalado_w            varchar(15);
  ds_cor_w                 varchar(15);
  dt_dia_inicio_w          timestamp;
  dt_dia_fim_w             timestamp;
  dt_dia_inicio_aux_w      timestamp;
  nm_usuario_pessoa_w      varchar(15);
  ie_forma_ausencia_prof_w varchar(255);
  ie_restringe_perfil_w    varchar(255);
  ds_cor_final_semana_w    varchar(15);
type t_dias_tab_w
IS
  TABLE OF t_dias_rec_w;
  v_dias_w t_dias_tab_w := t_dias_tab_w();
  C01 CURSOR FOR
    SELECT d.cd_pessoa_fisica,
      TO_CHAR(d.dt_inicio,'hh24:mi')
      || '/'
      || TO_CHAR(d.dt_fim,'hh24:mi') ds_periodo,
      d.dt_inicio,
      d.dt_fim,
      CASE WHEN d.cd_cbo_sus='' THEN SUBSTR(obter_nome_pf(d.cd_pessoa_fisica),1,100)  ELSE SUBSTR(obter_desc_cbo_red(d.cd_cbo_sus),1,80) END  nm_profissional,
      SUBSTR(obter_dados_pf(d.cd_pessoa_fisica,'CPR'),1,20) ds_conselho_prof,
      c.ds_classificacao,
      g.ds_grupo,
      e.ds_escala,
      e.nr_sequencia,
      'N' ie_adic
    FROM escala_diaria d,
      escala_grupo g,
      escala_classif c,
      escala e
    WHERE c.nr_sequencia          = g.nr_seq_classif
    AND g.nr_sequencia            = e.nr_seq_grupo
    AND e.nr_sequencia            = d.nr_seq_escala
    AND (c.nr_sequencia           = nr_seq_classif_p
    OR nr_seq_classif_p           = '0')
    AND (g.nr_sequencia           = nr_seq_grupo_p
    OR nr_seq_grupo_p             = '0')
    AND (e.nr_sequencia           = nr_seq_escala_p
    OR nr_seq_escala_p            = '0')
    AND (d.cd_pessoa_fisica IS NOT NULL AND d.cd_pessoa_fisica::text <> '')
    AND coalesce(c.ie_tipo_escala,'P') = 'P'
    AND d.dt_inicio BETWEEN dt_dia_inicio_aux_w AND dt_dia_fim_w + 86399/96400
    AND (ie_setor_liberado_p                                 = 'N'
    OR obter_se_setor_classif(d.nr_sequencia,nm_usuario_p,3) = 'S')
    AND (e.ie_situacao                                       = ie_situacao_p
    OR ie_situacao_p                                         = 'T')
    AND (d.cd_pessoa_fisica                                  = cd_pf_p
    OR cd_pf_p                                               = '0')
    AND (c.cd_estabelecimento                                = cd_estab_p
    OR cd_estab_p                                            = 0)
    AND (ie_restringe_perfil_w                               = 'N'
    OR obter_se_mostra_escala(nm_usuario_p,e.nr_sequencia)   = 'S')
    GROUP BY d.cd_pessoa_fisica,
      TO_CHAR(d.dt_inicio,'hh24:mi')
      || '/'
      || TO_CHAR(d.dt_fim,'hh24:mi'),
      d.dt_inicio,
      d.dt_fim,
      CASE WHEN d.cd_cbo_sus='' THEN SUBSTR(obter_nome_pf(d.cd_pessoa_fisica),1,100)  ELSE SUBSTR(obter_desc_cbo_red(d.cd_cbo_sus),1,80) END ,
      SUBSTR(obter_dados_pf(d.cd_pessoa_fisica,'CPR'),1,20),
      c.ds_classificacao,
      g.ds_grupo,
      e.ds_escala,
      e.nr_sequencia,
      'N',
      TO_CHAR(d.dt_inicio,'hh24:mi'),
      TO_CHAR(d.dt_fim,'hh24:mi')

UNION ALL

  SELECT f.cd_pessoa_fisica,
    TO_CHAR(d.dt_inicio,'hh24:mi')
    || '/'
    || TO_CHAR(d.dt_fim,'hh24:mi') ds_periodo,
    d.dt_inicio,
    d.dt_fim,
    SUBSTR(obter_nome_pf(f.cd_pessoa_fisica),1,100) nm_profissional,
    SUBSTR(obter_dados_pf(f.cd_pessoa_fisica,'CPR'),1,20) ds_conselho_prof,
    c.ds_classificacao,
    g.ds_grupo,
    e.ds_escala,
    e.nr_sequencia,
    'S' ie_adic
  FROM escala_diaria d,
    escala_grupo g,
    escala_classif c,
    escala e,
    escala_diaria_adic f
  WHERE c.nr_sequencia          = g.nr_seq_classif
  AND g.nr_sequencia            = e.nr_seq_grupo
  AND e.nr_sequencia            = d.nr_seq_escala
  AND (c.nr_sequencia           = nr_seq_classif_p
  OR nr_seq_classif_p           = '0')
  AND (g.nr_sequencia           = nr_seq_grupo_p
  OR nr_seq_grupo_p             = '0')
  AND (e.nr_sequencia           = nr_seq_escala_p
  OR nr_seq_escala_p            = '0')
  AND (f.cd_pessoa_fisica IS NOT NULL AND f.cd_pessoa_fisica::text <> '')
  AND coalesce(c.ie_tipo_escala,'P') = 'P'
  AND f.nr_seq_escala_diaria    = d.nr_sequencia
  AND d.dt_inicio BETWEEN dt_dia_inicio_aux_w AND dt_dia_fim_w + 86399/96400
  AND (ie_setor_liberado_p                                 = 'N'
  OR obter_se_setor_classif(d.nr_sequencia,nm_usuario_p,3) = 'S')
  AND (e.ie_situacao                                       = ie_situacao_p
  OR ie_situacao_p                                         = 'T')
  AND (f.cd_pessoa_fisica                                  = cd_pf_p
  OR cd_pf_p                                               = '0')
  AND (c.cd_estabelecimento                                = cd_estab_p
  OR cd_estab_p                                            = 0)
  AND (ie_restringe_perfil_w                               = 'N'
  OR obter_se_mostra_escala(nm_usuario_p,e.nr_sequencia)   = 'S')
  GROUP BY f.cd_pessoa_fisica,
    TO_CHAR(d.dt_inicio,'hh24:mi')
    || '/'
    || TO_CHAR(d.dt_fim,'hh24:mi'),
    d.dt_inicio,
    d.dt_fim,
    SUBSTR(obter_nome_pf(f.cd_pessoa_fisica),1,100),
    SUBSTR(obter_dados_pf(f.cd_pessoa_fisica,'CPR'),1,20),
    c.ds_classificacao,
    g.ds_grupo,
    e.ds_escala,
    e.nr_sequencia,
    'S',
    TO_CHAR(d.dt_inicio,'hh24:mi'),
    TO_CHAR(d.dt_fim,'hh24:mi')
  ORDER BY 2;

BEGIN
  ie_forma_ausencia_prof_w := obter_param_usuario(3009, 15, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_w, ie_forma_ausencia_prof_w);
  ie_restringe_perfil_w := obter_param_usuario(3009, 33, obter_perfil_Ativo, nm_usuario_p, cd_estabelecimento_w, ie_restringe_perfil_w);
  DELETE FROM w_escala_plantao WHERE nm_usuario = nm_usuario_p;
  IF (dt_dia_inicio_p    = '0')AND (dt_dia_fim_p = '0') THEN
    dt_dia_inicio_aux_w := TRUNC(to_date('01' || '/' || cd_mes_p || '/' || cd_ano_p,'dd/mm/yyyy'),'mm');
    dt_dia_fim_w        := last_day(to_date('02' || '/' || cd_mes_p || '/' || cd_ano_p,'dd/mm/yyyy'));
  ELSE
    dt_dia_inicio_aux_w := to_date(dt_dia_inicio_p || '/' || cd_mes_p || '/' || cd_ano_p,'dd/mm/yyyy');
    dt_dia_fim_w        := to_date(dt_dia_fim_p || '/' || cd_mes_p || '/' || cd_ano_p,'dd/mm/yyyy');
  END IF;
  OPEN C01;
  LOOP
    FETCH C01
    INTO cd_pessoa_fisica_w,
      ds_periodo_w,
      dt_inicio_w,
      dt_fim_w,
      nm_profissional_w,
      ds_conselho_prof_w,
      ds_classificacao_w,
      ds_grupo_w,
      ds_escala_w,
      nr_seq_escala_w,
      ie_adic_w;
    EXIT WHEN NOT FOUND; /* apply on C01 */
    BEGIN
      hora_ini_w                                      := TO_CHAR(dt_inicio_w,'dd/mm/yyyy') || ' ' || dt_ref_ini_p;
      hora_fim_w                                      := TO_CHAR(dt_inicio_w,'dd/mm/yyyy') || ' ' || dt_ref_fim_p;
      data_ref_w                                      := TO_CHAR(dt_inicio_w,'dd/mm/yyyy') || ' ' || SUBSTR(ds_periodo_w,1,5) || ':00';
      IF (to_date(data_ref_w,'dd/mm/yyyy hh24:mi:ss') >= to_date(hora_ini_w,'dd/mm/yyyy hh24:mi:ss')) AND (to_date(data_ref_w,'dd/mm/yyyy hh24:mi:ss') <= to_date(hora_fim_w,'dd/mm/yyyy hh24:mi:ss')) THEN
        BEGIN
          dt_dia_inicio_w := dt_dia_inicio_aux_w;
          v_dias_w.delete;
          v_dias_w.extend(31);
          SELECT MAX(nm_usuario)
          INTO STRICT nm_usuario_pessoa_w
          FROM usuario
          WHERE ie_situacao      = 'A'
          AND cd_pessoa_fisica   = cd_pessoa_fisica_w;
          WHILE dt_dia_inicio_w <= dt_dia_fim_w
          LOOP
            BEGIN
              ie_escalado_w         := NULL;
              ds_cor_w              := NULL;
              nr_seq_motivo_afast_w := NULL;
              dt_escala_w           := to_date(TO_CHAR(dt_dia_inicio_w,'dd/mm/yyyy') || ' ' || TO_CHAR(dt_inicio_w,'hh24:mi:ss'),'dd/mm/yyyy hh24:mi:ss') + 5/1440;
              ie_dia_util_w         := SUBSTR(obter_se_dia_util(TRUNC(dt_escala_w),cd_estabelecimento_w),1,1);
              IF (ie_adic_w          = 'N') THEN
                BEGIN
                  SELECT 'X',
                    d.nr_seq_motivo_afast
                  INTO STRICT ie_escalado_w,
                    nr_seq_motivo_afast_w
                  FROM escala_diaria d
                  WHERE d.nr_seq_escala = nr_seq_escala_w
                  AND dt_escala_w BETWEEN d.dt_inicio AND d.dt_fim
                  AND (TO_CHAR(d.dt_inicio,'hh24:mi') = TO_CHAR(dt_inicio_w,'hh24:mi')
                  OR coalesce(dt_inicio_w::text, '') = '')
                  AND (TO_CHAR(d.dt_fim,'hh24:mi')    = TO_CHAR(dt_fim_w,'hh24:mi')
                  OR coalesce(dt_fim_w::text, '') = '')
                  AND d.cd_pessoa_fisica              = cd_pessoa_fisica_w  LIMIT 1;
                EXCEPTION
                WHEN OTHERS THEN
                  ie_escalado_w := '';
                END;
              elsif (ie_adic_w = 'S') THEN
                BEGIN
                  SELECT 'X',
                    e.nr_seq_motivo_afast
                  INTO STRICT ie_escalado_w,
                    nr_seq_motivo_afast_w
                  FROM escala_diaria_adic e,
                    escala_diaria d
                  WHERE d.nr_sequencia = e.nr_seq_escala_diaria
                  AND d.nr_seq_escala  = nr_seq_escala_w
                  AND dt_escala_w BETWEEN d.dt_inicio AND d.dt_fim
                  AND (TO_CHAR(d.dt_inicio,'hh24:mi') = TO_CHAR(dt_inicio_w,'hh24:mi')
                  OR coalesce(dt_inicio_w::text, '') = '')
                  AND (TO_CHAR(d.dt_fim,'hh24:mi')    = TO_CHAR(dt_fim_w,'hh24:mi')
                  OR coalesce(dt_fim_w::text, '') = '')
                  AND e.cd_pessoa_fisica              = cd_pessoa_fisica_w  LIMIT 1;
                EXCEPTION
                WHEN OTHERS THEN
                  ie_escalado_w := '';
                END;
              END IF;
              IF (ie_forma_ausencia_prof_w = 'C') THEN
                BEGIN
                  SELECT MAX(b.ds_cor)
                  INTO STRICT ds_cor_w
                  FROM motivo_afast_escala b,
                    ausencia_tasy a
                  WHERE b.nr_sequencia = a.cd_motivo_ausencia
                  AND dt_escala_w BETWEEN a.dt_inicio AND a.dt_fim
                  AND coalesce(a.cd_estabelecimento,cd_estab_logado_p) = cd_estab_logado_p
                  AND a.nm_usuario_ausente                        = nm_usuario_pessoa_w;
                  IF (coalesce(ds_cor_w,'X')                           = 'X') AND (coalesce(nr_seq_motivo_afast_w,0) > 0) THEN
                    BEGIN
                      SELECT ds_cor
                      INTO STRICT ds_cor_w
                      FROM motivo_afast_escala
                      WHERE nr_sequencia = nr_seq_motivo_afast_w;
                    EXCEPTION
                    WHEN OTHERS THEN
                      ds_cor_w := '';
                    END;
                  END IF;
                END;
              elsif (coalesce(ie_html_p, 'N') = 'N') THEN
                BEGIN
                  SELECT MAX(b.ds_cor_fundo)
                  INTO STRICT ds_cor_w
                  FROM tasy_padrao_cor_perfil b,
                    ausencia_tasy a
                  WHERE b.nr_seq_padrao = CASE WHEN a.cd_motivo_ausencia=1 THEN 2306 WHEN a.cd_motivo_ausencia=2 THEN 2308 WHEN a.cd_motivo_ausencia=3 THEN 2309 WHEN a.cd_motivo_ausencia=4 THEN 2310 WHEN a.cd_motivo_ausencia=5 THEN 2318 WHEN a.cd_motivo_ausencia=6 THEN 2319 WHEN a.cd_motivo_ausencia=7 THEN 2329 WHEN a.cd_motivo_ausencia=8 THEN 2330 WHEN a.cd_motivo_ausencia=9 THEN 2331 WHEN a.cd_motivo_ausencia=10 THEN 3055 WHEN a.cd_motivo_ausencia=11 THEN 3057 WHEN a.cd_motivo_ausencia=12 THEN 3304 WHEN a.cd_motivo_ausencia=13 THEN 3349 WHEN a.cd_motivo_ausencia=14 THEN 3947 END
                  AND dt_escala_w BETWEEN a.dt_inicio AND a.dt_fim
                  AND coalesce(a.cd_estabelecimento,cd_estab_logado_p)    = cd_estab_logado_p
                  AND a.nm_usuario_ausente                           = nm_usuario_pessoa_w
                  AND coalesce(b.cd_perfil,cd_perfil_w)                   = cd_perfil_w
                  AND coalesce(b.cd_estabelecimento,cd_estabelecimento_w) = cd_estabelecimento_w;
                END;
              elsif (ie_html_p = 'S') THEN
                BEGIN
                  SELECT MAX(a.cd_motivo_ausencia)
                  INTO STRICT ds_cor_w
                  FROM tasy_padrao_cor_perfil b,
                    ausencia_tasy a
                  WHERE b.nr_seq_padrao = CASE WHEN a.cd_motivo_ausencia=1 THEN 2306 WHEN a.cd_motivo_ausencia=2 THEN 2308 WHEN a.cd_motivo_ausencia=3 THEN 2309 WHEN a.cd_motivo_ausencia=4 THEN 2310 WHEN a.cd_motivo_ausencia=5 THEN 2318 WHEN a.cd_motivo_ausencia=6 THEN 2319 WHEN a.cd_motivo_ausencia=7 THEN 2329 WHEN a.cd_motivo_ausencia=8 THEN 2330 WHEN a.cd_motivo_ausencia=9 THEN 2331 WHEN a.cd_motivo_ausencia=10 THEN 3055 WHEN a.cd_motivo_ausencia=11 THEN 3057 WHEN a.cd_motivo_ausencia=12 THEN 3304 WHEN a.cd_motivo_ausencia=13 THEN 3349 WHEN a.cd_motivo_ausencia=14 THEN 3947 END
                  AND dt_escala_w BETWEEN a.dt_inicio AND a.dt_fim
                  AND coalesce(a.cd_estabelecimento,cd_estab_logado_p)    = cd_estab_logado_p
                  AND a.nm_usuario_ausente                           = nm_usuario_pessoa_w
                  AND coalesce(b.cd_perfil,cd_perfil_w)                   = cd_perfil_w
                  AND coalesce(b.cd_estabelecimento,cd_estabelecimento_w) = cd_estabelecimento_w;
                END;
              END IF;
              IF (coalesce(ds_cor_w,'X') = 'X') AND (ie_dia_util_w = 'N') THEN
                SELECT MAX(b.ds_cor_fundo),
                  MAX(b.ds_cor_fundo)
                INTO STRICT ds_cor_w,
                  ds_cor_final_semana_w
                FROM tasy_padrao_cor_perfil b
                WHERE b.nr_seq_padrao                              = 7806
                AND coalesce(b.cd_perfil,cd_perfil_w)                   = cd_perfil_w
                AND coalesce(b.cd_estabelecimento,cd_estabelecimento_w) = cd_estabelecimento_w;
                IF (coalesce(ds_cor_w::text, '') = '')THEN
                  BEGIN
                    ds_cor_w              := '$003D3DA3';
                    ds_cor_final_semana_w := '$003D3DA3';
                  END;
                END IF;
              END IF;
              v_dias_w((TO_CHAR(dt_escala_w,'dd'))::numeric ).ie_escalado := ie_escalado_w;
              v_dias_w((TO_CHAR(dt_escala_w,'dd'))::numeric ).ds_cor      := ds_cor_w;
              dt_dia_inicio_w                                            := dt_dia_inicio_w + 1;
            END;
          END LOOP;
          INSERT
          INTO w_escala_plantao(
              nr_sequencia,
              cd_pessoa_fisica,
              ds_classificacao,
              ds_grupo,
              ds_escala,
              nm_profissional,
              ds_conselho_prof,
              ds_periodo,
              nm_usuario,
              nm_usuario_nrec,
              dt_atualizacao,
              dt_atualizacao_nrec,
              ds_cor_final_semana,
              ie_escalado1,
              ie_escalado2,
              ie_escalado3,
              ie_escalado4,
              ie_escalado5,
              ie_escalado6,
              ie_escalado7,
              ie_escalado8,
              ie_escalado9,
              ie_escalado10,
              ie_escalado11,
              ie_escalado12,
              ie_escalado13,
              ie_escalado14,
              ie_escalado15,
              ie_escalado16,
              ie_escalado17,
              ie_escalado18,
              ie_escalado19,
              ie_escalado20,
              ie_escalado21,
              ie_escalado22,
              ie_escalado23,
              ie_escalado24,
              ie_escalado25,
              ie_escalado26,
              ie_escalado27,
              ie_escalado28,
              ie_escalado29,
              ie_escalado30,
              ie_escalado31,
              ds_cor1,
              ds_cor2,
              ds_cor3,
              ds_cor4,
              ds_cor5,
              ds_cor6,
              ds_cor7,
              ds_cor8,
              ds_cor9,
              ds_cor10,
              ds_cor11,
              ds_cor12,
              ds_cor13,
              ds_cor14,
              ds_cor15,
              ds_cor16,
              ds_cor17,
              ds_cor18,
              ds_cor19,
              ds_cor20,
              ds_cor21,
              ds_cor22,
              ds_cor23,
              ds_cor24,
              ds_cor25,
              ds_cor26,
              ds_cor27,
              ds_cor28,
              ds_cor29,
              ds_cor30,
              ds_cor31,
              dt_mes,
              dt_ano
            )
            VALUES (
              nextval('w_escala_plantao_seq'),
              cd_pessoa_fisica_w,
              ds_classificacao_w,
              ds_grupo_w,
              ds_escala_w,
              nm_profissional_w,
              ds_conselho_prof_w,
              ds_periodo_w,
              nm_usuario_p,
              nm_usuario_p,
              clock_timestamp(),
              clock_timestamp(),
              ds_cor_final_semana_w,
              v_dias_w[1].ie_escalado,
              v_dias_w[2].ie_escalado,
              v_dias_w[3].ie_escalado,
              v_dias_w[4].ie_escalado,
              v_dias_w[5].ie_escalado,
              v_dias_w[6].ie_escalado,
              v_dias_w[7].ie_escalado,
              v_dias_w[8].ie_escalado,
              v_dias_w[9].ie_escalado,
              v_dias_w[10].ie_escalado,
              v_dias_w[11].ie_escalado,
              v_dias_w[12].ie_escalado,
              v_dias_w[13].ie_escalado,
              v_dias_w[14].ie_escalado,
              v_dias_w[15].ie_escalado,
              v_dias_w[16].ie_escalado,
              v_dias_w[17].ie_escalado,
              v_dias_w[18].ie_escalado,
              v_dias_w[19].ie_escalado,
              v_dias_w[20].ie_escalado,
              v_dias_w[21].ie_escalado,
              v_dias_w[22].ie_escalado,
              v_dias_w[23].ie_escalado,
              v_dias_w[24].ie_escalado,
              v_dias_w[25].ie_escalado,
              v_dias_w[26].ie_escalado,
              v_dias_w[27].ie_escalado,
              v_dias_w[28].ie_escalado,
              v_dias_w[29].ie_escalado,
              v_dias_w[30].ie_escalado,
              v_dias_w[31].ie_escalado,
              v_dias_w[1].ds_cor,
              v_dias_w[2].ds_cor,
              v_dias_w[3].ds_cor,
              v_dias_w[4].ds_cor,
              v_dias_w[5].ds_cor,
              v_dias_w[6].ds_cor,
              v_dias_w[7].ds_cor,
              v_dias_w[8].ds_cor,
              v_dias_w[9].ds_cor,
              v_dias_w[10].ds_cor,
              v_dias_w[11].ds_cor,
              v_dias_w[12].ds_cor,
              v_dias_w[13].ds_cor,
              v_dias_w[14].ds_cor,
              v_dias_w[15].ds_cor,
              v_dias_w[16].ds_cor,
              v_dias_w[17].ds_cor,
              v_dias_w[18].ds_cor,
              v_dias_w[19].ds_cor,
              v_dias_w[20].ds_cor,
              v_dias_w[21].ds_cor,
              v_dias_w[22].ds_cor,
              v_dias_w[23].ds_cor,
              v_dias_w[24].ds_cor,
              v_dias_w[25].ds_cor,
              v_dias_w[26].ds_cor,
              v_dias_w[27].ds_cor,
              v_dias_w[28].ds_cor,
              v_dias_w[29].ds_cor,
              v_dias_w[30].ds_cor,
              v_dias_w[31].ds_cor,
              cd_mes_p,
              cd_ano_p
            );
        END;
      END IF;
    END;
  END LOOP;
  CLOSE C01;
  COMMIT;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_w_escala_plantao ( dt_dia_inicio_p text, dt_dia_fim_p text, cd_mes_p text, cd_ano_p text, nm_usuario_p text, nr_seq_classif_p text, nr_seq_grupo_p text, nr_seq_escala_p text, ie_setor_liberado_p text, ie_situacao_p text, dt_ref_ini_p text, dt_ref_fim_p text, cd_pf_p text, cd_estab_p bigint, cd_estab_logado_p bigint, ie_html_p text DEFAULT 'N') FROM PUBLIC;

