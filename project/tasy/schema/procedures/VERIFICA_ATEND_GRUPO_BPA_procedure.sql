-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE verifica_atend_grupo_bpa ( cd_procedimento_p bigint, ie_origem_proced_p bigint, cd_atividade_prof_bpa_p bigint, ie_tipo_atend_bpa_p INOUT bigint, ie_grupo_atend_bpa_p INOUT bigint, ie_multiplo_p INOUT text) AS $body$
DECLARE


qt_registros_w		bigint;
ie_tipo_atend_bpa_w	smallint;
ie_grupo_atend_bpa_w	smallint;
ie_multiplo_w		varchar(1)	:= 'N';


BEGIN

select	count(*)
into STRICT	qt_registros_w
from	sus_atividade_prof_proc
where	cd_procedimento			= cd_procedimento_p
and	ie_origem_proced		= ie_origem_proced_p
and	cd_atividade_profissional	= cd_atividade_prof_bpa_p;

if (qt_registros_w	= 1) then
	select	ie_tipo_atend_bpa,
		ie_grupo_atend_bpa
	into STRICT	ie_tipo_atend_bpa_w,
		ie_grupo_atend_bpa_w
	from	sus_atividade_prof_proc
	where	cd_procedimento			= cd_procedimento_p
	and	ie_origem_proced		= ie_origem_proced_p
	and	cd_atividade_profissional	= cd_atividade_prof_bpa_p;
elsif (qt_registros_w	> 1) then
	ie_multiplo_w	:= 'S';

	select	ie_tipo_atend_bpa,
		ie_grupo_atend_bpa
	into STRICT	ie_tipo_atend_bpa_w,
		ie_grupo_atend_bpa_w
	from	sus_atividade_prof_proc
	where	nr_sequencia	= (	SELECT	min(nr_sequencia)
					from	sus_atividade_prof_proc
					where	cd_procedimento			= cd_procedimento_p
					and	ie_origem_proced		= ie_origem_proced_p
					and	cd_atividade_profissional	= cd_atividade_prof_bpa_p);
end if;

ie_tipo_atend_bpa_p	:= ie_tipo_atend_bpa_w;
ie_grupo_atend_bpa_p	:= ie_grupo_atend_bpa_w;
ie_multiplo_p		:= ie_multiplo_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE verifica_atend_grupo_bpa ( cd_procedimento_p bigint, ie_origem_proced_p bigint, cd_atividade_prof_bpa_p bigint, ie_tipo_atend_bpa_p INOUT bigint, ie_grupo_atend_bpa_p INOUT bigint, ie_multiplo_p INOUT text) FROM PUBLIC;

