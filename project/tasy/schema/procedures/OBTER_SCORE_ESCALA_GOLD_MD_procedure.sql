-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_score_escala_gold_md ( qt_irritado_p bigint, ie_irritado_adm_p text, QT_CAT_01_p bigint, QT_CAT_02_p bigint, QT_CAT_03_p bigint, QT_CAT_04_p bigint, QT_CAT_05_p bigint, QT_CAT_06_p bigint, QT_CAT_07_p bigint, QT_CAT_08_p bigint, ie_mmrc_p bigint, qt_total_cat_p INOUT bigint, ie_grupo_p INOUT text ) AS $body$
DECLARE

  ie_linha_w  smallint;
  ie_coluna_w smallint;
  ie_grupo_w  varchar(1);

BEGIN
  if (qt_irritado_p >= 2) then
    ie_linha_w := 1;
  elsif (qt_irritado_p >= 1) then
    ie_linha_w := 1;
    if (ie_irritado_adm_p = 'S') then
      ie_linha_w := 2;
    end if;
  else
    ie_linha_w := 2;
  end if;

  qt_total_cat_p := coalesce(QT_CAT_01_p,0) + coalesce(QT_CAT_02_p,0) + coalesce(QT_CAT_03_p,0) + coalesce(QT_CAT_04_p,0) +
                    coalesce(QT_CAT_05_p,0) + coalesce(QT_CAT_06_p,0) + coalesce(QT_CAT_07_p,0) + coalesce(QT_CAT_08_p,0);



  if (ie_mmrc_p >= 2) or (qt_total_cat_p >= 10) then
    ie_coluna_w	:= 2;
  else
    ie_coluna_w	:= 1;
  end if;

  if (ie_linha_w = 1)  then
    ie_grupo_w := 'C';
    if (ie_coluna_w = 2) then
      ie_grupo_w := 'D';
    end if;
  elsif (ie_linha_w = 2) then
    ie_grupo_w := 'A';
    if (ie_coluna_w = 2) then
      ie_grupo_w := 'B';
    end if;
  end if;

  ie_grupo_p := ie_grupo_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_score_escala_gold_md ( qt_irritado_p bigint, ie_irritado_adm_p text, QT_CAT_01_p bigint, QT_CAT_02_p bigint, QT_CAT_03_p bigint, QT_CAT_04_p bigint, QT_CAT_05_p bigint, QT_CAT_06_p bigint, QT_CAT_07_p bigint, QT_CAT_08_p bigint, ie_mmrc_p bigint, qt_total_cat_p INOUT bigint, ie_grupo_p INOUT text ) FROM PUBLIC;

