-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ctb_copiar_modelo_rubrica ( nr_sequencia_p bigint, nm_usuario_p text) AS $body$
DECLARE



nr_seq_modelo_w			ctb_modelo_relat.nr_sequencia%type;
ds_modelo_w			ctb_modelo_relat.ds_modelo%type;
cd_empresa_w			ctb_modelo_relat.cd_empresa%type;
nr_seq_apres_w			ctb_modelo_rubrica.nr_seq_apres%type;
ds_rubrica_w			ctb_modelo_rubrica.ds_rubrica%type;
qt_desl_esq_w			ctb_modelo_rubrica.qt_desl_esq%type;
ie_origem_valor_w		ctb_modelo_rubrica.ie_origem_valor%type;
ds_origem_w			ctb_modelo_rubrica.ds_origem%type;
nr_seq_somat_w			ctb_modelo_rubrica.nr_seq_somat%type;
ie_situacao_w			ctb_modelo_rubrica.ie_situacao%type;
ie_informacao_w			ctb_modelo_rubrica.ie_informacao%type;
ds_divisor_w			ctb_modelo_rubrica.ds_divisor%type;
ie_negrito_w			ctb_modelo_rubrica.ie_negrito%type;
ie_italico_w			ctb_modelo_rubrica.ie_italico%type;
ie_sublinhado_w			ctb_modelo_rubrica.ie_sublinhado%type;
ds_cor_fonte_w			ctb_modelo_rubrica.ds_cor_fonte%type;
ds_cor_fundo_w			ctb_modelo_rubrica.ds_cor_fundo%type;
ie_tipo_ctb_estab_w		ctb_modelo_rubrica.ie_tipo_ctb_estab%type;
ds_observacao_w			ctb_modelo_rubrica.ds_observacao%type;
ie_grupo_balanco_ecd_w		ctb_modelo_rubrica.ie_grupo_balanco_ecd%type;
cd_registro_sped_w		ctb_modelo_relat.cd_registro_sped%type;

C01 CURSOR FOR
SELECT	nr_seq_apres,
	ds_rubrica,
	qt_desl_esq,
	ie_origem_valor,
	ds_origem,
	nr_seq_somat,
	ie_situacao,
	ie_informacao,
	ds_divisor,
	ie_negrito,
	ie_italico,
	ie_sublinhado,
	ds_cor_fonte,
	ds_cor_fundo,
	ie_tipo_ctb_estab,
	ds_observacao,
	ie_grupo_balanco_ecd
from	ctb_modelo_rubrica
where	nr_seq_modelo = nr_sequencia_p;


BEGIN

select	ds_modelo,
	cd_empresa,
	cd_registro_sped
into STRICT	ds_modelo_w,
	cd_empresa_w,
	cd_registro_sped_w
from	ctb_modelo_relat
where	nr_sequencia = nr_sequencia_p;

select	nextval('ctb_modelo_relat_seq')
into STRICT	nr_seq_modelo_w
;

insert into ctb_modelo_relat(
	nr_sequencia,
	dt_atualizacao,
	nm_usuario,
	ds_modelo,
	dt_atualizacao_nrec,
	nm_usuario_nrec,
	cd_empresa,
	ie_situacao,
	cd_registro_sped)
values (	nr_seq_modelo_w,
	clock_timestamp(),
	nm_usuario_p,
	substr(wheb_mensagem_pck.get_texto(298105 ,'DS_MODELO_W=' || substr(ds_modelo_w,1,71)),1,80),
	clock_timestamp(),
	nm_usuario_p,
	cd_empresa_w,
	'A',
	cd_registro_sped_w);

open c01;
loop
fetch c01 into
	nr_seq_apres_w,
	ds_rubrica_w,
	qt_desl_esq_w,
	ie_origem_valor_w,
	ds_origem_w,
	nr_seq_somat_w,
	ie_situacao_w,
	ie_informacao_w,
	ds_divisor_w,
	ie_negrito_w,
	ie_italico_w,
	ie_sublinhado_w,
	ds_cor_fonte_w,
	ds_cor_fundo_w,
	ie_tipo_ctb_estab_w,
	ds_observacao_w,
	ie_grupo_balanco_ecd_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin
	insert into ctb_modelo_rubrica(
		nr_sequencia,
		nr_seq_modelo,
		dt_atualizacao,
		nm_usuario,
		nr_seq_apres,
		ds_rubrica,
		qt_desl_esq,
		ie_origem_valor,
		ds_origem,
		nr_seq_somat,
		ie_situacao,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		ie_informacao,
		ds_divisor,
		ie_negrito,
		ie_italico,
		ie_sublinhado,
		ds_cor_fonte,
		ds_cor_fundo,
		ie_tipo_ctb_estab,
		ds_observacao,
		ie_grupo_balanco_ecd)
	values (	nextval('ctb_modelo_rubrica_seq'),
		nr_seq_modelo_w,
		clock_timestamp(),
		nm_usuario_p,
		nr_seq_apres_w,
		ds_rubrica_w,
		qt_desl_esq_w,
		ie_origem_valor_w,
		ds_origem_w,
		nr_seq_somat_w,
		ie_situacao_w,
		clock_timestamp(),
		nm_usuario_p,
		ie_informacao_w,
		ds_divisor_w,
		ie_negrito_w,
		ie_italico_w,
		ie_sublinhado_w,
		ds_cor_fonte_w,
		ds_cor_fundo_w,
		ie_tipo_ctb_estab_w,
		ds_observacao_w,
		ie_grupo_balanco_ecd_w);
	end;
end loop;
close c01;

insert into ctb_demonstrativo_lib(
	nr_sequencia,
	nr_seq_modelo,
	nr_seq_demonstrativo,
	nm_usuario,
	dt_atualizacao,
	nm_usuario_nrec,
	dt_atualizacao_nrec,
	cd_perfil,
	cd_cargo,
	nm_usuario_lib,
	ie_permissao)
SELECT	nextval('ctb_demonstrativo_lib_seq'),
	nr_seq_modelo_w,
	null,
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	cd_perfil,
	cd_cargo,
	nm_usuario_lib,
	ie_permissao
from	ctb_demonstrativo_lib a
where	a.nr_seq_modelo	= nr_sequencia_p;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ctb_copiar_modelo_rubrica ( nr_sequencia_p bigint, nm_usuario_p text) FROM PUBLIC;

