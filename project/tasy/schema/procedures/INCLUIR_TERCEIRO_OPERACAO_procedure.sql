-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE incluir_terceiro_operacao ( nr_seq_terceiro_p bigint, nr_seq_operacao_p bigint, cd_material_p bigint, cd_procedimento_p bigint, ie_origem_proced_p bigint, qt_operacao_p bigint, vl_operacao_p bigint, dt_operacao_p timestamp, nr_seq_trans_fin_p bigint, cd_pessoa_fisica_p text, nr_doc_p text, nr_seq_doc_p bigint, nr_seq_ordem_servico_p bigint, ie_biometria_p text, ie_senha_p text, qt_peso_p bigint, cd_local_estoque_p bigint, nr_sequencia_terceiro_p INOUT bigint, cd_estabelecimento_p bigint, nm_usuario_inclusao_p text, nr_seq_lote_fornec_p text default null) AS $body$
DECLARE

 
			 
nr_sequencia_operacao_w			bigint;
dt_operacao_char_w				varchar(20);
dt_hora_w						timestamp;
dt_operacao_w					timestamp;

BEGIN
 
select	nextval('terceiro_operacao_seq') 
into STRICT	nr_sequencia_operacao_w
;
 
/*OS 1392055 - Incluir a hora na operação*/
 
begin	 
	dt_hora_w		:= clock_timestamp();	
	dt_operacao_w 	:= to_date(to_char(dt_operacao_p,'dd/MM/yyyy')||' '||to_char(dt_hora_w,'hh24:mi:ss'), 'dd/MM/yyyy hh24:mi:ss');
exception when others then 
	dt_operacao_w	:= null;
end;
 
insert	into	terceiro_operacao( 
	nr_sequencia, 
	dt_inclusao, 
	nr_seq_terceiro, 
	nr_seq_operacao, 
	cd_material, 
	cd_procedimento, 
	ie_origem_proced, 
	qt_operacao, 
	vl_operacao, 
	dt_operacao, 
	nr_seq_trans_fin, 
	cd_pessoa_fisica, 
	nr_doc, 
	nr_seq_doc, 
	nr_seq_ordem_servico, 
	ie_biometria, 
	ie_senha, 
	qt_peso, 
	cd_local_estoque, 
	nm_usuario, 
	nm_usuario_inclusao, 
	dt_atualizacao, 
	cd_estabelecimento, 
	tx_operacao, 
	nr_seq_lote_fornec 
	) 
values ( 
	nr_sequencia_operacao_w, 
	clock_timestamp(), 
	nr_seq_terceiro_p, 
	nr_seq_operacao_p, 
	cd_material_p, 
	cd_procedimento_p, 
	ie_origem_proced_p, 
	qt_operacao_p, 
	vl_operacao_p, 
	coalesce(dt_operacao_w, dt_operacao_p), 
	nr_seq_trans_fin_p, 
	cd_pessoa_fisica_p, 
	nr_doc_p, 
	nr_seq_doc_p, 
	nr_seq_ordem_servico_p, 
	ie_biometria_p, 
	ie_senha_p, 
	qt_peso_p, 
	cd_local_estoque_p, 
	nm_usuario_inclusao_p, 
	nm_usuario_inclusao_p, 
	clock_timestamp(), 
	cd_estabelecimento_p, 
	0, 
	nr_seq_lote_fornec_p);
	 
CALL atualizar_operacao_terceiro(nr_sequencia_operacao_w,nm_usuario_inclusao_p);
	 
commit;
 
nr_sequencia_terceiro_p	:= nr_sequencia_operacao_w;
	 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE incluir_terceiro_operacao ( nr_seq_terceiro_p bigint, nr_seq_operacao_p bigint, cd_material_p bigint, cd_procedimento_p bigint, ie_origem_proced_p bigint, qt_operacao_p bigint, vl_operacao_p bigint, dt_operacao_p timestamp, nr_seq_trans_fin_p bigint, cd_pessoa_fisica_p text, nr_doc_p text, nr_seq_doc_p bigint, nr_seq_ordem_servico_p bigint, ie_biometria_p text, ie_senha_p text, qt_peso_p bigint, cd_local_estoque_p bigint, nr_sequencia_terceiro_p INOUT bigint, cd_estabelecimento_p bigint, nm_usuario_inclusao_p text, nr_seq_lote_fornec_p text default null) FROM PUBLIC;

