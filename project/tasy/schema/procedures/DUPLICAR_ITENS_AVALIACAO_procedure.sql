-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_itens_avaliacao ( nr_seq_tipo_p bigint, nr_seq_sup_p bigint) AS $body$
DECLARE


nr_seq_w		bigint;
nr_sequencia_w		bigint;
nr_seq_apresent_w	integer;
DS_ITEM_W           	varchar(255);
NR_SEQ_TIPO_W       	bigint;
IE_RESULTADO_W      	varchar(2);
DT_ATUALIZACAO_W    	timestamp;
NM_USUARIO_W        	varchar(15);
QT_DECIMAIS_W       	smallint;
DS_UNID_MED_W       	varchar(15);
QT_MINIMO_W         	double precision;
QT_MAXIMO_W         	double precision;
NR_SEQ_SUPERIOR_W   	bigint;
IE_OBRIGATORIO_W    	varchar(1);
QT_TAMANHO_W        	smallint;
QT_DESLOC_DIREITA_W 	smallint;
QT_POS_ESQUERDA_W   	smallint;
CD_DOMINIO_W        	integer;
DS_COMPLEMENTO_W    	varchar(4000);
NR_SEQ_ITEM_REF_W   	bigint;
VL_PADRAO_W         	varchar(2000);
IE_TIPO_CAMPO_W     	varchar(15);
QT_TAB_ORDER_W		smallint;
DS_MASCARA_W        	med_item_avaliar.ds_mascara%type;
DS_REGRA_W          	varchar(4000);
DS_COR_GRAFICO_W    	varchar(20);
QT_ALTURA_W         	integer;
NR_SEQ_ITEM_W     	bigint;
DS_RESULTADO_W    	varchar(255);
QT_RESULTADO_W    	double precision;
NR_SEQ_RES_W	        integer;
DS_RESULT_REF_W		varchar(255);	
QT_MAX_CARACTER_W	integer;
IE_GRAFICO_AVALIACAO_w	varchar(1);


C01 CURSOR FOR
SELECT	NR_SEQUENCIA	  ,
	DS_ITEM           ,
	NR_SEQ_TIPO       ,
	IE_RESULTADO      ,
	DT_ATUALIZACAO    ,
	NM_USUARIO        ,
	QT_DECIMAIS       ,
	DS_UNID_MED       ,
	QT_MINIMO         ,
	QT_MAXIMO         ,
	IE_OBRIGATORIO    ,
	QT_TAMANHO        ,
	QT_DESLOC_DIREITA ,
	QT_POS_ESQUERDA   ,
	CD_DOMINIO        ,
	DS_COMPLEMENTO    ,
	NR_SEQ_ITEM_REF   ,
	VL_PADRAO         ,
	IE_TIPO_CAMPO     ,
	DS_MASCARA        ,
	DS_REGRA          ,
	DS_COR_GRAFICO    ,
	QT_ALTURA         ,
	QT_MAX_CARACTER	  ,
	QT_TAB_ORDER	  ,
	IE_GRAFICO_AVALIACAO
from	med_item_avaliar
where	nr_seq_tipo	= nr_seq_tipo_p
and	nr_seq_superior	= nr_seq_sup_p
order by	nr_seq_apresent;

C02 CURSOR FOR
SELECT	NR_SEQ_RES      ,
	DT_ATUALIZACAO  ,
	NM_USUARIO      ,
	DS_RESULTADO    ,
	QT_RESULTADO    ,
	NR_SEQ_ITEM_REF ,
	DS_RESULT_REF
from	med_item_avaliar_res
where	nr_seq_item = nr_seq_w;

C03 CURSOR FOR
SELECT	NR_SEQ_RES      ,
	DT_ATUALIZACAO  ,
	NM_USUARIO      ,
	DS_RESULTADO    ,
	QT_RESULTADO    ,
	NR_SEQ_ITEM_REF ,
	DS_RESULT_REF
from	med_item_avaliar_res
where	nr_seq_item = nr_seq_sup_p;




BEGIN

select	nextval('med_item_avaliar_seq')
into STRICT	nr_sequencia_w
;

select  max(nr_seq_apresent) + 1
into STRICT	nr_seq_apresent_w
from	med_item_avaliar
where	nr_seq_tipo = nr_seq_tipo_p;

insert	into med_item_avaliar(
	NR_SEQUENCIA      ,	DS_ITEM           ,	NR_SEQ_TIPO       ,	NR_SEQ_APRESENT   ,
	IE_RESULTADO      ,	DT_ATUALIZACAO    ,	NM_USUARIO        ,	QT_DECIMAIS       ,
	DS_UNID_MED       ,	QT_MINIMO         ,	QT_MAXIMO         ,	NR_SEQ_SUPERIOR   ,
	IE_OBRIGATORIO    ,	QT_TAMANHO        ,	QT_DESLOC_DIREITA ,	QT_POS_ESQUERDA   ,
	CD_DOMINIO        ,	DS_COMPLEMENTO    ,	NR_SEQ_ITEM_REF   ,	VL_PADRAO         ,
	IE_TIPO_CAMPO     ,	DS_MASCARA        ,	DS_REGRA          ,	DS_COR_GRAFICO    ,
	QT_ALTURA         ,	QT_MAX_CARACTER   ,	QT_TAB_ORDER	  ,	IE_GRAFICO_AVALIACAO,
	IE_SITUACAO)
SELECT	nr_sequencia_w	  ,	obter_desc_expressao(303214) ||' '|| DS_ITEM,	NR_SEQ_TIPO       ,	nr_seq_apresent_w ,
	IE_RESULTADO      ,	DT_ATUALIZACAO    ,	NM_USUARIO        ,	QT_DECIMAIS       ,
	DS_UNID_MED       ,	QT_MINIMO         ,	QT_MAXIMO         ,	NR_SEQ_SUPERIOR	  ,
	IE_OBRIGATORIO    ,	QT_TAMANHO        ,	QT_DESLOC_DIREITA ,	QT_POS_ESQUERDA   ,
	CD_DOMINIO        ,	DS_COMPLEMENTO    ,	NR_SEQ_ITEM_REF   ,	VL_PADRAO         ,
	IE_TIPO_CAMPO     ,	DS_MASCARA        ,	DS_REGRA          ,	DS_COR_GRAFICO    ,
	QT_ALTURA	,	QT_MAX_CARACTER   ,	QT_TAB_ORDER	  ,	IE_GRAFICO_AVALIACAO,
	'A'
from	med_item_avaliar
where	nr_seq_tipo	= nr_seq_tipo_p
and	nr_sequencia	= nr_seq_sup_p;

OPEN C03;
LOOP
FETCH C03 into
	NR_SEQ_RES_W      ,
	DT_ATUALIZACAO_W  ,
	NM_USUARIO_W      ,
	DS_RESULTADO_W    ,
	QT_RESULTADO_W    ,
	NR_SEQ_ITEM_REF_W ,
	DS_RESULT_REF_W;
EXIT WHEN NOT FOUND; /* apply on C03 */
	begin
	
	insert into med_item_avaliar_res(
		NR_SEQ_ITEM	,
		NR_SEQ_RES      ,
		DT_ATUALIZACAO  ,       
		NM_USUARIO      ,       
		DS_RESULTADO    ,       
		QT_RESULTADO    ,       
		NR_SEQ_ITEM_REF ,       
		DS_RESULT_REF   )			
	values (nr_sequencia_w	  ,
		NR_SEQ_RES_W      ,
		DT_ATUALIZACAO_W  ,
		NM_USUARIO_W      ,
		DS_RESULTADO_W    ,
		QT_RESULTADO_W    ,
		NR_SEQ_ITEM_REF_W ,
		DS_RESULT_REF_W   );
	end;
END LOOP;
close C03;


OPEN C01;
LOOP
FETCH C01 into
	NR_SEQ_W	    ,
	DS_ITEM_W           ,
	NR_SEQ_TIPO_W       ,
	IE_RESULTADO_w      ,
	DT_ATUALIZACAO_W    ,
	NM_USUARIO_W        ,
	QT_DECIMAIS_W       ,
	DS_UNID_MED_W       ,
	QT_MINIMO_W         ,
	QT_MAXIMO_W         ,
	IE_OBRIGATORIO_W    ,
	QT_TAMANHO_W        ,
	QT_DESLOC_DIREITA_W ,
	QT_POS_ESQUERDA_W   ,
	CD_DOMINIO_W        ,
	DS_COMPLEMENTO_W    ,
	NR_SEQ_ITEM_REF_W   ,
	VL_PADRAO_W         ,
	IE_TIPO_CAMPO_W     ,
	DS_MASCARA_W        ,
	DS_REGRA_W          ,
	DS_COR_GRAFICO_W    ,
	QT_ALTURA_W         ,
	QT_MAX_CARACTER_w,	
	QT_TAB_ORDER_W,
	IE_GRAFICO_AVALIACAO_w;      	
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin
	
	select  max(nr_seq_apresent) + 1
	into STRICT	nr_seq_apresent_w
	from	med_item_avaliar
	where	nr_seq_tipo = nr_seq_tipo_p;
	
	select	nextval('med_item_avaliar_seq')
	into STRICT	nr_seq_item_w
	;
	
	insert	into med_item_avaliar(
		 NR_SEQUENCIA      ,		 DS_ITEM           ,		 NR_SEQ_TIPO       ,
		 NR_SEQ_APRESENT   ,		 IE_RESULTADO      ,		 DT_ATUALIZACAO    ,
		 NM_USUARIO        ,		 QT_DECIMAIS       ,		 DS_UNID_MED       ,
		 QT_MINIMO         ,		 QT_MAXIMO         ,		 NR_SEQ_SUPERIOR   ,
		 IE_OBRIGATORIO    ,		 QT_TAMANHO        ,		 QT_DESLOC_DIREITA ,
		 QT_POS_ESQUERDA   ,		 CD_DOMINIO        ,		 DS_COMPLEMENTO    ,
		 NR_SEQ_ITEM_REF   ,		 VL_PADRAO         ,		 IE_TIPO_CAMPO     ,
		 DS_MASCARA        ,		 DS_REGRA          ,		 DS_COR_GRAFICO    ,
		 QT_ALTURA         ,		QT_MAX_CARACTER	   ,		 QT_TAB_ORDER,
		 IE_GRAFICO_AVALIACAO)
	values (nr_seq_item_w	     ,		 DS_ITEM_W           ,		 NR_SEQ_TIPO_W       ,	
		 nr_seq_apresent_w   ,		 IE_RESULTADO_W      ,		 DT_ATUALIZACAO_W    ,		
		 NM_USUARIO_W        ,		 QT_DECIMAIS_W       ,		 DS_UNID_MED_W       ,
		 QT_MINIMO_W         ,		 QT_MAXIMO_W         ,		 nr_sequencia_w      ,		 
		 IE_OBRIGATORIO_W    ,		 QT_TAMANHO_W        ,		 QT_DESLOC_DIREITA_W ,
		 QT_POS_ESQUERDA_W   ,		 CD_DOMINIO_W        ,		 DS_COMPLEMENTO_W    ,
		 NR_SEQ_ITEM_REF_W   ,		 VL_PADRAO_W         ,		 IE_TIPO_CAMPO_W     ,		 
		 DS_MASCARA_W        ,		 DS_REGRA_W          ,		 DS_COR_GRAFICO_W    ,		 
		 QT_ALTURA_W	,		QT_MAX_CARACTER_w   ,		QT_TAB_ORDER_W,
		 IE_GRAFICO_AVALIACAO_w);

	OPEN C02;
	LOOP
	FETCH C02 into
		NR_SEQ_RES_W      ,
		DT_ATUALIZACAO_W  ,
		NM_USUARIO_W      ,
		DS_RESULTADO_W    ,
		QT_RESULTADO_W    ,
		NR_SEQ_ITEM_REF_W ,
		DS_RESULT_REF_W;
	EXIT WHEN NOT FOUND; /* apply on C02 */
		begin
		
		insert into med_item_avaliar_res(
			NR_SEQ_ITEM	,
			NR_SEQ_RES      ,
			DT_ATUALIZACAO  ,       
			NM_USUARIO      ,       
			DS_RESULTADO    ,       
			QT_RESULTADO    ,       
			NR_SEQ_ITEM_REF ,       
			DS_RESULT_REF   )			
		values (nr_seq_item_w	  ,
			NR_SEQ_RES_W      ,
			DT_ATUALIZACAO_W  ,
			NM_USUARIO_W      ,
			DS_RESULTADO_W    ,
			QT_RESULTADO_W    ,
			NR_SEQ_ITEM_REF_W ,
			DS_RESULT_REF_W   );
		end;
	END LOOP;
	close C02;

	end;
END LOOP;
close C01;

commit;

end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_itens_avaliacao ( nr_seq_tipo_p bigint, nr_seq_sup_p bigint) FROM PUBLIC;

