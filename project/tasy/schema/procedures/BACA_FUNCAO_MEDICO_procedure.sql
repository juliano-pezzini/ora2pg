-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_funcao_medico () AS $body$
DECLARE


CD_FUNCAO_W				smallint;
DS_FUNCAO_W				varchar(80);
NR_SEQUENCIA_W			bigint;
TX_MEDICO_W				double precision;
TX_ANESTESISTA_W			double precision;

C001 CURSOR FOR
SELECT	(substr(vl_dominio,1,3))::numeric ,
		substr(ds_valor_dominio,1,80)
from		valor_dominio
where		cd_dominio = 15;


BEGIN
open 	c001;
loop
fetch c001 	into
		CD_FUNCAO_W,
		DS_FUNCAO_W;
	EXIT WHEN NOT FOUND; /* apply on c001 */
		BEGIN
		/* gera funcao_medico */

		begin
		insert into funcao_medico(
				CD_FUNCAO,
				DS_FUNCAO,
				DT_ATUALIZACAO,
				NM_USUARIO)
		values (
				CD_FUNCAO_W,
				DS_FUNCAO_W,
				clock_timestamp(),
				'Tasy');
		end;

		/* gera funcao_medico_convenio */

		begin

		select nextval('funcao_medico_convenio_seq')
		into STRICT  nr_sequencia_w
		;

		TX_MEDICO_W		:= 0;
		TX_ANESTESISTA_W	:= 0;

		/* Clínico geral */

		if (CD_FUNCAO_W = 0) then
			TX_MEDICO_W		:= 1;
		end if;

		/* Cirurgião principal */

		if (CD_FUNCAO_W = 1) then
			TX_MEDICO_W		:= 1;
		end if;

		/* Cirurgião auxiliar */

		if (CD_FUNCAO_W = 2) then
			TX_MEDICO_W		:= 0.30;
		end if;

		/* Anestesista */

		if (CD_FUNCAO_W = 3) then
			TX_ANESTESISTA_W	:= 1;
		end if;

		/* Médicos auxiliares */

		if (CD_FUNCAO_W = 4) then
			TX_MEDICO_W		:= 0.20;
		end if;

		/* Anestesista auxiliar */

		if (CD_FUNCAO_W = 7) then
			TX_ANESTESISTA_W	:= 0.30;
		end if;

		insert into funcao_medico_convenio(
				NR_SEQUENCIA,
				CD_FUNCAO_MEDICO,
				NM_USUARIO,
				DT_ATUALIZACAO,
				CD_CONVENIO,
				TX_VALOR_MEDICO,
				TX_VALOR_ANESTESISTA)
		values (	NR_SEQUENCIA_W,
				CD_FUNCAO_W,
				'Tasy',
				clock_timestamp(),
				NULL,
				TX_MEDICO_W,
				TX_ANESTESISTA_W);
		end;

		END;
end loop;
close c001;
commit;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_funcao_medico () FROM PUBLIC;

