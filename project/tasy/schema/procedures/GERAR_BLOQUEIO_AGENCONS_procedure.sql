-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_bloqueio_agencons (cd_agenda_p bigint, dt_inicial_p timestamp, dt_final_p timestamp, nm_usuario_p text, nr_seq_turno_p text, cd_estabelecimento_p bigint) AS $body$
DECLARE

 
nr_seq_w	         bigint;
hr_inicial_w	agenda_turno.hr_inicial%type;
hr_final_w	agenda_turno.hr_final%type;
ie_dia_semana_w  agenda_turno.ie_dia_semana%type;
observacao_w	varchar(255);


BEGIN 
 
select 	hr_inicial, 
	hr_final, 
	ie_dia_semana 
into STRICT	hr_inicial_w, 
	hr_final_w, 
	ie_dia_semana_w 
from 	agenda_turno 
where 	cd_agenda = cd_agenda_p 
and 	nr_sequencia = nr_seq_turno_p;
 
observacao_w := WHEB_MENSAGEM_PCK.get_texto(403437,'TURNO='||nr_seq_turno_p);
 
select 	nextval('agenda_bloqueio_seq') 
into STRICT	nr_seq_w
;
 
insert into agenda_bloqueio(	cd_agenda, 
				dt_inicial, 
				dt_final, 
				ie_motivo_bloqueio, 
				dt_atualizacao, 
				nm_usuario, 
				nr_sequencia, 
				ds_observacao, 
				hr_inicio_bloqueio, 
				hr_final_bloqueio, 
				ie_dia_semana) 
			values ( cd_agenda_p, 
				dt_inicial_p, 
				dt_final_p, 
				'O', 
				clock_timestamp(), 
				nm_usuario_p, 
				nr_seq_w, 
				observacao_w, 
				hr_inicial_w, 
				hr_final_w, 
				ie_dia_semana_w);
				 
commit;
 
 CALL regerar_horario_agecons(cd_agenda_p, nm_usuario_p, cd_estabelecimento_p, nr_seq_w);
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_bloqueio_agencons (cd_agenda_p bigint, dt_inicial_p timestamp, dt_final_p timestamp, nm_usuario_p text, nr_seq_turno_p text, cd_estabelecimento_p bigint) FROM PUBLIC;

