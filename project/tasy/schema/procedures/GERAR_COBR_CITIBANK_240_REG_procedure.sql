-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_cobr_citibank_240_reg ( nr_seq_cobr_escrit_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
/*=========================================================== 
	       =>>>>>	A T E N Ç Ã O    <<<<<<= 
 
Esta procedure é uma cópia da GERAR_COBR_CITIBANK_240 
com alteração apenas na carteira para contemplar o projeto 
de cobranças registradas, OS 1195103. 
 
Como se trata de um projeto e não possuímos cliente para validar junto 
ao banco, os defeitos devem ser verificados com Peterson antes 
de serem documentados. 
============================================================*/
		 
					 
ds_conteudo_w		varchar(243);
qt_lote_arquivo_w	varchar(6)	:= 0;
nr_seq_registro_w	bigint	:= 0;
nr_lote_w_w		bigint	:= 0;
qt_titulos_lote_w	bigint	:= 0;
cd_pf_pj_w		varchar(15);
nm_empresa_w 		varchar(30);
nm_banco_w		varchar(30);
dt_geracao_w		varchar(8);
hr_geracao_w		varchar(6);
nr_lote_w		bigint;
tipo_empresa_w		varchar(1);
nr_inscricao_w		varchar(15);
nm_pf_pj_w		varchar(40);
ds_endereco_sacado_w	varchar(40);
ds_bairro_sacado_w	varchar(15);
cd_cep_sacado_w		varchar(5);
cd_suf_cep_sacado_w	varchar(3);
ds_municipio_sacado_w	varchar(15);
ds_unidade_federacao_w	varchar(2);
ds_email_sacado_w	varchar(40);
tipo_empresa_lote_w	varchar(1);
cd_pf_pj_lote_w		varchar(15);
nm_empresa_lote_w	varchar(30);
dt_geracao_lote_w	varchar(8);
nr_seq_arquivo_lote_w	varchar(10);
tipo_inscricao_w	varchar(1);
nr_titulo_w		varchar(10);
dt_vencimento_w		varchar(8);
dt_emissao_w		varchar(8);
nr_seq_arquivo_w	cobranca_escritural.nr_remessa%type;
nr_nosso_numero_w	titulo_receber.nr_nosso_numero%type;
vl_nominal_titulo_w	titulo_receber.vl_titulo%type;
vl_abatimento_w		titulo_receber.vl_abatimento%type;
cd_convenio_banco_w	banco_estabelecimento.cd_convenio_banco%type;	
ie_emissao_bloqueto_w	cobranca_escritural.ie_emissao_bloqueto%type;		
 
C01 CURSOR FOR  -- segmento P,Q,R 
	SELECT 	substr(a.nr_nosso_numero,1,20) nr_nosso_numero, 
		substr(b.nr_titulo,1,10) nr_titulo, 
		substr(to_char(a.dt_vencimento,'ddmmyyyy'),1,8) dt_vencimento, 
		substr(somente_numero(to_char(a.vl_saldo_titulo,'99999999990.00')),1,13) vl_titulo, 
		substr(to_char(a.dt_pagamento_previsto,'ddmmyyyy'),1,8) dt_vencimento, 
		substr(somente_numero(to_char(a.vl_abatimento,'99999999990.00')),1,13) vl_abatimento, 
		substr(CASE WHEN coalesce(a.cd_cgc::text, '') = '' THEN '1'  ELSE '2' END ,1,1) tipo_inscricao, 
		elimina_caractere_especial(substr(CASE WHEN coalesce(a.cd_cgc::text, '') = '' THEN (	SELECT 	f.nr_cpf 																	from	pessoa_fisica f 																	where 	a.cd_pessoa_fisica = f.cd_pessoa_fisica)  ELSE a.cd_cgc END ,1,15)) nr_inscricao, 
		elimina_acentos(elimina_caractere_especial(substr(CASE WHEN coalesce(a.cd_cgc::text, '') = '' THEN obter_nome_pf_pj(a.cd_pessoa_fisica,null)  ELSE obter_nome_pf_pj(null,a.cd_cgc) END ,1,40)),'S') nm_pf_pj, 
		elimina_acentos(elimina_caractere_especial(substr(obter_dados_pf_pj(a.cd_pessoa_fisica,a.cd_cgc,'R'),1,40)),'S') ds_endereco_sacado, 
		elimina_acentos(elimina_caractere_especial(substr(obter_dados_pf_pj(a.cd_pessoa_fisica,a.cd_cgc,'B'),1,15)),'S') ds_bairro_sacado, 
		substr(obter_dados_pf_pj(a.cd_pessoa_fisica,a.cd_cgc,'CEP'),1,5) cd_cep_sacado, 
		substr(obter_dados_pf_pj(a.cd_pessoa_fisica,a.cd_cgc,'CEP'),6,8) cd_suf_cep_sacado, 
		elimina_acentos(elimina_caractere_especial(substr(obter_dados_pf_pj(a.cd_pessoa_fisica,a.cd_cgc,'CI'),1,15)),'S') ds_municipio_sacado, 
		substr(obter_dados_pf_pj(a.cd_pessoa_fisica,a.cd_cgc,'UF'),1,2) ds_unidade_federacao, 
		substr(CASE WHEN coalesce(a.cd_cgc::text, '') = '' THEN obter_email_pf(a.cd_pessoa_fisica)  ELSE (	select	d.ds_email 											from	pessoa_juridica d 											where	a.cd_cgc = d.cd_cgc) END ,1,40) ds_email_sacado 
	from 	titulo_receber a, 
		titulo_receber_cobr b, 
		cobranca_escritural c 
	where 	a.nr_titulo		= b.nr_titulo 
	and	b.nr_seq_cobranca 	= c.nr_sequencia 
	and 	b.nr_seq_cobranca 	= nr_seq_cobr_escrit_p;


BEGIN 
 
delete	from w_envio_banco 
where	nm_usuario	= nm_usuario_p;
 
/* Header Arquivo*/
 
 
select	max(substr(CASE WHEN coalesce(b.cd_cgc::text, '') = '' THEN '1'  ELSE '2' END ,1,1)) tipo_empresa, 
		max(substr(elimina_caractere_especial((	select max(x.cd_cgc) 
											from 	estabelecimento x 
											where 	x.cd_estabelecimento = b.cd_estabelecimento)),1,15)), 
		max(substr(elimina_acentuacao(CASE WHEN coalesce(b.cd_cgc::text, '') = '' THEN  obter_nome_pf(	select	x.cd_pessoa_fisica 																			from	titulo_receber x, 																					titulo_receber_cobr y 																			where	x.nr_titulo = x.nr_titulo 																			and		y.nr_seq_cobranca = a.nr_sequencia)  ELSE obter_nome_pf_pj(null,b.cd_cgc) END ),1,30)) nm_empresa, 
		max(substr(obter_nome_banco(c.cd_banco),1,30)) nm_banco, 
		max(to_char(clock_timestamp(),'ddmmyyyy')) dt_geracao, 
		max(to_char(clock_timestamp(),'hh24miss')) hr_geracao, 
		max(lpad(substr(coalesce(a.nr_remessa,a.nr_sequencia),1,6),6,'0')) nr_seq_arquivo, 
		max(c.cd_convenio_banco) 
into STRICT	tipo_empresa_w, 
		cd_pf_pj_w, 
		nm_empresa_w,	 
		nm_banco_w, 
		dt_geracao_w, 
		hr_geracao_w, 
		nr_seq_arquivo_w, 
		cd_convenio_banco_w 
FROM agencia_bancaria e, banco_estabelecimento c, estabelecimento b, cobranca_escritural a
LEFT OUTER JOIN banco_carteira d ON (a.nr_seq_carteira_cobr = d.nr_sequencia)
WHERE a.cd_estabelecimento	= b.cd_estabelecimento and a.nr_seq_conta_banco	= c.nr_sequencia  and c.cd_agencia_bancaria	= e.cd_agencia_bancaria and a.nr_sequencia			= nr_seq_cobr_escrit_p;
 
ds_conteudo_w	:=	'745' 										|| /*Pos 01 a 03*/
 
					'0000' 										|| /*Pos 04 a 07*/
 
					'0' 										|| /*Pos 08*/
 
					rpad(' ',9,' ') 							|| /*Pos 09 a 17*/
 
					rpad(coalesce(tipo_empresa_w,' '),1,' ') 		|| /*Pos 18*/
 
					lpad(coalesce(cd_pf_pj_w,'0'),14,'0') 			|| /*Pos 19 a 32*/
 
					rpad(coalesce(cd_convenio_banco_w,' '),20,' ')  || /*Pos 33 a 52*/
 
					rpad('0',20,'0') 							|| /*Pos 53 a 72 - Agencia, digito agenca, conta e digito conta, segundo o layout deve ir fixo 0, conforme observacao g008, g009, g010 e g011*/
 
					rpad(coalesce(nm_empresa_w,' '),30,' ') 			|| /*Pos 73 a 102*/
 
					rpad(coalesce(nm_banco_w,' '),30,' ') 			|| /*Pos 103 a 132*/
 
					rpad(' ',10,' ') 							|| /*Pos 133 a 142*/
 
					'1' 										|| /*Pos 143*/
 
					lpad(coalesce(dt_geracao_w,'0'),8,'0') 			|| /*Pos 144 a 151*/
 
					lpad(coalesce(hr_geracao_w,'0'),6,'0') 			|| /*Pos 152 a 157*/
 
					lpad(coalesce(nr_seq_arquivo_w,'0'),6,'0') 		|| /*Pos 158 a 163*/
 
					'083' 										|| /*Pos 164 a 166*/
 
					'16000' 									|| /*Pos 167 a 171*/
 
					rpad(' ',20,' ') 							|| /*Pos 172 a 191*/
 
					rpad(' ',20,' ') 							|| /*Pos 192 a 211*/
 
					rpad(' ',29,' ');						    /*Pos 212 a 240*/
					 
 
insert	into w_envio_banco(nr_sequencia, 
	dt_atualizacao, 
	nm_usuario, 
	dt_atualizacao_nrec, 
	nm_usuario_nrec, 
	cd_estabelecimento, 
	ds_conteudo, 
	nr_seq_apres, 
	nr_seq_apres_2) 
values (nextval('w_envio_banco_seq'), 
	clock_timestamp(), 
	nm_usuario_p, 
	clock_timestamp(), 
	nm_usuario_p, 
	cd_estabelecimento_p, 
	ds_conteudo_w, 
	1, 
	1);
 
/*Fim header arquivo*/
			 
 
/*Inicio header lote*/
 
 
select	max(substr(CASE WHEN coalesce(b.cd_cgc::text, '') = '' THEN '1'  ELSE '2' END ,1,1)) tipo_empresa, 
		max(substr(elimina_caractere_especial((	select max(x.cd_cgc) 
											from 	estabelecimento x 
											where 	x.cd_estabelecimento = b.cd_estabelecimento)),1,15)), 
		max(substr(elimina_acentuacao(CASE WHEN coalesce(b.cd_cgc::text, '') = '' THEN  obter_nome_pf(	select	x.cd_pessoa_fisica 																			from	titulo_receber x, 																					titulo_receber_cobr y 																			where	x.nr_titulo = x.nr_titulo 																			and		y.nr_seq_cobranca = a.nr_sequencia)  ELSE obter_nome_pf_pj(null,b.cd_cgc) END ),1,30)) nm_empresa, 
		max(to_char(clock_timestamp(),'ddmmyyyy')) dt_geracao, 
		max(substr(coalesce(a.nr_remessa,a.nr_sequencia),1,6)) nr_seq_arquivo, 
		max(a.ie_emissao_bloqueto) 
into STRICT	tipo_empresa_lote_w, 
		cd_pf_pj_lote_w, 
		nm_empresa_lote_w,	 
		dt_geracao_lote_w, 
		nr_seq_arquivo_lote_w, 
		ie_emissao_bloqueto_w 
FROM agencia_bancaria e, banco_estabelecimento c, estabelecimento b, cobranca_escritural a
LEFT OUTER JOIN banco_carteira d ON (a.nr_seq_carteira_cobr = d.nr_sequencia)
WHERE a.cd_estabelecimento	= b.cd_estabelecimento and a.nr_seq_conta_banco	= c.nr_sequencia  and c.cd_agencia_bancaria	= e.cd_agencia_bancaria and a.nr_sequencia		= nr_seq_cobr_escrit_p;
 
ds_conteudo_w 	:=	'745' 											|| /*Pos 01 a 03*/
 
					lpad(coalesce(nr_lote_w,'0'),4,'0') 					|| /*Pos 04 a 07*/
 
					'1' 											|| /*Pos 08*/
 
					'R' 											|| /*Pos 09*/
 
					'01' 											|| /*Pos 10 a 11*/
 
					rpad(' ',2,' ') 								|| /*Pos 12 a 13*/
 
					'041' 											|| /*Pos 14 a 16*/
 
					' ' 											|| /*Pos 17*/
 
					lpad(coalesce(tipo_empresa_lote_w,' '),1,' ') 		|| /*Pos 18*/
 
					lpad(coalesce(cd_pf_pj_lote_w,'0'),15,'0') 			|| /*Pos 19 a 33*/
 
					rpad(coalesce(cd_convenio_banco_w,' '),20,' ') 		|| /*Pos 34 a 53*/
 
					'00000' 										|| /*Pos 54 a 58*/
 
					' ' 											|| /*Pos 59*/
 
					lpad('0',12,'0') 								|| /*Pos 60 a 71*/
 
					' ' 											|| /*Pos 72*/
 
					' ' 											|| /*Pos 73*/
 
					rpad(coalesce(nm_empresa_lote_w,' '),30,' ') 		|| /*Pos 74 a 103*/
 
					rpad(' ',40,' ') 								|| /*Pos 104 a 143*/
 
					rpad(' ',40,' ') 								|| /*Pos 144 a 183*/
 
					lpad(coalesce(nr_seq_arquivo_lote_w,'0'),8,'0') 		|| /*Pos 184 a 191*/
 
					lpad(coalesce(dt_geracao_lote_w,'0'),8,'0') 			|| /*Pos 192 a 199*/
 
					lpad('0',8,'0') 								|| /*Pos 200 a 207*/
 
					rpad(' ',33,' ');								  /*Pos 208 a 240*/
			 
insert	into w_envio_banco(nr_sequencia, 
	dt_atualizacao, 
	nm_usuario, 
	dt_atualizacao_nrec, 
	nm_usuario_nrec, 
	cd_estabelecimento, 
	ds_conteudo, 
	nr_seq_apres, 
	nr_seq_apres_2) 
values (nextval('w_envio_banco_seq'), 
	clock_timestamp(), 
	nm_usuario_p, 
	clock_timestamp(), 
	nm_usuario_p, 
	cd_estabelecimento_p, 
	ds_conteudo_w, 
	2, 
	2);
 
qt_lote_arquivo_w	:= qt_lote_arquivo_w + 1;
/*Fim do header lote*/
 
 
/* Inicio dos Segmentos P,Q,R */
 
 
open	C01;
loop 
fetch	C01 into 
	nr_nosso_numero_w, 
	nr_titulo_w, 
	dt_vencimento_w, 
	vl_nominal_titulo_w, 
	dt_emissao_w, 
	vl_abatimento_w, 
	tipo_inscricao_w, 
	nr_inscricao_w, 
	nm_pf_pj_w, 
	ds_endereco_sacado_w, 
	ds_bairro_sacado_w, 
	cd_cep_sacado_w, 
	cd_suf_cep_sacado_w, 
	ds_municipio_sacado_w, 
	ds_unidade_federacao_w, 
	ds_email_sacado_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin 
	 
	nr_seq_registro_w	:= nr_seq_registro_w + 1;
	qt_titulos_lote_w	:= qt_titulos_lote_w + 1;
	 
	/*Inicio Segmento P*/
 
	nr_lote_w_w		:= coalesce(nr_lote_w_w,0) + 1;
	nr_lote_w		:= lpad(nr_lote_w_w,4,'0');
	ds_conteudo_w		:= null;
	 
	ds_conteudo_w 	:=	'745' 											|| /*Pos 01 a 03*/
 
						lpad(coalesce(nr_lote_w,'0'),4,'0') 					|| /*Pos 04 a 07*/
 
						'3' 											|| /*Pos 08*/
 
						lpad(coalesce(nr_seq_registro_w,'0'),5,'0') 			|| /*Pos 09 a 13*/
 
						'P' 											|| /*Pos 14*/
 
						' ' 											|| /*Pos 15*/
 
						'01' 											|| /*Pos 16 a 17*/
 
						lpad('0',5,'0') 								|| /*Pos 18 a 22*/
 
						' ' 											|| /*Pos 23 */
 
						lpad('0',12,'0') 								|| /*Pos 24 a 35*/
 
						' ' 											|| /*Pos 36*/
 
						' ' 											|| /*Pos 37*/
 
						lpad(coalesce(nr_nosso_numero_w,'0'),20,'0') 		|| /*Pos 38 a 57*/
 
						'1' 											|| /*Pos 58*/
 
						'1' 											|| /*Pos 59*/
 --Com Cadastramento (Cobrança Registrada) 
						' ' 											|| /*Pos 60*/
 
						coalesce(ie_emissao_bloqueto_w,'0')					|| /*Pos 61*/
 
						'1' 											|| /*Pos 62*/
 
						lpad(coalesce(nr_titulo_w,' '),10,' ') 				|| /*Pos 63 a 72*/
 
						rpad(' ',5,' ') 								|| /*Pos 73 a 77*/
 
						lpad(coalesce(dt_vencimento_w,'0'),8,'0') 			|| /*Pos 78 a 85*/
 
						lpad('0',2,'0') 								|| /*Pos 86 a 87*/
 
						lpad(coalesce(vl_nominal_titulo_w,'0'),13,'0') 		|| /*Pos 88 a 100*/
 
						lpad('0',5,'0') 								|| /*Pos 101 a 105*/
 
						lpad('0',1,'0') 								|| /*Pos 106*/
 
						'03' 											|| /*Pos 107 a 108*/
 
						'A' 											|| /*Pos 109*/
 
						lpad(coalesce(dt_emissao_w,'0'),8,'0') 				|| /*Pos 110 a 117*/
 
						'1' 											|| /*Pos 118*/
 
						lpad('0',8,'0') 								|| /*Pos 119 a 126*/
 
						lpad('0',2,'0') 								|| /*Pos 127 a 128*/
 
						lpad('0',13,'0') 								|| /*Pos 129 a 141*/
 
						'1' 											|| /*Pos 142*/
 
						lpad('0',8,'0') 								|| /*Pos 143 a 150*/
 
						lpad('0',2,'0') 								|| /*Pos 151 a 152*/
 
						lpad('0',13,'0') 								|| /*Pos 153 a 165*/
 
						lpad('0',2,'0') 								|| /*Pos 166 a 167*/
 
						lpad('0',13,'0') 								|| /*Pos 168 a 180*/
 
						lpad('0',2,'0') 								|| /*Pos 181 a 18*/
 
						lpad(coalesce(vl_abatimento_w,'0'),13,'0')			|| /*Pos 183 a 195*/
 
						lpad(coalesce(nr_titulo_w,' '),25,' ') 				|| /*Pos 196 a 220*/
 
						'3' 											|| /*Pos 221*/
 
						'00' 											|| /*Pos 222 a 223*/
 
						'1' 											|| /*Pos 224*/
 
						rpad(' ',3,' ') 								|| /*Pos 225 a 227*/
 
						'09' 											|| /*Pos 228 a 229*/
 
						lpad('0',10,'0') 								|| /*Pos 230 a 239*/
 
						rpad(' ',1,' ');                  /*Pos 240*/
	 
	insert	into w_envio_banco(nr_sequencia, 
		dt_atualizacao, 
		nm_usuario, 
		dt_atualizacao_nrec, 
		nm_usuario_nrec, 
		cd_estabelecimento, 
		ds_conteudo, 
		nr_seq_apres, 
		nr_seq_apres_2) 
	values (nextval('w_envio_banco_seq'), 
		clock_timestamp(), 
		nm_usuario_p, 
		clock_timestamp(), 
		nm_usuario_p, 
		cd_estabelecimento_p, 
		ds_conteudo_w, 
		3, 
		nr_seq_registro_w);
	 
	/*Q*/
 
	nr_lote_w_w		:= coalesce(nr_lote_w_w,0) + 1;
	nr_lote_w		:= lpad(nr_lote_w_w,4,'0');
	ds_conteudo_w		:= null;
	nr_seq_registro_w	:= nr_seq_registro_w + 1;
	 
	ds_conteudo_w	:=	'745' 												|| /*Pos 01 a 03*/
 
						lpad(coalesce(nr_lote_w,'0'),4,'0')						|| /*Pos 04 a 07*/
 
						'3' 												|| /*Pos 08*/
 
						lpad(coalesce(nr_seq_registro_w,'0'),5,'0') 				|| /*Pos 09 a 13*/
 
						'Q' 												|| /*Pos 14*/
 
						' ' 												|| /*Pos 15*/
 
						'01' 												|| /*Pos 16 a 17*/
 
						rpad(coalesce(tipo_inscricao_w,' '),1,' ') 				|| /*Pos 18 */
 
						lpad(coalesce(nr_inscricao_w,'0'),15,'0') 				|| /*Pos 19 a 33*/
 
						rpad(coalesce(nm_pf_pj_w,' '),40,' ') 					|| /*Pos 34 a 73*/
 
						rpad(coalesce(ds_endereco_sacado_w,' '),40,' ') 			|| /*Pos 74 a 113*/
 
						rpad(coalesce(ds_bairro_sacado_w,' '),15,' ') 			|| /*Pos 114 a 128*/
 
						lpad(coalesce(cd_cep_sacado_w,'0'),5,'0') 				|| /*Pos 129 a 133*/
 
						lpad(coalesce(cd_suf_cep_sacado_w,'0'),3,'0') 			|| /*Pos 134 a 136*/
 
						rpad(coalesce(ds_municipio_sacado_w,' '),15,' ') 		|| /*Pos 137 a 151*/
 
						rpad(coalesce(ds_unidade_federacao_w,' '),2,' ') 		|| /*Pos 152 a 153*/
 
						'0' 												|| /*Pos 154*/
 
						lpad('0',15,'0') 									|| /*Pos 155 a 169*/
 
						rpad(coalesce(nm_pf_pj_w,' '),40,' ') 					|| /*Pos 170 a 209*/
 
						lpad('0',3,'0') 									|| /*Pos 210 a 212*/
 
						lpad('0',3,'0') 									|| /*Pos 213 a 215*/
 
						lpad('0',3,'0') 									|| /*Pos 216 a 218*/
 
						rpad(' ',16,' ') 									|| /*Pos 219 a 232*/
 
						lpad('0',8,'0');									  /*Pos 233 a 240*/
				 
	insert	into w_envio_banco(nr_sequencia, 
		dt_atualizacao, 
		nm_usuario, 
		dt_atualizacao_nrec, 
		nm_usuario_nrec, 
		cd_estabelecimento, 
		ds_conteudo, 
		nr_seq_apres, 
		nr_seq_apres_2) 
	values (nextval('w_envio_banco_seq'), 
		clock_timestamp(), 
		nm_usuario_p, 
		clock_timestamp(), 
		nm_usuario_p, 
		cd_estabelecimento_p, 
		ds_conteudo_w, 
		3, 
		nr_seq_registro_w);
	 
	/*R*/
 
	nr_lote_w_w		:= coalesce(nr_lote_w_w,0) + 1;
	nr_lote_w		:= lpad(nr_lote_w_w,4,'0');
	ds_conteudo_w		:= null;
	nr_seq_registro_w	:= nr_seq_registro_w + 1;
	 
	ds_conteudo_w	:=	'745' 									|| /*Pos 01 a 03*/
 
						lpad(coalesce(nr_lote_w,'0'),4,'0') 			|| /*Pos 04 a 07*/
 
						'3' 									|| /*Pos 08*/
 
						lpad(coalesce(nr_seq_registro_w,'0'),5,'0') 	|| /*Pos 09 a 13*/
 
						'R' 									|| /*Pos 14*/
 
						' ' 									|| /*Pos 15*/
 
						'01' 									|| /*Pos 16 a 17*/
 
						'1'										|| /*Pos 18*/
 
						lpad('0',8,'0') 						|| /*Pos 19 a 26*/
 
						lpad('0',2,'0') 						|| /*Pos 27 a 28*/
 
						lpad('0',13,'0') 						|| /*Pos 29 a 41*/
 
						'1' 									|| /*Pos 42 */
 
						lpad('0',8,'0') 						|| /*Pos 43 a 50*/
 
						lpad('0',2,'0') 						|| /*Pos 51 a 52*/
 
						lpad('0',13,'0') 						|| /*Pos 53 a 65*/
 
						' ' 									|| /*Pos 66*/
 
						lpad('0',8,'0') 						|| /*Pos 67 a 74*/
 
						lpad('0',2,'0') 						|| /*Pos 75 a 76*/
 
						lpad('0',13,'0') 						|| /*Pos 77 a 89*/
 
						rpad(' ',10,' ') 						|| /*Pos 90 a 99*/
 
						rpad(' ',40,' ') 						|| /*Pos 100 a 139*/
 
						rpad(coalesce(ds_email_sacado_w,' '),40,' ') || /*Pos 140 a 179*/
 
						rpad(' ',20,' ') 						|| /*Pos 180 a 199*/
 
						lpad('0',8,'0') 						|| /*Pos 200 a 207*/
 
						lpad('0',3,'0') 						|| /*Pos 208 a 210*/
 
						lpad('0',5,'0') 						|| /*Pos 211 a 215*/
 
						'0' 									|| /*Pos 216*/
 
						lpad('0',12,'0') 						|| /*Pos 217 a 228*/
 
						'0' 									|| /*Pos 229*/
 
						'0' 									|| /*Pos 230*/
 
						'0' 									|| /*Pos 231*/
 
						rpad(' ',9,' ');              /*Pos 232 a 240*/
		 
	insert	into w_envio_banco(nr_sequencia, 
		dt_atualizacao, 
		nm_usuario, 
		dt_atualizacao_nrec, 
		nm_usuario_nrec, 
		cd_estabelecimento, 
		ds_conteudo, 
		nr_seq_apres, 
		nr_seq_apres_2) 
	values (nextval('w_envio_banco_seq'), 
		clock_timestamp(), 
		nm_usuario_p, 
		clock_timestamp(), 
		nm_usuario_p, 
		cd_estabelecimento_p, 
		ds_conteudo_w, 
		3, 
		nr_seq_registro_w);
	 
	end;
end	loop;
close	C01;		
/* Fim dos Segmentos P,Q,R*/
 
 
/*Inicio do trailer lote*/
 
 
ds_conteudo_w 	:=	'745' 										|| /*Pos 01 a 03*/
 
					'9999' 										|| /*Pos 04 a 07*/
 
					'5' 										|| /*Pos 08*/
 
					rpad(' ',9,' ') 							|| /*Pos 09 a 17 */
 
					lpad(coalesce(qt_titulos_lote_w,'0'), 6, '0') 	|| /*Pos 18 a 23*/
 
					lpad(coalesce(qt_titulos_lote_w,'0'), 6, '0') 	|| /*Pos 24 a 29*/
 
					rpad('0',17,'0') 							|| /*Pos 30 a 46*/
 
					rpad('0',6,'0') 							|| /*Pos 47 a 52*/
 
					rpad('0',17,'0') 							|| /*Pos 53 a 69*/
 
					rpad('0',6,'0') 							|| /*Pos 70 a 75*/
 
					rpad('0',17,'0') 							|| /*Pos 76 a 92*/
 
					rpad('0',6,'0') 							|| /*Pos 93 a 98*/
 
					rpad('0',17,'0') 							|| /*Pos 99a a 115*/
 
					rpad('0',8,'0') 							|| /*Pos 116 a 123*/
 
					rpad('0',117,'0');							  /*Pos 124 a 240*/
			 
insert	into w_envio_banco(nr_sequencia, 
	dt_atualizacao, 
	nm_usuario, 
	dt_atualizacao_nrec, 
	nm_usuario_nrec, 
	cd_estabelecimento, 
	ds_conteudo, 
	nr_seq_apres, 
	nr_seq_apres_2) 
values (nextval('w_envio_banco_seq'), 
	clock_timestamp(), 
	nm_usuario_p, 
	clock_timestamp(), 
	nm_usuario_p, 
	cd_estabelecimento_p, 
	ds_conteudo_w, 
	5, 
	5);
 
/*Fim do trailer lote*/
 
 
/*Inicio do trailer arquivo*/
 
 
ds_conteudo_w	:=	'745' 										|| /*Pos 01 a 03*/
 
					'9999' 										|| /*Pos 04 a 07*/
 
					'9' 										|| /*Pos 08*/
 
					rpad(' ',9,' ') 							|| /*Pos 09 a 17*/
 
					lpad(coalesce(qt_titulos_lote_w,'0'), 6, '0') 	|| /*Pos 18 a 23*/
 
					lpad(coalesce(qt_titulos_lote_w,'0'), 6, '0') 	|| /*Pos 24 a 29*/
 
					lpad('0', 6, '0') 							|| /*Pos 30 a 35*/
 
					rpad(' ', 205, ' ');					    /*Pos 36 a 240*/
 
insert	into w_envio_banco(nr_sequencia, 
	dt_atualizacao, 
	nm_usuario, 
	dt_atualizacao_nrec, 
	nm_usuario_nrec, 
	cd_estabelecimento, 
	ds_conteudo, 
	nr_seq_apres, 
	nr_seq_apres_2) 
values (nextval('w_envio_banco_seq'), 
	clock_timestamp(), 
	nm_usuario_p, 
	clock_timestamp(), 
	nm_usuario_p, 
	cd_estabelecimento_p, 
	ds_conteudo_w, 
	4, 
	4);
 
/*Fim do trailer arquivo*/
 
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_cobr_citibank_240_reg ( nr_seq_cobr_escrit_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

