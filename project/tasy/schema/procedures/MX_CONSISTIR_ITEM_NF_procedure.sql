-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE mx_consistir_item_nf ( nr_sequencia_p bigint, ds_msg_p INOUT text) AS $body$
DECLARE

cd_material_interno_w			nf_imp_nota_item.cd_material_interno%type;
qt_item_w						nf_imp_nota_item.qt_item%type;
vl_unitario_w					nf_imp_nota_item.vl_unitario%type;
vl_item_w						nf_imp_nota_item.vl_item%type;
consist_material_w				varchar(2000);
consist_qt_item_w				varchar(2000);
consist_unitario_w				varchar(2000);
consist_vl_item_w				varchar(2000);


c01 CURSOR FOR

	SELECT	nfi.cd_material_interno,
			nfi.qt_item,
			nfi.vl_unitario,
			nfi.vl_item
	from 	nf_imp_nota_item nfi,
			nf_imp_nota nf
	where	nf.nr_sequencia = nfi.nr_seq_nf_imp_nota
	and		nf.nr_sequencia = nr_sequencia_p;


BEGIN

	open c01;
	loop
	fetch c01 into
		cd_material_interno_w,
		qt_item_w,
		vl_unitario_w,
		vl_item_w;

	EXIT WHEN NOT FOUND; /* apply on c01 */

	if ( coalesce(cd_material_interno_w::text, '') = '') then
		if (	coalesce(consist_material_w::text, '') = '') then
			consist_material_w  := obter_desc_expressao(872822);/*O código do material correspondente deve ser informado.*/
			ds_msg_p := consist_material_w || ';' || ds_msg_p;
		end if;
	end if;
	if ( coalesce(qt_item_w::text, '') = '') then
		if ( coalesce(consist_qt_item_w::text, '') = '' ) then
			consist_qt_item_w := obter_desc_expressao(872824);/*A quantidade dos itens da nota fiscal deve ser informada.*/
			ds_msg_p := consist_qt_item_w || ';' || ds_msg_p;
		end if;
	end if;
	if ( coalesce(vl_unitario_w::text, '') = '') then
		if ( coalesce(consist_unitario_w::text, '') = '' ) then
			consist_unitario_w := obter_desc_expressao(872826);/*O valor unitário dos itens da nota fiscal deve ser informado.*/
			ds_msg_p := consist_unitario_w || ';' || ds_msg_p;
		end if;
	end if;
	if ( coalesce(vl_item_w::text, '') = '') then
		if ( coalesce(consist_vl_item_w::text, '') = '' ) then
			consist_vl_item_w := obter_desc_expressao(872828);/*O valor total dos itens da nota fiscal deve ser informado.*/
			ds_msg_p := consist_vl_item_w || ';' || ds_msg_p;
		end if;
	end if;

	end loop;


close c01;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE mx_consistir_item_nf ( nr_sequencia_p bigint, ds_msg_p INOUT text) FROM PUBLIC;

