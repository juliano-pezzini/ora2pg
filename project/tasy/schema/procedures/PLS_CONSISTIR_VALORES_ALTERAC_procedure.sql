-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_consistir_valores_alterac ( nr_seq_conta_proc_p w_pls_itens_glosa_analise.nr_seq_conta_proc%type, nr_seq_conta_mat_p w_pls_itens_glosa_analise.nr_seq_conta_mat%type, qt_liberado_p w_pls_itens_glosa_analise.qt_liberado%type, qt_apresentada_p w_pls_itens_glosa_analise.qt_apresentada%type, vl_liberado_hi_p w_pls_itens_glosa_analise.vl_liberado_hi%type, vl_liberado_material_p w_pls_itens_glosa_analise.vl_liberado_material%type, vl_liberado_co_p w_pls_itens_glosa_analise.vl_liberado_co%type, vl_apres_hi_p w_pls_itens_glosa_analise.vl_apres_hi%type, vl_apres_co_p w_pls_itens_glosa_analise.vl_apres_co%type, vl_apres_mat_p w_pls_itens_glosa_analise.vl_apres_material%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, ie_validar_lib_apres_p text) AS $body$
BEGIN

	if ( qt_liberado_p < 0) then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(1049212);
	end if;

	if (qt_liberado_p > qt_apresentada_p) then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(1049231);
	end if;

	if ( (vl_liberado_hi_p < 0) or (vl_liberado_material_p < 0) or (vl_liberado_co_p < 0)) then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(1049213);
	end if;

	if (nr_seq_conta_mat_p IS NOT NULL AND nr_seq_conta_mat_p::text <> '') then

		if (vl_liberado_hi_p > 0 or vl_liberado_co_p > 0) then
			CALL wheb_mensagem_pck.exibir_mensagem_abort(1049211);
		end if;

		if ( qt_liberado_p < 0) then
			CALL wheb_mensagem_pck.exibir_mensagem_abort(1049154);
		end if;

		if ( ie_validar_lib_apres_p = 'S') then

			if (vl_liberado_material_p > vl_apres_mat_p ) then
				CALL wheb_mensagem_pck.exibir_mensagem_abort(1049153);
			end if;

		end if;
	elsif (nr_seq_conta_proc_p IS NOT NULL AND nr_seq_conta_proc_p::text <> '') then

		if (qt_liberado_p < 0) then
			CALL wheb_mensagem_pck.exibir_mensagem_abort(1049154);
		end if;

		if ( ie_validar_lib_apres_p = 'S') then

			if (vl_liberado_material_p > vl_apres_mat_p ) then
				CALL wheb_mensagem_pck.exibir_mensagem_abort(1049153);
			elsif (vl_liberado_hi_p > vl_apres_hi_p ) then
				CALL wheb_mensagem_pck.exibir_mensagem_abort(1049153);
			elsif (vl_liberado_co_p > vl_apres_co_p ) then
				CALL wheb_mensagem_pck.exibir_mensagem_abort(1049153);
			end if;

		end if;

	end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_consistir_valores_alterac ( nr_seq_conta_proc_p w_pls_itens_glosa_analise.nr_seq_conta_proc%type, nr_seq_conta_mat_p w_pls_itens_glosa_analise.nr_seq_conta_mat%type, qt_liberado_p w_pls_itens_glosa_analise.qt_liberado%type, qt_apresentada_p w_pls_itens_glosa_analise.qt_apresentada%type, vl_liberado_hi_p w_pls_itens_glosa_analise.vl_liberado_hi%type, vl_liberado_material_p w_pls_itens_glosa_analise.vl_liberado_material%type, vl_liberado_co_p w_pls_itens_glosa_analise.vl_liberado_co%type, vl_apres_hi_p w_pls_itens_glosa_analise.vl_apres_hi%type, vl_apres_co_p w_pls_itens_glosa_analise.vl_apres_co%type, vl_apres_mat_p w_pls_itens_glosa_analise.vl_apres_material%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, ie_validar_lib_apres_p text) FROM PUBLIC;

