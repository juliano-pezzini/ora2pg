-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE send_demografic_data ( nr_seq_rxt_tumor_p bigint, cd_setor_atendimento_p bigint, nm_usuario_p text, ds_erro_p INOUT text, ds_retorno_p INOUT text) AS $body$
DECLARE


error_number_w		bigint;
error_message_w		varchar(100);
ds_error_w		varchar(200);
ds_param_integ_hl7_w	varchar(4000);
ds_sep_bv_w		varchar(100)	:= obter_separador_bv;

BEGIN

if (nr_seq_rxt_tumor_p IS NOT NULL AND nr_seq_rxt_tumor_p::text <> '') and (cd_setor_atendimento_p IS NOT NULL AND cd_setor_atendimento_p::text <> '') then
	begin
	ds_param_integ_hl7_w := 'nr_seq_rxt_tumor=' || nr_seq_rxt_tumor_p || ds_sep_bv_w;
	CALL gravar_agend_integracao(549, ds_param_integ_hl7_w, cd_setor_atendimento_p);

	update	rxt_tumor set
		ie_envio_int	= 'S'
	where	nr_sequencia 	= nr_seq_rxt_tumor_p;

	exception
		when others then
			error_number_w 	:= SQLSTATE;
			error_message_w	:= substr(sqlerrm, 1, 100);
			ds_error_w 	:= to_char(error_number_w) || ' | ' || error_message_w;
	end;

	if (coalesce(ds_error_w::text, '') = '') or (ds_error_w = '') then
		ds_retorno_p 	:= wheb_mensagem_pck.get_texto(390347,null);
	else
		ds_erro_p 	:= ds_error_w;
	end if;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE send_demografic_data ( nr_seq_rxt_tumor_p bigint, cd_setor_atendimento_p bigint, nm_usuario_p text, ds_erro_p INOUT text, ds_retorno_p INOUT text) FROM PUBLIC;

