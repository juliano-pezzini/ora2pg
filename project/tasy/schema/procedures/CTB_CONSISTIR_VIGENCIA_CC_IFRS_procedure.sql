-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ctb_consistir_vigencia_cc_ifrs (nr_seq_conta_ifrs_p conta_contabil_ifrs.nr_seq_conta_ifrs%type, dt_inicio_vigencia_p conta_contabil_ifrs.dt_inicio_vigencia%type, dt_fim_vigencia_p conta_contabil_ifrs.dt_fim_vigencia%type, nr_sequencia_p conta_contabil_ifrs.nr_sequencia%type default 0) AS $body$
DECLARE

                
qt_vinculo_vigente_w			smallint;


BEGIN

if (dt_fim_vigencia_p < dt_inicio_vigencia_p) then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(274385);
end if;

begin
	select	1
	into STRICT	qt_vinculo_vigente_w
	
	where exists (
		SELECT	1
		from	conta_contabil_ifrs a
		where	a.nr_seq_conta_ifrs	= nr_seq_conta_ifrs_p
		and	a.nr_sequencia		<> nr_sequencia_p
		and	coalesce(a.ie_situacao,'I')	= 'A'
		and (establishment_timezone_utils.startOfDay(a.dt_inicio_vigencia) <= establishment_timezone_utils.endOfDay(dt_fim_vigencia_p)
		and 	establishment_timezone_utils.startOfDay(dt_inicio_vigencia_p) <= establishment_timezone_utils.endOfDay(a.dt_fim_vigencia))
	);
	exception
	when no_data_found then
		qt_vinculo_vigente_w := 0;
end;

if (qt_vinculo_vigente_w = 1) then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(1214487);
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ctb_consistir_vigencia_cc_ifrs (nr_seq_conta_ifrs_p conta_contabil_ifrs.nr_seq_conta_ifrs%type, dt_inicio_vigencia_p conta_contabil_ifrs.dt_inicio_vigencia%type, dt_fim_vigencia_p conta_contabil_ifrs.dt_fim_vigencia%type, nr_sequencia_p conta_contabil_ifrs.nr_sequencia%type default 0) FROM PUBLIC;

