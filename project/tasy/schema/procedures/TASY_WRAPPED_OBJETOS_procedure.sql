-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE tasy_wrapped_objetos (nm_objeto_p text default '') AS $body$
DECLARE

		
name_w	varchar(30);
type_w	varchar(12);
v_ddl_index_nr bigint;
v_ddl_2a dbms_sql.varchar2a;
qt_loops_w	bigint;


/* http://psoug.org/oraerror/ORA-24230.htm 
Trigger nao pode ser encryptada*/
C01 CURSOR FOR
	SELECT	distinct type,
			name
	from	user_source a
	where	type <>'TRIGGER'
	and	upper(name) in (	SELECT	NM_OBJETO
					FROM 	OBJETO_SISTEMA
					WHERE 	IE_CRIPTOGRAFIA = 'S'
					AND	coalesce(nm_objeto_p::text, '') = ''
					
union all
 
					SELECT	NM_OBJETO
					FROM 	OBJETO_SISTEMA
					WHERE 	IE_CRIPTOGRAFIA = 'S'
					AND	nm_objeto_p = NM_OBJETO)
	order by name, type;


/*Sempre deve haver o create or replace no in√≠cio*/
	
 cur_objectDDL CURSOR FOR
   SELECT -1 line, 'create or replace'||chr(10) text
   
union all

   SELECT line, text
   from user_source
   where type = type_w
   and name = name_w
   order by line;
	
BEGIN

open C01;
loop
fetch C01 into	
	type_w,
	name_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin
		
		 v_ddl_index_nr := 1;
		 for rec in cur_objectDDL loop
		   v_ddl_2a(v_ddl_index_nr) := rec.text;
		   v_ddl_index_nr := v_ddl_index_nr + 1;
		 end loop;
		
		  dbms_ddl.create_wrapped(v_ddl_2a,1,v_ddl_2a.count);
		  v_ddl_2a.delete;			
		

	end;
end loop;
close C01;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tasy_wrapped_objetos (nm_objeto_p text default '') FROM PUBLIC;

