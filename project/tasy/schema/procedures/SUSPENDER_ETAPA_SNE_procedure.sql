-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE suspender_etapa_sne ( nr_seq_horario_p bigint, nm_usuario_p text, nr_seq_motivo_p bigint, ds_justificativa_p text) AS $body$
DECLARE

				 
nr_sequencia_w		bigint;
nr_sequencia_ww		bigint;
nr_prescricao_w		bigint;
dt_aprazamento_w	timestamp;


BEGIN 
 
update	prescr_mat_hor 
set	dt_suspensao 	= clock_timestamp(), 
	nm_usuario 	= nm_usuario_p, 
	nm_usuario_susp	= nm_usuario_p 
where	nr_sequencia 	= nr_seq_horario_p;
 
select	max(nr_prescricao), 
	max(nr_seq_material), 
	max(dt_horario) 
into STRICT	nr_prescricao_w,	 
	nr_sequencia_ww, 
	dt_aprazamento_w 
from	prescr_mat_hor 
where	nr_sequencia 	= nr_seq_horario_p;
 
update	prescr_material 
set	ie_horario_susp	= 'S' 
where	nr_prescricao	= nr_prescricao_w 
and	nr_sequencia	= nr_sequencia_ww;
 
select	nextval('prescr_solucao_evento_seq') 
into STRICT	nr_sequencia_w
;
 
insert into prescr_solucao_evento( 
	nr_sequencia, 
	dt_atualizacao, 
	nm_usuario, 
	dt_atualizacao_nrec, 
	nm_usuario_nrec, 
	nr_prescricao, 
	nr_seq_solucao, 
	nr_seq_material, 
	nr_seq_procedimento, 
	nr_seq_nut, 
	nr_seq_nut_neo, 
	ie_forma_infusao, 
	ie_tipo_dosagem, 
	qt_dosagem, 
	qt_vol_infundido, 
	qt_vol_desprezado, 
	cd_pessoa_fisica, 
	ie_alteracao, 
	dt_alteracao, 
	ie_evento_valido, 
	nr_seq_motivo, 
	ie_tipo_solucao, 
	ds_justificativa, 
	dt_aprazamento) 
values ( 
	nr_sequencia_w, 
	clock_timestamp(), 
	nm_usuario_p, 
	clock_timestamp(), 
	nm_usuario_p, 
	nr_prescricao_w, 
	null, 
	nr_sequencia_ww, 
	null, 
	null, 
	null, 
	null, 
	null, 
	null, 
	null, 
	null, 
	obter_dados_usuario_opcao(nm_usuario_p, 'C'), 
	12, 
	clock_timestamp(), 
	'S', 
	nr_seq_motivo_p, 
	2, 
	ds_justificativa_p, 
	dt_aprazamento_w);
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE suspender_etapa_sne ( nr_seq_horario_p bigint, nm_usuario_p text, nr_seq_motivo_p bigint, ds_justificativa_p text) FROM PUBLIC;

