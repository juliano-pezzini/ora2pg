-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_fonectica_cep () AS $body$
DECLARE


c01 CURSOR FOR
SELECT	cd_localidade
from	cep_localidade
where	coalesce(ds_fonetica::text, '') = ''
and	(cd_localidade IS NOT NULL AND cd_localidade::text <> '');

c02 CURSOR FOR
SELECT	cd_logradouro
from	cep_logradouro
where	coalesce(ds_fonetica::text, '') = ''
and	(cd_logradouro IS NOT NULL AND cd_logradouro::text <> '');

c03 CURSOR FOR
SELECT	cd_cep
from	cep_loc
where	coalesce(ds_fonetica::text, '') = ''
and	(cd_cep IS NOT NULL AND cd_cep::text <> '');

c04 CURSOR FOR
SELECT	cd_cep
from	cep_log
where	coalesce(ds_fonetica::text, '') = ''
and	(cd_cep IS NOT NULL AND cd_cep::text <> '');

cd_cep_w	varchar(15);
qt_reg_w		bigint;


BEGIN

qt_reg_w := 0;

open C01;
loop
fetch C01 into
	cd_cep_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin

	update	cep_localidade
	set	ds_fonetica = gera_fonetica(nm_localidade,'N')
	where	coalesce(ds_fonetica::text, '') = ''
	and	cd_localidade = cd_cep_w;

	qt_reg_w := qt_reg_w + 1;

	if (qt_reg_w >= 5000) then
		commit;
		qt_reg_w  := 0;
	end if;

	end;
end loop;
close C01;

commit;

qt_reg_w := 0;

open C02;
loop
fetch C02 into
	cd_cep_w;
EXIT WHEN NOT FOUND; /* apply on C02 */
	begin

	update	cep_logradouro
	set	ds_fonetica = gera_fonetica(nm_logradouro,'N')
	where	coalesce(ds_fonetica::text, '') = ''
	and	cd_logradouro = cd_cep_w;

	qt_reg_w := qt_reg_w + 1;

	if (qt_reg_w >= 5000) then
		commit;
		qt_reg_w  := 0;
	end if;

	end;
end loop;
close C02;

commit;


qt_reg_w := 0;

open C03;
loop
fetch C03 into
	cd_cep_w;
EXIT WHEN NOT FOUND; /* apply on C03 */
	begin

	update	cep_loc
	set	ds_fonetica = gera_fonetica(nm_localidade,'N')
	where	coalesce(ds_fonetica::text, '') = ''
	and	cd_cep = cd_cep_w;

	qt_reg_w := qt_reg_w + 1;

	if (qt_reg_w >= 5000) then
		commit;
		qt_reg_w  := 0;
	end if;

	end;
end loop;
close C03;

commit;

qt_reg_w := 0;

open C04;
loop
fetch C04 into
	cd_cep_w;
EXIT WHEN NOT FOUND; /* apply on C04 */
	begin

	update	cep_log
	set	ds_fonetica = gera_fonetica(nm_logradouro,'N')
	where	coalesce(ds_fonetica::text, '') = ''
	and	cd_cep = cd_cep_w;

	qt_reg_w := qt_reg_w + 1;

	if (qt_reg_w >= 5000) then
		commit;
		qt_reg_w  := 0;
	end if;

	end;
end loop;
close C04;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_fonectica_cep () FROM PUBLIC;

