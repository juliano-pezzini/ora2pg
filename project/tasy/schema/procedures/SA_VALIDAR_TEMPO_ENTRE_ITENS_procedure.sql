-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE sa_validar_tempo_entre_itens ( nr_seq_proc_adic_p bigint, nr_seq_proc_interno_p bigint, nr_seq_ageint_item_p bigint, nm_usuario_p text) AS $body$
DECLARE


qt_regra_tempo_exame_adic_w bigint;
nr_seq_proc_interno_w       ageint_tempo_entre_exames.cd_exame_pri%type;
nr_seq_proc_adic_w          ageint_tempo_entre_exames.cd_exame_seg%type;

C04 CURSOR FOR
  SELECT  nr_seq_proc_interno
  from  ageint_exame_adic_item
  where  nr_seq_item = nr_seq_ageint_item_p;

C05 CURSOR FOR
  SELECT  CASE WHEN cd_exame_pri=nr_seq_proc_interno_w THEN  cd_exame_seg  ELSE cd_exame_pri END  cd_exame
  from	ageint_tempo_entre_exames
  where	((coalesce(ie_regra_exclusiva, 'N') = 'N' and cd_exame_pri  = nr_seq_proc_adic_w)
  or (cd_exame_seg  = nr_seq_proc_adic_w))
  and		ie_situacao  = 'A';

BEGIN

	nr_seq_proc_interno_w := nr_seq_proc_interno_p;
	nr_seq_proc_adic_w := nr_seq_proc_adic_p;

	for r_c05_w in C05
	loop
		select	count(1)
		into STRICT	qt_regra_tempo_exame_adic_w
		from  	ageint_exame_adic_item
		where 	nr_seq_item = nr_seq_ageint_item_p
		and		nr_seq_proc_interno = r_c05_w.cd_exame;
		
		if (qt_regra_tempo_exame_adic_w > 0) then
			  CALL wheb_mensagem_pck.exibir_mensagem_abort(229800);
		end if;

	end loop;
	
	for r_c04_w in C04
	loop

		nr_seq_proc_interno_w := r_c04_w.nr_seq_proc_interno;
		nr_seq_proc_adic_w := r_c04_w.nr_seq_proc_interno;

		for r_c05_ww in C05
		loop
		
			select	count(1)
			into STRICT	qt_regra_tempo_exame_adic_w
			from  	ageint_exame_adic_item
			where 	nr_seq_item = nr_seq_ageint_item_p
			and		nr_seq_proc_interno = r_c05_ww.cd_exame;
			
			if (qt_regra_tempo_exame_adic_w > 0) then
				  CALL wheb_mensagem_pck.exibir_mensagem_abort(229800);
			end if;

		end loop;

	end loop;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE sa_validar_tempo_entre_itens ( nr_seq_proc_adic_p bigint, nr_seq_proc_interno_p bigint, nr_seq_ageint_item_p bigint, nm_usuario_p text) FROM PUBLIC;

