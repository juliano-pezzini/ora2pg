-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copia_perm_agenda_pf (nm_usuario_origem_p text, nm_usuario_destino_p text, nm_usuario_p text) AS $body$
DECLARE


cd_pessoa_destino_w	varchar(10);
cd_pessoa_origem_w	varchar(10);


BEGIN
/* obter dados origem */

select	coalesce(max(cd_pessoa_fisica),'0')
into STRICT	cd_pessoa_origem_w
from	usuario
where	upper(nm_usuario) = upper(nm_usuario_origem_p);

/* obter dados destino */

select	coalesce(max(cd_pessoa_fisica),'0')
into STRICT	cd_pessoa_destino_w
from	usuario
where	upper(nm_usuario) = upper(nm_usuario_destino_p);

if (cd_pessoa_destino_w <> '0') and (cd_pessoa_origem_w <> '0') then
	insert into med_permissao(
					nr_sequencia,
					cd_medico_prop,
					dt_atualizacao,
					nm_usuario,
					dt_atualizacao_nrec,
					nm_usuario_nrec,
					ie_paciente,
					ie_atendimento,
					ie_evolucao,
					ie_protocolo,
					ie_receita,
					ie_solic_exame,
					ie_agenda,
					ie_resultado,
					ie_consulta,
					ie_fechar_atend,
					ie_med_padrao,
					ie_exame_padrao,
					ie_permissao,
					ie_config_relat,
					ie_grupo_medico,
					ie_diagnostico,
					ie_texto_adicional,
					ie_referencia,
					ie_eis,
					ie_enderecos,
					ie_texto_padrao,
					ie_parametro,
					ie_config_agenda,
					cd_pessoa_fisica,
					cd_medico,
					nr_seq_grupo,
					ie_permite_excluir_agenda,
					ie_permite_bloquear_agenda,
					cd_agenda,
					cd_perfil,
					cd_setor_atendimento,
					ie_valor_normal)
			(SELECT	nextval('med_permissao_seq'),
					a.cd_medico_prop,
					clock_timestamp(),
					nm_usuario_p,
					clock_timestamp(),
					nm_usuario_p,
					a.ie_paciente,
					a.ie_atendimento,
					a.ie_evolucao,
					a.ie_protocolo,
					a.ie_receita,
					a.ie_solic_exame,
					a.ie_agenda,
					a.ie_resultado,
					a.ie_consulta,
					a.ie_fechar_atend,
					a.ie_med_padrao,
					a.ie_exame_padrao,
					a.ie_permissao,
					a.ie_config_relat,
					a.ie_grupo_medico,
					a.ie_diagnostico,
					a.ie_texto_adicional,
					a.ie_referencia,
					a.ie_eis,
					a.ie_enderecos,
					a.ie_texto_padrao,
					a.ie_parametro,
					a.ie_config_agenda,
					cd_pessoa_destino_w,
					a.cd_medico,
					a.nr_seq_grupo,
					ie_permite_excluir_agenda,
					ie_permite_bloquear_agenda,
					cd_agenda,
					a.cd_perfil,
					a.cd_setor_atendimento,
					a.ie_valor_normal
				from	med_permissao a
				where	a.cd_pessoa_fisica = cd_pessoa_origem_w
				and	not exists (select 1
							from 	med_permissao x
							where	x.cd_medico_prop 	= a.cd_medico_prop
							and	x.cd_pessoa_fisica	= cd_pessoa_destino_w));
commit;

end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copia_perm_agenda_pf (nm_usuario_origem_p text, nm_usuario_destino_p text, nm_usuario_p text) FROM PUBLIC;

