-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE tiss_gerar_xml_param (cd_estabelecimento_p bigint, cd_convenio_p bigint, ie_tipo_tiss_p text, dt_mesano_referencia_p timestamp, nr_seq_log_envio_p bigint, nr_seq_log_p INOUT bigint) AS $body$
DECLARE


nr_seq_log_w		bigint;
ds_parametros_w		varchar(2000);
ds_xml_param_w		text;


BEGIN

select	nextval('tasy_xml_banco_seq')
into STRICT	nr_seq_log_w
;

ds_parametros_w	:= 'DT_MESANO_REFERENCIA=' ||to_char(coalesce(dt_mesano_referencia_p,clock_timestamp()),'dd/mm/yyyy')||';';
ds_parametros_w	:= ds_parametros_w || 'CD_ESTABELECIMENTO=' 	|| to_char( cd_estabelecimento_p ) ||';';
ds_parametros_w	:= ds_parametros_w || 'CD_CONVENIO=' 		|| to_char( cd_convenio_p ) ||';';
ds_parametros_w	:= ds_parametros_w || 'IE_TIPO_TISS=' 		|| to_char( ie_tipo_tiss_p ) ||';';

CALL wheb_exportar_xml(100070,nr_seq_log_w,null,ds_parametros_w);

if (nr_seq_log_envio_p IS NOT NULL AND nr_seq_log_envio_p::text <> '') then
	select ds_xml
	into STRICT	ds_xml_param_w
	from 	tasy_xml_banco
	where nr_sequencia = nr_seq_log_w;

	CALL GERAR_TISS_LOG_HIST(null,nr_seq_log_envio_p,'TasyTISS',ds_xml_param_w);
end if;

nr_seq_log_p	:= nr_seq_log_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tiss_gerar_xml_param (cd_estabelecimento_p bigint, cd_convenio_p bigint, ie_tipo_tiss_p text, dt_mesano_referencia_p timestamp, nr_seq_log_envio_p bigint, nr_seq_log_p INOUT bigint) FROM PUBLIC;

