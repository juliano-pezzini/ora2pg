-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_comunic_padrao_js ( dt_comunicado_p timestamp, ds_titulo_p text, ds_comunicado_p text, nm_usuario_p text, ie_geral_p text, ie_gerencial_p text, dt_liberacao_p timestamp, nr_seq_prescr_mat_p bigint, nr_prescricao_p bigint, cd_estabelecimento_p bigint) AS $body$
DECLARE

 
nm_usuario_medico_w	varchar(255);
nm_usuario_destino_w	varchar(255);
nr_atendimento_w	bigint;
ie_usuario_medico_w	varchar(1);


BEGIN 
 
 
select	obter_usuario_pessoa(c.cd_medico), 
	obter_atendimento_prescr(c.nr_prescricao) 
into STRICT	nm_usuario_destino_w, 
	nr_atendimento_w 
from	material b, 
	prescr_medica c, 
	prescr_material a 
where	a.cd_material	= b.cd_material 
and	c.nr_prescricao	= a.nr_prescricao 
and	a.nr_sequencia	= nr_seq_prescr_mat_p 
and	a.nr_prescricao	= nr_prescricao_p;
 
 
ie_usuario_medico_w := Obter_Param_Usuario(896, 15, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, ie_usuario_medico_w);
 
if (ie_usuario_medico_w	= 'S') and (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then 
 
	select	obter_usuario_pessoa(cd_medico_resp) 
	into STRICT	nm_usuario_medico_w		 
	from	atendimento_paciente 
	where	nr_atendimento	= nr_atendimento_w;
 
nm_usuario_destino_w	:= nm_usuario_destino_w || ', ' || nm_usuario_medico_w;
 
end if;
 
CALL Gerar_Comunic_Padrao(	dt_comunicado_p, 
			ds_titulo_p, 
			ds_comunicado_p, 
			nm_usuario_p, 
			ie_geral_p, 
			nm_usuario_destino_w, 
			ie_gerencial_p, 
			'', 
			'', 
			'', 
			'', 
			dt_liberacao_p, 
			'', 
			'');
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_comunic_padrao_js ( dt_comunicado_p timestamp, ds_titulo_p text, ds_comunicado_p text, nm_usuario_p text, ie_geral_p text, ie_gerencial_p text, dt_liberacao_p timestamp, nr_seq_prescr_mat_p bigint, nr_prescricao_p bigint, cd_estabelecimento_p bigint) FROM PUBLIC;

