-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_informacao_atributo ( cd_estabelecimento_p bigint, cd_empresa_p bigint, nr_atendimento_p bigint, cd_pessoa_fisica_p text, nm_tabela_p text, nm_atributo_p text, ds_resultado_p INOUT text, ds_resultado2_p INOUT text) AS $body$
DECLARE


cd_classif_setor_w		varchar(2);
ie_atendimento_w		varchar(1);
ie_informacao_w		varchar(15);
nr_seq_exame_w		bigint;
ie_result_exame_w		varchar(15);
ie_origem_w		varchar(15);
nr_sequencia_w		bigint;
qt_resultado_w		double precision;
pr_resultado_w		double precision;
qt_result_w		double precision;
ds_result_w		varchar(4000);
pr_result_w		double precision;
qt_pa_sistolica_w		smallint;
qt_pa_diastolica_w		smallint;
qt_pam_w		smallint;
qt_minutos_resultado_w	bigint;
dt_resultado_w		timestamp;
dt_resultado_por_w		timestamp;
cd_setor_atendimento_w	bigint;
nr_seq_dest_inf_w		bigint;
dt_entrada_uti_w		timestamp;
ie_sv_liberados_w		varchar(2);
ie_regra_restringir_w	varchar(10);
nr_seq_tipo_pg_w		bigint;
nr_seq_tipo_pg_ww		varchar(4000);
ie_forma_ganho_perda_w  varchar(3);
ie_liberar_ganho_perda_w varchar(1);
dt_ordem_w				timestamp;
nr_seq_registro_w		bigint;
ds_resultado_w		varchar(10);

C01 CURSOR FOR
SELECT	c.ie_atendimento,
	c.ie_informacao,
	c.nr_seq_exame,
	c.ie_result_exame,
	b.ie_origem,
	b.nr_sequencia,
	c.ie_classif_setor,
	c.cd_setor_atendimento,
	a.nr_sequencia,
	c.qt_minutos_resultado,
	coalesce(c.ie_regra_restringir,'N'),
	c.nr_seq_tipo_pg,
	c.ie_forma_ganho_perda
from	pep_inf_regra c,
	pep_informacao b,
	pep_dest_inf a
where	a.nr_seq_inf					= b.nr_sequencia
and	b.nr_sequencia					= c.nr_seq_inf
and	a.nm_tabela					= nm_tabela_p
and	a.nm_atributo					= nm_atributo_p
and	c.cd_empresa					= cd_empresa_p
and	coalesce(c.cd_estabelecimento,cd_estabelecimento_p)	= cd_estabelecimento_p
and	((b.ie_origem <> 'EL') or (obter_se_exame_regra_info(c.nr_seq_exame, nr_atendimento_p, cd_pessoa_fisica_p, c.ie_atendimento, c.qt_minutos_resultado) > 0))
and ((coalesce(c.nr_seq_dest_inf::text, '') = '') or (a.nr_sequencia = c.nr_seq_dest_inf))
and	((coalesce(c.cd_setor_atendimento::text, '') = '') or (exists (	SELECT	1
													from	atend_paciente_unidade x
													where	x.cd_setor_atendimento	= c.cd_setor_atendimento
													and		x.nr_atendimento	= nr_atendimento_p)))
order by	coalesce(c.nr_seq_dest_inf,0), coalesce(c.cd_setor_atendimento,0);

c02 CURSOR FOR
	SELECT 	b.qt_resultado,
			b.pr_resultado,
			a.dt_resultado,
			b.ds_resultado,
			coalesce(b.dt_aprovacao,a.dt_resultado) dt_ordem
	from 	exame_lab_result_item b,
			exame_lab_resultado a,
			prescr_procedimento x,
			prescr_medica c
	where	a.nr_seq_resultado	= b.nr_seq_resultado
	and		a.nr_prescricao		= c.nr_prescricao
	and		x.nr_sequencia		= b.nr_seq_prescr
	and		x.nr_prescricao		= c.nr_prescricao
	and		ie_atendimento_w 	<> 'S'
	and		c.cd_pessoa_fisica 	= cd_pessoa_fisica_p
	and		b.nr_seq_exame		= nr_seq_exame_w
	and		x.ie_status_atend 	>= 35
	and		((coalesce(qt_minutos_resultado_w,0) = 0) or (b.dt_aprovacao > clock_timestamp() - qt_minutos_resultado_w/1440) or (a.dt_resultado > clock_timestamp() - qt_minutos_resultado_w/1440))
	--and		OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_resultado,ie_regra_restringir_w) = 'S'
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_resultado) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_classif_setor_w::text, '') = '') or (obter_classif_setor(c.cd_setor_atendimento) = cd_classif_setor_w))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (c.cd_setor_atendimento = cd_setor_atendimento_w))
	
union all

		SELECT 	b.qt_resultado,
			b.pr_resultado,
			a.dt_resultado,
			b.ds_resultado,
			coalesce(b.dt_aprovacao,a.dt_resultado) dt_ordem
	from 	exame_lab_result_item b,
			exame_lab_resultado a,
			prescr_procedimento x,
			prescr_medica c
	where	a.nr_seq_resultado	= b.nr_seq_resultado
	and		a.nr_prescricao		= c.nr_prescricao
	and		x.nr_sequencia		= b.nr_seq_prescr
	and		x.nr_prescricao		= c.nr_prescricao
	and		ie_atendimento_w 	= 'S'
	and		c.nr_atendimento 	= nr_atendimento_p
	and		b.nr_seq_exame		= nr_seq_exame_w
	and		x.ie_status_atend 	>= 35
	and		((coalesce(qt_minutos_resultado_w,0) = 0) or (b.dt_aprovacao > clock_timestamp() - qt_minutos_resultado_w/1440) or (a.dt_resultado > clock_timestamp() - qt_minutos_resultado_w/1440))
	--and		OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_resultado,ie_regra_restringir_w) = 'S'
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_resultado) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_classif_setor_w::text, '') = '') or (obter_classif_setor(c.cd_setor_atendimento) = cd_classif_setor_w))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (c.cd_setor_atendimento = cd_setor_atendimento_w))
	order by dt_ordem;

c03 CURSOR FOR
	SELECT qt_resultado,
			pr_resultado,
			dt_resultado,
			ds_resultado
	from (
		SELECT 	b.qt_resultado,
				b.pr_resultado,
				a.dt_resultado,
				b.ds_resultado,
				coalesce(b.dt_aprovacao,a.dt_resultado) ds_oder_by
		from 	exame_lab_result_item b,
				exame_lab_resultado a,
				prescr_procedimento x,
				prescr_medica c
		where	a.nr_seq_resultado	= b.nr_seq_resultado
		and		a.nr_prescricao		= c.nr_prescricao
		and		x.nr_sequencia		= b.nr_seq_prescr
		and		x.nr_prescricao		= c.nr_prescricao
		and		ie_atendimento_w 	= 'S'
		and 	c.nr_atendimento 	= nr_atendimento_p
		and		b.nr_seq_exame		= nr_seq_exame_w
		and		x.ie_status_atend	>= 35
		and		((coalesce(qt_minutos_resultado_w,0) = 0) or (b.dt_aprovacao > clock_timestamp() - qt_minutos_resultado_w/1440)or (a.dt_resultado > clock_timestamp() - qt_minutos_resultado_w/1440))
		--and		OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_resultado,ie_regra_restringir_w) = 'S'
		and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_resultado) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
		and		((coalesce(cd_classif_setor_w::text, '') = '') or (obter_classif_setor(c.cd_setor_atendimento) = cd_classif_setor_w))
		and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (c.cd_setor_atendimento = cd_setor_atendimento_w))
		
union

		select 	b.qt_resultado,
				b.pr_resultado,
				a.dt_resultado,
				b.ds_resultado,
				coalesce(b.dt_aprovacao,a.dt_resultado) ds_oder_by
		from 	exame_lab_result_item b,
				exame_lab_resultado a,
				prescr_procedimento x,
				prescr_medica c
		where	a.nr_seq_resultado	= b.nr_seq_resultado
		and		a.nr_prescricao		= c.nr_prescricao
		and		x.nr_sequencia		= b.nr_seq_prescr
		and		x.nr_prescricao		= c.nr_prescricao
		and 	ie_atendimento_w 	<> 'S'
		and 	c.cd_pessoa_fisica 	= cd_pessoa_fisica_p
		and		b.nr_seq_exame		= nr_seq_exame_w
		and		x.ie_status_atend	>= 35
		and		((coalesce(qt_minutos_resultado_w,0) = 0) or (b.dt_aprovacao > clock_timestamp() - qt_minutos_resultado_w/1440)or (a.dt_resultado > clock_timestamp() - qt_minutos_resultado_w/1440))
		--and		OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_resultado,ie_regra_restringir_w) = 'S'
		and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_resultado) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
		and		((coalesce(cd_classif_setor_w::text, '') = '') or (obter_classif_setor(c.cd_setor_atendimento) = cd_classif_setor_w))
		and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (c.cd_setor_atendimento = cd_setor_atendimento_w))) alias50
	order by ds_oder_by desc;

c04 CURSOR FOR
  SELECT  a.qt_pa_sistolica,
		  a.qt_pa_diastolica,
		  a.qt_pam
  from    atendimento_sinal_vital a
  where   a.nr_atendimento = nr_atendimento_p
  and     ((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
  and     coalesce(a.dt_inativacao::text, '') = ''
  and     (a.qt_pa_sistolica IS NOT NULL AND a.qt_pa_sistolica::text <> '')
  and     (a.qt_pa_diastolica IS NOT NULL AND a.qt_pa_diastolica::text <> '')
  and     (a.qt_pam IS NOT NULL AND a.qt_pam::text <> '')
  and     ((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
  and     ((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
  order   by a.qt_pa_sistolica, a.qt_pa_diastolica;

c20 CURSOR FOR
  SELECT  a.qt_pa_sistolica,
		  a.qt_pa_diastolica,
          a.qt_pam
  from    atendimento_sinal_vital a
  where   a.cd_pessoa_fisica = cd_pessoa_fisica_p
  and     ((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
  and     coalesce(a.dt_inativacao::text, '') = ''
  and     (a.qt_pa_sistolica IS NOT NULL AND a.qt_pa_sistolica::text <> '')
  and     (a.qt_pa_diastolica IS NOT NULL AND a.qt_pa_diastolica::text <> '')
  and     (a.qt_pam IS NOT NULL AND a.qt_pam::text <> '')
  and     ((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
  and     ((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
  order   by a.qt_pa_sistolica, a.qt_pa_diastolica;

c05 CURSOR FOR
	SELECT	a.qt_pa_sistolica,
		a.qt_pa_diastolica,
		a.qt_pam
	from	atendimento_sinal_vital a
	where	((ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
													from	atendimento_paciente b
													where	b.nr_atendimento	= a.nr_atendimento
													and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p)))
	and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
	and		coalesce(a.dt_inativacao::text, '') = ''
	and		(a.qt_pa_sistolica IS NOT NULL AND a.qt_pa_sistolica::text <> '')
	and		(a.qt_pa_diastolica IS NOT NULL AND a.qt_pa_diastolica::text <> '')
	and		(a.qt_pam IS NOT NULL AND a.qt_pam::text <> '')
	--and	(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
	order by a.qt_pa_sistolica desc, a.qt_pa_diastolica desc;

c06 CURSOR FOR
	SELECT 	b.qt_resultado,
			a.dt_resultado,
			b.ds_resultado
	from 	exame_lab_result_item b,
			exame_lab_resultado a,
			prescr_procedimento x,
			prescr_medica c
	where	a.nr_seq_resultado	= b.nr_seq_resultado
	and		a.nr_prescricao		= c.nr_prescricao
	and		x.nr_sequencia		= b.nr_seq_prescr
	and		x.nr_prescricao		= c.nr_prescricao
	and		ie_atendimento_w 	= 'S'
	and 	c.nr_atendimento 	= nr_atendimento_p
	and		b.nr_seq_exame		= nr_seq_exame_w
	and		x.ie_status_atend	>= 35
	and		((coalesce(cd_classif_setor_w::text, '') = '') or (obter_classif_setor(c.cd_setor_atendimento) = cd_classif_setor_w))
	and		((coalesce(qt_minutos_resultado_w,0) = 0) or (b.dt_aprovacao > clock_timestamp() - qt_minutos_resultado_w/1440))
	--and		OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_resultado,ie_regra_restringir_w) = 'S'
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_resultado) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (c.cd_setor_atendimento = cd_setor_atendimento_w))
	
union

	SELECT 	b.qt_resultado,
			a.dt_resultado,
			b.ds_resultado
	from 	exame_lab_result_item b,
			exame_lab_resultado a,
			prescr_procedimento x,
			prescr_medica c
	where	a.nr_seq_resultado	= b.nr_seq_resultado
	and		a.nr_prescricao		= c.nr_prescricao
	and		x.nr_sequencia		= b.nr_seq_prescr
	and		x.nr_prescricao		= c.nr_prescricao
	and		ie_atendimento_w 	<> 'S'
	and 	c.cd_pessoa_fisica 	= cd_pessoa_fisica_p
	and		b.nr_seq_exame		= nr_seq_exame_w
	and		x.ie_status_atend	>= 35
	and		((coalesce(cd_classif_setor_w::text, '') = '') or (obter_classif_setor(c.cd_setor_atendimento) = cd_classif_setor_w))
	and		((coalesce(qt_minutos_resultado_w,0) = 0) or (b.dt_aprovacao > clock_timestamp() - qt_minutos_resultado_w/1440))
	--and		OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_resultado,ie_regra_restringir_w) = 'S'
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_resultado) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (c.cd_setor_atendimento = cd_setor_atendimento_w))
	order by qt_resultado desc;


c07 CURSOR FOR
	SELECT 	b.pr_resultado,
			a.dt_resultado,
			b.ds_resultado
	from 	exame_lab_result_item b,
			exame_lab_resultado a,
			prescr_procedimento x,
			prescr_medica c
	where	a.nr_seq_resultado	= b.nr_seq_resultado
	and		a.nr_prescricao		= c.nr_prescricao
	and		x.nr_sequencia		= b.nr_seq_prescr
	and		x.nr_prescricao		= c.nr_prescricao
	and		ie_atendimento_w 	= 'S'
	and 	c.nr_atendimento 	= nr_atendimento_p
	and		b.nr_seq_exame		= nr_seq_exame_w
	and		x.ie_status_atend	>= 35
	and		((coalesce(qt_minutos_resultado_w,0) = 0) or (b.dt_aprovacao > clock_timestamp() - qt_minutos_resultado_w/1440))
	--and		OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_resultado,ie_regra_restringir_w) = 'S'
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_resultado) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_classif_setor_w::text, '') = '') or (obter_classif_setor(c.cd_setor_atendimento) = cd_classif_setor_w))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (c.cd_setor_atendimento = cd_setor_atendimento_w))
	
union

	SELECT 	b.pr_resultado,
			a.dt_resultado,
			b.ds_resultado
	from 	exame_lab_result_item b,
			exame_lab_resultado a,
			prescr_procedimento x,
			prescr_medica c
	where	a.nr_seq_resultado	= b.nr_seq_resultado
	and		a.nr_prescricao		= c.nr_prescricao
	and		x.nr_sequencia		= b.nr_seq_prescr
	and		x.nr_prescricao		= c.nr_prescricao
	and		ie_atendimento_w 	<> 'S'
	and 	c.cd_pessoa_fisica 	= cd_pessoa_fisica_p
	and		b.nr_seq_exame		= nr_seq_exame_w
	and		x.ie_status_atend	>= 35
	and		((coalesce(qt_minutos_resultado_w,0) = 0) or (b.dt_aprovacao > clock_timestamp() - qt_minutos_resultado_w/1440))
	--and		OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_resultado,ie_regra_restringir_w) = 'S'
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_resultado) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_classif_setor_w::text, '') = '') or (obter_classif_setor(c.cd_setor_atendimento) = cd_classif_setor_w))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (c.cd_setor_atendimento = cd_setor_atendimento_w))
	order by pr_resultado desc;


c08 CURSOR FOR	
	SELECT 	b.qt_resultado,
			a.dt_resultado,
			b.ds_resultado
	from 	exame_lab_result_item b,
			exame_lab_resultado a,
			prescr_procedimento x,
			prescr_medica c
	where	a.nr_seq_resultado	= b.nr_seq_resultado
	and		a.nr_prescricao		= c.nr_prescricao
	and		x.nr_sequencia		= b.nr_seq_prescr
	and		x.nr_prescricao		= c.nr_prescricao
	and		ie_atendimento_w 	= 'S'
	and 	c.nr_atendimento 	= nr_atendimento_p
	and		b.nr_seq_exame		= nr_seq_exame_w
	and		x.ie_status_atend	>= 35
	and		((coalesce(qt_minutos_resultado_w,0) = 0) or (b.dt_aprovacao > clock_timestamp() - qt_minutos_resultado_w/1440))
	--and		OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_resultado,ie_regra_restringir_w) = 'S'
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_resultado) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_classif_setor_w::text, '') = '') or (obter_classif_setor(c.cd_setor_atendimento) = cd_classif_setor_w))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (c.cd_setor_atendimento = cd_setor_atendimento_w))
	
union

	SELECT 	b.qt_resultado,
			a.dt_resultado,
			b.ds_resultado
	from 	exame_lab_result_item b,
			exame_lab_resultado a,
			prescr_procedimento x,
			prescr_medica c
	where	a.nr_seq_resultado	= b.nr_seq_resultado
	and		a.nr_prescricao		= c.nr_prescricao
	and		x.nr_sequencia		= b.nr_seq_prescr
	and		x.nr_prescricao		= c.nr_prescricao
	and		ie_atendimento_w	<> 'S'
	and 	c.cd_pessoa_fisica 	= cd_pessoa_fisica_p
	and		b.nr_seq_exame		= nr_seq_exame_w
	and		x.ie_status_atend	>= 35
	and		((coalesce(qt_minutos_resultado_w,0) = 0) or (b.dt_aprovacao > clock_timestamp() - qt_minutos_resultado_w/1440))
	--and		OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_resultado,ie_regra_restringir_w) = 'S'
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_resultado) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_classif_setor_w::text, '') = '') or (obter_classif_setor(c.cd_setor_atendimento) = cd_classif_setor_w))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (c.cd_setor_atendimento = cd_setor_atendimento_w))
	order by qt_resultado;

c09 CURSOR FOR	
	SELECT 	b.pr_resultado,
			a.dt_resultado,
			b.ds_resultado
	from 	exame_lab_result_item b,
			exame_lab_resultado a,
			prescr_procedimento x,
			prescr_medica c
	where	a.nr_seq_resultado	= b.nr_seq_resultado
	and		a.nr_prescricao		= c.nr_prescricao
	and		x.nr_sequencia		= b.nr_seq_prescr
	and		x.nr_prescricao		= c.nr_prescricao
	and		ie_atendimento_w 	= 'S'
	and 	c.nr_atendimento 	= nr_atendimento_p
	and		b.nr_seq_exame		= nr_seq_exame_w
	and		x.ie_status_atend	>= 35
	and		((coalesce(qt_minutos_resultado_w,0) = 0) or (b.dt_aprovacao > clock_timestamp() - qt_minutos_resultado_w/1440))
	--and		OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_resultado,ie_regra_restringir_w) = 'S'
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_resultado) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_classif_setor_w::text, '') = '') or (obter_classif_setor(c.cd_setor_atendimento) = cd_classif_setor_w))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (c.cd_setor_atendimento = cd_setor_atendimento_w))
	
union

	SELECT 	b.pr_resultado,
			a.dt_resultado,
			b.ds_resultado
	from 	exame_lab_result_item b,
			exame_lab_resultado a,
			prescr_procedimento x,
			prescr_medica c
	where	a.nr_seq_resultado	= b.nr_seq_resultado
	and		a.nr_prescricao		= c.nr_prescricao
	and		x.nr_sequencia		= b.nr_seq_prescr
	and		x.nr_prescricao		= c.nr_prescricao
	and		ie_atendimento_w 	<> 'S'
	and 	c.cd_pessoa_fisica 	= cd_pessoa_fisica_p
	and		b.nr_seq_exame		= nr_seq_exame_w
	and		x.ie_status_atend	>= 35
	and		((coalesce(qt_minutos_resultado_w,0) = 0) or (b.dt_aprovacao > clock_timestamp() - qt_minutos_resultado_w/1440))
	--and		OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_resultado,ie_regra_restringir_w) = 'S'
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_resultado) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_classif_setor_w::text, '') = '') or (obter_classif_setor(c.cd_setor_atendimento) = cd_classif_setor_w))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (c.cd_setor_atendimento = cd_setor_atendimento_w))
	order by pr_resultado;

c10 CURSOR FOR
	SELECT qt_resultado,
	       pr_resultado,
	       dt_resultado,
	       ds_resultado
	from (
	SELECT 	b.qt_resultado,
			b.pr_resultado,
			a.dt_resultado,
			b.ds_resultado,
			Obter_Indice_Informacao(nr_seq_dest_inf_w,qt_resultado) ds_order_by
	from 	exame_lab_result_item b,
			exame_lab_resultado a,
			prescr_procedimento x,
			prescr_medica c
	where	a.nr_seq_resultado	= b.nr_seq_resultado
	and		a.nr_prescricao		= c.nr_prescricao
	and		x.nr_sequencia		= b.nr_seq_prescr
	and		x.nr_prescricao		= c.nr_prescricao
	and		ie_atendimento_w 	<> 'S'
	and 	c.cd_pessoa_fisica 	= cd_pessoa_fisica_p
	and		b.nr_seq_exame		= nr_seq_exame_w
	and		x.ie_status_atend	>= 35
	and		((coalesce(qt_minutos_resultado_w,0) = 0) or (b.dt_aprovacao > clock_timestamp() - qt_minutos_resultado_w/1440))
	--and		(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_resultado,ie_regra_restringir_w) = 'S')
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_resultado) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_classif_setor_w::text, '') = '') or (obter_classif_setor(c.cd_setor_atendimento) = cd_classif_setor_w))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (c.cd_setor_atendimento = cd_setor_atendimento_w))
	and		a.dt_resultado between dt_entrada_uti_w and dt_entrada_uti_w + 1
	
union

	select 	b.qt_resultado,
			b.pr_resultado,
			a.dt_resultado,
			b.ds_resultado,
			Obter_Indice_Informacao(nr_seq_dest_inf_w,qt_resultado) ds_order_by
	from 	exame_lab_result_item b,
			exame_lab_resultado a,
			prescr_procedimento x,
			prescr_medica c
	where	a.nr_seq_resultado	= b.nr_seq_resultado
	and		a.nr_prescricao		= c.nr_prescricao
	and		x.nr_sequencia		= b.nr_seq_prescr
	and		x.nr_prescricao		= c.nr_prescricao
	and		ie_atendimento_w 	= 'S'
	and 	c.nr_atendimento 	= nr_atendimento_p
	and		b.nr_seq_exame		= nr_seq_exame_w
	and		x.ie_status_atend	>= 35
	and		((coalesce(qt_minutos_resultado_w,0) = 0) or (b.dt_aprovacao > clock_timestamp() - qt_minutos_resultado_w/1440))
	--and		(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_resultado,ie_regra_restringir_w) = 'S')
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_resultado) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_classif_setor_w::text, '') = '') or (obter_classif_setor(c.cd_setor_atendimento) = cd_classif_setor_w))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (c.cd_setor_atendimento = cd_setor_atendimento_w))
	and		a.dt_resultado between dt_entrada_uti_w and dt_entrada_uti_w + 1) alias46
	order by ds_order_by;	


C11 CURSOR FOR
	SELECT	a.qt_glasgow
	from	atend_escala_indice a
	where	((ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
													from	atendimento_paciente b
													where	b.nr_atendimento	= a.nr_atendimento
													and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p)))
	and		(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and		coalesce(a.dt_inativacao::text, '') = ''
	and		(a.qt_glasgow IS NOT NULL AND a.qt_glasgow::text <> '')
	--and		(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_avaliacao,ie_regra_restringir_w) = 'S')
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_avaliacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
	and		a.DT_AVALIACAO between dt_entrada_uti_w and dt_entrada_uti_w + 1
	order by Obter_Indice_Informacao(nr_seq_dest_inf_w,qt_glasgow);


c12 CURSOR FOR
	SELECT	b.qt_pa_sistolica
	from	atendimento_sinal_vital b
	where	((ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)))
	and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and		coalesce(b.dt_inativacao::text, '') = ''
	and		(b.qt_pa_sistolica IS NOT NULL AND b.qt_pa_sistolica::text <> '')
	and		(b.qt_pa_diastolica IS NOT NULL AND b.qt_pa_diastolica::text <> '')
	and		(b.qt_pam IS NOT NULL AND b.qt_pam::text <> '')
	--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (b.cd_setor_atendimento = cd_setor_atendimento_w))
	order by  Obter_Indice_Informacao(nr_seq_dest_inf_w,qt_pa_sistolica);

c13 CURSOR FOR
	SELECT	b.QT_FREQ_CARDIACA
	from	atendimento_sinal_vital b
	where	((ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)))
	and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and		coalesce(b.dt_inativacao::text, '') = ''
	and		(b.QT_FREQ_CARDIACA IS NOT NULL AND b.QT_FREQ_CARDIACA::text <> '')
	--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (b.cd_setor_atendimento = cd_setor_atendimento_w))
	and		b.dt_sinal_vital between dt_entrada_uti_w and dt_entrada_uti_w + 1
	order by  Obter_Indice_Informacao(nr_seq_dest_inf_w,QT_FREQ_CARDIACA);

c14 CURSOR FOR
	SELECT	b.QT_FREQ_RESP
	from	atendimento_sinal_vital b
	where	((ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)))
	and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and		coalesce(b.dt_inativacao::text, '') = ''
	and		(b.QT_FREQ_RESP IS NOT NULL AND b.QT_FREQ_RESP::text <> '')
	--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (b.cd_setor_atendimento = cd_setor_atendimento_w))
	and		b.dt_sinal_vital between dt_entrada_uti_w and dt_entrada_uti_w + 1
	order by  Obter_Indice_Informacao(nr_seq_dest_inf_w,QT_FREQ_RESP);

c15 CURSOR FOR
	SELECT	b.QT_TEMP
	from	atendimento_sinal_vital b
	where	((ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)))
	and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and		coalesce(b.dt_inativacao::text, '') = ''
	and		(b.QT_TEMP IS NOT NULL AND b.QT_TEMP::text <> '')
	--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (b.cd_setor_atendimento = cd_setor_atendimento_w))
	and		b.dt_sinal_vital between dt_entrada_uti_w and dt_entrada_uti_w + 1
	order by  Obter_Indice_Informacao(nr_seq_dest_inf_w,QT_TEMP);

c16 CURSOR FOR
	SELECT	b.qt_pa_diastolica
	from	atendimento_sinal_vital b
	where	((ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)))
	and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and		coalesce(b.dt_inativacao::text, '') = ''
	and		(b.qt_pa_diastolica IS NOT NULL AND b.qt_pa_diastolica::text <> '')
	--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (b.cd_setor_atendimento = cd_setor_atendimento_w))
	and		b.dt_sinal_vital between dt_entrada_uti_w and dt_entrada_uti_w + 1
	order by  Obter_Indice_Informacao(nr_seq_dest_inf_w,qt_pa_diastolica);

c17 CURSOR FOR
	SELECT	b.qt_pam
	from	atendimento_sinal_vital b
	where	((ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)))
	and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and		coalesce(b.dt_inativacao::text, '') = ''
	and		(b.qt_pam IS NOT NULL AND b.qt_pam::text <> '')
	--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (b.cd_setor_atendimento = cd_setor_atendimento_w))
	and		b.dt_sinal_vital between dt_entrada_uti_w and dt_entrada_uti_w + 1
	order by  Obter_Indice_Informacao(nr_seq_dest_inf_w,qt_pam);

c18 CURSOR FOR
	SELECT	b.ie_nivel_consciencia
	from	atendimento_sinal_vital b
	where	((ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)))
	and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and		coalesce(b.dt_inativacao::text, '') = ''
	and		(b.ie_nivel_consciencia IS NOT NULL AND b.ie_nivel_consciencia::text <> '')
	--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (b.cd_setor_atendimento = cd_setor_atendimento_w))
	and		b.dt_sinal_vital between dt_entrada_uti_w and dt_entrada_uti_w + 1
	order by  Obter_Indice_Informacao(nr_seq_dest_inf_w,ie_nivel_consciencia);

c19 CURSOR FOR
	SELECT	b.IE_COND_SAT_O2
	from	atendimento_sinal_vital b
	where	((ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)))
	and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and		coalesce(b.dt_inativacao::text, '') = ''
	and		(b.IE_COND_SAT_O2 IS NOT NULL AND b.IE_COND_SAT_O2::text <> '')
	--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
	and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
	and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (b.cd_setor_atendimento = cd_setor_atendimento_w))
	and		b.dt_sinal_vital between dt_entrada_uti_w and dt_entrada_uti_w + 1
	order by  Obter_Indice_Informacao(nr_seq_dest_inf_w,IE_COND_SAT_O2);


BEGIN

select	coalesce(max(IE_LIB_SINAL_VITAL),'N')
into STRICT	ie_sv_liberados_w
from	parametro_medico
where	cd_estabelecimento = cd_estabelecimento_p;

open	c01;
loop
fetch	c01 into
	ie_atendimento_w,
	ie_informacao_w,
	nr_seq_exame_w,
	ie_result_exame_w,
	ie_origem_w,
	nr_sequencia_w,
	cd_classif_setor_w,
	cd_setor_atendimento_w,
	nr_seq_dest_inf_w,
	qt_minutos_resultado_w,
	ie_regra_restringir_w,
	nr_seq_tipo_pg_w,
	ie_forma_ganho_perda_w;
EXIT WHEN NOT FOUND; /* apply on c01 */	
	begin	

	ie_atendimento_w	:= ie_atendimento_w;
	ie_informacao_w		:= ie_informacao_w;
	nr_seq_exame_w		:= nr_seq_exame_w;
	ie_result_exame_w	:= ie_result_exame_w;
	ie_origem_w		:= ie_origem_w;
	nr_sequencia_w		:= nr_sequencia_w;
	cd_classif_setor_w	:= cd_classif_setor_w;
	ie_regra_restringir_w	:= ie_regra_restringir_w;
	nr_seq_tipo_pg_ww := nr_seq_tipo_pg_w || ','|| nr_seq_tipo_pg_ww;
	end;
end loop;
close c01;

select	coalesce(max(dt_entrada_unidade),clock_timestamp())
into STRICT	dt_entrada_uti_w
from	resumo_atendimento_paciente_v
where	nr_atendimento	= nr_atendimento_p;
if (ie_origem_w = 'SV') or (ie_origem_w = 'MR')  then
	begin
	if (ie_informacao_w = 'Primeira') then
		begin
		if (nr_sequencia_w = 12) then
			select	min(a.qt_peso)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	= (	SELECT	min(b.nr_sequencia)
							from	atendimento_sinal_vital b
							where	(b.qt_peso IS NOT NULL AND b.qt_peso::text <> '')
							and	coalesce(b.dt_inativacao::text, '') = ''
							--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
							and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
		elsif (nr_sequencia_w = 13) then
			select	min(a.qt_altura_cm)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	in(		SELECT	min(b.nr_sequencia)
											from	atendimento_sinal_vital b
											where	(b.qt_altura_cm IS NOT NULL AND b.qt_altura_cm::text <> '')
											and		coalesce(b.dt_inativacao::text, '') = ''
											--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
											and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
											and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
											and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
											and		ie_atendimento_w = 'S'
											and		b.nr_atendimento = nr_atendimento_p
											
union
				
											SELECT	min(b.nr_sequencia)
											from	atendimento_sinal_vital b
											where	(b.qt_altura_cm IS NOT NULL AND b.qt_altura_cm::text <> '')
											and		coalesce(b.dt_inativacao::text, '') = ''
											--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
											and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
											and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
											and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
											and		ie_atendimento_w = 'N'			
											and		b.cd_paciente = cd_pessoa_fisica_p);
		elsif (nr_sequencia_w = 14) then
			select	min(a.qt_pa_sistolica)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	in (	SELECT	min(b.nr_sequencia)
										from	atendimento_sinal_vital b
										where	ie_atendimento_w = 'S'
										and		b.nr_atendimento = nr_atendimento_p
										and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
										and		coalesce(b.dt_inativacao::text, '') = ''
										and		(b.qt_pa_sistolica IS NOT NULL AND b.qt_pa_sistolica::text <> '')
										and		(b.qt_pa_diastolica IS NOT NULL AND b.qt_pa_diastolica::text <> '')
										and		(b.qt_pam IS NOT NULL AND b.qt_pam::text <> '')
										--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
										and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
										and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (b.cd_setor_atendimento = cd_setor_atendimento_w))
										
union

										SELECT	min(b.nr_sequencia)
										from	atendimento_sinal_vital b
										where	ie_atendimento_w = 'N'
										and 	(b.qt_pa_sistolica IS NOT NULL AND b.qt_pa_sistolica::text <> '')										
										and		(b.qt_pa_diastolica IS NOT NULL AND b.qt_pa_diastolica::text <> '')
										and		coalesce(b.dt_inativacao::text, '') = ''
										--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
										and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
										and		(b.qt_pam IS NOT NULL AND b.qt_pam::text <> '')
										and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
										and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
										and		exists (select	1
														from	atendimento_paciente c
														where	c.nr_atendimento = b.nr_atendimento
														and	c.cd_pessoa_fisica = cd_pessoa_fisica_p));
		elsif (nr_sequencia_w = 15) then
			select	min(a.qt_freq_cardiaca)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	in (	SELECT	min(b.nr_sequencia)
										from	atendimento_sinal_vital b							
										where	(b.qt_freq_cardiaca IS NOT NULL AND b.qt_freq_cardiaca::text <> '')
										and		coalesce(b.dt_inativacao::text, '') = ''
										--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
										and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
										and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
										and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
										and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) 
										
union

										SELECT	min(b.nr_sequencia)
										from	atendimento_sinal_vital b							
										where	(b.qt_freq_cardiaca IS NOT NULL AND b.qt_freq_cardiaca::text <> '')
										and		coalesce(b.dt_inativacao::text, '') = ''
										--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
										and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
										and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
										and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
										and (ie_atendimento_w = 'N' and exists (select	1
																					from	atendimento_paciente c
																					where	c.nr_atendimento = b.nr_atendimento
																					and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
		elsif (nr_sequencia_w = 16) then
			select	min(a.qt_freq_resp)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	= (	SELECT	min(b.nr_sequencia)
							from	atendimento_sinal_vital b
							where	(b.qt_freq_resp IS NOT NULL AND b.qt_freq_resp::text <> '')
							and	coalesce(b.dt_inativacao::text, '') = ''
							--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
							and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
		elsif (nr_sequencia_w = 17) then
			select	min(a.qt_temp)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	in (	SELECT	min(b.nr_sequencia)
										from	atendimento_sinal_vital b
										where	(b.qt_temp IS NOT NULL AND b.qt_temp::text <> '')
										and		coalesce(b.dt_inativacao::text, '') = ''
										--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
										and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
										and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
										and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
										and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p)
										
union

										SELECT	min(b.nr_sequencia)
										from	atendimento_sinal_vital b
										where	(b.qt_temp IS NOT NULL AND b.qt_temp::text <> '')
										and		coalesce(b.dt_inativacao::text, '') = ''
										--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
										and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
										and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
										and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
										and (ie_atendimento_w = 'N' and exists (	select	1
																	from	atendimento_paciente c
																	where	c.nr_atendimento = b.nr_atendimento
																	and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
		elsif (nr_sequencia_w = 18) then
			select	min(a.qt_rel_pao2_fio2)
			into STRICT	qt_resultado_w
			from	atendimento_monit_resp a
			where	a.nr_sequencia	= (	SELECT	min(b.nr_sequencia)
							from	atendimento_monit_resp b
							where	(b.qt_rel_pao2_fio2 IS NOT NULL AND b.qt_rel_pao2_fio2::text <> '')
							and	coalesce(b.dt_inativacao::text, '') = ''
							--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_monitorizacao,ie_regra_restringir_w) = 'S')
							and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_monitorizacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
		elsif (nr_sequencia_w = 21) then
			select	min(a.qt_pvc)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital  a
			where	a.nr_sequencia	= (	SELECT	min(b.nr_sequencia)
							from	atendimento_sinal_vital  b
							where	(b.qt_pvc IS NOT NULL AND b.qt_pvc::text <> '')
							and	coalesce(b.dt_inativacao::text, '') = ''
							--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
							and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
		elsif (nr_sequencia_w = 23) then
			select	min(a.qt_pa_diastolica)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	= (	SELECT	min(b.nr_sequencia)
							from	atendimento_sinal_vital b
							where	(b.qt_pa_sistolica IS NOT NULL AND b.qt_pa_sistolica::text <> '')
							and	(b.qt_pa_diastolica IS NOT NULL AND b.qt_pa_diastolica::text <> '')
							and	coalesce(b.dt_inativacao::text, '') = ''							
							and	(b.qt_pam IS NOT NULL AND b.qt_pam::text <> '')
							--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
							and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
		elsif (nr_sequencia_w = 24) then
			select	min(a.qt_pam)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	= (	SELECT	min(b.nr_sequencia)
							from	atendimento_sinal_vital b
							where	(b.qt_pa_sistolica IS NOT NULL AND b.qt_pa_sistolica::text <> '')
							and	(b.qt_pa_diastolica IS NOT NULL AND b.qt_pa_diastolica::text <> '')
							and	coalesce(b.dt_inativacao::text, '') = ''
							and	(b.qt_pam IS NOT NULL AND b.qt_pam::text <> '')
							--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
							and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
		elsif (nr_sequencia_w = 56) then
			select	min(a.qt_bcf)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	= (	SELECT	min(b.nr_sequencia)
							from	atendimento_sinal_vital b
							where	(b.qt_pa_sistolica IS NOT NULL AND b.qt_pa_sistolica::text <> '')
							and	(b.qt_pa_diastolica IS NOT NULL AND b.qt_pa_diastolica::text <> '')
							and	coalesce(b.dt_inativacao::text, '') = ''
							and	(b.qt_bcf IS NOT NULL AND b.qt_bcf::text <> '')
							--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
							and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));													
		elsif (nr_sequencia_w = 94) then
			select	min(a.QT_FIO2)
			into STRICT	qt_resultado_w
			from	atendimento_monit_resp a
			where	a.nr_sequencia	= (	SELECT	min(b.nr_sequencia)
							from	atendimento_monit_resp b
							where	(b.QT_FIO2 IS NOT NULL AND b.QT_FIO2::text <> '')
							and	coalesce(b.dt_inativacao::text, '') = ''
							--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_monitorizacao,ie_regra_restringir_w) = 'S')
							and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_monitorizacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
		elsif (nr_sequencia_w = 232) then
			select	min(a.ie_nivel_consciencia)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	= (	SELECT	min(b.nr_sequencia)
							from	atendimento_sinal_vital b
							where	(b.ie_nivel_consciencia IS NOT NULL AND b.ie_nivel_consciencia::text <> '')
							and		coalesce(b.dt_inativacao::text, '') = ''
							--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
							and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
		elsif (nr_sequencia_w = 337) then 													
			select	min(a.IE_COND_SAT_O2)
			into STRICT	ds_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	= (	SELECT	min(b.nr_sequencia)
							from	atendimento_sinal_vital b
							where	(b.IE_COND_SAT_O2 IS NOT NULL AND b.IE_COND_SAT_O2::text <> '')
							and		coalesce(b.dt_inativacao::text, '') = ''
							--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
							and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));						
			if (ds_resultado_w = 'AA') then
				ds_resultado_w := 'N';
			elsif (ds_resultado_w = 'O2') then
				ds_resultado_w := 'S';
			end if;
		end if;
		end;
	elsif (ie_informacao_w = 'Ultima') then
		begin

		if (nr_sequencia_w = 12) then
			select	max(a.qt_peso)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	in(		SELECT	max(b.nr_sequencia)
								from	atendimento_sinal_vital b
								where	(b.qt_peso IS NOT NULL AND b.qt_peso::text <> '')
								and		coalesce(b.dt_inativacao::text, '') = ''
								--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
								and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
								and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
								and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
								and		ie_atendimento_w = 'S'
								and		b.nr_atendimento = nr_atendimento_p
								
union
				
								SELECT	max(b.nr_sequencia)
								from	atendimento_sinal_vital b
								where	(b.qt_peso IS NOT NULL AND b.qt_peso::text <> '')
								and		coalesce(b.dt_inativacao::text, '') = ''
								--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
								and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
								and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
								and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
								and		ie_atendimento_w = 'N'			
								and		b.cd_paciente = cd_pessoa_fisica_p);
		elsif (nr_sequencia_w = 13) then
			select	max(a.qt_altura_cm)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	in(		SELECT	max(b.nr_sequencia)
											from	atendimento_sinal_vital b
											where	(b.qt_altura_cm IS NOT NULL AND b.qt_altura_cm::text <> '')
											and		coalesce(b.dt_inativacao::text, '') = ''
											--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
											and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
											and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
											and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
											and		ie_atendimento_w = 'S'
											and		b.nr_atendimento = nr_atendimento_p
											
union
				
											SELECT	max(b.nr_sequencia)
											from	atendimento_sinal_vital b
											where	(b.qt_altura_cm IS NOT NULL AND b.qt_altura_cm::text <> '')
											and		coalesce(b.dt_inativacao::text, '') = ''
											--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
											and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
											and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
											and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
											and		ie_atendimento_w = 'N'			
											and		b.cd_paciente = cd_pessoa_fisica_p);
		elsif (nr_sequencia_w = 14) then
			select	max(a.qt_pa_sistolica)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	in(		SELECT	max(b.nr_sequencia)
											from	atendimento_sinal_vital b
											where	ie_atendimento_w = 'S'
											and		b.nr_atendimento = nr_atendimento_p
											and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
											and		coalesce(b.dt_inativacao::text, '') = ''
											and		(b.qt_pa_sistolica IS NOT NULL AND b.qt_pa_sistolica::text <> '')
											--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
											and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
											and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (b.cd_setor_atendimento = cd_setor_atendimento_w))
											
union
				
											SELECT	max(b.nr_sequencia)
											from	atendimento_sinal_vital b
											where	ie_atendimento_w = 'N'	
											and		b.cd_paciente = cd_pessoa_fisica_p
											and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
											and		coalesce(b.dt_inativacao::text, '') = ''
											and		(b.qt_pa_sistolica IS NOT NULL AND b.qt_pa_sistolica::text <> '')
											--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
											and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
											and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (b.cd_setor_atendimento = cd_setor_atendimento_w)));
		elsif (nr_sequencia_w = 15) then
			select	max(a.qt_freq_cardiaca)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	in (	SELECT	max(b.nr_sequencia)
										from	atendimento_sinal_vital b
										where	(b.qt_freq_cardiaca IS NOT NULL AND b.qt_freq_cardiaca::text <> '')
										and		coalesce(b.dt_inativacao::text, '') = ''
										--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
										and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
										and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
										and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
										and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) 
										
union

										SELECT	max(b.nr_sequencia)
										from	atendimento_sinal_vital b
										where	(b.qt_freq_cardiaca IS NOT NULL AND b.qt_freq_cardiaca::text <> '')
										and		coalesce(b.dt_inativacao::text, '') = ''
										--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
										and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
										and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
										and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
										and (ie_atendimento_w = 'N' and exists (select	1
																					from	atendimento_paciente c
																					where	c.nr_atendimento = b.nr_atendimento
																					and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
		elsif (nr_sequencia_w = 16) then
            select	max(a.qt_freq_resp)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	in (	SELECT	max(b.nr_sequencia)
							from	atendimento_sinal_vital b
							where	(b.qt_freq_resp IS NOT NULL AND b.qt_freq_resp::text <> '')
							and	coalesce(b.dt_inativacao::text, '') = ''
							--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
							and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
                           and (ie_atendimento_w = 'S' 
                           and b.nr_atendimento = nr_atendimento_p)
                           
union
                                                    
    	                   SELECT	max(b.nr_sequencia)
							from	atendimento_sinal_vital b
							where	(b.qt_freq_resp IS NOT NULL AND b.qt_freq_resp::text <> '')
							and	coalesce(b.dt_inativacao::text, '') = ''
							--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
							and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
							and (ie_atendimento_w = 'N' and exists (select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));

		elsif (nr_sequencia_w = 17) then
			select	max(a.qt_temp)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	in(		SELECT	max(b.nr_sequencia)
											from	atendimento_sinal_vital b
											where	(b.qt_temp IS NOT NULL AND b.qt_temp::text <> '')
											and		coalesce(b.dt_inativacao::text, '') = ''
											--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
											and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
											and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
											and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
											and		ie_atendimento_w = 'S'
											and		b.nr_atendimento = nr_atendimento_p
											
union
				
											SELECT	max(b.nr_sequencia)
											from	atendimento_sinal_vital b
											where	(b.qt_temp IS NOT NULL AND b.qt_temp::text <> '')
											and		coalesce(b.dt_inativacao::text, '') = ''
											--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
											and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
											and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
											and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
											and		ie_atendimento_w = 'N'			
											and		b.cd_paciente = cd_pessoa_fisica_p);
		elsif (nr_sequencia_w = 18) then
			select	max(a.qt_rel_pao2_fio2)
			into STRICT	qt_resultado_w
			from	atendimento_monit_resp a
			where	a.nr_sequencia	= (	SELECT	max(b.nr_sequencia)
							from	atendimento_monit_resp b
							where	(b.qt_rel_pao2_fio2 IS NOT NULL AND b.qt_rel_pao2_fio2::text <> '')
							and	coalesce(b.dt_inativacao::text, '') = ''
							--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_monitorizacao,ie_regra_restringir_w) = 'S')
							and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_monitorizacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
		elsif (nr_sequencia_w = 21) then
			select	max(a.qt_pvc)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	= (	SELECT	max(b.nr_sequencia)
							from	atendimento_sinal_vital b
							where	(b.qt_pvc IS NOT NULL AND b.qt_pvc::text <> '')
							and	coalesce(b.dt_inativacao::text, '') = ''
							--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
							and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
		elsif (nr_sequencia_w = 23) then
			select	max(a.qt_pa_diastolica)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	in (	SELECT	max(b.nr_sequencia)
										from	atendimento_sinal_vital b
										where	ie_atendimento_w = 'S'
										and		b.nr_atendimento = nr_atendimento_p
										and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
										and		coalesce(b.dt_inativacao::text, '') = ''
										and		(b.qt_pa_diastolica IS NOT NULL AND b.qt_pa_diastolica::text <> '')
										--and		(Obter_se_regra_inf_atributo(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
										and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
										and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (b.cd_setor_atendimento = cd_setor_atendimento_w))
										
union
				
										SELECT	max(b.nr_sequencia)
										from	atendimento_sinal_vital b
										where	ie_atendimento_w = 'N'
										and		b.cd_paciente = cd_pessoa_fisica_p
										and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
										and		coalesce(b.dt_inativacao::text, '') = ''
										and		(b.qt_pa_diastolica IS NOT NULL AND b.qt_pa_diastolica::text <> '')
										--and		(Obter_se_regra_inf_atributo(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
										and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
										and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (b.cd_setor_atendimento = cd_setor_atendimento_w)));
		elsif (nr_sequencia_w = 24) then
			select	max(a.qt_pam)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	in (	SELECT	max(b.nr_sequencia)
										from	atendimento_sinal_vital b
										where	ie_atendimento_w = 'S'
										and		b.nr_atendimento = nr_atendimento_p
										and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
										and		coalesce(b.dt_inativacao::text, '') = ''
										and		(b.qt_pa_diastolica IS NOT NULL AND b.qt_pa_diastolica::text <> '')
										and		(b.qt_pa_sistolica IS NOT NULL AND b.qt_pa_sistolica::text <> '')
										and		(b.qt_pam IS NOT NULL AND b.qt_pam::text <> '')
										--and		(Obter_se_regra_inf_atributo(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
										and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
										and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (b.cd_setor_atendimento = cd_setor_atendimento_w))
										
union
			
										SELECT	max(b.nr_sequencia)
										from	atendimento_sinal_vital b
										where	ie_atendimento_w = 'N'			
										and		b.cd_paciente = cd_pessoa_fisica_p
										and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
										and		coalesce(b.dt_inativacao::text, '') = ''
										and		(b.qt_pa_diastolica IS NOT NULL AND b.qt_pa_diastolica::text <> '')
										and		(b.qt_pa_sistolica IS NOT NULL AND b.qt_pa_sistolica::text <> '')
										and		(b.qt_pam IS NOT NULL AND b.qt_pam::text <> '')
										--and		(Obter_se_regra_inf_atributo(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
										and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
										and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (b.cd_setor_atendimento = cd_setor_atendimento_w)));
		elsif (nr_sequencia_w = 56) then
			select	max(a.qt_bcf)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	= (	SELECT	max(b.nr_sequencia)
							from	atendimento_sinal_vital b
							where	(b.qt_pa_sistolica IS NOT NULL AND b.qt_pa_sistolica::text <> '')
							and	(b.qt_pa_diastolica IS NOT NULL AND b.qt_pa_diastolica::text <> '')
							and	coalesce(b.dt_inativacao::text, '') = ''
							and	(b.qt_bcf IS NOT NULL AND b.qt_bcf::text <> '')
							--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
							and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));													
		elsif (nr_sequencia_w = 94) then


			select	max(a.QT_FIO2)
			into STRICT	qt_resultado_w
			from	atendimento_monit_resp a
			where	a.nr_sequencia	= (	SELECT	max(b.nr_sequencia)
							from	atendimento_monit_resp b
							where	(b.QT_FIO2 IS NOT NULL AND b.QT_FIO2::text <> '')
							and	coalesce(b.dt_inativacao::text, '') = ''
							--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_monitorizacao,ie_regra_restringir_w) = 'S')
							and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_monitorizacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));


		elsif (nr_sequencia_w = 232) then
			select	max(a.ie_nivel_consciencia)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	= (	SELECT	max(b.nr_sequencia)
							from	atendimento_sinal_vital b
							where	(b.ie_nivel_consciencia IS NOT NULL AND b.ie_nivel_consciencia::text <> '')
							and	coalesce(b.dt_inativacao::text, '') = ''
							--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
							and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));

		elsif (nr_sequencia_w = 337) then
			select	max(a.IE_COND_SAT_O2)
			into STRICT	ds_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	= (	SELECT	max(b.nr_sequencia)
							from	atendimento_sinal_vital b
							where	(b.IE_COND_SAT_O2 IS NOT NULL AND b.IE_COND_SAT_O2::text <> '')
							and	coalesce(b.dt_inativacao::text, '') = ''
							--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_sinal_vital,ie_regra_restringir_w) = 'S')
							and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
			if (ds_resultado_w = 'AA') then
				ds_resultado_w := 'N';
			elsif (ds_resultado_w = 'O2') then
				ds_resultado_w := 'S';
			end if;
		elsif (nr_sequencia_w = 54) then
			select	max(a.qt_saturacao_o2)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	a.nr_sequencia	in(		SELECT	max(b.nr_sequencia)
											from	atendimento_sinal_vital b
											where	(b.qt_saturacao_o2 IS NOT NULL AND b.qt_saturacao_o2::text <> '')
											and		coalesce(b.dt_inativacao::text, '') = ''
											and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
											and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
											and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
											and		ie_atendimento_w = 'S'
											and		b.nr_atendimento = nr_atendimento_p
											
union
				
											SELECT	max(b.nr_sequencia)
											from	atendimento_sinal_vital b
											where	(b.qt_saturacao_o2 IS NOT NULL AND b.qt_saturacao_o2::text <> '')
											and		coalesce(b.dt_inativacao::text, '') = ''
											and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
											and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
											and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
											and		ie_atendimento_w = 'N'			
											and		b.cd_paciente = cd_pessoa_fisica_p);
		end if;
		end;
	elsif (ie_informacao_w = 'Maior') then
		begin
		if (nr_sequencia_w = 12) then
			select	max(a.qt_peso)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	(a.qt_peso IS NOT NULL AND a.qt_peso::text <> '')
			and	coalesce(a.dt_inativacao::text, '') = ''
			--and	(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
			and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
		elsif (nr_sequencia_w = 13) then
			select	max(a.qt_altura_cm)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	(a.qt_peso IS NOT NULL AND a.qt_peso::text <> '')
			and	coalesce(a.dt_inativacao::text, '') = ''
			--and	(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
			and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
		elsif (nr_sequencia_w in (14,23,24)) then
      begin      
      if (ie_atendimento_w = 'S') then
        open  c04;
        loop
        fetch c04 into
        qt_pa_sistolica_w,
        qt_pa_diastolica_w,
        qt_pam_w;
        EXIT WHEN NOT FOUND; /* apply on c04 */
        begin
        qt_pa_sistolica_w := qt_pa_sistolica_w;
        qt_pa_diastolica_w  := qt_pa_diastolica_w;
        qt_pam_w := qt_pam_w;
        end;
        end loop;
        close c04;

        if (nr_sequencia_w = 14) then
        qt_resultado_w  := qt_pa_sistolica_w;
        elsif (nr_sequencia_w = 23) then
        qt_resultado_w  := qt_pa_diastolica_w;
        elsif (nr_sequencia_w = 24) then
        qt_resultado_w  := qt_pam_w;
        end if;

      elsif (ie_atendimento_w = 'N') then
        open  c20;
        loop
        fetch c20 into
        qt_pa_sistolica_w,
        qt_pa_diastolica_w,
        qt_pam_w;
        EXIT WHEN NOT FOUND; /* apply on c20 */
        begin 

        qt_pa_sistolica_w := qt_pa_sistolica_w;
        qt_pa_diastolica_w  := qt_pa_diastolica_w;
        qt_pam_w    := qt_pam_w;

        end;
        end loop;
        close c20;

        if (nr_sequencia_w = 14) then
        qt_resultado_w  := qt_pa_sistolica_w;
        elsif (nr_sequencia_w = 23) then
        qt_resultado_w  := qt_pa_diastolica_w;
        elsif (nr_sequencia_w = 24) then
        qt_resultado_w  := qt_pam_w;
        end if;
      end if;	
      end;
		elsif (nr_sequencia_w = 15) then
			if (ie_atendimento_w = 'S') then
				select	max(a.qt_freq_cardiaca)
				into STRICT	qt_resultado_w
				from	atendimento_sinal_vital a
				where	(a.qt_freq_cardiaca IS NOT NULL AND a.qt_freq_cardiaca::text <> '')
				and		coalesce(a.dt_inativacao::text, '') = ''
				--and (OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
				and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
				and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
				and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
				and		a.nr_atendimento = nr_atendimento_p;
			elsif (ie_atendimento_w = 'N') then
				select	max(a.qt_freq_cardiaca)
				into STRICT	qt_resultado_w
				from	atendimento_sinal_vital a
				where	(a.qt_freq_cardiaca IS NOT NULL AND a.qt_freq_cardiaca::text <> '')
				and		coalesce(a.dt_inativacao::text, '') = ''
				--and (OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
				and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
				and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
				and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
				and		exists (SELECT	1
								from	atendimento_paciente b
								where	b.nr_atendimento	= a.nr_atendimento
								and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p);
			end if;
		elsif (nr_sequencia_w = 16) then
			select	max(a.qt_freq_resp)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	(a.qt_freq_resp IS NOT NULL AND a.qt_freq_resp::text <> '')
			and	coalesce(a.dt_inativacao::text, '') = ''
			--and	(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
			and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
		elsif (nr_sequencia_w = 17) then
			if (ie_atendimento_w = 'S') then
				select	max(a.qt_temp)
				into STRICT	qt_resultado_w
				from	atendimento_sinal_vital a
				where	(a.qt_temp IS NOT NULL AND a.qt_temp::text <> '')
				--and		(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
				and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
				and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
				and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
				and		a.nr_atendimento = nr_atendimento_p;
			elsif (ie_atendimento_w = 'N') then
				select	max(a.qt_temp)
				into STRICT	qt_resultado_w
				from	atendimento_sinal_vital a
				where	(a.qt_temp IS NOT NULL AND a.qt_temp::text <> '')
				--and		(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
				and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
				and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
				and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
				and	exists (SELECT	1
							from	atendimento_paciente b
							where	b.nr_atendimento	= a.nr_atendimento
							and		b.cd_pessoa_fisica	= cd_pessoa_fisica_p);
			end if;
		elsif (nr_sequencia_w = 18) then
			select	max(a.qt_rel_pao2_fio2)
			into STRICT	qt_resultado_w
			from	atendimento_monit_resp a
			where	(a.qt_rel_pao2_fio2 IS NOT NULL AND a.qt_rel_pao2_fio2::text <> '')
			and	coalesce(a.dt_inativacao::text, '') = ''
			--and	(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_monitorizacao,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_monitorizacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
			and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
		elsif (nr_sequencia_w = 21) then
			select	max(a.qt_pvc)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	(a.qt_pvc IS NOT NULL AND a.qt_pvc::text <> '')
			and	coalesce(a.dt_inativacao::text, '') = ''
			--and	(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
			and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
		elsif (nr_sequencia_w = 56) then
			select	max(a.qt_bcf)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	(a.qt_bcf IS NOT NULL AND a.qt_bcf::text <> '')
			and	coalesce(a.dt_inativacao::text, '') = ''
			--and	(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
			and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));									
		elsif (nr_sequencia_w = 94) then
			select	max(a.QT_FIO2)
			into STRICT	qt_resultado_w
			from	atendimento_monit_resp a
			where	(a.QT_FIO2 IS NOT NULL AND a.QT_FIO2::text <> '')
			and	coalesce(a.dt_inativacao::text, '') = ''
			--and	(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_monitorizacao,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_monitorizacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
			and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
		elsif (nr_sequencia_w = 232) then
			select	max(a.ie_nivel_consciencia)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	(a.ie_nivel_consciencia IS NOT NULL AND a.ie_nivel_consciencia::text <> '')
			and	coalesce(a.dt_inativacao::text, '') = ''
			--and	(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
			and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));

		elsif (nr_sequencia_w = 337) then 											
			select	max(a.IE_COND_SAT_O2)
			into STRICT	ds_resultado_w
			from	atendimento_sinal_vital a
			where	(a.IE_COND_SAT_O2 IS NOT NULL AND a.IE_COND_SAT_O2::text <> '')
			and	coalesce(a.dt_inativacao::text, '') = ''
			--and	(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
			and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));

			if (ds_resultado_w = 'AA') then
				ds_resultado_w := 'N';
			elsif (ds_resultado_w = 'O2') then
				ds_resultado_w := 'S';
			end if;
		end if;
		end;
	elsif (ie_informacao_w = 'Menor') then
		begin
		if (nr_sequencia_w = 12) then
			select	min(a.qt_peso)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	(a.qt_peso IS NOT NULL AND a.qt_peso::text <> '')
			and	coalesce(a.dt_inativacao::text, '') = ''
			--and	(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
			and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
		elsif (nr_sequencia_w = 13) then
			select	min(a.qt_altura_cm)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	(a.qt_peso IS NOT NULL AND a.qt_peso::text <> '')
			and	coalesce(a.dt_inativacao::text, '') = ''
			--and	(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
			and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
		elsif (nr_sequencia_w in (14,23,24)) then
			begin
			open	c05;
			loop
			fetch	c05 into
				qt_pa_sistolica_w,
				qt_pa_diastolica_w,
				qt_pam_w;
			EXIT WHEN NOT FOUND; /* apply on c05 */	
				begin	

				qt_pa_sistolica_w	:= qt_pa_sistolica_w;
				qt_pa_diastolica_w	:= qt_pa_diastolica_w;
				qt_pam_w		:= qt_pam_w;

				end;
			end loop;
			close c05;

			if (nr_sequencia_w = 14) then
				qt_resultado_w	:= qt_pa_sistolica_w;
			elsif (nr_sequencia_w = 23) then
				qt_resultado_w	:= qt_pa_diastolica_w;
			elsif (nr_sequencia_w = 24) then
				qt_resultado_w	:= qt_pam_w;
			end if;

			end;

		elsif (nr_sequencia_w = 15) then
			if (ie_atendimento_w = 'S') then
				select	min(a.qt_freq_cardiaca)
				into STRICT	qt_resultado_w
				from	atendimento_sinal_vital a
				where	(a.qt_freq_cardiaca IS NOT NULL AND a.qt_freq_cardiaca::text <> '')
				and		coalesce(a.dt_inativacao::text, '') = ''
				--and		(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
				and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
				and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
				and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
				and		a.nr_atendimento = nr_atendimento_p;
			elsif (ie_atendimento_w = 'N') then							
				select	min(a.qt_freq_cardiaca)
				into STRICT	qt_resultado_w
				from	atendimento_sinal_vital a
				where	(a.qt_freq_cardiaca IS NOT NULL AND a.qt_freq_cardiaca::text <> '')
				and		coalesce(a.dt_inativacao::text, '') = ''
				--and		(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
				and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
				and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
				and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
				and		exists (SELECT	1
								from	atendimento_paciente b
								where	b.nr_atendimento	= a.nr_atendimento
								and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p);
			end if;
		elsif (nr_sequencia_w = 16) then
			select	min(a.qt_freq_resp)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a

			where	(a.qt_freq_resp IS NOT NULL AND a.qt_freq_resp::text <> '')
			and	coalesce(a.dt_inativacao::text, '') = ''
			--and	(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
			and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
		elsif (nr_sequencia_w = 17) then
			if (ie_atendimento_w = 'S') then
				select	min(a.qt_temp)
				into STRICT	qt_resultado_w
				from	atendimento_sinal_vital a
				where	(a.qt_temp IS NOT NULL AND a.qt_temp::text <> '')
				and		coalesce(a.dt_inativacao::text, '') = ''
				--and		(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
				and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
				and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
				and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
				and		a.nr_atendimento = nr_atendimento_p;
			elsif (ie_atendimento_w = 'N') then
				select	min(a.qt_temp)
				into STRICT	qt_resultado_w
				from	atendimento_sinal_vital a
				where	(a.qt_temp IS NOT NULL AND a.qt_temp::text <> '')
				and		coalesce(a.dt_inativacao::text, '') = ''
				--and		(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
				and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
				and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
				and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
				and	exists (SELECT	1
							from	atendimento_paciente b
							where	b.nr_atendimento	= a.nr_atendimento
							and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p);
			end if;
		elsif (nr_sequencia_w = 18) then
			select	min(a.qt_rel_pao2_fio2)
			into STRICT	qt_resultado_w
			from	atendimento_monit_resp a
			where	(a.qt_rel_pao2_fio2 IS NOT NULL AND a.qt_rel_pao2_fio2::text <> '')
			and	coalesce(a.dt_inativacao::text, '') = ''
			--and	(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_monitorizacao,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_monitorizacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
			and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
		elsif (nr_sequencia_w = 21) then
			select	min(a.qt_pvc)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	(a.qt_pvc IS NOT NULL AND a.qt_pvc::text <> '')
			and	coalesce(a.dt_inativacao::text, '') = ''
			--and	(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
			and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
		elsif (nr_sequencia_w = 56) then
			select	min(a.qt_bcf)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	(a.qt_bcf IS NOT NULL AND a.qt_bcf::text <> '')
			and	coalesce(a.dt_inativacao::text, '') = ''
			--and	(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
			and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));									
		elsif (nr_sequencia_w = 94) then
			select	min(a.QT_FIO2)
			into STRICT	qt_resultado_w
			from	atendimento_monit_resp a
			where	(a.QT_FIO2 IS NOT NULL AND a.QT_FIO2::text <> '')
			and	coalesce(a.dt_inativacao::text, '') = ''
			--and	(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_monitorizacao,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_monitorizacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
			and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
		elsif (nr_sequencia_w = 232) then
			select	min(a.ie_nivel_consciencia)
			into STRICT	qt_resultado_w
			from	atendimento_sinal_vital a
			where	(a.ie_nivel_consciencia IS NOT NULL AND a.ie_nivel_consciencia::text <> '')
			and	coalesce(a.dt_inativacao::text, '') = ''
			--and	(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
			and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));

		elsif (nr_sequencia_w = 337) then 												
			select	min(a.IE_COND_SAT_O2)
			into STRICT	ds_resultado_w
			from	atendimento_sinal_vital a
			where	(a.IE_COND_SAT_O2 IS NOT NULL AND a.IE_COND_SAT_O2::text <> '')
			and	coalesce(a.dt_inativacao::text, '') = ''
			--and	(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_sinal_vital,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_sinal_vital) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
			and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));

			if (ds_resultado_w = 'AA') then
				ds_resultado_w := 'N';
			elsif (ds_resultado_w = 'O2') then
				ds_resultado_w := 'S';
			end if;
		end if;
		end;
	elsif (ie_informacao_w = 'MaiorIndice') then
		if (nr_sequencia_w	= 14) then
			open C12;
			loop
			fetch C12 into	
				qt_resultado_w;
			EXIT WHEN NOT FOUND; /* apply on C12 */
			end loop;
			close C12;
		elsif (nr_sequencia_w	 = 15) then
			open C13;
			loop
			fetch C13 into	
				qt_resultado_w;
			EXIT WHEN NOT FOUND; /* apply on C13 */
			end loop;
			close C13;
		elsif (nr_sequencia_w	= 16) then

			open C14;
			loop
			fetch C14 into	
				qt_resultado_w;
			EXIT WHEN NOT FOUND; /* apply on C14 */
			end loop;
			close C14;
		elsif (nr_sequencia_w		= 17) then
			open C15;
			loop
			fetch C15 into	
				qt_resultado_w;
			EXIT WHEN NOT FOUND; /* apply on C15 */
			end loop;
			close C15;
		elsif (nr_sequencia_w		= 23) then
			open C16;
			loop
			fetch C16 into	
				qt_resultado_w;
			EXIT WHEN NOT FOUND; /* apply on C16 */
			end loop;
			close C16;
		elsif (nr_sequencia_w		= 24) then
			open C17;
			loop
			fetch C17 into	
				qt_resultado_w;
			EXIT WHEN NOT FOUND; /* apply on C17 */
			end loop;
			close C17;
		elsif (nr_sequencia_w		= 232) then
			open C18;
			loop
			fetch C18 into	
				qt_resultado_w;
			EXIT WHEN NOT FOUND; /* apply on C18 */
			end loop;
			close C18;
		elsif (nr_sequencia_w		= 337) then												
			open C19;
			loop
			fetch C19 into	
				ds_resultado_w;
			EXIT WHEN NOT FOUND; /* apply on C19 */
			end loop;
			close C19;						
			if (ds_resultado_w = 'AA') then
				ds_resultado_w := 'N';
			elsif (ds_resultado_w = 'O2') then
				ds_resultado_w := 'S';
			end if;
		end if;
	end if;	
	end;
elsif (ie_origem_w = 'EL') then
	begin
	if (ie_informacao_w = 'Primeira') then
		begin

		open	c03;
		loop
		fetch	c03 into
			qt_result_w,
			pr_result_w,
			dt_resultado_w,
			ds_result_w;
		EXIT WHEN NOT FOUND; /* apply on c03 */	
			begin	

			if (nm_tabela_p = 'ESCALA_SOFA') and (nm_atributo_p = 'QT_PLAQUETAS') then
				qt_result_w := qt_result_w/1000;
			end if;

			if (coalesce(qt_result_w,0) <> 0) then
				qt_resultado_w	:= qt_result_w;
				ds_resultado2_p	:= to_char(dt_resultado_w,'dd/mm/yyyy hh24:mi:ss');
			elsif (ds_result_w IS NOT NULL AND ds_result_w::text <> '') then
				ds_resultado_p	:= ds_result_w;
				ds_resultado2_p	:= to_char(dt_resultado_w,'dd/mm/yyyy hh24:mi:ss');
			end if;	

			if (coalesce(pr_result_w,0) <> 0) then
				pr_resultado_w	:= pr_result_w;
				ds_resultado2_p	:= to_char(dt_resultado_w,'dd/mm/yyyy hh24:mi:ss');
			end if;		
				end;
		end loop;
		close c03;
		end;
	elsif (ie_informacao_w = 'Ultima') then
		begin
		open	c02;
		loop
		fetch	c02 into
			qt_result_w,
			pr_result_w,
			dt_resultado_w,
			ds_result_w,
			dt_ordem_w;
		EXIT WHEN NOT FOUND; /* apply on c02 */	
			begin
			if (nm_tabela_p = 'ESCALA_SOFA') and (nm_atributo_p = 'QT_PLAQUETAS') then
				qt_result_w := qt_result_w/1000;
			end if;

			if (coalesce(qt_result_w,0) <> 0) then
				qt_resultado_w	:= qt_result_w;
				ds_resultado2_p	:= to_char(dt_resultado_w,'dd/mm/yyyy hh24:mi:ss');
			elsif (ds_result_w IS NOT NULL AND ds_result_w::text <> '') then
				ds_resultado_p	:= ds_result_w;
				ds_resultado2_p	:= to_char(dt_resultado_w,'dd/mm/yyyy hh24:mi:ss');
			end if;	

			if (coalesce(pr_result_w,0) <> 0) then
				pr_resultado_w	:= pr_result_w;
				ds_resultado2_p	:= to_char(dt_resultado_w,'dd/mm/yyyy hh24:mi:ss');
			end if;	
			end;
		end loop;
		close c02;
		end;
	elsif (ie_informacao_w	= 'MaiorIndice') then
		begin
		open	c10;
		loop
		fetch	c10 into
			qt_result_w,
			pr_result_w,
			dt_resultado_w,
			ds_result_w;
		EXIT WHEN NOT FOUND; /* apply on c10 */
			begin

			if (nm_tabela_p = 'ESCALA_SOFA') and (nm_atributo_p = 'QT_PLAQUETAS') then
				qt_result_w := qt_result_w/1000;
			end if;

			if (coalesce(qt_result_w,0) <> 0) then
				qt_resultado_w	:= qt_result_w;
				ds_resultado2_p	:= to_char(dt_resultado_w,'dd/mm/yyyy hh24:mi:ss');
			elsif (ds_result_w IS NOT NULL AND ds_result_w::text <> '') then
				ds_resultado_p	:= ds_result_w;
				ds_resultado2_p	:= to_char(dt_resultado_w,'dd/mm/yyyy hh24:mi:ss');
			end if;				

			if (coalesce(pr_result_w,0) <> 0) then
				pr_resultado_w	:= pr_result_w;
				ds_resultado2_p	:= to_char(dt_resultado_w,'dd/mm/yyyy hh24:mi:ss');
			end if;		
				end;
		end loop;
		close c10;
		end;
	elsif (ie_informacao_w = 'Maior') then
		begin
		open C06;
		loop
		fetch C06 into	
			qt_resultado_w,
			dt_resultado_w,
			ds_result_w;
		EXIT WHEN NOT FOUND; /* apply on C06 */
			begin

			if (nm_tabela_p = 'ESCALA_SOFA') and (nm_atributo_p = 'QT_PLAQUETAS') then
				qt_resultado_w := qt_resultado_w/1000;
			end if;

			qt_resultado_w	:= qt_resultado_w;
			ds_resultado_p	:= ds_result_w;
			dt_resultado_w	:= dt_resultado_w;
			ds_resultado2_p	:= to_char(dt_resultado_w,'dd/mm/yyyy hh24:mi:ss');
			exit;
			end;
		end loop;
		close C06;


		if (ie_result_exame_w	= 'P') then
			open C07;
			loop
			fetch C07 into	
				qt_resultado_w,
				dt_resultado_por_w,
				ds_result_w;
			EXIT WHEN NOT FOUND; /* apply on C07 */
				begin

				if (nm_tabela_p = 'ESCALA_SOFA') and (nm_atributo_p = 'QT_PLAQUETAS') then
					qt_resultado_w := qt_resultado_w/1000;
				end if;

				qt_resultado_w		:= qt_resultado_w;
				ds_resultado_p		:= ds_result_w;
				dt_resultado_por_w	:= dt_resultado_por_w;
				exit;
				end;
			end loop;
			close C07;
		end if;
		end;
	elsif (ie_informacao_w = 'Menor') then
		begin

		open C08;
		loop
		fetch C08 into	
			qt_resultado_w,
			dt_resultado_w,
			ds_result_w;
		EXIT WHEN NOT FOUND; /* apply on C08 */
			begin

			if (nm_tabela_p = 'ESCALA_SOFA') and (nm_atributo_p = 'QT_PLAQUETAS') then
				qt_resultado_w := qt_resultado_w/1000;
			end if;

			qt_resultado_w	:= qt_resultado_w;
			ds_resultado_p	:= ds_result_w;
			dt_resultado_w	:= dt_resultado_w;
			ds_resultado2_p	:= to_char(dt_resultado_w,'dd/mm/yyyy hh24:mi:ss');
			exit;
			end;
		end loop;
		close C08;

		if (ie_result_exame_w	= 'P') then
			open C09;
			loop
			fetch C09 into	
				qt_resultado_w,
				dt_resultado_por_w,
				ds_result_w;
			EXIT WHEN NOT FOUND; /* apply on C09 */
				begin

				if (nm_tabela_p = 'ESCALA_SOFA') and (nm_atributo_p = 'QT_PLAQUETAS') then
					qt_resultado_w := qt_resultado_w/1000;
				end if;

				qt_resultado_w		:= qt_resultado_w;
				ds_resultado_p		:= ds_result_w;
				dt_resultado_por_w	:= dt_resultado_por_w;
				exit;
				end;
			end loop;
			close C09;
		end if;
		end;
	end if;
	if (ie_result_exame_w = 'P') then
		qt_resultado_w	:= pr_resultado_w;
		ds_resultado2_p	:= to_char(dt_resultado_por_w,'dd/mm/yyyy hh24:mi:ss');
	end if;
	end;
elsif (ie_origem_w = 'ESC') then
	begin
	if (ie_informacao_w = 'Primeira') then
		begin
		if (nr_sequencia_w = 22) then
			select	max(a.qt_glasgow)
			into STRICT	qt_resultado_w
			from	atend_escala_indice a
			where	a.nr_sequencia	in (	SELECT	min(b.nr_sequencia)
										from	atend_escala_indice b
										where	(b.qt_glasgow IS NOT NULL AND b.qt_glasgow::text <> '')
										and		coalesce(b.dt_inativacao::text, '') = ''
										and		(b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '')
										--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_avaliacao,ie_regra_restringir_w) = 'S')
										and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_avaliacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
										and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
										and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p)
										
union

										SELECT	min(b.nr_sequencia)
										from	atend_escala_indice b
										where	(b.qt_glasgow IS NOT NULL AND b.qt_glasgow::text <> '')
										and		coalesce(b.dt_inativacao::text, '') = ''
										and		(b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '')
										--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_avaliacao,ie_regra_restringir_w) = 'S')
										and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_avaliacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
										and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
										and (ie_atendimento_w = 'N' and exists (select	1
																					from	atendimento_paciente c
																					where	c.nr_atendimento = b.nr_atendimento
																					and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));

		elsif (nr_sequencia_w = 349) then
			select	max(a.qt_semanas)
			into STRICT	qt_resultado_w
			from	escala_capurro a
			where	a.nr_sequencia	in (	SELECT	min(b.nr_sequencia)
										from	escala_capurro b
										where	(b.qt_semanas IS NOT NULL AND b.qt_semanas::text <> '')
										and		coalesce(b.dt_inativacao::text, '') = ''
										and		(b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '')
										--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_avaliacao,ie_regra_restringir_w) = 'S')
										and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_avaliacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
										--and		(a.cd_setor_atendimento	= cd_setor_atendimento_w  or cd_setor_atendimento_w is null)
										and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p)
										
union

										SELECT	min(b.nr_sequencia)
										from	escala_capurro b
										where	(b.qt_semanas IS NOT NULL AND b.qt_semanas::text <> '')
										and		coalesce(b.dt_inativacao::text, '') = ''
										and		(b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '')
										--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_avaliacao,ie_regra_restringir_w) = 'S')
										and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_avaliacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
										--and		(a.cd_setor_atendimento	= cd_setor_atendimento_w  or cd_setor_atendimento_w is null)
										and (ie_atendimento_w = 'N' and exists (select	1
																					from	atendimento_paciente c
																					where	c.nr_atendimento = b.nr_atendimento
																					and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
		elsif (nr_sequencia_w = 350) then
			select	max(a.QT_DIAS)
			into STRICT	qt_resultado_w
			from	escala_capurro a
			where	a.nr_sequencia	in (	SELECT	min(b.nr_sequencia)
										from	escala_capurro b
										where	(b.QT_DIAS IS NOT NULL AND b.QT_DIAS::text <> '')
										and		coalesce(b.dt_inativacao::text, '') = ''
										and		(b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '')
										--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_avaliacao,ie_regra_restringir_w) = 'S')
										and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_avaliacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
										--and		(a.cd_setor_atendimento	= cd_setor_atendimento_w  or cd_setor_atendimento_w is null)
										and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p)
										
union

										SELECT	min(b.nr_sequencia)
										from	escala_capurro b
										where	(b.QT_DIAS IS NOT NULL AND b.QT_DIAS::text <> '')
										and		coalesce(b.dt_inativacao::text, '') = ''
										and		(b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '')
										--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_avaliacao,ie_regra_restringir_w) = 'S')
										and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_avaliacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
										--and		(a.cd_setor_atendimento	= cd_setor_atendimento_w  or cd_setor_atendimento_w is null)
										and (ie_atendimento_w = 'N' and exists (select	1
																					from	atendimento_paciente c
																					where	c.nr_atendimento = b.nr_atendimento
																					and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
		end if;
		end;
	elsif (ie_informacao_w = 'Ultima') then
		begin
		if (nr_sequencia_w = 22) then


			if (ie_atendimento_w = 'N') then
				select	max(b.nr_sequencia)
				into STRICT	nr_seq_registro_w
				from	atend_escala_indice b,
						atendimento_paciente c
				where	b.nr_atendimento = c.nr_atendimento
				and		c.cd_pessoa_fisica = cd_pessoa_fisica_p
				and		(b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '')
				and		coalesce(b.dt_inativacao::text, '') = ''
				and		(b.qt_glasgow IS NOT NULL AND b.qt_glasgow::text <> '')
				and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_avaliacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
				and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (b.cd_setor_atendimento = cd_setor_atendimento_w));
			else
				select	max(b.nr_sequencia)
				into STRICT	nr_seq_registro_w
				from	atend_escala_indice b
				where	b.nr_atendimento = nr_atendimento_p
				and		(b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '')
				and		coalesce(b.dt_inativacao::text, '') = ''
				and		(b.qt_glasgow IS NOT NULL AND b.qt_glasgow::text <> '')
				and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_avaliacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
				and		((coalesce(cd_setor_atendimento_w::text, '') = '') or (b.cd_setor_atendimento = cd_setor_atendimento_w));

			end if;

			if (nr_seq_registro_w IS NOT NULL AND nr_seq_registro_w::text <> '') then
				select	max(a.qt_glasgow)
				into STRICT	qt_resultado_w
				from	atend_escala_indice a
				where	a.nr_sequencia	= nr_seq_registro_w;
			end if;


	elsif (nr_sequencia_w = 251) then
			select	max(QT_COCKCROFT_GAULT)
			into STRICT	qt_resultado_w
			from	PAC_CLEREANCE_CREATININA a
			where	a.nr_sequencia	= (	SELECT	max(b.nr_sequencia)
							from	PAC_CLEREANCE_CREATININA b
							where	(b.QT_COCKCROFT_GAULT IS NOT NULL AND b.QT_COCKCROFT_GAULT::text <> '')
							--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.DT_REGISTRO,ie_regra_restringir_w) = 'S')
							and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.DT_REGISTRO) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							--and	(b.cd_setor_atendimento	= cd_setor_atendimento_w  or cd_setor_atendimento_w is null)
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));

		elsif (nr_sequencia_w = 252) then
			select	max(QT_MDRD)
			into STRICT	qt_resultado_w
			from	PAC_CLEREANCE_CREATININA a
			where	a.nr_sequencia	= (	SELECT	max(b.nr_sequencia)
							from	PAC_CLEREANCE_CREATININA b
							where	(b.QT_MDRD IS NOT NULL AND b.QT_MDRD::text <> '')
							--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.DT_REGISTRO,ie_regra_restringir_w) = 'S')
							and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.DT_REGISTRO) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							--and	(b.cd_setor_atendimento	= cd_setor_atendimento_w  or cd_setor_atendimento_w is null)
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
		elsif (nr_sequencia_w = 253) then
			select	max(QT_JELLIFFE)
			into STRICT	qt_resultado_w
			from	PAC_CLEREANCE_CREATININA a
			where	a.nr_sequencia	= (	SELECT	max(b.nr_sequencia)
							from	PAC_CLEREANCE_CREATININA b
							where	(b.QT_JELLIFFE IS NOT NULL AND b.QT_JELLIFFE::text <> '')
							--and	(OBTER_SE_REGRA_INF_ATRIBUTO(b.DT_REGISTRO,ie_regra_restringir_w) = 'S')
							and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.DT_REGISTRO) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							--and	(b.cd_setor_atendimento	= cd_setor_atendimento_w  or cd_setor_atendimento_w is null)
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
		elsif (nr_sequencia_w = 349) then
			select	max(QT_SEMANAS)
			into STRICT	qt_resultado_w
			from	escala_capurro a
			where	a.nr_sequencia	= (	SELECT	max(b.nr_sequencia)
										from	escala_capurro b
										where	(b.qt_semanas IS NOT NULL AND b.qt_semanas::text <> '')
										and		coalesce(b.dt_inativacao::text, '') = ''
										and		(b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '')
										--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_Avaliacao,ie_regra_restringir_w) = 'S')
										and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_Avaliacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
										and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
										--and		(b.cd_setor_atendimento	= cd_setor_atendimento_w  or cd_setor_atendimento_w is null)
										and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
																						from	atendimento_paciente c
																						where	c.nr_atendimento = b.nr_atendimento
																						and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
	   elsif (nr_sequencia_w = 350) then
			select	max(QT_DIAS)
			into STRICT	qt_resultado_w
			from	escala_capurro a
			where	a.nr_sequencia	= (	SELECT	max(b.nr_sequencia)
										from	escala_capurro b
										where	(b.QT_DIAS IS NOT NULL AND b.QT_DIAS::text <> '')
										and		coalesce(b.dt_inativacao::text, '') = ''
										and		(b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '')
										--and		(OBTER_SE_REGRA_INF_ATRIBUTO(b.dt_Avaliacao,ie_regra_restringir_w) = 'S')
										and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(b.dt_Avaliacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
										and		((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
										--and		(b.cd_setor_atendimento	= cd_setor_atendimento_w  or cd_setor_atendimento_w is null)
										and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
																						from	atendimento_paciente c
																						where	c.nr_atendimento = b.nr_atendimento
																						and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
		end if;
		end;
	elsif (ie_informacao_w = 'Maior') then
		begin
		if (nr_sequencia_w = 22) then
			if (ie_atendimento_w = 'S') then
				select	max(a.qt_glasgow)
				into STRICT	qt_resultado_w
				from	atend_escala_indice a
				where	(a.qt_glasgow IS NOT NULL AND a.qt_glasgow::text <> '')
				and		coalesce(a.dt_inativacao::text, '') = ''
				and		(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
				--and		(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_avaliacao,ie_regra_restringir_w) = 'S')
				and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_avaliacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
				and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
				and		a.nr_atendimento = nr_atendimento_p;

			elsif (ie_atendimento_w = 'N') then
				select	max(a.qt_glasgow)
				into STRICT	qt_resultado_w
				from	atend_escala_indice a
				where	(a.qt_glasgow IS NOT NULL AND a.qt_glasgow::text <> '')
				and		coalesce(a.dt_inativacao::text, '') = ''
				and		(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
				--and		(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_avaliacao,ie_regra_restringir_w) = 'S')
				and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_avaliacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
				and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
				and	exists (SELECT	1
							from	atendimento_paciente b
							where	b.nr_atendimento	= a.nr_atendimento
							and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p);
			end if;
		end if;
		end;
	elsif (ie_informacao_w = 'Menor') then
		begin
		if (nr_sequencia_w = 22) then
			if (ie_atendimento_w = 'S') then
				select	min(a.qt_glasgow)
				into STRICT	qt_resultado_w
				from	atend_escala_indice a
				where	(a.qt_glasgow IS NOT NULL AND a.qt_glasgow::text <> '')
				and		coalesce(a.dt_inativacao::text, '') = ''
				and		(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
				--and		(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_avaliacao,ie_regra_restringir_w) = 'S')
				and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_avaliacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
				and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
				and		a.nr_atendimento = nr_atendimento_p;									
			elsif (ie_atendimento_w = 'N') then
				select	min(a.qt_glasgow)
				into STRICT	qt_resultado_w
				from	atend_escala_indice a
				where	(a.qt_glasgow IS NOT NULL AND a.qt_glasgow::text <> '')
				and		coalesce(a.dt_inativacao::text, '') = ''
				and		(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
				--and		(OBTER_SE_REGRA_INF_ATRIBUTO(a.dt_avaliacao,ie_regra_restringir_w) = 'S')
				and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(a.dt_avaliacao) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
				and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
				and	exists (SELECT	1
							from	atendimento_paciente b
							where	b.nr_atendimento	= a.nr_atendimento
							and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p);
			end if;

		end if;
		end;
	end if;
	end;
elsif (ie_origem_w = 'MH') then
	begin
	if (ie_informacao_w = 'Primeira') then
		begin
		if (nr_sequencia_w = 148) then
			select	min(a.qt_peso)
			into STRICT	qt_resultado_w
			from	atend_monit_hemod a
			where	a.nr_sequencia	= (	SELECT	min(b.nr_sequencia)
							from	atend_monit_hemod b
							where	(b.qt_peso IS NOT NULL AND b.qt_peso::text <> '')
							and	coalesce(b.dt_inativacao::text, '') = ''
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));		
		end if;													
		end;
	elsif (ie_informacao_w = 'Ultima') then
		begin
		if (nr_sequencia_w = 148) then
			select	max(a.qt_peso)
			into STRICT	qt_resultado_w
			from	atend_monit_hemod a
			where	a.nr_sequencia	= (	SELECT	max(b.nr_sequencia)
							from	atend_monit_hemod b
							where	(b.qt_peso IS NOT NULL AND b.qt_peso::text <> '')
							and	coalesce(b.dt_inativacao::text, '') = ''
							and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
							and (b.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
		end if;
		end;
	elsif (ie_informacao_w = 'Maior') then
		begin
		if (nr_sequencia_w = 148) then
			select	max(a.qt_peso)
			into STRICT	qt_resultado_w
			from	atend_monit_hemod a
			where	(a.qt_peso IS NOT NULL AND a.qt_peso::text <> '')
			and	coalesce(a.dt_inativacao::text, '') = ''			
			and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
			and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));		
		end if;
		end;
	elsif (ie_informacao_w = 'Menor') then
		begin
		if (nr_sequencia_w = 148) then
			select	min(a.qt_peso)
			into STRICT	qt_resultado_w
			from	atend_monit_hemod a
			where	(a.qt_peso IS NOT NULL AND a.qt_peso::text <> '')
			and	coalesce(a.dt_inativacao::text, '') = ''
			and	((ie_sv_liberados_w = 'N') or (ie_sv_liberados_w = 'S' AND a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
			and (a.cd_setor_atendimento	= cd_setor_atendimento_w  or coalesce(cd_setor_atendimento_w::text, '') = '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));		
		end if;
		end;		
	end if;	
	end;
elsif (ie_origem_w = 'GL') then
	begin
	if (ie_informacao_w = 'Primeira') then
		begin
		if (nr_sequencia_w = 189) then
			select	min(a.qt_hgt)
			into STRICT	qt_resultado_w
			from	atendimento_cig a
			where	a.nr_sequencia	= (	SELECT	min(b.nr_sequencia)
							from	 atendimento_cig b
							where	 (b.qt_hgt IS NOT NULL AND b.qt_hgt::text <> '')
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
		end if;													
		end;
	elsif (ie_informacao_w = 'Ultima') then
		begin
		if (nr_sequencia_w = 189) then
			select	max(a.qt_hgt)
			into STRICT	qt_resultado_w
			from	atendimento_cig a
			where	a.nr_sequencia	= (	SELECT	max(b.nr_sequencia)
							from	atendimento_cig b
							where	(b.qt_hgt IS NOT NULL AND b.qt_hgt::text <> '')
							and (ie_atendimento_w = 'S' and b.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	select	1
													from	atendimento_paciente c
													where	c.nr_atendimento = b.nr_atendimento
													and	c.cd_pessoa_fisica = cd_pessoa_fisica_p)));
		end if;
		end;
	elsif (ie_informacao_w = 'Maior') then
		begin
		if (nr_sequencia_w = 189) then
			select	max(a.qt_hgt)
			into STRICT	qt_resultado_w
			from	atendimento_cig a
			where	(a.qt_hgt IS NOT NULL AND a.qt_hgt::text <> '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));		
		end if;
		end;
	elsif (ie_informacao_w = 'Menor') then
		begin
		if (nr_sequencia_w = 189) then
			select	min(a.qt_hgt)
			into STRICT	qt_resultado_w
			from	atendimento_cig a
			where	(a.qt_hgt IS NOT NULL AND a.qt_hgt::text <> '')
			and (ie_atendimento_w = 'S' and a.nr_atendimento = nr_atendimento_p) or (ie_atendimento_w = 'N' and exists (	SELECT	1
									from	atendimento_paciente b
									where	b.nr_atendimento	= a.nr_atendimento
									and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p));		
		end if;
		end;		
	end if;	
	end;

elsif (ie_origem_w = 'GP') then
	begin
	nr_seq_tipo_pg_ww := substr(nr_seq_tipo_pg_ww,1,length(nr_seq_tipo_pg_ww)-1);
	if (nr_sequencia_w = 283) then

		select	coalesce(max(ie_liberar_ganho_perda),'N')
		into STRICT	ie_liberar_ganho_perda_w
		from	parametro_medico
		where	cd_estabelecimento = cd_estabelecimento_p;

		if (ie_forma_ganho_perda_w = 'V') then -- Volume(ml)
			select	sum(CASE WHEN a.ie_perda_ganho='G' THEN  c.qt_volume  ELSE 0 END  - CASE WHEN a.ie_perda_ganho='P' THEN  c.qt_volume  ELSE 0 END )
			into STRICT	qt_resultado_w
			from	tipo_perda_ganho b,
					grupo_perda_ganho a,
					atendimento_perda_ganho c
			where	((ie_atendimento_w = 'S' AND c.nr_atendimento = nr_atendimento_p) or
					((ie_atendimento_w = 'N') and exists (SELECT	1
														  from	atendimento_paciente d
														  where	d.nr_atendimento	= c.nr_atendimento
														  and	d.cd_pessoa_fisica	= cd_pessoa_fisica_p)))
			and 	obter_se_valor_contido(nr_seq_tipo,nr_seq_tipo_pg_ww) = 'S'
			and		((obter_classif_setor(cd_setor_atendimento) = cd_classif_setor_w) or (coalesce(cd_classif_setor_w::text, '') = ''))
			and		((cd_setor_atendimento = cd_setor_atendimento) or (coalesce(cd_setor_atendimento_w::text, '') = ''))
			--and		(OBTER_SE_REGRA_INF_ATRIBUTO(dt_medida,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(dt_medida) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and	   	c.nr_seq_tipo = b.nr_sequencia
			and	   	b.nr_seq_grupo = a.nr_sequencia
			and     coalesce(b.ie_soma_bh,'S') = 'S'
			and     ((ie_liberar_ganho_perda_w = 'N') OR (c.dt_liberacao IS NOT NULL AND c.dt_liberacao::text <> ''))
			and		coalesce(c.dt_inativacao::text, '') = ''
			and     c.DT_REFERENCIA between clock_timestamp() - interval '1 days' and clock_timestamp() 
			and     coalesce(c.ie_situacao,'A') = 'A';

		elsif (ie_forma_ganho_perda_w = 'P') then -- Peso(g)
			select	sum(qt_peso)
			into STRICT	qt_resultado_w
			from 	atendimento_perda_ganho a
			where	((ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) or
					((ie_atendimento_w = 'N') and exists (SELECT	1
														  from	atendimento_paciente b
														  where	b.nr_atendimento	= a.nr_atendimento
														  and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p)))
			and 	obter_se_valor_contido(nr_seq_tipo,nr_seq_tipo_pg_ww) = 'S'
			and		((obter_classif_setor(cd_setor_atendimento) = cd_classif_setor_w) or (coalesce(cd_classif_setor_w::text, '') = ''))
			and		((cd_setor_atendimento = cd_setor_atendimento) or (coalesce(cd_setor_atendimento_w::text, '') = ''))
			--and		(OBTER_SE_REGRA_INF_ATRIBUTO(dt_medida,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(dt_medida) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and     ((ie_liberar_ganho_perda_w = 'N') OR (dt_liberacao IS NOT NULL AND dt_liberacao::text <> ''))
			and     a.DT_REFERENCIA between clock_timestamp() - interval '1 days' and clock_timestamp()
			and		coalesce(dt_inativacao::text, '') = '';
		elsif (ie_forma_ganho_perda_w = 'O') then -- Ocorrencias,
			select	sum(qt_ocorrencia)
			into STRICT	qt_resultado_w
			from 	atendimento_perda_ganho a
			where	((ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) or
					((ie_atendimento_w = 'N') and exists (SELECT	1
														  from	atendimento_paciente b
														  where	b.nr_atendimento	= a.nr_atendimento
														  and	b.cd_pessoa_fisica	= cd_pessoa_fisica_p)))
			and 	obter_se_valor_contido(nr_seq_tipo,nr_seq_tipo_pg_ww) = 'S'
			and		((obter_classif_setor(cd_setor_atendimento) = cd_classif_setor_w) or (coalesce(cd_classif_setor_w::text, '') = ''))
			and		((cd_setor_atendimento = cd_setor_atendimento) or (coalesce(cd_setor_atendimento_w::text, '') = ''))
			--and		(OBTER_SE_REGRA_INF_ATRIBUTO(dt_medida,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(dt_medida) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and     ((ie_liberar_ganho_perda_w = 'N') OR (dt_liberacao IS NOT NULL AND dt_liberacao::text <> ''))
			and     a.DT_REFERENCIA between clock_timestamp() - interval '1 days' and clock_timestamp()
			and		coalesce(dt_inativacao::text, '') = '';		
		elsif (ie_forma_ganho_perda_w = 'D') then -- Volume total (ml)
			select	sum(CASE WHEN a.ie_perda_ganho='G' THEN  c.qt_volume  ELSE 0 END  - CASE WHEN a.ie_perda_ganho='P' THEN  c.qt_volume  ELSE 0 END )
			into STRICT	qt_resultado_w
			from	tipo_perda_ganho b,
					grupo_perda_ganho a,
					atendimento_perda_ganho c
			where	((ie_atendimento_w = 'S' AND c.nr_atendimento = nr_atendimento_p) or
					((ie_atendimento_w = 'N') and exists (SELECT	1
														  from	atendimento_paciente d
														  where	d.nr_atendimento	= c.nr_atendimento
														  and	d.cd_pessoa_fisica	= cd_pessoa_fisica_p)))
			---and 	c.nr_seq_tipo  = nr_seq_tipo_pg_w
			and		((obter_classif_setor(cd_setor_atendimento) = cd_classif_setor_w) or (coalesce(cd_classif_setor_w::text, '') = ''))
			and		((cd_setor_atendimento = cd_setor_atendimento) or (coalesce(cd_setor_atendimento_w::text, '') = ''))
			--and		(OBTER_SE_REGRA_INF_ATRIBUTO(dt_medida,ie_regra_restringir_w) = 'S')
			and		((ie_regra_restringir_w = 'N') or ((ie_regra_restringir_w = 'A') and (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(dt_medida) = ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(clock_timestamp() - interval '1 days'))))
			and	   	c.nr_seq_tipo = b.nr_sequencia
			and	   	b.nr_seq_grupo = a.nr_sequencia
			and     coalesce(b.ie_soma_bh,'S') = 'S'
			and     ((ie_liberar_ganho_perda_w = 'N') OR (c.dt_liberacao IS NOT NULL AND c.dt_liberacao::text <> ''))
			and		coalesce(c.dt_inativacao::text, '') = ''
			and     c.DT_REFERENCIA between clock_timestamp() - interval '1 days' and clock_timestamp() 
			and     coalesce(c.ie_situacao,'A') = 'A';

		end if;
		--Volume = V ou Volume total (ml) = D
		if (ie_forma_ganho_perda_w in ('V','D')) and (nm_tabela_p = 'ESCALA_SAPS') then
			select trunc(qt_resultado_w/1000, 2) qt_resultado 
			into STRICT qt_resultado_w
			; --Convert ml/litros
		end if;

	end if;	
	end;	

end if;



ds_resultado_p	:= coalesce(to_char(qt_resultado_w),coalesce(ds_resultado_w,ds_resultado_p));


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_informacao_atributo ( cd_estabelecimento_p bigint, cd_empresa_p bigint, nr_atendimento_p bigint, cd_pessoa_fisica_p text, nm_tabela_p text, nm_atributo_p text, ds_resultado_p INOUT text, ds_resultado2_p INOUT text) FROM PUBLIC;

