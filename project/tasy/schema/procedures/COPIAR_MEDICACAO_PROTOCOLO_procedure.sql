-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copiar_medicacao_protocolo ( cd_protocolo_origem_p bigint, nr_seq_origem_p bigint, nm_usuario_p text, cd_protocolo_dest_p bigint, nr_seq_destino_p bigint, ie_deletar_anteriores_p text default 'S', ie_dieta_p text DEFAULT NULL, ie_solucao_p text DEFAULT NULL, ie_medicamento_p text DEFAULT NULL, ie_material_p text DEFAULT NULL, ie_proc_exame_p text DEFAULT NULL, ie_recomendacao_p text DEFAULT NULL, ie_hemodialise_p text DEFAULT NULL, ie_delegacao_p text DEFAULT NULL, ie_categoria_topograf_p text DEFAULT NULL, ie_banco_sangue_p text DEFAULT NULL, ie_gasoterapia_p text DEFAULT NULL, ie_dispositivos_p text DEFAULT NULL,--tratar
 copiar_duracao_dia_trat_p text DEFAULT NULL, ie_frases_padroes_p text DEFAULT NULL) AS $body$
DECLARE


nr_seq_origem_w		bigint;
nr_seq_destino_w	bigint;
nr_seq_hd_prescr_w	bigint;
nr_seq_solucao_w	bigint;
nr_seq_solucao_origem_w	bigint;
nr_seq_solucao_dest_w	bigint;
nr_seq_medic_solucao_w	protocolo_medic_solucao.nr_seq_interno%type;
nr_seq_medic_w		bigint;
nr_seq_elemento_w	bigint;
nr_seq_material_origem_w	bigint;
nr_seq_material_dest_w	bigint;
nr_seq_material_dest2_w	bigint;
cd_unidade_medida_w	varchar(30);
qt_elemento_w		double precision;
ds_subtipo_w		text;
nr_seq_diluicao_w	bigint;

ie_tipo_hemodialise_w	varchar(15);
qt_sessao_sem_w		smallint;
qt_hora_sessao_w	smallint;
qt_min_sessao_w		smallint;
qt_fluxo_sangue_w	double precision;
nr_seq_mod_dialisador_w	bigint;
ie_ultrafiltracao_w	varchar(15);
qt_ultrafiltracao_w	double precision;
ie_tipo_dialise_w	varchar(1);
ie_tipo_peritoneal_w	varchar(15);
nr_seq_maq_cicladora_w	bigint;
qt_volume_total_w	double precision;
dt_status_w		timestamp;
ie_status_w		varchar(15);
cd_kit_material_origem_w	bigint;
cd_kit_material_dest_w		bigint;
nr_seq_prot_solic_bco_san_o_w	bigint;
nr_seq_prot_solic_bco_san_d_w	bigint;
nr_seq_prot_hd_prescricao_o_w	bigint;
ie_tipo_dialise_prot_hd_pr_w	varchar(3);
nr_seq_gasoterapia_origem_w	bigint;
nr_seq_gasoterapia_destino_w	bigint;
nr_seq_grupo_w			bigint;
nr_seq_prot_dest_w		bigint;
nr_seq_grupo_ww			bigint;
ie_exige_grupo_w		varchar(1);
nr_seq_subtipo_w		bigint;
nm_coluna_w			varchar(255);
ds_colunas_w			varchar(5000);
ds_insert_w			varchar(5000);

/* obter sequ?ncia nr_seq_solucao e nr_seq_medic */

c01 CURSOR FOR
	SELECT	nr_seq_solucao
	from	protocolo_medic_solucao
	where	cd_protocolo	= cd_protocolo_origem_p
	and	nr_sequencia	= nr_seq_origem_p
	and	coalesce(nr_seq_dialise::text, '') = '';

c02 CURSOR FOR
	SELECT	nr_seq_material
	from	protocolo_medic_material
	where 	cd_protocolo	= cd_protocolo_origem_p
	and		nr_sequencia	= nr_seq_origem_p
	and		nr_seq_solucao	= nr_seq_solucao_origem_w
	and		coalesce(nr_seq_gas::text, '') = ''
	and 	coalesce(nr_seq_diluicao::text, '') = '';

c03 CURSOR FOR
	SELECT	nr_sequencia
	from	prot_solic_bco_sangue
	where	cd_protocolo		= cd_protocolo_origem_p
	and		nr_seq_protocolo	= nr_seq_origem_p;

c04 CURSOR FOR
	SELECT	cd_kit_material
	from	kit_material
	where 	nr_seq_protocolo	= nr_seq_origem_w;

c05 CURSOR FOR
	SELECT	nr_sequencia,
			coalesce(ie_tipo_dialise,'H')
	from	protocolo_hd_prescricao
	where	cd_protocolo		= cd_protocolo_origem_p
	and		nr_seq_protocolo	= nr_seq_origem_p;

c06 CURSOR FOR
	SELECT	nr_sequencia
	from	protocolo_medic_gas
	where	cd_protocolo		= cd_protocolo_origem_p
	and	nr_seq_protocolo	= nr_seq_origem_p;


c07 CURSOR FOR
	SELECT	nr_sequencia,
		cd_protocolo,
		ie_tipo_consulta,
		dt_atualizacao,
		nm_usuario,
		nr_seq_medicacao
	from	protocolo_consulta
	where	cd_protocolo		= cd_protocolo_origem_p
	and	nr_seq_medicacao	= nr_seq_origem_p;

c08 CURSOR FOR
	SELECT	nr_sequencia,
		cd_protocolo,
		cd_tipo_evolucao,
		dt_atualizacao,
		nm_usuario,
		nr_seq_medicacao,
		ie_evolucao_clinica
	from	protocolo_evolucao
	where	cd_protocolo = cd_protocolo_origem_p
	and	nr_seq_medicacao = nr_seq_origem_p;

c09 CURSOR FOR
	SELECT	*
	from 	protocolo_medic_material
	where 	cd_protocolo	= cd_protocolo_origem_p
	and	nr_sequencia	= nr_seq_origem_p
	and	coalesce(nr_seq_gas::text, '') = ''
	and	coalesce(nr_seq_solucao::text, '') = ''
	and	ie_agrupador in (8,12);

c10 CURSOR FOR
	SELECT	nr_seq_material
	from	protocolo_medic_material
	where	cd_protocolo	= cd_protocolo_origem_p
	and	nr_sequencia = nr_seq_origem_p	
	and	coalesce(nr_seq_gas::text, '') = ''
	and ie_agrupador in (1,9,3,7)
	and	coalesce(nr_seq_diluicao::text, '') = ''
	and	coalesce(nr_seq_solucao::text, '') = '';	

c11 CURSOR FOR
	SELECT	*
	from 	protocolo_medic_material
	where 	cd_protocolo	= cd_protocolo_origem_p
	and	nr_sequencia	= nr_seq_origem_p
	and	coalesce(nr_seq_gas::text, '') = ''
	and	coalesce(nr_seq_solucao::text, '') = ''
	and	ie_agrupador = 2;

c12 CURSOR FOR
	SELECT	*
	from 	protocolo_medic_material
	where 	cd_protocolo	= cd_protocolo_origem_p
	and	nr_sequencia	= nr_seq_origem_p
	and	coalesce(nr_seq_gas::text, '') = ''
	and 	ie_agrupador in (1,9,3,7)
	and	coalesce(nr_seq_solucao::text, '') = ''
	and	nr_seq_diluicao = nr_seq_diluicao_w;

C13 CURSOR FOR
	SELECT	ds_grupo,
		nr_seq_apres,
		qt_tamanho_fonte,
		ds_cor_fonte,
		ds_tipo_fonte,
		ds_estilo_fonte,
		nr_seq_superior,
		qt_recuo_texto,
		qt_espaco_linha,
		nr_sequencia
	from	protocolo_grupo_descricao
	where	cd_protocolo	= cd_protocolo_origem_p;

C14 CURSOR FOR
	SELECT	ds_frase,
		ie_padrao,
		qt_tamanho_fonte,
		ie_sexo,
		ds_cor_fonte,
		ds_tipo_fonte,
		ds_estilo_fonte,
		cd_interno,
		nr_seq_apres,
		qt_recuo_texto,
		qt_espaco_linha,
		nr_sequencia
	from	protocolo_descricao
	where	cd_protocolo	= cd_protocolo_origem_p
	and	nr_seq_grupo	= nr_seq_grupo_ww;

C15 CURSOR FOR
	SELECT	ds_frase,
		ie_padrao,
		qt_tamanho_fonte,
		ie_sexo,
		ds_cor_fonte,
		ds_tipo_fonte,
		ds_estilo_fonte,
		cd_interno,
		nr_seq_apres,
		qt_recuo_texto,
		qt_espaco_linha,
		nr_sequencia
	from	protocolo_descricao
	where	cd_protocolo	= cd_protocolo_origem_p
	and		nr_sequencia 	= nr_seq_origem_w;

c16 CURSOR FOR
	SELECT		cd_material,
				qt_dose,
				cd_unidade_medida,
				ds_dias_aplicacao,
				nr_agrupamento,
				ds_recomendacao,
				ie_via_aplicacao,
				nr_seq_diluicao,
				nr_seq_dieta,
				nr_seq_proc,
				nr_seq_solucao,
				ie_agrupador,
				cd_intervalo,
				ds_horarios,
				ie_se_necessario,
				qt_minuto_aplicacao,
				ie_bomba_infusao,
				ie_aplic_bolus,
				ie_aplic_lenta,
				ie_acm,
				ds_dose_diferenciada,
				qt_solucao,
				hr_prim_horario,
				ie_urgencia,
				qt_hora_aplicacao,
				nr_seq_substituto,
				coalesce(ie_intervalo_fixo,'N') ie_intervalo_fixo,
				ie_multiplicar_dose,
				qt_dias_util,
				qt_dose_peso,
				qt_vel_infusao,
				ie_medic_rotina,
				ds_cor_rotina,
				ie_tipo_medic_hd,
				ie_lado,
				qt_hora_intervalo,
				qt_min_intervalo,
				ie_objetivo,
				qt_dias_prev_util,
				nr_seq_grupo,
				ie_dados_medicamento
			from 	protocolo_medic_material
			where 	cd_protocolo	= cd_protocolo_origem_p
			and	nr_sequencia	= nr_seq_origem_p
			and	nr_seq_gas 	= nr_seq_gasoterapia_origem_w;
			
C_COLUNAS_SOL CURSOR FOR
	SELECT 	column_name
	from 	user_tab_columns
	where 	table_name = 'PROTOCOLO_MEDIC_SOLUCAO'
	and 	column_name not in ('CD_PROTOCOLO','NR_SEQUENCIA','NR_SEQ_SOLUCAO','DT_ATUALIZACAO','NM_USUARIO','NR_SEQ_INTERNO');
	
C_COLUNAS_COMP_SOL CURSOR FOR
	SELECT 	column_name
	from 	user_tab_columns
	where 	table_name = 'PROTOCOLO_MEDIC_MATERIAL'
	and	column_name not in ('NR_SEQ_INTERNO', 'CD_PROTOCOLO', 'NR_SEQUENCIA', 'NR_SEQ_MATERIAL', 'DT_ATUALIZACAO', 'NM_USUARIO', 'NR_SEQ_SOLUCAO', 'IE_INTERVALO_FIXO');			

C_COLUNAS_MEDIC CURSOR FOR
	SELECT 	column_name
	from 	user_tab_columns
	where 	table_name = 'PROTOCOLO_MEDIC_MATERIAL'
	and	column_name not in ('NR_SEQ_INTERNO', 'CD_PROTOCOLO', 'NR_SEQUENCIA', 'NR_SEQ_MATERIAL', 'DT_ATUALIZACAO', 'NM_USUARIO', 'IE_INTERVALO_FIXO');	
	
c07_w	c07%rowtype;
c08_w	c08%rowtype;
c09_w	c09%rowtype;
c11_w	c11%rowtype;
c12_w	c12%rowtype;
c13_w	c13%rowtype;
c14_w	c14%rowtype;
c15_w	c15%rowtype;
c16_w	c16%rowtype;


BEGIN

/* obter registro copiar */

select	coalesce(nr_seq_interna,0)
into STRICT	nr_seq_origem_w
from	protocolo_medicacao
where	cd_protocolo = cd_protocolo_origem_p
and	nr_sequencia = nr_seq_origem_p;

/* obter registro gerar */

select	coalesce(nr_seq_interna,0)
into STRICT	nr_seq_destino_w
from	protocolo_medicacao
where	cd_protocolo = cd_protocolo_dest_p
and	nr_sequencia = nr_seq_destino_p;

/* obter descri??o subtipo */

begin
select	ds_subtipo_prot
into STRICT	ds_subtipo_w
from	desc_subtipo_protocolo
where	nr_seq_protocolo = nr_seq_origem_w;
exception
when others then
	ds_subtipo_w	:= '@';
end;

if	not((coalesce(cd_protocolo_origem_p,0)	= coalesce(cd_protocolo_dest_p,0)) and (coalesce(nr_seq_origem_p,0)		= coalesce(nr_seq_destino_p,0))) then

	if (coalesce(ie_deletar_anteriores_p,'S')	= 'S') then
		if (ie_hemodialise_p = 'S') then
			delete	from protocolo_medic_material
			where	cd_protocolo 	= cd_protocolo_dest_p
			and	nr_sequencia	= nr_seq_destino_p
			and	coalesce(nr_seq_gas::text, '') = ''
			and ie_agrupador = 13;
			delete	from protocolo_hd_prescricao
			where	cd_protocolo 		= cd_protocolo_dest_p
			and	nr_seq_protocolo	= nr_seq_destino_p;
			delete	from desc_subtipo_protocolo
			where	nr_seq_protocolo = nr_seq_destino_w;
		end if;
		if (ie_proc_exame_p = 'S') then
			delete	from protocolo_medic_material
			where	cd_protocolo 	= cd_protocolo_dest_p
			and	nr_sequencia	= nr_seq_destino_p
			and	coalesce(nr_seq_gas::text, '') = ''
			and ie_agrupador in (5,21);
			delete	from protocolo_medic_proc
			where	cd_protocolo 	= cd_protocolo_dest_p
			and	nr_sequencia	= nr_seq_destino_p
			and	coalesce(nr_seq_solic_bs::text, '') = ''
			and ((coalesce(nr_seq_proc_interno::text, '') = '') or (Obter_tipo_proc_interno(nr_seq_proc_interno) = 'O'));
		end if;
		if (ie_banco_sangue_p = 'S') then
			delete	from protocolo_medic_proc
			where	cd_protocolo 	= cd_protocolo_dest_p
			and	nr_sequencia	= nr_seq_destino_p
			and	(nr_seq_solic_bs IS NOT NULL AND nr_seq_solic_bs::text <> '');
			delete	from protocolo_medic_proc
			where	cd_protocolo 	= cd_protocolo_dest_p
			and	nr_sequencia	= nr_seq_destino_p
			and	nr_seq_solic_bs in (	SELECT	nr_sequencia
							from	prot_solic_bco_sangue
							where	cd_protocolo		= cd_protocolo_dest_p
							and	nr_seq_protocolo	= nr_seq_destino_p);

			delete	from PROTOCOLO_SOLIC_INDICACAO
			where	nr_seq_solic_bs in (	SELECT	nr_sequencia
							from	prot_solic_bco_sangue
							where	cd_protocolo		= cd_protocolo_dest_p
							and	nr_seq_protocolo	= nr_seq_destino_p);
			delete	from prot_solic_bco_sangue
			where	cd_protocolo		= cd_protocolo_dest_p
			and	nr_seq_protocolo	= nr_seq_destino_p;
		end if;
		if (ie_recomendacao_p = 'S') then
			delete	from protocolo_medic_rec
			where	cd_protocolo 	= cd_protocolo_dest_p
			and	nr_sequencia	= nr_seq_destino_p;
		end if;
		if (ie_frases_padroes_p = 'S') then
			delete	from protocolo_grupo_descricao
			where	cd_protocolo 	= cd_protocolo_dest_p
			and	nr_sequencia	= nr_seq_destino_p;

			delete	from protocolo_descricao
			where	cd_protocolo 	= cd_protocolo_dest_p
			and	nr_sequencia	= nr_seq_destino_p;
		end if;
		if (ie_solucao_p = 'S') then
			delete	from protocolo_medic_material
			where	cd_protocolo 	= cd_protocolo_dest_p
			and	nr_sequencia	= nr_seq_destino_p
			and 	coalesce(nr_seq_diluicao::text, '') = ''
			and ie_agrupador = 4;

			delete	from protocolo_medic_solucao
			where	cd_protocolo 	= cd_protocolo_dest_p
			and	nr_sequencia	= nr_seq_destino_p;
		end if;
		if (ie_dieta_p = 'S') then
			delete	from protocolo_medic_material
			where	cd_protocolo 	= cd_protocolo_dest_p
			and	nr_sequencia	= nr_seq_destino_p
			and	coalesce(nr_seq_gas::text, '') = ''
			and 	ie_agrupador in (8,12);
			delete	from protocolo_medic_dieta
			where	cd_protocolo 	= cd_protocolo_dest_p
			and	nr_sequencia	= nr_seq_destino_p;
			delete	from protocolo_medic_elem
			where	cd_protocolo 	= cd_protocolo_dest_p
			and	nr_sequencia	= nr_seq_destino_p;
			delete	from protocolo_medic_npt
			where	cd_protocolo 	= cd_protocolo_dest_p
			and	nr_sequencia	= nr_seq_destino_p;
		end if;
		if ( ie_medicamento_p = 'S') then
			delete	from protocolo_medic_material
			where	cd_protocolo 	= cd_protocolo_dest_p
			and	nr_sequencia	= nr_seq_destino_p
			and	coalesce(nr_seq_gas::text, '') = ''
			and 	ie_agrupador in (1,9,3,7);
		end if;
		if (ie_material_p = 'S') then
			delete	from protocolo_medic_material
			where	cd_protocolo 	= cd_protocolo_dest_p
			and	nr_sequencia	= nr_seq_destino_p
			and	coalesce(nr_seq_gas::text, '') = ''
			and 	ie_agrupador = 2;
		end if;
		delete	from prot_hd_prescr_sol_elem
		where	cd_protocolo 	= cd_protocolo_dest_p
		  and	nr_seq_medic	= nr_seq_destino_p;
		delete	from protocolo_consulta
		where	cd_protocolo 		= cd_protocolo_dest_p
		  and	nr_seq_medicacao	= nr_seq_destino_p;
		delete	from protocolo_evolucao
		where	cd_protocolo 		= cd_protocolo_dest_p
		  and	nr_seq_medicacao	= nr_seq_destino_p;
		delete	from protocolo_doenca
		where	cd_protocolo 		= cd_protocolo_dest_p
		  and	nr_seq_medicacao	= nr_seq_destino_p;
		if (ie_delegacao_p = 'S') then
			delete	from protocolo_medic_resp
			where	cd_protocolo	= cd_protocolo_dest_p
			and	nr_seq_medic	= nr_seq_destino_p;
		 end if;
		delete	from kit_material
		where	nr_seq_protocolo	= nr_seq_destino_p;
		if (ie_gasoterapia_p = 'S') then
			delete	from	PROTOCOLO_MEDIC_MATERIAL
			where	coalesce(nr_seq_diluicao::text, '') = ''
			and 	(nr_seq_gas IS NOT NULL AND nr_seq_gas::text <> '')
			and		nr_sequencia	= nr_seq_destino_p
			and		cd_protocolo	= cd_protocolo_dest_p;
			delete	from protocolo_medic_gas
			where	cd_protocolo		= cd_protocolo_dest_p
			and	nr_seq_protocolo	= nr_seq_destino_p;
		 end if;

		if (copiar_duracao_dia_trat_p = 'S') then
			delete from PROTOCOLO_MEDIC_DUR_DIA
			where	cd_protocolo		= cd_protocolo_dest_p
			and	NR_SEQ_PROT_MEDIC	= nr_seq_destino_p;
		end if;

		if (ie_categoria_topograf_p = 'S') then
		delete from PROT_MEDIC_CAT_TOPOGRAFICA
		where	cd_protocolo	= cd_protocolo_dest_p
		and	nr_sequencia	= nr_seq_destino_p;
		end if;
		if (ie_dispositivos_p = 'S') then
			delete from PROTOCOLO_DIPOSITIVO
			where cd_protocolo	= cd_protocolo_dest_p
			and	nr_sequencia	= nr_seq_destino_p;
		end if;

	end if;
	if ( nr_seq_origem_w <> 0 ) and (ds_subtipo_w <> '@') then
		/* inserir registro */

		select	nextval('desc_subtipo_protocolo_seq')
		into STRICT	nr_seq_subtipo_w
		;

		insert into desc_subtipo_protocolo(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_protocolo)
		SELECT	nr_seq_subtipo_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_destino_w
			;

		commit;

		CALL COPIA_CAMPO_LONG_DE_PARA( 'DESC_SUBTIPO_PROTOCOLO',
					  'DS_SUBTIPO_PROT',
					  'where nr_seq_protocolo = :nr_sequencia',
					  'nr_sequencia='||nr_seq_origem_w,
					  'DESC_SUBTIPO_PROTOCOLO',
					  'DS_SUBTIPO_PROT',
					  'where nr_sequencia= :nr_sequencia',
					  'nr_sequencia='||nr_seq_subtipo_w);

		commit;

	end if;

	if (ie_dieta_p = 'S') then--Pasta dietas
		insert into protocolo_medic_dieta(
			cd_protocolo,
			nr_sequencia,
			nr_seq_dieta,
			cd_dieta,
			dt_atualizacao,
			nm_usuario,
			ie_destino_dieta,
			ie_refeicao,
			ds_horarios,
			ds_observacao,
			cd_intervalo)
		SELECT
			cd_protocolo_dest_p,
			nr_seq_destino_p,
			nr_seq_dieta,
			cd_dieta,
			clock_timestamp(),
			nm_usuario_p,
			ie_destino_dieta,
			ie_refeicao,
			ds_horarios,
			ds_observacao,
			cd_intervalo
		from	protocolo_medic_dieta
		where	cd_protocolo	= cd_protocolo_origem_p
		and	nr_sequencia	= nr_seq_origem_p;
		--Jejum
		insert into protocolo_medic_npt(
			cd_protocolo,
			nr_sequencia,
			nr_seq_npt,
			dt_atualizacao,
			nm_usuario,
			nr_seq_fator_ativ,
			nr_seq_fator_stress,
			pr_proteina,
			pr_lipidio,
			pr_carboidrato,
			qt_kcal_prot,
			qt_kcal_lipidio,
			qt_kcal_carboidrato,
			qt_kcal_total,
			qt_kcal_kg,
			qt_grama_prot_kg_dia,
			ie_bomba_infusao,
			pr_npt,
			qt_fase_npt,
			qt_gotejamento_npt)
		SELECT
			cd_protocolo_dest_p,
			nr_seq_destino_p,
			nr_seq_npt,
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_fator_ativ,
			nr_seq_fator_stress,
			pr_proteina,
			pr_lipidio,
			pr_carboidrato,
			qt_kcal_prot,
			qt_kcal_lipidio,
			qt_kcal_carboidrato,
			qt_kcal_total,
			qt_kcal_kg,
			qt_grama_prot_kg_dia,
			ie_bomba_infusao,
			pr_npt,
			qt_fase_npt,
			qt_gotejamento_npt
		from	protocolo_medic_npt
		where	cd_protocolo	= cd_protocolo_origem_p
		and	nr_sequencia	= nr_seq_origem_p;
		--Elementos NPT
		insert into protocolo_medic_elem(
			nr_sequencia,
			cd_protocolo,
			nr_seq_prot_npt,
			nr_seq_elem,
			nr_seq_elemento,
			dt_atualizacao,
			nm_usuario,
			qt_kcal,
			qt_elemento,
			nr_seq_elem_unid_med,
			nr_seq_elem_mat,
			qt_volume,
			qt_vol_1_fase,
			qt_vol_2_fase,
			qt_vol_3_fase,
			cd_unid_med_prescr,
			qt_prescricao,
			qt_dispensar)
		SELECT
			nr_seq_destino_p,
			cd_protocolo_dest_p,
			nr_seq_prot_npt,
			nr_seq_elem,
			nr_seq_elemento,
			clock_timestamp(),
			nm_usuario_p,
			qt_kcal,
			qt_elemento,
			nr_seq_elem_unid_med,
			nr_seq_elem_mat,
			qt_volume,
			qt_vol_1_fase,
			qt_vol_2_fase,
			qt_vol_3_fase,
			cd_unid_med_prescr,
			qt_prescricao,
			qt_dispensar
		from	protocolo_medic_elem
		where	cd_protocolo	= cd_protocolo_origem_p
		  and	nr_sequencia	= nr_seq_origem_p;
	end if;
	if (ie_proc_exame_p = 'S') then
		insert into protocolo_medic_proc(
			cd_protocolo,
			nr_sequencia,
			nr_seq_proc,
			cd_procedimento,
			ie_origem_proced,
			qt_procedimento,
			dt_atualizacao,
			nm_usuario,
			cd_intervalo,
			ds_observacao,
			ds_dado_clinico,
			cd_material_exame,
			nr_seq_exame,
			cd_setor_atendimento,
			ie_se_necessario,
			ie_acm,
			hr_prim_horario,
			ds_material_especial,
			ie_urgencia,
			nr_seq_proc_interno,
			ie_lado,
			ie_multiplicar_quant,
			ds_rotina_prescr,
			ie_respiracao,
			ie_disp_resp_esp,
			cd_mod_vent,
			qt_fluxo_oxigenio,
			dt_prev_execucao,
			qt_hora_intervalo,
			qt_min_intervalo,
			nr_seq_solic_bs,
			nr_seq_derivado,
			qt_vol_hemocomp,
			qt_veloc_inf_hemo,
			ie_util_hemocomponente,
			nr_seq_exame_sangue,
			NR_SEQ_PROT_GLIC,
			ds_dias_aplicacao,
			ie_objetivo_onco,
			ie_executar_leito,
			nr_seq_contraste,
			ds_exame_fis_achado_cirur,
			ds_resumo_clinico,
			ie_questiona_lado,
			cd_setor_coleta,
			cd_setor_entrega,
			ds_prescricao,
			nr_seq_apres,
			ie_via_aplicacao,
			ie_filtrado,
			ie_aliquotado,
			ie_irradiado,
			ie_aferese,
			ie_lavado,
			ie_pool,
			ie_lavado_justificativa,
			qt_tempo_infusao,
			qt_hora_infusao,
			ie_aberto,
			ie_bolus)
		SELECT
			cd_protocolo_dest_p,
			nr_seq_destino_p,
			nr_seq_proc,
			cd_procedimento,
			ie_origem_proced,
			qt_procedimento,
			clock_timestamp(),
			nm_usuario_p,
			cd_intervalo,
			ds_observacao,
			substr(ds_dado_clinico,1,255),
			cd_material_exame,
			nr_seq_exame,
			cd_setor_atendimento,
			coalesce(ie_se_necessario,'N'),
			coalesce(ie_acm,'N'),
			hr_prim_horario,
			ds_material_especial,
			coalesce(ie_urgencia,'N'),
			nr_seq_proc_interno,
			ie_lado,
			ie_multiplicar_quant,
			ds_rotina_prescr,
			ie_respiracao,
			ie_disp_resp_esp,
			cd_mod_vent,
			qt_fluxo_oxigenio,
			dt_prev_execucao,
			qt_hora_intervalo,
			qt_min_intervalo,
			nr_seq_solic_bs,
			nr_seq_derivado,
			qt_vol_hemocomp,
			qt_veloc_inf_hemo,
			ie_util_hemocomponente,
			nr_seq_exame_sangue,
			nr_seq_prot_glic,
			ds_dias_aplicacao,
			ie_objetivo_onco,
			ie_executar_leito,
			nr_seq_contraste,
			ds_exame_fis_achado_cirur,
			ds_resumo_clinico,
			ie_questiona_lado,
			cd_setor_coleta,
			cd_setor_entrega,
			ds_prescricao,
			nr_seq_apres,
			ie_via_aplicacao,
			ie_filtrado,
			ie_aliquotado,
			ie_irradiado,
			ie_aferese,
			ie_lavado,
			ie_pool,
			ie_lavado_justificativa,
			qt_tempo_infusao,
			qt_hora_infusao,
			ie_aberto,
			ie_bolus
		from	protocolo_medic_proc
		where	cd_protocolo	= cd_protocolo_origem_p
		and	nr_sequencia	= nr_seq_origem_p
		and	coalesce(nr_seq_solic_bs::text, '') = ''
		and 	((coalesce(nr_seq_proc_interno::text, '') = '') or (Obter_tipo_proc_interno(nr_seq_proc_interno) = 'O'));

		insert into protocolo_medic_material(
			cd_protocolo,
			nr_sequencia,
			nr_seq_material,
			cd_material,
			qt_dose,
			cd_unidade_medida,
			ds_dias_aplicacao,
			dt_atualizacao,
			nm_usuario,
			nr_agrupamento,
			ds_recomendacao,
			ie_via_aplicacao,
			nr_seq_diluicao,
			nr_seq_dieta,
			nr_seq_proc,
			nr_seq_solucao,
			ie_agrupador,
			cd_intervalo,
			ds_horarios,
			ie_se_necessario,
			qt_minuto_aplicacao,
			ie_bomba_infusao,
			ie_aplic_bolus,
			ie_aplic_lenta,
			ie_acm,
			ds_dose_diferenciada,
			qt_solucao,
			hr_prim_horario,
			ie_urgencia,
			qt_hora_aplicacao,
			nr_seq_substituto,
			ie_intervalo_fixo,
			ie_multiplicar_dose,
			qt_dias_util,
			qt_dose_peso,
			qt_vel_infusao,
			ie_medic_rotina,
			ds_cor_rotina,
			ie_tipo_medic_hd,
			ie_lado,
			qt_hora_intervalo,
			qt_min_intervalo,
			ie_objetivo,
			qt_dias_prev_util,
			nr_seq_grupo,
			nr_seq_apresentacao,
			ds_rotina,
			ie_checar_adep,
			ie_pre_medicacao,
			ie_arredondar,
			ds_justificativa,
			ie_intervalo,
			ie_unidade_medida,
			ie_proporcao,
			qt_referencia,
			cd_topografia_cih,
			ie_alerta_via_adm,
			ie_kit,
			cd_microorganismo_cih,
			cd_amostra_cih,
			ie_origem_infeccao,
			ie_indicacao,
			ie_uso_antimicrobiano,
			ie_gerar_solucao,
			ds_ciclos_aplicacao,
			nr_seq_gas,
			ie_medicacao_paciente,
			cd_motivo_baixa,
			ie_dose_espec_agora,
			qt_dose_especial,
			hr_dose_especial,
			ie_justificativa,
			ie_alterar_dose,
			ie_aplicar,
			ie_dados_atb,
			ie_aplica_reducao,
			ie_dados_medicamento)
		SELECT
			cd_protocolo_dest_p,
			nr_seq_destino_p,
			nr_seq_material,
			cd_material,
			qt_dose,
			cd_unidade_medida,
			ds_dias_aplicacao,
			clock_timestamp(),
			nm_usuario_p,
			nr_agrupamento,
			ds_recomendacao,
			ie_via_aplicacao,
			nr_seq_diluicao,
			nr_seq_dieta,
			nr_seq_proc,
			nr_seq_solucao,
			ie_agrupador,
			cd_intervalo,
			ds_horarios,
			ie_se_necessario,
			qt_minuto_aplicacao,
			ie_bomba_infusao,
			ie_aplic_bolus,
			ie_aplic_lenta,
			ie_acm,
			ds_dose_diferenciada,
			qt_solucao,
			hr_prim_horario,
			ie_urgencia,
			qt_hora_aplicacao,
			nr_seq_substituto,
			coalesce(ie_intervalo_fixo,'N'),
			ie_multiplicar_dose,
			qt_dias_util,
			qt_dose_peso,
			qt_vel_infusao,
			ie_medic_rotina,
			ds_cor_rotina,
			ie_tipo_medic_hd,
			ie_lado,
			qt_hora_intervalo,
			qt_min_intervalo,
			ie_objetivo,
			qt_dias_prev_util,
			nr_seq_grupo,
			NR_SEQ_APRESENTACAO,
			ds_rotina,
			ie_checar_adep,
			ie_pre_medicacao,
			ie_arredondar,
			ds_justificativa,
			ie_intervalo,
			ie_unidade_medida,
			ie_proporcao,
			qt_referencia,
			cd_topografia_cih,
			ie_alerta_via_adm,
			ie_kit,
			cd_microorganismo_cih,
			cd_amostra_cih,
			ie_origem_infeccao,
			ie_indicacao,
			ie_uso_antimicrobiano,
			ie_gerar_solucao,
			ds_ciclos_aplicacao,
			nr_seq_gas,
			ie_medicacao_paciente,
			cd_motivo_baixa,
			ie_dose_espec_agora,
			qt_dose_especial,
			hr_dose_especial,
			ie_justificativa,
			ie_alterar_dose,
			ie_aplicar,
			ie_dados_atb,
			ie_aplica_reducao,
			ie_dados_medicamento
		from 	protocolo_medic_material
		where 	cd_protocolo	= cd_protocolo_origem_p
		and	nr_sequencia	= nr_seq_origem_p
		and	coalesce(nr_seq_gas::text, '') = ''
		and 	ie_agrupador in (5,21,20);
	end if;

	if (ie_recomendacao_p = 'S') then
		insert into protocolo_medic_rec(
			cd_protocolo,
			nr_sequencia,
			nr_seq_rec,
			dt_atualizacao,
			nm_usuario,
			ds_recomendacao,
			qt_recomendacao,
			cd_recomendacao,
			nr_seq_classif,
			cd_intervalo,
			ds_horarios,
			cd_kit,
			ie_acm,
			ie_se_necessario,
			ie_urgencia,
			nr_seq_topografia)
		SELECT
			cd_protocolo_dest_p,
			nr_seq_destino_p,
			nr_seq_rec,
			clock_timestamp(),
			nm_usuario_p,
			ds_recomendacao,
			qt_recomendacao,
			cd_recomendacao,
			nr_seq_classif,
			cd_intervalo,
			ds_horarios,
			cd_kit,
			ie_acm,
			ie_se_necessario,
			ie_urgencia,
			nr_seq_topografia
		from	protocolo_medic_rec
		where	cd_protocolo	= cd_protocolo_origem_p
		and	nr_sequencia	= nr_seq_origem_p;
	end if;

	if (ie_frases_padroes_p = 'S') then

		 select	ie_exige_grupo_desc
		 into STRICT	ie_exige_grupo_w
		 from	protocolo
		 where	cd_protocolo = cd_protocolo_dest_p;

		if (ie_exige_grupo_w = 'S') then

			open C13;
			loop
			fetch C13 into
				c13_w;
			EXIT WHEN NOT FOUND; /* apply on C13 */
				begin

				select  nextval('protocolo_grupo_descricao_seq')
				into STRICT	nr_seq_grupo_w
				;

				nr_seq_grupo_ww	:= c13_w.nr_sequencia;


				insert into protocolo_grupo_descricao(
									nr_sequencia,
									cd_protocolo,
									dt_atualizacao,
									nm_usuario,
									ds_grupo,
									nr_seq_apres,
									qt_tamanho_fonte,
									ds_cor_fonte,
									ds_tipo_fonte,
									ds_estilo_fonte,
									nr_seq_superior,
									qt_recuo_texto,
									dt_atualizacao_nrec,
									nm_usuario_nrec,
									qt_espaco_linha)
									values (nr_seq_grupo_w,
									cd_protocolo_dest_p,
									clock_timestamp(),
									nm_usuario_p,
									c13_w.ds_grupo,
									c13_w.nr_seq_apres,
									c13_w.qt_tamanho_fonte,
									c13_w.ds_cor_fonte,
									c13_w.ds_tipo_fonte,
									c13_w.ds_estilo_fonte,
									c13_w.nr_seq_superior,
									c13_w.qt_recuo_texto,
									clock_timestamp(),
									nm_usuario_p,
									c13_w.qt_espaco_linha);


				CALL COPIA_CAMPO_LONG_DE_PARA( 'PROTOCOLO_GRUPO_DESCRICAO',
							  'DS_GRUPO_FORMATADO',
							  'where cd_protocolo = :cd_protocolo_origem and nr_sequencia = :nr_seq_origem',
							  'cd_protocolo_origem='||cd_protocolo_origem_p||';nr_seq_origem='||c13_w.nr_sequencia,
							  'PROTOCOLO_GRUPO_DESCRICAO',
							  'DS_GRUPO_FORMATADO',
							  'where cd_protocolo = :cd_protocolo_dest and nr_sequencia = :nr_seq_destino',
							  'cd_protocolo_dest='||cd_protocolo_dest_p||';nr_seq_destino='||nr_seq_grupo_w);

				open C14;
				loop
				fetch C14 into
					c14_w;
				EXIT WHEN NOT FOUND; /* apply on C14 */
					begin

					select 	coalesce(max(nr_sequencia)+1,1)
					into STRICT	nr_seq_prot_dest_w
					from	protocolo_descricao
					where	cd_protocolo = cd_protocolo_dest_p;

					insert into protocolo_descricao(
									cd_protocolo,
									nr_sequencia,
									dt_atualizacao,
									nm_usuario,
									ds_frase,
									ie_padrao,
									qt_tamanho_fonte,
									ie_sexo,
									nr_seq_grupo,
									ds_cor_fonte,
									ds_tipo_fonte,
									ds_estilo_fonte,
									cd_interno,
									nr_seq_apres,
									qt_recuo_texto,
									qt_espaco_linha)
									values (cd_protocolo_dest_p,
									 nr_seq_prot_dest_w,
									 clock_timestamp(),
									 nm_usuario_p,
									 c14_w.ds_frase,
									 c14_w.ie_padrao,
									 c14_w.qt_tamanho_fonte,
									 c14_w.ie_sexo,
									 nr_seq_grupo_w,
									 c14_w.ds_cor_fonte,
									 c14_w.ds_tipo_fonte,
									 c14_w.ds_estilo_fonte,
									 c14_w.cd_interno,
									 c14_w.nr_seq_apres,
									 c14_w.qt_recuo_texto,
									 c14_w.qt_espaco_linha);
				CALL COPIA_CAMPO_LONG_DE_PARA( 'PROTOCOLO_DESCRICAO',
						  'DS_FRASE_LONGA',
						  'where cd_protocolo = :cd_protocolo_origem and nr_sequencia = :nr_seq_origem',
						  'cd_protocolo_origem='||cd_protocolo_origem_p||';nr_seq_origem='||c14_w.nr_sequencia,
						  'PROTOCOLO_DESCRICAO',
						  'DS_FRASE_LONGA',
						  'where cd_protocolo = :cd_protocolo_dest and nr_sequencia = :nr_seq_destino',
						  'cd_protocolo_dest='||cd_protocolo_dest_p||';nr_seq_destino='||nr_seq_prot_dest_w);


					end;
				end loop;
				close C14;

				end;
			end loop;
			close C13;
		else
			open C15;
			loop
			fetch C15 into
				c15_w;
			EXIT WHEN NOT FOUND; /* apply on C15 */
				begin

				select 	coalesce(max(nr_sequencia)+1,1)
				into STRICT	nr_seq_prot_dest_w
				from	protocolo_descricao
				where	cd_protocolo = cd_protocolo_dest_p;

				insert into protocolo_descricao(cd_protocolo,
								nr_sequencia,
								dt_atualizacao,
								nm_usuario,
								ds_frase,
								ie_padrao,
								qt_tamanho_fonte,
								ie_sexo,
								ds_cor_fonte,
								ds_tipo_fonte,
								ds_estilo_fonte,
								cd_interno,
								nr_seq_apres,
								qt_recuo_texto,
								qt_espaco_linha)
							values (cd_protocolo_dest_p,
								 nr_seq_prot_dest_w,
								 clock_timestamp(),
								 nm_usuario_p,
								 c15_w.ds_frase,
								 c15_w.ie_padrao,
								 c15_w.qt_tamanho_fonte,
								 c15_w.ie_sexo,
								 c15_w.ds_cor_fonte,
								 c15_w.ds_tipo_fonte,
								 c15_w.ds_estilo_fonte,
								 c15_w.cd_interno,
								 c15_w.nr_seq_apres,
								 c15_w.qt_recuo_texto,
								 c15_w.qt_espaco_linha
								);
			CALL COPIA_CAMPO_LONG_DE_PARA( 'PROTOCOLO_DESCRICAO',
							  'DS_FRASE_LONGA',
							  'where cd_protocolo = :cd_protocolo_origem and nr_sequencia = :nr_seq_origem',
							  'cd_protocolo_origem='||cd_protocolo_origem_p||';nr_seq_origem='||c15_w.nr_sequencia,
							  'PROTOCOLO_DESCRICAO',
							  'DS_FRASE_LONGA',
							  'where cd_protocolo = :cd_protocolo_dest and nr_sequencia = :nr_seq_destino',
							  'cd_protocolo_dest='||cd_protocolo_dest_p||';nr_seq_destino='||nr_seq_prot_dest_w);
				end;
			end loop;
			close C15;
		end if;
	end if;

	open C07;
	loop
	fetch C07 into
		C07_w;
	EXIT WHEN NOT FOUND; /* apply on C07 */
		begin

	insert into protocolo_consulta(
		nr_sequencia,
		cd_protocolo,
		ie_tipo_consulta,
		dt_atualizacao,
		nm_usuario,
		nr_seq_medicacao)
	values (
		nextval('protocolo_consulta_seq'),
		cd_protocolo_dest_p,
		c07_w.ie_tipo_consulta,
		clock_timestamp(),
		nm_usuario_p,
		nr_seq_destino_p);
		end;

	CALL COPIA_CAMPO_LONG_DE_PARA('PROTOCOLO_CONSULTA',
				 'DS_CONSULTA',
				 'WHERE	CD_PROTOCOLO = :CD_PROTOCOLO_ORIGEM	AND	NR_SEQ_MEDICACAO = :NR_SEQ_ORIGEM',
				 'CD_PROTOCOLO_ORIGEM='||CD_PROTOCOLO_ORIGEM_P||';NR_SEQ_ORIGEM='||NR_SEQ_ORIGEM_P,
				 'PROTOCOLO_CONSULTA',
				 'DS_CONSULTA',
				 'WHERE	CD_PROTOCOLO = :CD_PROTOCOLO_DEST	AND	NR_SEQ_MEDICACAO = :NR_SEQ_DESTINO',
				 'CD_PROTOCOLO_DEST='||cd_protocolo_dest_p||';NR_SEQ_DESTINO='||nr_seq_destino_p);
	end loop;
	close C07;

	/*
	insert into protocolo_evolucao(
		nr_sequencia,
		cd_protocolo,
		cd_tipo_evolucao,
		dt_atualizacao,
		nm_usuario,
		ds_evolucao,
		nr_seq_medicacao,
		ie_evolucao_clinica)
	select
		protocolo_evolucao_seq.nextval,
		cd_protocolo_dest_p,
		cd_tipo_evolucao,
		sysdate,
		nm_usuario_p,
		ds_evolucao,
		nr_seq_destino_p,
		ie_evolucao_clinica
	from	protocolo_evolucao
	where	cd_protocolo		= cd_protocolo_origem_p
	and		nr_seq_medicacao	= nr_seq_origem_p;
	*/
	open C08;
	loop
	fetch C08 into
		c08_w;
	EXIT WHEN NOT FOUND; /* apply on C08 */
		begin
		insert into protocolo_evolucao(
			nr_sequencia,
			cd_protocolo,
			cd_tipo_evolucao,
			dt_atualizacao,
			nm_usuario,
			nr_seq_medicacao,
			ie_evolucao_clinica)
		values (
			nextval('protocolo_evolucao_seq'),
			cd_protocolo_dest_p,
			c08_w.cd_tipo_evolucao,
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_destino_p,
			c08_w.ie_evolucao_clinica);
		end;
	CALL COPIA_CAMPO_LONG_DE_PARA('PROTOCOLO_EVOLUCAO',
				 'DS_EVOLUCAO',
				 'WHERE	CD_PROTOCOLO = :CD_PROTOCOLO_ORIGEM	AND	NR_SEQ_MEDICACAO = :NR_SEQ_ORIGEM',
				 'CD_PROTOCOLO_ORIGEM='||CD_PROTOCOLO_ORIGEM_P||';NR_SEQ_ORIGEM='||NR_SEQ_ORIGEM_P,
				 'PROTOCOLO_EVOLUCAO',
				 'DS_EVOLUCAO',
				 'WHERE	CD_PROTOCOLO = :CD_PROTOCOLO_DEST	AND	NR_SEQ_MEDICACAO = :NR_SEQ_DESTINO',
				 'CD_PROTOCOLO_DEST='||CD_PROTOCOLO_DEST_P||';NR_SEQ_DESTINO='||NR_SEQ_DESTINO_P);
	end loop;
	close C08;

	insert into protocolo_doenca(
		nr_sequencia,
		cd_protocolo,
		cd_doenca_cid,
		dt_atualizacao,
		nm_usuario,
		nr_seq_medicacao)
	SELECT
		nextval('protocolo_doenca_seq'),
		cd_protocolo_dest_p,
		cd_doenca_cid,
		clock_timestamp(),
		nm_usuario_p,
		nr_seq_destino_p
	from	protocolo_doenca
	where	cd_protocolo		= cd_protocolo_origem_p
	and		nr_seq_medicacao	= nr_seq_origem_p;

	if (ie_delegacao_p = 'S') then
		insert into protocolo_medic_resp(
			nr_sequencia,
			cd_protocolo,
			nr_seq_medic,
			dt_atualizacao,
			nm_usuario,
			cd_pessoa_fisica,
			ie_resp_princ,
			dt_atualizacao_nrec,
			nm_usuario_nrec)
		SELECT
			nextval('protocolo_medic_resp_seq'),
			cd_protocolo_dest_p,
			nr_seq_destino_p,
			clock_timestamp(),
			nm_usuario_p,
			cd_pessoa_fisica,
			ie_resp_princ,
			clock_timestamp(),
			nm_usuario_p
		from	protocolo_medic_resp
		where	cd_protocolo	= cd_protocolo_origem_p
		and	nr_seq_medic	= nr_seq_origem_p;
	end if;

	if (copiar_duracao_dia_trat_p = 'S') then
		insert into PROTOCOLO_MEDIC_DUR_DIA(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			nr_seq_prot_medic,
			ds_dia_ciclo,
			cd_protocolo,
			nr_duracao,
			nr_ciclo)
		SELECT	nextval('protocolo_medic_dur_dia_seq'),
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_destino_p,
			ds_dia_ciclo,
			cd_protocolo_dest_p,
			nr_duracao,
			nr_ciclo
		from	PROTOCOLO_MEDIC_DUR_DIA
		where	cd_protocolo	= cd_protocolo_origem_p
		and	nr_seq_prot_medic	= nr_seq_origem_p;
	end if;

	if (ie_categoria_topograf_p = 'S') then
		insert into PROT_MEDIC_CAT_TOPOGRAFICA(
			cd_protocolo,
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			nr_seq_item,
			cd_categoria,
			nr_seq_referencia,
			IE_MODALIDADE_TRAT,
			ie_situacao)
		SELECT	cd_protocolo_dest_p,
			nr_seq_destino_p,
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_item,
			cd_categoria,
			nr_seq_referencia,
			IE_MODALIDADE_TRAT,
			ie_situacao
		from	PROT_MEDIC_CAT_TOPOGRAFICA
		where	cd_protocolo	= cd_protocolo_origem_p
		and	nr_sequencia	= nr_seq_origem_p;
	end if;

	if (ie_banco_sangue_p = 'S') then

		open c03;
		loop
			fetch c03 into
				nr_seq_prot_solic_bco_san_o_w;
			EXIT WHEN NOT FOUND; /* apply on c03 */

			/* obter sequencia */

			select	nextval('prot_solic_bco_sangue_seq')
			into STRICT	nr_seq_prot_solic_bco_san_d_w
			;

			insert into prot_solic_bco_sangue(nr_sequencia,
					cd_protocolo,
					dt_atualizacao,
					dt_atualizacao_nrec,
					nm_usuario,
					nm_usuario_nrec,
					nr_seq_protocolo,
					ie_porte_cirurgico,
					ie_tipo,
					ie_tipo_paciente,
					ie_reserva,
					ds_observacao,
					qt_temp,
					qt_ttpa_rel,
					qt_ttpa,
					qt_tap_inr,
					qt_tap,
					qt_plaqueta,
					qt_transf_anterior,
					qt_pa_diastolica,
					qt_pa_sistolica,
					qt_imc,
					qt_peso,
					qt_leucocitos,
					qt_hemoglobina_s,
					qt_magnesio,
					qt_freq_cardiaca,
					qt_calcio,
					qt_fibrinogenio,
					qt_hematocrito,
					qt_hemoglobina,
					qt_gravidez,
					qt_altura_cm,
					qt_bilirrubina_ind,
					qt_bilirrubina_dir,
					qt_albumina,
					qt_aborto,
					nr_seq_reacao,
					nr_seq_item_prot,
					ie_trans_anterior,
					ie_coombs_direto,
					ie_gravidez,
					dt_ultima_transf,
					dt_programada,
					dt_cirurgia,
					ds_coagulopatia,
					ds_pre_medicacao,
					ds_hemocomp_reacao,
					ds_cirurgia,
					ds_diagnostico,
					cd_perfil_ativo,
					cd_doenca_cid)
			SELECT  nr_seq_prot_solic_bco_san_d_w,
					cd_protocolo_dest_p,
					clock_timestamp(),
					clock_timestamp(),
					nm_usuario_p,
					nm_usuario_p,
					nr_seq_destino_p,
					ie_porte_cirurgico,
					ie_tipo,
					ie_tipo_paciente,
					ie_reserva,
					ds_observacao,
					qt_temp,
					qt_ttpa_rel,
					qt_ttpa,
					qt_tap_inr,
					qt_tap,
					qt_plaqueta,
					qt_transf_anterior,
					qt_pa_diastolica,
					qt_pa_sistolica,
					qt_imc,
					qt_peso,
					qt_leucocitos,
					qt_hemoglobina_s,
					qt_magnesio,
					qt_freq_cardiaca,
					qt_calcio,
					qt_fibrinogenio,
					qt_hematocrito,
					qt_hemoglobina,
					qt_gravidez,
					qt_altura_cm,
					qt_bilirrubina_ind,
					qt_bilirrubina_dir,
					qt_albumina,
					qt_aborto,
					nr_seq_reacao,
					nr_sequencia,
					ie_trans_anterior,
					ie_coombs_direto,
					ie_gravidez,
					dt_ultima_transf,
					dt_programada,
					dt_cirurgia,
					ds_coagulopatia,
					ds_pre_medicacao,
					ds_hemocomp_reacao,
					ds_cirurgia,
					ds_diagnostico,
					obter_perfil_ativo,
					cd_doenca_cid
			from	prot_solic_bco_sangue
			where	nr_sequencia = nr_seq_prot_solic_bco_san_o_w;

			insert into protocolo_medic_proc(
				cd_protocolo,
				nr_sequencia,
				nr_seq_proc,
				cd_procedimento,
				ie_origem_proced,
				qt_procedimento,
				dt_atualizacao,
				nm_usuario,
				cd_intervalo,
				ds_observacao,
				ds_dado_clinico,
				cd_material_exame,
				nr_seq_exame,
				cd_setor_atendimento,
				ie_se_necessario,
				ie_acm,
				hr_prim_horario,
				ds_material_especial,
				ie_urgencia,
				nr_seq_proc_interno,
				ie_lado,
				ie_multiplicar_quant,
				ds_rotina_prescr,
				ie_respiracao,
				ie_disp_resp_esp,
				cd_mod_vent,
				qt_fluxo_oxigenio,
				dt_prev_execucao,
				qt_hora_intervalo,
				qt_min_intervalo,
				nr_seq_solic_bs,
				nr_seq_derivado,
				qt_vol_hemocomp,
				qt_veloc_inf_hemo,
				ie_util_hemocomponente,
				nr_seq_exame_sangue,
				ie_via_aplicacao,
				ie_filtrado,
				ie_aliquotado,
				ie_irradiado,
				ie_aferese,
				ie_lavado,
				ie_pool,
				ie_lavado_justificativa,
				qt_tempo_infusao,
				qt_hora_infusao,
				ie_aberto,
				ie_bolus)
			SELECT
				cd_protocolo_dest_p,
				nr_seq_destino_p,
				nr_seq_proc,
				cd_procedimento,
				ie_origem_proced,
				qt_procedimento,
				clock_timestamp(),
				nm_usuario_p,
				cd_intervalo,
				ds_observacao,
				substr(ds_dado_clinico,1,255),
				cd_material_exame,
				nr_seq_exame,
				cd_setor_atendimento,
				coalesce(ie_se_necessario,'N'),
				coalesce(ie_acm,'N'),
				hr_prim_horario,
				ds_material_especial,
				coalesce(ie_urgencia,'N'),
				nr_seq_proc_interno,
				ie_lado,
				ie_multiplicar_quant,
				ds_rotina_prescr,
				ie_respiracao,
				ie_disp_resp_esp,
				cd_mod_vent,
				qt_fluxo_oxigenio,
				dt_prev_execucao,
				qt_hora_intervalo,
				qt_min_intervalo,
				nr_seq_prot_solic_bco_san_d_w,
				nr_seq_derivado,
				qt_vol_hemocomp,
				qt_veloc_inf_hemo,
				ie_util_hemocomponente,
				nr_seq_exame_sangue,
				ie_via_aplicacao,
				ie_filtrado,
				ie_aliquotado,
				ie_irradiado,
				ie_aferese,
				ie_lavado,
				ie_pool,
				ie_lavado_justificativa,
				qt_tempo_infusao,
				qt_hora_infusao,
				ie_aberto,
				ie_bolus
			from	protocolo_medic_proc
			where	nr_seq_solic_bs = nr_seq_prot_solic_bco_san_o_w
			and	(nr_seq_solic_bs IS NOT NULL AND nr_seq_solic_bs::text <> '');

			insert into PROTOCOLO_SOLIC_INDICACAO(
				nr_sequencia,
				NR_SEQ_SOLIC_BS,
				IE_GRUPO_HEMOCOM,
				NR_SEQ_INDICACAO,
				DS_INDICACAO_ADIC,
				dt_atualizacao,
				nm_usuario,
				dt_atualizacao_nrec,
				nm_usuario_nrec,
				ds_justificativa)
			SELECT	nextval('protocolo_solic_indicacao_seq'),
				nr_seq_prot_solic_bco_san_d_w,
				IE_GRUPO_HEMOCOM,
				NR_SEQ_INDICACAO,
				DS_INDICACAO_ADIC,
				clock_timestamp(),
				nm_usuario_p,
				clock_timestamp(),
				nm_usuario_p,
				ds_justificativa
			from	PROTOCOLO_SOLIC_INDICACAO
			where	NR_SEQ_SOLIC_BS = nr_seq_prot_solic_bco_san_o_w;
		end loop;
		close c03;
	end if;

	open c04;
	loop
		fetch c04 into
			cd_kit_material_origem_w;
		EXIT WHEN NOT FOUND; /* apply on c04 */

		/* obter sequencia kit */

		select	coalesce(max(cd_kit_material),0) + 1
		into STRICT	cd_kit_material_dest_w
		from	kit_material;

		insert into kit_material(
			cd_kit_material,
			ds_kit_material,
			ie_situacao,
			dt_atualizacao,
			nm_usuario,
			ie_tipo,
			ie_forma_baixa,
			ie_material_pai,
			dt_revisao,
			nm_usuario_revisao,
			ds_observacao,
			nr_seq_protocolo)
		SELECT
			cd_kit_material_dest_w,
			ds_kit_material,
			ie_situacao,
			clock_timestamp(),
			nm_usuario_p,
			ie_tipo,
			ie_forma_baixa,
			ie_material_pai,
			dt_revisao,
			nm_usuario_revisao,
			ds_observacao,
			nr_seq_destino_w
		from	kit_material
		where	cd_kit_material	= cd_kit_material_origem_w;

		insert into componente_kit(
			cd_kit_material,
			nr_sequencia,
			cd_material,
			ie_via_aplicacao,
			ie_tipo_paciente,
			qt_material,
			ie_situacao,
			dt_atualizacao,
			nm_usuario,
			qt_volume_min,
			qt_volume_max,
			ie_baixa_estoque,
			cd_medico,
			cd_convenio,
			ie_tipo_convenio,
			ie_dispensavel,
			ie_video,
			cd_fornecedor,
			qt_idade_minima,
			qt_idade_maxima,
			ie_calcula_preco,
			ie_entra_conta,
			cd_intervalo,
			ie_duplica_prescr,
			ie_multiplica_dose)
		SELECT
			cd_kit_material_dest_w,
			nr_sequencia,
			cd_material,
			ie_via_aplicacao,
			ie_tipo_paciente,
			qt_material,
			ie_situacao,
			clock_timestamp(),
			nm_usuario_p,
			qt_volume_min,
			qt_volume_max,
			ie_baixa_estoque,
			cd_medico,
			cd_convenio,
			ie_tipo_convenio,
			ie_dispensavel,
			ie_video,
			cd_fornecedor,
			qt_idade_minima,
			qt_idade_maxima,
			ie_calcula_preco,
			ie_entra_conta,
			cd_intervalo,
			ie_duplica_prescr,
			ie_multiplica_dose
		from	componente_kit
		where	cd_kit_material	= cd_kit_material_origem_w;

		insert into componente_kit_opcao(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			cd_kit_material,
			nr_seq_componente,
			cd_material)
		SELECT
			nextval('componente_kit_opcao_seq'),
			clock_timestamp(),
			nm_usuario_p,
			cd_kit_material_dest_w,
			nr_seq_componente,
			cd_material
		from	componente_kit_opcao
		where	cd_kit_material	= cd_kit_material_origem_w;
	end loop;
	close c04;
	if (ie_solucao_p = 'S') then
		open C01;
		loop
		fetch C01 into
			nr_seq_solucao_origem_w;
		EXIT WHEN NOT FOUND; /* apply on C01 */
			begin
			
			ds_colunas_w	:= null;

			open C_COLUNAS_SOL;
			loop
			fetch C_COLUNAS_SOL into	
				nm_coluna_w;
			EXIT WHEN NOT FOUND; /* apply on C_COLUNAS_SOL */
				begin
					
				ds_colunas_w	:= ds_colunas_w || ', ' || nm_coluna_w;
				
				end;
			end loop;
			close C_COLUNAS_SOL;			

			select	coalesce(max(nr_seq_solucao),0) +1
			into STRICT	nr_seq_solucao_dest_w
			from	protocolo_medic_solucao
			where	cd_protocolo = cd_protocolo_dest_p
			and	nr_sequencia = nr_seq_destino_p;
			
			select	nextval('protocolo_medic_solucao_seq')
			into STRICT 	nr_seq_medic_solucao_w
			;
						
			ds_insert_w := 'insert into protocolo_medic_solucao(cd_protocolo,
										nr_sequencia,
										nr_seq_solucao,
										dt_atualizacao,
										nm_usuario,
										nr_seq_interno'
										|| ds_colunas_w || ')
							(select ' || cd_protocolo_dest_p || ',
									' || nr_seq_destino_p || ',
									' || nr_seq_solucao_dest_w || ',
									sysdate,
									'''||nm_usuario_p||''',
									' || nr_seq_medic_solucao_w || '
									' || ds_colunas_w ||
							' from	protocolo_medic_solucao
									where cd_protocolo = ' || cd_protocolo_origem_p || '
									and	nr_sequencia = ' || nr_seq_origem_p || '
									and	nr_seq_solucao = ' || nr_seq_solucao_origem_w || '
									and	nr_seq_dialise is null)';
			CALL exec_sql_dinamico('Tasy', ds_insert_w);
			commit;						
		
			open C02;
			loop
			fetch C02 into
				nr_seq_material_origem_w;
			EXIT WHEN NOT FOUND; /* apply on C02 */
				begin

				ds_colunas_w	:= null;

				open C_COLUNAS_COMP_SOL;
				loop
				fetch C_COLUNAS_COMP_SOL into	
					nm_coluna_w;
				EXIT WHEN NOT FOUND; /* apply on C_COLUNAS_COMP_SOL */
					begin
						
					ds_colunas_w	:= ds_colunas_w || ', ' || nm_coluna_w;
					
					end;
				end loop;
				close C_COLUNAS_COMP_SOL;					
					
					select	coalesce(max(nr_seq_material),0) +1
					into STRICT	nr_seq_material_dest_w
					from	protocolo_medic_material
					where	cd_protocolo = cd_protocolo_dest_p
					and	nr_sequencia = nr_seq_destino_p;

				ds_insert_w := 'insert into protocolo_medic_material(cd_protocolo,
											nr_sequencia,
											nr_seq_material,
											dt_atualizacao,
											nm_usuario,
											nr_seq_solucao,
											ie_intervalo_fixo'
											|| ds_colunas_w || ')
								(select ' || cd_protocolo_dest_p || ',
										' || nr_seq_destino_p || ',
										' || nr_seq_material_dest_w || ',
										sysdate,
										'''||nm_usuario_p||''',
										' || nr_seq_solucao_dest_w || ',
										 nvl(ie_intervalo_fixo,''N'')
										' || ds_colunas_w ||
								' from	protocolo_medic_material
										where cd_protocolo = ' || cd_protocolo_origem_p || '
										and	nr_sequencia = ' || nr_seq_origem_p || '
										and	nr_seq_solucao = ' || nr_seq_solucao_origem_w || '
										and nr_seq_material = ' || nr_seq_material_origem_w || '
										and nr_seq_gas is null
										and	nr_seq_diluicao is null)';										
				CALL exec_sql_dinamico('Tasy', ds_insert_w);
				commit;							

				end;
			end loop;
			close C02;
			end;
		end loop;
		close C01;
	end if;

	/*Hemodi?lise*/

	if (ie_hemodialise_p = 'S') then
		insert into protocolo_medic_material(
				cd_protocolo,
				nr_sequencia,
				nr_seq_material,
				cd_material,
				qt_dose,
				cd_unidade_medida,
				ds_dias_aplicacao,
				dt_atualizacao,
				nm_usuario,
				nr_agrupamento,
				ds_recomendacao,
				ie_via_aplicacao,
				nr_seq_diluicao,
				nr_seq_dieta,
				nr_seq_proc,
				nr_seq_solucao,
				ie_agrupador,
				cd_intervalo,
				ds_horarios,
				ie_se_necessario,
				qt_minuto_aplicacao,
				ie_bomba_infusao,
				ie_aplic_bolus,
				ie_aplic_lenta,
				ie_acm,
				ds_dose_diferenciada,
				qt_solucao,
				hr_prim_horario,
				ie_urgencia,
				qt_hora_aplicacao,
				nr_seq_substituto,
				ie_intervalo_fixo,
				ie_multiplicar_dose,
				qt_dias_util,
				qt_dose_peso,
				qt_vel_infusao,
				ie_medic_rotina,
				ds_cor_rotina,
				ie_tipo_medic_hd,
				ie_lado,
				qt_hora_intervalo,
				qt_min_intervalo,
				ie_objetivo,
				qt_dias_prev_util,
				nr_seq_grupo,
				nr_seq_apresentacao,
				ds_rotina,
				ie_checar_adep,
				ie_pre_medicacao,
				ie_arredondar,
				ds_justificativa,
				ie_intervalo,
				ie_unidade_medida,
				ie_proporcao,
				qt_referencia,
				cd_topografia_cih,
				ie_alerta_via_adm,
				ie_kit,
				cd_microorganismo_cih,
				cd_amostra_cih,
				ie_origem_infeccao,
				ie_indicacao,
				ie_uso_antimicrobiano,
				ie_gerar_solucao,
				ds_ciclos_aplicacao,
				nr_seq_gas,
				ie_medicacao_paciente,
				cd_motivo_baixa,
				ie_dose_espec_agora,
				qt_dose_especial,
				hr_dose_especial,
				ie_justificativa,
				ie_alterar_dose,
				ie_aplicar,
				ie_dados_atb,
				ie_aplica_reducao,
				ie_dados_medicamento)
			SELECT
				cd_protocolo_dest_p,
				nr_seq_destino_p,
				nr_seq_material,
				cd_material,
				qt_dose,
				cd_unidade_medida,
				ds_dias_aplicacao,
				clock_timestamp(),
				nm_usuario_p,
				nr_agrupamento,
				ds_recomendacao,
				ie_via_aplicacao,
				nr_seq_diluicao,
				nr_seq_dieta,
				nr_seq_proc,
				nr_seq_solucao,
				ie_agrupador,
				cd_intervalo,
				ds_horarios,
				ie_se_necessario,
				qt_minuto_aplicacao,
				ie_bomba_infusao,
				ie_aplic_bolus,
				ie_aplic_lenta,
				ie_acm,
				ds_dose_diferenciada,
				qt_solucao,
				hr_prim_horario,
				ie_urgencia,
				qt_hora_aplicacao,
				nr_seq_substituto,
				coalesce(ie_intervalo_fixo,'N'),
				ie_multiplicar_dose,
				qt_dias_util,
				qt_dose_peso,
				qt_vel_infusao,
				ie_medic_rotina,
				ds_cor_rotina,
				ie_tipo_medic_hd,
				ie_lado,
				qt_hora_intervalo,
				qt_min_intervalo,
				ie_objetivo,
				qt_dias_prev_util,
				nr_seq_grupo,
				NR_SEQ_APRESENTACAO,
				ds_rotina,
				ie_checar_adep,
				ie_pre_medicacao,
				ie_arredondar,
				ds_justificativa,
				ie_intervalo,
				ie_unidade_medida,
				ie_proporcao,
				qt_referencia,
				cd_topografia_cih,
				ie_alerta_via_adm,
				ie_kit,
				cd_microorganismo_cih,
				cd_amostra_cih,
				ie_origem_infeccao,
				ie_indicacao,
				ie_uso_antimicrobiano,
				ie_gerar_solucao,
				ds_ciclos_aplicacao,
				nr_seq_gas,
				ie_medicacao_paciente,
				cd_motivo_baixa,
				ie_dose_espec_agora,
				qt_dose_especial,
				hr_dose_especial,
				ie_justificativa,
				ie_alterar_dose,
				ie_aplicar,
				ie_dados_atb,
				ie_aplica_reducao,
				ie_dados_medicamento
			from 	protocolo_medic_material
			where 	cd_protocolo	= cd_protocolo_origem_p
			  and	nr_sequencia	= nr_seq_origem_p
			  and	coalesce(nr_seq_solucao::text, '') = ''
			  and	coalesce(nr_seq_gas::text, '') = ''
			  and	ie_agrupador = 13;

		open c05;
		loop
			fetch c05 into
				nr_seq_prot_hd_prescricao_o_w,
				ie_tipo_dialise_prot_hd_pr_w;
			EXIT WHEN NOT FOUND; /* apply on c05 */

			/* obter sequencia protocolo HD prescri??o */

			select	nextval('protocolo_hd_prescricao_seq')
			into STRICT	nr_seq_hd_prescr_w
			;

			insert into protocolo_hd_prescricao(
				nr_sequencia,
				dt_atualizacao,
				nm_usuario,
				dt_atualizacao_nrec,
				nm_usuario_nrec,
				cd_protocolo,
				nr_seq_protocolo,
				ie_tipo_hemodialise,
				qt_sessao_sem,
				qt_hora_sessao,
				qt_min_sessao,
				qt_fluxo_sangue,
				nr_seq_mod_dialisador,
				ie_ultrafiltracao,
				qt_ultrafiltracao,
				ie_tipo_peritoneal,
				dt_status,
				ie_status,
				ie_tipo_dialise,
				qt_volume_total,
				nr_seq_maq_cicladora,
				nr_seq_diametro_agulha,
				nr_seq_tipo_agulha_art,
				nr_seq_ultra,
				nr_seq_perfil_sodio,
				qt_zero_um,
				qt_um_dois,
				qt_dois_tres,
				qt_tres_quatro,
				ie_ligar_prime,
				qt_peso_seco,
				ds_observacao,
				ie_continuo,
				ie_categoria,
				qt_sodio,
				qt_bicarbonato,
				qt_zero_um_bic,
				qt_um_dois_bic,
				qt_dois_tres_bic,
				qt_tres_quatro_bic,
				qt_quatro_cinco_bic,
				qt_cinco_seis_bic,
				nr_seq_perfil_bic,
				qt_quatro_cinco,
				qt_cinco_seis)
			SELECT
				nr_seq_hd_prescr_w,
				clock_timestamp(),
				nm_usuario_p,
				clock_timestamp(),
				nm_usuario_p,
				cd_protocolo_dest_p,
				nr_seq_destino_p,
				ie_tipo_hemodialise,
				qt_sessao_sem,
				qt_hora_sessao,
				qt_min_sessao,
				qt_fluxo_sangue,
				nr_seq_mod_dialisador,
				ie_ultrafiltracao,
				qt_ultrafiltracao,
				ie_tipo_peritoneal,
				dt_status,
				ie_status,
				ie_tipo_dialise,
				qt_volume_total,
				nr_seq_maq_cicladora,
				nr_seq_diametro_agulha,
				nr_seq_tipo_agulha_art,
				nr_seq_ultra,
				nr_seq_perfil_sodio,
				qt_zero_um,
				qt_um_dois,
				qt_dois_tres,
				qt_tres_quatro,
				ie_ligar_prime,
				qt_peso_seco,
				ds_observacao,
				ie_continuo,
				ie_categoria,
				qt_sodio,
				qt_bicarbonato,
				qt_zero_um_bic,
				qt_um_dois_bic,
				qt_dois_tres_bic,
				qt_tres_quatro_bic,
				qt_quatro_cinco_bic,
				qt_cinco_seis_bic,
				nr_seq_perfil_bic,
				qt_quatro_cinco,
				qt_cinco_seis
			from	protocolo_hd_prescricao
			where 	nr_sequencia	= nr_seq_prot_hd_prescricao_o_w;

			insert into protocolo_medic_solucao(
				cd_protocolo,
				nr_sequencia,
				nr_seq_solucao,
				nr_agrupamento,
				dt_atualizacao,
				nm_usuario,
				ie_tipo_dosagem,
				qt_dosagem,
				qt_volume,
				qt_solucao_total,
				qt_tempo_aplicacao,
				nr_etapas,
				ie_bomba_infusao,
				ds_horarios,
				ie_esquema_alternado,
				ie_calc_aut,
				ie_acm,
				qt_hora_fase,
				ds_rotina,
				ds_solucao,
				ie_tipo_solucao,
				qt_temp_solucao,
				ie_momento,
				ie_pos_dialisador,
				ie_hemodialise,
				nr_seq_protocolo,
				ie_unid_vel_inf,
				ds_orientacao,
				nr_seq_dialise,
				nr_seq_interno)
			SELECT
				cd_protocolo_dest_p,
				nr_seq_destino_p,
				nr_seq_solucao,
				nr_agrupamento,
				clock_timestamp(),
				nm_usuario_p,
				ie_tipo_dosagem,
				qt_dosagem,
				qt_volume,
				qt_solucao_total,
				qt_tempo_aplicacao,
				nr_etapas,
				ie_bomba_infusao,
				ds_horarios,
				ie_esquema_alternado,
				ie_calc_aut,
				ie_acm,
				qt_hora_fase,
				ds_rotina,
				ds_solucao,
				ie_tipo_solucao,
				qt_temp_solucao,
				ie_momento,
				ie_pos_dialisador,
				ie_hemodialise,
				nr_seq_protocolo,
				ie_unid_vel_inf,
				ds_orientacao,
				nr_seq_hd_prescr_w,
				nextval('protocolo_medic_solucao_seq')
			from	protocolo_medic_solucao
			where	nr_seq_dialise	= nr_seq_prot_hd_prescricao_o_w;
		end loop;
		close c05;
	end if;

	if (ie_gasoterapia_p = 'S') then

		open c06;
		loop
			fetch c06 into
				nr_seq_gasoterapia_origem_w;
			EXIT WHEN NOT FOUND; /* apply on c06 */

			/* obter sequencia protocolo HD prescri??o */

			select	nextval('protocolo_medic_gas_seq')
			into STRICT	nr_seq_gasoterapia_destino_w
			;

			insert into protocolo_medic_gas(
				nr_sequencia,
				dt_atualizacao,
				nm_usuario,
				dt_atualizacao_nrec,
				nm_usuario_nrec,
				ie_respiracao,
				ie_disp_resp_esp,
				cd_modalidade_vent,
				nr_seq_gas,
				ie_modo_adm,
				ie_inicio,
				ie_unidade_medida,
				qt_gasoterapia,
				qt_freq_vent,
				ds_observacao,
				cd_protocolo,
				nr_seq_protocolo,
				ie_rotina,
				nm_rotina)
			SELECT	nr_seq_gasoterapia_destino_w,
				clock_timestamp(),
				nm_usuario_p,
				clock_timestamp(),
				nm_usuario_p,
				ie_respiracao,
				ie_disp_resp_esp,
				cd_modalidade_vent,
				nr_seq_gas,
				ie_modo_adm,
				ie_inicio,
				ie_unidade_medida,
				qt_gasoterapia,
				qt_freq_vent,
				ds_observacao,
				cd_protocolo_dest_p,
				nr_seq_destino_p,
				ie_rotina,
				nm_rotina
			from	protocolo_medic_gas
			where	nr_sequencia = nr_seq_gasoterapia_origem_w;
		--Gasoterapia
		commit;

		open C16;
		loop
		fetch C16 into
			C16_w;
		EXIT WHEN NOT FOUND; /* apply on C16 */
			begin


			select	coalesce(max(nr_seq_material),0) +1
			into STRICT	nr_seq_material_dest_w
			from	protocolo_medic_material
			where	cd_protocolo = cd_protocolo_dest_p
			and	nr_sequencia = nr_seq_destino_p;


			insert into protocolo_medic_material(
					cd_protocolo,
					nr_sequencia,
					nr_seq_material,
					cd_material,
					qt_dose,
					cd_unidade_medida,
					ds_dias_aplicacao,
					dt_atualizacao,
					nm_usuario,
					nr_agrupamento,
					ds_recomendacao,
					ie_via_aplicacao,
					nr_seq_diluicao,
					nr_seq_dieta,
					nr_seq_proc,
					nr_seq_solucao,
					ie_agrupador,
					cd_intervalo,
					ds_horarios,
					ie_se_necessario,
					qt_minuto_aplicacao,
					ie_bomba_infusao,
					ie_aplic_bolus,
					ie_aplic_lenta,
					ie_acm,
					ds_dose_diferenciada,
					qt_solucao,
					hr_prim_horario,
					ie_urgencia,
					qt_hora_aplicacao,
					nr_seq_substituto,
					ie_intervalo_fixo,
					ie_multiplicar_dose,
					qt_dias_util,
					qt_dose_peso,
					qt_vel_infusao,
					ie_medic_rotina,
					ds_cor_rotina,
					ie_tipo_medic_hd,
					ie_lado,
					qt_hora_intervalo,
					qt_min_intervalo,
					ie_objetivo,
					qt_dias_prev_util,
					nr_seq_grupo,
					nr_seq_gas,
					ie_dados_medicamento)
				values (
					cd_protocolo_dest_p,
					nr_seq_destino_p,
					nr_seq_material_dest_w,
					c16_w.cd_material,
					c16_w.qt_dose,
					c16_w.cd_unidade_medida,
					c16_w.ds_dias_aplicacao,
					clock_timestamp(),
					nm_usuario_p,
					c16_w.nr_agrupamento,
					c16_w.ds_recomendacao,
					c16_w.ie_via_aplicacao,
					c16_w.nr_seq_diluicao,
					c16_w.nr_seq_dieta,
					c16_w.nr_seq_proc,
					c16_w.nr_seq_solucao,
					c16_w.ie_agrupador,
					c16_w.cd_intervalo,
					c16_w.ds_horarios,
					c16_w.ie_se_necessario,
					c16_w.qt_minuto_aplicacao,
					c16_w.ie_bomba_infusao,
					c16_w.ie_aplic_bolus,
					c16_w.ie_aplic_lenta,
					c16_w.ie_acm,
					c16_w.ds_dose_diferenciada,
					c16_w.qt_solucao,
					c16_w.hr_prim_horario,
					c16_w.ie_urgencia,
					c16_w.qt_hora_aplicacao,
					c16_w.nr_seq_substituto,
					coalesce(c16_w.ie_intervalo_fixo,'N'),
					c16_w.ie_multiplicar_dose,
					c16_w.qt_dias_util,
					c16_w.qt_dose_peso,
					c16_w.qt_vel_infusao,
					c16_w.ie_medic_rotina,
					c16_w.ds_cor_rotina,
					c16_w.ie_tipo_medic_hd,
					c16_w.ie_lado,
					c16_w.qt_hora_intervalo,
					c16_w.qt_min_intervalo,
					c16_w.ie_objetivo,
					c16_w.qt_dias_prev_util,
					c16_w.nr_seq_grupo,
					nr_seq_gasoterapia_destino_w,
					c16_w.ie_dados_medicamento);


			end;
		end loop;
		close C16;
		/*


			insert into protocolo_medic_material(
				cd_protocolo,
				nr_sequencia,
				nr_seq_material,
				cd_material,
				qt_dose,
				cd_unidade_medida,
				ds_dias_aplicacao,
				dt_atualizacao,
				nm_usuario,
				nr_agrupamento,
				ds_recomendacao,
				ie_via_aplicacao,
				nr_seq_diluicao,
				nr_seq_dieta,
				nr_seq_proc,
				nr_seq_solucao,
				ie_agrupador,
				cd_intervalo,
				ds_horarios,
				ie_se_necessario,
				qt_minuto_aplicacao,
				ie_bomba_infusao,
				ie_aplic_bolus,
				ie_aplic_lenta,
				ie_acm,
				ds_dose_diferenciada,
				qt_solucao,
				hr_prim_horario,
				ie_urgencia,
				qt_hora_aplicacao,
				nr_seq_substituto,
				ie_intervalo_fixo,
				ie_multiplicar_dose,
				qt_dias_util,
				qt_dose_peso,
				qt_vel_infusao,
				ie_medic_rotina,
				ds_cor_rotina,
				ie_tipo_medic_hd,
				ie_lado,
				qt_hora_intervalo,
				qt_min_intervalo,
				ie_objetivo,
				qt_dias_prev_util,
				nr_seq_grupo,
				nr_seq_gas)
			select
				cd_protocolo_dest_p,
				nr_seq_destino_p,
				nr_seq_material,
				cd_material,
				qt_dose,
				cd_unidade_medida,
				ds_dias_aplicacao,
				sysdate,
				nm_usuario_p,
				nr_agrupamento,
				ds_recomendacao,
				ie_via_aplicacao,
				nr_seq_diluicao,
				nr_seq_dieta,
				nr_seq_proc,
				nr_seq_solucao,
				ie_agrupador,
				cd_intervalo,
				ds_horarios,
				ie_se_necessario,
				qt_minuto_aplicacao,
				ie_bomba_infusao,
				ie_aplic_bolus,
				ie_aplic_lenta,
				ie_acm,
				ds_dose_diferenciada,
				qt_solucao,
				hr_prim_horario,
				ie_urgencia,
				qt_hora_aplicacao,
				nr_seq_substituto,
				nvl(ie_intervalo_fixo,'N'),
				ie_multiplicar_dose,
				qt_dias_util,
				qt_dose_peso,
				qt_vel_infusao,
				ie_medic_rotina,
				ds_cor_rotina,
				ie_tipo_medic_hd,
				ie_lado,
				qt_hora_intervalo,
				qt_min_intervalo,
				ie_objetivo,
				qt_dias_prev_util,
				nr_seq_grupo,
				nr_seq_gasoterapia_destino_w
			from 	protocolo_medic_material
			where 	cd_protocolo	= cd_protocolo_origem_p
			and	nr_sequencia	= nr_seq_origem_p
			and	nr_seq_gas 	= nr_seq_gasoterapia_origem_w;

			*/
		end loop;
		close c06;
	end if;

	if (ie_dispositivos_p = 'S') then
		insert into protocolo_dipositivo(
			nr_sequencia,
			cd_protocolo,
			nr_seq_disp,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_dispositivo,
			nr_seq_topografia,
			ie_lado,
			ds_titulo,
			qt_hora_permanencia,
			ds_compl_topografia,
			qt_hora_perm_curat,
			ds_observacao,
			qt_tentativas,
			qt_disp_utilizados,
			ie_acao)
		SELECT	nr_seq_destino_p,
			cd_protocolo_dest_p,
			nextval('protocolo_dipositivo_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_dispositivo,
			nr_seq_topografia,
			ie_lado,
			ds_titulo,
			qt_hora_permanencia,
			ds_compl_topografia,
			qt_hora_perm_curat,
			ds_observacao,
			qt_tentativas,
			qt_disp_utilizados,
			ie_acao
		from	protocolo_dipositivo
		where	nr_sequencia = nr_seq_origem_p
		and	cd_protocolo = cd_protocolo_origem_p;

	end if;

--Dietas
	if (ie_dieta_p = 'S') then
	open C09;
	loop
		fetch C09 into
			c09_w;
		EXIT WHEN NOT FOUND; /* apply on C09 */
			begin

			select	coalesce(max(nr_seq_material),0) +1
			into STRICT	nr_seq_material_dest_w
			from	protocolo_medic_material
			where	cd_protocolo = cd_protocolo_dest_p
			and	nr_sequencia = nr_seq_destino_p;

			insert into protocolo_medic_material(
				cd_protocolo,
				nr_sequencia,
				nr_seq_material,
				cd_material,
				qt_dose,
				cd_unidade_medida,
				ds_dias_aplicacao,
				dt_atualizacao,
				nm_usuario,
				nr_agrupamento,
				ds_recomendacao,
				ie_via_aplicacao,
				nr_seq_diluicao,
				nr_seq_dieta,
				nr_seq_proc,
				nr_seq_solucao,
				ie_agrupador,
				cd_intervalo,
				ds_horarios,
				ie_se_necessario,
				qt_minuto_aplicacao,
				ie_bomba_infusao,
				ie_aplic_bolus,
				ie_aplic_lenta,
				ie_acm,
				ds_dose_diferenciada,
				qt_solucao,
				hr_prim_horario,
				ie_urgencia,
				qt_hora_aplicacao,
				nr_seq_substituto,
				ie_intervalo_fixo,
				ie_multiplicar_dose,
				qt_dias_util,
				qt_dose_peso,
				qt_vel_infusao,
				ie_medic_rotina,
				ds_cor_rotina,
				ie_tipo_medic_hd,
				ie_lado,
				qt_hora_intervalo,
				qt_min_intervalo,
				ie_objetivo,
				qt_dias_prev_util,
				nr_seq_grupo,
				nr_seq_apresentacao,
				ds_rotina,
				ie_checar_adep,
				ie_pre_medicacao,
				ie_arredondar,
				ds_justificativa,
				ie_intervalo,
				ie_unidade_medida,
				ie_proporcao,
				qt_referencia,
				cd_topografia_cih,
				ie_alerta_via_adm,
				ie_kit,
				cd_microorganismo_cih,
				cd_amostra_cih,
				ie_origem_infeccao,
				ie_indicacao,
				ie_uso_antimicrobiano,
				ie_gerar_solucao,
				ds_ciclos_aplicacao,
				nr_seq_gas,
				ie_medicacao_paciente,
				cd_motivo_baixa,
				ie_dose_espec_agora,
				qt_dose_especial,
				hr_dose_especial,
				ie_justificativa,
				ie_alterar_dose,
				ie_aplicar,
				ie_dados_atb,
				ie_aplica_reducao,
				ie_dados_medicamento)
			Values (
				cd_protocolo_dest_p,
				nr_seq_destino_p,
				nr_seq_material_dest_w,
				c09_w.cd_material,
				c09_w.qt_dose,
				c09_w.cd_unidade_medida,
				c09_w.ds_dias_aplicacao,
				clock_timestamp(),
				nm_usuario_p,
				c09_w.nr_agrupamento,
				c09_w.ds_recomendacao,
				c09_w.ie_via_aplicacao,
				c09_w.nr_seq_diluicao,
				c09_w.nr_seq_dieta,
				c09_w.nr_seq_proc,
				c09_w.nr_seq_solucao,
				c09_w.ie_agrupador,
				c09_w.cd_intervalo,
				c09_w.ds_horarios,
				c09_w.ie_se_necessario,
				c09_w.qt_minuto_aplicacao,
				c09_w.ie_bomba_infusao,
				c09_w.ie_aplic_bolus,
				c09_w.ie_aplic_lenta,
				c09_w.ie_acm,
				c09_w.ds_dose_diferenciada,
				c09_w.qt_solucao,
				c09_w.hr_prim_horario,
				c09_w.ie_urgencia,
				c09_w.qt_hora_aplicacao,
				c09_w.nr_seq_substituto,
				coalesce(c09_w.ie_intervalo_fixo,'N'),
				c09_w.ie_multiplicar_dose,
				c09_w.qt_dias_util,
				c09_w.qt_dose_peso,
				c09_w.qt_vel_infusao,
				c09_w.ie_medic_rotina,
				c09_w.ds_cor_rotina,
				c09_w.ie_tipo_medic_hd,
				c09_w.ie_lado,
				c09_w.qt_hora_intervalo,
				c09_w.qt_min_intervalo,
				c09_w.ie_objetivo,
				c09_w.qt_dias_prev_util,
				c09_w.nr_seq_grupo,
				c09_w.NR_SEQ_APRESENTACAO,
				c09_w.ds_rotina,
				c09_w.ie_checar_adep,
				c09_w.ie_pre_medicacao,
				c09_w.ie_arredondar,
				c09_w.ds_justificativa,
				c09_w.ie_intervalo,
				c09_w.ie_unidade_medida,
				c09_w.ie_proporcao,
				c09_w.qt_referencia,
				c09_w.cd_topografia_cih,
				c09_w.ie_alerta_via_adm,
				c09_w.ie_kit,
				c09_w.cd_microorganismo_cih,
				c09_w.cd_amostra_cih,
				c09_w.ie_origem_infeccao,
				c09_w.ie_indicacao,
				c09_w.ie_uso_antimicrobiano,
				c09_w.ie_gerar_solucao,
				c09_w.ds_ciclos_aplicacao,
				c09_w.nr_seq_gas,
				c09_w.ie_medicacao_paciente,
				c09_w.cd_motivo_baixa,
				c09_w.ie_dose_espec_agora,
				c09_w.qt_dose_especial,
				c09_w.hr_dose_especial,
				c09_w.ie_justificativa,
				c09_w.ie_alterar_dose,
				c09_w.ie_aplicar,
				c09_w.ie_dados_atb,
				c09_w.ie_aplica_reducao,
				c09_w.ie_dados_medicamento);
			end;
	end loop;
	close C09;
	end if;

--Medicamentos
	if (ie_medicamento_p = 'S') then
		open C10;
		loop
		fetch C10 into
			nr_seq_material_origem_w;
		EXIT WHEN NOT FOUND; /* apply on C10 */
		begin	
			select	coalesce(max(nr_seq_material),0) +1
			into STRICT	nr_seq_material_dest_w
			from	protocolo_medic_material
			where	cd_protocolo = cd_protocolo_dest_p
			and	nr_sequencia = nr_seq_destino_p;

			ds_colunas_w	:= null;

			open C_COLUNAS_MEDIC;
			loop
			fetch C_COLUNAS_MEDIC into	
				nm_coluna_w;
			EXIT WHEN NOT FOUND; /* apply on C_COLUNAS_MEDIC */
				begin
					
				ds_colunas_w	:= ds_colunas_w || ', ' || nm_coluna_w;
				
				end;
			end loop;
			close C_COLUNAS_MEDIC;

			ds_insert_w := 'insert into protocolo_medic_material(cd_protocolo,
										nr_sequencia,
										nr_seq_material,
										dt_atualizacao,
										nm_usuario,
										ie_intervalo_fixo'
										|| ds_colunas_w || ')
							(select ' || cd_protocolo_dest_p || ',
									' || nr_seq_destino_p || ',
									' || nr_seq_material_dest_w || ',
									sysdate,
									'''||nm_usuario_p||''',
									nvl(ie_intervalo_fixo,''N'')
									' || ds_colunas_w ||
							' from	protocolo_medic_material
									where cd_protocolo = ' || cd_protocolo_origem_p || '
									and	nr_sequencia = ' || nr_seq_origem_p || '
									and nr_seq_material = ' || nr_seq_material_origem_w || '
									and	nr_seq_gas is null
									and ie_agrupador in (1,9,3,7)
									and nr_seq_diluicao is null
									and nr_seq_solucao is null)';
			CALL exec_sql_dinamico('Tasy', ds_insert_w);
			commit;	
			
			nr_seq_diluicao_w := nr_seq_material_origem_w;			
			
			open C12;
			loop
			fetch C12 into
				c12_w;
			EXIT WHEN NOT FOUND; /* apply on C12 */
				begin
				select	coalesce(max(nr_seq_material),0) +1
				into STRICT	nr_seq_material_dest2_w
				from	protocolo_medic_material
				where	cd_protocolo = cd_protocolo_dest_p
				and	nr_sequencia = nr_seq_destino_p;

				insert into protocolo_medic_material(
					cd_protocolo,
					nr_sequencia,
					nr_seq_material,
					cd_material,
					qt_dose,
					cd_unidade_medida,
					ds_dias_aplicacao,
					dt_atualizacao,
					nm_usuario,
					nr_agrupamento,
					ds_recomendacao,
					ie_via_aplicacao,
					nr_seq_diluicao,
					nr_seq_dieta,
					nr_seq_proc,
					nr_seq_solucao,
					ie_agrupador,
					cd_intervalo,
					ds_horarios,
					ie_se_necessario,
					qt_minuto_aplicacao,
					ie_bomba_infusao,
					ie_aplic_bolus,
					ie_aplic_lenta,
					ie_acm,
					ds_dose_diferenciada,
					qt_solucao,
					hr_prim_horario,
					ie_urgencia,
					qt_hora_aplicacao,
					nr_seq_substituto,
					ie_intervalo_fixo,
					ie_multiplicar_dose,
					qt_dias_util,
					qt_dose_peso,
					qt_vel_infusao,
					ie_medic_rotina,
					ds_cor_rotina,
					ie_tipo_medic_hd,
					ie_lado,
					qt_hora_intervalo,
					qt_min_intervalo,
					ie_objetivo,
					qt_dias_prev_util,
					nr_seq_grupo,
					nr_seq_apresentacao,
					ds_rotina,
					ie_checar_adep,
					ie_pre_medicacao,
					ie_arredondar,
					ds_justificativa,
					ie_intervalo,
					ie_unidade_medida,
					ie_proporcao,
					qt_referencia,
					cd_topografia_cih,
					ie_alerta_via_adm,
					ie_kit,
					cd_microorganismo_cih,
					cd_amostra_cih,
					ie_origem_infeccao,
					ie_indicacao,
					ie_uso_antimicrobiano,
					ie_gerar_solucao,
					ds_ciclos_aplicacao,
					nr_seq_gas,
					ie_medicacao_paciente,
					cd_motivo_baixa,
					ie_dose_espec_agora,
					qt_dose_especial,
					hr_dose_especial,
					ie_justificativa,
					ie_alterar_dose,
					ie_aplicar,
					ie_dados_atb,
					ie_aplica_reducao,
					ie_dados_medicamento)
				Values (
					cd_protocolo_dest_p,
					nr_seq_destino_p,
					nr_seq_material_dest2_w,
					c12_w.cd_material,
					c12_w.qt_dose,
					c12_w.cd_unidade_medida,
					c12_w.ds_dias_aplicacao,
					clock_timestamp(),
					nm_usuario_p,
					c12_w.nr_agrupamento,
					c12_w.ds_recomendacao,
					c12_w.ie_via_aplicacao,
					nr_seq_material_dest_w,
					c12_w.nr_seq_dieta,
					c12_w.nr_seq_proc,
					c12_w.nr_seq_solucao,
					c12_w.ie_agrupador,
					c12_w.cd_intervalo,
					c12_w.ds_horarios,
					c12_w.ie_se_necessario,
					c12_w.qt_minuto_aplicacao,
					c12_w.ie_bomba_infusao,
					c12_w.ie_aplic_bolus,
					c12_w.ie_aplic_lenta,
					c12_w.ie_acm,
					c12_w.ds_dose_diferenciada,
					c12_w.qt_solucao,
					c12_w.hr_prim_horario,
					c12_w.ie_urgencia,
					c12_w.qt_hora_aplicacao,
					c12_w.nr_seq_substituto,
					coalesce(c12_w.ie_intervalo_fixo,'N'),
					c12_w.ie_multiplicar_dose,
					c12_w.qt_dias_util,
					c12_w.qt_dose_peso,
					c12_w.qt_vel_infusao,
					c12_w.ie_medic_rotina,
					c12_w.ds_cor_rotina,
					c12_w.ie_tipo_medic_hd,
					c12_w.ie_lado,
					c12_w.qt_hora_intervalo,
					c12_w.qt_min_intervalo,
					c12_w.ie_objetivo,
					c12_w.qt_dias_prev_util,
					c12_w.nr_seq_grupo,
					c12_w.NR_SEQ_APRESENTACAO,
					c12_w.ds_rotina,
					c12_w.ie_checar_adep,
					c12_w.ie_pre_medicacao,
					c12_w.ie_arredondar,
					c12_w.ds_justificativa,
					c12_w.ie_intervalo,
					c12_w.ie_unidade_medida,
					c12_w.ie_proporcao,
					c12_w.qt_referencia,
					c12_w.cd_topografia_cih,
					c12_w.ie_alerta_via_adm,
					c12_w.ie_kit,
					c12_w.cd_microorganismo_cih,
					c12_w.cd_amostra_cih,
					c12_w.ie_origem_infeccao,
					c12_w.ie_indicacao,
					c12_w.ie_uso_antimicrobiano,
					c12_w.ie_gerar_solucao,
					c12_w.ds_ciclos_aplicacao,
					c12_w.nr_seq_gas,
					c12_w.ie_medicacao_paciente,
					c12_w.cd_motivo_baixa,
					c12_w.ie_dose_espec_agora,
					c12_w.qt_dose_especial,
					c12_w.hr_dose_especial,
					c12_w.ie_justificativa,
					c12_w.ie_alterar_dose,
					c12_w.ie_aplicar,
					c12_w.ie_dados_atb,
					c12_w.ie_aplica_reducao,
					c12_w.ie_dados_medicamento);
				end;
			end loop;
			close C12;
		end;
	end loop;
	close C10;
	end if;


	if (ie_material_p = 'S') then
	open C11;
	loop
	fetch C11 into
		c11_w;
	EXIT WHEN NOT FOUND; /* apply on C11 */
		begin

		select	coalesce(max(nr_seq_material),0) +1
		into STRICT	nr_seq_material_dest_w
		from	protocolo_medic_material
		where	cd_protocolo = cd_protocolo_dest_p
		and	nr_sequencia = nr_seq_destino_p;

		insert into protocolo_medic_material(
			cd_protocolo,
			nr_sequencia,
			nr_seq_material,
			cd_material,
			qt_dose,
			cd_unidade_medida,
			ds_dias_aplicacao,
			dt_atualizacao,
			nm_usuario,
			nr_agrupamento,
			ds_recomendacao,
			ie_via_aplicacao,
			nr_seq_diluicao,
			nr_seq_dieta,
			nr_seq_proc,
			nr_seq_solucao,
			ie_agrupador,
			cd_intervalo,
			ds_horarios,
			ie_se_necessario,
			qt_minuto_aplicacao,
			ie_bomba_infusao,
			ie_aplic_bolus,
			ie_aplic_lenta,
			ie_acm,
			ds_dose_diferenciada,
			qt_solucao,
			hr_prim_horario,
			ie_urgencia,
			qt_hora_aplicacao,
			nr_seq_substituto,
			ie_intervalo_fixo,
			ie_multiplicar_dose,
			qt_dias_util,
			qt_dose_peso,
			qt_vel_infusao,
			ie_medic_rotina,
			ds_cor_rotina,
			ie_tipo_medic_hd,
			ie_lado,
			qt_hora_intervalo,
			qt_min_intervalo,
			ie_objetivo,
			qt_dias_prev_util,
			nr_seq_grupo,
			nr_seq_apresentacao,
			ds_rotina,
			ie_checar_adep,
			ie_pre_medicacao,
			ie_arredondar,
			ds_justificativa,
			ie_intervalo,
			ie_unidade_medida,
			ie_proporcao,
			qt_referencia,
			cd_topografia_cih,
			ie_alerta_via_adm,
			ie_kit,
			cd_microorganismo_cih,
			cd_amostra_cih,
			ie_origem_infeccao,
			ie_indicacao,
			ie_uso_antimicrobiano,
			ie_gerar_solucao,
			ds_ciclos_aplicacao,
			nr_seq_gas,
			ie_medicacao_paciente,
			cd_motivo_baixa,
			ie_dose_espec_agora,
			qt_dose_especial,
			hr_dose_especial,
			ie_justificativa,
			ie_alterar_dose,
			ie_aplicar,
			ie_dados_atb,
			ie_aplica_reducao,
			ie_dados_medicamento)
		Values (
			cd_protocolo_dest_p,
			nr_seq_destino_p,
			nr_seq_material_dest_w,
			c11_w.cd_material,
			c11_w.qt_dose,
			c11_w.cd_unidade_medida,
			c11_w.ds_dias_aplicacao,
			clock_timestamp(),
			nm_usuario_p,
			c11_w.nr_agrupamento,
			c11_w.ds_recomendacao,
			c11_w.ie_via_aplicacao,
			c11_w.nr_seq_diluicao,
			c11_w.nr_seq_dieta,
			c11_w.nr_seq_proc,
			c11_w.nr_seq_solucao,
			c11_w.ie_agrupador,
			c11_w.cd_intervalo,
			c11_w.ds_horarios,
			c11_w.ie_se_necessario,
			c11_w.qt_minuto_aplicacao,
			c11_w.ie_bomba_infusao,
			c11_w.ie_aplic_bolus,
			c11_w.ie_aplic_lenta,
			c11_w.ie_acm,
			c11_w.ds_dose_diferenciada,
			c11_w.qt_solucao,
			c11_w.hr_prim_horario,
			c11_w.ie_urgencia,
			c11_w.qt_hora_aplicacao,
			c11_w.nr_seq_substituto,
			coalesce(c11_w.ie_intervalo_fixo,'N'),
			c11_w.ie_multiplicar_dose,
			c11_w.qt_dias_util,
			c11_w.qt_dose_peso,
			c11_w.qt_vel_infusao,
			c11_w.ie_medic_rotina,
			c11_w.ds_cor_rotina,
			c11_w.ie_tipo_medic_hd,
			c11_w.ie_lado,
			c11_w.qt_hora_intervalo,
			c11_w.qt_min_intervalo,
			c11_w.ie_objetivo,
			c11_w.qt_dias_prev_util,
			c11_w.nr_seq_grupo,
			c11_w.NR_SEQ_APRESENTACAO,
			c11_w.ds_rotina,
			c11_w.ie_checar_adep,
			c11_w.ie_pre_medicacao,
			c11_w.ie_arredondar,
			c11_w.ds_justificativa,
			c11_w.ie_intervalo,
			c11_w.ie_unidade_medida,
			c11_w.ie_proporcao,
			c11_w.qt_referencia,
			c11_w.cd_topografia_cih,
			c11_w.ie_alerta_via_adm,
			c11_w.ie_kit,
			c11_w.cd_microorganismo_cih,
			c11_w.cd_amostra_cih,
			c11_w.ie_origem_infeccao,
			c11_w.ie_indicacao,
			c11_w.ie_uso_antimicrobiano,
			c11_w.ie_gerar_solucao,
			c11_w.ds_ciclos_aplicacao,
			c11_w.nr_seq_gas,
			c11_w.ie_medicacao_paciente,
			c11_w.cd_motivo_baixa,
			c11_w.ie_dose_espec_agora,
			c11_w.qt_dose_especial,
			c11_w.hr_dose_especial,
			c11_w.ie_justificativa,
			c11_w.ie_alterar_dose,
			c11_w.ie_aplicar,
			c11_w.ie_dados_atb,
			c11_w.ie_aplica_reducao,
			c11_w.ie_dados_medicamento);
		end;
	end loop;
	close C11;
	end if;



	insert into prot_hd_prescr_sol_elem(
		nr_sequencia,
		cd_protocolo,
		nr_seq_medic,
		nr_seq_solucao,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_elemento,
		cd_unidade_medida,
		qt_elemento)
	SELECT
		nextval('prot_hd_prescr_sol_elem_seq'),
		cd_protocolo_dest_p,
		nr_seq_destino_p,
		nr_seq_solucao,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		nr_seq_elemento,
		cd_unidade_medida,
		qt_elemento
	from	prot_hd_prescr_sol_elem
	where	cd_protocolo	= cd_protocolo_origem_p
	and		nr_seq_medic	= nr_seq_destino_p;

end if;


COMMIT;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copiar_medicacao_protocolo ( cd_protocolo_origem_p bigint, nr_seq_origem_p bigint, nm_usuario_p text, cd_protocolo_dest_p bigint, nr_seq_destino_p bigint, ie_deletar_anteriores_p text default 'S', ie_dieta_p text DEFAULT NULL, ie_solucao_p text DEFAULT NULL, ie_medicamento_p text DEFAULT NULL, ie_material_p text DEFAULT NULL, ie_proc_exame_p text DEFAULT NULL, ie_recomendacao_p text DEFAULT NULL, ie_hemodialise_p text DEFAULT NULL, ie_delegacao_p text DEFAULT NULL, ie_categoria_topograf_p text DEFAULT NULL, ie_banco_sangue_p text DEFAULT NULL, ie_gasoterapia_p text DEFAULT NULL, ie_dispositivos_p text DEFAULT NULL, copiar_duracao_dia_trat_p text DEFAULT NULL, ie_frases_padroes_p text DEFAULT NULL) FROM PUBLIC;

