-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE san_classificar_reacao (nr_seq_reacao_p bigint, ie_classificacao_p bigint, ie_gravidade_p bigint, ie_correlacao_p bigint, ie_diagnostico_p bigint, cd_pf_classif_p text, ds_retorno_p INOUT text) AS $body$
DECLARE


dt_lib_medico_w 		timestamp;
dt_classificacao_w		timestamp;


BEGIN

select	dt_lib_medico,
	dt_classificacao
into STRICT	dt_lib_medico_w,
	dt_classificacao_w
from 	san_trans_reacao
where	nr_sequencia = nr_seq_reacao_p;

if (dt_lib_medico_w IS NOT NULL AND dt_lib_medico_w::text <> '') and (coalesce(dt_classificacao_w::text, '') = '') then
	update	san_trans_reacao
	set	ie_classificacao = ie_classificacao_p,
		ie_gravidade = ie_gravidade_p,
		ie_correlacao = ie_correlacao_p,
		ie_diagnostico = ie_diagnostico_p,
		cd_pf_classificacao = cd_pf_classif_p,
		dt_classificacao = clock_timestamp()
	where	nr_sequencia = nr_seq_reacao_p;

	commit;

	ds_retorno_p := substr(obter_texto_tasy(454493, wheb_usuario_pck.get_nr_seq_idioma),1,255);

elsif (coalesce(dt_lib_medico_w::text, '') = '') then
	ds_retorno_p := substr(obter_texto_tasy(454491, wheb_usuario_pck.get_nr_seq_idioma),1,255);

elsif (dt_classificacao_w IS NOT NULL AND dt_classificacao_w::text <> '') then
	ds_retorno_p := substr(obter_texto_tasy(454492, wheb_usuario_pck.get_nr_seq_idioma),1,255);
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE san_classificar_reacao (nr_seq_reacao_p bigint, ie_classificacao_p bigint, ie_gravidade_p bigint, ie_correlacao_p bigint, ie_diagnostico_p bigint, cd_pf_classif_p text, ds_retorno_p INOUT text) FROM PUBLIC;

