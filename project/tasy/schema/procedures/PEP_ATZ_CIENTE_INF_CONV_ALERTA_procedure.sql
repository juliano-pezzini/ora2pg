-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pep_atz_ciente_inf_conv_alerta ( nr_atendimento_p bigint, cd_medico_p text, ie_forma_aviso_p text, cd_estabelecimento_p bigint, nm_usuario_p text, ie_origem_proced_p INOUT text, ds_alerta_setor_p INOUT text) AS $body$
DECLARE

 
ie_tipo_atendimento_w		smallint;
ie_tipo_convenio_w		smallint;
cd_convenio_w 			integer;
cd_categoria_w 			varchar(10);
ie_origem_proced_w		bigint;
exibe_alerta_setor_atend_w 	varchar(255);
ds_alerta_setor_w		varchar(255);


BEGIN 
if (nr_atendimento_p IS NOT NULL AND nr_atendimento_p::text <> '') and (cd_medico_p IS NOT NULL AND cd_medico_p::text <> '') and (ie_forma_aviso_p IS NOT NULL AND ie_forma_aviso_p::text <> '') then 
	begin 
	CALL atualiza_medico_ciente(nr_atendimento_p, cd_medico_p, ie_forma_aviso_p, nm_usuario_p);
				 
	select	max(a.ie_tipo_atendimento), 
		max(a.ie_tipo_convenio), 
		max(b.cd_convenio), 
		max(b.cd_categoria) 
	into STRICT	ie_tipo_atendimento_w, 
		ie_tipo_convenio_w, 
		cd_convenio_w, 
		cd_categoria_w 
	from	atend_categoria_convenio b, 
		atendimento_paciente a 
	where	a.nr_atendimento = b.nr_atendimento 
	and	b.nr_seq_interno = obter_atecaco_atendimento(b.nr_atendimento) 
	and	a.nr_atendimento = nr_atendimento_p;		
 
	if (cd_convenio_w IS NOT NULL AND cd_convenio_w::text <> '') and (cd_convenio_w > 0) then 
		ie_origem_proced_w := obter_origem_proced_cat(cd_estabelecimento_p, ie_tipo_atendimento_w, ie_tipo_convenio_w, cd_convenio_w, cd_categoria_w);
 
		exibe_alerta_setor_atend_w := obter_param_usuario(281, 260, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, exibe_alerta_setor_atend_w);
 
		if (exibe_alerta_setor_atend_w = 'S') then		 
			begin 
			ds_alerta_setor_w := substr(obter_alerta_tempo_atend(nr_atendimento_p),1,255);
			end;
		end if;	
	end if;
	 
	end;
end if;
ie_origem_proced_p	:= ie_origem_proced_w;
ds_alerta_setor_p	:= ds_alerta_setor_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pep_atz_ciente_inf_conv_alerta ( nr_atendimento_p bigint, cd_medico_p text, ie_forma_aviso_p text, cd_estabelecimento_p bigint, nm_usuario_p text, ie_origem_proced_p INOUT text, ds_alerta_setor_p INOUT text) FROM PUBLIC;

