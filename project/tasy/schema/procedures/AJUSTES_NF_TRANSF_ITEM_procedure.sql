-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ajustes_nf_transf_item () AS $body$
DECLARE


c01 CURSOR FOR
	SELECT	' alter table NOTA_FISCAL_TRANSF_ITEM drop constraint '||constraint_name ds_comando
	from	user_constraints a
	where	table_name = 'NOTA_FISCAL_TRANSF_ITEM'
	and	constraint_type = 'R';

c02 CURSOR FOR
	SELECT	' drop index '||index_name ds_comando
	from	user_indexes a
	where	table_name = 'NOTA_FISCAL_TRANSF_ITEM'
	and	index_name <> 'NF_TITEM_PK';

ds_comando_w varchar(500);


BEGIN

/*
Excluir todas as CONSTRAINTS da tabela NOTA_FISCAL_TRANSF_ITEM
*/
open C01;
loop
fetch C01 into
	ds_comando_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin
	CALL exec_sql_dinamico('Tasy',ds_comando_w);
	end;
end loop;
close C01;

/*
Excluir todas os INDICES da tabela NOTA_FISCAL_TRANSF_ITEM
*/
open C02;
loop
fetch C02 into
	ds_comando_w;
EXIT WHEN NOT FOUND; /* apply on C02 */
	begin
	CALL exec_sql_dinamico('Tasy',ds_comando_w);
	end;
end loop;
close C02;

/*
Excluir todas as CONSTRAINTS da tabela NOTA_FISCAL_TRANSF_ITEM, do DICIONARIO
*/
begin

delete from INTEGRIDADE_atributo
where nm_tabela = 'NOTA_FISCAL_TRANSF_ITEM';

delete from INTEGRIDADE_referencial
where nm_tabela = 'NOTA_FISCAL_TRANSF_ITEM';

/*
Excluir todos os INDICES da tabela NOTA_FISCAL_TRANSF_ITEM, do DICIONARIO
*/
delete
from indice_atributo
where nm_tabela  = 'NOTA_FISCAL_TRANSF_ITEM'
and nm_indice <> 'NF_TITEM_PK';

delete
from indice
where nm_tabela  = 'NOTA_FISCAL_TRANSF_ITEM'
and nm_indice <> 'NF_TITEM_PK';

commit;
/*
Criar os INDICES no DICIONARIO
*/
insert into INDICE(NM_INDICE,DS_INDICE,IE_TIPO,IE_CRIAR_ALTERAR,IE_SITUACAO,DT_CRIACAO,IE_IGNORADO_CLIENTE,IE_CLASSIFICACAO,DS_MENSAGEM,NM_TABELA,DT_ATUALIZACAO,NM_USUARIO)
 values ('NF_TITEM_CENCUST_FK_I',' ','I','I','A',TO_DATE('02/12/2019 10:41:58','dd/mm/yyyy hh24:mi:ss'),'','IR','','NOTA_FISCAL_TRANSF_ITEM',TO_DATE('02/12/2019 10:41:58','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

 insert into INDICE_ATRIBUTO(NR_SEQUENCIA,NM_ATRIBUTO,DS_INDICE_FUNCTION,NM_TABELA,NM_INDICE,DT_ATUALIZACAO,NM_USUARIO)
 values (1,'CD_CENTRO_CUSTO_S','','NOTA_FISCAL_TRANSF_ITEM','NF_TITEM_CENCUST_FK_I',TO_DATE('02/12/2019 10:41:59','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

 insert into INDICE(NM_INDICE,DS_INDICE,IE_TIPO,IE_CRIAR_ALTERAR,IE_SITUACAO,DT_CRIACAO,IE_IGNORADO_CLIENTE,IE_CLASSIFICACAO,DS_MENSAGEM,NM_TABELA,DT_ATUALIZACAO,NM_USUARIO)
 values ('NF_TITEM_CENCUST_FK2_I',' ','I','I','A',TO_DATE('02/12/2019 10:39:35','dd/mm/yyyy hh24:mi:ss'),'','IR','','NOTA_FISCAL_TRANSF_ITEM',TO_DATE('02/12/2019 10:39:35','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

 insert into INDICE_ATRIBUTO(NR_SEQUENCIA,NM_ATRIBUTO,DS_INDICE_FUNCTION,NM_TABELA,NM_INDICE,DT_ATUALIZACAO,NM_USUARIO)
 values (1,'CD_CENTRO_CUSTO_E','','NOTA_FISCAL_TRANSF_ITEM','NF_TITEM_CENCUST_FK2_I',TO_DATE('02/12/2019 10:39:36','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

insert into INDICE(NM_INDICE,DS_INDICE,IE_TIPO,IE_CRIAR_ALTERAR,IE_SITUACAO,DT_CRIACAO,IE_IGNORADO_CLIENTE,IE_CLASSIFICACAO,DS_MENSAGEM,NM_TABELA,DT_ATUALIZACAO,NM_USUARIO)
 values ('NF_TITEM_CONCONT_FK_I',' ','I','I','A',TO_DATE('02/12/2019 10:41:26','dd/mm/yyyy hh24:mi:ss'),'','IR','','NOTA_FISCAL_TRANSF_ITEM',TO_DATE('02/12/2019 10:41:26','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

 insert into INDICE_ATRIBUTO(NR_SEQUENCIA,NM_ATRIBUTO,DS_INDICE_FUNCTION,NM_TABELA,NM_INDICE,DT_ATUALIZACAO,NM_USUARIO)
 values (1,'CD_CONTA_CONTABIL_S','','NOTA_FISCAL_TRANSF_ITEM','NF_TITEM_CONCONT_FK_I',TO_DATE('02/12/2019 10:41:28','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

 insert into INDICE(NM_INDICE,DS_INDICE,IE_TIPO,IE_CRIAR_ALTERAR,IE_SITUACAO,DT_CRIACAO,IE_IGNORADO_CLIENTE,IE_CLASSIFICACAO,DS_MENSAGEM,NM_TABELA,DT_ATUALIZACAO,NM_USUARIO)
 values ('NF_TITEM_CONCONT_FK2_I',' ','I','I','A',TO_DATE('02/12/2019 10:38:47','dd/mm/yyyy hh24:mi:ss'),'','IR','','NOTA_FISCAL_TRANSF_ITEM',TO_DATE('02/12/2019 10:38:47','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

 insert into INDICE_ATRIBUTO(NR_SEQUENCIA,NM_ATRIBUTO,DS_INDICE_FUNCTION,NM_TABELA,NM_INDICE,DT_ATUALIZACAO,NM_USUARIO)
 values (1,'CD_CONTA_CONTABIL_E','','NOTA_FISCAL_TRANSF_ITEM','NF_TITEM_CONCONT_FK2_I',TO_DATE('02/12/2019 10:38:48','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

 insert into INDICE(NM_INDICE,DS_INDICE,IE_TIPO,IE_CRIAR_ALTERAR,IE_SITUACAO,DT_CRIACAO,IE_IGNORADO_CLIENTE,IE_CLASSIFICACAO,DS_MENSAGEM,NM_TABELA,DT_ATUALIZACAO,NM_USUARIO)
 values ('NF_TITEM_LOCESTO_FK_I',' ','I','I','A',TO_DATE('02/12/2019 10:42:29','dd/mm/yyyy hh24:mi:ss'),'','IR','','NOTA_FISCAL_TRANSF_ITEM',TO_DATE('02/12/2019 10:42:29','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

 insert into INDICE_ATRIBUTO(NR_SEQUENCIA,NM_ATRIBUTO,DS_INDICE_FUNCTION,NM_TABELA,NM_INDICE,DT_ATUALIZACAO,NM_USUARIO)
 values (1,'CD_LOCAL_ESTOQUE_S','','NOTA_FISCAL_TRANSF_ITEM','NF_TITEM_LOCESTO_FK_I',TO_DATE('02/12/2019 10:42:30','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

 insert into INDICE(NM_INDICE,DS_INDICE,IE_TIPO,IE_CRIAR_ALTERAR,IE_SITUACAO,DT_CRIACAO,IE_IGNORADO_CLIENTE,IE_CLASSIFICACAO,DS_MENSAGEM,NM_TABELA,DT_ATUALIZACAO,NM_USUARIO)
 values ('NF_TITEM_LOCESTO_FK2_I',' ','I','I','A',TO_DATE('02/12/2019 10:40:16','dd/mm/yyyy hh24:mi:ss'),'','IR','','NOTA_FISCAL_TRANSF_ITEM',TO_DATE('02/12/2019 10:40:16','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

 insert into INDICE_ATRIBUTO(NR_SEQUENCIA,NM_ATRIBUTO,DS_INDICE_FUNCTION,NM_TABELA,NM_INDICE,DT_ATUALIZACAO,NM_USUARIO)
 values (1,'CD_LOCAL_ESTOQUE_E','','NOTA_FISCAL_TRANSF_ITEM','NF_TITEM_LOCESTO_FK2_I',TO_DATE('02/12/2019 10:40:17','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

 insert into INDICE(NM_INDICE,DS_INDICE,IE_TIPO,IE_CRIAR_ALTERAR,IE_SITUACAO,DT_CRIACAO,IE_IGNORADO_CLIENTE,IE_CLASSIFICACAO,DS_MENSAGEM,NM_TABELA,DT_ATUALIZACAO,NM_USUARIO)
 values ('NF_TITEM_MATERIA_FK_I',' ','I','I','A',TO_DATE('02/12/2019 10:44:26','dd/mm/yyyy hh24:mi:ss'),'','IR','','NOTA_FISCAL_TRANSF_ITEM',TO_DATE('02/12/2019 10:44:26','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

 insert into INDICE_ATRIBUTO(NR_SEQUENCIA,NM_ATRIBUTO,DS_INDICE_FUNCTION,NM_TABELA,NM_INDICE,DT_ATUALIZACAO,NM_USUARIO)
 values (1,'CD_MATERIAL','','NOTA_FISCAL_TRANSF_ITEM','NF_TITEM_MATERIA_FK_I',TO_DATE('02/12/2019 10:44:28','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

 insert into INDICE(NM_INDICE,DS_INDICE,IE_TIPO,IE_CRIAR_ALTERAR,IE_SITUACAO,DT_CRIACAO,IE_IGNORADO_CLIENTE,IE_CLASSIFICACAO,DS_MENSAGEM,NM_TABELA,DT_ATUALIZACAO,NM_USUARIO)
 values ('NF_TITEM_NATOPER_FK_I',' ','I','I','A',TO_DATE('02/12/2019 10:43:02','dd/mm/yyyy hh24:mi:ss'),'','IR','','NOTA_FISCAL_TRANSF_ITEM',TO_DATE('02/12/2019 10:43:02','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

 insert into INDICE_ATRIBUTO(NR_SEQUENCIA,NM_ATRIBUTO,DS_INDICE_FUNCTION,NM_TABELA,NM_INDICE,DT_ATUALIZACAO,NM_USUARIO)
 values (1,'CD_NATUREZA_OPERACAO_S','','NOTA_FISCAL_TRANSF_ITEM','NF_TITEM_NATOPER_FK_I',TO_DATE('02/12/2019 10:43:03','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

 insert into INDICE(NM_INDICE,DS_INDICE,IE_TIPO,IE_CRIAR_ALTERAR,IE_SITUACAO,DT_CRIACAO,IE_IGNORADO_CLIENTE,IE_CLASSIFICACAO,DS_MENSAGEM,NM_TABELA,DT_ATUALIZACAO,NM_USUARIO)
 values ('NF_TITEM_NATOPER_FK2_I',' ','I','I','A',TO_DATE('02/12/2019 10:40:55','dd/mm/yyyy hh24:mi:ss'),'','IR','','NOTA_FISCAL_TRANSF_ITEM',TO_DATE('02/12/2019 10:40:55','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

 insert into INDICE_ATRIBUTO(NR_SEQUENCIA,NM_ATRIBUTO,DS_INDICE_FUNCTION,NM_TABELA,NM_INDICE,DT_ATUALIZACAO,NM_USUARIO)
 values (1,'CD_NATUREZA_OPERACAO_E','','NOTA_FISCAL_TRANSF_ITEM','NF_TITEM_NATOPER_FK2_I',TO_DATE('02/12/2019 10:40:56','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

 insert into INDICE(NM_INDICE,DS_INDICE,IE_TIPO,IE_CRIAR_ALTERAR,IE_SITUACAO,DT_CRIACAO,IE_IGNORADO_CLIENTE,IE_CLASSIFICACAO,DS_MENSAGEM,NM_TABELA,DT_ATUALIZACAO,NM_USUARIO)
 values ('NF_TITEM_NFTRANS_FK_I',' ','I','I','A',TO_DATE('02/12/2019 10:44:19','dd/mm/yyyy hh24:mi:ss'),'','IR','','NOTA_FISCAL_TRANSF_ITEM',TO_DATE('02/12/2019 10:44:19','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

 insert into INDICE_ATRIBUTO(NR_SEQUENCIA,NM_ATRIBUTO,DS_INDICE_FUNCTION,NM_TABELA,NM_INDICE,DT_ATUALIZACAO,NM_USUARIO)
 values (1,'NR_SEQ_NOTA_FISCAL_TRANS','','NOTA_FISCAL_TRANSF_ITEM','NF_TITEM_NFTRANS_FK_I',TO_DATE('02/12/2019 10:44:21','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

 insert into INDICE(NM_INDICE,DS_INDICE,IE_TIPO,IE_CRIAR_ALTERAR,IE_SITUACAO,DT_CRIACAO,IE_IGNORADO_CLIENTE,IE_CLASSIFICACAO,DS_MENSAGEM,NM_TABELA,DT_ATUALIZACAO,NM_USUARIO)
 values ('NF_TITEM_PROCEDI_FK_I',' ','I','I','A',TO_DATE('02/12/2019 10:43:28','dd/mm/yyyy hh24:mi:ss'),'','IR','','NOTA_FISCAL_TRANSF_ITEM',TO_DATE('02/12/2019 10:43:28','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

 insert into INDICE_ATRIBUTO(NR_SEQUENCIA,NM_ATRIBUTO,DS_INDICE_FUNCTION,NM_TABELA,NM_INDICE,DT_ATUALIZACAO,NM_USUARIO)
 values (1,'CD_PROCEDIMENTO','','NOTA_FISCAL_TRANSF_ITEM','NF_TITEM_PROCEDI_FK_I',TO_DATE('02/12/2019 10:43:30','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

 insert into INDICE_ATRIBUTO(NR_SEQUENCIA,NM_ATRIBUTO,DS_INDICE_FUNCTION,NM_TABELA,NM_INDICE,DT_ATUALIZACAO,NM_USUARIO)
 values (2,'IE_ORIGEM_PROCED','','NOTA_FISCAL_TRANSF_ITEM','NF_TITEM_PROCEDI_FK_I',TO_DATE('02/12/2019 10:43:31','dd/mm/yyyy hh24:mi:ss'),'abortoloso');

commit;

/*
Criar as CONSTRAINTS no DICIONARIO
*/
insert into INTEGRIDADE_REFERENCIAL(NM_TABELA_REFERENCIA,NM_INTEGRIDADE_REFERENCIAL,DS_INTEGRIDADE_REFERENCIAL,IE_REGRA_DELECAO,IE_CRIAR_ALTERAR,IE_SITUACAO,DT_CRIACAO,NM_TABELA,DT_ATUALIZACAO,NM_USUARIO)
 values ('CONTA_CONTABIL','NF_TITEM_CONCONT_FK2','','NO ACTION','I','A',TO_DATE('24/10/2019 17:07:13','dd/mm/yyyy hh24:mi:ss'),'NOTA_FISCAL_TRANSF_ITEM',TO_DATE('24/10/2019 17:07:22','dd/mm/yyyy hh24:mi:ss'),'esrodrigues');

insert into INTEGRIDADE_ATRIBUTO(IE_SEQUENCIA_CRIACAO,NM_ATRIBUTO,NM_ATRIBUTO_REF,NM_TABELA,NM_INTEGRIDADE_REFERENCIAL,DT_ATUALIZACAO,NM_USUARIO)
 values (1,'CD_CONTA_CONTABIL_E','','NOTA_FISCAL_TRANSF_ITEM','NF_TITEM_CONCONT_FK2',TO_DATE('24/10/2019 17:07:32','dd/mm/yyyy hh24:mi:ss'),'esrodrigues');


insert into INTEGRIDADE_REFERENCIAL(NM_TABELA_REFERENCIA,NM_INTEGRIDADE_REFERENCIAL,DS_INTEGRIDADE_REFERENCIAL,IE_REGRA_DELECAO,IE_CRIAR_ALTERAR,IE_SITUACAO,DT_CRIACAO,NM_TABELA,DT_ATUALIZACAO,NM_USUARIO) 
 values ('CENTRO_CUSTO','NF_TITEM_CENCUST_FK2','','NO ACTION','I','A',TO_DATE('24/10/2019 17:07:41','dd/mm/yyyy hh24:mi:ss'),'NOTA_FISCAL_TRANSF_ITEM',TO_DATE('24/10/2019 17:07:48','dd/mm/yyyy hh24:mi:ss'),'esrodrigues');


insert into INTEGRIDADE_ATRIBUTO(IE_SEQUENCIA_CRIACAO,NM_ATRIBUTO,NM_ATRIBUTO_REF,NM_TABELA,NM_INTEGRIDADE_REFERENCIAL,DT_ATUALIZACAO,NM_USUARIO)
 values (1,'CD_CENTRO_CUSTO_E','','NOTA_FISCAL_TRANSF_ITEM','NF_TITEM_CENCUST_FK2',TO_DATE('24/10/2019 17:07:59','dd/mm/yyyy hh24:mi:ss'),'esrodrigues');


insert into INTEGRIDADE_REFERENCIAL(NM_TABELA_REFERENCIA,NM_INTEGRIDADE_REFERENCIAL,DS_INTEGRIDADE_REFERENCIAL,IE_REGRA_DELECAO,IE_CRIAR_ALTERAR,IE_SITUACAO,DT_CRIACAO,NM_TABELA,DT_ATUALIZACAO,NM_USUARIO)
 values ('LOCAL_ESTOQUE','NF_TITEM_LOCESTO_FK2','','NO ACTION','I','A',TO_DATE('24/10/2019 17:08:20','dd/mm/yyyy hh24:mi:ss'),'NOTA_FISCAL_TRANSF_ITEM',TO_DATE('24/10/2019 17:08:28','dd/mm/yyyy hh24:mi:ss'),'esrodrigues');


insert into INTEGRIDADE_ATRIBUTO(IE_SEQUENCIA_CRIACAO,NM_ATRIBUTO,NM_ATRIBUTO_REF,NM_TABELA,NM_INTEGRIDADE_REFERENCIAL,DT_ATUALIZACAO,NM_USUARIO)
 values (1,'CD_LOCAL_ESTOQUE_E','','NOTA_FISCAL_TRANSF_ITEM','NF_TITEM_LOCESTO_FK2',TO_DATE('24/10/2019 17:08:43','dd/mm/yyyy hh24:mi:ss'),'esrodrigues');



insert into INTEGRIDADE_REFERENCIAL(NM_TABELA_REFERENCIA,NM_INTEGRIDADE_REFERENCIAL,DS_INTEGRIDADE_REFERENCIAL,IE_REGRA_DELECAO,IE_CRIAR_ALTERAR,IE_SITUACAO,DT_CRIACAO,NM_TABELA,DT_ATUALIZACAO,NM_USUARIO)
 values ('NATUREZA_OPERACAO','NF_TITEM_NATOPER_FK2','','NO ACTION','I','A',TO_DATE('24/10/2019 17:08:57','dd/mm/yyyy hh24:mi:ss'),'NOTA_FISCAL_TRANSF_ITEM',TO_DATE('24/10/2019 17:09:06','dd/mm/yyyy hh24:mi:ss'),'esrodrigues');


insert into INTEGRIDADE_ATRIBUTO(IE_SEQUENCIA_CRIACAO,NM_ATRIBUTO,NM_ATRIBUTO_REF,NM_TABELA,NM_INTEGRIDADE_REFERENCIAL,DT_ATUALIZACAO,NM_USUARIO)
 values (1,'CD_NATUREZA_OPERACAO_E','','NOTA_FISCAL_TRANSF_ITEM','NF_TITEM_NATOPER_FK2',TO_DATE('24/10/2019 17:09:18','dd/mm/yyyy hh24:mi:ss'),'esrodrigues');



insert into INTEGRIDADE_REFERENCIAL(NM_TABELA_REFERENCIA,NM_INTEGRIDADE_REFERENCIAL,DS_INTEGRIDADE_REFERENCIAL,IE_REGRA_DELECAO,IE_CRIAR_ALTERAR,IE_SITUACAO,DT_CRIACAO,NM_TABELA,DT_ATUALIZACAO,NM_USUARIO)
 values ('CONTA_CONTABIL','NF_TITEM_CONCONT_FK','','NO ACTION','I','A',TO_DATE('24/10/2019 16:30:15','dd/mm/yyyy hh24:mi:ss'),'NOTA_FISCAL_TRANSF_ITEM',TO_DATE('24/10/2019 17:02:27','dd/mm/yyyy hh24:mi:ss'),'esrodrigues');


insert into INTEGRIDADE_ATRIBUTO(IE_SEQUENCIA_CRIACAO,NM_ATRIBUTO,NM_ATRIBUTO_REF,NM_TABELA,NM_INTEGRIDADE_REFERENCIAL,DT_ATUALIZACAO,NM_USUARIO)
 values (1,'CD_CONTA_CONTABIL_S','','NOTA_FISCAL_TRANSF_ITEM','NF_TITEM_CONCONT_FK',TO_DATE('24/10/2019 17:07:04','dd/mm/yyyy hh24:mi:ss'),'esrodrigues');



insert into INTEGRIDADE_REFERENCIAL(NM_TABELA_REFERENCIA,NM_INTEGRIDADE_REFERENCIAL,DS_INTEGRIDADE_REFERENCIAL,IE_REGRA_DELECAO,IE_CRIAR_ALTERAR,IE_SITUACAO,DT_CRIACAO,NM_TABELA,DT_ATUALIZACAO,NM_USUARIO)
 values ('CENTRO_CUSTO','NF_TITEM_CENCUST_FK','','NO ACTION','I','A',TO_DATE('24/10/2019 16:30:22','dd/mm/yyyy hh24:mi:ss'),'NOTA_FISCAL_TRANSF_ITEM',TO_DATE('24/10/2019 17:02:15','dd/mm/yyyy hh24:mi:ss'),'esrodrigues');


insert into INTEGRIDADE_ATRIBUTO(IE_SEQUENCIA_CRIACAO,NM_ATRIBUTO,NM_ATRIBUTO_REF,NM_TABELA,NM_INTEGRIDADE_REFERENCIAL,DT_ATUALIZACAO,NM_USUARIO)
 values (1,'CD_CENTRO_CUSTO_S','','NOTA_FISCAL_TRANSF_ITEM','NF_TITEM_CENCUST_FK',TO_DATE('24/10/2019 17:06:48','dd/mm/yyyy hh24:mi:ss'),'esrodrigues');



insert into INTEGRIDADE_REFERENCIAL(NM_TABELA_REFERENCIA,NM_INTEGRIDADE_REFERENCIAL,DS_INTEGRIDADE_REFERENCIAL,IE_REGRA_DELECAO,IE_CRIAR_ALTERAR,IE_SITUACAO,DT_CRIACAO,NM_TABELA,DT_ATUALIZACAO,NM_USUARIO)
 values ('LOCAL_ESTOQUE','NF_TITEM_LOCESTO_FK','','NO ACTION','I','A',TO_DATE('24/10/2019 16:30:30','dd/mm/yyyy hh24:mi:ss'),'NOTA_FISCAL_TRANSF_ITEM',TO_DATE('24/10/2019 17:02:37','dd/mm/yyyy hh24:mi:ss'),'esrodrigues');


insert into INTEGRIDADE_ATRIBUTO(IE_SEQUENCIA_CRIACAO,NM_ATRIBUTO,NM_ATRIBUTO_REF,NM_TABELA,NM_INTEGRIDADE_REFERENCIAL,DT_ATUALIZACAO,NM_USUARIO)
 values (1,'CD_LOCAL_ESTOQUE_S','','NOTA_FISCAL_TRANSF_ITEM','NF_TITEM_LOCESTO_FK',TO_DATE('24/10/2019 17:06:33','dd/mm/yyyy hh24:mi:ss'),'esrodrigues');

insert into INTEGRIDADE_REFERENCIAL(NM_TABELA_REFERENCIA,NM_INTEGRIDADE_REFERENCIAL,DS_INTEGRIDADE_REFERENCIAL,IE_REGRA_DELECAO,IE_CRIAR_ALTERAR,IE_SITUACAO,DT_CRIACAO,NM_TABELA,DT_ATUALIZACAO,NM_USUARIO)
 values ('NATUREZA_OPERACAO','NF_TITEM_NATOPER_FK','','NO ACTION','I','A',TO_DATE('24/10/2019 16:30:38','dd/mm/yyyy hh24:mi:ss'),'NOTA_FISCAL_TRANSF_ITEM',TO_DATE('24/10/2019 17:06:01','dd/mm/yyyy hh24:mi:ss'),'esrodrigues');

insert into INTEGRIDADE_ATRIBUTO(IE_SEQUENCIA_CRIACAO,NM_ATRIBUTO,NM_ATRIBUTO_REF,NM_TABELA,NM_INTEGRIDADE_REFERENCIAL,DT_ATUALIZACAO,NM_USUARIO)
 values (1,'CD_NATUREZA_OPERACAO_S','','NOTA_FISCAL_TRANSF_ITEM','NF_TITEM_NATOPER_FK',TO_DATE('24/10/2019 17:06:17','dd/mm/yyyy hh24:mi:ss'),'esrodrigues');

commit;
exception
when others then
	null;
end;

/*
Criar os INDICES e CONSTRAINTS no BANCO
*/
CALL exec_sql_dinamico('Tasy','CREATE INDEX NF_TITEM_CONCONT_FK2_I ON NOTA_FISCAL_TRANSF_ITEM(CD_CONTA_CONTABIL_E)');
CALL exec_sql_dinamico('Tasy','CREATE INDEX NF_TITEM_CENCUST_FK2_I ON NOTA_FISCAL_TRANSF_ITEM(CD_CENTRO_CUSTO_E)');
CALL exec_sql_dinamico('Tasy','CREATE INDEX NF_TITEM_LOCESTO_FK2_I ON NOTA_FISCAL_TRANSF_ITEM(CD_LOCAL_ESTOQUE_E)');
CALL exec_sql_dinamico('Tasy','CREATE INDEX NF_TITEM_NATOPER_FK2_I ON NOTA_FISCAL_TRANSF_ITEM(CD_NATUREZA_OPERACAO_E)');
CALL exec_sql_dinamico('Tasy','CREATE INDEX NF_TITEM_CONCONT_FK_I ON NOTA_FISCAL_TRANSF_ITEM(CD_CONTA_CONTABIL_S)');
CALL exec_sql_dinamico('Tasy','CREATE INDEX NF_TITEM_CENCUST_FK_I ON NOTA_FISCAL_TRANSF_ITEM(CD_CENTRO_CUSTO_S)');
CALL exec_sql_dinamico('Tasy','CREATE INDEX NF_TITEM_LOCESTO_FK_I ON NOTA_FISCAL_TRANSF_ITEM(CD_LOCAL_ESTOQUE_S)');
CALL exec_sql_dinamico('Tasy','CREATE INDEX NF_TITEM_NATOPER_FK_I ON NOTA_FISCAL_TRANSF_ITEM(CD_NATUREZA_OPERACAO_S)');
CALL exec_sql_dinamico('Tasy','CREATE INDEX NF_TITEM_PROCEDI_FK_I ON NOTA_FISCAL_TRANSF_ITEM(CD_PROCEDIMENTO,IE_ORIGEM_PROCED)');
CALL exec_sql_dinamico('Tasy','CREATE INDEX NF_TITEM_NFTRANS_FK_I ON NOTA_FISCAL_TRANSF_ITEM(NR_SEQ_NOTA_FISCAL_TRANS)');
CALL exec_sql_dinamico('Tasy','CREATE INDEX NF_TITEM_MATERIA_FK_I ON NOTA_FISCAL_TRANSF_ITEM(CD_MATERIAL)');
CALL exec_sql_dinamico('Tasy','ALTER TABLE NOTA_FISCAL_TRANSF_ITEM ADD (CONSTRAINT NF_TITEM_PROCEDI_FK FOREIGN KEY (CD_PROCEDIMENTO,IE_ORIGEM_PROCED) REFERENCES PROCEDIMENTO (CD_PROCEDIMENTO,IE_ORIGEM_PROCED))');
CALL exec_sql_dinamico('Tasy','ALTER TABLE NOTA_FISCAL_TRANSF_ITEM ADD (CONSTRAINT NF_TITEM_CONCONT_FK2 FOREIGN KEY (CD_CONTA_CONTABIL_E) REFERENCES CONTA_CONTABIL (CD_CONTA_CONTABIL))');
CALL exec_sql_dinamico('Tasy','ALTER TABLE NOTA_FISCAL_TRANSF_ITEM ADD ( CONSTRAINT NF_TITEM_CENCUST_FK2 FOREIGN KEY ( CD_CENTRO_CUSTO_E ) REFERENCES CENTRO_CUSTO (CD_CENTRO_CUSTO))');
CALL exec_sql_dinamico('Tasy','ALTER TABLE NOTA_FISCAL_TRANSF_ITEM ADD (CONSTRAINT NF_TITEM_LOCESTO_FK2 FOREIGN KEY (CD_LOCAL_ESTOQUE_E ) REFERENCES LOCAL_ESTOQUE (CD_LOCAL_ESTOQUE))');
CALL exec_sql_dinamico('Tasy','ALTER TABLE NOTA_FISCAL_TRANSF_ITEM ADD (CONSTRAINT NF_TITEM_NATOPER_FK2 FOREIGN KEY (CD_NATUREZA_OPERACAO_E ) REFERENCES NATUREZA_OPERACAO (CD_NATUREZA_OPERACAO))');
CALL exec_sql_dinamico('Tasy','ALTER TABLE NOTA_FISCAL_TRANSF_ITEM ADD (CONSTRAINT NF_TITEM_NFTRANS_FK FOREIGN KEY (NR_SEQ_NOTA_FISCAL_TRANS ) REFERENCES NOTA_FISCAL_TRANSFERENCIA (NR_SEQUENCIA))');
CALL exec_sql_dinamico('Tasy','ALTER TABLE NOTA_FISCAL_TRANSF_ITEM ADD (CONSTRAINT NF_TITEM_CONCONT_FK FOREIGN KEY (CD_CONTA_CONTABIL_S ) REFERENCES CONTA_CONTABIL (CD_CONTA_CONTABIL))');
CALL exec_sql_dinamico('Tasy','ALTER TABLE NOTA_FISCAL_TRANSF_ITEM ADD (CONSTRAINT NF_TITEM_CENCUST_FK FOREIGN KEY (CD_CENTRO_CUSTO_S ) REFERENCES CENTRO_CUSTO (CD_CENTRO_CUSTO))');
CALL exec_sql_dinamico('Tasy','ALTER TABLE NOTA_FISCAL_TRANSF_ITEM ADD (CONSTRAINT NF_TITEM_LOCESTO_FK FOREIGN KEY (CD_LOCAL_ESTOQUE_S ) REFERENCES LOCAL_ESTOQUE (CD_LOCAL_ESTOQUE))');
CALL exec_sql_dinamico('Tasy','ALTER TABLE NOTA_FISCAL_TRANSF_ITEM ADD (CONSTRAINT NF_TITEM_MATERIA_FK FOREIGN KEY (CD_MATERIAL ) REFERENCES MATERIAL (CD_MATERIAL))');
CALL exec_sql_dinamico('Tasy','ALTER TABLE NOTA_FISCAL_TRANSF_ITEM ADD (CONSTRAINT NF_TITEM_NATOPER_FK FOREIGN KEY (CD_NATUREZA_OPERACAO_S ) REFERENCES NATUREZA_OPERACAO (CD_NATUREZA_OPERACAO))');

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ajustes_nf_transf_item () FROM PUBLIC;

