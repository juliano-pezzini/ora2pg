-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_ajust_int_test_pend (nr_seq_intencao_uso_p bigint, ds_version_p text, nm_usuario_p text) AS $body$
BEGIN

  if (nr_seq_intencao_uso_p IS NOT NULL AND nr_seq_intencao_uso_p::text <> '') then

    insert into reg_integrated_test_pend(nr_sequencia,
       dt_atualizacao,
       nm_usuario,
       dt_atualizacao_nrec,
       nm_usuario_nrec,
       nr_seq_controle,
       nr_seq_tc,
       nr_seq_intencao_uso,
       ie_status,
       nr_seq_integrated_test)
      SELECT nextval('reg_integrated_test_pend_seq'),
             ct.dt_atualizacao,
             ct.nm_usuario,
             ct.dt_atualizacao_nrec,
             ct.nm_usuario_nrec,
             itc.nr_sequencia,
             ct.nr_sequencia,
             ct.nr_seq_intencao_uso,
             'P',
             prs.nr_seq_integrated_test
        from reg_caso_teste ct
       inner join reg_integrated_test_prs prs on (prs.nr_seq_product_req =
                                                 ct.nr_seq_product)
       inner join w_test_plan_ignored_int w on (w.nr_seq_integrated_test =
                                               prs.nr_seq_integrated_test)
       inner join reg_integrated_test_cont itc ON (itc.nr_seq_intencao_uso =
                                                  ct.nr_seq_intencao_uso and
                                                  itc.cd_versao =
                                                  w.ds_version)
       where ct.nr_seq_intencao_uso = nr_seq_intencao_uso_p
         and w.IE_TIPO_OPERACAO = 'I'
         and w.ds_version = ds_version_p
         and w.nm_usuario = nm_usuario_p
         and itc.ie_situacao = 'A'
         and coalesce(itc.dt_fim::text, '') = '';

    delete from (SELECT w.*
                   from w_test_plan_ignored_int w, reg_integrated_test t
                  where w.nr_seq_integrated_test = t.nr_sequencia
                    and w.ie_tipo_operacao = 'I'
                    and w.nm_usuario = nm_usuario_p
                    and w.ds_version = ds_version_p
                    and t.nr_seq_intencao_uso = nr_seq_intencao_uso_p) alias0;

    commit;

  end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_ajust_int_test_pend (nr_seq_intencao_uso_p bigint, ds_version_p text, nm_usuario_p text) FROM PUBLIC;

