-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE dias_entrega_solic_compra ( nr_solic_compra_p bigint, qt_dia_entrega_p bigint, ie_somente_dias_uteis_p text, dt_entrega_p INOUT timestamp) AS $body$
DECLARE

 
ie_feriado_w			smallint;
nr_semana_w			bigint;
cd_estabelecimento_w		smallint;
ie_dia_util_w			varchar(1);
dt_retorno_w			timestamp;
qt_dia_corrido_w			bigint;
qt_dia_util_w			bigint;


BEGIN 
 
select	cd_estabelecimento 
into STRICT	cd_estabelecimento_w 
from	solic_compra 
where	nr_solic_compra	= nr_solic_compra_p;
 
if (ie_somente_dias_uteis_p = 'S') then 
	begin 
 
	dt_retorno_w		:= trunc(clock_timestamp(), 'dd');
	qt_dia_corrido_w		:= 0;
	qt_dia_util_w		:= 0;
 
	while(qt_dia_util_w <= qt_dia_entrega_p) loop 
 
		if (obter_se_dia_util(dt_retorno_w + qt_dia_corrido_w, cd_estabelecimento_w) = 'S') then 
			qt_dia_util_w	:= qt_dia_util_w + 1;
		end if;
 
		qt_dia_corrido_w	:= qt_dia_corrido_w + 1;
 
	end loop;
 
	dt_retorno_w	:= dt_retorno_w + qt_dia_corrido_w - 1;	
 
	end;
else 
	begin 
 
	select	trunc(clock_timestamp() + qt_dia_entrega_p) 
	into STRICT	dt_retorno_w 
	;
 
	end;
end if;
 
dt_entrega_p	:= dt_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE dias_entrega_solic_compra ( nr_solic_compra_p bigint, qt_dia_entrega_p bigint, ie_somente_dias_uteis_p text, dt_entrega_p INOUT timestamp) FROM PUBLIC;

