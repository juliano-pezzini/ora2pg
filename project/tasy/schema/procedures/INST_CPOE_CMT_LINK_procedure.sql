-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inst_cpoe_cmt_link ( NR_SEQ_STD_COMMENT_P CPOE_COMMENT_LINKAGE.NR_SEQ_STD_COMMENT%TYPE, NR_SEQ_CPOE_MATERIAL_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_MATERIAL_TMP%TYPE default null, NR_SEQ_CPOE_PROCED_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_PROCED_TMP%TYPE default null, NR_SEQ_CPOE_NUTRICAO_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_NUTRICAO_TMP%TYPE default null, NR_SEQ_CPOE_RECOMEND_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_RECOMEND_TMP%TYPE default null, NR_SEQ_CPOE_DIALISE_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_DIALISE_TMP%TYPE default null, NR_SEQ_CPOE_ANAT_PAT_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_ANAT_PAT_TMP%TYPE default null, NR_SEQ_CPOE_GASOTERAPIA_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_GASOTERAPIA_TMP%TYPE default null, NR_SEQ_CPOE_HEMOTERAPIA_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_HEMOTERAPIA_TMP%TYPE default null, NR_SEQ_CPOE_JUST_ITEM_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_JUST_ITEM_TMP%TYPE default null, NM_USUARIO_P CPOE_COMMENT_LINKAGE.NM_USUARIO%TYPE DEFAULT NULL, SI_OPERATION_P text DEFAULT NULL, SI_DBPANEL_STATE_P text DEFAULT NULL, SI_VALIDATION_TYPE_P text default null, NR_SEQ_CPOE_JUST_INTER_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_JUST_INTER_TMP%TYPE default null, NR_SEQ_CPOE_ORDER_UNIT_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_ORDER_UNIT_TMP%TYPE DEFAULT NULL, NR_SEQ_CPOE_RP_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_RP_TMP%TYPE DEFAULT NULL, IE_TIPO_ITEM_JUST_P CPOE_COMMENT_LINKAGE.IE_TIPO_ITEM_JUST%TYPE default null) AS $body$
BEGIN
    IF ( SI_OPERATION_P = 'CHECK' ) THEN
        IF ( SI_DBPANEL_STATE_P = 'NEW_RECORD' ) THEN
            INSERT INTO CPOE_COMMENT_LINKAGE(
                NR_SEQUENCIA,
                DT_ATUALIZACAO,
                NM_USUARIO,
                DT_ATUALIZACAO_NREC,
                NR_SEQ_STD_COMMENT,
                NR_SEQ_CPOE_MATERIAL_TMP,
                NR_SEQ_CPOE_PROCED_TMP,
                NR_SEQ_CPOE_NUTRICAO_TMP,
                NR_SEQ_CPOE_RECOMEND_TMP,
                NR_SEQ_CPOE_DIALISE_TMP,
                NR_SEQ_CPOE_ANAT_PAT_TMP,
                NR_SEQ_CPOE_GASOTERAPIA_TMP,
                NR_SEQ_CPOE_HEMOTERAPIA_TMP,
                NR_SEQ_CPOE_JUST_ITEM_TMP,
                NR_SEQ_CPOE_JUST_INTER_TMP,
				SI_VALIDATION_TYPE,
				NR_SEQ_CPOE_ORDER_UNIT_TMP,
				NR_SEQ_CPOE_RP_TMP,
        IE_TIPO_ITEM_JUST
            ) VALUES (
                nextval('cpoe_comment_linkage_seq'),
                clock_timestamp(),
                NM_USUARIO_P,
                clock_timestamp(),
                NR_SEQ_STD_COMMENT_P,
                NR_SEQ_CPOE_MATERIAL_P,
                NR_SEQ_CPOE_PROCED_P,
                NR_SEQ_CPOE_NUTRICAO_P,
                NR_SEQ_CPOE_RECOMEND_P,
                NR_SEQ_CPOE_DIALISE_P,
                NR_SEQ_CPOE_ANAT_PAT_P,
                NR_SEQ_CPOE_GASOTERAPIA_P,
                NR_SEQ_CPOE_HEMOTERAPIA_P,
                NR_SEQ_CPOE_JUST_ITEM_P,
                NR_SEQ_CPOE_JUST_INTER_P,
				SI_VALIDATION_TYPE_P,
				NR_SEQ_CPOE_ORDER_UNIT_P,
				NR_SEQ_CPOE_RP_P,
        IE_TIPO_ITEM_JUST_P
            );

        ELSIF ( SI_DBPANEL_STATE_P = 'UPDATE_RECORD' ) THEN
            INSERT INTO CPOE_COMMENT_LINKAGE(
                NR_SEQUENCIA,
                DT_ATUALIZACAO,
                NM_USUARIO,
                DT_ATUALIZACAO_NREC,
                NR_SEQ_STD_COMMENT,
                NR_SEQ_CPOE_MATERIAL,
                NR_SEQ_CPOE_PROCED,
                NR_SEQ_CPOE_NUTRICAO,
                NR_SEQ_CPOE_RECOMEND,
                NR_SEQ_CPOE_DIALISE,
                NR_SEQ_CPOE_ANAT_PAT,
                NR_SEQ_CPOE_GASOTERAPIA,
                NR_SEQ_CPOE_HEMOTERAPIA,
                NR_SEQ_CPOE_JUST_ITEM,
                NR_SEQ_CPOE_JUST_INTER,
				SI_VALIDATION_TYPE,
				NR_SEQ_CPOE_ORDER_UNIT,
				NR_SEQ_CPOE_RP,
        IE_TIPO_ITEM_JUST
            ) VALUES (
                nextval('cpoe_comment_linkage_seq'),
                clock_timestamp(),
                NM_USUARIO_P,
                clock_timestamp(),
                NR_SEQ_STD_COMMENT_P,
                NR_SEQ_CPOE_MATERIAL_P,
                NR_SEQ_CPOE_PROCED_P,
                NR_SEQ_CPOE_NUTRICAO_P,
                NR_SEQ_CPOE_RECOMEND_P,
                NR_SEQ_CPOE_DIALISE_P,
                NR_SEQ_CPOE_ANAT_PAT_P,
                NR_SEQ_CPOE_GASOTERAPIA_P,
                NR_SEQ_CPOE_HEMOTERAPIA_P,
                NR_SEQ_CPOE_JUST_ITEM_P,
                NR_SEQ_CPOE_JUST_INTER_P,
				SI_VALIDATION_TYPE_P,
				NR_SEQ_CPOE_ORDER_UNIT_P,
				NR_SEQ_CPOE_RP_P,
        IE_TIPO_ITEM_JUST_P
            );

        END IF;
    ELSIF ( SI_OPERATION_P = 'UNCHECK' ) THEN
        IF ( SI_DBPANEL_STATE_P = 'NEW_RECORD' ) THEN
            IF (NR_SEQ_CPOE_MATERIAL_P IS NOT NULL AND NR_SEQ_CPOE_MATERIAL_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE		NR_SEQ_CPOE_MATERIAL_TMP = NR_SEQ_CPOE_MATERIAL_P
                    AND		NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P
					AND		coalesce(SI_VALIDATION_TYPE, 0) = coalesce(SI_VALIDATION_TYPE_P,0)
					AND		coalesce(IE_TIPO_ITEM_JUST, 0) = coalesce(IE_TIPO_ITEM_JUST_P,0);

            ELSIF (NR_SEQ_CPOE_PROCED_P IS NOT NULL AND NR_SEQ_CPOE_PROCED_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_PROCED_TMP = NR_SEQ_CPOE_PROCED_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;

            ELSIF (NR_SEQ_CPOE_NUTRICAO_P IS NOT NULL AND NR_SEQ_CPOE_NUTRICAO_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_NUTRICAO_TMP = NR_SEQ_CPOE_NUTRICAO_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;

            ELSIF (NR_SEQ_CPOE_RECOMEND_P IS NOT NULL AND NR_SEQ_CPOE_RECOMEND_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_RECOMEND_TMP = NR_SEQ_CPOE_RECOMEND_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;

            ELSIF (NR_SEQ_CPOE_DIALISE_P IS NOT NULL AND NR_SEQ_CPOE_DIALISE_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_DIALISE_TMP = NR_SEQ_CPOE_DIALISE_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;

            ELSIF (NR_SEQ_CPOE_ANAT_PAT_P IS NOT NULL AND NR_SEQ_CPOE_ANAT_PAT_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_ANAT_PAT_TMP = NR_SEQ_CPOE_ANAT_PAT_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;

            ELSIF (NR_SEQ_CPOE_GASOTERAPIA_P IS NOT NULL AND NR_SEQ_CPOE_GASOTERAPIA_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_GASOTERAPIA_TMP = NR_SEQ_CPOE_GASOTERAPIA_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;

            ELSIF (NR_SEQ_CPOE_HEMOTERAPIA_P IS NOT NULL AND NR_SEQ_CPOE_HEMOTERAPIA_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_HEMOTERAPIA_TMP = NR_SEQ_CPOE_HEMOTERAPIA_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;

            ELSIF (NR_SEQ_CPOE_JUST_ITEM_P IS NOT NULL AND NR_SEQ_CPOE_JUST_ITEM_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_JUST_ITEM_TMP = NR_SEQ_CPOE_JUST_ITEM_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;

            ELSIF (NR_SEQ_CPOE_JUST_INTER_P IS NOT NULL AND NR_SEQ_CPOE_JUST_INTER_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_JUST_INTER_TMP = NR_SEQ_CPOE_JUST_INTER_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;
			ELSIF (NR_SEQ_CPOE_ORDER_UNIT_P IS NOT NULL AND NR_SEQ_CPOE_ORDER_UNIT_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_ORDER_UNIT_TMP = NR_SEQ_CPOE_ORDER_UNIT_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;
			ELSIF (NR_SEQ_CPOE_RP_P IS NOT NULL AND NR_SEQ_CPOE_RP_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_RP_TMP = NR_SEQ_CPOE_RP_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;
            END IF;

        ELSIF ( SI_DBPANEL_STATE_P = 'UPDATE_RECORD' ) THEN
            IF (NR_SEQ_CPOE_MATERIAL_P IS NOT NULL AND NR_SEQ_CPOE_MATERIAL_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_MATERIAL = NR_SEQ_CPOE_MATERIAL_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P
					AND		coalesce(SI_VALIDATION_TYPE, 0) = coalesce(SI_VALIDATION_TYPE_P,0)
					AND		coalesce(IE_TIPO_ITEM_JUST, 0) = coalesce(IE_TIPO_ITEM_JUST_P,0);

            ELSIF (NR_SEQ_CPOE_PROCED_P IS NOT NULL AND NR_SEQ_CPOE_PROCED_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_PROCED = NR_SEQ_CPOE_PROCED_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;

            ELSIF (NR_SEQ_CPOE_NUTRICAO_P IS NOT NULL AND NR_SEQ_CPOE_NUTRICAO_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_NUTRICAO = NR_SEQ_CPOE_NUTRICAO_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;

            ELSIF (NR_SEQ_CPOE_RECOMEND_P IS NOT NULL AND NR_SEQ_CPOE_RECOMEND_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_RECOMEND = NR_SEQ_CPOE_RECOMEND_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;

            ELSIF (NR_SEQ_CPOE_DIALISE_P IS NOT NULL AND NR_SEQ_CPOE_DIALISE_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_DIALISE = NR_SEQ_CPOE_DIALISE_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;

            ELSIF (NR_SEQ_CPOE_ANAT_PAT_P IS NOT NULL AND NR_SEQ_CPOE_ANAT_PAT_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_ANAT_PAT = NR_SEQ_CPOE_ANAT_PAT_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;

            ELSIF (NR_SEQ_CPOE_GASOTERAPIA_P IS NOT NULL AND NR_SEQ_CPOE_GASOTERAPIA_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_GASOTERAPIA = NR_SEQ_CPOE_GASOTERAPIA_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;

            ELSIF (NR_SEQ_CPOE_HEMOTERAPIA_P IS NOT NULL AND NR_SEQ_CPOE_HEMOTERAPIA_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_HEMOTERAPIA = NR_SEQ_CPOE_HEMOTERAPIA_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;

            ELSIF (NR_SEQ_CPOE_JUST_ITEM_P IS NOT NULL AND NR_SEQ_CPOE_JUST_ITEM_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_JUST_ITEM = NR_SEQ_CPOE_JUST_ITEM_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;

            ELSIF (NR_SEQ_CPOE_JUST_INTER_P IS NOT NULL AND NR_SEQ_CPOE_JUST_INTER_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_JUST_INTER = NR_SEQ_CPOE_JUST_INTER_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;
			ELSIF (NR_SEQ_CPOE_ORDER_UNIT_P IS NOT NULL AND NR_SEQ_CPOE_ORDER_UNIT_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_ORDER_UNIT = NR_SEQ_CPOE_ORDER_UNIT_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;
			ELSIF (NR_SEQ_CPOE_RP_P IS NOT NULL AND NR_SEQ_CPOE_RP_P::text <> '') THEN
                DELETE FROM CPOE_COMMENT_LINKAGE
                WHERE
                    NR_SEQ_CPOE_RP = NR_SEQ_CPOE_RP_P
                    AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P;

            END IF;
        END IF;
    END IF;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inst_cpoe_cmt_link ( NR_SEQ_STD_COMMENT_P CPOE_COMMENT_LINKAGE.NR_SEQ_STD_COMMENT%TYPE, NR_SEQ_CPOE_MATERIAL_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_MATERIAL_TMP%TYPE default null, NR_SEQ_CPOE_PROCED_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_PROCED_TMP%TYPE default null, NR_SEQ_CPOE_NUTRICAO_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_NUTRICAO_TMP%TYPE default null, NR_SEQ_CPOE_RECOMEND_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_RECOMEND_TMP%TYPE default null, NR_SEQ_CPOE_DIALISE_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_DIALISE_TMP%TYPE default null, NR_SEQ_CPOE_ANAT_PAT_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_ANAT_PAT_TMP%TYPE default null, NR_SEQ_CPOE_GASOTERAPIA_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_GASOTERAPIA_TMP%TYPE default null, NR_SEQ_CPOE_HEMOTERAPIA_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_HEMOTERAPIA_TMP%TYPE default null, NR_SEQ_CPOE_JUST_ITEM_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_JUST_ITEM_TMP%TYPE default null, NM_USUARIO_P CPOE_COMMENT_LINKAGE.NM_USUARIO%TYPE DEFAULT NULL, SI_OPERATION_P text DEFAULT NULL, SI_DBPANEL_STATE_P text DEFAULT NULL, SI_VALIDATION_TYPE_P text default null, NR_SEQ_CPOE_JUST_INTER_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_JUST_INTER_TMP%TYPE default null, NR_SEQ_CPOE_ORDER_UNIT_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_ORDER_UNIT_TMP%TYPE DEFAULT NULL, NR_SEQ_CPOE_RP_P CPOE_COMMENT_LINKAGE.NR_SEQ_CPOE_RP_TMP%TYPE DEFAULT NULL, IE_TIPO_ITEM_JUST_P CPOE_COMMENT_LINKAGE.IE_TIPO_ITEM_JUST%TYPE default null) FROM PUBLIC;

