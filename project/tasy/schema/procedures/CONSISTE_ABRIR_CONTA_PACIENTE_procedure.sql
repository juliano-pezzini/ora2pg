-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consiste_abrir_conta_paciente ( nr_interno_conta_p bigint, nm_usuario_p text, ds_erro_p INOUT text) AS $body$
DECLARE


ie_ok_w		integer;
ie_permite_abrir_w	varchar(10);


BEGIN

ds_erro_p	:= '';

select	count(*)
into STRICT	ie_ok_w
from 	nota_fiscal
where 	nr_interno_conta = nr_interno_conta_p;
if (ie_ok_w <> 0) then
	ds_erro_p := WHEB_MENSAGEM_PCK.get_texto(280056);
end if;

ie_permite_abrir_w := coalesce(obter_valor_param_usuario(obter_funcao_ativa,244,obter_perfil_ativo,nm_usuario_p,0),'N');

select	count(*)
into STRICT	ie_ok_w
from	repasse_terceiro c,
	procedimento_repasse b,
	procedimento_paciente a
where	a.nr_sequencia = b.nr_seq_procedimento
and	b.nr_repasse_terceiro = c.nr_repasse_terceiro
and	a.nr_interno_conta = nr_interno_conta_p
and	c.ie_status = 'F';
if (ie_ok_w 	<> 0) and (ie_permite_abrir_w	= 'N') then
	ds_erro_p := WHEB_MENSAGEM_PCK.get_texto(280057);
end if;

ds_erro_p	:= ds_erro_p;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consiste_abrir_conta_paciente ( nr_interno_conta_p bigint, nm_usuario_p text, ds_erro_p INOUT text) FROM PUBLIC;

