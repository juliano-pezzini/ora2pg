-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE icc_atualizar_status_pront_pf () AS $body$
DECLARE


nr_atendimento_w	bigint;
cd_pessoa_fisica_w	varchar(10);
cd_estabelecimento_w	smallint;
nr_sequencia_w		bigint;
qt_itens_w		bigint;

c01 CURSOR FOR
SELECT	a.cd_pessoa_fisica,
	coalesce(a.cd_estabelecimento,1)
from	pessoa_fisica a
where	not exists (select	1
		    from	same_prontuario b
		    where	a.cd_pessoa_fisica = b.cd_pessoa_fisica);


BEGIN
qt_itens_w	:= 0;
open c01;
loop
fetch c01 into
	cd_pessoa_fisica_w,
	cd_estabelecimento_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin
	select	nextval('same_prontuario_seq')
	into STRICT	nr_sequencia_w
	;

	insert into same_prontuario(nr_sequencia,
				     cd_estabelecimento,
				     ie_tipo,
				     dt_atualizacao,
				     nm_usuario,
				     ie_status,
				     cd_pessoa_fisica,
				     nr_atendimento,
				     ie_digitalizado,
				     ie_microfilmado,
				     cd_setor_atendimento,
				     dt_atualizacao_nrec,
				     nm_usuario_nrec)
			values (nr_sequencia_w,
				     cd_estabelecimento_w,
				     2,
				     clock_timestamp(),
				     'Tasy 28/06',
				     1,
				     cd_pessoa_fisica_w,
				     null,
				     'N',
				     'N',
				     78,
				     clock_timestamp(),
				     'Tasy 02/06');

	insert into same_prontuario_hist(nr_sequencia,
				          nr_seq_same,
					  nr_seq_operacao,
					  dt_atualizacao,
					  dt_historico,
					  nm_usuario)
				values (nextval('same_prontuario_hist_seq'),
					  nr_sequencia_w,
					  8,
					  clock_timestamp(),
					  clock_timestamp(),
					  'Tasy 28/06');

	/*insert into logxxx_tasy (dt_atualizacao,
			      nm_usuario,
			      cd_log,
			      ds_log)
		   values    (sysdate,
			      'Tasy 02/06',
			      99560,
			      'Atendimento: '||nr_atendimento_w||', Pessoa f√≠sica: '||cd_pessoa_fisica_w||', Seq.: '||nr_sequencia_w);*/
	qt_itens_w	:= qt_itens_w + 1;

	if (qt_itens_w = 5000) then
		qt_itens_w := 0;
		commit;
	end if;

	end;
end loop;
close c01;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE icc_atualizar_status_pront_pf () FROM PUBLIC;

