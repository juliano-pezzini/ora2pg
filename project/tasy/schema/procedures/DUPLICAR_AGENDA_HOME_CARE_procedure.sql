-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_agenda_home_care (nr_sequencia_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_seq_agenda_w		bigint;


BEGIN

if (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '') then
begin

select 	nextval('agenda_home_care_seq')
into STRICT	nr_seq_agenda_w
;

/* Agenda */

insert into agenda_home_care(
				NR_SEQUENCIA,
				CD_ESTABELECIMENTO,
				DT_ATUALIZACAO,
				NM_USUARIO,
				DT_ATUALIZACAO_NREC,
				NM_USUARIO_NREC,
				NM_AGENDA,
				IE_CLASSIF_SERVICO,
				IE_GERAR_SOLIC_PRONT,
				NR_SEQ_SERVICO,
				CD_PESSOA_RESP,
				IE_CONTROLE,
				CD_SETOR_ATENDIMENTO,
				IE_SITUACAO)
		SELECT	nr_seq_agenda_w,
				cd_estabelecimento_p,
				clock_timestamp(),
				nm_usuario_p,
				clock_timestamp(),
				nm_usuario_p,
				nm_agenda||' '||obter_desc_expressao(330826),
				ie_classif_servico,
				ie_gerar_solic_pront,
				nr_seq_servico,
				cd_pessoa_resp,
				ie_controle,
				cd_setor_atendimento,
				ie_situacao
		from agenda_home_care
		where nr_sequencia = nr_sequencia_p;

/* Equipe */

insert into agenda_home_care_equipe(
				nr_sequencia,
				dt_atualizacao,
				nm_usuario,
				dt_atualizacao_nrec,
				nm_usuario_nrec,
				nr_seq_agenda,
				nr_seq_equipe,
				cd_pessoa_fisica)
		SELECT	nextval('agenda_home_care_equipe_seq'),
				clock_timestamp(),
				nm_usuario_p,
				clock_timestamp(),
				nm_usuario_p,
				nr_seq_agenda_w,
				nr_seq_equipe,
				cd_pessoa_fisica
		from	agenda_home_care_equipe
		where nr_seq_agenda = nr_sequencia_p;

end;
end if;


commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_agenda_home_care (nr_sequencia_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

