-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_rel_news_template_inf (ds_conteudo_p text, nr_sequencia_p bigint, nr_ordem_servico_p bigint, ie_tipo_p text) AS $body$
DECLARE

														
cd_exp_campo_w	release_news_template_inf.cd_exp_campo%type;

c_split_idiomas CURSOR FOR
SELECT  b.nr_sequencia,
	b.ds_locale,
	b.nr_seq_release
from    release_news_idioma b,
	release_news a
where   a.nr_sequencia = b.nr_seq_release
and     a.nr_seq_ordem_serv = nr_ordem_servico_p;

BEGIN

select	max(cd_exp_campo)
into STRICT	cd_exp_campo_w
from	release_news_template_inf
where	nr_sequencia = nr_sequencia_p;

if (ie_tipo_p = 'O') then

	for r_c_split_idiomas in c_split_idiomas
		loop
			
			update	release_news_idioma
			set		ds_objetivo  = ds_objetivo || expressao_pck.obter_dic_expressao_loc(cd_exp_campo_w, r_c_split_idiomas.ds_locale) || ' ' || ds_conteudo_p || ' '
			where	nr_sequencia = r_c_split_idiomas.nr_sequencia;
			
			if (r_c_split_idiomas.ds_locale = 'pt_BR')	then
			
				update	release_news
				set	ds_objetivo =   (	SELECT	ds_objetivo 
								from	release_news_idioma 
								where	ds_locale = 'pt_BR' 
								and	nr_sequencia = r_c_split_idiomas.nr_sequencia)
				where	nr_sequencia = r_c_split_idiomas.nr_seq_release;
										
			end if;
			
		end loop;
else
	for r_c_split_idiomas in c_split_idiomas
		loop
		
			update	release_news_idioma
			set		ds_alteracao  = ds_alteracao || expressao_pck.obter_dic_expressao_loc(cd_exp_campo_w, r_c_split_idiomas.ds_locale) || ' ' || ds_conteudo_p || ' '
			where nr_sequencia = r_c_split_idiomas.nr_sequencia;

			if (r_c_split_idiomas.ds_locale = 'pt_BR')	then
			
				update	release_news
				set	ds_alteracao = (	SELECT	ds_alteracao
								from 	release_news_idioma
								where	ds_locale = 'pt_BR'
								and	nr_sequencia = r_c_split_idiomas.nr_sequencia)
				where	nr_sequencia = r_c_split_idiomas.nr_seq_release;
				
			end if;
			
		end loop;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_rel_news_template_inf (ds_conteudo_p text, nr_sequencia_p bigint, nr_ordem_servico_p bigint, ie_tipo_p text) FROM PUBLIC;

