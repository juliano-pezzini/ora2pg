-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pfcs_calc_device_capacity ( nr_seq_indicator_p bigint, cd_estabelecimento_p text, nm_usuario_p text) AS $body$
DECLARE


	qt_total_device                 bigint := 0;
	qt_total_device_in_use  		bigint := 0;
	qt_total_device_capacity  		bigint := 0;
	ds_tl_dev_type	 				varchar(10) := 'TL';
	ds_monitor_dev_type				varchar(10) := 'Monitor';

	nr_seq_operational_level_w  	pfcs_operational_level.nr_sequencia%type;
	nr_seq_panel_w                  pfcs_panel_detail.nr_seq_panel%type;
	pfcs_flag_settings          	bigint := 0;

	
BEGIN

	nr_seq_operational_level_w := pfcs_get_structure_level(
									cd_establishment_p => cd_estabelecimento_p,
									ie_level_p => 'O',
									ie_info_p => 'C');

	select ie_table_origin into STRICT pfcs_flag_settings
	from pfcs_general_rule;

	/* Read from Tasy cursor*/

	if (pfcs_flag_settings = 0 or pfcs_flag_settings = 2) then
		qt_total_device := pfcs_get_tele_total_device(ds_tl_dev_type, null, cd_estabelecimento_p);
		qt_total_device_in_use := pfcs_get_tele_total_device(ds_tl_dev_type, 'U', cd_estabelecimento_p);

		 := pfcs_pck.pfcs_generate_results(
			vl_indicator_p => qt_total_device_in_use, vl_indicator_aux_p => qt_total_device, ds_reference_value_p => '', nr_seq_indicator_p => nr_seq_indicator_p, nr_seq_operational_level_p => nr_seq_operational_level_w, nm_usuario_p => nm_usuario_p, nr_seq_panel_p => nr_seq_panel_w);
	end if;

	/* Read from PFCS Integration cursor*/

	if (pfcs_flag_settings = 1 or pfcs_flag_settings = 2) then
		qt_total_device := pfcs_get_tele_device_from_intg(ds_monitor_dev_type, null, cd_estabelecimento_p);
		qt_total_device_in_use := pfcs_get_tele_device_from_intg(ds_monitor_dev_type, 'U', cd_estabelecimento_p);

		 := pfcs_pck.pfcs_generate_results(
			vl_indicator_p => qt_total_device_in_use, vl_indicator_aux_p => qt_total_device, ds_reference_value_p => '', nr_seq_indicator_p => nr_seq_indicator_p, nr_seq_operational_level_p => nr_seq_operational_level_w, nm_usuario_p => nm_usuario_p, nr_seq_panel_p => nr_seq_panel_w);
	end if;

	CALL pfcs_pck.pfcs_activate_records(
			nr_seq_indicator_p => nr_seq_indicator_p,
			nr_seq_operational_level_p => nr_seq_operational_level_w,
			nm_usuario_p => nm_usuario_p);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pfcs_calc_device_capacity ( nr_seq_indicator_p bigint, cd_estabelecimento_p text, nm_usuario_p text) FROM PUBLIC;

