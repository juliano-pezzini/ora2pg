-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE liberar_resultado (nr_seq_resultado_p bigint, nm_usuario_p text) AS $body$
DECLARE

nr_seq_grupo_exame_w EXAME_LABORATORIO.NR_SEQ_GRUPO%type;


C01 CURSOR FOR
SELECT b.NR_SEQ_GRUPO, c.cd_pessoa_fisica
from EXAME_LAB_RESULT_ITEM a,
  EXAME_LABORATORIO b,
  EXAME_LAB_RESULTADO c
where c.nr_seq_resultado = nr_seq_resultado_p
  and a.nr_seq_resultado = c.nr_seq_resultado
  and b.nr_seq_exame = a.nr_seq_exame;

BEGIN



update	EXAME_LAB_RESULTADO



set	dt_liberacao = clock_timestamp(),

	dt_atualizacao		= clock_timestamp(),

	nm_usuario		= nm_usuario_p



where	nr_seq_resultado	= nr_seq_resultado_p;

FOR c01_w IN C01 LOOP BEGIN
  CALL ATUALIZAR_EV_LINHA_CUIDADO('EX', 'EXAME_LAB_RESULTADO', nr_seq_resultado_p, c01_w.NR_SEQ_GRUPO, c01_w.cd_pessoa_fisica, nm_usuario_p);
end; end loop;

commit;



end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE liberar_resultado (nr_seq_resultado_p bigint, nm_usuario_p text) FROM PUBLIC;

