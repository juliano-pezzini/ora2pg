-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consulta_valor_pacote_proc (nr_seq_pacote_p bigint, cd_tipo_acomodacao_p bigint, cd_procedimento_p bigint, nm_usuario_p text, dt_vigencia_p timestamp, cd_categoria_p text, cd_plano_p text, qt_idade_p bigint, ie_clinica_p bigint default null, ie_tipo_anestesia_p bigint DEFAULT NULL, cd_setor_atendimento_p bigint DEFAULT NULL, vl_pacote_p INOUT bigint DEFAULT NULL, vl_honorario_p INOUT bigint DEFAULT NULL, vl_anestesista_p INOUT bigint DEFAULT NULL, vl_auxiliares_p INOUT bigint DEFAULT NULL, vl_materiais_p INOUT bigint DEFAULT NULL, nr_sequencia_p INOUT bigint DEFAULT NULL) AS $body$
DECLARE


ie_tipo_acomod_w		varchar(2);

cd_procedimento_w		bigint;
ie_origem_proced_w		bigint;
vl_honorario_w			double precision;
vl_anestesista_w		pacote_tipo_acomodacao.vl_anestesista%type;
vl_auxiliares_w			pacote_tipo_acomodacao.vl_auxiliares%type;
vl_materiais_w			pacote_tipo_acomodacao.vl_materiais%type;
vl_pacote_w			double precision;
qt_dias_pacote_w		integer;

cd_material_w			bigint;
ds_documento_w			text;
nr_sequencia_w			bigint;


c01 CURSOR FOR
	SELECT	cd_procedimento,
		ie_origem_proced,
		vl_honorario,
		vl_anestesista,
		vl_auxiliares,
		vl_materiais,
		vl_pacote,
		qt_dias_pacote,
		nr_sequencia
	from 	pacote_tipo_acomodacao
	where 	nr_seq_pacote	= nr_seq_pacote_p
	and	dt_vigencia_p between dt_vigencia and coalesce(dt_vigencia_final, clock_timestamp() + interval '99999 days')
	and     ie_tipo_acomod	= cd_tipo_acomodacao_p
	and	cd_procedimento = cd_procedimento_p
	and     ((coalesce(cd_categoria, coalesce(cd_categoria_p,'0')) = coalesce(cd_categoria_p,'0')) or (coalesce(cd_categoria_p::text, '') = ''))
	and     ((coalesce(cd_plano, coalesce(cd_plano_p, '0')) = coalesce(cd_plano_p,'0')) or (coalesce(cd_plano_p::text, '') = ''))
	and	((coalesce(qt_idade_p,0) between coalesce(qt_idade_min,0) and coalesce(qt_idade_max,999)) or (coalesce(qt_idade_p::text, '') = ''))
	and     coalesce(ie_clinica, coalesce(ie_clinica_p,0)) = coalesce(ie_clinica_p, 0)
	and     coalesce(ie_tipo_anestesia, coalesce(ie_tipo_anestesia_p,0)) = coalesce(ie_tipo_anestesia_p, 0)
	and	coalesce(cd_setor_atendimento, coalesce(cd_setor_atendimento_p,0)) = coalesce(cd_setor_atendimento_p,0)	
	order by dt_vigencia,
		CASE WHEN coalesce(cd_plano_p,'X')='X' THEN cd_plano  ELSE coalesce(cd_plano,'/') END ,
		coalesce(cd_setor_atendimento,0),
		coalesce(ie_clinica,0),
		coalesce(ie_tipo_anestesia, 0),
		CASE WHEN coalesce(cd_categoria_p,'X')='X' THEN cd_categoria  ELSE coalesce(cd_categoria,'/') END ,
		coalesce(qt_idade_p, 0);


BEGIN

open c01;
loop
fetch c01 into
	cd_procedimento_w,
	ie_origem_proced_w,
	vl_honorario_w,
	vl_anestesista_w,
	vl_auxiliares_w,
	vl_materiais_w,
	vl_pacote_w,
	qt_dias_pacote_w,
	nr_sequencia_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	vl_pacote_p		:= vl_pacote_w;
	vl_honorario_p		:= vl_honorario_w;
	vl_anestesista_p	:= vl_anestesista_w;
	vl_auxiliares_p		:= vl_auxiliares_w;
	vl_materiais_p		:= vl_materiais_w;
	nr_sequencia_p		:= nr_sequencia_w;
end loop;
close c01;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consulta_valor_pacote_proc (nr_seq_pacote_p bigint, cd_tipo_acomodacao_p bigint, cd_procedimento_p bigint, nm_usuario_p text, dt_vigencia_p timestamp, cd_categoria_p text, cd_plano_p text, qt_idade_p bigint, ie_clinica_p bigint default null, ie_tipo_anestesia_p bigint DEFAULT NULL, cd_setor_atendimento_p bigint DEFAULT NULL, vl_pacote_p INOUT bigint DEFAULT NULL, vl_honorario_p INOUT bigint DEFAULT NULL, vl_anestesista_p INOUT bigint DEFAULT NULL, vl_auxiliares_p INOUT bigint DEFAULT NULL, vl_materiais_p INOUT bigint DEFAULT NULL, nr_sequencia_p INOUT bigint DEFAULT NULL) FROM PUBLIC;

