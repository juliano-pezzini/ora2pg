-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_informacoes_solucao ( nr_prescricao_p bigint, nr_seq_solucao_p bigint, nr_seq_motivo_interrup_p INOUT bigint, qt_vol_infundido_p INOUT bigint, cd_perfil_p bigint, cd_estabelecimento_p bigint, ie_so_troca_p text, ie_pasta_p text, ie_tipo_item_p text ) AS $body$
DECLARE


nr_seq_motivo_interrup_w	bigint;
qt_vol_infundido_w		double precision := 0;


BEGIN

select	coalesce(max(nr_sequencia),0)
into STRICT	nr_seq_motivo_interrup_w
from	adep_motivo_interrupcao
where (coalesce(cd_estabelecimento,0) = cd_estabelecimento_p)
and     ((cd_perfil = cd_perfil_p) OR (coalesce(cd_perfil::text, '') = ''))
and (coalesce(ie_servico,'A') IN ('D','A'))
and     ((ie_so_troca_p = 'N') or (ie_troca_frasco = 'S'))
and     ((coalesce(ie_apres_transfusao,'S') = 'S') OR (ie_pasta_p <> 'HMT'))
and		((coalesce(ie_tipo_item::text, '') = '') OR (coalesce(ie_tipo_item_p::text, '') = '') OR (ie_tipo_item = ie_tipo_item_p))
and (ie_situacao = 'A')
and (ie_default = 'S')
and	((coalesce(ie_evento::text, '') = '') or (ie_evento = 'IS'));

if (nr_prescricao_p IS NOT NULL AND nr_prescricao_p::text <> '') and (nr_seq_solucao_p IS NOT NULL AND nr_seq_solucao_p::text <> '') then

	select	calcula_volume_inf_sol(nr_prescricao_p, nr_seq_solucao_p)
	into STRICT	qt_vol_infundido_w
	;

end if;

nr_seq_motivo_interrup_p := nr_seq_motivo_interrup_w;
qt_vol_infundido_p	 := coalesce(converter_numero_string(qt_vol_infundido_w),0);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_informacoes_solucao ( nr_prescricao_p bigint, nr_seq_solucao_p bigint, nr_seq_motivo_interrup_p INOUT bigint, qt_vol_infundido_p INOUT bigint, cd_perfil_p bigint, cd_estabelecimento_p bigint, ie_so_troca_p text, ie_pasta_p text, ie_tipo_item_p text ) FROM PUBLIC;

