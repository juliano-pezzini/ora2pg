-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE lab_soro_armaz_inic_manut ( NR_SEQUENCIA_P bigint, IE_ACAO_P text, NM_USUARIO_P text, NR_SEQ_MOT_MANUTENCAO_P bigint) AS $body$
DECLARE

  ds_texto_w varchar(255);
  ds_armazenamento_w varchar(255);
  nr_seq_mot_manutencao_w lab_soro_armazenamento.nr_seq_mot_manutencao%type;

BEGIN

  UPDATE LAB_SORO_ARMAZENAMENTO
  SET dt_inicio_manutencao = clock_timestamp(),
    nr_seq_mot_manutencao  = nr_seq_mot_manutencao_p,
    dt_fim_manutencao       = NULL,
    nm_usuario             = nm_usuario_p,
    dt_atualizacao         = clock_timestamp()
  WHERE nr_sequencia       = nr_sequencia_p;

  SELECT nr_seq_mot_manutencao
  INTO STRICT nr_seq_mot_manutencao_w
  FROM lab_soro_armazenamento
  WHERE nr_sequencia = nr_sequencia_p;


  SELECT ds_armazenamento
  INTO STRICT ds_armazenamento_w
  FROM LAB_SORO_ARMAZENAMENTO
  WHERE nr_sequencia = nr_sequencia_p;

  ds_texto_w               := wheb_mensagem_pck.get_texto(1045998, 'NR_SEQUENCIA=' || NR_SEQUENCIA_P || ';DS_ARMAZENAMENTO=' || ds_armazenamento_w);

  INSERT
  INTO LAB_SORO_PROCESSO_INFO(
      nr_sequencia,
      dt_acao,
      dt_atualizacao,
      nm_usuario,
      ds_observacao,
      nr_seq_armazenamento,
      nr_seq_manutencao,
      ie_acao
    )
    VALUES (
      nextval('lab_soro_processo_info_seq'),
      clock_timestamp(),
      clock_timestamp(),
      nm_usuario_p,
      ds_texto_w,
      nr_sequencia_p,
      nr_seq_mot_manutencao_w,
      ie_acao_p
    );

  COMMIT;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE lab_soro_armaz_inic_manut ( NR_SEQUENCIA_P bigint, IE_ACAO_P text, NM_USUARIO_P text, NR_SEQ_MOT_MANUTENCAO_P bigint) FROM PUBLIC;

