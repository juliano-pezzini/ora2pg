-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE tiss_importar_documento (nm_usuario_p tiss_envio_documento.nm_usuario%type, nr_lote_p tiss_envio_documento.nr_lote%type, nr_protocolo_p tiss_envio_documento.nr_protocolo%type, nr_guia_prestador_p tiss_envio_documento.nr_guia_prestador%type, nr_guia_operadora_p tiss_envio_documento.nr_guia_operadora%type, nr_documento_p tiss_envio_documento.nr_documento%type, nr_protoc_rec_operadora_p tiss_envio_documento.nr_protoc_rec_operadora%type, ds_observacao_p tiss_envio_documento.ds_observacao%type, ds_erro_p tiss_envio_documento.ds_erro_comunicacao%type, nr_seq_tiss_env_doc_p bigint ) AS $body$
DECLARE


nr_seq_env_doc_w            tiss_envio_documento.nr_sequencia%type;
nm_usuario_w                tiss_envio_documento.nm_usuario%type := nm_usuario_p;
nr_lote_w                   tiss_envio_documento.nr_lote%type := nr_lote_p;
nr_protocolo_w              tiss_envio_documento.nr_protocolo%type := nr_protocolo_p;
nr_guia_prestador_w         tiss_envio_documento.nr_guia_prestador%type := nr_guia_prestador_p;
nr_guia_operadora_w         tiss_envio_documento.nr_guia_operadora%type := nr_guia_operadora_p;
nr_documento_w              tiss_envio_documento.nr_documento%type := nr_documento_p;
nr_protoc_rec_operadora_w   tiss_envio_documento.nr_protoc_rec_operadora%type := nr_protoc_rec_operadora_p;
ds_observacao_w             tiss_envio_documento.ds_observacao%type := ds_observacao_p;
ds_erro_w                   tiss_envio_documento.ds_erro_comunicacao%type := ds_erro_p;
nr_seq_tiss_env_doc_w       tiss_envio_documento.nr_sequencia%type := nr_seq_tiss_env_doc_p;

nr_seq_protoc_conv_anexo_w tiss_envio_documento.nr_seq_protoc_conv_anexo%type;
nr_seq_autor_conv_anexo_w  tiss_envio_documento.nr_seq_autor_conv_anexo%type;
nr_seq_lote_hist_anexo_w   tiss_envio_documento.nr_seq_lote_hist_anexo%type;


BEGIN

select	nextval('tiss_envio_documento_seq')
into STRICT	nr_seq_env_doc_w
;

if (nr_seq_tiss_env_doc_w IS NOT NULL AND nr_seq_tiss_env_doc_w::text <> '') then
    select nr_seq_protoc_conv_anexo,
        nr_seq_autor_conv_anexo,
        nr_seq_lote_hist_anexo
    into STRICT nr_seq_protoc_conv_anexo_w,
        nr_seq_autor_conv_anexo_w,
        nr_seq_lote_hist_anexo_w
    from tiss_envio_documento 
    where nr_sequencia = nr_seq_tiss_env_doc_w  
    order by nr_sequencia desc LIMIT 1;	
end if;

begin
    insert into tiss_envio_documento(nr_sequencia,
             dt_atualizacao,   
             nm_usuario,       
             dt_atualizacao_nrec,    
             nm_usuario_nrec,        
             nr_lote,          
             nr_protocolo,  	  
             nr_guia_prestador, 
             nr_guia_operadora, 
             nr_documento,      
             nr_protoc_rec_operadora, 
             ds_observacao_operadora,
             ds_erro_comunicacao,
             nr_seq_protoc_conv_anexo, 
             nr_seq_autor_conv_anexo,
             nr_seq_lote_hist_anexo  ) 
    values (nr_seq_env_doc_w,
            clock_timestamp(),
            nm_usuario_w,
            clock_timestamp(),
            nm_usuario_w,
            nr_lote_w,
            nr_protocolo_w,
            nr_guia_prestador_w,
            nr_guia_operadora_w,
            nr_documento_w,
            nr_protoc_rec_operadora_w,
            ds_observacao_w,
            ds_erro_w,
            nr_seq_protoc_conv_anexo_w,
            nr_seq_autor_conv_anexo_w,
            nr_seq_lote_hist_anexo_w
            );
end;
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tiss_importar_documento (nm_usuario_p tiss_envio_documento.nm_usuario%type, nr_lote_p tiss_envio_documento.nr_lote%type, nr_protocolo_p tiss_envio_documento.nr_protocolo%type, nr_guia_prestador_p tiss_envio_documento.nr_guia_prestador%type, nr_guia_operadora_p tiss_envio_documento.nr_guia_operadora%type, nr_documento_p tiss_envio_documento.nr_documento%type, nr_protoc_rec_operadora_p tiss_envio_documento.nr_protoc_rec_operadora%type, ds_observacao_p tiss_envio_documento.ds_observacao%type, ds_erro_p tiss_envio_documento.ds_erro_comunicacao%type, nr_seq_tiss_env_doc_p bigint ) FROM PUBLIC;

