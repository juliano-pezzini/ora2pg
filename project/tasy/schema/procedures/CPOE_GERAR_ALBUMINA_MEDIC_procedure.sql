-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cpoe_gerar_albumina_medic (nr_seq_mat_cpoe_p cpoe_material.nr_sequencia%type, nr_seq_mat_prescr_p prescr_material.nr_sequencia%type, nr_prescricao_p prescr_medica.nr_prescricao%type, nm_usuario_p cpoe_material.nm_usuario%type, cd_perfil_p cpoe_material.cd_perfil_ativo%type) AS $body$
DECLARE


nr_seq_prescr_albu_w		prescr_medica_albumina.nr_sequencia%type;
qt_concentracao_alb_w		cpoe_material.qt_concentracao_alb%type;
qt_dia_util_alb_w			cpoe_material.qt_dia_util_alb%type;
ie_base_dose_albumina_w		cpoe_material.ie_base_dose_albumina%type;
nr_seq_indicacao1_w			cpoe_material.nr_seq_indicacao_alb1%type;
ds_observacao1_w			cpoe_material.ds_observacao_alb1%type;
nr_seq_grupo1_w				cpoe_material.nr_seq_grupo_indic_alb1%type;
nr_seq_indicacao2_w			cpoe_material.nr_seq_indicacao_alb2%type;
ds_observacao2_w			cpoe_material.ds_observacao_alb2%type;
nr_seq_grupo2_w				cpoe_material.nr_seq_grupo_indic_alb2%type;
nr_seq_indicacao3_w			cpoe_material.nr_seq_indicacao_alb3%type;
ds_observacao3_w			cpoe_material.ds_observacao_alb3%type;
nr_seq_grupo3_w				cpoe_material.nr_seq_grupo_indic_alb3%type;

	procedure cpoe_gerar_indic_albumina(nr_seq_indicacao_P	prescr_medica_albu_indic.nr_seq_indicacao%type,
										ds_observacao_p		prescr_medica_albu_indic.ds_observacao%type,
										nr_seq_grupo_p		prescr_medica_albu_indic.nr_seq_grupo%type) is
	;
BEGIN
		if (nr_seq_prescr_albu_w IS NOT NULL AND nr_seq_prescr_albu_w::text <> '') then
			insert into prescr_medica_albu_indic(
				nr_sequencia,
				dt_atualizacao,
				nm_usuario,
				dt_atualizacao_nrec,
				nm_usuario_nrec,
				nr_seq_prescr_albu,
				nr_seq_indicacao,
				ds_observacao,
				nr_seq_grupo)
				values (nextval('prescr_medica_albu_indic_seq'),
				clock_timestamp(),
				nm_usuario_p,
				clock_timestamp(),
				nm_usuario_p,
				nr_seq_prescr_albu_w,
				nr_seq_indicacao_P,
				ds_observacao_p,
				nr_seq_grupo_p);
		end if;
	end;

begin

if (nr_seq_mat_cpoe_p IS NOT NULL AND nr_seq_mat_cpoe_p::text <> '') then

	select	max(qt_concentracao_alb),
			max(qt_dia_util_alb),
			max(ie_base_dose_albumina),
			max(nr_seq_grupo_indic_alb1),
			max(nr_seq_indicacao_alb1),
			max(ds_observacao_alb1),
			max(nr_seq_grupo_indic_alb2),
			max(nr_seq_indicacao_alb2),
			max(ds_observacao_alb2),
			max(nr_seq_grupo_indic_alb3),
			max(nr_seq_indicacao_alb3),
			max(ds_observacao_alb3)
	into STRICT	qt_concentracao_alb_w,
			qt_dia_util_alb_w,
			ie_base_dose_albumina_w,
			nr_seq_grupo1_w,
			nr_seq_indicacao1_w,
			ds_observacao1_w,
			nr_seq_grupo2_w,
			nr_seq_indicacao2_w,
			ds_observacao2_w,
			nr_seq_grupo3_w,
			nr_seq_indicacao3_w,
			ds_observacao3_w
	from	cpoe_material
	where	nr_sequencia = nr_seq_mat_cpoe_p;

	if (qt_dia_util_alb_w IS NOT NULL AND qt_dia_util_alb_w::text <> '') then

		select	nextval('prescr_medica_albumina_seq')
		into STRICT	nr_seq_prescr_albu_w
		;

		insert into prescr_medica_albumina(
					nr_sequencia,
					dt_atualizacao,
					nm_usuario,
					dt_atualizacao_nrec,
					nm_usuario_nrec,
					nr_prescricao,
					nr_seq_material,
					ie_base_dose_albumina,
					qt_concentracao,
					qt_dia_util)
					values (nr_seq_prescr_albu_w,
					clock_timestamp(),
					nm_usuario_p,
					clock_timestamp(),
					nm_usuario_p,
					nr_prescricao_p,
					nr_seq_mat_prescr_p,
					ie_base_dose_albumina_w,
					qt_concentracao_alb_w,
					qt_dia_util_alb_w);

		if (nr_seq_indicacao1_w IS NOT NULL AND nr_seq_indicacao1_w::text <> '') then
			cpoe_gerar_indic_albumina(nr_seq_indicacao1_w,ds_observacao1_w, nr_seq_grupo1_w);
		end if;

		if (nr_seq_indicacao2_w IS NOT NULL AND nr_seq_indicacao2_w::text <> '') then
			cpoe_gerar_indic_albumina(nr_seq_indicacao2_w,ds_observacao2_w, nr_seq_grupo2_w);
		end if;

		if (nr_seq_indicacao3_w IS NOT NULL AND nr_seq_indicacao3_w::text <> '') then
			cpoe_gerar_indic_albumina(nr_seq_indicacao3_w,ds_observacao3_w, nr_seq_grupo3_w);
		end if;
	end if;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_gerar_albumina_medic (nr_seq_mat_cpoe_p cpoe_material.nr_sequencia%type, nr_seq_mat_prescr_p prescr_material.nr_sequencia%type, nr_prescricao_p prescr_medica.nr_prescricao%type, nm_usuario_p cpoe_material.nm_usuario%type, cd_perfil_p cpoe_material.cd_perfil_ativo%type) FROM PUBLIC;

