-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_person_name () AS $body$
DECLARE


c01 CURSOR FOR
SELECT 	cd_pessoa_fisica,
		nm_pessoa_fisica
from pessoa_fisica
where coalesce(nr_seq_person_name::text, '') = '';

c01_w c01%ROWTYPE;
nm_pessoa_fisica_w varchar(255);
nm_nome_w varchar(255);
nm_sobrenome_pai_w varchar(255);
nm_sobrenome_mae_w varchar(255);
nr_seq_person_name_w bigint;
nr_pos_w bigint;


BEGIN
open c01;
	loop
	fetch c01 into
			c01_w;
	EXIT WHEN NOT FOUND; /* apply on c01 */
		begin
		nm_pessoa_fisica_w := c01_w.nm_pessoa_fisica;
		if (nm_pessoa_fisica_w IS NOT NULL AND nm_pessoa_fisica_w::text <> '') then
			begin
			nr_pos_w := position(' ' in nm_pessoa_fisica_w);
			nm_nome_w := substr(nm_pessoa_fisica_w,1,nr_pos_w);
			nm_pessoa_fisica_w := substr(nm_pessoa_fisica_w, nr_pos_w+1);

			nr_pos_w := position(' ' in nm_pessoa_fisica_w);
			if (nr_pos_w > 0) then
				begin
				nm_sobrenome_mae_w := substr(nm_pessoa_fisica_w,1,nr_pos_w);
				nm_pessoa_fisica_w := substr(nm_pessoa_fisica_w, nr_pos_w+1);

				nm_sobrenome_pai_w := nm_pessoa_fisica_w;
				end;
			end if;

			select nextval('person_name_seq')
			into STRICT nr_seq_person_name_w
			;

			insert into person_name values (
			nr_seq_person_name_w,
			clock_timestamp(),
			'TASY',
			clock_timestamp(),
			'TASY',
			'main',
			nm_nome_w,
			nm_sobrenome_pai_w,
			nm_sobrenome_mae_w,
			null,
			null);

			commit;

			update pessoa_fisica
			set nr_seq_person_name = nr_seq_person_name_w,
				dt_atualizacao = clock_timestamp(),
				nm_usuario = 'TASY'
			where cd_pessoa_fisica = c01_w.cd_pessoa_fisica;
			end;
		end if;
		end;
	end loop;
	close c01;
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_person_name () FROM PUBLIC;

