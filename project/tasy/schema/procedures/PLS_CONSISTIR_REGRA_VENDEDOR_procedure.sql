-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_consistir_regra_vendedor ( ie_tipo_item_mensalidade_p text, nr_seq_plano_p bigint, nr_seq_sca_p bigint, nm_usuario_p text, vl_premio_p bigint, tx_premio_p bigint) AS $body$
DECLARE


ie_tipo_operacao_plano_w	varchar(3);
ie_tipo_operacao_sca_w		varchar(3);
ie_item_mens_w			varchar(1)	:= 'N';


BEGIN
if (coalesce(nr_seq_sca_p,0) <> 0) then
	select	ie_tipo_operacao
	into STRICT	ie_tipo_operacao_sca_w
	from	pls_plano
	where	nr_sequencia = nr_seq_sca_p;

	if (ie_tipo_operacao_sca_w <> 'A') then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(1038120);
		--Mensagem: Não é possível cadastrar um produto em Serviço/Cobertura adicional. Favor verifique!
	end if;

	begin
	select	'S'
	into STRICT	ie_item_mens_w
	
	where	pls_obter_item_mens(ie_tipo_item_mensalidade_p,15) = 'S';
	exception
	when others then
		ie_item_mens_w	:= 'N';
	end;

	if (ie_item_mens_w	= 'N') then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(1038121);
		--Mensagem: Para informar um Serviço/Cobertura adicional é necessário selecionar o tipo de item "Serviços e coberturas adicionais". Favor verifique!
	end if;
end if;

if (coalesce(vl_premio_p::text, '') = '' and coalesce(tx_premio_p::text, '') = '') then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(454292);
	--Mensagem: Não é possível salvar a regra sem informar o campo "Vl prêmio" ou "% Prêmio". Favor verificar!
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_consistir_regra_vendedor ( ie_tipo_item_mensalidade_p text, nr_seq_plano_p bigint, nr_seq_sca_p bigint, nm_usuario_p text, vl_premio_p bigint, tx_premio_p bigint) FROM PUBLIC;

