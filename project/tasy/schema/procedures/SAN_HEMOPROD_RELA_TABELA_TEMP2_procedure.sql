-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE san_hemoprod_rela_tabela_temp2 ( dt_inicio_p timestamp, dt_final_p timestamp, ie_opcao_p text) AS $body$
DECLARE


ds_campo_w	varchar(255);
ie_opcao_w	varchar(15);
ds_resultado_w	varchar(255);
qt_resultado_w	bigint;
qt_resultado2_w	bigint;
qt1_w		bigint;
qt2_w		bigint;
qt3_w		bigint;
qt4_w		bigint;
qt5_w		bigint;
qt_result1_w	varchar(20);
qt_result2_w	varchar(20);
qt_result3_w	varchar(20);
qt_result4_w	varchar(20);
qt_result5_w	varchar(20);
dt_inicio_w	timestamp;
dt_final_w	timestamp;

C01 CURSOR FOR
	SELECT	a.vl_dominio,
		CASE WHEN a.vl_dominio='S' THEN 'Repetição'  ELSE a.ds_valor_dominio END  ds_valor_dominio
	from  	valor_dominio a
	where	cd_dominio 	= 2936
	and	ie_opcao_p 	in ('T','A');


C02 CURSOR FOR
	SELECT	a.vl_dominio,
		a.ds_valor_dominio
	from  	valor_dominio a
	where	cd_dominio = 4 and a.ds_valor_dominio not in ('Indeterminado')
	and	ie_opcao_p in ('T','A');

C03 CURSOR FOR
	SELECT	1 cd_faixa,
		'Menor de 18 anos' ds_faixa
	
	where 	ie_opcao_p in ('T','A')
	
union

	SELECT	2 cd_faixa,
		'Maior ou igual 18 anos até menor ou igual a 29 anos' ds_faixa
	
	where	ie_opcao_p in ('T','A')
	
union

	select	3 cd_faixa,
		'Maior que 29 anos e menor ou igual a 40 anos' ds_faixa
	
	where	ie_opcao_p in ('T','A')
	
union

	select	4 cd_faixa,
		'Acima de 40 anos' ds_faixa
	;

C04 CURSOR FOR
	SELECT	nr_sequencia,
		ds_motivo_inaptidao
	FROM   	SAN_MOTIVO_INAPTIDAO
	
	where	nr_sequencia in (2,3,4,5,6,7,8,9,10,12,13,14,15,16,17,18)
	AND	ie_situacao = 'A'
	AND 	ie_opcao_p in ('T','A')
	order by ds_motivo_inaptidao;

C05 CURSOR FOR
	SELECT	 nr_sequencia,
		 ds_tipo_reacao
	from	 san_tipo_reacao
	where	nr_sequencia in (1,2,3,4,6)
	and	ie_situacao = 'A'
	and	ie_local_reacao in ('C','T')
	and	ie_opcao_p in ('C','A');

/*Cursor C06 is
	select distinct	decode(a.nr_sequencia,1,99999,19,99999,a.nr_sequencia),
		decode(a.nr_sequencia,9,'HIV',19,'HIV',a.ds_exame) ds_exame
	from  	san_exame a
	where	a.ie_exige_senha = 'S'
	and 	a.nr_sequencia not in(10,11,12,9)
	and	ie_opcao_p in ('E','A')
	order by ds_exame;*/
C06 CURSOR FOR
	SELECT distinct	a.nr_sequencia,
		a.ds_exame ds_exame
	from  	san_exame a
	where	((a.ie_exige_senha = 'S') or (a.nr_sequencia in (21,6)))
	and	a.nr_sequencia in (21,6,17,16,13,14,15,9,20,10,11,12,8)
	and	ie_opcao_p in ('E','A')
	order by ds_exame;

C07 CURSOR FOR
	SELECT	a.ds_valor_dominio||b.ds ds_sangue
	from (SELECT	ds_valor_dominio
		from  	valor_dominio a
		where	cd_dominio = 1173) a,
		(select	'+' ds
		
		
union

		select	'-' ds
		) b
	where	ie_opcao_p in ('E','A')
	order by ds_sangue;

/*Cursor C08 is -- Ver em conexão
	select	 ie_tipo_derivado,
		ds_tipo_derivado ds_tipo_derivado
	from  	(select distinct	decode(a.nr_sequencia,15,'-3',16,'-3', a.ie_tipo_derivado) ie_tipo_derivado,
			 	decode(a.nr_sequencia,15,'Plaquetaferese',16,'Plaquetaferese', ds_derivado) ds_tipo_derivado
		from  	san_derivado a
		where	ie_situacao = 'A'
		union
		select	 '-1',
			  'Concentrado de Hemácias sem buffy coat'
		from	 dual
		union
		select	 '-2',
			  'Concentrado de Plaquetas sem buffy coat'
		from	 dual)
	where	ie_tipo_derivado is not null
	and	ie_opcao_p in ('P','A');*/
/*Cursor C08 is
	select	ie_tipo_derivado,
		ds_derivado ds_tipo_derivado
	from	san_derivado a
	where	ie_tipo_derivado is not null
	and	a.ie_situacao = 'A'
	and	ie_opcao_p in ('P','A');*/
C08 CURSOR FOR
	SELECT	nr_sequencia,
		ds_derivado ds_tipo_derivado
	from	san_derivado a
	where	a.ie_situacao = 'A'
	and	nr_sequencia not in (2,4)
	and	ie_opcao_p in ('P','A');


C09 CURSOR FOR
	SELECT 	distinct nr_seq_derivado,
		a.ds_derivado
	from	san_producao b,
		san_derivado a
	
	where	b.nr_seq_derivado = a.nr_sequencia
	and	ie_opcao_p in ('P','A')
	order by ds_derivado;


C10 CURSOR FOR
	SELECT 	DISTINCT
		x.ds_derivado ds_derivado,
		coalesce(b.qt_ambulatorio,0) qt_ambulatorio,
		coalesce(c.qt_entidade,0) qt_hospitalar,
		coalesce(d.qt_snat,0) qt_snat,
		coalesce(e.qt_cnat,0) qt_cnat
	FROM san_derivado x
LEFT OUTER JOIN (select	sum(qt) qt_snat,
			nr_seq_derivado,
			ds_derivado
		from (SELECT	COUNT(*) qt,
				b.nr_seq_derivado,
				c.ds_derivado
			FROM	san_derivado c,
				atendimento_paciente d,
				san_producao b,
				san_transfusao a
			WHERE	1 = 1
			and	c.ie_situacao = 'A'
			AND	a.nr_sequencia = b.nr_seq_transfusao
			AND	b.nr_seq_derivado = c.nr_sequencia
			AND	a.nr_atendimento = d.nr_atendimento
			AND	ie_tipo_atendimento = 8
			and	b.nr_seq_derivado not in (4,10)
			and	not exists (	select	1
						from	san_exame_lote x,
							san_exame_realizado z,
							san_doacao v
						where	x.nr_seq_doacao = v.nr_sequencia
						and	v.nr_sequencia = b.nr_seq_doacao
						and	x.nr_sequencia 	= z.nr_seq_exame_lote
						and	z.nr_seq_Exame in (10,11,12)
						and	(z.ds_resultado IS NOT NULL AND z.ds_resultado::text <> ''))
			AND	a.dt_transfusao BETWEEN dt_inicio_w AND dt_final_w
			GROUP BY	c.ds_derivado,
				b.nr_seq_derivado
			
union all

			SELECT	COUNT(*) qt,
				b.nr_seq_derivado,
				c.ds_derivado
			FROM	san_derivado c,
				atendimento_paciente d,
				san_producao b,
				san_transfusao a
			WHERE	1 = 1
			and	c.ie_situacao = 'A'
			AND	a.nr_sequencia = b.nr_seq_transfusao
			AND	b.nr_seq_derivado = c.nr_sequencia
			AND	a.nr_atendimento = d.nr_atendimento
			and	c.ie_situacao = 'A'
			AND	ie_tipo_atendimento <> 8
			and	b.nr_seq_derivado not in (4,10)
			and	not exists (	select	1
						from	san_exame_lote x,
							san_exame_realizado z,
							san_doacao v
						where	x.nr_seq_doacao = v.nr_sequencia
						and	v.nr_sequencia = b.nr_seq_doacao
						and	x.nr_sequencia 	= z.nr_seq_exame_lote
						and	z.nr_seq_Exame in (10,11,12)
						and	(z.ds_resultado IS NOT NULL AND z.ds_resultado::text <> ''))
			AND	a.dt_transfusao BETWEEN dt_inicio_w AND dt_final_w
			GROUP BY	c.ds_derivado,
				b.nr_seq_derivado) alias21
		group by ds_derivado, nr_seq_derivado) d ON (x.nr_sequencia = d.nr_seq_derivado)
LEFT OUTER JOIN (select	sum(qt) qt_cnat,
			nr_seq_derivado,
			ds_derivado
		from (SELECT	COUNT(*) qt,
				b.nr_seq_derivado,
				c.ds_derivado
			FROM	san_derivado c,
				atendimento_paciente d,
				san_producao b,
				san_transfusao a
			WHERE	1 = 1
			and	c.ie_situacao = 'A'
			AND	a.nr_sequencia = b.nr_seq_transfusao
			AND	b.nr_seq_derivado = c.nr_sequencia
			AND	a.nr_atendimento = d.nr_atendimento
			AND	ie_tipo_atendimento = 8
			and	b.nr_seq_derivado not in (4,10)
			and	 exists (	select	1
						from	san_exame_lote x,
							san_exame_realizado z,
							san_doacao v
						where	x.nr_seq_doacao = v.nr_sequencia
						and	v.nr_sequencia = b.nr_seq_doacao
						and	x.nr_sequencia 	= z.nr_seq_exame_lote
						and	z.nr_seq_Exame in (10,11,12)
						and	(z.ds_resultado IS NOT NULL AND z.ds_resultado::text <> ''))
			AND	a.dt_transfusao BETWEEN dt_inicio_w AND dt_final_w
			GROUP BY	c.ds_derivado,
				b.nr_seq_derivado
			
union all

			SELECT	COUNT(*) qt,
				b.nr_seq_derivado,
				c.ds_derivado
			FROM	san_derivado c,
				atendimento_paciente d,
				san_producao b,
				san_transfusao a
			WHERE	1 = 1
			and	c.ie_situacao = 'A'
			AND	a.nr_sequencia = b.nr_seq_transfusao
			AND	b.nr_seq_derivado = c.nr_sequencia
			AND	a.nr_atendimento = d.nr_atendimento
			and	c.ie_situacao = 'A'
			AND	ie_tipo_atendimento <> 8
			and	b.nr_seq_derivado not in (4,10)
			and	 exists (	select	1
						from	san_exame_lote x,
							san_exame_realizado z,
							san_doacao v
						where	x.nr_seq_doacao = v.nr_sequencia
						and	v.nr_sequencia = b.nr_seq_doacao
						and	x.nr_sequencia 	= z.nr_seq_exame_lote
						and	z.nr_seq_Exame in (10,11,12)
						and	(z.ds_resultado IS NOT NULL AND z.ds_resultado::text <> ''))
			AND	a.dt_transfusao BETWEEN dt_inicio_w AND dt_final_w
			GROUP BY	c.ds_derivado,
				b.nr_seq_derivado) alias34
		group by ds_derivado, nr_seq_derivado) e ON (x.nr_sequencia = e.nr_seq_derivado)
LEFT OUTER JOIN (	SELECT	COUNT(*) qt_ambulatorio,
				b.nr_seq_derivado
			FROM	san_derivado c,
				atendimento_paciente d,
				san_producao b,
				san_transfusao a
			WHERE	1 = 1
			and	c.ie_situacao = 'A'
			AND	a.nr_sequencia = b.nr_seq_transfusao
			AND	b.nr_seq_derivado = c.nr_sequencia
			AND	a.nr_atendimento = d.nr_atendimento
			AND	ie_tipo_atendimento = 8
			and	b.nr_seq_derivado not in (4,10)
			AND	a.dt_transfusao BETWEEN dt_inicio_w AND dt_final_w
			GROUP BY	c.ds_derivado,
				b.nr_seq_derivado
		) b ON (x.nr_sequencia = b.nr_seq_derivado)
LEFT OUTER JOIN (	SELECT	COUNT(*) qt_entidade,
				b.nr_seq_derivado
			FROM	san_derivado c,
				atendimento_paciente d,
				san_producao b,
				san_transfusao a
			WHERE	1 = 1
			and	c.ie_situacao = 'A'
			AND	a.nr_sequencia = b.nr_seq_transfusao
			AND	b.nr_seq_derivado = c.nr_sequencia
			AND	a.nr_atendimento = d.nr_atendimento
			and	c.ie_situacao = 'A'
			AND	ie_tipo_atendimento <> 8
			and	b.nr_seq_derivado not in (4,10)
			AND	a.dt_transfusao BETWEEN dt_inicio_w AND dt_final_w
			GROUP BY	c.ds_derivado,
				b.nr_seq_derivado
		) c ON (x.nr_sequencia = c.nr_seq_derivado)
WHERE 1 = 1 and x.ie_situacao = 'A'     and x.nr_sequencia not in (4,10) and ie_opcao_p in ('P','A') ORDER BY	ds_derivado;

C11 CURSOR FOR
	SELECT distinct nr_sequencia,
		ds_derivado
	from	  san_derivado a
	where	 nr_sequencia in (2,6,5,1,/*4,*/
7,10,8)
	and	ie_opcao_p in ('P','A');

C12 CURSOR FOR
	SELECT distinct nr_sequencia,
		ds_tipo_reacao
	from   san_tipo_reacao
	where  nr_sequencia in (7,/*42,*/
9,10,11,12)
	and	ie_opcao_p in ('R','A')
	order by ds_tipo_reacao;

C13 CURSOR FOR
	SELECT nr_sequencia,
		ds_derivado
	from   san_derivado
	where  nr_sequencia in (5,6)
	and  ie_opcao_p in ('V','A')
	order by ds_derivado;

C14 CURSOR FOR
	SELECT	a.vl_dominio,
		a.ds_valor_dominio ds_valor_dominio
	from  	valor_dominio a
	where	a.cd_dominio = 1353
	--and	a.vl_dominio = 1
	and	ie_opcao_p in ('C','A')
	order by 2;


BEGIN

dt_inicio_w 	:= trunc(dt_inicio_p);
dt_final_w	:= trunc(dt_final_p) + 86399/86400;

delete
from	W_HEMOPROD_T;

if (dt_inicio_w IS NOT NULL AND dt_inicio_w::text <> '') and (dt_final_p IS NOT NULL AND dt_final_p::text <> '') and (ie_opcao_p IS NOT NULL AND ie_opcao_p::text <> '') then
	if (ie_opcao_p = 'T') or (ie_opcao_p = 'A') then

	-- Titulo Triagem
	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ie_tipo)
	values ('2',
		'Triagem',
		'TI');

	-- Titulo Triagem subtitulos
	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo)
	values ('2',
		'2.1 - Candidato quanto ao tipo de doação',
		'2.1',
		'S');

	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo)
	values ('2',
		'2.2 - Candidato quanto ao tipo de doação',
		'2.2',
		'S');

	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo)
	values ('2',
		'2.3 - Candidato quanto ao gênero do doador',
		'2.3',
		'S');

	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo)
	values ('2',
		'2.4 - Candidato quanto a idade do doador',
		'2.4',
		'S');

	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo)
	values ('2',
		'2.5 - Inaptidão na triagem',
		'2.5',
		'S');

	-- Titulos Triagem label
	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('Total',
		'Apto',
		'Inapto',
		'2.1',
		'2',
		'L',
		3);

	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('Total',
		'Apto',
		'Inapto',
		'2.2',
		'2',
		'L',
		3);

	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('Total',
		'Apto',
		'Inapto',
		'2.3',
		'2',
		'L',
		3);

	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('Total',
		'Apto',
		'Inapto',
		'2.4',
		'2',
		'L',
		3);

	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('Feminino',
		'Masculino',
		'2.5',
		'2',
		'L',
		2);





	--Total Dados 1 triagem 2.1
	select	 count(*) qt
	into STRICT	 qt_result1_w
	from  	 san_doacao a
	where	 a.dt_doacao between dt_inicio_w and dt_final_w
	and	 a.nr_seq_tipo in (1,5,6,7,8,9,10,11)
	and	a.nr_seq_tipo <> 4;

	--Apto Dados 1 triagem 2.1
	select	 count(*) qt
	into STRICT	 qt_result2_w
	from  	 san_doacao a
	where	 a.dt_doacao between dt_inicio_w and dt_final_w
	and	 a.nr_seq_tipo in (1,5,6,7,8,9,10,11)
	and	a.nr_seq_tipo <> 4
	and	 coalesce(a.ie_avaliacao_final,'I') = 'A';

	-- Inapto Dados 1 triagem 2.1
	select	 count(*) qt
	into STRICT	 qt_result3_w
	from  	 san_doacao a
	where	 a.dt_doacao between dt_inicio_w and dt_final_w
	and	 a.nr_seq_tipo in (1,5,6,7,8,9,10,11)
	and	a.nr_seq_tipo <> 4
	and	 coalesce(a.ie_avaliacao_final,'I') = 'I';

	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		ds_banda_superior,
		qt_coluna,
		ie_tipo,
		ds_resultado,
		ie_tipo_informacao)
	values (qt_result1_w,
		qt_result2_w,
		qt_result3_w,
		'2.1',
		3,
		'R',
		'Espontânea',
		'2');

	--Total Dados 2 triagem 2.1
	select	 count(*) qt
	into STRICT	 qt_result1_w
	from  	 san_doacao a
	where	 a.dt_doacao between dt_inicio_w and dt_final_w
	--and	 a.nr_seq_tipo in (2,3,5,7); -- Ver conexão
	and	a.nr_seq_tipo in (2)
	and	a.nr_seq_tipo <> 4;

	--Apto Dados 2 triagem 2.1
	select	 count(*) qt
	into STRICT	 qt_result2_w
	from  	 san_doacao a
	where	 a.dt_doacao between dt_inicio_w and dt_final_w
	--and	 a.nr_seq_tipo in (2,3,5,7)
	and	a.nr_seq_tipo in (2)
	and	a.nr_seq_tipo <> 4
	and	 coalesce(a.ie_avaliacao_final,'I') = 'A';


	--Inapto Dados 2 triagem 2.1
	select	 count(*) qt
	into STRICT	 qt_result3_w
	from  	 san_doacao a
	where	 a.dt_doacao between dt_inicio_w and dt_final_w
	--and	 a.nr_seq_tipo in (2,3,5,7)
	and	a.nr_seq_tipo <> 4
	and	a.nr_seq_tipo in (2)
	and	 coalesce(a.ie_avaliacao_final,'I') = 'I';

	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		ds_banda_superior,
		qt_coluna,
		ie_tipo,
		ds_resultado,
		ie_tipo_informacao)
	values (qt_result1_w,
		qt_result2_w,
		qt_result3_w,
		'2.1',
		3,
		'R',
		'Reposição',
		'2');


	--Total Dados 3 triagem 2.1
	select	 count(*) qt
	into STRICT	 qt_result1_w
	from  	 san_doacao a
	where	 a.dt_doacao between dt_inicio_w and dt_final_w
	and	a.nr_seq_tipo <> 4
	and	 a.nr_seq_tipo in (3);

	--Apto Dados 3 triagem 2.1
	select	 count(*) qt
	into STRICT	 qt_result2_w
	from  	 san_doacao a
	where	 a.dt_doacao between dt_inicio_w and dt_final_w
	and	 a.nr_seq_tipo in (3)
	and	a.nr_seq_tipo <> 4
	and	 coalesce(a.ie_avaliacao_final,'I') = 'A';

	--Inapto Dados 3 triagem 2.1
	select	 count(*) qt
	into STRICT	 qt_result3_w
	from  	 san_doacao a
	where	 a.dt_doacao between dt_inicio_w and dt_final_w
	and	 a.nr_seq_tipo in (3)
	and	a.nr_seq_tipo <> 4
	and	 coalesce(a.ie_avaliacao_final,'I') = 'I';

	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		ds_banda_superior,
		qt_coluna,
		ie_tipo,
		ds_resultado,
		ie_tipo_informacao)
	values (qt_result1_w,
		qt_result2_w,
		qt_result3_w,
		'2.1',
		3,
		'R',
		'Autologa',
		'2');

	--Total Total triagem 2.1
	select	 count(*) qt
	into STRICT	 qt_result1_w
	from  	 san_doacao a
	where	 a.dt_doacao between dt_inicio_w and dt_final_w
	and	a.nr_seq_tipo <> 4;


	--Apto Total triagem 2.1
	select	 count(*) qt
	into STRICT	 qt_result2_w
	from  	 san_doacao a
	where	 a.dt_doacao between dt_inicio_w and dt_final_w
	and	a.nr_seq_tipo <> 4
	and	 coalesce(a.ie_avaliacao_final,'I') = 'A';


	-- Inapto Total triagem 2.1
	select	 count(*) qt
	into STRICT	 qt_result3_w
	from  	 san_doacao a
	where	 a.dt_doacao between dt_inicio_w and dt_final_w
	and	a.nr_seq_tipo <> 4
	and	 coalesce(a.ie_avaliacao_final,'I') = 'I';

	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		ds_banda_superior,
		qt_coluna,
		ie_tipo,
		ds_resultado,
		ie_tipo_informacao)
	values (qt_result1_w,
		qt_result2_w,
		qt_result3_w,
		'2.1',
		3,
		'T',
		'Total',
		'2');

	-- Dados 1 triagem 2.2
	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;

	open C01;
	loop
	fetch C01 into
		ie_opcao_w,
		ds_campo_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */
		begin

		select	 count(*)
		into STRICT	 qt_result1_w
		from  	 san_doacao a
		where	 a.dt_doacao between dt_inicio_w and dt_final_w
		and	 coalesce(a.IE_TIPO_DOADOR,0) = ie_opcao_w;

		qt1_w := qt_result1_w + qt1_w;


		select	 count(*)
		into STRICT	 qt_result2_w
		from  	 san_doacao a
		where	 a.dt_doacao between dt_inicio_w and dt_final_w
		and	 coalesce(a.IE_TIPO_DOADOR,0) = ie_opcao_w
		and	 coalesce(a.ie_avaliacao_final,'I') = 'A';

		qt2_w := qt_result2_w + qt2_w;


		select	count(*)
		into STRICT	qt_result3_w
		from  	san_doacao a
		where	a.dt_doacao between dt_inicio_w and dt_final_w
		and	coalesce(a.IE_TIPO_DOADOR,0) = ie_opcao_w
		and	coalesce(a.ie_avaliacao_final,'I') = 'I';

		qt3_w := qt_result3_w + qt3_w;

		insert into W_HEMOPROD_T(qt_resultado_1,
			qt_resultado_2,
			qt_resultado_3,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			qt_result2_w,
			qt_result3_w,
			'2.2',
			3,
			'R',
			ds_campo_w,
			'2');

		end;


	end loop;
	close C01;

	--Total triagem 2.2
	/*select	 count(*) qt
	into	 ds_campo_w
	from  	 san_doacao a
	where	 a.dt_doacao between dt_inicio_w and dt_final_w
	and not 	 ie_tipo_doador is null;*/
	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		ds_banda_superior,
		qt_coluna,
		ie_tipo,
		ds_resultado,
		ie_tipo_informacao)
	values (qt1_w,
		qt2_w,
		qt3_w,
		'2.2',
		3,
		'T',
		'Total',
		'2');

	/*select	 count(*) qt
	into	 ds_campo_w
	from  	 san_doacao a
	where	 a.dt_doacao between dt_inicio_w and dt_final_w
	and	 nvl(a.ie_avaliacao_final,'I') = 'A'
	and not ie_tipo_doador is null;*/
	/*select	 count(*) qt
	into	 ds_campo_w
	from  	 san_doacao a
	where	 a.dt_doacao between dt_inicio_w and dt_final_w
	and	 nvl(a.ie_avaliacao_final,'I') = 'I'
	and not ie_tipo_doador is null;*/
	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;
	--Dados 1 triagem 2.3
	open C02;
	loop
	fetch C02 into
		ie_opcao_w,
		ds_campo_w;
	EXIT WHEN NOT FOUND; /* apply on C02 */
		begin

		select	 count(*) qt
		into STRICT	 qt_result1_w
		from 	 pessoa_fisica b,
			 san_doacao a
		where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
		and	 a.dt_doacao between dt_inicio_w and dt_final_w
		and	 b.ie_sexo = ie_opcao_w;

		qt1_w := qt_result1_w + qt1_w;


		select	count(*) qt
		into STRICT	qt_result2_w
		from  	pessoa_fisica b,
			san_doacao a
		where	a.cd_pessoa_fisica = b.cd_pessoa_fisica
		and	a.dt_doacao between dt_inicio_w and dt_final_w
		and	b.ie_sexo = ie_opcao_w
		and	coalesce(a.ie_avaliacao_final,'I') = 'A';

		qt2_w := qt_result2_w + qt2_w;


		select	count(*) qt
		into STRICT	qt_result3_w
		from  	pessoa_fisica b,
			san_doacao a
		where	a.cd_pessoa_fisica = b.cd_pessoa_fisica
		and	a.dt_doacao between dt_inicio_w and dt_final_w
		and	b.ie_sexo = ie_opcao_w
		and	coalesce(a.ie_avaliacao_final,'I') = 'I';

		qt3_w := qt_result3_w + qt3_w;

		insert into W_HEMOPROD_T(qt_resultado_1,
			qt_resultado_2,
			qt_resultado_3,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			qt_result2_w,
			qt_result3_w,
			'2.3',
			3,
			'R',
			ds_campo_w,
			'2');

		end;


	end loop;
	close C02;



	-- Total triagem 2.3
	/*select	 count(*) qt
	into	 ds_campo_w
	from  	  pessoa_fisica b,
		san_doacao a
	where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
	and	 a.dt_doacao between dt_inicio_w and dt_final_w
	and		 b.ie_sexo not in ('I')
	and		 nvl(a.ie_avaliacao_final,'I') = 'I';*/
	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		ds_banda_superior,
		qt_coluna,
		ie_tipo,
		ds_resultado,
		ie_tipo_informacao)
	values (qt1_w,
		qt2_w,
		qt3_w,
		'2.3',
		3,
		'T',
		'Total',
		'2');

	/*select	 count(*) qt
	into	 ds_campo_w
	from  	 pessoa_fisica b,
		san_doacao a
	where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
	and	 a.dt_doacao between dt_inicio_w and dt_final_w
	and		 b.ie_sexo not in ('I');*/
	/*select	 count(*) qt
	into	 ds_campo_w
	from  	pessoa_fisica b,
		san_doacao a
	where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
	and	 a.dt_doacao between dt_inicio_w and dt_final_w
	and	 b.ie_sexo not in ('I')
	and	 nvl(a.ie_avaliacao_final,'I') = 'A';*/
	--Dados 1 triagem 2.4
	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;

	open C03;
	loop
	fetch C03 into
		ie_opcao_w,
		ds_campo_w;
	EXIT WHEN NOT FOUND; /* apply on C03 */
		begin

		select	count(*)
		into STRICT	qt_result1_w
		from  	pessoa_fisica b,
			san_doacao a
		where	a.cd_pessoa_fisica = b.cd_pessoa_fisica
		and	a.dt_doacao between dt_inicio_w and dt_final_w
		and	(((ie_opcao_w = 1) and (trunc(((clock_timestamp()-b.dt_nascimento)/365)) < 18)) or
			((ie_opcao_w = 2) and (trunc(((clock_timestamp()-b.dt_nascimento)/365)) between 18 and 29)) or
			((ie_opcao_w = 3) and (trunc(((clock_timestamp()-b.dt_nascimento)/365)) between 29 and 40)) or
			((ie_opcao_w = 4) and (trunc(((clock_timestamp()-b.dt_nascimento)/365)) > 40)));

		qt1_w := qt1_w  + qt_result1_w;


		select	 count(*) qt
		into STRICT	 qt_result2_w
		from  	 pessoa_fisica b,
			san_doacao a
		where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
		and	 a.dt_doacao between dt_inicio_w and dt_final_w
		and	(((ie_opcao_w = 1) and (trunc(((clock_timestamp()-b.dt_nascimento)/365)) < 18)) or
			((ie_opcao_w = 2) and (trunc(((clock_timestamp()-b.dt_nascimento)/365)) between 18 and 29)) or
			((ie_opcao_w = 3) and (trunc(((clock_timestamp()-b.dt_nascimento)/365)) between 29 and 40)) or
			((ie_opcao_w = 4) and (trunc(((clock_timestamp()-b.dt_nascimento)/365)) > 40)))
		and		 coalesce(a.ie_avaliacao_final,'I') = 'A';

		qt2_w := qt2_w  + qt_result2_w;

		select	 count(*) qt
		into STRICT	qt_result3_w
		from  	pessoa_fisica b ,
			san_doacao a
		where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
		and	 a.dt_doacao between dt_inicio_w and dt_final_w
		and	(((ie_opcao_w = 1) and (trunc(((clock_timestamp()-b.dt_nascimento)/365)) < 18)) or
			((ie_opcao_w = 2) and (trunc(((clock_timestamp()-b.dt_nascimento)/365)) between 18 and 29)) or
			((ie_opcao_w = 3) and (trunc(((clock_timestamp()-b.dt_nascimento)/365)) between 29 and 40)) or
			((ie_opcao_w = 4) and (trunc(((clock_timestamp()-b.dt_nascimento)/365)) > 40)))
		and	 coalesce(a.ie_avaliacao_final,'I') = 'I';

		qt3_w := qt3_w  + qt_result3_w;

		insert into W_HEMOPROD_T(qt_resultado_1,
			qt_resultado_2,
			qt_resultado_3,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			qt_result2_w,
			qt_result3_w,
			'2.4',
			3,
			'R',
			ds_campo_w,
			'2');

		end;


	end loop;
	close C03;


	--Total Triagem 2.4
	/*select	 count(*) qt
	into	 ds_campo_w
	from  	 pessoa_fisica b,
		 san_doacao a
	where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
	and	a.dt_doacao between dt_inicio_w and dt_final_w
	and	(((1 = 1) and (trunc(((sysdate-b.dt_nascimento)/365)) < 18)) or
		((2 = 2) and (trunc(((sysdate-b.dt_nascimento)/365)) between 18 and 29)) or
		((3 = 3) and (trunc(((sysdate-b.dt_nascimento)/365)) > 29)));
	--and	 trunc(((sysdate-b.dt_nascimento)/365)) >= 18;*/
	insert into W_HEMOPROD_T
		(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		ds_banda_superior,
		qt_coluna,
		ie_tipo,
		ds_resultado,
		ie_tipo_informacao)
	values	(qt1_w,
		qt2_w,
		qt3_w,
		'2.4',
		3,
		'T',
		'Total',
		'2');

	/*select	 count(*) qt
	into	 ds_campo_w
	from  	pessoa_fisica b,
		san_doacao a
	where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
	and	a.dt_doacao between dt_inicio_w and dt_final_w
	and	(((1 = 1) and (trunc(((sysdate-b.dt_nascimento)/365)) < 18)) or
		((2 = 2) and (trunc(((sysdate-b.dt_nascimento)/365)) between 18 and 29)) or
		((3 = 3) and (trunc(((sysdate-b.dt_nascimento)/365)) > 29)))
	and		 nvl(a.ie_avaliacao_final,'I') = 'A';*/
	/*select	 count(*) qt
	into	 ds_campo_w
	from  	pessoa_fisica b,
		san_doacao a
	where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
	and	a.dt_doacao between dt_inicio_w and dt_final_w
	and	(((1 = 1) and (trunc(((sysdate-b.dt_nascimento)/365)) < 18)) or
		((2 = 2) and (trunc(((sysdate-b.dt_nascimento)/365)) between 18 and 29)) or
		((3 = 3) and (trunc(((sysdate-b.dt_nascimento)/365)) > 29)))
	and		 nvl(a.ie_avaliacao_final,'I') = 'I';*/
	-- Dados 1 triagem 2.5
	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;

	open C04;
	loop
	fetch C04 into
		ie_opcao_w,
		ds_campo_w;
	EXIT WHEN NOT FOUND; /* apply on C04 */
		begin

		SELECT 	COUNT(*)
		into STRICT 	qt_result1_w
		FROM   san_impedimento b,
			san_questionario c,
			san_doacao d,
			pessoa_fisica e
		WHERE	b.nr_sequencia = c.nr_seq_impedimento
		AND	c.NR_SEQ_DOACAO = d.NR_SEQUENCIA
		AND	d.cd_pessoa_fisica = e.cd_pessoa_fisica
		AND	b.ie_questionario = 'S'
		AND    	d.ie_avaliacao_final <> 'A'
		AND	coalesce(c.ie_impede_doacao,'N') = 'S'
		AND	d.dt_doacao between dt_inicio_w and dt_final_w
		AND	c.nr_seq_motivo_inaptidao = ie_opcao_w
		AND	e.ie_sexo = 'F';


		SELECT 	COUNT(*)
		into STRICT 	qt_result2_w
		FROM   	san_impedimento b,
			san_questionario c,
			san_doacao d,
			pessoa_fisica e
		WHERE  	b.nr_sequencia = c.nr_seq_impedimento
		AND	c.NR_SEQ_DOACAO = d.NR_SEQUENCIA
		AND	d.cd_pessoa_fisica = e.cd_pessoa_fisica
		AND	b.ie_questionario = 'S'
		AND	d.ie_avaliacao_final <> 'A'
		AND	coalesce(c.ie_impede_doacao,'N') = 'S'
		AND	d.dt_doacao between dt_inicio_w and trunc(dt_final_p) + 86399/86400
		AND	c.nr_seq_motivo_inaptidao = ie_opcao_w
		AND	e.ie_sexo = 'M';


		insert into W_HEMOPROD_T(qt_resultado_1,
			qt_resultado_2,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			qt_result2_w,
			'2.5',
			2,
			'R',
			ds_campo_w,
			'2');


		end;


	end loop;
	close C04;


	-- Outros Triagem 2.5
	SELECT	COUNT(*)
	into STRICT	qt_result1_w
	FROM   	san_doacao d,
		pessoa_fisica e,
		san_questionario c,
		san_impedimento b
	WHERE  	b.nr_sequencia = c.nr_seq_impedimento
	AND	c.NR_SEQ_DOACAO = d.NR_SEQUENCIA
	AND	d.cd_pessoa_fisica = e.cd_pessoa_fisica
	AND	b.ie_questionario = 'S'
	AND    	d.ie_avaliacao_final <> 'A'
	AND	coalesce(c.ie_impede_doacao,'N') = 'S'
	AND	d.dt_doacao between dt_inicio_w and dt_final_w
	AND	c.nr_seq_motivo_inaptidao NOT IN (2,3,4,5,6,7,8,9,10,12,13,14,15,16,17,18)
	AND	(c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
	AND	e.ie_sexo = 'F';


	SELECT 	COUNT(*)
	into STRICT	qt_result2_w
	FROM   	san_doacao d,
		pessoa_fisica e,
		san_questionario c,
		san_impedimento b
	WHERE  	b.nr_sequencia = c.nr_seq_impedimento
	AND	c.NR_SEQ_DOACAO = d.NR_SEQUENCIA
	AND	d.cd_pessoa_fisica = e.cd_pessoa_fisica
	AND	b.ie_questionario = 'S'
	AND    	d.ie_avaliacao_final <> 'A'
	AND	coalesce(c.ie_impede_doacao,'N') = 'S'
	AND	d.dt_doacao between dt_inicio_w and dt_final_w
	AND	c.nr_seq_motivo_inaptidao NOT IN (2,3,4,5,6,7,8,9,10,12,13,14,15,16,17,18)
	AND	(c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
	AND	e.ie_sexo = 'M';

	insert into W_HEMOPROD_T(qt_resultado_1,
			qt_resultado_2,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			qt_result2_w,
			'2.5',
			2,
			'R',
			'Outros',
			'2');


	-- Total triagem 2.5
	SELECT 	COUNT(*)
	into STRICT	qt_result1_w
	FROM   	san_doacao d,
		pessoa_fisica e,
		san_impedimento b,
		san_questionario c
	WHERE  	b.nr_sequencia = c.nr_seq_impedimento
	AND	c.NR_SEQ_DOACAO = d.NR_SEQUENCIA
	AND	d.cd_pessoa_fisica = e.cd_pessoa_fisica
	AND	b.ie_questionario = 'S'
	AND    	d.ie_avaliacao_final <> 'A'
	AND	coalesce(c.ie_impede_doacao,'N') = 'S'
	AND	d.dt_doacao between dt_inicio_w and dt_final_w
	AND	(c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
	--and	c.nr_seq_motivo_inaptidao in (2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18)
	AND	e.ie_sexo = 'F';


	SELECT 	COUNT(*)
	into STRICT	qt_result2_w
	FROM   san_doacao d,
		pessoa_fisica e,
		san_impedimento b,
		san_questionario c
	WHERE  b.nr_sequencia = c.nr_seq_impedimento
	AND	   c.NR_SEQ_DOACAO = d.NR_SEQUENCIA
	AND	   d.cd_pessoa_fisica = e.cd_pessoa_fisica
	AND	   b.ie_questionario = 'S'
	AND    d.ie_avaliacao_final <> 'A'
	AND	   coalesce(c.ie_impede_doacao,'N') = 'S'
	AND	   d.dt_doacao between dt_inicio_w and dt_final_w
	AND	 (c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
	--and	c.nr_seq_motivo_inaptidao in (2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18)
	AND	 e.ie_sexo = 'M';

	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		ds_banda_superior,
		qt_coluna,
		ie_tipo,
		ds_resultado,
		ie_tipo_informacao)
	values (qt_result1_w,
		qt_result2_w,
		'2.5',
		2,
		'T',
		'Total',
		'2');

	end if;

	if (ie_opcao_p = 'C') or (ie_opcao_p = 'A') then
	-- Titulo Coleta
	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ie_tipo)
	values ('3',
		'Coleta',
		'TI');

	-- Titulo Coleta subtitulos
	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo)
	values ('3',
		' ',
		'3.1',
		'S');

	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo)
	values ('3',
		'3.2 - Interrupções na coleta',
		'3.2',
		'S');

	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo)
	values ('3',
		'3.3 - Total coletas',
		'3.3',
		'S');

	-- Titulos Coleta label
	insert into W_HEMOPROD_T(qt_resultado_1,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('Total',
		'3.1',
		'3',
		'L',
		1);

	insert into W_HEMOPROD_T(qt_resultado_1,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('Total',
		'3.2',
		'3',
		'L',
		1);

	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('Total',
		'Apto',
		'Inapto',
		'3.3',
		'3',
		'L',
		3);

	--Titulo Coleta 3.1
	select	count(*)
	into STRICT	qt_result1_w
	from  	san_doacao a
	where	(a.nr_motivo_desistencia IS NOT NULL AND a.nr_motivo_desistencia::text <> '')
	and	a.dt_doacao between dt_inicio_w and dt_final_w;

	insert into W_HEMOPROD_T(qt_resultado_1,
		ds_banda_superior,
		qt_coluna,
		ie_tipo,
		ds_resultado,
		ie_tipo_informacao)
	values (qt_result1_w,
		'3.1',
		1,
		'R',
		'3.1 - Desistência:' ,
		'3');

	--Dados coleta 3.2
	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;

	open C05;
	loop
	fetch C05 into
		ie_opcao_w,
		ds_campo_w;
	EXIT WHEN NOT FOUND; /* apply on C05 */
		begin

		select	count(*)
		into STRICT	qt_result1_w
		from	san_doacao a,
			SAN_DOACAO_REACAO b,
			san_tipo_reacao c
		where	a.nr_sequencia = b.nr_seq_doacao
		and	a.dt_doacao between dt_inicio_w and dt_final_w
		and	b.nr_seq_reacao = c.nr_sequencia
		and	c.nr_sequencia in (1,2,3,4,6)
		and	c.nr_sequencia = ie_opcao_w;

		qt1_w := qt_result1_w + qt1_w;

		insert into W_HEMOPROD_T(qt_resultado_1,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			'3.2',
			1,
			'R',
			ds_campo_w,
			'3');



		end;


	end loop;
	close C05;

	--Total coleta 3.2
	select	count(*)
	into STRICT	qt_result1_w
	from	san_doacao a,
		SAN_DOACAO_REACAO b,
		san_tipo_reacao c
	where	a.nr_sequencia = b.nr_seq_doacao
	and	b.nr_seq_reacao = c.nr_sequencia
	and	c.nr_sequencia not in (1,2,3,4,6)
	and	ie_local_reacao in ('C','T')
	and	c.ie_situacao = 'A'
	and	a.dt_doacao between dt_inicio_w and dt_final_w;

	insert into W_HEMOPROD_T(qt_resultado_1,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			'3.2',
			1,
			'R',
			'Outros',
			'3');


	select	count(*)
	into STRICT	qt_result1_w
	from	san_doacao a,
		SAN_DOACAO_REACAO b,
		san_tipo_reacao c
	where	a.nr_sequencia = b.nr_seq_doacao
	and	b.nr_seq_reacao = c.nr_sequencia
	--and	c.nr_sequencia not in (1,2,3,4,6)
	and	ie_local_reacao in ('C','T')
	and	c.ie_situacao = 'A'
	and	a.dt_doacao between dt_inicio_w and dt_final_w;

	insert into W_HEMOPROD_T(qt_resultado_1,
		ds_banda_superior,
		qt_coluna,
		ie_tipo,
		ds_resultado,
		ie_tipo_informacao)
	values (qt_result1_w,
		'3.2',
		1,
		'T',
		'Total',
		'3');

	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;
	-- DAdos sangue total coleta 3.3
	open C14;
	loop
	fetch C14 into
		ie_opcao_w,
		ds_campo_w;
	EXIT WHEN NOT FOUND; /* apply on C14 */
		begin

		select	 count(*)
		into STRICT	qt_result1_w
		from  	 san_doacao a
		where	 a.dt_doacao between dt_inicio_w and dt_final_w
		and	a.ie_tipo_coleta = ie_opcao_w;

		qt1_w := qt_result1_w + qt1_w;


		select	 count(*)
		into STRICT	qt_result2_w
		from  	 san_doacao a
		where	 a.dt_doacao between dt_inicio_w and dt_final_w
		and	a.ie_tipo_coleta = ie_opcao_w
		and	 coalesce(a.ie_avaliacao_final,'I') = 'A';

		qt2_w := qt_result2_w + qt2_w;

		select	 count(*)
		into STRICT	qt_result3_w
		from  	 san_doacao a
		where	 a.dt_doacao between dt_inicio_w and dt_final_w
		and	a.ie_tipo_coleta = ie_opcao_w
		and	 coalesce(a.ie_avaliacao_final,'I') = 'I';

		qt3_w := qt_result3_w + qt3_w;

		insert into W_HEMOPROD_T(qt_resultado_1,
			qt_resultado_2,
			qt_resultado_3,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			qt_result2_w,
			qt_result3_w,
			'3.3',
			3,
			'R',
			ds_campo_w,
			'3');

		end;


	end loop;
	close C14;

	-- Sangue total coleta 3.3
	/*select	 count(*)
	into	qt_result1_w
	from  	 san_doacao a
	where	 a.dt_doacao between dt_inicio_w and dt_final_w
	and	a.ie_tipo_coleta in (0,2);

	insert into W_HEMOPROD_T
			(qt_resultado_1,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values	(qt_result1_w,
			'3.3',
			1,
			'R',
			'Sangue total',
			'3');*/
	--Total coleta 3.3
	/*select	 count(*)
	into	qt_result1_w
	from  	 san_doacao a
	where	 a.dt_doacao between dt_inicio_w and dt_final_w
	and	a.IE_TIPO_COLETA  is not null;*/
	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		ds_banda_superior,
		qt_coluna,
		ie_tipo,
		ds_resultado,
		ie_tipo_informacao)
	values (qt1_w,
		qt2_w,
		qt3_w,
		'3.3',
		3,
		'T',
		'Total',
		'3');


	end if;

	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;
	if (ie_opcao_p = 'E') or (ie_opcao_p = 'A') then

	-- Titulo Triagem
	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ie_tipo)
	values ('4',
		'Exames realizados',
		'TI');


	-- Titulo Triagem subtitulos
	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo)
	values ('4',
		'4.1 - Triagem de doenças transmissíveis pelo sangue',
		'4.1',
		'S');

	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo)
	values ('4',
		'4.2 - ImunoHematologia',
		'4.2',
		'S');

	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo)
	values ('4',
		'4.3 - Outros tipos de pesquisa',
		'4.3',
		'S');

	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo)
	values ('4',
		'4.3 - Inaptidão na triagem dos exames',
		'4.4',
		'S');

	-- Titulos Triagem label
	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('Testadas',
		'Reagentes',
		'4.1',
		'4',
		'L',
		2);

	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('Doador Apto',
		'Doador Inapto',
		'Receptor',
		'4.2',
		'4',
		'L',
		3);

	insert into W_HEMOPROD_T(qt_resultado_1,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('Total',
		'4.3',
		'4',
		'L',
		1);

	insert into W_HEMOPROD_T(qt_resultado_1,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('Total',
		'4.4',
		'4',
		'L',
		1);

	--Dados E.R 4.1
	open C06;
	loop
	fetch C06 into
		ie_opcao_w,
		ds_campo_w;
	EXIT WHEN NOT FOUND; /* apply on C06 */
		begin

		select	count(*)
		into STRICT	 qt_result1_w
		from	san_doacao a,
			san_exame_lote b,
			san_exame_realizado c
		where	a.nr_sequencia = b.nr_seq_doacao
		and	b.nr_sequencia = c.nr_seq_exame_lote
		and	a.dt_doacao between dt_inicio_w and dt_final_w
		and	(c.ds_resultado IS NOT NULL AND c.ds_resultado::text <> '')
		and	c.nr_seq_exame = ie_opcao_w;


			/*insert into W_HEMOPROD_T (	QT_RESULTADO,
						IE_TIPO,
						ie_opcao)
				values		(ds_campo_w,
						'D_Testado_4_1',
						ie_opcao_w);*/
		select	count(*)
		into STRICT	qt_result2_w
		from	san_doacao a,
			san_exame_lote b,
			san_exame_realizado c
		where	a.nr_sequencia = b.nr_seq_doacao
		and	b.nr_sequencia = c.nr_seq_exame_lote
		and	a.dt_doacao between dt_inicio_w and dt_final_w
		and	c.nr_seq_exame = ie_opcao_w
		and	replace(upper(ds_resultado),' ','') in ('POSITIVO','REAGENTE');


		insert into W_HEMOPROD_T(qt_resultado_1,
			qt_resultado_2,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			qt_result2_w,
			'4.1',
			2,
			'R',
			ds_campo_w,
			'4');


		end;


	end loop;
	close C06;

	--Total E.R 4.1
	/*select	sum(qt)
	into 	qt_result1_w
	from  	(	select	count(*) qt
			from	san_doacao a,
					san_exame_lote b,
					san_exame_realizado c,
					san_exame d
			where	a.nr_sequencia = b.nr_seq_doacao
			and		b.nr_sequencia = c.nr_seq_exame_lote
			and		c.nr_seq_exame = d.nr_sequencia
			and		a.dt_doacao between dt_inicio_w and dt_final_w
			and		d.ie_exige_senha = 'S'
			and		d.nr_sequencia not in(13,14,9,19)
			and		d.nr_sequencia not in(10,11,12,9)
			and		c.ds_resultado is not null
			union all
			select	count(distinct a.nr_sequencia) qt
			from	san_doacao a,
					san_exame_lote b,
					san_exame_realizado c,
					san_exame d
			where	a.nr_sequencia = b.nr_seq_doacao
			and		b.nr_sequencia = c.nr_seq_exame_lote
			and		c.nr_seq_exame = d.nr_sequencia
			and		a.dt_doacao between dt_inicio_w and dt_final_w
			and		d.ie_exige_senha = 'S'
			and		d.nr_sequencia not in (12,9)
			and		d.nr_sequencia in(13,14)
			and		c.ds_resultado is not null
			union all
			select	count(distinct a.nr_sequencia) qt
			from	san_doacao a,
					san_exame_lote b,
					san_exame_realizado c,
					san_exame d
			where	a.nr_sequencia = b.nr_seq_doacao
			and		b.nr_sequencia = c.nr_seq_exame_lote
			and		c.nr_seq_exame = d.nr_sequencia
			and		a.dt_doacao between dt_inicio_w and dt_final_w
			and		d.ie_exige_senha = 'S'
			and		c.ds_resultado is not null
			and		d.nr_sequencia not in (12,9)
			and		d.nr_sequencia in(9,19));*/
			select	count(*)
			into STRICT	qt_result1_w
			from	san_doacao a,
				san_exame_lote b,
				san_exame_realizado c
			where	a.nr_sequencia = b.nr_seq_doacao
			and	b.nr_sequencia = c.nr_seq_exame_lote
			and	a.dt_doacao between dt_inicio_w and dt_final_w
			and	(c.ds_resultado IS NOT NULL AND c.ds_resultado::text <> '')
			and	c.nr_seq_exame in (21,6,17,16,13,14,15,9,20,10,11,12,8);

			/*select		sum(qt)
			into		qt_result2_w
			from  		(select	count(*) qt
			from	san_doacao a,
					san_exame_lote b,
					san_exame_realizado c,
					san_exame d
			where	a.nr_sequencia = b.nr_seq_doacao
			and		b.nr_sequencia = c.nr_seq_exame_lote
			and		c.nr_seq_exame = d.nr_sequencia
			and		a.dt_doacao between dt_inicio_w and dt_final_w
			and		d.ie_exige_senha = 'S'
			and		replace(upper(ds_resultado),' ','') in('POSITIVO','REAGENTE')
			and		d.nr_sequencia not in(13,14,9,19)
			and		d.nr_sequencia not in(10,11,12,9)
			union all
			select	count(distinct a.nr_sequencia)
			from	san_doacao a,
					san_exame_lote b,
					san_exame_realizado c,
					san_exame d
			where	a.nr_sequencia = b.nr_seq_doacao
			and		b.nr_sequencia = c.nr_seq_exame_lote
			and		c.nr_seq_exame = d.nr_sequencia
			and		a.dt_doacao between dt_inicio_w and dt_final_w
			and		d.ie_exige_senha = 'S'
			and		replace(upper(ds_resultado),' ','') in('POSITIVO','REAGENTE')
			and		d.nr_sequencia not in (12,9)
			and		d.nr_sequencia in(13,14)
			union all
			select	count(distinct a.nr_sequencia)
			from	san_doacao a,
					san_exame_lote b,
					san_exame_realizado c,
					san_exame d
			where	a.nr_sequencia = b.nr_seq_doacao
			and		b.nr_sequencia = c.nr_seq_exame_lote
			and		c.nr_seq_exame = d.nr_sequencia
			and		a.dt_doacao between dt_inicio_w and dt_final_w
			and		d.ie_exige_senha = 'S'
			and		replace(upper(ds_resultado),' ','') in('POSITIVO','REAGENTE')
			and		d.nr_sequencia not in (12,9)
			and		d.nr_sequencia in(9,19));*/
			select	count(*)
			into STRICT	qt_result2_w
			from	san_doacao a,
				san_exame_lote b,
				san_exame_realizado c
			where	a.nr_sequencia = b.nr_seq_doacao
			and	b.nr_sequencia = c.nr_seq_exame_lote
			and	a.dt_doacao between dt_inicio_w and dt_final_w
			and	c.nr_seq_exame in (21,6,17,16,13,14,15,9,20,8,10,11,12)
			and	replace(upper(ds_resultado),' ','') in ('POSITIVO','REAGENTE');

			insert into W_HEMOPROD_T(qt_resultado_1,
				qt_resultado_2,
				ds_banda_superior,
				qt_coluna,
				ie_tipo,
				ds_resultado,
				ie_tipo_informacao)
			values (qt_result1_w,
				qt_result2_w,
				'4.1',
				2,
				'T',
				'Total',
				'4');

	--E.R 4.2 Sangue
	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;

	open C07;
	loop
	fetch C07 into
		ie_opcao_w;
	EXIT WHEN NOT FOUND; /* apply on C07 */
		begin

		select	 count(*) ds
		into STRICT	qt_result1_w
		from 	 pessoa_fisica b,
			san_doacao a
		where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
		and	 ie_avaliacao_final = 'A'
		and	 b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = ie_opcao_w
		and	 a.dt_coleta between trunc(dt_inicio_w,'dd') and trunc(dt_final_p,'dd') + 86399/86400;

		qt1_w := qt_result1_w + qt1_w;

		select	 count(*) ds
		into STRICT	qt_result2_w
		from 	 pessoa_fisica b,
			san_doacao a
		where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
		and	 ie_avaliacao_final = 'I'
		and	 b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = ie_opcao_w
		and	 a.dt_coleta between trunc(dt_inicio_w,'dd') and trunc(dt_final_p,'dd') + 86399/86400;

		qt2_w := qt_result2_w + qt2_w;

		select	 count(*) ds
		into STRICT	qt_result3_w
		from	 pessoa_fisica b ,
			san_transfusao a
		where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
		and		 a.dt_transfusao between trunc(dt_inicio_w,'dd') and trunc(dt_final_p,'dd') + 86399/86400
		and		 b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = ie_opcao_w;

		qt3_w := qt_result3_w + qt3_w;

		insert into W_HEMOPROD_T(qt_resultado_1,
			qt_resultado_2,
			qt_resultado_3,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			qt_result2_w,
			qt_result3_w,
			'4.2',
			3,
			'R',
			ie_opcao_w,
			'4');


		end;


	end loop;
	close C07;

	--E.R 4.2 Total sangue
	/*select	count(*)
	into	ds_campo_w
	from	san_doacao a,
		pessoa_fisica b
	where	a.cd_pessoa_fisica = b.cd_pessoa_fisica
	and	ie_avaliacao_final = 'A'
	and	b.ie_tipo_sangue is not null
	and	a.dt_coleta between trunc(dt_inicio_w,'dd') and trunc(dt_final_p,'dd') + 86399/86400;*/
	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		ds_banda_superior,
		qt_coluna,
		ie_tipo,
		ds_resultado,
		ie_tipo_informacao)
	values (qt1_w,
		qt2_w,
		qt3_w,
		'4.2',
		3,
		'R',
		'Total',
		'4');

	/*select	 count(*) ds
	into	ds_campo_w
	from  	 pessoa_fisica b,
		san_transfusao a
	where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
	and	 a.dt_transfusao between trunc(dt_inicio_w,'dd') and trunc(dt_final_p,'dd') + 86399/86400
	and b.ie_tipo_sangue is not null;*/
	--E.R 4.2 Indefinido
	/*select	 count(*)
	into	ds_campo_w
	from  	 pessoa_fisica b,
		san_transfusao a
	where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
	and		 a.dt_transfusao between trunc(dt_inicio_w,'dd') and trunc
(dt_final_p,'dd') + 86399/86400
	and		 ((b.ie_tipo_sangue is null) and (b.ie_fator_rh is null));

	insert into W_HEMOPROD_T (	QT_RESULTADO,
					IE_TIPO)
			values		(ds_campo_w,
					'D_Indefinido_4_2');*/
	--E.R 4.2  D Fraco
	select count(*) -- Ver conexão
	into STRICT	qt_result1_w
	from 	 san_doacao a,
		pessoa_fisica b,
		 san_exame_lote c,
		 san_exame_realizado d
	where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
	and		 a.nr_sequencia = c.nr_seq_doacao
	and		 d.nr_seq_exame_lote = c.nr_sequencia
	and		 d.nr_seq_exame = 18
	and		 ie_avaliacao_final = 'A'
	and		 ((b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A+') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A-') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB+') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB-') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B+') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B-') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O+') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O-'))
	and	d.ds_resultado is	not null
	and		 a.dt_coleta between trunc(dt_inicio_w,'dd') and trunc(dt_final_p,'dd') + 86399/86400;
	--and		 ((upper(d.ds_resultado) = 'POSITIVO') or (upper(d.ds_resultado) = 'REAGENTE'));
	select count(*) -- Ver conexão
	into STRICT	qt_result2_w
	from 	 san_doacao a,
		pessoa_fisica b,
		 san_exame_lote c,
		 san_exame_realizado d
	where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
	and		 a.nr_sequencia = c.nr_seq_doacao
	and		 d.nr_seq_exame_lote = c.nr_sequencia
	and		 d.nr_seq_exame = 18
	and		 ie_avaliacao_final = 'I'
	and		 ((b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A+') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A-') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB+') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB-') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B+') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B-') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O+') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O-'))
	and	d.ds_resultado is	not null
	and		 a.dt_coleta between trunc(dt_inicio_w,'dd') and trunc(dt_final_p,'dd') + 86399/86400;
	--and		 ((upper(d.ds_resultado) = 'POSITIVO') or (upper(d.ds_resultado) = 'REAGENTE'));
		insert into W_HEMOPROD_T(qt_resultado_1,
			qt_resultado_2,
			qt_resultado_3,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			qt_result2_w,
			' - ',
			'4.2',
			3,
			'R',
			'D Fraco:',
			'4');

	--E.R 4.2 Coomps
	select	 count(*) qt -- Ver Conexão
	into STRICT	qt_result2_w
	from  	 san_transfusao a,
		 pessoa_fisica b,
		 san_exame_lote c,
		 san_exame_realizado d
	where	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
	and		 a.nr_sequencia = c.nr_seq_transfusao
	and		 d.nr_seq_exame_lote = c.nr_sequencia
	--and		 d.nr_seq_exame = 15
	and	d.nr_seq_exame = 3
	and		 ((b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A+') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A-') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB+') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB-') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B+') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B-') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O+') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O-'))
	and	(d.ds_resultado IS NOT NULL AND d.ds_resultado::text <> '')
	and		 a.dt_transfusao between trunc(dt_inicio_w,'dd') and trunc(dt_final_p,'dd') + 86399/86400;
	--and		 ((upper(d.ds_resultado) = 'POSITIVO') or (upper(d.ds_resultado) = 'REAGENTE'));
	insert into W_HEMOPROD_T(qt_resultado_1,
			qt_resultado_2,
			qt_resultado_3,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (' - ',
			' - ',
			qt_result2_w,
			'4.2',
			3,
			'R',
			'Coombs:',
			'4');

	--E.R 4.2 PAI
	SELECT	 COUNT(*) qtd
	into STRICT	 qt_result1_w
	FROM  	 san_doacao a,
		 pessoa_fisica b,
		 san_exame_lote c,
		 san_exame_realizado d
	WHERE	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
	AND	 a.nr_sequencia = c.nr_seq_doacao
	AND	 d.nr_seq_exame_lote = c.nr_sequencia
	and	a.ie_avaliacao_final = 'A'
	AND	 d.nr_seq_exame = 6
	AND	 ((b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A+') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A-') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB+') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB-') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B+') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B-') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O+') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O-'))
	AND	 a.dt_coleta BETWEEN TRUNC(dt_inicio_w,'dd') AND TRUNC(dt_final_p,'dd') + 86399/86400
	and	(d.ds_resultado IS NOT NULL AND d.ds_resultado::text <> '');
	--and	 ((upper(d.ds_resultado) = 'POSITIVO') or (upper(d.ds_resultado) = 'REAGENTE'));
	SELECT	 COUNT(*) qtd
	into STRICT	 qt_result2_w
	FROM  	 san_doacao a,
		 pessoa_fisica b,
		 san_exame_lote c,
		 san_exame_realizado d
	WHERE	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
	AND	 a.nr_sequencia = c.nr_seq_doacao
	AND	 d.nr_seq_exame_lote = c.nr_sequencia
	and	a.ie_avaliacao_final = 'I'
	AND	 d.nr_seq_exame = 6
	AND	 ((b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A+') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A-') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB+') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB-') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B+') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B-') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O+') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O-'))
	AND	 a.dt_coleta BETWEEN TRUNC(dt_inicio_w,'dd') AND TRUNC(dt_final_p,'dd') + 86399/86400
	and	(d.ds_resultado IS NOT NULL AND d.ds_resultado::text <> '');
	--and	 ((upper(d.ds_resultado) = 'POSITIVO') or (upper(d.ds_resultado) = 'REAGENTE'));
	SELECT	 COUNT(*) qtd
	into STRICT	 qt_result3_w
	FROM  	 san_transfusao a,
		 pessoa_fisica b,
		 san_exame_lote c,
		 san_exame_realizado d
	WHERE	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
	AND	 a.nr_sequencia = c.nr_seq_transfusao
	AND	 d.nr_seq_exame_lote = c.nr_sequencia
	AND	 d.nr_seq_exame = 6
	AND	 ((b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A+') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A-') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB+') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB-') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B+') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B-') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O+') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O-'))
	AND	 a.dt_transfusao BETWEEN TRUNC(dt_inicio_w,'dd') AND TRUNC(dt_final_p,'dd') + 86399/86400
	and	(d.ds_resultado IS NOT NULL AND d.ds_resultado::text <> '');
	--and	 ((upper(d.ds_resultado) = 'POSITIVO') or (upper(d.ds_resultado) = 'REAGENTE'));
	insert into W_HEMOPROD_T(qt_resultado_1,
			qt_resultado_2,
			qt_resultado_3,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			qt_result2_w,
			qt_result3_w,
			'4.2',
			3,
			'R',
			'Pai:',
			'4');

	--E.R 4.2 Abo
	SELECT	 COUNT(*) qt
	into STRICT	qt_result1_w
	FROM  	 san_doacao a,
			 pessoa_fisica b
	WHERE	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
	AND		 ie_avaliacao_final = 'A'
	AND		 a.dt_coleta BETWEEN TRUNC(dt_inicio_w,'dd') AND TRUNC(dt_final_p,'dd') + 86399/86400
	AND		 ((b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O-') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB-')
	or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A-') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B-'));

	SELECT	 COUNT(*) qt
	into STRICT	qt_result2_w
	FROM  	 san_doacao a,
			 pessoa_fisica b
	WHERE	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
	AND		 ie_avaliacao_final = 'I'
	AND		 a.dt_coleta BETWEEN TRUNC(dt_inicio_w,'dd') AND TRUNC(dt_final_p,'dd') + 86399/86400
	AND		 ((b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O-') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB-')
	or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A-') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B-'));


	SELECT	 COUNT(*) qt
	into STRICT	qt_result3_w
		FROM  	 san_transfusao a,
				 pessoa_fisica b
		WHERE	 a.cd_pessoa_fisica = b.cd_pessoa_fisica
		AND		 a.dt_transfusao BETWEEN TRUNC(dt_inicio_w,'dd') AND TRUNC(dt_final_p,'dd') + 86399/86400
		AND		 ((b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O-') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB-')
		or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A-') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B-'));

	insert into W_HEMOPROD_T(qt_resultado_1,
			qt_resultado_2,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			qt_result2_w,
			'4.2',
			3,
			'R',
			'Fenotipagem - Soma do ABO Neg:',
			'4');


	--E.R 4.3 Titulo campos
	select	count(*)
	into STRICT	qt_result1_w
	from	san_doacao a,
		san_exame_lote b,
		san_exame_realizado c
	where	b.nr_seq_doacao = a.nr_sequencia
	and	c.nr_seq_exame_lote = b.nr_sequencia
	and	c.nr_seq_exame = 21
	and 	(c.ds_resultado IS NOT NULL AND c.ds_resultado::text <> '')
	and	a.dt_doacao between trunc(dt_inicio_w,'dd') and trunc(dt_final_p,'dd') + 86399/86400;

	insert into W_HEMOPROD_T(qt_resultado_1,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			'4.3',
			1,
			'R',
			'Hb Anomala - ',
			'4');

	--Dados 1 ER 4.4
	select	count(distinct a.nr_sequencia)
	into STRICT	qt_result1_w
	from	san_doacao a,
		san_exame_lote b,
		san_exame_realizado c,
		san_exame d
	where	b.nr_seq_doacao = a.nr_sequencia
	and	c.nr_seq_exame_lote = b.nr_sequencia
	and	c.nr_seq_exame = d.nr_sequencia
	--and	c.nr_seq_exame in (21,6,17,16,13,14,15,9,20,8,10,11,12)
	and	c.nr_seq_exame in (11,17,10,12,16,13,14,15,9,20)
	--and	a.ie_avaliacao_final = 'A'
	--and 	d.ie_exige_senha = 'S'
	--and	((upper(c.ds_resultado) = 'POSITIVO') or (upper(c.ds_resultado) = 'REAGENTE'))
	and	(c.ds_resultado IS NOT NULL AND c.ds_resultado::text <> '')
	and	a.dt_doacao between trunc(dt_inicio_w,'dd') and trunc(dt_final_p,'dd') + 86399/86400;

	insert into W_HEMOPROD_T(qt_resultado_1,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			'4.4',
			1,
			'R',
			'Número total de bolsas testadas',
			'4');


	--Dados 2 ER 4.4
	/*select	count(distinct a.nr_sequencia)
	into	qt_result1_w
	from	san_doacao a,
		san_exame_lote b,
		san_exame_realizado c,
		san_exame d
	where	b.nr_seq_doacao = a.nr_sequencia
	and	c.nr_seq_exame_lote = b.nr_sequencia
	and	c.nr_seq_exame = d.nr_sequencia
	--and	c.nr_seq_exame in (21,6,17,16,13,14,15,9,20,8,10,11,12)
	and	c.nr_seq_exame in (11,17,10,12,16,13,14,15,9,20)
	--and	a.ie_avaliacao_final = 'A'
	--and 	san_obter_destino_exame(c.nr_seq_exame,3) = 'S'
	--and	d.ie_exige_senha = 'S'*/
	/*and 	(select	count(*)
		from	san_exame_realizado y,
			san_exame z
		where	y.nr_seq_exame_lote = b.nr_sequencia
		and	y.nr_seq_exame = z.nr_sequencia
		and	a.dt_coleta between trunc(dt_inicio_w,'dd') and trunc(dt_final_p,'dd') + 86399/86400
		and	((upper(y.ds_resultado) = 'POSITIVO') or (upper(y.ds_resultado) = 'REAGENTE'))
		and 	z.ie_exige_senha = 'S') > 1	*/
	/*and	replace(upper(ds_resultado),' ','') in ('POSITIVO','REAGENTE')
	and	a.dt_doacao between dt_inicio_w and dt_final_w;*/
	select	count(distinct a.nr_sequencia)
	into STRICT	qt_result1_w
	from	san_doacao a
	where (SELECT	count(distinct d.nr_sequencia)
		from	san_exame_lote b,
			san_exame_realizado c,
			san_exame d
		where	b.nr_seq_doacao = a.nr_sequencia
		and	c.nr_seq_exame_lote = b.nr_sequencia
		and	c.nr_seq_exame = d.nr_sequencia
		and	c.nr_seq_exame in (11,17,10,12,16,13,14,15,9,20)
		and	replace(upper(ds_resultado),' ','') in ('POSITIVO','REAGENTE')) > 1
	and	a.dt_doacao between dt_inicio_w and dt_final_w;

	insert into W_HEMOPROD_T(qt_resultado_1,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			'4.4',
			1,
			'R',
			'Total de bolsas reagentes para mais de um marcador',
			'4');


	end if;

	if (ie_opcao_p = 'D') or (ie_opcao_p = 'A') then
	-- descarte
	-- Titulo Descarte
	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ie_tipo)
	values ('5',
		'5. Descarte de bolsa',
		'TI');

	-- Titulo Descarte subtitulos
	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo)
	values ('5',
		' ',
		'5.1',
		'S');

	-- Titulos Descarte label
	insert into W_HEMOPROD_T(qt_resultado_1,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('Total',
		'5.1',
		'5',
		'L',
		1);

	-- Dados
	select 	count(*)
	into STRICT 	qt_result1_w
	from 	SAN_INUTILIZACAO a,
      		San_Producao b
	where 	a.nr_seq_motivo_inutil = 1
	and 	a.DT_INUTILIZACAO between dt_inicio_w and trunc(dt_final_p) + 86399/86400
	and 	a.nr_sequencia = b.nr_seq_inutil;

	insert into W_HEMOPROD_T(qt_resultado_1,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			'5.1',
			1,
			'R',
			'5.1 Bolsas descartadas por auto-exclusão - ',
			'5');


	end if;

	if (ie_opcao_p = 'P') or (ie_opcao_p = 'A') then

	-- Titulo Produção
	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ie_tipo)
	values ('6',
		'6 - Produção hemoterápica',
		'TI');

	-- Titulo Triagem subtitulos
	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo)
	values ('6',
		'6.1 - Entradas / Perdas / Transfusões / Distribuição para outros serviços',
		'6.1',
		'S');

	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo,
		ie_quebra)
	values ('6',
		'Perdas',
		'6.2',
		'S',
		'S');

	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo)
	values ('6',
		'Transfusão',
		'6.3',
		'S');

	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo)
	values ('6',
		'Distribuidas a outros setores',
		'6.4',
		'S');

	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo)
	values ('6',
		'6.2 -  Procedimentos de modificação dos hemocomponentes',
		'6.5',
		'S');


	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo)
	values ('6',
		' ',
		'6.7',
		'S');

	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo)
	values ('6',
		' ',
		'6.6',
		'S');



	-- Titulo label produção
	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		qt_resultado_4,
		qt_resultado_5,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('Produção',
		'Recebidas',
		'Emprestadas',
		'S/ NAT',
		'C/ NAT',
		'6.1',
		'6',
		'L',
		5);

	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('Rompimento',
		'Vencida',
		'Outros',
		'6.2',
		'6',
		'L',
		3);

	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		qt_resultado_4,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('Ambulatório',
		'Hospitalar',
		'S/ NAT',
		'C/ NAT',
		'6.3',
		'6',
		'L',
		4);

	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('S/ exames pré transf',
		'C/ exames pré-transf',
		'6.4',
		'6',
		'L',
		2);

	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('Irradiação',
		'Lavagem',
		'Filtração',
		'6.5',
		'6',
		'L',
		3);

	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('Plaquetas',
		'C.Hemaceas',
		'6.7',
		'6',
		'L',
		2);

	insert into W_HEMOPROD_T(qt_resultado_1,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('Total',
		'6.6',
		'6',
		'L',
		1);




	--Dados 1 Produção 6.1
	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;
	qt4_w := 0;
	qt5_w := 0;
	open C08;
	loop
	fetch C08 into
		ie_opcao_w,
		ds_campo_w;
	EXIT WHEN NOT FOUND; /* apply on C08 */
		begin

		select	 count(*)
		into STRICT	qt_result1_w
		from  	 san_producao a,
			san_doacao b,
			san_derivado c
		where	 a.nr_seq_doacao = b.nr_sequencia
		and	 a.nr_seq_derivado = c.nr_sequencia
		and	 coalesce(a.nr_seq_emp_ent::text, '') = ''
		and	(a.dt_producao IS NOT NULL AND a.dt_producao::text <> '')
		and	(a.dt_inicio_producao IS NOT NULL AND a.dt_inicio_producao::text <> '')
		and	 b.dt_doacao between dt_inicio_w and dt_final_w
		and	c.nr_sequencia = ie_opcao_w
		and	b.ie_status >= 2
		and	b.ie_avaliacao_final = 'A'
		and	b.ie_tipo_coleta <> 2;
		--and	 ((c.ie_tipo_derivado = ie_opcao_w and c.nr_sequencia not in(15,16)) or (ie_opcao_w = '-3' and c.nr_sequencia in (15,16)));
		qt1_w := qt1_w + qt_result1_w;


		select	 count(*)
		into STRICT	qt_result2_w
		from  	 san_producao a,
			 san_emprestimo b,
			 san_derivado c
		where	 a.nr_seq_emp_ent = b.nr_sequencia
		and	 a.nr_seq_derivado = c.nr_sequencia
		and	 (a.nr_seq_emp_ent IS NOT NULL AND a.nr_seq_emp_ent::text <> '')
		and	 b.dt_emprestimo between dt_inicio_w and dt_final_w
		and	c.nr_sequencia = ie_opcao_w;
		--and	 ((c.ie_tipo_derivado = ie_opcao_w and c.nr_sequencia not in(15,16)) or (ie_opcao_w = '-3' and c.nr_sequencia in (15,16)));
		qt2_w := qt2_w + qt_result2_w;

		select	 count(*)
		into STRICT	qt_result3_w
		from  	 san_producao a,
			 san_emprestimo b,
			 san_derivado c
		where	 a.nr_seq_emp_saida = b.nr_sequencia
		and	 a.nr_seq_derivado = c.nr_sequencia
		--and	a.nr_seq_inutil is null
		and	 (a.nr_seq_emp_saida IS NOT NULL AND a.nr_seq_emp_saida::text <> '')
		and	 b.dt_emprestimo between dt_inicio_w and dt_final_w
		and	c.nr_sequencia = ie_opcao_w;

		qt3_w := qt3_w + qt_result3_w;

		select	sum(qt)
		into STRICT	qt_result4_w
		from (SELECT	count(*) qt
			from	san_producao a,
				san_derivado d,
				san_doacao   e
			where	a.nr_seq_derivado = d.nr_sequencia
			and	e.nr_sequencia = a.nr_seq_doacao
			and	coalesce(a.nr_seq_emp_ent::text, '') = ''
			and	(a.dt_producao IS NOT NULL AND a.dt_producao::text <> '')
			and	e.ie_status >= 2
			and	e.ie_avaliacao_final = 'A'
			and	(a.dt_inicio_producao IS NOT NULL AND a.dt_inicio_producao::text <> '')
			and	e.ie_tipo_coleta <> 2
			and	e.dt_doacao between dt_inicio_w and dt_final_w
			and	not exists (	select	1
						from	san_exame_lote b,
							san_exame_realizado c
						where	b.nr_seq_producao = a.nr_sequencia
						and	b.nr_sequencia 	= c.nr_seq_exame_lote
						and	c.nr_seq_Exame in (10,11,12)
						and	(c.ds_resultado IS NOT NULL AND c.ds_resultado::text <> ''))
			and	d.nr_sequencia = ie_opcao_w
			
union all

			SELECT	count(*) qt
			from	san_producao a,
				san_derivado d,
				san_emprestimo   e
			where	a.nr_seq_derivado = d.nr_sequencia
			and	e.nr_sequencia = a.nr_seq_emp_ent
			and	 (a.nr_seq_emp_ent IS NOT NULL AND a.nr_seq_emp_ent::text <> '')
			and	e.dt_emprestimo between dt_inicio_w and dt_final_w
			and	not exists (	select	1
						from	san_exame_lote b,
							san_exame_realizado c
						where	b.nr_seq_producao = a.nr_sequencia
						and	b.nr_sequencia 	= c.nr_seq_exame_lote
						and	c.nr_seq_Exame in (10,11,12)
						and	(c.ds_resultado IS NOT NULL AND c.ds_resultado::text <> ''))
			and	d.nr_sequencia = ie_opcao_w	) alias13;



		qt4_w := qt4_w + qt_result4_w;


		select	sum(qt)
		into STRICT	qt_result5_w
		from (SELECT	count(*) qt
			from	san_producao a,
				san_derivado d,
				san_doacao   e
			where	a.nr_seq_derivado = d.nr_sequencia
			and	e.nr_sequencia = a.nr_seq_doacao
			and	coalesce(a.nr_seq_emp_ent::text, '') = ''
			and	(a.dt_producao IS NOT NULL AND a.dt_producao::text <> '')
			and	e.ie_status >= 2
			and	e.ie_avaliacao_final = 'A'
			and	(a.dt_inicio_producao IS NOT NULL AND a.dt_inicio_producao::text <> '')
			and	e.ie_tipo_coleta <> 2
			and	e.dt_doacao between dt_inicio_w and dt_final_w
			and	 exists (	select	1
						from	san_exame_lote b,
							san_exame_realizado c
						where	b.nr_seq_producao = a.nr_sequencia
						and	b.nr_sequencia 	= c.nr_seq_exame_lote
						and	c.nr_seq_Exame in (10,11,12)
						and	(c.ds_resultado IS NOT NULL AND c.ds_resultado::text <> ''))
			and	d.nr_sequencia = ie_opcao_w
			
union all

			SELECT	count(*) qt
			from	san_producao a,
				san_derivado d,
				san_emprestimo   e
			where	a.nr_seq_derivado = d.nr_sequencia
			and	e.nr_sequencia = a.nr_seq_emp_ent
			and	 (a.nr_seq_emp_ent IS NOT NULL AND a.nr_seq_emp_ent::text <> '')
			and	e.dt_emprestimo between dt_inicio_w and dt_final_w
			and	 exists (	select	1
						from	san_exame_lote b,
							san_exame_realizado c
						where	b.nr_seq_producao = a.nr_sequencia
						and	b.nr_sequencia 	= c.nr_seq_exame_lote
						and	c.nr_seq_Exame in (10,11,12)
						and	(c.ds_resultado IS NOT NULL AND c.ds_resultado::text <> ''))
			and	d.nr_sequencia = ie_opcao_w	) alias13;



		qt5_w := qt5_w +qt_result5_w;

		insert into W_HEMOPROD_T(qt_resultado_1,
			qt_resultado_2,
			qt_resultado_3,
			qt_resultado_4,
			qt_resultado_5,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			qt_result2_w,
			qt_result3_w,
			qt_result4_w,
			qt_result5_w,
			'6.1',
			5,
			'R',
			ds_campo_w,
			'6');


		end;


	end loop;
	close C08;

	--Total 1 Produção 6.1
	/*select	 count(*)
		into	ds_campo_w
		from  	 san_producao a,
			san_doacao b,
			san_derivado c
		where	 a.nr_seq_doacao = b.nr_sequencia
		and	 a.nr_seq_derivado = c.nr_sequencia
		and	 a.nr_seq_emp_ent is null
		and	 b.dt_doacao between dt_inicio_w and dt_final_w;*/
	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		qt_resultado_4,
		qt_resultado_5,
		ds_banda_superior,
		qt_coluna,
		ie_tipo,
		ds_resultado,
		ie_tipo_informacao)
	values (qt1_w,
		qt2_w,
		qt3_w,
		qt4_w,
		qt5_w,
		'6.1',
		5,
		'T',
		'Total',
		'6');


	/*select	 count(*)
		into	ds_campo_w
		from  	 san_producao a,
			 san_emprestimo b,
			 san_derivado c
		where	 a.nr_seq_emp_ent = b.nr_sequencia
		and	 a.nr_seq_derivado = c.nr_sequencia
		and	 a.nr_seq_emp_ent is not null
		and	 b.dt_emprestimo between dt_inicio_w and dt_final_w;*/
	--Dados 2 Produção 6.1
	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;

	open C09;
	loop
	fetch C09 into
		ie_opcao_w,
		ds_campo_w;
	EXIT WHEN NOT FOUND; /* apply on C09 */
		begin

		select 	Count(*)
		into STRICT	qt_result1_w
		from   	san_inutilizacao a,
			san_producao b
		where  	a.nr_sequencia = b.nr_seq_inutil
		and    	b.nr_seq_derivado = ie_opcao_w
		and    	a.nr_seq_motivo_inutil not in (22,21)
		and    	a.dt_inutilizacao between dt_inicio_w and dt_final_w;

		qt1_w := qt1_w + qt_result1_w;


		select Count(*)
		into STRICT	qt_result2_w
		from   	san_inutilizacao a,
			san_producao b
		where  	a.nr_sequencia = b.nr_seq_inutil
		and    	b.nr_seq_derivado = ie_opcao_w
		and    	a.nr_seq_motivo_inutil = 22
		and    	a.dt_inutilizacao between dt_inicio_w and dt_final_w;

		qt2_w := qt2_w + qt_result2_w;


		select Count(*)
		into STRICT	qt_result3_w
		from   san_inutilizacao a,
		       san_producao b
		where  a.nr_sequencia = b.nr_seq_inutil
		and    b.nr_seq_derivado = ie_opcao_w
		and    a.nr_seq_motivo_inutil = 21
		and    a.dt_inutilizacao between dt_inicio_w and dt_final_w;

		qt3_w := qt3_w + qt_result3_w;

		insert into W_HEMOPROD_T(qt_resultado_1,
			qt_resultado_2,
			qt_resultado_3,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result2_w,
			qt_result3_w,
			qt_result1_w,
			'6.2',
			3,
			'R',
			ds_campo_w,
			'6');


		end;


	end loop;
	close C09;

	-- Total 2 Producao 6.2
	/*select Count(*)
	into	ds_campo_w
	from   san_inutilizacao a,
	       san_producao b
	where  a.nr_sequencia = b.nr_seq_inutil
	and    b.nr_seq_derivado in (6,3,12,1,7,5,19)
	and    a.nr_seq_motivo_inutil not in (33,1)
	and    a.dt_inutilizacao between dt_inicio_w and dt_final_w;*/
	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		ds_banda_superior,
		qt_coluna,
		ie_tipo,
		ds_resultado,
		ie_tipo_informacao)
	values (qt2_w,
		qt3_w,
		qt1_w,
		'6.2',
		3,
		'T',
		'Total',
		'6');


	/*select Count(*)
	into	ds_campo_w
	from   san_inutilizacao a,
	       san_producao b
	where  a.nr_sequencia = b.nr_seq_inutil
	and    b.nr_seq_derivado in (6,3,12,1,7,5,19)
	and    a.nr_seq_motivo_inutil = 33
	and    a.dt_inutilizacao between dt_inicio_w and dt_final_w;*/
	/*select Count(*)
	into	ds_campo_w
	from   san_inutilizacao a,
	       san_producao b
	where  a.nr_sequencia = b.nr_seq_inutil
	and    b.nr_seq_derivado in (6,3,12,1,7,5,19)
	and    a.nr_seq_motivo_inutil = 1
	and    a.dt_inutilizacao between dt_inicio_w and dt_final_w;*/
	--Dados 3 Produção 6.1
	open C10;
	loop
	fetch C10 into
		ds_campo_w,
		qt_result1_w,
		qt_result2_w,
		qt_result3_w,
		qt_result4_w;
	EXIT WHEN NOT FOUND; /* apply on C10 */
		begin
		/*insert into W_HEMOPROD_T (	DS_RESULTADO,
					QT_RESULTADO,
					QT_RESULTADO_1,
					ie_tipo)
			values		(ds_resultado_w,
					qt_resultado_w,
					qt_resultado2_w,
					'D3_Dados_6_2');*/
		insert into W_HEMOPROD_T(qt_resultado_1,
			qt_resultado_2,
			qt_resultado_3,
			qt_resultado_4,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			qt_result2_w,
			qt_result3_w,
			qt_result4_w,
			'6.3',
			4,
			'R',
			ds_campo_w,
			'6');


		end;
	end loop;
	close C10;



	--Total 3 Produção 6.1
	SELECT	COUNT(*) qt_ambulatorio
	into STRICT	qt_result1_w
	FROM	san_derivado c,
		atendimento_paciente d,
		san_producao b,
		san_transfusao a
	WHERE	1 = 1
	and	c.ie_situacao = 'A'
	AND	a.nr_sequencia = b.nr_seq_transfusao
	AND	b.nr_seq_derivado = c.nr_sequencia
	AND	a.nr_atendimento = d.nr_atendimento
	AND	ie_tipo_atendimento = 8
	AND	a.dt_transfusao BETWEEN TRUNC(dt_inicio_w,'dd') AND (TRUNC(dt_final_p,'dd') + 86399/86400);



	SELECT	COUNT(*) qt_entidade
	into STRICT	qt_result2_w
	FROM	san_derivado c,
		atendimento_paciente d,
		san_producao b,
		san_transfusao a
	WHERE	1 = 1
	and	c.ie_situacao = 'A'
	AND	a.nr_sequencia = b.nr_seq_transfusao
	AND	b.nr_seq_derivado = c.nr_sequencia
	AND	a.nr_atendimento = d.nr_atendimento
	and	c.ie_situacao = 'A'
	AND	ie_tipo_atendimento <> 8
	AND	a.dt_transfusao BETWEEN TRUNC(dt_inicio_w,'dd') AND (TRUNC(dt_final_p,'dd') + 86399/86400);

	select	sum(qt) qt_snat
	into STRICT	qt_result3_w
	from (SELECT	COUNT(*) qt
		FROM	san_derivado c,
			atendimento_paciente d,
			san_producao b,
			san_transfusao a
		WHERE	1 = 1
		and	c.ie_situacao = 'A'
		AND	a.nr_sequencia = b.nr_seq_transfusao
		AND	b.nr_seq_derivado = c.nr_sequencia
		AND	a.nr_atendimento = d.nr_atendimento
		AND	ie_tipo_atendimento = 8
		and	b.nr_seq_derivado not in (4,10)
		and	not exists (	select	1
						from	san_exame_lote x,
							san_exame_realizado z,
							san_doacao v
						where	x.nr_seq_doacao = v.nr_sequencia
						and	v.nr_sequencia = b.nr_seq_doacao
						and	x.nr_sequencia 	= z.nr_seq_exame_lote
						and	z.nr_seq_Exame in (10,11,12)
						and	(z.ds_resultado IS NOT NULL AND z.ds_resultado::text <> ''))
		AND	a.dt_transfusao BETWEEN dt_inicio_w AND dt_final_w
		
union all

		SELECT	COUNT(*) qt
		FROM	san_derivado c,
			atendimento_paciente d,
			san_producao b,
			san_transfusao a
		WHERE	1 = 1
		and	c.ie_situacao = 'A'
		AND	a.nr_sequencia = b.nr_seq_transfusao
		AND	b.nr_seq_derivado = c.nr_sequencia
		AND	a.nr_atendimento = d.nr_atendimento
		and	c.ie_situacao = 'A'
		AND	ie_tipo_atendimento <> 8
		and	b.nr_seq_derivado not in (4,10)
		and	not exists (	select	1
						from	san_exame_lote x,
							san_exame_realizado z,
							san_doacao v
						where	x.nr_seq_doacao = v.nr_sequencia
						and	v.nr_sequencia = b.nr_seq_doacao
						and	x.nr_sequencia 	= z.nr_seq_exame_lote
						and	z.nr_seq_Exame in (10,11,12)
						and	(z.ds_resultado IS NOT NULL AND z.ds_resultado::text <> ''))
		AND	a.dt_transfusao BETWEEN dt_inicio_w AND dt_final_w) alias11;

	select	sum(qt) qt_cnat
	into STRICT	qt_result4_w
	from (SELECT	COUNT(*) qt
		FROM	san_derivado c,
			atendimento_paciente d,
			san_producao b,
			san_transfusao a
		WHERE	1 = 1
		and	c.ie_situacao = 'A'
		AND	a.nr_sequencia = b.nr_seq_transfusao
		AND	b.nr_seq_derivado = c.nr_sequencia
		AND	a.nr_atendimento = d.nr_atendimento
		AND	ie_tipo_atendimento = 8
		and	b.nr_seq_derivado not in (4,10)
		and	exists (	select	1
						from	san_exame_lote x,
							san_exame_realizado z,
							san_doacao v
						where	x.nr_seq_doacao = v.nr_sequencia
						and	v.nr_sequencia = b.nr_seq_doacao
						and	x.nr_sequencia 	= z.nr_seq_exame_lote
						and	z.nr_seq_Exame in (10,11,12)
						and	(z.ds_resultado IS NOT NULL AND z.ds_resultado::text <> ''))
		AND	a.dt_transfusao BETWEEN dt_inicio_w AND dt_final_w
		
union all

		SELECT	COUNT(*) qt
		FROM	san_derivado c,
			atendimento_paciente d,
			san_producao b,
			san_transfusao a
		WHERE	1 = 1
		and	c.ie_situacao = 'A'
		AND	a.nr_sequencia = b.nr_seq_transfusao
		AND	b.nr_seq_derivado = c.nr_sequencia
		AND	a.nr_atendimento = d.nr_atendimento
		and	c.ie_situacao = 'A'
		AND	ie_tipo_atendimento <> 8
		and	b.nr_seq_derivado not in (4,10)
		and	exists (	select	1
						from	san_exame_lote x,
							san_exame_realizado z,
							san_doacao v
						where	x.nr_seq_doacao = v.nr_sequencia
						and	v.nr_sequencia = b.nr_seq_doacao
						and	x.nr_sequencia 	= z.nr_seq_exame_lote
						and	z.nr_seq_Exame in (10,11,12)
						and	(z.ds_resultado IS NOT NULL AND z.ds_resultado::text <> ''))
		AND	a.dt_transfusao BETWEEN dt_inicio_w AND dt_final_w) alias11;

	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		qt_resultado_3,
		qt_resultado_4,
		ds_banda_superior,
		qt_coluna,
		ie_tipo,
		ds_resultado,
		ie_tipo_informacao)
	values (qt_result1_w,
		qt_result2_w,
		qt_result3_w,
		qt_result4_w,
		'6.3',
		4,
		'T',
		'Total',
		'6');



	--Dados 4 Produção 6.1
	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;

	open C11;
	loop
	fetch C11 into
		ie_opcao_w,
		ds_campo_w;
	EXIT WHEN NOT FOUND; /* apply on C11 */
		begin

	select   count(distinct nr_sequencia)
		into STRICT	qt_result1_w
		from (SELECT 	d.nr_sequencia nr_sequencia
			from	san_transfusao a,
				san_producao d
			where    d.nr_seq_transfusao = a.nr_sequencia
			and	 exists (select 1
					from	 san_exame_lote b,
						san_exame_realizado c
					where   b.nr_seq_producao = d.nr_sequencia
					and     c.nr_seq_exame_lote = b.nr_sequencia
					and	coalesce(c.ds_resultado::text, '') = '')
			and	not exists (select 1
					from	 san_exame_lote b,
						san_exame_realizado c
					where   b.nr_seq_producao = d.nr_sequencia
					and     c.nr_seq_exame_lote = b.nr_sequencia
					and	(c.ds_resultado IS NOT NULL AND c.ds_resultado::text <> ''))
			and      d.nr_seq_derivado = ie_opcao_w
			and	dt_transfusao between dt_inicio_w and trunc(dt_final_p) + 86399/86400
			
union all

			SELECT 	v.nr_sequencia
			from   	san_reserva a,
				san_reserva_prod g,
				san_producao v
			where  	dt_reserva between dt_inicio_w and dt_final_w
			and	v.nr_seq_derivado = ie_opcao_w
			and    	a.nr_sequencia = g.nr_seq_reserva
			and    	g.nr_seq_producao = v.nr_sequencia
			and   	exists (select 1
					from   	san_exame_lote b,
						san_exame_realizado c
					where   	b.nr_seq_res_prod = g.nr_sequencia
					and     	c.nr_seq_exame_lote = b.nr_sequencia
					and	coalesce(c.ds_resultado::text, '') = '')
			and   	not exists (select 1
					from   	san_exame_lote b,
						san_exame_realizado c
					where   	b.nr_seq_res_prod = g.nr_sequencia
					and     	c.nr_seq_exame_lote = b.nr_sequencia
					and	(c.ds_resultado IS NOT NULL AND c.ds_resultado::text <> ''))
			and	not exists (select 1
					from	 san_exame_lote b,
						san_exame_realizado c
					where   b.nr_seq_producao = v.nr_sequencia
					and     c.nr_seq_exame_lote = b.nr_sequencia
					and	(c.ds_resultado IS NOT NULL AND c.ds_resultado::text <> ''))
					) alias12;

		qt1_w := qt1_w + qt_result1_w;


		select   count(distinct nr_sequencia)
		into STRICT	qt_result2_w
		from (SELECT   d.nr_sequencia nr_sequencia
		from	san_transfusao a,
			san_producao d
		where    d.nr_seq_transfusao = a.nr_sequencia
		and	exists (select 1
			        from	 san_exame_lote b,
			    	     	 san_exame_realizado c
			     	  where   b.nr_seq_producao = d.nr_sequencia
			           and     c.nr_seq_exame_lote = b.nr_sequencia
				  and	(c.ds_resultado IS NOT NULL AND c.ds_resultado::text <> ''))
		and      d.nr_seq_derivado = ie_opcao_w
		and	dt_transfusao between dt_inicio_w and dt_final_w
		
union all

		SELECT 	v.nr_sequencia
			from   	san_reserva a,
				san_reserva_prod g,
				san_producao v
			where  	dt_reserva between dt_inicio_w and dt_final_w
			and	v.nr_seq_derivado = ie_opcao_w
			and    	a.nr_sequencia = g.nr_seq_reserva
			and    	g.nr_seq_producao = v.nr_sequencia
			and   	exists (select 1
					from   	san_exame_lote b,
						san_exame_realizado c
					where   	b.nr_seq_res_prod = g.nr_sequencia
					and	(c.ds_resultado IS NOT NULL AND c.ds_resultado::text <> '')
					and     	c.nr_seq_exame_lote = b.nr_sequencia)) alias5;

		qt2_w := qt2_w + qt_result2_w;

		insert into W_HEMOPROD_T(qt_resultado_1,
			qt_resultado_2,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			qt_result2_w,
			'6.4',
			2,
			'R',
			ds_campo_w,
			'6');



		end;


	end loop;
	close C11;

	--Total 4 Produção 6.1
	/*select sum(qt)
	into	ds_campo_w
	from(select   count(*) qt
	from	san_transfusao a,
		san_producao d
	where    d.nr_seq_transfusao = a.nr_sequencia
	and	 exists (select 1
		           from	 san_exame_lote b,
		    	     	 san_exame_realizado c
		       	  where   b.nr_seq_producao = d.nr_sequencia
			  and	c.ds_resultado is null
		           and     c.nr_seq_exame_lote = b.nr_sequencia)
	and	not exists (select 1
		           from	 san_exame_lote b,
		    	     	 san_exame_realizado c
		       	  where   b.nr_seq_producao = d.nr_sequencia
			  and	c.ds_resultado is not null
		           and     c.nr_seq_exame_lote = b.nr_sequencia)
	and	dt_transfusao between dt_inicio_w and dt_final_w
	union all
		select count(*) qt
			from   	san_reserva a,
				san_reserva_prod g,
				san_producao v
			where  	dt_reserva between dt_inicio_w and dt_final_w
			and    	a.nr_sequencia = g.nr_seq_reserva
			and    	g.nr_seq_producao = v.nr_sequencia
			and      exists (select 1
			from   	san_exame_lote b,
				san_exame_realizado c
			where   	b.nr_seq_res_prod = g.nr_sequencia
			and	c.ds_resultado is null
			and     	c.nr_seq_exame_lote = b.nr_sequencia)
			and     not exists (select 1
			from   	san_exame_lote b,
				san_exame_realizado c
			where   	b.nr_seq_res_prod = g.nr_sequencia
			and	c.ds_resultado is not null
			and     	c.nr_seq_exame_lote = b.nr_sequencia));*/
	insert into W_HEMOPROD_T(qt_resultado_1,
		qt_resultado_2,
		ds_banda_superior,
		qt_coluna,
		ie_tipo,
		ds_resultado,
		ie_tipo_informacao)
	values (qt1_w,
		qt2_w,
		'6.4',
		2,
		'T',
		'Total',
		'6');



	/*select sum(qt)
	into	ds_campo_w
	from(select   count(*) qt
	from	san_transfusao a,
		san_producao d
	where    d.nr_seq_transfusao = a.nr_sequencia
	and	 exists (select 1
		           from	 san_exame_lote b,
		    	     	 san_exame_realizado c
		       	  where   b.nr_seq_producao = d.nr_sequencia
			  and	c.ds_resultado is not null
		           and     c.nr_seq_exame_lote = b.nr_sequencia)
	and	dt_transfusao between dt_inicio_w and dt_final_w
	union all
		select count(*) qt
			from   	san_reserva a,
				san_reserva_prod g,
				san_producao v
			where  	dt_reserva between dt_inicio_w and dt_final_w
			and    	a.nr_sequencia = g.nr_seq_reserva
			and    	g.nr_seq_producao = v.nr_sequencia
			and      exists (select 1
			from   	san_exame_lote b,
				san_exame_realizado c
			where   	b.nr_seq_res_prod = g.nr_sequencia
			and	c.ds_resultado is not null
			and     	c.nr_seq_exame_lote = b.nr_sequencia));*/
	--Total Producao 6.2
	SELECT 	COUNT(nr_seq_derivado)
	into STRICT	qt_result1_w
	FROM	san_producao a
	WHERE	a.dt_producao between dt_inicio_w and dt_final_p
	AND 	a.ie_filtrado = 'S';


	SELECT COUNT(nr_seq_derivado)
	into STRICT	qt_result2_w
	FROM san_producao
	WHERE dt_producao between dt_inicio_w and dt_final_p
	AND ie_irradiado = 'S';


	SELECT COUNT(nr_seq_derivado)
	into STRICT	qt_result3_w
	FROM san_producao
	WHERE dt_producao between dt_inicio_w and dt_final_p
	AND ie_lavado = 'S';

	insert into W_HEMOPROD_T(qt_resultado_1,
			qt_resultado_2,
			qt_resultado_3,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result2_w,
			qt_result3_w,
			qt_result1_w,
			'6.5',
			2,
			'R',
			'Total',
			'6');



	--Sub Producao 6.2
	SELECT COUNT(nr_seq_derivado)
	into STRICT qt_result1_w
	FROM san_producao a,
	     san_derivado b
	WHERE dt_producao between dt_inicio_w and dt_final_p
	and   a.nr_Seq_derivado = b.nr_sequencia
	AND ie_filtrado = 'S'
	and  coalesce(b.ie_tipo_derivado,b.ie_tipo_hemocomponente) = 'CP';


	SELECT COUNT(nr_seq_derivado)
	into STRICT	qt_result2_w
	FROM san_producao a
	WHERE dt_producao between dt_inicio_w and dt_final_p
	AND 	a.ie_filtrado = 'S'
	and a.nr_seq_derivado in (1,8);

	insert into W_HEMOPROD_T(qt_resultado_1,
			qt_resultado_2,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			qt_result2_w,
			'6.7',
			2,
			'R',
			'Filtração',
			'6');


	--Titulo producao 6.2.4
	select	count(*)
	into STRICT	qt_result1_w
	from 	san_producao a
	where	ie_aliquotado = 'S'
	and 	dt_producao between dt_inicio_w and dt_final_w;

	insert into W_HEMOPROD_T(qt_resultado_1,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			'6.6',
			1,
			'R',
			'6.2.4 - Fracionamento pediátrico',
			'6');




	end if;

	if (ie_opcao_p = 'R') or (ie_opcao_p = 'A') then

	-- Titulo reações transfusionais
	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ie_tipo)
	values ('7',
		'7 - Reações transfusionais',
		'TI');

	-- Titulo reações transfusionais subtitulos
	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo)
	values ('7',
		' ',
		'7.1',
		'S');

	-- Titulos Triagem label
	insert into W_HEMOPROD_T(qt_resultado_1,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('Total',
		'7.1',
		'7',
		'L',
		1);

	--Dados reações transfusionais 7.0
	qt1_w := 0;
	qt2_w := 0;
	qt3_w := 0;

	open C12;
	loop
	fetch C12 into
		ie_opcao_w,
		ds_campo_w;
	EXIT WHEN NOT FOUND; /* apply on C12 */
		begin

		select count(*)
		into STRICT	qt_result1_w
		from   SAN_TRANS_REACAO a,
		       san_producao b,
		       san_transfusao c
		where  a.nr_seq_producao = b.nr_sequencia
		and    b.nr_seq_transfusao = c.nr_sequencia
		and    a.nr_seq_reacao = ie_opcao_w
		and    c.dt_transfusao between dt_inicio_w and dt_final_w;

		qt1_w := qt_result1_w + qt1_w;

		insert into W_HEMOPROD_T(qt_resultado_1,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			'7.1',
			1,
			'R',
			ds_campo_w,
			'7');

		end;


	end loop;
	close C12;

	select	count(*)
	into STRICT	qt_result1_w
	from   	SAN_TRANS_REACAO a,
		san_producao b,
		san_transfusao c
	where  	a.nr_seq_producao = b.nr_sequencia
	and    	b.nr_seq_transfusao = c.nr_sequencia
	and    	a.nr_seq_reacao not in (7,/*42,*/
9,10,11,12)
	and    	c.dt_transfusao between dt_inicio_w and dt_final_w;

	insert into W_HEMOPROD_T(qt_resultado_1,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			'7.1',
			1,
			'R',
			'Outros',
			'7');


	--Outros Reações transfusionais 7.0
	select	count(*)
	into STRICT	qt_result1_w
	from   	SAN_TRANS_REACAO a,
		san_producao b,
		san_transfusao c
	where  	a.nr_seq_producao = b.nr_sequencia
	and    	b.nr_seq_transfusao = c.nr_sequencia
	and	(a.nr_seq_reacao IS NOT NULL AND a.nr_seq_reacao::text <> '')
	and    	c.dt_transfusao between dt_inicio_w and dt_final_w;

	insert into W_HEMOPROD_T(qt_resultado_1,
		ds_banda_superior,
		qt_coluna,
		ie_tipo,
		ds_resultado,
		ie_tipo_informacao)
	values (qt_result1_w,
		'7.1',
		1,
		'R',
		'Total',
		'7');


	end if;

	if (ie_opcao_p = 'V') or (ie_opcao_p = 'A') then
	-- Titulo Envio
	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ie_tipo)
	values ('8',
		'8 - Envio de plasma para produção de hemoderivados',
		'TI');

	-- Titulo Triagem subtitulos
	insert into W_HEMOPROD_T(ie_tipo_informacao,
		ds_resultado,
		ds_banda_superior,
		ie_tipo)
	values ('8',
		' ',
		'8.1',
		'S');

	-- Titulos Triagem label
	insert into W_HEMOPROD_T(qt_resultado_1,
		ds_banda_superior,
		ie_tipo_informacao,
		ie_tipo,
		qt_coluna)
	values ('Total',
		'8.1',
		'8',
		'L',
		1);

	--Dados envio 8.1
	open C13;
	loop
	fetch C13 into
		ie_opcao_w,
		ds_campo_w;
	EXIT WHEN NOT FOUND; /* apply on C13 */
		begin

		select count(*)
		into STRICT	qt_result1_w
		from   san_emprestimo a,
		       san_producao b
		where b.nr_seq_emp_saida = a.nr_sequencia
		and   b.nr_seq_derivado = ie_opcao_w
		and	a.dt_emprestimo between dt_inicio_w and dt_final_w;


		insert into W_HEMOPROD_T(qt_resultado_1,
			ds_banda_superior,
			qt_coluna,
			ie_tipo,
			ds_resultado,
			ie_tipo_informacao)
		values (qt_result1_w,
			'8.1',
			1,
			'R',
			ds_campo_w,
			'8');

		end;


	end loop;
	close C13;

	end if;

end if;



commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE san_hemoprod_rela_tabela_temp2 ( dt_inicio_p timestamp, dt_final_p timestamp, ie_opcao_p text) FROM PUBLIC;

