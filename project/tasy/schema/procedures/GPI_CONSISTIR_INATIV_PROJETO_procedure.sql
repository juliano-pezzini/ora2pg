-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gpi_consistir_inativ_projeto ( nm_usuario_p text, nr_sequencia_p bigint) AS $body$
DECLARE


ds_consistencia_w	varchar(4000);
qt_registro_w		bigint := 0;


BEGIN

select 	count(*)
into STRICT	qt_registro_w
from	solic_compra
where 	nr_seq_proj_gpi 	= nr_sequencia_p
and 	coalesce(nr_seq_motivo_cancel::text, '') = '';

if (qt_registro_w <> 0) then
	ds_consistencia_w 	:= substr(obter_dic_objeto_idioma(266548,WHEB_USUARIO_PCK.get_nr_seq_idioma) || chr(13) || chr(10),1,4000);
end if;

qt_registro_w 	:= 0;
select	count(*)
into STRICT	qt_registro_w
from 	nota_fiscal_item
where 	nr_seq_proj_gpi 	= nr_sequencia_p;

if (qt_registro_w <> 0) then
	ds_consistencia_w	:= substr(ds_consistencia_w || obter_dic_objeto_idioma(266549,WHEB_USUARIO_PCK.get_nr_seq_idioma) || chr(13) || chr(10),1,4000);
end if;

qt_registro_w	:= 0;
select	count(*)
into STRICT	qt_registro_w
from 	titulo_pagar
where 	nr_seq_proj_gpi 	= nr_sequencia_p;

if (qt_registro_w <> 0) then
	ds_consistencia_w	:= substr(ds_consistencia_w ||	obter_dic_objeto_idioma(266544,WHEB_USUARIO_PCK.get_nr_seq_idioma) || chr(13) || chr(10),1,4000);
end if;

qt_registro_w := 0;
select	count(*)
into STRICT	qt_registro_w
from 	requisicao_material
where 	nr_seq_proj_gpi 	= nr_sequencia_p;

if (qt_registro_w <> 0) then
	ds_consistencia_w	:= substr(ds_consistencia_w || obter_dic_objeto_idioma(266545,WHEB_USUARIO_PCK.get_nr_seq_idioma) || chr(13) || chr(10),1,4000);
end if;

qt_registro_w	:= 0;
select	count(*)
into STRICT	qt_registro_w
from	man_ordem_servico
where 	nr_seq_proj_gpi 	= nr_sequencia_p;

if (qt_registro_w <> 0) then
	ds_consistencia_w	:= substr(ds_consistencia_w || obter_dic_objeto_idioma(266546,WHEB_USUARIO_PCK.get_nr_seq_idioma) || chr(13) || chr(10),1,4000);
end if;

if (ds_consistencia_w IS NOT NULL AND ds_consistencia_w::text <> '') then

	ds_consistencia_w	:= substr(ds_consistencia_w || obter_dic_objeto_idioma(266547,WHEB_USUARIO_PCK.get_nr_seq_idioma),1,4000);
	CALL wheb_mensagem_pck.exibir_mensagem_abort(184609,'DS_ERRO_W=' || ds_consistencia_w);
end if;


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gpi_consistir_inativ_projeto ( nm_usuario_p text, nr_sequencia_p bigint) FROM PUBLIC;

