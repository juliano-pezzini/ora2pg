-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cus_excluir_orcamento ( cd_tabela_custo_p bigint, cd_estabelecimento_p bigint, nr_seq_tabela_p bigint, nm_usuario_p text) AS $body$
DECLARE

  dt_mes_referencia_w timestamp;
  ds_log_w            varchar(2000);

BEGIN

  select a.dt_mes_referencia
  into STRICT dt_mes_referencia_w
  from tabela_custo a
  where a.nr_sequencia = nr_seq_tabela_p;

  DELETE FROM orcamento_custo WHERE nr_seq_tabela = nr_seq_tabela_p;
  ds_log_w := SUBSTR( wheb_mensagem_pck.get_texto(298776,NULL) || ' ' || cd_tabela_custo_p || '/' || nr_seq_tabela_p || ' ' || wheb_mensagem_pck.get_texto(298777,NULL) || ' ' || TO_CHAR(dt_mes_referencia_w,'dd/mm/yyyy') || ' ' || wheb_mensagem_pck.get_texto(298778,NULL) || ' ' || cd_estabelecimento_p,1,2000);
  INSERT
  INTO ctb_log(
      cd_log,
      ds_log,
      nm_usuario,
      dt_atualizacao
    )
    VALUES (
      1105,
      ds_log_w,
      nm_usuario_p,
      clock_timestamp()
    );
  COMMIT;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cus_excluir_orcamento ( cd_tabela_custo_p bigint, cd_estabelecimento_p bigint, nr_seq_tabela_p bigint, nm_usuario_p text) FROM PUBLIC;

