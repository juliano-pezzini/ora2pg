-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE carregar_dosagem_md (qt_solucao_p bigint, nr_casas_diluicao_p bigint, ie_aplicar_p text, qt_volume_p INOUT bigint, qt_dose_diluido_p INOUT bigint, ds_volume_p INOUT text, ds_rediluir_p text, ds_final_volume_p text, ds_volume_ml_p text, cd_volume_final_p bigint, ds_diluir_p text, qt_conv_ml_p bigint, qt_ml_diluente_p bigint, ie_consiste_dose_consumo_p text, qt_unit_medic_p bigint, qt_unit_medic_dil_p bigint, qt_dose_ml_p bigint, ds_conv_ml_p text) AS $body$
BEGIN

  qt_dose_diluido_p := 0;

  if ((qt_solucao_p IS NOT NULL AND qt_solucao_p::text <> '') and qt_solucao_p > 0) then

    qt_volume_p       := round(qt_solucao_p, nr_casas_diluicao_p);
    qt_dose_diluido_p := round(qt_solucao_p, nr_casas_diluicao_p);
    ds_volume_p       := qt_dose_diluido_p || ' ' || ds_volume_ml_p;

  elsif (ie_aplicar_p = 'S') then
    if (ds_rediluir_p IS NOT NULL AND ds_rediluir_p::text <> '') then
      ds_volume_p       := ' ' || ds_final_volume_p || ' ' || ds_volume_ml_p;
      qt_dose_diluido_p := cd_volume_final_p;
    elsif (ds_diluir_p IS NOT NULL AND ds_diluir_p::text <> '') then
      qt_dose_diluido_p := round((coalesce(qt_conv_ml_p, 0) + coalesce(qt_ml_diluente_p, 0)),
                                 nr_casas_diluicao_p);
      ds_volume_p       := ' ' || qt_dose_diluido_p || ' ' ||
                           ds_volume_ml_p;
      qt_volume_p       := round((coalesce(qt_conv_ml_p, 0) + coalesce(qt_ml_diluente_p, 0)),
                                 nr_casas_diluicao_p);
      if ('S' = ie_consiste_dose_consumo_p) then
        qt_volume_p       := round((((coalesce(qt_conv_ml_p, 0) + coalesce(qt_dose_ml_p, 0)) *
                                   qt_unit_medic_dil_p) /
                                   ceil(qt_unit_medic_p)),
                                   nr_casas_diluicao_p);
        qt_dose_diluido_p := qt_volume_p;
        ds_volume_p       := ' ' || qt_dose_diluido_p || ' ' ||
                             ds_volume_ml_p;
      end if;
    elsif (ds_conv_ml_p IS NOT NULL AND ds_conv_ml_p::text <> '') then
      ds_volume_p := ' ' || ds_conv_ml_p;
    end if;

  end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE carregar_dosagem_md (qt_solucao_p bigint, nr_casas_diluicao_p bigint, ie_aplicar_p text, qt_volume_p INOUT bigint, qt_dose_diluido_p INOUT bigint, ds_volume_p INOUT text, ds_rediluir_p text, ds_final_volume_p text, ds_volume_ml_p text, cd_volume_final_p bigint, ds_diluir_p text, qt_conv_ml_p bigint, qt_ml_diluente_p bigint, ie_consiste_dose_consumo_p text, qt_unit_medic_p bigint, qt_unit_medic_dil_p bigint, qt_dose_ml_p bigint, ds_conv_ml_p text) FROM PUBLIC;

