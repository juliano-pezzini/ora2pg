-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_auditoria_ditado_laudo ( nm_usuario_p usuario.nm_usuario%TYPE, ds_lista_exames_p text, ie_tipo_p auditoria_ditado_laudo.ie_tipo%TYPE) AS $body$
DECLARE

         
/*
    I  		Insert
    L 	 	Listerning
    D  		Delete
    DC  	Delete Complement
*/
nr_seq_interno_w           auditoria_ditado_laudo.nr_seq_interno%TYPE;
ds_lista_w                 varchar(2000);
qt_existe_virgula_w        bigint;
tam_lista_w                bigint;
ie_pos_virgula_w           bigint;


BEGIN

  ds_lista_w := ds_lista_exames_p;

  SELECT position(',' in ds_lista_w)
  INTO STRICT   qt_existe_virgula_w
;

  IF (qt_existe_virgula_w = 0) THEN
    ds_lista_w := ds_lista_w || ',';
  END IF;

  IF (ds_lista_w IS NOT NULL AND ds_lista_w::text <> '') THEN
        BEGIN
            WHILE(ds_lista_w IS NOT NULL AND ds_lista_w::text <> '') LOOP
                BEGIN
                    tam_lista_w      := LENGTH(ds_lista_w);
                    ie_pos_virgula_w := position(',' in ds_lista_w);

                    IF (ie_pos_virgula_w <> 0) THEN
                        nr_seq_interno_w := (SUBSTR(ds_lista_w, 1, (ie_pos_virgula_w - 1)))::numeric;
                        ds_lista_w       := SUBSTR(ds_lista_w, (ie_pos_virgula_w + 1), tam_lista_w);
                    END IF;

                    INSERT INTO auditoria_ditado_laudo(	
                            nr_sequencia,        
                            dt_atualizacao,
                            nm_usuario,    		  
                            dt_atualizacao_nrec,
                            nm_usuario_nrec,        			  
                            nr_seq_interno,
                            ie_tipo)
                    VALUES (
                            nextval('auditoria_ditado_laudo_seq'),
                            clock_timestamp(),
                            nm_usuario_p,
                            clock_timestamp(),
                            nm_usuario_p,
                            nr_seq_interno_w,
                            ie_tipo_p);
                END;
            END LOOP;
        END;
  END IF;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_auditoria_ditado_laudo ( nm_usuario_p usuario.nm_usuario%TYPE, ds_lista_exames_p text, ie_tipo_p auditoria_ditado_laudo.ie_tipo%TYPE) FROM PUBLIC;

