-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ptu_gerar_a580_63 ( nr_seq_fat_geral_p ptu_fatura_geral.nr_sequencia%type, cd_interface_p interface.cd_interface%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE


ds_conteudo_w		varchar(130);
cd_uni_des_w		varchar(4);
cd_uni_ori_w		varchar(4);
dt_geracao_w		varchar(8);
nr_comp_w		varchar(4);
dt_ven_doc_w		varchar(8);
dt_emi_doc_w		varchar(8);
vl_tot_doc_w		varchar(14);
nr_ver_tra_w		varchar(2);
vl_ir_w			varchar(14);
nr_documento_w		varchar(20);
doc_fiscal_w		varchar(20);
tp_documento_w		varchar(1);


BEGIN
delete	FROM w_ptu_envio_arq
where	nm_usuario = nm_usuario_p;

select	cd_uni_des,
	cd_uni_ori,
	to_char(dt_geracao,'yyyymmdd'),
	nr_comp,
	to_char(dt_ven_doc,'yyyymmdd'),
	to_char(dt_emi_doc,'yyyymmdd'),
	lpad(replace(replace(campo_mascara_virgula(vl_tot_doc),',',''),'.',''),14,'0'),
	nr_ver_tra,
	lpad(replace(replace(campo_mascara_virgula(vl_ir),',',''),'.',''),14,'0'),
	rpad(nr_documento,20,' '),
	rpad(doc_fiscal,20,' '),
	tp_documento
into STRICT	cd_uni_des_w,
	cd_uni_ori_w,
	dt_geracao_w,
	nr_comp_w,
	dt_ven_doc_w,
	dt_emi_doc_w,
	vl_tot_doc_w,
	nr_ver_tra_w,
	vl_ir_w,
	nr_documento_w,
	doc_fiscal_w,
	tp_documento_w
from	ptu_fatura_geral
where	nr_sequencia	= nr_seq_fat_geral_p;

ds_conteudo_w	:=	'00000001581' || cd_uni_des_w || cd_uni_ori_w || dt_geracao_w || nr_comp_w || lpad(' ',11,' ') || dt_ven_doc_w || dt_emi_doc_w || vl_tot_doc_w ||
					 nr_ver_tra_w || vl_ir_w || nr_documento_w || doc_fiscal_w || tp_documento_w;

insert	into w_ptu_envio_arq(ds_conteudo,
	dt_atualizacao,
	nm_usuario,
	nr_seq_apres,
	nr_sequencia)
values (ds_conteudo_w,
	clock_timestamp(),
	nm_usuario_p,
	1,
	nextval('w_ptu_envio_arq_seq'));
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ptu_gerar_a580_63 ( nr_seq_fat_geral_p ptu_fatura_geral.nr_sequencia%type, cd_interface_p interface.cd_interface%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;

