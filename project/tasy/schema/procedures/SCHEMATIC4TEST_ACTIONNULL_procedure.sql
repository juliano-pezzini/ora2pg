-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE schematic4test_actionnull () AS $body$
DECLARE

QTD_W bigint;
NR_SEQUENCIAW bigint;

C01 CURSOR FOR  --Loop all step that not exits
  SELECT DISTINCT NR_SEQUENCIA
    INTO STRICT NR_SEQUENCIAW 
  FROM SCHEM_TEST_STEP 
  WHERE NR_SEQ_ACTION NOT IN (SELECT NR_SEQUENCIA FROM schem_test_action);


BEGIN
  --Verify if exists action that was deleted
  SELECT COUNT(NR_SEQUENCIA)
    INTO STRICT QTD_W 
  FROM SCHEM_TEST_STEP 
  WHERE NR_SEQ_ACTION NOT IN (SELECT NR_SEQUENCIA FROM schem_test_action);

  IF (QTD_W <> 0) THEN
    OPEN C01;
    LOOP
    FETCH C01 INTO	
        NR_SEQUENCIAW;
    EXIT WHEN NOT FOUND; /* apply on C01 */
    BEGIN	
      --Disable all steps to this action
      CALL Schematic4Test_Script_Menu(NR_SEQUENCIAW, '14', 'Auto Robot');
    END;
    END LOOP;
    CLOSE C01;
  END IF;
  EXCEPTION
  WHEN no_data_found THEN
    RAISE NOTICE 'Erro: Data not found';
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE schematic4test_actionnull () FROM PUBLIC;

