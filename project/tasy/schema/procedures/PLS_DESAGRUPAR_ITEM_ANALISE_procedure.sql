-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_desagrupar_item_analise ( cd_item_p bigint, ie_origem_proced_p bigint, ie_tipo_item_p text, nr_seq_analise_p bigint, ds_seq_resumo_conta_p INOUT text) AS $body$
DECLARE

 
/*ESTA PROCEDURE EH CHAMADA NO CODIGO FONTE DA ANALISE DE CONTAS MÃ‰DICAS*/
 
 
ds_seq_resumo_conta_w		varchar(4000);
nr_seq_resumo_conta_ww		bigint;
--nr_seq_resumo_conta_w		number(10); 
 
/*cursor para concatenar as sequencias da tabela w_pls_resumo, onde estao os itens*/
C01 CURSOR FOR 
	SELECT 	nr_Sequencia 
	from 	pls_resumo_conta_v 
	where	cd_item 	 	= cd_item_p 
	and	ie_origem_proced 	= ie_origem_proced_p 
	and	ie_tipo_item	 	= ie_tipo_item_p 
	and	nr_seq_analise  	= nr_seq_analise_p 
	and	ie_tipo_item		in ('P','R') 
	
union
 
	SELECT 	nr_Sequencia 
	from 	pls_resumo_conta_v 
	where	coalesce(cd_material,cd_item )	= cd_item_p 
	and	ie_tipo_item	 		= ie_tipo_item_p 
	and	nr_seq_analise  		= nr_seq_analise_p 
	and	ie_tipo_item			= 'M' 
	order by nr_sequencia;


BEGIN 
 
ds_seq_resumo_conta_w := ',';
 
open C01;
loop 
fetch C01 into	 
	nr_seq_resumo_conta_ww;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin 
	ds_seq_resumo_conta_w	:= ds_seq_resumo_conta_w||to_char(nr_seq_resumo_conta_ww)||',';
	end;
end loop;
close C01;
 
ds_seq_resumo_conta_p	:= ds_seq_resumo_conta_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_desagrupar_item_analise ( cd_item_p bigint, ie_origem_proced_p bigint, ie_tipo_item_p text, nr_seq_analise_p bigint, ds_seq_resumo_conta_p INOUT text) FROM PUBLIC;

