-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_regra_menuitem (cd_estab_p integer, cd_perf_p integer, nm_usuario_regra_p text, nr_seq_objeto_p integer, nr_seq_indice_apres_p integer, nm_usuario_p text) AS $body$
DECLARE


    nr_seq_regra_w     bigint;
    nr_sequencia_rem_w bigint;


BEGIN

    begin
        select r.nr_sequencia
          into STRICT nr_seq_regra_w
          from funcao_popup_regra r
         where r.nr_seq_objeto = nr_seq_objeto_p
           and r.ie_tipo_regra = 'E'
           and coalesce(r.cd_estabelecimento, -999999) = coalesce(cd_estab_p, -999999)
           and coalesce(r.cd_perfil, -999999) = coalesce(cd_perf_p, -999999)
           and coalesce(r.nm_usuario_regra, '-') = coalesce(nm_usuario_regra_p, '-');
    exception
        when no_data_found then
            nr_seq_regra_w := 0;
    end;

    if (nr_seq_regra_w = 0) then

        $if $$tasy_local_dict=true $then
        nr_sequencia_rem_w := get_remote_sequence('seq:funcao_popup_regra_seq');
        $else
        select nextval('funcao_popup_regra_seq') into STRICT nr_sequencia_rem_w;
        $end

        insert into funcao_popup_regra(nr_sequencia,
             cd_estabelecimento,
             cd_perfil,
             nr_seq_objeto,
             ie_tipo_regra,
             nr_seq_apresent,
             ie_enable,
             ie_visible,
             nm_usuario_regra,
             nm_usuario,
             nm_usuario_nrec,
             dt_atualizacao,
             dt_atualizacao_nrec)
        values (nr_sequencia_rem_w, --funcao_popup_regra_seq.nextval,
             cd_estab_p,
             cd_perf_p,
             nr_seq_objeto_p,
             'E',
             nr_seq_indice_apres_p,
             'S',
             'S',
             nm_usuario_regra_p,
             nm_usuario_p,
             nm_usuario_p,
             clock_timestamp(),
             clock_timestamp());
    else
        update funcao_popup_regra
           set nr_seq_apresent = nr_seq_indice_apres_p,
               dt_atualizacao  = clock_timestamp(),
               nm_usuario      = nm_usuario_p
         where nr_sequencia = nr_seq_regra_w;

    end if;

    commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_regra_menuitem (cd_estab_p integer, cd_perf_p integer, nm_usuario_regra_p text, nr_seq_objeto_p integer, nr_seq_indice_apres_p integer, nm_usuario_p text) FROM PUBLIC;

