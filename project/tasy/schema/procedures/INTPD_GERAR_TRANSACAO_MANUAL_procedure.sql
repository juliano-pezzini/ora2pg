-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE intpd_gerar_transacao_manual ( ie_evento_p intpd_fila_transmissao.ie_evento%type, nr_seq_documento_p intpd_fila_transmissao.nr_seq_documento%type, nr_seq_item_documento_p intpd_fila_transmissao.nr_seq_item_documento%type, ie_operacao_p intpd_fila_transmissao.ie_operacao%type, nr_seq_sistema_p intpd_eventos_sistema.nr_seq_sistema%type, nm_usuario_p intpd_fila_transmissao.nm_usuario%type, cd_estabelecimento_p intpd_fila_transmissao.cd_estab_documento%type default null) AS $body$
DECLARE

		
cd_estabelecimento_w atendimento_paciente.cd_estabelecimento%type;
reg_integracao_w		 gerar_int_padrao.reg_integracao;
nr_atendimento_w		 atendimento_paciente.nr_atendimento%type;
cd_pessoa_fisica_w	 atendimento_paciente.cd_pessoa_fisica%type;
nr_sequencia_w		   bigint;	


BEGIN

begin
/*enviar diagnosticos*/

if (ie_evento_p = '82') then		
	nr_atendimento_w		:=	somente_numero(obter_valor_campo_separador(nr_seq_documento_p, 1, chr(172)));
/*enviar pessoa fisica*/

elsif (ie_evento_p = '12') then
	cd_pessoa_fisica_w	:=	nr_seq_documento_p;
/*enviar atendimento*/
	
elsif (ie_evento_p = '120') then
	nr_atendimento_w		:=	somente_numero(nr_seq_documento_p);
/*enviar dados do convenio*/

elsif (ie_evento_p = '135') then
	nr_atendimento_w		:=	somente_numero(obter_valor_campo_separador(nr_seq_documento_p, 1, chr(172)));
/*enviar movimentacao do paciente*/

elsif (ie_evento_p = '118') then
	begin
	nr_sequencia_w		:=	somente_numero(nr_seq_documento_p);
	
	select	max(nr_atendimento)
	into STRICT	nr_atendimento_w
	from	atend_paciente_unidade
	where	nr_seq_interno = nr_sequencia_w;	
	end;
/*enviar alta hospitar*/

elsif (ie_evento_p = '114') then
	nr_atendimento_w		:=	somente_numero(nr_seq_documento_p);
/*enviar procedimento paciente*/

elsif (ie_evento_p = '161') then
	begin
	nr_sequencia_w		:=	somente_numero(nr_seq_documento_p);
	
	select	max(nr_atendimento)
	into STRICT	nr_atendimento_w
	from	procedimento_paciente
	where	nr_sequencia = nr_sequencia_w;	
	end;	
end if;
exception
when others then
	begin
	nr_atendimento_w		:=	null;
	cd_pessoa_fisica_w	:=	null;
	end;
end;

reg_integracao_w.ie_operacao		:=	ie_operacao_p;
reg_integracao_w.ie_status			:=	'P';
reg_integracao_w.ie_geracao		:=	'U';
reg_integracao_w.nr_seq_item_documento_p	:=	nr_seq_item_documento_p;
reg_integracao_w.nr_atendimento		:=	nr_atendimento_w;
reg_integracao_w.cd_pessoa_fisica		:=	cd_pessoa_fisica_w;
reg_integracao_w.nr_seq_sistema		:=	nr_seq_sistema_p;
reg_integracao_w.cd_estab_documento := cd_estabelecimento_p;

reg_integracao_w := gerar_int_padrao.gravar_integracao(ie_evento_p, nr_seq_documento_p, nm_usuario_p, reg_integracao_w);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE intpd_gerar_transacao_manual ( ie_evento_p intpd_fila_transmissao.ie_evento%type, nr_seq_documento_p intpd_fila_transmissao.nr_seq_documento%type, nr_seq_item_documento_p intpd_fila_transmissao.nr_seq_item_documento%type, ie_operacao_p intpd_fila_transmissao.ie_operacao%type, nr_seq_sistema_p intpd_eventos_sistema.nr_seq_sistema%type, nm_usuario_p intpd_fila_transmissao.nm_usuario%type, cd_estabelecimento_p intpd_fila_transmissao.cd_estab_documento%type default null) FROM PUBLIC;

