-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_dia_ciclo_trat_onc ( nr_seq_atendimento_p bigint, ds_dia_ciclo_p text, dt_prevista_p timestamp) AS $body$
DECLARE


nr_seq_atendimento_w		bigint;
nr_dia_ciclo_w			bigint;
ds_dia_ciclo_previsto_w		varchar(15);
dt_prevista_w			timestamp;
ie_gerar_pend_quimio_w		varchar(1);

C01 CURSOR FOR
	SELECT	*
	from	paciente_atendimento
	where	nr_seq_atendimento = nr_seq_atendimento_p;

c01_w c01%rowtype;


C02 CURSOR FOR
	SELECT	*
	from	paciente_atend_medic
	where	nr_seq_atendimento = nr_seq_atendimento_p
	order by coalesce(nr_seq_diluicao,0);

c02_w c02%rowtype;

C03 CURSOR FOR
	SELECT	*
	from	paciente_atend_rec
	where	nr_seq_atendimento = nr_seq_atendimento_p;

c03_w c03%rowtype;

C04 CURSOR FOR
	SELECT	*
	from	paciente_atend_proc
	where	nr_seq_atendimento = nr_seq_atendimento_p;

c04_w c04%rowtype;

C05 CURSOR FOR
	SELECT	*
	from	paciente_atend_soluc
	where	nr_seq_atendimento = nr_seq_atendimento_p;

c05_w c05%rowtype;



BEGIN

ie_gerar_pend_quimio_w := obter_param_usuario(865, 255, obter_perfil_ativo, OBTER_USUARIO_ATIVO, wheb_usuario_pck.get_cd_estabelecimento, ie_gerar_pend_quimio_w);

select	nextval('paciente_atendimento_seq')
into STRICT	nr_seq_Atendimento_w
;

open C01;
loop
fetch C01 into
	c01_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin

	select 	dt_real
	into STRICT	dt_prevista_w
	from	paciente_atendimento
	where	nr_seq_atendimento = nr_seq_atendimento_p;


	nr_dia_ciclo_w := somente_numero(ds_dia_ciclo_p);
	ds_dia_ciclo_previsto_w := 'D'|| nr_dia_ciclo_w;
	insert into paciente_atendimento(
		cd_enfermagem,
		cd_estabelecimento,
		cd_medico,
		ds_dia_ciclo,
		ds_dia_ciclo_real,
		ds_observacao,
		ds_solic_transf,
		dt_acomodacao_paciente,
		dt_aguard_result_exame,
		dt_alter_data_prev,
		dt_anterior,
		dt_apto,
		dt_atualizacao,
		dt_atualizacao_nrec,
		dt_cancelamento,
		dt_chamada_painel,
		dt_check_lib,
		dt_chegada,
		dt_chegada_painel,
		dt_dispensacao_medic,
		dt_estorno_chegada,
		dt_fim_adm,
		dt_fim_triagem,
		dt_geracao_prescricao,
		dt_impressao,
		dt_inicio_adm,
		dt_inicio_triagem,
		dt_liberacao,
		dt_liberacao_atend,
		dt_prevista,
		dt_prevista_agenda,
		dt_quimio_liberada,
		dt_real,
		dt_recebimento_medic,
		dt_retirada_medicacao,
		dt_saida_previsto,
		dt_solic_transf,
		dt_suspensao,
		dt_suspensao_medico,
		ie_exige_liberacao,
		ie_l_dl_creatinina,
		nm_usuario,
		nm_usuario_alter_data_prev,
		nm_usuario_cancel,
		nm_usuario_check_lib,
		nm_usuario_estorno_chegada,
		nm_usuario_fim_adm,
		nm_usuario_inicio_adm,
		nm_usuario_lib,
		nm_usuario_lib_atend,
		nm_usuario_nrec,
		nm_usuario_receb,
		nm_usuario_susp_medico,
		nm_usuario_suspensao,
		nr_atendimento,
		nr_ciclo,
		nr_prescricao,
		nr_seq_agenda_cons,
		nr_seq_atendimento,
		nr_seq_local,
		nr_seq_local_previsto,
		nr_seq_motivo_alter_data,
		nr_seq_motivo_susp,
		nr_seq_paciente,
		nr_seq_pend_agenda,
		nr_seq_protocolo,
		pr_reducao,
		qt_altura,
		qt_auc,
		qt_clearance_creatinina,
		qt_creatinina,
		qt_mg_carboplatina,
		qt_peso,
		qt_superf_corporal,
		qt_tempo_agenda,
		qt_tempo_medic)
	 values (c01_w.cd_enfermagem,
		c01_w.cd_estabelecimento,
		c01_w.cd_medico,
		ds_dia_ciclo_previsto_w,
		c01_w.ds_dia_ciclo_real,
		c01_w.ds_observacao,
		c01_w.ds_solic_transf,
		c01_w.dt_acomodacao_paciente,
		c01_w.dt_aguard_result_exame,
		c01_w.dt_alter_data_prev,
		c01_w.dt_anterior,
		c01_w.dt_apto,
		clock_timestamp(),
		c01_w.dt_atualizacao_nrec,
		c01_w.dt_cancelamento,
		c01_w.dt_chamada_painel,
		c01_w.dt_check_lib,
		c01_w.dt_chegada,
		c01_w.dt_chegada_painel,
		c01_w.dt_dispensacao_medic,
		c01_w.dt_estorno_chegada,
		c01_w.dt_fim_adm,
		c01_w.dt_fim_triagem,
		c01_w.dt_geracao_prescricao,
		c01_w.dt_impressao,
		c01_w.dt_inicio_adm,
		c01_w.dt_inicio_triagem,
		c01_w.dt_liberacao,
		c01_w.dt_liberacao_atend,
		dt_prevista_p,
		c01_w.dt_prevista_agenda,
		c01_w.dt_quimio_liberada,
		dt_prevista_p,
		c01_w.dt_recebimento_medic,
		c01_w.dt_retirada_medicacao,
		c01_w.dt_saida_previsto,
		c01_w.dt_solic_transf,
		c01_w.dt_suspensao,
		c01_w.dt_suspensao_medico,
		c01_w.ie_exige_liberacao,
		c01_w.ie_l_dl_creatinina,
		c01_w.nm_usuario,
		c01_w.nm_usuario_alter_data_prev,
		c01_w.nm_usuario_cancel,
		c01_w.nm_usuario_check_lib,
		c01_w.nm_usuario_estorno_chegada,
		c01_w.nm_usuario_fim_adm,
		c01_w.nm_usuario_inicio_adm,
		c01_w.nm_usuario_lib,
		c01_w.nm_usuario_lib_atend,
		c01_w.nm_usuario_nrec,
		c01_w.nm_usuario_receb,
		c01_w.nm_usuario_susp_medico,
		c01_w.nm_usuario_suspensao,
		c01_w.nr_atendimento,
		c01_w.nr_ciclo,
		c01_w.nr_prescricao,
		c01_w.nr_seq_agenda_cons,
		nr_seq_atendimento_w,
		c01_w.nr_seq_local,
		c01_w.nr_seq_local_previsto,
		c01_w.nr_seq_motivo_alter_data,
		c01_w.nr_seq_motivo_susp,
		c01_w.nr_seq_paciente,
		c01_w.nr_seq_pend_agenda,
		c01_w.nr_seq_protocolo,
		c01_w.pr_reducao,
		c01_w.qt_altura,
		c01_w.qt_auc,
		c01_w.qt_clearance_creatinina,
		c01_w.qt_creatinina,
		c01_w.qt_mg_carboplatina,
		c01_w.qt_peso,
		c01_w.qt_superf_corporal,
		c01_w.qt_tempo_agenda,
		c01_w.qt_tempo_medic);
	end;
end loop;
close C01;



open C04;
loop
fetch C04 into
	c04_w;
EXIT WHEN NOT FOUND; /* apply on C04 */
	begin


	insert into paciente_atend_proc(
		nr_seq_atendimento,
		nr_seq_procedimento,
		cd_procedimento,
		ie_origem_proced,
		qt_procedimento,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		cd_intervalo,
		nr_agrupamento,
		ie_se_necessario,
		ie_acm,
		nr_seq_proc_interno,
		ie_lado,
		ie_local_adm)
	values ( nr_seq_atendimento_w,
		c04_w.nr_seq_procedimento,
		c04_w.cd_procedimento,
		c04_w.ie_origem_proced,
		c04_w.qt_procedimento,
		clock_timestamp(),
		c04_w.nm_usuario,
		c04_w.dt_atualizacao_nrec,
		c04_w.nm_usuario_nrec,
		c04_w.cd_intervalo,
		c04_w.nr_agrupamento,
		c04_w.ie_se_necessario,
		c04_w.ie_acm,
		c04_w.nr_seq_proc_interno,
		c04_w.ie_lado,
		CASE WHEN ie_gerar_pend_quimio_w='S' THEN  coalesce(c04_w.IE_LOCAL_ADM,'H')  ELSE coalesce(c04_w.IE_LOCAL_ADM,'') END );
	end;
end loop;
close C04;


open C05;
loop
fetch C05 into
	c05_w;
EXIT WHEN NOT FOUND; /* apply on C05 */
	begin

	insert into paciente_atend_soluc(
		nr_seq_atendimento,
		nr_seq_solucao,
		nr_agrupamento,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		ie_tipo_dosagem,
		qt_dosagem,
		qt_solucao_total,
		qt_tempo_aplicacao,
		nr_etapas,
		ie_bomba_infusao,
		ie_esquema_alternado,
		ie_calc_aut,
		ie_acm,
		qt_hora_fase,
		ds_solucao,
		ds_orientacao,
		ie_se_necessario,
		ie_solucao_pca,
		ie_tipo_analgesia,
		ie_pca_modo_prog,
		qt_dose_inicial_pca,
		qt_vol_infusao_pca,
		qt_bolus_pca,
		qt_intervalo_bloqueio,
		qt_limite_quatro_hora,
		qt_dose_ataque,
		ie_tipo_sol,
		ie_pre_medicacao,
		pr_reducao,
		cd_intervalo,
		ie_cancelada,
		ie_local_adm)
	values (nr_seq_atendimento_w,
		c05_w.nr_seq_solucao,
		c05_w.nr_agrupamento,
		clock_timestamp(),
		c05_w.nm_usuario,
		c05_w.dt_atualizacao_nrec,
		c05_w.nm_usuario_nrec,
		c05_w.ie_tipo_dosagem,
		c05_w.qt_dosagem,
		c05_w.qt_solucao_total,
		c05_w.qt_tempo_aplicacao,
		c05_w.nr_etapas,
		c05_w.ie_bomba_infusao,
		c05_w.ie_esquema_alternado,
		c05_w.ie_calc_aut,
		c05_w.ie_acm,
		c05_w.qt_hora_fase,
		c05_w.ds_solucao,
		c05_w.ds_orientacao,
		c05_w.ie_se_necessario,
		c05_w.ie_solucao_pca,
		c05_w.ie_tipo_analgesia,
		c05_w.ie_pca_modo_prog,
		c05_w.qt_dose_inicial_pca,
		c05_w.qt_vol_infusao_pca,
		c05_w.qt_bolus_pca,
		c05_w.qt_intervalo_bloqueio,
		c05_w.qt_limite_quatro_hora,
		c05_w.qt_dose_ataque,
		c05_w.ie_tipo_sol,
		c05_w.ie_pre_medicacao,
		c05_w.pr_reducao,
		c05_w.cd_intervalo,
		'N',
		CASE WHEN ie_gerar_pend_quimio_w='S' THEN  coalesce(c05_w.IE_LOCAL_ADM,'H')  ELSE coalesce(c05_w.IE_LOCAL_ADM,'') END );
	end;
end loop;
close C05;


open C03;
loop
fetch C03 into
	c03_w;
EXIT WHEN NOT FOUND; /* apply on C03 */
	begin
	insert into paciente_atend_rec(
		nr_sequencia,
		nr_seq_atendimento,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		ds_recomendacao,
		cd_recomendacao,
		cd_intervalo,
		ie_acm,
		ie_se_necessario,
		nr_seq_classif,
		ie_local_adm)
	values (nextval('paciente_atend_rec_seq'),
		nr_seq_atendimento_w,
		clock_timestamp(),
		c03_w.nm_usuario,
		c03_w.dt_atualizacao_nrec,
		c03_w.nm_usuario_nrec,
		c03_w.ds_recomendacao,
		c03_w.cd_recomendacao,
		c03_w.cd_intervalo,
		c03_w.ie_acm,
		c03_w.ie_se_necessario,
		c03_w.nr_seq_classif,
		CASE WHEN ie_gerar_pend_quimio_w='S' THEN  coalesce(c03_w.IE_LOCAL_ADM,'H')  ELSE coalesce(c03_w.IE_LOCAL_ADM,'') END );

	end;
end loop;
close C03;


open C02;
loop
fetch C02 into
	c02_w;
EXIT WHEN NOT FOUND; /* apply on C02 */
	begin

	insert into paciente_atend_medic(
		cd_intervalo,
		cd_material,
		cd_unid_med_dose,
		cd_unid_med_prescr,
		ds_observacao,
		ds_recomendacao,
		ds_tempo_infusao,
		dt_atualizacao,
		dt_cancelamento,
		ie_administracao,
		ie_agrupador,
		ie_aplic_bolus,
		ie_aplic_lenta,
		ie_aplica_reducao,
		ie_bomba_infusao,
		ie_cancelada,
		ie_checado,
		ie_gerar_solucao,
		ie_item_superior,
		ie_local_adm,
		ie_pre_medicacao,
		ie_regra_diluicao_cad_mat,
		ie_se_necessario,
		ie_tipo_percentual,
		ie_urgencia,
		ie_via_aplicacao,
		ie_zerado,
		nm_usuario,
		nm_usuario_cancel,
		nr_agrupamento,
		nr_seq_atendimento,
		nr_seq_diluicao,
		nr_seq_int_prot_medic,
		nr_seq_interno,
		nr_seq_mat_protocolo,
		nr_seq_material,
		nr_seq_motivo_perda,
		nr_seq_paciente,
		nr_seq_procedimento,
		nr_seq_prot_medic,
		nr_seq_reconstituinte,
		nr_seq_solucao,
		nr_seq_via_acesso,
		pr_reducao,
		qt_auc,
		qt_ccr,
		qt_creatinina,
		qt_dias_util,
		qt_dose,
		qt_dose_prescricao,
		qt_hora_aplicacao,
		qt_min_aplicacao,
		ie_medicacao_paciente)
	values (c02_w.cd_intervalo,
		c02_w.cd_material,
		c02_w.cd_unid_med_dose,
		c02_w.cd_unid_med_prescr,
		c02_w.ds_observacao,
		c02_w.ds_recomendacao,
		c02_w.ds_tempo_infusao,
		clock_timestamp(),
		c02_w.dt_cancelamento,
		c02_w.ie_administracao,
		c02_w.ie_agrupador,
		c02_w.ie_aplic_bolus,
		c02_w.ie_aplic_lenta,
		c02_w.ie_aplica_reducao,
		c02_w.ie_bomba_infusao,
		c02_w.ie_cancelada,
		c02_w.ie_checado,
		c02_w.ie_gerar_solucao,
		c02_w.ie_item_superior,
		c02_w.ie_local_adm,
		c02_w.ie_pre_medicacao,
		c02_w.ie_regra_diluicao_cad_mat,
		c02_w.ie_se_necessario,
		c02_w.ie_tipo_percentual,
		c02_w.ie_urgencia,
		c02_w.ie_via_aplicacao,
		c02_w.ie_zerado,
		c02_w.nm_usuario,
		c02_w.nm_usuario_cancel,
		c02_w.nr_agrupamento,
		nr_seq_atendimento_w,
		c02_w.nr_seq_diluicao,
		c02_w.nr_seq_int_prot_medic,
		nextval('paciente_atend_medic_seq'),
		c02_w.nr_seq_mat_protocolo,
		c02_w.nr_seq_material,
		c02_w.nr_seq_motivo_perda,
		c02_w.nr_seq_paciente,
		c02_w.nr_seq_procedimento,
		c02_w.nr_seq_prot_medic,
		c02_w.nr_seq_reconstituinte,
		c02_w.nr_seq_solucao,
		c02_w.nr_seq_via_acesso,
		c02_w.pr_reducao,
		c02_w.qt_auc,
		c02_w.qt_ccr,
		c02_w.qt_creatinina,
		c02_w.qt_dias_util,
		c02_w.qt_dose,
		c02_w.qt_dose_prescricao,
		c02_w.qt_hora_aplicacao,
		c02_w.qt_min_aplicacao,
		coalesce(c02_w.ie_medicacao_paciente,'N'));
	end;
end loop;
close C02;


commit;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_dia_ciclo_trat_onc ( nr_seq_atendimento_p bigint, ds_dia_ciclo_p text, dt_prevista_p timestamp) FROM PUBLIC;

