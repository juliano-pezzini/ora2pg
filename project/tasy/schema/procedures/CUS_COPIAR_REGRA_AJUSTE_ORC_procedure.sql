-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cus_copiar_regra_ajuste_orc ( cd_tabela_custo_origem_p tabela_custo.nr_sequencia%type, cd_tabela_custo_destino_p tabela_custo.nr_sequencia%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE

					
nr_seq_tabela_orig_w	tabela_custo.nr_sequencia%type;
nr_seq_tabela_dest_w	tabela_custo.nr_sequencia%type;


BEGIN

select	max(nr_sequencia)
into STRICT	nr_seq_tabela_orig_w
from	tabela_custo
where	cd_tabela_custo		= cd_tabela_custo_origem_p
and	coalesce(cd_estabelecimento,cd_estabelecimento_p) = cd_estabelecimento_p
and	cd_empresa = obter_empresa_estab(cd_estabelecimento_p);

select	max(nr_sequencia)
into STRICT	nr_seq_tabela_dest_w
from	tabela_custo
where	cd_tabela_custo		= cd_tabela_custo_destino_p
and	coalesce(cd_estabelecimento,cd_estabelecimento_p) = cd_estabelecimento_p
and	cd_empresa = obter_empresa_estab(cd_estabelecimento_p);

delete 	FROM cus_regra_ajuste_orc
where	nr_seq_tabela = nr_seq_tabela_dest_w;

insert into  cus_regra_ajuste_orc(
	nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		cd_estabelecimento,
		cd_tabela_custo,
		cd_empresa,
		cd_centro_controle_origem,
		nr_seq_gng_origem,
		nr_seq_ng_origem,
		cd_centro_controle_dest,
		nr_seq_ng_dest,
		pr_ajuste,
		nr_seq_calculo,
		ie_sobrepor,
		vl_ajuste_calc,
		nr_seq_tabela,
		cd_estab_destino)
SELECT		nextval('cus_regra_ajuste_orc_seq'),
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		a.cd_estabelecimento,
		cd_tabela_custo_destino_p,
		a.cd_empresa,
		a.cd_centro_controle_origem,
		a.nr_seq_gng_origem,
		a.nr_seq_ng_origem,
		a.cd_centro_controle_dest,
		a.nr_seq_ng_dest,
		a.pr_ajuste,
		a.nr_seq_calculo,
		a.ie_sobrepor,
		a.vl_ajuste_calc,
		nr_seq_tabela_dest_w,
		a.cd_estab_destino
	from	cus_regra_ajuste_orc a
	where	a.nr_seq_tabela = nr_seq_tabela_orig_w;
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cus_copiar_regra_ajuste_orc ( cd_tabela_custo_origem_p tabela_custo.nr_sequencia%type, cd_tabela_custo_destino_p tabela_custo.nr_sequencia%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;

