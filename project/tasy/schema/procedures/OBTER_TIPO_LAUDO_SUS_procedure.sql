-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_tipo_laudo_sus (CD_PROCEDIMENTO_P bigint, IE_ORIGEM_PROCED_P bigint, IE_TIPO_LAUDO_SUS_P INOUT text, IE_OBRIGATORIO_P INOUT text) AS $body$
DECLARE


IE_TIPO_LAUDO_SUS_W		varchar(20) 	:= '';
CD_PROCEDIMENTO_W		bigint	:= 0;
IE_OBRIGATORIO_W		varchar(20) 	:= 'S';


BEGIN
IE_OBRIGATORIO_W	:= 'S';
ie_tipo_laudo_sus_w	:= '';
cd_procedimento_w	:= cd_procedimento_p;

/* Vacina Anti RH */

if	cd_procedimento_w	= 99020017 then
	ie_tipo_laudo_sus_w	:= '4';
end if;

/* Uso de fatores de coagolação */

if	substr(cd_procedimento_w,1,2) = '92' then
	ie_tipo_laudo_sus_w	:= '6';
end if;

/* Nutrição parenteral */

if	substr(cd_procedimento_w,1,5) in ('99300','99500') then
	ie_tipo_laudo_sus_w	:= '8';
end if;

/* Tomografia */

if	substr(cd_procedimento_w,1,5) in ('97013','97014','97015') then
	ie_tipo_laudo_sus_w	:= '10';
end if;

/* Longa Permanencia */

if	substr(cd_procedimento_w,1,5) in ('99003') then
	ie_tipo_laudo_sus_w	:= '11';
end if;


/* Outros */

if	(substr(cd_procedimento_w,1,5))::numeric  between 97001 and 97012 then
	ie_tipo_laudo_sus_w	:= '9';
end if;
if	substr(cd_procedimento_w,1,5) in ('99063','98300','98500') and (cd_procedimento_w <> 98500015) and (cd_procedimento_w <> 98500016) and (cd_procedimento_w <> 98300016) then
	ie_tipo_laudo_sus_w	:= '9';
end if;


/* Ricardo 09/02/2004 - Incluída a condição para tratar todos os procedimento menos o 97220000*/

/* Ricardo 21/10/2004 - Menos os procedimentos 97221007 e 97222003 OS 12296 */

/* Adelson 06/01/2006 - Menos os procedimentos 97209007 e 97210005 OS 28091 */

if ((substr(cd_procedimento_w,1,5))::numeric  between 97203 and 97223) and (cd_procedimento_w <> 97220000) and (cd_procedimento_w <> 97209007) and (cd_procedimento_w <> 97210005) and (cd_procedimento_w <> 97221007) and (cd_procedimento_w <> 97222003) then
	ie_tipo_laudo_sus_w	:= '9';
end if;

/* Felipe - 06/11/2007 - OS 73559 e 74618 */

if (cd_procedimento_p	in (97019003, 97020001, 99065010, 92034012)) then
	ie_tipo_laudo_sus_w	:= '9';
end if;

/* Procedimentos que devem ter laudo original,mudança ou outros */

if	(substr(cd_procedimento_w,1,2))::numeric  between 69 and 91 then
	begin
	IE_OBRIGATORIO_W		:= 'N';
	ie_tipo_laudo_sus_w		:= '0,1,9';
	end;
end if;
if (cd_procedimento_w between 31000000 and 44999999) then
	begin
	IE_OBRIGATORIO_W		:= 'N';
	ie_tipo_laudo_sus_w		:= '0,1,9';
	end;
end if;

ie_tipo_laudo_sus_p	:= ie_tipo_laudo_sus_w;
IE_OBRIGATORIO_P	:= IE_OBRIGATORIO_W;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_tipo_laudo_sus (CD_PROCEDIMENTO_P bigint, IE_ORIGEM_PROCED_P bigint, IE_TIPO_LAUDO_SUS_P INOUT text, IE_OBRIGATORIO_P INOUT text) FROM PUBLIC;

