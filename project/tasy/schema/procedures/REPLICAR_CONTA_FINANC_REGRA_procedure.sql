-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE replicar_conta_financ_regra (nr_seq_conta_financeira_p bigint, cd_empresa_controladora_p bigint,nr_conta_financ_regra_p bigint) AS $body$
DECLARE


c01 CURSOR FOR
SELECT b.cd_estabelecimento, b.cd_conta_financ
  from grupo_emp_estrutura a,
       conta_financeira b
 where a.cd_empresa = b.cd_empresa
   and a.nr_seq_grupo = holding_pck.get_grupo_emp_estrut(cd_empresa_controladora_p)
   and b.cd_conta_financ_global = nr_seq_conta_financeira_p;

vet01	c01%rowtype;


BEGIN

	open c01;
	loop
	fetch c01 into vet01;
  EXIT WHEN NOT FOUND; /* apply on c01 */

	insert into conta_financ_regra(nr_sequencia,
			cd_estabelecimento,
			nr_seq_conta_financ,
			ie_entrada_saida,
			dt_atualizacao,
			nm_usuario,
			cd_grupo_material,
			cd_subgrupo_material,
			cd_classe_material,
			nr_seq_familia,
			cd_area_procedimento,
			cd_especialidade,
			cd_grupo_proc,
			cd_setor_atendimento,
			cd_tipo_pessoa,
			cd_cgc,
			cd_material,
			cd_procedimento,
			ie_origem_proced,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			ie_clinica,
			cd_operacao_nf,
			ie_faturamento,
			ie_tipo_atendimento,
			nr_seq_proj_rec,
			ie_tipo_convenio,
			nr_seq_produto,
			ie_nota_credito,
			cd_pessoa_fisica,
			ie_tipo_pessoa,
			cd_moeda,
			nr_seq_grupo,
			nr_seq_subgrupo,
			nr_seq_forma_org,
			ie_tipo_financiamento,
			ie_complexidade,
			ie_origem_tit_rec,
			ie_origem_tit_pagar,
			nr_seq_classe_tr,
			nr_seq_trans_fin,
			ie_tipo_titulo_pagar,
			ie_tipo_titulo_receber,
			ds_observacao)
	SELECT	nextval('conta_financ_regra_seq'),
			vet01.cd_estabelecimento,
			vet01.cd_conta_financ,
			ie_entrada_saida,
			clock_timestamp(),
			nm_usuario,
			cd_grupo_material,
			cd_subgrupo_material,
			cd_classe_material,
			nr_seq_familia,
			cd_area_procedimento,
			cd_especialidade,
			cd_grupo_proc,
			cd_setor_atendimento,
			cd_tipo_pessoa,
			cd_cgc,
			cd_material,
			cd_procedimento,
			ie_origem_proced,
			clock_timestamp(),
			nm_usuario,
			ie_clinica,
			cd_operacao_nf,
			ie_faturamento,
			ie_tipo_atendimento,
			nr_seq_proj_rec,
			ie_tipo_convenio,
			nr_seq_produto,
			ie_nota_credito,
			cd_pessoa_fisica,
			ie_tipo_pessoa,
            cd_moeda,
            nr_seq_grupo,
            nr_seq_subgrupo,
            nr_seq_forma_org,
            ie_tipo_financiamento,
            ie_complexidade,
            ie_origem_tit_rec,
            ie_origem_tit_pagar,
            nr_seq_classe_tr,
            (SELECT max(nr_sequencia) from transacao_financeira where nr_seq_trans_fin_ref = a.nr_seq_trans_fin and cd_estabelecimento = vet01.cd_estabelecimento) nr_seq_trans_fin,
            ie_tipo_titulo_pagar,
            ie_tipo_titulo_receber,
			ds_observacao
	from	conta_financ_regra a
	where	a.nr_sequencia = nr_conta_financ_regra_p;
  end loop;
close c01;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE replicar_conta_financ_regra (nr_seq_conta_financeira_p bigint, cd_empresa_controladora_p bigint,nr_conta_financ_regra_p bigint) FROM PUBLIC;

