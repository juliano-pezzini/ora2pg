-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_medico_atend (nr_atendimento_p bigint, ie_atualizar_p INOUT text) AS $body$
DECLARE

 
qt_reg_w 		smallint;
cd_medico_w 		prescr_medica.cd_medico%TYPE;
cd_medico_atual_w	atendimento_paciente.cd_medico_resp%type;


BEGIN 
 
ie_atualizar_p := 'N';
 
SELECT coalesce(MAX(1),0), 
 	MAX(cd_medico) 
INTO STRICT 	qt_reg_w, 
 	cd_medico_w 
FROM 	prescr_medica 
WHERE 	nr_atendimento = nr_atendimento_p;
 
IF (qt_reg_w = 1) THEN 
	select 	max(cd_medico_resp) 
	into STRICT	cd_medico_atual_w 
	from 	atendimento_paciente 
	where 	nr_atendimento = nr_atendimento_p;
 
	if (cd_medico_atual_w <> cd_medico_w) then	 
 		ie_atualizar_p := 'S';
		 
		UPDATE atendimento_paciente 
 		SET cd_medico_resp = cd_medico_w 
 		WHERE nr_atendimento = nr_atendimento_p;
 
 		COMMIT;
	end if;
END IF;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_medico_atend (nr_atendimento_p bigint, ie_atualizar_p INOUT text) FROM PUBLIC;

