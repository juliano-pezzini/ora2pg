-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE enable_disable_constraints (p_nm_table text, p_nm_column text, p_enable_disable text) AS $body$
DECLARE

    c_cons_reference CURSOR(p_table_name text,
	                        p_column_name text) FOR
        SELECT 	constraint_name
        FROM 	user_cons_columns
        WHERE 	table_name 	= p_table_name
        AND 	column_name = p_column_name;

    c_cons_disable_enable CURSOR(r_constraint_name text) FOR
        SELECT 	table_name,
				constraint_name
        FROM 	user_constraints
        WHERE 	delete_rule = 'NO ACTION'
        AND 	r_constraint_name LIKE r_constraint_name
        ORDER BY table_name;

    wTpComando varchar(10) := NULL;
BEGIN
    IF (p_enable_disable = 'S') THEN
        wTpComando := 'CHECK';
    ELSE
      wTpComando := 'NOCHECK';
    END IF;

    FOR r_cons_reference IN c_cons_reference(p_nm_table, p_nm_column)
    LOOP
        FOR r_cons_disable_enable IN c_cons_disable_enable(r_cons_reference.constraint_name)
        LOOP
            EXECUTE 'ALTER TABLE '||r_cons_disable_enable.table_name||' '||wTpComando||' CONSTRAINT '||r_cons_disable_enable.constraint_name;
        END LOOP;
    END LOOP;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE enable_disable_constraints (p_nm_table text, p_nm_column text, p_enable_disable text) FROM PUBLIC;

