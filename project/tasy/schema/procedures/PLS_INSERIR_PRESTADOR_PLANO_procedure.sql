-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_inserir_prestador_plano ( ds_produtos_p text, nr_seq_prestador_p bigint, dt_inicio_vigencia_P timestamp, nm_usuario_p text) AS $body$
DECLARE


caracter_inicial_w	bigint;
caracter_w		    varchar(10);
nr_seq_plano_w		varchar(10);
ds_produtos_w       varchar(1000);
i                   bigint;


BEGIN
caracter_inicial_w := 1;
ds_produtos_w := ds_produtos_p || ',';

for i in 1..length(ds_produtos_w) loop
	begin
	caracter_w := substr(ds_produtos_w,i,1);
	if (caracter_w = ',') and (nr_seq_plano_w IS NOT NULL AND nr_seq_plano_w::text <> '') then
		insert into pls_prestador_plano(nr_sequencia,
			nr_seq_prestador,
			nr_seq_plano,
			ie_situacao,
			nm_usuario,
			dt_atualizacao,
			ie_permite,
			dt_inicio_vigencia,
			ie_tipo_atendimento)
		values (nextval('pls_prestador_plano_seq'),
			nr_seq_prestador_p,
			(nr_seq_plano_w)::numeric ,
			'A',
			nm_usuario_p,
			clock_timestamp(),
			'S',
			dt_inicio_vigencia_p,
			'T');
		caracter_inicial_w := i+1;

		nr_seq_plano_w	:= null;
	else
		nr_seq_plano_w	:= nr_seq_plano_w || trim(both caracter_w);
	end if;
	end;
end loop;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_inserir_prestador_plano ( ds_produtos_p text, nr_seq_prestador_p bigint, dt_inicio_vigencia_P timestamp, nm_usuario_p text) FROM PUBLIC;

