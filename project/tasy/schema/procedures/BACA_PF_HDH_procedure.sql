-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_pf_hdh () AS $body$
DECLARE

 
cd_pessoa_fisica_w		varchar(100);
nm_pessoa_fisica_w		varchar(100);
ds_erro_w			varchar(4000);

c01 CURSOR FOR 
SELECT	p.cd_pessoa_fisica, 
	SUBSTR(OBTER_NOME_PF(p.cd_pessoa_fisica), 0, 100) nm_pessoa_fisica 
from 	pessoa_fisica p 
where	position(' ' in p.nm_pessoa_fisica)	= 0 
and	exists (SELECT	1 
		from	atendimento_visita x 
		where	x.cd_pessoa_fisica	= p.cd_pessoa_fisica);


BEGIN 
 
open c01;
loop 
fetch c01 into 
	cd_pessoa_fisica_w, 
	nm_pessoa_fisica_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
 
	begin 
 
	delete 	from PEP_ACESSO 
	where	cd_pessoa_fisica	= cd_pessoa_fisica_w;
 
	delete 	from same_cpi_prontuario 
	where	cd_pessoa_fisica	= cd_pessoa_fisica_w;
 
	delete	from atendimento_visita 
	where	cd_pessoa_fisica	= cd_pessoa_fisica_w;
 
	delete	from pessoa_fisica 
	where	cd_pessoa_fisica	= cd_pessoa_fisica_w;
 
	/*insert	into logxxxxx_tasy 
		(DT_ATUALIZACAO, 
		NM_USUARIO, 
		CD_LOG, 
		DS_LOG) 
	values	(sysdate, 
		'OS101937_69103', 
		55718, 
		'Exclusão da pessoa física ' || cd_pessoa_fisica_w || ' - ' || nm_pessoa_fisica_w);*/
 
 
	commit;
 
	exception 
	when others then 
		rollback;
		ds_erro_w	:= sqlerrm;
		/*insert	into logxxxx_tasy 
			(DT_ATUALIZACAO, 
			NM_USUARIO, 
			CD_LOG, 
			DS_LOG) 
		values	(sysdate, 
			'OS101937_69103', 
			55719, 
			'Erro na exclusão da pessoa física ' || cd_pessoa_fisica_w || ' - ' || nm_pessoa_fisica_w || chr(13) ||	ds_erro_w);*/
 
		commit;
	end;
 
end loop;
close c01;
 
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_pf_hdh () FROM PUBLIC;

