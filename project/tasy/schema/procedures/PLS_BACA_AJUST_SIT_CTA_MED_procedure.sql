-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_baca_ajust_sit_cta_med ( nm_usuario_p text) AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [  ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
BEGIN
CALL exec_sql_dinamico('Tasy',' alter trigger PLS_CONTA_MEDICA_RESUMO_ATUAL disable');

update	pls_conta_medica_resumo	a
set	ie_situacao	= 'I',
	nm_usuario	= nm_usuario_P,
	dt_atualizacao	= clock_timestamp()
where	((ie_situacao != 'I') or (coalesce(ie_situacao::text, '') = ''))
and	exists (	SELECT	1
			from	pls_pag_prest_item_resumo	x
			where	x.nr_seq_resumo_conta 	= a.nr_sequencia)
and	exists (	select	1
			from	pls_conta_medica_resumo x
			where	x.nr_seq_item	= a.nr_seq_item
			and	x.ie_proc_mat	= a.ie_proc_mat
			and	x.ie_tipo_item	= a.ie_tipo_item
			and	x.nr_sequencia  != a.nr_sequencia
			and	x.ie_situacao = 'A')
and	coalesce(nr_seq_lote_pgto::text, '') = '';

update	pls_conta_medica_resumo	a
set	ie_situacao	= 'A',
	nm_usuario	= nm_usuario_P,
	dt_atualizacao	= clock_timestamp()
where	((ie_situacao != 'I') or (coalesce(ie_situacao::text, '') = ''));

CALL exec_sql_dinamico('Tasy',' alter trigger PLS_CONTA_MEDICA_RESUMO_ATUAL enable');

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_baca_ajust_sit_cta_med ( nm_usuario_p text) FROM PUBLIC;

