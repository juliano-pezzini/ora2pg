-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gerar_reinclusao_benef ( nr_seq_reinclusao_p INOUT bigint, nr_seq_contrato_p bigint, nr_seq_rescisao_p bigint, nr_seq_solic_resc_benef_p bigint, cd_estabelecimento_p text, cd_cep_p text, cd_municipio_ibge_p text, cd_tipo_logradouro_p text, ds_bairro_p text, ds_complemento_p text, ds_endereco_p text, ds_municipio_p text, ie_inclui_dependentes_p text, nm_pessoa_fisica_p text, nr_ddi_telefone_p text, nr_ddd_telefone_p text, nr_telefone_p text, nr_ddi_celular_p text, nr_ddd_celular_p text, nr_telefone_celular_p text, nr_endereco_p text, sg_estado_p text, nm_usuario_p text, nr_seq_segurado_p bigint) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
Gerar ou alterar a solicitacao de reinclusao de beneficiario
-------------------------------------------------------------------------------------------------------------------

Locais de chamada direta: 
[  ]  Objetos do dicionario [ ] Tasy (Delphi/Java) [  x ] Portal [  ]  Relatorios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------

Pontos de atencao:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
nr_seq_reinclusao_w		pls_reinclusao_benef.nr_sequencia%type;


BEGIN

if (coalesce(nr_seq_reinclusao_p::text, '') = '') then
	select	nextval('pls_reinclusao_benef_seq')
	into STRICT	nr_seq_reinclusao_w
	;
	
	insert into pls_reinclusao_benef(	nr_sequencia, ie_status, dt_solicitacao,
						nm_usuario_nrec, dt_atualizacao_nrec, nm_usuario,
						dt_atualizacao, cd_estabelecimento, nr_seq_segurado,
						nr_seq_contrato, nr_seq_rescisao, cd_cep,
						cd_municipio_ibge, cd_tipo_logradouro, ds_bairro,
						ds_complemento, ds_municipio, ie_inclui_dependentes,
						nm_pessoa_fisica, nr_ddi_telefone, nr_ddd_telefone,
						nr_telefone, nr_ddi_celular, nr_ddd_celular,
						nr_telefone_celular, nr_endereco_varchar, sg_estado,
						ds_endereco, nr_seq_solic_resc_benef, ie_criar_pagador)
				values (	nr_seq_reinclusao_w, '2', clock_timestamp(),
						nm_usuario_p, clock_timestamp(), nm_usuario_p,
						clock_timestamp(), cd_estabelecimento_p, nr_seq_segurado_p,
						nr_seq_contrato_p, nr_seq_rescisao_p, cd_cep_p,
						cd_municipio_ibge_p, cd_tipo_logradouro_p, ds_bairro_p,
						ds_complemento_p, ds_municipio_p, coalesce(ie_inclui_dependentes_p, 'N'),
						nm_pessoa_fisica_p, nr_ddi_telefone_p, nr_ddd_telefone_p,
						nr_telefone_p, nr_ddi_celular_p, nr_ddd_celular_p,
						nr_telefone_celular_p, nr_endereco_p, sg_estado_p,
						ds_endereco_p, nr_seq_solic_resc_benef_p, 'S');
	
	nr_seq_reinclusao_p	:= nr_seq_reinclusao_w;
else
	update	pls_reinclusao_benef
	set	nm_usuario		= nm_usuario_p,
		dt_atualizacao		= clock_timestamp(),
		cd_cep			= cd_cep_p,
		cd_municipio_ibge	= cd_municipio_ibge_p, 
		cd_tipo_logradouro	= cd_tipo_logradouro_p, 
		ds_bairro		= ds_bairro_p,
		ds_complemento		= ds_complemento_p,
		ds_municipio		= ds_municipio_p, 
		ds_endereco		= ds_endereco_p,
		ie_inclui_dependentes	= coalesce(ie_inclui_dependentes_p, 'N'),
		nm_pessoa_fisica	= nm_pessoa_fisica_p, 
		nr_ddi_telefone		= nr_ddi_telefone_p, 
		nr_ddd_telefone		= nr_ddd_telefone_p,
		nr_telefone		= nr_telefone_p, 
		nr_ddi_celular		= nr_ddi_celular_p, 
		nr_ddd_celular		= nr_ddd_celular_p,
		nr_telefone_celular	= nr_telefone_celular_p, 
		nr_endereco_varchar	= nr_endereco_p, 
		sg_estado		= sg_estado_p
	where	nr_sequencia		= nr_seq_reinclusao_p;
	
	--Remove os beneficiarios dependentes cadastrados
	delete	from pls_reinc_dependentes
	where	nr_seq_reinc_benef = nr_seq_reinclusao_p;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_reinclusao_benef ( nr_seq_reinclusao_p INOUT bigint, nr_seq_contrato_p bigint, nr_seq_rescisao_p bigint, nr_seq_solic_resc_benef_p bigint, cd_estabelecimento_p text, cd_cep_p text, cd_municipio_ibge_p text, cd_tipo_logradouro_p text, ds_bairro_p text, ds_complemento_p text, ds_endereco_p text, ds_municipio_p text, ie_inclui_dependentes_p text, nm_pessoa_fisica_p text, nr_ddi_telefone_p text, nr_ddd_telefone_p text, nr_telefone_p text, nr_ddi_celular_p text, nr_ddd_celular_p text, nr_telefone_celular_p text, nr_endereco_p text, sg_estado_p text, nm_usuario_p text, nr_seq_segurado_p bigint) FROM PUBLIC;

