-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE antecipar_resultado_nr_atend ( nr_atendimento_p bigint, ds_observacao_antecipacao_p text, nr_seq_motivo_antecipacao_p bigint, dt_antecipacao_exame_p timestamp, nm_usuario_p text) AS $body$
DECLARE

  nr_prescricao_w bigint;
  nr_sequencia_w  bigint;
  c1 CURSOR FOR
    SELECT pp.nr_prescricao,
      pp.nr_sequencia
    FROM prescr_medica pm,
      prescr_procedimento pp
    WHERE pm.nr_prescricao = pp.nr_prescricao
    AND pm.NR_ATENDIMENTO  = nr_atendimento_p;

BEGIN
  OPEN c1;
  LOOP
    FETCH C1 INTO nr_prescricao_w, nr_sequencia_w;
    BEGIN
      UPDATE prescr_procedimento
      SET dt_antecipa_result      = dt_antecipacao_exame_p,
        ds_observacao_antecipacao = ds_observacao_antecipacao_p,
        nm_usuario_antecipacao    = nm_usuario_p,
        nr_seq_motivo_antecipacao = nr_seq_motivo_antecipacao_p
      WHERE nr_prescricao         = nr_prescricao_w
      AND nr_sequencia            = nr_sequencia_w;
      UPDATE prescr_procedimento
      SET dt_neg_atencip_result   = NULL,
        ds_obs_antecip_result     = NULL,
        nr_seq_mot_anteci_result  = NULL
      WHERE nr_prescricao        = nr_prescricao_w
      AND nr_sequencia           = nr_sequencia_w;
    END;
    EXIT WHEN NOT FOUND; /* apply on C1 */
  END LOOP;
  CLOSE C1;
  COMMIT;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE antecipar_resultado_nr_atend ( nr_atendimento_p bigint, ds_observacao_antecipacao_p text, nr_seq_motivo_antecipacao_p bigint, dt_antecipacao_exame_p timestamp, nm_usuario_p text) FROM PUBLIC;

