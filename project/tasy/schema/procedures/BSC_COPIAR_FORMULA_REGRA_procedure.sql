-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE bsc_copiar_formula_regra ( nm_usuario_p text, nr_seq_formula_p bigint, nr_seq_regra_dest_p bigint) AS $body$
DECLARE


nr_seq_indicador_w		bigint;
ds_comentario_w		varchar(255);
ie_origem_real_w		varchar(15);
ds_sql_w			varchar(4000);
ds_procedure_w		varchar(60);
ie_regra_apuracao_w	varchar(15);
nr_seq_formula_new_w	bigint;
nr_seq_formula_w		bigint;
ie_part_calc_w		varchar(15);
vl_fixo_w			double precision;
nr_seq_calc_w		bigint;
nr_seq_result_w		bigint;
vl_maximo_w		double precision;
vl_minimo_w		double precision;
vl_resultado_w		double precision;
nr_seq_regra_form_w	bigint;
ds_origem_w		varchar(2000);
ds_origem_ww		varchar(2000);
ds_titulo_w		varchar(80);
ie_estab_inf_w		varchar(1);
ie_origem_ctb_w		varchar(15);
nr_seq_mes_ref_w		bigint;
qt_mes_w		smallint;
ie_participacao_calc_w	varchar(15);
nr_seq_ind_ref_w		bigint;

c01 CURSOR FOR
SELECT	a.nr_sequencia,
	a.ie_participacao_calc,
	a.vl_fixo,
	a.nr_seq_ind_ref
from	bsc_regra_formula a
where	 a.nr_seq_regra_calc = nr_seq_formula_p;

c02 CURSOR FOR
SELECT	a.nr_seq_calc,
	a.nr_seq_result,
	a.vl_maximo,
	a.vl_minimo,
	a.vl_resultado
from	bsc_regra_form_item a
where	a.nr_seq_formula = nr_seq_formula_w;

c03 CURSOR FOR
SELECT	a.ds_origem,
	a.ds_titulo,
	a.ie_estab_inf,
	a.ie_origem_ctb,
	a.nr_seq_mes_ref,
	a.qt_mes
from	bsc_regra_ctb_esp a
where	a.nr_seq_regra_calc = nr_seq_formula_p;


BEGIN
select	a.nr_seq_indicador,
	a.ds_comentario,
	a.ie_origem_real,
	a.ds_sql,
	a.ds_procedure,
	a.nr_seq_calc,
	a.ie_regra_apuracao,
	a.ie_origem_ctb,
	a.ds_origem
into STRICT	nr_seq_indicador_w,
	ds_comentario_w,
	ie_origem_real_w,
	ds_sql_w,
	ds_procedure_w,
	nr_seq_calc_w,
	ie_regra_apuracao_w,
	ie_origem_ctb_w,
	ds_origem_w
from	bsc_regra_calc_ind a
where	a.nr_sequencia = nr_seq_formula_p;

select	nextval('bsc_regra_calc_ind_seq')
into STRICT	nr_seq_formula_new_w
;

insert into	bsc_regra_calc_ind(nr_sequencia,
			nr_seq_regra,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_indicador,
			ds_comentario,
			ie_origem_real,
			ds_sql,
			ds_procedure,
			nr_seq_calc,
			ie_regra_apuracao,
			ie_origem_ctb,
			ds_origem)
		values (	nr_seq_formula_new_w,
			nr_seq_regra_dest_p,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_indicador_w,
			ds_comentario_w,
			ie_origem_real_w,
			ds_sql_w,
			ds_procedure_w,
			nr_seq_calc_w,
			ie_regra_apuracao_w,
			ie_origem_ctb_w,
			ds_origem_w);
open C01;
loop
fetch C01 into
	nr_seq_formula_w,
	ie_participacao_calc_w,
	vl_fixo_w,
	nr_seq_ind_ref_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin
	select	nextval('bsc_regra_formula_seq')
	into STRICT	nr_seq_regra_form_w
	;

	insert into bsc_regra_formula(	nr_sequencia,
				nr_seq_regra_calc,
				dt_atualizacao,
				nm_usuario,
				dt_atualizacao_nrec,
				nm_usuario_nrec,
				ie_participacao_calc,
				nr_seq_ind_ref,
				vl_fixo)
			values (	nr_seq_regra_form_w,
				nr_seq_formula_new_w,
				clock_timestamp(),
				nm_usuario_p,
				clock_timestamp(),
				nm_usuario_p,
				ie_participacao_calc_w,
				nr_seq_ind_ref_w,
				vl_fixo_w);
	open C02;
	loop
	fetch C02 into
		nr_seq_calc_w,
		nr_seq_result_w,
		vl_maximo_w,
		vl_minimo_w,
		vl_resultado_w;
	EXIT WHEN NOT FOUND; /* apply on C02 */
		begin
		insert into bsc_regra_form_item(	nr_sequencia,
						nr_seq_formula,
						dt_atualizacao,
						nm_usuario,
						dt_atualizacao_nrec,
						nm_usuario_nrec,
						nr_seq_calc,
						nr_seq_result,
						vl_minimo,
						vl_maximo,
						vl_resultado)
					values (	nextval('bsc_regra_form_item_seq'),
						nr_seq_regra_form_w,
						clock_timestamp(),
						nm_usuario_p,
						clock_timestamp(),
						nm_usuario_p,
						nr_seq_calc_w,
						nr_seq_result_w,
						vl_minimo_w,
						vl_maximo_w,
						vl_resultado_w);
		end;
	end loop;
	close C02;
	end;
end loop;
close C01;

open C03;
loop
fetch C03 into
	ds_origem_ww,
	ds_titulo_w,
	ie_estab_inf_w,
	ie_origem_ctb_w,
	nr_seq_mes_ref_w,
	qt_mes_w;
EXIT WHEN NOT FOUND; /* apply on C03 */
	begin
	insert into bsc_regra_ctb_esp(nr_sequencia,
				dt_atualizacao,
				nm_usuario,
				dt_atualizacao_nrec,
				nm_usuario_nrec,
				ie_origem_ctb,
				ds_origem,
				nr_seq_regra_calc,
				qt_mes,
				ds_titulo,
				nr_seq_mes_ref,
				ie_estab_inf)
			values (	nextval('bsc_regra_ctb_esp_seq'),
				clock_timestamp(),
				nm_usuario_p,
				clock_timestamp(),
				nm_usuario_p,
				ie_origem_ctb_w,
				ds_origem_ww,
				nr_seq_formula_new_w,
				qt_mes_w,
				ds_titulo_w,
				nr_seq_mes_ref_w,
				ie_estab_inf_w);
	end;
end loop;
close C03;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE bsc_copiar_formula_regra ( nm_usuario_p text, nr_seq_formula_p bigint, nr_seq_regra_dest_p bigint) FROM PUBLIC;

