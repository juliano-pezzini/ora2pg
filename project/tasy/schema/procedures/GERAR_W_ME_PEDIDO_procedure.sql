-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_w_me_pedido ( datapedido_p text, horapedido_p text, idurl_p text, idbase_p text, empresa_p text, filial_p text, codigofornecedor_p text, setor_p text, dataprevistaentrega_p text, codigocondicaopagamento_p text, numerorequisicao_p text, numeropedidowpd_p text, numeropedidome_p text, tipoprocesso_p text, valorfrete_p bigint, tipofrete_p text, nm_usuario_p text, nr_seq_pedido_p INOUT bigint) AS $body$
DECLARE


nr_seq_me_pedido_w	bigint;
datapedido_w 		timestamp;
horapedido_w		timestamp;
dataprevistaentrega_w	timestamp;
numerorequisicao_w	bigint;


BEGIN

datapedido_w := to_date(substr(replace(datapedido_p,'-','/'),1,10),'yyyy-mm-dd');
horapedido_w := to_date(substr(horapedido_p,12,8), 'hh24:mi:ss');
dataprevistaentrega_w := to_date(substr(replace(dataprevistaentrega_p,'-','/'),1,10),'yyyy-mm-dd');
numerorequisicao_w := somente_numero(numerorequisicao_p);

CALL inserir_log_me('SC', substr(numeropedidowpd_p||'@',1,position('@' in numeropedidowpd_p||'@')-1), 'AVISO', 'ROC', (WHEB_MENSAGEM_PCK.get_texto(149602) || ' ' || numeropedidowpd_p), '144', nm_usuario_p,'');
/* Geração da ordem de compra */

select	nextval('w_me_pedido_seq')
into STRICT	nr_seq_me_pedido_w
;

insert into w_me_pedido(	/*Recebimento dos pedidos do Mercado Eletrônico*/
	nr_sequencia,
	dt_atualizacao,
	nm_usuario,
	dt_atualizacao_nrec,
	nm_usuario_nrec,
	datapedido,
	horapedido,
	idurl,
	idbase,
	empresa,
	filial,
	codigofornecedor,
	setor,
	dataprevistaentrega,
	codigocondicaopagamento,
	numerorequisicao,
	numeropedidowpd,
	numeropedidome,
	tipoprocesso,
	valorfrete,
	tipofrete,
	ie_lido)
values (	nr_seq_me_pedido_w,
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	datapedido_w,
	horapedido_w,
	idurl_p,
	idbase_p,
	empresa_p,
	filial_p,
	codigofornecedor_p,
	setor_p,
	dataprevistaentrega_w,
	codigocondicaopagamento_p,
	numerorequisicao_w,
	numeropedidowpd_p,
	numeropedidome_p,
	tipoprocesso_p,
	valorfrete_p,
	tipofrete_p,
	'N');

nr_seq_pedido_p := nr_seq_me_pedido_w;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_w_me_pedido ( datapedido_p text, horapedido_p text, idurl_p text, idbase_p text, empresa_p text, filial_p text, codigofornecedor_p text, setor_p text, dataprevistaentrega_p text, codigocondicaopagamento_p text, numerorequisicao_p text, numeropedidowpd_p text, numeropedidome_p text, tipoprocesso_p text, valorfrete_p bigint, tipofrete_p text, nm_usuario_p text, nr_seq_pedido_p INOUT bigint) FROM PUBLIC;

