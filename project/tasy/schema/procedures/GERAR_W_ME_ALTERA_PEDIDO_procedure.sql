-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_w_me_altera_pedido ( datapedido_p text, horapedido_p text, idurl_p text, idbase_p text, empresa_p text, filial_p text, codigofornecedor_p text, setor_p text, dataprevistaentrega_p text, codigocondicaopagamento_p text, numeropedidowpd_p text, numeropedidome_p text, observacao_p text, tipoprocesso_p text, valorfrete_p bigint, tipofrete_p text, nm_usuario_p text, nr_seq_pedido_p INOUT text) AS $body$
DECLARE


nr_seq_me_altera_pedido_w	bigint;

datapedido_w 			timestamp;
horapedido_w			timestamp;
dataprevistaentrega_w	timestamp;
tipofrete_W		varchar(1);


BEGIN

datapedido_w := to_date(substr(replace(datapedido_p,'-','/'),1,10),'yyyy-mm-dd');
horapedido_w := to_date(substr(horapedido_p,12,8), 'hh24:mi:ss');
dataprevistaentrega_w := to_date(substr(replace(dataprevistaentrega_p,'-','/'),1,10),'yyyy-mm-dd');

CALL inserir_log_me('OC', substr(numeropedidowpd_p||'@',1,position('@' in numeropedidowpd_p||'@')-1), 'AVISO', 'ROC', (WHEB_MENSAGEM_PCK.get_texto(249521) || ' ' || numeropedidowpd_p), '134', nm_usuario_p,'');
/* Alterar dados da ordem de compra */

select	obter_conversao_interna_int(null,'ORDEM_COMPRA','IE_FRETE',tipofrete_p,'ME')
into STRICT	tipofrete_W
;

select	nextval('w_me_altera_pedido_seq')
into STRICT	nr_seq_me_altera_pedido_w
;

insert into w_me_altera_pedido(
	nr_sequencia,
	dt_atualizacao,
	nm_usuario,
	dt_atualizacao_nrec,
	nm_usuario_nrec,
	datapedido,
	horapedido,
	idurl,
	idbase,
	empresa,
	filial,
	codigofornecedor,
	setor,
	dataprevistaentrega,
	codigocondicaopagamento,
	numeropedidowpd,
	numeropedidome,
	observacao,
	tipoprocesso,
	valorfrete,
	tipofrete,
	ie_lido)
values (	nr_seq_me_altera_pedido_w,
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	datapedido_w,
	horapedido_w,
	idurl_p,
	idbase_p,
	empresa_p,
	filial_p,
	codigofornecedor_p,
	setor_p,
	dataprevistaentrega_w,
	codigocondicaopagamento_p,
	numeropedidowpd_p,
	numeropedidome_p,
	observacao_p,
	tipoprocesso_p,
	valorfrete_p,
	tipofrete_w,
	'N');

nr_seq_pedido_p:= nr_seq_me_altera_pedido_w;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_w_me_altera_pedido ( datapedido_p text, horapedido_p text, idurl_p text, idbase_p text, empresa_p text, filial_p text, codigofornecedor_p text, setor_p text, dataprevistaentrega_p text, codigocondicaopagamento_p text, numeropedidowpd_p text, numeropedidome_p text, observacao_p text, tipoprocesso_p text, valorfrete_p bigint, tipofrete_p text, nm_usuario_p text, nr_seq_pedido_p INOUT text) FROM PUBLIC;

