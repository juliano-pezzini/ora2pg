-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_log_processo_aprov ( nr_seq_aprovacao_p bigint, nr_seq_proc_aprov_p bigint, dt_inicio_log_p timestamp, ie_evento_p text, nm_usuario_p text, ds_log_p text default '') AS $body$
DECLARE


/*
ie_evento_p
A - Refere-se a Aprovação
R - Refere-se a Reprovação*/
nr_seq_log_w		bigint;
nr_seq_aprovacao_w	processo_aprov_compra.nr_sequencia%type;


BEGIN


select	coalesce(max(nr_sequencia),0)
into STRICT	nr_seq_aprovacao_w
from	processo_aprov_compra
where	nr_sequencia = nr_seq_aprovacao_p
and	nr_seq_proc_aprov =nr_seq_proc_aprov_p;

if (coalesce(nr_seq_aprovacao_w,0) = 0) then
	CALL Wheb_mensagem_pck.exibir_mensagem_abort(333379);
end if;

select	nextval('log_processo_aprovacao_seq')
into STRICT	nr_seq_log_w
;

insert into log_processo_aprovacao(
	nr_sequencia,
	dt_atualizacao_nrec,
	nm_usuario_nrec,
	nr_seq_aprovacao,
	nr_seq_proc_aprov,
	dt_inicio_gravacao,
	dt_final_gravacao,
	ie_evento,
	ds_log)
values (	nr_seq_log_w,
	clock_timestamp(),
	nm_usuario_p,
	nr_seq_aprovacao_p,
	nr_seq_proc_aprov_p,
	dt_inicio_log_p,
	clock_timestamp(),
	ie_evento_p,
	ds_log_p);



commit;


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_log_processo_aprov ( nr_seq_aprovacao_p bigint, nr_seq_proc_aprov_p bigint, dt_inicio_log_p timestamp, ie_evento_p text, nm_usuario_p text, ds_log_p text default '') FROM PUBLIC;

