-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_obter_reg_escrit_quotas ( ie_tipo_p text, dt_lancamento_p text, nm_usuario_p text, nr_seq_conta_banco_p INOUT bigint, nr_seq_carteira_cobr_p INOUT bigint, nr_seq_trans_fin_contab_p INOUT bigint, nr_seq_trans_fin_baixa_p INOUT bigint) AS $body$
DECLARE


dt_lancamento_w		timestamp;


BEGIN
dt_lancamento_w		:= to_date(dt_lancamento_p, 'dd/mm/yy');

select	max(a.nr_seq_conta_banco),
	max(a.nr_seq_carteira_cobr),
	max(a.nr_seq_trans_fin_contab),
	max(a.nr_seq_trans_fin_baixa)
into STRICT	nr_seq_conta_banco_p,
	nr_seq_carteira_cobr_p,
	nr_seq_trans_fin_contab_p,
	nr_seq_trans_fin_baixa_p
from	pls_regra_tit_escrit_quota a
where	a.ie_pagar_receber = ie_tipo_p
and	dt_lancamento_w between trunc(coalesce(a.dt_inicio_vigencia,dt_lancamento_w),'dd') and fim_dia(coalesce(a.dt_fim_vigencia,dt_lancamento_w));

if (coalesce(nr_seq_conta_banco_p::text, '') = '') and (coalesce(nr_seq_carteira_cobr_p::text, '') = '') and (coalesce(nr_seq_trans_fin_contab_p::text, '') = '') and (coalesce(nr_seq_trans_fin_baixa_p::text, '') = '') then
	CALL wheb_mensagem_pck.exibir_mensagem_abort( 267335, null ); /* Favor verificar os parâmetros na pasta Regra escrituração de quotas. */
end if;

--Não tem commit
--commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_obter_reg_escrit_quotas ( ie_tipo_p text, dt_lancamento_p text, nm_usuario_p text, nr_seq_conta_banco_p INOUT bigint, nr_seq_carteira_cobr_p INOUT bigint, nr_seq_trans_fin_contab_p INOUT bigint, nr_seq_trans_fin_baixa_p INOUT bigint) FROM PUBLIC;

