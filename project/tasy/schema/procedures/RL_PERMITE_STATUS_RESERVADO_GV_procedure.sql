-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE rl_permite_status_reservado_gv ( cd_paciente_reserva_p text, nr_seq_unidade_p bigint, ds_motivo_reserva_p text, cd_estabelecimento_p bigint, nm_usuario_p text ) AS $body$
DECLARE

 
ie_reserva_paciente_w		varchar(1) := 'N';
ie_consiste_sexo_unid_w 	varchar(1) := 'N';
ie_permite_status_rese_gv_w	varchar(1) := 'N';
					

BEGIN 
 
ie_permite_status_rese_gv_w := obter_param_usuario(44, 180, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, ie_permite_status_rese_gv_w);
ie_consiste_sexo_unid_w := obter_param_usuario(44, 188, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, ie_consiste_sexo_unid_w);
 
if (ie_permite_status_rese_gv_w = 'S') and (cd_paciente_reserva_p IS NOT NULL AND cd_paciente_reserva_p::text <> '') then 
	begin 
	 
	ie_reserva_paciente_w := verifica_reserva_paciente(cd_paciente_reserva_p);
	 
	if (ie_reserva_paciente_w = 'S') then 
		begin 
		 
		CALL altera_status_gv_aguardando(cd_paciente_reserva_p,nm_usuario_p);
		 
		commit;
		end;
	end if;
	end;
end if;
 
if (ie_consiste_sexo_unid_w = 'J') then 
	begin 
	 
	CALL atualiza_justif_res_sexo_dif(nr_seq_unidade_p,nm_usuario_p,ds_motivo_reserva_p);
	 
	end;
end if;
 
 
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE rl_permite_status_reservado_gv ( cd_paciente_reserva_p text, nr_seq_unidade_p bigint, ds_motivo_reserva_p text, cd_estabelecimento_p bigint, nm_usuario_p text ) FROM PUBLIC;

