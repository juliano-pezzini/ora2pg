-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consistir_revisao_cad_pf ( cd_estabelecimento_p bigint, nm_usuario_p text, cd_pessoa_fisica_p text, ds_revisao_p INOUT text) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [  ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
	Parâmetro 5 - [41] - Número de dias para alerta de revisão do cadastro
-------------------------------------------------------------------------------------------------------------------
Referências:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
qt_dia_revisao_w	bigint;
dt_ult_revisao_w	timestamp;
ds_revisao_w		varchar(255);


BEGIN
ds_revisao_w := '';
if (cd_estabelecimento_p IS NOT NULL AND cd_estabelecimento_p::text <> '') and (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') and (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') then
	qt_dia_revisao_w	:= coalesce(obter_valor_param_usuario(5, 41, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p), 0);

	if (qt_dia_revisao_w > 0) then
		/* obter ultima revisao */

		select	max(dt_revisao)
		into STRICT	dt_ult_revisao_w
		from	pessoa_fisica
		where	cd_pessoa_fisica	= cd_pessoa_fisica_p;

		if (dt_ult_revisao_w IS NOT NULL AND dt_ult_revisao_w::text <> '') and
			((trunc(clock_timestamp()) - trunc(dt_ult_revisao_w)) >= qt_dia_revisao_w) then
			-- Atenção: A última revisão deste cadastro foi realizada em #@DT_ULT_REVISAO_W#@. Se possível, por favor, atualize os dados do mesmo novamente e registre a sua revisão!
			ds_revisao_w	:= wheb_mensagem_pck.get_texto(306448, 'DT_ULT_REVISAO_W=' || to_char(dt_ult_revisao_w, pkg_date_formaters.localize_mask('shortDate',pkg_date_formaters.getUserLanguageTag(cd_estabelecimento_p,nm_usuario_p))));
		end if;
	end if;
end if;

ds_revisao_p	:= ds_revisao_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consistir_revisao_cad_pf ( cd_estabelecimento_p bigint, nm_usuario_p text, cd_pessoa_fisica_p text, ds_revisao_p INOUT text) FROM PUBLIC;

