-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE tws_insert_addic_contact ( CD_PESSOA_FISICA_P bigint, NR_SEQ_COMPL_P bigint, NR_TELEFONE_P text, NR_DDD_TELEFONE_P text, NR_DDD_CELULAR_P text, NR_TELEFONE_CELULAR_P text, NR_DDI_TELEFONE_P text, NM_USUARIO_P text, IS_DELETE_P text DEFAULT 'false', DS_STATUS INOUT text  DEFAULT NULL) AS $body$
DECLARE

  NR_SEQ_COMPL_W bigint;
  NR_MAX_SEQ_W   bigint;
  COUNT_W        bigint;

BEGIN
  IF (IS_DELETE_P = 'false') then
	  SELECT COUNT(*)
	  INTO STRICT COUNT_W
	  FROM COMPL_PESSOA_FISICA
	  WHERE CD_PESSOA_FISICA  = CD_PESSOA_FISICA_P
	  AND IE_TIPO_COMPLEMENTO = NR_SEQ_COMPL_P;
	  SELECT coalesce(MAX(NR_SEQUENCIA),0) INTO STRICT NR_MAX_SEQ_W FROM COMPL_PESSOA_FISICA;
	  IF COUNT_W > 0 THEN
		UPDATE COMPL_PESSOA_FISICA
		SET NR_TELEFONE         = NR_TELEFONE_P,
		  NR_DDD_TELEFONE       = NR_DDD_TELEFONE_P,
		  NR_DDD_CELULAR        = NR_DDD_CELULAR_P,
		  NR_TELEFONE_CELULAR   = NR_TELEFONE_CELULAR_P,
		  NR_DDI_TELEFONE       = NR_DDI_TELEFONE_P,
		  DT_ATUALIZACAO        = clock_timestamp(),
		  NM_USUARIO            = NM_USUARIO_P
		WHERE CD_PESSOA_FISICA  = CD_PESSOA_FISICA_P
		AND IE_TIPO_COMPLEMENTO = NR_SEQ_COMPL_P;
		DS_STATUS              := 'UPDATED';
	  ELSE
		IF (CD_PESSOA_FISICA_P IS NOT NULL AND CD_PESSOA_FISICA_P::text <> '') THEN
		  INSERT
		  INTO COMPL_PESSOA_FISICA(
			  NR_SEQUENCIA,
			  DT_ATUALIZACAO_NREC,
			  NM_USUARIO_NREC,
			  DT_ATUALIZACAO,
			  NM_USUARIO,
			  CD_PESSOA_FISICA,
			  IE_TIPO_COMPLEMENTO,
			  NR_TELEFONE,
			  NR_DDD_TELEFONE,
			  NR_DDD_CELULAR,
			  NR_TELEFONE_CELULAR,
			  NR_DDI_TELEFONE
			)
			VALUES (
			  NR_MAX_SEQ_W + 1,
			  clock_timestamp(),
			  NM_USUARIO_P,
			  clock_timestamp(),
			  NM_USUARIO_P,
			  CD_PESSOA_FISICA_P,
			  NR_SEQ_COMPL_P,
			  NR_TELEFONE_P,
			  NR_DDD_TELEFONE_P,
			  NR_DDD_CELULAR_P,
			  NR_TELEFONE_CELULAR_P,
			  NR_DDI_TELEFONE_P
			);
		  DS_STATUS := 'INSERTED';
		END IF;
	  END IF;
  ELSE
	DELETE FROM COMPL_PESSOA_FISICA WHERE CD_PESSOA_FISICA = CD_PESSOA_FISICA_P AND IE_TIPO_COMPLEMENTO = NR_SEQ_COMPL_P;
	DS_STATUS := 'DELETED';
  END IF;
  COMMIT;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tws_insert_addic_contact ( CD_PESSOA_FISICA_P bigint, NR_SEQ_COMPL_P bigint, NR_TELEFONE_P text, NR_DDD_TELEFONE_P text, NR_DDD_CELULAR_P text, NR_TELEFONE_CELULAR_P text, NR_DDI_TELEFONE_P text, NM_USUARIO_P text, IS_DELETE_P text DEFAULT 'false', DS_STATUS INOUT text  DEFAULT NULL) FROM PUBLIC;

