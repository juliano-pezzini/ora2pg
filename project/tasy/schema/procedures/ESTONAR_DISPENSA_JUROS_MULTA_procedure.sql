-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE estonar_dispensa_juros_multa ( nr_titulo_p bigint, nr_sequencia_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE


/*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: Estonar a dispensa de juros multa pela função do Call Center
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [X] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/vl_movimento_w		double precision;
cd_moeda_w		integer;
ie_juros_multa_w	varchar(1);
cd_motivo_w		integer;
nr_seq_titulo_w		bigint;
nr_seq_trans_fin_w	bigint;
ie_acao_w		varchar(1);


BEGIN
begin
select	vl_movimento,
	cd_moeda,
	ie_juros_multa,
	CASE WHEN ie_juros_multa='J' THEN 10  ELSE 11 END ,
	nr_seq_trans_fin,
	ie_acao
into STRICT	vl_movimento_w,
	cd_moeda_w,
	ie_juros_multa_w,
	cd_motivo_w,
	nr_seq_trans_fin_w,
	ie_acao_w
from	titulo_juros_multa
where	nr_titulo	= nr_titulo_p
and	nr_sequencia	= nr_sequencia_p;
exception
when others then
	null;
end;

if (ie_acao_w = 'E') then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(232370);
end if;

select	coalesce(max(nr_sequencia),0) + 1
into STRICT	nr_seq_titulo_w
from	titulo_juros_multa
where	nr_titulo = nr_titulo_p;

insert	into titulo_juros_multa(nr_sequencia,
	nr_titulo,
	cd_moeda,
	cd_motivo,
	ie_juros_multa,
	ie_acao,
	vl_movimento,
	dt_movimento,
	dt_atualizacao,
	nm_usuario,
	nr_lote_contabil,
	nr_seq_trans_fin)
values (nr_seq_titulo_w,
	nr_titulo_p,
	cd_moeda_w,
	cd_motivo_w,
	ie_juros_multa_w,
	'E',
	vl_movimento_w,
	clock_timestamp(),
	clock_timestamp(),
	nm_usuario_p,
	0,
	nr_seq_trans_fin_w);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE estonar_dispensa_juros_multa ( nr_titulo_p bigint, nr_sequencia_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

