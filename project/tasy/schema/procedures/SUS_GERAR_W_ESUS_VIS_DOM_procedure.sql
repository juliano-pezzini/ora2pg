-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE sus_gerar_w_esus_vis_dom ( nr_seq_lote_p esus_lote_envio.nr_sequencia%type, ie_tipo_lote_esus_p esus_lote_envio.ie_tipo_lote_esus%type, cd_cnes_estab_p estabelecimento.cd_cns%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE


cd_cns_paciente_w		w_esus_visita_domiciliar.cd_cns_paciente%type;				
dt_nascimento_paciente_w	w_esus_visita_domiciliar.dt_nascimento_paciente%type;					
cd_uuid_original_w		w_esus_visita_domiciliar.cd_uuid_original%type;					
cd_cns_profissional_w		w_esus_visita_domiciliar.cd_cns_profissional%type;
nr_seq_exp_w			w_esus_visita_domiciliar.nr_sequencia%type;
cd_micro_area_w			w_esus_visita_domiciliar.cd_micro_area%type;
ie_fora_area_w			w_esus_visita_domiciliar.ie_fora_area%type;
nr_atendimento_w		w_esus_visita_domiciliar.nr_atendimento%type;
ie_tipo_imovel_w		w_esus_visita_domiciliar.ie_tipo_imovel%type;
ie_acao_educativa_w		w_esus_visita_domiciliar.ie_acao_educativa%type;
ie_imovel_foco_w		w_esus_visita_domiciliar.ie_imovel_foco%type;
ie_acao_mecanica_w		w_esus_visita_domiciliar.ie_acao_mecanica%type;
ie_tratamento_focal_w		w_esus_visita_domiciliar.ie_tratamento_focal%type;
nr_data_nasc_paci_w		w_esus_visita_domiciliar.nr_data_nasc_paci%type;
nr_data_atendimento_w		w_esus_visita_domiciliar.nr_data_atendimento%type;
ie_sexo_paciente_w		w_esus_visita_domiciliar.nr_data_atendimento%type;
qt_peso_w			w_esus_visita_domiciliar.qt_peso%type;
qt_altura_w			w_esus_visita_domiciliar.qt_altura%type;

nr_sequencia_w			esus_visita_domiciliar.nr_sequencia%type;
cd_estabelecimento_w		esus_visita_domiciliar.cd_estabelecimento%type;
dt_atualizacao_w		esus_visita_domiciliar.dt_atualizacao%type;
nm_usuario_w			esus_visita_domiciliar.nm_usuario%type;
dt_atualizacao_nrec_w		esus_visita_domiciliar.dt_atualizacao_nrec%type;
nm_usuario_nrec_w		esus_visita_domiciliar.nm_usuario_nrec%type;
cd_profissional_w		esus_visita_domiciliar.cd_profissional%type;
cd_cbo_w			esus_visita_domiciliar.cd_cbo%type;
cd_cnes_unidade_w		esus_visita_domiciliar.cd_cnes_unidade%type;
cd_cnes_unidade_ww		esus_visita_domiciliar.cd_cnes_unidade%type;
nr_seq_sus_equipe_w		esus_visita_domiciliar.nr_seq_sus_equipe%type;
dt_atendimento_w		esus_visita_domiciliar.dt_atendimento%type;
dt_liberacao_w			esus_visita_domiciliar.dt_liberacao%type;
cd_pessoa_fisica_w		esus_visita_domiciliar.cd_pessoa_fisica%type;
nr_prontuario_w			esus_visita_domiciliar.nr_prontuario%type;
ie_turno_w			esus_visita_domiciliar.ie_turno%type;
ie_visita_comp_profi_w		esus_visita_domiciliar.ie_visita_comp_profi%type;
ie_mot_vis_cad_atual_w		esus_visita_domiciliar.ie_mot_vis_cad_atual%type;
ie_mot_vis_periodica_w		esus_visita_domiciliar.ie_mot_vis_periodica%type;
ie_busca_at_consulta_w		esus_visita_domiciliar.ie_busca_at_consulta%type;
ie_busca_ativa_exame_w		esus_visita_domiciliar.ie_busca_ativa_exame%type;
ie_busca_ativ_vacina_w		esus_visita_domiciliar.ie_busca_ativ_vacina%type;
ie_bus_at_con_bol_fa_w		esus_visita_domiciliar.ie_bus_at_con_bol_fa%type;
ie_acomp_gestante_w		esus_visita_domiciliar.ie_acomp_gestante%type;
ie_acomp_puerpera_w		esus_visita_domiciliar.ie_acomp_puerpera%type;
ie_acomp_rec_nascido_w		esus_visita_domiciliar.ie_acomp_rec_nascido%type;
ie_acomp_crianca_w		esus_visita_domiciliar.ie_acomp_crianca%type;
ie_acomp_pes_desnutr_w		esus_visita_domiciliar.ie_acomp_pes_desnutr%type;
ie_acomp_pes_rea_def_w		esus_visita_domiciliar.ie_acomp_pes_rea_def%type;
ie_acomp_pes_hiperte_w		esus_visita_domiciliar.ie_acomp_pes_hiperte%type;
ie_acomp_pes_diabete_w		esus_visita_domiciliar.ie_acomp_pes_diabete%type;
ie_acomp_pessoa_asma_w		esus_visita_domiciliar.ie_acomp_pessoa_asma%type;
ie_acomp_pessoa_dpoc_w		esus_visita_domiciliar.ie_acomp_pessoa_dpoc%type;
ie_acomp_pess_cancer_w		esus_visita_domiciliar.ie_acomp_pess_cancer%type;
ie_acomp_pes_doe_cro_w		esus_visita_domiciliar.ie_acomp_pes_doe_cro%type;
ie_acomp_pes_hanseni_w		esus_visita_domiciliar.ie_acomp_pes_hanseni%type;
ie_acomp_pes_tubercu_w		esus_visita_domiciliar.ie_acomp_pes_tubercu%type;
ie_acomp_sintom_resp_w		esus_visita_domiciliar.ie_acomp_sintom_resp%type;
ie_acomp_tabagista_w		esus_visita_domiciliar.ie_acomp_tabagista%type;
ie_acomp_domic_acama_w		esus_visita_domiciliar.ie_acomp_domic_acama%type;
ie_acomp_con_vul_soc_w		esus_visita_domiciliar.ie_acomp_con_vul_soc%type;
ie_acomp_con_bol_fam_w		esus_visita_domiciliar.ie_acomp_con_bol_fam%type;
ie_acomp_saude_menta_w		esus_visita_domiciliar.ie_acomp_saude_menta%type;
ie_acomp_usua_alcool_w		esus_visita_domiciliar.ie_acomp_usua_alcool%type;
ie_acomp_usua_drogas_w		esus_visita_domiciliar.ie_acomp_usua_drogas%type;
ie_egress_internacao_w		esus_visita_domiciliar.ie_egress_internacao%type;
ie_contr_ambie_vetor_w		esus_visita_domiciliar.ie_contr_ambie_vetor%type;
ie_conv_ativ_coletiv_w		esus_visita_domiciliar.ie_conv_ativ_coletiv%type;
ie_orienta_prevencao_w		esus_visita_domiciliar.ie_orienta_prevencao%type;
ie_outros_w			esus_visita_domiciliar.ie_outros%type;
ie_desfecho_w			esus_visita_domiciliar.ie_desfecho%type;
nr_seq_lote_envio_w		esus_visita_domiciliar.nr_seq_lote_envio%type;

cd_contra_chave_rem_w		w_esus_header_footer.cd_contra_chave_rem%type;
cd_uuid_instal_rem_w		w_esus_header_footer.cd_uuid_instal_rem%type;
cd_contra_chave_ori_w		w_esus_header_footer.cd_contra_chave_ori%type;
cd_uuid_instal_orig_w		w_esus_header_footer.cd_uuid_instal_orig%type;
cd_municipio_ibge_ww		w_esus_header_footer.cd_municipio_ibge%type;

VisDom CURSOR FOR
	SELECT	nr_sequencia,
		cd_estabelecimento,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		cd_profissional,
		cd_cbo,
		cd_cnes_unidade,
		nr_seq_sus_equipe,
		dt_atendimento,
		dt_liberacao,
		cd_pessoa_fisica,
		nr_prontuario,
		ie_turno,
		ie_visita_comp_profi,
		ie_mot_vis_cad_atual,
		ie_mot_vis_periodica,
		ie_busca_at_consulta,
		ie_busca_ativa_exame,
		ie_busca_ativ_vacina,
		ie_bus_at_con_bol_fa,
		ie_acomp_gestante,
		ie_acomp_puerpera,
		ie_acomp_rec_nascido,
		ie_acomp_crianca,
		ie_acomp_pes_desnutr,
		ie_acomp_pes_rea_def,
		ie_acomp_pes_hiperte,
		ie_acomp_pes_diabete,
		ie_acomp_pessoa_asma,
		ie_acomp_pessoa_dpoc,
		ie_acomp_pess_cancer,
		ie_acomp_pes_doe_cro,
		ie_acomp_pes_hanseni,
		ie_acomp_pes_tubercu,
		ie_acomp_sintom_resp,
		ie_acomp_tabagista,
		ie_acomp_domic_acama,
		ie_acomp_con_vul_soc,
		ie_acomp_con_bol_fam,
		ie_acomp_saude_menta,
		ie_acomp_usua_alcool,
		ie_acomp_usua_drogas,
		ie_egress_internacao,
		ie_contr_ambie_vetor,
		ie_conv_ativ_coletiv,
		ie_orienta_prevencao,
		ie_outros,
		ie_desfecho,
		nr_seq_lote_envio,
		cd_micro_area,
		ie_fora_area,
		nr_atendimento,
		ie_tipo_imovel,
		ie_acao_educativa,
		ie_imovel_foco,
		ie_acao_mecanica,
		ie_tratamento_focal,
		qt_peso,
		qt_altura,
		cd_uuid_original
	from	esus_visita_domiciliar
	where	nr_seq_lote_envio =	nr_seq_lote_p
	order by nr_sequencia;

type 		fetch_array is table of VisDom%rowtype;
s_array 	fetch_array;
i		integer := 1;
type vetor is table of fetch_array index by integer;
vetor_VisDom_w			vetor;

	
BEGIN

delete 	from w_esus_visita_domiciliar
where	nr_seq_lote_envio = nr_seq_lote_p;


open VisDom;
loop
fetch VisDom bulk collect into s_array limit 1000;
	vetor_VisDom_w(i) := s_array;
	i := i + 1;
EXIT WHEN NOT FOUND; /* apply on VisDom */
end loop;
close VisDom;


for i in 1..vetor_VisDom_w.count loop
	begin
	s_array := vetor_VisDom_w(i);
	for z in 1..s_array.count loop
		begin
		
		nr_sequencia_w			:= s_array[z].nr_sequencia;
		cd_estabelecimento_w		:= s_array[z].cd_estabelecimento;
		dt_atualizacao_w		:= s_array[z].dt_atualizacao;
		nm_usuario_w			:= s_array[z].nm_usuario;
		dt_atualizacao_nrec_w		:= s_array[z].dt_atualizacao_nrec;
		nm_usuario_nrec_w		:= s_array[z].nm_usuario_nrec;
		cd_profissional_w		:= s_array[z].cd_profissional;
		cd_cbo_w			:= s_array[z].cd_cbo;
		cd_cnes_unidade_w		:= s_array[z].cd_cnes_unidade;
		nr_seq_sus_equipe_w		:= s_array[z].nr_seq_sus_equipe;
		dt_atendimento_w		:= s_array[z].dt_atendimento;
		dt_liberacao_w			:= s_array[z].dt_liberacao;
		cd_pessoa_fisica_w		:= s_array[z].cd_pessoa_fisica;
		nr_prontuario_w			:= s_array[z].nr_prontuario;
		ie_turno_w			:= s_array[z].ie_turno;
		ie_visita_comp_profi_w		:= s_array[z].ie_visita_comp_profi;
		ie_mot_vis_cad_atual_w		:= s_array[z].ie_mot_vis_cad_atual;
		ie_mot_vis_periodica_w		:= s_array[z].ie_mot_vis_periodica;
		ie_busca_at_consulta_w		:= s_array[z].ie_busca_at_consulta;
		ie_busca_ativa_exame_w		:= s_array[z].ie_busca_ativa_exame;
		ie_busca_ativ_vacina_w		:= s_array[z].ie_busca_ativ_vacina;
		ie_bus_at_con_bol_fa_w		:= s_array[z].ie_bus_at_con_bol_fa;
		ie_acomp_gestante_w		:= s_array[z].ie_acomp_gestante;
		ie_acomp_puerpera_w		:= s_array[z].ie_acomp_puerpera;
		ie_acomp_rec_nascido_w		:= s_array[z].ie_acomp_rec_nascido;
		ie_acomp_crianca_w		:= s_array[z].ie_acomp_crianca;
		ie_acomp_pes_desnutr_w		:= s_array[z].ie_acomp_pes_desnutr;
		ie_acomp_pes_rea_def_w		:= s_array[z].ie_acomp_pes_rea_def;
		ie_acomp_pes_hiperte_w		:= s_array[z].ie_acomp_pes_hiperte;
		ie_acomp_pes_diabete_w		:= s_array[z].ie_acomp_pes_diabete;
		ie_acomp_pessoa_asma_w		:= s_array[z].ie_acomp_pessoa_asma;
		ie_acomp_pessoa_dpoc_w		:= s_array[z].ie_acomp_pessoa_dpoc;
		ie_acomp_pess_cancer_w		:= s_array[z].ie_acomp_pess_cancer;
		ie_acomp_pes_doe_cro_w		:= s_array[z].ie_acomp_pes_doe_cro;
		ie_acomp_pes_hanseni_w		:= s_array[z].ie_acomp_pes_hanseni;
		ie_acomp_pes_tubercu_w		:= s_array[z].ie_acomp_pes_tubercu;
		ie_acomp_sintom_resp_w		:= s_array[z].ie_acomp_sintom_resp;
		ie_acomp_tabagista_w		:= s_array[z].ie_acomp_tabagista;
		ie_acomp_domic_acama_w		:= s_array[z].ie_acomp_domic_acama;
		ie_acomp_con_vul_soc_w		:= s_array[z].ie_acomp_con_vul_soc;
		ie_acomp_con_bol_fam_w		:= s_array[z].ie_acomp_con_bol_fam;
		ie_acomp_saude_menta_w		:= s_array[z].ie_acomp_saude_menta;
		ie_acomp_usua_alcool_w		:= s_array[z].ie_acomp_usua_alcool;
		ie_acomp_usua_drogas_w		:= s_array[z].ie_acomp_usua_drogas;
		ie_egress_internacao_w		:= s_array[z].ie_egress_internacao;
		ie_contr_ambie_vetor_w		:= s_array[z].ie_contr_ambie_vetor;
		ie_conv_ativ_coletiv_w		:= s_array[z].ie_conv_ativ_coletiv;
		ie_orienta_prevencao_w		:= s_array[z].ie_orienta_prevencao;
		ie_outros_w			:= s_array[z].ie_outros;
		ie_desfecho_w			:= s_array[z].ie_desfecho;
		nr_seq_lote_envio_w		:= s_array[z].nr_seq_lote_envio;
		cd_micro_area_w			:= s_array[z].cd_micro_area;
		ie_fora_area_w			:= s_array[z].ie_fora_area;
		nr_atendimento_w		:= s_array[z].nr_atendimento;
		ie_tipo_imovel_w		:= s_array[z].ie_tipo_imovel;
		ie_acao_educativa_w		:= s_array[z].ie_acao_educativa;
		ie_imovel_foco_w		:= s_array[z].ie_imovel_foco;
		ie_acao_mecanica_w		:= s_array[z].ie_acao_mecanica;
		ie_tratamento_focal_w		:= s_array[z].ie_tratamento_focal;
		qt_peso_w			:= s_array[z].qt_peso;
		qt_altura_w			:= s_array[z].qt_altura;
		cd_uuid_original_w		:= s_array[z].cd_uuid_original;

		
		if (coalesce(cd_pessoa_fisica_w,'X') <> 'X') then
			begin
			cd_cns_paciente_w		:= substr(obter_dados_pf(cd_pessoa_fisica_w,'CNS'),1,20);
			dt_nascimento_paciente_w	:= to_date(substr(obter_dados_pf(cd_pessoa_fisica_w,'DN'),1,10),'dd/mm/yyyy');
			ie_sexo_paciente_w		:= substr(sus_gerar_depara_esus(obter_dados_pf(cd_pessoa_fisica_w,'SE'),'SEXO'),1,20);
			end;
		end if;	

		if (dt_nascimento_paciente_w IS NOT NULL AND dt_nascimento_paciente_w::text <> '') then
			nr_data_nasc_paci_w	:=  ((dt_nascimento_paciente_w - CAST(to_timestamp('01-01-1970 00:00:00+00:00','DD-MM-YYYY HH24:MI:SS TZH:TZM') as timestamp)) * 24 * 60 * 60 * 1000);
		else
			nr_data_nasc_paci_w	:= null;
		end if;
		
		if (dt_atendimento_w IS NOT NULL AND dt_atendimento_w::text <> '') then
			nr_data_atendimento_w	:=  ((dt_atendimento_w - CAST(to_timestamp('01-01-1970 00:00:00+00:00','DD-MM-YYYY HH24:MI:SS TZH:TZM') as timestamp)) * 24 * 60 * 60 * 1000);
		else
			nr_data_atendimento_w	:= null;
		end if;
		
		begin
		cd_cns_profissional_w := substr(obter_dados_pf(cd_profissional_w,'CNS'),1,20);		
		exception
		when others then
			cd_cns_profissional_w := '';
		end;
			
		select	nextval('w_esus_visita_domiciliar_seq')
		into STRICT	nr_seq_exp_w
		;		
		
		select	coalesce(max(cd_cnes_unidade),'0')
		into STRICT	cd_cnes_unidade_ww
		from	w_esus_header_footer
		where	nr_seq_lote_envio = nr_seq_lote_p;
		
		if (cd_cnes_unidade_w <> cd_cnes_unidade_ww) then
			begin
			cd_contra_chave_rem_w	:= substr(sus_gerar_uuid_esus(cd_cnes_unidade_w,'C'),1,50);
			cd_uuid_instal_rem_w	:= substr(sus_gerar_uuid_esus(cd_cnes_unidade_w,'U'),1,50);
			cd_contra_chave_ori_w	:= cd_contra_chave_rem_w;
			cd_uuid_instal_orig_w	:= cd_uuid_instal_rem_w;			
			cd_municipio_ibge_ww	:= sus_obter_dados_equipe(nr_seq_sus_equipe_w,'CM');
			cd_municipio_ibge_ww	:= substr(cd_municipio_ibge_ww||Calcula_Digito('MODULO10',cd_municipio_ibge_ww),1,7);
			
			update 	w_esus_header_footer
			set 	cd_cnes_unidade = cd_cnes_unidade_w,
				cd_cnes_serealizado = cd_cnes_unidade_w,
				cd_contra_chave_rem = cd_contra_chave_rem_w,
				cd_uuid_instal_rem = cd_uuid_instal_rem_w,
				cd_contra_chave_ori = cd_contra_chave_ori_w,
				cd_uuid_instal_orig = cd_uuid_instal_orig_w,
				cd_municipio_ibge = cd_municipio_ibge_ww
			where	nr_seq_lote_envio = nr_seq_lote_p;
			
			end;
		end if;
		
		if (coalesce(cd_uuid_original_w,'X') = 'X')  then
			cd_uuid_original_w := coalesce(sus_gerar_uuid_esus(cd_cnes_unidade_w,'U'),'0');
			update esus_visita_domiciliar set cd_uuid_original = cd_uuid_original_w where  nr_sequencia = nr_sequencia_w;
		end if;	
		
		if (ie_tipo_imovel_w in ('2','3','4','5','6','12')) then
			begin
			nr_prontuario_w 	:= '';
			cd_cns_paciente_w	:= '';
			nr_data_nasc_paci_w	:= null;
			ie_sexo_paciente_w	:= '';
			ie_mot_vis_periodica_w	:= '';
			ie_busca_at_consulta_w	:= '';
			ie_busca_ativa_exame_w	:= '';
			ie_busca_ativ_vacina_w	:= '';
			ie_bus_at_con_bol_fa_w	:= '';
			ie_acomp_gestante_w	:= '';
			ie_acomp_puerpera_w	:= '';
			ie_acomp_rec_nascido_w	:= '';
			ie_acomp_crianca_w	:= '';
			ie_acomp_pes_desnutr_w	:= '';
			ie_acomp_pes_rea_def_w	:= '';
			ie_acomp_pes_hiperte_w	:= '';
			ie_acomp_pes_diabete_w	:= '';
			ie_acomp_pessoa_asma_w	:= '';
			ie_acomp_pessoa_dpoc_w	:= '';
			ie_acomp_pess_cancer_w	:= '';
			ie_acomp_pes_doe_cro_w	:= '';
			ie_acomp_pes_hanseni_w	:= '';
			ie_acomp_pes_tubercu_w	:= '';
			ie_acomp_sintom_resp_w	:= '';
			ie_acomp_tabagista_w	:= '';
			ie_acomp_domic_acama_w	:= '';
			ie_acomp_con_vul_soc_w	:= '';
			ie_acomp_con_bol_fam_w	:= '';
			ie_acomp_saude_menta_w	:= '';
			ie_acomp_usua_alcool_w	:= '';
			ie_acomp_usua_drogas_w	:= '';
			ie_egress_internacao_w	:= '';	
			qt_peso_w		:= '';
			qt_altura_w		:= '';
			end;
		end if;
		
		if (ie_desfecho_w in ('2','3')) then
			begin
			ie_mot_vis_cad_atual_w	:= '';
			ie_mot_vis_periodica_w	:= '';
			ie_busca_at_consulta_w	:= '';
			ie_busca_ativa_exame_w	:= '';
			ie_busca_ativ_vacina_w	:= '';
			ie_bus_at_con_bol_fa_w	:= '';
			ie_acomp_gestante_w	:= '';
			ie_acomp_puerpera_w	:= '';
			ie_acomp_rec_nascido_w	:= '';
			ie_acomp_crianca_w	:= '';
			ie_acomp_pes_desnutr_w	:= '';
			ie_acomp_pes_rea_def_w	:= '';
			ie_acomp_pes_hiperte_w	:= '';
			ie_acomp_pes_diabete_w	:= '';
			ie_acomp_pessoa_asma_w	:= '';
			ie_acomp_pessoa_dpoc_w	:= '';
			ie_acomp_pess_cancer_w	:= '';
			ie_acomp_pes_doe_cro_w	:= '';
			ie_acomp_pes_hanseni_w	:= '';
			ie_acomp_pes_tubercu_w	:= '';
			ie_acomp_sintom_resp_w	:= '';
			ie_acomp_tabagista_w	:= '';
			ie_acomp_domic_acama_w	:= '';
			ie_acomp_con_vul_soc_w	:= '';
			ie_acomp_con_bol_fam_w	:= '';
			ie_acomp_saude_menta_w	:= '';
			ie_acomp_usua_alcool_w	:= '';
			ie_acomp_usua_drogas_w	:= '';
			ie_egress_internacao_w	:= '';
			ie_conv_ativ_coletiv_w	:= '';
			ie_orienta_prevencao_w	:= '';
			ie_outros_w		:= '';
			ie_acao_educativa_w	:= '';
			ie_imovel_foco_w	:= '';
			ie_acao_mecanica_w	:= '';
			ie_tratamento_focal_w	:= '';
			qt_peso_w		:= '';
			qt_altura_w		:= '';
			end;
		end if;
		
		if (coalesce(ie_fora_area_w,'X') = 'S') then
			cd_micro_area_w	:= '';
			ie_fora_area_w	:= 'S';
		else
			ie_fora_area_w	:= 'N';		
		end if;	
		
		insert into w_esus_visita_domiciliar(	nr_sequencia,
						nr_seq_ficha,
						cd_estabelecimento,
						dt_atualizacao,
						nm_usuario,
						dt_atualizacao_nrec,
						nm_usuario_nrec,
						cd_profissional,
						cd_cbo,
						nr_seq_sus_equipe,
						dt_atendimento,
						cd_pessoa_fisica,
						nr_prontuario,
						ie_turno,
						ie_visita_comp_profi,
						ie_mot_vis_cad_atual,
						ie_mot_vis_periodica,
						ie_busca_at_consulta,
						ie_busca_ativa_exame,
						ie_busca_ativ_vacina,
						ie_bus_at_con_bol_fa,
						ie_acomp_gestante,
						ie_acomp_puerpera,
						ie_acomp_rec_nascido,
						ie_acomp_crianca,
						ie_acomp_pes_desnutr,
						ie_acomp_pes_rea_def,
						ie_acomp_pes_hiperte,
						ie_acomp_pes_diabete,
						ie_acomp_pessoa_asma,
						ie_acomp_pessoa_dpoc,
						ie_acomp_pess_cancer,
						ie_acomp_pes_doe_cro,
						ie_acomp_pes_hanseni,
						ie_acomp_pes_tubercu,
						ie_acomp_sintom_resp,
						ie_acomp_tabagista,
						ie_acomp_domic_acama,
						ie_acomp_con_vul_soc,
						ie_acomp_con_bol_fam,
						ie_acomp_saude_menta,
						ie_acomp_usua_alcool,
						ie_acomp_usua_drogas,
						ie_egress_internacao,
						ie_contr_ambie_vetor,
						ie_conv_ativ_coletiv,
						ie_orienta_prevencao,
						ie_outros,
						ie_desfecho,
						nr_seq_lote_envio,
						cd_cns_paciente,
						dt_nascimento_paciente,
						cd_cns_profissional,
						cd_uuid_original,
						cd_cnes_unidade,
						cd_micro_area,
						ie_fora_area,
						nr_atendimento,
						ie_tipo_imovel,
						ie_acao_educativa,
						ie_imovel_foco,
						ie_acao_mecanica,
						ie_tratamento_focal,
						qt_peso,
						qt_altura,
						nr_data_nasc_paci,
						nr_data_atendimento,
						ie_sexo_paciente)
				values (	nr_seq_exp_w,
						nr_sequencia_w,
						cd_estabelecimento_w,
						dt_atualizacao_w,
						nm_usuario_w,
						dt_atualizacao_nrec_w,
						nm_usuario_nrec_w,
						cd_profissional_w,
						cd_cbo_w,
						nr_seq_sus_equipe_w,
						dt_atendimento_w,
						cd_pessoa_fisica_w,
						nr_prontuario_w,
						ie_turno_w,
						CASE WHEN ie_visita_comp_profi_w='S' THEN 'true' WHEN ie_visita_comp_profi_w='N' THEN 'false'  ELSE '' END ,
						CASE WHEN ie_mot_vis_cad_atual_w='S' THEN '1'  ELSE '' END ,
						CASE WHEN ie_mot_vis_periodica_w='S' THEN '29'  ELSE '' END ,
						CASE WHEN ie_busca_at_consulta_w='S' THEN '2'  ELSE '' END ,
						CASE WHEN ie_busca_ativa_exame_w='S' THEN '3'  ELSE '' END ,
						CASE WHEN ie_busca_ativ_vacina_w='S' THEN '4'  ELSE '' END ,
						CASE WHEN ie_bus_at_con_bol_fa_w='S' THEN '30'  ELSE '' END ,
						CASE WHEN ie_acomp_gestante_w='S' THEN '5'  ELSE '' END ,
						CASE WHEN ie_acomp_puerpera_w='S' THEN '6'  ELSE '' END ,
						CASE WHEN ie_acomp_rec_nascido_w='S' THEN '7'  ELSE '' END ,
						CASE WHEN ie_acomp_crianca_w='S' THEN '8'  ELSE '' END ,
						CASE WHEN ie_acomp_pes_desnutr_w='S' THEN '9'  ELSE '' END ,
						CASE WHEN ie_acomp_pes_rea_def_w='S' THEN '10'  ELSE '' END ,
						CASE WHEN ie_acomp_pes_hiperte_w='S' THEN '11'  ELSE '' END ,
						CASE WHEN ie_acomp_pes_diabete_w='S' THEN '12'  ELSE '' END ,
						CASE WHEN ie_acomp_pessoa_asma_w='S' THEN '13'  ELSE '' END ,
						CASE WHEN ie_acomp_pessoa_dpoc_w='S' THEN '14'  ELSE '' END ,
						CASE WHEN ie_acomp_pess_cancer_w='S' THEN '15'  ELSE '' END ,
						CASE WHEN ie_acomp_pes_doe_cro_w='S' THEN '16'  ELSE '' END ,
						CASE WHEN ie_acomp_pes_hanseni_w='S' THEN '17'  ELSE '' END ,
						CASE WHEN ie_acomp_pes_tubercu_w='S' THEN '18'  ELSE '' END ,
						CASE WHEN ie_acomp_sintom_resp_w='S' THEN '32'  ELSE '' END ,
						CASE WHEN ie_acomp_tabagista_w='S' THEN '33'  ELSE '' END ,
						CASE WHEN ie_acomp_domic_acama_w='S' THEN '19'  ELSE '' END ,
						CASE WHEN ie_acomp_con_vul_soc_w='S' THEN '20'  ELSE '' END ,
						CASE WHEN ie_acomp_con_bol_fam_w='S' THEN '21'  ELSE '' END ,
						CASE WHEN ie_acomp_saude_menta_w='S' THEN '22'  ELSE '' END ,
						CASE WHEN ie_acomp_usua_alcool_w='S' THEN '23'  ELSE '' END ,
						CASE WHEN ie_acomp_usua_drogas_w='S' THEN '24'  ELSE '' END ,
						CASE WHEN ie_egress_internacao_w='S' THEN '25'  ELSE '' END ,
						CASE WHEN ie_contr_ambie_vetor_w='S' THEN ''  ELSE '' END ,
						CASE WHEN ie_conv_ativ_coletiv_w='S' THEN '27'  ELSE '' END ,
						CASE WHEN ie_orienta_prevencao_w='S' THEN '31'  ELSE '' END ,
						CASE WHEN ie_outros_w='S' THEN '28'  ELSE '' END ,						
						ie_desfecho_w,
						nr_seq_lote_envio_w,
						cd_cns_paciente_w,
						dt_nascimento_paciente_w,
						cd_cns_profissional_w,
						cd_uuid_original_w,
						cd_cnes_unidade_w,
						lpad(substr(cd_micro_area_w,1,2),2,'0'),
						CASE WHEN ie_fora_area_w='S' THEN 'true' WHEN ie_fora_area_w='N' THEN 'false'  ELSE '' END ,
						nr_atendimento_w,
						ie_tipo_imovel_w,
						CASE WHEN ie_acao_educativa_w='S' THEN '34'  ELSE '' END ,
						CASE WHEN ie_imovel_foco_w='S' THEN '35'  ELSE '' END ,
						CASE WHEN ie_acao_mecanica_w='S' THEN '36'  ELSE '' END ,
						CASE WHEN ie_tratamento_focal_w='S' THEN '37'  ELSE '' END ,
						replace(qt_peso_w,',','.'),
						replace(qt_altura_w,',','.'),
						nr_data_nasc_paci_w,
						nr_data_atendimento_w,
						ie_sexo_paciente_w);
		end;
	end loop;
	end;
end loop;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE sus_gerar_w_esus_vis_dom ( nr_seq_lote_p esus_lote_envio.nr_sequencia%type, ie_tipo_lote_esus_p esus_lote_envio.ie_tipo_lote_esus%type, cd_cnes_estab_p estabelecimento.cd_cns%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;

