-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cpoe_obter_horarios_dd ( ds_horarios_p text, ds_dose_dif_p text, ds_horarios_ajustados_p out text, nr_ocorrencia_p out bigint) is type rDoses_dd is record (qt_dose varchar(10), ie_possui_horario boolean) AS $body$
DECLARE

dsValor_w 	varchar(30);
i		integer;

BEGIN
dsValor_w := '';
i := 1;
while  i <= length(String_pp) loop
	if (substr(String_pp,i,1) <> ds_separador_pp) then
		dsValor_w	:=  dsValor_w||substr(String_pp,i,1);
	else
		String_pp		:= substr(String_pp,i+1, length(String_pp));
		return;
	end if;
	i:= i+1;
end loop;

String_pp := null;
return;
end;

begin

ds_horarios_ajustados_p := ds_horarios_p;
k := 1;

ds_doses_dif_w := ds_dose_dif_p;

while(ds_doses_dif_w IS NOT NULL AND ds_doses_dif_w::text <> '') loop
	vtDose_w[k].qt_dose	:= pushVlString(ds_doses_dif_w, '-');
	k	:= k + 1;
end loop;

ds_horarios_w := ds_horarios_p;
k := 1;

while(ds_horarios_w IS NOT NULL AND ds_horarios_w::text <> '') loop
	vtHorario_temp_w[k].ds_hora := pushVlString(ds_horarios_w, ' ');
	k	:= k + 1;
end loop;

if (vtHorario_temp_w.count = vtDose_w.count) then

	for i in 1..vtDose_w.count loop
		if (coalesce(vtDose_w[i].qt_dose,'0') = '0') then
			vtHorario_def_w[i].ds_hora	:= null;
		else
			vtHorario_def_w[i].ds_hora	:= vtHorario_temp_w[i].ds_hora;
		end if;
	end loop;

	ds_horarios_w := null;
	nr_ocorrencia_w := 0;

	for i in 1..vtHorario_def_w.count loop
		if (vtHorario_def_w[i](.ds_hora IS NOT NULL AND .ds_hora::text <> '')) then
			ds_horarios_w := ds_horarios_w || vtHorario_def_w[i].ds_hora || ' ';
			nr_ocorrencia_w := nr_ocorrencia_w + 1;
		end if;
	end loop;

	ds_horarios_ajustados_p := trim(both ds_horarios_w);
	nr_ocorrencia_p 		:= nr_ocorrencia_w;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_obter_horarios_dd ( ds_horarios_p text, ds_dose_dif_p text, ds_horarios_ajustados_p out text, nr_ocorrencia_p out bigint) is type rDoses_dd is record (qt_dose varchar(10), ie_possui_horario boolean) FROM PUBLIC;

