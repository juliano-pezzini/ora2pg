-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_hdm_proced_autorizacao (Seq_Hdm_Guia_Autor_Cubo_P bigint, Ds_Procedimento_P text Default Null, Dt_Procedimento_P timestamp Default Null, Qt_Procedimento_P bigint Default Null, Nm_Usuario_P text Default Null, Cd_Procedimento_P bigint Default Null, Ie_Origem_Proced_P bigint Default Null, IE_ORIGEM_p text default null) AS $body$
DECLARE


Valida_Insercao_W bigint;
Sql_Errm_W varchar(255);


BEGIN

Select coalesce(max(nr_sequencia),0)
Into STRICT Valida_Insercao_W
From Hdm_Aut_Proc_Cubo
Where nr_Seq_aut_cubo = Seq_Hdm_Guia_Autor_Cubo_P
And Cd_Procedimento = Cd_Procedimento_P
And Ie_Origem_Proced = Ie_Origem_Proced_P
And Dt_Procedimento = Dt_Procedimento_P;

If (Valida_Insercao_W = 0) Then
	begin
	Insert Into Hdm_Aut_Proc_Cubo(Nr_Sequencia,
		Ds_Procedimento,
		Dt_Atualizacao,
		Dt_Atualizacao_Nrec,
		Dt_Procedimento,
		Qt_Procedimento,
		Nm_Usuario,
		Nm_Usuario_Nrec,
		Nr_Seq_Aut_Cubo,
		Cd_Procedimento,
		Ie_Origem_Proced,
		Ie_Origem)
	Values (nextval('hdm_aut_proc_cubo_seq'),
		Ds_Procedimento_P,
		clock_timestamp(),
		clock_timestamp(),
		Dt_Procedimento_P,
		Qt_Procedimento_P,
		Nm_Usuario_P,
		Nm_Usuario_P,
		Seq_Hdm_Guia_Autor_Cubo_P,
		Cd_Procedimento_P,
		Ie_Origem_Proced_P,
		Ie_Origem_P);

	Exception
	When Others Then

	Sql_Errm_W	:= Sqlerrm;

	Insert Into Hdm_Log_Integracao(Nr_Sequencia,
		Dt_Atualizacao,
		Nm_Usuario,
		Dt_Atualizacao_Nrec,
		Nm_Usuario_Nrec,
		Ie_Tipo_Log,
		Ds_Titulo,
		Ds_Log_Hdm)
	Values (nextval('hdm_log_integracao_seq'),
		clock_timestamp(),
		Nm_Usuario_P,
		clock_timestamp(),
		Nm_Usuario_P,
		'I',
		'Inserir HDM_AUT_PROC_CUBO (Procedimento_Autorizacao)',
		Sql_Errm_W);
	end;
end if;

End;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_hdm_proced_autorizacao (Seq_Hdm_Guia_Autor_Cubo_P bigint, Ds_Procedimento_P text Default Null, Dt_Procedimento_P timestamp Default Null, Qt_Procedimento_P bigint Default Null, Nm_Usuario_P text Default Null, Cd_Procedimento_P bigint Default Null, Ie_Origem_Proced_P bigint Default Null, IE_ORIGEM_p text default null) FROM PUBLIC;

