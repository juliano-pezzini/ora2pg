-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_w_proc_mat_autorizado ( nr_cirurgia_p bigint, nm_usuario_p text, ie_modoexibir_matesp_p text, nr_atendimento_p bigint, nr_seq_agenda_p bigint, ietipomatsugerido_p text, nr_prescricao_p bigint) AS $body$
DECLARE


ie_desc_proced_w			varchar(15);
ie_desc_mat_w			varchar(15);



BEGIN

ie_desc_proced_w := obter_param_usuario(872, 439, wheb_usuario_pck.get_cd_perfil, wheb_usuario_pck.get_nm_usuario, wheb_usuario_pck.get_cd_estabelecimento, ie_desc_proced_w);
ie_desc_mat_w := obter_param_usuario(872, 283, wheb_usuario_pck.get_cd_perfil, wheb_usuario_pck.get_nm_usuario, wheb_usuario_pck.get_cd_estabelecimento, ie_desc_mat_w);

delete
from   	pepo_mat_proc_justif_autor
where	nr_cirurgia 	=	nr_cirurgia_p
and	nm_usuario	=	nm_usuario_p;

commit;

if (ie_desc_mat_w = 'S') or (ie_desc_mat_w = 'A') then
	if (ietipomatsugerido_p = 'S') then
		CALL gerar_w_mat_autor_cirur(nr_atendimento_p,nr_seq_agenda_p,nr_cirurgia_p,nm_usuario_p);
	elsif (ietipomatsugerido_p = 'SDR') then
		CALL gerar_w_mat_autor_cirur_s_reg(nr_atendimento_p,nr_seq_agenda_p,nr_cirurgia_p,nm_usuario_p);
	elsif (ietipomatsugerido_p = 'N') then
		CALL gerar_w_mat_esp_nao_autor_cir(nr_atendimento_p,nr_seq_agenda_p,nr_cirurgia_p,nm_usuario_p);
	else	
		CALL gerar_w_todos_mat_cirur(nr_atendimento_p,nr_seq_agenda_p,nr_cirurgia_p,nm_usuario_p);
	end if;
end if;	
	
if (ie_desc_proced_w = 'S') or (ie_desc_proced_w = 'A') then
	CALL gerar_w_proc_cirurgia(nr_cirurgia_p,nm_usuario_p);
end if;	

end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_w_proc_mat_autorizado ( nr_cirurgia_p bigint, nm_usuario_p text, ie_modoexibir_matesp_p text, nr_atendimento_p bigint, nr_seq_agenda_p bigint, ietipomatsugerido_p text, nr_prescricao_p bigint) FROM PUBLIC;

