-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_copia_laudo_registro ( nr_seq_laudo_p bigint, nr_seq_destino_p bigint, nm_usuario_p text, ds_justificativa_p text default '') AS $body$
DECLARE

ds_laudo_w	text;
nr_seq_laudo_w	bigint;

BEGIN
Select	ds_laudo
into STRICT	ds_laudo_w
from	laudo_paciente
where	nr_sequencia = nr_seq_laudo_p;

Select	nextval('laudo_paciente_copia_seq')
into STRICT	nr_seq_laudo_w
;

insert into laudo_paciente_copia(
		nr_sequencia,
		nr_atendimento,
		dt_entrada_unidade,
		nr_laudo,
		nm_usuario,
		dt_atualizacao,
		cd_medico_resp,
		ds_titulo_laudo,
		dt_laudo,
		ds_laudo,
		cd_laudo_padrao,
		ie_normal,
		dt_exame,
		nr_prescricao,
		dt_aprovacao,
		nm_usuario_aprovacao,
		cd_protocolo,
		cd_projeto,
		nr_seq_laudo,
		nr_seq_prescricao,
		dt_liberacao,
		nr_seq_proc,
		dt_prev_entrega,
		dt_real_entrega,
		qt_imagem,
		dt_envelopado,
		nr_controle,
		dt_seg_aprovacao,
		nm_usuario_seg_aprov,
		nr_seq_motivo_parada,
		cd_setor_atendimento,
		nr_exame,
		cd_medico_aux,
		dt_impressao,
		nm_usuario_digitacao,
		dt_inicio_digitacao,
		dt_fim_digitacao,
		dt_integracao,
		cd_setor_usuario,
		nm_medico_solicitante,
		ie_midia_entregue,
		cd_tecnico_resp,
		ds_justificativa,
		dt_copia,
		nm_usuario_copia,
		nr_seq_motivo_desap)
	SELECT	nr_seq_laudo_w,
		nr_atendimento,
		dt_entrada_unidade,
		nr_laudo,    
		nm_usuario_p,
		clock_timestamp(),
		cd_medico_resp,
		ds_titulo_laudo,
		dt_laudo,
		null,
		cd_laudo_padrao,
		ie_normal,
		dt_exame,
		nr_prescricao,
		dt_aprovacao,
		nm_usuario_aprovacao,
		cd_protocolo,
		cd_projeto,
		nr_seq_destino_p,
		nr_seq_prescricao,
		dt_liberacao,
		nr_seq_proc,
		dt_prev_entrega,
		dt_real_entrega,
		qt_imagem,
		dt_envelopado,
		nr_controle,
		dt_seg_aprovacao,
		nm_usuario_seg_aprov,
		nr_seq_motivo_parada,
		cd_setor_atendimento,
		nr_exame,
		cd_medico_aux,
		dt_impressao,
		nm_usuario_digitacao,
		dt_inicio_digitacao,
		dt_fim_digitacao,
		dt_integracao,
		cd_setor_usuario,
		nm_medico_solicitante,
		ie_midia_entregue,
		cd_tecnico_resp,
		substr(ds_justificativa_p,1,255),
		clock_timestamp(),
		nm_usuario_p,
		nr_seq_motivo_desap
	from	laudo_paciente
	where	nr_sequencia = nr_seq_laudo_p;
	
update	laudo_paciente_copia
set	ds_laudo	= ds_laudo_w
where	nr_sequencia	= nr_seq_laudo_w;
/*
Elemar - 27/05/2008 - OS92581
commit;*/
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_copia_laudo_registro ( nr_seq_laudo_p bigint, nr_seq_destino_p bigint, nm_usuario_p text, ds_justificativa_p text default '') FROM PUBLIC;

