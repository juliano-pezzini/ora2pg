-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_feridas_em_lote (wounds_to_include text) AS $body$
DECLARE

    ie_fumante_w                        cur_ferida.ie_fumante%TYPE := 'N';
    ie_diabetico_w                      cur_ferida.ie_diabetico%TYPE := 'N';
    ie_uso_alcool_w                     cur_ferida.ie_uso_alcool%TYPE := 'N';
    ie_doenca_vascular_w                cur_ferida.ie_doenca_vascular%TYPE := 'N';
    ie_historia_anterior_w              cur_ferida.ie_historia_anterior%TYPE := 'N';
    ie_dor_w                            cur_ferida.ie_dor%TYPE := 'N';
    ie_alergia_medic_w                  cur_ferida.ie_alergia_medic%TYPE := 'N';
    ie_insuf_vascular_venosa_w          cur_ferida.ie_insuf_vascular_venosa%TYPE := 'N';
    ie_insuf_renal_cronica_w            cur_ferida.ie_insuf_renal_cronica%TYPE := 'N';
    ie_neoplasia_w                      cur_ferida.ie_neoplasia%TYPE := 'N';
    ie_autoimune_w                      cur_ferida.ie_autoimune%TYPE := 'N';
    ie_obesidade_w                      cur_ferida.ie_obesidade%TYPE := 'N';
    ie_desnutricao_w                    cur_ferida.ie_desnutricao%TYPE := 'N';
    ie_quimioterapia_w                  cur_ferida.ie_quimioterapia%TYPE := 'N';
    ie_corticoide_w                     cur_ferida.ie_corticoide%TYPE := 'N';
    ie_anti_infl_nao_ester_w            cur_ferida.ie_anti_infl_nao_ester%TYPE := 'N';
    ie_anticoagulante_w                 cur_ferida.ie_anticoagulante%TYPE := 'N';
    ie_radioterapia_w                   cur_ferida.ie_radioterapia%TYPE := 'N';
    ie_situacao_w                       cur_ferida.ie_situacao%TYPE := 'A';
    nm_usuario_w                        cur_ferida.nm_usuario%TYPE;
    cd_perfil_ativo_w                   cur_ferida.cd_perfil_ativo%TYPE;
    cd_pessoa_fisica_w                  cur_ferida.cd_pessoa_fisica%TYPE;
    nr_atendimento_w                    cur_ferida.nr_atendimento%TYPE;
    cd_setor_atendimento_w              cur_ferida.cd_setor_atendimento%TYPE;
    cd_estabelecimento_w                cur_ferida.cd_estabelecimento%TYPE;
    cd_medico_w                         cur_ferida.cd_medico%TYPE;
    ie_clinica_w                        cur_ferida.ie_clinica%TYPE;
    qt_dia_ferida_w                     cur_ferida.qt_dia_ferida%TYPE;
    qt_mes_ferida_w                     cur_ferida.qt_mes_ferida%TYPE;
    qt_ano_ferida_w                     cur_ferida.qt_ano_ferida%TYPE;
    nr_seq_localizacao_w                cur_ferida.nr_seq_localizacao%type;
    nr_seq_area_w                       area_imagem.nr_sequencia%TYPE;
    wounds_to_include_w                 PHILIPS_JSON;
    list_wounds_to_include_w            PHILIPS_JSON_LIST;
  item_ferida RECORD;

BEGIN
    list_wounds_to_include_w := PHILIPS_JSON_LIST(wounds_to_include);
    for i in 1..list_wounds_to_include_w.count loop
        wounds_to_include_w := PHILIPS_JSON(list_wounds_to_include_w.get(i));
        nm_usuario_w := wounds_to_include_w.get['NM_USUARIO'].GET_STRING();

        IF (wounds_to_include_w.get('CD_PERFIL_ATIVO') IS NOT NULL AND (wounds_to_include_w.get('CD_PERFIL_ATIVO'))::text <> '') THEN
            cd_perfil_ativo_w := wounds_to_include_w.get['CD_PERFIL_ATIVO'].GET_NUMBER();
        ELSE
            cd_perfil_ativo_w := NULL;
        END IF;

        cd_pessoa_fisica_w := wounds_to_include_w.get['CD_PESSOA_FISICA'].GET_STRING();

        IF (wounds_to_include_w.get('NR_ATENDIMENTO') IS NOT NULL AND (wounds_to_include_w.get('NR_ATENDIMENTO'))::text <> '') THEN
            nr_atendimento_w := wounds_to_include_w.get['NR_ATENDIMENTO'].GET_NUMBER();
        ELSE
            nr_atendimento_w := NULL;
        END IF;

        cd_setor_atendimento_w := wounds_to_include_w.get['CD_SETOR_ATENDIMENTO'].GET_NUMBER();
        cd_estabelecimento_w := wounds_to_include_w.get['CD_ESTABELECIMENTO'].GET_NUMBER();

        IF (wounds_to_include_w.get('CD_MEDICO') IS NOT NULL AND (wounds_to_include_w.get('CD_MEDICO'))::text <> '') THEN
            cd_medico_w := wounds_to_include_w.get['CD_MEDICO'].GET_STRING();
        ELSE
            cd_medico_w := NULL;
        END IF;

        ie_clinica_w := wounds_to_include_w.get['IE_CLINICA'].GET_NUMBER();
        qt_dia_ferida_w := wounds_to_include_w.get['QT_DIAS_FERIDA'].GET_NUMBER();
        qt_mes_ferida_w := wounds_to_include_w.get['QT_MES_FERIDA'].GET_NUMBER();
        qt_ano_ferida_w := wounds_to_include_w.get['QT_ANO_FERIDA'].GET_NUMBER();
        nr_seq_area_w := wounds_to_include_w.get['NR_SEQ_AREA'].GET_NUMBER();

        for item_ferida in (SELECT * from area_imagem_item where nr_seq_area = nr_seq_area_w) loop
            nr_seq_localizacao_w := item_ferida.nr_seq_localizacao;
            CALL INSERIR_FERIDA( cd_pessoa_fisica_w,
                            nm_usuario_w,
                            NULL,
                            NULL,
                            ie_fumante_w,
                            ie_diabetico_w,
                            ie_uso_alcool_w,
                            ie_doenca_vascular_w,
                            ie_historia_anterior_w,
                            qt_mes_ferida_w,
                            NULL,
                            cd_estabelecimento_w,
                            qt_dia_ferida_w,
                            ie_clinica_w,
                            cd_setor_atendimento_w,
                            cd_medico_w,
                            ie_dor_w,
                            ie_alergia_medic_w,
                            NULL,
                            NULL,
                            NULL,
                            ie_insuf_vascular_venosa_w,
                            ie_insuf_renal_cronica_w,
                            ie_neoplasia_w,
                            ie_autoimune_w,
                            ie_obesidade_w,
                            ie_desnutricao_w,
                            ie_quimioterapia_w,
                            ie_corticoide_w,
                            ie_anti_infl_nao_ester_w,
                            ie_anticoagulante_w,
                            ie_radioterapia_w,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            qt_ano_ferida_w,
                            NULL,
                            nr_seq_localizacao_w,
                            NULL,
                            ie_situacao_w,
                            NULL,
                            cd_perfil_ativo_w,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            nr_atendimento_w,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL,
                            NULL);
        end loop;
    end loop;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_feridas_em_lote (wounds_to_include text) FROM PUBLIC;

