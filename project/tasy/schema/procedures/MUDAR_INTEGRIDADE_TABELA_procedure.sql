-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE mudar_integridade_tabela ( nm_tabela_p text, ds_acao_p text) AS $body$
DECLARE


ds_comando_w		varchar(2000);
c001			integer;
nm_tabela_w		varchar(50);
nm_integridade_w	varchar(50);

C00 CURSOR FOR
	SELECT nm_tabela,
		nm_integridade_referencial
	from	integridade_referencial
	where	nm_tabela_referencia	= nm_tabela_p
	
UNION

	SELECT nm_tabela,
		nm_integridade_referencial
	from	integridade_referencial
	where	nm_tabela	= nm_tabela_p
	
union

	select nm_tabela,
		nm_indice
	from	indice
	where	nm_tabela	= nm_tabela_p
	and	ie_tipo		= 'UK';



BEGIN

OPEN C00;
LOOP
FETCH C00 into
	nm_tabela_w,
	nm_integridade_w;
EXIT WHEN NOT FOUND; /* apply on c00 */
	begin
	ds_comando_w	:= 'alter table ' || nm_tabela_w || ' ' || ds_acao_p ||
			' constraint ' || nm_integridade_w;
	CALL gravar_processo_longo(ds_comando_w,'MUDAR_INTEGRIDADE_TABELA',null);
	CALL Exec_sql_Dinamico(nm_tabela_w || '=' || nm_integridade_w, ds_comando_w);
	end;
END LOOP;
CLOSE C00;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE mudar_integridade_tabela ( nm_tabela_p text, ds_acao_p text) FROM PUBLIC;

