-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cancelar_item_solic_req ( nr_requisicao_p bigint, nr_seq_item_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
nr_item_solic_compra_w	solic_compra_item.nr_item_solic_compra%type;
nr_solic_compra_w		solic_compra_item.nr_solic_compra%type;
ds_action_w		varchar(2000);

c01 CURSOR FOR 
SELECT	nr_solic_compra, 
	nr_item_solic_compra 
from	solic_compra_item 
where	nr_requisicao = nr_requisicao_p 
and 	nr_seq_item_requisicao = nr_seq_item_p 
and	coalesce(dt_baixa::text, '') = '';


BEGIN 
 
ds_action_w := sys_context('USERENV','ACTION');
dbms_application_info.set_action('CANCELAR_ITEM_SOLIC_REQ');
 
open c01;
loop 
fetch c01 into 
	nr_solic_compra_w, 
	nr_item_solic_compra_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin 
	CALL baixar_solic_compra_item(nr_solic_compra_w, nr_item_solic_compra_w, nm_usuario_p, 2, Wheb_mensagem_pck.get_Texto(298673));
	end;
end loop;
close c01;
 
dbms_application_info.set_action(ds_action_w);
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cancelar_item_solic_req ( nr_requisicao_p bigint, nr_seq_item_p bigint, nm_usuario_p text) FROM PUBLIC;

