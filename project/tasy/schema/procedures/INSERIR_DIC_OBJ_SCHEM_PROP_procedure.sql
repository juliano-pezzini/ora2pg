-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_dic_obj_schem_prop (nr_seq_obj_schematic_p bigint, nr_seq_property_p bigint, vl_property_p text, nm_usuario_p text) AS $body$
DECLARE


    nr_sequencia_w            bigint;
    nr_seq_funcao_schematic_w bigint;
    ie_salvar_w               varchar(3) := 'S';
    nr_sequencia_rem_w        bigint;


BEGIN

    select coalesce(max(nr_sequencia), 0)
      into STRICT nr_sequencia_w
      from dic_objeto_property
     where nr_seq_obj_schematic = nr_seq_obj_schematic_p
       and nr_seq_property = nr_seq_property_p;

    select max(nr_seq_funcao_schematic)
      into STRICT nr_seq_funcao_schematic_w
      from objeto_schematic
     where nr_sequencia = nr_seq_obj_schematic_p;

    /*  Criado para a alteracao do componente do Dashboard para o SUEP, onde deve apenas utilizar o cadastro do SUEP */

    if (nr_seq_funcao_schematic_w = 5230) and (obter_desc_component_property(nr_seq_property_p) = 'cardSize') then

        ie_salvar_w := 'N';

    end if;

    if (ie_salvar_w = 'S') then

        if (nr_sequencia_w = 0) then
            /* inserir o item (insert) */

            $if $$tasy_local_dict=true $then
            nr_sequencia_rem_w := get_remote_sequence('seq:dic_objeto_property_seq');
            $else
            select nextval('dic_objeto_property_seq') into STRICT nr_sequencia_rem_w;
            $end

            insert into dic_objeto_property(nr_sequencia,
                 nr_seq_obj_schematic,
                 vl_property,
                 dt_atualizacao,
                 nm_usuario,
                 nr_seq_property,
                 nr_seq_funcao_schematic)
            values (nr_sequencia_rem_w, --dic_objeto_property_seq.nextval,
                 nr_seq_obj_schematic_p,
                 vl_property_p,
                 clock_timestamp(),
                 nm_usuario_p,
                 nr_seq_property_p,
                 nr_seq_funcao_schematic_w);

        else
            /* atualizar o item (update) */

            update dic_objeto_property
               set vl_property    = vl_property_p,
                   dt_atualizacao = clock_timestamp(),
                   nm_usuario     = nm_usuario_p
             where nr_sequencia = nr_sequencia_w
               and coalesce(vl_property, 'XPTO') <> coalesce(vl_property_p, 'XPTO');

        end if;

    end if;

    commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_dic_obj_schem_prop (nr_seq_obj_schematic_p bigint, nr_seq_property_p bigint, vl_property_p text, nm_usuario_p text) FROM PUBLIC;

