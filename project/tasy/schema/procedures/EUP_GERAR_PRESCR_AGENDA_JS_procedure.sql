-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE eup_gerar_prescr_agenda_js ( ie_gerar_prescr_ag_lista_p text, ds_lista_agenda_exame_p text, ds_lista_agenda_cons_p text, ds_lista_agenda_serv_p text, cd_setor_usuario_p bigint, ie_setor_prescricao_p text, dt_entrada_p timestamp, dt_alta_p timestamp, ie_data_prescricao_p text, ie_novo_atend_lista_ag_p text, nr_seq_agenda_p bigint, nr_atendimento_p bigint, nm_usuario_p text, ie_limpar_variaveis_p INOUT text) AS $body$
DECLARE

 
dt_prescricao_w	timestamp;					
					 

BEGIN 
 
if (ie_novo_atend_lista_ag_p = 'N') then 
	CALL gerar_prescr_agenda_servico(nr_seq_agenda_p, nm_usuario_p);
elsif (ie_novo_atend_lista_ag_p = 'S') and (ie_gerar_prescr_ag_lista_p = 'S') then 
	CALL gerar_prescr_agenda_servico(nr_seq_agenda_p, nm_usuario_p);
	 
	if (ie_data_prescricao_p = 'S') then 
			dt_prescricao_w := dt_entrada_p;
	elsif (ie_data_prescricao_p = 'AE') and (dt_alta_p IS NOT NULL AND dt_alta_p::text <> '') then 
		dt_prescricao_w := dt_alta_p;
	else 
		dt_prescricao_w := clock_timestamp();
	end if;
	CALL eup_gerar_prescr_ag_listas_js(ds_lista_agenda_cons_p, ds_lista_agenda_serv_p, cd_setor_usuario_p, ie_setor_prescricao_p, nr_seq_agenda_p, dt_prescricao_w, nr_atendimento_p, ds_lista_agenda_exame_p,nm_usuario_p);
	ie_limpar_variaveis_p := 'S';
 
end if;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eup_gerar_prescr_agenda_js ( ie_gerar_prescr_ag_lista_p text, ds_lista_agenda_exame_p text, ds_lista_agenda_cons_p text, ds_lista_agenda_serv_p text, cd_setor_usuario_p bigint, ie_setor_prescricao_p text, dt_entrada_p timestamp, dt_alta_p timestamp, ie_data_prescricao_p text, ie_novo_atend_lista_ag_p text, nr_seq_agenda_p bigint, nr_atendimento_p bigint, nm_usuario_p text, ie_limpar_variaveis_p INOUT text) FROM PUBLIC;

