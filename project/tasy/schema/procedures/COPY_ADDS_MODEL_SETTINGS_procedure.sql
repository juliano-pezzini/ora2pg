-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copy_adds_model_settings ( nr_seq_model_p bigint, nr_atendimento_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_sequencia_adds_sv_w  	bigint;


c01 CURSOR FOR
	SELECT	distinct nr_sequencia
	from 	adds_sv 
	where 	nr_seq_modelo = nr_seq_model_p;

C02 CURSOR(	nr_sequencia_adds_sv_p bigint) FOR
	SELECT	*
	FROM 	adds_sv_item
	WHERE 	nr_seq_adds_sv = nr_sequencia_adds_sv_p 
	AND 	ie_situacao='A' 
	and 	coalesce(nr_atendimento::text, '') = '';

BEGIN


for r_c01 in c01 loop
	begin
	nr_sequencia_adds_sv_w := r_c01.nr_sequencia;
	
	delete 	from adds_sv_item
	where 	nr_atendimento = nr_atendimento_p
	and	nr_seq_adds_sv = nr_sequencia_adds_sv_w;
	commit;
	
	
	for r_c02 in c02(nr_sequencia_adds_sv_w) loop
		begin
		insert into adds_sv_item(nr_sequencia,
				nm_range,
				nr_seq_adds_sv,
				ie_score,      
				nr_seq_apres,
				vl_minimo,         
				vl_maximo,        
				ie_valor,
				dt_atualizacao ,         
				nm_usuario,          
				dt_atualizacao_nrec,      
				nm_usuario_nrec ,          
				ie_situacao,
				nr_atendimento)       
		values (	nextval('adds_sv_item_seq'),
				r_c02.nm_range,         
				nr_sequencia_adds_sv_w,
				r_c02.ie_score,      
				r_c02.nr_seq_apres,
				r_c02.vl_minimo,         
				r_c02.vl_maximo,        
				r_c02.ie_valor,
				clock_timestamp(),
				nm_usuario_p,
				clock_timestamp(),
				nm_usuario_p,
				r_c02.ie_situacao,
				nr_atendimento_p);
		end;
	end loop;
end;
end loop;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copy_adds_model_settings ( nr_seq_model_p bigint, nr_atendimento_p bigint, nm_usuario_p text) FROM PUBLIC;

