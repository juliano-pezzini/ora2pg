-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_dados_hdm ( Cd_Estabelecimento_P bigint, Nm_Mae_P text Default Null, Nr_Cpf_P bigint Default Null, Nr_Identidade_P bigint default null, Dt_Nascimento_P timestamp Default Null, NR_TELEFONE_P bigint default null, Nm_Pessoa_Fisica_P text Default Null, Nm_Usuario_P text Default Null, Cd_Pessoa_Fisica_P text Default Null, Ie_Sexo_P text Default Null, Ie_Preco_Plano_p text default null, Ds_Preco_Plano_P text Default Null, Dt_Inclusao_Plano_P timestamp Default Null, Ie_Situacao_Contrato_P text Default Null, Cd_Usuario_Plano_P text Default Null, Ie_Situacao_Atend_P text Default Null, Ie_Origem_P text Default Null, Dt_Mesano_Referencia_P timestamp Default Null, Vl_Resultado_P bigint Default Null, Pr_Sinistralidade_P bigint Default Null, Vl_Custo_P bigint Default Null, Vl_Receita_P bigint Default Null, cd_guia_p bigint Default Null, Cd_Guia_Principal_P text Default Null, Ds_Especialidade_Solic_P text Default Null, Ds_Tipo_Atendimento_P text Default Null, Ds_Tipo_Internacao_P text Default Null, Dt_Atendimento_P timestamp Default Null, Dt_Mes_Competencia_P timestamp Default Null, Ie_Carater_Internacao_P text Default Null, Ie_Tipo_Guia_P text Default Null, Nr_Seq_Clinica_P bigint Default Null, Cd_Especialidade_P bigint Default Null, Cd_Guia text Default Null, Ds_Procedimento_P text Default Null, Dt_Procedimento_P timestamp Default Null, Qt_Procedimento_P bigint Default Null, Cd_Procedimento_P bigint Default Null, Ie_Origem_Proced_P bigint Default Null, Vl_Conta_P bigint Default Null, Cd_Medico_Executor_P bigint Default Null, Cd_Medico_Solicitante_P bigint Default Null, Nm_Medico_Exec_P text Default Null, Nm_Medico_Solic_P text Default Null, Nm_Prestador_Exec_P text Default Null, Nr_Crm_Medico_Exec_P text Default Null, Nr_Crm_Medico_Solic_P text Default Null, Nr_Seq_Prestador_Exec_P bigint Default Null, Nr_Seq_Tipo_Atendimento_P bigint Default Null, Ds_Doenca_P text Default Null, Cd_Doenca_P bigint Default Null) AS $body$
DECLARE




Retorno_function_PF_W	bigint;



Cd_Pessoa_Fisica_W	bigint;

Valida_Pessoa_Fisica bigint;



Seq_Hdm_Benef_Cubo_W bigint;

valida_Hdm_Benef_Cubo bigint;



Seq_Hdm_Guia_Autor_Cubo_W bigint;

valida_Hdm_Guia_Autor_Cubo bigint;



Seq_Hdm_Conta_Cubo_W bigint;

valida_HDM_CONTA_CUBO bigint;




BEGIN



    Retorno_Function_Pf_W := Obter_retorno_Paciente_Hdm( Cd_Estabelecimento_P, Nm_Pessoa_Fisica_P, Dt_Nascimento_P, Nm_Mae_P,  Nr_Cpf_P, Nr_Identidade_P, NR_TELEFONE_P);



    If (Retorno_function_PF_W  = 0 and (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '')) Then



          Select nextval('pessoa_fisica_seq') Into STRICT Cd_Pessoa_Fisica_W;

          Insert Into Pessoa_Fisica(Cd_Pessoa_Fisica, Dt_Atualizacao, Dt_Nascimento, Nm_Pessoa_Fisica, Nm_Usuario, Ie_Sexo)

          Values (Cd_Pessoa_Fisica_W, clock_timestamp(), Dt_Nascimento_P, Nm_Pessoa_Fisica_P, Nm_Usuario_P, Ie_Sexo_P);

          select count(cd_pessoa_fisica) into STRICT valida_pessoa_fisica from pessoa_fisica where cd_pessoa_fisica = cd_pessoa_fisica_w;



    Elsif (Retorno_function_PF_W  <> 0 and (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '')) then



      cd_pessoa_fisica_w := Retorno_function_PF_W;



    end if;



    If (Valida_Pessoa_Fisica = 1) Then



          select nextval('hdm_benef_cubo_seq') into STRICT SEQ_HDM_BENEF_CUBO_W;

          Insert Into Hdm_Benef_Cubo(Nr_Sequencia, Cd_Pessoa_Fisica, Ds_Preco_Plano, Dt_Atualizacao, Dt_Inclusao_Plano, Ie_Situacao_Contrato, Nm_Usuario, Cd_Usuario_Plano, Ie_Situacao_Atend, Ie_Origem, Ie_Preco_Plano)

          Values (Seq_Hdm_Benef_Cubo_W, Cd_Pessoa_Fisica_W, Ds_Preco_Plano_P, clock_timestamp(), Dt_Inclusao_Plano_P, Ie_Situacao_Contrato_P, Nm_Usuario_P, Cd_Usuario_Plano_P, Ie_Situacao_Atend_P, Ie_Origem_P, Ie_Preco_Plano_p);

          select count(nr_sequencia) into STRICT valida_Hdm_Benef_Cubo from Hdm_Benef_Cubo where nr_sequencia = SEQ_HDM_BENEF_CUBO_W;



          If (Valida_Hdm_Benef_Cubo = 1) Then



                Insert Into Hdm_Benef_Custo_Cubo(Nr_Sequencia, Dt_Mesano_Referencia, Nm_Usuario, Vl_Resultado, Pr_Sinistralidade, Vl_Custo, Vl_Receita, Dt_Atualizacao, Nr_Seq_Benef_Cubo, Ie_Origem)

                Values (nextval('hdm_benef_custo_cubo_seq'), Dt_Mesano_Referencia_P, Nm_Usuario_P, Vl_Resultado_P, Pr_Sinistralidade_P, Vl_Custo_P, Vl_Receita_P, clock_timestamp(), Seq_Hdm_Benef_Cubo_W, Ie_Origem_P);



                Select nextval('hdm_guia_autor_cubo_seq') Into STRICT Seq_Hdm_Guia_Autor_Cubo_W;

                Insert Into Hdm_Guia_Autor_Cubo(Nr_Sequencia, Nr_Seq_Tipo_Atendimento, Cd_Guia_Principal, Ds_Especialidade_Solic, Ds_Tipo_Atendimento, Ds_Tipo_Internacao, Dt_Atendimento, Dt_Atualizacao, Dt_Atualizacao_Nrec, Dt_Mes_Competencia, Ie_Carater_Internacao, Ie_Tipo_Guia, Nm_Usuario, Nm_Usuario_Nrec, Nr_Seq_Benef_Cubo, Nr_Seq_Clinica, Cd_Especialidade, Cd_Guia, Ie_Origem)

                Values (Seq_Hdm_Guia_Autor_Cubo_W, Nr_Seq_Tipo_Atendimento_P, Cd_Guia_Principal_P, Ds_Especialidade_Solic_P, Ds_Tipo_Atendimento_P, Ds_Tipo_Internacao_P, Dt_Atendimento_P, clock_timestamp(), clock_timestamp(), Dt_Mes_Competencia_P, Ie_Carater_Internacao_P, Ie_Tipo_Guia_P, Nm_Usuario_P, Nm_Usuario_P, Seq_Hdm_Benef_Cubo_W, Nr_Seq_Clinica_P, Cd_Especialidade_P, Cd_Guia_P, Ie_Origem_P);

                select count(nr_sequencia) into STRICT valida_Hdm_Guia_Autor_Cubo from Hdm_Guia_Autor_Cubo where nr_sequencia = SEQ_Hdm_Guia_Autor_Cubo_W;





                Select nextval('hdm_conta_cubo_seq') Into STRICT Seq_Hdm_Conta_Cubo_W;

                Insert Into Hdm_Conta_Cubo(Nr_Sequencia, Vl_Conta, Cd_Guia_Principal, Cd_Medico_Executor, Cd_Medico_Solicitante, Ds_Especialidade_Solic, Ds_Tipo_Atendimento, Ds_Tipo_Internacao, Dt_Atendimento, Dt_Atualizacao, Dt_Mes_Competencia, Ie_Carater_Internacao, Ie_Tipo_Guia, Nm_Medico_Exec, Nm_Medico_Solic, Nm_Prestador_Exec, Nm_Usuario, Nr_Crm_Medico_Exec, Nr_Crm_Medico_Solic, Nr_Seq_Benef_Cubo, Nr_Seq_Clinica, Nr_Seq_Prestador_Exec, Nr_Seq_Tipo_Atendimento, Cd_Especialidade, Cd_Guia, Ie_Origem)

                Values (Seq_Hdm_Conta_Cubo_W, VL_CONTA_P, CD_GUIA_PRINCIPAL_p, CD_MEDICO_EXECUTOR_p, CD_MEDICO_SOLICITANTE_p, DS_ESPECIALIDADE_SOLIC_p, DS_TIPO_ATENDIMENTO_p, DS_TIPO_INTERNACAO_p, DT_ATENDIMENTO_p, clock_timestamp(), DT_MES_COMPETENCIA_p, IE_CARATER_INTERNACAO_p, IE_TIPO_GUIA_p, NM_MEDICO_EXEC_p, NM_MEDICO_SOLIC_p, NM_PRESTADOR_EXEC_p, NM_USUARIO_p, NR_CRM_MEDICO_EXEC_p, NR_CRM_MEDICO_SOLIC_p, Seq_Hdm_Benef_Cubo_W, NR_SEQ_CLINICA_p, NR_SEQ_PRESTADOR_EXEC_p, NR_SEQ_TIPO_ATENDIMENTO_p, CD_ESPECIALIDADE_p, Cd_Guia_p, IE_ORIGEM_p);

                select count(nr_sequencia) into STRICT valida_HDM_CONTA_CUBO from HDM_CONTA_CUBO where nr_sequencia = SEQ_HDM_CONTA_CUBO_W;



                If (valida_Hdm_Guia_Autor_Cubo = 1) then



                      Insert Into Hdm_Aut_Proc_Cubo(Nr_Sequencia, Ds_Procedimento, Dt_Atualizacao, Dt_Atualizacao_Nrec, Dt_Procedimento, Qt_Procedimento, Nm_Usuario, Nm_Usuario_Nrec, Nr_Seq_Aut_Cubo, Cd_Procedimento, Ie_Origem_Proced, Ie_Origem)

                      values (nextval('hdm_aut_proc_cubo_seq'), DS_PROCEDIMENTO_p, clock_timestamp(), clock_timestamp(), DT_PROCEDIMENTO_p, QT_PROCEDIMENTO_p, NM_USUARIO_p, NM_USUARIO_p, seq_Hdm_Guia_Autor_Cubo_w, CD_PROCEDIMENTO_p, Ie_Origem_Proced_p, IE_ORIGEM_p);



                End If;

                If (valida_HDM_CONTA_CUBO = 1) then



                      Insert Into Hdm_Diagnostico_Cubo(Nr_Sequencia, Ds_Doenca, Nr_Seq_Conta_Cubo, Nm_Usuario, Cd_Doenca, Dt_Atualizacao, Ie_Origem)

                      values (nextval('hdm_diagnostico_cubo_seq'), DS_DOENCA_p, seq_HDM_CONTA_CUBO_w, NM_USUARIO_p, CD_DOENCA_p, clock_timestamp(), IE_ORIGEM_p);



                      Insert Into Hdm_Conta_Proc_Cubo(Nr_Sequencia, Ds_Procedimento, Dt_Atualizacao, Dt_Procedimento, Qt_Procedimento, Nm_Usuario, Nr_Seq_Conta_Cubo, Cd_Procedimento, Ie_Origem_Proced, Ie_Origem)

                      values (nextval('hdm_conta_proc_cubo_seq'), DS_PROCEDIMENTO_p, clock_timestamp(), DT_PROCEDIMENTO_p, QT_PROCEDIMENTO_p, NM_USUARIO_p, seq_HDM_CONTA_CUBO_w, CD_PROCEDIMENTO_p, Ie_Origem_Proced_p, IE_ORIGEM_p);



              End if;

        End If;

  End If;



END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_dados_hdm ( Cd_Estabelecimento_P bigint, Nm_Mae_P text Default Null, Nr_Cpf_P bigint Default Null, Nr_Identidade_P bigint default null, Dt_Nascimento_P timestamp Default Null, NR_TELEFONE_P bigint default null, Nm_Pessoa_Fisica_P text Default Null, Nm_Usuario_P text Default Null, Cd_Pessoa_Fisica_P text Default Null, Ie_Sexo_P text Default Null, Ie_Preco_Plano_p text default null, Ds_Preco_Plano_P text Default Null, Dt_Inclusao_Plano_P timestamp Default Null, Ie_Situacao_Contrato_P text Default Null, Cd_Usuario_Plano_P text Default Null, Ie_Situacao_Atend_P text Default Null, Ie_Origem_P text Default Null, Dt_Mesano_Referencia_P timestamp Default Null, Vl_Resultado_P bigint Default Null, Pr_Sinistralidade_P bigint Default Null, Vl_Custo_P bigint Default Null, Vl_Receita_P bigint Default Null, cd_guia_p bigint Default Null, Cd_Guia_Principal_P text Default Null, Ds_Especialidade_Solic_P text Default Null, Ds_Tipo_Atendimento_P text Default Null, Ds_Tipo_Internacao_P text Default Null, Dt_Atendimento_P timestamp Default Null, Dt_Mes_Competencia_P timestamp Default Null, Ie_Carater_Internacao_P text Default Null, Ie_Tipo_Guia_P text Default Null, Nr_Seq_Clinica_P bigint Default Null, Cd_Especialidade_P bigint Default Null, Cd_Guia text Default Null, Ds_Procedimento_P text Default Null, Dt_Procedimento_P timestamp Default Null, Qt_Procedimento_P bigint Default Null, Cd_Procedimento_P bigint Default Null, Ie_Origem_Proced_P bigint Default Null, Vl_Conta_P bigint Default Null, Cd_Medico_Executor_P bigint Default Null, Cd_Medico_Solicitante_P bigint Default Null, Nm_Medico_Exec_P text Default Null, Nm_Medico_Solic_P text Default Null, Nm_Prestador_Exec_P text Default Null, Nr_Crm_Medico_Exec_P text Default Null, Nr_Crm_Medico_Solic_P text Default Null, Nr_Seq_Prestador_Exec_P bigint Default Null, Nr_Seq_Tipo_Atendimento_P bigint Default Null, Ds_Doenca_P text Default Null, Cd_Doenca_P bigint Default Null) FROM PUBLIC;

