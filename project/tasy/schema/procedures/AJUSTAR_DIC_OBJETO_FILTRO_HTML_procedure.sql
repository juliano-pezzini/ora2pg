-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ajustar_dic_objeto_filtro_html (( nr_sequencia_p bigint, nm_usuario_p text) is QT_POS_Y_w integer) RETURNS bigint AS $body$
DECLARE

	vl_retorno_w	double precision;
	
BEGIN
	vl_retorno_w	:= (qt_tamanho_p * 12) / qt_tamanho_linha_w;

	return vl_retorno_w;

	end;

	function calcularTamanhoPixel(	qt_tamanho_p	number) return number is
	qt_multiplo_w		number(18,6)	:= 50;
	nr_multiplo_w		Number(15,4)	:= 0;
	begin

	if	((trunc(qt_tamanho_p / qt_multiplo_w) * qt_multiplo_w) = qt_tamanho_p) then
		nr_multiplo_w	:= (qt_tamanho_p / qt_multiplo_w);
	else
		nr_multiplo_w   := trunc(qt_tamanho_p / qt_multiplo_w) + 1;
	end if;

	return qt_multiplo_w * nr_multiplo_w;

	end;

begin

select	coalesce(min(QT_POS_Y),0) + 21
into STRICT	QT_POS_Y_w
from	dic_objeto_filtro
where	nr_seq_objeto	= nr_sequencia_p;


open C01;
loop
fetch C01 into
	c01_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin

	if (coalesce(qt_linha_old_w::text, '') = '')	or (c01_w.qt_linha	<> qt_linha_old_w) then

		qt_linha_w	:= qt_linha_w + 10;

		select	max(QT_POS_X)
		into STRICT	qt_max_x_w
		from	dic_objeto_filtro
		where	nr_seq_objeto	= nr_sequencia_p
		and	Obter_Multiplo_Numero(QT_POS_Y, QT_POS_Y_w)	= c01_w.qt_linha;

		select	max(QT_TAMANHO)
		into STRICT	qt_max_tamanho_w
		from	dic_objeto_filtro
		where	nr_seq_objeto	= nr_sequencia_p
		and	QT_POS_X	= qt_max_x_w
		and	Obter_Multiplo_Numero(QT_POS_Y, QT_POS_Y_w)	= c01_w.qt_linha;


		select	min(QT_POS_X)
		into STRICT	qt_min_x_w
		from	dic_objeto_filtro
		where	nr_seq_objeto	= nr_sequencia_p
		and	Obter_Multiplo_Numero(QT_POS_Y, QT_POS_Y_w)	= c01_w.qt_linha;


		qt_tamanho_linha_w	:= coalesce(qt_max_tamanho_w,0) + coalesce(qt_max_x_w,0) - coalesce(qt_min_x_w,0);


	end if;

	qt_tamanho_w	:= round(calcularTamanhoHtml(c01_w.qt_tamanho));
	QT_TAM_HTML_w	:= calcularTamanhoPixel(c01_w.qt_tamanho);




	update	dic_objeto_filtro
	set	nr_seq_apresent	= nr_seq_apresent_w,
		QT_POS_Y	= qt_linha_w,
		qt_pos_x	= 0,
		qt_tamanho	= qt_tamanho_w,
		QT_TAM_HTML	= QT_TAM_HTML_w
	where	nr_sequencia	= c01_w.nr_sequencia;






	nr_seq_apresent_w	:= nr_seq_apresent_w + 10;
	qt_linha_old_w		:= c01_w.qt_linha;
	end;
end loop;
close C01;


commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ajustar_dic_objeto_filtro_html (( nr_sequencia_p bigint, nm_usuario_p text) is QT_POS_Y_w integer) FROM PUBLIC;

