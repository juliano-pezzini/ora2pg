-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gravar_obj_schem_bo_property (nm_usuario_p text, nr_seq_objeto_p bigint, nr_seq_bo_p bigint, nr_seq_property_p bigint, vl_property_p text) AS $body$
DECLARE


    nr_sequencia_w     bigint;
    nm_property_w      business_object_property.nm_property%type;
    nr_sequencia_rem_w bigint;


BEGIN

    select max(nm_property)
      into STRICT nm_property_w
      from business_object_property
     where nr_sequencia = nr_seq_property_p
       and nr_seq_bo = nr_seq_bo_p;

    begin
        select nr_sequencia
          into STRICT nr_sequencia_w
          from obj_schematic_bo_property
         where nr_seq_obj_schematic = nr_seq_objeto_p
           and nr_seq_bo = nr_seq_bo_p
           and nr_seq_property = nr_seq_property_p  LIMIT 1;
    exception
        when others then
            nr_sequencia_w := null;
    end;

    if (coalesce(nr_sequencia_w::text, '') = '') then

        $if $$tasy_local_dict=true $then
        nr_sequencia_rem_w := get_remote_sequence('seq:obj_schematic_bo_property_seq');
        $else
        select nextval('obj_schematic_bo_property_seq') into STRICT nr_sequencia_rem_w;
        $end

        insert into obj_schematic_bo_property(nr_sequencia,
             dt_atualizacao,
             nm_usuario,
             dt_atualizacao_nrec,
             nm_usuario_nrec,
             nr_seq_obj_schematic,
             nr_seq_bo,
             nr_seq_property,
             nm_property,
             vl_property)
        values (nr_sequencia_rem_w, --obj_schematic_bo_property_seq.nextval,
             clock_timestamp(),
             nm_usuario_p,
             clock_timestamp(),
             nm_usuario_p,
             nr_seq_objeto_p,
             nr_seq_bo_p,
             nr_seq_property_p,
             nm_property_w,
             vl_property_p);
    else
        update obj_schematic_bo_property
           set vl_property    = vl_property_p,
               nm_usuario     = nm_usuario_p,
               dt_atualizacao = clock_timestamp()
         where nr_sequencia = nr_sequencia_w;
    end if;

    commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gravar_obj_schem_bo_property (nm_usuario_p text, nr_seq_objeto_p bigint, nr_seq_bo_p bigint, nr_seq_property_p bigint, vl_property_p text) FROM PUBLIC;

