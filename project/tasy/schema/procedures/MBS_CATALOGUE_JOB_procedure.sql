-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE mbs_catalogue_job ( ie_type_p text, nr_mims_p bigint default null) AS $body$
DECLARE


jobno		bigint;
nm_user_w 	varchar(50);
nr_estab_w 	bigint;


BEGIN

delete	FROM mbs_import_log
where	ie_status like ''||'%'||ie_type_p||'';
commit;

insert into mbs_import_log(dt_start,ie_status)
values (clock_timestamp(),''||'I'||ie_type_p||'');

if (ie_type_p = 'MBS') then

	dbms_job.submit(jobno, 'LOAD_MBS_CATALOGUE();');

elsif (ie_type_p = 'ACHI') then

	dbms_job.submit(jobno, 'LOAD_ACHI_PROC();');

elsif (ie_type_p = 'MIMS')then

	nm_user_w :=  ''''|| WHEB_USUARIO_PCK.get_nm_usuario()||'''';
	nr_estab_w := WHEB_USUARIO_PCK.get_cd_estabelecimento();
	
	dbms_job.submit(jobno, 'LOAD_MIMS_CATALOGUE('||nr_mims_p|| ',' || nm_user_w || ',' || nr_estab_w || ');');

-- START: Changes introduced for PBS Catalog
elsif (ie_type_p = 'PBS')then

	nm_user_w :=  ''''|| WHEB_USUARIO_PCK.get_nm_usuario()||'''';
	nr_estab_w := WHEB_USUARIO_PCK.get_cd_estabelecimento();

	dbms_job.submit(jobno, 'LOAD_PBS_CATALOGUE('||nr_mims_p|| ',' || nm_user_w || ',' || nr_estab_w || ');');
-- END: Changes introduced for PBS Catalog
elsif (ie_type_p = 'CUPS') then
    dbms_job.submit(jobno, 'LOAD_CUPS_CATALOGUE();');

end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE mbs_catalogue_job ( ie_type_p text, nr_mims_p bigint default null) FROM PUBLIC;

