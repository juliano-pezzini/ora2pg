-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE enviar_regulacao_medicamento (NR_SEQUENCIA_P bigint, CNPJ_LOCAL_AGENDA_EXTERNO_P text, DS_LOCAL_AGENDA_EXTERNO_P text) AS $body$
DECLARE

  NR_SEQUENCIA_W     bigint;
  NR_SEQ_REGULACAO_W bigint;


BEGIN
  SELECT A.NR_SEQUENCIA, A.NR_SEQ_REGULACAO
    INTO STRICT NR_SEQUENCIA_W, NR_SEQ_REGULACAO_W
    FROM AGENDA_LISTA_ESPERA A
   WHERE A.NR_SEQUENCIA = NR_SEQUENCIA_P;

  IF (NR_SEQUENCIA_W IS NOT NULL AND NR_SEQUENCIA_W::text <> '') THEN
    UPDATE AGENDA_LISTA_ESPERA A
       SET A.CNPJ_LOCAL_AGENDA_EXTERNO = CNPJ_LOCAL_AGENDA_EXTERNO_P,
           A.DS_LOCAL_AGENDA_EXTERNO   = DS_LOCAL_AGENDA_EXTERNO_P,
           A.IE_STATUS_ESPERA          = 'A'
     WHERE A.NR_SEQUENCIA = NR_SEQUENCIA_W;
    IF (NR_SEQ_REGULACAO_W IS NOT NULL AND NR_SEQ_REGULACAO_W::text <> '') THEN
      CALL ALTERAR_STATUS_REGULACAO(NR_SEQ_REGULACAO_W, 2, '');
    END IF;
  END IF;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE enviar_regulacao_medicamento (NR_SEQUENCIA_P bigint, CNPJ_LOCAL_AGENDA_EXTERNO_P text, DS_LOCAL_AGENDA_EXTERNO_P text) FROM PUBLIC;

