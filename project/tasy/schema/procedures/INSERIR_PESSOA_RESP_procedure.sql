-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_pessoa_resp ( nr_seq_contrato_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint, cd_pessoa_resp_p bigint) AS $body$
DECLARE


qt_pessoa_resp_w	bigint := 0;
nm_pessoa_resp_w	varchar(255);


BEGIN

select 	count(*),
	coalesce(substr(obter_usuario_pessoa(cd_pessoa_resp_p),1,20),'X')
into STRICT 	qt_pessoa_resp_w,
	nm_pessoa_resp_w
from	contrato
where	(cd_pessoa_resp IS NOT NULL AND cd_pessoa_resp::text <> '')
and	nr_sequencia = nr_seq_contrato_p;

if (qt_pessoa_resp_w > 0) and (nm_pessoa_resp_w <> 'X')	then




insert into	contrato_usuario_lib(	nr_sequencia,
					nr_seq_contrato,
					dt_atualizacao,
					nm_usuario,
					ie_aviso_vencimento,
					nm_usuario_lib,
					ie_permite,
					IE_AVISO_REVISAO,
					IE_GERACAO)
			values ( 	nextval('contrato_usuario_lib_seq'),
					nr_seq_contrato_p,
					clock_timestamp(),
					nm_usuario_p,
					'S',
					nm_pessoa_resp_w,
					'S',
					'S',
					'U');

end if;


commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_pessoa_resp ( nr_seq_contrato_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint, cd_pessoa_resp_p bigint) FROM PUBLIC;

