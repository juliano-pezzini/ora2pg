-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ctb_desatualizar_lote ( nr_lote_contabil_p lote_contabil.nr_lote_contabil%type, nm_usuario_p usuario.nm_usuario%type, ds_erro_p INOUT text) AS $body$
DECLARE

/*
===============================================================================
Purpose: Indentacao

Remarks: n/a

Who         When            What
----------  -----------     --------------------------------------------------

dmsluniere  18/mar/2022     OS 2871719 - Indentacao

===============================================================================
*/
nr_sequencia_w          ctb_saldo.nr_sequencia%type;
nr_seq_movimento_w      ctb_movimento.nr_sequencia%type;
cd_conta_contabil_w     conta_contabil.cd_conta_contabil%type;
cd_centro_custo_w       ctb_movto_centro_custo.cd_centro_custo%type;
vl_movimento_w          ctb_movimento.vl_movimento%type;
vl_encerramento_w       ctb_movimento.vl_movimento%type;
vl_enc_debito_w         ctb_movimento.vl_movimento%type;
vl_enc_credito_w        ctb_movimento.vl_movimento%type;
vl_debito_w             ctb_movimento.vl_movimento%type;
vl_credito_w            ctb_movimento.vl_movimento%type;
vl_saldo_w              ctb_saldo.vl_saldo%type;
nr_seq_mes_ref_w        lote_contabil.nr_seq_mes_ref%type;
nr_seq_mes_ant_w        ctb_mes_ref.nr_sequencia%type;
nr_seq_ref_w            ctb_mes_ref.nr_sequencia%type;
cd_estab_lote_w         lote_contabil.cd_estabelecimento%type;
cd_estabelecimento_w    ctb_movimento.cd_estabelecimento%type;
cd_empresa_w            ctb_mes_ref.cd_empresa%type;
ie_deb_cred_w           ctb_grupo_conta.ie_debito_credito%type;
ie_centro_custo_w       varchar(01);
ie_debito_credito_w     ctb_grupo_conta.ie_debito_credito%type;
ie_encerramento_w       lote_contabil.ie_encerramento%type;
ds_erro_w               varchar(2000);
ds_erro_ww              varchar(2000);
dt_referencia_w         ctb_mes_ref.dt_referencia%type;
dt_atualizacao_w        lote_contabil.dt_atualizacao_saldo%type;
dt_consistencia_w       lote_contabil.dt_consistencia%type;
dt_abertura_w           ctb_mes_ref.dt_abertura%type;
dt_processo_w           lote_contabil.dt_processo%type;
dt_fechamento_w         ctb_mes_ref.dt_fechamento%type;
qt_movto_cc_w           bigint;
cd_classificacao_w      varchar(40);
cd_classif_sup_w        conta_contabil_classif.cd_classif_superior%type;
nr_nivel_conta_w        bigint;
ie_eliminacao_lancto_w  ctb_movimento.ie_eliminacao_lancto%type;
nr_seq_proj_rec_w       ctb_movimento.nr_seq_proj_rec%type;
ie_agrupar_projeto_w    varchar(01);
cd_perfil_w             perfil.cd_perfil%type;
qt_conciliacao_w        bigint;
cd_tipo_lote_contabil_w lote_contabil.cd_tipo_lote_contabil%type;
vl_ordem_w              ctb_saldo.vl_ordem%type;
vl_ord_debito_w         ctb_saldo.vl_ord_debito%type;
vl_ord_credito_w        ctb_saldo.vl_ord_credito%type;
ie_o_const              constant      varchar(01) := 'O';
ie_not_const            constant      varchar(01) := 'N';
ie_yes_const            constant      varchar(01) := 'S';
ie_debito_const         constant      varchar(01) := 'D';
ie_credito_const        constant      varchar(01) := 'C';
ie_month_const          constant      varchar(05) := 'month';
ie_ds_erro_const        constant      varchar(08) := 'DS_ERRO=';
tam_subst_const         constant      integer(04)  := 2000;
msg_266436              constant      integer(06)  := 266436;
msg_266437              constant      integer(06)  := 266437;
msg_313348              constant      integer(06)  := 313348;
msg_269638              constant      integer(06)  := 269638;
msg_269639              constant      integer(06)  := 269639;



type t_estab is table of boolean index by integer;
estab_w     t_estab;

C01 CURSOR FOR
SELECT  a.nr_sequencia,
        a.vl_movimento,
        a.cd_conta_debito,
        CASE WHEN coalesce(a.cd_conta_debito::text, '') = '' THEN null  ELSE ie_debito_const END ,
        b.ie_centro_custo,
        c.ie_debito_credito,
        CASE WHEN ie_encerramento_w=ie_not_const THEN 0  ELSE a.vl_movimento END  vl_encerramento,
        CASE WHEN cd_tipo_lote_contabil_w=59 THEN a.vl_movimento  ELSE 0 END  vl_ordem,
        b.cd_classificacao,
        coalesce(a.cd_estabelecimento, cd_estab_lote_w) cd_estabelecimento,
        a.ie_eliminacao_lancto
from    ctb_grupo_conta c,
        conta_contabil b,
        ctb_movimento a
where   a.nr_lote_contabil  = nr_lote_contabil_p
and     a.cd_conta_debito   = b.cd_conta_contabil
and     b.cd_grupo          = c.cd_grupo

union all

SELECT  a.nr_sequencia,
        a.vl_movimento,
        a.cd_conta_credito,
        CASE WHEN coalesce(a.cd_conta_credito::text, '') = '' THEN null  ELSE ie_credito_const END ,
        b.ie_centro_custo,
        c.ie_debito_credito,
        CASE WHEN ie_encerramento_w=ie_not_const THEN 0  ELSE a.vl_movimento END  vl_encerramento,
        CASE WHEN cd_tipo_lote_contabil_w=59 THEN a.vl_movimento  ELSE 0 END  vl_ordem,
        b.cd_classificacao,
        coalesce(a.cd_estabelecimento, cd_estab_lote_w) cd_estabelecimento,
        a.ie_eliminacao_lancto
from    ctb_grupo_conta c,
        conta_contabil b,
        ctb_movimento a
where   a.nr_lote_contabil  = nr_lote_contabil_p
and     a.cd_conta_credito  = b.cd_conta_contabil
and     b.cd_grupo          = c.cd_grupo;

C02 CURSOR FOR
SELECT  cd_centro_custo,
        vl_movimento * -1,
        CASE WHEN ie_encerramento_w=ie_not_const THEN 0  ELSE vl_movimento * -1 END  vl_encerramento
from    ctb_movto_centro_custo
where   nr_seq_movimento    = nr_seq_movimento_w
and     ie_centro_custo_w   in (ie_yes_const,ie_o_const)

union all

SELECT  0,
        vl_movimento_w * -1,
        vl_encerramento_w * -1

where   ((ie_centro_custo_w = ie_not_const) or (qt_movto_cc_w = 0));

C03 CURSOR FOR
SELECT distinct nr_seq_proj_rec from (
SELECT
        a.nr_seq_proj_rec
from    ctb_grupo_conta c,
        Conta_contabil b,
        ctb_movimento a
where   a.nr_lote_contabil  = nr_lote_contabil_p
and     a.cd_conta_debito   = b.cd_conta_contabil
and     b.cd_grupo          = c.cd_grupo
and     (a.nr_seq_proj_rec IS NOT NULL AND a.nr_seq_proj_rec::text <> '')

union all

select  a.nr_seq_proj_rec
from    ctb_grupo_conta c,
        Conta_contabil b,
        ctb_movimento a
where   a.nr_lote_contabil  = nr_lote_contabil_p
and     a.cd_conta_credito  = b.cd_conta_contabil
and     b.cd_grupo          = c.cd_grupo
and     (a.nr_seq_proj_rec IS NOT NULL AND a.nr_seq_proj_rec::text <> '')) alias2;

C09 CURSOR FOR
SELECT  nr_sequencia
from    ctb_mes_ref
where   cd_empresa      = cd_empresa_w
and     (dt_abertura IS NOT NULL AND dt_abertura::text <> '')
and     coalesce(dt_fechamento::text, '') = ''
and     1 = 2
and     dt_referencia   >= PKG_DATE_UTILS.start_of(PKG_DATE_UTILS.ADD_MONTH(dt_referencia_w,1,0),ie_month_const,0);


BEGIN

cd_perfil_w     := wheb_usuario_pck.get_cd_perfil;

begin
    select nr_seq_mes_ref,
           cd_estabelecimento,
           dt_atualizacao_saldo,
           dt_consistencia,
           coalesce(ie_encerramento,ie_not_const),
           cd_tipo_lote_contabil
    into STRICT   nr_seq_mes_ref_w,
           cd_estab_lote_w,
           dt_atualizacao_w,
           dt_consistencia_w,
           ie_encerramento_w,
           cd_tipo_lote_contabil_w
    from   lote_contabil
    where  nr_lote_contabil = nr_lote_contabil_p;
exception
when no_data_found then
     ds_erro_w   := SUBSTR(sqlerrm, 1, tam_subst_const);
     CALL wheb_mensagem_pck.exibir_mensagem_abort(ds_mensagem_erro_p => ds_erro_w);
when too_many_rows then
     ds_erro_w   := SUBSTR(sqlerrm, 1, tam_subst_const);
     CALL wheb_mensagem_pck.exibir_mensagem_abort(ds_mensagem_erro_p => ds_erro_w);
end;

begin
    select cd_empresa,
           dt_referencia,
           dt_abertura,
           dt_fechamento
    into STRICT   cd_empresa_w,
           dt_referencia_w,
           dt_abertura_w,
           dt_fechamento_w
    from   ctb_mes_ref
    where  nr_sequencia     = nr_seq_mes_ref_w;
exception
when no_data_found then
     ds_erro_w   := SUBSTR(sqlerrm, 1, tam_subst_const);
     CALL wheb_mensagem_pck.exibir_mensagem_abort(ds_mensagem_erro_p => ds_erro_w);
when too_many_rows then
     ds_erro_w   := SUBSTR(sqlerrm, 1, tam_subst_const);
     CALL wheb_mensagem_pck.exibir_mensagem_abort(ds_mensagem_erro_p => ds_erro_w);
end;

begin
    select coalesce(max(nr_sequencia),0)
    into STRICT   nr_seq_mes_ant_w
    from   ctb_mes_ref
    where  cd_empresa       = cd_empresa_w
    and    dt_referencia    = PKG_DATE_UTILS.start_of(PKG_DATE_UTILS.ADD_MONTH(dt_referencia_w,-1,0),ie_month_const,0);
exception
when no_data_found then
     ds_erro_w   := SUBSTR(sqlerrm, 1, tam_subst_const);
     CALL wheb_mensagem_pck.exibir_mensagem_abort(ds_mensagem_erro_p => ds_erro_w);
when too_many_rows then
     ds_erro_w   := SUBSTR(sqlerrm, 1, tam_subst_const);
     CALL wheb_mensagem_pck.exibir_mensagem_abort(ds_mensagem_erro_p => ds_erro_w);
end;

if (coalesce(dt_atualizacao_w::text, '') = '')  then

    /*O Lote nao foi atualizado');*/

    CALL wheb_mensagem_pck.exibir_mensagem_abort(nr_seq_mensagem_p => msg_266436);

end if;

if (coalesce(dt_abertura_w::text, '') = '') or (dt_fechamento_w IS NOT NULL AND dt_fechamento_w::text <> '') then

    CALL wheb_mensagem_pck.exibir_mensagem_abort(nr_seq_mensagem_p => msg_266437);

end if;

begin
    select 1
    into STRICT   qt_conciliacao_w

    where  exists ( SELECT 1
                    from   ctb_movimento a
                    where  a.nr_lote_contabil  = nr_lote_contabil_p
                    and    (a.nr_seq_reg_concil IS NOT NULL AND a.nr_seq_reg_concil::text <> ''));
exception
when no_data_found then
     qt_conciliacao_w    := 0;
when too_many_rows then
     qt_conciliacao_w    := 1;
end;

if (qt_conciliacao_w > 0)then

    --Nao possivel desfazer um lote que esta sendo conciliado!
    CALL wheb_mensagem_pck.exibir_mensagem_abort(nr_seq_mensagem_p => msg_313348);

end if;

CALL ctb_gravar_log_lote(
                    nr_lote_contabil_p   => nr_lote_contabil_p,
                    cd_log_lote_p        => 6,
                    ds_log_p             => null,
                    nm_usuario_p         => nm_usuario_p
                    );

OPEN   C01;
LOOP
FETCH  C01 INTO
       nr_seq_movimento_w,
       vl_movimento_w,
       cd_conta_contabil_w,
       ie_deb_cred_w,
       ie_centro_custo_w,
       ie_debito_credito_w,
       vl_encerramento_w,
       vl_ordem_w,
       cd_classificacao_w,
       cd_estabelecimento_w,
       ie_eliminacao_lancto_w;
EXIT WHEN NOT FOUND; /* apply on C01 */

    -- Adiciona os estabelecimento que serao percorridos posteriormente para chamar a acumula_saldo
    if (not estab_w.exists(cd_estabelecimento_w)) then

            estab_w(cd_estabelecimento_w) := true;

    end if;

    cd_classificacao_w  := substr(ctb_obter_classif_conta(cd_conta_contabil_w, null, dt_referencia_w),1,40);
    cd_classif_sup_w    := substr(ctb_obter_classif_conta_sup(cd_classificacao_w, dt_referencia_w, cd_empresa_w),1,40);
    nr_nivel_conta_w    := ctb_obter_nivel_classif_conta(cd_classificacao_w);

    begin
        select  1
        into STRICT    qt_movto_cc_w

        where   exists ( SELECT  1
                         from    ctb_movto_centro_custo
                         where   nr_seq_movimento    = nr_seq_movimento_w );
    exception
    when no_data_found then
         qt_movto_cc_w    := 0;
    when too_many_rows then
         qt_movto_cc_w    := 1;
    end;

    if (ie_encerramento_w = ie_not_const) and (ie_centro_custo_w = ie_o_const) then

        /*Se o centro for Opcional e Nao tiver movimento - operacao normal */

        if (qt_movto_cc_w = 0) then

            ie_centro_custo_w   := ie_not_const;

        end if;
    end if;

    OPEN    C02;
    LOOP
    FETCH   C02 INTO
        cd_centro_custo_w,
        vl_movimento_w,
        vl_encerramento_w;
    EXIT WHEN NOT FOUND; /* apply on C02 */
        if (cd_centro_custo_w = 0) then

            cd_centro_custo_w  := null;

        end if;

        select coalesce(max(nr_sequencia),0)
        into STRICT   nr_sequencia_w
        from   ctb_saldo
        where  nr_seq_mes_ref         = nr_seq_mes_ref_w
        and    cd_estabelecimento     = cd_estabelecimento_w
        and    cd_conta_contabil      = cd_conta_contabil_w
        and    coalesce(cd_centro_custo,0) = coalesce(cd_centro_custo_w,0);

        if (nr_sequencia_w = 0) then

            vl_saldo_w      := 0;

            select nextval('ctb_saldo_seq')
            into STRICT   nr_sequencia_w
;

            if (nr_seq_mes_ant_w > 0) then

                select coalesce(max(vl_saldo),0)
                into STRICT   vl_saldo_w
                from   ctb_saldo
                where  nr_seq_mes_ref         = nr_seq_mes_ant_w
                and    cd_estabelecimento     = cd_estabelecimento_w
                and    cd_conta_contabil      = cd_conta_contabil_w
                and    coalesce(cd_centro_custo,0) = coalesce(cd_centro_custo_w,0);

            end if;

            begin
                insert into ctb_saldo(
                    nr_sequencia,
                    nr_seq_mes_ref,
                    dt_atualizacao,
                    nm_usuario,
                    cd_estabelecimento,
                    cd_conta_contabil,
                    cd_centro_custo,
                    vl_debito,
                    vl_encerramento,
                    vl_credito,
                    vl_movimento,
                    vl_saldo,
                    vl_enc_debito,
                    vl_enc_credito,
                    cd_classificacao,
                    cd_classif_sup,
                    nr_nivel_conta,
                    vl_ordem, vl_ord_debito, vl_ord_credito) --Utilizado no cd_tipo_lote 59 (Contas de Ordem) - Disponivel somente mexico
                values (nr_sequencia_w,
                    nr_seq_mes_ref_w,
                    clock_timestamp(),
                    nm_usuario_p,
                    cd_estabelecimento_w,
                    cd_conta_contabil_w,
                    cd_centro_custo_w,
                    0, 0, 0, 0,
                    vl_saldo_w,
                    0,
                    0,
                    cd_classificacao_w,
                    cd_classif_sup_w,
                    nr_nivel_conta_w,
                    0, 0, 0); --Utilizado no cd_tipo_lote 59 (Contas de Ordem) - Disponivel somente mexico
            exception
                when access_into_null then
                     ds_erro_w   := sqlerrm(SQLSTATE);
                     --(-20011,'Erro ao Inserir Saldo: (1)' || chr(13) ||ds_erro_w || '#@#@');
                     CALL wheb_mensagem_pck.exibir_mensagem_abort(
                                                nr_seq_mensagem_p => msg_269638,
                                                vl_macros_p       => ie_ds_erro_const||ds_erro_w
                                                );
                when unique_violation then
                     ds_erro_w   := sqlerrm(SQLSTATE);
                     --(-20011,'Erro ao Inserir Saldo: (1)' || chr(13) ||ds_erro_w || '#@#@');
                     CALL wheb_mensagem_pck.exibir_mensagem_abort(
                                                nr_seq_mensagem_p => msg_269638,
                                                vl_macros_p       => ie_ds_erro_const||ds_erro_w
                                                );
                when others then
                     ds_erro_w   := sqlerrm(SQLSTATE);
                     --(-20011,'Erro ao Inserir Saldo: (1)' || chr(13) ||ds_erro_w || '#@#@');
                     CALL wheb_mensagem_pck.exibir_mensagem_abort(
                                                nr_seq_mensagem_p => msg_269638,
                                                vl_macros_p       => ie_ds_erro_const||ds_erro_w
                                                );
            end;

        end if;

        vl_debito_w            := 0;
        vl_credito_w           := 0;
        vl_enc_debito_w        := 0;
        vl_enc_credito_w       := 0;
        vl_ord_debito_w        := 0;
        vl_ord_credito_w       := 0;

        if (ie_deb_cred_w     = ie_debito_const) then

            vl_debito_w        := vl_movimento_w;
            vl_enc_debito_w    := vl_encerramento_w;
            vl_ord_debito_w    := coalesce(vl_ordem_w,0);

        else

            vl_credito_w       := vl_movimento_w;
            vl_enc_credito_w   := vl_encerramento_w;
            vl_ord_credito_w   := coalesce(vl_ordem_w,0);

        end if;

        if (ie_debito_credito_w <> ie_deb_cred_w) then

            vl_movimento_w     := vl_movimento_w * -1;
            vl_encerramento_w  := vl_encerramento_w * -1;
            vl_ordem_w         := vl_ordem_w * -1; --Utilizado no cd_tipo_lote 59 (Contas de Ordem) - Disponivel somente mexico
        end if;

        begin
            update  ctb_saldo
            set     dt_atualizacao   = clock_timestamp(),
                    nm_usuario       = nm_usuario_p,
                    vl_debito        = vl_debito + vl_debito_w,
                    vl_credito       = vl_credito + vl_credito_w,
                    vl_saldo         = vl_saldo + vl_movimento_w,
                    vl_movimento     = vl_movimento + vl_movimento_w,
                    vl_encerramento  = vl_encerramento + vl_encerramento_w,
                    vl_enc_debito    = vl_enc_debito + vl_enc_debito_w,
                    vl_enc_credito   = vl_enc_credito + vl_enc_credito_w,
                    vl_eliminacao    = coalesce(vl_eliminacao,0) + CASE WHEN ie_eliminacao_lancto_w=ie_yes_const THEN  vl_movimento_w  ELSE 0 END ,
                    cd_classificacao = cd_classificacao_w,
                    cd_classif_sup   = cd_classif_sup_w,
                    nr_nivel_conta   = nr_nivel_conta_w,
                    vl_ordem         = vl_ordem_w,
                    vl_ord_debito    = vl_ord_debito_w,
                    vl_ord_credito   = vl_ord_credito_w
            where   nr_sequencia     = nr_sequencia_w;
        exception
            when access_into_null then
                 ds_erro_w   := sqlerrm(SQLSTATE);
                 --(-20011,'Erro ao Inserir Saldo: (2)' || chr(13) ||ds_erro_w || '#@#@');
                 CALL wheb_mensagem_pck.exibir_mensagem_abort(
                                            nr_seq_mensagem_p => msg_269639,
                                            vl_macros_p       => ie_ds_erro_const||ds_erro_w
                                            );
            when unique_violation then
                 ds_erro_w   := sqlerrm(SQLSTATE);
                 --(-20011,'Erro ao Inserir Saldo: (2)' || chr(13) ||ds_erro_w || '#@#@');
                 CALL wheb_mensagem_pck.exibir_mensagem_abort(
                                            nr_seq_mensagem_p => msg_269639,
                                            vl_macros_p       => ie_ds_erro_const||ds_erro_w
                                            );
            when others then
                 ds_erro_w   := sqlerrm(SQLSTATE);
                 --(-20011,'Erro ao Inserir Saldo: (2)' || chr(13) ||ds_erro_w || '#@#@');
                 CALL wheb_mensagem_pck.exibir_mensagem_abort(
                                            nr_seq_mensagem_p => msg_269639,
                                            vl_macros_p       => ie_ds_erro_const||ds_erro_w
                                            );
        end;

        OPEN    C09;
        LOOP
        FETCH   C09 INTO
            nr_seq_ref_w;
        EXIT WHEN NOT FOUND; /* apply on C09 */

            update  ctb_saldo
            set     dt_atualizacao         = clock_timestamp(),
                    nm_usuario             = nm_usuario_p,
                    vl_saldo               = vl_saldo + vl_movimento_w
            where   nr_seq_mes_ref         = nr_seq_ref_w
            and     cd_estabelecimento     = cd_estabelecimento_w
            and     cd_conta_contabil      = cd_conta_contabil_w
            and     coalesce(cd_centro_custo,0) = coalesce(cd_centro_custo_w,0);

        END LOOP;
        CLOSE C09;
    END LOOP;
    CLOSE C02;
END LOOP;
CLOSE C01;

update  ctb_movimento
set     dt_atualizacao_saldo   = NULL
where   nr_lote_contabil      = nr_lote_contabil_p;

update  lote_contabil
set     dt_atualizacao_saldo   = NULL,
        dt_consistencia        = NULL
where   nr_lote_contabil      = nr_lote_contabil_p;

commit;

cd_estabelecimento_w := estab_w.first;

while (cd_estabelecimento_w IS NOT NULL AND cd_estabelecimento_w::text <> '') loop

    ds_erro_p              => ds_erro_w
                     := ctb_acumular_saldo(
                    nr_seq_mes_ref_p       => nr_seq_mes_ref_w, cd_estabelecimento_p   => cd_estabelecimento_w, nm_usuario_p           => nm_usuario_p, ds_erro_p              => ds_erro_w
                    );

    cd_estabelecimento_w := estab_w.next(cd_estabelecimento_w);

end loop;

ds_erro_p   := ds_erro_w;

vl_parametro_p        => ie_agrupar_projeto_w
                     := obter_param_usuario(
                    cd_funcao_p           => 923, nr_sequencia_p        => 125, cd_perfil_p           => cd_perfil_w, nm_usuario_p          => nm_usuario_p, cd_estabelecimento_p  => cd_estabelecimento_w, vl_parametro_p        => ie_agrupar_projeto_w
                    );

if (ie_agrupar_projeto_w = ie_yes_const) then

    open    C03;
    loop
    fetch   C03 into
        nr_seq_proj_rec_w;
    EXIT WHEN NOT FOUND; /* apply on C03 */

        ds_erro_p             => ds_erro_ww
                     := ctb_desatualizar_lote_projeto(
                    nr_lote_contabil_p    => nr_lote_contabil_p, nm_usuario_p          => nm_usuario_p, nr_seq_proj_rec_p     => nr_seq_proj_rec_w, ds_erro_p             => ds_erro_ww
                    );

    end loop;
    close C03;

    if coalesce(ds_erro_p::text, '') = '' then

        ds_erro_p   := ds_erro_ww;

    end if;

end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ctb_desatualizar_lote ( nr_lote_contabil_p lote_contabil.nr_lote_contabil%type, nm_usuario_p usuario.nm_usuario%type, ds_erro_p INOUT text) FROM PUBLIC;

