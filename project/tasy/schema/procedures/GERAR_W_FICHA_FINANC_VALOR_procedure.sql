-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_w_ficha_financ_valor ( cd_pessoa_fisica_p text, cd_cgc_p text, dt_referencia_p timestamp, nm_usuario_p text, cd_estabelecimento_p bigint, ie_aberto_p text, ie_titulo_receb_p INOUT text, ie_adiantamento_p INOUT text, ie_cheque_p INOUT text, ie_cobranca_p INOUT text, ie_conta_paciente_p INOUT text, ie_titulo_pagar_p INOUT text, ie_adiantamento_pago_p INOUT text, ie_repasse_p INOUT text, ie_receb_cartao_p INOUT text, ie_protocolo_p INOUT text, ie_mensalidade_p INOUT text, ie_negociacao_cr_p INOUT text, ie_nota_credito_p INOUT text, ie_perdas_p INOUT text, ie_spa_p INOUT text) AS $body$
DECLARE

 
dt_referencia_w		timestamp;
ie_titulo_receb_w	varchar(1);
ie_adiantamento_w	varchar(1);
ie_cheque_w 		varchar(1);
ie_cobranca_w		varchar(1);
ie_conta_paciente_w	varchar(1);
ie_titulo_pagar_w	varchar(1);
ie_adiantamento_pago_W	varchar(1);
ie_repasse_w		varchar(1);
ie_recb_cartao_w	varchar(1);
ie_protocolo_w		varchar(1);
ie_mensalidade_w	varchar(1);
ie_negociacao_cr_w	varchar(1);
ie_nota_credito_w	varchar(1);
ie_perdas_w		varchar(1);
ie_spa_w		varchar(1);


BEGIN 
 
ie_titulo_receb_w	:= 'N';
ie_adiantamento_w	:= 'N';
ie_cheque_w 		:= 'N';
ie_cobranca_w		:= 'N';
ie_conta_paciente_w	:= 'N';
ie_titulo_pagar_w	:= 'N';
ie_adiantamento_pago_w	:= 'N';
ie_repasse_w		:= 'N';
ie_recb_cartao_W	:= 'N';
ie_protocolo_w		:= 'N';
ie_mensalidade_w	:= 'N';
ie_negociacao_cr_w	:= 'N';
ie_nota_credito_w	:= 'N';
ie_perdas_w		:= 'N';
ie_spa_w		:= 'N';
 
 
delete from w_ficha_financ_valor where nm_usuario = nm_usuario_p;
 
 
dt_referencia_w	:= fim_dia(dt_referencia_p);
 
 
gerar_w_ficha_financ_valor_cr(cd_pessoa_fisica_p,cd_cgc_p,dt_referencia_p,nm_usuario_p,cd_estabelecimento_p,ie_aberto_p);
CALL gerar_w_ficha_financ_valor_cp(cd_pessoa_fisica_p,cd_cgc_p,dt_referencia_p,nm_usuario_p,cd_estabelecimento_p,ie_aberto_p);
 
select	CASE WHEN sum(CASE WHEN ie_tipo_valor='03' THEN vl_ficha  ELSE 0 END )=0 THEN 'N'  ELSE 'S' END , 
	CASE WHEN sum(CASE WHEN ie_tipo_valor='04' THEN vl_ficha  ELSE 0 END )=0 THEN 'N'  ELSE 'S' END , 
	CASE WHEN sum(CASE WHEN ie_tipo_valor='05' THEN vl_ficha  ELSE 0 END )=0 THEN 'N'  ELSE 'S' END , 
	CASE WHEN sum(CASE WHEN ie_tipo_valor='06' THEN vl_ficha  ELSE 0 END )=0 THEN 'N'  ELSE 'S' END , 
	CASE WHEN sum(CASE WHEN ie_tipo_valor='02' THEN vl_ficha  ELSE 0 END )=0 THEN 'N'  ELSE 'S' END , 
	CASE WHEN sum(CASE WHEN ie_tipo_valor='52' THEN vl_ficha  ELSE 0 END )=0 THEN 'N'  ELSE 'S' END , 
	CASE WHEN sum(CASE WHEN ie_tipo_valor='53' THEN vl_ficha  ELSE 0 END )=0 THEN 'N'  ELSE 'S' END , 
	CASE WHEN sum(CASE WHEN ie_tipo_valor='54' THEN vl_ficha  ELSE 0 END )=0 THEN 'N'  ELSE 'S' END ,	 
	CASE WHEN sum(CASE WHEN ie_tipo_valor='13' THEN vl_ficha  ELSE 0 END )=0 THEN 'N'  ELSE 'S' END , 
	CASE WHEN sum(CASE WHEN ie_tipo_valor='18' THEN vl_ficha  ELSE 0 END )=0 THEN 'N'  ELSE 'S' END , 
	CASE WHEN sum(CASE WHEN ie_tipo_valor='19' THEN vl_ficha  ELSE 0 END )=0 THEN 'N'  ELSE 'S' END , 
	CASE WHEN sum(CASE WHEN ie_tipo_valor='21' THEN vl_ficha  ELSE 0 END )=0 THEN 'N'  ELSE 'S' END , 
	CASE WHEN sum(CASE WHEN ie_tipo_valor='22' THEN vl_ficha  ELSE 0 END )=0 THEN 'N'  ELSE 'S' END , 
	CASE WHEN sum(CASE WHEN ie_tipo_valor='24' THEN vl_ficha  ELSE 0 END )=0 THEN 'N'  ELSE 'S' END , 
	CASE WHEN sum(CASE WHEN ie_tipo_valor='26' THEN vl_ficha  ELSE 0 END )=0 THEN 'N'  ELSE 'S' END 	 
into STRICT	ie_titulo_receb_w, 
	ie_adiantamento_w, 
	ie_cheque_w, 
	ie_cobranca_w, 
	ie_conta_paciente_w, 
	ie_titulo_pagar_w, 
	ie_adiantamento_pago_w, 
	ie_repasse_w, 
	ie_recb_cartao_w, 
	ie_protocolo_w, 
	ie_mensalidade_w, 
	ie_negociacao_cr_w, 
	ie_nota_credito_w, 
	ie_perdas_w, 
	ie_spa_w 
from	w_ficha_financ_valor 
where	nm_usuario	=	nm_usuario_p;	
 
ie_titulo_receb_p  	:= ie_titulo_receb_w;
ie_adiantamento_p  	:= ie_adiantamento_w;
ie_cheque_p   	:= ie_cheque_w;
ie_cobranca_p  	:= ie_cobranca_w;
ie_conta_paciente_p  	:= ie_conta_paciente_w;
ie_titulo_pagar_p	:= ie_titulo_pagar_w;
ie_adiantamento_pago_p	:= ie_adiantamento_pago_w;
ie_repasse_p		:= ie_repasse_w;
ie_receb_cartao_p	:= ie_recb_cartao_w;
ie_protocolo_p		:= ie_protocolo_w;
ie_mensalidade_p	:= ie_mensalidade_w;
ie_negociacao_cr_p	:= ie_negociacao_cr_w;
ie_nota_credito_p	:= ie_nota_credito_w;
ie_perdas_p		:= ie_perdas_w;
ie_spa_p		:= ie_spa_w;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_w_ficha_financ_valor ( cd_pessoa_fisica_p text, cd_cgc_p text, dt_referencia_p timestamp, nm_usuario_p text, cd_estabelecimento_p bigint, ie_aberto_p text, ie_titulo_receb_p INOUT text, ie_adiantamento_p INOUT text, ie_cheque_p INOUT text, ie_cobranca_p INOUT text, ie_conta_paciente_p INOUT text, ie_titulo_pagar_p INOUT text, ie_adiantamento_pago_p INOUT text, ie_repasse_p INOUT text, ie_receb_cartao_p INOUT text, ie_protocolo_p INOUT text, ie_mensalidade_p INOUT text, ie_negociacao_cr_p INOUT text, ie_nota_credito_p INOUT text, ie_perdas_p INOUT text, ie_spa_p INOUT text) FROM PUBLIC;

