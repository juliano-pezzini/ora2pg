-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gerar_guia_lote_anexo ( nr_seq_lote_p bigint, nm_usuario_p text) AS $body$
DECLARE

      
CO1 CURSOR FOR
	SELECT	 nr_sequencia, nr_seq_guia, ie_recem_nascido,
		 ds_justificativa, ds_especificacao, ds_biometria
	from	 pls_lote_anexo_guias_aut 
	where	 nr_seq_lote_anexo = nr_seq_lote_p;
		
nr_seq_guia_plano_w	bigint;
	
BEGIN
for	r_c01 in CO1 loop
	begin
	
		select	nextval('pls_guia_plano_seq')
		into STRICT	nr_seq_guia_plano_w
		;
	
		insert into 	pls_guia_plano(nr_sequencia, dt_atualizacao, nm_usuario,
				dt_atualizacao_nrec, nm_usuario_nrec, nr_seq_segurado,
				cd_guia, ie_tipo_guia, ie_situacao,
				cd_estabelecimento, ie_tipo_processo, ie_status,
				dt_solicitacao, nr_seq_plano, ie_estagio,
				dt_cancelamento, dt_autorizacao, cd_medico_solicitante, 
				nr_seq_prestador,ie_carater_internacao, cd_guia_principal, 
				nr_seq_conselho, dt_emissao, nr_seq_uni_exec,
				ie_tipo_atend_tiss, nr_seq_motivo_cancel, nr_seq_motivo_lib, 
				ds_indicacao_clinica, ds_observacao, nr_seq_guia_principal,
				nm_usuario_atendimento, nr_seq_atend_pls, nr_seq_evento_atend,
				nm_usuario_solic, ie_origem_solic, dt_duplicacao_guia,
				cd_guia_manual,nr_seq_clinica,ie_regime_internacao,
				nr_seq_tipo_acomodacao, qt_dia_solicitado, cd_especialidade,
				ie_recem_nascido, dt_nasc_recem_nascido, nm_recem_nascido,
				ds_biometria, nr_seq_lote_anexo_guia, ie_saude_ocupacional, 
				ie_regime_atendimento, ie_cobertura_especial)
			(SELECT	nr_seq_guia_plano_w, clock_timestamp(), nm_usuario_p,
				clock_timestamp(), nm_usuario_p, nr_seq_segurado,
				nr_seq_guia_plano_w, '2', 'U',
				cd_estabelecimento, 'E', 2,
				clock_timestamp(), nr_seq_plano, 7,
				'', '', cd_medico_solicitante, 
				nr_seq_prestador,ie_carater_internacao, cd_guia, 
				nr_seq_conselho, dt_emissao, nr_seq_uni_exec,
				ie_tipo_atend_tiss, null, nr_seq_motivo_lib, 
				ds_indicacao_clinica, ds_observacao, nr_sequencia,
				nm_usuario_p, nr_seq_atend_pls, nr_seq_evento_atend,
				nm_usuario_p, 'M', clock_timestamp(),
				cd_guia_manual,nr_seq_clinica,ie_regime_internacao,
				nr_seq_tipo_acomodacao, qt_dia_solicitado, cd_especialidade,
				r_c01.ie_recem_nascido, dt_nasc_recem_nascido, nm_recem_nascido,
				r_c01.ds_biometria, r_c01.nr_sequencia, ie_saude_ocupacional, 
				ie_regime_atendimento, ie_cobertura_especial
			from	pls_guia_plano
			where	nr_sequencia	= r_c01.nr_seq_guia);
			
		insert into 	pls_guia_plano_proc(nr_sequencia, dt_atualizacao, nm_usuario,
				dt_atualizacao_nrec, nm_usuario_nrec, nr_seq_guia,
				cd_procedimento, ie_origem_proced, qt_autorizada,
				qt_solicitada, ie_status, cd_tipo_tabela_imp,
				ie_utilizado, ie_origem_inclusao)
		        (SELECT	nextval('pls_guia_plano_proc_seq'), clock_timestamp(), nm_usuario_p,
				clock_timestamp(), nm_usuario_p, nr_seq_guia_plano_w,
				cd_procedimento, ie_origem_proced, 0,
				qt_solicitado, 'U', cd_tipo_tabela,
				'N', 'P'
			from	pls_lote_anexo_proc_aut
			where	nr_seq_lote_anexo_guia = r_c01.nr_sequencia);
			
		insert into 	pls_guia_plano_mat(nr_sequencia, dt_atualizacao, nm_usuario,
				dt_atualizacao_nrec, nm_usuario_nrec, nr_seq_guia,
				qt_solicitada, qt_autorizada, ie_status,
				cd_material_imp, ds_material_imp,  cd_tipo_tabela_imp,
				nr_seq_material, ie_utilizado, ie_origem_inclusao, 
				vl_material, vl_original)
			(SELECT	nextval('pls_guia_plano_mat_seq'), clock_timestamp(), nm_usuario_p,
				clock_timestamp(), nm_usuario_p, nr_seq_guia_plano_w,
				qt_solicitado, qt_autorizado, 'U',
				cd_material, ds_material, cd_tipo_tabela_imp,
				nr_seq_material, 'N', 'P',  
				vl_unit_material_aut, vl_unit_material_solic
			from	pls_lote_anexo_mat_aut
			where	nr_seq_lote_anexo_guia = r_c01.nr_sequencia );
			
		insert into 	pls_diagnostico(cd_doenca, ds_diagnostico, dt_atualizacao,
				dt_atualizacao_nrec, ie_classificacao, nr_seq_guia, 
				nr_sequencia, nm_usuario, nm_usuario_nrec)
			(SELECT	cd_doenca, ds_diagnostico, clock_timestamp(),
				clock_timestamp(), ie_classificacao, nr_seq_guia_plano_w,
				nextval('pls_diagnostico_seq'), nm_usuario_p, nm_usuario_p
			from	pls_lote_anexo_diag_aut
			where	nr_seq_lote_anexo_guia = r_c01.nr_sequencia);
			
	end;
end loop;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_guia_lote_anexo ( nr_seq_lote_p bigint, nm_usuario_p text) FROM PUBLIC;

