-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_wocupacao_leito ( NM_USUARIO_P text, CD_ESTAB_OCUPACAO_P bigint, CD_PERFIL_P bigint, CD_SETOR_ATENDIMENTO_P bigint, IE_PARAM_266_P text, IE_REGR_PRONT_P text, NR_SEQ_INTERNO_P bigint DEFAULT NULL, IE_DEPARTAMENTO_P text DEFAULT 'N', IE_SAIDA_TEMPORARIA_P text DEFAULT 'N', IE_HTML5_P text DEFAULT 'N') AS $body$
DECLARE


NR_ATENDIMENTO_w   					ocupacao_unidade_v. NR_ATENDIMENTO %type;
DT_ENTRADA_UNIDADE_w   				ocupacao_unidade_v. DT_ENTRADA_UNIDADE %type;
CD_UNIDADE_w   						ocupacao_unidade_v. CD_UNIDADE %type;
CD_UNIDADE_BASICA_w   				ocupacao_unidade_v. CD_UNIDADE_BASICA %type;
CD_UNIDADE_COMPL_w   				ocupacao_unidade_v. CD_UNIDADE_COMPL %type;
DT_ENTRADA_w   						ocupacao_unidade_v. DT_ENTRADA %type; --Utilizar o campo dt_entrada_hosp no select, com alias DT_ENTRADA
NM_PESSOA_FISICA_w   				ocupacao_unidade_v. NM_PESSOA_FISICA %type;
CD_SETOR_ATENDIMENTO_w   			ocupacao_unidade_v. CD_SETOR_ATENDIMENTO %type;
CD_PESSOA_FISICA_w   				ocupacao_unidade_v. CD_PESSOA_FISICA %type;
DT_NASCIMENTO_w   					ocupacao_unidade_v. DT_NASCIMENTO %type;
NR_PRONTUARIO_w   					ocupacao_unidade_v. NR_PRONTUARIO %type;
IE_STATUS_UNIDADE_w   				ocupacao_unidade_v. IE_STATUS_UNIDADE %type;
IE_SEXO_w   						ocupacao_unidade_v. IE_SEXO %type;
DS_CONVENIO_w   					ocupacao_unidade_v. DS_CONVENIO %type;
DS_CATEGORIA_w   					ocupacao_unidade_v. DS_CATEGORIA %type;--Utilizar o campo ds_categ no select com o alias DS_CATEGORIA
CD_PACIENTE_RESERVA_w   			ocupacao_unidade_v. CD_PACIENTE_RESERVA %type;
NM_PACIENTE_RESERVA_w   			ocupacao_unidade_v. NM_PACIENTE_RESERVA %type;
CD_CONVENIO_RESERVA_w   			ocupacao_unidade_v. CD_CONVENIO_RESERVA %type;
NM_CONVENIO_RESERVA_w   			ocupacao_unidade_v. NM_CONVENIO_RESERVA %type;
NM_USUARIO_RESERVA_w   				ocupacao_unidade_v. NM_USUARIO_RESERVA %type;
NR_CRM_w   							ocupacao_unidade_v. NR_CRM %type;
NM_GUERRA_w   						ocupacao_unidade_v. NM_GUERRA %type;
IE_CLASSE_ACOMODACAO_w   			ocupacao_unidade_v. IE_CLASSE_ACOMODACAO %type;
IE_SEXO_PACIENTE_w   				ocupacao_unidade_v. IE_SEXO_PACIENTE %type;
IE_SEXO_FIXO_w   					ocupacao_unidade_v. IE_SEXO_FIXO %type;
DS_STATUS_UNIDADE_w   				ocupacao_unidade_v. DS_STATUS_UNIDADE %type;
DS_OBSERVACAO_w   					ocupacao_unidade_v. DS_OBSERVACAO %type;
QT_DIA_PERMANENCIA_w   				ocupacao_unidade_v. QT_DIA_PERMANENCIA %type;
DS_CLINICA_w   						ocupacao_unidade_v. DS_CLINICA %type;
DT_INICIO_HIGIENIZACAO_w   			ocupacao_unidade_v. DT_INICIO_HIGIENIZACAO %type;
DT_HIGIENIZACAO_w   				ocupacao_unidade_v. DT_HIGIENIZACAO %type;
NR_SEQ_INTERNO_w   					ocupacao_unidade_v. NR_SEQ_INTERNO %type;
DT_PREVISTO_ALTA_w   				ocupacao_unidade_v. DT_PREVISTO_ALTA %type;
DT_ALTA_MEDICO_w   					ocupacao_unidade_v. DT_ALTA_MEDICO %type;
NM_USUARIO_HIGIENIZACAO_w   		ocupacao_unidade_v. NM_USUARIO_HIGIENIZACAO %type;
NM_USUARIO_FIM_HIGIENIZACAO_w  		ocupacao_unidade_v. NM_USUARIO_FIM_HIGIENIZACAO %type;
NR_RAMAL_w   						ocupacao_unidade_v. NR_RAMAL %type;
IE_TEMPORARIO_w   					ocupacao_unidade_v. IE_TEMPORARIO %type;
IE_TIPO_RESERVA_w   				ocupacao_unidade_v. IE_TIPO_RESERVA %type;
CD_TIPO_ACOMODACAO_w   				ocupacao_unidade_v. CD_TIPO_ACOMODACAO %type;
IE_PROBABILIDADE_ALTA_w   			ocupacao_unidade_v. IE_PROBABILIDADE_ALTA %type;
DS_PROBABILIDADE_w   				ocupacao_unidade_v. DS_PROBABILIDADE %type;
CD_PSICOLOGO_w   					ocupacao_unidade_v. CD_PSICOLOGO %type;
DS_OCUPACAO_w   					ocupacao_unidade_v. DS_OCUPACAO %type;
NR_AGRUPAMENTO_w   					ocupacao_unidade_v. NR_AGRUPAMENTO %type;
QT_PESO_MAXIMO_w   					ocupacao_unidade_v. QT_PESO_MAXIMO %type;
QT_ALTURA_MAXIMA_w   				ocupacao_unidade_v. QT_ALTURA_MAXIMA %type;
CD_CONVENIO_w   					ocupacao_unidade_v. CD_CONVENIO %type;
QT_TEMPO_PREV_HIGIEN_w   			ocupacao_unidade_v. QT_TEMPO_PREV_HIGIEN %type;
NR_SEQ_MOTIVO_RESERVA_w   			ocupacao_unidade_v. NR_SEQ_MOTIVO_RESERVA %type;
IE_ACOMPANHANTE_w   				ocupacao_unidade_v. IE_ACOMPANHANTE %type;
DS_PLANO_w   						ocupacao_unidade_v. DS_PLANO %type;
QT_DIA_PERMAN_UNID_w   				ocupacao_unidade_v. QT_DIA_PERMAN_UNID %type;
DS_CARATER_INT_SUS_w   				ocupacao_unidade_v. DS_CARATER_INT_SUS %type;
IE_RADIOTERAPIA_w   				ocupacao_unidade_v. IE_RADIOTERAPIA %type;
NR_ATEND_ALTA_w   					ocupacao_unidade_v. NR_ATEND_ALTA %type;
IE_RADIACAO_w   					ocupacao_unidade_v. IE_RADIACAO %type;
IE_INTERDITADO_RADIACAO_w   		ocupacao_unidade_v. IE_INTERDITADO_RADIACAO %type;
DS_TIPO_ACOMODACAO_w   				ocupacao_unidade_v. DS_TIPO_ACOMODACAO %type;
CD_ESTABELECIMENTO_w   				ocupacao_unidade_v. CD_ESTABELECIMENTO %type;
NM_USUARIO_INTERN_w   				ocupacao_unidade_v. NM_USUARIO_INTERN %type;
NR_SEQ_PERFIL_w   					ocupacao_unidade_v. NR_SEQ_PERFIL %type;
DS_COR_PERFIL_PEP_w   				ocupacao_unidade_v. DS_COR_PERFIL_PEP %type;
DS_PERFIL_PEP_w   					ocupacao_unidade_v. DS_PERFIL_PEP %type;
CD_MOTIVO_ALTA_MEDICA_w   			ocupacao_unidade_v. CD_MOTIVO_ALTA_MEDICA %type;
CD_MEDICO_RESP_w   					ocupacao_unidade_v. CD_MEDICO_RESP %type;
NR_DOC_CONV_PRINCIPAL_w   			ocupacao_unidade_v. NR_DOC_CONV_PRINCIPAL %type;
IE_RESERVA_PA_w   					ocupacao_unidade_v. IE_RESERVA_PA %type;
IE_NECESSITA_ISOL_RESERVA_w   		ocupacao_unidade_v. IE_NECESSITA_ISOL_RESERVA %type;
CLASSIF_w   						ocupacao_unidade_v. CLASSIF %type;
IE_CLINICA_w   						ocupacao_unidade_v. IE_CLINICA %type;
DS_UNIDADE_ATEND_w   				ocupacao_unidade_v. DS_UNIDADE_ATEND %type;
QT_DIAS_PREV_INTERD_w   			ocupacao_unidade_v. QT_DIAS_PREV_INTERD %type;
IE_PERMITE_VISITA_w   				ocupacao_unidade_v. IE_PERMITE_VISITA %type;
CD_MOTIVO_INTERDICAO_w   			ocupacao_unidade_v. CD_MOTIVO_INTERDICAO %type;
DT_AGUARD_HIGIENIZACAO_w   			ocupacao_unidade_v. DT_AGUARD_HIGIENIZACAO %type;
DS_MOTIVO_PAUSA_LEITO_w   			ocupacao_unidade_v. DS_MOTIVO_PAUSA_LEITO %type;
IE_BOLETIM_INFORM_w   				ocupacao_unidade_v. IE_BOLETIM_INFORM %type;
IE_LEITO_ADAPT_w   					ocupacao_unidade_v. IE_LEITO_ADAPT %type;
IE_LEITO_ADAPTADO_w   				ocupacao_unidade_v. IE_LEITO_ADAPTADO %type;
DS_TIPO_ATENDIMENTO_w   			ocupacao_unidade_v. DS_TIPO_ATENDIMENTO %type;
NM_PAC_RESERVA_w   					ocupacao_unidade_v. NM_PAC_RESERVA %type;
DT_SAIDA_TEMPORARIA_w   			ocupacao_unidade_v. DT_SAIDA_TEMPORARIA %type;
DT_RETORNO_SAIDA_TEMPORARIA_w   	ocupacao_unidade_v. DT_RETORNO_SAIDA_TEMPORARIA %type;
DT_ALTA_w   						ocupacao_unidade_v. DT_ALTA %type;
IE_TIPO_ATENDIMENTO_w  				ocupacao_unidade_v. IE_TIPO_ATENDIMENTO %type;
NM_MEDICO_RESP_EUP_w   				ocupacao_unidade_v. NM_MEDICO_RESP_EUP %type;
CD_MOTIVO_MANUTENCAO_w  			ocupacao_unidade_v. CD_MOTIVO_MANUTENCAO %type;
NR_SEQ_MOTIVO_PERM_w				ocupacao_unidade_v. NR_SEQ_MOTIVO_PERM %type;
ie_sexo_ww							ocupacao_unidade_v. IE_SEXO %type;
DT_PREVISTO_ALTA_ww		   			ocupacao_unidade_v. DT_PREVISTO_ALTA %type;	
DS_STATUS_WOCUPACAO_w				wocupacao_leito. DS_STATUS_UNIDADE %type;
DS_SEXO_PACIENTE_w 			  		wocupacao_leito. DS_SEXO %type;
DT_ENTRADA_UNID_w   				timestamp;
DS_MOTIVO_MANUTENCAO_w				wocupacao_leito. DS_MOTIVO_MANUTENCAO %type;
DS_COR_ROUPARIA_HOTELARIA_w			wocupacao_leito. DS_COR_ROUPARIA_HOTELARIA %type;
ie_se_aniver_pessoa_w				wocupacao_leito. ie_se_aniver_pessoa %type;
ds_cor_precaucao_isolamento_w		wocupacao_leito. ds_cor_precaucao_isolamento %type;
ds_cor_motivo_isolamento_w			wocupacao_leito. ds_cor_motivo_isolamento %type;
ie_bloqueio_acomp_w					wocupacao_leito. ie_bloqueio_acomp %type;
NR_SEQ_APRESENT_w   				wocupacao_leito. NR_SEQ_APRESENT %type;
nr_status_w							wocupacao_leito. nr_status %type;
nm_pessoa_fisica_ocult_w			wocupacao_leito. nm_pessoa_fisica_ocult %type;
nm_paciente_reserva_ocult_w			wocupacao_leito. nm_paciente_reserva_ocult %type;
dt_entrada_hosp_w					wocupacao_leito. dt_entrada_hosp %type;
cd_diagnostico_w					wocupacao_leito. cd_diagnostico %type;
ds_diagnostico_w					wocupacao_leito. ds_diagnostico %type;
nr_acompanhante_w					wocupacao_leito. nr_acompanhante %type;
ie_paciente_isolado_w				wocupacao_leito. ie_paciente_isolado %type;
nm_psicologo_w						wocupacao_leito. nm_psicologo %type;
ds_historico_w						wocupacao_leito. ds_historico %type;
nr_idade_w							wocupacao_leito. nr_idade %type;
ds_procedencia_w					wocupacao_leito. ds_procedencia %type;
ds_motivo_w							wocupacao_leito. ds_motivo %type;
ds_servico_w						wocupacao_leito. ds_servico %type;
ds_servico_futuro_w					wocupacao_leito. ds_servico_futuro %type;
qt_peso_w							wocupacao_leito. qt_peso %type;
qt_altura_w							wocupacao_leito. qt_altura %type;
ds_categ_w							wocupacao_leito. ds_categ %type;
ds_motivo_reserva_w					wocupacao_leito. ds_motivo_reserva %type;
qt_dias_perm_sus_w					wocupacao_leito. qt_dias_perm_sus %type;
ie_ultrapassou_limite_sus_w			wocupacao_leito. ie_ultrapassou_limite_sus %type;
dt_prevista_w						wocupacao_leito. dt_prevista %type;
ds_local_gv_w						wocupacao_leito. ds_local_gv %type;
nm_contato_mae_w					wocupacao_leito. nm_contato_mae %type;
ds_motivo_isolamento_w				wocupacao_leito. ds_motivo_isolamento %type;
dt_prevista_alta_w					wocupacao_leito. dt_prevista_alta %type;
ds_probabilidade_alta_w				wocupacao_leito. ds_probabilidade_alta %type;
ds_especialidade_medico_w			wocupacao_leito. ds_especialidade_medico %type;
ds_precaucao_w						wocupacao_leito. ds_precaucao %type;
dt_inicio_isolamento_w				wocupacao_leito. dt_inicio_isolamento %type;
dt_fim_isolamento_w					wocupacao_leito. dt_fim_isolamento %type;
ds_paciente_mr_w					wocupacao_leito. ds_paciente_mr %type;
ds_paciente_mi_w					wocupacao_leito. ds_paciente_mi %type;
ds_inicio_isolamento_w				wocupacao_leito. ds_inicio_isolamento %type;
ds_fim_isolamento_w					wocupacao_leito. ds_fim_isolamento %type;
qt_dias_isolamento_w				wocupacao_leito. qt_dias_isolamento %type;
ds_tipo_isolamento_w				wocupacao_leito. ds_tipo_isolamento %type;
ds_cuidado_w						wocupacao_leito. ds_cuidado %type;
ds_tipo_acomp_w						wocupacao_leito. ds_tipo_acomp %type;
ds_lista_deficiencia_w				wocupacao_leito. ds_lista_deficiencia %type;
nr_conta_aberta_w					wocupacao_leito. nr_conta_aberta %type;
ds_tipo_acomodacao_aut_w			wocupacao_leito. ds_tipo_acomodacao_autorizada %type;
ds_tipo_acomodacao_paciente_w		wocupacao_leito. ds_tipo_acomodacao_paciente %type;
QT_DIA_PERMANENCIA_A_w				wocupacao_leito. QT_DIA_PERMANENCIA_A %type;
ie_leito_radio_w					wocupacao_leito. ie_leito_radio %type;
ds_motivo_lib_acom_usu_w			wocupacao_leito. ds_motivo_lib_acom_usu %type;
qt_acomp_w							wocupacao_leito. qt_acomp %type;
ie_pac_detento_w					wocupacao_leito. ie_pac_detento %type;
ie_pac_onc_w						wocupacao_leito. ie_pac_onc %type;
ie_pac_descolonizado_w				wocupacao_leito. ie_pac_descolonizado %type;
ie_paciente_mr_cultura_w			wocupacao_leito. ie_paciente_mr_cultura %type;
ie_acom_nao_permit_w				wocupacao_leito. ie_acom_nao_permit %type;
ie_pac_sigilo_w						wocupacao_leito. ie_pac_sigilo %type;
ds_municipio_w						wocupacao_leito. ds_municipio %type;
ds_obs_prev_alta_w					wocupacao_leito. ds_obs_prev_alta %type;
ds_dia_permanencia_cor_w			wocupacao_leito. ds_dia_permanencia_cor %type;
dt_interditacao_dia_w				wocupacao_leito. dt_interditacao_dia %type;
ie_pac_mi_w							wocupacao_leito. ie_pac_mi %type;
ie_possui_rn_w						wocupacao_leito. ie_possui_rn %type;
ie_lib_financeira_w					wocupacao_leito. ie_lib_financeira %type;
ie_rn_possui_alta_w					wocupacao_leito. ie_rn_possui_alta %type;
qt_tempo_higienizacao_w				wocupacao_leito. qt_tempo_higienizacao %type;
ds_motivo_pausa_w					wocupacao_leito. ds_motivo_pausa %type;
ie_rn_possui_alta_hosp_w			wocupacao_leito. ie_rn_possui_alta_hosp %type;
ds_motivos_isol_w					wocupacao_leito. ds_motivos_isol %type;
ie_status_servico_w					wocupacao_leito. ie_status_servico %type;
nr_sequencia_servico_w				wocupacao_leito. nr_sequencia_servico %type;
NR_SEQ_SERVICO_EXEC_w				wocupacao_leito. NR_SEQ_SERVICO_EXEC %type;
ds_dia_permanencia_unid_cor_w		wocupacao_leito. ds_dia_permanencia_unid_cor %type;
ds_motivo_dif_acomod_w				wocupacao_leito. ds_motivo_dif_acomod %type;
ds_gradacao_w						wocupacao_leito. ds_gradacao %type;
ie_paciente_em_obito_w				wocupacao_leito. ie_paciente_em_obito %type;
DS_COR_INTERDICAO_w					wocupacao_leito. DS_COR_INTERDICAO %type;
DS_CLASSIF_BENEFICIARIO_w			wocupacao_leito. DS_CLASSIF_BENEFICIARIO %type;
ds_motivo_perm_w					wocupacao_leito. ds_motivo_perm %type;
DS_PRE_RESERVA_w					wocupacao_leito. DS_PRE_RESERVA %type;
nr_status_java_w					wocupacao_leito. nr_status_java %type;
ds_proximo_leito_desej_w			wocupacao_leito. ds_proximo_leito_desej %type;
nm_colab_resp_w						wocupacao_leito. nm_colab_resp %type;
ds_status_gv_w						wocupacao_leito. ds_status_gv %type;

dt_interditacao_dia_ww				timestamp;
cd_classif_detento_w				varchar(255);  -- Parametro [191]
cd_classif_onc_w					varchar(255);  -- Parametro [211]
cd_classif_sigilo_w					varchar(255);  -- Parametro [217]
ie_param_36_w						varchar(3);    -- Parametro [36]
IE_ALTA_MEDICO_w					varchar(1);    -- Parametro [119]
IE_LEGENDA_AP_w						varchar(1);    -- Parametro [148]
IE_ALTA_MEDICO_PRIORIDADE_w			varchar(1);    -- Parametro [213]
IE_PESSOA_STATUS_w					varchar(1);    -- Parametro [105]
IE_PRECAUCAO_PEP_w					varchar(1);    -- Parametro [187]
IE_PROCESSO_ALTA_w					varchar(1);    -- Parametro [320]
ds_status_saida_temporaria_w        varchar(20);
			
C01 CURSOR FOR
	SELECT 	NR_ATENDIMENTO,
			DT_ENTRADA_UNIDADE,
			CD_UNIDADE,
			CD_UNIDADE_BASICA,
			CD_UNIDADE_COMPL,
			DT_ENTRADA,
			NM_PESSOA_FISICA,
			CD_SETOR_ATENDIMENTO,
			CD_PESSOA_FISICA,
			DT_NASCIMENTO,
			NR_PRONTUARIO,
			IE_STATUS_UNIDADE,
			IE_SEXO,
			DS_CONVENIO,
			DS_CATEGORIA,
			CD_PACIENTE_RESERVA,
			NM_PACIENTE_RESERVA,
			CD_CONVENIO_RESERVA,
			NM_CONVENIO_RESERVA,
			NM_USUARIO_RESERVA,
			NR_CRM,
			NM_GUERRA,
			IE_CLASSE_ACOMODACAO,
			IE_SEXO_PACIENTE,
			IE_SEXO_FIXO,
			DS_STATUS_UNIDADE,
			DS_OBSERVACAO,
			QT_DIA_PERMANENCIA,
			DS_CLINICA,
			DT_INICIO_HIGIENIZACAO,
			DT_HIGIENIZACAO,
			NR_SEQ_INTERNO,
			DT_PREVISTO_ALTA,
			DT_ALTA_MEDICO,
			NM_USUARIO_HIGIENIZACAO,
			NM_USUARIO_FIM_HIGIENIZACAO,
			NR_RAMAL,
			IE_TEMPORARIO,
			IE_TIPO_RESERVA,
			CD_TIPO_ACOMODACAO,
			IE_PROBABILIDADE_ALTA,
			DS_PROBABILIDADE,
			CD_PSICOLOGO,
			DS_OCUPACAO,
			NR_AGRUPAMENTO,
			QT_PESO_MAXIMO,
			QT_ALTURA_MAXIMA,
			CD_CONVENIO,
			QT_TEMPO_PREV_HIGIEN,
			NR_SEQ_MOTIVO_RESERVA,
			IE_ACOMPANHANTE,
			DS_PLANO,
			NR_SEQ_APRESENT,
			QT_DIA_PERMAN_UNID,
			DS_CARATER_INT_SUS,
			IE_RADIOTERAPIA,
			NR_ATEND_ALTA,
			IE_RADIACAO,
			IE_INTERDITADO_RADIACAO,
			DS_TIPO_ACOMODACAO,
			CD_ESTABELECIMENTO,
			NM_USUARIO_INTERN,
			NR_SEQ_PERFIL,
			DS_COR_PERFIL_PEP,
			DS_PERFIL_PEP,
			CD_MOTIVO_ALTA_MEDICA,
			CD_MEDICO_RESP,
			NR_DOC_CONV_PRINCIPAL,
			IE_RESERVA_PA,
			IE_NECESSITA_ISOL_RESERVA,
			CLASSIF,
			IE_CLINICA,
			DS_UNIDADE_ATEND,
			QT_DIAS_PREV_INTERD,
			IE_PERMITE_VISITA,
			CD_MOTIVO_INTERDICAO,
			DT_AGUARD_HIGIENIZACAO,
			DS_MOTIVO_PAUSA_LEITO,
			IE_BOLETIM_INFORM,
			IE_LEITO_ADAPT,
			IE_LEITO_ADAPTADO,
			DS_TIPO_ATENDIMENTO,
			NM_PAC_RESERVA,
			DT_SAIDA_TEMPORARIA,
			DT_RETORNO_SAIDA_TEMPORARIA,
			DT_ALTA,
			IE_TIPO_ATENDIMENTO,
			NM_MEDICO_RESP_EUP,
			CD_MOTIVO_MANUTENCAO,
			NR_SEQ_MOTIVO_PERM
	FROM    ocupacao_unidade_v o
	WHERE   NR_SEQ_INTERNO = NR_SEQ_INTERNO_P
	OR (coalesce(NR_SEQ_INTERNO_P::text, '') = '' AND
	o.cd_setor_atendimento = cd_setor_atendimento_p
	AND     ((coalesce(cd_estabelecimento::text, '') = '') OR (cd_estabelecimento = cd_estab_Ocupacao_p) OR (ie_param_36_w = 'S'))
	AND		((o.ie_status_unidade <> 'L' AND ie_param_266_p = 'S') OR (ie_param_266_p = 'N'))
	AND     ((coalesce(ie_saida_temporaria_p, 'N') = 'N') or ((coalesce(ie_saida_temporaria_p,'N') = 'S') and (o.dt_saida_temporaria IS NOT NULL AND o.dt_saida_temporaria::text <> '') and coalesce(dt_retorno_saida_temporaria::text, '') = '')))
	ORDER BY o.nr_seq_apresent, o.cd_unidade;


BEGIN
if (coalesce(IE_DEPARTAMENTO_P, 'N') = 'N') then
  if (coalesce(NR_SEQ_INTERNO_P::text, '') = '') then
    CALL exec_sql_dinamico(nm_usuario_p,'truncate table wocupacao_leito');
  else		
    delete FROM wocupacao_leito
    where nr_seq_interno = NR_SEQ_INTERNO_P;
  end if;
  commit;
end if;

IE_ALTA_MEDICO_w := Obter_Param_Usuario(44, 119, cd_perfil_p, nm_usuario_p, cd_estab_ocupacao_p, IE_ALTA_MEDICO_w);
IE_LEGENDA_AP_w := Obter_Param_Usuario(44, 148, cd_perfil_p, nm_usuario_p, cd_estab_ocupacao_p, IE_LEGENDA_AP_w);
IE_ALTA_MEDICO_PRIORIDADE_w := Obter_Param_Usuario(44, 213, cd_perfil_p, nm_usuario_p, cd_estab_ocupacao_p, IE_ALTA_MEDICO_PRIORIDADE_w);
IE_PESSOA_STATUS_w := Obter_Param_Usuario(44, 105, cd_perfil_p, nm_usuario_p, cd_estab_ocupacao_p, IE_PESSOA_STATUS_w);
IE_PRECAUCAO_PEP_w := Obter_Param_Usuario(44, 187, cd_perfil_p, nm_usuario_p, cd_estab_ocupacao_p, IE_PRECAUCAO_PEP_w);
IE_PROCESSO_ALTA_w := Obter_Param_Usuario(44, 320, cd_perfil_p, nm_usuario_p, cd_estab_ocupacao_p, IE_PROCESSO_ALTA_w);

if (coalesce(IE_HTML5_P,'N') = 'N') then
	ie_param_36_w := Obter_Param_Usuario(44, 36, cd_perfil_p, nm_usuario_p, cd_estab_ocupacao_p, ie_param_36_w);
else
	ie_param_36_w := 'N'; /* Tratativa feita pois o param 36 foi depreciado em HTML5 */
end if;
cd_classif_detento_w := Obter_Param_Usuario(44, 191, cd_perfil_p, nm_usuario_p, cd_estab_ocupacao_p, cd_classif_detento_w);
cd_classif_onc_w := Obter_Param_Usuario(44, 211, cd_perfil_p, nm_usuario_p, cd_estab_ocupacao_p, cd_classif_onc_w);
cd_classif_sigilo_w := Obter_Param_Usuario(44, 217, cd_perfil_p, nm_usuario_p, cd_estab_ocupacao_p, cd_classif_sigilo_w);

open C01;
loop
fetch C01 into	
		NR_ATENDIMENTO_w,
		DT_ENTRADA_UNIDADE_w,
		CD_UNIDADE_w,
		CD_UNIDADE_BASICA_w,
		CD_UNIDADE_COMPL_w,
		DT_ENTRADA_w,
		NM_PESSOA_FISICA_w,
		CD_SETOR_ATENDIMENTO_w,
		CD_PESSOA_FISICA_w,
		DT_NASCIMENTO_w,
		NR_PRONTUARIO_w,
		IE_STATUS_UNIDADE_w,
		IE_SEXO_w,
		DS_CONVENIO_w,
		DS_CATEGORIA_w,
		CD_PACIENTE_RESERVA_w,
		NM_PACIENTE_RESERVA_w,
		CD_CONVENIO_RESERVA_w,
		NM_CONVENIO_RESERVA_w,
		NM_USUARIO_RESERVA_w,
		NR_CRM_w,
		NM_GUERRA_w,
		IE_CLASSE_ACOMODACAO_w,
		IE_SEXO_PACIENTE_w,
		IE_SEXO_FIXO_w,
		DS_STATUS_UNIDADE_w,
		DS_OBSERVACAO_w,
		QT_DIA_PERMANENCIA_w,
		DS_CLINICA_w,
		DT_INICIO_HIGIENIZACAO_w,
		DT_HIGIENIZACAO_w,
		NR_SEQ_INTERNO_w,
		DT_PREVISTO_ALTA_w,
		DT_ALTA_MEDICO_w,
		NM_USUARIO_HIGIENIZACAO_w,
		NM_USUARIO_FIM_HIGIENIZACAO_w,
		NR_RAMAL_w,
		IE_TEMPORARIO_w,
		IE_TIPO_RESERVA_w,
		CD_TIPO_ACOMODACAO_w,
		IE_PROBABILIDADE_ALTA_w,
		DS_PROBABILIDADE_w,
		CD_PSICOLOGO_w,
		DS_OCUPACAO_w,
		NR_AGRUPAMENTO_w,
		QT_PESO_MAXIMO_w,
		QT_ALTURA_MAXIMA_w,
		CD_CONVENIO_w,
		QT_TEMPO_PREV_HIGIEN_w,
		NR_SEQ_MOTIVO_RESERVA_w,
		IE_ACOMPANHANTE_w,
		DS_PLANO_w,
		NR_SEQ_APRESENT_w,
		QT_DIA_PERMAN_UNID_w,
		DS_CARATER_INT_SUS_w,
		IE_RADIOTERAPIA_w,
		NR_ATEND_ALTA_w,
		IE_RADIACAO_w,
		IE_INTERDITADO_RADIACAO_w,
		DS_TIPO_ACOMODACAO_w,
		CD_ESTABELECIMENTO_w,
		NM_USUARIO_INTERN_w,
		NR_SEQ_PERFIL_w,
		DS_COR_PERFIL_PEP_w,
		DS_PERFIL_PEP_w,
		CD_MOTIVO_ALTA_MEDICA_w,
		CD_MEDICO_RESP_w,
		NR_DOC_CONV_PRINCIPAL_w,
		IE_RESERVA_PA_w,
		IE_NECESSITA_ISOL_RESERVA_w,
		CLASSIF_w,
		IE_CLINICA_w,
		DS_UNIDADE_ATEND_w,
		QT_DIAS_PREV_INTERD_w,
		IE_PERMITE_VISITA_w,
		CD_MOTIVO_INTERDICAO_w,
		DT_AGUARD_HIGIENIZACAO_w,
		DS_MOTIVO_PAUSA_LEITO_w,
		IE_BOLETIM_INFORM_w,
		IE_LEITO_ADAPT_w,
		IE_LEITO_ADAPTADO_w,
		DS_TIPO_ATENDIMENTO_w,
		NM_PAC_RESERVA_w,
		DT_SAIDA_TEMPORARIA_w,
		DT_RETORNO_SAIDA_TEMPORARIA_w,
		DT_ALTA_w,
		IE_TIPO_ATENDIMENTO_w,
		NM_MEDICO_RESP_EUP_w,
		CD_MOTIVO_MANUTENCAO_w,
		NR_SEQ_MOTIVO_PERM_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin
	
	select 	max(SUBSTR(obter_primeira_solicitacao(nr_seq_interno_w),1,255))
	into STRICT	ds_pre_reserva_w
	;
	
	if (coalesce(cd_pessoa_fisica_w::text, '') = '') then
		ie_sexo_ww	:=	ie_sexo_paciente_w;
	else
		ie_sexo_ww	:=	ie_sexo_w;
	end if;		
	
	if (IE_LEGENDA_AP_w = 'S') then
		DT_PREVISTO_ALTA_ww := dt_previsto_alta_w;
	else
		DT_PREVISTO_ALTA_ww := null;
	end if;		
	
	select 	max(SUBSTR(Obter_Status_Isolamento_Ocup(cd_estab_ocupacao_p, nr_atendimento_w, ie_acompanhante_w, nm_usuario_p),1,1))
	into STRICT	ie_paciente_isolado_w
	;	
	
	select max((obter_status_leito_ocupacao(
			ie_paciente_isolado_w,
			SUBSTR(obter_classif_etaria(cd_estab_ocupacao_p,cd_pessoa_fisica_w,'C'),1,3),
			ie_sexo_ww,
			ie_status_unidade_w,
			ie_temporario_w,
			dt_alta_medico_w,
			IE_ALTA_MEDICO_w,
			nr_atend_alta_w,
			ie_radiacao_w,
			ie_interditado_radiacao_w,
			DT_PREVISTO_ALTA_ww,
			obter_se_alta_tesouraria2(nr_atendimento_w, cd_setor_atendimento_w, cd_unidade_basica_w, cd_unidade_compl_w),
			IE_ALTA_MEDICO_PRIORIDADE_w,
			nr_seq_interno_w,
			dt_saida_temporaria_w,
			dt_retorno_saida_temporaria_w,
			ie_html5_p))::numeric )
	into STRICT	nr_status_w
	;
	
	select max((Obter_imagem_leito_ocup_hosp(nr_status_w))::numeric )
	into STRICT nr_status_java_w
	;
	
	if (IE_PESSOA_STATUS_w = 'N') then
		select 	max(SUBSTR(obter_pessoa_ocupacao_status(nr_status_w,nr_seq_interno_w,cd_pessoa_fisica_w,cd_perfil_p,NM_USUARIO_P),1,60))
		into STRICT 	nm_pessoa_fisica_ocult_w
		;
	else
		select 	max(SUBSTR(obter_nome_pessoa_ocupacao(nr_status_w,nr_seq_interno_w,cd_pessoa_fisica_w,cd_perfil_p,NM_USUARIO_P),1,60))
		into STRICT 	nm_pessoa_fisica_ocult_w
		;		
	end if;
	
	select 	max(coalesce(coalesce(SUBSTR(obter_nome_pf_oculta(cd_paciente_reserva_w,cd_perfil_p,NM_USUARIO_P),1,60),nm_convenio_reserva_w),nm_pac_reserva_w))
	into STRICT 	nm_paciente_reserva_ocult_w
	;				
	
	if (coalesce(nr_atendimento_w::text, '') = '') then
		dt_entrada_hosp_w	:= null;
		dt_entrada_unid_w	:= null;
	elsif ((ie_processo_alta_w = 'N') and (ie_status_unidade_w in ('R','L', 'H', 'G', 'A','O','E','C'))) then
		dt_entrada_hosp_w	:= obter_data_entrada(nr_atendimento_w);
		dt_entrada_unid_w	:= obter_tempo_p_ult_setor_date(nr_atendimento_w);
	else
		dt_entrada_hosp_w	:= dt_entrada_w;
		dt_entrada_unid_w	:= obter_tempo_p_ult_setor_date(nr_atendimento_w);
	end if;
		
	--nm_paciente_w				:=	nvl(DECODE(ie_status_unidade_w, 'R', SUBSTR(obter_nome_pf_oculta(cd_paciente_reserva_w,cd_perfil_p,NM_USUARIO_P),1,60), SUBSTR(obter_nome_pf_oculta(cd_pessoa_fisica,cd_perfil_p,NM_USUARIO_P),1,60)),nm_pac_reserva_w);
	select 	max(SUBSTR(Obter_cod_Diagnostico_atend(nr_atendimento_w),1,240)),
			max(SUBSTR(Obter_Diag_Princ_atendimento(nr_atendimento_w),1,240))
	into STRICT	cd_diagnostico_w,
			ds_diagnostico_w
	;		
	
	SELECT 	MAX(nr_acompanhante)
	into STRICT	nr_acompanhante_w
	FROM 	atend_categoria_convenio b
	WHERE 	b.nr_atendimento = nr_atendimento_w;
		
	select	max(SUBSTR(obter_profissional_atend(nr_atendimento_w,'P','N'),1,60)),
			max(SUBSTR(obter_hist_unidade(nr_seq_interno_w,'I'),1,80)),
			max(SUBSTR(obter_idade_pf(cd_pessoa_fisica_w, clock_timestamp(), 'S'),1,100)),
			max(SUBSTR(obter_procedencia_atend(nr_atendimento_w, 'D'),1,100))
	into STRICT	nm_psicologo_w,
			ds_historico_w, 
			nr_idade_w,
			ds_procedencia_w
	;
	
	--ie_classif_etaria_w			:=	SUBSTR(obter_classif_etaria(cd_estab_ocupacao_p,cd_pessoa_fisica_w,'C'),1,3);				
	if (ie_status_unidade_w = 'I') then
		ds_motivo_w	:=	SUBSTR(nm_paciente_reserva_w,1,100);
	else
		ds_motivo_w	:= 	null;
	end if;	
	
	select 	max(coalesce(Obter_Qt_Dias_SUS_Atend(nr_atendimento_w),0))
	into STRICT	qt_dias_perm_sus_w
	;
	
	select 	max(SUBSTR(obter_status_servico_leito(nr_seq_interno_w, 'D'),1,200)),
			max(SUBSTR(obter_servico_leito_futuro(nr_seq_interno_w, 'D'),1,200)),
			max(obter_sinal_vital(nr_atendimento_w,wheb_mensagem_pck.get_texto(793112))),
			max(obter_sinal_vital(nr_atendimento_w,wheb_mensagem_pck.get_texto(793113))),
			max(SUBSTR(obter_desc_motivo_reserva(nr_seq_motivo_reserva_w,'D'),1,255)),		
			max(SUBSTR(obter_se_maior_limite_sus(nr_atendimento_w, qt_dias_perm_sus_w),1,100)),
			max(obter_gestao_vaga_dataprevista(cd_setor_atendimento_w, cd_unidade_basica_w, cd_unidade_compl_w)),
			max(SUBSTR(OBTER_GESTAO_VAGA_LOCAL(cd_setor_atendimento_w, cd_unidade_basica_w, cd_unidade_compl_w),1,255)),
			max(SUBSTR( obter_nome_mae_pf( cd_pessoa_fisica_w ) ,1,255)),
			max(substr(obter_proximo_leito_desejado(nr_atendimento_w,nr_seq_interno_w),1,255)),
			max(substr(obter_status_gv_ocup(nr_seq_interno_w,nr_atendimento_w),1,255))
	into STRICT	ds_servico_w,
			ds_servico_futuro_w, 
			qt_peso_w, 
			qt_altura_w, 
			ds_motivo_reserva_w, 		
			ie_ultrapassou_limite_sus_w, 
			dt_prevista_w, 
			ds_local_gv_w, 
			nm_contato_mae_w ,
			ds_proximo_leito_desej_w,
			ds_status_gv_w
	;
	
	ds_categ_w				:=	ds_categoria_w;	
	
	if (IE_PRECAUCAO_PEP_w = 'S') then
		select 	max(SUBSTR(obter_precaucao_isolamento(nr_atendimento_w,'MOC'),1,200)),
				max(SUBSTR(obter_precaucao_isolamento(nr_atendimento_w,'DI'),1,21)),
				max(SUBSTR(obter_precaucao_isolamento(nr_atendimento_w,'DF'),1,21)),
				max(SUBSTR(obter_precaucao_isolamento(nr_atendimento_w,'QD'),1,21)),
				max(obter_dates_isolamento(nr_atendimento_w,'I')),
				max(obter_dates_isolamento(nr_atendimento_w,'F')),
				max(substr(obter_texto_tasy(CASE WHEN obter_se_paciente_mr(nr_atendimento_w)='S' THEN  686527  ELSE 686525 END ,null),1,255)),
				max(substr(obter_texto_tasy(CASE WHEN obter_se_paciente_mi(cd_pessoa_fisica_w)='S' THEN  686527  ELSE 686525 END ,null),1,255))
		into STRICT	ds_motivo_isolamento_w,
				ds_inicio_isolamento_w, 
				ds_fim_isolamento_w, 
				qt_dias_isolamento_w,
				dt_inicio_isolamento_w,
				dt_fim_isolamento_w,
				ds_paciente_mr_w,
				ds_paciente_mi_w
		;								
	else
		select 	max(SUBSTR(obter_motivo_isolamento(nr_atendimento_w,'D'),1,200)),
				max(SUBSTR(obter_dados_isolamento(nr_atendimento_w,'I'),1,21)),
				max(SUBSTR(obter_dados_isolamento(nr_atendimento_w,'F'),1,21)),
				max(SUBSTR(obter_dados_isolamento(nr_atendimento_w,'D'),1,21))
		into STRICT	ds_motivo_isolamento_w,
				ds_inicio_isolamento_w, 
				ds_fim_isolamento_w, 
				qt_dias_isolamento_w
		;									
	end if;		
	
	select 	max(to_date(SUBSTR(obter_dados_atendimento(nr_atendimento_w,'DAP'),1,50), 'dd/mm/yyyy hh24:mi:ss')),
			max(SUBSTR(obter_valor_dominio(1267,obter_dados_atendimento(nr_atendimento_w,'PR')),1,60)),
			max(SUBSTR(obter_especialidade_medico(obter_dados_atendimento(nr_atendimento_w,'MR'), 'DV'),1,255)),
			max(SUBSTR(obter_precaucao_isolamento(nr_atendimento_w,'D'),1,100)),
			max(coalesce(SUBSTR(obter_tipos_isolamentos_cih(nr_atendimento_w,'D'),1,150),SUBSTR(obter_dados_isolamento(nr_atendimento_w,'DSF'),1,150))),
			max(SUBSTR(obter_cuidado_isolamento(nr_atendimento_w,'D'),1,2000)),
			max(SUBSTR(obter_lista_tipo_acomp(nr_atendimento_w),1,255)),
			max(SUBSTR(obter_lista_deficiencia_pf(cd_pessoa_fisica_w),1,255)),
			max(SUBSTR(obter_conta_particular_aberta(nr_atendimento_w),1,50)),
			max(SUBSTR(obter_tipo_acomod_atend(nr_atendimento_w,'D'),1,100)),
			max(SUBSTR(obter_tipo_acomodacao_atend(nr_atendimento_w,'D'),1,100)),
			max(coalesce(obter_qt_dia_internado(nr_atendimento_w,cd_estabelecimento_w,cd_perfil_p,nm_usuario_p),0)),
			max(SUBSTR(obter_se_leito_radio(cd_setor_atendimento_w,cd_unidade_basica_w,cd_unidade_compl_w),1,150)),
			max(SUBSTR(obter_mot_lib_acomp_aten(nr_atendimento_w),1,100)),
			max(Obter_quant_acomp_atendimento(nr_atendimento_w, NULL)),
			max(obter_se_pac_classif(cd_pessoa_fisica_w, cd_classif_detento_w)),
			max(obter_se_pac_classif(cd_pessoa_fisica_w, cd_classif_onc_w)),
			max(SUBSTR(obter_se_fx_etaria_regra(nr_atendimento_w,cd_setor_atendimento_w),1,100)),
			max(obter_se_pac_classif(cd_pessoa_fisica_w, cd_classif_sigilo_w)),
			max(SUBSTR(obter_dados_pf(cd_pessoa_fisica_w,'CNP'),1,240)),
			max(SUBSTR(obter_obs_prev_alta(nr_atendimento_w),1,255))
	into STRICT	dt_prevista_alta_w,
			ds_probabilidade_alta_w,
			ds_especialidade_medico_w, 
			ds_precaucao_w, 
			ds_tipo_isolamento_w, 
			ds_cuidado_w, 
			ds_tipo_acomp_w, 
			ds_lista_deficiencia_w, 
			nr_conta_aberta_w, 
			ds_tipo_acomodacao_aut_w, 
			ds_tipo_acomodacao_paciente_w, 
			QT_DIA_PERMANENCIA_A_w, 
			ie_leito_radio_w, 
			ds_motivo_lib_acom_usu_w, 
			qt_acomp_w,
			ie_pac_detento_w, 
			ie_pac_onc_w, 
			ie_acom_nao_permit_w, 
			ie_pac_sigilo_w, 
			ds_municipio_w, 
			ds_obs_prev_alta_w
	;
	
	select	max(obter_qt_dias_leito_cor(QT_DIA_PERMANENCIA_A_w)),
			max(SUBSTR(obter_se_pac_descolonizado(nr_atendimento_w),1,1)),
			max(Obter_se_paciente_MR(nr_atendimento_w))
	into STRICT	ds_dia_permanencia_cor_w,
			ie_pac_descolonizado_w,
			ie_paciente_mr_cultura_w	
	;				

		--ds_unidade_atend_w			:=	ds_unidade_atend;	
	
	select 	max(Obter_data_hist_unidade_date(nr_seq_interno_w,'I'))
	into STRICT	dt_interditacao_dia_ww
	;
		
	if (coalesce(dt_interditacao_dia_ww::text, '') = '') then
		dt_interditacao_dia_w := null;
	else
		select 	max(Trunc(dt_interditacao_dia_ww + coalesce(QT_DIAS_PREV_INTERD_w,0)))
		into STRICT	dt_interditacao_dia_w
		;		
	end if;
			
	select 	max(SUBSTR(obter_se_atendimento_rn(nr_atendimento_w),1,2)),
			max(SUBSTR(obter_se_atend_lib_financeira(nr_atendimento_w),1,2)),
			max(SUBSTR(obter_se_rn_possui_alta(nr_atendimento_w, null),1,2))
	into STRICT	ie_possui_rn_w,
			ie_lib_financeira_w,
			ie_rn_possui_alta_w
	;		
	
	if (coalesce(dt_inicio_higienizacao_w::text, '') = '') then
		qt_tempo_higienizacao_w	:= null;
	else
		select 	max(obter_minutos_intervalo(coalesce(dt_higienizacao_w,clock_timestamp()), dt_inicio_higienizacao_w, 0))
		into STRICT	qt_tempo_higienizacao_w
		;		
	end if;
	
	select 	max(SUBSTR(obter_motivo_pausa_leito(nr_seq_interno_w),1,255)),
			max(SUBSTR(obter_se_rn_possui_alta(nr_atendimento_w, 'A'),1,2)),
			max(SUBSTR(obter_precaucoes_isolamento(nr_atendimento_w),1,255)),
			max(SUBSTR(obter_inf_unidade(nr_seq_interno_w, 'S'),1,255)),
			max(SUBSTR(obter_inf_unidade(nr_seq_interno_w, 'N'),1,255)),
			max(SUBSTR(obter_inf_unidade(nr_seq_interno_w, 'E'),1,255)),
			max(obter_qt_dias_leito_cor(qt_dia_perman_unid_w)),
			max(SUBSTR(Obter_motivo_dif_acomod(nr_atendimento_w,'D'),1,255)),
			max(substr(obter_dados_gca(nr_atendimento_w,'G'),1,255)),
			max(obter_se_paciente_em_obito(cd_pessoa_fisica_w)),
			max(substr(OBTER_COR_MOT_INTER(CD_MOTIVO_INTERDICAO_w),1,90)),
			max(SUBSTR(obter_ds_classif_benef(nr_atendimento_w),1,255)),
			max(SUBSTR(obter_motivo_perm_setor(NR_SEQ_MOTIVO_PERM_w),1,60))
	into STRICT	ds_motivo_pausa_w,
			ie_rn_possui_alta_hosp_w,
			ds_motivos_isol_w,
			ie_status_servico_w,
			nr_sequencia_servico_w,
			NR_SEQ_SERVICO_EXEC_w,
			ds_dia_permanencia_unid_cor_w,
			ds_motivo_dif_acomod_w,
			ds_gradacao_w,
			ie_paciente_em_obito_w,
			DS_COR_INTERDICAO_w,
			DS_CLASSIF_BENEFICIARIO_w,
			ds_motivo_perm_w
	;	
	
	if (IE_REGR_PRONT_P = 'S') then
		select 	max(substr(obter_prontuario_pf(cd_estab_Ocupacao_p,CD_PESSOA_FISICA_w),1,20))
		into STRICT	nr_prontuario_w
		;
	end if;
	
	select 	max(SUBSTR(obter_desc_mot_manut(CD_MOTIVO_MANUTENCAO_w),1,80)) DS_MOTIVO_MANUTENCAO,
			max(substr(obter_se_rouparia_hotelaria(nr_seq_interno_w),1,1)) DS_COR_ROUPARIA_HOTELARIA,
			max(coalesce(obter_se_aniversario_pessoa(cd_pessoa_fisica_w,0),'N')) ie_se_aniver_pessoa,
			max(obter_legenda_isolamento(obter_precaucao_isolamento(nr_atendimento_w,'CM'))) ds_cor_precaucao_isolamento,
			max(obter_legenda_isolamento(obter_motivo_isolamento(nr_atendimento_w,'C'))) ds_cor_motivo_isolamento,
			max(substr(obter_se_bloqueio_acompanhante(nr_atendimento_w),1,10)) ie_bloqueio_acomp,
			max(Obter_Desc_Sexo_Unid(IE_SEXO_PACIENTE_w)),
			max(obter_status_unid_html(IE_STATUS_UNIDADE_w)),
			max(substr(Obter_enfermeiro_resp(nr_atendimento_w,'D'),1,100)) nm_colab_resp
	into STRICT	DS_MOTIVO_MANUTENCAO_w,
			DS_COR_ROUPARIA_HOTELARIA_w,
			ie_se_aniver_pessoa_w,
			ds_cor_precaucao_isolamento_w,
			ds_cor_motivo_isolamento_w,
			ie_bloqueio_acomp_w,
			DS_SEXO_PACIENTE_w,
			DS_STATUS_WOCUPACAO_w,
			nm_colab_resp_w
	;
	if (IE_HTML5_P = 'N') then
    begin
      select dt_inicio_saida,
             dt_final_saida,
             case when coalesce(dt_final_saida::text, '') = '' and dt_inicio_saida <= clock_timestamp() then OBTER_DESC_EXPRESSAO(284052)
                  when coalesce(dt_final_saida::text, '') = '' and dt_inicio_saida > clock_timestamp() then OBTER_DESC_EXPRESSAO(309688)
             else null end as status
	     into STRICT DT_SAIDA_TEMPORARIA_w,
		  DT_RETORNO_SAIDA_TEMPORARIA_w,
                  ds_status_saida_temporaria_w
        from wocupacao_saida_temporaria
       where coalesce(dt_final_saida::text, '') = ''
	   and   (dt_inicio_saida IS NOT NULL AND dt_inicio_saida::text <> '')
	   and   nr_atendimento = nr_atendimento_w;
	exception
	  when no_data_found then
	    -- DT_SAIDA_TEMPORARIA_w := null;

	    -- DT_RETORNO_SAIDA_TEMPORARIA_w := null;
        ds_status_saida_temporaria_w := null;
	  when too_many_rows then
	    -- DT_SAIDA_TEMPORARIA_w := null;

	    -- DT_RETORNO_SAIDA_TEMPORARIA_w := null;
        ds_status_saida_temporaria_w := null;
	end;
	end if;
	
	insert into wocupacao_leito(CD_PESSOA_FISICA,
	    NR_ATENDIMENTO,
	    CD_UNIDADE_BASICA,
	    CD_UNIDADE_COMPL,
	    NR_SEQ_INTERNO,
	    NM_PACIENTE_RESERVA_OCULT,
	    IE_STATUS_UNIDADE,
	    CD_SETOR_ATENDIMENTO,
	    NR_STATUS,
	    NM_PESSOA_FISICA_OCULT,
	    NR_ACOMPANHANTE,
	    NR_SEQUENCIA_SERVICO,
	    CD_MOTIVO_INTERDICAO,
	    DS_CUIDADO,
	    IE_STATUS_SERVICO,
	    IE_LEITO_RADIO,
	    IE_POSSUI_RN,
	    IE_LIB_FINANCEIRA,
	    DT_SAIDA_TEMPORARIA,
	    DT_RETORNO_SAIDA_TEMPORARIA,
	    NR_AGRUPAMENTO,
	    CD_TIPO_ACOMODACAO,
	    NR_CONTA_ABERTA,
	    DT_ALTA_MEDICO,
	    DS_LISTA_DEFICIENCIA,
	    QT_DIAS_PERM_SUS,
	    IE_ULTRAPASSOU_LIMITE_SUS,
	    DS_PERFIL_PEP,
	    IE_PACIENTE_ISOLADO,	
	    IE_PAC_MI,
	    QT_ACOMP,
	    IE_PAC_DETENTO,
	    IE_PAC_ONC,
	    IE_PAC_SIGILO,
	    IE_ACOM_NAO_PERMIT,
	    IE_PACIENTE_EM_OBITO,
	    QT_DIA_PERMAN_UNID,
	    DS_DIA_PERMANENCIA_UNID_COR,
	    QT_DIA_PERMANENCIA_A,
	    DS_DIA_PERMANENCIA_COR,
	    IE_PERMITE_VISITA,
	    IE_RN_POSSUI_ALTA,
	    DS_COR_INTERDICAO,
	    CD_PACIENTE_RESERVA,
	    CD_CONVENIO_RESERVA,
	    NR_SEQ_SERVICO_EXEC,
	    NR_SEQ_MOTIVO_PERM,
	    DT_PREVISTA,
	    DT_INTERDITACAO_DIA,
	    DT_AGUARD_HIGIENIZACAO,
	    DT_ENTRADA_UNID,
	    DT_PREVISTA_ALTA,
	    DT_ENTRADA_HOSP,
	    DT_ENTRADA_UNIDADE,
	    DT_INICIO_HIGIENIZACAO,
	    DT_HIGIENIZACAO,
	    DS_MOTIVO_PAUSA,
	    DS_MOTIVOS_ISOL,
	    IE_RN_POSSUI_ALTA_HOSP,
	    QT_TEMPO_HIGIENIZACAO,
	    DS_MOTIVO_DIF_ACOMOD,
	    DS_GRADACAO,
	    CD_UNIDADE,
	    DS_CONVENIO,
	    DS_CATEG,
	    NM_GUERRA,
	    IE_SEXO_PACIENTE,
	    DS_CLINICA,
	    NM_USUARIO_HIGIENIZACAO,
	    NM_USUARIO_FIM_HIGIENIZACAO,
	    DS_TIPO_ACOMODACAO,
	    CD_DIAGNOSTICO,
	    DS_DIAGNOSTICO,
	    NR_RAMAL,
	    DS_OBSERVACAO,
	    NM_PSICOLOGO,
	    NR_IDADE,
	    DS_PROCEDENCIA,
	    DS_MOTIVO,
	    DS_SERVICO,
	    QT_PESO_MAXIMO,
	    QT_ALTURA_MAXIMA,
	    QT_PESO,
	    QT_ALTURA,
	    QT_TEMPO_PREV_HIGIEN,
	    DS_MOTIVO_RESERVA,
	    DS_HISTORICO,
	    NR_PRONTUARIO,
	    NM_CONTATO_MAE,
	    DS_LOCAL_GV,
	    DS_MOTIVO_ISOLAMENTO,
	    DS_PROBABILIDADE_ALTA,
	    DS_SERVICO_FUTURO,
	    DS_ESPECIALIDADE_MEDICO,
	    DS_PRECAUCAO,
	    DS_INICIO_ISOLAMENTO,
	    DS_CARATER_INT_SUS,
	    DS_TIPO_ACOMP,
	    IE_RADIOTERAPIA,
	    DS_FIM_ISOLAMENTO,
	    QT_DIAS_ISOLAMENTO,
	    DS_TIPO_ISOLAMENTO,
	    NM_USUARIO_INTERN,
	    DS_TIPO_ACOMODACAO_AUTORIZADA,
	    DS_TIPO_ACOMODACAO_PACIENTE,
	    DS_MOTIVO_LIB_ACOM_USU,
	    DS_MUNICIPIO,
	    DS_OBS_PREV_ALTA,
	    DS_UNIDADE_ATEND,
	    CLASSIF,
	    DS_CLASSIF_BENEFICIARIO,
	    DS_MOTIVO_PERM,
	    DS_PRE_RESERVA,
	    NM_PESSOA_FISICA,
	    ie_pac_descolonizado,
	    ie_paciente_mr_cultura,
	    DS_COR_PERFIL_PEP,
	    NR_SEQ_APRESENT,
		NR_STATUS_JAVA,
		DS_POSSUI_RN,
 		DS_RN_POSSUI_ALTA,
 		DS_SEXO,
		DS_RN_POSSUI_ALTA_HOSP,
		DS_RADIOTERAPIA,
		DS_STATUS_UNIDADE,
		DS_PERMITE_VISITA,
		DS_LIB_FINANCEIRA,
		CD_MOTIVO_MANUTENCAO,
		DS_MOTIVO_MANUTENCAO,
		DS_COR_ROUPARIA_HOTELARIA,
		ie_se_aniver_pessoa,
		ds_cor_precaucao_isolamento,
		ds_cor_motivo_isolamento,
		ie_bloqueio_acomp,
		dt_inicio_isolamento,
		dt_fim_isolamento,
		ds_paciente_mr,
		ds_paciente_mi,
		ds_proximo_leito_desej,
		nm_colab_resp,
		ds_status_gv,
		ds_status_saida_temporaria)
	values (CD_PESSOA_FISICA_w,			                    
	    NR_ATENDIMENTO_w,			                    
	    CD_UNIDADE_BASICA_w,			                    
	    CD_UNIDADE_COMPL_w,			                    
	    NR_SEQ_INTERNO_w,			                    
	    NM_PACIENTE_RESERVA_OCULT_w,			                    
	    IE_STATUS_UNIDADE_w,			                    
	    CD_SETOR_ATENDIMENTO_w,			                    
	    NR_STATUS_w,			                    
	    NM_PESSOA_FISICA_OCULT_w,			                    
	    NR_ACOMPANHANTE_w,			                    
	    NR_SEQUENCIA_SERVICO_w,			                    
	    CD_MOTIVO_INTERDICAO_w,			                    
	    DS_CUIDADO_w,			                    
	    IE_STATUS_SERVICO_w,			                    
	    IE_LEITO_RADIO_w,			                    
	    IE_POSSUI_RN_w,			                    
	    IE_LIB_FINANCEIRA_w,			                    
	    DT_SAIDA_TEMPORARIA_w,			                    
	    dt_retorno_saida_temporaria_w,			                    
	    NR_AGRUPAMENTO_w,			                    
	    CD_TIPO_ACOMODACAO_w,			                    
	    NR_CONTA_ABERTA_w,			                    
	    DT_ALTA_MEDICO_w,			                    
	    DS_LISTA_DEFICIENCIA_w,			                    
	    QT_DIAS_PERM_SUS_w,			                    
	    IE_ULTRAPASSOU_LIMITE_SUS_w,			                    
	    DS_PERFIL_PEP_w,			                    
	    IE_PACIENTE_ISOLADO_w,			                    	     
	    IE_PAC_MI_w,			                    
	    QT_ACOMP_w,			                    
	    IE_PAC_DETENTO_w,			                    
	    IE_PAC_ONC_w,			                    
	    IE_PAC_SIGILO_w,			                    
	    IE_ACOM_NAO_PERMIT_w,			                    
	    IE_PACIENTE_EM_OBITO_w,			                    
	    QT_DIA_PERMAN_UNID_w,			                    
	    DS_DIA_PERMANENCIA_UNID_COR_w,			                    
	    QT_DIA_PERMANENCIA_A_w,			                    
	    DS_DIA_PERMANENCIA_COR_w,			                    
	    IE_PERMITE_VISITA_w,			                    
	    IE_RN_POSSUI_ALTA_w,			                    
	    DS_COR_INTERDICAO_w,			                    
	    CD_PACIENTE_RESERVA_w,			                    
	    CD_CONVENIO_RESERVA_w,			                    
	    NR_SEQ_SERVICO_EXEC_w,			                    
	    NR_SEQ_MOTIVO_PERM_w,
	    DT_PREVISTA_w,			                    
	    DT_INTERDITACAO_DIA_w,			                    
	    DT_AGUARD_HIGIENIZACAO_w,			                    
	    DT_ENTRADA_UNID_w,			                    
	    DT_PREVISTA_ALTA_w,			                    
	    DT_ENTRADA_HOSP_w,			                    
	    DT_ENTRADA_UNIDADE_w,			                    
	    DT_INICIO_HIGIENIZACAO_w,			                    
	    DT_HIGIENIZACAO_w,
	    DS_MOTIVO_PAUSA_w,			                    
	    DS_MOTIVOS_ISOL_w,			                    
	    IE_RN_POSSUI_ALTA_HOSP_w,			                    
	    QT_TEMPO_HIGIENIZACAO_w,			                    
	    DS_MOTIVO_DIF_ACOMOD_w,			                    
	    DS_GRADACAO_w,			                    
	    CD_UNIDADE_w,			                    
	    DS_CONVENIO_w,			                    
	    DS_CATEG_w,			                    
	    NM_GUERRA_w,			                    
	    IE_SEXO_PACIENTE_w,			                    
	    DS_CLINICA_w,			                    
	    NM_USUARIO_HIGIENIZACAO_w,			                    
	    CASE WHEN coalesce(DT_HIGIENIZACAO_w::text, '') = '' THEN null  ELSE NM_USUARIO_FIM_HIGIENIZACAO_w END ,
	    DS_TIPO_ACOMODACAO_w,			                    
	    CD_DIAGNOSTICO_w,			                    
	    DS_DIAGNOSTICO_w,			                    
	    NR_RAMAL_w,			                    
	    DS_OBSERVACAO_w,			                    
	    NM_PSICOLOGO_w,			                    
	    NR_IDADE_w,			                    
	    DS_PROCEDENCIA_w,			                    
	    DS_MOTIVO_w,			                    
	    DS_SERVICO_w,			                    
	    QT_PESO_MAXIMO_w,			                    
	    QT_ALTURA_MAXIMA_w,			                    
	    QT_PESO_w,			                    
	    QT_ALTURA_w,			                    
	    QT_TEMPO_PREV_HIGIEN_w,			                    
	    DS_MOTIVO_RESERVA_w,			                    
	    DS_HISTORICO_w,			                    
	    NR_PRONTUARIO_w,			                    
	    NM_CONTATO_MAE_w,			                    
	    DS_LOCAL_GV_w,			                    
	    DS_MOTIVO_ISOLAMENTO_w,			                    
	    DS_PROBABILIDADE_ALTA_w,			                    
	    DS_SERVICO_FUTURO_w,			                    
	    DS_ESPECIALIDADE_MEDICO_w,			                    
	    DS_PRECAUCAO_w,			                    
	    DS_INICIO_ISOLAMENTO_w,			                    
	    DS_CARATER_INT_SUS_w,			                    
	    DS_TIPO_ACOMP_w,			                    
	    IE_RADIOTERAPIA_w,			                    
	    DS_FIM_ISOLAMENTO_w,			                    
	    QT_DIAS_ISOLAMENTO_w,			                    
	    DS_TIPO_ISOLAMENTO_w,			                    
	    NM_USUARIO_INTERN_w,			                    
	    ds_tipo_acomodacao_aut_w,			                    
	    DS_TIPO_ACOMODACAO_PACIENTE_w,			                    
	    DS_MOTIVO_LIB_ACOM_USU_w,			                    
	    DS_MUNICIPIO_w,			                    
	    DS_OBS_PREV_ALTA_w,			                    
	    DS_UNIDADE_ATEND_w,			                    
	    CLASSIF_w,			                    
	    DS_CLASSIF_BENEFICIARIO_w,			                    
	    DS_MOTIVO_PERM_w,			                    
	    DS_PRE_RESERVA_w,			                    
	    NM_PESSOA_FISICA_w,
	    ie_pac_descolonizado_w,
	    ie_paciente_mr_cultura_w,
	    DS_COR_PERFIL_PEP_w,
	    NR_SEQ_APRESENT_w,
		nr_status_java_w,
		OBTER_DESC_EXPRESSAO(CASE WHEN ie_possui_rn_w='S' THEN  719927  ELSE 327114 END ,null),
		OBTER_DESC_EXPRESSAO(CASE WHEN ie_rn_possui_alta_w='S' THEN  719927  ELSE 327114 END ,null),
		DS_SEXO_PACIENTE_w,
		OBTER_DESC_EXPRESSAO(CASE WHEN ie_rn_possui_alta_hosp_w='S' THEN  719927  ELSE 327114 END ,null),
		OBTER_DESC_EXPRESSAO(CASE WHEN IE_RADIOTERAPIA_w='S' THEN  719927  ELSE 327114 END ,null),
		DS_STATUS_WOCUPACAO_w,
		OBTER_DESC_EXPRESSAO(CASE WHEN IE_PERMITE_VISITA_w='S' THEN  719927  ELSE 327114 END ,null),
		OBTER_DESC_EXPRESSAO(CASE WHEN ie_lib_financeira_w='S' THEN  719927  ELSE 327114 END ,null),
		CD_MOTIVO_MANUTENCAO_w,
		DS_MOTIVO_MANUTENCAO_w,
		DS_COR_ROUPARIA_HOTELARIA_w,
		ie_se_aniver_pessoa_w,
		ds_cor_precaucao_isolamento_w,
		ds_cor_motivo_isolamento_w,
		ie_bloqueio_acomp_w,
		dt_inicio_isolamento_w,
		dt_fim_isolamento_w,
		ds_paciente_mr_w,
		ds_paciente_mi_w,
		ds_proximo_leito_desej_w,
		nm_colab_resp_w,
		ds_status_gv_w,
		ds_status_saida_temporaria_w);
	end;
end loop;
close C01;


commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_wocupacao_leito ( NM_USUARIO_P text, CD_ESTAB_OCUPACAO_P bigint, CD_PERFIL_P bigint, CD_SETOR_ATENDIMENTO_P bigint, IE_PARAM_266_P text, IE_REGR_PRONT_P text, NR_SEQ_INTERNO_P bigint DEFAULT NULL, IE_DEPARTAMENTO_P text DEFAULT 'N', IE_SAIDA_TEMPORARIA_P text DEFAULT 'N', IE_HTML5_P text DEFAULT 'N') FROM PUBLIC;

