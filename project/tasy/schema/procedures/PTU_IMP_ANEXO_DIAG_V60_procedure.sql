-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ptu_imp_anexo_diag_v60 ( nr_seq_pedido_anexo_p ptu_pedido_aut_anexo.nr_sequencia%type, cd_doenca_01_p ptu_pedido_aut_diag_anexo.cd_doenca%type, cd_doenca_02_p ptu_pedido_aut_diag_anexo.cd_doenca%type, cd_doenca_03_p ptu_pedido_aut_diag_anexo.cd_doenca%type, cd_doenca_04_p ptu_pedido_aut_diag_anexo.cd_doenca%type, dt_diagnostico_p text, ie_estadia_tumor_p ptu_pedido_aut_diag_anexo.ie_estadia_tumor%type, cd_finalidade_tratamento_p ptu_pedido_aut_diag_anexo.cd_finalidade_tratamento%type, ie_tipo_quimioterapia_p ptu_pedido_aut_diag_anexo.ie_tipo_quimioterapia%type, ie_capacidade_funcional_p ptu_pedido_aut_diag_anexo.ie_capacidade_funcional%type, cd_diagnostico_imagem_p ptu_pedido_aut_diag_anexo.cd_diagnostico_imagem%type, ie_tipo_diagnostico_p ptu_pedido_aut_diag_anexo.ie_tipo_diagnostico%type, ds_plano_terapeutico_p ptu_pedido_aut_diag_anexo.ds_plano_terapeutico%type, ds_diagnostico_p ptu_pedido_aut_diag_anexo.ds_diagnostico%type, ds_observacao_p ptu_pedido_aut_diag_anexo.ds_observacao%type, ie_metastases_p ptu_pedido_aut_diag_anexo.ie_metastases%type, ie_nodulo_p ptu_pedido_aut_diag_anexo.ie_nodulo%type, ie_tumor_p ptu_pedido_aut_diag_anexo.ie_tumor%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: Realizar a importação do arquivo de 00806 - Pedido Ordem de Serviço
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [ x] Tasy (Delphi/Java) [  x] Portal [  ]  Relatórios [ x] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
dt_diagnostico_w		ptu_pedido_aut_diag_anexo.dt_diagnostico%type;


BEGIN

if (coalesce(dt_diagnostico_p,'X')	<> 'X') then
	dt_diagnostico_w	:= to_date(dt_diagnostico_p, 'dd/mm/rrrr');
end if;

--Insere o primeiro CID
if (cd_doenca_01_p IS NOT NULL AND cd_doenca_01_p::text <> '') then
	insert	into ptu_pedido_aut_diag_anexo(nr_sequencia, nr_seq_pedido_anexo ,dt_atualizacao,
		nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec,
		cd_doenca, ie_tipo_diagnostico)
	values (nextval('ptu_pedido_aut_diag_anexo_seq'), nr_seq_pedido_anexo_p, clock_timestamp(),
		nm_usuario_p, clock_timestamp(), nm_usuario_p,
		cd_doenca_01_p, 'DD');
end if;
--Insere o segundo CID
if (cd_doenca_02_p IS NOT NULL AND cd_doenca_02_p::text <> '') then
	insert	into ptu_pedido_aut_diag_anexo(nr_sequencia, nr_seq_pedido_anexo ,dt_atualizacao,
		nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec,
		cd_doenca, ie_tipo_diagnostico)
	values (nextval('ptu_pedido_aut_diag_anexo_seq'), nr_seq_pedido_anexo_p, clock_timestamp(),
		nm_usuario_p, clock_timestamp(), nm_usuario_p,
		cd_doenca_02_p, 'DD');
end if;
--Insere o terceiro CID
if (cd_doenca_03_p IS NOT NULL AND cd_doenca_03_p::text <> '') then
	insert	into ptu_pedido_aut_diag_anexo(nr_sequencia, nr_seq_pedido_anexo ,dt_atualizacao,
		nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec,
		cd_doenca, ie_tipo_diagnostico)
	values (nextval('ptu_pedido_aut_diag_anexo_seq'), nr_seq_pedido_anexo_p, clock_timestamp(),
		nm_usuario_p, clock_timestamp(), nm_usuario_p,
		cd_doenca_03_p, 'DD');
end if;
--Insere o quarto CID
if (cd_doenca_04_p IS NOT NULL AND cd_doenca_04_p::text <> '') then
	insert	into ptu_pedido_aut_diag_anexo(nr_sequencia, nr_seq_pedido_anexo ,dt_atualizacao,
		nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec,
		cd_doenca, ie_tipo_diagnostico)
	values (nextval('ptu_pedido_aut_diag_anexo_seq'), nr_seq_pedido_anexo_p, clock_timestamp(),
		nm_usuario_p, clock_timestamp(), nm_usuario_p,
		cd_doenca_04_p, 'DD');
end if;

--Insere informações referentes ao tratamento do beneficiário
insert	into ptu_pedido_aut_diag_anexo(nr_sequencia, nr_seq_pedido_anexo ,dt_atualizacao,
	nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec,
	dt_diagnostico, ie_estadia_tumor, cd_diagnostico_imagem,
	cd_finalidade_tratamento, ie_tipo_quimioterapia, ie_capacidade_funcional,
	ie_tipo_diagnostico, ds_plano_terapeutico,
	ds_diagnostico, ds_observacao,
	ie_metastases, ie_nodulo, ie_tumor)
values (nextval('ptu_pedido_aut_diag_anexo_seq'), nr_seq_pedido_anexo_p, clock_timestamp(),
	nm_usuario_p, clock_timestamp(), nm_usuario_p,
	dt_diagnostico_w, ie_estadia_tumor_p, cd_diagnostico_imagem_p,
	cd_finalidade_tratamento_p, ie_tipo_quimioterapia_p, ie_capacidade_funcional_p,
	'DT', ds_plano_terapeutico_p,
	ds_diagnostico_p, ds_observacao_p,
	ie_metastases_p, ie_nodulo_p, ie_tumor_p);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ptu_imp_anexo_diag_v60 ( nr_seq_pedido_anexo_p ptu_pedido_aut_anexo.nr_sequencia%type, cd_doenca_01_p ptu_pedido_aut_diag_anexo.cd_doenca%type, cd_doenca_02_p ptu_pedido_aut_diag_anexo.cd_doenca%type, cd_doenca_03_p ptu_pedido_aut_diag_anexo.cd_doenca%type, cd_doenca_04_p ptu_pedido_aut_diag_anexo.cd_doenca%type, dt_diagnostico_p text, ie_estadia_tumor_p ptu_pedido_aut_diag_anexo.ie_estadia_tumor%type, cd_finalidade_tratamento_p ptu_pedido_aut_diag_anexo.cd_finalidade_tratamento%type, ie_tipo_quimioterapia_p ptu_pedido_aut_diag_anexo.ie_tipo_quimioterapia%type, ie_capacidade_funcional_p ptu_pedido_aut_diag_anexo.ie_capacidade_funcional%type, cd_diagnostico_imagem_p ptu_pedido_aut_diag_anexo.cd_diagnostico_imagem%type, ie_tipo_diagnostico_p ptu_pedido_aut_diag_anexo.ie_tipo_diagnostico%type, ds_plano_terapeutico_p ptu_pedido_aut_diag_anexo.ds_plano_terapeutico%type, ds_diagnostico_p ptu_pedido_aut_diag_anexo.ds_diagnostico%type, ds_observacao_p ptu_pedido_aut_diag_anexo.ds_observacao%type, ie_metastases_p ptu_pedido_aut_diag_anexo.ie_metastases%type, ie_nodulo_p ptu_pedido_aut_diag_anexo.ie_nodulo%type, ie_tumor_p ptu_pedido_aut_diag_anexo.ie_tumor%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;

