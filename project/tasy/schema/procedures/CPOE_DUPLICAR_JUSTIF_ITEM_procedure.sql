-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cpoe_duplicar_justif_item (( ie_tipo_item_p text, nr_sequencia_p bigint, nm_usuario_p text, nr_seq_new_p bigint default null) is nr_seq_just_item_w cpoe_justificativa_item.nr_sequencia%type) RETURNS bigint AS $body$
BEGIN

	if (nr_old_p IS NOT NULL AND nr_old_p::text <> '') then
		return nr_new_p;
	end if;
	
	return null;
	
	end;

begin

if (ie_tipo_item_p IS NOT NULL AND ie_tipo_item_p::text <> '' AND nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '') then
	open c01;
	loop
	fetch c01 into	c01_w;
	EXIT WHEN NOT FOUND; /* apply on c01 */
		begin
		select	nextval('cpoe_justificativa_item_seq')
		into STRICT	nr_seq_just_item_w
		;
		
		c01_w.nr_sequencia 		:= nr_seq_just_item_w;
		c01_w.nm_usuario 		:= nm_usuario_p;
		c01_w.nm_usuario_nrec 		:= nm_usuario_p;
		c01_w.dt_atualizacao 		:= clock_timestamp();
		c01_w.dt_atualizacao_nrec 	:= clock_timestamp();
		c01_w.nr_seq_recomendacao 	:= get_nvl2(c01_w.nr_seq_recomendacao, nr_seq_new_p);
		c01_w.nr_seq_procedimento	:= get_nvl2(c01_w.nr_seq_procedimento, nr_seq_new_p);
		c01_w.nr_seq_material		:= get_nvl2(c01_w.nr_seq_material, nr_seq_new_p);
		c01_w.nr_seq_hemoterapia	:= get_nvl2(c01_w.nr_seq_hemoterapia, nr_seq_new_p);
		c01_w.nr_seq_gasoterapia	:= get_nvl2(c01_w.nr_seq_gasoterapia, nr_seq_new_p);
		c01_w.nr_seq_dieta		:= get_nvl2(c01_w.nr_seq_dieta, nr_seq_new_p);
		c01_w.nr_seq_dialise		:= get_nvl2(c01_w.nr_seq_dialise, nr_seq_new_p);

		insert into cpoe_justificativa_item values (c01_w.*);

		commit;

		end;
	end loop;
	close c01;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_duplicar_justif_item (( ie_tipo_item_p text, nr_sequencia_p bigint, nm_usuario_p text, nr_seq_new_p bigint default null) is nr_seq_just_item_w cpoe_justificativa_item.nr_sequencia%type) FROM PUBLIC;

