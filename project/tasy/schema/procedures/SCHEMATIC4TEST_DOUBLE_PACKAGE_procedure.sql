-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE schematic4test_double_package (nr_package_p bigint, nm_usuario_p text) AS $body$
DECLARE

nr_seq_executionw bigint;
nr_seq_suitew bigint;
nr_seq_urlw bigint;
nr_seq_browserw bigint;
nr_seq_servicew bigint;
nr_seq_snapshotw bigint;
NEWSEQUENCEPACKAGE bigint;
ie_switchitemw varchar(255);
ie_jobsitemw varchar(255);
nm_packagew varchar(255);
ie_jobsw varchar(255);
ie_chainw varchar(255);
ie_situacaow varchar(255);
NM_PACKAGEW2 varchar(255);

c01 CURSOR FOR  --loop suites in package
SELECT item.nr_seq_execution,item.nr_seq_suite,item.nr_seq_url,item.nr_seq_browser,item.nr_seq_service,item.ie_switch,item.ie_jobs
  INTO STRICT nr_seq_executionw,nr_seq_suitew,nr_seq_urlw,nr_seq_browserw,nr_seq_servicew,ie_switchitemw,ie_jobsitemw
FROM schem_test_package_item item
WHERE item.nr_seq_package = nr_package_p;


BEGIN
  --procedure that duplicate package
  IF (nr_package_p IS NOT NULL AND nr_package_p::text <> '') THEN
    SELECT nm_package, ie_jobs, ie_chain, nr_seq_snapshot, ie_situacao 
      INTO STRICT nm_packagew, ie_jobsw, ie_chainw, nr_seq_snapshotw, ie_situacaow
    FROM schem_test_package
    WHERE nr_sequencia = nr_package_p;

    NM_PACKAGEW2 := 'COPY OF '||NM_PACKAGEW;

    SELECT nextval('schem_test_package_seq') SEQUENCIA
        INTO STRICT NEWSEQUENCEPACKAGE
;
      
    INSERT INTO schem_test_package(nr_sequencia,nm_package,dt_atualizacao,nm_usuario,dt_atualizacao_nrec,nm_usuario_nrec,ie_jobs,ie_chain,nm_owner,nr_seq_snapshot,ie_situacao)
        VALUES (NEWSEQUENCEPACKAGE,NM_PACKAGEW2,clock_timestamp(),nm_usuario_p,clock_timestamp(),nm_usuario_p,ie_jobsw,ie_chainw,nm_usuario_p,nr_seq_snapshotw, ie_situacaow);
    COMMIT;

    OPEN C01;
    LOOP
    FETCH C01 INTO
      nr_seq_executionw,
      nr_seq_suitew,
      nr_seq_urlw,
      nr_seq_browserw,
      nr_seq_servicew,
      ie_switchitemw,
      ie_jobsitemw;
    EXIT WHEN NOT FOUND; /* apply on C01 */
    BEGIN
        INSERT INTO schem_test_package_item(nr_sequencia,nr_seq_execution,nr_seq_suite,nr_seq_url,nr_seq_browser,nr_seq_service,dt_atualizacao_nrec,nr_seq_package,nm_usuario_nrec,ie_switch,ie_jobs, DT_ATUALIZACAO, NM_USUARIO)
          VALUES (nextval('schem_test_package_item_seq'),nr_seq_executionw,nr_seq_suitew,nr_seq_urlw,nr_seq_browserw,nr_seq_servicew,clock_timestamp(),NEWSEQUENCEPACKAGE,nm_usuario_p,ie_switchitemw,ie_jobsitemw, clock_timestamp(), nm_usuario_p);
        COMMIT;
    END;
    END LOOP;
    CLOSE C01;
	
  END IF;
  EXCEPTION
  WHEN no_data_found THEN
	RAISE NOTICE 'Erro: Data not found';
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE schematic4test_double_package (nr_package_p bigint, nm_usuario_p text) FROM PUBLIC;

