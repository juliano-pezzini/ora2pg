-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_obter_inf_fin_pag_regra ( nr_seq_regra_port_p bigint, cd_tipo_portador_p INOUT bigint, cd_portador_p INOUT bigint, nr_seq_conta_banco_p INOUT bigint, nr_seq_carteira_cobr_p INOUT bigint, ie_gerar_nota_titulo_p INOUT text, cd_tipo_portador_deb_aut_p INOUT bigint, cd_portador_deb_aut_p INOUT bigint, nr_seq_conta_banco_deb_aut_p INOUT bigint, ie_portador_exclusivo_p INOUT text, ie_destacar_reajuste_p INOUT text, ie_gerar_cobr_escrit_p INOUT text, nm_usuario_p text, cd_estabelecimento_p bigint) AS $body$
DECLARE


cd_tipo_portador_param_w	integer;
cd_portador_param_w		bigint;
nr_seq_conta_banco_param_w	bigint;

cd_tipo_portador_w		integer;
cd_portador_w			bigint;
nr_seq_conta_banco_w		bigint;
nr_seq_carteira_cobr_w		bigint;
ie_gerar_nota_titulo_w		varchar(2);
cd_tipo_portador_deb_aut_w	pls_regra_portador_mens.cd_tipo_portador_deb_aut%type;
cd_portador_deb_aut_w		pls_regra_portador_mens.cd_portador_deb_aut%type;
nr_seq_conta_banco_deb_aut_w	pls_regra_portador_mens.nr_seq_conta_banco_deb_aut%type;
ie_portador_exclusivo_w		pls_regra_portador_mens.ie_portador_exclusivo%type;
ie_destacar_reajuste_w		pls_regra_portador_mens.ie_destacar_reajuste%type;
ie_gerar_cobr_escrit_w		pls_regra_portador_mens.ie_gerar_cobr_escrit%type;


c01 CURSOR FOR
	SELECT	a.cd_tipo_portador,
		a.cd_portador,
		a.nr_seq_conta_banco,
		a.nr_seq_carteira_cobr,
		a.ie_geracao_nota_titulo,
		a.cd_tipo_portador_deb_aut,
		a.cd_portador_deb_aut,
		a.nr_seq_conta_banco_deb_aut,
		a.ie_portador_exclusivo,
		a.ie_destacar_reajuste,
		a.ie_gerar_cobr_escrit
	from	pls_regra_portador_mens a
	where	a.nr_sequencia = nr_seq_regra_port_p
	order by  coalesce(cd_banco,0),
		  coalesce(nr_seq_forma_cobranca,0);


BEGIN

select	max(a.cd_tipo_portador),
	max(a.cd_portador),
	max(a.nr_seq_conta_banco)
into STRICT	cd_tipo_portador_param_w,
	cd_portador_param_w,
	nr_seq_conta_banco_param_w
from	pls_parametros a
where	a.cd_estabelecimento	= cd_estabelecimento_p;

open c01;
loop
fetch c01 into
	cd_tipo_portador_w,
	cd_portador_w,
	nr_seq_conta_banco_w,
	nr_seq_carteira_cobr_w,
	ie_gerar_nota_titulo_w,
	cd_tipo_portador_deb_aut_w,
	cd_portador_deb_aut_w,
	nr_seq_conta_banco_deb_aut_w,
	ie_portador_exclusivo_w,
	ie_destacar_reajuste_w,
	ie_gerar_cobr_escrit_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
end loop;
close c01;

cd_tipo_portador_p		:= coalesce(cd_tipo_portador_w,cd_tipo_portador_param_w);
cd_portador_p			:= coalesce(cd_portador_w,cd_portador_param_w);
nr_seq_conta_banco_p		:= coalesce(nr_seq_conta_banco_w,nr_seq_conta_banco_param_w);
nr_seq_carteira_cobr_p		:= nr_seq_carteira_cobr_w;
ie_gerar_nota_titulo_p		:= ie_gerar_nota_titulo_w;
cd_tipo_portador_deb_aut_p	:= cd_tipo_portador_deb_aut_w;
cd_portador_deb_aut_p		:= cd_portador_deb_aut_w;
nr_seq_conta_banco_deb_aut_p	:= nr_seq_conta_banco_deb_aut_w;
ie_portador_exclusivo_p		:= ie_portador_exclusivo_w;
ie_destacar_reajuste_p		:= ie_destacar_reajuste_w;
ie_gerar_cobr_escrit_p		:= ie_gerar_cobr_escrit_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_obter_inf_fin_pag_regra ( nr_seq_regra_port_p bigint, cd_tipo_portador_p INOUT bigint, cd_portador_p INOUT bigint, nr_seq_conta_banco_p INOUT bigint, nr_seq_carteira_cobr_p INOUT bigint, ie_gerar_nota_titulo_p INOUT text, cd_tipo_portador_deb_aut_p INOUT bigint, cd_portador_deb_aut_p INOUT bigint, nr_seq_conta_banco_deb_aut_p INOUT bigint, ie_portador_exclusivo_p INOUT text, ie_destacar_reajuste_p INOUT text, ie_gerar_cobr_escrit_p INOUT text, nm_usuario_p text, cd_estabelecimento_p bigint) FROM PUBLIC;

