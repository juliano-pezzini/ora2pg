-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_escala_sv_tempo ( cd_pessoa_fisica_p text, qt_minutos_p bigint, cd_escala_dor_p INOUT text, qt_escala_dor_p INOUT bigint) AS $body$
DECLARE


nr_seq_sinal_vital_w	bigint;
cd_escala_dor_w		varchar(5);
qt_escala_dor_w		real;


BEGIN

cd_escala_dor_w := cd_escala_dor_p;
cd_escala_dor_p := null;

if (coalesce(cd_pessoa_fisica_p,'0') <> '0') then
	begin
	select	coalesce(max(nr_sequencia),0)
	into STRICT	nr_seq_sinal_vital_w
	from	atendimento_sinal_vital
	where	cd_paciente = cd_pessoa_fisica_p
	and	ie_situacao = 'A'
	and	coalesce(ie_rn,'N') = 'N'
	and	((coalesce(cd_escala_dor_w::text, '') = '') or (cd_escala_dor = cd_escala_dor_w))
	and	clock_timestamp() between dt_sinal_vital and (dt_sinal_vital + (qt_minutos_p/1440));

	if (nr_seq_sinal_vital_w > 0) then
		select	cd_escala_dor,
			qt_escala_dor
		into STRICT	cd_escala_dor_w,
			qt_escala_dor_w
		from	atendimento_sinal_vital a
		where	a.nr_sequencia = nr_seq_sinal_vital_w;
	end if;

	cd_escala_dor_p := cd_escala_dor_w;
	qt_escala_dor_p := qt_escala_dor_w;
	end;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_escala_sv_tempo ( cd_pessoa_fisica_p text, qt_minutos_p bigint, cd_escala_dor_p INOUT text, qt_escala_dor_p INOUT bigint) FROM PUBLIC;

