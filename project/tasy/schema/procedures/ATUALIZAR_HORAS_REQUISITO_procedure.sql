-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_horas_requisito ( nr_seq_requisito_p LATAM_REQUISITO.NR_SEQ_REQUISITO%type, vl_horas_p LATAM_REQUISITO.QT_TEMPO_HORAS%type, ie_sob_medida_p LATAM_REQUISITO.IE_SOB_MEDIDA%type, nm_usuario_p LATAM_REQUISITO.NM_USUARIO%type, nr_sequencia_p LATAM_REQUISITO.NR_SEQUENCIA%type DEFAULT NULL, nr_seq_gap_p LATAM_REQUISITO.NR_SEQ_GAP%type DEFAULT NULL, nr_seq_prs_p LATAM_REQUISITO.NR_SEQ_PRS%type DEFAULT NULL, ie_necessita_design_p LATAM_REQUISITO.IE_NECESSITA_DESIGN%type DEFAULT NULL, ie_necessita_tecnologia_p LATAM_REQUISITO.IE_NECESSITA_TECNOLOGIA%type DEFAULT NULL, ie_necessita_traducao_p LATAM_REQUISITO.IE_NECESSITA_TRADUCAO%type DEFAULT NULL, ie_esforco_desenv_p LATAM_REQUISITO.IE_ESFORCO_DESENV%type DEFAULT NULL, ie_complexidade_p LATAM_REQUISITO.IE_COMPLEXIDADE%type DEFAULT NULL, pr_confianca_p LATAM_REQUISITO.PR_CONFIANCA%type DEFAULT NULL) AS $body$
DECLARE


qt_esforco_total_w      LATAM_REQUISITO.QT_TEMPO_HORAS%type;
ie_liberar_desenv_old_w LATAM_REQUISITO.IE_LIBERAR_DESENV%type;

BEGIN

    if (nr_seq_requisito_p IS NOT NULL AND nr_seq_requisito_p::text <> '') THEN
        if (ie_sob_medida_p = 'S' AND vl_horas_p > 0) THEN
            UPDATE latam_requisito
            SET         qt_tempo_horas  = vl_horas_p,
                        ie_sob_medida   = ie_sob_medida_p,
                        nm_usuario      = nm_usuario_p,
                        dt_atualizacao  = clock_timestamp()
            WHERE       nr_sequencia    = nr_seq_requisito_p
            RETURNING   ie_liberar_desenv into ie_liberar_desenv_old_w;

            CALL generate_latam_log(nr_seq_requisito_p, ie_liberar_desenv_old_w, 889438);
        elsif (ie_sob_medida_p = 'N') THEN
            qt_esforco_total_w := CALCULAR_ESFORCO_TOTAL(
                                    nr_sequencia_p,
                                    nr_seq_gap_p,
                                    nr_seq_prs_p,
                                    ie_necessita_design_p,
                                    ie_necessita_tecnologia_p,
                                    ie_necessita_traducao_p,
                                    ie_esforco_desenv_p,
                                    ie_complexidade_p,
                                    pr_confianca_p
                                  );

            UPDATE latam_requisito
            SET         qt_tempo_horas  = qt_esforco_total_w,
                        ie_sob_medida   = ie_sob_medida_p,
                        nm_usuario      = nm_usuario_p,
                        dt_atualizacao  = clock_timestamp()
            WHERE       nr_sequencia    = nr_seq_requisito_p
            RETURNING   ie_liberar_desenv into ie_liberar_desenv_old_w;

            CALL generate_latam_log(nr_seq_requisito_p, ie_liberar_desenv_old_w, 889442);
        end if;
        COMMIT;
    end if;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_horas_requisito ( nr_seq_requisito_p LATAM_REQUISITO.NR_SEQ_REQUISITO%type, vl_horas_p LATAM_REQUISITO.QT_TEMPO_HORAS%type, ie_sob_medida_p LATAM_REQUISITO.IE_SOB_MEDIDA%type, nm_usuario_p LATAM_REQUISITO.NM_USUARIO%type, nr_sequencia_p LATAM_REQUISITO.NR_SEQUENCIA%type DEFAULT NULL, nr_seq_gap_p LATAM_REQUISITO.NR_SEQ_GAP%type DEFAULT NULL, nr_seq_prs_p LATAM_REQUISITO.NR_SEQ_PRS%type DEFAULT NULL, ie_necessita_design_p LATAM_REQUISITO.IE_NECESSITA_DESIGN%type DEFAULT NULL, ie_necessita_tecnologia_p LATAM_REQUISITO.IE_NECESSITA_TECNOLOGIA%type DEFAULT NULL, ie_necessita_traducao_p LATAM_REQUISITO.IE_NECESSITA_TRADUCAO%type DEFAULT NULL, ie_esforco_desenv_p LATAM_REQUISITO.IE_ESFORCO_DESENV%type DEFAULT NULL, ie_complexidade_p LATAM_REQUISITO.IE_COMPLEXIDADE%type DEFAULT NULL, pr_confianca_p LATAM_REQUISITO.PR_CONFIANCA%type DEFAULT NULL) FROM PUBLIC;

