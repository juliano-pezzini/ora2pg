-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_inf_filtro_copia_prescr ( nr_prescricao_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint, nr_atendimento_p INOUT bigint, nr_horas_validade_p INOUT bigint, hr_inicio_prescricao_p INOUT timestamp, dt_prescricao_p INOUT timestamp ) AS $body$
DECLARE

 
 
nr_atendimento_w	bigint;
nr_horas_validade_w	integer;
cd_setor_atendimento_w	integer;
hr_inicio_prescricao_w	timestamp;
ie_prim_horario_setor_w varchar(1);


BEGIN 
 
select	nr_atendimento, 
	cd_setor_atendimento 
into STRICT	nr_atendimento_w, 
	cd_setor_atendimento_w 
from	prescr_medica 
where 	nr_prescricao = nr_prescricao_p;
 
select	nr_horas_validade 
into STRICT	nr_horas_validade_w 
from 	prescr_medica 
where 	nr_prescricao = nr_prescricao_p;
 
 
ie_prim_horario_setor_w := Obter_Valor_Param_Usuario(8030,44, obter_perfil_ativo,nm_usuario_p,cd_estabelecimento_p);					
 
if (ie_prim_horario_setor_w = 'S') then 
	select	coalesce(hr_inicio_prescricao,clock_timestamp()) 
	into STRICT	hr_inicio_prescricao_w 
	from 	setor_atendimento 
	where 	cd_setor_atendimento = cd_setor_atendimento_w;
else 
	hr_inicio_prescricao_w := Obter_Prim_Horario_Prescricao(nr_atendimento_w,cd_setor_atendimento_w, clock_timestamp(),nm_usuario_p,'R');
end if;
 
 
nr_atendimento_p	:=	nr_atendimento_w;
nr_horas_validade_p 	:=	nr_horas_validade_w;
hr_inicio_prescricao_p 	:=	hr_inicio_prescricao_w;
dt_prescricao_p		:=	clock_timestamp();
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_inf_filtro_copia_prescr ( nr_prescricao_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint, nr_atendimento_p INOUT bigint, nr_horas_validade_p INOUT bigint, hr_inicio_prescricao_p INOUT timestamp, dt_prescricao_p INOUT timestamp ) FROM PUBLIC;

