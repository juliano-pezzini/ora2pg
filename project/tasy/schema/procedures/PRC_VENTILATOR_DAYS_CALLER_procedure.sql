-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE prc_ventilator_days_caller ( dtinicio_p timestamp, dtfim_p timestamp, estabelecimento_p bigint, setor_p bigint, ano_p bigint, trimestre_p bigint, visao_p bigint, pessoa_p text) AS $body$
BEGIN
  INSERT INTO W_VENTILATOR_DAYS_LOG(
    nr_sequencia,
    dt_inicio, 
    dt_fim, 
    cd_estabelecimento, 
    cd_setor_atendimento, 
    nr_year, 
    nr_quarter, 
    ie_type, 
    cd_patient, 
    dt_criacao,
    nm_usuario) 
  VALUES (
    nextval('w_ventilator_days_log_seq'),
    dtinicio_p,
    dtfim_p,
    coalesce(estabelecimento_p, 0),
    coalesce(setor_p, 0),
    ano_p,
    trimestre_p,
    visao_p,
    trim(both pessoa_p),
    clock_timestamp(),
    wheb_usuario_pck.get_nm_usuario);
  --
  COMMIT;
  --
  IF VISAO_P = 3 AND coalesce(trim(both PESSOA_P)::text, '') = '' THEN
    CALL WHEB_MENSAGEM_PCK.exibir_mensagem_abort('The PATIENT CODE parameter is required when BY PATIENT is selected in the REPORT TYPE parameter.');
  ELSE
    CALL PKG_VENTILATOR_DAYS.RUN(dtinicio_p, dtfim_p, coalesce(estabelecimento_p, 0), coalesce(setor_p, 0), ano_p, trimestre_p, visao_p, pessoa_p);
  END IF;
  --
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE prc_ventilator_days_caller ( dtinicio_p timestamp, dtfim_p timestamp, estabelecimento_p bigint, setor_p bigint, ano_p bigint, trimestre_p bigint, visao_p bigint, pessoa_p text) FROM PUBLIC;

