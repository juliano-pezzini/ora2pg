-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE generate_era_request_data ( dt_inicio_p timestamp, dt_fim_p timestamp, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE


ds_request_w	varchar(2000);
w_nr_sequencia  sts_request.nr_sequencia%TYPE;


BEGIN
	
    SELECT  nextval('era_request_seq')
    INTO STRICT    w_nr_sequencia
;

    INSERT INTO era_request(nr_sequencia,
           dt_atualizacao,
           nm_usuario,
           dt_atualizacao_nrec,
           nm_usuario_nrec,
           dt_received_from,
           dt_received_to)
    VALUES (w_nr_sequencia,
           clock_timestamp(),
           nm_usuario_p,
           clock_timestamp(),
           nm_usuario_p,
           dt_inicio_p,
           dt_fim_p);

	ds_request_w := '{"receivedFromDateTime": "' || to_char(dt_inicio_p,'YYYY-MM-DD"T"HH24:MI:SS') || '.000' || 
		'","receivedToDateTime":"' || to_char(dt_fim_p,'YYYY-MM-DD"T"HH24:MI:SS') || '.000' || 
		'","userName":"' || nm_usuario_p || 
		'","establishmentCode":"' || cd_estabelecimento_p ||
		'","eraRequestId":"' || w_nr_sequencia ||'"}';

	CALL execute_bifrost_integration(198, ds_request_w);
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE generate_era_request_data ( dt_inicio_p timestamp, dt_fim_p timestamp, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

