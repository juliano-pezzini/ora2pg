-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE hd_inserir_medic_lote_manual ( cd_pessoa_fisica_p text, nr_seq_medic_p integer, nr_seq_local_p integer, nr_seq_marca_p integer, qt_material_p integer, nm_lote_medic_p text, dt_venc_p timestamp, nm_usuario_p text ) AS $body$
DECLARE

hd_lote_seq_w		bigint;
nr_seq_medic_w		bigint;
hd_entrega_medic_seq_w	bigint;

BEGIN
if (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') and (coalesce(nr_seq_medic_p,0)     >  0) and (coalesce(nr_seq_local_p,0)     >  0) and (coalesce(nr_seq_marca_p,0)     >  0) and (coalesce(qt_material_p,0) 	   >  0) and (nm_lote_medic_p IS NOT NULL AND nm_lote_medic_p::text <> '') then

				select 	nextval('hd_entrega_medic_seq')
				into STRICT	hd_entrega_medic_seq_w
				;

				insert 	into	hd_entrega_medic(
						nr_sequencia,
						dt_atualizacao,
						nm_usuario,
						dt_entrega,
						nr_seq_medic,
						dt_atualizacao_nrec,
						nm_usuario_nrec,
						dt_liberacao,
						cd_estabelecimento)
					values (
						hd_entrega_medic_seq_w,
						clock_timestamp(),
						coalesce(nm_usuario_p,obter_usuario_ativo),
						clock_timestamp(),
						nr_seq_medic_p,
						clock_timestamp(),
						coalesce(nm_usuario_p,obter_usuario_ativo),
						clock_timestamp(),
						wheb_usuario_pck.get_cd_estabelecimento
						);

				select 	nextval('hd_lote_medic_ext_seq')
				into STRICT	hd_lote_seq_w
				;

				insert 	into	hd_lote_medic_ext(
						nr_sequencia,
						dt_atualizacao,
						nm_usuario,
						dt_atualizacao_nrec,
						nm_usuario_nrec,
						nr_seq_local,
						nr_seq_marca,
						qt_material,
						nr_seq_entrega,
						ds_lote_fornec,
						dt_vencimento)
					values (
						hd_lote_seq_w,
						clock_timestamp(),
						coalesce(nm_usuario_p,obter_usuario_ativo),
						clock_timestamp(),
						coalesce(nm_usuario_p,obter_usuario_ativo),
						nr_seq_local_p,
						nr_seq_marca_p,
						qt_material_p,
						hd_entrega_medic_seq_w,
						nm_lote_medic_p,
						dt_venc_p
						);


				insert 	into	hd_lote_paciente(
						nr_sequencia,
						dt_atualizacao,
						nm_usuario,
						cd_pessoa_fisica,
						dt_atualizacao_nrec,
						nm_usuario_nrec,
						qt_material,
						nr_seq_entrega)
					values (
						nextval('hd_lote_paciente_seq'),
						clock_timestamp(),
						coalesce(nm_usuario_p,obter_usuario_ativo),
						cd_pessoa_fisica_p,
						clock_timestamp(),
						coalesce(nm_usuario_p,obter_usuario_ativo),
						qt_material_p,
						hd_entrega_medic_seq_w
						);


end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE hd_inserir_medic_lote_manual ( cd_pessoa_fisica_p text, nr_seq_medic_p integer, nr_seq_local_p integer, nr_seq_marca_p integer, qt_material_p integer, nm_lote_medic_p text, dt_venc_p timestamp, nm_usuario_p text ) FROM PUBLIC;

