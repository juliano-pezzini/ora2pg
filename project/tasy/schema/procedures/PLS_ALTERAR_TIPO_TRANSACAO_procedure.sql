-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_alterar_tipo_transacao ( nr_seq_conta_mat_regra_p pls_conta_mat_regra.nr_sequencia%type, ie_tp_transacao_p pls_conta_mat_regra.ie_tp_transacao%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) AS $body$
DECLARE


ds_log_call_w	varchar(1500);
ds_observacao_w	varchar(4000);				
					

BEGIN
	
	CALL pls_cta_proc_mat_regra_pck.cria_registro_regra_mat(nr_seq_conta_mat_regra_p, nm_usuario_p);

	update  pls_conta_mat_regra
	set     ie_tp_transacao = ie_tp_transacao_p,
			dt_atualizacao = clock_timestamp(),
			nm_usuario = nm_usuario_p
	where  nr_sequencia = nr_seq_conta_mat_regra_p;
	commit;

	ds_log_call_w := substr(pls_obter_detalhe_exec(false),1,1500);
	ds_observacao_w := 'Seq regra modificada = '|| nr_seq_conta_mat_regra_p||' ie_tp_transacao = '||ie_tp_transacao_p;

	insert into plsprco_cta( 	nr_sequencia, dt_atualizacao, nm_usuario,
							dt_atualizacao_nrec, nm_usuario_nrec, nm_tabela,
							ds_log, ds_log_call, ds_funcao_ativa, 
							ie_aplicacao_tasy, nm_maquina, nr_seq_conta_mat, ie_opcao )
				values ( 	nextval('plsprco_cta_seq'), clock_timestamp(), nm_usuario_p,
							clock_timestamp(), substr(coalesce(wheb_usuario_pck.get_nm_usuario,wheb_mensagem_pck.get_texto(299116)),1,14), 'PLS_CONTA_MAT_REGRA', 
							ds_observacao_w, ds_log_call_w, obter_funcao_ativa, 
							pls_se_aplicacao_tasy , wheb_usuario_pck.get_machine, nr_seq_conta_mat_regra_p, '0');


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_alterar_tipo_transacao ( nr_seq_conta_mat_regra_p pls_conta_mat_regra.nr_sequencia%type, ie_tp_transacao_p pls_conta_mat_regra.ie_tp_transacao%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) FROM PUBLIC;

