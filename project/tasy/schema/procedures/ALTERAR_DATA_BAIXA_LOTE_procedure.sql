-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE alterar_data_baixa_lote ( dt_baixa_p timestamp, nr_seq_escrit_p bigint) AS $body$
DECLARE


dt_liquidacao_w  timestamp;
qt_reg_w  bigint;


BEGIN
select 	max(dt_liquidacao)
into STRICT   	dt_liquidacao_w
from 	titulo_pagar_escrit
where 	nr_seq_escrit = nr_seq_escrit_p;

select count(*)
into STRICT 	qt_reg_w
from 	titulo_pagar_escrit
where 	nr_seq_escrit = nr_seq_escrit_p
and   	coalesce(dt_liquidacao::text, '') = '';

if (coalesce(dt_baixa_p::text, '') = '') then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(348233);
end if;

	if (qt_reg_w = 0) then


	if ( dt_baixa_p >= dt_liquidacao_w) then
		update 	banco_escritural
		set 	dt_baixa = dt_baixa_p,
				dt_atualizacao  = clock_timestamp()
		where 	nr_sequencia = nr_seq_escrit_p;
else

   CALL wheb_mensagem_pck.exibir_mensagem_abort(348230);

  end if;

 else
	CALL wheb_mensagem_pck.exibir_mensagem_abort(348363);

end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE alterar_data_baixa_lote ( dt_baixa_p timestamp, nr_seq_escrit_p bigint) FROM PUBLIC;

