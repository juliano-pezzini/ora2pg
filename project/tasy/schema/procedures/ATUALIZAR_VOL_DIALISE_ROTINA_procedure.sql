-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_vol_dialise_rotina (nr_prescricao_p bigint, nr_seq_dialise_p bigint, nr_seq_solucao_p bigint, qt_hora_sessao_p bigint, qt_min_sessao_p bigint, ie_tipo_solucao_p text, qt_dosagem_p bigint, ie_unid_vel_inf_p text) AS $body$
DECLARE


ds_resultado_w bigint := 0;

qt_tempo_total_w	double precision;


BEGIN

if (ie_unid_vel_inf_p = 'mlm') and (ie_tipo_solucao_p <> 'C') 	and (qt_min_sessao_p > 0)		then

	qt_tempo_total_w	:= qt_min_sessao_p;

	if (qt_hora_sessao_p > 0) then
		qt_tempo_total_w := qt_tempo_total_w + (qt_hora_sessao_p * 60);
	end if;

	ds_resultado_w := coalesce((qt_dosagem_p * qt_tempo_total_w),0);

	update	prescr_solucao
	set		qt_solucao_total = ds_resultado_w
	where 	nr_prescricao  = nr_prescricao_p
	and   	nr_seq_dialise = nr_seq_dialise_p
	and   	nr_seq_solucao  = nr_seq_solucao_p;

elsif (ie_unid_vel_inf_p = 'mlh')	and (ie_tipo_solucao_p <> 'C')	and (qt_hora_sessao_p > 0)		then

	qt_tempo_total_w	:= qt_hora_sessao_p;

	if (qt_min_sessao_p > 0) then
		qt_tempo_total_w := qt_tempo_total_w + (qt_min_sessao_p/60);
	end if;

	ds_resultado_w := coalesce((qt_dosagem_p * qt_tempo_total_w),0);

	update	prescr_solucao
	set		qt_solucao_total = ds_resultado_w
	where 	nr_prescricao  = nr_prescricao_p
	and   	nr_seq_dialise = nr_seq_dialise_p
	and   	nr_seq_solucao  = nr_seq_solucao_p;

else

	update	prescr_solucao
	set		qt_solucao_total  = NULL
	where 	nr_prescricao  = nr_prescricao_p
	and   	nr_seq_dialise = nr_seq_dialise_p
	and   	nr_seq_solucao  = nr_seq_solucao_p;


end if;


commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_vol_dialise_rotina (nr_prescricao_p bigint, nr_seq_dialise_p bigint, nr_seq_solucao_p bigint, qt_hora_sessao_p bigint, qt_min_sessao_p bigint, ie_tipo_solucao_p text, qt_dosagem_p bigint, ie_unid_vel_inf_p text) FROM PUBLIC;

