-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE tax_reinf_bifrost_integration (arguments_p text, username_p text, integration_control_p bigint, ie_status_p INOUT bigint) AS $body$
DECLARE

event_w                 constant varchar(30) := 'tax_obligation_reinf';
data_callback_w         constant varchar(80) := 'com.philips.tasy.integration.tax.reinf.callback.ReinfEventCallback';
timeout_w               constant bigint := 60;
response_w              varchar(4000);
count_w                 bigint := 0;
status_w                tax_reinf_bifrost_int.ie_status%type;

BEGIN
  select bifrost.send_integration(event_w,
                                  data_callback_w, 
                                  arguments_p,
                                  username_p) 
  into STRICT response_w
;

  while coalesce(status_w::text, '') = '' and count_w < timeout_w
  loop
    begin
      select  ie_status
      into STRICT    status_w
      from    tax_reinf_bifrost_int
      where   nr_sequencia = integration_control_p;
      count_w := count_w + 1;
      dbms_lock.sleep(1);
    end;
  end loop;

  delete from tax_reinf_bifrost_int
  where nr_sequencia = integration_control_p;
  commit;

  if count_w >= timeout_w then
    status_w := -1;
  end if;

  ie_status_p := status_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tax_reinf_bifrost_integration (arguments_p text, username_p text, integration_control_p bigint, ie_status_p INOUT bigint) FROM PUBLIC;

