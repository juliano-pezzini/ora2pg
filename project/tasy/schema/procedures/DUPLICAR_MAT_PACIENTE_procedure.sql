-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_mat_paciente ( nr_sequencia_p bigint, nm_usuario_p text, ie_atualiza_local_estoque_p text, nr_seq_gerada_p INOUT bigint) AS $body$
DECLARE


nr_sequencia_w			bigint;


BEGIN

/* Ricardo 21/01/2005 - incluido o novo parrâmetro IE_ATUALIZA_LOCAL_ESTOQUE, para glosa por % Não deve atualizar o estoque do item glosado */

select nextval('material_atend_paciente_seq')
into STRICT nr_sequencia_w
;

insert	into material_atend_paciente(
	NR_SEQUENCIA,NR_ATENDIMENTO,DT_ENTRADA_UNIDADE,CD_MATERIAL,DT_ATENDIMENTO,
	CD_UNIDADE_MEDIDA,QT_MATERIAL,DT_ATUALIZACAO,NM_USUARIO,CD_CONVENIO,CD_CATEGORIA,
	DT_PRESCRICAO,CD_MATERIAL_PRESCRICAO,IE_VIA_APLICACAO,DS_OBSERVACAO,VL_MATERIAL,
	CD_TAB_PRECO_MATERIAL,DT_VIGENCIA_TABELA,DT_ACERTO_CONTA,DT_ACERTO_CONVENIO,
	NR_PRESCRICAO,NR_SEQUENCIA_PRESCRICAO,CD_MOTIVO_EXC_CONTA,DS_COMPL_MOTIVO_EXCON,
	CD_LOCAL_ESTOQUE,DT_ATUALIZACAO_ESTOQUE,CD_ACAO,CD_SETOR_ATENDIMENTO,QT_DEVOLVIDA,
	CD_MOTIVO_DEVOLUCAO,NR_CIRURGIA,NR_DOC_CONVENIO,QT_EXECUTADA,DT_CONTA,VL_UNITARIO,
	CD_PROCED_REFERENCIA,CD_CONTA_CONTABIL,QT_AJUSTE_CONTA,NR_AIH,IE_VALOR_INFORMADO,
	CD_ESTABELECIMENTO_CUSTO,CD_TABELA_CUSTO,CD_SITUACAO_GLOSA,NR_LOTE_CONTABIL,
	CD_MATERIAL_CONVENIO,NR_SEQ_AUTORIZACAO,NR_INTERNO_CONTA,NR_SEQ_PROC_PRINC,
	IE_GUIA_INFORMADA,CD_ESPECIALIDADE,NM_USUARIO_ORIGINAL,NR_SEQ_PROC_PACOTE,
	VL_TABELA_ORIGINAL,IE_EMITE_CONTA,CD_SETOR_RECEITA,CD_CGC_FORNECEDOR,
	NR_SEQ_LOTE_FORNEC,CD_MATERIAL_EXEC,NR_SEQ_ATEPACU,IE_TIPO_GUIA,NR_DOC_INTERNO,
	IE_AUDITORIA,NR_SEQ_GRUPO_REC,CD_MOTIVO_AJUSTE,NR_SEQ_COR_EXEC,NR_SEQ_AGENDA_PAC_OPME)
SELECT
	NR_SEQUENCIA_W,NR_ATENDIMENTO,DT_ENTRADA_UNIDADE,CD_MATERIAL,DT_ATENDIMENTO + 3/86400,
	CD_UNIDADE_MEDIDA,QT_MATERIAL,clock_timestamp(),NM_USUARIO_P,CD_CONVENIO,CD_CATEGORIA,
	DT_PRESCRICAO,CD_MATERIAL_PRESCRICAO,IE_VIA_APLICACAO,DS_OBSERVACAO,VL_MATERIAL,
	CD_TAB_PRECO_MATERIAL,DT_VIGENCIA_TABELA,DT_ACERTO_CONTA,DT_ACERTO_CONVENIO,
	NR_PRESCRICAO,NR_SEQUENCIA_PRESCRICAO,CD_MOTIVO_EXC_CONTA,DS_COMPL_MOTIVO_EXCON,
	CASE WHEN ie_atualiza_local_estoque_p='S' THEN  CD_LOCAL_ESTOQUE  ELSE null END ,
	CASE WHEN ie_atualiza_local_estoque_p='S' THEN  DT_ATUALIZACAO_ESTOQUE  ELSE null END ,
	CD_ACAO,CD_SETOR_ATENDIMENTO,QT_DEVOLVIDA,
	CD_MOTIVO_DEVOLUCAO,NR_CIRURGIA,NR_DOC_CONVENIO,QT_EXECUTADA,DT_CONTA,VL_UNITARIO,
	CD_PROCED_REFERENCIA,CD_CONTA_CONTABIL,QT_AJUSTE_CONTA,NR_AIH,IE_VALOR_INFORMADO,
	CD_ESTABELECIMENTO_CUSTO,CD_TABELA_CUSTO,CD_SITUACAO_GLOSA,NR_LOTE_CONTABIL,
	CD_MATERIAL_CONVENIO,NR_SEQ_AUTORIZACAO,NR_INTERNO_CONTA,NR_SEQ_PROC_PRINC,
	IE_GUIA_INFORMADA,CD_ESPECIALIDADE,NM_USUARIO_ORIGINAL,NR_SEQ_PROC_PACOTE,
	VL_TABELA_ORIGINAL,IE_EMITE_CONTA,CD_SETOR_RECEITA,CD_CGC_FORNECEDOR,
	NR_SEQ_LOTE_FORNEC,CD_MATERIAL_EXEC,NR_SEQ_ATEPACU,IE_TIPO_GUIA,NR_DOC_INTERNO,
	IE_AUDITORIA,NR_SEQ_GRUPO_REC,CD_MOTIVO_AJUSTE,1762, NR_SEQ_AGENDA_PAC_OPME
from 	material_atend_paciente
where 	nr_sequencia = nr_sequencia_p;

nr_seq_gerada_p		:= nr_sequencia_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_mat_paciente ( nr_sequencia_p bigint, nm_usuario_p text, ie_atualiza_local_estoque_p text, nr_seq_gerada_p INOUT bigint) FROM PUBLIC;

