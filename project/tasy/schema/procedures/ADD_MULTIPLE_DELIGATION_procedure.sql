-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE add_multiple_deligation ( cd_cargo_p bigint, cd_departamento_p bigint, proxy_list_p text, profile_list_p text, dt_inicio_delegacao_p timestamp, dt_fim_delegacao_p timestamp, cd_razao_p bigint, ds_observacao_p text ) AS $body$
DECLARE


proxy_list_w       varchar(2000);
  rec_w RECORD;

BEGIN
    proxy_list_w    := coalesce(proxy_list_p, '-');
    for rec_w in (select a.nr_registro as cd_profile, b.cd_registro nm_proxy from  table(lista_pck.obter_lista(profile_list_p,',')) a,
    table(lista_pck.obter_lista_char(proxy_list_w,',')) b)
    loop
        insert into perfil_delegacao(
                nr_sequencia,
                nm_usuario_nrec,
                nm_usuario,
                dt_atualizacao_nrec,
                dt_atualizacao,
                cd_cargo,
                cd_departamento,
                cd_perfil,
                cd_razao,
                ds_observacao,
				ie_situacao,
                dt_fim_delegacao,
                dt_inicio_delegacao,
                nm_proxy)
            values (nextval('perfil_delegacao_seq'),
                wheb_usuario_pck.get_nm_usuario,
                wheb_usuario_pck.get_nm_usuario,
                clock_timestamp(),
                clock_timestamp(),
                cd_cargo_p,
                cd_departamento_p,
                rec_w.cd_profile,
                cd_razao_p,
                ds_observacao_p,
				'A',
                dt_fim_delegacao_p,
                dt_inicio_delegacao_p,
                CASE WHEN rec_w.nm_proxy='-' THEN  null  ELSE rec_w.nm_proxy END
            );
    end loop;
    commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE add_multiple_deligation ( cd_cargo_p bigint, cd_departamento_p bigint, proxy_list_p text, profile_list_p text, dt_inicio_delegacao_p timestamp, dt_fim_delegacao_p timestamp, cd_razao_p bigint, ds_observacao_p text ) FROM PUBLIC;

