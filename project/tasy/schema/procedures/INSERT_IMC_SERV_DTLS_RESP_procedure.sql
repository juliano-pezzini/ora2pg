-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_imc_serv_dtls_resp ( nr_seq_transaction_p imc_response.cd_transaction%type, cd_service_p imc_service_response.cd_service%type, ds_service_exp_p imc_service_details.ds_service_exp%type, cd_service_exp_p imc_service_details.cd_service_exp%type, cd_exp_row_p imc_service_details.cd_exp_row%type, nm_usuario_p imc_service_details.nm_usuario%type) AS $body$
DECLARE


nr_seq_w		imc_service_details.nr_sequencia%type;
nr_seq_sevice_w	imc_service_response.nr_sequencia%type;


BEGIN

select	max(a.nr_sequencia)
into STRICT	nr_seq_sevice_w
from	imc_service_response a,
		imc_response b
where	a.cd_service = cd_service_p
and		a.nr_seq_response = b.nr_sequencia
and		b.cd_transaction = nr_seq_transaction_p;

select	nextval('imc_service_details_seq')
into STRICT	nr_seq_w
;

insert into imc_service_details(
									nr_sequencia,
									nm_usuario,
									dt_atualizacao,
									nr_seq_service,
									dt_atualizacao_nrec,
									ds_service_exp,
									cd_service_exp,
									cd_exp_row,
									nm_usuario_nrec)
						values (							
									nr_seq_w,
									nm_usuario_p,
									clock_timestamp(),
									nr_seq_sevice_w,
									clock_timestamp(),
									ds_service_exp_p,
									cd_service_exp_p,
									cd_exp_row_p,
									nm_usuario_p);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_imc_serv_dtls_resp ( nr_seq_transaction_p imc_response.cd_transaction%type, cd_service_p imc_service_response.cd_service%type, ds_service_exp_p imc_service_details.ds_service_exp%type, cd_service_exp_p imc_service_details.cd_service_exp%type, cd_exp_row_p imc_service_details.cd_exp_row%type, nm_usuario_p imc_service_details.nm_usuario%type) FROM PUBLIC;

