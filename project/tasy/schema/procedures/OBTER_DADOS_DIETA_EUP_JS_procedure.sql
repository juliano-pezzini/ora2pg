-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_dados_dieta_eup_js ( ie_exibe_dieta_categ_conv_p text, nr_seq_regra_acomp_p bigint, ie_lib_dieta_p text, qt_dieta_acomp_p bigint, nr_acompanhante_p bigint, ie_atualiza_dieta_nenhuma_p text, ie_gera_qt_acomp_p text, ie_atualiza_dieta_p text, nr_atendimento_p bigint, cd_pessoa_fisica_p text, cd_plano_convenio_p text, cd_categoria_p text, cd_convenio_p bigint, nm_usuario_p text, nr_acompanhante_ret_p INOUT bigint, qt_dieta_acomp_ret_p INOUT bigint, ie_lib_dieta_ret_p INOUT text, nr_seq_regra_acomp_ret_p INOUT bigint, ds_msg_dieta_p INOUT text) AS $body$
DECLARE

 
nr_acompanhante_w		smallint;
qt_dieta_acomp_w		smallint;
ie_lib_dieta_w			varchar(15);
nr_seq_regra_acomp_w		bigint;
ds_dieta_w			varchar(255);

				 
					 

BEGIN 
 
SELECT * FROM Obter_Dados_Dieta_Categ_Conv(cd_convenio_p, cd_categoria_p, cd_plano_convenio_p, cd_pessoa_fisica_p, nr_acompanhante_w, qt_dieta_acomp_w, ie_lib_dieta_w, nr_seq_regra_acomp_w, nr_atendimento_p) INTO STRICT nr_acompanhante_w, qt_dieta_acomp_w, ie_lib_dieta_w, nr_seq_regra_acomp_w;
 
if (coalesce(nr_acompanhante_p,0) = 0) or (ie_atualiza_dieta_p = 'S') then 
	nr_acompanhante_ret_p := coalesce(nr_acompanhante_w,0);
end if;
	 
if (ie_gera_qt_acomp_p = 'S') then 
	if (coalesce(qt_dieta_acomp_p,0) = 0) or (ie_atualiza_dieta_p = 'S') then 
		qt_dieta_acomp_ret_p := coalesce(qt_dieta_acomp_w,0);
	end if;
elsif (ie_gera_qt_acomp_p = 'R') and 
	((coalesce(qt_dieta_acomp_w,0) > 0) or (ie_atualiza_dieta_p = 'S')) then 
	if	((coalesce(qt_dieta_acomp_p,0) = 0) or (ie_atualiza_dieta_p = 'S')) then 
		qt_dieta_acomp_ret_p := coalesce(qt_dieta_acomp_w,0);
	end if;
end if;
if	((coalesce(ie_lib_dieta_p::text, '') = '') or 
	(ie_atualiza_dieta_p = 'S' AND ie_atualiza_dieta_nenhuma_p = 'N') or 
	(ie_atualiza_dieta_nenhuma_p = 'S' AND ie_lib_dieta_p = 'N')) then 
	ie_lib_dieta_ret_p := ie_lib_dieta_w;
end if;
 
if	((coalesce(nr_seq_regra_acomp_p,0) = 0) or (ie_atualiza_dieta_p = 'S')) and (coalesce(nr_seq_regra_acomp_w,0) > 0) then 
	nr_seq_regra_acomp_ret_p := coalesce(nr_seq_regra_acomp_w,0);	
end if;
 
if (ie_exibe_dieta_categ_conv_p = 'S') then 
 
	ds_dieta_w := Obter_Valor_Dominio(1396, coalesce(ie_lib_dieta_ret_p,coalesce(ie_lib_dieta_p,'N')));
	ds_msg_dieta_p := substr(obter_texto_dic_objeto(297302, wheb_usuario_pck.get_nr_seq_idioma, 'DIETA='||ds_dieta_w),1,255);
end if;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_dados_dieta_eup_js ( ie_exibe_dieta_categ_conv_p text, nr_seq_regra_acomp_p bigint, ie_lib_dieta_p text, qt_dieta_acomp_p bigint, nr_acompanhante_p bigint, ie_atualiza_dieta_nenhuma_p text, ie_gera_qt_acomp_p text, ie_atualiza_dieta_p text, nr_atendimento_p bigint, cd_pessoa_fisica_p text, cd_plano_convenio_p text, cd_categoria_p text, cd_convenio_p bigint, nm_usuario_p text, nr_acompanhante_ret_p INOUT bigint, qt_dieta_acomp_ret_p INOUT bigint, ie_lib_dieta_ret_p INOUT text, nr_seq_regra_acomp_ret_p INOUT bigint, ds_msg_dieta_p INOUT text) FROM PUBLIC;

