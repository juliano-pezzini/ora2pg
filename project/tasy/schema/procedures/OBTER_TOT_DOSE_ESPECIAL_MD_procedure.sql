-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_tot_dose_especial_md ( qt_dose_especial_p INOUT bigint, ie_dose_esp_arrend_cima_p text, ie_tipo_regra_disp_p text, cd_funcao_origem_p bigint, qt_total_dispensar_p INOUT bigint, nr_ocorrencia_p bigint, ie_regra_p text ) AS $body$
BEGIN

  if (ie_regra_p	= 'S') and (trunc(qt_dose_especial_p,0) <> qt_dose_especial_p) then
         qt_dose_especial_p := trunc(qt_dose_especial_p,0) + 1;
  end if;

  if (ie_dose_esp_arrend_cima_p = 'S') then
    qt_dose_especial_p := ceil(qt_dose_especial_p);
  end if;

  if (ie_tipo_regra_disp_p <> 'H') then
    if (not (cd_funcao_origem_p = 2314 AND qt_total_dispensar_p = qt_dose_especial_p)) then
      qt_total_dispensar_p := coalesce(qt_total_dispensar_p,0) - coalesce(qt_dose_especial_p,0);
    end if;
  else
    qt_dose_especial_p := dividir_md(qt_total_dispensar_p, nr_ocorrencia_p);
  end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_tot_dose_especial_md ( qt_dose_especial_p INOUT bigint, ie_dose_esp_arrend_cima_p text, ie_tipo_regra_disp_p text, cd_funcao_origem_p bigint, qt_total_dispensar_p INOUT bigint, nr_ocorrencia_p bigint, ie_regra_p text ) FROM PUBLIC;

