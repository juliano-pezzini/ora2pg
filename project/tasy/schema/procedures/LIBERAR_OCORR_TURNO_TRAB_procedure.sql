-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE liberar_ocorr_turno_trab (nr_sequencia_p bigint) AS $body$
DECLARE

 
nr_ocorrencia_w		bigint;
ds_ocorrencia_w		varchar(32000);
ie_tipo_ocorrencia_w	varchar(2);
cd_setor_atendimento_w	bigint;
cd_pessoa_fisica_w	varchar(15);
ds_resultado_w		varchar(2);
nm_usuario_w		varchar(15);

BEGIN
 
if (nr_sequencia_p > 0) then 
	 
	update	ocorrencia 
	set	dt_liberacao	= clock_timestamp(), 
	  nm_usuario   = wheb_usuario_pck.get_nm_usuario 
	where	nr_ocorrencia  = nr_sequencia_p;
	 
	commit;
end if;
select	cd_setor_atendimento, 
	nr_ocorrencia, 
	ie_tipo_ocorrencia, 
	cd_pessoa_fisica, 
	nm_usuario 
into STRICT	cd_setor_atendimento_w, 
	nr_ocorrencia_w, 
	ie_tipo_ocorrencia_w, 
	cd_pessoa_fisica_w, 
	nm_usuario_w 
from	ocorrencia 
where	nr_ocorrencia = nr_sequencia_p;
 
ds_resultado_w := Obter_valor_Param_Usuario(932,9,obter_perfil_ativo,nm_usuario_w,wheb_usuario_pck.get_cd_estabelecimento);	
if (ds_resultado_w = 'S') and (cd_setor_atendimento_w IS NOT NULL AND cd_setor_atendimento_w::text <> '') then 
	CALL Enviar_Comunic_Interna_Ocorre(cd_pessoa_fisica_w,nr_ocorrencia_w,ds_ocorrencia_w,ie_tipo_ocorrencia_w, cd_setor_atendimento_w);
end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE liberar_ocorr_turno_trab (nr_sequencia_p bigint) FROM PUBLIC;

