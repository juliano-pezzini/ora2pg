-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_evento_atualizar_autor ( nr_sequencia_p bigint, ie_evento_p text, nm_usuario_p text) AS $body$
DECLARE


ds_mensagem_w			varchar(4000);
ds_titulo_w			varchar(100);
nr_seq_evento_w			bigint;
ds_remetente_sms_w		varchar(80);
ds_remetente_email_w		varchar(100);
nr_sequencia_w			bigint;
ds_maquina_w			varchar(80);
cd_medico_cirurgiao_agenda_w	varchar(10);
cd_anestesista_agenda_w		varchar(10);
cd_pessoa_fisica_agenda_w		varchar(10);
cd_pessoa_fisica_resp_w	varchar(10);
ds_status_agenda_w		varchar(150);
nm_paciente_w			varchar(60);
cd_pessoa_regra_w		varchar(10);
ds_pac_abreviado_w		varchar(60);
ds_quarto_w			varchar(100);
ds_setor_origem_w			varchar(100);
nr_atendimento_w			bigint;
ds_ramal				varchar(30);
ds_agenda_w			varchar(50);
hr_inicio_w			timestamp;
cd_proced_agenda_w		bigint;
dt_cancelamento_w		timestamp;
cd_cid_w				varchar(10);
ds_doenca_cid_w			varchar(240);
ds_reserva_w			varchar(20);
nr_telefone_w			varchar(15);
ds_ramal_w			varchar(50);
cd_medico_autor_w		varchar(10);
qt_corresp_w			bigint := 0;
dt_inicio_vigencia_w		timestamp;
dt_fim_vigencia_w		timestamp;
cd_proced_autor_w		bigint;
ds_proced_autor_w		varchar(255);
ds_exame_autor_w		varchar(4000);
cd_estab_autor_w		integer;
ie_tipo_guia_w			varchar(2);
ds_convenio_w			varchar(255);
nr_seq_agenda_w			bigint;
nr_seq_agenda_consulta_w	bigint;
nr_seq_age_integ_w		bigint;
ie_tipo_autorizacao_w		varchar(2);
nr_seq_estagio_w		bigint;
ds_tipo_guia_autor_w		varchar(255);
ds_estagio_autor_w		varchar(255);
cd_senha_w			varchar(20);
ds_mensagem_mat_w		varchar(4000);
cd_setor_atend_w		bigint;
CD_CONVENIO_W			bigint;
cd_pessoa_fisica_w		varchar(10);
cd_usuario_convenio_w		varchar(255);
nr_prescricao_w			autorizacao_convenio.nr_prescricao%type;

cd_material_w			bigint;
ds_material_W			varchar(255);
qt_solicitada_w			double precision;
qt_autorizada_w			double precision;
cd_cgc_fabricante_w		varchar(14);
nm_usuario_destino_w 		varchar(15);

--Campos Da tabela ev_evento_regra_dest
ie_forma_ev_w			varchar(15);
ie_pessoa_destino_w		varchar(15);
cd_pf_destino_w			varchar(10);
ie_usuario_aceite_w		varchar(3);
cd_setor_atendimento_w		integer;
cd_perfil_w			integer;
ds_email_fixo_w			ev_evento_regra_dest.ds_email_fixo%type;
nm_usuario_destino_c02_w	ev_evento_regra_dest.nm_usuario_destino%type;
ie_excecao_alerta_pessoa_w	varchar(1);
ie_tipo_atendimento_w		atendimento_paciente.ie_tipo_atendimento%type;

C01 CURSOR FOR
	SELECT	a.nr_seq_evento
	FROM regra_envio_sms a
LEFT OUTER JOIN regra_envio_sms_atend b ON (a.nr_sequencia = b.nr_seq_regra)
WHERE a.ie_evento_disp = ie_evento_p and coalesce(a.nr_seq_estagio_autor,nr_seq_estagio_w) = nr_seq_estagio_w and coalesce(a.ie_tipo_autorizacao,ie_tipo_autorizacao_w) = ie_tipo_autorizacao_w and coalesce(obter_se_mat_autorizacao_sms(a.nr_sequencia,nr_sequencia_p),'S') = 'S' and a.cd_estabelecimento = cd_estab_autor_w and coalesce(a.ie_tipo_guia,ie_tipo_guia_w) = ie_tipo_guia_w and coalesce(a.ie_situacao,'A') = 'A' and coalesce(b.ie_tipo_atendimento, coalesce(ie_tipo_atendimento_w,0)) = coalesce(ie_tipo_atendimento_w,0) order by 1;

C02 CURSOR FOR
	SELECT	ie_forma_ev,
		ie_pessoa_destino,
		cd_pf_destino,
		coalesce(ie_usuario_aceite,'N'),
		cd_setor_atendimento,
		cd_perfil,
		ds_email_fixo,
		nm_usuario_destino
	from	ev_evento_regra_dest
	where	nr_seq_evento	= nr_seq_evento_w
	and	coalesce(cd_convenio, coalesce(cd_convenio_w,0))	= coalesce(cd_convenio_w,0)
	and	coalesce(cd_setor_atend_pac, coalesce(cd_setor_atend_w,0))	= coalesce(cd_setor_atend_w,0)	
	order by ie_forma_ev;
	
C03 CURSOR FOR
	SELECT	cd_procedimento,
		substr(obter_desc_procedimento(cd_procedimento,ie_origem_proced),1,255)
	from	procedimento_autorizado
	where	nr_sequencia_autor = nr_sequencia_p
	and	qt_autorizada > 0
	order by nr_sequencia;
	
C04 CURSOR FOR
	SELECT	cd_material,
		substr(obter_desc_material(cd_material),1,200),
		coalesce(qt_solicitada,0),
		coalesce(qt_autorizada,0),
		cd_cgc_fabricante
	from	material_autorizado
	where	nr_sequencia_autor = nr_sequencia_p;

	
C05 CURSOR FOR
	SELECT	obter_dados_usuario_opcao(nm_usuario,'C')
	from	usuario_setor_v
	where	cd_setor_atendimento = cd_setor_atendimento_w
	and	ie_forma_ev_w in (2,3)
	and	(obter_dados_usuario_opcao(nm_usuario,'C') IS NOT NULL AND (obter_dados_usuario_opcao(nm_usuario,'C'))::text <> '');

C06 CURSOR FOR
	SELECT	obter_dados_usuario_opcao(nm_usuario,'C'),
		nm_usuario
	from	usuario_perfil
	where	cd_perfil = cd_perfil_w
	and	ie_forma_ev_w in (2,3)
	and	(obter_dados_usuario_opcao(nm_usuario,'C') IS NOT NULL AND (obter_dados_usuario_opcao(nm_usuario,'C'))::text <> '');	


BEGIN

select	substr(obter_nome_setor(a.cd_setor_origem),1,80),
	a.dt_inicio_vigencia,
	a.dt_fim_vigencia,
	coalesce(a.cd_estabelecimento,Obter_dados_autor_convenio(a.nr_sequencia,'E')),
	coalesce(a.ie_tipo_guia,'X'),
	substr(obter_nome_convenio(a.cd_convenio),1,255),
	a.nr_seq_agenda,
	a.nr_seq_agenda_consulta,
	a.nr_seq_age_integ,
	a.nr_seq_estagio,
	a.ie_tipo_autorizacao,
	a.cd_medico_solicitante,
	a.cd_pessoa_fisica,
	substr(obter_nome_pf(a.cd_pessoa_fisica),1,60),
	a.nr_atendimento,
	substr(obter_nome_setor(a.cd_setor_origem),1,80),
	b.ds_estagio,
	substr(obter_valor_dominio(1031,a.ie_tipo_guia),1,255),
	a.cd_senha,
	substr(obter_dados_autor_convenio(a.nr_sequencia,'CU'),1,255),
	a.cd_convenio,
	a.nr_prescricao
into STRICT	ds_setor_origem_w,
	dt_inicio_vigencia_w,
	dt_fim_vigencia_w,
	cd_estab_autor_w,
	ie_tipo_guia_w,
	ds_convenio_w,
	nr_seq_agenda_w,
	nr_seq_agenda_consulta_w,
	nr_seq_age_integ_w,
	nr_seq_estagio_w,
	ie_tipo_autorizacao_w,
	cd_medico_autor_w,
	cd_pessoa_fisica_agenda_w,
	nm_paciente_w,
	nr_atendimento_w,
	ds_setor_origem_w,
	ds_estagio_autor_w,
	ds_tipo_guia_autor_w,
	cd_senha_w,
	cd_usuario_convenio_w,
	cd_convenio_w,
	nr_prescricao_w
FROM autorizacao_convenio a
LEFT OUTER JOIN estagio_autorizacao b ON (a.nr_seq_estagio = b.nr_sequencia)
WHERE a.nr_sequencia = nr_sequencia_p;

select	max(ie_tipo_atendimento)
into STRICT	ie_tipo_atendimento_w
from	atendimento_paciente
where	nr_atendimento = nr_atendimento_w;

if (nr_seq_agenda_w IS NOT NULL AND nr_seq_agenda_w::text <> '') then

	begin
	select	a.cd_medico,
		a.cd_anestesista,
		a.cd_pessoa_fisica,
		substr(obter_valor_dominio(83,a.ie_status_agenda),1,150),
		substr(obter_nome_pf(a.cd_pessoa_fisica),1,60),
		b.ds_agenda,
		a.hr_inicio,
		a.cd_procedimento,
		a.dt_cancelamento,
		a.cd_doenca_cid,
		substr(obter_desc_cid_doenca(a.cd_doenca_cid),1,240),
		a.nr_reserva,
		a.ie_tipo_atendimento
	into STRICT	cd_medico_cirurgiao_agenda_w,
		cd_anestesista_agenda_w,
		cd_pessoa_fisica_agenda_w,
		ds_status_agenda_w,
		nm_paciente_w,
		ds_agenda_w,
		hr_inicio_w,
		cd_proced_agenda_w,
		dt_cancelamento_w,
		cd_cid_w,
		ds_doenca_cid_w,
		ds_reserva_w,
		ie_tipo_atendimento_w
	from	agenda_paciente a,
		agenda b
	where	a.cd_agenda = b.cd_agenda
	and	a.nr_sequencia = nr_seq_agenda_w;
	exception
	when others then
		cd_medico_cirurgiao_agenda_w 	:= null;
		cd_anestesista_agenda_w	:= null;
		cd_pessoa_fisica_agenda_w 	:= null;
		ds_status_agenda_w		:= null;
	end;
end if;

ds_quarto_w := substr(obter_unidade_atendimento(nr_atendimento_w,'A','U'),1,60);

if (cd_pessoa_fisica_w IS NOT NULL AND cd_pessoa_fisica_w::text <> '') or (cd_pessoa_fisica_agenda_w IS NOT NULL AND cd_pessoa_fisica_agenda_w::text <> '')then
	begin
	ds_ramal_w		:= substr(obter_compl_pf(coalesce(cd_pessoa_fisica_w,cd_pessoa_fisica_agenda_w),1,'RAM'),1,30);
	ds_pac_abreviado_w 	:= substr(abrevia_nome(obter_nome_pf(coalesce(cd_pessoa_fisica_w,cd_pessoa_fisica_agenda_w)),'T'),1,60);
	nr_telefone_w		:= substr(obter_compl_pf(coalesce(cd_pessoa_fisica_w,cd_pessoa_fisica_agenda_w),1,'T'),1,30);
	end;
end if;

open C01;
loop
fetch C01 into
	nr_seq_evento_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin	
			
	if (coalesce(nr_seq_evento_w,0) <> 0) then
		
		select	ds_titulo,
			ds_mensagem,
			ds_remetente_sms,
			ds_remetente_email
		into STRICT	ds_titulo_w,
			ds_mensagem_w,
			ds_remetente_sms_w,
			ds_remetente_email_w
		from	ev_evento
		where	nr_sequencia	= nr_seq_evento_w;

		select	substr(obter_inf_sessao(0),1,80)
		into STRICT	ds_maquina_w
		;
		
		open C03;
		loop
		fetch C03 into	
			cd_proced_autor_w,
			ds_proced_autor_w;
		EXIT WHEN NOT FOUND; /* apply on C03 */
			begin
			ds_exame_autor_w := ds_exame_autor_w || cd_proced_autor_w || ' - ' || ds_proced_autor_w || chr(13)||chr(10);
			end;
		end loop;
		close C03;
		
		open C04;
		loop
		fetch C04 into	
			cd_material_w,
			ds_material_w,
			qt_solicitada_w,
			qt_autorizada_w,
			cd_cgc_fabricante_w;
		EXIT WHEN NOT FOUND; /* apply on C04 */
			begin
			ds_mensagem_mat_w := substr(ds_mensagem_mat_w || ' '|| cd_material_w || ' ' || ds_material_w || ' ' || qt_solicitada_w || ' ' || qt_autorizada_w || ' ' || cd_cgc_fabricante_w || chr(13)||chr(10),1,3990);
			end;
		end loop;
		close C04;
		
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@paciente',nm_paciente_w),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@medicoagenda',substr(obter_nome_pf(cd_medico_cirurgiao_agenda_w),1,60)),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@statusagenda',ds_status_agenda_w),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@pac_abreviado',ds_pac_abreviado_w),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@ds_quarto',ds_quarto_w),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@setor',ds_setor_origem_w),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@ds_ramal',ds_ramal_w),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@telefone',nr_telefone_w),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@agenda',ds_agenda_w),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@dtinicioagenda',PKG_DATE_FORMATERS.TO_VARCHAR(hr_inicio_w, 'timestamp', WHEB_USUARIO_PCK.GET_CD_ESTABELECIMENTO, nm_usuario_p)),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@procagenda',cd_proced_agenda_w),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@dtcancelagenda',dt_cancelamento_w),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@data_atual',clock_timestamp()),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@data_hora_atual',PKG_DATE_FORMATERS.TO_VARCHAR(clock_timestamp(), 'timestamp', WHEB_USUARIO_PCK.GET_CD_ESTABELECIMENTO, nm_usuario_p)),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@cd_cid',cd_cid_w),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@ds_cid',ds_doenca_cid_w),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@reserva',ds_reserva_w),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@ds_exame_autor',ds_exame_autor_w),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@inicio_vigencia_autor',PKG_DATE_FORMATERS.TO_VARCHAR(dt_inicio_vigencia_w, 'shortDate', WHEB_USUARIO_PCK.GET_CD_ESTABELECIMENTO, nm_usuario_p)),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@fim_vigencia_autor',PKG_DATE_FORMATERS.TO_VARCHAR(dt_fim_vigencia_w, 'shortDate', WHEB_USUARIO_PCK.GET_CD_ESTABELECIMENTO, nm_usuario_p)),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@convenio',ds_convenio_w),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@sequencia_autor',nr_sequencia_p),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@ds_estagio_autor',ds_estagio_autor_w),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@nr_atend_autor',nr_atendimento_w),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@tipo_guia_autor',ds_tipo_guia_autor_w),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@senha_autor',cd_senha_w),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@conteudo_mat_autor',ds_mensagem_mat_w),1,4000);
		ds_mensagem_w	:= substr(replace_macro(ds_mensagem_w,'@ds_usuario_conv_autor',cd_usuario_convenio_w),1,4000);
		ds_mensagem_w 	:= substr(replace_macro(ds_mensagem_w,'@prescricao', nr_prescricao_w), 1, 4000);
		
		
		select	nextval('ev_evento_paciente_seq')
		into STRICT	nr_sequencia_w
		;

		insert into ev_evento_paciente(
			nr_sequencia,
			nr_seq_evento,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			cd_pessoa_fisica,
			ds_titulo,
			ds_mensagem,
			ie_status,
			ds_maquina,
			dt_evento,
			dt_liberacao)
		values (	nr_sequencia_w,
			nr_seq_evento_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			coalesce(cd_pessoa_fisica_w,cd_pessoa_fisica_agenda_w),
			ds_titulo_w,
			ds_mensagem_w,
			'G',
			ds_maquina_w,
			clock_timestamp(),
			clock_timestamp());				
		
		
		
		open C02;
		loop
		fetch C02 into
			ie_forma_ev_w,
			ie_pessoa_destino_w,
			cd_pf_destino_w,
			ie_usuario_aceite_w,
			cd_setor_atendimento_w,
			cd_perfil_w,
			ds_email_fixo_w,
			nm_usuario_destino_c02_w;
		EXIT WHEN NOT FOUND; /* apply on C02 */
			begin								
			
			if (ie_pessoa_destino_w = 1) then --Medico do atendimento
				cd_pessoa_regra_w  := cd_medico_autor_w;
			elsif (ie_pessoa_destino_w = 18) then --  Cirurg Ag cirurgica
				cd_pessoa_regra_w := cd_medico_cirurgiao_agenda_w;
			elsif (ie_pessoa_destino_w = 19) then -- Paciente
				cd_pessoa_regra_w := coalesce(cd_pessoa_fisica_w,cd_pessoa_fisica_agenda_w);
			elsif (ie_pessoa_destino_w = 20) then -- Anest Ag Cirurgica
				cd_pessoa_regra_w := cd_anestesista_agenda_w;
			elsif (ie_pessoa_destino_w = 23) then -- Pessoa responsavel pelo paciente no atendimento			
				
				begin
				select 	ap.cd_pessoa_responsavel
				into STRICT 	cd_pessoa_fisica_resp_w
				from	atendimento_paciente ap
				where 	ap.nr_atendimento = nr_atendimento_w;
				exception
				when others then
					cd_pessoa_fisica_resp_w := null;
				end;							
				
				cd_pessoa_regra_w := cd_pessoa_fisica_resp_w;								
				
			else
				cd_pessoa_regra_w:= cd_pf_destino_w;
			end if;					

			if (ie_usuario_aceite_w = 'S') then
				select	count(*)
				into STRICT	qt_corresp_w
				from	pessoa_fisica_corresp
				where	cd_pessoa_fisica	= cd_pessoa_regra_w
				and	ie_tipo_corresp		= CASE WHEN ie_forma_ev_w='1' THEN 'MCel' WHEN ie_forma_ev_w='3' THEN 'CI' WHEN ie_forma_ev_w='4' THEN 'Email' END
				and	ie_tipo_doc		= 'AE';
			end if;
			
			if (qt_corresp_w = 0) and (ie_usuario_aceite_w = 'S')then
				begin
				cd_pessoa_regra_w := null;
				end;
			end if;
			
			if 	((cd_pessoa_regra_w IS NOT NULL AND cd_pessoa_regra_w::text <> '') or (ds_email_fixo_w IS NOT NULL AND ds_email_fixo_w::text <> '')) then
				
				ie_excecao_alerta_pessoa_w := obter_excecao_alerta(nr_seq_evento_w, cd_pessoa_regra_w, ie_forma_ev_w);
				
				if (coalesce(ie_excecao_alerta_pessoa_w,'N') = 'N') then
					insert into ev_evento_pac_destino(
						nr_sequencia,
						nr_seq_ev_pac,
						dt_atualizacao,
						nm_usuario,
						dt_atualizacao_nrec,
						nm_usuario_nrec,
						cd_pessoa_fisica,
						ie_forma_ev,
						ie_status,
						dt_ciencia,
						ie_pessoa_destino,
						dt_evento,
						ds_email_fixo,
						nm_usuario_dest)
					values (	nextval('ev_evento_pac_destino_seq'),
						nr_sequencia_w,
						clock_timestamp(),
						nm_usuario_p,
						clock_timestamp(),
						nm_usuario_p,
						cd_pessoa_regra_w,
						ie_forma_ev_w,
						'G',
						null,
						ie_pessoa_destino_w,
						clock_timestamp(),
						ds_email_fixo_w,
						nm_usuario_destino_c02_w);
				end if;		
			end if;
			
			open C05;
			loop
			fetch C05 into
				cd_pessoa_regra_w;
			EXIT WHEN NOT FOUND; /* apply on C05 */
				begin
				if (cd_pessoa_regra_w IS NOT NULL AND cd_pessoa_regra_w::text <> '') then
					ie_excecao_alerta_pessoa_w := obter_excecao_alerta(nr_seq_evento_w, cd_pessoa_regra_w, ie_forma_ev_w);
					if (coalesce(ie_excecao_alerta_pessoa_w,'N') = 'N') then
						insert into ev_evento_pac_destino(
							nr_sequencia,
							nr_seq_ev_pac,
							dt_atualizacao,
							nm_usuario,
							dt_atualizacao_nrec,
							nm_usuario_nrec,
							cd_pessoa_fisica,
							ie_forma_ev,
							ie_status,
							dt_ciencia,
							ie_pessoa_destino,
							dt_evento)
						values (	nextval('ev_evento_pac_destino_seq'),
							nr_sequencia_w,
							clock_timestamp(),
							nm_usuario_p,
							clock_timestamp(),
							nm_usuario_p,
							cd_pessoa_regra_w,
							ie_forma_ev_w,
							'G',
							null,
							ie_pessoa_destino_w,
							clock_timestamp());
					end if;		
				end if;
				end;
			end loop;
			close C05;

			open C06;
			loop
			fetch C06 into
				cd_pessoa_regra_w,
				nm_usuario_destino_w;
			EXIT WHEN NOT FOUND; /* apply on C06 */
				begin

				if (cd_pessoa_regra_w IS NOT NULL AND cd_pessoa_regra_w::text <> '') then
					ie_excecao_alerta_pessoa_w := obter_excecao_alerta(nr_seq_evento_w, cd_pessoa_regra_w, ie_forma_ev_w);
					if (coalesce(ie_excecao_alerta_pessoa_w,'N') = 'N') then
						insert into ev_evento_pac_destino(
							nr_sequencia,
							nr_seq_ev_pac,
							dt_atualizacao,
							nm_usuario,
							dt_atualizacao_nrec,
							nm_usuario_nrec,
							cd_pessoa_fisica,
							ie_forma_ev,
							ie_status,
							dt_ciencia,
							nm_usuario_dest,
							ie_pessoa_destino,
							dt_evento)
						values (	nextval('ev_evento_pac_destino_seq'),
							nr_sequencia_w,
							clock_timestamp(),
							nm_usuario_p,
							clock_timestamp(),
							nm_usuario_p,
							cd_pessoa_regra_w,
							ie_forma_ev_w,
							'G',
							null,
							nm_usuario_Destino_w,
							ie_pessoa_destino_w,
							clock_timestamp());
					end if;		
				end if;
				end;
			end loop;
			close C06;
			
			
			end;
		end loop;
		close C02;

	end if;
	end;
end loop;
close C01;

--if (nvl(wheb_usuario_pck.get_ie_commit, 'S') = 'S') then commit; end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_evento_atualizar_autor ( nr_sequencia_p bigint, ie_evento_p text, nm_usuario_p text) FROM PUBLIC;

