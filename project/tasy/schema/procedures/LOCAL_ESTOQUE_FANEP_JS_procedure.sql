-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE local_estoque_fanep_js ( nm_maquina_atual_p text, cd_setor_atendimento_p text, cd_perfil_usuario_p text, ds_texto_msg_p INOUT text, qt_local_computador_p INOUT bigint, nr_local_estoque_p INOUT bigint) AS $body$
DECLARE


qt_local_computador_w 	integer;
ds_texto_msg_w 		varchar(4000);
nr_local_estoque_w 	bigint;


BEGIN

	if (cd_perfil_usuario_p IS NOT NULL AND cd_perfil_usuario_p::text <> '') then
		begin

			if (cd_perfil_usuario_p = 'C') then
				begin

					select 	count(*)
					into STRICT 	qt_local_computador_w
					from   	local_estoque_computador b,
						computador a
					where  	a.nr_sequencia  = b.nr_seq_computador
					and    	a.nm_computador_pesquisa  =  padronizar_nome(upper(nm_maquina_atual_p));

					if (qt_local_computador_w = 0) then
						begin

							ds_texto_msg_w 	:=	obter_texto_tasy(83362, 1);
							ds_texto_msg_p	:= 	ds_texto_msg_w;

						end;
					else
						begin

							select	coalesce(max(b.cd_local_estoque), 0)
							into STRICT	nr_local_estoque_w
							from   	local_estoque_computador b,
								computador a
							where  	a.nr_sequencia  = b.nr_seq_computador
							and    	a.nm_computador_pesquisa  = padronizar_nome(upper(nm_maquina_atual_p));

						end;
					end if;
				end;
			else
				begin

					select 	cd_local_estoque
					into STRICT	nr_local_estoque_w
					from 	setor_atendimento
					where  	cd_setor_atendimento = cd_setor_atendimento_p;

				end;
			end if;

			nr_local_estoque_p	:=	nr_local_estoque_w;
			qt_local_computador_p	:=	qt_local_computador_w;

		end;
	end if;
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE local_estoque_fanep_js ( nm_maquina_atual_p text, cd_setor_atendimento_p text, cd_perfil_usuario_p text, ds_texto_msg_p INOUT text, qt_local_computador_p INOUT bigint, nr_local_estoque_p INOUT bigint) FROM PUBLIC;

