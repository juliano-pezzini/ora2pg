-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_patient_query ( ds_data_found_p text default null, ds_patient_provider_p text default null, ds_patient_name_given_p text default null, --given
 ds_patient_name_family_p text default null, --family,
 ds_patient_ids_issuername_p text default null, --emissor
 ds_patient_ids_issuercode_p text default null, --cnpj
 ds_patient_ids_id_p text default null, ds_patient_status_p text default null, --status
 ds_user_id_p text default null, --id	
 ds_issuer_p text default null, --issuerId	
 ds_original_message_p text default null, ds_identifiers_id_p text default null, ds_gender_p text default null, --gender	
 ds_gendertext_p text default null, ds_birthdate_p text default null, --birthTime				
 ds_address_country_p text default null, ds_address_city_p text default null, --city			
 ds_address_street_p text default null, --streetAddressLine			
 ds_address_postalcode_p text default null, --postalCode
 ds_original_query_p text default null, dt_last_date_p text default null, ds_patient_cpf_p text default null, --extensionCpf
 ds_patient_cns_p text default null) AS $body$
DECLARE
 is  --extensionCns
					
nm_usuario_w			varchar(15);
dt_birthdate_w			timestamp;		
dt_datafound_w			timestamp;	
ds_sexo_descritivo_w	varchar(10);	
ds_status_paciente_w	varchar(15);


BEGIN

	

if (ds_data_found_p IS NOT NULL AND ds_data_found_p::text <> '') then

	nm_usuario_w := wheb_usuario_pck.get_nm_usuario;
	
	dt_datafound_w := to_date(ds_data_found_p, 'yyyymmddhh24miss');

	if (ds_birthdate_p IS NOT NULL AND ds_birthdate_p::text <> '') then
	
		dt_birthdate_w := to_date(ds_birthdate_p, 'yyyymmdd');
		
	end if;
	
	if (ds_gender_p IS NOT NULL AND ds_gender_p::text <> '') then
	
		if ( ds_gender_p = 'M') then
		
			ds_sexo_descritivo_w := obter_desc_expressao(292932,null);
			
		end if;
		
		if ( ds_gender_p = 'F') then
		
			ds_sexo_descritivo_w := obter_desc_expressao(290058,null);
		
		end if;
	
	end if;
	
	if (ds_patient_status_p IS NOT NULL AND ds_patient_status_p::text <> '') then
	
		if ( ds_patient_status_p = 'active') then
		
			ds_status_paciente_w := obter_desc_expressao(787005,null);
			
		end if;
		
		if ( ds_patient_status_p = 'inactive') then
		
			ds_status_paciente_w := obter_desc_expressao(831342,null);
			
		end if;
	
	end if;


	insert into patient_query( ds_patient_provider,
									   ds_patient_name_given,
									   ds_patient_name_family,
									   ds_patient_ids_issuername,
									   ds_patient_ids_issuercode,
									   ds_patient_ids_id,
									   ds_patient_status,
									   ds_user_id,
									   ds_issuer,
									   dt_atualizacao,
									   dt_atualizacao_nrec,
									   nm_usuario,
									   nm_usuario_nrec,
									   nr_sequencia,
									   ds_identifiers_id,
									   ds_identifiers_issuerid,
									   ds_gender,								
									   ds_gendertext,						
									   dt_birthdate,						
									   ds_address_country,		
									   ds_address_city,				
									   ds_address_street,				
									   ds_address_postalcode,
									   ie_tipo,
									   ds_original_message,
									   ds_original_query,
									   dt_last_date,
									   ds_patient_cpf,
									   ds_patient_cns)
									   values (ds_patient_provider_p,
									   ds_patient_name_given_p,
									   ds_patient_name_family_p,
									   ds_patient_ids_issuername_p,
									   ds_patient_ids_issuercode_p,
									   ds_patient_ids_id_p,
									   ds_status_paciente_w,
									   ds_user_id_p,
									   ds_issuer_p,
									   clock_timestamp(),
									   clock_timestamp(),
									   nm_usuario_w,
									   nm_usuario_w,
									   nextval('patient_query_seq'),
									   ds_identifiers_id_p,
									   ds_issuer_p,
									   ds_gender_p,								
									   ds_sexo_descritivo_w,						
									   dt_birthdate_w,						
									   ds_address_country_p,		
									   ds_address_city_p,				
									   ds_address_street_p,				
									   ds_address_postalcode_p,
									   1,
									   ds_original_message_p,
									   ds_original_query_p,
									   dt_datafound_w,
									   ds_patient_cpf_p,
									   ds_patient_cns_p);

	Commit;
	
end if;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_patient_query ( ds_data_found_p text default null, ds_patient_provider_p text default null, ds_patient_name_given_p text default null, ds_patient_name_family_p text default null, ds_patient_ids_issuername_p text default null, ds_patient_ids_issuercode_p text default null, ds_patient_ids_id_p text default null, ds_patient_status_p text default null, ds_user_id_p text default null, ds_issuer_p text default null, ds_original_message_p text default null, ds_identifiers_id_p text default null, ds_gender_p text default null, ds_gendertext_p text default null, ds_birthdate_p text default null, ds_address_country_p text default null, ds_address_city_p text default null, ds_address_street_p text default null, ds_address_postalcode_p text default null, ds_original_query_p text default null, dt_last_date_p text default null, ds_patient_cpf_p text default null, ds_patient_cns_p text default null) FROM PUBLIC;

