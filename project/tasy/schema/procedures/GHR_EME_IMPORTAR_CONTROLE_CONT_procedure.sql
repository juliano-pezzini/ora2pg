-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ghr_eme_importar_controle_cont () AS $body$
BEGIN

insert into eme_contrato(
			nr_sequencia,
			cd_estabelecimento,
			cd_contrato,
			nr_seq_cobertura,
			dt_atualizacao,
			nm_usuario,
			dt_contrato,
			nr_seq_regra_preco,
			qt_dia_vencimento,
			ie_reajuste,
			cd_cgc,
			cd_pessoa_fisica)
	SELECT	nextval('eme_contrato_seq'),
		a.cd_estabelecimento,
		(SELECT max(cd_contrato) from eme_contrato)+rownum,
		(select max(nr_sequencia) from eme_tipo_cobertura),
		clock_timestamp(),
		'Importacao CC' nm_usuario,
		clock_timestamp(),
		(select max(x.nr_sequencia) from eme_regra_preco x where ((x.cd_estabelecimento = a.cd_estabelecimento) or (coalesce(x.cd_estabelecimento::text, '') = ''))),
		coalesce(a.qt_dias_aviso_venc,0),
		'M',
		a.cd_cgc_contratado,
		a.cd_pessoa_contratada
	from	contrato a;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ghr_eme_importar_controle_cont () FROM PUBLIC;

