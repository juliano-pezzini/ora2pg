-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE eis_ajustar_indicadores_atrib ( nr_seq_ind_gestao_p bigint ) AS $body$
DECLARE


nr_sequencia_sup_w	bigint;
nr_seq_ind_gestao_sup_w	bigint;
nm_atributo_sup_w	varchar(85);
ds_dimensao_sup_w	varchar(100);
ds_informacao_sup_w	varchar(100);
ds_data_sup_w		varchar(100);

nr_sequencia_w		bigint;
nr_seq_ind_gestao_w	bigint;
nm_atributo_w		varchar(85);
ds_dimensao_w		varchar(100);
ds_informacao_w		varchar(100);
ds_data_w		varchar(100);

ds_indicador_w		varchar(100);
qt 			bigint := 0;

c01 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.nr_seq_ind_gestao,
		a.nm_atributo,
		a.ds_dimensao,
		a.ds_informacao,
		a.ds_data
	from	indicador_gestao_atrib a
	where	a.nr_seq_ind_gestao = nr_seq_ind_gestao_p
	order by nr_seq_ind_gestao,nm_atributo,ds_dimensao,ds_informacao,ds_data,1;


BEGIN

open c01;
loop
fetch c01 into	nr_sequencia_w,
		nr_seq_ind_gestao_w,
		nm_atributo_w,
		ds_dimensao_w,
		ds_informacao_w,
		ds_data_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin

	if (nr_seq_ind_gestao_sup_w = nr_seq_ind_gestao_w and
		 nm_atributo_sup_w = nm_atributo_w and (ds_dimensao_sup_w = ds_dimensao_w or
		  ds_informacao_sup_w = ds_informacao_w or
		  ds_data_sup_w = ds_data_w)) then

		delete from indicador_gestao_atrib
		where nr_sequencia = nr_sequencia_w;

	end if;

	nr_sequencia_sup_w := nr_sequencia_w;
	nr_seq_ind_gestao_sup_w := nr_seq_ind_gestao_w;
	nm_atributo_sup_w := nm_atributo_w;
	ds_dimensao_sup_w := ds_dimensao_w;
	ds_informacao_sup_w := ds_informacao_w;
	ds_data_sup_w := ds_data_w;

	end;
end loop;
close c01;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eis_ajustar_indicadores_atrib ( nr_seq_ind_gestao_p bigint ) FROM PUBLIC;

