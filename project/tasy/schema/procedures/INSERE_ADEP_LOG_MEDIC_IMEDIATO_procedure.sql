-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insere_adep_log_medic_imediato (nr_seq_horario_p text, nm_usuario_p text) AS $body$
DECLARE

nr_sequencia_w	bigint;
cd_material_w	bigint;

c01 CURSOR FOR
SELECT distinct(a.cd_material) cd_material
from	prescr_mat_hor c,
		prescr_material b,
		material_armazenamento a
where	a.cd_material 		= b.cd_material
and		c.nr_prescricao 	= b.nr_prescricao
and		c.nr_seq_material 	= b.nr_sequencia
and		a.ie_tempo_estab 	= 'I'
and		c.nr_sequencia 	= nr_seq_horario_p;


BEGIN

open c01;
loop
fetch c01 into
	cd_material_w;
EXIT WHEN NOT FOUND; /* apply on c01 */

	select	nextval('adep_log_medic_imediato_seq')
	into STRICT	nr_sequencia_w
	;

	insert into adep_log_medic_imediato(nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_horario,
			cd_material)
	 values (nr_sequencia_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_horario_p,
			cd_material_w);

end loop;
close c01;
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insere_adep_log_medic_imediato (nr_seq_horario_p text, nm_usuario_p text) FROM PUBLIC;

