-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE intpd_inicializacao ( nr_seq_fila_p bigint) AS $body$
DECLARE


ds_locale_w			establishment_locale.ds_locale%type;
nr_seq_idioma_w			tasy_idioma.nr_sequencia%type;
cd_estabelecimento_w		estabelecimento.cd_estabelecimento%type;	
nr_seq_evento_sistema_w		intpd_fila_transmissao.nr_seq_evento_sistema%type;
nm_usuario_w			usuario.nm_usuario%type;


BEGIN
begin
select	a.nr_seq_evento_sistema,
	b.ds_locale,
	coalesce(a.nm_usuario_nrec,a.nm_usuario)
into STRICT	nr_seq_evento_sistema_w,
	ds_locale_w,
	nm_usuario_w
from	intpd_fila_transmissao a,
	intpd_eventos_sistema b
where	a.nr_seq_evento_sistema = b.nr_sequencia
and	a.nr_sequencia = nr_seq_fila_p;

if (coalesce(ds_locale_w::text, '') = '') then
	begin

	begin
	select	cd_estabelecimento
	into STRICT	cd_estabelecimento_w
	from	intpd_eventos_inf_receb
	where	nr_seq_evento_sistema = nr_seq_evento_sistema_w
	and	(cd_estabelecimento IS NOT NULL AND cd_estabelecimento::text <> '')  LIMIT 1;
	exception
	when others then
		select	min(cd_estabelecimento)
		into STRICT	cd_estabelecimento_w
		from	estabelecimento
		where	ie_situacao = 'A';
	end;
	
	select 	max(ds_locale)
	into STRICT	ds_locale_w
	from	establishment_locale
	where	cd_estabelecimento = cd_estabelecimento_w;
	end;
end if;

select	max(nr_sequencia)
into STRICT 	nr_seq_idioma_w	
from	tasy_idioma 
where	ds_language_tag = ds_locale_w;

exception
when others then
	nr_seq_idioma_w	:=	1;
end;

CALL pkg_i18n.set_user_locale(ds_locale_w);
CALL philips_param_pck.set_nr_seq_idioma(coalesce(nr_seq_idioma_w, 1));
CALL wheb_usuario_pck.set_cd_estabelecimento(cd_estabelecimento_w);
CALL ish_param_pck.set_nm_usuario(nm_usuario_w);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE intpd_inicializacao ( nr_seq_fila_p bigint) FROM PUBLIC;

