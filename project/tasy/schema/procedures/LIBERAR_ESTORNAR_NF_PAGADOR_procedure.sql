-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE liberar_estornar_nf_pagador ( nr_sequencia_p bigint, nm_usuario_p text) AS $body$
DECLARE


dt_liberacao_w		timestamp;
qt_registro_w		bigint;


BEGIN
select	dt_liberacao
into STRICT	dt_liberacao_w
from	conta_paciente_nf_pag
where	nr_sequencia = nr_sequencia_p;


if (dt_liberacao_w IS NOT NULL AND dt_liberacao_w::text <> '') then

	update	conta_paciente_nf_pag
	set	dt_liberacao	 = NULL,
		nm_usuario_lib	 = NULL
	where	nr_sequencia = nr_sequencia_p;
else
	select	count(*)
	into STRICT	qt_registro_w
	from	conta_paciente_nf_pag_item
	where	nr_seq_registro = nr_sequencia_p;

	if (qt_registro_w = 0) then

		CALL wheb_mensagem_pck.Exibir_Mensagem_Abort(232829);
	else
		update	conta_paciente_nf_pag
		set	dt_liberacao	= clock_timestamp(),
			nm_usuario_lib	= nm_usuario_p
		where	nr_sequencia = nr_sequencia_p;
	end if;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE liberar_estornar_nf_pagador ( nr_sequencia_p bigint, nm_usuario_p text) FROM PUBLIC;

