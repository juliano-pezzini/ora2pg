-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE sus_duplicar_fpo_bpa ( dt_competencia_origem_p timestamp, dt_competencia_destino_p timestamp, nm_usuario_p text) AS $body$
DECLARE

qt_fisico_w		bigint;
vl_orcamentario_w	double precision;
cd_procedimento_w	bigint;
ie_origem_proced_w	bigint;
cd_grupo_bpa_w		bigint;
cd_subgrupo_bpa_w	bigint;
c01 CURSOR FOR
	SELECT	qt_fisico,
		vl_orcamentario,
		cd_procedimento,
		ie_origem_proced,
		cd_grupo_bpa,
		cd_subgrupo_bpa
	from	sus_fpo_bpa
	where	trunc(dt_competencia)	= trunc(dt_competencia_origem_p);

BEGIN
OPEN C01;
	LOOP
	FETCH C01 into
	qt_fisico_w,
	vl_orcamentario_w,
	cd_procedimento_w,
	ie_origem_proced_w,
	cd_grupo_bpa_w,
	cd_subgrupo_bpa_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */
		begin
		insert into sus_fpo_bpa(
				nr_sequencia,
				dt_atualizacao,
				nm_usuario,
				dt_competencia,
				qt_fisico,
				vl_orcamentario,
				cd_procedimento,
				ie_origem_proced,
				cd_grupo_bpa,
				cd_subgrupo_bpa)
			values (nextval('sus_fpo_bpa_seq'),
				clock_timestamp(),
				nm_usuario_p,
				dt_competencia_destino_p,
				qt_fisico_w,
				vl_orcamentario_w,
				cd_procedimento_w,
				ie_origem_proced_w,
				cd_grupo_bpa_w,
				cd_subgrupo_bpa_w);
		exception
			when others then
				--r.aise_application_error(-20011,'Verifique a data de competÃªcia de origem.');
				CALL wheb_mensagem_pck.exibir_mensagem_abort(263441);

		end;
	end LOOP;
CLOSE C01;
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE sus_duplicar_fpo_bpa ( dt_competencia_origem_p timestamp, dt_competencia_destino_p timestamp, nm_usuario_p text) FROM PUBLIC;

