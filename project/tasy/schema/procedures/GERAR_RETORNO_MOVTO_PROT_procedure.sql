-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_retorno_movto_prot (nm_usuario_p text, nr_seq_retorno_p bigint, ds_mensagem_p INOUT text) AS $body$
DECLARE

 
nr_seq_protocolo_w	bigint;
vl_pago_w		double precision;
vl_total_pago_w		double precision;
ds_mensagem_w		varchar(4000);

c01 CURSOR FOR 
SELECT	(nr_protocolo)::numeric , 
	vl_total_pago 
from	convenio_retorno_movto 
where	nr_seq_retorno	= nr_seq_retorno_p 
and	(nr_protocolo IS NOT NULL AND nr_protocolo::text <> '');


BEGIN 
 
open C01;
loop 
fetch C01 into 
	nr_seq_protocolo_w, 
	vl_pago_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin 
 
	ds_mensagem_w := Gerar_Retorno_Protocolo(nr_seq_retorno_p, nr_seq_protocolo_w, null, 'N', 'N', 'N', null, nm_usuario_p, 'S', ds_mensagem_w);
 
	ds_mensagem_w	:= substr((ds_mensagem_w || ds_mensagem_w),1,3999);
 
	vl_total_pago_w	:= coalesce(vl_total_pago_w,0) + coalesce(vl_pago_w,0);
 
	end;
 
end loop;
close C01;
 
if (vl_total_pago_w > 0) then 
 
	CALL Glosar_retorno_proporcional(nr_seq_retorno_p, 
				vl_total_pago_w, 
				null, 
				nm_usuario_p, 
				1, 
				null, 
				'P', 
				'N', 
				null, 
				null, 
				'N', 
				'N');
 
end if;
 
ds_mensagem_p	:= ds_mensagem_w;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_retorno_movto_prot (nm_usuario_p text, nr_seq_retorno_p bigint, ds_mensagem_p INOUT text) FROM PUBLIC;

