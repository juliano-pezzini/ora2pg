-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pix_single_billing_status (cd_cobranca_pix_p bigint, nm_usuario_p text) AS $body$
DECLARE

  DS_DATA_W text;
  DS_RESULT_W text;
  cd_pix_transmissao_w bigint;


BEGIN

  select max(nr_sequencia)
  into STRICT cd_pix_transmissao_w
  from pix_transmissao 
  where nr_seq_pix_cob = cd_cobranca_pix_p;

  if (cd_pix_transmissao_w > 0) then
  
      DS_DATA_W := '{ "pixBillingId" : ' || cd_cobranca_pix_p || ',' ||
                     ' "pixTransmissionId" : ' || cd_pix_transmissao_w || ', ' || 
                     ' "userName" : "' || nm_usuario_p || '" ' ||
                     '}';

     ds_result_w := bifrost.send_integration(nm_event => 'pix.consultar.cobranca.imediata',
       nm_javaclass => 'com.philips.tasy.integration.pix.api.billing.inbound.callback.RequestBillingRegistrationCallback',
	   ds_arguments => ds_data_w , nm_user => Obter_Usuario_Ativo);

  end if;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pix_single_billing_status (cd_cobranca_pix_p bigint, nm_usuario_p text) FROM PUBLIC;

