-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ctb_linha_reg_aux ( nr_seq_registro_p bigint, ie_tipo_reg_auxiliar_ans_p bigint, cd_conta_contabil_p text, ie_tipo_mov_p text, nr_documento_p bigint, qt_mov_aux_p INOUT bigint) AS $body$
DECLARE


nr_sequencia_w 	 w_ctb_aux_contra_emit.nr_sequencia%type;
nr_contador_w	 bigint := 0;


C01 CURSOR FOR
	SELECT	nr_sequencia
	from	w_ctb_aux_contra_emit
	where	nr_seq_reg_auxiliar = nr_seq_registro_p
	and  	((nr_documento = coalesce(nr_documento_p,0))
	or (coalesce(nr_documento_p,0) = 0))
	and	(((ie_tipo_mov_p = '0' and cd_conta_contabil = cd_conta_contabil_p)
	or (ie_tipo_mov_p = '1' and cd_conta_debito = cd_conta_contabil_p)
	or	(ie_tipo_mov_p = '2' AND (cd_conta_contabil = cd_conta_contabil_p or cd_conta_debito = cd_conta_contabil_p)))
	or (coalesce(cd_conta_contabil_p,'0') = '0'))
	
union all

	SELECT	nr_sequencia
	from	w_ctb_livro_aux_event_liq
	where	nr_seq_reg_auxiliar = nr_seq_registro_p
	and	ie_tipo_reg_auxiliar_ans_p not in ('8011','8013')
	and  	((nr_documento = coalesce(nr_documento_p,0))
	or (coalesce(nr_documento_p,0) = 0))
	and	(((ie_tipo_mov_p = '0' and cd_conta_contabil = cd_conta_contabil_p)
	or (ie_tipo_mov_p = '1' and cd_conta_contrapartida = cd_conta_contabil_p)
	or	(ie_tipo_mov_p = '2' AND (cd_conta_contabil = cd_conta_contabil_p or cd_conta_contrapartida = cd_conta_contabil_p)))
	or (coalesce(cd_conta_contabil_p,'0') = '0'))
	
union all

	select	nr_sequencia
	from	w_ctb_livro_aux_event_liq
	where	nr_seq_reg_auxiliar = nr_seq_registro_p
	and	ie_tipo_reg_auxiliar_ans_p in ('8011','8013')
	and  	((nr_documento = coalesce(nr_documento_p,0))
	or (coalesce(nr_documento_p,0) = 0))
	and	(((ie_tipo_mov_p = '0' and cd_conta_contrapartida = cd_conta_contabil_p)
	or (ie_tipo_mov_p = '1' and cd_conta_contabil = cd_conta_contabil_p)
	or	(ie_tipo_mov_p = '2' AND (cd_conta_contrapartida = cd_conta_contabil_p or cd_conta_contabil = cd_conta_contabil_p)))
	or (coalesce(cd_conta_contabil_p,'0') = '0'));
	

BEGIN
CALL wheb_usuario_pck.set_ie_executar_trigger('N');

open C01;
loop
fetch C01 into
	nr_sequencia_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin
	nr_contador_w := nr_contador_w + 1;

	if ie_tipo_reg_auxiliar_ans_p in ('8000','8001','8002','8003','8004','8005','8006','8011','8012','8013','8020','8022','8025','8029') then
	
		update 	w_ctb_livro_aux_event_liq
		set	nr_linha_aux = nr_contador_w
		where	nr_sequencia = nr_sequencia_w;
	
	elsif ie_tipo_reg_auxiliar_ans_p in ('8007','8008','8009','8010','8014','8016','8018','8024') then
	
		update 	w_ctb_aux_contra_emit
		set	nr_linha_aux = nr_contador_w
		where	nr_sequencia = nr_sequencia_w;
		
	end if;

	end;
end loop;
close C01;
qt_mov_aux_p :=	nr_contador_w;

CALL wheb_usuario_pck.set_ie_executar_trigger('S');

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ctb_linha_reg_aux ( nr_seq_registro_p bigint, ie_tipo_reg_auxiliar_ans_p bigint, cd_conta_contabil_p text, ie_tipo_mov_p text, nr_documento_p bigint, qt_mov_aux_p INOUT bigint) FROM PUBLIC;

