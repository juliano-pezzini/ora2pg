-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_element_neonatal_act_md (Ie_Tipo_Elemento_p text, IE_CARBOHYDRATE_P text, IE_PROTEIN_P text, IE_LIPID_p text, IE_VITAMIN_P text, IE_OLIGOELEMENTO_P text, Qt_Elem_KgDia_p bigint, Qt_Peso_p bigint, ie_Round_p text default 'S', Ie_Glutamina_p text DEFAULT NULL, Qt_Volume_Final_p bigint DEFAULT NULL, Qt_Kcal_IE_LIPID_p bigint DEFAULT NULL, Qt_Kcal_p INOUT bigint DEFAULT NULL, Qt_Diaria_p INOUT bigint  DEFAULT NULL) AS $body$
DECLARE


    qt_Daily_w bigint;

BEGIN
      Qt_Kcal_p := 0;
      qt_Daily_w := Qt_Elem_KgDia_p * Qt_Peso_p;

      if (Ie_Tipo_Elemento_p = IE_CARBOHYDRATE_P) or (Ie_Tipo_Elemento_p = IE_PROTEIN_P) then
          if (ie_Round_p = 'S') and (coalesce(Ie_Glutamina_p,'N') = 'S') and (Ie_Tipo_Elemento_p = IE_PROTEIN_P) then
              Qt_Kcal_p := Qt_Volume_Final_p * 0.8;
          else
              Qt_Kcal_p := qt_Daily_w * 4;
          end if;
      elsif (Ie_Tipo_Elemento_p = IE_LIPID_p) then
          Qt_Kcal_p := Qt_Kcal_IE_LIPID_p;
      elsif (ie_Round_p = 'S') and (Ie_Tipo_Elemento_p = IE_VITAMIN_P) and (qt_Daily_w > 5) then
          qt_Daily_w := 5;
      elsif (ie_Round_p = 'S') and (Ie_Tipo_Elemento_p = IE_OLIGOELEMENTO_P) and (qt_Daily_w > 4) then
          qt_Daily_w := 4;
      end if;

      if ie_Round_p = 'S' then
          Qt_Diaria_p := round((qt_Daily_w)::numeric, 2);
      else   
          Qt_Diaria_p := qt_Daily_w;
      end if;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_element_neonatal_act_md (Ie_Tipo_Elemento_p text, IE_CARBOHYDRATE_P text, IE_PROTEIN_P text, IE_LIPID_p text, IE_VITAMIN_P text, IE_OLIGOELEMENTO_P text, Qt_Elem_KgDia_p bigint, Qt_Peso_p bigint, ie_Round_p text default 'S', Ie_Glutamina_p text DEFAULT NULL, Qt_Volume_Final_p bigint DEFAULT NULL, Qt_Kcal_IE_LIPID_p bigint DEFAULT NULL, Qt_Kcal_p INOUT bigint DEFAULT NULL, Qt_Diaria_p INOUT bigint  DEFAULT NULL) FROM PUBLIC;

