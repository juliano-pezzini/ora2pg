-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE san_grava_log_import_interface ( cd_interface_p bigint, cd_barras_p text, nm_usuario_p text) AS $body$
DECLARE

nr_sequencia_w	bigint;
nr_seq_doacao_w	bigint;
ds_log_w	varchar(255);

BEGIN

IF (cd_interface_p = '2236') THEN
BEGIN
	SELECT  DISTINCT
		c.nr_sequencia,
		c.nr_seq_doacao
	INTO STRICT	nr_sequencia_w,
		nr_seq_doacao_w
	FROM    san_exame_realizado a,
		san_exame_lote c,
		san_doacao d,
		san_exame e
	WHERE   a.nr_seq_exame_lote = c.nr_sequencia
	AND     d.nr_sequencia = c.nr_seq_doacao
	AND     LPAD(d.cd_barras_integracao,20,'0') = LPAD(trim(both cd_barras_p),20,'0')
	AND     a.nr_seq_exame = e.nr_sequencia;

	ds_log_w :=	wheb_mensagem_pck.get_texto(324879, 'NR_SEQUENCIA=' || nr_sequencia_w || ';' || 'NR_SEQ_DOACAO=' || nr_seq_doacao_w || ';' || 'CD_BARRAS=' || cd_barras_p);

	INSERT	INTO log_tasy(	dt_atualizacao,
				nm_usuario,
				cd_log,
				ds_log)
			VALUES (clock_timestamp(),
				nm_usuario_p,
				9004,
				ds_log_w);
END;
END IF;

COMMIT;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE san_grava_log_import_interface ( cd_interface_p bigint, cd_barras_p text, nm_usuario_p text) FROM PUBLIC;

