-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_dados_forcar_hora_livre ( cd_agenda_p bigint, hr_forcar_p text, dt_forcar_p timestamp, cd_turno_p INOUT text, nr_seq_hora_p INOUT bigint, dt_agenda_p INOUT timestamp) AS $body$
BEGIN
 
select	substr(obter_turno_horario_agenda(cd_agenda_p, hr_forcar_p), 1,1) 
into STRICT	cd_turno_p
;
 
select	coalesce(max(nr_seq_hora), 0) + 1 
into STRICT	nr_seq_hora_p 
from	agenda_consulta 
where	cd_agenda	= cd_agenda_p 
and	dt_agenda	= dt_forcar_p;
 
select	coalesce((max(dt_agenda) + 86400/86399) - 1, to_date(to_char(dt_forcar_p,'dd/mm/yyyy') || ' ' || hr_forcar_p, 'dd/mm/yyyy hh24:mi:ss')) 
into STRICT	dt_agenda_p 
from	agenda_consulta 
where	cd_agenda	= cd_agenda_p 
and	ie_status_agenda	= 'LF' 
and	dt_agenda between to_date(to_char(dt_forcar_p,'dd/mm/yyyy') || ' ' || hr_forcar_p || ':00', 'dd/mm/yyyy hh24:mi:ss') and to_date(to_char(dt_forcar_p,'dd/mm/yyyy') || ' ' || hr_forcar_p || ':59', 'dd/mm/yyyy hh24:mi:ss');
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_dados_forcar_hora_livre ( cd_agenda_p bigint, hr_forcar_p text, dt_forcar_p timestamp, cd_turno_p INOUT text, nr_seq_hora_p INOUT bigint, dt_agenda_p INOUT timestamp) FROM PUBLIC;

