-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE zerar_controle_lab_prescricao () AS $body$
DECLARE


ie_regra_w		varchar(1);
dt_sequencia_w		timestamp;



BEGIN

select	coalesce(max(dt_sequencia),clock_timestamp())
into STRICT	dt_sequencia_w
from	lab_seq_geracao;

select	max(ie_regra_seq_prescr)
into STRICT	ie_regra_w
from	lab_parametro;

if	((ie_regra_w = 'D') and (trunc(dt_sequencia_w,'dd') < trunc(clock_timestamp(),'dd'))) or
	((ie_regra_w = 'S') and (trunc(dt_sequencia_w,'day') < trunc(clock_timestamp(),'day'))) or
	((ie_regra_w = 'M') and (trunc(dt_sequencia_w,'month') < trunc(clock_timestamp(),'month'))) or
	((ie_regra_w = 'A') and (trunc(dt_sequencia_w,'year') < trunc(clock_timestamp(),'year'))) then

	insert into lab_seq_geracao(nr_sequencia, dt_sequencia,
			 nr_valor_seq, dt_atualizacao, nm_usuario)
	values (nextval('lab_seq_geracao_seq'), trunc(clock_timestamp(),'dd'),
			0, clock_timestamp(), 'Tasy');
end if;

commit;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE zerar_controle_lab_prescricao () FROM PUBLIC;

