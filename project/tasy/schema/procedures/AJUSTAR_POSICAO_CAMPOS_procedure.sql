-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ajustar_posicao_campos ( nr_seq_relatorio_p bigint, nr_banda_p bigint) AS $body$
DECLARE


  qt_esquerda_w    integer;
  qt_topo_w        integer := 0;
  qt_col_atual_w   smallint := 1;
--  nr_linha_atual_w NUMBER(1) := 1;
  qt_tamanho_w     integer;
  ult_nr_seq_w     integer;
  ult_qt_altura_w  integer;
  ult_qt_tamanho_w integer;

  c01 CURSOR FOR
    SELECT nr_sequencia,
           nr_altura,
           nr_comprimento
    FROM relatorio_dinamico rd
    WHERE nr_tipo_banda  = nr_banda_p
    AND nr_seq_relatorio = nr_seq_relatorio_p
    ORDER BY 1;
BEGIN
  --OPEN c01;
  FOR r01 IN c01 LOOP
    /*FETCH c01 INTO r01;*/

    EXIT WHEN NOT FOUND; /* apply on c01 */
    BEGIN

      IF (ult_nr_seq_w IS NOT NULL AND ult_nr_seq_w::text <> '') THEN
      
         IF (ult_qt_tamanho_w > 350) THEN
            qt_col_atual_w := 1;
            qt_topo_w         := qt_topo_w + ult_qt_altura_w;
            --qt_tamanho_w := 120;
         END IF;

         IF (MOD(qt_col_atual_w, 2) = 1) THEN
            qt_tamanho_w    := 120;
         ELSE
            qt_tamanho_w    := 250;
         END IF;

         IF (qt_col_atual_w <> 1) THEN
            qt_esquerda_w  := qt_esquerda_w + ult_qt_tamanho_w;
         ELSE
            qt_esquerda_w   := 0;
         END IF;

         UPDATE relatorio_dinamico
            SET nr_eixo_y      = qt_topo_w,
                nr_eixo_x        = qt_esquerda_w,
                nr_comprimento   = qt_tamanho_w
          WHERE nr_sequencia = r01.nr_sequencia;

         ult_nr_seq_w := r01.nr_sequencia;

         IF (qt_col_atual_w <> 4) THEN
            qt_col_atual_w := qt_col_atual_w + 1;
         ELSE
            qt_col_atual_w := 1;
            qt_topo_w := qt_topo_w + ult_qt_altura_w;
         END IF;

         ult_qt_tamanho_w := qt_tamanho_w;

      ELSE 
         ult_nr_seq_w := r01.nr_sequencia;
         ult_qt_altura_w := r01.nr_altura;
         ult_qt_tamanho_w := r01.nr_comprimento;
      END IF;
    END;
  END LOOP;
  --CLOSE c01;
  COMMIT;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ajustar_posicao_campos ( nr_seq_relatorio_p bigint, nr_banda_p bigint) FROM PUBLIC;

