-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_hdm_resumo_mensal (Seq_Hdm_Benef_Cubo_p bigint, Dt_Mesano_Referencia_P timestamp Default Null, Nm_Usuario_P text Default Null, Vl_Resultado_P bigint Default Null, Pr_Sinistralidade_P bigint Default Null, Vl_Custo_P bigint Default Null, Vl_Receita_P bigint Default Null, Ie_Origem_P text Default Null) AS $body$
DECLARE


Pessoa_Fisica_W bigint;
Valida_Insercao_W bigint;
Sql_Errm_W varchar(255);


BEGIN

Select coalesce(max(nr_sequencia),0) Into STRICT Valida_Insercao_W From Hdm_Benef_Custo_Cubo Where  Nr_Seq_Benef_Cubo = Seq_Hdm_Benef_Cubo_P And Dt_Mesano_Referencia = Dt_Mesano_Referencia_P;

If (Valida_Insercao_W = 0) Then

	Select Max(Cd_Pessoa_Fisica) Into STRICT Pessoa_Fisica_W From Hdm_Benef_Cubo Where Nr_Sequencia = Seq_Hdm_Benef_Cubo_P;

	begin
	Insert Into Hdm_Benef_Custo_Cubo(Nr_Sequencia,
		Dt_Mesano_Referencia,
		Nm_Usuario,
		nm_usuario_nrec,
		Vl_Resultado,
		Pr_Sinistralidade,
		Vl_Custo,
		Vl_Receita,
		Dt_Atualizacao,
		dt_atualizacao_nrec,
		Nr_Seq_Benef_Cubo,
		Ie_Origem)
	Values (nextval('hdm_benef_custo_cubo_seq'),
		Dt_Mesano_Referencia_P,
		Nm_Usuario_P,
		Nm_Usuario_P,
		Vl_Resultado_P,
		Pr_Sinistralidade_P,
		Vl_Custo_P,
		Vl_Receita_P,
		clock_timestamp(),
		clock_timestamp(),
		Seq_Hdm_Benef_Cubo_P,
		Ie_Origem_P);

	Exception
	When Others Then
	Sql_Errm_W	:= Sqlerrm;
	Insert Into Hdm_Log_Integracao(Nr_Sequencia,
		Dt_Atualizacao,
		Nm_Usuario,
		Dt_Atualizacao_Nrec,
		Nm_Usuario_Nrec,
		Ie_Tipo_Log,
		Ds_Titulo,
		Ds_Log_Hdm)
	Values (nextval('hdm_log_integracao_seq'),
		clock_timestamp(),
		Nm_Usuario_P,
		clock_timestamp(),
		Nm_Usuario_P,
		'I',
		'Inserir HDM_BENEF_CUSTO_CUBO (Resumo_Mensal)',
		Sql_Errm_W);
	end;
end if;


End;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_hdm_resumo_mensal (Seq_Hdm_Benef_Cubo_p bigint, Dt_Mesano_Referencia_P timestamp Default Null, Nm_Usuario_P text Default Null, Vl_Resultado_P bigint Default Null, Pr_Sinistralidade_P bigint Default Null, Vl_Custo_P bigint Default Null, Vl_Receita_P bigint Default Null, Ie_Origem_P text Default Null) FROM PUBLIC;

