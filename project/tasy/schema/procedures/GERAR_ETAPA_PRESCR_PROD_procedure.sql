-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_etapa_prescr_prod ( cd_estabelecimento_p bigint, nr_prescricao_p bigint, nm_usuario_p text ) AS $body$
DECLARE

    nr_sequencia_w    bigint;
    nr_seq_cabine_w   bigint;

BEGIN
    nr_seq_cabine_w := obter_param_usuario(3130, 301, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, nr_seq_cabine_w);

    IF ( coalesce(nr_seq_cabine_w, 0) > 0 ) THEN
        select
            nextval('far_etapa_producao_seq')
        into STRICT nr_sequencia_w
;

        insert into far_etapa_producao(
            nr_sequencia,
            cd_estabelecimento,
            dt_atualizacao,
            dt_atualizacao_nrec,
            dt_etapa,
            nm_usuario,
            nm_usuario_nrec,
            nr_seq_cabine
        ) values (
            nr_sequencia_w,
            cd_estabelecimento_p,
            clock_timestamp(),
            clock_timestamp(),
            clock_timestamp(),
            nm_usuario_p,
            nm_usuario_p,
            nr_seq_cabine_w
        );

        update  can_ordem_prod
        set     nr_seq_etapa_prod = nr_sequencia_w,
                ie_conferido = 'S'
        where   nr_prescricao = nr_prescricao_p;

    ELSE
        CALL wheb_mensagem_pck.exibir_mensagem_abort(173464);
    END IF;

    COMMIT;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_etapa_prescr_prod ( cd_estabelecimento_p bigint, nr_prescricao_p bigint, nm_usuario_p text ) FROM PUBLIC;

