-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE hd_consistir_controle_dialise ( vl_item_p bigint, nr_seq_item_p bigint, ds_mensagem_p INOUT text) AS $body$
DECLARE


qt_min_aviso_w		double precision;
qt_max_aviso_w		double precision;
vl_item_w		double precision;
ds_mensagem_w		varchar(255);
ds_mensagem_alerta_w	varchar(255);


BEGIN
if (vl_item_p IS NOT NULL AND vl_item_p::text <> '') then
begin
	vl_item_w := vl_item_p;

	select	max(a.vl_minimo),
		max(a.vl_maximo),
		max(ds_mensagem_alerta)
	into STRICT	qt_min_aviso_w,
		qt_max_aviso_w,
		ds_mensagem_alerta_w
	from	hd_regra_faixa_valor a
	where	a.nr_seq_controle = nr_seq_item_p
	and	ie_situacao = 'A';


	if not(vl_item_w between qt_min_aviso_w and qt_max_aviso_w) then
		begin
		if	((coalesce(ds_mensagem_alerta_w::text, '') = '') or (ds_mensagem_alerta_w = '')) then
			ds_mensagem_w := wheb_mensagem_pck.get_texto(323294,	'QT_MIN_AVISO_W=' || to_char(qt_min_aviso_w) || ';' ||
										'QT_MAX_AVISO_W=' ||  to_char(qt_max_aviso_w));
							/*
							Valor fora da faixa usual!
							Neste estabelecimento considera-se usual o registro deste par√¢metro conforme a seguir:
							Valores usuais entre #@QT_MIN_AVISO_W#@ e #@QT_MAX_AVISO_W#@
							*/
		else
			ds_mensagem_w :=  ds_mensagem_alerta_w;
		end if;
		end;
	end if;

end;
end if;
ds_mensagem_p := ds_mensagem_w;
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE hd_consistir_controle_dialise ( vl_item_p bigint, nr_seq_item_p bigint, ds_mensagem_p INOUT text) FROM PUBLIC;

