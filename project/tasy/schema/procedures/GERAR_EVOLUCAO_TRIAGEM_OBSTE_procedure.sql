-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_evolucao_triagem_obste ( nr_sequencia_p bigint, nm_usuario_p text) AS $body$
DECLARE


ds_evolucao_w		varchar(32000);
ds_titulo_w			varchar(100);
ds_compl_w			varchar(32000);
ds_aux_expressao_w	varchar(50);
ds_espaco_w			varchar(5) := '  ';
ds_barra_w			varchar(5) := '/';
cd_evolucao_w		evolucao_paciente.cd_evolucao%type;
ie_tipo_evolucao_w	usuario.ie_tipo_evolucao%type;
cd_pessoa_fisica_w	evolucao_paciente.cd_pessoa_fisica%type;
nr_atendimento_w	evolucao_paciente.nr_atendimento%type;
dt_registro_w		enf_tri_medica.dt_registro%type;
cd_profissional_w	enf_tri_medica.cd_profissional%type;
ie_evolucao_clinica_w	evolucao_paciente.ie_evolucao_clinica%type;
cd_estabelecimento_w	bigint;

C01 CURSOR FOR
	SELECT	PKG_DATE_FORMATERS.to_varchar(dt_registro,'timestamp',cd_estabelecimento_w,nm_usuario_p) dt_registro,
			ie_gestante,
			ie_intercorrencia_gest,
			ds_intercorrencia,
			PKG_DATE_FORMATERS.to_varchar(dt_ultima_menstruacao,'shortDate',cd_estabelecimento_w,nm_usuario_p) dt_ultima_menstruacao,
			qt_ig_sem,
			qt_ig_dia,
			PKG_DATE_FORMATERS.to_varchar(dt_prov_parto,'shortDate',cd_estabelecimento_w,nm_usuario_p) dt_prov_parto,
			PKG_DATE_FORMATERS.to_varchar(dt_us,'shortDate',cd_estabelecimento_w,nm_usuario_p) dt_us,
			qt_ig_sem_us,
			qt_ig_dia_us,
			PKG_DATE_FORMATERS.to_varchar(dt_prov_parto_us,'shortDate',cd_estabelecimento_w,nm_usuario_p) dt_prov_parto_us,
			substr(obter_dpp_us_atual_nasc(nr_sequencia,'IGCS','TM',nr_atendimento),1,5) qt_ig_sem_considerada,
			substr(obter_dpp_us_atual_nasc(nr_sequencia,'IGCD','TM',nr_atendimento),1,5) qt_ig_dia_considerada,
			substr(obter_dpp_us_atual_nasc(nr_sequencia,'S','TM',nr_atendimento),1,5) qt_sem_us_atual,
			substr(obter_dpp_us_atual_nasc(nr_sequencia,'D','TM',nr_atendimento),1,5) qt_dia_us_atual,
			qt_gestacoes,
			qt_parto_normal,
			qt_parto_cesario,
			qt_filhos_vivos,
			qt_natimortos,
			qt_abortos,qt_abortos_esp,qt_abortos_prov,
			qt_feto,
			ds_molestia_atual,
			ie_nao_sabe_tipo_sang,
			ie_tipo_sangue_mae,
			ie_fator_rh_mae,
			ie_exame_coombs,ie_coombs,ds_titulacao_coombs,PKG_DATE_FORMATERS.to_varchar(dt_coombs,'shortDate',cd_estabelecimento_w,nm_usuario_p) dt_coombs,
			ie_estreptococo,
			ie_estreptococo_positivo,
			ie_aids,
			ie_aids_positivo,
			PKG_DATE_FORMATERS.to_varchar(dt_aids,'shortDate',cd_estabelecimento_w,nm_usuario_p) dt_aids,
			qt_peso_mae,
			qt_altura_cm,
			qt_imc,
			qt_pa_sistolica,
			qt_pa_diastolica,
			qt_pulso,
			qt_freq_resp,
			ie_batim_fetais,qt_bat_cardio_fetais,qt_bat_cardio_fetais2,qt_bat_cardio_fetais3,
			qt_temperatura,
			qt_saturacao_o2,
			ie_nivel_consciencia,
			cd_escala_dor,
			qt_escala_dor,
			ds_descricao,
			ie_dinamica_uterina,qt_contracoes,qt_contracao,ie_interv_contracoes,
			qt_altura_uterina,
			qt_dilatacao_uterina,
			ie_colo_espessura,
			ie_colo_textura,
			ie_colo_posicao,
			ie_plano_lee,
			ie_bolsa_amniotica,PKG_DATE_FORMATERS.to_varchar(dt_bolsa_amniotica,'timestamp',cd_estabelecimento_w,nm_usuario_p) dt_bolsa_amniotica,ie_aspecto_liquido,
			ie_ritmo_bcf,
			ie_apresentacao_fetal,
			ie_intensidade_edema,
			ie_exame_especular,ds_exam_especlr,
			ds_observacao,
			ie_conduta,ds_outra_conduta
	from	enf_tri_medica
	where	nr_sequencia = nr_sequencia_p;	

c01_w c01%rowtype;


BEGIN

cd_estabelecimento_w := wheb_usuario_pck.get_cd_estabelecimento;

ie_evolucao_clinica_w := Obter_Param_Usuario(281, 1593, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_w, ie_evolucao_clinica_w);

if (ie_evolucao_clinica_w IS NOT NULL AND ie_evolucao_clinica_w::text <> '') then

	open C01;
	loop
	fetch C01 into	
		c01_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */
		begin
	
		ds_evolucao_w	:= wheb_rtf_pck.GET_CABECALHO;
	
		ds_titulo_w	:= wheb_rtf_pck.get_centralizado(true)||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(922235, null, wheb_usuario_pck.get_nr_seq_idioma)||wheb_rtf_pck.get_negrito(false)||wheb_rtf_pck.get_centralizado(false);
			
		if (c01_w.dt_registro IS NOT NULL AND c01_w.dt_registro::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(287188, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.dt_registro;--Data registro
	
		end if;
	
		if (c01_w.ie_gestante IS NOT NULL AND c01_w.ie_gestante::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(699842, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.IE_GESTANTE;--E gestante
		end if;
				
		if (c01_w.ie_intercorrencia_gest IS NOT NULL AND c01_w.ie_intercorrencia_gest::text <> '') then
				
			select 	CASE WHEN c01_w.ie_intercorrencia_gest='0' THEN 'S' WHEN c01_w.ie_intercorrencia_gest='1' THEN 'N' END
			into STRICT 	ds_aux_expressao_w
			;
			
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(909946, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||Obter_Valor_Dominio(6,ds_aux_expressao_w);
			
			if (c01_w.ie_intercorrencia_gest = '0' and (c01_w.ds_intercorrencia IS NOT NULL AND c01_w.ds_intercorrencia::text <> '')) then
				ds_compl_w	:= ds_compl_w||ds_espaco_w||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(589482, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.ds_intercorrencia;--Descricao da intercorrencia
				end if;
		end if;
				
		if (c01_w.dt_ultima_menstruacao IS NOT NULL AND c01_w.dt_ultima_menstruacao::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(288991, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.dt_ultima_menstruacao;--DUM
		end if;
	
		if (c01_w.qt_ig_sem IS NOT NULL AND c01_w.qt_ig_sem::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(291659, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.qt_ig_sem;--IG DUM (sem/dia)
			
			if (c01_w.qt_ig_dia IS NOT NULL AND c01_w.qt_ig_dia::text <> '') then
				ds_compl_w	:= ds_compl_w||ds_barra_w||c01_w.qt_ig_dia;
			end if;
			
		end if;
				
		if (c01_w.dt_prov_parto IS NOT NULL AND c01_w.dt_prov_parto::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(288289, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.DT_PROV_PARTO;--DPP
		end if;
				
		if (c01_w.DT_US IS NOT NULL AND c01_w.DT_US::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(287251, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.DT_US;--Data US
		end if;
	
		if (c01_w.qt_ig_sem_us IS NOT NULL AND c01_w.qt_ig_sem_us::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(291667, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.qt_ig_sem_us;
			
			if (c01_w.QT_IG_DIA_US IS NOT NULL AND c01_w.QT_IG_DIA_US::text <> '') then
				ds_compl_w	:= ds_compl_w||ds_barra_w||c01_w.QT_IG_DIA_US;
			end if;
			
		end if;
	
		if (c01_w.DT_PROV_PARTO_US IS NOT NULL AND c01_w.DT_PROV_PARTO_US::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(288290, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.DT_PROV_PARTO_US;--DPP US
		end if;
				
		if (c01_w.QT_IG_SEM_CONSIDERADA IS NOT NULL AND c01_w.QT_IG_SEM_CONSIDERADA::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(891122, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.QT_IG_SEM_CONSIDERADA;--IG considerada (sem/dia)
			
			if (c01_w.QT_IG_DIA_CONSIDERADA IS NOT NULL AND c01_w.QT_IG_DIA_CONSIDERADA::text <> '') then
				ds_compl_w	:= ds_compl_w||ds_barra_w||c01_w.QT_IG_DIA_CONSIDERADA;
			end if;
			
		end if;
				
		if (c01_w.QT_SEM_US_ATUAL IS NOT NULL AND c01_w.QT_SEM_US_ATUAL::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(291666, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.QT_SEM_US_ATUAL;--IG US Atual (sem/dia)
			
			if (c01_w.QT_DIA_US_ATUAL IS NOT NULL AND c01_w.QT_DIA_US_ATUAL::text <> '') then
				ds_compl_w	:= ds_compl_w||ds_barra_w||c01_w.QT_DIA_US_ATUAL;
			end if;		
			
		end if;
				
		if (c01_w.QT_GESTACOES IS NOT NULL AND c01_w.QT_GESTACOES::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(290887, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.QT_GESTACOES;--Gestacoes
		end if;
	
		if (c01_w.QT_PARTO_NORMAL IS NOT NULL AND c01_w.QT_PARTO_NORMAL::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(295338, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.QT_PARTO_NORMAL;--Partos normais
		end if;
				
		if (c01_w.QT_PARTO_CESARIO IS NOT NULL AND c01_w.QT_PARTO_CESARIO::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(295336, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.QT_PARTO_CESARIO;--Partos cesareos
		end if;
	
		if (c01_w.QT_FILHOS_VIVOS IS NOT NULL AND c01_w.QT_FILHOS_VIVOS::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(290089, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.QT_FILHOS_VIVOS;--Filhos vivos
		end if;
				
		if (c01_w.QT_NATIMORTOS IS NOT NULL AND c01_w.QT_NATIMORTOS::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(293982, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.QT_NATIMORTOS;--Natimortos
		end if;
	
		if (c01_w.QT_ABORTOS IS NOT NULL AND c01_w.QT_ABORTOS::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(283073, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.QT_ABORTOS;--Abortos
		end if;
		
		if (c01_w.QT_ABORTOS_ESP IS NOT NULL AND c01_w.QT_ABORTOS_ESP::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(683242, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.QT_ABORTOS_ESP;--Espontaneos
		end if;
		
		if (c01_w.QT_ABORTOS_PROV IS NOT NULL AND c01_w.QT_ABORTOS_PROV::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(683244, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.QT_ABORTOS_PROV;--Provocados
		end if;
		
		if (c01_w.QT_FETO IS NOT NULL AND c01_w.QT_FETO::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(293798, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.QT_FETO;--N fetos
		end if;
		
		if (c01_w.DS_MOLESTIA_ATUAL IS NOT NULL AND c01_w.DS_MOLESTIA_ATUAL::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(939470, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.DS_MOLESTIA_ATUAL;
		end if;
		
		if (coalesce(c01_w.IE_NAO_SABE_TIPO_SANG,'0') = 'S') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(293947, null, wheb_usuario_pck.get_nr_seq_idioma) || wheb_rtf_pck.get_negrito(false);--Nao sabe tipo sanguineo
			
		elsif (coalesce(c01_w.IE_NAO_SABE_TIPO_SANG,'0') = 'N') then
		
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(299998, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false);--Tipo sanguineo
		
			if (c01_w.IE_TIPO_SANGUE_MAE IS NOT NULL AND c01_w.IE_TIPO_SANGUE_MAE::text <> '') then
				ds_compl_w	:= ds_compl_w||Obter_Valor_Dominio(1173,c01_w.IE_TIPO_SANGUE_MAE);
			end if;
			
			if (c01_w.IE_FATOR_RH_MAE IS NOT NULL AND c01_w.IE_FATOR_RH_MAE::text <> '') then
				ds_compl_w	:= ds_compl_w||Obter_Valor_Dominio(1174,c01_w.IE_FATOR_RH_MAE);
			end if;
		
		end if;
		
		if (c01_w.IE_EXAME_COOMBS IS NOT NULL AND c01_w.IE_EXAME_COOMBS::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(286233, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.IE_EXAME_COOMBS;--Coombs indireto
			
			if (c01_w.IE_COOMBS IS NOT NULL AND c01_w.IE_COOMBS::text <> '') then
				ds_compl_w	:= ds_compl_w||ds_espaco_w||Obter_Valor_Dominio(4512,c01_w.IE_COOMBS);
			end if;
		
			if (c01_w.DS_TITULACAO_COOMBS IS NOT NULL AND c01_w.DS_TITULACAO_COOMBS::text <> '') then
				ds_compl_w	:= ds_compl_w||ds_espaco_w||c01_w.DS_TITULACAO_COOMBS;
			end if;
			
			if (c01_w.DT_COOMBS IS NOT NULL AND c01_w.DT_COOMBS::text <> '') then
				ds_compl_w	:= ds_compl_w||ds_espaco_w||c01_w.DT_COOMBS;
			end if;
		
		end if;
		
		
		if (c01_w.IE_ESTREPTOCOCO IS NOT NULL AND c01_w.IE_ESTREPTOCOCO::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(295775, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.IE_ESTREPTOCOCO;--Pesq estreptococo
			
			if (c01_w.IE_ESTREPTOCOCO_POSITIVO IS NOT NULL AND c01_w.IE_ESTREPTOCOCO_POSITIVO::text <> '') then
				ds_compl_w	:= ds_compl_w||ds_espaco_w||Obter_Valor_Dominio(4512,c01_w.IE_ESTREPTOCOCO_POSITIVO);
			end if;
			
		end if;
		
		if (c01_w.IE_AIDS IS NOT NULL AND c01_w.IE_AIDS::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(291363, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.IE_AIDS;--HIV
			
			if (c01_w.IE_AIDS_POSITIVO IS NOT NULL AND c01_w.IE_AIDS_POSITIVO::text <> '') then
				ds_compl_w	:= ds_compl_w||ds_espaco_w||Obter_Valor_Dominio(4512,c01_w.IE_AIDS_POSITIVO);
			end if;
			
			if (c01_w.DT_AIDS IS NOT NULL AND c01_w.DT_AIDS::text <> '') then
				ds_compl_w	:= ds_compl_w||ds_espaco_w||c01_w.DT_AIDS;
			end if;		
			
		end if;
		
		if (c01_w.QT_PESO_MAE IS NOT NULL AND c01_w.QT_PESO_MAE::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(295739, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.QT_PESO_MAE;--Peso mae (kg)
		end if;
		
		if (c01_w.QT_ALTURA_CM IS NOT NULL AND c01_w.QT_ALTURA_CM::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(283405, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.QT_ALTURA_CM;--Altura (cm)
		end if;
		
		if (c01_w.QT_IMC IS NOT NULL AND c01_w.QT_IMC::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(291698, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.QT_IMC;--IMC (kg/m2)
		end if;
		
		if (c01_w.QT_PA_SISTOLICA IS NOT NULL AND c01_w.QT_PA_SISTOLICA::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(295151, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.QT_PA_SISTOLICA;--PA sist/diast (mmHg)
			
			if (c01_w.QT_PA_DIASTOLICA IS NOT NULL AND c01_w.QT_PA_DIASTOLICA::text <> '') then
				ds_compl_w	:= ds_compl_w||ds_barra_w||c01_w.QT_PA_DIASTOLICA;
			end if;			
			
		end if;
		
		if (c01_w.QT_PULSO IS NOT NULL AND c01_w.QT_PULSO::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(290479, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.QT_PULSO;--Freq cardiaca (bpm)
		end if;
		
		if (c01_w.QT_FREQ_RESP IS NOT NULL AND c01_w.QT_FREQ_RESP::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(290486, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.QT_FREQ_RESP;--Freq respiratoria (mrm)
		end if;
		
		if (c01_w.IE_BATIM_FETAIS IS NOT NULL AND c01_w.IE_BATIM_FETAIS::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(284274, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||Obter_Valor_Dominio(3895,c01_w.IE_BATIM_FETAIS);--BCF
			
			if (c01_w.QT_BAT_CARDIO_FETAIS IS NOT NULL AND c01_w.QT_BAT_CARDIO_FETAIS::text <> '') then
				ds_compl_w	:= ds_compl_w||ds_espaco_w||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(284276, null, wheb_usuario_pck.get_nr_seq_idioma)||': '||wheb_rtf_pck.get_negrito(false)||c01_w.QT_BAT_CARDIO_FETAIS;--BCF 1 (bpm)
			end if;	
	
			if (c01_w.QT_BAT_CARDIO_FETAIS2 IS NOT NULL AND c01_w.QT_BAT_CARDIO_FETAIS2::text <> '') then
				ds_compl_w	:= ds_compl_w||ds_espaco_w||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(284277, null, wheb_usuario_pck.get_nr_seq_idioma)||': '||wheb_rtf_pck.get_negrito(false)||c01_w.QT_BAT_CARDIO_FETAIS2;--BCF 2 (bpm)
			end if;	
	
			if (c01_w.QT_BAT_CARDIO_FETAIS3 IS NOT NULL AND c01_w.QT_BAT_CARDIO_FETAIS3::text <> '') then
				ds_compl_w	:= ds_compl_w||ds_espaco_w||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(284278, null, wheb_usuario_pck.get_nr_seq_idioma)||': '||wheb_rtf_pck.get_negrito(false)||c01_w.QT_BAT_CARDIO_FETAIS3;--BCF 3 (bpm)
			end if;	
			
		end if;
			
		if (c01_w.QT_TEMPERATURA IS NOT NULL AND c01_w.QT_TEMPERATURA::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(299184, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.QT_TEMPERATURA;--Temp (C)
		end if;
		
		if (c01_w.QT_SATURACAO_O2 IS NOT NULL AND c01_w.QT_SATURACAO_O2::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(298056, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.QT_SATURACAO_O2;--Saturacao O2 (%)
		end if;
		
		if (c01_w.IE_NIVEL_CONSCIENCIA IS NOT NULL AND c01_w.IE_NIVEL_CONSCIENCIA::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(293729, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||Obter_Valor_Dominio(3342,c01_w.IE_NIVEL_CONSCIENCIA);--Nivel  consciencia
		end if;
			
		if (c01_w.CD_ESCALA_DOR IS NOT NULL AND c01_w.CD_ESCALA_DOR::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(289379, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||Obter_Valor_Dominio(1298,c01_w.CD_ESCALA_DOR);--Escala de dor utilizada
			
			if (c01_w.QT_ESCALA_DOR IS NOT NULL AND c01_w.QT_ESCALA_DOR::text <> '') then
				ds_compl_w	:= ds_compl_w||ds_espaco_w||c01_w.QT_ESCALA_DOR;
			end if;			
			
		end if;
		
		if (c01_w.DS_DESCRICAO IS NOT NULL AND c01_w.DS_DESCRICAO::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(289702, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.DS_DESCRICAO;--Exame fisico
		end if;
			
		if (c01_w.IE_DINAMICA_UTERINA IS NOT NULL AND c01_w.IE_DINAMICA_UTERINA::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(287953, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.IE_DINAMICA_UTERINA;--Dinamica uterina
			
			if (c01_w.QT_CONTRACOES IS NOT NULL AND c01_w.QT_CONTRACOES::text <> '') then
				ds_compl_w	:= ds_compl_w||ds_espaco_w||obter_desc_expressao_idioma(286129, null, wheb_usuario_pck.get_nr_seq_idioma)||': '||c01_w.QT_CONTRACOES;--Contracoes (10 min)
			end if;			
			
			if (c01_w.QT_CONTRACAO IS NOT NULL AND c01_w.QT_CONTRACAO::text <> '') then
				ds_compl_w	:= ds_compl_w||ds_espaco_w||obter_desc_expressao_idioma(297127, null, wheb_usuario_pck.get_nr_seq_idioma)||': '||c01_w.QT_CONTRACAO;--Quantidade/contracoes
			end if;	
	
			if (c01_w.IE_INTERV_CONTRACOES IS NOT NULL AND c01_w.IE_INTERV_CONTRACOES::text <> '') then
				ds_compl_w	:= ds_compl_w||ds_barra_w||Obter_Valor_Dominio(2950,c01_w.IE_INTERV_CONTRACOES);--Quantidade/contracoes
			end if;			
			
		end if;
		
		if (c01_w.QT_ALTURA_UTERINA IS NOT NULL AND c01_w.QT_ALTURA_UTERINA::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(283415, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.QT_ALTURA_UTERINA;--Altura uterina(cm)
		end if;
		
		if (c01_w.QT_DILATACAO_UTERINA IS NOT NULL AND c01_w.QT_DILATACAO_UTERINA::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(287936, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.QT_DILATACAO_UTERINA;--Dilatacao (cm)
		end if;
			
		if (c01_w.IE_COLO_ESPESSURA IS NOT NULL AND c01_w.IE_COLO_ESPESSURA::text <> '') then
		
			if (c01_w.IE_COLO_ESPESSURA = '1') then
				ds_aux_expressao_w := obter_desc_expressao(922529);
			elsif (c01_w.IE_COLO_ESPESSURA = '1') then
				ds_aux_expressao_w := obter_desc_expressao(922531);
			elsif (c01_w.IE_COLO_ESPESSURA = '3') then
				ds_aux_expressao_w := obter_desc_expressao(922533);
			elsif (c01_w.IE_COLO_ESPESSURA = '4') then
				ds_aux_expressao_w := obter_desc_expressao(731301);
			end if;
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(283579, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||ds_aux_expressao_w;--Apagamento (%)
		end if;
		
		if (c01_w.IE_COLO_TEXTURA IS NOT NULL AND c01_w.IE_COLO_TEXTURA::text <> '') then
		
			if (c01_w.IE_COLO_TEXTURA = 'f') then
				ds_aux_expressao_w := obter_desc_expressao(290166);
			elsif (c01_w.IE_COLO_TEXTURA = 'i') then
				ds_aux_expressao_w := obter_desc_expressao(304784);
			elsif (c01_w.IE_COLO_TEXTURA = 'a') then
				ds_aux_expressao_w := obter_desc_expressao(495942);
			end if;
			
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(299355, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||ds_aux_expressao_w;--Textura
		end if;
		
		if (c01_w.IE_COLO_POSICAO IS NOT NULL AND c01_w.IE_COLO_POSICAO::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(296094, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||Obter_Valor_Dominio(3902,c01_w.IE_COLO_POSICAO);--Posicao
		end if;
			
		if (c01_w.IE_PLANO_LEE IS NOT NULL AND c01_w.IE_PLANO_LEE::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(295953, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||Obter_Valor_Dominio(2956,c01_w.IE_PLANO_LEE);--Plano De Lee
		end if;
		
		if (c01_w.IE_BOLSA_AMNIOTICA IS NOT NULL AND c01_w.IE_BOLSA_AMNIOTICA::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(284342, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||Obter_Valor_Dominio(3903,c01_w.IE_BOLSA_AMNIOTICA);--Bolsa amniotica
			
			if (c01_w.DT_BOLSA_AMNIOTICA IS NOT NULL AND c01_w.DT_BOLSA_AMNIOTICA::text <> '') then
				ds_compl_w	:= ds_compl_w||ds_espaco_w||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(297945, null, wheb_usuario_pck.get_nr_seq_idioma)||': '||wheb_rtf_pck.get_negrito(false)||c01_w.DT_BOLSA_AMNIOTICA;--Rotura da bolsa
			end if;			
			
		end if;
		
		if (c01_w.IE_ASPECTO_LIQUIDO IS NOT NULL AND c01_w.IE_ASPECTO_LIQUIDO::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(292629, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||Obter_Valor_Dominio(2952,c01_w.IE_ASPECTO_LIQUIDO);--Liquido
		end if;	
		
		if (c01_w.IE_RITMO_BCF IS NOT NULL AND c01_w.IE_RITMO_BCF::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(297914, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||Obter_Valor_Dominio(3896,c01_w.IE_RITMO_BCF);--Ritmo
		end if;
			
		if (c01_w.IE_APRESENTACAO_FETAL IS NOT NULL AND c01_w.IE_APRESENTACAO_FETAL::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(283684, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||Obter_Valor_Dominio(1469,c01_w.IE_APRESENTACAO_FETAL);--Apresentacao fetal
		end if;
		
		if (c01_w.IE_INTENSIDADE_EDEMA IS NOT NULL AND c01_w.IE_INTENSIDADE_EDEMA::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(289055, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||Obter_Valor_Dominio(3788,c01_w.IE_INTENSIDADE_EDEMA);--Edema
		end if;
		
		if (c01_w.IE_EXAME_ESPECULAR IS NOT NULL AND c01_w.IE_EXAME_ESPECULAR::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(289698, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.IE_EXAME_ESPECULAR;--Exame especular
			
			if (c01_w.DS_EXAM_ESPECLR IS NOT NULL AND c01_w.DS_EXAM_ESPECLR::text <> '') then
				ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(944126, null, wheb_usuario_pck.get_nr_seq_idioma)||': '||wheb_rtf_pck.get_negrito(false)||c01_w.DS_EXAM_ESPECLR;--Detalhe
			end if;			
			
		end if;
			
		if (c01_w.DS_OBSERVACAO IS NOT NULL AND c01_w.DS_OBSERVACAO::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(294678, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.DS_OBSERVACAO;--Observacoes
		end if;
		
		if (c01_w.IE_CONDUTA IS NOT NULL AND c01_w.IE_CONDUTA::text <> '') then
		
			if (c01_w.IE_CONDUTA = 'A') then
				ds_aux_expressao_w := obter_desc_expressao_idioma(1033482, null, wheb_usuario_pck.get_nr_seq_idioma);
			elsif (c01_w.IE_CONDUTA = 'I') then
				ds_aux_expressao_w := obter_desc_expressao_idioma(1033484, null, wheb_usuario_pck.get_nr_seq_idioma);
			elsif (c01_w.IE_CONDUTA = 'E') then
				ds_aux_expressao_w := obter_desc_expressao_idioma(1033486, null, wheb_usuario_pck.get_nr_seq_idioma);
			elsif (c01_w.IE_CONDUTA = 'C') then
				ds_aux_expressao_w := obter_desc_expressao_idioma(1033488, null, wheb_usuario_pck.get_nr_seq_idioma);
			elsif (c01_w.IE_CONDUTA = 'U') then
				ds_aux_expressao_w := obter_desc_expressao_idioma(1033490, null, wheb_usuario_pck.get_nr_seq_idioma);
			elsif (c01_w.IE_CONDUTA = 'O') then
				ds_aux_expressao_w := obter_desc_expressao_idioma(1033492, null, wheb_usuario_pck.get_nr_seq_idioma);	
			end if;	
		
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(285675, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||ds_aux_expressao_w;--Conduta
		end if;
		
		if (c01_w.DS_OUTRA_CONDUTA IS NOT NULL AND c01_w.DS_OUTRA_CONDUTA::text <> '') then
			ds_compl_w	:= ds_compl_w||wheb_rtf_pck.get_quebra_linha||wheb_rtf_pck.get_negrito(true)||obter_desc_expressao_idioma(704816, null, wheb_usuario_pck.get_nr_seq_idioma) || ': ' ||wheb_rtf_pck.get_negrito(false)||c01_w.DS_OUTRA_CONDUTA;--Outros
		end if;
			
		ds_evolucao_w	:= substr(ds_evolucao_w||ds_titulo_w||ds_compl_w,1,32000);
	
		ds_evolucao_w	:= ds_evolucao_w||wheb_rtf_pck.get_rodape;
	end;
	end loop;
	
	select	max(IE_TIPO_EVOLUCAO)
	into STRICT	IE_TIPO_EVOLUCAO_w
	from	usuario
	where	nm_usuario = nm_usuario_p;
	
	select	nextval('evolucao_paciente_seq')
	into STRICT	cd_evolucao_w
	;
	
	select 	obter_pessoa_atendimento(max(nr_atendimento),'C'),
			max(nr_atendimento),
			max(dt_registro),
			max(cd_profissional)
	into STRICT    cd_pessoa_fisica_w,
			nr_atendimento_w,
			dt_registro_w,
			cd_profissional_w
	from 	enf_tri_medica
	where	nr_sequencia = nr_sequencia_p;
	
	insert into evolucao_paciente(	cd_evolucao,
					dt_evolucao,
					ie_tipo_evolucao,
					cd_pessoa_fisica,
					dt_atualizacao,
					dt_atualizacao_nrec,
					nm_usuario,
					nm_usuario_nrec,
					nr_atendimento,
					ds_evolucao,					
					dt_liberacao,
					ie_evolucao_clinica,
					cd_medico,
					ie_situacao)
			values (	cd_evolucao_w,
					dt_registro_w,
					coalesce(IE_TIPO_EVOLUCAO_w,1),
					cd_pessoa_fisica_w,
					clock_timestamp(),
					clock_timestamp(),
					nm_usuario_p,
					nm_usuario_p,
					nr_atendimento_w,
					ds_evolucao_w,					
					null,
					ie_evolucao_clinica_w,
					cd_profissional_w,
					'A');
	
	CALL liberar_evolucao(cd_evolucao_w,nm_usuario_p);
	
	commit;
	
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_evolucao_triagem_obste ( nr_sequencia_p bigint, nm_usuario_p text) FROM PUBLIC;

