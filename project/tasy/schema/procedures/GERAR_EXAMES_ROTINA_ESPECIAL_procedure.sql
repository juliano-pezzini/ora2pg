-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_exames_rotina_especial ( nm_usuario_p text, cd_perfil_p bigint, cd_medico_p text, cd_setor_atendimento_p bigint, cd_estabelecimento_p bigint, ie_consiste_convenio_p text, cd_classif_setor_pac_p bigint, ie_clinica_p bigint, cd_setor_prescr_p bigint, ie_tipo_atendimento_p bigint, cd_convenio_p bigint, ie_sem_grupo_p text, ie_so_convenio_p text, cd_categoria_p bigint, ie_origem_proced_p bigint, ie_tipo_convenio_p bigint, varie_tipo_p text, ie_maiuscula_p text, ie_pasta_p bigint, ie_restringe_estab_p text, qt_reg_coluna_p bigint, ie_todos_p text, ie_ordem_seq_p text, ie_tabela_interna_p text, ie_tipo_p text ) AS $body$
DECLARE


nr_sequencia_w					bigint;
nr_seq_grupo_w					bigint;
nr_seq_grupo_ww					bigint := 1;
nr_seq_grupo_www				bigint;
qt_registro_w					bigint := 0;
nr_seq_coluna_w					bigint := 1;
ds_grupo_w						varchar(60);
nr_seq_apresentacao_w			bigint;
ie_tipo_w						bigint;
nr_seq_ordem_w 					bigint;
ie_exige_justificativa_w		varchar(1);
nr_sequencia_ww					bigint;
nr_seq_proc_rotina_w			bigint;
ds_prescricao_w 				varchar(255);
cd_grupo_proc_w 				bigint;
ie_rotina_uti_w 				varchar(1);
ie_exige_lado_w 				varchar(1);
ie_ctrl_glic_w 					varchar(3);
ie_topografia_w 				varchar(1);
cd_especialidade_w 				bigint;
nr_seq_apres_w 					integer;
ds_cor_w 						varchar(15);
ds_cor_grupo_w 					varchar(15);
cd_intervalo_w 					varchar(7);
nr_seq_material_w 				bigint;
ie_frase_w 						varchar(1);
ie_setor_w 						varchar(1);
ds_inf_adicional_w 				varchar(2000);
ie_exige_indicacao_w 			varchar(1);
ie_orientacao_w 				varchar(1);
ie_observacao_w 				varchar(1);
ie_intervalo_w 					varchar(1);
ie_exige_condicao_w 			varchar(1);
nr_seq_prot_glic_w 				bigint;
ie_medico_exec_w 				varchar(1);
ie_questionar_forma_w 			varchar(1);
ie_outro_exame_w 				varchar(1);
ie_contraste_w 					varchar(1);
ie_questionar_resumo_w 			varchar(1);
ie_tela_unica_w 				varchar(1);
ie_tipo_apresent_w				varchar(1);
ie_tipo_apresent_grupo_w		varchar(1);
ie_quest_agora_w				varchar(1);
ds_ordem_w						varchar(2000);
ie_cursor_w						varchar(1);
cd_setor_atendimento_w			integer;
cd_chave_w						bigint;
nr_proc_interno_w				bigint;
cd_protocolo_w					bigint;
nr_seq_subtipo_w				bigint;
nr_seq_proc_w					bigint;

c01 CURSOR FOR
SELECT	distinct coalesce(a.nr_seq_grupo,coalesce(v.nr_seq_grupo,0)) nr_seq_grupo,
		coalesce(obter_desc_grupo_rotina(coalesce(a.nr_seq_grupo,coalesce(v.nr_seq_grupo,0))),obter_desc_expressao(342888)/*'Sem Grupo'*/
) ds_grupo,
		obter_seq_apres_grupo(coalesce(a.nr_seq_grupo,coalesce(v.nr_seq_grupo,0)), 9999) nr_seq_apresentacao,
		obter_cor_grupo(coalesce(a.nr_seq_grupo,coalesce(v.nr_seq_grupo,0))) ds_cor,
		'L' ie_tipo_apresent
FROM exame_laboratorio c, exame_lab_rotina a
LEFT OUTER JOIN exame_rotina_grupo v ON (a.nr_sequencia = v.nr_seq_rotina)
WHERE a.nr_seq_exame  = c.nr_seq_exame  and coalesce(c.ie_situacao,'A') = 'A' and coalesce(a.ie_situacao,'A') = 'A' and ((coalesce(a.cd_especialidade::text, '') = '') or (a.cd_especialidade in (	select	cd_especialidade
									from	medico_especialidade
									where	cd_pessoa_fisica = cd_medico_p))) and coalesce(a.cd_classif_setor_pac::text, '') = '' and Obter_se_exibe_grupo(coalesce(a.nr_seq_grupo,coalesce(v.nr_seq_grupo,0)), cd_perfil_p, cd_setor_atendimento_p) = 'S' and ((a.cd_perfil_excl <> cd_perfil_p) or (coalesce(a.cd_perfil_excl::text, '') = '')) and ((ie_tipo_atendimento_p = 0) or ((a.ie_tipo_atendimento = ie_tipo_atendimento_p) or (coalesce(a.ie_tipo_atendimento::text, '') = ''))) and lab_obter_se_exame_lib(c.nr_seq_exame,cd_estabelecimento_p) = 'S' and ((ie_consiste_convenio_p = 'N') or (obter_se_exame_rotina(cd_medico_p, ie_tipo_atendimento_p,cd_setor_atendimento_p,cd_classif_setor_pac_p,ie_clinica_p,cd_setor_prescr_p,a.nr_sequencia,cd_perfil_p,cd_estabelecimento_p,cd_convenio_p) = 'S')) and coalesce(a.nr_seq_rotina::text, '') = '' and ((cd_setor_prescr_p = 0) or ((a.cd_setor_prescr = cd_setor_prescr_p) or (coalesce(a.cd_setor_prescr::text, '') = ''))) and ((ie_so_convenio_p = 'N') or (obter_se_exame_convenio(cd_estabelecimento_p,c.nr_seq_exame,c.cd_procedimento,c.ie_origem_proced,ie_tipo_atendimento_p,coalesce(cd_convenio_p,0),coalesce(cd_categoria_p,0),clock_timestamp()) = 'S')) and ((ie_sem_grupo_p = 'S') or ((coalesce(a.nr_seq_grupo,v.nr_seq_grupo) IS NOT NULL AND (coalesce(a.nr_seq_grupo,v.nr_seq_grupo))::text <> ''))) and ((ie_clinica_p = 0) or ((a.ie_clinica = ie_clinica_p) or (coalesce(a.ie_clinica::text, '') = ''))) and ((cd_convenio_p = 0) or ((a.cd_convenio = cd_convenio_p) or (coalesce(a.cd_convenio::text, '') = ''))) and ((coalesce(a.cd_estabelecimento::text, '') = '') or (a.cd_estabelecimento = cd_estabelecimento_p)) and ((a.cd_perfil = cd_perfil_p) or (coalesce(a.cd_perfil::text, '') = '')) and obter_se_exame_lib_medico(cd_medico_p, a.nr_sequencia, null) = 'S'

union

select	distinct coalesce(a.nr_seq_grupo,coalesce(v.nr_seq_grupo,0)) nr_seq_grupo,
		coalesce(obter_desc_grupo_rotina(coalesce(a.nr_seq_grupo,coalesce(v.nr_seq_grupo,0))),obter_desc_expressao(342888)/*'Sem Grupo'*/
) ds_grupo,
		obter_seq_apres_grupo(coalesce(a.nr_seq_grupo,coalesce(v.nr_seq_grupo,0)), 9999) nr_seq_apresentacao,
		obter_cor_grupo(coalesce(a.nr_seq_grupo,coalesce(v.nr_seq_grupo,0))) ds_cor,
		CASE WHEN substr(obter_ctrl_glic_proc(a.nr_proc_interno),1,3)='NC' THEN  'P'  ELSE 'C' END  ie_tipo_apresent
FROM procedimento y, estrutura_procedimento_v x, procedimento_rotina a
LEFT OUTER JOIN procedimento_rotina_grupo v ON (a.nr_sequencia = v.nr_seq_procedimento)
WHERE a.cd_procedimento	= x.cd_procedimento  and a.ie_origem_proced	= x.ie_origem_proced and a.cd_procedimento	= y.cd_procedimento and a.ie_origem_proced	= y.ie_origem_proced and coalesce(y.ie_situacao,'A') = 'A' and ((ie_tipo_atendimento_p = 0) or ((a.ie_origem_proced = ie_origem_proced_p) or (a.nr_proc_interno IS NOT NULL AND a.nr_proc_interno::text <> '') or (y.ie_ignora_origem = 'S'))) and ((ie_tipo_atendimento_p = 0) or ((a.ie_tipo_atendimento = ie_tipo_atendimento_p) or (coalesce(a.ie_tipo_atendimento::text, '') = ''))) and ((cd_convenio_p = 0) or ((a.cd_convenio = cd_convenio_p) or (coalesce(a.cd_convenio::text, '') = ''))) and ((ie_clinica_p = 0) or ((a.ie_clinica = ie_clinica_p) or (coalesce(a.ie_clinica::text, '') = ''))) and ((cd_setor_prescr_p = 0) or ((a.cd_setor_prescr = cd_setor_prescr_p) or (coalesce(a.cd_setor_prescr::text, '') = ''))) and ((ie_sem_grupo_p = 'S') or ((coalesce(a.nr_seq_grupo,v.nr_seq_grupo) IS NOT NULL AND (coalesce(a.nr_seq_grupo,v.nr_seq_grupo))::text <> ''))) and obter_se_exibe_grupo(coalesce(a.nr_seq_grupo,coalesce(v.nr_seq_grupo,0)), cd_perfil_p, cd_setor_atendimento_p) = 'S' and obter_se_proc_rotina(cd_medico_p,ie_tipo_atendimento_p,cd_setor_atendimento_p,cd_classif_setor_pac_p,ie_clinica_p,cd_setor_prescr_p,cd_convenio_p,a.nr_sequencia,cd_estabelecimento_p, cd_perfil_p, ie_tipo_convenio_p) = 'S' and obter_se_proc_interno_ativo(a.nr_proc_interno) = 'A' and ((a.cd_perfil_excl <> cd_perfil_p) or (coalesce(a.cd_perfil_excl::text, '') = '')) and coalesce(a.cd_classif_setor_pac::text, '') = '' and obter_se_exame_lib_medico(cd_medico_p, null, a.nr_sequencia) = 'S' and coalesce(a.nr_seq_grupo_rotina::text, '') = '' and coalesce(a.nr_seq_rotina::text, '') = '' and coalesce(a.nr_proc_interno::text, '') = '' and ((coalesce(a.cd_estabelecimento::text, '') = '') or (a.cd_estabelecimento = cd_estabelecimento_p)) and ((a.cd_perfil = cd_perfil_p) or (coalesce(a.cd_perfil::text, '') = '')) and ((coalesce(a.cd_especialidade::text, '') = '') or (a.cd_especialidade in (	select	cd_especialidade
									from		medico_especialidade
									where	cd_pessoa_fisica = cd_medico_p)))
 
union

select	distinct coalesce(a.nr_seq_grupo,coalesce(v.nr_seq_grupo,0)) nr_seq_grupo,
		coalesce(obter_desc_grupo_rotina(coalesce(a.nr_seq_grupo,coalesce(v.nr_seq_grupo,0))),obter_desc_expressao(342888)/*'Sem Grupo'*/
) ds_grupo,
		obter_seq_apres_grupo(coalesce(a.nr_seq_grupo,coalesce(v.nr_seq_grupo,0)), 9999) nr_seq_apresentacao,
		obter_cor_grupo(coalesce(a.nr_seq_grupo,coalesce(v.nr_seq_grupo,0))) ds_cor,
		CASE WHEN substr(obter_ctrl_glic_proc(a.nr_proc_interno),1,3)='NC' THEN  'P'  ELSE 'C' END  ie_tipo_apresent
FROM procedimento_rotina a
LEFT OUTER JOIN procedimento_rotina_grupo v ON (a.nr_sequencia = v.nr_seq_procedimento)
WHERE coalesce(a.cd_classif_setor_pac::text, '') = '' and coalesce(a.nr_seq_rotina::text, '') = '' and (a.nr_proc_interno IS NOT NULL AND a.nr_proc_interno::text <> '') and ((a.cd_perfil_excl <> cd_perfil_p) or (coalesce(a.cd_perfil_excl::text, '') = '')) and ((coalesce(a.cd_estabelecimento::text, '') = '') or (a.cd_estabelecimento = cd_estabelecimento_p)) and ((ie_tipo_atendimento_p = 0) or ((a.ie_tipo_atendimento = ie_tipo_atendimento_p) or (coalesce(a.ie_tipo_atendimento::text, '') = ''))) and ((ie_clinica_p = 0) or ((a.ie_clinica = ie_clinica_p) or (coalesce(a.ie_clinica::text, '') = ''))) and ((cd_setor_prescr_p = 0) or ((a.cd_setor_prescr = cd_setor_prescr_p) or (coalesce(a.cd_setor_prescr::text, '') = ''))) and ((cd_convenio_p = 0) or ((a.cd_convenio = cd_convenio_p) or (coalesce(a.cd_convenio::text, '') = ''))) and ((ie_sem_grupo_p = 'S') or ((coalesce(a.nr_seq_grupo,v.nr_seq_grupo) IS NOT NULL AND (coalesce(a.nr_seq_grupo,v.nr_seq_grupo))::text <> ''))) and obter_se_exibe_grupo(coalesce(a.nr_seq_grupo,coalesce(v.nr_seq_grupo,0)), cd_perfil_p, cd_setor_atendimento_p) = 'S' and ((a.cd_perfil = cd_perfil_p) or (coalesce(a.cd_perfil::text, '') = '')) and obter_se_exame_lib_medico(cd_medico_p, null, a.nr_sequencia) = 'S' and coalesce(a.nr_seq_grupo_rotina::text, '') = '' and Obter_se_proc_interno_ativo(a.nr_proc_interno) = 'A' and obter_se_proc_rotina(cd_medico_p,ie_tipo_atendimento_p,cd_setor_atendimento_p,cd_classif_setor_pac_p,ie_clinica_p,cd_setor_prescr_p,cd_convenio_p,a.nr_sequencia,cd_estabelecimento_p, cd_perfil_p, ie_tipo_convenio_p) = 'S' and ((coalesce(a.cd_especialidade::text, '') = '') or (a.cd_especialidade in (	select	b.cd_especialidade
									from		medico_especialidade b
									where	b.cd_pessoa_fisica = cd_medico_p))) order by	nr_seq_apresentacao;

c02 CURSOR FOR
SELECT	distinct 0 ie_tipo,
		CASE WHEN varie_tipo_p='S' THEN 0  ELSE 1 END  nr_seq_ordem,
		coalesce(a.ie_exige_justificativa,'N') ie_exige_justificativa,
		min(a.nr_sequencia) nr_sequencia,
		CASE WHEN ie_maiuscula_p='N' THEN a.ds_prescricao  ELSE initcap(a.ds_prescricao) END  ds_prescricao,
		0 cd_grupo_proc,
		a.ie_rotina_uti,
		a.ie_lado,
		'NC' ie_ctrl_glic,
        coalesce(c.ie_topografia,'N') ie_topografia,
		0 cd_especialidade,
		a.nr_seq_apres,
		a.ds_cor,
		a.cd_intervalo,
		a.nr_seq_material,
		coalesce(a.ie_frase,'N') ie_frase,
		'N' ie_setor,
		obter_inf_exame_rotina(a.nr_seq_rotina) ds_inf_adicional,
		coalesce(a.ie_exige_indicacao,'N') ie_indicacao,
		coalesce(a.ie_orientacao,'N') ie_orientacao,
		coalesce(a.ie_observacao,'N') ie_observacao,
		a.ie_intervalo,
        'N' ie_exige_condicao,
		null nr_seq_prot_glic,
		coalesce(a.ie_medico_exec,'N') ie_medico_exec,
		coalesce(a.ie_questionar_forma,'N') ie_questionar_forma,
		coalesce(a.ie_outro_exame,'N') ie_outro_exame,
		'N' ie_contraste,
		'N' ie_questionar_resumo,
		'N' ie_tela_unica,
		'L' ie_tipo_apresent
FROM exame_laboratorio c, exame_lab_rotina a
LEFT OUTER JOIN exame_rotina_grupo v ON (a.nr_sequencia = v.nr_seq_rotina)
WHERE a.nr_seq_exame  = c.nr_seq_exame  and coalesce(c.ie_situacao,'A') = 'A' and coalesce(a.ie_situacao,'A') = 'A' and ((coalesce(a.cd_especialidade::text, '') = '') or (a.cd_especialidade in (	select 	cd_especialidade
									from 	medico_especialidade
									where cd_pessoa_fisica = cd_medico_p))) and coalesce(a.cd_classif_setor_pac::text, '') = '' and coalesce(v.nr_seq_grupo,coalesce(a.nr_seq_grupo,0)) = nr_seq_grupo_w and ((a.cd_perfil_excl <> cd_perfil_p) or (coalesce(a.cd_perfil_excl::text, '') = '')) and lab_obter_se_exame_lib(c.nr_seq_exame,cd_estabelecimento_p) = 'S' and ((ie_sem_grupo_p = 'S') or ((coalesce(v.nr_seq_grupo,a.nr_seq_grupo) IS NOT NULL AND (coalesce(v.nr_seq_grupo,a.nr_seq_grupo))::text <> ''))) and ((ie_clinica_p = 0) or ((a.ie_clinica = ie_clinica_p) or (coalesce(a.ie_clinica::text, '') = ''))) and ((ie_so_convenio_p = 'N') or (obter_se_exame_convenio(cd_estabelecimento_p,c.nr_seq_exame,c.cd_procedimento,c.ie_origem_proced,ie_tipo_atendimento_p,coalesce(cd_convenio_p,0),coalesce(cd_categoria_p,0),clock_timestamp()) = 'S')) and ((ie_tipo_atendimento_p = 0) or((a.ie_tipo_atendimento = ie_tipo_atendimento_p) or (coalesce(a.ie_tipo_atendimento::text, '') = ''))) and ((cd_setor_prescr_p = 0) or ((a.cd_setor_prescr = cd_setor_prescr_p) or (coalesce(a.cd_setor_prescr::text, '') = ''))) and ((ie_consiste_convenio_p = 'N') or (obter_se_exame_rotina(cd_medico_p, ie_tipo_atendimento_p,cd_setor_atendimento_p,cd_classif_setor_pac_p,ie_clinica_p,cd_setor_prescr_p,a.nr_sequencia,cd_perfil_p,cd_estabelecimento_p,cd_convenio_p) = 'S')) and coalesce(a.nr_seq_rotina::text, '') = '' and ((cd_convenio_p = 0) or ((a.cd_convenio = cd_convenio_p) or (coalesce(a.cd_convenio::text, '') = ''))) and (coalesce(a.cd_estabelecimento::text, '') = '' or a.cd_estabelecimento = cd_estabelecimento_p) and ((a.cd_perfil = cd_perfil_p) or (coalesce(a.cd_perfil::text, '') = '')) and obter_se_exame_lib_medico(cd_medico_p, a.nr_sequencia, null) = 'S' and coalesce(ie_tipo_apresent_grupo_w,'L') = 'L' group by
		a.ds_prescricao,
		a.ie_rotina_uti,
		initcap(a.ds_prescricao),
		a.ie_lado,
		'NC',
		'N',
		a.nr_seq_apres,
		a.ds_cor,
		a.cd_intervalo,
		a.nr_seq_material,
		a.ie_frase,
		obter_inf_exame_rotina(a.nr_seq_rotina),
		coalesce(a.ie_exige_indicacao,'N'),
		coalesce(c.ie_topografia,'N'),
		coalesce(a.ie_exige_justificativa,'N'),
		coalesce(a.ie_orientacao,'N'),
		coalesce(a.ie_observacao,'N'),
		a.ie_intervalo,
		coalesce(a.ie_medico_exec,'N'),
		coalesce(a.ie_questionar_forma,'N'),
		coalesce(a.ie_outro_exame,'N'),
		'L'

union all

select	distinct 1 ie_tipo,
		CASE WHEN varie_tipo_p='S' THEN 1  ELSE 0 END  nr_seq_ordem,
		coalesce(a.ie_exige_justificativa,'N') ie_exige_justificativa,
		min(a.nr_sequencia),
		CASE WHEN ie_maiuscula_p='N' THEN coalesce(a.ds_reduzida, a.ds_prescricao)  ELSE initcap(coalesce(a.ds_reduzida, a.ds_prescricao)) END  ds_prescricao,
		x.cd_grupo_proc,
        a.ie_rotina_uti,
		a.ie_lado,
		substr(obter_ctrl_glic_proc(a.nr_proc_interno),1,3) ie_ctrl_glic,
		CASE WHEN coalesce(a.ie_topografia,'N')='S' THEN 'S'  ELSE substr(obter_regra_topog_proc_int(a.nr_proc_interno),1,1) END  ie_topografia,
		max(x.cd_especialidade) cd_especialidade,
		a.nr_seq_apres,
		a.ds_cor,
		a.cd_intervalo,
		0 nr_seq_material,
		coalesce(ie_frase,'N') ie_frase,
		coalesce(a.ie_setor,'N') ie_setor,
        obter_inf_exame_rotina(a.nr_seq_rotina) ds_inf_adicional,
		coalesce(a.ie_exige_indicacao,'N'),
		'N' ie_orientacao,
		coalesce(a.ie_observacao,'N') ie_observacao,
        a.ie_intervalo,
		coalesce(a.ie_exige_condicao, 'N') ie_exige_condicao,
		obter_dados_proc_interno(a.nr_proc_interno,'G'),
		coalesce(a.ie_medico_exec,'N') ie_medico_exec,
		coalesce(a.ie_questionar_forma,'N') ie_questionar_forma,
		coalesce(a.ie_outro_exame,'N') ie_outro_exame,
		coalesce(a.ie_contraste,'N') ie_contraste,
		coalesce(a.ie_questionar_resumo,'N'),
		coalesce(a.ie_tela_unica,'N') ie_tela_unica,
		CASE WHEN substr(obter_ctrl_glic_proc(a.nr_proc_interno),1,3)='NC' THEN  'P'  ELSE 'C' END  ie_tipo_apresent
FROM procedimento y, estrutura_procedimento_v x, procedimento_rotina a
LEFT OUTER JOIN procedimento_rotina_grupo v ON (a.nr_sequencia = v.nr_seq_procedimento)
WHERE a.cd_procedimento	= x.cd_procedimento  and a.ie_origem_proced	= x.ie_origem_proced and a.cd_procedimento	= y.cd_procedimento and a.ie_origem_proced	= y.ie_origem_proced and coalesce(y.ie_situacao,'A') = 'A' and coalesce(v.nr_seq_grupo,coalesce(a.nr_seq_grupo,0)) = nr_seq_grupo_w and ((ie_sem_grupo_p = 'S') or ((coalesce(v.nr_seq_grupo,a.nr_seq_grupo) IS NOT NULL AND (coalesce(v.nr_seq_grupo,a.nr_seq_grupo))::text <> ''))) and ((ie_tipo_atendimento_p = 0) or ((a.ie_origem_proced = ie_origem_proced_p) or (a.nr_proc_interno IS NOT NULL AND a.nr_proc_interno::text <> '') or (y.ie_ignora_origem = 'S'))) and ((ie_tipo_atendimento_p = 0) or ((a.ie_tipo_atendimento = ie_tipo_atendimento) or (coalesce(a.ie_tipo_atendimento::text, '') = ''))) and obter_se_proc_rotina(cd_medico_p,ie_tipo_atendimento_p,cd_setor_atendimento_p,cd_classif_setor_pac_p,ie_clinica_p,cd_setor_prescr_p,cd_convenio_p,a.nr_sequencia,cd_estabelecimento_p,cd_perfil_p,ie_tipo_convenio_p) = 'S' and obter_se_proc_interno_ativo(a.nr_proc_interno) = 'A' and ((ie_clinica_p = 0) or ((a.ie_clinica = ie_clinica_p) or (coalesce(a.ie_clinica::text, '') = ''))) and ((cd_setor_prescr_p = 0) or ((a.cd_setor_prescr = cd_setor_prescr_p) or (coalesce(a.cd_setor_prescr::text, '') = ''))) and ((a.cd_perfil_excl <> cd_perfil_p) or (coalesce(a.cd_perfil_excl::text, '') = '')) and coalesce(a.cd_classif_setor_pac::text, '') = '' and obter_se_exame_lib_medico(cd_medico_p, null, a.nr_sequencia) = 'S' and coalesce(a.nr_seq_grupo_rotina::text, '') = '' and coalesce(a.nr_seq_rotina::text, '') = '' and ((cd_convenio_p = 0) or ((a.cd_convenio = cd_convenio_p) or (coalesce(a.cd_convenio::text, '') = ''))) and coalesce(a.nr_proc_interno::text, '') = '' and ((coalesce(a.cd_estabelecimento::text, '') = '') or (a.cd_estabelecimento = cd_estabelecimento_p)) and ((a.cd_perfil = cd_perfil_p) or (coalesce(a.cd_perfil::text, '') = '')) and ((coalesce(a.cd_especialidade::text, '') = '') or (a.cd_especialidade in (	select	cd_especialidade
									from	medico_especialidade
									where	cd_pessoa_fisica = cd_medico_p))) and coalesce(ie_tipo_apresent_grupo_w,'P') = 'P' group by
		coalesce(a.ds_reduzida, a.ds_prescricao),
		x.cd_grupo_proc,
		obter_dados_proc_interno(a.nr_proc_interno,'G'),
		coalesce(a.ie_exige_justificativa,'N'),
		initcap(coalesce(a.ds_reduzida, a.ds_prescricao)),
		a.ie_rotina_uti,
		a.ie_lado,
		substr(obter_ctrl_glic_proc(a.nr_proc_interno),1,3),
		CASE WHEN coalesce(a.ie_topografia,'N')='S' THEN 'S'  ELSE substr(obter_regra_topog_proc_int(a.nr_proc_interno),1,1) END ,
		a.nr_seq_apres,
		a.ds_cor,
		a.cd_intervalo,
		ie_frase,
		coalesce(a.ie_setor,'N'),
		obter_inf_exame_rotina(a.nr_seq_rotina),
		coalesce(a.ie_exige_indicacao,'N'),
		coalesce(a.IE_EXIGE_CONDICAO, 'N'),
		coalesce(a.ie_observacao,'N'),
		a.ie_intervalo,
		coalesce(a.ie_medico_exec,'N'),
		coalesce(a.ie_questionar_forma,'N'),
		coalesce(a.ie_outro_exame,'N'),
		coalesce(a.ie_contraste,'N'),
		coalesce(a.ie_questionar_resumo,'N'),
		coalesce(a.ie_tela_unica,'N'),
		'P'

union all

select	distinct 1 ie_tipo,
		CASE WHEN varie_tipo_p='S' THEN 1  ELSE 0 END  nr_seq_ordem,
		coalesce(a.ie_exige_justificativa,'N') ie_exige_justificativa,
		min(a.nr_sequencia),
		CASE WHEN ie_maiuscula_p='N' THEN coalesce(a.ds_reduzida, a.ds_prescricao)  ELSE initcap(coalesce(a.ds_reduzida, a.ds_prescricao)) END  ds_prescricao,
		0 cd_grupo_proc,
		a.ie_rotina_uti,
		a.ie_lado,
        substr(obter_ctrl_glic_proc(a.nr_proc_interno),1,3) ie_ctrl_glic,
		CASE WHEN coalesce(a.ie_topografia,'N')='S' THEN 'S'  ELSE substr(obter_regra_topog_proc_int(a.nr_proc_interno),1,1) END  ie_topografia,
		0 cd_especialidade,
		a.nr_seq_apres,
		a.ds_cor,
		a.cd_intervalo,
		0 nr_seq_material,
		coalesce(ie_frase,'N') ie_frase,
		coalesce(a.ie_setor,'N') ie_setor,
		obter_inf_exame_rotina(a.nr_seq_rotina) ds_inf_adicional,
        coalesce(a.ie_exige_indicacao,'N'),
		'N' ie_orientacao,
		coalesce(a.ie_observacao,'N') ie_observacao,
		a.ie_intervalo,
		coalesce(a.ie_exige_condicao, 'N') ie_exige_condicao,
        obter_dados_proc_interno(a.nr_proc_interno,'G'),
		coalesce(a.ie_medico_exec,'N') ie_medico_exec,
		coalesce(a.ie_questionar_forma,'N') ie_questionar_forma,
		coalesce(a.ie_outro_exame,'N') ie_outro_exame,
		coalesce(a.ie_contraste,'N') ie_contraste,
		coalesce(a.ie_questionar_resumo,'N'),
		coalesce(a.ie_tela_unica,'N') ie_tela_unica,
		CASE WHEN substr(obter_ctrl_glic_proc(a.nr_proc_interno),1,3)='NC' THEN  'P'  ELSE 'C' END  ie_tipo_apresent
FROM procedimento_rotina a
LEFT OUTER JOIN procedimento_rotina_grupo v ON (a.nr_sequencia = v.nr_seq_procedimento)
WHERE coalesce(a.cd_classif_setor_pac::text, '') = '' and coalesce(a.nr_seq_rotina::text, '') = '' and (a.nr_proc_interno IS NOT NULL AND a.nr_proc_interno::text <> '') and ((a.cd_perfil_excl <> cd_perfil_p) or (coalesce(a.cd_perfil_excl::text, '') = '')) and ((ie_sem_grupo_p = 'S') or ((coalesce(v.nr_seq_grupo,a.nr_seq_grupo) IS NOT NULL AND (coalesce(v.nr_seq_grupo,a.nr_seq_grupo))::text <> ''))) and ((ie_tipo_atendimento_p = 0) or ((a.ie_tipo_atendimento = ie_tipo_atendimento_p) or (coalesce(a.ie_tipo_atendimento::text, '') = ''))) and ((coalesce(a.cd_estabelecimento::text, '') = '') or (a.cd_estabelecimento = cd_estabelecimento_p)) and coalesce(v.nr_seq_grupo,coalesce(a.nr_seq_grupo,0)) = nr_seq_grupo_w and ((a.cd_perfil = cd_perfil_p) or (coalesce(a.cd_perfil::text, '') = '')) and obter_se_exame_lib_medico(cd_medico_p, null, a.nr_sequencia) = 'S' and coalesce(a.nr_seq_grupo_rotina::text, '') = '' and ((ie_clinica_p = 0) or ((a.ie_clinica = ie_clinica_p) or (coalesce(a.ie_clinica::text, '') = ''))) and ((cd_setor_prescr_p = 0) or ((a.cd_setor_prescr = cd_setor_prescr_p) or (coalesce(a.cd_setor_prescr::text, '') = ''))) and ((cd_convenio_p = 0) or ((a.cd_convenio = cd_convenio_p) or (coalesce(a.cd_convenio::text, '') = ''))) and obter_se_proc_interno_ativo(a.nr_proc_interno) = 'A' and obter_se_proc_rotina(cd_medico_p,ie_tipo_atendimento_p,cd_setor_atendimento_p,cd_classif_setor_pac_p,ie_clinica_p,cd_setor_prescr_p,cd_convenio_p,a.nr_sequencia,cd_estabelecimento_p,cd_perfil_p,ie_tipo_convenio_p) = 'S' and ((coalesce(a.cd_especialidade::text, '') = '') or (a.cd_especialidade in (	select	b.cd_especialidade
									from		medico_especialidade b
									where	b.cd_pessoa_fisica = cd_medico_p))) and coalesce(ie_tipo_apresent_grupo_w,'P') = 'P' GROUP BY
		coalesce(a.ds_reduzida, a.ds_prescricao),
        0,
        obter_dados_proc_interno(a.nr_proc_interno,'G'),
        a.ie_rotina_uti,
        coalesce(a.ie_exige_justificativa,'N'),
        a.ie_lado,
        initcap(coalesce(a.ds_reduzida, a.ds_prescricao)),
        substr(obter_ctrl_glic_proc(a.nr_proc_interno),1,3),
        CASE WHEN coalesce(a.ie_topografia,'N')='S' THEN 'S'  ELSE substr(obter_regra_topog_proc_int(a.nr_proc_interno),1,1) END ,
        a.nr_seq_apres,
        a.ds_cor,
        a.cd_intervalo,
        ie_frase,
        coalesce(a.ie_setor,'N'),
        obter_inf_exame_rotina(a.nr_seq_rotina),
        coalesce(a.ie_exige_indicacao,'N'),
        coalesce(a.IE_EXIGE_CONDICAO, 'N'),
        coalesce(a.ie_observacao,'N'),
        a.ie_intervalo,
        coalesce(a.ie_medico_exec,'N'),
        coalesce(a.ie_questionar_forma,'N'),
        coalesce(a.ie_outro_exame,'N'),
        coalesce(a.ie_contraste,'N'), coalesce(a.IE_QUESTIONAR_RESUMO,'N'),
        coalesce(a.ie_tela_unica,'N'),
		'P'
ORDER BY
        nr_seq_apres,
        nr_seq_ordem,
        ie_tipo,
        cd_especialidade,
        ds_prescricao;

c03 CURSOR FOR
SELECT	distinct nr_seq_grupo,
		ie_tipo_apresent
from	w_proc_rotina_esp_t
where	nm_usuario = nm_usuario_p
and		ie_pasta = ie_pasta_p
order	by nr_seq_grupo;

c04 CURSOR FOR
SELECT  distinct coalesce(a.nr_seq_grupo,0) nr_seq_grupo,
		obter_desc_grupo_rotina_exame(coalesce(a.nr_seq_grupo,0)) ds_grupo
from    rotina_exame a
where   ((ie_restringe_estab_p  = 'N') or (a.cd_estabelecimento = cd_estabelecimento_p))
and   	substr(obter_se_exibe_rotina(a.nr_sequencia, cd_medico_p, cd_estabelecimento_p, Obter_Agrupamento_Setor(cd_setor_prescr_p), cd_setor_prescr_p), 1, 1) = 'S'
and     ((a.nr_seq_grupo IS NOT NULL AND a.nr_seq_grupo::text <> '') or (ie_sem_grupo_p = 'S'))
group by
        a.nr_seq_grupo
order by
        nr_seq_grupo;

c05 CURSOR FOR
SELECT  distinct a.nr_sequencia,
        CASE WHEN ie_maiuscula_p='N' THEN a.ds_rotina  ELSE initcap(a.ds_rotina) END  ds_prescricao,
        4 ie_tipo,
        'N' ie_rotina_uti,
		'N' ie_lado,
		'N' ie_ctrl_glic,
		'N' ie_topografia,
        a.nr_seq_apres,
        a.ds_cor,
		'N' ie_frase,
		'N' ie_setor,
		Obter_Inf_Exame_Rotina(a.nr_sequencia) ds_inf_adicional,
		'N' ie_indicacao,
		'N' ie_orientacao,
		'N' ie_observacao,
		obter_se_quest_interv(a.nr_sequencia) ie_intervalo,
		'N' ie_exige_condicao,
		'0' nr_seq_prot_glic,
		coalesce(a.ie_questiona_agora,'N') ie_quest_urgencia,
		'N' ie_questionar_forma,
		'N' ie_outro_exame,
		'N' ie_contraste,
		'N' ie_questionar_resumo,
		'N' ie_tela_unica
from    rotina_exame a
where   ((ie_restringe_estab_p  = 'N') OR (a.cd_estabelecimento = cd_estabelecimento_p))
and   	substr(obter_se_exibe_rotina(a.nr_sequencia, cd_medico_p, cd_estabelecimento_p, Obter_Agrupamento_Setor(cd_setor_prescr_p), cd_setor_prescr_p), 1, 1) = 'S'
and		coalesce(a.nr_seq_grupo,0) = nr_seq_grupo_w
and     ((a.nr_seq_grupo IS NOT NULL AND a.nr_seq_grupo::text <> '') or (ie_sem_grupo_p = 'S'))
group by
        a.nr_seq_apres,
        a.nr_sequencia,
        a.ds_rotina,
        a.ie_questiona_agora,
		a.ds_cor
order by
	    a.nr_seq_apres,
        ds_prescricao;

c06 CURSOR FOR
SELECT	a.nr_sequencia,
		coalesce(a.ds_grupo_prescricao,a.ds_grupo_exame_lab) ds_grupo_exame_lab,
		a.nr_seq_apresent
from	grupo_exame_lab a
where	0 < (	select	count(*)
				from	exame_laboratorio b
				where	b.nr_seq_grupo = a.nr_sequencia
				and		lab_obter_se_exame_lib(b.nr_seq_exame,cd_estabelecimento_p) = 'S'
				and		b.ie_solicitacao = 'S')
and      coalesce(a.ie_exibe_rep,'S')   = 'S'
and     ie_todos_p <> 'T'

union

select	0,
		obter_desc_expressao(315071)/*'Todos'*/
 ds_grupo_exame_lab,
		null nr_seq_apresent

where	ie_todos_p in ('S','T')
order by
		nr_seq_apresent,
		ds_grupo_exame_lab;

c07 CURSOR FOR
SELECT	nr_seq_exame nr_sequencia,
		CASE WHEN ie_maiuscula_p='N' THEN coalesce(ds_exame_prescricao,nm_exame)  ELSE initcap(coalesce(ds_exame_prescricao,nm_exame)) END  ds_prescricao,
	    'N' ie_rotina_uti,
		'N' ie_lado,
		'NC' ie_ctrl_glic,
		coalesce(ie_topografia,'N') ie_topografia,
		2 ie_tipo,
		'N' ie_frase,
		'N' ie_setor,
		'N' ie_indicacao,
		coalesce(ie_orientacao,'N') ie_orientacao,
		'N' ie_observacao,
		coalesce(ie_questionar_interv,'N') ie_intervalo,
		ds_cor,
		'N' ie_exige_condicao,
		'0' nr_seq_prot_glic,
		CASE WHEN ie_ordem_seq_p='N' THEN CASE WHEN ie_maiuscula_p='N' THEN coalesce(ds_exame_prescricao,nm_exame)  ELSE initcap(coalesce(ds_exame_prescricao,nm_exame)) END   ELSE nr_seq_apresent END  ds_order,
		coalesce(ie_exige_justificativa,'N') ie_exige_justificativa,
		'N' ie_questionar_forma,
		'N' ie_outro_exame ,
		'N' ie_contraste,
		'N' ie_questionar_resumo,
		'N' ie_tela_unica
from	exame_laboratorio
where	((coalesce(nr_seq_grupo,0) = coalesce(nr_seq_grupo_w,0)) or (coalesce(nr_seq_grupo_w,0) = 0))
and		ie_solicitacao = 'S'
and		coalesce(ie_situacao,'A') = 'A'
and		ie_prescricao_rotina = 'S'
and		lab_obter_se_exame_lib(nr_seq_exame, cd_estabelecimento_p) = 'S'
and		((ie_so_convenio_p = 'N') or (obter_se_exame_convenio(cd_estabelecimento_p,nr_seq_exame,cd_procedimento,ie_origem_proced,ie_tipo_atendimento_p,cd_convenio_p,cd_categoria_p,clock_timestamp()) = 'S'))
order by ds_order;


c08 REFCURSOR;
c09 REFCURSOR;

c10 CURSOR FOR
SELECT	vl_dominio,
		ds_valor_dominio
from	valor_dominio
where	cd_dominio = 1
and		vl_dominio = cd_classif_setor_pac_p
order by
		ds_valor_dominio;

c11 CURSOR FOR
SELECT	distinct 0 ie_tipo,
		min(nr_sequencia) nr_sequencia,
		CASE WHEN ie_maiuscula_p='N' THEN ds_prescricao  ELSE initcap(ds_prescricao) END  ds_prescricao,
		0,
		ie_rotina_uti,
		ie_lado,
		'NC' ie_ctrl_glic,
		'N' ie_topografia,
		0 cd_especialidade,
		nr_seq_apres,
        ds_cor,
		'0'||min(nr_sequencia) cd_chave,
		cd_intervalo,
		coalesce(ie_frase,'N') ie_frase,
		'N' ie_setor,
		coalesce(ie_exige_indicacao,'N') ie_indicacao,
		coalesce(ie_orientacao,'N') ie_orientacao,
		coalesce(ie_observacao,'N') ie_observacao,
		ie_intervalo,
        'N' ie_exige_condicao,
		null nr_seq_prot_glic,
		coalesce(a.ie_questionar_forma,'N') ie_questionar_forma,
		coalesce(a.ie_outro_exame,'N') ie_outro_exame ,
		'N' ie_contraste ,
		coalesce(a.ie_exige_justificativa,'N') ie_exige_justificativa,
		'N' ie_questionar_resumo,
		'N' ie_tela_unica
from	exame_lab_rotina a
where	((cd_classif_setor_pac = cd_classif_setor_pac_p) or (cd_setor_atendimento = cd_setor_atendimento_p))
and		coalesce(a.ie_situacao,'A') = 'A'
and		coalesce(nr_seq_rotina::text, '') = ''
and		((a.cd_perfil_excl <> cd_perfil_p) or (coalesce(a.cd_perfil_excl::text, '') = ''))
and		Obter_se_exame_rotina(cd_especialidade,ie_tipo_atendimento,cd_setor_atendimento,cd_classif_setor_pac,ie_clinica,cd_setor_prescr,nr_sequencia,cd_perfil_p,cd_estabelecimento,cd_convenio_p) = 'S'
and		((coalesce(cd_estabelecimento::text, '') = '') or (cd_estabelecimento = cd_estabelecimento_p))
and		((cd_perfil = cd_perfil_p) or (coalesce(cd_perfil::text, '') = ''))
group by
		ds_prescricao,
		initcap(ds_prescricao),
		ie_rotina_uti,
		ie_lado,
		'NC',
		'N',
		nr_seq_apres,
		ds_cor,
		cd_intervalo,
		ie_frase,
		coalesce(ie_exige_indicacao,'N'),
		coalesce(ie_orientacao,'N'),
		coalesce(ie_observacao,'N'),
		ie_intervalo,
		coalesce(a.ie_questionar_forma,'N'),
		coalesce(a.ie_outro_exame,'N'),
		coalesce(a.ie_exige_justificativa,'N')

union all

select	distinct 1 ie_tipo,
		min(a.nr_sequencia),
		CASE WHEN ie_maiuscula_p='N' THEN a.ds_prescricao  ELSE InitCap(a.ds_prescricao) END  ds_prescricao,
		x.cd_grupo_proc,
		a.ie_rotina_uti,
		a.ie_lado,
		substr(obter_ctrl_glic_proc(a.nr_proc_interno),1,3) ie_ctrl_glic,
		substr(obter_regra_topog_proc_int(a.nr_proc_interno),1,15) ie_topografia,
		max(x.cd_especialidade) cd_especialidade,
		a.nr_seq_apres,
		a.ds_cor,
		'1'||min(a.nr_sequencia) cd_chave,
		a.cd_intervalo,
		coalesce(ie_frase,'N') ie_frase,
		'N' ie_setor,
		coalesce(a.ie_exige_indicacao,'N') ie_indicacao,
		'N' ie_orientacao,
		coalesce(a.ie_observacao,'N') ie_observacao,
		a.ie_intervalo,
		coalesce(a.ie_exige_condicao,'N') ie_exige_condicao,
		obter_dados_proc_interno(a.nr_proc_interno,'G'),
		coalesce(a.ie_questionar_forma,'N') ie_questionar_forma,
		coalesce(a.ie_outro_exame,'N') ie_outro_exame ,
		coalesce(a.ie_contraste,'N') ie_contraste,
		coalesce(a.ie_exige_justificativa,'N')ie_exige_justificativa,
		coalesce(ie_questionar_resumo,'N'),
		coalesce(a.ie_tela_unica,'N') ie_tela_unica
from	procedimento y,
		estrutura_procedimento_v x,
		procedimento_rotina a
where	a.cd_procedimento  = x.cd_procedimento
and 	a.ie_origem_proced = x.ie_origem_proced
and 	a.cd_procedimento  = y.cd_procedimento
and 	a.ie_origem_proced = y.ie_origem_proced
and 	coalesce(a.ie_situacao,'A') = 'A'
and     ((a.cd_perfil_excl <> cd_perfil_p) or (coalesce(a.cd_perfil_excl::text, '') = ''))
and 	Obter_se_proc_rotina(a.cd_especialidade,a.ie_tipo_atendimento,a.cd_setor_atendimento,a.cd_classif_setor_pac,a.ie_clinica,a.cd_setor_prescr,a.cd_convenio,a.nr_sequencia,a.cd_estabelecimento, cd_perfil_p, ie_tipo_convenio_p) = 'S'
and (coalesce(a.cd_estabelecimento::text, '') = '' or a.cd_estabelecimento = cd_estabelecimento_p)
and 	((a.cd_perfil = cd_perfil_p) or (coalesce(a.cd_perfil::text, '') = ''))
and 	((a.ie_origem_proced = ie_origem_proced_p) or (a.nr_proc_interno IS NOT NULL AND a.nr_proc_interno::text <> '') or (y.ie_ignora_origem = 'S'))
and 	coalesce(a.nr_seq_rotina::text, '') = ''
and 	((a.cd_classif_setor_pac = cd_classif_setor_pac_p) or (a.cd_setor_atendimento = cd_setor_atendimento_p))
group by
		'N',
		a.ds_prescricao,
		obter_dados_proc_interno(a.nr_proc_interno,'G'),
		coalesce(a.ie_exige_condicao,'N'),
		initcap(a.ds_prescricao),
		x.cd_grupo_proc,
		a.ie_rotina_uti,
		a.ie_lado,
		substr(obter_ctrl_glic_proc(a.nr_proc_interno),1,3),
		substr(obter_regra_topog_proc_int(a.nr_proc_interno),1,15),
		a.nr_seq_apres,
		a.ds_cor,
		a.cd_intervalo,
		ie_frase,
		coalesce(a.ie_exige_indicacao,'N'),
		coalesce(a.ie_observacao,'N'),
		a.ie_intervalo,
		coalesce(a.ie_questionar_forma,'N'),
		coalesce(a.ie_outro_exame,'N'),
		coalesce(a.ie_contraste,'N'),
		coalesce(a.ie_exige_justificativa,'N'),
		coalesce(ie_questionar_resumo,'N'),
		coalesce(a.ie_tela_unica,'N')

union all

select	distinct 1 ie_tipo,
		min(a.nr_sequencia),
		CASE WHEN ie_maiuscula_p='N' THEN a.ds_prescricao  ELSE InitCap(a.ds_prescricao) END  ds_prescricao,
		0,
		a.ie_rotina_uti,
		a.ie_lado,
		substr(obter_ctrl_glic_proc(a.nr_proc_interno),1,3) ie_ctrl_glic,
		substr(obter_regra_topog_proc_int(a.nr_proc_interno),1,15) ie_topografia,
		0 cd_especialidade,
		a.nr_seq_apres,
		a.ds_cor,
		'3',
		a.cd_intervalo,
		coalesce(ie_frase,'N') ie_frase,
		'N' ie_setor,
		coalesce(a.ie_exige_indicacao,'N'),
		'N' ie_orientacao,
		coalesce(a.ie_observacao,'N') ie_observacao,
		ie_intervalo,
		coalesce(a.Ie_exige_condicao,'N'),
		obter_dados_proc_interno(a.nr_proc_interno,'G'),
		coalesce(a.ie_questionar_forma,'N') ie_questionar_forma,
		coalesce(a.ie_outro_exame,'N') ie_outro_exame ,
		coalesce(a.ie_contraste,'N') ie_contraste,
		coalesce(a.ie_exige_justificativa,'N') ie_exige_justificativa,
		coalesce(a.ie_questionar_resumo,'N'),
		coalesce(a.ie_tela_unica,'N') ie_tela_unica
from 	procedimento_rotina a
where	coalesce(a.nr_seq_rotina::text, '') = ''
and 	coalesce(a.ie_situacao,'A') = 'A'
and 	(a.nr_proc_interno IS NOT NULL AND a.nr_proc_interno::text <> '')
and 	((coalesce(a.cd_estabelecimento::text, '') = '') or (a.cd_estabelecimento = cd_estabelecimento_p))
and 	Obter_se_proc_rotina(a.cd_especialidade,a.ie_tipo_atendimento,a.cd_setor_atendimento,a.cd_classif_setor_pac,a.ie_clinica,a.cd_setor_prescr,a.cd_convenio,a.nr_sequencia,a.cd_estabelecimento, cd_perfil_p, ie_tipo_convenio_p) = 'S'
and 	((a.cd_perfil = cd_perfil_p) or (coalesce(a.cd_perfil::text, '') = ''))
and 	((a.cd_perfil_excl <> cd_perfil_p) or (coalesce(a.cd_perfil_excl::text, '') = ''))
and 	((a.cd_classif_setor_pac = cd_classif_setor_pac_p) or (a.cd_setor_atendimento = cd_setor_atendimento_p))
and 	not exists (select	1
					from	procedimento y,
							estrutura_procedimento_v x,
							procedimento_rotina b
					where 	b.cd_procedimento  = x.cd_procedimento
                    and 	b.nr_sequencia = a.nr_sequencia
                    and 	b.ie_origem_proced = x.ie_origem_proced
                    and 	b.cd_procedimento  = y.cd_procedimento
                    and 	b.ie_origem_proced = y.ie_origem_proced
                    and 	Obter_se_proc_rotina(b.cd_especialidade,b.ie_tipo_atendimento,b.cd_setor_atendimento,b.cd_classif_setor_pac,b.ie_clinica,b.cd_setor_prescr,b.cd_convenio,b.nr_sequencia,b.cd_estabelecimento, cd_perfil_p, ie_tipo_convenio_p) = 'S'
                    and (coalesce(b.cd_estabelecimento::text, '') = '' or b.cd_estabelecimento = cd_estabelecimento_p)
                    and 	((b.cd_perfil = cd_perfil_p) or (coalesce(b.cd_perfil::text, '') = ''))
                    and 	((b.ie_origem_proced = ie_origem_proced_p) or (b.nr_proc_interno IS NOT NULL AND b.nr_proc_interno::text <> '') or (y.ie_ignora_origem = 'S'))
                    and 	coalesce(b.nr_seq_rotina::text, '') = ''
                    and 	((b.cd_classif_setor_pac = cd_classif_setor_pac_p) or (b.cd_setor_atendimento = cd_setor_atendimento_p)))
group by
		a.ds_prescricao,
		obter_dados_proc_interno(a.nr_proc_interno,'G'),
		coalesce(a.ie_exige_condicao,'N'),
		initcap(a.ds_prescricao),
		0,
		a.ie_rotina_uti,
		a.ie_lado,
		substr(obter_ctrl_glic_proc(a.nr_proc_interno),1,3),
		substr(obter_regra_topog_proc_int(a.nr_proc_interno),1,15),
		a.nr_seq_apres,
		a.ds_cor,
		a.cd_intervalo,
		ie_frase,
		coalesce(a.ie_exige_indicacao,'N'),
		coalesce(a.ie_observacao,'N'),
		ie_intervalo,
		coalesce(a.ie_questionar_forma,'N'),
		coalesce(a.ie_outro_exame,'N'),
		coalesce(a.ie_contraste,'N'),
		coalesce(a.ie_exige_justificativa,'N'),
		coalesce(ie_questionar_resumo,'N') ,
        coalesce(a.ie_tela_unica,'N')
order by
		ie_tipo,
		nr_seq_apres,
		cd_especialidade,
		ds_prescricao;

c12 CURSOR FOR
SELECT  distinct 7 ie_tipo,
        a.cd_protocolo,
        a.cd_protocolo||a.nr_sequencia||a.nr_seq_proc nr_sequencia,
        a.nr_sequencia nr_seq_subtipo,
        a.nr_seq_proc,
        a.ds_rotina_prescr ds_prescricao,
        'N' ie_rotina_uti,
		coalesce(a.ie_questiona_lado, 'N') ie_lado,
		substr(obter_ctrl_glic_proc(a.nr_seq_proc_interno),1,3) ie_ctrl_glic,
		substr(obter_regra_topog_proc_int(a.nr_seq_proc_interno),1,15) ie_topografia,
        a.cd_intervalo,
		'N' ie_frase,
		'N' ie_setor,
		'N' ie_indicacao,
		'N' ie_orientacao,
		'N' ie_observacao,
		'N' ie_intervalo,
		'N' ie_exige_condicao,
		'0' nr_seq_prot_glic,
		'N' ie_questionar_forma,
		'N' ie_outro_exame,
		'N' ie_contraste,
		'N' ie_exige_justificativa,
		'N' ie_questionar_resumo,
        'N' ie_tela_unica
from    protocolo_medic_proc a,
        protocolo_medicacao b,
        protocolo c
where   (a.ds_rotina_prescr IS NOT NULL AND a.ds_rotina_prescr::text <> '')
and     b.cd_protocolo = c.cd_protocolo
and     a.cd_protocolo = b.cd_protocolo
and     a.nr_sequencia = b.nr_sequencia
and     obter_se_protocolo_lib_estab(c.cd_protocolo, cd_estabelecimento_p) = 'S'
and     coalesce(b.ie_situacao,'A') = 'A'
and     coalesce(c.ie_situacao,'A') = 'A'
order by
		ds_prescricao;

c13 CURSOR FOR
SELECT	x.nr_sequencia,
		x.ds_grupo
from	proced_rotina_grupo x
where	x.ie_situacao = 'A'
and		exists (	select	1
					from	procedimento_rotina a
					where   coalesce(a.cd_classif_setor_pac::text, '') = ''
					and     coalesce(a.nr_seq_rotina::text, '') = ''
					and     ((coalesce(a.cd_estabelecimento::text, '') = '') or (a.cd_estabelecimento = cd_estabelecimento_p))
					and     ((a.cd_perfil = cd_perfil_p) or (coalesce(a.cd_perfil::text, '') = ''))
					and     a.nr_seq_grupo_rotina = x.nr_sequencia
					and     ((a.cd_perfil_excl <> cd_perfil_p) or (coalesce(a.cd_perfil_excl::text, '') = ''))
					and     Obter_se_proc_rotina(cd_medico_p,ie_tipo_atendimento_p,cd_setor_atendimento_p,cd_classif_setor_pac_p,ie_clinica_p,cd_setor_prescr_p,cd_convenio_p,a.nr_sequencia,cd_estabelecimento_p, cd_perfil_p, ie_tipo_convenio_p) = 'S'
					and     ((coalesce(a.cd_especialidade::text, '') = '') or (a.cd_especialidade in (	select	b.cd_especialidade
														from	medico_especialidade b
														where	b.cd_pessoa_fisica = cd_medico_p))))
order by x.ds_grupo;

c14 CURSOR FOR
SELECT  distinct 1 ie_tipo,
        CASE WHEN ie_tipo_p='S' THEN 1  ELSE 0 END  nr_seq_ordem,
        min(a.nr_sequencia) nr_sequencia,
        CASE WHEN ie_maiuscula_p='N' THEN a.ds_prescricao  ELSE initcap(a.ds_prescricao) END  ds_prescricao,
        a.ie_rotina_uti,
        a.ie_lado,
        substr(obter_ctrl_glic_proc(a.nr_proc_interno),1,3) ie_ctrl_glic,
        substr(obter_regra_topog_proc_int(a.nr_proc_interno),1,15) ie_topografia,
        0 cd_especialidade,
        a.nr_seq_apres,
        a.ds_cor,
        a.cd_intervalo,
        0 nr_seq_material,
        coalesce(ie_frase,'N') ie_frase,
        coalesce(a.ie_setor,'N') ie_setor,
        obter_inf_exame_rotina(a.nr_seq_rotina) ds_inf_adicional,
        coalesce(ie_exige_indicacao,'N') ie_indicacao,
        'N' ie_orientacao,
        coalesce(a.ie_observacao,'N') ie_observacao,
        a.ie_intervalo,
        a.ie_exige_condicao,
        obter_dados_proc_interno(a.nr_proc_interno,'G') nr_seq_prot_glic,
        coalesce(a.ie_questionar_forma,'N') ie_questionar_forma,
        coalesce(a.ie_outro_exame,'N') ie_outro_exame ,
        coalesce(a.ie_contraste,'N') ie_contraste,
        coalesce(a.ie_exige_justificativa,'N') ie_exige_justificativa,
		coalesce(ie_questionar_resumo,'N') ie_questionar_resumo,
        coalesce(a.ie_tela_unica,'N') ie_tela_unica
from    procedimento_rotina a
where   coalesce(a.cd_classif_setor_pac::text, '') = ''
and     coalesce(a.nr_seq_rotina::text, '') = ''
and (coalesce(a.cd_estabelecimento::text, '') = '' or a.cd_estabelecimento = cd_estabelecimento_p)
and     ((a.cd_perfil = cd_perfil_p) or (coalesce(a.cd_perfil::text, '') = ''))
and     a.nr_seq_grupo_rotina = nr_seq_grupo_w
and     ((a.cd_perfil_excl <> cd_perfil_p) or (coalesce(a.cd_perfil_excl::text, '') = ''))
and     Obter_se_proc_rotina(cd_medico_p,ie_tipo_atendimento_p,cd_setor_atendimento_p,cd_classif_setor_pac_p,ie_clinica_p,cd_setor_prescr_p,cd_convenio_p,a.nr_sequencia,cd_estabelecimento_p, cd_perfil_p, ie_tipo_convenio_p) = 'S'
and     ((coalesce(a.cd_especialidade::text, '') = '') or (a.cd_especialidade in (	select	b.cd_especialidade
									from	medico_especialidade b
									where	b.cd_pessoa_fisica = cd_medico_p)))
group by
		a.ds_prescricao,
		a.ie_exige_condicao,
		obter_dados_proc_interno(a.nr_proc_interno, 'G'),
		initcap(a.ds_prescricao),
		0,
		a.ie_rotina_uti,
		a.ie_lado,
        substr(obter_ctrl_glic_proc(a.nr_proc_interno),1,3),
		substr(obter_regra_topog_proc_int(a.nr_proc_interno),1,15),
        a.nr_seq_apres,
		a.ds_cor,
		a.cd_intervalo,
		ie_frase,
		coalesce(a.ie_setor,'N'),
		obter_inf_exame_rotina(a.nr_seq_rotina),
        coalesce(ie_exige_indicacao,'N'),
		coalesce(a.ie_observacao,'N'),
		a.ie_intervalo,
		coalesce(a.ie_questionar_forma,'N'),
		coalesce(a.ie_outro_exame,'N'),
        coalesce(a.ie_contraste,'N'),
		coalesce(a.ie_exige_justificativa,'N'),
		coalesce(ie_questionar_resumo,'N'),
		coalesce(a.ie_tela_unica,'N')
order by
		nr_seq_ordem,
		ie_tipo,
		nr_seq_apres,
		cd_especialidade,
		ds_prescricao;

c15 CURSOR FOR
SELECT  distinct 1 ie_tipo,
        CASE WHEN ie_tipo_p='S' THEN 1  ELSE 0 END  nr_seq_ordem,
        min(a.nr_sequencia) nr_sequencia,
        CASE WHEN ie_maiuscula_p='N' THEN a.ds_prescricao  ELSE initcap(a.ds_prescricao) END  ds_prescricao,
        a.ie_rotina_uti,
        a.ie_lado,
        substr(obter_ctrl_glic_proc(a.nr_proc_interno),1,3) ie_ctrl_glic,
        substr(obter_regra_topog_proc_int(a.nr_proc_interno),1,15) ie_topografia,
        0 cd_especialidade,
        a.nr_seq_apres,
        a.ds_cor,
        a.cd_intervalo,
        0 nr_seq_material,
        coalesce(ie_frase,'N') ie_frase,
        coalesce(a.ie_setor,'N') ie_setor,
        Obter_Inf_Exame_Rotina(a.nr_seq_rotina) ds_inf_adicional,
        coalesce(ie_exige_indicacao,'N') ie_indicacao,
        'N' ie_orientacao,
        coalesce(a.ie_observacao,'N') ie_observacao,
        a.ie_intervalo,
        a.ie_exige_condicao,
        obter_dados_proc_interno(a.nr_proc_interno,'G') nr_seq_prot_glic,
		coalesce(a.ie_questionar_forma,'N') ie_questionar_forma,
        coalesce(a.ie_contraste,'N') ie_contraste,
        coalesce(a.ie_exige_justificativa,'N') ie_exige_justificativa,
        coalesce(a.ie_outro_exame,'N') ie_outro_exame,
		coalesce(ie_questionar_resumo,'N') ie_questionar_resumo,
        coalesce(a.ie_tela_unica,'N') ie_tela_unica
from    procedimento_rotina a
where   coalesce(a.cd_classif_setor_pac::text, '') = ''
and     coalesce(a.nr_seq_rotina::text, '') = ''
and     ((coalesce(a.cd_estabelecimento::text, '') = '') or (a.cd_estabelecimento = cd_estabelecimento_p))
and     ((a.cd_perfil = cd_perfil_p) or (coalesce(a.cd_perfil::text, '') = ''))
and     ((a.cd_perfil_excl <> cd_perfil_p) or (coalesce(a.cd_perfil_excl::text, '') = ''))
and     Obter_se_proc_rotina(a.cd_especialidade,a.ie_tipo_atendimento,a.cd_setor_atendimento,a.cd_classif_setor_pac,a.ie_clinica,a.cd_setor_prescr,a.cd_convenio,a.nr_sequencia,a.cd_estabelecimento, cd_perfil_p, ie_tipo_convenio_p) = 'S'
and     Obter_tipo_proc_interno(a.nr_proc_interno) in ('AP', 'APH', 'APC')
and     (a.nr_proc_interno IS NOT NULL AND a.nr_proc_interno::text <> '')
and     ((coalesce(a.cd_especialidade::text, '') = '') or
        a.cd_especialidade in (	select	b.cd_especialidade
								from	medico_especialidade b
								where	b.cd_pessoa_fisica = cd_medico_p))
group by
		a.ds_prescricao,
		obter_dados_proc_interno(a.nr_proc_interno,'G'),
		a.ie_exige_condicao,
		initcap(a.ds_prescricao),
		a.ie_rotina_uti, a.ie_lado,
        substr(obter_ctrl_glic_proc(a.nr_proc_interno),1,3),
		substr(obter_regra_topog_proc_int(a.nr_proc_interno),1,15),
		a.nr_seq_apres,
		a.ds_cor,
        a.cd_intervalo,
		ie_frase,
		coalesce(a.ie_setor,'N'),
		Obter_Inf_Exame_Rotina(a.nr_seq_rotina),
		coalesce(ie_exige_indicacao,'N'),
		coalesce(a.ie_observacao,'N'),
        a.ie_intervalo,
		coalesce(a.ie_questionar_forma,'N'),
		coalesce(a.ie_contraste,'N'),
		coalesce(a.ie_exige_justificativa,'N'),
		coalesce(a.ie_outro_exame,'N'),
        coalesce(ie_questionar_resumo,'N'),
		coalesce(a.ie_tela_unica,'N')
order by
		nr_seq_ordem,
		ie_tipo,
		nr_seq_apres,
		cd_especialidade,
		ds_prescricao;


BEGIN

delete	from w_proc_rotina_esp_t
where	nm_usuario = nm_usuario_p
and		ie_pasta = ie_pasta_p;

delete	from w_grupo_proc_rot_t
where	nm_usuario = nm_usuario_p
and		ie_pasta = ie_pasta_p;

commit;
if (ie_pasta_p = 1) then
	if (obter_se_usa_grupo(ie_pasta_p) = 'S') then
		open c01;
		loop
		fetch c01 into	nr_seq_grupo_w,
						ds_grupo_w,
						nr_seq_apresentacao_w,
						ds_cor_grupo_w,
						ie_tipo_apresent_grupo_w;
		EXIT WHEN NOT FOUND; /* apply on c01 */
			begin

			insert into w_grupo_proc_rot_t(
								nr_sequencia,
								nr_seq_grupo,
								ds_grupo,
								nr_seq_apresentacao,
								nm_usuario,
								nm_usuario_nrec,
								dt_atualizacao,
								dt_atualizacao_nrec,
								ds_cor,
								ie_pasta,
								ie_tipo_apresent,
								nr_seq_coluna)
						values (
								nextval('w_grupo_proc_rot_t_seq'),
								nr_seq_grupo_w,
								ds_grupo_w,
								nr_seq_apresentacao_w,
								nm_usuario_p,
								nm_usuario_p,
								clock_timestamp(),
								clock_timestamp(),
								ds_cor_grupo_w,
								ie_pasta_p,
								ie_tipo_apresent_grupo_w,
								1);
			commit;
			qt_registro_w := 0;
			nr_seq_grupo_ww := 0;
			nr_seq_coluna_w := 1;
			open c02;
			loop
			fetch c02 into	ie_tipo_w,
							nr_seq_ordem_w,
							ie_exige_justificativa_w,
							nr_seq_proc_rotina_w,
							ds_prescricao_w,
							cd_grupo_proc_w,
							ie_rotina_uti_w,
							ie_exige_lado_w,
							ie_ctrl_glic_w,
							ie_topografia_w,
							cd_especialidade_w,
							nr_seq_apres_w,
							ds_cor_w,
							cd_intervalo_w,
							nr_seq_material_w,
							ie_frase_w,
							ie_setor_w,
							ds_inf_adicional_w,
							ie_exige_indicacao_w,
							ie_orientacao_w,
							ie_observacao_w,
							ie_intervalo_w,
							ie_exige_condicao_w,
							nr_seq_prot_glic_w,
							ie_medico_exec_w,
							ie_questionar_forma_w,
							ie_outro_exame_w,
							ie_contraste_w,
							ie_questionar_resumo_w,
							ie_tela_unica_w,
							ie_tipo_apresent_w;
			EXIT WHEN NOT FOUND; /* apply on c02 */
				begin
				qt_registro_w := qt_registro_w + 1;
				if (qt_registro_w > qt_reg_coluna_p) then
					qt_registro_w   := 1;
					nr_seq_grupo_ww := nr_seq_grupo_ww +1;
					nr_seq_coluna_w := nr_seq_coluna_w + 1;

					if (nr_seq_grupo_w > 0) then
						nr_seq_grupo_w := nr_seq_grupo_w||nr_seq_grupo_ww;
					else
						nr_seq_grupo_w := 999||nr_seq_grupo_ww;
					end if;

					insert into w_grupo_proc_rot_t(
										nr_sequencia,
										nr_seq_grupo,
										ds_grupo,
										nr_seq_apresentacao,
										nm_usuario,
										nm_usuario_nrec,
										dt_atualizacao,
										dt_atualizacao_nrec,
										ds_cor,
										ie_pasta,
										ie_tipo_apresent,
										nr_seq_coluna)
								values (
										nextval('w_grupo_proc_rot_t_seq'),
										nr_seq_grupo_w,
										ds_grupo_w,
										nr_seq_apresentacao_w,
										nm_usuario_p,
										nm_usuario_p,
										clock_timestamp(),
										clock_timestamp(),
										ds_cor_grupo_w,
										ie_pasta_p,
										ie_tipo_apresent_grupo_w,
										nr_seq_coluna_w);
					commit;
				end if;

				select	nextval('w_proc_rotina_esp_t_seq')
				into STRICT	nr_sequencia_ww
				;

				insert into	w_proc_rotina_esp_t(
								ie_tipo,
								nr_seq_ordem,
								ie_exige_justificativa,
								nr_sequencia,
								nr_seq_proc_rotina,
								ds_prescricao,
								cd_grupo_proc,
								ie_rotina_uti,
								ie_exige_lado,
								ie_ctrl_glic,
								ie_topografia,
								cd_especialidade,
								nr_seq_apres,
								ds_cor,
								cd_intervalo,
								nr_seq_material,
								ie_frase,
								ie_setor,
								ds_inf_adicional,
								ie_exige_indicacao,
								ie_orientacao,
								ie_observacao,
								ie_intervalo,
								ie_exige_condicao,
								nr_seq_prot_glic,
								ie_medico_exec,
								ie_questionar_forma,
								ie_outro_exame,
								ie_contraste,
								ie_questionar_resumo,
								ie_tela_unica,
								nm_usuario,
								nr_seq_grupo,
								nm_usuario_nrec,
								dt_atualizacao,
								dt_atualizacao_nrec,
								ie_pasta,
								ie_marcado,
								ie_tipo_apresent)
						values (
								ie_tipo_w,
								nr_seq_ordem_w,
								ie_exige_justificativa_w,
								nr_sequencia_ww,
								nr_seq_proc_rotina_w,
								ds_prescricao_w,
								cd_grupo_proc_w,
								ie_rotina_uti_w,
								ie_exige_lado_w,
								ie_ctrl_glic_w,
								ie_topografia_w,
								cd_especialidade_w,
								nr_seq_apres_w,
								ds_cor_w,
								cd_intervalo_w,
								nr_seq_material_w,
								ie_frase_w,
								ie_setor_w,
								ds_inf_adicional_w,
								ie_exige_indicacao_w,
								ie_orientacao_w,
								ie_observacao_w,
								ie_intervalo_w,
								ie_exige_condicao_w,
								nr_seq_prot_glic_w,
								ie_medico_exec_w,
								ie_questionar_forma_w,
								ie_outro_exame_w,
								ie_contraste_w,
								ie_questionar_resumo_w,
								ie_tela_unica_w,
								nm_usuario_p,
								nr_seq_grupo_w,
								nm_usuario_p,
								clock_timestamp(),
								clock_timestamp(),
								ie_pasta_p,
								'N',
								ie_tipo_apresent_w);
				commit;
				end;
			end loop;
			close c02;
			end;
		end loop;
		close c01;
	elsif (obter_se_usa_grupo(ie_pasta_p) = 'N') then
		nr_seq_grupo_w := 0;
		open c02;
		loop
		fetch c02 into	ie_tipo_w,
						nr_seq_ordem_w,
						ie_exige_justificativa_w,
						nr_seq_proc_rotina_w,
						ds_prescricao_w,
						cd_grupo_proc_w,
						ie_rotina_uti_w,
						ie_exige_lado_w,
						ie_ctrl_glic_w,
						ie_topografia_w,
						cd_especialidade_w,
						nr_seq_apres_w,
						ds_cor_w,
						cd_intervalo_w,
						nr_seq_material_w,
						ie_frase_w,
						ie_setor_w,
						ds_inf_adicional_w,
						ie_exige_indicacao_w,
						ie_orientacao_w,
						ie_observacao_w,
						ie_intervalo_w,
						ie_exige_condicao_w,
						nr_seq_prot_glic_w,
						ie_medico_exec_w,
						ie_questionar_forma_w,
						ie_outro_exame_w,
						ie_contraste_w,
						ie_questionar_resumo_w,
						ie_tela_unica_w,
						ie_tipo_apresent_w;
		EXIT WHEN NOT FOUND; /* apply on c02 */
			begin
			qt_registro_w := qt_registro_w + 1;
			if (qt_registro_w > qt_reg_coluna_p) then
				nr_seq_grupo_ww := nr_seq_grupo_ww +1;
				qt_registro_w   := 1;
			end if;
			select	nextval('w_proc_rotina_esp_t_seq')
			into STRICT	nr_sequencia_ww
			;

			insert into	w_proc_rotina_esp_t(
							ie_tipo,
							nr_seq_ordem,
							ie_exige_justificativa,
							nr_sequencia,
							nr_seq_proc_rotina,
							ds_prescricao,
							cd_grupo_proc,
							ie_rotina_uti,
							ie_exige_lado,
							ie_ctrl_glic,
							ie_topografia,
							cd_especialidade,
							nr_seq_apres,
							ds_cor,
							cd_intervalo,
							nr_seq_material,
							ie_frase,
							ie_setor,
							ds_inf_adicional,
							ie_exige_indicacao,
							ie_orientacao,
							ie_observacao,
							ie_intervalo,
							ie_exige_condicao,
							nr_seq_prot_glic,
							ie_medico_exec,
							ie_questionar_forma,
							ie_outro_exame,
							ie_contraste,
							ie_questionar_resumo,
							ie_tela_unica,
							nm_usuario,
							nr_seq_grupo,
							nm_usuario_nrec,
							dt_atualizacao,
							dt_atualizacao_nrec,
							ie_pasta,
							ie_marcado,
							ie_tipo_apresent)
					values (
							ie_tipo_w,
							nr_seq_ordem_w,
							ie_exige_justificativa_w,
							nr_sequencia_ww,
							nr_seq_proc_rotina_w,
							ds_prescricao_w,
							cd_grupo_proc_w,
							ie_rotina_uti_w,
							ie_exige_lado_w,
							ie_ctrl_glic_w,
							ie_topografia_w,
							cd_especialidade_w,
							nr_seq_apres_w,
							ds_cor_w,
							cd_intervalo_w,
							nr_seq_material_w,
							ie_frase_w,
							ie_setor_w,
							ds_inf_adicional_w,
							ie_exige_indicacao_w,
							ie_orientacao_w,
							ie_observacao_w,
							ie_intervalo_w,
							ie_exige_condicao_w,
							nr_seq_prot_glic_w,
							ie_medico_exec_w,
							ie_questionar_forma_w,
							ie_outro_exame_w,
							ie_contraste_w,
							ie_questionar_resumo_w,
							ie_tela_unica_w,
							nm_usuario_p,
							nr_seq_grupo_ww,
							nm_usuario_p,
							clock_timestamp(),
							clock_timestamp(),
							ie_pasta_p,
							'N',
							ie_tipo_apresent_w);
			commit;
			end;
		end loop;
		close c02;

		open c03;
		loop
		fetch c03 into	nr_seq_grupo_ww,
						ie_tipo_apresent_w;
		EXIT WHEN NOT FOUND; /* apply on c03 */
			begin
			select	nextval('w_grupo_proc_rot_t_seq')
			into STRICT	nr_sequencia_w
			;

			insert into w_grupo_proc_rot_t(
								nr_sequencia,
								nr_seq_grupo,
								ds_grupo,
								nr_seq_apresentacao,
								nm_usuario,
								nm_usuario_nrec,
								dt_atualizacao,
								dt_atualizacao_nrec,
								ds_cor,
								ie_pasta,
								ie_tipo_apresent)
						values (
								nr_sequencia_w,
								nr_seq_grupo_ww,
								' ',
								nr_seq_grupo_ww,
								nm_usuario_p,
								nm_usuario_p,
								clock_timestamp(),
								clock_timestamp(),
								null,
								ie_pasta_p,
								ie_tipo_apresent_w);
			commit;
			end;
		end loop;
		close c03;
	end if;
elsif (ie_pasta_p = 2) then
	if (obter_se_usa_grupo(ie_pasta_p) = 'S') then
		open c04;
		loop
		fetch c04 into	nr_seq_grupo_w,
						ds_grupo_w;
		EXIT WHEN NOT FOUND; /* apply on c04 */
			begin
			insert into w_grupo_proc_rot_t(
								nr_sequencia,
								nr_seq_grupo,
								ds_grupo,
								nr_seq_apresentacao,
								nm_usuario,
								nm_usuario_nrec,
								dt_atualizacao,
								dt_atualizacao_nrec,
								ds_cor,
								ie_pasta,
								ie_tipo_apresent)
						values (
								nextval('w_grupo_proc_rot_t_seq'),
								nr_seq_grupo_w,
								ds_grupo_w,
								null,
								nm_usuario_p,
								nm_usuario_p,
								clock_timestamp(),
								clock_timestamp(),
								null,
								ie_pasta_p,
								null);
			commit;
			open c05;
			loop
			fetch c05 into	nr_seq_proc_rotina_w,
							ds_prescricao_w,
							ie_tipo_w,
							ie_rotina_uti_w,
							ie_exige_lado_w,
							ie_ctrl_glic_w,
							ie_topografia_w,
							nr_seq_ordem_w,
							ds_cor_w,
							ie_frase_w,
							ie_setor_w,
							ds_inf_adicional_w,
							ie_exige_indicacao_w,
							ie_orientacao_w,
							ie_observacao_w,
							ie_intervalo_w,
							ie_exige_condicao_w,
							nr_seq_prot_glic_w,
							ie_quest_agora_w,
							ie_questionar_forma_w,
							ie_outro_exame_w,
							ie_contraste_w,
							ie_questionar_resumo_w,
							ie_tela_unica_w;
			EXIT WHEN NOT FOUND; /* apply on c05 */
				begin

				select	nextval('w_proc_rotina_esp_t_seq')
				into STRICT	nr_sequencia_ww
				;

				insert into	w_proc_rotina_esp_t(
								ie_tipo,
								nr_seq_ordem,
								nr_sequencia,
								nr_seq_proc_rotina,
								ds_prescricao,
								ie_rotina_uti,
								ie_exige_lado,
								ie_ctrl_glic,
								ie_topografia,
								ds_cor,
								ie_frase,
								ie_setor,
								ds_inf_adicional,
								ie_exige_indicacao,
								ie_orientacao,
								ie_observacao,
								ie_intervalo,
								ie_exige_condicao,
								nr_seq_prot_glic,
								ie_questionar_forma,
								ie_outro_exame,
								ie_contraste,
								ie_questionar_resumo,
								ie_tela_unica,
								nm_usuario,
								nr_seq_grupo,
								nm_usuario_nrec,
								dt_atualizacao,
								dt_atualizacao_nrec,
								ie_pasta,
								ie_marcado,
								ie_quest_agora)
						values (
								ie_tipo_w,
								nr_seq_ordem_w,
								nr_sequencia_ww,
								nr_seq_proc_rotina_w,
								ds_prescricao_w,
								ie_rotina_uti_w,
								ie_exige_lado_w,
								ie_ctrl_glic_w,
								ie_topografia_w,
								ds_cor_w,
								ie_frase_w,
								ie_setor_w,
								ds_inf_adicional_w,
								ie_exige_indicacao_w,
								ie_orientacao_w,
								ie_observacao_w,
								ie_intervalo_w,
								ie_exige_condicao_w,
								nr_seq_prot_glic_w,
								ie_questionar_forma_w,
								ie_outro_exame_w,
								ie_contraste_w,
								ie_questionar_resumo_w,
								ie_tela_unica_w,
								nm_usuario_p,
								nr_seq_grupo_w,
								nm_usuario_p,
								clock_timestamp(),
								clock_timestamp(),
								ie_pasta_p,
								'N',
								ie_quest_agora_w);
				commit;
				end;
			end loop;
			close c05;
			end;
		end loop;
		close c04;
	elsif (obter_se_usa_grupo(ie_pasta_p) = 'N') then
		nr_seq_grupo_w := 0;
		open c05;
		loop
		fetch c05 into	nr_seq_proc_rotina_w,
						ds_prescricao_w,
						ie_tipo_w,
						ie_rotina_uti_w,
						ie_exige_lado_w,
						ie_ctrl_glic_w,
						ie_topografia_w,
						nr_seq_ordem_w,
						ds_cor_w,
						ie_frase_w,
						ie_setor_w,
						ds_inf_adicional_w,
						ie_exige_indicacao_w,
						ie_orientacao_w,
						ie_observacao_w,
						ie_intervalo_w,
						ie_exige_condicao_w,
						nr_seq_prot_glic_w,
						ie_quest_agora_w,
						ie_questionar_forma_w,
						ie_outro_exame_w,
						ie_contraste_w,
						ie_questionar_resumo_w,
						ie_tela_unica_w;
		EXIT WHEN NOT FOUND; /* apply on c05 */
			begin
			qt_registro_w := qt_registro_w + 1;
			if (qt_registro_w > qt_reg_coluna_p) then
				nr_seq_grupo_ww := nr_seq_grupo_ww +1;
				qt_registro_w   := 1;
			end if;

			select	nextval('w_proc_rotina_esp_t_seq')
			into STRICT	nr_sequencia_ww
			;

			insert into	w_proc_rotina_esp_t(
							ie_tipo,
							nr_seq_ordem,
							nr_sequencia,
							nr_seq_proc_rotina,
							ds_prescricao,
							ie_rotina_uti,
							ie_exige_lado,
							ie_ctrl_glic,
							ie_topografia,
							ds_cor,
							ie_frase,
							ie_setor,
							ds_inf_adicional,
							ie_exige_indicacao,
							ie_orientacao,
							ie_observacao,
							ie_intervalo,
							ie_exige_condicao,
							nr_seq_prot_glic,
							ie_questionar_forma,
							ie_outro_exame,
							ie_contraste,
							ie_questionar_resumo,
							ie_tela_unica,
							nm_usuario,
							nr_seq_grupo,
							nm_usuario_nrec,
							dt_atualizacao,
							dt_atualizacao_nrec,
							ie_pasta,
							ie_marcado,
							ie_quest_agora)
					values (
							ie_tipo_w,
							nr_seq_ordem_w,
							nr_sequencia_ww,
							nr_seq_proc_rotina_w,
							ds_prescricao_w,
							ie_rotina_uti_w,
							ie_exige_lado_w,
							ie_ctrl_glic_w,
							ie_topografia_w,
							ds_cor_w,
							ie_frase_w,
							ie_setor_w,
							ds_inf_adicional_w,
							ie_exige_indicacao_w,
							ie_orientacao_w,
							ie_observacao_w,
							ie_intervalo_w,
							ie_exige_condicao_w,
							nr_seq_prot_glic_w,
							ie_questionar_forma_w,
							ie_outro_exame_w,
							ie_contraste_w,
							ie_questionar_resumo_w,
							ie_tela_unica_w,
							nm_usuario_p,
							nr_seq_grupo_ww,
							nm_usuario_p,
							clock_timestamp(),
							clock_timestamp(),
							ie_pasta_p,
							'N',
							ie_quest_agora_w);
			commit;
			end;
		end loop;
		close c05;
		open c03;
		loop
		fetch c03 into	nr_seq_grupo_ww,
						ie_tipo_apresent_w;
		EXIT WHEN NOT FOUND; /* apply on c03 */
			begin
			select	nextval('w_grupo_proc_rot_t_seq')
			into STRICT	nr_sequencia_w
			;

			insert into w_grupo_proc_rot_t(
								nr_sequencia,
								nr_seq_grupo,
								ds_grupo,
								nr_seq_apresentacao,
								nm_usuario,
								nm_usuario_nrec,
								dt_atualizacao,
								dt_atualizacao_nrec,
								ds_cor,
								ie_pasta,
								ie_tipo_apresent)
						values (
								nr_sequencia_w,
								nr_seq_grupo_ww,
								obter_desc_expressao(342888)/*'Sem Grupo'*/
,
								nr_seq_grupo_ww,
								nm_usuario_p,
								nm_usuario_p,
								clock_timestamp(),
								clock_timestamp(),
								null,
								ie_pasta_p,
								ie_tipo_apresent_w);
			commit;
			end;
		end loop;
		close c03;
	end if;
elsif (ie_pasta_p = 3) then
	open c06;
	loop
	fetch c06 into	nr_seq_grupo_w,
					ds_grupo_w,
					nr_seq_apresentacao_w;
	EXIT WHEN NOT FOUND; /* apply on c06 */
		begin

		insert into w_grupo_proc_rot_t(
							nr_sequencia,
							nr_seq_grupo,
							ds_grupo,
							nr_seq_apresentacao,
							nm_usuario,
							nm_usuario_nrec,
							dt_atualizacao,
							dt_atualizacao_nrec,
							ds_cor,
							ie_pasta,
							ie_tipo_apresent,
							nr_seq_coluna)
					values (
							nextval('w_grupo_proc_rot_t_seq'),
							nr_seq_grupo_w,
							ds_grupo_w,
							nr_seq_apresentacao_w,
							nm_usuario_p,
							nm_usuario_p,
							clock_timestamp(),
							clock_timestamp(),
							null,
							ie_pasta_p,
							null,
							1);
		commit;
		qt_registro_w := 0;
		nr_seq_grupo_ww := 0;
		nr_seq_coluna_w := 1;
		nr_seq_grupo_www := nr_seq_grupo_w;
		open c07;
		loop
		fetch c07 into	nr_seq_proc_rotina_w,
						ds_prescricao_w,
						ie_rotina_uti_w,
						ie_exige_lado_w,
						ie_ctrl_glic_w,
						ie_topografia_w,
						ie_tipo_w,
						ie_frase_w,
						ie_setor_w,
						ie_exige_indicacao_w,
						ie_orientacao_w,
						ie_observacao_w,
						ie_intervalo_w,
						ds_cor_w,
						ie_exige_condicao_w,
						nr_seq_prot_glic_w,
						ds_ordem_w,
						ie_exige_justificativa_w,
						ie_questionar_forma_w,
						ie_outro_exame_w,
						ie_contraste_w,
						ie_questionar_resumo_w,
						ie_tela_unica_w;
		EXIT WHEN NOT FOUND; /* apply on c07 */
			begin
			qt_registro_w := qt_registro_w + 1;
			if (qt_registro_w > qt_reg_coluna_p) then
				qt_registro_w   := 1;
				nr_seq_grupo_ww := nr_seq_grupo_ww +1;
				nr_seq_coluna_w := nr_seq_coluna_w + 1;
				nr_seq_grupo_w := nr_seq_grupo_www||nr_seq_grupo_ww;
				insert into w_grupo_proc_rot_t(
									nr_sequencia,
									nr_seq_grupo,
									ds_grupo,
									nr_seq_apresentacao,
									nm_usuario,
									nm_usuario_nrec,
									dt_atualizacao,
									dt_atualizacao_nrec,
									ds_cor,
									ie_pasta,
									ie_tipo_apresent,
									nr_seq_coluna)
							values (
									nextval('w_grupo_proc_rot_t_seq'),
									nr_seq_grupo_w,
									ds_grupo_w,
									nr_seq_apresentacao_w,
									nm_usuario_p,
									nm_usuario_p,
									clock_timestamp(),
									clock_timestamp(),
									null,
									ie_pasta_p,
									null,
									nr_seq_coluna_w);
				commit;
			end if;
			select	nextval('w_proc_rotina_esp_t_seq')
			into STRICT	nr_sequencia_ww
			;

			insert into	w_proc_rotina_esp_t(
							ie_tipo,
							nr_sequencia,
							nr_seq_proc_rotina,
							ds_prescricao,
							ie_rotina_uti,
							ie_exige_lado,
							ie_ctrl_glic,
							ie_topografia,
							ds_cor,
							ie_frase,
							ie_setor,
							ie_exige_indicacao,
							ie_orientacao,
							ie_observacao,
							ie_intervalo,
							ie_exige_condicao,
							nr_seq_prot_glic,
							ie_questionar_forma,
							ie_outro_exame,
							ie_contraste,
							ie_questionar_resumo,
							ie_tela_unica,
							nm_usuario,
							nr_seq_grupo,
							nm_usuario_nrec,
							dt_atualizacao,
							dt_atualizacao_nrec,
							ie_pasta,
							ie_marcado,
							ds_ordem)
					values (
							ie_tipo_w,
							nr_sequencia_ww,
							nr_seq_proc_rotina_w,
							ds_prescricao_w,
							ie_rotina_uti_w,
							ie_exige_lado_w,
							ie_ctrl_glic_w,
							ie_topografia_w,
							ds_cor_w,
							ie_frase_w,
							ie_setor_w,
							ie_exige_indicacao_w,
							ie_orientacao_w,
							ie_observacao_w,
							ie_intervalo_w,
							ie_exige_condicao_w,
							nr_seq_prot_glic_w,
							ie_questionar_forma_w,
							ie_outro_exame_w,
							ie_contraste_w,
							ie_questionar_resumo_w,
							ie_tela_unica_w,
							nm_usuario_p,
							nr_seq_grupo_w,
							nm_usuario_p,
							clock_timestamp(),
							clock_timestamp(),
							ie_pasta_p,
							'N',
							ds_ordem_w);
			commit;
			end;
		end loop;
		close c07;
		end;
	end loop;
	close c06;
elsif (ie_pasta_p = 4) then
	if (ie_tabela_interna_p = 'S') then
		open c08 for
		SELECT	a.cd_setor_atendimento,
				a.ds_prescricao ds_setor_atendimento
		from	setor_atendimento a
		where	a.ie_situacao = 'A'
		and		(a.ds_prescricao IS NOT NULL AND a.ds_prescricao::text <> '')
		and		((cd_estabelecimento_p = 0) or (a.cd_estabelecimento_base = cd_estabelecimento_p))
		and		exists (SELECT	1
						from  	proc_interno_setor b
						where 	a.cd_setor_atendimento = b.cd_setor_atendimento)
		order by
				a.ds_prescricao;
	else
		open c08 for
		SELECT	distinct a.cd_setor_atendimento,
				a.ds_prescricao_setor ds_setor_atendimento
		from 	setor_exame_v a
		where	((cd_estabelecimento_p = 0) or (a.cd_estabelecimento = cd_estabelecimento_p))
		and		0 < (SELECT count(*)
					 from	setor_exame_v b
					 where	b.cd_setor_atendimento = a.cd_setor_atendimento
					 and 	b.ie_origem_proced = ie_origem_proced_p
					 and 	b.ie_situacao = 'A')
		and		a.ie_origem_proced = ie_origem_proced_p
		and		(a.ds_prescricao_setor IS NOT NULL AND a.ds_prescricao_setor::text <> '')
		order by ds_setor_atendimento;
	end if;

	loop
	fetch c08 into	cd_setor_atendimento_w,
					ds_grupo_w;
	EXIT WHEN NOT FOUND; /* apply on c08 */
		begin
		insert into w_grupo_proc_rot_t(
							nr_sequencia,
							cd_setor_atendimento,
							ds_grupo,
							nr_seq_apresentacao,
							nm_usuario,
							nm_usuario_nrec,
							dt_atualizacao,
							dt_atualizacao_nrec,
							ds_cor,
							ie_pasta,
							ie_tipo_apresent)
					values (
							nextval('w_grupo_proc_rot_t_seq'),
							cd_setor_atendimento_w,
							ds_grupo_w,
							nr_seq_apresentacao_w,
							nm_usuario_p,
							nm_usuario_p,
							clock_timestamp(),
							clock_timestamp(),
							null,
							ie_pasta_p,
							null);
		commit;
		if (ie_tabela_interna_p = 'S') then
			open c09 for
			SELECT	distinct b.nr_sequencia,
					CASE WHEN ie_maiuscula_p='N' THEN b.ds_proc_exame  ELSE initcap(b.ds_proc_exame) END  ds_prescricao,
					'N' ie_rotina_uti,
					b.ie_exige_lado ie_lado,
					substr(obter_ctrl_glic_proc(b.nr_sequencia),1,3) ie_ctrl_glic,
					b.ie_topografia,
					5 ie_tipo,
					'N' ie_frase,
					'N' ie_setor,
					'N' ie_indicacao,
					'N' ie_orientacao,
					'N' ie_observacao,
					'N' ie_intervalo,
					'N' ie_exige_condicao,
					b.nr_seq_prot_glic,
					'N' ie_questionar_forma,
					'N' ie_outro_exame,
					'N' ie_contraste,
					'N' ie_questionar_resumo,
					'N' ie_tela_unica
			from	proc_interno b,
					proc_interno_setor a
			where	a.cd_setor_atendimento = cd_setor_atendimento_w
			and		a.nr_seq_proc_interno   = b.nr_sequencia
			and		b.ie_situacao = 'A'
			and		b.ie_tipo = 'O'
			order by
					ds_prescricao;
		else
			open c09 for
			SELECT	distinct cd_Procedimento nr_sequencia,
					CASE WHEN ie_maiuscula_p='N' THEN coalesce(ds_prescricao,ds_procedimento)  ELSE InitCap(coalesce(ds_prescricao,ds_procedimento)) END  ds_prescricao,
					'N' ie_rotina_uti,
					'N' ie_lado,
					'NC' ie_ctrl_glic,
					'N' ie_topografia,
					3	ie_tipo,
					'N' ie_frase,
					'N' ie_setor,
					'N' ie_indicacao,
					'N' ie_orientacao,
					'N' ie_observacao,
					'N' ie_intervalo,
					'N' ie_exige_condicao,
					0	nr_seq_prot_glic,
					'N' ie_questionar_forma,
					'N' ie_outro_exame,
					'N' ie_contraste,
					'N' ie_questionar_resumo,
					'N' ie_tela_unica
			from	setor_exame_v
			where	cd_setor_atendimento = cd_setor_atendimento_w
			and		ie_origem_proced = ie_origem_proced_p
			and		ie_situacao = 'A'
			order by
					ds_prescricao;
		end if;
		loop
		fetch c09 into	nr_seq_proc_rotina_w,
						ds_prescricao_w,
						ie_rotina_uti_w,
						ie_exige_lado_w,
						ie_ctrl_glic_w,
						ie_topografia_w,
						ie_tipo_w,
						ie_frase_w,
						ie_setor_w,
						ie_exige_indicacao_w,
						ie_orientacao_w,
						ie_observacao_w,
						ie_intervalo_w,
						ie_exige_condicao_w,
						nr_seq_prot_glic_w,
						ie_questionar_forma_w,
						ie_outro_exame_w,
						ie_contraste_w,
						ie_questionar_resumo_w,
						ie_tela_unica_w;
		EXIT WHEN NOT FOUND; /* apply on c09 */
			begin
			insert into	w_proc_rotina_esp_t(
							ie_tipo,
							nr_sequencia,
							nr_seq_proc_rotina,
							ds_prescricao,
							ie_rotina_uti,
							ie_exige_lado,
							ie_ctrl_glic,
							ie_topografia,
							ie_frase,
							ie_setor,
							ie_exige_indicacao,
							ie_orientacao,
							ie_observacao,
							ie_intervalo,
							ie_exige_condicao,
							nr_seq_prot_glic,
							ie_questionar_forma,
							ie_outro_exame,
							ie_contraste,
							ie_questionar_resumo,
							ie_tela_unica,
							nm_usuario,
							nr_seq_grupo,
							nm_usuario_nrec,
							dt_atualizacao,
							dt_atualizacao_nrec,
							ie_pasta,
							ie_marcado)
					values (
							ie_tipo_w,
							nextval('w_proc_rotina_esp_t_seq'),
							nr_seq_proc_rotina_w,
							ds_prescricao_w,
							ie_rotina_uti_w,
							ie_exige_lado_w,
							ie_ctrl_glic_w,
							ie_topografia_w,
							ie_frase_w,
							ie_setor_w,
							ie_exige_indicacao_w,
							ie_orientacao_w,
							ie_observacao_w,
							ie_intervalo_w,
							ie_exige_condicao_w,
							nr_seq_prot_glic_w,
							ie_questionar_forma_w,
							ie_outro_exame_w,
							ie_contraste_w,
							ie_questionar_resumo_w,
							ie_tela_unica_w,
							nm_usuario_p,
							cd_setor_atendimento_w,
							nm_usuario_p,
							clock_timestamp(),
							clock_timestamp(),
							ie_pasta_p,
							'N');
			commit;
			end;
		end loop;
		close c09;
		end;
	end loop;
	close c08;
elsif (ie_pasta_p = 5) then
		open c10;
		loop
		fetch c10 into	nr_seq_grupo_w,
						ds_grupo_w;
		EXIT WHEN NOT FOUND; /* apply on c10 */
			begin
			insert into w_grupo_proc_rot_t(
								nr_sequencia,
								nr_seq_grupo,
								ds_grupo,
								nm_usuario,
								nm_usuario_nrec,
								dt_atualizacao,
								dt_atualizacao_nrec,
								ds_cor,
								ie_pasta)
						values (
								nextval('w_grupo_proc_rot_t_seq'),
								nr_seq_grupo_w,
								ds_grupo_w,
								nm_usuario_p,
								nm_usuario_p,
								clock_timestamp(),
								clock_timestamp(),
								null,
								ie_pasta_p);
			commit;
			open c11;
			loop
			fetch c11 into	ie_tipo_w,
							nr_seq_proc_rotina_w,
							ds_prescricao_w,
							cd_grupo_proc_w,
							ie_rotina_uti_w,
							ie_exige_lado_w,
							ie_ctrl_glic_w,
							ie_topografia_w,
							cd_especialidade_w,
							nr_seq_apres_w,
							ds_cor_w,
							cd_chave_w,
							cd_intervalo_w,
							ie_frase_w,
							ie_setor_w,
							ie_exige_indicacao_w,
							ie_orientacao_w,
							ie_observacao_w,
							ie_intervalo_w,
							ie_exige_condicao_w,
							nr_proc_interno_w,
							ie_questionar_forma_w,
							ie_outro_exame_w,
							ie_contraste_w,
							ie_exige_justificativa_w,
							ie_questionar_resumo_w,
							ie_tela_unica_w;
			EXIT WHEN NOT FOUND; /* apply on c11 */
				begin
				insert into w_proc_rotina_esp_t(
								ie_tipo,
								nr_seq_proc_rotina,
								ds_prescricao,
								cd_grupo_proc,
								ie_rotina_uti,
								ie_exige_lado,
								ie_ctrl_glic,
								ie_topografia,
								cd_especialidade,
								nr_seq_apres,
								ds_cor,
								cd_chave,
								cd_intervalo,
								ie_frase,
								ie_setor,
								ie_exige_indicacao,
								ie_orientacao,
								ie_observacao,
								ie_intervalo,
								ie_exige_condicao,
								nr_seq_proc_interno,
								ie_questionar_forma,
								ie_outro_exame,
								ie_contraste,
								ie_exige_justificativa,
								ie_questionar_resumo,
								ie_tela_unica,
								nr_sequencia,
								nr_seq_grupo,
								nm_usuario,
								nm_usuario_nrec,
								dt_atualizacao,
								dt_atualizacao_nrec,
								ie_pasta)
							values (
								ie_tipo_w,
								nr_seq_proc_rotina_w,
								ds_prescricao_w,
								cd_grupo_proc_w,
								ie_rotina_uti_w,
								ie_exige_lado_w,
								ie_ctrl_glic_w,
								ie_topografia_w,
								cd_especialidade_w,
								nr_seq_apres_w,
								ds_cor_w,
								cd_chave_w,
								cd_intervalo_w,
								ie_frase_w,
								ie_setor_w,
								ie_exige_indicacao_w,
								ie_orientacao_w,
								ie_observacao_w,
								ie_intervalo_w,
								ie_exige_condicao_w,
								nr_proc_interno_w,
								ie_questionar_forma_w,
								ie_outro_exame_w,
								ie_contraste_w,
								ie_exige_justificativa_w,
								ie_questionar_resumo_w,
								ie_tela_unica_w,
								nextval('w_proc_rotina_esp_t_seq'),
								nr_seq_grupo_w,
								nm_usuario_p,
								nm_usuario_p,
								clock_timestamp(),
								clock_timestamp(),
								ie_pasta_p);
				commit;
				end;
			end loop;
			close c11;
			end;
		end loop;
		close c10;
elsif (ie_pasta_p = 6) then
	open c12;
	loop
	fetch c12 into	ie_tipo_w,
					cd_protocolo_w,
					nr_seq_proc_rotina_w,
					nr_seq_subtipo_w,
					nr_seq_proc_w,
					ds_prescricao_w,
					ie_rotina_uti_w,
					ie_exige_lado_w,
					ie_ctrl_glic_w,
					ie_topografia_w,
					cd_intervalo_w,
					ie_frase_w,
					ie_setor_w,
					ie_exige_indicacao_w,
					ie_orientacao_w,
					ie_observacao_w,
					ie_intervalo_w,
					ie_exige_condicao_w,
					nr_seq_prot_glic_w,
					ie_questionar_forma_w,
					ie_outro_exame_w,
					ie_contraste_w,
					ie_exige_justificativa_w,
					ie_questionar_resumo_w,
					ie_tela_unica_w;
	EXIT WHEN NOT FOUND; /* apply on c12 */
		begin

		qt_registro_w := qt_registro_w + 1;
		if (qt_registro_w > qt_reg_coluna_p) then
			nr_seq_grupo_ww := nr_seq_grupo_ww +1;
			qt_registro_w   := 1;
		end if;

		insert into w_proc_rotina_esp_t(
							ie_tipo,
							cd_protocolo,
							nr_seq_proc_rotina,
							nr_seq_subtipo,
							nr_seq_proc,
							ds_prescricao,
							ie_rotina_uti,
							ie_exige_lado,
							ie_ctrl_glic,
							ie_topografia,
							cd_intervalo,
							ie_frase,
							ie_setor,
							ie_exige_indicacao,
							ie_orientacao,
							ie_observacao,
							ie_intervalo,
							ie_exige_condicao,
							nr_seq_prot_glic,
							ie_questionar_forma,
							ie_outro_exame,
							ie_contraste,
							ie_exige_justificativa,
							ie_questionar_resumo,
							ie_tela_unica,
							nr_sequencia,
							nr_seq_grupo,
							ie_pasta,
							nm_usuario,
							nm_usuario_nrec,
							dt_atualizacao,
							dt_atualizacao_nrec)
						values (
							ie_tipo_w,
							cd_protocolo_w,
							nr_seq_proc_rotina_w,
							nr_seq_subtipo_w,
							nr_seq_proc_w,
							ds_prescricao_w,
							ie_rotina_uti_w,
							ie_exige_lado_w,
							ie_ctrl_glic_w,
							ie_topografia_w,
							cd_intervalo_w,
							ie_frase_w,
							ie_setor_w,
							ie_exige_indicacao_w,
							ie_orientacao_w,
							ie_observacao_w,
							ie_intervalo_w,
							ie_exige_condicao_w,
							nr_seq_prot_glic_w,
							ie_questionar_forma_w,
							ie_outro_exame_w,
							ie_contraste_w,
							ie_exige_justificativa_w,
							ie_questionar_resumo_w,
							ie_tela_unica_w,
							nextval('w_proc_rotina_esp_t_seq'),
							nr_seq_grupo_ww,
							ie_pasta_p,
							nm_usuario_p,
							nm_usuario_p,
							clock_timestamp(),
							clock_timestamp());
		commit;
		end;
	end loop;
	close c12;
	open c03;
	loop
	fetch c03 into	nr_seq_grupo_ww,
					ie_tipo_apresent_w;
	EXIT WHEN NOT FOUND; /* apply on c03 */
		begin
		select	nextval('w_grupo_proc_rot_t_seq')
		into STRICT	nr_sequencia_w
		;

		insert into w_grupo_proc_rot_t(
							nr_sequencia,
							nr_seq_grupo,
							ds_grupo,
							nr_seq_apresentacao,
							nm_usuario,
							nm_usuario_nrec,
							dt_atualizacao,
							dt_atualizacao_nrec,
							ds_cor,
							ie_pasta,
							ie_tipo_apresent)
					values (
							nr_sequencia_w,
							nr_seq_grupo_ww,
							' ',
							nr_seq_grupo_ww,
							nm_usuario_p,
							nm_usuario_p,
							clock_timestamp(),
							clock_timestamp(),
							null,
							ie_pasta_p,
							ie_tipo_apresent_w);
		commit;
		end;
	end loop;
	close c03;
elsif (ie_pasta_p = 7) then
	open c13;
	loop
	fetch c13 into	nr_seq_grupo_w,
					ds_grupo_w;
	EXIT WHEN NOT FOUND; /* apply on c13 */
		begin
		insert into w_grupo_proc_rot_t(
							nr_sequencia,
							nr_seq_grupo,
							ds_grupo,
							ie_pasta,
							nm_usuario,
							nm_usuario_nrec,
							dt_atualizacao,
							dt_atualizacao_nrec)
						values (
							nextval('w_grupo_proc_rot_t_seq'),
							nr_seq_grupo_w,
							ds_grupo_w,
							ie_pasta_p,
							nm_usuario_p,
							nm_usuario_p,
							clock_timestamp(),
							clock_timestamp());
		commit;
		open c14;
		loop
		fetch c14 into	ie_tipo_w,
						nr_seq_ordem_w,
						nr_seq_proc_rotina_W,
						ds_prescricao_w,
						ie_rotina_uti_w,
						ie_exige_lado_w,
						ie_ctrl_glic_w,
						ie_topografia_w,
						cd_especialidade_w,
						nr_seq_apres_w,
						ds_cor_w,
						cd_intervalo_w,
						nr_seq_material_w,
						ie_frase_w,
						ie_setor_w,
						ds_inf_adicional_w,
						ie_exige_indicacao_w,
						ie_orientacao_w,
						ie_observacao_w,
						ie_intervalo_w,
						ie_exige_condicao_w,
						nr_seq_prot_glic_w,
						ie_questionar_forma_w,
						ie_outro_exame_w,
						ie_contraste_w,
						ie_exige_justificativa_w,
						ie_questionar_resumo_w,
						ie_tela_unica_w;
		EXIT WHEN NOT FOUND; /* apply on c14 */
			begin
			insert into w_proc_rotina_esp_t(
									ie_tipo,
									nr_seq_ordem,
									nr_seq_proc_rotina,
									ds_prescricao,
									ie_rotina_uti,
									ie_exige_lado,
									ie_ctrl_glic,
									ie_topografia,
									cd_especialidade,
									nr_seq_apres,
									ds_cor,
									cd_intervalo,
									nr_seq_material,
									ie_frase,
									ie_setor,
									ds_inf_adicional,
									ie_exige_indicacao,
									ie_orientacao,
									ie_observacao,
									ie_intervalo,
									ie_exige_condicao,
									nr_seq_prot_glic,
									ie_questionar_forma,
									ie_outro_exame,
									ie_contraste,
									ie_exige_justificativa,
									ie_questionar_resumo,
									ie_tela_unica,
									nr_sequencia,
									nr_seq_grupo,
									nm_usuario,
									nm_usuario_nrec,
									dt_atualizacao,
									dt_atualizacao_nrec,
									ie_pasta)
								values (
									ie_tipo_w,
									nr_seq_ordem_w,
									nr_seq_proc_rotina_W,
									ds_prescricao_w,
									ie_rotina_uti_w,
									ie_exige_lado_w,
									ie_ctrl_glic_w,
									ie_topografia_w,
									cd_especialidade_w,
									nr_seq_apres_w,
									ds_cor_w,
									cd_intervalo_w,
									nr_seq_material_w,
									ie_frase_w,
									ie_setor_w,
									ds_inf_adicional_w,
									ie_exige_indicacao_w,
									ie_orientacao_w,
									ie_observacao_w,
									ie_intervalo_w,
									ie_exige_condicao_w,
									nr_seq_prot_glic_w,
									ie_questionar_forma_w,
									ie_outro_exame_w,
									ie_contraste_w,
									ie_exige_justificativa_w,
									ie_questionar_resumo_w,
									ie_tela_unica_w,
									nextval('w_proc_rotina_esp_t_seq'),
									nr_seq_grupo_w,
									nm_usuario_p,
									nm_usuario_p,
									clock_timestamp(),
									clock_timestamp(),
									ie_pasta_p);
			commit;
			end;
		end loop;
		close c14;
		end;
	end loop;
	close c13;
elsif (ie_pasta_p = 8) then
	open c15;
	loop
	fetch c15 into	ie_tipo_w,
					nr_seq_ordem_w,
					nr_seq_proc_rotina_W,
					ds_prescricao_w,
					ie_rotina_uti_w,
					ie_exige_lado_w,
					ie_ctrl_glic_w,
					ie_topografia_w,
					cd_especialidade_w,
					nr_seq_apres_w,
					ds_cor_w,
					cd_intervalo_w,
					nr_seq_material_w,
					ie_frase_w,
					ie_setor_w,
					ds_inf_adicional_w,
					ie_exige_indicacao_w,
					ie_orientacao_w,
					ie_observacao_w,
					ie_intervalo_w,
					ie_exige_condicao_w,
					nr_seq_prot_glic_w,
					ie_questionar_forma_w,
					ie_outro_exame_w,
					ie_contraste_w,
					ie_exige_justificativa_w,
					ie_questionar_resumo_w,
					ie_tela_unica_w;
	EXIT WHEN NOT FOUND; /* apply on c15 */
		begin
		qt_registro_w := qt_registro_w + 1;
		if (qt_registro_w > qt_reg_coluna_p) then
			nr_seq_grupo_ww := nr_seq_grupo_ww +1;
			qt_registro_w   := 1;
		end if;
		insert into w_proc_rotina_esp_t(
								ie_tipo,
								nr_seq_ordem,
								nr_seq_proc_rotina,
								ds_prescricao,
								ie_rotina_uti,
								ie_exige_lado,
								ie_ctrl_glic,
								ie_topografia,
								cd_especialidade,
								nr_seq_apres,
								ds_cor,
								cd_intervalo,
								nr_seq_material,
								ie_frase,
								ie_setor,
								ds_inf_adicional,
								ie_exige_indicacao,
								ie_orientacao,
								ie_observacao,
								ie_intervalo,
								ie_exige_condicao,
								nr_seq_prot_glic,
								ie_questionar_forma,
								ie_outro_exame,
								ie_contraste,
								ie_exige_justificativa,
								ie_questionar_resumo,
								ie_tela_unica,
								nr_sequencia,
								nr_seq_grupo,
								nm_usuario,
								nm_usuario_nrec,
								dt_atualizacao,
								dt_atualizacao_nrec,
								ie_pasta)
							values (
								ie_tipo_w,
								nr_seq_ordem_w,
								nr_seq_proc_rotina_W,
								ds_prescricao_w,
								ie_rotina_uti_w,
								ie_exige_lado_w,
								ie_ctrl_glic_w,
								ie_topografia_w,
								cd_especialidade_w,
								nr_seq_apres_w,
								ds_cor_w,
								cd_intervalo_w,
								nr_seq_material_w,
								ie_frase_w,
								ie_setor_w,
								ds_inf_adicional_w,
								ie_exige_indicacao_w,
								ie_orientacao_w,
								ie_observacao_w,
								ie_intervalo_w,
								ie_exige_condicao_w,
								nr_seq_prot_glic_w,
								ie_questionar_forma_w,
								ie_outro_exame_w,
								ie_contraste_w,
								ie_exige_justificativa_w,
								ie_questionar_resumo_w,
								ie_tela_unica_w,
								nextval('w_proc_rotina_esp_t_seq'),
								nr_seq_grupo_ww,
								nm_usuario_p,
								nm_usuario_p,
								clock_timestamp(),
								clock_timestamp(),
								ie_pasta_p);
		commit;
		end;
	end loop;
	close c15;
	open c03;
	loop
	fetch c03 into	nr_seq_grupo_ww,
					ie_tipo_apresent_w;
	EXIT WHEN NOT FOUND; /* apply on c03 */
		begin

		insert into w_grupo_proc_rot_t(
							nr_sequencia,
							nr_seq_grupo,
							ds_grupo,
							nr_seq_apresentacao,
							nm_usuario,
							nm_usuario_nrec,
							dt_atualizacao,
							dt_atualizacao_nrec,
							ds_cor,
							ie_pasta,
							ie_tipo_apresent)
					values (
							nextval('w_grupo_proc_rot_t_seq'),
							nr_seq_grupo_ww,
							' ',
							nr_seq_grupo_ww,
							nm_usuario_p,
							nm_usuario_p,
							clock_timestamp(),
							clock_timestamp(),
							null,
							ie_pasta_p,
							ie_tipo_apresent_w);
		commit;
		end;
	end loop;
	close c03;
end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_exames_rotina_especial ( nm_usuario_p text, cd_perfil_p bigint, cd_medico_p text, cd_setor_atendimento_p bigint, cd_estabelecimento_p bigint, ie_consiste_convenio_p text, cd_classif_setor_pac_p bigint, ie_clinica_p bigint, cd_setor_prescr_p bigint, ie_tipo_atendimento_p bigint, cd_convenio_p bigint, ie_sem_grupo_p text, ie_so_convenio_p text, cd_categoria_p bigint, ie_origem_proced_p bigint, ie_tipo_convenio_p bigint, varie_tipo_p text, ie_maiuscula_p text, ie_pasta_p bigint, ie_restringe_estab_p text, qt_reg_coluna_p bigint, ie_todos_p text, ie_ordem_seq_p text, ie_tabela_interna_p text, ie_tipo_p text ) FROM PUBLIC;

