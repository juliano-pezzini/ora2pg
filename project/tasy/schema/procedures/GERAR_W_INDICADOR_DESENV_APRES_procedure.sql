-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_w_indicador_desenv_apres (dt_referencia_p timestamp) AS $body$
DECLARE


/*
	IE_ABRANGENCIA:
IND = Individual
GRU = Grupo de desenvolvimento
GER = GerenciaG
AREA = Area de gerencias
DIRE = Diretorias
*/
qt_defeito_w			bigint;
pr_defeito_w			double precision;
qt_os_antiga_w			bigint;
pr_antiga_w			double precision;
qt_insatisf_w			bigint;
qt_os_satisf_inform_w		bigint;
qt_os_recebida_w		bigint;
qt_ordem_colaborador_w		bigint;
qt_dias_mes_w			bigint;
qt_colaborador_planej_real_w	integer;
qt_colaborador_projetos_w	integer;
qt_dias_atual_mes_w		bigint;
qt_ordem_planej_real_w		double precision;
pr_satisf_w			double precision;
pr_assertividade_w		double precision;
pr_teste_analista_w		double precision;
pr_previsao_w			double precision;
qt_media_producao_w		double precision;
qt_os_w				bigint;
qt_sem_previsao_w		bigint;
qt_mes_corrente_w		bigint;
qt_sla_w			bigint;
qt_recurso_projeto_w		double precision;
qt_encerrada_pessoa_w		double precision;
dt_referencia_w			timestamp;
qt_pessoas_w			double precision;

c01 CURSOR FOR
SELECT 	substr(/*'Total Geral '*/
obter_desc_expressao(503454) || ds_diretoria,1,100) ds_diretoria,
	nr_seq_diretoria,
	obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'PR','M') pr_defeito_mes,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'PR','AC') pr_defeito_ano,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'PRIN','M') pr_defeito_philips_mes,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'PRIN','AC') pr_defeito_philips_ano,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'PREX','M') pr_defeito_cliente_mes,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'PREX','AC') pr_defeito_cliente_ano,
        100- obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'PRI','M') pr_satisfacao_mes,
        100- obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'PRI','AC') pr_satisfacao_ano,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTD','M') qt_os_recebida_mes,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTD','AC') qt_os_recebida_ano,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'EN','M') qt_os_encerrada_mes,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'EN','AC') qt_os_encerrada_ano,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'EN','ACM') qt_os_encerrada_ano_mes,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'ER','M') qt_erro_mes,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTI','M') qt_insatisfacao_mes,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'ENS','M') qt_satisfacao_inf_mes,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'PRANTIGA','M') pr_os_antiga_mes,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTANTIGA','M') qt_os_antiga_mes,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTBACKLOG','M') qt_backlog,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTRECCLI','M') qt_recebida_cliente_mes,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTRECINT','M') qt_recebida_philips_mes,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTBACKCLI','M') qt_backlog_cliente,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTBACKINT','M') qt_backlog_philips,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTSLA','M') qt_sla,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTBACKLOGDEF','M') qt_backlog_defeito,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTANNE','N') qt_analista_negocio,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTANSI','S') qt_analista_sistema,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTANMA','M') qt_analista_manutencao,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTPROG','P') qt_programador,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTESTA','E') qt_estagiario,
	obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QAUSEN','M') qt_pessoa_ausente,
	obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTHORADIA','M') qt_horas_trab_dia,
        obter_qt_dia_util_periodo(trunc(dt_referencia_w,'month'), dt_referencia_w,1) qt_dias_util,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTHORAOS','M') qt_horas_trab_os,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTHORAOSCLI','M') qt_horas_trab_os_cliente,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTHORAOSINT','M') qt_horas_trab_os_philips,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTRECEBDIA','M') qt_os_recebida_dia,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTRECEBDIACLI','M') qt_os_recebida_dia_cliente,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTRECEBDIAINT','M') qt_os_recebida_dia_philips,
       	obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTPFPRODUT','ACM') qt_pessoa_periodo,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTBACKPENDCLI','M') qt_backlog_pend_cliente,
        obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTBACKPENDVEV','M') qt_backlog_pend_vev,
	obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTHE','M') qt_hora_extra,
	obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'MEHEPF','M') qt_media_hora_extra_pessoa,
	obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTNET','M') qt_net,
	obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'PRINOV','M') pr_inovacao,
	obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTPFDELPHI','M') qt_hc_delphi,
	obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTPFJAVA','M') qt_hc_java,
	obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QTPFHTML5','M') qt_hc_html5,
	obter_info_os_diretoria(dt_referencia_w,nr_seq_diretoria,'QFPFCAP','M') qt_hc_capitalizado,
	phi_defect_measures_pck.get_defect_rate(dt_referencia_w, nr_seq_diretoria, null, null, null) qt_def_rate_mes,
	phi_defect_measures_pck.get_accumulated_indicator(dt_referencia_w, nr_seq_diretoria, null, null, 'DRA') qt_def_rate_ano
from (SELECT	nr_sequencia nr_seq_diretoria,
		ds_diretoria
	from    diretoria_philips
	where   ie_situacao	= 'A') alias55;


c02 CURSOR FOR
SELECT 	substr(/*'Total Geral '*/
obter_desc_expressao(503454) || ds_valor_dominio,1,100) ds_gerencia,
	ie_area_gerencia,
	obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'PR','M') pr_defeito_mes,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'PR','AC') pr_defeito_ano,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'PRIN','M') pr_defeito_philips_mes,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'PRIN','AC') pr_defeito_philips_ano,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'PREX','M') pr_defeito_cliente_mes,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'PREX','AC') pr_defeito_cliente_ano,
        100- obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'PRI','M') pr_satisfacao_mes,
        100- obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'PRI','AC') pr_satisfacao_ano,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTD','M') qt_os_recebida_mes,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTD','AC') qt_os_recebida_ano,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'EN','M') qt_os_encerrada_mes,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'EN','AC') qt_os_encerrada_ano,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'EN','ACM') qt_os_encerrada_ano_mes,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'ER','M') qt_erro_mes,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTI','M') qt_insatisfacao_mes,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'ENS','M') qt_satisfacao_inf_mes,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'PRANTIGA','M') pr_os_antiga_mes,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTANTIGA','M') qt_os_antiga_mes,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTBACKLOG','M') qt_backlog,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTRECCLI','M') qt_recebida_cliente_mes,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTRECINT','M') qt_recebida_philips_mes,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTBACKCLI','M') qt_backlog_cliente,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTBACKINT','M') qt_backlog_philips,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTSLA','M') qt_sla,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTBACKLOGDEF','M') qt_backlog_defeito,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTANNE','N') qt_analista_negocio,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTANSI','S') qt_analista_sistema,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTANMA','M') qt_analista_manutencao,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTPROG','P') qt_programador,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTESTA','E') qt_estagiario,
	obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QAUSEN','M') qt_pessoa_ausente,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTHORADIA','M') qt_horas_trab_dia,
        obter_qt_dia_util_periodo(trunc(dt_referencia_w,'month'), dt_referencia_w,1) qt_dias_util,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTHORAOS','M') qt_horas_trab_os,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTHORAOSCLI','M') qt_horas_trab_os_cliente,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTHORAOSINT','M') qt_horas_trab_os_philips,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTRECEBDIA','M') qt_os_recebida_dia,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTRECEBDIACLI','M') qt_os_recebida_dia_cliente,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTRECEBDIAINT','M') qt_os_recebida_dia_philips,
       	obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTPFPRODUT','ACM') qt_pessoa_periodo,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTBACKPENDCLI','M') qt_backlog_pend_cliente,
        obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTBACKPENDVEV','M') qt_backlog_pend_vev,
	obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTHE','M') qt_hora_extra,
	obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'MEHEPF','M') qt_media_hora_extra_pessoa,
	obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTNET','M') qt_net,
	obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'PRINOV','M') pr_inovacao,
	obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTPFDELPHI','M') qt_hc_delphi,
	obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTPFJAVA','M') qt_hc_java,
	obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QTPFHTML5','M') qt_hc_html5,
	obter_info_os_gerencia_area(dt_referencia_w,ie_area_gerencia,'QFPFCAP','M') qt_hc_capitalizado
from (SELECT  distinct a.ie_area_gerencia,
				b.ds_valor_dominio
		from    valor_dominio b,
			gerencia_wheb a
		where   a.ie_area_gerencia = b.vl_dominio
		and	b.cd_dominio = 5551
		and	a.ie_situacao = 'A'
		and	a.ie_area_gerencia in ('DES','IES','PDES','TEC')) alias54;




c03 CURSOR FOR
SELECT  a.nr_sequencia,
	a.ds_gerencia,
	a.ie_area_gerencia,
	obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'PR','M') pr_defeito_mes,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'PR','AC') pr_defeito_ano,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'PRIN','M') pr_defeito_philips_mes,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'PRIN','AC') pr_defeito_philips_ano,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'PREX','M') pr_defeito_cliente_mes,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'PREX','AC') pr_defeito_cliente_ano,
        100- obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'PRI','M') pr_satisfacao_mes,
        100- obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'PRI','AC') pr_satisfacao_ano,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTD','M') qt_os_recebida_mes,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTD','AC') qt_os_recebida_ano,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'EN','M') qt_os_encerrada_mes,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'EN','AC') qt_os_encerrada_ano,
	obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'EN','ACM') qt_os_encerrada_ano_mes,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'ER','M') qt_erro_mes,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTI','M') qt_insatisfacao_mes,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'ENS','M') qt_satisfacao_inf_mes,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'PRANTIGA','M') pr_os_antiga_mes,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTANTIGA','M') qt_os_antiga_mes,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTBACKLOG','M') qt_backlog,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTRECCLI','M') qt_recebida_cliente_mes,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTRECINT','M') qt_recebida_philips_mes,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTBACKCLI','M') qt_backlog_cliente,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTBACKINT','M') qt_backlog_philips,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTSLAD','M') qt_sla,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTBACKLOGDEF','M') qt_backlog_defeito,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTANNE','N') qt_analista_negocio,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTANSI','S') qt_analista_sistema,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTANMA','M') qt_analista_manutencao,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTPROG','P') qt_programador,
	obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTESTA','E') qt_estagiario,
	obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QAUSEN','M') qt_pessoa_ausente,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTHORADIA','M') qt_horas_trab_dia,
        obter_qt_dia_util_periodo(trunc(dt_referencia_w,'month'), dt_referencia_w,1) qt_dias_util,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTHORAOS','M') qt_horas_trab_os,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTHORAOSCLI','M') qt_horas_trab_os_cliente,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTHORAOSINT','M') qt_horas_trab_os_philips,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTRECEBDIA','M') qt_os_recebida_dia,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTRECEBDIACLI','M') qt_os_recebida_dia_cliente,
        obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTRECEBDIAINT','M') qt_os_recebida_dia_philips,
       	obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTPFPRODUT','ACM') qt_pessoa_periodo,
	obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTBACKPENDCLI','M') qt_backlog_pend_cliente,
	obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTBACKPENDVEV','M') qt_backlog_pend_vev,
	obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTHE','M') qt_hora_extra,
	obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'MEHEPF','M') qt_media_hora_extra_pessoa,
	obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTNET','M') qt_net,
	obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'PRINOV','M') pr_inovacao,
	obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTPFDELPHI','M') qt_hc_delphi,
	obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTPFJAVA','M') qt_hc_java,
	obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QTPFHTML5','M') qt_hc_html5,
	obter_informacao_os_gerencia(dt_referencia_w,a.nr_sequencia,'QFPFCAP','M') qt_hc_capitalizado,
	phi_defect_measures_pck.get_defect_rate(dt_referencia_w, null, a.nr_sequencia, null, null) qt_def_rate_mes,
	phi_defect_measures_pck.get_accumulated_indicator(dt_referencia_w, null, a.nr_sequencia, null, 'DRA') qt_def_rate_ano
from	gerencia_wheb a
where	a.ie_area_gerencia in ('DES','IES','PDES','TEC')
and	coalesce(a.ie_situacao,'A') = 'A';

c04 CURSOR FOR
SELECT	b.nr_sequencia,
        b.nr_seq_gerencia,
	a.ie_area_gerencia,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'PR','M') pr_defeito_mes,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'PR','AC') pr_defeito_ano,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'PRIN','M') pr_defeito_philips_mes,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'PRIN','AC') pr_defeito_philips_ano,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'PREX','M') pr_defeito_cliente_mes,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'PREX','AC') pr_defeito_cliente_ano,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'PRANTIGA','M') pr_os_antiga_mes,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTANTIGA','M') qt_os_antiga_mes,
        100- obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'PRY','M') pr_satisfacao_mes,
        100- obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'PRY','AC') pr_satisfacao_ano,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTY','M') qt_insatisfacao_mes,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'ENS','M') qt_satisfacao_inf_mes,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'ER','M') qt_erro_mes,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTD','M') qt_os_recebida_mes,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTD','AC') qt_os_recebida_ano,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'EN','M') qt_os_encerrada_mes,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'EN','AC') qt_os_encerrada_ano,
	obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'EN','ACM') qt_os_encerrada_ano_mes,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTSLA','M') qt_sla,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTBACKLOGDEF','M') qt_backlog_defeito,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTBACKLOG','M') qt_backlog,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTRECCLI','M') qt_recebida_cliente_mes,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTRECINT','M') qt_recebida_philips_mes,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTBACKCLI','M') qt_backlog_cliente,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTBACKINT','M') qt_backlog_philips,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTANNE','N') qt_analista_negocio,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTANSI','S') qt_analista_sistema,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTANMA','M') qt_analista_manutencao,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTPROG','P') qt_programador,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTESTA','E') qt_estagiario,
	obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QAUSEN','E') qt_pessoa_ausente,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTHORADIA','M') qt_horas_trab_dia,
        obter_qt_dia_util_periodo(trunc(dt_referencia_w,'month'), dt_referencia_w,1) qt_dias_util,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTHORAOS','M') qt_horas_trab_os,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTHORAOSCLI','M') qt_horas_trab_os_cliente,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTHORAOSINT','M') qt_horas_trab_os_philips,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTRECEBDIA','M') qt_os_recebida_dia,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTRECEBDIACLI','M') qt_os_recebida_dia_cliente,
        obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTRECEBDIAINT','M') qt_os_recebida_dia_philips,
	obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTPFPRODUT','ACM') qt_pessoa_periodo,
	obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTBACKPENDCLI','M') qt_backlog_pend_cliente,
	obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTBACKPENDVEV','M') qt_backlog_pend_vev,
	obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTHE','M') qt_hora_extra,
	obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'MEHEPF','M') qt_media_hora_extra_pessoa,
	obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTNET','M') qt_net,
	obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'PRINOV','M') pr_inovacao,
	obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTPFDELPHI','M') qt_hc_delphi,
	obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTPFJAVA','M') qt_hc_java,
	obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QTPFHTML5','M') qt_hc_html5,
	obter_informacao_os_grupo(dt_referencia_w,b.nr_sequencia,'QFPFCAP','M') qt_hc_capitalizado,
	phi_defect_measures_pck.get_defect_rate(dt_referencia_w, null, null, b.nr_sequencia, null) qt_def_rate_mes,
	phi_defect_measures_pck.get_accumulated_indicator(dt_referencia_w, null, null, b.nr_sequencia, 'DRA') qt_def_rate_ano
from	gerencia_wheb a,
	grupo_desenvolvimento b
where	a.nr_sequencia = b.nr_seq_gerencia
and	coalesce(b.ie_situacao,'A') = 'A'
and	(nr_seq_gerencia IS NOT NULL AND nr_seq_gerencia::text <> '')
and	a.ie_area_gerencia in ('DES','IES','PDES','TEC')
and	coalesce(a.ie_situacao,'A') = 'A';


c05 CURSOR FOR
SELECT	x.nm_usuario_grupo,
	c.cd_pessoa_fisica,
	b.nr_seq_gerencia,
	b.nr_sequencia
from	usuario c,
	grupo_desenvolvimento b,
	usuario_grupo_des x
where	x.nr_seq_grupo		= b.nr_sequencia
and	x.nm_usuario_grupo	= c.nm_usuario
and	coalesce(b.ie_situacao,'A')	= 'A'
and	(b.nr_seq_gerencia IS NOT NULL AND b.nr_seq_gerencia::text <> '');

c01_w c01%rowtype;
c02_w c02%rowtype;
c03_w c03%rowtype;
c04_w c04%rowtype;
c05_w c05%rowtype;


BEGIN

dt_referencia_w	:= trunc(dt_referencia_p);

delete	FROM w_indicador_desenv_apres
where	dt_referencia = trunc(dt_referencia_w);

commit;

if (trunc(dt_referencia_p,'month') = trunc(clock_timestamp(),'month')) then
	update	man_planejamento_meta
	set	qt_ordem_planej_real				= 0
	where	trunc(dt_mes_referencia,'month')	= trunc(dt_referencia_p,'month');

	CALL man_gerar_planej_real(trunc(dt_referencia_p,'month'), 'Tasy');
end if;


open c01;
loop
fetch c01 into
	c01_w;
EXIT WHEN NOT FOUND; /* apply on c01 */

	qt_pessoas_w	:= c01_w.qt_analista_negocio + c01_w.qt_analista_sistema + c01_w.qt_analista_manutencao + c01_w.qt_programador;

	insert into w_indicador_desenv_apres(nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_grupo,
		nr_seq_gerencia,
		ds_gerencia,
		cd_pessoa_fisica,
		qt_os_defeito,
		pr_defeito,
		qt_os_antiga,
		pr_os_antiga,
		qt_os_insatisfacao,
		qt_os_satisf_inf,
		qt_os_recebida,
		pr_satisfacao,
		dt_referencia,
		pr_assertividade,
		ie_abrangencia,
		qt_os_pessoa,
		qt_total_os,
		qt_sem_previsao,
		qt_sla_pendente,
		pr_teste_analista,
		qt_os_baixada,
		pr_previsao,
		qt_analista_negocio,
		qt_analista_sistemas,
		qt_analista_manut,
		qt_programador,
		qt_estagiario,
		qt_total_pessoas,
		qt_pessoa_ausente,
		qt_encerrada_pessoa,
		qt_recurso_projeto,
		pr_defeito_ano,
		qt_backlog_defeito,
		qt_backlog_philips,
		qt_horas_trab_dia,
		qt_horas_trab_os,
		qt_horas_trab_os_cliente,
		qt_horas_trab_os_philips,
		qt_os_encerrada_pf_ano,
		qt_escore_ano,
		qt_escore_mes,
		qt_os_recebida_dia,
		qt_os_recebida_dia_philips,
		qt_os_recebida_dia_cliente,
		qt_recebida_cliente_mes,
		qt_recebida_philips_mes,
		qt_os_recebida_ano,
		qt_os_encerrada_mes,
		qt_os_encerrada_ano,
		pr_defeito_philips_ano,
		pr_defeito_philips_mes,
		pr_defeito_cliente_mes,
		pr_defeito_cliente_ano,
		pr_satisfacao_ano,
		qt_backlog_cliente,
		qt_backlog_pend_cliente,
		qt_backlog_pend_vev,
		nr_seq_diretoria,
		qt_net,
		qt_hora_extra,
		qt_media_hora_extra_pessoa,
		pr_inovacao,
		qt_hc_delphi,
		qt_hc_java,
		qt_hc_html5,
		qt_hc_capitalizado,
		qt_def_rate_mes,
		qt_def_rate_ano)
	values (nextval('w_indicador_desenv_apres_seq'),
		clock_timestamp(),
		'Tasy',
		clock_timestamp(),
		'Tasy',
		null,
		null,
		c01_w.ds_diretoria,
		null,
		c01_w.qt_erro_mes,
		c01_w.pr_defeito_mes,
		c01_w.qt_os_antiga_mes,
		c01_w.pr_os_antiga_mes,
		c01_w.qt_insatisfacao_mes,
		c01_w.qt_satisfacao_inf_mes,
		c01_w.qt_os_recebida_mes,
		c01_w.pr_satisfacao_mes,
		dt_referencia_w,
		pr_assertividade_w,
		'DIRE',
		dividir(c01_w.qt_os_recebida_mes,qt_pessoas_w - c01_w.qt_pessoa_ausente),
		c01_w.qt_backlog,
		qt_sem_previsao_w,
		c01_w.qt_sla,
		null,
		null,
		pr_previsao_w,
		c01_w.qt_analista_negocio,
		c01_w.qt_analista_sistema,
		c01_w.qt_analista_manutencao,
		c01_w.qt_programador,
		c01_w.qt_estagiario,
		qt_pessoas_w,
		c01_w.qt_pessoa_ausente,
		dividir(c01_w.qt_os_encerrada_mes,qt_pessoas_w - c01_w.qt_pessoa_ausente),
		round(qt_pessoas_w * 20 /100),
		c01_w.pr_defeito_ano,
		c01_w.qt_backlog_defeito,
		c01_w.qt_backlog_philips,
		dividir(dividir(c01_w.qt_horas_trab_dia,c01_w.qt_dias_util),qt_pessoas_w - c01_w.qt_pessoa_ausente),
		c01_w.qt_horas_trab_os,
		c01_w.qt_horas_trab_os_cliente,
		c01_w.qt_horas_trab_os_philips,
		round(dividir(c01_w.qt_os_encerrada_ano_mes,c01_w.qt_pessoa_periodo)),
		null,
		null,
		c01_w.qt_os_recebida_dia,
		c01_w.qt_os_recebida_dia_philips,
		c01_w.qt_os_recebida_dia_cliente,
		c01_w.qt_recebida_cliente_mes,
		c01_w.qt_recebida_philips_mes,
		c01_w.qt_os_recebida_ano,
		c01_w.qt_os_encerrada_mes,
		c01_w.qt_os_encerrada_ano,
		c01_w.pr_defeito_philips_ano,
		c01_w.pr_defeito_philips_mes,
		c01_w.pr_defeito_cliente_mes,
		c01_w.pr_defeito_cliente_ano,
		c01_w.pr_satisfacao_ano,
		c01_w.qt_backlog_cliente,
		c01_w.qt_backlog_pend_cliente,
		c01_w.qt_backlog_pend_vev,
		c01_w.nr_seq_diretoria,
		c01_w.qt_net,
		c01_w.qt_hora_extra,
		c01_w.qt_media_hora_extra_pessoa,
		c01_w.pr_inovacao,
		c01_w.qt_hc_delphi,
		c01_w.qt_hc_java,
		c01_w.qt_hc_html5,
		c01_w.qt_hc_capitalizado,
		c01_w.qt_def_rate_mes,
		c01_w.qt_def_rate_ano);

	commit;
end loop;
close c01;


open c02;
loop
fetch c02 into
	c02_w;
EXIT WHEN NOT FOUND; /* apply on c02 */

	qt_pessoas_w	:= c02_w.qt_analista_negocio + c02_w.qt_analista_sistema + c02_w.qt_analista_manutencao + c02_w.qt_programador;

	insert into w_indicador_desenv_apres(nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_grupo,
		nr_seq_gerencia,
		ds_gerencia,
		cd_pessoa_fisica,
		qt_os_defeito,
		pr_defeito,
		qt_os_antiga,
		pr_os_antiga,
		qt_os_insatisfacao,
		qt_os_satisf_inf,
		qt_os_recebida,
		pr_satisfacao,
		dt_referencia,
		pr_assertividade,
		ie_abrangencia,
		qt_os_pessoa,
		qt_total_os,
		qt_sem_previsao,
		qt_sla_pendente,
		pr_teste_analista,
		qt_os_baixada,
		pr_previsao,
		qt_analista_negocio,
		qt_analista_sistemas,
		qt_analista_manut,
		qt_programador,
		qt_estagiario,
		qt_total_pessoas,
		qt_pessoa_ausente,
		qt_encerrada_pessoa,
		qt_recurso_projeto,
		pr_defeito_ano,
		qt_backlog_defeito,
		qt_backlog_philips,
		qt_horas_trab_dia,
		qt_horas_trab_os,
		qt_horas_trab_os_cliente,
		qt_horas_trab_os_philips,
		qt_os_encerrada_pf_ano,
		qt_escore_ano,
		qt_escore_mes,
		qt_os_recebida_dia,
		qt_os_recebida_dia_philips,
		qt_os_recebida_dia_cliente,
		qt_recebida_cliente_mes,
		qt_recebida_philips_mes,
		qt_os_recebida_ano,
		qt_os_encerrada_mes,
		qt_os_encerrada_ano,
		pr_defeito_philips_ano,
		pr_defeito_philips_mes,
		pr_defeito_cliente_mes,
		pr_defeito_cliente_ano,
		pr_satisfacao_ano,
		qt_backlog_cliente,
		qt_backlog_pend_cliente,
		qt_backlog_pend_vev,
		ie_area_gerencia,
		qt_net,
		qt_hora_extra,
		qt_media_hora_extra_pessoa,
		pr_inovacao,
		qt_hc_delphi,
		qt_hc_java,
		qt_hc_html5,
		qt_hc_capitalizado)
	values (nextval('w_indicador_desenv_apres_seq'),
		clock_timestamp(),
		'Tasy',
		clock_timestamp(),
		'Tasy',
		null,
		null,
		c02_w.ds_gerencia,
		null,
		c02_w.qt_erro_mes,
		c02_w.pr_defeito_mes,
		c02_w.qt_os_antiga_mes,
		c02_w.pr_os_antiga_mes,
		c02_w.qt_insatisfacao_mes,
		c02_w.qt_satisfacao_inf_mes,
		c02_w.qt_os_recebida_mes,
		c02_w.pr_satisfacao_mes,
		dt_referencia_w,
		pr_assertividade_w,
		'AREA',
		dividir(c02_w.qt_os_recebida_mes,qt_pessoas_w - c02_w.qt_pessoa_ausente),
		c02_w.qt_backlog,
		qt_sem_previsao_w,
		c02_w.qt_sla,
		null,
		null,
		pr_previsao_w,
		c02_w.qt_analista_negocio,
		c02_w.qt_analista_sistema,
		c02_w.qt_analista_manutencao,
		c02_w.qt_programador,
		c02_w.qt_estagiario,
		qt_pessoas_w,
		c02_w.qt_pessoa_ausente,
		dividir(c02_w.qt_os_encerrada_mes,qt_pessoas_w - c02_w.qt_pessoa_ausente),
		round(qt_pessoas_w * 20 /100),
		c02_w.pr_defeito_ano,
		c02_w.qt_backlog_defeito,
		c02_w.qt_backlog_philips,
		dividir(dividir(c02_w.qt_horas_trab_dia,c02_w.qt_dias_util),qt_pessoas_w - c02_w.qt_pessoa_ausente),
		c02_w.qt_horas_trab_os,
		c02_w.qt_horas_trab_os_cliente,
		c02_w.qt_horas_trab_os_philips,
		round(dividir(c02_w.qt_os_encerrada_ano_mes,c02_w.qt_pessoa_periodo)),
		null,
		null,
		c02_w.qt_os_recebida_dia,
		c02_w.qt_os_recebida_dia_philips,
		c02_w.qt_os_recebida_dia_cliente,
		c02_w.qt_recebida_cliente_mes,
		c02_w.qt_recebida_philips_mes,
		c02_w.qt_os_recebida_ano,
		c02_w.qt_os_encerrada_mes,
		c02_w.qt_os_encerrada_ano,
		c02_w.pr_defeito_philips_ano,
		c02_w.pr_defeito_philips_mes,
		c02_w.pr_defeito_cliente_mes,
		c02_w.pr_defeito_cliente_ano,
		c02_w.pr_satisfacao_ano,
		c02_w.qt_backlog_cliente,
		c02_w.qt_backlog_pend_cliente,
		c02_w.qt_backlog_pend_vev,
		c02_w.ie_area_gerencia,
		c02_w.qt_net,
		c02_w.qt_hora_extra,
		c02_w.qt_media_hora_extra_pessoa,
		c02_w.pr_inovacao,
		c02_w.qt_hc_delphi,
		c02_w.qt_hc_java,
		c02_w.qt_hc_html5,
		c02_w.qt_hc_capitalizado);

	commit;
end loop;
close c02;


open c03;
loop
fetch c03 into
	c03_w;
EXIT WHEN NOT FOUND; /* apply on c03 */

	qt_pessoas_w	:= c03_w.qt_analista_negocio + c03_w.qt_analista_sistema + c03_w.qt_analista_manutencao + c03_w.qt_programador;

	insert into w_indicador_desenv_apres(nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_grupo,
		nr_seq_gerencia,
		cd_pessoa_fisica,
		qt_os_defeito,
		pr_defeito,
		qt_os_antiga,
		pr_os_antiga,
		qt_os_insatisfacao,
		qt_os_satisf_inf,
		qt_os_recebida,
		pr_satisfacao,
		dt_referencia,
		pr_assertividade,
		ie_abrangencia,
		qt_os_pessoa,
		qt_total_os,
		qt_sem_previsao,
		qt_sla_pendente,
		pr_teste_analista,
		qt_os_baixada,
		pr_previsao,
		qt_analista_negocio,
		qt_analista_sistemas,
		qt_analista_manut,
		qt_programador,
		qt_estagiario,
		qt_total_pessoas,
		qt_pessoa_ausente,
		qt_encerrada_pessoa,
		qt_recurso_projeto,
		pr_defeito_ano,
		qt_backlog_defeito,
		qt_backlog_philips,
		qt_horas_trab_dia,
		qt_horas_trab_os,
		qt_horas_trab_os_cliente,
		qt_horas_trab_os_philips,
		qt_os_encerrada_pf_ano,
		qt_escore_ano,
		qt_escore_mes,
		qt_os_recebida_dia,
		qt_os_recebida_dia_philips,
		qt_os_recebida_dia_cliente,
		qt_recebida_cliente_mes,
		qt_recebida_philips_mes,
		qt_os_recebida_ano,
		qt_os_encerrada_mes,
		qt_os_encerrada_ano,
		pr_defeito_philips_ano,
		pr_defeito_philips_mes,
		pr_defeito_cliente_mes,
		pr_defeito_cliente_ano,
		pr_satisfacao_ano,
		qt_backlog_cliente,
		qt_backlog_pend_cliente,
		qt_backlog_pend_vev,
		ie_area_gerencia,
		qt_net,
		qt_hora_extra,
		qt_media_hora_extra_pessoa,
		pr_inovacao,
		qt_hc_delphi,
		qt_hc_java,
		qt_hc_html5,
		qt_hc_capitalizado,
		qt_def_rate_mes,
		qt_def_rate_ano)
	values (nextval('w_indicador_desenv_apres_seq'),
		clock_timestamp(),
		'Tasy',
		clock_timestamp(),
		'Tasy',
		null,
		c03_w.nr_sequencia,
		null,
		c03_w.qt_erro_mes,
		c03_w.pr_defeito_mes,
		c03_w.qt_os_antiga_mes,
		c03_w.pr_os_antiga_mes,
		c03_w.qt_insatisfacao_mes,
		c03_w.qt_satisfacao_inf_mes,
		c03_w.qt_os_recebida_mes,
		c03_w.pr_satisfacao_mes,
		dt_referencia_w,
		pr_assertividade_w,
		'GER',
		dividir(c03_w.qt_os_recebida_mes,qt_pessoas_w - c03_w.qt_pessoa_ausente),
		c03_w.qt_backlog,
		qt_sem_previsao_w,
		c03_w.qt_sla,
		null,
		null,
		pr_previsao_w,
		c03_w.qt_analista_negocio,
		c03_w.qt_analista_sistema,
		c03_w.qt_analista_manutencao,
		c03_w.qt_programador,
		c03_w.qt_estagiario,
		qt_pessoas_w,
		c03_w.qt_pessoa_ausente,
		dividir(c03_w.qt_os_encerrada_mes,qt_pessoas_w - c03_w.qt_pessoa_ausente),
		round(qt_pessoas_w * 20 /100),
		c03_w.pr_defeito_ano,
		c03_w.qt_backlog_defeito,
		c03_w.qt_backlog_philips,
		dividir(dividir(c03_w.qt_horas_trab_dia,c03_w.qt_dias_util),qt_pessoas_w - c03_w.qt_pessoa_ausente),
		c03_w.qt_horas_trab_os,
		c03_w.qt_horas_trab_os_cliente,
		c03_w.qt_horas_trab_os_philips,
		round(dividir(c03_w.qt_os_encerrada_ano_mes,c03_w.qt_pessoa_periodo)),
		null,
		null,
		c03_w.qt_os_recebida_dia,
		c03_w.qt_os_recebida_dia_philips,
		c03_w.qt_os_recebida_dia_cliente,
		c03_w.qt_recebida_cliente_mes,
		c03_w.qt_recebida_philips_mes,
		c03_w.qt_os_recebida_ano,
		c03_w.qt_os_encerrada_mes,
		c03_w.qt_os_encerrada_ano,
		c03_w.pr_defeito_philips_ano,
		c03_w.pr_defeito_philips_mes,
		c03_w.pr_defeito_cliente_mes,
		c03_w.pr_defeito_cliente_ano,
		c03_w.pr_satisfacao_ano,
		c03_w.qt_backlog_cliente,
		c03_w.qt_backlog_pend_cliente,
		c03_w.qt_backlog_pend_vev,
		c03_w.ie_area_gerencia,
		c03_w.qt_net,
		c03_w.qt_hora_extra,
		c03_w.qt_media_hora_extra_pessoa,
		c03_w.pr_inovacao,
		c03_w.qt_hc_delphi,
		c03_w.qt_hc_java,
		c03_w.qt_hc_html5,
		c03_w.qt_hc_capitalizado,
		c03_w.qt_def_rate_mes,
		c03_w.qt_def_rate_ano);

	commit;
end loop;
close c03;


open c04;
loop
fetch c04 into
	c04_w;
EXIT WHEN NOT FOUND; /* apply on c04 */

	qt_pessoas_w	:= c04_w.qt_analista_negocio + c04_w.qt_analista_sistema + c04_w.qt_analista_manutencao + c04_w.qt_programador;

	insert into w_indicador_desenv_apres(nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_grupo,
		nr_seq_gerencia,
		cd_pessoa_fisica,
		qt_os_defeito,
		pr_defeito,
		qt_os_antiga,
		pr_os_antiga,
		qt_os_insatisfacao,
		qt_os_satisf_inf,
		qt_os_recebida,
		pr_satisfacao,
		dt_referencia,
		pr_assertividade,
		ie_abrangencia,
		qt_os_pessoa,
		qt_total_os,
		qt_sem_previsao,
		qt_sla_pendente,
		pr_teste_analista,
		qt_os_baixada,
		pr_previsao,
		qt_analista_negocio,
		qt_analista_sistemas,
		qt_analista_manut,
		qt_programador,
		qt_estagiario,
		qt_total_pessoas,
		qt_pessoa_ausente,
		qt_encerrada_pessoa,
		qt_recurso_projeto,
		pr_defeito_ano,
		qt_backlog_defeito,
		qt_backlog_philips,
		qt_horas_trab_dia,
		qt_horas_trab_os,
		qt_horas_trab_os_cliente,
		qt_horas_trab_os_philips,
		qt_os_encerrada_pf_ano,
		qt_escore_ano,
		qt_escore_mes,
		qt_os_recebida_dia,
		qt_os_recebida_dia_philips,
		qt_os_recebida_dia_cliente,
		qt_recebida_cliente_mes,
		qt_recebida_philips_mes,
		qt_os_recebida_ano,
		qt_os_encerrada_mes,
		qt_os_encerrada_ano,
		pr_defeito_philips_ano,
		pr_defeito_philips_mes,
		pr_defeito_cliente_mes,
		pr_defeito_cliente_ano,
		pr_satisfacao_ano,
		qt_backlog_cliente,
		qt_backlog_pend_cliente,
		qt_backlog_pend_vev,
		ie_area_gerencia,
		qt_net,
		qt_hora_extra,
		qt_media_hora_extra_pessoa,
		pr_inovacao,
		qt_hc_delphi,
		qt_hc_java,
		qt_hc_html5,
		qt_hc_capitalizado,
		qt_def_rate_mes,
		qt_def_rate_ano)
	values (nextval('w_indicador_desenv_apres_seq'),
		clock_timestamp(),
		'Tasy',
		clock_timestamp(),
		'Tasy',
		c04_w.nr_sequencia,
		c04_w.nr_seq_gerencia,
		null,
		c04_w.qt_erro_mes,
		c04_w.pr_defeito_mes,
		c04_w.qt_os_antiga_mes,
		c04_w.pr_os_antiga_mes,
		c04_w.qt_insatisfacao_mes,
		c04_w.qt_satisfacao_inf_mes,
		c04_w.qt_os_recebida_mes,
		c04_w.pr_satisfacao_mes,
		dt_referencia_w,
		pr_assertividade_w,
		'GRU',
		dividir(c04_w.qt_os_recebida_mes,qt_pessoas_w - c04_w.qt_pessoa_ausente),
		c04_w.qt_backlog,
		qt_sem_previsao_w,
		c04_w.qt_sla,
		null,
		null,
		pr_previsao_w,
		c04_w.qt_analista_negocio,
		c04_w.qt_analista_sistema,
		c04_w.qt_analista_manutencao,
		c04_w.qt_programador,
		c04_w.qt_estagiario,
		qt_pessoas_w,
		c04_w.qt_pessoa_ausente,
		dividir(c04_w.qt_os_encerrada_mes,qt_pessoas_w - c04_w.qt_pessoa_ausente),
		round(qt_pessoas_w * 20 /100),
		c04_w.pr_defeito_ano,
		c04_w.qt_backlog_defeito,
		c04_w.qt_backlog_philips,
		dividir(dividir(c04_w.qt_horas_trab_dia,c04_w.qt_dias_util),qt_pessoas_w - c04_w.qt_pessoa_ausente),
		c04_w.qt_horas_trab_os,
		c04_w.qt_horas_trab_os_cliente,
		c04_w.qt_horas_trab_os_philips,
		round(dividir(c04_w.qt_os_encerrada_ano_mes,c04_w.qt_pessoa_periodo)),
		null,
		null,
		c04_w.qt_os_recebida_dia,
		c04_w.qt_os_recebida_dia_philips,
		c04_w.qt_os_recebida_dia_cliente,
		c04_w.qt_recebida_cliente_mes,
		c04_w.qt_recebida_philips_mes,
		c04_w.qt_os_recebida_ano,
		c04_w.qt_os_encerrada_mes,
		c04_w.qt_os_encerrada_ano,
		c04_w.pr_defeito_philips_ano,
		c04_w.pr_defeito_philips_mes,
		c04_w.pr_defeito_cliente_mes,
		c04_w.pr_defeito_cliente_ano,
		c04_w.pr_satisfacao_ano,
		c04_w.qt_backlog_cliente,
		c04_w.qt_backlog_pend_cliente,
		c04_w.qt_backlog_pend_vev,
		c04_w.ie_area_gerencia,
		c04_w.qt_net,
		c04_w.qt_hora_extra,
		c04_w.qt_media_hora_extra_pessoa,
		c04_w.pr_inovacao,
		c04_w.qt_hc_delphi,
		c04_w.qt_hc_java,
		c04_w.qt_hc_html5,
		c04_w.qt_hc_capitalizado,
		c04_w.qt_def_rate_mes,
		c04_w.qt_def_rate_ano);

	commit;

end loop;
close c04;


qt_defeito_w		:= 0;
pr_defeito_w		:= 0;
qt_os_antiga_w		:= 0;
pr_antiga_w		:= 0;
qt_insatisf_w		:= 0;
qt_os_satisf_inform_w	:= 0;
qt_os_recebida_w	:= 0;
pr_satisf_w		:= 0;
pr_assertividade_w	:= 0;

open c05;
loop
fetch c05 into
	c05_w;
EXIT WHEN NOT FOUND; /* apply on c05 */

	/* Quantidade de OS com satisfacao informada por usuario*/

	select	max(qt_informacao)
	into STRICT	qt_os_satisf_inform_w
	from 	w_indicador_desenv
	where 	ie_indicador 		= 'SAT'
	and 	ie_abrangencia 		= 'IND'
	and 	ie_informacao 		= 'QTSAI'
	and	dt_referencia		= dt_referencia_p
	and	nr_seq_gerencia 	= c05_w.nr_seq_gerencia
	and	nr_seq_grupo 		= c05_w.nr_sequencia
	and	cd_pessoa_fisica	= c05_w.cd_pessoa_fisica;

	/* Quantidade de OS com Insatisfacao informada por usuario*/

	select	max(qt_informacao)
	into STRICT	qt_insatisf_w
	from 	w_indicador_desenv
	where 	ie_indicador 		= 'SAT'
	and 	ie_abrangencia 		= 'IND'
	and 	ie_informacao 		= 'QTINS'
	and		dt_referencia	= dt_referencia_p
	and	nr_seq_gerencia 	= c05_w.nr_seq_gerencia
	and	nr_seq_grupo 		= c05_w.nr_sequencia
	and	cd_pessoa_fisica	= c05_w.cd_pessoa_fisica;

	/* PRSAT = % de satisfacao  por usuario */

	select	max(qt_informacao)
	into STRICT	pr_satisf_w
	from 	w_indicador_desenv
	where 	ie_indicador 		= 'SAT'
	and 	ie_abrangencia 		= 'IND'
	and 	ie_informacao 		= 'PRSAT'
	and		dt_referencia	= dt_referencia_p
	and	nr_seq_gerencia 	= c05_w.nr_seq_gerencia
	and	nr_seq_grupo 		= c05_w.nr_sequencia
	and	cd_pessoa_fisica	= c05_w.cd_pessoa_fisica;

	/* QTDEF = Quantidade de OS's de defeito por pessoa*/

	select	max(qt_informacao)
	into STRICT	qt_defeito_w
	from 	w_indicador_desenv
	where 	ie_indicador 		= 'DEF'
	and 	ie_abrangencia 		= 'IND'
	and 	ie_informacao 		= 'QTDEF'
	and		dt_referencia	= dt_referencia_p
	and	nr_seq_gerencia 	= c05_w.nr_seq_gerencia
	and	nr_seq_grupo 		= c05_w.nr_sequencia
	and	cd_pessoa_fisica	= c05_w.cd_pessoa_fisica;

	/* PRDEF = % de defeito por pessoa */

	select	max(qt_informacao)
	into STRICT	pr_defeito_w
	from 	w_indicador_desenv
	where 	ie_indicador 		= 'DEF'
	and 	ie_abrangencia 		= 'IND'
	and 	ie_informacao 		= 'PRDEF'
	and		dt_referencia	= dt_referencia_p
	and	nr_seq_gerencia 	= c05_w.nr_seq_gerencia
	and	nr_seq_grupo 		= c05_w.nr_sequencia
	and	cd_pessoa_fisica	= c05_w.cd_pessoa_fisica;

	/* QTOSRG = Quantidade de OS recebida por pessoa */

	select	max(qt_informacao)
	into STRICT	qt_os_recebida_w
	from 	w_indicador_desenv
	where 	ie_indicador 		= 'PRO'
	and 	ie_abrangencia 		= 'IND'
	and 	ie_informacao 		= 'QTOSRG'
	and		dt_referencia	= dt_referencia_p
	and	nr_seq_gerencia 	= c05_w.nr_seq_gerencia
	and	nr_seq_grupo 		= c05_w.nr_sequencia
	and	cd_pessoa_fisica	= c05_w.cd_pessoa_fisica;

	/*select	nvl(max(b.qt_mes_corrente),0)
	into	qt_mes_corrente_w
	from	w_avaliacao_usuario b,
			usuario_nivel_des_v c
	where	b.nm_usuario = c.nm_usuario_des
	and		b.ie_referencia = 'E'
	and		b.nm_usuario_cor = 'TASY'
	and		b.qt_ordem is null
	and		b.qt_mes_corrente is not null
	and		b.nm_usuario = c05_w.nm_usuario_grupo
	and exists(	select	1
				from	grupo_desenvolvimento d,
						usuario_grupo_des a
				where	d.nr_sequencia = a.nr_seq_grupo
				and		a.nm_usuario_grupo = b.nm_usuario);*/
	select	count(*)
	into STRICT	qt_mes_corrente_w
	from	man_ordem_servico a
	where	ie_status_ordem	= '3'
	and		trunc(dt_fim_real,'mm') = trunc(dt_referencia_p,'mm')
	and		exists (SELECT	1
			from	man_ordem_serv_ativ x
			where	x.nm_usuario_exec	= c05_w.nm_usuario_grupo
			and		nr_seq_ordem_serv	= a.nr_sequencia)
	and 	exists (select 1
			from	man_estagio_processo z,
					man_ordem_serv_estagio y
			where	y.nr_seq_ordem = a.nr_sequencia
			and 	y.nr_seq_estagio = z.nr_sequencia
			and 	z.ie_desenv = 'S');

	qt_media_producao_w	:= dividir(qt_mes_corrente_w, obter_qt_dia_util_periodo(trunc(dt_referencia_p,'mm'),clock_timestamp(),1));

	insert into w_indicador_desenv_apres(nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_gerencia,
		nr_seq_grupo,
		cd_pessoa_fisica,
		qt_os_defeito,
		pr_defeito,
		qt_os_antiga,
		pr_os_antiga,
		qt_os_insatisfacao,
		qt_os_satisf_inf,
		qt_os_recebida, /*Usado para mostrar produtividade diaria*/
		pr_satisfacao,
		dt_referencia,
		pr_assertividade,
		ie_abrangencia,
		qt_os_baixada)
	values (nextval('w_indicador_desenv_apres_seq'),
		clock_timestamp(),
		'Tasy',
		clock_timestamp(),
		'Tasy',
		c05_w.nr_seq_gerencia,
		c05_w.nr_sequencia,
		c05_w.cd_pessoa_fisica,
		qt_defeito_w,
		pr_defeito_w,
		qt_os_antiga_w,
		pr_antiga_w,
		qt_insatisf_w,
		qt_os_satisf_inform_w,
		qt_media_producao_w,
		pr_satisf_w,
		dt_referencia_p,
		pr_assertividade_w,
		'IND',
		qt_mes_corrente_w);

end loop;
close c05;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_w_indicador_desenv_apres (dt_referencia_p timestamp) FROM PUBLIC;

