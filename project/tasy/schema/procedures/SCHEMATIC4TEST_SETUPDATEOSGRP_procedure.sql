-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE schematic4test_setupdateosgrp (NR_SEQ_SCHEDULE_P bigint, NR_OS_P bigint, DS_OS_P text, DS_SEVERIDADE_P text, NM_USUARIO_P text) AS $body$
DECLARE

NR_SEQ_PACKAGEW bigint;
NM_SUITEW varchar(255);
COUNTERPW bigint;


BEGIN
    --procedure that insert SO to group
	INSERT INTO SCHEM_TEST_BEHOLDER(nr_sequencia, nm_usuario, dt_atualizacao, nm_usuario_nrec, dt_atualizacao_nrec, ds_interaction, ds_param_a, ds_param_b, ds_param_c, ds_param_d)
	VALUES (nextval('schem_test_beholder_seq'), NM_USUARIO_P, clock_timestamp(), 'Robot', clock_timestamp(), 'SCHEMATIC4TEST_SETUPDATEOSGRP',
	'NR_SEQ_SCHEDULE_P as '||NR_SEQ_SCHEDULE_P, 
	'NR_OS_P as '||NR_OS_P, 
	'DS_OS_P as '||DS_OS_P, 
	'DS_SEVERIDADE_P as '||DS_SEVERIDADE_P);
	
    IF (NR_SEQ_SCHEDULE_P IS NOT NULL AND NR_SEQ_SCHEDULE_P::text <> '') THEN
        SELECT NR_SEQ_PACKAGE
            INTO STRICT NR_SEQ_PACKAGEW
        FROM SCHEM_TEST_SCHEDULE
        WHERE NR_SEQUENCIA = NR_SEQ_SCHEDULE_P;

        SELECT NM_SUITE 
            INTO STRICT NM_SUITEW
        FROM SCHEM_TEST_SUITE WHERE NR_SEQUENCIA = (SELECT NR_SEQ_SUITE FROM SCHEM_TEST_SCHEDULE WHERE NR_SEQUENCIA = NR_SEQ_SCHEDULE_P);

        INSERT INTO SCHEM_TEST_OS(NR_SEQUENCIA, NR_OS, NR_SEQ_PACK_SCHED, NR_SEQ_SCHEDULE, DS_OS, IE_SITUACAO, DS_SEVERIDADE, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC)
            VALUES (nextval('schem_test_os_seq'), NR_OS_P, NR_SEQ_PACKAGEW, NR_SEQ_SCHEDULE_P, DS_OS_P||' - '||NM_SUITEW, 'A', DS_SEVERIDADE_P, clock_timestamp(), NM_USUARIO_P, clock_timestamp(), NM_USUARIO_P);

      CALL SCHEMATIC4TEST_SETSCHEDSTATUS(NR_SEQ_SCHEDULE_P);

      COMMIT;
    END IF;
    EXCEPTION
    WHEN no_data_found THEN
        RAISE NOTICE 'Erro: Data not found';
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE schematic4test_setupdateosgrp (NR_SEQ_SCHEDULE_P bigint, NR_OS_P bigint, DS_OS_P text, DS_SEVERIDADE_P text, NM_USUARIO_P text) FROM PUBLIC;

