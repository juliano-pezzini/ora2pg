-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_informacao_pad ( nr_seq_pad_p text, nr_sequencia_p text, nm_usuario_p text) AS $body$
DECLARE

									
cd_material_w 					bigint;
cd_unidade_medida_w 			varchar(100);
ie_via_aplicacao_w				varchar(100);
nr_seq_material_w				bigint;
nr_seq_equipamento_w			bigint;
qt_equipamento_w				varchar(10);
nr_sequencia_equipamento_w		bigint;
nr_seq_profissional_w			varchar(10);
nr_seq_intervalo_w				varchar(10);
qt_profissional_w				varchar(10);
nr_sequencia_cronograma_w		bigint;
nr_seq_servico_w				bigint;
nr_sequencia_servico_w			varchar(10);
qt_tempo_minuto_w				varchar(10);
nr_seq_frequencia_w				varchar(10);
ds_observacao_w					varchar(4000);
nr_seq_controle_prof_w			bigint;
nr_seq_prof_cronograma_w        bigint;
nr_seq_intervalo_cad_w			bigint;
									
C01 CURSOR FOR

SELECT cd_material,
	   ie_via_aplicacao,
	   cd_unidade_medida
from hc_pad_mat_med_cad
where nr_seq_pad_cad = nr_seq_pad_p;

C02 CURSOR FOR

SELECT nr_seq_equipamento,
	   qt_equipamento
from hc_pad_equipamento_cad
where nr_seq_pad_cad = nr_seq_pad_p;

C03 CURSOR FOR

SELECT nr_seq_profissional,
	   nr_seq_intervalo,
	   qt_profissional
from hc_pad_cronograma_cad
where nr_seq_pad_cad = nr_seq_pad_p;

C04 CURSOR FOR

SELECT nr_seq_servico,
	   qt_tempo_minuto,
	   nr_seq_frequencia,
	   ds_observacao
from hc_pad_servico_cad
where nr_seq_pad_cad = nr_seq_pad_p;


C05 CURSOR FOR

SELECT  nr_sequencia
from hc_pad_controle_prof
where  nr_seq_controle = nr_sequencia_p;


BEGIN


delete FROM hc_pad_material
where nr_seq_controle = nr_sequencia_p;

commit;

delete FROM hc_pad_equipamento
where nr_seq_controle = nr_sequencia_p;

commit;



open C05;
		loop
		fetch C05 into	
			nr_seq_controle_prof_w;
		EXIT WHEN NOT FOUND; /* apply on C05 */
		
		begin
			
		delete FROM HC_PAD_PROF_PROCED
		where nr_seq_profissional = nr_seq_controle_prof_w;
		
		end;
		end loop;
close C05;


delete FROM hc_pad_controle_prof
where nr_seq_controle = nr_sequencia_p;

commit;

delete FROM hc_pad_servico
where nr_seq_controle = nr_sequencia_p;

commit;


open C01;
		loop
		fetch C01 into	
			cd_material_w,
			ie_via_aplicacao_w,
			cd_unidade_medida_w;
		EXIT WHEN NOT FOUND; /* apply on C01 */
		
			begin
			
			select nextval('hc_pad_material_seq')
			into STRICT  nr_seq_material_w
			;
			
			
			insert into hc_pad_material( nr_sequencia,
										  cd_material,
										  dt_atualizacao,
										  dt_atualizacao_nrec,
										  nm_usuario,
										  nm_usuario_nrec,
										  nr_seq_controle,
										  ie_via_aplicacao,
										  cd_unidade_medida) values (nr_seq_material_w,
										   cd_material_w,
										   clock_timestamp(),
										   clock_timestamp(),
										   nm_usuario_p,
										   nm_usuario_p,
										   nr_sequencia_p,
										   ie_via_aplicacao_w,
										   cd_unidade_medida_w);
										
										   
			commit;							
										   
			end;
		end loop;
close C01;

open C02;
		loop
		fetch C02 into	
			nr_seq_equipamento_w,
			qt_equipamento_w;
		EXIT WHEN NOT FOUND; /* apply on C02 */
		
			begin
			
			select nextval('hc_pad_equipamento_seq')
			into STRICT  nr_sequencia_equipamento_w
			;
			
			
			insert into hc_pad_equipamento( nr_sequencia,
											nr_seq_equipamento,
											qt_equipamento,
											dt_atualizacao,
											dt_atualizacao_nrec,
											nm_usuario,
											nm_usuario_nrec,
											nr_seq_controle) values (nr_sequencia_equipamento_w,
											nr_seq_equipamento_w,
											qt_equipamento_w,
											clock_timestamp(),
											clock_timestamp(),
											nm_usuario_p,
											nm_usuario_p,
											nr_sequencia_p);
										
										   
			commit;							
										   
			end;
		end loop;
close C02;

open C03;
		loop
		fetch C03 into	
			nr_seq_profissional_w,
			nr_seq_intervalo_w,
			qt_profissional_w;
		EXIT WHEN NOT FOUND; /* apply on C03 */
		
			begin
			
			select nextval('hc_pad_controle_prof_seq')
			into STRICT  nr_sequencia_cronograma_w
			;
			
			
			
			insert into hc_pad_controle_prof(  nr_sequencia,
												nr_seq_profissional,
												nr_seq_intervalo,
												qt_profissional,
												dt_atualizacao,
												dt_atualizacao_nrec,
												nm_usuario,
												nm_usuario_nrec,
												nr_seq_controle) values (nr_sequencia_cronograma_w,
												nr_seq_profissional_w,
												nr_seq_intervalo_w,
												qt_profissional_w,
												clock_timestamp(),
												clock_timestamp(),
												nm_usuario_p,
												nm_usuario_p,
												nr_sequencia_p);
										
										   
			commit;			

			select		max(nr_sequencia)
			into STRICT		nr_seq_intervalo_cad_w
			from		hc_pad_prof_interv
			where		nr_seq_profissional = nr_seq_profissional_w
			and			cd_intervalo = nr_seq_intervalo_w;
								
            CALL hc_inserir_profissional_pad(nr_sequencia_p,nr_seq_profissional_w,nr_sequencia_cronograma_w,nm_usuario_p);	
													
			end;
		end loop;
close C03;

open C04;
		loop
		fetch C04 into	
			nr_sequencia_servico_w,
			qt_tempo_minuto_w,
			nr_seq_frequencia_w,
			ds_observacao_w;
		EXIT WHEN NOT FOUND; /* apply on C04 */
		
			begin
	
			select nextval('hc_pad_servico_seq')
			into STRICT  nr_seq_servico_w
			;
			
			insert into hc_pad_servico(  		nr_sequencia,
												nr_seq_servico,
												qt_tempo_minuto,
												nr_seq_frequencia,
												ds_observacao,
												dt_atualizacao,
												dt_atualizacao_nrec,
												nm_usuario,
												nm_usuario_nrec,
												nr_seq_controle) values (nr_seq_servico_w,
												nr_sequencia_servico_w,
												qt_tempo_minuto_w,
												nr_seq_frequencia_w,
												ds_observacao_w,
												clock_timestamp(),
												clock_timestamp(),
												nm_usuario_p,
												nm_usuario_p,
												nr_sequencia_p);
										
										   
			commit;							
										   
			end;
		end loop;
close C04;


		
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_informacao_pad ( nr_seq_pad_p text, nr_sequencia_p text, nm_usuario_p text) FROM PUBLIC;

