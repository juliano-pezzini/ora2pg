-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE supplypoint_atual_inf_pac ( cd_pessoa_fisica_p bigint, nm_usuario_p text) AS $body$
DECLARE


ie_setor_supplypoint_w		varchar(1) := 'N';
ds_param_integ_hl7_w		varchar(4000) := '';
nr_atendimento_w		atendimento_paciente.nr_atendimento%type;
cd_setor_w			setor_atendimento.cd_setor_atendimento%type;


BEGIN
	begin	
		nr_atendimento_w := obter_ultimo_atendimento(cd_pessoa_fisica_p);
		cd_setor_w := obter_setor_atendimento(nr_atendimento_w);
	
		begin
		select	CASE WHEN count(*)=0 THEN 'N'  ELSE 'S' END 
		into STRICT	ie_setor_supplypoint_w
		from	far_setores_integracao
		where	nr_seq_empresa_int = 82
		and	cd_setor_atendimento = cd_setor_w  LIMIT 1;
		exception
		when others then
			ie_setor_supplypoint_w := 'N';
		end;

		if (ie_setor_supplypoint_w = 'S') then
			ds_param_integ_hl7_w := 'cd_pessoa_fisica=' || cd_pessoa_fisica_p || obter_separador_bv;
			CALL gravar_agend_integracao(634, ds_param_integ_hl7_w);
		end if;
	exception
		when others then
			cd_setor_w := 0;
	end;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE supplypoint_atual_inf_pac ( cd_pessoa_fisica_p bigint, nm_usuario_p text) FROM PUBLIC;

