-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE review_clinical_notes (CD_EVOLUCAO_P bigint) AS $body$
DECLARE


variable_lsit       	EVOLUCAO_PACIENTE%ROWTYPE;
nm_user_w		varchar(100);
nr_sequence_w    	bigint;


BEGIN
	nm_user_w := wheb_usuario_pck.get_nm_usuario;
	select nextval('evolucao_paciente_seq') into STRICT nr_sequence_w;

	update	EVOLUCAO_PACIENTE
	set	IE_SITUACAO='I',
		DT_INATIVACAO = clock_timestamp(),
		NM_USUARIO_INATIVACAO = nm_user_w,
		DS_JUSTIFICATIVA = 'InActive digital'
	where	CD_EVOLUCAO = CD_EVOLUCAO_P;
	commit;
	
	SELECT *
	into STRICT
		variable_lsit
	 FROM 
		EVOLUCAO_PACIENTE where CD_EVOLUCAO = CD_EVOLUCAO_P  LIMIT 1;

	Insert into EVOLUCAO_PACIENTE(CD_EVOLUCAO   ,              
		DT_EVOLUCAO,                   
		IE_TIPO_EVOLUCAO,          
		CD_PESSOA_FISICA,        
		DT_ATUALIZACAO,               
		NM_USUARIO,       
		NR_ATENDIMENTO,                
		DS_EVOLUCAO,                     
		CD_MEDICO ,                                  
		IE_EVOLUCAO_CLINICA,               
		CD_SETOR_ATENDIMENTO,            
		CD_ESPECIALIDADE ,           
		CD_MEDICO_PARECER,          
		QT_PESO,        
		QT_ALTURA ,        
		QT_SUPERF_CORPORIA,      
		CD_TOPOGRAFIA,       
		CD_TUMOR_PRIM_PAT,    
		CD_LINFONODO_REG_PAT  ,     
		CD_METASTASE_DIST_PAT,   
		CD_ESTADIO_OUTRO,   
		DT_INICIO_TRAT_PROPOSTO ,         
		DT_FINAL_TRAT_PROPOSTO  ,   
		CD_ESTADO_DOENCA       ,
		IE_ESTADO_PAC_FIM_TRAT, 
		IE_RECEM_NATO  ,
		NR_CIRURGIA      ,
		CD_ESPECIALIDADE_MEDICO,
		IE_SITUACAO      ,
		DT_INATIVACAO      ,                                     
		NR_SEQ_SAEP    ,                        
		NR_SEQ_ASSINATURA ,                      
		IE_AVALIADOR_AUX  ,                     
		DT_LIBERACAO_AUX  ,                           
		IE_EVOLUCAO_DOR  ,                     
		NR_SEQ_PEPO   ,                          
		CD_PERFIL_ATIVO ,                         
		NR_ATEND_ALTA    ,                      
		NR_SEQ_APROV   ,                         
		NR_SEQ_RP_TRATAMENTO    ,                
		IE_RESTRICAO_VISUALIZACAO     ,        
		NR_RECEM_NATO   ,                         
		QT_CARACTERES    ,                       
		NR_SEQ_ASSINAT_INATIVACAO       ,        
		CD_UNIDADE       ,                                                            
		NR_SEQ_PEND_PAC_ACAO ,                 
		QT_PERIODO  ,                           
		IE_PERIODO ,                          
		DT_RETORNO_PREV  ,                             
		NR_SEQ_REGULACAO  ,                     
		NR_SEQ_AVALIACAO   ,                    
		NR_SEQ_INT_PRESCR      ,                
		NR_SEQ_REMOCAO  ,                        
		IE_PERFOR_STAUS_ZUBROD  ,                 
		DT_ULTIMA_QUIMIO  ,                          
		NR_SEQ_SAE     ,                        
		IE_RELEV_RESUMO_ALTA ,               
		NR_SEQ_FORMULARIO  ,                    
		IE_PALM    ,                            
		DS_LISTA_PROBLEMAS ,                 
		NR_SEQ_EHR_REG ,                      
		DS_IMPRESSAO   ,                      
		NR_SEQ_EVOL_GRAV ,                     
		IE_NIVEL_ATENCAO ,                      
		DS_UTC      ,                          
		IE_HORARIO_VERAO ,                   
		DS_UTC_ATUALIZACAO  ,                                              
		CD_AVALIADOR_AUX ,                    
		NR_SEQ_ATEND_CONS_PEPA    ,              
		CD_HANDOVER_NURSE ,                    
		DT_HANDOVER_ACCEPTED ,                        
		IE_ACAO   ,                             
		DT_CLI_START ,                                
		DT_CLI_END ,                                 
		CD_DIS_CATEGORY ,                         
		CD_DOENCA,                             
		CD_DEPARTAMENTO,                         
		IE_TIPO_ATENDIMENTO)
	VALUES (nr_sequence_w   ,              
		variable_lsit.dt_evolucao,                   
		variable_lsit.IE_TIPO_EVOLUCAO,          
		variable_lsit.CD_PESSOA_FISICA,        
		clock_timestamp(),               
		nm_user_w,       
		variable_lsit.NR_ATENDIMENTO,                
		variable_lsit.DS_EVOLUCAO,                     
		variable_lsit.CD_MEDICO ,                                   
		variable_lsit.IE_EVOLUCAO_CLINICA,               
		variable_lsit.CD_SETOR_ATENDIMENTO,            
		variable_lsit.CD_ESPECIALIDADE ,           
		variable_lsit.CD_MEDICO_PARECER,          
		variable_lsit.QT_PESO,        
		variable_lsit.QT_ALTURA ,        
		variable_lsit.QT_SUPERF_CORPORIA,      
		variable_lsit.CD_TOPOGRAFIA,       
		variable_lsit.CD_TUMOR_PRIM_PAT,    
		variable_lsit.CD_LINFONODO_REG_PAT  ,     
		variable_lsit.CD_METASTASE_DIST_PAT,   
		variable_lsit.CD_ESTADIO_OUTRO,   
		variable_lsit.DT_INICIO_TRAT_PROPOSTO ,         
		variable_lsit.DT_FINAL_TRAT_PROPOSTO  ,   
		variable_lsit.CD_ESTADO_DOENCA       ,
		variable_lsit.IE_ESTADO_PAC_FIM_TRAT, 
		variable_lsit.IE_RECEM_NATO  ,
		variable_lsit.NR_CIRURGIA      ,
		variable_lsit.CD_ESPECIALIDADE_MEDICO,
		'A'      ,
		NULL,                                     
		variable_lsit.NR_SEQ_SAEP    ,                        
		variable_lsit.NR_SEQ_ASSINATURA ,                      
		variable_lsit.IE_AVALIADOR_AUX  ,                     
		variable_lsit.DT_LIBERACAO_AUX  ,                           
		variable_lsit.IE_EVOLUCAO_DOR  ,                     
		variable_lsit.NR_SEQ_PEPO   ,                          
		variable_lsit.CD_PERFIL_ATIVO ,                         
		variable_lsit.NR_ATEND_ALTA    ,                      
		variable_lsit.NR_SEQ_APROV   ,                         
		variable_lsit.NR_SEQ_RP_TRATAMENTO    ,                
		variable_lsit.IE_RESTRICAO_VISUALIZACAO     ,        
		variable_lsit.NR_RECEM_NATO   ,                         
		variable_lsit.QT_CARACTERES    ,                       
		variable_lsit.NR_SEQ_ASSINAT_INATIVACAO       ,        
		variable_lsit.CD_UNIDADE       ,                                                             
		variable_lsit.NR_SEQ_PEND_PAC_ACAO ,                 
		variable_lsit.QT_PERIODO  ,                           
		variable_lsit.IE_PERIODO ,                          
		variable_lsit.DT_RETORNO_PREV  ,                             
		variable_lsit.NR_SEQ_REGULACAO  ,                     
		variable_lsit.NR_SEQ_AVALIACAO   ,                    
		variable_lsit.NR_SEQ_INT_PRESCR      ,                
		variable_lsit.NR_SEQ_REMOCAO  ,                        
		variable_lsit.IE_PERFOR_STAUS_ZUBROD  ,                 
		variable_lsit.DT_ULTIMA_QUIMIO  ,                          
		variable_lsit.NR_SEQ_SAE     ,                        
		variable_lsit.IE_RELEV_RESUMO_ALTA ,               
		variable_lsit.NR_SEQ_FORMULARIO  ,                    
		variable_lsit.IE_PALM    ,                            
		variable_lsit.DS_LISTA_PROBLEMAS ,                 
		variable_lsit.NR_SEQ_EHR_REG ,                      
		variable_lsit.DS_IMPRESSAO   ,                      
		variable_lsit.NR_SEQ_EVOL_GRAV ,                     
		variable_lsit.IE_NIVEL_ATENCAO ,                      
		variable_lsit.DS_UTC      ,                          
		variable_lsit.IE_HORARIO_VERAO ,                   
		variable_lsit.DS_UTC_ATUALIZACAO  ,                                             
		variable_lsit.CD_AVALIADOR_AUX ,                    
		variable_lsit.NR_SEQ_ATEND_CONS_PEPA    ,              
		variable_lsit.CD_HANDOVER_NURSE ,                    
		variable_lsit.DT_HANDOVER_ACCEPTED ,                        
		variable_lsit.IE_ACAO   ,                             
		variable_lsit.DT_CLI_START ,                                
		variable_lsit.DT_CLI_END ,                                 
		variable_lsit.CD_DIS_CATEGORY ,                         
		variable_lsit.CD_DOENCA,                             
		variable_lsit.CD_DEPARTAMENTO,                         
		variable_lsit.IE_TIPO_ATENDIMENTO);
		insert into EVOLUCAO_PACIENTE_COMPL(NR_SEQ_EVO_PACIENTE,
						NR_SEQ_EVO_PACIENTE_REF)
					VALUES (nr_sequence_w,
						CD_EVOLUCAO_P);
		update clinical_note_soap_data
		set cd_evolucao = nr_sequence_w
		where cd_evolucao = CD_EVOLUCAO_P;
		CALL CLINICAL_NOTES_PCK.update_clinical_note_code(CD_EVOLUCAO_P,nr_sequence_w);
	commit;

end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE review_clinical_notes (CD_EVOLUCAO_P bigint) FROM PUBLIC;

