-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE generate_qhapdc_men_content (nr_seq_dataset_p bigint , nm_usuario_p text, returned_value_p INOUT bigint, other_exception_p INOUT text) AS $body$
DECLARE

  ds_segment_w                 varchar(32767);
  ds_segment_clob_w            text := '';
  is_clob_insertion_successful bigint := 0;
  excp_caught_dataset_clob_ins varchar(500 );

BEGIN
    BEGIN 
        SELECT 'N' 
               || --to find when to use update or delete 
               Lpad(nr_atendimento, 12, '0') 
               || Lpad(Obter_pessoa_atendimento(nr_atendimento, 'C'), 8, '0') 
               || Lpad(nr_atendimento, 12, '0') 
               || CASE WHEN coalesce(ie_type_accommodation::text, '') = '' THEN  '1'  ELSE trim(both ie_type_accommodation) END  
               || CASE WHEN coalesce(ie_employment_status::text, '') = '' THEN  '8'  ELSE trim(both ie_employment_status) END  
               || CASE WHEN coalesce(pension_status::text, '') = '' THEN  '3'  ELSE trim(both pension_status) END  
               || CASE WHEN coalesce(ie_first_adm_psy::text, '') = '' THEN  '1'  ELSE trim(both ie_first_adm_psy) END  
               || CASE WHEN coalesce(ref_care::text, '') = '' THEN  '01'  ELSE trim(both Lpad(ref_care, 2, '0')) END  
               || CASE WHEN coalesce(ie_men_legal_status::text, '') = '' THEN  '1'  ELSE trim(both ie_men_legal_status) END  
               || CASE WHEN coalesce(ie_prev_nadm_treatment::text, '') = '' THEN  '1'  ELSE trim(both ie_prev_nadm_treatment) END  
               || Chr(10) 
        INTO STRICT   ds_segment_w 
        FROM   qhapdc_segment_men 
        WHERE  nr_dataset = nr_seq_dataset_p;
    EXCEPTION 
        WHEN OTHERS THEN 
          ds_segment_w := NULL;
    END;

    SELECT Concat(ds_segment_clob_w, ds_segment_w) 
    INTO STRICT   ds_segment_clob_w 
;

    SELECT * FROM Insert_dataset_content(nm_usuario_p, nr_seq_dataset_p, ds_segment_clob_w, is_clob_insertion_successful, excp_caught_dataset_clob_ins) INTO STRICT is_clob_insertion_successful, excp_caught_dataset_clob_ins;

    IF ( is_clob_insertion_successful = 1 ) THEN 
      returned_value_p := 1;

      other_exception_p := NULL;
    ELSE 
      IF (excp_caught_dataset_clob_ins IS NOT NULL AND excp_caught_dataset_clob_ins::text <> '') THEN 
        returned_value_p := 0;

        other_exception_p := excp_caught_dataset_clob_ins;
      END IF;
    END IF;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE generate_qhapdc_men_content (nr_seq_dataset_p bigint , nm_usuario_p text, returned_value_p INOUT bigint, other_exception_p INOUT text) FROM PUBLIC;

