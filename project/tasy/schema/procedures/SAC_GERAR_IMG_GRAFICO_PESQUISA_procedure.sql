-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE sac_gerar_img_grafico_pesquisa ( nm_imagem_p text, ds_pergunta_p text, nm_usuario_p text) AS $body$
DECLARE

			
qt_reg_w		bigint;


BEGIN

if (coalesce(nm_imagem_p,'X') = 'X') then
	CALL exec_sql_dinamico_bv('Tasy','delete from w_sac_pesquisa_grafico where nm_usuario = :nm_usuario_p','nm_usuario_p=' || nm_usuario_p || obter_separador_bv);
else
	begin
	select	count(1)
	into STRICT	qt_reg_w
	from	user_tables
	where	table_name = 'W_SAC_PESQUISA_GRAFICO';
	
	if (qt_reg_w = 0) then
		CALL exec_sql_dinamico('W_SAC_PESQUISA_GRAFICO','CREATE TABLE W_SAC_PESQUISA_GRAFICO(NR_SEQUENCIA NUMBER(10), NM_IMAGEM VARCHAR2(255), DS_PERGUNTA VARCHAR2(255), NM_USUARIO VARCHAR2(15))');
	end if;
	
	qt_reg_w := obter_valor_dinamico('select nvl(max(nr_sequencia),0) +1 from w_sac_pesquisa_grafico', qt_reg_w);
	
	CALL exec_sql_dinamico_bv('',
		'insert into w_sac_pesquisa_grafico(nr_sequencia, nm_imagem, ds_pergunta, nm_usuario) values (:nr_sequencia_p,:nm_imagem_p,:ds_pergunta_p,:nm_usuario_p)',
			'nr_sequencia_p=' || qt_reg_w || obter_separador_bv ||
			'nm_imagem_p=' || nm_imagem_p || obter_separador_bv ||
			'ds_pergunta_p=' || ds_pergunta_p || obter_separador_bv ||
			'nm_usuario_p=' || nm_usuario_p || obter_separador_bv);
	end;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE sac_gerar_img_grafico_pesquisa ( nm_imagem_p text, ds_pergunta_p text, nm_usuario_p text) FROM PUBLIC;

