-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE recebe_resposta_bionexo ( nr_cot_compra_p bigint, ie_status_p bigint, ds_string_retorno_p text, nm_usuario_p text) AS $body$
DECLARE


nr_cot_compra_w		bigint;
ds_enter_w		varchar(10) := chr(13) || chr(10);
					

BEGIN

if (nr_cot_compra_p > 0) then
	if (ie_status_p = 1 and coalesce(ds_string_retorno_p::text, '') = '') then
		CALL gerar_historico_cotacao(
			nr_cot_compra_p,
			WHEB_MENSAGEM_PCK.get_texto(306490),
			substr(WHEB_MENSAGEM_PCK.get_texto(306493),1,4000),
			'S',
			nm_usuario_p);

	elsif (ie_status_p = 0) then
		CALL gerar_historico_cotacao(
			nr_cot_compra_p,
			WHEB_MENSAGEM_PCK.get_texto(306495),
			substr(WHEB_MENSAGEM_PCK.get_texto(306496),1,4000),
			'S',
			nm_usuario_p);

	elsif (ie_status_p < 0 or (ds_string_retorno_p IS NOT NULL AND ds_string_retorno_p::text <> '')) then
		CALL gerar_historico_cotacao(
			nr_cot_compra_p,
			WHEB_MENSAGEM_PCK.get_texto(306497),
			substr(WHEB_MENSAGEM_PCK.get_texto(306500,'DS_STRING_RETORNO_P='|| substr(ds_string_retorno_p,1,2000)),1,4000),
			'S',
			nm_usuario_p);
	end if;
end if;


commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE recebe_resposta_bionexo ( nr_cot_compra_p bigint, ie_status_p bigint, ds_string_retorno_p text, nm_usuario_p text) FROM PUBLIC;

