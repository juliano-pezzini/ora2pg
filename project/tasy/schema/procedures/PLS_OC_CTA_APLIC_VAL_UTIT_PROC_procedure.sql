-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_oc_cta_aplic_val_utit_proc ( dados_regra_p text, dados_validacao_p text, nr_id_transacao_p text, nm_usuario_p text) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: 	Gerar os dados referentes ao procedimentos que foram utilizados e serão obtidos
	conforme a regra cadastrada para a validação na função
	OPS - Glosas e Ocorrências \ Ocorrências \ Regra Combinada \
	Validação utilização de itens.
	Os dados aqui gerados serão armazenados na tabela
	PLS_OC_CTA_VAL_UTIT_AUX.
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[X]  Objetos do dicionário [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:

Alterações:
------------------------------------------------------------------------------------------------------------------
jjung OS 602086  03/07/2013 - Criação da rotina.
------------------------------------------------------------------------------------------------------------------
jjung 22/07/2013

Alteração:	* - Corrigido obtenção de quantidade de participantes dos itens buscados para a
	soma quando a ocorrência é gerada pelo portal.

	* - Documentado rotina para melhor entendimento dos outros colaboradores.

Motivo:	Durante a documentação da rotina foi identificado

------------------------------------------------------------------------------------------------------------------
jjung 13/091/2013

Alteração:	Efetuado alteração para não considerar para a ocorrência itens quando a quantidade
	utilizada é igual a quando liberada pela regra, apenas será gerada quando realmente estourar a
	quantidade, ou seja for maior.

Motivo:	Foi identificado em testes que quando a quantidade liberada pela regra é 2, e foram
	executados 2 itens a ocorrência estava sendo gerada, quando na verdade deveria
	ser gerado apenas a partir de 3.

------------------------------------------------------------------------------------------------------------------
jjung OS 644933 - 18/09/2013 -

Alteração:	Modificado o select de obtenção dos outros procs, trocado da view para as tabelas.

Motivo:	O tratamento que era feito na view PLS_PROCEDIMENTO_CONTAS_OCOR_V
	foi separado nas views PLS_CONTA_OCOR_V e PLS_CONTA_PROC_OCOR_V
	e na function PLS_OC_CTA_VAL_23_CONSID_PROC.
------------------------------------------------------------------------------------------------------------------
jjung OS 659951 - 22/10/2013 -

Alteração:	Implementado para alimentar a tabela auxiliar com listas seguindo o padrão da tabela de seleção.

Motivo:	Assim como a tabela de seleção, no processo de aplicação desta validação as alterações na
	tabela auxiliar também se tornam muito custosas quando executadas uma a uma.
------------------------------------------------------------------------------------------------------------------
jjung OS 683382 - 22/10/2013 -

Alteração:	Campo NR_NOTA da tabela PTU_NOTA_COBRANCA foi alterado para VARCHAR2(20)
	portanto temos que alterar o DEFINE_COLUMN para que seja passado o tamanho do
	VARCHAR2 para o Oracle saber qual procedure da DBMS_SQL executar.

Motivo:	O campo teve de ser alterado devido a uma alteração no PTU.
------------------------------------------------------------------------------------------------------------------
jjkruk OS 699959 - 04/03/2014

Alteração:	Incluido campo cd_procedimento_imp no cursor e atribuido no dados_conta_proc_w

Motivo:	o campo era usado numa BIND e ficava sem valor, não gerando ocorrência corretamente
------------------------------------------------------------------------------------------------------------------
jjung 22/10/2013 -

Alteração:	Campo NR_FATURA da tabela PTU_FATURA foi alterado para VARCHAR2(30)
	portanto temos que alterar o DEFINE_COLUMN para que seja passado o tamanho do
	VARCHAR2 para o Oracle saber qual procedure da DBMS_SQL executar.

Motivo:	O campo teve de ser alterado devido a uma alteração no PTU.
------------------------------------------------------------------------------------------------------------------
jjung OS 724638 - 11/04/2014

Alteração:	NR_FATURA da PTU_FATURA para VARCHAR2;
------------------------------------------------------------------------------------------------------------------
jjung OS 755826 - 03/07/2014

Alteração:	Depreciação da rotina, utilizar a rotina PLS_OC_CTA_TRATAR_VAL_23_PROC
------------------------------------------------------------------------------------------------------------------
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
BEGIN
null;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_oc_cta_aplic_val_utit_proc ( dados_regra_p text, dados_validacao_p text, nr_id_transacao_p text, nm_usuario_p text) FROM PUBLIC;

