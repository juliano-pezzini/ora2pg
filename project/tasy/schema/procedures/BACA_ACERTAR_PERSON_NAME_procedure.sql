-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_acertar_person_name () AS $body$
DECLARE


nr_seq_person_name_w  person_name.nr_sequencia%type;
ie_count_w    bigint;

C01 CURSOR FOR
  SELECT *
    from pessoa_fisica x
   where (nm_primeiro_nome IS NOT NULL AND nm_primeiro_nome::text <> '')
   and coalesce(nr_seq_person_name::text, '') = '';
c01_w  c01%rowtype;


BEGIN
ie_count_w := 0;
open C01;
loop
fetch C01 into
  c01_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
  begin
  select nextval('person_name_seq')
  into STRICT nr_seq_person_name_w
;
	  insert into person_name(
		nr_sequencia,
		ds_type,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
    nm_usuario_nrec,
    ds_given_name,
    ds_family_name,
    ds_component_name_1
		)
		values (
		nr_seq_person_name_w,
		'main',
		clock_timestamp(),
		'BACA_PN',
		clock_timestamp(),
    'BACA_PN',
    c01_w.nm_primeiro_nome,
    c01_w.nm_sobrenome_pai,
    c01_w.nm_sobrenome_mae
		);
  ie_count_w := ie_count_w +1;

  update  pessoa_fisica
  set  nr_seq_person_name  = nr_seq_person_name_w
  where  CD_PESSOA_FISICA  = c01_w.cd_pessoa_fisica;

  if (ie_count_w = 500) then
    commit;
    ie_count_w := 0;
  end if;
  end;
end loop;
close C01;

commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_acertar_person_name () FROM PUBLIC;

