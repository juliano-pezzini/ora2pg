-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gerar_protocolo_rec_web ( nr_seq_prestador_p pls_prestador.nr_sequencia%type, nr_seq_prestador_web_p pls_rec_glosa_lote.nr_seq_prestador_web%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nr_seq_usuario_p pls_usuario_web.nr_sequencia%type, nr_seq_protocolo_p INOUT pls_rec_glosa_protocolo.nr_sequencia%type) AS $body$
DECLARE


nr_seq_protocolo_glosa_w	pls_rec_glosa_protocolo.nr_sequencia%type;
nr_seq_lote_glosa_w		pls_rec_glosa_lote.nr_sequencia%type;
cd_estabelecimento_w		estabelecimento.cd_estabelecimento%type := wheb_usuario_pck.get_cd_estabelecimento;


BEGIN

select	nextval('pls_rec_glosa_lote_seq')
into STRICT	nr_seq_lote_glosa_w
;

insert into pls_rec_glosa_lote(nr_sequencia, dt_atualizacao, nm_usuario, dt_atualizacao_nrec,
				nm_usuario_nrec, nr_seq_prestador_web, dt_envio_lote, cd_estabelecimento)
		values (	nr_seq_lote_glosa_w, clock_timestamp(), nm_usuario_p, clock_timestamp(),
				nm_usuario_p, nr_seq_prestador_web_p, null, cd_estabelecimento_p);

select	nextval('pls_rec_glosa_protocolo_seq')
into STRICT	nr_seq_protocolo_glosa_w
;

insert into    pls_rec_glosa_protocolo(	nr_sequencia, nr_seq_lote, dt_atualizacao,
					nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec,
					nr_seq_xml_arquivo, ie_status, ie_situacao,
					dt_liberacao_pag, nr_seq_prestador, ie_origem_solic,
					cd_estabelecimento, nr_seq_usuario)
			values (		nr_seq_protocolo_glosa_w, nr_seq_lote_glosa_w, clock_timestamp(),
					nm_usuario_p, clock_timestamp(), nm_usuario_p,
					null, '9', 'D',
					null, nr_seq_prestador_p, 'P',
					cd_estabelecimento_p, nr_seq_usuario_p);

nr_seq_protocolo_p := nr_seq_protocolo_glosa_w;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_protocolo_rec_web ( nr_seq_prestador_p pls_prestador.nr_sequencia%type, nr_seq_prestador_web_p pls_rec_glosa_lote.nr_seq_prestador_web%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nr_seq_usuario_p pls_usuario_web.nr_sequencia%type, nr_seq_protocolo_p INOUT pls_rec_glosa_protocolo.nr_sequencia%type) FROM PUBLIC;

