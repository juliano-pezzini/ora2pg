-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE loc_obj_marcar_func_prod ( nm_usuario_p text , cd_funcao_p bigint , nr_seq_p bigint , ie_marcado_p text ) AS $body$
BEGIN
    MERGE INTO w_localizador_objetos lo
    USING(SELECT NULL              as nr_sequencia
                  , cd_funcao_p     as cd_funcao
                  , NULL            as nr_seq_obj
                  , NULL            as nr_seq_obj_sup
                  , nm_usuario_p    as nm_usuario
                  , NULL            as nr_seq_dic_obj
                  , NULL            as ie_marcado
                  , NULL            as nr_seq_evt
                  , clock_timestamp()         as dt_atualizacao
                  , nr_seq_p        as nr_seq_dic_dados
           ) x
    ON ( lo.nr_seq_dic_dados = x.nr_seq_dic_dados and lo.cd_funcao = x.cd_funcao and lo.nm_usuario = x.nm_usuario )
    WHEN matched THEN
      UPDATE SET ie_marcado = ie_marcado_p
    WHEN NOT matched THEN
      INSERT(nr_sequencia
              , cd_funcao
              , nm_usuario
              , ie_marcado
              , nr_seq_dic_dados)
      VALUES ( nextval('w_localizador_objetos_seq')
               , cd_funcao_p
               , nm_usuario_p
               , ie_marcado_p
               , nr_seq_p );
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE loc_obj_marcar_func_prod ( nm_usuario_p text , cd_funcao_p bigint , nr_seq_p bigint , ie_marcado_p text ) FROM PUBLIC;

