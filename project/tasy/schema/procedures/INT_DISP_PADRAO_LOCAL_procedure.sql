-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE int_disp_padrao_local ( cd_estabelecimento_p bigint, cd_local_estoque_p bigint, cd_material_p bigint, qt_estoque_maximo_p bigint, qt_estoque_minimo_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
cd_material_generico_w		integer;
cd_classe_material_w		integer;
ds_material_w			varchar(255);
ds_usuario_w			varchar(60);
ds_local_estoque_w		varchar(40);
qt_local_valido_w		bigint;		
 

BEGIN 
 
select	coalesce(max(cd_material_generico),0), 
	coalesce(max(cd_classe_material),0), 
	max(ds_material) 
into STRICT	cd_material_generico_w, 
	cd_classe_material_w, 
	ds_material_w 
from	material 
where	cd_material = cd_material_p;
 
ds_usuario_w := obter_pf_usuario(nm_usuario_p,'X');
ds_local_estoque_w := obter_desc_local_estoque(cd_local_estoque_p);
 
select	count(*) 
into STRICT	qt_local_valido_w 
from	dis_regra_local_setor 
where	cd_local_estoque = cd_local_estoque_p;
 
if (coalesce(qt_local_valido_w,0) > 0) then 
 
	insert into intdisp_padrao_local( 
		cd_estabelecimento, 
		cd_local_estoque, 
		cd_material, 
		qt_maxima, 
		qt_minima, 
		nm_usuario, 
		cd_material_generico, 
		cd_classe_material, 
		ds_material, 
		ds_usuario, 
		ds_local_estoque, 
		dt_atualizacao) 
	values (	cd_estabelecimento_p, 
		cd_local_estoque_p, 
		cd_material_p, 
		qt_estoque_maximo_p, 
		qt_estoque_minimo_p, 
		nm_usuario_p, 
		cd_material_generico_w, 
		cd_classe_material_w, 
		ds_material_w, 
		ds_usuario_w, 
		ds_local_estoque_w, 
		clock_timestamp());
end if;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE int_disp_padrao_local ( cd_estabelecimento_p bigint, cd_local_estoque_p bigint, cd_material_p bigint, qt_estoque_maximo_p bigint, qt_estoque_minimo_p bigint, nm_usuario_p text) FROM PUBLIC;

