-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copia_parametro_pacote (nr_seq_pacote_orig_p bigint, nr_seq_pacote_dest_p text, nm_tabela_p text, nm_usuario_p text, ie_excluir_p text, cd_convenio_p bigint, cd_estabelecimento_p bigint) AS $body$
DECLARE


nr_seq_mat_proc_w            bigint;
ie_inclui_exclui_w           varchar(01);
ie_excedente_w               smallint;
cd_grupo_material_w          smallint;
cd_subgrupo_material_w       smallint;
cd_classe_material_w         integer;
cd_material_w                integer;
qt_limite_w                  double precision;
ie_tipo_atendimento_w        smallint;
cd_setor_atendimento_w       integer;
nr_seq_pac_acomod_w          bigint;
cd_area_proced_w             bigint;
cd_especial_proced_w         bigint;
cd_grupo_proced_w            bigint;
cd_procedimento_w            bigint;
ie_origem_proced_w           bigint;
ie_considera_honorario_w     varchar(01);
ie_calcula_honorario_w       varchar(01);
ie_calcula_custo_oper_w      varchar(01);
ie_valor_w                   varchar(01);
vl_minimo_w                  double precision;
vl_maximo_w                  double precision;
pr_desconto_w                double precision;
IE_TIPO_SETOR_w              varchar(03);
ie_tipo_valor_w		     varchar(3);
nr_seq_pacote_w		     bigint;
nr_seq_familia_w		bigint;
qt_idade_min_w			smallint;
qt_idade_max_w			smallint;
ie_objetivo_w			varchar(1);
ie_considera_generico_w		varchar(1);
pr_orcamento_w			double precision;
ie_sexo_w			varchar(1);
vl_minimo_proc_w		double precision;
vl_maximo_proc_w		double precision;
nr_seq_proc_interno_w		bigint;
ie_ratear_item_w		varchar(1);
pr_desc_w			double precision;
vl_negociado_w			double precision;
ie_agendavel_w			varchar(1);
cd_centro_custo_w		integer;
nr_seq_classif_w		bigint;
nr_seq_estrutura_w		bigint;
cd_local_estoque_w		pacote_material.cd_local_estoque%type;
ie_valida_limite_proc_w		pacote_procedimento.ie_valida_limite_proc%type;
nr_seq_pac_tip_acom_ori_w	pacote_tipo_acomodacao.nr_sequencia%type;
nr_seq_pac_tip_acom_w 		pacote_tipo_acomodacao.nr_sequencia%type;
nr_seq_estrutura_proc_w		pacote_procedimento.nr_seq_estrutura%type;

c001 CURSOR FOR
     SELECT  ie_inclui_exclui,
             ie_excedente,
             cd_grupo_material,
             cd_subgrupo_material,
             cd_classe_material,
             cd_material,
             qt_limite,
             ie_tipo_atendimento,
             cd_setor_atendimento,
             nr_seq_pac_acomod,
             ie_valor,
             vl_minimo,
             vl_maximo,
             pr_desconto,
             IE_TIPO_SETOR,
	     nr_seq_familia,
	     qt_idade_min,
	     qt_idade_max,
	     ie_objetivo,
	     ie_considera_generico,
	     pr_orcamento,
	     ie_sexo,
	     cd_centro_custo,
	     ie_ratear_item,
	     vl_negociado,
	     nr_seq_estrutura,
	     cd_local_estoque
     from    pacote_material
     where   nr_seq_pacote   = nr_seq_pacote_orig_p;

c002 CURSOR FOR
	SELECT  ie_inclui_exclui,
		ie_excedente,
		cd_area_proced,
		cd_especial_proced,
		cd_grupo_proced,
		cd_procedimento,
		ie_origem_proced,
		qt_limite,
		ie_considera_honorario,
		cd_setor_atendimento,
		ie_tipo_atendimento,
		ie_calcula_honorario,
		ie_calcula_custo_oper,
		nr_seq_pac_acomod,
		pr_desconto,
		ie_tipo_valor,
		qt_idade_min,
		qt_idade_max,
		vl_maximo,
		vl_minimo,
		nr_seq_proc_interno,
		ie_ratear_item,
		pr_desc,
		vl_negociado,
		ie_agendavel,
		ie_sexo,
		cd_centro_custo,
		nr_seq_classif,
		ie_valida_limite_proc,
		nr_seq_estrutura
	from	pacote_procedimento
	where	nr_seq_pacote   = nr_seq_pacote_orig_p;

c03 CURSOR FOR
	SELECT	nr_seq_pacote
	from	pacote
	where	obter_se_contido(nr_seq_pacote, elimina_aspas(nr_seq_pacote_dest_p)) = 'S'
	and	cd_convenio = cd_convenio_p
	and 	nr_seq_pacote <> nr_seq_pacote_orig_p
	and 	ie_situacao = 'A';
	
	c004 CURSOR FOR
	SELECT	
	nr_sequencia,
	nr_seq_pacote,
	ie_tipo_acomod,
	dt_atualizacao,
	nm_usuario   ,
	qt_dias_pacote,
	qt_dias_hospital,
	qt_dias_uti,
	ie_excedente,
	cd_procedimento,
	ie_origem_proced,
	vl_pacote,
	vl_honorario,
	qt_ponto_pacote,
	qt_ponto_honorario,
	cd_estrutura_conta,
	ie_classificacao,
	cd_categoria,
	dt_vigencia,
	ie_exige_gabarito,
	ie_regra_hora_inicio,
	ie_regra_hora_fim,
	ie_situacao,
	qt_idade_min,
	qt_idade_max,
	ie_ratear_repasse,
	dt_vigencia_final,
	ie_tipo_atendimento,
	qt_dias_inter_inicio,
	qt_dias_inter_final,
	ie_gerar_proced_negativo,
	vl_anestesista,
	ie_atend_retorno,
	ie_tipo_anestesia,
	hr_final_pacote,
	pr_faturar_pacote,
	ie_atend_acomp,
	cd_setor_atendimento,
	nr_seq_proc_interno,
	cd_medico_executor,
	cd_plano,
	ie_clinica,
	vl_materiais,
	ie_consiste_cirurgia,
	ie_exige_item_conta,
	vl_auxiliares,
	ds_observacao,
	ie_sexo,
	pr_acrescimo_rn,
	ie_lado,
	ie_setor_lanc_exclusivo,
	qt_procedimento,
	ie_atualiza_medico,
	ie_tipo_atend_conta,
	cd_centro_custo,
	ie_credenciado,
	qt_hora,
	ie_atend_alta,
	ie_consiste_dias_inter,
	ie_data_consiste_idade,
	ie_pacote_mat_ipasgo,
        ie_carater_inter_sus
	from pacote_tipo_acomodacao b
	where b.nr_seq_pacote	= nr_seq_pacote_orig_p;
	
	c004_w	c004%rowtype;


BEGIN

open C03;
loop
fetch C03 into	
	nr_seq_pacote_w;
EXIT WHEN NOT FOUND; /* apply on C03 */
	begin		

	if (nm_tabela_p = 'PACOTE_MATERIAL') then
	     if (ie_excluir_p = 'S') then
		     delete from pacote_material
		     where nr_seq_pacote = nr_seq_pacote_w;
	     end if;

	     open c001;
		     loop
			     fetch   c001 into
				     ie_inclui_exclui_w,
				     ie_excedente_w,
				     cd_grupo_material_w,
				     cd_subgrupo_material_w,
				     cd_classe_material_w,
				     cd_material_w,
				     qt_limite_w,
				     ie_tipo_atendimento_w,
				     cd_setor_atendimento_w,
				     nr_seq_pac_acomod_w,
				     ie_valor_w,
				     vl_minimo_w,
				     vl_maximo_w,
				     pr_desconto_w,
				     IE_TIPO_SETOR_w,
				     nr_seq_familia_w,
				     qt_idade_min_w,
				     qt_idade_max_w,
				     ie_objetivo_w,
				     ie_considera_generico_w,
				     pr_orcamento_w,
				     ie_sexo_w,
				     cd_centro_custo_w,
				     ie_ratear_item_w,
				     vl_negociado_w,
				     nr_seq_estrutura_w,
				     cd_local_estoque_w;
			     EXIT WHEN NOT FOUND; /* apply on c001 */
			     begin
				select	nextval('pacote_material_seq')
				into STRICT	nr_seq_mat_proc_w
				;

			     insert  into pacote_material(nr_seq_pacote,
				     nr_sequencia,
				     ie_inclui_exclui,
				     dt_atualizacao,
				     nm_usuario,
				     ie_excedente,
				     cd_grupo_material,
				     cd_subgrupo_material,
				     cd_classe_material,
				     cd_material,
				     qt_limite,
				     ie_tipo_atendimento,
				     cd_setor_atendimento,
				     nr_seq_pac_acomod,
				     ie_valor,
				     vl_minimo,
				     vl_maximo,
				     pr_desconto,
				     IE_TIPO_SETOR,
				     nr_seq_familia,
				     qt_idade_min,
				     qt_idade_max,
				     ie_objetivo,
				     ie_considera_generico,
				     pr_orcamento,
				     ie_sexo,
				     cd_centro_custo,
				     ie_ratear_item,
				     vl_negociado,
				     nr_seq_estrutura,
				     cd_local_estoque)
			     values ( nr_seq_pacote_w,
				     nr_seq_mat_proc_w,
				     ie_inclui_exclui_w,
				     clock_timestamp(),
				     nm_usuario_p,
				     ie_excedente_w,
				     cd_grupo_material_w,
				     cd_subgrupo_material_w,
				     cd_classe_material_w,
				     cd_material_w,
				     qt_limite_w,
				     ie_tipo_atendimento_w,
				     cd_setor_atendimento_w,
				     nr_seq_pac_acomod_w,
				     ie_valor_w,
				     vl_minimo_w,
				     vl_maximo_w,
				     pr_desconto_w,
				     IE_TIPO_SETOR_w,
				     nr_seq_familia_w,
				     qt_idade_min_w,
				     qt_idade_max_w,
				     ie_objetivo_w,
				     ie_considera_generico_w,
				     pr_orcamento_w,
				     ie_sexo_w,
				     cd_centro_custo_w,
				     ie_ratear_item_w,
				     vl_negociado_w,
			             nr_seq_estrutura_w,
				     cd_local_estoque_w);
			     end;
		     end loop;
	     close c001;
	elsif (nm_tabela_p = 'PACOTE_PROCEDIMENTO') then
	     if (ie_excluir_p = 'S') then
		     delete from pacote_procedimento
		     where nr_seq_pacote = nr_seq_pacote_w;
	     end if;

	     open c002;
		     loop
			     fetch   c002 into
				     ie_inclui_exclui_w,
				     ie_excedente_w,
				     cd_area_proced_w,
				     cd_especial_proced_w,
				     cd_grupo_proced_w,
				     cd_procedimento_w,
				     ie_origem_proced_w,
				     qt_limite_w,
				     ie_considera_honorario_w,
				     cd_setor_atendimento_w,
				     ie_tipo_atendimento_w,
				     ie_calcula_honorario_w,
				     ie_calcula_custo_oper_w,
				     nr_seq_pac_acomod_w,
				     pr_desconto_w,
				     ie_tipo_valor_w,
				     qt_idade_min_w,
				     qt_idade_max_w,
				     vl_maximo_proc_w,
				     vl_minimo_proc_w,
				     nr_seq_proc_interno_w,
				     ie_ratear_item_w,
				     pr_desc_w,
				     vl_negociado_w,
				     ie_agendavel_w,
				     ie_sexo_w,
				     cd_centro_custo_w,
				     nr_seq_classif_w,
				     ie_valida_limite_proc_w,
				     nr_seq_estrutura_proc_w;
			     EXIT WHEN NOT FOUND; /* apply on c002 */
			     begin
				select	nextval('pacote_procedimento_seq')
			into STRICT	nr_seq_mat_proc_w
			;

			     insert  into pacote_procedimento(nr_seq_pacote,
				     nr_sequencia,
				     ie_inclui_exclui,
				     dt_atualizacao,
				     nm_usuario,
				     ie_excedente,
				     cd_area_proced,
				     cd_especial_proced,
				     cd_grupo_proced,
				     cd_procedimento,
				     ie_origem_proced,
				     qt_limite,
				     ie_considera_honorario,
				     cd_setor_atendimento,
				     ie_tipo_atendimento,
				     ie_calcula_honorario,
				     ie_calcula_custo_oper,
				     nr_seq_pac_acomod,
				     pr_desconto,
				     ie_tipo_valor,
				     qt_idade_min,
				     qt_idade_max,
				     vl_maximo,
				     vl_minimo,
				     nr_seq_proc_interno,
				     ie_ratear_item,
				     pr_desc,
				     vl_negociado,
				     ie_agendavel,
				     ie_sexo,
				     cd_centro_custo,
				     nr_seq_classif,
				     ie_valida_limite_proc,
				     nr_seq_estrutura)
			     values ( nr_seq_pacote_w,
				     nr_seq_mat_proc_w,
				     ie_inclui_exclui_w,
				     clock_timestamp(),
				     nm_usuario_p,
				     ie_excedente_w,
				     cd_area_proced_w,
				     cd_especial_proced_w,
				     cd_grupo_proced_w,
				     cd_procedimento_w,
				     ie_origem_proced_w,
				     qt_limite_w,
				     ie_considera_honorario_w,
				     cd_setor_atendimento_w,
				     ie_tipo_atendimento_w,
				     ie_calcula_honorario_w,
				     ie_calcula_custo_oper_w,
				     nr_seq_pac_acomod_w,
				     pr_desconto_w,
				     ie_tipo_valor_w,
				     qt_idade_min_w,
				     qt_idade_max_w,
				     vl_maximo_proc_w,
				     vl_minimo_proc_w,
				     nr_seq_proc_interno_w,
				     ie_ratear_item_w,
				     pr_desc_w,
				     vl_negociado_w,
				     ie_agendavel_w,
				     ie_sexo_w,
				     cd_centro_custo_w,
				     nr_seq_classif_w,
				     ie_valida_limite_proc_w,
				     nr_seq_estrutura_proc_w);
			     end;
		     end loop;
	     close c002;
	elsif (nm_tabela_p = 'PACOTE_TIPO_ACOMOD_PROC') then
	    if (ie_excluir_p = 'S') then

		    delete from	pacote_tipo_acomod_proc a
			where  	exists (SELECT 1 from pacote_tipo_acomodacao b
						where b.nr_sequencia	 = a.nr_seq_pac_acomod
						and   b.nr_seq_pacote	= nr_seq_pacote_w );
			

			delete from pacote_tipo_acomodacao
		    where nr_seq_pacote = nr_seq_pacote_w;
			
	    end if;

			open c004;
				loop
					fetch   c004 into
						c004_w;
					EXIT WHEN NOT FOUND; /* apply on c004 */
					begin		
					
					
						select	nextval('pacote_tipo_acomodacao_seq')
						into STRICT	nr_seq_pac_tip_acom_w
						;
						
						insert  into pacote_tipo_acomodacao(
								nr_sequencia,
								nr_seq_pacote,
								ie_tipo_acomod,
								dt_atualizacao,
								nm_usuario   ,
								qt_dias_pacote,
								qt_dias_hospital,
								qt_dias_uti,
								ie_excedente,
								cd_procedimento,
								ie_origem_proced,
								vl_pacote,
								vl_honorario,
								qt_ponto_pacote,
								qt_ponto_honorario,
								cd_estrutura_conta,
								ie_classificacao,
								cd_categoria,
								dt_vigencia,
								ie_exige_gabarito,
								ie_regra_hora_inicio,
								ie_regra_hora_fim,
								ie_situacao,
								qt_idade_min,
								qt_idade_max,
								ie_ratear_repasse,
								dt_vigencia_final,
								ie_tipo_atendimento,
								qt_dias_inter_inicio,
								qt_dias_inter_final,
								ie_gerar_proced_negativo,
								vl_anestesista,
								ie_atend_retorno,
								ie_tipo_anestesia,
								hr_final_pacote,
								pr_faturar_pacote,
								ie_atend_acomp,
								cd_setor_atendimento,
								nr_seq_proc_interno,
								cd_medico_executor,
								cd_plano,
								ie_clinica,
								vl_materiais,
								ie_consiste_cirurgia,
								ie_exige_item_conta,
								vl_auxiliares,
								ds_observacao,
								ie_sexo,
								pr_acrescimo_rn,
								ie_lado,
								ie_setor_lanc_exclusivo,
								qt_procedimento,
								ie_atualiza_medico,
								ie_tipo_atend_conta,
								cd_centro_custo,
								ie_credenciado,
								qt_hora,
								ie_atend_alta,
								ie_consiste_dias_inter,
								ie_data_consiste_idade,
								ie_pacote_mat_ipasgo,
                                                                ie_carater_inter_sus
						)
						values (
								nr_seq_pac_tip_acom_w,
								nr_seq_pacote_w,
								c004_w.ie_tipo_acomod,
								clock_timestamp(),
								nm_usuario_p   ,
								c004_w.qt_dias_pacote,
								c004_w.qt_dias_hospital,
								c004_w.qt_dias_uti,
								c004_w.ie_excedente,
								c004_w.cd_procedimento,
								c004_w.ie_origem_proced,
								c004_w.vl_pacote,
								c004_w.vl_honorario,
								c004_w.qt_ponto_pacote,
								c004_w.qt_ponto_honorario,
								c004_w.cd_estrutura_conta,
								c004_w.ie_classificacao,
								c004_w.cd_categoria,
								c004_w.dt_vigencia,
								c004_w.ie_exige_gabarito,
								c004_w.ie_regra_hora_inicio,
								c004_w.ie_regra_hora_fim,
								c004_w.ie_situacao,
								c004_w.qt_idade_min,
								c004_w.qt_idade_max,
								c004_w.ie_ratear_repasse,
								c004_w.dt_vigencia_final,
								c004_w.ie_tipo_atendimento,
								c004_w.qt_dias_inter_inicio,
								c004_w.qt_dias_inter_final,
								c004_w.ie_gerar_proced_negativo,
								c004_w.vl_anestesista,
								c004_w.ie_atend_retorno,
								c004_w.ie_tipo_anestesia,
								c004_w.hr_final_pacote,
								c004_w.pr_faturar_pacote,
								c004_w.ie_atend_acomp,
								c004_w.cd_setor_atendimento,
								c004_w.nr_seq_proc_interno,
								c004_w.cd_medico_executor,
								c004_w.cd_plano,
								c004_w.ie_clinica,
								c004_w.vl_materiais,
								c004_w.ie_consiste_cirurgia,
								c004_w.ie_exige_item_conta,
								c004_w.vl_auxiliares,
								c004_w.ds_observacao,
								c004_w.ie_sexo,
								c004_w.pr_acrescimo_rn,
								c004_w.ie_lado,
								c004_w.ie_setor_lanc_exclusivo,
								c004_w.qt_procedimento,
								c004_w.ie_atualiza_medico,
								c004_w.ie_tipo_atend_conta,
								c004_w.cd_centro_custo,
								c004_w.ie_credenciado,
								c004_w.qt_hora,
								c004_w.ie_atend_alta,
								c004_w.ie_consiste_dias_inter,
								c004_w.ie_data_consiste_idade,
								c004_w.ie_pacote_mat_ipasgo,
                                                                c004_w.ie_carater_inter_sus
						);
						
						

						
						insert  into pacote_tipo_acomod_proc(nr_sequencia,
							dt_atualizacao,
							nm_usuario,
							nr_seq_pac_acomod,
							cd_procedimento,
							ie_origem_proced,
							dt_atualizacao_nrec,
							nm_usuario_nrec)
						 ( 	SELECT	nextval('pacote_tipo_acomod_proc_seq'),
									clock_timestamp(),
									nm_usuario_p,
									nr_seq_pac_tip_acom_w,
									cd_procedimento,
									ie_origem_proced,
									clock_timestamp(),
									nm_usuario_p
							from	pacote_tipo_acomod_proc
							where  	nr_seq_pac_acomod = c004_w.nr_sequencia
						);
						
					end;
				end loop;
			close c004;
				
	end if;

	end;
	end loop;
close C03;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copia_parametro_pacote (nr_seq_pacote_orig_p bigint, nr_seq_pacote_dest_p text, nm_tabela_p text, nm_usuario_p text, ie_excluir_p text, cd_convenio_p bigint, cd_estabelecimento_p bigint) FROM PUBLIC;

