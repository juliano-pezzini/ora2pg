-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copiar_estrutura_produto ( nr_sequencia_p bigint, nm_usuario_p text, produto_sequence_p INOUT bigint) AS $body$
DECLARE

    produto_requisito_sequence_w	bigint;
    mkt_produto_mercado_seq_w		bigint;
	
    C01 CURSOR FOR
        SELECT	nr_sequencia
        from	mkt_produto_requisito
        where	nr_seq_produto = nr_sequencia_p
        order by 1;
    C02 CURSOR FOR
	SELECT	nr_sequencia,
		nr_seq_mercado
	from	mkt_produto_mercado
	where	nr_seq_produto = nr_sequencia_p;
BEGIN
    select nextval('mkt_produto_seq') into STRICT produto_sequence_p;

    /* insert produto*/
	
    insert	into	mkt_produto(	nr_sequencia, 
                    ds_produto,
                    ds_versao_produto, 
                    cd_exp_produto,		
                    dt_atualizacao, 
                    dt_atualizacao_nrec, 
                    nm_usuario, 
                    nm_usuario_nrec) 
        SELECT	produto_sequence_p,
            ds_produto,
            ds_versao_produto, 
            cd_exp_produto,
            clock_timestamp(),
            clock_timestamp(),
            nm_usuario_p,
            nm_usuario_p 
        from	mkt_produto
        where	nr_sequencia = nr_sequencia_p;
	
	/* insert responsaveis produto*/
	
	insert into mkt_in_charge(	nr_sequencia,
				ie_situacao,
				cd_pessoa_fisica,
				nm_usuario,
				dt_atualizacao,
				nr_seq_area_modulo,
				nr_seq_modulo_mercado,
				nr_seq_modulo_funcao,
				nr_seq_funcao_mercado,
				dt_atualizacao_nrec,
				nm_usuario_nrec,
				nr_seq_area_mercado,
				nr_seq_produto_area,
				nr_seq_produto_mercado,
				nr_seq_mercado,
				ds_note,
				nr_seq_produto)
	SELECT	nextval('mkt_in_charge_seq'),
		ie_situacao,
		cd_pessoa_fisica,
		nm_usuario,
		clock_timestamp(),
		nr_seq_area_modulo,
		nr_seq_modulo_mercado,
		nr_seq_modulo_funcao,
		nr_seq_funcao_mercado,
		clock_timestamp(),
		nm_usuario_nrec,
		nr_seq_area_mercado,
		nr_seq_produto_area,
		nr_seq_produto_mercado,
		nr_seq_mercado,
		ds_note,
		produto_sequence_p
	from	mkt_in_charge
	where	nr_seq_produto = nr_sequencia_p;

    CALL copia_campo_long(   'MKT_PRODUTO',
                        'DS_OBSERVACAO',
                        'WHERE NR_SEQUENCIA = :NR_SEQUENCIA',
                        'NR_SEQUENCIA='||nr_sequencia_p,
                        'NR_SEQUENCIA='||produto_sequence_p);

    
	for r_c02 in c02 loop

		select nextval('mkt_produto_mercado_seq') into STRICT mkt_produto_mercado_seq_w;
	
		 /* insert mercado produto*/
	
		insert	into	mkt_produto_mercado(	nr_sequencia,
				dt_atualizacao,
				dt_atualizacao_nrec,
				nm_usuario,
				nm_usuario_nrec,
				nr_seq_mercado,
				nr_seq_produto)
		values (mkt_produto_mercado_seq_w,
		    clock_timestamp(),
		    clock_timestamp(),
		    nm_usuario_p,
		    nm_usuario_p,
		    r_c02.nr_seq_mercado,
		    produto_sequence_p);
		
		/* insert mercado produto responsaveis*/
	
		insert into mkt_in_charge(	nr_sequencia,
						ie_situacao,
						cd_pessoa_fisica,
						nm_usuario,
						dt_atualizacao,
						nr_seq_area_modulo,
						nr_seq_modulo_mercado,
						nr_seq_modulo_funcao,
						nr_seq_funcao_mercado,
						dt_atualizacao_nrec,
						nm_usuario_nrec,
						nr_seq_area_mercado,
						nr_seq_produto_area,
						nr_seq_produto_mercado,
						nr_seq_mercado,
						ds_note,
						nr_seq_produto)
			SELECT	nextval('mkt_in_charge_seq'),
				ie_situacao,
				cd_pessoa_fisica,
				nm_usuario,
				clock_timestamp(),
				nr_seq_area_modulo,
				nr_seq_modulo_mercado,
				nr_seq_modulo_funcao,
				nr_seq_funcao_mercado,
				clock_timestamp(),
				nm_usuario_nrec,
				nr_seq_area_mercado,
				nr_seq_produto_area,
				mkt_produto_mercado_seq_w,
				nr_seq_mercado,
				ds_note,
				produto_sequence_p
			from	mkt_in_charge
			where	nr_seq_produto_mercado = r_c02.nr_sequencia;

	end loop;
	commit;

    /* insert core funcao*/
	
    insert	into	mkt_prod_core_funcao(	nr_sequencia,
                        dt_atualizacao,
                        dt_atualizacao_nrec,
                        nm_usuario,
                        nm_usuario_nrec,
                        nr_seq_produto,
                        cd_funcao)
        SELECT	nextval('mkt_prod_core_funcao_seq'),
            clock_timestamp(),
            clock_timestamp(),
            nm_usuario_p,
            nm_usuario_p,
            produto_sequence_p,
            cd_funcao
        from	mkt_prod_core_funcao
        where	nr_seq_produto = nr_sequencia_p;

    for r_c01 in c01 loop
        select nextval('mkt_produto_requisito_seq') into STRICT produto_requisito_sequence_w;

        /* insert requisitos */
		
        insert	into	mkt_produto_requisito(	nr_sequencia,
                            dt_atualizacao,
                            dt_atualizacao_nrec,
                            nm_usuario,
                            nm_usuario_nrec,
                            nr_seq_produto)
            values (produto_requisito_sequence_w,
                clock_timestamp(),
                clock_timestamp(),
                nm_usuario_p,
                nm_usuario_p,
                produto_sequence_p);

        CALL copia_campo_long(   'mkt_produto_requisito',
                            'DS_REQUISITOS',
                            'WHERE NR_SEQUENCIA = :NR_SEQUENCIA',
                            'NR_SEQUENCIA='||r_c01.nr_sequencia,
                            'NR_SEQUENCIA='||produto_requisito_sequence_w);
    end loop;
    commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copiar_estrutura_produto ( nr_sequencia_p bigint, nm_usuario_p text, produto_sequence_p INOUT bigint) FROM PUBLIC;

