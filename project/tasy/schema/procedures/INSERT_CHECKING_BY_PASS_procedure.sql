-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_checking_by_pass ( nr_pr_p bigint, ds_author_p text, ds_reviewer_p text, ds_bypass_author_p text, ds_rational_p text, ds_repo_p text, ie_type_by_pass_p text) AS $body$
DECLARE


nr_sequencia_w		bigint;	
				

BEGIN

/**
IE_TYPE_BY_PASS

S - Sonarqube
W - Compiler warnings
L - Lines of code size
O - Odin lint check
*/
begin
select 	nr_sequencia
into STRICT	nr_sequencia_w
from	COE_BY_PASS_ANALYSIS
where	nr_pr = nr_pr_p
and 	ds_repo = ds_repo_p
and 	ie_type_by_pass = ie_type_by_pass_p;

EXCEPTION
   WHEN no_data_found THEN
   begin
      NR_SEQUENCIA_W := null;
   end;
end;

if (nr_sequencia_w IS NOT NULL AND nr_sequencia_w::text <> '') then

	update 	coe_by_pass_analysis
	set 	DS_AUTHOR = ds_author_p,
			DS_REVIEWER = ds_reviewer_p,
			DS_BYPASS_AUTHOR = ds_bypass_author_p,
			DS_RATIONAL = ds_rational_p,
			NM_USUARIO = ds_author_p
	where	NR_SEQUENCIA = NR_SEQUENCIA_W;

else

	insert into COE_BY_PASS_ANALYSIS(NR_SEQUENCIA,
			NR_PR,
			DS_AUTHOR,
			DS_REVIEWER,
			DS_BYPASS_AUTHOR,
    		DS_RATIONAL,
			DS_REPO,
    		IE_TYPE_BY_PASS,
    		IE_STATUS,
    		NM_USUARIO,
    		NM_USUARIO_NREC,
    		DT_ATUALIZACAO,
    		DT_ATUALIZACAO_NREC)
	values (nextval('coe_by_pass_analysis_seq'),
			nr_pr_p,
			ds_author_p,
			ds_reviewer_p,
			ds_bypass_author_p,
			ds_rational_p,
			ds_repo_p,
			ie_type_by_pass_p,
    			'P',
 			ds_author_p,
    		ds_author_p,
    		clock_timestamp(),
    		clock_timestamp());

end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_checking_by_pass ( nr_pr_p bigint, ds_author_p text, ds_reviewer_p text, ds_bypass_author_p text, ds_rational_p text, ds_repo_p text, ie_type_by_pass_p text) FROM PUBLIC;

