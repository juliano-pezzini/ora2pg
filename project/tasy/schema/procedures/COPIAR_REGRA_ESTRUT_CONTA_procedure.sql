-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copiar_regra_estrut_conta ( cd_estrutura_origem_p bigint, cd_estrutura_Destino_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_sequencia_w			bigint := 0;
nr_seq_Origem_w			bigint := 0;

c01 CURSOR FOR
SELECT 	nr_sequencia
from 	Conta_Estrut_Proc
where cd_estrutura	= cd_estrutura_origem_p;

c02 CURSOR FOR
SELECT 	nr_sequencia
from 	Conta_Estrut_Mat
where cd_estrutura	= cd_estrutura_origem_p;



BEGIN

OPEN C01;
LOOP
FETCH C01 into	nr_seq_Origem_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin
	select coalesce(max(nr_sequencia),0) + 1
	into STRICT nr_sequencia_w
	from conta_estrut_proc;
	insert into Conta_Estrut_Proc(
		nr_sequencia, cd_estrutura, dt_atualizacao, nm_usuario,
		cd_area_proced, cd_especial_proced, cd_grupo_proced,
		cd_procedimento, ie_origem_proced, cd_convenio,
		ie_credenciado, ie_honorario, cd_setor_atendimento,
		ie_tipo_atendimento, cd_especialidade, cd_medico,
		cd_edicao_amb, cd_estabelecimento, nr_seq_grupo_lab, cd_tipo_procedimento)
	SELECT
		nr_sequencia_w, cd_estrutura_destino_p, clock_timestamp(), nm_usuario_p,
		cd_area_proced, cd_especial_proced, cd_grupo_proced,
		cd_procedimento, ie_origem_proced, cd_convenio,
		ie_credenciado, ie_honorario, cd_setor_atendimento,
		ie_tipo_atendimento, cd_especialidade, cd_medico,
		cd_edicao_amb, cd_estabelecimento, nr_seq_grupo_lab, cd_tipo_procedimento
	from Conta_Estrut_Proc
	where nr_sequencia	= nr_seq_origem_w;
	end;
END LOOP;
CLOSE C01;

OPEN C02;
LOOP
FETCH C02 into	nr_seq_Origem_w;
EXIT WHEN NOT FOUND; /* apply on c02 */
	begin
	select coalesce(max(nr_sequencia),0) + 1
	into STRICT nr_sequencia_w
	from conta_estrut_mat;
	insert into Conta_Estrut_Mat(
		nr_sequencia, cd_estrutura, dt_atualizacao, nm_usuario,
		cd_grupo_material, cd_subgrupo_material, cd_classe_material,
		cd_material, cd_convenio, cd_setor_atendimento, ie_tipo_atendimento, cd_estabelecimento,
		ie_tipo_material)
	SELECT
		nr_sequencia_w, cd_estrutura_destino_p, clock_timestamp(), nm_usuario_p,
		cd_grupo_material, cd_subgrupo_material, cd_classe_material,
		cd_material, cd_convenio, cd_setor_atendimento, ie_tipo_atendimento, cd_estabelecimento,
		ie_tipo_material
	from Conta_Estrut_Mat
	where nr_sequencia	= nr_seq_origem_w;
	end;
END LOOP;
CLOSE C02;

commit;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copiar_regra_estrut_conta ( cd_estrutura_origem_p bigint, cd_estrutura_Destino_p bigint, nm_usuario_p text) FROM PUBLIC;

