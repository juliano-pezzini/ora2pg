-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_desfazer_calculo_peona ( nr_seq_peona_p bigint, nm_usuario_p text) AS $body$
DECLARE


ie_concil_contab_w	pls_visible_false.ie_concil_contab%type;
cd_estabelecimento_w	estabelecimento.cd_estabelecimento%type;


BEGIN

cd_estabelecimento_w 	:= Obter_estab_usuario(nm_usuario_p);

select	coalesce(max(ie_concil_contab), 'N')
into STRICT	ie_concil_contab_w
from	pls_visible_false
where	cd_estabelecimento = cd_estabelecimento_w;

if (ie_concil_contab_w = 'S') then
	CALL pls_ctb_onl_gravar_movto_pck.gravar_movto_desf_calc_peona(nr_seq_peona_p, cd_estabelecimento_w, nm_usuario_p);
end if;

delete from pls_valores_peona
where	nr_seq_peona	= nr_seq_peona_p;

update	pls_peona	
set	nr_parcela		 = NULL,
	vl_total_receita	= 0,
	vl_total_despesa	= 0,
	vl_base_receita		= 0,
	vl_base_despesa		= 0,
	vl_base			= 0,
	vl_estimativa_mes	= 0,
	vl_estimativa_parcela	= 0,
	vl_acumulado		= 0,
	vl_base_parcela		= 0,
	vl_acumulado_estimativa	= 0,
	vl_peona		= 0
where	nr_sequencia		= nr_seq_peona_p;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_desfazer_calculo_peona ( nr_seq_peona_p bigint, nm_usuario_p text) FROM PUBLIC;

