-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE calc_ele_npt_prot_formula_md (Qt_Diaria_p bigint, qt_peso_p bigint, Ie_Tipo_Elemento_p text, ie_Glutamina_p text, QT_FORMULA_PROT_P bigint, qt_carb_Factor_p bigint, qt_Conversao_Kcal_p bigint, qt_lipid_Factor_p bigint, Ie_Prim_Fase_p text, Ie_Seg_Fase_p text, Ie_Terc_Fase_p text, Ie_Quar_Fase_p text, Qt_Fase_Npt_p bigint, Qt_Volume_p bigint, qt_Kcal_Lipidio_p INOUT bigint, pr_Conc_Lipidio_Solucao_p INOUT bigint, pr_Conc_Proteina_Solucao_p INOUT bigint, qt_Kcal_Proteina_p INOUT bigint, pr_Conc_Glic_Solucao_p INOUT bigint, qt_Kcal_Carboidrato_p INOUT bigint, qt_Vel_Inf_Glicose_p INOUT bigint, Qt_Elem_KgDia_p INOUT bigint, Qt_Kcal_p INOUT bigint, Qt_Vol1_Fase_p INOUT bigint, Qt_Vol2_Fase_p INOUT bigint, Qt_Vol3_Fase_p INOUT bigint, Qt_Vol4_Fase_p INOUT bigint ) AS $body$
DECLARE

   qt_Vol_Phase_w      bigint := 0;
   qt_Phase_Npt_Per_w  bigint := 0;
   qt_Kcal_w           bigint := 0;
   qt_Conversao_Kcal_w bigint;
   qt_Elem_KgDia_w     bigint;

BEGIN
    qt_Elem_KgDia_w := dividir_sem_round_md(Qt_Diaria_p,qt_peso_p);


    if (Ie_Tipo_Elemento_p IS NOT NULL AND Ie_Tipo_Elemento_p::text <> '') then
        if upper(Ie_Tipo_Elemento_p) = 'P' then 
            if upper(ie_Glutamina_p) <> 'S' then
                pr_Conc_Proteina_Solucao_p := Qt_Diaria_p;
                qt_Kcal_w                  := Qt_Diaria_p * QT_FORMULA_PROT_P;
                qt_Kcal_Proteina_p         := qt_Kcal_w;
            end if;

        elsif upper(Ie_Tipo_Elemento_p) = 'C' then
            pr_Conc_Glic_Solucao_p := Qt_Diaria_p;
            qt_Kcal_w              := Qt_Diaria_p * qt_carb_Factor_p;
            qt_Kcal_Carboidrato_p  := qt_Kcal_w;
            qt_Vel_Inf_Glicose_p   := dividir_sem_round_md(qt_Elem_KgDia_w,1.44);

        elsif upper(Ie_Tipo_Elemento_p) = 'L' then
            if qt_Conversao_Kcal_p = 0 then
               qt_Conversao_Kcal_w := qt_lipid_Factor_p;
            else
               qt_Conversao_Kcal_w := qt_Conversao_Kcal_p;
            end if;

            qt_Kcal_w                 := Qt_Diaria_p * qt_Conversao_Kcal_w;
            qt_Kcal_Lipidio_p         := coalesce(qt_Kcal_Lipidio_p,0) + coalesce(qt_Kcal_w,0);
            pr_Conc_Lipidio_Solucao_p := coalesce(pr_Conc_Lipidio_Solucao_p,0) + coalesce(Qt_Diaria_p,0);
        else
          qt_Kcal_w := 0;
        end if;
    end if;

    Qt_Elem_KgDia_p := coalesce(qt_Elem_KgDia_w,0);
    Qt_Kcal_p       := coalesce(qt_Kcal_w,0);

    if ((Ie_Quar_Fase_p IS NOT NULL AND Ie_Quar_Fase_p::text <> '') and Ie_Quar_Fase_p = 'S') then
        qt_Phase_Npt_Per_w := 4;
    end if;
    
    if ((Ie_Terc_Fase_p IS NOT NULL AND Ie_Terc_Fase_p::text <> '') and Ie_Terc_Fase_p = 'S') then
        qt_Phase_Npt_Per_w := 3;
    end if;

    if ((Ie_Seg_Fase_p IS NOT NULL AND Ie_Seg_Fase_p::text <> '') and Ie_Seg_Fase_p = 'S') then
        qt_Phase_Npt_Per_w := 2;
    end if;

    if ((Ie_Prim_Fase_p IS NOT NULL AND Ie_Prim_Fase_p::text <> '') and Ie_Prim_Fase_p = 'S') then
        qt_Phase_Npt_Per_w := 1;
    end if;
    

    if (Qt_Fase_Npt_p > qt_Phase_Npt_Per_w) then
        qt_Vol_Phase_w := dividir_sem_round_md(Qt_Volume_p,qt_Phase_Npt_Per_w);
    else
        qt_Vol_Phase_w := dividir_sem_round_md(Qt_Volume_p,Qt_Fase_Npt_p);
    end if;

    if (Qt_Fase_Npt_p > 0 and Ie_Prim_Fase_p = 'S') then
        Qt_Vol1_Fase_p := coalesce(qt_Vol_Phase_w,0);
    end if;

    if (Qt_Fase_Npt_p > 1 and Ie_Seg_Fase_p = 'S') then
        Qt_Vol2_Fase_p := coalesce(qt_Vol_Phase_w,0);
    end if;

    if (Qt_Fase_Npt_p > 2 and Ie_Terc_Fase_p = 'S') then
        Qt_Vol3_Fase_p := coalesce(qt_Vol_Phase_w,0);
    end if;

    if (Qt_Fase_Npt_p > 2 and Ie_Quar_Fase_p = 'S') then
        Qt_Vol4_Fase_p := coalesce(qt_Vol_Phase_w,0);
    end if;


END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE calc_ele_npt_prot_formula_md (Qt_Diaria_p bigint, qt_peso_p bigint, Ie_Tipo_Elemento_p text, ie_Glutamina_p text, QT_FORMULA_PROT_P bigint, qt_carb_Factor_p bigint, qt_Conversao_Kcal_p bigint, qt_lipid_Factor_p bigint, Ie_Prim_Fase_p text, Ie_Seg_Fase_p text, Ie_Terc_Fase_p text, Ie_Quar_Fase_p text, Qt_Fase_Npt_p bigint, Qt_Volume_p bigint, qt_Kcal_Lipidio_p INOUT bigint, pr_Conc_Lipidio_Solucao_p INOUT bigint, pr_Conc_Proteina_Solucao_p INOUT bigint, qt_Kcal_Proteina_p INOUT bigint, pr_Conc_Glic_Solucao_p INOUT bigint, qt_Kcal_Carboidrato_p INOUT bigint, qt_Vel_Inf_Glicose_p INOUT bigint, Qt_Elem_KgDia_p INOUT bigint, Qt_Kcal_p INOUT bigint, Qt_Vol1_Fase_p INOUT bigint, Qt_Vol2_Fase_p INOUT bigint, Qt_Vol3_Fase_p INOUT bigint, Qt_Vol4_Fase_p INOUT bigint ) FROM PUBLIC;

