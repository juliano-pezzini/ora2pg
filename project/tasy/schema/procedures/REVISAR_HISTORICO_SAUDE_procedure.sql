-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE revisar_historico_saude ( nr_sequencia_p bigint, nm_tabela_p text, nm_usuario_p text) AS $body$
DECLARE

 
ds_comando_w varchar(4000);
ds_sep_bv_w		varchar(10);

BEGIN
ds_sep_bv_w	:= obter_separador_bv;
 
if (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '') and (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') then 
	if (upper(nm_tabela_p) = 'PACIENTE_ALERGIA') then 
		update	paciente_alergia 
		set	dt_revisao		= clock_timestamp(), 
			nm_usuario_revisao	= nm_usuario_p, 
			cd_setor_revisao	= wheb_usuario_pck.get_cd_setor_atendimento 
		where	nr_sequencia		= nr_sequencia_p;
	elsif (upper(nm_tabela_p) = 'PACIENTE_MEDIC_USO') then 
		update	paciente_medic_uso 
		set	dt_revisao		= clock_timestamp(), 
			nm_usuario_revisao	= nm_usuario_p, 
			cd_setor_revisao	= wheb_usuario_pck.get_cd_setor_atendimento 
		where	nr_sequencia		= nr_sequencia_p;
	elsif (upper(nm_tabela_p) = 'PACIENTE_ANTEC_CLINICO') then 
		update	paciente_antec_clinico 
		set	dt_revisao		= clock_timestamp(), 
			nm_usuario_revisao	= nm_usuario_p, 
			cd_setor_revisao	= wheb_usuario_pck.get_cd_setor_atendimento 
		where	nr_sequencia		= nr_sequencia_p;
	elsif (upper(nm_tabela_p) = 'HISTORICO_SAUDE_CIRURGIA') then 
		update	historico_saude_cirurgia 
		set	dt_revisao		= clock_timestamp(), 
			nm_usuario_revisao	= nm_usuario_p 
		where	nr_sequencia		= nr_sequencia_p;
	else	 
 
	ds_comando_w	:=	' update ' || nm_tabela_p || 
			' set DT_REVISAO = sysdate , ' || 
			'	 NM_USUARIO_REVISAO = :NM_USUARIO '|| 
			' where nr_sequencia = :qt_valor ';
			 
	CALL exec_sql_dinamico_bv(obter_desc_expressao(726973), ds_comando_w, 'qt_valor='|| to_char(nr_sequencia_p) || ds_sep_bv_w || 
							 'nm_usuario='|| nm_usuario_p || ds_sep_bv_w);	
 
	end if;
end if;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE revisar_historico_saude ( nr_sequencia_p bigint, nm_tabela_p text, nm_usuario_p text) FROM PUBLIC;

