-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gerar_grupos_contr_interc ( nr_seq_intercambio_p bigint, ie_tipo_repasse_p text, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_seq_intercambio_w		bigint;
nr_seq_congenere_w		bigint;
nr_seq_oper_congenere_w		bigint;
nr_seq_regra_grupo_w		bigint;
cd_operadora_empresa_w		bigint;
cd_cgc_empresa_w		varchar(14);

C01 CURSOR FOR
	SELECT	b.nr_sequencia
	from	pls_regra_grupo_inter	b,
		pls_regra_benef_grupo	a
	where	a.nr_seq_regra		= b.nr_sequencia
	and	b.ie_situacao		= 'A'
	and	((a.nr_seq_cooperativa	= nr_seq_congenere_w and (a.nr_seq_cooperativa IS NOT NULL AND a.nr_seq_cooperativa::text <> '')) or (coalesce(a.nr_seq_cooperativa::text, '') = ''))
	and	((a.nr_seq_congenere	= nr_seq_oper_congenere_w and (a.nr_seq_congenere IS NOT NULL AND a.nr_seq_congenere::text <> '')) or (coalesce(a.nr_seq_congenere::text, '') = ''))
	and	((a.cd_cgc_empresa	= cd_cgc_empresa_w and (a.cd_cgc_empresa IS NOT NULL AND a.cd_cgc_empresa::text <> '')) or (coalesce(a.cd_cgc_empresa::text, '') = ''))
	and	((a.ie_tipo_repasse	= ie_tipo_repasse_p and (a.ie_tipo_repasse IS NOT NULL AND a.ie_tipo_repasse::text <> '')) or (coalesce(a.ie_tipo_repasse::text, '') = ''))
	and	((a.cd_operadora_empresa = cd_operadora_empresa_w and (a.cd_operadora_empresa IS NOT NULL AND a.cd_operadora_empresa::text <> '')) or (coalesce(a.cd_operadora_empresa::text, '') = ''))
	order by coalesce(a.nr_seq_cooperativa,0),
		coalesce(a.nr_seq_congenere,0),
		coalesce(a.ie_tipo_repasse,0),
		coalesce(a.cd_cgc_empresa,0),
		coalesce(a.cd_operadora_empresa,0);


BEGIN

select	nr_seq_congenere,
	nr_seq_oper_congenere,
	cd_cgc,
	CD_OPERADORA_EMPRESA
into STRICT	nr_seq_congenere_w,
	nr_seq_oper_congenere_w,
	cd_cgc_empresa_w,
	cd_operadora_empresa_w
from	pls_intercambio
where	nr_sequencia	= nr_seq_intercambio_p;

open C01;
loop
fetch C01 into
	nr_seq_regra_grupo_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
end loop;
close C01;

if (nr_seq_regra_grupo_w IS NOT NULL AND nr_seq_regra_grupo_w::text <> '') then
	update	PLS_INTERCAMBIO
	set	NR_SEQ_GRUPO_INTERCAMBIO	= nr_seq_regra_grupo_w
	where	nr_sequencia			= nr_seq_intercambio_p;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_grupos_contr_interc ( nr_seq_intercambio_p bigint, ie_tipo_repasse_p text, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

