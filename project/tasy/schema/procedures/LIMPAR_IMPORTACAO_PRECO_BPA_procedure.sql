-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE limpar_importacao_preco_bpa ( dt_competencia_p timestamp, ds_versao_p text, nm_usuario_p text) AS $body$
DECLARE


qt_registro_w	bigint;


BEGIN

if (dt_competencia_p IS NOT NULL AND dt_competencia_p::text <> '') then
	select	count(*)
	into STRICT	qt_registro_w
	from	sus_preco_procbpa
	where	dt_competencia = dt_competencia_p;

	while	qt_registro_w  > 0 LOOP

		Delete	FROM sus_preco_procbpa
		where	dt_competencia = dt_competencia_p  LIMIT 1000;

		CALL gravar_log_exclusao('SUS_PRECO_PROCBPA',nm_usuario_p,'Competência: '||to_char(dt_competencia_p,'dd/mm/yyyy')||' ATESUS_BP','N');

		commit;

		qt_registro_w	:= qt_registro_w - 1000;

	end loop;
elsif (ds_versao_p IS NOT NULL AND ds_versao_p::text <> '') then
	select	count(*)
	into STRICT	qt_registro_w
	from	sus_preco_procbpa
	where	ie_versao = ds_versao_p;

	while	qt_registro_w  > 0 LOOP

		Delete	FROM sus_preco_procbpa
		where	ie_versao = ds_versao_p  LIMIT 1000;

		CALL gravar_log_exclusao('SUS_PRECO_PROCBPA',nm_usuario_p,'Versão: '||ds_versao_p ||' ATESUS_BP','N');

		commit;

		qt_registro_w	:= qt_registro_w - 1000;
	end loop;
end if;


END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE limpar_importacao_preco_bpa ( dt_competencia_p timestamp, ds_versao_p text, nm_usuario_p text) FROM PUBLIC;

