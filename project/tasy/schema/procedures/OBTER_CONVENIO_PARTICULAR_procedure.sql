-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_convenio_particular ( cd_estabelecimento_p bigint, CD_CONVENIO_P INOUT bigint, CD_CATEGORIA_P INOUT text) AS $body$
DECLARE


cd_categoria_w	varchar(10);


BEGIN

begin
SELECT	coalesce(cd_convenio_partic, 0),
	coalesce(cd_categoria_partic, 0)
into STRICT	CD_CONVENIO_P,
	CD_CATEGORIA_P
from	parametro_faturamento
where	cd_estabelecimento = cd_estabelecimento_p;
exception
	when others then
		CD_CONVENIO_P	:= 0;
		CD_CATEGORIA_P	:= 0;
end;

if (CD_CONVENIO_P = 0) or (CD_CATEGORIA_P = 0) then
	begin
	SELECT coalesce(vl_parametro,VL_PARAMETRO_PADRAO)
	INTO STRICT   CD_CONVENIO_P
	FROM   FUNCAO_PARAMETRO
	WHERE  CD_FUNCAO = 81
	AND  	 NR_SEQUENCIA = 10;
	exception
		when others then
			cd_convenio_p	:= 0;
	end;

	begin
	SELECT coalesce(vl_parametro,VL_PARAMETRO_PADRAO)
	INTO STRICT   CD_CATEGORIA_P
	FROM   FUNCAO_PARAMETRO
	WHERE  CD_FUNCAO = 81
	AND  	 NR_SEQUENCIA = 11;
	exception
		when others then
          		cd_categoria_p	:= 0;
	end;
end if;

begin
select cd_categoria
into STRICT cd_categoria_w
from categoria_convenio
where cd_convenio = cd_convenio_p
  and cd_categoria = cd_categoria_p;
exception
	when no_data_found then
		--r.aise_application_error(-20011,'Categoria do convênio particular não encontrada. Verifique parâmetros do faturamento!');
		CALL wheb_mensagem_pck.exibir_mensagem_abort(263418);
end;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_convenio_particular ( cd_estabelecimento_p bigint, CD_CONVENIO_P INOUT bigint, CD_CATEGORIA_P INOUT text) FROM PUBLIC;

