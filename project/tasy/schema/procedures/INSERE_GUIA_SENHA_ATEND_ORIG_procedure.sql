-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insere_guia_senha_atend_orig ( nr_atend_retorno_p bigint, nr_atend_atual_p bigint) AS $body$
DECLARE


nr_seq_interno_w		bigint;
nr_doc_convenio_w	varchar(20);
nr_doc_conv_principal_w	varchar(20);
cd_senha_w		varchar(20);
ie_valor_copia_w	varchar(3);

BEGIN

if (coalesce(nr_atend_retorno_p,0) > 0) then
ie_valor_copia_w := Obter_param_Usuario(916, 1113, obter_perfil_ativo, obter_usuario_ativo, obter_estabelecimento_ativo, ie_valor_copia_w);

	select 	max(nr_doc_convenio) nr_doc_convenio,
		max(cd_senha) cd_senha,
		max(nr_doc_conv_principal)
	into STRICT	nr_doc_convenio_w,
		cd_senha_w,
		nr_doc_conv_principal_w
	from   	atend_categoria_convenio
	where  	nr_atendimento = nr_atend_retorno_p;

	if (coalesce(ie_valor_copia_w,'X') = 'G') then -- Somente Guia
		cd_senha_w		:= '';
		nr_doc_conv_principal_w := '';
	elsif (coalesce(ie_valor_copia_w,'X') = 'SE') then -- Somente Senha
		nr_doc_convenio_w	:= '';
		nr_doc_conv_principal_w := '';
	elsif (coalesce(ie_valor_copia_w,'X') = 'GP') then -- Somente Guia principal
		nr_doc_convenio_w	:= '';
		cd_senha_w		:= '';
	elsif (coalesce(ie_valor_copia_w,'X') = 'GS') then -- Somente Guia e senha
		nr_doc_conv_principal_w := '';
	elsif (coalesce(ie_valor_copia_w,'X') = 'GGP') then -- Somente Guia e guia principal
		cd_senha_w		:= '';
	elsif (coalesce(ie_valor_copia_w,'X') = 'SGP') then -- Somente Senha e guia principal
		nr_doc_convenio_w	:= '';
	end if;

	select	Obter_Atecaco_atendimento(nr_atend_atual_p)
	into STRICT	nr_seq_interno_w
	;

	update	atend_categoria_convenio
	set	nr_doc_convenio		= nr_doc_convenio_w,
		cd_senha		= cd_senha_w,
		nr_doc_conv_principal	= nr_doc_conv_principal_w
	where	nr_seq_interno		= nr_seq_interno_w;

end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insere_guia_senha_atend_orig ( nr_atend_retorno_p bigint, nr_atend_atual_p bigint) FROM PUBLIC;

