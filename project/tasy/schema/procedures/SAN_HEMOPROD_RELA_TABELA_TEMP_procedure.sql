-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE san_hemoprod_rela_tabela_temp ( dt_inicio_p timestamp, dt_final_p timestamp, ie_opcao_p text) AS $body$
DECLARE


ds_campo_w	varchar(255);
ie_opcao_w	varchar(15);
ds_resultado_w	varchar(255);
qt_resultado_w	bigint;
qt_resultado2_w	bigint;
qt1_w		bigint;
qt2_w		bigint;
qt3_w		bigint;
qt_result1_w	varchar(15);
qt_result2_w	varchar(15);
qt_result3_w	varchar(15);
dt_inicio_w	timestamp;
dt_final_w         timestamp;
nr_seq_doacao_w	bigint;

C01 CURSOR FOR
         SELECT         a.vl_dominio,
                  CASE WHEN a.vl_dominio='S' THEN OBTER_DESC_EXPRESSAO(297642)  ELSE a.ds_valor_dominio END  ds_valor_dominio
         from           valor_dominio a
         where         cd_dominio          = 2936
         and         ie_opcao_p          in ('T','A');


C02 CURSOR FOR
         SELECT         a.vl_dominio,
                  a.ds_valor_dominio
         from           valor_dominio a
         where         cd_dominio = 4
	 and		a.vl_dominio <> 'I'
         and         ie_opcao_p in ('T','A');

C03 CURSOR FOR
         SELECT         1 cd_faixa,

                  OBTER_DESC_EXPRESSAO(728042) ds_faixa

         where          ie_opcao_p in ('T','A')
         
union

         SELECT         2 cd_faixa,

                  OBTER_DESC_EXPRESSAO(728044) ds_faixa
         
         where         ie_opcao_p in ('T','A')
         
union

         select         3 cd_faixa,

                  OBTER_DESC_EXPRESSAO(728048) ds_faixa
         
         where         ie_opcao_p in ('T','A');

C04 CURSOR FOR
         SELECT         nr_sequencia,
                  ds_motivo_inaptidao
         FROM            SAN_MOTIVO_INAPTIDAO
         WHERE           nr_sequencia IN (4,2,14,8,16,3,17,18,147)
         AND          ie_opcao_p in ('T','A')
         order by ds_motivo_inaptidao;

C05 CURSOR FOR
         SELECT        a.nr_sequencia,
                       a.ds_grupo_reacao
         from          san_grupo_reacao a,
                       san_tipo_reacao b
         where         ie_opcao_p in ('C','A')
         and           b.IE_CONSIDERA_REACAO = 'S'
         and           b.ie_local_reacao = 'C'
         and           b.nr_seq_grupo_reacao = a.nr_sequencia;

C06 CURSOR FOR
         SELECT        a.nr_sequencia,
                       a.ds_exame
         from          san_exame a
         where         a.ie_exige_senha = 'S'
         and           a.nr_sequencia not in (5,25,50,9)
         and           ie_opcao_p in ('E','A')
         and           a.IE_CONSISTE_RESULT_POS = 'S'
         order by ds_exame;

C07 CURSOR FOR
         SELECT         a.ds_valor_dominio||b.ds ds_sangue
         from (SELECT         ds_valor_dominio
                  from           valor_dominio a
                  where         cd_dominio = 1173) a,
                  (select         '+' ds

                  
union

                  select         '-' ds
                  ) b
         where         ie_opcao_p in ('E','A')
         order by ds_sangue;

C08 CURSOR FOR
         SELECT          ie_tipo_derivado,
                  ds_tipo_derivado ds_tipo_derivado
         from (SELECT distinct         CASE WHEN a.nr_sequencia=15 THEN 9999 WHEN a.nr_sequencia=16 THEN 9999  ELSE a.nr_sequencia END  ie_tipo_derivado,
                                     CASE WHEN a.nr_sequencia=15 THEN OBTER_DESC_EXPRESSAO(728052) WHEN a.nr_sequencia=16 THEN OBTER_DESC_EXPRESSAO(728052)  ELSE ds_derivado END  ds_tipo_derivado
                  from           san_derivado a
                  where         ie_situacao = 'A'
		  and		(a.ie_tipo_derivado IS NOT NULL AND a.ie_tipo_derivado::text <> '')

union

                  select          99999,

                             OBTER_DESC_EXPRESSAO(488765)
                  
                  
union

                  select          999999,

                             OBTER_DESC_EXPRESSAO(488769)
                  ) alias5
         where         (ie_tipo_derivado IS NOT NULL AND ie_tipo_derivado::text <> '')
         and         ie_opcao_p in ('P','A')
	 order by ds_tipo_derivado;

C09 CURSOR FOR
         SELECT          nr_seq_derivado,
                  ds_tipo_derivado ds_tipo_derivado
         from (SELECT distinct         CASE WHEN a.nr_sequencia=15 THEN 9999 WHEN a.nr_sequencia=16 THEN 9999  ELSE a.nr_sequencia END  nr_seq_derivado,
                                     CASE WHEN a.nr_sequencia=15 THEN OBTER_DESC_EXPRESSAO(728052) WHEN a.nr_sequencia=16 THEN OBTER_DESC_EXPRESSAO(728052)  ELSE ds_derivado END  ds_tipo_derivado
                  from           san_derivado a
                  where         ie_situacao = 'A'
		  and		a.nr_sequencia in (6,3,12,1,7,5,15,16)) alias3
         where         ie_opcao_p in ('P','A')
	 order by ds_tipo_derivado;


C10 CURSOR FOR
         SELECT          DISTINCT
                  x.ds_derivado ds_derivado,
                  coalesce(b.qt_ambulatorio,0) qt_ambulatorio,
                  coalesce(c.qt_entidade,0) qt_hospitalar
         FROM san_derivado x
LEFT OUTER JOIN (         SELECT         COUNT(*) qt_ambulatorio,
                                    b.nr_seq_derivado
                           FROM         san_derivado c,
                                    atendimento_paciente d,
                                    san_producao b,
                                    san_transfusao a
                           WHERE         1 = 1
                           and         c.ie_situacao = 'A'
                           AND         a.nr_sequencia = b.nr_seq_transfusao
                           AND         b.nr_seq_derivado = c.nr_sequencia
                           AND         a.nr_atendimento = d.nr_atendimento
                           AND         ie_tipo_atendimento = 8
                           and         b.nr_seq_derivado not in (17,19)
                           AND         a.dt_transfusao BETWEEN dt_inicio_w AND dt_final_w
                           GROUP BY         c.ds_derivado,
                                    b.nr_seq_derivado
                  ) b ON (x.nr_sequencia = b.nr_seq_derivado)
LEFT OUTER JOIN (         SELECT         COUNT(*) qt_entidade,
                                    b.nr_seq_derivado
                           FROM         san_derivado c,
                                    atendimento_paciente d,
                                    san_producao b,
                                    san_transfusao a
                           WHERE         1 = 1
                           and         c.ie_situacao = 'A'
                           AND         a.nr_sequencia = b.nr_seq_transfusao
                           AND         b.nr_seq_derivado = c.nr_sequencia
                           AND         a.nr_atendimento = d.nr_atendimento
                           and         c.ie_situacao = 'A'
                           AND         ie_tipo_atendimento <> 8
                           and         b.nr_seq_derivado not in (17,19)
                           AND         a.dt_transfusao BETWEEN dt_inicio_w AND dt_final_w
                           GROUP BY         c.ds_derivado,
                                    b.nr_seq_derivado
                  ) c ON (x.nr_sequencia = c.nr_seq_derivado)
WHERE 1 = 1 and x.ie_situacao = 'A'   and x.nr_sequencia not in (17,19) and ie_opcao_p in ('P','A') ORDER BY         ds_derivado;

C11 CURSOR FOR
         SELECT	distinct CASE WHEN nr_sequencia=15 THEN 999 WHEN nr_sequencia=16 THEN 999  ELSE nr_sequencia END  ,

                CASE WHEN ds_derivado=OBTER_DESC_EXPRESSAO(728267) THEN OBTER_DESC_EXPRESSAO(728052) WHEN ds_derivado=OBTER_DESC_EXPRESSAO(728269) THEN OBTER_DESC_EXPRESSAO(728052)  ELSE ds_derivado END
         from   san_derivado a
         where  nr_sequencia in (6,3,12,1,4,5,15,16,7)
         and    ie_opcao_p in ('P','A');
	

C12 CURSOR FOR
         SELECT distinct nr_sequencia,
                  ds_tipo_reacao
         from   san_tipo_reacao
         where  nr_sequencia in (43,42,45,47,54,49)
         and         ie_opcao_p in ('R','A')
         order by ds_tipo_reacao;

C13 CURSOR FOR
         SELECT nr_sequencia,
                  ds_derivado
         from   san_derivado
         where  nr_sequencia in (12,3)
         and  ie_opcao_p in ('V','A')
         order by ds_derivado;

C14 CURSOR FOR
         SELECT         a.vl_dominio,
                  a.ds_valor_dominio ds_valor_dominio
         from           valor_dominio a
         where         a.cd_dominio = 1353
         and         a.vl_dominio = 1
         and         ie_opcao_p in ('C','A')
         order by 2;

	
	 

BEGIN

dt_inicio_w          := trunc(dt_inicio_p);
dt_final_w         := trunc(dt_final_p) + 86399/86400;

delete
from         W_HEMOPROD_T;

if (dt_inicio_w IS NOT NULL AND dt_inicio_w::text <> '') and (dt_final_p IS NOT NULL AND dt_final_p::text <> '') and (ie_opcao_p IS NOT NULL AND ie_opcao_p::text <> '') then
         if (ie_opcao_p = 'T') or (ie_opcao_p = 'A') then

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ie_tipo)
         values ('2',

                  OBTER_DESC_EXPRESSAO(300492),
                  'TI');

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo)
         values ('2',

                  OBTER_DESC_EXPRESSAO(728062),
                  '2.1',
                  'S');

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo)
         values ('2',

                  OBTER_DESC_EXPRESSAO(728064),
                  '2.2',
                  'S');

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo)
         values ('2',

                  OBTER_DESC_EXPRESSAO(728066),
                  '2.3',
                  'S');

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo)
         values ('2',

                  OBTER_DESC_EXPRESSAO(728271),
                  '2.4',
                  'S');

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo)
         values ('2',

                  OBTER_DESC_EXPRESSAO(728070),
                  '2.5',
                  'S');

         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  qt_resultado_3,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)



         values (OBTER_DESC_EXPRESSAO(300177),
                  OBTER_DESC_EXPRESSAO(283718),
                  OBTER_DESC_EXPRESSAO(309592),
                  '2.1',
                  '2',
                  'L',
                  3);

         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  qt_resultado_3,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)



         values (OBTER_DESC_EXPRESSAO(300177),
                  OBTER_DESC_EXPRESSAO(283718),
                  OBTER_DESC_EXPRESSAO(309592),
                  '2.2',
                  '2',
                  'L',
                  3);

         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  qt_resultado_3,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)



         values (OBTER_DESC_EXPRESSAO(300177),
                  OBTER_DESC_EXPRESSAO(283718),
                  OBTER_DESC_EXPRESSAO(309592),
                  '2.3',
                  '2',
                  'L',
                  3);

         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  qt_resultado_3,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)



         values (OBTER_DESC_EXPRESSAO(300177),
                  OBTER_DESC_EXPRESSAO(283718),
                  OBTER_DESC_EXPRESSAO(309592),
                  '2.4',
                  '2',
                  'L',
                  3);

         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)


         values (OBTER_DESC_EXPRESSAO(290058),
                  OBTER_DESC_EXPRESSAO(292932),
                  '2.5',
                  '2',
                  'L',
                  2);





         select         sum(qt)
         into STRICT         qt_result1_w
         from (SELECT          count(*) qt
                  from            san_doacao a
                  where          a.dt_doacao between dt_inicio_w and dt_final_w
                  and          a.nr_seq_tipo in (1,4)
                  and             (a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')

union all

                  SELECT          count(*) qt
                  from            san_doacao a
                  where          a.dt_doacao between dt_inicio_w and dt_final_w
                  and          a.nr_seq_tipo in (1,4)
                  and         exists (select  1
                                    from  san_doacao e,
                                        pessoa_fisica b,
                                        san_questionario c,
                                        san_motivo_inaptidao d
                                    where  e.cd_pessoa_fisica = b.cd_pessoa_fisica
                                    and c.nr_seq_doacao = e.nr_sequencia
                                    and d.nr_sequencia = c.nr_seq_motivo_inaptidao
                                    and e.nr_sequencia = a.nr_sequencia
                                    and (c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
                                    and    e.dt_doacao between dt_inicio_w and dt_final_w
                                    and    substr(obter_se_impedimento_hemoprod(e.nr_sequencia, dt_inicio_w, dt_final_w),1,2) = 'S')) alias10;

         select          count(*) qt
         into STRICT          qt_result2_w
         from            san_doacao a
         where          a.dt_doacao between dt_inicio_w and dt_final_w
         and          a.nr_seq_tipo in (1,4)
         and             (a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '');


         select          count(*) qt
         into STRICT          qt_result3_w
         from            san_doacao a
         where          a.dt_doacao between dt_inicio_w and dt_final_w
         and          a.nr_seq_tipo in (1,4)
         and         exists (SELECT  1
                           from  san_doacao e,
                               pessoa_fisica b,
                               san_questionario c,
                               san_motivo_inaptidao d
                           where  e.cd_pessoa_fisica = b.cd_pessoa_fisica
                           and c.nr_seq_doacao = e.nr_sequencia
                           and d.nr_sequencia = c.nr_seq_motivo_inaptidao
                           and e.nr_sequencia = a.nr_sequencia
                           and (c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
                           and    e.dt_doacao between dt_inicio_w and dt_final_w
                           and    substr(obter_se_impedimento_hemoprod(e.nr_sequencia, dt_inicio_w, dt_final_w),1,2) = 'S');

         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  qt_resultado_3,
                  ds_banda_superior,
                  qt_coluna,
                  ie_tipo,
                  ds_resultado,
                  ie_tipo_informacao)
         values (qt_result1_w,
                  qt_result2_w,
                  qt_result3_w,
                  '2.1',
                  3,
                  'R',

                  OBTER_DESC_EXPRESSAO(487501),
                  '2');

         select         sum(qt)
         into STRICT         qt_result1_w
         from (SELECT          count(*) qt
                  from            san_doacao a
                  where          a.dt_doacao between dt_inicio_w and dt_final_w
                  and          a.nr_seq_tipo in (2,3,5,7)
                  and             (a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')

union all

                  SELECT          count(*) qt
                  from            san_doacao a
                  where          a.dt_doacao between dt_inicio_w and dt_final_w
                  and          a.nr_seq_tipo in (2,3,5,7)
                  and         exists (select  1
                                    from  san_doacao e,
                                        pessoa_fisica b,
                                        san_questionario c,
                                        san_motivo_inaptidao d
                                    where  e.cd_pessoa_fisica = b.cd_pessoa_fisica
                                    and c.nr_seq_doacao = e.nr_sequencia
                                    and d.nr_sequencia = c.nr_seq_motivo_inaptidao
                                    and e.nr_sequencia = a.nr_sequencia
                                    and (c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
                                    and    e.dt_doacao between dt_inicio_w and dt_final_w
                                    and    substr(obter_se_impedimento_hemoprod(e.nr_sequencia, dt_inicio_w, dt_final_w),1,2) = 'S')) alias10;



         select          count(*) qt
         into STRICT          qt_result2_w
         from            san_doacao a
         where          a.dt_doacao between dt_inicio_w and dt_final_w
         and          a.nr_seq_tipo in (2,3,5,7)
         and             (a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '');



         select          count(*) qt
         into STRICT          qt_result3_w
         from            san_doacao a
         where          a.dt_doacao between dt_inicio_w and dt_final_w
         and          a.nr_seq_tipo in (2,3,5,7)
         and         exists (SELECT  1
                           from  san_doacao e,
                               pessoa_fisica b,
                               san_questionario c,
                               san_motivo_inaptidao d
                           where  e.cd_pessoa_fisica = b.cd_pessoa_fisica
                           and c.nr_seq_doacao = e.nr_sequencia
                           and d.nr_sequencia = c.nr_seq_motivo_inaptidao
                           and e.nr_sequencia = a.nr_sequencia
                           and (c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
                           and    e.dt_doacao between dt_inicio_w and dt_final_w
                           and    substr(obter_se_impedimento_hemoprod(e.nr_sequencia, dt_inicio_w, dt_final_w),1,2) = 'S');

         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  qt_resultado_3,
                  ds_banda_superior,
                  qt_coluna,
                  ie_tipo,
                  ds_resultado,
                  ie_tipo_informacao)
         values (qt_result1_w,
                  qt_result2_w,
                  qt_result3_w,
                  '2.1',
                  3,
                  'R',

                  OBTER_DESC_EXPRESSAO(313245),
                  '2');


         select         sum(qt)
         into STRICT         qt_result1_w
         from (SELECT          count(*) qt
                  from            san_doacao a
                  where          a.dt_doacao between dt_inicio_w and dt_final_w
                  and          a.nr_seq_tipo in (6)
                  and             (a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')

union all

                  SELECT          count(*) qt
                  from            san_doacao a
                  where          a.dt_doacao between dt_inicio_w and dt_final_w
                  and          a.nr_seq_tipo in (6)
                  and         exists (select  1
                                    from  san_doacao e,
                                        pessoa_fisica b,
                                        san_questionario c,
                                        san_motivo_inaptidao d
                                    where  e.cd_pessoa_fisica = b.cd_pessoa_fisica
                                    and c.nr_seq_doacao = e.nr_sequencia
                                    and d.nr_sequencia = c.nr_seq_motivo_inaptidao
                                    and e.nr_sequencia = a.nr_sequencia
                                    and (c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
                                    and    e.dt_doacao between dt_inicio_w and dt_final_w
                                    and    substr(obter_se_impedimento_hemoprod(e.nr_sequencia, dt_inicio_w, dt_final_w),1,2) = 'S')) alias10;



         select          count(*) qt
         into STRICT          qt_result2_w
         from            san_doacao a
         where          a.dt_doacao between dt_inicio_w and dt_final_w
         and          a.nr_seq_tipo in (6)
         and             (a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '');

         select          count(*) qt
         into STRICT          qt_result3_w
         from            san_doacao a
         where          a.dt_doacao between dt_inicio_w and dt_final_w
         and          a.nr_seq_tipo in (6)
         and         exists (SELECT  1
                           from  san_doacao e,
                               pessoa_fisica b,
                               san_questionario c,
                               san_motivo_inaptidao d
                           where  e.cd_pessoa_fisica = b.cd_pessoa_fisica
                           and c.nr_seq_doacao = e.nr_sequencia
                           and d.nr_sequencia = c.nr_seq_motivo_inaptidao
                           and e.nr_sequencia = a.nr_sequencia
                           and (c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
                           and    e.dt_doacao between dt_inicio_w and dt_final_w
                           and    substr(obter_se_impedimento_hemoprod(e.nr_sequencia, dt_inicio_w, dt_final_w),1,2) = 'S');

         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  qt_resultado_3,
                  ds_banda_superior,
                  qt_coluna,
                  ie_tipo,
                  ds_resultado,
                  ie_tipo_informacao)
         values (qt_result1_w,
                  qt_result2_w,
                  qt_result3_w,
                  '2.1',
                  3,
                  'R',

                  OBTER_DESC_EXPRESSAO(728072),
                  '2');

         select         sum(qt)
         into STRICT         qt_result1_w
         from (SELECT          count(*) qt
                  from            san_doacao a
                  where          a.dt_doacao between dt_inicio_w and dt_final_w
                  and             (a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')
                  and         a.nr_seq_tipo <> 8

union all

                  SELECT          count(*) qt
                  from            san_doacao a
                  where          a.dt_doacao between dt_inicio_w and dt_final_w
                  and         a.nr_seq_tipo <> 8
                  and         exists (select  1
                                    from  san_doacao e,
                                        pessoa_fisica b,
                                        san_questionario c,
                                        san_motivo_inaptidao d
                                    where  e.cd_pessoa_fisica = b.cd_pessoa_fisica
                                    and c.nr_seq_doacao = e.nr_sequencia
                                    and d.nr_sequencia = c.nr_seq_motivo_inaptidao
                                    and e.nr_sequencia = a.nr_sequencia
                                    and (c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
                                    and    e.dt_doacao between dt_inicio_w and dt_final_w
                                    and    substr(obter_se_impedimento_hemoprod(e.nr_sequencia, dt_inicio_w, dt_final_w),1,2) = 'S')) alias8;




         select          count(*) qt
         into STRICT          qt_result2_w
         from            san_doacao a
         where          a.dt_doacao between dt_inicio_w and dt_final_w
         and             (a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')
         and         a.nr_seq_tipo <> 8;


         select          count(*) qt
         into STRICT          qt_result3_w
         from            san_doacao a
         where          a.dt_doacao between dt_inicio_w and dt_final_w
         and         a.nr_seq_tipo <> 8
         and         exists (SELECT  1
                           from  san_doacao e,
                               pessoa_fisica b,
                               san_questionario c,
                               san_motivo_inaptidao d
                           where  e.cd_pessoa_fisica = b.cd_pessoa_fisica
                           and c.nr_seq_doacao = e.nr_sequencia
                           and d.nr_sequencia = c.nr_seq_motivo_inaptidao
                           and e.nr_sequencia = a.nr_sequencia
                           and (c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
                           and    e.dt_doacao between dt_inicio_w and dt_final_w
                           and    substr(obter_se_impedimento_hemoprod(e.nr_sequencia, dt_inicio_w, dt_final_w),1,2) = 'S');


         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  qt_resultado_3,
                  ds_banda_superior,
                  qt_coluna,
                  ie_tipo,
                  ds_resultado,
                  ie_tipo_informacao)
         values (qt_result1_w,
                  qt_result2_w,
                  qt_result3_w,
                  '2.1',
                  3,
                  'T',

                  OBTER_DESC_EXPRESSAO(300177),
                  '2');

         qt1_w := 0;
         qt2_w := 0;
         qt3_w := 0;

         open C01;
         loop
         fetch C01 into
                  ie_opcao_w,
                  ds_campo_w;
         EXIT WHEN NOT FOUND; /* apply on C01 */
                  begin

                  select         sum(qt)
                  into STRICT         qt_result1_w
                  from (SELECT          count(*) qt
                           from            san_doacao a
                           where          a.dt_doacao between dt_inicio_w and dt_final_w
                           and          coalesce(a.IE_TIPO_DOADOR,0) = ie_opcao_w
                           and         (a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')
                           and         a.nr_seq_tipo <> 8

union all

                           SELECT         count(*) qt
                           from           san_doacao a
                           where         a.dt_doacao between dt_inicio_w and dt_final_w
                           and         coalesce(a.IE_TIPO_DOADOR,0) = ie_opcao_w
                           and         a.nr_seq_tipo <> 8
                           and         exists (         select  1
                                             from  san_doacao e,
                                                 pessoa_fisica b,
                                                 san_questionario c,
                                                 san_motivo_inaptidao d
                                             where  e.cd_pessoa_fisica = b.cd_pessoa_fisica
                                             and c.nr_seq_doacao = e.nr_sequencia
                                             and d.nr_sequencia = c.nr_seq_motivo_inaptidao
                                             and e.nr_sequencia = a.nr_sequencia
                                             and (c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
                                             and    e.dt_doacao between dt_inicio_w and dt_final_w
                                             and    substr(obter_se_impedimento_hemoprod(e.nr_sequencia, dt_inicio_w, dt_final_w),1,2) = 'S')) alias10;



                  qt1_w := qt_result1_w + qt1_w;


                  select          count(*)
                  into STRICT          qt_result2_w
                  from            san_doacao a
                  where          a.dt_doacao between dt_inicio_w and dt_final_w
                  and          coalesce(a.IE_TIPO_DOADOR,0) = ie_opcao_w
                  and         (a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')
                  and         a.nr_seq_tipo <> 8;

                  qt2_w := qt_result2_w + qt2_w;


                  select         count(*)
                  into STRICT         qt_result3_w
                  from           san_doacao a
                  where         a.dt_doacao between dt_inicio_w and dt_final_w
                  and         coalesce(a.IE_TIPO_DOADOR,0) = ie_opcao_w
                  and         a.nr_seq_tipo <> 8
                  and         exists (SELECT  1
                           from  san_doacao e,
                               pessoa_fisica b,
                               san_questionario c,
                               san_motivo_inaptidao d
                           where  e.cd_pessoa_fisica = b.cd_pessoa_fisica
                           and c.nr_seq_doacao = e.nr_sequencia
                           and d.nr_sequencia = c.nr_seq_motivo_inaptidao
                           and e.nr_sequencia = a.nr_sequencia
                           and (c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
                           and    e.dt_doacao between dt_inicio_w and dt_final_w
                           and    substr(obter_se_impedimento_hemoprod(e.nr_sequencia, dt_inicio_w, dt_final_w),1,2) = 'S');

                  qt3_w := qt_result3_w + qt3_w;

                  insert into W_HEMOPROD_T(qt_resultado_1,
                           qt_resultado_2,
                           qt_resultado_3,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           qt_result2_w,
                           qt_result3_w,
                           '2.2',
                           3,
                           'R',
                           ds_campo_w,
                           '2');

                  end;


         end loop;
         close C01;


         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  qt_resultado_3,
                  ds_banda_superior,
                  qt_coluna,
                  ie_tipo,
                  ds_resultado,
                  ie_tipo_informacao)
         values (qt1_w,
                  qt2_w,
                  qt3_w,
                  '2.2',
                  3,
                  'T',

                  OBTER_DESC_EXPRESSAO(300177),
                  '2');



         qt1_w := 0;
         qt2_w := 0;
         qt3_w := 0;
         open C02;
         loop
         fetch C02 into
                  ie_opcao_w,
                  ds_campo_w;
         EXIT WHEN NOT FOUND; /* apply on C02 */
                  begin

                  select         sum(qt)
                  into STRICT         qt_result1_w
                  from (SELECT         count(*) qt
                           from           pessoa_fisica b,
                                    san_doacao a
                           where         a.cd_pessoa_fisica = b.cd_pessoa_fisica
                           and         a.dt_doacao between dt_inicio_w and dt_final_w
                           and         a.nr_seq_tipo <> 8
                           and         b.ie_sexo = ie_opcao_w
                           and         (a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')

union all

                           SELECT         count(*) qt
                           from           pessoa_fisica b,
                                    san_doacao a
                           where         a.cd_pessoa_fisica = b.cd_pessoa_fisica
                           and         a.dt_doacao between dt_inicio_w and dt_final_w
                           and         a.nr_seq_tipo <> 8
                           and         b.ie_sexo = ie_opcao_w
                           and         exists (select  1
                                    from  san_doacao e,
                                        pessoa_fisica b,
                                        san_questionario c,
                                        san_motivo_inaptidao d
                                    where  e.cd_pessoa_fisica = b.cd_pessoa_fisica
                                    and c.nr_seq_doacao = e.nr_sequencia
                                    and d.nr_sequencia = c.nr_seq_motivo_inaptidao
                                    and e.nr_sequencia = a.nr_sequencia
                                    and (c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
                                    and    e.dt_doacao between dt_inicio_w and dt_final_w
                                    and    substr(obter_se_impedimento_hemoprod(e.nr_sequencia, dt_inicio_w, dt_final_w),1,2) = 'S')) alias8;



                  qt1_w := qt_result1_w + qt1_w;


                  select         count(*) qt
                  into STRICT         qt_result2_w
                  from           pessoa_fisica b,
                           san_doacao a
                  where         a.cd_pessoa_fisica = b.cd_pessoa_fisica
                  and         a.dt_doacao between dt_inicio_w and dt_final_w
                  and         a.nr_seq_tipo <> 8
                  and         b.ie_sexo = ie_opcao_w
                  and         (a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '');

                  qt2_w := qt_result2_w + qt2_w;


                  select         count(*) qt
                  into STRICT         qt_result3_w
                  from           pessoa_fisica b,
                           san_doacao a
                  where         a.cd_pessoa_fisica = b.cd_pessoa_fisica
                  and         a.dt_doacao between dt_inicio_w and dt_final_w
                  and         a.nr_seq_tipo <> 8
                  and         b.ie_sexo = ie_opcao_w
                  and         exists (SELECT  1
                           from  san_doacao e,
                               pessoa_fisica b,
                               san_questionario c,
                               san_motivo_inaptidao d
                           where  e.cd_pessoa_fisica = b.cd_pessoa_fisica
                           and c.nr_seq_doacao = e.nr_sequencia
                           and d.nr_sequencia = c.nr_seq_motivo_inaptidao
                           and e.nr_sequencia = a.nr_sequencia
                           and (c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
                           and    e.dt_doacao between dt_inicio_w and dt_final_w
                           and    substr(obter_se_impedimento_hemoprod(e.nr_sequencia, dt_inicio_w, dt_final_w),1,2) = 'S');

                  qt3_w := qt_result3_w + qt3_w;

                  insert into W_HEMOPROD_T(qt_resultado_1,
                           qt_resultado_2,
                           qt_resultado_3,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           qt_result2_w,
                           qt_result3_w,
                           '2.3',
                           3,
                           'R',
                           ds_campo_w,
                           '2');

                  end;


         end loop;
         close C02;




         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  qt_resultado_3,
                  ds_banda_superior,
                  qt_coluna,
                  ie_tipo,
                  ds_resultado,
                  ie_tipo_informacao)
         values (qt1_w,
                  qt2_w,
                  qt3_w,
                  '2.3',
                  3,
                  'T',

                  OBTER_DESC_EXPRESSAO(300177),
                  '2');




         qt1_w := 0;
         qt2_w := 0;
         qt3_w := 0;

         open C03;
         loop
         fetch C03 into
                  ie_opcao_w,
                  ds_campo_w;
         EXIT WHEN NOT FOUND; /* apply on C03 */
                  begin

                  select         sum(qt)
                  into STRICT         qt_result1_w
                  from         (SELECT          count(*) qt
                           from            pessoa_fisica b,
                                    san_doacao a
                           where          a.cd_pessoa_fisica = b.cd_pessoa_fisica
                           and          a.dt_doacao between dt_inicio_w and dt_final_w
                           and         a.nr_seq_tipo <> 8
                           and         (((ie_opcao_w = 1) and (trunc(((a.dt_doacao-b.dt_nascimento)/365)) < 18)) or
                                    ((ie_opcao_w = 2) and (trunc(((a.dt_doacao-b.dt_nascimento)/365)) between 18 and 29)) or
                                    ((ie_opcao_w = 3) and (trunc(((a.dt_doacao-b.dt_nascimento)/365)) > 29)))
                           and         (a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')

union all

                           SELECT          count(*) qt
                                    from           pessoa_fisica b ,
                                             san_doacao a
                                    where          a.cd_pessoa_fisica = b.cd_pessoa_fisica
                                    and          a.dt_doacao between dt_inicio_w and dt_final_w
				    and         a.nr_seq_tipo <> 8
                                    and         (((ie_opcao_w = 1) and (trunc(((a.dt_doacao-b.dt_nascimento)/365)) < 18)) or
                                             ((ie_opcao_w = 2) and (trunc(((a.dt_doacao-b.dt_nascimento)/365)) between 18 and 29)) or
                                             ((ie_opcao_w = 3) and (trunc(((a.dt_doacao-b.dt_nascimento)/365)) > 29)))
                                    and         exists (select  1
                                             from  san_doacao e,
                                                 pessoa_fisica b,
                                                 san_questionario c,
                                                 san_motivo_inaptidao d
                                             where  e.cd_pessoa_fisica = b.cd_pessoa_fisica
                                             and c.nr_seq_doacao = e.nr_sequencia
                                             and d.nr_sequencia = c.nr_seq_motivo_inaptidao
                                             and e.nr_sequencia = a.nr_sequencia
                                             and (c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
                                             and    e.dt_doacao between dt_inicio_w and dt_final_w
                                             and    substr(obter_se_impedimento_hemoprod(e.nr_sequencia, dt_inicio_w, dt_final_w),1,2) = 'S')) alias46;

                  qt1_w := qt1_w  + qt_result1_w;


                  select          count(*) qt
                  into STRICT          qt_result2_w
                  from            pessoa_fisica b,
                           san_doacao a
                  where          a.cd_pessoa_fisica = b.cd_pessoa_fisica
                  and          a.dt_doacao between dt_inicio_w and dt_final_w
                  and         a.nr_seq_tipo <> 8
                  and         (((ie_opcao_w = 1) and (trunc(((a.dt_doacao-b.dt_nascimento)/365)) < 18)) or
                           ((ie_opcao_w = 2) and (trunc(((a.dt_doacao-b.dt_nascimento)/365)) between 18 and 29)) or
                           ((ie_opcao_w = 3) and (trunc(((a.dt_doacao-b.dt_nascimento)/365)) > 29)))
                  and         (a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '');

                  qt2_w := qt2_w  + qt_result2_w;

                  select          count(*) qt
                  into STRICT         qt_result3_w
                  from           pessoa_fisica b ,
                           san_doacao a
                  where          a.cd_pessoa_fisica = b.cd_pessoa_fisica
		  and         a.nr_seq_tipo <> 8
                  and          a.dt_doacao between dt_inicio_w and dt_final_w
                  and         (((ie_opcao_w = 1) and (trunc(((a.dt_doacao-b.dt_nascimento)/365)) < 18)) or
                           ((ie_opcao_w = 2) and (trunc(((a.dt_doacao-b.dt_nascimento)/365)) between 18 and 29)) or
                           ((ie_opcao_w = 3) and (trunc(((a.dt_doacao-b.dt_nascimento)/365)) > 29)))
                  and         exists (SELECT  1
                           from  san_doacao e,
                               pessoa_fisica b,
                               san_questionario c,
                               san_motivo_inaptidao d
                           where  e.cd_pessoa_fisica = b.cd_pessoa_fisica
                           and c.nr_seq_doacao = e.nr_sequencia
                           and d.nr_sequencia = c.nr_seq_motivo_inaptidao
                           and e.nr_sequencia = a.nr_sequencia
                           and (c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
                           and    e.dt_doacao between dt_inicio_w and dt_final_w
                           and    substr(obter_se_impedimento_hemoprod(e.nr_sequencia, dt_inicio_w, dt_final_w),1,2) = 'S');

                  qt3_w := qt3_w  + qt_result3_w;

                  insert into W_HEMOPROD_T(qt_resultado_1,
                           qt_resultado_2,
                           qt_resultado_3,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           qt_result2_w,
                           qt_result3_w,
                           '2.4',
                           3,
                           'R',
                           ds_campo_w,
                           '2');

                  end;


         end loop;
         close C03;



         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  qt_resultado_3,
                  ds_banda_superior,
                  qt_coluna,
                  ie_tipo,
                  ds_resultado,
                  ie_tipo_informacao)
         values (qt1_w,
                  qt2_w,
                  qt3_w,
                  '2.4',
                  3,
                  'T',

                  OBTER_DESC_EXPRESSAO(300177),
                  '2');

         qt1_w := 0;
         qt2_w := 0;
         qt3_w := 0;

         open C04;
         loop
         fetch C04 into
                  ie_opcao_w,
                  ds_campo_w;
         EXIT WHEN NOT FOUND; /* apply on C04 */
                  begin

	select  count(*) qt
	into STRICT    qt_result1_w
	from    san_doacao a
	where   a.dt_doacao between dt_inicio_w and dt_final_w	
	and     a.nr_seq_tipo <> 8	
	and    exists (SELECT  1
			from 	san_doacao e,
				pessoa_fisica b,
				san_questionario c,
				san_motivo_inaptidao d
			where  	e.cd_pessoa_fisica = b.cd_pessoa_fisica
			and	c.nr_seq_doacao = e.nr_sequencia
			and	d.nr_sequencia = c.nr_seq_motivo_inaptidao
			and 	e.nr_sequencia = a.nr_sequencia
			and	b.ie_sexo = 'F'
			and	c.nr_seq_motivo_inaptidao = ie_opcao_w
			and 	(c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
			and    	e.dt_doacao between dt_inicio_w and dt_final_w
			and    	substr(obter_se_impedimento_hemoprod(e.nr_sequencia, dt_inicio_w, dt_final_w),1,2) = 'S'
			and	d.ds_motivo_inaptidao = (select min(k.ds_motivo_inaptidao) 
						      from    san_questionario j,
							     san_motivo_inaptidao k
						where	     j.nr_seq_motivo_inaptidao = k.nr_sequencia
						and	     j.nr_seq_doacao = e.nr_sequencia
						and 	(j.nr_seq_motivo_inaptidao IS NOT NULL AND j.nr_seq_motivo_inaptidao::text <> '')));
				
				
				

	select  count(*) qt
	into STRICT    qt_result2_w
	from    san_doacao a
	where   a.dt_doacao between dt_inicio_w and dt_final_w	
	and     a.nr_seq_tipo <> 8	 
	and    exists (SELECT  1
			from 	san_doacao e,
				pessoa_fisica b,
				san_questionario c,
				san_motivo_inaptidao d
			where  	e.cd_pessoa_fisica = b.cd_pessoa_fisica
			and	c.nr_seq_doacao = e.nr_sequencia
			and	d.nr_sequencia = c.nr_seq_motivo_inaptidao
			and 	e.nr_sequencia = a.nr_sequencia
			and	b.ie_sexo = 'M'
			and	c.nr_seq_motivo_inaptidao = ie_opcao_w
			and 	(c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
			and    	e.dt_doacao between dt_inicio_w and dt_final_w
			and    	substr(obter_se_impedimento_hemoprod(e.nr_sequencia, dt_inicio_w, dt_final_w),1,2) = 'S'
			and	d.ds_motivo_inaptidao = (select min(k.ds_motivo_inaptidao) 
						      from    san_questionario j,
							     san_motivo_inaptidao k
						where	     j.nr_seq_motivo_inaptidao = k.nr_sequencia
						and	     j.nr_seq_doacao = e.nr_sequencia
						and 	(j.nr_seq_motivo_inaptidao IS NOT NULL AND j.nr_seq_motivo_inaptidao::text <> '')));
				


                  insert into W_HEMOPROD_T(qt_resultado_1,
                           qt_resultado_2,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           qt_result2_w,
                           '2.5',
                           2,
                           'R',
                           ds_campo_w,
                           '2');


                  end;


         end loop;
         close C04;
			
			   
	sELECT         COUNT(*)
         into STRICT         qt_result1_w
         FROM            san_doacao d
         where         d.nr_seq_tipo <> 8
	 AND         d.dt_doacao between dt_inicio_w and dt_final_w         	 
         and         exists (SELECT  1
                           from  san_doacao e,
                               pessoa_fisica b,
                               san_questionario c,
                               san_motivo_inaptidao v
                           where  e.cd_pessoa_fisica = b.cd_pessoa_fisica
                           and c.nr_seq_doacao = e.nr_sequencia
                           and v.nr_sequencia = c.nr_seq_motivo_inaptidao
                           and e.nr_sequencia = d.nr_sequencia
			   and	v.nr_sequencia not in (4,2,14,8,16,3,17,18,147)
			   and	((v.ie_situacao = 'A') or (v.nr_sequencia <> 15))
			   and	b.ie_sexo = 'F'
                           and (c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')			   
                           and    e.dt_doacao between dt_inicio_w and dt_final_w
                           and    substr(obter_se_impedimento_hemoprod(e.nr_sequencia, dt_inicio_w, dt_final_w),1,2) = 'S'
			   and	v.ds_motivo_inaptidao = (select min(k.ds_motivo_inaptidao) 
						      from    san_questionario j,
							     san_motivo_inaptidao k
						where	     j.nr_seq_motivo_inaptidao = k.nr_sequencia
						and	     j.nr_seq_doacao = e.nr_sequencia
						and 	(j.nr_seq_motivo_inaptidao IS NOT NULL AND j.nr_seq_motivo_inaptidao::text <> ''))
						);
			
	
	

			   
			   
	sELECT         COUNT(*)
         into STRICT         qt_result2_w
         FROM            san_doacao d
         where         d.nr_seq_tipo <> 8
	 AND         d.dt_doacao between dt_inicio_w and dt_final_w         	 
         and         exists (SELECT  1
                           from  san_doacao e,
                               pessoa_fisica b,
                               san_questionario c,
                               san_motivo_inaptidao v
                           where  e.cd_pessoa_fisica = b.cd_pessoa_fisica
                           and c.nr_seq_doacao = e.nr_sequencia
                           and v.nr_sequencia = c.nr_seq_motivo_inaptidao
                           and e.nr_sequencia = d.nr_sequencia
			   and	v.nr_sequencia not in (4,2,14,8,16,3,17,18,147)
			   and	((v.ie_situacao = 'A') or (v.nr_sequencia <> 15))
			   and	b.ie_sexo = 'M'
                           and (c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')			   
                           and    e.dt_doacao between dt_inicio_w and dt_final_w
                           and    substr(obter_se_impedimento_hemoprod(e.nr_sequencia, dt_inicio_w, dt_final_w),1,2) = 'S'
			   and	v.ds_motivo_inaptidao = (select min(k.ds_motivo_inaptidao) 
						      from    san_questionario j,
							     san_motivo_inaptidao k
						where	     j.nr_seq_motivo_inaptidao = k.nr_sequencia
						and	     j.nr_seq_doacao = e.nr_sequencia
						and 	(j.nr_seq_motivo_inaptidao IS NOT NULL AND j.nr_seq_motivo_inaptidao::text <> ''))
						);		

         insert into W_HEMOPROD_T(qt_resultado_1,
                           qt_resultado_2,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           qt_result2_w,
                           '2.5',
                           2,
                           'R',

                           OBTER_DESC_EXPRESSAO(295064),
                           '2');


	
	SELECT         COUNT(distinct d.nr_sequencia)
         into STRICT         qt_result1_w
         FROM            san_doacao d   ,
		san_questionario x
         where         d.nr_seq_tipo <> 8
	 and	x.nr_seq_doacao = d.nr_sequencia
	 and	(x.nr_seq_motivo_inaptidao IS NOT NULL AND x.nr_seq_motivo_inaptidao::text <> '')
         AND         d.dt_doacao between dt_inicio_w and dt_final_w         	
         and         exists (SELECT  1
                           from  san_doacao e,
                               pessoa_fisica b,
                               san_questionario c,
                               san_motivo_inaptidao v
                           where  e.cd_pessoa_fisica = b.cd_pessoa_fisica
                           and c.nr_seq_doacao = e.nr_sequencia
                           and v.nr_sequencia = c.nr_seq_motivo_inaptidao
                           and e.nr_sequencia = d.nr_sequencia			   
			   and	((v.ie_situacao = 'A') or (v.nr_sequencia <> 15))
			   and	b.ie_sexo = 'F'
                           and (c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
                           and    e.dt_doacao between dt_inicio_w and dt_final_w
                           and    substr(obter_se_impedimento_hemoprod(e.nr_sequencia, dt_inicio_w, dt_final_w),1,2) = 'S');
			
	


	SELECT         COUNT(distinct d.nr_sequencia)
         into STRICT         qt_result2_w
         FROM            san_doacao d,
			san_questionario x
         where         d.nr_seq_tipo <> 8
	 and		x.nr_seq_doacao = d.nr_sequencia
	 and		(x.nr_seq_motivo_inaptidao IS NOT NULL AND x.nr_seq_motivo_inaptidao::text <> '')
         AND         d.dt_doacao between dt_inicio_w and dt_final_w         	 
         and         exists (SELECT  1
                           from  san_doacao e,
                               pessoa_fisica b,
                               san_questionario c,
                               san_motivo_inaptidao v
                           where  e.cd_pessoa_fisica = b.cd_pessoa_fisica
                           and c.nr_seq_doacao = e.nr_sequencia
                           and v.nr_sequencia = c.nr_seq_motivo_inaptidao
                           and e.nr_sequencia = d.nr_sequencia			   
			  and	((v.ie_situacao = 'A') or (v.nr_sequencia <> 15))
			   and	b.ie_sexo = 'M'
                           and (c.nr_seq_motivo_inaptidao IS NOT NULL AND c.nr_seq_motivo_inaptidao::text <> '')
                           and    e.dt_doacao between dt_inicio_w and dt_final_w
                           and    substr(obter_se_impedimento_hemoprod(e.nr_sequencia, dt_inicio_w, dt_final_w),1,2) = 'S');	

         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  ds_banda_superior,
                  qt_coluna,
                  ie_tipo,
                  ds_resultado,
                  ie_tipo_informacao)
         values (qt_result1_w,
                  qt_result2_w,
                  '2.5',
                  2,
                  'T',

                  OBTER_DESC_EXPRESSAO(300177),
                  '2');

         end if;

         if (ie_opcao_p = 'C') or (ie_opcao_p = 'A') then
         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ie_tipo)
         values ('3',

                  OBTER_DESC_EXPRESSAO(285474),
                  'TI');

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo)
         values ('3',
                  ' ',
                  '3.1',
                  'S');

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo)
         values ('3',

                  OBTER_DESC_EXPRESSAO(728074),
                  '3.2',
                  'S');

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo)
         values ('3',

                  OBTER_DESC_EXPRESSAO(728076),
                  '3.3',
                  'S');

         insert into W_HEMOPROD_T(qt_resultado_1,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)

         values (OBTER_DESC_EXPRESSAO(300177),
                  '3.1',
                  '3',
                  'L',
                  1);

         insert into W_HEMOPROD_T(qt_resultado_1,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)

         values (OBTER_DESC_EXPRESSAO(300177),
                  '3.2',
                  '3',
                  'L',
                  1);

         insert into W_HEMOPROD_T(qt_resultado_1,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)

         values (OBTER_DESC_EXPRESSAO(300177),
                  '3.3',
                  '3',
                  'L',
                  1);

         select         count(*)
         into STRICT         qt_result1_w
         from           san_doacao a
         where         (a.nr_motivo_desistencia IS NOT NULL AND a.nr_motivo_desistencia::text <> '')
         and         a.dt_doacao between dt_inicio_w and dt_final_w;

         insert into W_HEMOPROD_T(qt_resultado_1,
                  ds_banda_superior,
                  qt_coluna,
                  ie_tipo,
                  ds_resultado,
                  ie_tipo_informacao)
         values (qt_result1_w,
                  '3.1',
                  1,
                  'R',

                  OBTER_DESC_EXPRESSAO(728082) ,
                  '3');

         qt1_w := 0;
         qt2_w := 0;
         qt3_w := 0;

         open C05;
         loop
         fetch C05 into
                  ie_opcao_w,
                  ds_campo_w;
         EXIT WHEN NOT FOUND; /* apply on C05 */
                  begin

                  select         count(*)
                  into STRICT         qt_result1_w
                  from         san_doacao a,
                           SAN_DOACAO_REACAO b,
                           san_tipo_reacao c
                  where         a.nr_sequencia = b.nr_seq_doacao
                  and         a.dt_doacao between dt_inicio_w and dt_final_w
                  and         b.nr_seq_reacao = c.nr_sequencia
                  and         c.nr_seq_grupo_reacao = ie_opcao_w;

                  qt1_w := qt_result1_w + qt1_w;

                  insert into W_HEMOPROD_T(qt_resultado_1,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           '3.2',
                           1,
                           'R',
                           ds_campo_w,
                           '3');



                  end;


         end loop;
         close C05;

         insert into W_HEMOPROD_T(qt_resultado_1,
                  ds_banda_superior,
                  qt_coluna,
                  ie_tipo,
                  ds_resultado,
                  ie_tipo_informacao)
         values (qt1_w,
                  '3.2',
                  1,
                  'T',

                  OBTER_DESC_EXPRESSAO(300177),
                  '3');


         open C14;
         loop
         fetch C14 into
                  ie_opcao_w,
                  ds_campo_w;
         EXIT WHEN NOT FOUND; /* apply on C14 */
                  begin

                  select          count(*)
                  into STRICT         qt_result1_w
                  from            san_doacao a
                  where          a.dt_doacao between dt_inicio_w and dt_final_w
                  and         a.ie_tipo_coleta = ie_opcao_w
                  and         (a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')
                  and         a.nr_seq_tipo <> 8;

                  qt1_w := qt_result1_w + qt1_w;

                  insert into W_HEMOPROD_T(qt_resultado_1,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           '3.3',
                           1,
                           'R',
                           ds_campo_w,
                           '3');



                  end;


         end loop;
         close C14;

         select          count(*)
         into STRICT         qt_result1_w
         from            san_doacao a
         where          a.dt_doacao between dt_inicio_w and dt_final_w
         and         a.ie_tipo_coleta in (0,2)
         and         a.nr_seq_tipo <> 8
         and         (dt_coleta IS NOT NULL AND dt_coleta::text <> '');

         insert into W_HEMOPROD_T(qt_resultado_1,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           '3.3',
                           1,
                           'R',

                           OBTER_DESC_EXPRESSAO(298039),
                           '3');


         select          count(*)
         into STRICT         qt_result1_w
         from            san_doacao a
         where          a.dt_doacao between dt_inicio_w and dt_final_w
         and         (a.IE_TIPO_COLETA IS NOT NULL AND a.IE_TIPO_COLETA::text <> '')
         and         (a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')
         and         a.nr_seq_tipo <> 8;



         insert into W_HEMOPROD_T(qt_resultado_1,
                  ds_banda_superior,
                  qt_coluna,
                  ie_tipo,
                  ds_resultado,
                  ie_tipo_informacao)
         values (qt_result1_w,
                  '3.3',
                  1,
                  'T',

                  OBTER_DESC_EXPRESSAO(300177),
                  '3');



         end if;


         if (ie_opcao_p = 'E') or (ie_opcao_p = 'A') then

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ie_tipo)
         values ('4',

                  OBTER_DESC_EXPRESSAO(559812),
                  'TI');


         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo)
         values ('4',

                  OBTER_DESC_EXPRESSAO(728127),
                  '4.1',
                  'S');

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo)
         values ('4',

                  OBTER_DESC_EXPRESSAO(728131),
                  '4.2',
                  'S');

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo)
         values ('4',

                  OBTER_DESC_EXPRESSAO(728273),
                  '4.3',
                  'S');

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo)
         values ('4',

                  OBTER_DESC_EXPRESSAO(728135),
                  '4.4',
                  'S');

         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)


         values (OBTER_DESC_EXPRESSAO(728275),
                  OBTER_DESC_EXPRESSAO(307664),
                  '4.1',
                  '4',
                  'L',
                  2);

         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)


         values (OBTER_DESC_EXPRESSAO(288090),
                  OBTER_DESC_EXPRESSAO(297324),
                  '4.2',
                  '4',
                  'L',
                  2);

         insert into W_HEMOPROD_T(qt_resultado_1,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)

         values (OBTER_DESC_EXPRESSAO(300177),
                  '4.3',
                  '4',
                  'L',
                  1);

         insert into W_HEMOPROD_T(qt_resultado_1,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)

         values (OBTER_DESC_EXPRESSAO(300177),
                  '4.4',
                  '4',
                  'L',
                  1);

	qt1_w := 0;
	qt2_w := 0;	
		
         open C06;
         loop
         fetch C06 into
                  ie_opcao_w,
                  ds_campo_w;
         EXIT WHEN NOT FOUND; /* apply on C06 */
                  begin

                  if (ie_opcao_w < 99999) then
                           select         count(distinct a.nr_sequencia)
                           into STRICT          qt_result1_w
                           from         san_doacao a,
                                    san_exame_lote b,
                                    san_exame_realizado c
                           where         a.nr_sequencia = b.nr_seq_doacao
                           and         b.nr_sequencia = c.nr_seq_exame_lote
                           and         a.dt_doacao between dt_inicio_w and dt_final_w
                           and         (c.ds_resultado IS NOT NULL AND c.ds_resultado::text <> '')
			   and		(a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')
                           and         c.nr_seq_exame = ie_opcao_w;
                  else
                           select         max(qt)
                           into STRICT         qt_result1_w
                           from (SELECT         count(distinct a.nr_sequencia) qt
                                    from         san_doacao a,
                                             san_exame_lote b,
                                             san_exame_realizado c
                                    where         a.nr_sequencia = b.nr_seq_doacao
                                    and         b.nr_sequencia = c.nr_seq_exame_lote
                                    and         a.dt_doacao between dt_inicio_w and dt_final_w
                                    and         (c.ds_resultado IS NOT NULL AND c.ds_resultado::text <> '')
				    and	(a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')
                                    and         c.nr_seq_exame = 1

union

                                    SELECT         count(distinct a.nr_sequencia) qt
                                    from         san_doacao a,
                                             san_exame_lote b,
                                             san_exame_realizado c
                                    where         a.nr_sequencia = b.nr_seq_doacao
                                    and         b.nr_sequencia = c.nr_seq_exame_lote
                                    and         a.dt_doacao between dt_inicio_w and dt_final_w
                                    and         (c.ds_resultado IS NOT NULL AND c.ds_resultado::text <> '')
				    and		(a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')
                                    and         c.nr_seq_exame = 19) alias7;
                  end if;
		qt1_w := qt_result1_w + qt1_w;
		

                  if (ie_opcao_w < 99999) then
                           select         count(distinct a.nr_sequencia)
                           into STRICT         qt_result2_w
                           from         san_doacao a,
                                    san_exame_lote b,
                                    san_exame_realizado c
                           where         a.nr_sequencia = b.nr_seq_doacao
                           and         b.nr_sequencia = c.nr_seq_exame_lote
                           and         a.dt_doacao between dt_inicio_w and dt_final_w
			   and		(a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')
                           and         c.nr_seq_exame = ie_opcao_w
                           and         replace(upper(ds_resultado),' ','') in (upper(OBTER_DESC_EXPRESSAO(296109)), UPPER(OBTER_DESC_EXPRESSAO(297256)));
                  else
                           select         max(qt)
                           into STRICT         qt_result2_w
                           from (SELECT         count(distinct a.nr_sequencia)         qt
                                    from         san_doacao a,
                                             san_exame_lote b,
                                             san_exame_realizado c
                                    where         a.nr_sequencia = b.nr_seq_doacao
				    and		(a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')
                                    and         b.nr_sequencia = c.nr_seq_exame_lote
                                    and         a.dt_doacao between dt_inicio_w and dt_final_w
                                    and         c.nr_seq_exame = 1
                                    and         replace(upper(ds_resultado),' ','') in (upper(OBTER_DESC_EXPRESSAO(296109)), UPPER(OBTER_DESC_EXPRESSAO(297256)))

union

                                    SELECT         count(distinct a.nr_sequencia)         qt
                                    from         san_doacao a,
                                             san_exame_lote b,
                                             san_exame_realizado c
                                    where         a.nr_sequencia = b.nr_seq_doacao
				    and		(a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')
                                    and         b.nr_sequencia = c.nr_seq_exame_lote
                                    and         a.dt_doacao between dt_inicio_w and dt_final_w
                                    and         c.nr_seq_exame = 19
                                    and         replace(upper(ds_resultado),' ','') in (upper(OBTER_DESC_EXPRESSAO(296109)), UPPER(OBTER_DESC_EXPRESSAO(297256)))) alias19;
                  end if;

		  qt2_w := qt_result2_w + qt2_w;
		
                  insert into W_HEMOPROD_T(qt_resultado_1,
                           qt_resultado_2,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           qt_result2_w,
                           '4.1',
                           2,
                           'R',
                           ds_campo_w,
                           '4');


                  end;


         end loop;
         close C06;


                           insert into W_HEMOPROD_T(qt_resultado_1,
                                    qt_resultado_2,
                                    ds_banda_superior,
                                    qt_coluna,
                                    ie_tipo,
                                    ds_resultado,
                                    ie_tipo_informacao)
                           values (qt1_w,
                                    qt2_w,
                                    '4.1',
                                    2,
                                    'T',

                                    OBTER_DESC_EXPRESSAO(300177),
                                    '4');

         qt1_w := 0;
         qt2_w := 0;
         qt3_w := 0;

         open C07;
         loop
         fetch C07 into
                  ie_opcao_w;
         EXIT WHEN NOT FOUND; /* apply on C07 */
                  begin

                  select          count(*) ds
                  into STRICT         qt_result1_w
                  from           pessoa_fisica b,
                           san_doacao a
                  where          a.cd_pessoa_fisica = b.cd_pessoa_fisica
                  and         (a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')
                  and         a.nr_seq_tipo <> 8
                  and          b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = ie_opcao_w
                  and          a.dt_doacao between trunc(dt_inicio_w,'dd') and trunc(dt_final_p,'dd') + 86399/86400;

                  qt1_w := qt_result1_w + qt1_w;


                  select          count(*) ds
                  into STRICT         qt_result2_w
                  from          pessoa_fisica b ,
                           san_transfusao a
                  where          a.cd_pessoa_fisica = b.cd_pessoa_fisica
                  and                   a.dt_transfusao between trunc(dt_inicio_w,'dd') and trunc(dt_final_p,'dd') + 86399/86400
                  and                   b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = ie_opcao_w;

                  qt2_w := qt_result2_w + qt2_w;

                  insert into W_HEMOPROD_T(qt_resultado_1,
                           qt_resultado_2,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           qt_result2_w,
                           '4.2',
                           2,
                           'R',
                           ie_opcao_w,
                           '4');


                  end;


         end loop;
         close C07;


         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  ds_banda_superior,
                  qt_coluna,
                  ie_tipo,
                  ds_resultado,
                  ie_tipo_informacao)
         values (qt1_w,
                  qt2_w,
                  '4.2',
                  2,
                  'R',

                  OBTER_DESC_EXPRESSAO(300177),
                  '4');


         select count(*)
         into STRICT         qt_result1_w
         from           san_doacao a,
                  pessoa_fisica b,
                   san_exame_lote c,
                   san_exame_realizado d
         where          a.cd_pessoa_fisica = b.cd_pessoa_fisica
         and                   a.nr_sequencia = c.nr_seq_doacao
         and                   d.nr_seq_exame_lote = c.nr_sequencia
         and                   d.nr_seq_exame = 11
         and         a.ie_avaliacao_final = 'A'
         and                   ((b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A+') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A-') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB+') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB-') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B+') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B-') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O+') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O-'))
         and                   a.dt_doacao between trunc(dt_inicio_w,'dd') and trunc(dt_final_p,'dd') + 86399/86400
         and                   ((upper(d.ds_resultado) = upper(OBTER_DESC_EXPRESSAO(296109))) or (upper(d.ds_resultado) = UPPER(OBTER_DESC_EXPRESSAO(297256))));

                  insert into W_HEMOPROD_T(qt_resultado_1,
                           qt_resultado_2,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           ' - ',
                           '4.2',
                           2,
                           'R',

                           OBTER_DESC_EXPRESSAO(728155),
                           '4');

         select          count(*) qt
         into STRICT         qt_result2_w
         from            san_reserva a,
                   pessoa_fisica b,
                   san_exame_lote c,
                   san_exame_realizado d
         where          a.cd_pessoa_fisica = b.cd_pessoa_fisica
         and                   a.nr_sequencia = c.nr_seq_reserva
         and                   d.nr_seq_exame_lote = c.nr_sequencia
         and                   d.nr_seq_exame = 15
         and                   ((b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A+') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A-') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB+') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB-') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B+') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B-') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O+') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O-'))
         and                   a.dt_reserva between trunc(dt_inicio_w,'dd') and trunc(dt_final_p,'dd') + 86399/86400
         and                   ((upper(d.ds_resultado) = upper(OBTER_DESC_EXPRESSAO(296109))) or (upper(d.ds_resultado) = UPPER(OBTER_DESC_EXPRESSAO(297256))));

         insert into W_HEMOPROD_T(qt_resultado_1,
                           qt_resultado_2,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (' - ',
                           qt_result2_w,
                           '4.2',
                           2,
                           'R',

						   OBTER_DESC_EXPRESSAO(728157),
                           '4');

	 SELECT (SELECT          COUNT(*) qtd_rec
		 FROM      san_reserva a,
			   pessoa_fisica b,
			   san_exame_lote c,
			   san_exame_realizado d
		 WHERE     a.cd_pessoa_fisica = b.cd_pessoa_fisica
		 AND       a.nr_sequencia = c.nr_seq_reserva
		 AND       d.nr_seq_exame_lote = c.nr_sequencia
		 AND       d.nr_seq_exame = 10
		 AND       ((b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A+') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A-') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB+') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB-') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B+') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B-') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O+') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O-'))
		 AND       a.dt_reserva BETWEEN TRUNC(dt_inicio_w,'dd') AND TRUNC(dt_final_p,'dd') + 86399/86400
		 AND       ((UPPER(d.ds_resultado) = upper(OBTER_DESC_EXPRESSAO(296109))) OR (UPPER(d.ds_resultado) = UPPER(OBTER_DESC_EXPRESSAO(297256))))) qtd_rec,
		 (SELECT   COUNT(*) qtd_doa
		   FROM	   san_doacao e,
		   	   pessoa_fisica b,
			   san_exame_lote c,
			   san_exame_realizado d
		 WHERE     e.nr_sequencia = c.nr_seq_doacao
		 AND	   e.cd_pessoa_fisica = b.cd_pessoa_fisica
		 AND       d.nr_seq_exame_lote = c.nr_sequencia
		 AND       d.nr_seq_exame = 10
		 AND       ((b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A+') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A-') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB+') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB-') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B+') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B-') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O+') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O-'))
		 AND       e.dt_doacao BETWEEN TRUNC(dt_inicio_w,'dd') AND TRUNC(dt_final_p,'dd') + 86399/86400
		 AND       ((UPPER(d.ds_resultado) = upper(OBTER_DESC_EXPRESSAO(296109))) OR (UPPER(d.ds_resultado) = UPPER(OBTER_DESC_EXPRESSAO(297256))))) qtd_doa
	 into STRICT	qt_result2_w,
		qt_result1_w
		;
		
         insert into W_HEMOPROD_T(qt_resultado_1,
                           qt_resultado_2,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           qt_result2_w,
                           '4.2',
                           2,
                           'R',

                           OBTER_DESC_EXPRESSAO(612296),
                           '4');

         SELECT          COUNT(*) qt
         into STRICT         qt_result1_w
                  FROM            san_doacao a,
                                     pessoa_fisica b
                  WHERE          a.cd_pessoa_fisica = b.cd_pessoa_fisica
                  AND                   ie_avaliacao_final = 'A'
                  AND                   a.dt_doacao BETWEEN TRUNC(dt_inicio_w,'dd') AND TRUNC(dt_final_p,'dd') + 86399/86400
                  AND                   ((b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O-') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB-')
                  or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A-') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B-'));


         SELECT          COUNT(*) qt
         into STRICT         qt_result2_w
                  FROM            san_reserva a,
                                     pessoa_fisica b
                  WHERE          a.cd_pessoa_fisica = b.cd_pessoa_fisica
                  AND                   a.dt_reserva BETWEEN TRUNC(dt_inicio_w,'dd') AND TRUNC(dt_final_p,'dd') + 86399/86400
                  AND                   ((b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'O-') OR (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'AB-')
                  or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'A-') or (b.ie_tipo_sangue||coalesce(b.ie_fator_rh,'-') = 'B-'));

         insert into W_HEMOPROD_T(qt_resultado_1,
                           qt_resultado_2,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           qt_result2_w,
                           '4.2',
                           2,
                           'R',

                           OBTER_DESC_EXPRESSAO(728165),
                           '4');


         select         count(*)
         into STRICT         qt_result1_w
         from         san_doacao a,
                  san_exame_lote b,
                  san_exame_realizado c
         where         b.nr_seq_doacao = a.nr_sequencia
         and         c.nr_seq_exame_lote = b.nr_sequencia
         and         (a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')
         and         a.nr_seq_tipo <> 8
         and         c.nr_seq_exame = 9
         and         replace(upper(ds_resultado),' ','') in (upper(OBTER_DESC_EXPRESSAO(296109)), UPPER(OBTER_DESC_EXPRESSAO(297256)))
         and          (c.ds_resultado IS NOT NULL AND c.ds_resultado::text <> '')
         and         a.dt_doacao between dt_inicio_w and dt_final_w;

         insert into W_HEMOPROD_T(qt_resultado_1,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           '4.3',
                           1,
                           'R',

                           OBTER_DESC_EXPRESSAO(728167),
                           '4');



         select  count(*)
         into STRICT         qt_result1_w
         from    san_doacao a
         where   a.dt_doacao between dt_inicio_w and dt_final_w
         and         (a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')
         and         a.nr_seq_tipo <> 8;



         insert into W_HEMOPROD_T(qt_resultado_1,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           '4.4',
                           1,
                           'R',

                           OBTER_DESC_EXPRESSAO(728169),
                           '4');



	select                  sum(qt)
                           into STRICT                  qt_result1_w
from (SELECT         count(distinct a.nr_sequencia) qt
                           from         san_doacao a,
                                             san_exame_lote b,
                                             san_exame_realizado c,
                                             san_exame d
                           where         a.nr_sequencia = b.nr_seq_doacao
                           and                  b.nr_sequencia = c.nr_seq_exame_lote
                           and                  c.nr_seq_exame = d.nr_sequencia
                           and                  a.dt_doacao between dt_inicio_w and dt_final_w
                           and                  d.ie_exige_senha = 'S'
			   and		(a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')
                           and                  replace(upper(ds_resultado),' ','') in (upper(OBTER_DESC_EXPRESSAO(296109)), UPPER(OBTER_DESC_EXPRESSAO(297256)))
                           and                  d.nr_sequencia not in (2,4,1,19)
                           and                  d.nr_sequencia not in (5,25,50,9)

union all

                           SELECT         count(distinct a.nr_sequencia)
                           from         san_doacao a,
                                             san_exame_lote b,
                                             san_exame_realizado c,
                                             san_exame d
                           where         a.nr_sequencia = b.nr_seq_doacao
                           and                  b.nr_sequencia = c.nr_seq_exame_lote
                           and                  c.nr_seq_exame = d.nr_sequencia
                           and                  a.dt_doacao between dt_inicio_w and dt_final_w
                           and                  d.ie_exige_senha = 'S'
			   and		(a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')
                           and                  replace(upper(ds_resultado),' ','') in (upper(OBTER_DESC_EXPRESSAO(296109)), UPPER(OBTER_DESC_EXPRESSAO(297256)))
                           and                  d.nr_sequencia not in (50,9)
                           and                  d.nr_sequencia in (2,4)
                           
union all

                           select         count(distinct a.nr_sequencia)
                           from         san_doacao a,
                                             san_exame_lote b,
                                             san_exame_realizado c,
                                             san_exame d
                           where         a.nr_sequencia = b.nr_seq_doacao
                           and                  b.nr_sequencia = c.nr_seq_exame_lote
                           and                  c.nr_seq_exame = d.nr_sequencia
                           and                  a.dt_doacao between dt_inicio_w and dt_final_w
                           and                  d.ie_exige_senha = 'S'
                           and                  replace(upper(ds_resultado),' ','') in (upper(OBTER_DESC_EXPRESSAO(296109)), UPPER(OBTER_DESC_EXPRESSAO(297256)))
                           and                  d.nr_sequencia not in (50,9)
			   and		(a.dt_coleta IS NOT NULL AND a.dt_coleta::text <> '')
                           and                  d.nr_sequencia in (1,19)) alias34;			

         insert into W_HEMOPROD_T(qt_resultado_1,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           '4.4',
                           1,
                           'R',

                           OBTER_DESC_EXPRESSAO(728171),
                           '4');


         end if;

         if (ie_opcao_p = 'D') or (ie_opcao_p = 'A') then

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ie_tipo)
         values ('5',

                  OBTER_DESC_EXPRESSAO(728175),
                  'TI');

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo)
         values ('5',
                  ' ',
                  '5.1',
                  'S');

         insert into W_HEMOPROD_T(qt_resultado_1,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)

         values (OBTER_DESC_EXPRESSAO(300177),
                  '5.1',
                  '5',
                  'L',
                  1);

	select	count(1)
        into STRICT	qt_result1_w
        from 	san_doacao a
	where 	a.ie_auto_exclusao = 'S'
        and    	a.dt_coleta between dt_inicio_w and trunc(dt_final_p) + 86399/86400;

         insert into W_HEMOPROD_T(qt_resultado_1,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           '5.1',
                           1,
                           'R',

                           OBTER_DESC_EXPRESSAO(728177),
                           '5');

         end if;

         if (ie_opcao_p = 'P') or (ie_opcao_p = 'A') then

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ie_tipo)
         values ('6',

                  OBTER_DESC_EXPRESSAO(728181),
                  'TI');

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo)
         values ('6',

                  OBTER_DESC_EXPRESSAO(728185),
                  '6.1',
                  'S');

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo)
         values ('6',

                  OBTER_DESC_EXPRESSAO(310004),
                  '6.2',
                  'S');

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo,
                  ie_quebra)
         values ('6',

                  OBTER_DESC_EXPRESSAO(300409),
                  '6.3',
                  'S',
                  'S');

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo)
         values ('6',

                  OBTER_DESC_EXPRESSAO(728189),
                  '6.4',
                  'S');

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo)
         values ('6',

                  OBTER_DESC_EXPRESSAO(728191),
                  '6.5',
                  'S');


         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo)
         values ('6',
                  ' ',
                  '6.7',
                  'S');

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo)
         values ('6',
                  ' ',
                  '6.6',
                  'S');



         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)


         values (OBTER_DESC_EXPRESSAO(296490),
                  OBTER_DESC_EXPRESSAO(346538),
                  '6.1',
                  '6',
                  'L',
                  2);

         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  qt_resultado_3,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)



         values (OBTER_DESC_EXPRESSAO(297928),
                  OBTER_DESC_EXPRESSAO(331753),
                  OBTER_DESC_EXPRESSAO(295064),
                  '6.2',
                  '6',
                  'L',
                  3);

         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)


         values (OBTER_DESC_EXPRESSAO(487612),
                  OBTER_DESC_EXPRESSAO(291499),
                  '6.3',
                  '6',
                  'L',
                  2);

         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)


         values (OBTER_DESC_EXPRESSAO(728215),
                  OBTER_DESC_EXPRESSAO(728217),
                  '6.4',
                  '6',
                  'L',
                  2);

         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  qt_resultado_3,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)



         values (OBTER_DESC_EXPRESSAO(728219),
                  OBTER_DESC_EXPRESSAO(728221),
                  OBTER_DESC_EXPRESSAO(488624),
                  '6.5',
                  '6',
                  'L',
                  3);

         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)


         values (OBTER_DESC_EXPRESSAO(295967),
                  OBTER_DESC_EXPRESSAO(728223),
                  '6.7',
                  '6',
                  'L',
                  2);

         insert into W_HEMOPROD_T(qt_resultado_1,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)

         values (OBTER_DESC_EXPRESSAO(300177),
                  '6.6',
                  '6',
                  'L',
                  1);




         qt1_w := 0;
         qt2_w := 0;
         qt3_w := 0;

         open C08;
         loop
         fetch C08 into
                  ie_opcao_w,
                  ds_campo_w;
         EXIT WHEN NOT FOUND; /* apply on C08 */
                begin

                if (ie_opcao_w = 9999) then 	
			select	count(*)
			into STRICT	qt_result1_w
			from	san_doacao b
			where	1 = 1
			and	exists (SELECT 1
				       from    san_producao a,
					      san_derivado c
				where	a.nr_seq_doacao		= b.nr_sequencia
				and	a.nr_seq_derivado	= c.nr_sequencia
				and	(a.dt_fim_producao IS NOT NULL AND a.dt_fim_producao::text <> '')
				and	c.nr_sequencia		in (15,16))
			and	b.dt_doacao between dt_inicio_w and dt_final_w;		
		end if;
				

		
		if (ie_opcao_w <> 9999) then
			select	count(*)
			into STRICT	qt_result1_w
			from	san_producao_hemoprod_v x
			where	x.ie_tipo_hemo		= 'P'
			and	x.dt_filtro between dt_inicio_w and dt_final_w
			and	x.nr_seq_derivado	= ie_opcao_w
			and	x.nr_Seq <> 2;
		end if;
		
		
                  qt1_w := qt1_w + qt_result1_w;


		if (ie_opcao_w <> 9999) then
			select	count(*)
			into STRICT	qt_result2_w
			from	san_producao_hemoprod_v x
			where	x.ie_tipo_hemo		= 'R'
			and	x.dt_filtro between dt_inicio_w and dt_final_w
			and	x.nr_seq_derivado	= ie_opcao_w;
		end if;
		
		if (ie_opcao_w = 9999) then
			select	count(*)
			into STRICT	qt_result2_w
			from	san_emprestimo b
			where	1 = 1		
			and	exists (SELECT 1
				       from    san_producao a,
					      san_derivado c
				where	a.nr_seq_emp_ent	= b.nr_sequencia
				and	a.nr_seq_derivado	= c.nr_sequencia							
				and	c.nr_sequencia		in (15,16))
			and	b.dt_emprestimo between dt_inicio_w and dt_final_w;
		
		
		end if;
				
                  qt2_w := qt2_w + qt_result2_w;

                  insert into W_HEMOPROD_T(qt_resultado_1,
                           qt_resultado_2,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           qt_result2_w,
                           '6.1',
                           2,
                           'R',
                           ds_campo_w,
                           '6');


                  end;


         end loop;
         close C08;


         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  ds_banda_superior,
                  qt_coluna,
                  ie_tipo,
                  ds_resultado,
                  ie_tipo_informacao)
         values (qt1_w,
                  qt2_w,
                  '6.1',
                  2,
                  'T',

                  OBTER_DESC_EXPRESSAO(300177),
                  '6');


         qt1_w := 0;
         qt2_w := 0;
         qt3_w := 0;

         open C09;
         loop
         fetch C09 into
                  ie_opcao_w,
                  ds_campo_w;
         EXIT WHEN NOT FOUND; /* apply on C09 */
	 	
	 
        begin
		  
	 if (ie_opcao_w <> 9999)	then
	 
                  select          Count(*)
                  into STRICT         qt_result1_w
                  from            san_inutilizacao a,
                           san_producao b
                  where           a.nr_sequencia = b.nr_seq_inutil
                  and             b.nr_seq_derivado = ie_opcao_w
                  and             a.nr_seq_motivo_inutil not in (33,1)
                  and             a.dt_inutilizacao between dt_inicio_w and dt_final_w;

	elsif (ie_opcao_w = 9999)	then

                  select	Count(distinct b.nr_seq_doacao)
                  into STRICT         	qt_result1_w
                  from          san_inutilizacao a,
				san_producao b
                  where         a.nr_sequencia = b.nr_seq_inutil
		  and		  b.qt_volume > 100
                  and             a.nr_seq_motivo_inutil not in (33,1)
                  and             a.dt_inutilizacao between dt_inicio_w and dt_final_w
		  and	exists (SELECT 1
				       from    san_producao d,
					      san_derivado c
				where	d.nr_sequencia		= b.nr_sequencia
				and	d.nr_seq_derivado	= c.nr_sequencia
				and	c.nr_sequencia		in (15,16));

	end if;
	                  qt1_w := qt1_w + qt_result1_w;

		
	 if (ie_opcao_w <> 9999)	then

                  select Count(*)
                  into STRICT         qt_result2_w
                  from            san_inutilizacao a,
                           san_producao b
                  where           a.nr_sequencia = b.nr_seq_inutil
                  and             b.nr_seq_derivado = ie_opcao_w
                  and             a.nr_seq_motivo_inutil = 33
                  and             a.dt_inutilizacao between dt_inicio_w and dt_final_w;

	  elsif (ie_opcao_w = 9999)	then
	
                  select Count(distinct b.nr_seq_doacao)
                  into STRICT         qt_result2_w
                  from            san_inutilizacao a,
                           san_producao b
                  where           a.nr_sequencia = b.nr_seq_inutil
		  and		  b.qt_volume > 100
                  and             a.nr_seq_motivo_inutil = 33
                  and             a.dt_inutilizacao between dt_inicio_w and dt_final_w
		  and	exists (SELECT 1
				       from    san_producao d,
					      san_derivado c
				where	d.nr_sequencia		= b.nr_sequencia
				and	d.nr_seq_derivado	= c.nr_sequencia
				and	c.nr_sequencia		in (15,16));

	end if;
                  qt2_w := qt2_w + qt_result2_w;
	
	 if (ie_opcao_w <> 9999)	then

                  select Count(*)
                  into STRICT         qt_result3_w
                  from   san_inutilizacao a,
                         san_producao b
                  where  a.nr_sequencia = b.nr_seq_inutil
                  and    b.nr_seq_derivado = ie_opcao_w
                  and    a.nr_seq_motivo_inutil = 1
                  and    a.dt_inutilizacao between dt_inicio_w and dt_final_w;
		
	elsif (ie_opcao_w = 9999)	then

                  select Count(distinct b.nr_seq_doacao)
                  into STRICT         qt_result3_w
                  from   san_inutilizacao a,
                         san_producao b
                  where  a.nr_sequencia = b.nr_seq_inutil
		  and		  b.qt_volume > 100
                  and    a.nr_seq_motivo_inutil = 1
                  and             a.dt_inutilizacao between dt_inicio_w and dt_final_w
		  and	exists (SELECT 1
				       from    san_producao d,
					      san_derivado c
				where	d.nr_sequencia		= b.nr_sequencia
				and	d.nr_seq_derivado	= c.nr_sequencia
				and	c.nr_sequencia		in (15,16));

	end if;

                  qt3_w := qt3_w + qt_result3_w;
	
                  insert into W_HEMOPROD_T(qt_resultado_1,
                           qt_resultado_2,
                           qt_resultado_3,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result2_w,
                           qt_result3_w,
                           qt_result1_w,
                           '6.2',
                           3,
                           'R',
                           ds_campo_w,
                           '6');


                  end;


         end loop;
         close C09;


         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  qt_resultado_3,
                  ds_banda_superior,
                  qt_coluna,
                  ie_tipo,
                  ds_resultado,
                  ie_tipo_informacao)
         values (qt2_w,
                  qt3_w,
                  qt1_w,
                  '6.2',
                  3,
                  'T',

                  OBTER_DESC_EXPRESSAO(300177),
                  '6');


         open C10;
         loop
         fetch C10 into
                  ds_campo_w,
                  qt_result1_w,
                  qt_result2_w;
         EXIT WHEN NOT FOUND; /* apply on C10 */
                  begin

                  insert into W_HEMOPROD_T(qt_resultado_1,
                           qt_resultado_2,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           qt_result2_w,
                           '6.3',
                           2,
                           'R',
                           ds_campo_w,
                           '6');


                  end;
         end loop;
         close C10;



         SELECT         COUNT(*) qt_ambulatorio
         into STRICT         qt_result1_w
         FROM         san_derivado c,
                  atendimento_paciente d,
                  san_producao b,
                  san_transfusao a
         WHERE         1 = 1
         and         c.ie_situacao = 'A'
         AND         a.nr_sequencia = b.nr_seq_transfusao
         AND         b.nr_seq_derivado = c.nr_sequencia
         AND         a.nr_atendimento = d.nr_atendimento
         AND         ie_tipo_atendimento = 8
         AND         a.dt_transfusao BETWEEN TRUNC(dt_inicio_w,'dd') AND (TRUNC(dt_final_p,'dd') + 86399/86400);



         SELECT         COUNT(*) qt_entidade
         into STRICT         qt_result2_w
         FROM         san_derivado c,
                  atendimento_paciente d,
                  san_producao b,
                  san_transfusao a
         WHERE         1 = 1
         and         c.ie_situacao = 'A'
         AND         a.nr_sequencia = b.nr_seq_transfusao
         AND         b.nr_seq_derivado = c.nr_sequencia
         AND         a.nr_atendimento = d.nr_atendimento
         and         c.ie_situacao = 'A'
         AND         ie_tipo_atendimento <> 8
         AND         a.dt_transfusao BETWEEN TRUNC(dt_inicio_w,'dd') AND (TRUNC(dt_final_p,'dd') + 86399/86400);

         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  ds_banda_superior,
                  qt_coluna,
                  ie_tipo,
                  ds_resultado,
                  ie_tipo_informacao)
         values (qt_result1_w,
                  qt_result2_w,
                  '6.3',
                  2,
                  'T',

                  OBTER_DESC_EXPRESSAO(300177),
                  '6');


         qt1_w := 0;
         qt2_w := 0;
         qt3_w := 0;

         open C11;
         loop
         fetch C11 into
                  ie_opcao_w,
                  ds_campo_w;
         EXIT WHEN NOT FOUND; /* apply on C11 */
                  begin
		
		select	count(*)
		into STRICT	qt_result1_w
		from	san_emprestimo a,
			san_producao b
		where	ie_entrada_saida = 'S'
		and	a.nr_seq_entidade not in (51, 81)
		and	b.nr_seq_emp_saida = a.nr_sequencia
		and	(a.dt_fechamento IS NOT NULL AND a.dt_fechamento::text <> '')
		and	((b.nr_seq_derivado = ie_opcao_w and b.nr_seq_derivado not in (15,16)) or (ie_opcao_w = 999 and b.nr_seq_derivado in (15,16)))
		and	a.dt_emprestimo between dt_inicio_w and trunc(dt_final_p) + 86399/86400;

                  qt1_w := qt1_w + qt_result1_w;


                  insert into W_HEMOPROD_T(qt_resultado_1,
                           qt_resultado_2,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           '0',
                           '6.4',
                           2,
                           'R',
                           ds_campo_w,
                           '6');



                  end;


         end loop;
         close C11;


         insert into W_HEMOPROD_T(qt_resultado_1,
                  qt_resultado_2,
                  ds_banda_superior,
                  qt_coluna,
                  ie_tipo,
                  ds_resultado,
                  ie_tipo_informacao)
         values (qt1_w,
                  '0',
                  '6.4',
                  2,
                  'T',

                  OBTER_DESC_EXPRESSAO(300177),
                  '6');



         SELECT          COUNT(nr_seq_derivado)
         into STRICT         qt_result1_w
         FROM         san_producao a
         WHERE         a.dt_producao between dt_inicio_w and dt_final_p
         AND          a.ie_filtrado = 'S';


         SELECT COUNT(c.nr_seq_derivado)
	 into STRICT	qt_result2_w
	 FROM	san_envio_derivado a,
		san_envio_derivado_val b,
		san_producao c,
		san_doacao d
	 WHERE	a.nr_sequencia		= b.nr_seq_envio
	 AND	b.nr_seq_producao	= c.nr_sequencia
	 AND	c.nr_seq_doacao	= d.nr_sequencia
	 AND	a.dt_processo BETWEEN dt_inicio_w and dt_final_p;


         SELECT COUNT(nr_seq_derivado)
         into STRICT         qt_result3_w
         FROM san_producao
         WHERE dt_producao between dt_inicio_w and dt_final_p
         AND ie_lavado = 'S';

         insert into W_HEMOPROD_T(qt_resultado_1,
                           qt_resultado_2,
                           qt_resultado_3,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result2_w,
                           qt_result3_w,
                           qt_result1_w,
                           '6.5',
                           2,
                           'R',

                           OBTER_DESC_EXPRESSAO(300177),
                           '6');



         SELECT COUNT(nr_seq_derivado)
         into STRICT qt_result1_w
         FROM san_producao a,
              san_derivado b
         WHERE dt_producao between dt_inicio_w and dt_final_p
         and   a.nr_Seq_derivado = b.nr_sequencia
         AND ie_filtrado = 'S'
         and  coalesce(b.ie_tipo_derivado,b.ie_tipo_hemocomponente) = 'CP';


         SELECT COUNT(nr_seq_derivado)
         into STRICT         qt_result2_w
         FROM san_producao a
         WHERE dt_producao between dt_inicio_w and dt_final_p
	 and	a.ie_filtrado = 'S'
         and a.nr_seq_derivado = 1;

         insert into W_HEMOPROD_T(qt_resultado_1,
                           qt_resultado_2,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           qt_result2_w,
                           '6.7',
                           2,
                           'R',

                           OBTER_DESC_EXPRESSAO(488624),
                           '6');


         select         count(*)
         into STRICT         qt_result1_w
         from          san_producao a
         where         ie_aliquotado = 'S'
         and          dt_producao between dt_inicio_w and dt_final_w;

         insert into W_HEMOPROD_T(qt_resultado_1,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           '6.6',
                           1,
                           'R',

                           OBTER_DESC_EXPRESSAO(728225),
                           '6');




         end if;

         if (ie_opcao_p = 'R') or (ie_opcao_p = 'A') then

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ie_tipo)
         values ('7',

                  OBTER_DESC_EXPRESSAO(728227),
                  'TI');

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo)
         values ('7',
                  ' ',
                  '7.1',
                  'S');

         insert into W_HEMOPROD_T(qt_resultado_1,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)

         values (OBTER_DESC_EXPRESSAO(300177),
                  '7.1',
                  '7',
                  'L',
                  1);

         qt1_w := 0;
         qt2_w := 0;
         qt3_w := 0;

         open C12;
         loop
         fetch C12 into
                  ie_opcao_w,
                  ds_campo_w;
         EXIT WHEN NOT FOUND; /* apply on C12 */
                  begin

                  select count(*)
                  into STRICT         qt_result1_w
                  from   SAN_TRANS_REACAO a,
                         san_producao b,
                         san_transfusao c
                  where  a.nr_seq_producao = b.nr_sequencia
                  and    b.nr_seq_transfusao = c.nr_sequencia
                  and    a.nr_seq_reacao = ie_opcao_w
                  and    c.dt_transfusao between dt_inicio_w and dt_final_w;

                  qt1_w := qt_result1_w + qt1_w;

                  insert into W_HEMOPROD_T(qt_resultado_1,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           '7.1',
                           1,
                           'R',
                           ds_campo_w,
                           '7');

                  end;


         end loop;
         close C12;



         insert into W_HEMOPROD_T(qt_resultado_1,
                  ds_banda_superior,
                  qt_coluna,
                  ie_tipo,
                  ds_resultado,
                  ie_tipo_informacao)
         values (qt1_w,
                  '7.1',
                  1,
                  'R',

                  OBTER_DESC_EXPRESSAO(300177),
                  '7');


         end if;

         if (ie_opcao_p = 'V') or (ie_opcao_p = 'A') then
         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ie_tipo)
         values ('8',

                  OBTER_DESC_EXPRESSAO(728229),
                  'TI');

         insert into W_HEMOPROD_T(ie_tipo_informacao,
                  ds_resultado,
                  ds_banda_superior,
                  ie_tipo)
         values ('8',
                  ' ',
                  '8.1',
                  'S');

         insert into W_HEMOPROD_T(qt_resultado_1,
                  ds_banda_superior,
                  ie_tipo_informacao,
                  ie_tipo,
                  qt_coluna)

         values (OBTER_DESC_EXPRESSAO(300177),
                  '8.1',
                  '8',
                  'L',
                  1);

         open C13;
         loop
         fetch C13 into
                  ie_opcao_w,
                  ds_campo_w;
         EXIT WHEN NOT FOUND; /* apply on C13 */
                  begin

                  select count(*)
                  into STRICT         qt_result1_w
                  from   san_emprestimo a,
                         san_producao b
                  where b.nr_seq_emp_saida = a.nr_sequencia
		  and	a.nr_seq_entidade in (51, 81)
		  and	(a.dt_fechamento IS NOT NULL AND a.dt_fechamento::text <> '')
                  and   b.nr_seq_derivado = ie_opcao_w
                  and         a.dt_emprestimo between dt_inicio_w and dt_final_w;


                  insert into W_HEMOPROD_T(qt_resultado_1,
                           ds_banda_superior,
                           qt_coluna,
                           ie_tipo,
                           ds_resultado,
                           ie_tipo_informacao)
                  values (qt_result1_w,
                           '8.1',
                           1,
                           'R',
                           ds_campo_w,
                           '8');

                  end;


         end loop;
         close C13;

         end if;

end if;



commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE san_hemoprod_rela_tabela_temp ( dt_inicio_p timestamp, dt_final_p timestamp, ie_opcao_p text) FROM PUBLIC;

