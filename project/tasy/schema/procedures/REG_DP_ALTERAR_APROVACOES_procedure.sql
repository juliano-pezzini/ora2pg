-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE reg_dp_alterar_aprovacoes ( nr_sequencia_p bigint, nm_usuario_aprov_p text, ie_tipo_p text, ie_tipo_doc_p text default 'T') AS $body$
BEGIN

	if (ie_tipo_p = 'I') then

		update	reg_caso_teste
		set	dt_aprovacao = clock_timestamp(),
			nm_usuario_aprovacao = nm_usuario_aprov_p
		where	nr_sequencia = nr_sequencia_p;
		
		if (coalesce(ie_tipo_doc_p, 'T') = 'T') then
			reg_test_plan_pck.add_pendency('D', null, null, nm_usuario_aprov_p, nr_sequencia_p);
		end if;
		
		commit;
	elsif (ie_tipo_p = 'E') then

		update	reg_caso_teste
		set	dt_aprovacao  = NULL,
			nm_usuario_aprovacao  = NULL
		where	nr_sequencia = nr_sequencia_p;

		if (coalesce(ie_tipo_doc_p, 'T') = 'T') then
			CALL reg_test_plan_pck.remove_pendencies(
				nm_usuario_p 		=> nm_usuario_aprov_p,
				nr_seq_caso_teste_p 	=> nr_sequencia_p
			);
		end if;
		
		commit;
	end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE reg_dp_alterar_aprovacoes ( nr_sequencia_p bigint, nm_usuario_aprov_p text, ie_tipo_p text, ie_tipo_doc_p text default 'T') FROM PUBLIC;

