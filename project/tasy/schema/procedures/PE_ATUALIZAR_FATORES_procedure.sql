-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pe_atualizar_fatores ( nr_seq_diag_p bigint, nr_seq_fatrel_p bigint DEFAULT NULL, nr_seq_fat_ris_p bigint DEFAULT NULL, nm_usuario_p text DEFAULT NULL, action_p text DEFAULT NULL) AS $body$
DECLARE

  nr_sequence_w bigint;

BEGIN
  IF (nr_seq_fatrel_p IS NOT NULL AND nr_seq_fatrel_p::text <> '') THEN
    IF action_p       = 'I' THEN
      SELECT nextval('pe_prescr_diag_fat_rel_seq') INTO STRICT nr_sequence_w;
      INSERT
      INTO PE_PRESCR_DIAG_FAT_REL(
          nr_sequencia,
          nr_seq_diag,
          nr_seq_fat_rel,
          dt_atualizacao,
          dt_atualizacao_nrec,
          nm_usuario,
          nm_usuario_nrec
        )
        VALUES (
          nr_sequence_w,
          nr_seq_diag_p,
          nr_seq_fatrel_p,
          clock_timestamp(),
          clock_timestamp(),
          nm_usuario_p,
          nm_usuario_p
        );
    ELSE
      DELETE
      FROM PE_PRESCR_DIAG_FAT_REL
      WHERE nr_seq_fat_rel = nr_seq_fatrel_p
      AND nr_seq_diag      = nr_seq_diag_p;
    END IF;
    COMMIT;
  END IF;

  IF (nr_seq_fat_ris_p IS NOT NULL AND nr_seq_fat_ris_p::text <> '') THEN
    IF action_p        = 'I' THEN
      SELECT nextval('pe_prescr_diag_fat_ris_seq') INTO STRICT nr_sequence_w;
      INSERT
      INTO PE_PRESCR_DIAG_FAT_RIS(
          nr_sequencia,
          nr_seq_diag,
          nr_seq_fat_ris,
          dt_atualizacao,
          dt_atualizacao_nrec,
          nm_usuario,
          nm_usuario_nrec
        )
        VALUES (
          nr_sequence_w,
          nr_seq_diag_p,
          nr_seq_fat_ris_p,
          clock_timestamp(),
          clock_timestamp(),
          nm_usuario_p,
          nm_usuario_p
        );
    ELSE
      DELETE
      FROM PE_PRESCR_DIAG_FAT_RIS
      WHERE nr_seq_fat_ris = nr_seq_fat_ris_p
      AND nr_seq_diag      = nr_seq_diag_p;
    END IF;
    COMMIT;
  END IF;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pe_atualizar_fatores ( nr_seq_diag_p bigint, nr_seq_fatrel_p bigint DEFAULT NULL, nr_seq_fat_ris_p bigint DEFAULT NULL, nm_usuario_p text DEFAULT NULL, action_p text DEFAULT NULL) FROM PUBLIC;

