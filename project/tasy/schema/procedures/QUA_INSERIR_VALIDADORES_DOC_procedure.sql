-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE qua_inserir_validadores_doc ( is_doc_validacao text, nm_usuario_p text, nr_seq_rev_p bigint, nr_seq_doc_p bigint) AS $body$
DECLARE


cd_pessoa_vali_w bigint;

c01 CURSOR FOR
SELECT  distinct cd_participante
from    qua_doc_participante
where 	nr_seq_doc = nr_seq_doc_p;



BEGIN
if ('S' != is_doc_validacao)then

open c01;
loop
fetch c01 into	cd_pessoa_vali_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
begin
insert into qua_doc_validacao(
                    nr_sequencia,
                    nr_seq_doc,
                    dt_atualizacao,
                    nm_usuario,
					cd_pessoa_validacao)
	SELECT nextval('qua_doc_validacao_seq'),
					nr_seq_doc_p,
                    clock_timestamp(),
                    nm_usuario_p,
					cd_pessoa_vali_w
					 where not exists (SELECT 1 from qua_doc_validacao
	where 			nr_seq_doc = nr_seq_doc_p
	and				cd_pessoa_validacao = cd_pessoa_vali_w);
end;
end loop;
close c01;
end if;

if ('S' = is_doc_validacao)then
open c01;
loop
fetch c01 into	cd_pessoa_vali_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
begin

insert into qua_doc_revisao_validacao(
                    nr_sequencia,
                    nr_seq_doc_revisao,
                    dt_atualizacao,
                    nm_usuario,
					cd_pessoa_validacao)
	SELECT nextval('qua_doc_revisao_validacao_seq'),
					nr_seq_rev_p,
                    clock_timestamp(),
                    nm_usuario_p,
					cd_pessoa_vali_w
					 where not exists (SELECT 1 from qua_doc_revisao_validacao
	where 			nr_seq_doc_revisao = nr_seq_rev_p
	and 			cd_pessoa_validacao = cd_pessoa_vali_w);
end;
end loop;
close c01;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE qua_inserir_validadores_doc ( is_doc_validacao text, nm_usuario_p text, nr_seq_rev_p bigint, nr_seq_doc_p bigint) FROM PUBLIC;

