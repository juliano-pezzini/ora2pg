-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_proc_princ_sus (NR_ATENDIMENTO_P bigint, NR_INTERNO_CONTA_P bigint, CD_PROCEDIMENTO_P INOUT bigint, IE_POLITRAUMATIZADO_P INOUT text) AS $body$
DECLARE


cd_procedimento_realiz_w	bigint		:= 0;
cd_procedimento_solic_w		bigint		:= 0;
ie_origem_proced_w		bigint;
ie_tipo_laudo_sus_w		integer;
nr_aih_w				bigint		:= 0;
ie_politraumatizado_w		varchar(1)		:= 'N';

C01 CURSOR FOR
SELECT	cd_procedimento_solic,
		ie_origem_proced,
		ie_tipo_laudo_sus,
		coalesce(nr_aih,0)
from 		sus_laudo_paciente
where 	nr_atendimento		= nr_atendimento_p
and		nr_interno_conta		= nr_interno_conta_p
and		ie_tipo_laudo_sus	in (0,1,9)
		order by ie_tipo_laudo_sus,dt_emissao;


BEGIN
cd_procedimento_realiz_w 	:= 0;
ie_politraumatizado_w		:= 'N';
OPEN C01;
LOOP
FETCH C01 	into
		cd_procedimento_solic_w,
		ie_origem_proced_w,
		ie_tipo_laudo_sus_w,
		nr_aih_w;
	EXIT WHEN NOT FOUND; /* apply on c01 */
		begin
		if (ie_tipo_laudo_sus_w in (0,1))	then
			cd_procedimento_realiz_w := cd_procedimento_solic_w;
		end if;
		if (cd_procedimento_solic_w in (39000001, 31000002,70000000,40290000,33000000)) then
			ie_politraumatizado_w	 := 'S';
		end if;
		end;
END LOOP;
CLOSE C01;

CD_PROCEDIMENTO_P		:= cd_procedimento_realiz_w;
ie_politraumatizado_p	:= ie_politraumatizado_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_proc_princ_sus (NR_ATENDIMENTO_P bigint, NR_INTERNO_CONTA_P bigint, CD_PROCEDIMENTO_P INOUT bigint, IE_POLITRAUMATIZADO_P INOUT text) FROM PUBLIC;

