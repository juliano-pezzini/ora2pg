-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ageint_desvinc_medico_grupo ( NR_SEQ_AGENDA_MEDICO_P bigint, NR_SEQ_MEDICO_REGRA_P bigint, CD_AGENDA_P bigint, CD_MEDICO_P text, NM_USUARIO_P text) AS $body$
BEGIN

UPDATE	AGENDA_MEDICO
SET	NR_SEQ_MEDICO_REGRA  = NULL,
	CD_AGENDA = CD_AGENDA_P,
	NM_USUARIO = NM_USUARIO_P,
	DT_ATUALIZACAO = clock_timestamp()
WHERE	NR_SEQUENCIA = NR_SEQ_AGENDA_MEDICO_P;


INSERT	INTO AGEINT_TURNO_MEDICO(	NR_SEQUENCIA,
					DT_ATUALIZACAO,
					NM_USUARIO,
					DT_ATUALIZACAO_NREC,
					NM_USUARIO_NREC,
					CD_PESSOA_FISICA,
					DT_INICIAL_VIGENCIA,
					DT_FINAL_VIGENCIA,
					HR_INICIAL,
					HR_FINAL,
					DT_DIA_SEMANA,
					NR_SEQ_MEDICO_REGRA,
					IE_SITUACAO,
					CD_ESTABELECIMENTO,
					CD_AGENDA,
					IE_FREQUENCIA,
					DS_OBSERVACAO,
					IE_SEMANA)
SELECT	nextval('ageint_turno_medico_seq'),
	clock_timestamp(), --DT_ATUALIZACAO,
	NM_USUARIO_P, --NM_USUARIO,
	clock_timestamp(), --DT_ATUALIZACAO_NREC
	NM_USUARIO_P, --NM_USUARIO_NREC,
	CD_PESSOA_FISICA,
	DT_INICIAL_VIGENCIA,
	DT_FINAL_VIGENCIA,
	HR_INICIAL,
	HR_FINAL,
	DT_DIA_SEMANA,
	NULL, --NR_SEQ_MEDICO_REGRA,
	IE_SITUACAO,
	CD_ESTABELECIMENTO,
	CD_AGENDA,
	IE_FREQUENCIA,
	DS_OBSERVACAO,
	IE_SEMANA
FROM	AGEINT_TURNO_MEDICO
WHERE	CD_PESSOA_FISICA = CD_MEDICO_P
AND	NR_SEQ_MEDICO_REGRA = NR_SEQ_MEDICO_REGRA_P
AND (CD_AGENDA = CD_AGENDA_P OR coalesce(CD_AGENDA::text, '') = '')
AND (CD_ESTABELECIMENTO = WHEB_USUARIO_PCK.GET_CD_ESTABELECIMENTO OR coalesce(CD_ESTABELECIMENTO::text, '') = '');

COMMIT;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ageint_desvinc_medico_grupo ( NR_SEQ_AGENDA_MEDICO_P bigint, NR_SEQ_MEDICO_REGRA_P bigint, CD_AGENDA_P bigint, CD_MEDICO_P text, NM_USUARIO_P text) FROM PUBLIC;

