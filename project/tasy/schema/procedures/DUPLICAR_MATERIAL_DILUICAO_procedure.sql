-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_material_diluicao ( nr_seq_diluicao_p bigint, cd_setor_atendimento_p bigint, cd_setor_excluir_p bigint, nm_usuario_p text) AS $body$
DECLARE



nr_sequencia_diluicao_w		bigint;
nr_seq_interno_w			bigint;


BEGIN

select	coalesce(max(nr_sequencia),0) + 1
into STRICT	nr_sequencia_diluicao_w
from 	material_diluicao;

select	nextval('material_diluicao_seq')
into STRICT	nr_seq_interno_w
;

insert into material_diluicao(
		cd_estabelecimento,
		cd_material,
		nr_sequencia,
		cd_unidade_medida,
		cd_diluente,
		cd_unid_med_diluente,
		dt_atualizacao,
		nm_usuario,
		qt_diluicao,
		qt_minima_diluicao,
		qt_fixa_diluicao,
		qt_minuto_aplicacao,
		ie_reconstituicao,
		ie_via_aplicacao,
		qt_concentracao,
		cd_unid_med_concentracao,
		cd_unid_med_base_concent,
		nr_seq_prioridade,
		cd_intervalo,
		cd_setor_atendimento,
		qt_idade_min,
		qt_idade_min_mes,
		qt_idade_min_dia,
		qt_idade_max,
		qt_idade_max_mes,
		qt_idade_max_dia,
		nr_seq_interno,
		ie_proporcao,
		cd_setor_excluir,
		qt_dose_min,
		qt_dose_max,
		ie_subtrair_volume_medic,
		ie_atualizar_tempo,
		cd_motivo_baixa,
		ds_referencia,
		cd_perfil,
		nr_seq_agrupamento,
		nr_seq_restricao,
		qt_peso_min,
		qt_peso_max,
		qt_referencia,
		qt_volume_adic,
		ie_cobra_paciente,
		cd_unid_med_reconst,
		ie_priorizar_min,
		ie_gerar_lote,
		ie_diluir_inteiro,
		qt_concentracao_total,
		cd_unid_med_concetracao,
		cd_unid_med_base_conc,
		ie_via_excluir,
		nr_seq_via_acesso)
SELECT	cd_estabelecimento,
		cd_material,
		nr_sequencia_diluicao_w,
		cd_unidade_medida,
		cd_diluente,
		cd_unid_med_diluente,
		clock_timestamp(),
		nm_usuario_p,
		qt_diluicao,
		qt_minima_diluicao,
		qt_fixa_diluicao,
		qt_minuto_aplicacao,
		ie_reconstituicao,
		ie_via_aplicacao,
		qt_concentracao,
		cd_unid_med_concentracao,
		cd_unid_med_base_concent,
		nr_seq_prioridade,
		cd_intervalo,
		coalesce(cd_setor_atendimento_p, cd_setor_atendimento),
		qt_idade_min,
		qt_idade_min_mes,
		qt_idade_min_dia,
		qt_idade_max,
		qt_idade_max_mes,
		qt_idade_max_dia,
		nr_seq_interno_w,
		ie_proporcao,
		coalesce(cd_setor_excluir_p,cd_setor_excluir),
		qt_dose_min,
		qt_dose_max,
		coalesce(ie_subtrair_volume_medic,'N'),
		coalesce(ie_atualizar_tempo,'N'),
		cd_motivo_baixa,
		ds_referencia,
		cd_perfil,
		nr_seq_agrupamento,
		nr_seq_restricao,
		qt_peso_min,
		qt_peso_max,
		qt_referencia,
		qt_volume_adic,
		coalesce(ie_cobra_paciente,'S'),
		cd_unid_med_reconst,
		coalesce(ie_priorizar_min,'N'),
		coalesce(ie_gerar_lote,'S'),
		coalesce(ie_diluir_inteiro,'N'),
		qt_concentracao_total,
		cd_unid_med_concetracao,
		cd_unid_med_base_conc,
		ie_via_excluir,
		nr_seq_via_acesso
from	material_diluicao
where	nr_seq_interno = nr_seq_diluicao_p;

insert into regra_liberacao_diluicao(
		nr_sequencia,
		cd_setor_atendimento,
		cd_setor_excluir,
		dt_atualizacao,
		dt_atualizacao_nrec,
		nm_usuario,
		nm_usuario_nrec,
		nr_seq_diluicao)
SELECT	nextval('regra_liberacao_diluicao_seq'),
		cd_setor_atendimento,
		cd_setor_excluir,
		clock_timestamp(),
		clock_timestamp(),
		nm_usuario_p,
		nm_usuario_p,
		nr_seq_interno_w
from	regra_liberacao_diluicao
where	nr_seq_diluicao = nr_seq_diluicao_p;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_material_diluicao ( nr_seq_diluicao_p bigint, cd_setor_atendimento_p bigint, cd_setor_excluir_p bigint, nm_usuario_p text) FROM PUBLIC;

