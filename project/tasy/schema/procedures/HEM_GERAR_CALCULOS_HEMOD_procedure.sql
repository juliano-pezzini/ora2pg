-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE hem_gerar_calculos_hemod ( nr_seq_hem_calc_p bigint, nm_usuario_p text, ds_mensagem_p INOUT text) AS $body$
DECLARE



ds_erro_w		varchar(255) := '';
ie_avaliacao_w		hem_calc_hemodinamico.ie_avaliacao%type;
ie_calculo_w		hem_calc_hemodinamico.ie_calculo%type;
ie_valvula_w		hem_calc_hemodinamico.ie_valvula%type;


BEGIN
if (coalesce(nr_seq_hem_calc_p, 0) > 0) then

	select	max(ie_avaliacao),
		max(ie_calculo),
		max(ie_valvula)
	into STRICT	ie_avaliacao_w,
		ie_calculo_w,
		ie_valvula_w
	from	hem_calc_hemodinamico
	where	nr_sequencia = nr_seq_hem_calc_p;

	if (ie_avaliacao_w = 'AV') then -- Área valvar
		if (ie_calculo_w = 'F') then
			ds_erro_w := hem_gerar_calculos_av(nr_seq_hem_calc_p, nm_usuario_p, ie_valvula_w, ds_erro_w);
		elsif (ie_calculo_w = 'SG') then
			ds_erro_w := hem_gerar_calculos_area_sganz(nr_seq_hem_calc_p, nm_usuario_p, ds_erro_w);
		end if;

	elsif (ie_avaliacao_w = 'SI')	then -- Shunts intracardíacos
		ds_erro_w := hem_gerar_calculos_shunts(nr_seq_hem_calc_p, nm_usuario_p, ds_erro_w);

	elsif (ie_avaliacao_w = 'F')	then -- Fick
		ds_erro_w := hem_gerar_calculos_fick(nr_seq_hem_calc_p, nm_usuario_p, ds_erro_w);
	end if;

	update 	hem_calc_hemodinamico
	set		dt_calculo_gerado 	= clock_timestamp(),
			nm_usuario_calc_ger = nm_usuario_p
	where 	nr_sequencia = nr_seq_hem_calc_p;

end if;

ds_mensagem_p	:= ds_erro_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE hem_gerar_calculos_hemod ( nr_seq_hem_calc_p bigint, nm_usuario_p text, ds_mensagem_p INOUT text) FROM PUBLIC;

