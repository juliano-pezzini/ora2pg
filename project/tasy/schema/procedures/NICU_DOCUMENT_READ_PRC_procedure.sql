-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE nicu_document_read_prc (NR_SEQ_OBSERVATION_P NICU_DOCUMENT_READ.NR_SEQ_OBSERVATION%TYPE, NM_USUARIO_P NICU_DOCUMENT_READ.NM_USUARIO%TYPE) AS $body$
DECLARE


IE_DOCUMENT_READ_W	varchar(1);

BEGIN
IF (NR_SEQ_OBSERVATION_P IS NOT NULL AND NR_SEQ_OBSERVATION_P::text <> '') AND (NM_USUARIO_P IS NOT NULL AND NM_USUARIO_P::text <> '') THEN
	SELECT	CASE WHEN COUNT(*)=0 THEN 'N'  ELSE 'S' END
	INTO STRICT	IE_DOCUMENT_READ_W
	FROM	NICU_DOCUMENT_READ
	WHERE	NR_SEQ_OBSERVATION = NR_SEQ_OBSERVATION_P
	AND		NM_USER_READ = NM_USUARIO_P;
	
	IF (IE_DOCUMENT_READ_W = 'N') THEN
		INSERT INTO NICU_DOCUMENT_READ(
			NR_SEQUENCIA,
			DT_ATUALIZACAO,         
			NM_USUARIO,             
			DT_ATUALIZACAO_NREC,    
			NM_USUARIO_NREC,        
			NM_USER_READ,           
			DT_READ,                
			NR_SEQ_OBSERVATION     
		) VALUES (
			nextval('nicu_document_read_seq'),
			clock_timestamp(),
			NM_USUARIO_P,
			clock_timestamp(),
			NM_USUARIO_P,
			NM_USUARIO_P,
			clock_timestamp(),
			NR_SEQ_OBSERVATION_P
		);
	END IF;	
END IF;

COMMIT;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE nicu_document_read_prc (NR_SEQ_OBSERVATION_P NICU_DOCUMENT_READ.NR_SEQ_OBSERVATION%TYPE, NM_USUARIO_P NICU_DOCUMENT_READ.NM_USUARIO%TYPE) FROM PUBLIC;

