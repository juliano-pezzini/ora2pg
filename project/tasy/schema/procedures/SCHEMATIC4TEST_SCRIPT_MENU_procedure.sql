-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE schematic4test_script_menu (nr_seq_script_p bigint, ie_tipo text, nm_usuario_p text) AS $body$
DECLARE

NR_SEQ_STEP_W bigint;
QTD_W bigint;
NR_SEQ_SCHEDULE_OLD_W bigint;
NR_SEQ_SCRIPT_W bigint;
QTD_W2 bigint;
QTD_W3 bigint;
QTD_W4 bigint;
QTD_W5 bigint;
NR_SEQ_AGRUPADOR_W bigint;
NR_SEQ_PACKAGE_W bigint;
NR_SEQ_SCHEDULE_W bigint;
CD_CT_ID_W bigint;

--lopp steps
C01 CURSOR FOR
  SELECT NR_SEQUENCIA
    INTO STRICT NR_SEQ_STEP_W 
  FROM SCHEM_TEST_STEP 
  WHERE NR_SEQ_SCRIPT = nr_seq_script_p;

--lopp steps of script
C02 CURSOR FOR
  SELECT NR_SEQUENCIA, NR_SEQ_SCRIPT
    INTO STRICT NR_SEQ_STEP_W, NR_SEQ_SCRIPT_W 
  FROM SCHEM_TEST_STEP 
  WHERE NR_SEQ_SNIPPET = nr_seq_script_p;

--lopp steps of script by snippet
C03 CURSOR FOR
  SELECT NR_SEQUENCIA, NR_SEQ_SCRIPT
    INTO STRICT NR_SEQ_STEP_W, NR_SEQ_SCRIPT_W 
  FROM SCHEM_TEST_STEP 
  WHERE NR_SEQUENCIA = nr_seq_script_p
  OR NR_SEQ_AGRUPADOR = nr_seq_script_p;

--loop schedules
C04 CURSOR FOR
 SELECT sche.NR_SEQUENCIA NR_SEQUENCIA
    INTO STRICT NR_SEQ_SCHEDULE_W
 FROM SCHEM_TEST_PACKAGE_SCHED sched,  SCHEM_TEST_SCHEDULE sche
 WHERE sched.NR_SEQUENCIA = sche.NR_SEQ_PACKAGE 
 AND sched.NR_SEQUENCIA = nr_seq_script_p;


BEGIN
	--procedure that setting right click
	if (ie_tipo <> '83' AND ie_tipo <> '23') then
	INSERT INTO SCHEM_TEST_BEHOLDER(nr_sequencia, nm_usuario, dt_atualizacao, nm_usuario_nrec, dt_atualizacao_nrec, ds_interaction, ds_param_a, ds_param_b)
	VALUES (nextval('schem_test_beholder_seq'), NM_USUARIO_P, clock_timestamp(), 'Robot', clock_timestamp(), 'SCHEMATIC4TEST_SCRIPT_MENU', 'nr_seq_script_p as '||nr_seq_script_p, 'ie_tipo as '||ie_tipo);
	end if;

	if (ie_tipo = '1') then
		UPDATE SCHEM_TEST_SCRIPT SET IE_START = '1' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '2') then
		UPDATE SCHEM_TEST_SCRIPT SET IE_START = '2' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '3') then
		SELECT COUNT(CD_CT_ID) CD_CT_ID
			INTO STRICT CD_CT_ID_W
		FROM SCHEM_TEST_SCRIPT
		WHERE NR_SEQUENCIA = nr_seq_script_p 
		AND (CD_PRS_ID IS NOT NULL AND CD_PRS_ID::text <> '');

		IF (CD_CT_ID_W = 0) THEN
			OPEN C01;
			LOOP
			FETCH C01 INTO
				NR_SEQ_STEP_W;
			EXIT WHEN NOT FOUND; /* apply on C01 */
			BEGIN	
				DELETE FROM SCHEM_TEST_VALUES WHERE NR_SEQ_STEP = NR_SEQ_STEP_W;
				DELETE FROM SCHEM_TEST_STEP WHERE NR_SEQUENCIA = NR_SEQ_STEP_W;
			END;
			END LOOP;
			CLOSE C01;
			DELETE FROM SCHEM_TEST_TEST WHERE NR_SEQ_SCRIPT = nr_seq_script_p;
			DELETE FROM SCHEM_TEST_SCRIPT WHERE NR_SEQUENCIA = nr_seq_script_p;
		END IF;
	end if;

	if (ie_tipo = '4') then
		OPEN C02;
		LOOP
		FETCH C02 INTO
			NR_SEQ_STEP_W, NR_SEQ_SCRIPT_W;
		EXIT WHEN NOT FOUND; /* apply on C02 */
		BEGIN	
			IF (coalesce(NR_SEQ_SCRIPT_W::text, '') = '') THEN
				DELETE FROM SCHEM_TEST_VALUES WHERE NR_SEQ_STEP = NR_SEQ_STEP_W;
				DELETE FROM SCHEM_TEST_STEP WHERE NR_SEQUENCIA = NR_SEQ_STEP_W;
			ELSE
				UPDATE SCHEM_TEST_SCRIPT SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = NM_USUARIO_P WHERE NR_SEQUENCIA IN (SELECT NR_SEQ_SCRIPT FROM SCHEM_TEST_STEP WHERE NR_SEQUENCIA = NR_SEQ_STEP_W GROUP BY NR_SEQ_SCRIPT);
				UPDATE SCHEM_TEST_STEP SET NR_SEQ_SNIPPET  = NULL WHERE NR_SEQUENCIA = NR_SEQ_STEP_W;
			END IF;
		END;
		END LOOP;
		CLOSE C02;
		DELETE FROM SCHEM_TEST_SNIPPET WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '6') then
		UPDATE SCHEM_TEST_SCRIPT SET IE_START = '6' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '7') then
		UPDATE SCHEM_TEST_SCRIPT SET IE_START = '7' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '10') then
		SELECT COUNT(NR_SEQUENCIA)  NR_SEQUENCIA
			INTO STRICT QTD_W4
		FROM SCHEM_TEST_SNIPPET WHERE NR_SEQUENCIA IN (SELECT NR_SEQ_SNIPPET FROM SCHEM_TEST_STEP WHERE NR_SEQUENCIA = nr_seq_script_p GROUP BY NR_SEQ_SNIPPET) AND IE_UPDATE = 0;


		IF (QTD_W4 <> 0) THEN
			UPDATE SCHEM_TEST_SNIPPET SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = NM_USUARIO_P, DT_LAST_UPDATE = clock_timestamp() WHERE NR_SEQUENCIA IN (SELECT NR_SEQ_SNIPPET FROM SCHEM_TEST_STEP WHERE NR_SEQUENCIA = nr_seq_script_p GROUP BY NR_SEQ_SNIPPET);
			DELETE FROM SCHEM_TEST_VALUES WHERE NR_SEQ_STEP = nr_seq_script_p;
			DELETE FROM SCHEM_TEST_STEP WHERE NR_SEQUENCIA = nr_seq_script_p;
		ELSE
			OPEN C03;
			LOOP
			FETCH C03 INTO
				NR_SEQ_STEP_W, NR_SEQ_SCRIPT_W;
			EXIT WHEN NOT FOUND; /* apply on C03 */
			BEGIN	
				IF (NR_SEQ_SCRIPT_W IS NOT NULL AND NR_SEQ_SCRIPT_W::text <> '') THEN
					UPDATE SCHEM_TEST_SCRIPT SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = NM_USUARIO_P WHERE NR_SEQUENCIA IN (SELECT NR_SEQ_SCRIPT FROM SCHEM_TEST_STEP WHERE NR_SEQUENCIA = NR_SEQ_STEP_W GROUP BY NR_SEQ_SCRIPT);
				END IF;

				UPDATE SCHEM_TEST_SNIPPET SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = NM_USUARIO_P, DT_LAST_UPDATE = clock_timestamp() WHERE NR_SEQUENCIA IN (SELECT NR_SEQ_SNIPPET FROM SCHEM_TEST_STEP WHERE NR_SEQUENCIA = NR_SEQ_STEP_W GROUP BY NR_SEQ_SNIPPET);
				DELETE FROM SCHEM_TEST_VALUES WHERE NR_SEQ_STEP = NR_SEQ_STEP_W;
				DELETE FROM SCHEM_TEST_STEP WHERE NR_SEQUENCIA = NR_SEQ_STEP_W;
			END;
			END LOOP;
			CLOSE C03;
		END IF;
	end if;

	if (ie_tipo = '11') then
		UPDATE SCHEM_TEST_SCRIPT SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = NM_USUARIO_P WHERE NR_SEQUENCIA IN (SELECT NR_SEQ_SCRIPT FROM SCHEM_TEST_STEP WHERE NR_SEQUENCIA = nr_seq_script_p GROUP BY NR_SEQ_SCRIPT);
		DELETE FROM SCHEM_TEST_VALUES WHERE NR_SEQ_STEP = nr_seq_script_p;
		DELETE FROM SCHEM_TEST_STEP WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '12') then
		UPDATE SCHEM_TEST_STEP SET IE_JOBS = '2' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '13') then	
		UPDATE SCHEM_TEST_STEP SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = NM_USUARIO_P, IE_SWITCH = '1' WHERE NR_SEQUENCIA = nr_seq_script_p;
		UPDATE SCHEM_TEST_SCRIPT SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = NM_USUARIO_P WHERE NR_SEQUENCIA IN (SELECT NR_SEQ_SCRIPT FROM SCHEM_TEST_STEP WHERE NR_SEQUENCIA = nr_seq_script_p GROUP BY NR_SEQ_SCRIPT);
	end if;

	if (ie_tipo = '14') then
		UPDATE SCHEM_TEST_STEP SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = NM_USUARIO_P, IE_SWITCH = '0' WHERE NR_SEQUENCIA = nr_seq_script_p;
		UPDATE SCHEM_TEST_SCRIPT SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = NM_USUARIO_P WHERE NR_SEQUENCIA IN (SELECT DISTINCT NR_SEQ_SCRIPT FROM SCHEM_TEST_STEP WHERE NR_SEQUENCIA = nr_seq_script_p GROUP BY NR_SEQ_SCRIPT);
	end if;

	if (ie_tipo = '15') then
		SELECT COUNT(NR_SEQUENCIA)  NR_SEQUENCIA
			INTO STRICT QTD_W4
		FROM SCHEM_TEST_SNIPPET WHERE NR_SEQUENCIA IN (SELECT NR_SEQ_SNIPPET FROM SCHEM_TEST_STEP WHERE NR_SEQUENCIA = nr_seq_script_p GROUP BY NR_SEQ_SNIPPET) AND IE_UPDATE = 0;

		IF (QTD_W4 <> 0) THEN
			UPDATE SCHEM_TEST_STEP SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = NM_USUARIO_P, IE_SWITCH = '1' WHERE NR_SEQUENCIA = nr_seq_script_p;
			UPDATE SCHEM_TEST_SNIPPET SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = NM_USUARIO_P, DT_LAST_UPDATE = clock_timestamp() WHERE NR_SEQUENCIA IN (SELECT NR_SEQ_SNIPPET FROM SCHEM_TEST_STEP WHERE NR_SEQUENCIA = nr_seq_script_p GROUP BY NR_SEQ_SNIPPET);
		ELSE
			OPEN C03;
			LOOP
			FETCH C03 INTO
				NR_SEQ_STEP_W, NR_SEQ_SCRIPT_W;
			EXIT WHEN NOT FOUND; /* apply on C03 */
			BEGIN	
				IF (NR_SEQ_SCRIPT_W IS NOT NULL AND NR_SEQ_SCRIPT_W::text <> '') THEN
					UPDATE SCHEM_TEST_SCRIPT SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = NM_USUARIO_P WHERE NR_SEQUENCIA IN (SELECT NR_SEQ_SCRIPT FROM SCHEM_TEST_STEP WHERE NR_SEQUENCIA = NR_SEQ_STEP_W GROUP BY NR_SEQ_SCRIPT);
				END IF;

				UPDATE SCHEM_TEST_STEP SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = NM_USUARIO_P, IE_SWITCH = '1' WHERE NR_SEQUENCIA = NR_SEQ_STEP_W;
				UPDATE SCHEM_TEST_SNIPPET SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = NM_USUARIO_P, DT_LAST_UPDATE = clock_timestamp() WHERE NR_SEQUENCIA IN (SELECT NR_SEQ_SNIPPET FROM SCHEM_TEST_STEP WHERE NR_SEQUENCIA = NR_SEQ_STEP_W GROUP BY NR_SEQ_SNIPPET);
			END;
			END LOOP;
			CLOSE C03;
		END IF;	
	end if;

	if (ie_tipo = '16') then
		SELECT COUNT(NR_SEQUENCIA)  NR_SEQUENCIA
			INTO STRICT QTD_W4
		FROM SCHEM_TEST_SNIPPET WHERE NR_SEQUENCIA IN (SELECT NR_SEQ_SNIPPET FROM SCHEM_TEST_STEP WHERE NR_SEQUENCIA = nr_seq_script_p GROUP BY NR_SEQ_SNIPPET) AND IE_UPDATE = 0;

		IF (QTD_W4 <> 0) THEN
			UPDATE SCHEM_TEST_STEP SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = NM_USUARIO_P, IE_SWITCH = '0' WHERE NR_SEQUENCIA = nr_seq_script_p;
			UPDATE SCHEM_TEST_SNIPPET SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = NM_USUARIO_P, DT_LAST_UPDATE = clock_timestamp() WHERE NR_SEQUENCIA IN (SELECT NR_SEQ_SNIPPET FROM SCHEM_TEST_STEP WHERE NR_SEQUENCIA = nr_seq_script_p GROUP BY NR_SEQ_SNIPPET);
		ELSE
			OPEN C03;
			LOOP
			FETCH C03 INTO
				NR_SEQ_STEP_W, NR_SEQ_SCRIPT_W;
			EXIT WHEN NOT FOUND; /* apply on C03 */
			BEGIN	
				IF (NR_SEQ_SCRIPT_W IS NOT NULL AND NR_SEQ_SCRIPT_W::text <> '') THEN
					UPDATE SCHEM_TEST_SCRIPT SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = NM_USUARIO_P WHERE NR_SEQUENCIA IN (SELECT NR_SEQ_SCRIPT FROM SCHEM_TEST_STEP WHERE NR_SEQUENCIA = NR_SEQ_STEP_W GROUP BY NR_SEQ_SCRIPT);
				END IF;

				UPDATE SCHEM_TEST_STEP SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = NM_USUARIO_P, IE_SWITCH = '0' WHERE NR_SEQUENCIA = NR_SEQ_STEP_W;
				UPDATE SCHEM_TEST_SNIPPET SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = NM_USUARIO_P, DT_LAST_UPDATE = clock_timestamp() WHERE NR_SEQUENCIA IN (SELECT NR_SEQ_SNIPPET FROM SCHEM_TEST_STEP WHERE NR_SEQUENCIA = NR_SEQ_STEP_W GROUP BY NR_SEQ_SNIPPET);
			END;
			END LOOP;
			CLOSE C03;
		END IF;
	end if;

	if (ie_tipo = '21') then
		UPDATE SCHEM_TEST_TEST SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, NM_USER_INACTIVATION  = NULL, DS_INACTIVATION  = NULL, DT_INACTIVATION  = NULL, IE_SWITCH = '1' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '22') then
		UPDATE SCHEM_TEST_TEST SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, NM_USER_INACTIVATION = nm_usuario_p, DS_INACTIVATION  = NULL, DT_INACTIVATION = clock_timestamp(), IE_SWITCH = '0' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '23') then
		UPDATE SCHEM_TEST_TEST SET DS_INACTIVATION = nm_usuario_p WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '31') then
		DELETE FROM SCHEM_TEST_LOG WHERE NR_SEQ_SUITE = nr_seq_script_p;
		DELETE FROM SCHEM_TEST_SCHEDULE_ATTACH WHERE NR_SEQ_SCHEDULE IN (SELECT NR_SEQUENCIA FROM SCHEM_TEST_SCHEDULE WHERE NR_SEQ_SUITE = nr_seq_script_p GROUP BY NR_SEQUENCIA);
		DELETE FROM SCHEM_TEST_SCHEDULE WHERE NR_SEQ_SUITE = nr_seq_script_p;
		DELETE FROM SCHEM_TEST_PACKAGE_ITEM WHERE NR_SEQ_SUITE IN (SELECT NR_SEQUENCIA FROM SCHEM_TEST_SUITE WHERE NR_SEQUENCIA = nr_seq_script_p);
		UPDATE SCHEM_TEST_PACKAGE SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = NM_USUARIO_P WHERE NR_SEQUENCIA IN (SELECT NR_SEQ_SUITE FROM SCHEM_TEST_PACKAGE_ITEM WHERE NR_SEQ_SUITE = nr_seq_script_p);
		DELETE FROM SCHEM_TEST_TEST WHERE NR_SEQ_SUITE = nr_seq_script_p;
		DELETE FROM SCHEM_TEST_SUITE WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '32') then
		UPDATE SCHEM_TEST_SUITE SET IE_JOBS = '2' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '33') then
		UPDATE SCHEM_TEST_SUITE SET IE_JOBS = '3' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '42') then
		SELECT COUNT((regexp_replace(substr(suite.NM_SUITE,1,20), '[^0-9]', ''))::numeric ) NR_SEQ_SCHEDULE_OLD
			INTO STRICT QTD_W
		FROM SCHEM_TEST_SCHEDULE schedule, SCHEM_TEST_SUITE suite 
		WHERE schedule.NR_SEQ_SUITE = suite.NR_SEQUENCIA
		AND schedule.NR_SEQUENCIA = nr_seq_script_p;

		IF (QTD_W <> 0) THEN
			SELECT (regexp_replace(substr(suite.NM_SUITE,1,20), '[^0-9]', ''))::numeric  NR_SEQ_SCHEDULE_OLD
				INTO STRICT NR_SEQ_SCHEDULE_OLD_W
			FROM SCHEM_TEST_SCHEDULE schedule, SCHEM_TEST_SUITE suite
			WHERE schedule.NR_SEQ_SUITE = suite.NR_SEQUENCIA
			AND schedule.NR_SEQUENCIA = nr_seq_script_p;

			CALL SCHEMATIC4TEST_SETSCHEDSTATUS(NR_SEQ_SCHEDULE_OLD_W);
		END IF;

		SELECT COUNT(NR_SEQ_PACKAGE)
			INTO STRICT QTD_W
		FROM SCHEM_TEST_SCHEDULE WHERE NR_SEQUENCIA = nr_seq_script_p
		AND (NR_SEQ_PACKAGE IS NOT NULL AND NR_SEQ_PACKAGE::text <> '');

		IF (QTD_W <> 0) THEN
			SELECT NR_SEQ_PACKAGE 
				INTO STRICT NR_SEQ_PACKAGE_W
			FROM SCHEM_TEST_SCHEDULE WHERE NR_SEQUENCIA = nr_seq_script_p
			AND (NR_SEQ_PACKAGE IS NOT NULL AND NR_SEQ_PACKAGE::text <> '');

			UPDATE SCHEM_TEST_PACKAGE_SCHED SET IE_JOBS = '2', DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p WHERE NR_SEQUENCIA = NR_SEQ_PACKAGE_W;
		END IF;

		CALL SCHEMATIC4TEST_SETSCHEDSTATUS(nr_seq_script_p);

		DELETE FROM SCHEM_TEST_LOG WHERE NR_SEQ_SCHEDULE = nr_seq_script_p;
		DELETE FROM SCHEM_TEST_SCHEDULE_ATTACH WHERE NR_SEQ_SCHEDULE = nr_seq_script_p;
		DELETE FROM SCHEM_TEST_SCHEDULE WHERE NR_SEQUENCIA = nr_seq_script_p;

		SELECT COUNT(NR_SEQ_PACKAGE)
			INTO STRICT QTD_W2
		FROM SCHEM_TEST_SCHEDULE WHERE NR_SEQ_PACKAGE = NR_SEQ_PACKAGE_W;

		SELECT COUNT(NR_SEQUENCIA)
			INTO STRICT QTD_W3
		FROM SCHEM_TEST_PACKAGE_SCHED WHERE NR_SEQUENCIA = NR_SEQ_PACKAGE_W;

		IF (QTD_W2 = 0) AND (QTD_W3 <> 0) THEN
			DELETE FROM SCHEM_TEST_PACKAGE_SCHED WHERE NR_SEQUENCIA = NR_SEQ_PACKAGE_W;
		END IF;
	end if;

	if (ie_tipo = '43') then
		UPDATE SCHEM_TEST_SCHEDULE SET IE_JOBS = '2' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '44') then
		UPDATE SCHEM_TEST_SCHEDULE SET IE_JOBS = '3' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '45') then
		UPDATE SCHEM_TEST_SCHEDULE SET DT_ATUALIZACAO = clock_timestamp(), IE_STATUS = '5', NM_USUARIO = nm_usuario_p WHERE NR_SEQUENCIA = nr_seq_script_p;
		UPDATE SCHEM_TEST_STACK SET IE_MAESTRO = '3', DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = 'Asimov' WHERE NR_SEQ_SCHEDULE = nr_seq_script_p;
	end if;
	
	if (ie_tipo = '46') then
		UPDATE SCHEM_TEST_SCHEDULE SET DT_ATUALIZACAO = clock_timestamp(), IE_STATUS = '4', NM_USUARIO = nm_usuario_p WHERE NR_SEQUENCIA = nr_seq_script_p;
		UPDATE SCHEM_TEST_PACKAGE_SCHED SET IE_STATUS = 4 WHERE IE_STATUS = 3 AND NR_SEQUENCIA IN (SELECT pack.NR_SEQUENCIA FROM SCHEM_TEST_PACKAGE_SCHED pack, SCHEM_TEST_SCHEDULE sched WHERE sched.NR_SEQUENCIA = nr_seq_script_p AND sched.NR_SEQ_PACKAGE = pack.NR_SEQUENCIA);
		UPDATE SCHEM_TEST_PACKAGE_SCHED SET IE_STATUS = 3 WHERE IE_STATUS = 4 AND NR_SEQUENCIA IN (SELECT pack.NR_SEQUENCIA FROM SCHEM_TEST_PACKAGE_SCHED pack, SCHEM_TEST_SCHEDULE sched WHERE sched.NR_SEQUENCIA = nr_seq_script_p AND sched.NR_SEQ_PACKAGE = pack.NR_SEQUENCIA AND sched.IE_STATUS = 3);
	end if;
	
	if (ie_tipo = '47') then
		UPDATE SCHEM_TEST_SCHEDULE SET DT_ATUALIZACAO = clock_timestamp(), IE_STATUS = '3', NM_USUARIO = nm_usuario_p WHERE NR_SEQUENCIA = nr_seq_script_p;
		UPDATE SCHEM_TEST_PACKAGE_SCHED SET IE_STATUS = 3 WHERE IE_STATUS = 4 AND NR_SEQUENCIA IN (SELECT pack.NR_SEQUENCIA FROM SCHEM_TEST_PACKAGE_SCHED pack, SCHEM_TEST_SCHEDULE sched WHERE sched.NR_SEQUENCIA = nr_seq_script_p AND sched.NR_SEQ_PACKAGE = pack.NR_SEQUENCIA);
	end if;

	if (ie_tipo = '51') then
		UPDATE SCHEM_TEST_AUTO_SCHEDULE SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SWITCH = '1' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '52') then
		UPDATE SCHEM_TEST_AUTO_SCHEDULE SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SWITCH = '0' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '61') then
		UPDATE SCHEM_TEST_SWITCH SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SWITCH = '1' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '62') then
		UPDATE SCHEM_TEST_SWITCH SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SWITCH = '0' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '70') then
		UPDATE SCHEM_TEST_URL SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_STATUS = '1' WHERE NR_SEQUENCIA = nr_seq_script_p;
		UPDATE SCHEM_TEST_SNAPSHOT SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_STATUS = '0' WHERE NR_SEQUENCIA = nr_seq_script_p AND IE_STATUS = '1';
	end if;

	if (ie_tipo = '71') then
		UPDATE SCHEM_TEST_URL SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_STATUS = '0' WHERE NR_SEQUENCIA = nr_seq_script_p;
		UPDATE SCHEM_TEST_SNAPSHOT SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_STATUS = '1' WHERE NR_SEQUENCIA = nr_seq_script_p AND IE_STATUS = '0';
	end if;

	if (ie_tipo = '80') then
		UPDATE SCHEM_TEST_SCRIPT SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, NM_USER_INACTIVATION = nm_usuario_p, DS_INACTIVATION  = NULL, DT_INACTIVATION = clock_timestamp(), IE_STATUS = '0' WHERE NR_SEQUENCIA = nr_seq_script_p;
		UPDATE SCHEM_TEST_TEST SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, NM_USER_INACTIVATION = nm_usuario_p, DS_INACTIVATION  = NULL, DT_INACTIVATION = clock_timestamp(), IE_SWITCH = '0' WHERE NR_SEQ_SCRIPT = nr_seq_script_p;
	end if;

	if (ie_tipo = '81') then
		UPDATE SCHEM_TEST_SCRIPT SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, NM_USER_INACTIVATION  = NULL, DS_INACTIVATION  = NULL, DT_INACTIVATION  = NULL, IE_STATUS = '1' WHERE NR_SEQUENCIA = nr_seq_script_p;
		UPDATE SCHEM_TEST_TEST SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, NM_USER_INACTIVATION  = NULL, DS_INACTIVATION  = NULL, DT_INACTIVATION  = NULL, IE_SWITCH = '1' WHERE NR_SEQ_SCRIPT = nr_seq_script_p;
	end if;
	
	if (ie_tipo = '82') then
		SELECT COUNT(TEST2.IE_STATUS) QTD
			INTO STRICT QTD_W
		FROM SCHEM_TEST_MAINTENANCE TEST2
		WHERE TEST2.NR_SEQ_SCRIPT = nr_seq_script_p
		AND TEST2.IE_STATUS NOT IN ('0');

		IF (QTD_W = 0) THEN
			INSERT INTO SCHEM_TEST_MAINTENANCE(NR_SEQUENCIA, DT_ATUALIZACAO, DT_ATUALIZACAO_NREC, NM_USUARIO, NM_USUARIO_NREC, NR_SEQ_SCRIPT, IE_STATUS, IE_PRIORITY, DS_OWNER)
			VALUES (nextval('schem_test_maintenance_seq'), clock_timestamp(), clock_timestamp(), NM_USUARIO_P, NM_USUARIO_P, nr_seq_script_p, '1', '0', NM_USUARIO_P);
		END IF;
	end if;

	if (ie_tipo = '83') then
		UPDATE SCHEM_TEST_SCRIPT SET DS_INACTIVATION = nm_usuario_p WHERE NR_SEQUENCIA = nr_seq_script_p;
		UPDATE SCHEM_TEST_TEST SET DS_INACTIVATION = nm_usuario_p WHERE NR_SEQ_SCRIPT = nr_seq_script_p;
	end if;

	if (ie_tipo = '91') then
		OPEN C04;
		LOOP
		FETCH C04 INTO
			NR_SEQ_SCHEDULE_W;
		EXIT WHEN NOT FOUND; /* apply on C04 */
		BEGIN	
			DELETE FROM SCHEM_TEST_LOG WHERE NR_SEQ_SCHEDULE = NR_SEQ_SCHEDULE_W;
			DELETE FROM SCHEM_TEST_SCHEDULE_ATTACH WHERE NR_SEQ_SCHEDULE  = NR_SEQ_SCHEDULE_W;
			DELETE FROM SCHEM_TEST_SCHEDULE WHERE NR_SEQUENCIA = NR_SEQ_SCHEDULE_W;
		END;
		END LOOP;
		CLOSE C04;

		DELETE FROM SCHEM_TEST_PACKAGE_SCHED WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '100') then
		UPDATE SCHEM_TEST_ACTION SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'A' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '101') then
		UPDATE SCHEM_TEST_ACTION SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'I' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '102') then
		UPDATE SCHEM_TEST_AREA SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'A' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '103') then
		UPDATE SCHEM_TEST_AREA SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'I' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '104') then
		UPDATE SCHEM_TEST_GRID SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'A' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '105') then
		UPDATE SCHEM_TEST_GRID SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'I' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '106') then	
		UPDATE SCHEM_TEST_BROWSER SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'A' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '107') then
		UPDATE SCHEM_TEST_BROWSER SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'I' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '108') then
		UPDATE SCHEM_TEST_PRESET SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'A' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '109') then
		UPDATE SCHEM_TEST_PRESET SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'I' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '110') then
		UPDATE SCHEM_TEST_SERVICE SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'A' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '111') then
		UPDATE SCHEM_TEST_SERVICE SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'I' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '112') then
		UPDATE SCHEM_TEST_URL SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'A' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '113') then
		UPDATE SCHEM_TEST_URL SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'I' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '114') then
		UPDATE SCHEM_TEST_ROBOT SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'A' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '115') then
		UPDATE SCHEM_TEST_ROBOT SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'I' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '116') then
		UPDATE SCHEM_TEST_APP SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'A' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;
	
	if (ie_tipo = '117') then
		UPDATE SCHEM_TEST_APP SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'I' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '130') then
		UPDATE SCHEM_TEST_MAINTENANCE SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, DS_OWNER = nm_usuario_p, IE_STATUS = '2' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '150') then	
		UPDATE SCHEM_TEST_SUITE SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'A' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '151') then
		UPDATE SCHEM_TEST_SUITE SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'I' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '160') then
		UPDATE SCHEM_TEST_NETWORK SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'A' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '161') then
		UPDATE SCHEM_TEST_NETWORK SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'I' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '170') then
		UPDATE SCHEM_TEST_VERSION SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'A' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '171') then
		UPDATE SCHEM_TEST_VERSION SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'I' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '180') then
		UPDATE SCHEM_TEST_CUSTOMER SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'A' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '181') then
		UPDATE SCHEM_TEST_CUSTOMER SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'I' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '190') then
		UPDATE SCHEM_TEST_PACKAGE_SCHED SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, DT_INI_ANALISE = clock_timestamp(), IE_ESTAG_EXEC = '1' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '191') then
		UPDATE SCHEM_TEST_PACKAGE_SCHED SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, DT_FIM_ANALISE = clock_timestamp() WHERE NR_SEQUENCIA = nr_seq_script_p;
		UPDATE SCHEM_TEST_PACKAGE_SCHED SET IE_ESTAG_EXEC = '1' WHERE NR_SEQUENCIA = nr_seq_script_p AND (DT_INI_ANALISE IS NOT NULL AND DT_INI_ANALISE::text <> '');
	end if;

	if (ie_tipo = '192') then
		UPDATE SCHEM_TEST_PACKAGE_SCHED SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, DT_INI_ANALISE  = NULL, IE_ESTAG_EXEC = '0' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '193') then
		UPDATE SCHEM_TEST_PACKAGE_SCHED SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, DT_FIM_ANALISE  = NULL WHERE NR_SEQUENCIA = nr_seq_script_p;
		UPDATE SCHEM_TEST_PACKAGE_SCHED SET IE_ESTAG_EXEC = '1' WHERE NR_SEQUENCIA = nr_seq_script_p AND coalesce(DT_INI_ANALISE::text, '') = '';
	end if;

	if (ie_tipo = '200') then
		UPDATE SCHEM_TEST_PACKAGE_SCHED SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, DT_DOC_INICIO = clock_timestamp(), IE_ESTAG_EXEC = '2' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '201') then
		UPDATE SCHEM_TEST_PACKAGE_SCHED SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, DT_DOC_FIM = clock_timestamp() WHERE NR_SEQUENCIA = nr_seq_script_p;
		UPDATE SCHEM_TEST_PACKAGE_SCHED SET IE_ESTAG_EXEC = '3' WHERE NR_SEQUENCIA = nr_seq_script_p AND (DT_DOC_INICIO IS NOT NULL AND DT_DOC_INICIO::text <> '') AND (DT_DOC_FIM IS NOT NULL AND DT_DOC_FIM::text <> '');
	end if;

	if (ie_tipo = '202') then
		UPDATE SCHEM_TEST_PACKAGE_SCHED SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, DT_DOC_INICIO  = NULL WHERE NR_SEQUENCIA = nr_seq_script_p;
		UPDATE SCHEM_TEST_PACKAGE_SCHED SET IE_ESTAG_EXEC = '1' WHERE NR_SEQUENCIA = nr_seq_script_p AND (DT_FIM_ANALISE IS NOT NULL AND DT_FIM_ANALISE::text <> '');
		UPDATE SCHEM_TEST_PACKAGE_SCHED SET IE_ESTAG_EXEC = '2' WHERE NR_SEQUENCIA = nr_seq_script_p AND coalesce(DT_INI_ANALISE::text, '') = '' AND coalesce(DT_FIM_ANALISE::text, '') = '';
	end if;

	if (ie_tipo = '203') then
		UPDATE SCHEM_TEST_PACKAGE_SCHED SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, DT_DOC_FIM  = NULL WHERE NR_SEQUENCIA = nr_seq_script_p;
		UPDATE SCHEM_TEST_PACKAGE_SCHED SET IE_ESTAG_EXEC = '2' WHERE NR_SEQUENCIA = nr_seq_script_p and (DT_DOC_INICIO IS NOT NULL AND DT_DOC_INICIO::text <> '');
	end if;
	
	if (ie_tipo = '204') then
		UPDATE SCHEM_TEST_PACKAGE_SCHED SET IE_ESTAG_EXEC = '0' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '210') then
		UPDATE SCHEM_TEST_PACKAGE_SCHED SET IE_ESTAG_EXEC = '5', NM_USUARIO = nm_usuario_p, DT_ATUALIZACAO = clock_timestamp() WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '220') then
		UPDATE SCHEM_TEST_PACKAGE SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'A' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;

	if (ie_tipo = '221') then
		UPDATE SCHEM_TEST_PACKAGE SET DT_ATUALIZACAO = clock_timestamp(), NM_USUARIO = nm_usuario_p, IE_SITUACAO = 'I' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;
	
	if (ie_tipo = '230') then
		UPDATE SCHEM_TEST_SNAP_BKP SET DT_ATUALIZACAO_NREC = clock_timestamp(), NM_USUARIO_NREC = nm_usuario_p, IE_SITUACAO = 'I', DS_USER_DELETE = nm_usuario_p, DT_USER_DELETE = clock_timestamp(), IE_JOBS = '1' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;
	
	if (ie_tipo = '231') then
		UPDATE SCHEM_TEST_SNAP_RESTORE SET IE_JOBS = '1' WHERE NR_SEQUENCIA = nr_seq_script_p;
	end if;
	
	commit;
EXCEPTION
WHEN no_data_found THEN
  RAISE NOTICE 'Erro: Data not found';
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE schematic4test_script_menu (nr_seq_script_p bigint, ie_tipo text, nm_usuario_p text) FROM PUBLIC;

