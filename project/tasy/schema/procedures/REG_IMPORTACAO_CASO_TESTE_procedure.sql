-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE reg_importacao_caso_teste (nr_seq_intencao_uso_p bigint, prs_id_p text, nm_usuario_p text, nr_tempo_estimado_p bigint, ie_tipo_execucao_p text, cd_versao_p text, ds_descricao_p text, ds_pre_condicao_p text, cd_ct_id_p INOUT text, nr_seq_test_case_p INOUT bigint) AS $body$
DECLARE


  nr_seq_product_w   reg_product_requirement.nr_sequencia%type;
  nr_seq_test_case_w reg_caso_teste.nr_sequencia%type;
  cd_ct_id_w         reg_caso_teste.cd_ct_id%type;


BEGIN

  select nr_sequencia
    into STRICT nr_seq_product_w
    from reg_product_requirement
   where nr_seq_intencao_uso = nr_seq_intencao_uso_p
     and cd_prs_id = prs_id_p;

  if coalesce(nr_seq_product_w::text, '') = '' then
    CALL wheb_mensagem_pck.exibir_mensagem_abort(240227);
  end if;

  select nextval('reg_caso_teste_seq') into STRICT nr_seq_test_case_w;

  insert into reg_caso_teste(cd_versao,
     ds_descricao,
     ds_pre_condicao,
     dt_aprovacao,
     dt_atualizacao,
     dt_liberacao_vv,
     ie_tipo_documento,
     ie_tipo_execucao,
     nm_usuario,
     nm_usuario_aprovacao,
     nm_usuario_liberacao,
     nm_usuario_nrec,
     nr_seq_intencao_uso,
     nr_seq_product,
     nr_sequencia,
     nr_tempo_estimado)
  values (cd_versao_p,
     ds_descricao_p,
     ds_pre_condicao_p,
     clock_timestamp(),
     clock_timestamp(),
     clock_timestamp(),
     'T',
     ie_tipo_execucao_p,
     nm_usuario_p,
     nm_usuario_p,
     nm_usuario_p,
     nm_usuario_p,
     nr_seq_intencao_uso_p,
     nr_seq_product_w,
     nr_seq_test_case_w,
     nr_tempo_estimado_p);

  commit;

  select cd_ct_id
    into STRICT cd_ct_id_w
    from reg_caso_teste
   where nr_sequencia = nr_seq_test_case_w;

  nr_seq_test_case_p := nr_seq_test_case_w;
  cd_ct_id_p         := cd_ct_id_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE reg_importacao_caso_teste (nr_seq_intencao_uso_p bigint, prs_id_p text, nm_usuario_p text, nr_tempo_estimado_p bigint, ie_tipo_execucao_p text, cd_versao_p text, ds_descricao_p text, ds_pre_condicao_p text, cd_ct_id_p INOUT text, nr_seq_test_case_p INOUT bigint) FROM PUBLIC;

