-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE adicionar_template_automatico (nr_sequencia_p bigint, cd_profissional_p text, nm_usuario_p text) AS $body$
DECLARE


nr_sequencia_w		bigint;
nr_sequencia_reg_w	bigint;
nr_seq_template_w	bigint;
cd_pessoa_fisica_w	bigint;
nr_atendimento_w	bigint;



BEGIN

nr_seq_template_w := obter_param_usuario(874, 40, obter_perfil_ativo, nm_usuario_p, wheb_usuario_pck.get_cd_estabelecimento, nr_seq_template_w);

select  max(nr_atendimento),
		max(cd_pessoa_fisica)
into STRICT	nr_atendimento_w,
		cd_pessoa_fisica_w
from 	aval_pre_anestesica
where	nr_sequencia = nr_sequencia_p;

select  nextval('ehr_registro_seq')
into STRICT	nr_sequencia_w
;

select 	nextval('ehr_reg_template_seq')
into STRICT	nr_sequencia_reg_w
;


insert into  ehr_registro(nr_sequencia,
			cd_profissional,
			dt_liberacao,
			dt_inativacao,
			dt_registro,
			nm_usuario,
			nm_usuario_nrec,
			dt_atualizacao,
			dt_atualizacao_nrec,
			cd_paciente,
			nr_atendimento,
			nr_seq_aval_pre)
values (nr_sequencia_w,
			cd_profissional_p,
			null,
			null,
			clock_timestamp(),
			nm_usuario_p,
			nm_usuario_p,
			clock_timestamp(),
			clock_timestamp(),
			cd_pessoa_fisica_w,
			nr_atendimento_w,
			nr_sequencia_p);

insert into ehr_reg_template(nr_sequencia,
			nr_seq_reg,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			dt_registro,
			nr_seq_item_pep,
			dt_liberacao,
			nr_seq_template)
values (nr_sequencia_reg_w,
			nr_sequencia_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			null,
			null,
			nr_seq_template_w);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE adicionar_template_automatico (nr_sequencia_p bigint, cd_profissional_p text, nm_usuario_p text) FROM PUBLIC;

