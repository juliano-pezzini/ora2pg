-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_w_envio_dirf ( nr_seq_envio_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
 
nr_sequencia_w				bigint;
dt_atualizacao_w			timestamp;
nm_usuario_w				varchar(15);
dt_atualizacao_nrec_w			timestamp;
nm_usuario_nrec_w			varchar(15);
nr_seq_lote_w				bigint;
nr_seq_registro_w			varchar(8);
ie_tipo_registro_w			bigint;
nr_cpf_cnpj_w				varchar(14);
nm_arquivo_w				varchar(4);
dt_ano_w				varchar(4);
ie_tipo_declaracao_w			varchar(1);
ie_situacao_declaracao_w		varchar(3);
ie_tipo_declarante_w			varchar(1);
ie_natureza_declarante_w		varchar(3);
ie_tipo_rendimento_w			varchar(3);
ie_indicador_depositario_w		varchar(3);
nm_declarante_w				varchar(255);
cd_cpf_w				varchar(11);
dt_evento_w				timestamp;
nr_recibo_w				varchar(255);
cd_cpf_responsavel_w			varchar(11);
nm_responsavel_w			varchar(60);
nr_ddd_resp_w				varchar(3);
nr_telefone_resp_w			varchar(50);
nr_ramal_resp_w				varchar(5);
nr_fax_resp_w				varchar(50);
ds_email_resp_w				varchar(255);
ie_uso_declarante_w			smallint;
cd_retencao_w				varchar(10);
ie_tipo_beneficiario_w			varchar(1);
nr_beneficiario_w			varchar(14);
nm_beneficiario_w			varchar(255);
vl_rend_jan_w				double precision;
vl_deducoes_jan_w			double precision;
vl_ir_jan_w				double precision;
vl_rend_fev_w				double precision;
vl_ir_fev_w				double precision;
vl_deducoes_fev_w			double precision;
vl_rend_mar_w				double precision;
vl_deducoes_mar_w			double precision;
vl_ir_mar_w				double precision;
vl_rend_abr_w				double precision;
vl_deducoes_abr_w			double precision;
vl_ir_abr_w				double precision;
vl_rend_mai_w				double precision;
vl_deducoes_mai_w			double precision;
vl_ir_mai_w				double precision;
vl_rend_jun_w				double precision;
vl_deducoes_jun_w			double precision;
vl_ir_jun_w				double precision;
vl_rend_jul_w				double precision;
vl_deducoes_jul_w			double precision;
vl_ir_jul_w				double precision;
vl_rend_ago_w				double precision;
vl_deducoes_ago_w			double precision;
vl_ir_ago_w				double precision;
vl_rend_set_w				double precision;
vl_deducoes_set_w			double precision;
vl_ir_set_w				double precision;
vl_rend_out_w				double precision;
vl_deducoes_out_w			double precision;
vl_ir_out_w				double precision;
vl_rend_nov_w				double precision;
vl_deducoes_nov_w			double precision;
vl_ir_nov_w				double precision;
vl_rend_dez_w				double precision;
vl_deducoes_dez_w			double precision;
vl_ir_dez_w				double precision;
vl_rend_13_salario_w			double precision;
vl_deducoes_13_salario_w		double precision;
vl_ir_13_salario_w			double precision;
ds_srf_w				varchar(2);
ie_situacao_w				smallint;
vl_total_registros_w			bigint;
vl_tot_rend_jan_w			double precision;
vl_tot_deducoes_jan_w			double precision;
vl_tot_ir_jan_w				double precision;
vl_tot_rend_fev_w			double precision;
vl_tot_deducoes_fev_w			double precision;
vl_tot_ir_fev_w				double precision;
vl_tot_rend_mar_w			double precision;
vl_tot_deducoes_mar_w			double precision;
vl_tot_ir_mar_w				double precision;
vl_tot_rend_abr_w			double precision;
vl_tot_deducoes_abr_w          double precision;
vl_tot_ir_abr_w             double precision;
vl_tot_rend_mai_w            double precision;
vl_tot_deducoes_mai_w          double precision;
vl_tot_ir_mai_w             double precision;
vl_tot_rend_jun_w            double precision;
vl_tot_deducoes_jun_w          double precision;
vl_tot_ir_jun_w             double precision;
vl_tot_rend_jul_w            double precision;
vl_tot_deducoes_jul_w          double precision;
vl_tot_ir_jul_w             double precision;
vl_tot_rend_ago_w            double precision;
vl_tot_deducoes_ago_w          double precision;
vl_tot_ir_ago_w             double precision;
vl_tot_rend_set_w            double precision;
vl_tot_deducoes_set_w          double precision;
vl_tot_ir_set_w             double precision;
vl_tot_rend_out_w            double precision;
vl_tot_deducoes_out_w          double precision;
vl_tot_ir_out_w             double precision;
vl_tot_rend_nov_w            double precision;
vl_tot_deducoes_nov_w          double precision;
vl_tot_ir_nov_w             double precision;
vl_tot_rend_dez_w            double precision;
vl_tot_deducoes_dez_w          double precision;
vl_tot_ir_dez_w             double precision;
vl_tot_rend_13_salario_w        double precision;
vl_tot_deducoes_13_salario_w      double precision;
vl_tot_ir_13_salario_w      	double precision;

c01 CURSOR FOR /* CABEÃ‡ALHO */
 
SELECT	/*+ USE_CONCAT   */ a.nr_sequencia nr_seq_lote, 
	'00000001'						nr_seq_registro, 
	1							ie_tipo_registro, 
	b.cd_cgc					 	nr_cpf_cnpj, 
	'DIRF'							nm_arquivo, 
	to_char(a.dt_lote,'yyyy')				dt_ano, 
	a.ie_retificadora					ie_tipo_declaracao, 
	a.ie_situacao_declaracao				ie_situacao_declaracao, 
	'2'							ie_tipo_declarante, 
	a.ie_natureza_declarante				ie_natureza_declarante, 
	a.ie_tipo_rendimento					ie_tipo_rendimento, 
	a.ie_declarante_depositario				ie_indicador_depositario, 
	substr(obter_nome_empresa(b.cd_empresa),1,255) 	nm_declarante, 
	substr(obter_dados_pf(c.cd_contabilista,'CPF'),1,11)	cd_cpf, 
	CASE WHEN a.ie_situacao_declaracao=2 THEN clock_timestamp()  ELSE to_date(null) END  dt_evento, 
	a.nr_recibo_retificada					nr_recibo, 
	substr(obter_dados_pf(c.cd_contabilista,'CPF'),1,11)	cd_cpf_responsavel, 
	substr(obter_nome_pf_pj(c.cd_contabilista,null),1,60)	nm_responsavel, 
	lpad(obter_compl_pf(c.cd_contabilista,1,'FAX'),2,0)	nr_ddd_resp,		 
	substr(obter_dados_pf_pj(c.cd_contabilista,null,'T'),1,50)	nr_telefone_resp, 
	substr(obter_compl_pf(c.cd_contabilista,1,'RAM'),1,5)	nr_ramal_resp, 
	substr(obter_dados_pf_pj(c.cd_contabilista,null,'FAX'),1,50)	nr_fax_resp, 
	substr(obter_dados_pf_pj(c.cd_contabilista,null,'M'),1,40)	ds_email_resp, 
	9							ie_uso_declarante, 
	'0000'	cd_retencao, 
	''	ie_tipo_beneficiario, 
	''	nr_beneficiario, 
	''	nm_beneficiario, 
	0	vl_rend_jan, 
	0	vl_deducoes_jan, 
	0	vl_ir_jan, 
	0	Vl_rend_fev, 
	0	vl_deducoes_fev, 
	0	vl_ir_fev, 
	0	vl_rend_mar, 
	0	vl_deducoes_mar, 
	0	vl_ir_mar, 
	0	vl_rend_abr, 
	0	vl_deducoes_abr, 
	0	vl_ir_abr, 
	0	vl_rend_mai, 
	0	vl_deducoes_mai, 
	0	vl_ir_mai, 
	0	vl_rend_jun, 
	0	vl_deducoes_jun, 
	0	vl_ir_jun, 
	0	vl_rend_jul, 
	0	vl_deducoes_jul, 
	0	vl_ir_jul, 
	0	vl_rend_ago, 
	0	vl_deducoes_ago, 
	0	vl_ir_ago, 
	0	vl_rend_set, 
	0	vl_deducoes_set, 
	0	vl_ir_set, 
	0	vl_rend_out, 
	0	vl_deducoes_out, 
	0	vl_ir_out, 
	0	vl_rend_nov, 
	0	vl_deducoes_nov, 
	0	vl_ir_nov, 
	0	vl_rend_dez, 
	0	vl_deducoes_dez, 
	0	vl_ir_dez, 
	0	vl_rend_13_salario, 
	0	vl_deducoes_13_salario, 
	0	vl_ir_13_salario, 
	0	ie_situacao, 
	0	vl_total_registros, 
	0	vl_tot_rend_jan, 
	0	vl_tot_deducoes_jan, 
	0	vl_tot_ir_jan, 
	0	vl_tot_rend_fev,	 
	0	vl_tot_deducoes_fev, 
	0	vl_tot_ir_fev, 
	0	vl_tot_rend_mar, 
	0	vl_tot_deducoes_mar, 
	0	vl_tot_ir_mar, 
	0	vl_tot_rend_abr, 
	0	vl_tot_deducoes_abr, 
	0	vl_tot_ir_abr, 
	0	vl_tot_rend_mai, 
	0	vl_tot_deducoes_mai, 
	0	vl_tot_ir_mai, 
	0	vl_tot_rend_jun, 
	0	vl_tot_deducoes_jun, 
	0	vl_tot_ir_jun, 
	0	vl_tot_rend_jul, 
	0	vl_tot_deducoes_jul, 
	0	vl_tot_ir_jul, 
	0	vl_tot_rend_ago, 
	0	vl_tot_deducoes_ago, 
	0	vl_tot_ir_ago, 
	0	vl_tot_rend_set, 
	0	vl_tot_deducoes_set, 
	0	vl_tot_ir_set, 
	0	vl_tot_rend_out, 
	0	vl_tot_deducoes_out, 
	0	vl_tot_ir_out, 
	0	vl_tot_rend_nov, 
	0	vl_tot_deducoes_nov, 
	0	vl_tot_ir_nov, 
	0	vl_tot_rend_dez, 
	0	vl_tot_deducoes_dez, 
	0	vl_tot_ir_dez, 
	0	vl_tot_rend_13_salario, 
	0	vl_tot_deducoes_13_salario, 
	0	vl_tot_ir_13_salario, 
	'0'	ds_srf 
FROM	dirf_lote a, 
	estabelecimento b, 
	empresa c 
WHERE	a.cd_estabelecimento	= b.cd_estabelecimento 
and	b.cd_empresa		= c.cd_empresa 

UNION ALL
 
/* Registro Tipo 2 */
 
SELECT	nr_seq_lote, 
	'00000002' nr_seq_registro, 
	2							ie_tipo_registro, 
								nr_cpf_cnpj, 
	''	nm_arquivo, 
	''	dt_ano, 
	''	ie_tipo_declaracao, 
	''	ie_situacao_declaracao, 
	''	ie_tipo_declarante, 
	''	ie_natureza_declarante, 
	''	ie_tipo_rendimento, 
	''	ie_indicador_depositario, 
	''	nm_declarante, 
	''	cd_cpf, 
	clock_timestamp()	dt_evento, 
	''	nr_recibo, 
	''	cd_cpf_responsavel, 
	''	nm_responsavel, 
	''	nr_ddd_resp, 
	''	nr_telefone_resp, 
	''	nr_ramal_resp, 
	''	nr_fax_resp, 
	''	ds_email_resp, 
	9							ie_uso_declarante, 
								cd_retencao, 
								ie_tipo_beneficiario, 
								nr_beneficiario, 
								nm_beneficiario, 
	sum(vl_rend_jan)		 			vl_rend_jan, 
	sum(vl_deducoes_jan) 					vl_deducoes_jan, 
	sum(vl_ir_jan) 						vl_ir_jan, 
	sum(vl_rend_fev) 					vl_rend_fev, 
	sum(vl_deducoes_fev) 					vl_deducoes_fev, 
	sum(vl_ir_fev) 						vl_ir_fev, 
	sum(vl_rend_mar) 					vl_rend_mar, 
	sum(vl_deducoes_mar)					vl_deducoes_mar, 
	sum(vl_ir_mar) 						vl_ir_mar, 
	sum(vl_rend_abr) 					vl_rend_abr, 
	sum(vl_deducoes_abr) 					vl_deducoes_abr, 
	sum(vl_ir_abr) 						vl_ir_abr, 
	sum(vl_rend_mai) 					vl_rend_mai, 
	sum(vl_deducoes_mai) 					vl_deducoes_mai, 
	sum(vl_ir_mai) 						vl_ir_mai, 
	sum(vl_rend_jun) 					vl_rend_jun, 
	sum(vl_deducoes_jun) 					vl_deducoes_jun, 
	sum(vl_ir_jun) 						vl_ir_jun, 
	sum(vl_rend_jul) 					vl_rend_jul, 
	sum(vl_deducoes_jul) 					vl_deducoes_jul, 
	sum(vl_ir_jul) 						vl_ir_jul, 
	sum(vl_rend_ago) 					vl_rend_ago, 
	sum(vl_deducoes_ago) 					vl_deducoes_ago, 
	sum(vl_ir_ago) 						vl_ir_ago, 
	sum(vl_rend_set) 					vl_rend_set, 
	sum(vl_deducoes_set) 					vl_deducoes_set, 
	sum(vl_ir_set) 						vl_ir_set, 
	sum(vl_rend_out) 					vl_rend_out, 
	sum(vl_deducoes_out) 					vl_deducoes_out, 
	sum(vl_ir_out) 						vl_ir_out, 
	sum(vl_rend_nov) 					vl_rend_nov, 
	sum(vl_deducoes_nov) 					vl_deducoes_nov, 
	sum(vl_ir_nov) 						vl_ir_nov, 
	sum(vl_rend_dez) 					vl_rend_dez, 
	sum(vl_deducoes_dez) 					vl_deducoes_dez, 
	sum(vl_ir_dez)						vl_ir_dez, 
	sum(vl_rend_13_salario)					vl_rend_13_salario, 
	sum(vl_deducoes_13_salario)				vl_deducoes_13_salario, 
	sum(vl_ir_13_salario)					vl_ir_13_salario, 
	0							ie_situacao, 
	0	vl_total_registros, 
	0	vl_tot_rend_jan, 
	0	vl_tot_deducoes_jan, 
	0	vl_tot_ir_jan, 
	0	vl_tot_rend_fev,	 
	0	vl_tot_deducoes_fev, 
	0	vl_tot_ir_fev, 
	0	vl_tot_rend_mar, 
	0	vl_tot_deducoes_mar, 
	0	vl_tot_ir_mar, 
	0	vl_tot_rend_abr, 
	0	vl_tot_deducoes_abr, 
	0	vl_tot_ir_abr, 
	0	vl_tot_rend_mai, 
	0	vl_tot_deducoes_mai, 
	0	vl_tot_ir_mai, 
	0	vl_tot_rend_jun, 
	0	vl_tot_deducoes_jun, 
	0	vl_tot_ir_jun, 
	0	vl_tot_rend_jul, 
	0	vl_tot_deducoes_jul, 
	0	vl_tot_ir_jul, 
	0	vl_tot_rend_ago, 
	0	vl_tot_deducoes_ago, 
	0	vl_tot_ir_ago, 
	0	vl_tot_rend_set, 
	0	vl_tot_deducoes_set, 
	0	vl_tot_ir_set, 
	0	vl_tot_rend_out, 
	0	vl_tot_deducoes_out, 
	0	vl_tot_ir_out, 
	0	vl_tot_rend_nov, 
	0	vl_tot_deducoes_nov, 
	0	vl_tot_ir_nov, 
	0	vl_tot_rend_dez, 
	0	vl_tot_deducoes_dez, 
	0	vl_tot_ir_dez, 
	0	vl_tot_rend_13_salario, 
	0	vl_tot_deducoes_13_salario, 
	0	vl_tot_ir_13_salario, 
	ds_srf 
from(	SELECT /*+ USE_CONCAT   */ distinct (null)::numeric  nr_titulo, 
	a.nr_sequencia nr_seq_lote, 
	h.cd_cgc						nr_cpf_cnpj, 
	substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10) cd_retencao, 
	CASE WHEN coalesce(i.cd_pessoa_fisica::text, '') = '' THEN '2'  ELSE '1' END 			ie_tipo_beneficiario, 
	coalesce(i.cd_cgc,substr(obter_dados_pf(i.cd_pessoa_fisica,'CPF'),1,11)) nr_beneficiario, 
	substr(obter_nome_pf_pj(i.cd_pessoa_fisica,i.cd_cgc),1,255) nm_beneficiario, 
	obter_valor_rendimentos_mes(a.dt_lote,'01',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_rend_jan, 
	0 vl_deducoes_jan, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='01' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_ir_jan, 
	obter_valor_rendimentos_mes(a.dt_lote,'02',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_rend_fev, 
	0 vl_deducoes_fev, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='02' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_ir_fev, 
	obter_valor_rendimentos_mes(a.dt_lote,'03',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_rend_mar, 
	0 vl_deducoes_mar, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='03' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_ir_mar, 
	obter_valor_rendimentos_mes(a.dt_lote,'04',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_rend_abr, 
	0 vl_deducoes_abr, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='04' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_ir_abr, 
	obter_valor_rendimentos_mes(a.dt_lote,'05',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_rend_mai, 
	0 vl_deducoes_mai, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='05' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_ir_mai, 
	obter_valor_rendimentos_mes(a.dt_lote,'06',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_rend_jun, 
	0 vl_deducoes_jun, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='06' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_ir_jun, 
	obter_valor_rendimentos_mes(a.dt_lote,'07',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_rend_jul, 
	0 vl_deducoes_jul, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='07' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_ir_jul, 
	obter_valor_rendimentos_mes(a.dt_lote,'08',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_rend_ago, 
	0 vl_deducoes_ago, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='08' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_ir_ago, 
	obter_valor_rendimentos_mes(a.dt_lote,'09',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_rend_set, 
	0 vl_deducoes_set, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='09' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_ir_set, 
	obter_valor_rendimentos_mes(a.dt_lote,'10',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_rend_out, 
	0 vl_deducoes_out, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='10' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_ir_out, 
	obter_valor_rendimentos_mes(a.dt_lote,'11',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_rend_nov, 
	0 vl_deducoes_nov, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='11' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_ir_nov, 
	obter_valor_rendimentos_mes(a.dt_lote,'12',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_rend_dez, 
	0 vl_deducoes_dez, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='12' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_ir_dez, 
	0 vl_rend_13_salario, 
	0 vl_deducoes_13_salario, 
	0 vl_ir_13_salario, 
	'0' ds_srf 
FROM estabelecimento h, dirf_lote a, titulo_pagar i
LEFT OUTER JOIN titulo_pagar_imposto g ON (i.nr_titulo = g.nr_titulo)
LEFT OUTER JOIN titulo_pagar f ON (g.nr_sequencia = f.nr_seq_tributo)
LEFT OUTER JOIN tributo j ON (g.cd_tributo = j.cd_tributo)
WHERE OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao) between trunc(a.dt_lote,'yyyy') and fim_ano(a.dt_lote)   and a.cd_estabelecimento	= h.cd_estabelecimento  and i.ie_tipo_titulo in ('0','11','13') and i.ie_situacao <> 'C' and (((i.cd_cgc IS NOT NULL AND i.cd_cgc::text <> '') and exists (select 	1 
					FROM darf z, darf_titulo_pagar x, titulo_pagar q, titulo_pagar y
LEFT OUTER JOIN titulo_pagar_imposto p ON (y.nr_seq_tributo = p.nr_sequencia)
WHERE x.nr_titulo 	= y.nr_titulo  and y.nr_titulo_original	= q.nr_titulo and x.nr_seq_darf 	= z.nr_sequencia and z.dt_apuracao between TRUNC(a.dt_lote,'yyyy') and fim_ano(a.dt_lote) and z.cd_darf 	= substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10) and q.cd_cgc 	= i.cd_cgc )) or (coalesce(i.cd_cgc::text, '') = '')) and substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10) not in ('2305','2631') and substr(obter_se_valor_rend_superior(i.cd_pessoa_fisica, i.cd_cgc,a.dt_lote,a.vl_min_ano_pf),1,2) = 'S' group by a.nr_sequencia, 
	h.cd_cgc, 
	substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10), 
	CASE WHEN coalesce(i.cd_pessoa_fisica::text, '') = '' THEN '2'  ELSE '1' END , 
	coalesce(i.cd_cgc,substr(obter_dados_pf(i.cd_pessoa_fisica,'CPF'),1,11)), 
	substr(obter_nome_pf_pj(i.cd_pessoa_fisica,i.cd_cgc),1,255), 
	obter_valor_rendimentos_mes(a.dt_lote,'01',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'02',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'03',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'04',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'05',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'06',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'07',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'08',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'09',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'10',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'11',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'12',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) 

union all
 /* GPS - INSS */
 
select	/*+ USE_CONCAT   */ distinct e.nr_titulo, 
	a.nr_sequencia nr_seq_lote, 
	h.cd_cgc						nr_cpf_cnpj, 
	'0588' cd_retencao, 
	CASE WHEN coalesce(i.cd_pessoa_fisica::text, '') = '' THEN '2'  ELSE '1' END 			ie_tipo_beneficiario, 
	coalesce(i.cd_cgc,SUBSTR(obter_dados_pf(i.cd_pessoa_fisica,'CPF'),1,11)) nr_beneficiario, 
	SUBSTR(obter_nome_pf_pj(i.cd_pessoa_fisica,i.cd_cgc),1,255) nm_beneficiario, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='01' THEN g.vl_imposto  ELSE 0 END  vl_rend_jan, 
	0 vl_deducoes_jan, 
	0 vl_ir_jan, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='02' THEN g.vl_imposto  ELSE 0 END 	vl_rend_fev, 
	0 vl_deducoes_fev, 
	0 vl_ir_fev, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='03' THEN g.vl_imposto  ELSE 0 END 	vl_rend_mar, 
	0 vl_deducoes_mar, 
	0 vl_ir_mar, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='04' THEN g.vl_imposto  ELSE 0 END  vl_rend_abr, 
	0 vl_deducoes_abr, 
	0 vl_ir_abr, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='05' THEN g.vl_imposto  ELSE 0 END  vl_rend_mai, 
	0 vl_deducoes_mai, 
	0 vl_ir_mai, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='06' THEN g.vl_imposto  ELSE 0 END  vl_rend_jun, 
	0 vl_deducoes_jun, 
	0 vl_ir_jun, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='07' THEN g.vl_imposto  ELSE 0 END  vl_rend_jul, 
	0 vl_deducoes_jul, 
	0 vl_ir_jul, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='08' THEN g.vl_imposto  ELSE 0 END  vl_rend_ago, 
	0 vl_deducoes_ago, 
	0 vl_ir_ago, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='09' THEN g.vl_imposto  ELSE 0 END  vl_rend_set, 
	0 vl_deducoes_set, 
	0 vl_ir_set, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='10' THEN g.vl_imposto  ELSE 0 END  vl_rend_out, 
	0 vl_deducoes_out, 
	0 vl_ir_out, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='11' THEN g.vl_imposto  ELSE 0 END  vl_rend_nov, 
	0 vl_deducoes_nov, 
	0 vl_ir_nov, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='12' THEN g.vl_imposto  ELSE 0 END  vl_rend_dez, 
	0 vl_deducoes_dez, 
	0 vl_ir_dez, 
	0 vl_rend_13_salario, 
	0 vl_deducoes_13_salario, 
	0 vl_ir_13_salario, 
	'1' ds_srf 
FROM titulo_pagar i, estabelecimento h, gps_titulo e, gps d, dirf_lote a, titulo_pagar f
LEFT OUTER JOIN titulo_pagar_imposto g ON (f.nr_seq_tributo = g.nr_sequencia)
WHERE a.nr_sequencia		= d.nr_seq_dirf and d.nr_sequencia = e.nr_seq_gps and e.nr_titulo		= f.nr_titulo  and a.cd_estabelecimento	= h.cd_estabelecimento and f.nr_titulo_original	= i.nr_titulo ) 
group by nr_seq_lote, 
	cd_retencao, 
	nr_cpf_cnpj, 
	ie_tipo_beneficiario, 
	nr_beneficiario, 
	nm_beneficiario, 
	ds_srf 

UNION ALL
 
/* Registro Tipo 3 */
 
SELECT	nr_seq_lote, 
	'00000003' nr_seq_registro, 
	3	ie_tipo_registro, 
		nr_cpf_cnpj, 
	''	nm_arquivo, 
	''	dt_ano, 
	''	ie_tipo_declaracao, 
	''	ie_situacao_declaracao, 
	''	ie_tipo_declarante, 
	''	ie_natureza_declarante, 
	''	ie_tipo_rendimento, 
	''	ie_indicador_depositario, 
	''	nm_declarante, 
	''	cd_cpf, 
	clock_timestamp()	dt_evento, 
	''	nr_recibo, 
	''	cd_cpf_responsavel, 
	''	nm_responsavel, 
	''	nr_ddd_resp, 
	''	nr_telefone_resp, 
	''	nr_ramal_resp, 
	''	nr_fax_resp, 
	''	ds_email_resp, 
	9	ie_uso_declarante, 
		cd_retencao, 
	''	ie_tipo_beneficiario, 
	''	nr_beneficiario, 
	''	nm_beneficiario, 
	0	vl_rend_jan, 
	0	vl_deducoes_jan, 
	0	vl_ir_jan, 
	0	Vl_rend_fev, 
	0	vl_deducoes_fev, 
	0	vl_ir_fev, 
	0	vl_rend_mar, 
	0	vl_deducoes_mar, 
	0	vl_ir_mar, 
	0	vl_rend_abr, 
	0	vl_deducoes_abr, 
	0	vl_ir_abr, 
	0	vl_rend_mai, 
	0	vl_deducoes_mai, 
	0	vl_ir_mai, 
	0	vl_rend_jun, 
	0	vl_deducoes_jun, 
	0	vl_ir_jun, 
	0	vl_rend_jul, 
	0	vl_deducoes_jul, 
	0	vl_ir_jul, 
	0	vl_rend_ago, 
	0	vl_deducoes_ago, 
	0	vl_ir_ago, 
	0	vl_rend_set, 
	0	vl_deducoes_set, 
	0	vl_ir_set, 
	0	vl_rend_out, 
	0	vl_deducoes_out, 
	0	vl_ir_out, 
	0	vl_rend_nov, 
	0	vl_deducoes_nov, 
	0	vl_ir_nov, 
	0	vl_rend_dez, 
	0	vl_deducoes_dez, 
	0	vl_ir_dez, 
	0	vl_rend_13_salario, 
	0	vl_deducoes_13_salario, 
	0	vl_ir_13_salario, 
	0	ie_situacao, 
	1							vl_total_registros, 
	sum(vl_tot_rend_jan) 					vl_tot_rend_jan, 
	sum(vl_tot_deducoes_jan) 				vl_tot_deducoes_jan, 
	sum(vl_tot_ir_jan) 					vl_tot_ir_jan, 
	sum(vl_tot_rend_fev) 					vl_tot_rend_fev,	 
	sum(vl_tot_deducoes_fev) 				vl_tot_deducoes_fev, 
	sum(vl_tot_ir_fev) 					vl_tot_ir_fev, 
	sum(vl_tot_rend_mar) 					vl_tot_rend_mar, 
	sum(vl_tot_deducoes_mar) 				vl_tot_deducoes_mar, 
	sum(vl_tot_ir_mar) 					vl_tot_ir_mar, 
	sum(vl_tot_rend_abr) 					vl_tot_rend_abr, 
	sum(vl_tot_deducoes_abr) 				vl_tot_deducoes_abr, 
	sum(vl_tot_ir_abr) 					vl_tot_ir_abr, 
	sum(vl_tot_rend_mai) 					vl_tot_rend_mai, 
	sum(vl_tot_deducoes_mai) 				vl_tot_deducoes_mai, 
	sum(vl_tot_ir_mai) 					vl_tot_ir_mai, 
	sum(vl_tot_rend_jun) 					vl_tot_rend_jun, 
	sum(vl_tot_deducoes_jun) 				vl_tot_deducoes_jun, 
	sum(vl_tot_ir_jun) 					vl_tot_ir_jun, 
	sum(vl_tot_rend_jul) 					vl_tot_rend_jul, 
	sum(vl_tot_deducoes_jul) 				vl_tot_deducoes_jul, 
	sum(vl_tot_ir_jul) 					vl_tot_ir_jul, 
	sum(vl_tot_rend_ago) 					vl_tot_rend_ago, 
	sum(vl_tot_deducoes_ago) 				vl_tot_deducoes_ago, 
	sum(vl_tot_ir_ago) 					vl_tot_ir_ago, 
	sum(vl_tot_rend_set) 					vl_tot_rend_set, 
	sum(vl_tot_deducoes_set) 				vl_tot_deducoes_set, 
	sum(vl_tot_ir_set) 					vl_tot_ir_set, 
	sum(vl_tot_rend_out) 					vl_tot_rend_out, 
	sum(vl_tot_deducoes_out) 				vl_tot_deducoes_out, 
	sum(vl_tot_ir_out) 					vl_tot_ir_out, 
	sum(vl_tot_rend_nov) 					vl_tot_rend_nov, 
	sum(vl_tot_deducoes_nov) 				vl_tot_deducoes_nov, 
	sum(vl_tot_ir_nov) 					vl_tot_ir_nov, 
	sum(vl_tot_rend_dez) 					vl_tot_rend_dez, 
	sum(vl_tot_deducoes_dez) 				vl_tot_deducoes_dez, 
	sum(vl_tot_ir_dez) 					vl_tot_ir_dez, 
	sum(vl_tot_rend_13_salario) 				vl_tot_rend_13_salario, 
	sum(vl_tot_deducoes_13_salario) 			vl_tot_deducoes_13_salario, 
	sum(vl_tot_ir_13_salario) 				vl_tot_ir_13_salario, 
	'0'	ds_srf 
from	(select /*+ USE_CONCAT   */ distinct a.nr_sequencia 			nr_seq_lote, 
	(null)::numeric  nr_titulo, 
	h.cd_cgc						nr_cpf_cnpj, 
	substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10) cd_retencao, 
	obter_valor_rendimentos_mes(a.dt_lote,'01',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_tot_rend_jan, 
	0 vl_tot_deducoes_jan, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='01' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_tot_ir_jan, 
	obter_valor_rendimentos_mes(a.dt_lote,'02',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_tot_rend_fev, 
	0 vl_tot_deducoes_fev, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='02' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_tot_ir_fev, 
	obter_valor_rendimentos_mes(a.dt_lote,'03',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_tot_rend_mar, 
	0 vl_tot_deducoes_mar, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='03' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_tot_ir_mar, 
	obter_valor_rendimentos_mes(a.dt_lote,'04',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_tot_rend_abr, 
	0 vl_tot_deducoes_abr, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='04' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_tot_ir_abr, 
	obter_valor_rendimentos_mes(a.dt_lote,'05',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_tot_rend_mai, 
	0 vl_tot_deducoes_mai, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='05' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_tot_ir_mai, 
	obter_valor_rendimentos_mes(a.dt_lote,'06',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_tot_rend_jun, 
	0 vl_tot_deducoes_jun, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='06' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_tot_ir_jun, 
	obter_valor_rendimentos_mes(a.dt_lote,'07',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_tot_rend_jul, 
	0 vl_tot_deducoes_jul, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='07' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_tot_ir_jul, 
	obter_valor_rendimentos_mes(a.dt_lote,'08',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_tot_rend_ago, 
	0 vl_tot_deducoes_ago, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='08' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_tot_ir_ago, 
	obter_valor_rendimentos_mes(a.dt_lote,'09',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_tot_rend_set, 
	0 vl_tot_deducoes_set, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='09' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_tot_ir_set, 
	obter_valor_rendimentos_mes(a.dt_lote,'10',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_tot_rend_out, 
	0 vl_tot_deducoes_out, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='10' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_tot_ir_out, 
	obter_valor_rendimentos_mes(a.dt_lote,'11',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_tot_rend_nov, 
	0 vl_tot_deducoes_nov, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='11' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_tot_ir_nov, 
	obter_valor_rendimentos_mes(a.dt_lote,'12',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) vl_tot_rend_dez, 
	0 vl_tot_deducoes_dez, 
	sum(CASE WHEN substr(to_char(OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao),'dd/mm/yyyy'),4,2)='12' THEN CASE WHEN j.ie_tipo_tributo='ISS' THEN 0  ELSE g.vl_imposto END   ELSE 0 END ) vl_tot_ir_dez, 
	0 vl_tot_rend_13_salario, 
	0 vl_tot_deducoes_13_salario, 
	0 vl_tot_ir_13_salario 
FROM estabelecimento h, dirf_lote a, titulo_pagar i
LEFT OUTER JOIN titulo_pagar_imposto g ON (i.nr_titulo = g.nr_titulo)
LEFT OUTER JOIN titulo_pagar f ON (g.nr_sequencia = f.nr_seq_tributo)
LEFT OUTER JOIN tributo j ON (g.cd_tributo = j.cd_tributo)
WHERE OBTER_DATA_RETENCAO(substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10),i.dt_contabil,i.dt_liquidacao) between trunc(a.dt_lote,'yyyy') and fim_ano(a.dt_lote)   and a.cd_estabelecimento	= h.cd_estabelecimento  and i.ie_tipo_titulo in ('0','11','13') and (((i.cd_cgc IS NOT NULL AND i.cd_cgc::text <> '') and exists (select 	1 
					FROM darf z, darf_titulo_pagar x, titulo_pagar q, titulo_pagar y
LEFT OUTER JOIN titulo_pagar_imposto p ON (y.nr_seq_tributo = p.nr_sequencia)
WHERE x.nr_titulo 	= y.nr_titulo  and y.nr_titulo_original	= q.nr_titulo and x.nr_seq_darf 	= z.nr_sequencia and z.dt_apuracao between TRUNC(a.dt_lote,'yyyy') and fim_ano(a.dt_lote) and z.cd_darf 	= substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10) and q.cd_cgc 	= i.cd_cgc )) or (coalesce(i.cd_cgc::text, '') = '')) and substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10) not in ('2305','2631') and substr(obter_se_valor_rend_superior(i.cd_pessoa_fisica, i.cd_cgc,a.dt_lote,a.vl_min_ano_pf),1,2) = 'S' group by a.nr_sequencia, 
	h.cd_cgc, 
	substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10), 
	obter_valor_rendimentos_mes(a.dt_lote,'01',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'02',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'03',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'04',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'05',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'06',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'07',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'08',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'09',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'10',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'11',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)), 
	obter_valor_rendimentos_mes(a.dt_lote,'12',a.cd_estabelecimento,i.cd_pessoa_fisica,i.cd_cgc,substr(obter_codigo_retencao(g.cd_darf,g.cd_tributo,i.cd_estabelecimento,i.cd_cgc,i.cd_pessoa_fisica),1,10)) 

union all
 /* GPS - INSS*/
 
select	/*+ USE_CONCAT   */ distinct a.nr_sequencia 			nr_seq_lote, 
	g.nr_titulo, 
	h.cd_cgc						nr_cpf_cnpj, 
	'0588' cd_retencao, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='01' THEN g.vl_imposto  ELSE 0 END  vl_tot_rend_jan, 
	0 vl_tot_deducoes_jan, 
	0 vl_tot_ir_jan, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='02' THEN g.vl_imposto  ELSE 0 END  vl_tot_rend_fev, 
	0 vl_tot_deducoes_fev, 
	0 vl_tot_ir_fev, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='03' THEN g.vl_imposto  ELSE 0 END  vl_tot_rend_mar, 
	0 vl_tot_deducoes_mar, 
	0 vl_tot_ir_mar, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='04' THEN g.vl_imposto  ELSE 0 END  vl_tot_rend_abr, 
	0 vl_tot_deducoes_abr, 
	0 vl_tot_ir_abr, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='05' THEN g.vl_imposto  ELSE 0 END  vl_tot_rend_mai, 
	0 vl_tot_deducoes_mai, 
	0 vl_tot_ir_mai, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='06' THEN g.vl_imposto  ELSE 0 END  vl_tot_rend_jun, 
	0 vl_tot_deducoes_jun, 
	0 vl_tot_ir_jun, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='07' THEN g.vl_imposto  ELSE 0 END  vl_tot_rend_jul, 
	0 vl_tot_deducoes_jul, 
	0 vl_tot_ir_jul, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='08' THEN g.vl_imposto  ELSE 0 END  vl_tot_rend_ago, 
	0 vl_tot_deducoes_ago, 
	0 vl_tot_ir_ago, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='09' THEN g.vl_imposto  ELSE 0 END  vl_tot_rend_set, 
	0 vl_tot_deducoes_set, 
	0 vl_tot_ir_set, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='10' THEN g.vl_imposto  ELSE 0 END  vl_tot_rend_out, 
	0 vl_tot_deducoes_out, 
	0 vl_tot_ir_out, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='11' THEN g.vl_imposto  ELSE 0 END  vl_tot_rend_nov, 
	0 vl_tot_deducoes_nov, 
	0 vl_tot_ir_nov, 
	CASE WHEN SUBSTR(TO_CHAR(d.dt_referencia,'dd/mm/yyyy'),4,2)='12' THEN g.vl_imposto  ELSE 0 END  vl_tot_rend_dez, 
	0 vl_tot_deducoes_dez, 
	0 vl_tot_ir_dez, 
	0 vl_tot_rend_13_salario, 
	0 vl_tot_deducoes_13_salario, 
	0 vl_tot_ir_13_salario 
FROM titulo_pagar i, estabelecimento h, gps_titulo e, gps d, dirf_lote a, titulo_pagar f
LEFT OUTER JOIN titulo_pagar_imposto g ON (f.nr_seq_tributo = g.nr_sequencia)
WHERE a.nr_sequencia		= d.nr_seq_dirf and d.nr_sequencia = e.nr_seq_gps and e.nr_titulo		= f.nr_titulo  and a.cd_estabelecimento	= h.cd_estabelecimento and f.nr_titulo_original	= i.nr_titulo ) alias508 
group by cd_retencao, 
	nr_seq_lote, 
	nr_cpf_cnpj;


BEGIN 
 
delete	from w_envio_dirf;
commit;
 
open c01;
loop 
fetch c01 into 
	nr_seq_lote_w, 
	nr_seq_registro_w, 
	ie_tipo_registro_w, 
	nr_cpf_cnpj_w, 
	nm_arquivo_w, 
	dt_ano_w, 
	ie_tipo_declaracao_w, 
	ie_situacao_declaracao_w, 
	ie_tipo_declarante_w, 
	ie_natureza_declarante_w, 
	ie_tipo_rendimento_w, 
	ie_indicador_depositario_w, 
	nm_declarante_w, 
	cd_cpf_w, 
	dt_evento_w, 
	nr_recibo_w, 
	cd_cpf_responsavel_w, 
	nm_responsavel_w, 
	nr_ddd_resp_w, 
	nr_telefone_resp_w, 
	nr_ramal_resp_w, 
	nr_fax_resp_w, 
	ds_email_resp_w, 
	ie_uso_declarante_w, 
	cd_retencao_w, 
	ie_tipo_beneficiario_w, 
	nr_beneficiario_w, 
	nm_beneficiario_w, 
	vl_rend_jan_w, 
	vl_deducoes_jan_w, 
	vl_ir_jan_w, 
	vl_rend_fev_w, 
	vl_ir_fev_w, 
	vl_deducoes_fev_w, 
	vl_rend_mar_w, 
	vl_deducoes_mar_w, 
	vl_ir_mar_w, 
	vl_rend_abr_w, 
	vl_deducoes_abr_w, 
	vl_ir_abr_w, 
	vl_rend_mai_w, 
	vl_deducoes_mai_w, 
	vl_ir_mai_w, 
	vl_rend_jun_w, 
	vl_deducoes_jun_w, 
	vl_ir_jun_w, 
	vl_rend_jul_w, 
	vl_deducoes_jul_w, 
	vl_ir_jul_w, 
	vl_rend_ago_w, 
	vl_deducoes_ago_w, 
	vl_ir_ago_w, 
	vl_rend_set_w, 
	vl_deducoes_set_w, 
	vl_ir_set_w, 
	vl_rend_out_w, 
	vl_deducoes_out_w, 
	vl_ir_out_w, 
	vl_rend_nov_w, 
	vl_deducoes_nov_w, 
	vl_ir_nov_w, 
	vl_rend_dez_w, 
	vl_deducoes_dez_w, 
	vl_ir_dez_w, 
	vl_rend_13_salario_w, 
	vl_deducoes_13_salario_w, 
	vl_ir_13_salario_w, 
	ie_situacao_w, 
	vl_total_registros_w, 
	vl_tot_rend_jan_w, 
	vl_tot_deducoes_jan_w, 
	vl_tot_ir_jan_w, 
	vl_tot_rend_fev_w, 
	vl_tot_deducoes_fev_w, 
	vl_tot_ir_fev_w, 
	vl_tot_rend_mar_w, 
	vl_tot_deducoes_mar_w, 
	vl_tot_ir_mar_w, 
	vl_tot_rend_abr_w, 
	vl_tot_deducoes_abr_w, 
	vl_tot_ir_abr_w, 
	vl_tot_rend_mai_w, 
	vl_tot_deducoes_mai_w, 
	vl_tot_ir_mai_w, 
	vl_tot_rend_jun_w, 
	vl_tot_deducoes_jun_w, 
	vl_tot_ir_jun_w, 
	vl_tot_rend_jul_w, 
	vl_tot_deducoes_jul_w, 
	vl_tot_ir_jul_w, 
	vl_tot_rend_ago_w, 
	vl_tot_deducoes_ago_w, 
	vl_tot_ir_ago_w, 
	vl_tot_rend_set_w, 
	vl_tot_deducoes_set_w, 
	vl_tot_ir_set_w, 
	vl_tot_rend_out_w, 
	vl_tot_deducoes_out_w, 
	vl_tot_ir_out_w, 
	vl_tot_rend_nov_w, 
	vl_tot_deducoes_nov_w, 
	vl_tot_ir_nov_w, 
	vl_tot_rend_dez_w, 
	vl_tot_deducoes_dez_w, 
	vl_tot_ir_dez_w, 
	vl_tot_rend_13_salario_w, 
	vl_tot_deducoes_13_salario_w, 
	vl_tot_ir_13_salario_w, 
	ds_srf_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
 
 
insert	into	w_envio_dirf(nr_sequencia, 
		dt_atualizacao, 
		nm_usuario, 
		dt_atualizacao_nrec, 
		nm_usuario_nrec, 
		nr_seq_lote, 
		nr_seq_registro, 
		ie_tipo_registro, 
		nr_cpf_cnpj, 
		nm_arquivo, 
		dt_ano, 
		ie_tipo_declaracao, 
		ie_situacao_declaracao, 
		ie_tipo_declarante, 
		ie_natureza_declarante, 
		ie_tipo_rendimento, 
		ie_indicador_depositario, 
		nm_declarante, 
		cd_cpf, 
		dt_evento, 
		nr_recibo, 
		cd_cpf_responsavel, 
		nm_responsavel, 
		nr_ddd_resp, 
		nr_telefone_resp, 
		nr_ramal_resp, 
		nr_fax_resp, 
		ds_email_resp, 
		ie_uso_declarante, 
		cd_retencao, 
		ie_tipo_beneficiario, 
		nr_beneficiario, 
		nm_beneficiario, 
		vl_rend_jan, 
		vl_deducoes_jan, 
		vl_ir_jan, 
		vl_rend_fev, 
		vl_ir_fev, 
		vl_deducoes_fev, 
		vl_rend_mar, 
		vl_deducoes_mar, 
		vl_ir_mar, 
		vl_rend_abr, 
		vl_deducoes_abr, 
		vl_ir_abr, 
		vl_rend_mai, 
		vl_deducoes_mai, 
		vl_ir_mai, 
		vl_rend_jun, 
		vl_deducoes_jun, 
		vl_ir_jun, 
		vl_rend_jul, 
		vl_deducoes_jul, 
		vl_ir_jul, 
		vl_rend_ago, 
		vl_deducoes_ago, 
		vl_ir_ago, 
		vl_rend_set, 
		vl_deducoes_set, 
		vl_ir_set, 
		vl_rend_out, 
		vl_deducoes_out, 
		vl_ir_out, 
		vl_rend_nov, 
		vl_deducoes_nov, 
		vl_ir_nov, 
		vl_rend_dez, 
		vl_deducoes_dez, 
		vl_ir_dez, 
		vl_rend_13_salario, 
		vl_deducoes_13_salario, 
		vl_ir_13_salario, 
		ie_situacao, 
		vl_total_registros, 
		vl_tot_rend_jan, 
		vl_tot_deducoes_jan, 
		vl_tot_ir_jan, 
		vl_tot_rend_fev, 
		vl_tot_deducoes_fev, 
		vl_tot_ir_fev, 
		vl_tot_rend_mar, 
		vl_tot_deducoes_mar, 
		vl_tot_ir_mar, 
		vl_tot_rend_abr, 
		vl_tot_deducoes_abr, 
		vl_tot_ir_abr, 
		vl_tot_rend_mai, 
		vl_tot_deducoes_mai, 
		vl_tot_ir_mai, 
		vl_tot_rend_jun, 
		vl_tot_deducoes_jun, 
		vl_tot_ir_jun, 
		vl_tot_rend_jul, 
		vl_tot_deducoes_jul, 
		vl_tot_ir_jul, 
		vl_tot_rend_ago, 
		vl_tot_deducoes_ago, 
		vl_tot_ir_ago, 
		vl_tot_rend_set, 
		vl_tot_deducoes_set, 
		vl_tot_ir_set, 
		vl_tot_rend_out, 
		vl_tot_deducoes_out, 
		vl_tot_ir_out, 
		vl_tot_rend_nov, 
		vl_tot_deducoes_nov, 
		vl_tot_ir_nov, 
		vl_tot_rend_dez, 
		vl_tot_deducoes_dez, 
		vl_tot_ir_dez, 
		vl_tot_rend_13_salario, 
		vl_tot_deducoes_13_salario, 
		vl_tot_ir_13_salario, 
		ds_srf) 
	values (nextval('w_envio_dirf_seq'), 
		clock_timestamp(), 
		nm_usuario_p, 
		clock_timestamp(), 
		nm_usuario_p, 
		nr_seq_lote_w, 
		nr_seq_registro_w, 
		ie_tipo_registro_w, 
		nr_cpf_cnpj_w, 
		nm_arquivo_w, 
		dt_ano_w, 
		ie_tipo_declaracao_w, 
		ie_situacao_declaracao_w, 
		ie_tipo_declarante_w, 
		ie_natureza_declarante_w, 
		ie_tipo_rendimento_w, 
		ie_indicador_depositario_w, 
		nm_declarante_w, 
		cd_cpf_w, 
		dt_evento_w, 
		nr_recibo_w, 
		cd_cpf_responsavel_w, 
		nm_responsavel_w, 
		nr_ddd_resp_w, 
		nr_telefone_resp_w, 
		nr_ramal_resp_w, 
		nr_fax_resp_w, 
		ds_email_resp_w, 
		ie_uso_declarante_w, 
		cd_retencao_w, 
		ie_tipo_beneficiario_w, 
		nr_beneficiario_w, 
		nm_beneficiario_w, 
		vl_rend_jan_w, 
		vl_deducoes_jan_w, 
		vl_ir_jan_w, 
		vl_rend_fev_w, 
		vl_ir_fev_w, 
		vl_deducoes_fev_w, 
		vl_rend_mar_w, 
		vl_deducoes_mar_w, 
		vl_ir_mar_w, 
		vl_rend_abr_w, 
		vl_deducoes_abr_w, 
		vl_ir_abr_w, 
		vl_rend_mai_w, 
		vl_deducoes_mai_w, 
		vl_ir_mai_w, 
		vl_rend_jun_w, 
		vl_deducoes_jun_w, 
		vl_ir_jun_w, 
		vl_rend_jul_w, 
		vl_deducoes_jul_w, 
		vl_ir_jul_w, 
		vl_rend_ago_w, 
		vl_deducoes_ago_w, 
		vl_ir_ago_w, 
		vl_rend_set_w, 
		vl_deducoes_set_w, 
		vl_ir_set_w, 
		vl_rend_out_w, 
		vl_deducoes_out_w, 
		vl_ir_out_w, 
		vl_rend_nov_w, 
		vl_deducoes_nov_w, 
		vl_ir_nov_w, 
		vl_rend_dez_w, 
		vl_deducoes_dez_w, 
		vl_ir_dez_w, 
		vl_rend_13_salario_w, 
		vl_deducoes_13_salario_w, 
		vl_ir_13_salario_w, 
		ie_situacao_w, 
		vl_total_registros_w, 
		vl_tot_rend_jan_w, 
		vl_tot_deducoes_jan_w, 
		vl_tot_ir_jan_w, 
		vl_tot_rend_fev_w, 
		vl_tot_deducoes_fev_w, 
		vl_tot_ir_fev_w, 
		vl_tot_rend_mar_w, 
		vl_tot_deducoes_mar_w, 
		vl_tot_ir_mar_w, 
		vl_tot_rend_abr_w, 
		vl_tot_deducoes_abr_w, 
		vl_tot_ir_abr_w, 
		vl_tot_rend_mai_w, 
		vl_tot_deducoes_mai_w, 
		vl_tot_ir_mai_w, 
		vl_tot_rend_jun_w, 
		vl_tot_deducoes_jun_w, 
		vl_tot_ir_jun_w, 
		vl_tot_rend_jul_w, 
		vl_tot_deducoes_jul_w, 
		vl_tot_ir_jul_w, 
		vl_tot_rend_ago_w, 
		vl_tot_deducoes_ago_w, 
		vl_tot_ir_ago_w, 
		vl_tot_rend_set_w, 
		vl_tot_deducoes_set_w, 
		vl_tot_ir_set_w, 
		vl_tot_rend_out_w, 
		vl_tot_deducoes_out_w, 
		vl_tot_ir_out_w, 
		vl_tot_rend_nov_w, 
		vl_tot_deducoes_nov_w, 
		vl_tot_ir_nov_w, 
		vl_tot_rend_dez_w, 
		vl_tot_deducoes_dez_w, 
		vl_tot_ir_dez_w, 
		vl_tot_rend_13_salario_w, 
		vl_tot_deducoes_13_salario_w, 
		vl_tot_ir_13_salario_w, 
		ds_srf_w);
 
end loop;
close c01;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_w_envio_dirf ( nr_seq_envio_p bigint, nm_usuario_p text) FROM PUBLIC;

