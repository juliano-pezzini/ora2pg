-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_obter_relatorio_web ( nm_usuario_p text, ie_grupo_p text, cd_estabelecimento_p bigint, cd_relatorio_p INOUT bigint, cd_classif_relat_p INOUT text) AS $body$
DECLARE

					 
/*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
Finalidade:  Obter relatório no portal web 
---------------------------------------------------------------------------------------------------------------------------------------------------- 
Locais de chamada direta: 
[ ] Objetos do dicionário [ ] Tasy (Delphi/Java) [ x ] Portal [ ] Relatórios [ ] Outros: 
 ---------------------------------------------------------------------------------------------------------------------------------------------------- 
Pontos de atenção:  
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/	 
 
nr_seq_grupo_w		bigint;
nr_seq_relatorio_w	bigint;
nr_contador_w		bigint;
cd_relatorio_w		integer	:= null;
cd_classif_relat_w	varchar(4)	:= '';


BEGIN 
 
select 	max(coalesce(b.nr_sequencia,0)) 
into STRICT 	nr_seq_grupo_w 
from  	pls_grupo_relatorio a, 
	pls_regra_relat_grupo b 
where 	a.nr_Sequencia = b.nr_seq_grupo_relat 
and	a.cd_grupo = ie_grupo_p;
 
 
if (nr_seq_grupo_w > 0 ) then	 
	select 	count(nr_sequencia) 
	into STRICT	nr_contador_w 
	from	pls_regra_relatorio 
	where  nr_seq_grupo = nr_seq_grupo_w 
	and 	ie_padrao = 'S';
 
	if (nr_contador_w > 0) then 	 
		select max(nr_seq_relatorio) 
		into STRICT 	nr_seq_relatorio_w 
		from	pls_regra_relatorio 
		where  nr_seq_grupo = nr_seq_grupo_w	 
		and	nr_sequencia = (SELECT	max(nr_sequencia) 
					from	pls_regra_relatorio 	 
					where  nr_seq_grupo = nr_seq_grupo_w	 
					and 	ie_padrao = 'S');
 
		if (nr_seq_relatorio_w IS NOT NULL AND nr_seq_relatorio_w::text <> '') then	 
			begin 
				select	cd_relatorio, 
					cd_classif_relat 
				into STRICT	cd_relatorio_w,		 
					cd_classif_relat_w 
				from	relatorio    
				where	nr_sequencia = nr_seq_relatorio_w;
			exception 
			when others then 
				cd_relatorio_w := null;
				cd_classif_relat_w := '';
			end;
		end if;
	end if;
 
end if;
		 
	 
cd_relatorio_p		:=	cd_relatorio_w;		
cd_classif_relat_p	:=	cd_classif_relat_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_obter_relatorio_web ( nm_usuario_p text, ie_grupo_p text, cd_estabelecimento_p bigint, cd_relatorio_p INOUT bigint, cd_classif_relat_p INOUT text) FROM PUBLIC;

