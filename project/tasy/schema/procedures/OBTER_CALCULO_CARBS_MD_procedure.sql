-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_calculo_carbs_md (qt_field_calc_p bigint, qt_edit_field_calc_p bigint, qt_max_value_p bigint, ds_json_p INOUT text) AS $body$
DECLARE


  qt_final_value_w   bigint;
  qt_calc_value_w bigint;
  pr_carboidrato_w bigint;
  qt_fixed_value_w bigint;


BEGIN

  qt_calc_value_w := (coalesce(qt_field_calc_p, 0) +
                     coalesce(qt_edit_field_calc_p, 0));


  if (qt_calc_value_w > qt_max_value_p) then
    qt_fixed_value_w    := (coalesce(qt_max_value_p, 0) - coalesce(qt_field_calc_p, 0));
    pr_carboidrato_w := coalesce(qt_max_value_p, 0) - (coalesce(qt_field_calc_p, 0) +
                        qt_fixed_value_w);
  else
    qt_final_value_w    := (coalesce(qt_max_value_p, 0) - (coalesce(qt_field_calc_p, 0) +
                        coalesce(qt_edit_field_calc_p, 0)));
    pr_carboidrato_w := qt_final_value_w;
  end if;

  ds_json_p := '{'
            || '"QT_CALC_VALUE_P":'  || qt_calc_value_w || ','
			|| '"QT_FIXED_VALUE_P":' || coalesce(qt_fixed_value_w,0) || ','
            || '"PR_CARBOIDRATO_P":' || pr_carboidrato_w
            || '}';

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_calculo_carbs_md (qt_field_calc_p bigint, qt_edit_field_calc_p bigint, qt_max_value_p bigint, ds_json_p INOUT text) FROM PUBLIC;

