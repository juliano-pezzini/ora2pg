-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consiste_dias_conv_quimio (cd_estabelecimento_p bigint, nr_seq_paciente_p bigint, dt_prevista_p timestamp) AS $body$
DECLARE

	 
cd_convenio_w		paciente_setor_convenio.cd_convenio%type;
qt_dias_autor_quimio_w	convenio_estabelecimento.qt_dias_autor_quimio%type;
	

BEGIN 
 
begin 
select	cd_convenio 
into STRICT	cd_convenio_w 
from	paciente_setor_convenio 
where	nr_seq_paciente	= nr_seq_paciente_p  LIMIT 1;
exception 
when others then 
	cd_convenio_w	:= null;	
end;
 
if (cd_convenio_w IS NOT NULL AND cd_convenio_w::text <> '') then 
 
	select	max(qt_dias_autor_quimio) 
	into STRICT	qt_dias_autor_quimio_w 
	from	convenio_estabelecimento 
	where	cd_estabelecimento	= cd_estabelecimento_p 
	and	cd_convenio		= cd_convenio_w;
	 
	if (coalesce(qt_dias_autor_quimio_w,0) > 0) then 
	 
		if (trunc(dt_prevista_p) < trunc(clock_timestamp() + qt_dias_autor_quimio_w)) then 
			CALL wheb_mensagem_pck.exibir_mensagem_abort(267536,	'QT_DIAS_AUTOR_QUIMIO_W='||qt_dias_autor_quimio_w||';'|| 
									'DT_PREVISTA_CONV_W='||to_char(trunc(clock_timestamp() + qt_dias_autor_quimio_w),'dd/mm/yyyy')||';'|| 
									'DT_PREVISTA_W='||to_char(dt_prevista_p,'dd/mm/yyyy')||';');
		end if;
	end if;
end if;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consiste_dias_conv_quimio (cd_estabelecimento_p bigint, nr_seq_paciente_p bigint, dt_prevista_p timestamp) FROM PUBLIC;

