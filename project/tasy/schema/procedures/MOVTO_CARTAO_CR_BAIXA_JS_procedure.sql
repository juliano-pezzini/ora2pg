-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE movto_cartao_cr_baixa_js ( nr_sequencia_p bigint, nr_trans_financ_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint, ie_cred_nao_ident_p INOUT text, ds_erro_p INOUT text) AS $body$
DECLARE

 
nr_seq_baixa_w 		integer	 := 0;
ie_cred_nao_ident_w 	varchar(1);
ds_erro_w		varchar(100);
		

BEGIN 
 
if (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '') then 
	begin 
	select 	max(nr_sequencia) 
	into STRICT	nr_seq_baixa_w 
	from 	movto_cartao_cr_baixa 
	where 	nr_sequencia = nr_sequencia_p;
	 
	if ( nr_seq_baixa_w <> 0) then 
		begin 
		select 	max(ie_cred_nao_ident) 
		into STRICT	ie_cred_nao_ident_w 
		from 	transacao_financeira 
		where 	nr_sequencia = nr_trans_financ_p;
		 
		CALL atualiza_baixa_cartao(nr_sequencia_p, nm_usuario_p);
		 
		if (ie_cred_nao_ident_w = 'S') then 
			begin 
			ds_erro_w := obter_texto_tasy(95988, 1);
			CALL atualizar_cni_baixa_cartao(cd_estabelecimento_p, nr_sequencia_p, null, 'I');
			end;
		end if;
		end;
	end if;	
	end;
end if;
ie_cred_nao_ident_p 	:= ie_cred_nao_ident_w;
ds_erro_p 		:= ds_erro_w;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE movto_cartao_cr_baixa_js ( nr_sequencia_p bigint, nr_trans_financ_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint, ie_cred_nao_ident_p INOUT text, ds_erro_p INOUT text) FROM PUBLIC;

