-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';



CREATE TYPE colunas AS (nm_coluna_w varchar(100));


CREATE OR REPLACE PROCEDURE nut_gerar_w_nutricao_dieta (nr_atendimento_p bigint, dt_referencia_p timestamp, cd_dieta_p bigint, nr_seq_servico_p bigint, nr_seq_comp_receita_p bigint, nm_usuario_p text) AS $body$
DECLARE



/*Ordem: 
1 -> Titulos
5 -> Informações por gênero alimentício
6 -> Total G
7 -> Total Kcal
8 -> Percentual VET
*/
 
					
/* vetor */

type vetor is table of colunas index by integer;

				
/* globais */

vetor_w			vetor;
vetor1_w		vetor;
vetor2_w		vetor;
vetor3_w		vetor;
vetor4_w		vetor;
ds_item_w		varchar(2000);
ivet			integer;
ind			integer;
nr_seq_nova_w		bigint;
nr_sequencia_w		bigint;
ds_genero_w		varchar(100);
qt_componente_w		double precision;
nr_seq_nutriente_w	bigint;
nr_seq_genero_w		bigint;
ds_total_kcal_w		varchar(2000);
vl_total_kcal_w		double precision;
ds_percentual_vet_w	varchar(2000);
qt_conversao_cal_w	bigint;
nr_seq_nut_caloria_w	bigint;
ds_parametro_120_w  	varchar(1);
dt_referencia_inicio_w	timestamp;
dt_referencia_fim_w	timestamp;
		
c01 CURSOR FOR
	SELECT	ds_sigla
	from	nut_nutriente where	ie_situacao = 'A'
	order by nr_seq_apresentacao, nr_sequencia LIMIT 49;

c02 CURSOR FOR
	SELECT	nr_sequencia,
		coalesce(qt_fator_conversao_cal,0)
	from	nut_nutriente where	ie_situacao = 'A'
	order by nr_seq_apresentacao, nr_sequencia LIMIT 49;
	
C03 CURSOR FOR
	SELECT	substr(nut_obter_desc_genero_alim(d.nr_seq_gen_alim),1,40),
		d.nr_seq_gen_alim,
		substr(nut_obter_porcao_receita(d.nr_sequencia),1,50)--sum(d.qt_componente)
	from	nut_pac_opcao_rec a,
		nut_atend_serv_dia b,
		nut_receita c,
		nut_receita_comp d,
		nut_cardapio e,
		nut_cardapio_dia f
	where	a.nr_seq_servico_dia = b.nr_sequencia
	and	a.nr_seq_receita = c.nr_sequencia
	and	d.nr_seq_receita = c.nr_sequencia
	and	a.nr_seq_cardapio = e.nr_sequencia
	and	((ds_parametro_120_w ='N' and e.nr_seq_card_dia = f.nr_sequencia)
     		 or (ds_parametro_120_w = 'S' and e.nr_seq_card_dia = f.nr_sequencia and f.nr_seq_cycle > 0))
	and	b.nr_atendimento = nr_atendimento_p
	and	b.dt_servico between dt_referencia_inicio_w and dt_referencia_fim_w
	and (f.cd_dieta = cd_dieta_p or cd_dieta_p = 0 
	or exists (SELECT 1 
		from 	nut_grupo_producao_dieta x
		where	x.nr_seq_grupo_producao = f.nr_seq_grupo_producao
		and	x.cd_dieta = cd_dieta_p))
	and (f.nr_seq_servico = nr_seq_servico_p or nr_seq_servico_p = 0)
	and (e.nr_seq_comp||e.nr_seq_receita = nr_seq_comp_receita_p or nr_seq_comp_receita_p = 0)
	group by substr(nut_obter_desc_genero_alim(d.nr_seq_gen_alim),1,40),
		d.nr_seq_gen_alim, nut_obter_porcao_receita(d.nr_sequencia);
	

BEGIN

delete from W_NUTRICAO_DIETA;
ds_parametro_120_w := obter_valor_param_usuario(1003,120,obter_perfil_ativo,wheb_usuario_pck.get_nm_usuario,wheb_usuario_pck.get_cd_estabelecimento);

dt_referencia_inicio_w	:= pkg_date_utils.START_OF(dt_referencia_p,'DAY',null);
dt_referencia_fim_w := pkg_date_utils.END_OF(dt_referencia_p,'DAY',null);

ivet	:= 0;
--Pega a descrição dos nutrientes para formar o nome das colunas
begin
open	c01;
loop
fetch c01 into
	ds_item_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin
	ivet := ivet + 1;
	vetor_w[ivet].nm_coluna_w 	  := ds_item_w;
	end;
end loop;
close c01;
end;

ind := ivet;
while(ind < 50) loop
	begin
	ind := ind + 1;
	vetor_w[ind].nm_coluna_w := null;
	end;
end loop;

select	max(coalesce(nr_sequencia,0))+1
into STRICT	nr_sequencia_w
from	W_NUTRICAO_DIETA;

--Insere registro que será utilizado para formar o nome das colunas
insert into W_NUTRICAO_DIETA(
	nr_sequencia,
	nm_usuario,
	ie_ordem,
	ds_resultado_1,
	ds_resultado_2,
	ds_resultado_3,
	ds_resultado_4,
	ds_resultado_5,
	ds_resultado_6,
	ds_resultado_7,
	ds_resultado_8,
	ds_resultado_9,
	ds_resultado_10,
	ds_resultado_11,
	ds_resultado_12,
	ds_resultado_13,
	ds_resultado_14,
	ds_resultado_15,
	ds_resultado_16,
	ds_resultado_17,
	ds_resultado_18,
	ds_resultado_19,
	ds_resultado_20,
	ds_resultado_21,
	ds_resultado_22,
	ds_resultado_23,
	ds_resultado_24,
	ds_resultado_25,
	ds_resultado_26,
	ds_resultado_27,
	ds_resultado_28,
	ds_resultado_29,
	ds_resultado_30,
	ds_resultado_31,
	ds_resultado_32,
	ds_resultado_33,
	ds_resultado_34,
	ds_resultado_35,
	ds_resultado_36,
	ds_resultado_37,
	ds_resultado_38,
	ds_resultado_39,
	ds_resultado_40,
	ds_resultado_41,
	ds_resultado_42,
	ds_resultado_43,
	ds_resultado_44,
	ds_resultado_45,
	ds_resultado_46,
	ds_resultado_47,
	ds_resultado_48,
	ds_resultado_49,
	ds_resultado_50)
Values ( nr_sequencia_w,
	nm_usuario_p,
	1,
	vetor_w[1].nm_coluna_w,
	vetor_w[2].nm_coluna_w,
	vetor_w[3].nm_coluna_w,
	vetor_w[4].nm_coluna_w,
	vetor_w[5].nm_coluna_w,
	vetor_w[6].nm_coluna_w,
	vetor_w[7].nm_coluna_w,
	vetor_w[8].nm_coluna_w,
	vetor_w[9].nm_coluna_w,
	vetor_w[10].nm_coluna_w,
	vetor_w[11].nm_coluna_w,
	vetor_w[12].nm_coluna_w,
	vetor_w[13].nm_coluna_w,
	vetor_w[14].nm_coluna_w,
	vetor_w[15].nm_coluna_w,
	vetor_w[16].nm_coluna_w,
	vetor_w[17].nm_coluna_w,
	vetor_w[18].nm_coluna_w,
	vetor_w[19].nm_coluna_w,
	vetor_w[20].nm_coluna_w,
	vetor_w[21].nm_coluna_w,
	vetor_w[22].nm_coluna_w,
	vetor_w[23].nm_coluna_w,
	vetor_w[24].nm_coluna_w,
	vetor_w[25].nm_coluna_w,
	vetor_w[26].nm_coluna_w,
	vetor_w[27].nm_coluna_w,
	vetor_w[28].nm_coluna_w,
	vetor_w[29].nm_coluna_w,
	vetor_w[30].nm_coluna_w,
	vetor_w[31].nm_coluna_w,
	vetor_w[32].nm_coluna_w,
	vetor_w[33].nm_coluna_w,
	vetor_w[34].nm_coluna_w,
	vetor_w[35].nm_coluna_w,
	vetor_w[36].nm_coluna_w,
	vetor_w[37].nm_coluna_w,
	vetor_w[38].nm_coluna_w,
	vetor_w[39].nm_coluna_w,
	vetor_w[40].nm_coluna_w,
	vetor_w[41].nm_coluna_w,
	vetor_w[42].nm_coluna_w,
	vetor_w[43].nm_coluna_w,
	vetor_w[44].nm_coluna_w,
	vetor_w[45].nm_coluna_w,
	vetor_w[46].nm_coluna_w,
	vetor_w[47].nm_coluna_w,
	vetor_w[48].nm_coluna_w,
	vetor_w[49].nm_coluna_w,
	vetor_w[50].nm_coluna_w);

--Insere os valores que serão apresentados no grid
open C03;
loop
fetch C03 into	
	ds_genero_w,
	nr_seq_genero_w,
	qt_componente_w;
EXIT WHEN NOT FOUND; /* apply on C03 */
	begin
	
	select	max(coalesce(nr_sequencia,0))+1
	into STRICT	nr_seq_nova_w
	from	W_NUTRICAO_DIETA;

	insert into W_NUTRICAO_DIETA(
		nr_sequencia,
		nm_usuario,
		ie_ordem,
		ds_genero,
		qt_componente)
	Values ( nr_seq_nova_w,
		nm_usuario_p,
		5,
		ds_genero_w,
		qt_componente_w);

	ind := 0;

	open	c02;
	loop
	fetch c02 into
		nr_seq_nutriente_w,
		qt_conversao_cal_w;
	EXIT WHEN NOT FOUND; /* apply on c02 */
		begin

		ds_item_w	:= 0;
		
		select	to_char(coalesce(max((b.qt_composicao*qt_componente_w)/100),0),'99999990.00')
		INTO STRICT	ds_item_w
		from	nut_comp_nutricional b,
			nut_genero_alim c
		where	b.nr_seq_gen_alim = c.nr_sequencia
		and	b.nr_seq_nutriente = nr_seq_nutriente_w
		and	c.nr_sequencia = nr_seq_genero_w;
		
		ind := ind + 1;
		vetor1_w[ind].nm_coluna_w := ds_item_w;

		end;
	end loop;
	close c02;

	ind := ind;
	while(ind < 50) loop
		begin
		ind := ind + 1;
		vetor1_w[ind].nm_coluna_w := null;
		end;
	end loop;
	
	UPDATE 	W_NUTRICAO_DIETA
	set	ds_resultado_1	= vetor1_w[1].nm_coluna_w,
		ds_resultado_2	= vetor1_w[2].nm_coluna_w,
		ds_resultado_3	= vetor1_w[3].nm_coluna_w,
		ds_resultado_4	= vetor1_w[4].nm_coluna_w,
		ds_resultado_5	= vetor1_w[5].nm_coluna_w,
		ds_resultado_6	= vetor1_w[6].nm_coluna_w,
		ds_resultado_7	= vetor1_w[7].nm_coluna_w,
		ds_resultado_8	= vetor1_w[8].nm_coluna_w,
		ds_resultado_9	= vetor1_w[9].nm_coluna_w,
		ds_resultado_10	= vetor1_w[10].nm_coluna_w,
		ds_resultado_11	= vetor1_w[11].nm_coluna_w,
		ds_resultado_12	= vetor1_w[12].nm_coluna_w,
		ds_resultado_13	= vetor1_w[13].nm_coluna_w,
		ds_resultado_14	= vetor1_w[14].nm_coluna_w,
		ds_resultado_15	= vetor1_w[15].nm_coluna_w,
		ds_resultado_16	= vetor1_w[16].nm_coluna_w,
		ds_resultado_17	= vetor1_w[17].nm_coluna_w,
		ds_resultado_18	= vetor1_w[18].nm_coluna_w,
		ds_resultado_19	= vetor1_w[19].nm_coluna_w,
		ds_resultado_20	= vetor1_w[20].nm_coluna_w,
		ds_resultado_21	= vetor1_w[21].nm_coluna_w,
		ds_resultado_22	= vetor1_w[22].nm_coluna_w,
		ds_resultado_23	= vetor1_w[23].nm_coluna_w,
		ds_resultado_24	= vetor1_w[24].nm_coluna_w,
		ds_resultado_25	= vetor1_w[25].nm_coluna_w,
		ds_resultado_26	= vetor1_w[26].nm_coluna_w,
		ds_resultado_27	= vetor1_w[27].nm_coluna_w,
		ds_resultado_28	= vetor1_w[28].nm_coluna_w,
		ds_resultado_29	= vetor1_w[29].nm_coluna_w,
		ds_resultado_30	= vetor1_w[30].nm_coluna_w,
		ds_resultado_31	= vetor1_w[31].nm_coluna_w,
		ds_resultado_32	= vetor1_w[32].nm_coluna_w,
		ds_resultado_33	= vetor1_w[33].nm_coluna_w,
		ds_resultado_34	= vetor1_w[34].nm_coluna_w,
		ds_resultado_35	= vetor1_w[35].nm_coluna_w,
		ds_resultado_36	= vetor1_w[36].nm_coluna_w,
		ds_resultado_37	= vetor1_w[37].nm_coluna_w,
		ds_resultado_38	= vetor1_w[38].nm_coluna_w,
		ds_resultado_39	= vetor1_w[39].nm_coluna_w,
		ds_resultado_40	= vetor1_w[40].nm_coluna_w,
		ds_resultado_41	= vetor1_w[41].nm_coluna_w,
		ds_resultado_42	= vetor1_w[42].nm_coluna_w,
		ds_resultado_43	= vetor1_w[43].nm_coluna_w,
		ds_resultado_44	= vetor1_w[44].nm_coluna_w,
		ds_resultado_45	= vetor1_w[45].nm_coluna_w,
		ds_resultado_46	= vetor1_w[46].nm_coluna_w,
		ds_resultado_47	= vetor1_w[47].nm_coluna_w,
		ds_resultado_48	= vetor1_w[48].nm_coluna_w,
		ds_resultado_49	= vetor1_w[49].nm_coluna_w,
		ds_resultado_50	= vetor1_w[50].nm_coluna_w
	WHERE	NR_SEQUENCIA = nr_seq_nova_w;
	
	end;
end loop;
close C03;

--Insere os totais
ind := 0;

select	max(coalesce(qt_fator_conversao_cal,0)),
	max(nr_sequencia)
into STRICT	qt_conversao_cal_w,
	nr_seq_nut_caloria_w
from	nut_nutriente
where	ie_situacao = 'A'
and	ie_caloria = 'S';

select	sum(coalesce(((e.qt_composicao * nut_obter_porcao_receita(d.nr_sequencia))/100)*qt_conversao_cal_w,0))
into STRICT	vl_total_kcal_w
from	nut_pac_opcao_rec a,
	nut_atend_serv_dia b,
	nut_receita c,
	nut_receita_comp d,
	nut_comp_nutricional e,
	nut_genero_alim f,
	nut_cardapio g,
	nut_cardapio_dia h
where	a.nr_seq_servico_dia = b.nr_sequencia
and	a.nr_seq_receita = c.nr_sequencia
and	d.nr_seq_receita = c.nr_sequencia
and	d.nr_seq_gen_alim = f.nr_sequencia
and	e.nr_seq_gen_alim = f.nr_sequencia
and	a.nr_seq_cardapio = g.nr_sequencia
and	((ds_parametro_120_w ='N' and g.nr_seq_card_dia = h.nr_sequencia)
      	or (ds_parametro_120_w = 'S' and g.nr_seq_card_dia = h.nr_sequencia and coalesce(h.nr_seq_cycle,0)>0))
and	b.nr_atendimento = nr_atendimento_p
and	b.dt_servico between dt_referencia_inicio_w and dt_referencia_fim_w
and (h.cd_dieta = cd_dieta_p or cd_dieta_p = 0 
or exists (	SELECT 	1 
		from 	nut_grupo_producao_dieta x
		where	x.nr_seq_grupo_producao = h.nr_seq_grupo_producao
		and	x.cd_dieta = cd_dieta_p))
and (h.nr_seq_servico = nr_seq_servico_p or nr_seq_servico_p = 0)
and (g.nr_seq_comp||g.nr_seq_receita = nr_seq_comp_receita_p or nr_seq_comp_receita_p = 0)
and	e.nr_seq_nutriente = nr_seq_nut_caloria_w;

open	c02;
loop
fetch c02 into
	nr_seq_nutriente_w,
	qt_conversao_cal_w;
EXIT WHEN NOT FOUND; /* apply on c02 */
	begin

	ds_item_w	:= 0;
	
	if (vl_total_kcal_w = 0) then
		vl_total_kcal_w  := 1;
	end if;
	
	select	to_char(sum(coalesce((a.qt_composicao*qt_porcao_receita)/100,0)),'9999999990.00'),
		to_char(sum(coalesce(((a.qt_composicao*qt_porcao_receita)/100)*qt_conversao_cal_w,0)),'9999999990.00'),
		to_char(sum(coalesce(((((a.qt_composicao*qt_porcao_receita)/100)*qt_conversao_cal_w)/ vl_total_kcal_w)*100,0)),'9999999990.00')
	into STRICT	ds_item_w,
		ds_total_kcal_w,
		ds_percentual_vet_w
	from
		(SELECT DISTINCT d.nr_sequencia, e.qt_composicao, nut_obter_porcao_receita(d.nr_sequencia) qt_porcao_receita
		from	nut_pac_opcao_rec a,
			nut_atend_serv_dia b,
			nut_receita c,
			nut_receita_comp d,
			nut_comp_nutricional e,
			nut_genero_alim f,
			nut_cardapio g,
			nut_cardapio_dia h
		where	a.nr_seq_servico_dia = b.nr_sequencia
		and	a.nr_seq_receita = c.nr_sequencia
		and	d.nr_seq_receita = c.nr_sequencia
		and	d.nr_seq_gen_alim = f.nr_sequencia
		and	e.nr_seq_gen_alim = f.nr_sequencia
		and	a.nr_seq_cardapio = g.nr_sequencia
		and	((ds_parametro_120_w ='N' and g.nr_seq_card_dia = h.nr_sequencia) 
			or (ds_parametro_120_w = 'S' and g.nr_seq_card_dia = h.nr_sequencia and coalesce(h.nr_seq_cycle,0)>0))
		and	b.nr_atendimento = nr_atendimento_p
		and	b.dt_servico between dt_referencia_inicio_w and dt_referencia_fim_w
		and (h.cd_dieta = cd_dieta_p or cd_dieta_p = 0 
		or exists (	select 	1 
				from 	nut_grupo_producao_dieta x
				where	x.nr_seq_grupo_producao = h.nr_seq_grupo_producao
				and	x.cd_dieta = cd_dieta_p))
		and (h.nr_seq_servico = nr_seq_servico_p or nr_seq_servico_p = 0)
		and (g.nr_seq_comp||g.nr_seq_receita = nr_seq_comp_receita_p or nr_seq_comp_receita_p = 0)
		and	e.nr_seq_nutriente = nr_seq_nutriente_w) a;
	
	ind := ind + 1;
	vetor2_w[ind].nm_coluna_w := coalesce(ds_item_w,'0.00');
	vetor3_w[ind].nm_coluna_w := coalesce(ds_total_kcal_w,'0.00');
	vetor4_w[ind].nm_coluna_w := coalesce(ds_percentual_vet_w,'0.00');
	end;
end loop;
close c02;

ind := ind;
while(ind < 50) loop
	begin
	ind := ind + 1;
	vetor2_w[ind].nm_coluna_w := null;
	vetor3_w[ind].nm_coluna_w := null;
	vetor4_w[ind].nm_coluna_w := null;
	end;
end loop;

--Total G
select	max(coalesce(nr_sequencia,0))+1
into STRICT	nr_sequencia_w
from	W_NUTRICAO_DIETA;

insert into W_NUTRICAO_DIETA(
	nr_sequencia,
	nm_usuario,
	ie_ordem,
	ds_genero,
	qt_componente,
	ds_resultado_1,
	ds_resultado_2,
	ds_resultado_3,
	ds_resultado_4,
	ds_resultado_5,
	ds_resultado_6,
	ds_resultado_7,
	ds_resultado_8,
	ds_resultado_9,
	ds_resultado_10,
	ds_resultado_11,
	ds_resultado_12,
	ds_resultado_13,
	ds_resultado_14,
	ds_resultado_15,
	ds_resultado_16,
	ds_resultado_17,
	ds_resultado_18,
	ds_resultado_19,
	ds_resultado_20,
	ds_resultado_21,
	ds_resultado_22,
	ds_resultado_23,
	ds_resultado_24,
	ds_resultado_25,
	ds_resultado_26,
	ds_resultado_27,
	ds_resultado_28,
	ds_resultado_29,
	ds_resultado_30,
	ds_resultado_31,
	ds_resultado_32,
	ds_resultado_33,
	ds_resultado_34,
	ds_resultado_35,
	ds_resultado_36,
	ds_resultado_37,
	ds_resultado_38,
	ds_resultado_39,
	ds_resultado_40,
	ds_resultado_41,
	ds_resultado_42,
	ds_resultado_43,
	ds_resultado_44,
	ds_resultado_45,
	ds_resultado_46,
	ds_resultado_47,
	ds_resultado_48,
	ds_resultado_49,
	ds_resultado_50)
Values ( nr_sequencia_w,
	nm_usuario_p,
	6,
	'   '||wheb_mensagem_pck.get_texto(802302)||' G',
	null,--qt_componente_w,
	vetor2_w[1].nm_coluna_w,
	vetor2_w[2].nm_coluna_w,
	vetor2_w[3].nm_coluna_w,
	vetor2_w[4].nm_coluna_w,
	vetor2_w[5].nm_coluna_w,
	vetor2_w[6].nm_coluna_w,
	vetor2_w[7].nm_coluna_w,
	vetor2_w[8].nm_coluna_w,
	vetor2_w[9].nm_coluna_w,
	vetor2_w[10].nm_coluna_w,
	vetor2_w[11].nm_coluna_w,
	vetor2_w[12].nm_coluna_w,
	vetor2_w[13].nm_coluna_w,
	vetor2_w[14].nm_coluna_w,
	vetor2_w[15].nm_coluna_w,
	vetor2_w[16].nm_coluna_w,
	vetor2_w[17].nm_coluna_w,
	vetor2_w[18].nm_coluna_w,
	vetor2_w[19].nm_coluna_w,
	vetor2_w[20].nm_coluna_w,
	vetor2_w[21].nm_coluna_w,
	vetor2_w[22].nm_coluna_w,
	vetor2_w[23].nm_coluna_w,
	vetor2_w[24].nm_coluna_w,
	vetor2_w[25].nm_coluna_w,
	vetor2_w[26].nm_coluna_w,
	vetor2_w[27].nm_coluna_w,
	vetor2_w[28].nm_coluna_w,
	vetor2_w[29].nm_coluna_w,
	vetor2_w[30].nm_coluna_w,
	vetor2_w[31].nm_coluna_w,
	vetor2_w[32].nm_coluna_w,
	vetor2_w[33].nm_coluna_w,
	vetor2_w[34].nm_coluna_w,
	vetor2_w[35].nm_coluna_w,
	vetor2_w[36].nm_coluna_w,
	vetor2_w[37].nm_coluna_w,
	vetor2_w[38].nm_coluna_w,
	vetor2_w[39].nm_coluna_w,
	vetor2_w[40].nm_coluna_w,
	vetor2_w[41].nm_coluna_w,
	vetor2_w[42].nm_coluna_w,
	vetor2_w[43].nm_coluna_w,
	vetor2_w[44].nm_coluna_w,
	vetor2_w[45].nm_coluna_w,
	vetor2_w[46].nm_coluna_w,
	vetor2_w[47].nm_coluna_w,
	vetor2_w[48].nm_coluna_w,
	vetor2_w[49].nm_coluna_w,
	vetor2_w[50].nm_coluna_w);
	
--Total Kcal
select	max(coalesce(nr_sequencia,0))+1
into STRICT	nr_sequencia_w
from	W_NUTRICAO_DIETA;

insert into W_NUTRICAO_DIETA(
	nr_sequencia,
	nm_usuario,
	ie_ordem,
	ds_genero,
	qt_componente,
	ds_resultado_1,
	ds_resultado_2,
	ds_resultado_3,
	ds_resultado_4,
	ds_resultado_5,
	ds_resultado_6,
	ds_resultado_7,
	ds_resultado_8,
	ds_resultado_9,
	ds_resultado_10,
	ds_resultado_11,
	ds_resultado_12,
	ds_resultado_13,
	ds_resultado_14,
	ds_resultado_15,
	ds_resultado_16,
	ds_resultado_17,
	ds_resultado_18,
	ds_resultado_19,
	ds_resultado_20,
	ds_resultado_21,
	ds_resultado_22,
	ds_resultado_23,
	ds_resultado_24,
	ds_resultado_25,
	ds_resultado_26,
	ds_resultado_27,
	ds_resultado_28,
	ds_resultado_29,
	ds_resultado_30,
	ds_resultado_31,
	ds_resultado_32,
	ds_resultado_33,
	ds_resultado_34,
	ds_resultado_35,
	ds_resultado_36,
	ds_resultado_37,
	ds_resultado_38,
	ds_resultado_39,
	ds_resultado_40,
	ds_resultado_41,
	ds_resultado_42,
	ds_resultado_43,
	ds_resultado_44,
	ds_resultado_45,
	ds_resultado_46,
	ds_resultado_47,
	ds_resultado_48,
	ds_resultado_49,
	ds_resultado_50)
Values ( nr_sequencia_w,
	nm_usuario_p,
	7,
	'   '||wheb_mensagem_pck.get_texto(803491),
	null,
	vetor3_w[1].nm_coluna_w,
	vetor3_w[2].nm_coluna_w,
	vetor3_w[3].nm_coluna_w,
	vetor3_w[4].nm_coluna_w,
	vetor3_w[5].nm_coluna_w,
	vetor3_w[6].nm_coluna_w,
	vetor3_w[7].nm_coluna_w,
	vetor3_w[8].nm_coluna_w,
	vetor3_w[9].nm_coluna_w,
	vetor3_w[10].nm_coluna_w,
	vetor3_w[11].nm_coluna_w,
	vetor3_w[12].nm_coluna_w,
	vetor3_w[13].nm_coluna_w,
	vetor3_w[14].nm_coluna_w,
	vetor3_w[15].nm_coluna_w,
	vetor3_w[16].nm_coluna_w,
	vetor3_w[17].nm_coluna_w,
	vetor3_w[18].nm_coluna_w,
	vetor3_w[19].nm_coluna_w,
	vetor3_w[20].nm_coluna_w,
	vetor3_w[21].nm_coluna_w,
	vetor3_w[22].nm_coluna_w,
	vetor3_w[23].nm_coluna_w,
	vetor3_w[24].nm_coluna_w,
	vetor3_w[25].nm_coluna_w,
	vetor3_w[26].nm_coluna_w,
	vetor3_w[27].nm_coluna_w,
	vetor3_w[28].nm_coluna_w,
	vetor3_w[29].nm_coluna_w,
	vetor3_w[30].nm_coluna_w,
	vetor3_w[31].nm_coluna_w,
	vetor3_w[32].nm_coluna_w,
	vetor3_w[33].nm_coluna_w,
	vetor3_w[34].nm_coluna_w,
	vetor3_w[35].nm_coluna_w,
	vetor3_w[36].nm_coluna_w,
	vetor3_w[37].nm_coluna_w,
	vetor3_w[38].nm_coluna_w,
	vetor3_w[39].nm_coluna_w,
	vetor3_w[40].nm_coluna_w,
	vetor3_w[41].nm_coluna_w,
	vetor3_w[42].nm_coluna_w,
	vetor3_w[43].nm_coluna_w,
	vetor3_w[44].nm_coluna_w,
	vetor3_w[45].nm_coluna_w,
	vetor3_w[46].nm_coluna_w,
	vetor3_w[47].nm_coluna_w,
	vetor3_w[48].nm_coluna_w,
	vetor3_w[49].nm_coluna_w,
	vetor3_w[50].nm_coluna_w);

--Percentual VET
select	max(coalesce(nr_sequencia,0))+1
into STRICT	nr_sequencia_w
from	W_NUTRICAO_DIETA;

insert into W_NUTRICAO_DIETA(
	nr_sequencia,
	nm_usuario,
	ie_ordem,
	ds_genero,
	qt_componente,
	ds_resultado_1,
	ds_resultado_2,
	ds_resultado_3,
	ds_resultado_4,
	ds_resultado_5,
	ds_resultado_6,
	ds_resultado_7,
	ds_resultado_8,
	ds_resultado_9,
	ds_resultado_10,
	ds_resultado_11,
	ds_resultado_12,
	ds_resultado_13,
	ds_resultado_14,
	ds_resultado_15,
	ds_resultado_16,
	ds_resultado_17,
	ds_resultado_18,
	ds_resultado_19,
	ds_resultado_20,
	ds_resultado_21,
	ds_resultado_22,
	ds_resultado_23,
	ds_resultado_24,
	ds_resultado_25,
	ds_resultado_26,
	ds_resultado_27,
	ds_resultado_28,
	ds_resultado_29,
	ds_resultado_30,
	ds_resultado_31,
	ds_resultado_32,
	ds_resultado_33,
	ds_resultado_34,
	ds_resultado_35,
	ds_resultado_36,
	ds_resultado_37,
	ds_resultado_38,
	ds_resultado_39,
	ds_resultado_40,
	ds_resultado_41,
	ds_resultado_42,
	ds_resultado_43,
	ds_resultado_44,
	ds_resultado_45,
	ds_resultado_46,
	ds_resultado_47,
	ds_resultado_48,
	ds_resultado_49,
	ds_resultado_50)
Values ( nr_sequencia_w,
	nm_usuario_p,
	8,
	'   % VET',
	null,
	vetor4_w[1].nm_coluna_w,
	vetor4_w[2].nm_coluna_w,
	vetor4_w[3].nm_coluna_w,
	vetor4_w[4].nm_coluna_w,
	vetor4_w[5].nm_coluna_w,
	vetor4_w[6].nm_coluna_w,
	vetor4_w[7].nm_coluna_w,
	vetor4_w[8].nm_coluna_w,
	vetor4_w[9].nm_coluna_w,
	vetor4_w[10].nm_coluna_w,
	vetor4_w[11].nm_coluna_w,
	vetor4_w[12].nm_coluna_w,
	vetor4_w[13].nm_coluna_w,
	vetor4_w[14].nm_coluna_w,
	vetor4_w[15].nm_coluna_w,
	vetor4_w[16].nm_coluna_w,
	vetor4_w[17].nm_coluna_w,
	vetor4_w[18].nm_coluna_w,
	vetor4_w[19].nm_coluna_w,
	vetor4_w[20].nm_coluna_w,
	vetor4_w[21].nm_coluna_w,
	vetor4_w[22].nm_coluna_w,
	vetor4_w[23].nm_coluna_w,
	vetor4_w[24].nm_coluna_w,
	vetor4_w[25].nm_coluna_w,
	vetor4_w[26].nm_coluna_w,
	vetor4_w[27].nm_coluna_w,
	vetor4_w[28].nm_coluna_w,
	vetor4_w[29].nm_coluna_w,
	vetor4_w[30].nm_coluna_w,
	vetor4_w[31].nm_coluna_w,
	vetor4_w[32].nm_coluna_w,
	vetor4_w[33].nm_coluna_w,
	vetor4_w[34].nm_coluna_w,
	vetor4_w[35].nm_coluna_w,
	vetor4_w[36].nm_coluna_w,
	vetor4_w[37].nm_coluna_w,
	vetor4_w[38].nm_coluna_w,
	vetor4_w[39].nm_coluna_w,
	vetor4_w[40].nm_coluna_w,
	vetor4_w[41].nm_coluna_w,
	vetor4_w[42].nm_coluna_w,
	vetor4_w[43].nm_coluna_w,
	vetor4_w[44].nm_coluna_w,
	vetor4_w[45].nm_coluna_w,
	vetor4_w[46].nm_coluna_w,
	vetor4_w[47].nm_coluna_w,
	vetor4_w[48].nm_coluna_w,
	vetor4_w[49].nm_coluna_w,
	vetor4_w[50].nm_coluna_w);	
	
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE nut_gerar_w_nutricao_dieta (nr_atendimento_p bigint, dt_referencia_p timestamp, cd_dieta_p bigint, nr_seq_servico_p bigint, nr_seq_comp_receita_p bigint, nm_usuario_p text) FROM PUBLIC;

