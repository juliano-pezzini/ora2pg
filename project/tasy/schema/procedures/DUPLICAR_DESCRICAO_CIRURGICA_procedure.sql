-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_descricao_cirurgica ( nr_sequencia_p bigint, nr_cirurgia_p bigint, nr_seq_pepo_p bigint) AS $body$
DECLARE


nm_usuario_w            usuario.nm_usuario%type:= wheb_usuario_pck.get_nm_usuario;
cd_estabelecimento_w    estabelecimento.cd_estabelecimento%type:= wheb_usuario_pck.get_cd_estabelecimento;
cd_perfil_w             perfil.cd_perfil%type:= wheb_usuario_pck.get_cd_perfil;
cd_responsavel_w        pessoa_fisica.cd_pessoa_fisica%type;
nr_sequencia_w          cirurgia_descricao.nr_sequencia%type;


C01 CURSOR FOR
	SELECT	*
	from	cirurgia_descricao
	where	nr_sequencia	= nr_sequencia_p;
	
	
c01_w	c01%rowtype;

BEGIN

if (coalesce(nr_sequencia_p,0) > 0) then
   select   nextval('cirurgia_descricao_seq')
   into STRICT     nr_sequencia_w
;

   insert into cirurgia_descricao(
               nr_cirurgia,
               dt_atualizacao, 
               nm_usuario, 
               ds_diagnostico, 
               ds_resumo_cirurgia, 
               ds_diagnostico_pos, 
               ds_exame_rad, 
               ds_exame_anatomo, 
               dt_liberacao, 
               nr_sequencia, 
               cd_responsavel, 
               ie_tipo_descricao, 
               nr_seq_protocolo, 
               ds_intercorrencia, 
               ie_situacao, 
               dt_inativacao, 
               nm_usuario_inativacao, 
               ds_justificativa, 
               dt_registro, 
               nr_seq_pepo, 
               cd_perfil_ativo, 
               ds_achados_operatorios, 
               nr_seq_procedimento, 
               ds_tecnica_anestesica, 
               nr_seq_assinatura, 
               qt_caracteres_desc, 
               nr_seq_assinat_inativacao, 
               cd_doenca_cid, 
               cd_doenca_cid_pre, 
               ds_po_imediato, 
               ie_avaliador_aux, 
               dt_liberacao_aux, 
               nm_usuario_nrec, 
               dt_atualizacao_nrec, 
               cd_evolucao, 
               ds_utc, 
               ie_horario_verao, 
               ds_utc_atualizacao, 
               cd_avaliador_aux)
   SELECT      nr_cirurgia_p, 
               clock_timestamp(), 
               nm_usuario_w, 
               ds_diagnostico, 
               ds_resumo_cirurgia, 
               ds_diagnostico_pos, 
               ds_exame_rad, 
               ds_exame_anatomo, 
               null, 
               nr_sequencia_w, 
               obter_pf_usuario(nm_usuario_w,'C'), 
               ie_tipo_descricao, 
               nr_seq_protocolo, 
               ds_intercorrencia, 
               'A', 
               null, 
               null, 
               null, 
               clock_timestamp(), 
               nr_seq_pepo_p, 
               cd_perfil_w, 
               ds_achados_operatorios, 
               nr_seq_procedimento, 
               ds_tecnica_anestesica, 
               null, 
               qt_caracteres_desc, 
               null, 
               cd_doenca_cid, 
               cd_doenca_cid_pre, 
               ds_po_imediato, 
               null, 
               null, 
               nm_usuario_w, 
               clock_timestamp(), 
               null, 
               null, 
               null, 
               null, 
               null 
   from        cirurgia_descricao 
   where       nr_sequencia = nr_sequencia_p;
end if;

CALL copia_campo_long_de_para_novo(	'CIRURGIA_DESCRICAO',
				'DS_CIRURGIA',
				' where nr_sequencia = :nr_sequencia_origem_p',
				'nr_sequencia_origem_p='||nr_sequencia_p,
				'CIRURGIA_DESCRICAO',
				'DS_CIRURGIA', 
				' where nr_sequencia = :nr_sequencia_destino_p',
				'nr_sequencia_destino_p='||nr_sequencia_w,
				'L');	
				commit;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_descricao_cirurgica ( nr_sequencia_p bigint, nr_cirurgia_p bigint, nr_seq_pepo_p bigint) FROM PUBLIC;

