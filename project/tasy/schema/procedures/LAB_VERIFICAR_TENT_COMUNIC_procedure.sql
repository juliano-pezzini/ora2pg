-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE lab_verificar_tent_comunic ( nr_prescricao_p bigint, nr_seq_prescr_p bigint, ie_comunicacao_critico_p bigint, ds_resultado_p INOUT text) AS $body$
DECLARE

  cd_comunicacao_critico_w varchar(2);

BEGIN
  ds_resultado_p := 'COMUNIC_CRITICO_CORRECT';

  SELECT max(ie_comunicacao_critico)
  INTO STRICT cd_comunicacao_critico_w
  FROM prescr_procedimento pp,
    prescr_procedimento_compl ppc
  WHERE pp.nr_Seq_proc_compl                = ppc.nr_sequencia
  AND pp.nr_prescricao                      = nr_prescricao_p
  AND pp.nr_sequencia                       = nr_seq_prescr_p;

  IF coalesce(cd_comunicacao_critico_w::text, '') = '' THEN
    ds_resultado_p                         := 'NO_COMUNIC_CRITICO';
  ELSE
    IF (cd_comunicacao_critico_w)::numeric  = 3 AND ie_comunicacao_critico_p < (cd_comunicacao_critico_w)::numeric  THEN
      ds_resultado_p                         := 'COMUNIC_CRITICO_INCORRECT';
    ELSIF (cd_comunicacao_critico_w)::numeric  = 3 AND ie_comunicacao_critico_p = (cd_comunicacao_critico_w)::numeric  THEN
      ds_resultado_p                         := 'COMUNIC_CRITICO_CORRECT';
    END IF;
  END IF;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE lab_verificar_tent_comunic ( nr_prescricao_p bigint, nr_seq_prescr_p bigint, ie_comunicacao_critico_p bigint, ds_resultado_p INOUT text) FROM PUBLIC;

