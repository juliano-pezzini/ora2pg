-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE esconder_linha_cir_flowsheet (nr_sequencia_p bigint, nm_usuario_p text ) AS $body$
DECLARE


cInfo CURSOR FOR
SELECT (select max(fcg.nr_seq_config_grupo) from w_flowsheet_cirurgia_grupo fcg where fcg.nr_sequencia = fci.nr_seq_grupo) as nr_seq_config_grupo
		,nr_seq_sinal_vital ,nr_seq_superior as nr_seq_cirur_agente,ie_tipo_evolucao, nr_seq_mod_sec_agt_med,nr_seq_atend_pg        
		,ie_resumo_bh,nr_seq_result_item,nr_seq_resultado,cd_evolucao,nr_seq_tipo_bh,nr_seq_exame,nr_seq_dispositivo, nr_seq_hemod
  from w_flowsheet_cirurgia_info fci
where nr_sequencia = nr_sequencia_p;
														
w_nr_seq_conf bigint;
														
BEGIN

select max(nr_seq_conf_info)
  into STRICT w_nr_seq_conf
 from w_flowsheet_cirurgia_info
 where nr_sequencia = nr_sequencia_p;

if (w_nr_seq_conf IS NOT NULL AND w_nr_seq_conf::text <> '') then
	
update w_flowsheet_config_info set ie_visivel = 'N' where nr_sequencia = w_nr_seq_conf;
update w_flowsheet_cirurgia_info set ie_visivel = 'N' where nr_sequencia = nr_sequencia_p;

else 

	for r1 in cInfo loop
	insert into w_flowsheet_config_info(
		nr_sequencia           
		,dt_atualizacao         
		,nm_usuario             
		,dt_atualizacao_nrec    
		,nm_usuario_nrec        
		,nr_seq_config_grupo    
		,nr_seq_sinal_vital     
		,nr_seq_cirur_agente    
		,ie_visivel             
		,ie_tipo_evolucao       
		,nr_seq_mod_sec_agt_med 
		,nr_seq_atend_pg        
		,ie_resumo_bh           
		,nr_seq_result_item     
		,nr_seq_resultado       
		,cd_evolucao            
		,nr_seq_tipo_bh
		,nr_seq_exame
		,nr_seq_dispositivo
		,nr_seq_hemod)  values (nextval('w_flowsheet_config_info_seq')         
		,clock_timestamp()         
		,nm_usuario_p             
		,clock_timestamp()    
		,nm_usuario_p        
		,r1.nr_seq_config_grupo   
		,r1.nr_seq_sinal_vital     
		,r1.nr_seq_cirur_agente 
		,'N'             
		,r1.ie_tipo_evolucao       
		,r1.nr_seq_mod_sec_agt_med 
		,r1.nr_seq_atend_pg        
		,r1.ie_resumo_bh           
		,r1.nr_seq_result_item     
		,r1.nr_seq_resultado       
		,r1.cd_evolucao            
		,r1.nr_seq_tipo_bh
		,r1.nr_seq_exame
		,r1.nr_seq_dispositivo
		,r1.nr_seq_hemod) returning nr_sequencia into w_nr_seq_conf;

		update w_flowsheet_cirurgia_info 
		   set ie_visivel = 'N',  
			   nr_seq_conf_info = w_nr_seq_conf
		 where nr_sequencia = nr_sequencia_p;
	end loop;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE esconder_linha_cir_flowsheet (nr_sequencia_p bigint, nm_usuario_p text ) FROM PUBLIC;

