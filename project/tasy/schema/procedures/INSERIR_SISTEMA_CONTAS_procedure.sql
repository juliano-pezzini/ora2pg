-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_sistema_contas (nr_seq_cliente_p bigint, nr_seq_sistema_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_seq_cliente_vinculo_w		bigint;
nr_seq_sis_ant_w			bigint;

C01 CURSOR FOR
SELECT 	nr_seq_cliente_vinculo
from	com_cliente_vinculo
where 	nr_seq_cliente = nr_seq_cliente_p;


BEGIN

if (nr_seq_sistema_p IS NOT NULL AND nr_seq_sistema_p::text <> '') then
	open C01;
	loop
	fetch C01 into
		nr_seq_cliente_vinculo_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */
		begin

		select 	nextval('com_fornec_sistema_ant_seq')
		into STRICT	nr_seq_sis_ant_w
		;

		insert into com_fornec_sistema_ant(	nr_sequencia,
							nr_seq_cliente,
							dt_atualizacao,
							nm_usuario,
							dt_atualizacao_nrec,
							nm_usuario_nrec,
							cd_cnpj,
							nr_seq_prod_conc,
							ie_sit_sist_conc)
						SELECT	nr_seq_sis_ant_w,
							nr_seq_cliente_vinculo_w,
							clock_timestamp(),
							nm_usuario_p,
							clock_timestamp(),
							nm_usuario_p,
							cd_cnpj,
							nr_seq_prod_conc,
							ie_sit_sist_conc
						from	com_fornec_sistema_ant
						where	nr_seq_cliente = nr_seq_cliente_p;
		end;
	end loop;
	close C01;

end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_sistema_contas (nr_seq_cliente_p bigint, nr_seq_sistema_p bigint, nm_usuario_p text) FROM PUBLIC;

