-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consistir_carga (cd_estabelecimento_p bigint, cd_tabela_custo_p bigint, cd_centro_controle_p bigint, cd_natureza_gasto_p bigint, nr_seq_tabela_p bigint, ds_erro_p INOUT text, nr_erro_consistir_P INOUT bigint) AS $body$
DECLARE



cd_centro_controle_w	integer;
cd_centro_controle_ww	integer;
cd_natureza_gasto_w	numeric(20);
cd_empresa_w		bigint;


BEGIN

cd_empresa_w		:= obter_empresa_estab(cd_estabelecimento_p);
ds_erro_p 		:= '';
nr_erro_consistir_p 	:= 0;

Select	coalesce(max(cd_centro_controle),0)
into STRICT	cd_centro_controle_w
from	orcamento_custo
where	nr_seq_tabela		= nr_seq_tabela_p
and	cd_centro_controle	= cd_centro_controle_p
and	cd_natureza_gasto	= cd_natureza_gasto_p;


if (cd_centro_controle_w = 0) then
	begin

	Select	coalesce(max(cd_centro_controle),0)
	into STRICT	cd_centro_controle_ww
	from	centro_controle
	where	cd_estabelecimento = cd_estabelecimento_p
	  and	cd_centro_controle = cd_centro_controle_p;

	if (cd_centro_controle_ww = 0) then
		begin
        	ds_erro_p := wheb_mensagem_pck.get_texto(193030, 'CD_CENTRO_CONTROLE_P=' || cd_centro_controle_p);
		nr_erro_consistir_p := 1;
		end;
	end if;

	Select	coalesce(max(cd_natureza_gasto),0)
	into STRICT	cd_natureza_gasto_w
	from	natureza_gasto
	where	coalesce(cd_estabelecimento, cd_estabelecimento_p) = cd_estabelecimento_p
	and	cd_natureza_gasto	= cd_natureza_gasto_p
	and	cd_empresa		= cd_empresa_w;

	if (cd_natureza_gasto_w = 0) then
		begin
		ds_erro_p := ds_erro_p || wheb_mensagem_pck.get_texto(193031, 'CD_NATUREZA_GASTO_P=' || cd_natureza_gasto_p);
		nr_erro_consistir_p := 1;
		end;
	end if;

	end;
end if;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consistir_carga (cd_estabelecimento_p bigint, cd_tabela_custo_p bigint, cd_centro_controle_p bigint, cd_natureza_gasto_p bigint, nr_seq_tabela_p bigint, ds_erro_p INOUT text, nr_erro_consistir_P INOUT bigint) FROM PUBLIC;

