-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE rec_resp_envio_was_wase_solic ( nr_solic_compra_p bigint, ie_status_retorno_p text, ds_retorno_p text, nm_usuario_p text) AS $body$
BEGIN
 
if (ie_status_retorno_p = '1') then 
 
	update	solic_compra 
	set	ie_status_envio	= 'O' 
	where	nr_solic_compra	= nr_solic_compra_p;
 
	insert into cot_compra_log_integracao( 
		nr_sequencia, 
		dt_atualizacao, 
		nm_usuario, 
		dt_atualizacao_nrec, 
		nm_usuario_nrec, 
		nr_solic_compra, 
		ie_status_envio, 
		ie_tipo_integracao, 
		ds_log) 
	values (	nextval('cot_compra_log_integracao_seq'), 
		clock_timestamp(), 
		nm_usuario_p, 
		clock_timestamp(), 
		nm_usuario_p, 
		nr_solic_compra_p, 
		'OS', 
		'S', 
		Wheb_mensagem_pck.get_Texto(306748, 'DS_RETORNO_P='|| DS_RETORNO_P));
		/*A solicitação foi integrada corretamente, e gerou o pedido número #@DS_RETORNO_P#@ no ambiente a qual está integrada.*/
 
 
			 
	update	solic_compra_fila_transm 
	set	ie_evento = 'R' 
	where	nr_solic_compra = nr_solic_compra_p 
	and	ie_evento = 'EN';
	 
else 
 
	update	solic_compra 
	set	ie_status_envio	= 'E' 
	where	nr_solic_compra	= nr_solic_compra_p;
 
	insert into cot_compra_log_integracao( 
		nr_sequencia, 
		dt_atualizacao, 
		nm_usuario, 
		dt_atualizacao_nrec, 
		nm_usuario_nrec, 
		nr_solic_compra, 
		ie_status_envio, 
		ie_tipo_integracao, 
		ds_log) 
	values (	nextval('cot_compra_log_integracao_seq'), 
		clock_timestamp(), 
		nm_usuario_p, 
		clock_timestamp(), 
		nm_usuario_p, 
		nr_solic_compra_p, 
		'ES', 
		'S', 
		Wheb_mensagem_pck.get_Texto(306750, 'DS_RETORNO_P='|| DS_RETORNO_P));
		/*A solicitação foi enviada, porém não foi integrada porque retornou o seguinte erro: #@DS_RETORNO_P#@*/
 
 
	 
	update	solic_compra_fila_transm 
	set	ie_evento = 'R' 
	where	nr_solic_compra = nr_solic_compra_p 
	and	ie_evento = 'EN';
 
end if;	
		 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE rec_resp_envio_was_wase_solic ( nr_solic_compra_p bigint, ie_status_retorno_p text, ds_retorno_p text, nm_usuario_p text) FROM PUBLIC;

