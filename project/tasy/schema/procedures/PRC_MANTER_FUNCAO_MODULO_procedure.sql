-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE prc_manter_funcao_modulo (CD_FUNCAO_P bigint, NR_SEQ_AREA_MODULO_P bigint, NM_USUARIO_P text, ACTION_P text) AS $body$
BEGIN

  IF ACTION_P = 'I' THEN

    INSERT INTO MKT_MODULO_FUNCAO(
      NR_SEQUENCIA,
      DT_ATUALIZACAO,
      NM_USUARIO,
      DT_ATUALIZACAO_NREC,
      NM_USUARIO_NREC,
      CD_FUNCAO,
      NR_SEQ_AREA_MODULO
    ) VALUES (
      nextval('mkt_modulo_funcao_seq'),
      clock_timestamp(),
      NM_USUARIO_P,
      clock_timestamp(),
      NM_USUARIO_P,
      CD_FUNCAO_P,
      NR_SEQ_AREA_MODULO_P
      );

  END IF;

  IF ACTION_P = 'D' THEN

    DELETE FROM MKT_FUNCAO_MERCADO
    WHERE nr_seq_mod_fun IN (SELECT nr_sequencia FROM MKT_MODULO_FUNCAO
                             WHERE nr_seq_area_modulo = NR_SEQ_AREA_MODULO_P AND cd_funcao = CD_FUNCAO_P);

    DELETE FROM MKT_MODULO_FUNCAO
    WHERE CD_FUNCAO = CD_FUNCAO_P
    AND NR_SEQ_AREA_MODULO = NR_SEQ_AREA_MODULO_P;

  END IF;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE prc_manter_funcao_modulo (CD_FUNCAO_P bigint, NR_SEQ_AREA_MODULO_P bigint, NM_USUARIO_P text, ACTION_P text) FROM PUBLIC;

