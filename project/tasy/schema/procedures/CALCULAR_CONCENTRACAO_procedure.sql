-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE calcular_concentracao ( cd_material_p bigint, cd_reconstituinte_p bigint, qt_reconstituinte_p bigint, cd_unid_med_reconst_p text, qt_concentracao_p INOUT bigint, cd_unid_med_base_p INOUT text, cd_unid_med_cons_p INOUT text) AS $body$
DECLARE



cd_unid_med_concentracao_w	varchar(30);
cd_unid_med_base_conc_w		varchar(30);
qt_conversao_mg_w		double precision;
cd_material_w			integer;
qt_conv_ww			double precision;
qt_conv_w			double precision;
qt_conv_ml_w			double precision;
qt_conv_mg_w			double precision;


BEGIN

select	cd_material,
	cd_unid_med_concetracao,
	cd_unid_med_base_conc,
	qt_conversao_mg
into STRICT	cd_material_w,
	cd_unid_med_concentracao_w,
	cd_unid_med_base_conc_w,
	qt_conversao_mg_w
from	material
where	cd_material	= cd_material_p;

qt_conv_w    := obter_conversao_ml(cd_material_w, obter_conversao_unid_med(cd_material_w, cd_unid_med_base_conc_w), cd_unid_med_base_conc_w);

/*conv para ml do diluente*/

qt_conv_ww	:= obter_conversao_ml(cd_reconstituinte_p, qt_reconstituinte_p, cd_unid_med_reconst_p);

qt_conv_mg_w	:= obter_conversao_unid_med(cd_material_w,obter_unid_med_usua('mg'));
qt_conv_ml_w	:= obter_conversao_unid_med(cd_material_w,obter_unid_med_usua('ml'));

cd_unid_med_base_p	:= cd_unid_med_base_conc_w;
cd_unid_med_cons_p	:= cd_unid_med_concentracao_w;

begin
qt_concentracao_p := Dividir(qt_conv_mg_w,  qt_conv_ww + qt_conv_ml_w);
exception when others then
qt_concentracao_p := null;
end;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE calcular_concentracao ( cd_material_p bigint, cd_reconstituinte_p bigint, qt_reconstituinte_p bigint, cd_unid_med_reconst_p text, qt_concentracao_p INOUT bigint, cd_unid_med_base_p INOUT text, cd_unid_med_cons_p INOUT text) FROM PUBLIC;

