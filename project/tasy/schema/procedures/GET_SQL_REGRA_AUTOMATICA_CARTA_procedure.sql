-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE get_sql_regra_automatica_carta ( SQLItensInserir_p INOUT text, ie_secao_p text, ie_todos_p text, ie_atendimento_p text, ds_texto_p text) AS $body$
DECLARE


get_texto_conteudo_w						text;
const_tempos_movimentos_w					constant varchar(3) := 'STM'; --	Tempos e Movimentos
const_tempos_cirurgicos_w					constant varchar(3) := 'STC'; --	Tempos Cirurgicos
const_participantes_w						constant varchar(3) := 'SP'; --	Participantes
const_tecnica_w								constant varchar(3) := 'ST'; --	Tecnica
const_equipamentos_w						constant varchar(3) := 'SE'; --	Equipamentos
const_dispositivos_w						constant varchar(3) := 'SDI'; --	Dispositivos
const_descricao_w							constant varchar(3) := 'SD'; --	Descrição	
			

BEGIN

if (const_tempos_movimentos_w = ie_secao_p) then
	get_texto_conteudo_w := get_text_conteudo(ie_secao_p, get_texto_conteudo_w, 'S');

	SQLItensInserir_p := 	'	select	a.NR_SEQUENCIA, '||
						'			a.DT_INICIO_EVENTO, '||
						get_texto_conteudo_w	||
						'      		,0 nr_seq_result, '||
						'      		0 nr_seq_result_item '||
						'	from	EVENTO_CIRURGIA_PACIENTE a '||
						' 	where 	1 = 1' ||
						' 	and 	nr_cirurgia = :nr_cirurgia_p ' || 
						'	and		a.DT_LIBERACAO is not null ' ||
						'	and		a.DT_INATIVACAO is null ' ||
						' 	and		a.DT_REGISTRO between :dt_inicial and sysdate '||
						'	order by a.DT_REGISTRO desc ';

elsif (const_tempos_cirurgicos_w = ie_secao_p) then

	get_texto_conteudo_w := get_text_conteudo(ie_secao_p, get_texto_conteudo_w, 'S');

	SQLItensInserir_p := 	'	select	a.NR_SEQUENCIA, '||
						'			a.DT_INICIO, '||
						get_texto_conteudo_w	||
						'      		,0 nr_seq_result, '||
						'      		0 nr_seq_result_item '||
						'	from	TEMPO_CIRURGICO_CIRURGIA a '||
						' 	where 	1 = 1' ||
						' 	and 	nr_cirurgia = :nr_cirurgia_p '||
						' 	and		a.DT_INICIO between :dt_inicial and sysdate '||
						'	order by a.DT_INICIO desc ';
						
elsif (const_participantes_w = ie_secao_p) then

	get_texto_conteudo_w := get_text_conteudo(ie_secao_p, get_texto_conteudo_w, 'S');

	SQLItensInserir_p := 	'	select	a.NR_SEQUENCIA, '||
						'			a.DT_ENTRADA, '||
						get_texto_conteudo_w	||
						'      		,0 nr_seq_result, '||
						'      		0 nr_seq_result_item '||
						'	from	CIRURGIA_PARTICIPANTE a '||
						' 	where 	1 = 1' ||
						' 	and 	nr_cirurgia = :nr_cirurgia_p ' || 
						'	and		a.DT_LIBERACAO is not null ' ||
						'	and		a.DT_INATIVACAO is null '||
						' 	and		a.DT_LIBERACAO between :dt_inicial and sysdate '||
						'	order by a.DT_LIBERACAO desc ';

elsif (const_tecnica_w = ie_secao_p) then

	get_texto_conteudo_w := get_text_conteudo(ie_secao_p, get_texto_conteudo_w, 'S');

	SQLItensInserir_p := 	'	select	a.NR_SEQUENCIA, '||
						'			a.DT_INICIO, '||
						get_texto_conteudo_w	||
						'      		,0 nr_seq_result, '||
						'      		0 nr_seq_result_item '||
						'	from	CIRURGIA_TEC_ANESTESICA a '||
						' 	where 	1 = 1' ||
						' 	and 	nr_cirurgia = :nr_cirurgia_p ' || 
						'	and		a.DT_LIBERACAO is not null ' ||
						'	and		a.DT_INATIVACAO is null '||
						' 	and		a.DT_INICIO between :dt_inicial and sysdate '||
						'	order by a.DT_INICIO desc ';
						
elsif (const_descricao_w = ie_secao_p) then

	SQLItensInserir_p := 	'	select	a.NR_SEQUENCIA, '||
						'			a.DT_LIBERACAO, '||
						chr(39)|| ' ' ||chr(39)||
						'      	ds	,0 nr_seq_result, '||
						'      		0 nr_seq_result_item '||
						'	from	ANESTESIA_DESCRICAO a '||
						' 	where 	1 = 1' ||
						' 	and 	nr_cirurgia = :nr_cirurgia_p ' || 
						'	and		a.DT_LIBERACAO is not null ' ||
						'	and		a.DT_INATIVACAO is null '||
						' 	and		a.DT_LIBERACAO between :dt_inicial and sysdate '||
						'	order by a.DT_LIBERACAO desc ';

elsif (const_dispositivos_w = ie_secao_p) then

	get_texto_conteudo_w := get_text_conteudo(ie_secao_p, get_texto_conteudo_w, 'S');

	SQLItensInserir_p := 	'	select	a.NR_SEQUENCIA, '||
						'			a.DT_INSTALACAO, '||
						get_texto_conteudo_w	||
						'      		,0 nr_seq_result, '||
						'      		0 nr_seq_result_item '||
						'	from	ATEND_PAC_DISPOSITIVO a '||
						' 	where 	1 = 1' ||
						' 	and 	nr_cirurgia = :nr_cirurgia_p ' || 
						'	and		a.DT_INSTALACAO is not null '||
						' 	and		a.DT_INSTALACAO between :dt_inicial and sysdate '||
						'	order by a.DT_INSTALACAO desc ';
elsif (const_equipamentos_w = ie_secao_p) then

	get_texto_conteudo_w := get_text_conteudo(ie_secao_p, get_texto_conteudo_w, 'S');

	SQLItensInserir_p := 	'	select	a.NR_SEQUENCIA, '||
						'			a.DT_LIBERACAO, '||
						get_texto_conteudo_w	||
						'      		,0 nr_seq_result, '||
						'      		0 nr_seq_result_item '||
						'	from	EQUIPAMENTO_CIRURGIA a '||
						' 	where 	1 = 1' ||
						' 	and 	nr_cirurgia = :nr_cirurgia_p ' || 
						'	and		a.DT_LIBERACAO is not null ' ||
						'	and		a.DT_INATIVACAO is null '||
						' 	and		a.DT_LIBERACAO between :dt_inicial and sysdate '||
						'	order by a.DT_LIBERACAO desc ';
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE get_sql_regra_automatica_carta ( SQLItensInserir_p INOUT text, ie_secao_p text, ie_todos_p text, ie_atendimento_p text, ds_texto_p text) FROM PUBLIC;

