-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_ativ_prev_ordem_serv ( nr_seq_ordem_p bigint, dt_prevista_p text, nm_usuario_previsto_p text, ds_atividade_prevista_p text, ds_setor_usuario_p text, ds_estagio_wheb_p text, nm_analista_resp_p text, nm_gerente_resp_p text) AS $body$
DECLARE

qt_registros_w	integer;

BEGIN
if (nr_seq_ordem_p IS NOT NULL AND nr_seq_ordem_p::text <> '')
	and (nm_usuario_previsto_p <> '')
	and (ds_atividade_prevista_p <> '')
	and (dt_prevista_p <> '')
	and (ds_setor_usuario_p <> '') then
	select 	count(*)
	into STRICT	qt_registros_w
	from 	man_os_ativ_prev_wheb
	where 	nr_seq_ordem_serv = nr_seq_ordem_p
	and 	dt_prevista = to_date(dt_prevista_p)
	and 	nm_usuario_previsto = nm_usuario_previsto_p;
	if (qt_registros_w = 0) then
		insert into man_os_ativ_prev_wheb(
			nr_sequencia,
			nr_seq_ordem_serv,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nm_usuario_previsto,
			ds_atividade_prevista,
			dt_prevista,
			ds_setor_usuario,
			ds_estagio_wheb,
			nm_analista_resp,
			nm_gerente_resp)
		values (
			nextval('man_os_ativ_prev_wheb_seq'),
			nr_seq_ordem_p,
			clock_timestamp(),
			'WebService',
			clock_timestamp(),
			'WebService',
			nm_usuario_previsto_p,
			ds_atividade_prevista_p,
			to_date(dt_prevista_p),
			ds_setor_usuario_p,
			ds_estagio_wheb_p,
			nm_analista_resp_p,
			nm_gerente_resp_p);
		commit;
	end if;
end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_ativ_prev_ordem_serv ( nr_seq_ordem_p bigint, dt_prevista_p text, nm_usuario_previsto_p text, ds_atividade_prevista_p text, ds_setor_usuario_p text, ds_estagio_wheb_p text, nm_analista_resp_p text, nm_gerente_resp_p text) FROM PUBLIC;

