-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_alim_campos_ocor_val_97 () AS $body$
DECLARE

 
tb_nr_sequencia_w	pls_util_cta_pck.t_number_table;
qt_registro_w		integer;

C01 CURSOR FOR 
	SELECT	nr_sequencia 
	from	pls_oc_cta_val_prest_dif;


BEGIN 
-- baca criado para alimentar os valores padrões da validação e no fim alterar para not null 
open C01;
loop 
	fetch C01 bulk collect into tb_nr_sequencia_w 
	limit pls_util_pck.qt_registro_transacao_w;
	exit when tb_nr_sequencia_w.count = 0;
 
	forall	i in tb_nr_sequencia_w.first..tb_nr_sequencia_w.last 
		update	pls_oc_cta_val_prest_dif 
		set	ie_comparacao = coalesce(ie_comparacao, 'D'), -- estes são os valores padrões e que existiam até então 
			ie_campo = coalesce(ie_campo, 'S') 
		where 	nr_sequencia = tb_nr_sequencia_w(i);
	commit;
end loop;
close C01;
 
select	sum(qt) 
into STRICT	qt_registro_w 
from ( 
	SELECT	count(1) qt 
	from	pls_oc_cta_val_prest_dif 
	where	coalesce(ie_comparacao::text, '') = '' 
	
union all
 
	SELECT	count(1) qt 
	from	pls_oc_cta_val_prest_dif 
	where	coalesce(ie_campo::text, '') = '' 
) alias5;
 
if (qt_registro_w > 0) then 
 
	update	pls_oc_cta_val_prest_dif 
	set	ie_comparacao = coalesce(ie_comparacao, 'D'), -- estes são os valores padrões e que existiam até então 
		ie_campo = coalesce(ie_campo, 'S');
 
	commit;
end if;
begin 
	select	count(1) 
	into STRICT	qt_registro_w 
	from	user_tab_columns 
	where	table_name 	= 'PLS_OC_CTA_VAL_PREST_DIF' 
	and	nullable 	= 'Y' 
	and	column_name	= 'IE_COMPARACAO';
 
	if (qt_registro_w > 0) then 
		CALL exec_sql_dinamico('BACA', 'alter table PLS_OC_CTA_VAL_PREST_DIF modify IE_COMPARACAO not null');
	end if;
 
	select	count(1) 
	into STRICT	qt_registro_w 
	from	user_tab_columns 
	where	table_name 	= 'PLS_OC_CTA_VAL_PREST_DIF' 
	and	nullable 	= 'Y' 
	and	column_name	= 'IE_CAMPO';
 
	if (qt_registro_w > 0) then 
		CALL exec_sql_dinamico('BACA', 'alter table PLS_OC_CTA_VAL_PREST_DIF modify IE_CAMPO not null');
	end if;
exception 
when others then 
	commit;
end;
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_alim_campos_ocor_val_97 () FROM PUBLIC;

