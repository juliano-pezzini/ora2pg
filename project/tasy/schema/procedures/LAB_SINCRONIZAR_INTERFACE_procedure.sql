-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE lab_sincronizar_interface ( cd_interface_envio_p bigint, cd_interface_retorno_p bigint ) AS $body$
DECLARE


ds_retorno_p	varchar(255);
ds_comando_w	varchar(2000);
C01	  	integer;
retorno_w	integer;
conta_regist_w	bigint;


BEGIN

ds_comando_w :=	'select	count(*)	' ||
		'from	tasy_versao.interface ' ||
		'where	cd_interface = ' || cd_interface_envio_p;

C01 := DBMS_SQL.OPEN_CURSOR;
DBMS_SQL.PARSE(C01, ds_comando_w, dbms_sql.Native);
DBMS_SQL.DEFINE_COLUMN(C01, 1, conta_regist_w);

retorno_w := DBMS_SQL.EXECUTE_AND_FETCH(C01, false);
DBMS_SQL.COLUMN_VALUE(C01, 1, conta_regist_w);

if (conta_regist_w > 0) then

	begin
		-- interface de envio
		delete from interface_atributo where cd_interface in (cd_interface_envio_p);
		delete from interface_reg where cd_interface in (cd_interface_envio_p);
		delete from interface where cd_interface in (cd_interface_envio_p);

		CALL exec_sql_dinamico_bv('Tasy', 'insert into interface select * from tasy_versao.interface where cd_interface in (:cd_interface_envio_p)', 'cd_interface_envio_p=' || cd_interface_envio_p);
		CALL exec_sql_dinamico_bv('Tasy', 'insert into interface_reg select * from tasy_versao.interface_reg where cd_interface in(:cd_interface_envio_p)', 'cd_interface_envio_p=' || cd_interface_envio_p);
		CALL exec_sql_dinamico_bv('Tasy', 'insert into interface_atributo select * from tasy_versao.interface_atributo where cd_interface in (:cd_interface_envio_p)', 'cd_interface_envio_p=' || cd_interface_envio_p);

		-- interface de retorno
		delete from interface_atributo where cd_interface in (cd_interface_retorno_p);
		delete from interface_reg where cd_interface in (cd_interface_retorno_p);
		delete from interface where cd_interface in (cd_interface_retorno_p);

		CALL exec_sql_dinamico_bv('Tasy', 'insert into interface select * from tasy_versao.interface where cd_interface in (:cd_interface_retorno_p)', 'cd_interface_retorno_p=' || cd_interface_retorno_p);
		CALL exec_sql_dinamico_bv('Tasy', 'insert into interface_reg select * from tasy_versao.interface_reg where cd_interface in(:cd_interface_retorno_p)', 'cd_interface_retorno_p=' || cd_interface_retorno_p);
		CALL exec_sql_dinamico_bv('Tasy', 'insert into interface_atributo select * from tasy_versao.interface_atributo where cd_interface in (:cd_interface_retorno_p)', 'cd_interface_retorno_p=' || cd_interface_retorno_p);

	exception
	when others then
		rollback;
		CALL gravar_log_lab(99700, WHEB_MENSAGEM_PCK.get_texto(454838) || chr(13) || chr(10) || sqlerrm, 'Tasy');
	end;

	commit;

end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE lab_sincronizar_interface ( cd_interface_envio_p bigint, cd_interface_retorno_p bigint ) FROM PUBLIC;

