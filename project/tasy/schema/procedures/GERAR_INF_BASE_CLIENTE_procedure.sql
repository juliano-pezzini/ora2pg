-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_inf_base_cliente (nr_seq_log_integracao_p INOUT bigint) AS $body$
DECLARE


ie_status_w varchar(1);

nr_seq_log_w	varchar(255);


BEGIN
	/*Verifica se já foi enviado o XML*/

	select 	coalesce(max(nr_sequencia),0),
		coalesce(max(ie_status),'G')
	into STRICT	nr_seq_log_integracao_p,
		ie_status_w
	from	log_integracao
	where	trunc(dt_atualizacao) = trunc(clock_timestamp())
	and	nr_seq_informacao = 1;

	/*Se não foi enviado gera novamente o xml*/

	if ( ie_status_w = 'G' ) then
		nr_seq_log_w := gravar_log_integracao('Tasy', 5, '', 'S', 'S', nr_seq_log_w);
		nr_seq_log_integracao_p := (nr_seq_log_w)::numeric;
	elsif ( ie_status_w = 'S') then
		/*retorno 0 para identificar que já foi enviado XML*/

		nr_seq_log_integracao_p := 0;
	end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_inf_base_cliente (nr_seq_log_integracao_p INOUT bigint) FROM PUBLIC;

