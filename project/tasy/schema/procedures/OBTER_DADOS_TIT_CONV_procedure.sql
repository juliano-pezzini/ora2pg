-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_dados_tit_conv ( nr_sequencia_p bigint, cd_convenio_p INOUT bigint, cd_categoria_p INOUT text, cd_plano_p INOUT text, dt_val_carteira_p INOUT timestamp, cd_usuario_conv_p INOUT text, cd_empresa_refer_p INOUT text, nm_usuario_p text) AS $body$
DECLARE


ds_erro_w		varchar(255);
cd_convenio_w		pessoa_titular_convenio.cd_convenio%type;
cd_categoria_w		pessoa_titular_convenio.cd_categoria%type;
cd_plano_w		pessoa_titular_convenio.cd_plano_convenio%type;
dt_val_carteira_w		pessoa_titular_convenio.dt_validade_carteira%type;
cd_usuario_convenio_w 	varchar(30);
cd_empresa_refer_w	pessoa_titular_convenio.cd_empresa_refer%type;



BEGIN

if (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '')then
	begin

	select	max(cd_convenio),
		max(cd_categoria),
		max(cd_plano_convenio),
		max(dt_validade_carteira),
		max(coalesce(cd_usuario_convenio,cd_usuario_convenio_tit)),
		max(cd_empresa_refer)
	into STRICT	cd_convenio_w,
		cd_categoria_w,
		cd_plano_w,
		dt_val_carteira_w,
		cd_usuario_convenio_w,
		cd_empresa_refer_w
	from	pessoa_titular_convenio
	where	nr_sequencia = nr_sequencia_p;

	exception
	when others then
		ds_erro_w := '';
	end;
end if;

if (cd_convenio_w IS NOT NULL AND cd_convenio_w::text <> '')then
	cd_convenio_p	:= cd_convenio_w;
end if;

if (cd_categoria_w IS NOT NULL AND cd_categoria_w::text <> '')then
	cd_categoria_p	:= cd_categoria_w;
end if;

if (cd_plano_w IS NOT NULL AND cd_plano_w::text <> '')then
	cd_plano_p	:= cd_plano_w;
end if;

if (dt_val_carteira_w IS NOT NULL AND dt_val_carteira_w::text <> '')then
	dt_val_carteira_p	:= dt_val_carteira_w;
end if;

if (cd_usuario_convenio_w IS NOT NULL AND cd_usuario_convenio_w::text <> '')then
	cd_usuario_conv_p	:= cd_usuario_convenio_w;
end if;

if (cd_empresa_refer_w IS NOT NULL AND cd_empresa_refer_w::text <> '') then
	cd_empresa_refer_p	:= cd_empresa_refer_w;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_dados_tit_conv ( nr_sequencia_p bigint, cd_convenio_p INOUT bigint, cd_categoria_p INOUT text, cd_plano_p INOUT text, dt_val_carteira_p INOUT timestamp, cd_usuario_conv_p INOUT text, cd_empresa_refer_p INOUT text, nm_usuario_p text) FROM PUBLIC;

