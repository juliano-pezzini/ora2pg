-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE fin_comunic_comercial ( nr_sequencia_p bigint, nm_usuario_p text) AS $body$
DECLARE


c001		integer;
retorno_w		integer;

ds_historico_w	varchar(255) := 'Cliente com pendência financeira!';
dt_atualizacao_w	timestamp := clock_timestamp();
dt_historico_w	timestamp := clock_timestamp();
nr_sequencia_w	bigint;
nr_seq_cliente_w	bigint;
nr_seq_tipo_w	bigint := 36; -- informação financeira
nr_seq_ativ_w	bigint := 54; -- Financeiro
nr_seq_classif_w	bigint := 4; -- Informações confidenciais do cliente
c01 CURSOR FOR
SELECT	distinct
	a.nr_seq_cliente
from	fin_titulo_lote_clie a
where	a.nr_lote_cliente = nr_sequencia_p;


BEGIN
select	nextval('com_cliente_hist_seq')
into STRICT	nr_sequencia_w
;

open C01;
loop
fetch C01 into
	nr_seq_cliente_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin
	c001 := dbms_sql.open_cursor;
	dbms_sql.parse(c001,'	INSERT INTO COM_CLIENTE_HIST (NR_SEQUENCIA,DS_HISTORICO,DT_ATUALIZACAO,DT_HISTORICO,NM_USUARIO,NR_SEQ_CLIENTE,NR_SEQ_TIPO,NR_SEQ_ATIV,NR_SEQ_CLASSIF)
				VALUES (NR_SEQUENCIA_W,DS_HISTORICO_W,DT_ATUALIZACAO_W,DT_HISTORICO_W,NM_USUARIO_P,NR_SEQ_CLIENTE_W,NR_SEQ_TIPO_W,NR_SEQ_ATIV_W,NR_SEQ_CLASSIF_W) ', dbms_sql.native);
	dbms_sql.bind_variable(c001, 'NR_SEQUENCIA_W', nr_sequencia_w);
	dbms_sql.bind_variable(c001, 'DS_HISTORICO_W', ds_historico_w);
	dbms_sql.bind_variable(c001, 'DT_ATUALIZACAO_W', dt_atualizacao_w);
	dbms_sql.bind_variable(c001, 'DT_HISTORICO_W', dt_historico_w);
	dbms_sql.bind_variable(c001, 'NM_USUARIO_P', nm_usuario_p);
	dbms_sql.bind_variable(c001, 'NR_SEQ_CLIENTE_W', nr_seq_cliente_w);
	dbms_sql.bind_variable(c001, 'NR_SEQ_TIPO_W', nr_seq_tipo_w);
	dbms_sql.bind_variable(c001, 'NR_SEQ_ATIV_W', nr_seq_ativ_w);
	dbms_sql.bind_variable(c001, 'NR_SEQ_CLASSIF_W', nr_seq_classif_w);
	retorno_w := dbms_sql.execute(c001);
	dbms_sql.close_cursor(c001);
	end;
end loop;
close C01;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE fin_comunic_comercial ( nr_sequencia_p bigint, nm_usuario_p text) FROM PUBLIC;

