-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gravar_dados_debug_aplicacao ( nm_tabela_p text, ds_comando_p text, ds_parametros_p text DEFAULT '', nm_usuario_p text DEFAULT NULL, cd_estabelecimento_p bigint DEFAULT NULL, ds_info_adicional1_p text DEFAULT '', ds_info_adicional2_p text DEFAULT '', ds_info_adicional3_p text DEFAULT '', ds_info_adicional4_p text DEFAULT '', ds_info_adicional5_p text DEFAULT '') AS $body$
DECLARE





cd_log_w		bigint := 43210;
ds_log_W		varchar(32767);
ds_log1_W		varchar(32767);
ds_log2_W		varchar(32767);
ds_stack_w		varchar(32767);
seq_w			bigint;

BEGIN
	if ((ds_comando_p IS NOT NULL AND ds_comando_p::text <> '') and
				position('ATENDIMENTO_SINAL_VITAL' in ds_comando_p) > 0) then
					

			ds_stack_w	:= substr(dbms_utility.format_call_stack,1, 2000);

			ds_log_W 	:= 	'SQL: ' 		|| ds_comando_p 		|| chr(13) || chr(10) ||
							'Parametros: ' 	|| ds_parametros_p 		|| chr(13) || chr(10) ||
							'Estab: ' 		|| cd_estabelecimento_p || chr(13) || chr(10) ||
							'Stack: ' 		|| ds_stack_w;

			ds_log_W	:= substr(ds_log_W,1 , 2000);

			select	nextval('log_tasy_seq')
			into STRICT	seq_w
			;


			insert into log_tasy(
				DT_ATUALIZACAO,
				NM_USUARIO,
				CD_LOG,
				DS_LOG,
				NR_SEQUENCIA,
				DS_UTC,
				IE_HORARIO_VERAO,
				DS_UTC_ATUALIZACAO)
			values (
					clock_timestamp(),
					nm_usuario_p,
					cd_log_w,
					ds_log_W, --Log
					seq_w,
					'',
					'N',
					'');



			ds_log1_W 	:= 	 'Detalhamento 1 Ref: ' || seq_w || chr(13) || chr(10) ||
						'ds_info_adicional1_p: ' || ds_info_adicional1_p || chr(13) || chr(10) ||
						'ds_info_adicional2_p: ' || ds_info_adicional2_p || chr(13) || chr(10) ||
						'ds_info_adicional3_p: ' || ds_info_adicional3_p || chr(13) || chr(10) ||
						'ds_info_adicional5_p: ' || ds_info_adicional5_p;

			ds_log1_W	:= substr(ds_log1_W, 0, 2000);

			insert into log_tasy(
				DT_ATUALIZACAO,
				NM_USUARIO,
				CD_LOG,
				DS_LOG,
				NR_SEQUENCIA,
				DS_UTC,
				IE_HORARIO_VERAO,
				DS_UTC_ATUALIZACAO)
			values (
					clock_timestamp(),
					nm_usuario_p,
					cd_log_w,
					ds_log1_W, --Log
					nextval('log_tasy_seq'),
					'',
					'N',
					'');




			ds_log2_W 	:= 	 'Detalhamento 2 Ref: ' || seq_w || chr(13) || chr(10) ||
						'ds_info_adicional1_p: ' || ds_info_adicional1_p || chr(13) || chr(10) ||
						'ds_info_adicional2_p: ' || ds_info_adicional2_p || chr(13) || chr(10) ||
						'ds_info_adicional3_p: ' || ds_info_adicional3_p || chr(13) || chr(10) ||
						'ds_info_adicional5_p: ' || ds_info_adicional5_p;
						
						
			ds_log2_W	:= substr(ds_log2_W,2000, length(ds_log2_W));	
			ds_log2_W	:= substr(ds_log2_W,0, 2000);	
						

			insert into log_tasy(
				DT_ATUALIZACAO,
				NM_USUARIO,
				CD_LOG,
				DS_LOG,
				NR_SEQUENCIA,
				DS_UTC,
				IE_HORARIO_VERAO,
				DS_UTC_ATUALIZACAO)
			values (
					clock_timestamp(),
					nm_usuario_p,
					cd_log_w,
					ds_log2_W, --Log
					nextval('log_tasy_seq'),
					'',
					'N',
					'');


			commit;

	end if;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gravar_dados_debug_aplicacao ( nm_tabela_p text, ds_comando_p text, ds_parametros_p text DEFAULT '', nm_usuario_p text DEFAULT NULL, cd_estabelecimento_p bigint DEFAULT NULL, ds_info_adicional1_p text DEFAULT '', ds_info_adicional2_p text DEFAULT '', ds_info_adicional3_p text DEFAULT '', ds_info_adicional4_p text DEFAULT '', ds_info_adicional5_p text DEFAULT '') FROM PUBLIC;

