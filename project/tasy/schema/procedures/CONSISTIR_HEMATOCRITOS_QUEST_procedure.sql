-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consistir_hematocritos_quest ( cd_pessoa_fisica_p text, cd_estabelecimento_p bigint, pr_hematocrito_p bigint, ds_mens_hemat_p INOUT text) AS $body$
DECLARE


ie_consiste_pr_hematocrito_w	varchar(1);
ie_sexo_w			varchar(1);
pr_hemat_min_fem_w		double precision;
pr_hemat_max_fem_w		double precision;
pr_hemat_min_mas_w		double precision;
pr_hemat_max_mas_w		double precision;


BEGIN

if (pr_hematocrito_p IS NOT NULL AND pr_hematocrito_p::text <> '') then

	select	ie_sexo
	into STRICT	ie_sexo_w
	from	pessoa_fisica
	where	cd_pessoa_fisica = cd_pessoa_fisica_p;

	select	max(pr_hemat_min_fem),
			max(pr_hemat_max_fem),
			max(pr_hemat_min_mas),
		max(pr_hemat_max_mas)
	into STRICT	pr_hemat_min_fem_w,
			pr_hemat_max_fem_w,
			pr_hemat_min_mas_w,
			pr_hemat_max_mas_w
	from	san_parametro
	where	cd_estabelecimento = cd_estabelecimento_p;


	if (ie_sexo_w = 'F') then
		if (pr_hemat_min_mas_w IS NOT NULL AND pr_hemat_min_mas_w::text <> '') and (pr_hematocrito_p < pr_hemat_min_mas_w) then
			if (ie_consiste_pr_hematocrito_w = 'S') then
				ds_mens_hemat_p := obter_texto_dic_objeto(193076, wheb_usuario_pck.get_nr_seq_idioma, '');
			end if;
		end if;
	end if;

	if (ie_sexo_w = 'F') then
		if (pr_hemat_min_fem_w IS NOT NULL AND pr_hemat_min_fem_w::text <> '') and (pr_hematocrito_p > pr_hemat_min_fem_w) then
			if (ie_consiste_pr_hematocrito_w = 'S') then
				ds_mens_hemat_p := obter_texto_dic_objeto(193080, wheb_usuario_pck.get_nr_seq_idioma, '');
			end if;
		end if;
	end if;

	if (ie_sexo_w = 'M') then
		if (pr_hemat_min_fem_w IS NOT NULL AND pr_hemat_min_fem_w::text <> '') and (pr_hematocrito_p < pr_hemat_min_fem_w) then
			if (ie_consiste_pr_hematocrito_w = 'S') then
				ds_mens_hemat_p := obter_texto_dic_objeto(193081, wheb_usuario_pck.get_nr_seq_idioma, '');
			end if;
		end if;
	end if;

	if (ie_sexo_w = 'M') then
		if (pr_hemat_min_fem_w IS NOT NULL AND pr_hemat_min_fem_w::text <> '') and (pr_hematocrito_p > pr_hemat_min_fem_w) then
			if (ie_consiste_pr_hematocrito_w = 'S') then
				ds_mens_hemat_p := obter_texto_dic_objeto(193082, wheb_usuario_pck.get_nr_seq_idioma, '');
			end if;
		end if;
	end if;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consistir_hematocritos_quest ( cd_pessoa_fisica_p text, cd_estabelecimento_p bigint, pr_hematocrito_p bigint, ds_mens_hemat_p INOUT text) FROM PUBLIC;

