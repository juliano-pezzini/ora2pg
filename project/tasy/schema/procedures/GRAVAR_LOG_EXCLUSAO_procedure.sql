-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gravar_log_exclusao (nm_tabela_p text, nm_usuario_p text, ds_chave_p text, ie_executar_commit_p text, ds_maquina_p text DEFAULT NULL) AS $body$
DECLARE

  dt_atualizacao_w varchar(20);
  ds_comando_w     varchar(4000);
  ds_parametros_w  varchar(4000);
  ds_chave_w       varchar(2000);
  ds_chave_longo_w varchar(4000);
  ds_maquina_w     varchar(250) := ds_maquina_p;


BEGIN
  IF coalesce(ds_maquina_w::text, '') = '' THEN
      ds_maquina_w := wheb_usuario_pck.get_nm_maquina();
  END IF;
  ds_chave_longo_w := substr(REPLACE(ds_chave_p, ';', ':'), 1, 1000);
  ds_chave_w       := substr(ds_chave_longo_w, 1, 255);

  dt_atualizacao_w := to_char(clock_timestamp(), 'dd/mm/yyyy hh24:mi:ss');
  ds_comando_w     := ' insert into log_exclusao (nm_tabela,dt_atualizacao,nm_usuario,ds_chave_longo,ds_chave, nm_maquina) ' ||
                      ' values (:nm_tabela,:dt_atualizacao,:nm_usuario,:ds_chave_longo,:ds_chave, :nm_maquina)';
  ds_parametros_w  := substr('nm_tabela=' || nm_tabela_p || ';' ||
                             'dt_atualizacao=' || dt_atualizacao_w || ';' ||
                             'nm_usuario=' || nm_usuario_p || ';' ||
                             'ds_chave_longo=' || ds_chave_longo_w || ';' || 
                             'ds_chave=' || ds_chave_w || ';' || 
                             'nm_maquina= '||ds_maquina_w 
                             , 1, 4000);
  CALL exec_sql_dinamico_bv('LOG_EXCLUSAO', ds_comando_w, ds_parametros_w);

  IF (ie_executar_commit_p = 'S') THEN
    IF (coalesce(wheb_usuario_pck.get_ie_commit, 'S') = 'S') THEN
      COMMIT;
    END IF;
  END IF;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gravar_log_exclusao (nm_tabela_p text, nm_usuario_p text, ds_chave_p text, ie_executar_commit_p text, ds_maquina_p text DEFAULT NULL) FROM PUBLIC;

