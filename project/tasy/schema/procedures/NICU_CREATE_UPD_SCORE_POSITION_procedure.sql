-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE nicu_create_upd_score_position (nr_sequencia_p nicu_positioning_score.nr_sequencia%type, nr_seq_positioning_p nicu_positioning_score.nr_seq_positioning%type, nr_seq_atendimento_p nicu_positioning.nr_seq_encounter%type, ds_body_part_p nicu_positioning_score.ds_body_part%type, nr_row_p nicu_positioning_score.nr_row%type, vl_score_p nicu_positioning_score.vl_score%type, mensagem_erro_p INOUT text, dt_positioning_p timestamp default clock_timestamp()) AS $body$
DECLARE


  nr_seq_positioning_score_w  nicu_positioning_score.nr_sequencia%type;
  exeption_w exception;

BEGIN
  if (coalesce(nr_sequencia_p::text, '') = '') then
     select nextval('nicu_positioning_score_seq')
       into STRICT nr_seq_positioning_score_w
;
  else
    nr_seq_positioning_score_w := nr_sequencia_p;
  end if;

  begin
    insert into nicu_positioning_score(nr_sequencia,
        nr_seq_positioning,
        nr_row,
        ds_body_part,
        vl_score)
    values (nr_seq_positioning_score_w,
        nr_seq_positioning_p,
        nr_row_p,
        ds_body_part_p,
        vl_score_p);
  exception
    when unique_violation then
      begin
        update nicu_positioning_score
           set nr_seq_positioning = nr_seq_positioning_p,
               nr_row = nr_row_p,
               ds_body_part = ds_body_part_p,
               vl_score = vl_score_p
         where nr_sequencia = nr_seq_positioning_score_w;
      exception
        when others then
          mensagem_erro_p := expressao_pck.obter_desc_expressao(776218)||' Error: '|| sqlerrm;
          raise exeption_w;
      end;
  when others then
     mensagem_erro_p := expressao_pck.obter_desc_expressao(776218)||' Error: '|| sqlerrm;
     raise exeption_w;
  end;

  commit;
exception
  when exeption_w then
     rollback;
  when others then
    mensagem_erro_p := expressao_pck.obter_desc_expressao(776218)||' Error: '|| sqlerrm;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE nicu_create_upd_score_position (nr_sequencia_p nicu_positioning_score.nr_sequencia%type, nr_seq_positioning_p nicu_positioning_score.nr_seq_positioning%type, nr_seq_atendimento_p nicu_positioning.nr_seq_encounter%type, ds_body_part_p nicu_positioning_score.ds_body_part%type, nr_row_p nicu_positioning_score.nr_row%type, vl_score_p nicu_positioning_score.vl_score%type, mensagem_erro_p INOUT text, dt_positioning_p timestamp default clock_timestamp()) FROM PUBLIC;

