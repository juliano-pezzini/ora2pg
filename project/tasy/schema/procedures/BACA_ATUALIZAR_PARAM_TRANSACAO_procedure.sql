-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_atualizar_param_transacao () AS $body$
DECLARE


qt_registros_w	bigint;


BEGIN

/* OPSW - Transação Complementar, parâmetro[1] Tipo de saída padrão utilizada para complementar uma Guia de Consulta ao criar uma Guia de Exame */

select	count(1)
  into STRICT	qt_registros_w
  from  funcao_parametro
 where 	cd_funcao = 1376
   and 	nr_sequencia = 1;

if ( qt_registros_w = 1) then

	select	count(1)
	  into STRICT	qt_registros_w
	  from  pls_web_param_usuario
	 where 	cd_funcao = 1376
	   and 	nr_seq_funcao_param = 1;

	if (qt_registros_w = 0) then

		update	funcao_parametro
		   set	vl_parametro = (SELECT max(vl_parametro) from funcao_parametro where cd_funcao = 1289 and nr_sequencia = 8)
		 where 	cd_funcao = 1376
		   and 	nr_sequencia = 1;


		insert	into	pls_web_param_usuario(nr_sequencia, cd_estabelecimento, nr_seq_param,
											  nr_seq_segurado, nr_seq_usu_estipulante, nr_seq_usu_prestador ,
											  vl_parametro, nm_usuario_param, nr_seq_funcao_param ,
											  cd_funcao, ie_tipo_acesso, ds_observacao,
											  nr_seq_perfil_web, nr_seq_usu_grupo_contrato, nr_seq_usu_cooperado,
											  nm_usuario_nrec, dt_atualizacao_nrec, dt_atualizacao,
											  nm_usuario)
								   (SELECT	  nextval('pls_web_param_usuario_seq'), cd_estabelecimento, nr_seq_param,
											  nr_seq_segurado, nr_seq_usu_estipulante, nr_seq_usu_prestador ,
											  vl_parametro, nm_usuario_param, 1 ,
											  1376, ie_tipo_acesso, ds_observacao,
											  nr_seq_perfil_web, nr_seq_usu_grupo_contrato, nr_seq_usu_cooperado,
											  'baca', clock_timestamp(), clock_timestamp(),
											  'baca'
									  from	  pls_web_param_usuario
									 where    cd_funcao = 1289
									   and 	  nr_seq_funcao_param = 8);


		insert	into   pls_web_param_contrato(nr_sequencia, cd_estabelecimento, nr_seq_param,
											  nr_seq_contrato, ds_observacao,  nm_usuario_nrec,
											  dt_atualizacao_nrec, dt_atualizacao,nm_usuario,
											  cd_funcao, nr_seq_funcao_param)
								   (SELECT	  nextval('pls_web_param_contrato_seq'), cd_estabelecimento, nr_seq_param,
											  nr_seq_contrato, ds_observacao, 'baca',
											  clock_timestamp(), clock_timestamp(), 'baca',
											  1376, 1
									  from	  pls_web_param_contrato
									 where    cd_funcao = 1289
									   and 	  nr_seq_funcao_param = 8);

	end if;

end if;

/*  OPSW - Portal web,  parâmetro[54] Exibir no menu a função OPSW - Transação Complementar */

select	count(1)
  into STRICT	qt_registros_w
  from  funcao_parametro
 where 	cd_funcao = 1246
   and 	nr_sequencia = 54;

if ( qt_registros_w = 1) then

	select	count(1)
	  into STRICT	qt_registros_w
	  from  pls_web_param_usuario
	 where 	cd_funcao = 1246
	   and 	nr_seq_funcao_param = 54;

	if (qt_registros_w = 0) then

		update	funcao_parametro
		   set	vl_parametro = (SELECT max(vl_parametro) from funcao_parametro where cd_funcao = 1246 and nr_sequencia = 18)
		 where 	cd_funcao = 1246
		   and 	nr_sequencia = 54;

		insert	into	pls_web_param_usuario(nr_sequencia, cd_estabelecimento, nr_seq_param,
											  nr_seq_segurado, nr_seq_usu_estipulante, nr_seq_usu_prestador ,
											  vl_parametro, nm_usuario_param, nr_seq_funcao_param ,
											  cd_funcao, ie_tipo_acesso, ds_observacao,
											  nr_seq_perfil_web, nr_seq_usu_grupo_contrato, nr_seq_usu_cooperado,
											  nm_usuario_nrec, dt_atualizacao_nrec, dt_atualizacao,
											  nm_usuario)
								   (SELECT	  nextval('pls_web_param_usuario_seq'), cd_estabelecimento, nr_seq_param,
											  nr_seq_segurado, nr_seq_usu_estipulante, nr_seq_usu_prestador ,
											  vl_parametro, nm_usuario_param, 54 ,
											  1246, ie_tipo_acesso, ds_observacao,
											  nr_seq_perfil_web, nr_seq_usu_grupo_contrato, nr_seq_usu_cooperado,
											  'baca', clock_timestamp(), clock_timestamp(),
											  'baca'
									  from	  pls_web_param_usuario
									 where    cd_funcao = 1246
									   and 	  nr_seq_funcao_param = 18);

		insert	into   pls_web_param_contrato(nr_sequencia, cd_estabelecimento, nr_seq_param,
											  nr_seq_contrato, ds_observacao,  nm_usuario_nrec,
											  dt_atualizacao_nrec, dt_atualizacao,nm_usuario,
											  cd_funcao, nr_seq_funcao_param)
								   (SELECT	  nextval('pls_web_param_contrato_seq'), cd_estabelecimento, nr_seq_param,
											  nr_seq_contrato, ds_observacao, 'baca',
											  clock_timestamp(), clock_timestamp(), 'baca',
											  1246, 54
									  from	  pls_web_param_contrato
									 where    cd_funcao = 1246
									   and 	  nr_seq_funcao_param = 18);

	end if;

end if;


commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_atualizar_param_transacao () FROM PUBLIC;

