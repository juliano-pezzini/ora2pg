-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_patient_report_pdf_bft ( nr_seq_laudo_p bigint, nr_acesso_dicom_p bigint, nr_seq_laudo_pdf_p INOUT bigint) AS $body$
DECLARE


nr_acesso_dicom_w	laudo_paciente_pdf.nr_acesso_dicom%type;


BEGIN

	if (nr_seq_laudo_p IS NOT NULL AND nr_seq_laudo_p::text <> '') then
		select	max(nr_acc_number)
		into STRICT	nr_acesso_dicom_w
		from	w_integracao_laudo_hl7
		where	nr_sequencia	= nr_acesso_dicom_p;

		select	nextval('laudo_paciente_pdf_seq')
		into STRICT	nr_seq_laudo_pdf_p
		;
	
		insert into laudo_paciente_pdf(	NR_SEQUENCIA,
										DT_ATUALIZACAO,
										DT_ATUALIZACAO_NREC,
										NM_USUARIO,
										NM_USUARIO_NREC,
										NR_ACESSO_DICOM,
										NR_SEQ_LAUDO)
								values (	nr_seq_laudo_pdf_p,
										clock_timestamp(),
										clock_timestamp(),
										Obter_Desc_Expressao(292128),
										Obter_Desc_Expressao(292128),
										nr_acesso_dicom_w,
										nr_seq_laudo_p								
									  );
								
		update	laudo_paciente
		set	ie_formato = 4
		where	nr_sequencia = nr_seq_laudo_p;

	end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_patient_report_pdf_bft ( nr_seq_laudo_p bigint, nr_acesso_dicom_p bigint, nr_seq_laudo_pdf_p INOUT bigint) FROM PUBLIC;

