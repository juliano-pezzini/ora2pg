-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE version_clinical_pathway ( NR_SEQ_PROT_INTEGRADO_P bigint ) AS $body$
DECLARE


    NR_SEQ_PROT_INTEGRADO_W          PROTOCOLO_INTEGRADO.NR_SEQUENCIA%TYPE;
    NR_SEQ_PROT_INTEGRADO_ETAPA_W    PROTOCOLO_INTEGRADO_ETAPA.NR_SEQUENCIA%TYPE;
    NR_SEQ_PROT_INTEGRADO_DOENCA_W   PROTOCOLO_INTEGRADO_DOENCA.NR_SEQUENCIA%TYPE;
    NR_SEQ_PROT_INTEGRADO_LIB_W      PROTOCOLO_INTEGRADO_LIB.NR_SEQUENCIA%TYPE;
    NR_SEQ_PROT_INTEGRADO_EVENTO_W   PROTOCOLO_INTEGRADO_EVENTO.NR_SEQUENCIA%TYPE;
    NR_SEQ_PROT_INT_ETAPA_RESUL_W    PROTOCOLO_INT_ETAPA_RESUL.NR_SEQUENCIA%TYPE;
    NR_SEQ_PROT_INT_ETAPA_RES_AV_W   PROTOCOLO_INT_ETAPA_RES_AV.NR_SEQUENCIA%TYPE;
    NR_SEQ_PROT_INT_TIPO_EVENTO_W    PROTOCOLO_INT_TIPO_EVENTO.NR_SEQUENCIA%TYPE;
    NR_SEQ_PROT_INT_CATEGORIA_W      PROTOCOLO_INT_CATEGORIA.NR_SEQUENCIA%TYPE;
    NM_USUARIO_W                     varchar(25);
  T RECORD;
  X RECORD;
  Y RECORD;
  Z RECORD;
  A RECORD;
  B RECORD;
  C RECORD;
  D RECORD;

BEGIN
    SELECT
        nextval('protocolo_integrado_seq')
    INTO STRICT NR_SEQ_PROT_INTEGRADO_W
;

    INSERT INTO PROTOCOLO_INTEGRADO(
        NR_SEQUENCIA,
        DT_ATUALIZACAO,
        NM_USUARIO,
        DT_ATUALIZACAO_NREC,
        NM_USUARIO_NREC,
        DS_PROTOCOLO,
        DS_JUSTIFICATIVA,
        DT_INICIO,
        DT_FIM,
        IE_SITUACAO,
        DS_ARQUIVO,
        IE_TIPO_ATENDIMENTO,
        CD_DEPARTAMENTO,
        DS_OBSERVACAO,
        DS_CONDICAO_APLICACAO,
        DS_CONDICAO_EXCECAO,
        IE_TIPO,
        NR_VERSAO,
        NR_SEQ_VERSAO_ANT
    )
        ( SELECT
            NR_SEQ_PROT_INTEGRADO_W,
            DT_ATUALIZACAO,
            NM_USUARIO,
            clock_timestamp(),
            NM_USUARIO_NREC,
            DS_PROTOCOLO,
            DS_JUSTIFICATIVA,
            clock_timestamp(),
            DT_FIM,
            'E',
            DS_ARQUIVO,
            IE_TIPO_ATENDIMENTO,
            CD_DEPARTAMENTO,
            DS_OBSERVACAO,
            DS_CONDICAO_APLICACAO,
            DS_CONDICAO_EXCECAO,
            IE_TIPO,
            coalesce(NR_VERSAO, 1) + 1,
            NR_SEQ_PROT_INTEGRADO_P
        FROM
            PROTOCOLO_INTEGRADO
        WHERE
            NR_SEQUENCIA = NR_SEQ_PROT_INTEGRADO_P
        );


    FOR T IN (
        SELECT
            NR_SEQUENCIA,
            DT_ATUALIZACAO,
            NM_USUARIO,
            DT_ATUALIZACAO_NREC,
            NM_USUARIO_NREC,
            DS_ETAPA,
            NR_DIAS_ETAPA,
            NR_SEQ_PROTOCOLO_INTEGRADO,
            DS_ETAPA_PACIENTE,
            IE_OCULTAR_VISAO_PACIENTE,
            NR_DIA_INICIAL,
            NR_DIA_FINAL,
            NR_ORDEM_INICIAL,
            NR_ORDEM_FINAL,
            IE_EVENTO_SUMARIO,
            DS_RESULTADO,
            DS_RESULTADO_PACIENTE,
            DS_AVALIACAO_RESULTADO,
            IE_CRITICO,
            IE_VARIANCIA
        FROM
            PROTOCOLO_INTEGRADO_ETAPA
        WHERE
            NR_SEQ_PROTOCOLO_INTEGRADO = NR_SEQ_PROT_INTEGRADO_P
    ) LOOP
        SELECT
            nextval('protocolo_integrado_etapa_seq')
        INTO STRICT NR_SEQ_PROT_INTEGRADO_ETAPA_W
;

        INSERT INTO PROTOCOLO_INTEGRADO_ETAPA(
            NR_SEQUENCIA,
            DT_ATUALIZACAO,
            NM_USUARIO,
            DT_ATUALIZACAO_NREC,
            NM_USUARIO_NREC,
            DS_ETAPA,
            NR_DIAS_ETAPA,
            NR_SEQ_PROTOCOLO_INTEGRADO,
            DS_ETAPA_PACIENTE,
            IE_OCULTAR_VISAO_PACIENTE,
            NR_DIA_INICIAL,
            NR_DIA_FINAL,
            NR_ORDEM_INICIAL,
            NR_ORDEM_FINAL,
            IE_EVENTO_SUMARIO,
            DS_RESULTADO,
            DS_RESULTADO_PACIENTE,
            DS_AVALIACAO_RESULTADO,
            IE_CRITICO,
            IE_VARIANCIA
        ) VALUES (
            NR_SEQ_PROT_INTEGRADO_ETAPA_W,
            T.DT_ATUALIZACAO,
            T.NM_USUARIO,
            clock_timestamp(),
            T.NM_USUARIO_NREC,
            T.DS_ETAPA,
            T.NR_DIAS_ETAPA,
            NR_SEQ_PROT_INTEGRADO_W,
            T.DS_ETAPA_PACIENTE,
            T.IE_OCULTAR_VISAO_PACIENTE,
            T.NR_DIA_INICIAL,
            T.NR_DIA_FINAL,
            T.NR_ORDEM_INICIAL,
            T.NR_ORDEM_FINAL,
            T.IE_EVENTO_SUMARIO,
            T.DS_RESULTADO,
            T.DS_RESULTADO_PACIENTE,
            T.DS_AVALIACAO_RESULTADO,
            T.IE_CRITICO,
            T.IE_VARIANCIA
        );

        FOR X IN (
            SELECT
                NR_SEQUENCIA,
                DT_ATUALIZACAO,
                NM_USUARIO,
                DT_ATUALIZACAO_NREC,
                NM_USUARIO_NREC,
                DS_EVENTO,
                IE_TIPO_EVENTO,
                NR_DIA_EVENTO,
                NR_SEQ_PONTO_VERIFICACAO,
                NR_SEQ_ETAPA,
                DS_EVENTO_PACIENTE,
                IE_TIPO_AGENDAMENTO,
                CD_ESPECIALIDADE,
                IE_OCULTAR_VISAO_PACIENTE,
                IE_TIPO_ATENDIMENTO,
                IE_CLINICA,
                CD_PROCEDIMENTO,
                IE_ORIGEM_PROCED,
                CD_PROTOCOLO,
                NR_SEQ_GRUPO_EXAME_LAB,
                NR_SEQ_PROTOCOLO,
                NR_SEQ_TIPO_CONSULTA,
                NR_DIAS_ANT,
                NR_DIAS_DEP,
                NR_SEQ_DISPOSITIVO,
                NR_SEQ_EVENTO,
                NR_SEQ_ESCALA,
                NR_SEQ_SCORE_FLEX,
                NR_SEQ_SCORE_FLEX_II,
                NR_SEQ_INTERVENCAO,
                NR_SEQ_ORDEM,
                NR_SEQ_CLASSIF,
                IE_ACAO,
                DS_RESULTADO_EVENTO,
                IE_EVENTO_CRITICO,
                NR_SEQ_GRU_EX_NAO_LAB,
                DT_PROV_PARTO,
                CD_CLASSIF_SETOR,
                IE_DOSE,
                NR_SEQ_VACINA,
                DT_AVALIACAO,
                IE_TIPO,
                CD_ESPECIALIDADE_MEDICO,
                IE_EVOLUCAO_CLINICA,
                NR_SEQ_PROGRAMA_SAUDE,
                NR_SEQ_TEMPLATE,
                NR_SEQ_AVALIACAO,
                NR_SEQ_PLANO,
                NR_DIA_PROTOCOLO
            FROM
                PROTOCOLO_INTEGRADO_EVENTO
            WHERE
                NR_SEQ_ETAPA = T.NR_SEQUENCIA
        ) LOOP
            SELECT
                nextval('protocolo_integrado_evento_seq')
            INTO STRICT NR_SEQ_PROT_INTEGRADO_EVENTO_W
;

            INSERT INTO PROTOCOLO_INTEGRADO_EVENTO(
                NR_SEQUENCIA,
                DT_ATUALIZACAO,
                NM_USUARIO,
                DT_ATUALIZACAO_NREC,
                NM_USUARIO_NREC,
                DS_EVENTO,
                IE_TIPO_EVENTO,
                NR_DIA_EVENTO,
                NR_SEQ_PONTO_VERIFICACAO,
                NR_SEQ_ETAPA,
                DS_EVENTO_PACIENTE,
                IE_TIPO_AGENDAMENTO,
                CD_ESPECIALIDADE,
                IE_OCULTAR_VISAO_PACIENTE,
                IE_TIPO_ATENDIMENTO,
                IE_CLINICA,
                CD_PROCEDIMENTO,
                IE_ORIGEM_PROCED,
                CD_PROTOCOLO,
                NR_SEQ_GRUPO_EXAME_LAB,
                NR_SEQ_PROTOCOLO,
                NR_SEQ_TIPO_CONSULTA,
                NR_DIAS_ANT,
                NR_DIAS_DEP,
                NR_SEQ_DISPOSITIVO,
                NR_SEQ_EVENTO,
                NR_SEQ_ESCALA,
                NR_SEQ_SCORE_FLEX,
                NR_SEQ_SCORE_FLEX_II,
                NR_SEQ_INTERVENCAO,
                NR_SEQ_ORDEM,
                NR_SEQ_CLASSIF,
                IE_ACAO,
                DS_RESULTADO_EVENTO,
                IE_EVENTO_CRITICO,
                NR_SEQ_GRU_EX_NAO_LAB,
                DT_PROV_PARTO,
                CD_CLASSIF_SETOR,
                IE_DOSE,
                NR_SEQ_VACINA,
                DT_AVALIACAO,
                IE_TIPO,
                CD_ESPECIALIDADE_MEDICO,
                IE_EVOLUCAO_CLINICA,
                NR_SEQ_PROGRAMA_SAUDE,
                NR_SEQ_TEMPLATE,
                NR_SEQ_AVALIACAO,
                NR_SEQ_PLANO,
                NR_DIA_PROTOCOLO
            ) VALUES (
                NR_SEQ_PROT_INTEGRADO_EVENTO_W,
                X.DT_ATUALIZACAO,
                X.NM_USUARIO,
                clock_timestamp(),
                X.NM_USUARIO_NREC,
                X.DS_EVENTO,
                X.IE_TIPO_EVENTO,
                X.NR_DIA_EVENTO,
                X.NR_SEQ_PONTO_VERIFICACAO,
                NR_SEQ_PROT_INTEGRADO_ETAPA_W,
                X.DS_EVENTO_PACIENTE,
                X.IE_TIPO_AGENDAMENTO,
                X.CD_ESPECIALIDADE,
                X.IE_OCULTAR_VISAO_PACIENTE,
                X.IE_TIPO_ATENDIMENTO,
                X.IE_CLINICA,
                X.CD_PROCEDIMENTO,
                X.IE_ORIGEM_PROCED,
                X.CD_PROTOCOLO,
                X.NR_SEQ_GRUPO_EXAME_LAB,
                X.NR_SEQ_PROTOCOLO,
                X.NR_SEQ_TIPO_CONSULTA,
                X.NR_DIAS_ANT,
                X.NR_DIAS_DEP,
                X.NR_SEQ_DISPOSITIVO,
                X.NR_SEQ_EVENTO,
                X.NR_SEQ_ESCALA,
                X.NR_SEQ_SCORE_FLEX,
                X.NR_SEQ_SCORE_FLEX_II,
                X.NR_SEQ_INTERVENCAO,
                X.NR_SEQ_ORDEM,
                X.NR_SEQ_CLASSIF,
                X.IE_ACAO,
                X.DS_RESULTADO_EVENTO,
                X.IE_EVENTO_CRITICO,
                X.NR_SEQ_GRU_EX_NAO_LAB,
                X.DT_PROV_PARTO,
                X.CD_CLASSIF_SETOR,
                X.IE_DOSE,
                X.NR_SEQ_VACINA,
                X.DT_AVALIACAO,
                X.IE_TIPO,
                X.CD_ESPECIALIDADE_MEDICO,
                X.IE_EVOLUCAO_CLINICA,
                X.NR_SEQ_PROGRAMA_SAUDE,
                X.NR_SEQ_TEMPLATE,
                X.NR_SEQ_AVALIACAO,
                X.NR_SEQ_PLANO,
                X.NR_DIA_PROTOCOLO
            );

        END LOOP;

        FOR Y IN (
            SELECT
                NR_SEQUENCIA,
                NR_SEQ_ETAPA,
                DS_RESULTADO,
                DS_RESULTADO_PACIENTE,
                IE_CRITICO,
                IE_VARIANCIA,
                NR_ORDEM_APRESENTACAO,
                DT_ATUALIZACAO,
                NM_USUARIO,
                DT_ATUALIZACAO_NREC,
                NM_USUARIO_NREC,
                IE_SITUACAO,
                NR_SEQ_PROT_INT_RESULT
            FROM
                PROTOCOLO_INT_ETAPA_RESUL
            WHERE
                NR_SEQ_ETAPA = T.NR_SEQUENCIA
        ) LOOP
            SELECT
                nextval('protocolo_int_etapa_resul_seq')
            INTO STRICT NR_SEQ_PROT_INT_ETAPA_RESUL_W
;

            INSERT INTO PROTOCOLO_INT_ETAPA_RESUL(
                NR_SEQUENCIA,
                NR_SEQ_ETAPA,
                DS_RESULTADO,
                DS_RESULTADO_PACIENTE,
                IE_CRITICO,
                IE_VARIANCIA,
                NR_ORDEM_APRESENTACAO,
                DT_ATUALIZACAO,
                NM_USUARIO,
                DT_ATUALIZACAO_NREC,
                NM_USUARIO_NREC,
                IE_SITUACAO,
                NR_SEQ_PROT_INT_RESULT
            ) VALUES (
                NR_SEQ_PROT_INT_ETAPA_RESUL_W,
                NR_SEQ_PROT_INTEGRADO_ETAPA_W,
                Y.DS_RESULTADO,
                Y.DS_RESULTADO_PACIENTE,
                Y.IE_CRITICO,
                Y.IE_VARIANCIA,
                Y.NR_ORDEM_APRESENTACAO,
                Y.DT_ATUALIZACAO,
                Y.NM_USUARIO,
                clock_timestamp(),
                Y.NM_USUARIO_NREC,
                Y.IE_SITUACAO,
                Y.NR_SEQ_PROT_INT_RESULT
            );

            FOR Z IN (
                SELECT
                    NR_SEQUENCIA,
                    NR_SEQ_RESULTADO,
                    DS_AVALIACAO,
                    NR_ORDEM_APRESENTACAO,
                    DT_ATUALIZACAO,
                    NM_USUARIO,
                    DT_ATUALIZACAO_NREC,
                    NM_USUARIO_NREC,
                    IE_SITUACAO
                FROM
                    PROTOCOLO_INT_ETAPA_RES_AV
                WHERE
                    NR_SEQ_RESULTADO = Y.NR_SEQUENCIA
            ) LOOP
                SELECT
                    nextval('protocolo_int_etapa_res_av_seq')
                INTO STRICT NR_SEQ_PROT_INT_ETAPA_RES_AV_W
;

                INSERT INTO PROTOCOLO_INT_ETAPA_RES_AV(
                    NR_SEQUENCIA,
                    NR_SEQ_RESULTADO,
                    DS_AVALIACAO,
                    NR_ORDEM_APRESENTACAO,
                    DT_ATUALIZACAO,
                    NM_USUARIO,
                    DT_ATUALIZACAO_NREC,
                    NM_USUARIO_NREC,
                    IE_SITUACAO
                ) VALUES (
                    NR_SEQ_PROT_INT_ETAPA_RES_AV_W,
                    NR_SEQ_PROT_INT_ETAPA_RESUL_W,
                    Z.DS_AVALIACAO,
                    Z.NR_ORDEM_APRESENTACAO,
                    Z.DT_ATUALIZACAO,
                    Z.NM_USUARIO,
                    clock_timestamp(),
                    Z.NM_USUARIO_NREC,
                    Z.IE_SITUACAO
                );

            END LOOP;

        END LOOP;


    END LOOP;


    FOR A IN (
        SELECT
            NR_SEQUENCIA,
            DT_ATUALIZACAO,
            NM_USUARIO,
            DT_ATUALIZACAO_NREC,
            NM_USUARIO_NREC,
            CD_DOENCA_CID,
            NR_SEQ_PROTOCOLO_INTEGRADO
        FROM
            PROTOCOLO_INTEGRADO_DOENCA
        WHERE
            NR_SEQ_PROTOCOLO_INTEGRADO = NR_SEQ_PROT_INTEGRADO_P
    ) LOOP
        SELECT
            nextval('protocolo_integrado_doenca_seq')
        INTO STRICT NR_SEQ_PROT_INTEGRADO_DOENCA_W
;

        INSERT INTO PROTOCOLO_INTEGRADO_DOENCA(
            NR_SEQUENCIA,
            DT_ATUALIZACAO,
            NM_USUARIO,
            DT_ATUALIZACAO_NREC,
            NM_USUARIO_NREC,
            CD_DOENCA_CID,
            NR_SEQ_PROTOCOLO_INTEGRADO
        ) VALUES (
            NR_SEQ_PROT_INTEGRADO_DOENCA_W,
            A.DT_ATUALIZACAO,
            A.NM_USUARIO,
            clock_timestamp(),
            A.NM_USUARIO_NREC,
            A.CD_DOENCA_CID,
            NR_SEQ_PROT_INTEGRADO_W
        );

    END LOOP;

    FOR B IN (
        SELECT
            NR_SEQUENCIA,
            DT_ATUALIZACAO,
            NM_USUARIO,
            DT_ATUALIZACAO_NREC,
            NM_USUARIO_NREC,
            NR_SEQ_PROTOCOLO_INTEGRADO,
            CD_ESTABELECIMENTO,
            CD_ESPECIALIDADE,
            CD_TIME,
            IE_PERMISSAO,
            CD_PERFIL
        FROM
            PROTOCOLO_INTEGRADO_LIB
        WHERE
            NR_SEQ_PROTOCOLO_INTEGRADO = NR_SEQ_PROT_INTEGRADO_P
    ) LOOP
        SELECT
            nextval('protocolo_integrado_lib_seq')
        INTO STRICT NR_SEQ_PROT_INTEGRADO_LIB_W
;

        INSERT INTO PROTOCOLO_INTEGRADO_LIB(
            NR_SEQUENCIA,
            DT_ATUALIZACAO,
            NM_USUARIO,
            DT_ATUALIZACAO_NREC,
            NM_USUARIO_NREC,
            NR_SEQ_PROTOCOLO_INTEGRADO,
            CD_ESTABELECIMENTO,
            CD_ESPECIALIDADE,
            CD_TIME,
            IE_PERMISSAO,
            CD_PERFIL
        ) VALUES (
            NR_SEQ_PROT_INTEGRADO_LIB_W,
            B.DT_ATUALIZACAO,
            B.NM_USUARIO,
            clock_timestamp(),
            B.NM_USUARIO_NREC,
            NR_SEQ_PROT_INTEGRADO_W,
            B.CD_ESTABELECIMENTO,
            B.CD_ESPECIALIDADE,
            B.CD_TIME,
            B.IE_PERMISSAO,
            B.CD_PERFIL
        );

    END LOOP;

    FOR C IN (
        SELECT
            NR_SEQUENCIA,
            NR_SEQ_PROTOCOLO,
            CD_DOMINIO_TP_EVENTO,
            NR_ORDEM,
            DT_ATUALIZACAO,
            NM_USUARIO,
            DT_ATUALIZACAO_NREC,
            NM_USUARIO_NREC
        FROM
            PROTOCOLO_INT_TIPO_EVENTO
        WHERE
            NR_SEQ_PROTOCOLO = NR_SEQ_PROT_INTEGRADO_P
    ) LOOP
        SELECT
            nextval('protocolo_int_tipo_evento_seq')
        INTO STRICT NR_SEQ_PROT_INT_TIPO_EVENTO_W
;

        INSERT INTO PROTOCOLO_INT_TIPO_EVENTO(
            NR_SEQUENCIA,
            NR_SEQ_PROTOCOLO,
            CD_DOMINIO_TP_EVENTO,
            NR_ORDEM,
            DT_ATUALIZACAO,
            NM_USUARIO,
            DT_ATUALIZACAO_NREC,
            NM_USUARIO_NREC
        ) VALUES (
            NR_SEQ_PROT_INT_TIPO_EVENTO_W,
            NR_SEQ_PROT_INTEGRADO_W,
            C.CD_DOMINIO_TP_EVENTO,
            C.NR_ORDEM,
            C.DT_ATUALIZACAO,
            C.NM_USUARIO,
            clock_timestamp(),
            C.NM_USUARIO_NREC
        );

        FOR D IN (
            SELECT
                NR_SEQUENCIA,
                NR_SEQ_TP_EVENTO,
                NR_SEQ_ACAO,
                NR_ORDEM,
                DT_ATUALIZACAO,
                NM_USUARIO,
                DT_ATUALIZACAO_NREC,
                NM_USUARIO_NREC
            FROM
                PROTOCOLO_INT_CATEGORIA
            WHERE
                NR_SEQ_TP_EVENTO = C.NR_SEQUENCIA
        ) LOOP
            SELECT
                nextval('protocolo_int_categoria_seq')
            INTO STRICT NR_SEQ_PROT_INT_CATEGORIA_W
;

            INSERT INTO PROTOCOLO_INT_CATEGORIA(
                NR_SEQUENCIA,
                NR_SEQ_TP_EVENTO,
                NR_SEQ_ACAO,
                NR_ORDEM,
                DT_ATUALIZACAO,
                NM_USUARIO,
                DT_ATUALIZACAO_NREC,
                NM_USUARIO_NREC
            ) VALUES (
                NR_SEQ_PROT_INT_CATEGORIA_W,
                NR_SEQ_PROT_INT_TIPO_EVENTO_W,
                D.NR_SEQ_ACAO,
                D.NR_ORDEM,
                D.DT_ATUALIZACAO,
                D.NM_USUARIO,
                clock_timestamp(),
                D.NM_USUARIO_NREC
            );

        END LOOP;

    END LOOP;

    COMMIT;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE version_clinical_pathway ( NR_SEQ_PROT_INTEGRADO_P bigint ) FROM PUBLIC;

