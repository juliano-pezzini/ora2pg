-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_grupo_item_pepo ( nm_usuario_p text, nr_cirurgia_p bigint, ie_grupo_item_pepo_p text) AS $body$
DECLARE



ie_grupo_selecionado_w varchar(15);
ie_grafico_utilizado_w varchar(15);
cd_estabelecimento_w varchar(15);


BEGIN

ie_grupo_selecionado_w := 'N';

select	coalesce(max(cd_estabelecimento),obter_estabelecimento_ativo)
into STRICT	cd_estabelecimento_w
from	cirurgia
where	nr_cirurgia = nr_cirurgia_p;

ie_grafico_utilizado_w := obter_param_usuario(872, 431, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_w, ie_grafico_utilizado_w);

if (coalesce(ie_grafico_utilizado_w,'N') = 'S') then
	ie_grupo_selecionado_w := 'S';
end if;

insert into pepo_grupo_item_grafico(	NR_SEQUENCIA,
					NM_USUARIO,
					NR_CIRURGIA,
					IE_GRUPO_ITEM_PEPO,
					IE_GRUPO_SELECIONADO,
					NR_SEQ_APRESENT,
					DT_ATUALIZACAO)
				values (	nextval('pepo_grupo_item_grafico_seq'),
					nm_usuario_p,
					nr_cirurgia_p,
					ie_grupo_item_pepo_p,
					 ie_grupo_selecionado_w,
					 0,
					clock_timestamp());
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_grupo_item_pepo ( nm_usuario_p text, nr_cirurgia_p bigint, ie_grupo_item_pepo_p text) FROM PUBLIC;

