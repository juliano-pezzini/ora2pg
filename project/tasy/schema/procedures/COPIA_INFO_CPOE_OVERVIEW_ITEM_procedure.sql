-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copia_info_cpoe_overview_item ( NR_SEQ_CPOE_OVERVIEW_ITEM_P bigint , NM_USUARIO_P text, NR_SEQ_CPOE_ORDER_UNIT_P INOUT bigint , NR_SEQ_CPOE_RP_P INOUT bigint ) AS $body$
DECLARE

    NR_SEQ_ITEM_CPOE_W          bigint;
    IE_TIPO_ITEM_W              varchar(10);
    NR_SEQ_CPOE_ORDER_UNIT_O_W  bigint;
    NR_SEQ_CPOE_ORDER_UNIT_N_W  bigint;
    NR_SEQ_CPOE_RP_O_W          bigint;
    NR_SEQ_CPOE_RP_N_W          bigint;

BEGIN
    SELECT
        MAX(NR_SEQ_ITEM_CPOE),
        MAX(IE_TIPO_ITEM)
    INTO STRICT
        NR_SEQ_ITEM_CPOE_W,
        IE_TIPO_ITEM_W
    FROM
        CPOE_OVERVIEW_ITEM
    WHERE
        NR_SEQUENCIA = NR_SEQ_CPOE_OVERVIEW_ITEM_P;

    SELECT * FROM obter_info_cpoe_overview_item(
        NR_SEQ_ITEM_CPOE_P       => NR_SEQ_ITEM_CPOE_W, IE_TIPO_ITEM_P           => IE_TIPO_ITEM_W, NR_SEQ_CPOE_ORDER_UNIT_P => NR_SEQ_CPOE_ORDER_UNIT_O_W, NR_SEQ_CPOE_RP_P         => NR_SEQ_CPOE_RP_O_W
    ) INTO STRICT NR_SEQ_CPOE_ORDER_UNIT_P => NR_SEQ_CPOE_ORDER_UNIT_O_W, NR_SEQ_CPOE_RP_P         => NR_SEQ_CPOE_RP_O_W
;

    IF (NOT coalesce(NR_SEQ_CPOE_ORDER_UNIT_O_W::text, '') = '') THEN
        SELECT MAX(NR_SEQUENCIA) INTO STRICT NR_SEQ_CPOE_ORDER_UNIT_N_W FROM CPOE_ORDER_UNIT WHERE NR_SEQ_PREV_ORDER_UNIT = NR_SEQ_CPOE_ORDER_UNIT_O_W and (DT_LIBERACAO IS NOT NULL AND DT_LIBERACAO::text <> '');
        IF (coalesce(NR_SEQ_CPOE_ORDER_UNIT_N_W::text, '') = '') THEN
            SELECT nextval('cpoe_order_unit_seq') INTO STRICT NR_SEQ_CPOE_ORDER_UNIT_N_W;
			INSERT INTO CPOE_ORDER_UNIT(
				NR_SEQUENCIA             ,
				DT_ATUALIZACAO           ,
				NM_USUARIO               ,
				DT_ATUALIZACAO_NREC      ,
				NM_USUARIO_NREC          ,
				NR_ORDER_UNIT            ,
				SI_TYPE_OF_PRESCRIPTION  ,
				SI_CPOE_TYPE_OF_ITEM     ,
				NR_SEQ_CPOE_TIPO_PEDIDO  ,
				DT_START                 ,
				DT_END                   ,
				CD_PESSOA_FISICA         ,
				NR_ATENDIMENTO           ,
				IE_SITUACAO              ,
				CD_SETOR_EXECUCAO        ,
				NR_SEQ_NAIS_INSURANCE    ,
				IE_DRUG_INFO             ,
				SI_SAME_DOSE             ,
				SI_DRUG_ADJUSTMENT       ,
				SI_PROVIDE_INFO_INSURANCE,
				SI_DISPENSE_MED_INSURANCE,
				IE_TIPO_RECEITA          ,
				ID_DISPENSE_FOR_QUESTION ,
				ID_PROVIDE_INFO_MEDICAL  ,
				CD_SETOR_COLETA          ,
				NR_SEQ_PREV_ORDER_UNIT
			)
			SELECT
				NR_SEQ_CPOE_ORDER_UNIT_N_W,
				clock_timestamp()                   ,
				NM_USUARIO_P              ,
				clock_timestamp()                   ,
				NM_USUARIO_P              ,
				NR_ORDER_UNIT             ,
				SI_TYPE_OF_PRESCRIPTION   ,
				SI_CPOE_TYPE_OF_ITEM      ,
				NR_SEQ_CPOE_TIPO_PEDIDO   ,
				DT_START                  ,
				DT_END                    ,
				CD_PESSOA_FISICA          ,
				NR_ATENDIMENTO            ,
				'A'               ,
				CD_SETOR_EXECUCAO         ,
				NR_SEQ_NAIS_INSURANCE     ,
				IE_DRUG_INFO              ,
				SI_SAME_DOSE              ,
				SI_DRUG_ADJUSTMENT        ,
				SI_PROVIDE_INFO_INSURANCE ,
				SI_DISPENSE_MED_INSURANCE ,
				IE_TIPO_RECEITA           ,
				ID_DISPENSE_FOR_QUESTION  ,
				ID_PROVIDE_INFO_MEDICAL   ,
				CD_SETOR_COLETA           ,
				NR_SEQ_CPOE_ORDER_UNIT_O_W
			FROM
				CPOE_ORDER_UNIT
			WHERE
				NR_SEQUENCIA = NR_SEQ_CPOE_ORDER_UNIT_O_W;
        END IF;
    END IF;

    IF (NOT coalesce(NR_SEQ_CPOE_RP_O_W::text, '') = '') THEN
        SELECT MAX(NR_SEQUENCIA) INTO STRICT NR_SEQ_CPOE_RP_N_W FROM CPOE_RP WHERE NR_SEQ_PREV_RP = NR_SEQ_CPOE_RP_O_W and NR_SEQ_CPOE_ORDER_UNIT = NR_SEQ_CPOE_ORDER_UNIT_N_W;
        IF (coalesce(NR_SEQ_CPOE_RP_N_W::text, '') = '') THEN
            SELECT nextval('cpoe_rp_seq') INTO STRICT NR_SEQ_CPOE_RP_N_W;

			INSERT INTO CPOE_RP(
				NR_SEQUENCIA            ,
				NR_SEQUENCIA_RP         ,
				IE_VIA_APLICACAO        ,
				DT_ATUALIZACAO          ,
				NM_USUARIO              ,
				DT_ATUALIZACAO_NREC     ,
				NM_USUARIO_NREC         ,
				CD_INTERVALO            ,
				DS_HORARIOS             ,
				DT_INICIO               ,
				DT_FIM                  ,
				NR_SEQ_CPOE_ORDER_UNIT  ,
				QT_DIAS_PADRAO          ,
				IE_SEGUNDA              ,
				IE_TERCA                ,
				IE_QUARTA               ,
				IE_QUINTA               ,
				IE_SEXTA                ,
				IE_SABADO               ,
				IE_DOMINGO              ,
				NR_SEQ_START_PERIOD     ,
				NR_SEQ_SUBGRUPO_INTERVAL,
				NR_SEQ_GRUPO_INTERVAL   ,
				IE_ENABLE_END_DT        ,
				SI_TEMPORARY_ADMIN      ,
				IE_ALLOW_EXECUTION      ,
				QT_OPERACAO             ,
				QT_DOSAGEM              ,
				QT_TEMPO_APLICACAO      ,
				NR_ETAPAS               ,
				IE_BOMBA_INFUSAO        ,
				QT_HORA_FASE            ,
				IE_TIPO_SOLUCAO         ,
				IE_TIPO_DOSAGEM         ,
				IE_REF_CALCULO          ,
				IE_DRIP_SHOT            ,
				NR_SEQ_PREV_RP			,
				IE_URGENCIA           	,
				IE_ADMINISTRACAO      	,
				QT_SOLUCAO_TOTAL      	,
				QT_VOLUME             	,
				IE_TIPO_ANALGESIA     	,
				IE_PCA_MODO_PROG      	,
				QT_DOSE_INICIAL_PCA   	,
				IE_UM_DOSE_INICIO_PCA 	,
				IE_UM_FLUXO_PCA       	,
				QT_VOL_INFUSAO_PCA    	,
				QT_BOLUS_PCA          	,
				IE_UM_BOLUS_PCA       	,
				QT_INTERVALO_BLOQUEIO 	,
				QT_LIMITE_QUATRO_HORA 	,
				IE_UM_LIMITE_PCA      	,
				QT_LIMITE_UMA_HORA    	,
				IE_UM_LIMITE_HORA_PCA 	,
				SI_RAPID_INFUSION     	,
				QT_FINAL_CONCENTRATION	,
				IE_INCREMENTAR        	,
				IE_TIPO_DOSAGEM_INC   	,
				IE_UM_FINAL_CONC_PCA  	,
				QT_DOSAGEM_INC        	,
				IE_FATOR_CORRECAO     	,
				QT_DOSE_TERAPEUTICA   	,
				QT_DOSAGEM_MIN        	,
				CD_UNID_MEDIC_TERAP   	,
				QT_DOSAGEM_MAX        	,
				IE_EVENTO_UNICO       	,
				IE_DIFFERENTIATED_DOSE	,
				NR_OCORRENCIA         	,
				DT_SUSPENSAO          	,
				NM_USUARIO_SUSP       	,
				DT_LIB_SUSPENSAO      	,
				QT_BLD_GLUCOSE
			)
			SELECT
				NR_SEQ_CPOE_RP_N_W        ,   
				NR_SEQUENCIA_RP           ,
				IE_VIA_APLICACAO          ,
				clock_timestamp()                   ,
				NM_USUARIO_P              ,
				clock_timestamp()                   ,
				NM_USUARIO_P              ,
				CD_INTERVALO              ,
				DS_HORARIOS               ,
				DT_INICIO                 ,
				DT_FIM                    ,
				NR_SEQ_CPOE_ORDER_UNIT_N_W,
				QT_DIAS_PADRAO            ,
				IE_SEGUNDA                ,
				IE_TERCA                  ,
				IE_QUARTA                 ,
				IE_QUINTA                 ,
				IE_SEXTA                  ,
				IE_SABADO                 ,
				IE_DOMINGO                ,
				NR_SEQ_START_PERIOD       ,
				NR_SEQ_SUBGRUPO_INTERVAL  ,
				NR_SEQ_GRUPO_INTERVAL     ,
				IE_ENABLE_END_DT          ,
				SI_TEMPORARY_ADMIN        ,
				IE_ALLOW_EXECUTION        ,
				QT_OPERACAO               ,
				QT_DOSAGEM                ,
				QT_TEMPO_APLICACAO        ,
				NR_ETAPAS                 ,
				IE_BOMBA_INFUSAO          ,
				QT_HORA_FASE              ,
				IE_TIPO_SOLUCAO           ,
				IE_TIPO_DOSAGEM           ,
				IE_REF_CALCULO            ,
				IE_DRIP_SHOT              ,
				NR_SEQ_CPOE_RP_O_W		  ,
				IE_URGENCIA           	  ,
				IE_ADMINISTRACAO      	  ,
				QT_SOLUCAO_TOTAL      	  ,
				QT_VOLUME             	  ,
				IE_TIPO_ANALGESIA     	  ,
				IE_PCA_MODO_PROG      	  ,
				QT_DOSE_INICIAL_PCA   	  ,
				IE_UM_DOSE_INICIO_PCA 	  ,
				IE_UM_FLUXO_PCA       	  ,
				QT_VOL_INFUSAO_PCA    	  ,
				QT_BOLUS_PCA          	  ,
				IE_UM_BOLUS_PCA       	  ,
				QT_INTERVALO_BLOQUEIO 	  ,
				QT_LIMITE_QUATRO_HORA 	  ,
				IE_UM_LIMITE_PCA      	  ,
				QT_LIMITE_UMA_HORA    	  ,
				IE_UM_LIMITE_HORA_PCA 	  ,
				SI_RAPID_INFUSION     	  ,
				QT_FINAL_CONCENTRATION	  ,
				IE_INCREMENTAR        	  ,
				IE_TIPO_DOSAGEM_INC   	  ,
				IE_UM_FINAL_CONC_PCA  	  ,
				QT_DOSAGEM_INC        	  ,
				IE_FATOR_CORRECAO     	  ,
				QT_DOSE_TERAPEUTICA   	  ,
				QT_DOSAGEM_MIN        	  ,
				CD_UNID_MEDIC_TERAP   	  ,
				QT_DOSAGEM_MAX        	  ,
				IE_EVENTO_UNICO       	  ,
				IE_DIFFERENTIATED_DOSE	  ,
				NR_OCORRENCIA         	  ,
				DT_SUSPENSAO          	  ,
				NM_USUARIO_SUSP       	  ,
				DT_LIB_SUSPENSAO      	  ,
				QT_BLD_GLUCOSE
			FROM
				CPOE_RP
			WHERE
				NR_SEQUENCIA = NR_SEQ_CPOE_RP_O_W;
		END IF;
    END IF;

    RAISE NOTICE 'NR_SEQ_CPOE_ORDER_UNIT_O_W..: % -> %', TO_CHAR(NR_SEQ_CPOE_ORDER_UNIT_O_W), TO_CHAR(NR_SEQ_CPOE_ORDER_UNIT_N_W);
    RAISE NOTICE 'NR_SEQ_CPOE_RP_O_W..........: % -> %', TO_CHAR(NR_SEQ_CPOE_RP_O_W), TO_CHAR(NR_SEQ_CPOE_RP_N_W);
    commit;

    NR_SEQ_CPOE_ORDER_UNIT_P := NR_SEQ_CPOE_ORDER_UNIT_N_W;
    NR_SEQ_CPOE_RP_P := NR_SEQ_CPOE_RP_N_W;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copia_info_cpoe_overview_item ( NR_SEQ_CPOE_OVERVIEW_ITEM_P bigint , NM_USUARIO_P text, NR_SEQ_CPOE_ORDER_UNIT_P INOUT bigint , NR_SEQ_CPOE_RP_P INOUT bigint ) FROM PUBLIC;

