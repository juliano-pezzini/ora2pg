-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ptu_gerar_mov_benef_compl ( nr_seq_beneficiario_p bigint, cd_pessoa_fisica_p text, nm_usuario_p text) AS $body$
DECLARE



nr_seq_beneficiario_w		bigint;
ds_endereco_w			varchar(100);
cd_cep_w			integer;
nm_municipio_w			varchar(30);
sg_uf_w				compl_pessoa_fisica.sg_estado%type;
ds_bairro_w			varchar(30);
nr_ddd_w				smallint;
nr_fone_w			integer;
nr_ramal_w			smallint;

C01 CURSOR FOR
	SELECT	substr(ds_endereco,1,40),
		cd_cep,
		ds_municipio,
		sg_estado,
		substr(ds_bairro,1,30),
		nr_ddd_telefone,
		nr_telefone,
		nr_ramal
	from	compl_pessoa_fisica
	where	cd_pessoa_fisica	= cd_pessoa_fisica_p
	and	ie_tipo_complemento	= 1;


BEGIN
open C01;
loop
fetch C01 into
	ds_endereco_w,
	cd_cep_w,
	nm_municipio_w,
	sg_uf_w,
	ds_bairro_w,
	nr_ddd_w,
	nr_fone_w,
	nr_ramal_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin

	if (coalesce(ds_endereco_w::text, '') = '') then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(267455,
							'CD_PESSOA_FISICA_P=' || cd_pessoa_fisica_p);
	end if;

	if (coalesce(cd_cep_w::text, '') = '') then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(267456,
							'CD_PESSOA_FISICA_P=' || cd_pessoa_fisica_p);
	end if;

        if (coalesce(nm_municipio_w::text, '') = '') then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(267457,
							'CD_PESSOA_FISICA_P=' || cd_pessoa_fisica_p);
	end if;

	if (coalesce(sg_uf_w::text, '') = '') then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(267458,
							'CD_PESSOA_FISICA_P=' || cd_pessoa_fisica_p);
	end if;

	insert into ptu_movimento_benef_compl(nr_sequencia, nr_seq_beneficiario, ds_endereco,
		cd_cep, nm_municipio, sg_uf,
		dt_atualizacao, nm_usuario, dt_atualizacao_nrec,
		nm_usuario_nrec, ds_bairro, nr_ddd,
		nr_fone, nr_ramal)
	values (nextval('ptu_movimento_benef_compl_seq'), nr_seq_beneficiario_p, ds_endereco_w,
		cd_cep_w, nm_municipio_w, sg_uf_w,
		clock_timestamp(), nm_usuario_p, clock_timestamp(),
		nm_usuario_p, ds_bairro_w, nr_ddd_w,
		nr_fone_w, nr_ramal_w);
	end;
end loop;
close C01;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ptu_gerar_mov_benef_compl ( nr_seq_beneficiario_p bigint, cd_pessoa_fisica_p text, nm_usuario_p text) FROM PUBLIC;

