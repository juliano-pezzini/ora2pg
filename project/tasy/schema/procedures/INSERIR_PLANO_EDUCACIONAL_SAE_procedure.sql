-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_plano_educacional_sae ( nr_seq_prescr_proc_p bigint, nr_seq_prescr_proc_novo_p bigint) AS $body$
DECLARE


qt_registro_w					integer;
nr_sequencia_w					pe_prescr_proc_educ.nr_sequencia%type;


BEGIN

if (nr_seq_prescr_proc_p IS NOT NULL AND nr_seq_prescr_proc_p::text <> '' AND nr_seq_prescr_proc_novo_p IS NOT NULL AND nr_seq_prescr_proc_novo_p::text <> '') then


	select	coalesce(max(nr_sequencia),0)
	into STRICT	nr_sequencia_w
	from	pe_prescr_proc_educ
	where	nr_seq_prescr_proc	= nr_seq_prescr_proc_p
	and		nm_usuario 			= wheb_usuario_pck.get_nm_usuario;
	

	if (nr_sequencia_w > 0) then

	insert into pe_prescr_proc_educ(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			cd_profissional,
			dt_registro,
			nr_seq_prescr_proc,
			ie_orientado_paciente,
			ie_orientado_pai,
			ie_orientado_mae,
			ie_orientado_conjuge,
			ie_orientado_filho,
			ie_orientado_cuidador,
			ie_orientado_outros,
			ie_metodo_demonstracao,
			ie_metodo_verbal,
			ie_metodo_folheto,
			ie_metodo_audio_visual,
			ie_metodo_outro,
			ie_tipo_evolucao,
			dt_liberacao,
			ie_entendimento,
			ie_objetivo_atingido,
			cd_setor_atendimento,
			nr_seq_assinatura,
			nr_seq_assinat_inativacao,
			dt_inativacao,
			nm_usuario_inativacao,
			ds_justificativa,
			ie_situacao)
	SELECT	nextval('pe_prescr_proc_educ_seq'),
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			cd_profissional,
			dt_registro,
			nr_seq_prescr_proc_novo_p,
			ie_orientado_paciente,
			ie_orientado_pai,
			ie_orientado_mae,
			ie_orientado_conjuge,
			ie_orientado_filho,
			ie_orientado_cuidador,
			ie_orientado_outros,
			ie_metodo_demonstracao,
			ie_metodo_verbal,
			ie_metodo_folheto,
			ie_metodo_audio_visual,
			ie_metodo_outro,
			ie_tipo_evolucao,
			dt_liberacao,
			ie_entendimento,
			ie_objetivo_atingido,
			cd_setor_atendimento,
			nr_seq_assinatura,
			nr_seq_assinat_inativacao,
			dt_inativacao,
			nm_usuario_inativacao,
			ds_justificativa,
			ie_situacao
	from	pe_prescr_proc_educ
	where	nr_seq_prescr_proc		= nr_seq_prescr_proc_p
	and		nr_sequencia		    = nr_sequencia_w;
	end if;
if (coalesce(wheb_usuario_pck.get_ie_commit, 'S') = 'S') then commit; end if;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_plano_educacional_sae ( nr_seq_prescr_proc_p bigint, nr_seq_prescr_proc_novo_p bigint) FROM PUBLIC;

