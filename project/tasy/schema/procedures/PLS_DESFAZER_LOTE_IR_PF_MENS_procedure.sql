-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_desfazer_lote_ir_pf_mens ( nr_seq_lote_p bigint, nm_usuario_p text) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: Desfazer Lote IR PF
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [X] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
C01 CURSOR(nr_seq_lote_pc bigint) FOR
	SELECT	nr_sequencia
	from	pls_mens_pagador_ir
	where	nr_seq_lote	= nr_seq_lote_pc;

C02 CURSOR(nr_seq_pagador_ir_pc bigint) FOR
	SELECT	nr_sequencia
	from	pls_mens_beneficiario_ir
	where	nr_seq_pagador_ir	= nr_seq_pagador_ir_pc;

C03 CURSOR(nr_seq_segurado_ir_pc bigint) FOR
	SELECT	nr_sequencia
	from	pls_mens_valores_ir
	where	nr_seq_benef_ir		= nr_seq_segurado_ir_pc;
BEGIN

for r_C01_w in C01(nr_seq_lote_p) loop
	begin
	for r_C02_w in C02(r_C01_w.nr_sequencia) loop
		begin
		for r_C03_w in C03(r_C02_w.nr_sequencia) loop
			begin

			delete	FROM pls_mens_detalhe_ir
			where	nr_seq_valores_ir	= r_C03_w.nr_sequencia;

			end;
		end loop;

		delete	FROM PLS_MENS_VALORES_IR
		where	NR_SEQ_BENEF_IR	= r_C02_w.nr_sequencia;

		delete	FROM pls_mens_beneficiario_ir
		where	nr_sequencia	 = r_C02_w.nr_sequencia;

		end;
	end loop;

	delete	FROM pls_mens_ir_log_envio
	where	nr_seq_pagador_ir = r_C01_w.nr_sequencia;

	delete	FROM pls_mens_pagador_ir
	where	nr_sequencia	= r_C01_w.nr_sequencia;

	end;
end loop;

update	PLS_LOTE_MENS_IR
set	DT_GERACAO_LOTE	 = NULL
where	nr_sequencia	= nr_seq_lote_p;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_desfazer_lote_ir_pf_mens ( nr_seq_lote_p bigint, nm_usuario_p text) FROM PUBLIC;

