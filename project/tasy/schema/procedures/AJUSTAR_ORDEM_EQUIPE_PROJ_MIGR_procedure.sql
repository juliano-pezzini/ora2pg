-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ajustar_ordem_equipe_proj_migr (nr_seq_projeto_p bigint) AS $body$
DECLARE


nr_seq_projeto_w	bigint;
nr_seq_equipe_w		bigint;
nr_seq_integrante_w	bigint;
ie_ordem_rec_migr_w	smallint;
ie_ordem_sit_rec_w	smallint;
nr_seq_projeto_old_w	bigint := 0;
nr_seq_ordem_w		bigint;

c01 CURSOR FOR
SELECT	p.nr_sequencia,
	e.nr_sequencia,
	i.nr_sequencia,
	CASE WHEN i.ie_funcao_rec_migr='M' THEN 1 WHEN i.ie_funcao_rec_migr='R' THEN 2 WHEN i.ie_funcao_rec_migr='T' THEN 3 END  ie_ordem_rec_migr,
	CASE WHEN i.ie_situacao='I' THEN 1  ELSE 2 END  ie_ordem_sit_rec
from	proj_equipe_papel i,
	proj_equipe e,
	proj_projeto p
where	i.nr_seq_equipe = e.nr_sequencia
and	e.nr_seq_proj = p.nr_sequencia
and	e.nr_seq_equipe_funcao = 11
and	p.nr_seq_gerencia = 9
and	p.nr_seq_classif = 14
and	p.nr_sequencia = coalesce(nr_seq_projeto_p, p.nr_sequencia)
order by
	p.nr_sequencia,
	i.nr_seq_funcao desc,
	ie_ordem_rec_migr,
	ie_ordem_sit_rec;



BEGIN
open c01;
loop
fetch c01 into	nr_seq_projeto_w,
		nr_seq_equipe_w,
		nr_seq_integrante_w,
		ie_ordem_rec_migr_w,
		ie_ordem_sit_rec_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin
	if (nr_seq_projeto_w <> nr_seq_projeto_old_w) then
		begin
		nr_seq_ordem_w := 20;
		end;
	else
		begin
		nr_seq_ordem_w := nr_seq_ordem_w + 20;
		end;
	end if;

	update	proj_equipe_papel
	set	nr_seq_apres = nr_seq_ordem_w
	where	nr_sequencia = nr_seq_integrante_w;

	nr_seq_projeto_old_w := nr_seq_projeto_w;
	end;
end loop;
close c01;
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ajustar_ordem_equipe_proj_migr (nr_seq_projeto_p bigint) FROM PUBLIC;

