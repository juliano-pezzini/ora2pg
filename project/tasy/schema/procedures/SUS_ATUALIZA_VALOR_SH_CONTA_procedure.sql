-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE sus_atualiza_valor_sh_conta ( nr_interno_conta_p bigint, nm_usuario_p text) AS $body$
DECLARE


qt_registros_w			bigint;


BEGIN

select	count(1)
into STRICT	qt_registros_w
from	sus_regra_rateio_sh
where	coalesce(ie_sus_unificado,'N')	= 'S'  LIMIT 1;

if (qt_registros_w	> 0)	then
	begin

	/* eliminar registros anteriores */

	delete	from w_conta_sus_sh
	where	nr_interno_conta	= nr_interno_conta_p;
	/*insere os valores na tabela w_conta_sus_sh*/

	CALL sus_gerar_itens_sh(nr_interno_conta_p,nm_usuario_p);
	/*calcula os valores do rateio*/

	CALL sus_calcula_valor_sh(nr_interno_conta_p,nm_usuario_p);
	/*atualiza a receita as taxas*/

	CALL sus_atualiza_receita_sh(nr_interno_conta_p,nm_usuario_p);
	/*atualizar os valores da conta paciente*/

	CALL Sus_Atualiza_Itens_SH_conta(nr_interno_conta_p,nm_usuario_p);

	if (coalesce(wheb_usuario_pck.get_ie_commit, 'S') = 'S') then commit; end if;

	CALL atualizar_valor_proc_sus(nr_interno_conta_p);
	end;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE sus_atualiza_valor_sh_conta ( nr_interno_conta_p bigint, nm_usuario_p text) FROM PUBLIC;

