-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pep_envia_doenca_previa (NR_SEQ_PROBLEMA_P bigint) AS $body$
DECLARE




  IE_CONSTAR_DOENCA_PREVIA_W LISTA_PROBLEMA_PAC.IE_CONSTAR_DOENCA_PREVIA%TYPE;



  CD_DOENCA_W LISTA_PROBLEMA_PAC.CD_DOENCA%TYPE;



  DS_PROBLEMA_W LISTA_PROBLEMA_PAC.DS_PROBLEMA%TYPE;



  CD_PESSOA_W LISTA_PROBLEMA_PAC.CD_PESSOA_FISICA%TYPE;



  NR_SEQ_ANTECEDENTE_W PACIENTE_ANTEC_CLINICO.NR_SEQUENCIA%TYPE;




BEGIN



  SELECT LP.IE_CONSTAR_DOENCA_PREVIA,



         LP.CD_DOENCA,

         

         LP.DS_PROBLEMA,

         

         LP.CD_PESSOA_FISICA

  

    INTO STRICT IE_CONSTAR_DOENCA_PREVIA_W,

         

         CD_DOENCA_W,

         

         DS_PROBLEMA_W,

         

         CD_PESSOA_W

  

    FROM LISTA_PROBLEMA_PAC LP

  

   WHERE LP.NR_SEQUENCIA = NR_SEQ_PROBLEMA_P;



  IF (IE_CONSTAR_DOENCA_PREVIA_W = 'S') THEN

    SELECT nextval('paciente_antec_clinico_seq')
    INTO STRICT NR_SEQ_ANTECEDENTE_W
;


    IF (CD_DOENCA_W IS NOT NULL AND CD_DOENCA_W::text <> '') THEN

    

      INSERT INTO PACIENTE_ANTEC_CLINICO(NR_SEQUENCIA,

         CD_PESSOA_FISICA,

         DT_REGISTRO,

         NM_USUARIO,

         CD_DOENCA,

         DT_ATUALIZACAO)

      

      VALUES (NR_SEQ_ANTECEDENTE_W,

         

         CD_PESSOA_W,

         

         clock_timestamp(),

         

         WHEB_USUARIO_PCK.GET_NM_USUARIO,

         

         CD_DOENCA_W,

         

         clock_timestamp());



      COMMIT;



    ELSE

    

      IF (DS_PROBLEMA_W IS NOT NULL AND DS_PROBLEMA_W::text <> '') THEN

      

        INSERT INTO PACIENTE_ANTEC_CLINICO(NR_SEQUENCIA,

           CD_PESSOA_FISICA,

           DT_REGISTRO,

           NM_USUARIO,

           DS_DOENCA,

           DT_ATUALIZACAO)

        

        VALUES (NR_SEQ_ANTECEDENTE_W,

           

           CD_PESSOA_W,

           

           clock_timestamp(),

           

           WHEB_USUARIO_PCK.GET_NM_USUARIO,

           

           DS_PROBLEMA_W,

           

           clock_timestamp());



        COMMIT;



      END IF;



    END IF;



    CALL LIBERAR_PACIENTE_DOENCA(NR_SEQ_ANTECEDENTE_W,

                            WHEB_USUARIO_PCK.GET_NM_USUARIO());

    COMMIT;



  END IF;



END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pep_envia_doenca_previa (NR_SEQ_PROBLEMA_P bigint) FROM PUBLIC;

