-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_ctb_plano_ans () AS $body$
DECLARE


c01 CURSOR FOR
	SELECT	vl_dominio,
		ds_valor_dominio
	from	valor_dominio
	where	cd_dominio = 1871;

c02 CURSOR FOR
	SELECT	nr_sequencia,
		cd_empresa,
		cd_plano,
		ie_versao
	from	conta_contabil_ans;

c03 CURSOR FOR
	SELECT	nr_sequencia,
		cd_empresa,
		cd_conta_ans,
		ie_versao_ans
	from	ctb_saldo_ans;

vl_dominio_w			varchar(15);
ds_valor_dominio_w		varchar(255);
nr_sequencia_w			bigint;
nr_seq_cta_contab_ans_w		bigint;
cd_empresa_w			integer;
cd_plano_w			bigint;
ie_versao_w			varchar(1);


BEGIN

open c01;
loop
fetch c01 into
	vl_dominio_w,
	ds_valor_dominio_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin

	select	nextval('ctb_versao_plano_ans_seq')
	into STRICT	nr_sequencia_w
	;

	insert into ctb_versao_plano_ans(	nr_sequencia,
					ds_versao_ans,
					dt_atualizacao,
					nm_usuario,
					dt_atualizacao_nrec,
					nm_usuario_nrec,
					dt_inicio_vigencia,
					dt_fim_vigencia)
			values (	nr_sequencia_w,
					ds_valor_dominio_w,
					clock_timestamp(),
					'Tasy',
					clock_timestamp(),
					'Tasy',
					to_date('01/01/2001','dd/mm/yyyy'),
					null);
	commit;

	update	ctb_plano_ans
	set	nr_seq_versao_plano = nr_sequencia_w
	where	ie_versao = vl_dominio_w;

	end;
end loop;
close c01;

commit;

open c02;
loop
fetch c02 into
	nr_sequencia_w,
	cd_empresa_w,
	cd_plano_w,
	ie_versao_w;
EXIT WHEN NOT FOUND; /* apply on c02 */
	begin

	select	max(nr_sequencia)
	into STRICT	nr_seq_cta_contab_ans_w
	from	ctb_plano_ans
	where	cd_empresa	= cd_empresa_w
	and	cd_plano	= cd_plano_w
	and	ie_versao	= ie_versao_w;

	update	conta_contabil_ans
	set	nr_seq_conta_ans = nr_seq_cta_contab_ans_w
	where	nr_sequencia 	 = nr_sequencia_w;

	end;
end loop;
close c02;

commit;

open c03;
loop
fetch c03 into
	nr_sequencia_w,
	cd_empresa_w,
	cd_plano_w,
	ie_versao_w;
EXIT WHEN NOT FOUND; /* apply on c03 */
	begin

	select	max(nr_sequencia)
	into STRICT	nr_seq_cta_contab_ans_w
	from	ctb_plano_ans
	where	cd_empresa	= cd_empresa_w
	and	cd_plano	= cd_plano_w
	and	ie_versao	= ie_versao_w;

	update	ctb_saldo_ans
	set	nr_seq_conta_ans = nr_seq_cta_contab_ans_w
	where	nr_sequencia 	 = nr_sequencia_w;

	end;
end loop;
close c03;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_ctb_plano_ans () FROM PUBLIC;

