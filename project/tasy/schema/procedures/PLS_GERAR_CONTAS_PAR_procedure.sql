-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gerar_contas_par ( nr_seq_conta_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE


				nr_seq_categoria_w		bigint	:= null;
nr_seq_tipo_acomodacao_w	bigint;
nr_seq_protocolo_w		bigint;
nr_seq_segurado_w		bigint;
nr_seq_prestador_w		bigint;
nr_seq_plano_w			bigint;
cd_guia_w			varchar(20);
cd_guia_referencia_w		varchar(20);
cd_guia_conta_w			varchar(20);
nr_seq_guia_w			bigint;
ie_status_guia_w		varchar(1);
ie_tipo_guia_w			varchar(2);
nr_seq_guia_ref_w		bigint;
nr_seq_segurado_guia_w		bigint;
nr_seq_prestador_exec_w		bigint;
cd_medico_executor_w		varchar(10);
nr_seq_grau_partic_w		bigint;
ds_erro_w			varchar(255);
ie_situacao_w			varchar(3);
qt_itens_w			bigint	:= 0;
qt_diagnostico_w		integer	:= 0;
nr_seq_guia_conta_w		bigint	:= 0;
ie_regime_internacao_w		varchar(1);
ie_consistir_guia_w		varchar(2);
ie_carater_internacao_w		varchar(1);
nr_seq_tipo_atendimento_w	bigint;
nr_seq_saida_spsadt_w		bigint;
cd_tiss_tipo_atendimento_w	varchar(20);
nr_seq_cbo_saude_w		bigint;
sg_conselho_exec_w		varchar(20);
nr_seq_conselho_exec_w		bigint;
ie_tipo_segurado_w		varchar(3);
ie_situacao_atend_w		varchar(1);
nr_seq_conta_proc_w		bigint;
nr_seq_conta_mat_w		bigint;
ie_consistencia_w		varchar(1);
ie_area_coberta_w		varchar(1);
dt_ref_atendimento_w		timestamp;
dt_envio_contas_w		timestamp;
dt_validade_carteira_w		varchar(30);
ie_origem_conta_w		varchar(5);
ie_tipo_conta_w			varchar(10);
cd_unimed_origem_w		bigint;
cd_unimed_destino_w		bigint;
nr_seq_intercambio_w		bigint;
nr_seq_transacao_w		bigint;
nr_seq_congenere_w		bigint;
nr_seq_congenere_benef_w	bigint;
cd_cooperativa_w		varchar(10);
qt_dia_envio_w			bigint;
cd_usuario_plano_w		varchar(30);
dt_inicio_vigencia_w		timestamp;
dt_contratacao_w		timestamp;
dt_rescisao_w			timestamp;
dt_limite_utilizacao_w		timestamp;
ie_conta_intercambio_w		varchar(10);
qt_benef_operadora_w		bigint;
dt_recebimento_fatura_w		timestamp;
cd_tipo_acomodacao_w		bigint;
qt_guias_w			bigint;
nr_seq_tipo_acomodacao_guia_w	bigint;
nr_seq_regra_w			bigint;
ie_permite_w			varchar(1);
cd_procedimento_w		bigint;
nr_seq_material_w		bigint;
qt_glosa_w			bigint;
nr_seq_prest_guia_execu_w	bigint;
ie_tipo_guia_prot_w		varchar(10);
ds_obs_glosa_w			varchar(255);
ie_internado_w			varchar(1)	:= 'N';
dt_protocolo_w			timestamp;
ie_tipo_despesa_w		varchar(1);
nr_seq_fatura_w			bigint;
nr_seq_cbo_saude_med_w		bigint;
nm_prestador_w			varchar(255);
nr_seq_conta_ref_w		bigint;
nr_seq_prestador_dif_w		bigint;
qt_dias_envio_contas_w		integer;
nr_seq_contrato_w 	 	bigint;
ie_tipo_beneficiario_w		varchar(5);
ie_tipo_plano_w			varchar(5);
ie_tipo_contratacao_w		varchar(2);
ie_participacao_w		varchar(1);
ie_preco_plano_w		varchar(2);
dt_ref_glosa_w			timestamp;
dt_max_item_w			timestamp;
dt_max_proc_w			timestamp;
dt_max_mat_w			timestamp;
nr_seq_analise_w		bigint;
ie_reconsistencia_w 		varchar(1) := 'N';
ie_internacao_w			varchar(1) := 'N';
ds_tipo_guia_ref_w		varchar(100);
ie_tipo_guia_ref_w		varchar(2);
ie_evento_w			varchar(2);
qt_conta_protocolo_w		integer;
ie_tipo_gat_w			varchar(10);
ie_provisao_producao_w		varchar(1);
ie_via_acesso_w			varchar(10);
tx_via_acesso_w			bigint;
dt_validade_senha_w		timestamp;
cd_senha_externa_w		varchar(30);
ie_tipo_pagador_w		varchar(2);
qt_dias_vencido_w		bigint;
qt_existe_fat_w			bigint;
nr_Seq_clinica_guia_w		bigint;
nr_Seq_clinica_w		bigint;
nr_seq_guia_ww			bigint;
cd_senha_externa_ww		varchar(30);
ie_atualiza_apresentado_w 	varchar(1);
ie_status_item_analise_w	varchar(2);
nr_seq_diagostico_w		bigint;
cd_doenca_alta_w		varchar(10);
cd_doenca_imp_w			varchar(10);
qt_participante_w		bigint	:= 0;
ds_conta_gerada_w		varchar(255);
vl_procedimento_imp_w		double precision;
qt_regra_abert_w		bigint;
nr_seq_protocolo_gerado_w	bigint;
ie_tipo_guia_conta_w		varchar(255);
cd_guia_referencia_conta_w	varchar(255);
nr_seq_segurado_conta_w		bigint;
nr_seq_conta_proc_hi_w		bigint;
ie_utilizar_regra_mat_w		varchar(1)	:= 'N';
ie_obriga_vinc_mat_w		varchar(255);
ie_tipo_preco_w			varchar(2);
ie_tipo_tabela_w		varchar(2);
nr_seq_regra_intercambio_w	bigint;
qt_dias_envio_conta_w		bigint;
dt_atendimento_w		timestamp;
dt_permitida_w			timestamp;


BEGIN
select	cd_guia,
	cd_guia_referencia,
	coalesce(cd_guia_referencia, cd_guia),
	nr_seq_tipo_acomodacao,
	nr_seq_protocolo,
	nr_seq_segurado,
	coalesce(ie_tipo_guia,'X'),
	coalesce(nr_seq_prestador_exec,0),
	cd_medico_executor,
	coalesce(nr_seq_grau_partic,0),
	ie_regime_internacao,
	ie_carater_internacao,
	nr_seq_tipo_atendimento,
	nr_seq_saida_spsadt,
	nr_seq_cbo_saude,
	nr_seq_conselho_exec,
	ie_origem_conta,
	coalesce(ie_tipo_conta,'O'),
	nr_seq_fatura,
	nr_seq_analise,
	cd_senha_externa,
	dt_atendimento_referencia
into STRICT	cd_guia_w,
	cd_guia_referencia_w,
	cd_guia_conta_w,
	nr_seq_tipo_acomodacao_w,
	nr_seq_protocolo_w,
	nr_seq_segurado_w,
	ie_tipo_guia_w,
	nr_seq_prestador_exec_w,
	cd_medico_executor_w,
	nr_seq_grau_partic_w,
	ie_regime_internacao_w,
	ie_carater_internacao_w,
	nr_seq_tipo_atendimento_w,
	nr_seq_saida_spsadt_w,
	nr_seq_cbo_saude_w,
	nr_seq_conselho_exec_w,
	ie_origem_conta_w,
	ie_conta_intercambio_w,
	nr_seq_fatura_w,
	nr_seq_analise_w,
	cd_senha_externa_ww,
	dt_ref_atendimento_w
from	pls_conta
where	nr_sequencia	= nr_seq_conta_p;

if (coalesce(nr_seq_segurado_w,0) > 0) then
	begin
	select	ie_tipo_segurado
	into STRICT	ie_tipo_segurado_w
	from	pls_segurado
	where	nr_sequencia	= nr_seq_segurado_w;
	exception
	when others then
		ie_tipo_segurado_w	:= null;
	end;

	/* Se a origem da conta for de A500, é recebida de outras operadoras */

	if (ie_origem_conta_w = 'A') then
		ie_tipo_conta_w	:= 'I';
	/* Se o tipo de beneficiário for Usuário eventual (Resp. Assumida), Intercâmbio entre OPS congêneres (Resp. Assumida) ou
		Intercâmbio entre cooperativas (Resp. Assumida) o tipo de conta é para ser faturado para outra operadora*/
	elsif (ie_tipo_segurado_w in ('I','C','T','H')) then
		ie_tipo_conta_w	:= 'C';
	else
		ie_tipo_conta_w	:= 'O';
	end if;
end if;

CALL pls_cta_gera_hono_indiv_pck.gera_conta_hono_indiv(  null, null, null,nr_seq_conta_p, null, nm_usuario_p,cd_estabelecimento_p);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_contas_par ( nr_seq_conta_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

