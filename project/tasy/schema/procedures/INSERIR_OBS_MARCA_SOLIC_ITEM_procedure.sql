-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_obs_marca_solic_item ( nr_solic_compra_p bigint) AS $body$
DECLARE


nr_item_solic_compra_w		integer;
cd_material_w			integer;
nr_seq_marca_w			bigint;
ds_observacao_w			varchar(255);

c01 CURSOR FOR
SELECT	nr_item_solic_compra,
	cd_material,
	nr_seq_marca
from	solic_compra_item
where	nr_solic_compra = nr_solic_compra_p;


BEGIN

open c01;
loop
fetch c01 into
	nr_item_solic_compra_w,
	cd_material_w,
	nr_seq_marca_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin

	select	max(substr(coalesce(ds_observacao,''),1,255))
	into STRICT	ds_observacao_w
	from	material_marca
	where	nr_sequencia = nr_seq_marca_w
	and	cd_material = cd_material_w;

	update	solic_compra_item
	set	ds_observacao = substr(coalesce(ds_observacao,'') || chr(13) || ds_observacao_w,1,255)
	where	nr_item_solic_compra = nr_item_solic_compra_w
	and	nr_solic_compra = nr_solic_compra_p;

	end;
end loop;
close c01;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_obs_marca_solic_item ( nr_solic_compra_p bigint) FROM PUBLIC;

