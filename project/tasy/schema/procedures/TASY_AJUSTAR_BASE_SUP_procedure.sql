-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE tasy_ajustar_base_sup ( nm_usuario_p text) AS $body$
DECLARE


dt_versao_atual_cliente_w 	timestamp;
qt_existe_w			bigint;
qt_existe_ww			bigint;
ie_gera_termo_nullable_w	varchar(1);
ie_nr_gera_alto_nullable_w	varchar(1);
cd_estabelecimento_w		estabelecimento.cd_estabelecimento%type;
ie_valor_consid_compra_w	parametro_compras.ie_valor_consid_compra%type;

c01 CURSOR FOR
SELECT	cd_estabelecimento
from	parametro_compras
group by cd_estabelecimento;


BEGIN

CALL abortar_se_base_wheb();

dt_versao_atual_cliente_w := coalesce(to_date(to_char(obter_data_geracao_versao-1,'dd/mm/yyyy') ||' 23:59:59','dd/mm/yyyy hh24:mi:ss'),clock_timestamp() - interval '90 days');



/*jonas - 08/01/2013*/

if (dt_versao_atual_cliente_w < to_date('08/01/2013','dd/mm/yyyy')) then
	begin
	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where table_name = 'CM_CIRURGIA'
	and column_name = 'DS_CIRURGIA';

	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('jonas', 'alter table CM_CIRURGIA modify DS_CIRURGIA varchar2(255)');
	end if;

	end;
end if;

if (dt_versao_atual_cliente_w < to_date('05/02/2013','dd/mm/yyyy')) then
	begin
	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'RELATORIO_AUTO_PARAM'
	and	column_name	= 'NR_SEQ_PARAMETRO';
	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('jonas', 'alter table RELATORIO_AUTO_PARAM drop column NR_SEQ_PARAMETRO');
	end if;
	end;
end if;

if (dt_versao_atual_cliente_w < to_date('14/02/2013','dd/mm/yyyy')) then
	CALL baca_recriar_pk_delegacao();
end if;


if (dt_versao_atual_cliente_w < to_date('28/02/2013','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	REGISTRO_INTEGR_COM_XML;

	if (qt_existe_w = 0) then

		select	count(*)
		into STRICT	qt_existe_w
		from	user_tab_columns
		where	table_name = 'REGISTRO_INTEGR_COM_XML'
		and	column_name = 'DS_XML'
		and	data_Type <> 'CLOB';

		if (qt_existe_w > 0) then
			begin
			CALL Exec_Sql_Dinamico('Maicon', 'ALTER TABLE REGISTRO_INTEGR_COM_XML modify DS_XML CLOB');
			end;
		end if;
	end if;
end if;


if (dt_versao_atual_cliente_w < to_date('05/03/2013','dd/mm/yyyy')) then
	CALL CRIAR_INSERT_LEGENDA_SC();
end if;

/* Pietro */

if (dt_versao_atual_cliente_w < to_date('15/03/2013','dd/mm/yyyy')) then
	CALL cme_ajusta_tamanho_campos();
end if;

if (dt_versao_atual_cliente_w < to_date('21/03/2013','dd/mm/yyyy')) then
	SELECT	COUNT(*)
	into STRICT	qt_existe_w
	FROM	user_triggers
	WHERE	trigger_name = 'NOTA_FISCAL_TRIB_UPDATE';

	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'drop trigger NOTA_FISCAL_TRIB_UPDATE');
	end if;
end if;

/*Maicon*/

if (dt_versao_atual_cliente_w < to_date('09/04/2013','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name = 'W_PROTHEUS_PEDIDO'
	and	column_name = 'DT_EMISSAO'
	and	data_Type <> 'DATE';

	if (qt_existe_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Maicon', 'ALTER TABLE W_PROTHEUS_PEDIDO modify DT_EMISSAO DATE');
		end;
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name = 'W_PROTHEUS_PEDIDO_ITEM'
	and	column_name = 'DT_ENTREGA'
	and	data_Type <> 'DATE';

	if (qt_existe_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Maicon', 'ALTER TABLE W_PROTHEUS_PEDIDO_ITEM modify DT_ENTREGA DATE');
		end;
	end if;
end if;

/*Maicon*/

if (dt_versao_atual_cliente_w < to_date('10/04/2013','dd/mm/yyyy')) then

	update VALOR_DOMINIO
	set DS_VALOR_DOMINIO = 'Classificado'
	where VL_DOMINIO = 'A'
	and cd_dominio = 3165;

	 update VALOR_DOMINIO
	 set DS_VALOR_DOMINIO = 'Desclassificado'
	 where VL_DOMINIO = 'I'
	 and cd_dominio = 3165;
end if;

if (dt_versao_atual_cliente_w < to_date('15/04/2013','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name = 'W_PROTHEUS_MOVTO_ESTOQUE'
	and	column_name = 'CD_CENTRO_CUSTO'
	and	data_Type <> 'VARCHAR2';

	if (qt_existe_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Maicon', 'ALTER TABLE W_PROTHEUS_MOVTO_ESTOQUE modify CD_CENTRO_CUSTO VARCHAR2(20)');
		end;
	end if;

end if;

if (dt_versao_atual_cliente_w < to_date('16/04/2013','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	tabela_sistema
	where	ie_restringe_estab = 'S'
	and 	nm_tabela = 'CM_CLASSIF_CONJUNTO';
	if (qt_existe_w > 0) then
		begin
		update	tabela_sistema
		set	ie_restringe_estab = 'N'
		where	nm_tabela = 'CM_CLASSIF_CONJUNTO';
		end;
	end if;

end if;

/*Maicon*/

if (dt_versao_atual_cliente_w < to_date('06/05/2013','dd/mm/yyyy')) then
	select	count(*)
	into STRICT	qt_existe_w
	from	user_constraints
	where	table_name = 'REGRA_QT_MINIMA_FORNEC_COT'
	and	constraint_name = 'REQTMIFC_GRUMATE_FK';
	if (qt_existe_w > 0) then
		CALL Exec_sql_dinamico('Maicon', 'alter table REGRA_QT_MINIMA_FORNEC_COT drop constraint REQTMIFC_GRUMATE_FK');
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'REGRA_QT_MINIMA_FORNEC_COT'
	and	column_name	= 'CD_GRUPO_MATERIAL';
	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'alter table REGRA_QT_MINIMA_FORNEC_COT drop column CD_GRUPO_MATERIAL');
	end if;


	select	count(*)
	into STRICT	qt_existe_w
	from	user_constraints
	where	table_name = 'REGRA_QT_MINIMA_FORNEC_COT'
	and	constraint_name = 'REQTMIFC_SUBMATE_FK';
	if (qt_existe_w > 0) then
		CALL Exec_sql_dinamico('Maicon', 'alter table REGRA_QT_MINIMA_FORNEC_COT drop constraint REQTMIFC_SUBMATE_FK');
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'REGRA_QT_MINIMA_FORNEC_COT'
	and	column_name	= 'CD_SUBGRUPO_MATERIAL';
	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'alter table REGRA_QT_MINIMA_FORNEC_COT drop column CD_SUBGRUPO_MATERIAL');
	end if;


	select	count(*)
	into STRICT	qt_existe_w
	from	user_constraints
	where	table_name = 'REGRA_QT_MINIMA_FORNEC_COT'
	and	constraint_name = 'REQTMIFC_CLAMATE_FK';
	if (qt_existe_w > 0) then
		CALL Exec_sql_dinamico('Maicon', 'alter table REGRA_QT_MINIMA_FORNEC_COT drop constraint REQTMIFC_CLAMATE_FK');
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'REGRA_QT_MINIMA_FORNEC_COT'
	and	column_name	= 'CD_CLASSE_MATERIAL';
	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'alter table REGRA_QT_MINIMA_FORNEC_COT drop column CD_CLASSE_MATERIAL');
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_constraints
	where	table_name = 'REGRA_QT_MINIMA_FORNEC_COT'
	and	constraint_name = 'REQTMIFC_MATERIA_FK';
	if (qt_existe_w > 0) then
		CALL Exec_sql_dinamico('Maicon', 'alter table REGRA_QT_MINIMA_FORNEC_COT drop constraint REQTMIFC_MATERIA_FK');
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'REGRA_QT_MINIMA_FORNEC_COT'
	and	column_name	= 'CD_MATERIAL';
	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'alter table REGRA_QT_MINIMA_FORNEC_COT drop column CD_MATERIAL');
	end if;
end if;


/*Maicon*/

if (dt_versao_atual_cliente_w < to_date('17/05/2013','dd/mm/yyyy')) then

	select count(*)
	into STRICT qt_existe_w
	from REGRA_ALTERACAO_OC
	where NM_TABELA = 'ORDEM_COMPRA'
	and NM_ATRIBUTO = 'DT_ENTREGA';

	if (qt_existe_w > 0) then

		delete from REGRA_ALTERACAO_OC
		where NM_TABELA = 'ORDEM_COMPRA'
		and NM_ATRIBUTO = 'DT_ENTREGA';
	end if;


	select	count(*)
	into STRICT	qt_existe_w
	from	valor_dominio
	where	VL_DOMINIO = 'JJ'
	and	cd_dominio = 5643;

	if (qt_existe_w > 0) then
		delete from valor_dominio
		where VL_DOMINIO = 'JJ'
		and	cd_dominio = 5643;
	end if;


END IF;

/*Pietro*/

if (dt_versao_atual_cliente_w < to_date('27/05/2013','dd/mm/yyyy')) then
	update	parametro_compras
	set	ie_data_base_venc_nf_consig = ie_data_base_venc_nota;
end if;

/*Maicon*/

if (dt_versao_atual_cliente_w < to_date('28/05/2013','dd/mm/yyyy')) then
	CALL gera_estrut_regra_media_compra();
end if;

/* rfoliveira */

if (dt_versao_atual_cliente_w < to_date('29/05/2013','dd/mm/yyyy')) then
	begin

	select	count(*)
	into STRICT	qt_existe_w
	from	user_triggers
	where	trigger_name = 'COT_COMPRA_FORN_ITEM_DELETE';

	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('RFOLIVEIRA', 'drop trigger COT_COMPRA_FORN_ITEM_DELETE');
	end if;

	end;
end if;

/*Maicon - 06/06/2013*/

if (dt_versao_atual_cliente_w < to_date('06/06/2013','dd/mm/yyyy')) then
	begin
	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name = 'W_ENVIA_SOLIC_ITEM_INTEG'
	and	column_name    = 'CD_LOCAL_ESTOQUE'
	and	data_type = 'NUMBER';

	CALL Exec_Sql_Dinamico('Maicon', 'delete from W_ENVIA_SOLIC_ITEM_INTEG');
	CALL Exec_Sql_Dinamico('Maicon', 'alter table W_ENVIA_SOLIC_ITEM_INTEG modify CD_LOCAL_ESTOQUE varchar2(10)');

	end;
end if;

/*Maicon - 06/06/2013*/

if (dt_versao_atual_cliente_w < to_date('28/06/2013','dd/mm/yyyy')) then
	CALL rop_ajustar_tipo_lavanderia();
end if;


/*maicon - 02/07/2013*/

if (dt_versao_atual_cliente_w < to_date('02/07/2013','dd/mm/yyyy')) then
	begin
	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name = 'W_MOVIMENTO_ESTOQUE'
	and	column_name    = 'CD_LOCAL_ESTOQUE'
	and	data_type <> 'VARCHAR2';

	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('maicon', 'alter table W_MOVIMENTO_ESTOQUE modify CD_LOCAL_ESTOQUE varchar2(80)');
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name = 'W_MOVIMENTO_ESTOQUE'
	and	column_name    = 'CD_MATERIAL'
	and	data_type <> 'VARCHAR2';

	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('maicon', 'alter table W_MOVIMENTO_ESTOQUE modify CD_MATERIAL varchar2(80)');
	end if;

		select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name = 'W_MOVIMENTO_ESTOQUE'
	and	column_name    = 'CD_MATERIAL_ESTOQUE'
	and	data_type <> 'VARCHAR2';

	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('maicon', 'alter table W_MOVIMENTO_ESTOQUE modify CD_MATERIAL_ESTOQUE varchar2(80)');
	end if;

	end;
end if;

/*maicon - 05/07/2013*/

if (dt_versao_atual_cliente_w < to_date('05/07/2013','dd/mm/yyyy')) then
	begin

	CALL Exec_Sql_Dinamico('Maicon', 'ALTER TRIGGER CONTRATO_REGRA_NF_ATUAL DISABLE');

	update	contrato_regra_nf
	set	ie_tipo_regra = 'NF'
	where	coalesce(ie_tipo_regra::text, '') = '';

	CALL Exec_Sql_Dinamico('Maicon', 'ALTER TRIGGER CONTRATO_REGRA_NF_ATUAL ENABLE');
	end;
end if;


/*maicon - 11/07/2013*/

if (dt_versao_atual_cliente_w < to_date('11/07/2013','dd/mm/yyyy')) then
	begin
	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name = 'W_LOTE_FORNEC'
	and	column_name    = 'CD_MATERIAL'
	and	data_type <> 'VARCHAR2';

	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('maicon', 'alter table W_LOTE_FORNEC modify CD_MATERIAL varchar2(80)');
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name = 'W_BIONEXO_CABECALHO'
	and	column_name    = 'NR_REQUISICAO'
	and	data_type <> 'VARCHAR2';

	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('maicon', 'alter table W_BIONEXO_CABECALHO modify NR_REQUISICAO varchar2(80)');
	end if;

	update	projeto_recurso
	set	ie_tipo_projeto = 'P';

	end;
end if;

/*maicon - 02/10/2013*/

if (dt_versao_atual_cliente_w < to_date('02/10/2013','dd/mm/yyyy')) then

	select 	count(*)
	into STRICT	qt_existe_w
	from	user_source
	where	name = 'IMPORTAR_ITEM_RATEIO';
	if (qt_existe_w > 0) then
		CALL exec_sql_dinamico('Maicon', 'drop procedure IMPORTAR_ITEM_RATEIO'
);
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	OBJETO_SISTEMA
	where	NM_OBJETO = 'IMPORTAR_ITEM_RATEIO';

	if (qt_existe_w > 0) then
		delete from OBJETO_SISTEMA where nm_objeto = 'IMPORTAR_ITEM_RATEIO';
	end if;

end if;

if (dt_versao_atual_cliente_w < to_date('18/11/2013','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	tabela_sistema
	where	nm_tabela = 'PSC_ATIVIDADES';

	if (qt_existe_w > 0) then
		begin
		delete from tabela_sistema
		where	nm_tabela = 'PSC_ATIVIDADES';
		end;
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tables
	where	table_name = 'PSC_ATIVIDADES';

	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'drop table PSC_ATIVIDADES');
	end if;

end if;

if (dt_versao_atual_cliente_w < to_date('19/11/2013','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	FUNCAO_PARAMETRO
	where	cd_funcao = 915
	and	nr_sequencia = 107
	and	vl_parametro = 'S';

	if (qt_existe_w = 0) then

		select	count(*)
		into STRICT	qt_existe_w
		from	FUNCAO_PARAM_ESTAB
		where	CD_FUNCAO = 915
		and	NR_SEQ_PARAM   = 107
		and	VL_PARAMETRO    = 'S';
	end if;

	if (qt_existe_w = 0) then

		select	count(*)
		into STRICT	qt_existe_w
		from	FUNCAO_PARAM_PERFIL
		where	CD_FUNCAO = 915
		and	nr_sequencia   = 107
		and	VL_PARAMETRO    = 'S';
	end if;

	if (qt_existe_w = 0) then

		select	count(*)
		into STRICT	qt_existe_w
		from	FUNCAO_PARAM_USUARIO
		where	CD_FUNCAO = 915
		and	nr_sequencia   = 107
		and	VL_PARAMETRO    = 'S';
	end if;

	if (qt_existe_w > 0) then

		update	parametro_compras
		set	ie_imp_mat_generico = 'S';

	end if;
end if;


if (dt_versao_atual_cliente_w < to_date('13/11/2013','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	tabela_visao_atributo
	where 	nr_sequencia = 17609;

	If (qt_existe_w  > 0) then
		update	tabela_visao_atributo
		set	ds_valores = 	'select	a.nr_sequencia cd, ' || chr(13) || chr(10) ||
					'	a.ds_motivo ds ' || chr(13) || chr(10) ||
					'from	motivo_req_conjunto a ' || chr(13) || chr(10) ||
					'where	a.cd_estabelecimento = :cd_estabelecimento ' || chr(13) || chr(10) ||
					'and	(((a.ie_emprestimo = :ie_emprestimo) or (a.ie_devolucao = :ie_devolucao)) or ' || chr(13) || chr(10) ||
					'	((a.ie_emprestimo = ''N'') and (a.ie_devolucao = ''N'')) or ' || chr(13) || chr(10) ||
					'	((:ie_emprestimo = ''N'') and (:ie_devolucao = ''N''))) ' || chr(13) || chr(10) ||
					'order by 2'
		where	nm_atributo = 'NR_SEQ_MOTIVO'
		and	nr_sequencia = 17609;
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	tabela_visao_atributo
	where 	nr_sequencia = 17559;

	If (qt_existe_w  > 0) then
		update	tabela_visao_atributo
		set	ds_valores = 	'select	a.nr_sequencia cd, ' || chr(13) || chr(10) ||
					'	a.ds_motivo ds ' || chr(13) || chr(10) ||
					'from	motivo_req_conjunto a ' || chr(13) || chr(10) ||
					'where	a.cd_estabelecimento = :cd_estabelecimento ' || chr(13) || chr(10) ||
					'and	(((a.ie_emprestimo = :ie_emprestimo) or (a.ie_devolucao = :ie_devolucao)) or ' || chr(13) || chr(10) ||
					'	((a.ie_emprestimo = ''N'') and (a.ie_devolucao = ''N'')) or ' || chr(13) || chr(10) ||
					'	((:ie_emprestimo = ''N'') and (:ie_devolucao = ''N''))) ' || chr(13) || chr(10) ||
					'order by 2'
		where	nm_atributo = 'NR_SEQ_MOTIVO'
		and	nr_sequencia = 17559;
	end if;
end if;

/*Maicon*/

if (dt_versao_atual_cliente_w < to_date('26/11/2013','dd/mm/yyyy')) then

	delete from tabela_visao_atributo
	where NM_ATRIBUTO = 'IE_EMAIL_DIA_UTIL'
	and nr_sequencia in (13542,13539,13546,13524,13545,13544,13518,13543,13537,19061,13535,13538,13521,19928,19927,19919,19924,19918,19916,19910,19929,19926,19925,19920,19920,19922);

	delete from TABELA_ATRIBUTO
	where NM_ATRIBUTO = 'IE_EMAIL_DIA_UTIL'
	and nm_tabela = 'PARAMETRO_COMPRAS';

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'PARAMETRO_COMPRAS'
	and	column_name	= 'IE_EMAIL_DIA_UTIL';
	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'alter table PARAMETRO_COMPRAS drop column IE_EMAIL_DIA_UTIL');
	end if;
end if;

/*Maicon*/

if (dt_versao_atual_cliente_w < to_date('28/11/2013','dd/mm/yyyy')) then
	CALL carregar_pendencia_contrato();
end if;

/*Maicon*/

if (dt_versao_atual_cliente_w < to_date('11/12/2013','dd/mm/yyyy')) then

	open C01;
	loop
	fetch C01 into
		cd_estabelecimento_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */
		begin

		select	ie_valor_consid_compra
		into STRICT	ie_valor_consid_compra_w
		from	parametro_compras
		where	cd_estabelecimento = cd_estabelecimento_w;

		if (ie_valor_consid_compra_w = 'A') then
			update	parametro_compras
			set	IE_CONSID_VALOR_OC_COMPRA = 'N',
				IE_CONSID_VALOR_SC_COMPRA = 'S',
				IE_CONSID_VALOR_CC_COMPRA = 'N'
			where	cd_estabelecimento = cd_estabelecimento_w;
		elsif (ie_valor_consid_compra_w = 'O') then
			update	parametro_compras
			set	IE_CONSID_VALOR_OC_COMPRA = 'S',
				IE_CONSID_VALOR_SC_COMPRA = 'N',
				IE_CONSID_VALOR_CC_COMPRA = 'N'
			where	cd_estabelecimento = cd_estabelecimento_w;
		elsif (ie_valor_consid_compra_w = 'S') then
			update	parametro_compras
			set	IE_CONSID_VALOR_OC_COMPRA = 'S',
				IE_CONSID_VALOR_SC_COMPRA = 'S',
				IE_CONSID_VALOR_CC_COMPRA = 'N'
			where	cd_estabelecimento = cd_estabelecimento_w;

		end if;


		end;
	end loop;
	close C01;

end if;

if (dt_versao_atual_cliente_w  < to_date('17/02/2016','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'NOTA_FISCAL_VENC'
	and	column_name	= 'IE_ORIGEM';

	IF (qt_existe_w > 0) THEN
		update	nota_fiscal_venc
		set	ie_origem = 'N'
		where	coalesce(ie_origem::text, '') = '';

		select count(*)
		into STRICT	qt_existe_w
		from user_tab_columns
		where table_name = 'NOTA_FISCAL_VENC'
		and COLUMN_NAME    = 'IE_ORIGEM'
		and NULLABLE = 'N';

		IF (qt_existe_w = 0) THEN
			CALL Exec_sql_Dinamico('Maicon',' alter table NOTA_FISCAL_VENC modify IE_ORIGEM varchar2(1) not null');
		END IF;
	END IF;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'NOTA_FISCAL_VENC_TRIB'
	and	column_name	= 'IE_ORIGEM';

	IF (qt_existe_w > 0) THEN
		update	NOTA_FISCAL_VENC_TRIB
		set	ie_origem = 'N'
		where	coalesce(ie_origem::text, '') = '';

		select count(*)
		into STRICT	qt_existe_w
		from user_tab_columns
		where table_name = 'NOTA_FISCAL_VENC_TRIB'
		and COLUMN_NAME    = 'IE_ORIGEM'
		and NULLABLE = 'N';

		IF (qt_existe_w = 0) THEN
			CALL Exec_sql_Dinamico('Maicon',' alter table NOTA_FISCAL_VENC_TRIB modify IE_ORIGEM varchar2(1) not null');
		END IF;
	END IF;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'NOTA_FISCAL_VENC_TRIB_PREV'
	and	column_name	= 'IE_ORIGEM';

	IF (qt_existe_w > 0) THEN

		update	NOTA_FISCAL_VENC_TRIB_PREV
		set	ie_origem = 'N'
		where	coalesce(ie_origem::text, '') = '';

		select count(*)
		into STRICT	qt_existe_w
		from user_tab_columns
		where table_name = 'NOTA_FISCAL_VENC_TRIB_PREV'
		and COLUMN_NAME    = 'IE_ORIGEM'
		and NULLABLE = 'N';

		IF (qt_existe_w = 0) THEN
			CALL Exec_sql_Dinamico('Maicon',' alter table NOTA_FISCAL_VENC_TRIB_PREV modify IE_ORIGEM varchar2(1) not null');
		END IF;
	END IF;

	COMMIT;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_constraints
	where	constraint_name = 'NFVTRIB_NOTFIVE_FK';

	if (qt_existe_w > 0) then
		CALL Exec_sql_Dinamico('Maicon','alter table NOTA_FISCAL_VENC_TRIB drop constraint NFVTRIB_NOTFIVE_FK');
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_constraints
	where	constraint_name = 'NFVTPRE_NOTFIVE_FK';

	if (qt_existe_w > 0) then
		CALL Exec_sql_Dinamico('Maicon','alter table NOTA_FISCAL_VENC_TRIB_PREV drop constraint NFVTPRE_NOTFIVE_FK');
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_constraints
	where	constraint_name = 'NOTFIVE_PK';

	if (qt_existe_w > 0) then
		CALL Exec_sql_Dinamico('Maicon','alter table NOTA_FISCAL_VENC drop constraint NOTFIVE_PK');
	end if;

	select  count(*)
	into STRICT	qt_existe_w
	from    user_indexes
	where	index_name = 'NOTFIVE_PK';

	if (qt_existe_w > 0) then
		CALL Exec_sql_Dinamico('Maicon','drop index NOTFIVE_PK');
	end if;

	select  count(*)
	into STRICT	qt_existe_w
	from    user_indexes
	where	index_name = 'NFVTRIB_NOTFIVE_FK_I';

	if (qt_existe_w > 0) then
		CALL Exec_sql_Dinamico('Maicon','drop index NFVTRIB_NOTFIVE_FK_I');
	end if;

	select  count(*)
	into STRICT	qt_existe_w
	from    user_indexes
	where	index_name = 'NFVTPRE_NOTFIVE_FK_I';

	if (qt_existe_w > 0) then
		CALL Exec_sql_Dinamico('Maicon','drop index NFVTPRE_NOTFIVE_FK_I');
	end if;



	SELECT 	COUNT(*)
	into STRICT	qt_existe_w
	from	user_constraints
	where	constraint_name = 'NOTFIVE_PK';
	if (qt_existe_w = 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'Alter Table NOTA_FISCAL_VENC add ( Constraint NOTFIVE_PK Primary Key (NR_SEQUENCIA,DT_VENCIMENTO,IE_ORIGEM))');
	end if;

	select  count(*)
	into STRICT	qt_existe_w
	from    user_indexes
	where	index_name = 'NOTFIVE_PK';
	if (qt_existe_w = 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'Create  Index NOTFIVE_PK on NOTA_FISCAL_VENC(NR_SEQUENCIA,DT_VENCIMENTO,IE_ORIGEM)');
	end if;



	SELECT 	COUNT(*)
	into STRICT	qt_existe_w
	from	user_constraints
	where	constraint_name = 'NFVTRIB_NOTFIVE_FK';
	if (qt_existe_w = 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'Alter Table NOTA_FISCAL_VENC_TRIB add ( Constraint NFVTRIB_NOTFIVE_FK Foreign Key ( NR_SEQUENCIA ,DT_VENCIMENTO,IE_ORIGEM) References NOTA_FISCAL_VENC ( NR_SEQUENCIA,DT_VENCIMENTO,IE_ORIGEM) on delete cascade)');
	end if;

	select  count(*)
	into STRICT	qt_existe_w
	from    user_indexes
	where	index_name = 'NFVTRIB_NOTFIVE_FK_I';
	if (qt_existe_w = 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'Create  Index NFVTRIB_NOTFIVE_FK_I on NOTA_FISCAL_VENC_TRIB(NR_SEQUENCIA,DT_VENCIMENTO,IE_ORIGEM)');
	end if;


	SELECT 	COUNT(*)
	into STRICT	qt_existe_w
	from	user_constraints
	where	constraint_name = 'NFVTPRE_NOTFIVE_FK';
	if (qt_existe_w = 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'Alter Table NOTA_FISCAL_VENC_TRIB_PREV add (Constraint NFVTPRE_NOTFIVE_FK Foreign Key (NR_SEQ_NOTA,DT_VENCIMENTO,IE_ORIGEM ) References NOTA_FISCAL_VENC (NR_SEQUENCIA,DT_VENCIMENTO,IE_ORIGEM) on delete cascade)');
	end if;

	select  count(*)
	into STRICT	qt_existe_w
	from    user_indexes
	where	index_name = 'NFVTPRE_NOTFIVE_FK_I';
	if (qt_existe_w = 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'Create  Index NFVTPRE_NOTFIVE_FK_I on NOTA_FISCAL_VENC_TRIB_PREV(NR_SEQ_NOTA,DT_VENCIMENTO,IE_ORIGEM)');
	end if;


end if;

if (dt_versao_atual_cliente_w  < to_date('27/02/2014','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name = 'REGRA_LIMITE_COMPRAS_APROV'
	and	column_name    = 'AAA';

	if (qt_existe_w > 0) then
		CALL Exec_sql_Dinamico('Jonas','delete from tabela_atributo where  NM_TABELA = ''REGRA_LIMITE_COMPRAS_APROV'' and nm_atributo = ''AAA ''');
	end if;


	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('maicon', 'alter table REGRA_LIMITE_COMPRAS_APROV drop column AAA');
	end if;

end if;

if (dt_versao_atual_cliente_w < to_date('21/03/2014','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'CONTRATO_ARQUIVO'
	and	column_name	= 'DS_ARQUIVO_BANCO';

	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'alter table CONTRATO_ARQUIVO drop column DS_ARQUIVO_BANCO');
		CALL Exec_Sql_Dinamico('Maicon', 'alter table CONTRATO_ARQUIVO ADD DS_ARQUIVO_BANCO BLOB');
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'SOLIC_COMPRA_ITEM_ANEXO'
	and	column_name	= 'DS_ARQUIVO_BANCO';

	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'alter table SOLIC_COMPRA_ITEM_ANEXO drop column DS_ARQUIVO_BANCO');
		CALL Exec_Sql_Dinamico('Maicon', 'alter table SOLIC_COMPRA_ITEM_ANEXO ADD DS_ARQUIVO_BANCO BLOB');
	end if;
end if;

if (dt_versao_atual_cliente_w < to_date('27/03/2014','dd/mm/yyyy')) then
	select	count(*)
	into STRICT	qt_existe_w
	from	user_source
	where	name = 'OBTER_MENOR_VALOR_COMPRA';

	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'drop function OBTER_MENOR_VALOR_COMPRA'
);
	end if;
end if;

if (dt_versao_atual_cliente_w < to_date('29/05/2014','dd/mm/yyyy')) then

	--MAN_ORDEM_SERVICO_MAT    MANORSEMAT_MANORSE_FK     Maicon     18/02/15         Integridade inexistente
	select	count(*)
	into STRICT  	qt_existe_w
	from	MAN_ORDEM_SERVICO_MAT a
	where	not exists ( SELECT 1
	from	MAN_ORDEM_SERVICO b
	where	1 = 1
	and	a.NR_SEQ_ORDEM_SERV = b.NR_SEQUENCIA)
	and	(a.NR_SEQ_ORDEM_SERV IS NOT NULL AND a.NR_SEQ_ORDEM_SERV::text <> '');

	if (qt_existe_w > 0) then
		CALL Exec_sql_Dinamico('Maicon','delete from	MAN_ORDEM_SERVICO_MAT a where	not exists ( select 1 from MAN_ORDEM_SERVICO b where	1 = 1 and	a.NR_SEQ_ORDEM_SERV = b.NR_SEQUENCIA)
				  and a.NR_SEQ_ORDEM_SERV is not null');
	end if;


	CALL Exec_sql_Dinamico('Maicon','Alter Table MAN_ORDEM_SERVICO_MAT add (Constraint MANORSEMAT_MANORSE_FK Foreign Key (NR_SEQ_ORDEM_SERV) References MAN_ORDEM_SERVICO (NR_SEQUENCIA) on delete cascade');

	--PCS_MOTIVO_TIPO_LISTA            PCSMOTLIST_MOSOCOM_FK_I     Maicon     18/03/15     Indice inexistente
	select  count(*)
	into STRICT	qt_existe_w
	from    user_indexes
	where	index_name = 'PCSMOTLIST_PCSMOTI_FK_I';

	if (qt_existe_w > 0) then
	   CALL Exec_sql_Dinamico('Maicon','Drop Index PCSMOTLIST_PCSMOTI_FK_I');
	end if;

	select  count(*)
	into STRICT	qt_existe_w
	from    user_indexes
	where	index_name = 'PCSMOTLIST_MOSOCOM_FK_I';

	if (qt_existe_w = 0) then
	    CALL Exec_sql_Dinamico('Maicon','Create Index PCSMOTLIST_MOSOCOM_FK_I on PCS_MOTIVO_TIPO_LISTA(NR_SEQ_MOTIVO)');
	end if;

end if;

if (dt_versao_atual_cliente_w < to_date('07/04/2014','dd/mm/yyyy')) then
	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name = 'CONTRATO_ARQUIVO'
	and	column_name = 'DS_ARQUIVO_BANCO'
	and	data_type = 'BLOB';

	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'alter table CONTRATO_ARQUIVO drop column DS_ARQUIVO_BANCO');
		CALL Exec_Sql_Dinamico('Maicon', 'alter table CONTRATO_ARQUIVO add DS_ARQUIVO_BANCO long raw');
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name = 'SOLIC_COMPRA_ITEM_ANEXO'
	and	column_name = 'DS_ARQUIVO_BANCO'
	and	data_type = 'BLOB';

	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'alter table SOLIC_COMPRA_ITEM_ANEXO drop column DS_ARQUIVO_BANCO');
		CALL Exec_Sql_Dinamico('Maicon', 'alter table SOLIC_COMPRA_ITEM_ANEXO add DS_ARQUIVO_BANCO long raw');
	end if;
end if;

if (dt_versao_atual_cliente_w < to_date('11/04/2014','dd/mm/yyyy')) then
	begin
	select	count(*)
	into STRICT	qt_existe_w
	from	CLASSE_MATERIAL a
	where	not exists (	SELECT 1
				from	CONTA_CONTABIL b
				where	1 = 1
				and	a.CD_CONTA_CONTABIL = b.CD_CONTA_CONTABIL)
	and	(a.CD_CONTA_CONTABIL IS NOT NULL AND a.CD_CONTA_CONTABIL::text <> '');

	if (qt_existe_w > 0) then
		update	CLASSE_MATERIAL a
		set	CD_CONTA_CONTABIL  = NULL
		where	not exists (	SELECT 1
					from	CONTA_CONTABIL b
					where	1 = 1
					and	a.CD_CONTA_CONTABIL = b.CD_CONTA_CONTABIL)
		and	(a.CD_CONTA_CONTABIL IS NOT NULL AND a.CD_CONTA_CONTABIL::text <> '');
		commit;

		select	count(*)
		into STRICT	qt_existe_w
		from	user_constraints
		where	constraint_name = 'CLAMATE_CONCONT_FK';

		if (qt_existe_w > 0) then
			CALL Exec_Sql_Dinamico('Sidnei', 'Alter Table CLASSE_MATERIAL ENABLE CONSTRAINT CLAMATE_CONCONT_FK');
		end if;
	end if;
	end;
end if;

/*Jonas*/

if (dt_versao_atual_cliente_w < to_date('29/04/2014','dd/mm/yyyy')) then
	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'DISPENSARIO_MAT_HOR'
	and	column_name	= 'NR_SEQ_MATERIAL'
	and	data_type	= 'NUMBER'
	and 	data_precision  = 6;
	if (qt_existe_w > 0) then
		CALL Exec_sql_Dinamico('Jonas', 'alter table dispensario_mat_hor modify nr_seq_material number(10)');
	end if;
end if;

if (dt_versao_atual_cliente_w < to_date('13/05/2014','dd/mm/yyyy')) then
	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'SUP_INV_CICLICO_REGRA'
	and	column_name	= 'QT_MAX_CONTAGEM';

	if (qt_existe_w > 0) then
		CALL Exec_sql_Dinamico('Sidnei', 'update SUP_INV_CICLICO_REGRA set QT_MAX_CONTAGEM = nvl(QT_MAX_CONTAGEM,4)');
	end if;
end if;

/* Maicon em 22/05/2014 */

if (dt_versao_atual_cliente_w	< to_date('29/05/2014','dd/mm/yyyy')) then
	update	parametro_compras
	set	ie_marca_int_material = 'M';

end if;

/* Maicon em 22/05/2014 */

if (dt_versao_atual_cliente_w	< to_date('09/06/2014','dd/mm/yyyy')) then
	CALL Exec_Sql_Dinamico('Maicon', 'update interface a set a.ie_imp_exp = (select x.ie_imp_exp from tasy_versao.interface x where x.cd_interface = a.cd_interface)');
end if;

/* Maicon em 06/08/2014 */

if (dt_versao_atual_cliente_w	< to_date('06/08/2014','dd/mm/yyyy')) then

	SELECT 	COUNT(*)
	into STRICT	qt_existe_w
	from	user_constraints
	where	constraint_name = 'SOLCOIT_PCSRAIT_FK';
	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'alter table SOLIC_COMPRA_ITEM drop constraint SOLCOIT_PCSRAIT_FK');
	end if;

	select  count(*)
	into STRICT	qt_existe_w
	from    user_indexes
	where	index_name = 'SOLCOIT_PCSRAIT_FK_I';
	if (qt_existe_w > 0) then
		CALL exec_sql_dinamico('Maicon', 'DROP INDEX SOLCOIT_PCSRAIT_FK_I');
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'SOLIC_COMPRA_ITEM'
	and	column_name	= 'NR_SEQ_PCS_REG_ANALISE';
	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'alter table SOLIC_COMPRA_ITEM drop column NR_SEQ_PCS_REG_ANALISE');
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	INTEGRIDADE_REFERENCIAL
	where	NM_INTEGRIDADE_REFERENCIAL = 'SOLCOIT_PCSRAIT_FK';
	if (qt_existe_w > 0) then
		CALL Exec_sql_Dinamico('Maicon','delete from INTEGRIDADE_REFERENCIAL where  NM_INTEGRIDADE_REFERENCIAL = ''SOLCOIT_PCSRAIT_FK''');
	end if;


	select	count(*)
	into STRICT	qt_existe_w
	from	INDICE
	where	NM_INDICE = 'SOLCOIT_PCSRAIT_FK_I';
	if (qt_existe_w > 0) then
		CALL Exec_sql_Dinamico('Maicon','delete from INDICE where  NM_INDICE = ''SOLCOIT_PCSRAIT_FK_I''');
	end if;


	select	count(*)
	into STRICT	qt_existe_w
	from	TABELA_ATRIBUTO
	where	NM_ATRIBUTO = 'NR_SEQ_PCS_REG_ANALISE'
	and nm_tabela = 'SOLIC_COMPRA_ITEM';
	if (qt_existe_w > 0) then
		CALL Exec_sql_Dinamico('Maicon','delete from TABELA_ATRIBUTO where  NM_ATRIBUTO = ''NR_SEQ_PCS_REG_ANALISE'' and nm_tabela = ''SOLIC_COMPRA_ITEM''');
	end if;
end if;

/* Maicon em 02/10/2014 */

if (dt_versao_atual_cliente_w	< to_date('02/10/2014','dd/mm/yyyy')) then


	SELECT	COUNT(*)
	into STRICT	qt_existe_w
	FROM	user_triggers
	WHERE	trigger_name = 'NOTA_FISCAL_ITEM_BEFOREDELETE';

	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'drop trigger NOTA_FISCAL_ITEM_BEFOREDELETE');
	end if;

end if;

/*Maicon*/

if (dt_versao_atual_cliente_w < to_date('10/11/2014','dd/mm/yyyy')) then
	select	count(*)
	into STRICT	qt_existe_w
	from	user_constraints
	where	table_name = 'SUP_DADOS_ULTIMA_COMPRA'
	and	constraint_name = 'SUDAUCO_NOTFISC_FK';
	if (qt_existe_w > 0) then
		CALL Exec_sql_dinamico('Maicon', 'alter table SUP_DADOS_ULTIMA_COMPRA drop constraint SUDAUCO_NOTFISC_FK');
	end if;
end if;

if (dt_versao_atual_cliente_w < to_date('13/11/2014','dd/mm/yyyy')) then
	begin
	CALL SUP_COPIAR_PARAM_KIT();
	exception
	when others then
		null;
	end;
end if;

--Jonas 26/11/2014
if (dt_versao_atual_cliente_w < to_date('26/11/2014','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'CM_CONJUNTO_ITEM'
	and	column_name	= 'CD_CODIGO'
	and	data_type	= 'VARCHAR2'
	and 	data_length  	= 20;
	if (qt_existe_w > 0) then
		CALL Exec_sql_dinamico('Jonas', 'alter table cm_conjunto_item modify CD_CODIGO VARCHAR2(100)');
	end if;
end if;

--maicon 12/12/2014
if (dt_versao_atual_cliente_w < to_date('12/12/2014','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name = 'W_PROTHEUS_PEDIDO'
	and	column_name = 'DT_EMISSAO'
	and	data_Type <> 'DATE';

	if (qt_existe_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Maicon', 'ALTER TABLE W_PROTHEUS_PEDIDO modify DT_EMISSAO date');
		end;
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name = 'W_PROTHEUS_PEDIDO_ITEM'
	and	column_name = 'DT_ENTREGA'
	and	data_Type <> 'DATE';

	if (qt_existe_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Maicon', 'ALTER TABLE W_PROTHEUS_PEDIDO_ITEM modify DT_ENTREGA date');
		end;
	end if;
end if;

if (dt_versao_atual_cliente_w < to_date('07/01/2015','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	user_objects
	where	object_name = 'ATUALIZAR_SERIE_NOTA_FISCAL_W';

	if (qt_existe_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Sidnei', 'DROP PROCEDURE ATUALIZAR_SERIE_NOTA_FISCAL_W'
);
		end;
	end if;
end if;

if (dt_versao_atual_cliente_w < to_date('24/03/2015','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	objeto_sistema
	where	nm_objeto = 'ATUALIZAR_SERIE_NOTA_FISCAL_W';

	if (qt_existe_w > 0) then
		begin
		delete from objeto_sistema where nm_objeto = 'ATUALIZAR_SERIE_NOTA_FISCAL_W';
		end;
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	indice
	where	nm_indice = 'PCSREHI_PCSESSE_FK_I';

	if (qt_existe_w > 0) then
		delete from indice where nm_indice = 'PCSREHI_PCSESSE_FK_I';
	end if;
end if;

if (dt_versao_atual_cliente_w < to_date('07/04/2015','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	TABELA_ATRIBUTO
	where	NM_ATRIBUTO = 'DT_INICIO_VIGENCIA'
	and	nm_tabela = 'SOLIC_COMPRA_TERMO_TECNICO';

	if (qt_existe_w > 0) then
		CALL Exec_sql_Dinamico('Maicon','delete from TABELA_ATRIBUTO where  NM_ATRIBUTO = ''DT_INICIO_VIGENCIA'' and nm_tabela = ''SOLIC_COMPRA_TERMO_TECNICO''');
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	TABELA_ATRIBUTO
	where	NM_ATRIBUTO = 'DT_FIM_VIGENCIA'
	and	nm_tabela = 'SOLIC_COMPRA_TERMO_TECNICO';

	if (qt_existe_w > 0) then
		CALL Exec_sql_Dinamico('Maicon','delete from TABELA_ATRIBUTO where  NM_ATRIBUTO = ''DT_FIM_VIGENCIA'' and nm_tabela = ''SOLIC_COMPRA_TERMO_TECNICO''');
	end if;


	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name = 'SOLIC_COMPRA_TERMO_TECNICO'
	and	column_name = 'DT_INICIO_VIGENCIA';

	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'ALTER TABLE SOLIC_COMPRA_TERMO_TECNICO drop column DT_INICIO_VIGENCIA');
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name = 'SOLIC_COMPRA_TERMO_TECNICO'
	and	column_name = 'DT_FIM_VIGENCIA';

	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'ALTER TABLE SOLIC_COMPRA_TERMO_TECNICO drop column DT_FIM_VIGENCIA');
	end if;

end if;

if (dt_versao_atual_cliente_w < to_date('04/05/2015','dd/mm/yyyy')) then
	select	count(*)
	into STRICT	qt_existe_w
	from	user_constraints
	where	table_name = 'DESENV_EPIC'
	and	constraint_name = 'DESEPIC_DESARTR_FK';
	if (qt_existe_w > 0) then
		CALL Exec_sql_dinamico('Maicon', 'alter table DESENV_EPIC drop constraint DESEPIC_DESARTR_FK');

		select  count(*)
		into STRICT	qt_existe_w
		from    user_indexes
		where	index_name = 'DESEPIC_DESARTR_FK_I';

		if (qt_existe_w > 0) then
			CALL Exec_sql_dinamico('Maicon', 'drop index DESEPIC_DESARTR_FK_I');
		end if;

		select	count(*)
		into STRICT	qt_existe_w
		from	INDICE
		where	NM_INDICE = 'DESEPIC_DESARTR_FK_I';

		if (qt_existe_w > 0) then
			CALL Exec_sql_dinamico('Maicon', 'delete from indice where nm_indice = ''DESEPIC_DESARTR_FK_I''');
		end if;

	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_constraints
	where	table_name = 'DESENV_FEATURE'
	and	constraint_name = 'DESFEAT_DESRELE_FK';

	if (qt_existe_w > 0) then
		CALL Exec_sql_dinamico('Maicon', 'alter table DESENV_FEATURE drop constraint DESFEAT_DESRELE_FK');

		select  count(*)
		into STRICT	qt_existe_w
		from    user_indexes
		where	index_name = 'DESFEAT_DESRELE_FK_I';

		if (qt_existe_w > 0) then
			CALL Exec_sql_dinamico('Maicon', 'drop index DESFEAT_DESRELE_FK_I');
		end if;

		select	count(*)
		into STRICT	qt_existe_w
		from	INDICE
		where	NM_INDICE = 'DESFEAT_DESRELE_FK_I';

		if (qt_existe_w > 0) then
			CALL Exec_sql_dinamico('Maicon', 'delete from indice where nm_indice = ''DESFEAT_DESRELE_FK_I''');
		end if;

	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_constraints
	where	table_name = 'DESENV_STORY'
	and	constraint_name = 'DESSTOR_DESSPRI_FK';
	if (qt_existe_w > 0) then
		CALL Exec_sql_dinamico('Maicon', 'alter table DESENV_STORY drop constraint DESSTOR_DESSPRI_FK');

		select  count(*)
		into STRICT	qt_existe_w
		from    user_indexes
		where	index_name = 'DESSTOR_DESSPRI_FK_I';

		if (qt_existe_w > 0) then
			CALL Exec_sql_dinamico('Maicon', 'drop index DESSTOR_DESSPRI_FK_I');
		end if;

		select	count(*)
		into STRICT	qt_existe_w
		from	INDICE
		where	NM_INDICE = 'DESSTOR_DESSPRI_FK_I';

		if (qt_existe_w > 0) then
			CALL Exec_sql_dinamico('Maicon', 'delete from indice where nm_indice = ''DESSTOR_DESSPRI_FK_I''');
		end if;

	end if;

	SELECT	COUNT(*)
	into STRICT	qt_existe_w
	FROM	user_triggers
	WHERE	trigger_name = 'COT_COMPRA_FORN_ITEM_INSERT';

	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('tdpaula', 'drop trigger COT_COMPRA_FORN_ITEM_INSERT');
	end if;

end if;

if (dt_versao_atual_cliente_w < to_date('11/05/2015','dd/mm/yyyy')) then
	CALL insert_legenda_inspecao();
end if;

if (dt_versao_atual_cliente_w < to_date('25/05/2015','dd/mm/yyyy')) then
	select	count(*)
	into STRICT	qt_existe_w
	from	user_indexes
	where	index_name = 'DESCATE_DESCATE_FK_I';
	if (qt_existe_w > 0) then
		select	count(*)
		into STRICT	qt_existe_w
		from	user_indexes
		where	index_name = 'DESCATE_PK';
		if (qt_existe_w = 0) then
			CALL Exec_sql_dinamico('Rrother', 'alter index DESCATE_DESCATE_FK_I rename to DESCATE_PK');
		end if;
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_constraints
	where	table_name = 'DESENV_CASO_TESTE'
	and	constraint_name = 'DESCATE_DESSTOR_FK';
	if (qt_existe_w > 0) then
		CALL Exec_sql_dinamico('Rrother', 'alter table DESENV_CASO_TESTE drop constraint DESCATE_DESSTOR_FK');
		CALL Exec_sql_dinamico('Rrother', 'drop index DESCATE_DESSTOR_FK_I');
	end if;

	CALL Exec_sql_dinamico('Rrother', 'delete from indice where nm_indice = ''DESCATE_DESSTOR_FK_I''');
	CALL Exec_sql_dinamico('Rrother', 'delete from indice where nm_indice = ''DESCATE_DESCATE_FK_I''');
end if;

if (dt_versao_atual_cliente_w < to_date('27/05/2015','dd/mm/yyyy')) then

	update	FUNCAO_PARAMETRO
	set	CD_DOMINIO = 4200,
		VL_PARAMETRO_PADRAO  = NULL
	where	nr_sequencia = 526
	and	cd_funcao = 299;

	delete from FUNCAO_PARAM_USUARIO
	where cd_funcao = 299
	and nr_sequencia = 526
	and VL_PARAMETRO = 'ES';


	update	solic_compra
	set	ie_tipo_servico  = NULL
	where	ie_tipo_servico = 'ES'
	and	nr_seq_ordem_serv > 0;
	commit;
end if;

if (dt_versao_atual_cliente_w < to_date('23/06/2015','dd/mm/yyyy')) then
	CALL Exec_sql_dinamico('Rrother', 'alter table desenv_story modify ds_detalhe_tecnico long');
end if;

if (dt_versao_atual_cliente_w < to_date('25/06/2015','dd/mm/yyyy')) then
	begin
	select	count(1)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name = 'W_MOVIMENTO_ESTOQUE'
	and	column_name = 'DT_INTEGRACAO';

	if (qt_existe_w = 0) then
		CALL Exec_sql_dinamico('Sidnei', 'alter table W_MOVIMENTO_ESTOQUE add DT_INTEGRACAO date');
	end if;
	end;
end if;

if (dt_versao_atual_cliente_w < to_date('22/07/2015','dd/mm/yyyy')) then
	update	solic_compra
	set	ie_tipo_servico  = NULL
	where	ie_tipo_servico = 'ES'
	and	nr_seq_ordem_serv > 0;
	commit;
end if;

if (dt_versao_atual_cliente_w < to_date('05/08/2015','dd/mm/yyyy')) then
	CALL Exec_sql_dinamico('Maicon', 'delete interface_atributo  where cd_interface in (2001)');
	CALL Exec_sql_dinamico('Maicon', 'delete interface_reg  where cd_interface in (2001)');
	CALL Exec_sql_dinamico('Maicon', 'delete interface where cd_interface in (2001)');
	commit;
	CALL Exec_sql_dinamico('Maicon', 'insert into interface select * from tasy_versao.interface where cd_interface in (2001)');
	CALL Exec_sql_dinamico('Maicon', 'insert into interface_reg select * from tasy_versao.interface_reg where cd_interface in (2001)');
	CALL Exec_sql_dinamico('Maicon', 'insert into interface_atributo select * from tasy_versao.interface_atributo where cd_interface in (2001)');
	commit;
end if;

if (dt_versao_atual_cliente_w < to_date('14/08/2015','dd/mm/yyyy')) then
	CALL Exec_sql_dinamico('srcunha', 'alter table w_movimento_estoque add (cd_operacao_bkp varchar2(40))');
	CALL Exec_sql_dinamico('srcunha', 'update w_movimento_estoque set cd_operacao_bkp = cd_operacao_estoque');
	CALL Exec_sql_dinamico('srcunha', 'alter table w_movimento_estoque drop column cd_operacao_estoque');
	CALL Exec_sql_dinamico('srcunha', 'alter table w_movimento_estoque rename column cd_operacao_bkp to cd_operacao_estoque');
	CALL Exec_sql_dinamico('srcunha', 'alter table w_movimento_estoque modify cd_operacao_estoque not null');
end if;

if (dt_versao_atual_cliente_w < to_date('21/07/2015','dd/mm/yyyy')) then

	update	tabela_atributo
	set	qt_tamanho = 30
	where	upper(nm_tabela) = upper('ITEM_DEVOLUCAO_MATERIAL_PAC')
	and	upper(nm_atributo) = upper('CD_UNIDADE_MEDIDA');

end if;

if (dt_versao_atual_cliente_w < to_date('14/08/2015','dd/mm/yyyy')) then
	CALL Exec_sql_dinamico('Jonas', 'alter table sup_int_requisicao add (CD_LOCAL_ESTOQUE_DESTINO_BKP varchar2(80))');
	CALL Exec_sql_dinamico('Jonas', 'update sup_int_requisicao set CD_LOCAL_ESTOQUE_DESTINO_BKP = CD_LOCAL_ESTOQUE_DESTINO');
	CALL Exec_sql_dinamico('Jonas', 'alter table sup_int_requisicao drop column CD_LOCAL_ESTOQUE_DESTINO');
	CALL Exec_sql_dinamico('Jonas', 'alter table sup_int_requisicao rename column CD_LOCAL_ESTOQUE_DESTINO_BKP to CD_LOCAL_ESTOQUE_DESTINO');
end if;

if (dt_versao_atual_cliente_w < to_date('14/08/2015','dd/mm/yyyy')) then
	CALL Exec_sql_dinamico('Jonas', 'alter table sup_int_requisicao add (CD_LOCAL_ESTOQUE_BKP varchar2(80))');
	CALL Exec_sql_dinamico('Jonas', 'update sup_int_requisicao set CD_LOCAL_ESTOQUE_BKP = CD_LOCAL_ESTOQUE');
	CALL Exec_sql_dinamico('Jonas', 'alter table sup_int_requisicao drop column CD_LOCAL_ESTOQUE');
	CALL Exec_sql_dinamico('Jonas', 'alter table sup_int_requisicao rename column CD_LOCAL_ESTOQUE_BKP to CD_LOCAL_ESTOQUE');
	CALL Exec_sql_dinamico('Jonas', 'alter table sup_int_requisicao modify CD_LOCAL_ESTOQUE not null');
end if;


if (dt_versao_atual_cliente_w < to_date('14/08/2015','dd/mm/yyyy')) then
	CALL Exec_sql_dinamico('Jonas', 'alter table sup_int_requisicao add (cd_operacao_bkp varchar2(80))');
	CALL Exec_sql_dinamico('Jonas', 'update sup_int_requisicao set cd_operacao_bkp = cd_operacao_estoque');
	CALL Exec_sql_dinamico('Jonas', 'alter table sup_int_requisicao drop column cd_operacao_estoque');
	CALL Exec_sql_dinamico('Jonas', 'alter table sup_int_requisicao rename column cd_operacao_bkp to cd_operacao_estoque');
	CALL Exec_sql_dinamico('Jonas', 'alter table sup_int_requisicao modify cd_operacao_estoque not null');
end if;

if (dt_versao_atual_cliente_w < to_date('14/08/2015','dd/mm/yyyy')) then
	CALL Exec_sql_dinamico('Jonas', 'alter table sup_int_req_item add (cd_material_bkp varchar2(80))');
	CALL Exec_sql_dinamico('Jonas', 'update sup_int_req_item set cd_material_bkp = cd_material');
	CALL Exec_sql_dinamico('Jonas', 'alter table sup_int_req_item drop column cd_material');
	CALL Exec_sql_dinamico('Jonas', 'alter table sup_int_req_item rename column cd_material_bkp to cd_material');
	CALL Exec_sql_dinamico('Jonas', 'alter table sup_int_req_item modify cd_material not null');
end if;

if (dt_versao_atual_cliente_w < to_date('15/10/2015','dd/mm/yyyy')) then

	SELECT	COUNT(*)
	INTO STRICT	qt_existe_w
	FROM	user_tab_columns
	WHERE	table_name = 'W_ORDEM_COMPRA_ITEM'
	AND		column_name = 'CD_MATERIAL'
	AND		data_Type = 'NUMBER';


	IF (qt_existe_w > 0) THEN
		BEGIN
		CALL Exec_Sql_Dinamico('Jonas', 'ALTER TABLE W_ORDEM_COMPRA_ITEM modify CD_MATERIAL varchar2(20)');
		END;
	END IF;

end if;

if (dt_versao_atual_cliente_w < to_date('15/10/2015','dd/mm/yyyy')) then

	SELECT	COUNT(*)
	INTO STRICT	qt_existe_w
	FROM	user_tab_columns
	WHERE	table_name = 'W_ORDEM_COMPRA_ITEM'
	AND		column_name = 'CD_LOCAL_ESTOQUE'
	AND		data_Type = 'NUMBER';


	IF (qt_existe_w > 0) THEN
		BEGIN
		CALL Exec_Sql_Dinamico('Jonas', 'ALTER TABLE W_ORDEM_COMPRA_ITEM modify CD_LOCAL_ESTOQUE varchar2(80)');
		END;
	END IF;

end if;

if (dt_versao_atual_cliente_w < to_date('15/10/2015','dd/mm/yyyy')) then
	SELECT	COUNT(*)
	INTO STRICT	qt_existe_w
	FROM	user_tab_columns
	WHERE	table_name = 'W_ORDEM_COMPRA'
	AND	column_name = 'CD_LOCAL_ENTREGA'
	AND	data_Type = 'NUMBER';


	IF (qt_existe_w > 0) THEN
		BEGIN
		CALL Exec_Sql_Dinamico('Jonas', 'ALTER TABLE W_ORDEM_COMPRA modify CD_LOCAL_ENTREGA varchar2(80)');
		END;
	END IF;
end if;

if (dt_versao_atual_cliente_w < to_date('15/10/2015','dd/mm/yyyy')) then

	SELECT	COUNT(*)
	INTO STRICT	qt_existe_w
	FROM	user_constraints
	WHERE	table_name = 'SUP_PARAMETRO_INTEGRACAO'
	AND		constraint_name = 'SUPAINT_UK';

	IF (qt_existe_w > 0) THEN
		CALL exec_sql_dinamico('Jonas', 'alter table sup_parametro_integracao drop constraint SUPAINT_UK');
	end if;

	SELECT  COUNT(*)
	INTO STRICT	qt_existe_w
	FROM    user_indexes
	WHERE	index_name = 'SUPAINT_UK';

	IF (qt_existe_w > 0) THEN
		CALL exec_sql_dinamico('jonas', 'drop index SUPAINT_UK');
	END IF;

end if;

if (dt_versao_atual_cliente_w < to_date('24/09/2015','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	valor_dominio
	where	VL_DOMINIO = 'SR'
	and	cd_dominio = 6380;

	if (qt_existe_w > 0) then
		delete from valor_dominio
		where VL_DOMINIO = 'SR'
		and	cd_dominio = 6380;
	end if;
end if;

if (dt_versao_atual_cliente_w < to_date('28/10/2015','dd/mm/yyyy')) then
	select	count(*)
	into STRICT	qt_existe_w
	from	user_source
	where	upper(name) = 'PCS_ATUALIZAR_LISTA_ANALISE';

	if (qt_existe_w > 0) then
		CALL exec_sql_dinamico('Maicon', 'drop procedure PCS_ATUALIZAR_LISTA_ANALISE'
);
	end if;
end if;

if (dt_versao_atual_cliente_w < to_date('23/12/2015','dd/mm/yyyy')) then
	select	count(*)
	into STRICT	qt_existe_w
	from	user_constraints
	where	upper(constraint_name) = 'SUINRME_SUPAINT_FK';

	if (qt_existe_w > 0) then
		CALL exec_sql_dinamico('Dsilva', ' delete from indice where nm_indice = ''SUINRME_SUPAINT_FK_I'' ');
		CALL exec_sql_dinamico('Dsilva', ' ALTER TABLE SUP_INT_REGRA_MOVTO_EST DROP CONSTRAINT SUINRME_SUPAINT_FK ');
		CALL exec_sql_dinamico('Dsilva', ' delete from INTEGRIDADE_REFERENCIAL where nm_tabela = ''SUP_INT_REGRA_MOVTO_EST'' and nm_integridade_referencial = ''SUINRME_SUPAINT_FK'' ');
	end if;

end if;

if (dt_versao_atual_cliente_w < to_date('29/02/2016','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	INDICE
	where	NM_INDICE = 'SUINRME_SUPAINT_FK_I';
	if (qt_existe_w > 0) then
		CALL Exec_sql_Dinamico('Maicon','delete from INDICE where  NM_INDICE = ''SUINRME_SUPAINT_FK_I''');
	end if;

	select  count(*)
	into STRICT	qt_existe_w
	from    user_indexes
	where	index_name = 'SUINRME_SUPAINT_FK_I';

	if (qt_existe_w > 0) then
		CALL Exec_sql_Dinamico('Maicon','drop index SUINRME_SUPAINT_FK_I');
	end if;

	update tabela_ATRIBUTO
	set ie_obrigatorio = 'N'
	where	nm_tabela = 'AGENDAMENTO_INTEGRACAO'
	and	nm_atributo = 'CD_SETOR_ATENDIMENTO';

	select count(*)
	into STRICT	qt_existe_w
	from user_tab_columns
	where table_name = 'AGENDAMENTO_INTEGRACAO'
	and COLUMN_NAME    = 'CD_SETOR_ATENDIMENTO'
	and NULLABLE = 'N';

	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'alter table AGENDAMENTO_INTEGRACAO modify CD_SETOR_ATENDIMENTO number(5) null');
	end if;

end if;

if (dt_versao_atual_cliente_w < to_date('26/04/2016','dd/mm/yyyy')) then
	begin
	begin
	delete	FROM indice
	where	nm_indice = 'REMATPE_UK';

	delete	FROM INDICE_ATRIBUTO
	where	nm_indice = 'REMATPE_UK';
	exception
	when others then
		null;
	end;

	select	count(1)
	into STRICT	qt_existe_w
	from	user_constraints
	where	constraint_name = 'REMATPE_UK';

	if (qt_existe_w > 0) then
		CALL Exec_sql_Dinamico('Sidnei','alter table REGRA_MATERIAL_PERFIL drop CONSTRAINT REMATPE_UK');
	end if;

	select	count(1)
	into STRICT	qt_existe_w
	from	user_indexes
	where	index_name = 'REMATPE_UK';

	if (qt_existe_w > 0) then
		CALL Exec_sql_Dinamico('Sidnei','drop index REMATPE_UK');
	end if;
	commit;
	end;
end if;

if (dt_versao_atual_cliente_w < to_date('02/05/2016','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'W_INT_CADASTRO_MATERIAL'
	and	column_name	= 'CD_MATERIAL_ESTOQUE';
	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'alter table W_INT_CADASTRO_MATERIAL drop column CD_MATERIAL_ESTOQUE');
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'W_INT_CADASTRO_MATERIAL'
	and	column_name	= 'CD_MATERIAL_GENERICO';
	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'alter table W_INT_CADASTRO_MATERIAL drop column CD_MATERIAL_GENERICO');
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'W_INT_CADASTRO_MATERIAL'
	and	column_name	= 'IE_PROCESSADO';
	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'alter table W_INT_CADASTRO_MATERIAL drop column IE_PROCESSADO');
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'W_INT_CADASTRO_MATERIAL'
	and	column_name	= 'DS_ERRO';
	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'alter table W_INT_CADASTRO_MATERIAL drop column DS_ERRO');
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'W_INT_CAD_MATERIAL_ESTAB'
	and	column_name	= 'CD_MATERIAL_CONTA';
	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'alter table W_INT_CAD_MATERIAL_ESTAB drop column CD_MATERIAL_CONTA');
	end if;


		select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'W_INT_NOTA_FISCAL'
	and	column_name	= 'IE_PROCESSADO';
	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'alter table W_INT_NOTA_FISCAL drop column IE_PROCESSADO');
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name	= 'W_INT_NOTA_FISCAL'
	and	column_name	= 'DS_ERRO';
	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'alter table W_INT_NOTA_FISCAL drop column DS_ERRO');
	end if;

end if;

/* Maicon OS 1023687 - 22/04/2016 */

CALL atualiza_processo_aprov_compra();
CALL criar_job_dados_ult_compra();


if (dt_versao_atual_cliente_w < to_date('05/05/2016','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name = 'SUP_INT_MATERIAL'
	and	column_name = 'DS_ESPEC_TECNICA'
	and	DATA_TYPE = 'LONG';

	if (qt_existe_w > 0) then


		update	SUP_INT_MATERIAL
		set	DS_ESPEC_TECNICA  = NULL
		where	(DS_ESPEC_TECNICA IS NOT NULL AND DS_ESPEC_TECNICA::text <> ''); /*Pode limpar, pois essa tabela é so de passos.*/
		CALL Exec_Sql_Dinamico('Maicon', 'alter table SUP_INT_MATERIAL modify DS_ESPEC_TECNICA varchar2(4000)');


	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	W_PROCESSO_APROV_COMPRA a
	where not exists (	SELECT 1  from PROCESSO_APROV_COMPRA b
				where 1 = 1
				and a.NR_SEQUENCIA = b.NR_SEQUENCIA
				and a.NR_SEQ_PROC_APROV = b.NR_SEQ_PROC_APROV)
	and (a.NR_SEQUENCIA IS NOT NULL AND a.NR_SEQUENCIA::text <> '')
	and (a.NR_SEQ_PROC_APROV IS NOT NULL AND a.NR_SEQ_PROC_APROV::text <> '');

	if (qt_existe_w > 0) then

		CALL Exec_Sql_Dinamico('Tasy', 'delete from W_PROCESSO_APROV_COMPRA a  where not exists ( select 1  from PROCESSO_APROV_COMPRA b  where 1 = 1  and a.NR_SEQUENCIA = b.NR_SEQUENCIA and a.NR_SEQ_PROC_APROV = b.NR_SEQ_PROC_APROV) and a.NR_SEQUENCIA is not null and a.NR_SEQ_PROC_APROV is not null');

	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_constraints
	where	constraint_name = 'WPROAPC_PROAPCO_FK';

	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Tasy', 'Alter Table W_PROCESSO_APROV_COMPRA drop Constraint WPROAPC_PROAPCO_FK');

	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_indexes
	where	index_name = 'WPROAPC_PROAPCO_FK_I';


	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Tasy', 'drop index WPROAPC_PROAPCO_FK_I');

	end if;


	CALL Exec_Sql_Dinamico('Tasy', 'Alter Table W_PROCESSO_APROV_COMPRA add (Constraint WPROAPC_PROAPCO_FK Foreign Key (NR_SEQUENCIA,NR_SEQ_PROC_APROV) References PROCESSO_APROV_COMPRA (NR_SEQUENCIA,NR_SEQ_PROC_APROV) on delete cascade)');
	CALL Exec_Sql_Dinamico('Tasy', 'Create  Index WPROAPC_PROAPCO_FK_I on W_PROCESSO_APROV_COMPRA(NR_SEQUENCIA,NR_SEQ_PROC_APROV)');


end if;

if (dt_versao_atual_cliente_w < to_date('02/06/2016','dd/mm/yyyy')) then

	update	REG_LIC_MOD_COMPRA
	set	IE_EXIGE_DISP_CONTABIL         = 'S',
		IE_EXIGE_DISP_FINANCEIRA       = 'S'
	where	NR_SEQ_MODELO = 'C';

end if;

if (dt_versao_atual_cliente_w < to_date('17/06/2016','dd/mm/yyyy')) then

	SELECT	COUNT(*)
	INTO STRICT	qt_existe_w
	from	OBJETO_SISTEMA
	WHERE	NM_OBJETO = 'GERAR_W_INT_CADASTRO_MATERIAL';

	IF (qt_existe_w > 0) THEN
		delete from OBJETO_SISTEMA
		where NM_OBJETO = 'GERAR_W_INT_CADASTRO_MATERIAL';
	END IF;


	SELECT	COUNT(*)
	INTO STRICT	QT_EXISTE_W
	FROM	USER_SOURCE
	where	name = 'GERAR_W_INT_CADASTRO_MATERIAL';

	if (qt_existe_w > 0) then
		CALL exec_sql_dinamico('Maicon', 'drop procedure GERAR_W_INT_CADASTRO_MATERIAL'
);
	end if;
END IF;

if (dt_versao_atual_cliente_w < to_date('28/02/2013','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name = 'W_INT_NOTA_FISCAL'
	and	column_name = 'CD_ESTABELECIMENTO'
	and	data_Type <> 'VARCHAR2';

	if (qt_existe_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Maicon', 'DELETE FROM W_INT_NOTA_FISCAL');
		CALL Exec_Sql_Dinamico('Maicon', 'ALTER TABLE W_INT_NOTA_FISCAL modify CD_ESTABELECIMENTO VARCHAR2(30)');
		end;
	end if;
end if;

if (dt_versao_atual_cliente_w < to_date('28/02/2013','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	OBJETO_SISTEMA
	where	NM_OBJETO = 'OBTER_VL_COMPROMETIDO';
	if (qt_existe_w > 0) then
		begin
		delete from  OBJETO_SISTEMA where NM_OBJETO = 'OBTER_VL_COMPROMETIDO';
		end;
	end if;
	select	count(*)
	into STRICT	qt_existe_w
	from	user_source
	where	name = 'OBTER_VL_COMPROMETIDO';
	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'drop FUNCTION OBTER_VL_COMPROMETIDO'
);
	end if;




	select	count(*)
	into STRICT	qt_existe_w
	from	OBJETO_SISTEMA
	where	NM_OBJETO = 'OBTER_VL_COMPROMETIDO_SOLIC';
	if (qt_existe_w > 0) then
		begin
		delete from  OBJETO_SISTEMA where NM_OBJETO = 'OBTER_VL_COMPROMETIDO_SOLIC';
		end;
	end if;
	select	count(*)
	into STRICT	qt_existe_w
	from	user_source
	where	name = 'OBTER_VL_COMPROMETIDO_SOLIC';
	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'drop FUNCTION OBTER_VL_COMPROMETIDO_SOLIC'
);
	end if;



	select	count(*)
	into STRICT	qt_existe_w
	from	OBJETO_SISTEMA
	where	NM_OBJETO = 'OBTER_VL_COMPROMETIDO_ORDEM';
	if (qt_existe_w > 0) then
		begin
		delete from  OBJETO_SISTEMA where NM_OBJETO = 'OBTER_VL_COMPROMETIDO_ORDEM';
		end;
	end if;
	select	count(*)
	into STRICT	qt_existe_w
	from	user_source
	where	name = 'OBTER_VL_COMPROMETIDO_ORDEM';
	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'drop FUNCTION OBTER_VL_COMPROMETIDO_ORDEM'
);
	end if;



	select	count(*)
	into STRICT	qt_existe_w
	from	OBJETO_SISTEMA
	where	NM_OBJETO = 'OBTER_VL_COMPROMETIDO_NF';
	if (qt_existe_w > 0) then
		begin
		delete from  OBJETO_SISTEMA where NM_OBJETO = 'OBTER_VL_COMPROMETIDO_NF';
		end;
	end if;
	select	count(*)
	into STRICT	qt_existe_w
	from	user_source
	where	name = 'OBTER_VL_COMPROMETIDO_NF';
	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'drop FUNCTION OBTER_VL_COMPROMETIDO_NF'
);
	end if;



	select	count(*)
	into STRICT	qt_existe_w
	from	OBJETO_SISTEMA
	where	NM_OBJETO = 'OBTER_VL_COMPROMETIDO_TIT_PAG';
	if (qt_existe_w > 0) then
		begin
		delete from  OBJETO_SISTEMA where NM_OBJETO = 'OBTER_VL_COMPROMETIDO_TIT_PAG';
		end;
	end if;
	select	count(*)
	into STRICT	qt_existe_w
	from	user_source
	where	name = 'OBTER_VL_COMPROMETIDO_TIT_PAG';
	if (qt_existe_w > 0) then
		CALL Exec_Sql_Dinamico('Maicon', 'drop FUNCTION OBTER_VL_COMPROMETIDO_TIT_PAG'
);
	end if;


end if;

if (dt_versao_atual_cliente_w < to_date('26/08/2016','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	user_tab_columns
	where	table_name = 'W_INT_NOTA_FISCAL'
	and	column_name = 'CD_ESTABELECIMENTO'
	and	data_Type <> 'VARCHAR2';

	if (qt_existe_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Maicon', 'ALTER TABLE W_INT_NOTA_FISCAL modify CD_ESTABELECIMENTO VARCHAR2(30)');
		end;
	end if;

end if;

if (dt_versao_atual_cliente_w < to_date('13/09/2016','dd/mm/yyyy')) then

	SELECT	COUNT(*)
	INTO STRICT	qt_existe_w
	from	OBJETO_SISTEMA
	WHERE	NM_OBJETO = 'CONSISTE_FECHAR_PROJETO_REC';

	IF (qt_existe_w > 0) THEN
		delete from OBJETO_SISTEMA
		where NM_OBJETO = 'CONSISTE_FECHAR_PROJETO_REC';
	END IF;


	SELECT	COUNT(*)
	INTO STRICT	QT_EXISTE_W
	FROM	USER_SOURCE
	where	name = 'CONSISTE_FECHAR_PROJETO_REC';

	if (qt_existe_w > 0) then
		CALL exec_sql_dinamico('Maicon', 'drop procedure CONSISTE_FECHAR_PROJETO_REC'
);
	end if;
END IF;

if (dt_versao_atual_cliente_w < to_date('20/09/2016','dd/mm/yyyy')) then
	update	kit_material
	set	IE_GERAR_REMONTAGEM = 'S'
	where	coalesce(IE_GERAR_REMONTAGEM,'X') = 'X';
end if;

if (dt_versao_atual_cliente_w < to_date('07/10/2016','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_existe_w
	from	TABELA_SISTEMA
	where	NM_TABELA = 'AREA_CONTRATO_REGRA';

	if (qt_existe_w > 0) then
		delete from TABELA_SISTEMA where NM_TABELA = 'AREA_CONTRATO_REGRA';
	end if;


	select	count(*)
	into STRICT	qt_existe_w
	from	user_tables
	where	table_name = 'AREA_CONTRATO_REGRA';

	if (qt_existe_w > 0) then
		CALL exec_sql_dinamico('Maicon', 'drop table AREA_CONTRATO_REGRA');
	end if;
end if;

if (dt_versao_atual_cliente_w < to_date('02/11/2016','dd/mm/yyyy')) then

	select count(*)
	into STRICT	qt_existe_w
	from	INDICE
	where	NM_INDICE = 'RECQSCA_USUARIO_FK_I';

	if (qt_existe_w = 0) then

		insert into INDICE(NM_INDICE,DS_INDICE,IE_TIPO,IE_CRIAR_ALTERAR,IE_SITUACAO,DT_CRIACAO,IE_IGNORADO_CLIENTE,IE_CLASSIFICACAO,DS_MENSAGEM,NM_TABELA,DT_ATUALIZACAO,NM_USUARIO)
		values ('RECQSCA_USUARIO_FK_I',' ','I','I','A',TO_DATE('02/11/2016 08:15:39','dd/mm/yyyy hh24:mi:ss'),'','IR','','REGRA_CONTR_QTDE_SC_ATRIB',TO_DATE('02/11/2016 08:15:39','dd/mm/yyyy hh24:mi:ss'),'Maicon');

		insert into INDICE_ATRIBUTO(NR_SEQUENCIA,NM_ATRIBUTO,DS_INDICE_FUNCTION,NM_TABELA,NM_INDICE,DT_ATUALIZACAO,NM_USUARIO)
		values (1,'NM_USUARIO_REGRA','','REGRA_CONTR_QTDE_SC_ATRIB','RECQSCA_USUARIO_FK_I',TO_DATE('02/11/2016 08:15:40','dd/mm/yyyy hh24:mi:ss'),'Maicon');
		commit;

	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	user_indexes
	where	index_name = 'RECQSCA_USUARIO_FK_I';

	if (qt_existe_w = 0) then
			CALL Exec_Sql_Dinamico('Maicon', 'Create 	Index 	RECQSCA_USUARIO_FK_I on REGRA_CONTR_QTDE_SC_ATRIB(NM_USUARIO_REGRA)');
	end if;
end if;

CALL atualizar_regra_preco_consig('Tasy');

if (dt_versao_atual_cliente_w < to_date('18/11/2016','dd/mm/yyyy')) then

	select 	count(*)
	into STRICT	qt_existe_w
	from	user_source
	where	name = 'OBTER_REGRA_VALOR_ORDEM_CONSIG';
	if (qt_existe_w > 0) then
		CALL exec_sql_dinamico('Maicon', 'drop procedure OBTER_REGRA_VALOR_ORDEM_CONSIG'
);
	end if;

	select	count(*)
	into STRICT	qt_existe_w
	from	OBJETO_SISTEMA
	where	NM_OBJETO = 'OBTER_REGRA_VALOR_ORDEM_CONSIG';

	if (qt_existe_w > 0) then
		delete from OBJETO_SISTEMA where nm_objeto = 'OBTER_REGRA_VALOR_ORDEM_CONSIG';
	end if;

end if;

if (dt_versao_atual_cliente_w < to_date('13/12/2016','dd/mm/yyyy')) then
	CALL exec_sql_dinamico('Sidnei', 'update REGRA_RESSUP_ESTAB set ie_atualiza_padrao_local = nvl(ie_atualiza_padrao_local, ''N'')');
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tasy_ajustar_base_sup ( nm_usuario_p text) FROM PUBLIC;

