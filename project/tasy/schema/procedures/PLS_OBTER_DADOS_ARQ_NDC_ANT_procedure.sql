-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_obter_dados_arq_ndc_ant (nr_seq_nota_deb_p bigint, cd_banco_p INOUT text, cd_agencia_bancaria_p INOUT text, nr_nosso_numero_p INOUT text, ds_uso_banco_p INOUT text, cd_carteira_p INOUT text, ds_especie_p INOUT text, vl_titulo_p INOUT bigint, dt_documento_p INOUT timestamp, ds_especie_doc_p INOUT text, ds_aceite_p INOUT text, dt_processo_p INOUT timestamp, ds_local_pagto_p INOUT text, ds_obs_local_pagto_p INOUT text, ds_instrucao_p INOUT text, ds_observacao_p INOUT text, nr_linha_digitavel_p INOUT text, cd_barras_p INOUT text, tp_boleto_p INOUT text) AS $body$
DECLARE


/*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: Obter os dados para a geração do arquivo de nota de débito A560, com as tabelas TIULO_RECEBER
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[X]  Objetos do dicionário [  ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/nr_seq_conta_banco_w	bigint;
nr_seq_carteira_cobr_w	bigint;
nr_titulo_w		bigint;
nr_nosso_numero_w	varchar(20);
vl_titulo_w		double precision;
dt_emissao_w		timestamp;
cd_banco_w		varchar(3);
cd_agencia_bancaria_w	varchar(8);
cd_carteira_w		varchar(10);
nr_bloqueto_w		varchar(44);


BEGIN
select	max(nr_nota_debito)
into STRICT	nr_titulo_w
from	ptu_nota_debito
where	nr_sequencia = nr_seq_nota_deb_p;

select	max(nr_seq_conta_banco),
	max(nr_seq_carteira_cobr),
	max(nr_nosso_numero),
	max(vl_titulo),
	max(dt_emissao),
	max(nr_bloqueto)
into STRICT	nr_seq_conta_banco_w,
	nr_seq_carteira_cobr_w,
	nr_nosso_numero_w,
	vl_titulo_w,
	dt_emissao_w,
	nr_bloqueto_w
from	titulo_receber
where	nr_titulo	= nr_titulo_w;

select	max(cd_banco),
	max(cd_agencia_bancaria),
	max(cd_carteira)
into STRICT	cd_banco_w,
	cd_agencia_bancaria_w,
	cd_carteira_w
from	banco_estabelecimento
where	nr_sequencia = nr_seq_conta_banco_w;

if (nr_seq_carteira_cobr_w IS NOT NULL AND nr_seq_carteira_cobr_w::text <> '') then
	select	substr(max(cd_carteira),1,10)
	into STRICT	cd_carteira_w
	from	banco_carteira
	where	nr_sequencia = nr_seq_carteira_cobr_w;
end if;

-- BOLETO
cd_banco_p 		:= coalesce(cd_banco_w,' ');
cd_agencia_bancaria_p 	:= coalesce(cd_agencia_bancaria_w,' ');
nr_nosso_numero_p 	:= coalesce(nr_nosso_numero_w,' ');
ds_uso_banco_p 		:= ' ';
cd_carteira_p 		:= coalesce(cd_carteira_w,' ');
ds_especie_p 		:= ' ';
vl_titulo_p 		:= coalesce(vl_titulo_w,0);
dt_documento_p 		:= dt_emissao_w;
ds_especie_doc_p	:= ' ';
ds_aceite_p 		:= 'N';
dt_processo_p 		:= dt_emissao_w;
ds_local_pagto_p 	:= 'Pago em qualquer banco ate a data do vencimento';
ds_obs_local_pagto_p 	:= ' ';
tp_boleto_p		:= '1';

-- INSTRUÇÕES
ds_instrucao_p 		:= ' ';

-- OBSERVAÇÕES
ds_observacao_p 	:= ' ';

-- LINHA DIGITAVEL
nr_linha_digitavel_p	:= coalesce(converte_codigo_bloqueto('Barra_Editado',nr_bloqueto_w),' ');
cd_barras_p		:= coalesce(nr_bloqueto_w,' ');

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_obter_dados_arq_ndc_ant (nr_seq_nota_deb_p bigint, cd_banco_p INOUT text, cd_agencia_bancaria_p INOUT text, nr_nosso_numero_p INOUT text, ds_uso_banco_p INOUT text, cd_carteira_p INOUT text, ds_especie_p INOUT text, vl_titulo_p INOUT bigint, dt_documento_p INOUT timestamp, ds_especie_doc_p INOUT text, ds_aceite_p INOUT text, dt_processo_p INOUT timestamp, ds_local_pagto_p INOUT text, ds_obs_local_pagto_p INOUT text, ds_instrucao_p INOUT text, ds_observacao_p INOUT text, nr_linha_digitavel_p INOUT text, cd_barras_p INOUT text, tp_boleto_p INOUT text) FROM PUBLIC;

