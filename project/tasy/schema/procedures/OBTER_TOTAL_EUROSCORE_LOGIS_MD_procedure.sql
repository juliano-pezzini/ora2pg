-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_total_euroscore_logis_md (qt_ano_p bigint, ie_calculo_p text, ie_sexo_p text, ie_doenca_pulm_cronica_p text, ie_arteriopatia_extracardi_p text, ie_disfuncao_neurologica_p text, ie_cirurgia_cardiaca_previa_p text, ie_creatinina_200_p text, ie_endocartite_ativa_p text, ie_preoperativo_critico_p text, ie_angina_instavel_p text, ie_funcao_ve_p text, ie_infarto_miocardio_p text, ie_hipertensao_pulmonar_p text, ie_emergencia_p text, ie_outro_proc_revasc_p text, ie_cirurgia_aorta_p text, ie_ruptura_septal_p text, qt_score_ano_p INOUT bigint, qt_sexo_p INOUT bigint, qt_doenca_pulm_cronica_p INOUT bigint, qt_arteriopatia_extracardi_p INOUT bigint, qt_disfuncao_neurologica_p INOUT bigint, qt_cirurgia_cardiaca_previa_p INOUT bigint, qt_creatinina_200_p INOUT bigint, qt_endocartite_ativa_p INOUT bigint, qt_preoperativo_critico_p INOUT bigint, qt_angina_instavel_p INOUT bigint, qt_funcao_ve_p INOUT bigint, qt_infarto_miocardio_p INOUT bigint, qt_hipertensao_pulmonar_p INOUT bigint, qt_emergencia_p INOUT bigint, qt_outro_proc_revasc_p INOUT bigint, qt_cirurgia_aorta_p INOUT bigint, qt_ruptura_septal_p INOUT bigint, qt_score_p INOUT bigint, qt_pontuacao2_p INOUT bigint) AS $body$
DECLARE

  qt_pontuacao_w double precision;
  e              double precision;


BEGIN
  qt_pontuacao_w  := 0;
  qt_pontuacao2_p := null;

  if (ie_calculo_p in ('L', 'A')) then

    if (qt_ano_p > 59) then
      qt_score_ano_p := ((coalesce(qt_ano_p, 0) - 58) * .066635);
    else
      qt_score_ano_p := 1 * .066635;
    end if;

    if (ie_sexo_p = 'F') then
      qt_sexo_p := .3304052;
    end if;
    if (ie_doenca_pulm_cronica_p = 'S') then
      qt_doenca_pulm_cronica_p := .4931341;
    end if;
    if (ie_arteriopatia_extracardi_p = 'S') then
      qt_arteriopatia_extracardi_p := .6558917;
    end if;
    if (ie_disfuncao_neurologica_p = 'S') then
      qt_disfuncao_neurologica_p := .841626;
    end if;
    if (ie_cirurgia_cardiaca_previa_p = 'S') then
      qt_cirurgia_cardiaca_previa_p := 1.002625;
    end if;
    if (ie_creatinina_200_p = 'S') then
      qt_creatinina_200_p := .6521653;
    end if;
    if (ie_endocartite_ativa_p = 'S') then
      qt_endocartite_ativa_p := 1.101265;
    end if;
    if (ie_preoperativo_critico_p = 'S') then
      qt_preoperativo_critico_p := .9058132;
    end if;
    if (ie_angina_instavel_p = 'S') then
      qt_angina_instavel_p := .5677075;
    end if;
    if (ie_funcao_ve_p = 'I') then
      qt_funcao_ve_p := 1.094443;
    elsif (ie_funcao_ve_p = 'M') then
      qt_funcao_ve_p := .4191643;
    end if;
    if (ie_infarto_miocardio_p = 'S') then
      qt_infarto_miocardio_p := .5460218;
    end if;
    if (ie_hipertensao_pulmonar_p = 'S') then
      qt_hipertensao_pulmonar_p := .7676924;
    end if;
    if (ie_emergencia_p = 'S') then
      qt_emergencia_p := .7127953;
    end if;
    if (ie_outro_proc_revasc_p = 'S') then
      qt_outro_proc_revasc_p := .5420364;
    end if;
    if (ie_cirurgia_aorta_p = 'S') then
      qt_cirurgia_aorta_p := 1.159787;
    end if;
    if (ie_ruptura_septal_p = 'S') then
      qt_ruptura_septal_p := 1.462009;
    end if;

    qt_pontuacao_w := -4.789594 + coalesce(qt_score_ano_p, 0) + coalesce(qt_sexo_p, 0) +
                      coalesce(qt_doenca_pulm_cronica_p, 0) +
                      coalesce(qt_arteriopatia_extracardi_p, 0) +
                      coalesce(qt_disfuncao_neurologica_p, 0) +
                      coalesce(qt_cirurgia_cardiaca_previa_p, 0) + coalesce(qt_creatinina_200_p, 0) +
                      coalesce(qt_endocartite_ativa_p, 0) + coalesce(qt_preoperativo_critico_p, 0) +
                      coalesce(qt_angina_instavel_p, 0) + coalesce(qt_funcao_ve_p, 0) +
                      coalesce(qt_infarto_miocardio_p, 0) + coalesce(qt_hipertensao_pulmonar_p, 0) +
                      coalesce(qt_emergencia_p, 0) + coalesce(qt_outro_proc_revasc_p, 0) +
                      coalesce(qt_cirurgia_aorta_p, 0) + coalesce(qt_ruptura_septal_p, 0);
    e              := 2.718281828;

    if (ie_calculo_p = 'A') then
      qt_pontuacao2_p := (dividir_sem_round_md(power(e, qt_pontuacao_w), (1 + power(e, qt_pontuacao_w))) * 100);
    else
      qt_score_p := (dividir_sem_round_md(power(e, qt_pontuacao_w), (1 + power(e, qt_pontuacao_w))) * 100);
    end if;
  end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_total_euroscore_logis_md (qt_ano_p bigint, ie_calculo_p text, ie_sexo_p text, ie_doenca_pulm_cronica_p text, ie_arteriopatia_extracardi_p text, ie_disfuncao_neurologica_p text, ie_cirurgia_cardiaca_previa_p text, ie_creatinina_200_p text, ie_endocartite_ativa_p text, ie_preoperativo_critico_p text, ie_angina_instavel_p text, ie_funcao_ve_p text, ie_infarto_miocardio_p text, ie_hipertensao_pulmonar_p text, ie_emergencia_p text, ie_outro_proc_revasc_p text, ie_cirurgia_aorta_p text, ie_ruptura_septal_p text, qt_score_ano_p INOUT bigint, qt_sexo_p INOUT bigint, qt_doenca_pulm_cronica_p INOUT bigint, qt_arteriopatia_extracardi_p INOUT bigint, qt_disfuncao_neurologica_p INOUT bigint, qt_cirurgia_cardiaca_previa_p INOUT bigint, qt_creatinina_200_p INOUT bigint, qt_endocartite_ativa_p INOUT bigint, qt_preoperativo_critico_p INOUT bigint, qt_angina_instavel_p INOUT bigint, qt_funcao_ve_p INOUT bigint, qt_infarto_miocardio_p INOUT bigint, qt_hipertensao_pulmonar_p INOUT bigint, qt_emergencia_p INOUT bigint, qt_outro_proc_revasc_p INOUT bigint, qt_cirurgia_aorta_p INOUT bigint, qt_ruptura_septal_p INOUT bigint, qt_score_p INOUT bigint, qt_pontuacao2_p INOUT bigint) FROM PUBLIC;

