-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consulta_processamento_estoque () AS $body$
DECLARE


json_w        philips_json;
json_data_w   text;

c01 CURSOR FOR
SELECT  cd_registro_origem,
		cd_registro_externo,
        dt_atualizacao
 from   transm_bndasaf
where (coalesce(ds_situacao_processamento::text, '') = '' or ds_situacao_processamento <> 'FINALIZADO')
  and ie_evento = '392';

BEGIN
    for c01_w in c01 loop
        json_w := philips_json();
        json_w.put('incomingProtocol', c01_w.cd_registro_externo);
		json_w.put('receiveDate', c01_w.dt_atualizacao);
		json_w.put('document', c01_w.cd_registro_origem);

        dbms_lob.createtemporary(json_data_w, true);
		json_w.(json_data_w);

		json_data_w := bifrost.send_integration_content('monthlyClosingQueryProcessing.send.request', json_data_w, 'wfwerling');
    end loop;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consulta_processamento_estoque () FROM PUBLIC;

