-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copy_to_cpoe_material (nr_sequencia_p bigint, nr_atendimento_p bigint, nm_usuario_p text, nr_seq_proc_edit_p bigint) AS $body$
DECLARE

												
cd_unidade_medida_w   prescr_proc_item_sug.cd_unidade_medida%type;
qt_dose_w             prescr_proc_item_sug.qt_dose%type;
cd_intervalo_w        prescr_proc_item_sug.cd_intervalo%type;
ie_via_aplicacao_w    prescr_proc_item_sug.ie_via_aplicacao%type;
cd_material_w         prescr_proc_item_sug.cd_material%type;
qt_register_w         integer;


BEGIN

if (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '')then

	select  cd_unidade_medida,
		  qt_dose,
		  cd_intervalo,
		  ie_via_aplicacao,
		  cd_material
	into STRICT    cd_unidade_medida_w,
		  qt_dose_w,
		  cd_intervalo_w,
		  ie_via_aplicacao_w,
		  cd_material_w
	from    prescr_proc_item_sug
	where   nr_sequencia = nr_sequencia_p;

	select  count(1)
	into STRICT    qt_register_w
	from    prescr_proc_item_sug
	where   nr_sequencia = nr_sequencia_p;

if (qt_register_w > 0) then

	insert into cpoe_material(nr_sequencia, 
      dt_atualizacao,
      nm_usuario,
      dt_atualizacao_nrec,
      nm_usuario_nrec,
      cd_unidade_medida,
      qt_dose,
      cd_intervalo,
      ie_via_aplicacao,
      cd_material,
      nr_atendimento,
      nr_seq_proc_edit,
      nr_seq_sugest) 
    values (nextval('cpoe_material_seq'), 
      clock_timestamp(),
      nm_usuario_p,
      clock_timestamp(),
      nm_usuario_p,
      cd_unidade_medida_w,
      qt_dose_w,
      cd_intervalo_w,
      ie_via_aplicacao_w,
      cd_material_w,
      nr_atendimento_p,
      nr_seq_proc_edit_p,
      nr_sequencia_p);

    commit;

  end if;

end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copy_to_cpoe_material (nr_sequencia_p bigint, nr_atendimento_p bigint, nm_usuario_p text, nr_seq_proc_edit_p bigint) FROM PUBLIC;

