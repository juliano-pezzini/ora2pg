-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE intpd_processar_gerint () AS $body$
BEGIN

 UPDATE INTPD_FILA_TRANSMISSAO
    SET IE_STATUS = 'E'
  WHERE IE_EVENTO IN (	88, 	--Serviço de bloqueio de leito
						89, 	--Serviço de desbloqueio de leito
						90, 	--Serviço de internação
						91, 	--Serviço de internação em um leito extra
						92, 	--Serviço de liberação de internação
						93, 	--Serviço de transferência do leito da internação
						94, 	--Serviço de reversão da internação
						95, 	--Serviço de reversão da alta/óbito
						96, 	--Serviço de solicitação de internação
						97,	--Serviço de nova evolução do paciente
						99,	--Serviço de permuta de leito
						100,	--Serviço de consulta da situação das Solicitações
						101, --Serviço de identificação do paciente
						107, --Serviço de reinternação da solicitação
						136)--Serviço de solicitação de transferência de paciente.
    AND	IE_STATUS = 'R'
	AND (clock_timestamp() - DT_ATUALIZACAO) > 1/60/24 --  Alterar somente processamentos que estão a mais de 1 minutos em processamento
	AND TRUNC(DT_ATUALIZACAO) = TRUNC(clock_timestamp());
	
 UPDATE	GERINT_SOLIC_INTERNACAO
    SET	IE_SITUACAO = 'N'
  WHERE	IE_SITUACAO = 'O'
	AND (clock_timestamp() - DT_ATUALIZACAO_NREC) > 1/60/24
    AND	TRUNC(DT_ATUALIZACAO_NREC) = TRUNC(clock_timestamp());

COMMIT;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE intpd_processar_gerint () FROM PUBLIC;

