-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_config_panel_editor ( cd_funcao_p bigint, nm_usuario_config_p text , cd_estabelecimento_p bigint, nm_tabela_p text, ds_config_p INOUT text) AS $body$
DECLARE


ds_sep_w		varchar(2) := ';';
ds_colunas_w	varchar(256);
cd_perfil_w 	integer;
nr_seq_panel_w	integer;
ds_config_w	varchar(255);
ds_configs_w	varchar(2000);

C01 CURSOR FOR
	SELECT	QT_TAMANHO_FONTE 		|| ds_sep_w ||
			DS_FONTE 		 		|| ds_sep_w ||
			IE_NEGRITO 		 		|| ds_sep_w ||
			IE_ITALICO 		 		|| ds_sep_w ||
			IE_SUBLINHADO 	 		|| ds_sep_w ||
			IE_ALINHAMENTO 	 		|| ds_sep_w ||
			DS_COR_FONTE 	 		|| ds_sep_w ||
			IE_ALTERAR_COR			|| ds_sep_w ||
			IE_ALTERAR_FONTE		|| ds_sep_w ||
			IE_ALTERAR_TAM_FONTE	|| ds_sep_w ||
			IE_ALTERAR_ALINHAMENTO	|| ds_sep_w ||
			IE_ALTERAR_ITALICO		|| ds_sep_w ||
			IE_ALTERAR_SUBLINHADO	|| ds_sep_w ||
			IE_ALTERAR_NEGRITO		|| ds_sep_w ||
			IE_PERMITE_COPIAR		|| ds_sep_w ||
			IE_PERMITE_COLAR		|| ds_sep_w ||
			CD_TIPO_MARCADOR		|| ds_sep_w ||
			IE_AUTO_LINK		ds_configuracao,
			nr_sequencia
	FROM	configuracao_panel_editor
	WHERE	coalesce(cd_funcao,coalesce(cd_funcao_p,0))								= coalesce(cd_funcao_p,0)
	AND 	coalesce(UPPER(nm_usuario_config),coalesce(UPPER(nm_usuario_config_p),0)) = coalesce(UPPER(nm_usuario_config_p),0)
	AND 	coalesce(cd_estabelecimento,coalesce(cd_estabelecimento_p,0))           	= coalesce(cd_estabelecimento_p,0)
	AND 	coalesce(cd_perfil,coalesce(cd_perfil_w,0))           					= coalesce(cd_perfil_w,0)
	AND	coalesce(upper(nm_tabela),coalesce(upper(nm_tabela_p),0)) = coalesce(upper(nm_tabela_p),0)
	ORDER BY
		coalesce(nm_usuario_config,'AAAAAAAA'),
		coalesce(cd_funcao,0),
		coalesce(cd_perfil,0),
		coalesce(cd_estabelecimento,0);

C02 CURSOR FOR
	SELECT	cd_item || '@#' || ie_configuracao
	from	config_item_panel_editor
	where 	nr_seq_copaedi = nr_seq_panel_w
	order by CASE WHEN cd_item='PR' THEN 0  ELSE 1 END;


BEGIN

	cd_perfil_w := obter_perfil_ativo;

	ds_config_p := NULL;
	OPEN C01;
	LOOP
	FETCH C01 INTO
		ds_config_p,
		nr_seq_panel_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */
		BEGIN
			open C02;
			loop
			fetch C02 into
				ds_config_w;
			EXIT WHEN NOT FOUND; /* apply on C02 */
				begin
				if (length(ds_configs_w) > 0) then
					ds_configs_w :=  ds_configs_w || '&';
				end if;

				ds_configs_w := ds_configs_w || ds_config_w;
				end;
			end loop;
			close C02;

			ds_config_p := ds_config_p || ';' || ds_configs_w;
		END;
	END LOOP;
	CLOSE C01;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_config_panel_editor ( cd_funcao_p bigint, nm_usuario_config_p text , cd_estabelecimento_p bigint, nm_tabela_p text, ds_config_p INOUT text) FROM PUBLIC;

