-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consiste_tipo_atend_same ( nr_sequencia_p bigint, nr_seq_caixa_sup_p bigint, ie_tipo_atend_p bigint) AS $body$
DECLARE



ie_tipo_atendimento_w	smallint := 0;
qt_contador_w		bigint;
ds_tipo_atendimento_w	varchar(60);


BEGIN

if (nr_seq_caixa_sup_p <> 0) then
	Select	coalesce(max(ie_tipo_atendimento),0)
	into STRICT	ie_tipo_atendimento_w
	from	same_caixa
	where	nr_sequencia	= nr_seq_caixa_sup_p;

	if (ie_tipo_atendimento_w <> ie_tipo_atend_p) and (ie_tipo_atendimento_w <> 0) then
		Select	substr(obter_valor_dominio(12,ie_tipo_atendimento_w),1,50)
		into STRICT	ds_tipo_atendimento_w
		;
		--Na caixa superior selecionada só podem ser incluídos atendimentos do tipo '||ds_tipo_atendimento_w);
		CALL Wheb_mensagem_pck.exibir_mensagem_abort(261577, 'TIPO_ATENDIMENTO='||ds_tipo_atendimento_w);
	end if;
end if;

if (ie_tipo_atend_p <> 0) then
	Select	count(*)
	into STRICT	qt_contador_w
	from	same_prontuario
	where	nr_seq_caixa	= nr_sequencia_p;

	if (qt_contador_w > 0) then
		--Não pode-se alterar o tipo de atendimento da caixa quando a mesma possui prontuários!');
		CALL Wheb_mensagem_pck.exibir_mensagem_abort(261579);
	end if;

	Select	count(*)
	into STRICT	qt_contador_w
	from	same_caixa
	where	nr_seq_caixa_superior	= nr_sequencia_p;

	Select	coalesce(max(ie_tipo_atendimento),0)
	into STRICT	ie_tipo_atendimento_w
	from	same_caixa
	where	nr_sequencia	= nr_sequencia_p;

	if (qt_contador_w > 0) and (ie_tipo_atendimento_w <> ie_tipo_atend_p) then
		--Não pode-se alterar o tipo de atendimento da caixa quando a mesma possui outras caixas!');
		CALL Wheb_mensagem_pck.exibir_mensagem_abort(261580);
	end if;
end if;


END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consiste_tipo_atend_same ( nr_sequencia_p bigint, nr_seq_caixa_sup_p bigint, ie_tipo_atend_p bigint) FROM PUBLIC;

