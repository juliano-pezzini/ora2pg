-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_atualizar_param_cons_web () AS $body$
DECLARE


qt_registros_w	bigint;


BEGIN


select	count(1)
  into STRICT	qt_registros_w
  from  funcao_parametro
 where 	cd_funcao = 1247
   and 	nr_sequencia = 52;

if ( qt_registros_w = 1) then

	select	count(1)
	  into STRICT	qt_registros_w
	  from  pls_web_param_usuario
	 where 	cd_funcao = 1247
	   and 	nr_seq_funcao_param = 52;

	if (qt_registros_w = 0) then

		update	funcao_parametro
		   set	vl_parametro = (SELECT max(vl_parametro) from funcao_parametro where cd_funcao = 1247 and nr_sequencia = 19)
		 where 	cd_funcao = 1247
		   and 	nr_sequencia = 52;


		insert	into	pls_web_param_usuario(nr_sequencia, cd_estabelecimento, nr_seq_param,
											  nr_seq_segurado, nr_seq_usu_estipulante, nr_seq_usu_prestador ,
											  vl_parametro, nm_usuario_param, nr_seq_funcao_param ,
											  cd_funcao, ie_tipo_acesso, ds_observacao,
											  nr_seq_perfil_web, nr_seq_usu_grupo_contrato, nr_seq_usu_cooperado,
											  nm_usuario_nrec, dt_atualizacao_nrec, dt_atualizacao,
											  nm_usuario)
								   (SELECT	  nextval('pls_web_param_usuario_seq'), cd_estabelecimento, nr_seq_param,
											  nr_seq_segurado, nr_seq_usu_estipulante, nr_seq_usu_prestador ,
											  vl_parametro, nm_usuario_param, 52 ,
											  1247, ie_tipo_acesso, ds_observacao,
											  nr_seq_perfil_web, nr_seq_usu_grupo_contrato, nr_seq_usu_cooperado,
											  'baca', clock_timestamp(), clock_timestamp(),
											  'baca'
									  from	  pls_web_param_usuario
									 where    cd_funcao = 1247
									   and 	  nr_seq_funcao_param = 19);


		insert	into   pls_web_param_contrato(nr_sequencia, cd_estabelecimento, nr_seq_param,
											  nr_seq_contrato, ds_observacao,  nm_usuario_nrec,
											  dt_atualizacao_nrec, dt_atualizacao,nm_usuario,
											  cd_funcao, nr_seq_funcao_param)
								   (SELECT	  nextval('pls_web_param_contrato_seq'), cd_estabelecimento, nr_seq_param,
											  nr_seq_contrato, ds_observacao, 'baca',
											  clock_timestamp(), clock_timestamp(), 'baca',
											  1247, 52
									  from	  pls_web_param_contrato
									 where    cd_funcao = 1247
									   and 	  nr_seq_funcao_param = 19);

	end if;

end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_atualizar_param_cons_web () FROM PUBLIC;

