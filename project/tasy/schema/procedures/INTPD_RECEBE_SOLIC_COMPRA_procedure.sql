-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE intpd_recebe_solic_compra ( nr_sequencia_p bigint, xml_p xml) AS $body$
DECLARE


_ora2pg_r RECORD;
ds_id_origin_w				intpd_eventos_sistema.ds_id_origin%type;
ie_conversao_w				intpd_eventos_sistema.ie_conversao%type;
nr_seq_sistema_w			intpd_eventos_sistema.nr_seq_sistema%type;
nr_seq_projeto_xml_w			intpd_eventos_sistema.nr_seq_projeto_xml%type;
nr_seq_regra_conv_w			conversao_meio_externo.nr_seq_regra%type;
ie_sistema_externo_w			varchar(15);
reg_integracao_w			gerar_int_padrao.reg_integracao_conv;
solic_compra_w				solic_compra%rowtype;
solic_compra_item_w			solic_compra_item%rowtype;
solic_compra_item_entrega_w		solic_compra_item_entrega%rowtype;
nr_item_solic_compra_w			solic_compra_item.nr_item_solic_compra%type;
nr_item_solic_compra_entr_w		solic_compra_item_entrega.nr_item_solic_compra_entr%type;
ie_erro_w				varchar(1) := 'N';
nr_solic_compra_delete_w		solic_compra.nr_solic_compra%type;
qt_registros_w				bigint;

c01 CURSOR FOR
SELECT	*
from	xmltable('/STRUCTURE/PURCHASE' passing xml_p columns
	ie_action				varchar(15)			path 'IE_ACTION',
	DT_SOLICITACAO_COMPRA			timestamp				path 'DT_SOLICITACAO_COMPRA',
	DT_BAIXA				timestamp				path 'DT_BAIXA',
	DT_LIBERACAO				timestamp				path 'DT_LIBERACAO',
	DT_IMPRESSAO				timestamp				path 'DT_IMPRESSAO',
	DT_AUTORIZACAO				timestamp				path 'DT_AUTORIZACAO',
	DT_PRE_APROVACAO			timestamp				path 'DT_PRE_APROVACAO',
	DT_PRE_LIBERACAO			timestamp				path 'DT_PRE_LIBERACAO',
	DT_RECEBIMENTO				timestamp				path 'DT_RECEBIMENTO',
	DT_VENCIMENTO				timestamp				path 'DT_VENCIMENTO',
	CD_ESTABELECIMENTO			smallint			path 'CD_ESTABELECIMENTO',
	CD_PESSOA_SOLICITANTE			varchar(10) 			path 'CD_PESSOA_SOLICITANTE',
	CD_LOCAL_ESTOQUE			smallint			path 'CD_LOCAL_ESTOQUE',
	CD_CENTRO_CUSTO				integer			path 'CD_CENTRO_CUSTO',
	CD_CONTA_CONTABIL			varchar(20)			path 'CD_CONTA_CONTABIL',
	CD_SETOR_ATENDIMENTO			integer			path 'CD_SETOR_ATENDIMENTO',
	DS_OBSERVACAO				varchar(4000)			path 'DS_OBSERVACAO',
	IE_AVISO_CHEGADA			varchar(1)			path 'IE_AVISO_CHEGADA',
	IE_AVISO_APROV_OC			varchar(1)			path 'IE_AVISO_APROV_OC',
	IE_URGENTE				varchar(1)			path 'IE_URGENTE',
	NR_DOC_EXTERNO_RECEB			varchar(40)			path 'NR_DOC_EXTERNO_RECEB',
	CD_COMPRADOR_RESP			varchar(10)			path 'CD_COMPRADOR_RESP',
	CD_MOTIVO_BAIXA				integer			path 'CD_MOTIVO_BAIXA',
	CD_PESSOA_AUTORIZA			varchar(10)			path 'CD_PESSOA_AUTORIZA',
	NR_SEQ_ORDEM_SERV			bigint			path 'NR_SEQ_ORDEM_SERV',
	NR_SEQ_MOTIVO_CANCEL			bigint			path 'NR_SEQ_MOTIVO_CANCEL',
	IE_FORMA_EXPORTAR			varchar(1)			path 'IE_FORMA_EXPORTAR',
	NR_SEQ_PLANEJAMENTO			bigint 			path 'NR_SEQ_PLANEJAMENTO',
	NR_SEQ_PROJ_GPI				bigint			path 'NR_SEQ_PROJ_GPI',
	NR_SEQ_ETAPA_GPI			bigint			path 'NR_SEQ_ETAPA_GPI',
	NR_SEQ_CONTA_GPI			bigint			path 'NR_SEQ_CONTA_GPI',
	IE_TIPO_SOLICITACAO			varchar(1)			path 'IE_TIPO_SOLICITACAO',
	NR_SEQ_RESSUP_FORNEC			bigint			path 'NR_SEQ_RESSUP_FORNEC',
	IE_COMODATO				varchar(1)			path 'IE_COMODATO',
	IE_SEMANAL				varchar(1)			path 'IE_SEMANAL',
	IE_TIPO_COMPRA				varchar(15)			path 'IE_TIPO_COMPRA',
	NR_SEQ_TIPO_COMPRA			bigint			path 'NR_SEQ_TIPO_COMPRA',
	NR_SEQ_MOD_COMPRA			bigint			path 'NR_SEQ_MOD_COMPRA',
	NR_SEQ_FORMA_COMPRA			bigint			path 'NR_SEQ_FORMA_COMPRA',
	NR_SEQ_MOTIVO_SOLIC			bigint			path 'NR_SEQ_MOTIVO_SOLIC',
	DS_JUSTIFICATIVA			varchar(2000)			path 'DS_JUSTIFICATIVA',
	NR_SOLIC_COMPRA_ORIGEM_LIC		bigint			path 'NR_SOLIC_COMPRA_ORIGEM_LIC',
	NR_COT_COMPRA_ORIGEM_LIC		bigint			path 'NR_COT_COMPRA_ORIGEM_LIC',
	CD_FORNEC_EXCLUSIVO			varchar(14)			path 'CD_FORNEC_EXCLUSIVO',
	CD_FORNEC_SUGERIDO			varchar(14)			path 'CD_FORNEC_SUGERIDO',
	NR_SEQ_MOTIVO_URGENTE			bigint			path 'NR_SEQ_MOTIVO_URGENTE',
	NM_USUARIO_PRE_APROV			varchar(15)			path 'NM_USUARIO_PRE_APROV',
	NR_PRESCRICAO				bigint			path 'NR_PRESCRICAO',
	NR_SEQ_PROT_SOLIC			bigint			path 'NR_SEQ_PROT_SOLIC',
	NR_SEQ_ORCAMENTO_GPI			bigint			path 'NR_SEQ_ORCAMENTO_GPI',
	NM_USUARIO_PRE_LIB			varchar(15)			path 'NM_USUARIO_PRE_LIB',
	NM_USUARIO_LIB				varchar(15)			path 'NM_USUARIO_LIB',
	NR_SEQ_GRUPO_RESP_COMPRA		bigint			path 'NR_SEQ_GRUPO_RESP_COMPRA',
	NR_LOTE_PRODUCAO			bigint			path 'NR_LOTE_PRODUCAO',
	IE_TIPO_SERVICO				varchar(15)			path 'IE_TIPO_SERVICO',
	IE_STATUS_ENVIO				varchar(15)			path 'IE_STATUS_ENVIO',
	NM_USUARIO_VER_PRE_LIB			varchar(15)			path 'NM_USUARIO_VER_PRE_LIB',
	CD_PERFIL				integer			path 'CD_PERFIL',
	CD_PESSOA_FISICA			varchar(10)			path 'CD_PESSOA_FISICA',
	NM_USUARIO_RECEB			varchar(15)			path 'NM_USUARIO_RECEB',
	CD_SETOR_ENTREGA			integer			path 'CD_SETOR_ENTREGA',
	CD_BANCO				integer			path 'CD_BANCO',
	CD_AGENCIA_BANCARIA			varchar(8)			path 'CD_AGENCIA_BANCARIA',
	NR_CONTA				varchar(8)			path 'NR_CONTA',
	NR_DIGITO_CONTA				varchar(2)			path 'NR_DIGITO_CONTA',
	NR_NOTA_FISCAL				varchar(255)			path 'NR_NOTA_FISCAL',
	IE_ORCADO				varchar(1)			path 'IE_ORCADO',
	NM_USUARIO				varchar(15)			path 'NM_USUARIO',
	xml_solic_itens				xml 			path 'ITENS');

c01_w	c01%rowtype;

c02 CURSOR FOR
SELECT	*
from	xmltable('/ITENS/ITEM' passing c01_w.xml_solic_itens columns
	NR_ITEM_SOLIC_COMPRA			integer			path 'NR_ITEM_SOLIC_COMPRA',
	CD_MATERIAL				integer			path 'CD_MATERIAL',
	CD_UNIDADE_MEDIDA_COMPRA		varchar(30)			path 'CD_UNIDADE_MEDIDA_COMPRA',
	QT_MATERIAL				double precision			path 'QT_MATERIAL',
	IE_SITUACAO				varchar(1)			path 'IE_SITUACAO',
	DS_MATERIAL_DIRETO			varchar(255)			path 'DS_MATERIAL_DIRETO',
	DS_OBSERVACAO				varchar(255)			path 'DS_OBSERVACAO',
	NR_COT_COMPRA				bigint			path 'NR_COT_COMPRA',
	NR_ITEM_COT_COMPRA			integer			path 'NR_ITEM_COT_COMPRA',
	CD_MOTIVO_BAIXA				integer			path 'CD_MOTIVO_BAIXA',
	DT_BAIXA				timestamp				path 'DT_BAIXA',
	DT_SOLIC_ITEM				timestamp				path 'DT_SOLIC_ITEM',
	NR_SEQ_APROVACAO			bigint			path 'NR_SEQ_APROVACAO',
	DT_AUTORIZACAO				timestamp				path 'DT_AUTORIZACAO',
	VL_UNIT_PREVISTO			double precision			path 'VL_UNIT_PREVISTO',
	IE_GERACAO				varchar(1)			path 'IE_GERACAO',
	NR_SEQ_PROJ_REC				bigint			path 'NR_SEQ_PROJ_REC',
	DT_REPROVACAO				timestamp				path 'DT_REPROVACAO',
	NR_SEQ_MOTIVO_CANCEL			bigint			path 'NR_SEQ_MOTIVO_CANCEL',
	IE_FORMA_EXPORTAR			varchar(1)			path 'IE_FORMA_EXPORTAR',
	NR_SOLIC_COMPRA_REF			bigint			path 'NR_SOLIC_COMPRA_REF',
	NR_ITEM_SOLIC_COMPRA_REF		integer			path 'NR_ITEM_SOLIC_COMPRA_REF',
	CD_CONTA_CONTABIL			varchar(20)			path 'CD_CONTA_CONTABIL',
	DS_OBSERVACAO_INT			varchar(255)			path 'DS_OBSERVACAO_INT',
	NR_CONTRATO				bigint			path 'NR_CONTRATO',
	IE_BULA					varchar(1)			path 'IE_BULA',
	IE_AMOSTRA				varchar(1)			path 'IE_AMOSTRA',
	IE_CATALOGO				varchar(1)			path 'IE_CATALOGO',
	NR_SEQ_ORC_ITEM_GPI			bigint			path 'NR_SEQ_ORC_ITEM_GPI',
	QT_CONV_COMPRA_EST_ORIG			double precision			path 'QT_CONV_COMPRA_EST_ORIG',
	NR_SEQ_MARCA				bigint			path 'NR_SEQ_MARCA',
	NR_SEQ_REGRA_CONTRATO			bigint			path 'NR_SEQ_REGRA_CONTRATO',
	QT_SALDO_DISP_ESTOQUE			double precision			path 'QT_SALDO_DISP_ESTOQUE',
	QT_CONSUMO_MENSAL			double precision			path 'QT_CONSUMO_MENSAL',
	DT_DESDOBR_APROV			timestamp				path 'DT_DESDOBR_APROV',
	NR_SEQ_LOTE_FORNEC			bigint			path 'NR_SEQ_LOTE_FORNEC',
	NR_SEQ_LICITACAO			bigint			path 'NR_SEQ_LICITACAO',
	NR_SEQ_LIC_ITEM				bigint			path 'NR_SEQ_LIC_ITEM',
	IE_MOTIVO_REPROVACAO			varchar(15)			path 'IE_MOTIVO_REPROVACAO',
	DS_JUSTIFICATIVA_REPROV			varchar(255)			path 'DS_JUSTIFICATIVA_REPROV',
	NR_REQUISICAO				bigint			path 'NR_REQUISICAO',
	NR_SEQ_ITEM_REQUISICAO			integer			path 'NR_SEQ_ITEM_REQUISICAO',
	VL_CUSTO_TOTAL				double precision			path 'VL_CUSTO_TOTAL',
	VL_ESTOQUE_TOTAL			double precision			path 'VL_ESTOQUE_TOTAL',
	NR_ORDEM_COMPRA_ORIG			bigint			path 'NR_ORDEM_COMPRA_ORIG',
	CD_PERFIL_APROV				integer			path 'CD_PERFIL_APROV',
	NR_SEQ_CRITERIO_RATEIO			bigint 			path 'NR_SEQ_CRITERIO_RATEIO',
	DS_JUSTIF_DIVER				varchar(4000)			path 'DS_JUSTIF_DIVER',
	QT_DIAS_ESTOQUE				double precision			path 'QT_DIAS_ESTOQUE',
	CD_CNPJ					varchar(14)			path 'CD_CNPJ',
	IE_CANCELAMENTO_INTEGR			varchar(1)			path 'IE_CANCELAMENTO_INTEGR',
	NR_SEQ_NORMA_COMPRA			bigint			path 'NR_SEQ_NORMA_COMPRA',
	NR_SEQ_PROC_APROV			bigint 			path 'NR_SEQ_PROC_APROV',
	IE_SERVICO_REALIZADO			varchar(15)			path 'IE_SERVICO_REALIZADO',
	DS_MARCAS_ACEITAVEIS			varchar(2000) 			path 'DS_MARCAS_ACEITAVEIS',
	VL_ORCADO_GPI				double precision 			path 'VL_ORCADO_GPI',
	DT_SOLIC_ITEM_ANT			timestamp				path 'DT_SOLIC_ITEM_ANT',
	NR_SEQ_JUSTIF				bigint			path 'NR_SEQ_JUSTIF',
	NR_SEQ_ORDEM_SERV			bigint			path 'NR_SEQ_ORDEM_SERV',
	NR_SEQ_CONTA_FINANC			bigint			path 'NR_SEQ_CONTA_FINANC',
	QT_AMOSTRA				double precision			path 'QT_AMOSTRA',
	NR_SEQ_REG_PCS				bigint			path 'NR_SEQ_REG_PCS',
	NR_SEQ_REG_COMPRA			bigint			path 'NR_SEQ_REG_COMPRA',
	NR_SEQ_OP_COMP_OPM			bigint			path 'NR_SEQ_OP_COMP_OPM',
	NR_ITEM_OCI_ORIG			integer			path 'NR_ITEM_OCI_ORIG',
	QT_SALDO_REG_PRECO			double precision			path 'QT_SALDO_REG_PRECO',
	QT_MATERIAL_CANCELADO			double precision			path 'QT_MATERIAL_CANCELADO',
	xml_solic_item_entrega			xml 			path 'ENTREGAS');

c02_w	c02%rowtype;

c03 CURSOR FOR
SELECT	*
from	xmltable('/ENTREGAS/ENTREGA' passing c02_w.xml_solic_item_entrega columns
	NR_ITEM_SOLIC_COMPRA			integer			path 'NR_ITEM_SOLIC_COMPRA',
	NR_ITEM_SOLIC_COMPRA_ENTR		integer			path 'NR_ITEM_SOLIC_COMPRA_ENTR',
	QT_ENTREGA_SOLICITADA			double precision			path 'QT_ENTREGA_SOLICITADA',
	DT_ENTREGA_SOLICITADA			timestamp				path 'DT_ENTREGA_SOLICITADA',
	DS_OBSERVACAO				varchar(255)			path 'DS_OBSERVACAO');

c03_w	c03%rowtype;

BEGIN

select	id_origin
into STRICT	ds_id_origin_w
from	xmltable('/STRUCTURE' passing xml_p
	columns id_origin	varchar2(10) path 'ID_ORIGIN');

select	coalesce(b.ie_conversao,'I'),
	nr_seq_sistema,
	nr_seq_projeto_xml,
	nr_seq_regra_conv,
	coalesce(ds_id_origin,ds_id_origin_w)
into STRICT	ie_conversao_w,
	nr_seq_sistema_w,
	nr_seq_projeto_xml_w,
	nr_seq_regra_conv_w,
	ds_id_origin_w
from	intpd_fila_transmissao a,
	intpd_eventos_sistema b
where	a.nr_seq_evento_sistema = b.nr_sequencia
and	a.nr_sequencia = nr_sequencia_p;

ie_sistema_externo_w				:=	nr_seq_sistema_w;

reg_integracao_w.nr_seq_fila_transmissao	:=	nr_sequencia_p;
reg_integracao_w.ie_envio_recebe		:=	'R';
reg_integracao_w.ie_sistema_externo		:=	ie_sistema_externo_w;
reg_integracao_w.ie_conversao			:=	ie_conversao_w;
reg_integracao_w.nr_seq_projeto_xml		:=	nr_seq_projeto_xml_w;
reg_integracao_w.nr_seq_regra_conversao		:=	nr_seq_regra_conv_w;

open c01;
loop
fetch c01 into
	c01_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin
	ie_erro_w := 'N';

	if (c01_w.ie_action = 'DELETE') then
		select	coalesce(max(nr_solic_compra),0)
		into STRICT	nr_solic_compra_delete_w
		from	solic_compra
		where	nr_doc_externo_receb = c01_w.nr_doc_externo_receb;

		if (nr_solic_compra_delete_w > 0) then
			select 	sum(qt)
			into STRICT	qt_registros_w
			from (SELECT	count(*) qt
				from	cot_compra_item
				where	nr_solic_compra = nr_solic_compra_delete_w
				
union all

				SELECT	count(*) qt
				from	cot_compra_solic_agrup
				where	nr_solic_compra = nr_solic_compra_delete_w
				
union all

				select	count(*) qt
				from	ordem_compra_item
				where	nr_solic_compra = nr_solic_compra_delete_w) alias5;

			if (qt_registros_w = 0) then
				delete from solic_compra where nr_solic_compra = nr_solic_compra_delete_w;
			else
				ie_erro_w := 'S';
				intpd_gravar_log_recebimento(nr_sequencia_p, wheb_mensagem_pck.get_Texto(1027477), c01_w.nm_usuario);
			end if;
		end if;
	else
		reg_integracao_w.nm_tabela		:=	'SOLIC_COMPRA';
		reg_integracao_w.nm_elemento		:=	'PURCHASE';
		reg_integracao_w.nr_seq_visao		:=	7303;

		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_SOLICITACAO_COMPRA', c01_w.DT_SOLICITACAO_COMPRA, 'S', solic_compra_w.DT_SOLICITACAO_COMPRA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.DT_SOLICITACAO_COMPRA := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_BAIXA', c01_w.DT_BAIXA, 'S', solic_compra_w.DT_BAIXA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.DT_BAIXA := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_LIBERACAO', c01_w.DT_LIBERACAO, 'S', solic_compra_w.DT_LIBERACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.DT_LIBERACAO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_IMPRESSAO', c01_w.DT_IMPRESSAO, 'S', solic_compra_w.DT_IMPRESSAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.DT_IMPRESSAO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_AUTORIZACAO', c01_w.DT_AUTORIZACAO, 'S', solic_compra_w.DT_AUTORIZACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.DT_AUTORIZACAO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_PRE_APROVACAO', c01_w.DT_PRE_APROVACAO, 'S', solic_compra_w.DT_PRE_APROVACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.DT_PRE_APROVACAO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_PRE_LIBERACAO', c01_w.DT_PRE_LIBERACAO, 'S', solic_compra_w.DT_PRE_LIBERACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.DT_PRE_LIBERACAO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_RECEBIMENTO', c01_w.DT_RECEBIMENTO, 'S', solic_compra_w.DT_RECEBIMENTO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.DT_RECEBIMENTO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_VENCIMENTO', c01_w.DT_VENCIMENTO, 'S', solic_compra_w.DT_VENCIMENTO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.DT_VENCIMENTO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_ESTABELECIMENTO', c01_w.CD_ESTABELECIMENTO, 'S', solic_compra_w.CD_ESTABELECIMENTO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.CD_ESTABELECIMENTO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_PESSOA_SOLICITANTE', c01_w.CD_PESSOA_SOLICITANTE, 'S', solic_compra_w.CD_PESSOA_SOLICITANTE) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.CD_PESSOA_SOLICITANTE := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_LOCAL_ESTOQUE', c01_w.CD_LOCAL_ESTOQUE, 'S', solic_compra_w.CD_LOCAL_ESTOQUE) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.CD_LOCAL_ESTOQUE := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_CENTRO_CUSTO', c01_w.CD_CENTRO_CUSTO, 'S', solic_compra_w.CD_CENTRO_CUSTO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.CD_CENTRO_CUSTO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_CONTA_CONTABIL', c01_w.CD_CONTA_CONTABIL, 'S', solic_compra_w.CD_CONTA_CONTABIL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.CD_CONTA_CONTABIL := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_SETOR_ATENDIMENTO', c01_w.CD_SETOR_ATENDIMENTO, 'S', solic_compra_w.CD_SETOR_ATENDIMENTO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.CD_SETOR_ATENDIMENTO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_OBSERVACAO', c01_w.DS_OBSERVACAO, 'S', solic_compra_w.DS_OBSERVACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.DS_OBSERVACAO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_AVISO_CHEGADA', c01_w.IE_AVISO_CHEGADA, 'S', solic_compra_w.IE_AVISO_CHEGADA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.IE_AVISO_CHEGADA := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_AVISO_APROV_OC', c01_w.IE_AVISO_APROV_OC, 'S', solic_compra_w.IE_AVISO_APROV_OC) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.IE_AVISO_APROV_OC := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_URGENTE', c01_w.IE_URGENTE, 'S', solic_compra_w.IE_URGENTE) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.IE_URGENTE := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_COMPRADOR_RESP', c01_w.CD_COMPRADOR_RESP, 'S', solic_compra_w.CD_COMPRADOR_RESP) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.CD_COMPRADOR_RESP := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_MOTIVO_BAIXA', c01_w.CD_MOTIVO_BAIXA, 'S', solic_compra_w.CD_MOTIVO_BAIXA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.CD_MOTIVO_BAIXA := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_PESSOA_AUTORIZA', c01_w.CD_PESSOA_AUTORIZA, 'S', solic_compra_w.CD_PESSOA_AUTORIZA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.CD_PESSOA_AUTORIZA := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_ORDEM_SERV', c01_w.NR_SEQ_ORDEM_SERV, 'S', solic_compra_w.NR_SEQ_ORDEM_SERV) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_SEQ_ORDEM_SERV := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_MOTIVO_CANCEL', c01_w.NR_SEQ_MOTIVO_CANCEL, 'S', solic_compra_w.NR_SEQ_MOTIVO_CANCEL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_SEQ_MOTIVO_CANCEL := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_FORMA_EXPORTAR', c01_w.IE_FORMA_EXPORTAR, 'S', solic_compra_w.IE_FORMA_EXPORTAR) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.IE_FORMA_EXPORTAR := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_PLANEJAMENTO', c01_w.NR_SEQ_PLANEJAMENTO, 'S', solic_compra_w.NR_SEQ_PLANEJAMENTO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_SEQ_PLANEJAMENTO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_PROJ_GPI', c01_w.NR_SEQ_PROJ_GPI, 'S', solic_compra_w.NR_SEQ_PROJ_GPI) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_SEQ_PROJ_GPI := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_ETAPA_GPI', c01_w.NR_SEQ_ETAPA_GPI, 'S', solic_compra_w.NR_SEQ_ETAPA_GPI) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_SEQ_ETAPA_GPI := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_CONTA_GPI', c01_w.NR_SEQ_CONTA_GPI, 'S', solic_compra_w.NR_SEQ_CONTA_GPI) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_SEQ_CONTA_GPI := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_TIPO_SOLICITACAO', c01_w.IE_TIPO_SOLICITACAO, 'S', solic_compra_w.IE_TIPO_SOLICITACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.IE_TIPO_SOLICITACAO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_RESSUP_FORNEC', c01_w.NR_SEQ_RESSUP_FORNEC, 'S', solic_compra_w.NR_SEQ_RESSUP_FORNEC) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_SEQ_RESSUP_FORNEC := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_COMODATO', c01_w.IE_COMODATO, 'S', solic_compra_w.IE_COMODATO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.IE_COMODATO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_SEMANAL', c01_w.IE_SEMANAL, 'S', solic_compra_w.IE_SEMANAL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.IE_SEMANAL := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_TIPO_COMPRA', c01_w.IE_TIPO_COMPRA, 'S', solic_compra_w.IE_TIPO_COMPRA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.IE_TIPO_COMPRA := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_TIPO_COMPRA', c01_w.NR_SEQ_TIPO_COMPRA, 'S', solic_compra_w.NR_SEQ_TIPO_COMPRA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_SEQ_TIPO_COMPRA := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_MOD_COMPRA', c01_w.NR_SEQ_MOD_COMPRA, 'S', solic_compra_w.NR_SEQ_MOD_COMPRA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_SEQ_MOD_COMPRA := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_FORMA_COMPRA', c01_w.NR_SEQ_FORMA_COMPRA, 'S', solic_compra_w.NR_SEQ_FORMA_COMPRA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_SEQ_FORMA_COMPRA := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_MOTIVO_SOLIC', c01_w.NR_SEQ_MOTIVO_SOLIC, 'S', solic_compra_w.NR_SEQ_MOTIVO_SOLIC) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_SEQ_MOTIVO_SOLIC := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_JUSTIFICATIVA', c01_w.DS_JUSTIFICATIVA, 'S', solic_compra_w.DS_JUSTIFICATIVA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.DS_JUSTIFICATIVA := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SOLIC_COMPRA_ORIGEM_LIC', c01_w.NR_SOLIC_COMPRA_ORIGEM_LIC, 'S', solic_compra_w.NR_SOLIC_COMPRA_ORIGEM_LIC) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_SOLIC_COMPRA_ORIGEM_LIC := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_COT_COMPRA_ORIGEM_LIC', c01_w.NR_COT_COMPRA_ORIGEM_LIC, 'S', solic_compra_w.NR_COT_COMPRA_ORIGEM_LIC) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_COT_COMPRA_ORIGEM_LIC := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_FORNEC_EXCLUSIVO', c01_w.CD_FORNEC_EXCLUSIVO, 'S', solic_compra_w.CD_FORNEC_EXCLUSIVO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.CD_FORNEC_EXCLUSIVO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_FORNEC_SUGERIDO', c01_w.CD_FORNEC_SUGERIDO, 'S', solic_compra_w.CD_FORNEC_SUGERIDO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.CD_FORNEC_SUGERIDO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_MOTIVO_URGENTE', c01_w.NR_SEQ_MOTIVO_URGENTE, 'S', solic_compra_w.NR_SEQ_MOTIVO_URGENTE) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_SEQ_MOTIVO_URGENTE := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NM_USUARIO_PRE_APROV', c01_w.NM_USUARIO_PRE_APROV, 'S', solic_compra_w.NM_USUARIO_PRE_APROV) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NM_USUARIO_PRE_APROV := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_PRESCRICAO', c01_w.NR_PRESCRICAO, 'S', solic_compra_w.NR_PRESCRICAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_PRESCRICAO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_PROT_SOLIC', c01_w.NR_SEQ_PROT_SOLIC, 'S', solic_compra_w.NR_SEQ_PROT_SOLIC) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_SEQ_PROT_SOLIC := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_ORCAMENTO_GPI', c01_w.NR_SEQ_ORCAMENTO_GPI, 'S', solic_compra_w.NR_SEQ_ORCAMENTO_GPI) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_SEQ_ORCAMENTO_GPI := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NM_USUARIO_PRE_LIB', c01_w.NM_USUARIO_PRE_LIB, 'S', solic_compra_w.NM_USUARIO_PRE_LIB) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NM_USUARIO_PRE_LIB := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NM_USUARIO_LIB', c01_w.NM_USUARIO_LIB, 'S', solic_compra_w.NM_USUARIO_LIB) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NM_USUARIO_LIB := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_GRUPO_RESP_COMPRA', c01_w.NR_SEQ_GRUPO_RESP_COMPRA, 'S', solic_compra_w.NR_SEQ_GRUPO_RESP_COMPRA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_SEQ_GRUPO_RESP_COMPRA := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_LOTE_PRODUCAO', c01_w.NR_LOTE_PRODUCAO, 'S', solic_compra_w.NR_LOTE_PRODUCAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_LOTE_PRODUCAO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_TIPO_SERVICO', c01_w.IE_TIPO_SERVICO, 'S', solic_compra_w.IE_TIPO_SERVICO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.IE_TIPO_SERVICO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_STATUS_ENVIO', c01_w.IE_STATUS_ENVIO, 'S', solic_compra_w.IE_STATUS_ENVIO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.IE_STATUS_ENVIO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NM_USUARIO_VER_PRE_LIB', c01_w.NM_USUARIO_VER_PRE_LIB, 'S', solic_compra_w.NM_USUARIO_VER_PRE_LIB) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NM_USUARIO_VER_PRE_LIB := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_PERFIL', c01_w.CD_PERFIL, 'S', solic_compra_w.CD_PERFIL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.CD_PERFIL := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_PESSOA_FISICA', c01_w.CD_PESSOA_FISICA, 'S', solic_compra_w.CD_PESSOA_FISICA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.CD_PESSOA_FISICA := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NM_USUARIO_RECEB', c01_w.NM_USUARIO_RECEB, 'S', solic_compra_w.NM_USUARIO_RECEB) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NM_USUARIO_RECEB := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_SETOR_ENTREGA', c01_w.CD_SETOR_ENTREGA, 'S', solic_compra_w.CD_SETOR_ENTREGA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.CD_SETOR_ENTREGA := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_BANCO', c01_w.CD_BANCO, 'S', solic_compra_w.CD_BANCO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.CD_BANCO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_AGENCIA_BANCARIA', c01_w.CD_AGENCIA_BANCARIA, 'S', solic_compra_w.CD_AGENCIA_BANCARIA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.CD_AGENCIA_BANCARIA := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_CONTA', c01_w.NR_CONTA, 'S', solic_compra_w.NR_CONTA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_CONTA := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_DIGITO_CONTA', c01_w.NR_DIGITO_CONTA, 'S', solic_compra_w.NR_DIGITO_CONTA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_DIGITO_CONTA := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_NOTA_FISCAL', c01_w.NR_NOTA_FISCAL, 'S', solic_compra_w.NR_NOTA_FISCAL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_NOTA_FISCAL := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_ORCADO', c01_w.IE_ORCADO, 'S', solic_compra_w.IE_ORCADO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.IE_ORCADO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NM_USUARIO', c01_w.NM_USUARIO, 'S', solic_compra_w.NM_USUARIO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NM_USUARIO := _ora2pg_r.ds_valor_retorno_p;
		SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_DOC_EXTERNO_RECEB', c01_w.NR_DOC_EXTERNO_RECEB, 'S', solic_compra_w.NR_DOC_EXTERNO_RECEB) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_w.NR_DOC_EXTERNO_RECEB := _ora2pg_r.ds_valor_retorno_p;
		solic_compra_w.dt_atualizacao := clock_timestamp();
		solic_compra_w.dt_atualizacao_nrec := clock_timestamp();
		solic_compra_w.nm_usuario_nrec := solic_compra_w.nm_usuario;

		if (reg_integracao_w.qt_reg_log = 0) then
			select	coalesce(max(nr_solic_compra),0)
			into STRICT	solic_compra_w.nr_solic_compra
			from	solic_compra
			where	nr_doc_externo_receb = solic_compra_w.nr_doc_externo_receb;

			if (solic_compra_w.nr_solic_compra > 0) then
				update	solic_compra
				set	row = solic_compra_w
				where	nr_solic_compra = solic_compra_w.nr_solic_compra;
			else
				select	nextval('solic_compra_seq')
				into STRICT	solic_compra_w.nr_solic_compra
				;

				insert into solic_compra values (solic_compra_w.*);
			end if;
		end if;

		open c02;
		loop
		fetch c02 into
			c02_w;
		EXIT WHEN NOT FOUND; /* apply on c02 */
			begin
			reg_integracao_w.nm_tabela		:=	'SOLIC_COMPRA_ITEM';
			reg_integracao_w.nm_elemento		:=	'ITEM';
			reg_integracao_w.nr_seq_visao		:=	16015;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_ITEM_SOLIC_COMPRA', c02_w.NR_ITEM_SOLIC_COMPRA, 'S', solic_compra_item_w.NR_ITEM_SOLIC_COMPRA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_ITEM_SOLIC_COMPRA := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_MATERIAL', c02_w.CD_MATERIAL, 'S', solic_compra_item_w.CD_MATERIAL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.CD_MATERIAL := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_UNIDADE_MEDIDA_COMPRA', c02_w.CD_UNIDADE_MEDIDA_COMPRA, 'S', solic_compra_item_w.CD_UNIDADE_MEDIDA_COMPRA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.CD_UNIDADE_MEDIDA_COMPRA := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'QT_MATERIAL', c02_w.QT_MATERIAL, 'S', solic_compra_item_w.QT_MATERIAL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.QT_MATERIAL := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_SITUACAO', c02_w.IE_SITUACAO, 'S', solic_compra_item_w.IE_SITUACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.IE_SITUACAO := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_MATERIAL_DIRETO', c02_w.DS_MATERIAL_DIRETO, 'S', solic_compra_item_w.DS_MATERIAL_DIRETO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.DS_MATERIAL_DIRETO := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_OBSERVACAO', c02_w.DS_OBSERVACAO, 'S', solic_compra_item_w.DS_OBSERVACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.DS_OBSERVACAO := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_COT_COMPRA', c02_w.NR_COT_COMPRA, 'S', solic_compra_item_w.NR_COT_COMPRA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_COT_COMPRA := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_ITEM_COT_COMPRA', c02_w.NR_ITEM_COT_COMPRA, 'S', solic_compra_item_w.NR_ITEM_COT_COMPRA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_ITEM_COT_COMPRA := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_MOTIVO_BAIXA', c02_w.CD_MOTIVO_BAIXA, 'S', solic_compra_item_w.CD_MOTIVO_BAIXA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.CD_MOTIVO_BAIXA := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_BAIXA', c02_w.DT_BAIXA, 'S', solic_compra_item_w.DT_BAIXA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.DT_BAIXA := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_SOLIC_ITEM', c02_w.DT_SOLIC_ITEM, 'S', solic_compra_item_w.DT_SOLIC_ITEM) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.DT_SOLIC_ITEM := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_APROVACAO', c02_w.NR_SEQ_APROVACAO, 'S', solic_compra_item_w.NR_SEQ_APROVACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_SEQ_APROVACAO := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_AUTORIZACAO', c02_w.DT_AUTORIZACAO, 'S', solic_compra_item_w.DT_AUTORIZACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.DT_AUTORIZACAO := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'VL_UNIT_PREVISTO', c02_w.VL_UNIT_PREVISTO, 'S', solic_compra_item_w.VL_UNIT_PREVISTO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.VL_UNIT_PREVISTO := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_GERACAO', c02_w.IE_GERACAO, 'S', solic_compra_item_w.IE_GERACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.IE_GERACAO := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_PROJ_REC', c02_w.NR_SEQ_PROJ_REC, 'S', solic_compra_item_w.NR_SEQ_PROJ_REC) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_SEQ_PROJ_REC := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_REPROVACAO', c02_w.DT_REPROVACAO, 'S', solic_compra_item_w.DT_REPROVACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.DT_REPROVACAO := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_MOTIVO_CANCEL', c02_w.NR_SEQ_MOTIVO_CANCEL, 'S', solic_compra_item_w.NR_SEQ_MOTIVO_CANCEL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_SEQ_MOTIVO_CANCEL := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_FORMA_EXPORTAR', c02_w.IE_FORMA_EXPORTAR, 'S', solic_compra_item_w.IE_FORMA_EXPORTAR) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.IE_FORMA_EXPORTAR := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SOLIC_COMPRA_REF', c02_w.NR_SOLIC_COMPRA_REF, 'S', solic_compra_item_w.NR_SOLIC_COMPRA_REF) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_SOLIC_COMPRA_REF := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_ITEM_SOLIC_COMPRA_REF', c02_w.NR_ITEM_SOLIC_COMPRA_REF, 'S', solic_compra_item_w.NR_ITEM_SOLIC_COMPRA_REF) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_ITEM_SOLIC_COMPRA_REF := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_CONTA_CONTABIL', c02_w.CD_CONTA_CONTABIL, 'S', solic_compra_item_w.CD_CONTA_CONTABIL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.CD_CONTA_CONTABIL := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_OBSERVACAO_INT', c02_w.DS_OBSERVACAO_INT, 'S', solic_compra_item_w.DS_OBSERVACAO_INT) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.DS_OBSERVACAO_INT := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_CONTRATO', c02_w.NR_CONTRATO, 'S', solic_compra_item_w.NR_CONTRATO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_CONTRATO := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_BULA', c02_w.IE_BULA, 'S', solic_compra_item_w.IE_BULA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.IE_BULA := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_AMOSTRA', c02_w.IE_AMOSTRA, 'S', solic_compra_item_w.IE_AMOSTRA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.IE_AMOSTRA := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_CATALOGO', c02_w.IE_CATALOGO, 'S', solic_compra_item_w.IE_CATALOGO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.IE_CATALOGO := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_ORC_ITEM_GPI', c02_w.NR_SEQ_ORC_ITEM_GPI, 'S', solic_compra_item_w.NR_SEQ_ORC_ITEM_GPI) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_SEQ_ORC_ITEM_GPI := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'QT_CONV_COMPRA_EST_ORIG', c02_w.QT_CONV_COMPRA_EST_ORIG, 'S', solic_compra_item_w.QT_CONV_COMPRA_EST_ORIG) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.QT_CONV_COMPRA_EST_ORIG := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_MARCA', c02_w.NR_SEQ_MARCA, 'S', solic_compra_item_w.NR_SEQ_MARCA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_SEQ_MARCA := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_REGRA_CONTRATO', c02_w.NR_SEQ_REGRA_CONTRATO, 'S', solic_compra_item_w.NR_SEQ_REGRA_CONTRATO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_SEQ_REGRA_CONTRATO := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'QT_SALDO_DISP_ESTOQUE', c02_w.QT_SALDO_DISP_ESTOQUE, 'S', solic_compra_item_w.QT_SALDO_DISP_ESTOQUE) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.QT_SALDO_DISP_ESTOQUE := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'QT_CONSUMO_MENSAL', c02_w.QT_CONSUMO_MENSAL, 'S', solic_compra_item_w.QT_CONSUMO_MENSAL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.QT_CONSUMO_MENSAL := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_DESDOBR_APROV', c02_w.DT_DESDOBR_APROV, 'S', solic_compra_item_w.DT_DESDOBR_APROV) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.DT_DESDOBR_APROV := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_LOTE_FORNEC', c02_w.NR_SEQ_LOTE_FORNEC, 'S', solic_compra_item_w.NR_SEQ_LOTE_FORNEC) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_SEQ_LOTE_FORNEC := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_LICITACAO', c02_w.NR_SEQ_LICITACAO, 'S', solic_compra_item_w.NR_SEQ_LICITACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_SEQ_LICITACAO := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_LIC_ITEM', c02_w.NR_SEQ_LIC_ITEM, 'S', solic_compra_item_w.NR_SEQ_LIC_ITEM) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_SEQ_LIC_ITEM := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_MOTIVO_REPROVACAO', c02_w.IE_MOTIVO_REPROVACAO, 'S', solic_compra_item_w.IE_MOTIVO_REPROVACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.IE_MOTIVO_REPROVACAO := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_JUSTIFICATIVA_REPROV', c02_w.DS_JUSTIFICATIVA_REPROV, 'S', solic_compra_item_w.DS_JUSTIFICATIVA_REPROV) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.DS_JUSTIFICATIVA_REPROV := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_REQUISICAO', c02_w.NR_REQUISICAO, 'S', solic_compra_item_w.NR_REQUISICAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_REQUISICAO := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_ITEM_REQUISICAO', c02_w.NR_SEQ_ITEM_REQUISICAO, 'S', solic_compra_item_w.NR_SEQ_ITEM_REQUISICAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_SEQ_ITEM_REQUISICAO := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'VL_CUSTO_TOTAL', c02_w.VL_CUSTO_TOTAL, 'S', solic_compra_item_w.VL_CUSTO_TOTAL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.VL_CUSTO_TOTAL := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'VL_ESTOQUE_TOTAL', c02_w.VL_ESTOQUE_TOTAL, 'S', solic_compra_item_w.VL_ESTOQUE_TOTAL) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.VL_ESTOQUE_TOTAL := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_ORDEM_COMPRA_ORIG', c02_w.NR_ORDEM_COMPRA_ORIG, 'S', solic_compra_item_w.NR_ORDEM_COMPRA_ORIG) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_ORDEM_COMPRA_ORIG := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_PERFIL_APROV', c02_w.CD_PERFIL_APROV, 'S', solic_compra_item_w.CD_PERFIL_APROV) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.CD_PERFIL_APROV := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_CRITERIO_RATEIO', c02_w.NR_SEQ_CRITERIO_RATEIO, 'S', solic_compra_item_w.NR_SEQ_CRITERIO_RATEIO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_SEQ_CRITERIO_RATEIO := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_JUSTIF_DIVER', c02_w.DS_JUSTIF_DIVER, 'S', solic_compra_item_w.DS_JUSTIF_DIVER) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.DS_JUSTIF_DIVER := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'QT_DIAS_ESTOQUE', c02_w.QT_DIAS_ESTOQUE, 'S', solic_compra_item_w.QT_DIAS_ESTOQUE) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.QT_DIAS_ESTOQUE := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'CD_CNPJ', c02_w.CD_CNPJ, 'S', solic_compra_item_w.CD_CNPJ) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.CD_CNPJ := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_CANCELAMENTO_INTEGR', c02_w.IE_CANCELAMENTO_INTEGR, 'S', solic_compra_item_w.IE_CANCELAMENTO_INTEGR) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.IE_CANCELAMENTO_INTEGR := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_NORMA_COMPRA', c02_w.NR_SEQ_NORMA_COMPRA, 'S', solic_compra_item_w.NR_SEQ_NORMA_COMPRA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_SEQ_NORMA_COMPRA := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_PROC_APROV', c02_w.NR_SEQ_PROC_APROV, 'S', solic_compra_item_w.NR_SEQ_PROC_APROV) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_SEQ_PROC_APROV := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'IE_SERVICO_REALIZADO', c02_w.IE_SERVICO_REALIZADO, 'S', solic_compra_item_w.IE_SERVICO_REALIZADO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.IE_SERVICO_REALIZADO := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_MARCAS_ACEITAVEIS', c02_w.DS_MARCAS_ACEITAVEIS, 'S', solic_compra_item_w.DS_MARCAS_ACEITAVEIS) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.DS_MARCAS_ACEITAVEIS := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'VL_ORCADO_GPI', c02_w.VL_ORCADO_GPI, 'S', solic_compra_item_w.VL_ORCADO_GPI) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.VL_ORCADO_GPI := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_SOLIC_ITEM_ANT', c02_w.DT_SOLIC_ITEM_ANT, 'S', solic_compra_item_w.DT_SOLIC_ITEM_ANT) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.DT_SOLIC_ITEM_ANT := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_JUSTIF', c02_w.NR_SEQ_JUSTIF, 'S', solic_compra_item_w.NR_SEQ_JUSTIF) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_SEQ_JUSTIF := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_ORDEM_SERV', c02_w.NR_SEQ_ORDEM_SERV, 'S', solic_compra_item_w.NR_SEQ_ORDEM_SERV) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_SEQ_ORDEM_SERV := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_CONTA_FINANC', c02_w.NR_SEQ_CONTA_FINANC, 'S', solic_compra_item_w.NR_SEQ_CONTA_FINANC) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_SEQ_CONTA_FINANC := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'QT_AMOSTRA', c02_w.QT_AMOSTRA, 'S', solic_compra_item_w.QT_AMOSTRA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.QT_AMOSTRA := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_REG_PCS', c02_w.NR_SEQ_REG_PCS, 'S', solic_compra_item_w.NR_SEQ_REG_PCS) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_SEQ_REG_PCS := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_REG_COMPRA', c02_w.NR_SEQ_REG_COMPRA, 'S', solic_compra_item_w.NR_SEQ_REG_COMPRA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_SEQ_REG_COMPRA := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_SEQ_OP_COMP_OPM', c02_w.NR_SEQ_OP_COMP_OPM, 'S', solic_compra_item_w.NR_SEQ_OP_COMP_OPM) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_SEQ_OP_COMP_OPM := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_ITEM_OCI_ORIG', c02_w.NR_ITEM_OCI_ORIG, 'S', solic_compra_item_w.NR_ITEM_OCI_ORIG) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.NR_ITEM_OCI_ORIG := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'QT_SALDO_REG_PRECO', c02_w.QT_SALDO_REG_PRECO, 'S', solic_compra_item_w.QT_SALDO_REG_PRECO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.QT_SALDO_REG_PRECO := _ora2pg_r.ds_valor_retorno_p;
			SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'QT_MATERIAL_CANCELADO', c02_w.QT_MATERIAL_CANCELADO, 'S', solic_compra_item_w.QT_MATERIAL_CANCELADO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_w.QT_MATERIAL_CANCELADO := _ora2pg_r.ds_valor_retorno_p;
			solic_compra_item_w.nr_solic_compra := solic_compra_w.nr_solic_compra;
			solic_compra_item_w.dt_atualizacao := clock_timestamp();
			solic_compra_item_w.nm_usuario := solic_compra_w.nm_usuario;

			if (reg_integracao_w.qt_reg_log = 0) then
				select	coalesce(max(nr_item_solic_compra),0)
				into STRICT	nr_item_solic_compra_w
				from	solic_compra_item
				where	nr_solic_compra = solic_compra_item_w.nr_solic_compra
				and	nr_item_solic_compra = solic_compra_item_w.nr_item_solic_compra;

				if (nr_item_solic_compra_w > 0) then
					update	solic_compra_item
					set	row = solic_compra_item_w
					where	nr_solic_compra = solic_compra_item_w.nr_solic_compra
					and	nr_item_solic_compra = nr_item_solic_compra_w;
				else
					insert into solic_compra_item values (solic_compra_item_w.*);
				end if;
			end if;

			open c03;
			loop
			fetch c03 into
				c03_w;
			EXIT WHEN NOT FOUND; /* apply on c03 */
				begin
				reg_integracao_w.nm_tabela		:=	'SOLIC_COMPRA_ITEM_ENTREGA';
				reg_integracao_w.nm_elemento		:=	'ENTREGA';
				reg_integracao_w.nr_seq_visao		:=	15848;
				SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_ITEM_SOLIC_COMPRA', c03_w.NR_ITEM_SOLIC_COMPRA, 'S', solic_compra_item_entrega_w.NR_ITEM_SOLIC_COMPRA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_entrega_w.NR_ITEM_SOLIC_COMPRA := _ora2pg_r.ds_valor_retorno_p;
				SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'NR_ITEM_SOLIC_COMPRA_ENTR', c03_w.NR_ITEM_SOLIC_COMPRA_ENTR, 'S', solic_compra_item_entrega_w.NR_ITEM_SOLIC_COMPRA_ENTR) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_entrega_w.NR_ITEM_SOLIC_COMPRA_ENTR := _ora2pg_r.ds_valor_retorno_p;
				SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'QT_ENTREGA_SOLICITADA', c03_w.QT_ENTREGA_SOLICITADA, 'S', solic_compra_item_entrega_w.QT_ENTREGA_SOLICITADA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_entrega_w.QT_ENTREGA_SOLICITADA := _ora2pg_r.ds_valor_retorno_p;
				SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DT_ENTREGA_SOLICITADA', c03_w.DT_ENTREGA_SOLICITADA, 'S', solic_compra_item_entrega_w.DT_ENTREGA_SOLICITADA) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_entrega_w.DT_ENTREGA_SOLICITADA := _ora2pg_r.ds_valor_retorno_p;
				SELECT * FROM intpd_processar_atributo(reg_integracao_w, 'DS_OBSERVACAO', c03_w.DS_OBSERVACAO, 'S', solic_compra_item_entrega_w.DS_OBSERVACAO) INTO STRICT _ora2pg_r;
 reg_integracao_w := _ora2pg_r.reg_integracao_p; solic_compra_item_entrega_w.DS_OBSERVACAO := _ora2pg_r.ds_valor_retorno_p;
				solic_compra_item_entrega_w.nr_solic_compra := solic_compra_w.nr_solic_compra;
				solic_compra_item_entrega_w.dt_atualizacao := clock_timestamp();
				solic_compra_item_entrega_w.nm_usuario := solic_compra_w.nm_usuario;
				solic_compra_item_entrega_w.dt_atualizacao_nrec := solic_compra_item_entrega_w.dt_atualizacao;
				solic_compra_item_entrega_w.nm_usuario_nrec := solic_compra_w.nm_usuario;

				if (reg_integracao_w.qt_reg_log = 0) then
					select	coalesce(max(nr_item_solic_compra_entr),0)
					into STRICT	nr_item_solic_compra_entr_w
					from	solic_compra_item_entrega
					where	nr_solic_compra = solic_compra_item_w.nr_solic_compra
					and	nr_item_solic_compra = solic_compra_item_w.nr_item_solic_compra
					and	nr_item_solic_compra_entr = solic_compra_item_entrega_w.nr_item_solic_compra_entr;

					if (nr_item_solic_compra_entr_w > 0) then
						update	solic_compra_item_entrega
						set	row = solic_compra_item_entrega_w
						where	nr_solic_compra = solic_compra_item_w.nr_solic_compra
						and	nr_item_solic_compra = solic_compra_item_w.nr_item_solic_compra
						and	nr_item_solic_compra_entr = solic_compra_item_entrega_w.nr_item_solic_compra_entr;
					else
						insert into solic_compra_item_entrega values (solic_compra_item_entrega_w.*);
					end if;
				end if;
				end;
			end loop;
			close c03;
			end;
		end loop;
		close c02;
	end if;
	end;
end loop;
close C01;

if	((reg_integracao_w.qt_reg_log > 0) or (ie_erro_w = 'S')) then
	begin
	rollback;

	update 	intpd_fila_transmissao
	set	ie_status = 'E',
		ie_tipo_erro = 'F'
	where	nr_sequencia = nr_sequencia_p;

	for i in 0..reg_integracao_w.qt_reg_log-1 loop
		INTPD_GRAVAR_LOG_RECEBIMENTO(nr_sequencia_p,reg_integracao_w.intpd_log_receb[i].ds_log,'INTPDTASY');
	end loop;
	end;
else
	update	intpd_fila_transmissao
	set	ie_status = 'S',
		nr_seq_documento = coalesce(nr_solic_compra_delete_w, solic_compra_w.nr_solic_compra),
		nr_doc_externo = c01_w.nr_doc_externo_receb
	where	nr_sequencia = nr_sequencia_p;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE intpd_recebe_solic_compra ( nr_sequencia_p bigint, xml_p xml) FROM PUBLIC;

