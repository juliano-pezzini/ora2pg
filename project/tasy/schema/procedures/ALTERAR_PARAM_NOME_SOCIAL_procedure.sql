-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE alterar_param_nome_social (cd_estabelecimento_p bigint, ie_nome_social_p text, nm_usuario_p text) AS $body$
BEGIN
IF (ie_nome_social_p IS NOT NULL AND ie_nome_social_p::text <> '') AND (cd_estabelecimento_p IS NOT NULL AND cd_estabelecimento_p::text <> '') AND (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') THEN
  BEGIN
       IF (ie_nome_social_p in ('S', 'T')) THEN

			UPDATE estabelecimento SET ie_nome_social = ie_nome_social_p, nm_usuario = nm_usuario_p
			WHERE cd_estabelecimento = cd_estabelecimento_p;

			UPDATE	pessoa_fisica
			SET		nm_pessoa_fisica_sem_acento = SUBSTR(elimina_acentuacao(nm_social),1,60), nm_usuario = nm_usuario_p
			WHERE	(nm_social IS NOT NULL AND nm_social::text <> '')
			AND		cd_estabelecimento = cd_estabelecimento_p;
       ELSIF (ie_nome_social_p IN ('N')) THEN

			UPDATE estabelecimento SET ie_nome_social = ie_nome_social_p, nm_usuario = nm_usuario_p
			WHERE cd_estabelecimento = cd_estabelecimento_p;

			UPDATE	pessoa_fisica
			SET		nm_pessoa_fisica_sem_acento = SUBSTR(elimina_acentuacao(nm_pessoa_fisica),1,60), nm_usuario = nm_usuario_p
			WHERE	(nm_social IS NOT NULL AND nm_social::text <> '')
			AND		cd_estabelecimento = cd_estabelecimento_p;
      END IF;
	  COMMIT;
  END;
END IF;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE alterar_param_nome_social (cd_estabelecimento_p bigint, ie_nome_social_p text, nm_usuario_p text) FROM PUBLIC;

