-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE checkup_before_post ( DT_PREVISTO_P timestamp, CD_PESSOA_FISICA_P text ) AS $body$
DECLARE

  CD_PESSOA_FISICA_W PESSOA_FISICA.CD_PESSOA_FISICA%TYPE;
  NR_PRONTUARIO_W PESSOA_FISICA.NR_PRONTUARIO%TYPE;
  NM_PESSOA_W varchar(255);
  IE_SEXO_W PESSOA_FISICA.IE_SEXO%TYPE;
  DT_NASCIMENTO_W PESSOA_FISICA.DT_NASCIMENTO%TYPE;
  NR_CPF_W PESSOA_FISICA.NR_CPF%TYPE;
  DS_EMAIL_W COMPL_PESSOA_FISICA.DS_EMAIL%TYPE;

BEGIN
  IF coalesce(DT_PREVISTO_P::text, '') = '' THEN
    CALL wheb_mensagem_pck.exibir_mensagem_abort(1207525, 'DS_CAMPO_P=DT_PREVISTO');
  ELSIF coalesce(CD_PESSOA_FISICA_P::text, '') = '' THEN
    CALL wheb_mensagem_pck.exibir_mensagem_abort(1207525, 'DS_CAMPO_P=CD_PESSOA_FISICA');
  ELSE
    SELECT CD_PESSOA_FISICA INTO STRICT CD_PESSOA_FISICA_W FROM PESSOA_FISICA WHERE CD_PESSOA_FISICA = CD_PESSOA_FISICA_P;

    IF coalesce(CD_PESSOA_FISICA_W::text, '') = '' THEN
      CALL wheb_mensagem_pck.exibir_mensagem_abort(1207525, 'DS_CAMPO_P=CD_PESSOA_FISICA');
    ELSE
      SELECT
        pf0.NR_PRONTUARIO,
        OBTER_NOME_PF(pf0.CD_PESSOA_FISICA),
        pf0.IE_SEXO,
        pf0.DT_NASCIMENTO,
        pf0.NR_CPF,
        cpf0.DS_EMAIL
      INTO STRICT
        NR_PRONTUARIO_W,
        NM_PESSOA_W,
        IE_SEXO_W,
        DT_NASCIMENTO_W,
        NR_CPF_W,
        DS_EMAIL_W
      FROM PESSOA_FISICA pf0
      LEFT JOIN COMPL_PESSOA_FISICA cpf0 ON (
        cpf0.CD_PESSOA_FISICA = pf0.CD_PESSOA_FISICA
      )
      WHERE
        pf0.CD_PESSOA_FISICA = CD_PESSOA_FISICA_W
        AND cpf0.ie_tipo_complemento = 1;

      IF coalesce(NR_PRONTUARIO_W::text, '') = '' THEN
        CALL wheb_mensagem_pck.exibir_mensagem_abort(1207525, 'DS_CAMPO_P=NR_PRONTUARIO');
      ELSIF coalesce(NM_PESSOA_W::text, '') = '' THEN
        CALL wheb_mensagem_pck.exibir_mensagem_abort(1207525, 'DS_CAMPO_P=NM_PESSOA');
      ELSIF coalesce(IE_SEXO_W::text, '') = '' THEN
        CALL wheb_mensagem_pck.exibir_mensagem_abort(1207525, 'DS_CAMPO_P=IE_SEXO');
      ELSIF coalesce(DT_NASCIMENTO_W::text, '') = '' THEN
        CALL wheb_mensagem_pck.exibir_mensagem_abort(1207525, 'DS_CAMPO_P=DT_NASCIMENTO');
      ELSIF coalesce(NR_CPF_W::text, '') = '' THEN
        CALL wheb_mensagem_pck.exibir_mensagem_abort(1207525, 'DS_CAMPO_P=NR_CPF');
      ELSIF coalesce(DS_EMAIL_W::text, '') = '' THEN
        CALL wheb_mensagem_pck.exibir_mensagem_abort(1207525, 'DS_CAMPO_P=DS_EMAIL');
      END IF;
    END IF;
  END IF;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE checkup_before_post ( DT_PREVISTO_P timestamp, CD_PESSOA_FISICA_P text ) FROM PUBLIC;

