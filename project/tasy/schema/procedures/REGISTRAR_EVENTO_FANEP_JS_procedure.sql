-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE registrar_evento_fanep_js ( cd_pessoa_fisica_p bigint, nr_sequencia_p bigint, nr_atendimento_p bigint, nr_seq_pepo_p bigint, ie_verifica_p INOUT text, nr_registros_p INOUT bigint, ds_texto_msg_p INOUT text ) AS $body$
DECLARE

 
ie_verifica_w 	varchar(1);
nr_registros_w 	integer;			
ds_texto_msg_w	varchar(4000);

BEGIN
 
	if (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') then 
		begin 
 
			select	coalesce(max(ie_alerta_avaliacao),'N') 
			into STRICT 	  ie_verifica_w 
			from 	  evento_cirurgia 
			where	  nr_sequencia = nr_sequencia_p 
			and	  obter_se_medico( cd_pessoa_fisica_p,'M') = 'S';			
		 
			select	count(*) 
			into STRICT	  nr_registros_w 
			from 	  med_avaliacao_paciente 
			where 	((nr_atendimento = nr_atendimento_p) or (nr_seq_pepo = nr_seq_pepo_p)) 
			and	coalesce(dt_inativacao::text, '') = '';
			 
			ds_texto_msg_w 	:= 	obter_texto_tasy(446556, 1);
			 
			ie_verifica_p 	:= 	ie_verifica_w;
			nr_registros_p 	:= 	nr_registros_w;
			ds_texto_msg_p	:=	ds_texto_msg_w;
			 
		end;
	end if;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE registrar_evento_fanep_js ( cd_pessoa_fisica_p bigint, nr_sequencia_p bigint, nr_atendimento_p bigint, nr_seq_pepo_p bigint, ie_verifica_p INOUT text, nr_registros_p INOUT bigint, ds_texto_msg_p INOUT text ) FROM PUBLIC;

