-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE html5_grava_log_tasy ( cd_log_p bigint, ds_log_p text, nm_usuario_p text ) AS $body$
DECLARE

    dt_fim_geracao_w   timestamp;
    ds_log_w           tipo_log_tasy.ds_tipo%TYPE;

BEGIN
    BEGIN
        SELECT
            coalesce(dt_fim_geracao,clock_timestamp()),
            coalesce(ds_log_p, ds_tipo)
        INTO STRICT
            dt_fim_geracao_w,ds_log_w
        FROM
            tipo_log_tasy
        WHERE
            cd_log = cd_log_p;

    EXCEPTION
        WHEN no_data_found THEN
            dt_fim_geracao_w := clock_timestamp();
    END;

    IF
        pkg_date_utils.start_of(dt_fim_geracao_w,'DD',0) >= pkg_date_utils.start_of(clock_timestamp(),'DD',0)
    THEN

        INSERT INTO log_tasy(
            dt_atualizacao,
            nm_usuario,
            cd_log,
            ds_log
        ) VALUES (
            clock_timestamp(),
            nm_usuario_p,
            cd_log_p,
            substr(ds_log_w,1,2000)
        );

    END IF;
    commit;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE html5_grava_log_tasy ( cd_log_p bigint, ds_log_p text, nm_usuario_p text ) FROM PUBLIC;

