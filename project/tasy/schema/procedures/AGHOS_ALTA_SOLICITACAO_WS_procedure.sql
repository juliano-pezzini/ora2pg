-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE aghos_alta_solicitacao_ws ( nr_atendimento_p bigint, nm_usuario_p text, idf_internacao_p INOUT bigint, cd_motivo_alta_sus_p INOUT text, cd_cpf_medico_alta_p INOUT text, cd_cid_alta_p INOUT text, ds_usuario_p INOUT text) AS $body$
DECLARE

 
ds_motivo_cancelamento_w	varchar(1000);
cd_cnes_solicitante_w		varchar(1000);
ds_sep_bv_w			varchar(50);
ds_comando_w			varchar(2000);
cd_motivo_alta_w		smallint;
cd_motivo_alta_sus_w		smallint;
cd_cpf_medico_alta_w		bigint;
cd_cid_alta_w			varchar(4);
ds_motivo_alta_w		varchar(80);
nr_internacao_w			bigint;
ds_usuario_w			varchar(15);


BEGIN 
 
/* 
IDF_GSH_I_INTERN_ALTA_(ENT/SAI) NUMBER 	not null 
TIP_STATUS 			VARCHAR2 1 	not null 
DES_ERRO 			VARCHAR2 500 	null 
DAT_INTEGRACAO 		DATE 		not null 
DES_USUARIO 			VARCHAR2 15 	not null 
COD_CNES_SOLICITANTE 		NUMBER 7 	not null 
IDF_INTERNACAO 		NUMBER 9 	not null 
COD_SUS_MOTIVO_ALTA		VARCHAR2 2 	not null 
NUM_CPF_MEDICO_ALTA 		NUMBER 11 	not null 
COD_CID_ALTA 			VARCHAR2 4 	not null 
*/
 
 
select	max(substr(obter_cnes_estab(a.cd_estabelecimento), 1, 7)), 
	max(a.cd_motivo_alta), 
	max(substr(obter_cpf_pessoa_fisica(cd_medico_resp), 1, 11)), 
	max(substr(Obter_cid_princ_atendimento(a.nr_atendimento), 1, 4)), 
	max(nr_internacao), 
	coalesce(max(substr(obter_dados_param_atend(a.cd_estabelecimento, 'US'), 1, 15)), 'TREINA') 
into STRICT	cd_cnes_solicitante_w, 
	cd_motivo_alta_w, 
	cd_cpf_medico_alta_w, 
	cd_cid_alta_w, 
	nr_internacao_w, 
	ds_usuario_w 
from	atendimento_paciente a, 
	solicitacao_tasy_aghos b 
where	a.nr_atendimento = b.nr_atendimento 
and	b.nr_atendimento = nr_atendimento_p 
and	a.ie_tipo_atendimento = 1;
 
select	max(cd_motivo_alta_sus), 
	max(ds_motivo_alta) 
into STRICT	cd_motivo_alta_sus_w, 
	ds_motivo_alta_w 
from	motivo_alta 
where	cd_motivo_alta = coalesce(cd_motivo_alta_w, 0);
 
ds_sep_bv_w := obter_separador_bv;
 
If (cd_cnes_solicitante_w IS NOT NULL AND cd_cnes_solicitante_w::text <> '') then 
	 
		idf_internacao_p	:= nr_internacao_w;	
		cd_motivo_alta_sus_p	:= cd_motivo_alta_sus_w;
		cd_cpf_medico_alta_p	:= cd_cpf_medico_alta_w;
		cd_cid_alta_p			:= cd_cid_alta_w;
		ds_usuario_p			:= ds_usuario_w;
		 
End if;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE aghos_alta_solicitacao_ws ( nr_atendimento_p bigint, nm_usuario_p text, idf_internacao_p INOUT bigint, cd_motivo_alta_sus_p INOUT text, cd_cpf_medico_alta_p INOUT text, cd_cid_alta_p INOUT text, ds_usuario_p INOUT text) FROM PUBLIC;

