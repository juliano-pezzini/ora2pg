-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE sup_int_mat_espec_tec_atual (nm_usuario_p text, nr_sequencia_p text) AS $body$
DECLARE


cd_material_w			material_espec_tecnica.cd_material%type;
ds_espec_tecnica_w		material_espec_tecnica.ds_espec_tecnica%type;
qt_registro_w			smallint;
ds_out_w varchar(50);


BEGIN

select	count(1)
into STRICT	qt_registro_w
from	sup_int_material_espec_tec
where	nr_seq_especificacao = nr_sequencia_p;

select	cd_material
into STRICT	cd_material_w
from	material_espec_tecnica
where	nr_sequencia = nr_sequencia_p;

ds_out_w := converte_rtf_string('select ds_espec_tecnica from material_espec_tecnica where nr_sequencia = :nr', nr_sequencia_p, nm_usuario_p, ds_out_w);

if (ds_out_w IS NOT NULL AND ds_out_w::text <> '') then

	select	ds_texto
	into STRICT	ds_espec_tecnica_w
	from	tasy_conversao_rtf
	where	nr_sequencia = (ds_out_w)::numeric;

	if (coalesce(qt_registro_w, 0) > 0) then

		update	sup_int_material_espec_tec
		set	ds_espec_tecnica = ds_espec_tecnica_w,
			dt_atualizacao = clock_timestamp()
		where	nr_seq_especificacao = nr_sequencia_p;

	elsif (coalesce(qt_registro_w, 0) = 0) then
		insert into sup_int_material_espec_tec(
			cd_material,
			ds_espec_tecnica,
			dt_atualizacao,
			nm_usuario,
			nr_seq_especificacao)
		values (cd_material_w,
			ds_espec_tecnica_w,
			clock_timestamp(),
			nm_usuario_p,
			nr_sequencia_p);

	end if;
end if;
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE sup_int_mat_espec_tec_atual (nm_usuario_p text, nr_sequencia_p text) FROM PUBLIC;

