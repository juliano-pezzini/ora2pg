-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_evento_convenio ( nr_sequencia_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_sequencia_w	bigint;


BEGIN

select	nextval('evento_convenio_seq')
into STRICT	nr_sequencia_w
;

insert into evento_convenio(
	nr_sequencia, cd_convenio, dt_atualizacao,
	nm_usuario, nr_seq_evento, ds_evento,
	ds_dll, ds_funcao, nr_seq_interface,
	cd_estabelecimento, nr_seq_apres)
SELECT
	nr_sequencia_w,
	cd_convenio,
	clock_timestamp(),
	nm_usuario_p,
	nr_seq_evento,
	obter_desc_expressao(305327)||' '||ds_evento,
  --305327 = 'novo'
	ds_dll,
	ds_funcao,
	nr_seq_interface,
	cd_estabelecimento,
	nr_seq_apres + 1
from	evento_convenio
where	nr_sequencia	= nr_sequencia_p;

insert into evento_convenio_ret(
	nr_sequencia, nr_seq_evento_conv,
	dt_atualizacao, nm_usuario, cd_retorno,
	ds_retorno, ie_sucesso)
SELECT	nextval('evento_convenio_ret_seq'),
	nr_sequencia_w,
	clock_timestamp(),
	nm_usuario_p,
	cd_retorno,
	ds_retorno,
	ie_sucesso
from	evento_convenio_ret
where	nr_seq_evento_conv	= nr_sequencia_p;

commit;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_evento_convenio ( nr_sequencia_p bigint, nm_usuario_p text) FROM PUBLIC;

