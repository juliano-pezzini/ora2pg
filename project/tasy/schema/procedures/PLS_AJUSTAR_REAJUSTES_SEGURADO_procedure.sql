-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_ajustar_reajustes_segurado ( nr_seq_segurado_p bigint, nr_seq_tabela_ant_p bigint) AS $body$
BEGIN
if	((coalesce(nr_seq_segurado_p,0)>0) and (coalesce(nr_seq_tabela_ant_p,0)>0)) then

	update 	pls_segurado_preco
	set	ie_situacao = 'I',
		ds_observacao = 'Reajuste inativado devido a alteracao de tabela de preco do beneficiario'
	where 	nr_seq_segurado = nr_seq_segurado_p
	and 	nr_seq_tabela = nr_seq_tabela_ant_p
	and 	(((pls_store_data_mens_pck.get_ie_mes_cobranca_reaj = 'M') 
	and (dt_reajuste >= ESTABLISHMENT_TIMEZONE_UTILS.startOfmonth(clock_timestamp())))
	or	((pls_store_data_mens_pck.get_ie_mes_cobranca_reaj = 'P')
	and (add_months(dt_reajuste,1) >= ESTABLISHMENT_TIMEZONE_UTILS.startOfmonth(clock_timestamp()))));
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_ajustar_reajustes_segurado ( nr_seq_segurado_p bigint, nr_seq_tabela_ant_p bigint) FROM PUBLIC;

