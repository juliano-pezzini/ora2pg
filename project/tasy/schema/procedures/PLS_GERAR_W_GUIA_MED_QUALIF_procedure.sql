-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gerar_w_guia_med_qualif (nm_usuario_p usuario.nm_usuario%type, nr_seq_guia_medico_p w_pls_guia_medico.nr_sequencia%type, nr_seq_instituicao_acred_p pls_instituicao_acred.nr_sequencia%type, nr_seq_prest_qualif_p pls_prestador_qualif.nr_sequencia%type, ie_atrib_qualif_p pls_atrib_qualif_prest.ie_atrib_qualif%type, ds_qualificacao_p pls_atrib_qualif_prest.ds_atrib_qualif%type, ds_observacao_p pls_atrib_qualif_prest.ds_observacao%type, ds_instituicao_acred_p pls_instituicao_acred.ds_instituicao_acred%type ) AS $body$
DECLARE


ds_qualificacao_w		pls_atrib_qualif_prest.ds_atrib_qualif%type := ds_qualificacao_p;
ds_observacao_w			pls_atrib_qualif_prest.ds_observacao%type := ds_observacao_p;


BEGIN

if (nr_seq_guia_medico_p IS NOT NULL AND nr_seq_guia_medico_p::text <> '') then

	if (coalesce(nr_seq_instituicao_acred_p::text, '') = '') and (ie_atrib_qualif_p IS NOT NULL AND ie_atrib_qualif_p::text <> '') then
		select	max(ds_atrib_qualif),
			max(ds_observacao)
		into STRICT	ds_qualificacao_w,
			ds_observacao_w
		from	pls_atrib_qualif_prest
		where	ie_atrib_qualif	= ie_atrib_qualif_p;
	end if;

	insert into w_pls_guia_med_qualif(nr_sequencia,				dt_atualizacao,			nm_usuario,
		dt_atualizacao_nrec,			nm_usuario_nrec,		nr_seq_guia_medico,
		nr_seq_instituicao_acred,		nr_seq_prest_qualif,		ie_atrib_qualif,
		ds_qualificacao,			ds_observacao,			ds_instituicao_acred)
	values (nextval('w_pls_guia_med_qualif_seq'),	clock_timestamp(),			nm_usuario_p,
		clock_timestamp(),				nm_usuario_p,			nr_seq_guia_medico_p,
		nr_seq_instituicao_acred_p,		nr_seq_prest_qualif_p,		ie_atrib_qualif_p,
		ds_qualificacao_w,			ds_observacao_w,		ds_instituicao_acred_p);
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_w_guia_med_qualif (nm_usuario_p usuario.nm_usuario%type, nr_seq_guia_medico_p w_pls_guia_medico.nr_sequencia%type, nr_seq_instituicao_acred_p pls_instituicao_acred.nr_sequencia%type, nr_seq_prest_qualif_p pls_prestador_qualif.nr_sequencia%type, ie_atrib_qualif_p pls_atrib_qualif_prest.ie_atrib_qualif%type, ds_qualificacao_p pls_atrib_qualif_prest.ds_atrib_qualif%type, ds_observacao_p pls_atrib_qualif_prest.ds_observacao%type, ds_instituicao_acred_p pls_instituicao_acred.ds_instituicao_acred%type ) FROM PUBLIC;

