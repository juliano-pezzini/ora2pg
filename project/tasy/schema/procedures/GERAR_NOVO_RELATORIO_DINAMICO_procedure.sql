-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_novo_relatorio_dinamico (nm_usuario_p text, ds_titulo_p text, nr_seq_relatorio_p INOUT bigint, tipo_componente_p text default null, nr_seq_documento_p bigint default null, nr_seq_avaliation_p bigint default null, nr_seq_template_p bigint default null) AS $body$
DECLARE


nr_seq_relatorio_w		bigint;
cd_relatorio_w			relatorio.cd_relatorio%type;
doc_relatorio_dinamico_w 	doc_relatorio_dinamico.nr_sequencia%type;
nr_seq_schematic_w		doc_relatorio_dinamico.nr_seq_schematic%type;
nr_seq_objeto_w			doc_relatorio_dinamico.nr_seq_objeto%type;
nr_seq_template_w		doc_relatorio_dinamico.nr_seq_template%type;
nr_seq_avaliacao_w		doc_relatorio_dinamico.nr_seq_avaliacao%type;


BEGIN

    select
	CASE WHEN tipo_componente_p='WDBPANEL' THEN  nr_seq_documento_p  ELSE null END ,
	CASE WHEN tipo_componente_p='WCPANEL' THEN  nr_seq_documento_p  ELSE null END ,
	CASE WHEN tipo_componente_p='WEHR' THEN  nr_seq_documento_p  ELSE null END ,
	CASE WHEN tipo_componente_p='WAVALIAR' THEN  nr_seq_documento_p  ELSE null END
    into STRICT nr_seq_schematic_w,
	nr_seq_objeto_w,
	nr_seq_template_w,
	nr_seq_avaliacao_w
;


	select	obter_menor_codigo_relat('C')
	into STRICT	cd_relatorio_w
	;

	select nextval('relatorio_seq')
	into STRICT nr_seq_relatorio_w
	;

	insert into relatorio(
	nr_sequencia,
	dt_atualizacao,
	nm_usuario,
	ds_titulo,
	cd_relatorio,
	cd_classif_relat,
	ie_borda_sup,
	ie_borda_inf,
	ie_borda_esq,
	ie_borda_dir,
	ie_orientacao,
	ie_imprime_vazio,
	ie_filtro_html,
	ie_filtro_word,
	ie_tipo_papel,
	ie_filtro_excel,
	ie_filtro_texto,
	qt_margem_sup,
	qt_margem_inf,
	qt_margem_esq,
	qt_margem_dir,
	ie_etiqueta)
	values (nr_seq_relatorio_w,
	clock_timestamp(),
	nm_usuario_p,
	ds_titulo_p,
	cd_relatorio_w,
	'C',
	'S',
	'S',
	'S',
	'S',
	'R',
	'S',
	'S',
	'N',
	'A4',
	'N',
	'N',
	'10',
	'10',
	'10',
	'10',
	'N');

	doc_relatorio_dinamico_w := inserir_doc_relatorio_dinamico(
	nr_seq_relatorio_w, nr_seq_template_w, nr_seq_avaliacao_w, nr_seq_schematic_w, nr_seq_objeto_w, nm_usuario_p, doc_relatorio_dinamico_w);

	/*header*/

	CALL obter_dados_padrao_banda(nr_seq_relatorio_w,cd_relatorio_w,
	1,nm_usuario_p);

	/*footer*/

	CALL obter_dados_padrao_banda(nr_seq_relatorio_w,cd_relatorio_w,
	4,nm_usuario_p);

 CALL liberar_relatorio_dinamico(nm_usuario_p,
			nr_seq_relatorio_w,
			tipo_componente_p,
			nr_seq_documento_p);

nr_seq_relatorio_p := nr_seq_relatorio_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_novo_relatorio_dinamico (nm_usuario_p text, ds_titulo_p text, nr_seq_relatorio_p INOUT bigint, tipo_componente_p text default null, nr_seq_documento_p bigint default null, nr_seq_avaliation_p bigint default null, nr_seq_template_p bigint default null) FROM PUBLIC;

