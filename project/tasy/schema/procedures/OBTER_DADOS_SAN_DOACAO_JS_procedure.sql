-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_dados_san_doacao_js ( ie_status_doacao_p text, nr_seq_camp_doacao_p bigint, nr_atendimento_novo_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text, nr_sangue_p INOUT text, nr_seq_entidade_p INOUT bigint, nr_seq_status_doacao_p INOUT bigint, nr_seq_campanha_p INOUT bigint, cd_unidade_externa_p INOUT text) AS $body$
BEGIN

nr_sangue_p := obter_numero_sangue_seq(cd_estabelecimento_p);

select 	max(nr_seq_entidade)
into STRICT	nr_seq_entidade_p
from  	san_parametro
where  	cd_estabelecimento = cd_estabelecimento_p;

select  max(nr_sequencia)
into STRICT	nr_seq_status_doacao_p
from    san_status_doacao
where   ie_status_doacao = ie_status_doacao_p
and     ie_situacao = 'A';

select  max(a.nr_seq_campanha)
into STRICT	nr_seq_campanha_p
from    san_doacao_campanha a
where   a.nr_sequencia = nr_seq_camp_doacao_p;

select 	max(cd_unidade_externa)
into STRICT	cd_unidade_externa_p
from   	atend_paciente_unidade
where  	nr_atendimento = nr_atendimento_novo_p;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_dados_san_doacao_js ( ie_status_doacao_p text, nr_seq_camp_doacao_p bigint, nr_atendimento_novo_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text, nr_sangue_p INOUT text, nr_seq_entidade_p INOUT bigint, nr_seq_status_doacao_p INOUT bigint, nr_seq_campanha_p INOUT bigint, cd_unidade_externa_p INOUT text) FROM PUBLIC;

