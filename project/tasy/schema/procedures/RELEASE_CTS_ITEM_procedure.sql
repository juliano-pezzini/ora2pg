-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE release_cts_item (NR_SEQ_OBJ_SCHEM_TAB_P bigint, NM_USUARIO_P text) AS $body$
DECLARE

	
	ds_table	varchar(100);
	nm_tabela	varchar(90);
	nr_seq_visao	bigint;
    isTabExist  varchar(15);


BEGIN
	ds_table := get_child_wdbp(nr_seq_obj_schem_tab_p);

	if (ds_table IS NOT NULL AND ds_table::text <> '') then
		begin

		select	coalesce(substr(ds_table, 0, (select position(',' in ds_table) )-1),null)
		into STRICT	nm_tabela
		;


		select	coalesce(to_number(substr(ds_table, (select position(',' in ds_table) )+1, length(ds_table))),null)
		into STRICT	nr_seq_visao
		;

		end;

		if (nm_tabela IS NOT NULL AND nm_tabela::text <> '' AND nr_seq_visao IS NOT NULL AND nr_seq_visao::text <> '') then

            		select  max(nr_sequencia)
            		into STRICT    isTabExist
            		from    tab_visao_schematic
            		where   nr_seq_obj_schematic = nr_seq_obj_schem_tab_p;

            		if (coalesce(isTabExist::text, '') = '') then
            		
            		    CALL inserir_tab_visao_schem(nr_seq_obj_schem_tab_p,
            		                nm_tabela,
            		                nr_seq_visao,
            		                nm_usuario_p);
            		else
            		    CALL wheb_mensagem_pck.exibir_mensagem_abort(1205644);
            		end if;
		end if;

	end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE release_cts_item (NR_SEQ_OBJ_SCHEM_TAB_P bigint, NM_USUARIO_P text) FROM PUBLIC;

