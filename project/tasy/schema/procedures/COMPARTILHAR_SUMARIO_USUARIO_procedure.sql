-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE compartilhar_sumario_usuario ( nr_sequencia_suep_p bigint, nm_usuario_share_p text) AS $body$
DECLARE


	ie_inserir_regra_w varchar(1);

BEGIN
if (nr_sequencia_suep_p IS NOT NULL AND nr_sequencia_suep_p::text <> '' AND nm_usuario_share_p IS NOT NULL AND nm_usuario_share_p::text <> '') then


	select	coalesce(max('S'),'N')
	into STRICT	ie_inserir_regra_w
	from	regra_liberacao_suep
	where	nr_seq_suep = nr_sequencia_suep_p
	and		nm_usuario_exclusivo <> nm_usuario_share_p;

	if (ie_inserir_regra_w = 'S') then

		insert into regra_liberacao_suep(
					nr_sequencia,
					dt_atualizacao,
					nm_usuario,
					dt_atualizacao_nrec,
					nm_usuario_nrec,
					nr_seq_suep,
					cd_estabelecimento,
					nm_usuario_exclusivo,
					ie_sumario_padrao
					) values (
					nextval('regra_liberacao_suep_seq'),
					clock_timestamp(),
					wheb_usuario_pck.get_nm_usuario,
					clock_timestamp(),
					wheb_usuario_pck.get_nm_usuario,
					nr_sequencia_suep_p,
					wheb_usuario_pck.get_cd_estabelecimento,
					nm_usuario_share_p,
					'N');


		commit;
	end if;

end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE compartilhar_sumario_usuario ( nr_sequencia_suep_p bigint, nm_usuario_share_p text) FROM PUBLIC;

