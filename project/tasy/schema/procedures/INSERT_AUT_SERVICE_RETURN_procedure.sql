-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_aut_service_return (NM_USUARIO_P text, IE_STATUS_P text, CD_EXP_MENSAGEM_P integer, NR_SEQ_AUTORIZACAO_P text, VL_COBERTO_P bigint, VL_USUARIO_PROC_P bigint, VL_TOTAL_P bigint, DS_MENSAGEM_P text, QT_PROCEDIMENTO_P bigint, CD_PROCEDIMENTO_P text, CD_AUTORIZACAO_P bigint) AS $body$
DECLARE


ds_procedimento_w  procedimento.ds_procedimento_pesquisa%type;


BEGIN

select 	coalesce(ds_procedimento_pesquisa,'')
into STRICT 	ds_procedimento_w
from 	procedimento
where 	cd_procedimento = cd_procedimento_p;

insert into AUT_SERVICE_RETURN(
						nr_sequencia,
						dt_atualizacao,
						nm_usuario,
						dt_atualizacao_nrec,
						nm_usuario_nrec,
						ie_status,
						ds_mensagem,
						nr_seq_autorizacao,
						vl_coberto,
						vl_usuario_proc,
						vl_total,
						cd_procedimento,
						ds_procedimento,
						cd_autorization)
						values (
						nextval('aut_service_return_seq'),
						clock_timestamp(),
						nm_usuario_p,
						clock_timestamp(),
						nm_usuario_p,
						ie_status_p,
						get_expression(cd_exp_mensagem_p,'es-DO') || CASE WHEN coalesce(ds_mensagem_p::text, '') = '' THEN  ''  ELSE ' - '||ds_mensagem_p END ,
						nr_seq_autorizacao_p,
						vl_coberto_p,
						vl_usuario_proc_p,
						vl_total_p,
						cd_procedimento_p,
						ds_procedimento_w,
						cd_autorizacao_p);
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_aut_service_return (NM_USUARIO_P text, IE_STATUS_P text, CD_EXP_MENSAGEM_P integer, NR_SEQ_AUTORIZACAO_P text, VL_COBERTO_P bigint, VL_USUARIO_PROC_P bigint, VL_TOTAL_P bigint, DS_MENSAGEM_P text, QT_PROCEDIMENTO_P bigint, CD_PROCEDIMENTO_P text, CD_AUTORIZACAO_P bigint) FROM PUBLIC;

