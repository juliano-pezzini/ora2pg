-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_info_agente ( nr_grafico_atual_p bigint, nr_tipo_agente_p INOUT bigint, ie_assinado_p INOUT text, ie_liberado_p INOUT text) AS $body$
DECLARE


nr_tipo_agente_w	smallint;
ie_assinado_w     	varchar(2);
ie_liberado_w       varchar(2);


BEGIN

select coalesce(max(ie_tipo), 0),
	   CASE WHEN OBTER_DATA_ASSINATURA_DIGITAL(max(nr_seq_assinatura)) IS NULL THEN  'N'  ELSE 'S' END ,
	   CASE WHEN coalesce(max(dt_liberacao)::text, '') = '' THEN  'N'  ELSE 'S' END
into STRICT nr_tipo_agente_w,
	 ie_assinado_w,
	 ie_liberado_w
from cirurgia_agente_anestesico
where nr_sequencia = nr_grafico_atual_p
  and coalesce(ie_situacao,'A') = 'A';

nr_tipo_agente_p := nr_tipo_agente_w;
ie_assinado_p    := ie_assinado_w;
ie_liberado_p    := ie_liberado_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_info_agente ( nr_grafico_atual_p bigint, nr_tipo_agente_p INOUT bigint, ie_assinado_p INOUT text, ie_liberado_p INOUT text) FROM PUBLIC;

