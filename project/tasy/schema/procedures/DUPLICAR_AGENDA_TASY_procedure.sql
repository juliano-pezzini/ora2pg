-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_agenda_tasy (nr_seq_agenda_origem_p bigint, qt_dias_repet_p bigint,dt_fim_repeticao_p timestamp) AS $body$
DECLARE


/*
nr_seq_agenda_origem_p - Passar a sequencia da agenda que irá originar a repetição
qt_dias_repet_p	  - Passar o intervalo em dias para repetir a agenda (Ex: A cada sete dias, passar valor 7
dt_fim_repeticao_p	 - Passar a data fim para repetir a agenda.

*/
nr_w bigint;
dt_agenda_w timestamp;

C01 CURSOR FOR
	SELECT *
	from	agenda_tasy
	where	nr_sequencia = nr_seq_agenda_origem_p;

agenda_tasy_w	c01%rowtype;


BEGIN

open C01;
loop
fetch C01 into
	agenda_tasy_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin
	nr_w := 0;
	end;
end loop;
close C01;

dt_agenda_w := agenda_tasy_w.dt_agenda;

while(dt_agenda_w < dt_fim_repeticao_p) loop
	begin
	dt_agenda_w := dt_agenda_w + qt_dias_repet_p;
	insert into agenda_tasy(
		nr_sequencia,
		nm_usuario_agenda,
		dt_agenda,
		nr_minuto_duracao,
		nr_seq_tipo,
		dt_atualizacao,
		nm_usuario,
		ds_agenda,
		ds_local,
		ds_observacao,
		ie_status,
		dt_final,
		nr_seq_local,
		nr_seq_agenda_convite
	) values (
		nextval('agenda_tasy_seq'),
		agenda_tasy_w.nm_usuario_agenda,
		dt_agenda_w,
		agenda_tasy_w.nr_minuto_duracao,
		agenda_tasy_w.nr_seq_tipo,
		agenda_tasy_w.dt_atualizacao,
		agenda_tasy_w.nm_usuario,
		agenda_tasy_w.ds_agenda,
		agenda_tasy_w.ds_local,
		agenda_tasy_w.ds_observacao,
		agenda_tasy_w.ie_status,
		agenda_tasy_w.dt_final,
		agenda_tasy_w.nr_seq_local,
		agenda_tasy_w.nr_seq_agenda_convite
	);

	end;
end loop;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_agenda_tasy (nr_seq_agenda_origem_p bigint, qt_dias_repet_p bigint,dt_fim_repeticao_p timestamp) FROM PUBLIC;

