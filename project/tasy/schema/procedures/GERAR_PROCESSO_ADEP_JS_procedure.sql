-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_processo_adep_js ( nr_atendimento_p bigint, dt_horario_p timestamp, ie_somente_gedipa_p text, cd_funcao_origem_p bigint, ie_origem_processo_p text, ie_gedipa_p text, ie_separar_agora_p text, cd_local_estoque_p bigint, cd_setor_prescr_p bigint, ie_intervencao_p text, ie_setor_gedipa_p text, nm_usuario_p text, nr_prescricao_p bigint default null, ie_gera_nutricao_p text default 'N') AS $body$
DECLARE


nr_seq_processo_w		bigint;
nr_seq_processo_agora_w	bigint;
nr_seq_processo_nut_w	bigint;
ie_gerar_frac_w			varchar(1);


BEGIN

SELECT * FROM Gerar_Processo_Adep(nr_atendimento_p, dt_horario_p, nm_usuario_p, nr_seq_processo_w, ie_somente_gedipa_p, cd_funcao_origem_p, ie_origem_processo_p, ie_gedipa_p, ie_separar_agora_p, nr_seq_processo_agora_w, cd_local_estoque_p, cd_setor_prescr_p, ie_intervencao_p, nr_seq_processo_nut_w, null, nr_prescricao_p, ie_gera_nutricao_p) INTO STRICT nr_seq_processo_w, nr_seq_processo_agora_w, nr_seq_processo_nut_w;

CALL Wheb_assist_pck.set_informacoes_usuario(coalesce(wheb_usuario_pck.get_cd_estabelecimento,1), wheb_usuario_pck.get_cd_perfil, nm_usuario_p);
ie_gerar_frac_w	:= coalesce(Wheb_assist_pck.obterParametroFuncao(-1113,61), 'N');


if (ie_setor_gedipa_p = 'S') and (coalesce(nr_seq_processo_w,0) > 0) and (ie_gerar_frac_w = 'N') then

	CALL Gerar_Fracionamento_Processo(nr_seq_processo_w, nm_usuario_p);

	if (coalesce(nr_seq_processo_nut_w,0) > 0) then
		CALL Gerar_Fracionamento_Processo(nr_seq_processo_nut_w, nm_usuario_p);
	end if;

elsif (ie_setor_gedipa_p = 'S') and (coalesce(nr_seq_processo_nut_w,0) > 0) and (ie_gerar_frac_w = 'N') then
	CALL Gerar_Fracionamento_Processo(nr_seq_processo_nut_w, nm_usuario_p);
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_processo_adep_js ( nr_atendimento_p bigint, dt_horario_p timestamp, ie_somente_gedipa_p text, cd_funcao_origem_p bigint, ie_origem_processo_p text, ie_gedipa_p text, ie_separar_agora_p text, cd_local_estoque_p bigint, cd_setor_prescr_p bigint, ie_intervencao_p text, ie_setor_gedipa_p text, nm_usuario_p text, nr_prescricao_p bigint default null, ie_gera_nutricao_p text default 'N') FROM PUBLIC;

