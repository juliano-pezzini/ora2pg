-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_ajustar_exame_lab () AS $body$
DECLARE


nr_seq_exame_w	bigint;
ds_proced_w	varchar(255);

c01 CURSOR FOR
SELECT	distinct
	nr_seq_exame,
	substr(Obter_Desc_Prescr_Proc(CD_PROCEDIMENTO,IE_ORIGEM_PROCED, nr_seq_proc_interno),1,240)
from	prescr_procedimento a
where	(nr_seq_exame IS NOT NULL AND nr_seq_exame::text <> '')
and	(cd_material_Exame IS NOT NULL AND cd_material_Exame::text <> '')
and	exists (select	1
		from	prescr_procedimento x
		where	substr(Obter_Desc_Prescr_Proc(a.CD_PROCEDIMENTO,a.IE_ORIGEM_PROCED, a.nr_seq_proc_interno),1,240) = substr(Obter_Desc_Prescr_Proc(x.CD_PROCEDIMENTO,x.IE_ORIGEM_PROCED, x.nr_seq_proc_interno),1,240)
		and	coalesce(x.nr_seq_exame::text, '') = ''
		and	(x.cd_material_Exame IS NOT NULL AND x.cd_material_Exame::text <> ''));


BEGIN

open C01;
loop
fetch C01 into
	nr_seq_exame_w,
	ds_proced_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	update	prescr_procedimento
	set	nr_seq_exame = nr_seq_exame_w,
		nm_usuario = 'OS194395'
	where	substr(Obter_Desc_Prescr_Proc(CD_PROCEDIMENTO,IE_ORIGEM_PROCED, nr_seq_proc_interno),1,240) = ds_proced_w
	and	coalesce(nr_seq_exame::text, '') = ''
	and	(cd_material_Exame IS NOT NULL AND cd_material_Exame::text <> '');
	commit;
end loop;
close C01;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_ajustar_exame_lab () FROM PUBLIC;

