-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_legenda_estab ( nr_sequencia_p bigint, cd_estabelecimento_novo_p text, nm_usuario_p text) AS $body$
DECLARE


tam_lista_w			bigint;
ie_pos_virgula_w			smallint	:= 0;
cd_estabelecimento_w		varchar(10);
ie_negacao_w			bigint;
cd_estabelecimento_novo_w		varchar(4000);
nr_seq_legenda_w			bigint;
ds_item_w			varchar(40);
nr_seq_cor_w			bigint;
ds_hint_w			varchar(255);
nr_seq_apres_w			varchar(10);


BEGIN
select	nr_seq_legenda,
	ds_item,
	nr_seq_cor,
	ds_hint,
	nr_seq_apres
into STRICT	nr_seq_legenda_w,
	ds_item_w,
	nr_seq_cor_w,
	ds_hint_w,
	nr_seq_apres_w
from	tasy_padrao_cor_cliente
where	nr_sequencia = nr_sequencia_p;

cd_estabelecimento_novo_w := substr(replace(trim(both cd_estabelecimento_novo_p),')',','),2,length(cd_estabelecimento_novo_p));

if (cd_estabelecimento_novo_w IS NOT NULL AND cd_estabelecimento_novo_w::text <> '') then
	begin
	while(length(cd_estabelecimento_novo_w) > 0) loop
		begin
		tam_lista_w		:=	length(cd_estabelecimento_novo_w);
		ie_pos_virgula_w		:=	position(',' in cd_estabelecimento_novo_w);

		if (ie_pos_virgula_w <> 0) then
			cd_estabelecimento_w		:= substr(cd_estabelecimento_novo_w,1,(ie_pos_virgula_w - 1));
			cd_estabelecimento_novo_w		:= substr(cd_estabelecimento_novo_w,(ie_pos_virgula_w + 1),tam_lista_w);
		end if;

		insert	into tasy_padrao_cor_cliente(
				nr_sequencia,
				nr_seq_legenda,
				ds_item,
				nr_seq_cor,
				dt_atualizacao,
				nm_usuario,
				dt_atualizacao_nrec,
				nm_usuario_nrec,
				ds_hint,
				nr_seq_apres,
				cd_estabelecimento)
		values (nextval('tasy_padrao_cor_cliente_seq'),
				nr_seq_legenda_w,
				ds_item_w,
				nr_seq_cor_w,
				clock_timestamp(),
				nm_usuario_p,
				clock_timestamp(),
				nm_usuario_p,
				ds_hint_w,
				nr_seq_apres_w,
				cd_estabelecimento_w);
		end;
	end loop;
	end;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_legenda_estab ( nr_sequencia_p bigint, cd_estabelecimento_novo_p text, nm_usuario_p text) FROM PUBLIC;

