-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_turno_dia_semana (nr_seq_turno_p bigint, ie_dia_semana_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text, ie_regras_convenio_turnos_p text default 'N', ie_preferencias_p text default 'N', ie_classif_liberadas_p text default 'N') AS $body$
DECLARE


agenda_turno_seq_w	numeric(20);


BEGIN

select	nextval('agenda_turno_seq')
into STRICT	agenda_turno_seq_w
from	agenda_turno LIMIT 1;

insert into agenda_turno(cd_agenda,
			cd_convenio_padrao,
			cd_medico_req,
			ds_observacao,
			ds_obs_interna,
			dt_atualizacao,
			dt_atualizacao_nrec,
			dt_final_vigencia,
			dt_inicio_vigencia,
			hr_final,
			hr_final_intervalo,
			hr_inicial,
			hr_inicial_intervalo,
			ie_classif_agenda,
			ie_dia_semana,
			ie_encaixe,
			ie_feriado,
			ie_frequencia,
			ie_integrar_turno,
			ie_semana,
			ie_utiliza_ageweb,
			nm_usuario,
			nm_usuario_nrec,
			nr_minuto_intervalo,
			nr_seq_classif_med,
			nr_seq_sala,
			nr_sequencia,
			qt_idade_max,
			qt_idade_min,
			qt_total_turno)
		(SELECT	cd_agenda,
			cd_convenio_padrao,
			cd_medico_req,
			ds_observacao,
			ds_obs_interna,
			clock_timestamp(),
			clock_timestamp(),
			dt_final_vigencia,
			dt_inicio_vigencia,
			hr_final,
			hr_final_intervalo,
			hr_inicial,
			hr_inicial_intervalo,
			ie_classif_agenda,
			ie_dia_semana_p,
			ie_encaixe,
			ie_feriado,
			ie_frequencia,
			ie_integrar_turno,
			ie_semana,
			ie_utiliza_ageweb,
			nm_usuario_p,
			nm_usuario_p,
			nr_minuto_intervalo,
			nr_seq_classif_med,
			nr_seq_sala,
			agenda_turno_seq_w,
			qt_idade_max,
			qt_idade_min,
			qt_total_turno
		from	agenda_turno
		where	nr_sequencia = nr_seq_turno_p);

if (ie_regras_convenio_turnos_p = 'S') then

	insert into agenda_turno_conv(nr_sequencia,
			cd_agenda,
			cd_categoria,
			cd_convenio,
			dt_atualizacao,
			dt_atualizacao_nrec,
			dt_fim_vigencia,
			dt_inicio_vigencia,
			hr_inicial,
			ie_atende_convenio,
			ie_tipo_convenio,
			ie_valida_zerada,
			nm_usuario,
			nm_usuario_nrec,
			nr_seq_turno,
			pr_permissao,
			qt_permissao,
			qt_perm_encaixe)
	(SELECT	nextval('agenda_turno_conv_seq'),
			cd_agenda,
			cd_categoria,
			cd_convenio,
			clock_timestamp(),
			clock_timestamp(),
			dt_fim_vigencia,
			dt_inicio_vigencia,
			hr_inicial,
			ie_atende_convenio,
			ie_tipo_convenio,
			ie_valida_zerada,
			nm_usuario_p,
			nm_usuario_p,
			agenda_turno_seq_w,
			pr_permissao,
			qt_permissao,
			qt_perm_encaixe
	from	agenda_turno_conv
	where	nr_seq_turno = nr_seq_turno_p);

end if;

if (ie_preferencias_p = 'S') then

	insert into agenda_horario_pref(nr_sequencia,
			cd_perfil,
			dt_atualizacao,
			dt_atualizacao_nrec,
			dt_final_vigencia,
			dt_inicio_vigencia,
			hr_final,
			hr_inicial,
			nm_usuario,
			nm_usuario_nrec,
			nr_seq_turno,
			nr_seq_preferencia)
	(SELECT	nextval('agenda_horario_pref_seq'),
			cd_perfil,
			clock_timestamp(),
			clock_timestamp(),
			dt_final_vigencia,
			dt_inicio_vigencia,
			hr_final,
			hr_inicial,
			nm_usuario_p,
			nm_usuario_p,
			agenda_turno_seq_w,
			nr_seq_preferencia
	from	agenda_horario_pref
	where	nr_seq_turno = nr_seq_turno_p);

end if;

if (ie_classif_liberadas_p = 'S') then

	insert into agenda_turno_classif_lib(nr_sequencia,
			dt_atualizacao,
			dt_atualizacao_nrec,
			ie_classif_agenda,
			nm_usuario,
			nm_usuario_nrec,
			nr_seq_turno)
	(SELECT	nextval('agenda_turno_classif_lib_seq'),
			clock_timestamp(),
			clock_timestamp(),
			ie_classif_agenda,
			nm_usuario_p,
			nm_usuario_p,
			agenda_turno_seq_w
	from	agenda_turno_classif_lib
	where	nr_seq_turno = nr_seq_turno_p);

end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_turno_dia_semana (nr_seq_turno_p bigint, ie_dia_semana_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text, ie_regras_convenio_turnos_p text default 'N', ie_preferencias_p text default 'N', ie_classif_liberadas_p text default 'N') FROM PUBLIC;

