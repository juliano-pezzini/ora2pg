-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atend_pac_newrecord_confir_eup ( ie_novo_atend_apac_p text, ie_pasta_completo_p text, ie_atend_novo_gv_p text, ie_novo_atend_gv_p text, qt_dias_internacao_p bigint, ie_novo_alta_anterior_p text, cd_pessoa_fisica_p text, nm_usuario_p text, ie_tipo_atend_p bigint, cd_estabelecimento_p bigint, cd_medico_resp_p text, ie_clinica_p text, ds_msg_abort_p INOUT text, ds_msg_conf_atend_sem_alta_p INOUT text, ds_msg_conf_dias_inter_p INOUT text, ds_msg_infor_gv_p INOUT text, ds_msg_confir_apac_p INOUT text, nr_seq_classificacao_p bigint) AS $body$
DECLARE

 
 
ds_msg_abort_w			varchar(255);
ds_msg_conf_atend_sem_alta_w	varchar(255);
ds_msg_atend_sem_alta_w		varchar(255);
ie_continuar_execucao_w		varchar(1) := 'S';
ds_msg_conf_dias_inter_w	varchar(255);
ie_solic_vaga_gv_w		varchar(1);
ds_msg_infor_gv_w		varchar(255);
ie_consiste_atend_apac_w	varchar(1);
ds_msg_confir_apac_w		varchar(255);


BEGIN 
 
IF (ie_continuar_execucao_w = 'S') AND (ie_novo_alta_anterior_p <> 'M') THEN 
 
	ds_msg_atend_sem_alta_w := consiste_gerar_novo_atend(cd_pessoa_fisica_p, nm_usuario_p, ie_tipo_atend_p, cd_estabelecimento_p, coalesce(cd_medico_resp_p,'0'), ie_clinica_p, ds_msg_atend_sem_alta_w, nr_seq_classificacao_p);
	IF (ds_msg_atend_sem_alta_w IS NOT NULL AND ds_msg_atend_sem_alta_w::text <> '') THEN 
 
		IF (ie_novo_alta_anterior_p = 'N') OR (ie_novo_alta_anterior_p = 'T') OR (ie_novo_alta_anterior_p = 'E') THEN 
			ds_msg_abort_w := SUBSTR(ds_msg_atend_sem_alta_w,1,255);
			ie_continuar_execucao_w := 'N';
		ELSIF (ie_novo_alta_anterior_p = 'A') THEN 
			ds_msg_conf_atend_sem_alta_w:= SUBSTR(ds_msg_atend_sem_alta_w,1,255);
			ie_continuar_execucao_w := 'S';
		END IF;
	END IF;
END IF;
 
IF (ie_continuar_execucao_w = 'S') AND (coalesce(qt_dias_internacao_p,0) > 0) AND (ie_pasta_completo_p = 'S') THEN 
	ds_msg_conf_dias_inter_w := consistir_reinternacao(cd_pessoa_fisica_p, qt_dias_internacao_p, nm_usuario_p, cd_estabelecimento_p, clock_timestamp(), NULL, NULL, NULL, NULL, ds_msg_conf_dias_inter_w);
	ie_continuar_execucao_w := 'S';
END IF;
 
IF (ie_continuar_execucao_w = 'S') AND (ie_atend_novo_gv_p = 'N') AND (ie_pasta_completo_p = 'S') THEN 
	ie_solic_vaga_gv_w := obter_se_solic_vaga(cd_pessoa_fisica_p);
	IF (ie_solic_vaga_gv_w = 'S') THEN 
		IF (ie_novo_atend_gv_p = 'I') THEN 
			ds_msg_abort_w := SUBSTR(obter_texto_tasy(91729, wheb_usuario_pck.get_nr_seq_idioma),1,255);
			ie_continuar_execucao_w := 'N';
		ELSIF (ie_novo_atend_gv_p = 'C') THEN 
			ds_msg_infor_gv_w := SUBSTR(obter_texto_tasy(91733, wheb_usuario_pck.get_nr_seq_idioma),1,255);
			ie_continuar_execucao_w := 'S';
		END IF;
	END IF;
END IF;
 
IF (ie_continuar_execucao_w = 'S') AND (ie_novo_atend_apac_p <> 'N') THEN 
	ie_consiste_atend_apac_w := obter_se_consiste_atend_apac(cd_pessoa_fisica_p);
	IF (ie_consiste_atend_apac_w = 'S') THEN 
		ds_msg_confir_apac_w := SUBSTR(obter_texto_tasy(91741, wheb_usuario_pck.get_nr_seq_idioma),1,255);
		ie_continuar_execucao_w := 'S';
	END IF;
END IF;
 
ds_msg_conf_atend_sem_alta_p := ds_msg_conf_atend_sem_alta_w;
ds_msg_conf_dias_inter_p := ds_msg_conf_dias_inter_w;
ds_msg_abort_p := ds_msg_abort_w;
ds_msg_infor_gv_p := ds_msg_infor_gv_w;
ds_msg_confir_apac_p := ds_msg_confir_apac_w;
 
 
COMMIT;
 
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atend_pac_newrecord_confir_eup ( ie_novo_atend_apac_p text, ie_pasta_completo_p text, ie_atend_novo_gv_p text, ie_novo_atend_gv_p text, qt_dias_internacao_p bigint, ie_novo_alta_anterior_p text, cd_pessoa_fisica_p text, nm_usuario_p text, ie_tipo_atend_p bigint, cd_estabelecimento_p bigint, cd_medico_resp_p text, ie_clinica_p text, ds_msg_abort_p INOUT text, ds_msg_conf_atend_sem_alta_p INOUT text, ds_msg_conf_dias_inter_p INOUT text, ds_msg_infor_gv_p INOUT text, ds_msg_confir_apac_p INOUT text, nr_seq_classificacao_p bigint) FROM PUBLIC;

