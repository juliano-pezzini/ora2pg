-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE montar_concorde_comparativo ( CD_FUNCAO_P bigint, CD_PERFIL1_P bigint, CD_PERFIL2_P bigint, CD_PERFIL3_P bigint DEFAULT null, CD_PERFIL4_P bigint DEFAULT null, CD_PERFIL5_P bigint DEFAULT null) AS $body$
DECLARE


VLR_PARAM_W			varchar(255);
NR_PARAMETRO_W		bigint;

C01 CURSOR FOR
	SELECT 	OBTER_VLR_PARAMETRO_PERFIL(CD_FUNCAO,CD_PERFIL1_P,NR_SEQUENCIA) VLR_PERFIL1,
		NR_SEQUENCIA
	FROM FUNCAO_PARAMETRO
	WHERE CD_FUNCAO = CD_FUNCAO_P	;


BEGIN

DELETE FROM CONCORDE_COMPARATIVO;
COMMIT;

IF ((CD_FUNCAO_P IS NOT NULL AND CD_FUNCAO_P::text <> '') AND (CD_PERFIL1_P IS NOT NULL AND CD_PERFIL1_P::text <> '') AND (CD_PERFIL2_P IS NOT NULL AND CD_PERFIL2_P::text <> '')) THEN

OPEN C01;
LOOP
FETCH C01 INTO
	VLR_PARAM_W,
	NR_PARAMETRO_W;
EXIT WHEN NOT FOUND; /* apply on C01 */
	BEGIN

	INSERT  INTO CONCORDE_COMPARATIVO(NR_SEQUENCIA,
						CD_FUNCAO,
						CD_PERFIL1,
						CD_PERFIL2,
						CD_PERFIL3,
						CD_PERFIL4,
						CD_PERFIL5,
						VL_PARAM_ATUAL,
						DT_ATUALIZACAO,
						NM_USUARIO)
			 		VALUES (NR_PARAMETRO_W,
						CD_FUNCAO_P,
  						CD_PERFIL1_P,
						CD_PERFIL2_P,
						CASE WHEN CD_PERFIL3_P=0 THEN null  ELSE CD_PERFIL3_P END ,
						CASE WHEN CD_PERFIL4_P=0 THEN null  ELSE CD_PERFIL4_P END ,
						CASE WHEN CD_PERFIL5_P=0 THEN null  ELSE CD_PERFIL5_P END ,
						VLR_PARAM_W,
						clock_timestamp(),
						WHEB_USUARIO_PCK.GET_NM_USUARIO);
	END;
END LOOP;
CLOSE C01;

END IF;
COMMIT;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE montar_concorde_comparativo ( CD_FUNCAO_P bigint, CD_PERFIL1_P bigint, CD_PERFIL2_P bigint, CD_PERFIL3_P bigint DEFAULT null, CD_PERFIL4_P bigint DEFAULT null, CD_PERFIL5_P bigint DEFAULT null) FROM PUBLIC;

