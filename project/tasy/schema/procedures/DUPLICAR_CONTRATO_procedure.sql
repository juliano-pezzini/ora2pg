-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_contrato ( nr_seq_contrato_p bigint, nm_usuario_p text, cd_cgc_cpf_p text, cd_estab_p bigint, nr_sequencia_p INOUT bigint, ie_copiar_dt_fim_p text default 'S') AS $body$
DECLARE



	--contrato
se_w				smallint;
cd_cgc_contratado_w		varchar(255);
cd_cpf_contratado_w		varchar(255);
NR_SEq_contrato_w		bigint;
NR_SEQ_TIPO_CONTRATO_w		bigint;
DS_OBJETO_CONTRATO_w		varchar(1000);
IE_RENOVACAO_w			varchar(1);
DT_INICIO_w			timestamp;
DT_FIM_w			timestamp;
QT_DIAS_RESCISAO_w		integer;
IE_PRAZO_CONTRATO_w		varchar(1);
NM_CONTATO_w			varchar(40);
VL_TOTAL_CONTRATO_w		double precision;
DS_ATRIBUICAO_w			varchar(4000);
IE_PAGAR_RECEBER_w		varchar(1);
CD_PESSOA_NEGOC_w		bigint;
DT_REVISAO_w			timestamp;
CD_ESTABELECIMENTO_w		smallint;
IE_AVISA_VENCIMENTO_w		varchar(1);
QT_DIAS_AVISO_VENC_w		integer;
CD_CARGO_w			bigint;
DS_MOTIVO_RESCISAO_W		varchar(255);
NR_SEQ_FORMA_RESCISAO_w		bigint;
VL_MULTA_CONTRATUAL_w		double precision;
CD_SETOR_w			integer;
CD_CONDICAO_PAGAMENTO_w		bigint;
IE_AVISA_VENC_SETOR_w		varchar(1);
PR_MULTA_CONTRATUAL_w		double precision;
NR_SEQ_SUBTIPO_CONTRATO_w	bigint;
IE_CLASSIFICACAO_w		varchar(2);
NR_SEQ_ADITIVO_w		bigint;
DT_ATUALIZACAO_ADITIVO_w	timestamp;
NR_SEQ_CONTRATO_ATUAL_w		bigint;
QT_DIAS_INTERV_AVISO_w		bigint;
NR_SEQ_AREA_w			bigint;
NR_SEQ_INDICE_REAJUSTE_w	bigint;
IE_AVISA_REAJUSTE_w		varchar(1);
CD_OPERACAO_NF_w		bigint;
CD_NATUREZA_OPERACAO_w		bigint;
IE_EMAIL_ORIGEM_w		varchar(1);
QT_DIAS_REAJUSTE_w		bigint;
CD_PESSOA_CONTRATANTE_w contrato.cd_pessoa_contratante%type;
CD_CNPJ_CONTRATANTE_w	contrato.cd_cnpj_contratante%type;															

	--regra contrato
NR_SEQ_regra_con_w			bigint;
IE_FORMA_w			varchar(1);
DT_PRIMEIRO_VENCTO_w		timestamp;
IE_TIPO_VALOR_w			varchar(3);
VL_PAGTO_r_w			double precision;
CD_MOEDA_w			smallint;
CD_INDICE_REAJUSTE_w		smallint;
IE_PERIODO_REAJUSTE_w		varchar(3);
CD_CONTA_FINANC_w		bigint;
VL_IR_w				double precision;
VL_INSS_w			double precision;
VL_ISS_w			double precision;
DT_INICIO_VIGENCIA_r_w		timestamp;
DT_FINAL_VIGENCIA_r_w		timestamp;
DS_OBSERVACAO_r_w		varchar(255);
QT_INDICE_REAJUSTE_w		double precision;
DS_REF_INDICE_REAJUSTE_w	varchar(80);
DS_REGRA_VENCIMENTO_w		varchar(4000);
NR_SEQ_TRANS_FINANC_w		bigint;
NR_SEQ_TRANS_FIN_BAIXA_w	bigint;
IE_CENTRO_CONTRATO_w		varchar(1);
TX_DESC_ANTECIPACAO_w		double precision;
CD_CONTA_CONTABIL_r_w		varchar(20);
QT_AVISO_REAJUSTE_w		integer;
NR_SEQ_CRIT_RATEIO_r_w		bigint;
PR_DESC_FINANC_r_w		contrato_regra_pagto.pr_desc_financ%type;

	--etapa
nr_seq_etapa_s_w		bigint;
DS_ETAPA_w			varchar(80);
DT_PREVISTA_w			timestamp;
DT_REAL_w			timestamp;
DS_OBSERVACAO_e_w		varchar(255);
NR_SEQ_TIPO_ETAPA_w		bigint;


	--centro de custo
nr_seq_etapa_c_w		bigint;
CD_CENTRO_CUSTO_c_w		integer;
PR_ALOCACAO_w			real;
DS_OBSERVACAO_c_w		varchar(255);
QT_ALOCACAO_w			double precision;
VL_ALOCACAO_w			double precision;
DT_INICIO_VIGENCIA_CC_W	timestamp;
DT_FIM_VIGENCIA_CC_W		timestamp;

	--historico
nr_seq_etapa_h_w		bigint;
DT_HISTORICO_w			timestamp;
DS_HISTORICO_w			varchar(4000);
DS_TITULO_h_w			varchar(255);
IE_EFETIVADO_w			varchar(1);

	--renovacao
nr_seq_etapa_r_w		bigint;
DT_RENOVACAO_w			timestamp;
DS_OBSERVACAO_re_w		varchar(4000);
CD_PESSOA_FISICA_w 		varchar(10);
DS_TITULO_re_W			varchar(80);

	--texto
nr_seq_etapa_t_w		bigint;
NR_SEQUENCIA_t_w	        bigint;
DS_TITULO_t_w			varchar(150);

	-- regra doc
nr_seq_etapa_d_w		bigint;
DS_REGRA_w			varchar(80);
IE_REGRA_DIA_w 			varchar(1);
QT_DIA_MES_w			smallint;
DS_OBSERVACAO_d_w		varchar(255);
DT_ESPECIFICA_w 		timestamp;
IE_AVISA_VENCIMENTO_r_w		varchar(1);


	--regra nf itens
nr_seq_etapa_i_w		bigint;
CD_MATERIAL_w			integer;
CD_CONTA_CONTABIL_w		varchar(20);
CD_CENTRO_CUSTO_r_w		integer;
NR_SEQ_CRIT_RATEIO_w		bigint;
DS_COMPLEMENTO_w		varchar(255);
DS_OBSERVACAO_i_w		varchar(255);
NR_SEQ_CONTA_FINANC_w		bigint;
VL_PAGTO_w			double precision;
DT_INICIO_VIGENCIA_w		timestamp;
DT_FIM_VIGENCIA_w		timestamp;
PR_VARIACAO_VALOR_w		real;
QT_CONVERSAO_NF_w		real;
IE_CONVERSAO_Nf_w		varchar(1);
NR_SEQ_EQUIPAMENTO_w		bigint;
CD_ESTAB_REGRA_w		smallint;
CD_LOCAL_ESTOQUE_w		smallint;
DT_VENC_PAGTO_w			smallint;
QT_DIAS_ANTES_GERAR_SC_w	real;
IE_GERA_SC_AUTOMATICO_w		varchar(1);
IE_TIPO_REGRA_w			varchar(15);
CD_PESSOA_SOLICITANTE_w		varchar(10);
IE_LIBERA_SOLIC_w		varchar(1);
NR_SEQ_MARCA_w			bigint;
VL_SALDO_TOTAL_W		double precision;
ie_periodo_nf_w			varchar(15);
qt_maximo_nf_periodo_w		integer;
qt_dias_revisao_w		bigint;
nr_seq_regra_nf_w		CONTRATO_REGRA_NF.nr_sequencia%type;

	--clausula
nr_seq_etapa_l_w		bigint;
NR_SEQ_TIPO_w 			bigint;
NR_SEQUENCIA_l_w		bigint;
DS_TITULO_l_w			varchar(100);
ds_clausula_w			contrato_clausula.ds_clausula%type;
vl_desconto_w			contrato_regra_nf.vl_desconto%type;
pr_desconto_w			contrato_regra_nf.pr_desconto%type;
cd_paciente_soli_compra_w	contrato_regra_nf.cd_paciente_soli_compra%type;

--regra contrato
C01 CURSOR FOR
SELECT  IE_FORMA,
	DT_PRIMEIRO_VENCTO,
	IE_TIPO_VALOR,
	VL_PAGTO,
	CD_MOEDA,
	CD_INDICE_REAJUSTE,
	IE_PERIODO_REAJUSTE,
	CD_CONTA_FINANC,
	VL_IR,
	VL_INSS,
	VL_ISS,
	DT_INICIO_VIGENCIA,
	DT_FINAL_VIGENCIA,
	DS_OBSERVACAO,
	QT_INDICE_REAJUSTE,
	DS_REF_INDICE_REAJUSTE,
	DS_REGRA_VENCIMENTO,
	NR_SEQ_TRANS_FINANC,
	NR_SEQ_TRANS_FIN_BAIXA,
	IE_CENTRO_CONTRATO,
	TX_DESC_ANTECIPACAO,
	CD_CONTA_CONTABIL,
	QT_AVISO_REAJUSTE,
	NR_SEQ_CRIT_RATEIO,
	PR_DESC_FINANC
from	CONTRATO_REGRA_PAGTO
where	nr_seq_contrato = nr_seq_contrato_p;


--etapa
C02 CURSOR FOR
SELECT	DS_ETAPA,
	DT_PREVISTA,
	DT_REAL,
	DS_OBSERVACAO,
	NR_SEQ_TIPO_ETAPA
from	CONTRATO_ETAPA
where	nr_seq_contrato = nr_seq_contrato_p;

--centro custo
C03 CURSOR FOR
SELECT	CD_CENTRO_CUSTO,
	PR_ALOCACAO,
	DS_OBSERVACAO,
	QT_ALOCACAO,
	VL_ALOCACAO,
	DT_INICIO_VIGENCIA,
	DT_FIM_VIGENCIA
from	CONTRATO_CENTRO_CUSTO
where	nr_seq_contrato = nr_seq_contrato_p;

--historico
C04 CURSOR FOR
SELECT	DT_HISTORICO,
	DS_HISTORICO,
	DS_TITULO,
	IE_EFETIVADO
from	CONTRATO_HISTORICO
where	nr_seq_contrato = nr_seq_contrato_p;

--renovacao
C05 CURSOR FOR
SELECT	DT_RENOVACAO,
	DS_OBSERVACAO,
	CD_PESSOA_FISICA,
	DS_TITULO
from	CONTRATO_RENOVACAO
where	nr_seq_contrato = nr_seq_contrato_p;

--texto
C06 CURSOR FOR
SELECT	
        NR_SEQUENCIA,
        DS_TITULO
from	CONTRATO_TEXTO
where	nr_seq_contrato = nr_seq_contrato_p;

--regra doc
C07 CURSOR FOR
SELECT	DS_REGRA,
	IE_REGRA_DIA,
	QT_DIA_MES,
	DS_OBSERVACAO,
	DT_ESPECIFICA,
	IE_AVISA_VENCIMENTO
from	CONTRATO_REGRA_DOC
where	nr_seq_contrato = nr_seq_contrato_p;

--regra nf itens
C08 CURSOR FOR
SELECT	CD_MATERIAL,
	CD_CONTA_CONTABIL,
	CD_CENTRO_CUSTO,
	NR_SEQ_CRIT_RATEIO,
	DS_COMPLEMENTO,
	DS_OBSERVACAO,
	NR_SEQ_CONTA_FINANC,
	VL_PAGTO,
	DT_INICIO_VIGENCIA,
	DT_FIM_VIGENCIA,
	PR_VARIACAO_VALOR,
	QT_CONVERSAO_NF,
	IE_CONVERSAO_NF,
	NR_SEQ_EQUIPAMENTO,
	CD_ESTAB_REGRA,
	CD_LOCAL_ESTOQUE,
	DT_VENC_PAGTO,
	QT_DIAS_ANTES_GERAR_SC,
	IE_GERA_SC_AUTOMATICO,
	IE_TIPO_REGRA,
	CD_PESSOA_SOLICITANTE,
	IE_LIBERA_SOLIC,
	NR_SEQ_MARCA,
	VL_DESCONTO,
	PR_DESCONTO,
	CD_PACIENTE_SOLI_COMPRA,
	nr_sequencia
from	CONTRATO_REGRA_NF
where	nr_seq_contrato = nr_seq_contrato_p;

--clausula
C09 CURSOR FOR
SELECT	NR_SEQUENCIA,
	NR_SEQ_TIPO,
	DS_TITULO,
	ds_clausula
from	CONTRATO_CLAUSULA
where	nr_seq_contrato = nr_seq_contrato_p;


BEGIN


select	nextval('contrato_seq')
into STRICT	NR_SEq_contrato_w
;

SELECT CASE WHEN LENGTH(cd_cgc_cpf_p)=14 THEN  1  ELSE 2 END
into STRICT	se_w
;


if 	se_w = 1 then
	cd_cgc_contratado_w := cd_cgc_cpf_p;
	cd_cpf_contratado_w := null;
end if;

if 	se_w = 2 then
	cd_cpf_contratado_w := cd_cgc_cpf_p;
	cd_cgc_contratado_w := null;
end if;

select 	NR_SEQ_TIPO_CONTRATO,
	DS_OBJETO_CONTRATO,
	IE_RENOVACAO,
	DT_INICIO,
	DT_FIM,
	QT_DIAS_RESCISAO,
	IE_PRAZO_CONTRATO,
	VL_TOTAL_CONTRATO,
	DS_ATRIBUICAO,
	IE_PAGAR_RECEBER,
	CD_PESSOA_NEGOC,
	DT_REVISAO,
	CD_ESTABELECIMENTO,
	IE_AVISA_VENCIMENTO,
	QT_DIAS_AVISO_VENC,
	CD_CARGO,
	DS_MOTIVO_RESCISAO,
	NR_SEQ_FORMA_RESCISAO,
	VL_MULTA_CONTRATUAL,
	CD_SETOR,
	CD_CONDICAO_PAGAMENTO,
	IE_AVISA_VENC_SETOR,
	PR_MULTA_CONTRATUAL,
	NR_SEQ_SUBTIPO_CONTRATO,
	IE_CLASSIFICACAO,
	NR_SEQ_ADITIVO,
	DT_ATUALIZACAO_ADITIVO,
	NR_SEQ_CONTRATO_ATUAL,
	QT_DIAS_INTERV_AVISO,
	NR_SEQ_AREA,
	NR_SEQ_INDICE_REAJUSTE,
	IE_AVISA_REAJUSTE,
	CD_OPERACAO_NF,
	CD_NATUREZA_OPERACAO,
	IE_EMAIL_ORIGEM,
	QT_DIAS_REAJUSTE,
	coalesce(ie_periodo_nf,'N'),
	qt_maximo_nf_periodo,		
	qt_dias_revisao,
	cd_pessoa_contratante,
	cd_cnpj_contratante
into STRICT	NR_SEQ_TIPO_CONTRATO_w,
	DS_OBJETO_CONTRATO_w,
	IE_RENOVACAO_w,
	DT_INICIO_w,
	DT_FIM_w,
	QT_DIAS_RESCISAO_w,
	IE_PRAZO_CONTRATO_w,
	VL_TOTAL_CONTRATO_w,
	DS_ATRIBUICAO_w,
	IE_PAGAR_RECEBER_w,
	CD_PESSOA_NEGOC_w,
	DT_REVISAO_w,
	CD_ESTABELECIMENTO_w,
	IE_AVISA_VENCIMENTO_w,
	QT_DIAS_AVISO_VENC_w,
	CD_CARGO_w,
	DS_MOTIVO_RESCISAO_W,
	NR_SEQ_FORMA_RESCISAO_w,
	VL_MULTA_CONTRATUAL_w,
	CD_SETOR_w,
	CD_CONDICAO_PAGAMENTO_w,
	IE_AVISA_VENC_SETOR_w,
	PR_MULTA_CONTRATUAL_w,
	NR_SEQ_SUBTIPO_CONTRATO_w,
	IE_CLASSIFICACAO_w,
	NR_SEQ_ADITIVO_w,
	DT_ATUALIZACAO_ADITIVO_w,
	NR_SEQ_CONTRATO_ATUAL_w,
	QT_DIAS_INTERV_AVISO_w,
	NR_SEQ_AREA_w,
	NR_SEQ_INDICE_REAJUSTE_w,
	IE_AVISA_REAJUSTE_w,
	CD_OPERACAO_NF_w,
	CD_NATUREZA_OPERACAO_w,
	IE_EMAIL_ORIGEM_w,
	QT_DIAS_REAJUSTE_w,
	ie_periodo_nf_w,
	qt_maximo_nf_periodo_w,
	qt_dias_revisao_w,
	CD_PESSOA_CONTRATANTE_w,
	CD_CNPJ_CONTRATANTE_w	
from 	contrato
where	nr_sequencia = nr_seq_contrato_p;


insert into	contrato( NR_SEQUENCIA,
		DT_ATUALIZACAO,
		NM_USUARIO,
		NR_SEQ_TIPO_CONTRATO,
		DS_OBJETO_CONTRATO,
		IE_RENOVACAO,
		DT_INICIO,
		DT_FIM,
		QT_DIAS_RESCISAO,
		IE_PRAZO_CONTRATO,
		VL_TOTAL_CONTRATO,
		DS_ATRIBUICAO,
		IE_PAGAR_RECEBER,
		CD_PESSOA_NEGOC,
		DT_REVISAO,
		CD_ESTABELECIMENTO,
		IE_AVISA_VENCIMENTO,
		QT_DIAS_AVISO_VENC,
		CD_CARGO,
		DS_MOTIVO_RESCISAO,
		NR_SEQ_FORMA_RESCISAO,
		VL_MULTA_CONTRATUAL,
		CD_SETOR,
		CD_CONDICAO_PAGAMENTO,
		IE_AVISA_VENC_SETOR,
		PR_MULTA_CONTRATUAL,
		NR_SEQ_SUBTIPO_CONTRATO,
		IE_CLASSIFICACAO,
		NR_SEQ_ADITIVO,
		DT_ATUALIZACAO_ADITIVO,
		NR_SEQ_CONTRATO_ATUAL,
		QT_DIAS_INTERV_AVISO,
		NR_SEQ_AREA,
		NR_SEQ_INDICE_REAJUSTE,
		IE_AVISA_REAJUSTE,
		CD_OPERACAO_NF,
		CD_NATUREZA_OPERACAO,
		IE_EMAIL_ORIGEM,
		QT_DIAS_REAJUSTE,
		CD_CGC_CONTRATADO,
		CD_PESSOA_CONTRATADA,
		ie_situacao,
		ie_periodo_nf,
		qt_maximo_nf_periodo,
		qt_dias_revisao,
		cd_pessoa_contratante,
		cd_cnpj_contratante)
values (nr_seq_contrato_w,
		clock_timestamp(),
		nm_usuario_p,
		NR_SEQ_TIPO_CONTRATO_w,
		DS_OBJETO_CONTRATO_w,
		IE_RENOVACAO_w,
		DT_INICIO_w,
		DT_FIM_w,
		QT_DIAS_RESCISAO_w,
		IE_PRAZO_CONTRATO_w,
		VL_TOTAL_CONTRATO_w,
		DS_ATRIBUICAO_w,
		IE_PAGAR_RECEBER_w,
		CD_PESSOA_NEGOC_w,
		DT_REVISAO_w,
		CD_ESTABELECIMENTO_w,
		IE_AVISA_VENCIMENTO_w,
		QT_DIAS_AVISO_VENC_w,
		CD_CARGO_w,
		DS_MOTIVO_RESCISAO_W,
		NR_SEQ_FORMA_RESCISAO_w,
		VL_MULTA_CONTRATUAL_w,
		CD_SETOR_w,
		CD_CONDICAO_PAGAMENTO_w,
		IE_AVISA_VENC_SETOR_w,
		PR_MULTA_CONTRATUAL_w,
		NR_SEQ_SUBTIPO_CONTRATO_w,
		IE_CLASSIFICACAO_w,
		NR_SEQ_ADITIVO_w,
		DT_ATUALIZACAO_ADITIVO_w,
		NR_SEQ_CONTRATO_ATUAL_w,
		QT_DIAS_INTERV_AVISO_w,
		NR_SEQ_AREA_w,
		NR_SEQ_INDICE_REAJUSTE_w,
		IE_AVISA_REAJUSTE_w,
		CD_OPERACAO_NF_w,
		CD_NATUREZA_OPERACAO_w,
		IE_EMAIL_ORIGEM_w,
		QT_DIAS_REAJUSTE_w,
		cd_cgc_contratado_w,
		cd_cpf_contratado_w,
		'A',
		ie_periodo_nf_w,
		qt_maximo_nf_periodo_w,
		qt_dias_revisao_w,
		CD_PESSOA_CONTRATANTE_w,
		CD_CNPJ_CONTRATANTE_w);

OPEN C01;
LOOP
FETCH C01 into
	IE_FORMA_w,
	DT_PRIMEIRO_VENCTO_w,
	IE_TIPO_VALOR_w,
	VL_PAGTO_r_w,
	CD_MOEDA_w,
	CD_INDICE_REAJUSTE_w,
	IE_PERIODO_REAJUSTE_w,
	CD_CONTA_FINANC_w,
	VL_IR_w,
	VL_INSS_w,
	VL_ISS_w,
	DT_INICIO_VIGENCIA_r_w,
	DT_FINAL_VIGENCIA_r_w,
	DS_OBSERVACAO_r_w,
	QT_INDICE_REAJUSTE_w,
	DS_REF_INDICE_REAJUSTE_w,
	DS_REGRA_VENCIMENTO_w,
	NR_SEQ_TRANS_FINANC_w,
	NR_SEQ_TRANS_FIN_BAIXA_w,
	IE_CENTRO_CONTRATO_w,
	TX_DESC_ANTECIPACAO_w,
	CD_CONTA_CONTABIL_r_w,
	QT_AVISO_REAJUSTE_w,
	NR_SEQ_CRIT_RATEIO_r_w,
	PR_DESC_FINANC_r_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin
	select 	nextval('contrato_regra_pagto_seq')
	into STRICT	NR_SEq_regra_con_w
	;
	
	if (coalesce(ie_copiar_dt_fim_p,'S') = 'N') then
		dt_final_vigencia_r_w := null;
	end if;
	
	insert into CONTRATO_REGRA_PAGTO(nr_sequencia,
		DT_ATUALIZACAO,
		NM_USUARIO,
		nr_seq_contrato,
		IE_FORMA,
		DT_PRIMEIRO_VENCTO,
		IE_TIPO_VALOR,
		VL_PAGTO,
		CD_MOEDA,
		CD_INDICE_REAJUSTE,
		IE_PERIODO_REAJUSTE,
		CD_CONTA_FINANC,
		VL_IR,
		VL_INSS,
		VL_ISS,
		DT_INICIO_VIGENCIA,
		DT_FINAL_VIGENCIA,
		DS_OBSERVACAO,
		QT_INDICE_REAJUSTE,
		DS_REF_INDICE_REAJUSTE,
		DS_REGRA_VENCIMENTO,
		NR_SEQ_TRANS_FINANC,
		NR_SEQ_TRANS_FIN_BAIXA,
		IE_CENTRO_CONTRATO,
		TX_DESC_ANTECIPACAO,
		CD_CONTA_CONTABIL,
		QT_AVISO_REAJUSTE,
		NR_SEQ_CRIT_RATEIO,
		PR_DESC_FINANC
		)
	values (
		NR_SEq_regra_con_w,
		clock_timestamp(),
		nm_usuario_p,
		NR_SEq_contrato_w,
		IE_FORMA_w,
		DT_PRIMEIRO_VENCTO_w,
		IE_TIPO_VALOR_w,
		VL_PAGTO_r_w,
		CD_MOEDA_w,
		CD_INDICE_REAJUSTE_w,
		IE_PERIODO_REAJUSTE_w,
		CD_CONTA_FINANC_w,
		VL_IR_w,
		VL_INSS_w,
		VL_ISS_w,
		DT_INICIO_VIGENCIA_r_w,
		DT_FINAL_VIGENCIA_r_w,
		DS_OBSERVACAO_r_w,
		QT_INDICE_REAJUSTE_w,
		DS_REF_INDICE_REAJUSTE_w,
		DS_REGRA_VENCIMENTO_w,
		NR_SEQ_TRANS_FINANC_w,
		NR_SEQ_TRANS_FIN_BAIXA_w,
		IE_CENTRO_CONTRATO_w,
		TX_DESC_ANTECIPACAO_w,
		CD_CONTA_CONTABIL_r_w,
		QT_AVISO_REAJUSTE_w,
		NR_SEQ_CRIT_RATEIO_r_w,
		PR_DESC_FINANC_r_w);
	end;
END LOOP;
close c01;


OPEN C02;
LOOP
FETCH C02 into
	DS_ETAPA_w,
	DT_PREVISTA_w,
	DT_REAL_w,
	DS_OBSERVACAO_e_w,
	NR_SEQ_TIPO_ETAPA_w;
EXIT WHEN NOT FOUND; /* apply on C02 */
	begin
	select	nextval('contrato_etapa_seq')
	into STRICT	nr_seq_etapa_s_w
	;
	insert into CONTRATO_ETAPA(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		NR_SEq_contrato,
		DS_ETAPA,
		DT_PREVISTA,
		DT_REAL,
		DS_OBSERVACAO,
		NR_SEQ_TIPO_ETAPA)
	values (
		nr_seq_etapa_s_w,
		clock_timestamp(),
		nm_usuario_p,
		NR_SEq_contrato_w,
		DS_ETAPA_w,
		DT_PREVISTA_w,
		DT_REAL_w,
		DS_OBSERVACAO_e_w,
		NR_SEQ_TIPO_ETAPA_w);
	end;
END LOOP;
close c02;


OPEN C03;
LOOP
FETCH C03 into
	CD_CENTRO_CUSTO_c_w,
	PR_ALOCACAO_w,
	DS_OBSERVACAO_c_w,
	QT_ALOCACAO_w,
	VL_ALOCACAO_w,
	DT_INICIO_VIGENCIA_CC_W,
	DT_FIM_VIGENCIA_CC_W;
EXIT WHEN NOT FOUND; /* apply on C03 */
	begin
	select	nextval('contrato_centro_custo_seq')
	into STRICT	nr_seq_etapa_c_w
	;
	insert into CONTRATO_CENTRO_CUSTO(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		NR_SEq_contrato,
		CD_CENTRO_CUSTO,
		PR_ALOCACAO,
		DS_OBSERVACAO,
		QT_ALOCACAO,
		VL_ALOCACAO,
		DT_INICIO_VIGENCIA,
		DT_FIM_VIGENCIA)
	values (
		nr_seq_etapa_c_w,
		clock_timestamp(),
		nm_usuario_p,
		NR_SEq_contrato_w,
		CD_CENTRO_CUSTO_c_w,
		PR_ALOCACAO_w,
		DS_OBSERVACAO_c_w,
		QT_ALOCACAO_w,
		VL_ALOCACAO_w,
		DT_INICIO_VIGENCIA_CC_W,
		DT_FIM_VIGENCIA_CC_W);
	end;
END LOOP;
close c03;

OPEN C04;
LOOP
FETCH C04 into
	DT_HISTORICO_w,
	DS_HISTORICO_w,
	DS_TITULO_h_w,
	IE_EFETIVADO_w;
EXIT WHEN NOT FOUND; /* apply on C04 */
	begin
	select	nextval('contrato_historico_seq')
	into STRICT	nr_seq_etapa_h_w
	;
	insert into CONTRATO_HISTORICO(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		NR_SEq_contrato,
		DT_HISTORICO,
		DS_HISTORICO,
		DS_TITULO,
		IE_EFETIVADO
		)
	values (
		nr_seq_etapa_h_w,
		clock_timestamp(),
		nm_usuario_p,
		NR_SEq_contrato_w,
		DT_HISTORICO_w,
		DS_HISTORICO_w,
		DS_TITULO_h_w,
		IE_EFETIVADO_w);
	end;
END LOOP;
close c04;

OPEN C05;
LOOP
FETCH C05 into
	DT_RENOVACAO_w,
	DS_OBSERVACAO_re_w,
	CD_PESSOA_FISICA_w,
	DS_TITULO_re_w;
EXIT WHEN NOT FOUND; /* apply on C05 */
	begin
	select	nextval('contrato_renovacao_seq')
	into STRICT	nr_seq_etapa_r_w
	;
	insert into CONTRATO_renovacao(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		NR_SEq_contrato,
		DT_RENOVACAO,
		DS_OBSERVACAO,
		CD_PESSOA_FISICA,
		DS_TITULO
		)
	values (
		nr_seq_etapa_r_w,
		clock_timestamp(),
		nm_usuario_p,
		NR_SEq_contrato_w,
		DT_RENOVACAO_w,
		DS_OBSERVACAO_re_w,
		CD_PESSOA_FISICA_w,
		DS_TITULO_re_w);
	end;
END LOOP;
close c05;

OPEN C06;
LOOP
FETCH C06 into
        NR_SEQUENCIA_t_w,
	DS_TITULO_t_w;
EXIT WHEN NOT FOUND; /* apply on C06 */
	begin
	select	nextval('contrato_texto_seq')
	into STRICT	nr_seq_etapa_t_w
	;
	insert into CONTRATO_TEXTO(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		NR_SEq_contrato,
		DS_TITULO,
		DS_CONTRATO
		)
	values (
		nr_seq_etapa_t_w,
		clock_timestamp(),
		nm_usuario_p,
		NR_SEq_contrato_w,
		DS_TITULO_t_w,
		' ');
	end;

END LOOP;
close c06;

OPEN C07;
LOOP
FETCH C07 into
	DS_REGRA_w,
	IE_REGRA_DIA_w,
	QT_DIA_MES_w,
	DS_OBSERVACAO_d_w,
	DT_ESPECIFICA_w,
	IE_AVISA_VENCIMENTO_r_w;
EXIT WHEN NOT FOUND; /* apply on C07 */
	begin
	select	nextval('contrato_regra_doc_seq')
	into STRICT	nr_seq_etapa_d_w
	;
	insert into CONTRATO_REGRA_DOC(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		NR_SEq_contrato,
		DS_REGRA,
		IE_REGRA_DIA,
		QT_DIA_MES,
		DS_OBSERVACAO,
		DT_ESPECIFICA,
		IE_AVISA_VENCIMENTO
		)
	values (
		nr_seq_etapa_d_w,
		clock_timestamp(),
		nm_usuario_p,
		NR_seq_contrato_w,
		DS_REGRA_w,
		IE_REGRA_DIA_w,
		QT_DIA_MES_w,
		DS_OBSERVACAO_d_w,
		DT_ESPECIFICA_w,
		IE_AVISA_VENCIMENTO_r_w);
	end;
END LOOP;
close c07;


OPEN C08;
LOOP
FETCH C08 into
	CD_MATERIAL_w,
	CD_CONTA_CONTABIL_w,
	CD_CENTRO_CUSTO_r_w,
	NR_SEQ_CRIT_RATEIO_w,
	DS_COMPLEMENTO_w,
	DS_OBSERVACAO_i_w,
	NR_SEQ_CONTA_FINANC_w,
	VL_PAGTO_w,
	DT_INICIO_VIGENCIA_w,
	DT_FIM_VIGENCIA_w,
	PR_VARIACAO_VALOR_w,
	QT_CONVERSAO_NF_w,
	IE_CONVERSAO_Nf_w,
	NR_SEQ_EQUIPAMENTO_w,
	CD_ESTAB_REGRA_w,
	CD_LOCAL_ESTOQUE_w,
	DT_VENC_PAGTO_w,
	QT_DIAS_ANTES_GERAR_SC_w,
	IE_GERA_SC_AUTOMATICO_w,
	IE_TIPO_REGRA_w,
	CD_PESSOA_SOLICITANTE_w,
	IE_LIBERA_SOLIC_w,
	NR_SEQ_MARCA_w,
	VL_DESCONTO_W,
	PR_DESCONTO_W,
	CD_PACIENTE_SOLI_COMPRA_W,
	nr_seq_regra_nf_w;
EXIT WHEN NOT FOUND; /* apply on C08 */
	begin
	select	nextval('contrato_regra_nf_seq')
	into STRICT	nr_seq_etapa_i_w
	;
	insert into CONTRATO_REGRA_NF(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		NR_SEq_contrato,
		CD_MATERIAL,
		CD_CONTA_CONTABIL,
		CD_CENTRO_CUSTO,
		NR_SEQ_CRIT_RATEIO,
		DS_COMPLEMENTO,
		DS_OBSERVACAO,
		NR_SEQ_CONTA_FINANC,
		VL_PAGTO,
		DT_INICIO_VIGENCIA,
		DT_FIM_VIGENCIA,
		PR_VARIACAO_VALOR,
		QT_CONVERSAO_NF,
		IE_CONVERSAO_NF,
		NR_SEQ_EQUIPAMENTO,
		CD_ESTAB_REGRA,
		CD_LOCAL_ESTOQUE,
		DT_VENC_PAGTO,
		QT_DIAS_ANTES_GERAR_SC,
		IE_GERA_SC_AUTOMATICO,
		IE_TIPO_REGRA,
		CD_PESSOA_SOLICITANTE,
		IE_LIBERA_SOLIC,
		NR_SEQ_MARCA,
		VL_SALDO_TOTAL,
		VL_DESCONTO,
		PR_DESCONTO,
		CD_PACIENTE_SOLI_COMPRA)
	values (
		nr_seq_etapa_i_w,
		clock_timestamp(),
		nm_usuario_p,
		NR_SEq_contrato_w,
		CD_MATERIAL_w,
		CD_CONTA_CONTABIL_w,
		CD_CENTRO_CUSTO_r_w,
		NR_SEQ_CRIT_RATEIO_w,
		DS_COMPLEMENTO_w,
		DS_OBSERVACAO_i_w,
		NR_SEQ_CONTA_FINANC_w,
		VL_PAGTO_w,
		DT_INICIO_VIGENCIA_w,
		DT_FIM_VIGENCIA_w,
		PR_VARIACAO_VALOR_w,
		QT_CONVERSAO_NF_w,
		IE_CONVERSAO_Nf_w,
		NR_SEQ_EQUIPAMENTO_w,
		CD_ESTAB_REGRA_w,
		CD_LOCAL_ESTOQUE_w,
		DT_VENC_PAGTO_w,
		QT_DIAS_ANTES_GERAR_SC_w,
		IE_GERA_SC_AUTOMATICO_w,
		IE_TIPO_REGRA_w,
		CD_PESSOA_SOLICITANTE_w,
		IE_LIBERA_SOLIC_w,
		NR_SEQ_MARCA_w,
		VL_SALDO_TOTAL_W,
		VL_DESCONTO_W,
		PR_DESCONTO_W,
		CD_PACIENTE_SOLI_COMPRA_W);
	end;
	
	if (nr_seq_regra_nf_w IS NOT NULL AND nr_seq_regra_nf_w::text <> '') and (coalesce(cd_estab_regra_w,0) > 0) then
		insert into contrato_regra_nf_estab(nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_regra_nf,
			cd_estab_regra)
		SELECT	nextval('contrato_regra_nf_estab_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_etapa_i_w,
			cd_estab_regra
		from	contrato_regra_nf_estab
		where	nr_seq_regra_nf = nr_seq_regra_nf_w;
	end if;	
END LOOP;
close c08;

OPEN C09;
LOOP
FETCH C09 into
	NR_SEQUENCIA_l_w,
	NR_SEQ_TIPO_w,
	DS_TITULO_L_w,
	ds_clausula_w;
EXIT WHEN NOT FOUND; /* apply on C09 */
	begin
	select	nextval('contrato_clausula_seq')
	into STRICT	nr_seq_etapa_l_w
	;
	insert into CONTRATO_CLAUSULA(
		nr_sequencia,
		dt_atualizacao,
		dt_atualizacao_nrec,
		nm_usuario,
		nm_usuario_nrec,
		NR_SEq_contrato,
		NR_SEQ_TIPO,
		DS_TITULO,
		DS_CLAUSULA
		)
	values (
		nr_seq_etapa_l_w,
		clock_timestamp(),
		clock_timestamp(),
		nm_usuario_p,
		nm_usuario_p,
		NR_SEq_contrato_w,
		NR_SEQ_TIPO_w,
		DS_TITULO_L_w,
		ds_clausula_w);
	end;
END LOOP;
close c09;

commit;

copia_campo_long_de_para_Java(	'CONTRATO_TEXTO',
				'DS_CONTRATO',
				' where	nr_sequencia = :nr_sequencia',
				'nr_sequencia='||NR_SEQUENCIA_t_w,
				'CONTRATO_TEXTO',
				'DS_CONTRATO',
				' where	nr_sequencia = :nr_sequencia',
				'nr_sequencia='||nr_seq_etapa_t_w,
				'L');	

commit;

copia_campo_long_de_para_Java(	'CONTRATO_CLAUSULA',
				'DS_CLAUSULA',
				' where	nr_sequencia = :nr_sequencia',
				'nr_sequencia='||NR_SEQUENCIA_l_w,
				'CONTRATO_CLAUSULA',
				'DS_CLAUSULA',
				' where	nr_sequencia = :nr_sequencia',
				'nr_sequencia='||nr_seq_etapa_l_w,
				'L');	
commit;

nr_sequencia_p	:= NR_SEq_contrato_w;
				
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_contrato ( nr_seq_contrato_p bigint, nm_usuario_p text, cd_cgc_cpf_p text, cd_estab_p bigint, nr_sequencia_p INOUT bigint, ie_copiar_dt_fim_p text default 'S') FROM PUBLIC;

