-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_dados_prestador_prev_web (nr_seq_prestador_p INOUT bigint, cd_prestador_p INOUT text, nm_prestador_p INOUT text) AS $body$
DECLARE

 
nm_prestador_w		varchar(255);
cd_prestador_w		varchar(30);
nr_seq_prestador_w	bigint;
cd_cgc_w		varchar(50);
cd_pessoa_fisica_w	varchar(10);


BEGIN 
 
nr_seq_prestador_w 	:= nr_seq_prestador_p;
cd_prestador_w		:= cd_prestador_p;
 
if (coalesce(nr_seq_prestador_w::text, '') = '' and (cd_prestador_w IS NOT NULL AND cd_prestador_w::text <> '')) then 
	select	max(a.nr_sequencia) 
	into STRICT	nr_seq_prestador_w 
	from	pls_prestador a, 
		pls_regra_prest_previsto b 
	where	a.nr_sequencia 	= b.nr_seq_prestador 
	and	a.cd_prestador 	= cd_prestador_w 
	and	b.ie_situacao 	= 'A' 
	and	a.ie_situacao	= 'A' 
	and (coalesce(a.dt_exclusao::text, '') = '' 
	or 	a.dt_exclusao 	> clock_timestamp());
end if;
 
if (nr_seq_prestador_w IS NOT NULL AND nr_seq_prestador_w::text <> '') then 
	begin 
		select	a.cd_cgc, 
			a.cd_pessoa_fisica, 
			a.cd_prestador, 
			a.nm_interno 
		into STRICT	cd_cgc_w, 
			cd_pessoa_fisica_w, 
			cd_prestador_w, 
			nm_prestador_w 
		from	pls_prestador a, 
			pls_regra_prest_previsto b 
		where	a.nr_sequencia 	= b.nr_seq_prestador 
		and	a.nr_sequencia 	= nr_seq_prestador_w 
		and	b.ie_situacao 	= 'A' 
		and	a.ie_situacao 	= 'A' 
		and (coalesce(a.dt_exclusao::text, '') = '' 
		or 	a.dt_exclusao 	> clock_timestamp());
	exception 
	when others then 
		cd_cgc_w 		:= null;
		cd_pessoa_fisica_w 	:= null;
		cd_prestador_w 		:= null;
		nr_seq_prestador_w 	:= null;
		nm_prestador_w 		:= null;
	end;
 
	if ((nr_seq_prestador_w IS NOT NULL AND nr_seq_prestador_w::text <> '') and coalesce(nm_prestador_w::text, '') = '') then 
		if (cd_cgc_w IS NOT NULL AND cd_cgc_w::text <> '') then 
			select	ds_razao_social 
			into STRICT	nm_prestador_w 
			from	pessoa_juridica 
			where	cd_cgc	= cd_cgc_w;
		elsif (cd_pessoa_fisica_w IS NOT NULL AND cd_pessoa_fisica_w::text <> '')	then 
			select	SUBSTR(OBTER_NOME_PF(CD_PESSOA_FISICA),0,255) 
			into STRICT	nm_prestador_w 
			from	pessoa_fisica 
			where	cd_pessoa_fisica	= cd_pessoa_fisica_w;
		end if;
	end if;
end if;
 
nr_seq_prestador_p 	:= nr_seq_prestador_w;
cd_prestador_p 		:= cd_prestador_w;
nm_prestador_p 		:= nm_prestador_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_dados_prestador_prev_web (nr_seq_prestador_p INOUT bigint, cd_prestador_p INOUT text, nm_prestador_p INOUT text) FROM PUBLIC;

