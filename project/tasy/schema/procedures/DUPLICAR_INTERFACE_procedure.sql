-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_interface (cd_interface_p bigint, cd_tipo_interface_p text, nm_usuario_p text) AS $body$
DECLARE


cd_interface_w		integer;


BEGIN

select (coalesce(max(cd_interface),0)+1)
into STRICT	cd_interface_w
from 	interface;

delete from interface_reg
where cd_interface	= cd_interface_w;

delete from interface_atributo
where cd_interface	= cd_interface_w;

insert into interface(
		cd_interface,
		ds_interface,
		nm_arquivo_saida,
		dt_atualizacao,
		nm_usuario,
		ie_implantar,
		cd_tipo_interface,
		ds_comando)
	SELECT	cd_interface_w,
		'Copia ' || ds_interface,
		nm_arquivo_saida,
		clock_timestamp(),
		nm_usuario_p,
		ie_implantar,
		cd_tipo_interface_p,
		ds_comando
	from	interface
	where	cd_interface = cd_interface_p;

insert into interface_reg(
		cd_interface,
		cd_reg_interface,
		ds_reg_interface,
		ie_separador_reg,
		ie_formato_reg,
		dt_atualizacao,
		nm_usuario,
		ie_registro,
		ie_tipo_registro)
	SELECT	cd_interface_w,
		cd_reg_interface,
		ds_reg_interface,
		ie_separador_reg,
		ie_formato_reg,
		clock_timestamp(),
		nm_usuario_p,
		ie_registro,
		ie_tipo_registro
	from	interface_reg
	where	cd_interface = cd_interface_p;

insert into interface_atributo(
		cd_interface,
		cd_reg_interface,
		nr_seq_atributo,
		nm_tabela,
		nm_atributo,
		ie_tipo_atributo,
		qt_tamanho,
		dt_atualizacao,
		nm_usuario,
		qt_decimais,
		ds_mascara_data,
		ds_valor,
		qt_posicao_inicial,
		ie_importa_tabela,
		ds_regra_validacao,
		ie_identifica_erro,
		ie_exporta,
		ie_tipo_campo,
		ie_conversao)
	SELECT	cd_interface_w,
		cd_reg_interface,
		nr_seq_atributo,
		nm_tabela,
		nm_atributo,
		ie_tipo_atributo,
		qt_tamanho,
		clock_timestamp(),
		nm_usuario_p,
		qt_decimais,
		ds_mascara_data,
		ds_valor,
		qt_posicao_inicial,
		ie_importa_tabela,
		ds_regra_validacao,
		ie_identifica_erro,
		ie_exporta,
		ie_tipo_campo,
		ie_conversao
	from	interface_atributo
	where	cd_interface = cd_interface_p;
		
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_interface (cd_interface_p bigint, cd_tipo_interface_p text, nm_usuario_p text) FROM PUBLIC;

