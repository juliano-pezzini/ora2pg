-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE importar_pj ( cd_cgc_p text, ds_razao_social_p text, nm_fantasia_p text, cd_cep_p text, ds_endereco_p text, ds_bairro_p text, ds_municipio_p text, sg_estado_p text, nm_usuario_p text, ds_complemento_p text, nr_telefone_p text, nr_endereco_p text, nr_fax_p text, ds_email_p text, nm_pessoa_contato_p text, nr_ramal_contato_p bigint, nr_inscricao_estadual_p text, cd_tipo_pessoa_p bigint, cd_conta_contabil_p text, ie_prod_fabric_p text, ds_site_internet_p text, ds_nome_abrev_p text, ie_situacao_p text, ds_senha_p text, cd_pf_resp_tecnico_p text, nr_alvara_sanitario_p text, nr_autor_func_p text, nr_inscricao_municipal_p text, cd_ans_p text, cd_referencia_fornec_p text, dt_validade_alvara_sanit_p timestamp, dt_validade_autor_func_p timestamp, ie_alterar_senha_p text, nr_seq_pais_p bigint, cd_portador_p bigint, cd_tipo_portador_p bigint, cd_internacional_p text, cd_cnes_p text, cd_municipio_ibge_p text, nr_seq_tipo_logradouro_p bigint, ie_status_exportar_p text, dt_integracao_externa_p timestamp, ie_tipo_tributacao_p text, nr_certificado_boas_prat_p text, nr_alvara_sanitario_munic_p text, dt_validade_alvara_munic_p timestamp, dt_validade_cert_boas_prat_p timestamp, dt_validade_resp_tecnico_p timestamp, nr_ddi_telefone_p text, nr_ddd_telefone_p text, nr_ddi_fax_p text, nr_ddd_fax_p text, nr_registro_pls_p text) AS $body$
DECLARE


/*

	SG_ESTADO			AC - Acre
					AL - Alagoas
					AM - Amazonas
					AP - Amapá
					BA - Bahia
					CE - Ceará
					DF - Distrito Federal
					ES - Espirito Santo
					GO - Goiás
					IN - Outros(Internacional)
					MA - Maranhão
					MG - Minas Gerais
					MS - Mato Grosso do Sul
					MT - Mato Grosso
					PA - Pará
					PB - Paraiba
					PE - Pernambuco
					PI - Piauí
					PR - Paraná
					RJ - Rio de Janeiro
					RN - Rio Grande do Norte
					RO - Rondonia
					RR - Roraima
					RS - Rio Grande do Sul
					SC - Santa Catarina
					SE - Sergipe
					SP - São Paulo
					TO - Tocantins

	CD_TIPO_PORTADOR		0 - Carteira
					1 - Banco
					2 - Empresa de Cobrança
					3 - Advogado/Jurídico
					4 - Cartório
					5 - Cartão de Crédito
					6 - Adm financeira

	IE_STATUS_EXPORTAR		0 - Aguardando envio ao ME
					1 - Enviado ao ME

	IE_TIPO_TRIBUTACAO		0 - Super Simples
					1 - Micro empresa
					2 - Pequeno porte
*/
qt_sg_estado_w			bigint;
qt_cd_tipo_portador_w		bigint;
qt_ie_status_exportar_w		bigint;
qt_ie_tipo_tributacao_w		bigint;
cd_cgc_w			varchar(14);



BEGIN

select	count(b.vl_dominio)
into STRICT	qt_sg_estado_w
from	dominio a,
	valor_dominio b
where	a.cd_dominio	= b.cd_dominio
and	a.cd_dominio	= 50
and	b.vl_dominio	= sg_estado_p;

if (cd_tipo_portador_p IS NOT NULL AND cd_tipo_portador_p::text <> '') then
	select	count(b.vl_dominio)
	into STRICT	qt_cd_tipo_portador_w
	from	dominio a,
		valor_dominio b
	where	a.cd_dominio	= b.cd_dominio
	and	a.cd_dominio	= 703
	and	b.vl_dominio	= cd_tipo_portador_p;
else
	qt_cd_tipo_portador_w := 1;
end if;

if (ie_status_exportar_p IS NOT NULL AND ie_status_exportar_p::text <> '') then
	select	count(b.vl_dominio)
	into STRICT	qt_ie_status_exportar_w
	from	dominio a,
		valor_dominio b
	where	a.cd_dominio	= b.cd_dominio
	and	a.cd_dominio	= 1863
	and	b.vl_dominio	= ie_status_exportar_p;
else
	qt_ie_status_exportar_w := 1;
end if;

if (ie_tipo_tributacao_p IS NOT NULL AND ie_tipo_tributacao_p::text <> '') then
	select	count(b.vl_dominio)
	into STRICT	qt_ie_tipo_tributacao_w
	from	dominio a,
		valor_dominio b
	where	a.cd_dominio	= b.cd_dominio
	and	a.cd_dominio	= 1966
	and	b.vl_dominio	= ie_tipo_tributacao_p;
else
	qt_ie_tipo_tributacao_w := 1;
end if;

select	max(cd_cgc)
into STRICT	cd_cgc_w
from	pessoa_juridica
where	cd_cgc	= cd_cgc_p;

if (coalesce(cd_cgc_w::text, '') = '')	then
	if (ds_razao_social_p IS NOT NULL AND ds_razao_social_p::text <> '')	and (nm_fantasia_p IS NOT NULL AND nm_fantasia_p::text <> '')	and (cd_cep_p IS NOT NULL AND cd_cep_p::text <> '')	and (ds_endereco_p IS NOT NULL AND ds_endereco_p::text <> '')	and (ds_municipio_p IS NOT NULL AND ds_municipio_p::text <> '')	and (cd_tipo_pessoa_p IS NOT NULL AND cd_tipo_pessoa_p::text <> '')	and (ie_prod_fabric_p IS NOT NULL AND ie_prod_fabric_p::text <> '')	and (ie_situacao_p IS NOT NULL AND ie_situacao_p::text <> '')	then
		if (qt_sg_estado_w			= 1)	and (qt_cd_tipo_portador_w		= 1)	and (qt_ie_status_exportar_w	= 1)	and (qt_ie_tipo_tributacao_w	= 1)	Then

			select	somente_numero(cd_cgc_p)
			into STRICT	cd_cgc_w
			;

			Begin
			insert into pessoa_juridica(
				cd_cgc,
				ds_razao_social,
				nm_fantasia,
				cd_cep,
				ds_endereco,
				ds_bairro,
				ds_municipio,
				sg_estado,
				dt_atualizacao,
				nm_usuario,
				ds_complemento,
				nr_telefone,
				nr_endereco,
				nr_fax,
				ds_email,
				nm_pessoa_contato,
				nr_ramal_contato,
				nr_inscricao_estadual,
				cd_tipo_pessoa,
				cd_conta_contabil,
				ie_prod_fabric,
				ds_site_internet,
				ds_nome_abrev,
				ie_situacao,
				ds_senha,
				cd_pf_resp_tecnico,
				nr_alvara_sanitario,
				nr_autor_func,
				nr_inscricao_municipal,
				cd_ans,
				cd_referencia_fornec,
				dt_validade_alvara_sanit,
				dt_validade_autor_func,
				dt_atualizacao_nrec,
				nm_usuario_nrec,
				ie_alterar_senha,
				nr_seq_pais,
				cd_portador,
				cd_tipo_portador,
				cd_internacional,
				cd_cnes,
				cd_municipio_ibge,
				nr_seq_tipo_logradouro,
				ie_status_exportar,
				dt_integracao_externa,
				ie_tipo_tributacao,
				nr_certificado_boas_prat,
				nr_alvara_sanitario_munic,
				dt_validade_alvara_munic,
				dt_validade_cert_boas_prat,
				dt_validade_resp_tecnico,
				nr_ddi_telefone,
				nr_ddd_telefone,
				nr_ddi_fax,
				nr_ddd_fax,
				nr_registro_pls)
			values (	cd_cgc_w,
				ds_razao_social_p,
				nm_fantasia_p,
				cd_cep_p,
				ds_endereco_p,
				ds_bairro_p,
				ds_municipio_p,
				sg_estado_p,
				clock_timestamp(),
				nm_usuario_p,
				ds_complemento_p,
				nr_telefone_p,
				nr_endereco_p,
				nr_fax_p,
				ds_email_p,
				nm_pessoa_contato_p,
				nr_ramal_contato_p,
				nr_inscricao_estadual_p,
				cd_tipo_pessoa_p,
				cd_conta_contabil_p,
				ie_prod_fabric_p,
				ds_site_internet_p,
				ds_nome_abrev_p,
				ie_situacao_p,
				ds_senha_p,
				cd_pf_resp_tecnico_p,
				nr_alvara_sanitario_p,
				nr_autor_func_p,
				nr_inscricao_municipal_p,
				cd_ans_p,
				cd_referencia_fornec_p,
				dt_validade_alvara_sanit_p,
				dt_validade_autor_func_p,
				clock_timestamp(),
				nm_usuario_p,
				ie_alterar_senha_p,
				nr_seq_pais_p,
				cd_portador_p,
				cd_tipo_portador_p,
				cd_internacional_p,
				cd_cnes_p,
				cd_municipio_ibge_p,
				nr_seq_tipo_logradouro_p,
				ie_status_exportar_p,
				dt_integracao_externa_p,
				ie_tipo_tributacao_p,
				nr_certificado_boas_prat_p,
				nr_alvara_sanitario_munic_p,
				dt_validade_alvara_munic_p,
				dt_validade_cert_boas_prat_p,
				dt_validade_resp_tecnico_p,
				nr_ddi_telefone_p,
				nr_ddd_telefone_p,
				nr_ddi_fax_p,
				nr_ddd_fax_p,
				nr_registro_pls_p);

			exception
			when others then
				null;
			end;
		end if;
	end if;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE importar_pj ( cd_cgc_p text, ds_razao_social_p text, nm_fantasia_p text, cd_cep_p text, ds_endereco_p text, ds_bairro_p text, ds_municipio_p text, sg_estado_p text, nm_usuario_p text, ds_complemento_p text, nr_telefone_p text, nr_endereco_p text, nr_fax_p text, ds_email_p text, nm_pessoa_contato_p text, nr_ramal_contato_p bigint, nr_inscricao_estadual_p text, cd_tipo_pessoa_p bigint, cd_conta_contabil_p text, ie_prod_fabric_p text, ds_site_internet_p text, ds_nome_abrev_p text, ie_situacao_p text, ds_senha_p text, cd_pf_resp_tecnico_p text, nr_alvara_sanitario_p text, nr_autor_func_p text, nr_inscricao_municipal_p text, cd_ans_p text, cd_referencia_fornec_p text, dt_validade_alvara_sanit_p timestamp, dt_validade_autor_func_p timestamp, ie_alterar_senha_p text, nr_seq_pais_p bigint, cd_portador_p bigint, cd_tipo_portador_p bigint, cd_internacional_p text, cd_cnes_p text, cd_municipio_ibge_p text, nr_seq_tipo_logradouro_p bigint, ie_status_exportar_p text, dt_integracao_externa_p timestamp, ie_tipo_tributacao_p text, nr_certificado_boas_prat_p text, nr_alvara_sanitario_munic_p text, dt_validade_alvara_munic_p timestamp, dt_validade_cert_boas_prat_p timestamp, dt_validade_resp_tecnico_p timestamp, nr_ddi_telefone_p text, nr_ddd_telefone_p text, nr_ddi_fax_p text, nr_ddd_fax_p text, nr_registro_pls_p text) FROM PUBLIC;

