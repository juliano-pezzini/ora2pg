-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inativar_item_js ( nr_sequencia_p bigint, vl_atributo_adic_p text, nm_tabela_p text, nr_tag_delphi_p bigint, ds_justificativa_p text, nm_usuario_p text ) AS $body$
DECLARE


ds_sep_bv_w	varchar(10);
ds_comando_w	varchar(255);


BEGIN

select 	obter_separador_bv
	into STRICT	ds_sep_bv_w
	;


	/*
	nr_tag_delphi_p : tabela
	5: evolucao_paciente
	*/
if (nr_tag_delphi_p = 5) then
	begin
	ds_comando_w	:=	' update	' || nm_tabela_p ||
				' set		ie_situacao =  ' || '''I''' ||
				'		,dt_inativacao = sysdate' ||
				'		,nm_usuario_inativacao = :nm_usuario_inativacao' ||
				'		,ds_justificativa = :ds_justificativa' ||
				' where 	cd_evolucao = :cd_evolucao  ';

	CALL exec_sql_dinamico_bv('Inativar item',ds_comando_w,'nm_usuario_inativacao='||nm_usuario_p || ds_sep_bv_w ||
							  'ds_justificativa='||ds_justificativa_p || ds_sep_bv_w ||
							  'cd_evolucao=' || vl_atributo_adic_p);
	end;
	/*
	nr_tag_delphi_p : tabela
	16: diagnostico_doenca
	*/
elsif (nr_tag_delphi_p = 16) then
	begin
	ds_comando_w	:=	' update	' || nm_tabela_p ||
				' set		ie_situacao =  ' || '''I''' ||
				'		,dt_inativacao = sysdate' ||
				'		,nm_usuario_inativacao = :nm_usuario_inativacao' ||
				'		,ds_justificativa = :ds_justificativa' ||
				' where 	nr_seq_interno = :nr_seq_interno  ';

	CALL exec_sql_dinamico_bv('Inativar item',ds_comando_w,'nm_usuario_inativacao='||nm_usuario_p || ds_sep_bv_w ||
							  'ds_justificativa='||ds_justificativa_p || ds_sep_bv_w ||
							  'nr_seq_interno=' || vl_atributo_adic_p);

	end;
	/*
	nr_tag_delphi_p : tabela
	51:
	*/
elsif (nr_tag_delphi_p = 51) then
	begin

	if (nm_tabela_p = 'PARECER_MEDICO')	then
		begin
		ds_comando_w	:=	' update	' || nm_tabela_p ||
				' set		ie_situacao =  ' || '''I''' ||
				'		,dt_inativacao = sysdate' ||
				'		,nm_usuario_inativacao = :nm_usuario_inativacao' ||
				'		,ds_justificativa = :ds_justificativa' ||
				' where 	nr_parecer = :nr_parecer ' ||
				' and		nr_sequencia = :nr_sequencia ';

		CALL exec_sql_dinamico_bv('Inativar item',ds_comando_w,'nm_usuario_inativacao='||nm_usuario_p || ds_sep_bv_w ||
							  'ds_justificativa='||ds_justificativa_p || ds_sep_bv_w ||
							  'nr_parecer=' || vl_atributo_adic_p || ds_sep_bv_w ||
							  'nr_sequencia=' || to_char(nr_sequencia_p));
		end;
	else
		begin
		ds_comando_w	:=	' update	' || nm_tabela_p ||
				' set		ie_situacao =  ' || '''I''' ||
				'		,dt_inativacao = sysdate' ||
				'		,nm_usuario_inativacao = :nm_usuario_inativacao' ||
				'		,ds_justificativa = :ds_justificativa' ||
				' where 	nr_parecer = :nr_parecer ';

		CALL exec_sql_dinamico_bv('Inativar item',ds_comando_w,'nm_usuario_inativacao='||nm_usuario_p || ds_sep_bv_w ||
							  'ds_justificativa='||ds_justificativa_p || ds_sep_bv_w ||
							  'nr_parecer=' || vl_atributo_adic_p);

		end;
	end if;
	end;
	/*
	nr_tag_delphi_p : tabela
	93: paciente_antec_clinico
	94: paciente_alergia
	95: paciente_habito_vicio
	96: paciente_medic_uso
	98: historico_saude_cirurgia
	541: paciente_ocorrencia
	*/
elsif (nr_tag_delphi_p = 93) or (nr_tag_delphi_p = 94) or (nr_tag_delphi_p = 95) or (nr_tag_delphi_p = 96) or (nr_tag_delphi_p = 98) or (nr_tag_delphi_p = 541) then
	begin
	ds_comando_w	:=	' update	' || nm_tabela_p ||
				' set		dt_inativacao = sysdate' ||
				'		,nm_usuario_inativacao = :nm_usuario_inativacao' ||
				'		,ds_justificativa = :ds_justificativa' ||
				' where 	nr_sequencia = :nr_sequencia';

	CALL exec_sql_dinamico_bv('Inativar item',ds_comando_w,'nm_usuario_inativacao='||nm_usuario_p || ds_sep_bv_w ||
							  'ds_justificativa='||ds_justificativa_p || ds_sep_bv_w ||
							  'nr_sequencia=' || to_char(nr_sequencia_p));
	end;
	/*
	nr_tag_delphi_p : tabela
	385:  pedido_exame_externo
	393: Paciente_justificativa
	*/
elsif (nr_tag_delphi_p = 385) or (nr_tag_delphi_p = 393) then
	begin
	ds_comando_w	:=	' update	' || nm_tabela_p ||
				' set		ie_situacao =  ' || '''I''' ||
				'		,dt_inativacao = sysdate' ||
				'		,nm_usuario_inativacao = :nm_usuario_inativacao' ||
				'		,ds_justificativa_inativacao = :ds_justificativa' ||
				' where 	nr_sequencia = :nr_sequencia  ';

	CALL exec_sql_dinamico_bv('Inativar item',ds_comando_w,'nm_usuario_inativacao='||nm_usuario_p || ds_sep_bv_w ||
							  'ds_justificativa='||ds_justificativa_p || ds_sep_bv_w ||
							  'nr_sequencia=' || to_char(nr_sequencia_p));

	end;
	/*
	nr_tag_delphi_p : tabela
	691: paciente_exame
	692: paciente_transfusao
	*/
elsif (nr_tag_delphi_p = 691) or (nr_tag_delphi_p = 692) then
	begin
	ds_comando_w	:=	' update	' || nm_tabela_p ||
				' set		dt_inativacao = sysdate' ||
				'		,nm_usuario_inativacao = :nm_usuario_inativacao' ||
				'		,ds_observacao = :ds_justificativa' ||
				' where 	nr_sequencia = :nr_sequencia  ';

	CALL exec_sql_dinamico_bv('Inativar item',ds_comando_w,'nm_usuario_inativacao='||nm_usuario_p || ds_sep_bv_w ||
							  'ds_justificativa='||ds_justificativa_p || ds_sep_bv_w ||
							  'nr_sequencia=' || to_char(nr_sequencia_p));
	end;
else
	begin

	/*
	nr_tag_delphi_p : tabela
	 7: med_avaliacao_paciente
	13: atendimento_sinal_vital
	14: atendimento_perda_ganho
	32: cirurgia_participante
	33: evento_cirurgia_paciente
	52: cirurgia_descricao
	66: atend_aval_srpa
	83: anamnese_paciente
	130: atendimento_monit_resp
	131: atend_monit_hemod
	135: atend_aval_analgesia
	136: atend_anal_bioq_port
	383: pe_prescricao
	544: -- Pasta : Obstetricia / Nascimento
	562: atend_uroanalise
	608: atend_urocolor
	609: qua_evento_paciente
	610: cirurgia_tec_anestesica
	611: anestesia_descricao
	651: atendimento_gravidez
	*/
	ds_comando_w	:=	' update	' || nm_tabela_p ||
				' set		ie_situacao =  ' || '''I''' ||
				'		,dt_inativacao = sysdate' ||
				'		,nm_usuario_inativacao = :nm_usuario_inativacao' ||
				'		,ds_justificativa = :ds_justificativa' ||
				' where 	nr_sequencia = :nr_sequencia';



	CALL exec_sql_dinamico_bv('Inativar item',ds_comando_w,'nm_usuario_inativacao='||nm_usuario_p || ds_sep_bv_w ||
							  'ds_justificativa='||ds_justificativa_p || ds_sep_bv_w ||
							  'nr_sequencia=' || to_char(nr_sequencia_p));


	end;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inativar_item_js ( nr_sequencia_p bigint, vl_atributo_adic_p text, nm_tabela_p text, nr_tag_delphi_p bigint, ds_justificativa_p text, nm_usuario_p text ) FROM PUBLIC;

