-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE define_atend_retorno_html ( nr_atendimento_p bigint, nr_atend_original_p bigint, nm_usuario_p text, ds_msg_erro_p INOUT text) AS $body$
DECLARE


atend_original_w	varchar(1000);
parametros_w	varchar(1000);
nr_seq_interno_w	bigint;

param782		varchar(1);
param806		varchar(1);
param1031	varchar(10);


BEGIN

param782	:= obter_parametro_funcao(916, 782, nm_usuario_p);
param806	:= obter_parametro_funcao(916, 806, nm_usuario_p);
param1031:= obter_parametro_funcao(916, 1031, nm_usuario_p);

atend_original_w :=	' update	atendimento_paciente '||
			' set	nr_atend_original = :nr_atend_original_p,'||
			' dt_atend_original = sysdate,'||
			' dt_atualizacao = sysdate,'||
			' nm_usuario =:nm_usuario_p';

parametros_w := ':nr_atend_original_p='||nr_atend_original_p;
parametros_w := parametros_w ||';:nm_usuario_p='||nm_usuario_p;

if ((trim(both coalesce(param782,'0')))::numeric  > 0) then
	atend_original_w := atend_original_w || ' , ie_tipo_atendimento = :param782';
	parametros_w := parametros_w || ';:param782='||param782;
end if;

if ((trim(both coalesce(param1031,'0')))::numeric  > 0) then
	atend_original_w := atend_original_w || ', nr_seq_classificacao = :param1031';
	parametros_w := parametros_w || ';:param1031='||param1031;
end if;

begin

	atend_original_w := atend_original_w ||' where nr_atendimento = :nr_atendimento_p';
	parametros_w := parametros_w || ';:nr_atendimento_p='||nr_atendimento_p;

	CALL exec_sql_dinamico_bv('tasy', atend_original_w, parametros_w);

	commit;

	if (param806 IS NOT NULL AND param806::text <> '') then

		nr_seq_interno_w := obter_atecaco_atendimento(nr_atendimento_p);

		update	atend_categoria_convenio
		set		ie_tipo_guia = param806
		where		nr_seq_interno = nr_seq_interno_w;

		commit;

	end if;

exception
when others then
	ds_msg_erro_p := dbms_utility.format_call_stack;
end;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE define_atend_retorno_html ( nr_atendimento_p bigint, nr_atend_original_p bigint, nm_usuario_p text, ds_msg_erro_p INOUT text) FROM PUBLIC;

