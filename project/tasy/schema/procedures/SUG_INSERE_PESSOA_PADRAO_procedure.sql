-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE sug_insere_pessoa_padrao (nr_seq_sugestao_p bigint, nm_usuario_p text) AS $body$
DECLARE


cd_pessoa_fisica_w	bigint;
nr_seq_next_val_w       bigint;

c01 CURSOR FOR
SELECT		CD_PESSOA_FISICA
from		SUG_PESSOA_PADRAO
where		ie_tipo = 'D';

c02 CURSOR FOR
SELECT		CD_PESSOA_FISICA
from		SUG_PESSOA_PADRAO
where		ie_tipo = 'R';


BEGIN
open c01;
loop
fetch c01 into	cd_pessoa_fisica_w;
EXIT WHEN NOT FOUND; /* apply on c01 */

	begin
		select	nextval('sug_sugestao_dest_adic_seq')
		into STRICT	nr_seq_next_val_w
		;

		insert into SUG_SUGESTAO_DEST_ADIC(
			NR_SEQUENCIA,
			DT_ATUALIZACAO,
			NM_USUARIO,
			DT_ATUALIZACAO_NREC,
			NM_USUARIO_NREC,
			CD_PESSOA_DESTINO,
			NR_SEQ_SUGESTAO)
		values (
		nr_seq_next_val_w,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		cd_pessoa_fisica_w,
		nr_seq_sugestao_p);
	end;

	commit;

end loop;
close c01;

open c02;
loop
fetch c02 into	cd_pessoa_fisica_w;
EXIT WHEN NOT FOUND; /* apply on c02 */
	begin
	select	nextval('sug_pessoa_resposta_seq')
	into STRICT	nr_seq_next_val_w
	;

	insert into sug_pessoa_resposta(
		NR_SEQUENCIA,
		DT_ATUALIZACAO,
		NM_USUARIO,
		DT_ATUALIZACAO_NREC,
		NM_USUARIO_NREC,
		CD_PESSOA_RESP,
		NR_SEQ_SUGESTAO)
	values (
		nr_seq_next_val_w,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		cd_pessoa_fisica_w,
		nr_seq_sugestao_p);
	end;

	commit;

	end loop;
	close c02;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE sug_insere_pessoa_padrao (nr_seq_sugestao_p bigint, nm_usuario_p text) FROM PUBLIC;

