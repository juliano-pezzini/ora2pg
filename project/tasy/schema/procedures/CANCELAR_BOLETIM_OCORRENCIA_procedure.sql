-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cancelar_boletim_ocorrencia ( nr_seq_bo_p bigint, nr_seq_motivo_cancel_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
Finalidade: 
Cancelar o Boletim de ocorrência 
------------------------------------------------------------------------------------------------------------------- 
Locais de chamada direta: 
[ ] Objetos do dicionário [ x] Tasy (Delphi/Java) [  ] Portal [ ] Relatórios [ ] Outros: 
 ------------------------------------------------------------------------------------------------------------------ 
Pontos de atenção: 
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
 
			 
nr_seq_atend_pls_w		pls_atendimento.nr_sequencia%type;
nr_seq_evento_atend_w		pls_atendimento_evento.nr_sequencia%type;


BEGIN 
 
update 	sac_boletim_ocorrencia 
set 	nr_seq_motivo_cancel 	= nr_seq_motivo_cancel_p, 
	nm_usuario_cancelamento = nm_usuario_p, 
	dt_cancelamento 	= clock_timestamp() 
where 	nr_sequencia	 	= nr_seq_bo_p;
 
update	pls_protocolo_atendimento 
set 	ie_status 		= 4, 
	nm_usuario 		= nm_usuario_p, 
	dt_atualizacao 		= clock_timestamp() 
where 	nr_seq_boletim_ocor 	= nr_seq_bo_p;
	 
begin	 
select	nr_atend_pls, 
	nr_seq_evento_atend 
into STRICT	nr_seq_atend_pls_w, 
	nr_seq_evento_atend_w 
from	sac_boletim_ocorrencia	 
where	nr_sequencia		= nr_seq_bo_p;
exception 
when others then 
	nr_seq_atend_pls_w 	:= null;
end;
 
if (nr_seq_atend_pls_w IS NOT NULL AND nr_seq_atend_pls_w::text <> '') then	 
	CALL pls_finalizar_atendimento(	nr_seq_atend_pls_w, 
					nr_seq_evento_atend_w, 
					null, 
					null, 
					nm_usuario_p);
end if;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cancelar_boletim_ocorrencia ( nr_seq_bo_p bigint, nr_seq_motivo_cancel_p bigint, nm_usuario_p text) FROM PUBLIC;

