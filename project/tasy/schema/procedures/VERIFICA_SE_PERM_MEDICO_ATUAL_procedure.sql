-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE verifica_se_perm_medico_atual (nr_atendimento_p bigint) AS $body$
DECLARE

 
dt_entrada_w		timestamp;
hr_param_w		bigint;
dt_consistencia_w	timestamp;


BEGIN 
hr_param_w := Obter_Param_Usuario(916, 977, obter_perfil_ativo, obter_usuario_ativo, obter_estabelecimento_ativo, hr_param_w);
 
if (hr_param_w > 0) then 
	begin 
	select 	max(dt_entrada) 
	into STRICT	dt_entrada_w 
	from	atendimento_paciente 
	where	nr_atendimento = nr_atendimento_p;
 
 
 
 
	dt_consistencia_w := to_date(to_char(dt_entrada_w + hr_param_w,'dd/mm/yyyy hh24:mi:ss'),'dd/mm/yyyy hh24:mi:ss');
 
	commit;
	if (Obter_Hora_Entre_datas_aux(dt_consistencia_w,clock_timestamp()) > hr_param_w) then 
		begin 
		CALL Wheb_mensagem_pck.exibir_mensagem_abort(208270, 'HR_PARAM=' || to_char(hr_param_w));
		end;
	end if;
	end;
end if;
	 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE verifica_se_perm_medico_atual (nr_atendimento_p bigint) FROM PUBLIC;

