-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE html_gravar_conv_ret_item (cd_estabelecimento_p bigint, cd_convenio_p bigint, nr_seq_retorno_p bigint, nr_interno_conta_p bigint, cd_autorizacao_p text, vl_saldo_p bigint, vl_guia_p bigint, nm_usuario_p text) AS $body$
DECLARE


ie_libera_repasse_w	varchar(5);


BEGIN

select	max(a.ie_libera_repasse)
into STRICT	ie_libera_repasse_w
from	regra_campo_lib_rep a
where	coalesce(a.cd_convenio,cd_convenio_p)	= cd_convenio_p
and	a.cd_estabelecimento 			= cd_estabelecimento_p
and	a.ie_regra 				= 1;

insert into convenio_retorno_item(CD_AUTORIZACAO,
	nr_interno_conta,
	DT_ATUALIZACAO,
	IE_ANALISADA,
	IE_GLOSA,
	IE_LIBERA_REPASSE,
	NM_USUARIO,
	NR_SEQ_RETORNO,
	NR_SEQUENCIA,
	VL_ADEQUADO,
	VL_ADICIONAL,
	VL_AMENOR,
	VL_AMENOR_POST,
	VL_CAMBIAL_ATIVO,
	VL_CAMBIAL_PASSIVO,
	VL_DESCONTO,
	VL_GLOSADO,
	VL_GLOSADO_POST,
	VL_GUIA,
	VL_JUROS,
	VL_JUROS_COBR,
	VL_MULTA_COBR,
	VL_NOTA_CREDITO,
	VL_PAGO,
	VL_PERDAS,
	VL_TRIBUTO_GUIA)
values (cd_autorizacao_p,
	nr_interno_conta_p,
	clock_timestamp(),
	'N',
	'N',
	ie_libera_repasse_w,
	nm_usuario_p,
	nr_seq_retorno_p,
	nextval('convenio_retorno_item_seq'),
	0,--VL_ADEQUADO,
	0,--VL_ADICIONAL,
	0,--VL_AMENOR,
	0,--VL_AMENOR_POST,
	0,--VL_CAMBIAL_ATIVO,
	0,--VL_CAMBIAL_PASSIVO,
	0,--VL_DESCONTO,
	0,--VL_GLOSADO,
	0,--VL_GLOSADO_POST,
	vl_guia_p,
	0,--VL_JUROS,
	0,--VL_JUROS_COBR,
	0,--VL_MULTA_COBR,
	0,--VL_NOTA_CREDITO,
	vl_saldo_p,
	0,--VL_PERDAS,
	0);--VL_TRIBUTO_GUIA)
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE html_gravar_conv_ret_item (cd_estabelecimento_p bigint, cd_convenio_p bigint, nr_seq_retorno_p bigint, nr_interno_conta_p bigint, cd_autorizacao_p text, vl_saldo_p bigint, vl_guia_p bigint, nm_usuario_p text) FROM PUBLIC;

