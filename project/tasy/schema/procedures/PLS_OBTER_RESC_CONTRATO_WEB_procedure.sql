-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_obter_resc_contrato_web ( nr_seq_segurado_p pls_segurado.nr_sequencia%type, ie_permite_rescindir_p INOUT pls_regra_resc_benef_web.ie_permite_solicitar_rescisao%type, ie_selecionar_benef_p INOUT pls_regra_resc_benef_web.ie_permite_selecionar_benef%type, ie_acao_rescindir_titular_p INOUT pls_regra_resc_benef_web.ie_acao_rescindir_titular%type, ds_msg_transf_titular_p INOUT pls_regra_resc_benef_web.ds_msg_transf_titular%type, ie_informacoes_financeiras_p INOUT pls_regra_resc_benef_web.ie_informacoes_financeiras%type) AS $body$
DECLARE


ie_tipo_contratacao_w		pls_plano.ie_tipo_contratacao%type;
ie_permite_rescindir_w		pls_regra_resc_benef_web.ie_permite_solicitar_rescisao%type;
ie_selecionar_benef_w		pls_regra_resc_benef_web.ie_permite_selecionar_benef%type;
ie_acao_rescindir_titular_w 	pls_regra_resc_benef_web.ie_acao_rescindir_titular%type;
ds_msg_transf_titular_w		pls_regra_resc_benef_web.ds_msg_transf_titular%type;
ie_regulamentacao_w		pls_plano.ie_regulamentacao%type;
ie_informacoes_financeiras_w	pls_regra_resc_benef_web.ie_informacoes_financeiras%type;

C01 CURSOR(	ie_tipo_contratacao_pc		pls_plano.ie_tipo_contratacao%type,
		ie_regulamentacao_pc		pls_plano.ie_regulamentacao%type) FOR
	SELECT	ie_permite_solicitar_rescisao,
		ie_permite_selecionar_benef,
		ie_acao_rescindir_titular,
		ds_msg_transf_titular,
		ie_informacoes_financeiras
	from	pls_regra_resc_benef_web
	where	((ie_tipo_contratacao	= ie_tipo_contratacao_pc) or (coalesce(ie_tipo_contratacao::text, '') = ''))
	and	((ie_regulamentacao	= ie_regulamentacao_pc) or (coalesce(ie_regulamentacao::text, '') = ''))
	order by
		coalesce(ie_tipo_contratacao, ' '),
		coalesce(ie_regulamentacao, ' ');

BEGIN
ie_permite_rescindir_w		:= 'N';
ie_selecionar_benef_w		:= 'N';
ie_acao_rescindir_titular_w 	:= '1';
ie_informacoes_financeiras_w	:= 'N';

if (nr_seq_segurado_p IS NOT NULL AND nr_seq_segurado_p::text <> '') then
	select	max(b.ie_tipo_contratacao),
		max(b.ie_regulamentacao)
	into STRICT	ie_tipo_contratacao_w,
		ie_regulamentacao_w
	from	pls_segurado a,
		pls_plano b
	where	b.nr_sequencia	= a.nr_seq_plano
	and	a.nr_sequencia	= nr_seq_segurado_p;

	if (ie_tipo_contratacao_w IS NOT NULL AND ie_tipo_contratacao_w::text <> '') then
		for r_c01_w in c01(	ie_tipo_contratacao_w,
					ie_regulamentacao_w) loop
			begin
			ie_permite_rescindir_w		:= r_c01_w.ie_permite_solicitar_rescisao;
			ie_selecionar_benef_w		:= r_c01_w.ie_permite_selecionar_benef;
			ie_acao_rescindir_titular_w	:= r_c01_w.ie_acao_rescindir_titular;
			ds_msg_transf_titular_w		:= r_c01_w.ds_msg_transf_titular;
			ie_informacoes_financeiras_w	:= r_c01_w.ie_informacoes_financeiras;
			end;
		end loop;
	end if;
end if;

ie_permite_rescindir_p		:= ie_permite_rescindir_w;
ie_selecionar_benef_p		:= ie_selecionar_benef_w;
ie_acao_rescindir_titular_p 	:= ie_acao_rescindir_titular_w;
ds_msg_transf_titular_p		:= ds_msg_transf_titular_w;
ie_informacoes_financeiras_p	:= ie_informacoes_financeiras_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_obter_resc_contrato_web ( nr_seq_segurado_p pls_segurado.nr_sequencia%type, ie_permite_rescindir_p INOUT pls_regra_resc_benef_web.ie_permite_solicitar_rescisao%type, ie_selecionar_benef_p INOUT pls_regra_resc_benef_web.ie_permite_selecionar_benef%type, ie_acao_rescindir_titular_p INOUT pls_regra_resc_benef_web.ie_acao_rescindir_titular%type, ds_msg_transf_titular_p INOUT pls_regra_resc_benef_web.ds_msg_transf_titular%type, ie_informacoes_financeiras_p INOUT pls_regra_resc_benef_web.ie_informacoes_financeiras%type) FROM PUBLIC;

