-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE diops_alterar_valores_corresp ( nm_usuario_p text, nr_seq_periodo_p bigint, vl_despesas_oper_p bigint, vl_glosas_oper_p bigint, vl_despesas_corresp_p bigint, vl_glosas_corresp_p bigint) AS $body$
DECLARE


ie_tipo_movto_w		diops_fin_mov_corresp.ie_tipo_movto%type;
vl_despesas_w		diops_fin_mov_corresp.vl_despesas%type;
vl_glosas_w		diops_fin_mov_corresp.vl_glosas%type;
qt_tipo_movto_w		smallint;


BEGIN

delete 	FROM diops_fin_mov_corresp
where	nr_seq_periodo	= nr_seq_periodo_p;

qt_tipo_movto_w		:= 2;

while(qt_tipo_movto_w > 0) loop
	begin
	if (qt_tipo_movto_w = 2) then
		vl_despesas_w		:= vl_despesas_oper_p;
		vl_glosas_w		:= vl_glosas_oper_p;
		ie_tipo_movto_w		:= 'BO';
	elsif (qt_tipo_movto_w = 1) then
		vl_despesas_w		:= vl_despesas_corresp_p;
		vl_glosas_w		:= vl_glosas_corresp_p;
		ie_tipo_movto_w		:= 'BC';
	end if;

	insert into diops_fin_mov_corresp(	nr_sequencia,
						dt_atualizacao,
						nm_usuario,
						dt_atualizacao_nrec,
						nm_usuario_nrec,
						nr_seq_periodo,
						ie_tipo_movto,
						vl_despesas,
						vl_glosas)
					values (nextval('diops_fin_mov_corresp_seq'),
						clock_timestamp(),
						nm_usuario_p,
						clock_timestamp(),
						nm_usuario_p,
						nr_seq_periodo_p,
						ie_tipo_movto_w,
						vl_despesas_w,
						vl_glosas_w);

	qt_tipo_movto_w	:= qt_tipo_movto_w - 1;
	end;
end loop;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE diops_alterar_valores_corresp ( nm_usuario_p text, nr_seq_periodo_p bigint, vl_despesas_oper_p bigint, vl_glosas_oper_p bigint, vl_despesas_corresp_p bigint, vl_glosas_corresp_p bigint) FROM PUBLIC;

