-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE agenda_pacient_proc_after_post ( nr_seq_proc_interno_p bigint, nr_seq_agenda_p bigint, nm_usuario_p text, ds_ajustar_min_p INOUT text, ie_ajustar_min_p INOUT text) AS $body$
DECLARE

ds_valor_parametro_w varchar(255);

BEGIN
if (nr_seq_agenda_p IS NOT NULL AND nr_seq_agenda_p::text <> '') then 
	begin 
	if (nr_seq_proc_interno_p IS NOT NULL AND nr_seq_proc_interno_p::text <> '') then 
		begin 
		CALL atualizar_agenda_bolsas_sangue( 
				nr_seq_agenda_p, 
				nr_seq_proc_interno_p, 
				nm_usuario_p);
		end;
	end if;
	ds_valor_parametro_w := obter_parametro_funcao(871, 163, nm_usuario_p);
	if (ds_valor_parametro_w = 'S') then 
		begin 
		SELECT * FROM calcular_min_dur_agenda_cir(wheb_usuario_pck.get_cd_estabelecimento, nr_seq_agenda_p, wheb_usuario_pck.get_cd_perfil, nm_usuario_p, ie_ajustar_min_p, ds_ajustar_min_p) INTO STRICT ie_ajustar_min_p, ds_ajustar_min_p;
		end;
	end if;
	ds_valor_parametro_w := obter_parametro_funcao(871, 239, nm_usuario_p);
	if (ds_valor_parametro_w = 'S') then 
		begin 
		CALL calcula_data_hora_chegada(nr_seq_agenda_p);
		end;
	end if;	
	end;
end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE agenda_pacient_proc_after_post ( nr_seq_proc_interno_p bigint, nr_seq_agenda_p bigint, nm_usuario_p text, ds_ajustar_min_p INOUT text, ie_ajustar_min_p INOUT text) FROM PUBLIC;

