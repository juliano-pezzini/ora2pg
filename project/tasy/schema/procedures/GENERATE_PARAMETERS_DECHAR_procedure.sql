-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE generate_parameters_dechar ( nr_sequencia_p bigint, nr_strategy_p bigint, nm_usuario_p text) AS $body$
DECLARE


nm_parameter_w	strategy_parameter.nm_parameter%type;
cd_exp_note_w	strategy_parameter.cd_exp_note%type;
ie_type_w		strategy_parameter.ie_type%type;
qt_records_w	bigint := 0;

c_strategy_params CURSOR FOR
	SELECT 	p.nm_parameter,
			p.cd_exp_note,
			p.ie_type
	from	strategy s,
			strategy_parameter p
	where	s.nr_sequencia = nr_strategy_p
	and		p.nr_strategy = s.nr_sequencia
	and		coalesce(s.ie_situacao, 'A') = 'A';


BEGIN
if (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '') and (nr_strategy_p IS NOT NULL AND nr_strategy_p::text <> '') then
	begin
	open c_strategy_params;
	loop
	fetch c_strategy_params into
		nm_parameter_w,
		cd_exp_note_w,
		ie_type_w;
	EXIT WHEN NOT FOUND; /* apply on c_strategy_params */
		insert into decharacterization_param(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_dechar_rule,
			ds_name,
			ie_type,
			cd_exp_note,
			ds_value
		) values (
			nextval('decharacterization_param_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			nr_sequencia_p,
			nm_parameter_w,
			ie_type_w,
			cd_exp_note_w,
			null
		);
	end loop;
	commit;
	end;
end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE generate_parameters_dechar ( nr_sequencia_p bigint, nr_strategy_p bigint, nm_usuario_p text) FROM PUBLIC;

