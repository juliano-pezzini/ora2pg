-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copiar_material_estab (cd_estab_origem_p bigint, cd_estab_destino_p bigint, nm_usuario_p text) AS $body$
DECLARE


cd_material_w			integer;
ie_baixa_estoq_pac_w		varchar(1);
ie_material_estoque_w		varchar(1);
qt_estoque_minimo_w		double precision;
qt_ponto_pedido_w			double precision;
qt_estoque_maximo_w		double precision;
qt_dia_interv_ressup_w		smallint;
qt_dia_ressup_forn_w		smallint;
qt_dia_estoque_minimo_w		smallint;
nr_minimo_cotacao_w		smallint;
qt_consumo_mensal_w		double precision;
cd_material_conta_w		integer;
cd_kit_material_w			integer;
qt_peso_kg_w			double precision;
dt_atual_consumo_w		timestamp;
qt_mes_consumo_w		bigint;
ie_ressuprimento_w			varchar(01);
ie_classif_custo_w			varchar(01);
nr_registro_anvisa_w		varchar(60);
ie_prescricao_w			varchar(01);
ie_padronizado_w			varchar(01);
ie_estoque_lote_w			varchar(01);
ie_requisicao_w			varchar(01);
ie_curva_xyz_w			varchar(01);
ie_controla_serie_w			varchar(01);
dt_validade_reg_anvisa_w		timestamp;
ie_unid_consumo_prescr_w		varchar(01);
qt_existe_w					bigint;
ie_vigente_anvisa_w			material_estab.ie_vigente_anvisa%type;


c01 CURSOR FOR
SELECT	cd_material,
	ie_baixa_estoq_pac,
	ie_material_estoque,
	qt_estoque_minimo,
	qt_ponto_pedido,
	qt_estoque_maximo,
	qt_dia_interv_ressup,
	qt_dia_ressup_forn,
	qt_dia_estoque_minimo,
	nr_minimo_cotacao,
	qt_consumo_mensal,
	cd_material_conta,
	cd_kit_material,
	qt_peso_kg,
	dt_atual_consumo,
	qt_mes_consumo,
	ie_ressuprimento,
	ie_classif_custo,
	nr_registro_anvisa,
	ie_prescricao,
	ie_padronizado,
	ie_estoque_lote,
	ie_requisicao,
	ie_curva_xyz,
	ie_controla_serie,
	dt_validade_reg_anvisa,
	ie_unid_consumo_prescr,
	ie_vigente_anvisa
from	material_estab
where	cd_estabelecimento = cd_estab_origem_p;


BEGIN

open C01;
loop
fetch C01 into
	cd_material_w,
	ie_baixa_estoq_pac_w,
	ie_material_estoque_w,
	qt_estoque_minimo_w,
	qt_ponto_pedido_w,
	qt_estoque_maximo_w,
	qt_dia_interv_ressup_w,
	qt_dia_ressup_forn_w,
	qt_dia_estoque_minimo_w,
	nr_minimo_cotacao_w,
	qt_consumo_mensal_w,
	cd_material_conta_w,
	cd_kit_material_w,
	qt_peso_kg_w,
	dt_atual_consumo_w,
	qt_mes_consumo_w,
	ie_ressuprimento_w,
	ie_classif_custo_w,
	nr_registro_anvisa_w,
	ie_prescricao_w,
	ie_padronizado_w,
	ie_estoque_lote_w,
	ie_requisicao_w,
	ie_curva_xyz_w,
	ie_controla_serie_w,
	dt_validade_reg_anvisa_w,
	ie_unid_consumo_prescr_w,
	ie_vigente_anvisa_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin

	select	count(*)
	into STRICT	qt_existe_w
	from	material_estab
	where	cd_material = cd_material_w
	and	cd_estabelecimento = cd_estab_destino_p;

	if (qt_existe_w = 0) then
		begin
		insert into material_estab(
			nr_sequencia,
			cd_estabelecimento,
			cd_material,
			dt_atualizacao,
			nm_usuario,
			ie_baixa_estoq_pac,
			ie_material_estoque,
			qt_estoque_minimo,
			qt_ponto_pedido,
			qt_estoque_maximo,
			qt_dia_interv_ressup,
			qt_dia_ressup_forn,
			qt_dia_estoque_minimo,
			nr_minimo_cotacao,
			qt_consumo_mensal,
			cd_material_conta,
			cd_kit_material,
			qt_peso_kg,
			dt_atual_consumo,
			qt_mes_consumo,
			ie_ressuprimento,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			ie_classif_custo,
			nr_registro_anvisa,
			ie_prescricao,
			ie_padronizado,
			ie_estoque_lote,
			ie_requisicao,
			ie_curva_xyz,
			ie_controla_serie,
			dt_validade_reg_anvisa,
			ie_unid_consumo_prescr,
			ie_vigente_anvisa)
		values (	nextval('material_estab_seq'),
			cd_estab_destino_p,
			cd_material_w,
			clock_timestamp(),
			nm_usuario_p,
			ie_baixa_estoq_pac_w,
			ie_material_estoque_w,
			qt_estoque_minimo_w,
			qt_ponto_pedido_w,
			qt_estoque_maximo_w,
			qt_dia_interv_ressup_w,
			qt_dia_ressup_forn_w,
			qt_dia_estoque_minimo_w,
			nr_minimo_cotacao_w,
			qt_consumo_mensal_w,
			cd_material_conta_w,
			cd_kit_material_w,
			qt_peso_kg_w,
			dt_atual_consumo_w,
			qt_mes_consumo_w,
			ie_ressuprimento_w,
			clock_timestamp(),
			nm_usuario_p,
			ie_classif_custo_w,
			nr_registro_anvisa_w,
			ie_prescricao_w,
			ie_padronizado_w,
			ie_estoque_lote_w,
			ie_requisicao_w,
			ie_curva_xyz_w,
			ie_controla_serie_w,
			dt_validade_reg_anvisa_w,
			ie_unid_consumo_prescr_w,
			ie_vigente_anvisa_w);
		end;
	end if;
	end;
end loop;
close C01;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copiar_material_estab (cd_estab_origem_p bigint, cd_estab_destino_p bigint, nm_usuario_p text) FROM PUBLIC;

