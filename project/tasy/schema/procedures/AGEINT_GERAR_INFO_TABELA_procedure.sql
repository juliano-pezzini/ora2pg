-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ageint_gerar_info_tabela ( nm_tabela_p tabela_sistema.nm_tabela%type, nr_seq_info_p agenda_regra_proc.nr_seq_regra%type, nr_seq_nova_info_p agenda_regra_proc.nr_seq_regra%type) AS $body$
DECLARE


nr_seq_proc_interno_w	agenda_regra_proc.nr_seq_proc_interno%type;
cd_procedimento_w		agenda_regra_proc.cd_procedimento%type;
ie_origem_proced_w		agenda_regra_proc.ie_origem_proced%type;
cd_area_procedimento_w	agenda_regra_proc.cd_area_procedimento%type;
cd_especialidade_w		agenda_regra_proc.cd_especialidade%type;
cd_grupo_proc_w			agenda_regra_proc.cd_grupo_proc%type;
			
C01 CURSOR FOR
	SELECT 	nr_seq_proc_interno,
			cd_procedimento,
			ie_origem_proced,
			cd_area_procedimento,
			cd_especialidade,
			cd_grupo_proc
	from 	agenda_regra_proc
	where  	nr_seq_regra = nr_seq_info_p;


BEGIN

if (nm_tabela_p IS NOT NULL AND nm_tabela_p::text <> '') and (nr_seq_info_p IS NOT NULL AND nr_seq_info_p::text <> '') and (nr_seq_nova_info_p IS NOT NULL AND nr_seq_nova_info_p::text <> '') and (upper(nm_tabela_p) = 'AGENDA_REGRA_PROC') then
	
	open C01;
	loop
	fetch C01 into	
		nr_seq_proc_interno_w,
		cd_procedimento_w,
		ie_origem_proced_w,
		cd_area_procedimento_w,
		cd_especialidade_w,
		cd_grupo_proc_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */
		begin
		
		insert into agenda_regra_proc(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_proc_interno,
			cd_procedimento,
			ie_origem_proced,
			cd_area_procedimento,
			cd_especialidade,
			cd_grupo_proc,
			nr_seq_regra
		) values (
			nextval('agenda_regra_proc_seq'),
			clock_timestamp(),
			wheb_usuario_pck.get_nm_usuario,
			clock_timestamp(),
			wheb_usuario_pck.get_nm_usuario,
			nr_seq_proc_interno_w,
			cd_procedimento_w,
			ie_origem_proced_w,
			cd_area_procedimento_w,
			cd_especialidade_w,
			cd_grupo_proc_w,
			nr_seq_nova_info_p
		);
		exception
		when no_data_found or too_many_rows then
			cd_grupo_proc_w := null;
		end;
		
	end loop;
	close C01;

	commit;
	
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ageint_gerar_info_tabela ( nm_tabela_p tabela_sistema.nm_tabela%type, nr_seq_info_p agenda_regra_proc.nr_seq_regra%type, nr_seq_nova_info_p agenda_regra_proc.nr_seq_regra%type) FROM PUBLIC;

