-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE converte_rf_string_anam ( nr_atendimento_p text, nm_usuario_p text, nr_seq_tasy_p INOUT text) AS $body$
DECLARE



nr_seq_conversao_w bigint;
ds_texto_w  varchar(2000);


BEGIN

  nr_seq_conversao_w  := converte_rtf_string(' select  ds_anamnese
                        from    anamnese_paciente
                        where   dt_liberacao is not null
                        and     dt_inativacao is null
                        and    nr_atendimento = :nr_atendimento
                        and rownum = 1
                        order by dt_ananmese desc', nr_atendimento_p, nm_usuario_p, nr_seq_conversao_w );

  begin
  nr_seq_tasy_p := nr_seq_conversao_w;
     select ds_texto
       into STRICT ds_texto_w
       from tasy_conversao_rtf
     where nr_sequencia = nr_seq_conversao_w;
    exception
      when others then
          ds_texto_w := null;
  end;

  insert into rtf_convertido(nr_sequencia,
                             ds_texto,
                             dt_atualizacao,
                             nm_usuario)
values (nr_seq_conversao_w,ds_texto_w,clock_timestamp(),nm_usuario_p);


  
  return;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE converte_rf_string_anam ( nr_atendimento_p text, nm_usuario_p text, nr_seq_tasy_p INOUT text) FROM PUBLIC;

