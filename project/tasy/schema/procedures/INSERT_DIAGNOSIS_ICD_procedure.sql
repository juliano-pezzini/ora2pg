-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_diagnosis_icd ( nr_atendimento_p bigint, cd_doenca_p text, cd_doenca_superior_p text default null, cd_pessoa_fisica_p text DEFAULT NULL, ds_classifications_p text DEFAULT NULL, nr_cirurgia_p bigint default null, ie_lado_p text default null, ie_classificacao_doenca_p text default null, ie_tipo_diagnostico_p text default null, dt_diagnostico_p INOUT timestamp DEFAULT NULL, ie_status_diag_p text default null) AS $body$
BEGIN
	
    -- Insere o diagnóstico
    dt_diagnostico_p := Gerar_diagnostico_atend_3m(
	nr_atendimento_p, cd_doenca_p, cd_pessoa_fisica_p, Wheb_usuario_pck.get_nm_usuario(), ie_tipo_diagnostico_p, ie_classificacao_doenca_p, cd_doenca_superior_p, nr_cirurgia_p, null, ie_status_diag_p, dt_diagnostico_p);

    COMMIT;
    
    -- Insere as classificações do diagnóstico
        CALL inserir_classif_diagnostico(
	ds_classifications_p, 
	wheb_usuario_pck.get_cd_estabelecimento(), 
	Wheb_usuario_pck.get_nm_usuario(), 
	nr_atendimento_p, 
	cd_pessoa_fisica_p, 
	cd_doenca_p,
	dt_diagnostico_p,
	ie_status_diag_p);

    COMMIT;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_diagnosis_icd ( nr_atendimento_p bigint, cd_doenca_p text, cd_doenca_superior_p text default null, cd_pessoa_fisica_p text DEFAULT NULL, ds_classifications_p text DEFAULT NULL, nr_cirurgia_p bigint default null, ie_lado_p text default null, ie_classificacao_doenca_p text default null, ie_tipo_diagnostico_p text default null, dt_diagnostico_p INOUT timestamp DEFAULT NULL, ie_status_diag_p text default null) FROM PUBLIC;

