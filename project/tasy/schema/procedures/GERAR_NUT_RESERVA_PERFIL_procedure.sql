-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_nut_reserva_perfil ( nr_seq_servico_p bigint, dt_inicial_p timestamp, dt_final_p timestamp, cd_pessoa_fisica_p text, nm_usuario_p text, nr_seq_restaurante_p bigint, cd_estabelecimento_p bigint, ds_observacao_p text, nr_seq_local_refeicao_p bigint default null, ds_mensagem_p INOUT text DEFAULT NULL, hr_entrega_p timestamp default null) AS $body$
DECLARE




qt_reserva_w		integer;
cd_pessoa_fisica_w	bigint;
ie_escala_w		varchar(10);
ie_periodo_w		varchar(1);
ie_gerar_funcionario_w	varchar(1);
ds_mensagem_w		varchar(2000);
dt_servico_w		timestamp;
ds_datas_servicos_w	varchar(1000);
qt_registros_w		bigint;





c01 CURSOR FOR

	SELECT	cd_pessoa_fisica
	from	pessoa_fisica
	where	nr_seq_nut_perfil = obter_perfil_nutricao_pf(cd_pessoa_fisica_p, 'C');




BEGIN
open c01;
loop
fetch c01 into
	cd_pessoa_fisica_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin
	ds_mensagem_p := gerar_nut_reserva(nr_seq_servico_p, dt_inicial_p, dt_final_p, cd_pessoa_fisica_w, nm_usuario_p, nr_seq_restaurante_p, cd_estabelecimento_p, ds_observacao_p, nr_seq_local_refeicao_p, ds_mensagem_p, hr_entrega_p);
	end;

end loop;
close c01;



end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_nut_reserva_perfil ( nr_seq_servico_p bigint, dt_inicial_p timestamp, dt_final_p timestamp, cd_pessoa_fisica_p text, nm_usuario_p text, nr_seq_restaurante_p bigint, cd_estabelecimento_p bigint, ds_observacao_p text, nr_seq_local_refeicao_p bigint default null, ds_mensagem_p INOUT text DEFAULT NULL, hr_entrega_p timestamp default null) FROM PUBLIC;

