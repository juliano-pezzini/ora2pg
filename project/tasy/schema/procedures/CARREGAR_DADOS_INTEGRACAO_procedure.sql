-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE carregar_dados_integracao ( nr_seq_evento_p bigint, nm_usuario_p text, cd_perfil_p bigint, cd_estabelecimento_p bigint, ds_ip_proxy_p INOUT text, ds_porta_proxy_p INOUT text, nm_usuario_proxy_p INOUT text, ds_senha_proxy_p INOUT text, ds_endereco_webservice_p INOUT text, qt_tempo_timeout_p INOUT bigint) AS $body$
DECLARE



cd_funcao_w			integer	:= 9041;
nr_seq_info_integracao_w		INFORMACAO_INTEGRACAO.NR_SEQUENCIA%type;


BEGIN


ds_endereco_webservice_p	:= null;

select	max(c.ip_conexao || ':' || c.nr_porta)
into STRICT	ds_endereco_webservice_p
from	servidor_integracao c,
	cliente_integracao b,
	informacao_integracao a
where	a.nr_sequencia		= b.nr_seq_inf_integracao
and	b.nr_seq_serv_origem	= c.nr_sequencia
and	a.nr_seq_evento		= nr_seq_evento_p;

if (coalesce(ds_endereco_webservice_p::text, '') = '') then
	begin
	ds_endereco_webservice_p	:= obter_valor_param_usuario(
							cd_funcao_p	=> cd_funcao_w,
							nr_sequencia_p	=> 5,
							cd_perfil_p	=> cd_perfil_p,
							nm_usuario_p	=> nm_usuario_p,
							cd_estabelecimento_p	=> cd_estabelecimento_p);
	end;
end if;


ds_ip_proxy_p :=	obter_valor_param_usuario(
					cd_funcao_p	=> cd_funcao_w,
					nr_sequencia_p	=> 1,
					cd_perfil_p	=> cd_perfil_p,
					nm_usuario_p	=> nm_usuario_p,
					cd_estabelecimento_p	=> cd_estabelecimento_p);

ds_porta_proxy_p := obter_valor_param_usuario(
					cd_funcao_p	=> cd_funcao_w,
					nr_sequencia_p	=> 2,
					cd_perfil_p	=> cd_perfil_p,
					nm_usuario_p	=> nm_usuario_p,
					cd_estabelecimento_p	=> cd_estabelecimento_p);


nm_usuario_proxy_p := obter_valor_param_usuario(
					cd_funcao_p	=> cd_funcao_w,
					nr_sequencia_p	=> 3,
					cd_perfil_p	=> cd_perfil_p,
					nm_usuario_p	=> nm_usuario_p,
					cd_estabelecimento_p	=> cd_estabelecimento_p);

ds_senha_proxy_p := obter_valor_param_usuario(
					cd_funcao_p	=> cd_funcao_w,
					nr_sequencia_p	=> 4,
					cd_perfil_p	=> cd_perfil_p,
					nm_usuario_p	=> nm_usuario_p,
					cd_estabelecimento_p	=> cd_estabelecimento_p);


qt_tempo_timeout_p := obter_valor_param_usuario(
					cd_funcao_p	=> cd_funcao_w,
					nr_sequencia_p	=> 7,
					cd_perfil_p	=> cd_perfil_p,
					nm_usuario_p	=> nm_usuario_p,
					cd_estabelecimento_p	=> cd_estabelecimento_p);
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE carregar_dados_integracao ( nr_seq_evento_p bigint, nm_usuario_p text, cd_perfil_p bigint, cd_estabelecimento_p bigint, ds_ip_proxy_p INOUT text, ds_porta_proxy_p INOUT text, nm_usuario_proxy_p INOUT text, ds_senha_proxy_p INOUT text, ds_endereco_webservice_p INOUT text, qt_tempo_timeout_p INOUT bigint) FROM PUBLIC;

