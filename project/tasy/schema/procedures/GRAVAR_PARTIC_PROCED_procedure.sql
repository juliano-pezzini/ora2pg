-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gravar_partic_proced (nr_sequencia_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
 
DT_CONTA_W		timestamp;
CD_CONVENIO_W      integer  	:= 0;
CD_CATEGORIA_W     varchar(10);
NR_CIRURGIA_W		bigint  	:= 0;
IE_ORIGEM_PROCED_W   bigint  	:= 0;
NR_INTERNO_CONTA_W	bigint;
NR_ATENDIMENTO_W	bigint;
CD_PROCEDIMENTO_W	bigint;
CD_ESTABELECIMENTO_W  smallint 	:= 1;


BEGIN 
 
/* Obter o Registro do Procedimento do Paciente */
 
SELECT 	CD_CONVENIO, 
    	CD_CATEGORIA, 
    	coalesce(NR_CIRURGIA,0), 
    	coalesce(DT_CONTA, coalesce(DT_PRESCRICAO,DT_PROCEDIMENTO)), 
    	IE_ORIGEM_PROCED, 
	NR_INTERNO_CONTA, 
	NR_ATENDIMENTO, 
	CD_PROCEDIMENTO 
INTO STRICT 
    	CD_CONVENIO_W, 
    	CD_CATEGORIA_W, 
    	NR_CIRURGIA_W, 
    	DT_CONTA_W, 
  	IE_ORIGEM_PROCED_W, 
	NR_INTERNO_CONTA_W, 
	NR_ATENDIMENTO_W, 
	CD_PROCEDIMENTO_W 
FROM 	PROCEDIMENTO_PACIENTE 
WHERE 	NR_SEQUENCIA		= NR_SEQUENCIA_P;
 
/* Obter o Estabelecimento do Atendimento */
 
begin 
SELECT	a.CD_ESTABELECIMENTO 
INTO STRICT 	CD_ESTABELECIMENTO_W 
FROM 	pessoa_fisica b, 
	ATENDIMENTO_PACIENTE a 
WHERE 	a.NR_ATENDIMENTO 	= NR_ATENDIMENTO_W 
and	a.cd_pessoa_fisica	= b.cd_pessoa_fisica;
exception 
   	when others then 
     	CD_ESTABELECIMENTO_W	:= 1;
	end;
 
if (nr_cirurgia_w > 0) then	 
	CALL Gerar_Partic_Proc_cirurgia( 
				NR_CIRURGIA_W, 
				CD_ESTABELECIMENTO_W, 
				NR_SEQUENCIA_P, 
				CD_CONVENIO_W, 
				CD_CATEGORIA_W, 
				CD_PROCEDIMENTO_W, 
				IE_ORIGEM_PROCED_W, 
				DT_CONTA_W, 
				NM_USUARIO_P);
end if;
 
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gravar_partic_proced (nr_sequencia_p bigint, nm_usuario_p text) FROM PUBLIC;

