-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_alterar_cd_anterior_inter ( nr_seq_intercambio_p bigint, cd_codigo_ant_novo_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE


cd_sistema_anterior_ant_w	varchar(20);


BEGIN

select	cd_sistema_anterior
into STRICT	cd_sistema_anterior_ant_w
from	pls_intercambio
where	nr_sequencia	= nr_seq_intercambio_p;

update	pls_intercambio
set	cd_sistema_anterior	= cd_codigo_ant_novo_p,
	nm_usuario		= nm_usuario_p,
	dt_atualizacao		= clock_timestamp()
where	nr_sequencia		= nr_seq_intercambio_p;

insert into pls_contrato_historico(	nr_sequencia,dt_atualizacao,nm_usuario,dt_atualizacao_nrec,nm_usuario_nrec,
		cd_estabelecimento,nr_seq_intercambio,dt_historico,ie_tipo_historico,ds_historico)
values (	nextval('pls_contrato_historico_seq'),clock_timestamp(),nm_usuario_p,clock_timestamp(),nm_usuario_p,
		cd_estabelecimento_p,nr_seq_intercambio_p,clock_timestamp(),'39','Código anterior antigo: '|| cd_sistema_anterior_ant_w||' para código anterior: '||cd_codigo_ant_novo_p);


commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_alterar_cd_anterior_inter ( nr_seq_intercambio_p bigint, cd_codigo_ant_novo_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

