-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ctb_duplicar_demonstrativo ( nr_sequencia_p bigint, nr_seq_mes_ref_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_sequencia_w		bigint;


BEGIN

select	nextval('ctb_demonstrativo_seq')
into STRICT	nr_sequencia_w
;

insert	into ctb_demonstrativo(
	nr_sequencia,
	nr_seq_mes_ref,
	nr_seq_tipo,
	dt_atualizacao,
	nm_usuario,
	cd_estabelecimento,
	dt_atualizacao_nrec,
	nm_usuario_nrec,
	nr_seq_unid_neg,
	ds_titulo)
(SELECT	nr_sequencia_w,
	nr_seq_mes_ref_p,
	a.nr_seq_tipo,
	clock_timestamp(),
	nm_usuario_p,
	a.cd_estabelecimento,
	clock_timestamp(),
	nm_usuario_p,
	a.nr_seq_unid_neg,
	substr(wheb_mensagem_pck.get_texto(298049,null) || ' ' || ds_titulo,99)
from	ctb_demonstrativo a
where	a.nr_sequencia		= nr_sequencia_p);


insert	into ctb_demo_mes(
	nr_sequencia,
	nr_seq_demo,
	dt_atualizacao,
	nm_usuario,
	nr_seq_mes_ref,
	nr_seq_coluna,
	ie_valor,
	nr_seq_col_1,
	nr_seq_col_2,
	ds_coluna,
	dt_atualizacao_nrec,
	nm_usuario_nrec,
	ie_informacao,
	nr_seq_colunas)
(SELECT	nextval('ctb_demo_mes_seq'),
	nr_sequencia_w,
	clock_timestamp(),
	nm_usuario_p,
	nr_seq_mes_ref,
	b.nr_seq_coluna,
	b.ie_valor,
	b.nr_seq_col_1,
	b.nr_seq_col_2,
	b.ds_coluna,
	clock_timestamp(),
	nm_usuario_p,
	b.ie_informacao,
	b.nr_seq_colunas
from	ctb_demo_mes b
where	b.nr_seq_demo 		= nr_sequencia_p);
commit;


insert into ctb_demonstrativo_lib(	nr_sequencia,
									nr_seq_demonstrativo,
									dt_atualizacao,
									nm_usuario,
									dt_atualizacao_nrec,
									nm_usuario_nrec,
									cd_perfil,
									cd_cargo,
									nm_usuario_lib,
									ie_permissao,
									nr_seq_modelo)
							(SELECT nextval('ctb_demonstrativo_lib_seq'),
									nr_seq_demonstrativo,
									clock_timestamp(),
									nm_usuario_p,
									dt_atualizacao_nrec,
									nm_usuario_nrec,
									cd_perfil,
									cd_cargo,
									nm_usuario_lib,
									ie_permissao,
									nr_seq_modelo
							from	ctb_demonstrativo_lib
							where	nr_seq_demonstrativo = nr_sequencia_p);

commit;


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ctb_duplicar_demonstrativo ( nr_sequencia_p bigint, nr_seq_mes_ref_p bigint, nm_usuario_p text) FROM PUBLIC;

