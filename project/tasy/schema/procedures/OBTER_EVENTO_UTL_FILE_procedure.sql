-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_evento_utl_file ( cd_evento_p bigint, ie_opcao_p text, /* Usado para customizações */
 ds_retorno_p INOUT text, ds_erro_p INOUT text) AS $body$
DECLARE


arq_texto_w		utl_file.file_type;
ds_local_w		varchar(255);
ie_tipo_w			varchar(1);
ds_erro_w		varchar(2000);

/*
Exceção		Error Code	Motivo

access_denied	29289	O acesso ao arquivo foi negado pelo sistema operacional
charsetmismatch	29298	O arquivo foi aberto usando FOPEN_NCHAR,  mas efetuaram-se operações de I/O usando funções nonchar comos PUTF ou GET_LINE
delete_failed	29291	Não foi possível apagar o arquivo
file_open		?	O arquivo já está aberto
internal_error	29286	Erro interno desconhecido no package UTL_FILE
invalid_filehandle	29282	O handle do arquivo não existe
invalid_filename	29288	O arquivo com o nome especificado não foi encontrado neste local
invalid_maxlinesize	29287	O valor de MAX_LINESIZE para FOPEN() é inválido; deveria estar na faixa de 1 a 32767
invalid_mode	29281	O parâmetro open_mode na chamda FOPEN é inválido
invalid_offset	29290	O parâmetro ABSOLUTE_OFFSET para a chamada FSEEK() é inválido; deveria ser maior do que 0 e menor do que o número total de bytes do arquivo
invalid_operation	29283	O arquivo não pôde ser aberto ou operado da forma desejada
invalid_path	29280	O caminho especificado não existe ou não está visível ao Oracle
read_error		29284	Não é possível efetuar a leitura do arquivo
rename_failed	29292	Não é possível renomear o arquivo
write_error		29285	Não foi possível gravar no arquivo

*/
BEGIN

ds_erro_w := '';
begin
	select	ds_local,
		ie_tipo
	into STRICT	ds_local_w,
		ie_tipo_w
	from	evento_tasy_utl_file
	where	cd_evento	= cd_evento_p;
exception
	when no_data_found then
		ds_erro_w  := WHEB_MENSAGEM_PCK.get_texto(281843,null);
	when others then
		ds_erro_w  := WHEB_MENSAGEM_PCK.get_texto(281844,null);
	end;

if (ds_local_w IS NOT NULL AND ds_local_w::text <> '') then

	begin
	if (ie_tipo_w = 'G') then
			arq_texto_w := utl_file.fopen(ds_local_w,'tasy_utl.tmp','W');

			utl_file.put_line(arq_texto_w,'Arquivo gerado pela rotina obter_evento_utl_file. Pode ser apagado.');
			utl_file.fflush(arq_texto_w);
			utl_file.fclose(arq_texto_w);
			utl_file.fremove(ds_local_w, 'tasy_utl.tmp');
	end if;
	exception
	when others then
		if (SQLSTATE = -29289) then
			ds_erro_w  := WHEB_MENSAGEM_PCK.get_texto(281845,null);
		elsif (SQLSTATE = -29298) then
			ds_erro_w  := WHEB_MENSAGEM_PCK.get_texto(281846,null);
		elsif (SQLSTATE = -29291) then
			ds_erro_w  := WHEB_MENSAGEM_PCK.get_texto(281847,null);
		elsif (SQLSTATE = -29286) then
			ds_erro_w  := WHEB_MENSAGEM_PCK.get_texto(281848,null);
		elsif (SQLSTATE = -29282) then
			ds_erro_w  := WHEB_MENSAGEM_PCK.get_texto(281849,null);
		elsif (SQLSTATE = -29288) then
			ds_erro_w  := WHEB_MENSAGEM_PCK.get_texto(281850,null);
		elsif (SQLSTATE = -29287) then
			ds_erro_w  := WHEB_MENSAGEM_PCK.get_texto(281851,null);
		elsif (SQLSTATE = -29281) then
			ds_erro_w  := WHEB_MENSAGEM_PCK.get_texto(281852,null);
		elsif (SQLSTATE = -29290) then
			ds_erro_w  := WHEB_MENSAGEM_PCK.get_texto(281853,null);
		elsif (SQLSTATE = -29283) then
			ds_erro_w  := WHEB_MENSAGEM_PCK.get_texto(281854,null);
		elsif (SQLSTATE = -29280) then
			ds_erro_w  := WHEB_MENSAGEM_PCK.get_texto(281855,null);
		elsif (SQLSTATE = -29284) then
			ds_erro_w  := WHEB_MENSAGEM_PCK.get_texto(281856,null);
		elsif (SQLSTATE = -29292) then
			ds_erro_w  := WHEB_MENSAGEM_PCK.get_texto(281857,null);
		elsif (SQLSTATE = -29285) then
			ds_erro_w  := WHEB_MENSAGEM_PCK.get_texto(281858,null);
		else
			ds_erro_w  := WHEB_MENSAGEM_PCK.get_texto(281859,null);
		end if;
	end;
end if;

ds_erro_p	:= ds_erro_w;
ds_retorno_p	:= ds_local_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_evento_utl_file ( cd_evento_p bigint, ie_opcao_p text,  ds_retorno_p INOUT text, ds_erro_p INOUT text) FROM PUBLIC;

