-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_valida_cmo_pag_web ( ds_arquivo_p INOUT text) AS $body$
DECLARE


/*Utilizado para apresentar o caminho do arquivo da folha de pagamento corretamente no portal */

/*  ds_tipo_so_w
 'L' - Linux    'caminho com /'
 'W' - Windows  ' caminho com \ '*/
ds_arquivo_caminho_w 	pls_ame_lote_rem_arquivo.nm_arquivo%type;
ds_arquivo_caminho_aux_w pls_ame_lote_rem_arquivo.nm_arquivo%type;
ds_saida_arq	UTL_File.File_Type;
nr_posicao_w	bigint;
ds_arquivo_w 	varchar(100);
ds_caminho_w	varchar(150);
ds_tipo_so_w	varchar(1) := 'L';


BEGIN

	ds_arquivo_caminho_w := ds_arquivo_p;
	if (ds_arquivo_caminho_w IS NOT NULL AND ds_arquivo_caminho_w::text <> '')then

		nr_posicao_w := instr(ds_arquivo_caminho_w ,'/', -1, 1);
		if (nr_posicao_w = 0)  then
			nr_posicao_w := instr(ds_arquivo_caminho_w ,'\',-1,1);
			ds_tipo_so_w := 'W';
		end if;
		ds_arquivo_w := substr(ds_arquivo_caminho_w,nr_posicao_w+1,length(ds_arquivo_caminho_w));
		ds_caminho_w := substr(ds_arquivo_caminho_w,1,nr_posicao_w-1);

		begin
		--tenta abrir o arquivo
		ds_saida_arq := UTL_File.Fopen(ds_caminho_w,ds_arquivo_w, 'r');
		exception
		when others then
		-- caso n√£o consiga tenta tratar o caminho invertendo as barras
			begin
			if (ds_tipo_so_w = 'W')then
				ds_arquivo_caminho_aux_w := replace(ds_caminho_w,'\\','/');
				ds_arquivo_caminho_aux_w := replace(ds_arquivo_caminho_aux_w,'\','/')||'/';
			end if;
			ds_arquivo_p := ds_arquivo_caminho_aux_w||ds_arquivo_w;
				begin
				ds_saida_arq := UTL_File.Fopen(ds_arquivo_caminho_aux_w,ds_arquivo_w, 'r');
				exception
				when others then
				ds_arquivo_p := ds_arquivo_caminho_w;
				end;
			end;
		end;
	end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_valida_cmo_pag_web ( ds_arquivo_p INOUT text) FROM PUBLIC;

