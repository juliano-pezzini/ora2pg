-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE med_evolucao_newrecord ( nr_seq_cliente_p bigint, qt_altura_cm_p INOUT bigint) AS $body$
DECLARE


nr_seq_evolucao_w		bigint	:= 0;
qt_altura_cm_w			real	:= 0;
qt_med_consulta_w		bigint	:= 0;


BEGIN

if (nr_seq_cliente_p IS NOT NULL AND nr_seq_cliente_p::text <> '') then
	begin

	select	coalesce(max(nr_sequencia),0)
	into STRICT	nr_seq_evolucao_w
	from	med_evolucao
	where	(qt_altura_cm IS NOT NULL AND qt_altura_cm::text <> '')
	and	nr_seq_cliente      = nr_seq_cliente_p;

	if (nr_seq_evolucao_w <> 0) then
		select	qt_altura_cm
		into STRICT	qt_altura_cm_w
		from	med_evolucao
		where	nr_sequencia = nr_seq_evolucao_w;
	else
		begin
		select	count(*)
		into STRICT	qt_med_consulta_w
		from	med_consulta
		where	ie_tipo_consulta = 3
		and	nr_seq_cliente = nr_seq_cliente_p;

		if (qt_med_consulta_w <> 0) then
			select	coalesce(qt_altura_cm,0)
			into STRICT	qt_altura_cm_w
			from	med_consulta
			where	ie_tipo_consulta = 3
			and	nr_seq_cliente = nr_seq_cliente_p;
		end if;
		end;
	end if;

	end;
end if;

qt_altura_cm_p	:= qt_altura_cm_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE med_evolucao_newrecord ( nr_seq_cliente_p bigint, qt_altura_cm_p INOUT bigint) FROM PUBLIC;

