-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE tws_solic_autorizacao ( nr_seq_guia_p pls_guia_plano.nr_sequencia%type, id_app_externo_p bigint, ie_app_externo_p text, nm_usuario_p text) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
Rotina chamada após o insert da guia, gera as validações de regras e consistências.
-------------------------------------------------------------------------------------------------------------------

Locais de chamada direta: 
[  ]  Objetos do dicionário [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios x Outros: TWS
 ------------------------------------------------------------------------------------------------------------------

Pontos de atenção:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
 

cd_estabelecimento_w		estabelecimento.cd_estabelecimento%type;
ds_retorno_contr_inter_w	varchar(4000);
ie_transacao_w			varchar(2);
cd_cooperativa_w		pls_congenere.cd_cooperativa%type;
ie_tipo_intercambio_w		varchar(4);
ie_status_w			pls_guia_plano.ie_status%type;
ie_estagio_w			pls_guia_plano.ie_estagio%type;


BEGIN
select	cd_estabelecimento
into STRICT	cd_estabelecimento_w
from	pls_guia_plano
where	nr_sequencia	= nr_seq_guia_p;

ds_retorno_contr_inter_w := pls_valida_controle_int_guia(nr_seq_guia_p, cd_estabelecimento_w, nm_usuario_p, ds_retorno_contr_inter_w);

if (coalesce(ds_retorno_contr_inter_w::text, '') = '') then
	SELECT * FROM pls_enviar_autorizacao_web(	nr_seq_guia_p, null, 'N', 'N', 'N', 'N', cd_estabelecimento_w, nm_usuario_p, ie_transacao_w, cd_cooperativa_w, ie_tipo_intercambio_w, ie_status_w, ie_estagio_w) INTO STRICT ie_transacao_w, cd_cooperativa_w, ie_tipo_intercambio_w, ie_status_w, ie_estagio_w;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tws_solic_autorizacao ( nr_seq_guia_p pls_guia_plano.nr_sequencia%type, id_app_externo_p bigint, ie_app_externo_p text, nm_usuario_p text) FROM PUBLIC;

