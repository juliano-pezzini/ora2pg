-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_analise_canc_item_conta ( nr_seq_analise_p bigint, ie_tipo_p text, nr_seq_conta_p bigint, nr_seq_item_subs_p bigint, nr_seq_ocorrencia_p bigint, nr_seq_motivo_glosa_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
Finalidade: 
------------------------------------------------------------------------------------------------------------------- 
Locais de chamada direta: 
[ ] Objetos do dicionário [ X] Tasy (Delphi/Java) [ ] Portal [ ] Relatórios [ ] Outros: 
 ------------------------------------------------------------------------------------------------------------------ 
Pontos de atenção: 
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
 
 
nr_seq_item_criado_w		bigint;
nr_seq_glosa_conta_w		bigint;
nr_seq_conta_proc_w		bigint;
nr_seq_conta_mat_w		bigint;
nr_seq_conta_w			pls_conta.nr_sequencia%type;


BEGIN 
 
select	CASE WHEN ie_tipo_p='P' THEN  nr_seq_item_subs_p  ELSE null END  
into STRICT	nr_seq_conta_proc_w
;
 
select	CASE WHEN ie_tipo_p='M' THEN  nr_seq_item_subs_p  ELSE null END  
into STRICT	nr_seq_conta_mat_w
;
 
if (nr_seq_conta_proc_w IS NOT NULL AND nr_seq_conta_proc_w::text <> '') then 
	select	nr_seq_conta 
	into STRICT	nr_seq_conta_w 
	from	pls_conta_proc 
	where	nr_sequencia 	= nr_seq_conta_proc_w;
elsif (nr_seq_conta_mat_w IS NOT NULL AND nr_seq_conta_mat_w::text <> '') then 
	select	nr_seq_conta 
	into STRICT	nr_seq_conta_w 
	from	pls_conta_mat 
	where	nr_sequencia 	= nr_seq_conta_mat_w;
end if;	
/* Inserir motivo de glosa/ ocorrência */
 
if (nr_seq_ocorrencia_p IS NOT NULL AND nr_seq_ocorrencia_p::text <> '') or (nr_seq_motivo_glosa_p IS NOT NULL AND nr_seq_motivo_glosa_p::text <> '') then 
	 
	nr_seq_glosa_conta_w := pls_analise_inserir_glosa_item(nr_seq_analise_p, nr_seq_conta_w, nr_seq_conta_proc_w, nr_seq_conta_mat_w, null, nr_seq_ocorrencia_p, nr_seq_motivo_glosa_p, 'N', cd_estabelecimento_p, nm_usuario_p, 'N', nr_seq_glosa_conta_w);
end if;
 
CALL pls_cancelar_item_conta(ie_tipo_p, nr_seq_conta_w, nr_seq_item_subs_p, nm_usuario_p, null, null, cd_estabelecimento_p);
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_analise_canc_item_conta ( nr_seq_analise_p bigint, ie_tipo_p text, nr_seq_conta_p bigint, nr_seq_item_subs_p bigint, nr_seq_ocorrencia_p bigint, nr_seq_motivo_glosa_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

