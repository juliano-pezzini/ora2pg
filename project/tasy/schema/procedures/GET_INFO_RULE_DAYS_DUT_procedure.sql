-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE get_info_rule_days_dut (cd_convenio_p regra_dias_autor_dut.cd_convenio%type, ie_tipo_atendimento_p regra_dias_autor_dut.ie_tipo_atendimento%type, dt_vigencia_p regra_dias_autor_dut.dt_inicio_vigencia%type, cd_procedimento_p regra_dias_autor_dut.cd_procedimento%type, ie_origem_proced_p regra_dias_autor_dut.ie_origem_proced%type, nr_seq_proc_interno_p regra_dias_autor_dut.nr_seq_proc_interno%type, ie_tipo_autorizacao_p INOUT regra_dias_autor_dut.ie_tipo_autorizacao%type, nm_usuario_resp_p INOUT regra_dias_autor_dut.nm_usuario_resp%type, qt_dias_autorizacao_p INOUT regra_dias_autor_dut.qt_dias_autorizacao%type, nr_sequencia_p INOUT regra_dias_autor_dut.nr_sequencia%type, ds_informacao_dut_p INOUT regra_dias_autor_dut.ds_informacao_dut%type) AS $body$
DECLARE


cd_convenio_w		regra_dias_autor_dut.cd_convenio%type;
ie_tipo_atendimento_w	regra_dias_autor_dut.ie_tipo_atendimento%type;
dt_vigencia_w		regra_dias_autor_dut.dt_inicio_vigencia%type;
cd_procedimento_w	regra_dias_autor_dut.cd_procedimento%type;
ie_origem_proced_w	regra_dias_autor_dut.ie_origem_proced%type;
nr_seq_proc_interno_w	regra_dias_autor_dut.nr_seq_proc_interno%type;
ie_tipo_autorizacao_w 	regra_dias_autor_dut.ie_tipo_autorizacao%type;
nm_usuario_resp_w 	regra_dias_autor_dut.nm_usuario_resp%type;
qt_dias_autorizacao_w 	regra_dias_autor_dut.qt_dias_autorizacao%type;
cd_area_procedimento_w	regra_dias_autor_dut.cd_area_procedimento%type;
cd_especialidade_w	regra_dias_autor_dut.cd_especialidade%type;
cd_grupo_proc_w		regra_dias_autor_dut.cd_grupo_proc%type;
nr_sequencia_w		regra_dias_autor_dut.nr_sequencia%type;
ds_informacao_dut_w	regra_dias_autor_dut.ds_informacao_dut%type;

c_info_usuario CURSOR FOR
		SELECT	ie_tipo_autorizacao,
			nm_usuario_resp,
			qt_dias_autorizacao,
			nr_sequencia,
			ds_informacao_dut
		from	regra_dias_autor_dut
		where	coalesce(cd_convenio, cd_convenio_w) = cd_convenio_w
		and 	coalesce(ie_tipo_atendimento, ie_tipo_atendimento_w) = ie_tipo_atendimento_w
		and 	dt_vigencia_w between coalesce(dt_inicio_vigencia, dt_vigencia_w) and coalesce(dt_final_vigencia, dt_vigencia_w)
		and 	coalesce(cd_procedimento, cd_procedimento_w) = cd_procedimento_w
		and 	coalesce(ie_origem_proced, ie_origem_proced_w) = ie_origem_proced_w
		and 	coalesce(nr_seq_proc_interno, nr_seq_proc_interno_w) = nr_seq_proc_interno_w
		and 	coalesce(cd_area_procedimento, cd_area_procedimento_w) = cd_area_procedimento_w
		and 	coalesce(cd_especialidade, cd_especialidade_w) = cd_especialidade_w
		and 	coalesce(cd_grupo_proc, cd_grupo_proc_w) = cd_grupo_proc_w
		order by	cd_procedimento,
				nr_seq_proc_interno,
				cd_area_procedimento,
				cd_especialidade,
				cd_grupo_proc,
				cd_convenio,
				ie_tipo_atendimento;
BEGIN

cd_convenio_w		:= coalesce(cd_convenio_p, 0);
ie_tipo_atendimento_w	:= coalesce(ie_tipo_atendimento_p, 0);
dt_vigencia_w		:= coalesce(dt_vigencia_p, clock_timestamp());
cd_procedimento_w	:= coalesce(cd_procedimento_p, 0);
ie_origem_proced_w	:= coalesce(ie_origem_proced_p, 0);
nr_seq_proc_interno_w	:= coalesce(nr_seq_proc_interno_p, 0);

select 	coalesce(max(cd_area_procedimento),0),
	coalesce(max(cd_especialidade),0),
	coalesce(max(cd_grupo_proc),0)
into STRICT 	cd_area_procedimento_w,
	cd_especialidade_w,
	cd_grupo_proc_w
from	estrutura_procedimento_v
where	cd_procedimento		= cd_procedimento_p
and	ie_origem_proced	= ie_origem_proced_p;

for r_c_info_usuario in c_info_usuario loop
	ie_tipo_autorizacao_p	:= r_c_info_usuario.ie_tipo_autorizacao;
	nm_usuario_resp_p	:= r_c_info_usuario.nm_usuario_resp;
	qt_dias_autorizacao_p	:= r_c_info_usuario.qt_dias_autorizacao;
	nr_sequencia_p		:= r_c_info_usuario.nr_sequencia;
	ds_informacao_dut_p	:= r_c_info_usuario.ds_informacao_dut;
end loop;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE get_info_rule_days_dut (cd_convenio_p regra_dias_autor_dut.cd_convenio%type, ie_tipo_atendimento_p regra_dias_autor_dut.ie_tipo_atendimento%type, dt_vigencia_p regra_dias_autor_dut.dt_inicio_vigencia%type, cd_procedimento_p regra_dias_autor_dut.cd_procedimento%type, ie_origem_proced_p regra_dias_autor_dut.ie_origem_proced%type, nr_seq_proc_interno_p regra_dias_autor_dut.nr_seq_proc_interno%type, ie_tipo_autorizacao_p INOUT regra_dias_autor_dut.ie_tipo_autorizacao%type, nm_usuario_resp_p INOUT regra_dias_autor_dut.nm_usuario_resp%type, qt_dias_autorizacao_p INOUT regra_dias_autor_dut.qt_dias_autorizacao%type, nr_sequencia_p INOUT regra_dias_autor_dut.nr_sequencia%type, ds_informacao_dut_p INOUT regra_dias_autor_dut.ds_informacao_dut%type) FROM PUBLIC;

