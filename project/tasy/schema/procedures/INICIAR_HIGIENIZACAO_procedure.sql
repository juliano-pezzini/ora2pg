-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE iniciar_higienizacao ( nr_atendimento_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text, ie_opcao_p INOUT bigint, cd_setor_atendimento_p INOUT bigint, cd_unidade_basica_p INOUT text, cd_unidade_compl_p INOUT text, ie_solicitar_senha_p INOUT text) AS $body$
DECLARE

 
ie_inic_higienizacao_auto_w	varchar(1);
ie_permite_higienizar_w	varchar(1);
ie_permite_hig_inic_w	varchar(1);
ie_inic_higienizacao_total_w	varchar(1);
ie_opcao_sub_w		smallint	:= 0;
ie_regra_lib_setor_higie_w	varchar(1);


BEGIN 
ie_opcao_p	:= 0;
 
/* Movimentação de Pacientes - Parâmetro [117] - Iniciar a higienização do leito automaticamente ao gerar a saída real do paciente */
 
ie_inic_higienizacao_auto_w := obter_param_usuario(3111, 117, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, ie_inic_higienizacao_auto_w);
 
if (ie_inic_higienizacao_auto_w = 'S') then 
	ie_opcao_sub_w	:= 10;
end if;
 
if (ie_opcao_sub_w > 0) then 
	goto iniciar;
end if;
 
<<total>> 
 
/* Movimentação de Pacientes - Parâmetro [120] - Realizar a higienização do leito automaticamente ao gerar a saída real do paciente */
 
ie_inic_higienizacao_total_w := obter_param_usuario(3111, 120, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, ie_inic_higienizacao_total_w);
 
if (ie_inic_higienizacao_total_w = 'S') then 
	ie_opcao_sub_w	:= 11;
end if;
 
<<iniciar>> 
 
if (ie_opcao_sub_w > 0) then 
	begin 
	/* Movimentação de Pacientes - Parâmetro [118] - Permite Higienizar e Liberar Leitos */
 
	ie_permite_higienizar_w := obter_param_usuario(3111, 118, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, ie_permite_higienizar_w);
 
	cd_setor_atendimento_p	:= obter_unidade_atendimento(nr_atendimento_p, 'IA', 'CS');
 
	if (ie_permite_higienizar_w = 'S') then 
		ie_opcao_p	:= ie_opcao_sub_w;
	else 
		/* Movimentação de Pacientes - Parâmetro [119] - Permite iniciar a higienização */
 
		ie_permite_hig_inic_w := obter_param_usuario(3111, 119, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, ie_permite_hig_inic_w);
 
		if (ie_permite_hig_inic_w = 'S') then 
			ie_opcao_p	:= ie_opcao_sub_w;
		elsif (ie_permite_hig_inic_w = 'D') then 
			begin 
			ie_regra_lib_setor_higie_w	:= obter_se_regra_lib_setor_higie(cd_setor_atendimento_p, obter_perfil_ativo, nm_usuario_p, 0);
 
			if (ie_regra_lib_setor_higie_w = 'S') then 
				ie_opcao_p	:= ie_opcao_sub_w;
			end if;
			end;
		end if;
	end if;
 
	if (ie_opcao_p > 0) then 
		begin 
		cd_unidade_basica_p	:= obter_unidade_atendimento(nr_atendimento_p, 'A', 'UB');
		cd_unidade_compl_p	:= obter_unidade_atendimento(nr_atendimento_p, 'A', 'UC');
 
		ie_solicitar_senha_p := higienizar_js( 
			1, ie_opcao_p, cd_setor_atendimento_p, cd_unidade_basica_p, cd_unidade_compl_p, '', nm_usuario_p, cd_estabelecimento_p, ie_solicitar_senha_p);
		end;
	end if;
 
	if (ie_opcao_sub_w = 10) then 
		begin 
		ie_opcao_sub_w	:= 0;
		goto total;
		end;
	end if;
	end;
end if;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE iniciar_higienizacao ( nr_atendimento_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text, ie_opcao_p INOUT bigint, cd_setor_atendimento_p INOUT bigint, cd_unidade_basica_p INOUT text, cd_unidade_compl_p INOUT text, ie_solicitar_senha_p INOUT text) FROM PUBLIC;

