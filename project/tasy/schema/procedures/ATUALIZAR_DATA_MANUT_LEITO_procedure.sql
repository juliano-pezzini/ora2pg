-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_data_manut_leito ( nr_sequencia_p bigint, nm_usuario_p text, ie_acao_p text) AS $body$
DECLARE


ie_acao_w sl_historico_acao.ie_acao%type := 'LM';


BEGIN

if (coalesce(nr_sequencia_p,0) > 0) then
	if (ie_acao_p = 'I') then
	
		update sl_unid_atend
		set  dt_manutencao     = clock_timestamp(),
		nm_usuario_manutencao = nm_usuario_p
		where nr_sequencia    = nr_sequencia_p;
		
		ie_acao_w := 'M';
		
	elsif (ie_acao_p = 'F')  then
	
		update sl_unid_atend
		set  dt_fim_manutencao     = clock_timestamp(),
		nm_usuario_fim_manutencao = nm_usuario_p
		where nr_sequencia       = nr_sequencia_p;
		
	end if;
		
	if (ie_acao_p in ('I', 'F')) then
		CALL inserir_hist_gestao_servico(ie_acao_w, nr_sequencia_p, nm_usuario_p);
	end if;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_data_manut_leito ( nr_sequencia_p bigint, nm_usuario_p text, ie_acao_p text) FROM PUBLIC;

