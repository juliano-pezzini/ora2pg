-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizardataenviolotealvaro (nr_prescricao_p bigint) AS $body$
BEGIN
update lab_lote_externo l
set    l.dt_envio = clock_timestamp()
where  l.nr_sequencia in (SELECT distinct pp.nr_seq_lote_externo
                          from   lab_lote_alvaro_v b, prescr_procedimento pp, lab_exame_equip lee, equipamento_lab c, material_exame_lab d
                          where  b.nr_prescricao = nr_prescricao_p
                          and    (((select coalesce(max(a.ie_utiliza_cod_equip), 'N')
                                    from   empresa_integr_dados a
                                    where  a.nr_seq_empresa_integr = 12
                                    and    a.ie_situacao = 'A') = 'S' and (b.cd_exame_equip IS NOT NULL AND b.cd_exame_equip::text <> '')) or (select coalesce(max(a.ie_utiliza_cod_equip), 'N')
                                  from   empresa_integr_dados a
                                  where  a.nr_seq_empresa_integr = 12
                                  and    a.ie_situacao = 'A') = 'N')
                          and    pp.nr_seq_exame      = lee.nr_seq_exame
                          and    lee.cd_equipamento   = c.cd_equipamento
                          and    pp.cd_material_exame = d.cd_material_exame
                          and    pp.nr_prescricao      = b.nr_prescricao
                          and    pp.nr_sequencia      = b.nr_sequencia
                          and (lee.nr_seq_material = d.nr_sequencia or coalesce(lee.nr_seq_material::text, '') = '')
                          and    c.ds_sigla = 'ALVARO');

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizardataenviolotealvaro (nr_prescricao_p bigint) FROM PUBLIC;

