-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE propaga_localizacao_controlado ( cd_material_p bigint, cd_estab_p bigint, cd_local_estoque_p bigint) AS $body$
DECLARE


nr_seq_localizacao_w	bigint;
ds_localizacao_w	varchar(80);


BEGIN

if (coalesce(cd_estab_p::text, '') = '') then
	select	max(nr_seq_localizacao)
	into STRICT	nr_seq_localizacao_w
	from	material
	where	cd_material = cd_material_p;

	if (nr_seq_localizacao_w IS NOT NULL AND nr_seq_localizacao_w::text <> '') then
		update	material
		set	nr_seq_localizacao = nr_seq_localizacao_w
		where	cd_material_estoque = cd_material_p
		and	cd_material <> cd_material_p;
	end if;
else
	select	ds_localizacao,
		nr_seq_local
	into STRICT	ds_localizacao_w,
		nr_seq_localizacao_w
	from	localizacao_estoque_local
	where	cd_estabelecimento = cd_estab_p
	and	cd_local_estoque = cd_local_estoque_p
	and	cd_material = cd_material_p;

	if (nr_seq_localizacao_w IS NOT NULL AND nr_seq_localizacao_w::text <> '') then
		update	localizacao_estoque_local
		set	nr_seq_local = nr_seq_localizacao_w
		where	obter_controlador_estoque(cd_material) = cd_material_p
		and	cd_material <> cd_material_p
		and	cd_estabelecimento = cd_estab_p
		and	cd_local_estoque = cd_local_estoque_p;
	end if;

	if (ds_localizacao_w IS NOT NULL AND ds_localizacao_w::text <> '') then
		update	localizacao_estoque_local
		set	ds_localizacao = ds_localizacao_w
		where	obter_controlador_estoque(cd_material) = cd_material_p
		and	cd_material <> cd_material_p
		and	cd_estabelecimento = cd_estab_p
		and	cd_local_estoque = cd_local_estoque_p;
	end if;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE propaga_localizacao_controlado ( cd_material_p bigint, cd_estab_p bigint, cd_local_estoque_p bigint) FROM PUBLIC;

