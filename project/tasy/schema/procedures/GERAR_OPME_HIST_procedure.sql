-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_opme_hist (nr_seq_opme_p bigint, ie_historico_p text, nm_usuario_hist_p text, ds_historico_p text, dt_atualizacao_P timestamp) AS $body$
DECLARE


nr_seq_hist_w	bigint;


BEGIN
if (nr_seq_opme_p IS NOT NULL AND nr_seq_opme_p::text <> '') and (ie_historico_p IS NOT NULL AND ie_historico_p::text <> '') and (ds_historico_p IS NOT NULL AND ds_historico_p::text <> '') and (dt_atualizacao_P IS NOT NULL AND dt_atualizacao_P::text <> '') then

	/* obter sequence */

	select	nextval('agenda_pac_opme_hist_seq')
	into STRICT	nr_seq_hist_w
	;

	/* gerar hist√≥rico */

	insert into agenda_pac_opme_hist(
						nr_sequencia,
						ds_acao,
						dt_atualizacao,
						dt_atualizacao_nrec,
						ie_acao,
						nm_usuario,
						nm_usuario_acao,
						nm_usuario_nrec,
						nr_seq_opme
						)
	values (
						nr_seq_hist_w,
						substr(ds_historico_p,1,255),
						clock_timestamp(),
						dt_atualizacao_P,
						ie_historico_p,
						coalesce(nm_usuario_hist_p, 'WebService'),
						coalesce(nm_usuario_hist_p, 'WebService'),
						coalesce(nm_usuario_hist_p, 'WebService'),
						nr_seq_opme_p
						);
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_opme_hist (nr_seq_opme_p bigint, ie_historico_p text, nm_usuario_hist_p text, ds_historico_p text, dt_atualizacao_P timestamp) FROM PUBLIC;

