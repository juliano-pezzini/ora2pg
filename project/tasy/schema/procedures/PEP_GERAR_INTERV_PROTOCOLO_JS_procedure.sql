-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pep_gerar_interv_protocolo_js (nr_sequencia_p bigint, ds_lista_prot_proc_p text, nm_usuario_p text, cd_estabelecimento_p bigint, ie_free_item_p text default null) AS $body$
DECLARE


nr_seq_proc_interno_w	bigint;
nr_seq_prot_proc_w	bigint;
nr_seq_proc_w		bigint;
posicao_virgula_w 	bigint;
posicao_traco_w		bigint;
nr_max_loop_w		smallint := 9999;
ds_lista_prot_proc_w	varchar(10000);
nr_seq_topografia_w	bigint;


BEGIN
if (ds_lista_prot_proc_p IS NOT NULL AND ds_lista_prot_proc_p::text <> '') then
	begin
	ds_lista_prot_proc_w := ds_lista_prot_proc_p;
	while(ds_lista_prot_proc_w IS NOT NULL AND ds_lista_prot_proc_w::text <> '') and (nr_max_loop_w > 0) loop
		begin		
		if (ds_lista_prot_proc_w IS NOT NULL AND ds_lista_prot_proc_w::text <> '') then
			begin
			posicao_traco_w	 	:= position('-' in ds_lista_prot_proc_w);
			nr_seq_prot_proc_w	:= substr(ds_lista_prot_proc_w,0,posicao_traco_w-1);
			ds_lista_prot_proc_w 	:= substr(ds_lista_prot_proc_w,posicao_traco_w+1,length(ds_lista_prot_proc_w));

			posicao_traco_w	 	:= position('-' in ds_lista_prot_proc_w);
			nr_seq_proc_w		:= substr(ds_lista_prot_proc_w,0,posicao_traco_w-1);

			ds_lista_prot_proc_w 	:= substr(ds_lista_prot_proc_w,posicao_traco_w+1,length(ds_lista_prot_proc_w));

			posicao_traco_w	 	:= position('-' in ds_lista_prot_proc_w);
			ds_lista_prot_proc_w 	:= substr(ds_lista_prot_proc_w,posicao_traco_w+1,length(ds_lista_prot_proc_w));

			posicao_virgula_w 	:= position(',' in ds_lista_prot_proc_w);
			nr_seq_topografia_w	:= substr(ds_lista_prot_proc_w,0,(posicao_virgula_w-1));

			ds_lista_prot_proc_w := substr(ds_lista_prot_proc_w,posicao_virgula_w+1,length(ds_lista_prot_proc_w));

			if (ds_lista_prot_proc_w = ',') then
				begin
				ds_lista_prot_proc_w := null;
				end;
			end if;
			end;
		elsif (ds_lista_prot_proc_w IS NOT NULL AND ds_lista_prot_proc_w::text <> '') and (ds_lista_prot_proc_w <> '') then
			begin
			nr_seq_prot_proc_w := (replace(ds_lista_prot_proc_w, ',', ''))::numeric;
			ds_lista_prot_proc_w := '';
			end;
		end if;

		if (nr_seq_prot_proc_w IS NOT NULL AND nr_seq_prot_proc_w::text <> '') and (nr_seq_prot_proc_w > 0) then
			begin	
			CALL gerar_intervencao_protocolo(nr_sequencia_p,nr_seq_prot_proc_w,nr_seq_proc_w,nm_usuario_p,null,null,null,nr_seq_topografia_w,ie_free_item_p);
			end;
		end if;

		nr_max_loop_w := nr_max_loop_w -1;
		end;
	end loop;
	end;
end if;

commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pep_gerar_interv_protocolo_js (nr_sequencia_p bigint, ds_lista_prot_proc_p text, nm_usuario_p text, cd_estabelecimento_p bigint, ie_free_item_p text default null) FROM PUBLIC;

