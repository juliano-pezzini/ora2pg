-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consistir_orc_cen_regra_post ( cd_empresa_p bigint, cd_conta_contabil_p text, cd_centro_custo_p bigint, cd_centro_origem_p bigint, nr_inicial_p bigint, nr_final_p bigint, dt_inicial_p timestamp, dt_final_p timestamp, nm_usuario_p text) AS $body$
DECLARE


ie_resultado_w	varchar(1);
ie_result_w	varchar(1);
dt_inicial_w	timestamp;
dt_final_w	timestamp;


BEGIN
if (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') then
	begin
	CALL consiste_post_ctb_regra_ticket(cd_empresa_p, cd_conta_contabil_p, cd_centro_custo_p, nm_usuario_p);

	if (cd_centro_origem_p IS NOT NULL AND cd_centro_origem_p::text <> '') then
		begin
		ie_resultado_w := ctb_obter_se_centro_usuario(cd_centro_origem_p, cd_empresa_p, nm_usuario_p);

		if (ie_resultado_w <> 'S') then
			begin
			CALL wheb_mensagem_pck.exibir_mensagem_abort(184609,'DS_ERRO_W=' || obter_texto_tasy(44278, wheb_usuario_pck.get_nr_seq_idioma));
			end;
		end if;
		end;
	end if;

	dt_inicial_w := substr(ctb_obter_mes_ref(nr_inicial_p),1,255);

	dt_final_w := substr(ctb_obter_mes_ref(nr_final_p),1,255);

	if (dt_inicial_w > dt_final_w) then
		begin
		CALL wheb_mensagem_pck.exibir_mensagem_abort(184609,'DS_ERRO_W=' || obter_texto_tasy(52063, wheb_usuario_pck.get_nr_seq_idioma));
		end;
	end if;

	if (dt_inicial_p > dt_final_p) then
		begin
		CALL wheb_mensagem_pck.exibir_mensagem_abort(184609,'DS_ERRO_W=' || obter_texto_tasy(52063, wheb_usuario_pck.get_nr_seq_idioma));
		end;
	end if;

	ie_resultado_w := null;
	ie_resultado_w := ctb_obter_se_vigente(dt_inicial_p, dt_inicial_w, dt_final_w);

	ie_result_w := ctb_obter_se_vigente(dt_final_p, dt_inicial_w, dt_final_w);

	if (ie_resultado_w = 'N' or ie_result_w = 'N') then
		begin
		CALL wheb_mensagem_pck.exibir_mensagem_abort(184609,'DS_ERRO_W=' || obter_texto_tasy(52035, wheb_usuario_pck.get_nr_seq_idioma));
		end;
	end if;
	end;
end if;
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consistir_orc_cen_regra_post ( cd_empresa_p bigint, cd_conta_contabil_p text, cd_centro_custo_p bigint, cd_centro_origem_p bigint, nr_inicial_p bigint, nr_final_p bigint, dt_inicial_p timestamp, dt_final_p timestamp, nm_usuario_p text) FROM PUBLIC;

