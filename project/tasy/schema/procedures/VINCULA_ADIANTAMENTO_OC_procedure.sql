-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE vincula_adiantamento_oc ( nr_adiantamento_p bigint, nr_ordem_compra_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_sequencia_w			bigint;
vl_adiantamento_w		double precision;


BEGIN

select	nextval('ordem_compra_adiant_pago_seq')
into STRICT	nr_sequencia_w
;

select	vl_adiantamento
into STRICT	vl_adiantamento_w
from	adiantamento_pago
where	nr_adiantamento = nr_adiantamento_p;

insert into ordem_compra_adiant_pago(
	nr_sequencia,
	dt_atualizacao,
	nm_usuario,
	nr_ordem_compra,
	nr_adiantamento,
	vl_vinculado,
	dt_atualizacao_nrec,
	nm_usuario_nrec) values (
		nr_sequencia_w,
		clock_timestamp(),
		nm_usuario_p,
		nr_ordem_compra_p,
		nr_adiantamento_p,
		vl_adiantamento_w,
		clock_timestamp(),
		nm_usuario_p);

/*update	adiantamento_pago
set	vl_saldo = 0,
	dt_baixa = sysdate
where	nr_adiantamento = nr_adiantamento_p;*/
CALL atualizar_saldo_adiant_pago(nr_adiantamento_p,wheb_usuario_pck.get_nm_usuario);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE vincula_adiantamento_oc ( nr_adiantamento_p bigint, nr_ordem_compra_p bigint, nm_usuario_p text) FROM PUBLIC;

