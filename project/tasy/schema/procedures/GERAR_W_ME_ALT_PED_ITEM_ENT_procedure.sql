-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_w_me_alt_ped_item_ent ( data_p text, nr_seq_item_p bigint, quantidade_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_seq_me_alt_item_ent_w	bigint;
data_w	timestamp;
nr_ordem_compra_w				w_me_altera_pedido.numeropedidowpd%type;


BEGIN

data_w:= to_date(substr(replace(data_p,'-','/'),1,10),'yyyy-mm-dd');

select	max(a.nr_seq_pedido) /*erro aqui*/
into STRICT	nr_ordem_compra_w
from	w_me_altera_pedido_item a,
		w_me_altera_pedido b
where 	b.nr_sequencia = a.nr_seq_pedido
and 	a.nr_sequencia = nr_seq_item_p;

CALL inserir_log_me('OC', substr(nr_ordem_compra_w||'@',1,position('@' in nr_ordem_compra_w||'@')-1), 'AVISO', 'ROC', (WHEB_MENSAGEM_PCK.get_texto(162620) || ' ' || nr_ordem_compra_w), '138', nm_usuario_p,'');
/* Alterar datas de entrega dos itens da ordem de compra */

select	nextval('w_me_altera_ped_item_ent_seq')
into STRICT	nr_seq_me_alt_item_ent_w
;


insert into w_me_altera_ped_item_ent(
	nr_sequencia,
	dt_atualizacao,
	nm_usuario,
	dt_atualizacao_nrec,
	nm_usuario_nrec,
	data,
	nr_seq_item,
	quantidade)
values (	nr_seq_me_alt_item_ent_w,
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	data_w,
	nr_seq_item_p,
	quantidade_p);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_w_me_alt_ped_item_ent ( data_p text, nr_seq_item_p bigint, quantidade_p bigint, nm_usuario_p text) FROM PUBLIC;

