-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ptu_consistir_ordem_servico ( nr_seq_ordem_serv_p bigint, nm_usuario_p text ) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: Validar os campos obrigatórios na transação de Ordem de serviço do PTU 6.0

-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  x]  Objetos do dicionário [ ] Tasy (Delphi/Java) [   ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
Performace;
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
cd_unimed_solicitante_w		ptu_requisicao_ordem_serv.cd_unimed_solicitante%type;
nr_seq_prestador_req_w		ptu_requisicao_ordem_serv.nr_seq_prestador_req%type;
cd_unimed_prestador_req_w	ptu_requisicao_ordem_serv.cd_unimed_prestador_req%type;
cd_unimed_prestador_w		ptu_requisicao_ordem_serv.cd_unimed_prestador%type;
nr_seq_prestador_w		ptu_requisicao_ordem_serv.nr_seq_prestador%type;
ie_urg_emerg_w			ptu_requisicao_ordem_serv.ie_urg_emerg%type;
dt_validade_w			ptu_requisicao_ordem_serv.dt_validade%type;
ie_recem_nascido_w		ptu_requisicao_ordem_serv.ie_recem_nascido%type;
sg_conselho_profissional_w	ptu_requisicao_ordem_serv.sg_conselho_profissional%type;
nr_conselho_profissional_w	ptu_requisicao_ordem_serv.nr_conselho_profissional%type;
uf_conselho_profissional_w	ptu_requisicao_ordem_serv.uf_conselho_profissional%type;
ds_ind_clinica_w		ptu_requisicao_ordem_serv.ds_ind_clinica%type;
ie_tipo_acidente_w		ptu_requisicao_ordem_serv.ie_tipo_acidente%type;
ie_liminar_w			ptu_requisicao_ordem_serv.ie_liminar%type;
cd_municipio_ibge_w		ptu_requisicao_ordem_serv.cd_municipio_ibge%type;
nr_versao_tiss_w		ptu_requisicao_ordem_serv.nr_versao_tiss%type;
nr_idade_w			ptu_requisicao_ordem_serv.nr_idade%type;
ie_sexo_w			ptu_requisicao_ordem_serv.ie_sexo%type;
nm_prestador_w			ptu_requisicao_ordem_serv.nm_prestador%type;
dt_prov_atendimento_w		ptu_requisicao_ordem_serv.dt_prov_atendimento%type;
qt_prestador_w			bigint;
qt_intern_w			bigint;
qt_consist_w			bigint;
qt_anexo_radio_quimio_w		bigint;

C01 CURSOR FOR
	SELECT	nr_sequencia,
		cd_consistencia
	from	ptu_consitencia_envio
	where	ie_tipo_transacao 	= '2'
	and	ie_situacao		= 'A'
	order by 1;

--cursor itens
C02 CURSOR FOR
	SELECT	cd_servico,
		ds_opme,
		ie_tipo_anexo,
		ie_opcao_fabricante,
		vl_servico,
		vl_uni_servico,
		cd_referencia_fab,
		dt_provavel,
		qt_frequencia_adm,
		cd_via_administracao,
		cd_anvisa,
		qt_unidade_medida,
		qt_dosagem_total
	from	ptu_req_ord_serv_servico
	where	nr_seq_req_ord		= nr_seq_ordem_serv_p;
BEGIN

if (nr_seq_ordem_serv_p IS NOT NULL AND nr_seq_ordem_serv_p::text <> '') then

	select	cd_unimed_solicitante,
		nr_seq_prestador_req,
		cd_unimed_prestador_req,
		cd_unimed_prestador,
		nr_seq_prestador,
		ie_urg_emerg,
		dt_validade,
		ie_recem_nascido,
		nr_idade,
		ie_sexo,
		nm_prestador,
		sg_conselho_profissional,
		nr_conselho_profissional,
		uf_conselho_profissional,
		ds_ind_clinica,
		ie_tipo_acidente,
		ie_liminar,
		cd_municipio_ibge,
		dt_prov_atendimento
	into STRICT	cd_unimed_solicitante_w,
		nr_seq_prestador_req_w,
		cd_unimed_prestador_req_w,
		cd_unimed_prestador_w,
		nr_seq_prestador_w,
		ie_urg_emerg_w,
		dt_validade_w,
		ie_recem_nascido_w,
		nr_idade_w,
		ie_sexo_w,
		nm_prestador_w,
		sg_conselho_profissional_w,
		nr_conselho_profissional_w,
		uf_conselho_profissional_w,
		ds_ind_clinica_w,
		ie_tipo_acidente_w,
		ie_liminar_w,
		cd_municipio_ibge_w,
		dt_prov_atendimento_w
	from	ptu_requisicao_ordem_serv
	where	nr_sequencia = nr_seq_ordem_serv_p;

	select	count(1)
	into STRICT	qt_intern_w
	from	ptu_req_ord_serv_servico
	where	nr_seq_req_ord = nr_seq_ordem_serv_p
	and	ie_tipo_tabela = '1';

	select	count(1)
	into STRICT	qt_anexo_radio_quimio_w
	from	ptu_req_ord_serv_servico
	where	nr_seq_req_ord = nr_seq_ordem_serv_p
	and	ie_tipo_anexo in ('1','2');


	select	pls_obter_versao_tiss
	into STRICT	nr_versao_tiss_w
	;

	select	count(1)
	into STRICT	qt_consist_w
	from	ptu_consist_transacao
	where	nr_seq_ordem_serv = nr_seq_ordem_serv_p
	and	ie_habilita = 'S';

	if (qt_consist_w > 0) then
		update	ptu_consist_transacao
		set	ie_habilita = 'N'
		where	nr_seq_ordem_serv = nr_seq_ordem_serv_p;
	end if;

end if;


for r_C01_w in C01 loop
	if (r_C01_w.cd_consistencia = '91') then
		if (coalesce(cd_unimed_solicitante_w::text, '') = '') then
			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_req_w;

			if (qt_prestador_w = 0) then
				insert	into	ptu_consist_transacao(
						nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
						nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
						nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
						nr_seq_requisicao, nr_seq_guia, ie_habilita
					)
				values (
						nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
						nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
						nr_seq_ordem_serv_p, null, null,
						null ,null , 'S'
					);
			end if;
		end if;
	elsif (r_C01_w.cd_consistencia = '92') then
		if	((coalesce(nr_seq_prestador_req_w::text, '') = '') or (coalesce(nm_prestador_w::text, '') = '')) and (cd_unimed_prestador_req_w IS NOT NULL AND cd_unimed_prestador_req_w::text <> '') then
			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_req_w;

			if (qt_prestador_w = 0) then
				insert	into	ptu_consist_transacao(
						nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
						nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
						nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
						nr_seq_requisicao, nr_seq_guia, ie_habilita
					)
				values (
						nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
						nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
						nr_seq_ordem_serv_p, null, null,
						null ,null , 'S'
					);
			end if;
		end if;
	elsif (r_C01_w.cd_consistencia = '93') then
		if (coalesce(cd_unimed_prestador_req_w::text, '') = '') and (nr_seq_prestador_req_w IS NOT NULL AND nr_seq_prestador_req_w::text <> '') then
			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_req_w;

			if (qt_prestador_w = 0) then
				insert	into	ptu_consist_transacao(
						nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
						nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
						nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
						nr_seq_requisicao, nr_seq_guia, ie_habilita
					)
				values (
						nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
						nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
						nr_seq_ordem_serv_p, null, null,
						null ,null , 'S'
					);
			end if;
		end if;
	elsif (r_C01_w.cd_consistencia = '94') then
		if (coalesce(cd_unimed_prestador_w::text, '') = '') and (nr_seq_prestador_w IS NOT NULL AND nr_seq_prestador_w::text <> '') then
			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_req_w;

			if (qt_prestador_w = 0) then
				insert	into	ptu_consist_transacao(
						nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
						nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
						nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
						nr_seq_requisicao, nr_seq_guia, ie_habilita
					)
				values (
						nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
						nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
						nr_seq_ordem_serv_p, null, null,
						null ,null , 'S'
					);
			end if;
		end if;
	elsif (r_C01_w.cd_consistencia = '95') then
		if (coalesce(nr_seq_prestador_w::text, '') = '') and (cd_unimed_prestador_w IS NOT NULL AND cd_unimed_prestador_w::text <> '') then
			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_req_w;

			if (qt_prestador_w = 0) then
				insert	into	ptu_consist_transacao(
						nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
						nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
						nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
						nr_seq_requisicao, nr_seq_guia, ie_habilita
					)
				values (
						nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
						nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
						nr_seq_ordem_serv_p, null, null,
						null ,null , 'S'
					);
			end if;
		end if;
	elsif (r_C01_w.cd_consistencia = '96') then
		if (coalesce(ie_urg_emerg_w::text, '') = '') then
			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_req_w;

			if (qt_prestador_w = 0) then
				insert	into	ptu_consist_transacao(
						nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
						nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
						nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
						nr_seq_requisicao, nr_seq_guia, ie_habilita
					)
				values (
						nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
						nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
						nr_seq_ordem_serv_p, null, null,
						null ,null , 'S'
					);
			end if;
		end if;
	elsif (r_C01_w.cd_consistencia = '97') then
		if (coalesce(dt_prov_atendimento_w::text, '') = '') and (qt_intern_w > 0) then
			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_req_w;

			if (qt_prestador_w = 0) then
				insert	into	ptu_consist_transacao(
						nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
						nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
						nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
						nr_seq_requisicao, nr_seq_guia, ie_habilita
					)
				values (
						nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
						nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
						nr_seq_ordem_serv_p, null, null,
						null ,null , 'S'
					);
			end if;
		end if;
	elsif (r_C01_w.cd_consistencia = '98') then
		if (coalesce(dt_validade_w::text, '') = '') then
			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_req_w;

			if (qt_prestador_w = 0) then
				insert	into	ptu_consist_transacao(
						nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
						nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
						nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
						nr_seq_requisicao, nr_seq_guia, ie_habilita
					)
				values (
						nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
						nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
						nr_seq_ordem_serv_p, null, null,
						null ,null , 'S'
					);
			end if;
		end if;
	elsif (r_C01_w.cd_consistencia = '100') then
		if (coalesce(ie_recem_nascido_w::text, '') = '') then
			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_req_w;

			if (qt_prestador_w = 0) then
				insert	into	ptu_consist_transacao(
						nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
						nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
						nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
						nr_seq_requisicao, nr_seq_guia, ie_habilita
					)
				values (
						nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
						nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
						nr_seq_ordem_serv_p, null, null,
						null ,null , 'S'
					);
			end if;
		end if;
	elsif (r_C01_w.cd_consistencia = '102') then
		if (coalesce(ie_liminar_w::text, '') = '') then
			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_req_w;

			if (qt_prestador_w = 0) then
				insert	into	ptu_consist_transacao(
						nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
						nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
						nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
						nr_seq_requisicao, nr_seq_guia, ie_habilita
					)
				values (
						nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
						nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
						nr_seq_ordem_serv_p, null, null,
						null ,null , 'S'
					);
			end if;
		end if;
	elsif (r_C01_w.cd_consistencia = '103') then
		if (coalesce(sg_conselho_profissional_w::text, '') = '') then
			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_req_w;

			if (qt_prestador_w = 0) then
				insert	into	ptu_consist_transacao(
						nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
						nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
						nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
						nr_seq_requisicao, nr_seq_guia, ie_habilita
					)
				values (
						nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
						nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
						nr_seq_ordem_serv_p, null, null,
						null ,null , 'S'
					);
			end if;
		end if;
	elsif (r_C01_w.cd_consistencia = '104') then
		if (coalesce(nr_conselho_profissional_w::text, '') = '') then
			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_req_w;

			if (qt_prestador_w = 0) then
				insert	into	ptu_consist_transacao(
						nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
						nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
						nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
						nr_seq_requisicao, nr_seq_guia, ie_habilita
					)
				values (
						nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
						nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
						nr_seq_ordem_serv_p, null, null,
						null ,null , 'S'
					);
			end if;
		end if;
	elsif (r_C01_w.cd_consistencia = '105') then
		if (coalesce(uf_conselho_profissional_w::text, '') = '') then
			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_req_w;

			if (qt_prestador_w = 0) then
				insert	into	ptu_consist_transacao(
						nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
						nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
						nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
						nr_seq_requisicao, nr_seq_guia, ie_habilita
					)
				values (
						nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
						nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
						nr_seq_ordem_serv_p, null, null,
						null ,null , 'S'
					);
			end if;
		end if;
	elsif (r_C01_w.cd_consistencia = '107') then
		if (coalesce(ie_tipo_acidente_w::text, '') = '') then
			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_req_w;

			if (qt_prestador_w = 0) then
				insert	into	ptu_consist_transacao(
						nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
						nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
						nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
						nr_seq_requisicao, nr_seq_guia, ie_habilita
					)
				values (
						nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
						nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
						nr_seq_ordem_serv_p, null, null,
						null ,null , 'S'
					);
			end if;
		end if;
	elsif (r_C01_w.cd_consistencia = '108') then
		if (coalesce(cd_municipio_ibge_w::text, '') = '') then
			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_req_w;

			if (qt_prestador_w = 0) then
				insert	into	ptu_consist_transacao(
						nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
						nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
						nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
						nr_seq_requisicao, nr_seq_guia, ie_habilita
					)
				values (
						nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
						nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
						nr_seq_ordem_serv_p, null, null,
						null ,null , 'S'
					);
			end if;
		end if;
	elsif (r_C01_w.cd_consistencia = '191') then
		if (coalesce(ds_ind_clinica_w::text, '') = '') and (qt_intern_w > 0) then
			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_req_w;

			if (qt_prestador_w = 0) then
				insert	into	ptu_consist_transacao(
						nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
						nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
						nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
						nr_seq_requisicao, nr_seq_guia, ie_habilita
					)
				values (
						nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
						nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
						nr_seq_ordem_serv_p, null, null,
						null ,null , 'S'
					);
			end if;
		end if;
	elsif (r_C01_w.cd_consistencia = '110') then
		if (coalesce(ie_sexo_w::text, '') = '') and (qt_anexo_radio_quimio_w > 0) then
			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_req_w;

			if (qt_prestador_w = 0) then
				insert	into	ptu_consist_transacao(
						nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
						nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
						nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
						nr_seq_requisicao, nr_seq_guia, ie_habilita
					)
				values (
						nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
						nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
						nr_seq_ordem_serv_p, null, null,
						null ,null , 'S'
					);
			end if;
		end if;
	elsif (r_C01_w.cd_consistencia = '109') then
		if (coalesce(nr_idade_w::text, '') = '') and (qt_anexo_radio_quimio_w > 0) then
			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_req_w;

			if (qt_prestador_w = 0) then
				insert	into	ptu_consist_transacao(
						nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
						nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
						nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
						nr_seq_requisicao, nr_seq_guia, ie_habilita
					)
				values (
						nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
						nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
						nr_seq_ordem_serv_p, null, null,
						null ,null , 'S'
					);
			end if;
		end if;
	end if;
	for r_C02_w in C02 loop
		if (r_C01_w.cd_consistencia = '192') then
			if (coalesce(r_C02_w.ie_opcao_fabricante::text, '') = '') and (r_C02_w.ie_tipo_anexo = '3') then
				select	count(1)
				into STRICT	qt_prestador_w
				from	ptu_excecao_consistencia
				where	nr_seq_consist_envio = r_C01_w.nr_sequencia
				and	nr_seq_prestador = nr_seq_prestador_req_w;

				if (qt_prestador_w = 0) then
					insert	into	ptu_consist_transacao(
							nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
							nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
							nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
							nr_seq_requisicao, nr_seq_guia, ie_habilita
						)
					values (
							nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
							nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
							nr_seq_ordem_serv_p, null, null,
							null ,null , 'S'
						);
				end if;
			end if;
		elsif (r_C01_w.cd_consistencia = '193') then
			if (coalesce(r_C02_w.cd_anvisa::text, '') = '') and (r_C02_w.ie_tipo_anexo = '3') then
				select	count(1)
				into STRICT	qt_prestador_w
				from	ptu_excecao_consistencia
				where	nr_seq_consist_envio = r_C01_w.nr_sequencia
				and	nr_seq_prestador = nr_seq_prestador_req_w;

				if (qt_prestador_w = 0) then
					insert	into	ptu_consist_transacao(
							nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
							nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
							nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
							nr_seq_requisicao, nr_seq_guia, ie_habilita
						)
					values (
							nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
							nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
							nr_seq_ordem_serv_p, null, null,
							null ,null , 'S'
						);
				end if;
			end if;
		elsif (r_C01_w.cd_consistencia = '194') then
			if (coalesce(r_C02_w.cd_referencia_fab::text, '') = '') and (r_C02_w.ie_tipo_anexo = '3') then
				select	count(1)
				into STRICT	qt_prestador_w
				from	ptu_excecao_consistencia
				where	nr_seq_consist_envio = r_C01_w.nr_sequencia
				and	nr_seq_prestador = nr_seq_prestador_req_w;

				if (qt_prestador_w = 0) then
					insert	into	ptu_consist_transacao(
							nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
							nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
							nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
							nr_seq_requisicao, nr_seq_guia, ie_habilita
						)
					values (
							nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
							nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
							nr_seq_ordem_serv_p, null, null,
							null ,null , 'S'
						);
				end if;
			end if;
		elsif (r_C01_w.cd_consistencia = '195') then
			if (coalesce(r_C02_w.vl_servico::text, '') = '') and (r_C02_w.ie_tipo_anexo = '3') then
				select	count(1)
				into STRICT	qt_prestador_w
				from	ptu_excecao_consistencia
				where	nr_seq_consist_envio = r_C01_w.nr_sequencia
				and	nr_seq_prestador = nr_seq_prestador_req_w;

				if (qt_prestador_w = 0) then
					insert	into	ptu_consist_transacao(
							nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
							nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
							nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
							nr_seq_requisicao, nr_seq_guia, ie_habilita
						)
					values (
							nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
							nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
							nr_seq_ordem_serv_p, null, null,
							null ,null , 'S'
						);
				end if;
			end if;
		elsif (r_C01_w.cd_consistencia = '197') then
			if (coalesce(r_C02_w.ds_opme::text, '') = '') and (r_C02_w.ie_tipo_anexo = '3') then
				select	count(1)
				into STRICT	qt_prestador_w
				from	ptu_excecao_consistencia
				where	nr_seq_consist_envio = r_C01_w.nr_sequencia
				and	nr_seq_prestador = nr_seq_prestador_req_w;

				if (qt_prestador_w = 0) then
					insert	into	ptu_consist_transacao(
							nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
							nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
							nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
							nr_seq_requisicao, nr_seq_guia, ie_habilita
						)
					values (
							nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
							nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
							nr_seq_ordem_serv_p, null, null,
							null ,null , 'S'
						);
				end if;
			end if;
		elsif (r_C01_w.cd_consistencia = '198') then
			if (coalesce(r_C02_w.dt_provavel::text, '') = '') and (r_C02_w.ie_tipo_anexo in ('1','2')) then
				select	count(1)
				into STRICT	qt_prestador_w
				from	ptu_excecao_consistencia
				where	nr_seq_consist_envio = r_C01_w.nr_sequencia
				and	nr_seq_prestador = nr_seq_prestador_req_w;

				if (qt_prestador_w = 0) then
					insert	into	ptu_consist_transacao(
							nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
							nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
							nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
							nr_seq_requisicao, nr_seq_guia, ie_habilita
						)
					values (
							nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
							nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
							nr_seq_ordem_serv_p, null, null,
							null ,null , 'S'
						);
				end if;
			end if;
		elsif (r_C01_w.cd_consistencia = '199') then
			if (coalesce(r_C02_w.qt_dosagem_total::text, '') = '') and (r_C02_w.ie_tipo_anexo = '1') then
				select	count(1)
				into STRICT	qt_prestador_w
				from	ptu_excecao_consistencia
				where	nr_seq_consist_envio = r_C01_w.nr_sequencia
				and	nr_seq_prestador = nr_seq_prestador_req_w;

				if (qt_prestador_w = 0) then
					insert	into	ptu_consist_transacao(
							nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
							nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
							nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
							nr_seq_requisicao, nr_seq_guia, ie_habilita
						)
					values (
							nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
							nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
							nr_seq_ordem_serv_p, null, null,
							null ,null , 'S'
						);
				end if;
			end if;
		elsif (r_C01_w.cd_consistencia = '200') then
			if (coalesce(r_C02_w.qt_frequencia_adm::text, '') = '') and (r_C02_w.ie_tipo_anexo = '1') then
				select	count(1)
				into STRICT	qt_prestador_w
				from	ptu_excecao_consistencia
				where	nr_seq_consist_envio = r_C01_w.nr_sequencia
				and	nr_seq_prestador = nr_seq_prestador_req_w;

				if (qt_prestador_w = 0) then
					insert	into	ptu_consist_transacao(
							nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
							nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
							nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
							nr_seq_requisicao, nr_seq_guia, ie_habilita
						)
					values (
							nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
							nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
							nr_seq_ordem_serv_p, null, null,
							null ,null , 'S'
						);
				end if;
			end if;
		elsif (r_C01_w.cd_consistencia = '201') then
			if (coalesce(r_C02_w.cd_via_administracao::text, '') = '') and (r_C02_w.ie_tipo_anexo = '1') then
				select	count(1)
				into STRICT	qt_prestador_w
				from	ptu_excecao_consistencia
				where	nr_seq_consist_envio = r_C01_w.nr_sequencia
				and	nr_seq_prestador = nr_seq_prestador_req_w;

				if (qt_prestador_w = 0) then
					insert	into	ptu_consist_transacao(
							nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
							nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
							nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
							nr_seq_requisicao, nr_seq_guia, ie_habilita
						)
					values (
							nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
							nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
							nr_seq_ordem_serv_p, null, null,
							null ,null , 'S'
						);
				end if;
			end if;
		elsif (r_C01_w.cd_consistencia = '202') then
			if (coalesce(r_C02_w.qt_unidade_medida::text, '') = '') and (r_C02_w.ie_tipo_anexo = '1') then
				select	count(1)
				into STRICT	qt_prestador_w
				from	ptu_excecao_consistencia
				where	nr_seq_consist_envio = r_C01_w.nr_sequencia
				and	nr_seq_prestador = nr_seq_prestador_req_w;

				if (qt_prestador_w = 0) then
					insert	into	ptu_consist_transacao(
							nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
							nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
							nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
							nr_seq_requisicao, nr_seq_guia, ie_habilita
						)
					values (
							nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
							nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
							nr_seq_ordem_serv_p, null, null,
							null ,null , 'S'
						);
				end if;
			end if;
		end if;
	end loop;
end loop;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ptu_consistir_ordem_servico ( nr_seq_ordem_serv_p bigint, nm_usuario_p text ) FROM PUBLIC;

