-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_frasco_pato_loc_copia ( nr_seq_frasco_pato_loc_p bigint, qt_frascos_copia_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_atendimento_w	    	bigint;
ie_situacao_w		    	varchar(1);
ie_status_w		    	bigint;
ds_observacao_w		    	varchar(255);
nr_prescricao_w		    	bigint;
qt_frascos_gravados_w	    	bigint := 0;
nr_seq_tipo_amostra_pato_w  	bigint;
nr_seq_frasco_pato_loc_seq_w  	bigint;
qt_frascos_copia_w		bigint;

C01 CURSOR FOR
	SELECT nr_seq_tipo_amostra_pato
	from   frasco_pato_loc_amost
	where  nr_seq_frasco_pato_loc = nr_seq_frasco_pato_loc_p;


BEGIN

select	coalesce(max(nr_atendimento),0),
	coalesce(max(ie_situacao),''),
	coalesce(max(ie_status),0),
	coalesce(max(ds_observacao),''),
	coalesce(max(nr_prescricao),0)
into STRICT	nr_atendimento_w,
	ie_situacao_w,
	ie_status_w,
	ds_observacao_w,
	nr_prescricao_w
from	frasco_pato_loc
where	nr_sequencia = nr_seq_frasco_pato_loc_p;

qt_frascos_copia_w := (qt_frascos_copia_p - 1);

while(qt_frascos_gravados_w < qt_frascos_copia_w) loop

	select  nextval('frasco_pato_loc_seq')
	into STRICT	nr_seq_frasco_pato_loc_seq_w
	;

	insert into frasco_pato_loc(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_atendimento,
		ie_situacao,
		ie_status,
		ds_observacao,
		nr_prescricao,
		nr_seq_frasco_sup)
	values (	nr_seq_frasco_pato_loc_seq_w,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		nr_atendimento_w,
		ie_situacao_w,
		ie_status_w,
		ds_observacao_w,
		nr_prescricao_w,
		nr_seq_frasco_pato_loc_p);

	open C01;
	loop
	fetch C01 into
		nr_seq_tipo_amostra_pato_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */
		begin
		insert into frasco_pato_loc_amost(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_tipo_amostra_pato,
			nr_seq_frasco_pato_loc)
		values (	nextval('frasco_pato_loc_amost_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_tipo_amostra_pato_w,
			nr_seq_frasco_pato_loc_seq_w);
		end;
	end loop;
	close C01;

	qt_frascos_gravados_w := qt_frascos_gravados_w +1;

	end loop;
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_frasco_pato_loc_copia ( nr_seq_frasco_pato_loc_p bigint, qt_frascos_copia_p bigint, nm_usuario_p text) FROM PUBLIC;

