-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE rep_copia_pecas_procedimento ( nr_prescricao_p bigint, nr_seq_nova_proced_p bigint, nr_prescricao_orig_p bigint, nr_seq_orig_proced_p bigint, nm_usuario_p text) AS $body$
DECLARE


ie_peca_principal_w 			varchar(1);
ie_situacao_w 					varchar(1);
cd_doenca_cid_w 				varchar(10);
nr_sequencia_w 					bigint;
dt_atualizacao_w 				timestamp;
nm_usuario_w 					varchar(15);
nr_prescricao_w 				bigint;
nr_seq_prescr_w 				integer;
nr_seq_laudo_w 					bigint;
cd_topografia_w 				varchar(10);
cd_morfologia_w 				varchar(10);
dt_atualizacao_nrec_w 			timestamp;
nm_usuario_nrec_w 				varchar(15);
nr_seq_peca_w 					bigint;
nr_revisao_w 					varchar(10);
nr_fragmentos_w 				double precision;
ds_designacao_w 				varchar(255);
nr_seq_apresent_w 				bigint;
ie_status_w 					varchar(2);
nr_seq_tipo_w 					bigint;
nr_controle_w 					varchar(50);
nr_seq_amostra_princ_w 			bigint;
ds_observacao_w 				varchar(255);
ds_amostra_principal_w 			varchar(255);
nr_seq_caso_congelacao_w 		varchar(20);
nr_sequencia_princ_w 			integer;
ie_tipo_designacao_w 			varchar(15);
nr_seq_exame_complementar_w 	bigint;
ie_exame_compl_w 				varchar(1);
nr_seq_pato_exame_w 			bigint;
nr_seq_designacao_w 			bigint;
nr_seq_proc_paciente_w 			bigint;
ie_lado_w 						varchar(1);
NR_SEQ_MORF_DESC_ADIC_w bigint;

c01 CURSOR FOR
	SELECT	b.nr_prescricao,
			b.nr_seq_prescr,
			b.cd_topografia,
			b.cd_morfologia,
			b.dt_atualizacao,
			b.nm_usuario_nrec,
			b.nr_seq_peca,
			b.ie_status,
			b.nr_seq_tipo,
			b.nr_controle,
			b.nr_revisao,
			b.nr_fragmentos,
			b.ds_designacao,
			b.ds_observacao,
			b.nr_seq_apresent,
			b.ds_amostra_principal,
			b.nr_seq_amostra_princ,
			b.ie_tipo_designacao,
			b.nr_seq_pato_exame,
			b.nr_seq_exame_complementar,
			b.ie_exame_compl,
			b.nr_seq_designacao,
			b.nr_seq_caso_congelacao,
			b.nr_sequencia_princ,
			b.nr_seq_proc_paciente,
			b.ie_peca_principal,
			b.ie_situacao,
			b.ie_lado,
      b.NR_SEQ_MORF_DESC_ADIC,
			b.cd_doenca_cid,
			b.nm_usuario,
			b.nr_seq_laudo,
			b.dt_atualizacao_nrec
	from	prescr_procedimento a, prescr_proc_peca b
	where	a.nr_prescricao		= b.nr_prescricao
	and		a.nr_sequencia		= b.nr_seq_prescr
	and 	coalesce(b.dt_inativacao::text, '') = ''
	and		b.nr_prescricao		= nr_prescricao_orig_p
	and		b.nr_seq_prescr		= nr_seq_orig_proced_p;


BEGIN

open c01;
loop
fetch c01 into
	nr_prescricao_w,
	nr_seq_prescr_w,
	cd_topografia_w,
	cd_morfologia_w,
	dt_atualizacao_w,
	nm_usuario_nrec_w,
	nr_seq_peca_w,
	ie_status_w,
	nr_seq_tipo_w,
	nr_controle_w,
	nr_revisao_w,
	nr_fragmentos_w,
	ds_designacao_w,
	ds_observacao_w,
	nr_seq_apresent_w,
	ds_amostra_principal_w,
	nr_seq_amostra_princ_w,
	ie_tipo_designacao_w,
	nr_seq_pato_exame_w,
	nr_seq_exame_complementar_w,
	ie_exame_compl_w,
	nr_seq_designacao_w,
	nr_seq_caso_congelacao_w,
	nr_sequencia_princ_w,
	nr_seq_proc_paciente_w,
	ie_peca_principal_w,
	ie_situacao_w,
	ie_lado_w,
  NR_SEQ_MORF_DESC_ADIC_w,
	cd_doenca_cid_w,
	nm_usuario_w,
	nr_seq_laudo_w,
	dt_atualizacao_nrec_w;
EXIT WHEN NOT FOUND; /* apply on c01 */

	Select nextval('prescr_proc_peca_seq')
	into STRICT  nr_sequencia_w
	;

	Insert  into Prescr_proc_peca(
			ie_peca_principal,
			ie_situacao,
			cd_doenca_cid,
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			nr_prescricao,
			nr_seq_prescr,
			nr_seq_laudo,
			cd_topografia,
			cd_morfologia,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_peca,
			nr_revisao,
			nr_fragmentos,
			ds_designacao,
			nr_seq_apresent,
			ie_status,
			nr_seq_tipo,
			nr_controle,
			nr_seq_amostra_princ,
			ds_observacao,
			ds_amostra_principal,
			nr_seq_caso_congelacao,
			nr_sequencia_princ,
			ie_tipo_designacao,
			nr_seq_exame_complementar,
			ie_exame_compl,
			nr_seq_pato_exame,
			nr_seq_designacao,
			nr_seq_proc_paciente,
			ie_lado ,
      NR_SEQ_MORF_DESC_ADIC
		) values (
			ie_peca_principal_w,
			ie_situacao_w,
			cd_doenca_cid_w,
			nr_sequencia_w,
			dt_atualizacao_w,
			nm_usuario_p,
			nr_prescricao_p,
			nr_seq_nova_proced_p,
			nr_seq_laudo_w,
			cd_topografia_w,
			cd_morfologia_w,
			dt_atualizacao_nrec_w,
			nm_usuario_nrec_w,
			nr_seq_peca_w,
			nr_revisao_w,
			nr_fragmentos_w,
			ds_designacao_w,
			nr_seq_apresent_w,
			ie_status_w,
			nr_seq_tipo_w,
			nr_controle_w,
			nr_seq_amostra_princ_w,
			ds_observacao_w,
			ds_amostra_principal_w,
			nr_seq_caso_congelacao_w,
			nr_sequencia_princ_w,
			ie_tipo_designacao_w,
			nr_seq_exame_complementar_w,
			ie_exame_compl_w,
			nr_seq_pato_exame_w,
			nr_seq_designacao_w,
			nr_seq_proc_paciente_w,
			ie_lado_w,
      NR_SEQ_MORF_DESC_ADIC_w);

	commit;

end loop;
close c01;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE rep_copia_pecas_procedimento ( nr_prescricao_p bigint, nr_seq_nova_proced_p bigint, nr_prescricao_orig_p bigint, nr_seq_orig_proced_p bigint, nm_usuario_p text) FROM PUBLIC;

