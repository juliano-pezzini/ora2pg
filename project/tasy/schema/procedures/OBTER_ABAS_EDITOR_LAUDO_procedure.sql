-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_abas_editor_laudo (CD_PESSOA_FISICA_P text, CD_ESTABELECIMENTO_P bigint, CD_PERFIL_P bigint, IE_INFORMACAO_PACIENTE_P INOUT text, IE_INFORMACAO_EXEC_P INOUT text, IE_IMAGEM_AUDIO_VIDEO_P INOUT text, IE_PROC_VINCULADO_P INOUT text, IE_DIAGNOSTICO_P INOUT text, IE_MEDICOS_P INOUT text, IE_HISTORICO_ENVIO_P INOUT text, IE_ANEXO_P INOUT text, IE_AUDIO_P INOUT text) AS $body$
BEGIN
    SELECT COALESCE(A.IE_INFORMACAO_PACIENTE,'N') IE_INFORMACAO_PACIENTE,
           COALESCE(A.IE_INFORMACAO_EXEC,'N') IE_INFORMACAO_EXEC,
           COALESCE(A.IE_IMAGEM_AUDIO_VIDEO,'N') IE_IMAGEM_AUDIO_VIDEO,
           COALESCE(A.IE_PROC_VINCULADO,'N') IE_PROC_VINCULADO,
           COALESCE(A.IE_DIAGNOSTICO,'N') IE_DIAGNOSTICO,
           COALESCE(A.IE_MEDICOS,'N') IE_MEDICOS,
           COALESCE(A.IE_HISTORICO_ENVIO,'N') IE_HISTORICO_ENVIO,
           COALESCE(A.IE_ANEXO,'N') IE_ANEXO,
           COALESCE(A.IE_AUDIO,'N') IE_AUDIO
      INTO STRICT
         IE_INFORMACAO_PACIENTE_P,
         IE_INFORMACAO_EXEC_P,
         IE_IMAGEM_AUDIO_VIDEO_P,
         IE_PROC_VINCULADO_P,
         IE_DIAGNOSTICO_P,
         IE_MEDICOS_P,
         IE_HISTORICO_ENVIO_P,
         IE_ANEXO_P,
         IE_AUDIO_P
      FROM CADASTRO_ABA_EDITOR A
     WHERE COALESCE(A.CD_ESTABELECIMENTO,CD_ESTABELECIMENTO_P) = CD_ESTABELECIMENTO_P
       AND COALESCE(A.CD_PERFIL,CD_PERFIL_P) = CD_PERFIL_P
       AND COALESCE(A.CD_PESSOA_FISICA,CD_PESSOA_FISICA_P) = CD_PESSOA_FISICA_P
     ORDER BY A.NR_SEQUENCIA DESC LIMIT 1;
EXCEPTION
  WHEN OTHERS THEN
      SELECT 'S' IE_INFORMACAO_PACIENTE,
             'S' IE_INFORMACAO_EXEC,
             'S' IE_IMAGEM_AUDIO_VIDEO,
             'S' IE_PROC_VINCULADO,
             'S' IE_DIAGNOSTICO,
             'S' IE_MEDICOS,
             'S' IE_HISTORICO_ENVIO,
             'S' IE_ANEXO,
             'S' IE_AUDIO
        INTO STRICT
             IE_INFORMACAO_PACIENTE_P,
             IE_INFORMACAO_EXEC_P,
             IE_IMAGEM_AUDIO_VIDEO_P,
             IE_PROC_VINCULADO_P,
             IE_DIAGNOSTICO_P,
             IE_MEDICOS_P,
             IE_HISTORICO_ENVIO_P,
             IE_ANEXO_P,
             IE_AUDIO_P
;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_abas_editor_laudo (CD_PESSOA_FISICA_P text, CD_ESTABELECIMENTO_P bigint, CD_PERFIL_P bigint, IE_INFORMACAO_PACIENTE_P INOUT text, IE_INFORMACAO_EXEC_P INOUT text, IE_IMAGEM_AUDIO_VIDEO_P INOUT text, IE_PROC_VINCULADO_P INOUT text, IE_DIAGNOSTICO_P INOUT text, IE_MEDICOS_P INOUT text, IE_HISTORICO_ENVIO_P INOUT text, IE_ANEXO_P INOUT text, IE_AUDIO_P INOUT text) FROM PUBLIC;

