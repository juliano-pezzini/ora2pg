-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_cih_local_seq () AS $body$
DECLARE


NR_FICHA_OCORRENCIA_w	bigint;
CD_TOPOGRAFIA_W		bigint;
NR_SEQUENCIA_W		bigint;

C01 CURSOR FOR
SELECT	nr_ficha_ocorrencia,
	cd_topografia,
	nextval('cih_local_infeccao_seq')
from	cih_local_infeccao
where	coalesce(nr_sequencia::text, '') = '';


BEGIN

OPEN C01;
LOOP
FETCH C01 into	nr_ficha_ocorrencia_w,
		CD_TOPOGRAFIA_W,
		NR_SEQUENCIA_W;
EXIT WHEN NOT FOUND; /* apply on C01 */

	begin

	update	cih_local_infeccao
	set 	nr_sequencia 		= nr_sequencia_w
	where	nr_ficha_ocorrencia 	= nr_ficha_ocorrencia_w
	and	cd_topografia		= cd_topografia_w;

	end;

END LOOP;
close c01;

CALL Exec_Sql_Dinamico('TASY',' alter table cih_local_infeccao drop constraint CIHLOIN_PK ');

CALL Exec_Sql_Dinamico('TASY',	' ALTER TABLE cih_local_infeccao ' ||
				' ADD (CONSTRAINT CIHLOIN_PK Primary Key  (NR_SEQUENCIA) ' ||
				' USING INDEX   Tablespace TASY_INDEX) ');


commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_cih_local_seq () FROM PUBLIC;

