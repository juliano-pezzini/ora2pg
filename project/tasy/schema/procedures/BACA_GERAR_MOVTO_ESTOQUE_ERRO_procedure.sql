-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_gerar_movto_estoque_erro () AS $body$
BEGIN

CALL Exec_sql_dinamico('Tasy',
	' create table movimento_estoque_erro as ( ' ||
	' select /*+index (a movesto_i1) */ ' ||
	'	 a.* ' ||
	' from 	movimento_estoque a ' ||
	' where 	dt_movimento_estoque > sysdate - 5 ' ||
	' and 	ie_origem_documento = 3 ' ||
	' and 	cd_acao =2 ' ||
	' and 	exists (select 1 ' ||
	'	from movimento_estoque b ' ||
	'	where a.nr_movimento_estoque + 1 = b.nr_movimento_estoque ' ||
	'	and a.cd_material	= b.cd_material ' ||
	'	and a.cd_acao		= b.cd_acao ' ||
	'	and a.cd_operacao_estoque = b.cd_operacao_estoque ' ||
	'	and a.qt_movimento	= b.qt_movimento ' ||
	'	and a.nr_documento	= b.nr_documento ' ||
	'	and a.nr_sequencia_item_docto = b.nr_sequencia_item_docto ' ||
	'	and a.dt_movimento_estoque between a.dt_movimento_estoque and (a.dt_movimento_estoque + (86400/86399)))) ');


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_gerar_movto_estoque_erro () FROM PUBLIC;

