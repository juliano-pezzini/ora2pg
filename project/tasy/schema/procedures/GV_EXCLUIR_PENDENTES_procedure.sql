-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gv_excluir_pendentes (nr_seq_vagas_p bigint) AS $body$
DECLARE

 
ie_existe_aval_lib_w	varchar(1);


BEGIN 
 
if (nr_seq_vagas_p <> 0) then 
 
	ie_existe_aval_lib_w := 0;
	begin 
		select	1 
		into STRICT	ie_existe_aval_lib_w 
		from	avaliacao_gestao_vaga 
		where	nr_seq_gestao_vaga = nr_seq_vagas_p 
		and	(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')  LIMIT 1;
	exception 
		when	no_data_found then 
			ie_existe_aval_lib_w := 0;
	end;
	 
	if (ie_existe_aval_lib_w = 0) then 
		delete	FROM avaliacao_gestao_vaga 
		where	nr_seq_gestao_vaga = nr_seq_vagas_p 
		and	coalesce(dt_liberacao::text, '') = '';
		 
		delete	FROM gestao_vaga 
		where	nr_sequencia = nr_seq_vagas_p;
	end if;
		 
end if;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gv_excluir_pendentes (nr_seq_vagas_p bigint) FROM PUBLIC;

