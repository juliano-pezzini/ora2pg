-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE dacon_registro_r03 ( nm_usuario_p text, nr_seq_dacon_p bigint, cd_estabelecimento_p bigint) AS $body$
DECLARE

 
ds_arquivo_w	varchar(2000);


BEGIN 
 
select	rpad('R03',4,' ') --ds_tipo_registro 
	||rpad(substr(coalesce(obter_nome_pf_pj(e.cd_titular,null),' '),1,150),150,' ') --nm_representante, 
	||rpad(coalesce(obter_dados_pf(e.cd_titular,'CPF'),' '),11,' ') --nr_cpf_representante, 
	||rpad(coalesce(obter_compl_pf(e.cd_titular, 1,'DDT'),' '),4,' ') --nr_ddd_telefone_rep, 
	||rpad(coalesce(elimina_caractere_especial(obter_compl_pf(e.cd_titular, 1,'T')),' '),9,' ') --nr_telefone_rep, 
	||rpad(coalesce(obter_compl_pf(e.cd_titular,1,'RAM'),' '),5,' ') --nr_ramal_rep, 
	||rpad(coalesce(obter_compl_pf(e.cd_titular,1,'DDF'),' '),4,' ') --nr_ddd_fax_rep, 
	||rpad(coalesce(obter_compl_pf(e.cd_titular,1,'FAX'),' '),9,' ') --nr_fax_rep, 
	||rpad(coalesce(obter_compl_pf(e.cd_titular,1,'M'),' '),115,' ') --ds_email_rep, 
	||rpad(coalesce(substr(obter_nome_pf_pj(e.cd_contabilista,null),1,150),' '),150,' ') --nm_responsavel, 
	||rpad(coalesce(obter_dados_pf(e.cd_contabilista,'CPF'),' '),11,' ') --nr_cpf_responsavel, 
	||rpad(coalesce(e.nr_crc,' '),15,' ') --nr_crc_resp, 
	||rpad(coalesce(obter_dados_pf_pj(e.cd_contabilista,null,'UF'),' '),2,' ') --sg_uf_resp, 
	||rpad(coalesce(obter_compl_pf(e.cd_contabilista, 1,'DDT'),' '),4,' ') --nr_ddd_telefone_resp, 
	||rpad(coalesce(elimina_caractere_especial(obter_compl_pf(e.cd_contabilista, 1,'T')),' '),9,' ') --nr_telefone_resp, 
	||rpad(coalesce(obter_compl_pf(e.cd_contabilista, 1,'RAM'),' '),5,' ') --nr_ramal_resp, 
	||rpad(coalesce(obter_compl_pf(e.cd_contabilista, 1,'DDF'),' '),4,' ') --nr_ddd_fax_resp, 
	||rpad(coalesce(elimina_caractere_especial(obter_compl_pf(e.cd_contabilista, 1, 'FAX')),' '),9,' ') --nr_fax_resp, 
	||rpad(coalesce(obter_compl_pf(e.cd_contabilista,1,'M'),' '),115, ' ') --ds_email_resp, 
	||rpad(0,10,0) --ds_reservado, 
into STRICT	ds_arquivo_w 
from	estabelecimento a, 
	empresa e, 
	dacon d 
where	a.cd_empresa = e.cd_empresa 
and	a.cd_estabelecimento = coalesce(d.cd_estabelecimento,cd_estabelecimento_p) 
and	d.nr_sequencia = nr_seq_dacon_p;
 
insert into w_dacon(nr_sequencia, 
			dt_atualizacao, 
	  		nm_usuario,			 
	  		dt_atualizacao_nrec, 
	  		nm_usuario_nrec, 
	  		ds_arquivo, 
    		nr_linha, 
	  		ie_tipo_registro) 
values (nextval('w_dacon_seq'), 
	  		clock_timestamp(), 
	  		nm_usuario_p, 
	  		clock_timestamp(), 
	  		nm_usuario_p, 
	  		ds_arquivo_w, 
	  		1, 
 	  		20);
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE dacon_registro_r03 ( nm_usuario_p text, nr_seq_dacon_p bigint, cd_estabelecimento_p bigint) FROM PUBLIC;

