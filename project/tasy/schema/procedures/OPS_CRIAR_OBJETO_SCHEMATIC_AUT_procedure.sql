-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ops_criar_objeto_schematic_aut ( cd_funcao_p bigint, nr_seq_funcao_schematic_p bigint, nr_seq_tipo_schematic_p bigint, ds_objeto_p text, ie_tipo_componente_p text, nr_seq_superior_p bigint, nm_tabela_p text, nr_seq_visao_p bigint, nr_seq_dic_objeto_p bigint, cd_exp_desc_obj_p bigint, nm_usuario_p text, ie_tipo_objeto_p text, ie_tipo_objeto_painel_p text, ie_tipo_objeto_navegador_p text, ie_tipo_objeto_master_reg_p text, ie_duplicate_visions_p text default 'N', nr_seq_gerado_p INOUT bigint DEFAULT NULL) AS $body$
DECLARE



nr_sequencia_w	bigint;
nr_seq_apres_w	bigint;
nr_seq_visao_w	bigint;
nr_seq_dic_objeto_w	bigint;
ie_dinamicform_w	varchar(10)	:= 'N';
cd_exp_informacao_w	bigint;


BEGIN

select	nextval('objeto_schematic_seq')
into STRICT	nr_sequencia_w
;

select	coalesce(max(nr_seq_apres),0) + 10
into STRICT	nr_seq_apres_w
from	objeto_schematic
where	nr_seq_funcao_schematic = nr_seq_funcao_schematic_p
and (coalesce(nr_seq_superior_p::text, '') = '' or nr_seq_obj_sup = nr_seq_superior_p);

if (ie_tipo_componente_p = 'WDBP') and (nm_tabela_p IS NOT NULL AND nm_tabela_p::text <> '') and (ie_duplicate_visions_p = 'S')then
	nr_seq_visao_w := duplicar_visao_para_gwt(coalesce(nr_seq_visao_p,0), nm_usuario_p, nr_seq_visao_w, nm_tabela_p);
elsif (nr_seq_dic_objeto_p IS NOT NULL AND nr_seq_dic_objeto_p::text <> '') then
	if (ie_tipo_componente_p = 'WDF') then
		ie_dinamicform_w	:= 'S';
	end if;

	if (ie_tipo_componente_p = 'WPOPUP') then
		begin
		nr_seq_dic_objeto_w := nr_seq_dic_objeto_p;
		end;
	elsif (ie_tipo_componente_p = 'WCL') then
		begin
		nr_seq_dic_objeto_w := nr_seq_dic_objeto_p;
		end;
	else
		begin
		nr_seq_dic_objeto_w := ops_copiar_dic_objeto(cd_funcao_p, nr_seq_dic_objeto_p, nm_usuario_p, ie_dinamicform_w, nr_seq_dic_objeto_w, 'S');
		end;
	end if;
elsif (ie_tipo_componente_p = 'WDLG') and (cd_exp_desc_obj_p IS NOT NULL AND cd_exp_desc_obj_p::text <> '') then
	select	max(cd_exp_informacao)
	into STRICT	cd_exp_informacao_w
	from 	dic_objeto
	where 	nr_sequencia = cd_exp_desc_obj_p;
end if;

if (nr_seq_dic_objeto_w = 0) or (coalesce(nr_seq_dic_objeto_w::text, '') = '') then
	nr_seq_dic_objeto_w := nr_seq_dic_objeto_p;
end if;

insert into objeto_schematic(
			 nr_sequencia,
			 dt_atualizacao_nrec,
			 nm_usuario_nrec,
			 dt_atualizacao,
			 nm_usuario,
			 cd_funcao,
			 ds_objeto,
			 ie_tipo_objeto,
			 nr_seq_obj_sup,
			 ie_tipo_obj_painel,
			 ie_tipo_obj_navegador,
			 ie_tipo_obj_master_regiao,
			 nr_seq_funcao_schematic,
			 nr_seq_apres,
			 ie_tipo_componente,
			 nr_seq_dic_objeto,
			 nm_tabela,
			 nr_seq_visao,
			 nr_seq_tipo_schematic,
			 cd_exp_desc_obj,
			 nr_seq_ativacao,
			 nr_seq_obj_padrao,
			 ie_tipo_obj_button,
			 nr_seq_obj_sup_ativ,
			 ie_herdar_permissoes,
			 ie_popup_handle)
		values (
			 nr_sequencia_w,
			 clock_timestamp(),
			 nm_usuario_p,
			 clock_timestamp(),
			 nm_usuario_p,
			 cd_funcao_p,
			 ds_objeto_p,
			 ie_tipo_objeto_p,
			 nr_seq_superior_p,
			 ie_tipo_objeto_painel_p,
			 ie_tipo_objeto_navegador_p,
			 ie_tipo_objeto_master_reg_p,
			 nr_seq_funcao_schematic_p,
			 nr_seq_apres_w,
			 ie_tipo_componente_p,
			 nr_seq_dic_objeto_w,
			 nm_tabela_p,
			 nr_seq_visao_w,
			 nr_seq_tipo_schematic_p,
			 cd_exp_informacao_w,
			 null,
			 null,
			 null,
			 null,
			 null,
			 null);

if (ie_tipo_componente_p	= 'WDLG') then



	insert into objeto_schematic(
			nr_sequencia,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			dt_atualizacao,
			nm_usuario,
			cd_funcao,
			ds_objeto,
			ie_tipo_objeto,
			nr_seq_obj_sup,
			ie_tipo_obj_painel,
			ie_tipo_obj_navegador,
			ie_tipo_obj_master_regiao,
			nr_seq_funcao_schematic,
			nr_seq_apres,
			ie_tipo_componente,
			nr_seq_dic_objeto,
			nm_tabela,
			nr_seq_visao,
			nr_seq_tipo_schematic,
			cd_exp_desc_obj,
			nr_seq_ativacao,
			nr_seq_obj_padrao,
			ie_tipo_obj_button,
			nr_seq_obj_sup_ativ,
			ie_herdar_permissoes,
			ie_popup_handle )
	values ( 	nextval('objeto_schematic_seq'),
				clock_timestamp(),
				nm_usuario_p,
				clock_timestamp(),
				nm_usuario_p,
				cd_funcao_p,
				'OK',
				'BTN',
				nr_sequencia_w,
				NULL,
				NULL,
				NULL,
				nr_seq_funcao_schematic_p,
				2,
				886,
				NULL,
				NULL,
				NULL,
				NULL,
				321624,
				NULL,
				NULL,
				'OK',
				NULL,
				NULL,
				NULL);



	insert into objeto_schematic(
			nr_sequencia,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			dt_atualizacao,
			nm_usuario,
			cd_funcao,
			ds_objeto,
			ie_tipo_objeto,
			nr_seq_obj_sup,
			ie_tipo_obj_painel,
			ie_tipo_obj_navegador,
			ie_tipo_obj_master_regiao,
			nr_seq_funcao_schematic,
			nr_seq_apres,
			ie_tipo_componente,
			nr_seq_dic_objeto,
			nm_tabela,
			nr_seq_visao,
			nr_seq_tipo_schematic,
			cd_exp_desc_obj,
			nr_seq_ativacao,
			nr_seq_obj_padrao,
			ie_tipo_obj_button,
			nr_seq_obj_sup_ativ,
			ie_herdar_permissoes,
			ie_popup_handle )
	values (
			nextval('objeto_schematic_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			cd_funcao_p,
			'Cancel',
			'BTN',
			nr_sequencia_w,
			NULL,
			NULL,
			NULL,
			nr_seq_funcao_schematic_p,
			1,
			886,
			NULL,
			NULL,
			NULL,
			NULL,
			302745,
			NULL,
			NULL,
			'CANCEL',
			NULL,
			NULL,
			NULL);

end if;

nr_seq_gerado_p	:= nr_sequencia_w;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ops_criar_objeto_schematic_aut ( cd_funcao_p bigint, nr_seq_funcao_schematic_p bigint, nr_seq_tipo_schematic_p bigint, ds_objeto_p text, ie_tipo_componente_p text, nr_seq_superior_p bigint, nm_tabela_p text, nr_seq_visao_p bigint, nr_seq_dic_objeto_p bigint, cd_exp_desc_obj_p bigint, nm_usuario_p text, ie_tipo_objeto_p text, ie_tipo_objeto_painel_p text, ie_tipo_objeto_navegador_p text, ie_tipo_objeto_master_reg_p text, ie_duplicate_visions_p text default 'N', nr_seq_gerado_p INOUT bigint DEFAULT NULL) FROM PUBLIC;

