-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_pls_autorizacao_web ( cd_estabelecimento_p bigint) AS $body$
DECLARE


nr_seq_usu_prestador_w	bigint;
qt_param_usuario_w	smallint;


C01 CURSOR FOR
	SELECT 	nr_sequencia
	from 	pls_usuario_web
	where 	coalesce(ie_solicitacao_autorizacao,'N') = 'N'
	and	(nr_seq_prestador IS NOT NULL AND nr_seq_prestador::text <> '');


BEGIN

open C01;
loop
fetch C01 into
	nr_seq_usu_prestador_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin
		select	count(a.nr_seq_usu_prestador)
		into STRICT	qt_param_usuario_w
		from	pls_web_param_usuario a,
			funcao_parametro b
		where	b.nr_sequencia 	= a.nr_seq_funcao_param
		and	b.cd_funcao 	= b.cd_funcao
		and	b.nr_sequencia 	= 6
		and	b.cd_funcao 	= 1246
		and	a.nr_seq_usu_prestador = nr_seq_usu_prestador_w;

		if (qt_param_usuario_w = 0) then
			insert into pls_web_param_usuario(nr_sequencia, cd_estabelecimento, dt_atualizacao,
						nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec,
						nr_seq_usu_prestador, vl_parametro, nr_seq_funcao_param,
						cd_funcao)
					values (	nextval('pls_web_param_usuario_seq'), cd_estabelecimento_p, clock_timestamp(),
						'tasy', clock_timestamp(), 'tasy',
						nr_seq_usu_prestador_w, 'N', 6,
						1246);
		end if;
	end;
end loop;
close C01;

commit;

end 	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_pls_autorizacao_web ( cd_estabelecimento_p bigint) FROM PUBLIC;

