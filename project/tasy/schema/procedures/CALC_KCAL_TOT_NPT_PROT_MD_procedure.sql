-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE calc_kcal_tot_npt_prot_md (qt_Kcal_Proteina_p bigint, qt_Kcal_Lipidio_p bigint, qt_Kcal_Carboidrato_p bigint, Qt_Peso_p bigint, pr_Conc_Glic_Solucao_p bigint, qt_Nitrogenio_Total_p bigint, qt_Volume_Total_p bigint, qt_Kcal_Total_p INOUT bigint, qt_Kcal_Kg_p INOUT bigint, qt_Vel_Inf_Glicose_p INOUT bigint, qt_Rel_Cal_Nit_p INOUT bigint, qt_Kcal_Proteico_p INOUT bigint, qt_Kcal_Nao_Proteico_p INOUT bigint, pr_Proteina_p INOUT bigint, pr_Lipidio_p INOUT bigint, qt_Gotejo_p INOUT bigint, pr_Carboidrato_p INOUT bigint ) AS $body$
DECLARE

    EXEC_W varchar(200);

BEGIN
    qt_Kcal_Total_p := coalesce(qt_Kcal_Proteina_p,0) + coalesce(qt_Kcal_Lipidio_p,0) + coalesce(qt_Kcal_Carboidrato_p,0);

    if Qt_Peso_p > 0 then
        begin
          EXEC_W := 'CALL OBTER_CHECK_DIV_DIVID_MD(:1,:2) INTO :result';

          EXECUTE EXEC_W USING IN qt_Kcal_Total_p,
                                         IN Qt_Peso_p,
                                         OUT qt_Kcal_Kg_p;
        exception
          when others then
              qt_Kcal_Kg_p := null;
        end;

        begin
          EXEC_W := 'CALL OBTER_CHECK_DIV_DIVID_MD(:1,:2) INTO :result';

          EXECUTE EXEC_W USING IN pr_Conc_Glic_Solucao_p,
                                         IN Qt_Peso_p * 1.44,
                                         OUT qt_Vel_Inf_Glicose_p;
        exception
          when others then
              qt_Vel_Inf_Glicose_p := null;
        end;
    end if;

    if qt_Nitrogenio_Total_p > 0 then
        begin
          EXEC_W := 'CALL OBTER_CHECK_DIV_DIVID_MD(:1,:2) INTO :result';

          EXECUTE EXEC_W USING IN coalesce(qt_Kcal_Lipidio_p,0) + coalesce(qt_Kcal_Carboidrato_p,0),
                                         IN qt_Nitrogenio_Total_p,
                                         OUT qt_Rel_Cal_Nit_p;
        exception
          when others then
              qt_Rel_Cal_Nit_p := null;
        end;
    end if;

    qt_Kcal_Proteico_p      := qt_Kcal_Proteina_p;
    qt_Kcal_Nao_Proteico_p  := coalesce(qt_Kcal_Total_p,0) - coalesce(qt_Kcal_Proteina_p,0);

    if qt_Kcal_Total_p > 0 then
        begin
          EXEC_W := 'CALL OBTER_CHECK_DIV_DIVID_MD(:1,:2) INTO :result';

          EXECUTE EXEC_W USING IN qt_Kcal_Proteina_p * 100,
                                         IN qt_Kcal_Total_p,
                                         OUT pr_Proteina_p;
        exception
          when others then
              pr_Proteina_p := null;
        end;

        begin
          EXEC_W := 'CALL OBTER_CHECK_DIV_DIVID_MD(:1,:2) INTO :result';

          EXECUTE EXEC_W USING IN qt_Kcal_Lipidio_p * 100,
                                         IN qt_Kcal_Total_p,
                                         OUT pr_Lipidio_p;
        exception
          when others then
              pr_Lipidio_p := null;
        end;

        begin
          EXEC_W := 'CALL OBTER_CHECK_DIV_DIVID_MD(:1,:2) INTO :result';

          EXECUTE EXEC_W USING IN qt_Kcal_Carboidrato_p * 100,
                                         IN qt_Kcal_Total_p,
                                         OUT pr_Carboidrato_p;
        exception
          when others then
              pr_Carboidrato_p := null;
        end;
    end if;

    qt_Gotejo_p := dividir_sem_round_md(qt_Volume_Total_p,24);

    if ((coalesce(pr_Carboidrato_p,0) + coalesce(pr_Lipidio_p,0) + coalesce(pr_Proteina_p,0)) < 100) then
        pr_Carboidrato_p := 100 - (coalesce(pr_Lipidio_p,0) + coalesce(pr_Proteina_p,0));
    end if;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE calc_kcal_tot_npt_prot_md (qt_Kcal_Proteina_p bigint, qt_Kcal_Lipidio_p bigint, qt_Kcal_Carboidrato_p bigint, Qt_Peso_p bigint, pr_Conc_Glic_Solucao_p bigint, qt_Nitrogenio_Total_p bigint, qt_Volume_Total_p bigint, qt_Kcal_Total_p INOUT bigint, qt_Kcal_Kg_p INOUT bigint, qt_Vel_Inf_Glicose_p INOUT bigint, qt_Rel_Cal_Nit_p INOUT bigint, qt_Kcal_Proteico_p INOUT bigint, qt_Kcal_Nao_Proteico_p INOUT bigint, pr_Proteina_p INOUT bigint, pr_Lipidio_p INOUT bigint, qt_Gotejo_p INOUT bigint, pr_Carboidrato_p INOUT bigint ) FROM PUBLIC;

