-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE tasy_ajustar_base_html5 () AS $body$
DECLARE


qt_existe_W		bigint;
dt_versao_atual_cliente_w 		timestamp;


BEGIN

CALL abortar_se_base_wheb();

dt_versao_atual_cliente_w := coalesce(TO_DATE(TO_CHAR(obter_data_geracao_versao-1,'dd/mm/yyyy') ||' 23:59:59','dd/mm/yyyy hh24:mi:ss'),clock_timestamp() - interval '90 days');

--objetos que nÃ£o devem existir
delete from objeto_sistema
where nm_objeto = 'OBJETO_SCHEMATIC_PROP_ATUAL';

delete from objeto_sistema
where nm_objeto = 'SCHEMATIC_RELATORIO_ATUAL';

delete from objeto_sistema
where nm_objeto = 'CODE_REVIEW_HTML5_V';

delete from objeto_sistema
where nm_objeto = 'ASSET_CTRL_IMPORT_GOODS';

commit;

--AJUSTE TABELA INTERFACEAMENTO
select	count(*)
into STRICT	qt_existe_w
from	integridade_atributo
where	nm_tabela = 'INTERFACEAMENTO'
and	NM_INTEGRIDADE_REFERENCIAL = 'INTERFAC_XMLPROJ_FK';

if (qt_existe_w > 0) then
	delete from integridade_atributo
	where	nm_tabela = 'INTERFACEAMENTO'
	and	NM_INTEGRIDADE_REFERENCIAL = 'INTERFAC_XMLPROJ_FK';
end if;

select	count(*)
into STRICT	qt_existe_w
from	INTEGRIDADE_REFERENCIAL
where	nm_tabela = 'INTERFACEAMENTO'
and	NM_INTEGRIDADE_REFERENCIAL = 'INTERFAC_XMLPROJ_FK';

if (qt_existe_w > 0) then
	delete
	from	INTEGRIDADE_REFERENCIAL
	where	nm_tabela = 'INTERFACEAMENTO'
	and	NM_INTEGRIDADE_REFERENCIAL = 'INTERFAC_XMLPROJ_FK';
end if;

select	count(*)
into STRICT	qt_existe_w
from	integridade_atributo
where	nm_tabela = 'INTERFACEAMENTO'
and	NM_INTEGRIDADE_REFERENCIAL = 'INTERFAC_XMLPROJ_RET_FK';

if (qt_existe_w > 0) then
	delete
	from	integridade_atributo
	where	nm_tabela = 'INTERFACEAMENTO'
	and	NM_INTEGRIDADE_REFERENCIAL = 'INTERFAC_XMLPROJ_RET_FK';
end if;

select	count(*)
into STRICT	qt_existe_w
from	INTEGRIDADE_REFERENCIAL
where	nm_tabela = 'INTERFACEAMENTO'
and	NM_INTEGRIDADE_REFERENCIAL = 'INTERFAC_XMLPROJ_RET_FK';

if (qt_existe_w > 0) then
	delete
	from	INTEGRIDADE_REFERENCIAL
	where	nm_tabela = 'INTERFACEAMENTO'
	and	NM_INTEGRIDADE_REFERENCIAL = 'INTERFAC_XMLPROJ_RET_FK';
end if;

select	count(*)
into STRICT	qt_existe_w
from	indice_atributo
where	nm_tabela = 'INTERFACEAMENTO'
and	NM_INDICE = 'INTERFAC_XMLPROJ_FK_I';

if (qt_existe_w > 0) then
	delete
	from	indice_atributo
	where	nm_tabela = 'INTERFACEAMENTO'
	and	NM_INDICE = 'INTERFAC_XMLPROJ_FK_I';
end if;

select	count(*)
into STRICT	qt_existe_w
from	INDICE
where	nm_tabela = 'INTERFACEAMENTO'
and	NM_INDICE = 'INTERFAC_XMLPROJ_FK_I';

if (qt_existe_w > 0) then
	delete
	from	INDICE
	where	nm_tabela = 'INTERFACEAMENTO'
	and	NM_INDICE = 'INTERFAC_XMLPROJ_FK_I';
end if;

select	count(*)
into STRICT	qt_existe_w
from	indice_atributo
where	nm_tabela = 'INTERFACEAMENTO'
and	NM_INDICE = 'INTERFAC_XMLPROJ_RET_FK_I';

if (qt_existe_w > 0) then
	delete
	from	indice_atributo
	where	nm_tabela = 'INTERFACEAMENTO'
	and	NM_INDICE = 'INTERFAC_XMLPROJ_RET_FK_I';
end if;

select	count(*)
into STRICT	qt_existe_w
from	INDICE
where	nm_tabela = 'INTERFACEAMENTO'
and	NM_INDICE = 'INTERFAC_XMLPROJ_RET_FK_I';

if (qt_existe_w > 0) then
	delete
	from	INDICE
	where	nm_tabela = 'INTERFACEAMENTO'
	and	NM_INDICE = 'INTERFAC_XMLPROJ_RET_FK_I';
end if;

select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'INTERFAC_XMLPROJ_FK';

if (qt_existe_w > 0) then
	CALL exec_sql_dinamico('HTML5', 'alter table INTERFACEAMENTO drop constraint INTERFAC_XMLPROJ_FK');
end if;

select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'INTERFAC_XMLPROJ_RET_FK';

if (qt_existe_w > 0) then
	CALL exec_sql_dinamico('HTML5', 'alter table INTERFACEAMENTO drop constraint INTERFAC_XMLPROJ_RET_FK');
end if;

select	count(*)
into STRICT	qt_existe_w
from	user_indexes
where	index_name = 'INTERFAC_XMLPROJ_FK_I';

if (qt_existe_w > 0) then
	CALL exec_sql_dinamico('HTML5', 'Drop index INTERFAC_XMLPROJ_FK_I');
end if;

commit;
--FIM AJUSTE TABELA INTERFACEAMENTO
--AJUSTE OBJETO_SISTEMA
select	count(*)
into STRICT	qt_existe_w
from	objeto_sistema
where	nm_objeto = 'OBJETO_SCHEMATIC_PROP_ATUAL';

if (qt_existe_w > 0) then
	delete
	from	objeto_sistema
	where	nm_objeto = 'OBJETO_SCHEMATIC_PROP_ATUAL';
end if;

select	count(*)
into STRICT	qt_existe_w
from	objeto_sistema
where	nm_objeto = 'SCHEMATIC_RELATORIO_ATUAL';

if (qt_existe_w > 0) then
	delete
	from	objeto_sistema
	where	nm_objeto = 'SCHEMATIC_RELATORIO_ATUAL';
end if;

select	count(*)
into STRICT	qt_existe_w
from	objeto_sistema
where	nm_objeto = 'AGEINT_GERAR_AGEND_LIST_ESPERA_HTML5';

if (qt_existe_w > 0) then
	delete
	from	objeto_sistema
	where	nm_objeto = 'AGEINT_GERAR_AGEND_LIST_ESPERA_HTML5';
end if;

commit;

--FIM AJUSTE OBJETO_SISTEMA
--AJUSTE TEMPLATE_CONTENT
select	count(*)
into STRICT	qt_existe_w
from	user_indexes
where	index_name = 'TEMPCONT_TEMPLATE_FK_I'
and	table_name = 'TEMPLATE_CONTENT';

if (qt_existe_w = 0) then
	CALL exec_sql_dinamico('HTML5', 'Create Index TEMPCONT_TEMPLATE_FK_I on TEMPLATE_CONTENT(NR_SEQ_TEMPLATE)');
end if;

select	count(*)
into STRICT	qt_existe_w
from	indice_atributo
where	nm_tabela = 'TEMPLATE_CONTENT'
and	nm_indice = 'TEMPCONT_TEMPLATE_FK_I'
and	nm_atributo <> 'NR_SEQ_TEMPLATE';

if (qt_existe_w > 0) then
	update	INDICE_ATRIBUTO a
	set	nm_atributo = 'NR_SEQ_TEMPLATE'
	Where	NM_TABELA = 'TEMPLATE_CONTENT'
	and	NM_INDICE = 'TEMPCONT_TEMPLATE_FK_I';
end if;

commit;

--FIM AJUSTE TEMPLATE_CONTENT
--AJUSTE TEMP_MACRO_SELECT_SETTINGS
SELECT	COUNT(*)
INTO STRICT	qt_existe_w
FROM 	user_tab_columns
WHERE	TABLE_NAME = 'TEMP_MACRO_SELECT_SETTINGS'
AND 	COLUMN_NAME = 'NR_SEQ_TITLE'
AND 	data_type <> 'NUMBER';

if (qt_existe_w > 0) then
	CALL exec_sql_dinamico('HTML5', 'alter table TEMP_MACRO_SELECT_SETTINGS modify NR_SEQ_TITLE number(10,0)');
end if;

select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'TEMPMACSEL_TEMPTITLE_FK';

if (qt_existe_w = 0) then
	CALL exec_sql_dinamico('HTML5', 'Alter Table TEMP_MACRO_SELECT_SETTINGS add (Constraint TEMPMACSEL_TEMPTITLE_FK Foreign Key (NR_SEQ_TITLE) References TEMPLATE_TITLE (NR_SEQUENCIA))');
end if;

commit;

--FIM AJUSTE TEMP_MACRO_SELECT_SETTINGS
--AJUSTE OBJETO_SCHEMATIC_PROP
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OBJSCHPRO_OBJSCHPRO_FK2'
and	table_name = 'OBJETO_SCHEMATIC_PROP';

if (qt_existe_w > 0) then
	CALL exec_sql_dinamico('HTML5', 'alter table OBJETO_SCHEMATIC_PROP drop constraint OBJSCHPRO_OBJSCHPRO_FK2');
end if;

select	count(*)
into STRICT	qt_existe_w
from	INTEGRIDADE_ATRIBUTO
where	NM_TABELA = 'OBJETO_SCHEMATIC_PROP'
and	NM_INTEGRIDADE_REFERENCIAL = 'OBJSCHPRO_OBJSCHPRO_FK2';

if (qt_existe_w > 0) then
	delete
	from	INTEGRIDADE_ATRIBUTO
	where	NM_TABELA = 'OBJETO_SCHEMATIC_PROP'
	and	NM_INTEGRIDADE_REFERENCIAL = 'OBJSCHPRO_OBJSCHPRO_FK2';
end if;

select	count(*)
into STRICT	qt_existe_w
from	INTEGRIDADE_REFERENCIAL
where	NM_TABELA = 'OBJETO_SCHEMATIC_PROP'
and	NM_INTEGRIDADE_REFERENCIAL = 'OBJSCHPRO_OBJSCHPRO_FK2';

if (qt_existe_w > 0) then
	delete
	from	INTEGRIDADE_REFERENCIAL
	where	NM_TABELA = 'OBJETO_SCHEMATIC_PROP'
	and	NM_INTEGRIDADE_REFERENCIAL = 'OBJSCHPRO_OBJSCHPRO_FK2';
end if;

select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OBJSCHPRO_OBJSCHE_FK'
and	table_name = 'OBJETO_SCHEMATIC_PROP'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then

	delete from OBJETO_SCHEMATIC_PROP a
	 where not exists ( SELECT 1
	 from OBJETO_SCHEMATIC b
	 where 1 = 1
	 and a.NR_SEQ_OBJETO = b.NR_SEQUENCIA
	)
	 and (a.NR_SEQ_OBJETO IS NOT NULL AND a.NR_SEQ_OBJETO::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table OBJETO_SCHEMATIC_PROP enable constraint OBJSCHPRO_OBJSCHE_FK');

end if;

select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OBJSCHPRO_DICEXPR_FK'
and	table_name = 'OBJETO_SCHEMATIC_PROP'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	update OBJETO_SCHEMATIC_PROP a
	set a.CD_EXP_LABEL_BREAD  = NULL
	where not exists ( SELECT 1
	from DIC_EXPRESSAO b
	where 1 = 1
	and a.CD_EXP_LABEL_BREAD = b.CD_EXPRESSAO
	)
	and (a.CD_EXP_LABEL_BREAD IS NOT NULL AND a.CD_EXP_LABEL_BREAD::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table OBJETO_SCHEMATIC_PROP enable constraint OBJSCHPRO_DICEXPR_FK');
end if;

commit;

--FIM AJUSTE OBJETO_SCHEMATIC_PROP
--AJUSTE DIC_OBJETO_PROPERTY
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'DIOBPRO_COMPPROP_FK'
and	table_name = 'DIC_OBJETO_PROPERTY'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then

	delete
	from	DIC_OBJETO_PROPERTY a
 	where	not exists ( SELECT 1
 			from COMPONENT_PROPERTY b
			where 1 = 1
			and a.NR_SEQ_PROPERTY = b.NR_SEQUENCIA)
	and	(a.NR_SEQ_PROPERTY IS NOT NULL AND a.NR_SEQ_PROPERTY::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table DIC_OBJETO_PROPERTY enable constraint DIOBPRO_COMPPROP_FK');

end if;

select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'DIOBPRO_OBJSCHE_FK'
and	table_name = 'DIC_OBJETO_PROPERTY'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	update DIC_OBJETO_PROPERTY a
	set a.NR_SEQ_OBJ_SCHEMATIC  = NULL
	 where not exists ( SELECT 1
	 from OBJETO_SCHEMATIC b
	 where 1 = 1
	 and a.NR_SEQ_OBJ_SCHEMATIC = b.NR_SEQUENCIA
	)
	 and (a.NR_SEQ_OBJ_SCHEMATIC IS NOT NULL AND a.NR_SEQ_OBJ_SCHEMATIC::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table DIC_OBJETO_PROPERTY enable constraint DIOBPRO_OBJSCHE_FK');
end if;

select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'DIOBPRO_FUNSCHE_FK'
and	table_name = 'DIC_OBJETO_PROPERTY'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	update DIC_OBJETO_PROPERTY a
	set a.NR_SEQ_FUNCAO_SCHEMATIC  = NULL
	where not exists ( SELECT 1
	from FUNCAO_SCHEMATIC b
	where 1 = 1
	and a.NR_SEQ_FUNCAO_SCHEMATIC = b.NR_SEQUENCIA
	)
	and (a.NR_SEQ_FUNCAO_SCHEMATIC IS NOT NULL AND a.NR_SEQ_FUNCAO_SCHEMATIC::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table DIC_OBJETO_PROPERTY enable constraint DIOBPRO_FUNSCHE_FK');
end if;

commit;

--FIM AJUSTE DIC_OBJETO_PROPERTY
--AJUSTE FUNCOES_HTML5
select	count(*)
into STRICT	qt_existe_w
from	INDICE
where	NM_TABELA = 'FUNCOES_HTML5'
and	NM_INDICE = 'FUNHTML_PROJPROJ_I';

if (qt_existe_w > 0) then
	delete
	from	INDICE
	where	NM_TABELA = 'FUNCOES_HTML5'
	and	NM_INDICE = 'FUNHTML_PROJPROJ_I';
end if;

commit;

--FIM AJUSTE FUNCOES_HTML5
--AJUSTE OBTER_SE_EXISTE_NF(NR_ORDEM_COMPRA_P
select	count(*)
into STRICT	qt_existe_w
from	objeto_sistema
where	nm_objeto = 'OBTER_SE_EXISTE_NF(NR_ORDEM_COMPRA_P';

if (qt_existe_w > 0) then

	delete
	from	objeto_sistema
	where	nm_objeto = 'OBTER_SE_EXISTE_NF(NR_ORDEM_COMPRA_P';

end if;

commit;

--FIM AJUSTE OBTER_SE_EXISTE_NF(NR_ORDEM_COMPRA_P
--AJUSTE TRIGGER OBJETO_SCHEMATIC_INSERT
select	count(*)
into STRICT	qt_existe_w
from	user_triggers
where	trigger_name = 'OBJETO_SCHEMATIC_INSERT';

if (qt_existe_w > 0) then
	CALL exec_sql_dinamico('HTML5', 'ALTER TRIGGER OBJETO_SCHEMATIC_INSERT DISABLE');
end if;

commit;

--FIM AJUSTE TRIGGER OBJETO_SCHEMATIC_INSERT
--AJUSTE TASY_PADRAO_IMAGEM
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'TASPAIM_TPCONCE_FK'
and	table_name = 'TASY_PADRAO_IMAGEM'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	update	TASY_PADRAO_IMAGEM a
	set	a.NR_SEQ_CONCEITO  = NULL
	where	not exists ( SELECT 1
			from	TASY_PADRAO_CONCEITO_HTML b
			where	1 = 1
			and a.NR_SEQ_CONCEITO = b.NR_SEQUENCIA)
	and (a.NR_SEQ_CONCEITO IS NOT NULL AND a.NR_SEQ_CONCEITO::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table TASY_PADRAO_IMAGEM enable constraint TASPAIM_TPCONCE_FK');
end if;

commit;

--FIM AJUSTE TASY_PADRAO_IMAGEM
--AJUSTE TASY_PADRAO_COR
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'TASPACO_TAPACOH_FK'
and	table_name = 'TASY_PADRAO_COR'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
 	update TASY_PADRAO_COR a
 	set a.NR_SEQ_COR_HTML  = NULL
 	where not exists ( SELECT 1
 			from TASY_PADRAO_COR_HTML b
 			where 1 = 1
 			and a.NR_SEQ_COR_HTML = b.NR_SEQUENCIA)
 	and (a.NR_SEQ_COR_HTML IS NOT NULL AND a.NR_SEQ_COR_HTML::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table TASY_PADRAO_COR enable constraint TASPACO_TAPACOH_FK');
end if;

commit;

--FIM AJUSTE TASY_PADRAO_COR
--AJUSTE OBJ_SCHEMATIC_EVENTO_ACAO
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OBJEVTACAO_DICOBJE_FK'
and	table_name = 'OBJ_SCHEMATIC_EVENTO_ACAO'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	update OBJ_SCHEMATIC_EVENTO_ACAO a
	set  a.NR_SEQ_DIC_OBJ_MSG  = NULL
	where not exists ( SELECT 1
			 from DIC_OBJETO b
			 where 1 = 1
			 and a.NR_SEQ_DIC_OBJ_MSG = b.NR_SEQUENCIA)
	and (a.NR_SEQ_DIC_OBJ_MSG IS NOT NULL AND a.NR_SEQ_DIC_OBJ_MSG::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table OBJ_SCHEMATIC_EVENTO_ACAO enable constraint OBJEVTACAO_DICOBJE_FK');
end if;

commit;

--FIM AJUSTE OBJ_SCHEMATIC_EVENTO_ACAO
--AJUSTE OBJETO_SCHEMATIC_LEGENDA
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OBJSLE_DICOBJE_FK2'
and	table_name = 'OBJETO_SCHEMATIC_LEGENDA'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	update OBJETO_SCHEMATIC_LEGENDA a
	set a.NR_SEQ_DIC_OBJETO  = NULL
	where not exists ( SELECT 1
			from DIC_OBJETO b
			where 1 = 1
			and a.NR_SEQ_DIC_OBJETO = b.NR_SEQUENCIA)
	and (a.NR_SEQ_DIC_OBJETO IS NOT NULL AND a.NR_SEQ_DIC_OBJETO::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table OBJETO_SCHEMATIC_LEGENDA  enable constraint OBJSLE_DICOBJE_FK2');
end if;

select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OBJSLE_OBJSCHE_FK'
and	table_name = 'OBJETO_SCHEMATIC_LEGENDA'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	 delete from OBJETO_SCHEMATIC_LEGENDA a
	 where not exists ( SELECT 1
	 from OBJETO_SCHEMATIC b
	 where 1 = 1
	 and a.NR_SEQ_OBJETO = b.NR_SEQUENCIA
	)
	 and (a.NR_SEQ_OBJETO IS NOT NULL AND a.NR_SEQ_OBJETO::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table OBJETO_SCHEMATIC_LEGENDA enable constraint OBJSLE_OBJSCHE_FK');
end if;

commit;

--FIM AJUSTE OBJETO_SCHEMATIC_LEGENDA
--AJUSTE OBJETO_SCHEMATIC_ATIV
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OBJSCHATI_OBJSCHE_FK'
and	table_name = 'OBJETO_SCHEMATIC_ATIV'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	delete from OBJETO_SCHEMATIC_ATIV a
	 where not exists ( SELECT 1
	 from OBJETO_SCHEMATIC b
	 where 1 = 1
	 and a.NR_SEQ_OBJETO_SCHEMATIC = b.NR_SEQUENCIA
	)
	 and (a.NR_SEQ_OBJETO_SCHEMATIC IS NOT NULL AND a.NR_SEQ_OBJETO_SCHEMATIC::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table OBJETO_SCHEMATIC_ATIV enable constraint OBJSCHATI_OBJSCHE_FK');
end if;

commit;

--FIM AJUSTE OBJETO_SCHEMATIC_ATIV
--AJUSTE OBJETO_SCHEMATIC_COND_ATIV
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OBJSCCOAT_OBJSCHE_FK'
and	table_name = 'OBJETO_SCHEMATIC_COND_ATIV'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	update OBJETO_SCHEMATIC_COND_ATIV a
	 set  a.NR_SEQ_OBJ_REF = NULL
	 where not exists ( SELECT 1
	 from OBJETO_SCHEMATIC b
	 where 1 = 1
	 and a.NR_SEQ_OBJ_REF = b.NR_SEQUENCIA
	)
	 and (a.NR_SEQ_OBJ_REF IS NOT NULL AND a.NR_SEQ_OBJ_REF::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table OBJETO_SCHEMATIC_COND_ATIV enable constraint OBJSCCOAT_OBJSCHE_FK');
end if;

commit;

--FIM AJUSTE OBJETO_SCHEMATIC_COND_ATIV
--AJUSTE OBJETO_SCHEMATIC_PARAM
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OBJSCPM_OBJSCHE_FK'
and	table_name = 'OBJETO_SCHEMATIC_PARAM'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	update OBJETO_SCHEMATIC_PARAM a
	set a.NR_SEQ_OBJ_SCH  = NULL
	 where not exists ( SELECT 1
	 from OBJETO_SCHEMATIC b
	 where 1 = 1
	 and a.NR_SEQ_OBJ_SCH = b.NR_SEQUENCIA
	)
	 and (a.NR_SEQ_OBJ_SCH IS NOT NULL AND a.NR_SEQ_OBJ_SCH::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table OBJETO_SCHEMATIC_PARAM enable constraint OBJSCPM_OBJSCHE_FK');
end if;

commit;

--FIM AJUSTE OBJETO_SCHEMATIC_PARAM
--AJUSTE OBJ_SCHEMATIC_ATIV_PARAM
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OBJSCHPAR_OBJSCHE_FK'
and	table_name = 'OBJ_SCHEMATIC_ATIV_PARAM'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	update OBJ_SCHEMATIC_ATIV_PARAM a
	set a.NR_SEQ_OBJETO  = NULL
	where not exists ( SELECT 1
	from OBJETO_SCHEMATIC b
	where 1 = 1
	and a.NR_SEQ_OBJETO = b.NR_SEQUENCIA
	)
	and (a.NR_SEQ_OBJETO IS NOT NULL AND a.NR_SEQ_OBJETO::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table OBJ_SCHEMATIC_ATIV_PARAM enable constraint OBJSCHPAR_OBJSCHE_FK');
end if;

select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OBJSCHPAR_FUNSCHE_FK'
and	table_name = 'OBJ_SCHEMATIC_ATIV_PARAM'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	update  OBJ_SCHEMATIC_ATIV_PARAM a
	set a.NR_SEQ_FUNCAO_SCHEMATIC  = NULL
	where not exists ( SELECT 1
	from FUNCAO_SCHEMATIC b
	where 1 = 1
	and a.NR_SEQ_FUNCAO_SCHEMATIC = b.NR_SEQUENCIA
	)
	and (a.NR_SEQ_FUNCAO_SCHEMATIC IS NOT NULL AND a.NR_SEQ_FUNCAO_SCHEMATIC::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table OBJ_SCHEMATIC_ATIV_PARAM enable constraint OBJSCHPAR_FUNSCHE_FK');
end if;


select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OBJSCHPAR_OBJSCHE_FK2'
and	table_name = 'OBJ_SCHEMATIC_ATIV_PARAM'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	update OBJ_SCHEMATIC_ATIV_PARAM a
	set a.NR_SEQ_OBJ_SCHE_REL  = NULL
	where not exists ( SELECT 1
	from OBJETO_SCHEMATIC b
	where 1 = 1
	and a.NR_SEQ_OBJ_SCHE_REL = b.NR_SEQUENCIA
	)
	and (a.NR_SEQ_OBJ_SCHE_REL IS NOT NULL AND a.NR_SEQ_OBJ_SCHE_REL::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table OBJ_SCHEMATIC_ATIV_PARAM enable constraint OBJSCHPAR_OBJSCHE_FK2');
end if;


commit;

--FIM AJUSTE OBJ_SCHEMATIC_ATIV_PARAM
--AJUSTE OBJ_SCHEMATIC_EVENTO
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OBJSCHEV_OBJSCHE_FK'
and	table_name = 'OBJ_SCHEMATIC_EVENTO'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	update OBJ_SCHEMATIC_EVENTO a
	set a.NR_SEQ_OBJETO  = NULL
	where not exists ( SELECT 1
	from OBJETO_SCHEMATIC b
	where 1 = 1
	and a.NR_SEQ_OBJETO = b.NR_SEQUENCIA
	)
	and (a.NR_SEQ_OBJETO IS NOT NULL AND a.NR_SEQ_OBJETO::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table OBJ_SCHEMATIC_EVENTO enable constraint OBJSCHEV_OBJSCHE_FK');
end if;

commit;

--FIM AJUSTE OBJ_SCHEMATIC_EVENTO
--AJUSTE OPCOES_CRUD
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OPCRU_OBJSCHE_FK'
and	table_name = 'OPCOES_CRUD'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	update OPCOES_CRUD a
	set a.NR_SEQ_OBJETO_SCHEMATIC  = NULL
	where not exists ( SELECT 1
	from OBJETO_SCHEMATIC b
	where 1 = 1
	and a.NR_SEQ_OBJETO_SCHEMATIC = b.NR_SEQUENCIA
	)
	and (a.NR_SEQ_OBJETO_SCHEMATIC IS NOT NULL AND a.NR_SEQ_OBJETO_SCHEMATIC::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table OPCOES_CRUD enable constraint OPCRU_OBJSCHE_FK');
end if;

commit;

--FIM AJUSTE OPCOES_CRUD
--AJUSTE REGRA_CONDICAO
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'REGCON_OBJSCHE_FK'
and	table_name = 'REGRA_CONDICAO'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	update REGRA_CONDICAO a
	set a.NR_SEQ_OBJETO_SCHEMATIC  = NULL
	where not exists ( SELECT 1
	from OBJETO_SCHEMATIC b
	where 1 = 1
	and a.NR_SEQ_OBJETO_SCHEMATIC = b.NR_SEQUENCIA
	)
	and (a.NR_SEQ_OBJETO_SCHEMATIC IS NOT NULL AND a.NR_SEQ_OBJETO_SCHEMATIC::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table REGRA_CONDICAO enable constraint REGCON_OBJSCHE_FK');
end if;

commit;

--FIM AJUSTE REGRA_CONDICAO
--AJUSTE REGRA_CONDICAO_ITEM
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'RECOIT_OBJSCHE_FK'
and	table_name = 'REGRA_CONDICAO_ITEM'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	update REGRA_CONDICAO_ITEM a
	set a.NR_SEQ_OBJETO_SCHEMATIC  = NULL
	where not exists ( SELECT 1
	from OBJETO_SCHEMATIC b
	where 1 = 1
	and a.NR_SEQ_OBJETO_SCHEMATIC = b.NR_SEQUENCIA
	)
	and (a.NR_SEQ_OBJETO_SCHEMATIC IS NOT NULL AND a.NR_SEQ_OBJETO_SCHEMATIC::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table REGRA_CONDICAO_ITEM enable constraint RECOIT_OBJSCHE_FK');
end if;

commit;

--FIM AJUSTE REGRA_CONDICAO_ITEM
--AJUSTE SCHEMATIC_RELATORIO
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'SCHREL_OBJSCHE_FK'
and	table_name = 'SCHEMATIC_RELATORIO'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	update SCHEMATIC_RELATORIO a
	set a.NR_SEQ_OBJETO_SCHEMATIC  = NULL
	where not exists ( SELECT 1
	from OBJETO_SCHEMATIC b
	where 1 = 1
	and a.NR_SEQ_OBJETO_SCHEMATIC = b.NR_SEQUENCIA
	)
	and (a.NR_SEQ_OBJETO_SCHEMATIC IS NOT NULL AND a.NR_SEQ_OBJETO_SCHEMATIC::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table SCHEMATIC_RELATORIO enable constraint SCHREL_OBJSCHE_FK');
end if;

select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'SCHREL_RELATOR_FK'
and	table_name = 'SCHEMATIC_RELATORIO'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	update SCHEMATIC_RELATORIO a
	set	nr_seq_relatorio  = NULL
	where not exists ( SELECT 1
	from RELATORIO b
	where 1 = 1
	and a.NR_SEQ_RELATORIO = b.NR_SEQUENCIA
	)
	and (a.NR_SEQ_RELATORIO IS NOT NULL AND a.NR_SEQ_RELATORIO::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table SCHEMATIC_RELATORIO enable constraint SCHREL_RELATOR_FK');
end if;

commit;

--FIM AJUSTE SCHEMATIC_RELATORIO
--AJUSTE SCHEM_TEST_SCHEDULE
-- Dropar Indice da tabela: SCHEM_TEST_SCHEDULE
CALL exec_sql_dinamico('HTML5', 'alter table SCHEM_TEST_SCHEDULE Drop Index SCTESCH_SCTEURL_FK_I');

-- Criar Indice da tabela: SCHEM_TEST_SCHEDULE
CALL exec_sql_dinamico('HTML5', 'alter table SCHEM_TEST_SCHEDULE Create Index SCTESCH_SCTEURL_FK_I on SCHEM_TEST_SCHEDULE(NR_SEQ_URL)');


--FIM AJUSTE SCHEM_TEST_SCHEDULE
--AJUSTE TAB_VISAO_SCHEMATIC
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'TAVISCH_OBJSCHE_FK'
and	table_name = 'TAB_VISAO_SCHEMATIC'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	delete from TAB_VISAO_SCHEMATIC a
	where not exists ( SELECT 1
	from OBJETO_SCHEMATIC b
	where 1 = 1
	and a.NR_SEQ_OBJ_SCHEMATIC = b.NR_SEQUENCIA
	)
	and (a.NR_SEQ_OBJ_SCHEMATIC IS NOT NULL AND a.NR_SEQ_OBJ_SCHEMATIC::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table  TAB_VISAO_SCHEMATIC enable constraint  TAVISCH_OBJSCHE_FK');
end if;

commit;

--FIM AJUSTE TAB_VISAO_SCHEMATIC
--AJUSTE OBJETO_SCHEMATIC
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OBJSCHE_FUNSCHE_FK'
and	table_name = 'OBJETO_SCHEMATIC'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	update OBJETO_SCHEMATIC a
	set a.NR_SEQ_FUNCAO_SCHEMATIC  = NULL
	where not exists ( SELECT 1
	from FUNCAO_SCHEMATIC b
	where 1 = 1
	and a.NR_SEQ_FUNCAO_SCHEMATIC = b.NR_SEQUENCIA
	)
	and (a.NR_SEQ_FUNCAO_SCHEMATIC IS NOT NULL AND a.NR_SEQ_FUNCAO_SCHEMATIC::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table OBJETO_SCHEMATIC enable constraint OBJSCHE_FUNSCHE_FK');
end if;

select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OBJSCHE_OBJSCHE_FK'
and	table_name = 'OBJETO_SCHEMATIC'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	update OBJETO_SCHEMATIC a
	set a.NR_SEQ_OBJ_SUP  = NULL
	where not exists ( SELECT 1
	from OBJETO_SCHEMATIC b
	where 1 = 1
	and a.NR_SEQ_OBJ_SUP = b.NR_SEQUENCIA
	)
	and (a.NR_SEQ_OBJ_SUP IS NOT NULL AND a.NR_SEQ_OBJ_SUP::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table OBJETO_SCHEMATIC enable constraint OBJSCHE_OBJSCHE_FK');
end if;

select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OBJSCHE_OBJSCHE_FK2'
and	table_name = 'OBJETO_SCHEMATIC'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	update  OBJETO_SCHEMATIC a
	set a.NR_SEQ_OBJ_SUP_ATIV  = NULL
	where not exists ( SELECT 1
	from OBJETO_SCHEMATIC b
	where 1 = 1
	and a.NR_SEQ_OBJ_SUP_ATIV = b.NR_SEQUENCIA
	)
	and (a.NR_SEQ_OBJ_SUP_ATIV IS NOT NULL AND a.NR_SEQ_OBJ_SUP_ATIV::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table OBJETO_SCHEMATIC enable constraint OBJSCHE_OBJSCHE_FK2');
end if;

commit;

--FIM AJUSTE OBJETO_SCHEMATIC
--AJUSTE OBJ_SCHEMATIC_EVENTO_ACAO
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OBJEVTACAO_OBJSCHEV_FK'
and	table_name = 'OBJ_SCHEMATIC_EVENTO_ACAO'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then
	delete from OBJ_SCHEMATIC_EVENTO_ACAO a
	where not exists ( SELECT 1
	from OBJ_SCHEMATIC_EVENTO b
	where 1 = 1
	and a.NR_SEQ_OBJ_EVENTO = b.NR_SEQUENCIA
	)
	and (a.NR_SEQ_OBJ_EVENTO IS NOT NULL AND a.NR_SEQ_OBJ_EVENTO::text <> '');

	CALL exec_sql_dinamico('HTML5', 'alter table OBJ_SCHEMATIC_EVENTO_ACAO enable constraint OBJEVTACAO_OBJSCHEV_FK');
end if;

--FIM AJUSTE OBJ_SCHEMATIC_EVENTO_ACAO
--OBJETO_SCHEMATIC              |OBJSCHE_DICOBJE_FK
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OBJSCHE_DICOBJE_FK'
and	table_name = 'OBJETO_SCHEMATIC'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then

	update  OBJETO_SCHEMATIC a
	set a.NR_SEQ_DIC_OBJETO  = NULL
	where not exists ( SELECT 1
	from DIC_OBJETO b
	where 1 = 1
	and a.NR_SEQ_DIC_OBJETO = b.NR_SEQUENCIA)
	and (a.NR_SEQ_DIC_OBJETO IS NOT NULL AND a.NR_SEQ_DIC_OBJETO::text <> '');

	CALL exec_sql_dinamico('HTML5', ' alter table OBJETO_SCHEMATIC enable constraint OBJSCHE_DICOBJE_FK ');

end if;

--FIM OBJETO_SCHEMATIC              |OBJSCHE_DICOBJE_FK
--OBJETO_SCHEMATIC              |OBJSCHE_TABVISA_FK
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OBJSCHE_TABVISA_FK'
and	table_name = 'OBJETO_SCHEMATIC'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then

	 update OBJETO_SCHEMATIC a
	 set a.NR_SEQ_VISAO  = NULL
	 where not exists ( SELECT 1
		 from TABELA_VISAO b
		 where 1 = 1
		 and a.NR_SEQ_VISAO = b.NR_SEQUENCIA)
	 and (a.NR_SEQ_VISAO IS NOT NULL AND a.NR_SEQ_VISAO::text <> '');

	CALL exec_sql_dinamico('HTML5', ' alter table OBJETO_SCHEMATIC enable constraint OBJSCHE_TABVISA_FK ');
end if;

--FIm OBJETO_SCHEMATIC              |OBJSCHE_TABVISA_FK
--OBJETO_SCHEMATIC_COND_ATIV    |OBJSCCOAT_OBJSCHE_FK
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OBJSCCOAT_OBJSCHE_FK'
and	table_name = 'OBJETO_SCHEMATIC_COND_ATIV'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then

	update OBJETO_SCHEMATIC_COND_ATIV a
	set  a.NR_SEQ_OBJ_REF = NULL
	where not exists ( SELECT 1
		 from OBJETO_SCHEMATIC b
		 where 1 = 1
		 and a.NR_SEQ_OBJ_REF = b.NR_SEQUENCIA)
	 and (a.NR_SEQ_OBJ_REF IS NOT NULL AND a.NR_SEQ_OBJ_REF::text <> '');

	 CALL exec_sql_dinamico('HTML5', ' alter table OBJETO_SCHEMATIC_COND_ATIV enable constraint OBJSCCOAT_OBJSCHE_FK ');

end if;

--FIM OBJETO_SCHEMATIC_COND_ATIV    |OBJSCCOAT_OBJSCHE_FK
--OBJETO_SCHEMATIC               OBJSCHE_TABSIST_FK             lhalves         Integridade desabilitada
select	count(*)
into STRICT	qt_existe_w
from	user_constraints
where	constraint_name = 'OBJSCHE_TABSIST_FK'
and	table_name = 'OBJETO_SCHEMATIC'
and	status <> 'ENABLED';

if (qt_existe_w > 0) then

	update OBJETO_SCHEMATIC a
	set a.NM_TABELA  = NULL
	 where not exists ( SELECT 1
	 from TABELA_SISTEMA b
	 where 1 = 1
	 and a.NM_TABELA = b.NM_TABELA
	)
	 and (a.NM_TABELA IS NOT NULL AND a.NM_TABELA::text <> '');

	CALL exec_sql_dinamico('HTML5', ' alter table OBJETO_SCHEMATIC enable constraint OBJSCHE_TABSIST_FK' );
end if;

--FIM  OBJETO_SCHEMATIC               OBJSCHE_TABSIST_FK             lhalves         Integridade desabilitada
delete from OBJ_SCHEM_ORDER_PERFIL a
 where not exists ( SELECT 1
 from PERFIL b
 where 1 = 1
 and a.CD_PERFIL = b.CD_PERFIL
)
 and (a.CD_PERFIL IS NOT NULL AND a.CD_PERFIL::text <> '');

CALL exec_sql_dinamico('HTML5', ' alter Table OBJ_SCHEM_ORDER_PERFIL enable Constraint OBSCHOPE_PERFIL_FK' );

commit;

--INICIO ACESSO_PATIENT_BAR
update	INTEGRIDADE_ATRIBUTO
set	NM_ATRIBUTO = 'NR_SEQ_EPISODIO'
where	NM_TABELA = 'ACESSO_PATIENT_BAR'
and	NM_INTEGRIDADE_REFERENCIAL = 'ACEPABAR_CAEPPA_FK';

update	INDICE_ATRIBUTO
set	NM_ATRIBUTO = 'NR_SEQ_EPISODIO'
where	NM_TABELA = 'ACESSO_PATIENT_BAR'
and	NM_INDICE = 'ACEPABAR_CAEPPA_FK_I';

commit;

CALL exec_sql_dinamico('HTML5', 'alter table ACESSO_PATIENT_BAR drop constraint ACEPABAR_CAEPPA_FK');

CALL exec_sql_dinamico('HTML5', 'alter table ACESSO_PATIENT_BAR drop constraint ACEPABAR_PK');

CALL exec_sql_dinamico('HTML5', 'drop index ACEPABAR_CAEPPA_FK_I');

CALL exec_sql_dinamico('HTML5', 'Alter Table ACESSO_PATIENT_BAR add ( Constraint ACEPABAR_PK Primary Key (NR_SEQUENCIA))');

CALL exec_sql_dinamico('HTML5', 'Alter Table ACESSO_PATIENT_BAR add (Constraint ACEPABAR_CAEPPA_FK Foreign Key (NR_SEQ_EPISODIO) References EPISODIO_PACIENTE (NR_SEQUENCIA))');

CALL exec_sql_dinamico('HTML5', 'Create Index ACEPABAR_CAEPPA_FK_I on ACESSO_PATIENT_BAR(NR_SEQ_EPISODIO)');

CALL exec_sql_dinamico('HTML5', 'Create Index ACEPABAR_PK on ACESSO_PATIENT_BAR(NR_SEQUENCIA)');

--FIM  ACESSO_PATIENT_BAR
-- INICIO FONTE JAVA PALAVRA
CALL exec_sql_dinamico('HTML5', 'alter table FONTE_JAVA_PALAVRA drop constraint FOJAPAL_PK');

CALL exec_sql_dinamico('HTML5', 'drop index FOJAPAL_FOJALIN_FK_I');

CALL exec_sql_dinamico('HTML5', 'alter table FONTE_JAVA_PALAVRA drop constraint FOJAPAL_FOJALIN_FK_I');

CALL exec_sql_dinamico('HTML5', 'Create Index FOJAPAL_FOJALIN_FK_I on FONTE_JAVA_PALAVRA(NR_SEQ_LINHA)');

CALL exec_sql_dinamico('HTML5', 'Alter Table FONTE_JAVA_PALAVRA drop constraint FOJAPAL_FOJALIN_FK');

CALL exec_sql_dinamico('HTML5', 'Alter Table FONTE_JAVA_PALAVRA add ( Constraint FOJAPAL_FOJALIN_FK Foreign Key ( NR_SEQ_LINHA) References FONTE_JAVA_LINHA (NR_SEQUENCIA) on delete cascade)');

CALL exec_sql_dinamico('HTML5', 'Create Index FOJAPAL_PK on FONTE_JAVA_PALAVRA(NR_SEQUENCIA)');

CALL exec_sql_dinamico('HTML5', 'Alter Table FONTE_JAVA_PALAVRA add ( Constraint FOJAPAL_PK Primary Key (NR_SEQUENCIA))');

UPDATE	INDICE_ATRIBUTO
SET		NM_ATRIBUTO = 'NR_SEQ_LINHA'
WHERE	NM_TABELA = 'FONTE_JAVA_PALAVRA'
AND		NM_INDICE = 'FOJAPAL_FOJALIN_FK_I';

UPDATE	INTEGRIDADE_ATRIBUTO
SET		NM_ATRIBUTO = 'NR_SEQ_LINHA'
where 	NM_TABELA = 'FONTE_JAVA_PALAVRA'
AND		NM_INTEGRIDADE_REFERENCIAL = 'FOJAPAL_FOJALIN_FK';

/* Function release note */

select	count(1)
into STRICT	qt_existe_w
from	user_indexes
where	index_name = 'FUNRNOT_COMJAVA_FK_I';

if (qt_existe_w > 0) then
		CALL exec_sql_dinamico('HTML5', 'drop index FUNRNOT_COMJAVA_FK_I');
		CALL exec_sql_dinamico('HTML5', 'alter table function_release_note drop constraint FUNRNOT_COMJAVA_FK');
end if;

select	count(1)
into STRICT	qt_existe_w
from	user_indexes
where	index_name = 'FUNRNOT_CLAJAVA_FK_I';

if (qt_existe_w > 0) then
	CALL exec_sql_dinamico('HTML5', 'drop index FUNRNOT_CLAJAVA_FK_I');
	CALL exec_sql_dinamico('HTML5', 'alter table function_release_note drop constraint FUNRNOT_CLAJAVA_FK');
end if;

delete from integridade_atributo where nm_integridade_referencial = 'FOJAPAL_FOJALIN_FK';
delete from integridade_referencial where nm_integridade_referencial = 'FOJAPAL_FOJALIN_FK';
delete from indice_atributo where nm_indice = 'FOJAPAL_FOJALIN_FK_I';
delete from indice where nm_indice = 'FOJAPAL_FOJALIN_FK_I';
delete from indice_atributo where nm_indice = 'FOJAPAL_PK';
delete from indice where nm_indice = 'FOJAPAL_PK';

/* FIm function release note */

-- FIM FONTE JAVA PALAVRA
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tasy_ajustar_base_html5 () FROM PUBLIC;

