-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE nicu_insert_rule_aging ( NM_USUARIO_P text, DT_ATUALIZACAO_P timestamp, ID_TYPE_P text, QT_MIN_SHOW_NORMAL_P bigint, QT_MIN_SHOW_ITALICS_P bigint, QT_MIN_SHOW_ELLIPSES_P bigint, QT_MIN_NOT_SHOW_P bigint) AS $body$
DECLARE

			      
CD_EXISTE     bigint;


BEGIN
    SELECT coalesce(MAX(1), 0) INTO STRICT CD_EXISTE FROM NICU_CLINICAL_RULE_AGING WHERE ID_TYPE = ID_TYPE_P;

    IF (CD_EXISTE = 0) THEN
        INSERT INTO NICU_CLINICAL_RULE_AGING(
	            NR_SEQUENCIA,  
	            NM_USUARIO,
	            DT_ATUALIZACAO,
              	NM_USUARIO_NREC,
	            DT_ATUALIZACAO_NREC,
              	ID_TYPE,
              	QT_MIN_SHOW_NORMAL,
			    QT_MIN_SHOW_ITALICS,
              	QT_MIN_SHOW_ELLIPSES,
              	QT_MIN_NOT_SHOW          
        ) VALUES (
	            nextval('nicu_clinical_rule_aging_seq'),
	            NM_USUARIO_P,
	            DT_ATUALIZACAO_P,
              	NM_USUARIO_P,
	            DT_ATUALIZACAO_P,
              	ID_TYPE_P,
              	QT_MIN_SHOW_NORMAL_P,
			    QT_MIN_SHOW_ITALICS_P,
              	QT_MIN_SHOW_ELLIPSES_P,
              	QT_MIN_NOT_SHOW_P
        );
    ELSE
        UPDATE NICU_CLINICAL_RULE_AGING SET
              NM_USUARIO = NM_USUARIO_P,
	          DT_ATUALIZACAO = DT_ATUALIZACAO_P,
	          QT_MIN_SHOW_NORMAL =  QT_MIN_SHOW_NORMAL_P,
	          QT_MIN_SHOW_ITALICS = QT_MIN_SHOW_ITALICS_P,
	          QT_MIN_SHOW_ELLIPSES = QT_MIN_SHOW_ELLIPSES_P,
	          QT_MIN_NOT_SHOW = QT_MIN_NOT_SHOW_P
        WHERE
              ID_TYPE = ID_TYPE_P;
    END IF;
COMMIT;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE nicu_insert_rule_aging ( NM_USUARIO_P text, DT_ATUALIZACAO_P timestamp, ID_TYPE_P text, QT_MIN_SHOW_NORMAL_P bigint, QT_MIN_SHOW_ITALICS_P bigint, QT_MIN_SHOW_ELLIPSES_P bigint, QT_MIN_NOT_SHOW_P bigint) FROM PUBLIC;

