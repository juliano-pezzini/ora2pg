-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE fis_executa_ajuste_base (ds_ajuste_p text default null) AS $body$
DECLARE


c01 CURSOR FOR
	SELECT 	nr_sequencia,
		nm_usuario,
		ds_comando
	from	fis_ajuste_base
	where	((coalesce(ds_ajuste_p::text, '') = '')
	or (ds_ajuste_p = ds_ajuste))
	order by nr_sequencia asc;

vet01		c01%rowtype;
ds_log_w 	fis_ajuste_base.ds_log%type;
c_dbms_w	integer;	
retorno_w	integer;


BEGIN

	open c01;
	loop
	fetch c01 into	
		vet01;
	EXIT WHEN NOT FOUND; /* apply on c01 */
		begin
			c_dbms_w := dbms_sql.open_cursor;
			dbms_sql.parse(c_dbms_w, vet01.ds_comando, dbms_sql.native);
			retorno_w := dbms_sql.execute(c_dbms_w);
			dbms_sql.close_cursor(c_dbms_w);
			commit;
			
		exception when others then
			begin
				ds_log_w := substr(sqlerrm(SQLSTATE), 1, 4000);
				CALL tratar_erro_banco(ds_log_w);
				
				update 	fis_ajuste_base
				set 	ds_log = ds_log_w
				where 	nr_sequencia = vet01.nr_sequencia;
				commit;
				
				dbms_sql.close_cursor(c_dbms_w);
			end;
		end;
	end loop;
	close c01;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE fis_executa_ajuste_base (ds_ajuste_p text default null) FROM PUBLIC;

