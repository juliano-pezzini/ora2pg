-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copiar_projeto_assin_perfil (nr_sequencia_p bigint, cd_perfil_p bigint, nm_usuario_p text) AS $body$
BEGIN

if (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '')	and (cd_perfil_p IS NOT NULL AND cd_perfil_p::text <> '')	and (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '')	then
	insert into tasy_proj_assin_perfil(nr_sequencia,
					   nr_seq_proj,                                                                             					   dt_atualizacao,
					   nm_usuario,
					   dt_atualizacao_nrec,
					   nm_usuario_nrec,
					   cd_perfil,
					   ie_assinatura,
					   ie_consulta,
					   ie_forma_visualizar,
					   ie_consulta_automatica,
					   ie_alertar,
					   ds_diretorio,
					   nm_arquivo,
					   ie_gerar_pdf,
					   ie_solic_senha,
					   ds_mensagem_certificado,
					   ie_imprimir,
					   ds_mensagem_sucesso,
					   ie_nivel_log)
					   SELECT nextval('tasy_proj_assin_perfil_seq'),
						  a.nr_seq_proj,
						  clock_timestamp(),
						  nm_usuario_p,
						  clock_timestamp(),
						  nm_usuario_p,
						  cd_perfil_p,
						  a.ie_assinatura,
						  a.ie_consulta,
						  a.ie_forma_visualizar,
						  a.ie_consulta_automatica,
						  a.ie_alertar,
						  a.ds_diretorio,
						  a.nm_arquivo,
						  a.ie_gerar_pdf,
						  a.ie_solic_senha,
						  a.ds_mensagem_certificado,
						  a.ie_imprimir,
						  a.ds_mensagem_sucesso,
						  coalesce(a.ie_nivel_log,0)
					   from  tasy_proj_assin_perfil a
					   where a.nr_sequencia = nr_sequencia_p
					   and	 not exists (SELECT 1
							            from 	tasy_proj_assin_perfil b
								    where	b.nr_seq_proj = a.nr_seq_proj and
										b.cd_perfil   = cd_perfil_p);
	commit;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copiar_projeto_assin_perfil (nr_sequencia_p bigint, cd_perfil_p bigint, nm_usuario_p text) FROM PUBLIC;

