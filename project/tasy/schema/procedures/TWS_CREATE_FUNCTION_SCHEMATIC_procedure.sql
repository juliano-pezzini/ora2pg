-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE tws_create_function_schematic (cd_funcao_p funcao.cd_funcao%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: Criar a função no schematic pela função Gerenciador do schematic
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ x] Outros: Tasy HTML5
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
cd_exp_schematics_w		dic_expressao.cd_expressao%type;
ds_expressao_w			dic_expressao.ds_expressao_br%type;
nr_seq_funcao_schematic_w	funcao_schematic.nr_sequencia%type;
nr_seq_obj_schematic_w          objeto_schematic.nr_seq_obj_sup%type;
qt_registro_w			integer;


BEGIN


if (cd_funcao_p IS NOT NULL AND cd_funcao_p::text <> '') then

	select 	count(1)
	into STRICT	qt_registro_w
	from	funcao_schematic
	where	cd_funcao = cd_funcao_p;


	if ( qt_registro_w = 0 ) then

		select	cd_exp_funcao,
			obter_desc_expressao( cd_exp_funcao, null) ds_expressao
		into STRICT	cd_exp_schematics_w,
			ds_expressao_w
		from	funcao
		where	cd_funcao = cd_funcao_p;


		insert into funcao_schematic(
			nr_sequencia, dt_atualizacao, nm_usuario,
			dt_atualizacao_nrec, nm_usuario_nrec, cd_funcao,
			cd_exp_schematic, ie_situacao_funcao, ds_schematic)
		values (	nextval('funcao_schematic_seq'), clock_timestamp(), nm_usuario_p,
			clock_timestamp(), nm_usuario_p, cd_funcao_p,
			cd_exp_schematics_w, 'A', ds_expressao_w) returning nr_sequencia into nr_seq_funcao_schematic_w;
		commit;

	end if;

end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tws_create_function_schematic (cd_funcao_p funcao.cd_funcao%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;

