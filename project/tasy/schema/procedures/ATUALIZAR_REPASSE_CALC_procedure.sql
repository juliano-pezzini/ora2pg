-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_repasse_calc (nr_interno_conta_p bigint) AS $body$
DECLARE


c_procedimento CURSOR(nr_interno_conta_pc	conta_paciente.nr_interno_conta%type) FOR
	SELECT	a.nr_seq_procedimento,
		coalesce(a.nr_seq_partic,0) nr_seq_partic,
		coalesce(a.vl_repasse,0) vl_repasse
	from	procedimento_paciente b,
		procedimento_repasse a
	where	a.nr_seq_procedimento = b.nr_sequencia
	and	b.nr_interno_conta = nr_interno_conta_pc;

c_material CURSOR(nr_interno_conta_pc	conta_paciente.nr_interno_conta%type) FOR
	SELECT	a.nr_seq_material,
		coalesce(a.vl_repasse,0) vl_repasse
	from	material_atend_paciente b,
		material_repasse a
	where	a.nr_seq_material = b.nr_sequencia
	and	b.nr_interno_conta = nr_interno_conta_pc;
BEGIN

for	r_c_procedimento in c_procedimento(nr_interno_conta_p) loop
	if (r_c_procedimento.nr_seq_partic > 0) then
		update	procedimento_participante
		set	vl_repasse_calc			= r_c_procedimento.vl_repasse
		where	nr_seq_partic			= r_c_procedimento.nr_seq_partic
		and	nr_sequencia			= r_c_procedimento.nr_seq_procedimento;
	else
		update	procedimento_paciente
		set	vl_repasse_calc			= r_c_procedimento.vl_repasse
		where	nr_sequencia			= r_c_procedimento.nr_seq_procedimento;
	end if;
end loop;

for	r_c_material in c_material(nr_interno_conta_p) loop
	update	material_atend_paciente
	set	vl_repasse_calc				= r_c_material.vl_repasse
	where	nr_sequencia				= r_c_material.nr_seq_material;
end loop;

if (coalesce(wheb_usuario_pck.get_ie_commit, 'S') = 'S') then commit; end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_repasse_calc (nr_interno_conta_p bigint) FROM PUBLIC;

