-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE calcular_taxa_infusao_md (ds_volume_p text, ds_intervalo_p text, diluicao_ds_tempo_p text, qt_hora_aplicacao_p bigint, qt_min_aplicacao_p bigint, ds_retorno_p text, ie_aplicar_p text, ds_dose_diferenciada_p text, ie_administrar_ui_p text, qt_material_conversao_uni_p bigint, qt_regra_setor_conv_unidade_p bigint, dose_convertida_p bigint, qt_vel_infusao_p INOUT bigint, ie_tipo_dosagem_p INOUT text, qt_kcal_nutri_p bigint, ds_aplicar_p INOUT text, ds_retorno_inf_p INOUT text, ds_adm_ui_p INOUT text) AS $body$
BEGIN
  if (ds_volume_p IS NOT NULL AND ds_volume_p::text <> '') then
    ds_aplicar_p := wheb_mensagem_pck.get_texto(307088) || ds_volume_p;
    if (ds_intervalo_p IS NOT NULL AND ds_intervalo_p::text <> '') then
      ds_aplicar_p := ds_aplicar_p || ' (' || ds_intervalo_p || ')';
    end if;
    ds_aplicar_p := ds_aplicar_p || ' ' || diluicao_ds_tempo_p;

    if (qt_hora_aplicacao_p > 0 or qt_min_aplicacao_p > 0) then
      ds_retorno_inf_p     := ds_retorno_p;
      qt_vel_infusao_p  := qt_vel_infusao_p;
      ie_tipo_dosagem_p := ie_tipo_dosagem_p;
      ds_aplicar_p         := ds_aplicar_p || ds_retorno_inf_p;
      if (ie_administrar_ui_p = 'S') then
        if (qt_material_conversao_uni_p > 0) then
          if (qt_regra_setor_conv_unidade_p > 0) then
            ds_adm_ui_p := wheb_mensagem_pck.get_texto(307088) || ' ' ||
                         dose_convertida_p || ' UI';
            if (ds_intervalo_p IS NOT NULL AND ds_intervalo_p::text <> '') then
              ds_adm_ui_p := ds_adm_ui_p || ' (' || ds_intervalo_p || ')';
            end if;
            ds_adm_ui_p    := ds_adm_ui_p || ' ' || diluicao_ds_tempo_p;
            ds_aplicar_p := ds_aplicar_p || chr(10) || ds_adm_ui_p;
          end if;
        end if;
      end if;

    if (ds_aplicar_p IS NOT NULL AND ds_aplicar_p::text <> '') and (qt_kcal_nutri_p IS NOT NULL AND qt_kcal_nutri_p::text <> '') then
      ds_aplicar_p:= ds_aplicar_p || chr(10) || wheb_mensagem_pck.get_texto(1165558) || ' ' || qt_kcal_nutri_p;
    end if;

    end if;
  else
    if (diluicao_ds_tempo_p IS NOT NULL AND diluicao_ds_tempo_p::text <> '') then
      ds_aplicar_p := wheb_mensagem_pck.get_texto(307088) || ds_volume_p;
      if (qt_hora_aplicacao_p > 0 or qt_min_aplicacao_p > 0) then
        ds_retorno_inf_p     := ds_retorno_p;
        qt_vel_infusao_p  := qt_vel_infusao_p;
        ie_tipo_dosagem_p := ie_tipo_dosagem_p;
        ds_aplicar_p         := ds_aplicar_p || ds_retorno_inf_p;
      end if;
      if (ie_aplicar_p = 'N' or (ds_dose_diferenciada_p IS NOT NULL AND ds_dose_diferenciada_p::text <> '')) then
        ds_aplicar_p := '';
      end if;

    end if;
  end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE calcular_taxa_infusao_md (ds_volume_p text, ds_intervalo_p text, diluicao_ds_tempo_p text, qt_hora_aplicacao_p bigint, qt_min_aplicacao_p bigint, ds_retorno_p text, ie_aplicar_p text, ds_dose_diferenciada_p text, ie_administrar_ui_p text, qt_material_conversao_uni_p bigint, qt_regra_setor_conv_unidade_p bigint, dose_convertida_p bigint, qt_vel_infusao_p INOUT bigint, ie_tipo_dosagem_p INOUT text, qt_kcal_nutri_p bigint, ds_aplicar_p INOUT text, ds_retorno_inf_p INOUT text, ds_adm_ui_p INOUT text) FROM PUBLIC;

