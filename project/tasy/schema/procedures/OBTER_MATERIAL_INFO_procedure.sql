-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_material_info ( cd_material_p text, ie_dias_util_medic_p INOUT text, cd_unidade_medida_consumo_p INOUT text, ie_via_aplicacao_p INOUT text, ie_tipo_material_p INOUT text, ie_bomba_infusao_p INOUT text, cd_intervalo_p INOUT text, ds_erro_p INOUT text) AS $body$
DECLARE

	
cd_estabelecimento_w		smallint := wheb_usuario_pck.get_cd_estabelecimento;
	

BEGIN

if (cd_material_p IS NOT NULL AND cd_material_p::text <> '') then
	begin
	
	select	max(ie_dias_util_medic),
		max(substr(obter_dados_material_estab(cd_material,cd_estabelecimento_w,'UMS'),1,30)) cd_unidade_medida_consumo,
		max(ie_via_aplicacao),
		max(ie_tipo_material),
		max(ie_bomba_infusao)
	into STRICT	ie_dias_util_medic_p,
		cd_unidade_medida_consumo_p,
		ie_via_aplicacao_p,
		ie_tipo_material_p,
		ie_bomba_infusao_p
	from	material	
	where	cd_material = cd_material_p;
	
	select	max(cd_intervalo)
	into STRICT	cd_intervalo_p
	from	intervalo_prescricao
	where	ie_agora = 'S'
	and 	qt_operacao = 1
	and 	coalesce(ie_situacao, 'A') = 'A';

	if (coalesce(cd_intervalo_p::text, '') = '') or (cd_intervalo_p = '') then
		select	max(cd_intervalo)
		into STRICT	cd_intervalo_p
		from	intervalo_prescricao
		where	ie_agora = 'S';
	end if;
	
	if (coalesce(cd_intervalo_p::text, '') = '') or (cd_intervalo_p = '') then
		ds_erro_p := obter_texto_tasy(47100, wheb_usuario_pck.get_nr_seq_idioma);
	end if;
	
	end;
	
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_material_info ( cd_material_p text, ie_dias_util_medic_p INOUT text, cd_unidade_medida_consumo_p INOUT text, ie_via_aplicacao_p INOUT text, ie_tipo_material_p INOUT text, ie_bomba_infusao_p INOUT text, cd_intervalo_p INOUT text, ds_erro_p INOUT text) FROM PUBLIC;

