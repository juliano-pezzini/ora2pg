-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE schematic_copiar_legenda (nr_seq_legenda_p bigint, nr_seq_objeto_destino_p bigint, nm_usuario_p text) AS $body$
DECLARE


    nr_sequencia_w    bigint;
    nr_seq_condicao_w bigint;
    nr_seq_regra_w    bigint;
    nr_sequencia_rem_w bigint;

    c01 CURSOR FOR
        SELECT * from regra_condicao where nr_seq_obj_sch_leg = nr_seq_legenda_p;

    c02 CURSOR FOR
        SELECT * from regra_condicao_item where nr_seq_regra = nr_seq_regra_w;

    c01_w c01%rowtype;
    c02_w c02%rowtype;


BEGIN

    $if $$tasy_local_dict=true $then
    nr_sequencia_w := get_remote_sequence('seq:objeto_schematic_legenda_seq');
    $else
    select nextval('objeto_schematic_legenda_seq') into STRICT nr_sequencia_w;
    $end

    insert into objeto_schematic_legenda(nr_sequencia,
         nr_seq_objeto,
         ie_aplicacao,
         dt_atualizacao,
         nm_usuario,
         dt_atualizacao_nrec,
         nm_usuario_nrec,
         nr_seq_apres,
         nr_seq_dic_objeto,
         nr_seq_legenda,
         nm_atributo,
         ie_forma_apres,
         nm_atributo_cor,
         ie_situacao,
         nm_atributo_chave,
         ie_mostrar_desc)
        SELECT nr_sequencia_w,
               nr_seq_objeto_destino_p,
               ie_aplicacao,
               clock_timestamp(),
               nm_usuario_p,
               clock_timestamp(),
               nm_usuario_p,
               nr_seq_apres,
               nr_seq_dic_objeto,
               nr_seq_legenda,
               nm_atributo,
               ie_forma_apres,
               nm_atributo_cor,
               ie_situacao,
               nm_atributo_chave,
               ie_mostrar_desc
          from objeto_schematic_legenda
         where nr_sequencia = nr_seq_legenda_p;

    CALL wheb_usuario_pck.set_ie_executar_trigger('N');
    open c01;
    loop
        fetch c01
            into c01_w;
        EXIT WHEN NOT FOUND; /* apply on c01 */
        begin

            nr_seq_regra_w := c01_w.nr_sequencia;

            $if $$tasy_local_dict=true $then
            nr_seq_condicao_w := get_remote_sequence('seq:regra_condicao_seq');
            $else
            select nextval('regra_condicao_seq') into STRICT nr_seq_condicao_w;
            $end

            insert into regra_condicao(nr_sequencia,
                 nr_seq_legenda,
                 dt_atualizacao,
                 nm_condicao,
                 dt_atualizacao_nrec,
                 nm_usuario,
                 nm_usuario_nrec,
                 nr_seq_objeto,
                 nr_seq_objeto_schematic,
                 nr_seq_opcao_crud,
                 nr_ordem_execucao,
                 ds_resultado_condicao,
                 cd_exp_msg_regra,
                 nr_seq_obj_sch_leg,
                 nr_seq_tasy_img)
            values (nr_seq_condicao_w,
                 c01_w.nr_seq_legenda,
                 clock_timestamp(),
                 c01_w.nm_condicao,
                 clock_timestamp(),
                 nm_usuario_p,
                 nm_usuario_p,
                 c01_w.nr_seq_objeto,
                 c01_w.nr_seq_objeto_schematic,
                 c01_w.nr_seq_opcao_crud,
                 c01_w.nr_ordem_execucao,
                 c01_w.ds_resultado_condicao,
                 c01_w.cd_exp_msg_regra,
                 nr_sequencia_w,
                 c01_w.nr_seq_tasy_img);

            open c02;
            loop
                fetch c02
                    into c02_w;
                EXIT WHEN NOT FOUND; /* apply on c02 */
                begin

                    $if $$tasy_local_dict=true $then
                    nr_sequencia_rem_w := get_remote_sequence('seq:regra_condicao_item_seq');
                    $else
                    select nextval('regra_condicao_item_seq') into STRICT nr_sequencia_rem_w;
                    $end

                    insert into regra_condicao_item(nr_sequencia,
                         dt_atualizacao,
                         dt_atualizacao_nrec,
                         ie_condicao,
                         ie_opcao_comparacao,
                         ie_valor,
                         nm_atributo,
                         nm_atributo_base,
                         nm_usuario,
                         nm_usuario_nrec,
                         vl_parametro,
                         cd_funcao,
                         nr_seq_param,
                         nr_seq_regra,
                         ie_grid_detalhe,
                         ie_edit,
                         ie_insert,
                         ie_browser,
                         ie_qtdade_registro_selec,
                         nr_seq_objeto_schematic,
                         nm_variavel_sistema,
                         ds_action)
                    values (nr_sequencia_rem_w, --regra_condicao_item_seq.nextval,
                         clock_timestamp(),
                         clock_timestamp(),
                         c02_w.ie_condicao,
                         c02_w.ie_opcao_comparacao,
                         c02_w.ie_valor,
                         c02_w.nm_atributo,
                         c02_w.nm_atributo_base,
                         nm_usuario_p,
                         nm_usuario_p,
                         c02_w.vl_parametro,
                         c02_w.cd_funcao,
                         c02_w.nr_seq_param,
                         nr_seq_condicao_w,
                         c02_w.ie_grid_detalhe,
                         c02_w.ie_edit,
                         c02_w.ie_insert,
                         c02_w.ie_browser,
                         c02_w.ie_qtdade_registro_selec,
                         c02_w.nr_seq_objeto_schematic,
                         c02_w.nm_variavel_sistema,
                         c02_w.ds_action);

                end;
            end loop;
            close c02;

        end;
    end loop;
    close c01;
    CALL wheb_usuario_pck.set_ie_executar_trigger('S');

    commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE schematic_copiar_legenda (nr_seq_legenda_p bigint, nr_seq_objeto_destino_p bigint, nm_usuario_p text) FROM PUBLIC;

