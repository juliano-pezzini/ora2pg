-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE med_inserir_textos (cd_medico_p text, nr_ficha_p bigint, ds_tipo_texto_p text, dt_texto_p timestamp, ds_texto_p text, nm_usuario_p text) AS $body$
DECLARE



nr_seq_texto_w		bigint;
nr_seq_cliente_w	bigint;
nr_seq_tipo_exame_w	bigint;
cd_pessoa_fisica_w	varchar(10);


BEGIN

select	coalesce(max(nr_sequencia),0)
into STRICT	nr_seq_cliente_w
from	med_cliente
where	cd_medico		= cd_medico_p
and	cd_pessoa_sist_orig	= nr_ficha_p;


if (nr_seq_cliente_w > 0) then
	begin
	if (ds_tipo_texto_p	= obter_desc_expressao(297315)/*'Receita'*/
) then
		begin

		select	nextval('med_receita_seq')
		into STRICT	nr_seq_texto_w
		;

		select	max(cd_pessoa_fisica)
		into STRICT	cd_pessoa_fisica_w
		from	med_cliente
		where	nr_sequencia	= nr_seq_cliente_w;

		insert	into med_receita(nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_receita,
			ds_receita,
			nr_seq_cliente,
			cd_pessoa_fisica)
		values (nr_seq_texto_w,
			clock_timestamp(),
			nm_usuario_p,
			dt_texto_p,
			ds_texto_p,
			nr_seq_cliente_w,
			cd_pessoa_fisica_w);

		end;
	end if;
	if (ds_tipo_texto_p	= obter_desc_expressao(299354)/*'Textos'*/
) then
		begin

		select	nextval('med_texto_adicional_seq')
		into STRICT	nr_seq_texto_w
		;

		insert	into med_texto_adicional(nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_texto,
			ds_texto,
			nr_seq_cliente)
		values (nr_seq_texto_w,
			clock_timestamp(),
			nm_usuario_p,
			dt_texto_p,
			ds_texto_p,
			nr_seq_cliente_w);

		end;
	end if;
	if (ds_tipo_texto_p	= 'Sol. exames') then
		begin

		select	nextval('med_pedido_exame_seq')
		into STRICT	nr_seq_texto_w
		;

		insert	into med_pedido_exame(nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_solicitacao,
			ds_solicitacao,
			nr_seq_cliente,
			ie_ficha_unimed)
		values (nr_seq_texto_w,
			clock_timestamp(),
			nm_usuario_p,
			dt_texto_p,
			ds_texto_p,
			nr_seq_cliente_w,
			'N');

		end;
	end if;
	if (ds_tipo_texto_p	= obter_desc_expressao(330657)/*'Cardiologia'*/
) then
		begin

		select	coalesce(max(nr_sequencia),0)
		into STRICT	nr_seq_tipo_exame_w
		from	med_tipo_exame_avaliacao
		where	cd_medico	= cd_medico_p
		and	ds_tipo_exame	= obter_desc_expressao(330657); --'Cardiologia';
		if (nr_seq_tipo_exame_w = 0) then
			begin

			select	nextval('med_tipo_exame_avaliacao_seq')
			into STRICT	nr_seq_tipo_exame_w
			;

			insert	into med_tipo_exame_avaliacao(nr_sequencia,
				cd_medico,
				ds_tipo_exame,
				nr_seq_apresent,
				dt_atualizacao,
				nm_usuario,
				IE_INTERNO_EXTERNO)
			values (nr_seq_tipo_exame_w,
				cd_medico_p,
				obter_desc_expressao(330657), --'Cardiologia',
				5, clock_timestamp(), nm_usuario_p, 'E');
			end;
		end if;


		select	nextval('med_exame_avaliacao_seq')
		into STRICT	nr_seq_texto_w
		;

		insert	into med_exame_avaliacao(nr_sequencia,
			nr_atendimento,
			nr_seq_tipo_exame,
			dt_atualizacao,
			nm_usuario,
			dt_exame,
			ds_exame,
			nr_seq_cliente)
		values (nr_seq_texto_w,
			null,
			nr_seq_tipo_exame_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			ds_texto_p,
			nr_seq_cliente_w);
		end;
	end if;
	if (ds_tipo_texto_p	= obter_desc_expressao(300869)/*'Urina'*/
) then
		begin

		select	coalesce(max(nr_sequencia),0)
		into STRICT	nr_seq_tipo_exame_w
		from	med_tipo_exame_avaliacao
		where	cd_medico	= cd_medico_p
		and	ds_tipo_exame	= obter_desc_expressao(300869) /*'Urina'*/
;


		if (nr_seq_tipo_exame_w = 0) then
			begin

			select	nextval('med_tipo_exame_avaliacao_seq')
			into STRICT	nr_seq_tipo_exame_w
			;

			insert	into med_tipo_exame_avaliacao(nr_sequencia,
				cd_medico,
				ds_tipo_exame,
				nr_seq_apresent,
				dt_atualizacao,
				nm_usuario,
				IE_INTERNO_EXTERNO)
			values (nr_seq_tipo_exame_w,
				cd_medico_p,
				obter_desc_expressao(300869)/*'Urina'*/
,
				10, clock_timestamp(), nm_usuario_p, 'E');
			end;
		end if;


		select	nextval('med_exame_avaliacao_seq')
		into STRICT	nr_seq_texto_w
		;

		insert	into med_exame_avaliacao(nr_sequencia,
			nr_atendimento,
			nr_seq_tipo_exame,
			dt_atualizacao,
			nm_usuario,
			dt_exame,
			ds_exame,
			nr_seq_cliente)
		values (nr_seq_texto_w,
			null,
			nr_seq_tipo_exame_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			ds_texto_p,
			nr_seq_cliente_w);
		end;
	end if;
	if (ds_tipo_texto_p	= 'RX/Outros') then
		begin

		select	coalesce(max(nr_sequencia),0)
		into STRICT	nr_seq_tipo_exame_w
		from	med_tipo_exame_avaliacao
		where	cd_medico	= cd_medico_p
		and	ds_tipo_exame	= 'RX/Outros';


		if (nr_seq_tipo_exame_w = 0) then
			begin

			select	nextval('med_tipo_exame_avaliacao_seq')
			into STRICT	nr_seq_tipo_exame_w
			;

			insert	into med_tipo_exame_avaliacao(nr_sequencia,
				cd_medico,
				ds_tipo_exame,
				nr_seq_apresent,
				dt_atualizacao,
				nm_usuario, IE_INTERNO_EXTERNO)
			values (nr_seq_tipo_exame_w,
				cd_medico_p,
				'RX/Outros',
				15, clock_timestamp(), nm_usuario_p, 'E');
			end;
		end if;


		select	nextval('med_exame_avaliacao_seq')
		into STRICT	nr_seq_texto_w
		;

		insert	into med_exame_avaliacao(nr_sequencia,
			nr_atendimento,
			nr_seq_tipo_exame,
			dt_atualizacao,
			nm_usuario,
			dt_exame,
			ds_exame,
			nr_seq_cliente)
		values (nr_seq_texto_w,
			null,
			nr_seq_tipo_exame_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			ds_texto_p,
			nr_seq_cliente_w);
		end;
	end if;
	end;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE med_inserir_textos (cd_medico_p text, nr_ficha_p bigint, ds_tipo_texto_p text, dt_texto_p timestamp, ds_texto_p text, nm_usuario_p text) FROM PUBLIC;

