-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_carga_preco ( dt_inicio_vigencia_p timestamp, nm_tabela_p text, dt_fim_vigencia_p timestamp, nr_protocolo_ans_p text, cd_codigo_scpa_p text, cd_codigo_ant_p text, ie_tabela_base_p text, ie_proposta_adesao_p text, qt_idade_inicial_p bigint, qt_idade_final_p bigint, vl_preco_inicial_p bigint, vl_preco_atual_p bigint, tx_acrescimo_p bigint, vl_preco_nao_subsidiado_p bigint, vl_preco_nao_subsid_atual_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint) AS $body$
DECLARE


nr_seq_plano_w			bigint;
nr_seq_preco_w			bigint;


BEGIN

nr_seq_plano_w	:= pls_obter_plano_preco_scpa(nr_protocolo_ans_p, cd_codigo_scpa_p);

select	nextval('w_pls_carga_preco_seq')
into STRICT	nr_seq_preco_w
;

insert into w_pls_carga_preco(nr_sequencia, dt_inicio_vigencia, cd_estabelecimento,
	dt_atualizacao, nm_usuario, nm_tabela,
	dt_fim_vigencia, nr_protocolo, cd_codigo_scpa,
	nr_seq_plano, cd_codigo_ant, ie_tabela_base,
	ie_tabela_contrato, ie_proposta_adesao, ie_simulacao_preco,
	nr_seq_tabela, qt_idade_inicial, qt_idade_final,
	vl_preco_inicial, vl_preco_atual, tx_acrescimo,
	vl_preco_nao_subsidiado, vl_preco_nao_subsid_atual)
values (	nr_seq_preco_w, dt_inicio_vigencia_p, cd_estabelecimento_p,
	clock_timestamp(), nm_usuario_p, nm_tabela_p,
	dt_fim_vigencia_p, nr_protocolo_ans_p, cd_codigo_scpa_p,
	nr_seq_plano_w, cd_codigo_ant_p, ie_tabela_base_p,
	'S', ie_proposta_adesao_p, 'N',
	nr_seq_preco_w, qt_idade_inicial_p, qt_idade_final_p,
	vl_preco_inicial_p, vl_preco_atual_p,  tx_acrescimo_p,
	vl_preco_nao_subsidiado_p, vl_preco_nao_subsid_atual_p);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_carga_preco ( dt_inicio_vigencia_p timestamp, nm_tabela_p text, dt_fim_vigencia_p timestamp, nr_protocolo_ans_p text, cd_codigo_scpa_p text, cd_codigo_ant_p text, ie_tabela_base_p text, ie_proposta_adesao_p text, qt_idade_inicial_p bigint, qt_idade_final_p bigint, vl_preco_inicial_p bigint, vl_preco_atual_p bigint, tx_acrescimo_p bigint, vl_preco_nao_subsidiado_p bigint, vl_preco_nao_subsid_atual_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint) FROM PUBLIC;

