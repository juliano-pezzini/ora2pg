-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gerar_atendimento_portal ( cd_estabelecimento_p bigint, nm_usuario_p text, ie_origem_p text, ie_tipo_pessoa_p text, ie_tipo_ocorrencia_p text, nr_seq_segurado_p bigint, nr_seq_contrato_p bigint, nr_seq_pagador_p bigint, nr_seq_prestador_p bigint, nm_contato_p text, nr_telefone_p text, nr_seq_operador_p bigint, cd_pessoa_fisica_p text, nr_seq_atendimento_p INOUT bigint, nr_seq_evento_p INOUT bigint) AS $body$
DECLARE


nr_seq_atendimento_w	bigint;
nr_seq_evento_w		bigint;


BEGIN

select	nextval('pls_atendimento_seq')
into STRICT 	nr_seq_atendimento_w
;

select	nextval('pls_atendimento_evento_seq')
into STRICT 	nr_seq_evento_w
;


insert into pls_atendimento(
	nr_sequencia, cd_estabelecimento, ie_origem_atendimento,
	ie_tipo_pessoa, dt_atualizacao, nm_usuario,
        dt_atualizacao_nrec, nm_usuario_nrec, ie_tipo_ocorrencia,
	dt_inicio, dt_fim_atendimento, nr_seq_evento,
        nr_seq_regra_tempo, nr_seq_segurado, nr_seq_contrato,
        nr_seq_pagador, nr_seq_prestador, ie_status,
	dt_conclusao, nm_contato, nr_telefone,
        nr_seq_congenere, ie_tipo_atendimento, ds_historico_atend_chat,
        nr_seq_operador, nr_seq_motivo_conclusao, cd_pessoa_fisica)
values ( nr_seq_atendimento_w, cd_estabelecimento_p, ie_origem_p,
        ie_tipo_pessoa_p, clock_timestamp(), nm_usuario_p,
        clock_timestamp(), nm_usuario_p, ie_tipo_ocorrencia_p,
	clock_timestamp(), null, null,
        null, nr_seq_segurado_p, nr_seq_contrato_p,
	nr_seq_pagador_p, nr_seq_prestador_p, 'A',
	null, nm_contato_p, nr_telefone_p,
	null, 'R', null,
	nr_seq_operador_p,  null, cd_pessoa_fisica_p);


insert into pls_atendimento_evento(
	nr_sequencia, nr_seq_atendimento, ie_tipo_ocorrencia,
	nr_seq_evento, dt_inicio, ie_status,
	dt_atualizacao, nm_usuario, dt_atualizacao_nrec,
	nm_usuario_nrec, dt_conclusao, dt_fim_evento,
	ds_observacao)
values ( nr_seq_evento_w, nr_seq_atendimento_w, ie_tipo_ocorrencia_p,
	20,	clock_timestamp(), 'A',
	clock_timestamp(), nm_usuario_p, clock_timestamp(),
	nm_usuario_p, null, null,
	null);

nr_seq_atendimento_p := nr_seq_atendimento_w;
nr_seq_evento_p	:= nr_seq_evento_w;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_atendimento_portal ( cd_estabelecimento_p bigint, nm_usuario_p text, ie_origem_p text, ie_tipo_pessoa_p text, ie_tipo_ocorrencia_p text, nr_seq_segurado_p bigint, nr_seq_contrato_p bigint, nr_seq_pagador_p bigint, nr_seq_prestador_p bigint, nm_contato_p text, nr_telefone_p text, nr_seq_operador_p bigint, cd_pessoa_fisica_p text, nr_seq_atendimento_p INOUT bigint, nr_seq_evento_p INOUT bigint) FROM PUBLIC;

