-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_rule_schem_order (nr_seq_lote_p bigint, cd_funcao_p bigint, nr_seq_parametro_p bigint, vl_param_origem_p text, cd_estab_param_p bigint, cd_perfil_param_p bigint, nm_usuario_param_p text, nr_seq_obj_schem_p bigint, nr_seq_obj_padrao_p bigint, ds_regra_p text, nm_usuario_p text, nr_seq_regra_p INOUT bigint) AS $body$
DECLARE


    nr_sequencia_w bigint;
    nr_seq_regra_w obj_schem_order.nr_sequencia%type;


BEGIN

    nr_seq_regra_w := coalesce(nr_seq_regra_p, 0);

    if (nr_seq_regra_w = 0) then
        begin

            $if $$tasy_local_dict=true $then
            nr_seq_regra_w := get_remote_sequence('seq:obj_schem_order_seq');
            $else
            select nextval('obj_schem_order_seq') into STRICT nr_seq_regra_w;
            $end

            insert into obj_schem_order(nr_sequencia,
                 dt_atualizacao,
                 nm_usuario,
                 dt_atualizacao_nrec,
                 nm_usuario_nrec,
                 nr_seq_obj_schematic,
                 nr_seq_obj_padrao,
                 ds_regra)
            values (nr_seq_regra_w,
                 clock_timestamp(),
                 nm_usuario_p,
                 clock_timestamp(),
                 nm_usuario_p,
                 nr_seq_obj_schem_p,
                 nr_seq_obj_padrao_p,
                 ds_regra_p);

            CALL html_param_converter_log('OBJ_SCHEM_ORDER',
                                     nr_seq_regra_w,
                                     null,
                                     null,
                                     null,
                                     cd_funcao_p,
                                     nr_seq_parametro_p,
                                     vl_param_origem_p,
                                     nr_seq_lote_p,
                                     nm_usuario_p);

        end;
    end if;

    if (nr_seq_regra_w > 0) and (coalesce(cd_estab_param_p, 0) > 0) then
        begin

            $if $$tasy_local_dict=true $then
            nr_sequencia_w := get_remote_sequence('seq:obj_schem_order_estab_seq');
            $else
            select nextval('obj_schem_order_estab_seq') into STRICT nr_sequencia_w;
            $end

            insert into obj_schem_order_estab(nr_sequencia,
                 dt_atualizacao,
                 nm_usuario,
                 dt_atualizacao_nrec,
                 nm_usuario_nrec,
                 nr_seq_regra,
                 cd_estabelecimento)
            values (nr_sequencia_w, clock_timestamp(), nm_usuario_p, clock_timestamp(), nm_usuario_p, nr_seq_regra_w, cd_estab_param_p);

            CALL html_param_converter_log('OBJ_SCHEM_ORDER_ESTAB',
                                     nr_sequencia_w,
                                     cd_estab_param_p,
                                     null,
                                     null,
                                     cd_funcao_p,
                                     nr_seq_parametro_p,
                                     vl_param_origem_p,
                                     nr_seq_lote_p,
                                     nm_usuario_p);

        end;
    end if;

    if (nr_seq_regra_w > 0) and (coalesce(cd_perfil_param_p, 0) > 0) then
        begin

            $if $$tasy_local_dict=true $then
            nr_sequencia_w := get_remote_sequence('seq:obj_schem_order_perfil_seq');
            $else
            select nextval('obj_schem_order_perfil_seq') into STRICT nr_sequencia_w;
            $end

            insert into obj_schem_order_perfil(nr_sequencia, dt_atualizacao, nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec, nr_seq_regra, cd_perfil)
            values (nr_sequencia_w, clock_timestamp(), nm_usuario_p, clock_timestamp(), nm_usuario_p, nr_seq_regra_w, cd_perfil_param_p);

            CALL html_param_converter_log('OBJ_SCHEM_ORDER_PERFIL',
                                     nr_sequencia_w,
                                     null,
                                     cd_perfil_param_p,
                                     null,
                                     cd_funcao_p,
                                     nr_seq_parametro_p,
                                     vl_param_origem_p,
                                     nr_seq_lote_p,
                                     nm_usuario_p);

        end;
    end if;

    if (nr_seq_regra_w > 0) and (nm_usuario_param_p IS NOT NULL AND nm_usuario_param_p::text <> '') then
        begin

            $if $$tasy_local_dict=true $then
            nr_sequencia_w := get_remote_sequence('seq:obj_schem_order_usuario_seq');
            $else
            select nextval('obj_schem_order_usuario_seq') into STRICT nr_sequencia_w;
            $end

            insert into obj_schem_order_usuario(nr_sequencia,
                 dt_atualizacao,
                 nm_usuario,
                 dt_atualizacao_nrec,
                 nm_usuario_nrec,
                 nr_seq_regra,
                 nm_usuario_regra)
            values (nr_sequencia_w, clock_timestamp(), nm_usuario_p, clock_timestamp(), nm_usuario_p, nr_seq_regra_w, nm_usuario_param_p);

            CALL html_param_converter_log('OBJ_SCHEM_ORDER_USUARIO',
                                     nr_sequencia_w,
                                     null,
                                     null,
                                     nm_usuario_param_p,
                                     cd_funcao_p,
                                     nr_seq_parametro_p,
                                     vl_param_origem_p,
                                     nr_seq_lote_p,
                                     nm_usuario_p);

        end;
    end if;

    nr_seq_regra_p := nr_seq_regra_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_rule_schem_order (nr_seq_lote_p bigint, cd_funcao_p bigint, nr_seq_parametro_p bigint, vl_param_origem_p text, cd_estab_param_p bigint, cd_perfil_param_p bigint, nm_usuario_param_p text, nr_seq_obj_schem_p bigint, nr_seq_obj_padrao_p bigint, ds_regra_p text, nm_usuario_p text, nr_seq_regra_p INOUT bigint) FROM PUBLIC;

