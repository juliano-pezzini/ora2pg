-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_code_review_data ( nr_pr_p bigint, ds_author_p text, ds_reviewer_p text, ds_repo_p text, qt_linhas_add_p bigint default 0, qt_linhas_del_p bigint default 0, qt_comentarios_p bigint DEFAULT NULL, ds_branch_destino_p text DEFAULT NULL, ds_branch_origem_p text DEFAULT NULL, dt_code_review_p timestamp default clock_timestamp()) AS $body$
DECLARE


nr_sequencia_w		bigint;	
				

BEGIN


begin

select 	nr_sequencia
into STRICT	nr_sequencia_w
from	COE_CODE_REVIEW_DATA
where	nr_pr = nr_pr_p
and 	ds_repo = ds_repo_p;

EXCEPTION
   WHEN no_data_found THEN
   begin
      NR_SEQUENCIA_W := null;
   end;
end;

if (nr_sequencia_w IS NOT NULL AND nr_sequencia_w::text <> '') then

	update 	coe_code_review_data
	set 	DS_PR_AUTHOR = ds_author_p,
			DS_REVIEWER = ds_reviewer_p,
			QT_LINHAS_ADD = qt_linhas_add_p,
			QT_LINHAS_DEL = qt_linhas_del_p,
			qt_comentarios = qt_comentarios_p
	where	NR_SEQUENCIA = NR_SEQUENCIA_W;

else

	insert into COE_CODE_REVIEW_DATA(NR_SEQUENCIA,
			NR_PR,
			DS_PR_AUTHOR,
			DS_REVIEWER,
			DS_REPO,
			QT_LINHAS_ADD,
			QT_LINHAS_DEL,  
			QT_COMENTARIOS,
			DS_BRANCH_ORIGEM,
			DS_BRANCH_DESTINO,			
    		NM_USUARIO,
    		NM_USUARIO_NREC,
    		DT_ATUALIZACAO,
    		DT_ATUALIZACAO_NREC)
	values (nextval('coe_code_review_data_seq'),
			nr_pr_p,
			ds_author_p,
			ds_reviewer_p,
			ds_repo_p,
			qt_linhas_add_p,
			qt_linhas_del_p,
			qt_comentarios_p,
			ds_branch_origem_p,
			ds_branch_destino_p,
 			ds_author_p,
    		ds_author_p,
    		dt_code_review_p,
    		clock_timestamp());

end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_code_review_data ( nr_pr_p bigint, ds_author_p text, ds_reviewer_p text, ds_repo_p text, qt_linhas_add_p bigint default 0, qt_linhas_del_p bigint default 0, qt_comentarios_p bigint DEFAULT NULL, ds_branch_destino_p text DEFAULT NULL, ds_branch_origem_p text DEFAULT NULL, dt_code_review_p timestamp default clock_timestamp()) FROM PUBLIC;

