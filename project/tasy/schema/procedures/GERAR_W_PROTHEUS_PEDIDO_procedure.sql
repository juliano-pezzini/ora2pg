-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_w_protheus_pedido ( nr_pedido_p text, dt_emissao_p text, cd_fornecedor_p text, cd_cnpj_p text, cd_filial_p text, tp_frete_p text, ds_contato_p text, ds_observacao_p text, nm_usuario_p text, ie_operacao_p text, nr_seq_pedido_p INOUT text, cd_empresa_p text, cd_estabelecimento_p text) AS $body$
DECLARE


nr_seq_pedido_w		bigint;
ds_erro_w		varchar(4000);


BEGIN

delete from log_protheus
where ds_entidade = 'OC';

select	nextval('w_protheus_pedido_seq')
into STRICT	nr_seq_pedido_w
;

begin
insert into w_protheus_pedido(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_pedido,
		dt_emissao,
		cd_fornecedor,
		cd_cnpj,
		cd_filial,
		tp_frete,
		ds_contato,
		ds_observacao,
		ie_operacao,
		cd_empresa,
		 cd_estabelecimento)
values (	nr_seq_pedido_w,
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	nr_pedido_p,
	to_date(dt_emissao_p,'dd/mm/yyyy'),
	cd_fornecedor_p,
	cd_cnpj_p,
	cd_filial_p,
	tp_frete_p,
	ds_contato_p,
	ds_observacao_p,
	ie_operacao_p,
	cd_empresa_p,
	cd_estabelecimento_p);

exception
when others then
	ds_erro_w	:= substr(sqlerrm,1,4000);
	CALL gravar_log_protheus('ERRO', 'OC', substr(wheb_mensagem_pck.get_texto(311540) || ds_erro_w,1,4000), nm_usuario_p);
end;


nr_seq_pedido_p := nr_seq_pedido_w;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_w_protheus_pedido ( nr_pedido_p text, dt_emissao_p text, cd_fornecedor_p text, cd_cnpj_p text, cd_filial_p text, tp_frete_p text, ds_contato_p text, ds_observacao_p text, nm_usuario_p text, ie_operacao_p text, nr_seq_pedido_p INOUT text, cd_empresa_p text, cd_estabelecimento_p text) FROM PUBLIC;

