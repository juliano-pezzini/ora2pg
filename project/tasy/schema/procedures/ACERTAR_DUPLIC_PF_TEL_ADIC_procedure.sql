-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE acertar_duplic_pf_tel_adic ( cd_pessoa_origem_p text, cd_pessoa_destino_p text) AS $body$
DECLARE


nr_seq_compl_dest_w		bigint;
ie_tipo_compl_orig_w	smallint;
qt_destino_w			bigint;

c01 CURSOR FOR
	SELECT	*
	from 	compl_pf_tel_adic
	where 	cd_pessoa_fisica 	= cd_pessoa_origem_p;

c01_w	c01%rowtype;


BEGIN

open c01;
loop
fetch c01 into
	c01_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin

	select	coalesce(max(ie_tipo_complemento),0)
	into STRICT	ie_tipo_compl_orig_w
	from	compl_pessoa_fisica
	where	nr_sequencia = c01_w.nr_seq_compl
	and		cd_pessoa_fisica = cd_pessoa_origem_p;

	if (ie_tipo_compl_orig_w > 0) then

		select	coalesce(max(nr_sequencia),0)
		into STRICT	nr_seq_compl_dest_w
		from	compl_pessoa_fisica
		where	ie_tipo_complemento = ie_tipo_compl_orig_w
		and		cd_pessoa_fisica	= cd_pessoa_destino_p;

		if (nr_seq_compl_dest_w > 0) then

			update	COMPL_PF_TEL_ADIC
			set		nr_seq_compl     = nr_seq_compl_dest_w,
					cd_pessoa_fisica = cd_pessoa_destino_p
			where	nr_sequencia =  c01_w.nr_sequencia;

		end if;
	else
			update	compl_pf_tel_adic
			set		nr_seq_compl      = NULL,
					cd_pessoa_fisica  = NULL
			where	nr_sequencia =  c01_w.nr_sequencia;

	end if;

	end;
end loop;
close C01;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE acertar_duplic_pf_tel_adic ( cd_pessoa_origem_p text, cd_pessoa_destino_p text) FROM PUBLIC;

