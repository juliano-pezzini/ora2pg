-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE regra_aloc_custo_setor_carga ( nm_usuario_p regra_aloc_custo_setor.nm_usuario%type, dt_atualizacao_p regra_aloc_custo_setor.dt_atualizacao%type, cd_estabelecimento_p regra_aloc_custo_setor.cd_estabelecimento%type, cd_setor_atendimento_p regra_aloc_custo_setor.cd_setor_atendimento%type, ie_calculo_custo_p regra_aloc_custo_setor.ie_calculo_custo%type, pr_aplicar_p regra_aloc_custo_setor.pr_aplicar%type, vl_custo_p regra_aloc_custo_setor.vl_custo%type, pr_custo_oper_p regra_aloc_custo_setor.pr_custo_oper%type, pr_medico_p regra_aloc_custo_setor.pr_medico%type, pr_material_p regra_aloc_custo_setor.pr_material%type, cd_area_procedimento_p regra_aloc_custo_setor.cd_area_procedimento%type, cd_especialidade_p regra_aloc_custo_setor.cd_especialidade%type, cd_grupo_proc_p regra_aloc_custo_setor.cd_grupo_proc%type, cd_procedimento_p regra_aloc_custo_setor.cd_procedimento%type, cd_convenio_p regra_aloc_custo_setor.cd_convenio%type, cd_proc_custo_p regra_aloc_custo_setor.cd_proc_custo%type, cd_grupo_material_p regra_aloc_custo_setor.cd_grupo_material%type, cd_subgrupo_material_p regra_aloc_custo_setor.cd_subgrupo_material%type, cd_classe_material_p regra_aloc_custo_setor.cd_classe_material%type, cd_material_p regra_aloc_custo_setor.cd_material%type, ds_criterio_aloc_mat_p regra_aloc_custo_setor.ds_criterio_aloc_mat%type, ie_custo_hm_p regra_aloc_custo_setor.ie_custo_hm%type, nr_seq_exame_p regra_aloc_custo_setor.nr_seq_exame%type, cd_edicao_amb_p regra_aloc_custo_setor.cd_edicao_amb%type, ie_tipo_atendimento_p regra_aloc_custo_setor.ie_tipo_atendimento%type, nr_seq_proc_interno_p regra_aloc_custo_setor.nr_seq_proc_interno%type, dt_inicio_vigencia_p regra_aloc_custo_setor.dt_inicio_vigencia%type, dt_fim_vigencia_p regra_aloc_custo_setor.dt_fim_vigencia%type, ds_observacao_p regra_aloc_custo_setor.ds_observacao%type, ie_responsavel_credito_p regra_aloc_custo_setor.ie_responsavel_credito%type, ie_sobrepor_custo_consig_p regra_aloc_custo_setor.ie_sobrepor_custo_consig%type ) AS $body$
DECLARE

    cd_area_procedimento_w      regra_aloc_custo_setor.cd_area_procedimento%type;
    cd_especialidade_w          regra_aloc_custo_setor.cd_especialidade%type;
    cd_grupo_proc_w             regra_aloc_custo_setor.cd_grupo_proc%type;
    cd_procedimento_w           regra_aloc_custo_setor.cd_procedimento%type;
    cd_convenio_w               regra_aloc_custo_setor.cd_convenio%type;
    cd_proc_custo_w             regra_aloc_custo_setor.cd_proc_custo%type;
    cd_grupo_material_w			regra_aloc_custo_setor.cd_grupo_material%type;
    cd_subgrupo_material_w      regra_aloc_custo_setor.cd_subgrupo_material%type;
    cd_classe_material_w        regra_aloc_custo_setor.cd_classe_material%type;
    cd_material_w               regra_aloc_custo_setor.cd_material%type;
    nr_seq_exame_w              regra_aloc_custo_setor.nr_seq_exame%type;
    cd_edicao_amb_w             regra_aloc_custo_setor.cd_edicao_amb%type;
    nr_seq_proc_interno_w       regra_aloc_custo_setor.nr_seq_proc_interno%type;
    ie_origem_proced_w          regra_aloc_custo_setor.ie_origem_proced%type;
    ie_origem_proc_custo_w      regra_aloc_custo_setor.ie_origem_proc_custo%type;

BEGIN
    cd_area_procedimento_w  := NULLIF(cd_area_procedimento_p,0);
    cd_especialidade_w      := NULLIF(cd_especialidade_p,0);
    cd_grupo_proc_w         := NULLIF(cd_grupo_proc_p,0);
    cd_procedimento_w       := NULLIF(cd_procedimento_p,0);
    cd_convenio_w           := NULLIF(cd_convenio_p,0);
    cd_proc_custo_w         := NULLIF(cd_proc_custo_p,0);
    cd_grupo_material_w     := NULLIF(cd_grupo_material_p,0);
    cd_subgrupo_material_w  := NULLIF(cd_subgrupo_material_p,0);
    cd_classe_material_w    := NULLIF(cd_classe_material_p,0);
    cd_material_w           := NULLIF(cd_material_p,0);
    nr_seq_exame_w          := NULLIF(nr_seq_exame_p,0);
    cd_edicao_amb_w         := NULLIF(cd_edicao_amb_p,0);
    nr_seq_proc_interno_w   := NULLIF(nr_seq_proc_interno_p,0);

    if (cd_procedimento_w IS NOT NULL AND cd_procedimento_w::text <> '') then
        select max(ie_origem_proced)
        into STRICT ie_origem_proced_w
        from procedimento
        where cd_procedimento = cd_procedimento_w;
    end if;
    
    if (cd_proc_custo_w IS NOT NULL AND cd_proc_custo_w::text <> '') then
        select max(ie_origem_proced)
        into STRICT ie_origem_proc_custo_w
        from procedimento
        where cd_procedimento = cd_proc_custo_w;
    end if;

	INSERT INTO regra_aloc_custo_setor(
		nr_sequencia,	
		nm_usuario,
		dt_atualizacao,
		cd_estabelecimento,
		cd_setor_atendimento,
		ie_calculo_custo,
		pr_aplicar,
		vl_custo,
		pr_custo_oper,
		pr_medico,
		pr_material,
		cd_area_procedimento,
		cd_especialidade,
		cd_grupo_proc,
		cd_procedimento,
        ie_origem_proced,
		cd_convenio,
		cd_proc_custo,
        ie_origem_proc_custo,
		cd_grupo_material, 
		cd_subgrupo_material,
		cd_classe_material,
		cd_material,
		ds_criterio_aloc_mat,
		ie_custo_hm,
		nr_seq_exame,
		cd_edicao_amb,
		ie_tipo_atendimento,
		nr_seq_proc_interno,
		dt_inicio_vigencia,
		dt_fim_vigencia,
		ds_observacao,
		ie_responsavel_credito,
		ie_sobrepor_custo_consig
	) VALUES (
		nextval('regra_aloc_custo_setor_seq'),
		nm_usuario_p,		
		dt_atualizacao_p, 	
		cd_estabelecimento_p,
		cd_setor_atendimento_p,
		ie_calculo_custo_p,
		pr_aplicar_p,
		vl_custo_p,
		pr_custo_oper_p,
		pr_medico_p,
		pr_material_p,
		cd_area_procedimento_w,
		cd_especialidade_w,
		cd_grupo_proc_w,
		cd_procedimento_w,
        ie_origem_proced_w,        
		cd_convenio_w,
		cd_proc_custo_w,
        ie_origem_proc_custo_w,
		cd_grupo_material_w, 
		cd_subgrupo_material_w,
		cd_classe_material_w,
		cd_material_w,
		ds_criterio_aloc_mat_p,
		ie_custo_hm_p,
		nr_seq_exame_w,
		cd_edicao_amb_w,
		ie_tipo_atendimento_p,
		nr_seq_proc_interno_w,
		dt_inicio_vigencia_p,
		dt_fim_vigencia_p,
		ds_observacao_p,
		ie_responsavel_credito_p,
		ie_sobrepor_custo_consig_p	
	);

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE regra_aloc_custo_setor_carga ( nm_usuario_p regra_aloc_custo_setor.nm_usuario%type, dt_atualizacao_p regra_aloc_custo_setor.dt_atualizacao%type, cd_estabelecimento_p regra_aloc_custo_setor.cd_estabelecimento%type, cd_setor_atendimento_p regra_aloc_custo_setor.cd_setor_atendimento%type, ie_calculo_custo_p regra_aloc_custo_setor.ie_calculo_custo%type, pr_aplicar_p regra_aloc_custo_setor.pr_aplicar%type, vl_custo_p regra_aloc_custo_setor.vl_custo%type, pr_custo_oper_p regra_aloc_custo_setor.pr_custo_oper%type, pr_medico_p regra_aloc_custo_setor.pr_medico%type, pr_material_p regra_aloc_custo_setor.pr_material%type, cd_area_procedimento_p regra_aloc_custo_setor.cd_area_procedimento%type, cd_especialidade_p regra_aloc_custo_setor.cd_especialidade%type, cd_grupo_proc_p regra_aloc_custo_setor.cd_grupo_proc%type, cd_procedimento_p regra_aloc_custo_setor.cd_procedimento%type, cd_convenio_p regra_aloc_custo_setor.cd_convenio%type, cd_proc_custo_p regra_aloc_custo_setor.cd_proc_custo%type, cd_grupo_material_p regra_aloc_custo_setor.cd_grupo_material%type, cd_subgrupo_material_p regra_aloc_custo_setor.cd_subgrupo_material%type, cd_classe_material_p regra_aloc_custo_setor.cd_classe_material%type, cd_material_p regra_aloc_custo_setor.cd_material%type, ds_criterio_aloc_mat_p regra_aloc_custo_setor.ds_criterio_aloc_mat%type, ie_custo_hm_p regra_aloc_custo_setor.ie_custo_hm%type, nr_seq_exame_p regra_aloc_custo_setor.nr_seq_exame%type, cd_edicao_amb_p regra_aloc_custo_setor.cd_edicao_amb%type, ie_tipo_atendimento_p regra_aloc_custo_setor.ie_tipo_atendimento%type, nr_seq_proc_interno_p regra_aloc_custo_setor.nr_seq_proc_interno%type, dt_inicio_vigencia_p regra_aloc_custo_setor.dt_inicio_vigencia%type, dt_fim_vigencia_p regra_aloc_custo_setor.dt_fim_vigencia%type, ds_observacao_p regra_aloc_custo_setor.ds_observacao%type, ie_responsavel_credito_p regra_aloc_custo_setor.ie_responsavel_credito%type, ie_sobrepor_custo_consig_p regra_aloc_custo_setor.ie_sobrepor_custo_consig%type ) FROM PUBLIC;

