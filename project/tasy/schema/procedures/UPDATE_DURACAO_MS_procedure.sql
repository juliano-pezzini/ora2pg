-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE update_duracao_ms (nr_seq_agenda_p agenda_paciente.nr_sequencia%type, cd_agenda_p agenda.cd_agenda%type, nr_minuto_duracao_p agenda_paciente.nr_minuto_duracao%type) AS $body$
DECLARE

					
cd_tipo_agenda_w	agenda.cd_tipo_agenda%type;


BEGIN
	if (nr_seq_agenda_p IS NOT NULL AND nr_seq_agenda_p::text <> '') and (cd_agenda_p IS NOT NULL AND cd_agenda_p::text <> '') and (nr_minuto_duracao_p IS NOT NULL AND nr_minuto_duracao_p::text <> '') then
	
	    select max(cd_tipo_agenda)
	    into STRICT	  cd_tipo_agenda_w
	    from	  agenda
	    where     cd_agenda = cd_agenda_p;
	
	    if (cd_tipo_agenda_w in (2,5)) then
		
			update  agenda_paciente
			set		nr_minuto_duracao = nr_minuto_duracao_p
			where   nr_sequencia = nr_seq_agenda_p;
			
	    elsif (cd_tipo_agenda_w = 3) then
		
			update  agenda_consulta
			set		nr_minuto_duracao = nr_minuto_duracao_p
			where   nr_sequencia = nr_seq_agenda_p;
			
		end if;
		
		commit;
	end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE update_duracao_ms (nr_seq_agenda_p agenda_paciente.nr_sequencia%type, cd_agenda_p agenda.cd_agenda%type, nr_minuto_duracao_p agenda_paciente.nr_minuto_duracao%type) FROM PUBLIC;

