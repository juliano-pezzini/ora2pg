-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_info_cpoe_overview_item ( NR_SEQ_ITEM_CPOE_P bigint , IE_TIPO_ITEM_P text, NR_SEQ_CPOE_ORDER_UNIT_P INOUT bigint , NR_SEQ_CPOE_RP_P INOUT bigint ) AS $body$
DECLARE

    TABLE_W                     varchar(30);

BEGIN
    IF (IE_TIPO_ITEM_P IN ('D', 'SNE', 'S', 'J', 'LD', 'NPTA', 'NPTI')) THEN
        TABLE_W := 'CPOE_DIETA';
    ELSIF (IE_TIPO_ITEM_P = 'P') THEN
        TABLE_W := 'CPOE_PROCEDIMENTO';
    ELSIF (IE_TIPO_ITEM_P IN ('MR', 'MAT')) THEN
        TABLE_W := 'CPOE_MATERIAL';
    ELSIF (IE_TIPO_ITEM_P IN ('M', 'SOL')) THEN
        SELECT
            MAX(RP.NR_SEQ_CPOE_ORDER_UNIT),
            MAX(RP.NR_SEQUENCIA)
        INTO STRICT
            NR_SEQ_CPOE_ORDER_UNIT_P,
            NR_SEQ_CPOE_RP_P
		FROM
            CPOE_MATERIAL MAT INNER JOIN CPOE_RP RP ON (
                RP.NR_SEQUENCIA = MAT.NR_SEQ_CPOE_RP
            )
        WHERE
            MAT.NR_SEQUENCIA = NR_SEQ_ITEM_CPOE_P;
		
    ELSIF (IE_TIPO_ITEM_P IN ('O', 'G')) THEN
        TABLE_W := 'CPOE_GASOTERAPIA';
    ELSIF (IE_TIPO_ITEM_P = 'R') THEN
        TABLE_W := 'CPOE_RECOMENDACAO';
    ELSIF (IE_TIPO_ITEM_P = 'HM') THEN
        TABLE_W := 'CPOE_HEMOTERAPIA';
    ELSIF (IE_TIPO_ITEM_P = 'DI') THEN
        TABLE_W := 'CPOE_DIALISE';
    ELSIF (IE_TIPO_ITEM_P = 'AP') THEN
        TABLE_W := 'CPOE_ANATOMIA_PATOLOGICA';
    END IF;

    IF (NOT coalesce(TABLE_W::text, '') = '') THEN
        EXECUTE '
            SELECT
                MAX(NR_SEQ_CPOE_ORDER_UNIT)
            FROM
                ' || TABLE_W || '
            WHERE
                NR_SEQUENCIA = ' || TO_CHAR(NR_SEQ_ITEM_CPOE_P)
        INTO STRICT
            NR_SEQ_CPOE_ORDER_UNIT_P;
    END IF;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_info_cpoe_overview_item ( NR_SEQ_ITEM_CPOE_P bigint , IE_TIPO_ITEM_P text, NR_SEQ_CPOE_ORDER_UNIT_P INOUT bigint , NR_SEQ_CPOE_RP_P INOUT bigint ) FROM PUBLIC;

