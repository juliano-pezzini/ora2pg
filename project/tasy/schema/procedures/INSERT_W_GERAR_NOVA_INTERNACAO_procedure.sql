-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_w_gerar_nova_internacao (nr_atendimento_p bigint, ie_tipo_justificativa_p bigint, cd_profissional_p bigint, ds_justificativa_p text, nm_usuario_p text) AS $body$
DECLARE


cd_pessoa_fisica_w    pessoa_fisica.cd_pessoa_fisica%type;


BEGIN
if (nr_atendimento_p IS NOT NULL AND nr_atendimento_p::text <> '') and (ie_tipo_justificativa_p IS NOT NULL AND ie_tipo_justificativa_p::text <> '') and (cd_profissional_p IS NOT NULL AND cd_profissional_p::text <> '') then
    begin
    
    select    max(cd_pessoa_fisica)
    into STRICT    cd_pessoa_fisica_w
    from    atendimento_paciente
    where    nr_Atendimento = nr_atendimento_p;

    
    insert    into paciente_justificativa(nr_sequencia,
        dt_atualizacao,
        nm_usuario,
        dt_atualizacao_nrec,
        nm_usuario_nrec,
        nr_atendimento,
        cd_pessoa_fisica,
        ie_tipo_justificativa,
        cd_profissional,
        dt_justificativa,
        ds_justificativa,
        ie_situacao)
    values (nextval('paciente_justificativa_seq'),
        clock_timestamp(),
        nm_usuario_p,
        clock_timestamp(),
        nm_usuario_p,
        nr_atendimento_p,
        cd_pessoa_fisica_w,
        ie_tipo_justificativa_p,
        cd_profissional_p,
        clock_timestamp(),
        ds_justificativa_p,
        'A');
    end;
end if;
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_w_gerar_nova_internacao (nr_atendimento_p bigint, ie_tipo_justificativa_p bigint, cd_profissional_p bigint, ds_justificativa_p text, nm_usuario_p text) FROM PUBLIC;

