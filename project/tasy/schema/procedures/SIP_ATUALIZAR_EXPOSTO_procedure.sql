-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE sip_atualizar_exposto ( nm_usuario_p text) AS $body$
DECLARE


/*

ESTA PROCEDURE ESTÁ DEPRECIADA A SUA UTILIZAÇÃO FOI SUBISTITUÍDA PELA PROCEDURE DA PCK DO SIP: pls_sip_pck.pls_atualizar_exposto_sip(nr_seq_lote_sip_p, nm_usuario_p);

*/
nr_seq_segurado_w		bigint;

C01 CURSOR FOR
	SELECT	a.nr_sequencia
	from	pls_segurado	a,
		pls_contrato	b
	where	b.nr_sequencia		= a.nr_seq_contrato
	and	CASE WHEN a.ie_tipo_segurado='B' THEN 0 WHEN a.ie_tipo_segurado='R' THEN 1  ELSE 999 END 	in (0,1)
	and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '');

TYPE 		fetch_array1 IS TABLE OF C01%ROWTYPE;
s_array1	fetch_array1;
i1		integer := 1;
type Vetor1 is table of fetch_array1 index by integer;
Vetor_C01_w			Vetor1;
BEGIN
open C01;
loop
FETCH C01 BULK COLLECT INTO s_array1 LIMIT 1000;
	Vetor_C01_w(i1) := s_array1;
	i1 := i1 + 1;
EXIT WHEN NOT FOUND; /* apply on C01 */
END LOOP;
CLOSE C01;

for j in 1..Vetor_C01_w.COUNT loop
	s_array1 := Vetor_C01_w(j);
	for k in 1..s_array1.COUNT loop
		begin
		nr_seq_segurado_w	:= s_array1[k].nr_sequencia;

		CALL sip_gerar_beneficiario_exposto(nr_seq_segurado_w, nm_usuario_p);
		end;
	end loop;
end loop;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE sip_atualizar_exposto ( nm_usuario_p text) FROM PUBLIC;

