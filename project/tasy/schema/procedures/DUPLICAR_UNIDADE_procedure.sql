-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_unidade ( cd_setor_atendimento_p bigint, cd_unid_basica_ant_p text, cd_unid_compl_ant_p text, cd_unid_basica_nova_p text, cd_unid_compl_nova_p text, nm_usuario_p text) AS $body$
DECLARE


nr_seq_interno_w	bigint;
ie_possui_w		varchar(1);
nm_unidade_compl_w	varchar(20);

BEGIN
select	max(nm_unidade_compl)
into STRICT	nm_unidade_compl_w
from	setor_Atendimento
where	cd_setor_atendimento	= cd_setor_Atendimento_p;

if (coalesce(cd_setor_atendimento_p,0) > 0) and (cd_unid_basica_ant_p IS NOT NULL AND cd_unid_basica_ant_p::text <> '')  and ((cd_unid_compl_ant_p IS NOT NULL AND cd_unid_compl_ant_p::text <> '') or (coalesce(nm_unidade_compl_w::text, '') = '')) and (cd_unid_basica_nova_p IS NOT NULL AND cd_unid_basica_nova_p::text <> '') and ((cd_unid_compl_nova_p IS NOT NULL AND cd_unid_compl_nova_p::text <> '') or (coalesce(nm_unidade_compl_w::text, '') = '')) then

	select	nextval('unidade_atendimento_seq')
	into STRICT	nr_seq_interno_w
	;


	select	CASE WHEN count(*)=0 THEN 'N'  ELSE 'S' END
	into STRICT	ie_possui_w
	from	unidade_atendimento
	where	cd_unidade_basica 	= cd_unid_basica_nova_p
	and	cd_unidade_compl  	= CASE WHEN coalesce(nm_unidade_compl_w::text, '') = '' THEN  ' '  ELSE cd_unid_compl_nova_p END 
	and	cd_setor_atendimento	= cd_setor_atendimento_p;

	if (ie_possui_w = 'S') then
		CALL Wheb_mensagem_pck.exibir_mensagem_abort(220923);
	end if;

	if (coalesce(nr_seq_interno_w,0) > 0) then


		insert into unidade_atendimento(
							cd_setor_atendimento,
							cd_tipo_acomodacao,
							cd_unidade_basica,
							cd_unidade_compl,
							dt_atualizacao,
							dt_criacao,
							ie_situacao,
							ie_temporario,
							nm_usuario,
							cd_convenio_reserva,
							cd_motivo_interdicao,
							cd_motivo_manutencao,
							cd_paciente_reserva,
							ds_agrupamento,
							ds_observacao,
							ds_ocupacao,
							ds_unidade_atend,
							dt_entrada_unidade,
							dt_higienizacao,
							dt_inicio_higienizacao,
							dt_interdicao,
							ie_classe_acomodacao,
							ie_exibir_cc,
							ie_higienizacao,
							ie_inativa_setor_auto,
							ie_inativar_leito_temp,
							ie_interditado_radiacao,
							ie_leito_monitorado,
							ie_mostra_gestao_disp,
							ie_necessita_isol_reserva,
							ie_observacao_pa,
							ie_permite_alt_eup,
							ie_radioterapia,
							ie_sexo_fixo,
							ie_sexo_paciente,
							ie_status_ant_unidade,
							ie_status_unidade,
							ie_tipo_limpeza,
							ie_tipo_reserva,
							nm_setor_integracao,
							nm_usuario_fim_higienizacao,
							nm_usuario_higienizacao,
							nm_usuario_reserva,
							nr_agrupamento,
							nr_atendimento,
							nr_atendimento_acomp,
							nr_atendimento_ant,
							nr_ramal,
							nr_seq_apresent,
							nr_seq_classif,
							nr_seq_computador,
							nr_seq_computador_leito,
							nr_seq_interno,
							nr_seq_local_pa,
							nr_seq_mot_isol,
							nr_seq_motivo_reserva,
							nr_seq_superior,
							nr_seq_unidade_rn,
							qt_altura_maxima,
							qt_dias_prev_interd,
							qt_idade_dias_max,
							qt_idade_dias_min,
							qt_idade_maxima,
							qt_idade_minima,
							qt_max_acomp,
							qt_max_diario,
							qt_max_simultaneo,
							qt_max_visitante,
							qt_pac_unidade,
							qt_peso_maximo,
							qt_tempo_prev_higien
			)
			SELECT				cd_setor_atendimento,
							cd_tipo_acomodacao,
							cd_unid_basica_nova_p,
							CASE WHEN coalesce(nm_unidade_compl_w::text, '') = '' THEN  ' '  ELSE cd_unid_compl_nova_p END ,
							clock_timestamp(),
							clock_timestamp(),
							'A',
							ie_temporario,
							nm_usuario_p,
							null,
							null,
							null,
							null,
							ds_agrupamento,
							ds_observacao,
							ds_ocupacao,
							ds_unidade_atend,
							null,
							null,
							null,
							null,
							ie_classe_acomodacao,
							ie_exibir_cc,
							ie_higienizacao,
							ie_inativa_setor_auto,
							ie_inativar_leito_temp,
							ie_interditado_radiacao,
							ie_leito_monitorado,
							ie_mostra_gestao_disp,
							ie_necessita_isol_reserva,
							ie_observacao_pa,
							ie_permite_alt_eup,
							ie_radioterapia,
							ie_sexo_fixo,
							ie_sexo_paciente,
							ie_status_ant_unidade,
							'L',
							ie_tipo_limpeza,
							ie_tipo_reserva,
							nm_setor_integracao,
							null,
							null,
							null,
							nr_agrupamento,
							null,
							null,
							null,
							nr_ramal,
							nr_seq_apresent,
							nr_seq_classif,
							null,
							null,
							nr_seq_interno_w,
							null,
							null,
							null,
							null,
							null,
							qt_altura_maxima,
							qt_dias_prev_interd,
							qt_idade_dias_max,
							qt_idade_dias_min,
							qt_idade_maxima,
							qt_idade_minima,
							qt_max_acomp,
							qt_max_diario,
							qt_max_simultaneo,
							qt_max_visitante,
							qt_pac_unidade,
							qt_peso_maximo,
							qt_tempo_prev_higien
						from	unidade_atendimento
						where	cd_unidade_basica 	= cd_unid_basica_ant_p
						and	cd_unidade_compl  	= cd_unid_compl_ant_p
						and	cd_setor_atendimento	= cd_setor_atendimento_p;

	end if;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_unidade ( cd_setor_atendimento_p bigint, cd_unid_basica_ant_p text, cd_unid_compl_ant_p text, cd_unid_basica_nova_p text, cd_unid_compl_nova_p text, nm_usuario_p text) FROM PUBLIC;

