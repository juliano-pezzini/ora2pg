-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE revert_patient_arrival_process (appointments_json text) AS $body$
DECLARE

  nr_sequencia_temp_w    bigint;
  cd_tipo_agenda_temp_w  AGENDA.CD_TIPO_AGENDA%TYPE;
  nr_atendimento_w       ATENDIMENTO_PACIENTE.NR_ATENDIMENTO%TYPE;
  convenio_row_w         PESSOA_TITULAR_CONVENIO%ROWTYPE;
  agenda_consulta_row_w  AGENDA_CONSULTA%ROWTYPE;
  agenda_paciente_row_w  AGENDA_PACIENTE%ROWTYPE;
  qtd_appointments_w     bigint;
  l_appointments PHILIPS_JSON_LIST;
  appointment_w PHILIPS_JSON;

BEGIN

  l_appointments := PHILIPS_JSON_LIST(appointments_json);
  CALL wheb_usuario_pck.set_ie_commit('N');

  FOR i IN 1..l_appointments.COUNT LOOP
    appointment_w := PHILIPS_JSON(l_appointments.get(i));

-- REVERT PATIENT ARRIVAL
    CALL revert_arrival_for_appointment(
      appointment_w.GET['CD_AGENDA'].GET_NUMBER(),
      appointment_w.GET['NR_SEQUENCIA'].GET_NUMBER(),
      appointment_w.GET['NR_ATENDIMENTO'].GET_NUMBER(),
      appointment_w.GET['CD_PESSOA_FISICA'].GET_STRING()
    );
end LOOP;

  COMMIT;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE revert_patient_arrival_process (appointments_json text) FROM PUBLIC;

