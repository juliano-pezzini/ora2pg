-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE recep_alterar_ficha_prim_exame ( nr_seq_ficha_pre_p text, dt_primeiro_recep_p timestamp, ie_status_ficha_p bigint, nm_usuario_p text, nr_atendimento_p bigint, nr_prescricao_p bigint, nr_seq_prescr_proc_p bigint, nr_seq_agenda_p bigint, nr_seq_proc_interno_p bigint) AS $body$
DECLARE

 
dt_primeiro_recep_w timestamp;
ie_status_w	smallint;
			

BEGIN 
 
select	max(dt_primeiro_recep) 
into STRICT	dt_primeiro_recep_w 
from	recep_ficha_pre 
where 	nr_sequencia = nr_seq_ficha_pre_p;
 
if (coalesce(dt_primeiro_recep_w::text, '') = '') then 
 
	update	recep_ficha_pre 
	set		dt_primeiro_recep = dt_primeiro_recep_p, 
			ie_status = ie_status_ficha_p 
	where	nr_sequencia = nr_seq_ficha_pre_p;
	 
end if;
 
 
CALL gerar_autor_regra(nr_atendimento_p, NULL, NULL, nr_prescricao_p, NULL, nr_seq_prescr_proc_p, 'LP', nm_usuario_p, nr_seq_agenda_p, nr_seq_proc_interno_p, 
	NULL, NULL, NULL, '', '', '');
 
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE recep_alterar_ficha_prim_exame ( nr_seq_ficha_pre_p text, dt_primeiro_recep_p timestamp, ie_status_ficha_p bigint, nm_usuario_p text, nr_atendimento_p bigint, nr_prescricao_p bigint, nr_seq_prescr_proc_p bigint, nr_seq_agenda_p bigint, nr_seq_proc_interno_p bigint) FROM PUBLIC;

