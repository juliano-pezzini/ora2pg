-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_qt_medic_diluido_md ( qt_conc_medic_aux_p bigint, ie_proporcao_p text, ie_cons_dose_medic_p text, qt_dose_diluicao_p bigint, qt_conv_ml_p bigint, qt_conc_medic_aux2_p bigint, qt_diluicao_aux_p bigint, qt_referencia_p bigint, qt_unitaria_medic_p bigint, qt_dose_aux_p bigint, qt_diluicao_p INOUT bigint, qt_conc_medic_p INOUT bigint, qt_medic_diluido_p INOUT bigint, ie_dilui_vol_medic_p INOUT text, qt_volume_medic_p INOUT bigint, qt_minuto_aplicacao_p INOUT bigint ) AS $body$
BEGIN
    IF ( ie_proporcao_p = 'F' )
        AND ( ie_cons_dose_medic_p = 'S' )
    THEN
        qt_conc_medic_p := qt_conc_medic_aux_p;
        ie_dilui_vol_medic_p := 'S';
        qt_medic_diluido_p := coalesce(qt_dose_diluicao_p,0) + coalesce(qt_conv_ml_p,0);
        qt_volume_medic_p := qt_conv_ml_p;
    ELSIF ( ie_proporcao_p = 'F' )
        AND ( ie_cons_dose_medic_p = 'N' )
        AND ( coalesce(qt_volume_medic_p, 0) > 0 )
    THEN
        qt_diluicao_p := qt_diluicao_aux_p;
        qt_conc_medic_p := qt_conc_medic_aux2_p;
        ie_dilui_vol_medic_p := 'S';
        qt_medic_diluido_p := coalesce(qt_volume_medic_p,0) + coalesce(qt_dose_diluicao_p,0);
    ELSIF ( coalesce(qt_referencia_p, 0) > 0 ) THEN
        IF ( ie_proporcao_p = 'SC' ) THEN
            IF ( ie_cons_dose_medic_p = 'S' ) THEN
                qt_diluicao_p := ceil(qt_unitaria_medic_p) * qt_referencia_p;
            ELSE
                qt_diluicao_p := coalesce(qt_unitaria_medic_p,0) * coalesce(qt_referencia_p,0);
            END IF;

        ELSIF ( ie_proporcao_p = 'ST' ) THEN
            IF ( ie_cons_dose_medic_p = 'S' ) THEN
                qt_diluicao_p := ceil(qt_unitaria_medic_p) * qt_referencia_p;
            ELSE
                qt_diluicao_p := qt_unitaria_medic_p * qt_referencia_p;
            END IF;

            qt_minuto_aplicacao_p := trunc(qt_minuto_aplicacao_p * qt_dose_aux_p);
        END IF;
    END IF;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_qt_medic_diluido_md ( qt_conc_medic_aux_p bigint, ie_proporcao_p text, ie_cons_dose_medic_p text, qt_dose_diluicao_p bigint, qt_conv_ml_p bigint, qt_conc_medic_aux2_p bigint, qt_diluicao_aux_p bigint, qt_referencia_p bigint, qt_unitaria_medic_p bigint, qt_dose_aux_p bigint, qt_diluicao_p INOUT bigint, qt_conc_medic_p INOUT bigint, qt_medic_diluido_p INOUT bigint, ie_dilui_vol_medic_p INOUT text, qt_volume_medic_p INOUT bigint, qt_minuto_aplicacao_p INOUT bigint ) FROM PUBLIC;

