-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_obter_dados_regra_auditor ( nr_seq_auditoria_p bigint, ie_tipo_item_p text, nr_seq_item_p bigint, ie_tipo_despesa_p bigint, ie_permite_aparecer_itens_p text, ie_auditar_sem_usu_exec_p text, ie_status_solicitacao_p text, nm_usuario_p text, ie_auditor_grupo_p INOUT text, ie_auditor_regra_despesa_p INOUT text, ie_auditor_grupo_item_p INOUT text, ie_grupo_assumido_p INOUT text) AS $body$
DECLARE


ie_auditor_grupo_w		varchar(4);
ie_auditor_regra_despesa_w	varchar(1);
ie_auditor_grupo_item_w	varchar(1);
ie_grupo_assumido_w	varchar(1);


BEGIN
if (nr_seq_auditoria_p IS NOT NULL AND nr_seq_auditoria_p::text <> '') and (ie_permite_aparecer_itens_p IS NOT NULL AND ie_permite_aparecer_itens_p::text <> '') and (ie_auditar_sem_usu_exec_p IS NOT NULL AND ie_auditar_sem_usu_exec_p::text <> '') and (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') then
	begin

	select	coalesce(pls_obter_liberacao_auditor(nr_seq_auditoria_p,nm_usuario_p), 'N')
	into STRICT	ie_auditor_grupo_w
	;

	select	coalesce(pls_obter_regra_despesa_aud(nr_seq_auditoria_p,ie_tipo_item_p,ie_tipo_despesa_p),'N')
	into STRICT	ie_auditor_regra_despesa_w
	;

	if (ie_permite_aparecer_itens_p = 'S') and (nr_seq_item_p IS NOT NULL AND nr_seq_item_p::text <> '') and (ie_status_solicitacao_p = 'P') then
		begin
		select	coalesce(pls_obter_se_item_auditor(nr_seq_auditoria_p,nr_seq_item_p,ie_tipo_item_p,nm_usuario_p),'N')
		into STRICT	ie_auditor_grupo_item_w
		;
		end;
	else
		ie_auditor_grupo_item_w := 'S';
	end if;

	if (ie_auditar_sem_usu_exec_p = 'S') and (ie_auditor_grupo_w = 'S') then
		begin
		select	coalesce(pls_obter_se_grupo_assumido(nr_seq_auditoria_p,nm_usuario_p),'N')
		into STRICT	ie_grupo_assumido_w
		;
		end;
	else
		begin
		ie_grupo_assumido_w := 'S';
		end;
	end if;

	ie_auditor_grupo_p		:= ie_auditor_grupo_w;
	ie_auditor_regra_despesa_p	:= ie_auditor_regra_despesa_w;
	ie_auditor_grupo_item_p	:= ie_auditor_grupo_item_w;
	ie_grupo_assumido_p	:= ie_grupo_assumido_w;

	end;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_obter_dados_regra_auditor ( nr_seq_auditoria_p bigint, ie_tipo_item_p text, nr_seq_item_p bigint, ie_tipo_despesa_p bigint, ie_permite_aparecer_itens_p text, ie_auditar_sem_usu_exec_p text, ie_status_solicitacao_p text, nm_usuario_p text, ie_auditor_grupo_p INOUT text, ie_auditor_regra_despesa_p INOUT text, ie_auditor_grupo_item_p INOUT text, ie_grupo_assumido_p INOUT text) FROM PUBLIC;

