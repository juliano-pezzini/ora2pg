-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gera_lote_hist_item_justif ( nm_usuario_p text, ds_justificativa_p text, nr_seq_justif_p lote_hist_item_justif.nr_sequencia%type default null) AS $body$
DECLARE

					
ie_existe_w	varchar(1);
					

BEGIN

	select	CASE WHEN count(1)=0 THEN  'N'  ELSE 'S' END
	into STRICT	ie_existe_w
	from	lote_hist_item_justif
	where	lower(ds_justificativa) = lower(ds_justificativa_p);

	if (ie_existe_w = 'N') then
		insert into lote_hist_item_justif(nr_sequencia, nm_usuario, dt_atualizacao, cd_estabelecimento, ds_justificativa)
		values (coalesce(nr_seq_justif_p, nextval('lote_hist_item_justif_seq')), nm_usuario_p, clock_timestamp(), wheb_usuario_pck.get_cd_estabelecimento(), ds_justificativa_p);

		commit;
	end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gera_lote_hist_item_justif ( nm_usuario_p text, ds_justificativa_p text, nr_seq_justif_p lote_hist_item_justif.nr_sequencia%type default null) FROM PUBLIC;

