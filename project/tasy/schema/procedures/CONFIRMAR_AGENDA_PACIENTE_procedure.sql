-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE confirmar_agenda_paciente ( nr_seq_agenda_p bigint, nm_usuario_p text, ie_status_agenda_p text default null) AS $body$
DECLARE


cd_pessoa_fisica_w			varchar(10);
ds_param_integ_hl7_w		varchar(4000);
nr_cirurgia_w				bigint;
cd_setor_atendimento_w		integer;
ds_sep_bv_w					varchar(100);


BEGIN

ds_sep_bv_w := obter_separador_bv;

if (nr_seq_agenda_p IS NOT NULL AND nr_seq_agenda_p::text <> '') and (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') then
	update	agenda_paciente
	set		dt_confirmacao	= clock_timestamp(),
			nm_usuario_confirm	= nm_usuario_p,
			ie_status_agenda = coalesce(ie_status_agenda_p, ie_status_agenda)
	where	nr_sequencia		= nr_seq_agenda_p;

/*
	select	max(cd_pessoa_fisica),
			max(nr_cirurgia)
	into	cd_pessoa_fisica_w,
			nr_cirurgia_w
	from	agenda_paciente
	where	nr_sequencia = nr_seq_agenda_p;

	if	(cd_pessoa_fisica_w is not null) and
		(nr_cirurgia_w is not null) then

		select	max(cd_setor_atendimento)
		into	cd_setor_atendimento_w
		from	cirurgia
		where	nr_cirurgia = nr_cirurgia_w;

		ds_param_integ_hl7_w := 'cd_pessoa_fisica=' || cd_pessoa_fisica_w || ds_sep_bv_w ||
								'nr_sequencia=' || nr_seq_agenda_p || ds_sep_bv_w;
		gravar_agend_integracao(462, ds_param_integ_hl7_w, cd_setor_atendimento_w);
	end if;
*/
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE confirmar_agenda_paciente ( nr_seq_agenda_p bigint, nm_usuario_p text, ie_status_agenda_p text default null) FROM PUBLIC;

