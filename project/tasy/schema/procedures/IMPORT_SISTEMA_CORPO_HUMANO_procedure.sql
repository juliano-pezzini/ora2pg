-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE import_sistema_corpo_humano ( nr_seq_sistema_corpo_humano_p bigint, nr_seq_item_p bigint) AS $body$
DECLARE


nr_seq_subitem_suep_w				subitem_suep.nr_sequencia%type;
nr_seq_informacao_suep_w		  	informacao_suep.nr_sequencia%type;
nr_seq_sv_pep_informacao_w			pep_informacao.nr_sequencia%type;
nr_seq_escala_pep_informacao_w		pep_informacao.nr_sequencia%type;
nm_atributo_sinal_vital_w			sinal_vital.nm_atributo%type;

c01 CURSOR FOR
SELECT  a.nr_sequencia, 		
        a.nr_seq_exame,
        a.nr_seq_sinal,
        a.nr_seq_escala_doc
from		sistema_corpo_humano_item a
where		a.nr_seq_sistema_corpo_humano = nr_seq_sistema_corpo_humano_p;

BEGIN

if (nr_seq_item_p IS NOT NULL AND nr_seq_item_p::text <> '') then

	for r_c01 in c01 loop
		if (r_c01.nr_seq_exame IS NOT NULL AND r_c01.nr_seq_exame::text <> '') then

			select	max(nr_sequencia)
			into STRICT	nr_seq_subitem_suep_w
			from	subitem_suep a
			where	a.nr_seq_item = nr_seq_item_p
			and		a.ie_tipo_item = 'EX';

			if (coalesce(nr_seq_subitem_suep_w::text, '') = '') then

				select	nextval('subitem_suep_seq')
				into STRICT	nr_seq_subitem_suep_w
				;

				insert into subitem_suep(
					nr_sequencia,
					nr_seq_item,
					nm_usuario,
					nm_usuario_nrec,
					dt_atualizacao,
					dt_atualizacao_nrec,
					ie_tipo_item,
					ie_restringe_regra_exame)

				values (nr_seq_subitem_suep_w,
					nr_seq_item_p,
					obter_usuario_ativo,
					obter_usuario_ativo,
					clock_timestamp(),
					clock_timestamp(),
					'EX',
					'N');

			end if;

			select	nextval('informacao_suep_seq')
			into STRICT	nr_seq_informacao_suep_w
			;

			insert into informacao_suep(
				nr_sequencia,
				nm_usuario,
				nm_usuario_nrec,
				dt_atualizacao,
				dt_atualizacao_nrec,
				nr_seq_apres,
				ie_result_exame,
				nr_seq_exame,
				ie_separar_texto,
				ie_apres_lista_prob,
				nr_seq_subitem,
        nr_seq_sis_corpo_hum_item)

			values (nr_seq_informacao_suep_w,
				obter_usuario_ativo,
				obter_usuario_ativo,
				clock_timestamp(),
				clock_timestamp(),
				999,
				'R',
				r_c01.nr_seq_exame,
				'N',
				'S',
				nr_seq_subitem_suep_w,
        r_c01.nr_sequencia);

		elsif (r_c01.nr_seq_sinal IS NOT NULL AND r_c01.nr_seq_sinal::text <> '') then

			select	max(nr_sequencia)
			into STRICT	nr_seq_subitem_suep_w
			from	subitem_suep a
			where	a.nr_seq_item = nr_seq_item_p
			and		a.ie_tipo_item = 'SV';

			if (coalesce(nr_seq_subitem_suep_w::text, '') = '') then

				select	nextval('subitem_suep_seq')
				into STRICT	nr_seq_subitem_suep_w
				;

				insert into subitem_suep(
					nr_sequencia,
					nr_seq_item,
					nm_usuario,
					nm_usuario_nrec,
					dt_atualizacao,
					dt_atualizacao_nrec,
					ie_tipo_item,
					ie_restringe_regra_exame)

				values (nr_seq_subitem_suep_w,
					nr_seq_item_p,
					obter_usuario_ativo,
					obter_usuario_ativo,
					clock_timestamp(),
					clock_timestamp(),
					'SV',
					'N');

			end if;

			select	nm_atributo
			into STRICT	nm_atributo_sinal_vital_w
			from	sinal_vital
			where	nr_sequencia = r_c01.nr_seq_sinal;

			select	pep.nr_sequencia
			into STRICT	nr_seq_sv_pep_informacao_w
			from	sinal_vital sv, pep_informacao pep
			where	sv.nm_atributo = pep.nm_atributo_inf
			and		pep.ie_grupo_suep = 'SV'
      and   pep.ie_suep = 'S'
			and		sv.nm_atributo = nm_atributo_sinal_vital_w;

			select	nextval('informacao_suep_seq')
			into STRICT	nr_seq_informacao_suep_w
			;

			insert into informacao_suep(
				nr_sequencia,
				nm_usuario,
				nm_usuario_nrec,
				dt_atualizacao,
				dt_atualizacao_nrec,
				nr_seq_apres,
				nr_seq_inf,
				ie_separar_texto,
				ie_apres_lista_prob,
				nr_seq_subitem,
				nr_seq_sis_corpo_hum_item)

			values (nr_seq_informacao_suep_w,
				obter_usuario_ativo,
				obter_usuario_ativo,
				clock_timestamp(),
				clock_timestamp(),
				999,
				nr_seq_sv_pep_informacao_w,
				'N',
				'S',
				nr_seq_subitem_suep_w,
				r_c01.nr_sequencia);

		elsif (r_c01.nr_seq_escala_doc IS NOT NULL AND r_c01.nr_seq_escala_doc::text <> '') then

			select	max(nr_sequencia)
			into STRICT	nr_seq_subitem_suep_w
			from	subitem_suep a
			where	a.nr_seq_item = nr_seq_item_p
			and		a.ie_tipo_item = 'EI';

			if (coalesce(nr_seq_subitem_suep_w::text, '') = '') then

				select	nextval('subitem_suep_seq')
				into STRICT	nr_seq_subitem_suep_w
				;

				insert into subitem_suep(
					nr_sequencia,
					nr_seq_item,
					nm_usuario,
					nm_usuario_nrec,
					dt_atualizacao,
					dt_atualizacao_nrec,
					ie_tipo_item,
					ie_restringe_regra_exame)

				values (nr_seq_subitem_suep_w,
					nr_seq_item_p,
					obter_usuario_ativo,
					obter_usuario_ativo,
					clock_timestamp(),
					clock_timestamp(),
					'EI',
					'N');

			end if;

			select	nextval('informacao_suep_seq')
			into STRICT	nr_seq_informacao_suep_w
			;

			select	pep.nr_sequencia
			into STRICT	nr_seq_escala_pep_informacao_w
			from	escala_documentacao ed,
					pep_informacao pep
			where	ed.ie_escala = pep.ie_escala
			and		ed.nr_sequencia = r_c01.nr_seq_escala_doc
			and		(pep.nm_atributo_inf IS NOT NULL AND pep.nm_atributo_inf::text <> '');

			insert into informacao_suep(
				nr_sequencia,
				nm_usuario,
				nm_usuario_nrec,
				dt_atualizacao,
				dt_atualizacao_nrec,
				nr_seq_apres,
				nr_seq_inf,
				ie_separar_texto,
				ie_apres_lista_prob,
				nr_seq_subitem,
				nr_seq_sis_corpo_hum_item)

			values (nr_seq_informacao_suep_w,
				obter_usuario_ativo,
				obter_usuario_ativo,
				clock_timestamp(),
				clock_timestamp(),
				999,
				nr_seq_escala_pep_informacao_w,
				'N',
				'S',
				nr_seq_subitem_suep_w,
				r_c01.nr_sequencia);

		end if;
	end loop;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE import_sistema_corpo_humano ( nr_seq_sistema_corpo_humano_p bigint, nr_seq_item_p bigint) FROM PUBLIC;

