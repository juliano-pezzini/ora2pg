-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_campo_gen_relatorio ( nr_seq_relatorio_p bigint, cd_relatorio_p bigint, nm_usuario_p text, ds_label_p text, nm_label_p text, nr_seq_apresentacao_p bigint, nr_seq_doc_relat_dinamico_p doc_relatorio_dinamico.nr_Sequencia%type DEFAULT NULL, nr_seq_conteudo_p bigint  DEFAULT NULL) AS $body$
DECLARE

  qt_campos_banda_w  bigint;
  qt_altura_banda_w  bigint;
  qt_tamanho_banda_w bigint;
  qt_campo_banda_w   bigint;
  nr_template_w      bigint;

BEGIN

  SELECT COUNT(nr_sequencia)
  INTO STRICT qt_campo_banda_w
  FROM relatorio_dinamico
  WHERE nr_seq_relatorio = nr_seq_relatorio_p
  AND cd_relatorio       = cd_relatorio_p
  AND nr_tipo_banda      = 2;

  IF (qt_campos_banda_w   > 0) THEN
    SELECT MAX(qt_altura_banda),
      MAX(qt_tamanho_banda)
    INTO STRICT qt_altura_banda_w,
      qt_tamanho_banda_w
    FROM relatorio_dinamico
    WHERE nr_seq_relatorio = nr_seq_relatorio_p
    AND cd_relatorio       = cd_relatorio_p
    AND nr_tipo_banda      = 2;
  END IF;

  INSERT
  INTO relatorio_dinamico(
      nr_sequencia,
      dt_atualizacao,
      nm_usuario,
      dt_atualizacao_nrec,
      nm_usuario_nrec,
      cd_relatorio,
      cd_tipo,
      ds_label,
      nr_eixo_y,
      nr_eixo_x,
      nr_altura,
      nr_comprimento,
      qt_rotacao,
      nm_label,
      ie_ajustar_tamanho,
      nr_seq_apres,
      nr_tipo_banda,
      nr_seq_relatorio,
      qt_tamanho_banda,
      qt_altura_banda,
      nr_seq_doc_relat_dinamico,
      nr_seq_temp_conteudo
    )
    VALUES (
      nextval('relatorio_dinamico_seq'),
      clock_timestamp(),
      nm_usuario_p,
      clock_timestamp(),
      nm_usuario_p,
      cd_relatorio_p,
      NULL,
      ds_label_p,
      '1',
      '1',
      '20',
      '40',
      '0',
      nm_label_p,
      'S',
      nr_seq_apresentacao_p,
      '2',
      nr_seq_relatorio_p,
      coalesce(qt_tamanho_banda_w,'500'),
      coalesce(qt_altura_banda_w,'200'),
      nr_seq_doc_relat_dinamico_p,
      nr_seq_conteudo_p
    );
commit;	

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_campo_gen_relatorio ( nr_seq_relatorio_p bigint, cd_relatorio_p bigint, nm_usuario_p text, ds_label_p text, nm_label_p text, nr_seq_apresentacao_p bigint, nr_seq_doc_relat_dinamico_p doc_relatorio_dinamico.nr_Sequencia%type DEFAULT NULL, nr_seq_conteudo_p bigint  DEFAULT NULL) FROM PUBLIC;

