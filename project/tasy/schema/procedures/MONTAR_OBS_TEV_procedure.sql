-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE montar_obs_tev ( nr_sequencia_p bigint, nm_usuario_p text) AS $body$
DECLARE


ds_observacao_w		varchar(4000);
ds_texto_w			varchar(4000);
nr_seq_just_tev_w	bigint;
ie_med_acordo_w		varchar(1);
ds_justificativa_w	varchar(255);


BEGIN
if (coalesce(nr_sequencia_p,0) > 0) then
	select	max(ie_med_acordo),
			coalesce(max(nr_seq_just_tev),0),
			max(ds_observacao)
	into STRICT	ie_med_acordo_w,
			nr_seq_just_tev_w,
			ds_observacao_w
	from	escala_tev
	where	nr_sequencia = nr_sequencia_p;

	if (coalesce(nr_seq_just_tev_w,0) > 0) then
		select	max(ds_justificativa)
		into STRICT	ds_justificativa_w
		from	tev_justificativa
		where	nr_sequencia = nr_seq_just_tev_w;
	else
		ds_justificativa_w := obter_desc_expressao(349795);--'Justificativa n√£o informada.';
	end if;

	if (ie_med_acordo_w = 'T') then
		ds_texto_w := obter_desc_expressao(612810)||': '||obter_desc_expressao(787393); --'De acordo: Totalmente.';
	elsif (ie_med_acordo_w = 'P') then
		ds_texto_w := obter_desc_expressao(612810)||': '||obter_desc_expressao(331330)||', '||ds_justificativa_w; --'De acordo: Parcialmente, ' || ds_justificativa_w;
	elsif (ie_med_acordo_w = 'D') then
		ds_texto_w :=  obter_desc_expressao(612810)||': '||obter_desc_expressao(787395)||', '||ds_justificativa_w; --'De acordo: Em desacordo, ' || ds_justificativa_w;
	end if;

	ds_texto_w := ds_texto_w || chr(10) || chr(13) ||
				ds_observacao_w;

	update	escala_tev
	set		ds_observacao = ds_texto_w
	where	nr_sequencia = nr_sequencia_p;

	commit;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE montar_obs_tev ( nr_sequencia_p bigint, nm_usuario_p text) FROM PUBLIC;

