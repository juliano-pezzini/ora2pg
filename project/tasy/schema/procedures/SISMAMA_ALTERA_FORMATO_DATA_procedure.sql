-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE sismama_altera_formato_data () AS $body$
BEGIN
/*campos a serem alterados de tamanho/tipo da tabela SISMAMA_ANAMNESE_RAD:
dt_tumorectomia_dir
dt_tumorectomia_esq
dt_segmentectomia_dir
dt_segmentectomia_esq
dt_dutectomia_dir
dt_dutectomia_esq
dt_mastectomia_dir
dt_mastectomia_esq
dt_mastectomia_pele_dir
dt_mastectomia_pele_esq
dt_esvaziamento_dir
dt_esvaziamento_esq
dt_biopsia_linf_sent_dir
dt_biopsia_linf_sent_esq
dt_reconstrucao_dir
dt_reconstrucao_esq
dt_plastic_redutora_dir
dt_plastic_redutora_esq
dt_plastic_implante_dir
dt_plastic_implante_esq*/
/*1º passo, cria uma tabela temporária para não perder as informações*/

CALL exec_sql_dinamico('Anderson', 'create table SISMAMA_ANAMNESE_RAD_BKP as select * from SISMAMA_ANAMNESE_RAD');


/*2º passo, cria todos os campos temporários para armazenar as informações*/

CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD add dt_tumorectomia_dir2 varchar2(4)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD add dt_tumorectomia_esq2 varchar2(4)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD add dt_segmentectomia_dir2 varchar2(4)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD add dt_segmentectomia_esq2 varchar2(4)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD add dt_dutectomia_dir2 varchar2(4)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD add dt_dutectomia_esq2 varchar2(4)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD add dt_mastectomia_dir2 varchar2(4)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD add dt_mastectomia_esq2 varchar2(4)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD add dt_mastectomia_pele_dir2 varchar2(4)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD add dt_mastectomia_pele_esq2 varchar2(4)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD add dt_esvaziamento_dir2 varchar2(4)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD add dt_esvaziamento_esq2 varchar2(4)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD add dt_biopsia_linf_sent_dir2 varchar2(4)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD add dt_biopsia_linf_sent_esq2 varchar2(4)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD add dt_reconstrucao_dir2 varchar2(4)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD add dt_reconstrucao_esq2 varchar2(4)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD add dt_plastic_redutora_dir2 varchar2(4)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD add dt_plastic_redutora_esq2 varchar2(4)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD add dt_plastic_implante_dir2 varchar2(4)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD add dt_plastic_implante_esq2 varchar2(4)');


/*3º passo, faz update de todos os campos passando as informações no formato yyyy para os novos campos*/

CALL exec_sql_dinamico('Anderson', 	'update SISMAMA_ANAMNESE_RAD ' ||
				'set 	dt_tumorectomia_dir2 = to_char(dt_tumorectomia_dir,' || chr(39) || 'yyyy' || chr(39) || '),' ||
				'	dt_tumorectomia_esq2 = to_char(dt_tumorectomia_esq,' || chr(39) || 'yyyy' || chr(39) || '),' ||
				'	dt_segmentectomia_dir2 = to_char(dt_segmentectomia_dir,' || chr(39) || 'yyyy' || chr(39) || '),' ||
				'	dt_segmentectomia_esq2 = to_char(dt_segmentectomia_esq,' || chr(39) || 'yyyy' || chr(39) || '),' ||
				'	dt_dutectomia_dir2 = to_char(dt_dutectomia_dir,' || chr(39) || 'yyyy' || chr(39) || '),' ||
				'	dt_dutectomia_esq2 = to_char(dt_dutectomia_esq,' || chr(39) || 'yyyy' || chr(39) || '),' ||
				'	dt_mastectomia_dir2 = to_char(dt_mastectomia_dir,' || chr(39) || 'yyyy' || chr(39) || '),' ||
				'	dt_mastectomia_esq2 = to_char(dt_mastectomia_esq,' || chr(39) || 'yyyy' || chr(39) || '),' ||
				'	dt_mastectomia_pele_dir2 = to_char(dt_mastectomia_pele_dir,' || chr(39) || 'yyyy' || chr(39) || '),' ||
				'	dt_mastectomia_pele_esq2 = to_char(dt_mastectomia_pele_esq,' || chr(39) || 'yyyy' || chr(39) || '),' ||
				'	dt_esvaziamento_dir2 = to_char(dt_esvaziamento_dir,' || chr(39) || 'yyyy' || chr(39) || '),' ||
				'	dt_esvaziamento_esq2 = to_char(dt_esvaziamento_esq,' || chr(39) || 'yyyy' || chr(39) || '),' ||
				'	dt_biopsia_linf_sent_dir2 = to_char(dt_biopsia_linf_sent_dir,' || chr(39) || 'yyyy' || chr(39) || '),' ||
				'	dt_biopsia_linf_sent_esq2 = to_char(dt_biopsia_linf_sent_esq,' || chr(39) || 'yyyy' || chr(39) || '),' ||
				'	dt_reconstrucao_dir2 = to_char(dt_reconstrucao_dir,' || chr(39) || 'yyyy' || chr(39) || '),' ||
				'	dt_reconstrucao_esq2 = to_char(dt_reconstrucao_esq,' || chr(39) || 'yyyy' || chr(39) || '),' ||
				'	dt_plastic_redutora_dir2 = to_char(dt_plastic_redutora_dir,' || chr(39) || 'yyyy' || chr(39) || '),' ||
				'	dt_plastic_redutora_esq2 = to_char(dt_plastic_redutora_esq,' || chr(39) || 'yyyy' || chr(39) || '),' ||
				'	dt_plastic_implante_dir2 = to_char(dt_plastic_implante_dir,' || chr(39) || 'yyyy' || chr(39) || '),' ||
				'	dt_plastic_implante_esq2 = to_char(dt_plastic_implante_esq,' || chr(39) || 'yyyy' || chr(39) || ')');


/*4º passo, seta todos os campos que serão substituidos para nulo para fazer o modify*/

CALL exec_sql_dinamico('Anderson', 'update SISMAMA_ANAMNESE_RAD set 	 dt_tumorectomia_dir = null,' ||
								'dt_tumorectomia_esq = null,' ||
								'dt_segmentectomia_dir = null,'||
								'dt_segmentectomia_esq = null,'||
								'dt_dutectomia_dir = null,'||
								'dt_dutectomia_esq = null,'||
								'dt_mastectomia_dir = null,'||
								'dt_mastectomia_esq = null,'||
								'dt_mastectomia_pele_dir = null,'||
								'dt_mastectomia_pele_esq = null,'||
								'dt_esvaziamento_dir = null,'||
								'dt_esvaziamento_esq = null,'||
								'dt_biopsia_linf_sent_dir = null,'||
								'dt_biopsia_linf_sent_esq = null,'||
								'dt_reconstrucao_dir = null,'||
								'dt_reconstrucao_esq = null,'||
								'dt_plastic_redutora_dir = null,'||
								'dt_plastic_redutora_esq = null,'||
								'dt_plastic_implante_dir = null,'||
								'dt_plastic_implante_esq = null');

/*5º passo,  fazer o modify dos campos*/

CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD modify dt_tumorectomia_dir varchar2(04)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD modify dt_tumorectomia_esq varchar2(04)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD modify dt_segmentectomia_dir varchar2(04)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD modify dt_segmentectomia_esq varchar2(04)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD modify dt_dutectomia_dir varchar2(04)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD modify dt_dutectomia_esq varchar2(04)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD modify dt_mastectomia_dir varchar2(04)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD modify dt_mastectomia_esq varchar2(04)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD modify dt_mastectomia_pele_dir varchar2(04)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD modify dt_mastectomia_pele_esq varchar2(04)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD modify dt_esvaziamento_dir varchar2(04)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD modify dt_esvaziamento_esq varchar2(04)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD modify dt_biopsia_linf_sent_dir varchar2(04)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD modify dt_biopsia_linf_sent_esq varchar2(04)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD modify dt_reconstrucao_dir varchar2(04)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD modify dt_reconstrucao_esq varchar2(04)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD modify dt_plastic_redutora_dir varchar2(04)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD modify dt_plastic_redutora_esq varchar2(04)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD modify dt_plastic_implante_dir varchar2(04)');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD modify dt_plastic_implante_esq varchar2(04)');


/*6º passo, seta os valores para os campos corretos*/

CALL exec_sql_dinamico('Anderson', 'update SISMAMA_ANAMNESE_RAD set 	 dt_tumorectomia_dir = dt_tumorectomia_dir2,' ||
								'dt_tumorectomia_esq = dt_tumorectomia_esq2,' ||
								'dt_segmentectomia_dir = dt_segmentectomia_dir2,'||
								'dt_segmentectomia_esq = dt_segmentectomia_esq2,'||
								'dt_dutectomia_dir = dt_dutectomia_dir2,'||
								'dt_dutectomia_esq = dt_dutectomia_esq2,'||
								'dt_mastectomia_dir = dt_mastectomia_dir2,'||
								'dt_mastectomia_esq = dt_mastectomia_esq2,'||
								'dt_mastectomia_pele_dir = dt_mastectomia_pele_dir2,'||
								'dt_mastectomia_pele_esq = dt_mastectomia_pele_esq2,'||
								'dt_esvaziamento_dir = dt_esvaziamento_dir2,'||
								'dt_esvaziamento_esq = dt_esvaziamento_esq2,'||
								'dt_biopsia_linf_sent_dir = dt_biopsia_linf_sent_dir2,'||
								'dt_biopsia_linf_sent_esq = dt_biopsia_linf_sent_esq2,'||
								'dt_reconstrucao_dir = dt_reconstrucao_dir2,'||
								'dt_reconstrucao_esq = dt_reconstrucao_esq2,'||
								'dt_plastic_redutora_dir = dt_plastic_redutora_dir2,'||
								'dt_plastic_redutora_esq = dt_plastic_redutora_esq2,'||
								'dt_plastic_implante_dir = dt_plastic_implante_dir2,'||
								'dt_plastic_implante_esq = dt_plastic_implante_esq2');


/*7º passo, dropa os campos temporarios*/

CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD drop column dt_tumorectomia_dir2');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD drop column dt_tumorectomia_esq2');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD drop column dt_segmentectomia_dir2');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD drop column dt_segmentectomia_esq2');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD drop column dt_dutectomia_dir2');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD drop column dt_dutectomia_esq2');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD drop column dt_mastectomia_dir2');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD drop column dt_mastectomia_esq2');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD drop column dt_mastectomia_pele_dir2');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD drop column dt_mastectomia_pele_esq2');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD drop column dt_esvaziamento_dir2');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD drop column dt_esvaziamento_esq2');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD drop column dt_biopsia_linf_sent_dir2');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD drop column dt_biopsia_linf_sent_esq2');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD drop column dt_reconstrucao_dir2');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD drop column dt_reconstrucao_esq2');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD drop column dt_plastic_redutora_dir2');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD drop column dt_plastic_redutora_esq2');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD drop column dt_plastic_implante_dir2');
CALL exec_sql_dinamico('Anderson', 'alter table SISMAMA_ANAMNESE_RAD drop column dt_plastic_implante_esq2');

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE sismama_altera_formato_data () FROM PUBLIC;

