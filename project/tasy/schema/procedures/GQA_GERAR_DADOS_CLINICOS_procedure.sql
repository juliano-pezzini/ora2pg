-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gqa_gerar_dados_clinicos ( nr_atendimento_p bigint, nr_seq_reg_p bigint, dt_referencia_p timestamp, nm_usuario_p text) AS $body$
DECLARE


qt_freq_card_menos_3_w		varchar(255);
qt_freq_resp_menos_3_w		varchar(255);
qt_pa_sist_menos_3_w		varchar(255);
qt_pam_menos_3_w			varchar(255);
qt_temp_menos_3_w			varchar(255);
ie_nivel_consc_menos_3_w	varchar(255);
qt_sat_o2_menos_3_w			varchar(255);

qt_freq_card_menos_2_w		varchar(255);
qt_freq_resp_menos_2_w		varchar(255);
qt_pa_sist_menos_2_w		varchar(255);
qt_pam_menos_2_w			varchar(255);
qt_temp_menos_2_w			varchar(255);
ie_nivel_consc_menos_2_w	varchar(255);
qt_sat_o2_menos_2_w			varchar(255);

qt_freq_card_menos_1_w		varchar(255);
qt_freq_resp_menos_1_w		varchar(255);
qt_pa_sist_menos_1_w		varchar(255);
qt_pam_menos_1_w			varchar(255);
qt_temp_menos_1_w			varchar(255);
ie_nivel_consc_menos_1_w	varchar(255);
qt_sat_o2_menos_1_w			varchar(255);

qt_freq_card_zero_w			varchar(255);
qt_freq_resp_zero_w			varchar(255);
qt_pa_sist_zero_w			varchar(255);
qt_pam_zero_w				varchar(255);
qt_temp_zero_w				varchar(255);
ie_nivel_consc_zero_w		varchar(255);
qt_sat_o2_zero_w			varchar(255);

qt_freq_card_mais_1_w		varchar(255);
qt_freq_resp_mais_1_w		varchar(255);
qt_pa_sist_mais_1_w			varchar(255);
qt_pam_mais_1_w				varchar(255);
qt_temp_mais_1_w			varchar(255);
ie_nivel_consc_mais_1_w		varchar(255);
qt_sat_o2_mais_1_w			varchar(255);

qt_freq_card_mais_2_w		varchar(255);
qt_freq_resp_mais_2_w		varchar(255);
qt_pa_sist_mais_2_w			varchar(255);
qt_pam_mais_2_w				varchar(255);
qt_temp_mais_2_w			varchar(255);
ie_nivel_consc_mais_2_w		varchar(255);
qt_sat_o2_mais_2_w			varchar(255);

qt_freq_card_mais_3_w		varchar(255);
qt_freq_resp_mais_3_w		varchar(255);
qt_pa_sist_mais_3_w			varchar(255);
qt_pam_mais_3_w				varchar(255);
qt_temp_mais_3_w			varchar(255);
ie_nivel_consc_mais_3_w		varchar(255);
qt_sat_o2_mais_3_w			varchar(255);

ds_mais_alta_1_w		varchar(50);
ds_mais_alta_2_w		varchar(50);
ds_mais_alta_3_w		varchar(50);
ds_mais_alta_4_w		varchar(50);
ds_mais_alta_5_w		varchar(50);
ds_mais_alta_6_w		varchar(50);
ds_mais_alta_7_w		varchar(50);

ds_mais_baixo_1_w		varchar(50);
ds_mais_baixo_2_w		varchar(50);
ds_mais_baixo_3_w		varchar(50);
ds_mais_baixo_4_w		varchar(50);
ds_mais_baixo_5_w		varchar(50);
ds_mais_baixo_6_w		varchar(50);
ds_mais_baixo_7_w		varchar(50);

qt_reg_w				bigint;

	procedure Atualiza_FC(nr_seq_p bigint, menos_3_p text, menos_2_p text, menos_1_p text, meio_p text, mais_1_p text, mais_2_p text, mais_3_p text) is
		;
BEGIN
		if (nr_seq_p > 0) then

			update	w_gestao_sepsis_sofa
			set	ds_sv_fc_menos_3	= menos_3_p,
				ds_sv_fc_menos_2	= menos_2_p,
				ds_sv_fc_menos_1	= menos_1_p,
				ds_sv_fc_zero		= meio_p,
				ds_sv_fc_mais_1		= mais_1_p,
				ds_sv_fc_mais_2		= mais_2_p,
				ds_sv_fc_mais_3		= mais_3_p
			where	nr_sequencia = nr_seq_p;
			commit;
		end if;
		end;

	procedure Atualiza_FR(nr_seq_p number, menos_3_p varchar2, menos_2_p varchar2, menos_1_p varchar2, meio_p varchar2, mais_1_p varchar2, mais_2_p varchar2, mais_3_p varchar2) is
		begin
		if (nr_seq_p > 0) then

			update	w_gestao_sepsis_sofa
			set	ds_sv_fr_menos_3	= menos_3_p,
				ds_sv_fr_menos_2	= menos_2_p,
				ds_sv_fr_menos_1	= menos_1_p,
				ds_sv_fr_zero		= meio_p,
				ds_sv_fr_mais_1		= mais_1_p,
				ds_sv_fr_mais_2		= mais_2_p,
				ds_sv_fr_mais_3		= mais_3_p
			where	nr_sequencia = nr_seq_p;
			commit;
		end if;
		end;

	procedure Atualiza_PA_Sistolica(nr_seq_p number, menos_3_p varchar2, menos_2_p varchar2, menos_1_p varchar2, meio_p varchar2, mais_1_p varchar2, mais_2_p varchar2, mais_3_p varchar2) is
		begin
		if (nr_seq_p > 0) then

			update	w_gestao_sepsis_sofa
			set	ds_sv_as_menos_3	= menos_3_p,
				ds_sv_as_menos_2	= menos_2_p,
				ds_sv_as_menos_1	= menos_1_p,
				ds_sv_as_zero		= meio_p,
				ds_sv_as_mais_1		= mais_1_p,
				ds_sv_as_mais_2		= mais_2_p,
				ds_sv_as_mais_3		= mais_3_p
			where	nr_sequencia = nr_seq_p;
			commit;
		end if;
		end;

	procedure Atualiza_PAM(nr_seq_p number, menos_3_p varchar2, menos_2_p varchar2, menos_1_p varchar2, meio_p varchar2, mais_1_p varchar2, mais_2_p varchar2, mais_3_p varchar2) is
		begin
		if (nr_seq_p > 0) then

			update	w_gestao_sepsis_sofa
			set	ds_sv_am_menos_3	= menos_3_p,
				ds_sv_am_menos_2	= menos_2_p,
				ds_sv_am_menos_1	= menos_1_p,
				ds_sv_am_zero		= meio_p,
				ds_sv_am_mais_1		= mais_1_p,
				ds_sv_am_mais_2		= mais_2_p,
				ds_sv_am_mais_3		= mais_3_p
			where	nr_sequencia = nr_seq_p;
			commit;
		end if;
		end;

	procedure Atualiza_Temp_axilar(nr_seq_p number, menos_3_p varchar2, menos_2_p varchar2, menos_1_p varchar2, meio_p varchar2, mais_1_p varchar2, mais_2_p varchar2, mais_3_p varchar2) is
		begin
		if (nr_seq_p > 0) then

			update	w_gestao_sepsis_sofa
			set	ds_sv_ta_menos_3	= menos_3_p,
				ds_sv_ta_menos_2	= menos_2_p,
				ds_sv_ta_menos_1	= menos_1_p,
				ds_sv_ta_zero		= meio_p,
				ds_sv_ta_mais_1		= mais_1_p,
				ds_sv_ta_mais_2		= mais_2_p,
				ds_sv_ta_mais_3		= mais_3_p
			where	nr_sequencia = nr_seq_p;
			commit;
		end if;
		end;

	procedure Atualiza_nivel_consc(nr_seq_p number, menos_3_p varchar2, menos_2_p varchar2, menos_1_p varchar2, meio_p varchar2, mais_1_p varchar2, mais_2_p varchar2, mais_3_p varchar2) is
		begin
		if (nr_seq_p > 0) then

			update	w_gestao_sepsis_sofa
			set	ds_sv_nc_menos_3	= menos_3_p,
				ds_sv_nc_menos_2	= menos_2_p,
				ds_sv_nc_menos_1	= menos_1_p,
				ds_sv_nc_zero		= meio_p,
				ds_sv_nc_mais_1		= mais_1_p,
				ds_sv_nc_mais_2		= mais_2_p,
				ds_sv_nc_mais_3		= mais_3_p
			where	nr_sequencia = nr_seq_p;
			commit;
		end if;
		end;

	procedure Atualiza_Sao2(nr_seq_p number, menos_3_p varchar2, menos_2_p varchar2, menos_1_p varchar2, meio_p varchar2, mais_1_p varchar2, mais_2_p varchar2, mais_3_p varchar2) is
		begin
		if (nr_seq_p > 0) then

			update	w_gestao_sepsis_sofa
			set	ds_sv_so2_menos_3	= menos_3_p,
				ds_sv_so2_menos_2	= menos_2_p,
				ds_sv_so2_menos_1	= menos_1_p,
				ds_sv_so2_zero		= meio_p,
				ds_sv_so2_mais_1		= mais_1_p,
				ds_sv_so2_mais_2		= mais_2_p,
				ds_sv_so2_mais_3		= mais_3_p
			where	nr_sequencia = nr_seq_p;
			commit;
		end if;
		end;

begin
select	max(qt_freq_cardiaca),
		max(qt_freq_resp),
		max(qt_pa_sistolica),
		max(qt_pam),
		max(qt_temp),
		max(CASE WHEN ie_nivel_consciencia=0 THEN 'N' WHEN ie_nivel_consciencia=1 THEN 'S' WHEN ie_nivel_consciencia=2 THEN 'N' WHEN ie_nivel_consciencia=3 THEN 'S' END ), -- Verificar
		max(qt_saturacao_o2) -- Verificar
into STRICT	ds_mais_alta_1_w,
		ds_mais_alta_2_w,
		ds_mais_alta_3_w,
		ds_mais_alta_4_w,
		ds_mais_alta_5_w,
		ds_mais_alta_6_w,
		ds_mais_alta_7_w
from	atendimento_sinal_vital
where	nr_atendimento = nr_atendimento_p
and	(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
and	coalesce(dt_inativacao::text, '') = ''
and	trunc(dt_sinal_vital) = trunc(dt_referencia_p-3);

select	min(qt_freq_cardiaca),
		min(qt_freq_resp),
		min(qt_pa_sistolica),
		min(qt_pam),
		min(qt_temp),
		min(CASE WHEN ie_nivel_consciencia=0 THEN 'N' WHEN ie_nivel_consciencia=1 THEN 'S' WHEN ie_nivel_consciencia=2 THEN 'N' WHEN ie_nivel_consciencia=3 THEN 'S' END ), -- Verificar
		min(qt_saturacao_o2) -- Verificar
into STRICT	ds_mais_baixo_1_w,
		ds_mais_baixo_2_w,
		ds_mais_baixo_3_w,
		ds_mais_baixo_4_w,
		ds_mais_baixo_5_w,
		ds_mais_baixo_6_w,
		ds_mais_baixo_7_w
from	atendimento_sinal_vital
where	nr_atendimento = nr_atendimento_p
and	(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
and	coalesce(dt_inativacao::text, '') = ''
and	trunc(dt_sinal_vital) = trunc(dt_referencia_p-3);

select	count(*)
into STRICT	qt_reg_w
from	atendimento_sinal_vital
where	nr_atendimento = nr_atendimento_p
and		(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
and		coalesce(dt_inativacao::text, '') = ''
and		trunc(dt_sinal_vital) = trunc(dt_referencia_p-3);

qt_freq_card_menos_3_w		:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_1_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_1_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_freq_resp_menos_3_w		:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_2_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_2_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_pa_sist_menos_3_w		:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_3_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_3_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_pam_menos_3_w			:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_4_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_4_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_temp_menos_3_w			:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_5_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_5_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
ie_nivel_consc_menos_3_w 	:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_6_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_6_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_sat_o2_menos_3_w			:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_7_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_7_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;

/* ********************************************************************************************************************************** */

select	max(qt_freq_cardiaca),
		max(qt_freq_resp),
		max(qt_pa_sistolica),
		max(qt_pam),
		max(qt_temp),
		max(CASE WHEN ie_nivel_consciencia=0 THEN 'N' WHEN ie_nivel_consciencia=1 THEN 'S' WHEN ie_nivel_consciencia=2 THEN 'N' WHEN ie_nivel_consciencia=3 THEN 'S' END ), -- Verificar
		max(qt_saturacao_o2) -- Verificar
into STRICT	ds_mais_alta_1_w,
		ds_mais_alta_2_w,
		ds_mais_alta_3_w,
		ds_mais_alta_4_w,
		ds_mais_alta_5_w,
		ds_mais_alta_6_w,
		ds_mais_alta_7_w
from	atendimento_sinal_vital
where	nr_atendimento = nr_atendimento_p
and	(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
and	coalesce(dt_inativacao::text, '') = ''
and	trunc(dt_sinal_vital) = trunc(dt_referencia_p-2);

select	min(qt_freq_cardiaca),
		min(qt_freq_resp),
		min(qt_pa_sistolica),
		min(qt_pam),
		min(qt_temp),
		min(CASE WHEN ie_nivel_consciencia=0 THEN 'N' WHEN ie_nivel_consciencia=1 THEN 'S' WHEN ie_nivel_consciencia=2 THEN 'N' WHEN ie_nivel_consciencia=3 THEN 'S' END ), -- Verificar
		min(qt_saturacao_o2) -- Verificar
into STRICT	ds_mais_baixo_1_w,
		ds_mais_baixo_2_w,
		ds_mais_baixo_3_w,
		ds_mais_baixo_4_w,
		ds_mais_baixo_5_w,
		ds_mais_baixo_6_w,
		ds_mais_baixo_7_w
from	atendimento_sinal_vital
where	nr_atendimento = nr_atendimento_p
and	(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
and	coalesce(dt_inativacao::text, '') = ''
and	trunc(dt_sinal_vital) = trunc(dt_referencia_p-2);

select	count(*)
into STRICT	qt_reg_w
from	atendimento_sinal_vital
where	nr_atendimento = nr_atendimento_p
and		(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
and		coalesce(dt_inativacao::text, '') = ''
and		trunc(dt_sinal_vital) = trunc(dt_referencia_p-2);

qt_freq_card_menos_2_w		:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_1_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_1_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_freq_resp_menos_2_w		:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_2_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_2_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_pa_sist_menos_2_w		:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_3_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_3_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_pam_menos_2_w			:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_4_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_4_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_temp_menos_2_w			:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_5_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_5_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
ie_nivel_consc_menos_2_w 	:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_6_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_6_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_sat_o2_menos_2_w			:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_7_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_7_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;

/* ********************************************************************************************************************************** */

select	max(qt_freq_cardiaca),
		max(qt_freq_resp),
		max(qt_pa_sistolica),
		max(qt_pam),
		max(qt_temp),
		max(CASE WHEN ie_nivel_consciencia=0 THEN 'N' WHEN ie_nivel_consciencia=1 THEN 'S' WHEN ie_nivel_consciencia=2 THEN 'N' WHEN ie_nivel_consciencia=3 THEN 'S' END ), -- Verificar
		max(qt_saturacao_o2) -- Verificar
into STRICT	ds_mais_alta_1_w,
		ds_mais_alta_2_w,
		ds_mais_alta_3_w,
		ds_mais_alta_4_w,
		ds_mais_alta_5_w,
		ds_mais_alta_6_w,
		ds_mais_alta_7_w
from	atendimento_sinal_vital
where	nr_atendimento = nr_atendimento_p
and		(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
and		coalesce(dt_inativacao::text, '') = ''
and		trunc(dt_sinal_vital) = trunc(dt_referencia_p-1);

select	min(qt_freq_cardiaca),
		min(qt_freq_resp),
		min(qt_pa_sistolica),
		min(qt_pam),
		min(qt_temp),
		min(CASE WHEN ie_nivel_consciencia=0 THEN 'N' WHEN ie_nivel_consciencia=1 THEN 'S' WHEN ie_nivel_consciencia=2 THEN 'N' WHEN ie_nivel_consciencia=3 THEN 'S' END ), -- Verificar
		min(qt_saturacao_o2) -- Verificar
into STRICT	ds_mais_baixo_1_w,
		ds_mais_baixo_2_w,
		ds_mais_baixo_3_w,
		ds_mais_baixo_4_w,
		ds_mais_baixo_5_w,
		ds_mais_baixo_6_w,
		ds_mais_baixo_7_w
from	atendimento_sinal_vital
where	nr_atendimento = nr_atendimento_p
and		(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
and		coalesce(dt_inativacao::text, '') = ''
and		trunc(dt_sinal_vital) = trunc(dt_referencia_p-1);

select	count(*)
into STRICT	qt_reg_w
from	atendimento_sinal_vital
where	nr_atendimento = nr_atendimento_p
and		(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
and		coalesce(dt_inativacao::text, '') = ''
and		trunc(dt_sinal_vital) = trunc(dt_referencia_p-1);

qt_freq_card_menos_1_w		:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_1_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_1_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_freq_resp_menos_1_w		:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_2_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_2_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_pa_sist_menos_1_w		:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_3_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_3_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_pam_menos_1_w			:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_4_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_4_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_temp_menos_1_w			:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_5_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_5_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
ie_nivel_consc_menos_1_w 	:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_6_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_6_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_sat_o2_menos_1_w			:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_7_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_7_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;

/* ********************************************************************************************************************************** */

select	max(qt_freq_cardiaca),
		max(qt_freq_resp),
		max(qt_pa_sistolica),
		max(qt_pam),
		max(qt_temp),
		max(CASE WHEN ie_nivel_consciencia=0 THEN 'N' WHEN ie_nivel_consciencia=1 THEN 'S' WHEN ie_nivel_consciencia=2 THEN 'N' WHEN ie_nivel_consciencia=3 THEN 'S' END ), -- Verificar
		max(qt_saturacao_o2) -- Verificar
into STRICT	ds_mais_alta_1_w,
		ds_mais_alta_2_w,
		ds_mais_alta_3_w,
		ds_mais_alta_4_w,
		ds_mais_alta_5_w,
		ds_mais_alta_6_w,
		ds_mais_alta_7_w
from	atendimento_sinal_vital
where	nr_atendimento = nr_atendimento_p
and		(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
and		coalesce(dt_inativacao::text, '') = ''
and		trunc(dt_sinal_vital) = trunc(dt_referencia_p);

select	min(qt_freq_cardiaca),
		min(qt_freq_resp),
		min(qt_pa_sistolica),
		min(qt_pam),
		min(qt_temp),
		min(CASE WHEN ie_nivel_consciencia=0 THEN 'N' WHEN ie_nivel_consciencia=1 THEN 'S' WHEN ie_nivel_consciencia=2 THEN 'N' WHEN ie_nivel_consciencia=3 THEN 'S' END ), -- Verificar
		min(qt_saturacao_o2) -- Verificar
into STRICT	ds_mais_baixo_1_w,
		ds_mais_baixo_2_w,
		ds_mais_baixo_3_w,
		ds_mais_baixo_4_w,
		ds_mais_baixo_5_w,
		ds_mais_baixo_6_w,
		ds_mais_baixo_7_w
from	atendimento_sinal_vital
where	nr_atendimento = nr_atendimento_p
and		(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
and		coalesce(dt_inativacao::text, '') = ''
and		trunc(dt_sinal_vital) = trunc(dt_referencia_p);

select	count(*)
into STRICT	qt_reg_w
from	atendimento_sinal_vital
where	nr_atendimento = nr_atendimento_p
and		(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
and		coalesce(dt_inativacao::text, '') = ''
and		trunc(dt_sinal_vital) = trunc(dt_referencia_p);

qt_freq_card_zero_w		:= replace(obter_desc_expressao(327347) || ' ' || ds_mais_alta_1_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_1_w || obter_desc_expressao(701494) || ' ' || qt_reg_w,',','.');
qt_freq_resp_zero_w		:= replace(obter_desc_expressao(327347) || ' ' || ds_mais_alta_2_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_2_w || obter_desc_expressao(701494) || ' ' || qt_reg_w,',','.');
qt_pa_sist_zero_w		:= replace(obter_desc_expressao(327347) || ' ' || ds_mais_alta_3_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_3_w || obter_desc_expressao(701494) || ' ' || qt_reg_w,',','.');
qt_pam_zero_w			:= replace(obter_desc_expressao(327347) || ' ' || ds_mais_alta_4_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_4_w || obter_desc_expressao(701494) || ' ' || qt_reg_w,',','.');
qt_temp_zero_w			:= replace(obter_desc_expressao(327347) || ' ' || ds_mais_alta_5_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_5_w || obter_desc_expressao(701494) || ' ' || qt_reg_w,',','.');
ie_nivel_consc_zero_w 	:= replace(obter_desc_expressao(327347) || ' ' || ds_mais_alta_6_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_6_w || obter_desc_expressao(701494) || ' ' || qt_reg_w,',','.');
qt_sat_o2_zero_w		:= replace(obter_desc_expressao(327347) || ' ' || ds_mais_alta_7_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_7_w || obter_desc_expressao(701494) || ' ' || qt_reg_w,',','.');

/* ********************************************************************************************************************************** */

select	max(qt_freq_cardiaca),
		max(qt_freq_resp),
		max(qt_pa_sistolica),
		max(qt_pam),
		max(qt_temp),
		max(CASE WHEN ie_nivel_consciencia=0 THEN 'N' WHEN ie_nivel_consciencia=1 THEN 'S' WHEN ie_nivel_consciencia=2 THEN 'N' WHEN ie_nivel_consciencia=3 THEN 'S' END ), -- Verificar
		max(qt_saturacao_o2) -- Verificar
into STRICT	ds_mais_alta_1_w,
		ds_mais_alta_2_w,
		ds_mais_alta_3_w,
		ds_mais_alta_4_w,
		ds_mais_alta_5_w,
		ds_mais_alta_6_w,
		ds_mais_alta_7_w
from	atendimento_sinal_vital
where	nr_atendimento = nr_atendimento_p
and		(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
and		coalesce(dt_inativacao::text, '') = ''
and		trunc(dt_sinal_vital) = trunc(dt_referencia_p+1);

select	min(qt_freq_cardiaca),
		min(qt_freq_resp),
		min(qt_pa_sistolica),
		min(qt_pam),
		min(qt_temp),
		min(CASE WHEN ie_nivel_consciencia=0 THEN 'N' WHEN ie_nivel_consciencia=1 THEN 'S' WHEN ie_nivel_consciencia=2 THEN 'N' WHEN ie_nivel_consciencia=3 THEN 'S' END ), -- Verificar
		min(qt_saturacao_o2) -- Verificar
into STRICT	ds_mais_baixo_1_w,
		ds_mais_baixo_2_w,
		ds_mais_baixo_3_w,
		ds_mais_baixo_4_w,
		ds_mais_baixo_5_w,
		ds_mais_baixo_6_w,
		ds_mais_baixo_7_w
from	atendimento_sinal_vital
where	nr_atendimento = nr_atendimento_p
and		(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
and		coalesce(dt_inativacao::text, '') = ''
and		trunc(dt_sinal_vital) = trunc(dt_referencia_p+1);

select	count(*)
into STRICT	qt_reg_w
from	atendimento_sinal_vital
where	nr_atendimento = nr_atendimento_p
and		(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
and		coalesce(dt_inativacao::text, '') = ''
and		trunc(dt_sinal_vital) = trunc(dt_referencia_p+1);

qt_freq_card_mais_1_w		:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_1_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_1_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_freq_resp_mais_1_w		:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_2_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_2_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_pa_sist_mais_1_w			:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_3_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_3_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_pam_mais_1_w				:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_4_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_4_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_temp_mais_1_w			:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_5_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_5_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
ie_nivel_consc_mais_1_w 	:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_6_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_6_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_sat_o2_mais_1_w			:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_7_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_7_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;

/* ********************************************************************************************************************************** */

select	max(qt_freq_cardiaca),
		max(qt_freq_resp),
		max(qt_pa_sistolica),
		max(qt_pam),
		max(qt_temp),
		max(CASE WHEN ie_nivel_consciencia=0 THEN 'N' WHEN ie_nivel_consciencia=1 THEN 'S' WHEN ie_nivel_consciencia=2 THEN 'N' WHEN ie_nivel_consciencia=3 THEN 'S' END ), -- Verificar
		max(qt_saturacao_o2) -- Verificar
into STRICT	ds_mais_alta_1_w,
		ds_mais_alta_2_w,
		ds_mais_alta_3_w,
		ds_mais_alta_4_w,
		ds_mais_alta_5_w,
		ds_mais_alta_6_w,
		ds_mais_alta_7_w
from	atendimento_sinal_vital
where	nr_atendimento = nr_atendimento_p
and		(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
and		coalesce(dt_inativacao::text, '') = ''
and		trunc(dt_sinal_vital) = trunc(dt_referencia_p+2);

select	min(qt_freq_cardiaca),
		min(qt_freq_resp),
		min(qt_pa_sistolica),
		min(qt_pam),
		min(qt_temp),
		min(CASE WHEN ie_nivel_consciencia=0 THEN 'N' WHEN ie_nivel_consciencia=1 THEN 'S' WHEN ie_nivel_consciencia=2 THEN 'N' WHEN ie_nivel_consciencia=3 THEN 'S' END ), -- Verificar
		min(qt_saturacao_o2) -- Verificar
into STRICT	ds_mais_baixo_1_w,
		ds_mais_baixo_2_w,
		ds_mais_baixo_3_w,
		ds_mais_baixo_4_w,
		ds_mais_baixo_5_w,
		ds_mais_baixo_6_w,
		ds_mais_baixo_7_w
from	atendimento_sinal_vital
where	nr_atendimento = nr_atendimento_p
and		(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
and		coalesce(dt_inativacao::text, '') = ''
and		trunc(dt_sinal_vital) = trunc(dt_referencia_p+2);

select	count(*)
into STRICT	qt_reg_w
from	atendimento_sinal_vital
where	nr_atendimento = nr_atendimento_p
and		(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
and		coalesce(dt_inativacao::text, '') = ''
and		trunc(dt_sinal_vital) = trunc(dt_referencia_p+2);

qt_freq_card_mais_2_w		:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_1_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_1_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_freq_resp_mais_2_w		:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_2_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_2_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_pa_sist_mais_2_w			:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_3_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_3_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_pam_mais_2_w				:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_4_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_4_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_temp_mais_2_w			:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_5_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_5_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
ie_nivel_consc_mais_2_w 	:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_6_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_6_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_sat_o2_mais_2_w			:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_7_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_7_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;

/* ********************************************************************************************************************************** */

select	max(qt_freq_cardiaca),
		max(qt_freq_resp),
		min(qt_pa_sistolica),
		min(qt_pam),
		max(qt_temp),
		max(CASE WHEN ie_nivel_consciencia=0 THEN 'N' WHEN ie_nivel_consciencia=1 THEN 'S' WHEN ie_nivel_consciencia=2 THEN 'N' WHEN ie_nivel_consciencia=3 THEN 'S' END ), -- Verificar
		max(qt_saturacao_o2) -- Verificar
into STRICT	ds_mais_alta_1_w,
		ds_mais_alta_2_w,
		ds_mais_alta_3_w,
		ds_mais_alta_4_w,
		ds_mais_alta_5_w,
		ds_mais_alta_6_w,
		ds_mais_alta_7_w
from	atendimento_sinal_vital
where	nr_atendimento = nr_atendimento_p
and		(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
and		coalesce(dt_inativacao::text, '') = ''
and		trunc(dt_sinal_vital) = trunc(dt_referencia_p+3);

select	max(qt_freq_cardiaca),
		max(qt_freq_resp),
		min(qt_pa_sistolica),
		min(qt_pam),
		max(qt_temp),
		max(CASE WHEN ie_nivel_consciencia=0 THEN 'N' WHEN ie_nivel_consciencia=1 THEN 'S' WHEN ie_nivel_consciencia=2 THEN 'N' WHEN ie_nivel_consciencia=3 THEN 'S' END ), -- Verificar
		max(qt_saturacao_o2) -- Verificar
into STRICT	ds_mais_baixo_1_w,
		ds_mais_baixo_2_w,
		ds_mais_baixo_3_w,
		ds_mais_baixo_4_w,
		ds_mais_baixo_5_w,
		ds_mais_baixo_6_w,
		ds_mais_baixo_7_w
from	atendimento_sinal_vital
where	nr_atendimento = nr_atendimento_p
and		(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
and		coalesce(dt_inativacao::text, '') = ''
and		trunc(dt_sinal_vital) = trunc(dt_referencia_p+3);

select	count(*)
into STRICT	qt_reg_w
from	atendimento_sinal_vital
where	nr_atendimento = nr_atendimento_p
and		(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
and		coalesce(dt_inativacao::text, '') = ''
and		trunc(dt_sinal_vital) = trunc(dt_referencia_p+3);

qt_freq_card_mais_3_w		:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_1_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_1_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_freq_resp_mais_3_w		:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_2_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_2_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_pa_sist_mais_3_w			:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_3_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_3_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_pam_mais_3_w				:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_4_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_4_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_temp_mais_3_w			:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_5_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_5_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
ie_nivel_consc_mais_3_w 	:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_6_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_6_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;
qt_sat_o2_mais_3_w			:= obter_desc_expressao(327347) || ' ' || ds_mais_alta_7_w || obter_desc_expressao(327348) || ' ' || ds_mais_baixo_7_w || obter_desc_expressao(701494) || ' ' || qt_reg_w;

/* ********************************************************************************************************************************** */

Atualiza_FC(	nr_seq_reg_p, qt_freq_card_menos_3_w,	qt_freq_card_menos_2_w,	qt_freq_card_menos_1_w, qt_freq_card_zero_w, 	qt_freq_card_mais_1_w, 	qt_freq_card_mais_2_w, 	qt_freq_card_mais_3_w);
Atualiza_FR(	nr_seq_reg_p, qt_freq_resp_menos_3_w,	qt_freq_resp_menos_2_w,	qt_freq_resp_menos_1_w, qt_freq_resp_zero_w, 	qt_freq_resp_mais_1_w, 	qt_freq_resp_mais_2_w, 	qt_freq_resp_mais_3_w);
Atualiza_PAM(	nr_seq_reg_p, qt_pa_sist_menos_3_w,	qt_pa_sist_menos_2_w,	qt_pa_sist_menos_1_w, 	qt_pa_sist_zero_w, 	qt_pa_sist_mais_1_w, 	qt_pa_sist_mais_2_w, 	qt_pa_sist_mais_3_w);
Atualiza_Sao2(	nr_seq_reg_p, qt_sat_o2_menos_3_w,	qt_sat_o2_menos_2_w,	qt_sat_o2_menos_1_w, 	qt_sat_o2_zero_w, 	qt_sat_o2_mais_1_w, 	qt_sat_o2_mais_2_w, 	qt_sat_o2_mais_3_w);
Atualiza_PA_Sistolica(	nr_seq_reg_p, qt_pa_sist_menos_3_w,	qt_pa_sist_menos_2_w,	qt_pa_sist_menos_1_w, 	qt_pa_sist_zero_w, 	qt_pa_sist_mais_1_w, 	qt_pa_sist_mais_2_w, 	qt_pa_sist_mais_3_w);
Atualiza_Temp_axilar(	nr_seq_reg_p, qt_temp_menos_3_w,	qt_temp_menos_2_w,	qt_temp_menos_1_w, 	qt_temp_zero_w, 	qt_temp_mais_1_w, 	qt_temp_mais_2_w, 	qt_temp_mais_3_w);
Atualiza_nivel_consc(	nr_seq_reg_p, ie_nivel_consc_menos_3_w,	ie_nivel_consc_menos_2_w,ie_nivel_consc_menos_1_w,ie_nivel_consc_zero_w,ie_nivel_consc_mais_1_w,ie_nivel_consc_mais_2_w,ie_nivel_consc_mais_3_w);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gqa_gerar_dados_clinicos ( nr_atendimento_p bigint, nr_seq_reg_p bigint, dt_referencia_p timestamp, nm_usuario_p text) FROM PUBLIC;

