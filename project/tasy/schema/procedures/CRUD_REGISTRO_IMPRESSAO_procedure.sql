-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE crud_registro_impressao ( NM_USUARIO_P text, DS_ARQUIVO_P text DEFAULT NULL, IE_OPERACAO_P text DEFAULT NULL, NR_SEQUENCIA_P bigint DEFAULT NULL, NR_DOCUMENTO_P bigint DEFAULT NULL, CD_DEPARTAMENTO_P bigint DEFAULT NULL, CD_STATUS_P bigint DEFAULT NULL, CD_TIPO_DOCUMENTO_P bigint DEFAULT NULL, CD_PACIENTE_P bigint DEFAULT NULL, CD_TIPO_PACIENTE_P bigint DEFAULT NULL) AS $body$
BEGIN
  IF (IE_OPERACAO_P = 'I') THEN
        insert into REGISTRO_IMPRESSAO( nr_sequencia,
        dt_atualizacao,
        nm_usuario, 
        dt_atualizacao_nrec,
        nm_usuario_nrec,
        ds_arquivo,
        nr_documento,
        cd_departamento,
        cd_status,
        cd_tipo_documento,
        cd_paciente,
        cd_tipo_paciente) 
        values (
        nextval('registro_impressao_seq'),
        clock_timestamp(),
        NM_USUARIO_P,
        clock_timestamp(),
        NM_USUARIO_P,
        DS_ARQUIVO_P,
        NR_DOCUMENTO_P,
        CD_DEPARTAMENTO_P,
        CD_STATUS_P,
        CD_TIPO_DOCUMENTO_P,
        CD_PACIENTE_P,
        CD_TIPO_PACIENTE_P);
        COMMIT;
  END IF;
  IF (IE_OPERACAO_P = 'U') THEN
        update REGISTRO_IMPRESSAO
        SET dt_atualizacao = clock_timestamp(),
        nm_usuario = NM_USUARIO_P,
        ds_arquivo = DS_ARQUIVO_P,
        nr_documento = NR_DOCUMENTO_P,
        cd_departamento = CD_DEPARTAMENTO_P,
        cd_tipo_documento = CD_TIPO_DOCUMENTO_P,
        cd_paciente = CD_PACIENTE_P,
        cd_tipo_paciente = CD_TIPO_PACIENTE_P
        where nr_sequencia = NR_SEQUENCIA_P;
        COMMIT;
  END IF;

  IF (coalesce(IE_OPERACAO_P::text, '') = '' OR (IE_OPERACAO_P != 'I' AND IE_OPERACAO_P != 'U')) THEN
       update REGISTRO_IMPRESSAO
       SET dt_atualizacao = clock_timestamp(),
       nm_usuario = NM_USUARIO_P,
       cd_status = CD_STATUS_P
       where nr_sequencia = NR_SEQUENCIA_P;
       COMMIT;
  END IF;

  IF (IE_OPERACAO_P = 'CANCELPRINT') THEN
       update REGISTRO_IMPRESSAO 
       SET dt_atualizacao = clock_timestamp(),
       nm_usuario_cancel = NM_USUARIO_P,
       dt_cancel = clock_timestamp()
       where nr_sequencia = NR_SEQUENCIA_P;
       COMMIT;
  END IF;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE crud_registro_impressao ( NM_USUARIO_P text, DS_ARQUIVO_P text DEFAULT NULL, IE_OPERACAO_P text DEFAULT NULL, NR_SEQUENCIA_P bigint DEFAULT NULL, NR_DOCUMENTO_P bigint DEFAULT NULL, CD_DEPARTAMENTO_P bigint DEFAULT NULL, CD_STATUS_P bigint DEFAULT NULL, CD_TIPO_DOCUMENTO_P bigint DEFAULT NULL, CD_PACIENTE_P bigint DEFAULT NULL, CD_TIPO_PACIENTE_P bigint DEFAULT NULL) FROM PUBLIC;

