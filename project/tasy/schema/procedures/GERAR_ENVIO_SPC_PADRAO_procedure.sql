-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_envio_spc_padrao ( nr_seq_lote_p bigint, nm_usuario_p text, nr_seq_orgao_cobr_p bigint, cd_estabelecimento_p bigint) AS $body$
DECLARE

ds_conteudo_w           varchar(400);
nr_seq_remessa_w        orgao_cobranca.nr_seq_remessa%type;
ds_entidade_cobr_w      orgao_cobranca.ds_entidade_cobr%type;
ie_tipo_liquidacao_w    lote_orgao_cobranca.ie_tipo_lote%type;
nr_seq_linha_w          bigint := 0;
nr_cpf_w                varchar(25);
cd_pessoa_fisica_w      numeric(25);
dt_emissao_w            varchar(10);
cd_banco_w              varchar(17);
nr_cheque_w             varchar(18);
vl_cheque_w             double precision;
nr_conta_w              varchar(110);
cd_cgc_w                varchar(25);
cd_cgc_estab_w          varchar(25);
ds_uf_w                 varchar(2);
nr_linha_digitavel_w    varchar(180);
cd_barras_w             varchar(160);
dt_vencimento_w         varchar(10);
dt_vencimento_det2_w    varchar(10);
nm_banco_w              varchar(80);
nr_titulo_w             numeric(20);
vl_titulo_w             double precision;
nr_nosso_numero_w       varchar(100);
dt_pagamento_previsto_w varchar(10);
cd_agencia_bancaria_w   varchar(120);
dt_deposito_w           varchar(29);
nr_cpf_det_2_w          varchar(20);
cd_cgc_det_2_w          varchar(20);
cd_pessoa_fisica_det_2_w varchar(20);
dt_registro_w           varchar(10);
vl_debito_w             double precision;
ds_endereco_w           varchar(255);
nr_endereco_w           varchar(20);
ds_complemento_w        varchar(255);
ds_bairro_w             varchar(255);
ds_cep_w                varchar(255);
ds_municipio_w          varchar(255);
nr_ddd_telefone_w       varchar(20);
ds_email_w              varchar(255);
nr_telefone_w           varchar(30);
ds_estabelecimento_w    varchar(255);
cd_carteira_w           varchar(10);
nr_seq_carteira_cobr_w  bigint;
ds_local_pag_bloqueto_w varchar(4000);
cd_estabelecimento_w    varchar(255);
cd_agencia_conta_w      varchar(19);

cheque CURSOR FOR
SELECT 	a.nr_seq_cheque,
        a.nr_seq_cobranca
from 	cheque_cr_orgao_cobr a
where 	a.nr_seq_lote = nr_seq_lote_p

union

select 	a.nr_seq_cheque,
        a.nr_seq_cobranca
from 	cheque_cr_orgao_cobr a
where 	a.nr_seq_lote_exc = nr_seq_lote_p;

    
titulo CURSOR FOR
SELECT 	b.nr_titulo,
        b.nr_seq_cobranca
from 	titulo_receber_orgao_cobr b
where 	b.nr_seq_lote = nr_seq_lote_p

union

select 	b.nr_titulo,
        b.nr_seq_cobranca
from 	titulo_receber_orgao_cobr b
where 	b.nr_seq_lote_exc = nr_seq_lote_p;

vet01 cheque%rowtype;
vet02 titulo%rowtype;

    

BEGIN
    nr_seq_linha_w := nr_seq_linha_w + 1;

    delete from w_envio_orgao_cobranca where nm_usuario = nm_usuario_p;

    select  coalesce(max(nr_seq_remessa), '0'),
            coalesce(max(ds_entidade_cobr), '0')
    into STRICT    nr_seq_remessa_w,
            ds_entidade_cobr_w
    from    orgao_cobranca a
    where   a.nr_sequencia = nr_seq_orgao_cobr_p;

    /* codigo da operacao: "i" ? inclusao  - "e" ? exclusao */

    
    select  CASE WHEN max(ie_tipo_lote)='I' THEN  'I'  ELSE 'E' END 
    into STRICT    ie_tipo_liquidacao_w
    from    lote_orgao_cobranca
    where   nr_sequencia = nr_seq_lote_p;

    /*--------------------------------------------------------------------------|
    |                                HEADER                                     |
    |--------------------------------------------------------------------------*/
    
    ds_conteudo_w := '00' || 
        'REMESSA' || 
        lpad(coalesce(to_char(clock_timestamp(),'DDMMYYYY'),'0'),8,'0') || 
        lpad(nr_seq_remessa_w, 8, '0') || 
        lpad(ds_entidade_cobr_w, 5, '0') || 
        lpad('0',8,'0') || 
        lpad(to_char(clock_timestamp(), 'YYYYMMDD'), 8, '0') || 
        lpad(' ', 321, ' ') || 
        rpad('SPC', 5, ' ') ||
        rpad('12', 2, ' ') ||
        rpad(' ', 10, ' ') || 
        lpad(nr_seq_linha_w, 6, '0');

    insert into w_envio_orgao_cobranca(nr_sequencia,
        nr_seq_lote,
        ds_conteudo,
        dt_atualizacao,
        nm_usuario,
        nr_seq_apres)
    values (nextval('w_envio_orgao_cobranca_seq'),
        nr_seq_lote_p,
        ds_conteudo_w,
        clock_timestamp(),
        nm_usuario_p,
        nr_seq_linha_w);

    nr_seq_linha_w := nr_seq_linha_w+1;

    /*--------------------------------------------------------------------------|
    |                           Detalhe 03 - Cheque                             |
    |--------------------------------------------------------------------------*/
    
    open cheque;
    loop
        fetch cheque into vet01;
    EXIT WHEN NOT FOUND; /* apply on cheque */
    begin
        select  substr(d.nr_cpf, 1, 15),
                substr(c.cd_cgc,1, 15),
                substr(c.cd_pessoa_fisica, 1, 15),
                to_char(c.dt_registro, 'DDMMYYYY'),
                c.cd_banco,
                c.cd_agencia_bancaria,
                c.nr_cheque,
                c.vl_cheque,
                c.nr_conta
        into STRICT 	nr_cpf_w,
                cd_cgc_w,
                cd_pessoa_fisica_w,
                dt_deposito_w,
                cd_banco_w,
                cd_agencia_bancaria_w,
                nr_cheque_w,
                vl_cheque_w,
                nr_conta_w
        from 	pessoa_fisica d,
                cheque_cr c
        where	c.cd_pessoa_fisica	= d.cd_pessoa_fisica
        and 	c.nr_seq_cheque		= vet01.nr_seq_cheque

union

        SELECT  null,
                substr(c.cd_cgc,1, 15),
                substr(c.cd_pessoa_fisica, 1, 15),
                to_char(c.dt_registro, 'DDMMYYYY'),
                c.cd_banco,
                c.cd_agencia_bancaria,
                c.nr_cheque,
                c.vl_cheque,
                c.nr_conta
        from 	pessoa_juridica e,
                cheque_cr c
        where	c.cd_cgc = e.cd_cgc
        and 	c.nr_seq_cheque	= vet01.nr_seq_cheque;



    if (cd_pessoa_fisica_w IS NOT NULL AND cd_pessoa_fisica_w::text <> '') then
                    
        /*--------------------------------------------------------------------------|
        |                           Detalhe 01 - Consumidor                         |
        |--------------------------------------------------------------------------*/
        
        select 	substr(elimina_caractere_especial(obter_razao_social(a.cd_cgc)),1,40),
                a.cd_cgc,
                substr(elimina_caractere_especial(obter_dados_pf_pj(null,a.cd_cgc,'EN')),1,50) ds_endereco,
                substr(obter_dados_pf_pj(null,a.cd_cgc,'NR'),1,5) nr_endereco,
                substr(elimina_caractere_especial(obter_dados_pf_pj(null,a.cd_cgc,'CO')),1,100) ds_complemento,
                substr(elimina_caractere_especial(obter_dados_pf_pj(null,a.cd_cgc,'B')),1,20) ds_bairro,
                substr(obter_dados_pf_pj(null,a.cd_cgc,'CEP'),1,8) ds_cep,
                substr(elimina_caractere_especial(obter_dados_pf_pj(null,a.cd_cgc,'CI')),1,20) ds_municipio,
                substr(obter_dados_pf_pj(null,a.cd_cgc,'UF'),1,2) ds_uf,
                substr(b.nr_ddd_telefone,1,3) nr_ddd_telefone,
                substr(b.nr_telefone,1,15) nr_telefone,
                substr(obter_dados_pf_pj(null,a.cd_cgc,'M'),1,40) ds_email
        into STRICT 	ds_estabelecimento_w,
                cd_cgc_estab_w,
                ds_endereco_w,
                nr_endereco_w,
                ds_complemento_w,
                ds_bairro_w,
                ds_cep_w,
                ds_municipio_w,
                ds_uf_w,
                nr_ddd_telefone_w,
                nr_telefone_w,
                ds_email_w
        from 	estabelecimento a,
                pessoa_juridica b
        where 	a.cd_cgc = b.cd_cgc
        and   	a.cd_estabelecimento = cd_estabelecimento_p;

        ds_conteudo_w := '01' ||
            lpad('0', 8,'0') ||                              -- Praca de Concessao
            rpad(ds_estabelecimento_w, 45, ' ') ||           -- Nome/Razao
            '1' ||                                           -- Tipo documento
            lpad(coalesce(cd_cgc_estab_w, '0'), 15, '0') ||       -- CPF/CNPJ
            lpad(' ', 20, ' ') ||                            -- RG
            lpad(' ', 8, ' ') ||                             -- Data de Nascimento
            lpad(' ', 45, ' ')||                             -- Filiacao
            rpad(coalesce(ds_endereco_w, ' '), 50, ' ') ||        -- Endereco
            rpad(coalesce(nr_endereco_w, ' '), 5, ' ')||          -- Numero
            rpad(coalesce(ds_complemento_w, ' '), 30, ' ') ||     -- Complemento
            rpad(coalesce(ds_bairro_w, ' '), 25, ' ')||           -- Bairro
            lpad(coalesce(ds_cep_w, ' '), 8, '0')||               -- CEP
            rpad(coalesce(ds_municipio_w, ' '), 30, ' ')||        -- Cidade
            rpad(coalesce(ds_uf_w, ' '), 2, ' ') ||               -- UF
            lpad(coalesce(nr_ddd_telefone_w, ' '), 2, '0') ||     -- DDD-telefone
            lpad(' ', 18, ' ') ||                            -- brancos
            lpad(replace(coalesce(nr_telefone_w, ' '), '-', null), 10, '0') || -- numero-telefone
            lpad(coalesce(ds_email_w, ' '), 50, ' ') ||           -- Email
            lpad(' ', 10, ' ') ||                            -- Codigo de Retorno
            lpad(nr_seq_linha_w,6,'0');                      -- Sequencial do Registro
        nr_seq_linha_w := nr_seq_linha_w + 1;
        insert into w_envio_orgao_cobranca(nr_sequencia,
                nr_seq_lote,
                ds_conteudo,
                dt_atualizacao,
                nm_usuario,
                nr_seq_apres)
        values (nextval('w_envio_orgao_cobranca_seq'),
                nr_seq_lote_p,
                ds_conteudo_w,
                clock_timestamp(),
                nm_usuario_p,
                nr_seq_linha_w);

        /*--------------------------------------------------------------------------|
        |                        Detalhe 02 - Pessoa fisica                         |
        |--------------------------------------------------------------------------*/
                 
        select  max(substr(d.nr_cpf, 1, 15)),
                max(substr(c.cd_cgc,1, 15)),
                max(substr(c.cd_pessoa_fisica, 1, 15)),
                max(to_char(c.DT_REGISTRO, 'DDMMYYYY')),
                sum(c.vl_cheque),
                max(to_char(c.dt_vencimento, 'DDMMYYYY'))
        into STRICT    nr_cpf_det_2_w,
                cd_cgc_det_2_w,
                cd_pessoa_fisica_det_2_w,
                dt_registro_w,
                vl_debito_w,
                dt_vencimento_w
        from    pessoa_fisica d,
                cheque_cr c,
                cheque_cr_orgao_cobr a
        where	c.cd_pessoa_fisica	= d.cd_pessoa_fisica
        and     a.nr_seq_lote       = nr_seq_lote_p
        and     c.cd_pessoa_fisica  = cd_pessoa_fisica_w
        and     a.nr_seq_cheque     = c.nr_seq_cheque
        group by c.cd_cgc, c.cd_pessoa_fisica;

        ds_conteudo_w := '02' ||
            '2' ||
            lpad(nr_cpf_det_2_w, 15, '0') ||            -- CPF
            ie_tipo_liquidacao_w ||                     -- Codigo de Operacao
            'C' ||                                      -- Comprador/Fiador/Avalista
            lpad(coalesce(dt_vencimento_w, '0'), 8, '0') ||  -- data vencimento
            lpad(coalesce(dt_registro_w, '0'), 8, '0') ||    -- data registro
            lpad(somente_numero(to_char(coalesce(vl_debito_w, '0'),'99999999999.00')), 13, 0) ||
            lpad('0', 30, '0') ||                       -- Contrato
            lpad(' ', 8, ' ') ||                        -- associado
            lpad(' ', 2, ' ') ||                        -- natureza de inclusao
            lpad(' ', 3, ' ') ||                        -- motivo de exclusao
            lpad('0',15,'0') ||                         -- cpf consumidor
            '2' ||                                      -- tipo documento 2 cpf
            'S' ||                                      -- notificar email
            lpad(' ', 265, ' ') ||                      -- brancos
            lpad(' ', 10, ' ') ||                       -- codigo retorno
            lpad(nr_seq_linha_w,6,'0');                 -- sequencial do registro
        nr_seq_linha_w := nr_seq_linha_w + 1;
        insert into w_envio_orgao_cobranca( nr_sequencia,
            nr_seq_lote,
            ds_conteudo,
            dt_atualizacao,
            nm_usuario,
            nr_seq_apres )
        values ( nextval('w_envio_orgao_cobranca_seq'),
            nr_seq_lote_p,
            ds_conteudo_w,
            clock_timestamp(),
            nm_usuario_p,
            nr_seq_linha_w);

        ds_conteudo_w := '03' ||                         -- tipo registro
            '2' ||                                       -- tipo documento 1 cnpj e 2 cpf
            lpad(nr_cpf_w, 15, '0') ||                   -- CPF
            ie_tipo_liquidacao_w ||                      -- Codigo de Operacao
            lpad(coalesce(dt_deposito_w, '0'), 8, '0') ||     -- DT_EMISSAO
            lpad(cd_banco_w, 3, 0) ||                    -- banco
            lpad(CD_AGENCIA_BANCARIA_w, 5, '0') ||       -- agencia
            lpad(NR_CHEQUE_w, 6,'0') ||                  -- numero do cheque-inicial
            ' ' ||                                       -- DV cheque   
            lpad(NR_CHEQUE_w, 6,'0') ||                  -- numero do cheque-final
            lpad('0', 1,'0') ||                          -- DV cheque final
            lpad('0', 2, '0') ||                         -- Alinea/motivo
            lpad(somente_numero(to_char(vl_cheque_w,'999999999990.00')), 13, 0) ||   -- valor do cheque
            lpad(NR_CONTA_w, 15, '0') ||                        -- conta corrente
            lpad(' ', 2, ' ') ||              -- digito conta
            lpad(' ',8, ' ') ||               -- associado
            lpad(' ', 2, ' ') ||              -- natureza da inclusao
            lpad(' ', 1 , ' ') ||             -- Sim ou nao
            lpad(' ', 282, ' ') ||            -- brancos
            lpad(' ', 10, ' ') ||             -- codigo de retorno
            lpad(nr_seq_linha_w,6,'0');       -- sequencial do registro
                
    elsif (cd_cgc_w IS NOT NULL AND cd_cgc_w::text <> '') then
        
        /*--------------------------------------------------------------------------|
        |                        Detalhe 02 - Consumidor                            |
        |--------------------------------------------------------------------------*/
        
        select 	max(substr(elimina_caractere_especial(obter_razao_social(a.cd_cgc)),1,40)),
                max(a.cd_cgc),
                max(substr(elimina_caractere_especial(obter_dados_pf_pj(null,a.cd_cgc,'EN')),1,50)) ds_endereco,
                max(substr(obter_dados_pf_pj(null,a.cd_cgc,'NR'),1,5)) nr_endereco,
                max(substr(elimina_caractere_especial(obter_dados_pf_pj(null,a.cd_cgc,'CO')),1,100)) ds_complemento,
                max(substr(elimina_caractere_especial(obter_dados_pf_pj(null,a.cd_cgc,'B')),1,20)) ds_bairro,
                max(substr(obter_dados_pf_pj(null,a.cd_cgc,'CEP'),1,8)) ds_cep,
                max(substr(elimina_caractere_especial(obter_dados_pf_pj(null,a.cd_cgc,'CI')),1,20)) ds_municipio,
                max(substr(obter_dados_pf_pj(null,a.cd_cgc,'UF'),1,2)) ds_uf,
                max(substr(b.nr_ddd_telefone,1,3)) nr_ddd_telefone,
                max(substr(b.nr_telefone,1,15)) nr_telefone,
                max(substr(obter_dados_pf_pj(null,a.cd_cgc,'M'),1,40)) ds_email
        into STRICT 	ds_estabelecimento_w,
                cd_cgc_estab_w,
                ds_endereco_w,
                nr_endereco_w,
                ds_complemento_w,
                ds_bairro_w,
                ds_cep_w,
                ds_municipio_w,
                ds_uf_w,
                nr_ddd_telefone_w,
                nr_telefone_w,
                ds_email_w
        from 	estabelecimento a,
                pessoa_juridica b
        where 	a.cd_cgc                = b.cd_cgc
        and   	a.cd_estabelecimento    = cd_estabelecimento_p;

     
        ds_conteudo_w := '01' ||
                lpad('0', 8,'0') ||                              -- Praca de Concessao
                rpad(ds_estabelecimento_w, 45, ' ') ||           -- Nome/Razao
                '1' ||                                           -- Tipo documento
                lpad(coalesce(cd_cgc_estab_w, '0'), 15, '0') ||       -- CPF/CNPJ
                lpad(' ', 20, ' ') ||                            -- RG
                lpad(' ', 8, ' ') ||                             -- Data de Nascimento
                lpad(' ', 45, ' ')||                             -- Filiacao
                rpad(coalesce(ds_endereco_w, ' '), 50, ' ') ||        -- Endereco
                rpad(coalesce(nr_endereco_w, ' '), 5, ' ')||          -- Numero
                rpad(coalesce(ds_complemento_w, ' '), 30, ' ') ||     -- Complemento
                rpad(coalesce(ds_bairro_w, ' '), 25, ' ')||           -- Bairro
                lpad(coalesce(ds_cep_w, ' '), 8, '0')||               -- CEP
                rpad(coalesce(ds_municipio_w, ' '), 30, ' ')||        -- Cidade
                rpad(coalesce(ds_uf_w, ' '), 2, ' ') ||               -- UF
                lpad(coalesce(nr_ddd_telefone_w, ' '), 2, '0') ||     -- DDD-telefone
                lpad(' ', 18, ' ') ||                            -- brancos
                lpad(replace(coalesce(nr_telefone_w, ' '), '-', null), 10, '0') ||  -- numero-telefone
                lpad(coalesce(ds_email_w, ' '), 50, ' ') ||           -- Email
                lpad(' ', 10, ' ') ||                            -- Codigo de Retorno
                lpad(nr_seq_linha_w,6,'0');                      -- Sequencial do Registro
        nr_seq_linha_w := nr_seq_linha_w + 1;
        insert into w_envio_orgao_cobranca( nr_sequencia,
            nr_seq_lote,
            ds_conteudo,
            dt_atualizacao,
            nm_usuario,
            nr_seq_apres)
        values (nextval('w_envio_orgao_cobranca_seq'),
            nr_seq_lote_p,
            ds_conteudo_w,
            clock_timestamp(),
            nm_usuario_p,
            nr_seq_linha_w);

        /*--------------------------------------------------------------------------|
        |                     Detalhe 02 - DPC Pessoa juridica                      |
        |--------------------------------------------------------------------------*/
        
        select  substr(c.cd_cgc,1, 15),
                substr(c.cd_pessoa_fisica, 1, 15),
                max(to_char(c.DT_REGISTRO, 'DDMMYYYY')),
                sum(c.vl_cheque),
                max(to_char(c.dt_vencimento, 'DDMMYYYY'))
        into STRICT    cd_cgc_det_2_w,
                cd_pessoa_fisica_det_2_w,
                dt_registro_w,
                vl_debito_w,
                dt_vencimento_w
        from    pessoa_juridica d,
                cheque_cr c,
                cheque_cr_orgao_cobr a
        where   c.cd_cgc	    = d.cd_cgc
        and     a.nr_seq_lote   = nr_seq_lote_p
        and     c.cd_cgc        = cd_cgc_w
        and     a.nr_seq_cheque = c.nr_seq_cheque
        group by c.cd_cgc, c.cd_pessoa_fisica;

        ds_conteudo_w := '02' ||
            '1' ||
            lpad(coalesce(cd_cgc_det_2_w, '0'), 15, '0') ||      -- CPF
            ie_tipo_liquidacao_w ||                         -- Codigo de Operacao
            'C' ||                                          -- Comprador/Fiador/Avalista
            lpad(coalesce(dt_vencimento_w, '0'), 8, '0') ||      -- data vencimento
            lpad(coalesce(dt_registro_w, '0'), 8, '0') ||        -- data registro
            lpad(somente_numero(to_char(coalesce(vl_debito_w, '0'),'99999999999.00')), 13, 0) || -- valor debito
            lpad('0', 30, '0') ||                           -- Contrato
            lpad(' ', 8, ' ') ||                            -- associado
            lpad(' ', 2, ' ') ||                            -- natureza de inclusao
            lpad(' ', 3, ' ') ||                            -- motivo de exclusao
            lpad('0',15,'0') ||                             -- cpf consumidor
            '1' ||                                          -- tipo documento 1 cnpj
            'S' ||                                          -- notificar email
            lpad(' ', 265, ' ') ||                          -- brancos
            lpad(' ', 10, ' ') ||                           -- codigo retorno
            lpad(nr_seq_linha_w,6,'0');                     -- sequencial do registro
            nr_seq_linha_w := nr_seq_linha_w + 1;
            insert into w_envio_orgao_cobranca( nr_sequencia,
                nr_seq_lote,
                ds_conteudo,
                dt_atualizacao,
                nm_usuario,
                nr_seq_apres)
            values ( nextval('w_envio_orgao_cobranca_seq'),
                nr_seq_lote_p,
                ds_conteudo_w,
                clock_timestamp(),
                nm_usuario_p,
                nr_seq_linha_w );

        ds_conteudo_w := '03' ||                                -- tipo registro
            '1' ||                                              -- tipo documento 1 cnpj e 2 cpf
            lpad(cd_cgc_w, 15, '0') ||                          -- CPF
            ie_tipo_liquidacao_w ||                             -- Codigo de Operacao
            lpad(coalesce(dt_deposito_w, '0'), 8, '0') ||            -- DT_EMISSAO
            lpad(cd_banco_w, 3, '0') ||                         -- banco
            lpad(CD_AGENCIA_BANCARIA_w, 5, '0') ||              -- agencia
            lpad(NR_CHEQUE_w, 6, '0') ||      -- numero do cheque-inicial
            ' ' ||                            -- DV cheque inicial   
            lpad(NR_CHEQUE_w, 6,'0') ||       -- numero do cheque-final
            ' ' ||                            -- DV cheque final
            lpad('00', 2, '00') ||            -- Alinea/motivo
            lpad(somente_numero(to_char(vl_cheque_w,'999999999990.00')), 13, 0) ||
            lpad(NR_CONTA_w, 15, '0') ||      -- conta corrente
            lpad('0', 2, '0') ||              -- digito conta
            lpad(' ',8, ' ') ||               -- associado
            lpad(' ', 2, ' ') ||              -- natureza da inclusao
            lpad(' ', 1 , ' ') ||             -- Sim ou nao
            lpad(' ', 282, ' ') ||            -- brancos
            lpad(' ', 10, ' ') ||             -- codigo de retorno
            lpad(nr_seq_linha_w,6,'0');       -- sequencial do registro
        end if;

        nr_seq_linha_w := nr_seq_linha_w + 1;
        insert into w_envio_orgao_cobranca( nr_sequencia,
            nr_seq_lote,
            ds_conteudo,
            dt_atualizacao,
            nm_usuario,
            nr_seq_apres)
        values (nextval('w_envio_orgao_cobranca_seq'),
            nr_seq_lote_p,
            ds_conteudo_w,
            clock_timestamp(),
            nm_usuario_p,
            nr_seq_linha_w);
        end;
    end loop;
    close cheque;

    /*--------------------------------------------------------------------------|
    |                               Titulo                                      |
    |--------------------------------------------------------------------------*/
    
    open titulo;
    loop
        fetch titulo into vet02;
        EXIT WHEN NOT FOUND; /* apply on titulo */
        begin
            select  max(lpad(coalesce(c.cd_banco, '0'), 3, '0')) cd_banco,
                    max(lpad(coalesce('0', 0), 30,' ')) nm_banco,
                    max(lpad(coalesce(substr(converte_codigo_Bloqueto('Barra_Editado', c.nr_bloqueto),1,255), ' '),60, ' ')) nr_linha_digitavel,
                    max(lpad(coalesce(c.nr_bloqueto, 0),44, '0')) cd_barras,
                    max(to_char(c.dt_vencimento, 'DDMMYYYY')) dt_vencimento,
                    max(coalesce(d.cd_pessoa_fisica,0)) cd_pessoa_fisica,
                    max(null),
                    max(to_char(dt_emissao, 'ddmmyyyy')) dt_emissao,
                    max(c.nr_titulo) nr_titulo,
                    max(to_char(dt_pagamento_previsto, 'ddmmyyyy')) dt_pagamento_previsto,
                    max(coalesce(c.nr_nosso_numero,0)) nr_nosso_numero,
                    max(c.vl_saldo_titulo) vl_saldo_titulo,
                    max(c.nr_seq_carteira_cobr)
            into STRICT    cd_banco_w,
                    nm_banco_w,
                    nr_linha_digitavel_w,
                    cd_barras_w,
                    dt_vencimento_w,
                    cd_pessoa_fisica_w,
                    cd_cgc_w,
                    dt_emissao_w,
                    nr_titulo_w,
                    dt_pagamento_previsto_w,
                    nr_nosso_numero_w,
                    vl_titulo_w,
                    nr_seq_carteira_cobr_w
            FROM moeda m, pessoa_fisica d, titulo_receber c
LEFT OUTER JOIN banco b ON (c.cd_banco = b.cd_banco)
WHERE c.cd_pessoa_fisica  = d.cd_pessoa_fisica  and c.cd_moeda          = m.cd_moeda and c.nr_titulo         = vet02.nr_titulo group by 1

union
 -------- PESSOA JURIDICA
            SELECT  max(lpad(coalesce(c.cd_banco, '0'), 3, '0')) cd_banco ,
                    max(lpad(coalesce('0', 0), 30,' ')) nm_banco,
                    max(lpad(coalesce(substr(converte_codigo_Bloqueto('Barra_Editado', c.nr_bloqueto),1,255), ' '),60, ' ')) nr_linha_digitavel,
                    max(lpad(coalesce(c.nr_bloqueto, 0),44, '0')) cd_barras,
                    max(lpad(to_char(c.dt_vencimento, 'DDMMYYYY'), 10, ' ')) dt_vencimento,
                    max(null),
                    max(coalesce(d.cd_cgc,0)) cd_cgc,
                    max(to_char(dt_emissao, 'ddmmyyyy')) dt_emissao,
                    max(c.nr_titulo) nr_titulo,
                    max(to_char(dt_pagamento_previsto, 'ddmmyyyy')) dt_pagamento_previsto,
                    max(coalesce(c.nr_nosso_numero,0)) nr_nosso_numero,
                    max(c.vl_saldo_titulo) vl_saldo_titulo,
                    max(c.nr_seq_carteira_cobr)
            FROM moeda m, pessoa_juridica d, titulo_receber c
LEFT OUTER JOIN banco b ON (c.cd_banco = b.cd_banco)
WHERE c.cd_cgc             = d.cd_cgc  and c.cd_moeda           = m.cd_moeda and c.nr_titulo          = vet02.nr_titulo group by 1;

		if (cd_pessoa_fisica_w IS NOT NULL AND cd_pessoa_fisica_w::text <> '') then
            
            /*--------------------------------------------------------------------------|
            |                           Detalhe 01 - Consumidor                         |
            |--------------------------------------------------------------------------*/
            
            select  max(substr(elimina_caractere_especial(obter_razao_social(a.cd_cgc)),1,40)),
                    max(a.cd_cgc),
                    max(substr(elimina_caractere_especial(obter_dados_pf_pj(null,a.cd_cgc,'EN')),1,50)) ds_endereco,
                    max(substr(obter_dados_pf_pj(null,a.cd_cgc,'NR'),1,5)) nr_endereco,
                    max(substr(elimina_caractere_especial(obter_dados_pf_pj(null,a.cd_cgc,'CO')),1,100)) ds_complemento,
                    max(substr(elimina_caractere_especial(obter_dados_pf_pj(null,a.cd_cgc,'B')),1,20)) ds_bairro,
                    max(substr(obter_dados_pf_pj(null,a.cd_cgc,'CEP'),1,8)) ds_cep,
                    max(substr(elimina_caractere_especial(obter_dados_pf_pj(null,a.cd_cgc,'CI')),1,20)) ds_municipio,
                    max(substr(obter_dados_pf_pj(null,a.cd_cgc,'UF'),1,2)) ds_uf,
                    max(substr(b.nr_ddd_telefone,1,3)) nr_ddd_telefone,
                    max(substr(b.nr_telefone,1,15)) nr_telefone,
                    max(substr(obter_dados_pf_pj(null,a.cd_cgc,'M'),1,40)) ds_email
            into STRICT    ds_estabelecimento_w,
                    cd_cgc_w,
                    ds_endereco_w,
                    nr_endereco_w,
                    ds_complemento_w,
                    ds_bairro_w,
                    ds_cep_w,
                    ds_municipio_w,
                    ds_uf_w,
                    nr_ddd_telefone_w,
                    nr_telefone_w,
                    ds_email_w
            from 	estabelecimento a,
                        pessoa_juridica b
            where 	a.cd_cgc            = b.cd_cgc
            and   	a.cd_estabelecimento= cd_estabelecimento_p;

            ds_conteudo_w := '01' ||
                lpad('0', 8,'0') ||                              -- Praca de Concessao
                rpad(ds_estabelecimento_w, 45, ' ') ||           -- Nome/Razao
                '1' ||                                           -- Tipo documento
                lpad(coalesce(cd_cgc_w, '0'), 15, '0') ||             -- CPF/CNPJ
                lpad(' ', 20, ' ') ||                            -- RG
                lpad(' ', 8, ' ') ||                             -- Data de Nascimento
                lpad(' ', 45, ' ')||                             -- Filiacao
                rpad(coalesce(ds_endereco_w, ' '), 50, ' ') ||        -- Endereco
                rpad(coalesce(nr_endereco_w, ' '), 5, ' ')||          -- Numero
                rpad(coalesce(ds_complemento_w, ' '), 30, ' ') ||     -- Complemento
                rpad(coalesce(ds_bairro_w, ' '), 25, ' ')||           -- Bairro
                lpad(coalesce(ds_cep_w, ' '), 8, '0')||               -- CEP
                rpad(coalesce(ds_municipio_w, ' '), 30, ' ')||        -- Cidade
                rpad(coalesce(ds_uf_w, ' '), 2, ' ') ||               -- UF
                lpad(coalesce(nr_ddd_telefone_w, ' '), 2, '0') ||     -- DDD-telefone
                lpad(' ', 18, ' ') ||                            -- brancos
                lpad(replace(coalesce(nr_telefone_w, ' '), '-', null), 10, '0') ||  -- numero-telefone
                lpad(coalesce(ds_email_w, ' '), 50, ' ') ||           -- Email
                lpad(' ', 10, ' ') ||                            -- Codigo de Retorno
                lpad(nr_seq_linha_w,6,'0');                      -- Sequencial do Registro
            nr_seq_linha_w := nr_seq_linha_w + 1;
            insert into w_envio_orgao_cobranca( nr_sequencia,
                    nr_seq_lote,
                    ds_conteudo,
                    dt_atualizacao,
                    nm_usuario,
                    nr_seq_apres) values (
                    nextval('w_envio_orgao_cobranca_seq'),
                    nr_seq_lote_p,
                    ds_conteudo_w,
                    clock_timestamp(),
                    nm_usuario_p,
                    nr_seq_linha_w);

            select  max(coalesce(d.nr_cpf, '0')),
                    max(substr(c.cd_cgc,1, 15)),
                    max(substr(c.cd_pessoa_fisica, 1, 15)),
                    max(to_char(c.DT_EMISSAO, 'DDMMYYYY')),
                    sum(c.vl_saldo_titulo),
                    max(to_char(c.dt_vencimento, 'DDMMYYYY'))
            into STRICT    nr_cpf_det_2_w,
                    cd_cgc_det_2_w,
                    cd_pessoa_fisica_det_2_w,
                    dt_registro_w,
                    vl_debito_w,
                    dt_vencimento_det2_w
            from    pessoa_fisica d,
                    titulo_receber c,
                    titulo_receber_orgao_cobr a
            where	c.cd_pessoa_fisica	= d.cd_pessoa_fisica
            and     a.nr_seq_lote       = nr_seq_lote_p
            and     a.nr_titulo         = c.nr_titulo
            and     d.cd_pessoa_fisica  = cd_pessoa_fisica_w;

            ds_conteudo_w := '02' ||
                '2' ||
                lpad(nr_cpf_det_2_w, 15, '0') ||                -- CPF
                ie_tipo_liquidacao_w ||                         -- Codigo de Operacao
                'C' ||                                          -- Comprador/Fiador/Avalista
                lpad(coalesce(dt_vencimento_det2_w, '0'), 8, '0') || -- data vencimento
                lpad(coalesce(dt_registro_w, '0'), 8, '0') ||        -- data registro 
                lpad(somente_numero(to_char(vl_debito_w,'999999999990.00')), 13, 0) || -- valor debito
                lpad('0', 30, '0') ||         -- Contrato
                lpad(' ', 8, ' ') ||          -- associado
                lpad(' ', 2, ' ') ||          -- natureza de inclusao
                lpad(' ', 3, ' ') ||          -- motivo de exclusao
                lpad('0',15,'0') ||           -- cpf consumidor
                '2' ||                        -- tipo documento 2 cpf
                'S' ||                        -- notificar email
                lpad(' ', 265, ' ') ||        -- brancos
                lpad(' ', 10, ' ') ||         -- codigo retorno
                lpad(nr_seq_linha_w,6,'0');   -- sequencial do registro
            nr_seq_linha_w := nr_seq_linha_w + 1;
            insert
            into w_envio_orgao_cobranca(nr_sequencia,
                nr_seq_lote,
                ds_conteudo,
                dt_atualizacao,
                nm_usuario,
                nr_seq_apres)
            values (nextval('w_envio_orgao_cobranca_seq'),
                nr_seq_lote_p,
                ds_conteudo_w,
                clock_timestamp(),
                nm_usuario_p,
                nr_seq_linha_w);

        elsif (cd_cgc_w IS NOT NULL AND cd_cgc_w::text <> '') then
            
        /*--------------------------------------------------------------------------|
        |                           Detalhe 01 - Consumidor                         |
        |--------------------------------------------------------------------------*/
        
            select  max(substr(elimina_caractere_especial(obter_razao_social(a.cd_cgc)),1,40)),
                    max(a.cd_cgc),
                    max(substr(elimina_caractere_especial(obter_dados_pf_pj(null,a.cd_cgc,'EN')),1,50)) ds_endereco,
                    max(substr(obter_dados_pf_pj(null,a.cd_cgc,'NR'),1,5)) nr_endereco,
                    max(substr(elimina_caractere_especial(obter_dados_pf_pj(null,a.cd_cgc,'CO')),1,100)) ds_complemento,
                    max(substr(elimina_caractere_especial(obter_dados_pf_pj(null,a.cd_cgc,'B')),1,20)) ds_bairro,
                    max(substr(obter_dados_pf_pj(null,a.cd_cgc,'CEP'),1,8)) ds_cep,
                    max(substr(elimina_caractere_especial(obter_dados_pf_pj(null,a.cd_cgc,'CI')),1,20)) ds_municipio,
                    max(substr(obter_dados_pf_pj(null,a.cd_cgc,'UF'),1,2)) ds_uf,
                    max(substr(b.nr_ddd_telefone,1,3)) nr_ddd_telefone,
                    max(substr(b.nr_telefone,1,15)) nr_telefone,
                    max(substr(obter_dados_pf_pj(null,a.cd_cgc,'M'),1,40)) ds_email
            into STRICT 	ds_estabelecimento_w,
                    cd_cgc_estab_w,
                    ds_endereco_w,
                    nr_endereco_w,
                    ds_complemento_w,
                    ds_bairro_w,
                    ds_cep_w,
                    ds_municipio_w,
                    ds_uf_w,
                    nr_ddd_telefone_w,
                    nr_telefone_w,
                    ds_email_w
            from 	estabelecimento a,
                    pessoa_juridica b
            where 	a.cd_cgc            = b.cd_cgc
            and   	a.cd_estabelecimento= cd_estabelecimento_p;

            ds_conteudo_w := '01' ||
                lpad('0', 8,'0') ||                     -- Praca de Concessao
                rpad(ds_estabelecimento_w, 45, ' ') ||  -- Nome/Razao
                '1' ||                                  -- Tipo documento
                lpad(coalesce(cd_cgc_estab_w, '0'), 15, '0') ||    -- CPF/CNPJ
                lpad(' ', 20, ' ') ||                   -- RG
                lpad(' ', 8, ' ') ||                    -- Data de Nascimento
                lpad(' ', 45, ' ')||                    -- Filiacao
                rpad(coalesce(ds_endereco_w, ' '), 50, ' ') ||        -- Endereco
                rpad(coalesce(nr_endereco_w, ' '), 5, ' ')||          -- Numero
                rpad(coalesce(ds_complemento_w, ' '), 30, ' ') ||     -- Complemento
                rpad(coalesce(ds_bairro_w, ' '), 25, ' ')||           -- Bairro
                lpad(coalesce(ds_cep_w, ' '), 8, '0')||               -- CEP
                rpad(coalesce(ds_municipio_w, ' '), 30, ' ')||        -- Cidade
                rpad(coalesce(ds_uf_w, ' '), 2, ' ') ||               -- UF
                lpad(coalesce(nr_ddd_telefone_w, ' '), 2, '0') ||     -- DDD-telefone
                lpad(' ', 18, ' ') ||                            -- brancos
                lpad(replace(coalesce(nr_telefone_w, ' '), '-', null), 10, '0') ||-- numero-telefone
                lpad(coalesce(ds_email_w, ' '), 50, ' ') ||            -- Email
                lpad(' ', 10, ' ') ||                             -- Codigo de Retorno
                lpad(nr_seq_linha_w,6,'0');                       -- Sequencial do Registro
            nr_seq_linha_w := nr_seq_linha_w + 1;
            insert into w_envio_orgao_cobranca(nr_sequencia,
                nr_seq_lote,
                ds_conteudo,
                dt_atualizacao,
                nm_usuario,
                nr_seq_apres)
            values (nextval('w_envio_orgao_cobranca_seq'),
                nr_seq_lote_p,
                ds_conteudo_w,
                clock_timestamp(),
                nm_usuario_p,
                nr_seq_linha_w);

            select  max(substr(c.cd_cgc,1, 15)),
                    max(substr(c.cd_pessoa_fisica, 1, 15)),
                    max(to_char(c.DT_EMISSAO, 'DDMMYYYY')),
                    sum(c.vl_saldo_titulo),
                    max(to_char(c.dt_vencimento, 'DDMMYYYY'))
            into STRICT    cd_cgc_det_2_w,
                    cd_pessoa_fisica_det_2_w,
                    dt_registro_w,
                    vl_debito_w,
                    dt_vencimento_det2_w
            from    pessoa_juridica d,
                    titulo_receber c,
                    titulo_receber_orgao_cobr a
            where   c.cd_cgc	    = d.cd_cgc
            and     a.nr_seq_lote   = nr_seq_lote_p
            and     a.nr_titulo     = c.nr_titulo
            and     d.cd_cgc        = cd_cgc_w;

            ds_conteudo_w := '02' ||
                '1' ||
                lpad(cd_cgc_det_2_w, 15, '0') ||          -- CNPJ
                ie_tipo_liquidacao_w ||                   -- Codigo de Operacao
                'C' ||                                    -- Comprador/Fiador/Avalista
                lpad(coalesce(dt_vencimento_det2_w, '0'), 8, '0') ||  -- data vencimento
                lpad(coalesce(dt_registro_w, '0'), 8, '0') ||         -- data registro
                lpad(somente_numero(to_char(vl_debito_w,'999999999990.00')), 13, 0) || -- valor debito
                lpad('0', 30, '0') ||   -- Contrato
                lpad(' ', 8, ' ') ||    -- associado
                lpad(' ', 2, ' ') ||    -- natureza de inclusao
                lpad(' ', 3, ' ') ||    -- motivo de exclusao
                lpad('0',15,'0') ||     -- cpf consumidor
                '1' ||                  -- tipo documento 2 cnpj
                'S' ||                  -- notificar email
                lpad(' ', 265, ' ') ||  -- brancos
                lpad(' ', 10, ' ') ||   -- codigo retorno
                lpad(nr_seq_linha_w,6,'0');  -- sequencial do registro
            nr_seq_linha_w := nr_seq_linha_w + 1;
            insert into w_envio_orgao_cobranca(nr_sequencia,
                nr_seq_lote,
                ds_conteudo,
                dt_atualizacao,
                nm_usuario,
                nr_seq_apres)
            values (nextval('w_envio_orgao_cobranca_seq'),
                nr_seq_lote_p,
                ds_conteudo_w,
                clock_timestamp(),
                nm_usuario_p,
                nr_seq_linha_w);
            end if;

            select max(ds_local_pag_bloqueto)
            into STRICT   ds_local_pag_bloqueto_w
            from   parametro_contas_receber 
            where  cd_estabelecimento = cd_estabelecimento_p;

            select  rpad(coalesce(max(b.cd_banco), '0'), 3, '0'),
                    rpad(coalesce(max(elimina_caractere_especial(b.ds_banco)), ' '), 30,' ')
            into STRICT    cd_banco_w,
                    nm_banco_w
            from    titulo_receber c,
                    BANCO_ESTABELECIMENTO a,
                    banco b,
                    agencia_bancaria d
            where   c.nr_seq_conta_banco   = a.nr_sequencia
            and     a.cd_banco             = b.cd_banco
            and     d.cd_agencia_bancaria  = a.cd_agencia_bancaria
            and     nr_titulo              = nr_titulo_w;

            /*--------------------------------------------------------------------------|
            |          Detalhe 10 - Linha 1 de Boleto (5 linhas: 10 a 14)               |
            |--------------------------------------------------------------------------*/
            
            ds_conteudo_w  := '10' ||           -- tipo de registro
                lpad(cd_banco_w, 3, '0') ||     -- codigo banco
                '0' ||                          -- digito do codigo banco
                nm_banco_w ||                   -- nome banco
                rpad(elimina_caractere_especial(nr_linha_digitavel_w), 60, ' ') ||         -- linha digitavel
                cd_barras_w ||                  -- codigo barras
                rpad(coalesce(elimina_caractere_especial(ds_local_pag_bloqueto_w), ' '), 84,' ')|| -- local pagamento
                lpad(' ', 7, ' ')||             -- parcela
                rpad(dt_vencimento_w, 10, ' ') ||               -- data vencimento
                rpad(ds_estabelecimento_w, 84, ' ')|| --cedente/beneficiario
                lpad(' ', 49, ' ')||            -- brancos 
                lpad('0', 10, '0') ||           -- codigo de retorno
                lpad(nr_seq_linha_w, 6, '0');   -- sequencial do registro
            nr_seq_linha_w := nr_seq_linha_w + 1;
            insert into w_envio_orgao_cobranca(nr_sequencia,
                nr_seq_lote,
                ds_conteudo,
                dt_atualizacao,
                nm_usuario,
                nr_seq_apres)
            values (nextval('w_envio_orgao_cobranca_seq'),
                nr_seq_lote_p,
                ds_conteudo_w,
                clock_timestamp(),
                nm_usuario_p,
                nr_seq_linha_w);

            /* Busca a carteira do titulo */

            
            if (nr_seq_carteira_cobr_w IS NOT NULL AND nr_seq_carteira_cobr_w::text <> '') then
            
                select  max(a.cd_carteira)
                into STRICT    cd_carteira_w
                from    banco_carteira a, 
                        titulo_receber c
                where   c.nr_seq_carteira_cobr = a.nr_sequencia
                and     c.nr_titulo            = nr_titulo_w;
            end if;

            if ((cd_banco_w IS NOT NULL AND cd_banco_w::text <> '') or cd_banco_w <> 000) then

                select 	max(substr(coalesce(a.cd_agencia_conta, '0'), 1, 19)),
                        max(coalesce(obter_nosso_numero_banco(coalesce(cd_banco_w, 0), a.nr_titulo), '0')),
                        max(coalesce(a.cd_carteira,'0')),
                        max(coalesce(a.vl_saldo_titulo, '0'))
                into STRICT    cd_agencia_conta_w,
                        nr_nosso_numero_w,
                        cd_carteira_w,
                        vl_titulo_w
                from  	parametro_contas_receber b,
                        titulo_receber_bloq_v a
                where 	a.nr_titulo           = nr_titulo_w
                and 	a.cd_estabelecimento  = b.cd_estabelecimento;
            end if;

            /*--------------------------------------------------------------------------|
            |          Detalhe 11 - Linha 2 de Boleto (5 linhas: 10 a 14)               |
            |--------------------------------------------------------------------------*/
            
            ds_conteudo_w  := '11' ||                               -- tipo de registro
                lpad(coalesce(elimina_caractere_especial(cd_agencia_conta_w), ' '), 19, '0') ||      -- agencia/cod cedente/beneficiario
                rpad(dt_emissao_w, 10, ' ') ||                      -- data documento
                lpad(coalesce(nr_titulo_w, '0'), 13, 0) ||               -- numero documento
                rpad('R$', 4, ' ')||                                -- especie documento
                lpad(' ', 3, ' ') ||                                -- aceite
                rpad(dt_pagamento_previsto_w, 10, ' ') ||           -- data processamento
                rpad(coalesce(nr_nosso_numero_w, ' '), 25, ' ') ||       -- nosso numero
                lpad(' ', 4, ' ') ||                                -- uso do banco
                rpad(coalesce(cd_carteira_w, ' '), 8 , ' ') ||           -- carteira
                rpad('R$', 10, ' ') ||                              -- moeda
                lpad(' ', 5, ' ') ||                                -- quantidade  
                lpad('0', 14, '0') ||                               -- valor
                lpad(somente_numero(to_char(vl_titulo_w,'99999999999.00')), 14, 0) ||  -- valor documento
                lpad(' ', 98, ' ') ||                         -- instrucao 1
                lpad(' ', 98, ' ') ||                         -- instrucao 2
                lpad(' ', 37, ' ') ||                         -- brancos
                lpad(' ', 10, ' ') ||                         -- codigo de retorno
                lpad(nr_seq_linha_w,6,'0');                   -- sequencial do registro
            nr_seq_linha_w := nr_seq_linha_w + 1;
            insert into w_envio_orgao_cobranca(nr_sequencia,
                nr_seq_lote,
                ds_conteudo,
                dt_atualizacao,
                nm_usuario,
                nr_seq_apres)
            values (nextval('w_envio_orgao_cobranca_seq'),
                nr_seq_lote_p,
                ds_conteudo_w,
                clock_timestamp(),
                nm_usuario_p,
                nr_seq_linha_w);

            /*--------------------------------------------------------------------------|
            |          Detalhe 12 - Linha 3 de Boleto (5 linhas: 10 a 14)               |
            |--------------------------------------------------------------------------*/
            
            ds_conteudo_w  := '12' ||       -- tipo de registro
                lpad(' ', 98, ' ') ||       -- instrucao 3
                lpad(' ', 98, ' ') ||       -- instrucao 4
                lpad(' ', 98, ' ') ||       -- instrucao 5
                lpad(' ', 78, ' ') ||       -- brancos
                lpad(' ', 10, ' ') ||       -- codigo de retorno
                lpad(nr_seq_linha_w,6,'0'); -- sequencial do registro
            nr_seq_linha_w := nr_seq_linha_w + 1;
            insert into w_envio_orgao_cobranca(nr_sequencia,
                nr_seq_lote,
                ds_conteudo,
                dt_atualizacao,
                nm_usuario,
                nr_seq_apres)
            values (nextval('w_envio_orgao_cobranca_seq'),
                nr_seq_lote_p,
                ds_conteudo_w,
                clock_timestamp(),
                nm_usuario_p,
                nr_seq_linha_w);

            /*--------------------------------------------------------------------------|
            |          Detalhe 13 - Linha 4 de Boleto (5 linhas: 10 a 14)               |
            |--------------------------------------------------------------------------*/
            
            ds_conteudo_w  := '13' ||       -- tipo de registro
                lpad(' ', 98, ' ') ||       -- instrucao 6
                lpad(' ', 98, ' ') ||       -- instrucao 7
                lpad(' ', 98, ' ') ||       -- instrucao 8
                lpad(' ', 78, ' ') ||       -- brancos
                lpad(' ', 10, ' ') ||       -- codigo de retorno
                lpad(nr_seq_linha_w,6,'0'); -- sequencial do registro
            nr_seq_linha_w := nr_seq_linha_w + 1;
            insert into w_envio_orgao_cobranca( nr_sequencia,
                nr_seq_lote,
                ds_conteudo,
                dt_atualizacao,
                nm_usuario,
                nr_seq_apres)
            values (nextval('w_envio_orgao_cobranca_seq'),
                nr_seq_lote_p,
                ds_conteudo_w,
                clock_timestamp(),
                nm_usuario_p,
                nr_seq_linha_w);

            /*--------------------------------------------------------------------------|
            |          Detalhe 14 - Linha 5 de Boleto (5 linhas: 10 a 14)               |
            |--------------------------------------------------------------------------*/
            
            ds_conteudo_w  := '14'  ||      -- tipo de registro
                lpad(' ', 98, ' ')  ||      -- instrucao 9
                lpad(' ', 274, ' ') ||      -- brancos
                lpad(' ', 10, ' ')  ||      -- codigo de retorno
                lpad(nr_seq_linha_w,6,'0'); -- sequencial do registro
            nr_seq_linha_w := nr_seq_linha_w + 1;
            insert into w_envio_orgao_cobranca(nr_sequencia,
                nr_seq_lote,
                ds_conteudo,
                dt_atualizacao,
                nm_usuario,
                nr_seq_apres)
            values (nextval('w_envio_orgao_cobranca_seq'),
                nr_seq_lote_p,
                ds_conteudo_w,
                clock_timestamp(),
                nm_usuario_p,
                nr_seq_linha_w);
        end;
    end loop;
    close titulo;

    /*--------------------------------------------------------------------------|
    |                                Trailler                                   |
    |--------------------------------------------------------------------------*/
    
    ds_conteudo_w  := '99' || 
        lpad(nr_seq_linha_w, 6, '0') ||
        lpad(' ', 366, ' ') || 
        lpad(' ', 10, ' ') || 
        lpad(nr_seq_linha_w,6,'0');

    nr_seq_linha_w := nr_seq_linha_w + 1;
    insert into w_envio_orgao_cobranca(nr_sequencia,
        nr_seq_lote,
        ds_conteudo,
        dt_atualizacao,
        nm_usuario,
        nr_seq_apres)
    values (
        nextval('w_envio_orgao_cobranca_seq'),
        nr_seq_lote_p,
        ds_conteudo_w,
        clock_timestamp(),
        nm_usuario_p,
        nr_seq_linha_w);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_envio_spc_padrao ( nr_seq_lote_p bigint, nm_usuario_p text, nr_seq_orgao_cobr_p bigint, cd_estabelecimento_p bigint) FROM PUBLIC;

