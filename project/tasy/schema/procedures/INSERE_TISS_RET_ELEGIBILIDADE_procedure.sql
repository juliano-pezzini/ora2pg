-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insere_tiss_ret_elegibilidade ( cd_usuario_convenio_p TISS_RETORNO_ELEGIBILIDADE.CD_USUARIO_CONVENIO%type, nr_identidade_p PESSOA_FISICA.NR_IDENTIDADE%type, cd_convenio_p TISS_RETORNO_ELEGIBILIDADE.CD_CONVENIO%type, ds_mensagem_erro_p TISS_RETORNO_ELEGIBILIDADE.DS_MENSAGEM_ERRO%type, ie_resposta_elegibilidade_p TISS_RETORNO_ELEGIBILIDADE.IE_RESPOSTA_ELEGIBILIDADE%type, nm_usuario_p TISS_RETORNO_ELEGIBILIDADE.NM_USUARIO%type ) AS $body$
DECLARE


cd_pessoa_fisica_w      PESSOA_FISICA.CD_PESSOA_FISICA%type;
dt_data_atual_s         TISS_RETORNO_ELEGIBILIDADE.DT_ATUALIZACAO%type :=clock_timestamp();

BEGIN

SELECT  max(CD_PESSOA_FISICA)
INTO STRICT    cd_pessoa_fisica_w
FROM    PESSOA_FISICA
WHERE   PESSOA_FISICA.NR_IDENTIDADE = nr_identidade_p;

INSERT INTO TISS_RETORNO_ELEGIBILIDADE(
                NR_SEQUENCIA,
                NM_USUARIO,
                NM_USUARIO_NREC,
                DT_ATUALIZACAO,
                DT_ATUALIZACAO_NREC,
                CD_CONVENIO,
                CD_USUARIO_CONVENIO,
                DS_MENSAGEM_ERRO,
                IE_RESPOSTA_ELEGIBILIDADE,
                CD_PESSOA_FISICA,
                CD_ESTABELECIMENTO
                )
        VALUES (nextval('tiss_retorno_elegibilidade_seq'),
                nm_usuario_p,
                nm_usuario_p,
                dt_data_atual_s,
                dt_data_atual_s,
                cd_convenio_p,
                cd_usuario_convenio_p,
                ds_mensagem_erro_p,
                CASE WHEN ie_resposta_elegibilidade_p=0 THEN  'N' WHEN ie_resposta_elegibilidade_p=1 THEN  'S' END ,
                cd_pessoa_fisica_w,
                WHEB_USUARIO_PCK.GET_CD_ESTABELECIMENTO
                );
COMMIT;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insere_tiss_ret_elegibilidade ( cd_usuario_convenio_p TISS_RETORNO_ELEGIBILIDADE.CD_USUARIO_CONVENIO%type, nr_identidade_p PESSOA_FISICA.NR_IDENTIDADE%type, cd_convenio_p TISS_RETORNO_ELEGIBILIDADE.CD_CONVENIO%type, ds_mensagem_erro_p TISS_RETORNO_ELEGIBILIDADE.DS_MENSAGEM_ERRO%type, ie_resposta_elegibilidade_p TISS_RETORNO_ELEGIBILIDADE.IE_RESPOSTA_ELEGIBILIDADE%type, nm_usuario_p TISS_RETORNO_ELEGIBILIDADE.NM_USUARIO%type ) FROM PUBLIC;

