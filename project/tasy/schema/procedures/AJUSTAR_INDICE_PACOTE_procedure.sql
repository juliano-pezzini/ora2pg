-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ajustar_indice_pacote (cd_estabelecimento_p bigint, cd_convenio_p bigint, nr_seq_pacote_p bigint, cd_plano_p text, dt_vigencia_inicial_p timestamp, dt_vigencia_final_p timestamp, dt_vigencia_p timestamp, vl_indice_p bigint, cd_categoria_p text, nm_usuario_p text, ie_tipo_acomodacao_p text, nr_sequencia_p bigint) AS $body$
DECLARE



NR_SEQ_PACOTE_w			bigint;
IE_TIPO_ACOMOD_w		varchar(2);
QT_DIAS_PACOTE_w		integer;
QT_DIAS_HOSPITAL_w		integer;
QT_DIAS_UTI_w			integer;
IE_EXCEDENTE_w			smallint;
CD_PROCEDIMENTO_w		bigint;
IE_ORIGEM_PROCED_w		bigint;
VL_PACOTE_w			double precision;
VL_HONORARIO_w			double precision;
VL_MATERIAIS_w			double precision;
VL_AUXILIARES_w			double precision;
QT_PONTO_PACOTE_w		double precision;
QT_PONTO_HONORARIO_w		double precision;
CD_ESTRUTURA_CONTA_w		integer;
IE_CLASSIFICACAO_w		varchar(1);
NR_SEQUENCIA_w			bigint;
CD_CATEGORIA_w			varchar(10);
DT_VIGENCIA_w			timestamp;
IE_EXIGE_GABARITO_w		varchar(1);
IE_REGRA_HORA_INICIO_w		varchar(5);
IE_REGRA_HORA_FIM_w		varchar(5);
IE_SITUACAO_w			varchar(1);
QT_IDADE_MIN_w			smallint;
QT_IDADE_MAX_w			smallint;
IE_RATEAR_REPASSE_w		varchar(1);
DT_VIGENCIA_FINAL_w		timestamp;
IE_TIPO_ATENDIMENTO_w		smallint;
QT_DIAS_INTER_INICIO_w		bigint;
QT_DIAS_INTER_FINAL_w		bigint;
IE_GERAR_PROCED_NEGATIVO_w	varchar(1);
VL_ANESTESISTA_w		double precision;
IE_ATEND_RETORNO_w		varchar(1);
IE_TIPO_ANESTESIA_w		varchar(3);
HR_FINAL_PACOTE_w		timestamp;

nr_seq_novo_w			bigint;
nr_seq_proc_w			bigint;
nr_seq_mat_w			bigint;


IE_INCLUI_EXCLUI_w		varchar(1);
CD_GRUPO_MATERIAL_w		smallint;
CD_SUBGRUPO_MATERIAL_w		smallint;
CD_CLASSE_MATERIAL_w		integer;
CD_MATERIAL_w			integer;
QT_LIMITE_w			double precision;
CD_SETOR_ATENDIMENTO_w		integer;
NR_SEQ_PAC_ACOMOD_w		bigint;
IE_VALOR_w			varchar(1);
VL_MINIMO_w			double precision;
VL_MAXIMO_w			double precision;
PR_DESCONTO_w			double precision;
IE_OBJETIVO_w			varchar(1);
IE_TIPO_SETOR_w			varchar(3);

CD_AREA_PROCED_w		bigint;
CD_ESPECIAL_PROCED_w		bigint;
CD_GRUPO_PROCED_w		bigint;
IE_CONSIDERA_HONORARIO_w	varchar(1);
IE_CALCULA_HONORARIO_w		varchar(1);
IE_CALCULA_CUSTO_OPER_w		varchar(1);
IE_TIPO_VALOR_W			varchar(3);

PR_FATURAR_PACOTE_w              double precision;
IE_ATEND_ACOMP_w                 varchar(1);
NR_SEQ_PROC_INTERNO_w            bigint;
CD_MEDICO_EXECUTOR_w             varchar(10);
cd_plano_w			 varchar(10);
cd_centro_custo_w		integer;
pr_acrescimo_rn_w		double precision;
cd_local_estoque_w		pacote_material.cd_local_estoque%type;
ie_ratear_item_w		pacote_procedimento.ie_ratear_item%type;
ie_carater_inter_sus_w          pacote_tipo_acomodacao.ie_carater_inter_sus%type;
ie_credenciado_w                pacote_tipo_acomodacao.ie_credenciado%type;
ie_atend_alta_w                 pacote_tipo_acomodacao.ie_atend_alta%type;
ie_consiste_dias_inter_w        pacote_tipo_acomodacao.ie_consiste_dias_inter%type;
ie_atualiza_medico_w            pacote_tipo_acomodacao.ie_atualiza_medico%type;
qt_procedimento_w               pacote_tipo_acomodacao.qt_procedimento%type;
ie_clinica_w                    pacote_tipo_acomodacao.ie_clinica%type;
ie_lado_w                       pacote_tipo_acomodacao.ie_lado%type;
ie_sexo_w                       pacote_tipo_acomodacao.ie_sexo%type;
ie_tipo_atend_conta_w           pacote_tipo_acomodacao.ie_tipo_atend_conta%type;
ie_consiste_cirurgia_w          pacote_tipo_acomodacao.ie_consiste_cirurgia%type;
ds_observacao_w                 pacote_tipo_acomodacao.ds_observacao%type;
ie_exige_item_conta_w           pacote_tipo_acomodacao.ie_exige_item_conta%type;
ie_setor_lanc_exclusivo_w       pacote_tipo_acomodacao.ie_setor_lanc_exclusivo%type;
ie_pacote_mat_ipasgo_w          pacote_tipo_acomodacao.ie_pacote_mat_ipasgo%type;
qt_hora_w                       pacote_tipo_acomodacao.qt_hora%type;
nr_seq_estrutura_w              pacote_material.nr_seq_estrutura%type;
nr_seq_proc_inter_pacote_w      pacote_procedimento.nr_seq_proc_interno%type;
cd_cgc_prestador_w              pacote_procedimento.cd_cgc_prestador%type;
nr_seq_classif_w                pacote_procedimento.nr_seq_classif%type;

c01 CURSOR FOR
	SELECT  a.NR_SEQ_PACOTE,
		a.IE_TIPO_ACOMOD     ,
		a.QT_DIAS_PACOTE     ,            
		a.QT_DIAS_HOSPITAL   ,            
		a.QT_DIAS_UTI        ,            
		a.IE_EXCEDENTE       ,            
		a.CD_PROCEDIMENTO    ,            
		a.IE_ORIGEM_PROCED   ,            
		a.VL_PACOTE          ,            
		a.VL_HONORARIO       ,            
		a.QT_PONTO_PACOTE    ,            
		a.QT_PONTO_HONORARIO ,            
		a.CD_ESTRUTURA_CONTA ,            
		a.IE_CLASSIFICACAO   ,            
		a.NR_SEQUENCIA       ,            
		a.CD_CATEGORIA       ,            
		a.DT_VIGENCIA        ,            
		a.IE_EXIGE_GABARITO  ,            
		a.IE_REGRA_HORA_INICIO,           
		a.IE_REGRA_HORA_FIM  ,            
		a.IE_SITUACAO        ,            
		a.QT_IDADE_MIN       ,            
		a.QT_IDADE_MAX       ,            
		a.IE_RATEAR_REPASSE  ,            
		a.DT_VIGENCIA_FINAL  ,            
		a.IE_TIPO_ATENDIMENTO,            
		a.QT_DIAS_INTER_INICIO,           
		a.QT_DIAS_INTER_FINAL,            
		a.IE_GERAR_PROCED_NEGATIVO,
		a.VL_ANESTESISTA     ,            
		a.IE_ATEND_RETORNO   ,            
		a.IE_TIPO_ANESTESIA  ,            
		a.HR_FINAL_PACOTE    ,
		a.PR_FATURAR_PACOTE     ,
		a.IE_ATEND_ACOMP        ,
		a.CD_SETOR_ATENDIMENTO  ,
		a.NR_SEQ_PROC_INTERNO   ,  
		a.CD_MEDICO_EXECUTOR,
		a.cd_plano,
		a.cd_centro_custo,
		a.pr_acrescimo_rn,
		a.VL_MATERIAIS,
		a.VL_AUXILIARES,
                a.IE_CARATER_INTER_SUS,
                a.ie_credenciado,
                a.ie_atend_alta,
                a.ie_consiste_dias_inter,
                a.ie_atualiza_medico,
                a.qt_procedimento,
                a.ie_clinica,
                a.ie_lado,
                a.ie_sexo,
                a.ie_tipo_atend_conta,
                a.ie_consiste_cirurgia,
                a.ds_observacao,
                a.ie_exige_item_conta,
                a.ie_setor_lanc_exclusivo,
                a.ie_pacote_mat_ipasgo,
                a.qt_hora
	from    pacote b,
		PACOTE_TIPO_ACOMODACAO a
	Where   a.nr_seq_pacote         = b.nr_seq_pacote
	and     b.cd_estabelecimento    = cd_estabelecimento_p
	and     b.cd_convenio           = cd_convenio_p
	and	((coalesce(cd_categoria_p, '0') = '0') or (a.cd_categoria = cd_categoria_p))
	and     ((nr_seq_pacote_p = 0) or (a.nr_seq_pacote = nr_seq_pacote_p))
	and     ((coalesce(cd_plano_p,'0') = '0') or (a.cd_plano = cd_plano_p))
	and     ((coalesce(ie_tipo_acomodacao_p,'0') = '0') or (a.ie_tipo_acomod = ie_tipo_acomodacao_p))
	and	((coalesce(nr_sequencia_p,0) = 0) or (a.nr_sequencia = nr_sequencia_p))
	and     b.ie_situacao = 'A'
	and     a.ie_situacao = 'A'
	and     coalesce(a.dt_vigencia_final, dt_vigencia_inicial_p) between dt_vigencia_inicial_p and dt_vigencia_final_p
	and     a.dt_vigencia between dt_vigencia_inicial_p and dt_vigencia_final_p
	Order by	a.NR_SEQ_PACOTE, a.ie_tipo_acomod;

c02 CURSOR FOR
	SELECT	IE_INCLUI_EXCLUI  ,
		IE_EXCEDENTE      ,                     
		CD_GRUPO_MATERIAL ,                     
		CD_SUBGRUPO_MATERIAL,                   
		CD_CLASSE_MATERIAL ,                    
		CD_MATERIAL        ,                    
		QT_LIMITE          ,                    
		IE_TIPO_ATENDIMENTO,                    
		CD_SETOR_ATENDIMENTO,                   
		NR_SEQ_PAC_ACOMOD  ,                    
		IE_VALOR           ,                    
		VL_MINIMO          ,                    
		VL_MAXIMO          ,                    
		PR_DESCONTO        ,                    
		QT_IDADE_MIN       ,                    
		QT_IDADE_MAX       ,                    
		IE_OBJETIVO        ,                    
		IE_TIPO_SETOR,
		cd_centro_custo,
		cd_local_estoque,
                nr_seq_estrutura
	from	pacote_material
	where	nr_seq_pacote		= nr_seq_pacote_w
	and	NR_SEQ_PAC_ACOMOD	= nr_sequencia_w;

c03 CURSOR FOR
	SELECT	IE_INCLUI_EXCLUI      ,
		IE_EXCEDENTE          , 
		CD_AREA_PROCED        , 
		CD_ESPECIAL_PROCED    , 
		CD_GRUPO_PROCED       , 
		CD_PROCEDIMENTO       , 
		IE_ORIGEM_PROCED      , 
		QT_LIMITE             , 
		IE_CONSIDERA_HONORARIO,
		CD_SETOR_ATENDIMENTO  , 
		IE_TIPO_ATENDIMENTO   , 
		IE_CALCULA_HONORARIO  , 
		IE_CALCULA_CUSTO_OPER , 
		NR_SEQ_PAC_ACOMOD     , 
		PR_DESCONTO           , 
		QT_IDADE_MIN          , 
		QT_IDADE_MAX          , 
		VL_MAXIMO             , 
		VL_MINIMO             , 
		IE_TIPO_VALOR,
		cd_centro_custo,
		ie_ratear_item,
                nr_seq_proc_interno,
                cd_cgc_prestador,
                nr_seq_classif
	from	pacote_procedimento
	where	nr_seq_pacote		= nr_seq_pacote_w
	and	NR_SEQ_PAC_ACOMOD	= nr_sequencia_w;


BEGIN

open	c01;
loop
fetch	c01 into
		NR_SEQ_PACOTE_w,
		IE_TIPO_ACOMOD_w,
		QT_DIAS_PACOTE_w,
		QT_DIAS_HOSPITAL_w,
		QT_DIAS_UTI_w,
		IE_EXCEDENTE_w,
		CD_PROCEDIMENTO_w,
		IE_ORIGEM_PROCED_w,
		VL_PACOTE_w,
		VL_HONORARIO_w,
		QT_PONTO_PACOTE_w,
		QT_PONTO_HONORARIO_w,
		CD_ESTRUTURA_CONTA_w,
		IE_CLASSIFICACAO_w,
		NR_SEQUENCIA_w,
		CD_CATEGORIA_w,
		DT_VIGENCIA_w,
		IE_EXIGE_GABARITO_w,
		IE_REGRA_HORA_INICIO_w,
		IE_REGRA_HORA_FIM_w,
		IE_SITUACAO_w,
		QT_IDADE_MIN_w,
		QT_IDADE_MAX_w,
		IE_RATEAR_REPASSE_w,
		DT_VIGENCIA_FINAL_w,
		IE_TIPO_ATENDIMENTO_w,
		QT_DIAS_INTER_INICIO_w,
		QT_DIAS_INTER_FINAL_w,
		IE_GERAR_PROCED_NEGATIVO_w,
		VL_ANESTESISTA_w,
		IE_ATEND_RETORNO_w,
		IE_TIPO_ANESTESIA_w,
		HR_FINAL_PACOTE_w,
		PR_FATURAR_PACOTE_w     ,
		IE_ATEND_ACOMP_w        ,
		CD_SETOR_ATENDIMENTO_w  ,
		NR_SEQ_PROC_INTERNO_w   ,
		CD_MEDICO_EXECUTOR_w,
		cd_plano_w,
		cd_centro_custo_w,
		pr_acrescimo_rn_w,
		VL_MATERIAIS_w,
		VL_AUXILIARES_w,
                ie_carater_inter_sus_w,
                ie_credenciado_w,
                ie_atend_alta_w,
                ie_consiste_dias_inter_w,
                ie_atualiza_medico_w,
                qt_procedimento_w,
                ie_clinica_w,
                ie_lado_w,
                ie_sexo_w,
                ie_tipo_atend_conta_w,
                ie_consiste_cirurgia_w,
                ds_observacao_w,
                ie_exige_item_conta_w,
                ie_setor_lanc_exclusivo_w,
                ie_pacote_mat_ipasgo_w,
                qt_hora_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin

	select	nextval('pacote_tipo_acomodacao_seq')
	into STRICT	nr_seq_novo_w
	;
		
	insert	into pacote_tipo_acomodacao(NR_SEQ_PACOTE,
		IE_TIPO_ACOMOD   ,
		QT_DIAS_PACOTE    ,             
		QT_DIAS_HOSPITAL   ,            
		QT_DIAS_UTI         ,           
		IE_EXCEDENTE         ,          
		CD_PROCEDIMENTO       ,         
		IE_ORIGEM_PROCED       ,        
		VL_PACOTE               ,       
		VL_HONORARIO             ,      
		QT_PONTO_PACOTE           ,     
		QT_PONTO_HONORARIO         ,    
		CD_ESTRUTURA_CONTA          ,   
		IE_CLASSIFICACAO             ,  
		NR_SEQUENCIA                  , 
		CD_CATEGORIA                   ,
		DT_VIGENCIA                    ,
		IE_EXIGE_GABARITO              ,
		IE_REGRA_HORA_INICIO           ,
		IE_REGRA_HORA_FIM              ,
		IE_SITUACAO                    ,
		QT_IDADE_MIN                   ,
		QT_IDADE_MAX                   ,
		IE_RATEAR_REPASSE              ,
		DT_VIGENCIA_FINAL              ,
		IE_TIPO_ATENDIMENTO            ,
		QT_DIAS_INTER_INICIO           ,
		QT_DIAS_INTER_FINAL            ,
		IE_GERAR_PROCED_NEGATIVO,
		VL_ANESTESISTA           ,      
		IE_ATEND_RETORNO          ,     
		IE_TIPO_ANESTESIA          ,    
		HR_FINAL_PACOTE,
		dt_atualizacao,
		nm_usuario,
		PR_FATURAR_PACOTE     ,
		IE_ATEND_ACOMP        ,
		CD_SETOR_ATENDIMENTO  ,
		NR_SEQ_PROC_INTERNO   ,  
		CD_MEDICO_EXECUTOR    ,
		cd_plano,
		cd_centro_custo,
		pr_acrescimo_rn,
		VL_MATERIAIS,
		VL_AUXILIARES,
                ie_carater_inter_sus,
                ie_credenciado,
                ie_atend_alta,
                ie_consiste_dias_inter,
                ie_atualiza_medico,
                qt_procedimento,
                ie_clinica,
                ie_lado,
                ie_sexo,
                ie_tipo_atend_conta,
                ie_consiste_cirurgia,
                ds_observacao,
                ie_exige_item_conta,
                ie_setor_lanc_exclusivo,
                ie_pacote_mat_ipasgo,
                qt_hora
		)
	values (NR_SEQ_PACOTE_w,
		IE_TIPO_ACOMOD_w,
		QT_DIAS_PACOTE_w,
		QT_DIAS_HOSPITAL_w,
		QT_DIAS_UTI_w,
		IE_EXCEDENTE_w,
		CD_PROCEDIMENTO_w,
		IE_ORIGEM_PROCED_w,
		VL_PACOTE_w * vl_indice_p,
		VL_HONORARIO_w,
		QT_PONTO_PACOTE_w,
		QT_PONTO_HONORARIO_w,
		CD_ESTRUTURA_CONTA_w,
		IE_CLASSIFICACAO_w,
		NR_SEQ_novo_w,
		CD_CATEGORIA_w,
		DT_VIGENCIA_p,
		IE_EXIGE_GABARITO_w,
		IE_REGRA_HORA_INICIO_w,
		IE_REGRA_HORA_FIM_w,
		IE_SITUACAO_w,
		QT_IDADE_MIN_w,
		QT_IDADE_MAX_w,
		IE_RATEAR_REPASSE_w,
		null,
		IE_TIPO_ATENDIMENTO_w,
		QT_DIAS_INTER_INICIO_w,
		QT_DIAS_INTER_FINAL_w,
		IE_GERAR_PROCED_NEGATIVO_w,
		VL_ANESTESISTA_w,
		IE_ATEND_RETORNO_w,
		IE_TIPO_ANESTESIA_w,
		HR_FINAL_PACOTE_w,
		clock_timestamp(),
		nm_usuario_p,
		PR_FATURAR_PACOTE_w	,
		IE_ATEND_ACOMP_w        ,
		CD_SETOR_ATENDIMENTO_w  ,
		NR_SEQ_PROC_INTERNO_w   ,  
		CD_MEDICO_EXECUTOR_w,
		cd_plano_w,
		cd_centro_custo_w,
		pr_acrescimo_rn_w,
		VL_MATERIAIS_w,
		VL_AUXILIARES_w,
                ie_carater_inter_sus_w,
                ie_credenciado_w,
                ie_atend_alta_w,
                ie_consiste_dias_inter_w,
                ie_atualiza_medico_w,
                qt_procedimento_w,
                ie_clinica_w,
                ie_lado_w,
                ie_sexo_w,
                ie_tipo_atend_conta_w,
                ie_consiste_cirurgia_w,
                ds_observacao_w,
                ie_exige_item_conta_w,
                ie_setor_lanc_exclusivo_w,
                ie_pacote_mat_ipasgo_w,
                qt_hora_w);
	
	open	c02;
	loop
	fetch	c02 into
		IE_INCLUI_EXCLUI_w,
		IE_EXCEDENTE_w,
		CD_GRUPO_MATERIAL_w,
		CD_SUBGRUPO_MATERIAL_w,
		CD_CLASSE_MATERIAL_w,
		CD_MATERIAL_w,
		QT_LIMITE_w,
		IE_TIPO_ATENDIMENTO_w,
		CD_SETOR_ATENDIMENTO_w,
		NR_SEQ_PAC_ACOMOD_w,
		IE_VALOR_w,
		VL_MINIMO_w,
		VL_MAXIMO_w,
		PR_DESCONTO_w,
		QT_IDADE_MIN_w,
		QT_IDADE_MAX_w,
		IE_OBJETIVO_w,
		IE_TIPO_SETOR_w,
		cd_centro_custo_w,
		cd_local_estoque_w,
                nr_seq_estrutura_w;
	EXIT WHEN NOT FOUND; /* apply on c02 */
		begin

		select	coalesce(max(nr_sequencia), 0) + 1
		into STRICT	nr_seq_mat_w
		from	pacote_material
		where	nr_seq_pacote		= nr_seq_pacote_w;

		insert	into pacote_material(NR_SEQ_PACOTE    ,
			NR_SEQUENCIA      ,                     
			IE_INCLUI_EXCLUI  ,                     
			DT_ATUALIZACAO    ,                     
			NM_USUARIO        ,                     
			IE_EXCEDENTE      ,                     
			CD_GRUPO_MATERIAL ,                     
			CD_SUBGRUPO_MATERIAL,                   
			CD_CLASSE_MATERIAL ,                    
			CD_MATERIAL        ,                    
			QT_LIMITE          ,                    
			IE_TIPO_ATENDIMENTO,                    
			CD_SETOR_ATENDIMENTO,                   
			NR_SEQ_PAC_ACOMOD  ,                    
			IE_VALOR           ,                    
			VL_MINIMO          ,                    
			VL_MAXIMO          ,                    
			PR_DESCONTO        ,                    
			QT_IDADE_MIN       ,                    
			QT_IDADE_MAX       ,                    
			IE_OBJETIVO        ,                    
			IE_TIPO_SETOR,
			cd_centro_custo,
			cd_local_estoque,
                        nr_seq_estrutura)
		values (NR_SEQ_PACOTE_w,                          
			nr_seq_mat_w,
			IE_INCLUI_EXCLUI_w  ,
			clock_timestamp(),
			NM_USUARIO_p,
			IE_EXCEDENTE_w ,                          
			CD_GRUPO_MATERIAL_w  ,                    
			CD_SUBGRUPO_MATERIAL_w,                   
			CD_CLASSE_MATERIAL_w ,                    
			CD_MATERIAL_w,                        
			QT_LIMITE_w,                         
			IE_TIPO_ATENDIMENTO_w  ,                  
			CD_SETOR_ATENDIMENTO_w ,                  
			nr_seq_novo_w  ,                    
			IE_VALOR_w       ,                        
			VL_MINIMO_w   ,                           
			VL_MAXIMO_w   ,                           
			PR_DESCONTO_w ,                           
			QT_IDADE_MIN_w,                           
			QT_IDADE_MAX_w,                           
			IE_OBJETIVO_w,                            
			IE_TIPO_SETOR_w,
			cd_centro_custo_w,
			cd_local_estoque_w,
                        nr_seq_estrutura_w);
		end;
	end loop;
	close c02;

	open	c03;
	loop
	fetch	c03 into
		IE_INCLUI_EXCLUI_w      ,
		IE_EXCEDENTE_w          , 
		CD_AREA_PROCED_w        , 
		CD_ESPECIAL_PROCED_w    , 
		CD_GRUPO_PROCED_w       , 
		CD_PROCEDIMENTO_w       , 
		IE_ORIGEM_PROCED_w      , 
		QT_LIMITE_w             , 
		IE_CONSIDERA_HONORARIO_w,
		CD_SETOR_ATENDIMENTO_w  , 
		IE_TIPO_ATENDIMENTO_w   , 
		IE_CALCULA_HONORARIO_w  , 
		IE_CALCULA_CUSTO_OPER_w , 
		NR_SEQ_PAC_ACOMOD_w     , 
		PR_DESCONTO_w           , 
		QT_IDADE_MIN_w          , 
		QT_IDADE_MAX_w          , 
		VL_MAXIMO_w             , 
		VL_MINIMO_w             , 
		IE_TIPO_VALOR_w,
		cd_centro_custo_w,
		ie_ratear_item_w,
                nr_seq_proc_inter_pacote_w,
                cd_cgc_prestador_w,
                nr_seq_classif_w;
	EXIT WHEN NOT FOUND; /* apply on c03 */
		begin

		select	coalesce(max(nr_sequencia), 0) + 1
		into STRICT	nr_seq_proc_w
		from	pacote_procedimento
		where	nr_seq_pacote		= nr_seq_pacote_w;


		insert	into pacote_procedimento(NR_SEQ_PACOTE        ,
			NR_SEQUENCIA          , 
			IE_INCLUI_EXCLUI      , 
			DT_ATUALIZACAO        , 
			NM_USUARIO            , 
			IE_EXCEDENTE          , 
			CD_AREA_PROCED        , 
			CD_ESPECIAL_PROCED    , 
			CD_GRUPO_PROCED       , 
			CD_PROCEDIMENTO       , 
			IE_ORIGEM_PROCED      , 
			QT_LIMITE             , 
			IE_CONSIDERA_HONORARIO,
			CD_SETOR_ATENDIMENTO  , 
			IE_TIPO_ATENDIMENTO   , 
			IE_CALCULA_HONORARIO  , 
			IE_CALCULA_CUSTO_OPER , 
			NR_SEQ_PAC_ACOMOD     , 
			PR_DESCONTO           , 
			QT_IDADE_MIN          , 
			QT_IDADE_MAX          , 
			VL_MAXIMO             , 
			VL_MINIMO             , 
			IE_TIPO_VALOR,
			cd_centro_custo,
			ie_ratear_item,
                        nr_seq_proc_interno,
                        cd_cgc_prestador,
                        nr_seq_classif)                                               
		values (NR_SEQ_PACOTE_w       ,  
			nr_seq_proc_w          , 
			IE_INCLUI_EXCLUI_w     , 
			clock_timestamp()        , 
			NM_USUARIO_p            , 
			IE_EXCEDENTE_w          , 
			CD_AREA_PROCED_w        , 
			CD_ESPECIAL_PROCED_w    , 
			CD_GRUPO_PROCED_w       , 
			CD_PROCEDIMENTO_w       , 
			IE_ORIGEM_PROCED_w      , 
			QT_LIMITE_w             , 
			IE_CONSIDERA_HONORARIO_w,
			CD_SETOR_ATENDIMENTO_w  , 
			IE_TIPO_ATENDIMENTO_w   , 
			IE_CALCULA_HONORARIO_w  , 
			IE_CALCULA_CUSTO_OPER_w , 
			nr_seq_novo_w     , 
			PR_DESCONTO_w           , 
			QT_IDADE_MIN_w          , 
			QT_IDADE_MAX_w          , 
			VL_MAXIMO_w             , 
			VL_MINIMO_w             , 
			IE_TIPO_VALOR_w,
			cd_centro_custo_w,
			ie_ratear_item_w,
                        nr_seq_proc_inter_pacote_w,
                        cd_cgc_prestador_w,
                        nr_seq_classif_w);
		
		end;
	end loop;
	close c03;	

	insert	into pacote_tipo_acomod_proc(NR_SEQUENCIA,
		DT_ATUALIZACAO     ,    
		NM_USUARIO         ,    
		NR_SEQ_PAC_ACOMOD  ,    
		CD_PROCEDIMENTO    ,    
		IE_ORIGEM_PROCED   ,    
		DT_ATUALIZACAO_NREC,
		NM_USUARIO_NREC )
	(SELECT nextval('pacote_tipo_acomod_proc_seq'),
		clock_timestamp(),
		nm_usuario_p,
		nr_seq_novo_w,
		CD_PROCEDIMENTO    ,    
		IE_ORIGEM_PROCED   ,    
		clock_timestamp(),
		nm_usuario_p
	from	pacote_tipo_acomod_proc
	where	NR_SEQ_PAC_ACOMOD	= nr_sequencia_w);

	update	pacote_tipo_acomodacao
	set	dt_vigencia_final	= dt_vigencia_p - 1
	where	nr_sequencia		= nr_sequencia_w;

	end;
end loop;
close	c01;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ajustar_indice_pacote (cd_estabelecimento_p bigint, cd_convenio_p bigint, nr_seq_pacote_p bigint, cd_plano_p text, dt_vigencia_inicial_p timestamp, dt_vigencia_final_p timestamp, dt_vigencia_p timestamp, vl_indice_p bigint, cd_categoria_p text, nm_usuario_p text, ie_tipo_acomodacao_p text, nr_sequencia_p bigint) FROM PUBLIC;

