-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE med_inserir_item_avaliacao (ds_tipo_avaliacao_p text, ds_item_p text, nr_seq_apresent_p bigint, ie_resultado_p text, qt_decimais_p bigint, ds_unid_med_p text, qt_minimo_p bigint, qt_maximo_p bigint, qt_tamanho_p bigint, qt_desloc_direita_p bigint, nr_seq_superior_p bigint, ds_item_superior_p text, nr_seq_apres_superior_p bigint, ie_obrigatorio_p text, qt_pos_esquerda_p bigint, qt_altura_p bigint, cd_dominio_p bigint, nr_seq_item_ref_p bigint, ds_item_ref_p text, nr_seq_apres_ref_p bigint, vl_padrao_p text, ds_complemento_p text, ie_tipo_campo_p text, ds_mascara_p text, ds_regra_p text, nm_usuario_p text) AS $body$
DECLARE



nr_seq_item_w		bigint;
nr_seq_tipo_w		bigint;
nr_seq_superior_w	bigint;
nr_seq_refer_w		bigint;


BEGIN

select	coalesce(max(nr_sequencia),0)
into STRICT	nr_seq_tipo_w
from	med_tipo_avaliacao
where	ds_tipo		= substr('COPIA ' || ds_tipo_avaliacao_p,1,60);

if (nr_seq_tipo_w <> 0) then
	begin

	select	nextval('med_item_avaliar_seq')
	into STRICT	nr_seq_item_w
	;

	if (coalesce(nr_seq_superior_p::text, '') = '') and (coalesce(nr_seq_item_ref_p::text, '') = '') then
		begin

		insert 	into med_item_avaliar(nr_sequencia,
			ds_item,
			nr_seq_tipo,
			nr_seq_apresent,
			ie_resultado,
			dt_atualizacao,
			nm_usuario,
			qt_decimais,
			ds_unid_med,
			qt_minimo,
			qt_maximo,
			qt_tamanho,
			qt_desloc_direita,
			nr_seq_superior,
			ie_obrigatorio,
			qt_pos_esquerda,
			cd_dominio,
			nr_seq_item_ref,
			vl_padrao,
			ds_complemento,
			ie_tipo_campo,
			ds_mascara,
			ds_regra,
			qt_altura,
			IE_GRAFICO_AVALIACAO)
		values (nr_seq_item_w,
			coalesce(ds_item_p,' '),
			nr_seq_tipo_w,
			nr_seq_apresent_p,
			ie_resultado_p,
			clock_timestamp(),
			nm_usuario_p,
			qt_decimais_p,
			ds_unid_med_p,
			qt_minimo_p,
			qt_maximo_p,
			qt_tamanho_p,
			qt_desloc_direita_p,
			null,
			ie_obrigatorio_p,
			qt_pos_esquerda_p,
			cd_dominio_p,
			null,
			vl_padrao_p,
			ds_complemento_p,
			ie_tipo_campo_p,
			ds_mascara_p,
			ds_regra_p,
			qt_altura_p,
			'S');
		end;
	end if;

	if (nr_seq_superior_p IS NOT NULL AND nr_seq_superior_p::text <> '') and (coalesce(nr_seq_item_ref_p::text, '') = '') then
		begin

		select	coalesce(max(nr_sequencia),0)
		into STRICT	nr_seq_superior_w
		from	med_item_avaliar
		where	ds_item		= ds_item_superior_p
		and	nr_seq_apresent	= nr_seq_apres_superior_p
		and	nr_seq_tipo	= nr_seq_tipo_w;

		if (nr_seq_superior_w > 0) then
			begin

			insert 	into med_item_avaliar(nr_sequencia,
				ds_item,
				nr_seq_tipo,
				nr_seq_apresent,
				ie_resultado,
				dt_atualizacao,
				nm_usuario,
				qt_decimais,
				ds_unid_med,
				qt_minimo,
				qt_maximo,
				qt_tamanho,
				qt_desloc_direita,
				nr_seq_superior,
				ie_obrigatorio,
				qt_pos_esquerda,
				cd_dominio,
				nr_seq_item_ref,
				vl_padrao,
				ds_complemento,
				ie_tipo_campo,
				ds_mascara,
				ds_regra,
				qt_altura,
				IE_GRAFICO_AVALIACAO)
			values (nr_seq_item_w,
				coalesce(ds_item_p,' '),
				nr_seq_tipo_w,
				nr_seq_apresent_p,
				ie_resultado_p,
				clock_timestamp(),
				nm_usuario_p,
				qt_decimais_p,
				ds_unid_med_p,
				qt_minimo_p,
				qt_maximo_p,
				qt_tamanho_p,
				qt_desloc_direita_p,
				nr_seq_superior_w,
				ie_obrigatorio_p,
				qt_pos_esquerda_p,
				cd_dominio_p,
				null,
				vl_padrao_p,
				ds_complemento_p,
				ie_tipo_campo_p,
				ds_mascara_p,
				ds_regra_p,
				qt_altura_p,
				'S');
			end;
		end if;

		end;
	end if;

	if (coalesce(nr_seq_superior_p::text, '') = '') and (nr_seq_item_ref_p IS NOT NULL AND nr_seq_item_ref_p::text <> '') then
		begin

		select	coalesce(max(nr_sequencia),0)
		into STRICT	nr_seq_refer_w
		from	med_item_avaliar
		where	ds_item		= ds_item_ref_p
		and	nr_seq_apresent	= nr_seq_apres_ref_p
		and	nr_seq_tipo	= nr_seq_tipo_w;

		if (nr_seq_refer_w > 0) then
			begin

			insert 	into med_item_avaliar(nr_sequencia,
				ds_item,
				nr_seq_tipo,
				nr_seq_apresent,
				ie_resultado,
				dt_atualizacao,
				nm_usuario,
				qt_decimais,
				ds_unid_med,
				qt_minimo,
				qt_maximo,
				qt_tamanho,
				qt_desloc_direita,
				nr_seq_superior,
				ie_obrigatorio,
				qt_pos_esquerda,
				cd_dominio,
				nr_seq_item_ref,
				vl_padrao,
				ds_complemento,
				ie_tipo_campo,
				ds_mascara,
				ds_regra,
				qt_altura,
				IE_GRAFICO_AVALIACAO)
			values (nr_seq_item_w,
				coalesce(ds_item_p,' '),
				nr_seq_tipo_w,
				nr_seq_apresent_p,
				ie_resultado_p,
				clock_timestamp(),
				nm_usuario_p,
				qt_decimais_p,
				ds_unid_med_p,
				qt_minimo_p,
				qt_maximo_p,
				qt_tamanho_p,
				qt_desloc_direita_p,
				null,
				ie_obrigatorio_p,
				qt_pos_esquerda_p,
				cd_dominio_p,
				nr_seq_refer_w,
				vl_padrao_p,
				ds_complemento_p,
				ie_tipo_campo_p,
				ds_mascara_p,
				ds_regra_p,
				qt_altura_p,
				'S');
			end;
		end if;

		end;

	end if;
	end;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE med_inserir_item_avaliacao (ds_tipo_avaliacao_p text, ds_item_p text, nr_seq_apresent_p bigint, ie_resultado_p text, qt_decimais_p bigint, ds_unid_med_p text, qt_minimo_p bigint, qt_maximo_p bigint, qt_tamanho_p bigint, qt_desloc_direita_p bigint, nr_seq_superior_p bigint, ds_item_superior_p text, nr_seq_apres_superior_p bigint, ie_obrigatorio_p text, qt_pos_esquerda_p bigint, qt_altura_p bigint, cd_dominio_p bigint, nr_seq_item_ref_p bigint, ds_item_ref_p text, nr_seq_apres_ref_p bigint, vl_padrao_p text, ds_complemento_p text, ie_tipo_campo_p text, ds_mascara_p text, ds_regra_p text, nm_usuario_p text) FROM PUBLIC;

