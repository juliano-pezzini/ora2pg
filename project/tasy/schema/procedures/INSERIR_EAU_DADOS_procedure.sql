-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_eau_dados (ds_xml_p eau_issue_data.xml_send%type, nr_sequencia_p eau_issue_data.nr_seq_atestado_paciente%type, ds_email_origin_p eau_issue_data.ds_email_origin%type, ds_email_recipient_p eau_issue_data.ds_email_recipient%type, nm_computer_p eau_issue_data.nm_computer%type, ds_eau_id_p eau_issue_data.ds_eau_id%type, ie_tipo_p text, nr_seq_issue_p INOUT eau_issue_data.nr_sequencia%type ) AS $body$
DECLARE


ie_type_issue_c 	CONSTANT varchar(1) := 'E';
ie_status_c 		CONSTANT eau_issue_data.ie_status%TYPE := 'CAN';
ie_initial_status_c CONSTANT eau_issue_data.ie_status%TYPE := 'CRI';


BEGIN

if (ds_xml_p IS NOT NULL AND ds_xml_p::text <> '') then

	if (ie_tipo_p = ie_type_issue_c) then

		$if dbms_db_version.version >= 11 $then
			nr_seq_issue_p:=nextval('eau_issue_data_seq');
		$else
			SELECT nextval('eau_issue_data_seq') INTO STRICT nr_seq_issue_p;
		$end

		insert into eau_issue_data(
			nr_sequencia,
			ds_eau_id,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			dt_send,
			xml_send,
			nr_seq_atestado_paciente,
			ds_email_origin,
			ds_email_recipient,
			nm_computer,
			cd_perfil,
			cd_estabelecimento,
			ie_status
		) values (
			nr_seq_issue_p,
			ds_eau_id_p,
			clock_timestamp(),
			wheb_usuario_pck.get_nm_usuario,
			clock_timestamp(),
			wheb_usuario_pck.get_nm_usuario,
			clock_timestamp(),
			ds_xml_p,
			nr_sequencia_p,
			ds_email_origin_p,
			ds_email_recipient_p,
			nm_computer_p,
			wheb_usuario_pck.get_cd_perfil,
			wheb_usuario_pck.get_cd_estabelecimento,
			ie_initial_status_c);

	else
		update eau_issue_data
		set	xml_cancelation = ds_xml_p,
			dt_cancelation = clock_timestamp(),
			ie_status = ie_status_c
		where nr_sequencia = nr_sequencia_p;

		nr_seq_issue_p := nr_sequencia_p;
	end if;

end if;
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_eau_dados (ds_xml_p eau_issue_data.xml_send%type, nr_sequencia_p eau_issue_data.nr_seq_atestado_paciente%type, ds_email_origin_p eau_issue_data.ds_email_origin%type, ds_email_recipient_p eau_issue_data.ds_email_recipient%type, nm_computer_p eau_issue_data.nm_computer%type, ds_eau_id_p eau_issue_data.ds_eau_id%type, ie_tipo_p text, nr_seq_issue_p INOUT eau_issue_data.nr_sequencia%type ) FROM PUBLIC;

