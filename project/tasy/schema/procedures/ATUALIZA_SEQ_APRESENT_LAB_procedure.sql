-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualiza_seq_apresent_lab (nm_usuario_p text) AS $body$
DECLARE


nr_seq_exame1_w		bigint;
nr_seq_exame2_w		bigint;
nr_seq_exame3_w		bigint;
nr_seq_exame4_w		bigint;
nr_seq_exame5_w		bigint;

nr_seq_apresent1_w	bigint;
nr_seq_apresent2_w	bigint;
nr_seq_apresent3_w	bigint;
nr_seq_apresent4_w	bigint;
nr_seq_apresent5_w	bigint;
nr_seq_grupo_w		bigint;

c10 CURSOR FOR
	SELECT 	nr_sequencia
	from 	grupo_exame_lab
	order by ds_grupo_exame_lab;

c01 CURSOR FOR
	SELECT 	nr_seq_exame
	from	exame_laboratorio
	where 	coalesce(nr_seq_superior::text, '') = ''
	and	nr_seq_grupo = nr_seq_grupo_w
	order by nm_exame;

c02 CURSOR FOR
	SELECT 	nr_seq_exame
	from	exame_laboratorio
	where 	nr_seq_superior = nr_seq_exame1_w
	order by nm_exame;

c03 CURSOR FOR
	SELECT 	nr_seq_exame
	from	exame_laboratorio
	where 	nr_seq_superior = nr_seq_exame2_w
	order by nm_exame;

c04 CURSOR FOR
	SELECT 	nr_seq_exame
	from	exame_laboratorio
	where 	nr_seq_superior = nr_seq_exame3_w
	order by nm_exame;

c05 CURSOR FOR
	SELECT 	nr_seq_exame
	from	exame_laboratorio
	where 	nr_seq_superior = nr_seq_exame4_w
	order by nm_exame;

BEGIN

nr_seq_apresent1_w := 0;
OPEN C10;
LOOP
FETCH C10 into
	nr_seq_grupo_w;
EXIT WHEN NOT FOUND; /* apply on c10 */

	nr_seq_apresent1_w := nr_seq_apresent1_w + 1000000;

	OPEN C01;
	LOOP
	FETCH C01 into
		nr_seq_exame1_w;
	EXIT WHEN NOT FOUND; /* apply on c01 */
		begin

		nr_seq_apresent1_w := nr_seq_apresent1_w + 1000000;

		update	exame_laboratorio
		set	nr_Seq_apresent = nr_seq_apresent1_w
		where	nr_seq_exame = nr_seq_exame1_w;

		nr_seq_apresent2_w := nr_seq_apresent1_w + 100000;
		OPEN C02;
		LOOP
		FETCH C02 into
			nr_seq_exame2_w;
		EXIT WHEN NOT FOUND; /* apply on c02 */

			nr_seq_apresent2_w := nr_seq_apresent2_w + 100000;

			update	exame_laboratorio
			set	nr_Seq_apresent = nr_seq_apresent2_w
			where	nr_seq_exame = nr_seq_exame2_w;


			nr_seq_apresent3_w := nr_seq_apresent2_w + 1000;
			OPEN C03;
			LOOP
			FETCH C03 into
				nr_seq_exame3_w;
			EXIT WHEN NOT FOUND; /* apply on c03 */

				nr_seq_apresent3_w := nr_seq_apresent3_w + 1000;

				update	exame_laboratorio
				set	nr_Seq_apresent = nr_seq_apresent3_w
				where	nr_seq_exame = nr_seq_exame3_w;


				nr_seq_apresent4_w := nr_seq_apresent3_w + 100;
				OPEN C04;
				LOOP
				FETCH C04 into
					nr_seq_exame4_w;
				EXIT WHEN NOT FOUND; /* apply on c04 */

					nr_seq_apresent4_w := nr_seq_apresent4_w + 100;

					update	exame_laboratorio
					set	nr_Seq_apresent = nr_seq_apresent4_w
					where	nr_seq_exame = nr_seq_exame4_w;



					nr_seq_apresent5_w := nr_seq_apresent4_w + 10;
					OPEN C05;
					LOOP
					FETCH C05 into
						nr_seq_exame5_w;
					EXIT WHEN NOT FOUND; /* apply on c05 */

						nr_seq_apresent5_w := nr_seq_apresent5_w + 10;

						update	exame_laboratorio
						set	nr_Seq_apresent = nr_seq_apresent5_w
						where	nr_seq_exame = nr_seq_exame5_w;


					end loop;
					close c05;


				end loop;
				close c04;




			end loop;
			close c03;

		end loop;
		close c02;

		end;
	END LOOP;
	CLOSE C01;
END LOOP;
CLOSE C10;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualiza_seq_apresent_lab (nm_usuario_p text) FROM PUBLIC;

