-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ctb_iniciar_param_tipo_lote ( cd_empresa_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text, cd_tipo_lote_contabil_p bigint default null, cd_estab_exclusivo_p bigint default null) AS $body$
DECLARE


nr_seq_regra_geracao_w  ctb_regra_geracao_lote.nr_sequencia%type;

/* Lista de Tipo de Lote Contabil*/

c010 CURSOR FOR
SELECT  coalesce(a.cd_tipo_lote_contabil,0) cd_tipo_lote_contabil
from    tipo_lote_contabil a
where   cd_tipo_lote_contabil in (2,3,5,6,7,8,9,10,11,14,16,17,18,25,26,29)
and (cd_tipo_lote_contabil = cd_tipo_lote_contabil_p or coalesce(cd_tipo_lote_contabil_p::text, '') = '')
order   by a.cd_tipo_lote_contabil;

BEGIN

for r010 in c010 loop
        begin
        if (r010.cd_tipo_lote_contabil = 2) then
                begin
                delete  FROM ctb_param_lote_nf a
                where   a.cd_empresa = cd_empresa_p
                and     coalesce(a.cd_estab_exclusivo, 0) = coalesce(cd_estab_exclusivo_p,0);

                /* CTB_PARAM_LOTE_NF => PARAMETRO_ESTOQUE, PARAMETRO_COMPRAS */

                insert  into ctb_param_lote_nf(
                        nr_sequencia,
                        cd_empresa,
                        cd_estab_exclusivo,
                        ie_ctb_online,
                        dt_atualizacao,
                        nm_usuario,
                        dt_atualizacao_nrec,
                        nm_usuario_nrec,
                        ie_contab_nf_estab,
                        ie_data_contab_nf,
                        ie_data_contab_est_nf,
                        ie_contab_trib_retido,
                        ie_contab_nf_compl )
                SELECT  nextval('ctb_param_lote_nf_seq') ,
                        cd_empresa_p,
                        cd_estab_exclusivo_p,
                        'N',
                        clock_timestamp() ,
                        nm_usuario_p,
                        clock_timestamp() ,
                        nm_usuario_p,
                        ie_contab_nf_estab,
                        ie_data_contab_nf,
                        ie_data_contab_est_nf,
                        ie_contab_trib_retido,
                        ie_contab_nf_compl
                from    parametro_estoque
                where   cd_estabelecimento = cd_estabelecimento_p;
                end;
        elsif (r010.cd_tipo_lote_contabil = 3) then
                begin
                delete  FROM ctb_param_lote_consumo a
                where   a.cd_empresa = cd_empresa_p
                and     coalesce(a.cd_estab_exclusivo, 0) = coalesce(cd_estab_exclusivo_p,0);

                /* CTB_PARAM_LOTE_CONSUMO => PARAMETRO_ESTOQUE */

                insert  into ctb_param_lote_consumo(
                        nr_sequencia,
                        dt_atualizacao,
                        nm_usuario,
                        dt_atualizacao_nrec,
                        nm_usuario_nrec,
                        cd_empresa,
                        cd_estab_exclusivo,
                        ie_ctb_online,
                        cd_historico,
                        cd_hist_transf_entrada,
                        cd_hist_transf_saida,
                        ie_mes_contab,
                        ie_historico_evento_oper,
                        ie_contab_consignado )
                SELECT  nextval('ctb_param_lote_consumo_seq') ,
                        clock_timestamp() ,
                        nm_usuario_p,
                        clock_timestamp() ,
                        nm_usuario_p,
                        cd_empresa_p,
                        cd_estab_exclusivo_p,
                        'N',
                        null,
                        cd_hist_transf_entrada,
                        cd_hist_transf_saida,
                        ie_mes_contab,
                        ie_historico_evento_oper,
                        ie_contab_consignado
                from    parametro_estoque
                where   coalesce(cd_estabelecimento, cd_estabelecimento_p) = cd_estabelecimento_p;
                end;
        elsif (r010.cd_tipo_lote_contabil = 5) then
                begin
                delete  FROM ctb_param_lote_contas_rec a
                where   a.cd_empresa = cd_empresa_p
                and     coalesce(a.cd_estab_exclusivo, 0) = coalesce(cd_estab_exclusivo_p,0);

                /* CTB_PARAM_LOTE_CONTAS_REC => PARAMETRO_CONTAS_RECEBER */

                insert  into ctb_param_lote_contas_rec(
                        nr_sequencia,
                        dt_atualizacao,
                        nm_usuario,
                        dt_atualizacao_nrec,
                        nm_usuario_nrec,
                        cd_empresa,
                        cd_estab_exclusivo,
                        ie_ctb_online,
                        ie_cc_glosa,
                        ie_contab_cartao_cr,
                        ie_contab_classif_tit_rec,
                        ie_contab_curto_prazo,
                        ie_contab_desp_cartao,
                        ie_contab_glosa_crit,
                        ie_contab_glosa_detalhe,
                        ie_contab_prov_contrato,
                        ie_contab_rec_classif,
                        ie_contab_tit_cancelado,
                        ie_contab_tit_desdob,
                        ie_contab_trans_fin_baixa,
                        ie_contab_vl_estorno,
                        ie_dt_contab_cr,
                        ie_dt_contab_glosa,
                        ie_gerar_contab_reg_tit,
                        ie_movto_cartao_estab,
                        ie_prod_classif_baixa,
                        ie_contab_pj_convenio)
                SELECT  nextval('ctb_param_lote_contas_rec_seq') ,
                        clock_timestamp(),
                        nm_usuario_p,
                        clock_timestamp(),
                        nm_usuario_p,
                        cd_empresa_p,
                        cd_estab_exclusivo_p,
                        'N',
                        ie_cc_glosa,
                        ie_contab_cartao_cr,
                        ie_contab_classif_tit_rec,
                        ie_contab_curto_prazo,
                        ie_contab_desp_cartao,
                        ie_contab_glosa_crit,
                        ie_contab_glosa_detalhe,
                        ie_contab_prov_contrato,
                        ie_contab_rec_classif,
                        ie_contab_tit_cancelado,
                        ie_contab_tit_desdob,
                        ie_contab_trans_fin_baixa,
                        ie_contab_vl_estorno,
                        ie_dt_contab_cr,
                        ie_dt_contab_glosa,
                        ie_gerar_contab_reg_tit,
                        ie_movto_cartao_estab,
                        ie_prod_classif_baixa,
                        ie_contab_pj_convenio
                from    parametro_contas_receber
                where   coalesce(cd_estabelecimento, cd_estabelecimento_p) = cd_estabelecimento_p;
                end;
        elsif (r010.cd_tipo_lote_contabil = 6) then
                begin
                delete  FROM ctb_param_lote_receita a
                where   a.cd_empresa = cd_empresa_p
                and     coalesce(a.cd_estab_exclusivo, 0) = coalesce(cd_estab_exclusivo_p,0);

                /* CTB_PARAM_LOTE_RECEITA           => PARAMETRO_FATURAMENTO  */

                insert  into ctb_param_lote_receita(
                        nr_sequencia,
                        dt_atualizacao,
                        nm_usuario,
                        dt_atualizacao_nrec,
                        nm_usuario_nrec,
                        cd_empresa,
                        cd_estab_exclusivo,
                        ie_ctb_online,
                        cd_conta_contabil_tx_adm,
                        cd_conta_repasse_rec,
                        ie_contab_cc_debito,
                        ie_contab_desconto_rec,
                        ie_contab_nf_estorno,
                        ie_contab_repasse_receita,
                        ie_conta_convenio_estab,
                        ie_estorno_conta_contab_redut,
                        ie_lote_ctb_trib_nf,
                        ie_origem_contab_trib_rec,
                        ie_regra_centro_estab,
                        ie_titulo_ctb_receita)
                SELECT  nextval('ctb_param_lote_receita_seq') ,
                        clock_timestamp() ,
                        nm_usuario_p,
                        clock_timestamp() ,
                        nm_usuario_p,
                        cd_empresa_p,
                        cd_estab_exclusivo_p,
                        'N',
                        cd_conta_contabil_tx_adm,
                        cd_conta_repasse_rec,
                        ie_contab_cc_debito,
                        ie_contab_desconto_rec,
                        ie_contab_nf_estorno,
                        ie_contab_repasse_receita,
                        ie_conta_convenio_estab,
                        ie_estorno_conta_contab_redut,
                        ie_lote_ctb_trib_nf,
                        ie_origem_contab_trib_rec,
                        ie_regra_centro_estab,
                        ie_titulo_ctb_receita
                from    parametro_faturamento
                where   coalesce(cd_estabelecimento, cd_estabelecimento_p) = cd_estabelecimento_p;
                end;
        elsif (r010.cd_tipo_lote_contabil = 7) then
                begin
                delete  FROM ctb_param_lote_contas_pag a
                where   a.cd_empresa = cd_empresa_p
                and     coalesce(a.cd_estab_exclusivo, 0) = coalesce(cd_estab_exclusivo_p,0);

                /* CTB_PARAM_LOTE_CONTAS_PAGAR  => PARAMETRO_CONTAS_PAGAR    */

                insert  into ctb_param_lote_contas_pag(
                        nr_sequencia,
                        dt_atualizacao,
                        nm_usuario,
                        dt_atualizacao_nrec,
                        nm_usuario_nrec,
                        cd_empresa,
                        cd_estab_exclusivo,
                        ie_ctb_online,
                        ie_benef_orig_trib_contab,
                        ie_contab_adiant_dev_cp,
                        ie_contab_classif,
                        ie_contab_classif_baixa,
                        ie_contab_cp_estab,
                        ie_contab_curto_prazo,
                        ie_contab_imposto,
                        ie_contab_prov_adiant_pago,
                        ie_contab_provisorio,
                        ie_contab_prov_tributo,
                        ie_contab_tit_adiant,
                        ie_contab_tit_bloqueto,
                        ie_contab_tit_cancelado,
                        ie_contab_tit_contrato,
                        ie_contab_tit_desdob,
                        ie_contab_trans_fin_baixa,
                        ie_contab_trib_nota,
                        ie_contab_vl_original,
                        ie_conta_contab_tit_adiant,
                        ie_dt_movto_contab_cp,
                        ie_estab_dif_provisao,
                        ie_gerar_contab_reg_tit,
                        ie_tit_contab_baixa)
                SELECT  nextval('ctb_param_lote_contas_pag_seq'),
                        clock_timestamp(),
                        nm_usuario_p,
                        clock_timestamp(),
                        nm_usuario_p,
                        cd_empresa_p,
                        cd_estab_exclusivo_p,
                        'N',
                        ie_benef_orig_trib_contab,
                        ie_contab_adiant_dev_cp,
                        ie_contab_classif,
                        ie_contab_classif_baixa,
                        ie_contab_cp_estab,
                        ie_contab_curto_prazo,
                        ie_contab_imposto,
                        ie_contab_prov_adiant_pago,
                        ie_contab_provisorio,
                        ie_contab_prov_tributo,
                        ie_contab_tit_adiant,
                        ie_contab_tit_bloqueto,
                        ie_contab_tit_cancelado,
                        ie_contab_tit_contrato,
                        ie_contab_tit_desdob,
                        ie_contab_trans_fin_baixa,
                        ie_contab_trib_nota,
                        ie_contab_vl_original,
                        ie_conta_contab_tit_adiant,
                        ie_dt_movto_contab_cp,
                        ie_estab_dif_provisao,
                        ie_gerar_contab_reg_tit,
                        ie_tit_contab_baixa
                from    parametros_contas_pagar
                where   coalesce(cd_estabelecimento, cd_estabelecimento_p) = cd_estabelecimento_p;
                end;
        elsif (r010.cd_tipo_lote_contabil = 8) then
                begin
                delete  FROM ctb_param_lote_pre_fatur a
                where   a.cd_empresa = cd_empresa_p
                and     coalesce(a.cd_estab_exclusivo, 0) = coalesce(cd_estab_exclusivo_p,0);

                /* CTB_PARAM_LOTE_PRE_FATUR     => PARAMETRO_FATURAMENTO                     */

                insert  into ctb_param_lote_pre_fatur(
                        nr_sequencia,
                        dt_atualizacao,
                        nm_usuario,
                        dt_atualizacao_nrec,
                        nm_usuario_nrec,
                        cd_empresa,
                        cd_estab_exclusivo,
                        ie_ctb_online,
                        ie_despesa_pre_fatur,
                        ie_contab_repasse_prefatur,
                        ie_contab_cc_debito,
                        ie_contab_sus_prefatur,
                        ie_regra_centro_estab,
                        cd_historico,
                        cd_conta_debito,
                        cd_conta_repasse
                        )
                SELECT  nextval('ctb_param_lote_pre_fatur_seq') ,
                        clock_timestamp() ,
                        nm_usuario_p,
                        clock_timestamp() ,
                        nm_usuario_p,
                        cd_empresa_p,
                        cd_estab_exclusivo_p,
                        'N',
                        ie_despesa_pre_fatur,
                        ie_contab_repasse_prefatur,
                        ie_contab_cc_debito,
                        ie_contab_sus_prefatur,
                        ie_regra_centro_estab,
                        c.vl_parametro cd_historico,
                        d.ds_valor_parametro cd_conta_debito,
                        e.ds_valor_parametro cd_conta_repasse
                from    parametro_faturamento a,
                        lote_contabil_parametro c,
                        lote_contabil_parametro d,
                        lote_contabil_parametro e
                where   coalesce(a.cd_estabelecimento, cd_estabelecimento_p) = cd_estabelecimento_p
                and     c.cd_tipo_lote_contabil = 8
                and     c.nr_seq_parametro = 1
                and     d.nr_lote_contabil = c.nr_lote_contabil
                and     d.nr_seq_parametro = 2
                and     e.nr_lote_contabil = d.nr_lote_contabil
                and     e.nr_seq_parametro = 3
                and     c.nr_lote_contabil = (
                        SELECT max(a.nr_lote_contabil)
                        from   lote_contabil a
                        where  a.cd_tipo_lote_contabil = 8
                        and    a.cd_estabelecimento = cd_estabelecimento_p
                        and exists (
                            select 1
                            from   lote_contabil_parametro b
                            where  b.nr_lote_contabil = a.nr_lote_contabil
                            and    b.nr_seq_parametro = 1
                            and    coalesce(b.vl_parametro,0) <> 0
                        )
                );
                end;
        elsif (r010.cd_tipo_lote_contabil = 9) then
                begin
                delete  FROM ctb_param_lote_cont_terc a
                where   a.cd_empresa = cd_empresa_p
                and     coalesce(a.cd_estab_exclusivo, 0) = coalesce(cd_estab_exclusivo_p,0);

                /*CTB_PARAM_LOTE_CONT_TERC  => PARAMETRO_CONTAS_RECEBER     */

                insert  into ctb_param_lote_cont_terc(
                        nr_sequencia,
                        dt_atualizacao,
                        nm_usuario,
                        dt_atualizacao_nrec,
                        nm_usuario_nrec,
                        cd_empresa,
                        cd_estab_exclusivo,
                        ie_ctb_online,
                        ie_contab_som_terc_conta)
                SELECT  nextval('ctb_param_lote_cont_terc_seq') ,
                        clock_timestamp() ,
                        nm_usuario_p,
                        clock_timestamp() ,
                        nm_usuario_p,
                        cd_empresa_p,
                        cd_estab_exclusivo_p,
                        'N',
                        ie_contab_som_terc_conta
                from    parametro_contas_receber
                where   coalesce(cd_estabelecimento, cd_estabelecimento_p) = cd_estabelecimento_p;
                end;
        elsif (r010.cd_tipo_lote_contabil = 10) then
                begin
                delete  FROM ctb_param_lote_tesouraria a
                where   a.cd_empresa = cd_empresa_p
                and     coalesce(a.cd_estab_exclusivo, 0) = coalesce(cd_estab_exclusivo_p,0);

                /*CTB_PARAM_LOTE_TESOURARIA     => PARAMETRO_TESOURARIA     */

                insert  into ctb_param_lote_tesouraria(
                        nr_sequencia,
                        dt_atualizacao,
                        nm_usuario,
                        dt_atualizacao_nrec,
                        nm_usuario_nrec,
                        cd_historico_cred,
                        cd_empresa,
                        cd_estab_exclusivo,
                        ie_ctb_online,
                        cd_historico,
                        ie_contab_monet_docto,
                        ie_contab_transf_caixa,
                        ie_contab_cr,
                        ie_contab_cp,
                        ie_contab_monet_regra,
                        ie_contab_trans_fin_baixa)
                SELECT  nextval('ctb_param_lote_tesouraria_seq'),
                        clock_timestamp() ,
                        nm_usuario_p,
                        clock_timestamp() ,
                        nm_usuario_p,
                        cd_historico_cred,
                        cd_empresa_p,
                        cd_estab_exclusivo_p,
                        'N',
                        cd_historico,
                        ie_contab_monet_docto,
                        ie_contab_transf_caixa,
                        ie_contab_cr,
                        ie_contab_cp,
                        ie_contab_monet_regra,
                        ie_contab_trans_fin_baixa
                from    parametro_tesouraria
                where   coalesce(cd_estabelecimento, cd_estabelecimento_p) = cd_estabelecimento_p;
                end;
        elsif (r010.cd_tipo_lote_contabil = 11) then
                begin
                delete  FROM ctb_param_lote_receb_conv a
                where   a.cd_empresa = cd_empresa_p
                and     coalesce(a.cd_estab_exclusivo, 0) = coalesce(cd_estab_exclusivo_p,0);

                /* CTB_PARAM_LOTE_RECEB_CONVENIO    => PARAMETRO_CONTAS_RECEBER  */

                insert  into ctb_param_lote_receb_conv(
                        nr_sequencia,
                        dt_atualizacao,
                        nm_usuario,
                        dt_atualizacao_nrec,
                        nm_usuario_nrec,
                        cd_empresa,
                        cd_estab_exclusivo,
                        ie_ctb_online,
                        ie_contab_estorno_receb,
                        ie_contab_vl_adic_estorno,
                        ie_dt_contab_conv_receb)
                SELECT  nextval('ctb_param_lote_receb_conv_seq'),
                        clock_timestamp() ,
                        nm_usuario_p,
                        clock_timestamp() ,
                        nm_usuario_p,
                        cd_empresa_p,
                        cd_estab_exclusivo_p,
                        'N',
                        ie_contab_estorno_receb,
                        ie_contab_vl_adic_estorno,
                        ie_dt_contab_conv_receb
                from    parametro_contas_receber
                where   coalesce(cd_estabelecimento, cd_estabelecimento_p) = cd_estabelecimento_p;
                end;
        elsif (r010.cd_tipo_lote_contabil = 14) then
                begin
                delete  FROM ctb_param_lote_repasse a
                where   a.cd_empresa = cd_empresa_p
                and     coalesce(a.cd_estab_exclusivo, 0) = coalesce(cd_estab_exclusivo_p,0);

                /* CTB_PARAM_LOTE_REPASSE => PARAMETRO_REPASSE       */

                insert  into ctb_param_lote_repasse(
                        nr_sequencia,
                        dt_atualizacao,
                        nm_usuario,
                        dt_atualizacao_nrec,
                        nm_usuario_nrec,
                        cd_empresa,
                        cd_estab_exclusivo,
                        ie_ctb_online,
                        cd_historico,
                        ie_processo_ctb,
                        cd_convenio_sus,
                        ie_contab_sus_receita)
                SELECT  nextval('ctb_param_lote_repasse_seq'),
                        clock_timestamp() ,
                        nm_usuario_p,
                        clock_timestamp() ,
                        nm_usuario_p,
                        cd_empresa_p,
                        cd_estab_exclusivo_p,
                        'N',
                        null,
                        'S',
                        null,
                        'N'
                from    parametro_repasse
                where   coalesce(cd_estabelecimento, cd_estabelecimento_p) = cd_estabelecimento_p;
                end;
        elsif (r010.cd_tipo_lote_contabil = 16) then
                begin
                delete  FROM ctb_param_lote_tit_repasse  a
                where   a.cd_empresa = cd_empresa_p
                and     coalesce(a.cd_estab_exclusivo, 0) = coalesce(cd_estab_exclusivo_p,0);

                /* CTB_PARAM_LOTE_TIT_REPASSE => PARAMETROS_CONTAS_PAGAR */

                insert  into ctb_param_lote_tit_repasse(
                        nr_sequencia,
                        dt_atualizacao,
                        nm_usuario,
                        dt_atualizacao_nrec,
                        nm_usuario_nrec,
                        cd_empresa,
                        cd_estab_exclusivo,
                        nr_seq_trans_repasse,
                        nr_seq_trans_glosa_rep,
                        ie_ctb_online,
                        nr_seq_trans_maior_rep,
                        ie_cc_rep_maior_glosa,
                        ie_cc_repasse,
                        ie_dt_movto_contab_tit_rep,
                        ie_dt_tit_trib_orig,
                        ie_data_contab_tit_rep,
                        ie_contab_item_tit_rep,
                        ie_periodo_contab_tit_rep,
                        ie_contab_item_rep_liq,
                        ie_contab_tit_rep_desdob,
                        ie_contab_trib_repasse_cc,
                        ie_contab_repasse_venc,
                        ie_contab_classif_tit_rep,
                        ie_rep_contab_vl_liberado  )
                SELECT  nextval('ctb_param_lote_tit_repasse_seq') ,
                        clock_timestamp() ,
                        nm_usuario_p,
                        clock_timestamp() ,
                        nm_usuario_p,
                        cd_empresa_p,
                        cd_estab_exclusivo_p,
                        nr_seq_trans_repasse,
                        nr_seq_trans_glosa_rep,
                        'N',
                        nr_seq_trans_maior_rep,
                        ie_cc_rep_maior_glosa,
                        ie_cc_repasse,
                        ie_dt_movto_contab_tit_rep,
                        ie_dt_tit_trib_orig,
                        ie_data_contab_tit_rep,
                        ie_contab_item_tit_rep,
                        ie_periodo_contab_tit_rep,
                        ie_contab_item_rep_liq,
                        ie_contab_tit_rep_desdob,
                        ie_contab_trib_repasse_cc,
                        ie_contab_repasse_venc,
                        ie_contab_classif_tit_rep,
                        ie_rep_contab_vl_liberado
                from    parametros_contas_pagar
                where   coalesce(cd_estabelecimento, cd_estabelecimento_p) = cd_estabelecimento_p;
                end;
        elsif (r010.cd_tipo_lote_contabil = 17) then
                begin
                delete  FROM ctb_param_lote_patrimonio a
                where   a.cd_empresa = cd_empresa_p
                and     coalesce(a.cd_estab_exclusivo, 0) = coalesce(cd_estab_exclusivo_p,0);

                /*CTB_PARAM_LOTE_PATRIMONIO     => PAT_PARAM_CONTABIL   */

                insert  into ctb_param_lote_patrimonio(
                        nr_sequencia,
                        dt_atualizacao,
                        nm_usuario,
                        dt_atualizacao_nrec,
                        nm_usuario_nrec,
                        cd_empresa,
                        cd_estab_exclusivo,
                        ie_ctb_online,
                        ie_contab_rateio_deprec,
                        IE_TAXA_DEPRECIACAO)
                SELECT  nextval('ctb_param_lote_patrimonio_seq') ,
                        clock_timestamp() ,
                        nm_usuario_p,
                        clock_timestamp() ,
                        nm_usuario_p,
                        cd_empresa_p,
                        cd_estab_exclusivo_p,
                        'N',
                        ie_contab_rateio_deprec,
                        IE_TAXA_DEPRECIACAO
                from    pat_param_contabil
                where   coalesce(cd_estabelecimento, cd_estabelecimento_p) = cd_estabelecimento_p;
                end;
        elsif (r010.cd_tipo_lote_contabil = 18) then
                begin
                delete  FROM ctb_param_lote_cont_banco a
                where   a.cd_empresa = cd_empresa_p
                and     coalesce(a.cd_estab_exclusivo, 0) = coalesce(cd_estab_exclusivo_p,0);

                /* CTB_PARAM_LOTE_CONT_BANCO    => PARAMETRO_CONTROLE_BANC   */

                insert  into ctb_param_lote_cont_banco(
                        nr_sequencia,
                        dt_atualizacao,
                        nm_usuario,
                        dt_atualizacao_nrec,
                        nm_usuario_nrec,
                        cd_empresa,
                        cd_estab_exclusivo,
                        ie_ctb_online,
                        ie_contab_cp_no_cb,
                        ie_contab_cr_no_cb,
                        ie_contab_transit_cr,
                        ie_contab_transit_tf,
                        ie_contab_vl_estorno,
                        ie_movto_tf_estab)
                SELECT  nextval('ctb_param_lote_cont_banco_seq') ,
                        clock_timestamp() ,
                        nm_usuario_p,
                        clock_timestamp() ,
                        nm_usuario_p,
                        cd_empresa_p,
                        cd_estab_exclusivo_p,
                        'N',
                        ie_contab_cp_no_cb,
                        ie_contab_cr_no_cb,
                        ie_contab_transit_cr,
                        ie_contab_transit_tf,
                        ie_contab_vl_estorno,
                        ie_movto_tf_estab
                from    parametro_controle_banc
                where   coalesce(cd_estabelecimento, cd_estabelecimento_p) = cd_estabelecimento_p;
                end;
        elsif (r010.cd_tipo_lote_contabil = 25) then
                begin
                delete  FROM ctb_param_lote_producao a
                where   a.cd_empresa = cd_empresa_p
                and     coalesce(a.cd_estab_exclusivo, 0) = coalesce(cd_estab_exclusivo_p,0);

                /* CTB_PARAM_LOTE_PRODUCAO  => PARAMETRO_ESTOQUE */

                insert  into ctb_param_lote_producao(
                        nr_sequencia,
                        dt_atualizacao,
                        nm_usuario,
                        dt_atualizacao_nrec,
                        nm_usuario_nrec,
                        cd_oper_baixa_producao,
                        cd_empresa,
                        cd_estab_exclusivo,
                        ie_ctb_online,
                        cd_historico,
                        ie_valor_lote_prod,
                        ie_data_contab_lote_prod)
                SELECT  nextval('ctb_param_lote_producao_seq') ,
                        clock_timestamp() ,
                        nm_usuario_p,
                        clock_timestamp() ,
                        nm_usuario_p,
                        cd_oper_baixa_producao,
                        cd_empresa_p,
                        cd_estab_exclusivo_p,
                        'N',
                        null,
                        ie_valor_lote_prod,
                        ie_data_contab_lote_prod
                from    parametro_estoque a
                where   coalesce(a.cd_estabelecimento, cd_estabelecimento_p) = cd_estabelecimento_p;
                end;
        elsif (r010.cd_tipo_lote_contabil = 26) then
                begin
                delete  FROM ctb_param_lote_consignado a
                where   a.cd_empresa = cd_empresa_p
                and     coalesce(a.cd_estab_exclusivo, 0) = coalesce(cd_estab_exclusivo_p,0);

                /* CTB_PARAM_LOTE_CONSIGNADO => PARAMETRO_COMPRAS */

                insert  into ctb_param_lote_consignado(
                        nr_sequencia,
                        dt_atualizacao,
                        nm_usuario,
                        dt_atualizacao_nrec,
                        nm_usuario_nrec,
                        cd_empresa,
                        cd_estab_exclusivo,
                        ie_ctb_online,
                        cd_historico,
                        cd_conta_credito,
                        ie_tipo_ordem_compra,
                        ie_contab_oc_cancel)
                SELECT  nextval('ctb_param_lote_consignado_seq') ,
                        clock_timestamp() ,
                        nm_usuario_p,
                        clock_timestamp() ,
                        nm_usuario_p,
                        cd_empresa_p,
                        cd_estab_exclusivo_p,
                        'N',
                        null,
                        null,
                        null,
                        ie_contab_oc_cancel
                from    parametro_compras
                where   coalesce(cd_estabelecimento, cd_estabelecimento_p) = cd_estabelecimento_p;
                end;
        elsif (r010.cd_tipo_lote_contabil = 29) then
                begin
                delete  FROM ctb_param_lote_nota_cred a
                where   a.cd_empresa = cd_empresa_p
                and     coalesce(a.cd_estab_exclusivo, 0) = coalesce(cd_estab_exclusivo_p,0);

                /* CTB_PARAM_LOTE_NOTA_CRED =>  null    */

                insert  into ctb_param_lote_nota_cred(
                        nr_sequencia,
                        dt_atualizacao,
                        nm_usuario,
                        dt_atualizacao_nrec,
                        nm_usuario_nrec,
                        cd_empresa,
                        cd_estab_exclusivo,
                        ie_ctb_online )
                values (nextval('ctb_param_lote_nota_cred_seq'),
                        clock_timestamp(),
                        nm_usuario_p,
                        clock_timestamp(),
                        nm_usuario_p,
                        cd_empresa_p,
                        cd_estab_exclusivo_p,
                        'N');
                end;
        end if;
        end;

        begin
        if (r010.cd_tipo_lote_contabil <> 6) then
                begin
                select  a.nr_sequencia
                into STRICT    nr_seq_regra_geracao_w
                from    ctb_regra_geracao_lote a
                where   a.cd_tipo_lote_contabil   = r010.cd_tipo_lote_contabil
                and     coalesce(cd_estab_exclusivo,0) = coalesce(cd_estab_exclusivo_p,0)
                and     a.cd_empresa              = cd_empresa_p;
                exception when no_data_found then
                        nr_seq_regra_geracao_w  := 0;
                when others then
                        nr_seq_regra_geracao_w := null;
                end;

                if (nr_seq_regra_geracao_w = 0) then
                        begin
                        insert into ctb_regra_geracao_lote(
                                nr_sequencia,
                                cd_tipo_lote_contabil,
                                cd_empresa,
                                cd_estab_exclusivo,
                                ie_periodo,
                                qt_periodo,
                                dt_atualizacao,
                                nm_usuario,
                                dt_atualizacao_nrec,
                                nm_usuario_nrec)
                        values ( nextval('ctb_regra_geracao_lote_seq'),
                                r010.cd_tipo_lote_contabil,
                                cd_empresa_p,
                                cd_estab_exclusivo_p,
                                'M',
                                1,
                                clock_timestamp(),
                                nm_usuario_p,
                                clock_timestamp(),
                                nm_usuario_p);
                        end;
                end if;
        else
                begin
                select  a.nr_sequencia
                into STRICT    nr_seq_regra_geracao_w
                from    ctb_regra_geracao_lote_rec a
                where   coalesce(cd_estab_exclusivo,0) = coalesce(cd_estab_exclusivo_p,0)
                and     a.cd_empresa = cd_empresa_p;
                exception when no_data_found then
                        nr_seq_regra_geracao_w  := 0;
                when others then
                        nr_seq_regra_geracao_w := null;
                end;

                begin
                if (nr_seq_regra_geracao_w = 0) then
                        insert into ctb_regra_geracao_lote_rec(
                                cd_convenio,
                                cd_empresa,
                                cd_estab_exclusivo,
                                dt_atualizacao,
                                dt_atualizacao_nrec,
                                ie_geracao,
                                ie_periodo,
                                ie_tipo_convenio,
                                nm_usuario,
                                nm_usuario_nrec,
                                nr_sequencia,
                                qt_periodo
                        ) values (
                                null,
                                cd_empresa_p,
                                cd_estab_exclusivo_p,
                                clock_timestamp(),
                                clock_timestamp(),
                                'FPR',
                                'M',
                                null,
                                nm_usuario_p,
                                nm_usuario_p,
                                nextval('ctb_regra_geracao_lote_rec_seq'),
                                1);
                end if;
                end;
        end if;
        end;
end loop;

commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ctb_iniciar_param_tipo_lote ( cd_empresa_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text, cd_tipo_lote_contabil_p bigint default null, cd_estab_exclusivo_p bigint default null) FROM PUBLIC;

