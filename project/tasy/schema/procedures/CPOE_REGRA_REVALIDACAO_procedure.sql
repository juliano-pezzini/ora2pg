-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cpoe_regra_revalidacao (cd_setor_atendimento_p bigint, cd_perfil_p bigint, nm_usuario_p text, nr_seq_revalidation_rule_p INOUT bigint, dt_hora_fim_revalidacao_p INOUT timestamp , qt_horas_anterior_p INOUT bigint , qt_dias_revalidacao_p INOUT bigint) AS $body$
DECLARE



c01 CURSOR FOR
SELECT	nr_sequencia,
		dt_hora_fim_revalidacao,
		qt_horas_anterior,
		qt_dias_revalidacao
from	cpoe_revalidation_rule
where	((coalesce(cd_setor_atendimento::text, '') = '') or (cd_setor_atendimento_p = cd_setor_atendimento))
and		((coalesce(cd_perfil::text, '') = '') or (cd_perfil_p = cd_perfil))
and		((coalesce(nm_usuario_regra::text, '') = '') or (nm_usuario_p = nm_usuario_regra))
and 	coalesce(ie_situacao, 'A') = 'A'
and		cd_estabelecimento = wheb_usuario_pck.get_cd_estabelecimento
order by	coalesce(nm_usuario_regra, 'ZXPTO') desc, coalesce(cd_perfil, 9999) desc, coalesce(cd_setor_atendimento, 9999) desc;


BEGIN

open c01;
loop
fetch c01 into
	nr_seq_revalidation_rule_p,
		dt_hora_fim_revalidacao_p,
        qt_horas_anterior_p,
        qt_dias_revalidacao_p;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin
		null;
	end;
end loop;
close c01;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_regra_revalidacao (cd_setor_atendimento_p bigint, cd_perfil_p bigint, nm_usuario_p text, nr_seq_revalidation_rule_p INOUT bigint, dt_hora_fim_revalidacao_p INOUT timestamp , qt_horas_anterior_p INOUT bigint , qt_dias_revalidacao_p INOUT bigint) FROM PUBLIC;

