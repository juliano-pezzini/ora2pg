-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_duplicar_solic_lib_mat_med ( nr_seq_solic_mat_med_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_seq_solic_lib_mat_med_w	bigint;
ds_texto_w			varchar(1000);


BEGIN

select	nextval('pls_solic_lib_mat_med_seq')
into STRICT	nr_seq_solic_lib_mat_med_w
;

insert into pls_solic_lib_mat_med(nr_sequencia, dt_solicitacao, dt_utilizacao,
	nr_seq_prestador, ds_material, ds_marca,
	ds_fornecedor, ds_principio_ativo, cd_unidade_medida,
	nr_registro_anvisa, qt_solicitado, vl_unitario_solic,
	cd_brasindice, cd_simpro, cd_medico_solicitante,
	nm_medico_solic_portal, nm_contato, nr_ddi_telefone,
	nr_ddd_telefone, nr_telefone, ds_email,
	ds_justificativa_solic, nr_seq_material, nr_seq_prest_fornec,
	qt_aprovado, vl_unit_aprovado, vl_unitario_aprov_fat,
	ie_status, nr_seq_mot_reprov, nr_seq_segurado,
	ie_origem_solicitacao, dt_atualizacao, nm_usuario,
	dt_atualizacao_nrec, nm_usuario_nrec, nr_seq_usuario_web,
	nr_seq_guia, ds_unidade_material, nr_seq_requisicao,
	nr_seq_item_proc, nr_seq_item_mat, nr_ramal,
	ie_tipo_despesa, dt_liberacao, nr_seq_ficha_tecnica,
	ie_tipo_solicitacao)
(SELECT nr_seq_solic_lib_mat_med_w, dt_solicitacao, dt_utilizacao,
	nr_seq_prestador, ds_material, ds_marca,
	ds_fornecedor, ds_principio_ativo, cd_unidade_medida,
	nr_registro_anvisa, qt_solicitado, vl_unitario_solic,
	cd_brasindice, cd_simpro, cd_medico_solicitante,
	nm_medico_solic_portal, nm_contato, nr_ddi_telefone,
	nr_ddd_telefone, nr_telefone, ds_email,
	ds_justificativa_solic, nr_seq_material, nr_seq_prest_fornec,
	0, vl_unit_aprovado, vl_unitario_aprov_fat,
	1, null, nr_seq_segurado,
	2, clock_timestamp(), nm_usuario_p,
	clock_timestamp(), nm_usuario_p, nr_seq_usuario_web,
	nr_seq_guia, ds_unidade_material, nr_seq_requisicao,
	nr_seq_item_proc, nr_seq_item_mat, nr_ramal,
	ie_tipo_despesa, dt_liberacao, nr_seq_ficha_tecnica,
	ie_tipo_solicitacao
from	pls_solic_lib_mat_med
where	nr_sequencia = nr_seq_solic_mat_med_p);

ds_texto_w := 	'O usuário ' || obter_nome_usuario(nm_usuario_p) ||' duplicou a solicitação na data '||to_char(clock_timestamp()) ||'.'||chr(10)||chr(13)||
		'Solicitação original: '||nr_seq_solic_mat_med_p;
CALL pls_gerar_hist_solic_mat_met(ds_texto_w,nr_seq_solic_lib_mat_med_w,3,nm_usuario_p);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_duplicar_solic_lib_mat_med ( nr_seq_solic_mat_med_p bigint, nm_usuario_p text) FROM PUBLIC;

