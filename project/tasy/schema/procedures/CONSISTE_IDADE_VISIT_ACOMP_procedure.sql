-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consiste_idade_visit_acomp ( cd_setor_atendimento_p bigint default 0, nr_atendimento_p bigint default 0, cd_pessoa_fisica_p text default 'X', ie_tipo_pessoa_p text DEFAULT NULL) AS $body$
DECLARE

 
qt_idade_min_visitante_w		bigint;
qt_idade_max_visitante_w		bigint;
qt_idade_min_acomp_w		bigint;
qt_idade_max_acomp_w		bigint;
cd_setor_atendimento_w		bigint;			
					 

BEGIN 
 
If (ie_tipo_pessoa_p = 'V') then 
	If (cd_setor_atendimento_p > 0) then 
	 
		select	coalesce(max(qt_idade_min_visitante),0), 
			coalesce(max(qt_idade_max_visitante),999) 
		into STRICT	qt_idade_min_visitante_w, 
			qt_idade_max_visitante_w 
		from	setor_atendimento 
		where	cd_setor_Atendimento = cd_setor_Atendimento_p;
		 
	Elsif (nr_atendimento_p > 0) then 
		cd_setor_atendimento_w := Obter_setor_atendimento(nr_atendimento_p);
		 
		select	coalesce(max(qt_idade_min_visitante),0), 
			coalesce(max(qt_idade_max_visitante),999) 
		into STRICT	qt_idade_min_visitante_w, 
			qt_idade_max_visitante_w 
		from	setor_atendimento 
		where	cd_setor_Atendimento = cd_setor_Atendimento_w;
		 
	End if;
	 
	If (cd_pessoa_fisica_p <> 'X') 
	And	Not(obter_idade_pf(cd_pessoa_fisica_p, clock_timestamp(), 'A') between qt_idade_min_visitante_w and qt_idade_max_visitante_w) then 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(281914);
	End if;
Else 
	if (nr_atendimento_p > 0) then 
		cd_setor_atendimento_w := Obter_setor_atendimento(nr_atendimento_p);
		 
		select	coalesce(max(qt_idade_min_acomp),0), 
			coalesce(max(qt_idade_max_acomp),999) 
		into STRICT	qt_idade_min_acomp_w, 
			qt_idade_max_acomp_w 
		from	setor_atendimento 
		where	cd_setor_Atendimento = cd_setor_Atendimento_w;
		 
	End if;
	 
	If (cd_pessoa_fisica_p <> 'X') 
	And 	Not(obter_idade_pf(cd_pessoa_fisica_p, clock_timestamp(), 'A') between qt_idade_min_acomp_w and qt_idade_max_acomp_w) then 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(281915);
	End if;
End if;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consiste_idade_visit_acomp ( cd_setor_atendimento_p bigint default 0, nr_atendimento_p bigint default 0, cd_pessoa_fisica_p text default 'X', ie_tipo_pessoa_p text DEFAULT NULL) FROM PUBLIC;

