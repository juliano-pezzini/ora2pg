-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_nom_rc_motivo_ref ( nr_seq_cabecalho_p bigint, nm_usuario_p text) AS $body$
DECLARE


/* Motivo de la referencia / contra referencia */

ds_motivo_w		nom_rc_cabecalho.ds_motivo%type;

nr_atendimento_w			atendimento_paciente.nr_atendimento%type;
nr_seq_episodio_w			episodio_paciente.nr_sequencia%type;
cd_estabelecimento_w		estabelecimento.cd_estabelecimento%type;


BEGIN

delete from nom_rc_motivo_ref
where nr_seq_cabecalho = nr_seq_cabecalho_p;

select	a.nr_atendimento,
		a.nr_seq_episodio
into STRICT	nr_atendimento_w,
		nr_seq_episodio_w
from	nom_rc_cabecalho a
where	a.nr_sequencia	= nr_seq_cabecalho_p;

select 	a.ds_motivo
into STRICT 	ds_motivo_w
from 	nom_rc_cabecalho a
where 	a.nr_sequencia = nr_seq_cabecalho_p;

if (ds_motivo_w IS NOT NULL AND ds_motivo_w::text <> '') then
	insert into nom_rc_motivo_ref(nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		ds_motivo,
		nr_seq_cabecalho)
	values (nextval('nom_rc_motivo_ref_seq'),
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		ds_motivo_w,
		nr_seq_cabecalho_p);
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_nom_rc_motivo_ref ( nr_seq_cabecalho_p bigint, nm_usuario_p text) FROM PUBLIC;

