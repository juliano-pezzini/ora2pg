-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE sus_gerar_w_sus_importacao_ach (dt_importacao_p w_sus_importacao_ach.dt_importacao%type default null, cdautlau_p w_sus_importacao_ach.cdautlau%type default null, cdcpfmed_p w_sus_importacao_ach.cdcpfmed%type default null, cdideaih_p w_sus_importacao_ach.cdideaih%type default null, cdidelau_p w_sus_importacao_ach.cdidelau%type default null, cdidemun_p w_sus_importacao_ach.cdidemun%type default null, cdidepro_p w_sus_importacao_ach.cdidepro%type default null, cdproaut_p w_sus_importacao_ach.cdproaut%type default null, cdprontu_p w_sus_importacao_ach.cdprontu%type default null, cnsaut_p w_sus_importacao_ach.cnsaut%type default null, compet_p w_sus_importacao_ach.compet%type default null, dtapresent_p w_sus_importacao_ach.dtapresent%type default null, dtautlau_p w_sus_importacao_ach.dtautlau%type default null, dtemiaih_p w_sus_importacao_ach.dtemiaih%type default null, gestante_p w_sus_importacao_ach.gestante%type default null, nmidepac_p w_sus_importacao_ach.nmidepac%type default null, nmmedaut_p w_sus_importacao_ach.nmmedaut%type default null, qteproc_p w_sus_importacao_ach.qteproc%type default null, sequencial_p w_sus_importacao_ach.sequencial%type default null, tipo_p w_sus_importacao_ach.tipo%type default null, tipoaih_p w_sus_importacao_ach.tipoaih%type default null, qt_commit_p bigint default null, nm_usuario_p w_sus_importacao_ach.nm_usuario%type DEFAULT NULL, qtdeaut_p w_sus_importacao_ach.qtdeaut%type default null, ds_conteudo_p text default null) AS $body$
DECLARE

					
nr_sequencia_w		bigint;
cdidelau_w              w_sus_importacao_ach.cdidelau%type;
nrgerint_w              w_sus_importacao_ach.nrgerint%type;
cdideaih_w              w_sus_importacao_ach.cdideaih%type;
tipoaih_w               w_sus_importacao_ach.tipoaih%type;
seqaih_w                w_sus_importacao_ach.seqaih%type;
dtiniaih_w              w_sus_importacao_ach.dtiniaih%type;
dtfimaih_w              w_sus_importacao_ach.dtfimaih%type;
tipo_w                  w_sus_importacao_ach.tipo%type;
dstplau_w               w_sus_importacao_ach.dstplau%type;
nmidepac_w              w_sus_importacao_ach.nmidepac%type;
nrcnspac_w              w_sus_importacao_ach.nrcnspac%type;
dspropri_w              w_sus_importacao_ach.dspropri%type;
cdproaut_w              w_sus_importacao_ach.cdproaut%type;
cnsaut_w                w_sus_importacao_ach.cnsaut%type;
nmmedaut_w              w_sus_importacao_ach.nmmedaut%type;
dtautlau_w              w_sus_importacao_ach.dtautlau%type;
qteproc_w               w_sus_importacao_ach.qteproc%type;
qtdeaut_w               w_sus_importacao_ach.qtdeaut%type;
cdprontu_w              w_sus_importacao_ach.cdprontu%type;
dsprosec_w              w_sus_importacao_ach.dsprosec%type;
cdprosec_w              w_sus_importacao_ach.cdprosec%type;
compet_w                w_sus_importacao_ach.compet%type;


BEGIN

if (coalesce(cdidelau_p,0) > 0) then
	begin
	
	select	nextval('w_sus_importacao_ach_seq')
	into STRICT	nr_sequencia_w
	;
	
	insert into w_sus_importacao_ach(	
				nr_sequencia,
				dt_atualizacao,
				dt_atualizacao_nrec,
				nm_usuario,
				nm_usuario_nrec,
				dt_importacao,
				cdautlau,
				cdcpfmed,
				cdideaih,
				cdidelau,
				cdidemun,
				cdidepro,
				cdproaut,
				cdprontu,
				cnsaut,
				compet,
				dtapresent,
				dtautlau,
				dtemiaih,
				gestante,
				nmidepac,
				nmmedaut,
				qteproc,
				sequencial,
				tipo,
				tipoaih,
                                qtdeaut)
			values (	nr_sequencia_w,
				clock_timestamp(),
				clock_timestamp(),
				nm_usuario_p,
				nm_usuario_p,
				dt_importacao_p,
				cdautlau_p,
				cdcpfmed_p,
				cdideaih_p,
				cdidelau_p,
				cdidemun_p,
				cdidepro_p,
				cdproaut_p,
				cdprontu_p,
				cnsaut_p,
				compet_p,
				dtapresent_p,
				dtautlau_p,
				dtemiaih_p,
				gestante_p,
				nmidepac_p,
				nmmedaut_p,
				qteproc_p,
				sequencial_p,
				tipo_p,
				tipoaih_p,
				qtdeaut_p);
	
	end;
end if;

if (coalesce(ds_conteudo_p,'X') <> 'X') then
        begin

        if (length(obter_valor_campo_separador(ds_conteudo_p,8,';')) = 1) then
                begin                
                                
                cdidelau_w      := substr(obter_valor_campo_separador(ds_conteudo_p,1,';'),1,13);
                nrgerint_w      := substr(obter_valor_campo_separador(ds_conteudo_p,2,';'),1,12);
                cdideaih_w      := substr(obter_valor_campo_separador(ds_conteudo_p,3,';'),1,13);
                tipoaih_w       := substr(obter_valor_campo_separador(ds_conteudo_p,4,';'),1,1);
                seqaih_w        := substr(obter_valor_campo_separador(ds_conteudo_p,5,';'),1,1);
                dtiniaih_w      := substr(obter_valor_campo_separador(ds_conteudo_p,6,';'),1,8);
                dtfimaih_w      := substr(obter_valor_campo_separador(ds_conteudo_p,7,';'),1,8);
                tipo_w          := substr(obter_valor_campo_separador(ds_conteudo_p,8,';'),1,1);
                dstplau_w       := substr(obter_valor_campo_separador(ds_conteudo_p,9,';'),1,70);
                nmidepac_w      := substr(obter_valor_campo_separador(ds_conteudo_p,10,';'),1,70);
                nrcnspac_w      := substr(obter_valor_campo_separador(ds_conteudo_p,11,';'),1,15);
                dspropri_w      := substr(obter_valor_campo_separador(ds_conteudo_p,12,';'),1,255);
                cdproaut_w      := substr(obter_valor_campo_separador(ds_conteudo_p,13,';'),1,10);
                cnsaut_w        := substr(obter_valor_campo_separador(ds_conteudo_p,14,';'),1,15);
                nmmedaut_w      := substr(obter_valor_campo_separador(ds_conteudo_p,15,';'),1,70);
                dtautlau_w      := substr(obter_valor_campo_separador(ds_conteudo_p,16,';'),1,8);
                qteproc_w       := substr(obter_valor_campo_separador(ds_conteudo_p,17,';'),1,3);
                qtdeaut_w       := substr(obter_valor_campo_separador(ds_conteudo_p,18,';'),1,5);
                cdprontu_w      := substr(obter_valor_campo_separador(ds_conteudo_p,19,';'),1,20);
                
                select	nextval('w_sus_importacao_ach_seq')
                into STRICT	nr_sequencia_w
;

                insert into w_sus_importacao_ach(	
                                        nr_sequencia,
                                        dt_atualizacao,
                                        dt_atualizacao_nrec,
                                        nm_usuario,
                                        nm_usuario_nrec,
                                        dt_importacao,
                                        cdautlau,
                                        cdcpfmed,
                                        cdideaih,
                                        cdidelau,
                                        cdidemun,
                                        cdidepro,
                                        cdproaut,
                                        cdprontu,
                                        cnsaut,
                                        compet,
                                        dtapresent,
                                        dtautlau,
                                        dtemiaih,
                                        gestante,
                                        nmidepac,
                                        nmmedaut,
                                        qteproc,
                                        sequencial,
                                        tipo,
                                        tipoaih,
                                        qtdeaut,
                                        nrgerint,
                                        dstplau,
                                        nrcnspac,
                                        dspropri,
                                        cdprosec,
                                        dsprosec,
                                        dtiniaih,
                                        dtfimaih,
                                        seqaih)
                                values (	nr_sequencia_w,
                                        clock_timestamp(),
                                        clock_timestamp(),
                                        nm_usuario_p,
                                        nm_usuario_p,
                                        dt_importacao_p,
                                        cdautlau_p,
                                        cdcpfmed_p,
                                        cdideaih_w,
                                        cdidelau_w,
                                        cdidemun_p,
                                        cdidepro_p,
                                        cdproaut_w,
                                        cdprontu_w,
                                        cnsaut_w,
                                        compet_p,
                                        dtapresent_p,
                                        dtautlau_w,
                                        dtemiaih_p,
                                        gestante_p,
                                        nmidepac_w,
                                        nmmedaut_w,
                                        qteproc_w,
                                        sequencial_p,
                                        tipo_w,
                                        tipoaih_w,
                                        qtdeaut_w,
                                        nrgerint_w,
                                        dstplau_w,      
                                        nrcnspac_w,
                                        dspropri_w,
                                        cdprosec_w,
                                        dsprosec_w,
                                        dtiniaih_w,
                                        dtfimaih_w,
                                        seqaih_w);
                end;
        elsif (length(obter_valor_campo_separador(ds_conteudo_p,6,';')) = 1) then
                begin

                cdidelau_w      := substr(obter_valor_campo_separador(ds_conteudo_p,1,';'),1,13);
                nrgerint_w      := substr(obter_valor_campo_separador(ds_conteudo_p,2,';'),1,12);
                cdideaih_w      := substr(obter_valor_campo_separador(ds_conteudo_p,3,';'),1,13);
                tipoaih_w       := substr(obter_valor_campo_separador(ds_conteudo_p,4,';'),1,1);
                seqaih_w        := substr(obter_valor_campo_separador(ds_conteudo_p,5,';'),1,1);
                tipo_w          := substr(obter_valor_campo_separador(ds_conteudo_p,6,';'),1,1);
                dstplau_w       := substr(obter_valor_campo_separador(ds_conteudo_p,7,';'),1,70);
                nmidepac_w      := substr(obter_valor_campo_separador(ds_conteudo_p,8,';'),1,70);
                nrcnspac_w      := substr(obter_valor_campo_separador(ds_conteudo_p,9,';'),1,15);
                --dsprosec_w      := substr(obter_valor_campo_separador(ds_conteudo_p,10,';'),1,255); Nao vem no arquivo, mesmo estando no layout
                cdprosec_w      := substr(obter_valor_campo_separador(ds_conteudo_p,10,';'),1,10);
                cnsaut_w        := substr(obter_valor_campo_separador(ds_conteudo_p,11,';'),1,15);
                nmmedaut_w      := substr(obter_valor_campo_separador(ds_conteudo_p,12,';'),1,70);
                dtautlau_w      := substr(obter_valor_campo_separador(ds_conteudo_p,13,';'),1,8);
                qteproc_w       := substr(obter_valor_campo_separador(ds_conteudo_p,14,';'),1,3);
                qtdeaut_w       := substr(obter_valor_campo_separador(ds_conteudo_p,15,';'),1,5);
                compet_w        := substr(obter_valor_campo_separador(ds_conteudo_p,16,';'),1,6);

                select	nextval('w_sus_importacao_ach_seq')
                into STRICT	nr_sequencia_w
;

                insert into w_sus_importacao_ach(	
                                        nr_sequencia,
                                        dt_atualizacao,
                                        dt_atualizacao_nrec,
                                        nm_usuario,
                                        nm_usuario_nrec,
                                        dt_importacao,
                                        cdautlau,
                                        cdcpfmed,
                                        cdideaih,
                                        cdidelau,
                                        cdidemun,
                                        cdidepro,
                                        cdproaut,
                                        cdprontu,
                                        cnsaut,
                                        compet,
                                        dtapresent,
                                        dtautlau,
                                        dtemiaih,
                                        gestante,
                                        nmidepac,
                                        nmmedaut,
                                        qteproc,
                                        sequencial,
                                        tipo,
                                        tipoaih,
                                        qtdeaut,
                                        nrgerint,
                                        dstplau,
                                        nrcnspac,
                                        dspropri,
                                        cdprosec,
                                        dsprosec,
                                        dtiniaih,
                                        dtfimaih,
                                        seqaih)
                                values (	nr_sequencia_w,
                                        clock_timestamp(),
                                        clock_timestamp(),
                                        nm_usuario_p,
                                        nm_usuario_p,
                                        dt_importacao_p,
                                        cdautlau_p,
                                        cdcpfmed_p,
                                        cdideaih_w,
                                        cdidelau_w,
                                        cdidemun_p,
                                        cdidepro_p,
                                        cdproaut_w,
                                        cdprontu_w,
                                        cnsaut_w,
                                        compet_p,
                                        dtapresent_p,
                                        dtautlau_w,
                                        dtemiaih_p,
                                        gestante_p,
                                        nmidepac_w,
                                        nmmedaut_w,
                                        qteproc_w,
                                        sequencial_p,
                                        tipo_w,
                                        tipoaih_w,
                                        qtdeaut_w,
                                        nrgerint_w,
                                        dstplau_w,      
                                        nrcnspac_w,
                                        dspropri_w,
                                        cdprosec_w,
                                        dsprosec_w,
                                        dtiniaih_w,
                                        dtfimaih_w,
                                        seqaih_w);
                end;
        end if;
        end;
end if;

if (coalesce(qt_commit_p,0) = 100) then
	commit;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE sus_gerar_w_sus_importacao_ach (dt_importacao_p w_sus_importacao_ach.dt_importacao%type default null, cdautlau_p w_sus_importacao_ach.cdautlau%type default null, cdcpfmed_p w_sus_importacao_ach.cdcpfmed%type default null, cdideaih_p w_sus_importacao_ach.cdideaih%type default null, cdidelau_p w_sus_importacao_ach.cdidelau%type default null, cdidemun_p w_sus_importacao_ach.cdidemun%type default null, cdidepro_p w_sus_importacao_ach.cdidepro%type default null, cdproaut_p w_sus_importacao_ach.cdproaut%type default null, cdprontu_p w_sus_importacao_ach.cdprontu%type default null, cnsaut_p w_sus_importacao_ach.cnsaut%type default null, compet_p w_sus_importacao_ach.compet%type default null, dtapresent_p w_sus_importacao_ach.dtapresent%type default null, dtautlau_p w_sus_importacao_ach.dtautlau%type default null, dtemiaih_p w_sus_importacao_ach.dtemiaih%type default null, gestante_p w_sus_importacao_ach.gestante%type default null, nmidepac_p w_sus_importacao_ach.nmidepac%type default null, nmmedaut_p w_sus_importacao_ach.nmmedaut%type default null, qteproc_p w_sus_importacao_ach.qteproc%type default null, sequencial_p w_sus_importacao_ach.sequencial%type default null, tipo_p w_sus_importacao_ach.tipo%type default null, tipoaih_p w_sus_importacao_ach.tipoaih%type default null, qt_commit_p bigint default null, nm_usuario_p w_sus_importacao_ach.nm_usuario%type DEFAULT NULL, qtdeaut_p w_sus_importacao_ach.qtdeaut%type default null, ds_conteudo_p text default null) FROM PUBLIC;

