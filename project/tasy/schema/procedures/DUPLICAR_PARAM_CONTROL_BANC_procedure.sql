-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_param_control_banc ( cd_estabelecimento_p bigint, nm_usuario_p text ) AS $body$
DECLARE


cont_w	bigint;


BEGIN

select	count(*)
into STRICT	cont_w
from	parametro_controle_banc a
where	a.cd_estabelecimento	<> cd_estabelecimento_p;

if (cont_w > 0) then
	--r.aise_application_error(-20011, 'Já existem outros estabelecimentos com os parâmetros do controle bancário definidos!');
	CALL wheb_mensagem_pck.exibir_mensagem_abort(267375);
end if;

insert into PARAMETRO_CONTROLE_BANC(CD_ESTABELECIMENTO,
	DT_ATUALIZACAO,
	DT_ATUALIZACAO_NREC,
	IE_ABRIR_SALDO,
	IE_AGRUPA_TRANS_CONTAB,
	IE_COMPL_HISTORICO,
	IE_CONTAB_BORDERO,
	IE_CONTAB_CP_NO_CB,
	IE_CONTAB_CR_NO_CB,
	IE_CONTAB_VL_ESTORNO,
	IE_DATA_CONTABIL,
	IE_HIST_CONTABIL,
	NM_USUARIO,
	NM_USUARIO_NREC)
SELECT	b.CD_ESTABELECIMENTO,
	clock_timestamp(),
	clock_timestamp(),
	IE_ABRIR_SALDO,
	IE_AGRUPA_TRANS_CONTAB,
	IE_COMPL_HISTORICO,
	IE_CONTAB_BORDERO,
	IE_CONTAB_CP_NO_CB,
	IE_CONTAB_CR_NO_CB,
	IE_CONTAB_VL_ESTORNO,
	IE_DATA_CONTABIL,
	IE_HIST_CONTABIL,
	nm_usuario_p,
	nm_usuario_p
from	estabelecimento b,
	parametro_controle_banc a
where	a.cd_estabelecimento	<> b.cd_estabelecimento
and	b.cd_estabelecimento	<> cd_estabelecimento_p
and	not exists (select 1 from parametro_controle_banc x where x.cd_estabelecimento = a.cd_estabelecimento);

commit;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_param_control_banc ( cd_estabelecimento_p bigint, nm_usuario_p text ) FROM PUBLIC;

