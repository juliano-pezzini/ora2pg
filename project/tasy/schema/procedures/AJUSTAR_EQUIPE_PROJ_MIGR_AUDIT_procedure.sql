-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ajustar_equipe_proj_migr_audit ( nr_seq_projeto_p bigint, dt_atualizacao_p timestamp, nm_usuario_p text) AS $body$
DECLARE

		 
nr_seq_equipe_w		bigint;
nr_seq_equipe_papel_w	bigint;
nm_gerente_w		varchar(60);
		

BEGIN 
if (nr_seq_projeto_p IS NOT NULL AND nr_seq_projeto_p::text <> '') and (dt_atualizacao_p IS NOT NULL AND dt_atualizacao_p::text <> '') and (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') then 
	begin 
	select	nextval('proj_equipe_seq') 
	into STRICT	nr_seq_equipe_w 
	;
	 
	insert into proj_equipe( 
		nr_sequencia, 
		dt_atualizacao, 
		nm_usuario, 
		dt_atualizacao_nrec, 
		nm_usuario_nrec, 
		dt_inicio, 
		ds_objetivo, 
		nr_seq_equipe_funcao, 
		nr_seq_proj, 
		ie_interna_externa, 
		ie_virada, 
		nr_seq_apres, 
		dt_liberacao, 
		nr_seq_virada, 
		nr_seq_cliente) 
	values ( 
		nr_seq_equipe_w, 
		dt_atualizacao_p, 
		nm_usuario_p, 
		dt_atualizacao_p, 
		nm_usuario_p, 
		null, 
		null, 
		13, 
		nr_seq_projeto_p, 
		'I', 
		'N', 
		5, 
		null, 
		null, 
		1800);
		 
	select	nextval('proj_equipe_papel_seq') 
	into STRICT	nr_seq_equipe_papel_w 
	;
		 
	select	substr(obter_nome_pf(pf.cd_pessoa_fisica),1,60) 
	into STRICT	nm_gerente_w 
	from	pessoa_fisica pf, 
		proj_projeto p 
	where	pf.cd_pessoa_fisica = p.cd_gerente_cliente 
	and	p.nr_sequencia = nr_seq_projeto_p;
	 
	insert into proj_equipe_papel( 
		nr_sequencia, 
		nr_seq_equipe, 
		dt_atualizacao, 
		nm_usuario, 
		dt_atualizacao_nrec, 
		nm_usuario_nrec, 
		nr_seq_apres, 
		nr_seq_funcao, 
		nm_pessoa, 
		cd_pessoa_fisica, 
		ds_setor, 
		ds_fone, 
		dt_fim, 
		nr_seq_cadastro, 
		ds_atuacao, 
		ds_cargo, 
		--cd_cargo, 
		nm_guerra, 
		ds_email, 
		ie_alerta, 
		IE_ALOCADO_ORIGINAL) 
	values ( 
		nr_seq_equipe_papel_w, 
		nr_seq_equipe_w, 
		dt_atualizacao_p, 
		nm_usuario_p, 
		dt_atualizacao_p, 
		nm_usuario_p, 
		10, 
		49, 
		nm_gerente_w, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		--null, 
		null, 
		null, 
		null, 
		'S');
	end;
end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ajustar_equipe_proj_migr_audit ( nr_seq_projeto_p bigint, dt_atualizacao_p timestamp, nm_usuario_p text) FROM PUBLIC;

