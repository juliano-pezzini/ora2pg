-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_proc_pac ( cd_procedimento_p bigint, qt_procedimento_p bigint, nr_seq_exame_p bigint, nr_seq_proc_interno_p bigint, ie_origem_proced_p bigint, cd_setor_atendimento_p bigint, nr_atendimento_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text, ie_tipo_baixa_p text, ie_valor_informado_p text, cd_medico_p text, nr_seq_atepacu_p bigint, dt_procedimento_p timestamp, cd_convenio_p bigint, cd_categoria_p text, nr_sequencia_p INOUT bigint, vl_procedimento_p bigint ) AS $body$
DECLARE

 
nr_sequencia_w			bigint;
dt_entrada_unidade_w		timestamp;
nr_seq_interno_w			bigint;
cd_convenio_w			integer	:= cd_convenio_p;
cd_categoria_w			varchar(10)	:= cd_categoria_p;
nr_doc_convenio_w		varchar(20);
ie_tipo_guia_w			varchar(2);
cd_senha_w			varchar(20);
ie_emite_conta_w 			varchar(3)	:= null; --no delphi 81(Conta Paciente-Antiga) parametro 18 
cd_cgc_prestador_w 		varchar(14);	
ie_origem_proced_w		bigint;
ie_tipo_atendimento_w 		varchar(2)	:= null;
ie_medico_executor_w		varchar(2);
cd_cgc_w			varchar(14);
cd_medico_executor_w		varchar(10);

 
ie_funcao_medico_w		varchar(10)	:= 0;
dt_procedimento_w		timestamp;
cd_pessoa_fisica_w		varchar(10);

cd_tipo_procedimento_w		smallint;
ie_classificacao_w		varchar(1);
ie_tipo_lancto_w		varchar(10);
cd_procedimento_w		bigint;
cd_profissional_w		varchar(10);
nr_seq_cor_exec_w		bigint	:= 96;
ds_observacao_w			varchar(255);

 
 
 

BEGIN 
dt_procedimento_w	:= dt_procedimento_p;
 
nr_seq_interno_w	:= nr_seq_atepacu_p;
 
select	max(a.dt_entrada_unidade) 
into STRICT	dt_entrada_unidade_w 
from	atend_paciente_unidade a 
where	nr_seq_interno	= nr_seq_interno_w;
 
select	a.cd_cgc 
into STRICT	cd_cgc_prestador_w 
from 	estabelecimento a, 
	atendimento_paciente b 
where	a.cd_estabelecimento 	= b.cd_estabelecimento 
and	b.nr_atendimento 	= nr_atendimento_p;
 
 
-- Obter a m√°xima sequencia da procedimento_paciente 
select		nextval('procedimento_paciente_seq') 
into STRICT		nr_sequencia_w
;
 
 
-- inserir na tabela procedimento_paciente 
insert into procedimento_paciente( 
			nr_sequencia, 
			nr_atendimento,	 
			dt_entrada_unidade,		 
			cd_procedimento, 
			dt_procedimento, 
			cd_convenio, 
			cd_categoria, 
			nr_doc_convenio, 
			ie_tipo_guia, 
			cd_senha, 
			ie_auditoria, 
			ie_emite_conta, 
			cd_cgc_prestador, 
			ie_origem_proced, 
			nr_seq_exame, 
			nr_seq_proc_interno, 
			qt_procedimento, 
			cd_setor_atendimento, 
			nr_seq_atepacu, 
			nr_seq_cor_exec, 
			ie_funcao_medico, 
			vl_procedimento, 
			ie_proc_princ_atend, 
			ie_video, 
			tx_medico, 
			tx_Anestesia, 
			tx_procedimento, 
			ie_valor_informado, 
			ie_guia_informada, 
			cd_situacao_glosa, 
			nm_usuario_original, 
			ds_observacao, 
			dt_atualizacao, 
			nm_usuario, 
			cd_pessoa_fisica, 
			cd_medico_executor) 
		values ( 
			nr_sequencia_w, 
			nr_atendimento_p, 
			dt_entrada_unidade_w, 
			cd_procedimento_p, 
			dt_procedimento_w, 
			cd_convenio_w, 
			cd_categoria_w, 
			nr_doc_convenio_w, 
			ie_tipo_guia_w, 
			cd_senha_w, 
			'N', 
			ie_emite_conta_w, 
			cd_cgc_prestador_w, 
			ie_origem_proced_p, 
			nr_seq_exame_p, 
			nr_seq_proc_interno_p,				 
			qt_procedimento_p, 
			cd_setor_atendimento_p, 
			nr_seq_interno_w, 
			nr_seq_cor_exec_w, 
			ie_funcao_medico_w, 
			vl_procedimento_p, 
			'N', 
			'N', 
			100, 
			100, 
			100, 
			ie_valor_informado_p, 
			ie_valor_informado_p, 
			0, 
			nm_usuario_p, 
			ds_observacao_w, 
			clock_timestamp(), 
			nm_usuario_p, 
			cd_profissional_w, 
			cd_medico_p);
 
 
 
 
 
CALL atualiza_preco_procedimento(nr_sequencia_w, cd_convenio_w, nm_usuario_p);
 
nr_sequencia_p	:= nr_sequencia_w;
 
commit;
 
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_proc_pac ( cd_procedimento_p bigint, qt_procedimento_p bigint, nr_seq_exame_p bigint, nr_seq_proc_interno_p bigint, ie_origem_proced_p bigint, cd_setor_atendimento_p bigint, nr_atendimento_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text, ie_tipo_baixa_p text, ie_valor_informado_p text, cd_medico_p text, nr_seq_atepacu_p bigint, dt_procedimento_p timestamp, cd_convenio_p bigint, cd_categoria_p text, nr_sequencia_p INOUT bigint, vl_procedimento_p bigint ) FROM PUBLIC;

