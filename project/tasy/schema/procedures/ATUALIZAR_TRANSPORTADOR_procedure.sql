-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_transportador ( NR_SEQUENCIA_P bigint, CD_TRANSPORTADOR_P text, IE_OPCAO_P text DEFAULT NULL) AS $body$
DECLARE

/*
IE_OPCAO_P PARA FUTURAS CUSTOMIZAÇÕES
*/
DS_ERRO_W		varchar(255);


BEGIN



SELECT CASE WHEN COUNT(*)=0 THEN 'N'  ELSE 'S' END
INTO STRICT   DS_ERRO_W
FROM   TRANSPORTADOR
WHERE  CD_PESSOA_FISICA = CD_TRANSPORTADOR_P;

IF (DS_ERRO_W = 'N') THEN
	CALL WHEB_MENSAGEM_PCK.EXIBIR_MENSAGEM_ABORT(257810);
END IF;

SELECT CASE WHEN COUNT(*)=0 THEN 'N'  ELSE 'S' END
INTO STRICT   DS_ERRO_W
FROM   TRANSPORTADOR
WHERE  CD_PESSOA_FISICA = CD_TRANSPORTADOR_P
AND	   IE_STATUS_RECURSO = 1;

IF (DS_ERRO_W = 'N') THEN
	CALL WHEB_MENSAGEM_PCK.EXIBIR_MENSAGEM_ABORT(257809);
END IF;


IF (NR_SEQUENCIA_P IS NOT NULL AND NR_SEQUENCIA_P::text <> '') THEN

	UPDATE	TRANS_SOLICITACAO
	SET	CD_TRANSPORTADOR = CD_TRANSPORTADOR_P,
		DT_ATUALIZACAO	 = clock_timestamp(),
		NM_USUARIO		 = WHEB_USUARIO_PCK.GET_NM_USUARIO
	WHERE	NR_SEQUENCIA = NR_SEQUENCIA_P;

END IF;

COMMIT;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_transportador ( NR_SEQUENCIA_P bigint, CD_TRANSPORTADOR_P text, IE_OPCAO_P text DEFAULT NULL) FROM PUBLIC;

