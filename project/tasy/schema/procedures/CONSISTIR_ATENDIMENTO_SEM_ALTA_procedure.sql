-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consistir_atendimento_sem_alta ( cd_pessoa_fisica_p text, nr_atendimento_p bigint, cd_perfil_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text, ds_retorno_p INOUT text) AS $body$
DECLARE

 
vl_parametro_w		varchar(1);
nr_atend_sem_alta_w	bigint;
ds_unidade_w		varchar(255);
				

BEGIN 
 
vl_parametro_w := obter_param_usuario(	916, 443, cd_perfil_p, nm_usuario_p, cd_estabelecimento_p, vl_parametro_w);
			 
if (vl_parametro_w = 'S') and (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') and (coalesce(nr_atendimento_p,0) = 0)then 
	begin 
	 
	nr_atend_sem_alta_w	:= obter_atend_sem_alta(cd_pessoa_fisica_p);
	 
	if (nr_atend_sem_alta_w > 0)then 
		begin 
		 
		ds_unidade_w	:= obter_unidade_atendimento(nr_atend_sem_alta_w, 'A', 'S');
		 
		ds_retorno_p	:= substr(obter_texto_dic_objeto(312617, wheb_usuario_pck.get_nr_seq_idioma, 'NR_ATEND_SEM_ALTA_W='||nr_atend_sem_alta_w || ';DS_UNIDADE_W='|| coalesce(ds_unidade_w,' ')),1,255);
		--'Existe atendimento sem alta para esta pessoa física. Atendimento: ' || nr_atend_sem_alta_w || ' Setor: ' || ds_unidade_w; 
		 
		end;
	end if;
	 
	end;
elsif (vl_parametro_w = 'Q') and (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') and (coalesce(nr_atendimento_p,0) = 0)then 
	begin 
	 
	nr_atend_sem_alta_w	:= obter_atend_sem_alta(cd_pessoa_fisica_p);
	 
	if (nr_atend_sem_alta_w > 0)then 
		begin 
		 
		ds_unidade_w	:= obter_unidade_atendimento(nr_atend_sem_alta_w, 'A', 'S');
		 
		ds_retorno_p	:= substr(obter_texto_dic_objeto(312617, wheb_usuario_pck.get_nr_seq_idioma, 'NR_ATEND_SEM_ALTA_W='||nr_atend_sem_alta_w || ';DS_UNIDADE_W='|| coalesce(ds_unidade_w,' ')) || 
					chr(10) || obter_texto_tasy(312665,null),1,255);
		--'Existe atendimento sem alta para esta pessoa física. Atendimento: ' || nr_atend_sem_alta_w || ' Setor: ' || ' Deseja gerar um novo atendimento ?'; 
		 
		end;
	end if;
	 
	end;
end if;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consistir_atendimento_sem_alta ( cd_pessoa_fisica_p text, nr_atendimento_p bigint, cd_perfil_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text, ds_retorno_p INOUT text) FROM PUBLIC;

