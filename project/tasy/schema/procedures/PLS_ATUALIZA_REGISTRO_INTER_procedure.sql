-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_atualiza_registro_inter ( nr_seq_requisicao_p bigint, nr_seq_guia_p bigint) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
finalidade: atualizar os registros das tabelas do ptu online informando o número da guia gerada quando uma
		requisição de intercâmbio é autorizada.
-------------------------------------------------------------------------------------------------------------------
locais de chamada direta:
[x]  objetos do dicionário [ ] tasy (delphi/java) [  ] portal [  ]  relatórios [ ] outros:
 ------------------------------------------------------------------------------------------------------------------
pontos de atenção:performance.
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
qt_pedido_autorizacao_w			integer;
qt_resposta_autorizacao_w		integer;
qt_pedido_compl_aut_w			integer;
qt_pedido_insistencia_w			integer;
qt_cancelamento_w			integer;
qt_resposta_auditoria_w			integer;
qt_erro_inesperado_w			integer;
qt_confirmacao_w			integer;
qt_requisicao_ordem_serv_w		integer;
qt_pedido_status_w			integer;
qt_resp_pedido_status_w			integer;
qt_resposta_req_ord_serv_w		integer;
qt_autorizacao_ordem_serv_w		integer;
qt_decurso_prazo_w			integer;


BEGIN

-- pedido de autorização
select	count(1)
into STRICT	qt_pedido_autorizacao_w
from	ptu_pedido_autorizacao
where	nr_seq_requisicao	= nr_seq_requisicao_p;

if (qt_pedido_autorizacao_w > 0) then
	update	ptu_pedido_autorizacao
	set	nr_seq_guia		= nr_seq_guia_p
	where	nr_seq_requisicao	= nr_seq_requisicao_p;
end if;

-- resposta do pedido de autorização
select	count(1)
into STRICT	qt_resposta_autorizacao_w
from	ptu_resposta_autorizacao
where	nr_seq_requisicao	= nr_seq_requisicao_p;

if (qt_resposta_autorizacao_w > 0) then
	update	ptu_resposta_autorizacao
	set	nr_seq_guia		= nr_seq_guia_p
	where	nr_seq_requisicao	= nr_seq_requisicao_p;
end if;

-- pedido de complemento de autorização
select	count(1)
into STRICT	qt_pedido_compl_aut_w
from	ptu_pedido_compl_aut
where	nr_seq_requisicao	= nr_seq_requisicao_p;

if (qt_pedido_compl_aut_w > 0) then
	update	ptu_pedido_compl_aut
	set	nr_seq_guia		= nr_seq_guia_p
	where	nr_seq_requisicao	= nr_seq_requisicao_p;
end if;

-- pedido de insistência
select	count(1)
into STRICT	qt_pedido_insistencia_w
from	ptu_pedido_insistencia
where	nr_seq_requisicao	= nr_seq_requisicao_p;

if (qt_pedido_insistencia_w > 0) then
	update	ptu_pedido_insistencia
	set	nr_seq_guia		= nr_seq_guia_p
	where	nr_seq_requisicao	= nr_seq_requisicao_p;
end if;

-- pedido de cancelamento
select	count(1)
into STRICT	qt_cancelamento_w
from	ptu_cancelamento
where	nr_seq_requisicao	= nr_seq_requisicao_p;

if (qt_cancelamento_w > 0) then
	update	ptu_cancelamento
	set	nr_seq_guia		= nr_seq_guia_p
	where	nr_seq_requisicao	= nr_seq_requisicao_p;
end if;

-- resposta de auditoria
select	count(1)
into STRICT	qt_resposta_auditoria_w
from	ptu_resposta_auditoria
where	nr_seq_requisicao	= nr_seq_requisicao_p;

if (qt_resposta_auditoria_w > 0) then
	update	ptu_resposta_auditoria
	set	nr_seq_guia		= nr_seq_guia_p
	where	nr_seq_requisicao	= nr_seq_requisicao_p;
end if;

-- erro inesperado
select	count(1)
into STRICT	qt_erro_inesperado_w
from	ptu_erro_inesperado
where	nr_seq_requisicao	= nr_seq_requisicao_p;

if (qt_erro_inesperado_w > 0) then
	update	ptu_erro_inesperado
	set	nr_seq_guia		= nr_seq_guia_p
	where	nr_seq_requisicao	= nr_seq_requisicao_p;
end if;

-- confirmação
select	count(1)
into STRICT	qt_confirmacao_w
from	ptu_confirmacao
where	nr_seq_requisicao	= nr_seq_requisicao_p;

if (qt_confirmacao_w > 0) then
	update	ptu_confirmacao
	set	nr_seq_guia		= nr_seq_guia_p
	where	nr_seq_requisicao	= nr_seq_requisicao_p;
end if;

-- requisição de ordem de serviço
select	count(1)
into STRICT	qt_requisicao_ordem_serv_w
from	ptu_requisicao_ordem_serv
where	nr_seq_requisicao	= nr_seq_requisicao_p;

if (qt_requisicao_ordem_serv_w > 0) then
	update	ptu_requisicao_ordem_serv
	set	nr_seq_guia		= nr_seq_guia_p
	where	nr_seq_requisicao	= nr_seq_requisicao_p;
end if;

-- pedido de status da transação
select	count(1)
into STRICT	qt_pedido_status_w
from	ptu_pedido_status
where	nr_seq_requisicao	= nr_seq_requisicao_p;

if (qt_pedido_status_w > 0) then
	update	ptu_pedido_status
	set	nr_seq_guia		= nr_seq_guia_p
	where	nr_seq_requisicao	= nr_seq_requisicao_p;
end if;

-- resposta do pedido de status da transação
select	count(1)
into STRICT	qt_resp_pedido_status_w
from	ptu_resp_pedido_status
where	nr_seq_requisicao	= nr_seq_requisicao_p;

if (qt_resp_pedido_status_w > 0) then
	update	ptu_resp_pedido_status
	set	nr_seq_guia		= nr_seq_guia_p
	where	nr_seq_requisicao	= nr_seq_requisicao_p;
end if;

-- resposta da requisição de ordem de serviço
select	count(1)
into STRICT	qt_resposta_req_ord_serv_w
from	ptu_resposta_req_ord_serv
where	nr_seq_requisicao	= nr_seq_requisicao_p;

if (qt_resposta_req_ord_serv_w > 0) then
	update	ptu_resposta_req_ord_serv
	set	nr_seq_guia		= nr_seq_guia_p
	where	nr_seq_requisicao	= nr_seq_requisicao_p;
end if;

-- autorização da ordem de serviço
select	count(1)
into STRICT	qt_autorizacao_ordem_serv_w
from	ptu_autorizacao_ordem_serv
where	nr_seq_requisicao	= nr_seq_requisicao_p;

if (qt_autorizacao_ordem_serv_w > 0) then
	update	ptu_autorizacao_ordem_serv
	set	nr_seq_guia		= nr_seq_guia_p
	where	nr_seq_requisicao	= nr_seq_requisicao_p;
end if;

-- pedido de decurso de prazo
select	count(1)
into STRICT	qt_decurso_prazo_w
from	ptu_decurso_prazo
where	nr_seq_requisicao	= nr_seq_requisicao_p;

if (qt_decurso_prazo_w > 0) then
	update	ptu_decurso_prazo
	set	nr_seq_guia		= nr_seq_guia_p
	where	nr_seq_requisicao	= nr_seq_requisicao_p;
end if;



commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_atualiza_registro_inter ( nr_seq_requisicao_p bigint, nr_seq_guia_p bigint) FROM PUBLIC;

