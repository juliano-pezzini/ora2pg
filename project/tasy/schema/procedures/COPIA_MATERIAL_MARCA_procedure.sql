-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copia_material_marca (cd_estabelecimento_p bigint, cd_material_p bigint, cd_material_novo_p bigint, nm_usuario_p text) AS $body$
DECLARE


cd_cnpj_w			varchar(14);
cd_estabelecimento_w		smallint;
cd_referencia_w			varchar(80);
ds_justificativa_padrao_w		varchar(4000);
ds_observacao_w			varchar(4000);
dt_reprovacao_w			timestamp;
dt_validade_cert_aprov_w		timestamp;
dt_validade_reg_anvisa_w		timestamp;
ie_padronizado_w			varchar(15);
ie_situacao_w			varchar(1);
nm_usuario_reprovacao_w		varchar(15);
nr_certificado_aprovacao_w		varchar(20);
nr_registro_anvisa_w		varchar(60);
nr_seq_status_aval_w		bigint;
qt_conv_compra_est_w		double precision;
qt_prioridade_w			integer;
nr_seq_marca_w			bigint;
cd_unidade_medida_w		varchar(30);
ie_vigente_anvisa_w		varchar(1);

C01 CURSOR FOR
SELECT	cd_cnpj,
	cd_estabelecimento,
	cd_referencia,
	cd_unidade_medida,
	ds_justificativa_padrao,
	ds_observacao,
	dt_reprovacao,
	dt_validade_certificado_aprov,
	dt_validade_reg_anvisa,
	ie_padronizado,
	ie_situacao,
	nm_usuario_reprovacao,
	nr_certificado_aprovacao,
	nr_registro_anvisa,
	nr_seq_status_aval,
	qt_conv_compra_est,
	qt_prioridade,
	nr_sequencia,
	ie_vigente_anvisa
from	material_marca
where	cd_material = cd_material_p;


BEGIN

open C01;
loop
fetch C01 into
	cd_cnpj_w,
	cd_estabelecimento_w,
	cd_referencia_w,
	cd_unidade_medida_w,
	ds_justificativa_padrao_w,
	ds_observacao_w,
	dt_reprovacao_w,
	dt_validade_cert_aprov_w,
	dt_validade_reg_anvisa_w,
	ie_padronizado_w,
	ie_situacao_w,
	nm_usuario_reprovacao_w,
	nr_certificado_aprovacao_w,
	nr_registro_anvisa_w,
	nr_seq_status_aval_w,
	qt_conv_compra_est_w,
	qt_prioridade_w,
	nr_seq_marca_w,
	ie_vigente_anvisa_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin
	insert into material_marca(
		nr_sequencia,
		cd_cnpj,
		cd_estabelecimento,
		cd_material,
		cd_referencia,
		cd_unidade_medida,
		ds_justificativa_padrao,
		ds_observacao,
		dt_atualizacao,
		dt_reprovacao,
		dt_validade_certificado_aprov,
		dt_validade_reg_anvisa,
		ie_padronizado,
		ie_situacao,
		nm_usuario,
		nm_usuario_reprovacao,
		nr_certificado_aprovacao,
		nr_registro_anvisa,
		nr_seq_status_aval,
		qt_conv_compra_est,
		qt_prioridade,
		ie_vigente_anvisa)
	values (	nr_seq_marca_w,
		cd_cnpj_w,
	        cd_estabelecimento_w,
	        cd_material_novo_p,
		cd_referencia_w,
	        cd_unidade_medida_w,
	        ds_justificativa_padrao_w,
	        ds_observacao_w,
	        clock_timestamp(),
	        dt_reprovacao_w,
	        dt_validade_cert_aprov_w,
	        dt_validade_reg_anvisa_w,
	        ie_padronizado_w,
	        ie_situacao_w,
	        nm_usuario_p,
		nm_usuario_reprovacao_w,
		nr_certificado_aprovacao_w,
		nr_registro_anvisa_w,
		nr_seq_status_aval_w,
		qt_conv_compra_est_w,
		qt_prioridade_w,
		ie_vigente_anvisa_w);
	end;
end loop;
close C01;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copia_material_marca (cd_estabelecimento_p bigint, cd_material_p bigint, cd_material_novo_p bigint, nm_usuario_p text) FROM PUBLIC;

