-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE exec_sql_dinamico ( ds_identificacao_p text, ds_comando_p text) AS $body$
DECLARE


ds_module_w	varchar(48);
nr_seq_log_w	bigint;
c001	  	integer;		
retorno_w	integer;
ds_erro_w	varchar(512);


BEGIN
	begin
	C001 := DBMS_SQL.OPEN_CURSOR;
	DBMS_SQL.PARSE(C001, ds_comando_p, dbms_sql.Native);
	Retorno_w := DBMS_SQL.execute(c001);
	DBMS_SQL.CLOSE_CURSOR(C001);
	exception
	when others then
		begin		

		ds_erro_w	:= SQLERRM(SQLSTATE);

		CALL tratar_erro_banco(ds_erro_w);
		
		ds_module_w := wheb_usuario_pck.get_ds_form;
		
		if (position('CORSIS_FO_NR_SEQ=' in ds_module_w) >  0 ) then
			nr_seq_log_w := substr(ds_module_w,18,10);
			CALL GRAVAR_LOG_ATUALIZACAO_ERRO(nr_seq_log_w,ds_comando_p,ds_erro_w,substr(ds_identificacao_p,1,15));
		elsif (wheb_usuario_pck.get_gravar_log_tasy = 'S') then
			insert into log_tasy(DT_ATUALIZACAO, NM_USUARIO, CD_LOG, DS_LOG) values (clock_timestamp(),'Erro', 666,  ds_identificacao_p || '-> ' || ds_erro_w);
		end	if;
		DBMS_SQL.CLOSE_CURSOR(C001);
		end;
	end;
	
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE exec_sql_dinamico ( ds_identificacao_p text, ds_comando_p text) FROM PUBLIC;

