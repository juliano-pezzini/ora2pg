-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_cih_pac_fat_risco (nr_seq_ficha_ocorrencia_p cih_pac_fat_risco.nr_seq_ficha_ocorrencia%type, nr_seq_fator_risco_p cih_pac_fat_risco.nr_seq_fator_risco%type, cd_estabelecimento_p cih_pac_fat_risco.cd_estabelecimento%type, cd_pessoa_fisica_p cih_pac_fat_risco.cd_pessoa_fisica%type, cd_profissional_p cih_pac_fat_risco.cd_profissional%type, nm_usuario_p cih_pac_fat_risco.nm_usuario%type) AS $body$
DECLARE

    nr_sequencia_w cih_pac_fat_risco.nr_sequencia%type;
    qt_reg_w integer;

BEGIN

    select count(*)
    into STRICT   qt_reg_w
    from   cih_pac_fat_risco
    where  nr_seq_ficha_ocorrencia = nr_seq_ficha_ocorrencia_p
    and    nr_seq_fator_risco = nr_seq_fator_risco_p;

    if (qt_reg_w = 0) then

        select nextval('cih_pac_fat_risco_seq')
        into STRICT   nr_sequencia_w
;

        insert into cih_pac_fat_risco(nr_sequencia,
               nr_seq_ficha_ocorrencia,
               nr_seq_fator_risco,
               cd_estabelecimento,
               cd_pessoa_fisica,
               cd_profissional,
               nm_usuario,
               dt_atualizacao,
               nm_usuario_nrec,
               dt_atualizacao_nrec)
        values (nr_sequencia_w,
               nr_seq_ficha_ocorrencia_p,
               nr_seq_fator_risco_p,
               cd_estabelecimento_p,
               cd_pessoa_fisica_p,
               cd_profissional_p,
               nm_usuario_p,
               clock_timestamp(),
               nm_usuario_p,
               clock_timestamp());

        commit;

    end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_cih_pac_fat_risco (nr_seq_ficha_ocorrencia_p cih_pac_fat_risco.nr_seq_ficha_ocorrencia%type, nr_seq_fator_risco_p cih_pac_fat_risco.nr_seq_fator_risco%type, cd_estabelecimento_p cih_pac_fat_risco.cd_estabelecimento%type, cd_pessoa_fisica_p cih_pac_fat_risco.cd_pessoa_fisica%type, cd_profissional_p cih_pac_fat_risco.cd_profissional%type, nm_usuario_p cih_pac_fat_risco.nm_usuario%type) FROM PUBLIC;

