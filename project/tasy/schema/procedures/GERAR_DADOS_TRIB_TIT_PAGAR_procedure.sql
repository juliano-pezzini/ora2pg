-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_dados_trib_tit_pagar (cd_tributo_p bigint, cd_estabelecimento_p bigint, dt_referencia_p timestamp, nr_titulo_p bigint) AS $body$
DECLARE



cd_beneficiario_w	varchar(20)	:= null;
pr_aliquota_w		double precision	:= null;
vl_minimo_base_w	double precision	:= 0;
vl_minimo_tributo_w	double precision	:= 0;
VL_TETO_BASE_CALCULO_w	double precision	:= 0;
vl_desc_dependente_w	double precision	:= 0;
cd_cond_pagto_w		bigint	:= null;
cd_conta_financ_w	bigint	:= null;
nr_seq_trans_reg_w	bigint	:= null;
nr_seq_trans_baixa_w	bigint	:= null;
ie_acumulativo_w	varchar(1);
cd_darf_w		varchar(10);
cd_variacao_w		varchar(2)	:= null;
ie_periodicidade_w	varchar(1)	:= null;
cd_cgc_titulo_w		varchar(14)	:= null;
cd_pf_titulo_w		varchar(10)	:= null;
VL_TETO_BASE_w		double precision	:= null;
ds_irrelevante_w		varchar(4000);
nr_seq_classe_w		bigint;
cd_tipo_baixa_neg_w	integer;
vl_titulo_w		double precision;
nr_seq_classe_tit_w	bigint;
ie_origem_titulo_w	titulo_pagar.ie_origem_titulo%type;


BEGIN

select	max(a.vl_titulo),
	max(a.nr_seq_classe),
	max(ie_origem_titulo)
into STRICT	vl_titulo_w,
	nr_seq_classe_tit_w,
	ie_origem_titulo_w
from	titulo_pagar a
where	a.nr_titulo	= nr_titulo_p;

SELECT * FROM OBTER_DADOS_TRIB_TIT_PAGAR(	cd_tributo_p, cd_estabelecimento_p, cd_cgc_titulo_w, cd_pf_titulo_w, cd_beneficiario_w, pr_aliquota_w, cd_cond_pagto_w, cd_conta_financ_w, nr_seq_trans_reg_w, nr_seq_trans_baixa_w, VL_MINIMO_BASE_w, VL_MINIMO_TRIBUTO_w, ie_acumulativo_w, VL_TETO_BASE_w, vl_desc_dependente_w, cd_darf_w, dt_referencia_p, cd_variacao_w, ie_periodicidade_w, null, null, null, null, null, null, ds_irrelevante_w, null, 0, nr_seq_classe_w, cd_tipo_baixa_neg_w, vl_titulo_w, 'N', nr_seq_classe_tit_w, ie_origem_titulo_w, null, null) INTO STRICT cd_beneficiario_w, pr_aliquota_w, cd_cond_pagto_w, cd_conta_financ_w, nr_seq_trans_reg_w, nr_seq_trans_baixa_w, VL_MINIMO_BASE_w, VL_MINIMO_TRIBUTO_w, ie_acumulativo_w, VL_TETO_BASE_w, vl_desc_dependente_w, cd_darf_w, cd_variacao_w, ie_periodicidade_w, ds_irrelevante_w, nr_seq_classe_w, cd_tipo_baixa_neg_w;

update	titulo_pagar
set	cd_darf = cd_darf_w
where	nr_titulo = nr_titulo_p;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_dados_trib_tit_pagar (cd_tributo_p bigint, cd_estabelecimento_p bigint, dt_referencia_p timestamp, nr_titulo_p bigint) FROM PUBLIC;

