-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copia_kit_mat_prescricao ( cd_estabelecimento_p bigint, cd_material_p bigint, cd_material_novo_p bigint, nm_usuario_p text) AS $body$
DECLARE


/* Campos da tabela LOOP */

cd_kit_w                  	bigint;
cd_material_w             	bigint;
qt_volume_w               	double precision;
ie_via_aplicacao_w        	varchar(5);
cd_unidade_medida_w       	varchar(30);
cd_setor_atendimento_w    	integer;
cd_setor_excluir_w        	integer;
ie_tipo_atendimento_w     	smallint;
qt_idade_min_w            	smallint;
qt_idade_min_mes_w			double precision;
qt_idade_min_dia_w			double precision;
qt_idade_max_w            	smallint;
qt_idade_max_mes_w			double precision;
qt_idade_max_dia_w			double precision;
nr_seq_via_acesso_w       	bigint;
qt_dose_max_w             	double precision;
qt_dose_min_w             	double precision;
cd_unidade_medida_dose_w	varchar(30);
qt_tempo_min_w            	bigint;
qt_tempo_max_w            	bigint;
ie_gerar_lib_farm_w       	varchar(1);
ie_gerar_recons_dilui_w   	varchar(1);
ie_bomba_infusao_w        	varchar(1);
nr_horas_validade_kit_w   	integer;
nr_seq_agrupamento_w		bigint;

/*  Sequencia da tabela */

nr_sequencia_w		bigint;

C01 CURSOR FOR
	SELECT	cd_kit,
			qt_volume,
			ie_via_aplicacao,
			cd_unidade_medida,
			cd_setor_atendimento,
			cd_setor_excluir,
			ie_tipo_atendimento,
			qt_idade_min,
			qt_idade_min_mes,
			qt_idade_min_dia,
			qt_idade_max,
			qt_idade_max_mes,
			qt_idade_max_dia,
			nr_seq_via_acesso,
			qt_dose_max,
			qt_dose_min,
			cd_unidade_medida_dose,
			qt_tempo_min,
			qt_tempo_max,
			ie_gerar_lib_farm,
			ie_gerar_recons_dilui,
			ie_bomba_infusao,
			nr_horas_validade_kit,
			nr_seq_agrupamento
	from	kit_mat_prescricao
	where	cd_material = cd_material_p;


BEGIN

open C01;
loop
fetch C01 into
	cd_kit_w,
	qt_volume_w,
	ie_via_aplicacao_w,
	cd_unidade_medida_w,
	cd_setor_atendimento_w,
	cd_setor_excluir_w,
	ie_tipo_atendimento_w,
	qt_idade_min_w,
	qt_idade_min_mes_w,
	qt_idade_min_dia_w,
	qt_idade_max_w,
	qt_idade_max_mes_w,
	qt_idade_max_dia_w,
	nr_seq_via_acesso_w,
	qt_dose_max_w,
	qt_dose_min_w,
	cd_unidade_medida_dose_w,
	qt_tempo_min_w,
	qt_tempo_max_w,
	ie_gerar_lib_farm_w,
	ie_gerar_recons_dilui_w,
	ie_bomba_infusao_w,
	nr_horas_validade_kit_w,
	nr_seq_agrupamento_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin

	select	nextval('kit_mat_prescricao_seq')
	into STRICT	nr_sequencia_w
	;

	insert into kit_mat_prescricao(		nr_sequencia,
					cd_estabelecimento,
					dt_atualizacao,
					nm_usuario,
					cd_kit,
					cd_material,
					qt_volume,
					ie_via_aplicacao,
					cd_unidade_medida,
					cd_setor_atendimento,
					cd_setor_excluir,
					ie_tipo_atendimento,
					qt_idade_min,
					qt_idade_min_mes,
					qt_idade_min_dia,
					qt_idade_max,
					qt_idade_max_mes,
					qt_idade_max_dia,
					nr_seq_via_acesso,
					qt_dose_max,
					qt_dose_min,
					cd_unidade_medida_dose,
					qt_tempo_min,
					qt_tempo_max,
					ie_gerar_lib_farm,
					ie_gerar_recons_dilui,
					ie_bomba_infusao,
					nr_horas_validade_kit,
					nr_seq_agrupamento)
	values (	nr_sequencia_w,
					cd_estabelecimento_p,
					clock_timestamp(),
					nm_usuario_p,
					cd_kit_w,
					cd_material_novo_p,
					qt_volume_w,
					ie_via_aplicacao_w,
					cd_unidade_medida_w,
					cd_setor_atendimento_w,
					cd_setor_excluir_w,
					ie_tipo_atendimento_w,
					qt_idade_min_w,
					qt_idade_min_mes_w,
					qt_idade_min_dia_w,
					qt_idade_max_w,
					qt_idade_max_mes_w,
					qt_idade_max_dia_w,
					nr_seq_via_acesso_w,
					qt_dose_max_w,
					qt_dose_min_w,
					cd_unidade_medida_dose_w,
					qt_tempo_min_w,
					qt_tempo_max_w,
					ie_gerar_lib_farm_w,
					ie_gerar_recons_dilui_w,
					ie_bomba_infusao_w,
					nr_horas_validade_kit_w,
					nr_seq_agrupamento_w
					);


	end;
end loop;
close C01;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copia_kit_mat_prescricao ( cd_estabelecimento_p bigint, cd_material_p bigint, cd_material_novo_p bigint, nm_usuario_p text) FROM PUBLIC;

