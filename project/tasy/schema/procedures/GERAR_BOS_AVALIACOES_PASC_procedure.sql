-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_bos_avaliacoes_pasc ( nr_seq_avaliacao_p bigint, nr_seq_questao_p bigint, nr_seq_item_p bigint, ds_item_p text, ds_resposta_p text, ds_justificativa_p text, nm_usuario_p text, cd_cnpj_cliente_p text ) AS $body$
DECLARE


/*

ATENÇÃO!

ESTA ROTINA É EXTREMAMENTE HARDCODED!

*/
ds_boletim_w 				varchar(1000);
nr_sequencia_bo_w 			sac_boletim_ocorrencia.nr_sequencia%type;
nr_seq_responsavel_w 		bigint;
nr_seq_classif_w			bigint;
nr_seq_tipo_w				bigint;
nm_pessoa_resp_w			varchar(4000);
ds_email_pessoa_resp_w		varchar(4000);
cd_setor_atend_w			integer;
ie_produto_w				integer;
cd_pessoa_fisica_criacao_w	bigint;


BEGIN

	ds_boletim_w := 'PASC 2016 ' || chr(10) || chr(13) ||
					ds_item_p || chr(10) || chr(13) ||
					ds_justificativa_p;

	select	max(qt_resultado)
	into STRICT	ie_produto_w
	from	med_avaliacao_result
	where	nr_seq_avaliacao = nr_seq_avaliacao_p
	and		nr_seq_item = 19523;

	nm_pessoa_resp_w := '';
	ds_email_pessoa_resp_w := '';
	if (nr_seq_item_p > 19633) then
		select	max(ds_resultado)
		into STRICT	nm_pessoa_resp_w
		from	med_avaliacao_result
		where	nr_seq_avaliacao = nr_seq_avaliacao_p
		and		nr_seq_item = 19633;

		select	max(ds_resultado)
		into STRICT	ds_email_pessoa_resp_w
		from	med_avaliacao_result
		where	nr_seq_avaliacao = nr_seq_avaliacao_p
		and		nr_seq_item = 19809;
	else
		select	max(ds_resultado)
		into STRICT	nm_pessoa_resp_w
		from	med_avaliacao_result
		where	nr_seq_avaliacao = nr_seq_avaliacao_p
		and		nr_seq_item = 19520;

		select	max(ds_resultado)
		into STRICT	ds_email_pessoa_resp_w
		from	med_avaliacao_result
		where	nr_seq_avaliacao = nr_seq_avaliacao_p
		and		nr_seq_item = 19808;
	end if;

	select	nextval('sac_boletim_ocorrencia_seq')
	into STRICT	nr_sequencia_bo_w
	;

	select	cd_pessoa_fisica
	into STRICT	cd_pessoa_fisica_criacao_w
	from	usuario
	where	nm_usuario = nm_usuario_p;

	insert into sac_boletim_ocorrencia(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_ocorrencia,
		ie_origem,
		ds_ocorrencia,
		nm_usuario_nrec,
		cd_cgc,
		nm_pessoa_registro,
		cd_pessoa_fisica,
		dt_atualizacao_nrec)
	values (
		nr_sequencia_bo_w,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		'E',
		ds_boletim_w,
		nm_usuario_p,
		cd_cnpj_cliente_p,
		nm_pessoa_resp_w,
		cd_pessoa_fisica_criacao_w,
		clock_timestamp());

	if (nr_seq_questao_p in (19545)) then
		nr_seq_tipo_w := 854; -- Expectativa do cliente na venda
		nr_seq_responsavel_w := 1; -- Vendas
		cd_setor_atend_w := 5; -- Vendas
	elsif (nr_seq_questao_p in (19560, 19670, 19671, 19672)) then
		if (nr_seq_questao_p in (19560, 19672)) then
			nr_seq_tipo_w := 855; -- Satisfação com a entrega do projeto
		elsif (nr_seq_questao_p = 19670) then
			nr_seq_tipo_w := 862; -- Qualidade da documentação
		elsif (nr_seq_questao_p = 19671) then
			nr_seq_tipo_w := 384; -- Qualidade do acompanhamento do projeto
		end if;

		nr_seq_responsavel_w := 92; -- Coordenação de Projetos
		cd_setor_atend_w := 6; -- Projetos
	elsif (nr_seq_questao_p in (19575, 19576, 19577, 19696, 19697, 19698)) then
		if (ie_produto_w in (1, 2)) then
			if (nr_seq_questao_p = 19575) then
				nr_seq_tipo_w := 858; -- Qualidade do produto
			elsif (nr_seq_questao_p = 19576) then
				nr_seq_tipo_w := 401; -- Aderência a realidade do cliente
			elsif (nr_seq_questao_p in (19577, 19698)) then
				nr_seq_tipo_w := 367; -- Inovações do produto
			elsif (nr_seq_questao_p = 19696) then
				nr_seq_tipo_w := 865; -- Estabilidade do sistema
			elsif (nr_seq_questao_p = 19697) then
				nr_seq_tipo_w := 366; -- Versão após atualização
			end if;

			nr_seq_responsavel_w := 13; -- Produto Tasy
		elsif (ie_produto_w = 3) then
			if (nr_seq_questao_p = 19575) then
				nr_seq_tipo_w := 856; -- Qualidade do produto
			elsif (nr_seq_questao_p = 19576) then
				nr_seq_tipo_w := 651; -- Aderência a realidade do cliente
			elsif (nr_seq_questao_p in (19577, 19698)) then
				nr_seq_tipo_w := 655; -- Inovações do produto
			elsif (nr_seq_questao_p = 19696) then
				nr_seq_tipo_w := 863; -- Estabilidade do sistema
			elsif (nr_seq_questao_p = 19697) then
				nr_seq_tipo_w := null;
			end if;

			nr_seq_responsavel_w := 131; -- Produto MultiMed
		else
			if (nr_seq_questao_p = 19575) then
				nr_seq_tipo_w := 857; -- Qualidade do produto
			elsif (nr_seq_questao_p = 19576) then
				nr_seq_tipo_w := 734; -- Aderência a realidade do cliente
			elsif (nr_seq_questao_p in (19577, 19698)) then
				nr_seq_tipo_w := 735; -- Inovações do produto
			elsif (nr_seq_questao_p = 19696) then
				nr_seq_tipo_w := 864; -- Estabilidade do sistema
			elsif (nr_seq_questao_p = 19697) then
				nr_seq_tipo_w := null;
			end if;

			nr_seq_responsavel_w := 161; -- Produto PACS
		end if;

		cd_setor_atend_w := 25; -- Customização
	elsif (nr_seq_questao_p in (19601, 19610, 19611, 19612, 19800)) then
		if (nr_seq_questao_p = 19601) then
			nr_seq_tipo_w := 859; -- Necessidades suportadas pela Philips
		elsif (nr_seq_questao_p = 19610) then
			nr_seq_tipo_w := 751; -- Relacionamento
		elsif (nr_seq_questao_p in (19611, 19800)) then
			nr_seq_tipo_w := 860; -- Indicação das soluções TI Philips
		elsif (nr_seq_questao_p = 19612) then
			nr_seq_tipo_w := 861; -- Satisfação geral com produto e serviços
		end if;

		nr_seq_responsavel_w := 151; -- Pós vendas
		cd_setor_atend_w := 23; -- Pós - vendas
	elsif (nr_seq_questao_p in (19645, 19646, 19647)) then
		if (nr_seq_questao_p = 19645) then
			nr_seq_tipo_w := 53; -- Conhecimento de sistema
		elsif (nr_seq_questao_p = 19646) then
			nr_seq_tipo_w := 378; -- Responsabilidade
		elsif (nr_seq_questao_p = 19647) then
			nr_seq_tipo_w := 377; -- Qualidade do trabalho fornecido
		end if;

		nr_seq_responsavel_w := 12; -- Consultoria
		cd_setor_atend_w := 6; -- Projetos
	elsif (nr_seq_questao_p in (19721, 19722, 19723)) then
		nr_seq_responsavel_w := 5; -- Desenvolvimento
		cd_setor_atend_w := 2; -- Desenvolvimento
	elsif (nr_seq_questao_p in (19746, 19747, 19748)) then
		if (nr_seq_questao_p = 19746) then
			nr_seq_tipo_w := 885; -- Tempo de análise da OS
		elsif (nr_seq_questao_p = 19747) then
			nr_seq_tipo_w := 886; -- Tempo de solução da OS
		elsif (nr_seq_questao_p = 19748) then
			nr_seq_tipo_w := 887; -- Assertividade das respostas
		end if;

		nr_seq_responsavel_w := 4; -- Suporte
		cd_setor_atend_w := 4; -- Suporte
	elsif (nr_seq_questao_p in (19772, 19773, 19774)) then
		if (nr_seq_questao_p = 19772) then
			nr_seq_tipo_w := 392; -- Conteúdo ministrado
		elsif (nr_seq_questao_p = 19773) then
			nr_seq_tipo_w := 394; -- Conhecimento do instrutor
		elsif (nr_seq_questao_p = 19774) then
			nr_seq_tipo_w := 207; -- Cursos oferecidos
		end if;

		nr_seq_responsavel_w := 6; -- Treinamento
		cd_setor_atend_w := 10; -- Treinamentos
	end if;

	if (upper(ds_resposta_p) in ('4','5','SIM')) then
		nr_seq_classif_w := 2; -- Elogio
	else
		nr_seq_classif_w := 3; -- Crítica com evidência
	end if;

	insert into sac_bol_ocor_adic(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		nr_seq_bol_ocor,
		cd_setor_atendimento,
		ds_email_pf_registro )
	values (
		nextval('sac_bol_ocor_adic_seq'),
		clock_timestamp(),
		nm_usuario_p,
		nr_sequencia_bo_w,
		cd_setor_atend_w,
		ds_email_pessoa_resp_w );

	insert into sac_resp_bol_ocor(
		nr_sequencia,
		nr_seq_bo,
		ie_status,
		dt_atualizacao,
		nm_usuario,
		nr_seq_responsavel,
		nr_seq_classif,
		dt_resposta,
		nr_seq_tipo,
		nr_seq_classif_tecnica)
	values (
		nextval('sac_resp_bol_ocor_seq'),
		nr_sequencia_bo_w,
		'A',
		clock_timestamp(),
		nm_usuario_p,
		nr_seq_responsavel_w,
		nr_seq_classif_w,
		clock_timestamp(),
		nr_seq_tipo_w,
		1);

	update	med_avaliacao_result
	set	ds_auxiliar = nr_sequencia_bo_w
	where	nr_seq_avaliacao = nr_seq_avaliacao_p
	and	nr_seq_item = nr_seq_item_p;

	commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_bos_avaliacoes_pasc ( nr_seq_avaliacao_p bigint, nr_seq_questao_p bigint, nr_seq_item_p bigint, ds_item_p text, ds_resposta_p text, ds_justificativa_p text, nm_usuario_p text, cd_cnpj_cliente_p text ) FROM PUBLIC;

