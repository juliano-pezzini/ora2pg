-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atual_grav_dermatite ( nr_sequencia_p bigint) AS $body$
DECLARE



ds_retorno_w           varchar(255);
ds_gravidade_w          char(1);
ie_pele_w		varchar(3);



BEGIN

select  max(ie_integridade_pele)
into STRICT    ie_pele_w
from    qua_evento_dermatite
where   nr_sequencia = nr_sequencia_p;


select  count(*)
into STRICT    ds_retorno_w
from    qua_evento_derm_area
where   nr_seq_dermatite = nr_sequencia_p;

if ( ds_retorno_w <= 6) and (ie_pele_w = 1 ) then
    ds_gravidade_w := 'L';
elsif (ds_retorno_w >= 7) and (ie_pele_w = 1 ) then
      ds_gravidade_w := 'M';
elsif (ds_retorno_w <=3) and (ie_pele_w = 2 ) then
       ds_gravidade_w := 'M';
elsif (ds_retorno_w = 1) and (ie_pele_w = 3 ) then
      ds_gravidade_w := 'M';
elsif (ds_retorno_w between 6 and 9) and (ie_pele_w = 2) then
      ds_gravidade_w := 'S';
elsif (ds_retorno_w > 1) and (ie_pele_w = 3 ) then
      ds_gravidade_w := 'S';
end if;

update  qua_evento_dermatite
set     ie_gravidade = ds_gravidade_w
where   nr_Sequencia = nr_sequencia_p;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atual_grav_dermatite ( nr_sequencia_p bigint) FROM PUBLIC;

