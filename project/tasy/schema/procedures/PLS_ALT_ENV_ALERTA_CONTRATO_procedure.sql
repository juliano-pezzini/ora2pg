-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_alt_env_alerta_contrato ( nr_seq_contrato_p pls_contrato.nr_sequencia%type, nm_usuario_p text, cd_estabelecimento_p bigint) AS $body$
DECLARE


ie_enviar_alerta_resc_benef_w		pls_contrato.ie_enviar_alerta_resc_benef%type;
ie_enviar_alerta_resc_aux		pls_contrato.ie_enviar_alerta_resc_benef%type;
	

BEGIN

select 	coalesce(ie_enviar_alerta_resc_benef, 'N')
into STRICT 	ie_enviar_alerta_resc_aux
from	pls_contrato
where	nr_sequencia = nr_seq_contrato_p;

if (ie_enviar_alerta_resc_aux = 'S') then
	ie_enviar_alerta_resc_benef_w := 'N';
else
	ie_enviar_alerta_resc_benef_w := 'S';
end if;

update	pls_contrato
set	nm_usuario 	= nm_usuario_p,
	dt_atualizacao 	= clock_timestamp(),
	ie_enviar_alerta_resc_benef = ie_enviar_alerta_resc_benef_w
where	nr_sequencia = nr_seq_contrato_p;

insert into pls_contrato_historico(cd_estabelecimento, ds_historico, ds_observacao
	, dt_atualizacao, dt_atualizacao_nrec     
	,dt_historico, ie_tipo_historico, nm_usuario, nm_usuario_historico   
	,nm_usuario_nrec, nr_seq_contrato ,nr_sequencia)
	values (cd_estabelecimento_p, 'De "' || ie_enviar_alerta_resc_aux || '" para "' || ie_enviar_alerta_resc_benef_w || '".', 'pls_alt_env_alerta_contrato'           
	, clock_timestamp(), clock_timestamp()     
	,clock_timestamp(), 107,nm_usuario_p, nm_usuario_p    
	,nm_usuario_p, nr_seq_contrato_p, nextval('pls_contrato_historico_seq') );

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_alt_env_alerta_contrato ( nr_seq_contrato_p pls_contrato.nr_sequencia%type, nm_usuario_p text, cd_estabelecimento_p bigint) FROM PUBLIC;

