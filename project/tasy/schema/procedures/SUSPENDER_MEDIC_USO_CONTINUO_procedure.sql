-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE suspender_medic_uso_continuo (nr_sequencia_p bigint, nr_seq_motivo_p bigint, cd_material_p bigint, ie_opcao_p bigint, ds_justificativa_p text, nm_usuario_p text) AS $body$
BEGIN

if (coalesce(nr_seq_motivo_p,0) = 0) then
	--É necessário informar o motivo de suspensão para o medicamento #@#@');
	CALL Wheb_mensagem_pck.exibir_mensagem_abort(261599);
elsif (coalesce(nr_sequencia_p,0) <> 0) then

	if (ie_opcao_p = 0) then
		update 	medic_uso_continuo
		set    	dt_suspensao      = clock_timestamp(),
			nm_usuario_susp   = nm_usuario_p,
			dt_atualizacao    = clock_timestamp(),
			nm_usuario        = nm_usuario_p,
			nr_seq_motivo_susp	= nr_seq_motivo_p,
			ds_justificativa	= ds_justificativa_p
	        where  nr_sequencia       = nr_sequencia_p;
	elsif (ie_opcao_p = 1) then

		if (coalesce(cd_material_p::text, '') = '') then
			--É necessário informar o medicamento para substituição #@#@');
			CALL Wheb_mensagem_pck.exibir_mensagem_abort(261600);
		else
		insert into medic_uso_continuo(
			nr_sequencia,
			dt_atualizacao,
				nm_usuario,
				dt_atualizacao_nrec,
				nm_usuario_nrec,
				cd_pessoa_fisica,
				dt_inicio,
				cd_material,
				qt_dose,
				cd_unidade_medida,
				nr_dias_uso,
				ie_uso_continuo,
				ie_laudo_lme,
				cd_cid_principal,
				cd_cid_secundario,
				cd_intervalo,
				ie_via_aplicacao)
			SELECT	nextval('medic_uso_continuo_seq'),
				clock_timestamp(),
				nm_usuario_p,
				clock_timestamp(),
				nm_usuario_p,
				cd_pessoa_fisica,
				clock_timestamp(),
				cd_material_p,
				qt_dose,
				cd_unidade_medida,
				nr_dias_uso,
				ie_uso_continuo,
				ie_laudo_lme,
				cd_cid_principal,
				cd_cid_secundario,
				cd_intervalo,
				ie_via_aplicacao
			from	medic_uso_continuo
			where	nr_sequencia	= nr_sequencia_p;

			update 	medic_uso_continuo
			set    	dt_suspensao      = clock_timestamp(),
				nm_usuario_susp   = nm_usuario_p,
				dt_atualizacao    = clock_timestamp(),
				nm_usuario        = nm_usuario_p,
				nr_seq_motivo_susp	= nr_seq_motivo_p,
				ds_justificativa	= ds_justificativa_p
		        where  nr_sequencia       = nr_sequencia_p;
		end if;
	end if;
end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE suspender_medic_uso_continuo (nr_sequencia_p bigint, nr_seq_motivo_p bigint, cd_material_p bigint, ie_opcao_p bigint, ds_justificativa_p text, nm_usuario_p text) FROM PUBLIC;

