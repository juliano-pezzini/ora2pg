-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE man_calcular_custo_os_equip ( nr_seq_equipamento_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_ordem_servico_w				bigint;

C01 CURSOR FOR
SELECT	nr_sequencia
from	man_ordem_servico
where	trunc(dt_ordem_servico) between trunc(clock_timestamp()) - 60 and clock_timestamp()
and	nr_seq_equipamento = nr_seq_equipamento_p;


BEGIN

/*Listar Ordens de serviço do equipamento*/

open c01;
loop
fetch C01 into
	nr_ordem_servico_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin
	/*Limpar o custo se já gravado */

	delete from man_ordem_serv_custo
	where	nr_seq_ordem_serv	= nr_ordem_servico_w;

	/* Matheus OS 86276 14/03/2008 Alterei a rotina para chamar esta procedure que já faz o calculo do custo por OS*/

	CALL man_calcular_custo_os(nr_ordem_servico_w, nm_usuario_p);
	end;
end loop;
close c01;
commit;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE man_calcular_custo_os_equip ( nr_seq_equipamento_p bigint, nm_usuario_p text) FROM PUBLIC;

