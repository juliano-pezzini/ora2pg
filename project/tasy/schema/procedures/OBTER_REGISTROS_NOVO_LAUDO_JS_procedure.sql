-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_registros_novo_laudo_js ( nr_sequencia_p bigint, nr_atend_origem_p bigint, nr_laudo_sus_p INOUT bigint, cd_procedimento_solic_p INOUT text, ie_origem_proced_p INOUT text, ie_proced_previsto_sus_p INOUT text, cd_cid_principal_p INOUT text, cd_cid_secundario_p INOUT text) AS $body$
DECLARE

 
nr_laudo_sus_w			smallint;
cd_procedimento_solic_w		varchar(20);
ie_origem_proced_w		varchar(20);
ie_proced_previsto_sus_w	varchar(1);
cd_cid_principal_w		varchar(10);
cd_cid_secundario_w		varchar(10);


BEGIN 
 
if (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '')then 
	begin 
	 
	select 	coalesce(max(nr_laudo_sus),0)+1 
	into STRICT	nr_laudo_sus_w 
	from 	sus_laudo_paciente 
	where 	nr_seq_atend_futuro = nr_sequencia_p;
	 
	cd_procedimento_solic_w		:= obter_proced_princ_laudo_SUS(nr_sequencia_p);
	ie_origem_proced_w		:= obter_origem_princ_laudo_sus(nr_sequencia_p);
	 
	ie_proced_previsto_sus_w 	:= obter_se_proced_previsto_sus(nr_sequencia_p);
	 
	cd_cid_principal_w		:= obter_cid_atendimento(nr_atend_origem_p,'P');
	cd_cid_secundario_w		:= obter_cid_atendimento(nr_atend_origem_p,'S');
	 
	end;
end if;
 
nr_laudo_sus_p			:= nr_laudo_sus_w;
cd_procedimento_solic_p		:= cd_procedimento_solic_w;
ie_origem_proced_p		:= ie_origem_proced_w;
ie_proced_previsto_sus_p	:= ie_proced_previsto_sus_w;
cd_cid_principal_p		:= cd_cid_principal_w;
cd_cid_secundario_p		:= cd_cid_secundario_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_registros_novo_laudo_js ( nr_sequencia_p bigint, nr_atend_origem_p bigint, nr_laudo_sus_p INOUT bigint, cd_procedimento_solic_p INOUT text, ie_origem_proced_p INOUT text, ie_proced_previsto_sus_p INOUT text, cd_cid_principal_p INOUT text, cd_cid_secundario_p INOUT text) FROM PUBLIC;

