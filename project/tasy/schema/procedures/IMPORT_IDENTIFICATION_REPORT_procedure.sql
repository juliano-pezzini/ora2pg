-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE import_identification_report (cd_pessoa_fisica_p paciente_medic_uso.cd_pessoa_fisica%type, cd_material_p paciente_medic_uso.cd_material%type, qt_dose_p paciente_medic_uso.qt_dose%type, cd_unid_med_p paciente_medic_uso.cd_unid_med%type, ie_via_aplicacao_p paciente_medic_uso.ie_via_aplicacao%type, operation_type_p text, cd_profissional_p paciente_medic_uso.cd_pessoa_fisica%type, nr_atendimento_p paciente_medic_uso.nr_atendimento%type, nm_usuario_p paciente_medic_uso.nm_usuario%type, nm_usuario_nrec_p paciente_medic_uso.nm_usuario_nrec%type, ds_horarios_p paciente_medic_uso.ds_horarios%type, cd_intervalo_p paciente_medic_uso.cd_intervalo%type) AS $body$
DECLARE

				
	record_count_w smallint;
	cd_identification_w paciente_medic_uso.cd_identification_report%type;



BEGIN
		select count(*) into STRICT record_count_w from PACIENTE_MEDIC_USO where coalesce(DT_LIBERACAO::text, '') = '' and CD_PESSOA_FISICA  = cd_pessoa_fisica_p and (CD_IDENTIFICATION_REPORT IS NOT NULL AND CD_IDENTIFICATION_REPORT::text <> '');
	
		if record_count_w > 0 then
		  select CD_IDENTIFICATION_REPORT into STRICT cd_identification_w from PACIENTE_MEDIC_USO where coalesce(DT_LIBERACAO::text, '') = '' and CD_PESSOA_FISICA  = cd_pessoa_fisica_p and (CD_IDENTIFICATION_REPORT IS NOT NULL AND CD_IDENTIFICATION_REPORT::text <> '')  LIMIT 1;
	    else
		  cd_identification_w := generate_identification_report();
		end if;
		if ( operation_type_p = 'INSERT') then
				 insert
				   into paciente_medic_uso(
							  nr_sequencia             ,
								cd_pessoa_fisica         ,
								dt_atualizacao           ,
								nm_usuario               ,
								cd_material              ,
								cd_unid_med              ,
								cd_intervalo             ,
								qt_dose                  ,
								dt_inicio                ,
								dt_fim                   ,
								ds_reacao                ,
								ds_observacao            ,
								ds_medicamento           ,
								nr_atendimento           ,
								dt_registro              ,
								ie_intensidade           ,
								dt_atualizacao_nrec      ,
								nm_usuario_nrec          ,
								dt_liberacao             ,
								nm_usuario_liberacao     ,
								nr_seq_nivel_seg         ,
								nr_seq_saep              ,
								dt_inativacao            ,
								nm_usuario_inativacao    ,
								ds_justificativa         ,
								nr_seq_reg_elemento      ,
								dt_ultima_dose           ,
								ie_nao_sabe_inicio       ,
								ie_nao_sabe_fim          ,
								ie_nao_sabe_ult_dose     ,
								ie_nega_medicamentos     ,
								ie_motivo_termino        ,
								ie_procedencia           ,
								ie_auto_medicacao        ,
								nr_seq_assinatura        ,
								dt_revisao               ,
								nm_usuario_revisao       ,
								nr_seq_assinat_inativacao,
								ie_alerta                ,
								cd_setor_atendimento     ,
								cd_setor_revisao         ,
								nm_usuario_termino       ,
								ds_just_termino          ,
								ie_nao_sabe_medicamentos ,
								ie_nao_sabe_dose         ,
								ie_via_aplicacao         ,
								ds_horarios              ,
								ds_utc                   ,
								ie_horario_verao         ,
								ds_utc_atualizacao       ,
								cd_profissional          ,
								qt_dose_manha            ,
								qt_dose_almoco           ,
								qt_dose_tarde            ,
								qt_dose_noite            ,
								ie_classificacao         ,
								ds_descricao_complementar,
								ds_motivo                ,
								nr_seq_versao            ,
								ds_intervalo_item        ,
								cd_unidade_medida_plano  ,
								ds_orientacao            ,
								ds_unidade_medida_estoque,
								ds_unidade_medida_consumo,
								ds_unidade_medida        ,
								ds_forma_medicamento     ,
								ds_horario_especial      ,
								ds_potencia              ,
								ds_dose_diferenciada     ,
								ie_tipo_medicamento      ,
								ds_forma_desc            ,
								ds_unid_med_desc         ,
								ds_princ_ativo           ,
								ie_exibir_plano_medic    ,
								nr_seq_hist_rotina       ,
								nr_seq_atend_cons_pepa   ,
								ie_medicacao_paciente    ,
								cd_identification_report ,
								nr_seq_rp                ,
								cd_rp_japan
							)
							values (
							  nextval('paciente_medic_uso_seq'),
								cd_pessoa_fisica_p            ,
								clock_timestamp()                       ,
								nm_usuario_p                  ,
								cd_material_p                 ,
								cd_unid_med_p                 ,
								cd_intervalo_p                ,
								qt_dose_p                     ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								nr_atendimento_p              ,
								clock_timestamp()                       ,
								'L'                           ,
								clock_timestamp()                       ,
								nm_usuario_nrec_p             ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
							  'N'                           ,
								'N'                           ,
								'N'                           ,
								'N'                           ,
								null                          ,
								'TH'                          ,
								'N'                           ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								'S'                           ,
								null                          ,
								null                          ,
								null                          ,
								null                          , 
								'N'                           ,
								'N'                           ,
								ie_via_aplicacao_p            ,
								ds_horarios_p                 ,
								null                          ,
								null                          ,
								null                          ,
								cd_profissional_p             ,
								0                             ,
								0                             ,
								0                             ,
								0                             ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								'0-0-0-0'                     ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								null                          ,
								'S'                           ,
								cd_identification_w           ,
								null                          ,
								null
							);	
		end if;
		commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE import_identification_report (cd_pessoa_fisica_p paciente_medic_uso.cd_pessoa_fisica%type, cd_material_p paciente_medic_uso.cd_material%type, qt_dose_p paciente_medic_uso.qt_dose%type, cd_unid_med_p paciente_medic_uso.cd_unid_med%type, ie_via_aplicacao_p paciente_medic_uso.ie_via_aplicacao%type, operation_type_p text, cd_profissional_p paciente_medic_uso.cd_pessoa_fisica%type, nr_atendimento_p paciente_medic_uso.nr_atendimento%type, nm_usuario_p paciente_medic_uso.nm_usuario%type, nm_usuario_nrec_p paciente_medic_uso.nm_usuario_nrec%type, ds_horarios_p paciente_medic_uso.ds_horarios%type, cd_intervalo_p paciente_medic_uso.cd_intervalo%type) FROM PUBLIC;

