-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE qua_duplicar_ata ( nr_sequencia_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_sequencia_w					proj_ata.nr_sequencia%type;
cd_estabelecimento_w				estabelecimento.cd_estabelecimento%type	:= wheb_usuario_pck.get_cd_estabelecimento;
ie_pend_concluidas_duplicar_w			varchar(1);


BEGIN

ie_pend_concluidas_duplicar_w := obter_param_usuario(4000, 311, obter_perfil_Ativo, nm_usuario_p, cd_estabelecimento_w, ie_pend_concluidas_duplicar_w);

select	nextval('proj_ata_seq')
into STRICT	nr_sequencia_w
;

insert into proj_ata(
		nr_sequencia,
		cd_estabelecimento,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		dt_ata,
		dt_liberacao,
		ds_ata,
		cd_consultor,
		nr_seq_documento,
		nr_seq_nao_conform,
		ie_tipo_ata,
		ie_geral,
		cd_pf_digitador,
		qt_min_duracao,
		cd_ata,
		nr_seq_classif,
		nr_seq_proj_gpi)
	SELECT	nr_sequencia_w,
		cd_estabelecimento,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		null,
		ds_ata,
		cd_consultor,
		nr_seq_documento,
		nr_seq_nao_conform,
		ie_tipo_ata,
		ie_geral,
		cd_pf_digitador,
		qt_min_duracao,
		cd_ata,
		nr_seq_classif,
		nr_seq_proj_gpi
	from	proj_ata
	where	nr_sequencia = nr_sequencia_p;

insert into proj_ata_participante(
		nr_sequencia,
		nr_seq_ata,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		cd_pessoa_participante,
		ie_faltou,
		cd_setor_atendimento,
		ds_setor,
		nm_pessoa_participante)
	SELECT	nextval('proj_ata_participante_seq'),
		nr_sequencia_w,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		cd_pessoa_participante,
		'N',
		cd_setor_atendimento,
		ds_setor,
		nm_pessoa_participante
	from	proj_ata_participante
	where	nr_seq_ata = nr_sequencia_p;

insert into proj_ata_pendencia(
		nr_sequencia,
		nr_seq_ata,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nm_pessoa_resp,
		ds_pendencia,
		dt_prev_solucao,
		cd_pessoa_resp,
		ie_relat_desempenho,
		ie_status)
	SELECT	nextval('proj_ata_pendencia_seq'),
		nr_sequencia_w,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		nm_pessoa_resp,
		ds_pendencia,
		dt_prev_solucao,
		cd_pessoa_resp,
		ie_relat_desempenho,
		ie_status
	from	proj_ata_pendencia
	where	nr_seq_ata = nr_sequencia_p
	and	((ie_pend_concluidas_duplicar_w = 'S') or (ie_pend_concluidas_duplicar_w = 'N' and coalesce(dt_conclusao_real::text, '') = ''));

insert into proj_ata_pauta(
		nr_sequencia,
		nr_seq_ata,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		ds_pauta)
	SELECT	nextval('proj_ata_pauta_seq'),
		nr_sequencia_w,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		ds_pauta
	from	proj_ata_pauta
	where	nr_seq_ata = nr_sequencia_p;

insert into proj_ata_conteudo(
		nr_sequencia,
		nr_seq_ata,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		ds_conteudo,
		ds_titulo,
		nr_seq_apresentacao)
	SELECT	nextval('proj_ata_conteudo_seq'),
		nr_sequencia_w,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		ds_conteudo,
		ds_titulo,
		nr_seq_apresentacao
	from	proj_ata_conteudo
	where	nr_seq_ata = nr_sequencia_p;

insert into proj_ata_lib(
		nr_sequencia,
		nr_seq_ata,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		cd_setor_atendimento,
		cd_cargo,
		nr_seq_grupo_usuario,
		nm_usuario_lib )
	SELECT	nextval('proj_ata_lib_seq'),
		nr_sequencia_w,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		cd_setor_atendimento,
		cd_cargo,
		nr_seq_grupo_usuario,
		nm_usuario_lib
	from	proj_ata_lib
	where	nr_seq_ata = nr_sequencia_p;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE qua_duplicar_ata ( nr_sequencia_p bigint, nm_usuario_p text) FROM PUBLIC;

