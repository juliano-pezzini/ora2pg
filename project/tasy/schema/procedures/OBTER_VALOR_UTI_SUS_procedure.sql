-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_valor_uti_sus ( ie_versao_aih_p text, qt_dia_uti_p bigint, vl_sh_p INOUT bigint, vl_sp_p INOUT bigint, vl_sadt_p INOUT bigint) AS $body$
DECLARE


ie_versao_aih_w	varchar(20);

nr_seq_w		bigint;
vl_sh_w			double precision;
vl_sadt_w		double precision;

C01 CURSOR FOR
	SELECT	nr_sequencia,
		vl_sh,
		vl_sadt
	from sus_aih_uti
	where ie_versao_aih = ie_versao_aih_p;


BEGIN

vl_sh_p := 0;
vl_sp_p := 0;
vl_sadt_p := 0;

if (qt_dia_uti_p > 0) then
	open C01;
	loop
		fetch C01 into
			nr_seq_w,
			vl_sh_w,
			vl_sadt_w;
		EXIT WHEN NOT FOUND; /* apply on C01 */
		if (nr_seq_w = 1) then
			if (qt_dia_uti_p < 3) then
				begin
				vl_sh_p		:= vl_sh_p + (vl_sh_w * qt_dia_uti_p);
				vl_sadt_p	:= vl_sadt_p + (vl_sadt_w * qt_dia_uti_p);
				end;
			else
				begin
				vl_sh_p		:= vl_sh_p + (vl_sh_w * 3);
				vl_sadt_p	:= vl_sadt_p + (vl_sadt_w * 3);
				end;
			end if;
		elsif (nr_seq_w = 2) then
			if (qt_dia_uti_p > 3) then
				begin
				vl_sh_p		:= vl_sh_p + (vl_sh_w * (qt_dia_uti_p - 3));
				vl_sadt_p	:= vl_sadt_p + (vl_sadt_w * (qt_dia_uti_p-3));
				end;
			end if;
		end if;
	end loop;
	close C01;
	vl_sh_p   := (vl_sh_p / qt_dia_uti_p);
	vl_sadt_p := (vl_sadt_p / qt_dia_uti_p);
end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_valor_uti_sus ( ie_versao_aih_p text, qt_dia_uti_p bigint, vl_sh_p INOUT bigint, vl_sp_p INOUT bigint, vl_sadt_p INOUT bigint) FROM PUBLIC;

