-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gerar_log_lib_item ( nr_seq_proc_p bigint, nr_seq_mat_p bigint, ie_tipo_valor_p text, nr_seq_regra_lib_p bigint, vl_base_p bigint, vl_glosa_p bigint, vl_liberado_p bigint, nr_seq_analise_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text ) AS $body$
DECLARE


ds_observacao_w		varchar(4000);
ds_evento_w		varchar(255);


BEGIN
ds_evento_w := 'Definido valor base para formação do valor liberado ';

/*if	(nvl(ie_tipo_valor_p,'X') = 'X') then
	ds_evento_w := ds_evento_w||'(Vl. apresentado)';
	ds_observacao_w := 'Liberado com a presença de glosas ativas.';
else*/
	if (coalesce(nr_seq_regra_lib_p,0) > 0) then
		ds_observacao_w := 'Regra de liberação de valores: '||nr_seq_regra_lib_p;
	end if;

	if (coalesce(ie_tipo_valor_p,'1') = '1') then
		ds_evento_w := ds_evento_w||'(Vl. apresentado)';
	else
		ds_evento_w := ds_evento_w||'(Vl. calculado)';
	end if;
--end if;
insert into pls_log_lib_valor_analise(nr_sequencia, nr_seq_analise, cd_estabelecimento,
	 dt_atualizacao, nm_usuario, dt_atualizacao_nrec,
	 nm_usuario_nrec, nr_seq_conta_proc, nr_seq_conta_mat,
	 nr_formacao, ds_evento, vl_base,
	 vl_glosa, vl_liberado, ds_observacao)
values (nextval('pls_log_lib_valor_analise_seq'), nr_seq_analise_p, cd_estabelecimento_p,
	 clock_timestamp(), nm_usuario_p, clock_timestamp(),
	 nm_usuario_p, nr_seq_proc_p, nr_seq_mat_p,
	 1, ds_evento_w, vl_base_p,
	 0, 0, ds_observacao_w);

ds_evento_w	:= 'Definido valor de glosa';
ds_observacao_w := '';

insert into pls_log_lib_valor_analise(nr_sequencia, nr_seq_analise, cd_estabelecimento,
	 dt_atualizacao, nm_usuario, dt_atualizacao_nrec,
	 nm_usuario_nrec, nr_seq_conta_proc, nr_seq_conta_mat,
	 nr_formacao, ds_evento, vl_base,
	 vl_glosa, vl_liberado, ds_observacao)
values (nextval('pls_log_lib_valor_analise_seq'), nr_seq_analise_p, cd_estabelecimento_p,
	 clock_timestamp(), nm_usuario_p, clock_timestamp(),
	 nm_usuario_p, nr_seq_proc_p, nr_seq_mat_p,
	 2, ds_evento_w, vl_base_p,
	 vl_glosa_p, 0, ds_observacao_w);

ds_evento_w	:= 'Liberação do valor';
ds_observacao_w	:= '';

insert into pls_log_lib_valor_analise(nr_sequencia, nr_seq_analise, cd_estabelecimento,
	 dt_atualizacao, nm_usuario, dt_atualizacao_nrec,
	 nm_usuario_nrec, nr_seq_conta_proc, nr_seq_conta_mat,
	 nr_formacao, ds_evento, vl_base,
	 vl_glosa, vl_liberado, ds_observacao)
values (nextval('pls_log_lib_valor_analise_seq'), nr_seq_analise_p, cd_estabelecimento_p,
	 clock_timestamp(), nm_usuario_p, clock_timestamp(),
	 nm_usuario_p, nr_seq_proc_p, nr_seq_mat_p,
	 3, ds_evento_w, vl_base_p,
	 vl_glosa_p, vl_liberado_p, ds_observacao_w);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_log_lib_item ( nr_seq_proc_p bigint, nr_seq_mat_p bigint, ie_tipo_valor_p text, nr_seq_regra_lib_p bigint, vl_base_p bigint, vl_glosa_p bigint, vl_liberado_p bigint, nr_seq_analise_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text ) FROM PUBLIC;

