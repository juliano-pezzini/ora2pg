-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gerar_proc_partic_aut_web ( nr_seq_conta_proc_p bigint, cd_medico_p text, nr_seq_grau_partic_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
finalidade: 
iserir automaticamente o participante no procedimento, na digitação de conbtas médicas 
------------------------------------------------------------------------------------------------------------------- 
locais de chamada direta: 
[ ] objetos do dicionário [ ] tasy (delphi/java) [ x ] portal [ ] relatórios [ ] outros: 
 ------------------------------------------------------------------------------------------------------------------ 
pontos de atenção: 
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
 
 
uf_conselho_w		medico.uf_crm%type;
nr_seq_conselho_w	pessoa_fisica.nr_seq_conselho%type;
nr_seq_cbo_saude_w	bigint;


BEGIN 
if (cd_medico_p IS NOT NULL AND cd_medico_p::text <> '') and (nr_seq_grau_partic_p IS NOT NULL AND nr_seq_grau_partic_p::text <> '') then 
	begin 
		select	a.uf_crm, 
			(select	b.nr_seq_conselho 
			from	pessoa_fisica b 
			where	b.cd_pessoa_fisica = cd_medico_p) nr_seq_conselho, 
			pls_obter_cbo_medico(cd_medico_p) cbo_medico 
		into STRICT 	uf_conselho_w, 
			nr_seq_conselho_w,	 
			nr_seq_cbo_saude_w		 
		from	medico a 
		where	a.cd_pessoa_fisica = cd_medico_p;
	exception 
	when others then 
		uf_conselho_w 		:= null;
		nr_seq_conselho_w	:= null;	
		nr_seq_cbo_saude_w	:= null;	
	end;
		 
	CALL pls_gerar_proc_partic_web(	nr_seq_conta_proc_p, 'I', cd_medico_p, 
					nr_seq_grau_partic_p, nr_seq_cbo_saude_w, 0, 
					null, nr_seq_conselho_w, nm_usuario_p, 
					uf_conselho_w);	
 
end if;	
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_proc_partic_aut_web ( nr_seq_conta_proc_p bigint, cd_medico_p text, nr_seq_grau_partic_p bigint, nm_usuario_p text) FROM PUBLIC;

