-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inativa_item_adep ( nr_sequencia_p bigint, ds_justificativa_p text, nm_tabela_p text, nm_usuario_p text) AS $body$
DECLARE


ds_comando_w	varchar(4000);
ds_sep_bv_w		varchar(50);
ie_situacao_w	varchar(1);


BEGIN

ds_sep_bv_w 	:= 	obter_separador_bv;
ie_situacao_w	:= 'I';

if (nm_tabela_p = 'EVOLUCAO_PACIENTE') then

	ds_comando_w := 'update evolucao_paciente ' ||
			' set 	ie_situacao = :ie_situacao, ' ||
			' 	dt_inativacao = sysdate, ' ||
                        ' 	nm_usuario_inativacao = :nm_usuario, ' ||
                        ' 	ds_justificativa = :ds_justificativa ' ||
			' where cd_evolucao = :cd_evolucao ';

	CALL exec_sql_dinamico_bv('ADEP X PEP', ds_comando_w, 	'ie_situacao=' || ie_situacao_w || ds_sep_bv_w ||
								'nm_usuario=' || nm_usuario_p || ds_sep_bv_w ||
								'ds_justificativa='|| ds_justificativa_p || ds_sep_bv_w ||
								'cd_evolucao=' || to_char(nr_sequencia_p) || ds_sep_bv_w);


elsif (nm_tabela_p = 'PACIENTE_ALERGIA') or --Alergia / Reações adversas
	(nm_tabela_p = 'PACIENTE_MEDIC_USO') then --Medicamentos em uso
	begin

	ds_comando_w :=	'update ' || nm_tabela_p ||
			' set 	dt_inativacao = sysdate, ' ||
 			' 	nm_usuario_inativacao = :nm_usuario, ' ||
			' 	ds_justificativa = :ds_justificativa ' ||
			' where nr_sequencia = :nr_sequencia ';

		CALL exec_sql_dinamico_bv('ADEP X PEP', ds_comando_w, 	'nm_usuario=' || nm_usuario_p || ds_sep_bv_w ||
								'ds_justificativa='|| ds_justificativa_p || ds_sep_bv_w ||
								'nr_sequencia=' || to_char(nr_sequencia_p) || ds_sep_bv_w);

	end;
else

	ds_comando_w := 'update ' || nm_tabela_p ||
			' set 	ie_situacao = :ie_situacao, ' ||
			' 	dt_inativacao = sysdate, ' ||
                        ' 	nm_usuario_inativacao = :nm_usuario, ' ||
                        ' 	ds_justificativa = :ds_justificativa ' ||
			' where nr_sequencia = :nr_sequencia ';

	CALL exec_sql_dinamico_bv('ADEP X PEP', ds_comando_w, 	'ie_situacao=I' || ds_sep_bv_w ||
								'nm_usuario=' || nm_usuario_p || ds_sep_bv_w ||
								'ds_justificativa='|| ds_justificativa_p || ds_sep_bv_w ||
								'nr_sequencia=' || to_char(nr_sequencia_p) || ds_sep_bv_w);


end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inativa_item_adep ( nr_sequencia_p bigint, ds_justificativa_p text, nm_tabela_p text, nm_usuario_p text) FROM PUBLIC;

