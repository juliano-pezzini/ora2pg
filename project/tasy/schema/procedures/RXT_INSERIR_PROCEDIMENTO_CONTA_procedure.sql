-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE rxt_inserir_procedimento_conta (nr_seq_proc_interno_p bigint, cd_estabelecimento_p bigint, cd_convenio_p bigint, cd_categoria_p bigint, cd_pessoa_fisica_p bigint, nr_seq_atepacu_p bigint, dt_ent_unidade_p timestamp, nr_atendimento_p bigint, nm_usuario_p text, nr_seq_agenda_rxt_p bigint, cd_local_estoque_p bigint, cd_setor_atendimento_p bigint) AS $body$
DECLARE


cd_procedimento_w   	bigint  	:= 0;
ie_origem_proced_w   	smallint  	:= null;
nr_seq_proc_pac_w  	bigint  	:= 0;					
ds_erro_w		varchar(255);
qt_agenda_rxt_w		bigint;
					

BEGIN

		SELECT * FROM obter_proc_tab_interno_conv(
					nr_seq_proc_interno_p, cd_estabelecimento_p, cd_convenio_p, cd_categoria_p, null, null, cd_procedimento_w, ie_origem_proced_w, null, clock_timestamp(), null, null, null, null, null, null, null, null) INTO STRICT cd_procedimento_w, ie_origem_proced_w;

		select 	nextval('procedimento_paciente_seq')
		into STRICT  	nr_seq_proc_pac_w
		;

		insert into procedimento_paciente( 	nr_sequencia,
				nr_atendimento,
				dt_entrada_unidade,
				cd_procedimento,
				dt_procedimento,
				qt_procedimento,
				dt_atualizacao,
				nm_usuario,
				cd_setor_atendimento,
				ie_origem_proced,
				nr_seq_atepacu,
				nr_seq_proc_interno,
				cd_convenio,
				cd_categoria,
				cd_pessoa_fisica,
                nr_seq_agenda_rxt,
				cd_medico_executor)
		values (	nr_seq_proc_pac_w,
				nr_atendimento_p,
				dt_ent_unidade_p,
				cd_procedimento_w,
				clock_timestamp(),
				1,
				clock_timestamp(),
				nm_usuario_p,
				cd_setor_atendimento_p,
				ie_origem_proced_w,
				nr_seq_atepacu_p,
				nr_seq_proc_interno_p,
				cd_convenio_p,
				cd_categoria_p,
				cd_pessoa_fisica_p,
				nr_seq_agenda_rxt_p,
				cd_pessoa_fisica_p);				
		ds_erro_w := consiste_exec_procedimento(nr_seq_proc_pac_w, ds_erro_w);
		CALL atualiza_preco_procedimento(nr_seq_proc_pac_w, cd_convenio_p, nm_usuario_p);
		CALL gerar_lancamento_automatico(nr_atendimento_p,cd_local_estoque_p,34,nm_usuario_p,nr_seq_proc_pac_w,null,null,null,null,null);
		
		
	COMMIT;

		
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE rxt_inserir_procedimento_conta (nr_seq_proc_interno_p bigint, cd_estabelecimento_p bigint, cd_convenio_p bigint, cd_categoria_p bigint, cd_pessoa_fisica_p bigint, nr_seq_atepacu_p bigint, dt_ent_unidade_p timestamp, nr_atendimento_p bigint, nm_usuario_p text, nr_seq_agenda_rxt_p bigint, cd_local_estoque_p bigint, cd_setor_atendimento_p bigint) FROM PUBLIC;

