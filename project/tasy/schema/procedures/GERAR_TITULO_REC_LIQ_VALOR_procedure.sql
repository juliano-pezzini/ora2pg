-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_titulo_rec_liq_valor (nr_titulo_p bigint, nr_seq_liq_p bigint, nm_usuario_p text) AS $body$
DECLARE

/*
Edgar criada esta procedure na OS 125432
N√ÉO DAR COMMIT NESTA PROCEDURE
*/
nr_seq_ret_item_w		bigint;
nr_seq_trans_financ_w		bigint;
vl_adicional_w			double precision;

c01 CURSOR FOR
SELECT	nr_seq_trans_financ,
	vl_adicional
from	convenio_ret_item_valor
where	nr_seq_ret_item		= nr_seq_ret_item_w;


BEGIN

select	max(nr_seq_ret_item)
into STRICT	nr_seq_ret_item_w
from	titulo_receber_liq
where	nr_titulo	= nr_titulo_p
and	nr_sequencia	= nr_seq_liq_p;

open c01;
loop
fetch c01 into
	nr_seq_trans_financ_w,
	vl_adicional_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	insert into titulo_rec_liq_valor(nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_titulo,
		nr_seq_liq,
		nr_seq_trans_financ,
		vl_adicional)
	SELECT	nextval('titulo_rec_liq_valor_seq'),
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		nr_titulo_p,
		nr_seq_liq_p,
		nr_seq_trans_financ_w,
		vl_adicional_w
	;
end loop;
close c01;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_titulo_rec_liq_valor (nr_titulo_p bigint, nr_seq_liq_p bigint, nm_usuario_p text) FROM PUBLIC;

