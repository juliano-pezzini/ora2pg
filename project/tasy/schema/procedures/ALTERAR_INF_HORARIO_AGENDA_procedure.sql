-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE alterar_inf_horario_agenda (cd_tipo_agenda_p bigint, cd_agenda_p bigint, nr_seq_agenda_p bigint, ie_informacao_p text, ie_valor_p text, nm_usuario_p text) AS $body$
DECLARE


ie_tipo_atributo_w	varchar(10);
ds_comando_w		varchar(2000) := null;
ds_where_w		varchar(2000) := null;


BEGIN
if (cd_tipo_agenda_p IS NOT NULL AND cd_tipo_agenda_p::text <> '') and (cd_agenda_p IS NOT NULL AND cd_agenda_p::text <> '') and (nr_seq_agenda_p IS NOT NULL AND nr_seq_agenda_p::text <> '') and (ie_informacao_p IS NOT NULL AND ie_informacao_p::text <> '') and (ie_valor_p IS NOT NULL AND ie_valor_p::text <> '') and (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') then
	/* agenda exame */

	if (cd_tipo_agenda_p = 2) then
		/* montar restricao */

		ds_where_w := ' and ie_status_agenda not in ('|| chr(39) || 'F' || chr(39) || ',' ||
								 	 chr(39) || 'I' || chr(39) || ',' ||
								 	 chr(39) || 'II'|| chr(39) || ',' ||
								 	 chr(39) || 'O' || chr(39) || ',' ||
									 chr(39) || 'B' || chr(39) || ',' ||
									 chr(39) || 'AN'|| chr(39) || ',' ||
									 chr(39) || 'A' || chr(39) || ',' ||
									 chr(39) || 'C' || chr(39) || ')';

		/* obter tipo atributo */

		select	coalesce(max(ie_tipo_atributo),'#')
		into STRICT	ie_tipo_atributo_w
		from	tabela_atributo
		where	upper(nm_atributo) = upper(ie_informacao_p);

		/* gerar comando atualizacao conforme tipo atributo */

		if (ie_tipo_atributo_w = 'VARCHAR2') then
			ds_comando_w :=	' update agenda_paciente ' ||
						' set ' || ie_informacao_p || ' = ' || chr(39) || ie_valor_p || chr(39) ||
						' where nr_sequencia = ' || nr_seq_agenda_p || ds_where_w;

		elsif (ie_tipo_atributo_w = 'NUMBER') then
			ds_comando_w :=	' update agenda_paciente ' ||
						' set ' || ie_informacao_p || ' = ' || ie_valor_p ||
						' where nr_sequencia = ' || nr_seq_agenda_p || ds_where_w;
		end if;

		/* executar comando atualizacao */

		if (ds_comando_w IS NOT NULL AND ds_comando_w::text <> '') then
			CALL exec_sql_dinamico(nm_usuario_p,ds_comando_w);
		end if;
	end if;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE alterar_inf_horario_agenda (cd_tipo_agenda_p bigint, cd_agenda_p bigint, nr_seq_agenda_p bigint, ie_informacao_p text, ie_valor_p text, nm_usuario_p text) FROM PUBLIC;

