-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE vipe_gerar_prescr_item ( cd_estabelecimento_p bigint, nr_prescricao_p bigint, nr_atendimento_p bigint, cd_material_novo_p bigint, cd_material_p bigint, nr_seq_item_p bigint, cd_intervalo_p text, cd_intervalo_novo_p text, ie_acm_sn_p text, qt_dose_p bigint, ie_via_aplicacao_p text, nr_prescricoes_p text, dt_primeiro_horario_p timestamp, cd_unidade_med_p text, ds_horarios_p text, ie_susp_anterior_p text, ie_tipo_pessoa_p text, cd_perfil_p bigint, nm_usuario_p text, ds_dose_dif_p text, qt_dose_esp_p bigint, ds_justificativa_p text, ds_observacao_subs_p text, hr_dose_especial_p text, ie_dose_especial_p text, ie_se_necessario_p text, ie_acm_p text, ie_urgencia_p text, nr_nova_prescricao_p INOUT bigint, nr_seq_novo_item_p INOUT bigint, ds_reconst_diluicao_p INOUT text) AS $body$
DECLARE

 
ds_reconst_diluicao_w	varchar(255)	:= '';	
nr_seq_novo_item_w	integer;
nr_nova_prescricao_w	bigint;			
 

BEGIN 
 
SELECT * FROM vipe_gerar_prescricao_item(cd_estabelecimento_p, nr_prescricao_p, nr_atendimento_p, cd_material_novo_p, cd_material_p, nr_seq_item_p, cd_intervalo_p, cd_intervalo_novo_p, ie_acm_sn_p, qt_dose_p, ie_via_aplicacao_p, nr_prescricoes_p, dt_primeiro_horario_p, cd_unidade_med_p, ds_horarios_p, ie_susp_anterior_p, ie_tipo_pessoa_p, cd_perfil_p, nm_usuario_p, ds_dose_dif_p, qt_dose_esp_p, ds_justificativa_p, ds_observacao_subs_p, hr_dose_especial_p, ie_dose_especial_p, ie_se_necessario_p, ie_acm_p, ie_urgencia_p, 'N', nr_nova_prescricao_w, nr_seq_novo_item_w, null) INTO STRICT nr_nova_prescricao_w, nr_seq_novo_item_w;
 
if (nr_seq_novo_item_w IS NOT NULL AND nr_seq_novo_item_w::text <> '') and (nr_nova_prescricao_w IS NOT NULL AND nr_nova_prescricao_w::text <> '') then 
	ds_reconst_diluicao_w	:= substr(obter_diluicao_medic(nr_seq_novo_item_w, nr_nova_prescricao_w),1,255);
end if;
 
ds_reconst_diluicao_p	:= ds_reconst_diluicao_w;
nr_seq_novo_item_p	:= nr_seq_novo_item_w;
nr_nova_prescricao_p	:= nr_nova_prescricao_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE vipe_gerar_prescr_item ( cd_estabelecimento_p bigint, nr_prescricao_p bigint, nr_atendimento_p bigint, cd_material_novo_p bigint, cd_material_p bigint, nr_seq_item_p bigint, cd_intervalo_p text, cd_intervalo_novo_p text, ie_acm_sn_p text, qt_dose_p bigint, ie_via_aplicacao_p text, nr_prescricoes_p text, dt_primeiro_horario_p timestamp, cd_unidade_med_p text, ds_horarios_p text, ie_susp_anterior_p text, ie_tipo_pessoa_p text, cd_perfil_p bigint, nm_usuario_p text, ds_dose_dif_p text, qt_dose_esp_p bigint, ds_justificativa_p text, ds_observacao_subs_p text, hr_dose_especial_p text, ie_dose_especial_p text, ie_se_necessario_p text, ie_acm_p text, ie_urgencia_p text, nr_nova_prescricao_p INOUT bigint, nr_seq_novo_item_p INOUT bigint, ds_reconst_diluicao_p INOUT text) FROM PUBLIC;

