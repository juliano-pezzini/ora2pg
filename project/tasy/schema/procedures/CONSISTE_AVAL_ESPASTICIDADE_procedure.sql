-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consiste_aval_espasticidade ( cd_pessoa_fisica_p text, ie_retorno_p INOUT text) AS $body$
DECLARE

 
ie_tipo_avaliacao_w	varchar(10);
nr_aplicao_result_w	double precision:= 1;
nr_seq_tipo_avaliacao_w	bigint;


BEGIN 
 
select	max(nr_seq_tipo_avaliacao) 
into STRICT	nr_seq_tipo_avaliacao_w 
from	med_avaliacao_paciente a 
where	a.nr_sequencia	= (	SELECT	max(x.nr_sequencia) 
				from	med_avaliacao_paciente x 
				where	x.cd_pessoa_fisica = cd_pessoa_fisica_p 
				and	x.ie_situacao = 'A' 
				and	(x.dt_liberacao IS NOT NULL AND x.dt_liberacao::text <> ''));
	 
 
 select coalesce(max(ie_tipo_avaliacao),'R') 
 into STRICT	ie_tipo_avaliacao_w	 
 from	espasticidade_avaliacao 
 where	nr_seq_tipo_avaliacao = nr_seq_tipo_avaliacao_w;
 
 
if (ie_tipo_avaliacao_w = 'P')then 
	begin 
 
	ie_retorno_p:= 'PR';
	 
	end;
elsif (ie_tipo_avaliacao_w IS NOT NULL AND ie_tipo_avaliacao_w::text <> '') and (ie_tipo_avaliacao_w = 'R') then 
	begin 
	 
	ie_retorno_p	:= 'PO';
 
	end;
end if;	
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consiste_aval_espasticidade ( cd_pessoa_fisica_p text, ie_retorno_p INOUT text) FROM PUBLIC;

