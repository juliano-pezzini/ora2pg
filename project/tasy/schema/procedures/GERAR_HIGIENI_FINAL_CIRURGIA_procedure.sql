-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_higieni_final_cirurgia ( nr_atendimento_p bigint, dt_entrada_unidade_p timestamp, nm_usuario_p text, cd_estabelecimento_p bigint) AS $body$
DECLARE

 
nr_seq_interno_w	bigint;


BEGIN 
 begin 
 	select	u.nr_seq_interno 
 	into STRICT	nr_seq_interno_w 
 	from	unidade_atendimento u, 
 		atend_paciente_unidade a 
 	where	a.nr_atendimento = nr_atendimento_p 
 	and  	a.dt_entrada_unidade = dt_entrada_unidade_p 
 	and 	u.cd_setor_atendimento = a.cd_setor_atendimento 
 	and 	u.cd_unidade_basica = a.cd_unidade_basica 
 	and 	u.cd_unidade_compl = a.cd_unidade_compl;
  exception 
		when	no_data_found then 
			nr_seq_interno_w:= null;
 end;
 
if (nr_seq_interno_w IS NOT NULL AND nr_seq_interno_w::text <> '') then 
	CALL gerar_higienizacao_leito_unid(clock_timestamp(), nm_usuario_p, cd_estabelecimento_p, 'FC', nr_seq_interno_w, null);
end if;	
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_higieni_final_cirurgia ( nr_atendimento_p bigint, dt_entrada_unidade_p timestamp, nm_usuario_p text, cd_estabelecimento_p bigint) FROM PUBLIC;

