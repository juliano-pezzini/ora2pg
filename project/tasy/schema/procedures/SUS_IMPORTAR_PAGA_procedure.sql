-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE sus_importar_paga ( nr_aih_p bigint, nr_ident_p bigint, cd_processo_p bigint, cd_proc_realizado_p bigint, nr_seq_protocolo_p bigint, dt_alta_p timestamp, qt_dias_uti_p bigint, vl_sh_p bigint, vl_sp_p bigint, qt_pontos_sp_p bigint, qt_dias_acompanhante_p bigint, vl_sadt_p bigint, qt_pontos_sadt_p bigint, vl_sangue_p bigint, vl_opm_p bigint, vl_rnato_p bigint, vl_s_rateio_p bigint, vl_analg_p bigint, vl_pedcon_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
dt_apres_w		timestamp;
nr_seq_aih_w		bigint;
cd_proc_realizado_w	bigint;


BEGIN 
 
select	dt_mesano_referencia 
into STRICT	dt_apres_w 
from	protocolo_convenio 
where	nr_seq_protocolo	= nr_seq_protocolo_p;
 
select	max(coalesce(nr_sequencia,0)) 
into STRICT	nr_seq_aih_w 
from	sus_aih 
where	nr_aih	= nr_aih_p;
 
select cd_proc_realizado_p || calcula_digito('MODULO11', cd_proc_realizado_p) 
into STRICT	cd_proc_realizado_w
;
 
insert into sus_aih_paga( 
		nr_sequencia, 
		nr_aih, 
		nr_processo, 
		dt_apresentacao, 
		dt_atualizacao, 
		nm_usuario, 
		cd_proc_realizado, 
		ie_origem_proced, 
		dt_alta, 
		qt_dias_uti, 
		qt_dias_acompanhante, 
		vl_sh, 
		vl_sp, 
		qt_pontos_sp, 
		vl_sadt, 
		qt_pontos_sadt, 
		vl_sangue, 
		vl_opm, 
		vl_rnato, 
		vl_s_rateio, 
		vl_analg, 
		vl_pedcon, 
		nr_ident, 
		nr_seq_aih, 
		nr_seq_protocolo, 
		dt_atualizacao_nrec, 
		nm_usuario_nrec) 
	values ( 
		nextval('sus_aih_paga_seq'), 
		nr_aih_p, 
		cd_processo_p, 
		dt_apres_w, 
		clock_timestamp(), 
		nm_usuario_p, 
		cd_proc_realizado_w, 
		2, 
		dt_alta_p, 
		qt_dias_uti_p, 
		qt_dias_acompanhante_p, 
		vl_sh_p, 
		vl_sp_p, 
		qt_pontos_sp_p, 
		vl_sadt_p, 
		qt_pontos_sadt_p, 
		vl_sangue_p, 
		vl_opm_p, 
		vl_rnato_p, 
		vl_s_rateio_p, 
		vl_analg_p, 
		vl_pedcon_p, 
		nr_ident_p, 
		nr_seq_aih_w, 
		nr_seq_protocolo_p, 
		clock_timestamp(), 
		nm_usuario_p);
 
commit;	
 
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE sus_importar_paga ( nr_aih_p bigint, nr_ident_p bigint, cd_processo_p bigint, cd_proc_realizado_p bigint, nr_seq_protocolo_p bigint, dt_alta_p timestamp, qt_dias_uti_p bigint, vl_sh_p bigint, vl_sp_p bigint, qt_pontos_sp_p bigint, qt_dias_acompanhante_p bigint, vl_sadt_p bigint, qt_pontos_sadt_p bigint, vl_sangue_p bigint, vl_opm_p bigint, vl_rnato_p bigint, vl_s_rateio_p bigint, vl_analg_p bigint, vl_pedcon_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

