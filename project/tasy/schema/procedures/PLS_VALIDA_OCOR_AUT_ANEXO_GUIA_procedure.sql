-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_valida_ocor_aut_anexo_guia ( nr_seq_ocor_combinada_p pls_ocor_aut_combinada.nr_sequencia%type, nr_seq_ocorrencia_p pls_ocorrencia.nr_sequencia%type, nr_seq_segurado_p pls_segurado.nr_sequencia%type, nr_seq_motivo_glosa_p tiss_motivo_glosa.nr_sequencia%type, nr_seq_guia_p pls_guia_plano.nr_sequencia%type, nr_seq_requisicao_p pls_requisicao.nr_sequencia%type, nr_seq_execucao_p pls_execucao_requisicao.nr_sequencia%type, ie_utiliza_filtro_p text, nr_seq_param1_p bigint, nr_seq_param2_p bigint, nr_seq_param3_p bigint, nr_seq_param4_p bigint, nr_seq_param5_p bigint, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type ) AS $body$
DECLARE

 
 
/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
Finalidade: Validar o anexo de guia, gerado para os procedimentos e materiais, nas funções 
da requisição e da autorização 
------------------------------------------------------------------------------------------------------------------- 
Locais de chamada direta: 
[ ] Objetos do dicionário [ x] Tasy (Delphi/Java) [ x ] Portal [ ] Relatórios [ ] Outros: 
 ------------------------------------------------------------------------------------------------------------------ 
Pontos de atenção: Ocorrência aplicada na requisição e na autorização do portal e do Tasy 
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
 
 
 
ie_campo_obrigatorio_w		pls_validacao_aut_anexo_gt.ie_campo_obrigatorio%type;
ie_possui_anexo_w		pls_validacao_aut_anexo_gt.ie_possui_anexo%type;
ie_gerar_ocorrencia_w		varchar(1);
ie_regra_w			varchar(2);
ie_gerou_ocor_cabecalho_w	varchar(2);
nr_seq_oc_benef_w		bigint;
ie_tipo_ocorrencia_w		varchar(2);
ds_observacao_w			varchar(500);
cd_versao_tiss_w		pls_versao_tiss.cd_versao_tiss%type;

 
C01 CURSOR( nr_seq_ocor_combinada_pc	pls_ocor_aut_combinada.nr_sequencia%type ) FOR 
	SELECT	ie_campo_obrigatorio, 
		ie_possui_anexo 
	from	pls_validacao_aut_anexo_gt 
	where	nr_seq_ocor_aut_combinada	= nr_seq_ocor_combinada_pc 
	and	ie_situacao			= 'A';

/*Validação dos itens da requisição, neste cursor é verificar se os procedimentos e materiais que possuem o campo IE_TIPO_ANEXO 
informado, geraram registro nas tabelas do anexo */
 
C02 CURSOR( nr_seq_requisicao_pc	pls_requisicao.nr_sequencia%type ) FOR 
	SELECT 	a.nr_sequencia nr_seq_req_proc, 
		null nr_seq_req_mat, 
		a.ie_tipo_anexo 
	from	pls_requisicao_proc a 
	where	a.nr_seq_requisicao = nr_seq_requisicao_pc 
	and	(a.ie_tipo_anexo IS NOT NULL AND a.ie_tipo_anexo::text <> '')	 
	and	not exists ( 	SELECT 1 
				from	pls_lote_anexo_proc_aut b 
				where	b.nr_seq_req_proc = a.nr_sequencia) 
	
union
 
	select	null nr_seq_req_proc, 
		a.nr_sequencia nr_seq_req_mat, 
		a.ie_tipo_anexo 
	from	pls_requisicao_mat a 
	where	a.nr_seq_requisicao = nr_seq_requisicao_pc 
	and	(a.ie_tipo_anexo IS NOT NULL AND a.ie_tipo_anexo::text <> '') 
	and	not exists ( 	select 1 
			from	pls_lote_anexo_mat_aut b 
			where	b.nr_seq_req_mat = a.nr_sequencia);

/*Validação dos itens da autorização, neste cursor é verificar se os procedimentos e materiais que possuem o campo IE_TIPO_ANEXO 
informado, geraram registro nas tabelas do anexo */
 
C03 CURSOR( nr_seq_guia_pc		pls_guia_plano.nr_sequencia%type ) FOR 
	SELECT 	a.nr_sequencia nr_seq_guia_proc, 
		null nr_seq_guia_mat, 
		a.ie_tipo_anexo 
	from	pls_guia_plano_proc a 
	where	a.nr_seq_guia = nr_seq_guia_pc 
	and	(a.ie_tipo_anexo IS NOT NULL AND a.ie_tipo_anexo::text <> '') 
	and	coalesce(a.nr_seq_motivo_exc::text, '') = '' 
	and	not exists ( 	SELECT 1 
				from	pls_lote_anexo_proc_aut b 
				where	b.nr_seq_plano_proc = a.nr_sequencia 
				and	coalesce(b.nr_seq_motivo_exc::text, '') = '') 
	
union
 
	select	null nr_seq_guia_proc, 
		a.nr_sequencia nr_seq_guia_mat, 
		a.ie_tipo_anexo 
	from	pls_guia_plano_mat a 
	where	a.nr_seq_guia = nr_seq_guia_pc 
	and	(a.ie_tipo_anexo IS NOT NULL AND a.ie_tipo_anexo::text <> '') 
	and	coalesce(a.nr_seq_motivo_exc::text, '') = '' 
	and	not exists ( 	select 1 
				from	pls_lote_anexo_mat_aut b 
				where	b.nr_seq_plano_mat = a.nr_sequencia 
				and	coalesce(b.nr_seq_motivo_exc::text, '') = '');

/*Validação dos campos obrigatórios conforme tipo de anexo informado nos procedimentos e materiais. Cursor dos itens da requisição */
 
C04 CURSOR( nr_seq_requisicao_pc	pls_requisicao.nr_sequencia%type ) FOR 
	SELECT 	a.nr_sequencia nr_seq_req_proc, 
		null nr_seq_req_mat, 
		a.ie_tipo_anexo 
	from	pls_requisicao_proc a 
	where	a.nr_seq_requisicao = nr_seq_requisicao_pc 
	and	(a.ie_tipo_anexo IS NOT NULL AND a.ie_tipo_anexo::text <> '') 
	
union
 
	SELECT	null nr_seq_req_proc, 
		a.nr_sequencia nr_seq_req_mat, 
		a.ie_tipo_anexo 
	from	pls_requisicao_mat a 
	where	a.nr_seq_requisicao = nr_seq_requisicao_pc 
	and	(a.ie_tipo_anexo IS NOT NULL AND a.ie_tipo_anexo::text <> '');
	
/*Validação dos itens da requisição, neste cursor é verificar se os procedimentos e materiais que possuem o campo IE_TIPO_ANEXO 
informado, geraram registro nas tabelas do anexo. Utilizado a partir da versão 3.03.01 do TISS */
 
C05 CURSOR( nr_seq_requisicao_pc	pls_requisicao.nr_sequencia%type ) FOR 
	SELECT 	a.nr_sequencia nr_seq_req_proc, 
		null nr_seq_req_mat, 
		a.ie_tipo_anexo 
	from	pls_requisicao_proc a 
	where	a.nr_seq_requisicao = nr_seq_requisicao_pc 
	and	(a.ie_tipo_anexo IS NOT NULL AND a.ie_tipo_anexo::text <> '') 
	and	not exists ( 	SELECT 1 
				from	pls_lote_anexo_guias_aut b 
				where	b.nr_seq_requisicao = a.nr_seq_requisicao)	 
	
union
 
	select	null nr_seq_req_proc, 
		a.nr_sequencia nr_seq_req_mat, 
		a.ie_tipo_anexo 
	from	pls_requisicao_mat a 
	where	a.nr_seq_requisicao = nr_seq_requisicao_pc 
	and	(a.ie_tipo_anexo IS NOT NULL AND a.ie_tipo_anexo::text <> '') 
	and	not exists ( 	select 1 
				from	pls_lote_anexo_mat_aut b 
				where	b.nr_seq_req_mat = a.nr_sequencia);

/*Validação dos itens da autorização, neste cursor é verificar se os procedimentos e materiais que possuem o campo IE_TIPO_ANEXO 
informado, geraram registro nas tabelas do anexo. Utilizado a partir da versão 3.03.01 do TISS */
 
C06 CURSOR( nr_seq_guia_pc		pls_guia_plano.nr_sequencia%type ) FOR 
	SELECT 	a.nr_sequencia nr_seq_guia_proc, 
		null nr_seq_guia_mat, 
		a.ie_tipo_anexo 
	from	pls_guia_plano_proc a 
	where	a.nr_seq_guia = nr_seq_guia_pc 
	and	(a.ie_tipo_anexo IS NOT NULL AND a.ie_tipo_anexo::text <> '') 
	and	coalesce(a.nr_seq_motivo_exc::text, '') = '' 
	and	not exists ( 	SELECT 1 
				from	pls_lote_anexo_guias_aut b 
				where	b.nr_seq_guia = a.nr_seq_guia) 
	
union
 
	select	null nr_seq_guia_proc, 
		a.nr_sequencia nr_seq_guia_mat, 
		a.ie_tipo_anexo 
	from	pls_guia_plano_mat a 
	where	a.nr_seq_guia = nr_seq_guia_pc 
	and	(a.ie_tipo_anexo IS NOT NULL AND a.ie_tipo_anexo::text <> '') 
	and	coalesce(a.nr_seq_motivo_exc::text, '') = '' 
	and	not exists ( 	select 1 
				from	pls_lote_anexo_mat_aut b 
				where	b.nr_seq_plano_mat = a.nr_sequencia 
				and	coalesce(b.nr_seq_motivo_exc::text, '') = '');
	
BEGIN 
cd_versao_tiss_w	:= pls_obter_versao_tiss;
 
for	r_C01_w in C01( nr_seq_ocor_combinada_p ) loop 
 
 
	--Tratamento utilizado para requisição 
	if (nr_seq_requisicao_p IS NOT NULL AND nr_seq_requisicao_p::text <> '') then 
 
		--Validar se estiver informado o tipo de anexo nos itens se gerou registro nas tabelas de anexo 
		if ( r_C01_w.ie_possui_anexo = 'S' ) then	 
			----- Final -- 
			ie_gerar_ocorrencia_w	:= 'N';
			 
			if (cd_versao_tiss_w	= '2.01.03') or (cd_versao_tiss_w	= '2.02.01') or (cd_versao_tiss_w	= '2.02.02') or (cd_versao_tiss_w	= '2.02.03') or (cd_versao_tiss_w	= '3.00.00') or (cd_versao_tiss_w	= '3.00.01') or (cd_versao_tiss_w	= '3.01.00') or (cd_versao_tiss_w	= '3.02.00') or (cd_versao_tiss_w	= '3.02.01') or (cd_versao_tiss_w	= '3.02.02') or (cd_versao_tiss_w	= '3.03.00') then 
				 
				for	r_C02_w in C02( nr_seq_requisicao_p ) loop 
					ie_gerar_ocorrencia_w	:= 'S';
 
					if ( ie_utiliza_filtro_p	= 'S' ) then 
						/* Tratamento para filtros */
 
						SELECT * FROM pls_gerar_ocor_aut_filtro(	nr_seq_ocor_combinada_p, null, nr_seq_requisicao_p, nr_seq_execucao_p, null, null, r_C02_w.nr_seq_req_proc, r_C02_w.nr_seq_req_mat, null, null, null, null, ie_gerou_ocor_cabecalho_w, null, null, null, null, null, nm_usuario_p, ie_regra_w, ie_tipo_ocorrencia_w) INTO STRICT ie_regra_w, ie_tipo_ocorrencia_w;
											 
							if ( ie_regra_w	= 'S' ) then 
								ie_gerar_ocorrencia_w	:= 'S';
							elsif ( ie_regra_w	in ('E','N') ) then 
								ie_gerar_ocorrencia_w	:= 'N';
							end if;
					end if;
 
					if ( ie_gerar_ocorrencia_w	= 'S') then 
						nr_seq_oc_benef_w := pls_inserir_ocorrencia(	nr_seq_segurado_p, nr_seq_ocorrencia_p, nr_seq_requisicao_p, null, null, r_C02_w.nr_seq_req_proc, r_C02_w.nr_seq_req_mat, nr_seq_ocor_combinada_p, nm_usuario_p, null, nr_seq_motivo_glosa_p, 9, cd_estabelecimento_p, 'N', null, nr_seq_oc_benef_w, null, null, null, null);
 
						CALL pls_atualizar_status_ocor_comb(	nr_seq_ocorrencia_p, nr_seq_ocor_combinada_p, nr_seq_motivo_glosa_p, 
										nr_seq_guia_p, nr_seq_requisicao_p, nr_seq_execucao_p, 
										null, null, r_C02_w.nr_seq_req_proc, 
										r_C02_w.nr_seq_req_mat, null, null, 
										nm_usuario_p, cd_estabelecimento_p);
					end if;
				end loop;
			else 
				for	r_C05_w in C05( nr_seq_requisicao_p ) loop 
					ie_gerar_ocorrencia_w	:= 'S';
 
					if ( ie_utiliza_filtro_p	= 'S' ) then 
						/* Tratamento para filtros */
 
						SELECT * FROM pls_gerar_ocor_aut_filtro(	nr_seq_ocor_combinada_p, null, nr_seq_requisicao_p, nr_seq_execucao_p, null, null, r_C05_w.nr_seq_req_proc, r_C05_w.nr_seq_req_mat, null, null, null, null, ie_gerou_ocor_cabecalho_w, null, null, null, null, null, nm_usuario_p, ie_regra_w, ie_tipo_ocorrencia_w) INTO STRICT ie_regra_w, ie_tipo_ocorrencia_w;
											 
							if ( ie_regra_w	= 'S' ) then 
								ie_gerar_ocorrencia_w	:= 'S';
							elsif ( ie_regra_w	in ('E','N') ) then 
								ie_gerar_ocorrencia_w	:= 'N';
							end if;
					end if;
 
					if ( ie_gerar_ocorrencia_w	= 'S') then 
						nr_seq_oc_benef_w := pls_inserir_ocorrencia(	nr_seq_segurado_p, nr_seq_ocorrencia_p, nr_seq_requisicao_p, null, null, r_C05_w.nr_seq_req_proc, r_C05_w.nr_seq_req_mat, nr_seq_ocor_combinada_p, nm_usuario_p, null, nr_seq_motivo_glosa_p, 9, cd_estabelecimento_p, 'N', null, nr_seq_oc_benef_w, null, null, null, null);
 
						CALL pls_atualizar_status_ocor_comb(	nr_seq_ocorrencia_p, nr_seq_ocor_combinada_p, nr_seq_motivo_glosa_p, 
										nr_seq_guia_p, nr_seq_requisicao_p, nr_seq_execucao_p, 
										null, null, r_C05_w.nr_seq_req_proc, 
										r_C05_w.nr_seq_req_mat, null, null, 
										nm_usuario_p, cd_estabelecimento_p);
					end if;
				end loop;
			end if;			
		end if;
 
		-- Validar os campos obrigatórios no anexo de guia 
		if ( coalesce(ie_gerar_ocorrencia_w,'N') = 'N' and r_C01_w.ie_campo_obrigatorio = 'S' ) then 
 
			ie_gerar_ocorrencia_w	:= 'N';
 
			ds_observacao_w := pls_obter_obrig_anexo_guia(null, nr_seq_requisicao_p);
 
			if (ds_observacao_w IS NOT NULL AND ds_observacao_w::text <> '') then 
				ie_gerar_ocorrencia_w := 'S';
			end if;
 
 
			if ( ie_utiliza_filtro_p	= 'S' ) and (ie_gerar_ocorrencia_w = 'S') then 
				/* Tratamento para filtros */
 
				SELECT * FROM pls_gerar_ocor_aut_filtro(	nr_seq_ocor_combinada_p, null, nr_seq_requisicao_p, nr_seq_execucao_p, null, null, null, null, null, null, null, null, ie_gerou_ocor_cabecalho_w, null, null, null, null, null, nm_usuario_p, ie_regra_w, ie_tipo_ocorrencia_w) INTO STRICT ie_regra_w, ie_tipo_ocorrencia_w;
 
					if ( ie_regra_w	= 'S' ) then 
						ie_gerar_ocorrencia_w	:= 'S';
					elsif ( ie_regra_w	in ('E','N') ) then 
						ie_gerar_ocorrencia_w	:= 'N';
					end if;
			end if;	
 
 
			if ( ie_gerar_ocorrencia_w	= 'S') then 
				nr_seq_oc_benef_w := pls_inserir_ocorrencia(	nr_seq_segurado_p, nr_seq_ocorrencia_p, nr_seq_requisicao_p, null, null, null, null, nr_seq_ocor_combinada_p, nm_usuario_p, ds_observacao_w, nr_seq_motivo_glosa_p, 9, cd_estabelecimento_p, 'N', null, nr_seq_oc_benef_w, null, null, null, null);
 
				CALL pls_atualizar_status_ocor_comb(	nr_seq_ocorrencia_p, nr_seq_ocor_combinada_p, nr_seq_motivo_glosa_p, 
								nr_seq_guia_p, nr_seq_requisicao_p, nr_seq_execucao_p, 
								null, null, null, 
								null, null, null, 
								nm_usuario_p, cd_estabelecimento_p);
			end if;	
			 
		end if;
 
	elsif (nr_seq_guia_p IS NOT NULL AND nr_seq_guia_p::text <> '') then 
 
		--Validar se estiver informado o tipo de anexo nos itens se gerou registro nas tabelas de anexo 
		if ( r_C01_w.ie_possui_anexo = 'S' ) then 
			ie_gerar_ocorrencia_w	:= 'N';
 
			if (cd_versao_tiss_w	= '2.01.03') or (cd_versao_tiss_w	= '2.02.01') or (cd_versao_tiss_w	= '2.02.02') or (cd_versao_tiss_w	= '2.02.03') or (cd_versao_tiss_w	= '3.00.00') or (cd_versao_tiss_w	= '3.00.01') or (cd_versao_tiss_w	= '3.01.00') or (cd_versao_tiss_w	= '3.02.00') or (cd_versao_tiss_w	= '3.02.01') or (cd_versao_tiss_w	= '3.02.02') or (cd_versao_tiss_w	= '3.03.00') then 
				 
				for	r_C03_w in C03( nr_seq_guia_p ) loop 
					ie_gerar_ocorrencia_w	:= 'S';
 
					if ( ie_utiliza_filtro_p	= 'S' ) then 
 
						/* Tratamento para filtros */
 
						SELECT * FROM pls_gerar_ocor_aut_filtro(	nr_seq_ocor_combinada_p, nr_seq_guia_p, nr_seq_requisicao_p, nr_seq_execucao_p, r_C03_w.nr_seq_guia_proc, r_C03_w.nr_seq_guia_mat, null, null, null, null, null, null, ie_gerou_ocor_cabecalho_w, null, null, null, null, null, nm_usuario_p, ie_regra_w, ie_tipo_ocorrencia_w) INTO STRICT ie_regra_w, ie_tipo_ocorrencia_w;
 
							if ( ie_regra_w	= 'S' ) then 
								ie_gerar_ocorrencia_w	:= 'S';
							elsif ( ie_regra_w	in ('E','N') ) then 
								ie_gerar_ocorrencia_w	:= 'N';
							end if;
					end if;	
 
 
					if ( ie_gerar_ocorrencia_w	= 'S') then 
						nr_seq_oc_benef_w := pls_inserir_ocorrencia(	nr_seq_segurado_p, nr_seq_ocorrencia_p, nr_seq_requisicao_p, nr_seq_guia_p, null, r_C03_w.nr_seq_guia_proc, r_C03_w.nr_seq_guia_mat, nr_seq_ocor_combinada_p, nm_usuario_p, null, nr_seq_motivo_glosa_p, 7, cd_estabelecimento_p, 'N', null, nr_seq_oc_benef_w, null, null, null, null);
 
						CALL pls_atualizar_status_ocor_comb(	nr_seq_ocorrencia_p, nr_seq_ocor_combinada_p, nr_seq_motivo_glosa_p, 
										nr_seq_guia_p, nr_seq_requisicao_p, nr_seq_execucao_p, 
										r_C03_w.nr_seq_guia_proc,r_C03_w.nr_seq_guia_mat, null, 
										null, null, null, 
										nm_usuario_p, cd_estabelecimento_p);
					end if;
 
				end loop;
			else 
				for	r_C06_w in C06( nr_seq_guia_p ) loop 
					ie_gerar_ocorrencia_w	:= 'S';
 
					if ( ie_utiliza_filtro_p	= 'S' ) then 
 
						/* Tratamento para filtros */
 
						SELECT * FROM pls_gerar_ocor_aut_filtro(	nr_seq_ocor_combinada_p, nr_seq_guia_p, nr_seq_requisicao_p, nr_seq_execucao_p, r_C06_w.nr_seq_guia_proc, r_C06_w.nr_seq_guia_mat, null, null, null, null, null, null, ie_gerou_ocor_cabecalho_w, null, null, null, null, null, nm_usuario_p, ie_regra_w, ie_tipo_ocorrencia_w) INTO STRICT ie_regra_w, ie_tipo_ocorrencia_w;
 
							if ( ie_regra_w	= 'S' ) then 
								ie_gerar_ocorrencia_w	:= 'S';
							elsif ( ie_regra_w	in ('E','N') ) then 
								ie_gerar_ocorrencia_w	:= 'N';
							end if;
					end if;	
 
 
					if ( ie_gerar_ocorrencia_w	= 'S') then 
						nr_seq_oc_benef_w := pls_inserir_ocorrencia(	nr_seq_segurado_p, nr_seq_ocorrencia_p, nr_seq_requisicao_p, nr_seq_guia_p, null, r_C06_w.nr_seq_guia_proc, r_C06_w.nr_seq_guia_mat, nr_seq_ocor_combinada_p, nm_usuario_p, null, nr_seq_motivo_glosa_p, 7, cd_estabelecimento_p, 'N', null, nr_seq_oc_benef_w, null, null, null, null);
 
						CALL pls_atualizar_status_ocor_comb(	nr_seq_ocorrencia_p, nr_seq_ocor_combinada_p, nr_seq_motivo_glosa_p, 
										nr_seq_guia_p, nr_seq_requisicao_p, nr_seq_execucao_p, 
										r_C06_w.nr_seq_guia_proc,r_C06_w.nr_seq_guia_mat, null, 
										null, null, null, 
										nm_usuario_p, cd_estabelecimento_p);
					end if;
 
				end loop;
			end if;
		end if;
		-- Validar os campos obrigatórios no anexo de guia 
		if ( coalesce(ie_gerar_ocorrencia_w,'N') = 'N' and r_C01_w.ie_campo_obrigatorio = 'S' ) then 
 
 
			ie_gerar_ocorrencia_w	:= 'N';
			ds_observacao_w := pls_obter_obrig_anexo_guia(nr_seq_guia_p, null);
 
			if (ds_observacao_w IS NOT NULL AND ds_observacao_w::text <> '') then 
				ie_gerar_ocorrencia_w := 'S';
			end if;
 
 
			if ( ie_utiliza_filtro_p	= 'S' ) and (ie_gerar_ocorrencia_w = 'S') then 
				/* Tratamento para filtros */
 
				SELECT * FROM pls_gerar_ocor_aut_filtro(	nr_seq_ocor_combinada_p, nr_seq_guia_p, nr_seq_requisicao_p, nr_seq_execucao_p, null, null, null, null, null, null, null, null, ie_gerou_ocor_cabecalho_w, null, null, null, null, null, nm_usuario_p, ie_regra_w, ie_tipo_ocorrencia_w) INTO STRICT ie_regra_w, ie_tipo_ocorrencia_w;
 
 
					if ( ie_regra_w	= 'S' ) then 
						ie_gerar_ocorrencia_w	:= 'S';
					elsif ( ie_regra_w	in ('E','N') ) then 
						ie_gerar_ocorrencia_w	:= 'N';
					end if;
			end if;
 
 
			if ( ie_gerar_ocorrencia_w	= 'S') then 
				nr_seq_oc_benef_w := pls_inserir_ocorrencia(	nr_seq_segurado_p, nr_seq_ocorrencia_p, nr_seq_requisicao_p, nr_seq_guia_p, null, null, null, nr_seq_ocor_combinada_p, nm_usuario_p, ds_observacao_w, nr_seq_motivo_glosa_p, 7, cd_estabelecimento_p, 'N', null, nr_seq_oc_benef_w, null, null, null, null);
 
				CALL pls_atualizar_status_ocor_comb(	nr_seq_ocorrencia_p, nr_seq_ocor_combinada_p, nr_seq_motivo_glosa_p, 
								nr_seq_guia_p, nr_seq_requisicao_p, nr_seq_execucao_p, 
								null, null, null, 
								null, null, null, 
								nm_usuario_p, cd_estabelecimento_p);
 
			end if;	
 
		end if;
	end if;	
end loop;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_valida_ocor_aut_anexo_guia ( nr_seq_ocor_combinada_p pls_ocor_aut_combinada.nr_sequencia%type, nr_seq_ocorrencia_p pls_ocorrencia.nr_sequencia%type, nr_seq_segurado_p pls_segurado.nr_sequencia%type, nr_seq_motivo_glosa_p tiss_motivo_glosa.nr_sequencia%type, nr_seq_guia_p pls_guia_plano.nr_sequencia%type, nr_seq_requisicao_p pls_requisicao.nr_sequencia%type, nr_seq_execucao_p pls_execucao_requisicao.nr_sequencia%type, ie_utiliza_filtro_p text, nr_seq_param1_p bigint, nr_seq_param2_p bigint, nr_seq_param3_p bigint, nr_seq_param4_p bigint, nr_seq_param5_p bigint, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type ) FROM PUBLIC;

