-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gravar_indicacao_transferencia ( nr_atendimento_p bigint, nr_seq_indicacao_p bigint, cd_medico_p text, cd_pessoa_fisica_p text, cd_cgc_indicacao_p text, ie_opcao_p text, cd_estabelecimento_p bigint, nm_usuario_p text, NR_SEQ_TIPO_MIDIA_P bigint default null, DS_OBSERVACAO_P text default null) AS $body$
DECLARE


ie_existe_atend_w	varchar(1);

BEGIN
if (coalesce(nr_atendimento_p,0) > 0) and (coalesce(nr_seq_indicacao_p,0) > 0) then

	if (ie_opcao_p = 'P') and (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') then

		insert into atendimento_indicacao( nr_sequencia,
						   cd_estabelecimento,
						   dt_atualizacao,
						   nm_usuario,
						   dt_atualizacao_nrec,
						   nm_usuario_nrec,
						   nr_seq_indicacao,
						   cd_pessoa_fisica,
						   nr_atendimento,
						   DS_OBSERVACAO)
				values (nextval('atendimento_indicacao_seq'),
						cd_estabelecimento_p,
						clock_timestamp(),
						nm_usuario_p,
						clock_timestamp(),
						nm_usuario_p,
						nr_seq_indicacao_p,
						cd_pessoa_fisica_p,
						nr_atendimento_p,
						DS_OBSERVACAO_P);

	elsif (ie_opcao_p = 'J') and (cd_cgc_indicacao_p IS NOT NULL AND cd_cgc_indicacao_p::text <> '') then

		insert into atendimento_indicacao( nr_sequencia,
						   cd_estabelecimento,
						   dt_atualizacao,
						   nm_usuario,
						   dt_atualizacao_nrec,
						   nm_usuario_nrec,
						   nr_seq_indicacao,
						   cd_cgc_indicacao,
						   nr_atendimento,
						   DS_OBSERVACAO)
				values (nextval('atendimento_indicacao_seq'),
						cd_estabelecimento_p,
						clock_timestamp(),
						nm_usuario_p,
						clock_timestamp(),
						nm_usuario_p,
						nr_seq_indicacao_p,
						cd_cgc_indicacao_p,
						nr_atendimento_p,
						DS_OBSERVACAO_P);

	elsif	((ie_opcao_p = 'CC') or (ie_opcao_p = 'N')) and (cd_medico_p IS NOT NULL AND cd_medico_p::text <> '') then
		insert into atendimento_indicacao( nr_sequencia,
						   cd_estabelecimento,
						   dt_atualizacao,
						   nm_usuario,
						   dt_atualizacao_nrec,
						   nm_usuario_nrec,
						   nr_seq_indicacao,
						   cd_medico,
						   nr_atendimento,
						   DS_OBSERVACAO)
				values (nextval('atendimento_indicacao_seq'),
						cd_estabelecimento_p,
						clock_timestamp(),
						nm_usuario_p,
						clock_timestamp(),
						nm_usuario_p,
						nr_seq_indicacao_p,
						cd_medico_p,
						nr_atendimento_p,
						DS_OBSERVACAO_P);

	elsif (ie_opcao_p = 'MI') and (nr_seq_tipo_midia_p IS NOT NULL AND nr_seq_tipo_midia_p::text <> '') then
		insert into atendimento_indicacao( nr_sequencia,
						   cd_estabelecimento,
						   dt_atualizacao,
						   nm_usuario,
						   dt_atualizacao_nrec,
						   nm_usuario_nrec,
						   nr_seq_indicacao,
						   nr_seq_tipo_midia,
						   nr_atendimento,
						   DS_OBSERVACAO)
				values (nextval('atendimento_indicacao_seq'),
						cd_estabelecimento_p,
						clock_timestamp(),
						nm_usuario_p,
						clock_timestamp(),
						nm_usuario_p,
						nr_seq_indicacao_p,
						nr_seq_tipo_midia_p,
						nr_atendimento_p,
						DS_OBSERVACAO_P);

	end if;

end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gravar_indicacao_transferencia ( nr_atendimento_p bigint, nr_seq_indicacao_p bigint, cd_medico_p text, cd_pessoa_fisica_p text, cd_cgc_indicacao_p text, ie_opcao_p text, cd_estabelecimento_p bigint, nm_usuario_p text, NR_SEQ_TIPO_MIDIA_P bigint default null, DS_OBSERVACAO_P text default null) FROM PUBLIC;

