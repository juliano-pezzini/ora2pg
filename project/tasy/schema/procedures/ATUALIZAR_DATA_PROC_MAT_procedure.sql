-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_data_proc_mat ( nr_sequencia_p bigint, ie_proc_mat_p bigint, ie_opcao_p bigint, dt_ajuste_p timestamp) AS $body$
DECLARE

 
 
/*	ie_proc_mat_p 
	1 - procedimento 
	2 - material 
	 
	ie_opcao_p 
	0-data do atendimento e da conta do item 
	1-data do atendimento do item 
	2-data da conta do item 
*/
 
 
 
dt_entrada_unidade_w	timestamp;
dt_entrada_w		timestamp;


BEGIN 
 
if (ie_proc_mat_p	= 1) then 
 
	select	a.dt_entrada_unidade, 
		b.dt_entrada 
	into STRICT	dt_entrada_unidade_w, 
		dt_entrada_w 
	from	atendimento_paciente	b, 
		procedimento_paciente	a 
	where	a.nr_atendimento	= b.nr_atendimento	 
	and	a.nr_sequencia		= nr_sequencia_p;
	 
	if (dt_ajuste_p		>= dt_entrada_w) and (ie_opcao_p		= 0) then 
		update	procedimento_paciente 
		set	dt_procedimento	= dt_ajuste_p, 
			dt_conta	= dt_ajuste_p 
		where	nr_sequencia	= nr_sequencia_p;
	end if;
	 
	if (dt_ajuste_p		>= dt_entrada_w) and (ie_opcao_p		= 1) then 
		update	procedimento_paciente 
		set	dt_procedimento	= dt_ajuste_p 
		where	nr_sequencia	= nr_sequencia_p;
	end if;
	if (dt_ajuste_p		>= dt_entrada_w) and (ie_opcao_p		= 2) then 
		update	procedimento_paciente 
		set	dt_conta	= dt_ajuste_p 
		where	nr_sequencia	= nr_sequencia_p;
	end if;
 
elsif (ie_proc_mat_p	= 2) then 
	select	a.dt_entrada_unidade, 
		b.dt_entrada 
	into STRICT	dt_entrada_unidade_w, 
		dt_entrada_w 
	from	atendimento_paciente	b, 
		material_atend_paciente	a 
	where	a.nr_atendimento	= b.nr_atendimento 
	and	a.nr_sequencia		= nr_sequencia_p;
 
	if (dt_ajuste_p		>= dt_entrada_w) and (ie_opcao_p		= 0) then 
		update	material_atend_paciente 
		set	dt_atendimento	= dt_ajuste_p, 
			dt_conta	= dt_ajuste_p 
		where	nr_sequencia	= nr_sequencia_p;
	end if;
	if (dt_ajuste_p		>= dt_entrada_w) and (ie_opcao_p		= 1) then 
		update	material_atend_paciente 
		set	dt_atendimento	= dt_ajuste_p 
		where	nr_sequencia	= nr_sequencia_p;
	end if;
	if (dt_ajuste_p		>= dt_entrada_w) and (ie_opcao_p		= 2) then 
		update	material_atend_paciente 
		set	dt_conta	= dt_ajuste_p 
		where	nr_sequencia	= nr_sequencia_p;
	end if;
end if;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_data_proc_mat ( nr_sequencia_p bigint, ie_proc_mat_p bigint, ie_opcao_p bigint, dt_ajuste_p timestamp) FROM PUBLIC;

