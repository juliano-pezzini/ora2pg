-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE unir_episodio ( NR_SEQ_EPISODIO_DESTINO_P bigint ) AS $body$
DECLARE

  NR_SEQ_EPISODIO_DESTINO_c01_W bigint;
  NR_SEQ_EPISODIO_ORIGEM_c01_W bigint;
  NR_ATENDIMENTO_c01_W bigint;

  -- CURSOR COM OS NR_SEQ_EPISODIO DESTINO E ORIGEM.
  c01 CURSOR FOR
    SELECT DISTINCT TF.NR_SEQ_EPISODIO, TFI.NR_SEQ_EPISODIO_ORIGEM, TFI.NR_ATENDIMENTO
    FROM TRANSF_EPISODIO_ITEM TFI, TRANSFERENCIA_EPISODIO TF
    WHERE TFI.NR_SEQ_TRANSFERENCIA = TF.NR_SEQUENCIA
    AND TF.NR_SEQ_EPISODIO = NR_SEQ_EPISODIO_DESTINO_P;


BEGIN
  OPEN c01;
  LOOP
    FETCH c01 INTO NR_SEQ_EPISODIO_DESTINO_c01_W, NR_SEQ_EPISODIO_ORIGEM_c01_W, NR_ATENDIMENTO_c01_W;
    EXIT WHEN NOT FOUND; /* apply on c01 */
    BEGIN

      UPDATE ATENDIMENTO_PACIENTE
      SET NR_SEQ_EPISODIO = NR_SEQ_EPISODIO_DESTINO_c01_W
      WHERE NR_SEQ_EPISODIO = NR_SEQ_EPISODIO_ORIGEM_c01_W
      AND NR_ATENDIMENTO = NR_ATENDIMENTO_c01_W;

    END;

  END LOOP;
  CLOSE c01;

  COMMIT;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE unir_episodio ( NR_SEQ_EPISODIO_DESTINO_P bigint ) FROM PUBLIC;

