-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE mprev_selec_pessoa_pop_alvo ( nr_seq_populacao_alvo_p bigint, nm_pessoa_p text, qt_idade_inicial_p bigint, qt_idade_final_p bigint, ie_sexo_p text, ie_grupo_controle_p text, ie_partic_programa_p text, ie_preco_p text, qt_dias_plano_p bigint, ie_situacao_contrato_p text, ie_situacao_atend_p text, vl_custo_minimo_p bigint, vl_custo_maximo_p bigint, ie_periodo_custo_p text, pr_sinist_minimo_p bigint, pr_sinist_maximo_p bigint, ie_periodo_sinist_p text, qt_atendimento_p bigint, dt_inicio_atend_p timestamp, dt_fim_atend_p timestamp, nr_seq_tipo_atendimento_p bigint, ie_tipo_guia_p text, ie_carater_internacao_p text, cd_procedimento_p bigint, qt_procedimento_p bigint, nm_usuario_p text, ie_selecionada_p text) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: Selecionar as pessoas da população alvo que serão captadas
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[ X ]  Objetos do dicionário [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
Essa procedure monta um update com as mesmas restrições do filtro na função, ou seja
irá mudar o IE_SELECIONAR de tudo que estiver sendo exibido em tela
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
ds_update_w	varchar(4000);
ds_restricao_w	varchar(4000);


BEGIN

if (nr_seq_populacao_alvo_p IS NOT NULL AND nr_seq_populacao_alvo_p::text <> '') then

	ds_update_w	:= 	'update	mprev_pop_alvo_pessoa a ' || chr(13) || chr(10) ||
				'set	ie_selecionada = ' || chr(39) || coalesce(ie_selecionada_p,'S') || chr(39) ||
				'where	nr_seq_populacao_alvo = ' || nr_seq_populacao_alvo_p;

	ds_restricao_w	:= mprev_obter_restr_pop_alvo(	'N',
							nr_seq_populacao_alvo_p,
							nm_pessoa_p,
							qt_idade_inicial_p,
							qt_idade_final_p,
							ie_sexo_p,
							ie_grupo_controle_p,
							ie_partic_programa_p,
							ie_preco_p,
							qt_dias_plano_p,
							ie_situacao_contrato_p,
							ie_situacao_atend_p,
							vl_custo_minimo_p,
							vl_custo_maximo_p,
							ie_periodo_custo_p,
							pr_sinist_minimo_p,
							pr_sinist_maximo_p,
							ie_periodo_sinist_p,
							qt_atendimento_p,
							dt_inicio_atend_p,
							dt_fim_atend_p,
							nr_seq_tipo_atendimento_p,
							ie_tipo_guia_p,
							ie_carater_internacao_p,
							cd_procedimento_p,
							qt_procedimento_p);

	ds_update_w	:= ds_update_w || chr(13) || chr(10) || ds_restricao_w;

	CALL exec_sql_dinamico(nm_usuario_p,ds_update_w);

	commit;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE mprev_selec_pessoa_pop_alvo ( nr_seq_populacao_alvo_p bigint, nm_pessoa_p text, qt_idade_inicial_p bigint, qt_idade_final_p bigint, ie_sexo_p text, ie_grupo_controle_p text, ie_partic_programa_p text, ie_preco_p text, qt_dias_plano_p bigint, ie_situacao_contrato_p text, ie_situacao_atend_p text, vl_custo_minimo_p bigint, vl_custo_maximo_p bigint, ie_periodo_custo_p text, pr_sinist_minimo_p bigint, pr_sinist_maximo_p bigint, ie_periodo_sinist_p text, qt_atendimento_p bigint, dt_inicio_atend_p timestamp, dt_fim_atend_p timestamp, nr_seq_tipo_atendimento_p bigint, ie_tipo_guia_p text, ie_carater_internacao_p text, cd_procedimento_p bigint, qt_procedimento_p bigint, nm_usuario_p text, ie_selecionada_p text) FROM PUBLIC;

