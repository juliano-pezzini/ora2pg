-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE alterar_data_entrega_oc ( nr_ordem_compra_p bigint, dt_entrega_p timestamp, nm_usuario_p text) AS $body$
DECLARE

 
 
ds_titulo_w		varchar(80);
ds_mensagem_w		varchar(4000);
dt_entrega_w		timestamp;


BEGIN 
 
select	dt_entrega 
into STRICT	dt_entrega_w 
from	ordem_compra 
where	nr_ordem_compra	= nr_ordem_compra_p;
 
update	ordem_compra 
set	dt_entrega	= dt_entrega_p 
where	nr_ordem_compra	= nr_ordem_compra_p;
 
/*Alteração na data de entrega da ordem.*/
 
ds_titulo_w	:= substr(wheb_mensagem_pck.get_texto(297087),1,80);
 
ds_mensagem_w	:= substr(wheb_mensagem_pck.get_texto( 
			297088, 'DT_OLD=' || to_char(dt_entrega_w,'dd/mm/yyyy') || ';DT_NEW=' || to_char(dt_entrega_p,'dd/mm/yyyy')),1,4000);
 
CALL gerar_ordem_compra_hist( 
	nr_ordem_compra_p, 
	'S', 
	ds_titulo_w, 
	ds_mensagem_w, 
	nm_usuario_p);
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE alterar_data_entrega_oc ( nr_ordem_compra_p bigint, dt_entrega_p timestamp, nm_usuario_p text) FROM PUBLIC;

