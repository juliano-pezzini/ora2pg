-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE vipe_rep_copia_prescr_regra ( nr_prescricao_p bigint, nr_atendimento_p bigint, cd_medico_p text, nr_seq_transcricao_p bigint, cd_perfil_P bigint, nm_usuario_p text, cd_estabelecimento_p bigint, nr_nova_prescricao_p INOUT bigint, cd_medic_posicionar_p INOUT bigint) AS $body$
DECLARE

 
vl_parametro_w			varchar(255);
dt_prescricao_w			timestamp;
dt_primeiro_horario_w	varchar(10);
nr_nova_prescricao_w	bigint	:= 0;
					

BEGIN 
 
if (nr_prescricao_p > 0) then 
	begin 
	 
	/* Parâmetro [11] - Regra de cópia padrão para cópia da prescrição inicial */
 
	vl_parametro_w := obter_param_usuario(8030, 11, cd_perfil_p, nm_usuario_p, cd_estabelecimento_p, vl_parametro_w);
 
	select	dt_prescricao, 
			substr(to_char(dt_primeiro_horario,'dd/mm/yyyy hh24:mi:ss'),12,5) 
	into STRICT	dt_prescricao_w, 
			dt_primeiro_horario_w 
	from	prescr_medica 
	where	nr_prescricao = nr_prescricao_p;
	 
	SELECT * FROM vipe_copia_prescricao_regra(nr_prescricao_p, nr_atendimento_p, vl_parametro_w, nm_usuario_p, cd_medico_p, dt_prescricao_w, 'S', '', dt_primeiro_horario_w, '', cd_perfil_p, 0, '', '', '', dt_prescricao_w, null, nr_seq_transcricao_p, nr_nova_prescricao_w, cd_medic_posicionar_p) INTO STRICT nr_nova_prescricao_w, cd_medic_posicionar_p;
	 
	end;
end if;
 
nr_nova_prescricao_p	:= nr_nova_prescricao_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE vipe_rep_copia_prescr_regra ( nr_prescricao_p bigint, nr_atendimento_p bigint, cd_medico_p text, nr_seq_transcricao_p bigint, cd_perfil_P bigint, nm_usuario_p text, cd_estabelecimento_p bigint, nr_nova_prescricao_p INOUT bigint, cd_medic_posicionar_p INOUT bigint) FROM PUBLIC;

