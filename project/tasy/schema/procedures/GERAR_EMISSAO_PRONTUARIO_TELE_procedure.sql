-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_emissao_prontuario_tele ( nr_atendimento_p bigint, cd_pessoa_fisica_p text, nm_usuario_p text, nr_seq_gerado_p INOUT bigint, IE_ALERTAS_P text default 'N', IE_ANAMNESE_P text default 'N', IE_ATESTADO_P text default 'N', IE_AVALIACAO_P text default 'N', IE_CHECKUP_P text default 'N', IE_CIAP_P text default 'N', IE_CONSENTIMENTO_P text default 'N', IE_CONSULTA_AMB_P text default 'N', IE_DEATH_CERTF_P text default 'N', IE_DECLARACAO_RECEB_P text default 'N', IE_DIAGNOSTICO_P text default 'N', IE_DIAG_TUMOR_P text default 'N', IE_GED_P text default 'N', IE_ENCAMINHAMENTO_P text default 'N', IE_ESCALA_P text default 'N', IE_EXAME_LAB_P text default 'N', IE_LAUDO_P text default 'N', IE_GANHO_PERDA_P text default 'N', IE_HISTORICO_SAUDE_P text default 'N', IE_EVOLUCAO_P text default 'N', IE_OBSTETRICIA_NASC_P text default 'N', IE_OFTALMOLOGIA_P text default 'N', IE_ORIENTACAO_ALTA_P text default 'N', IE_ORIENTACOES_GERAIS_P text default 'N', IE_PARECER_MEDICO_P text default 'N', IE_PLANO_CUIDADO_P text default 'N', IE_PRESCRICAO_P text default 'N', IE_RECEITA_P text default 'N', IE_SAE_P text default 'N', IE_SINAIS_VITAIS_P text default 'N', IE_SOLIC_EXAME_EXT_P text default 'N', IE_TEMPLATE_P text default 'N', IE_TRAT_ONCO_P text default 'N') AS $body$
DECLARE


nr_sequencia_w			prontuario_emissao.nr_sequencia%type;
cd_setor_atendimento_w  atend_paciente_unidade.cd_setor_atendimento%type;


BEGIN

if ( coalesce(nr_atendimento_p,0) > 0 ) then

    Select Obter_Setor_Atendimento(nr_atendimento_p)
	into STRICT   cd_setor_atendimento_w
	;

	select	nextval('prontuario_emissao_seq')
	into STRICT	nr_sequencia_w
	;

	insert into prontuario_emissao(
				nr_sequencia,
				cd_pessoa_fisica,
				dt_atualizacao,
				dt_atualizacao_nrec,
				nm_usuario_nrec,
				nm_usuario,
				cd_setor_atendimento,
				nr_atendimento,
				dt_liberacao,
				cd_estabelecimento,
				DT_IMPRESSAO,
				IE_ALERTAS,
				IE_ANAMNESE,
				IE_ATESTADO,
				IE_AVALIACAO,
				IE_CHECKUP,
				IE_CIAP,
				IE_CONSENTIMENTO,
				IE_CONSULTA_AMB,
				IE_DEATH_CERTF,
				IE_DECLARACAO_RECEB,
				IE_DIAGNOSTICO,
				IE_DIAG_TUMOR,
				IE_GED,
				IE_ENCAMINHAMENTO,
				IE_ESCALA,
				IE_EXAME_LAB,
				IE_LAUDO,
				IE_GANHO_PERDA,
				IE_HISTORICO_SAUDE,
				IE_EVOLUCAO,
				IE_OBSTETRICIA_NASC,
				IE_OFTALMOLOGIA,
				IE_ORIENTACAO_ALTA,
				IE_ORIENTACOES_GERAIS,
				IE_PARECER_MEDICO,
				IE_PLANO_CUIDADO,
				IE_PRESCRICAO,
				IE_RECEITA,
				IE_SAE,
				IE_SINAIS_VITAIS,
				IE_SOLIC_EXAME_EXT,
				IE_TEMPLATE,
				IE_TRAT_ONCO,
				IE_SITUACAO)
		values (
				nr_sequencia_w,
				cd_pessoa_fisica_p,
				clock_timestamp(),
				clock_timestamp(),
				nm_usuario_p,
				nm_usuario_p,
				cd_setor_atendimento_w,
				nr_atendimento_p,
				clock_timestamp(),
				obter_estabelecimento_ativo,
				clock_timestamp(),
				coalesce(IE_ALERTAS_P,'N'),
				coalesce(IE_ANAMNESE_P,'N'),
				coalesce(IE_ATESTADO_P,'N'),
				coalesce(IE_AVALIACAO_P,'N'),
				coalesce(IE_CHECKUP_P,'N'),
				coalesce(IE_CIAP_P,'N'),
				coalesce(IE_CONSENTIMENTO_P,'N'),
				coalesce(IE_CONSULTA_AMB_P,'N'),
				coalesce(IE_DEATH_CERTF_P,'N'),
				coalesce(IE_DECLARACAO_RECEB_P,'N'),
				coalesce(IE_DIAGNOSTICO_P,'N'),
				coalesce(IE_DIAG_TUMOR_P,'N'),
				coalesce(IE_GED_P,'N'),
				coalesce(IE_ENCAMINHAMENTO_P,'N'),
				coalesce(IE_ESCALA_P,'N'),
				coalesce(IE_EXAME_LAB_P,'N'),
				coalesce(IE_LAUDO_P,'N'),
				coalesce(IE_GANHO_PERDA_P,'N'),
				coalesce(IE_HISTORICO_SAUDE_P,'N'),
				coalesce(IE_EVOLUCAO_P,'N'),
				coalesce(IE_OBSTETRICIA_NASC_P,'N'),
				coalesce(IE_OFTALMOLOGIA_P,'N'),
				coalesce(IE_ORIENTACAO_ALTA_P,'N'),
				coalesce(IE_ORIENTACOES_GERAIS_P,'N'),
				coalesce(IE_PARECER_MEDICO_P,'N'),
				coalesce(IE_PLANO_CUIDADO_P,'N'),
				coalesce(IE_PRESCRICAO_P,'N'),
				coalesce(IE_RECEITA_P,'N'),
				coalesce(IE_SAE_P,'N'),
				coalesce(IE_SINAIS_VITAIS_P,'N'),
				coalesce(IE_SOLIC_EXAME_EXT_P,'N'),
				coalesce(IE_TEMPLATE_P,'N'),
				coalesce(IE_TRAT_ONCO_P,'N'),
				'A'
		);

end if;

commit;

nr_seq_gerado_p	:= nr_sequencia_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_emissao_prontuario_tele ( nr_atendimento_p bigint, cd_pessoa_fisica_p text, nm_usuario_p text, nr_seq_gerado_p INOUT bigint, IE_ALERTAS_P text default 'N', IE_ANAMNESE_P text default 'N', IE_ATESTADO_P text default 'N', IE_AVALIACAO_P text default 'N', IE_CHECKUP_P text default 'N', IE_CIAP_P text default 'N', IE_CONSENTIMENTO_P text default 'N', IE_CONSULTA_AMB_P text default 'N', IE_DEATH_CERTF_P text default 'N', IE_DECLARACAO_RECEB_P text default 'N', IE_DIAGNOSTICO_P text default 'N', IE_DIAG_TUMOR_P text default 'N', IE_GED_P text default 'N', IE_ENCAMINHAMENTO_P text default 'N', IE_ESCALA_P text default 'N', IE_EXAME_LAB_P text default 'N', IE_LAUDO_P text default 'N', IE_GANHO_PERDA_P text default 'N', IE_HISTORICO_SAUDE_P text default 'N', IE_EVOLUCAO_P text default 'N', IE_OBSTETRICIA_NASC_P text default 'N', IE_OFTALMOLOGIA_P text default 'N', IE_ORIENTACAO_ALTA_P text default 'N', IE_ORIENTACOES_GERAIS_P text default 'N', IE_PARECER_MEDICO_P text default 'N', IE_PLANO_CUIDADO_P text default 'N', IE_PRESCRICAO_P text default 'N', IE_RECEITA_P text default 'N', IE_SAE_P text default 'N', IE_SINAIS_VITAIS_P text default 'N', IE_SOLIC_EXAME_EXT_P text default 'N', IE_TEMPLATE_P text default 'N', IE_TRAT_ONCO_P text default 'N') FROM PUBLIC;

