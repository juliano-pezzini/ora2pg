-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ptu_consistir_compl_pedido_aut ( nr_seq_requisicao_p bigint, nr_seq_guia_p bigint, nr_seq_pedido_compl_p bigint, nm_usuario_p text ) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: Validar os campos obrigatórios na transação de Pedido de complemento de
	autorização do PTU 6.0

-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  x]  Objetos do dicionário [ ] Tasy (Delphi/Java) [   ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
Performace;
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
cd_unimed_prestador_req_w	ptu_pedido_compl_aut.cd_unimed_prestador_req%type;
nr_seq_prestador_req_w		ptu_pedido_compl_aut.nr_seq_prestador_req%type;
nr_seq_prestador_w		ptu_pedido_compl_aut.nr_seq_prestador%type;
cd_unimed_prestador_w		ptu_pedido_compl_aut.cd_unimed_prestador_req%type;
nr_seq_prestador_exec_w		ptu_pedido_compl_aut.nr_seq_prestador_req%type;
ie_liminar_w			ptu_pedido_compl_aut.ie_liminar%type;
nr_seq_origem_w			ptu_pedido_compl_aut.nr_seq_origem%type;
nr_versao_tiss_w		ptu_pedido_autorizacao.nr_versao_tiss%type;
ie_tipo_guia_w			pls_requisicao.ie_tipo_guia%type;
nr_seq_prestador_web_w		pls_requisicao.nr_seq_prestador%type;
ie_origem_solic_w		pls_requisicao.ie_origem_solic%type;
ds_indicacao_clinica_w		pls_requisicao.ds_indicacao_clinica%type;
vl_servico_w			ptu_pedido_compl_aut_serv.vl_servico%type;
vl_uni_servico_w		ptu_pedido_compl_aut_serv.vl_uni_servico%type;
ds_opme_w			ptu_pedido_compl_aut_serv.ds_opme%type;
cd_cgc_outorgante_w		pls_outorgante.cd_cgc_outorgante%type;
cd_cooperativa_w		pls_congenere.cd_cooperativa%type;
nr_seq_guia_principal_w		pls_requisicao.nr_seq_guia_principal%type;
qt_prestador_w			bigint := 0;
qt_diagnostico_w		bigint := 0;
qt_opme_w			bigint := 0;
qt_radio_w			bigint := 0;
qt_quimio_w			bigint := 0;
qt_opme_ww			bigint := 0;
qt_radio_ww			bigint := 0;
qt_quimio_ww			bigint := 0;
qt_consist_w			bigint := 0;

C01 CURSOR FOR
	SELECT	nr_sequencia,
		cd_consistencia,
		ie_bloqueia_portal
	from	ptu_consitencia_envio
	where	ie_tipo_transacao 	= '1'
	and	ie_situacao		= 'A'
	order by 1;

C02 CURSOR FOR
	SELECT	nr_sequencia,
		ie_tipo_anexo
	from	pls_lote_anexo_guias_aut
	where	((nr_seq_requisicao IS NOT NULL AND nr_seq_requisicao::text <> '' AND nr_seq_requisicao = nr_seq_requisicao_p)
	or (nr_seq_guia IS NOT NULL AND nr_seq_guia::text <> '') and (nr_seq_guia = nr_seq_guia_p));

--Anexo OPME
C03 CURSOR( nr_seq_anexo_pc 	pls_lote_anexo_guias_aut.nr_sequencia%type ) FOR
	SELECT	b.nr_seq_material,
		a.ds_justificativa,
		a.nm_profissional_solic,
		a.nr_telef_prof_solic,
		b.nr_registro_anvisa,
		b.cd_ref_fabricante_imp,
		b.ie_opcao_fabricante
	from	pls_lote_anexo_guias_aut 	a,
		pls_lote_anexo_mat_aut		b
	where	b.nr_seq_lote_anexo_guia	= a.nr_sequencia
	and	a.nr_sequencia			= nr_seq_anexo_pc;

--Anexo Quimio
C04 CURSOR( nr_seq_anexo_pc 	pls_lote_anexo_guias_aut.nr_sequencia%type ) FOR
	SELECT	a.qt_idade_benef,
		a.ie_sexo,
		a.nm_profissional_solic,
		a.nr_telef_prof_solic,
		a.qt_altura,
		a.qt_peso,
		a.qt_superficie_corporal,
		a.nr_ciclo_previsto,
		a.nr_ciclo_atual,
		a.qt_intervalo_ciclo,
		a.nr_dia_ciclo_atual,
		a.ds_procedimento_cirurgico,
		c.dt_prevista,
		c.qt_unidade_medida,
		c.ie_via_administracao,
		c.ie_frequencia_dose,
		c.qt_dosagem_total
	from	pls_lote_anexo_guias_aut	a,
		pls_lote_anexo_mat_aut		c
	where	c.nr_seq_lote_anexo_guia 	= a.nr_sequencia
	and	a.nr_sequencia			= nr_seq_anexo_pc;
--Anexo Radio
C05 CURSOR( nr_seq_anexo_pc 	pls_lote_anexo_guias_aut.nr_sequencia%type ) FOR
	SELECT	qt_idade_benef,
		ie_sexo,
		nm_profissional_solic,
		nr_telef_prof_solic,
		nr_campos,
		qt_dose_dia,
		qt_dose_total,
		qt_dias_previsto,
		dt_inicio_previsto
	from	pls_lote_anexo_guias_aut
	where	nr_sequencia	= nr_seq_anexo_pc;

--Diagnostico Quimio/radio. Este cursor não foi vinculado ao cursor de Quimio/radio pois a tabela em questão só recebe valor ao inserir algum registro manualmente, portanto, o cursor acima ficaria inválida.
C06 CURSOR( nr_seq_anexo_pc 	pls_lote_anexo_guias_aut.nr_sequencia%type ) FOR
	SELECT	ie_tipo_diagnostico,
		ds_plano_terapeutico,
		ie_estadia_tumor,
		ie_tipo_quimioterapia,
		cd_finalidade_tratamento,
		ie_capacidade_funcional,
		ie_tumor,
		ie_nodulo,
		ie_metastases
	from	pls_lote_anexo_diag_aut
	where	nr_seq_lote_anexo_guia 	= nr_seq_anexo_pc;
BEGIN

if (nr_seq_guia_p IS NOT NULL AND nr_seq_guia_p::text <> '') then

	select	cd_medico_solicitante, --nr_seq_prestador_req_w
		nr_seq_prestador,
		ie_tipo_guia,
		ie_origem_solic,
		ds_indicacao_clinica,
		nr_seq_guia_principal
	into STRICT	nr_seq_prestador_req_w,
		nr_seq_prestador_web_w,
		ie_tipo_guia_w,
		ie_origem_solic_w,
		ds_indicacao_clinica_w,
		nr_seq_guia_principal_w
	from	pls_guia_plano
	where	nr_sequencia = nr_seq_guia_p;

	select	max(cd_cgc_outorgante)
	into STRICT	cd_cgc_outorgante_w
	from	pls_outorgante;

	select	max(cd_cooperativa)
	into STRICT	cd_cooperativa_w
	from	pls_congenere
	where	cd_cgc			= cd_cgc_outorgante_w
	and	(cd_cooperativa IS NOT NULL AND cd_cooperativa::text <> '');

	if (nr_seq_prestador_req_w IS NOT NULL AND nr_seq_prestador_req_w::text <> '') then
		cd_unimed_prestador_req_w		:=	cd_cooperativa_w;
	end if;

	begin
		select	substr(coalesce(cd_prestador, nr_sequencia),1,8)
		into STRICT	nr_seq_prestador_w
		from	pls_prestador
		where	nr_sequencia	= nr_seq_prestador_web_w;
	exception
	when others then
		nr_seq_prestador_w	:= nr_seq_prestador_web_w;
	end;

	if (nr_seq_prestador_w IS NOT NULL AND nr_seq_prestador_w::text <> '') then
		cd_unimed_prestador_w		:=	cd_cooperativa_w;
	end if;

	ie_liminar_w := 'N';

	select	pls_obter_versao_tiss
	into STRICT	nr_versao_tiss_w
	;

	begin
		select	nr_seq_execucao
		into STRICT	nr_seq_origem_w
		from	ptu_pedido_autorizacao
		where	nr_seq_guia = nr_seq_guia_principal_w;
	exception
	when others then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(179718);
	end;

	select  count(1)
	into STRICT	qt_opme_w
	from  	pls_guia_plano_mat
	where  	nr_seq_guia = nr_seq_guia_p
	and  	ie_tipo_anexo = 'OP';

	select  count(1)
	into STRICT	qt_quimio_w
	from  	pls_guia_plano_mat
	where  	nr_seq_guia = nr_seq_guia_p
	and  	ie_tipo_anexo = 'QU';

	select  count(1)
	into STRICT	qt_radio_w
	from  	pls_guia_plano_proc
	where  	nr_seq_guia = nr_seq_guia_p
	and  	ie_tipo_anexo = 'RA';

	if (qt_opme_w > 0) then
		select	count(1)
		into STRICT	qt_opme_ww
		from	pls_lote_anexo_guias_aut a,
			pls_lote_anexo_mat_aut	 b
		where  	b.nr_seq_lote_anexo_guia = a.nr_sequencia
		and	a.nr_seq_guia = nr_seq_guia_p
		and	ie_tipo_anexo = 'OP';
	end if;

	if (qt_quimio_w > 0) then
		select	count(1)
		into STRICT	qt_quimio_ww
		from	pls_lote_anexo_guias_aut a,
			pls_lote_anexo_mat_aut	 b
		where  	b.nr_seq_lote_anexo_guia = a.nr_sequencia
		and  	nr_seq_guia = nr_seq_guia_p
		and	ie_tipo_anexo = 'QU';
	end if;

	if (qt_radio_w > 0) then
		select	count(1)
		into STRICT	qt_radio_ww
		from	pls_lote_anexo_guias_aut
		where  	nr_seq_guia = nr_seq_guia_p
		and	ie_tipo_anexo = 'RA';
	end if;

	select	count(1)
	into STRICT	qt_consist_w
	from	ptu_consist_transacao
	where	nr_seq_guia = nr_seq_guia_p
	and	ie_habilita = 'S';

	if (qt_consist_w > 0) then
		update	ptu_consist_transacao
		set	ie_habilita = 'N'
		where	nr_seq_guia = nr_seq_guia_p;
	end if;

elsif (nr_seq_requisicao_p IS NOT NULL AND nr_seq_requisicao_p::text <> '')	then

	select	nr_seq_prestador_exec,
		ie_tipo_guia,
		nr_seq_prestador,
		ie_origem_solic,
		ds_indicacao_clinica,
		nr_seq_guia_principal
	into STRICT	nr_seq_prestador_exec_w,
		ie_tipo_guia_w,
		nr_seq_prestador_web_w,
		ie_origem_solic_w,
		ds_indicacao_clinica_w,
		nr_seq_guia_principal_w
	from	pls_requisicao
	where	nr_sequencia = nr_seq_requisicao_p;

	select	max(cd_cgc_outorgante)
	into STRICT	cd_cgc_outorgante_w
	from	pls_outorgante;

	select	max(cd_cooperativa)
	into STRICT	cd_cooperativa_w
	from	pls_congenere
	where	cd_cgc			= cd_cgc_outorgante_w
	and	(cd_cooperativa IS NOT NULL AND cd_cooperativa::text <> '');

	begin
		select	substr(coalesce(cd_prestador,nr_sequencia),1,8)
		into STRICT	nr_seq_prestador_req_w
		from	pls_prestador
		where	nr_sequencia	= nr_seq_prestador_web_w;
	exception
	when others then
		nr_seq_prestador_req_w	:= nr_seq_prestador_web_w;
	end;

	if (nr_seq_prestador_req_w IS NOT NULL AND nr_seq_prestador_req_w::text <> '') then
		cd_unimed_prestador_req_w	:=	cd_cooperativa_w;
	end if;

	begin
		select	substr(coalesce(cd_prestador,nr_sequencia),1,8)
		into STRICT	nr_seq_prestador_w
		from	pls_prestador
		where	nr_sequencia	= nr_seq_prestador_exec_w;
	exception
	when others then
		nr_seq_prestador_w	:= nr_seq_prestador_exec_w;
	end;

	if (nr_seq_prestador_w IS NOT NULL AND nr_seq_prestador_w::text <> '') then
		cd_unimed_prestador_w		:=	cd_cooperativa_w;
	end if;


	ie_liminar_w := 'N';

	select	pls_obter_versao_tiss
	into STRICT	nr_versao_tiss_w
	;

	if (coalesce(nr_seq_guia_principal_w,0)	<> 0) then
		select	max(nr_seq_requisicao)
		into STRICT	nr_seq_guia_principal_w
		from	pls_execucao_req_item
		where	nr_seq_guia	= nr_seq_guia_principal_w;
	end if;

	begin
		select	nr_seq_execucao
		into STRICT	nr_seq_origem_w
		from	ptu_pedido_autorizacao
		where	nr_seq_requisicao = nr_seq_guia_principal_w;
	exception
	when others then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(179718);
	end;

	select  count(1)
	into STRICT	qt_opme_w
	from  	pls_requisicao_mat
	where  	nr_seq_requisicao = nr_seq_requisicao_p
	and  	ie_tipo_anexo = 'OP';

	select  count(1)
	into STRICT	qt_quimio_w
	from  	pls_requisicao_mat
	where  	nr_seq_requisicao = nr_seq_requisicao_p
	and  	ie_tipo_anexo = 'QU';

	select  count(1)
	into STRICT	qt_radio_w
	from  	pls_requisicao_proc
	where  	nr_seq_requisicao = nr_seq_requisicao_p
	and  	ie_tipo_anexo = 'RA';

	if (qt_opme_w > 0) then
		select	count(1)
		into STRICT	qt_opme_ww
		from	pls_lote_anexo_guias_aut a,
			pls_lote_anexo_mat_aut	 b
		where  	b.nr_seq_lote_anexo_guia = a.nr_sequencia
		and	nr_seq_requisicao = nr_seq_requisicao_p
		and	ie_tipo_anexo = 'OP';
	end if;

	if (qt_quimio_w > 0) then
		select	count(1)
		into STRICT	qt_quimio_ww
		from	pls_lote_anexo_guias_aut a,
			pls_lote_anexo_mat_aut	 b
		where  	b.nr_seq_lote_anexo_guia = a.nr_sequencia
		and	nr_seq_requisicao = nr_seq_requisicao_p
		and	ie_tipo_anexo = 'QU';
	end if;

	if (qt_radio_w > 0) then
		select	count(1)
		into STRICT	qt_radio_ww
		from	pls_lote_anexo_guias_aut
		where	nr_seq_requisicao = nr_seq_requisicao_p
		and	ie_tipo_anexo = 'RA';
	end if;

	select	count(1)
	into STRICT	qt_consist_w
	from	ptu_consist_transacao
	where	nr_seq_requisicao = nr_seq_requisicao_p
	and	ie_habilita = 'S';

	if (qt_consist_w > 0) then
		update	ptu_consist_transacao
		set	ie_habilita = 'N'
		where	nr_seq_requisicao = nr_seq_requisicao_p;
	end if;


end if;

for r_C01_w in C01 loop
	if (r_C01_w.cd_consistencia = '48') then
		if (coalesce(nr_seq_origem_w::text, '') = '') then

			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_web_w;

			if (qt_prestador_w = 0) then
				if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
					insert	into	ptu_consist_transacao(
							nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
							nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
							nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
							nr_seq_requisicao, nr_seq_guia
						)
					values (
							nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
							nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
							null, null, nr_seq_pedido_compl_p,
							nr_seq_requisicao_p, nr_seq_guia_p
						);
				end if;
			end if;
		end if;
	elsif (r_C01_w.cd_consistencia = '50') then
		if (coalesce(cd_unimed_prestador_req_w::text, '') = '') and (nr_seq_prestador_req_w IS NOT NULL AND nr_seq_prestador_req_w::text <> '') then

			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_web_w;

			if (qt_prestador_w = 0) then
				if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
					insert	into	ptu_consist_transacao(
							nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
							nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
							nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
							nr_seq_requisicao, nr_seq_guia
						)
					values (
							nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
							nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
							null, null, nr_seq_pedido_compl_p,
							nr_seq_requisicao_p, nr_seq_guia_p
						);
				end if;
			end if;

		end if;
	elsif (r_C01_w.cd_consistencia = '51') then
		if (coalesce(nr_seq_prestador_req_w::text, '') = '') and (cd_unimed_prestador_req_w IS NOT NULL AND cd_unimed_prestador_req_w::text <> '') then

			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_web_w;

			if (qt_prestador_w = 0) then
				if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
					insert	into	ptu_consist_transacao(
							nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
							nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
							nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
							nr_seq_requisicao, nr_seq_guia
						)
					values (
							nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
							nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
							null, null, nr_seq_pedido_compl_p,
							nr_seq_requisicao_p, nr_seq_guia_p
						);
				end if;
			end if;

		end if;
	elsif (r_C01_w.cd_consistencia = '52')then
		if (coalesce(cd_unimed_prestador_w::text, '') = '') and (ie_tipo_guia_w in ('1','8')) then

			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_web_w;

			if (qt_prestador_w = 0) then
				if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
					insert	into	ptu_consist_transacao(
							nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
							nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
							nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
							nr_seq_requisicao, nr_seq_guia
						)
					values (
							nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
							nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
							null, null, nr_seq_pedido_compl_p,
							nr_seq_requisicao_p, nr_seq_guia_p
						);
				end if;
			end if;

		end if;
	elsif (r_C01_w.cd_consistencia = '53') then
		if (coalesce(nr_seq_prestador_w::text, '') = '') and (ie_tipo_guia_w in ('1','8')) then

			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_web_w;

			if (qt_prestador_w = 0) then
				if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
					insert	into	ptu_consist_transacao(
							nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
							nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
							nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
							nr_seq_requisicao, nr_seq_guia
						)
					values (
							nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
							nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
							null, null, nr_seq_pedido_compl_p,
							nr_seq_requisicao_p, nr_seq_guia_p
						);
				end if;
			end if;
		end if;
	elsif (r_C01_w.cd_consistencia = '55') then
		if (coalesce(ie_liminar_w::text, '') = '') then

			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_web_w;

			if (qt_prestador_w = 0) then
				if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
					insert	into	ptu_consist_transacao(
							nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
							nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
							nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
							nr_seq_requisicao, nr_seq_guia
						)
					values (
							nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
							nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
							null, null, nr_seq_pedido_compl_p,
							nr_seq_requisicao_p, nr_seq_guia_p
						);
				end if;
			end if;
		end if;
	elsif (r_C01_w.cd_consistencia = '174') then
		if (coalesce(ds_indicacao_clinica_w::text, '') = '') and (ie_tipo_guia_w in ('1','8')) then
			select	count(1)
			into STRICT	qt_prestador_w
			from	ptu_excecao_consistencia
			where	nr_seq_consist_envio = r_C01_w.nr_sequencia
			and	nr_seq_prestador = nr_seq_prestador_web_w;

			if (qt_prestador_w = 0) then
				if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
					insert	into	ptu_consist_transacao(
							nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
							nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
							nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
							nr_seq_requisicao, nr_seq_guia
						)
					values (
							nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
							nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
							null, null, nr_seq_pedido_compl_p,
							nr_seq_requisicao_p, nr_seq_guia_p
						);
				end if;
			end if;
		end if;
	end if;
	for r_C02_w in C02 loop
		if (r_C02_w.nr_sequencia IS NOT NULL AND r_C02_w.nr_sequencia::text <> '') then
			if (r_C02_w.ie_tipo_anexo = 'OP') then
				for r_C03_w in C03( r_C02_w.nr_sequencia ) loop
						if (r_C01_w.cd_consistencia = '58') then
							if (coalesce(r_C03_w.ds_justificativa::text, '') = '') then
								select	count(1)
								into STRICT	qt_prestador_w
								from	ptu_excecao_consistencia
								where	nr_seq_consist_envio = r_C01_w.nr_sequencia
								and	nr_seq_prestador = nr_seq_prestador_web_w;

								if (qt_prestador_w = 0) then
									if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
										insert	into	ptu_consist_transacao(
												nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
												nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
												nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
												nr_seq_requisicao, nr_seq_guia, ie_habilita
											)
										values (
												nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
												nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
												null, null, nr_seq_pedido_compl_p,
												nr_seq_requisicao_p, nr_seq_guia_p, 'S'
											);
									end if;
								end if;
							end if;
						elsif (r_C01_w.cd_consistencia = '59') then
							if (coalesce(r_C03_w.nm_profissional_solic::text, '') = '') then
								select	count(1)
								into STRICT	qt_prestador_w
								from	ptu_excecao_consistencia
								where	nr_seq_consist_envio = r_C01_w.nr_sequencia
								and	nr_seq_prestador = nr_seq_prestador_web_w;

								if (qt_prestador_w = 0) then
									if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
										insert	into	ptu_consist_transacao(
												nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
												nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
												nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
												nr_seq_requisicao, nr_seq_guia, ie_habilita
											)
										values (
												nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
												nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
												null, null, nr_seq_pedido_compl_p,
												nr_seq_requisicao_p, nr_seq_guia_p, 'S'
											);
									end if;
								end if;
							end if;
						elsif (r_C01_w.cd_consistencia = '60') then
							if (coalesce(r_C03_w.nr_telef_prof_solic::text, '') = '') then
								select	count(1)
								into STRICT	qt_prestador_w
								from	ptu_excecao_consistencia
								where	nr_seq_consist_envio = r_C01_w.nr_sequencia
								and	nr_seq_prestador = nr_seq_prestador_web_w;

								if (qt_prestador_w = 0) then
									if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
										insert	into	ptu_consist_transacao(
												nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
												nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
												nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
												nr_seq_requisicao, nr_seq_guia, ie_habilita
											)
										values (
												nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
												nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
												null, null, nr_seq_pedido_compl_p,
												nr_seq_requisicao_p, nr_seq_guia_p, 'S'
											);
									end if;
								end if;
							end if;
						elsif (r_C01_w.cd_consistencia = '172') then
							if (nr_seq_guia_p IS NOT NULL AND nr_seq_guia_p::text <> '') then
								select	substr(pls_obter_desc_material(nr_seq_material),1,400) ds_opme
								into STRICT	ds_opme_w
								from	pls_guia_plano_mat
								where	nr_seq_guia = nr_seq_guia_p
								and	nr_seq_material = r_C03_w.nr_seq_material  LIMIT 1;

							elsif (nr_seq_requisicao_p IS NOT NULL AND nr_seq_requisicao_p::text <> '') then
								select	substr(pls_obter_desc_material(nr_seq_material),1,400) ds_opme
								into STRICT	ds_opme_w
								from	pls_requisicao_mat
								where	nr_seq_requisicao = nr_seq_requisicao_p
								and	nr_seq_material = r_C03_w.nr_seq_material  LIMIT 1;
							end if;

							if (coalesce(ds_opme_w::text, '') = '') then
								select	count(1)
								into STRICT	qt_prestador_w
								from	ptu_excecao_consistencia
								where	nr_seq_consist_envio = r_C01_w.nr_sequencia
								and	nr_seq_prestador = nr_seq_prestador_web_w;

								if (qt_prestador_w = 0) then
									if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
										insert	into	ptu_consist_transacao(
												nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
												nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
												nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
												nr_seq_requisicao, nr_seq_guia, ie_habilita
											)
										values (
												nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
												nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
												null, null, nr_seq_pedido_compl_p,
												nr_seq_requisicao_p, nr_seq_guia_p, 'S'
											);
									end if;
								end if;
							end if;

							ds_opme_w := null;

						elsif (r_C01_w.cd_consistencia = '175') then

							if (nr_seq_guia_p IS NOT NULL AND nr_seq_guia_p::text <> '') then
								select (vl_material * qt_solicitada) vl_servico
								into STRICT	vl_servico_w
								from	pls_guia_plano_mat
								where	nr_seq_guia = nr_seq_guia_p
								and	nr_seq_material = r_C03_w.nr_seq_material  LIMIT 1;

							elsif (nr_seq_requisicao_p IS NOT NULL AND nr_seq_requisicao_p::text <> '') then
								select (vl_material * qt_solicitado) vl_servico
								into STRICT	vl_servico_w
								from	pls_requisicao_mat
								where	nr_seq_requisicao = nr_seq_requisicao_p
								and	nr_seq_material = r_C03_w.nr_seq_material  LIMIT 1;
							end if;
							if (coalesce(vl_servico_w::text, '') = '') then
								select	count(1)
								into STRICT	qt_prestador_w
								from	ptu_excecao_consistencia
								where	nr_seq_consist_envio = r_C01_w.nr_sequencia
								and	nr_seq_prestador = nr_seq_prestador_web_w;

								if (qt_prestador_w = 0) then
									if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
										insert	into	ptu_consist_transacao(
												nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
												nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
												nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
												nr_seq_requisicao, nr_seq_guia, ie_habilita
											)
										values (
												nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
												nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
												null, null, nr_seq_pedido_compl_p,
												nr_seq_requisicao_p, nr_seq_guia_p, 'S'
											);
									end if;
								end if;
							end if;

							vl_servico_w := null;

						elsif (r_C01_w.cd_consistencia = '163') then

							if (nr_seq_guia_p IS NOT NULL AND nr_seq_guia_p::text <> '') then
								select	vl_material
								into STRICT	vl_uni_servico_w
								from	pls_guia_plano_mat
								where	nr_seq_guia = nr_seq_guia_p
								and	nr_seq_material = r_C03_w.nr_seq_material  LIMIT 1;
							elsif (nr_seq_requisicao_p IS NOT NULL AND nr_seq_requisicao_p::text <> '') then
								select	vl_material
								into STRICT	vl_uni_servico_w
								from	pls_requisicao_mat
								where	nr_seq_requisicao = nr_seq_requisicao_p
								and	nr_seq_material = r_C03_w.nr_seq_material  LIMIT 1;
							end if;

							if (coalesce(vl_uni_servico_w::text, '') = '') then
								select	count(1)
								into STRICT	qt_prestador_w
								from	ptu_excecao_consistencia
								where	nr_seq_consist_envio = r_C01_w.nr_sequencia
								and	nr_seq_prestador = nr_seq_prestador_web_w;

								if (qt_prestador_w = 0) then
									if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
										insert	into	ptu_consist_transacao(
												nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
												nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
												nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
												nr_seq_requisicao, nr_seq_guia, ie_habilita
											)
										values (
												nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
												nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
												null, null, nr_seq_pedido_compl_p,
												nr_seq_requisicao_p, nr_seq_guia_p, 'S'
											);
									end if;
								end if;
							end if;

							vl_uni_servico_w := null;

						elsif (r_C01_w.cd_consistencia = '164') then
							if (coalesce(r_C03_w.nr_registro_anvisa::text, '') = '') then
								select	count(1)
								into STRICT	qt_prestador_w
								from	ptu_excecao_consistencia
								where	nr_seq_consist_envio = r_C01_w.nr_sequencia
								and	nr_seq_prestador = nr_seq_prestador_web_w;

								if (qt_prestador_w = 0) then
									if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
										insert	into	ptu_consist_transacao(
												nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
												nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
												nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
												nr_seq_requisicao, nr_seq_guia, ie_habilita
											)
										values (
												nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
												nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
												null, null, nr_seq_pedido_compl_p,
												nr_seq_requisicao_p, nr_seq_guia_p, 'S'
											);
									end if;
								end if;
							end if;
						elsif (r_C01_w.cd_consistencia = '165') then
							if (coalesce(r_C03_w.cd_ref_fabricante_imp::text, '') = '') then
								select	count(1)
								into STRICT	qt_prestador_w
								from	ptu_excecao_consistencia
								where	nr_seq_consist_envio = r_C01_w.nr_sequencia
								and	nr_seq_prestador = nr_seq_prestador_web_w;

								if (qt_prestador_w = 0) then
									if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
										insert	into	ptu_consist_transacao(
												nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
												nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
												nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
												nr_seq_requisicao, nr_seq_guia, ie_habilita
											)
										values (
												nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
												nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
												null, null, nr_seq_pedido_compl_p,
												nr_seq_requisicao_p, nr_seq_guia_p, 'S'
											);
									end if;
								end if;
							end if;
						elsif (r_C01_w.cd_consistencia = '166') then
							if (coalesce(r_C03_w.ie_opcao_fabricante::text, '') = '') then
								select	count(1)
								into STRICT	qt_prestador_w
								from	ptu_excecao_consistencia
								where	nr_seq_consist_envio = r_C01_w.nr_sequencia
								and	nr_seq_prestador = nr_seq_prestador_web_w;

								if (qt_prestador_w = 0) then
									if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
										insert	into	ptu_consist_transacao(
												nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
												nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
												nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
												nr_seq_requisicao, nr_seq_guia, ie_habilita
											)
										values (
												nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
												nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
												null, null, nr_seq_pedido_compl_p,
												nr_seq_requisicao_p, nr_seq_guia_p, 'S'
											);
									end if;
								end if;
							end if;
						end if;
				end loop;
			elsif (r_C02_w.ie_tipo_anexo = 'QU') then
				for r_C04_w in C04( r_C02_w.nr_sequencia ) loop
					if (r_C01_w.cd_consistencia = '56') then
						if (coalesce(r_C04_w.qt_idade_benef::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					elsif (r_C01_w.cd_consistencia = '57') then
						if (coalesce(r_C04_w.ie_sexo::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					elsif (r_C01_w.cd_consistencia = '62') then
						if (coalesce(r_C04_w.qt_altura::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					elsif (r_C01_w.cd_consistencia = '63') then
						if (coalesce(r_C04_w.qt_peso::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					elsif (r_C01_w.cd_consistencia = '64') then
						if (coalesce(r_C04_w.qt_superficie_corporal::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					end if;

					qt_diagnostico_w := 0;

					select	count(1)
					into STRICT	qt_diagnostico_w
					from	pls_lote_anexo_diag_aut
					where	nr_seq_lote_anexo_guia 	= r_C02_w.nr_sequencia
					and	ie_tipo_diagnostico	= 'DT';

					if (qt_diagnostico_w > 0) then
						for r_C06_w in C06( r_C02_w.nr_sequencia ) loop
							if (r_C01_w.cd_consistencia = '61') then
								if (coalesce(r_C06_w.ds_plano_terapeutico::text, '') = '') then
									select	count(1)
									into STRICT	qt_prestador_w
									from	ptu_excecao_consistencia
									where	nr_seq_consist_envio = r_C01_w.nr_sequencia
									and	nr_seq_prestador = nr_seq_prestador_web_w;

									if (qt_prestador_w = 0) then
										if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
											insert	into	ptu_consist_transacao(
													nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
													nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
													nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
													nr_seq_requisicao, nr_seq_guia, ie_habilita
												)
											values (
													nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
													nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
													null, null, nr_seq_pedido_compl_p,
													nr_seq_requisicao_p, nr_seq_guia_p, 'S'
												);
										end if;
									end if;
								end if;
							elsif (r_C01_w.cd_consistencia = '74') and (nr_versao_tiss_w in ('3.03.00','3.03.01','3.03.02')) then
								if (coalesce(r_C06_w.ie_metastases::text, '') = '') then
									select	count(1)
									into STRICT	qt_prestador_w
									from	ptu_excecao_consistencia
									where	nr_seq_consist_envio = r_C01_w.nr_sequencia
									and	nr_seq_prestador = nr_seq_prestador_web_w;

									if (qt_prestador_w = 0) then
										if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
											insert	into	ptu_consist_transacao(
													nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
													nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
													nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
													nr_seq_requisicao, nr_seq_guia, ie_habilita
												)
											values (
													nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
													nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
													null, null, nr_seq_pedido_compl_p,
													nr_seq_requisicao_p, nr_seq_guia_p, 'S'
												);
										end if;
									end if;
								end if;
							elsif (r_C01_w.cd_consistencia = '75') then
								if (coalesce(r_C06_w.ie_tumor::text, '') = '') and (nr_versao_tiss_w in ('3.03.00','3.03.01','3.03.02')) then
									select	count(1)
									into STRICT	qt_prestador_w
									from	ptu_excecao_consistencia
									where	nr_seq_consist_envio = r_C01_w.nr_sequencia
									and	nr_seq_prestador = nr_seq_prestador_web_w;

									if (qt_prestador_w = 0) then
										if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
											insert	into	ptu_consist_transacao(
													nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
													nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
													nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
													nr_seq_requisicao, nr_seq_guia, ie_habilita
												)
											values (
													nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
													nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
													null, null, nr_seq_pedido_compl_p,
													nr_seq_requisicao_p, nr_seq_guia_p, 'S'
												);
										end if;
									end if;
								end if;
							elsif (r_C01_w.cd_consistencia = '76') then
								if (coalesce(r_C06_w.ie_nodulo::text, '') = '') and (nr_versao_tiss_w in ('3.03.00','3.03.01','3.03.02')) then
									select	count(1)
									into STRICT	qt_prestador_w
									from	ptu_excecao_consistencia
									where	nr_seq_consist_envio = r_C01_w.nr_sequencia
									and	nr_seq_prestador = nr_seq_prestador_web_w;

									if (qt_prestador_w = 0) then
										if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
											insert	into	ptu_consist_transacao(
													nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
													nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
													nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
													nr_seq_requisicao, nr_seq_guia, ie_habilita
												)
											values (
													nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
													nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
													null, null, nr_seq_pedido_compl_p,
													nr_seq_requisicao_p, nr_seq_guia_p, 'S'
												);
										end if;
									end if;
								end if;
							elsif (r_C01_w.cd_consistencia = '65') then
								if (coalesce(r_C06_w.ie_estadia_tumor::text, '') = '') then
									select	count(1)
									into STRICT	qt_prestador_w
									from	ptu_excecao_consistencia
									where	nr_seq_consist_envio = r_C01_w.nr_sequencia
									and	nr_seq_prestador = nr_seq_prestador_web_w;

									if (qt_prestador_w = 0) then
										if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
											insert	into	ptu_consist_transacao(
													nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
													nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
													nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
													nr_seq_requisicao, nr_seq_guia, ie_habilita
												)
											values (
													nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
													nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
													null, null, nr_seq_pedido_compl_p,
													nr_seq_requisicao_p, nr_seq_guia_p, 'S'
												);
										end if;
									end if;
								end if;
							elsif (r_C01_w.cd_consistencia = '66') then
								if (coalesce(r_C06_w.cd_finalidade_tratamento::text, '') = '') then
									select	count(1)
									into STRICT	qt_prestador_w
									from	ptu_excecao_consistencia
									where	nr_seq_consist_envio = r_C01_w.nr_sequencia
									and	nr_seq_prestador = nr_seq_prestador_web_w;

									if (qt_prestador_w = 0) then
										if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
											insert	into	ptu_consist_transacao(
													nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
													nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
													nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
													nr_seq_requisicao, nr_seq_guia, ie_habilita
												)
											values (
													nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
													nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
													null, null, nr_seq_pedido_compl_p,
													nr_seq_requisicao_p, nr_seq_guia_p, 'S'
												);
										end if;
									end if;
								end if;
							elsif (r_C01_w.cd_consistencia = '67') then
								if (coalesce(r_C06_w.ie_capacidade_funcional::text, '') = '') then
									select	count(1)
									into STRICT	qt_prestador_w
									from	ptu_excecao_consistencia
									where	nr_seq_consist_envio = r_C01_w.nr_sequencia
									and	nr_seq_prestador = nr_seq_prestador_web_w;

									if (qt_prestador_w = 0) then
										if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
											insert	into	ptu_consist_transacao(
													nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
													nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
													nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
													nr_seq_requisicao, nr_seq_guia, ie_habilita
												)
											values (
													nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
													nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
													null, null, nr_seq_pedido_compl_p,
													nr_seq_requisicao_p, nr_seq_guia_p, 'S'
												);
										end if;
									end if;
								end if;
							elsif (r_C01_w.cd_consistencia = '68') then
								if (coalesce(r_C06_w.ie_tipo_quimioterapia::text, '') = '') then
									select	count(1)
									into STRICT	qt_prestador_w
									from	ptu_excecao_consistencia
									where	nr_seq_consist_envio = r_C01_w.nr_sequencia
									and	nr_seq_prestador = nr_seq_prestador_web_w;

									if (qt_prestador_w = 0) then
										if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
											insert	into	ptu_consist_transacao(
													nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
													nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
													nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
													nr_seq_requisicao, nr_seq_guia, ie_habilita
												)
											values (
													nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
													nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
													null, null, nr_seq_pedido_compl_p,
													nr_seq_requisicao_p, nr_seq_guia_p, 'S'
												);
										end if;
									end if;
								end if;
							end if;
						end loop;
					else
						if (r_C01_w.cd_consistencia = '186') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					end if;
					if (r_C01_w.cd_consistencia = '69') then
						if (coalesce(r_C04_w.nr_ciclo_previsto::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					elsif (r_C01_w.cd_consistencia = '70') then
						if (coalesce(r_C04_w.nr_ciclo_atual::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					elsif (r_C01_w.cd_consistencia = '71') then
						if (coalesce(r_C04_w.qt_intervalo_ciclo::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					elsif (r_C01_w.cd_consistencia = '73') then
						if (coalesce(r_C04_w.nr_dia_ciclo_atual::text, '') = '') and (nr_versao_tiss_w in ('3.03.00','3.03.01','3.03.02')) then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					elsif (r_C01_w.cd_consistencia = '77') then
						if (coalesce(r_C04_w.nm_profissional_solic::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					elsif (r_C01_w.cd_consistencia = '78') then
						if (coalesce(r_C04_w.nr_telef_prof_solic::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					elsif (r_C01_w.cd_consistencia = '167') then
						if (coalesce(r_C04_w.dt_prevista::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					elsif (r_C01_w.cd_consistencia = '168') then
						if (coalesce(r_C04_w.qt_dosagem_total::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					elsif (r_C01_w.cd_consistencia = '169') then
						if (coalesce(r_C04_w.qt_unidade_medida::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					elsif (r_C01_w.cd_consistencia = '170') then
						if (coalesce(r_C04_w.ie_frequencia_dose::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					elsif (r_C01_w.cd_consistencia = '171') then
						if (coalesce(r_C04_w.ie_via_administracao::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					end if;
				end loop;
			elsif (r_C02_w.ie_tipo_anexo = 'RA') then
				for r_C05_w in C05( r_C02_w.nr_sequencia ) loop
					if (r_C01_w.cd_consistencia = '56') then
						if (coalesce(r_C05_w.qt_idade_benef::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					elsif (r_C01_w.cd_consistencia = '57') then
						if (coalesce(r_C05_w.ie_sexo::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					end if;

					qt_diagnostico_w := 0;

					select	count(1)
					into STRICT	qt_diagnostico_w
					from	pls_lote_anexo_diag_aut
					where	nr_seq_lote_anexo_guia 	= r_C02_w.nr_sequencia
					and	ie_tipo_diagnostico	= 'DT';

					if (qt_diagnostico_w > 0) then
						for r_C06_w in C06( r_C02_w.nr_sequencia ) loop
								if (r_C01_w.cd_consistencia = '79') then
									if (coalesce(r_C06_w.ie_estadia_tumor::text, '') = '') then
										select	count(1)
										into STRICT	qt_prestador_w
										from	ptu_excecao_consistencia
										where	nr_seq_consist_envio = r_C01_w.nr_sequencia
										and	nr_seq_prestador = nr_seq_prestador_web_w;

										if (qt_prestador_w = 0) then
											if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
												insert	into	ptu_consist_transacao(
														nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
														nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
														nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
														nr_seq_requisicao, nr_seq_guia, ie_habilita
													)
												values (
														nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
														nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
														null, null, nr_seq_pedido_compl_p,
														nr_seq_requisicao_p, nr_seq_guia_p, 'S'
													);
											end if;
										end if;
									end if;
								elsif (r_C01_w.cd_consistencia = '80') then
									if (coalesce(r_C06_w.cd_finalidade_tratamento::text, '') = '') then
										select	count(1)
										into STRICT	qt_prestador_w
										from	ptu_excecao_consistencia
										where	nr_seq_consist_envio = r_C01_w.nr_sequencia
										and	nr_seq_prestador = nr_seq_prestador_web_w;

										if (qt_prestador_w = 0) then
											if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
												insert	into	ptu_consist_transacao(
														nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
														nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
														nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
														nr_seq_requisicao, nr_seq_guia, ie_habilita
													)
												values (
														nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
														nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
														null, null, nr_seq_pedido_compl_p,
														nr_seq_requisicao_p, nr_seq_guia_p, 'S'
													);
											end if;
										end if;
									end if;
								elsif (r_C01_w.cd_consistencia = '81') then
									if (coalesce(r_C06_w.ie_capacidade_funcional::text, '') = '') then
										select	count(1)
										into STRICT	qt_prestador_w
										from	ptu_excecao_consistencia
										where	nr_seq_consist_envio = r_C01_w.nr_sequencia
										and	nr_seq_prestador = nr_seq_prestador_web_w;

										if (qt_prestador_w = 0) then
											if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
												insert	into	ptu_consist_transacao(
														nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
														nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
														nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
														nr_seq_requisicao, nr_seq_guia, ie_habilita
													)
												values (
														nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
														nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
														null, null, nr_seq_pedido_compl_p,
														nr_seq_requisicao_p, nr_seq_guia_p, 'S'
												);
											end if;
										end if;
									end if;
								end if;
						end loop;
					else
						if (r_C01_w.cd_consistencia = '190') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					end if;

					if (r_C01_w.cd_consistencia = '82') then
						if (coalesce(r_C05_w.nr_campos::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					elsif (r_C01_w.cd_consistencia = '83') then
						if (coalesce(r_C05_w.qt_dose_dia::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					elsif (r_C01_w.cd_consistencia = '84') then
						if (coalesce(r_C05_w.qt_dose_total::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					elsif (r_C01_w.cd_consistencia = '86') then
						if (coalesce(r_C05_w.qt_dias_previsto::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					elsif (r_C01_w.cd_consistencia = '85') then
						if (coalesce(r_C05_w.dt_inicio_previsto::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					elsif (r_C01_w.cd_consistencia = '87') then
						if (coalesce(r_C05_w.nm_profissional_solic::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					elsif (r_C01_w.cd_consistencia = '88') then
						if (coalesce(r_C05_w.nr_telef_prof_solic::text, '') = '') then
							select	count(1)
							into STRICT	qt_prestador_w
							from	ptu_excecao_consistencia
							where	nr_seq_consist_envio = r_C01_w.nr_sequencia
							and	nr_seq_prestador = nr_seq_prestador_web_w;

							if (qt_prestador_w = 0) then
								if (ie_origem_solic_w <> 'P') or (ie_origem_solic_w = 'P' AND r_C01_w.ie_bloqueia_portal = 'S') then
									insert	into	ptu_consist_transacao(
											nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
											nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
											nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
											nr_seq_requisicao, nr_seq_guia, ie_habilita
										)
									values (
											nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
											nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
											null, null, nr_seq_pedido_compl_p,
											nr_seq_requisicao_p, nr_seq_guia_p, 'S'
										);
								end if;
							end if;
						end if;
					end if;

				end loop;
			end if;
		end if;
	end loop;

	if (r_C01_w.cd_consistencia = '177')	then
		if (qt_opme_w > 0) and (qt_opme_w > qt_opme_ww) then
			insert	into	ptu_consist_transacao(
					nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
					nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
					nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
					nr_seq_requisicao, nr_seq_guia, ie_habilita
				)
			values (
					nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
					nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
					null, null, nr_seq_pedido_compl_p,
					nr_seq_requisicao_p, nr_seq_guia_p, 'S'
				);
		end if;
	elsif (r_C01_w.cd_consistencia = '180')	then
		if (qt_quimio_w > 0) and (qt_quimio_w > qt_quimio_ww) then
			insert	into	ptu_consist_transacao(
					nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
					nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
					nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
					nr_seq_requisicao, nr_seq_guia, ie_habilita
				)
			values (
					nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
					nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
					null, null, nr_seq_pedido_compl_p,
					nr_seq_requisicao_p, nr_seq_guia_p, 'S'
				);
		end if;
	elsif (r_C01_w.cd_consistencia = '183')	then
		if (qt_radio_w > 0) and (qt_radio_w > qt_radio_ww) then
			insert	into	ptu_consist_transacao(
					nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
					nm_usuario, nm_usuario_nrec, nr_seq_consist_envio,
					nr_seq_ordem_serv, nr_seq_pedido_aut, nr_seq_pedido_compl,
					nr_seq_requisicao, nr_seq_guia, ie_habilita
				)
			values (
					nextval('ptu_consist_transacao_seq'), clock_timestamp(), clock_timestamp(),
					nm_usuario_p, nm_usuario_p, r_C01_w.nr_sequencia,
					null, null, nr_seq_pedido_compl_p,
					nr_seq_requisicao_p, nr_seq_guia_p, 'S'
				);
		end if;
	end if;
end loop;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ptu_consistir_compl_pedido_aut ( nr_seq_requisicao_p bigint, nr_seq_guia_p bigint, nr_seq_pedido_compl_p bigint, nm_usuario_p text ) FROM PUBLIC;

