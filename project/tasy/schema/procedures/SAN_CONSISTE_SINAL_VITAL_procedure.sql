-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE san_consiste_sinal_vital ( ie_sinal_vital_p text, qt_quantidade_p bigint, ds_mensagem_p INOUT text, ie_inconsistencia_p INOUT text, qt_dias_inaptidao_p INOUT bigint) AS $body$
DECLARE


qt_minima_w		double precision;
qt_maxima_w		double precision;
qt_permitido_w		double precision;
ds_mensagem_w		varchar(255);
ie_consiste_w		varchar(1) := 'N';
ds_maior_menor_w	varchar(15);
qt_dias_inaptidao_w	san_regra_sinal_vital.qt_dias_inapto%type;

/*
PS - PA Sistólica
PD - PA Diastólica
P - Pulso
T - Temperatura
V - Volume
*/
BEGIN

if (ie_sinal_vital_p IS NOT NULL AND ie_sinal_vital_p::text <> '') then
	select	coalesce(max(qt_minimo),0),
		coalesce(max(qt_maximo),9999),
		coalesce(max(qt_dias_inapto), 0)
	into STRICT 	qt_minima_w,
		qt_maxima_w,
		qt_dias_inaptidao_w
	from   	san_regra_sinal_vital
	where 	ie_sinal_vital = ie_sinal_vital_p
	and	ie_situacao = 'A';

	if (qt_quantidade_p < qt_minima_w) or (qt_quantidade_p > qt_maxima_w) then
		ie_consiste_w := 'S';
		qt_dias_inaptidao_p := qt_dias_inaptidao_w;

		if (qt_quantidade_p < qt_minima_w) then
			select	lower(obter_desc_expressao_idioma(489589,null,philips_param_pck.get_nr_seq_idioma))
			into STRICT	ds_maior_menor_w
			;

			qt_permitido_w := qt_minima_w;
		else
			select	lower(obter_desc_expressao_idioma(489590,null,philips_param_pck.get_nr_seq_idioma))
			into STRICT	ds_maior_menor_w
			;

			qt_permitido_w := qt_maxima_w;
		end if;

		if (ie_sinal_vital_p = 'PS') then
			ds_mensagem_w := obter_texto_dic_objeto(669747, philips_param_pck.get_nr_seq_idioma, 'MAIORMENOR=' || ds_maior_menor_w || ';VALORPERMITIDO=' || qt_permitido_w);
		elsif (ie_sinal_vital_p = 'PD') then
			ds_mensagem_w := obter_texto_dic_objeto(669750, philips_param_pck.get_nr_seq_idioma, 'MAIORMENOR=' || ds_maior_menor_w || ';VALORPERMITIDO=' || qt_permitido_w);
		elsif (ie_sinal_vital_p = 'P') then
			ds_mensagem_w := obter_texto_dic_objeto(669751, philips_param_pck.get_nr_seq_idioma, 'MAIORMENOR=' || ds_maior_menor_w || ';VALORPERMITIDO=' || qt_permitido_w);
		elsif (ie_sinal_vital_p = 'T') then
			ds_mensagem_w := obter_texto_dic_objeto(669752, philips_param_pck.get_nr_seq_idioma, 'MAIORMENOR=' || ds_maior_menor_w || ';VALORPERMITIDO=' || qt_permitido_w);
		elsif (ie_sinal_vital_p = 'V') then
			ds_mensagem_w := obter_texto_dic_objeto(669758, philips_param_pck.get_nr_seq_idioma, 'MAIORMENOR=' || ds_maior_menor_w || ';VALORPERMITIDO=' || qt_permitido_w);
		elsif (ie_sinal_vital_p = 'F') then
			ds_mensagem_w := obter_texto_dic_objeto(669759, philips_param_pck.get_nr_seq_idioma, 'MAIORMENOR=' || ds_maior_menor_w || ';VALORPERMITIDO=' || qt_permitido_w);
		end if;

	end if;

end if;

commit;

ds_mensagem_p := ds_mensagem_w;
ie_inconsistencia_p := ie_consiste_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE san_consiste_sinal_vital ( ie_sinal_vital_p text, qt_quantidade_p bigint, ds_mensagem_p INOUT text, ie_inconsistencia_p INOUT text, qt_dias_inaptidao_p INOUT bigint) FROM PUBLIC;

