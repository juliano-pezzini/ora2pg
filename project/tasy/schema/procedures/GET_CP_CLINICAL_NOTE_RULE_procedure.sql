-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE get_cp_clinical_note_rule (nm_usuario_p text, cd_perfil_p bigint, cd_estabelecimento_p bigint, si_physical_exam_p INOUT text, si_prof_diagnose_p INOUT text, si_care_plan_p INOUT text, si_patient_progress_p INOUT text, si_clinical_goal_p INOUT text, si_education_goal_p INOUT text) AS $body$
DECLARE

								
cd_empresa_w	empresa.cd_empresa%type;

c_rule CURSOR FOR
	SELECT	a.*
	from	cp_clinical_note_rule a
	where	a.cd_empresa = cd_empresa_w
	and (a.cd_estabelecimento = cd_estabelecimento_p or coalesce(a.cd_estabelecimento::text, '') = '')
	and (a.cd_perfil_rule = cd_perfil_p or coalesce(a.cd_perfil_rule::text, '') = '')
	and (a.nm_usuario_rule = nm_usuario_p or coalesce(a.nm_usuario_rule::text, '') = '')
	order by
			CASE WHEN coalesce(a.cd_estabelecimento::text, '') = '' THEN 0  ELSE 1 END ,
			CASE WHEN coalesce(a.cd_perfil_rule::text, '') = '' THEN 0  ELSE 1 END ,
			CASE WHEN coalesce(nm_usuario_rule::text, '') = '' THEN 0  ELSE 1 END;

BEGIN

if (cd_estabelecimento_p IS NOT NULL AND cd_estabelecimento_p::text <> '') then
	select	a.cd_empresa
	into STRICT	cd_empresa_w
	from	estabelecimento a
	where	a.cd_estabelecimento = cd_estabelecimento_p;
	
	for r_c_rule in c_rule loop
		si_physical_exam_p	:= r_c_rule.si_physical_exam;
		si_prof_diagnose_p	:= r_c_rule.si_prof_diagnose;
		si_care_plan_p		:= r_c_rule.si_care_plan;
		si_patient_progress_p	:= r_c_rule.si_patient_progress;
		si_clinical_goal_p	                := r_c_rule.si_clinical_goal;
		si_education_goal_p	:= r_c_rule.si_education_goal;
	end loop;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE get_cp_clinical_note_rule (nm_usuario_p text, cd_perfil_p bigint, cd_estabelecimento_p bigint, si_physical_exam_p INOUT text, si_prof_diagnose_p INOUT text, si_care_plan_p INOUT text, si_patient_progress_p INOUT text, si_clinical_goal_p INOUT text, si_education_goal_p INOUT text) FROM PUBLIC;

