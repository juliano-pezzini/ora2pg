-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_obter_regra_tit_pag_evento ( nr_titulo_p bigint, dt_competencia_p timestamp, ie_inclui_evento_p INOUT text, nr_seq_evento_p INOUT bigint, nr_seq_prestador_p INOUT bigint, cd_centro_custo_p INOUT centro_custo.cd_centro_custo%type) AS $body$
DECLARE


cd_cgc_w			varchar(14);
cd_pessoa_fisica_w		varchar(10);
ie_origem_titulo_w		varchar(10);
ie_tipo_titulo_w		varchar(2);
nr_seq_trans_fin_contab_w	bigint;
nr_seq_classe_w			bigint;

C01 CURSOR FOR
	SELECT	a.ie_inclui_evento,
		a.nr_seq_evento,
		a.nr_seq_prestador_dest,
		a.cd_centro_custo
	from	pls_evento_regra_tit_pagar a
	where	(((cd_cgc_w IS NOT NULL AND cd_cgc_w::text <> '') and (a.ie_tipo_pessoa in ('A','J')) and ((coalesce(a.cd_cgc::text, '') = '') or (a.cd_cgc = cd_cgc_w))) or
		((cd_pessoa_fisica_w IS NOT NULL AND cd_pessoa_fisica_w::text <> '') and (a.ie_tipo_pessoa in ('A','F')) and ((coalesce(a.cd_pessoa_fisica::text, '') = '') or (a.cd_pessoa_fisica = cd_pessoa_fisica_w))))
	and	((a.nr_seq_trans_fin_contab 	= nr_seq_trans_fin_contab_w) 	or (coalesce(a.nr_seq_trans_fin_contab::text, '') = ''))
	and	((a.ie_tipo_titulo 		= ie_tipo_titulo_w) 		or (coalesce(a.ie_tipo_titulo::text, '') = ''))
	and	((a.ie_origem_titulo 		= ie_origem_titulo_w) 		or (coalesce(a.ie_origem_titulo::text, '') = ''))
	and	((a.nr_seq_classe_tit_pagar 	= nr_seq_classe_w) 		or (coalesce(a.nr_seq_classe_tit_pagar::text, '') = ''))
	and	dt_competencia_p between trunc(coalesce(a.dt_inicio_vigencia,dt_competencia_p),'dd') and fim_dia(coalesce(a.dt_fim_vigencia,dt_competencia_p))
	order by CASE WHEN coalesce(cd_pessoa_fisica_w::text, '') = '' THEN a.cd_pessoa_fisica  ELSE a.cd_cgc END;


BEGIN
select	a.cd_pessoa_fisica,
	a.cd_cgc,
	a.nr_seq_trans_fin_contab,
	a.ie_tipo_titulo,
	a.ie_origem_titulo,
	a.nr_seq_classe
into STRICT	cd_pessoa_fisica_w,
	cd_cgc_w,
	nr_seq_trans_fin_contab_w,
	ie_tipo_titulo_w,
	ie_origem_titulo_w,
	nr_seq_classe_w
from	titulo_pagar a
where 	a.nr_titulo	= nr_titulo_p;

open C01;
loop
fetch C01 into
	ie_inclui_evento_p,
	nr_seq_evento_p,
	nr_seq_prestador_p,
	cd_centro_custo_p;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin
	null;
	end;
end loop;
close C01;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_obter_regra_tit_pag_evento ( nr_titulo_p bigint, dt_competencia_p timestamp, ie_inclui_evento_p INOUT text, nr_seq_evento_p INOUT bigint, nr_seq_prestador_p INOUT bigint, cd_centro_custo_p INOUT centro_custo.cd_centro_custo%type) FROM PUBLIC;

