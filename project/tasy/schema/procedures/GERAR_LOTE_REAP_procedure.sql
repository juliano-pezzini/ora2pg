-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_lote_reap ( nr_sequencia_p bigint, nm_usuario_p text, ds_mensagem_p INOUT text, nr_seq_lote_reap_p INOUT bigint) AS $body$
DECLARE

 
nr_sequencia_w		bigint;


BEGIN 
 
ds_mensagem_p := '';
 
delete	from tiss_reap_lote 
where	nr_seq_lote_audit = nr_sequencia_p;
 
commit;
 
CALL tiss_gerar_lote_reapresentacao(null, nr_sequencia_p, nm_usuario_p);
 
select	max(nr_sequencia) 
into STRICT	nr_sequencia_w 
from	tiss_reap_lote 
where	nr_seq_lote_audit = nr_sequencia_p;
 
if (coalesce(nr_sequencia_w,0) > 0) then 
 
	ds_mensagem_p := obter_texto_dic_objeto(171608, wheb_usuario_pck.get_nr_seq_idioma, null);
	 
	CALL tiss_fechar_lote_reap(nr_sequencia_p, nm_usuario_p);
	 
	CALL tiss_gerar_reap(nr_sequencia_p, nm_usuario_p);
	 
end if;
 
nr_seq_lote_reap_p := nr_sequencia_w;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_lote_reap ( nr_sequencia_p bigint, nm_usuario_p text, ds_mensagem_p INOUT text, nr_seq_lote_reap_p INOUT bigint) FROM PUBLIC;

