-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE updt_cpoe_cmt_link ( NR_SEQ_CPOE_MATERIAL_P cpoe_comment_linkage.nr_seq_cpoe_material_tmp%type default null, NR_SEQ_CPOE_PROCED_P cpoe_comment_linkage.nr_seq_cpoe_proced_tmp%type default null, NR_SEQ_CPOE_NUTRICAO_P cpoe_comment_linkage.nr_seq_cpoe_nutricao_tmp%type default null, NR_SEQ_CPOE_RECOMEND_P cpoe_comment_linkage.nr_seq_cpoe_recomend_tmp%type default null, NR_SEQ_CPOE_DIALISE_P cpoe_comment_linkage.nr_seq_cpoe_dialise_tmp%type default null, NR_SEQ_CPOE_ANAT_PAT_P cpoe_comment_linkage.nr_seq_cpoe_anat_pat_tmp%type default null, NR_SEQ_CPOE_GASOTERAPIA_P cpoe_comment_linkage.nr_seq_cpoe_gasoterapia_tmp%type default null, NR_SEQ_CPOE_HEMOTERAPIA_P cpoe_comment_linkage.nr_seq_cpoe_hemoterapia_tmp%type default null, NR_SEQ_CPOE_JUST_ITEM_P cpoe_comment_linkage.nr_seq_cpoe_just_item_tmp%type default null, si_validation_type_p text default null, NR_SEQ_CPOE_JUST_INTER_P cpoe_comment_linkage.NR_SEQ_CPOE_JUST_INTER_TMP%type default null, NR_SEQ_CPOE_ORDER_UNIT_P cpoe_comment_linkage.NR_SEQ_CPOE_ORDER_UNIT_TMP%TYPE default null, NR_SEQ_CPOE_RP_P cpoe_comment_linkage.NR_SEQ_CPOE_RP_TMP%TYPE default null) AS $body$
DECLARE


	nr_seq_cpoe_justification_w		bigint;

	c_nr_seq_cmt CURSOR FOR
	SELECT nr_seq_std_comment from cpoe_comment_linkage where nr_seq_cpoe_material_tmp = NR_SEQ_CPOE_MATERIAL_P
	
union all

	SELECT nr_seq_std_comment from cpoe_comment_linkage where nr_seq_cpoe_proced_tmp = NR_SEQ_CPOE_PROCED_P
	
union all

	select nr_seq_std_comment from cpoe_comment_linkage where nr_seq_cpoe_nutricao_tmp = NR_SEQ_CPOE_NUTRICAO_P
	
union all

	select nr_seq_std_comment from cpoe_comment_linkage where nr_seq_cpoe_recomend_tmp = NR_SEQ_CPOE_RECOMEND_P
	
union all

	select nr_seq_std_comment from cpoe_comment_linkage where nr_seq_cpoe_dialise_tmp = NR_SEQ_CPOE_DIALISE_P
	
union all

	select nr_seq_std_comment from cpoe_comment_linkage where nr_seq_cpoe_anat_pat_tmp = NR_SEQ_CPOE_ANAT_PAT_P
	
union all

	select nr_seq_std_comment from cpoe_comment_linkage where nr_seq_cpoe_gasoterapia_tmp = NR_SEQ_CPOE_GASOTERAPIA_P
	
union all

	select nr_seq_std_comment from cpoe_comment_linkage where nr_seq_cpoe_hemoterapia_tmp = NR_SEQ_CPOE_HEMOTERAPIA_P
	
union all

	select nr_seq_std_comment from cpoe_comment_linkage where nr_seq_cpoe_just_item_tmp = NR_SEQ_CPOE_JUST_ITEM_P and si_validation_type = si_validation_type_p
	
union all

	select nr_seq_std_comment from cpoe_comment_linkage where NR_SEQ_CPOE_JUST_INTER_TMP = NR_SEQ_CPOE_JUST_INTER_P
	
union all

	select nr_seq_std_comment from cpoe_comment_linkage where NR_SEQ_CPOE_ORDER_UNIT_TMP = NR_SEQ_CPOE_ORDER_UNIT_P
	
union all

	select nr_seq_std_comment from cpoe_comment_linkage where NR_SEQ_CPOE_RP_TMP = NR_SEQ_CPOE_RP_P;

BEGIN
	for r_c_nr_seq_cmt in c_nr_seq_cmt loop
	if (NR_SEQ_CPOE_MATERIAL_P IS NOT NULL AND NR_SEQ_CPOE_MATERIAL_P::text <> '') then
		update cpoe_comment_linkage set nr_seq_cpoe_material = NR_SEQ_CPOE_MATERIAL_P , nr_seq_cpoe_material_tmp  = NULL
		where nr_seq_cpoe_material_tmp = NR_SEQ_CPOE_MATERIAL_P and nr_seq_std_comment = r_c_nr_seq_cmt.nr_seq_std_comment and coalesce(si_validation_type::text, '') = '';

		select 	max(nr_sequencia)
		into STRICT 	nr_seq_cpoe_justification_w 
		from 	cpoe_justificativa_item
		where 	NR_SEQ_MATERIAL = NR_SEQ_CPOE_MATERIAL_P;

		if (nr_seq_cpoe_justification_w IS NOT NULL AND nr_seq_cpoe_justification_w::text <> '') then
			update cpoe_comment_linkage set nr_seq_cpoe_just_item = nr_seq_cpoe_justification_w , nr_seq_cpoe_material_tmp  = NULL
			where  nr_seq_cpoe_material_tmp = NR_SEQ_CPOE_MATERIAL_P and nr_seq_std_comment = r_c_nr_seq_cmt.nr_seq_std_comment and (si_validation_type IS NOT NULL AND si_validation_type::text <> '');
		end if;
	end if;
	if (NR_SEQ_CPOE_PROCED_P IS NOT NULL AND NR_SEQ_CPOE_PROCED_P::text <> '') then
		update cpoe_comment_linkage set nr_seq_cpoe_proced = NR_SEQ_CPOE_PROCED_P , nr_seq_cpoe_proced_tmp  = NULL
		where nr_seq_cpoe_proced_tmp = NR_SEQ_CPOE_PROCED_P and nr_seq_std_comment = r_c_nr_seq_cmt.nr_seq_std_comment;
	end if;
	if (NR_SEQ_CPOE_NUTRICAO_P IS NOT NULL AND NR_SEQ_CPOE_NUTRICAO_P::text <> '') then
		update cpoe_comment_linkage set nr_seq_cpoe_nutricao = NR_SEQ_CPOE_NUTRICAO_P , nr_seq_cpoe_nutricao_tmp  = NULL
		where nr_seq_cpoe_nutricao_tmp = NR_SEQ_CPOE_NUTRICAO_P and nr_seq_std_comment = r_c_nr_seq_cmt.nr_seq_std_comment;
	end if;
	if (NR_SEQ_CPOE_RECOMEND_P IS NOT NULL AND NR_SEQ_CPOE_RECOMEND_P::text <> '') then
		update cpoe_comment_linkage set nr_seq_cpoe_recomend = NR_SEQ_CPOE_RECOMEND_P , nr_seq_cpoe_recomend_tmp  = NULL
		where nr_seq_cpoe_recomend_tmp = NR_SEQ_CPOE_RECOMEND_P and nr_seq_std_comment = r_c_nr_seq_cmt.nr_seq_std_comment;
	end if;
	if (NR_SEQ_CPOE_DIALISE_P IS NOT NULL AND NR_SEQ_CPOE_DIALISE_P::text <> '') then
		update cpoe_comment_linkage set nr_seq_cpoe_dialise = NR_SEQ_CPOE_DIALISE_P , nr_seq_cpoe_dialise_tmp  = NULL
		where nr_seq_cpoe_dialise_tmp = NR_SEQ_CPOE_DIALISE_P and nr_seq_std_comment = r_c_nr_seq_cmt.nr_seq_std_comment;
	end if;
	if (NR_SEQ_CPOE_ANAT_PAT_P IS NOT NULL AND NR_SEQ_CPOE_ANAT_PAT_P::text <> '') then
		update cpoe_comment_linkage set nr_seq_cpoe_anat_pat = NR_SEQ_CPOE_ANAT_PAT_P , nr_seq_cpoe_anat_pat_tmp  = NULL
		where nr_seq_cpoe_anat_pat_tmp = NR_SEQ_CPOE_ANAT_PAT_P and nr_seq_std_comment = r_c_nr_seq_cmt.nr_seq_std_comment;
	end if;
	if (NR_SEQ_CPOE_GASOTERAPIA_P IS NOT NULL AND NR_SEQ_CPOE_GASOTERAPIA_P::text <> '') then
		update cpoe_comment_linkage set nr_seq_cpoe_gasoterapia = NR_SEQ_CPOE_GASOTERAPIA_P , nr_seq_cpoe_gasoterapia_tmp  = NULL
		where nr_seq_cpoe_gasoterapia_tmp = NR_SEQ_CPOE_GASOTERAPIA_P and nr_seq_std_comment = r_c_nr_seq_cmt.nr_seq_std_comment;
	end if;
	if (NR_SEQ_CPOE_HEMOTERAPIA_P IS NOT NULL AND NR_SEQ_CPOE_HEMOTERAPIA_P::text <> '') then
		update cpoe_comment_linkage set nr_seq_cpoe_hemoterapia = NR_SEQ_CPOE_HEMOTERAPIA_P , nr_seq_cpoe_hemoterapia_tmp  = NULL
		where nr_seq_cpoe_hemoterapia_tmp = NR_SEQ_CPOE_HEMOTERAPIA_P and nr_seq_std_comment = r_c_nr_seq_cmt.nr_seq_std_comment;
	end if;
	if (NR_SEQ_CPOE_JUST_ITEM_P IS NOT NULL AND NR_SEQ_CPOE_JUST_ITEM_P::text <> '')then
		update cpoe_comment_linkage set nr_seq_cpoe_just_item = NR_SEQ_CPOE_JUST_ITEM_P , nr_seq_cpoe_just_item_tmp  = NULL
		where nr_seq_cpoe_just_item_tmp = NR_SEQ_CPOE_JUST_ITEM_P and nr_seq_std_comment = r_c_nr_seq_cmt.nr_seq_std_comment;
	end if;
	if (NR_SEQ_CPOE_JUST_INTER_P IS NOT NULL AND NR_SEQ_CPOE_JUST_INTER_P::text <> '')then
		update cpoe_comment_linkage set NR_SEQ_CPOE_JUST_INTER = NR_SEQ_CPOE_JUST_INTER_P , NR_SEQ_CPOE_JUST_INTER_TMP  = NULL
		where NR_SEQ_CPOE_JUST_INTER_TMP = NR_SEQ_CPOE_JUST_INTER_P and nr_seq_std_comment = r_c_nr_seq_cmt.nr_seq_std_comment;
	end if;
	if (NR_SEQ_CPOE_ORDER_UNIT_P IS NOT NULL AND NR_SEQ_CPOE_ORDER_UNIT_P::text <> '')then
		update cpoe_comment_linkage set NR_SEQ_CPOE_ORDER_UNIT = NR_SEQ_CPOE_ORDER_UNIT_P , NR_SEQ_CPOE_ORDER_UNIT_TMP  = NULL
		where NR_SEQ_CPOE_ORDER_UNIT_TMP = NR_SEQ_CPOE_ORDER_UNIT_P and nr_seq_std_comment = r_c_nr_seq_cmt.nr_seq_std_comment;
	end if;
	if (NR_SEQ_CPOE_RP_P IS NOT NULL AND NR_SEQ_CPOE_RP_P::text <> '')then
		update cpoe_comment_linkage set NR_SEQ_CPOE_RP = NR_SEQ_CPOE_RP_P , NR_SEQ_CPOE_RP_TMP  = NULL
		where NR_SEQ_CPOE_RP_TMP = NR_SEQ_CPOE_RP_P and nr_seq_std_comment = r_c_nr_seq_cmt.nr_seq_std_comment;
	end if;
end loop;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE updt_cpoe_cmt_link ( NR_SEQ_CPOE_MATERIAL_P cpoe_comment_linkage.nr_seq_cpoe_material_tmp%type default null, NR_SEQ_CPOE_PROCED_P cpoe_comment_linkage.nr_seq_cpoe_proced_tmp%type default null, NR_SEQ_CPOE_NUTRICAO_P cpoe_comment_linkage.nr_seq_cpoe_nutricao_tmp%type default null, NR_SEQ_CPOE_RECOMEND_P cpoe_comment_linkage.nr_seq_cpoe_recomend_tmp%type default null, NR_SEQ_CPOE_DIALISE_P cpoe_comment_linkage.nr_seq_cpoe_dialise_tmp%type default null, NR_SEQ_CPOE_ANAT_PAT_P cpoe_comment_linkage.nr_seq_cpoe_anat_pat_tmp%type default null, NR_SEQ_CPOE_GASOTERAPIA_P cpoe_comment_linkage.nr_seq_cpoe_gasoterapia_tmp%type default null, NR_SEQ_CPOE_HEMOTERAPIA_P cpoe_comment_linkage.nr_seq_cpoe_hemoterapia_tmp%type default null, NR_SEQ_CPOE_JUST_ITEM_P cpoe_comment_linkage.nr_seq_cpoe_just_item_tmp%type default null, si_validation_type_p text default null, NR_SEQ_CPOE_JUST_INTER_P cpoe_comment_linkage.NR_SEQ_CPOE_JUST_INTER_TMP%type default null, NR_SEQ_CPOE_ORDER_UNIT_P cpoe_comment_linkage.NR_SEQ_CPOE_ORDER_UNIT_TMP%TYPE default null, NR_SEQ_CPOE_RP_P cpoe_comment_linkage.NR_SEQ_CPOE_RP_TMP%TYPE default null) FROM PUBLIC;

