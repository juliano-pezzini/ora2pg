-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE resend_integration_call ( nm_usuario_p integration_call_log.nm_usuario%type , nr_seq_int_call_log_p integration_call_log.nr_sequencia%type ) AS $body$
DECLARE


ds_resend_script_w			integration_call_log.ds_resend_script%type;
nr_job_w 					bigint;


BEGIN

	if (nr_seq_int_call_log_p IS NOT NULL AND nr_seq_int_call_log_p::text <> '')	then
	
			select	ds_resend_script
			into STRICT	ds_resend_script_w
			from	integration_call_log
			where	nr_sequencia = nr_seq_int_call_log_p;
			
			if (ds_resend_script_w IS NOT NULL AND ds_resend_script_w::text <> '')	then
				
				-- replace params with actual value
				ds_resend_script_w := replace(ds_resend_script_w, ':nr_seq_int_call_log', nr_seq_int_call_log_p);
				ds_resend_script_w := replace(ds_resend_script_w, ':nm_exec_user', nm_usuario_p);
				
				-- execute the resend script in a new job
				dbms_job.submit(nr_job_w, ds_resend_script_w);
				
				-- update the status of call log as 'Processing'
				update	integration_call_log
				set		nm_usuario = nm_usuario_p, 
						dt_atualizacao = clock_timestamp(),
						ie_status = 'P'
				where	nr_sequencia = nr_seq_int_call_log_p;
				
				commit;

			end if;
		
	end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE resend_integration_call ( nm_usuario_p integration_call_log.nm_usuario%type , nr_seq_int_call_log_p integration_call_log.nr_sequencia%type ) FROM PUBLIC;

