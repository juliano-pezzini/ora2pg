-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE agenda_pac_ped_kit_before_post ( nr_seq_pedido_p bigint, nr_seq_agenda_p bigint, cd_kit_material_p bigint, nm_usuario_p text) AS $body$
DECLARE

nr_seq_kit_estoque_w	bigint;
dt_liberacao_w		timestamp;

BEGIN
if (nr_seq_agenda_p IS NOT NULL AND nr_seq_agenda_p::text <> '') and (nr_seq_pedido_p IS NOT NULL AND nr_seq_pedido_p::text <> '') and (cd_kit_material_p IS NOT NULL AND cd_kit_material_p::text <> '') then
	begin
	select	nr_sequencia
	into STRICT	nr_seq_kit_estoque_w
	from	kit_estoque_reg
	where	nr_seq_pedido_agenda = nr_seq_pedido_p;
	if (nr_seq_kit_estoque_w IS NOT NULL AND nr_seq_kit_estoque_w::text <> '') then
		begin
		select	dt_liberacao
		into STRICT	dt_liberacao_w
		from	kit_estoque_reg
		where	nr_seq_pedido_agenda = nr_seq_pedido_p;
		if (coalesce(dt_liberacao_w::text, '') = '') then
			begin
			CALL gerar_kit_estoque_adic_ped(
					wheb_usuario_pck.get_cd_estabelecimento,
					nm_usuario_p,
					cd_kit_material_p,
					nr_seq_agenda_p);
			end;
		end if;
		end;
	end if;
	end;
end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE agenda_pac_ped_kit_before_post ( nr_seq_pedido_p bigint, nr_seq_agenda_p bigint, cd_kit_material_p bigint, nm_usuario_p text) FROM PUBLIC;

