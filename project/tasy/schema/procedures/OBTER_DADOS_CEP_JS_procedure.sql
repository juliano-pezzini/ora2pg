-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_dados_cep_js ( cd_cep_p text, nm_usuario_p text, ie_cep_internet_p text, ds_uf_p INOUT text, ds_bairro_p INOUT text, ds_tipo_log_p INOUT text, nm_logradouro_p INOUT text, nm_localidade_p INOUT text) AS $body$
DECLARE

ds_tipo_log_w		varchar(125);
nm_logradouro_w		varchar(125);
nm_localidade_w		varchar(60);
ds_bairro_w		varchar(80);
ds_uf_w			valor_dominio.vl_dominio%type;
ie_registro_w		varchar(1);

BEGIN
if (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') then
	begin
	select	CASE WHEN count(*)=0 THEN 'N'  ELSE 'S' END
	into STRICT	ie_registro_w
	from	cep_logradouro_v
	where	cd_cep = cd_cep_p;
	if (ie_registro_w = 'S') then
		begin
		select	ds_tipo_logradouro
		into STRICT	ds_tipo_log_w
		from	cep_logradouro_v
		where	cd_cep = cd_cep_p;
		end;
	end if;

	if (ie_cep_internet_p = 'N') then
		begin
		select	CASE WHEN count(*)=0 THEN 'N'  ELSE 'S' END
		into STRICT	ie_registro_w
		from	cep_logradouro a
		where	a.cd_logradouro = cd_cep_p;
		if (ie_registro_w = 'S') then
			begin
			select	a.nm_logradouro,
				a.nm_localidade,
				a.nm_bairro,
				a.cd_unidade_federacao
			into STRICT	nm_logradouro_w,
				nm_localidade_w,
				ds_bairro_w,
				ds_uf_w
			from	cep_logradouro a
			where	a.cd_logradouro = cd_cep_p;
			end;
		end if;
		end;
	else
		begin
		select	CASE WHEN count(*)=0 THEN 'N'  ELSE 'S' END
		into STRICT	ie_registro_w
		from	cep_loc b,
			cep_bairro c,
			cep_log a
		where	b.nr_sequencia		= c.nr_seq_loc
		and	a.cd_bairro_inicial	= c.nr_sequencia
		and	b.nr_sequencia		= a.nr_seq_loc
		and	a.cd_cep		= cd_cep_p;

		if (ie_registro_w = 'N') then
			begin
			select	CASE WHEN count(*)=0 THEN 'N'  ELSE 'S' END
			into STRICT	ie_registro_w
			from	cep_loc b
			where	b.cd_cep = cd_cep_p;
			if (ie_registro_w = 'S') then
				begin
				select	b.nm_localidade,
					b.ds_uf
				into STRICT	nm_localidade_w,
					ds_uf_w
				from	cep_loc b
				where	b.cd_cep = cd_cep_p;
				end;
			end if;
			end;
		else
			begin
			select	a.nm_logradouro,
				b.nm_localidade,
				c.ds_bairro,
				a.ds_uf
			into STRICT	nm_logradouro_w,
				nm_localidade_w,
				ds_bairro_w,
				ds_uf_w
			from	cep_loc b,
				cep_bairro c,
				cep_log a
			where	b.nr_sequencia		= c.nr_seq_loc
			and	a.cd_bairro_inicial	= c.nr_sequencia
			and	b.nr_sequencia		= a.nr_seq_loc
			and	a.cd_cep		= cd_cep_p;
			end;
		end if;
		end;
	end if;
	end;
end if;
commit;
ds_tipo_log_p	:= ds_tipo_log_w;
nm_logradouro_p	:= nm_logradouro_w;
nm_localidade_p	:= nm_localidade_w;
ds_bairro_p	:= ds_bairro_w;
ds_uf_p		:= ds_uf_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_dados_cep_js ( cd_cep_p text, nm_usuario_p text, ie_cep_internet_p text, ds_uf_p INOUT text, ds_bairro_p INOUT text, ds_tipo_log_p INOUT text, nm_logradouro_p INOUT text, nm_localidade_p INOUT text) FROM PUBLIC;

