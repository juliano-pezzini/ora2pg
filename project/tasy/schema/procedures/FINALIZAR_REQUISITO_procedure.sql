-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE finalizar_requisito (nr_sequencia_p LATAM_REQUISITO.NR_SEQUENCIA%type) AS $body$
DECLARE


ie_tipo_anexo_prd_w     LATAM_ANEXO_REQUISITO.IE_TIPO_ANEXO%type;
ie_tipo_anexo_dld_w     LATAM_ANEXO_REQUISITO.IE_TIPO_ANEXO%type;
ie_liberar_desenv_old_w LATAM_REQUISITO.IE_LIBERAR_DESENV%type;

BEGIN
    SELECT MAX(b.IE_TIPO_ANEXO),
           MAX(a.IE_LIBERAR_DESENV)
    INTO STRICT   ie_tipo_anexo_prd_w,
           ie_liberar_desenv_old_w
    FROM   LATAM_REQUISITO a,
           LATAM_ANEXO_REQUISITO b
    WHERE  a.NR_SEQUENCIA = b.NR_SEQ_REQUISITO
    AND    b.IE_TIPO_ANEXO = 'PRD'
    AND    a.NR_SEQUENCIA = nr_sequencia_p;

    SELECT MAX(b.IE_TIPO_ANEXO)
    INTO STRICT   ie_tipo_anexo_dld_w
    FROM   LATAM_REQUISITO a,
           LATAM_ANEXO_REQUISITO b
    WHERE  a.NR_SEQUENCIA = b.NR_SEQ_REQUISITO
    AND    b.IE_TIPO_ANEXO = 'DLD'
    AND    a.NR_SEQUENCIA = nr_sequencia_p;

    IF (ie_tipo_anexo_prd_w = 'PRD' AND ie_tipo_anexo_dld_w = 'DLD') THEN        
        UPDATE LATAM_REQUISITO 
        SET    IE_LIBERAR_DESENV = 'I'
        WHERE  NR_SEQUENCIA = nr_sequencia_p;

        CALL generate_latam_log(nr_sequencia_p, ie_liberar_desenv_old_w, 1060016);
        COMMIT;
    ELSE
        CALL wheb_mensagem_pck.exibir_mensagem_abort(obter_desc_expressao(1060018));
    END IF;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE finalizar_requisito (nr_sequencia_p LATAM_REQUISITO.NR_SEQUENCIA%type) FROM PUBLIC;

