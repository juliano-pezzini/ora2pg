-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_gabarito_pacote ( nr_seq_pac_acomod_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_seq_pac_acomod_w		bigint;
nr_seq_regra_w			bigint;

nr_seq_pacote_w			bigint;
ie_inclui_exclui_w		varchar(01);
ie_excedente_w			smallint;
cd_grupo_material_w		smallint;
cd_subgrupo_material_w		smallint;
cd_classe_material_w		integer;
cd_material_w			integer;
qt_limite_w			double precision;
ie_tipo_atendimento_w		smallint;
cd_setor_atendimento_w		integer;
cd_area_proced_w		bigint;
cd_especial_proced_w		bigint;
cd_grupo_proced_w		bigint;
cd_procedimento_w		bigint;
ie_origem_proced_w		bigint;
ie_considera_honorario_w	varchar(01);
ie_calcula_honorario_w		varchar(01);
ie_calcula_custo_oper_w		varchar(01);
ie_valor_w			varchar(01);
vl_minimo_w			double precision;
vl_maximo_w			double precision;
pr_desconto_w			double precision;
ie_tipo_setor_w			varchar(3);
cd_centro_custo_w		integer;
ie_ratear_item_w		varchar(1);
vl_negociado_w			double precision;
nr_seq_classif_w		bigint;			
nr_seq_estrutura_w		bigint;
cd_local_estoque_w              pacote_material.cd_local_estoque%type;
nr_seq_estrutura_proc_w		pacote_procedimento.nr_seq_estrutura%type;
qt_idade_min_w                  pacote_procedimento.qt_idade_min%type;
qt_idade_max_w                  pacote_procedimento.qt_idade_max%type;
vl_maximo_proc_w                pacote_procedimento.vl_maximo%type;
vl_minimo_proc_w                pacote_procedimento.vl_minimo%type;
ie_tipo_valor_w                 pacote_procedimento.ie_tipo_valor%type;
nr_seq_proc_interno_w           pacote_procedimento.nr_seq_proc_interno%type;
pr_desc_w                       pacote_procedimento.pr_desc%type;
vl_negociado_proc_w             pacote_procedimento.vl_negociado%type;
ie_agendavel_w                  pacote_procedimento.ie_agendavel%type;
ie_sexo_w                       pacote_procedimento.ie_sexo%type;
cd_medico_w                     pacote_procedimento.cd_medico%type;
cd_cgc_prestador_w              pacote_procedimento.cd_cgc_prestador%type;
ie_setor_exclusivo_w            pacote_procedimento.ie_setor_exclusivo%type;
cd_moeda_w                      pacote_procedimento.cd_moeda%type;
ie_valida_limite_proc_w         pacote_procedimento.ie_valida_limite_proc%type;


c01 CURSOR FOR
SELECT 	nr_seq_pacote,
        ie_inclui_exclui,
        ie_excedente,
        cd_grupo_material,
        cd_subgrupo_material,
        cd_classe_material,
        cd_material,
        qt_limite,
        ie_tipo_atendimento,
        cd_setor_atendimento,
        ie_valor,
        vl_minimo,
        vl_maximo,
        pr_desconto,
        ie_tipo_setor,
        cd_centro_custo,
        ie_ratear_item,
        vl_negociado,
        nr_seq_estrutura,
        cd_local_estoque
from 	pacote_material
where 	nr_seq_pac_acomod = nr_seq_pac_acomod_p;

c02 CURSOR FOR
SELECT 	nr_seq_pacote,
        ie_inclui_exclui,
        ie_excedente,
        cd_area_proced,
        cd_especial_proced,
        cd_grupo_proced,
        cd_procedimento,
        ie_origem_proced,
        qt_limite,
        ie_considera_honorario,
        cd_setor_atendimento,
        ie_tipo_atendimento,
        ie_calcula_honorario,
        ie_calcula_custo_oper,
        pr_desconto,
        cd_centro_custo,
        nr_seq_classif,
        ie_ratear_item,
        nr_seq_estrutura,
        qt_idade_min,
        qt_idade_max,
        vl_maximo,
        vl_minimo,
        ie_tipo_valor,
        nr_seq_proc_interno,
        pr_desc,
        vl_negociado,
        ie_agendavel,
        ie_sexo,
        cd_medico,
        cd_cgc_prestador,
        ie_setor_exclusivo,
        ie_valida_limite_proc,
        cd_moeda
from 	pacote_procedimento
where 	nr_seq_pac_acomod = nr_seq_pac_acomod_p;


BEGIN

select	nextval('pacote_tipo_acomodacao_seq')
into STRICT	nr_seq_pac_acomod_w
;

insert into pacote_tipo_acomodacao(	nr_seq_pacote,
	ie_tipo_acomod,
	dt_atualizacao,
	nm_usuario,
	qt_dias_pacote,
	qt_dias_hospital,
	qt_dias_uti,
	ie_excedente,
	cd_procedimento,
	ie_origem_proced,
	vl_pacote,
	vl_honorario,
	qt_ponto_pacote,
	qt_ponto_honorario,
	cd_estrutura_conta,
	ie_classificacao,
	nr_sequencia,
	cd_categoria,
	dt_vigencia,
	dt_vigencia_final,
	ie_exige_gabarito,
	IE_REGRA_HORA_INICIO,
	IE_REGRA_HORA_FIM,
	ie_situacao,
	ie_ratear_repasse,	
	ie_tipo_atendimento,
	ie_gerar_proced_negativo,
	VL_ANESTESISTA,
	IE_ATEND_RETORNO,
	IE_TIPO_ANESTESIA,
	IE_ATEND_ACOMP,
	cd_setor_atendimento,
	nr_seq_proc_interno,
	cd_medico_executor,
	ie_clinica,
	vl_materiais,
	ie_consiste_cirurgia,
	ie_exige_item_conta,
	vl_auxiliares,
	ds_observacao,
	ie_sexo,
	pr_acrescimo_rn,
	ie_lado,
	ie_setor_lanc_exclusivo,
	qt_procedimento,
	ie_tipo_atend_conta,
	cd_centro_custo,
	qt_hora,
	IE_CONSISTE_DIAS_INTER,
	IE_ATEND_ALTA,
	IE_ATUALIZA_MEDICO,
	IE_PACOTE_MAT_IPASGO,
	IE_CREDENCIADO,
	QT_IDADE_MIN,
	QT_IDADE_MAX,
	QT_DIAS_INTER_FINAL,
	QT_DIAS_INTER_INICIO,
	HR_FINAL_PACOTE,
	CD_PLANO,
	PR_FATURAR_PACOTE,
	IE_DATA_CONSISTE_IDADE,
        ie_carater_inter_sus)
SELECT 	nr_seq_pacote,
	ie_tipo_acomod,
	clock_timestamp(),
	nm_usuario_p,
	qt_dias_pacote,
	qt_dias_hospital,
	qt_dias_uti,
	ie_excedente,
	cd_procedimento,
	ie_origem_proced,
	vl_pacote,
	vl_honorario,
	qt_ponto_pacote,
	qt_ponto_honorario,
	cd_estrutura_conta,
	ie_classificacao,
	nr_seq_pac_acomod_w,
	cd_categoria,
	dt_vigencia,
	dt_vigencia_final,
	ie_exige_gabarito,
	IE_REGRA_HORA_INICIO,
	IE_REGRA_HORA_FIM,
	ie_situacao,
	ie_ratear_repasse,	
	ie_tipo_atendimento,
	ie_gerar_proced_negativo,
	VL_ANESTESISTA,
	IE_ATEND_RETORNO,
	IE_TIPO_ANESTESIA,
	IE_ATEND_ACOMP,
	cd_setor_atendimento,
	nr_seq_proc_interno,
	cd_medico_executor,
	ie_clinica,
	vl_materiais,
	ie_consiste_cirurgia,
	ie_exige_item_conta,
	vl_auxiliares,
	ds_observacao,
	ie_sexo,
	pr_acrescimo_rn,
	ie_lado,
	ie_setor_lanc_exclusivo,
	qt_procedimento,
	ie_tipo_atend_conta,
	cd_centro_custo,
	qt_hora,
	IE_CONSISTE_DIAS_INTER,
	IE_ATEND_ALTA,
	IE_ATUALIZA_MEDICO,
	IE_PACOTE_MAT_IPASGO,
	IE_CREDENCIADO,
	QT_IDADE_MIN,
	QT_IDADE_MAX,
	QT_DIAS_INTER_FINAL,
	QT_DIAS_INTER_INICIO,
	HR_FINAL_PACOTE,
	CD_PLANO,
	PR_FATURAR_PACOTE,
	IE_DATA_CONSISTE_IDADE,
        ie_carater_inter_sus
from	pacote_tipo_acomodacao
where	nr_sequencia = nr_seq_pac_acomod_p;


open	c01;
loop
fetch	c01 into
	nr_seq_pacote_w,
	ie_inclui_exclui_w,
	ie_excedente_w,
	cd_grupo_material_w,
	cd_subgrupo_material_w,
	cd_classe_material_w,
	cd_material_w,
	qt_limite_w,
	ie_tipo_atendimento_w,
	cd_setor_atendimento_w,
	ie_valor_w,
	vl_minimo_w,
	vl_maximo_w,
	pr_desconto_w,
	ie_tipo_setor_w,
	cd_centro_custo_w,
	ie_ratear_item_w,
	vl_negociado_w,
	nr_seq_estrutura_w,
	cd_local_estoque_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin

	select	nextval('pacote_material_seq')
	into STRICT	nr_seq_regra_w
	;

	insert into pacote_material(nr_seq_pacote,
		nr_sequencia,
		ie_inclui_exclui,
		dt_atualizacao,
		nm_usuario,
		ie_excedente,
		cd_grupo_material,
		cd_subgrupo_material,
		cd_classe_material,
		cd_material,
		qt_limite,
		ie_tipo_atendimento,
		cd_setor_atendimento,
		nr_seq_pac_acomod,
		ie_valor,
		vl_minimo,
		vl_maximo,
		pr_desconto,
		ie_tipo_setor,
		cd_centro_custo,
		ie_ratear_item,
		vl_negociado,
		nr_seq_estrutura,
		cd_local_estoque)
	values (nr_seq_pacote_w,
		nr_seq_regra_w,
		ie_inclui_exclui_w,
		clock_timestamp(),
		nm_usuario_p,
		ie_excedente_w,
		cd_grupo_material_w,
		cd_subgrupo_material_w,
		cd_classe_material_w,
		cd_material_w,
		qt_limite_w,
		ie_tipo_atendimento_w,
		cd_setor_atendimento_w,
		nr_seq_pac_acomod_w,
		ie_valor_w,
		vl_minimo_w,
		vl_maximo_w,
		pr_desconto_w,
		ie_tipo_setor_w,
		cd_centro_custo_w,
		ie_ratear_item_w,
		vl_negociado_w,
		nr_seq_estrutura_w,
		cd_local_estoque_w);
	end;
end loop;
close c01;


open	c02;
loop
fetch	c02 into
        nr_seq_pacote_w,
        ie_inclui_exclui_w,
        ie_excedente_w,
        cd_area_proced_w,
        cd_especial_proced_w,
        cd_grupo_proced_w,
        cd_procedimento_w,
        ie_origem_proced_w,
        qt_limite_w,
        ie_considera_honorario_w,
        cd_setor_atendimento_w,
        ie_tipo_atendimento_w,
        ie_calcula_honorario_w,
        ie_calcula_custo_oper_w,
        pr_desconto_w,
        cd_centro_custo_w,
        nr_seq_classif_w,
        ie_ratear_item_w,
        nr_seq_estrutura_proc_w,
        qt_idade_min_w,
        qt_idade_max_w,
        vl_maximo_proc_w,
        vl_minimo_proc_w,
        ie_tipo_valor_w,
        nr_seq_proc_interno_w,
        pr_desc_w,
        vl_negociado_proc_w,
        ie_agendavel_w,
        ie_sexo_w,
        cd_medico_w,
        cd_cgc_prestador_w,
        ie_setor_exclusivo_w,
        ie_valida_limite_proc_w,
        cd_moeda_w;
EXIT WHEN NOT FOUND; /* apply on c02 */
	begin

	select	nextval('pacote_procedimento_seq')
	into STRICT	nr_seq_regra_w
	;
	
	insert into pacote_procedimento(nr_seq_pacote,
                nr_sequencia,
                ie_inclui_exclui,
                dt_atualizacao,
                nm_usuario,
                ie_excedente,
                cd_area_proced,
                cd_especial_proced,
                cd_grupo_proced,
                cd_procedimento,
                ie_origem_proced,
                qt_limite,
                ie_considera_honorario,
                cd_setor_atendimento,
                ie_tipo_atendimento,
                ie_calcula_honorario,
                ie_calcula_custo_oper,
                nr_seq_pac_acomod,
                pr_desconto,
                nr_seq_classif,
                ie_ratear_item,
                nr_seq_estrutura,
                qt_idade_min,
                qt_idade_max,
                vl_maximo,
                vl_minimo,
                ie_tipo_valor,
                nr_seq_proc_interno,
                pr_desc,
                vl_negociado,
                ie_agendavel,
                ie_sexo,
                cd_medico,
                cd_cgc_prestador,
                ie_setor_exclusivo,
                ie_valida_limite_proc,
                cd_moeda)
	values (nr_seq_pacote_w,
                nr_seq_regra_w,
                ie_inclui_exclui_w,
                clock_timestamp(),
                nm_usuario_p,
                ie_excedente_w,
                cd_area_proced_w,
                cd_especial_proced_w,
                cd_grupo_proced_w,
                cd_procedimento_w,
                ie_origem_proced_w,
                qt_limite_w,
                ie_considera_honorario_w,
                cd_setor_atendimento_w,
                ie_tipo_atendimento_w,
                ie_calcula_honorario_w,
                ie_calcula_custo_oper_w,
                nr_seq_pac_acomod_w,
                pr_desconto_w,
                nr_seq_classif_w,
                ie_ratear_item_w,
                nr_seq_estrutura_proc_w,
                qt_idade_min_w,
                qt_idade_max_w,
                vl_maximo_proc_w,
                vl_minimo_proc_w,
                ie_tipo_valor_w,
                nr_seq_proc_interno_w,
                pr_desc_w,
                vl_negociado_proc_w,
                ie_agendavel_w,
                ie_sexo_w,
                cd_medico_w,
                cd_cgc_prestador_w,
                ie_setor_exclusivo_w,
                ie_valida_limite_proc_w,
                cd_moeda_w);
	end;
end loop;
close c02;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_gabarito_pacote ( nr_seq_pac_acomod_p bigint, nm_usuario_p text) FROM PUBLIC;

