-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE hem_duplicar_laudo_congenitas ( nr_seq_laudo_p bigint, nr_seq_proc_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_seq_proc_ant_w	bigint;
nr_seq_laudo_novo_w	bigint;
nr_seq_conduta_w	bigint;
nr_seq_complicacao_w	bigint;
ds_obs_laudo_w		varchar(255);
ds_laudo_w		varchar(32000);


BEGIN

if (coalesce(nr_seq_laudo_p,0) > 0) then

	nr_seq_proc_ant_w := nr_seq_laudo_p;

	insert into hem_manometria_completa(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_proc,
		nr_seq_analise,
		ie_tipo,
		qt_pa_sistolica,
		qt_pa_diastolica_ini,
		qt_pa_diastolica_fim,
		qt_pam,
		nr_seq_laudo,
		ie_momento
		) (
	SELECT	nextval('hem_manometria_completa_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_proc_p,
			nr_seq_analise,
			ie_tipo,
			qt_pa_sistolica,
			qt_pa_diastolica_ini,
			qt_pa_diastolica_fim,
			qt_pam,
			nr_seq_laudo_novo_w,
			'PR'
	from	hem_manometria_completa
	where	nr_seq_proc = nr_seq_proc_ant_w
	and 	ie_momento = 'PR');

	insert into hem_manometria_completa(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_proc,
		nr_seq_analise,
		ie_tipo,
		qt_pa_sistolica,
		qt_pa_diastolica_ini,
		qt_pa_diastolica_fim,
		qt_pam,
		nr_seq_laudo,
		ie_momento
		) (
	SELECT	nextval('hem_manometria_completa_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_proc_p,
			nr_seq_analise,
			ie_tipo,
			qt_pa_sistolica,
			qt_pa_diastolica_ini,
			qt_pa_diastolica_fim,
			qt_pam,
			nr_seq_laudo_novo_w,
			'PO'
	from	hem_manometria_completa
	where	nr_seq_proc = nr_seq_proc_ant_w
	and 	ie_momento = 'PO');

	insert into hem_analise_manometria(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_analise,
		nr_seq_manometria,
		nr_seq_laudo,
		nr_seq_proc,
		ie_momento
		)(
	SELECT	nextval('hem_analise_manometria_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_analise,
			nr_seq_manometria,
			nr_seq_laudo_novo_w,
			nr_seq_proc_p,
			'PR'
	from	hem_analise_manometria
	where	nr_seq_proc = nr_seq_proc_ant_w
	and		ie_momento = 'PR');

	insert into hem_analise_manometria(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_analise,
		nr_seq_manometria,
		nr_seq_laudo,
		nr_seq_proc,
		ie_momento
		)(
	SELECT	nextval('hem_analise_manometria_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_analise,
			nr_seq_manometria,
			nr_seq_laudo_novo_w,
			nr_seq_proc_p,
			'PO'
	from	hem_analise_manometria
	where	nr_seq_proc = nr_seq_proc_ant_w
	and		ie_momento = 'PO');

	insert into hem_atc_balao(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		ie_kissing_balloon,
		nr_seq_balao,
		ie_utilizacao,
		qt_diametro,
		qt_comprimento,
		qt_diametro_2,
		ds_observacao,
		nr_seq_proc
		)(
	SELECT nextval('hem_atc_balao_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			ie_kissing_balloon,
			nr_seq_balao,
			ie_utilizacao,
			qt_diametro,
			qt_comprimento,
			qt_diametro_2,
			ds_observacao,
			nr_seq_proc_p
	from	hem_atc_balao
	where	nr_seq_proc = nr_seq_proc_ant_w);

	insert into hem_conclusao_coron(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_proc,
		ie_sucesso,
		nr_seq_motivo,
		qt_valor_inicial,
		qt_valor_final
		)(
	SELECT nextval('hem_conclusao_coron_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_proc_p,
			ie_sucesso,
			nr_seq_motivo,
			qt_valor_inicial,
			qt_valor_final
	from	hem_conclusao_coron
	where	nr_seq_proc = nr_seq_proc_ant_w);

	insert into hem_observacao_laudo(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_proc,
		ds_observacao_laudo
		) (
	SELECT nextval('hem_observacao_laudo_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_proc_p,
			ds_observacao_laudo
	from	hem_observacao_laudo
	where	nr_seq_proc = nr_seq_proc_ant_w);
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE hem_duplicar_laudo_congenitas ( nr_seq_laudo_p bigint, nr_seq_proc_p bigint, nm_usuario_p text) FROM PUBLIC;

