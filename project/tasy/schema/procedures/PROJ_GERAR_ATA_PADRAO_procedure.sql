-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE proj_gerar_ata_padrao ( nr_seq_ata_p bigint, nr_seq_ata_padrao_p bigint, nm_usuario_p text) AS $body$
DECLARE


ds_pauta_w		varchar(255);
ds_titulo_w		varchar(80);
ds_conteudo_w		varchar(4000);
nr_seq_apresentacao_w	bigint;

c01 CURSOR FOR
SELECT	ds_pauta
from	proj_ata_padrao_pauta
where	nr_seq_ata = nr_seq_ata_padrao_p;

c02 CURSOR FOR
SELECT	ds_titulo,
	ds_conteudo,
	nr_seq_apresentacao
from	proj_ata_padrao_conteudo
where	nr_seq_ata = nr_seq_ata_padrao_p;

c03 CURSOR FOR
SELECT	a.ds_pendencia,
	a.ie_relat_desempenho,
	a.nr_seq_classif,
	a.ie_status
from	proj_ata_padrao_pendencia a
where	a.nr_seq_ata	= nr_seq_ata_padrao_p;

vet03	c03%RowType;


BEGIN
open c01;
loop
fetch c01 into
	ds_pauta_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin

	insert into proj_ata_pauta(	nr_sequencia,
					dt_atualizacao,
					nm_usuario,
					dt_atualizacao_nrec,
					nm_usuario_nrec,
					nr_seq_ata,
					ds_pauta)
				values (	nextval('proj_ata_pauta_seq'),
					clock_timestamp(),
					nm_usuario_p,
					clock_timestamp(),
					nm_usuario_p,
					nr_seq_ata_p,
					ds_pauta_w);

	end;
end loop;
close c01;

open c02;
loop
fetch c02 into
	ds_titulo_w,
	ds_conteudo_w,
	nr_seq_apresentacao_w;
EXIT WHEN NOT FOUND; /* apply on c02 */
	begin

	insert into proj_ata_conteudo(	nr_sequencia,
					dt_atualizacao,
					nm_usuario,
					dt_atualizacao_nrec,
					nm_usuario_nrec,
					nr_seq_ata,
					ds_conteudo,
					ds_titulo,
					nr_seq_apresentacao)
				values (	nextval('proj_ata_conteudo_seq'),
					clock_timestamp(),
					nm_usuario_p,
					clock_timestamp(),
					nm_usuario_p,
					nr_seq_ata_p,
					ds_conteudo_w,
					ds_titulo_w,
					nr_seq_apresentacao_w);

	end;
end loop;
close c02;

open C03;
loop
fetch C03 into
	vet03;
EXIT WHEN NOT FOUND; /* apply on C03 */
	begin
	insert into proj_ata_pendencia(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_ata,
		ds_pendencia,
		ie_relat_desempenho,
		nr_seq_classif,
		ie_status)
	values (	nextval('proj_ata_pendencia_seq'),
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		nr_seq_ata_p,
		vet03.ds_pendencia,
		vet03.ie_relat_desempenho,
		vet03.nr_seq_classif,
		vet03.ie_status);

	end;
end loop;
close C03;
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE proj_gerar_ata_padrao ( nr_seq_ata_p bigint, nr_seq_ata_padrao_p bigint, nm_usuario_p text) FROM PUBLIC;

