-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_pk_w_ctb_gerencial () AS $body$
DECLARE



qt_registro_w	bigint;
ds_retorno_w	varchar(255);



BEGIN

select	count(*)
into STRICT	qt_registro_w
from	w_ctb_gerencial
where	coalesce(cd_estabelecimento::text, '') = '';


if (qt_registro_w > 0) then

	update w_ctb_gerencial
	set	cd_estabelecimento = (	SELECT	min(cd_estabelecimento)
					from	estabelecimento)
	where	coalesce(cd_estabelecimento::text, '') = '';

end if;

select	COUNT(*)
into STRICT	qt_registro_w
from	user_cons_columns
where	TABLE_NAME     = 'W_CTB_GERENCIAL'
and	constraint_name = 'WCTBGER_PK'
and	column_name = 'CD_ESTABELECIMENTO';



if (qt_registro_w = 0) then

	ds_retorno_w := Executar_SQL_Dinamico(' DROP INDEX WCTBGER_PK ', ds_retorno_w);

	ds_retorno_w := Executar_SQL_Dinamico(' ALTER TABLE W_CTB_GERENCIAL DROP CONSTRAINT WCTBGER_PK ', ds_retorno_w);

	ds_retorno_w := Executar_SQL_Dinamico('	ALTER TABLE W_CTB_GERENCIAL ADD ( CONSTRAINT WCTBGER_PK Primary Key
				(NM_USUARIO, CD_CLASSIFICACAO, CD_ESTABELECIMENTO) USING INDEX Tablespace TASY_INDEX) ', ds_retorno_w);

end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_pk_w_ctb_gerencial () FROM PUBLIC;

