-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_comunic_convite_usuario (nr_seq_agenda_p bigint, nm_usuario_convidado_p text, nm_usuario_p text) AS $body$
DECLARE


dt_agenda_w		timestamp;
ds_agenda_w		varchar(100);
nr_minutos_w		bigint;
ds_local_w		varchar(80);
ds_observacao_w		varchar(2000);
ds_mensagem_w		text;

expressao1_w	varchar(255) := obter_desc_expressao_idioma(327202, null, wheb_usuario_pck.get_nr_seq_idioma);--Data:
expressao2_w	varchar(255) := obter_desc_expressao_idioma(343783, null, wheb_usuario_pck.get_nr_seq_idioma);--Duração:
expressao3_w	varchar(255) := obter_desc_expressao_idioma(325812, null, wheb_usuario_pck.get_nr_seq_idioma);--Local:
expressao4_w	varchar(255) := obter_desc_expressao_idioma(619557, null, wheb_usuario_pck.get_nr_seq_idioma);--minutos.
expressao5_w	varchar(255) := obter_desc_expressao_idioma(692668, null, wheb_usuario_pck.get_nr_seq_idioma);--Observações:
expressao6_w	varchar(255) := obter_desc_expressao_idioma(327119, null, wheb_usuario_pck.get_nr_seq_idioma);--Não informado
BEGIN

/* obter dados agenda */

select	dt_agenda,
	coalesce(ds_agenda,expressao6_w),
	nr_minuto_duracao,
	CASE WHEN coalesce(nr_seq_local::text, '') = '' THEN  ds_local  ELSE obter_local_agenda_tasy(nr_seq_local)||'.' END ,
	ds_observacao
into STRICT	dt_agenda_w,
	ds_agenda_w,
	nr_minutos_w,
	ds_local_w,
	ds_observacao_w
from 	agenda_tasy
where	nr_sequencia = nr_seq_agenda_p;

/* montar mensagem */

ds_mensagem_w	:= ds_agenda_w || chr(10) || chr(10) ||
		   expressao1_w || ' ' || to_char(dt_agenda_w,'dd/mm/yyyy hh24:mi:ss') || '.' || chr(10) ||
		   expressao2_w || ' ' || to_char(nr_minutos_w) || ' ' || expressao4_w || chr(10) ||
		   expressao3_w || ' ' || ds_local_w || chr(10) ||
		   expressao5_w || ' ' || ds_observacao_w;


/* envia comunicação */

CALL Gerar_Comunic_Padrao(clock_timestamp(), ds_agenda_w, ds_mensagem_w, nm_usuario_p, 'N', nm_usuario_convidado_p, 'N', null,	null, null, null, clock_timestamp(), null,null);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_comunic_convite_usuario (nr_seq_agenda_p bigint, nm_usuario_convidado_p text, nm_usuario_p text) FROM PUBLIC;

