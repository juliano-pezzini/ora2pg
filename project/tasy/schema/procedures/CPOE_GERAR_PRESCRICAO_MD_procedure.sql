-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cpoe_gerar_prescricao_md ( ie_lib_tudo_proced_p INOUT text, ie_libera_se_proced_p text, ie_lib_sem_interv_p text, ds_itens_proc_p INOUT text, ie_opcao_prescr_p text, nr_seq_reg_item_p bigint, nr_seq_pepo_p INOUT bigint, ds_itens_pepo_p INOUT text, nr_seq_pepo_rep_p INOUT bigint, nr_cirurgia_p INOUT bigint, ds_itens_cirur_p INOUT text, nr_seq_cirur_rep_p INOUT bigint, nr_cirurgia_patologia_p INOUT bigint, ds_itens_cirur_pat_p INOUT text, nr_seq_cirur_pat_rep_p INOUT bigint, nr_seq_agenda_p INOUT bigint, ds_itens_agenda_p INOUT text, nr_seq_agenda_rep_p INOUT bigint, nr_seq_transcricao_p INOUT bigint, ds_itens_transcricao_p INOUT text, nr_seq_transcricao_rep_p INOUT bigint, ie_item_alta_p INOUT text, ds_itens_alta_p INOUT text, nr_seq_conclusao_apae_p INOUT bigint, ds_itens_apae_p INOUT text, nr_seq_conclusao_apae_rep_p INOUT bigint, ds_itens_liberados_p INOUT text, ds_itens_futuro_p INOUT text, nr_seq_futuro_rep_p INOUT bigint, nr_seq_atend_futuro_p INOUT bigint ) AS $body$
BEGIN
    IF (
        ( ie_lib_tudo_proced_p = 'S' )
        AND ( ie_libera_se_proced_p NOT IN ( 'N', 'T' ) )
        AND ( ie_lib_sem_interv_p = 'N' )
    ) THEN
        ds_itens_proc_p := ds_itens_proc_p
                           || ie_opcao_prescr_p
                           || ','
                           || nr_seq_reg_item_p
                           || ';';
        ie_lib_tudo_proced_p := 'N';
    ELSIF ( coalesce(nr_seq_pepo_p, 0) > 0 ) THEN
        ds_itens_pepo_p := ds_itens_pepo_p
                           || ie_opcao_prescr_p
                           || ','
                           || nr_seq_reg_item_p
                           || ';';
        nr_seq_pepo_rep_p := nr_seq_pepo_p;
        nr_seq_pepo_p := 0;
    ELSIF ( coalesce(nr_cirurgia_p, 0) > 0 ) THEN
        ds_itens_cirur_p := ds_itens_cirur_p
                            || ie_opcao_prescr_p
                            || ','
                            || nr_seq_reg_item_p
                            || ';';
        nr_seq_cirur_rep_p := nr_cirurgia_p;
        nr_cirurgia_p := 0;
    ELSIF ( coalesce(nr_cirurgia_patologia_p, 0) > 0 ) THEN
        ds_itens_cirur_pat_p := ds_itens_cirur_pat_p
                                || ie_opcao_prescr_p
                                || ','
                                || nr_seq_reg_item_p
                                || ';';
        nr_seq_cirur_pat_rep_p := nr_cirurgia_patologia_p;
        nr_cirurgia_patologia_p := 0;
    ELSIF ( coalesce(nr_seq_agenda_p, 0) > 0 ) THEN
        ds_itens_agenda_p := ds_itens_agenda_p
                             || ie_opcao_prescr_p
                             || ','
                             || nr_seq_reg_item_p
                             || ';';
        nr_seq_agenda_rep_p := nr_seq_agenda_p;
        nr_seq_agenda_p := 0;
    ELSIF ( coalesce(nr_seq_transcricao_p, 0) > 0 ) THEN
        ds_itens_transcricao_p := ds_itens_transcricao_p
                                  || ie_opcao_prescr_p
                                  || ','
                                  || nr_seq_reg_item_p
                                  || ';';
        nr_seq_transcricao_rep_p := nr_seq_transcricao_p;
        nr_seq_transcricao_p := 0;
    ELSIF ( coalesce(ie_item_alta_p, 'N') = 'S' ) THEN
        ds_itens_alta_p := ds_itens_alta_p
                           || ie_opcao_prescr_p
                           || ','
                           || nr_seq_reg_item_p
                           || ';';
        ie_item_alta_p := 'N';
    ELSIF ( coalesce(nr_seq_conclusao_apae_p, 0) > 0 ) THEN
        ds_itens_apae_p := ds_itens_apae_p
                           || ie_opcao_prescr_p
                           || ','
                           || nr_seq_reg_item_p
                           || ';';
        nr_seq_conclusao_apae_rep_p := nr_seq_conclusao_apae_p;
        nr_seq_conclusao_apae_p := 0;
	ELSIF (coalesce(nr_seq_atend_futuro_p, 0) > 0) THEN
        ds_itens_futuro_p := ds_itens_futuro_p
                           || ie_opcao_prescr_p
                           || ','
                           || nr_seq_reg_item_p
                           || ';';
        nr_seq_futuro_rep_p := nr_seq_atend_futuro_p;
        nr_seq_atend_futuro_p := 0;
    ELSE
        ds_itens_liberados_p := ds_itens_liberados_p
                                || ie_opcao_prescr_p
                                || ','
                                || nr_seq_reg_item_p
                                || ';';
    END IF;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_gerar_prescricao_md ( ie_lib_tudo_proced_p INOUT text, ie_libera_se_proced_p text, ie_lib_sem_interv_p text, ds_itens_proc_p INOUT text, ie_opcao_prescr_p text, nr_seq_reg_item_p bigint, nr_seq_pepo_p INOUT bigint, ds_itens_pepo_p INOUT text, nr_seq_pepo_rep_p INOUT bigint, nr_cirurgia_p INOUT bigint, ds_itens_cirur_p INOUT text, nr_seq_cirur_rep_p INOUT bigint, nr_cirurgia_patologia_p INOUT bigint, ds_itens_cirur_pat_p INOUT text, nr_seq_cirur_pat_rep_p INOUT bigint, nr_seq_agenda_p INOUT bigint, ds_itens_agenda_p INOUT text, nr_seq_agenda_rep_p INOUT bigint, nr_seq_transcricao_p INOUT bigint, ds_itens_transcricao_p INOUT text, nr_seq_transcricao_rep_p INOUT bigint, ie_item_alta_p INOUT text, ds_itens_alta_p INOUT text, nr_seq_conclusao_apae_p INOUT bigint, ds_itens_apae_p INOUT text, nr_seq_conclusao_apae_rep_p INOUT bigint, ds_itens_liberados_p INOUT text, ds_itens_futuro_p INOUT text, nr_seq_futuro_rep_p INOUT bigint, nr_seq_atend_futuro_p INOUT bigint ) FROM PUBLIC;

