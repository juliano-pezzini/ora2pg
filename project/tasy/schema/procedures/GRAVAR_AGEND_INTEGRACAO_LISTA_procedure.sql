-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gravar_agend_integracao_lista ( l_parametros_p LT_PARAM_INTEGRACAO) AS $body$
DECLARE

jobno 					bigint;
cd_estabelecimento_w 	smallint;
ds_parametros_usuario_w varchar(4000);
ds_parametros_w 		varchar(4000);
ds_job_cmd_w 			varchar(32000);
nr_seq_evento_w 		bigint;
tmp_w 					varchar(4000);
ie_ativo 				boolean := false;
BEGIN
     select 'pck_cd_estabelecimento=' || wheb_usuario_pck.get_cd_estabelecimento || obter_separador_bv  ||
           'pck_nm_usuario=' || wheb_usuario_pck.get_nm_usuario || obter_separador_bv
           into STRICT ds_parametros_usuario_w
;
    cd_estabelecimento_w := coalesce(wheb_usuario_pck.get_cd_estabelecimento,1);

    ds_job_cmd_w := 'begin ';
    for i in 1..l_parametros_p.count loop
        begin
            nr_seq_evento_w := l_parametros_p[i].nr_sequencia;
			ds_parametros_w := l_parametros_p[i].ds_parametros;
			if (wheb_usuario_pck.is_evento_ativo(nr_seq_evento_w) = 'S') then
			begin
				ie_ativo := true;
				tmp_w := 'job_gravar_agend_integracao('|| nr_seq_evento_w || ', ''' || ds_parametros_w || ds_parametros_usuario_w || ''', ' || cd_estabelecimento_w || '); ';
				ds_job_cmd_w := ds_job_cmd_w || tmp_w;
			end;
			end if;
		end;
    end loop;
    if ( ie_ativo) then
    begin
		ds_job_cmd_w := ds_job_cmd_w || 'commit; end;';
		dbms_job.submit(jobno, ds_job_cmd_w);
    end;
    end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gravar_agend_integracao_lista ( l_parametros_p LT_PARAM_INTEGRACAO) FROM PUBLIC;

