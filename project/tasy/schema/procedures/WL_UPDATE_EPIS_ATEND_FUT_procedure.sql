-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE wl_update_epis_atend_fut ( nr_atendimento_p atendimento_paciente.nr_atendimento%type, dt_entrada_p atendimento_paciente.dt_entrada%type, nr_seq_episodio_p episodio_paciente.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type ) AS $body$
DECLARE


-- Traz todos os registros para determinado epis√≥dio ou atendimento
c01_worklist CURSOR FOR
	SELECT	*
	from	wl_worklist
	where	((nr_atendimento_p IS NOT NULL AND nr_atendimento_p::text <> '') and coalesce(nr_atendimento, 0) = coalesce(nr_atendimento_p, 0))
	or		((nr_seq_episodio_p IS NOT NULL AND nr_seq_episodio_p::text <> '') and coalesce(nr_seq_episodio, 0) = coalesce(nr_seq_episodio_p, 0))
	and		coalesce(dt_final_real::text, '') = '';

BEGIN
	
	for c01_worklist_w in c01_worklist loop
	
		update	wl_worklist
		set		dt_inicial = dt_entrada_p,
				dt_final_previsto = dt_entrada_p + (c01_worklist_w.dt_final_previsto - c01_worklist_w.dt_inicial),
				dt_atualizacao = dt_entrada_p,
				nm_usuario = nm_usuario_p
		where	nr_sequencia = c01_worklist_w.nr_sequencia
		and		coalesce(dt_final_real::text, '') = '';
	
	end loop;
	
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE wl_update_epis_atend_fut ( nr_atendimento_p atendimento_paciente.nr_atendimento%type, dt_entrada_p atendimento_paciente.dt_entrada%type, nr_seq_episodio_p episodio_paciente.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type ) FROM PUBLIC;

