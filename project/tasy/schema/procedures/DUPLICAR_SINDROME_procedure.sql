-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_sindrome ( nr_seq_sindrome_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_seq_sindrome_w 		bigint;
nr_seq_sinais_w 		bigint;
cd_estabelecimento_w	smallint;
cd_profissional_w		varchar(10);

C01 CURSOR FOR
	SELECT	*
	from	pac_sinal_sindrome
	where	nr_seq_paciente = nr_seq_sindrome_p
	order by nr_sequencia;

c01_w	c01%rowtype;


BEGIN

if (nr_seq_sindrome_p > 0)  then

	Select 	nextval('paciente_sindrome_seq')
	into STRICT	nr_seq_sindrome_w
	;

	cd_estabelecimento_w := wheb_usuario_pck.get_cd_estabelecimento;

	select	max(cd_pessoa_fisica)
	into STRICT	cd_profissional_w
	from	usuario
	where	nm_usuario	= nm_usuario_p;

	insert into paciente_sindrome(
						nr_sequencia,
						 cd_estabelecimento,
						 dt_atualizacao,
						 nm_usuario,
						 dt_atualizacao_nrec,
						 nm_usuario_nrec,
						 cd_pessoa_fisica,
						 cd_profissional,
						 qt_idade_materna,
						 nr_seq_sindrome,
						 ie_etiologia,
						 qt_idade_paterna,
						 dt_avaliacao,
						 ie_recorrencia,
						 ie_cosanguinidade,
						 ie_gemelaridade,
						 ds_observacao,
						 ie_situacao)
				SELECT	 nr_seq_sindrome_w,
						 cd_estabelecimento_w,
						 clock_timestamp(),
						 nm_usuario_p,
						 clock_timestamp(),
						 nm_usuario_p,
						 cd_pessoa_fisica,
						 cd_profissional_w,
						 qt_idade_materna,
						 nr_seq_sindrome,
						 ie_etiologia,
						 qt_idade_paterna,
						 clock_timestamp(),
						 ie_recorrencia,
						 ie_cosanguinidade,
						 ie_gemelaridade,
						 ds_observacao,
						 'A'
				from	paciente_sindrome
				where	nr_sequencia	= nr_seq_sindrome_p;

	commit;

	open C01;
	loop
	fetch C01 into
		c01_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */
		begin

		insert into  pac_sinal_sindrome(	 nr_sequencia,
											 dt_atualizacao,
											 dt_atualizacao_nrec,
											 nm_usuario,
											 nm_usuario_nrec,
											 nr_seq_regiao,
											 nr_seq_sinal,
											 nr_seq_paciente)
								values (	 nextval('pac_sinal_sindrome_seq'),
											 clock_timestamp(),
											 clock_timestamp(),
											 nm_usuario_p,
											 nm_usuario_p,
											 c01_w.nr_seq_regiao,
											 c01_w.nr_seq_sinal,
											 nr_seq_sindrome_w);


		commit;

		end;
	end loop;
	close C01;

end if;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_sindrome ( nr_seq_sindrome_p bigint, nm_usuario_p text) FROM PUBLIC;

