-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE limpar_titulo_pagar ( nr_seq_escrit_p bigint, ie_opcao_p text, ds_titulos_p text) AS $body$
DECLARE

 
			 
			 
nr_titulo_w		bigint;			
nr_seq_escrit_w		bigint;			
			 
C01 CURSOR FOR 
SELECT	a.NR_TITULO 
FROM banco_escritural d, titulo_pagar_escrit a, titulo_pagar_v b
LEFT OUTER JOIN nota_fiscal c ON (b.nr_seq_nota_fiscal = c.nr_sequencia)
WHERE a.nr_seq_escrit		= d.nr_sequencia and a.nr_seq_escrit		= nr_seq_escrit_p and a.nr_titulo		= b.nr_titulo  order by	a.nr_titulo;

			 
			 
			 

BEGIN 
if (ie_opcao_p = 'T') then 
	open C01;
	loop 
	fetch C01 into	 
		nr_titulo_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */
		begin 
		 
		delete from titulo_pagar_escrit  
		where  nr_titulo   =  nr_titulo_w 
		and   nr_seq_escrit =  nr_seq_escrit_p;
 
		 
		end;
	end loop;
	close C01;
end if;
 
if (ie_opcao_p = 'S') then 
 
	delete from titulo_pagar_escrit  
	where	nr_seq_escrit = nr_seq_escrit_p 
	and	obter_se_contido(nr_titulo,ds_titulos_p) = 'S';
 
end if;
 
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE limpar_titulo_pagar ( nr_seq_escrit_p bigint, ie_opcao_p text, ds_titulos_p text) FROM PUBLIC;

