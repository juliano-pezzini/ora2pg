-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE executa_parse_sql_relatorio (nr_sequencia_p bigint) AS $body$
DECLARE

 
cursor_w 			integer;
col_cnt   		integer;
campos_w    	dbms_sql.desc_tab;	
ds_comando_w		varchar(32000);
ds_erro_w			varchar(4000);
ds_banda_w			varchar(30);
ds_MensagemErro_w	varchar(32000);

 
C01 CURSOR FOR 
	SELECT	ds_sql, 
			ds_banda 
	from	banda_relatorio 
	where	nr_seq_relatorio = nr_sequencia_p 
	and		(ds_sql IS NOT NULL AND ds_sql::text <> '');


BEGIN 
ds_MensagemErro_w := null;
 
select	max(ds_sql) 
into STRICT	ds_comando_w 
from	relatorio 
where	nr_sequencia = nr_sequencia_p;
 
 
begin 
	if (ds_comando_w IS NOT NULL AND ds_comando_w::text <> '') then 
		cursor_w := DBMS_SQL.OPEN_CURSOR;
		DBMS_SQL.PARSE(cursor_w, ds_comando_w, dbms_sql.native);
		dbms_sql.describe_columns(cursor_w,col_cnt,campos_w);
		dbms_sql.close_cursor(cursor_w);
	end if;
	exception when others then 
		ds_erro_w	:= SQLERRM(SQLSTATE);
		ds_MensagemErro_w := ds_MensagemErro_w || OBTER_DESC_EXPRESSAO(726282) || chr(13) || chr(10) || ds_erro_w ||'#@#@' || chr(13) || chr(10);	
end;
 
open C01;
loop 
fetch C01 into	 
	ds_comando_w, 
	ds_banda_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin	 
	cursor_w := DBMS_SQL.OPEN_CURSOR;
	DBMS_SQL.PARSE(cursor_w, ds_comando_w, dbms_sql.native);
	dbms_sql.describe_columns(cursor_w,col_cnt,campos_w);
	dbms_sql.close_cursor(cursor_w);
	exception when others then 
			ds_erro_w	:= SQLERRM(SQLSTATE);
			ds_MensagemErro_w := ds_MensagemErro_w || OBTER_DESC_EXPRESSAO(726294)||ds_banda_w||'!!' || chr(13) || chr(10) || ds_erro_w ||'#@#@' || chr(13) || chr(10);
	end;
end loop;
close C01;
 
if (ds_MensagemErro_w IS NOT NULL AND ds_MensagemErro_w::text <> '') then 
	CALL Wheb_mensagem_pck.exibir_mensagem_abort(216912,'MSG='||ds_MensagemErro_w);
end if;	
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE executa_parse_sql_relatorio (nr_sequencia_p bigint) FROM PUBLIC;

