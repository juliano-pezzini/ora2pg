-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE contab_imp_receita_deferido ( NR_INTERNO_CONTA_P CONTA_PACIENTE_RESUMO.NR_INTERNO_CONTA%TYPE, NR_LOTE_CONTABIL_P W_MOVIMENTO_CONTABIL.NR_LOTE_CONTABIL%TYPE, NR_SEQUENCIA_P W_MOVIMENTO_CONTABIL.NR_SEQUENCIA%TYPE, CD_CONTA_CONTABIL_P W_MOVIMENTO_CONTABIL.CD_CONTA_CONTABIL%TYPE, IE_DEBITO_CREDITO_P W_MOVIMENTO_CONTABIL.IE_DEBITO_CREDITO%TYPE, CD_HISTORICO_P W_MOVIMENTO_CONTABIL.CD_HISTORICO%TYPE, DT_MOVIMENTO_P W_MOVIMENTO_CONTABIL.DT_MOVIMENTO%TYPE, CD_CENTRO_CUSTO_P W_MOVIMENTO_CONTABIL.CD_CENTRO_CUSTO%TYPE, DS_COMPL_HISTORICO_P W_MOVIMENTO_CONTABIL.DS_COMPL_HISTORICO%TYPE, DS_DOC_AGRUPAMENTO_P W_MOVIMENTO_CONTABIL.DS_DOC_AGRUPAMENTO%TYPE, NR_SEQ_AGRUPAMENTO_P W_MOVIMENTO_CONTABIL.NR_SEQ_AGRUPAMENTO%TYPE, NR_SEQ_TRANS_FIN_P W_MOVIMENTO_CONTABIL.NR_SEQ_TRANS_FIN%TYPE, CD_CGC_P W_MOVIMENTO_CONTABIL.CD_CGC%TYPE, CD_PESSOA_FISICA_P W_MOVIMENTO_CONTABIL.CD_PESSOA_FISICA%TYPE, NR_DOCUMENTO_P W_MOVIMENTO_CONTABIL.NR_DOCUMENTO%TYPE, IE_TRANSITORIO_P W_MOVIMENTO_CONTABIL.IE_TRANSITORIO%TYPE, IE_ORIGEM_DOCUMENTO_P W_MOVIMENTO_CONTABIL.IE_ORIGEM_DOCUMENTO%TYPE, NR_SEQ_INFO_P W_MOVIMENTO_CONTABIL.NR_SEQ_INFO%TYPE, NR_SEQ_TAB_ORIG_P W_MOVIMENTO_CONTABIL.NR_SEQ_TAB_ORIG%TYPE, NM_TABELA_P W_MOVIMENTO_CONTABIL.NM_TABELA%TYPE, NM_ATRIBUTO_P W_MOVIMENTO_CONTABIL.NM_ATRIBUTO%TYPE, IE_CTB_ESTAB_CENTRO_P PARAMETRO_FATURAMENTO.IE_CTB_ESTAB_CENTRO%TYPE, CD_ESTAB_SETOR_P SETOR_ATENDIMENTO.CD_ESTABELECIMENTO_BASE%TYPE, NR_SEQ_TAB_COMPL_P W_MOVIMENTO_CONTABIL.NR_SEQ_TAB_COMPL%TYPE, NR_SEQ_CLASSIF_MOVTO_P W_MOVIMENTO_CONTABIL.NR_SEQ_CLASSIF_MOVTO%TYPE, NR_SEQ_PROJ_REC_P W_MOVIMENTO_CONTABIL.NR_SEQ_PROJ_REC%TYPE, IE_PROC_MATERIAL_P text, CD_MATERIAL_P CONTA_PACIENTE_RESUMO_IMP.CD_MATERIAL%TYPE, CD_PROCEDIMENTO_P CONTA_PACIENTE_RESUMO_IMP.CD_PROCEDIMENTO%TYPE ) AS $body$
DECLARE


C010                    	REFCURSOR;
VL_IMPOSTO_W                CONTA_PACIENTE_RESUMO_IMP.VL_IMPOSTO%TYPE;
CD_CONTA_CONTABIL_W         TRIBUTO_REGRA_DEFERIDO.CD_CONTA_CONTABIL%TYPE;


BEGIN

C010 := OBTER_VL_TRIB_DEFERIDO(
	NR_INTERNO_CONTA_P, C010, IE_PROC_MATERIAL_P, CD_MATERIAL_P, CD_PROCEDIMENTO_P
);

LOOP FETCH C010 INTO VL_IMPOSTO_W, CD_CONTA_CONTABIL_W;
EXIT WHEN NOT FOUND; /* apply on C010 */

	INSERT INTO W_MOVIMENTO_CONTABIL(
		NR_LOTE_CONTABIL,
		NR_SEQUENCIA,
		CD_CONTA_CONTABIL,
		IE_DEBITO_CREDITO,
		CD_HISTORICO,
		DT_MOVIMENTO,
		VL_MOVIMENTO,
		CD_CENTRO_CUSTO,
		DS_COMPL_HISTORICO,
		DS_DOC_AGRUPAMENTO,
		NR_SEQ_AGRUPAMENTO,
		NR_SEQ_TRANS_FIN,
		CD_CGC,
		CD_PESSOA_FISICA,
		NR_DOCUMENTO,
		IE_TRANSITORIO,
		IE_ORIGEM_DOCUMENTO,
		NR_SEQ_INFO,
		NR_SEQ_TAB_ORIG,
		NM_TABELA,
		NM_ATRIBUTO,
		CD_ESTABELECIMENTO,
		NR_SEQ_TAB_COMPL,
		NR_SEQ_CLASSIF_MOVTO,
		NR_SEQ_PROJ_REC
	) VALUES (
		NR_LOTE_CONTABIL_P,
		NR_SEQUENCIA_P,
		CD_CONTA_CONTABIL_W,
		IE_DEBITO_CREDITO_P,
		CD_HISTORICO_P,
		DT_MOVIMENTO_P,
		VL_IMPOSTO_W,
		CD_CENTRO_CUSTO_P,
		DS_COMPL_HISTORICO_P,
		DS_DOC_AGRUPAMENTO_P,
		NR_SEQ_AGRUPAMENTO_P,
		NR_SEQ_TRANS_FIN_P,
		CD_CGC_P,
		CD_PESSOA_FISICA_P,
		NR_DOCUMENTO_P,
		IE_TRANSITORIO_P,
		IE_ORIGEM_DOCUMENTO_P,
		NR_SEQ_INFO_P,
		NR_SEQ_TAB_ORIG_P,
		NM_TABELA_P,
		NM_ATRIBUTO_P,
		CASE WHEN IE_CTB_ESTAB_CENTRO_P='s' THEN  CD_ESTAB_SETOR_P  ELSE NULL END ,
		NR_SEQ_TAB_COMPL_P,
		NR_SEQ_CLASSIF_MOVTO_P,
		NR_SEQ_PROJ_REC_P
	);

END LOOP;
CLOSE C010;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE contab_imp_receita_deferido ( NR_INTERNO_CONTA_P CONTA_PACIENTE_RESUMO.NR_INTERNO_CONTA%TYPE, NR_LOTE_CONTABIL_P W_MOVIMENTO_CONTABIL.NR_LOTE_CONTABIL%TYPE, NR_SEQUENCIA_P W_MOVIMENTO_CONTABIL.NR_SEQUENCIA%TYPE, CD_CONTA_CONTABIL_P W_MOVIMENTO_CONTABIL.CD_CONTA_CONTABIL%TYPE, IE_DEBITO_CREDITO_P W_MOVIMENTO_CONTABIL.IE_DEBITO_CREDITO%TYPE, CD_HISTORICO_P W_MOVIMENTO_CONTABIL.CD_HISTORICO%TYPE, DT_MOVIMENTO_P W_MOVIMENTO_CONTABIL.DT_MOVIMENTO%TYPE, CD_CENTRO_CUSTO_P W_MOVIMENTO_CONTABIL.CD_CENTRO_CUSTO%TYPE, DS_COMPL_HISTORICO_P W_MOVIMENTO_CONTABIL.DS_COMPL_HISTORICO%TYPE, DS_DOC_AGRUPAMENTO_P W_MOVIMENTO_CONTABIL.DS_DOC_AGRUPAMENTO%TYPE, NR_SEQ_AGRUPAMENTO_P W_MOVIMENTO_CONTABIL.NR_SEQ_AGRUPAMENTO%TYPE, NR_SEQ_TRANS_FIN_P W_MOVIMENTO_CONTABIL.NR_SEQ_TRANS_FIN%TYPE, CD_CGC_P W_MOVIMENTO_CONTABIL.CD_CGC%TYPE, CD_PESSOA_FISICA_P W_MOVIMENTO_CONTABIL.CD_PESSOA_FISICA%TYPE, NR_DOCUMENTO_P W_MOVIMENTO_CONTABIL.NR_DOCUMENTO%TYPE, IE_TRANSITORIO_P W_MOVIMENTO_CONTABIL.IE_TRANSITORIO%TYPE, IE_ORIGEM_DOCUMENTO_P W_MOVIMENTO_CONTABIL.IE_ORIGEM_DOCUMENTO%TYPE, NR_SEQ_INFO_P W_MOVIMENTO_CONTABIL.NR_SEQ_INFO%TYPE, NR_SEQ_TAB_ORIG_P W_MOVIMENTO_CONTABIL.NR_SEQ_TAB_ORIG%TYPE, NM_TABELA_P W_MOVIMENTO_CONTABIL.NM_TABELA%TYPE, NM_ATRIBUTO_P W_MOVIMENTO_CONTABIL.NM_ATRIBUTO%TYPE, IE_CTB_ESTAB_CENTRO_P PARAMETRO_FATURAMENTO.IE_CTB_ESTAB_CENTRO%TYPE, CD_ESTAB_SETOR_P SETOR_ATENDIMENTO.CD_ESTABELECIMENTO_BASE%TYPE, NR_SEQ_TAB_COMPL_P W_MOVIMENTO_CONTABIL.NR_SEQ_TAB_COMPL%TYPE, NR_SEQ_CLASSIF_MOVTO_P W_MOVIMENTO_CONTABIL.NR_SEQ_CLASSIF_MOVTO%TYPE, NR_SEQ_PROJ_REC_P W_MOVIMENTO_CONTABIL.NR_SEQ_PROJ_REC%TYPE, IE_PROC_MATERIAL_P text, CD_MATERIAL_P CONTA_PACIENTE_RESUMO_IMP.CD_MATERIAL%TYPE, CD_PROCEDIMENTO_P CONTA_PACIENTE_RESUMO_IMP.CD_PROCEDIMENTO%TYPE ) FROM PUBLIC;

