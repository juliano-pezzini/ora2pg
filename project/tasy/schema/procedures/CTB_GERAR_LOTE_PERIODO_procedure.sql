-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ctb_gerar_lote_periodo ( dt_inicio_p timestamp, dt_fim_p timestamp, cd_tipo_lote_contabil_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE


dt_inicio_w	timestamp;
dt_fim_w	timestamp;
qt_dia_w	bigint;
dt_referencia_w	timestamp;
qt_registro_w	bigint;

BEGIN

dt_inicio_w	:= dt_inicio_p;
dt_fim_w	:= dt_fim_p;

qt_dia_w	:= round(dt_fim_w - dt_inicio_w) + 1;
dt_referencia_w	:= dt_inicio_w;
for i in 1..qt_dia_w loop
	begin

	select	count(*)
	into STRICT	qt_registro_w
	from	lote_contabil
	where	cd_estabelecimento	= cd_estabelecimento_p
	and	dt_referencia = dt_referencia_w
	and	cd_tipo_lote_contabil = cd_tipo_lote_contabil_p;

	if (qt_registro_w = 0) then
		CALL Gerar_Lote_Contabil(cd_estabelecimento_p, cd_tipo_lote_contabil_p, dt_referencia_w, nm_usuario_p);
	end if;

	dt_referencia_w	:= dt_inicio_w + i;
	end;
end loop;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ctb_gerar_lote_periodo ( dt_inicio_p timestamp, dt_fim_p timestamp, cd_tipo_lote_contabil_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

