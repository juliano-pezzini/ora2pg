-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copia_item_prontuario_perfil (cd_perfil_origem_p bigint, cd_perfil_destino_p bigint, nr_seq_item_pront_p bigint, nm_usuario_p text) AS $body$
DECLARE

nr_sequencia_w    	bigint;
nr_seq_item_pront_template_w    bigint;
nr_seq_template_w  	bigint;
ie_digitar_consulta_w  	varchar(1);

nr_sequencia_pasta_w	bigint;
nr_seq_item_pasta_w	bigint;
ds_pasta_instituicao_w	varchar(255);

C01 CURSOR FOR
	SELECT  a.nr_seq_template,
		a.ie_digitar_consulta
	from   	perfil_item_pront_template a,
		perfil_item_pront b
	where  	a.nr_seq_item_perfil = b.nr_sequencia
	and    	b.cd_perfil          = cd_perfil_origem_p
	and    	b.nr_seq_item_pront  = nr_seq_item_pront_p;

C02 CURSOR FOR
	SELECT 	a.nr_seq_item_pasta,
		a.ds_pasta_instituicao
	from   	perfil_item_pront_pasta a,
		perfil_item_pront b
	where 	a.nr_seq_item_perfil = b.nr_sequencia
	and    	b.cd_perfil          = cd_perfil_origem_p
	and    	b.nr_seq_item_pront  = nr_seq_item_pront_p;

BEGIN

select   nextval('perfil_item_pront_seq')
into STRICT  nr_sequencia_w
;

insert into perfil_item_pront(nr_sequencia,
        dt_atualizacao,
        cd_perfil,
        nr_seq_item_pront,
        nm_usuario,
        ie_atualizar,
        nr_seq_apres,
        dt_atualizacao_nrec,
        nm_usuario_nrec,
        ie_checkup,
        nr_seq_apres_checkup,
        ie_atualizar_alta,
        ie_atualizar_obito,
        qt_min_alta,
        qt_min_obito,
        qt_horas_inativacao,
        ds_item_instituicao,
        qt_tamanho_fonte,
        ds_fonte,
        ds_cor_fonte,
        ie_estabelecimento,
        ie_fim_conta,
        ie_visualiza_inativo,
        ie_liberar_impressao,
        ie_configurar_relatorio,
        ds_alerta_impressao,
        ie_inativar,
        ie_somente_template,
        ie_atualizar_template,
        qt_refresh_tela,
        ie_imprimir_liberar,
        qt_min_impressao_alta,
        qt_dias_filtro,
        ds_pasta_template,
        ie_adep,
        nr_seq_pasta_inicial)
      (SELECT  nr_sequencia_w,
        clock_timestamp(),
        cd_perfil_destino_p,
        nr_seq_item_pront_p,
        nm_usuario_p,
        ie_atualizar,
        nr_seq_apres,
        dt_atualizacao_nrec,
        nm_usuario_nrec,
        ie_checkup,
        nr_seq_apres_checkup,
        ie_atualizar_alta,
        ie_atualizar_obito,
        qt_min_alta,
        qt_min_obito,
        qt_horas_inativacao,
        ds_item_instituicao,
        qt_tamanho_fonte,
        ds_fonte,
        ds_cor_fonte,
        ie_estabelecimento,
        ie_fim_conta,
        ie_visualiza_inativo,
        ie_liberar_impressao,
        ie_configurar_relatorio,
        ds_alerta_impressao,
        ie_inativar,
        ie_somente_template,
        ie_atualizar_template,
        qt_refresh_tela,
        ie_imprimir_liberar,
        qt_min_impressao_alta,
        qt_dias_filtro,
        ds_pasta_template,
        ie_adep,
        nr_seq_pasta_inicial
      from  perfil_item_pront
      where  cd_perfil     = cd_perfil_origem_p
      and  nr_seq_item_pront    = nr_seq_item_pront_p);

open C01;
loop
fetch C01 into
	nr_seq_template_w,
	ie_digitar_consulta_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin
	if (nr_seq_template_w IS NOT NULL AND nr_seq_template_w::text <> '') then
		begin
		select   nextval('perfil_item_pront_template_seq')
		into STRICT  nr_seq_item_pront_template_w
		;

		insert   into perfil_item_pront_template(nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item_perfil,
			nr_seq_template,
			ie_digitar_consulta
			)
		values (nr_seq_item_pront_template_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			nr_sequencia_w,
			nr_seq_template_w,
			ie_digitar_consulta_w
			);
		commit;
		end;
	end if;
	end;
end loop;
close C01;

open C02;
loop
fetch C02 into
	nr_seq_item_pasta_w,
	ds_pasta_instituicao_w;
EXIT WHEN NOT FOUND; /* apply on C02 */
	begin
	if (nr_seq_item_pasta_w IS NOT NULL AND nr_seq_item_pasta_w::text <> '')  then
		begin
		select   nextval('perfil_item_pront_pasta_seq')
		into STRICT  nr_sequencia_pasta_w
		;

		insert   into perfil_item_pront_pasta(nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item_perfil,
			nr_seq_item_pasta,
			ds_pasta_instituicao
			)
		values (nr_sequencia_pasta_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			nr_sequencia_w,
			nr_seq_item_pasta_w,
			ds_pasta_instituicao_w
			);
		commit;
		end;
	end if;
	end;
end loop;
close C02;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copia_item_prontuario_perfil (cd_perfil_origem_p bigint, cd_perfil_destino_p bigint, nr_seq_item_pront_p bigint, nm_usuario_p text) FROM PUBLIC;

