-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE importar_exame_lab_result (NR_PRESCRICAO_P bigint, NM_USUARIO_P text, DT_RESULTADO_P timestamp) AS $body$
DECLARE


nr_seq_resultado_w bigint;

BEGIN

	select	max(a.nr_seq_resultado)
	into STRICT	nr_seq_resultado_w
	from	exame_lab_resultado a
	where	a.nr_prescricao = NR_PRESCRICAO_P;
		if (coalesce(nr_seq_resultado_w::text, '') = '') then
			select	coalesce(max(nr_seq_resultado),0) + 1
			into STRICT	nr_seq_resultado_w
			from	exame_lab_resultado;
		end if;

	insert into exame_lab_resultado(nr_seq_resultado, dt_resultado, dt_atualizacao, nm_usuario, nr_prescricao)
	values (nr_seq_resultado_w,coalesce(DT_RESULTADO_P,clock_timestamp()), clock_timestamp(), NM_USUARIO_P, NR_PRESCRICAO_P);
	
	commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE importar_exame_lab_result (NR_PRESCRICAO_P bigint, NM_USUARIO_P text, DT_RESULTADO_P timestamp) FROM PUBLIC;

