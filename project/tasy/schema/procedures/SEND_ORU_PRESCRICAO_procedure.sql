-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE send_oru_prescricao ( nr_prescricao_p prescr_procedimento.nr_prescricao%type, nr_seq_exame_p prescr_procedimento.nr_seq_exame%type, nr_sequencia_p prescr_procedimento.nr_sequencia%type, ie_status_atend_p prescr_procedimento.ie_status_atend%type) AS $body$
DECLARE


integracao_tasy_w 	varchar(1) := 'N';
retorno_integracao_w 	text;
json_envio_w		text;
cd_estabelecimento_w	estabelecimento.CD_ESTABELECIMENTO%type;


BEGIN

	begin
	select cd_estabelecimento
	into STRICT   cd_estabelecimento_w
	from   prescr_medica
	where  nr_prescricao = nr_prescricao_p;

	exception
	when no_data_found then		
		cd_estabelecimento_w := 1;
	end;
	
	CALL wheb_usuario_pck.set_cd_estabelecimento(cd_estabelecimento_w);
	
	select obter_param_usuario_logado(9041,10)
	into STRICT integracao_tasy_w
	;
	
	

	if (integracao_tasy_w = 'S') then
		json_envio_w := obter_json_oru_prescricao(nr_prescricao_p, nr_seq_exame_p, nr_sequencia_p, ie_status_atend_p);
		
		if (json_envio_w <> '') then
			retorno_integracao_w := bifrost.send_integration_content('EPIMED_SEND_LAB_DATA', json_envio_w, obter_usuario_ativo);
		
		end if;
	end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE send_oru_prescricao ( nr_prescricao_p prescr_procedimento.nr_prescricao%type, nr_seq_exame_p prescr_procedimento.nr_seq_exame%type, nr_sequencia_p prescr_procedimento.nr_sequencia%type, ie_status_atend_p prescr_procedimento.ie_status_atend%type) FROM PUBLIC;

