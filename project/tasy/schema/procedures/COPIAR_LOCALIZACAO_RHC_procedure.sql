-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copiar_localizacao_rhc ( nr_seq_loc_origem_p bigint, nr_seq_loc_destino_p bigint, ie_tumor_primario_p text, ie_linfonodos_regional_p text, ie_metastase_distancia_p text, ie_estadio_p text, ie_imagem_p text, nm_usuario_p text) AS $body$
DECLARE


/*
IE_TUMOR_PRIMARIO_P = 'S' - Inclui aba Tumor Primário - Oraci em 20/10/2007 OS71940
IE_LINFONODOS_REGIONAL_P = 'S' - Inclui aba Linfonodos Regionais - Oraci em 20/10/2007 OS71940
IE_METASTASE_DISTANCIA_P = 'S' - Inclui aba Metástase a distância - Oraci em 20/10/2007 OS71940
IE_ESTADIO_P = 'S' - Inclui aba Estadio
IE_IMAGEM_P = 'S' - Inclui aba Imagem
*/
nr_sequencia_w	bigint;



BEGIN

if (ie_tumor_primario_p = 'S') then /* Oraci em 20/10/2007 OS71940 */
	insert into can_tnm_regra(
		nr_sequencia,
		nr_seq_loc_tnm,
		dt_atualizacao,
		nm_usuario,
		ie_classificacao_tnm,
		ie_componente_tnm,
		cd_tnm,
		ds_regra,
		ds_resumo_regra,
		cd_topografia,
		dt_atualizacao_nrec,
		nm_usuario_nrec)
	SELECT	nextval('can_tnm_regra_seq'),
		nr_seq_loc_destino_p,
		clock_timestamp(),
		nm_usuario_p,
		ie_classificacao_tnm,
		ie_componente_tnm,
		cd_tnm,
		ds_regra,
		ds_resumo_regra,
		cd_topografia,
		clock_timestamp(),
		nm_usuario_p
	from	can_tnm_regra
	where	nr_seq_loc_tnm = nr_seq_loc_origem_p
	and	ie_componente_tnm = 'T';

end if;

if (ie_linfonodos_regional_p = 'S') then /* Oraci em 20/10/2007 OS71940 */
	insert into can_tnm_regra(
		nr_sequencia,
		nr_seq_loc_tnm,
		dt_atualizacao,
		nm_usuario,
		ie_classificacao_tnm,
		ie_componente_tnm,
		cd_tnm,
		ds_regra,
		ds_resumo_regra,
		cd_topografia,
		dt_atualizacao_nrec,
		nm_usuario_nrec)
	SELECT	nextval('can_tnm_regra_seq'),
		nr_seq_loc_destino_p,
		clock_timestamp(),
		nm_usuario_p,
		ie_classificacao_tnm,
		ie_componente_tnm,
		cd_tnm,
		ds_regra,
		ds_resumo_regra,
		cd_topografia,
		clock_timestamp(),
		nm_usuario_p
	from	can_tnm_regra
	where	nr_seq_loc_tnm = nr_seq_loc_origem_p
	and	ie_componente_tnm = 'N';
end if;

if (ie_metastase_distancia_p = 'S') then /* Oraci em 20/10/2007 OS71940 */
	insert into can_tnm_regra(
		nr_sequencia,
		nr_seq_loc_tnm,
		dt_atualizacao,
		nm_usuario,
		ie_classificacao_tnm,
		ie_componente_tnm,
		cd_tnm,
		ds_regra,
		ds_resumo_regra,
		cd_topografia,
		dt_atualizacao_nrec,
		nm_usuario_nrec)
	SELECT	nextval('can_tnm_regra_seq'),
		nr_seq_loc_destino_p,
		clock_timestamp(),
		nm_usuario_p,
		ie_classificacao_tnm,
		ie_componente_tnm,
		cd_tnm,
		ds_regra,
		ds_resumo_regra,
		cd_topografia,
		clock_timestamp(),
		nm_usuario_p
	from	can_tnm_regra
	where	nr_seq_loc_tnm = nr_seq_loc_origem_p
	and	ie_componente_tnm = 'M';
end if;

if (ie_estadio_p = 'S') then

	insert into can_estadio(
		nr_sequencia,
		nr_seq_loc_tnm,
		dt_atualizacao,
		nm_usuario,
		cd_estadio,
		cd_tumor_primario,
		cd_linfonodo_regional,
		cd_metastase_distancia,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		cd_grau_histo)
	SELECT		nextval('can_estadio_seq'),
		nr_seq_loc_destino_p,
		clock_timestamp(),
		nm_usuario_p,
		cd_estadio,
		cd_tumor_primario,
		cd_linfonodo_regional,
		cd_metastase_distancia,
		clock_timestamp(),
		nm_usuario_p,
		cd_grau_histo
	from	can_estadio
	where	nr_seq_loc_tnm = nr_seq_loc_origem_p;
end if;


if (ie_imagem_p = 'S') then

	insert into can_tnm_imagem(
		nr_sequencia,
		nr_seq_loc_tnm,
		dt_atualizacao,
		nm_usuario,
		ds_titulo,
		ds_arquivo,
		dt_atualizacao_nrec,
		nm_usuario_nrec)
	SELECT	nextval('can_tnm_imagem_seq'),
		nr_seq_loc_destino_p,
		clock_timestamp(),
		nm_usuario_p,
		ds_titulo,
		ds_arquivo,
		clock_timestamp(),
		nm_usuario_p
	from	can_tnm_imagem
	where	nr_seq_loc_tnm = nr_seq_loc_origem_p;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copiar_localizacao_rhc ( nr_seq_loc_origem_p bigint, nr_seq_loc_destino_p bigint, ie_tumor_primario_p text, ie_linfonodos_regional_p text, ie_metastase_distancia_p text, ie_estadio_p text, ie_imagem_p text, nm_usuario_p text) FROM PUBLIC;

