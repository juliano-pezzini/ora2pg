-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_atualizar_item_audit_tws ( nr_seq_audit_item_p pls_auditoria_item.nr_sequencia%type, qt_ajuste_p pls_auditoria_item.qt_ajuste%type, ds_parecer_p text, ie_status_analise_p text, nm_usuario_p text, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) AS $body$
DECLARE


/*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:   Atualizar o item e inserir parecer da analise realizada pelo portal.
O commit e realizado na pls_inserir_parecer_auditor.
----------------------------------------------------------------------------------------------------------------------------------------------------
Locais de chamada direta: 
[  ]  Objetos do dicionario [ ] Tasy (Delphi/Java) [ x ] Portal [  ] Relatorios [ ] Outros:
 ----------------------------------------------------------------------------------------------------------------------------------------------------
Pontos de atencao:  
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/	

ie_origem_proced_w		procedimento.ie_origem_proced%type;
qt_original_w			pls_auditoria_item.qt_original%type;	
nr_seq_auditoria_w		pls_auditoria.nr_sequencia%type;
cd_procedimento_w		procedimento.cd_procedimento%type;
nr_seq_material_w		pls_material.nr_sequencia%type;


BEGIN

select	qt_original,
	ie_origem_proced,
	nr_seq_auditoria,
	coalesce(cd_procedimento, 0),
	coalesce(nr_seq_material, 0)
into STRICT	qt_original_w,
	ie_origem_proced_w,
	nr_seq_auditoria_w,
	cd_procedimento_w,
	nr_seq_material_w
from	pls_auditoria_item
where	nr_sequencia = nr_seq_audit_item_p;
	
if (qt_original_w <> qt_ajuste_p) then
	CALL pls_alterar_item_auditoria(	nr_seq_audit_item_p, cd_procedimento_w, ie_origem_proced_w,
					nr_seq_material_w, qt_ajuste_p, qt_ajuste_p,
					null, nm_usuario_p, null,
					null, null);
end if;
				
CALL pls_inserir_parecer_auditor(	nr_seq_audit_item_p, null, ds_parecer_p	,
				'AP', ie_status_analise_p, qt_ajuste_p,
				null, nm_usuario_p);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_atualizar_item_audit_tws ( nr_seq_audit_item_p pls_auditoria_item.nr_sequencia%type, qt_ajuste_p pls_auditoria_item.qt_ajuste%type, ds_parecer_p text, ie_status_analise_p text, nm_usuario_p text, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) FROM PUBLIC;

