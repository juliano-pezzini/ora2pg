-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE prc_stress_ulcer_caller ( dtinicio_p timestamp, dtfim_p timestamp, estabelecimento_p bigint, setor_p bigint, ano_p bigint, trimestre_p bigint, visao_p bigint, pessoa_p text) AS $body$
BEGIN
  INSERT INTO W_STRESS_ULCER_LOG(
    NR_SEQUENCIA, DT_INICIO, DT_FIM, CD_ESTAB, CD_SETOR, DT_ANO, NR_TRIMESTRE, IE_TIPO, CD_PESSOA_FISICA)
  VALUES (
    nextval('w_stress_ulcer_log_seq'), dtinicio_p, dtfim_p, coalesce(estabelecimento_p, 0), coalesce(setor_p, 0), ano_p, trimestre_p, visao_p, trim(both pessoa_p));
  --
  COMMIT;
  --
  IF VISAO_P = 3 AND coalesce(trim(both PESSOA_P)::text, '') = '' THEN
    RAISE EXCEPTION '%', 'The PATIENT CODE parameter is required when BY PATIENT is selected in the REPORT TYPE parameter.' USING ERRCODE = '45001';
  ELSE
    CALL PKG_STRESS_ULCER.RUN(dtinicio_p, dtfim_p, coalesce(estabelecimento_p, 0), coalesce(setor_p, 0), ano_p, trimestre_p, visao_p, trim(both pessoa_p));
  END IF;
  --
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE prc_stress_ulcer_caller ( dtinicio_p timestamp, dtfim_p timestamp, estabelecimento_p bigint, setor_p bigint, ano_p bigint, trimestre_p bigint, visao_p bigint, pessoa_p text) FROM PUBLIC;

