-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_reconst_diluicao_md ( ie_subtrair_volume_medic_w text, qt_volume_medic_w bigint, qt_conc_medic_w bigint, qt_dose_medic_w bigint, ie_dilui_vol_medic_w text, qt_referencia_aux_w bigint, nr_seq_acum_w bigint, ie_proporcao_w text, qt_unitaria_medic_w bigint, qt_referencia_ww bigint, qt_conv_ml_w INOUT bigint, qt_solucao_w INOUT bigint, qt_dose_diluicao_w INOUT bigint, nr_sequencia_w INOUT bigint, qt_medic_diluido_w INOUT bigint, qt_diluicao_w INOUT bigint, qt_referencia_w INOUT bigint, qt_minuto_aplicacao_w INOUT bigint ) AS $body$
BEGIN
    IF ( ie_subtrair_volume_medic_w = 'S' )
        AND ( qt_volume_medic_w > 0 )
    THEN
        qt_medic_diluido_w := coalesce(qt_medic_diluido_w,0) - coalesce(qt_volume_medic_w,0);
    END IF;

    IF ( coalesce(qt_conc_medic_w, 0) > 0 ) THEN
        qt_conv_ml_w := qt_medic_diluido_w;
        qt_solucao_w := ( dividir_md(qt_dose_medic_w , ( dividir_md(qt_conc_medic_w , qt_conv_ml_w) )));
    END IF;

    qt_dose_diluicao_w := qt_diluicao_w;
    IF ( coalesce(qt_referencia_w, 0) > 0 )
        AND ( coalesce(ie_dilui_vol_medic_w, 'N') = 'N' )
    THEN
        qt_referencia_w := qt_referencia_aux_w;
    END IF;

    nr_sequencia_w := nr_seq_acum_w + 1;
    IF ( coalesce(qt_referencia_w, 0) > 0 ) THEN
        IF ( ie_proporcao_w = 'SC' ) THEN
            qt_diluicao_w := qt_unitaria_medic_w * qt_referencia_w;
            IF ( coalesce(ie_dilui_vol_medic_w, 'N') = 'S' ) THEN
                qt_solucao_w := ( dividir_md(qt_dose_medic_w , ( dividir_md(qt_conc_medic_w , qt_medic_diluido_w) ) ) );
                qt_dose_diluicao_w := coalesce(qt_diluicao_w,0) - coalesce(qt_solucao_w,0);
                qt_referencia_w := qt_referencia_ww;
                qt_diluicao_w := qt_unitaria_medic_w * qt_referencia_w;
            END IF;

        ELSIF ( ie_proporcao_w = 'ST' ) THEN
            qt_diluicao_w := qt_unitaria_medic_w * qt_referencia_w;
            qt_minuto_aplicacao_w := qt_minuto_aplicacao_w * qt_referencia_w;
        END IF;
    END IF;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_reconst_diluicao_md ( ie_subtrair_volume_medic_w text, qt_volume_medic_w bigint, qt_conc_medic_w bigint, qt_dose_medic_w bigint, ie_dilui_vol_medic_w text, qt_referencia_aux_w bigint, nr_seq_acum_w bigint, ie_proporcao_w text, qt_unitaria_medic_w bigint, qt_referencia_ww bigint, qt_conv_ml_w INOUT bigint, qt_solucao_w INOUT bigint, qt_dose_diluicao_w INOUT bigint, nr_sequencia_w INOUT bigint, qt_medic_diluido_w INOUT bigint, qt_diluicao_w INOUT bigint, qt_referencia_w INOUT bigint, qt_minuto_aplicacao_w INOUT bigint ) FROM PUBLIC;

