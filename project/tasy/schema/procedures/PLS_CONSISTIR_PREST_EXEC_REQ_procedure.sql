-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_consistir_prest_exec_req ( nr_seq_requisicao_p bigint, nr_seq_prestador_exec_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text, nr_seq_paramentro_1 bigint, nr_seq_paramentro_2 bigint) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: Realizar a consistência do prestador que realizará a execução da requisição.
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:Performance.
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
ie_area_coberta_w		varchar(2)	:= 'S';
nr_seq_plano_w			bigint;
nr_seq_segurado_w		pls_segurado.nr_sequencia%type;


BEGIN

begin
	select	nr_seq_plano,
		nr_seq_segurado
	into STRICT	nr_seq_plano_w,
		nr_seq_segurado_w
	from	pls_requisicao
	where	nr_sequencia	= nr_seq_requisicao_p;
exception
when others then
	nr_seq_plano_w	:= 0;
end;

--OS 1156655 - Rotina já é chamada na pls_tiss_consistir_prestador
--pls_consistir_area_prestador(null,null,nr_seq_requisicao_p,ie_consistencia_w);
ie_area_coberta_w := pls_consistir_area_atuacao(nr_seq_plano_w, null, nr_seq_prestador_exec_p, null, ie_area_coberta_w, nr_seq_segurado_w);

if (ie_area_coberta_w 	= 'N') then
	CALL pls_gravar_requisicao_glosa(	'1215', nr_seq_requisicao_p, null,
					null, 'Prestador executor fora da área de atuação', nm_usuario_p,
					nr_seq_prestador_exec_p, cd_estabelecimento_p, null,
					null);
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_consistir_prest_exec_req ( nr_seq_requisicao_p bigint, nr_seq_prestador_exec_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text, nr_seq_paramentro_1 bigint, nr_seq_paramentro_2 bigint) FROM PUBLIC;

