-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_guia_deteccoes_nom ( dt_inicio_p timestamp, dt_final_p timestamp, nm_usuario_p text) AS $body$
DECLARE

	qt_linha_w    bigint;

C01 CURSOR FOR
	SELECT
		--prestador servico--
		pj.cd_internacional clues,
		coalesce(substr(upper(pj.cd_curp),1,18), 'XXXX999999XXXXXX99') curpprestador,
		coalesce(substr(upper(pj.ds_razao_social),1,50), 'XX') nombreprestador,
		coalesce(substr(upper(pj.nm_fantasia),1,50), 'XX') primerapellidoprestador,
		coalesce(substr(upper(pj.ds_nome_abrev),1,50), 'XX') segundoapellidoprestador,
		obter_dados_tipo_profissional(b.nr_atendimento, 'codigo') tipopersonal,
		obter_dados_tipo_profissional(b.nr_atendimento, 'tipo') especificatipopersonal,
		obter_dados_tipo_profissional(b.nr_atendimento, 'cedula') cedulaprofesional,
		CASE WHEN b.ie_clinica=2 THEN 3 WHEN b.ie_clinica=1 THEN 4 WHEN b.ie_clinica=3 THEN 5 WHEN b.ie_clinica=1000 THEN 6 WHEN b.ie_clinica=1001 THEN 7 WHEN b.ie_clinica=1002 THEN 8 WHEN b.ie_clinica=1004 THEN 9 WHEN b.ie_clinica=1005 THEN 13 WHEN b.ie_clinica=1006 THEN 14 WHEN b.ie_clinica=4 THEN 16 WHEN b.ie_clinica=1007 THEN 17 WHEN b.ie_clinica=1008 THEN 22 WHEN b.ie_clinica=1009 THEN 23 END  servicioatencion,
		null especificarservicio,
		--dados paciente--
		coalesce(substr(upper(pf_p.cd_curp),1,18), 'XXXX999999XXXXXX99') curppaciente,
		substr(upper(y.ds_given_name),1,50) nombre,
		coalesce(substr(upper(y.ds_component_name_1),1,50), 'XX') primerapellido,
		coalesce(substr(upper(y.ds_component_name_2),1,50), 'XX') segundoapellido,
		to_char(pf_p.dt_nascimento, 'dd/mm/yyyy') fechanacimiento,
		obter_dados_cat_entidade(pf_p.cd_pessoa_fisica, 'CD_ENTIDADE') entidadnacimiento,
		case
			when (obter_idade(pf_p.dt_nascimento, b.dt_inicio_atendimento, 'A') IS NOT NULL AND (obter_idade(pf_p.dt_nascimento, b.dt_inicio_atendimento, 'A'))::text <> '')
			then coalesce(obter_idade_imc_nom(b.nr_atendimento,pf_p.dt_nascimento,b.dt_inicio_atendimento,'IDADE'),-1)
			else 999
		end as edad,
		case
			when (obter_idade(pf_p.dt_nascimento, b.dt_inicio_atendimento, 'A') IS NOT NULL AND (obter_idade(pf_p.dt_nascimento, b.dt_inicio_atendimento, 'A'))::text <> '')
			then obter_idade_imc_nom(b.nr_atendimento,pf_p.dt_nascimento,b.dt_inicio_atendimento,'CLAVEEDAD')
			else 9
		end as claveedad,
		CASE WHEN pf_p.ie_sexo='M' THEN  1  WHEN pf_p.ie_sexo='F' THEN  2  ELSE 9 END  sexo,
		CASE WHEN pf_p.nr_seq_cor_pele=201 THEN  1  ELSE 0 END  seconsideraindigena,
		-- --derechohaniencia--
		(CASE WHEN (pf_p.nr_spss IS NOT NULL AND pf_p.nr_spss::text <> '') THEN 1 ELSE 0 END) spss,
		case
			when (pf_p.nr_spss IS NOT NULL AND pf_p.nr_spss::text <> '')
			then substr(pf_p.nr_spss,1,13)
		end as numeroafiliacionspss,
		CASE WHEN n.cd_tipo_convenio_mx=13 THEN  1  ELSE 0 END  prospera,
		CASE WHEN n.cd_tipo_convenio_mx=13 THEN  elimina_caractere_especial(substr(p.nr_doc_convenio,1,16)) END  folioprospera,
		CASE WHEN n.cd_tipo_convenio_mx=2 THEN  1  ELSE 0 END  imss,
		CASE WHEN n.cd_tipo_convenio_mx=2 THEN  substr(p.nr_doc_convenio,1,11) END  numeroafiliacionimss,
		CASE WHEN n.cd_tipo_convenio_mx=3 THEN  1  ELSE 0 END  issste,
		CASE WHEN n.cd_tipo_convenio_mx=3 THEN  substr(p.nr_doc_convenio,1,13) END  numeroafiliacionissste,
		CASE WHEN n.cd_tipo_convenio_mx=15 THEN  1  ELSE 0 END  otraafiliacion,
		CASE WHEN n.cd_tipo_convenio_mx=15 THEN  substr(p.nr_doc_convenio,1,15) END  numerootraafiliacion,
		---- outros dados--
		coalesce(coalesce(obter_sinal_vital(b.nr_atendimento, 'PESO'), pf_p.qt_peso), '999') peso,
		coalesce(coalesce(obter_sinal_vital(b.nr_atendimento,'ALTURA'), pf_p.qt_altura_cm), '999') talla,

		obter_dados_deficiencia(pf_p.cd_pessoa_fisica, 'tipo') tipodificultad,
		obter_dados_deficiencia(pf_p.cd_pessoa_fisica, 'grau') gradodificultad,
		obter_dados_deficiencia(pf_p.cd_pessoa_fisica, 'origem') origendificultad,

		-1 migrante,
		coalesce(to_char((SELECT max(ddp.dt_diagnostico) from diagnostico_doenca ddp where ddp.nr_atendimento = b.nr_atendimento and ddp.ie_classificacao_doenca = 'P'), 'dd/mm/yyyy'), null) fechadeteccion,
		case
			when obter_idade(pf_p.dt_nascimento, b.dt_inicio_atendimento, 'A') >= 20 and (select max(ddp.cd_doenca) from diagnostico_doenca ddp where b.nr_atendimento = ddp.nr_atendimento) is not null
			then
				case
					when exists (select 1 from cid_doenca cc1, diagnostico_doenca ddp where cc1.ie_doenca_cronica_mx = 'DIABT' and cc1.cd_doenca_cid like ddp.cd_doenca and ddp.nr_atendimento = b.nr_atendimento)
					then 0
					else 1
				end
			else -1
		end as diabetesmellitus,
		case
			when obter_idade(pf_p.dt_nascimento, b.dt_inicio_atendimento, 'A') >= 20 and (select max(ddp.cd_doenca) from diagnostico_doenca ddp where b.nr_atendimento = ddp.nr_atendimento) is not null
			then
				case
					when exists (select 1 from cid_doenca cc1, diagnostico_doenca ddp where cc1.ie_doenca_cronica_mx = 'HIPAS' and cc1.cd_doenca_cid like ddp.cd_doenca and ddp.nr_atendimento = b.nr_atendimento)
					then 0
					else 1
				end
			else -1
		end as hipertensionarterial,
		case
			when obter_idade(pf_p.dt_nascimento, b.dt_inicio_atendimento, 'A') >= 20 and (select max(ddp.cd_doenca) from diagnostico_doenca ddp where b.nr_atendimento = ddp.nr_atendimento) is not null
			then
				case
					when exists (select 1 from cid_doenca cc1, diagnostico_doenca ddp where cc1.ie_doenca_cronica_mx = 'OBSDA' and cc1.cd_doenca_cid like ddp.cd_doenca and ddp.nr_atendimento = b.nr_atendimento)
					then 0
					else 1
				end
			else -1
		end as obesidad,
		case
			when obter_idade(pf_p.dt_nascimento, b.dt_inicio_atendimento, 'A') >= 20 and (select max(ddp.cd_doenca) from diagnostico_doenca ddp where b.nr_atendimento = ddp.nr_atendimento) is not null
			then
				case
					when exists (select 1 from cid_doenca cc1, diagnostico_doenca ddp where cc1.ie_doenca_cronica_mx = 'LIPDM' and cc1.cd_doenca_cid like ddp.cd_doenca and ddp.nr_atendimento = b.nr_atendimento)
					then 0
					else 1
				end
			else -1
		end as dislipidemias,
		case
			when obter_idade(pf_p.dt_nascimento, b.dt_inicio_atendimento, 'A') >= 60 and (select max(ddp.cd_doenca) from diagnostico_doenca ddp where b.nr_atendimento = ddp.nr_atendimento) is not null
			then
				case
					when exists (select 1 from cid_doenca cc1, diagnostico_doenca ddp where cc1.ie_doenca_cronica_mx = 'DPRSS' and cc1.cd_doenca_cid like ddp.cd_doenca and ddp.nr_atendimento = b.nr_atendimento)
					then 0
					else 1
				end
			else -1
		end as depresion,
		case
			when obter_idade(pf_p.dt_nascimento, b.dt_inicio_atendimento, 'A') >= 60 and (select max(ddp.cd_doenca) from diagnostico_doenca ddp where b.nr_atendimento = ddp.nr_atendimento) is not null
			then
				case
					when exists (select 1 from cid_doenca cc1, diagnostico_doenca ddp where cc1.ie_doenca_cronica_mx = 'ALTME' and cc1.cd_doenca_cid like ddp.cd_doenca and ddp.nr_atendimento = b.nr_atendimento)
					then 0
					else 1
				end
			else -1
		end as alteracionmemoria,
		coalesce((select CASE WHEN ddp.ie_sintomatico='S' THEN  0  ELSE 1 END  from cid_doenca cc1, diagnostico_doenca ddp where cc1.ie_doenca_cronica_mx = 'STRSP' and cc1.cd_doenca_cid like ddp.cd_doenca and ddp.nr_atendimento = b.nr_atendimento), '-1') sintomaticorespiratorio,
		case
			when(select max(ddp.cd_doenca) from diagnostico_doenca ddp where b.nr_atendimento = ddp.nr_atendimento) is not null
			then
				case
					when exists (select 1 from cid_doenca cc1, diagnostico_doenca ddp where cc1.ie_doenca_cronica_mx = 'ALCOL' and cc1.cd_doenca_cid like ddp.cd_doenca and ddp.nr_atendimento = b.nr_atendimento)
					then 0
					else 1
				end
			else -1
		end as alcoholismo,
		case
			when(select max(ddp.cd_doenca) from diagnostico_doenca ddp where b.nr_atendimento = ddp.nr_atendimento) is not null
			then
				case
					when exists (select 1 from cid_doenca cc1, diagnostico_doenca ddp where cc1.ie_doenca_cronica_mx = 'TABAC' and cc1.cd_doenca_cid like ddp.cd_doenca and ddp.nr_atendimento = b.nr_atendimento)
					then 0
					else 1
				end
			else -1
		end as tabaquismo,
		case
			when(select max(ddp.cd_doenca) from diagnostico_doenca ddp where b.nr_atendimento = ddp.nr_atendimento) is not null
			then
				case
					when exists (select 1 from cid_doenca cc1, diagnostico_doenca ddp where cc1.ie_doenca_cronica_mx = 'FARMA' and cc1.cd_doenca_cid like ddp.cd_doenca and ddp.nr_atendimento = b.nr_atendimento)
					then 0
					else 1
				end
			else -1
		end as farmacos,
		case
			when(select max(ddp.cd_doenca) from diagnostico_doenca ddp where b.nr_atendimento = ddp.nr_atendimento) is not null
			then
				case
					when exists (select 1 from cid_doenca cc1, diagnostico_doenca ddp where cc1.ie_doenca_cronica_mx = 'INCUR' and cc1.cd_doenca_cid like ddp.cd_doenca and ddp.nr_atendimento = b.nr_atendimento)
					then 0
					else 1
				end
			else -1
		end as incontinenciaurinaria,
		case
			when obter_idade(pf_p.dt_nascimento, b.dt_inicio_atendimento, 'A') >= 60 and (select max(ddp.cd_doenca) from diagnostico_doenca ddp where b.nr_atendimento = ddp.nr_atendimento) is not null
			then
				case
					when exists (select 1 from cid_doenca cc1, diagnostico_doenca ddp where cc1.ie_doenca_cronica_mx = 'SINDC' and cc1.cd_doenca_cid like ddp.cd_doenca and ddp.nr_atendimento = b.nr_atendimento)
					then 0
					else 1
				end
			else -1
		end as caida60ymas,
		case
			when obter_idade(pf_p.dt_nascimento, b.dt_inicio_atendimento, 'A') >= 50 and (select max(ddp.cd_doenca) from diagnostico_doenca ddp where b.nr_atendimento = ddp.nr_atendimento) is not null
			then
				case
					when exists (select 1 from cid_doenca cc1, diagnostico_doenca ddp where cc1.ie_doenca_cronica_mx = 'RISFO' and cc1.cd_doenca_cid like ddp.cd_doenca and ddp.nr_atendimento = b.nr_atendimento)
					then 0
					else 1
				end
			else -1
		end as riesgofractura,
		case
			when obter_idade(pf_p.dt_nascimento, b.dt_inicio_atendimento, 'A') >= 50 and (select max(ddp.cd_doenca) from diagnostico_doenca ddp where b.nr_atendimento = ddp.nr_atendimento) is not null
			then
				case
					when exists (select 1 from cid_doenca cc1, diagnostico_doenca ddp where cc1.ie_doenca_cronica_mx = 'HIV' and cc1.cd_doenca_cid like ddp.cd_doenca and ddp.nr_atendimento = b.nr_atendimento)
					then 0
					else 1
				end
			else -1
		end as vih,
		case
			when(select max(ddp.cd_doenca) from diagnostico_doenca ddp where b.nr_atendimento = ddp.nr_atendimento) is not null
			then
				case
					when exists (select 1 from cid_doenca cc1, diagnostico_doenca ddp where cc1.ie_doenca_cronica_mx = 'GRREA' and cc1.cd_doenca_cid like ddp.cd_doenca and ddp.nr_atendimento = b.nr_atendimento)
					then 0
					else 1
				end
			else -1
		end as gonorrea,
		case
			when(select max(ddp.cd_doenca) from diagnostico_doenca ddp where b.nr_atendimento = ddp.nr_atendimento) is not null
			then
				case
					when exists (select 1 from cid_doenca cc1, diagnostico_doenca ddp where (cc1.cd_doenca in ('A54', 'N74') or cc1.cd_doenca like '%A59%' or cc1.cd_doenca like '%A70%') and cc1.cd_doenca_cid like ddp.cd_doenca and ddp.nr_atendimento = b.nr_atendimento)
					then 0
					else 1
				end
			else -1
		end as itssecretoras,
		case
			when(select max(ddp.cd_doenca) from diagnostico_doenca ddp where b.nr_atendimento = ddp.nr_atendimento) is not null
			then
				case
					when exists (select 1 from cid_doenca cc1, diagnostico_doenca ddp where cc1.cd_doenca in ('B081','B977')  and cc1.cd_doenca_cid like ddp.cd_doenca and b.nr_atendimento = ddp.nr_atendimento)
					then 0
					else 1
				end
			else -1
		end as itsulcerativas,
		case
			when(select max(ddp.cd_doenca) from diagnostico_doenca ddp where b.nr_atendimento = ddp.nr_atendimento) is not null
			then
				case
					when exists (select 1 from cid_doenca cc1, diagnostico_doenca ddp where cc1.cd_doenca in ('B97.7', 'A58', 'A60') and cc1.cd_doenca_cid like ddp.cd_doenca and ddp.nr_atendimento = b.nr_atendimento)
					then 0
					else 1
				end
			else -1
		end as itstumorales,
		case
			when(select max(ddp.cd_doenca) from diagnostico_doenca ddp where b.nr_atendimento = ddp.nr_atendimento) is not null
			then
				case
					when exists (select 1 from cid_doenca cc1, diagnostico_doenca ddp where cc1.ie_doenca_cronica_mx = 'SIFIL' and cc1.cd_doenca_cid like ddp.cd_doenca and ddp.nr_atendimento = b.nr_atendimento)
					then 0
					else 1
				end
			else -1
		end as sifilis,
		case
			when(select max(ddp.cd_doenca) from diagnostico_doenca ddp where b.nr_atendimento = ddp.nr_atendimento) is not null
			then
				case
					when exists (select 1 from cid_doenca cc1, diagnostico_doenca ddp where cc1.ie_doenca_cronica_mx = 'SINDT' and cc1.cd_doenca_cid like ddp.cd_doenca and ddp.nr_atendimento = b.nr_atendimento)
					then 0
					else 1
				end
			else -1
		end as sospechasindrometurner,
		case
			when obter_idade(pf_p.dt_nascimento, b.dt_inicio_atendimento, 'A') >= 15 and pf_p.ie_sexo = 'F'
			then
				case
					when exists (select 1 from sinan_inf_violencia siv, notificacao_sinan nf where siv.nr_seq_notificacao = nf.nr_sequencia and nf.nr_atendimento = b.nr_atendimento and ie_tipo_violencia = 2)
					then 0
					else 1
				end
			else -1
		end as violenciafamiliar,
		case
			when obter_idade(pf_p.dt_nascimento, b.dt_inicio_atendimento, 'A') >= 15 and pf_p.ie_sexo = 'M'
			then
				case
					when exists (select 1 from cid_doenca cc1, diagnostico_doenca ddp where cc1.ie_doenca_cronica_mx = 'HIPPR' and cc1.cd_doenca_cid like ddp.cd_doenca and ddp.nr_atendimento = b.nr_atendimento)
					then 0
					else 1
				end
			else -1
		end as hiperplasiaprostatica,
		0 tirasembarazadassanas,
		0 tirasdeteccion,
		0 tirascontrol,
		0 reactivosantigenoprostatico,
		0 cartillavacunacion,
		0 telemedicina,
		b.dt_entrada dt_entrada,
		b.nr_atendimento nr_atendimento
	FROM table(pkg_name_utils.search_names_legacy('', 'main')) y, pessoa_juridica pj, pessoa_fisica pf_m, atend_categoria_convenio p, medico m, estabelecimento e, categoria_convenio cc, atendimento_paciente b, pessoa_fisica pf_p
LEFT OUTER JOIN sus_municipio sm ON (pf_p.cd_municipio_ibge = sm.cd_municipio_ibge)
LEFT OUTER JOIN cat_entidade ce ON (sm.nr_seq_entidade_mx = ce.nr_sequencia)
, convenio n
LEFT OUTER JOIN cat_derechohabiencia k ON (n.cd_tipo_convenio_mx = k.nr_sequencia)
WHERE b.nr_atendimento  	= p.nr_atendimento and pj.cd_cgc 		= e.cd_cgc and b.cd_estabelecimento 	= e.cd_estabelecimento and b.cd_pessoa_fisica	= pf_p.cd_pessoa_fisica and b.cd_medico_resp 	= m.cd_pessoa_fisica and pf_m.cd_pessoa_fisica 	= m.cd_pessoa_fisica   and p.cd_convenio 		= cc.cd_convenio and p.cd_categoria 		= cc.cd_categoria and n.cd_convenio 		= cc.cd_convenio  and y.nr_sequencia 		= pf_p.nr_seq_person_name and b.dt_entrada between 	dt_inicio_p and dt_final_p;


BEGIN

	delete from w_geracao_guia
	where nm_usuario = nm_usuario_p;

	commit;

	for r_c01 in C01 loop
	begin

		qt_linha_w := C01%ROWCOUNT;

		CALL grava_campos_nom(qt_linha_w, 'clues', r_c01.clues, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'curpprestador', r_c01.curpprestador, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'nombreprestador', r_c01.nombreprestador, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'primerapellidoprestador', r_c01.primerapellidoprestador, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'segundoapellidoprestador', r_c01.segundoapellidoprestador, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'tipopersonal', r_c01.tipopersonal, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'especificatipopersonal', r_c01.especificatipopersonal, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'cedulaprofesional', r_c01.cedulaprofesional, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'servicioatencion', r_c01.servicioatencion, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'especificarservicio', r_c01.especificarservicio, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'curppaciente', r_c01.curppaciente, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'nombre', r_c01.nombre, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'primerapellido', r_c01.primerapellido, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'segundoapellido', r_c01.segundoapellido, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'fechanacimiento', r_c01.fechanacimiento, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'entidadnacimiento', r_c01.entidadnacimiento, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'edad', r_c01.edad, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'claveedad', r_c01.claveedad, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'sexo', r_c01.sexo, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'seconsideraindigena', r_c01.seconsideraindigena, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'spss', r_c01.spss, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'numeroafiliacionspss', r_c01.numeroafiliacionspss, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'prospera', r_c01.prospera, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'folioprospera', r_c01.folioprospera, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'imss', r_c01.imss, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'numeroafiliacionimss', r_c01.numeroafiliacionimss, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'issste', r_c01.issste, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'numeroafiliacionissste', r_c01.numeroafiliacionissste, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'otraafiliacion', r_c01.otraafiliacion, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'numerootraafiliacion', r_c01.numerootraafiliacion, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'peso', r_c01.peso, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'talla', r_c01.talla, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'tipodificultad', r_c01.tipodificultad, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'gradodificultad', r_c01.gradodificultad, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'origendificultad', r_c01.origendificultad, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'migrante', r_c01.migrante, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'fechadeteccion', r_c01.fechadeteccion, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'diabetesmellitus', r_c01.diabetesmellitus, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'hipertensionarterial', r_c01.hipertensionarterial, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'obesidad', r_c01.obesidad, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'dislipidemias', r_c01.dislipidemias, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'depresion', r_c01.depresion, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'alteracionmemoria', r_c01.alteracionmemoria, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'sintomaticorespiratorio', r_c01.sintomaticorespiratorio, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'alcoholismo', r_c01.alcoholismo, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'tabaquismo', r_c01.tabaquismo, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'farmacos', r_c01.farmacos, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'incontinenciaurinaria', r_c01.incontinenciaurinaria, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'caida60ymas', r_c01.caida60ymas, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'riesgofractura', r_c01.riesgofractura, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'vih', r_c01.vih, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'gonorrea', r_c01.gonorrea, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'itssecretoras', r_c01.itssecretoras, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'itsulcerativas', r_c01.itsulcerativas,  47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'itstumorales', r_c01.itstumorales, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'sifilis', r_c01.sifilis, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'sospechasindrometurner', r_c01.sospechasindrometurner, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'violenciafamiliar', r_c01.violenciafamiliar, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'hiperplasiaprostatica', r_c01.hiperplasiaprostatica, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'tirasembarazadassanas', r_c01.tirasembarazadassanas, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'tirasdeteccion', r_c01.tirasdeteccion, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'tirascontrol', r_c01.tirascontrol, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'reactivosantigenoprostatico', r_c01.reactivosantigenoprostatico, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'cartillavacunacion', r_c01.cartillavacunacion, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'telemedicina', r_c01.telemedicina, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'dt_entrada', r_c01.dt_entrada, 47, nm_usuario_p);
		CALL grava_campos_nom(qt_linha_w, 'nr_atendimento', r_c01.nr_atendimento, 47, nm_usuario_p);

	end;

   END LOOP;

 end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_guia_deteccoes_nom ( dt_inicio_p timestamp, dt_final_p timestamp, nm_usuario_p text) FROM PUBLIC;

