-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pcs_copiar_estrutura_estab (cd_estab_origem_p bigint, cd_estab_destino_p bigint, nr_seq_grupamento_p bigint, nm_usuario_p text) AS $body$
DECLARE


cd_material_w			pcs_estrutura_segmento.cd_material%type;
ds_grupamento_w			pcs_estrutura_segmento.ds_grupamento%type;
ds_segmento_w			pcs_estrutura_segmento.ds_segmento%type;
ie_curva_pcs_w			pcs_estrutura_segmento.ie_curva_pcs%type;
ie_situacao_w			pcs_estrutura_segmento.ie_situacao%type;
nr_seq_grupamento_w		pcs_estrutura_segmento.nr_seq_grupamento%type;
nr_seq_segmento_w		pcs_estrutura_segmento.nr_seq_segmento%type;
nr_sequencia_w			pcs_estrutura_segmento.nr_sequencia%type;
qt_maxima_w			pcs_estrutura_segmento.qt_maxima%type;
qt_minima_w			pcs_estrutura_segmento.qt_minima%type;


BEGIN


delete from pcs_estrutura_segmento
where	nr_seq_grupamento = nr_seq_grupamento_p
and	cd_estabelecimento = cd_estab_destino_p;

insert into pcs_estrutura_segmento(
	cd_material,
	ds_grupamento,
	ds_segmento,
	dt_atualizacao,
	dt_atualizacao_nrec,
	ie_curva_pcs,
	ie_situacao,
	nm_usuario_nrec,
	nm_usuario,
	nr_seq_grupamento,
	nr_seq_segmento,
	nr_sequencia,
	qt_maxima,
	qt_minima,
	cd_estabelecimento)
SELECT 	cd_material,
	ds_grupamento,
	ds_segmento,
	clock_timestamp(),
	clock_timestamp(),
	ie_curva_pcs,
	ie_situacao,
	nm_usuario_p,
	nm_usuario_p,
	nr_seq_grupamento,
	nr_seq_segmento,
	nextval('pcs_estrutura_segmento_seq'),
	qt_maxima,
	qt_minima,
	cd_estab_destino_p
from	pcs_estrutura_segmento a
where	nr_seq_grupamento = nr_seq_grupamento_p
and	cd_estabelecimento = cd_estab_origem_p;


commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pcs_copiar_estrutura_estab (cd_estab_origem_p bigint, cd_estab_destino_p bigint, nr_seq_grupamento_p bigint, nm_usuario_p text) FROM PUBLIC;

