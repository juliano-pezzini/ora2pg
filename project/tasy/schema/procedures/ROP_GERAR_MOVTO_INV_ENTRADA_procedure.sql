-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE rop_gerar_movto_inv_entrada ( nr_seq_inventario_p bigint, nr_seq_roupa_p bigint, qt_inventario_p bigint, cd_local_p bigint, cd_operacao_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text, nr_movimento_p INOUT bigint) AS $body$
DECLARE

 
cd_operacao_w			bigint;
nr_movimento_w			bigint;

 

BEGIN 
 
nr_movimento_w := coalesce(nr_movimento_p,0);
 
if (nr_movimento_w = 0) then 
		 
	select	nextval('rop_lote_movto_seq') 
	into STRICT	nr_movimento_w 
	;
	 
	insert into rop_lote_movto( 
		nr_sequencia, 
		cd_estabelecimento, 
		dt_atualizacao, 
		nm_usuario, 
		dt_atualizacao_nrec, 
		nm_usuario_nrec, 
		dt_registro, 
		nr_seq_operacao, 
		cd_pessoa_fisica, 
		nr_seq_local, 
		dt_liberacao, 
		ds_observacao) 
	values (	nr_movimento_w, 
		cd_estabelecimento_p, 
		clock_timestamp(), 
		nm_usuario_p, 
		clock_timestamp(), 
		nm_usuario_p, 
		trunc(clock_timestamp(),'dd'), 
		cd_operacao_p, 
		obter_pessoa_fisica_usuario(nm_usuario_p,'C'), 
		cd_local_p, 
		null, 
		wheb_mensagem_pck.get_Texto(802124, 'NR_SEQ_INVENTARIO_P='|| NR_SEQ_INVENTARIO_P));		
		 
end if;
 
insert into rop_movto_roupa( 
	nr_sequencia, 
	nr_seq_lote, 
	dt_atualizacao, 
	nm_usuario, 
	dt_atualizacao_nrec, 
	nm_usuario_nrec, 
	nr_seq_roupa, 
	dt_origem, 
	cd_estabelecimento, 
	ie_oper_correta, 
	qt_roupa) 
values (	nextval('rop_movto_roupa_seq'), 
	nr_movimento_w, 
	clock_timestamp(), 
	nm_usuario_p, 
	clock_timestamp(), 
	nm_usuario_p, 
	nr_seq_roupa_p, 
	trunc(clock_timestamp(),'dd'), 
	cd_estabelecimento_p, 
	'S', 
	qt_inventario_p);
 
commit;
 
nr_movimento_p	:= coalesce(nr_movimento_w,0);
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE rop_gerar_movto_inv_entrada ( nr_seq_inventario_p bigint, nr_seq_roupa_p bigint, qt_inventario_p bigint, cd_local_p bigint, cd_operacao_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text, nr_movimento_p INOUT bigint) FROM PUBLIC;

