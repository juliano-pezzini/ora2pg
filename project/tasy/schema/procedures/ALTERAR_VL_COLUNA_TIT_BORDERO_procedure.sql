-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE alterar_vl_coluna_tit_bordero ( nr_bordero_p bigint, nr_titulo_p bigint, ie_origem_p bigint, ie_destino_p bigint, nm_usuario_p text) AS $body$
DECLARE


/*
ie_origem_p e ie_destino_p
0 - Valor a baixar
1 - Valor desconto
2 - Valor cambial passivo
3 - Valor perdas
4 - Valor glosa
*/
vl_abaixar_w		double precision;
vl_cambial_passivo_w	double precision;
vl_desconto_w		double precision;
vl_glosa_w		double precision;
vl_perdas_w		double precision;

vl_origem_w		double precision;

ie_continua_w		varchar(1) := 'S';


BEGIN
begin
select	coalesce(vl_abaixar,0),
	coalesce(vl_cambial_passivo,0),
	coalesce(vl_desconto,0),
	coalesce(vl_glosa,0),
	coalesce(vl_perdas,0)
into STRICT	vl_abaixar_w,
	vl_cambial_passivo_w,
	vl_desconto_w,
	vl_glosa_w,
	vl_perdas_w
from	BORDERO_TIT_REC
where	nr_titulo = nr_titulo_p
and	nr_bordero = nr_bordero_p;
exception
when others then
	ie_continua_w := 'N';
end;

if (ie_continua_w = 'S') then
	begin
	if (ie_origem_p = 0) then
		vl_origem_w 	:= vl_abaixar_w;
		vl_abaixar_w	:= 0;
	elsif (ie_origem_p = 1) then
		vl_origem_w 	:= vl_desconto_w;
		vl_desconto_w	:= 0;
	elsif (ie_origem_p = 2) then
		vl_origem_w 		:= vl_cambial_passivo_w;
		vl_cambial_passivo_w	:= 0;
	elsif (ie_origem_p = 3) then
		vl_origem_w 	:= vl_perdas_w;
		vl_perdas_w	:= 0;
	elsif (ie_origem_p = 4) then
		vl_origem_w 	:= vl_glosa_w;
		vl_glosa_w	:= 0;
	end if;

	if (ie_destino_p = 0) then
		vl_abaixar_w	:= vl_abaixar_w + vl_origem_w;
	elsif (ie_destino_p = 1) then
		vl_desconto_w	:= vl_desconto_w + vl_origem_w;
	elsif (ie_destino_p = 2) then
		vl_cambial_passivo_w	:= vl_cambial_passivo_w + vl_origem_w;
	elsif (ie_destino_p = 3) then
		vl_perdas_w	:= vl_perdas_w + vl_origem_w;
	elsif (ie_destino_p = 4) then
		vl_glosa_w	:= vl_glosa_w + vl_origem_w;
	end if;

	update	BORDERO_TIT_REC
	set	vl_abaixar	= vl_abaixar_w,
		vl_cambial_passivo = vl_cambial_passivo_w,
		vl_desconto	= vl_desconto_w,
		vl_glosa	= vl_glosa_w,
		vl_perdas	= vl_perdas_w
	where	nr_titulo	= nr_titulo_p
	and	nr_bordero	= nr_bordero_p;
	end;
end if;

commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE alterar_vl_coluna_tit_bordero ( nr_bordero_p bigint, nr_titulo_p bigint, ie_origem_p bigint, ie_destino_p bigint, nm_usuario_p text) FROM PUBLIC;

