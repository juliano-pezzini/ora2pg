-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cpoe_rep_gerar_proc_glic ( nr_prescricao_p bigint, nr_seq_procedimento_p bigint, nr_atendimento_p bigint, nr_seq_cpoe_procedimento_p bigint, nm_usuario_p text, cd_pessoa_fisica_p cpoe_proc_glic.cd_pessoa_fisica%type default null) AS $body$
DECLARE


nr_seq_protocolo_w				prescr_proc_glic.nr_seq_protocolo%type;
qt_glic_inic_w           	prescr_proc_glic.qt_glic_inic%type;
qt_glic_fim_w            	prescr_proc_glic.qt_glic_fim%type;
qt_ui_insulina_w          prescr_proc_glic.qt_ui_insulina%type;
qt_glicose_w              prescr_proc_glic.qt_glicose%type;
ds_sugestao_w             prescr_proc_glic.ds_sugestao%type;
qt_minutos_medicao_w      prescr_proc_glic.qt_minutos_medicao%type;
qt_ui_insulina_int_w      prescr_proc_glic.qt_ui_insulina_int%type;
nr_sequencia_w            cpoe_proc_glic.nr_sequencia%type;


c01 CURSOR FOR
SELECT	nr_seq_protocolo,
		qt_glic_inic,
		qt_glic_fim,
		qt_ui_insulina,
		qt_glicose,
		ds_sugestao,
		qt_minutos_medicao,
		qt_ui_insulina_int
from	prescr_proc_glic
where	nr_prescricao = nr_prescricao_p
and		nr_seq_procedimento = nr_seq_procedimento_p;


BEGIN

open c01;
loop
fetch c01 into	nr_seq_protocolo_w,
				qt_glic_inic_w,
				qt_glic_fim_w,
				qt_ui_insulina_w,
				qt_glicose_w,
				ds_sugestao_w,
				qt_minutos_medicao_w,
				qt_ui_insulina_int_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin


	select	nextval('cpoe_proc_glic_seq')
	into STRICT	nr_sequencia_w
	;


	insert into cpoe_proc_glic(
					nr_sequencia,
					nr_seq_procedimento,
					nr_seq_protocolo,
					qt_glic_inic,
					qt_glic_fim,
					qt_ui_insulina,
					qt_glicose,
					ds_sugestao,
					qt_minutos_medicao,
					qt_ui_insulina_int,
					nr_seq_proc_edit,
					nr_atendimento,
					nm_usuario,
					nm_usuario_nrec,
					dt_atualizacao,
					dt_atualizacao_nrec,
					cd_pessoa_fisica)
				values (
					nr_sequencia_w,
					nr_seq_cpoe_procedimento_p,
					nr_seq_protocolo_w,
					qt_glic_inic_w,
					qt_glic_fim_w,
					qt_ui_insulina_w,
					qt_glicose_w,
					ds_sugestao_w,
					qt_minutos_medicao_w,
					qt_ui_insulina_int_w,
					nr_seq_cpoe_procedimento_p,
					nr_atendimento_p,
					nm_usuario_p,
					nm_usuario_p,
					clock_timestamp(),
					clock_timestamp(),
					cd_pessoa_fisica_p);

	end;
end loop;
close c01;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_rep_gerar_proc_glic ( nr_prescricao_p bigint, nr_seq_procedimento_p bigint, nr_atendimento_p bigint, nr_seq_cpoe_procedimento_p bigint, nm_usuario_p text, cd_pessoa_fisica_p cpoe_proc_glic.cd_pessoa_fisica%type default null) FROM PUBLIC;

