-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_ir_pagar ( nr_titulo_P bigint, dt_pagamento_p timestamp, nm_usuario_p text) AS $body$
DECLARE

 
nr_titulo_w		bigint;
cd_cgc_w		varchar(14);
cd_conta_contabil_w	varchar(20);
nr_seq_conta_fin_w	bigint;
dt_vencimento_w		timestamp;

 

BEGIN 
 
select 	cd_beneficiario_ir, 
	cd_conta_contabil_ir, 
	nr_seq_conta_fin_ir 
into STRICT 	cd_cgc_w, 
	cd_conta_contabil_w, 
	nr_seq_conta_fin_w 
from 	parametros_contas_pagar;
 
select	nextval('titulo_pagar_seq') 
into STRICT		nr_titulo_w
;
 
/* Ricardo 05/04/2006 - A pedido do Marcus, inclu√≠ em todos os inserts da Titulo Pagar o campo NR_LOTE_TRANSF_TRIB como 0 (zero) */
 
 
insert into Titulo_Pagar( 
	nr_titulo, 
	cd_estabelecimento, 
	dt_atualizacao, 
	nm_usuario, 
	dt_emissao, 
	dt_Contabil, 
	dt_vencimento_original, 
	dt_vencimento_atual, 
	vl_titulo, 
	vl_saldo_titulo, 
	vl_saldo_juros, 
	vl_saldo_multa, 
	cd_moeda, 
	tx_juros, 
	tx_multa, 
	cd_tipo_taxa_juro, 
	cd_tipo_taxa_multa,       
	tx_desc_antecipacao, 
	ie_situacao, 
	ie_origem_titulo, 
	ie_tipo_titulo,        
	nr_seq_nota_fiscal, 
	cd_cgc, 
	nr_documento, 
	IE_DESCONTO_DIA, 
	nr_titulo_original, 
	ie_status_tributo, 
	NR_LOTE_TRANSF_TRIB, 
	ie_status) 
SELECT 
	nr_titulo_w, 
	cd_estabelecimento, 
	clock_timestamp(), 
	nm_usuario_p, 
	dt_pagamento_p, 
	dt_pagamento_p, 
	dt_vencimento_w, 
	dt_vencimento_w, 
	vl_ir, 
	vl_ir, 
	0, 
	0, 
	cd_moeda, 
	tx_juros, 
	tx_multa, 
	cd_tipo_taxa_juro, 
	cd_tipo_taxa_multa,       
	tx_desc_antecipacao, 
	'A', 
	ie_origem_titulo, 
	ie_tipo_titulo,        
	nr_seq_nota_fiscal, 
	cd_cgc_w, 
	nr_documento, 
	IE_DESCONTO_DIA, 
	nr_titulo, 
	'N', 
	0, 
	'D' 
from 	Titulo_pagar 
where 	nr_titulo	= nr_titulo_p;
CALL ATUALIZAR_INCLUSAO_TIT_PAGAR(nr_titulo_w, nm_usuario_p);
 
insert into Titulo_Pagar_Classif( 
	nr_titulo, nr_sequencia, vl_titulo, 
	dt_atualizacao, nm_usuario, 
	cd_conta_contabil, 
	nr_seq_conta_financ) 
SELECT 
	nr_titulo_w, 
	1, 
	vl_ir, 
	clock_timestamp(), 
	nm_usuario_p, 
	cd_conta_contabil_w, 
	nr_seq_conta_fin_w 
from 	Titulo_pagar 
where 	nr_titulo	= nr_titulo_p;
 
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_ir_pagar ( nr_titulo_P bigint, dt_pagamento_p timestamp, nm_usuario_p text) FROM PUBLIC;

