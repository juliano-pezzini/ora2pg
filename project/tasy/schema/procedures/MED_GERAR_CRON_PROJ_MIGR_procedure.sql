-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE med_gerar_cron_proj_migr ( nr_seq_projeto_p bigint, cd_gerente_p text, cd_funcao_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_seq_cronograma_w	bigint;
cd_funcao_w		integer;
ds_funcao_w		varchar(80);
nr_seq_atividade_w	bigint;
nr_seq_atividade_ww	bigint;

c01 CURSOR FOR
SELECT	distinct(a.cd_funcao)
from	w_analise_migr_proj a
where	exists (
		SELECT	1
		from   	funcao_migracao_v f
		where 	f.ie_gerencia = 5
		and	f.cd_funcao = a.cd_funcao);


BEGIN
if (nr_seq_projeto_p IS NOT NULL AND nr_seq_projeto_p::text <> '') and (cd_gerente_p IS NOT NULL AND cd_gerente_p::text <> '') and (cd_funcao_p IS NOT NULL AND cd_funcao_p::text <> '') and (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') then
	begin
	select	nextval('proj_cronograma_seq')
	into STRICT	nr_seq_cronograma_w
	;

	insert into proj_cronograma(
		nr_seq_proj,
		nr_sequencia,
		ie_tipo_cronograma,
		dt_inicio,
		ds_objetivo,
		cd_empresa,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		cd_pessoa_cliente,
		ie_estrutura,
		nr_seq_cliente)
	values (
		nr_seq_projeto_p,
		nr_seq_cronograma_w,
		'E',
		clock_timestamp(),
		'.',
		1,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		cd_gerente_p,
		'EL',
		1800);

	ds_funcao_w := obter_desc_funcao(cd_funcao_p);

	select	nextval('proj_cron_etapa_seq')
	into STRICT	nr_seq_atividade_w
	;

	insert into proj_cron_etapa(
		nr_seq_cronograma,
		nr_sequencia,
		ds_atividade,
		ie_fase,
		qt_hora_prev,
		pr_etapa,
		nr_seq_apres,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		ie_modulo,
		ie_tipo_obj_proj_migr,
		nr_seq_superior)
	values (
		nr_seq_cronograma_w,
		nr_seq_atividade_w,
		ds_funcao_w,
		'S',
		0,
		0,
		1000,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		'N',
		null,
		null);

	open c01;
	loop
	fetch c01 into cd_funcao_w;
	EXIT WHEN NOT FOUND; /* apply on c01 */
		begin
		ds_funcao_w := obter_desc_funcao(cd_funcao_w);

		select	nextval('proj_cron_etapa_seq')
		into STRICT	nr_seq_atividade_ww
		;

		insert into proj_cron_etapa(
			nr_seq_cronograma,
			nr_sequencia,
			ds_atividade,
			ie_fase,
			qt_hora_prev,
			pr_etapa,
			nr_seq_apres,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			ie_modulo,
			ie_tipo_obj_proj_migr,
			nr_seq_superior)
		values (
			nr_seq_cronograma_w,
			nr_seq_atividade_ww,
			ds_funcao_w,
			'S',
			0,
			0,
			1000,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			'N',
			null,
			nr_seq_atividade_w);

		CALL gerar_tabsheet_cron_proj_migr(
			nr_seq_cronograma_w,
			cd_funcao_w,
			nr_seq_atividade_ww,
			nm_usuario_p);

		CALL gerar_menuitem_cron_proj_migr(
			nr_seq_cronograma_w,
			cd_funcao_w,
			nr_seq_atividade_ww,
			nm_usuario_p);

		CALL gerar_dbpanel_cron_proj_migr(
			nr_seq_cronograma_w,
			cd_funcao_w,
			nr_seq_atividade_ww,
			nm_usuario_p);

		CALL gerar_wcpanel_cron_proj_migr(
			nr_seq_cronograma_w,
			cd_funcao_w,
			nr_seq_atividade_ww,
			nm_usuario_p);

		CALL gerar_wdlg_cron_proj_migr(
			nr_seq_cronograma_w,
			cd_funcao_w,
			nr_seq_atividade_ww,
			nm_usuario_p);

		CALL gerar_wscb_cron_proj_migr(
			nr_seq_cronograma_w,
			cd_funcao_w,
			nr_seq_atividade_ww,
			nm_usuario_p);

		CALL gerar_outros_cron_proj_migr(
			nr_seq_cronograma_w,
			cd_funcao_w,
			nr_seq_atividade_ww,
			nm_usuario_p);

		CALL gerar_testes_cron_proj_migr(
			nr_seq_cronograma_w,
			cd_funcao_w,
			nr_seq_atividade_ww,
			nm_usuario_p);
		end;
	end loop;
	close c01;

	CALL atualizar_total_horas_cron(nr_seq_cronograma_w);
	CALL gerar_classif_etapa_proj(nr_seq_cronograma_w, nm_usuario_p);
	end;
end if;
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE med_gerar_cron_proj_migr ( nr_seq_projeto_p bigint, cd_gerente_p text, cd_funcao_p bigint, nm_usuario_p text) FROM PUBLIC;

