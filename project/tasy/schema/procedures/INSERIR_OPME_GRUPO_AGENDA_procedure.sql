-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_opme_grupo_agenda ( nr_seq_agenda_p bigint, nr_seq_opme_p bigint, nr_seq_grupo_p bigint, nm_usuario_p text) AS $body$
DECLARE

						 
cd_material_w	integer;						
qt_material_w	bigint;
cd_cgc_w	varchar(14);
nr_sequencia_w	agenda_pac_opme.nr_sequencia%type;
ie_gerar_autor_cirurgia_w	varchar(1) := 'N';


BEGIN 
 
ie_gerar_autor_cirurgia_w := obter_valor_param_usuario(871, 388, obter_perfil_ativo, nm_usuario_p, wheb_usuario_pck.get_cd_estabelecimento);
 
if (nr_seq_agenda_p IS NOT NULL AND nr_seq_agenda_p::text <> '') and (nr_seq_grupo_p IS NOT NULL AND nr_seq_grupo_p::text <> '') and (nr_seq_opme_p IS NOT NULL AND nr_seq_opme_p::text <> '') then 
	select	max(cd_material), 
		max(qt_material), 
		max(cd_cgc) 
	into STRICT	cd_material_w, 
		qt_material_w, 
		cd_cgc_w	 
	from	proc_interno_opme 
	where	nr_sequencia = 	nr_seq_opme_p;
	 
	select	nextval('agenda_pac_opme_seq') 
	into STRICT	nr_sequencia_w 
	;
 
	insert into	agenda_pac_opme( 
					nr_sequencia, 
					nr_seq_agenda, 
					dt_atualizacao, 
					nm_usuario, 
					cd_material, 
					qt_material, 
					ie_origem_inf, 
					dt_atualizacao_nrec, 
					nm_usuario_nrec, 
					nr_seq_apres, 
					ie_autorizado, 
					ie_padrao, 
					cd_cgc, 
					nr_seq_agrup) 
	values (nr_sequencia_w, 
					nr_seq_agenda_p, 
					clock_timestamp(), 
					nm_usuario_p, 
					cd_material_w, 
					qt_material_w, 
					'I', 
					clock_timestamp(), 
					nm_usuario_p, 
					500, 
					'P', 
					'S', 
					cd_cgc_w, 
					nr_seq_grupo_p);
					 
	if (ie_gerar_autor_cirurgia_w = 'S') then 
		CALL gerar_autor_regra(null,null,null,null,null,null,'AP', nm_usuario_p, nr_seq_agenda_p, null,null,null, nr_sequencia_w, null,'','','');
	end if;
 
end if;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_opme_grupo_agenda ( nr_seq_agenda_p bigint, nr_seq_opme_p bigint, nr_seq_grupo_p bigint, nm_usuario_p text) FROM PUBLIC;

