-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_atendimento_ageserv ( cd_convenio_p bigint, cd_agenda_p bigint, ie_classif_agenda_p text, ie_opcao_p text, cd_estabelecimento_p bigint, ds_perg_troc_estab_p INOUT text, ie_tipo_atend_p INOUT bigint, ie_clinica_p INOUT bigint) AS $body$
DECLARE

 
/*	ie_opcao_p 
	A - dados da agenda 
*/
 
 
cd_estab_convenio_w	smallint;


BEGIN 
 
cd_estab_convenio_w := obter_estabelecimento_convenio( 
	cd_convenio_p, cd_estabelecimento_p, cd_estab_convenio_w);
 
if (cd_estab_convenio_w <> cd_estabelecimento_p) then 
	ds_perg_troc_estab_p	:= substr(obter_texto_tasy(51187, wheb_usuario_pck.get_nr_seq_idioma),1,255);
end if;
 
if (ie_opcao_p = 'A') and (cd_agenda_p IS NOT NULL AND cd_agenda_p::text <> '') then 
	begin 
	select	obter_tipo_atend_classif_ag(cd_agenda_p, ie_classif_agenda_p) 
	into STRICT	ie_tipo_atend_p 
	;
 
	select	coalesce(max(ie_clinica), 0) 
	into STRICT	ie_clinica_p 
	from	agenda 
	where	cd_agenda = cd_agenda_p;
	end;
end if;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_atendimento_ageserv ( cd_convenio_p bigint, cd_agenda_p bigint, ie_classif_agenda_p text, ie_opcao_p text, cd_estabelecimento_p bigint, ds_perg_troc_estab_p INOUT text, ie_tipo_atend_p INOUT bigint, ie_clinica_p INOUT bigint) FROM PUBLIC;

