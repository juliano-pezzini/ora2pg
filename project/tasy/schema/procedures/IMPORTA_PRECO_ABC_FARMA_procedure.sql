-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE importa_preco_abc_farma (cd_codigo_p text, dt_vigencia_p timestamp, nm_usuario_p text, cd_barras_p text, cd_controle_p text, cd_laboratorio_p text, cd_unidade_medida_p text, ds_apresentacao_p text, ds_material_abcpharma_p text, ds_principio_ativo_p text, ie_generico_p text, ie_lista_p text, ie_produto_p text, ie_variacao_p text, nm_laboratorio_p text, nr_registro_ms_p text, pr_ipi_p bigint, vl_fracao_venca_icmsz_p bigint, vl_fracao_venca_icms0_p bigint, vl_fracao_venca_icms12_p bigint, vl_fracao_venca_icms17_p bigint, vl_fracao_venca_icms18_p bigint, vl_fracao_venca_icms19_p bigint, vl_laboratorio_icmsz_p bigint, vl_laboratorio_icms0_p bigint, vl_laboratorio_icms12_p bigint, vl_laboratorio_icms17_p bigint, vl_laboratorio_icms18_p bigint, vl_laboratorio_icms19_p bigint, vl_maximo_venda_icmsz_p bigint, vl_maximo_venda_icms0_p bigint, vl_maximo_venda_icms12_p bigint, vl_maximo_venda_icms17_p bigint, vl_maximo_venda_icms18_p bigint, vl_maximo_venda_icms19_p bigint) AS $body$
DECLARE





nr_sequencia_w		bigint;
qt_registro_w		bigint;
dt_vig_ant_w		timestamp;


BEGIN

select	count(*)
into STRICT	qt_registro_w
from	W_PRECO_FARMACIA_COM
where	cd_codigo = cd_codigo_p
and	ie_tabela = 'ABC';

if (qt_registro_w = 0) then
	begin

	select 	nextval('w_preco_farmacia_com_seq')
	into STRICT	nr_sequencia_w
	;

	insert into W_PRECO_FARMACIA_COM(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		ie_tabela,
		cd_codigo,
		dt_vigencia,
		vl_preco,
		cd_barras,
		cd_controle,
		cd_laboratorio,
		cd_unidade_medida,
		ds_apresentacao,
		ds_material_abcpharma,
		ds_principio_ativo,
		ie_generico,
		ie_lista,
		ie_produto,
		ie_variacao,
		nm_laboratorio,
		nr_registro_ms,
		pr_ipi,
		vl_fracao_venca_icmsz,
		vl_fracao_venca_icms0,
		vl_fracao_venca_icms12,
		vl_fracao_venca_icms17,
		vl_fracao_venca_icms18,
		vl_fracao_venca_icms19,
		vl_laboratorio_icmsz,
		vl_laboratorio_icms0,
		vl_laboratorio_icms12,
		vl_laboratorio_icms17,
		vl_laboratorio_icms18,
		vl_laboratorio_icms19,
		vl_maximo_venda_icmsz,
		vl_maximo_venda_icms0,
		vl_maximo_venda_icms12,
		vl_maximo_venda_icms17,
		vl_maximo_venda_icms18,
		vl_maximo_venda_icms19)
	values (nr_sequencia_w,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		'ABC',
		cd_codigo_p,
		dt_vigencia_p,
		0,
		cd_barras_p,
		cd_controle_p,
		cd_laboratorio_p,
		cd_unidade_medida_p,
		ds_apresentacao_p,
		ds_material_abcpharma_p,
		ds_principio_ativo_p,
		ie_generico_p,
		ie_lista_p,
		ie_produto_p,
		ie_variacao_p,
		nm_laboratorio_p,
		nr_registro_ms_p,
		pr_ipi_p,
		vl_fracao_venca_icmsz_p,
		vl_fracao_venca_icms0_p,
		vl_fracao_venca_icms12_p,
		vl_fracao_venca_icms17_p,
		vl_fracao_venca_icms18_p,
		vl_fracao_venca_icms19_p,
		vl_laboratorio_icmsz_p,
		vl_laboratorio_icms0_p,
		vl_laboratorio_icms12_p,
		vl_laboratorio_icms17_p,
		vl_laboratorio_icms18_p,
		vl_laboratorio_icms19_p,
		vl_maximo_venda_icmsz_p,
		vl_maximo_venda_icms0_p,
		vl_maximo_venda_icms12_p,
		vl_maximo_venda_icms17_p,
		vl_maximo_venda_icms18_p,
		vl_maximo_venda_icms19_p
		);

	end;
elsif (qt_registro_w > 0) then
	begin

	select	dt_vigencia
	into STRICT	dt_vig_ant_w
	from	w_preco_farmacia_com
	where	cd_codigo = cd_codigo_p
	and	ie_tabela = 'ABC';

	if (dt_vig_ant_w < dt_vigencia_p) then
		begin

		update	w_preco_farmacia_com
		set	dt_vigencia	= dt_vigencia_p,
				cd_barras = cd_barras_p,
				cd_controle = cd_controle_p,
				cd_laboratorio = cd_laboratorio_p,
				cd_unidade_medida = cd_unidade_medida_p,
				ds_apresentacao = ds_apresentacao_p,
				ds_material_abcpharma = ds_material_abcpharma_p,
				ds_principio_ativo = ds_principio_ativo_p,
				ie_generico = ie_generico_p,
				ie_lista = ie_lista_p,
				ie_produto = ie_produto_p,
				ie_variacao = ie_variacao_p,
				nm_laboratorio = nm_laboratorio_p,
				nr_registro_ms = nr_registro_ms_p,
				pr_ipi = pr_ipi_p,
				vl_fracao_venca_icmsz = vl_fracao_venca_icmsz_p,
				vl_fracao_venca_icms0 = vl_fracao_venca_icms0_p,
				vl_fracao_venca_icms12 = vl_fracao_venca_icms12_p,
				vl_fracao_venca_icms17 = vl_fracao_venca_icms17_p,
				vl_fracao_venca_icms18 = vl_fracao_venca_icms18_p,
				vl_fracao_venca_icms19 = vl_fracao_venca_icms19_p,
				vl_laboratorio_icmsz = vl_laboratorio_icmsz_p,
				vl_laboratorio_icms0 = vl_laboratorio_icms0_p,
				vl_laboratorio_icms12 = vl_laboratorio_icms12_p,
				vl_laboratorio_icms17 = vl_laboratorio_icms17_p,
				vl_laboratorio_icms18 = vl_laboratorio_icms18_p,
				vl_laboratorio_icms19 = vl_laboratorio_icms19_p,
				vl_maximo_venda_icmsz = vl_maximo_venda_icmsz_p,
				vl_maximo_venda_icms0 = vl_maximo_venda_icms0_p,
				vl_maximo_venda_icms12 = vl_maximo_venda_icms12_p,
				vl_maximo_venda_icms17 = vl_maximo_venda_icms17_p,
				vl_maximo_venda_icms18 = vl_maximo_venda_icms18_p,
				vl_maximo_venda_icms19 = vl_maximo_venda_icms19_p
		where	cd_codigo	= cd_codigo_p
		and	ie_tabela	= 'ABC';
		end;
	end if;
	end;

end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE importa_preco_abc_farma (cd_codigo_p text, dt_vigencia_p timestamp, nm_usuario_p text, cd_barras_p text, cd_controle_p text, cd_laboratorio_p text, cd_unidade_medida_p text, ds_apresentacao_p text, ds_material_abcpharma_p text, ds_principio_ativo_p text, ie_generico_p text, ie_lista_p text, ie_produto_p text, ie_variacao_p text, nm_laboratorio_p text, nr_registro_ms_p text, pr_ipi_p bigint, vl_fracao_venca_icmsz_p bigint, vl_fracao_venca_icms0_p bigint, vl_fracao_venca_icms12_p bigint, vl_fracao_venca_icms17_p bigint, vl_fracao_venca_icms18_p bigint, vl_fracao_venca_icms19_p bigint, vl_laboratorio_icmsz_p bigint, vl_laboratorio_icms0_p bigint, vl_laboratorio_icms12_p bigint, vl_laboratorio_icms17_p bigint, vl_laboratorio_icms18_p bigint, vl_laboratorio_icms19_p bigint, vl_maximo_venda_icmsz_p bigint, vl_maximo_venda_icms0_p bigint, vl_maximo_venda_icms12_p bigint, vl_maximo_venda_icms17_p bigint, vl_maximo_venda_icms18_p bigint, vl_maximo_venda_icms19_p bigint) FROM PUBLIC;

