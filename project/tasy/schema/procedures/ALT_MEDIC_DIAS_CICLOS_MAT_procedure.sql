-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE alt_medic_dias_ciclos_mat ( nr_seq_paciente_p bigint, ds_seq_material_p text, ds_dias_aplicacao_p text, ds_ciclos_aplicacao_p text, ie_pasta_p text, nm_usuario_p text) AS $body$
BEGIN
if (nr_seq_paciente_p IS NOT NULL AND nr_seq_paciente_p::text <> '') and (nr_seq_paciente_p > 0 ) and (ds_seq_material_p IS NOT NULL AND ds_seq_material_p::text <> '') then
	if (ie_pasta_p = 'M') then
		begin
		if (ds_dias_aplicacao_p IS NOT NULL AND ds_dias_aplicacao_p::text <> '') then
			begin
			update	paciente_protocolo_medic
			set		ds_dias_aplicacao = ds_dias_aplicacao_p,
					dt_atualizacao = clock_timestamp(),
					nm_usuario	= nm_usuario_p
			where (obter_se_contido_char(to_char(nr_seq_material), ds_seq_material_p) = 'S' or
				 obter_se_contido_char(to_char(nr_seq_diluicao), ds_seq_material_p) = 'S')
			and		nr_seq_paciente = nr_seq_paciente_p;
			end;
		end if;
		if (ds_ciclos_aplicacao_p IS NOT NULL AND ds_ciclos_aplicacao_p::text <> '') then
			begin
			update	paciente_protocolo_medic
			set		ds_ciclos_aplicacao = ds_ciclos_aplicacao_p,
					dt_atualizacao = clock_timestamp(),
					nm_usuario	= nm_usuario_p
			where (obter_se_contido_char(to_char(nr_seq_material), ds_seq_material_p) = 'S' or
				 obter_se_contido_char(to_char(nr_seq_diluicao), ds_seq_material_p) = 'S')
			and		nr_seq_paciente = nr_seq_paciente_p
			and   	coalesce(nr_seq_diluicao::text, '') = '';
			end;
		end if;
		end;
	elsif (ie_pasta_p = 'S') then
		begin
		if (ds_dias_aplicacao_p IS NOT NULL AND ds_dias_aplicacao_p::text <> '') then
			begin
			update	paciente_protocolo_soluc
			set		ds_dias_aplicacao = ds_dias_aplicacao_p,
					dt_atualizacao = clock_timestamp(),
					nm_usuario	= nm_usuario_p
			where	obter_se_contido_char(to_char(nr_seq_solucao), ds_seq_material_p) = 'S'
			and		nr_seq_paciente = nr_seq_paciente_p;
			end;
		end if;
		if (ds_ciclos_aplicacao_p IS NOT NULL AND ds_ciclos_aplicacao_p::text <> '') then
			begin
			update	paciente_protocolo_soluc
			set		ds_ciclos_aplicacao = ds_ciclos_aplicacao_p,
					dt_atualizacao = clock_timestamp(),
					nm_usuario	= nm_usuario_p
			where	obter_se_contido_char(to_char(nr_seq_solucao), ds_seq_material_p) = 'S'
			and		nr_seq_paciente = nr_seq_paciente_p;
			end;
		end if;
		end;
	elsif (ie_pasta_p = 'P') then
		begin
		if (ds_dias_aplicacao_p IS NOT NULL AND ds_dias_aplicacao_p::text <> '') then
			begin
			update	paciente_protocolo_proc
			set		ds_dias_aplicacao = ds_dias_aplicacao_p,
					dt_atualizacao = clock_timestamp(),
					nm_usuario	= nm_usuario_p
			where	obter_se_contido_char(to_char(nr_seq_procedimento), ds_seq_material_p) = 'S'
			and		nr_seq_paciente = nr_seq_paciente_p;
			end;
		end if;
		if (ds_ciclos_aplicacao_p IS NOT NULL AND ds_ciclos_aplicacao_p::text <> '') then
			begin
			update	paciente_protocolo_proc
			set		ds_ciclos_aplicacao = ds_ciclos_aplicacao_p,
					dt_atualizacao = clock_timestamp(),
					nm_usuario	= nm_usuario_p
			where	obter_se_contido_char(to_char(nr_seq_procedimento), ds_seq_material_p) = 'S'
			and		nr_seq_paciente = nr_seq_paciente_p;
			end;
		end if;
		end;
	end if;
end if;
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE alt_medic_dias_ciclos_mat ( nr_seq_paciente_p bigint, ds_seq_material_p text, ds_dias_aplicacao_p text, ds_ciclos_aplicacao_p text, ie_pasta_p text, nm_usuario_p text) FROM PUBLIC;

