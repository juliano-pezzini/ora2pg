-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE importar_pf (ie_tipo_pessoa_p bigint, nm_pessoa_fisica_p text, nm_usuario_p text, dt_nascimento_p timestamp, ie_sexo_p text, ie_estado_civil_p text, nr_cpf_p text, nr_identidade_p text, nr_telefone_celular_p text, ie_grau_instrucao_p bigint, nr_cep_cidade_nasc_p text, nr_prontuario_p bigint, cd_religiao_p bigint, nr_pis_pasep_p text, cd_nacionalidade_p text, ie_dependencia_sus_p text, qt_altura_cm_p bigint, ie_tipo_sangue_p text, ie_fator_rh_p text, dt_obito_p timestamp, nr_iss_p text, nr_inss_p text, nr_cert_nasc_p text, cd_cargo_p bigint, ds_codigo_prof_p text, ie_funcionario_p text, nr_seq_cor_pele_p bigint, ds_orgao_emissor_ci_p text, nr_cartao_nac_sus_p bigint, cd_cbo_sus_p bigint, cd_atividade_sus_p bigint, ie_vinculo_sus_p bigint, cd_estabelecimento_p bigint, cd_sistema_ant_p text, cd_funcionario_p text, nr_pager_bip_p text, nr_transacao_sus_p text, cd_medico_p text, nm_pessoa_pesquisa_p text, dt_emissao_ci_p timestamp, nr_seq_conselho_p bigint, dt_admissao_hosp_p timestamp, ie_fluencia_portugues_p text, nr_titulo_eleitor_p text, nr_zona_p text, nr_secao_p text, nr_cartao_estrangeiro_p text, nr_reg_geral_estrang_p text, dt_chegada_brasil_p timestamp, ds_historico_p text, ie_tipo_prontuario_p bigint, ds_observacao_p text, qt_dependente_p bigint, nr_transplante_p bigint, nm_pessoa_fisica_sem_acento_p text, cd_empresa_p bigint, dt_revisao_p timestamp, nm_usuario_revisao_p text, dt_demissao_hosp_p timestamp, nr_contra_ref_sus_p text, cd_puericultura_p bigint, sg_emissora_ci_p text, dt_naturalizacao_pf_p timestamp, nr_ctps_p bigint, nr_serie_ctps_p text, uf_emissora_ctps_p text, dt_emissao_ctps_p timestamp, nr_portaria_nat_p text, ds_senha_p text, ds_fonetica_p text, ie_revisar_p text, cd_cnes_p text, nr_seq_perfil_p bigint, nr_same_p bigint, nr_seq_cbo_saude_p bigint, dt_integracao_externa_p timestamp, ds_fonetica_cns_p text, ds_apelido_p text, dt_geracao_pront_p timestamp, cd_municipio_ibge_p text, nr_seq_pais_p bigint, nr_cert_casamento_p text, nr_seq_cartorio_nasc_p bigint, nr_seq_cartorio_casamento_p bigint, dt_emissao_cert_nasc_p timestamp, dt_emissao_cert_casamento_p timestamp, nr_folha_cert_nasc_p bigint, nr_folha_cert_casamento_p bigint, nr_livro_cert_nasc_p bigint, nr_livro_cert_casamento_p bigint, nr_seq_nut_perfil_p bigint, nr_registro_pls_p text, dt_validade_rg_p timestamp, cd_pessoa_fisica_p INOUT text) AS $body$
DECLARE


/* Dominios - 	IE_TIPO_PESSOA_P		1 - Médico,
						2 - Paciente,
						3 - Funcionários,
						4 - Outros

		IE_SEXO				'F' - Feminino
						'M' - Masculino
						'I' - Indeterminado

		IE_ESTADO_CIVIL			1 - Solteiro
						2 - Casado
						3 - Divorciado
						4 - Desquitado
						5 - Viúvo
						6 - Separado
						7 - Concubinado
						9 - Outros

		IE_GRAU_INSTRUCAO		1 - Analfabeto
						10 - Primário
						11 - Não Alfabetizado
						12 - Pós graduação
						13 - Ph.D.
						2 - Primeiro Grau
						3 - Segundo Grau
						4 - Superior
						5 - Mestrado
						6 - Doutor
						7 - Primeiro  Grau  Incompleto
						8 - Segundo  Grau  Incompleto
						9 - Superior  Incompleto

		SG_EMISSORA_CI, UF_EMISSORA_CTPS	AC - Acre
							AL - Alagoas
							AM - Amazonas
							AP - Amapá
							BA - Bahia
							CE - Ceará
							DF - Distrito Federal
							ES - Espirito Santo
							GO - Goiás
							IN - Outros(Internacional)
							MA - Maranhão
							MG - Minas Gerais
							MS - Mato Grosso do Sul
							MT - Mato Grosso
							PA - Pará
							PB - Paraiba
							PE - Pernambuco
							PI - Piauí
							PR - Paraná
							RJ - Rio de Janeiro
							RN - Rio Grande do Norte
							RO - Rondonia
							RR - Roraima
							RS - Rio Grande do Sul
							SC - Santa Catarina
							SE - Sergipe
							SP - São Paulo
							TO - Tocantins

		IE_DEPENDENCIA_SUS			2 - Segurado
							4 - Cônjuge
							6 - Filho
							8 - Outra dependência

		IE_TIPO_SANGUE				B - B
							A - A
							O - O
							AB - AB

		IE_FATOR_RH				+ - +
							- - -

		IE_FLUENCIA_PORTUGUES			A - Ausente
							F - Fluente
							R - Razoável
							S - Sofrível

		IE_TIPO_PRONTUARIO			1 - Completo
							2 - Básico

		ie_vinculo_sus				1 - Autonomo
							2 - Desempregado
							3 - Aposentado
							4 - Nao Segurado
							5 - Empregado
							6 - Empregador

*/
cd_pessoa_fisica_w		varchar(10);
qt_sexo_w			bigint;
qt_estado_civil_w		bigint;
qt_grau_instrucao_w		bigint;
qt_sg_emissora_ci_w		bigint;
qt_uf_emissora_ctps_w		bigint;
qt_dependencia_sus_w		bigint;
qt_tipo_sangue_w		bigint;
qt_fator_rh_w			bigint;
qt_fluencia_portugues_w		bigint;
qt_tipo_prontuario_w		bigint;
qt_vinculo_sus_w		bigint;
cd_sistema_ant_w		varchar(255);





BEGIN


select	max(cd_sistema_ant)
into STRICT	cd_sistema_ant_w
from	pessoa_fisica
where	cd_sistema_ant	= cd_sistema_ant_p;

if (ie_sexo_p IS NOT NULL AND ie_sexo_p::text <> '') then
	select	count(b.vl_dominio)
	into STRICT	qt_sexo_w
	from	dominio a,
		valor_dominio b
	where	a.cd_dominio	= b.cd_dominio
	and	a.cd_dominio	= 4
	and	b.vl_dominio	= ie_sexo_p;
else
	qt_sexo_w := 1;
end if;

if (ie_estado_civil_p IS NOT NULL AND ie_estado_civil_p::text <> '') then
	select	count(b.vl_dominio)
	into STRICT	qt_estado_civil_w
	from	dominio a,
		valor_dominio b
	where	a.cd_dominio	= b.cd_dominio
	and	a.cd_dominio	= 5
	and	b.vl_dominio	= ie_estado_civil_p;
else
	qt_estado_civil_w := 1;
end if;

if (ie_grau_instrucao_p IS NOT NULL AND ie_grau_instrucao_p::text <> '')	then
	select	count(b.vl_dominio)
	into STRICT	qt_grau_instrucao_w
	from	dominio a,
		valor_dominio b
	where	a.cd_dominio	= b.cd_dominio
	and	a.cd_dominio	= 10
	and	b.vl_dominio	= ie_grau_instrucao_p;
else
	qt_grau_instrucao_w := 1;
end if;

if (sg_emissora_ci_p IS NOT NULL AND sg_emissora_ci_p::text <> '')	then
	select	count(b.vl_dominio)
	into STRICT	qt_sg_emissora_ci_w
	from	dominio a,
		valor_dominio b
	where	a.cd_dominio	= b.cd_dominio
	and	a.cd_dominio	= 50
	and	b.vl_dominio	= sg_emissora_ci_p;
else
	qt_sg_emissora_ci_w := 1;
end if;

if (uf_emissora_ctps_p IS NOT NULL AND uf_emissora_ctps_p::text <> '')	then
	select	count(b.vl_dominio)
	into STRICT	qt_uf_emissora_ctps_w
	from	dominio a,
		valor_dominio b
	where	a.cd_dominio	= b.cd_dominio
	and	a.cd_dominio	= 50
	and	b.vl_dominio	= uf_emissora_ctps_p;
else
	qt_uf_emissora_ctps_w := 1;
end if;

if (ie_dependencia_sus_p IS NOT NULL AND ie_dependencia_sus_p::text <> '')	then
	select	count(b.vl_dominio)
	into STRICT	qt_dependencia_sus_w
	from	dominio a,
		valor_dominio b
	where	a.cd_dominio	= b.cd_dominio
	and	a.cd_dominio	= 803
	and	b.vl_dominio	= ie_dependencia_sus_p;
else
	qt_dependencia_sus_w := 1;
end if;

if (ie_tipo_sangue_p IS NOT NULL AND ie_tipo_sangue_p::text <> '')	then
	select	count(b.vl_dominio)
	into STRICT	qt_tipo_sangue_w
	from	dominio a,
		valor_dominio b
	where	a.cd_dominio	= b.cd_dominio
	and	a.cd_dominio	= 1173
	and	b.vl_dominio	= ie_tipo_sangue_p;
else
	qt_tipo_sangue_w := 1;
end if;

if (qt_fator_rh_w IS NOT NULL AND qt_fator_rh_w::text <> '')	then
	select	count(b.vl_dominio)
	into STRICT	qt_fator_rh_w
	from	dominio a,
		valor_dominio b
	where	a.cd_dominio	= b.cd_dominio
	and	a.cd_dominio	= 1174
	and	b.vl_dominio	= ie_fator_rh_p;
else
	qt_fator_rh_w := 1;
end if;

if (ie_fluencia_portugues_p IS NOT NULL AND ie_fluencia_portugues_p::text <> '')	then
	select	count(b.vl_dominio)
	into STRICT	qt_fluencia_portugues_w
	from	dominio a,
		valor_dominio b
	where	a.cd_dominio	= b.cd_dominio
	and	a.cd_dominio	= 1343
	and	b.vl_dominio	= ie_fluencia_portugues_p;
else
	qt_fluencia_portugues_w := 1;
end if;

if (ie_tipo_prontuario_p IS NOT NULL AND ie_tipo_prontuario_p::text <> '')	then
	select	count(b.vl_dominio)
	into STRICT	qt_tipo_prontuario_w
	from	dominio a,
		valor_dominio b
	where	a.cd_dominio	= b.cd_dominio
	and	a.cd_dominio	= 1528
	and	b.vl_dominio	= ie_tipo_prontuario_p;
else
	qt_tipo_prontuario_w := 1;
end if;

if (ie_vinculo_sus_p IS NOT NULL AND ie_vinculo_sus_p::text <> '')	then
	select	count(b.vl_dominio)
	into STRICT	qt_vinculo_sus_w
	from	dominio a,
		valor_dominio b
	where	a.cd_dominio	= b.cd_dominio
	and	a.cd_dominio	= 800
	and	b.vl_dominio	= ie_vinculo_sus_p;
else
	qt_vinculo_sus_w := 1;
end if;

select	coalesce(max(cd_pessoa_fisica),0)
into STRICT	cd_pessoa_fisica_w
from	pessoa_fisica
where	coalesce(nr_cpf, 'X') 		= coalesce(nr_cpf_p, 'X')
and	ie_sexo				= ie_sexo_p
and	upper(nm_pessoa_fisica) like 	upper(nm_pessoa_fisica_p);

if (coalesce(cd_sistema_ant_w::text, '') = '')	Then
	if (cd_pessoa_fisica_w	= 0)	Then
		if (ie_tipo_pessoa_p IS NOT NULL AND ie_tipo_pessoa_p::text <> '')	then
			if (qt_sexo_w			= 1) and (qt_estado_civil_w		= 1) and (qt_grau_instrucao_w		= 1) and (qt_sg_emissora_ci_w		= 1) and (qt_uf_emissora_ctps_w		= 1) and (qt_dependencia_sus_w		= 1) and (qt_tipo_sangue_w		= 1) and (qt_fator_rh_w			= 1) and (qt_fluencia_portugues_w	= 1) and (qt_tipo_prontuario_w		= 1) 	then

				select	nextval('pessoa_fisica_seq')
				into STRICT	cd_pessoa_fisica_w
				;
			Begin
				insert into pessoa_fisica(
					cd_pessoa_fisica,
					ie_tipo_pessoa,
					nm_pessoa_fisica,
					dt_atualizacao,
					nm_usuario,
					dt_nascimento,
					ie_sexo,
					ie_estado_civil,
					nr_cpf,
					nr_identidade,
					nr_telefone_celular,
					ie_grau_instrucao,
					nr_cep_cidade_nasc,
					nr_prontuario,
					cd_religiao,
					nr_pis_pasep,
					cd_nacionalidade,
					ie_dependencia_sus,
					qt_altura_cm,
					ie_tipo_sangue,
					ie_fator_rh,
					dt_obito,
					nr_iss,
					nr_inss,
					nr_cert_nasc,
					cd_cargo,
					ds_codigo_prof,
					ie_funcionario,
					nr_seq_cor_pele,
					ds_orgao_emissor_ci,
					nr_cartao_nac_sus,
					cd_cbo_sus,
					cd_atividade_sus,
					ie_vinculo_sus,
					cd_estabelecimento,
					cd_sistema_ant,
					cd_funcionario,
					nr_pager_bip,
					nr_transacao_sus,
					cd_medico,
					nm_pessoa_pesquisa,
					dt_emissao_ci,
					nr_seq_conselho,
					dt_admissao_hosp,
					ie_fluencia_portugues,
					nr_titulo_eleitor,
					nr_zona,
					nr_secao,
					nr_cartao_estrangeiro,
					nr_reg_geral_estrang,
					dt_chegada_brasil,
					nm_usuario_original,
					dt_cadastro_original,
					ds_historico,
					dt_atualizacao_nrec,
					nm_usuario_nrec,
					ie_tipo_prontuario,
					ds_observacao,
					qt_dependente,
					nr_transplante,
					nm_pessoa_fisica_sem_acento,
					cd_empresa,
					dt_revisao,
					nm_usuario_revisao,
					dt_demissao_hosp,
					nr_contra_ref_sus,
					cd_puericultura,
					sg_emissora_ci,
					dt_naturalizacao_pf,
					nr_ctps,
					nr_serie_ctps,
					uf_emissora_ctps,
					dt_emissao_ctps,
					nr_portaria_nat,
					ds_senha,
					ds_fonetica,
					ie_revisar,
					cd_cnes,
					nr_seq_perfil,
					nr_same,
					nr_seq_cbo_saude,
					dt_integracao_externa,
					ds_fonetica_cns,
					ds_apelido,
					dt_geracao_pront,
					cd_municipio_ibge,
					nr_seq_pais,
					nr_cert_casamento,
					nr_seq_cartorio_nasc,
					nr_seq_cartorio_casamento,
					dt_emissao_cert_nasc,
					dt_emissao_cert_casamento,
					nr_folha_cert_nasc,
					nr_folha_cert_casamento,
					nr_livro_cert_nasc,
					nr_livro_cert_casamento,
					nr_seq_nut_perfil,
					nr_registro_pls,
					dt_validade_rg)
				values (
					cd_pessoa_fisica_w,
					ie_tipo_pessoa_p,
					nm_pessoa_fisica_p,
					clock_timestamp(),
					nm_usuario_p,
					dt_nascimento_p,
					ie_sexo_p,
					ie_estado_civil_p,
					nr_cpf_p,
					nr_identidade_p,
					nr_telefone_celular_p,
					ie_grau_instrucao_p,
					nr_cep_cidade_nasc_p,
					nr_prontuario_p,
					cd_religiao_p,
					nr_pis_pasep_p,
					cd_nacionalidade_p,
					ie_dependencia_sus_p,
					qt_altura_cm_p,
					ie_tipo_sangue_p,
					ie_fator_rh_p,
					dt_obito_p,
					nr_iss_p,
					nr_inss_p,
					nr_cert_nasc_p,
					cd_cargo_p,
					ds_codigo_prof_p,
					ie_funcionario_p,
					nr_seq_cor_pele_p,
					ds_orgao_emissor_ci_p,
					nr_cartao_nac_sus_p,
					cd_cbo_sus_p,
					cd_atividade_sus_p,
					ie_vinculo_sus_p,
					cd_estabelecimento_p,
					cd_sistema_ant_p,
					cd_funcionario_p,
					nr_pager_bip_p,
					nr_transacao_sus_p,
					cd_medico_p,
					nm_pessoa_pesquisa_p,
					dt_emissao_ci_p,
					nr_seq_conselho_p,
					dt_admissao_hosp_p,
					ie_fluencia_portugues_p,
					nr_titulo_eleitor_p,
					nr_zona_p,
					nr_secao_p,
					nr_cartao_estrangeiro_p,
					nr_reg_geral_estrang_p,
					dt_chegada_brasil_p,
					nm_usuario_p,
					clock_timestamp(),
					ds_historico_p,
					clock_timestamp(),
					nm_usuario_p,
					ie_tipo_prontuario_p,
					ds_observacao_p,
					qt_dependente_p,
					nr_transplante_p,
					nm_pessoa_fisica_sem_acento_p,
					cd_empresa_p,
					dt_revisao_p,
					nm_usuario_revisao_p,
					dt_demissao_hosp_p,
					nr_contra_ref_sus_p,
					cd_puericultura_p,
					sg_emissora_ci_p,
					dt_naturalizacao_pf_p,
					nr_ctps_p,
					nr_serie_ctps_p,
					uf_emissora_ctps_p,
					dt_emissao_ctps_p,
					nr_portaria_nat_p,
					ds_senha_p,
					ds_fonetica_p,
					ie_revisar_p,
					cd_cnes_p,
					nr_seq_perfil_p,
					nr_same_p,
					nr_seq_cbo_saude_p,
					dt_integracao_externa_p,
					ds_fonetica_cns_p,
					ds_apelido_p,
					dt_geracao_pront_p,
					cd_municipio_ibge_p,
					nr_seq_pais_p,
					nr_cert_casamento_p,
					nr_seq_cartorio_nasc_p,
					nr_seq_cartorio_casamento_p,
					dt_emissao_cert_nasc_p,
					dt_emissao_cert_casamento_p,
					nr_folha_cert_nasc_p,
					nr_folha_cert_casamento_p,
					nr_livro_cert_nasc_p,
					nr_livro_cert_casamento_p,
					nr_seq_nut_perfil_p,
					nr_registro_pls_p,
					dt_validade_rg_p);

			cd_pessoa_fisica_p	:= cd_pessoa_fisica_w;
			exception
			when others then
				null;
			end;
			end if;
		end if;
	end if;
end if;
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE importar_pf (ie_tipo_pessoa_p bigint, nm_pessoa_fisica_p text, nm_usuario_p text, dt_nascimento_p timestamp, ie_sexo_p text, ie_estado_civil_p text, nr_cpf_p text, nr_identidade_p text, nr_telefone_celular_p text, ie_grau_instrucao_p bigint, nr_cep_cidade_nasc_p text, nr_prontuario_p bigint, cd_religiao_p bigint, nr_pis_pasep_p text, cd_nacionalidade_p text, ie_dependencia_sus_p text, qt_altura_cm_p bigint, ie_tipo_sangue_p text, ie_fator_rh_p text, dt_obito_p timestamp, nr_iss_p text, nr_inss_p text, nr_cert_nasc_p text, cd_cargo_p bigint, ds_codigo_prof_p text, ie_funcionario_p text, nr_seq_cor_pele_p bigint, ds_orgao_emissor_ci_p text, nr_cartao_nac_sus_p bigint, cd_cbo_sus_p bigint, cd_atividade_sus_p bigint, ie_vinculo_sus_p bigint, cd_estabelecimento_p bigint, cd_sistema_ant_p text, cd_funcionario_p text, nr_pager_bip_p text, nr_transacao_sus_p text, cd_medico_p text, nm_pessoa_pesquisa_p text, dt_emissao_ci_p timestamp, nr_seq_conselho_p bigint, dt_admissao_hosp_p timestamp, ie_fluencia_portugues_p text, nr_titulo_eleitor_p text, nr_zona_p text, nr_secao_p text, nr_cartao_estrangeiro_p text, nr_reg_geral_estrang_p text, dt_chegada_brasil_p timestamp, ds_historico_p text, ie_tipo_prontuario_p bigint, ds_observacao_p text, qt_dependente_p bigint, nr_transplante_p bigint, nm_pessoa_fisica_sem_acento_p text, cd_empresa_p bigint, dt_revisao_p timestamp, nm_usuario_revisao_p text, dt_demissao_hosp_p timestamp, nr_contra_ref_sus_p text, cd_puericultura_p bigint, sg_emissora_ci_p text, dt_naturalizacao_pf_p timestamp, nr_ctps_p bigint, nr_serie_ctps_p text, uf_emissora_ctps_p text, dt_emissao_ctps_p timestamp, nr_portaria_nat_p text, ds_senha_p text, ds_fonetica_p text, ie_revisar_p text, cd_cnes_p text, nr_seq_perfil_p bigint, nr_same_p bigint, nr_seq_cbo_saude_p bigint, dt_integracao_externa_p timestamp, ds_fonetica_cns_p text, ds_apelido_p text, dt_geracao_pront_p timestamp, cd_municipio_ibge_p text, nr_seq_pais_p bigint, nr_cert_casamento_p text, nr_seq_cartorio_nasc_p bigint, nr_seq_cartorio_casamento_p bigint, dt_emissao_cert_nasc_p timestamp, dt_emissao_cert_casamento_p timestamp, nr_folha_cert_nasc_p bigint, nr_folha_cert_casamento_p bigint, nr_livro_cert_nasc_p bigint, nr_livro_cert_casamento_p bigint, nr_seq_nut_perfil_p bigint, nr_registro_pls_p text, dt_validade_rg_p timestamp, cd_pessoa_fisica_p INOUT text) FROM PUBLIC;

