-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE alterar_ordem_aditivos (nr_seq_contrato_atual_p bigint, nr_seq_aditivo_p bigint) AS $body$
DECLARE


nr_sequencia_w		bigint;
nr_seq_aditivo_w	integer;

c01 CURSOR FOR
SELECT	nr_sequencia
from	contrato
where (nr_seq_contrato_atual = nr_seq_contrato_atual_p)
and (ie_classificacao = 'AD')
and (ie_situacao = 'A')
order by nr_seq_aditivo;


BEGIN

nr_seq_aditivo_w := 0;

update	contrato
set	nr_seq_aditivo  = NULL
where (nr_seq_contrato_atual = nr_seq_contrato_atual_p)
and	coalesce(nr_seq_aditivo_p,nr_sequencia) = nr_sequencia
and (ie_classificacao = 'AD');

open c01;
loop
fetch c01 into
	nr_sequencia_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin

	update	contrato
	set	nr_seq_aditivo = nr_seq_aditivo_w + 1
	where (nr_sequencia = nr_sequencia_w)
	and (ie_classificacao = 'AD');

	nr_seq_aditivo_w := nr_seq_aditivo_w + 1;
	end;
end loop;
close c01;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE alterar_ordem_aditivos (nr_seq_contrato_atual_p bigint, nr_seq_aditivo_p bigint) FROM PUBLIC;

