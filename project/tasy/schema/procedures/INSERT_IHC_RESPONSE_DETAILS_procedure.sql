-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_ihc_response_details ( nr_seq_response_p bigint, cd_claim_asses_p bigint, cd_claim_exp_p bigint, ds_claim_exp_p text, ds_element_p text, ds_message_p text, nm_usuario_p text) AS $body$
DECLARE

nm_usuario_w ihc_response_details.nm_usuario%type;

BEGIN

select 	max(nm_usuario)
into STRICT 	nm_usuario_w
from 	sts_response
where 	cd_transaction = (SELECT max(a.cd_transaction) from ihc_response a where a.nr_sequencia = nr_seq_response_p)
and 	cd_process_status = 'COMPLETE';

insert into ihc_response_details( cd_claim_asses,
				  cd_claim_exp,
				  ds_claim_exp,
				  ds_element,
				  ds_message,
				  dt_atualizacao,
				  dt_atualizacao_nrec,
				  nm_usuario,
				  nm_usuario_nrec,
                                  nr_seq_response,
				  nr_sequencia)
			values (	  cd_claim_asses_p,
				  cd_claim_exp_p,
				  ds_claim_exp_p,
				  ds_element_p,
				  ds_message_p,
				  clock_timestamp(),
				  clock_timestamp(),
				  coalesce(nm_usuario_p, nm_usuario_w),
				  coalesce(nm_usuario_p, nm_usuario_w),
				  nr_seq_response_p,
				  nextval('ihc_response_details_seq'));
			
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_ihc_response_details ( nr_seq_response_p bigint, cd_claim_asses_p bigint, cd_claim_exp_p bigint, ds_claim_exp_p text, ds_element_p text, ds_message_p text, nm_usuario_p text) FROM PUBLIC;

