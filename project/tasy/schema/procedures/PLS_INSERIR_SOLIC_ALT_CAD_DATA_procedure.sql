-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_inserir_solic_alt_cad_data ( nr_seq_segurado_p bigint, ie_tipo_solicitacao_p text, ie_origem_solicitacao_p text, dt_alteracao_benef_p timestamp, dt_alteracao_p timestamp, ds_observacao_p text, nm_usuario_p text, ie_commit_p text, nr_seq_solicitacao_p INOUT text) AS $body$
DECLARE


nr_seq_solicitacao_w		pls_segurado_solic_alt.nr_sequencia%type	:= null;
dt_admissao_w			pls_segurado_solic_alt.dt_admissao%type		:= null;
ie_opcao_invalida_w		varchar(1)					:= 'N';
ie_tipo_solicitacao_w		pls_segurado_solic_alt.ie_tipo_solicitacao%type;


BEGIN

if (nr_seq_solicitacao_p IS NOT NULL AND nr_seq_solicitacao_p::text <> '') then
	select	ie_tipo_solicitacao
	into STRICT	ie_tipo_solicitacao_w
	from	pls_segurado_solic_alt
	where	nr_sequencia = nr_seq_solicitacao_p;
else
	ie_tipo_solicitacao_w	:= ie_tipo_solicitacao_p;
end if;

if (ie_tipo_solicitacao_w = '5') then
	begin
		dt_admissao_w := dt_alteracao_benef_p;
	exception
	when others then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(453777,';NM_CAMPO_P=' || wheb_mensagem_pck.get_texto(1137191) || ';DS_VALOR_P=' || dt_alteracao_benef_p);
	end;
else
	ie_opcao_invalida_w	:= 'S';
end if;

if (ie_opcao_invalida_w = 'N') then
	if (nr_seq_solicitacao_p IS NOT NULL AND nr_seq_solicitacao_p::text <> '') then
		update	pls_segurado_solic_alt
		set	dt_admissao = CASE WHEN ie_tipo_solicitacao='5' THEN  dt_admissao_w  ELSE dt_admissao END ,
			dt_alteracao = CASE WHEN dt_alteracao_p = NULL THEN  dt_alteracao  ELSE dt_alteracao_p END ,
			nm_usuario = nm_usuario_p,
			ds_observacao = CASE WHEN ds_observacao_p = NULL THEN  ds_observacao  ELSE ds_observacao_p END ,
			dt_atualizacao = clock_timestamp()
		where	nr_sequencia = nr_seq_solicitacao_p;
	else
		select	nextval('pls_segurado_solic_alt_seq')
		into STRICT	nr_seq_solicitacao_w
		;

		insert 	into 	pls_segurado_solic_alt(	nr_sequencia, nr_seq_segurado, ie_tipo_solicitacao, dt_solicitacao, dt_atualizacao,
				dt_alteracao, ie_origem_solicitacao, ds_observacao, nm_usuario, dt_atualizacao_nrec,
				nm_usuario_nrec, dt_admissao)
		values (	nr_seq_solicitacao_w, nr_seq_segurado_p, ie_tipo_solicitacao_w, clock_timestamp(), clock_timestamp(),
				dt_alteracao_p, ie_origem_solicitacao_p, coalesce(ds_observacao_p, '  '), nm_usuario_p, clock_timestamp(), 
				nm_usuario_p, dt_admissao_w);
	end if;

	if (coalesce(ie_commit_p,'N') = 'S') then
		commit;
	end if;
end if;

nr_seq_solicitacao_p := nr_seq_solicitacao_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_inserir_solic_alt_cad_data ( nr_seq_segurado_p bigint, ie_tipo_solicitacao_p text, ie_origem_solicitacao_p text, dt_alteracao_benef_p timestamp, dt_alteracao_p timestamp, ds_observacao_p text, nm_usuario_p text, ie_commit_p text, nr_seq_solicitacao_p INOUT text) FROM PUBLIC;

