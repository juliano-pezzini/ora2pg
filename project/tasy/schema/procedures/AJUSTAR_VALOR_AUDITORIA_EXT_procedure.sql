-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ajustar_valor_auditoria_ext (nr_sequencia_p bigint, ie_tipo_item_p text, vl_medico_p bigint, vl_custo_operacional_p bigint, vl_item_p bigint, nm_usuario_p text) AS $body$
DECLARE


qt_material_w			double precision;
vl_material_w			double precision;
vl_medico_w			double precision;
vl_custo_operacional_w		double precision;
vl_procedimento_w		double precision;


BEGIN

if (ie_tipo_item_p = 'M') then

	select	qt_material,
		vl_material
	into STRICT	qt_material_w,
		vl_material_w
	from	material_atend_paciente
	where	nr_sequencia	= nr_sequencia_p;

	if (coalesce(vl_material_w,0) <> coalesce(vl_item_p,0)) then

		update	material_Atend_Paciente
		set	vl_material		= vl_item_p,
			vl_unitario 		= dividir(vl_item_p,qt_material_w),
			ie_valor_informado	= 'S'
		where	nr_sequencia		= nr_sequencia_p;

	end if;

else

	select 	coalesce(vl_procedimento,0),
		coalesce(vl_medico,0),
		coalesce(vl_custo_operacional,0)
	into STRICT	vl_procedimento_w,
		vl_medico_w,
		vl_custo_operacional_w
	from 	procedimento_paciente
	where 	nr_sequencia = nr_sequencia_p;

	if	((vl_medico_p <> vl_medico_w) or (vl_custo_operacional_p <> vl_custo_operacional_w) or (vl_item_p <> vl_procedimento_w)) then

		update	procedimento_paciente
		set	vl_procedimento			= vl_item_p,
			vl_custo_operacional		= vl_custo_operacional_p,
			vl_medico			= vl_medico_p,
			ie_valor_informado		= 'S'
		where	nr_sequencia			= nr_sequencia_p;

	end if;

end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ajustar_valor_auditoria_ext (nr_sequencia_p bigint, ie_tipo_item_p text, vl_medico_p bigint, vl_custo_operacional_p bigint, vl_item_p bigint, nm_usuario_p text) FROM PUBLIC;

