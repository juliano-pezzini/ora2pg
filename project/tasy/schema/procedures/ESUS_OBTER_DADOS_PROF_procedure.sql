-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE esus_obter_dados_prof ( cd_profissional_p sus_profissional_equipe.cd_pessoa_fisica%type, nr_seq_equipe_sus_p INOUT sus_profissional_equipe.nr_seq_equipe_sus%type, cd_cbo_p INOUT sus_profissional_equipe.cd_cbo%type, cd_municipio_equipe_p INOUT sus_profissional_equipe.cd_municipio_equipe%type, nr_cnes_equipe_p INOUT sus_profissional_equipe.nr_cnes_equipe%type, nr_seq_equipe_p INOUT sus_equipe.nr_sequencia%type, ds_erro_p INOUT text) AS $body$
DECLARE



nr_seq_equipe_w			sus_equipe.nr_sequencia%type := 0;
nr_seq_equipe_sus_w		sus_profissional_equipe.nr_seq_equipe_sus%type := '';
cd_cbo_equipe_w			sus_profissional_equipe.cd_cbo%type  := '';
cd_municipio_equipe_w		sus_profissional_equipe.cd_municipio_equipe%type := '';
nr_cnes_equipe_w		sus_profissional_equipe.nr_cnes_equipe%type := '';
dt_competencia_w	sus_equipe.dt_competencia%type;
ds_erro_w			varchar(255) := '';


BEGIN

begin
select	nr_seq_equipe_sus,
	cd_cbo,
	cd_municipio_equipe,
	nr_cnes_equipe
into STRICT	nr_seq_equipe_sus_w,
	cd_cbo_equipe_w,
	cd_municipio_equipe_w,
	nr_cnes_equipe_w
from	sus_profissional_equipe
where	cd_pessoa_fisica = cd_profissional_p  LIMIT 1;
exception
when others then
	nr_seq_equipe_sus_w	:= '';
	cd_cbo_equipe_w		:= '';
	cd_municipio_equipe_w	:= '';
	nr_cnes_equipe_w	:= '';
	ds_erro_w := substr(wheb_mensagem_pck.Get_texto(483193),1,255);
end;

begin
select	max(a.dt_competencia)
into STRICT	dt_competencia_w
from	sus_equipe a
where	a.cd_municipio_ibge = cd_municipio_equipe_w
and	a.nr_cnes_equipe = nr_cnes_equipe_w
and	a.nr_seq_equipe = nr_seq_equipe_sus_w;
exception
when others then
	dt_competencia_w := clock_timestamp();
end;

begin
select	coalesce(max(nr_sequencia),0)
into STRICT	nr_seq_equipe_w
from	sus_equipe
where	nr_seq_equipe = nr_seq_equipe_sus_w
and	cd_municipio_ibge = cd_municipio_equipe_w
and	nr_cnes_equipe = nr_cnes_equipe_w;
exception
when others then
	nr_seq_equipe_w := 0;
	ds_erro_w := substr(wheb_mensagem_pck.Get_texto(483193),1,255);
end;

nr_seq_equipe_sus_p		:= nr_seq_equipe_sus_w;
cd_cbo_p			:= cd_cbo_equipe_w;
cd_municipio_equipe_p		:= cd_municipio_equipe_w;
nr_cnes_equipe_p		:= nr_cnes_equipe_w;
nr_seq_equipe_p			:= nr_seq_equipe_w;
ds_erro_p			:= ds_erro_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE esus_obter_dados_prof ( cd_profissional_p sus_profissional_equipe.cd_pessoa_fisica%type, nr_seq_equipe_sus_p INOUT sus_profissional_equipe.nr_seq_equipe_sus%type, cd_cbo_p INOUT sus_profissional_equipe.cd_cbo%type, cd_municipio_equipe_p INOUT sus_profissional_equipe.cd_municipio_equipe%type, nr_cnes_equipe_p INOUT sus_profissional_equipe.nr_cnes_equipe%type, nr_seq_equipe_p INOUT sus_equipe.nr_sequencia%type, ds_erro_p INOUT text) FROM PUBLIC;

