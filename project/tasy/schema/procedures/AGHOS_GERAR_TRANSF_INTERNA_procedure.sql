-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE aghos_gerar_transf_interna (nr_atendimento_p integer, nr_seq_atepacu_p integer, nm_usuario_p text, nr_seq_contig_p integer) AS $body$
DECLARE

 
ds_sqlerror_w			varchar(2000);
ds_erro_aghos_w			varchar(2000);
			

BEGIN 
 
begin 
	CALL Aghos_transferencia_interna(nr_atendimento_p, nr_seq_atepacu_p, nm_usuario_p);
exception 
	when	others then 
		begin 
		ds_sqlerror_w := sqlerrm;
		ds_erro_aghos_w := substr(Ajusta_mensagem_erro_aghos(ds_sqlerror_w), 1, 2000);					
		CALL wheb_mensagem_pck.exibir_mensagem_abort(228493, 'DS_MENSAGEM=' || coalesce(ds_erro_aghos_w, ds_sqlerror_w));
		end;
end;
 
update  aghos_contigencia_mov 
set   dt_resolvida   = clock_timestamp(), 
     dt_atualizacao  = clock_timestamp(), 
     nm_usuario    = wheb_usuario_pck.get_nm_usuario, 
     nm_usuario_resol = wheb_usuario_pck.get_nm_usuario 
where  nr_sequencia   = nr_seq_contig_p;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE aghos_gerar_transf_interna (nr_atendimento_p integer, nr_seq_atepacu_p integer, nm_usuario_p text, nr_seq_contig_p integer) FROM PUBLIC;

