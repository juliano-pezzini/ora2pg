-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_era_report_response ( ie_type_era_p text, nm_usuario_p text, cd_transaction_p text, cd_status_p bigint, nm_bank_account_p text, cd_bank_account_p text, cd_bsb_p bigint, vl_deposit_p bigint, nr_part_p bigint, nr_part_total_p bigint, cd_payee_location_p text, nm_payer_p text, cd_reference_p text, dt_payment_p timestamp, cd_remittance_p text) AS $body$
DECLARE


nr_sequencia_w	era_report_response.nr_sequencia%type;
vl_deposit_w	era_report_response.vl_deposit%type;
count_w			integer;


BEGIN

select	nextval('era_report_response_seq')
into STRICT	nr_sequencia_w
;

select 	coalesce(count(nr_sequencia),0)
into STRICT 	count_w
from 	era_report_response
where 	cd_transaction = cd_transaction_p
and 	nr_part = nr_part_p
and 	nr_part_total = nr_part_total_p;

if (count_w = 0) then
	vl_deposit_w := vl_deposit_p / 100;
	insert into era_report_response(
								nr_sequencia,
								ie_type_era,
								dt_atualizacao,
								nm_usuario,
								dt_atualizacao_nrec,
								nm_usuario_nrec,
								cd_transaction,
								cd_status,
								nm_bank_account,
								cd_bank_account,
								cd_bsb,
								vl_deposit,
								nr_part,
								nr_part_total,
								cd_payee_location,
								nm_payer,
								cd_reference,
								dt_payment,
								cd_remittance)
						values (	nr_sequencia_w,
								ie_type_era_p,
								clock_timestamp(),
								nm_usuario_p,
								clock_timestamp(),
								nm_usuario_p,
								cd_transaction_p,
								cd_status_p,
								nm_bank_account_p,
								cd_bank_account_p,
								cd_bsb_p,
								vl_deposit_w,
								nr_part_p,
								nr_part_total_p,
								cd_payee_location_p,
								nm_payer_p,
								cd_reference_p,
								dt_payment_p,
								cd_remittance_p);
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_era_report_response ( ie_type_era_p text, nm_usuario_p text, cd_transaction_p text, cd_status_p bigint, nm_bank_account_p text, cd_bank_account_p text, cd_bsb_p bigint, vl_deposit_p bigint, nr_part_p bigint, nr_part_total_p bigint, cd_payee_location_p text, nm_payer_p text, cd_reference_p text, dt_payment_p timestamp, cd_remittance_p text) FROM PUBLIC;

