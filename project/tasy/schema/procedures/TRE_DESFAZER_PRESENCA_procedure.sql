-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE tre_desfazer_presenca (dt_treinamento_p timestamp, nr_seq_evento_p bigint, nr_seq_mod_evento_p bigint) AS $body$
DECLARE


nr_seq_presenca_w	bigint;

c01 CURSOR FOR
SELECT 	a.nr_sequencia
from	tre_inscrito_presenca a,
	tre_inscrito b,
	tre_evento_modulo c
where	a.nr_seq_inscrito = b.nr_sequencia
and	b.nr_seq_evento = c.nr_seq_evento
and 	((b.nr_seq_mod_evento = nr_seq_mod_evento_p) or (coalesce(b.nr_seq_mod_evento::text, '') = ''))
and	c.nr_seq_evento = nr_seq_evento_p
and	a.dt_presenca = dt_treinamento_p;


BEGIN

open c01;
loop
fetch c01 into
	nr_seq_presenca_w;
EXIT WHEN NOT FOUND; /* apply on c01 */

	delete	from tre_inscrito_presenca
	where	nr_sequencia = nr_seq_presenca_w;

	commit;

end loop;
close c01;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tre_desfazer_presenca (dt_treinamento_p timestamp, nr_seq_evento_p bigint, nr_seq_mod_evento_p bigint) FROM PUBLIC;

