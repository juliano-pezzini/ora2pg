-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE update_ultima_geracao_pj ( nr_sequencia_p bigint, nm_usuario_p text) AS $body$
DECLARE


	nr_seq_jornada_pac_w	bigint;
	nr_seq_jornada_grupo_w	bigint;

C01 CURSOR FOR
	SELECT	nr_sequencia
	FROM	w_jornada_pac_grupo
	WHERE 	NR_SEQ_MOD_JORNADA in ( SELECT nr_sequencia
									FROM w_jornada_pac
									WHERE NR_SEQ_MODELO = nr_sequencia_p);

C02 CURSOR FOR
	SELECT	nr_sequencia
	FROM	w_jornada_pac_registro
	WHERE 	NR_SEQ_JORNADA_GRUPO = nr_seq_jornada_grupo_w;
BEGIN
	FOR c01_w IN C01 LOOP
		BEGIN
			nr_seq_jornada_grupo_w := c01_w.nr_sequencia;
			FOR c02_w IN C02 LOOP
				BEGIN
					DELETE FROM w_jornada_pac_problema
					WHERE 	NR_SEQ_REGISTRO = c02_w.nr_sequencia;
					COMMIT;

					DELETE	FROM w_jornada_pac_registro
					WHERE	nr_sequencia = c02_w.nr_sequencia;
					COMMIT;
				END;
			END LOOP;
			DELETE 	FROM w_jornada_pac_subgrupo
			WHERE 	NR_SEQ_JORNADA_GRUPO = nr_seq_jornada_grupo_w;
			COMMIT;

			DELETE 	FROM w_jornada_pac_grupo
			WHERE 	NR_SEQUENCIA = nr_seq_jornada_grupo_w;
			commit;
		END;
	END LOOP;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE update_ultima_geracao_pj ( nr_sequencia_p bigint, nm_usuario_p text) FROM PUBLIC;

