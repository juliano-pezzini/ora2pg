-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE dirf_registro_respo ( nr_seq_lote_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
ds_arquivo_w	varchar(2000);
separador_w	varchar(1) := '|';


BEGIN 
 
select 	'RESPO' || separador_w || --nome arquivo 
	lpad(coalesce(substr(obter_dados_pf(e.cd_contabilista,'CPF'),1,11),'0'),11,'0') || separador_w || --cpf do responsável pelo preenchimento 
	substr(obter_nome_pf_pj(e.cd_contabilista,null),1,60) || separador_w || --Nome do responsável pelo preenchimento 
	substr(obter_compl_pf(e.cd_contabilista,2,'DDT'),1,8) || separador_w || -- DDD do telefone do responsável pelo preenchimento 
	substr(obter_compl_pf(e.cd_contabilista,2,'T'),1,8) || separador_w || -- Telefone do responsável pelo preenchimento 
	substr(obter_compl_pf(e.cd_contabilista,2,'RAM'),1,6) || separador_w || --Ramal do responsável pelo preenchimento 
	substr(obter_compl_pf(e.cd_contabilista,2,'FAX'),1,8) || separador_w || --Fax do responsável pelo preenchimento 
	substr(obter_compl_pf(e.cd_contabilista,2,'M'),1,50) || separador_w --E-mail do responsável pelo preenchimento 
into STRICT	ds_arquivo_w	 
from	dirf_lote a, 
	estabelecimento b, 
	empresa e 
where	a.cd_estabelecimento	= b.cd_estabelecimento 
and	b.cd_empresa = e.cd_empresa	 
and	a.nr_sequencia = nr_seq_lote_p;
 
insert 	into w_dirf_arquivo(nr_sequencia, 
			   nm_usuario, 
			   nm_usuario_nrec, 
			   dt_atualizacao, 
			   dt_atualizacao_nrec, 
			   ds_arquivo, 
			   nr_seq_apresentacao, 
			   nr_seq_registro) 
values (nextval('w_dirf_arquivo_seq'), 
			   nm_usuario_p, 
			   nm_usuario_p, 
			   clock_timestamp(), 
			   clock_timestamp(), 
			   ds_arquivo_w, 
			   2, 
			   0);
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE dirf_registro_respo ( nr_seq_lote_p bigint, nm_usuario_p text) FROM PUBLIC;

