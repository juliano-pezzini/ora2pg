-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_insere_sis_pac_log ( ds_retorno_p text, cd_status_exec_p bigint, nr_seq_requisicao_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text ) AS $body$
DECLARE


ie_existe_w varchar(1);


BEGIN

  begin
    select CASE WHEN coalesce(nr_seq_requisicao::text, '') = '' THEN  'N'  ELSE 'S' END
      into STRICT ie_existe_w
      from pls_sis_pac_log 
     where nr_seq_requisicao = nr_seq_requisicao_p 
       and cd_status_exec = cd_status_exec_p;
  exception
       when too_many_rows then
            ie_existe_w := 'S';
        when no_data_found then
            ie_existe_w := 'N';
	end;

  if ie_existe_w = 'N' then
    insert into pls_sis_pac_log(
           nr_sequencia,
           cd_estabelecimento,
           dt_atualizacao,
           nm_usuario,
           dt_atualizacao_nrec,
           nm_usuario_nrec,
           nr_seq_requisicao,
           ds_retorno,
           cd_status_exec)
    values (nextval('pls_sis_pac_log_seq'),
            cd_estabelecimento_p,
            clock_timestamp(),
            nm_usuario_p,
            clock_timestamp(),
            nm_usuario_p,
            nr_seq_requisicao_p,
            ds_retorno_p,
            cd_status_exec_p);

            commit;
  end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_insere_sis_pac_log ( ds_retorno_p text, cd_status_exec_p bigint, nr_seq_requisicao_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text ) FROM PUBLIC;

