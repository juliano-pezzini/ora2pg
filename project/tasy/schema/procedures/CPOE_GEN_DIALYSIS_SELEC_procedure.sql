-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cpoe_gen_dialysis_selec ( nr_atendimento_p bigint, cd_perfil_p bigint, nm_usuario_p text, cd_paciente_p text, nr_seq_item_gerado_p INOUT bigint, ie_prescritor_aux_p text default 'N', cd_medico_p bigint default null, nr_seq_cpoe_order_unit_p cpoe_dialise.nr_seq_cpoe_order_unit%type DEFAULT NULL, ie_tipo_p text DEFAULT NULL) AS $body$
DECLARE


ie_tipo_dialise_w		varchar(10);
ie_tipo_hemodialise_w	cpoe_dialise.ie_tipo_hemodialise%type;
ie_tipo_peritoneal_w	cpoe_dialise.ie_tipo_peritoneal%type;


BEGIN

select	nextval('cpoe_dialise_seq')
into STRICT	nr_seq_item_gerado_p
;

if (ie_tipo_p in ('CAPA', 'DPI', 'DPA')) then
	ie_tipo_dialise_w := 'DP';
	ie_tipo_peritoneal_w := ie_tipo_p;
else
	ie_tipo_dialise_w := 'DI';
	ie_tipo_hemodialise_w := ie_tipo_p;
end if;


insert into cpoe_dialise(
		nr_sequencia,
		nr_atendimento,
		cd_pessoa_fisica,
		nm_usuario,
		nm_usuario_nrec,
		dt_atualizacao,
		dt_atualizacao_nrec,
		cd_perfil_ativo,
		cd_funcao_origem,
		ie_prescritor_aux,
		cd_medico,
		nr_seq_cpoe_order_unit,
		ie_tipo_dialise,
		dt_inicio,
		ie_tipo_hemodialise,
		ie_tipo_peritoneal)
	values (
		nr_seq_item_gerado_p,
		nr_atendimento_p,
		cd_paciente_p,
		nm_usuario_p,
		nm_usuario_p,
		clock_timestamp(),
		clock_timestamp(),
		cd_perfil_p,
		2314,
		ie_prescritor_aux_p,
		cd_medico_p,
		nr_seq_cpoe_order_unit_p,
		ie_tipo_dialise_w,
		obter_prox_hora_cheia_gpt(clock_timestamp()),
		ie_tipo_hemodialise_w,
		ie_tipo_peritoneal_w);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_gen_dialysis_selec ( nr_atendimento_p bigint, cd_perfil_p bigint, nm_usuario_p text, cd_paciente_p text, nr_seq_item_gerado_p INOUT bigint, ie_prescritor_aux_p text default 'N', cd_medico_p bigint default null, nr_seq_cpoe_order_unit_p cpoe_dialise.nr_seq_cpoe_order_unit%type DEFAULT NULL, ie_tipo_p text DEFAULT NULL) FROM PUBLIC;

