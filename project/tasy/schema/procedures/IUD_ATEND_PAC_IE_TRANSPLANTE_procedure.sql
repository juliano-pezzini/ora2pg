-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE iud_atend_pac_ie_transplante ( nr_atendimento_p atendimento_paciente_inf.nr_atendimento%type, nm_usuario_p text, operation_type_p text, ie_transplante_p atendimento_paciente_inf.ie_transplante%type ) AS $body$
DECLARE


nr_seq_atend_pac_inf_seq_w	atendimento_paciente_inf.nr_sequencia%type;
nr_seq_atend_pac_inf_w		atendimento_paciente_inf.nr_sequencia%type;


BEGIN

  SELECT MAX(nr_sequencia)
  INTO STRICT nr_seq_atend_pac_inf_w
  FROM atendimento_paciente_inf
  WHERE nr_atendimento = nr_atendimento_p;

  IF (operation_type_p NOT IN ('DELETE')) THEN
    IF (coalesce(nr_seq_atend_pac_inf_w::text, '') = '') THEN

      SELECT nextval('atendimento_paciente_inf_seq')
      INTO STRICT nr_seq_atend_pac_inf_seq_w
;

      INSERT INTO atendimento_paciente_inf(
          nr_sequencia,
          dt_atualizacao,
          nm_usuario,
          dt_atualizacao_nrec,
          nm_usuario_nrec,
          nr_atendimento,
          ie_transplante
        )
        VALUES (
          nr_seq_atend_pac_inf_seq_w,
          clock_timestamp(),
          nm_usuario_p,
          clock_timestamp(),
          nm_usuario_p,
          nr_atendimento_p,
          ie_transplante_p
        );
    ELSIF (nr_seq_atend_pac_inf_w IS NOT NULL AND nr_seq_atend_pac_inf_w::text <> '') THEN

      UPDATE atendimento_paciente_inf p
      SET p.ie_transplante	= ie_transplante_p,
        p.dt_atualizacao_nrec	= clock_timestamp(),
        p.nm_usuario_nrec	= nm_usuario_p
      WHERE p.nr_atendimento	= nr_atendimento_p
      AND p.nr_sequencia	= nr_seq_atend_pac_inf_w;
    END IF;
  END IF;
  COMMIT;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE iud_atend_pac_ie_transplante ( nr_atendimento_p atendimento_paciente_inf.nr_atendimento%type, nm_usuario_p text, operation_type_p text, ie_transplante_p atendimento_paciente_inf.ie_transplante%type ) FROM PUBLIC;

