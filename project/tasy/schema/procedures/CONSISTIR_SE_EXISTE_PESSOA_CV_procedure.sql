-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consistir_se_existe_pessoa_cv ( cd_pessoa_fisica_p text, nm_usuario_p text, ds_erro_p INOUT text ) AS $body$
BEGIN
if (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') then

	select	max(a.ds_erro)
	into STRICT	ds_erro_p
	from (
		SELECT (obter_texto_dic_objeto(228401, wheb_usuario_pck.get_nr_seq_idioma, null) || Chr(10) ||
                                                 obter_texto_dic_objeto(880920, wheb_usuario_pck.get_nr_seq_idioma, null) || ' ' || nr_atendimento || Chr(10) ||
												 obter_texto_dic_objeto(1088673, wheb_usuario_pck.get_nr_seq_idioma, null) || ' ' || obter_nome_estabelecimento(obter_estab_atend(nr_atendimento))) ds_erro/* Visitante paciente */
												
		from	atendimento_visita
		where	cd_pessoa_fisica = cd_pessoa_fisica_p
		and	coalesce(dt_saida::text, '') = ''
		and	coalesce(ie_paciente,'N') = 'N'
		and	coalesce(cd_setor_atendimento::text, '') = ''
		
union all

		SELECT	obter_texto_dic_objeto(228402, wheb_usuario_pck.get_nr_seq_idioma, null) ds_erro /* Visitante setor */
    
		from	atendimento_visita
		where	cd_pessoa_fisica = cd_pessoa_fisica_p
		and	coalesce(dt_saida::text, '') = ''
		and	coalesce(ie_paciente,'N') = 'N'
		and	(cd_setor_atendimento IS NOT NULL AND cd_setor_atendimento::text <> '')
		
union all

		select (obter_texto_dic_objeto(228403, wheb_usuario_pck.get_nr_seq_idioma, null) || Chr(10) ||
                                          obter_texto_dic_objeto(880920, wheb_usuario_pck.get_nr_seq_idioma, null) || ' ' || nr_atendimento || Chr(10) ||
										  obter_texto_dic_objeto(1088673, wheb_usuario_pck.get_nr_seq_idioma, null) || ' ' || obter_nome_estabelecimento(obter_estab_atend(nr_atendimento))) ds_erro/* Paciente */
		from	atendimento_visita
		where	cd_pessoa_fisica = cd_pessoa_fisica_p
		and	coalesce(dt_saida::text, '') = ''
		and	coalesce(ie_paciente,'N') = 'S'
		
union all

		select (obter_texto_dic_objeto(228404, wheb_usuario_pck.get_nr_seq_idioma, null) || Chr(10) ||
			 obter_texto_dic_objeto(880920, wheb_usuario_pck.get_nr_seq_idioma, null) || ' ' || nr_atendimento || Chr(10) ||
										  obter_texto_dic_objeto(1088673, wheb_usuario_pck.get_nr_seq_idioma, null) || ' ' || obter_nome_estabelecimento(obter_estab_atend(nr_atendimento))) ds_erro/* Acompanhante */
		from	atendimento_acompanhante
		where	cd_pessoa_fisica = cd_pessoa_fisica_p
		and	coalesce(dt_saida::text, '') = '' ) a;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consistir_se_existe_pessoa_cv ( cd_pessoa_fisica_p text, nm_usuario_p text, ds_erro_p INOUT text ) FROM PUBLIC;

