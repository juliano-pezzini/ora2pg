-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE desf_agend_cons_beforeposta_js ( cd_medico_dest_p text, qt_ds_orientacao_p bigint, ie_desfecho_p text, ie_medico_ciente_p text, nm_usuario_p text, cd_pessoa_fisica_p text, cd_estabelecimento_p bigint ) AS $body$
DECLARE


ie_se_medico_w			varchar(1)	:= 'N';
qt_caracteres_min_w		bigint 	:= 0;
qt_caracteres_min_med_cli_w	bigint 	:= 0;


BEGIN

ie_se_medico_w := obter_se_Medico(cd_medico_dest_p,'M');

if (cd_medico_dest_p IS NOT NULL AND cd_medico_dest_p::text <> '') and (ie_se_medico_w = 'N') then
	begin
	RAISE EXCEPTION '%', substr(obter_texto_tasy(61393, wheb_usuario_pck.get_nr_seq_idioma),1,255) || '#@#@' USING ERRCODE = '45011';
	end;
end if;

qt_caracteres_min_w := obter_param_usuario(935, 94, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, qt_caracteres_min_w);

if (qt_caracteres_min_w > 0) and (qt_ds_orientacao_p < qt_caracteres_min_w) then
	begin
	RAISE EXCEPTION '%', substr(obter_texto_dic_objeto(61394,wheb_usuario_pck.get_nr_seq_idioma,'CARACTERESMIN='|| qt_caracteres_min_w),1,255) || '#@#@' USING ERRCODE = '45011';
	end;
end if;

qt_caracteres_min_med_cli_w := obter_param_usuario(935, 126, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, qt_caracteres_min_med_cli_w);

if (qt_caracteres_min_med_cli_w > 0) and (ie_desfecho_p = 'I') and (ie_medico_ciente_p = 'N') and
	((cd_medico_dest_p <> cd_pessoa_fisica_p)  or (coalesce(cd_medico_dest_p::text, '') = '')) and (qt_ds_orientacao_p < qt_caracteres_min_w) then
	begin
	RAISE EXCEPTION '%', substr(obter_texto_dic_objeto(61395,wheb_usuario_pck.get_nr_seq_idioma,'CARACTERESMIN='|| qt_caracteres_min_w),1,255) || '#@#@' USING ERRCODE = '45011';
	end;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE desf_agend_cons_beforeposta_js ( cd_medico_dest_p text, qt_ds_orientacao_p bigint, ie_desfecho_p text, ie_medico_ciente_p text, nm_usuario_p text, cd_pessoa_fisica_p text, cd_estabelecimento_p bigint ) FROM PUBLIC;

