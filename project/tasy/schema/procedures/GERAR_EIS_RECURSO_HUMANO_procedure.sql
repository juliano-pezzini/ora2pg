-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_eis_recurso_humano ( nm_view_p text, dt_parametro_p timestamp, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE


ds_comando_w		varchar(2000);
dt_parametro_Inicio_w	timestamp;
dt_parametro_fim_w	timestamp;
varsql			varchar(1)	:= chr(39);


BEGIN

--Insert into Log_xxxTasy values (sysdate, nm_usuario_p, 607, 'Recurso humano');
--commit;
dt_parametro_Inicio_w	:= trunc(dt_parametro_p,'month');
dt_parametro_fim_w	:= last_day(dt_parametro_p) + 86399/86400;

delete from eis_recurso_humano
where dt_referencia between dt_parametro_inicio_w and dt_parametro_fim_w;

ds_comando_w	:=	'	insert into eis_recurso_humano (nr_sequencia,		' ||
			'	dt_atualizacao, nm_usuario, dt_atualizacao_nrec,	' ||
			'	nm_usuario_nrec, qt_empregado, ie_tipo_colaborador,	' ||
			'	cd_funcionario, nm_empresa, dt_referencia, 		' ||
			'	nm_funcionario, cd_centro_custo, nm_centro_custo,	' ||
			'	ie_admitido, ie_demitido, ds_causa_demissao,		' ||
			'	ie_trabalhando, ie_ferias, ie_licensa_maternidade,	' ||
			'	ie_acidente_trabalho, ie_auxilio_doenca, ie_reajuste,	' ||
			'	vl_reajuste, ds_motivo_reajuste, vl_ferias, 		' ||
			'	qt_hora_extra, vl_hora_extra, qt_hora_justificada,	' ||
			'	vl_hora_justificada, qt_hora_acidente_trab,		' ||
			'	vl_hora_acidente_trab, qt_hora_injustificada,		' ||
			'	vl_hora_injustificada, qt_hora_maternidade,		' ||
			'	vl_hora_maternidade, qt_hora_paternidade,		' ||
			'	vl_hora_paternidade, qt_hora_serv_militar,		' ||
			'	vl_hora_serv_militar, qt_hora_aux_doenca,		' ||
			'	vl_hora_aux_doenca, vl_salario_bruto, 			' ||
			'	vl_salario_liquido, ds_tipo_contrato, 			' ||
			'	qt_hora_trabalhada, cd_funcao, ds_funcao, ie_afastado,	' ||
			'	ie_aposentado_invalid)					' ||
			'	select eis_recurso_humano_seq.nextval, sysdate,		' ||
			 	varsql || nm_usuario_p || varsql || ', sysdate, 	' ||
				varsql || nm_usuario_p || varsql || ', qt_empregado,	' ||
			'	ie_tipo_colaborador, cd_funcionario, nm_empresa,	' ||
			'	dt_referencia, nm_funcionario, cd_centro_custo,		' ||
			'	nm_centro_custo, ie_admitido, ie_demitido,		' ||
			'	ds_causa_demissao, ie_trabalhando, ie_ferias,		' ||
			'	ie_licensa_maternidade, ie_acidente_trabalho,		' ||
			'	ie_auxilio_doenca, ie_reajuste, vl_reajuste,		' ||
			'	ds_motivo_reajuste, vl_ferias, qt_hora_extra,		' ||
			'	vl_hora_extra, qt_hora_justificada, 			' ||
			'	vl_hora_justificada, qt_hora_acidente_trab,		' ||
			'	vl_hora_acidente_trab, qt_hora_injustificada,		' ||
			'	vl_hora_injustificada, qt_hora_maternidade,		' ||
			'	vl_hora_maternidade, qt_hora_paternidade,		' ||
			'	vl_hora_paternidade, qt_hora_serv_militar,		' ||
			'	vl_hora_serv_militar, qt_hora_aux_doenca,		' ||
			'	vl_hora_aux_doenca, vl_salario_bruto, 			' ||
			'	vl_salario_liquido, ds_tipo_contrato, 			' ||
			'	qt_hora_trabalhada, cd_funcao, ds_funcao, ie_afastado,	' ||
			'	ie_aposentado_invalid 					' ||
			'	from ' || nm_view_p 					  ||
			'	where dt_referencia between to_date(' || chr(39) || dt_parametro_inicio_w || chr(39) || ') and to_date(' ||
			chr(39) || dt_parametro_fim_w || chr(39) || ')';

CALL Exec_sql_dinamico(nm_usuario_p, ds_comando_w);

--Insert into Log_xxxTasy values (sysdate, nm_usuario_p, 601, 'Recurso humano');
commit;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_eis_recurso_humano ( nm_view_p text, dt_parametro_p timestamp, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

