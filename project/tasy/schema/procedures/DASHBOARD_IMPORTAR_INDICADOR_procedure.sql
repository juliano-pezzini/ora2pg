-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE dashboard_importar_indicador ( nr_seq_indicador_p ind_base_importacao.nr_seq_indicador%type, dt_reference_p timestamp, ds_dimension_attribute_p text, ds_dimension_value_p text, ds_information_attribute_p text, qt_value_information_p bigint, nm_usuario_p text) AS $body$
DECLARE

				

nr_seq_dimensao_w ind_base_importacao.nr_seq_dimensao%type;
nr_seq_informacao_w	ind_base_importacao.nr_seq_informacao%type;

BEGIN
	
	
if (coalesce(nr_seq_indicador_p,0)		<> 0)   and (coalesce(ds_dimension_attribute_p,'X')			<> 'X') and (coalesce(ds_dimension_value_p,'X')	<> 'X') and (coalesce(ds_information_attribute_p,'X')		<> 'X') and (coalesce(qt_value_information_p,0)				<> 0) then
	
select	nr_sequencia
into STRICT	nr_seq_dimensao_w
from	ind_dimensao
where upper(ds_atributo)	= upper(ds_dimension_attribute_p)
and nr_seq_indicador		= nr_seq_indicador_p;	

select	nr_sequencia
into STRICT	nr_seq_informacao_w
from	ind_informacao
where upper(ds_atributo)	= upper(ds_information_attribute_p)
and nr_seq_indicador		= nr_seq_indicador_p;	
	
	
	insert into ind_base_importacao(
		nr_sequencia,
		nr_seq_indicador,
		dt_referencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		ds_dimensao_valor,
		qt_valor,
		nr_seq_dimensao,
		nr_seq_informacao)
	values (	nextval('ind_base_importacao_seq'),
		nr_seq_indicador_p,
		dt_reference_p,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		ds_dimension_value_p,
		qt_value_information_p,
		nr_seq_dimensao_w,
		nr_seq_informacao_w );
	
	commit;
end if;
	
				
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE dashboard_importar_indicador ( nr_seq_indicador_p ind_base_importacao.nr_seq_indicador%type, dt_reference_p timestamp, ds_dimension_attribute_p text, ds_dimension_value_p text, ds_information_attribute_p text, qt_value_information_p bigint, nm_usuario_p text) FROM PUBLIC;

