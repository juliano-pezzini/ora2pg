-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE importar_analise_ortografica ( nr_seq_lote_p bigint, ds_arquivo_p text, ds_conteudo_p text, nr_linha_p bigint, ie_gerar_relacao_p text, nm_usuario_p text, ie_commit_p text) AS $body$
DECLARE

 
/* 
 
>10<	Quebra de linha chr(10) 
>13<	Quebra de linha chr(13) 
>PV<	Ponto e vírgula 
>CL<	Continua na próxima linha 
 
ds_conteudo_p (separado com ponto e vírgula):	ATENÇÃO!!! A DATA DE ORIGEM DEVE FICAR SEMPRE NO FINAL 
 
1	origem da informação	nm_tabela_origem		tabela de onde vem a informação 
2	form			ds_form				nome do form delphi (CorCpaF8, FatActFF...) 
3	campo			ds_campo			campo de origem da informação (DS_LABEL, Caption, ShowMessage...) 
4	conteúdo análise	ds_conteudo_campo		conteúdo do campo de origem da informação 
5	campo pai		ds_campo_pai			campo pai do campo de origem da informação 
6	nome da tabela		nm_tabela			nome da tabela (TABELA_ATRIBUTO, DIC_OBJETO...) 
7	nome do atributo	nm_atributo			nome do atributo (quando a tabela for TABELA_ATRIBUTO ou TABELA_VISAO_ATRIBUTO) 
8	visão			nr_seq_visao			número de sequência da visão (quando a tabela for TABELA_VISAO_ATRIBUTO) 
9	objeto			nr_seq_objeto			número de sequência do objeto (quando a tabela for DIC_OBJETO) 
10	objeto filtro		nr_seq_obj_filtro		número de sequência do objeto (quando a tabela for DIC_OBJETO_FILTRO) 
11	cor			nr_seq_cor			número de sequência da cor (quando a tabela for TASY_PADRAO_COR) 
12	domínio			cd_dominio			código do domínio (quando a tabela for VALOR_DOMINIO) 
13	valor do domínio	vl_dominio			valor do domínio (quando a tabela for VALOR_DOMINIO) 
14	usuário responsável	nm_usuario_origem		usuário que realizou a última alteração na tabela de origem 
15	lote			nr_seq_lote			lote de análise ortográfica 
16	funcão			cd_funcao			código da função (quando a tabela for FUNCAO_PARAMETRO) 
17	parâmetro		nr_seq_parametro		sequência do parâmetro (quando a tabela for FUNCAO_PARAMETRO) 
18	relatório		nr_seq_relatorio		número de sequência do relatório 
19	campo relatório		nr_seq_campo_relat		número de sequência do campo do relatório 
20	parâmetro do relatório	nr_seq_param_relat		número de sequência do parâmetro do relatório 
21	classe			ds_classe_objeto		classe do componente delphi (TLabel, TEdit...) 
22	nome do objeto		ds_nome_objeto			nome do componente delphi (filtros_ort_me, total_la...) 
23	método			ds_metodo			nome do método pai no delphi (atualizar_consulta_miClick...) 
24	número do parâmetro	nr_parametro			número do parâmetro do método 
25	ocorrência		nr_ocorrencia			ocorrência do método dentro do método pai 
26	indicador de gestão	nr_seq_ind_gestao		número de sequência do indicador de gestão (quando a tabela for INDICADOR_GESTAO, INDICADOR_GESTAO_ATRIB ou SUBINDICADOR_GESTAO) 
27	atributo indicador	nr_seq_ind_gestao_atrib		número de sequência do atributo do indicador de gestão (quando a tabela for INDICADOR_GESTAO_ATRIB) 
28	subindicador de gestão	nr_seq_subind_gestao		número de sequência do subindicador de gestão (quando a tabela for SUBINDICADOR_GESTAO) 
29	atributo subindicador	nr_seq_subind_gestao_atrib	número de sequência do atributo do subindicador de gestão (quando a tabela for SUBINDICADOR_GESTAO_ATRIB) 
30	interface		cd_interface			código da interface (quando a tabela for INTERFACE) 
31	referência		nr_seq_referencia		número de sequência do registro na tabela de origem 
32	tipo de lote contábil	cd_tipo_lote_contabil		código do tipo de lote contábil (quando a tabela for TIPO_LOTE_CONTABIL) 
33	expressão			cd_expressao		código da expressão cadastrada no Dicionário de Expressões (quando a tabela for DIC_EXPRESSAO) 
34	data de origem		dt_origem			data da última alteração na tabela de origem (ddmmyyyy) 
*/
 
 
ds_conteudo_arq_w		varchar(32000);
nr_pos_linha_w			bigint;

nm_tabela_origem_w		varchar(50);
nr_seq_origem_w			bigint;
nr_sequencia_w			bigint;
ds_dt_origem_w			varchar(255);
dt_origem_w			timestamp;
ie_diferenca_w			varchar(1);
nr_seq_lote_origem_w		bigint;

nm_tabela_w			varchar(50);
nm_atributo_w			varchar(50);
nm_usuario_origem_w		varchar(15);

ds_nr_seq_visao_w		varchar(255);
nr_seq_visao_w			bigint;

ds_nr_seq_objeto_w		varchar(255);
nr_seq_objeto_w			bigint;

ds_nr_seq_obj_filtro_w		varchar(255);
nr_seq_obj_filtro_w		bigint;

ds_nr_seq_cor_w			varchar(255);
nr_seq_cor_w			bigint;

ds_cd_dominio_w			varchar(255);
cd_dominio_w			integer;
vl_dominio_w			varchar(15);

ds_cd_funcao_w			varchar(255);
cd_funcao_w			integer;
ds_nr_seq_parametro_w		varchar(255);
nr_seq_parametro_w		integer;

ds_nr_seq_relatorio_w		varchar(255);
nr_seq_relatorio_w		bigint;

ds_nr_seq_campo_relat_w		varchar(255);
nr_seq_campo_relat_w		bigint;

ds_nr_seq_param_relat_w		varchar(255);
nr_seq_param_relat_w		bigint;

ds_form_w			varchar(10);
ds_campo_w			varchar(255);
ds_conteudo_campo_w		varchar(4000);
ds_classe_objeto_w		varchar(255);
ds_nome_objeto_w		varchar(255);
ds_metodo_w			varchar(255);
ds_nr_parametro_w		varchar(255);
nr_parametro_w			bigint;
ds_cont_campo_orig_w		varchar(4000);
ds_nr_ocorrencia_w		varchar(255);
nr_ocorrencia_w			bigint;
ie_origem_w			varchar(15);
ie_function_w			varchar(1);
ds_campo_pai_w			varchar(255);
ds_cont_campo_corr_w		varchar(4000);

ds_nr_seq_ind_gestao_w		varchar(255);
nr_seq_ind_gestao_w		analise_ortografica.nr_seq_ind_gestao%type;
ds_nr_seq_ind_gestao_atrib_w	varchar(255);
nr_seq_ind_gestao_atrib_w	analise_ortografica.nr_seq_ind_gestao_atrib%type;
ds_nr_seq_subind_gestao_w	varchar(255);
nr_seq_subind_gestao_w		analise_ortografica.nr_seq_subind_gestao%type;
ds_nr_seq_subind_gestao_atb_w	varchar(255);
nr_seq_subind_gestao_atrib_w	analise_ortografica.nr_seq_subind_gestao_atrib%type;

ds_cd_interface_w		varchar(255);
cd_interface_w			interface.cd_interface%type;

ds_nr_seq_referencia_w		varchar(255);
nr_seq_referencia_w		analise_ortografica.nr_seq_referencia%type;

ds_cd_tipo_lote_contabil_w	varchar(255);
cd_tipo_lote_contabil_w		bigint;

cd_expressao_w			dic_expressao.cd_expressao%type;
ds_cd_expressao_w		varchar(255);	
 

BEGIN 
 
if ((trim(both ds_conteudo_p) IS NOT NULL AND (trim(both ds_conteudo_p))::text <> '')) then 
 
	nr_pos_linha_w	:= position('>CL<' in ds_conteudo_p);
 
	if (coalesce(nr_pos_linha_w,0)	= 0) then 
 
		nr_pos_linha_w	:= length(ds_conteudo_p);
 
	else 
 
		nr_pos_linha_w	:= nr_pos_linha_w - 1;
 
	end if;
 
	ds_conteudo_arq_w	:= replace(replace(replace(replace(substr(ds_conteudo_p,1,nr_pos_linha_w),chr(10),''),chr(13),''),'>10<',chr(10)),'>13<',chr(13));
 
	select	substr(obter_valor_campo_separador(ds_conteudo_arq_w,1,';'),1,50) nm_tabela_origem, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,2,';'),1,10) ds_form, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,3,';'),1,255) ds_campo, 
		substr(replace(replace(obter_valor_campo_separador(ds_conteudo_arq_w,4,';'),'>PV<',';'),'¿','-'),1,4000) ds_conteudo_campo, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,5,';'),1,255) ds_campo_pai, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,6,';'),1,50) nm_tabela, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,7,';'),1,50) nm_atributo, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,8,';'),1,255) nr_seq_visao, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,9,';'),1,255) nr_seq_objeto, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,10,';'),1,255) nr_seq_obj_filtro, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,11,';'),1,255) nr_seq_cor, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,12,';'),1,255) cd_dominio, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,13,';'),1,15) vl_dominio, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,14,';'),1,15) nm_usuario_origem, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,16,';'),1,255) cd_funcao, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,17,';'),1,255) nr_seq_parametro, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,18,';'),1,255) nr_seq_relatorio, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,19,';'),1,255) nr_seq_campo_relat, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,20,';'),1,255) nr_seq_param_relat, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,21,';'),1,255) ds_classe_objeto, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,22,';'),1,255) ds_nome_objeto, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,23,';'),1,255) ds_metodo, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,24,';'),1,255) nr_parametro, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,25,';'),1,255) nr_ocorrencia, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,26,';'),1,255) nr_seq_ind_gestao, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,27,';'),1,255) nr_seq_ind_gestao_atrib, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,28,';'),1,255) nr_seq_subind_gestao, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,29,';'),1,255) nr_seq_subind_gestao_atrib, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,30,';'),1,255) cd_interface, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,31,';'),1,255) nr_seq_referencia, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,32,';'),1,255) cd_tipo_lote_contabil, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,33,';'),1,255) cd_expressao, 
		substr(obter_valor_campo_separador(ds_conteudo_arq_w,34,';'),1,255) dt_origem 
	into STRICT	nm_tabela_origem_w, 
		ds_form_w, 
		ds_campo_w, 
		ds_conteudo_campo_w, 
		ds_campo_pai_w, 
		nm_tabela_w, 
		nm_atributo_w, 
		ds_nr_seq_visao_w, 
		ds_nr_seq_objeto_w, 
		ds_nr_seq_obj_filtro_w, 
		ds_nr_seq_cor_w, 
		ds_cd_dominio_w, 
		vl_dominio_w, 
		nm_usuario_origem_w, 
		ds_cd_funcao_w, 
		ds_nr_seq_parametro_w, 
		ds_nr_seq_relatorio_w, 
		ds_nr_seq_campo_relat_w, 
		ds_nr_seq_param_relat_w, 
		ds_classe_objeto_w, 
		ds_nome_objeto_w, 
		ds_metodo_w, 
		ds_nr_parametro_w, 
		ds_nr_ocorrencia_w, 
		ds_nr_seq_ind_gestao_w, 
		ds_nr_seq_ind_gestao_atrib_w, 
		ds_nr_seq_subind_gestao_w, 
		ds_nr_seq_subind_gestao_atb_w, 
		ds_cd_interface_w, 
		ds_nr_seq_referencia_w, 
		ds_cd_tipo_lote_contabil_w, 
		ds_cd_expressao_w, 
		ds_dt_origem_w 
	;
 
	begin 
		nr_seq_visao_w		:= (trim(both ds_nr_seq_visao_w))::numeric;
	exception 
	when others then 
		delete	from analise_ortografica_lote 
		where	nr_sequencia	= nr_seq_lote_p;
 
		commit;
 
		/* Sequência da visão inválida (campo 8) na linha nr_linha_p!' 
		Visão (nr_seq_visao): ds_nr_seq_visao_w */
 
 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(251806,'NR_LINHA_P=' || nr_linha_p || ';DS_NR_SEQ_VISAO_W=' || ds_nr_seq_visao_w);
	end;
 
	begin 
		nr_seq_objeto_w		:= (trim(both ds_nr_seq_objeto_w))::numeric;
	exception 
	when others then 
		delete	from analise_ortografica_lote 
		where	nr_sequencia	= nr_seq_lote_p;
 
		commit;
 
		/* Sequência do objeto inválida (campo 9) na linha nr_linha_p! 
		Objeto (nr_seq_objeto): ds_nr_seq_objeto_w */
 
 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(251810,'NR_LINHA_P=' || nr_linha_p || ';DS_NR_SEQ_OBJETO_W=' || ds_nr_seq_objeto_w);
	end;
 
	begin 
		nr_seq_obj_filtro_w	:= (trim(both ds_nr_seq_obj_filtro_w))::numeric;
	exception 
	when others then 
		delete	from analise_ortografica_lote 
		where	nr_sequencia	= nr_seq_lote_p;
 
		commit;
 
		/* Sequência do objeto filtro inválida (campo 10) na linha nr_linha_p! 
		Objeto (nr_seq_obj_filtro): ds_nr_seq_obj_filtro_w */
 
 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(251811,'NR_LINHA_P=' || nr_linha_p || ';DS_NR_SEQ_OBJ_FILTRO_W=' || ds_nr_seq_obj_filtro_w);
	end;
 
	begin 
		nr_seq_cor_w		:= (trim(both ds_nr_seq_cor_w))::numeric;
	exception 
	when others then 
		delete	from analise_ortografica_lote 
		where	nr_sequencia	= nr_seq_lote_p;
 
		commit;
 
		/* Sequência da cor inválida (campo 11) na linha nr_linha_p! 
		Cor (nr_seq_cor): ds_nr_seq_cor_w */
 
 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(251812,'NR_LINHA_P=' || nr_linha_p || ';DS_NR_SEQ_COR_W=' || ds_nr_seq_cor_w);
	end;
 
	begin 
		cd_dominio_w		:= (trim(both ds_cd_dominio_w))::numeric;
	exception 
	when others then 
		delete	from analise_ortografica_lote 
		where	nr_sequencia	= nr_seq_lote_p;
 
		commit;
 
		/* Código do domínio inválido (campo 12) na linha nr_linha_p! 
		Domínio (cd_dominio): ds_cd_dominio_w */
 
 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(251813,'NR_LINHA_P=' || nr_linha_p || ';DS_CD_DOMINIO_W=' || ds_cd_dominio_w);
	end;
 
	begin 
		cd_funcao_w		:= (trim(both ds_cd_funcao_w))::numeric;
	exception 
	when others then 
		delete	from analise_ortografica_lote 
		where	nr_sequencia	= nr_seq_lote_p;
 
		commit;
 
		/* Código da função inválido (campo 16) na linha nr_linha_p! 
		Função (cd_funcao): ds_cd_funcao_w */
 
 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(251815,'NR_LINHA_P=' || nr_linha_p || ';DS_CD_FUNCAO_W=' || ds_cd_funcao_w);
	end;	
	 
	begin 
		nr_seq_parametro_w	:= (trim(both ds_nr_seq_parametro_w))::numeric;
	exception 
	when others then 
		delete	from analise_ortografica_lote 
		where	nr_sequencia	= nr_seq_lote_p;
 
		commit;
 
		/* Sequência do parâmetro inválida (campo 17) na linha nr_linha_p! 
		Parâmetro (nr_seq_parametro): ds_nr_seq_parametro_w */
 
 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(251816,'NR_LINHA_P=' || nr_linha_p || ';DS_NR_SEQ_PARAMETRO_W=' || ds_nr_seq_parametro_w);
	end;
 
	begin 
		ds_dt_origem_w		:= lpad(somente_numero(ds_dt_origem_w),14,'0');
		dt_origem_w		:= to_date(ds_dt_origem_w,'dd/mm/yyyy hh24:mi:ss');
	exception 
	when others then 
		delete	from analise_ortografica_lote 
		where	nr_sequencia	= nr_seq_lote_p;
 
		commit;
 
		/* Data de origem inválida (campo 33) na linha nr_linha_p! 
		Data (dt_origem): ds_dt_origem_w */
 
 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(251817,'NR_LINHA_P=' || nr_linha_p || ';DS_DT_ORIGEM_W=' || ds_dt_origem_w);
	end;
 
	begin 
		nr_seq_relatorio_w	:= (trim(both ds_nr_seq_relatorio_w))::numeric;
	exception 
	when others then 
		delete	from analise_ortografica_lote 
		where	nr_sequencia	= nr_seq_lote_p;
 
		commit;
 
		/* Sequência do relatório inválida (campo 18) na linha nr_linha_p! 
		Relatório (nr_seq_relatorio): ds_nr_seq_relatorio_w */
 
 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(251818,'NR_LINHA_P=' || nr_linha_p || ';DS_NR_SEQ_RELATORIO_W=' || ds_nr_seq_relatorio_w);
	end;
 
	begin 
		nr_seq_campo_relat_w	:= (trim(both ds_nr_seq_campo_relat_w))::numeric;
	exception 
	when others then 
		delete	from analise_ortografica_lote 
		where	nr_sequencia	= nr_seq_lote_p;
 
		commit;
 
		/* Sequência do campo do relatório inválida (campo 19) na linha nr_linha_p! 
		Campo do relatório (nr_seq_campo_relat): ds_nr_seq_campo_relat_w */
 
 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(251819,'NR_LINHA_P=' || nr_linha_p || ';DS_NR_SEQ_CAMPO_RELAT_W=' || ds_nr_seq_campo_relat_w);
	end;
 
	begin 
		nr_seq_param_relat_w	:= (trim(both ds_nr_seq_param_relat_w))::numeric;
	exception 
	when others then 
		delete	from analise_ortografica_lote 
		where	nr_sequencia	= nr_seq_lote_p;
 
		commit;
 
		/* Sequência do parâmetro do relatório inválida (campo 20) na linha nr_linha_p! 
		Parâmetro do relatório (nr_seq_param_relat): ds_nr_seq_param_relat_w */
 
 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(251821,'NR_LINHA_P=' || nr_linha_p || ';DS_NR_SEQ_PARAM_RELAT_W=' || ds_nr_seq_param_relat_w);
	end;
 
	begin 
		nr_parametro_w	:= (trim(both ds_nr_parametro_w))::numeric;
	exception 
	when others then 
		delete	from analise_ortografica_lote 
		where	nr_sequencia	= nr_seq_lote_p;
 
		commit;
 
		/* Parâmetro do método inválido (campo 24) na linha nr_linha_p! 
		Parâmetro do método (nr_parametro): ds_nr_parametro_w */
 
 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(251822,'NR_LINHA_P=' || nr_linha_p || ';DS_NR_PARAMETRO_W=' || ds_nr_parametro_w);
	end;
 
	begin 
		nr_ocorrencia_w	:= (trim(both ds_nr_ocorrencia_w))::numeric;
	exception 
	when others then 
		delete	from analise_ortografica_lote 
		where	nr_sequencia	= nr_seq_lote_p;
 
		commit;
 
		/* Ocorrência do método inválida (campo 25) na linha nr_linha_p! 
		Ocorrência do método (nr_ocorrencia): ds_nr_ocorrencia_w */
 
 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(251823,'NR_LINHA_P=' || nr_linha_p || ';DS_NR_OCORRENCIA_W=' || ds_nr_ocorrencia_w);
	end;
 
	begin 
		nr_seq_ind_gestao_w	:= (trim(both ds_nr_seq_ind_gestao_w))::numeric;
	exception 
	when others then 
		delete	from analise_ortografica_lote 
		where	nr_sequencia	= nr_seq_lote_p;
 
		commit;
 
		/* Sequência do indicador de gestão inválida (campo 26) na linha nr_linha_p! 
		Sequência do indicador de gestão (nr_seq_ind_gestao): ds_nr_seq_ind_gestao_w */
 
 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(252573,'NR_LINHA_P=' || nr_linha_p || ';DS_NR_SEQ_IND_GESTAO_W=' || ds_nr_seq_ind_gestao_w);
	end;
 
	begin 
		nr_seq_ind_gestao_atrib_w	:= (trim(both ds_nr_seq_ind_gestao_atrib_w))::numeric;
	exception 
	when others then 
		delete	from analise_ortografica_lote 
		where	nr_sequencia	= nr_seq_lote_p;
 
		commit;
 
		/* Sequência do atributo do indicador de gestão inválida (campo 27) na linha nr_linha_p! 
		Sequência do atributo do indicador de gestão (nr_seq_ind_gestao_atrib): ds_nr_seq_ind_gestao_atrib_w */
 
 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(252574,'NR_LINHA_P=' || nr_linha_p || ';DS_NR_SEQ_IND_GESTAO_ATRIB_W=' || ds_nr_seq_ind_gestao_atrib_w);
	end;
 
	begin 
		nr_seq_subind_gestao_w	:= (trim(both ds_nr_seq_subind_gestao_w))::numeric;
	exception 
	when others then 
		delete	from analise_ortografica_lote 
		where	nr_sequencia	= nr_seq_lote_p;
 
		commit;
 
		/* Sequência do subindicador de gestão inválida (campo 28) na linha nr_linha_p! 
		Sequência do subindicador de gestão (nr_seq_subind_gestao): ds_nr_seq_subind_gestao_w */
 
 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(252577,'NR_LINHA_P=' || nr_linha_p || ';DS_NR_SEQ_SUBIND_GESTAO_W=' || ds_nr_seq_subind_gestao_w);
	end;
 
	begin 
		nr_seq_subind_gestao_atrib_w	:= (trim(both ds_nr_seq_subind_gestao_atb_w))::numeric;
	exception 
	when others then 
		delete	from analise_ortografica_lote 
		where	nr_sequencia	= nr_seq_lote_p;
 
		commit;
 
		/* Sequência do atributo do subindicador de gestão inválida (campo 29) na linha nr_linha_p! 
		Sequência do atributo do subindicador de gestão (nr_seq_subind_gestao_atrib): ds_nr_seq_subind_gestao_atb_w */
 
 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(252578,'NR_LINHA_P=' || nr_linha_p || ';DS_NR_SEQ_SUBIND_GESTAO_ATRIB_W=' || ds_nr_seq_subind_gestao_atb_w);
	end;
 
	begin 
		cd_interface_w	:= (trim(both ds_cd_interface_w))::numeric;
	exception 
	when others then 
		delete	from analise_ortografica_lote 
		where	nr_sequencia	= nr_seq_lote_p;
 
		commit;
 
		/* Código da interface inválido (campo 30) na linha nr_linha_p! 
		Código da interface (cd_interface): ds_cd_interface_w */
 
 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(253215,'NR_LINHA_P=' || nr_linha_p || ';DS_CD_INTERFACE_W=' || ds_cd_interface_w);
	end;
 
	begin 
		nr_seq_referencia_w	:= (trim(both ds_nr_seq_referencia_w))::numeric;
	exception 
	when others then 
		delete	from analise_ortografica_lote 
		where	nr_sequencia	= nr_seq_lote_p;
 
		commit;
 
		/* Sequência da referência inválida (campo 31) na linha nr_linha_p! 
		Sequência da referência (nr_seq_referencia): ds_nr_seq_referencia_w */
 
 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(254662,'NR_LINHA_P=' || nr_linha_p || ';DS_NR_SEQ_REFERENCIA_W=' || ds_nr_seq_referencia_w);
	end;
 
	begin 
		cd_tipo_lote_contabil_w	:= (trim(both ds_cd_tipo_lote_contabil_w))::numeric;
	exception 
	when others then 
		delete	from analise_ortografica_lote 
		where	nr_sequencia	= nr_seq_lote_p;
 
		commit;
 
		/* Código do tipo do lote contábil inválido (campo 32) na linha nr_linha_p! 
		Código do tipo do lote contábil inválido (cd_tipo_lote_contabil): ds_nr_seq_referencia_w */
 
 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(254999,'NR_LINHA_P=' || nr_linha_p || ';DS_CD_TIPO_LOTE_CONTABIL_W=' || ds_cd_tipo_lote_contabil_w);
	end;
	 
	begin 
		cd_expressao_w	:= (trim(both ds_cd_expressao_w))::numeric;
	exception 
	when others then 
		delete	from analise_ortografica_lote 
		where	nr_sequencia	= nr_seq_lote_p;
		 
		commit;
		 
		/* Código de expressão inválido (campo 33) na linha nr_linha_p! 
		Expressão (cd_expressao): ds_cd_expressao_w*/
 
		 
		CALL wheb_mensagem_pck.exibir_mensagem_abort(296122,'NR_LINHA_P=' || nr_linha_p || ';DS_CD_EXPRESSAO_W=' || ds_cd_expressao_w);
	end;
 
	/* excluir para não gerar registros duplicados */
 
	delete	from analise_ortografica a 
	where	coalesce(nm_atributo,'-1')			= coalesce(nm_atributo_w,'-1') 
	and	coalesce(nm_tabela,'-1')			= coalesce(nm_tabela_w,'-1') 
	and	coalesce(nr_seq_visao,0)			= coalesce(nr_seq_visao_w,0) 
	and	coalesce(nr_seq_objeto,0)			= coalesce(nr_seq_objeto_w,0) 
	and	coalesce(nr_seq_obj_filtro,0)		= coalesce(nr_seq_obj_filtro_w,0) 
	and	coalesce(nr_seq_cor,0)			= coalesce(nr_seq_cor_w,0) 
	and	coalesce(vl_dominio,'-1')			= coalesce(vl_dominio_w,'-1') 
	and	coalesce(cd_dominio,0)			= coalesce(cd_dominio_w,0) 
	and	coalesce(cd_funcao,0)			= coalesce(cd_funcao_w,0) 
	and	coalesce(nr_seq_parametro,0)			= coalesce(nr_seq_parametro_w,0) 
	and	coalesce(nr_seq_relatorio,0)			= coalesce(nr_seq_relatorio_w,0) 
	and	coalesce(nr_seq_campo_relat,0)		= coalesce(nr_seq_campo_relat_w,0) 
	and	coalesce(nr_seq_param_relat,0)		= coalesce(nr_seq_param_relat_w,0) 
	and	coalesce(ds_nome_objeto,'-1')		= coalesce(ds_nome_objeto_w,'-1') 
	and	coalesce(ds_classe_objeto,'-1')		= coalesce(ds_classe_objeto_w,'-1') 
	and	coalesce(ds_form,'-1')			= coalesce(ds_form_w,'-1') 
	and	coalesce(ds_metodo,'-1')			= coalesce(ds_metodo_w,'-1') 
	and	coalesce(nr_parametro,0)			= coalesce(nr_parametro_w,0) 
	and	coalesce(ds_campo,'-1')			= coalesce(ds_campo_w,'-1') 
	and	coalesce(nr_ocorrencia,0)			= coalesce(nr_ocorrencia_w,0) 
	and	coalesce(nm_tabela_origem,'-1')		= coalesce(nm_tabela_origem_w,'-1') 
	and	coalesce(ds_campo_pai,'-1')			= coalesce(ds_campo_pai_w,'-1') 
	and	coalesce(nr_seq_ind_gestao,0)		= coalesce(nr_seq_ind_gestao_w,0) 
	and	coalesce(nr_seq_ind_gestao_atrib,0)		= coalesce(nr_seq_ind_gestao_atrib_w,0) 
	and	coalesce(nr_seq_subind_gestao,0)		= coalesce(nr_seq_subind_gestao_w,0) 
	and	coalesce(nr_seq_subind_gestao_atrib,0)	= coalesce(nr_seq_subind_gestao_atrib_w,0) 
	and	coalesce(cd_interface,0)			= coalesce(cd_interface_w,0) 
	and	coalesce(nr_seq_referencia,0)		= coalesce(nr_seq_referencia_w,0) 
	and	coalesce(cd_tipo_lote_contabil,0)		= coalesce(cd_tipo_lote_contabil_w,0) 
	and	coalesce(cd_expressao,0)			= coalesce(cd_expressao_w,0) 
	and	exists (SELECT	1 
		from	analise_ortografica_lote x 
		where	(x.dt_importacao IS NOT NULL AND x.dt_importacao::text <> '') 
		and	coalesce(x.dt_confirmacao::text, '') = '' 
		and	x.nr_sequencia		= a.nr_seq_lote) 
	and	not exists (select	1 
		from	analise_ortografica_lote y, 
			analise_ortografica x 
		where	(y.dt_confirmacao IS NOT NULL AND y.dt_confirmacao::text <> '') 
		and	x.nr_seq_lote		= y.nr_sequencia 
		and	x.nr_seq_origem		= a.nr_sequencia);
 
	/* obter o registro de origem (exportação) */
 
	select	max(a.nr_sequencia), 
		max(b.nr_sequencia), 
		max(b.ie_origem), 
		max(b.ie_function) 
	into STRICT	nr_seq_origem_w, 
		nr_seq_lote_origem_w, 
		ie_origem_w, 
		ie_function_w 
	from	analise_ortografica a, 
		analise_ortografica_lote b 
	where	coalesce(a.nm_atributo,'-1')			= coalesce(nm_atributo_w,'-1') 
	and	coalesce(a.nm_tabela,'-1')			= coalesce(nm_tabela_w,'-1') 
	and	coalesce(a.nr_seq_visao,0)			= coalesce(nr_seq_visao_w,0) 
	and	coalesce(a.nr_seq_objeto,0)			= coalesce(nr_seq_objeto_w,0) 
	and	coalesce(a.nr_seq_obj_filtro,0)		= coalesce(nr_seq_obj_filtro_w,0) 
	and	coalesce(a.nr_seq_cor,0)			= coalesce(nr_seq_cor_w,0) 
	and	coalesce(a.vl_dominio,'-1')			= coalesce(vl_dominio_w,'-1') 
	and	coalesce(a.cd_dominio,0)			= coalesce(cd_dominio_w,0) 
	and	coalesce(a.cd_funcao,0)			= coalesce(cd_funcao_w,0) 
	and	coalesce(a.nr_seq_parametro,0)		= coalesce(nr_seq_parametro_w,0) 
	and	coalesce(a.nr_seq_relatorio,0)		= coalesce(nr_seq_relatorio_w,0) 
	and	coalesce(a.nr_seq_campo_relat,0)		= coalesce(nr_seq_campo_relat_w,0) 
	and	coalesce(a.nr_seq_param_relat,0)		= coalesce(nr_seq_param_relat_w,0) 
	and	coalesce(a.ds_nome_objeto,'-1')		= coalesce(ds_nome_objeto_w,'-1') 
	and	coalesce(a.ds_classe_objeto,'-1')		= coalesce(ds_classe_objeto_w,'-1') 
	and	coalesce(a.ds_form,'-1')			= coalesce(ds_form_w,'-1') 
	and	coalesce(a.ds_metodo,'-1')			= coalesce(ds_metodo_w,'-1') 
	and	coalesce(a.ds_campo,'-1')			= coalesce(ds_campo_w,'-1') 
	and	coalesce(a.nr_parametro,0)			= coalesce(nr_parametro_w,0) 
	and	coalesce(a.nr_ocorrencia,0)			= coalesce(nr_ocorrencia_w,0) 
	and	coalesce(a.nm_tabela_origem,'-1')		= coalesce(nm_tabela_origem_w,'-1') 
	and	coalesce(a.ds_campo_pai,'-1')		= coalesce(ds_campo_pai_w,'-1') 
	and	coalesce(a.nr_seq_ind_gestao,0)		= coalesce(nr_seq_ind_gestao_w,0) 
	and	coalesce(a.nr_seq_ind_gestao_atrib,0)	= coalesce(nr_seq_ind_gestao_atrib_w,0) 
	and	coalesce(a.nr_seq_subind_gestao,0)		= coalesce(nr_seq_subind_gestao_w,0) 
	and	coalesce(a.nr_seq_subind_gestao_atrib,0)	= coalesce(nr_seq_subind_gestao_atrib_w,0) 
	and	coalesce(a.cd_interface,0)			= coalesce(cd_interface_w,0) 
	and	coalesce(a.nr_seq_referencia,0)		= coalesce(nr_seq_referencia_w,0) 
	and	coalesce(a.cd_tipo_lote_contabil,0)		= coalesce(cd_tipo_lote_contabil_w,0) 
	and	coalesce(a.cd_expressao,0)			= coalesce(cd_expressao_w,0) 
	and	b.nr_sequencia				= a.nr_seq_lote 
	and	(b.dt_exportacao IS NOT NULL AND b.dt_exportacao::text <> '');
 
	update	analise_ortografica_lote 
	set	nr_seq_lote_origem	= coalesce(nr_seq_lote_origem,nr_seq_lote_origem_w), 
		ds_arquivo		= coalesce(ds_arquivo,ds_arquivo_p), 
		ie_function		= coalesce(ie_function,ie_function_w), 
		ie_origem		= coalesce(ie_origem,ie_origem_w) 
	where	nr_sequencia		= nr_seq_lote_p;
 
	select	coalesce(max(a.nr_sequencia),0) + 1 
	into STRICT	nr_sequencia_w 
	from	analise_ortografica a;
 
	insert	into analise_ortografica(nr_sequencia, 
		dt_atualizacao, 
		nm_usuario, 
		nr_seq_origem, 
		nm_tabela_origem, 
		nm_tabela, 
		nm_atributo, 
		nr_seq_visao, 
		nr_seq_objeto, 
		nr_seq_obj_filtro, 
		nr_seq_cor, 
		cd_dominio, 
		vl_dominio, 
		nr_seq_lote, 
		dt_origem, 
		cd_funcao, 
		nr_seq_parametro, 
		nm_usuario_origem, 
		nr_seq_relatorio, 
		nr_seq_campo_relat, 
		nr_seq_param_relat, 
		ie_origem, 
		ds_campo, 
		ds_conteudo_campo, 
		ds_form, 
		ds_classe_objeto, 
		ds_nome_objeto, 
		ds_metodo, 
		nr_parametro, 
		nr_ocorrencia, 
		ds_campo_pai, 
		nr_seq_ind_gestao, 
		nr_seq_ind_gestao_atrib, 
		nr_seq_subind_gestao, 
		nr_seq_subind_gestao_atrib, 
		cd_interface, 
		nr_seq_referencia, 
		cd_tipo_lote_contabil, 
		cd_expressao) 
	values (nr_sequencia_w, 
		clock_timestamp(), 
		nm_usuario_p, 
		nr_seq_origem_w, 
		nm_tabela_origem_w, 
		nm_tabela_w, 
		nm_atributo_w, 
		nr_seq_visao_w, 
		nr_seq_objeto_w, 
		nr_seq_obj_filtro_w, 
		nr_seq_cor_w, 
		cd_dominio_w, 
		vl_dominio_w, 
		nr_seq_lote_p, 
		dt_origem_w, 
		cd_funcao_w, 
		nr_seq_parametro_w, 
		nm_usuario_origem_w, 
		nr_seq_relatorio_w, 
		nr_seq_campo_relat_w, 
		nr_seq_param_relat_w, 
		'U', 
		ds_campo_w, 
		ds_conteudo_campo_w, 
		ds_form_w, 
		ds_classe_objeto_w, 
		ds_nome_objeto_w, 
		ds_metodo_w, 
		nr_parametro_w, 
		nr_ocorrencia_w, 
		ds_campo_pai_w, 
		nr_seq_ind_gestao_w, 
		nr_seq_ind_gestao_atrib_w, 
		nr_seq_subind_gestao_w, 
		nr_seq_subind_gestao_atrib_w, 
		cd_interface_w, 
		nr_seq_referencia_w, 
		cd_tipo_lote_contabil_w, 
		cd_expressao_w);
 
	select	max(a.ds_conteudo_campo) 
	into STRICT	ds_cont_campo_orig_w 
	from	analise_ortografica a 
	where	a.nr_sequencia	= nr_seq_origem_w;
 
	if (ds_conteudo_campo_w = ds_cont_campo_orig_w) then 
		ie_diferenca_w	:= 'N';
	else 
		ie_diferenca_w	:= 'S';
	end if;
 
	update	analise_ortografica 
	set	ie_diferenca	= ie_diferenca_w 
	where	nr_sequencia	= nr_sequencia_w;
 
	/* corrigir os registros das outras visões da mesma tabela e, também, da própria tabela */
 
	if (coalesce(ie_gerar_relacao_p,'S')	= 'S') then 
 
		if (coalesce(ie_diferenca_w,'N')	= 'N') then 
 
			/* se houverem registros relacionados dentro do próprio lote */
 
			select	max(x.ds_conteudo_campo) 
			into STRICT	ds_cont_campo_corr_w 
			from	analise_ortografica y, 
				analise_ortografica x 
			where	exists (SELECT	1 
				from	analise_ortografica a 
				where	a.ds_conteudo_campo			= y.ds_conteudo_campo 
				and	a.ds_conteudo_campo			<> x.ds_conteudo_campo 
				and	coalesce(a.nm_atributo,'-1')			= coalesce(x.nm_atributo,'-1') 
				and	coalesce(a.nm_tabela,'-1')			= coalesce(x.nm_tabela,'-1') 
				and	coalesce(a.nr_seq_objeto,0)			= coalesce(x.nr_seq_objeto,0) 
				and	coalesce(a.nr_seq_obj_filtro,0)		= coalesce(x.nr_seq_obj_filtro,0) 
				and	coalesce(a.nr_seq_cor,0)			= coalesce(x.nr_seq_cor,0) 
				and	coalesce(a.vl_dominio,'-1')			= coalesce(x.vl_dominio,'-1') 
				and	coalesce(a.cd_dominio,0)			= coalesce(x.cd_dominio,0) 
				and	coalesce(a.cd_funcao,0)			= coalesce(x.cd_funcao,0) 
				and	coalesce(a.nr_seq_parametro,0)		= coalesce(x.nr_seq_parametro,0) 
				and	coalesce(a.nr_seq_relatorio,0)		= coalesce(x.nr_seq_relatorio,0) 
				and	coalesce(a.nr_seq_campo_relat,0)		= coalesce(x.nr_seq_campo_relat,0) 
				and	coalesce(a.nr_seq_param_relat,0)		= coalesce(x.nr_seq_param_relat,0) 
				and	coalesce(a.ds_nome_objeto,'-1')		= coalesce(x.ds_nome_objeto,'-1') 
				and	coalesce(a.ds_classe_objeto,'-1')		= coalesce(x.ds_classe_objeto,'-1') 
				and	coalesce(a.ds_form,'-1')			= coalesce(x.ds_form,'-1') 
				and	coalesce(a.ds_metodo,'-1')			= coalesce(x.ds_metodo,'-1') 
				and	coalesce(a.ds_campo,'-1')			= coalesce(x.ds_campo,'-1') 
				and	coalesce(a.nr_parametro,0)			= coalesce(x.nr_parametro,0) 
				and	coalesce(a.nr_ocorrencia,0)			= coalesce(x.nr_ocorrencia,0) 
				and	coalesce(a.ds_campo_pai,'-1')		= coalesce(x.ds_campo_pai,'-1') 
				and	coalesce(a.nr_seq_ind_gestao,0)		= coalesce(x.nr_seq_ind_gestao,0) 
				and	coalesce(a.nr_seq_ind_gestao_atrib,0)	= coalesce(x.nr_seq_ind_gestao_atrib,0) 
				and	coalesce(a.nr_seq_subind_gestao,0)		= coalesce(x.nr_seq_subind_gestao,0) 
				and	coalesce(a.nr_seq_subind_gestao_atrib,0)	= coalesce(x.nr_seq_subind_gestao_atrib,0) 
				and	coalesce(a.cd_interface,0)			= coalesce(x.cd_interface,0) 
				and	coalesce(a.nr_seq_referencia,0)		= coalesce(x.nr_seq_referencia,0) 
				and	coalesce(a.cd_tipo_lote_contabil,0)		= coalesce(x.cd_tipo_lote_contabil,0) 
				and	coalesce(a.cd_expressao,0)			= coalesce(x.cd_expressao,0) 
				and	a.nr_sequencia				= nr_sequencia_w) 
			and	x.nr_seq_origem			= y.nr_sequencia 
			and	coalesce(x.ie_diferenca,'S')		= 'S' 
			and	x.nr_sequencia			<> nr_sequencia_w 
			and	x.nr_seq_lote			= nr_seq_lote_p;
 
			if (ds_cont_campo_corr_w IS NOT NULL AND ds_cont_campo_corr_w::text <> '') then 
 
				update	analise_ortografica a 
				set	a.ie_origem		= 'R', 
					a.ie_diferenca		= 'S', 
					a.ds_conteudo_campo	= ds_cont_campo_corr_w 
				where	a.nr_sequencia		= nr_sequencia_w;
 
			end if;
 
		elsif (coalesce(ie_diferenca_w,'N')	= 'S') and 
			((nm_tabela_origem_w = 'TABELA_VISAO_ATRIBUTO') or (nm_tabela_origem_w = 'TABELA_ATRIBUTO')) and (nr_seq_origem_w IS NOT NULL AND nr_seq_origem_w::text <> '') then 
 
			CALL gerar_relacao_ortografica(nr_sequencia_w,nm_usuario_p);
 
		end if;
 
	end if;
 
	if (coalesce(ie_commit_p,'N')	= 'S') then 
 
		commit;
 
	end if;
 
end if;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE importar_analise_ortografica ( nr_seq_lote_p bigint, ds_arquivo_p text, ds_conteudo_p text, nr_linha_p bigint, ie_gerar_relacao_p text, nm_usuario_p text, ie_commit_p text) FROM PUBLIC;

