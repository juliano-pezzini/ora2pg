-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE hd_evolucao_rel_temp ( DT_REFERENCIA_P text, IE_PACIENTE_AGUDO_P text, IE_TIPO_P text, IE_TRATAMENTO_P text, NR_SEQ_TURNO_P bigint, NR_SEQ_UNIDADE_P bigint) AS $body$
DECLARE

 
nm_pessoa_fisica_w	varchar(255);
dt_inicio_trat_w	timestamp;
ie_prim_m_w		varchar(10);
ie_laudo_m_w		varchar(10);
ie_mensal_m_w		varchar(10);
ie_prim_e_w		varchar(10);
ie_mensal_e_w		varchar(10);
ie_prim_n_w		varchar(10);
ie_mensal_n_w		varchar(10);
ie_prim_p_w		varchar(10);
ie_mensal_p_w		varchar(10);
ie_prim_ass_w		varchar(10);
ie_mensal_ass_w		varchar(10);
ds_unidade_w		varchar(80);
ie_tipo_w		varchar(1);	
qt_pacientes_ww		varchar(10);
qt_pacientes_w		bigint;
nr_seq_unidade_sup_w	bigint;
cd_pessoa_fisica_sup_w	varchar(10);	
nr_sequencia_sup_w	bigint;

ie_tratamento_w		varchar(10);
nr_seq_turno_w		bigint;

	 
				 
C01 CURSOR FOR 
	SELECT 	count(distinct(b.cd_pessoa_fisica)) qt_pacientes, 
		a.nr_sequencia nr_seq_unidade_sup, 
		a.ds_unidade ds_unidade 
	from  	hd_unidade_dialise a, 
		hd_pac_renal_cronico b, 
		hd_escala_dialise d, 
		hd_escala_dialise_dia r 
	where	b.nr_seq_unid_dialise = a.nr_sequencia 
	and	d.cd_pessoa_fisica = b.cd_pessoa_fisica 
	and   r.nr_seq_escala = d.nr_sequencia 
	and	substr(hd_obter_se_paciente_ativo(b.cd_pessoa_fisica),1,1) = 'S' 
	and 	ie_tipo_p = 'S' 
	and	((r.nr_seq_turno = nr_seq_turno_w) or ( nr_seq_turno_w = '0')) 
	and	a.nr_sequencia <> 9 
	and (exists (SELECT	1 
			from	paciente_tratamento x 
			where	x.cd_pessoa_fisica = b.cd_pessoa_fisica 
			and	ie_tratamento = ie_tratamento_w 
			and	coalesce(x.dt_final_tratamento::text, '') = '') or ( ie_tratamento_w = '0')) 
	and	((coalesce(b.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or ( ie_paciente_agudo_p = 'T')) 
	group by  a.nr_sequencia, 
		  a.ds_unidade	 	  
	order by 1;

C02 CURSOR FOR 
	SELECT 	distinct(b.cd_pessoa_fisica) cd_pessoa_fisica_sup, 
		substr(obter_nome_pf(b.cd_pessoa_fisica),1,80) nm_pessoa_fisica, 
		a.nr_sequencia nr_sequencia_sup, 
		a.ds_unidade ds_unidade, 
		(SELECT	max(dt_inicio_tratamento) 
		from	paciente_tratamento z 
		where	z.cd_pessoa_fisica = b.cd_pessoa_fisica 
		and	z.ie_tratamento = ie_tratamento_w) dt_inicio_tratamento 
	from  	hd_unidade_dialise a, 
		hd_pac_renal_cronico b, 
		hd_escala_dialise d, 
		hd_escala_dialise_dia r 
	where	b.nr_seq_unid_dialise = a.nr_sequencia 
	and	d.cd_pessoa_fisica = b.cd_pessoa_fisica 
	and   r.nr_seq_escala = d.nr_sequencia 
	and	substr(hd_obter_se_paciente_ativo(b.cd_pessoa_fisica),1,1) = 'S'	 
	and	hd_obter_unidade_prc(b.cd_pessoa_fisica,'C') = nr_seq_unidade_p 
	and	((r.nr_seq_turno = nr_seq_turno_w) or ( nr_seq_turno_w = '0')) 
	and (exists (select	1 
			from	paciente_tratamento x 
			where	x.cd_pessoa_fisica = b.cd_pessoa_fisica 
			and	coalesce(x.dt_final_tratamento::text, '') = '' 
			and	ie_tratamento = ie_tratamento_w ) or ( ie_tratamento_w = '0')) 
	and	((coalesce(b.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T')) 
	order by 2;

BEGIN
ie_tratamento_w := coalesce(ie_tratamento_p,'0');
nr_seq_turno_w := coalesce(nr_seq_turno_p,'0');
 
delete	from	W_HD_EVOLUCAO;
 
 
if (ie_tipo_p = 'S') then 
	open C01;
	loop 
	fetch C01 into	 
		qt_pacientes_w, 
		nr_seq_unidade_sup_w, 
		ds_unidade_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */
		begin 
		select 	count(distinct(b.cd_pessoa_fisica)) 
		into STRICT	qt_pacientes_ww 
		from  	hd_unidade_dialise a, 
			hd_pac_renal_cronico b 
		where	b.nr_seq_unid_dialise = a.nr_sequencia 
		and	substr(hd_obter_se_paciente_ativo(b.cd_pessoa_fisica),1,1) = 'S'		 
		and	hd_obter_unidade_prc(b.cd_pessoa_fisica,'C') = nr_seq_unidade_sup_w 
		and (hd_obter_se_tratamento_pac(b.cd_pessoa_fisica,'HD','S') = 'S') 
		and (exists (SELECT	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = b.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	ie_tratamento = ie_tratamento_w ) or ( ie_tratamento_w = '0')) 
		and	((coalesce(b.ie_paciente_agudo,'N') = ie_paciente_agudo_p ) or ( ie_paciente_agudo_p = 'T'));
		 
		select 	count(distinct(f.cd_pessoa_fisica)) 
		into STRICT	ie_prim_m_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise i 
		where	e.nr_seq_unid_dialise = d.nr_sequencia 
		and	f.ie_evolucao_clinica = 'AF' 
		and	e.cd_pessoa_fisica = f.cd_pessoa_fisica 
		and	e.cd_pessoa_fisica = i.cd_pessoa_fisica 
		and	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_sup_w 
		and	f.dt_evolucao = (SELECT min(g.dt_evolucao) 
					from	evolucao_paciente g, 
						hd_pac_renal_cronico h, 
						hd_unidade_dialise c, 
						hd_escala_dialise j, 
						hd_escala_dialise_dia r 
					where 	g.ie_evolucao_clinica = 'AF' 
					and	g.cd_pessoa_fisica = f.cd_pessoa_fisica 
					and	g.cd_pessoa_fisica = h.cd_Pessoa_fisica 
					and	j.cd_pessoa_fisica = h.cd_pessoa_fisica 
					and   r.nr_seq_escala = j.nr_sequencia 
					and	g.nr_atendimento = f.nr_atendimento 
					and	c.nr_sequencia = h.nr_seq_unid_dialise 
					and	h.nr_seq_unid_dialise = e.nr_seq_unid_dialise 
					and	((r.nr_seq_turno = nr_seq_turno_w) or ( nr_seq_turno_w = '0'))) 
		and (exists (select	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w ) or ( ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'))			 
		and 	substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S';
		 
		select 	count(distinct(f.cd_pessoa_fisica)) 
		into STRICT	ie_laudo_m_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise g, 
			hd_escala_dialise_dia r 
		where	f.ie_evolucao_clinica = 'A' 
		and	f.ie_tipo_evolucao = '1' 
		and	e.nr_seq_unid_dialise = d.nr_sequencia 
		and	g.cd_pessoa_fisica = e.cd_pessoa_fisica 
		and	e.cd_pessoa_fisica = f.cd_pessoa_fisica 
		and   r.nr_seq_escala = g.nr_sequencia 
		and	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_sup_w 
		and	((r.nr_seq_turno = nr_seq_turno_w) or ( nr_seq_turno_w = '0')) 
		and	substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S' 
		and (exists (SELECT	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w ) or ( ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'));
		 
		select	count(distinct(f.cd_pessoa_fisica)) 
		into STRICT	ie_mensal_m_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise g, 
			hd_escala_dialise_dia r 
		where	f.ie_evolucao_clinica	= 'He' 
		and	f.ie_tipo_evolucao	= '1'	  
		and	e.nr_seq_unid_dialise	= d.nr_sequencia 
		and	e.cd_pessoa_fisica	= f.cd_pessoa_fisica 
		and   r.nr_seq_escala = g.nr_sequencia 
		and	((r.nr_seq_turno = nr_seq_turno_w) or ( nr_seq_turno_w = '0')) 
		and	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_sup_w 
		and	g.cd_pessoa_fisica = e.cd_pessoa_fisica 
		and	substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S' 
		and	to_char(f.dt_evolucao,'mm/yyyy') = dt_referencia_p 
		and (exists (SELECT	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w ) or (ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'));
		 
		select count(distinct(f.cd_pessoa_fisica)) 
		into STRICT	ie_prim_e_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise i 
		where	e.nr_seq_unid_dialise = d.nr_sequencia 
		and	f.ie_evolucao_clinica = 'PR' 
		and	f.ie_tipo_evolucao = '3' 
		and	e.cd_pessoa_fisica = f.cd_pessoa_fisica 
		and	e.cd_pessoa_fisica = i.cd_pessoa_fisica 
		and	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_sup_w 
		and	f.dt_evolucao = (SELECT min(g.dt_evolucao) 
					 from	evolucao_paciente g, 
						hd_pac_renal_cronico h, 
						hd_unidade_dialise c, 
						hd_escala_dialise j, 
						hd_escala_dialise_dia r 
					where  g.ie_evolucao_clinica = 'PR' 
					and	g.ie_tipo_evolucao = '3' 
					and	g.cd_pessoa_fisica = f.cd_pessoa_fisica 
					and	g.cd_pessoa_fisica = h.cd_Pessoa_fisica 
					and	h.cd_pessoa_fisica = j.cd_pessoa_fisica 
					and   r.nr_seq_escala = j.nr_sequencia 
					and	g.nr_atendimento = f.nr_atendimento 
					and	c.nr_sequencia = h.nr_seq_unid_dialise 
					and	((r.nr_seq_turno = nr_seq_turno_w) or (nr_seq_turno_w = '0')) 
					and	h.nr_seq_unid_dialise = e.nr_seq_unid_dialise ) 
		and	substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S' 
		and (exists (select	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w) or ( ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'));
		 
		select	count(distinct(f.cd_pessoa_fisica)) 
		into STRICT	ie_mensal_e_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise g, 
			hd_escala_dialise_dia r 
		where	f.ie_evolucao_clinica	= 'E' 
		and	f.ie_tipo_evolucao	= '3'	  
		and	e.nr_seq_unid_dialise	= d.nr_sequencia 
		and	e.cd_pessoa_fisica	= f.cd_pessoa_fisica 
		and   r.nr_seq_escala = g.nr_sequencia 
		and	((r.nr_seq_turno = nr_seq_turno_w) or (nr_seq_turno_w = '0')) 
		and 	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_sup_w 
		and	g.cd_pessoa_fisica = e.cd_pessoa_fisica 
		and	substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S' 
		and	to_char(f.dt_evolucao,'mm/yyyy') = dt_referencia_p 
		and (exists (SELECT	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w ) or ( ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'));
		 
		select count(distinct(f.cd_pessoa_fisica)) 
		into STRICT	ie_prim_n_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise i, 
			hd_escala_dialise_dia r 
		where	e.nr_seq_unid_dialise = d.nr_sequencia 
		and	f.ie_evolucao_clinica = 'PR' 
		and	f.ie_tipo_evolucao = '4' 
		and	e.cd_pessoa_fisica = f.cd_pessoa_fisica 
		and	i.cd_pessoa_fisica = e.cd_pessoa_fisica 
		and   r.nr_seq_escala = i.nr_sequencia 
		and	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_sup_w 
		and	f.dt_evolucao = (SELECT min(g.dt_evolucao) 
					 from	evolucao_paciente g, 
						hd_pac_renal_cronico h, 
						hd_unidade_dialise c, 
						hd_escala_dialise j 
					where  g.ie_evolucao_clinica = 'PR' 
					and	g.ie_tipo_evolucao = '4' 
					and	g.cd_pessoa_fisica = f.cd_pessoa_fisica 
					and	g.cd_pessoa_fisica = h.cd_Pessoa_fisica 
					and	g.nr_atendimento = f.nr_atendimento 
					and	j.cd_pessoa_fisica = h.cd_pessoa_fisica 
					and	c.nr_sequencia = h.nr_seq_unid_dialise 
					and	h.nr_seq_unid_dialise = e.nr_seq_unid_dialise )		 
		and	((r.nr_seq_turno = nr_seq_turno_w) or ( nr_seq_turno_w = '0')) 
		and	substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S' 
		and (exists (select	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w ) or ( ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'));
 
		select	count(distinct(f.cd_pessoa_fisica)) 
		into STRICT	ie_mensal_n_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise g, 
			hd_escala_dialise_dia r 
		where	f.ie_evolucao_clinica	= 'N' 
		and	f.ie_tipo_evolucao	= '4'	  
		and	e.nr_seq_unid_dialise	= d.nr_sequencia 
		and	e.cd_pessoa_fisica	= f.cd_pessoa_fisica 
		and   r.nr_seq_escala = g.nr_sequencia 
		and	((r.nr_seq_turno = nr_seq_turno_w) or ( nr_seq_turno_w = '0')) 
		and	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_sup_w 
		and	g.cd_pessoa_fisica = e.cd_pessoa_fisica 
		and	substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S' 
		and	to_char(f.dt_evolucao,'mm/yyyy') = dt_referencia_p 
		and (exists (SELECT	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w ) or (ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'));	
		 
		select count(distinct(f.cd_pessoa_fisica)) 
		into STRICT	ie_prim_p_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise i, 
			hd_escala_dialise_dia r 
		where	e.nr_seq_unid_dialise = d.nr_sequencia 
		and	f.ie_evolucao_clinica = 'PR' 
		and	f.ie_tipo_evolucao = '5' 
		and	e.cd_pessoa_fisica = f.cd_pessoa_fisica 
		and	i.cd_pessoa_fisica = e.cd_pessoa_fisica 
		and   r.nr_seq_escala = i.nr_sequencia 
		and	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_sup_w 
		and	f.dt_evolucao = (SELECT min(g.dt_evolucao) 
					from	evolucao_paciente g, 
						hd_pac_renal_cronico h, 
						hd_unidade_dialise c, 
						hd_escala_dialise j 
					where 	g.ie_evolucao_clinica = 'PR' 
					and	g.ie_tipo_evolucao = '5' 
					and	g.cd_pessoa_fisica = f.cd_pessoa_fisica 
					and	g.cd_pessoa_fisica = h.cd_Pessoa_fisica 
					and	j.cd_pessoa_fisica = h.cd_pessoa_fisica 
					and	g.nr_atendimento = f.nr_atendimento 
					and	c.nr_sequencia = h.nr_seq_unid_dialise 
					and	h.nr_seq_unid_dialise = e.nr_seq_unid_dialise 
					and	substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S' ) 
		and	((r.nr_seq_turno = nr_seq_turno_w) or (nr_seq_turno_w = '0')) 
		and (exists (select	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w) or (ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'));
		 
		select	count(distinct(f.cd_pessoa_fisica)) 
		into STRICT	ie_mensal_p_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise g, 
			hd_escala_dialise_dia r 
		where	f.ie_evolucao_clinica	= 'Ps' 
		and	f.ie_tipo_evolucao	= '5'	  
		and	e.nr_seq_unid_dialise	= d.nr_sequencia 
		and	e.cd_pessoa_fisica	= f.cd_pessoa_fisica 
		and   r.nr_seq_escala = g.nr_sequencia 
		and	((r.nr_seq_turno = nr_seq_turno_w) or (nr_seq_turno_w = '0')) 
		and 	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_sup_w 
		and	g.cd_pessoa_fisica = e.cd_pessoa_fisica 
		and	substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S' 
		and	to_char(f.dt_evolucao,'mm/yyyy') = dt_referencia_p 
		and (exists (SELECT	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w ) or ( ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'));
		 
		select count(distinct(f.cd_pessoa_fisica)) 
		into STRICT	ie_prim_ass_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise i, 
			hd_escala_dialise_dia r 
		where	e.nr_seq_unid_dialise = d.nr_sequencia 
		and	f.ie_evolucao_clinica = 'PR' 
		and	f.ie_tipo_evolucao = '11' 
		and	e.cd_pessoa_fisica = f.cd_pessoa_fisica 
		and	i.cd_pessoa_fisica = e.cd_pessoa_fisica 
		and   r.nr_seq_escala = i.nr_sequencia 
		and	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_sup_w 
		and	f.dt_evolucao = (SELECT min(g.dt_evolucao) 
					from	evolucao_paciente g, 
						hd_pac_renal_cronico h, 
						hd_unidade_dialise c, 
						hd_escala_dialise j 
					where  g.ie_evolucao_clinica = 'PR' 
					and	g.ie_tipo_evolucao = '11' 
					and	g.cd_pessoa_fisica = f.cd_pessoa_fisica 
					and	g.cd_pessoa_fisica = h.cd_Pessoa_fisica 
					and	g.nr_atendimento = f.nr_atendimento 
					and	j.cd_pessoa_fisica = h.cd_pessoa_fisica 
					and	c.nr_sequencia = h.nr_seq_unid_dialise 
					and	h.nr_seq_unid_dialise = e.nr_seq_unid_dialise 
					and	substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S' ) 
		and	((r.nr_seq_turno = nr_seq_turno_w) or ( nr_seq_turno_w = '0')) 
		and (exists (select	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w ) or (ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'));
		 
		select	count(distinct(f.cd_pessoa_fisica)) 
		into STRICT	ie_mensal_ass_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise g, 
			hd_escala_dialise_dia r 
		where	f.ie_evolucao_clinica	= 'As' 
		and	f.ie_tipo_evolucao	= '11'	  
		and	e.nr_seq_unid_dialise	= d.nr_sequencia 
		and	e.cd_pessoa_fisica	= f.cd_pessoa_fisica 
		and   r.nr_seq_escala = g.nr_sequencia 
		and	((r.nr_seq_turno = nr_seq_turno_w) or (nr_seq_turno_w = '0')) 
		and 	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_sup_w 
		and	g.cd_pessoa_fisica = e.cd_pessoa_fisica 
		and	substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S' 
		and	to_char(f.dt_evolucao,'mm/yyyy') = dt_referencia_p 
		and (exists (SELECT	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w ) or ( ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'));
		 
		insert into W_HD_EVOLUCAO(	 
			ds_unidade, 
			ie_tipo, 
			qt_pacientes, 
			ie_prim_m, 
			ie_laudo_m, 
			ie_mensal_m, 
			ie_prim_e, 
			ie_mensal_e, 
			ie_prim_n, 
			ie_mensal_n, 
			ie_prim_p, 
			ie_mensal_p, 
			ie_prim_ass, 
			ie_mensal_ass) 
		values (	ds_unidade_w, 
			ie_tipo_p, 
			qt_pacientes_ww, 
			ie_prim_m_w, 
			ie_laudo_m_w, 
			ie_mensal_m_w, 
			ie_prim_e_w, 
			ie_mensal_e_w, 
			ie_prim_n_w, 
			ie_mensal_n_w, 
			ie_prim_p_w, 
			ie_mensal_p_w, 
			ie_prim_ass_w, 
			ie_mensal_ass_w);
		end;
	end loop;
	close C01;
	 
elsif (ie_tipo_p = 'A') then 
	open C02;
	loop 
	fetch C02 into	 
		cd_pessoa_fisica_sup_w, 
		nm_pessoa_fisica_w, 
		nr_sequencia_sup_w, 
		ds_unidade_w, 
		dt_inicio_trat_w;
	EXIT WHEN NOT FOUND; /* apply on C02 */
		begin 
		 
		select 	CASE WHEN count(distinct(f.cd_pessoa_fisica))=0 THEN ''  ELSE 'X' END  
		into STRICT	ie_prim_m_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise i				 
		where	e.nr_seq_unid_dialise = d.nr_sequencia 
		and	f.ie_evolucao_clinica = 'AF' 
		and	e.cd_pessoa_fisica = f.cd_pessoa_fisica 
		and	e.cd_pessoa_fisica = i.cd_pessoa_fisica 
		and	e.cd_pessoa_fisica = cd_pessoa_fisica_sup_w 
		and	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_p 
		and	f.dt_evolucao = (SELECT min(g.dt_evolucao) 
					from	evolucao_paciente g, 
						hd_pac_renal_cronico h, 
						hd_unidade_dialise c, 
						hd_escala_dialise j, 
						hd_escala_dialise_dia r 
					where  g.ie_evolucao_clinica = 'AF' 
					and	g.cd_pessoa_fisica = f.cd_pessoa_fisica 
					and	g.cd_pessoa_fisica = h.cd_Pessoa_fisica 
					and	j.cd_pessoa_fisica = h.cd_pessoa_fisica 
					and   r.nr_seq_escala = j.nr_sequencia 
					and	g.nr_atendimento = f.nr_atendimento 
					and	c.nr_sequencia = h.nr_seq_unid_dialise 
					and	h.nr_seq_unid_dialise = e.nr_seq_unid_dialise 
					and	((r.nr_seq_turno = nr_seq_turno_w) or ( nr_seq_turno_w = '0'))) 
		and substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S' 
		and (exists (select	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w ) or ( ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'));
		 
		 
		select 	CASE WHEN count(distinct(f.cd_pessoa_fisica))=0 THEN ''  ELSE 'X' END  
		into STRICT	ie_laudo_m_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise g, 
			hd_escala_dialise_dia r 
		where	f.ie_evolucao_clinica = 'A' 
		and	f.ie_tipo_evolucao = '1' 
		and	e.nr_seq_unid_dialise = d.nr_sequencia 
		and	g.cd_pessoa_fisica = e.cd_pessoa_fisica 
		and	e.cd_pessoa_fisica = f.cd_pessoa_fisica 
		and   r.nr_seq_escala = g.nr_sequencia 
		and	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_p 
		and	e.cd_pessoa_fisica = cd_pessoa_fisica_sup_w 
		and	((r.nr_seq_turno = nr_seq_turno_w) or ( nr_seq_turno_w = '0')) 
		and	substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S' 
		and (exists (SELECT	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w ) or ( ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'));
		 
		select	CASE WHEN count(distinct(f.cd_pessoa_fisica))=0 THEN ''  ELSE 'X' END  
		into STRICT	ie_mensal_m_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise g, 
			hd_escala_dialise_dia r 
		where	f.ie_evolucao_clinica	= 'He' 
		and	f.ie_tipo_evolucao	= '1'	  
		and	e.nr_seq_unid_dialise	= d.nr_sequencia 
		and	f.cd_pessoa_fisica = cd_pessoa_fisica_sup_w 
		and	e.cd_pessoa_fisica	= f.cd_pessoa_fisica 
		and   r.nr_seq_escala = g.nr_sequencia 
		and	((r.nr_seq_turno = nr_seq_turno_w) or ( nr_seq_turno_w = '0')) 
		and	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_p 
		and	g.cd_pessoa_fisica = e.cd_pessoa_fisica 
		and	substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S' 
		and	to_char(f.dt_evolucao,'mm/yyyy') = dt_referencia_p 
		and (exists (SELECT	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w ) or ( ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'));
		 
		select CASE WHEN count(distinct(f.cd_pessoa_fisica))=0 THEN ''  ELSE 'X' END  
		into STRICT	ie_prim_e_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise i 
		where	e.nr_seq_unid_dialise = d.nr_sequencia 
		and	f.ie_evolucao_clinica = 'PR' 
		and	f.ie_tipo_evolucao = '3' 
		and	e.cd_pessoa_fisica = f.cd_pessoa_fisica 
		and	e.cd_pessoa_fisica = i.cd_pessoa_fisica 
		and	e.cd_pessoa_fisica = cd_pessoa_fisica_sup_w 
		and	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_p 
		and	f.dt_evolucao = (SELECT min(g.dt_evolucao) 
					from	evolucao_paciente g, 
						hd_pac_renal_cronico h, 
						hd_unidade_dialise c, 
						hd_escala_dialise j, 
						hd_escala_dialise_dia r 
					where g.ie_evolucao_clinica = 'PR' 
					and	g.ie_tipo_evolucao = '3' 
					and	g.cd_pessoa_fisica = f.cd_pessoa_fisica 
					and	g.cd_pessoa_fisica = h.cd_Pessoa_fisica 
					and	h.cd_pessoa_fisica = j.cd_pessoa_fisica 
					and   r.nr_seq_escala = j.nr_sequencia 
					and	g.nr_atendimento = f.nr_atendimento 
					and	c.nr_sequencia = h.nr_seq_unid_dialise 
					and	((r.nr_seq_turno = nr_seq_turno_w) or ( nr_seq_turno_w = '0')) 
					and	h.nr_seq_unid_dialise = e.nr_seq_unid_dialise ) 
		and	substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S' 
		and (exists (select	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w ) or ( ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'));
		 
		select	CASE WHEN count(distinct(f.cd_pessoa_fisica))=0 THEN ''  ELSE 'X' END  
		into STRICT	ie_mensal_e_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise g, 
			hd_escala_dialise_dia r 
		where	f.ie_evolucao_clinica	= 'E' 
		and	f.ie_tipo_evolucao	= '3'	  
		and	e.nr_seq_unid_dialise	= d.nr_sequencia 
		and	e.cd_pessoa_fisica	= f.cd_pessoa_fisica 
		and   r.nr_seq_escala = g.nr_sequencia 
		and	((r.nr_seq_turno = nr_seq_turno_w) or ( nr_seq_turno_w = '0')) 
		and	e.cd_pessoa_fisica = cd_pessoa_fisica_sup_w 
		and	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_p 
		and	g.cd_pessoa_fisica = e.cd_pessoa_fisica 
		and	substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S' 
		and	to_char(f.dt_evolucao,'mm/yyyy') = dt_referencia_p 
		and (exists (SELECT	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w ) or ( ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'));
		 
		select CASE WHEN count(distinct(f.cd_pessoa_fisica))=0 THEN ''  ELSE 'X' END  
		into STRICT	ie_prim_n_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise i, 
			hd_escala_dialise_dia r 
		where	e.nr_seq_unid_dialise = d.nr_sequencia 
		and	f.ie_evolucao_clinica = 'PR' 
		and	f.ie_tipo_evolucao = '4' 
		and	e.cd_pessoa_fisica = f.cd_pessoa_fisica 
		and	i.cd_pessoa_fisica = e.cd_pessoa_fisica 
		and   r.nr_seq_escala = i.nr_sequencia 
		and	e.cd_pessoa_fisica = cd_pessoa_fisica_sup_w 
		and	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_p 
		and	f.dt_evolucao = (SELECT min(g.dt_evolucao) 
					from	evolucao_paciente g, 
						hd_pac_renal_cronico h, 
						hd_unidade_dialise c, 
						hd_escala_dialise j 
					where  g.ie_evolucao_clinica = 'PR' 
					and	g.ie_tipo_evolucao = '4' 
					and	g.cd_pessoa_fisica = f.cd_pessoa_fisica 
					and	g.cd_pessoa_fisica = h.cd_Pessoa_fisica 
					and	g.nr_atendimento = f.nr_atendimento 
					and	j.cd_pessoa_fisica = h.cd_pessoa_fisica 
					and	c.nr_sequencia = h.nr_seq_unid_dialise 
					and	h.nr_seq_unid_dialise = e.nr_seq_unid_dialise ) 
		and	((r.nr_seq_turno = nr_seq_turno_w) or ( nr_seq_turno_w = '0')) 
		and	substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S' 
		and (exists (select	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w ) or ( ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'));
		 
		select	CASE WHEN count(distinct(f.cd_pessoa_fisica))=0 THEN ''  ELSE 'X' END  
		into STRICT	ie_mensal_n_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise g, 
			hd_escala_dialise_dia r 
		where	f.ie_evolucao_clinica	= 'N' 
		and	f.ie_tipo_evolucao	= '4'	  
		and	e.nr_seq_unid_dialise	= d.nr_sequencia 
		and	e.cd_pessoa_fisica	= f.cd_pessoa_fisica 
		and   r.nr_seq_escala = g.nr_sequencia 
		and	((r.nr_seq_turno = nr_seq_turno_w) or ( nr_seq_turno_w = '0')) 
		and	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_p 
		and	f.cd_pessoa_fisica = cd_pessoa_fisica_sup_w 
		and	g.cd_pessoa_fisica = e.cd_pessoa_fisica 
		and	substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S' 
		and	to_char(f.dt_evolucao,'mm/yyyy') = dt_referencia_p 
		and (exists (SELECT	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w ) or ( ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'));
		 
		 
		select CASE WHEN count(distinct(f.cd_pessoa_fisica))=0 THEN ''  ELSE 'X' END  
		into STRICT	ie_prim_p_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise i, 
			hd_escala_dialise_dia r 
		where	e.nr_seq_unid_dialise = d.nr_sequencia 
		and	f.ie_evolucao_clinica = 'PR' 
		and	f.ie_tipo_evolucao = '5' 
		and	e.cd_pessoa_fisica = f.cd_pessoa_fisica 
		and	i.cd_pessoa_fisica = e.cd_pessoa_fisica 
		and   r.nr_seq_escala = i.nr_sequencia 
		and	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_p 
		and	e.cd_pessoa_fisica = cd_pessoa_fisica_sup_w 
		and	f.dt_evolucao = (SELECT min(g.dt_evolucao) 
					from	evolucao_paciente g, 
						hd_pac_renal_cronico h, 
						hd_unidade_dialise c, 
						hd_escala_dialise j 
					where g.ie_evolucao_clinica = 'PR' 
					and	g.ie_tipo_evolucao = '5' 
					and	g.cd_pessoa_fisica = f.cd_pessoa_fisica 
					and	g.cd_pessoa_fisica = h.cd_Pessoa_fisica 
					and	j.cd_pessoa_fisica = h.cd_pessoa_fisica 
					and	g.nr_atendimento = f.nr_atendimento 
					and	c.nr_sequencia = h.nr_seq_unid_dialise 
					and	h.nr_seq_unid_dialise = e.nr_seq_unid_dialise 
					and	substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S' ) 
		and	((r.nr_seq_turno = nr_seq_turno_w) or ( nr_seq_turno_w = '0')) 
		and (exists (select	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w ) or ( ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'));
		 
		 
		select	CASE WHEN count(distinct(f.cd_pessoa_fisica))=0 THEN ''  ELSE 'X' END  
		into STRICT	ie_mensal_p_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise g, 
			hd_escala_dialise_dia r 
		where	f.ie_evolucao_clinica	= 'Ps' 
		and	f.ie_tipo_evolucao	= '5'	  
		and	e.nr_seq_unid_dialise	= d.nr_sequencia 
		and	e.cd_pessoa_fisica	= f.cd_pessoa_fisica 
		and   r.nr_seq_escala = g.nr_sequencia 
		and	((r.nr_seq_turno = nr_seq_turno_w) or ( nr_seq_turno_w = '0')) 
		and	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_p 
		and	f.cd_pessoa_fisica = cd_pessoa_fisica_sup_w 
		and	g.cd_pessoa_fisica = e.cd_pessoa_fisica 
		and	substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S' 
		and	to_char(f.dt_evolucao,'mm/yyyy') = dt_referencia_p 
		and (exists (SELECT	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w ) or ( ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'));
		 
		select CASE WHEN count(distinct(f.cd_pessoa_fisica))=0 THEN ''  ELSE 'X' END  
		into STRICT	ie_prim_ass_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise i, 
			hd_escala_dialise_dia r 
		where	e.nr_seq_unid_dialise = d.nr_sequencia 
		and	f.ie_evolucao_clinica = 'PR' 
		and	f.ie_tipo_evolucao = '11' 
		and	e.cd_pessoa_fisica = f.cd_pessoa_fisica 
		and	i.cd_pessoa_fisica = e.cd_pessoa_fisica 
		and   r.nr_seq_escala = i.nr_sequencia 
		and	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_p 
		and	e.cd_pessoa_fisica = cd_pessoa_fisica_sup_w 
		and	f.dt_evolucao = (SELECT min(g.dt_evolucao) 
					from	evolucao_paciente g, 
						hd_pac_renal_cronico h, 
						hd_unidade_dialise c, 
						hd_escala_dialise j 
					where g.ie_evolucao_clinica = 'PR' 
					and	g.ie_tipo_evolucao = '11' 
					and	g.cd_pessoa_fisica = f.cd_pessoa_fisica 
					and	g.cd_pessoa_fisica = h.cd_Pessoa_fisica 
					and	j.cd_pessoa_fisica = h.cd_pessoa_fisica 
					and	g.nr_atendimento = f.nr_atendimento 
					and	c.nr_sequencia = h.nr_seq_unid_dialise 
					and	h.nr_seq_unid_dialise = e.nr_seq_unid_dialise 
					and	substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S' ) 
		and	((r.nr_seq_turno = nr_seq_turno_w) or ( nr_seq_turno_w = '0')) 
		and (exists (select	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w ) or ( ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'));
		 
		select	CASE WHEN count(distinct(f.cd_pessoa_fisica))=0 THEN ''  ELSE 'X' END  
		into STRICT	ie_mensal_ass_w 
		from	hd_unidade_dialise d, 
			hd_pac_renal_cronico e, 
			evolucao_paciente f, 
			hd_escala_dialise g, 
			hd_escala_dialise_dia r 
		where	f.ie_evolucao_clinica	= 'As' 
		and	f.ie_tipo_evolucao	= '11'	  
		and	e.nr_seq_unid_dialise	= d.nr_sequencia 
		and	e.cd_pessoa_fisica	= f.cd_pessoa_fisica 
		and   r.nr_seq_escala = g.nr_sequencia 
		and	((r.nr_seq_turno = nr_seq_turno_w) or ( nr_seq_turno_w = '0')) 
		and	hd_obter_unidade_prc(e.cd_pessoa_fisica,'C') = nr_seq_unidade_p 
		and	g.cd_pessoa_fisica = e.cd_pessoa_fisica 
		and	g.cd_pessoa_fisica = cd_pessoa_fisica_sup_w 
		and	substr(hd_obter_se_paciente_ativo(f.cd_pessoa_fisica),1,1) = 'S' 
		and	to_char(f.dt_evolucao,'mm/yyyy') = dt_referencia_p 
		and (exists (SELECT	1 
				from	paciente_tratamento x 
				where	x.cd_pessoa_fisica = e.cd_pessoa_fisica 
				and	coalesce(x.dt_final_tratamento::text, '') = '' 
				and	x.ie_tratamento = ie_tratamento_w ) or ( ie_tratamento_w = '0')) 
		and	((coalesce(e.ie_paciente_agudo,'N') = ie_paciente_agudo_p) or (ie_paciente_agudo_p = 'T'));
		 
		 
		insert into W_HD_EVOLUCAO(	 
			nm_pessoa_fisica, 
			ie_tipo,			 
			ie_prim_m, 
			ie_laudo_m, 
			ie_mensal_m, 
			ie_prim_e, 
			ie_mensal_e, 
			ie_prim_n, 
			ie_mensal_n, 
			ie_prim_p, 
			ie_mensal_p, 
			ie_prim_ass, 
			ie_mensal_ass, 
			dt_inicio_trat) 
		values (	nm_pessoa_fisica_w, 
			ie_tipo_p,			 
			ie_prim_m_w, 
			ie_laudo_m_w, 
			ie_mensal_m_w, 
			ie_prim_e_w, 
			ie_mensal_e_w, 
			ie_prim_n_w, 
			ie_mensal_n_w, 
			ie_prim_p_w, 
			ie_mensal_p_w, 
			ie_prim_ass_w, 
			ie_mensal_ass_w, 
			dt_inicio_trat_w);
		 
		 
		end;
	end loop;
	close C02;	
end if;
 
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE hd_evolucao_rel_temp ( DT_REFERENCIA_P text, IE_PACIENTE_AGUDO_P text, IE_TIPO_P text, IE_TRATAMENTO_P text, NR_SEQ_TURNO_P bigint, NR_SEQ_UNIDADE_P bigint) FROM PUBLIC;

