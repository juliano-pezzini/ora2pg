-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE calcular_volume_total_solucao ( tipo_dosagem_p text, qt_tempo_aplicacao_p bigint, qt_solucao_total_p bigint, qt_dosagem_p bigint, nr_prescricao_p bigint, nr_seq_solucao_p bigint, campo_p bigint, vl_retorno_p INOUT bigint, ie_arredonda_p text, nr_etapas_p bigint DEFAULT 1, ie_vel_conforme_etapa_p text DEFAULT 'N', qt_hora_fase_p bigint DEFAULT NULL) AS $body$
DECLARE


    qt_gotas_w                double precision;
    qt_tempo_w                double precision;
    qt_resultado_w            double precision;
    nr_etapas_w            bigint;
    qt_hora_fase_w         double precision;
    qt_solucao_w           double precision;
    ie_arredondar_w        varchar(1) := 'S';
    ie_utiliza_disp_inf_w  varchar(1);
    sql_w                  varchar(200);

BEGIN


    BEGIN
        sql_w := 'begin OBTER_INFO_TIPO_DOSAGEM_SOL_MD  (:1, :2, :3); end;';
        EXECUTE sql_w
            USING IN tipo_dosagem_p, OUT qt_gotas_w, OUT qt_tempo_w;
    EXCEPTION
        WHEN OTHERS THEN
            qt_gotas_w := NULL;
            qt_tempo_w := NULL;
    END;

    qt_resultado_w := 0;
    SELECT
        coalesce(MAX(ie_bomba_infusao), 'N'),
        coalesce(qt_hora_fase_p, MAX(qt_hora_fase))
    INTO STRICT
        ie_utiliza_disp_inf_w,
        qt_hora_fase_w
    FROM
        prescr_solucao
    WHERE
            nr_prescricao = nr_prescricao_p
        AND nr_seq_solucao = nr_seq_solucao_p;

    BEGIN
        sql_w := 'CALL OBTER_RES_VOL_TOT_SOLUCAO_MD(:1, :2, :3, :4, :5, :6, :7, :8, :9, :10, :11, :12) INTO :qt_resultado_w';
        EXECUTE sql_w
            USING IN campo_p, IN ie_vel_conforme_etapa_p, IN qt_solucao_total_p, IN qt_gotas_w, IN qt_tempo_aplicacao_p, IN qt_tempo_w,
            IN nr_etapas_p, IN qt_hora_fase_p, IN qt_dosagem_p, IN ie_arredonda_p, IN tipo_dosagem_p, IN ie_utiliza_disp_inf_w, OUT
            qt_resultado_w;

    EXCEPTION
        WHEN OTHERS THEN
            qt_resultado_w := NULL;
    END;

    vl_retorno_p := qt_resultado_w;
	
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE calcular_volume_total_solucao ( tipo_dosagem_p text, qt_tempo_aplicacao_p bigint, qt_solucao_total_p bigint, qt_dosagem_p bigint, nr_prescricao_p bigint, nr_seq_solucao_p bigint, campo_p bigint, vl_retorno_p INOUT bigint, ie_arredonda_p text, nr_etapas_p bigint DEFAULT 1, ie_vel_conforme_etapa_p text DEFAULT 'N', qt_hora_fase_p bigint DEFAULT NULL) FROM PUBLIC;

