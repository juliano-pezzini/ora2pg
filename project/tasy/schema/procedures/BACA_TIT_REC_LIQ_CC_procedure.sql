-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_tit_rec_liq_cc () AS $body$
DECLARE

 
nr_seq_liq_w bigint;
nr_titulo_w bigint;

C01 CURSOR FOR 
SELECT   a.nr_titulo, 
  a.nr_sequencia 
from    titulo_receber b, 
  titulo_receber_liq a 
where (vl_rec_maior <> 0 or vl_glosa <> 0) 
and    (nr_seq_ret_item IS NOT NULL AND nr_seq_ret_item::text <> '') 
and    a.dt_atualizacao        >= to_date('01/11/2006','dd/mm/yyyy') 
and    a.nr_titulo           = b.nr_titulo 
and    b.cd_estabelecimento      = 1 
and    coalesce(a.nr_lote_contabil,0)    = 0 
and (SELECT coalesce(sum(x.vl_baixa),0) + coalesce(sum(x.vl_amaior),0) 
    from  titulo_rec_liq_cc x 
      where   x.nr_titulo   = a.nr_titulo 
      and    x.nr_seq_baixa = a.nr_sequencia) = 0;

 
/* 
select a.nr_titulo, 
 a.nr_sequencia 
from titulo_receber b, 
 titulo_receber_liq a 
where (vl_rec_maior <> 0 or vl_glosa <> 0) 
and nr_seq_ret_item is not null 
and a.dt_atualizacao  >= to_date('01/11/2006','dd/mm/yyyy') 
and a.nr_titulo  = b.nr_titulo 
and nvl(a.nr_lote_contabil,0) = 0 
and b.cd_estabelecimento = 1 
and ( 
 (nvl(a.vl_glosa,0) <> 
 (select nvl(sum(x.vl_baixa),0) 
 from titulo_rec_liq_cc x 
 where x.nr_titulo = a.nr_titulo 
 and x.nr_seq_baixa = a.nr_sequencia)) or 
 (nvl(a.vl_rec_maior,0) <> 
 (select nvl(sum(x.vl_amaior),0) 
 from titulo_rec_liq_cc x 
 where x.nr_titulo = a.nr_titulo 
 and x.nr_seq_baixa = a.nr_sequencia)) 
 ); 
 
 
select   a.nr_titulo, 
  a.nr_sequencia 
from    titulo_receber b, 
  titulo_receber_liq a 
where   (vl_rec_maior <> 0 or vl_glosa <> 0) 
and    nr_seq_ret_item is not null 
and    a.dt_atualizacao        >= to_date('01/11/2006','dd/mm/yyyy') 
and    a.nr_titulo           = b.nr_titulo 
and    b.cd_estabelecimento      = 1 
and    nvl(a.nr_lote_contabil,0)    = 0 
and    (select nvl(sum(x.vl_baixa),0) + nvl(sum(x.vl_amaior),0) 
    from  titulo_rec_liq_cc x 
      where   x.nr_titulo   = a.nr_titulo 
      and    x.nr_seq_baixa = a.nr_sequencia) = 0 
 
*/
 

BEGIN 
 
open c01;
loop 
fetch c01 into 
 nr_titulo_w, 
 nr_seq_liq_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
 
 CALL gerar_titulo_rec_liq_cc(1, null, 'TASY', nr_titulo_w, nr_seq_liq_w);
 
end loop;
close c01;
 
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_tit_rec_liq_cc () FROM PUBLIC;

