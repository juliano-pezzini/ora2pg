-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_reg_tc_pendencies ( nm_usuario_p text) AS $body$
DECLARE

c01 CURSOR FOR 
	SELECT	x.cd_funcao, 
			x.nr_seq_product_req 
	from	reg_funcao_pr x 
	where	x.cd_funcao not in ( 
			SELECT a.cd_funcao 
			from reg_tc_pendencies a 
			where a.nr_seq_pr = x.nr_seq_product_req);

cd_funcao_w bigint;
nr_seq_product_w bigint;

BEGIN
open c01;
loop 
fetch c01 into	 
	cd_funcao_w, 
	nr_seq_product_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin 
	 
	insert 
	into reg_tc_pendencies(	 
			nr_sequencia, 
			nr_seq_pr, 
			nr_seq_tc, 
			ds_version, 
			cd_funcao, 
			dt_atualizacao, 
			dt_atualizacao_nrec, 
			nm_usuario, 
			nm_usuario_nrec, 
			ie_status) 
   SELECT nextval('reg_tc_pendencies_seq'), 
       nr_seq_product, 
       nr_sequencia, 
       '2.2.1700', 
       cd_funcao_w, 
       clock_timestamp(), 
       clock_timestamp(), 
       nm_usuario_p, 
       nm_usuario_p, 
			 'Pendente' 
   from  reg_caso_teste 
   where nr_seq_product = nr_seq_product_w;
	 
	end;
end loop;
close c01;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_reg_tc_pendencies ( nm_usuario_p text) FROM PUBLIC;

