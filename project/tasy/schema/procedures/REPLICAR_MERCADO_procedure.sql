-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE replicar_mercado ( nr_nivel_p bigint, nr_sequencia_p bigint, nr_mercado_p bigint, nm_usuario_p text) AS $body$
DECLARE


area_mercado_sequence_w		smallint;
modulo_mercado_sequence_w	smallint;
funcao_mercado_sequence_w	smallint;
nr_seq_area_prod_w		smallint;
nr_seq_modulo_area_w		smallint;


C01 CURSOR FOR
	SELECT	nr_sequencia seq_area
	from	mkt_produto_area a
	where	nr_seq_produto = nr_sequencia_p
	and	not exists (SELECT 1 from mkt_area_mercado where nr_seq_mercado = nr_mercado_p and nr_seq_area = a.nr_sequencia)
	order by nr_sequencia;

C02 CURSOR FOR
	SELECT	nr_sequencia seq_modulo
	from	mkt_area_modulo a
	where	nr_seq_prod_area = nr_seq_area_prod_w
	and	not exists (SELECT 1 from mkt_modulo_mercado where nr_seq_mercado = nr_mercado_p and nr_seq_modulo = a.nr_sequencia)
	order by nr_sequencia;

C03 CURSOR FOR
	SELECT	nr_sequencia seq_funcao
	from	mkt_modulo_funcao a
	where	nr_seq_area_modulo = nr_seq_modulo_area_w
	and	not exists (SELECT 1 from mkt_funcao_mercado where nr_seq_mercado = nr_mercado_p and nr_seq_mod_fun = a.nr_sequencia)
	order by nr_sequencia;
BEGIN

if (nr_nivel_p = 1) then

	for r_c01 in c01 loop

		select	nextval('mkt_area_mercado_seq')
		into STRICT	area_mercado_sequence_w
		;


		insert	into	mkt_area_mercado(	nr_sequencia,
						dt_atualizacao,
						dt_atualizacao_nrec,
						nm_usuario,
						nm_usuario_nrec,
						nr_seq_area,
						nr_seq_mercado)
		values (	area_mercado_sequence_w,
			clock_timestamp(),
			clock_timestamp(),
			nm_usuario_p,
			nm_usuario_p,
			r_c01.seq_area,
			nr_mercado_p);


		nr_seq_area_prod_w := r_c01.seq_area;


		for r_c02 in c02 loop

			select	nextval('mkt_modulo_mercado_seq')
			into STRICT	modulo_mercado_sequence_w
			;

			insert	into	mkt_modulo_mercado(	nr_sequencia,
								dt_atualizacao,
								dt_atualizacao_nrec,
								nm_usuario,
								nm_usuario_nrec,
								nr_seq_modulo,
								nr_seq_mercado)
				values (	modulo_mercado_sequence_w,
					clock_timestamp(),
					clock_timestamp(),
					nm_usuario_p,
					nm_usuario_p,
					r_c02.seq_modulo,
					nr_mercado_p);


			nr_seq_modulo_area_w := r_c02.seq_modulo;

			for r_c03 in c03 loop

				select	nextval('mkt_funcao_mercado_seq')
				into STRICT	funcao_mercado_sequence_w
				;

				insert	into	mkt_funcao_mercado(	nr_sequencia,
								dt_atualizacao,
								dt_atualizacao_nrec,
								nm_usuario,
								nm_usuario_nrec,
								nr_seq_mod_fun,
								nr_seq_mercado )
				values (	funcao_mercado_sequence_w,
					clock_timestamp(),
					clock_timestamp(),
					nm_usuario_p,
					nm_usuario_p,
					r_c03.seq_funcao,
					nr_mercado_p);

			end loop;

		end loop;

	end loop;

elsif (nr_nivel_p = 2) then

	nr_seq_area_prod_w := nr_sequencia_p;

	for r_c02 in c02 loop

		select	nextval('mkt_modulo_mercado_seq')
		into STRICT	modulo_mercado_sequence_w
		;

		insert	into	mkt_modulo_mercado(	nr_sequencia,
							dt_atualizacao,
							dt_atualizacao_nrec,
							nm_usuario,
							nm_usuario_nrec,
							nr_seq_modulo,
							nr_seq_mercado)
			values (	modulo_mercado_sequence_w,
				clock_timestamp(),
				clock_timestamp(),
				nm_usuario_p,
				nm_usuario_p,
				r_c02.seq_modulo,
				nr_mercado_p);


		nr_seq_modulo_area_w := r_c02.seq_modulo;

		for r_c03 in c03 loop

			select	nextval('mkt_funcao_mercado_seq')
			into STRICT	funcao_mercado_sequence_w
			;

			insert	into	mkt_funcao_mercado(	nr_sequencia,
							dt_atualizacao,
							dt_atualizacao_nrec,
							nm_usuario,
							nm_usuario_nrec,
							nr_seq_mod_fun,
							nr_seq_mercado )
			values (	funcao_mercado_sequence_w,
				clock_timestamp(),
				clock_timestamp(),
				nm_usuario_p,
				nm_usuario_p,
				r_c03.seq_funcao,
				nr_mercado_p);

		end loop;

	end loop;


elsif (nr_nivel_p = 3) then

	nr_seq_modulo_area_w := nr_sequencia_p;

	for r_c03 in c03 loop

		select	nextval('mkt_funcao_mercado_seq')
		into STRICT	funcao_mercado_sequence_w
		;

		insert	into	mkt_funcao_mercado(	nr_sequencia,
						dt_atualizacao,
						dt_atualizacao_nrec,
						nm_usuario,
						nm_usuario_nrec,
						nr_seq_mod_fun,
						nr_seq_mercado )
		values (	funcao_mercado_sequence_w,
			clock_timestamp(),
			clock_timestamp(),
			nm_usuario_p,
			nm_usuario_p,
			r_c03.seq_funcao,
			nr_mercado_p);

	end loop;

end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE replicar_mercado ( nr_nivel_p bigint, nr_sequencia_p bigint, nr_mercado_p bigint, nm_usuario_p text) FROM PUBLIC;

