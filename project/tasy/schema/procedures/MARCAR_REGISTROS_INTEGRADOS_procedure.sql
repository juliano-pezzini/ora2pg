-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE marcar_registros_integrados ( nm_usuario_p text, cd_interface_p bigint, ds_sql_p text, dt_emissao_de_p timestamp, dt_emissao_ate_p timestamp) AS $body$
DECLARE


ds_sql_w		varchar(6000);


BEGIN

ds_sql_w := SUBSTR(ds_sql_p, 1, 4000);

 IF (cd_interface_p = 1308) THEN

UPDATE  titulo_pagar
SET     dt_integracao_externa =  TO_DATE(clock_timestamp(), 'dd/mm/yyyy')
WHERE  obter_se_contido(nr_titulo,ds_sql_w) = 'S';


ELSIF ((cd_interface_p = 1309) OR (cd_interface_p = 1491)) THEN

UPDATE  titulo_receber
SET     dt_integracao_externa = clock_timestamp()
WHERE  obter_se_contido(nr_titulo,ds_sql_w) = 'S';

ELSIF (cd_interface_p = 1326) THEN

UPDATE  titulo_pagar_baixa
SET     dt_integracao_externa = clock_timestamp()
WHERE  OBTER_SE_CONTIDO(nr_titulo,ds_sql_w) = 'S'
AND    TO_DATE( dt_baixa , 'dd/mm/yyyy') BETWEEN TO_DATE(dt_emissao_de_p, 'dd/mm/yyyy') AND TO_DATE(dt_emissao_ate_p,'dd/mm/yyyy');

ELSIF (cd_interface_p = 1327) THEN

UPDATE  titulo_receber_liq
SET     dt_integracao_externa = clock_timestamp()
WHERE  OBTER_SE_CONTIDO(nr_titulo,ds_sql_w) = 'S'
AND    TO_DATE( dt_recebimento , 'dd/mm/yyyy')  BETWEEN  TO_DATE(dt_emissao_de_p, 'dd/mm/yyyy') AND TO_DATE(dt_emissao_ate_p,'dd/mm/yyyy');

ELSIF ((cd_interface_p = 1333) OR (cd_interface_p = 1334)) THEN

UPDATE  pessoa_fisica
SET     dt_integracao_externa = clock_timestamp()
WHERE   OBTER_SE_CONTIDO(cd_pessoa_fisica,ds_sql_w) = 'S';

UPDATE  pessoa_juridica
SET     dt_integracao_externa = clock_timestamp()
WHERE   OBTER_SE_CONTIDO(cd_cgc,ds_sql_w) = 'S';

ELSIF (cd_interface_p = 2254) THEN

UPDATE  titulo_pagar SET     dt_integracao_externa = clock_timestamp() WHERE  OBTER_SE_CONTIDO(nr_titulo,ds_sql_w) = 'S';

ELSIF (cd_interface_p = 1667 OR cd_interface_p = 2755) THEN

UPDATE  titulo_pagar
SET     dt_integracao_externa = clock_timestamp()
WHERE  OBTER_SE_CONTIDO(nr_titulo,ds_sql_w) = 'S';

END IF;

COMMIT;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE marcar_registros_integrados ( nm_usuario_p text, cd_interface_p bigint, ds_sql_p text, dt_emissao_de_p timestamp, dt_emissao_ate_p timestamp) FROM PUBLIC;

