-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_nut_reserva_js ( ie_gerar_sem_rest_p text, nr_seq_restaurante_p bigint, ie_mensagem_reserva_p text, nr_seq_servico_p bigint, dt_inicial_p timestamp, dt_final_p timestamp, cd_pessoa_fisica_p text, cd_estabelecimento_p bigint, nm_usuario_p text, ie_reserva_p INOUT text, ds_observacao_p text, nr_seq_local_refeicao_p bigint default null, ds_mensagem_p INOUT text DEFAULT NULL, hr_entrega_p timestamp default null) AS $body$
DECLARE




ie_reserva_w  varchar(1) := 'N';


BEGIN
if (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') then
  begin

  if (ie_mensagem_reserva_p IS NOT NULL AND ie_mensagem_reserva_p::text <> '') then
    begin
    select  CASE WHEN coalesce(count(nr_sequencia),0)=0 THEN 'N'  ELSE 'S' END
    into STRICT  ie_reserva_w
    from   nut_reserva
    where  dt_servico between dt_inicial_p
    and  fim_dia(dt_final_p)
    and  'S' = obter_se_perfil_nut_liberado(obter_perfil_nutricao_pf(cd_pessoa_fisica_p,'C'), nr_sequencia);
    end;
  end if;
  ds_mensagem_p := gerar_nut_reserva(
    nr_seq_servico_p, dt_inicial_p, dt_final_p, cd_pessoa_fisica_p, nm_usuario_p, nr_seq_restaurante_p, cd_estabelecimento_p, ds_observacao_p, nr_seq_local_refeicao_p, ds_mensagem_p, hr_entrega_p);
  end;
end if;
ie_reserva_p  := ie_reserva_w;
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_nut_reserva_js ( ie_gerar_sem_rest_p text, nr_seq_restaurante_p bigint, ie_mensagem_reserva_p text, nr_seq_servico_p bigint, dt_inicial_p timestamp, dt_final_p timestamp, cd_pessoa_fisica_p text, cd_estabelecimento_p bigint, nm_usuario_p text, ie_reserva_p INOUT text, ds_observacao_p text, nr_seq_local_refeicao_p bigint default null, ds_mensagem_p INOUT text DEFAULT NULL, hr_entrega_p timestamp default null) FROM PUBLIC;

