-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE param_relat_dinamico_insert (acao_p text) AS $body$
DECLARE


nr_seq_param_relat_w bigint;
relatorio_parametro_seq_w bigint;
nm_atributo_w varchar(255);
ds_parametro_w varchar(255);
ie_tipo_atributo_w varchar(10);
nr_seq_relatorio_w bigint;
nm_usuario_w varchar(15);
ds_valor_padrao_w varchar(255);
ds_mascara_w varchar(255);
nr_linha_w bigint;


BEGIN

	select max(nr_sequencia)
	into STRICT nr_seq_param_relat_w
	from parametro_relat_dinamico
	where nm_usuario = wheb_usuario_pck.get_nm_usuario;

	if (nr_seq_param_relat_w IS NOT NULL AND nr_seq_param_relat_w::text <> '') then

		select nm_atributo,
		ds_parametro,
		ie_tipo_atributo,
		nr_seq_relatorio,
		nm_usuario,
		ds_valor_padrao,
		ds_mascara,
		nr_linha
		into STRICT
		nm_atributo_w,
		ds_parametro_w,
		ie_tipo_atributo_w,
		nr_seq_relatorio_w,
		nm_usuario_w,
		ds_valor_padrao_w,
		ds_mascara_w,
		nr_linha_w
		from parametro_relat_dinamico
		where nr_sequencia = nr_seq_param_relat_w;

		if (acao_p = 'INSERT') then

			select nextval('relatorio_parametro_seq')
			into STRICT relatorio_parametro_seq_w
			;

			insert into relatorio_parametro(nr_sequencia,
			cd_parametro,
			ds_parametro,
			ie_tipo_atributo,
			nr_seq_relatorio,
			ie_origem_informacao,
			dt_atualizacao,
			nm_usuario,
			vl_padrao,
			ds_mascara,
			ie_multi_linha,
			nr_seq_apresent,
			ie_forma_passagem,
			ie_forma_apresent)
			values (relatorio_parametro_seq_w,
			nm_atributo_w,
			ds_parametro_w,
			ie_tipo_atributo_w,
			nr_seq_relatorio_w,
			'P',
			clock_timestamp(),
			nm_usuario_w,
			ds_valor_padrao_w,
			ds_mascara_w,
			'N',
			nr_linha_w,
			'P',
			'ed');

			update parametro_relat_dinamico
			set nr_seq_relatorio_parametro = relatorio_parametro_seq_w
			where nr_sequencia = nr_seq_param_relat_w;

		else

			select max(nr_seq_relatorio_parametro)
			into STRICT relatorio_parametro_seq_w
			from parametro_relat_dinamico
			where nr_seq_relatorio = nr_seq_relatorio_w
			and nr_sequencia =  nr_seq_param_relat_w;

			if (acao_p = 'UPDATE') then

				update relatorio_parametro
				set cd_parametro = nm_atributo_w,
				ds_parametro = ds_parametro_w,
				ie_tipo_atributo = ie_tipo_atributo_w,
        nr_seq_relatorio = nr_seq_relatorio_w,
				ie_origem_informacao = 'P',
				dt_atualizacao = clock_timestamp(),
				nm_usuario = nm_usuario_w,
				cd_dominio = ds_valor_padrao_w,
				vl_padrao = ds_valor_padrao_w,
				ds_mascara = ds_mascara_w,
				ie_multi_linha = 'N',
				nr_seq_apresent = nr_linha_w,
				ie_forma_passagem = 'P',
				ie_forma_apresent = 'ed'
				where nr_seq_relatorio = nr_seq_relatorio_w
				and nr_sequencia =  relatorio_parametro_seq_w;

			elsif (acao_p = 'DELETE') then

				delete from relatorio_parametro
				where nr_sequencia = relatorio_parametro_seq_w
				and nr_seq_relatorio = nr_seq_relatorio_w;

			end if;

		end if;
	
	end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE param_relat_dinamico_insert (acao_p text) FROM PUBLIC;

