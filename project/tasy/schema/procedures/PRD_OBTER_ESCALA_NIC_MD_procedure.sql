-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE prd_obter_escala_nic_md ( ie_pa_max_p text, ie_balao_aortico_p text, ie_insuf_card_p text, ie_idade_p text, ie_anemia_p text, ie_diabete_p text, ie_creatinina_serica_maior_p text, ie_creatinia_p text, qt_clearence_creatinina_p bigint, qt_creatinina_serica_p bigint, qt_contraste_p bigint, qt_escore_p INOUT bigint, qt_risco_nic_p INOUT bigint, qt_risco_dialise_p INOUT bigint ) AS $body$
BEGIN
    qt_escore_p := 0;

	if (ie_pa_max_p = 'S') then
	  qt_escore_p := qt_escore_p + 5;
	end if;

	if (ie_balao_aortico_p = 'S') then
	  qt_escore_p := qt_escore_p + 5;
	end if;

	if (ie_insuf_card_p = 'S') then
	  qt_escore_p := qt_escore_p + 5;
	end if;

	if (ie_idade_p = 'S') then
	  qt_escore_p := qt_escore_p + 4;
	end if;

	if (ie_anemia_p = 'S') then
	  qt_escore_p := qt_escore_p + 3;
	end if;

	if (ie_diabete_p = 'S') then
	  qt_escore_p := qt_escore_p + 3;
	end if;

	if (ie_creatinina_serica_maior_p = 'S') then
	  qt_escore_p := qt_escore_p + 4;
	end if;

	if (ie_creatinia_p = 'CC') then
	  if (qt_clearence_creatinina_p  >= 40 and qt_clearence_creatinina_p < 60) then
		qt_escore_p := qt_escore_p + 2;
	  elsif (qt_clearence_creatinina_p >= 20 and qt_clearence_creatinina_p < 39) then
		qt_escore_p := qt_escore_p + 4;
	  elsif (qt_clearence_creatinina_p < 20) then
		qt_escore_p := qt_escore_p + 6;
	  end if;
	elsif (ie_creatinia_p = 'CS' and qt_creatinina_serica_p > 1.5) then
	  qt_escore_p := qt_escore_p + 4;		
	end if;		

	qt_escore_p := qt_escore_p + round(dividir_md(coalesce(qt_contraste_p, 0), 100));

	if (qt_escore_p <= 5) then
	  qt_risco_nic_p := 7.5;
	  qt_risco_dialise_p := 0.04;
	elsif (qt_escore_p <= 10) then
	  qt_risco_nic_p := 14;
	  qt_risco_dialise_p := 0.12;
	elsif (qt_escore_p < 16) then
	  qt_risco_nic_p  := 26.1;
	  qt_risco_dialise_p := 1.09;
	elsif (qt_escore_p >= 16) then
	  qt_risco_nic_p := 57.3;
	  qt_risco_dialise_p := 12.6;
	end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE prd_obter_escala_nic_md ( ie_pa_max_p text, ie_balao_aortico_p text, ie_insuf_card_p text, ie_idade_p text, ie_anemia_p text, ie_diabete_p text, ie_creatinina_serica_maior_p text, ie_creatinia_p text, qt_clearence_creatinina_p bigint, qt_creatinina_serica_p bigint, qt_contraste_p bigint, qt_escore_p INOUT bigint, qt_risco_nic_p INOUT bigint, qt_risco_dialise_p INOUT bigint ) FROM PUBLIC;

