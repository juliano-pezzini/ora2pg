-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_cpoe_item_inter_farm ( nr_seq_cpoe_p bigint, ie_tipo_item_p text, nr_atendimento_p bigint, cd_motivo_p bigint, ds_motivo_p text, cd_perfil_p bigint, cd_estabelecimento_p bigint , nm_usuario_p text , nr_seq_novo_item_p INOUT bigint) AS $body$
DECLARE

 
ieMotivoPrescricao_w		varchar(15);
nr_seq_novo_w				bigint;
nm_tabela_w					varchar(50);
ds_comando_w				varchar(32000);
bind_variables_w			varchar(250);
ds_lista_proc_susp_out_w	varchar(4000);


BEGIN 
 
ieMotivoPrescricao_w := Obter_Param_Usuario(7010, 166, cd_perfil_p, nm_usuario_p, cd_estabelecimento_p, ieMotivoPrescricao_w);
 
case ie_tipo_item_p 
	when 'M' then --Material			 
		nm_tabela_w	:= 'CPOE_MATERIAL';
	when 'MA' then --Material			 
		nm_tabela_w	:= 'CPOE_MATERIAL';
	when 'N' then --Nutricao 
		nm_tabela_w	:= 'CPOE	_DIETA';
	when 'P' then --Procedimentos 
		nm_tabela_w	:= 'CPOE_PROCEDIMENTO';
	when 'G' then --Gasoterapia           
		nm_tabela_w	:= 'CPOE_GASOTERAPIA';
	when 'R' then --Recomendação 
		nm_tabela_w	:= 'CPOE_RECOMENDACAO';
	when 'H' then --Hemoterapia 
		nm_tabela_w	:= 'CPOE_HEMOTERAPIA';
	when 'D' then --Dialise 
		nm_tabela_w	:= 'CPOE_DIALISE';
	when 'DI' then --Dialise 
		nm_tabela_w	:= 'CPOE_DIALISE';
	when 'DP' then --Dialise 
		nm_tabela_w	:= 'CPOE_DIALISE';
end case;
 
nr_seq_novo_w := CPOE_DUPLICAR_REGISTRO(nm_tabela_w, nm_usuario_p, nr_seq_cpoe_p, nr_seq_novo_w);
ds_lista_proc_susp_out_w := CPOE_Suspender_item_prescr('['||nr_seq_cpoe_p||';'||ie_tipo_item_p||';S]', nr_atendimento_p, nm_usuario_p, null, null, 'N', ds_lista_proc_susp_out_w);
 
ds_comando_w := 'update ' || nm_tabela_w || ' set ie_cpoe_farm = ''S'', nr_cpoe_interf_farm = :old_pk, ie_motivo_prescricao = :ie_motivo where nr_sequencia = :new_pk';
bind_variables_w := 'old_pk='||nr_seq_cpoe_p||';';
bind_variables_w := bind_variables_w || 'ie_motivo='||ieMotivoPrescricao_w||';';
bind_variables_w := bind_variables_w || 'new_pk='||nr_seq_novo_w||';';
CALL Exec_sql_Dinamico_bv('',ds_comando_w,bind_variables_w);-- utilizando bind variables para realizar o update 
commit;
 
nr_seq_novo_item_p	:= nr_seq_novo_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_cpoe_item_inter_farm ( nr_seq_cpoe_p bigint, ie_tipo_item_p text, nr_atendimento_p bigint, cd_motivo_p bigint, ds_motivo_p text, cd_perfil_p bigint, cd_estabelecimento_p bigint , nm_usuario_p text , nr_seq_novo_item_p INOUT bigint) FROM PUBLIC;

