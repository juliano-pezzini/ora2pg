-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inativar_bolsa_aux (nr_bolsa_p prescr_proc_bol_aux.nr_bolsa%type, nr_seq_horario_p prescr_proc_bol_aux.nr_seq_horario%type, nm_usuario_P prescr_proc_bol_aux.nm_usuario%type) AS $body$
DECLARE

                        
    ds_bolsas_pendentes_w      varchar(2);


BEGIN

    update  prescr_proc_bol_aux
    set     ie_situacao = 'I'
    where   nr_bolsa = nr_bolsa_p
    and     nr_seq_horario = nr_seq_horario_p;

    select  coalesce(max('S'),'N')
    into STRICT    ds_bolsas_pendentes_w
    from    prescr_proc_bol_aux
    where   nr_seq_horario = nr_seq_horario_p
    and     ie_situacao = 'A';

    if (ds_bolsas_pendentes_w = 'N')   then

        delete  from  prescr_proc_bolsa
        where   nr_bolsa = '0'
        and     nr_seq_horario = nr_seq_horario_p;

    end if;

    commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inativar_bolsa_aux (nr_bolsa_p prescr_proc_bol_aux.nr_bolsa%type, nr_seq_horario_p prescr_proc_bol_aux.nr_seq_horario%type, nm_usuario_P prescr_proc_bol_aux.nm_usuario%type) FROM PUBLIC;

