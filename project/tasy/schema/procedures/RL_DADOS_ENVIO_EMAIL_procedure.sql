-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE rl_dados_envio_email ( nr_sequencia_p bigint, ie_tipo_local_p text, cd_setor_atendimento_p bigint, ds_email_p INOUT text, ds_local_p INOUT text, ds_setor_atendimento_p INOUT text) AS $body$
DECLARE

 
ds_email_w		varchar(255) := '';
ds_local_w		varchar(255) := '';
ds_setor_atendimento_w	varchar(255) := '';
				

BEGIN 		 
 
if (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '') then 
	begin 
	 
	select	max(a.ds_email) 
	into STRICT	ds_email_w 
	from	compl_pessoa_fisica a, 
		atendimento_paciente b, 
		laudo_paciente c 
	where a.cd_pessoa_fisica = b.cd_pessoa_fisica 
	and  b.nr_atendimento = c.nr_atendimento 
	and  ie_tipo_complemento = 1 
	and  c.nr_sequencia = nr_sequencia_p;
	 
	ds_local_w := substr(obter_valor_dominio(138,ie_tipo_local_p),1,255);
		 
	select	' - ' || substr(obter_desc_expressao(cd_exp_setor_atend,ds_setor_atendimento),1,100) 
	into STRICT	ds_setor_atendimento_w 
	from	setor_atendimento 
	where	cd_setor_atendimento = cd_setor_atendimento_p;
	 
	end;
	 
end if;
		 
ds_email_p 		:= ds_email_w;
ds_local_p 		:= ds_local_w;
ds_setor_atendimento_p	:= ds_setor_atendimento_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE rl_dados_envio_email ( nr_sequencia_p bigint, ie_tipo_local_p text, cd_setor_atendimento_p bigint, ds_email_p INOUT text, ds_local_p INOUT text, ds_setor_atendimento_p INOUT text) FROM PUBLIC;

