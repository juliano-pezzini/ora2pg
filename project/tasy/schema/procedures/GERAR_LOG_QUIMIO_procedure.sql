-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_log_quimio ( nr_seq_ordem_p bigint, nr_prescricao_p bigint, nr_seq_material_p bigint, ds_log_p text, ie_acao_p text, nm_usuario_p text) AS $body$
DECLARE


ds_stack_w			varchar(4000);
ds_log_w			varchar(4000);
ie_gera_log_w			varchar(1);

BEGIN
ie_gera_log_w := Obter_Param_Usuario(3130, 467, obter_perfil_ativo, nm_usuario_p, wheb_usuario_pck.get_cd_estabelecimento, ie_gera_log_w);

if (ie_gera_log_w = 'S') then
	delete 	from log_quimio
	where	dt_atualizacao_nrec between(clock_timestamp() - interval '40 days') and (clock_timestamp() - interval '30 days');

	ds_stack_w	:= substr(dbms_utility.format_call_stack,1,4000);
	ds_log_w	:= substr(ds_log_p,1,4000);
	insert into log_quimio(	nr_sequencia,
									ds_log,
									ds_stack,
									dt_atualizacao,
									dt_atualizacao_nrec,
									ie_acao,
									nm_usuario,
									nm_usuario_nrec,
									nr_prescricao,
									nr_seq_material,
									nr_seq_ordem)
						values (	nextval('log_quimio_seq'),
									ds_log_w,
									ds_stack_w,
									clock_timestamp(),
									clock_timestamp(),
									ie_acao_p,
									nm_usuario_p,
									nm_usuario_p,
									nr_prescricao_p,
									nr_seq_material_p,
									nr_seq_ordem_p);

end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_log_quimio ( nr_seq_ordem_p bigint, nr_prescricao_p bigint, nr_seq_material_p bigint, ds_log_p text, ie_acao_p text, nm_usuario_p text) FROM PUBLIC;

