-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE mprev_inserir_email ( cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%type, nm_usuario_p text, ie_email_mprev_p pessoa_fisica_aux.ie_email_mprev%type ) AS $body$
DECLARE


nr_seq_pessoa_fisica_aux_w	pessoa_fisica_aux.nr_sequencia%type;
ie_possui_aux_w 	          varchar(1);


BEGIN

if (ie_email_mprev_p IS NOT NULL AND ie_email_mprev_p::text <> '') then

  select CASE WHEN count(*)=0 THEN  'N'  ELSE 'S' END
  into STRICT ie_possui_aux_w
  from pessoa_fisica_aux
  where cd_pessoa_fisica = cd_pessoa_fisica_p;

  if (ie_possui_aux_w = 'N') then

		select	nextval('pessoa_fisica_aux_seq')
    into STRICT	nr_seq_pessoa_fisica_aux_w
;

		insert into pessoa_fisica_aux(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			cd_pessoa_fisica,
			ie_email_mprev
		) values (
			nr_seq_pessoa_fisica_aux_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			cd_pessoa_fisica_p,
			ie_email_mprev_p
		);

	else

		update pessoa_fisica_aux p 
		set p.ie_email_mprev = ie_email_mprev_p,
			  p.dt_atualizacao_nrec = clock_timestamp(),
			  p.nm_usuario_nrec = nm_usuario_p
		where p.cd_pessoa_fisica = cd_pessoa_fisica_p;

	end if;
  commit;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE mprev_inserir_email ( cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%type, nm_usuario_p text, ie_email_mprev_p pessoa_fisica_aux.ie_email_mprev%type ) FROM PUBLIC;

