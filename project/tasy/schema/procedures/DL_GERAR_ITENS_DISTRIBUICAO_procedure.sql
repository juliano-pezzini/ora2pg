-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE dl_gerar_itens_distribuicao ( nr_seq_distribuicao_p bigint, nm_usuario_p text, ie_aneste_extra_p text, ie_aneste_plantao_p text, ie_aneste_manha_p text, ie_aneste_tarde_p text, ie_encargos_p text, ie_plantao_fer_dom_p text, ie_plantao_fer_sem_p text, ie_plantao_fer_sab_p text, ie_plantao_semana_p text, ie_plantao_tarde_p text, ie_reuniao_p text, ie_tempo_sociedade_p text, ie_remun_exsocios_p text, ie_doacao_exsocios_p text, cd_estabelecimento_p bigint, vl_distribuicao_p bigint) AS $body$
DECLARE

			 
vl_total_distrib_w	double precision;
vl_total_distrib_lote_w	double precision;
nr_seq_lote_w		bigint;


BEGIN 
vl_total_distrib_w	:= 0;
vl_total_distrib_lote_w	:= 0;
 
if (ie_aneste_extra_p = 'S') then 
	CALL dl_gerar_itens_aneste_extra(nr_seq_distribuicao_p,nm_usuario_p,cd_estabelecimento_p,vl_distribuicao_p);
end if;
 
if (ie_aneste_plantao_p = 'S') then 
	CALL dl_gerar_itens_aneste_plantao(nr_seq_distribuicao_p,nm_usuario_p,cd_estabelecimento_p,vl_distribuicao_p);
end if;
 
if (ie_aneste_manha_p = 'S') then 
	CALL dl_gerar_itens_aneste_manha(nr_seq_distribuicao_p,nm_usuario_p,cd_estabelecimento_p,vl_distribuicao_p);
end if;
 
if (ie_aneste_tarde_p = 'S') then 
	CALL dl_gerar_itens_aneste_tarde(nr_seq_distribuicao_p,nm_usuario_p,cd_estabelecimento_p,vl_distribuicao_p);
end if;
 
if (ie_encargos_p = 'S') then 
	CALL dl_gerar_itens_encargo(nr_seq_distribuicao_p,nm_usuario_p,cd_estabelecimento_p,vl_distribuicao_p);
end if;
 
if (ie_plantao_fer_dom_p = 'S') then 
	CALL dl_gerar_itens_plantao_dom_fer(nr_seq_distribuicao_p,nm_usuario_p,cd_estabelecimento_p,vl_distribuicao_p,'DO');
end if;
 
if (ie_plantao_fer_sem_p = 'S') then 
	CALL dl_gerar_itens_plantao_dom_fer(nr_seq_distribuicao_p,nm_usuario_p,cd_estabelecimento_p,vl_distribuicao_p,'SE');
end if;
 
if (ie_plantao_fer_sab_p = 'S') then 
	CALL dl_gerar_itens_plantao_dom_fer(nr_seq_distribuicao_p,nm_usuario_p,cd_estabelecimento_p,vl_distribuicao_p,'SA');
end if;
 
if (ie_plantao_semana_p = 'S') then 
	CALL dl_gerar_itens_plantao_semana(nr_seq_distribuicao_p,nm_usuario_p,cd_estabelecimento_p,vl_distribuicao_p);	
end if;
 
if (ie_plantao_tarde_p = 'S') then 
	CALL dl_gerar_itens_plantao_tarde(nr_seq_distribuicao_p,nm_usuario_p,cd_estabelecimento_p,vl_distribuicao_p);	
end if;
 
if (ie_reuniao_p = 'S') then 
	CALL dl_gerar_itens_reuniao(nr_seq_distribuicao_p,nm_usuario_p, cd_estabelecimento_p,vl_distribuicao_p);	
end if;
 
if (ie_tempo_sociedade_p = 'S') then 
	CALL dl_gerar_itens_tempo_sociedade(nr_seq_distribuicao_p,nm_usuario_p,cd_estabelecimento_p,vl_distribuicao_p);		
end if;
 
if (ie_remun_exsocios_p = 'S') then 
	CALL dl_gerar_itens_remun_exsocios(nr_seq_distribuicao_p,nm_usuario_p,cd_estabelecimento_p,vl_distribuicao_p);		
end if;
 
if (ie_doacao_exsocios_p = 'S') then 
	CALL dl_gerar_itens_doacao_exsocios(nr_seq_distribuicao_p,nm_usuario_p,cd_estabelecimento_p,vl_distribuicao_p);		
end if;
 
/* atualiza os valores totais da distribuicao - vl_calculado */
 
select	coalesce(sum(a.vl_calculado),0) 
into STRICT	vl_total_distrib_w 
from	dl_distribuicao_item a 
where	a.nr_seq_distribuicao	= nr_seq_distribuicao_p;
 
update	dl_distribuicao 
set	vl_calculado	= vl_total_distrib_w 
where	nr_sequencia	= nr_seq_distribuicao_p;
 
/* atualiza os valores totais do lote - vl_calculado */
 
select	a.nr_seq_lote 
into STRICT	nr_seq_lote_w 
from 	dl_distribuicao a 
where	a.nr_sequencia	= nr_seq_distribuicao_p;
 
select	coalesce(sum(a.vl_calculado),0) 
into STRICT	vl_total_distrib_lote_w 
from	dl_distribuicao a 
where	a.nr_seq_lote	= nr_seq_lote_w;
 
update	dl_lote_distribuicao 
set	vl_calculado	= vl_total_distrib_lote_w 
where	nr_sequencia	= nr_seq_lote_w;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE dl_gerar_itens_distribuicao ( nr_seq_distribuicao_p bigint, nm_usuario_p text, ie_aneste_extra_p text, ie_aneste_plantao_p text, ie_aneste_manha_p text, ie_aneste_tarde_p text, ie_encargos_p text, ie_plantao_fer_dom_p text, ie_plantao_fer_sem_p text, ie_plantao_fer_sab_p text, ie_plantao_semana_p text, ie_plantao_tarde_p text, ie_reuniao_p text, ie_tempo_sociedade_p text, ie_remun_exsocios_p text, ie_doacao_exsocios_p text, cd_estabelecimento_p bigint, vl_distribuicao_p bigint) FROM PUBLIC;

