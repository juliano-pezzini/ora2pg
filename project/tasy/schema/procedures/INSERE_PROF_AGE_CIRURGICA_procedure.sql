-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insere_prof_age_cirurgica ( nr_sequencia_p bigint, nm_usuario_p text, ie_indicacao_p text, cd_profissional_p text, cd_funcao_p bigint, nr_seq_equip_p bigint, ie_type_insert_p text, ie_ins_anestesista_p text, ie_ins_cirurgiao_p text, ie_del_anestesista_p text, ie_del_cirurgiao_p text, ie_type_delete_p text, ie_table_p text) AS $body$
BEGIN

if (coalesce(ie_type_delete_p,'N') = 'S' and ie_table_p = 'SCHEDULE')then
	if (coalesce(ie_del_cirurgiao_p,'N') = 'S')then

		update	agenda_paciente
		set	cd_medico	 = NULL			
		where 	nr_sequencia 		= nr_sequencia_p;

	elsif ( coalesce(ie_del_anestesista_p,'N') = 'S')then

		update	agenda_paciente
		set	cd_anestesista	 = NULL			
		where 	nr_sequencia 	= nr_sequencia_p;
	end if;	

	delete
	from	profissional_agenda
	where 	cd_profissional = cd_profissional_p
	and	nr_seq_agenda 	= nr_sequencia_p;

	commit;
elsif (coalesce(ie_type_delete_p,'N') = 'S' and ie_table_p = 'WAIT_LIST')then
	if (coalesce(ie_del_cirurgiao_p,'N') = 'S')then

		update	agenda_lista_espera
		set	cd_medico	 = NULL			
		where 	nr_sequencia 		= nr_sequencia_p;

	elsif ( coalesce(ie_del_anestesista_p,'N') = 'S')then

		update	agenda_lista_espera
		set	cd_anestesista	 = NULL			
		where 	nr_sequencia 	= nr_sequencia_p;
	end if;	

	delete
	from	agenda_lista_espera_prof
	where 	cd_profissional = cd_profissional_p
	and	nr_seq_lista 	= nr_sequencia_p;

	commit;
end if;

if (coalesce(ie_type_insert_p,'N') = 'S' and ie_table_p = 'SCHEDULE')then
	if (coalesce(ie_ins_anestesista_p,'N') = 'S')then

		update	agenda_paciente
		set	cd_anestesista	= cd_profissional_p			
		where 	nr_sequencia 	= nr_sequencia_p;
		
	elsif (coalesce(ie_ins_cirurgiao_p,'N') = 'S')then

		update	agenda_paciente
		set	cd_medico	= cd_profissional_p			
		where 	nr_sequencia 	= nr_sequencia_p;
	end if;	
	
	insert
	into	profissional_agenda(
		nr_sequencia,
		nr_seq_agenda,
		nm_usuario,
		ie_indicacao,
		cd_profissional,
		cd_funcao,
		dt_atualizacao,
		nr_seq_equipe)
	values (nextval('profissional_agenda_seq'),
		nr_sequencia_p,
		nm_usuario_p,
		coalesce(ie_indicacao_p,'N'),
		cd_profissional_p,
		cd_funcao_p,
		clock_timestamp(),
		nr_seq_equip_p);			

	commit;
elsif (coalesce(ie_type_insert_p,'N') = 'S' and ie_table_p = 'WAIT_LIST')then
	if (coalesce(ie_ins_anestesista_p,'N') = 'S')then

		update	agenda_lista_espera
		set	cd_anestesista	= cd_profissional_p			
		where 	nr_sequencia 	= nr_sequencia_p;

	elsif (coalesce(ie_ins_cirurgiao_p,'N') = 'S')then

		update	agenda_lista_espera
		set	cd_medico	= cd_profissional_p			
		where 	nr_sequencia 	= nr_sequencia_p;
	end if;	

	insert
	into	agenda_lista_espera_prof(
		nr_sequencia,
		nr_seq_lista,
		nm_usuario,
		ie_indicacao,
		cd_profissional,
		cd_funcao,
		dt_atualizacao,
		nr_seq_equipe)
	values (nextval('agenda_lista_espera_prof_seq'),
		nr_sequencia_p,
		nm_usuario_p,
		coalesce(ie_indicacao_p,'N'),
		cd_profissional_p,
		cd_funcao_p,
		clock_timestamp(),
		nr_seq_equip_p);			

	commit;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insere_prof_age_cirurgica ( nr_sequencia_p bigint, nm_usuario_p text, ie_indicacao_p text, cd_profissional_p text, cd_funcao_p bigint, nr_seq_equip_p bigint, ie_type_insert_p text, ie_ins_anestesista_p text, ie_ins_cirurgiao_p text, ie_del_anestesista_p text, ie_del_cirurgiao_p text, ie_type_delete_p text, ie_table_p text) FROM PUBLIC;

