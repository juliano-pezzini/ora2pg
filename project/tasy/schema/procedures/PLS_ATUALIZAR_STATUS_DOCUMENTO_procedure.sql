-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_atualizar_status_documento ( nr_seq_documento_p bigint, ie_status_p text, cd_estabelecimento_p bigint, ds_observacao_p text, dt_retorno_p timestamp, cd_pessoa_fisica_retorno_p text, nm_usuario_p text) AS $body$
DECLARE


dt_retorno_w	timestamp;

BEGIN

dt_retorno_w	:= coalesce(dt_retorno_p,clock_timestamp());

if (ie_status_p = 'T')		and	-- tratamento para retorno de documento. Demitrius OS 421403
	(dt_retorno_w IS NOT NULL AND dt_retorno_w::text <> '')	then
	update	pls_documento
	set 	ie_status			= ie_status_p,
		ds_observacao			= ds_observacao_p,
		cd_pessoa_fisica_retorno	= cd_pessoa_fisica_retorno_p,
		dt_retorno_documento		= dt_retorno_w
	where 	nr_sequencia 			= nr_seq_documento_p;

end if;

update	pls_documento
set	ie_status	= ie_status_p
where	nr_sequencia	= nr_seq_documento_p;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_atualizar_status_documento ( nr_seq_documento_p bigint, ie_status_p text, cd_estabelecimento_p bigint, ds_observacao_p text, dt_retorno_p timestamp, cd_pessoa_fisica_retorno_p text, nm_usuario_p text) FROM PUBLIC;

