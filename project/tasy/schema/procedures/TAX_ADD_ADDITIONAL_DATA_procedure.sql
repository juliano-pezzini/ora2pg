-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE tax_add_additional_data ( sequence_p tax_certificate.nr_sequencia%type, dt_validity_p text, cd_version_p bigint, qt_size_p bigint, ds_owner text default null) AS $body$
DECLARE


cd_cnpj_w 	tax_certificate.cd_cnpj%type := null;
cd_cpf_w 	tax_certificate.cd_cpf%type := null;


BEGIN
	
	if (ds_owner IS NOT NULL AND ds_owner::text <> '') then
		if (length(ds_owner) < 14) then
			cd_cpf_w := ds_owner;
		else
			cd_cnpj_w := ds_owner;
		end if;
	end if;

	update 	tax_certificate
	set		dt_validity = to_date(dt_validity_p, 'yyyy-mm-dd hh24:mi:ss'),
			cd_version = cd_version_p,
			qt_size = qt_size_p,
			cd_cnpj = cd_cnpj_w,
			cd_cpf = cd_cpf_w
	where	nr_sequencia = sequence_p;
	commit;
	
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tax_add_additional_data ( sequence_p tax_certificate.nr_sequencia%type, dt_validity_p text, cd_version_p bigint, qt_size_p bigint, ds_owner text default null) FROM PUBLIC;

