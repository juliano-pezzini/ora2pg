-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_prot_cirurgia ( nr_seq_prot_cirurgia_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_seq_novo_prot_cirurgia_w	bigint;


BEGIN

select 	nextval('protocolo_cirurgia_seq')
into STRICT	nr_seq_novo_prot_cirurgia_w
;

/* Protocolo */

insert into protocolo_cirurgia(
	nr_sequencia,
	dt_atualizacao,
	nm_usuario,
	dt_atualizacao_nrec,
	nm_usuario_nrec,
	nm_protocolo,
	cd_estabelecimento,
	cd_medico,
	ds_protocolo,
	ie_situacao,
	nr_seq_proc_interno,
	ie_tipo_protocolo)
SELECT nr_seq_novo_prot_cirurgia_w,
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	wheb_mensagem_pck.get_texto(300337, 'NM_PROTOCOLO=' || substr(nm_protocolo,1,246)),
	cd_estabelecimento,
	cd_medico,
	ds_protocolo,
	ie_situacao,
	nr_seq_proc_interno,
	ie_tipo_protocolo
from	protocolo_cirurgia
where	nr_sequencia	= nr_seq_prot_cirurgia_p;


/* Posicao */

insert into protocolo_posicao(
	nr_sequencia,
	dt_atualizacao,
	nm_usuario,
	dt_atualizacao_nrec,
	nm_usuario_nrec,
	nr_seq_protocolo,
	ie_posicao)
SELECT nextval('protocolo_posicao_seq'),
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	nr_seq_novo_prot_cirurgia_w,
	ie_posicao	
from	protocolo_posicao
where	nr_seq_protocolo	= nr_seq_prot_cirurgia_p;

/* Equipamentos */

insert into protocolo_equipamento(
	nr_sequencia,
	dt_atualizacao,
	nm_usuario,
	dt_atualizacao_nrec,
	nm_usuario_nrec,
	nr_seq_protocolo,
	cd_equipamento,
	qt_equipamento,
	nr_seq_topografia)
SELECT nextval('protocolo_equipamento_seq'),
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	nr_seq_novo_prot_cirurgia_w,
	cd_equipamento,
	qt_equipamento,
	nr_seq_topografia
from	protocolo_equipamento
where	nr_seq_protocolo	= nr_seq_prot_cirurgia_p;

/* Tecnica anestesica */

insert into protocolo_tec_anestesica(
	nr_sequencia,
	dt_atualizacao,
	nm_usuario,
	dt_atualizacao_nrec,
	nm_usuario_nrec,
	nr_seq_protocolo,
	nr_seq_tecnica,
	ds_tecnica)
SELECT nextval('protocolo_tec_anestesica_seq'),
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	nr_seq_novo_prot_cirurgia_w,
	nr_seq_tecnica,
	ds_tecnica	
from	protocolo_tec_anestesica
where	nr_seq_protocolo	= nr_seq_prot_cirurgia_p;

/* Sinais vitais grafico */

insert into protocolo_sinal_vital(
	nr_sequencia,
	dt_atualizacao,
	nm_usuario,
	dt_atualizacao_nrec,
	nm_usuario_nrec,
	nr_seq_protocolo,
	nr_seq_sinal_vital)
SELECT nextval('protocolo_sinal_vital_seq'),
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	nr_seq_novo_prot_cirurgia_w,
	nr_seq_sinal_vital
from	protocolo_sinal_vital
where	nr_seq_protocolo	= nr_seq_prot_cirurgia_p;

/* Itens peroperatorios */

insert into protocolo_agent_anest(
	nr_sequencia,
	dt_atualizacao,
	nm_usuario,
	dt_atualizacao_nrec,
	nm_usuario_nrec,
	nr_seq_protocolo,
	nr_seq_material,
	ie_modo_registro,
	qt_velocidade_inf,
	qt_halog_ins,
	qt_dose_total,
	qt_dose,
	ie_aplic_bolus)
SELECT nextval('protocolo_agent_anest_seq'),
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	nr_seq_novo_prot_cirurgia_w,
	nr_seq_material,
	ie_modo_registro,
	qt_velocidade_inf,
	qt_halog_ins,
	qt_dose_total,
	qt_dose,
	ie_aplic_bolus
from	protocolo_agent_anest
where	nr_seq_protocolo	= nr_seq_prot_cirurgia_p;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_prot_cirurgia ( nr_seq_prot_cirurgia_p bigint, nm_usuario_p text) FROM PUBLIC;

