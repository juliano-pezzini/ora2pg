-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copia_parametro_setor_conv ( cd_conv_orig_p bigint, cd_setor_orig_p bigint, cd_setor_dest_p bigint, nm_tabela_p text, nm_usuario_p text, cd_estabelecimento_p bigint, ds_filtro_convenios_p text) AS $body$
DECLARE

									
nr_seq_pacote_mat_w		bigint;
nr_seq_pacote_proc_w		bigint;
nr_sequencia_mat_w		bigint;
nr_sequencia_proc_w		bigint;
ds_convenios_w			varchar(255);
ds_convenios_not_w		varchar(1);
cd_convenio_w			convenio.cd_convenio%type;

c001 CURSOR FOR
	SELECT  a.nr_seq_pacote,
		a.nr_sequencia
	from	pacote_material a,
		pacote b
	where	b.nr_seq_pacote   = a.nr_seq_pacote
	and	b.cd_convenio     = cd_conv_orig_p
	and	a.cd_setor_atendimento = cd_setor_orig_p;									
									
c002 CURSOR FOR
	SELECT  a.nr_seq_pacote,
		a.nr_sequencia
	from	pacote_procedimento a,
		pacote b
	where	b.nr_seq_pacote   = a.nr_seq_pacote
	and	b.cd_convenio     = cd_conv_orig_p
	and	a.cd_setor_atendimento = cd_setor_orig_p;
	
c003 CURSOR FOR
	SELECT	cd_convenio
	from	convenio
	where	1 = 1
	and (coalesce(ds_convenios_w::text, '') = '' or (ds_convenios_not_w = 'N' and (','||ds_convenios_w||',' like '%,'||to_char(cd_convenio)||',%')) or (ds_convenios_not_w = 'S' and not(','||ds_convenios_w||',' like '%,'||to_char(cd_convenio)||',%')))
	and	ie_situacao = 'A';


BEGIN
if (ds_filtro_convenios_p IS NOT NULL AND ds_filtro_convenios_p::text <> '') then
	if (position('not' in ds_filtro_convenios_p) = 1) then
		ds_convenios_w := substr(ds_filtro_convenios_p, 4);
		ds_convenios_not_w := 'S';
	else
		ds_convenios_w := ds_filtro_convenios_p;
		ds_convenios_not_w := 'N';
	end if;
	
	open c003;
	loop
	fetch c003 into	
		cd_convenio_w;
	EXIT WHEN NOT FOUND; /* apply on c003 */
		begin
		if (nm_tabela_p = 'REGRA_CONVENIO_PLANO') then
			insert into regra_convenio_plano(
				nr_sequencia,
				cd_convenio,
				cd_plano,
				ie_regra,
				dt_atualizacao,
				nm_usuario,
				ie_tipo_atendimento,
				cd_setor_atendimento,
				cd_area_procedimento,
				cd_especialidade_proc,
				cd_grupo_proc,
				cd_procedimento,
				ie_origem_proced,
				cd_tipo_acomodacao,
				ie_valor,
				qt_ponto_min,
				qt_ponto_max,
				ie_nova_autorizacao,
				nr_seq_proc_interno,
				ie_regra_valor,
				dt_inicio_vigencia,
				dt_fim_vigencia,
				nr_seq_grupo,
				nr_seq_subgrupo,
				nr_seq_forma_org,
				nr_seq_exame,
				cd_classif_setor,
				ie_clinica,
				ie_resp_autor,
				ie_autor_kit,
				ie_prioridade,
				ie_situacao,
				cd_doenca,
				nr_seq_classif_atend,
				cd_setor_entrega_prescr,
				cd_setor_atual,
				ie_carater_inter_sus,
				cd_empresa_conv,
				qt_minimo,
				qt_maximo,
				nr_seq_classif,
				ds_observacao,
				ds_mascara_carteira,
				cd_estabelecimento,
				cd_medico_executor,
				cd_especialidade_medic,
				ie_autor_particular,
				ie_qt_total_autor,
				ie_somente_item,
				ds_inconsist_prescr,
				qt_idade_min,
				qt_idade_max,
				nr_seq_cobertura,
				cd_perfil,
				cd_edicao_amb,
				nr_seq_classif_proc_int,
                cd_empresa)
			SELECT 	nextval('regra_convenio_plano_seq'),
				cd_convenio_w,
				cd_plano,
				ie_regra,
				clock_timestamp(),
				nm_usuario_p,
				ie_tipo_atendimento,
				cd_setor_dest_p,
				cd_area_procedimento,
				cd_especialidade_proc,
				cd_grupo_proc,
				cd_procedimento,
				ie_origem_proced,
				cd_tipo_acomodacao,
				ie_valor,
				qt_ponto_min,
				qt_ponto_max,
				ie_nova_autorizacao,
				nr_seq_proc_interno,
				ie_regra_valor,
				dt_inicio_vigencia,
				dt_fim_vigencia,
				nr_seq_grupo,
				nr_seq_subgrupo,
				nr_seq_forma_org,
				nr_seq_exame,
				cd_classif_setor,
				ie_clinica,
				 ie_resp_autor,
				ie_autor_kit,
				coalesce(ie_prioridade,'N'),
				coalesce(ie_situacao,'A'),
				cd_doenca,
				nr_seq_classif_atend,
				cd_setor_entrega_prescr,
				cd_setor_atual,
				ie_carater_inter_sus,
				cd_empresa_conv,
				qt_minimo,
				qt_maximo,
				nr_seq_classif,
				ds_observacao,
				ds_mascara_carteira,
				cd_estabelecimento,
				cd_medico_executor,
				cd_especialidade_medic,
				ie_autor_particular,
				ie_qt_total_autor,
				ie_somente_item,
				ds_inconsist_prescr,
				qt_idade_min,
				qt_idade_max,
				nr_seq_cobertura,
				cd_perfil,
				cd_edicao_amb,
				nr_seq_classif_proc_int,
                cd_empresa
			from 	regra_convenio_plano
			where 	cd_convenio = cd_conv_orig_p
			and   	cd_setor_atendimento = cd_setor_orig_p;
		end if;

			
			
		if (nm_tabela_p = 'REGRA_CONVENIO_PLANO_MAT') then		
			insert into regra_convenio_plano_mat(
				nr_sequencia, 			cd_convenio,			cd_plano,
				dt_atualizacao, 		nm_usuario,			ie_tipo_atendimento, 
				cd_setor_atendimento,		cd_grupo_material, 		cd_subgrupo_material,
				cd_classe_material, 		cd_material,			ie_valor, 
				vl_material_min, 		vl_material_max, 		cd_tipo_acomodacao,
				ie_autor_particular,		dt_inicio_vigencia, 		dt_fim_vigencia, 
				ie_nova_autorizacao, 		ds_mascara_carteira, 		cd_estabelecimento,
				cd_doenca, 			qt_minima, 			qt_maxima, 
				cd_empresa_conv, 		ie_gerar_mat_esp, 		ie_mat_conta, 
				ie_autor_kit,			ie_consignado, 			nr_seq_cobertura, 
				ie_clinica, 			ie_carater_inter_sus, 		cd_classif_setor, 
				ds_observacao,			ie_regra,			nr_seq_familia,
				ie_gerar_vl_zerado,		cd_categoria,			ie_valor_dia,
				ie_valor_unitario,		nr_seq_classif,			ie_resp_autor,
				cd_perfil,			ie_tipo_material,		ie_classificacao,
				nr_seq_estrutura,		ie_regra_quantidade_solic,  cd_material_estoque,
				ie_final_vig_dose_dia_prescr, ie_exige_just_medica, ie_tiss_tipo_anexo,
				ie_tiss_tipo_etapa_autor, cd_empresa)
			SELECT nextval('regra_convenio_plano_mat_seq'), cd_convenio_w,		check_if_plan_conv_compatible(cd_plano, cd_convenio_w), 
				clock_timestamp(), 			nm_usuario_p,			ie_tipo_atendimento, 
				cd_setor_dest_p,		cd_grupo_material, 		cd_subgrupo_material,
				cd_classe_material, 		cd_material,			ie_valor, 
				vl_material_min, 		vl_material_max, 		cd_tipo_acomodacao, 
				ie_autor_particular,		dt_inicio_vigencia, 		dt_fim_vigencia, 
				ie_nova_autorizacao, 		ds_mascara_carteira, 		cd_estabelecimento,
				cd_doenca, 			qt_minima, 			qt_maxima, 
				cd_empresa_conv, 		ie_gerar_mat_esp, 		ie_mat_conta, 	
				ie_autor_kit,			ie_consignado, 			nr_seq_cobertura, 
				ie_clinica, 			ie_carater_inter_sus, 		cd_classif_setor, 
				ds_observacao,			ie_regra,			nr_seq_familia,
				ie_gerar_vl_zerado,		check_if_categ_conv_compatible(cd_categoria, cd_convenio_w), ie_valor_dia,
				ie_valor_unitario,		nr_seq_classif,			ie_resp_autor,
				cd_perfil,			ie_tipo_material,		ie_classificacao,
				nr_seq_estrutura,		ie_regra_quantidade_solic,  cd_material_estoque,
				ie_final_vig_dose_dia_prescr, ie_exige_just_medica, ie_tiss_tipo_anexo,
				ie_tiss_tipo_etapa_autor, cd_empresa
			from 	regra_convenio_plano_mat
			where 	cd_convenio = cd_conv_orig_p
			and	cd_setor_atendimento = cd_setor_orig_p;
		end if;
		
		if (nm_tabela_p = 'CONVENIO_REGRA_QTDE_PROC') then	
			insert into convenio_regra_qtde_proc(
				nr_sequencia, cd_procedimento, ie_origem_proced,
				ie_tipo_qtde, qt_permitida, ie_acao_excesso,
				dt_atualizacao, nm_usuario, cd_convenio,
				ie_tipo_atendimento, qt_horas_intervalo,
				cd_setor_atendimento, cd_medico, ie_tipo_uso, cd_proced_referencia,
				ie_origem_proc_ref, pr_permitida, cd_area_procedimento, cd_especialidade,
				cd_grupo_proc, ie_via_acesso, nr_seq_grupo, nr_seq_subgrupo, nr_seq_forma_org, ie_complexidade, ie_tipo_financiamento, ie_tipo_setor,
				nr_seq_proc_interno, cd_categoria, cd_plano, ds_observacao, nr_seq_exame, ie_situacao, cd_estabelecimento, 
				qt_dias_inter_inicio, qt_dias_inter_final, cd_tipo_acomodacao, ds_mensagem, cd_convenio_excesso, cd_categoria_excesso, qt_ano_min, qt_ano_max,
				qt_ano_min_mes, qt_ano_min_dia, qt_ano_max_mes, qt_ano_max_dia, cd_perfil)
			SELECT  nextval('convenio_regra_qtde_proc_seq'),
				cd_procedimento, ie_origem_proced,
				ie_tipo_qtde, qt_permitida, ie_acao_excesso,
				clock_timestamp(), nm_usuario_p, cd_convenio_w,
				ie_tipo_atendimento, qt_horas_intervalo,
				cd_setor_dest_p, cd_medico, ie_tipo_uso, cd_proced_referencia,
				ie_origem_proc_ref, pr_permitida, cd_area_procedimento, cd_especialidade,
				cd_grupo_proc, ie_via_acesso, nr_seq_grupo, nr_seq_subgrupo, nr_seq_forma_org, ie_complexidade, ie_tipo_financiamento, ie_tipo_setor,
				nr_seq_proc_interno, null, cd_plano, ds_observacao, nr_seq_exame, ie_situacao, cd_estabelecimento, 
				qt_dias_inter_inicio, qt_dias_inter_final, cd_tipo_acomodacao, ds_mensagem, cd_convenio_excesso, null, qt_ano_min, qt_ano_max,
				qt_ano_min_mes, qt_ano_min_dia, qt_ano_max_mes, qt_ano_max_dia, cd_perfil
			from	convenio_regra_qtde_proc
			where 	cd_convenio = cd_conv_orig_p
			and	cd_setor_atendimento = cd_setor_orig_p;	
		end if;
		
		if (nm_tabela_p = 'CONV_REGRA_TAXA_REPOUSO') then	
			insert into CONV_REGRA_TAXA_REPOUSO(
							NR_SEQUENCIA,  CD_CONVENIO, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, NR_SEQ_PROC_INTERNO, 
							CD_UNIDADE_BASICA, CD_UNIDADE_COMPL, QT_TEMPO_MIN, QT_TEMPO_MAX, CD_PROCEDIMENTO, IE_ORIGEM_PROCED, CD_SETOR_ATENDIMENTO,
							IE_SITUACAO, QT_ITEM)
			SELECT nextval('conv_regra_taxa_repouso_seq'), cd_convenio_w, clock_timestamp(), nm_usuario_p, clock_timestamp(), nm_usuario_p, NR_SEQ_PROC_INTERNO, 
							CD_UNIDADE_BASICA, CD_UNIDADE_COMPL, QT_TEMPO_MIN, QT_TEMPO_MAX, CD_PROCEDIMENTO, IE_ORIGEM_PROCED, cd_setor_dest_p,
							IE_SITUACAO, QT_ITEM
			from 	CONV_REGRA_TAXA_REPOUSO
			where 	cd_convenio = cd_conv_orig_p
			and	cd_setor_atendimento = cd_setor_orig_p;	
		end if;
		
		if (nm_tabela_p = 'CONVERSAO_PROC_CONVENIO') then	
			insert into conversao_proc_convenio(  cd_proc_convenio,
				cd_area_proced,
				cd_especial_proced,
				cd_grupo_proced,
				cd_procedimento,
				ie_origem_proced,
				ds_proc_convenio,
				cd_grupo,
				tx_conversao_qtde,
				cd_unidade_convenio,
				ie_situacao,
				CD_ESPECIALIDADE_MEDICA,
				IE_TIPO_ATENDIMENTO,
				CD_SETOR_ATENDIMENTO,
				DT_DIA_SEMANA,
				IE_FERIADO,
				HR_INICIAL,     
				HR_FINAL,
				IE_PACOTE,
				ie_classif_acomod,
				nr_seq_proc_interno,
				dt_inicio_vigencia,
				dt_vigencia_final,
				cd_estabelecimento,
				ie_clinica,
				vl_proc_inicial,
				vl_proc_final,
				ie_funcao_medico,
				cd_tipo_acomodacao,
				cd_tipo_acomod_conv,
				qt_ano_min,
				qt_ano_max,
				qt_ano_min_mes,
				qt_ano_min_dia,
				qt_ano_max_mes,
				qt_ano_max_dia,
				ie_sexo,
				cd_empresa_ref,
				ie_carater_inter_sus,
				nr_seq_pacote,
				nr_seq_exame,
				ie_tipo_atend_tiss,
				cd_dependente,
				dt_atualizacao,
				nm_usuario,
				cd_convenio,
                                nr_proc_interno)
			SELECT 	cd_proc_convenio,
				cd_area_proced,
				cd_especial_proced,
				cd_grupo_proced,
				cd_procedimento,
				ie_origem_proced,
				ds_proc_convenio,
				cd_grupo,
				tx_conversao_qtde,
				cd_unidade_convenio,
				ie_situacao,
				CD_ESPECIALIDADE_MEDICA,
				IE_TIPO_ATENDIMENTO,
				cd_setor_dest_p,
				DT_DIA_SEMANA,
				IE_FERIADO,     
				HR_INICIAL,     
				HR_FINAL,
				IE_PACOTE,
				ie_classif_acomod,
				nr_seq_proc_interno,
				dt_inicio_vigencia,
				dt_vigencia_final,
				cd_estabelecimento,
				ie_clinica,
				vl_proc_inicial,
				vl_proc_final,
				ie_funcao_medico,
				cd_tipo_acomodacao,
				cd_tipo_acomod_conv,
				qt_ano_min,
				qt_ano_max,
				qt_ano_min_mes,
				qt_ano_min_dia,
				qt_ano_max_mes,
				qt_ano_max_dia,
				ie_sexo,
				cd_empresa_ref,
				ie_carater_inter_sus,
				nr_seq_pacote,
				nr_seq_exame,
				ie_tipo_atend_tiss,
				cd_dependente,
				clock_timestamp(),
				nm_usuario_p,
				cd_convenio_w,
                                nr_proc_interno
			from 	conversao_proc_convenio
			where 	cd_convenio = cd_conv_orig_p
			and	cd_setor_atendimento = cd_setor_orig_p;
		end if;
		
		if (nm_tabela_p = 'CONVERSAO_MATERIAL_CONVENIO') then		
			insert into conversao_material_convenio(cd_material_convenio,
				cd_grupo_material,
				cd_subgrupo_material,
				cd_classe_material,
				cd_material,
				ds_material_convenio,
				cd_grupo,
				tx_conversao_qtde,
				cd_unidade_convenio,
				dt_dia_semana,
				hr_inicial,
				hr_final,
				ie_feriado,
				ie_situacao,
				cd_cgc,
				ie_classif_acomod,
				cd_setor_atendimento,
				dt_inicio_vigencia,
				dt_final_vigencia,
				cd_estabelecimento,
				ie_tipo_material_conv,
				ie_tipo_atendimento,
				ie_origem_preco,
				cd_empresa_ref,
				ie_pacote,
				ie_carater_inter_sus,
				nr_seq_estrutura,
				nr_seq_marca,
				ie_tipo_atend_tiss,
				dt_atualizacao,
				nm_usuario,
				cd_convenio,
				nr_sequencia,
				ie_tipo_material,
                                nr_proc_interno)	
			SELECT	cd_material_convenio,
				cd_grupo_material,
				cd_subgrupo_material,
				cd_classe_material,
				cd_material,
				ds_material_convenio,
				cd_grupo,
				tx_conversao_qtde,
				cd_unidade_convenio,
				dt_dia_semana,
				hr_inicial,
				hr_final,
				ie_feriado,
				ie_situacao,
				cd_cgc,
				ie_classif_acomod,
				cd_setor_dest_p,
				dt_inicio_vigencia,
				dt_final_vigencia,
				cd_estabelecimento,
				ie_tipo_material_conv,
				ie_tipo_atendimento,
				ie_origem_preco,
				cd_empresa_ref,
				ie_pacote,
				ie_carater_inter_sus,
				nr_seq_estrutura,
				nr_seq_marca,
				ie_tipo_atend_tiss,
				clock_timestamp(),
				nm_usuario_p,
				cd_convenio_w,
				nextval('conversao_mat_convenio_seq'),
				ie_tipo_material,
                                nr_proc_interno
			from	conversao_material_convenio
			where	cd_convenio = cd_conv_orig_p
			and	cd_setor_atendimento = cd_setor_orig_p;
		end if;
		
		if (nm_tabela_p = 'COTACAO_MOEDA_CONVENIO') then	
			insert into cotacao_moeda_convenio(
				nr_sequencia, cd_estabelecimento,  cd_convenio,  cd_moeda,
				ie_previsto_realizado, 	dt_referencia, vl_honorarios, vl_custo_oper, vl_filme,
				dt_atualizacao, nm_usuario, cd_categoria, cd_area_proced, cd_especial_proced,
				cd_grupo_proced, cd_procedimento, ie_origem_proced, cd_setor_atendimento,
				ie_tipo_atendimento, ie_credenciado, cd_plano, 	ie_clinica, cd_empresa_ref,
				ds_regra_codigo, cd_edicao_amb, ie_situacao, nr_seq_proc_interno, nr_seq_grupo_lab,
				cd_tipo_acomodacao)
			SELECT	nextval('cotacao_moeda_convenio_seq'), cd_estabelecimento_p, cd_convenio_w,
				cd_moeda, ie_previsto_realizado, dt_referencia, vl_honorarios, vl_custo_oper,
				vl_filme, clock_timestamp(), nm_usuario_p, null, 	cd_area_proced, cd_especial_proced,
				cd_grupo_proced, cd_procedimento, ie_origem_proced, cd_setor_dest_p, ie_tipo_atendimento,
				ie_credenciado, cd_plano, ie_clinica, cd_empresa_ref, ds_regra_codigo, 	cd_edicao_amb,
				ie_situacao, nr_seq_proc_interno, nr_seq_grupo_lab, cd_tipo_acomodacao
			from 	cotacao_moeda_convenio
			where 	cd_convenio = cd_conv_orig_p
			and	cd_setor_atendimento = cd_setor_orig_p
			and	cd_estabelecimento = cd_estabelecimento_p;	
		end if;
		
		if (nm_tabela_p = 'REGRA_AJUSTE_PROC') then	
			insert into regra_ajuste_proc(
				nr_sequencia, 		cd_estabelecimento, 		cd_convenio, 		dt_inicio_vigencia,
				ie_situacao, 		dt_atualizacao, 		nm_usuario, 		cd_categoria,
				cd_edicao_amb,		cd_area_procedimento, 		cd_especialidade, 	cd_grupo_proc, 
				cd_procedimento,	ie_origem_proced, 		ie_preco_informado, 	vl_proc_ajustado, 
				ie_glosa,		cd_procedimento_esp, 		tx_ajuste, 		nr_seq_regra_preco, 
				dt_final_vigencia,	cd_tipo_acomodacao, 		ie_tipo_atendimento, 	cd_setor_atendimento,
				vl_medico, 		vl_custo_operacional, 		qt_filme, 		nr_auxiliares, 
				qt_porte_anestesico,	tx_ajuste_custo_oper, 		tx_ajuste_medico, 	tx_ajuste_filme, 
				ie_credenciado,		pr_glosa, 			cd_cid, 		qt_idade_min, 
				qt_idade_max, 		nr_seq_proc_interno,		nr_seq_exame, 		cd_plano, 
				ie_clinica, 		cd_empresa_ref, 		cd_motivo_exc_conta,	cd_medico, 
				ds_observacao, 		tx_ajuste_partic, 		vl_glosa, 		ie_sexo, 
				ie_atend_retorno,	ie_autor_particular, 		cd_equipamento,		cd_setor_atend_prescr, 	
				ie_ignora_ch_edicao_amb,ie_consiste_prescr,		ie_utiliza_video,	ie_spect,
				cd_especialidade_medica,cd_usuario_convenio,		qt_pos_inicial,		qt_pos_final,
				ie_edicao_convenio,	ie_prior_edicao_ajuste, 	cd_tabela_servico,	NR_SEQ_AREA_INT,
				NR_SEQ_ESPEC_INT,	NR_SEQ_GRUPO_INT,		cd_dependente,		nr_seq_origem,
				cd_convenio_glosa,	cd_categoria_glosa,		nr_seq_estrutura)
			SELECT	nextval('regra_ajuste_proc_seq'), 	cd_estabelecimento_p, 		cd_convenio_w, 	dt_inicio_vigencia,
				ie_situacao, 		clock_timestamp(), 			nm_usuario_p, 		null, 
				cd_edicao_amb, 		cd_area_procedimento,		cd_especialidade,  	cd_grupo_proc, 
				cd_procedimento, 	ie_origem_proced,		ie_preco_informado, 	vl_proc_ajustado, 
				ie_glosa, 		cd_procedimento_esp,		tx_ajuste, 		nr_seq_regra_preco, 
				dt_final_vigencia, 	cd_tipo_acomodacao,		ie_tipo_atendimento, 	cd_setor_dest_p, 
				vl_medico, 		vl_custo_operacional,		qt_filme, 		nr_auxiliares, 
				qt_porte_anestesico, 	tx_ajuste_custo_oper,		tx_ajuste_medico, 	tx_ajuste_filme, 
				ie_credenciado, 	pr_glosa,			cd_cid, 		qt_idade_min, 
				qt_idade_max, 		nr_seq_proc_interno, 		nr_seq_exame,		null, 	
				ie_clinica,  		cd_empresa_ref, 		cd_motivo_exc_conta, 	cd_medico,
				ds_observacao, 		tx_ajuste_partic, 		vl_glosa, 		ie_sexo, 
				ie_atend_retorno,	ie_autor_particular, 		cd_equipamento, 	cd_setor_atend_prescr, 	
				ie_ignora_ch_edicao_amb,ie_consiste_prescr,		ie_utiliza_video,	ie_spect,
				cd_especialidade_medica,cd_usuario_convenio,		qt_pos_inicial,		qt_pos_final,
				ie_edicao_convenio,	ie_prior_edicao_ajuste,		cd_tabela_servico,	NR_SEQ_AREA_INT,
				NR_SEQ_ESPEC_INT,	NR_SEQ_GRUPO_INT,		cd_dependente,		nr_seq_origem,
				cd_convenio_glosa,	cd_categoria_glosa,		nr_seq_estrutura
			from 	regra_ajuste_proc
			where 	cd_convenio = cd_conv_orig_p
			and	cd_estabelecimento = cd_estabelecimento_p
			and 	cd_setor_atendimento = cd_setor_orig_p
			and	((cd_procedimento IS NOT NULL AND cd_procedimento::text <> '') or (nr_seq_proc_interno IS NOT NULL AND nr_seq_proc_interno::text <> ''));	
		end if;

		if (nm_tabela_p = 'CONVENIO_REGRA_QTDE') then				
			insert into convenio_regra_qtde(
				nr_sequencia, cd_estabelecimento, cd_convenio,
				dt_atualizacao, nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec,
				cd_procedimento, ie_origem_proced, cd_area_procedimento, cd_especialidade,
				cd_grupo_proc, ie_regra_execucao, nr_seq_proc_interno, 	dt_vigencia, qt_min_regra_per, cd_setor_atendimento,
				ie_regra_valor, ie_lado, cd_edicao_amb, ie_responsavel_credito, ie_tipo_atendimento, ie_tipo_guia, cd_cgc_prestador,
				cd_medico_executor, ie_via_acesso, ie_situacao, ie_tipo_data, cd_tipo_procedimento)
			SELECT	nextval('convenio_regra_qtde_seq'), cd_estabelecimento_p, cd_convenio_w, 
				clock_timestamp(), nm_usuario_p, clock_timestamp(), nm_usuario_p, cd_procedimento, ie_origem_proced,
				cd_area_procedimento, cd_especialidade, cd_grupo_proc, ie_regra_execucao,
				nr_seq_proc_interno, dt_vigencia, qt_min_regra_per, cd_setor_dest_p,
				ie_regra_valor, ie_lado, cd_edicao_amb, ie_responsavel_credito, ie_tipo_atendimento, ie_tipo_guia, cd_cgc_prestador,
				cd_medico_executor, ie_via_acesso, coalesce(ie_situacao,'A'), ie_tipo_data, cd_tipo_procedimento
			from 	convenio_regra_qtde
			where 	cd_convenio = cd_conv_orig_p
			and	cd_estabelecimento = cd_estabelecimento_p
			and 	cd_setor_atendimento = cd_setor_orig_p;	
		end if;			

		if (nm_tabela_p = 'REGRA_AJUSTE_MATERIAL') then		
			insert	into regra_ajuste_material(
				nr_sequencia, dt_inicio_vigencia, ie_situacao, 	cd_categoria, cd_grupo_material,
				cd_subgrupo_material, cd_classe_material, cd_material, tx_ajuste, vl_negociado,
				ie_preco_informado, ie_glosa, tx_brasindice_pfb, tx_brasindice_pmc,
				tx_afaturar, dt_final_vigencia, cd_tipo_acomodacao, ie_tipo_atendimento,
				cd_setor_atendimento, qt_idade_min, qt_idade_max, tx_simpro_pfb, tx_simpro_pmc,
				ie_origem_preco, ie_precedencia_preco, pr_glosa, ie_tipo_material, tx_pmc_neg,
				tx_pmc_pos, cd_cid, cd_tabela_preco, cd_motivo_exc_conta, cd_estabelecimento,
				cd_convenio,dt_atualizacao,nm_usuario, ie_sexo, ie_autor_particular, ie_kit_material, cd_kit_material,
				tx_pfb_neg, tx_pfb_pos, nr_seq_estrutura, cd_tipo_baixa, ie_clinica, cd_convenio_glosa, cd_categoria_glosa,
				ie_tipo_preco_autor)
			SELECT nextval('regra_ajuste_material_seq'), dt_inicio_vigencia, ie_situacao, 	null, cd_grupo_material,
				cd_subgrupo_material, cd_classe_material, cd_material, tx_ajuste, vl_negociado,
				ie_preco_informado, ie_glosa, tx_brasindice_pfb, tx_brasindice_pmc,
				tx_afaturar, dt_final_vigencia, cd_tipo_acomodacao, ie_tipo_atendimento,
				cd_setor_dest_p, qt_idade_min, qt_idade_max, tx_simpro_pfb, tx_simpro_pmc,
				ie_origem_preco, ie_precedencia_preco, pr_glosa, ie_tipo_material, tx_pmc_neg,
				tx_pmc_pos, cd_cid, cd_tabela_preco, cd_motivo_exc_conta, cd_estabelecimento,
				cd_convenio_w,clock_timestamp(),nm_usuario_p, ie_sexo, ie_autor_particular, ie_kit_material, cd_kit_material,
				tx_pfb_neg, tx_pfb_pos, nr_seq_estrutura, cd_tipo_baixa, ie_clinica, cd_convenio_glosa, cd_categoria_glosa,
				ie_tipo_preco_autor
			from 	regra_ajuste_material
			where 	cd_convenio = cd_conv_orig_p
			and	cd_estabelecimento = cd_estabelecimento_p
			and 	cd_setor_atendimento = cd_setor_orig_p;	
		end if;
		end;
	end loop;
	close c003;
else
	/*ds_convenios_w := null;
	ds_convenios_not_w := null;	*/
	
	if (nm_tabela_p = 'REGRA_CONVENIO_PLANO') then
			insert into regra_convenio_plano(
				nr_sequencia,
				cd_convenio,
				cd_plano,
				ie_regra,
				dt_atualizacao,
				nm_usuario,
				ie_tipo_atendimento,
				cd_setor_atendimento,
				cd_area_procedimento,
				cd_especialidade_proc,
				cd_grupo_proc,
				cd_procedimento,
				ie_origem_proced,
				cd_tipo_acomodacao,
				ie_valor,
				qt_ponto_min,
				qt_ponto_max,
				ie_nova_autorizacao,
				nr_seq_proc_interno,
				ie_regra_valor,
				dt_inicio_vigencia,
				dt_fim_vigencia,
				nr_seq_grupo,
				nr_seq_subgrupo,
				nr_seq_forma_org,
				nr_seq_exame,
				cd_classif_setor,
				ie_clinica,
				ie_resp_autor,
				ie_autor_kit,
				ie_prioridade,
				ie_situacao,
				cd_doenca,
				nr_seq_classif_atend,
				cd_setor_entrega_prescr,
				cd_setor_atual,
				ie_carater_inter_sus,
				cd_empresa_conv,
				qt_minimo,
				qt_maximo,
				nr_seq_classif,
				ds_observacao,
				ds_mascara_carteira,
				cd_estabelecimento,
				cd_medico_executor,
				cd_especialidade_medic,
				ie_autor_particular,
				ie_qt_total_autor,
				ie_somente_item,
				ds_inconsist_prescr,
				qt_idade_min,
				qt_idade_max,
				nr_seq_cobertura,
				cd_perfil,
				cd_edicao_amb,
				nr_seq_classif_proc_int,
                cd_empresa)
			SELECT 	nextval('regra_convenio_plano_seq'),
				cd_convenio,
				cd_plano,
				ie_regra,
				clock_timestamp(),
				nm_usuario_p,
				ie_tipo_atendimento,
				cd_setor_dest_p,
				cd_area_procedimento,
				cd_especialidade_proc,
				cd_grupo_proc,
				cd_procedimento,
				ie_origem_proced,
				cd_tipo_acomodacao,
				ie_valor,
				qt_ponto_min,
				qt_ponto_max,
				ie_nova_autorizacao,
				nr_seq_proc_interno,
				ie_regra_valor,
				dt_inicio_vigencia,
				dt_fim_vigencia,
				nr_seq_grupo,
				nr_seq_subgrupo,
				nr_seq_forma_org,
				nr_seq_exame,
				cd_classif_setor,
				ie_clinica,
				 ie_resp_autor,
				ie_autor_kit,
				coalesce(ie_prioridade,'N'),
				coalesce(ie_situacao,'A'),
				cd_doenca,
				nr_seq_classif_atend,
				cd_setor_entrega_prescr,
				cd_setor_atual,
				ie_carater_inter_sus,
				cd_empresa_conv,
				qt_minimo,
				qt_maximo,
				nr_seq_classif,
				ds_observacao,
				ds_mascara_carteira,
				cd_estabelecimento,
				cd_medico_executor,
				cd_especialidade_medic,
				ie_autor_particular,
				ie_qt_total_autor,
				ie_somente_item,
				ds_inconsist_prescr,
				qt_idade_min,
				qt_idade_max,
				nr_seq_cobertura,
				cd_perfil,
				cd_edicao_amb,
				nr_seq_classif_proc_int,
                cd_empresa
			from regra_convenio_plano
			where cd_convenio = cd_conv_orig_p
			and   cd_setor_atendimento = cd_setor_orig_p;
		end if;

		
		
	if (nm_tabela_p = 'REGRA_CONVENIO_PLANO_MAT') then		
	insert into regra_convenio_plano_mat(
		nr_sequencia, 			cd_convenio,			cd_plano,
		dt_atualizacao, 		nm_usuario,			ie_tipo_atendimento, 
		cd_setor_atendimento,		cd_grupo_material, 		cd_subgrupo_material,
		cd_classe_material, 		cd_material,			ie_valor, 
		vl_material_min, 		vl_material_max, 		cd_tipo_acomodacao,
		ie_autor_particular,		dt_inicio_vigencia, 		dt_fim_vigencia, 
		ie_nova_autorizacao, 		ds_mascara_carteira, 		cd_estabelecimento,
		cd_doenca, 			qt_minima, 			qt_maxima, 
		cd_empresa_conv, 		ie_gerar_mat_esp, 		ie_mat_conta, 
		ie_autor_kit,			ie_consignado, 			nr_seq_cobertura, 
		ie_clinica, 			ie_carater_inter_sus, 		cd_classif_setor, 
		ds_observacao,			ie_regra,			nr_seq_familia,
		ie_gerar_vl_zerado,		cd_categoria,			ie_valor_dia,
		ie_valor_unitario,		nr_seq_classif,			ie_resp_autor,
		cd_perfil,			ie_tipo_material, 			ie_classificacao,
		nr_seq_estrutura,		ie_regra_quantidade_solic,  cd_material_estoque,
		ie_final_vig_dose_dia_prescr, ie_exige_just_medica, ie_tiss_tipo_anexo,
		ie_tiss_tipo_etapa_autor, cd_empresa)
	SELECT nextval('regra_convenio_plano_mat_seq'), cd_convenio,	check_if_plan_conv_compatible(cd_plano, cd_convenio), 
		clock_timestamp(), 			nm_usuario_p,			ie_tipo_atendimento, 
		cd_setor_dest_p,		cd_grupo_material, 		cd_subgrupo_material,
		cd_classe_material, 		cd_material,			ie_valor, 
		vl_material_min, 		vl_material_max, 		cd_tipo_acomodacao, 
		ie_autor_particular,		dt_inicio_vigencia, 		dt_fim_vigencia, 
		ie_nova_autorizacao, 		ds_mascara_carteira, 		cd_estabelecimento,
		cd_doenca, 			qt_minima, 			qt_maxima, 
		cd_empresa_conv, 		ie_gerar_mat_esp, 		ie_mat_conta, 	
		ie_autor_kit,			ie_consignado, 			nr_seq_cobertura, 
		ie_clinica, 			ie_carater_inter_sus, 		cd_classif_setor, 
		ds_observacao,			ie_regra,			nr_seq_familia,
		ie_gerar_vl_zerado,		check_if_categ_conv_compatible(cd_categoria, cd_convenio), ie_valor_dia,
		ie_valor_unitario,		nr_seq_classif,			ie_resp_autor,
		cd_perfil,			ie_tipo_material,			ie_classificacao,
		nr_seq_estrutura,		ie_regra_quantidade_solic,  cd_material_estoque,
		ie_final_vig_dose_dia_prescr, ie_exige_just_medica, ie_tiss_tipo_anexo,
		ie_tiss_tipo_etapa_autor, cd_empresa
	from regra_convenio_plano_mat
	where cd_convenio = cd_conv_orig_p
	and	  cd_setor_atendimento = cd_setor_orig_p;
	end if;
	
	if (nm_tabela_p = 'CONVENIO_REGRA_QTDE_PROC') then	
	insert into convenio_regra_qtde_proc(
		nr_sequencia, cd_procedimento, ie_origem_proced,
		ie_tipo_qtde, qt_permitida, ie_acao_excesso,
		dt_atualizacao, nm_usuario, cd_convenio,
		ie_tipo_atendimento, qt_horas_intervalo,
		cd_setor_atendimento, cd_medico, ie_tipo_uso, cd_proced_referencia,
		ie_origem_proc_ref, pr_permitida, cd_area_procedimento, cd_especialidade,
		cd_grupo_proc, ie_via_acesso, nr_seq_grupo, nr_seq_subgrupo, nr_seq_forma_org, ie_complexidade, ie_tipo_financiamento, ie_tipo_setor,
		nr_seq_proc_interno, cd_categoria, cd_plano, ds_observacao, nr_seq_exame, ie_situacao, cd_estabelecimento, 
		qt_dias_inter_inicio, qt_dias_inter_final, cd_tipo_acomodacao, ds_mensagem, cd_convenio_excesso, cd_categoria_excesso, qt_ano_min, qt_ano_max,
		qt_ano_min_mes, qt_ano_min_dia, qt_ano_max_mes, qt_ano_max_dia, cd_perfil)
	SELECT  nextval('convenio_regra_qtde_proc_seq'),
		cd_procedimento, ie_origem_proced,
		ie_tipo_qtde, qt_permitida, ie_acao_excesso,
		clock_timestamp(), nm_usuario_p, cd_convenio,
		ie_tipo_atendimento, qt_horas_intervalo,
		cd_setor_dest_p, cd_medico, ie_tipo_uso, cd_proced_referencia,
		ie_origem_proc_ref, pr_permitida, cd_area_procedimento, cd_especialidade,
		cd_grupo_proc, ie_via_acesso, nr_seq_grupo, nr_seq_subgrupo, nr_seq_forma_org, ie_complexidade, ie_tipo_financiamento, ie_tipo_setor,
		nr_seq_proc_interno, cd_categoria, cd_plano, ds_observacao, nr_seq_exame, ie_situacao, cd_estabelecimento, 
		qt_dias_inter_inicio, qt_dias_inter_final, cd_tipo_acomodacao, ds_mensagem, cd_convenio_excesso, cd_categoria_excesso, qt_ano_min, qt_ano_max,
		qt_ano_min_mes, qt_ano_min_dia, qt_ano_max_mes, qt_ano_max_dia, cd_perfil
	from	convenio_regra_qtde_proc
	where 	cd_convenio = cd_conv_orig_p
	and		cd_setor_atendimento = cd_setor_orig_p;	
	end if;
	
	if (nm_tabela_p = 'CONV_REGRA_TAXA_REPOUSO') then	
	insert into CONV_REGRA_TAXA_REPOUSO(
					NR_SEQUENCIA,  CD_CONVENIO, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, NR_SEQ_PROC_INTERNO, 
					CD_UNIDADE_BASICA, CD_UNIDADE_COMPL, QT_TEMPO_MIN, QT_TEMPO_MAX, CD_PROCEDIMENTO, IE_ORIGEM_PROCED, CD_SETOR_ATENDIMENTO,
					IE_SITUACAO, QT_ITEM)
	SELECT nextval('conv_regra_taxa_repouso_seq'), cd_convenio, clock_timestamp(), nm_usuario_p, clock_timestamp(), nm_usuario_p, NR_SEQ_PROC_INTERNO, 
					CD_UNIDADE_BASICA, CD_UNIDADE_COMPL, QT_TEMPO_MIN, QT_TEMPO_MAX, CD_PROCEDIMENTO, IE_ORIGEM_PROCED, cd_setor_dest_p,
					IE_SITUACAO, QT_ITEM
	from 	CONV_REGRA_TAXA_REPOUSO
	where cd_convenio = cd_conv_orig_p
	and	cd_setor_atendimento = cd_setor_orig_p;	
	end if;
	
	if (nm_tabela_p = 'CONVERSAO_PROC_CONVENIO') then	
	insert into conversao_proc_convenio(  cd_proc_convenio,
		cd_area_proced,
		cd_especial_proced,
		cd_grupo_proced,
		cd_procedimento,
		ie_origem_proced,
		ds_proc_convenio,
		cd_grupo,
		tx_conversao_qtde,
		cd_unidade_convenio,
		ie_situacao,
  		CD_ESPECIALIDADE_MEDICA,
		IE_TIPO_ATENDIMENTO,
		CD_SETOR_ATENDIMENTO,
		DT_DIA_SEMANA,
		IE_FERIADO,
		HR_INICIAL,     
		HR_FINAL,
		IE_PACOTE,
		ie_classif_acomod,
		nr_seq_proc_interno,
		dt_inicio_vigencia,
		dt_vigencia_final,
		cd_estabelecimento,
		ie_clinica,
		vl_proc_inicial,
		vl_proc_final,
		ie_funcao_medico,
		cd_tipo_acomodacao,
		cd_tipo_acomod_conv,
		qt_ano_min,
		qt_ano_max,
		qt_ano_min_mes,
		qt_ano_min_dia,
		qt_ano_max_mes,
		qt_ano_max_dia,
		ie_sexo,
		cd_empresa_ref,
		ie_carater_inter_sus,
		nr_seq_pacote,
		nr_seq_exame,
		ie_tipo_atend_tiss,
		cd_dependente,
		dt_atualizacao,
		nm_usuario,
                nr_proc_interno)
	SELECT cd_proc_convenio,
		cd_area_proced,
		cd_especial_proced,
		cd_grupo_proced,
		cd_procedimento,
		ie_origem_proced,
		ds_proc_convenio,
		cd_grupo,
		tx_conversao_qtde,
		cd_unidade_convenio,
		ie_situacao,
  		CD_ESPECIALIDADE_MEDICA,
		IE_TIPO_ATENDIMENTO,
		cd_setor_dest_p,
		DT_DIA_SEMANA,
		IE_FERIADO,     
		HR_INICIAL,     
		HR_FINAL,
		IE_PACOTE,
		ie_classif_acomod,
		nr_seq_proc_interno,
		dt_inicio_vigencia,
		dt_vigencia_final,
		cd_estabelecimento,
		ie_clinica,
		vl_proc_inicial,
		vl_proc_final,
		ie_funcao_medico,
		cd_tipo_acomodacao,
		cd_tipo_acomod_conv,
		qt_ano_min,
		qt_ano_max,
		qt_ano_min_mes,
		qt_ano_min_dia,
		qt_ano_max_mes,
		qt_ano_max_dia,
		ie_sexo,
		cd_empresa_ref,
		ie_carater_inter_sus,
		nr_seq_pacote,
		nr_seq_exame,
		ie_tipo_atend_tiss,
		cd_dependente,
		clock_timestamp(),
		nm_usuario_p,
                nr_proc_interno
	from conversao_proc_convenio
	where cd_convenio = cd_conv_orig_p
	and	cd_setor_atendimento = cd_setor_orig_p;	
	end if;
	
	if (nm_tabela_p = 'CONVERSAO_MATERIAL_CONVENIO') then		
	insert into conversao_material_convenio(cd_material_convenio,
		cd_grupo_material,
		cd_subgrupo_material,
		cd_classe_material,
		cd_material,
		ds_material_convenio,
		cd_grupo,
		tx_conversao_qtde,
		cd_unidade_convenio,
		dt_dia_semana,
		hr_inicial,
		hr_final,
		ie_feriado,
		ie_situacao,
		cd_cgc,
		ie_classif_acomod,
		cd_setor_atendimento,
		dt_inicio_vigencia,
		dt_final_vigencia,
		cd_estabelecimento,
		ie_tipo_material_conv,
		ie_tipo_atendimento,
		ie_origem_preco,
		cd_empresa_ref,
		ie_pacote,
		ie_carater_inter_sus,
		nr_seq_estrutura,
		nr_seq_marca,
		ie_tipo_atend_tiss,
		dt_atualizacao,
		nm_usuario,
		nr_sequencia,
		ie_tipo_material,
		ie_tipo_preco_autor,
                nr_proc_interno)	
	SELECT	cd_material_convenio,
		cd_grupo_material,
		cd_subgrupo_material,
		cd_classe_material,
		cd_material,
		ds_material_convenio,
		cd_grupo,
		tx_conversao_qtde,
		cd_unidade_convenio,
		dt_dia_semana,
		hr_inicial,
		hr_final,
		ie_feriado,
		ie_situacao,
		cd_cgc,
		ie_classif_acomod,
		cd_setor_dest_p,
		dt_inicio_vigencia,
		dt_final_vigencia,
		cd_estabelecimento,
		ie_tipo_material_conv,
		ie_tipo_atendimento,
		ie_origem_preco,
		cd_empresa_ref,
		ie_pacote,
		ie_carater_inter_sus,
		nr_seq_estrutura,
		nr_seq_marca,
		ie_tipo_atend_tiss,
		clock_timestamp(),
		nm_usuario_p,
		nextval('conversao_mat_convenio_seq'),
		ie_tipo_material,
		ie_tipo_preco_autor,
                nr_proc_interno
	from	conversao_material_convenio
	where	cd_convenio = cd_conv_orig_p
	and	cd_setor_atendimento = cd_setor_orig_p;
	end if;
	
	if (nm_tabela_p = 'COTACAO_MOEDA_CONVENIO') then	
	insert into cotacao_moeda_convenio(
		nr_sequencia, cd_estabelecimento,  cd_convenio,  cd_moeda,
		ie_previsto_realizado, 	dt_referencia, vl_honorarios, vl_custo_oper, vl_filme,
		dt_atualizacao, nm_usuario, cd_categoria, cd_area_proced, cd_especial_proced,
		cd_grupo_proced, cd_procedimento, ie_origem_proced, cd_setor_atendimento,
		ie_tipo_atendimento, ie_credenciado, cd_plano, 	ie_clinica, cd_empresa_ref,
		ds_regra_codigo, cd_edicao_amb, ie_situacao, nr_seq_proc_interno, nr_seq_grupo_lab,
		cd_tipo_acomodacao)
	SELECT	nextval('cotacao_moeda_convenio_seq'), cd_estabelecimento_p, cd_convenio,
		cd_moeda, ie_previsto_realizado, dt_referencia, vl_honorarios, vl_custo_oper,
		vl_filme, clock_timestamp(), nm_usuario_p, cd_categoria, 	cd_area_proced, cd_especial_proced,
		cd_grupo_proced, cd_procedimento, ie_origem_proced, cd_setor_dest_p, ie_tipo_atendimento,
		ie_credenciado, cd_plano, ie_clinica, cd_empresa_ref, ds_regra_codigo, 	cd_edicao_amb,
		ie_situacao, nr_seq_proc_interno, nr_seq_grupo_lab, cd_tipo_acomodacao
	from 	cotacao_moeda_convenio
	where 	cd_convenio = cd_conv_orig_p
	and	cd_setor_atendimento = cd_setor_orig_p
	and	cd_estabelecimento = cd_estabelecimento_p;	
	end if;
	
		if (nm_tabela_p = 'REGRA_AJUSTE_PROC') then	
				insert into regra_ajuste_proc(
					nr_sequencia, 		cd_estabelecimento, 		cd_convenio, 		dt_inicio_vigencia,
					ie_situacao, 		dt_atualizacao, 		nm_usuario, 		cd_categoria,
					cd_edicao_amb,		cd_area_procedimento, 		cd_especialidade, 	cd_grupo_proc, 
					cd_procedimento,	ie_origem_proced, 		ie_preco_informado, 	vl_proc_ajustado, 
					ie_glosa,		cd_procedimento_esp, 		tx_ajuste, 		nr_seq_regra_preco, 
					dt_final_vigencia,	cd_tipo_acomodacao, 		ie_tipo_atendimento, 	cd_setor_atendimento,
					vl_medico, 		vl_custo_operacional, 		qt_filme, 		nr_auxiliares, 
					qt_porte_anestesico,	tx_ajuste_custo_oper, 		tx_ajuste_medico, 	tx_ajuste_filme, 
					ie_credenciado,		pr_glosa, 			cd_cid, 		qt_idade_min, 
					qt_idade_max, 		nr_seq_proc_interno,		nr_seq_exame, 		cd_plano, 
					ie_clinica, 		cd_empresa_ref, 		cd_motivo_exc_conta,	cd_medico, 
					ds_observacao, 		tx_ajuste_partic, 		vl_glosa, 		ie_sexo, 
					ie_atend_retorno,	ie_autor_particular, 		cd_equipamento,		cd_setor_atend_prescr, 	
					ie_ignora_ch_edicao_amb,ie_consiste_prescr,		ie_utiliza_video,	ie_spect,
					cd_especialidade_medica,cd_usuario_convenio,		qt_pos_inicial,		qt_pos_final,
					ie_edicao_convenio,	ie_prior_edicao_ajuste, 	cd_tabela_servico,	NR_SEQ_AREA_INT,
					NR_SEQ_ESPEC_INT,	NR_SEQ_GRUPO_INT,		cd_dependente,		nr_seq_origem,
					cd_convenio_glosa,	cd_categoria_glosa,		nr_seq_estrutura)
				SELECT	nextval('regra_ajuste_proc_seq'), 	cd_estabelecimento_p, 		cd_convenio, 	dt_inicio_vigencia,
					ie_situacao, 		clock_timestamp(), 			nm_usuario_p, 		null, 
					cd_edicao_amb, 		cd_area_procedimento,		cd_especialidade,  	cd_grupo_proc, 
					cd_procedimento, 	ie_origem_proced,		ie_preco_informado, 	vl_proc_ajustado, 
					ie_glosa, 		cd_procedimento_esp,		tx_ajuste, 		nr_seq_regra_preco, 
					dt_final_vigencia, 	cd_tipo_acomodacao,		ie_tipo_atendimento, 	cd_setor_dest_p, 
					vl_medico, 		vl_custo_operacional,		qt_filme, 		nr_auxiliares, 
					qt_porte_anestesico, 	tx_ajuste_custo_oper,		tx_ajuste_medico, 	tx_ajuste_filme, 
					ie_credenciado, 	pr_glosa,			cd_cid, 		qt_idade_min, 
					qt_idade_max, 		nr_seq_proc_interno, 		nr_seq_exame,		null, 	
					ie_clinica,  		cd_empresa_ref, 		cd_motivo_exc_conta, 	cd_medico,
					ds_observacao, 		tx_ajuste_partic, 		vl_glosa, 		ie_sexo, 
					ie_atend_retorno,	ie_autor_particular, 		cd_equipamento, 	cd_setor_atend_prescr, 	
					ie_ignora_ch_edicao_amb,ie_consiste_prescr,		ie_utiliza_video,	ie_spect,
					cd_especialidade_medica,cd_usuario_convenio,		qt_pos_inicial,		qt_pos_final,
					ie_edicao_convenio,	ie_prior_edicao_ajuste,		cd_tabela_servico,	NR_SEQ_AREA_INT,
					NR_SEQ_ESPEC_INT,	NR_SEQ_GRUPO_INT,		cd_dependente, 		nr_seq_origem,
					cd_convenio_glosa,	cd_categoria_glosa,		nr_seq_estrutura
				from 	regra_ajuste_proc
				where 	cd_convenio = cd_conv_orig_p
				and	cd_estabelecimento = cd_estabelecimento_p
				and cd_setor_atendimento = cd_setor_orig_p
				and	((cd_procedimento IS NOT NULL AND cd_procedimento::text <> '') or (nr_seq_proc_interno IS NOT NULL AND nr_seq_proc_interno::text <> ''));	
		end if;

	if (nm_tabela_p = 'CONVENIO_REGRA_QTDE') then				
				insert into convenio_regra_qtde(
					nr_sequencia, cd_estabelecimento, cd_convenio,
					dt_atualizacao, nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec,
					cd_procedimento, ie_origem_proced, cd_area_procedimento, cd_especialidade,
					cd_grupo_proc, ie_regra_execucao, nr_seq_proc_interno, 	dt_vigencia, qt_min_regra_per, cd_setor_atendimento,
					ie_regra_valor, ie_lado, cd_edicao_amb, ie_responsavel_credito, ie_tipo_atendimento, ie_tipo_guia, cd_cgc_prestador,
					cd_medico_executor, ie_via_acesso, ie_situacao, ie_tipo_data, cd_tipo_procedimento)
				SELECT	nextval('convenio_regra_qtde_seq'), cd_estabelecimento_p, cd_convenio, 
					clock_timestamp(), nm_usuario_p, clock_timestamp(), nm_usuario_p, cd_procedimento, ie_origem_proced,
					cd_area_procedimento, cd_especialidade, cd_grupo_proc, ie_regra_execucao,
					nr_seq_proc_interno, dt_vigencia, qt_min_regra_per, cd_setor_dest_p,
					ie_regra_valor, ie_lado, cd_edicao_amb, ie_responsavel_credito, ie_tipo_atendimento, ie_tipo_guia, cd_cgc_prestador,
					cd_medico_executor, ie_via_acesso, coalesce(ie_situacao,'A'), ie_tipo_data, cd_tipo_procedimento
				from 	convenio_regra_qtde
				where 	cd_convenio = cd_conv_orig_p
				and	cd_estabelecimento = cd_estabelecimento_p
				and 	cd_setor_atendimento = cd_setor_orig_p;	
	end if;			

	if (nm_tabela_p = 'REGRA_AJUSTE_MATERIAL') then		
			insert	into regra_ajuste_material(
				nr_sequencia, dt_inicio_vigencia, ie_situacao, 	cd_categoria, cd_grupo_material,
				cd_subgrupo_material, cd_classe_material, cd_material, tx_ajuste, vl_negociado,
				ie_preco_informado, ie_glosa, tx_brasindice_pfb, tx_brasindice_pmc,
				tx_afaturar, dt_final_vigencia, cd_tipo_acomodacao, ie_tipo_atendimento,
				cd_setor_atendimento, qt_idade_min, qt_idade_max, tx_simpro_pfb, tx_simpro_pmc,
				ie_origem_preco, ie_precedencia_preco, pr_glosa, ie_tipo_material, tx_pmc_neg,
				tx_pmc_pos, cd_cid, cd_tabela_preco, cd_motivo_exc_conta, cd_estabelecimento,
				cd_convenio,dt_atualizacao,nm_usuario, ie_sexo, ie_autor_particular, ie_kit_material, cd_kit_material,
				tx_pfb_neg, tx_pfb_pos, nr_seq_estrutura, cd_tipo_baixa, ie_clinica, cd_convenio_glosa, cd_categoria_glosa,
				ie_tipo_preco_autor)
			SELECT nextval('regra_ajuste_material_seq'), dt_inicio_vigencia, ie_situacao, 	cd_categoria, cd_grupo_material,
				cd_subgrupo_material, cd_classe_material, cd_material, tx_ajuste, vl_negociado,
				ie_preco_informado, ie_glosa, tx_brasindice_pfb, tx_brasindice_pmc,
				tx_afaturar, dt_final_vigencia, cd_tipo_acomodacao, ie_tipo_atendimento,
				cd_setor_dest_p, qt_idade_min, qt_idade_max, tx_simpro_pfb, tx_simpro_pmc,
				ie_origem_preco, ie_precedencia_preco, pr_glosa, ie_tipo_material, tx_pmc_neg,
				tx_pmc_pos, cd_cid, cd_tabela_preco, cd_motivo_exc_conta, cd_estabelecimento,
				cd_convenio,clock_timestamp(),nm_usuario_p, ie_sexo, ie_autor_particular, ie_kit_material, cd_kit_material,
				tx_pfb_neg, tx_pfb_pos, nr_seq_estrutura, cd_tipo_baixa, ie_clinica, cd_convenio_glosa, cd_categoria_glosa,
				ie_tipo_preco_autor
			from 	regra_ajuste_material
			where 	cd_convenio = cd_conv_orig_p
			and	cd_estabelecimento = cd_estabelecimento_p
			and 	cd_setor_atendimento = cd_setor_orig_p;	
	end if;
	
	if (nm_tabela_p = 'PACOTE_MATERIAL') then	
	     open c001;
		     loop
			     fetch   c001 into
						nr_seq_pacote_mat_w,
						nr_sequencia_mat_w;
						EXIT WHEN NOT FOUND; /* apply on c001 */
					begin
						
						
					insert into pacote_material(	ie_inclui_exclui,
									ie_excedente,
									cd_grupo_material,
									cd_subgrupo_material,
									cd_classe_material,
									cd_material,
									qt_limite,
									ie_tipo_atendimento,
									cd_setor_atendimento,
									nr_seq_pac_acomod,
									ie_valor,
									vl_minimo,
									vl_maximo,
									pr_desconto,
									IE_TIPO_SETOR,
									nr_seq_familia,
									qt_idade_min,
									qt_idade_max,
									ie_objetivo,
									ie_considera_generico,
									pr_orcamento,
									ie_sexo,
									cd_centro_custo,
									ie_ratear_item,
									vl_negociado,
									nr_sequencia,
									nr_seq_pacote,
									nm_usuario,
									dt_atualizacao,
									ie_setor_exclusivo,
									ie_somente_sem_rla,
									nr_seq_estrutura,
									cd_local_estoque)	
							SELECT  	ie_inclui_exclui,
									ie_excedente,
									cd_grupo_material,
									cd_subgrupo_material,
									cd_classe_material,
									cd_material,
									qt_limite,
									ie_tipo_atendimento,
									cd_setor_dest_p,
									nr_seq_pac_acomod,
									ie_valor,
									vl_minimo,
									vl_maximo,
									pr_desconto,
									IE_TIPO_SETOR,
									nr_seq_familia,
									qt_idade_min,
									qt_idade_max,
									ie_objetivo,
									ie_considera_generico,
									pr_orcamento,
									ie_sexo,
									cd_centro_custo,
									ie_ratear_item,
									vl_negociado,
									nextval('pacote_material_seq'),
									nr_seq_pacote_mat_w,
									nm_usuario_p,
									clock_timestamp(),
									ie_setor_exclusivo,
									ie_somente_sem_rla,
									nr_seq_estrutura,
									cd_local_estoque
							from    pacote_material			
							where nr_seq_pacote = nr_seq_pacote_mat_w
							and 	nr_sequencia = nr_sequencia_mat_w;
					
					end;
		     end loop;
	     close c001;					
	 end if;
	
	if (nm_tabela_p = 'PACOTE_PROCEDIMENTO') then

	     open c002;
		     loop
			     fetch   c002 into
						nr_seq_pacote_proc_w,
						nr_sequencia_proc_w;
						EXIT WHEN NOT FOUND; /* apply on c002 */
					begin
								
						insert into pacote_procedimento(ie_inclui_exclui,
							ie_excedente,
							cd_area_proced,
							cd_especial_proced,
							cd_grupo_proced,
							cd_procedimento,
							ie_origem_proced,
							qt_limite,
							ie_considera_honorario,
							cd_setor_atendimento,
							ie_tipo_atendimento,
							ie_calcula_honorario,
							ie_calcula_custo_oper,
							nr_seq_pac_acomod,
							pr_desconto,
							ie_tipo_valor,
							qt_idade_min,
							qt_idade_max,
							vl_maximo,
							vl_minimo,
							nr_seq_proc_interno,
							ie_ratear_item,
							pr_desc,
							vl_negociado,
							ie_agendavel,
							ie_sexo,
							cd_centro_custo,
							nr_sequencia,
							nr_seq_pacote,
							nm_usuario,
							dt_atualizacao,
							ie_setor_exclusivo,
							nr_seq_classif,
							ie_valida_limite_proc,
							nr_seq_estrutura)
						SELECT  ie_inclui_exclui,
							ie_excedente,
							cd_area_proced,
							cd_especial_proced,
							cd_grupo_proced,
							cd_procedimento,
							ie_origem_proced,
							qt_limite,
							ie_considera_honorario,
							cd_setor_dest_p,
							ie_tipo_atendimento,
							ie_calcula_honorario,
							ie_calcula_custo_oper,
							nr_seq_pac_acomod,
							pr_desconto,
							ie_tipo_valor,
							qt_idade_min,
							qt_idade_max,
							vl_maximo,
							vl_minimo,
							nr_seq_proc_interno,
							ie_ratear_item,
							pr_desc,
							vl_negociado,
							ie_agendavel,
							ie_sexo,
							cd_centro_custo,
							nextval('pacote_procedimento_seq'),
							nr_seq_pacote_proc_w,
							nm_usuario_p,
							clock_timestamp(),
							ie_setor_exclusivo,
							nr_seq_classif,
							ie_valida_limite_proc,
							nr_seq_estrutura
						from	pacote_procedimento
						where	nr_seq_pacote = nr_seq_pacote_proc_w
						and 	nr_sequencia = nr_sequencia_proc_w;
					
					end;
		     end loop;
	     close c002;						
	end if;
end if;
	
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copia_parametro_setor_conv ( cd_conv_orig_p bigint, cd_setor_orig_p bigint, cd_setor_dest_p bigint, nm_tabela_p text, nm_usuario_p text, cd_estabelecimento_p bigint, ds_filtro_convenios_p text) FROM PUBLIC;

