-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ptu_gerar_consulta_dados_benef ( cd_unimed_benef_p bigint, cd_usuario_plano_p text, nm_beneficiario_p text, sobrenome_benef_p text, dt_nascimento_p text, cd_estabelecimento_p bigint, nm_usuario_p text, nr_seq_retorno_p INOUT bigint) AS $body$
DECLARE


cd_cooperativa_w		varchar(10);
cd_unimed_w			smallint;
dt_nascimento_w			timestamp;
cd_usuario_plano_w		varchar(13);


BEGIN
if (dt_nascimento_p	= '  /  /    ') then
	dt_nascimento_w	:= null;
else
	dt_nascimento_w	:= to_date(dt_nascimento_p, 'dd/mm/yyyy');
end if;

if (length(cd_usuario_plano_p) < 17) then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(262486);
	/* Mensagem: A carteirinha deve conter 17 dÃ­gitos! */

end if;

cd_cooperativa_w	:= pls_obter_unimed_estab(cd_estabelecimento_p);
cd_unimed_w		:= substr(cd_usuario_plano_p,1,4);
cd_usuario_plano_w	:= substr(cd_usuario_plano_p,5,17);

select	nextval('ptu_consulta_beneficiario_seq')
into STRICT	nr_seq_retorno_p
;

insert	into ptu_consulta_beneficiario(nr_sequencia, cd_transacao, ie_tipo_cliente,
	 cd_unimed_executora, cd_unimed_beneficiario, nr_seq_execucao,
	 dt_atualizacao, nm_usuario, cd_unimed,
	 cd_usuario_plano, dt_nascimento, nm_beneficiario,
	 sobrenome_beneficiario, nr_seq_guia, nr_seq_requisicao)
values (nr_seq_retorno_p, '00312', 'U',
	 cd_cooperativa_w, cd_unimed_benef_p, nr_seq_retorno_p,
	 clock_timestamp(), nm_usuario_p, cd_unimed_w,
	 cd_usuario_plano_w, dt_nascimento_w, substr(nm_beneficiario_p,1,25),
	 substr(sobrenome_benef_p,1,10), nr_seq_retorno_p, null);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ptu_gerar_consulta_dados_benef ( cd_unimed_benef_p bigint, cd_usuario_plano_p text, nm_beneficiario_p text, sobrenome_benef_p text, dt_nascimento_p text, cd_estabelecimento_p bigint, nm_usuario_p text, nr_seq_retorno_p INOUT bigint) FROM PUBLIC;

