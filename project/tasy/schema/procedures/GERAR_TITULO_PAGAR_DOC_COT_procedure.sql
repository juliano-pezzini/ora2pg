-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_titulo_pagar_doc_cot ( nr_sequencia_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
nr_seq_retorno_w	bigint;
cd_estabelecimento_w	smallint;
cd_moeda_w		smallint;
tx_juros_w		double precision;
tx_multa_w		double precision;
cd_tipo_taxa_juro_w	bigint;
cd_tipo_taxa_multa_w	bigint;
nr_seq_lote_hist_w	bigint;
nr_seq_trans_financ_w	bigint;
cd_cgc_w		varchar(14);
nr_titulo_w		bigint;
vl_saldo_w		double precision;
cd_pessoa_fisica_w	varchar(10);
vl_titulo_w		double precision;


BEGIN 
 
select	round((vl_documento_ref_moeda)::numeric,2), 
	cd_cnpj, 
	cd_pessoa_fisica 
into STRICT	vl_titulo_w, 
	cd_cgc_w, 
	cd_pessoa_fisica_w 
from	cot_doc_importacao 
where	nr_sequencia = nr_sequencia_p;
 
begin 
select	coalesce(cd_moeda_w,cd_moeda_padrao), 
	coalesce(cd_tipo_taxa_juro_w,cd_tipo_taxa_juro), 
	coalesce(cd_tipo_taxa_multa_w,cd_tipo_taxa_multa), 
	coalesce(tx_juros_w,pr_juro_padrao), 
	coalesce(tx_multa_w,pr_multa_padrao) 
into STRICT	cd_moeda_w, 
	cd_tipo_taxa_juro_w, 
	cd_tipo_taxa_multa_w, 
	tx_juros_w, 
	tx_multa_w 
from	parametros_contas_pagar a 
where	a.cd_estabelecimento	= cd_estabelecimento_p;
exception 
	when others then 
	CALL wheb_mensagem_pck.exibir_mensagem_abort(266036);
	--'Não foram localizados os parâmetros do contas a pagar!#@#@' 
end;
 
select	nextval('titulo_pagar_seq') 
into STRICT	nr_titulo_w
;
 
insert into titulo_pagar( 
	nr_titulo, 
	nm_usuario, 
	dt_atualizacao, 
	cd_estabelecimento, 
	dt_emissao, 
	dt_vencimento_original, 
	dt_vencimento_atual, 
	vl_titulo, 
	vl_saldo_titulo, 
	vl_saldo_juros, 
	vl_saldo_multa, 
	cd_moeda, 
	tx_juros, 
	tx_multa, 
	cd_tipo_taxa_juro, 
	cd_tipo_taxa_multa, 
	ie_situacao, 
	ie_origem_titulo, 
	ie_tipo_titulo, 
	nr_seq_lote_audit_hist, 
	nr_seq_trans_fin_contab, 
	cd_pessoa_fisica, 
	cd_cgc, 
	ie_status) 
values (nr_titulo_w, 
	nm_usuario_p, 
	clock_timestamp(), 
	cd_estabelecimento_p, 
	trunc(clock_timestamp(),'dd'), 
	trunc(clock_timestamp(),'dd') + 30, 
	trunc(clock_timestamp(),'dd') + 30, 
	vl_titulo_w, 
	vl_titulo_w, 
	0, 
	0, 
	cd_moeda_w, 
	tx_juros_w, 
	tx_multa_w, 
	cd_tipo_taxa_juro_w, 
	cd_tipo_taxa_multa_w, 
	'A', 
	7, 
	21, 
	nr_seq_lote_hist_w, 
	nr_seq_trans_financ_w, 
	cd_pessoa_fisica_w, 
	cd_cgc_w, 
	'D');
CALL ATUALIZAR_INCLUSAO_TIT_PAGAR(nr_titulo_w,nm_usuario_p);
 
update	cot_doc_importacao 
set	nr_titulo_pagar = nr_titulo_w 
where	nr_sequencia = nr_sequencia_p;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_titulo_pagar_doc_cot ( nr_sequencia_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

