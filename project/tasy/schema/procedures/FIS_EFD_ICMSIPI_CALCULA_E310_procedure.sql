-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE fis_efd_icmsipi_calcula_e310 (vl_tot_debitos_difal_p bigint, vl_out_deb_difal_p bigint, vl_sld_cred_ant_difal_p bigint, vl_tot_creditos_difal_p bigint, vl_out_cred_difal_p bigint, vl_deducoes_difal_p bigint, vl_tot_deb_fcp_p INOUT bigint, vl_tot_cred_fcp_p INOUT bigint, vl_out_deb_fcp_p bigint, vl_sld_cred_ant_fcp_p bigint, vl_out_cred_fcp_p bigint, vl_deducoes_fcp_p bigint, sg_uf_0000_p text, sg_uf_p text, vl_sld_dev_ant_difal_p INOUT bigint, vl_recol_difal_p INOUT bigint, vl_sld_cred_transp_difal_p INOUT bigint, vl_recol_fcp_p INOUT bigint, vl_sld_dev_ant_fcp_p INOUT bigint, vl_sld_cred_transp_fcp_p INOUT bigint, ie_mov_st_p INOUT bigint) AS $body$
DECLARE


  vl_sld_dev_ant_difal_w		double precision	:= 0;
  vl_recol_difal_w 			double precision	:= 0;
  vl_sld_cred_transp_difal_w		double precision 	:= 0;
  vl_tot_deb_fcp_w			double precision 	:= 0;
  vl_tot_cred_fcp_w			double precision 	:= 0;
  vl_recol_fcp_w			double precision 	:= 0;
  vl_sld_dev_ant_fcp_w			double precision 	:= 0;
  vl_sld_cred_transp_fcp_w		double precision 	:= 0;
  ie_mov_st_w 				smallint	:= 0;

BEGIN

	--Saldo apurado
	vl_sld_dev_ant_difal_w := (vl_tot_debitos_difal_p + vl_out_deb_difal_p) - (vl_sld_cred_ant_difal_p + vl_tot_creditos_difal_p + vl_out_cred_difal_p);
	if vl_sld_dev_ant_difal_w < 0 then
		vl_sld_dev_ant_difal_w := 0;
	end if;

	--Valor recolhido ou a recolher
	vl_recol_difal_w := (vl_sld_dev_ant_difal_w - vl_deducoes_difal_p);
	if vl_recol_difal_w < 0 then
		vl_recol_difal_w := 0;
	end if;

	/* VL_SLD_CRED_transp_DIFAL */

	vl_sld_cred_transp_difal_w := (vl_sld_cred_ant_difal_p + vl_tot_creditos_difal_p + vl_out_cred_difal_p) - (vl_tot_debitos_difal_p + vl_out_deb_difal_p);
	if vl_sld_cred_transp_difal_w > 0 then
		vl_sld_cred_transp_difal_w := 0;
	end if;


	vl_tot_deb_fcp_w := vl_tot_deb_fcp_p;
	vl_tot_cred_fcp_w := vl_tot_cred_fcp_p;
	if sg_uf_0000_p = sg_uf_p then
		vl_tot_deb_fcp_w := 0;
		vl_tot_cred_fcp_w := 0;
	end if;

	/* VL_SLD_DEV_ANT_FCP */

	vl_sld_dev_ant_fcp_w := (vl_tot_deb_fcp_w + vl_out_deb_fcp_p) - (vl_sld_cred_ant_fcp_p + vl_tot_cred_fcp_w + vl_out_cred_fcp_p);
	if vl_sld_dev_ant_fcp_w < 0 then
		vl_sld_dev_ant_fcp_w := 0;
	end if;


	/* VL_RECOL_FCP */

	vl_recol_fcp_w := (vl_sld_dev_ant_fcp_w - vl_deducoes_fcp_p);
	if vl_recol_fcp_w < 0 then
		vl_recol_fcp_w := 0;
	end if;

	/* VL_SLD_CRED_transp_FCP */

	vl_sld_cred_transp_fcp_w := (vl_sld_cred_ant_fcp_p + vl_tot_cred_fcp_w + vl_out_cred_fcp_p) - (vl_tot_deb_fcp_w + vl_out_deb_fcp_p);
	if vl_sld_cred_transp_fcp_w < 0 then
		vl_sld_cred_transp_fcp_w := 0;
	end if;

	if (vl_tot_debitos_difal_p <> 0)	or (vl_out_deb_difal_p <> 0) 		or (vl_sld_cred_ant_difal_p <> 0)	or (vl_tot_creditos_difal_p <> 0) 		or (vl_out_cred_difal_p <> 0)	or (vl_deducoes_difal_p <> 0) 		or (vl_tot_deb_fcp_p <> 0)		or (vl_tot_cred_fcp_p <> 0)		or (vl_out_deb_fcp_p <> 0) 	or (vl_sld_cred_ant_fcp_p <> 0) 		or (vl_out_cred_fcp_p <> 0)	or (vl_deducoes_fcp_p <> 0) 		or (vl_sld_dev_ant_difal_w <> 0) 	or (vl_recol_difal_w <> 0)			or (vl_sld_cred_transp_difal_w <> 0) or (vl_recol_fcp_w <> 0)			or (vl_sld_dev_ant_fcp_w <> 0)	or (vl_sld_cred_transp_fcp_w <> 0)		then
		ie_mov_st_w := 1;
	end if;

	/**/

	vl_sld_dev_ant_difal_p		:= coalesce(vl_sld_dev_ant_difal_w,0);
	vl_recol_difal_p		:= coalesce(vl_recol_difal_w,0);
	vl_sld_cred_transp_difal_p	:= coalesce(vl_sld_cred_transp_difal_w,0);
	vl_recol_fcp_p			:= coalesce(vl_recol_fcp_w,0);
	vl_sld_dev_ant_fcp_p		:= coalesce(vl_sld_dev_ant_fcp_w,0);
	vl_sld_cred_transp_fcp_p	:= coalesce(vl_sld_cred_transp_fcp_w,0);
	ie_mov_st_p                     := ie_mov_st_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE fis_efd_icmsipi_calcula_e310 (vl_tot_debitos_difal_p bigint, vl_out_deb_difal_p bigint, vl_sld_cred_ant_difal_p bigint, vl_tot_creditos_difal_p bigint, vl_out_cred_difal_p bigint, vl_deducoes_difal_p bigint, vl_tot_deb_fcp_p INOUT bigint, vl_tot_cred_fcp_p INOUT bigint, vl_out_deb_fcp_p bigint, vl_sld_cred_ant_fcp_p bigint, vl_out_cred_fcp_p bigint, vl_deducoes_fcp_p bigint, sg_uf_0000_p text, sg_uf_p text, vl_sld_dev_ant_difal_p INOUT bigint, vl_recol_difal_p INOUT bigint, vl_sld_cred_transp_difal_p INOUT bigint, vl_recol_fcp_p INOUT bigint, vl_sld_dev_ant_fcp_p INOUT bigint, vl_sld_cred_transp_fcp_p INOUT bigint, ie_mov_st_p INOUT bigint) FROM PUBLIC;

