-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_alterar_data_ref ( nr_sequencia_p bigint, dt_mes_competencia_p timestamp, dt_protocolo_p timestamp, nr_seq_prestador_p bigint, ds_observacao_p text, nr_seq_congenere_p bigint, dt_base_venc_p timestamp, ie_tipo_guia_p text, nr_protocolo_prestador_p text, nr_seq_protocolo_p bigint, ie_guia_fisica_p text, nr_seq_lote_p bigint, qt_contas_informadas_p bigint, ds_erro_p INOUT text, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE


dt_mes_competencia_w		timestamp;
dt_recebimento_w		timestamp;
ds_tipo_erro_w			varchar(1) := 'A';
nr_seq_prot_referencia_w 	pls_protocolo_conta.nr_seq_prot_referencia%type;


BEGIN

begin -- Obtem data de recebimento do protocolo  
select	dt_recebimento,
	nr_seq_prot_referencia
into STRICT	dt_recebimento_w,
	nr_seq_prot_referencia_w
from 	pls_protocolo_conta
where	nr_Sequencia 	= nr_sequencia_p;
exception
when others then
	dt_recebimento_w	:= null;
end;

CALL pls_alterar_dados_conta_medica(nr_sequencia_p, dt_mes_competencia_p, dt_protocolo_p, nr_seq_prestador_p, ds_observacao_p,nr_seq_lote_p,qt_contas_informadas_p,ie_guia_fisica_p, cd_estabelecimento_p, nm_usuario_p,dt_recebimento_w, null, '','N','N','N',nr_seq_prot_referencia_w);
				
SELECT * FROM pls_consistir_protocolo_conta(nr_seq_prestador_p, nr_seq_congenere_p, dt_base_venc_p, ie_tipo_guia_p, dt_mes_competencia_p, dt_protocolo_p, nr_protocolo_prestador_p, nr_seq_protocolo_p, null, nm_usuario_p, cd_estabelecimento_p, clock_timestamp(), null, null, dt_mes_competencia_w, ds_tipo_erro_w, ds_erro_p) INTO STRICT dt_mes_competencia_w, ds_tipo_erro_w, ds_erro_p;		
				
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_alterar_data_ref ( nr_sequencia_p bigint, dt_mes_competencia_p timestamp, dt_protocolo_p timestamp, nr_seq_prestador_p bigint, ds_observacao_p text, nr_seq_congenere_p bigint, dt_base_venc_p timestamp, ie_tipo_guia_p text, nr_protocolo_prestador_p text, nr_seq_protocolo_p bigint, ie_guia_fisica_p text, nr_seq_lote_p bigint, qt_contas_informadas_p bigint, ds_erro_p INOUT text, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

