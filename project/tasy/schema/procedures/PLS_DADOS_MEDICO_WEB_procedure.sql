-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_dados_medico_web (cd_medico_p bigint, ie_tipo_medico_p text, uf_medico_p text, cd_pessoa_fisica_p INOUT text, nm_pessoa_fisica_p INOUT text) AS $body$
DECLARE

/*
	ie_tipo_medico_p:   'CRO'  ,   'CRM'
*/
cd_pessoa_fisica_w		varchar(10) := '';
nm_pessoa_fisica_w		varchar(60) := '';
nr_seq_conselho_w 		bigint;


BEGIN

nr_seq_conselho_w := pls_obter_nr_conselho_web(ie_tipo_medico_p);

if (ie_tipo_medico_p = 'CRO') then
	select 		max(a.cd_pessoa_fisica),
			max(a.nm_pessoa_fisica)
	into STRICT		cd_pessoa_fisica_w,
			nm_pessoa_fisica_w
	from		pessoa_fisica a,
			medico	b
	where		b.ie_situacao = 'A'
	and		a.nr_seq_conselho  = nr_seq_conselho_w
	and		a.cd_pessoa_fisica = b.cd_pessoa_fisica
	and		a.ds_codigo_prof   = to_char(cd_medico_p)
	and		(((b.uf_crm IS NOT NULL AND b.uf_crm::text <> '') and b.uf_crm = upper(uf_medico_p)) or (coalesce(uf_medico_p::text, '') = ''));

	if (coalesce(nm_pessoa_fisica_w::text, '') = '') then
		select 		max(a.cd_pessoa_fisica),
				max(a.nm_pessoa_fisica)
		into STRICT		cd_pessoa_fisica_w,
				nm_pessoa_fisica_w
		from		pessoa_fisica a,
				medico b
		where		b.ie_situacao = 'A'
		and		a.nr_seq_conselho = nr_seq_conselho_w
		and		a.cd_pessoa_fisica = b.cd_pessoa_fisica
		and		b.nr_crm = cd_medico_p
		and		(((b.uf_crm IS NOT NULL AND b.uf_crm::text <> '') and b.uf_crm = upper(uf_medico_p)) or (coalesce(uf_medico_p::text, '') = ''));
	end if;
end if;

cd_pessoa_fisica_p := cd_pessoa_fisica_w;
nm_pessoa_fisica_p := nm_pessoa_fisica_w;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_dados_medico_web (cd_medico_p bigint, ie_tipo_medico_p text, uf_medico_p text, cd_pessoa_fisica_p INOUT text, nm_pessoa_fisica_p INOUT text) FROM PUBLIC;

