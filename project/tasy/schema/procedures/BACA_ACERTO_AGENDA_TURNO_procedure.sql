-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_acerto_agenda_turno () AS $body$
BEGIN

CALL exec_sql_dinamico('TASYAgenda', ' drop TABLE W_AGENDA_TURNO_CONV ');

CALL exec_sql_dinamico('TASYAgenda', ' CREATE TABLE W_AGENDA_TURNO_CONV AS
      (SELECT * FROM AGENDA_TURNO_CONV) ');


CALL exec_sql_dinamico('TASYAgenda', ' ALTER TABLE AGENDA_TURNO_CONV
      DROP CONSTRAINT AGETUCO_AGETURN_FK ');

CALL exec_sql_dinamico('TASYAgenda', ' ALTER TABLE AGENDA_TURNO_CONV add
      (IE_DIA_SEMANA_W	NUMBER(01)) ');

CALL exec_sql_dinamico('TASYAgenda', ' UPDATE AGENDA_TURNO_CONV ' ||
				' SET IE_DIA_SEMANA_W = IE_DIA_SEMANA ');

CALL exec_sql_dinamico('TASYAgenda', ' ALTER TABLE AGENDA_TURNO_CONV MODIFY
      (IE_DIA_SEMANA	VARCHAR2(01) NULL) ');


CALL exec_sql_dinamico('TASYAgenda', ' UPDATE AGENDA_TURNO_CONV ' ||
				' SET IE_DIA_SEMANA = NULL ');


CALL exec_sql_dinamico('TASYAgenda', ' ALTER TABLE AGENDA_TURNO_CONV DROP COLUMN IE_DIA_SEMANA ');

CALL exec_sql_dinamico('TASYAgenda', ' ALTER TABLE AGENDA_TURNO_CONV add
      (IE_DIA_SEMANA	NUMBER(01)) ');

CALL exec_sql_dinamico('TASYAgenda', ' UPDATE AGENDA_TURNO_CONV ' ||
				' SET IE_DIA_SEMANA = IE_DIA_SEMANA_W ');

CALL exec_sql_dinamico('TASYAgenda', ' ALTER TABLE AGENDA_TURNO_CONV modify
      (IE_DIA_SEMANA	NOT NULL) ');


CALL exec_sql_dinamico('TASYAgenda', ' ALTER TABLE AGENDA_TURNO_CONV ADD
	(
	      CONSTRAINT AGETUCO_AGETURN_FK FOREIGN KEY (
        	       CD_AGENDA,
	               IE_DIA_SEMANA,
        	       HR_INICIAL)
	REFERENCES AGENDA_TURNO (
        	       CD_AGENDA,
	               IE_DIA_SEMANA,
        	       HR_INICIAL)) ');

CALL exec_sql_dinamico('TASYAgenda', ' update tabela_atributo ' ||
				' set ie_obrigatorio = ' || CHR(39) || 'N' || CHR(39) ||
				' where nm_tabela = ' || CHR(39) || 'AGENDA_TURNO_CONV' || CHR(39) ||
				' and   nm_atributo = ' || CHR(39) || 'CD_PESSOA_FISICA' || CHR(39));

CALL exec_sql_dinamico('TASYAgenda', ' update tabela_atributo ' ||
				' set ie_tipo_atributo = ' || CHR(39) || 'NUMBER' || CHR(39) || ',' ||
				'     qt_decimais = 0, qt_tamanho = 1 ' ||
				' where nm_tabela = ' || CHR(39) || 'AGENDA_TURNO_CONV' || CHR(39) ||
				' and   nm_atributo = ' || CHR(39) || 'IE_DIA_SEMANA' || CHR(39));

CALL exec_sql_dinamico('TASYAgenda', ' execute tasy_sincronizar_base ');

CALL exec_sql_dinamico('TASYAgenda', ' execute VALIDA_OBJETOS_SISTEMA ');

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_acerto_agenda_turno () FROM PUBLIC;

