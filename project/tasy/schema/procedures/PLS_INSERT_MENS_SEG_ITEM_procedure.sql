-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_insert_mens_seg_item (ie_tipo_item_p text, nm_usuario_p text, cd_centro_custo_p bigint, ds_mensagem_reajuste_p text, ds_observacao_p text, dt_fim_cobertura_p timestamp, dt_inicio_cobertura_p timestamp, dt_retroativa_p timestamp, ie_rescisao_proporcional_p text, ie_tipo_mensalidade_p text, nr_parcela_sca_p bigint, nr_seq_amortizacao_p bigint, nr_seq_bonificacao_vinculo_p bigint, nr_seq_carteira_seg_p bigint, nr_seq_conta_p bigint, nr_seq_lancamento_mens_p bigint, nr_seq_lote_reaj_seg_p bigint, nr_seq_mensalidade_seg_p bigint, nr_seq_mensalidade_p bigint, nr_seq_nota_credito_p bigint, nr_seq_plano_p bigint, nr_seq_protocolo_p bigint, nr_seq_reajuste_p bigint, nr_seq_regra_acrescimo_p bigint, nr_seq_seg_preco_origem_p bigint, nr_seq_tipo_acrescimo_p bigint, nr_seq_tipo_lanc_p bigint, nr_seq_vinculo_sca_p bigint, vl_ato_auxiliar_p bigint, vl_ato_cooperado_p bigint, vl_ato_nao_cooperado_p bigint, vl_item_p bigint, nr_seq_item_mensalidade_p INOUT bigint) AS $body$
DECLARE


nr_seq_motivo_suspensao_w	pls_motivo_susp_cobr_mens.nr_sequencia%type;
nr_seq_mens_seg_item_w		pls_mensalidade_seg_item.nr_sequencia%type := null;
qt_item_excecao_w		smallint;
ie_gerar_mens_seg_item_w	varchar(1) := 'S';


BEGIN

nr_seq_motivo_suspensao_w	:= pls_store_data_mens_pck.get_nr_seq_motivo_suspensao;

if (nr_seq_motivo_suspensao_w IS NOT NULL AND nr_seq_motivo_suspensao_w::text <> '') then
	select	count(1)
	into STRICT	qt_item_excecao_w
	from	pls_susp_cobr_mens_excecao a,
		pls_motivo_susp_cobr_mens b
	where	a.nr_seq_motivo = b.nr_sequencia
	and	a.nr_seq_motivo = nr_seq_motivo_suspensao_w
	and	a.ie_tipo_item  = ie_tipo_item_p
	and	b.ie_situacao   = 'A';

	if (qt_item_excecao_w = 0) then
		ie_gerar_mens_seg_item_w := 'N';
	else
		ie_gerar_mens_seg_item_w := 'S';
	end if;
end if;

if (ie_gerar_mens_seg_item_w = 'S') then
	select	nextval('pls_mensalidade_seg_item_seq')
	into STRICT	nr_seq_mens_seg_item_w
	;

	insert	into	pls_mensalidade_seg_item(nr_sequencia, dt_atualizacao_nrec, dt_atualizacao,
		nm_usuario_nrec, nm_usuario, ds_mensagem_reajuste,
		ds_observacao, dt_fim_cobertura, dt_inicio_cobertura,
		dt_retroativa, ie_rescisao_proporcional, ie_tipo_item,
		ie_tipo_mensalidade, nr_parcela_sca, nr_seq_amortizacao,
		nr_seq_bonificacao_vinculo, nr_seq_carteira_seg, nr_seq_conta,
		nr_seq_lancamento_mens, nr_seq_lote_reaj_seg, nr_seq_mensalidade_seg,
		nr_seq_mensalidade, nr_seq_nota_credito, nr_seq_plano,
		nr_seq_protocolo, nr_seq_reajuste, nr_seq_regra_acrescimo,
		nr_seq_seg_preco_origem, nr_seq_tipo_acrescimo, nr_seq_tipo_lanc,
		nr_seq_vinculo_sca, cd_centro_custo, vl_ato_auxiliar,
		vl_ato_cooperado, vl_ato_nao_cooperado,	vl_item)
	values (nr_seq_mens_seg_item_w, clock_timestamp(), clock_timestamp(),
		nm_usuario_p, nm_usuario_p, ds_mensagem_reajuste_p,
		ds_observacao_p, dt_fim_cobertura_p, dt_inicio_cobertura_p,
		dt_retroativa_p, ie_rescisao_proporcional_p, ie_tipo_item_p,
		ie_tipo_mensalidade_p, nr_parcela_sca_p, nr_seq_amortizacao_p,
		nr_seq_bonificacao_vinculo_p, nr_seq_carteira_seg_p, nr_seq_conta_p,
		nr_seq_lancamento_mens_p, nr_seq_lote_reaj_seg_p, nr_seq_mensalidade_seg_p,
		nr_seq_mensalidade_p, nr_seq_nota_credito_p, nr_seq_plano_p,
		nr_seq_protocolo_p, nr_seq_reajuste_p, nr_seq_regra_acrescimo_p,
		nr_seq_seg_preco_origem_p, nr_seq_tipo_acrescimo_p, nr_seq_tipo_lanc_p,
		nr_seq_vinculo_sca_p, cd_centro_custo_p, vl_ato_auxiliar_p,
		vl_ato_cooperado_p, vl_ato_nao_cooperado_p, vl_item_p);

	nr_seq_item_mensalidade_p	:=	nr_seq_mens_seg_item_w;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_insert_mens_seg_item (ie_tipo_item_p text, nm_usuario_p text, cd_centro_custo_p bigint, ds_mensagem_reajuste_p text, ds_observacao_p text, dt_fim_cobertura_p timestamp, dt_inicio_cobertura_p timestamp, dt_retroativa_p timestamp, ie_rescisao_proporcional_p text, ie_tipo_mensalidade_p text, nr_parcela_sca_p bigint, nr_seq_amortizacao_p bigint, nr_seq_bonificacao_vinculo_p bigint, nr_seq_carteira_seg_p bigint, nr_seq_conta_p bigint, nr_seq_lancamento_mens_p bigint, nr_seq_lote_reaj_seg_p bigint, nr_seq_mensalidade_seg_p bigint, nr_seq_mensalidade_p bigint, nr_seq_nota_credito_p bigint, nr_seq_plano_p bigint, nr_seq_protocolo_p bigint, nr_seq_reajuste_p bigint, nr_seq_regra_acrescimo_p bigint, nr_seq_seg_preco_origem_p bigint, nr_seq_tipo_acrescimo_p bigint, nr_seq_tipo_lanc_p bigint, nr_seq_vinculo_sca_p bigint, vl_ato_auxiliar_p bigint, vl_ato_cooperado_p bigint, vl_ato_nao_cooperado_p bigint, vl_item_p bigint, nr_seq_item_mensalidade_p INOUT bigint) FROM PUBLIC;

