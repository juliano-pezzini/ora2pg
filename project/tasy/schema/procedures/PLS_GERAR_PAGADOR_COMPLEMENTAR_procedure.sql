-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gerar_pagador_complementar (nr_seq_pagador_p pls_contrato_pagador.nr_sequencia%type, ds_pagador_p pls_contrato_pagador.ds_pagador%type, nr_seq_classif_itens_p pls_contrato_pagador.nr_seq_classif_itens%type, nr_seq_grupo_p pls_grupo_item_mens.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nr_seq_pagador_compl_p INOUT pls_contrato_pagador.nr_sequencia%type) AS $body$
DECLARE


nr_seq_pagador_novo_w		pls_contrato_pagador.nr_sequencia%type;

C01 CURSOR(	nr_seq_pagador_pc	pls_contrato_pagador.nr_sequencia%type) FOR
	SELECT	nr_sequencia nr_seq_pagador_fin
	from	pls_contrato_pagador_fin
	where	nr_seq_pagador = nr_seq_pagador_pc;
		
C02 CURSOR(	nr_seq_grupo_pc		pls_grupo_item_mens.nr_sequencia%type) FOR
	SELECT	ie_tipo_item,
		CASE WHEN ie_tipo_item=20 THEN  nr_seq_tipo_lanc  ELSE null END  nr_seq_tipo_lanc
	from	pls_item_grupo_tipo_mens
	where	nr_seq_grupo_item = nr_seq_grupo_pc
	and	ie_situacao = 'A'
	and	ie_tipo_item in ('1','3','6','12','13','20');
	
BEGIN

select	nextval('pls_contrato_pagador_seq')
into STRICT	nr_seq_pagador_novo_w
;

insert into 	pls_contrato_pagador(	nr_sequencia, cd_agencia_bancaria, cd_banco, cd_cgc, cd_condicao_pagamento,
		cd_conta, cd_pessoa_fisica, ds_email, ds_pagador, dt_atualizacao, 
		dt_atualizacao_nrec, dt_dia_vencimento, dt_primeira_mensalidade, ie_bonus_indicacao, ie_calc_primeira_mens, 
		ie_calculo_proporcional, ie_digito_agencia, ie_digito_conta, ie_endereco_boleto, ie_envia_cobranca, 
		ie_finalidade, ie_inadimplencia_via_adic, ie_liberado_proposta, ie_notificacao, ie_pag_ref_grupo_intercambio, 
		ie_pessoa_comprovante, ie_situacao_trabalhista, ie_taxa_emissao_boleto, nm_usuario, nm_usuario_nrec,
		nr_seq_classif_itens, nr_seq_compl_pf_tel_adic, nr_seq_compl_pj, nr_seq_congenere, nr_seq_conta_banco,
		nr_seq_contrato, nr_seq_destino_corresp, nr_seq_forma_cobranca, nr_seq_motivo_alt_pag, nr_seq_motivo_cancelamento,
		nr_seq_pagador_ant, nr_seq_pagador_compl, nr_seq_pagador_intercambio, nr_seq_regra_obito, nr_seq_seg_mig_origem,
		nr_seq_tipo_compl_adic, nr_seq_vinculo_sca, ie_tipo_pagador, ie_receber_sms)
	(SELECT	nr_seq_pagador_novo_w, cd_agencia_bancaria, cd_banco, cd_cgc, cd_condicao_pagamento, 
		cd_conta, cd_pessoa_fisica, ds_email, ds_pagador_p, clock_timestamp(), 
		clock_timestamp(), dt_dia_vencimento, dt_primeira_mensalidade, ie_bonus_indicacao, ie_calc_primeira_mens, 
		ie_calculo_proporcional, ie_digito_agencia, ie_digito_conta, ie_endereco_boleto, ie_envia_cobranca, 
		ie_finalidade, ie_inadimplencia_via_adic, ie_liberado_proposta, ie_notificacao, ie_pag_ref_grupo_intercambio, 
		ie_pessoa_comprovante, ie_situacao_trabalhista, ie_taxa_emissao_boleto, nm_usuario_p, nm_usuario_p,
		nr_seq_classif_itens_p, nr_seq_compl_pf_tel_adic, nr_seq_compl_pj, nr_seq_congenere, nr_seq_conta_banco,
		nr_seq_contrato, nr_seq_destino_corresp, nr_seq_forma_cobranca, nr_seq_motivo_alt_pag, nr_seq_motivo_cancelamento,
		nr_seq_pagador_ant, nr_seq_pagador_compl, nr_seq_pagador_intercambio, nr_seq_regra_obito, nr_seq_seg_mig_origem,
		nr_seq_tipo_compl_adic, nr_seq_vinculo_sca, 'S', 'S'
	from	pls_contrato_pagador
	where	nr_sequencia = nr_seq_pagador_p);

for r_c01_w in c01(nr_seq_pagador_p) loop
	begin
	insert into 	pls_contrato_pagador_fin(	nr_sequencia, dt_atualizacao, dt_atualizacao_nrec, nm_usuario, nm_usuario_nrec,
			nr_seq_pagador, cd_autenticidade, cd_banco, cd_condicao_pagamento, cd_conta,
			cd_matricula, cd_portador, cd_portador_deb_aut, cd_profissao, cd_tipo_portador,
			cd_tipo_portador_deb_aut, ds_observacao, dt_dia_vencimento, dt_fim_vigencia, dt_inicio_vigencia,
			ie_boleto_email, ie_destacar_reajuste, ie_digito_agencia, ie_digito_conta, ie_geracao_nota_titulo,
			ie_gerar_cobr_escrit, ie_mes_vencimento, ie_portador_exclusivo, nm_usuario_fim_vigencia, nr_pensionista,
			nr_seq_carteira_cobr, nr_seq_conta_banco, nr_seq_conta_banco_deb_aut, nr_seq_dia_vencimento, nr_seq_empresa,
			nr_seq_forma_cobranca, nr_seq_mot_cob, cd_agencia_bancaria, nr_seq_vinculo_empresa, nr_seq_vinculo_est)
		(SELECT	nextval('pls_contrato_pagador_fin_seq'), clock_timestamp(), clock_timestamp(), nm_usuario_p, nm_usuario_p,
			nr_seq_pagador_novo_w, cd_autenticidade, cd_banco, cd_condicao_pagamento, cd_conta,
			cd_matricula, cd_portador, cd_portador_deb_aut, cd_profissao, cd_tipo_portador,
			cd_tipo_portador_deb_aut, ds_observacao, dt_dia_vencimento, dt_fim_vigencia, dt_inicio_vigencia,
			ie_boleto_email, ie_destacar_reajuste, ie_digito_agencia, ie_digito_conta, ie_geracao_nota_titulo,
			ie_gerar_cobr_escrit, ie_mes_vencimento, ie_portador_exclusivo, nm_usuario_fim_vigencia, nr_pensionista,
			nr_seq_carteira_cobr, nr_seq_conta_banco, nr_seq_conta_banco_deb_aut, nr_seq_dia_vencimento, nr_seq_empresa,
			nr_seq_forma_cobranca, nr_seq_mot_cob, cd_agencia_bancaria, nr_seq_vinculo_empresa, nr_seq_vinculo_est
		from	pls_contrato_pagador_fin
		where	nr_sequencia = r_c01_w.nr_seq_pagador_fin);
	end;
end loop;

for r_c02_w in c02(nr_seq_grupo_p) loop
	begin	
	insert into	pls_pagador_item_mens(	nr_sequencia, dt_atualizacao, dt_atualizacao_nrec, nm_usuario, nm_usuario_nrec,
			ie_tipo_item, nr_seq_pagador, nr_seq_pagador_item, cd_estabelecimento, nr_seq_tipo_lanc)
	values (	nextval('pls_pagador_item_mens_seq'), clock_timestamp(), clock_timestamp(), nm_usuario_p, nm_usuario_p,
			r_c02_w.ie_tipo_item, nr_seq_pagador_p, nr_seq_pagador_novo_w, cd_estabelecimento_p, r_c02_w.nr_seq_tipo_lanc);
	end;
end loop;

nr_seq_pagador_compl_p	:= nr_seq_pagador_novo_w;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_pagador_complementar (nr_seq_pagador_p pls_contrato_pagador.nr_sequencia%type, ds_pagador_p pls_contrato_pagador.ds_pagador%type, nr_seq_classif_itens_p pls_contrato_pagador.nr_seq_classif_itens%type, nr_seq_grupo_p pls_grupo_item_mens.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nr_seq_pagador_compl_p INOUT pls_contrato_pagador.nr_sequencia%type) FROM PUBLIC;

