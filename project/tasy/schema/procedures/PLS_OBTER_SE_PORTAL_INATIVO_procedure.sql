-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_obter_se_portal_inativo ( cd_estabelecimento_p bigint, ie_portal_inativo_p INOUT text, ds_msg_portal_inativo_p INOUT text) AS $body$
DECLARE

 
/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
Finalidade: 
Valida se deverá inativar o Portal web na atualização de versão e retorna a mensagem para quando o Portal 
estiver inativo. 
------------------------------------------------------------------------------------------------------------------- 
Locais de chamada direta: 
[ ] Objetos do dicionário [ ] Tasy (Delphi/Java) [ x ] Portal [ ] Relatórios [ ] Outros: 
 ------------------------------------------------------------------------------------------------------------------ 
Pontos de atenção: 
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
 
 
cd_estabelecimento_w		estabelecimento.cd_estabelecimento%type;
ie_inativa_portal_w		pls_web_param_geral.ie_inativa_portal%type;
ds_msg_portal_inativo_w		pls_web_param_geral.ds_msg_portal_inativo%type;
ie_status_aplicacao_w		aplicacao_tasy.ie_status_aplicacao%type;


BEGIN 
if ((cd_estabelecimento_p IS NOT NULL AND cd_estabelecimento_p::text <> '') and cd_estabelecimento_p > 0) then 
	cd_estabelecimento_w	:= cd_estabelecimento_p;
end if;
 
begin 
	select 	coalesce(ie_inativa_portal, 'N'), 
		ds_msg_portal_inativo 
	into STRICT	ie_inativa_portal_w, 
		ds_msg_portal_inativo_w 
	from	pls_web_param_geral 
	where (coalesce(cd_estabelecimento_w::text, '') = '' 
	or	cd_estabelecimento	= cd_estabelecimento_w);
exception 
when others then 
	ie_inativa_portal_w	:= 'N';
end;
 
if (ie_inativa_portal_w = 'S') then 
	select 	max(ie_status_aplicacao) 
	into STRICT	ie_status_aplicacao_w 
	from 	aplicacao_tasy 
	where 	cd_aplicacao_tasy = 'Tasy';
	 
	if (ie_status_aplicacao_w in ('S', 'U')) then -- Suspenso sistema ou Suspenso usuário 
		ie_portal_inativo_p	:= 'S';
		ds_msg_portal_inativo_p	:= ds_msg_portal_inativo_w;		
	end if;
	 
	 
end if;	
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_obter_se_portal_inativo ( cd_estabelecimento_p bigint, ie_portal_inativo_p INOUT text, ds_msg_portal_inativo_p INOUT text) FROM PUBLIC;

