-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_cheques_cr (nr_seq_cheque_p bigint, nr_cheque_inicial_p text, qt_cheque_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint) AS $body$
DECLARE


nr_seq_cheque_w		bigint;
nr_cheque_w		numeric(20);


BEGIN

nr_cheque_w	:= somente_numero(nr_cheque_inicial_p);

if (nr_seq_cheque_p IS NOT NULL AND nr_seq_cheque_p::text <> '') and (somente_numero(nr_cheque_inicial_p) >= 0) and (coalesce(qt_cheque_p,0) > 0) then

	while(nr_cheque_w	< somente_numero(nr_cheque_inicial_p) + qt_cheque_p) loop
		begin
		select	nextval('cheque_cr_seq')
		into STRICT	nr_seq_cheque_w
		;
		
		begin
		insert into cheque_cr(nr_seq_cheque,
			cd_banco,
			cd_agencia_bancaria,
			nr_conta,
			nr_cheque,
			vl_cheque,
			cd_moeda,
			ie_origem_cheque,
			cd_tipo_portador,
			cd_portador,
			vl_terceiro,
			dt_vencimento,
			dt_contabil,
			ds_observacao,
			cd_pessoa_fisica,
			cd_cgc,
			dt_atualizacao,
			nm_usuario,
			cd_estabelecimento,
			ie_lib_caixa,
			nr_adiantamento,
			tx_juros_cobranca,
			tx_multa_cobranca,
			cd_tipo_taxa_juros,
			cd_tipo_taxa_multa,
			vl_cheque_estrang,
			vl_complemento,
			vl_cotacao)
		SELECT	nr_seq_cheque_w,
			cd_banco,
			cd_agencia_bancaria,
			nr_conta,
			to_char(nr_cheque_w),
			vl_cheque,
			cd_moeda,
			ie_origem_cheque,
			cd_tipo_portador,
			cd_portador,
			vl_terceiro,
			dt_vencimento,
			dt_contabil,
			ds_observacao,
			cd_pessoa_fisica,
			cd_cgc,
			clock_timestamp(),
			nm_usuario_p,
			cd_estabelecimento,
			'S',
			nr_adiantamento,
			tx_juros_cobranca,
			tx_multa_cobranca,
			cd_tipo_taxa_juros,
			cd_tipo_taxa_multa,
			CASE WHEN coalesce(vl_cheque_estrang::text, '') = '' THEN null  ELSE vl_cheque_estrang END ,  -- Projeto Multimoeda - Grava os dados quando for moeda estrangeira
			CASE WHEN coalesce(vl_cheque_estrang::text, '') = '' THEN null  ELSE (vl_cheque - vl_cheque_estrang) END ,
			CASE WHEN coalesce(vl_cheque_estrang::text, '') = '' THEN null  ELSE vl_cotacao END
		from	cheque_cr
		where	nr_seq_cheque	= nr_seq_cheque_p;
		exception when unique_violation then
			CALL wheb_mensagem_pck.exibir_mensagem_abort(1098341); --Não foi possível salvar o registro. Número máximo de registros permitidos é 1.
		end;

		nr_cheque_w	:= nr_cheque_w + 1;
		end;
	end loop;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_cheques_cr (nr_seq_cheque_p bigint, nr_cheque_inicial_p text, qt_cheque_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint) FROM PUBLIC;

