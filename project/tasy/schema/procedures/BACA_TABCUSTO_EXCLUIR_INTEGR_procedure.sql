-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_tabcusto_excluir_integr () AS $body$
DECLARE

 
ds_comando_w	varchar(4000);
qt_registro_w	bigint;

/* 
CAPAC_CENTRO_CONTROLE;CAPCECO_TABCUST_FK 
CRITERIO_DISTR_ORC;CRIDIOR_TABCUST_FK 
CUSTO_MATERIAL;CUSMATE_TABCUST_FK 
CUSTO_PADRAO;CUSPADR_TABCUST_FK 
CUSTO_PROCEDIMENTO;CUSPROC_TABCUST_FK 
CUS_AMORT_MENSAL;CUSAMME_TABCUST_FK 
CUS_REGRA_AJUSTE_ORC;CUSRAJU_TABCUST_FK 
CUS_RESULT_TERC;CUSRETE_TABCUST_FK 
CUS_TERC_MOVTO;CUSTEMO_TABCUST_FK 
ORCAMENTO_CUSTO;ORCCUST_TABCUST_FK 
ORCAMENTO_CUSTO_IMPORT;ORCUIMP_TABCUST_FK 
ORCAMENTO_PACIENTE;ORCPACI_TABCUST_FK 
PRECO_PADRAO_MAT;CUSPRPM_TABCUST_FK 
PRECO_PADRAO_PROC;CUSPRPP_TABCUST_FK 
RESULTADO_CENTRO_CONTROLE;RESCECO_TABCUST_FK 
RESULTADO_IND_CEN_CONT;RESINCC_TABCUST_FK 
RESULTADO_IND_CRITERIO;RESINCR_TABCUST_FK 
TABELA_PARAMETRO;TABPARA_TABCUST_FK 
TABELA_PARAMETRO;TABPARA_TABCUST_FK1 
TABELA_UTILIZADA;TABUTIL_TABCUST_FK 
TABELA_UTILIZADA;TABUTIL_TABCUST_FK2 
TAXA_CUSTO;TAXCUST_TABCUST_FK 
TAXA_CUSTO_NAT;TAXCUNA_TABCUST_FK 
TAXA_CUSTO_OCIO;TAXCUOC_TABCUST_FK 
*/
 
 
c01 CURSOR FOR 
SELECT	a.table_name, 
	a.constraint_name 
from	user_constraints a 
where	a.r_constraint_name = 'TABCUST_PK' 
and	not exists (	SELECT	1 
			from	user_cons_columns y 
			where	y.constraint_name	= a.constraint_name 
			and	y.column_name		= 'NR_SEQ_TABELA');
			
vet01	C01%RowType;


BEGIN 
 
/* ================= INICIO - Eliminar INTEGRIDADES ANTIGAS PARA SUBSTITUIR ===============*/
 
 
open C01;
loop 
fetch C01 into	 
	vet01;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin 
	 
	ds_comando_w	:= 'alter table ' || vet01.table_name || ' drop constraint ' || vet01.constraint_name;
	CALL exec_sql_dinamico('BACA_TBCUS_PK',ds_comando_w);
	 
	end;
end loop;
close C01;
 
/* ========================= FIM Exclusão Integridades ====================================== */
 
 
/* =================== Exclusão CHAVE Primária da NATUREZA_GASTO (CD_ESTABELECIMENTO, CD_NATUREZA_GASTO) === */
 
 
select	count(*) 
into STRICT	qt_registro_w 
from	user_cons_columns 
where	table_name	= 'TABELA_CUSTO' 
and	constraint_name	= 'TABCUST_PK' 
and	column_name	= 'NR_SEQUENCIA';
 
if (qt_registro_w = 0) then 
	CALL exec_sql_dinamico('BACA_TBCUS_PK','alter table TABELA_CUSTO drop constraint TABCUST_PK');
	CALL exec_sql_dinamico('BACA_TBCUS_PK','drop index TABCUST_PK');
end if;
 
/*====================== FIM EXCLUSÂO CHAVE PRIMARIA TABELA_CUSTO===================================*/
 
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_tabcusto_excluir_integr () FROM PUBLIC;

