-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consiste_cancelamento_cirurgia (nr_cirurgia_p bigint) AS $body$
DECLARE



nm_usuario_w               usuario.nm_usuario%type                   := wheb_usuario_pck.get_nm_usuario;
cd_perfil_w                perfil.cd_perfil%type                     := wheb_usuario_pck.get_cd_perfil;
cd_estabelecimento_w       estabelecimento.cd_estabelecimento%type   := wheb_usuario_pck.get_cd_estabelecimento;
ie_permite_com_gastos_w    varchar(15);
ie_contem_disp_w           varchar(1);


BEGIN

if (coalesce(nr_cirurgia_p,0) > 0) then
   ie_permite_com_gastos_w := obter_param_usuario(872, 494, cd_perfil_w, nm_usuario_w, cd_estabelecimento_w, ie_permite_com_gastos_w);

   if (ie_permite_com_gastos_w = 'N') then
      select   coalesce(max('S'),'N')
      into STRICT     ie_contem_disp_w
      from     cirurgia_agente_disp 
      where    nr_cirurgia = nr_cirurgia_p;

      if (ie_contem_disp_w = 'S') then 
         CALL exibir_erro_abortar(Wheb_mensagem_pck.get_texto(347025),null);
      end if;
   end if;
end if;
   
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consiste_cancelamento_cirurgia (nr_cirurgia_p bigint) FROM PUBLIC;

