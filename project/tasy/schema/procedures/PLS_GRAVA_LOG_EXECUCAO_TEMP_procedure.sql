-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_grava_log_execucao_temp ( ds_p pls_log_execucao_temp.ds%type, ds_processo_p pls_log_execucao_temp.ds_processo%type, nm_usuario_p usuario.nm_usuario%type, ie_grava_sempre_p text default 'N', ds_extra_p pls_log_execucao_temp.ds_extra%type default null) AS $body$
DECLARE


nm_id_sid_w	pls_log_execucao_temp.nm_id_sid%type;
nm_id_serial_w	pls_log_execucao_temp.nm_id_serial%type;
ds_sql_w	varchar(500);


BEGIN

if (nm_usuario_p = 'bollaga' or nm_usuario_p = 'wheb.ops' or ie_grava_sempre_p = 'S') then

	begin
		ds_sql_w := 	'select	sid,' || pls_util_pck.enter_w ||
				'	serial#' || pls_util_pck.enter_w ||
				'	from	v$session' || pls_util_pck.enter_w ||
				'where	audsid = userenv(''SESSIONID'')';

		EXECUTE ds_sql_w into STRICT nm_id_sid_w, nm_id_serial_w;

	exception
	when others then
		nm_id_sid_w := null;
		nm_id_serial_w := null;
	end;

	insert into pls_log_execucao_temp(ds, ds_processo, data, nr_sequencia, nm_usuario, nm_id_sid, nm_id_serial, ds_extra)
	values (ds_p, ds_processo_p, clock_timestamp(), nextval('pls_log_execucao_temp_seq'), nm_usuario_p, nm_id_sid_w, nm_id_serial_w, ds_extra_p);
	commit;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_grava_log_execucao_temp ( ds_p pls_log_execucao_temp.ds%type, ds_processo_p pls_log_execucao_temp.ds_processo%type, nm_usuario_p usuario.nm_usuario%type, ie_grava_sempre_p text default 'N', ds_extra_p pls_log_execucao_temp.ds_extra%type default null) FROM PUBLIC;

