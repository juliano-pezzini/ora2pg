-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cpoe_copy_w_proc_glic ( nr_seq_old_procedimento_p bigint, nr_seq_protocolo_p bigint, nr_seq_new_procedimento_p bigint ) AS $body$
DECLARE

	ds_log_w	varchar(2000);
	ds_step_w 	varchar(255);

BEGIN
	ds_step_w := 'Insert';

	insert
	  into cpoe_proc_glic(
		   nr_sequencia,
		   dt_atualizacao,
		   nm_usuario,
		   dt_atualizacao_nrec,
		   nm_usuario_nrec,
		   nr_seq_procedimento,
		   nr_seq_protocolo,
		   qt_glic_inic,
		   qt_glic_fim,
		   qt_ui_insulina,
		   qt_glicose,
		   ds_sugestao,
		   qt_minutos_medicao,
		   qt_ui_insulina_int,
		   nr_seq_proc_edit,
		   nr_atendimento,
		   cd_pessoa_fisica,
		   ie_modificado )
	SELECT nextval('cpoe_proc_glic_seq'),
		   dt_atualizacao,
		   nm_usuario,
		   dt_atualizacao_nrec,
		   nm_usuario_nrec,
		   nr_seq_new_procedimento_p,
		   nr_seq_protocolo,
		   qt_glic_inic,
		   qt_glic_fim,
		   qt_ui_insulina,
		   qt_glicose,
		   ds_sugestao,
		   qt_minutos_medicao,
		   qt_ui_insulina_int,
		   nr_seq_proc_edit,
		   nr_atendimento,
		   cd_pessoa_fisica,
		   ie_modificado
	  from w_cpoe_proc_glic
	 where nr_seq_procedimento = nr_seq_old_procedimento_p
	   and nr_seq_protocolo    = nr_seq_protocolo_p;

	ds_step_w := 'Delete';

	delete
	  from w_cpoe_proc_glic
	 where nr_seq_procedimento = nr_seq_old_procedimento_p
	   and nr_seq_protocolo    = nr_seq_protocolo_p;

	commit;

exception when others then
	rollback;

	ds_log_w := substr('CPOE_COPY_W_PROC_GLIC '
		|| ' - Step: ' || ds_step_w 
		|| ' - nr_seq_old_procedimento_p: ' || nr_seq_old_procedimento_p
		|| ' - nr_seq_protocolo_p: ' || nr_seq_protocolo_p
		|| ' - nr_seq_new_procedimento_p: ' || nr_seq_new_procedimento_p
		|| ' - Exception: ' || to_char(sqlerrm), 1, 2000);

	CALL gravar_log_cpoe(ds_log_w, null, 'P', nr_seq_new_procedimento_p);

	commit;

	CALL wheb_mensagem_pck.exibir_mensagem_abort(to_char(sqlerrm));
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_copy_w_proc_glic ( nr_seq_old_procedimento_p bigint, nr_seq_protocolo_p bigint, nr_seq_new_procedimento_p bigint ) FROM PUBLIC;

