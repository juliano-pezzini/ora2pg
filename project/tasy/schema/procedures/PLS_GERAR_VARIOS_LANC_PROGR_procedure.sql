-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gerar_varios_lanc_progr ( dt_mes_referencia_p timestamp, nr_seq_tipo_lanc_p bigint, ds_observacao_p text, vl_lancamento_p bigint, qt_meses_p bigint, nr_seq_segurado_p bigint, nr_seq_pagador_p bigint, ie_libera_aut_p text, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE

			 
index_w					bigint := 0;
nr_seq_lanc_mensalidade_w		bigint;
dt_mes_w				timestamp;

 

BEGIN 
 
dt_mes_w	:= dt_mes_referencia_p;
 
for index_w in 1..qt_meses_p loop 
	begin 
	 
	SELECT	nextval('pls_lancamento_mensalidade_seq') 
	INTO STRICT 	nr_seq_lanc_mensalidade_w 
	;
	 
	insert	into	pls_lancamento_mensalidade(	nr_sequencia, dt_atualizacao, nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec, 
		ie_tipo_item, dt_ocorrencia,dt_mes_competencia, nr_seq_motivo, cd_estabelecimento, 
		nr_seq_segurado, nr_seq_pagador, vl_lancamento, 
		ds_observacao, ie_situacao) 
	values (	nr_seq_lanc_mensalidade_w, clock_timestamp(), nm_usuario_p, clock_timestamp(), nm_usuario_p, 
		20, clock_timestamp(), dt_mes_w, nr_seq_tipo_lanc_p, cd_estabelecimento_p, 
		nr_seq_segurado_p, nr_seq_pagador_p, vl_lancamento_p, 
		ds_observacao_p, 'A');
	 
	if (ie_libera_aut_p = 'S') then 
		CALL pls_liberar_lanc_automatico(nr_seq_lanc_mensalidade_w, nm_usuario_p);
	end if;
	 
	CALL pls_usuario_centro_lanc_progr(nr_seq_lanc_mensalidade_w,cd_estabelecimento_p,nm_usuario_p);
	 
	dt_mes_w	:= add_months(dt_mes_referencia_p,index_w);
	end;
end loop;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_varios_lanc_progr ( dt_mes_referencia_p timestamp, nr_seq_tipo_lanc_p bigint, ds_observacao_p text, vl_lancamento_p bigint, qt_meses_p bigint, nr_seq_segurado_p bigint, nr_seq_pagador_p bigint, ie_libera_aut_p text, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

