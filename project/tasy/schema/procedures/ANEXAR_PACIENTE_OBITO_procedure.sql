-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE anexar_paciente_obito (nr_sequencia_p bigint, ds_arquivo_p text) AS $body$
BEGIN
if (coalesce(nr_sequencia_p,0) > 0) then

	update 	declaracao_obito
    	set 	ie_situacao = 'I',
		dt_inativacao = clock_timestamp(),
		nm_usuario_inativacao = wheb_usuario_pck.get_nm_usuario
	where  	nr_sequencia = nr_sequencia_p;

	update	regra_numeracao_dec_item a
	set	ie_disponivel = 'S'
	where	nr_declaracao	= (	SELECT	max(nr_declaracao)
					from 	declaracao_obito
					where  	nr_sequencia = nr_sequencia_p);
	commit;

	insert into declaracao_obito(nr_sequencia,
								nm_usuario,
								ie_utilizacao,
								nr_atendimento,
								nm_paciente,
								nr_declaracao,
								dt_obito,
								dt_atualizacao,
								nr_seq_causa_morte,
								cd_cid_adic_3,
								cd_cid_adic_4,
								cd_medico,
								ie_pos_cirurgico,
								cd_cid_direta,
								cd_cid_adic_1,
								cd_cid_adic_2,
								cd_cid_basica,
								nm_pessoa_retirada,
								ie_emissor,
								ie_obito_mulher,
								cd_perfil_ativo,
								cd_medico_adicional,
								ie_situacao,
								dt_liberacao,
								ds_arquivo)
						(SELECT	nextval('declaracao_obito_seq'),
								wheb_usuario_pck.get_nm_usuario,
								ie_utilizacao,
								nr_atendimento,
								nm_paciente,
								nr_declaracao,
								dt_obito,
								clock_timestamp(),
								nr_seq_causa_morte,
								cd_cid_adic_3,
								cd_cid_adic_4,
								cd_medico,
								ie_pos_cirurgico,
								cd_cid_direta,
								cd_cid_adic_1,
								cd_cid_adic_2,
								cd_cid_basica,
								nm_pessoa_retirada,
								ie_emissor,
								ie_obito_mulher,
								cd_perfil_ativo,
								cd_medico_adicional,
								'A',
								clock_timestamp(),
								ds_arquivo_p
						from	declaracao_obito
						where	nr_sequencia = nr_sequencia_p);

end if;


commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE anexar_paciente_obito (nr_sequencia_p bigint, ds_arquivo_p text) FROM PUBLIC;

