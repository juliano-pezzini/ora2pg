-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE sup_definir_valor_atrib_planej ( nm_atributo_p text, cd_material_p bigint, cd_local_estoque_p bigint, cd_estabelecimento_p bigint, vl_retorno_atrib_p INOUT bigint) AS $body$
DECLARE


c001				integer;

nm_atributo_w			varchar(255);
nr_seq_atributo_w			bigint;
vl_retorno_atrib_w			double precision	:= 0;

ds_sql_w				varchar(4000);
vl_coluna_w			varchar(17);


BEGIN

nm_atributo_w	:= substr(nm_atributo_p,2,length(nm_atributo_p));

select	coalesce(max(nr_sequencia),0)
into STRICT	nr_seq_atributo_w
from	sup_atrib_planej_compras
where	cd_estabelecimento = cd_estabelecimento_p
and	ie_situacao = 'A'
and	nm_atributo = nm_atributo_w;

if (coalesce(nr_seq_atributo_w,0) <> 0) then
	begin

	select	upper(ds_sql)
	into STRICT	ds_sql_w
	from	sup_atrib_planej_compras
	where	nr_sequencia = nr_seq_atributo_w;

	if (ds_sql_w IS NOT NULL AND ds_sql_w::text <> '') then
		begin

		ds_sql_w	:= replace(ds_sql_w,':CD_MATERIAL',cd_material_p);
		ds_sql_w := replace(ds_sql_w,':CD_LOCAL_ESTOQUE',cd_local_estoque_p);
		ds_sql_w := replace(ds_sql_w,':CD_ESTABELECIMENTO',cd_estabelecimento_p);

		c001	:= dbms_sql.open_cursor;
		dbms_sql.parse(c001,ds_sql_w,dbms_sql.native);
		dbms_sql.define_column(c001, 1, vl_coluna_w, 17);
		vl_retorno_atrib_w	:= dbms_sql.execute(c001);
		vl_retorno_atrib_w	:= dbms_sql.fetch_rows(c001);
		dbms_sql.column_value(c001,1,vl_coluna_w);
		dbms_sql.close_cursor(c001);

		vl_retorno_atrib_w	:= (vl_coluna_w)::numeric;

		end;
	end if;

	end;
end if;

vl_retorno_atrib_p	:= coalesce(vl_retorno_atrib_w,0);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE sup_definir_valor_atrib_planej ( nm_atributo_p text, cd_material_p bigint, cd_local_estoque_p bigint, cd_estabelecimento_p bigint, vl_retorno_atrib_p INOUT bigint) FROM PUBLIC;

