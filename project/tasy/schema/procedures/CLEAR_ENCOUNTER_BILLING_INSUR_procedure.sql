-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE clear_encounter_billing_insur ( nr_atendimento_p atendimento_paciente.nr_atendimento%type, ie_commit_p text ) AS $body$
DECLARE

					
procedure clear_dep_cta_pendencia is
	;
BEGIN

	delete	from cta_pendencia_audit
	where	nr_seq_pendencia in (SELECT x.nr_sequencia from cta_pendencia x where x.nr_atendimento = nr_atendimento_p);
	
	delete	from cta_pendencia_hist_envio
	where	nr_seq_pend in (SELECT x.nr_sequencia from cta_pendencia x where x.nr_atendimento = nr_atendimento_p);
	
	delete	from cta_pendencia_hist
	where	nr_seq_pend in (SELECT x.nr_sequencia from cta_pendencia x where x.nr_atendimento = nr_atendimento_p);
	
	delete	from cta_pendencia_item
	where	nr_seq_pend in (SELECT x.nr_sequencia from cta_pendencia x where x.nr_atendimento = nr_atendimento_p);
	
	end;

begin
	
if (nr_atendimento_p IS NOT NULL AND nr_atendimento_p::text <> '') then

	/* Tables you can delete */
	
	delete	FROM alerta_auditoria_conpaci	where nr_atendimento = nr_atendimento_p;
	delete	FROM atend_pac_proc_princ		where nr_atendimento = nr_atendimento_p;
	delete	FROM conta_paciente_transf		where nr_atendimento = nr_atendimento_p;
	delete	FROM dispensa_cob_diaria		where nr_atendimento = nr_atendimento_p;
	delete	FROM eis_producao_geral		where nr_atendimento = nr_atendimento_p;
	delete	FROM integracao_gasto_atend		where nr_atendimento = nr_atendimento_p;
	delete	FROM regra_lanc_aut_mat_consist	where nr_atendimento = nr_atendimento_p;
	delete	FROM silab_tasy_item_conta		where nr_atendimento = nr_atendimento_p;
	delete	FROM simulacao			where nr_atendimento = nr_atendimento_p;
	delete	FROM status_integr_conta_pac		where nr_atendimento = nr_atendimento_p;
	delete	FROM taxa_resumo_conta		where nr_atendimento = nr_atendimento_p;
	delete	FROM tf_log_ligacao			where nr_atendimento = nr_atendimento_p;
	
	/* Tables with dependencies */

	clear_dep_cta_pendencia;
	delete	FROM cta_pendencia			where nr_atendimento = nr_atendimento_p;

	if (ie_commit_p = 'S') then
		commit;
	end if;

end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE clear_encounter_billing_insur ( nr_atendimento_p atendimento_paciente.nr_atendimento%type, ie_commit_p text ) FROM PUBLIC;

