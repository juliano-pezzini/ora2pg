-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE reg_ausencia_inter_js ( cd_motivo_p bigint, dia_base_p bigint, mes_base_p text, ds_string_p text, cd_profissional_p text, ano_p text, cd_escala_p bigint, nm_usuario_p text, ie_registrar_p text, ds_texto_p INOUT text, ds_string_cor_p INOUT text, ie_html5_p text default 'N') AS $body$
DECLARE


ie_executar_w 	varchar(1) := 'S';
ds_texto_w	varchar(255);
ds_string_w 	varchar(255);
dt_inicio_w 	timestamp;
dt_fim_w 	timestamp;
dt_base_w timestamp;


BEGIN


if (ie_registrar_p = 'S')then


	if (cd_motivo_p = 0)then

		ie_executar_w	:= 'N';
		ds_texto_w	:= obter_texto_tasy(60399, 1);

	end if;

	if (ie_executar_w = 'S')then


		if (ie_html5_p <> 'S') then
			CALL registrar_ausencia_prof_escala(cd_profissional_p, dia_base_p, mes_base_p, ano_p, to_char(cd_motivo_p), '', cd_escala_p, nm_usuario_p);
			ds_string_w := gerar_string_cal_ausencia(dia_base_p, mes_base_p, ds_string_p, ds_string_w);
		else

			dt_base_w := 	PKG_DATE_UTILS.get_Date(ano_p,(mes_base_p)::numeric ,dia_base_p);
			dt_inicio_w :=  PKG_DATE_UTILS.START_OF(dt_base_w ,'dd');
			dt_fim_w  :=	PKG_DATE_UTILS.END_OF(dt_base_w ,'DAY');

			CALL Reg_ausencia_prof_escala_HTML5(cd_profissional_p, dt_inicio_w,dt_fim_w, to_char(cd_motivo_p), '', cd_escala_p, nm_usuario_p);
			ds_string_w := gerar_str_cal_ausencia_html5(dia_base_p, mes_base_p, ds_string_p, ds_string_w);
		end if;

	end if;

end if;

if (ie_registrar_p = 'N')then

	if (ie_html5_p <> 'S') then
		ds_string_w := carregar_cal_ausencia(cd_profissional_p, cd_escala_p, mes_base_p, ano_p, ds_string_w);
	else
		ds_string_w := carregar_cal_ausencia_html5(cd_profissional_p, cd_escala_p, mes_base_p, ano_p, ds_string_w);
	end if;

end if;

ds_texto_p	:= ds_texto_w;
ds_string_cor_p	:= ds_string_w;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE reg_ausencia_inter_js ( cd_motivo_p bigint, dia_base_p bigint, mes_base_p text, ds_string_p text, cd_profissional_p text, ano_p text, cd_escala_p bigint, nm_usuario_p text, ie_registrar_p text, ds_texto_p INOUT text, ds_string_cor_p INOUT text, ie_html5_p text default 'N') FROM PUBLIC;

