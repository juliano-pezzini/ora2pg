-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE arredondamento_ipe ( vl_procedimento_p INOUT bigint, vl_medico_p INOUT bigint, vl_anestesista_p INOUT bigint, vl_auxiliares_p INOUT bigint, vl_custo_operacional_p INOUT bigint, vl_materiais_p INOUT bigint, nr_decimais_p bigint, ie_tipo_rounded_p text) AS $body$
DECLARE


pr_medico_w			double precision;
pr_anestesista_w			double precision;
pr_auxiliares_w			double precision;
pr_custo_operacional_w		double precision;
vl_procedimento_w			double precision;


BEGIN

pr_medico_w		:= (vl_medico_p / vl_procedimento_p);
pr_anestesista_w		:= (vl_anestesista_p / vl_procedimento_p);
pr_auxiliares_w		:= (vl_auxiliares_p / vl_procedimento_p);
pr_custo_operacional_w	:= (vl_custo_operacional_p / vl_procedimento_p);

vl_procedimento_w 		:= (vl_medico_p + vl_anestesista_p + vl_auxiliares_p + vl_custo_operacional_p + vl_materiais_p);

if  ie_tipo_rounded_p = 'D' then
	begin
	vl_procedimento_w := trunc(vl_procedimento_w , nr_decimais_p);

	vl_procedimento_p := vl_procedimento_w;

	vl_medico_p		:= trunc((vl_procedimento_w * pr_medico_w),nr_decimais_p);
	vl_anestesista_p		:= trunc((vl_procedimento_w * pr_anestesista_w),nr_decimais_p);
	vl_auxiliares_p		:= trunc((vl_procedimento_w * pr_auxiliares_w),nr_decimais_p);
	vl_custo_operacional_p	:= trunc((vl_procedimento_w * pr_custo_operacional_w),nr_decimais_p);
	vl_materiais_p		:= (vl_procedimento_w - (vl_medico_p + vl_anestesista_p + vl_auxiliares_p + vl_custo_operacional_p));
	end;
else
	begin
	vl_procedimento_w := round(vl_procedimento_w , nr_decimais_p);

	vl_procedimento_p := vl_procedimento_w;

	vl_medico_p		:= round((vl_procedimento_w * pr_medico_w),nr_decimais_p);
	vl_anestesista_p		:= round((vl_procedimento_w * pr_anestesista_w),nr_decimais_p);
	vl_auxiliares_p		:= round((vl_procedimento_w * pr_auxiliares_w),nr_decimais_p);
	vl_custo_operacional_p	:= round((vl_procedimento_w * pr_custo_operacional_w),nr_decimais_p);
	vl_materiais_p		:= (vl_procedimento_w - (vl_medico_p + vl_anestesista_p + vl_auxiliares_p + vl_custo_operacional_p));
	end;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE arredondamento_ipe ( vl_procedimento_p INOUT bigint, vl_medico_p INOUT bigint, vl_anestesista_p INOUT bigint, vl_auxiliares_p INOUT bigint, vl_custo_operacional_p INOUT bigint, vl_materiais_p INOUT bigint, nr_decimais_p bigint, ie_tipo_rounded_p text) FROM PUBLIC;

