-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_inserir_same_prontuario () AS $body$
DECLARE

 
cd_pessoa_fisica_w	varchar(10);
nr_Sequencia_w		bigint;
qt_registros_w		bigint;

C01 CURSOR FOR 
	SELECT 	cd_pessoa_fisica 
	from 	pessoa_fisica a 
	where 	(nr_prontuario IS NOT NULL AND nr_prontuario::text <> '') 
	and not exists (SELECT 1 
			  from same_prontuario b 
			  where a.cd_pessoa_fisica = b.cd_pessoa_fisica);


BEGIN 
 
qt_registros_w	:= 0;
 
open C01;
loop 
fetch C01 into	 
	cd_pessoa_fisica_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin 
	 
	select	nextval('same_prontuario_seq') 
	into STRICT	nr_Sequencia_w 
	;
	 
	 
	insert into 
		same_prontuario(nr_sequencia, 
				cd_estabelecimento, 
				ie_tipo, 
				dt_atualizacao, 
				nm_usuario, 
				ie_status, 
				cd_pessoa_fisica, 
				nr_atendimento, 
				nr_seq_agrup, 
				nr_seq_caixa, 
				nr_seq_local, 
				ds_observacao, 
				ie_digitalizado, 
				ie_microfilmado, 
				dt_atualizacao_nrec, 
				nm_usuario_nrec, 
				cd_filme, 
				cd_fotograma, 
				cd_setor_atendimento, 
				dt_periodo_inicial, 
				dt_periodo_final, 
				nr_seq_volume) 
		values (nr_Sequencia_w, 
				1, -- cd_estabelecimento (precisa) 
				'1', 
				clock_timestamp(), 
				'BACA18092008', 
				'1', 
				cd_pessoa_fisica_w, 
				null, -- nr_atendimento 
				null, -- nr_seq_agrup 
				null, -- nr_seq_caixa 
				null, -- nr_seq_local (precisa) 
				'Importação 18/09/2008', 
				'N', 
				'N', 
				clock_timestamp(), 
				'BACA18092008', 
				null, -- cd_filme 
				null, --cd_fotograma 
				34, --cd_seotr_atendimento (precisa) 
				null, --dt_periodo_inicial 
				null, --dt_periodo_final, 
				1);
				 
	qt_registros_w	:= qt_registros_w + 1;
			 
	if (qt_registros_w > 4998) then 
		commit;
		qt_registros_w	:= 0;
		 
	end if;
	 
	/*insert into logxxxxx_tasy (dt_atualizacao,nm_usuario,cd_log,ds_log) 
	values(sysdate,'BACA18092008',58741,'Adicionado o prontuário para a pessoa ' || cd_pessoa_fisica_w);*/
 
	 
	CALL Gestao_Prontuario_Same(nr_Sequencia_w,'BACA18092008',null,null,null /*Local*/
, null/*Caixa*/
,null,null,8,null,null,null);
	 
	end;
end loop;
close C01;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_inserir_same_prontuario () FROM PUBLIC;

