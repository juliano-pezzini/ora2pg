-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consiste_regra_alta_saida_real (dt_saida_real_p timestamp, nr_atendimento_p bigint, cd_setor_atendimento_p bigint, ds_consistencia_p INOUT text, nm_usuario_p text ) AS $body$
DECLARE

 
qt_tempo_minuto_w	bigint;
qt_tempo_minuto_regra_w	bigint;
ie_tipo_atendimento_w	smallint;
dt_alta_w		timestamp;

c01 CURSOR FOR 
	SELECT	coalesce(qt_tempo_minuto,0) 
	from	regra_alta_saida_real 
	where	coalesce(cd_setor_atendimento,cd_setor_atendimento_p) = cd_setor_atendimento_p 
	and	coalesce(ie_tipo_atendimento,ie_tipo_atendimento_w) = ie_tipo_atendimento_w 
	order by coalesce(ie_tipo_atendimento,0), 
		coalesce(cd_setor_atendimento,0);

BEGIN
 
qt_tempo_minuto_w	:= 0;
 
select	max(dt_alta), 
	max(ie_tipo_atendimento) 
into STRICT	dt_alta_w, 
	ie_tipo_atendimento_w 
from	atendimento_paciente 
where	nr_atendimento = nr_atendimento_p;
 
open c01;
loop 
fetch c01 into 
	qt_tempo_minuto_regra_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin 
	qt_tempo_minuto_w	:= qt_tempo_minuto_regra_w;
	end;
end loop;
close c01;
 
if (qt_tempo_minuto_w > 0) then 
 
 
	if	((dt_saida_real_p - dt_alta_w) * 1440 > qt_tempo_minuto_w) then 
 
		ds_consistencia_p	:= obter_desc_expressao(774964);
 
	end if;
 
end if;
 
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consiste_regra_alta_saida_real (dt_saida_real_p timestamp, nr_atendimento_p bigint, cd_setor_atendimento_p bigint, ds_consistencia_p INOUT text, nm_usuario_p text ) FROM PUBLIC;

