-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_protocolo_recomendacao (cd_protocolo_dest_p bigint , nr_seq_destino_p bigint , item_recomendacao_p text) AS $body$
DECLARE

  nm_usuario_w varchar(255);

BEGIN
    nm_usuario_w := wheb_usuario_pck.get_nm_usuario;

    IF (item_recomendacao_p IS NOT NULL AND item_recomendacao_p::text <> '') THEN
      INSERT INTO protocolo_medic_rec(cd_protocolo
                   , nr_sequencia
                   , nr_seq_rec
                   , dt_atualizacao
                   , nm_usuario
                   , ds_recomendacao
                   , cd_recomendacao
                   , cd_intervalo
                   , ds_horarios
                   , ie_acm
                   , ie_se_necessario
                   , ie_urgencia
                   , nr_seq_topografia
				   , nr_seq_classif)
      SELECT cd_protocolo_dest_p
             , nr_seq_destino_p
             , nr_sequencia
             , clock_timestamp()
             , nm_usuario_w
             , Substr(ds_recomendacao, 1, 255)
             , cd_recomendacao
             , cd_intervalo
             , ds_horarios
             , ie_acm
             , ie_se_necessario
             , ie_urgencia
             , nr_seq_topografia
			 , obter_classif_rec(cd_recomendacao)
      FROM   cpoe_recomendacao
      WHERE  nr_sequencia = item_recomendacao_p;
    END IF;

    COMMIT;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_protocolo_recomendacao (cd_protocolo_dest_p bigint , nr_seq_destino_p bigint , item_recomendacao_p text) FROM PUBLIC;

