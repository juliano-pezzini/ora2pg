-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_transacao_financeira ( nr_seq_transacao_p bigint, nm_usuario_p text, ie_dependentes_p text) AS $body$
DECLARE


nr_sequencia_w		bigint;


BEGIN

select	nextval('transacao_financeira_seq')
into STRICT	nr_sequencia_w
;

insert into transacao_financeira(
	nr_sequencia,
	cd_transacao,
	ds_transacao,
	dt_atualizacao,
	nm_usuario,
	ie_caixa,
	ie_banco,
	ie_extra_caixa,
	ie_conta_pagar,
	ie_conta_receber,
	ie_saldo_caixa,
	ie_acao,
	nr_seq_trans_banco,
	ie_autenticar,
	cd_conta_financ,
	cd_estabelecimento,
	ie_situacao,
	cd_historico_banco,
	ie_centro_custo,
	ie_contab_banco,
	dt_atualizacao_nrec,
	nm_usuario_nrec,
	cd_historico_caixa,
	cd_empresa,
	cd_tipo_recebimento,
	ie_cheque_cr,
	ie_cartao_cr,
	ie_cartao_debito,
	nr_seq_trans_transf,
	ie_especie,
	IE_DEV_CHEQUE,
	IE_NEGOCIACAO_CHEQUE_CR,
	cd_tipo_baixa,
	ds_orientacao,
	NR_SEQ_TRANS_CHEQUE,
	NR_SEQ_TRANS_DEV_ADIANT,
	IE_VARIACAO_CAMBIAL,
	NR_SEQ_TRANS_BANCO_CAIXA,
	IE_PROJ_REC,
	IE_CRED_NAO_IDENT,
	CD_EXTERNO,
	IE_FRANQUIA,
	IE_REGRA_CONTAB_EMPRESA,
	IE_REPASSE_ITEM,
	IE_RECEB_ADIANT,
	ie_contab_cb,
	IE_CONTAB_TESOURARIA,
	IE_TITULO_PAGAR,
	IE_ADIANT_PAGO,
	IE_TIT_PAGAR_ADIANT,
	IE_ESTORNAR_CB,
	IE_ESTORNAR_TES,
	IE_BAIXA_CARTAO_CR,
	IE_TRANS_TAXA_CAIXA,
	IE_CONFIRMACAO_CB,
	IE_CONTROLE_BANC,
	IE_RECEB_CHEQUE,
	IE_RECEB_CARTAO,
	IE_RPS_CAIXA_RECEB,
	IE_CGC_CAIXA_RECEB,
	IE_OBS_ADIANTAMENTO,
	IE_RECIBO_CB,
	IE_AGRUPA_LOTE_CB,
	IE_SALDO_CB_ACAO_INVERSA)
(SELECT	nr_sequencia_w,
	cd_transacao,
	--'Cópia '
	wheb_mensagem_pck.get_texto(302526) || ds_transacao,
	clock_timestamp(),
	nm_usuario_p,
	ie_caixa,
	ie_banco,
	ie_extra_caixa,
	ie_conta_pagar,
	ie_conta_receber,
	ie_saldo_caixa,
	ie_acao,
	nr_seq_trans_banco,
	ie_autenticar,
	cd_conta_financ,
	cd_estabelecimento,
	ie_situacao,
	cd_historico_banco,
	ie_centro_custo,
	ie_contab_banco,
	clock_timestamp(),
	nm_usuario_p,
	cd_historico_caixa,
	cd_empresa,
	cd_tipo_recebimento,
	ie_cheque_cr,
	ie_cartao_cr,
	ie_cartao_debito,
	nr_seq_trans_transf,
	ie_especie,
	IE_DEV_CHEQUE,
	IE_NEGOCIACAO_CHEQUE_CR,
	cd_tipo_baixa,
	ds_orientacao,
	NR_SEQ_TRANS_CHEQUE,
	NR_SEQ_TRANS_DEV_ADIANT,
	IE_VARIACAO_CAMBIAL,
	NR_SEQ_TRANS_BANCO_CAIXA,
	IE_PROJ_REC,
	IE_CRED_NAO_IDENT,
	CD_EXTERNO,
	IE_FRANQUIA,
	IE_REGRA_CONTAB_EMPRESA,
	IE_REPASSE_ITEM,
	IE_RECEB_ADIANT,
	ie_contab_cb,
	IE_CONTAB_TESOURARIA,
	IE_TITULO_PAGAR,
	IE_ADIANT_PAGO,
	IE_TIT_PAGAR_ADIANT,
	IE_ESTORNAR_CB,
	IE_ESTORNAR_TES,
	IE_BAIXA_CARTAO_CR,
	IE_TRANS_TAXA_CAIXA,
	IE_CONFIRMACAO_CB,
	IE_CONTROLE_BANC,
	IE_RECEB_CHEQUE,
	IE_RECEB_CARTAO,
	IE_RPS_CAIXA_RECEB,
	IE_CGC_CAIXA_RECEB,
	IE_OBS_ADIANTAMENTO,
	IE_RECIBO_CB,
	IE_AGRUPA_LOTE_CB,
	IE_SALDO_CB_ACAO_INVERSA
from	transacao_financeira
where	nr_sequencia	= nr_seq_transacao_p);

/* Francisco - OS 86332 - 18/03/2008 - Duplicar também as tabelas dependentes */

if (ie_dependentes_p = 'S') then


	/* Campos da transação */

	insert	into	trans_financ_campo(nr_sequencia,
		nr_seq_trans_financ,
		dt_atualizacao,
		nm_usuario,
		nm_atributo,
		ie_obrigatorio,
		nm_atributo_mut_excl,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		ie_primeiro_focus)
	SELECT	nextval('trans_financ_campo_seq'),
		nr_sequencia_w,
		clock_timestamp(),
		nm_usuario_p,
		nm_atributo,
		ie_obrigatorio,
		nm_atributo_mut_excl,
		clock_timestamp(),
		nm_usuario_p,
		coalesce(ie_primeiro_focus,'N')
	from	trans_financ_campo
	where	nr_seq_trans_financ	= nr_seq_transacao_p;

	/* Regras de contabilização */

	insert	into	trans_financ_contab(nr_sequencia,
		nr_seq_trans_financ,
		ie_debito_credito,
		ie_regra_conta,
		ie_regra_centro_custo,
		dt_atualizacao,
		nm_usuario,
		cd_conta_contabil,
		cd_centro_custo,
		nm_atributo,
		cd_historico,
		ie_valor_absoluto,
		ie_situacao,
		cd_estabelecimento,
		dt_inicio_vigencia,
		dt_fim_vigencia,
		cd_tipo_lote_contabil,
		cd_tributo,
		nr_seq_rateio_ccusto,
		nr_seq_produto,
		ie_tipo_titulo_pagar,
		ie_origem_tit_pagar,
		nr_seq_classe_tp,
		ie_origem_tit_receber,
		cd_tipo_recebimento,
		ie_tipo_custo,
		cd_tipo_baixa,
		ie_tipo_pessoa)
	SELECT	nextval('trans_financ_contab_seq'),
		nr_sequencia_w,
		ie_debito_credito,
		ie_regra_conta,
		ie_regra_centro_custo,
		clock_timestamp(),
		nm_usuario_p,
		cd_conta_contabil,
		cd_centro_custo,
		nm_atributo,
		cd_historico,
		ie_valor_absoluto,
		ie_situacao,
		cd_estabelecimento,
		dt_inicio_vigencia,
		dt_fim_vigencia,
		cd_tipo_lote_contabil,
		cd_tributo,
		nr_seq_rateio_ccusto,
		nr_seq_produto,
		ie_tipo_titulo_pagar,
		ie_origem_tit_pagar,
		nr_seq_classe_tp,
		ie_origem_tit_receber,
		cd_tipo_recebimento,
		ie_tipo_custo,
		cd_tipo_baixa,
		ie_tipo_pessoa
	from	trans_financ_contab
	where	nr_seq_trans_financ	= nr_seq_transacao_p;

	/* Taxas */

	insert	into	trans_financ_taxa(nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		nr_seq_trans_financ,
		nr_seq_trans_fin_taxa,
		pr_taxa,
		dt_atualizacao_nrec,
		nm_usuario_nrec)
	SELECT	nextval('trans_financ_taxa_seq'),
		clock_timestamp(),
		nm_usuario_p,
		nr_sequencia_w,
		nr_seq_trans_fin_taxa,
		pr_taxa,
		clock_timestamp(),
		nm_usuario_p
	from	trans_financ_taxa
	where	nr_seq_trans_financ	= nr_seq_transacao_p;

	/* Caixas liberados para transação */

	insert	into	trans_financ_caixa(nr_sequencia,
		nr_seq_transacao,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_caixa)
	SELECT	nextval('trans_financ_caixa_seq'),
		nr_sequencia_w,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		nr_seq_caixa
	from	trans_financ_caixa
	where	nr_seq_transacao	= nr_seq_transacao_p;

	/* Usuários liberados para a transação */

	insert	into	trans_financ_usuario(nr_sequencia,
		nr_seq_transacao,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		nm_usuario_param,
		cd_perfil)
	SELECT	nextval('trans_financ_usuario_seq'),
		nr_sequencia_w,
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_param,
		cd_perfil
	from	trans_financ_usuario
	where	nr_seq_transacao	= nr_seq_transacao_p;

	/* Estabelecimentos liberados */

	insert	into	trans_financ_estab(nr_sequencia,
		nr_seq_trans_financ,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		cd_estab_liberado)
	SELECT	nextval('trans_financ_estab_seq'),
		nr_sequencia_w,
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		cd_estab_liberado
	from	trans_financ_estab
	where	nr_seq_trans_financ	= nr_seq_transacao_p;


end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_transacao_financeira ( nr_seq_transacao_p bigint, nm_usuario_p text, ie_dependentes_p text) FROM PUBLIC;

