-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_comunic_privacy_notice ( dt_initial_vigencia_P timestamp, nm_usuario_p text, IE_NOTIFICATION_p text, nr_seq_comunic_atual_p bigint, nr_seq_comunic_p INOUT bigint ) AS $body$
DECLARE

nr_sequencia_w  bigint;
  -- AUTHOR : ANAND MENTHE
BEGIN
  IF (IE_NOTIFICATION_p = 'S') THEN
    SELECT nextval('comunic_interna_seq') INTO STRICT nr_sequencia_w;

    INSERT
    INTO comunic_interna(
        nr_sequencia,
        dt_comunicado,
        ds_titulo,
        ds_comunicado,
        nm_usuario,
        dt_atualizacao,
        ie_geral,
        ie_gerencial,
        dt_agendamento,
        dt_liberacao
      )
      VALUES (
        nr_sequencia_w ,
        dt_initial_vigencia_p,
        wheb_mensagem_pck.get_texto(1033331),
        wheb_mensagem_pck.get_texto(1033332),
        nm_usuario_p,
        clock_timestamp(),
        'S',
        'N',
        dt_initial_vigencia_p,
        NULL
      );
  END IF;

  nr_seq_comunic_p  := nr_sequencia_w;

  IF (IE_NOTIFICATION_P = 'N') THEN

    DELETE  from comunic_interna
    WHERE   nr_sequencia = nr_seq_comunic_atual_p
    and     coalesce(dt_liberacao::text, '') = '';

    nr_seq_comunic_p := null;
 END IF;

  END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_comunic_privacy_notice ( dt_initial_vigencia_P timestamp, nm_usuario_p text, IE_NOTIFICATION_p text, nr_seq_comunic_atual_p bigint, nr_seq_comunic_p INOUT bigint ) FROM PUBLIC;

