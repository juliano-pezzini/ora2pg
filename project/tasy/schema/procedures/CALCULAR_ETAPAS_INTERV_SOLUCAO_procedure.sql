-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE calcular_etapas_interv_solucao ( cd_intervalo_p text, qt_tempo_infusao_p bigint, ie_Arred_etapas_P text, qt_hora_fase_p INOUT bigint, nr_etapas_p INOUT bigint, qt_volume_sol_p bigint default null, qt_vel_infusao_p bigint default null) AS $body$
DECLARE


ie_operacao_w			varchar(5);
qt_operacao_w			double precision;
ie_continuo_w			varchar(1);
ie_utiliza_quantidade_w	intervalo_prescricao.ie_utiliza_quantidade%type;
ie_agora_w				intervalo_prescricao.ie_agora%type;
sql_w varchar(2500);
qt_hora_fase_w bigint;
ie_considera_operacao_w char(1) := '';


BEGIN

if (cd_intervalo_p IS NOT NULL AND cd_intervalo_p::text <> '') then

	Select	max(a.ie_operacao),
			max(a.qt_operacao),
			coalesce(max(ie_continuo),'N'),
			coalesce(max(ie_utiliza_quantidade),'N'),
			coalesce(max(ie_agora),'N')
	into STRICT 	ie_operacao_w,
			qt_operacao_w,
			ie_continuo_w,
			ie_utiliza_quantidade_w,
			ie_agora_w
	from	intervalo_prescricao a
	where	a.cd_intervalo = cd_intervalo_p;

    begin
        sql_w := 'CALL OBTER_CALCULO_ETAP_INT_SOL_MD(:1, :2, :3, :4, :5, :6) INTO :qt_hora_fase_w';
        EXECUTE sql_w USING
			  IN ie_operacao_w,
              IN qt_operacao_w,
              IN ie_continuo_w,
              IN qt_tempo_infusao_p,
              IN qt_volume_sol_p,
              IN qt_vel_infusao_p,
              OUT qt_hora_fase_w;
    exception
    when others then
        qt_hora_fase_w := null;
    end;
    qt_hora_fase_p := qt_hora_fase_w;

	begin
		if (obter_funcao_ativa <> 2314) then
			ie_considera_operacao_w := 'S';
		else
			ie_considera_operacao_w := 'N';
		end if;

		sql_w := 'CALL OBTER_NR_ETAPAS_MD(:1, :2, :3, :4, :5, :6, :7, :8) INTO :nr_etapas_p';
		EXECUTE sql_w USING
			IN qt_tempo_infusao_p,
			IN ie_Arred_etapas_P,
			IN qt_hora_fase_p,
			IN ie_utiliza_quantidade_w,
			IN ie_agora_w,
			IN ie_operacao_w,
			IN qt_operacao_w,
			IN ie_considera_operacao_w,
			OUT nr_etapas_p;
	exception
		when others then
			nr_etapas_p := null;
	end;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE calcular_etapas_interv_solucao ( cd_intervalo_p text, qt_tempo_infusao_p bigint, ie_Arred_etapas_P text, qt_hora_fase_p INOUT bigint, nr_etapas_p INOUT bigint, qt_volume_sol_p bigint default null, qt_vel_infusao_p bigint default null) FROM PUBLIC;

