-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_ajustar_base_dialise (nm_usuario_p text) AS $body$
DECLARE


qt_registro_w		bigint;


BEGIN

CALL abortar_se_base_wheb();

/* Ivan - 27/08/2007 */

if (clock_timestamp() < to_date('01/01/2008','dd/mm/yyyy')) then

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_CONTROLE'
	and	column_name	= 'NR_SEQ_TIPO_CONTROLE';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table hd_controle drop constraint HDCONTO_HDTICON_FK');
		CALL Exec_Sql_Dinamico('Dialise','drop index HDCONTO_HDTICON_FK_I');
		CALL Exec_Sql_Dinamico('Dialise','alter table hd_controle drop column NR_SEQ_TIPO_CONTROLE');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_CONTROLE'
	and	column_name	= 'QT_VALOR';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table hd_controle drop column QT_VALOR');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tables
	where	table_name = 'HD_TIPO_CONTROLE';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','drop table hd_tipo_controle');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_PRC_AVALIACAO'
	and	column_name	= 'CD_PESSOA_FISICA';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table hd_prc_avaliacao drop constraint HDPRCAV_HDPAREC_FK');
		CALL Exec_Sql_Dinamico('Dialise','drop index HDPRCAV_HDPAREC_FK_I');
		CALL Exec_Sql_Dinamico('Dialise','alter table hd_prc_avaliacao drop column CD_PESSOA_FISICA');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE_EVENTO'
	and	column_name	= 'DS_RESULTADO';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE_EVENTO drop column DS_RESULTADO');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE_EVENTO'
	and	column_name	= 'DS_OBSERVACAO';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE_EVENTO drop column DS_OBSERVACAO');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_COMPLICACAO'
	and	column_name	= 'DS_RESULTADO';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_COMPLICACAO drop column DS_RESULTADO');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_PRC_AVALIACAO'
	and	column_name	= 'NR_NOTA';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_PRC_AVALIACAO drop column NR_NOTA');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALIZADOR'
	and	column_name	= 'IE_SITUACAO';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALIZADOR drop column IE_SITUACAO');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE'
	and	column_name	= 'NR_SEQ_MAQUINA';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table hd_dialise drop constraint HDDIALE_HDMAQDI_FK');
		CALL Exec_Sql_Dinamico('Dialise','drop index HDDIALE_HDMAQDI_FK_I');
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE drop column NR_SEQ_MAQUINA');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE'
	and	column_name	= 'NR_SEQ_DIALIZADOR';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table hd_dialise drop constraint HDDIALE_HDDIALI_FK');
		CALL Exec_Sql_Dinamico('Dialise','drop index HDDIALE_HDDIALI_FK_I');
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE drop column NR_SEQ_DIALIZADOR');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE'
	and	column_name	= 'DT_MONTAGEM_DIALIZADOR';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE drop column DT_MONTAGEM_DIALIZADOR');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE'
	and	column_name	= 'DT_RETIRADA_DIALIZADOR';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE drop column DT_RETIRADA_DIALIZADOR');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE'
	and	column_name	= 'NR_SEQ_REPROC';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table hd_dialise drop constraint HDDIALE_HDREPDI_FK');
		CALL Exec_Sql_Dinamico('Dialise','drop index HDDIALE_HDREPDI_FK_I');
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE drop column NR_SEQ_REPROC');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE'
	and	column_name	= 'DT_LAVAGEM';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE drop column DT_LAVAGEM');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE'
	and	column_name	= 'PR_PERDA';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE drop column PR_PERDA');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE'
	and	column_name	= 'DT_TESTE_SOL_ESTER1';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE drop column DT_TESTE_SOL_ESTER1');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE'
	and	column_name	= 'IE_RESULT_SOL_ESTER1';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE drop column IE_RESULT_SOL_ESTER1');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE'
	and	column_name	= 'DT_TESTE_SOL_ESTER2';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE drop column DT_TESTE_SOL_ESTER2');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE'
	and	column_name	= 'IE_RESULT_SOL_ESTER2';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE drop column IE_RESULT_SOL_ESTER2');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE'
	and	column_name	= 'QT_PRIME';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE drop column QT_PRIME');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE'
	and	column_name	= 'CD_PF_MONT_DIALIZ';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE drop column CD_PF_MONT_DIALIZ');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE'
	and	column_name	= 'CD_PF_RETIR_DIALIZ';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE drop column CD_PF_RETIR_DIALIZ');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE'
	and	column_name	= 'CD_PF_LAVAGEM';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE drop column CD_PF_LAVAGEM');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALIZADOR'
	and	column_name	= 'DT_AQUISICAO';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALIZADOR drop column DT_AQUISICAO');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALIZADOR'
	and	column_name	= 'DS_MODELO';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALIZADOR drop column DS_MODELO');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE_DIALISADOR'
	and	column_name	= 'DT_TESTE_SOL_ESTER1';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE_DIALISADOR drop column DT_TESTE_SOL_ESTER1');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE_DIALISADOR'
	and	column_name	= 'DT_TESTE_SOL_ESTER2';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE_DIALISADOR drop column DT_TESTE_SOL_ESTER2');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE_DIALISADOR'
	and	column_name	= 'IE_RESULT_SOL_ESTER1';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE_DIALISADOR drop column IE_RESULT_SOL_ESTER1');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE_DIALISADOR'
	and	column_name	= 'IE_RESULT_SOL_ESTER2';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE_DIALISADOR drop column IE_RESULT_SOL_ESTER2');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_objects
	where	object_name = 'HD_ATUALIZAR_LAVAGEM';

	if (qt_registro_w > 0) then
		CALL Exec_sql_Dinamico('Dialise', 'drop procedure HD_ATUALIZAR_LAVAGEM'
);
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_objects
	where	object_name = 'HD_OBTER_DIALISE_DIALIZADOR';

	if (qt_registro_w > 0) then
		CALL Exec_sql_Dinamico('Dialise', 'drop function HD_OBTER_DIALISE_DIALIZADOR'
);
	end if;

	update	funcao_parametro
	set	ds_parametro		= 'Forma de visualização da diálise',
		cd_dominio		= 1918,
		vl_parametro_padrao	= 'T'
	where	cd_funcao		= 7009
	and	nr_sequencia		= 1
	and	ds_parametro		<> 'Forma de visualização da diálise';

	update	funcao_parametro
	set	ds_parametro		= 'Permite acessar a pasta de gestão de dialisador'
	where	cd_funcao		= 7009
	and	nr_sequencia		= 2
	and	ds_parametro		<> 'Permite acessar a pasta de gestão de dialisador';

	update	funcao_parametro
	set	ds_parametro		= 'Permite acessar a pasta de cadastros da diálise'
	where	cd_funcao		= 7009
	and	nr_sequencia		= 3
	and	ds_parametro		<> 'Permite acessar a pasta de cadastros da diálise';

	update	funcao_parametro
	set	ds_parametro		= 'Permite chamada para a função Prontuário Eletrônico de Paciente - PEP'
	where	cd_funcao		= 7009
	and	nr_sequencia		= 4
	and	ds_parametro		<> 'Permite chamada para a função Prontuário Eletrônico de Paciente - PEP';

	update	funcao_parametro
	set	ds_parametro		= 'Permite chamada para a função Administração Eletrônica de Paciente - ADEP'
	where	cd_funcao		= 7009
	and	nr_sequencia		= 5
	and	ds_parametro		<> 'Permite chamada para a função Administração Eletrônica de Paciente - ADEP';

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_PAC_RENAL_CRONICO'
	and	column_name	= 'DT_CHEGADA';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_PAC_RENAL_CRONICO drop column DT_CHEGADA');
		end;
	end if;

	delete	from valor_dominio
	where	cd_dominio = 1898
	and	vl_dominio = 'L';

	delete	from valor_dominio
	where	cd_dominio = 1898
	and	vl_dominio = 'Z';

	delete	from valor_dominio
	where	cd_dominio = 1898
	and	vl_dominio = 'T';

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE_DIALISADOR'
	and	column_name	= 'NR_SEQ_ACESSO';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table hd_dialise_dialisador drop constraint HDDIADIA_HDACESS_FK');
		CALL Exec_Sql_Dinamico('Dialise','alter table hd_dialise_dialisador drop column NR_SEQ_ACESSO');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISADOR_TESTE'
	and	column_name	= 'DT_PRIM_TESTE';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISADOR_TESTE drop column DT_PRIM_TESTE');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISADOR_TESTE'
	and	column_name	= 'IE_RESULT_PRIM_TESTE';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISADOR_TESTE drop column IE_RESULT_PRIM_TESTE');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISADOR_TESTE'
	and	column_name	= 'DT_SEG_TESTE';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISADOR_TESTE drop column DT_SEG_TESTE');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISADOR_TESTE'
	and	column_name	= 'IE_RESULT_SEG_TESTE';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISADOR_TESTE drop column IE_RESULT_SEG_TESTE');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISADOR_TESTE'
	and	column_name	= 'CD_PF_PRIM_TESTE';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISADOR_TESTE drop column CD_PF_PRIM_TESTE');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISADOR_TESTE'
	and	column_name	= 'CD_PF_SEG_TESTE';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISADOR_TESTE drop column CD_PF_SEG_TESTE');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_objects
	where	object_name = 'HD_PRIMEIRO_TESTE_APC';

	if (qt_registro_w > 0) then
		CALL Exec_sql_Dinamico('Dialise', 'drop procedure HD_PRIMEIRO_TESTE_APC'
);
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_objects
	where	object_name = 'HD_SEGUNDO_TESTE_APC';

	if (qt_registro_w > 0) then
		CALL Exec_sql_Dinamico('Dialise', 'drop procedure HD_SEGUNDO_TESTE_APC'
);
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_COMPLICACAO';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','drop table HD_COMPLICACAO');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_TIPO_COMPLICACAO';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','drop table HD_TIPO_COMPLICACAO');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_objects
	where	object_name = 'HD_INSERIR_COMPLICACAO_DIALISE';

	if (qt_registro_w > 0) then
		CALL Exec_sql_Dinamico('Dialise', 'drop procedure HD_INSERIR_COMPLICACAO_DIALISE'
);
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_objects
	where	object_name = 'HD_OBTER_EVENT_COMPLIC_DIAL';

	if (qt_registro_w > 0) then
		CALL Exec_sql_Dinamico('Dialise', 'drop function HD_OBTER_EVENT_COMPLIC_DIAL'
);
	end if;

	update	funcao_parametro
	set	ds_parametro		= 'Forma de visualização da hemodiálise'
	where	cd_funcao		= 7009
	and	nr_sequencia		= 1
	and	ds_parametro		<> 'Forma de visualização da hemodiálise';

	update	funcao_parametro
	set	ds_parametro		= 'Permite acessar a pasta de cadastros da hemodiálise'
	where	cd_funcao		= 7009
	and	nr_sequencia		= 3
	and	ds_parametro		<> 'Permite acessar a pasta de cadastros da hemodiálise';

	update	funcao_parametro
	set	ds_parametro		= 'Tempo em segundos para atualização automática das consultas da hemodiálise (zero não atualiza automaticamente)'
	where	cd_funcao		= 7009
	and	nr_sequencia		= 10
	and	ds_parametro		<> 'Tempo em segundos para atualização automática das consultas da hemodiálise (zero não atualiza automaticamente)';

	update	funcao_parametro
	set	ds_parametro		= 'Permitir alterauser_tab_o da hemodiálise'
	where	cd_funcao		= 7009
	and	nr_sequencia		= 13
	and	ds_parametro		<> 'Permitir alterar o número da hemodiálise';

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE_DIALISADOR'
	and	column_name	= 'CD_PF_REPROCESSAMENTO';

	if (qt_registro_w > 0) then
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE_DIALISADOR drop column CD_PF_REPROCESSAMENTO');
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE_DIALISADOR'
	and	column_name	= 'DT_REPROCESSAMENTO';

	if (qt_registro_w > 0) then
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE_DIALISADOR drop column DT_REPROCESSAMENTO');
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE_DIALISADOR'
	and	column_name	= 'CD_PF_REPROC_FIM';

	if (qt_registro_w > 0) then
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE_DIALISADOR drop column CD_PF_REPROC_FIM');
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE_DIALISADOR'
	and	column_name	= 'DT_REPROC_FIM';

	if (qt_registro_w > 0) then
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE_DIALISADOR drop column DT_REPROC_FIM');
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE_DIALISADOR'
	and	column_name	= 'NR_SEQ_REPROC';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE_DIALISADOR drop constraint HDDIADIA_HDREPDI_FK');
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE_DIALISADOR drop column NR_SEQ_REPROC');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from 	user_cons_columns
	where	constraint_name	= 'HDPAREC_HDUNIDD_FK';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_PAC_RENAL_CRONICO drop constraint HDPAREC_HDUNIDD_FK');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from 	user_cons_columns
	where	constraint_name	= 'HDDIALI_HDUNIDD_FK';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALIZADOR drop constraint HDDIALI_HDUNIDD_FK');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from 	user_cons_columns
	where	constraint_name	= 'HDUNIDD_PK';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_UNIDADE_DIALISE drop constraint HDUNIDD_PK');
		CALL Exec_Sql_Dinamico('Dialise','drop index HDUNIDD_PK');
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALIZADOR'
	and	column_name	= 'NR_SEQ_UNID_DIALISE';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','
			update	hd_dializador a
			set	a.nr_seq_unid_dialise	=
				(
					select	b.nr_sequencia
					from	hd_unidade_dialise b
					where	b.cd_cgc	= a.cd_unid_dialise
				)
			where	a.cd_unid_dialise is not null
			and	a.nr_seq_unid_dialise is null;
		');
		commit;
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_PAC_RENAL_CRONICO'
	and	column_name	= 'NR_SEQ_UNID_DIALISE';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','
			update	hd_pac_renal_cronico a
			set	a.nr_seq_unid_dialise	=
				(
					select	b.nr_sequencia
					from	hd_unidade_dialise b
					where	b.cd_cgc	= a.cd_unid_dialise
				)
			where	a.cd_unid_dialise is not null
			and	a.nr_seq_unid_dialise is null;
		');
		commit;
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE'
	and	column_name	= 'NR_SEQ_UNID_DIALISE';

	if (qt_registro_w > 0) then
		begin
		CALL Exec_Sql_Dinamico('Dialise','
			update	hd_dialise a
			set	a.nr_seq_unid_dialise	=
				(
					select	b.nr_sequencia
					from	hd_unidade_dialise b
					where	b.cd_cgc	= a.cd_unid_dialise
				)
			where	a.cd_unid_dialise is not null
			and	a.nr_seq_unid_dialise is null;
		');
		commit;
		end;
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALISE'
	and	column_name	= 'CD_UNID_DIALISE';

	if (qt_registro_w > 0) then
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALISE drop column CD_UNID_DIALISE');
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_PAC_RENAL_CRONICO'
	and	column_name	= 'CD_UNID_DIALISE';

	if (qt_registro_w > 0) then
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_PAC_RENAL_CRONICO drop column CD_UNID_DIALISE');
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALIZADOR'
	and	column_name	= 'CD_UNID_DIALISE';

	if (qt_registro_w > 0) then
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALIZADOR drop column CD_UNID_DIALISE');
	end if;

	select	count(*)
	into STRICT	qt_registro_w
	from	user_tab_columns
	where	table_name 	= 'HD_DIALIZADOR'
	and	column_name	= 'IE_TROCA_EMERGENCIA';

	if (qt_registro_w > 0) then
		CALL Exec_Sql_Dinamico('Dialise','alter table HD_DIALIZADOR drop column IE_TROCA_EMERGENCIA');
	end if;

end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_ajustar_base_dialise (nm_usuario_p text) FROM PUBLIC;

