-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE sus_gerar_w_esus_atend_dom ( nr_seq_lote_p esus_lote_envio.nr_sequencia%type, ie_tipo_lote_esus_p esus_lote_envio.ie_tipo_lote_esus%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE


nr_sequencia_w				esus_atend_domiciliar.nr_sequencia%type;
nr_seq_lote_envio_w			esus_atend_domiciliar.nr_seq_lote_envio%type;
nr_seq_sus_equipe_w			esus_atend_domiciliar.nr_seq_sus_equipe%type;
cd_cnes_unidade_w			esus_atend_domiciliar.cd_cnes_unidade%type;
cd_cnes_unidade_ww			esus_atend_domiciliar.cd_cnes_unidade%type;
cd_estabelecimento_w			esus_atend_domiciliar.cd_estabelecimento%type;
cd_profissional_w			esus_atend_domiciliar.cd_profissional%type;
cd_cbo_w				esus_atend_domiciliar.cd_cbo%type;
dt_atendimento_w			esus_atend_domiciliar.dt_atendimento%type;
dt_liberacao_w				esus_atend_domiciliar.dt_liberacao%type;
cd_pessoa_fisica_w			esus_atend_domiciliar.cd_pessoa_fisica%type;
cd_doenca_ciap_w			esus_atend_domiciliar.cd_doenca_ciap%type;
cd_doenca_cid_w				esus_atend_domiciliar.cd_doenca_cid%type;
ie_oxigen_domiciliar_w			esus_atend_domiciliar.ie_oxigen_domiciliar%type;
ie_acamado_w				esus_atend_domiciliar.ie_acamado%type;
ie_acom_nutricional_w			esus_atend_domiciliar.ie_acom_nutricional%type;
ie_acom_pos_oper_w			esus_atend_domiciliar.ie_acom_pos_oper%type;
ie_acom_pre_oper_w			esus_atend_domiciliar.ie_acom_pre_oper%type;
ie_adap_ort_prot_w			esus_atend_domiciliar.ie_adap_ort_prot%type;
ie_antibio_parent_w			esus_atend_domiciliar.ie_antibio_parent%type;
ie_asp_via_aerea_w			esus_atend_domiciliar.ie_asp_via_aerea%type;
ie_catet_ves_alivio_w			esus_atend_domiciliar.ie_catet_ves_alivio%type;
ie_catet_ves_demora_w			esus_atend_domiciliar.ie_catet_ves_demora%type;
ie_cistostomia_w			esus_atend_domiciliar.ie_cistostomia%type;
ie_col_exame_labor_w			esus_atend_domiciliar.ie_col_exame_labor%type;
ie_colostomia_w				esus_atend_domiciliar.ie_colostomia%type;
ie_conduta_desfecho_w			esus_atend_domiciliar.ie_conduta_desfecho%type;
ie_cuidado_estomas_w			esus_atend_domiciliar.ie_cuidado_estomas%type;
ie_cuidado_traqueo_w			esus_atend_domiciliar.ie_cuidado_traqueo%type;
ie_cuid_palia_onco_w			esus_atend_domiciliar.ie_cuid_palia_onco%type;
ie_cuid_pal_nao_onco_w			esus_atend_domiciliar.ie_cuid_pal_nao_onco%type;
ie_dialise_perit_w			esus_atend_domiciliar.ie_dialise_perit%type;
ie_domiciliado_w			esus_atend_domiciliar.ie_domiciliado%type;
ie_enema_w				esus_atend_domiciliar.ie_enema%type;
ie_final_atest_obito_w			esus_atend_domiciliar.ie_final_atest_obito%type;
ie_fisio_trans_resp_sis_w		esus_atend_domiciliar.ie_fisio_trans_resp_sis%type;
ie_gastrostomia_w			esus_atend_domiciliar.ie_gastrostomia%type;
ie_ini_acomp_pos_obito_w		esus_atend_domiciliar.ie_ini_acomp_pos_obito%type;
ie_local_atendimento_w			esus_atend_domiciliar.ie_local_atendimento%type;
ie_medic_parenteral_w			esus_atend_domiciliar.ie_medic_parenteral%type;
ie_modalidade_ad_w			esus_atend_domiciliar.ie_modalidade_ad%type;
ie_oxigenoterapia_w			esus_atend_domiciliar.ie_oxigenoterapia%type;
ie_paracentese_w			esus_atend_domiciliar.ie_paracentese%type;
ie_reab_com_alter_w			esus_atend_domiciliar.ie_reab_com_alter%type;
ie_reab_des_neuro_w			esus_atend_domiciliar.ie_reab_des_neuro%type;
ie_reabilitacao_w			esus_atend_domiciliar.ie_reabilitacao%type;
ie_reab_multi_def_w			esus_atend_domiciliar.ie_reab_multi_def%type;
ie_ret_ponto_cir_basic_w		esus_atend_domiciliar.ie_ret_ponto_cir_basic%type;
ie_sn_enteral_w				esus_atend_domiciliar.ie_sn_enteral%type;
ie_sn_gastrica_w			esus_atend_domiciliar.ie_sn_gastrica%type;
ie_sondagem_gastrica_w			esus_atend_domiciliar.ie_sondagem_gastrica%type;
ie_sup_vent_bipap_w			esus_atend_domiciliar.ie_sup_vent_bipap%type;
ie_sup_vent_cpap_w			esus_atend_domiciliar.ie_sup_vent_cpap%type;
ie_svd_w				esus_atend_domiciliar.ie_svd%type;
ie_terap_fono_indiv_w			esus_atend_domiciliar.ie_terap_fono_indiv%type;
ie_terap_reidra_oral_w			esus_atend_domiciliar.ie_terap_reidra_oral%type;
ie_terap_reidra_pare_w			esus_atend_domiciliar.ie_terap_reidra_pare%type;
ie_tipo_atend_dom_w			esus_atend_domiciliar.ie_tipo_atend_dom%type;
ie_traqueostomia_w			esus_atend_domiciliar.ie_traqueostomia%type;
ie_trat_reabilitacao_w			esus_atend_domiciliar.ie_trat_reabilitacao%type;
ie_trat_trauma_local_w			esus_atend_domiciliar.ie_trat_trauma_local%type;
ie_turno_atendimento_w			esus_atend_domiciliar.ie_turno_atendimento%type;
ie_ulcera_ferida_w			esus_atend_domiciliar.ie_ulcera_ferida%type;
ie_vis_dom_pos_obito_w			esus_atend_domiciliar.ie_vis_dom_pos_obito%type;
cd_uuid_original_w			esus_atend_domiciliar.cd_uuid_original%type;
nr_atendimento_w			esus_atend_domiciliar.nr_atendimento%type;
cd_seg_profissional_w			esus_atend_domiciliar.cd_seg_profissional%type;
cd_seg_cbo_w				esus_atend_domiciliar.cd_seg_cbo%type;
nr_seg_seq_sus_equ_w			esus_atend_domiciliar.nr_seg_seq_sus_equ%type;
cd_seg_cnes_unidade_w			esus_atend_domiciliar.cd_seg_cnes_unidade%type;
nm_paciente_w				varchar(100);	
nm_profissional_w			varchar(100);	
nr_seq_exp_w				w_esus_atend_domiciliar.nr_sequencia%type;
cd_municipio_ibge_w			w_esus_atend_domiciliar.cd_municipio_ibge%type;
cd_contra_chave_rem_w			w_esus_atend_domiciliar.cd_contra_chave_rem%type;	
cd_uuid_instal_rem_w			w_esus_atend_domiciliar.cd_uuid_instal_rem%type;
cd_cpf_cnpj_remet_w			w_esus_atend_domiciliar.cd_cpf_cnpj_remet%type;
nm_razao_social_reme_w			w_esus_atend_domiciliar.nm_razao_social_reme%type;
cd_contra_chave_ori_w			w_esus_atend_domiciliar.cd_contra_chave_ori%type;
cd_uuid_instal_orig_w			w_esus_atend_domiciliar.cd_uuid_instal_orig%type;
cd_cpf_cnpj_origin_w			w_esus_atend_domiciliar.cd_cpf_cnpj_origin%type;
nm_razao_social_orig_w			w_esus_atend_domiciliar.nm_razao_social_orig%type;
cd_cns_profissional_w			w_esus_atend_domiciliar.cd_cns_profissional%type;
cd_cns_seg_profiss_w			w_esus_atend_domiciliar.cd_cns_seg_profiss%type;
nr_data_atendimento_w			w_esus_atend_domiciliar.nr_data_atendimento%type;
nr_data_nasc_pac_w			w_esus_atend_domiciliar.nr_data_nasc_pac%type;
cd_cnes_estab_w				estabelecimento.cd_cns%type;
cd_cns_paciente_w			w_esus_atend_domiciliar.cd_cns_paciente%type;
dt_nascimento_paciente_w		w_esus_atend_domiciliar.dt_nascimento_paciente%type;
ie_sexo_paciente_w			w_esus_atend_domiciliar.ie_sexo_paciente%type;
nr_seq_at_do_pro_w			esus_atend_dom_proced.nr_sequencia%type;
nr_seq_atend_dom_w			esus_atend_dom_proced.nr_seq_atend_dom%type;
cd_procedimento_w			esus_atend_dom_proced.cd_procedimento%type;
ie_origem_proced_w			esus_atend_dom_proced.ie_origem_proced%type;
cd_municipio_ibge_ww 			w_esus_header_footer.cd_municipio_ibge%type;

AtDom CURSOR FOR
	SELECT	nr_sequencia,	
		nr_seq_lote_envio,
		nr_seq_sus_equipe,
		cd_cnes_unidade,
		cd_estabelecimento,
		cd_profissional,
		cd_cbo,	
		dt_atendimento,
		dt_liberacao,	
		cd_pessoa_fisica,
		cd_doenca_ciap,
		cd_doenca_cid,	
		ie_oxigen_domiciliar,
		ie_acamado,	
		ie_acom_nutricional,
		ie_acom_pos_oper,
		ie_acom_pre_oper,
		ie_adap_ort_prot,
		ie_antibio_parent,
		ie_asp_via_aerea,
		ie_catet_ves_alivio,
		ie_catet_ves_demora,
		ie_cistostomia,
		ie_col_exame_labor,
		ie_colostomia,	
		ie_conduta_desfecho,
		ie_cuidado_estomas,
		ie_cuidado_traqueo,
		ie_cuid_palia_onco,
		ie_cuid_pal_nao_onco,
		ie_dialise_perit,
		ie_domiciliado,
		ie_enema,	
		ie_final_atest_obito,
		ie_fisio_trans_resp_sis,
		ie_gastrostomia,
		ie_ini_acomp_pos_obito,
		ie_local_atendimento,
		ie_medic_parenteral,
		ie_modalidade_ad,
		ie_oxigenoterapia,
		ie_paracentese,
		ie_reab_com_alter,
		ie_reab_des_neuro,
		ie_reabilitacao,
		ie_reab_multi_def,
		ie_ret_ponto_cir_basic,
		ie_sn_enteral,	
		ie_sn_gastrica,
		ie_sondagem_gastrica,
		ie_sup_vent_bipap,
		ie_sup_vent_cpap,
		ie_svd,	
		ie_terap_fono_indiv,
		ie_terap_reidra_oral,
		ie_terap_reidra_pare,
		ie_tipo_atend_dom,
		ie_traqueostomia,
		ie_trat_reabilitacao,
		ie_trat_trauma_local,
		ie_turno_atendimento,
		ie_ulcera_ferida,
		ie_vis_dom_pos_obito,
		cd_uuid_original,
		substr(obter_nome_pf(cd_pessoa_fisica),1,100) nm_paciente,
		substr(obter_nome_pf(cd_profissional),1,100) nm_profissional,
		nr_atendimento,
		cd_seg_profissional,
		cd_seg_cbo,
		nr_seg_seq_sus_equ,
		cd_seg_cnes_unidade
	from	esus_atend_domiciliar
	where	nr_seq_lote_envio =	nr_seq_lote_p
	order by nm_paciente, nm_profissional, nr_sequencia;

type 		fetch_array is table of AtDom%rowtype;
s_array 	fetch_array;
i		integer := 1;
type vetor is table of fetch_array index by integer;
vetor_AtDom_w			vetor;

AtDoPr CURSOR FOR
	SELECT	nr_sequencia,
		nr_seq_atend_dom,
		cd_procedimento,
		ie_origem_proced
	from	esus_atend_dom_proced
	where	nr_seq_atend_dom = nr_sequencia_w
	order by 1;
	
BEGIN

delete 	from w_esus_atend_domiciliar
where	nr_seq_lote_envio = nr_seq_lote_p;

delete 	from w_esus_atdom_situa_pres
where	nr_seq_lote_envio = nr_seq_lote_p;

delete 	from w_esus_atdom_proced
where	nr_seq_lote_envio = nr_seq_lote_p;

delete 	from w_esus_atend_dom_proc
where	nr_seq_lote_envio = nr_seq_lote_p;

open AtDom;
loop
fetch AtDom bulk collect into s_array limit 1000;
	vetor_AtDom_w(i) := s_array;
	i := i + 1;
EXIT WHEN NOT FOUND; /* apply on AtDom */
end loop;
close AtDom;


for i in 1..vetor_AtDom_w.count loop
	begin
	s_array := vetor_AtDom_w(i);
	for z in 1..s_array.count loop
		begin
		
		nr_sequencia_w				:= s_array[z].nr_sequencia;
		nr_seq_lote_envio_w			:= s_array[z].nr_seq_lote_envio;
		nr_seq_sus_equipe_w			:= s_array[z].nr_seq_sus_equipe;
		cd_cnes_unidade_w			:= s_array[z].cd_cnes_unidade;
		cd_estabelecimento_w			:= s_array[z].cd_estabelecimento;
		cd_profissional_w			:= s_array[z].cd_profissional;
		cd_cbo_w				:= s_array[z].cd_cbo;
		dt_atendimento_w			:= s_array[z].dt_atendimento;
		dt_liberacao_w				:= s_array[z].dt_liberacao;
		cd_pessoa_fisica_w			:= s_array[z].cd_pessoa_fisica;
		cd_doenca_ciap_w			:= s_array[z].cd_doenca_ciap;
		cd_doenca_cid_w				:= s_array[z].cd_doenca_cid;
		ie_oxigen_domiciliar_w			:= s_array[z].ie_oxigen_domiciliar;
		ie_acamado_w				:= s_array[z].ie_acamado;
		ie_acom_nutricional_w			:= s_array[z].ie_acom_nutricional;
		ie_acom_pos_oper_w			:= s_array[z].ie_acom_pos_oper;
		ie_acom_pre_oper_w			:= s_array[z].ie_acom_pre_oper;
		ie_adap_ort_prot_w			:= s_array[z].ie_adap_ort_prot;
		ie_antibio_parent_w			:= s_array[z].ie_antibio_parent;
		ie_asp_via_aerea_w			:= s_array[z].ie_asp_via_aerea;
		ie_catet_ves_alivio_w			:= s_array[z].ie_catet_ves_alivio;
		ie_catet_ves_demora_w			:= s_array[z].ie_catet_ves_demora;
		ie_cistostomia_w			:= s_array[z].ie_cistostomia;
		ie_col_exame_labor_w			:= s_array[z].ie_col_exame_labor;
		ie_colostomia_w				:= s_array[z].ie_colostomia;
		ie_conduta_desfecho_w			:= s_array[z].ie_conduta_desfecho;
		ie_cuidado_estomas_w			:= s_array[z].ie_cuidado_estomas;
		ie_cuidado_traqueo_w			:= s_array[z].ie_cuidado_traqueo;
		ie_cuid_palia_onco_w			:= s_array[z].ie_cuid_palia_onco;
		ie_cuid_pal_nao_onco_w			:= s_array[z].ie_cuid_pal_nao_onco;
		ie_dialise_perit_w			:= s_array[z].ie_dialise_perit;
		ie_domiciliado_w			:= s_array[z].ie_domiciliado;
		ie_enema_w				:= s_array[z].ie_enema;
		ie_final_atest_obito_w			:= s_array[z].ie_final_atest_obito;
		ie_fisio_trans_resp_sis_w		:= s_array[z].ie_fisio_trans_resp_sis;
		ie_gastrostomia_w			:= s_array[z].ie_gastrostomia;
		ie_ini_acomp_pos_obito_w		:= s_array[z].ie_ini_acomp_pos_obito;
		ie_local_atendimento_w			:= s_array[z].ie_local_atendimento;
		ie_medic_parenteral_w			:= s_array[z].ie_medic_parenteral;
		ie_modalidade_ad_w			:= s_array[z].ie_modalidade_ad;
		ie_oxigenoterapia_w			:= s_array[z].ie_oxigenoterapia;
		ie_paracentese_w			:= s_array[z].ie_paracentese;
		ie_reab_com_alter_w			:= s_array[z].ie_reab_com_alter;
		ie_reab_des_neuro_w			:= s_array[z].ie_reab_des_neuro;
		ie_reabilitacao_w			:= s_array[z].ie_reabilitacao;
		ie_reab_multi_def_w			:= s_array[z].ie_reab_multi_def;
		ie_ret_ponto_cir_basic_w		:= s_array[z].ie_ret_ponto_cir_basic;
		ie_sn_enteral_w				:= s_array[z].ie_sn_enteral;
		ie_sn_gastrica_w			:= s_array[z].ie_sn_gastrica;
		ie_sondagem_gastrica_w			:= s_array[z].ie_sondagem_gastrica;
		ie_sup_vent_bipap_w			:= s_array[z].ie_sup_vent_bipap;
		ie_sup_vent_cpap_w			:= s_array[z].ie_sup_vent_cpap;
		ie_svd_w				:= s_array[z].ie_svd;
		ie_terap_fono_indiv_w			:= s_array[z].ie_terap_fono_indiv;
		ie_terap_reidra_oral_w			:= s_array[z].ie_terap_reidra_oral;
		ie_terap_reidra_pare_w			:= s_array[z].ie_terap_reidra_pare;
		ie_tipo_atend_dom_w			:= s_array[z].ie_tipo_atend_dom;
		ie_traqueostomia_w			:= s_array[z].ie_traqueostomia;
		ie_trat_reabilitacao_w			:= s_array[z].ie_trat_reabilitacao;
		ie_trat_trauma_local_w			:= s_array[z].ie_trat_trauma_local;
		ie_turno_atendimento_w			:= s_array[z].ie_turno_atendimento;
		ie_ulcera_ferida_w			:= s_array[z].ie_ulcera_ferida;
		ie_vis_dom_pos_obito_w			:= s_array[z].ie_vis_dom_pos_obito;
		cd_uuid_original_w			:= s_array[z].cd_uuid_original;
		nm_paciente_w				:= s_array[z].nm_paciente;
		nm_profissional_w			:= s_array[z].nm_profissional;
		nr_atendimento_w			:= s_array[z].nr_atendimento;
		cd_seg_profissional_w			:= s_array[z].cd_seg_profissional;
		cd_seg_cbo_w				:= s_array[z].cd_seg_cbo;
		nr_seg_seq_sus_equ_w			:= s_array[z].nr_seg_seq_sus_equ;
		cd_seg_cnes_unidade_w			:= s_array[z].cd_seg_cnes_unidade;
		
		begin
		select	cd_cns
		into STRICT	cd_cnes_estab_w
		from	estabelecimento
		where	cd_estabelecimento = cd_estabelecimento_w  LIMIT 1;		
		exception
		when others then
			cd_cnes_estab_w := '';
		end;
		
		
		if (coalesce(cd_pessoa_fisica_w,'X') <> 'X') then
			begin
			cd_cns_paciente_w		:= substr(obter_dados_pf(cd_pessoa_fisica_w,'CNS'),1,20);
			dt_nascimento_paciente_w	:= to_date(substr(obter_dados_pf(cd_pessoa_fisica_w,'DN'),1,10),'dd/mm/yyyy');
			ie_sexo_paciente_w		:= substr(sus_gerar_depara_esus(obter_dados_pf(cd_pessoa_fisica_w,'SE'),'SEXO'),1,20);
			cd_municipio_ibge_w		:= substr(obter_dados_pf_pj(cd_pessoa_fisica_w,'','CDMDV'),1,7);
			end;
		end if;		
		
		begin
		cd_cns_profissional_w			:= substr(obter_dados_pf(cd_profissional_w,'CNS'),1,20);		
		exception
		when others then
			cd_cns_profissional_w 		:= '';
		end;
		
		begin
		cd_cns_seg_profiss_w			:= substr(obter_dados_pf(cd_seg_profissional_w,'CNS'),1,20);		
		exception
		when others then
			cd_cns_seg_profiss_w 		:= '';
		end;
		
		if (dt_atendimento_w IS NOT NULL AND dt_atendimento_w::text <> '') then
			nr_data_atendimento_w 		:= rpad(((dt_atendimento_w - to_date('01/01/1970 00:00:00','dd/mm/yyyy hh24:mi:ss')) * 86400),13,0);
		else
			nr_data_atendimento_w 		:= null;
		end if;
		
		if (dt_nascimento_paciente_w IS NOT NULL AND dt_nascimento_paciente_w::text <> '') then
			nr_data_nasc_pac_w 		:= ((dt_nascimento_paciente_w - to_date('01/01/1970 00:00:00','dd/mm/yyyy hh24:mi:ss')) * 86400);
		else
			nr_data_nasc_pac_w 		:= null;
		end if;					

		select	coalesce(max(cd_cnes_unidade),'0')
		into STRICT	cd_cnes_unidade_ww
		from	w_esus_header_footer
		where	nr_seq_lote_envio = nr_seq_lote_p;
		
		if (cd_cnes_unidade_w <> cd_cnes_unidade_ww) then
			begin
			cd_contra_chave_rem_w	:= substr(sus_gerar_uuid_esus(cd_cnes_unidade_w,'C'),1,50);
			cd_uuid_instal_rem_w	:= substr(sus_gerar_uuid_esus(cd_cnes_unidade_w,'U'),1,50);
			cd_contra_chave_ori_w	:= cd_contra_chave_rem_w;
			cd_uuid_instal_orig_w	:= cd_uuid_instal_rem_w;			
			cd_municipio_ibge_ww	:= sus_obter_dados_equipe(nr_seq_sus_equipe_w,'CM');
			cd_municipio_ibge_ww	:= substr(cd_municipio_ibge_ww||Calcula_Digito('MODULO10',cd_municipio_ibge_ww),1,7);
			
			update 	w_esus_header_footer
			set 	cd_cnes_unidade = cd_cnes_unidade_w,
				cd_cnes_serealizado = cd_cnes_unidade_w,
				cd_contra_chave_rem = cd_contra_chave_rem_w,
				cd_uuid_instal_rem = cd_uuid_instal_rem_w,
				cd_contra_chave_ori = cd_contra_chave_ori_w,
				cd_uuid_instal_orig = cd_uuid_instal_orig_w,
				cd_municipio_ibge = cd_municipio_ibge_ww
			where	nr_seq_lote_envio = nr_seq_lote_p;
			
			end;
		end if;
		
		if (coalesce(cd_uuid_original_w,'X') = 'X')  then
			cd_uuid_original_w := coalesce(sus_gerar_uuid_esus(cd_cnes_unidade_w,'U'),'0');
			update esus_atend_domiciliar set cd_uuid_original = cd_uuid_original_w where  nr_sequencia = nr_sequencia_w;
		end if;				
		
		select	nextval('w_esus_atend_domiciliar_seq')
		into STRICT	nr_seq_exp_w
		;
		
		insert into w_esus_atend_domiciliar(	nr_sequencia,					
							nr_seq_lote_envio,				
							dt_atualizacao,
							nm_usuario,					
							dt_atualizacao_nrec,				
							nm_usuario_nrec,
							cd_pessoa_fisica,				
							cd_profissional,				
							cd_cbo,
							nr_seq_sus_equipe,				
							cd_cnes_unidade,				
							dt_atendimento,
							ie_turno_atendimento,				
							ie_local_atendimento,				
							ie_modalidade_ad,
							ie_tipo_atend_dom,				
							ie_acamado,					
							ie_domiciliado,
							ie_ulcera_ferida,				
							ie_acom_nutricional,				
							ie_sn_gastrica,
							ie_sn_enteral,					
							ie_gastrostomia,				
							ie_colostomia,
							ie_cistostomia,					
							ie_svd,						
							ie_acom_pre_oper,
							ie_acom_pos_oper,				
							ie_adap_ort_prot,				
							ie_reabilitacao,
							ie_cuid_palia_onco,				
							ie_cuid_pal_nao_onco,				
							ie_oxigen_domiciliar,
							ie_traqueostomia,				
							ie_asp_via_aerea,				
							ie_sup_vent_cpap,
							ie_sup_vent_bipap,				
							ie_dialise_perit,				
							ie_paracentese,
							ie_medic_parenteral,				
							ie_reab_com_alter,				
							ie_antibio_parent,
							ie_reab_des_neuro,				
							ie_fisio_trans_resp_sis,			
							ie_final_atest_obito,
							ie_reab_multi_def,				
							ie_catet_ves_alivio,				
							ie_catet_ves_demora,
							ie_col_exame_labor,				
							ie_cuidado_estomas,				
							ie_cuidado_traqueo,
							ie_enema,					
							ie_oxigenoterapia,				
							ie_ret_ponto_cir_basic,
							ie_sondagem_gastrica,				
							ie_terap_reidra_oral,				
							ie_terap_reidra_pare,
							ie_terap_fono_indiv,				
							ie_trat_trauma_local,				
							ie_trat_reabilitacao,
							ie_vis_dom_pos_obito,				
							ie_ini_acomp_pos_obito,				
							cd_doenca_cid,
							cd_doenca_ciap,					
							ie_conduta_desfecho,				
							cd_uuid_original,
							cd_tipo_dado_serializ,				
							cd_municipio_ibge,				
							cd_cnes_serealizado,
							cd_contra_chave_rem,				
							cd_uuid_instal_rem,				
							cd_cpf_cnpj_remet,
							nm_razao_social_reme,				
							cd_contra_chave_ori,				
							cd_uuid_instal_orig,
							cd_cpf_cnpj_origin,				
							nm_razao_social_orig,				
							nr_seq_ficha,
							cd_cns_paciente,				
							dt_nascimento_paciente,				
							ie_sexo_paciente,
							cd_cns_profissional,				
							nr_atendimento,					
							cd_seg_profissional,
							cd_seg_cbo,					
							nr_seg_seq_sus_equ,				
							cd_seg_cnes_unidade,
							nr_data_atendimento,				
							nr_data_nasc_pac,				
							cd_cns_seg_profiss)
							values (	nr_seq_exp_w,			
							nr_seq_lote_envio_w,				
							clock_timestamp(),
							nm_usuario_p,				
							clock_timestamp(),				
							nm_usuario_p,
							cd_pessoa_fisica_w,			
							cd_profissional_w,				
							cd_cbo_w,
							nr_seq_sus_equipe_w,				
							cd_cnes_unidade_w,				
							dt_atendimento_w,
							ie_turno_atendimento_w,				
							ie_local_atendimento_w,				
							ie_modalidade_ad_w,
							ie_tipo_atend_dom_w,				
							CASE WHEN ie_acamado_w='S' THEN 1  ELSE null END ,		
							CASE WHEN ie_domiciliado_w='S' THEN 2  ELSE null END ,
							CASE WHEN ie_ulcera_ferida_w='S' THEN 3  ELSE null END ,		
							CASE WHEN ie_acom_nutricional_w='S' THEN 4  ELSE null END ,	
							CASE WHEN ie_sn_gastrica_w='S' THEN 5  ELSE null END ,
							CASE WHEN ie_sn_enteral_w='S' THEN 6  ELSE null END ,		
							CASE WHEN ie_gastrostomia_w='S' THEN 7  ELSE null END ,		
							CASE WHEN ie_colostomia_w='S' THEN 8  ELSE null END ,
							CASE WHEN ie_cistostomia_w='S' THEN 9  ELSE null END ,		
							CASE WHEN ie_svd_w='S' THEN 10  ELSE null END ,			
							CASE WHEN ie_acom_pre_oper_w='S' THEN 11  ELSE null END ,
							CASE WHEN ie_acom_pos_oper_w='S' THEN 12  ELSE null END ,		
							CASE WHEN ie_adap_ort_prot_w='S' THEN 13  ELSE null END ,		
							CASE WHEN ie_reabilitacao_w='S' THEN 14  ELSE null END ,
							CASE WHEN ie_cuid_palia_onco_w='S' THEN 15  ELSE null END ,	
							CASE WHEN ie_cuid_pal_nao_onco_w='S' THEN 16  ELSE null END ,	
							CASE WHEN ie_oxigen_domiciliar_w='S' THEN 17  ELSE null END ,
							CASE WHEN ie_traqueostomia_w='S' THEN 18  ELSE null END ,		
							CASE WHEN ie_asp_via_aerea_w='S' THEN 19  ELSE null END ,		
							CASE WHEN ie_sup_vent_cpap_w='S' THEN 20  ELSE null END ,
							CASE WHEN ie_sup_vent_bipap_w='S' THEN 21  ELSE null END ,	
							CASE WHEN ie_dialise_perit_w='S' THEN 22  ELSE null END ,		
							CASE WHEN ie_paracentese_w='S' THEN 23  ELSE null END ,
							CASE WHEN ie_medic_parenteral_w='S' THEN 24  ELSE null END ,	
							CASE WHEN ie_reab_com_alter_w='S' THEN '0301070024'  ELSE null END ,			
							CASE WHEN ie_antibio_parent_w='S' THEN '0301050082'  ELSE null END ,
							CASE WHEN ie_reab_des_neuro_w='S' THEN '0301070075'  ELSE null END ,	
							CASE WHEN ie_fisio_trans_resp_sis_w='S' THEN '0302040021'  ELSE null END ,	
							CASE WHEN ie_final_atest_obito_w='S' THEN '0301050090'  ELSE null END ,
							CASE WHEN ie_reab_multi_def_w='S' THEN '0301070067'  ELSE null END ,	
							CASE WHEN ie_catet_ves_alivio_w='S' THEN '0301100047'  ELSE null END ,	
							CASE WHEN ie_catet_ves_demora_w='S' THEN '0301100055'  ELSE null END ,
							CASE WHEN ie_col_exame_labor_w='S' THEN '0201020041'  ELSE null END ,	
							CASE WHEN ie_cuidado_estomas_w='S' THEN '0301100063'  ELSE null END ,	
							CASE WHEN ie_cuidado_traqueo_w='S' THEN '0301100071'  ELSE null END ,
							CASE WHEN ie_enema_w='S' THEN '0301100098'  ELSE null END ,		
							CASE WHEN ie_oxigenoterapia_w='S' THEN '0301100144'  ELSE null END ,	
							CASE WHEN ie_ret_ponto_cir_basic_w='S' THEN '0301100152'  ELSE null END ,
							CASE WHEN ie_sondagem_gastrica_w='S' THEN '0301100179'  ELSE null END ,	
							CASE WHEN ie_terap_reidra_oral_w='S' THEN '0301100187'  ELSE null END ,	
							CASE WHEN ie_terap_reidra_pare_w='S' THEN '0301050120'  ELSE null END ,
							CASE WHEN ie_terap_fono_indiv_w='S' THEN '0301070113'  ELSE null END ,	
							CASE WHEN ie_trat_trauma_local_w='S' THEN '0308010019'  ELSE null END ,	
							CASE WHEN ie_trat_reabilitacao_w='S' THEN '0303190019'  ELSE null END ,
							CASE WHEN ie_vis_dom_pos_obito_w='S' THEN '0301050104'  ELSE null END ,	
							CASE WHEN ie_ini_acomp_pos_obito_w='S' THEN 'true'  ELSE 'false' END ,	
							cd_doenca_cid_w,
							cd_doenca_ciap_w,				
							ie_conduta_desfecho_w,				
							cd_uuid_original_w,
							10,						
							cd_municipio_ibge_w,				
							cd_cnes_estab_w,
							cd_contra_chave_rem_w,				
							cd_uuid_instal_rem_w,				
							cd_cpf_cnpj_remet_w,
							nm_razao_social_reme_w,				
							cd_contra_chave_ori_w,				
							cd_uuid_instal_orig_w,
							cd_cpf_cnpj_origin_w,				
							nm_razao_social_orig_w,				
							nr_sequencia_w,
							cd_cns_paciente_w,				
							dt_nascimento_paciente_w,			
							ie_sexo_paciente_w,
							cd_cns_profissional_w,				
							nr_atendimento_w,				
							cd_seg_profissional_w,	
							cd_seg_cbo_w,					
							nr_seg_seq_sus_equ_w,				
							cd_seg_cnes_unidade_w,
							nr_data_atendimento_w,				
							nr_data_nasc_pac_w,				
							cd_cns_seg_profiss_w);
		
		open AtDoPr;
		loop
		fetch AtDoPr into	
			nr_seq_at_do_pro_w,
			nr_seq_atend_dom_w,
			cd_procedimento_w,
			ie_origem_proced_w;
		EXIT WHEN NOT FOUND; /* apply on AtDoPr */
			begin
			
			insert into w_esus_atend_dom_proc(	
				nr_sequencia,
				dt_atualizacao,
				nm_usuario,
				dt_atualizacao_nrec,
				nm_usuario_nrec,
				cd_procedimento,
				ie_origem_proced,
				nr_seq_atend_dom,
				nr_seq_w_atend_dom,
				nr_seq_at_do_pro,
				nr_seq_lote_envio,
				nr_seq_ficha)
			values (	nextval('w_esus_atend_dom_proc_seq'),
				clock_timestamp(),
				nm_usuario_p,
				clock_timestamp(),
				nm_usuario_p,
				cd_procedimento_w,
				ie_origem_proced_w,
				nr_seq_atend_dom_w,
				nr_seq_exp_w,					
				nr_seq_at_do_pro_w,
				nr_seq_lote_envio_w,
				nr_sequencia_w);
			
			end;
		end loop;
		close AtDoPr;
			
		end;
	end loop;
	end;
end loop;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE sus_gerar_w_esus_atend_dom ( nr_seq_lote_p esus_lote_envio.nr_sequencia%type, ie_tipo_lote_esus_p esus_lote_envio.ie_tipo_lote_esus%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;

