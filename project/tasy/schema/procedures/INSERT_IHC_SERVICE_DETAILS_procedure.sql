-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_ihc_service_details ( nr_seq_service_p bigint, cd_exp_row_p bigint, cd_service_exp_p bigint, ds_service_exp_p text, nm_usuario_p text) AS $body$
DECLARE

nm_usuario_w ihc_service_details.nm_usuario%type;

BEGIN

select 	max(nm_usuario)
into STRICT 	nm_usuario_w
from 	ihc_service_response
where 	nr_sequencia = nr_seq_service_p;

insert into ihc_service_details(  cd_exp_row,
				  cd_service_exp,
				  ds_service_exp,
				  dt_atualizacao,
				  dt_atualizacao_nrec,
				  nm_usuario,
				  nm_usuario_nrec,
				  nr_seq_service,
				  nr_sequencia)
			values (	  cd_exp_row_p,
				  cd_service_exp_p,
				  ds_service_exp_p,
				  clock_timestamp(),
				  clock_timestamp(),
				  coalesce(nm_usuario_p, nm_usuario_w),
				  coalesce(nm_usuario_p, nm_usuario_w),
				  nr_seq_service_p,
				  nextval('ihc_service_details_seq'));
			
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_ihc_service_details ( nr_seq_service_p bigint, cd_exp_row_p bigint, cd_service_exp_p bigint, ds_service_exp_p text, nm_usuario_p text) FROM PUBLIC;

