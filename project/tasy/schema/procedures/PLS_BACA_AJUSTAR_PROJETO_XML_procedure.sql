-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_baca_ajustar_projeto_xml () AS $body$
BEGIN

Update xml_elemento
set ds_sql =
'select	a.nr_sequencia nr_seq_protocolo_w,' || ' '||
'	a.dt_protocolo,' || ' '||
'	substr(obter_valor_dominio(1746, ie_tipo_guia),1,255) ds_tipo_guia,' || ' '||
'	nvl(pls_obter_valores_prot_pag(a.nr_sequencia, :nr_seq_lote_pgto, ' || chr(39) || 'VLP' || chr(39) || '),0) vl_informado,' || ' '||
'	nvl(pls_obter_valores_prot_pag(a.nr_sequencia, :nr_seq_lote_pgto, ' || chr(39) || 'VL' || chr(39) || '),0) vl_processado,' || ' '||
'	nvl(pls_obter_valores_prot_pag(a.nr_sequencia, :nr_seq_lote_pgto, ' || chr(39) || 'VL' || chr(39) || '),0) vl_liberado,' || ' '||
'	nvl(pls_obter_valores_prot_pag(a.nr_sequencia, :nr_seq_lote_pgto, ' || chr(39) || 'VGL' || chr(39) || '),0) vl_glosado,' || ' '||
'	nr_protocolo_prestador nr_seq_lote' || ' '||
'from	pls_protocolo_conta	a' || ' '||
'where	exists	(	select	1' || ' '||
'					from	pls_conta		x,' || ' '||
'							pls_conta_medica_resumo	y,' || ' '||
'							pls_lote_pagamento m,' || ' '||
'							pls_pagamento_prestador n,' || ' '||
'							pls_pag_prest_vencimento o' || ' '||
'					where	y.nr_seq_conta		= x.nr_sequencia' || ' '||
'					and	x.nr_seq_protocolo	= a.nr_sequencia' || ' '||
'					and m.nr_sequencia = n.nr_seq_lote' || ' '||
'					and n.nr_sequencia = o.nr_seq_pag_prestador' || ' '||
'					and m.nr_sequencia = y.nr_seq_lote_pgto' || ' '||
'					and	((y.ie_situacao		= ' || chr(39) || 'A' || chr(39) || ') or (y.ie_situacao is null))' || ' '||
'					and	nvl(y.nr_seq_prestador_pgto,x.nr_seq_prestador_exec) = :nr_seq_prestador' || ' '||
'					and	to_char(o.dt_vencimento, ' || chr(39) || 'dd/mm/yyyy' || chr(39) || ') = :dt_vencimento)' || ' '||
'order by 1'
where nr_sequencia = 34705;

update XML_ATRIBUTO set NM_ATRIBUTO = 'NR_SEQ_PROTOCOLO_W' where nr_sequencia = 148328;

update xml_elemento set IE_CRIAR_ELEMENTO = 'S' where  nr_sequencia = 35122;

Update xml_elemento
set ds_sql =
'select	a.NR_PROTOCOLO_PRESTADOR nr_seq_lote,' || ' '||
'	a.nr_sequencia nr_seq_protocolo,' || ' '||
'  	a.IE_STATUS ie_situacao,' || ' '||
'	nvl(nvl(a.dt_protocolo,a.dt_recebimento),a.dt_mes_competencia) dt_protocolo,' || ' '||
'	nvl(a.vl_total,0) vl_liberado,' || ' '||
'	nvl(a.vl_cobrado,0) vl_apresentado,' || ' '||
'	nvl(pls_obter_valor_protocolo(a.nr_sequencia,' || chr(39) || 'T' || chr(39) || '),0) vl_total,' || ' '||
'	nvl(a.vl_glosa,0) vl_glosado,' || ' '||
'	nvl(pls_obter_valor_protocolo(a.nr_sequencia,' || chr(39) || 'CA' || chr(39) || '),0) vl_calculado' || ' '||
'from	pls_protocolo_conta a' || ' '||
'where	a.nr_sequencia = :nr_seq_protocolo'
where nr_sequencia = 34679;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_baca_ajustar_projeto_xml () FROM PUBLIC;

