-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_medic_protocolo ( nr_seq_interno_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_sequencia_w		bigint;
cd_protocolo_w		bigint;
nr_seq_material_w	bigint;
nr_seq_interno_w	bigint;
nr_agrupamento_w	double precision;


BEGIN
if (nr_seq_interno_p > 0) then
	select	max(nr_seq_material+1)
	into STRICT	nr_seq_material_w
	from	protocolo_medic_material;

	select	nextval('protocolo_medic_material_seq')
	into STRICT	nr_seq_interno_w
	;

	select	max(cd_protocolo),
		max(nr_sequencia)
	into STRICT	cd_protocolo_w,
		nr_sequencia_w
	from	protocolo_medic_material
	where	nr_seq_interno	= nr_seq_interno_p;

	select	coalesce(max(nr_agrupamento),0) + 1
	into STRICT	nr_agrupamento_w
	from	protocolo_medic_material
	where	cd_protocolo = cd_protocolo_w
	and	nr_sequencia = nr_sequencia_w
	and	coalesce(nr_seq_diluicao::text, '') = ''
	and	ie_agrupador = 1;



	insert into protocolo_medic_material(
					cd_protocolo,			nr_sequencia,
					nr_seq_material,		cd_material,
					ds_rotina,			ie_via_aplicacao,
					cd_unidade_medida,		qt_dose,
					ie_multiplicar_dose,		ie_alterar_dose,
					qt_dose_peso,			ie_se_necessario,
					ie_acm,				ie_urgencia,
					ie_lado,			cd_intervalo,
					qt_hora_aplicacao,		qt_minuto_aplicacao,
					qt_solucao,			hr_prim_horario,
					ie_bomba_infusao,		ie_aplic_bolus,
					ie_aplic_lenta,			qt_dias_util,
					qt_min_intervalo,		ie_dose_espec_agora,
					qt_dose_especial,		hr_dose_especial,
					ds_dias_aplicacao,		ds_ciclos_aplicacao,
					ds_recomendacao,		qt_dias_prev_util,
					ie_objetivo,			cd_microorganismo_cih,
					cd_amostra_cih,			ie_origem_infeccao,
					cd_topografia_cih,		ie_indicacao,
					ie_uso_antimicrobiano,		ie_medic_rotina,
					ie_pre_medicacao,		ds_cor_rotina,
					ie_medic_rotina_onc,		nr_seq_grupo,
					nr_seq_apresentacao,		ie_arredondar,
					ie_intervalo,			ie_unidade_medida,
					ie_alerta_via_adm,		ds_justificativa,
					ie_kit,				ie_medicacao_paciente,
					ie_justificativa,		ie_uso_continuo,
					ie_aplicar,			ie_dados_atb,
					ie_gerar_solucao,		ie_aplica_reducao,
					ie_regra_diluicao_cad_mat,	ie_local_adm,
					ie_dados_medicamento,		ie_questionar_obs,
					nr_agrupamento,			dt_atualizacao,
					nm_usuario,			nr_seq_interno,
					ie_agrupador,			nr_seq_diluicao,
					cd_kit,				qt_dias_receita)
				SELECT
					cd_protocolo,			nr_sequencia,
					nr_seq_material_w,		cd_material,
					ds_rotina,			ie_via_aplicacao,
					cd_unidade_medida,		qt_dose,
					ie_multiplicar_dose,		ie_alterar_dose,
					qt_dose_peso,			ie_se_necessario,
					ie_acm,				ie_urgencia,
					ie_lado,			cd_intervalo,
					qt_hora_aplicacao,		qt_minuto_aplicacao,
					qt_solucao,			hr_prim_horario,
					ie_bomba_infusao,		ie_aplic_bolus,
					ie_aplic_lenta,			qt_dias_util,
					qt_min_intervalo,		ie_dose_espec_agora,
					qt_dose_especial,		hr_dose_especial,
					ds_dias_aplicacao,		ds_ciclos_aplicacao,
					ds_recomendacao,		qt_dias_prev_util,
					ie_objetivo,			cd_microorganismo_cih,
					cd_amostra_cih,			ie_origem_infeccao,
					cd_topografia_cih,		ie_indicacao,
					ie_uso_antimicrobiano,		ie_medic_rotina,
					ie_pre_medicacao,		ds_cor_rotina,
					ie_medic_rotina_onc,		nr_seq_grupo,
					nr_seq_apresentacao,		ie_arredondar,
					ie_intervalo,			ie_unidade_medida,
					ie_alerta_via_adm,		ds_justificativa,
					ie_kit,				ie_medicacao_paciente,
					ie_justificativa,		ie_uso_continuo,
					ie_aplicar,			ie_dados_atb,
					ie_gerar_solucao,		ie_aplica_reducao,
					ie_regra_diluicao_cad_mat,	ie_local_adm,
					ie_dados_medicamento,		ie_questionar_obs,
					nr_agrupamento_w,		clock_timestamp(),
					nm_usuario_p,			nr_seq_interno_w,
					ie_agrupador,			nr_seq_diluicao,
					cd_kit,				qt_dias_receita
				from	protocolo_medic_material
				where	nr_seq_interno = nr_seq_interno_p;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_medic_protocolo ( nr_seq_interno_p bigint, nm_usuario_p text) FROM PUBLIC;

