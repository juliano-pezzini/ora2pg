-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pep_diag_doenca_beforepost_js ( dt_diagnostico_p timestamp, nr_atendimento_p bigint, cd_doenca_p text, ie_exige_lado_p text, nm_usuario_p text, ie_acao_p bigint, cd_estabelecimento_p bigint ) AS $body$
DECLARE


qt_diagnostico_doenca_w		bigint;
cd_doenca_cid_diag_w		bigint;
ie_exige_lado_w			varchar(1) := 'N';


BEGIN

	select	count(*)
	into STRICT	qt_diagnostico_doenca_w
	from	diagnostico_doenca
	where	dt_diagnostico  = dt_diagnostico_p
	and	nr_atendimento  = nr_atendimento_p
	and	cd_doenca       = cd_doenca_p;

if (qt_diagnostico_doenca_w > 0) and (ie_acao_p = 1) then
	begin
	--(-20011, substr(obter_texto_dic_objeto(12632,wheb_usuario_pck.get_nr_seq_idioma,'cd_doenca='|| cd_doenca_p),1,255) || '#@#@');
	CALL Wheb_mensagem_pck.exibir_mensagem_abort(12632,'CD_DOENCA=' || CD_DOENCA_P);
	end;
end if;

select	max(ie_exige_lado)
into STRICT	ie_exige_lado_w
from	cid_doenca
where	cd_doenca_cid = cd_doenca_p;


if (ie_exige_lado_w = 'S') and (coalesce(ie_exige_lado_p::text, '') = '') then
	begin
	--(-20011, substr(obter_texto_tasy (60167, wheb_usuario_pck.get_nr_seq_idioma),1,255) || '#@#@');
	CALL Wheb_mensagem_pck.exibir_mensagem_abort(60167);
	end;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pep_diag_doenca_beforepost_js ( dt_diagnostico_p timestamp, nr_atendimento_p bigint, cd_doenca_p text, ie_exige_lado_p text, nm_usuario_p text, ie_acao_p bigint, cd_estabelecimento_p bigint ) FROM PUBLIC;

