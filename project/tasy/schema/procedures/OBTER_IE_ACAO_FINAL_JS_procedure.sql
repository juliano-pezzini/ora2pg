-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_ie_acao_final_js ( nr_sequencia_p bigint, ie_acao_final_p INOUT bigint, qt_registros_p INOUT bigint, ds_erro_p INOUT text) AS $body$
DECLARE
		
		
ie_forma_receb_w	varchar(5);
	

BEGIN 	

ie_forma_receb_w := Obter_Param_Usuario(813, 140, obter_perfil_ativo, wheb_usuario_pck.get_nm_usuario, obter_estabelecimento_ativo, ie_forma_receb_w);

if (ie_forma_receb_w = 'TF') then

	select	coalesce(max(ie_acao),0) ie_acao
	into STRICT	ie_acao_final_p
	from	transacao_financeira
	where	nr_sequencia = nr_sequencia_p;	
	
else
	select  coalesce(max(ie_acao_rec_caixa),0) ie_acao
	into STRICT	ie_acao_final_p
	from    tipo_recebimento
	where   cd_tipo_recebimento = nr_sequencia_p;
	
end if;

select	count(*)
into STRICT	qt_registros_p
from	titulo_receber_liq
where	nr_seq_caixa_rec = nr_sequencia_p;

ds_erro_p := obter_texto_tasy(95582, wheb_usuario_pck.get_nr_seq_idioma);
	
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_ie_acao_final_js ( nr_sequencia_p bigint, ie_acao_final_p INOUT bigint, qt_registros_p INOUT bigint, ds_erro_p INOUT text) FROM PUBLIC;

