-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_obter_dados_benef_js ( nr_seq_segurado_p bigint, ie_opcao_p text, cd_pessoa_fisica_p INOUT text, nr_carteira_p INOUT text, nr_seq_contrato_p INOUT text, nr_contrato_p INOUT text, ds_estipulante_p INOUT text, dt_adesao_p INOUT text, dt_liberacao_p INOUT text, dt_migracao_p INOUT text, dt_reativacao_p INOUT text, ds_pagador_p INOUT text, ds_vendedor_p INOUT text, ds_subestipulante_p INOUT text, ds_titular_p INOUT text, dt_inclusao_p INOUT text, dt_rescisao_p INOUT text, dt_limite_p INOUT text, ds_produto_p INOUT text, nm_fantasia_p INOUT text, nr_protocolo_ans_p INOUT text, ie_contratacao_p INOUT text, ds_seg_assist_p INOUT text, ds_formacao_preco_p INOUT text, ds_abrang_geo_p INOUT text, cd_anterior_p INOUT text, ie_regulamentacao_p INOUT text, ds_acomodacao_p INOUT text, ie_situacao_p INOUT text, ds_fator_p INOUT text, ds_origem_cob_p INOUT text, nr_seq_plano_p INOUT bigint, nr_seq_rol_p INOUT bigint, ds_origem_carencia_p INOUT text, ds_origem_limitacao_p INOUT text, ds_canal_venda_p INOUT text, dt_validade_carteira_p INOUT text, ds_beneficiario_p INOUT text, ds_proc_contrat_p INOUT text, dt_suspensao_p INOUT text, ds_suspensao_p INOUT text, dt_devolucao_p INOUT text, ie_nascido_plano_p INOUT text, ds_parentesco_p INOUT text, cd_cartao_intercambio_p INOUT text, ds_motivo_rescisao_p INOUT text, ds_tipo_segurado_p INOUT text, ie_situacao_trab_p INOUT text, dt_mes_reajuste_p INOUT text, ie_tipo_vinculo_operadora_p INOUT text, dt_nascimento_p INOUT text, nr_cartao_nac_sus_p INOUT text) AS $body$
DECLARE

 
/*	ie_opcao_p -> OPS - Dossie Beneficiario (Java) 
	D - Dados Beneficiário 
*/
 
ds_link_w		varchar(255);
cd_cco_w		pls_segurado.cd_cco%type;
cd_scpa_w		pls_plano.cd_scpa%type;
ds_classif_benef_w	varchar(255);
cd_operadora_empresa_w	bigint;


BEGIN 
 
SELECT * FROM pls_obter_dados_beneficiario(	nr_seq_segurado_p, nr_carteira_p, nr_seq_contrato_p, nr_contrato_p, ds_estipulante_p, dt_adesao_p, dt_liberacao_p, dt_migracao_p, dt_reativacao_p, ds_pagador_p, ds_vendedor_p, ds_subestipulante_p, ds_titular_p, dt_inclusao_p, dt_rescisao_p, dt_limite_p, ds_produto_p, nm_fantasia_p, nr_protocolo_ans_p, ie_contratacao_p, ds_seg_assist_p, ds_formacao_preco_p, ds_abrang_geo_p, cd_anterior_p, ie_regulamentacao_p, ds_acomodacao_p, ie_situacao_p, ds_fator_p, ds_origem_cob_p, nr_seq_plano_p, nr_seq_rol_p, ds_origem_carencia_p, ds_origem_limitacao_p, ds_canal_venda_p, dt_validade_carteira_p, dt_suspensao_p, ds_suspensao_p, dt_devolucao_p, ie_nascido_plano_p, ds_parentesco_p, cd_cartao_intercambio_p, ds_tipo_segurado_p, ie_situacao_trab_p, dt_mes_reajuste_p, ie_tipo_vinculo_operadora_p, ds_link_w, cd_cco_w, cd_scpa_w, dt_nascimento_p, nr_cartao_nac_sus_p, ds_classif_benef_w, cd_operadora_empresa_w) INTO STRICT nr_carteira_p, nr_seq_contrato_p, nr_contrato_p, ds_estipulante_p, dt_adesao_p, dt_liberacao_p, dt_migracao_p, dt_reativacao_p, ds_pagador_p, ds_vendedor_p, ds_subestipulante_p, ds_titular_p, dt_inclusao_p, dt_rescisao_p, dt_limite_p, ds_produto_p, nm_fantasia_p, nr_protocolo_ans_p, ie_contratacao_p, ds_seg_assist_p, ds_formacao_preco_p, ds_abrang_geo_p, cd_anterior_p, ie_regulamentacao_p, ds_acomodacao_p, ie_situacao_p, ds_fator_p, ds_origem_cob_p, nr_seq_plano_p, nr_seq_rol_p, ds_origem_carencia_p, ds_origem_limitacao_p, ds_canal_venda_p, dt_validade_carteira_p, dt_suspensao_p, ds_suspensao_p, dt_devolucao_p, ie_nascido_plano_p, ds_parentesco_p, cd_cartao_intercambio_p, ds_tipo_segurado_p, ie_situacao_trab_p, dt_mes_reajuste_p, ie_tipo_vinculo_operadora_p, ds_link_w, cd_cco_w, cd_scpa_w, dt_nascimento_p, nr_cartao_nac_sus_p, ds_classif_benef_w, cd_operadora_empresa_w;
 
select	CASE WHEN coalesce(nr_seq_plano_p::text, '') = '' THEN  substr(obter_texto_tasy(55174, wheb_usuario_pck.get_nr_seq_idioma),1,255)  ELSE substr(pls_obter_acomodacoes_plano(nr_seq_plano_p),1,80) END  
into STRICT	ds_acomodacao_p
;
 
ds_motivo_rescisao_p := substr(pls_obter_dados_segurado(nr_seq_segurado_p,'DMR'),1,255);
 
if (ie_opcao_p IS NOT NULL AND ie_opcao_p::text <> '') then 
	begin 
	if (ie_opcao_p = 'D') then 
		begin 
		select	substr(pls_obter_dados_segurado(nr_seq_segurado_p, 'PF'), 1,10) 
		into STRICT	cd_pessoa_fisica_p 
		;
		 
		select	'Beneficiário: ' || substr(pls_obter_dados_segurado(nr_seq_segurado_p, 'N'), 1, 60), 
				'Produto Contratado: ' || ds_produto_p || ' (' || nr_seq_plano_p || ')' 
		into STRICT	ds_beneficiario_p, 
				ds_proc_contrat_p 
		;
		end;
	end if;
	end;
end if;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_obter_dados_benef_js ( nr_seq_segurado_p bigint, ie_opcao_p text, cd_pessoa_fisica_p INOUT text, nr_carteira_p INOUT text, nr_seq_contrato_p INOUT text, nr_contrato_p INOUT text, ds_estipulante_p INOUT text, dt_adesao_p INOUT text, dt_liberacao_p INOUT text, dt_migracao_p INOUT text, dt_reativacao_p INOUT text, ds_pagador_p INOUT text, ds_vendedor_p INOUT text, ds_subestipulante_p INOUT text, ds_titular_p INOUT text, dt_inclusao_p INOUT text, dt_rescisao_p INOUT text, dt_limite_p INOUT text, ds_produto_p INOUT text, nm_fantasia_p INOUT text, nr_protocolo_ans_p INOUT text, ie_contratacao_p INOUT text, ds_seg_assist_p INOUT text, ds_formacao_preco_p INOUT text, ds_abrang_geo_p INOUT text, cd_anterior_p INOUT text, ie_regulamentacao_p INOUT text, ds_acomodacao_p INOUT text, ie_situacao_p INOUT text, ds_fator_p INOUT text, ds_origem_cob_p INOUT text, nr_seq_plano_p INOUT bigint, nr_seq_rol_p INOUT bigint, ds_origem_carencia_p INOUT text, ds_origem_limitacao_p INOUT text, ds_canal_venda_p INOUT text, dt_validade_carteira_p INOUT text, ds_beneficiario_p INOUT text, ds_proc_contrat_p INOUT text, dt_suspensao_p INOUT text, ds_suspensao_p INOUT text, dt_devolucao_p INOUT text, ie_nascido_plano_p INOUT text, ds_parentesco_p INOUT text, cd_cartao_intercambio_p INOUT text, ds_motivo_rescisao_p INOUT text, ds_tipo_segurado_p INOUT text, ie_situacao_trab_p INOUT text, dt_mes_reajuste_p INOUT text, ie_tipo_vinculo_operadora_p INOUT text, dt_nascimento_p INOUT text, nr_cartao_nac_sus_p INOUT text) FROM PUBLIC;

