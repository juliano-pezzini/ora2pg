-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE nicu_delete_generic_simpl_pk (nm_table_p text, nr_pk_p bigint, retorno_o INOUT text, nm_pk_p text default null) AS $body$
DECLARE

  
  exist_table    bigint;
  erro_exception exception;

BEGIN

  begin
    select 1
      into STRICT exist_table
      from all_Tables 
     where upper(table_name) = upper(nm_table_p);
  exception
    when others then
      null;
  end;

  if (coalesce(exist_table::text, '') = '') then
      --Tabela #@NM_TABELA_ORIGEM#@ nao existe no sistema!
      retorno_o := wheb_mensagem_pck.get_texto(1181967, 'NM_TABELA_ORIGEM='||nm_table_p);
      raise erro_exception;
  end if;

  if (coalesce(nm_table_p::text, '') = '') then
      --Tabela inexistente
      retorno_o := wheb_mensagem_pck.get_texto(1181965);
      raise erro_exception;
  end if;

  if (coalesce(nr_pk_p::text, '') = '') then
      --Deve-se informar o campo #@CD_ITEM#@
      retorno_o := wheb_mensagem_pck.get_texto(1181970, 'CD_ITEM=NR_PK_P');
      raise erro_exception;
  end if;

  begin
    EXECUTE
      'DELETE '||nm_table_p||'
        WHERE '||coalesce(nm_pk_p, 'NR_SEQUENCIA')||' = '||nr_pk_p;
  exception
    when others then    
      --Ocorreu um erro ao deletar da tabela
      retorno_o := wheb_mensagem_pck.get_texto(1181973)||' Error: '||sqlerrm;
      raise erro_exception;
  end;

  commit;
exception
  when erro_exception then
    rollback;
  when others then
    rollback;
    --Ocorreu um erro ao deletar da tabela
    retorno_o := wheb_mensagem_pck.get_texto(1181973)||' Error: '||sqlerrm;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE nicu_delete_generic_simpl_pk (nm_table_p text, nr_pk_p bigint, retorno_o INOUT text, nm_pk_p text default null) FROM PUBLIC;

