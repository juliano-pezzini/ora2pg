-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE update_parto_linked_data ( nr_atendimento_p bigint, nr_seq_reg_template_p bigint, nr_seq_template_p bigint, nm_tabela_linked_data text) AS $body$
DECLARE


  ds_comando_w		text;
  first_record    boolean := true;

  c01 CURSOR FOR
  SELECT column_name from user_tab_columns where table_name = nm_tabela_linked_data
  and column_name not in ('NR_SEQUENCIA', 'NR_SEQ_TEMPLATE', 'NR_SEQ_LINKED_DATA', 'NR_SEQ_REG_TEMPLATE', 'NM_USUARIO', 'DT_ATUALIZACAO', 'NM_USUARIO_NREC', 'DT_ATUALIZACAO_NREC', 'NR_ATENDIMENTO');

BEGIN

  ds_comando_w	:=	'update PARTO set';
  FOR row1 IN c01
  LOOP

  if not first_record then
    ds_comando_w := ds_comando_w || ', ';
  end if;
  first_record := false;

  ds_comando_w := ds_comando_w || 
    ' ' || row1.column_name || 
    '= (' ||
    ' select ' || row1.column_name ||
    ' from ' || nm_tabela_linked_data ||
    ' where NR_SEQ_REG_TEMPLATE = :nr_seq_reg_template' ||
    ' and NR_SEQ_TEMPLATE = :nr_seq_template' ||
   ')';

  END LOOP;

  ds_comando_w	:= ds_comando_w || ' where nr_atendimento = :nr_atendimento';
  CALL exec_sql_dinamico_bv(obter_desc_expressao(726973), ds_comando_w, 'nr_seq_reg_template='|| to_char(nr_seq_reg_template_p) || 
    obter_separador_bv || 'nr_seq_template='|| to_char(nr_seq_template_p) ||
    obter_separador_bv || 'nr_atendimento='|| to_char(nr_atendimento_p));
  commit;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE update_parto_linked_data ( nr_atendimento_p bigint, nr_seq_reg_template_p bigint, nr_seq_template_p bigint, nm_tabela_linked_data text) FROM PUBLIC;

