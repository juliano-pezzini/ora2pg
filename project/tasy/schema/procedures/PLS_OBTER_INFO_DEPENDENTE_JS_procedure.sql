-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_obter_info_dependente_js ( nr_seq_titular_p bigint, nr_seq_contrato_p bigint, cd_estabelecimento_p bigint, nr_seq_subestipulante_p INOUT bigint, nr_seq_plano_p INOUT bigint, nr_seq_tabela_p INOUT bigint, nr_seq_pagador_p INOUT bigint, nm_usuario_p text) AS $body$
BEGIN

if (coalesce(obter_valor_param_usuario(1202, 64, Obter_Perfil_Ativo, nm_usuario_p, cd_estabelecimento_p), 'N') = 'N') then
	select	max(nr_seq_subestipulante)
	into STRICT	nr_seq_subestipulante_p
	from	pls_segurado
	where	nr_sequencia = nr_seq_titular_p;
end if;

if (coalesce(obter_valor_param_usuario(1202, 65, Obter_Perfil_Ativo, nm_usuario_p, cd_estabelecimento_p), 'N') = 'N') or (coalesce(obter_valor_param_usuario(1202, 104, Obter_Perfil_Ativo, nm_usuario_p, cd_estabelecimento_p), 'N') = 'S') then
	select	max(nr_seq_plano)
	into STRICT	nr_seq_plano_p
	from	pls_segurado
	where	nr_sequencia = nr_seq_titular_p;

	if (nr_seq_plano_p IS NOT NULL AND nr_seq_plano_p::text <> '') then
		 select	max(nr_seq_tabela)
		 into STRICT	nr_seq_tabela_p
		 from	pls_contrato_plano
		 where  nr_seq_plano    = nr_seq_plano_p
		 and	nr_seq_contrato	= nr_seq_contrato_p;
	end if;

end if;

select	max(nr_seq_pagador)
into STRICT	nr_seq_pagador_p
from	pls_segurado
where  	nr_sequencia = nr_seq_titular_p
and (coalesce(dt_rescisao::text, '') = '' or dt_rescisao > clock_timestamp());

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_obter_info_dependente_js ( nr_seq_titular_p bigint, nr_seq_contrato_p bigint, cd_estabelecimento_p bigint, nr_seq_subestipulante_p INOUT bigint, nr_seq_plano_p INOUT bigint, nr_seq_tabela_p INOUT bigint, nr_seq_pagador_p INOUT bigint, nm_usuario_p text) FROM PUBLIC;

