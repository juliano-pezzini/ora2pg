-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_ged_atendimento (nr_atendimento_p bigint ,cd_estabelecimento_p bigint ,cd_profissional_p bigint ,cd_pessoa_fisica_p bigint ,ds_arquivo_p text ,DS_PROCURAR_POR_P text ,DS_SUBSTITUIR_POR_P text ,ie_substituir_p text) AS $body$
DECLARE


   nr_sequencia_w bigint;
   ds_arquivo_w varchar(32767);

BEGIN
  IF ie_substituir_p = 'S' THEN
    ds_arquivo_w := replace(ds_arquivo_p,DS_PROCURAR_POR_P,DS_SUBSTITUIR_POR_P);
    ds_arquivo_w := replace(ds_arquivo_w,'/','\');
  ELSE
    ds_arquivo_w := ds_arquivo_p;
  END IF;
  select nextval('ged_atendimento_seq')
    into STRICT nr_sequencia_w
;
  insert into ged_atendimento( nr_sequencia
     ,nr_atendimento
     ,cd_estabelecimento
     ,dt_atualizacao
     ,nm_usuario
     ,dt_atualizacao_nrec
     ,nm_usuario_nrec
     ,dt_liberacao
     ,cd_profissional
     ,dt_registro
     ,ie_nivel_atencao
     ,ds_arquivo
     ,cd_pessoa_fisica
     ,ie_situacao
      )
    values ( nr_sequencia_w
     ,nr_atendimento_p
     ,cd_estabelecimento_p
     ,clock_timestamp()
     ,'Integ.Dixtal'
     ,clock_timestamp()
     ,'Integ.Dixtal'
     ,clock_timestamp()
     ,cd_profissional_p
     ,clock_timestamp()
     ,'T'
     ,ds_arquivo_w
     ,cd_pessoa_fisica_p
     ,'A'
      );
    commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_ged_atendimento (nr_atendimento_p bigint ,cd_estabelecimento_p bigint ,cd_profissional_p bigint ,cd_pessoa_fisica_p bigint ,ds_arquivo_p text ,DS_PROCURAR_POR_P text ,DS_SUBSTITUIR_POR_P text ,ie_substituir_p text) FROM PUBLIC;

