-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE abdata_obter_unidade_medida (nr_seq_import_p bigint, cd_unidade_medida_p INOUT text, ds_unidade_medida_p INOUT text) AS $body$
DECLARE


cd_unidade_abdata_w	varchar(30);
ds_unidade_medida_w	varchar(40);


BEGIN

cd_unidade_abdata_w	:= null;
ds_unidade_medida_w	:= null;

--Primeiro busca com base no código	
begin
select	key_daa,
	substr(name,1,40)
into STRICT	cd_unidade_abdata_w,
	ds_unidade_medida_w
from	daa_med
where	key_daa		= cd_unidade_medida_p
and	nr_seq_import	= nr_seq_import_p  LIMIT 1;
exception
when no_data_found then
	begin
	select	key_daa,
		substr(name,1,40)
	into STRICT	cd_unidade_abdata_w,
		ds_unidade_medida_w
	from	daa_med
	where	abkuerzung 	= cd_unidade_medida_p
	and	nr_seq_import	= nr_seq_import_p  LIMIT 1;	
	exception
	when no_data_found then	
		begin
		select	key_daf,
			substr(name,1,40)
		into STRICT	cd_unidade_abdata_w,
			ds_unidade_medida_w
		from	daf_med
		where	key_daf		= cd_unidade_medida_p
		and	nr_seq_import	= nr_seq_import_p  LIMIT 1;
		exception
		when no_data_found then
			begin		
			select	schluesselwert,
				substr(plural,1,40)
			into STRICT	cd_unidade_abdata_w,
				ds_unidade_medida_w
			from	kvp_med
			where	nr_seq_import 	= nr_seq_import_p
			and	feldidentifier 	= '03'
			and	dateinr		 = 1224
			and	schluesselwert	= cd_unidade_medida_p  LIMIT 1;
			exception
			when no_data_found then
				begin
				select	cd_unidade_medida,
					substr(ds_unidade_medida,1,40) ds_unidade_medida
				into STRICT	cd_unidade_abdata_w,
					ds_unidade_medida_w
				from	abdata_prg2_unidade_medida_v
				where	cd_unidade_medida	= cd_unidade_medida_p  LIMIT 1;
				exception
				when others then		
					cd_unidade_abdata_w	:= null;				
				end;
			end;		
		end;		
	end;
end;

--Se não encontrou por código, busca então pela descrição
if (coalesce(cd_unidade_abdata_w::text, '') = '') then
	begin
	select	key_daa,
		substr(name,1,40)
	into STRICT	cd_unidade_abdata_w,
		ds_unidade_medida_w
	from	daa_med
	where	name		= cd_unidade_medida_p
	and	nr_seq_import	= nr_seq_import_p  LIMIT 1;
	exception
	when no_data_found then
		begin	
		select	cd_unidade_medida,
			substr(ds_unidade_medida,1,40) ds_unidade_medida
		into STRICT	cd_unidade_abdata_w,
			ds_unidade_medida_w
		from	abdata_prg2_unidade_medida_v
		where	ds_unidade_medida	= cd_unidade_medida_p  LIMIT 1;
		exception
		when others then		
			cd_unidade_abdata_w	:= null;				
		end;		
	end;
end if;

cd_unidade_medida_p	:= cd_unidade_abdata_w;
ds_unidade_medida_p	:= ds_unidade_medida_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE abdata_obter_unidade_medida (nr_seq_import_p bigint, cd_unidade_medida_p INOUT text, ds_unidade_medida_p INOUT text) FROM PUBLIC;

