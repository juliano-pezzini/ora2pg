-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE hdm_obter_dados_turma ( nr_sequencia_p bigint, nr_seq_turma_p bigint, ie_ci_incluir_p INOUT text, ie_email_incluir_p INOUT text, ie_ci_excluir_p INOUT text, ie_email_excluir_p INOUT text, usuario_destino_p INOUT text, ds_email_destino_p INOUT text ) AS $body$
DECLARE

		 
ie_ci_incluir_w		varchar(1)			:= null;	
ie_email_incluir_w		varchar(1) 			:= null;
ie_ci_excluir_w		varchar(1)			:= null;	
ie_email_excluir_w		varchar(1) 			:= null;
cd_pessoa_responsavel_w 	pessoa_fisica.cd_pessoa_fisica%type 	:= null;
usuario_destino_w		usuario.nm_usuario%type		:= null;
ds_email_destino_w		varchar(255)			:= null;


BEGIN 
 
if (nr_seq_turma_p IS NOT NULL AND nr_seq_turma_p::text <> '') then 
 
	SELECT 	a.ie_ci_incluir, 
		a.ie_email_incluir, 
		a.ie_ci_excluir, 
		a.ie_email_excluir, 
		a.cd_pessoa_responsavel 
	INTO STRICT  	ie_ci_incluir_w, 
		ie_email_incluir_w, 
		ie_ci_excluir_w, 
		ie_email_excluir_w, 
		cd_pessoa_responsavel_w	 
	FROM  	MPREV_GRUPO_COL_TURMA a 
	WHERE 	a.nr_sequencia = nr_seq_turma_p;
 
	if (cd_pessoa_responsavel_w IS NOT NULL AND cd_pessoa_responsavel_w::text <> '') then 
 
		SELECT 	max(nm_usuario), 
				max(ds_email) 
		INTO STRICT	usuario_destino_w, 
				ds_email_destino_w 
		FROM 	usuario 
		WHERE 	ie_situacao = 'A' 
		AND 	cd_pessoa_fisica = cd_pessoa_responsavel_w;
		 
		if ( coalesce(ds_email_destino_w::text, '') = '') then	 
 
		 	select 	substr(obter_compl_pf(cd_pessoa_responsavel_w, 1, 'M'),1,255) 
			into STRICT 	ds_email_destino_w 
			;
		end if;	
	end if;	
end if;
 
 
 
ie_ci_incluir_p 	:= ie_ci_incluir_w;
ie_email_incluir_p 	:= ie_email_incluir_w;
ie_ci_excluir_p 	:= ie_ci_excluir_w;
ie_email_excluir_p 	:= ie_email_excluir_w;
usuario_destino_p 	:= usuario_destino_w;
ds_email_destino_p	:= ds_email_destino_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE hdm_obter_dados_turma ( nr_sequencia_p bigint, nr_seq_turma_p bigint, ie_ci_incluir_p INOUT text, ie_email_incluir_p INOUT text, ie_ci_excluir_p INOUT text, ie_email_excluir_p INOUT text, usuario_destino_p INOUT text, ds_email_destino_p INOUT text ) FROM PUBLIC;

