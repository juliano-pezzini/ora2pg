-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE get_pie_practitioners_info ( practitoner_detail_p text, cd_pessoa_fisica_p text, cd_estabelecimento_p bigint, nm_usuario_p text, nr_msg_generated_p INOUT pie_message.nr_sequencia%type) AS $body$
DECLARE

	prof_auth_count_w 	smallint;
	

BEGIN
	
	if ((practitoner_detail_p IS NOT NULL AND practitoner_detail_p::text <> '') 
	and (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '')
	and (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '')
	and (cd_estabelecimento_p IS NOT NULL AND cd_estabelecimento_p::text <> ''))  then 
	
		select count(*)
		into STRICT prof_auth_count_w
		from pie_professional_auth
		where cd_pessoa_fisica =cd_pessoa_fisica_p
		and clock_timestamp() between coalesce(trunc(dt_validity_start),trunc(clock_timestamp())) and coalesce(trunc(dt_validity_end),trunc(pkg_date_utils.get_date(2999)));

		if (prof_auth_count_w=0) then
			CALL wheb_mensagem_pck.exibir_mensagem_abort(1091159);
		end if;

         := pie_generate_request(nr_professional_p=> practitoner_detail_p, nr_professional_list_p=> null, ds_bifrost_flow_p=> 'pie.registration.details', cd_estabelecimento_p=>cd_estabelecimento_p, nm_usuario_p=>nm_usuario_p, nr_seq_msg_generated_p => nr_msg_generated_p);
	commit;
	end if;
   
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE get_pie_practitioners_info ( practitoner_detail_p text, cd_pessoa_fisica_p text, cd_estabelecimento_p bigint, nm_usuario_p text, nr_msg_generated_p INOUT pie_message.nr_sequencia%type) FROM PUBLIC;

