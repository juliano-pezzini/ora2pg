-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE com_cli_gerar_oderm_servico ( cd_cnpj_p text, ie_fase_venda_p text, nr_ordem_servico_p INOUT bigint, nm_usuario_p text) AS $body$
DECLARE

	 
cd_pessoa_usuario_w	varchar(10);
ds_razao_social_w	varchar(20);
ds_dano_w		varchar(4000);
nr_ordem_servico_w	bigint;


BEGIN 
if (cd_cnpj_p IS NOT NULL AND cd_cnpj_p::text <> '') and (ie_fase_venda_p IS NOT NULL AND ie_fase_venda_p::text <> '') and (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') then 
	begin 
	cd_pessoa_usuario_w 	:= obter_dados_usuario_opcao(nm_usuario_p,'C');
	ds_razao_social_w	:= substr(obter_dados_pf_pj(null,cd_cnpj_p,'N'),1,20);
	ds_dano_w		:= substr(obter_valor_dominio(1314,ie_fase_venda_p),1,254) || ' - ' || ds_razao_social_w;
	begin 
	nr_ordem_servico_w := man_gerar_ordem_servico( 
		52, 125, cd_pessoa_usuario_w, clock_timestamp(), 'M', 'N', ds_dano_w, nm_usuario_p, ds_dano_w, '1', '2', 'S', 161, 11, 42, nr_ordem_servico_w);
	exception 
	when others then 
		nr_ordem_servico_w := 0;
	end;
	end;
end if;
nr_ordem_servico_p	:= nr_ordem_servico_w;
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE com_cli_gerar_oderm_servico ( cd_cnpj_p text, ie_fase_venda_p text, nr_ordem_servico_p INOUT bigint, nm_usuario_p text) FROM PUBLIC;

