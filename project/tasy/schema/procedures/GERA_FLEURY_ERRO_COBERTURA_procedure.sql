-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gera_fleury_erro_cobertura ( nr_prescricao_p bigint, cd_exame_p text, ds_mensagem_p text, nm_usuario_p text ) AS $body$
DECLARE


nr_seq_prescr_w		bigint;


BEGIN


select	max(p.nr_sequencia)
into STRICT	nr_seq_prescr_w
from	prescr_procedimento p,
	exame_laboratorio e
where	p.nr_prescricao = nr_prescricao_p
and	p.nr_seq_exame	= e.nr_seq_exame
and	e.cd_exame	= cd_exame_p;


CALL Gravar_erro_prescricao_fleury(
				nr_prescricao_p,
				nr_seq_prescr_w,
				'InconsistÃªncia do Fleury',
				ds_mensagem_p,
				nm_usuario_p
				);



commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gera_fleury_erro_cobertura ( nr_prescricao_p bigint, cd_exame_p text, ds_mensagem_p text, nm_usuario_p text ) FROM PUBLIC;

