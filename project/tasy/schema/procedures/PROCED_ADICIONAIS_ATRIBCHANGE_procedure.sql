-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE proced_adicionais_atribchange (cd_estabelecimento_p bigint, cd_funcao_p bigint, cd_procedimento_p bigint, ie_origem_proced_p bigint, ie_origem_proced_uvar_p bigint, nr_seq_proc_interno_p bigint, nr_seq_exame_p bigint, cd_setor_prescricao_p bigint, nm_usuario_p text, nr_prescricao_p bigint, cd_setor_atendimento_p INOUT bigint) AS $body$
DECLARE

 
ie_gerar_setor_w	varchar(1);
cd_setor_atendimento_w	integer;
nr_atendimento_w	bigint;


BEGIN 
 
if (cd_estabelecimento_p IS NOT NULL AND cd_estabelecimento_p::text <> '') and (cd_funcao_p IS NOT NULL AND cd_funcao_p::text <> '') and (cd_procedimento_p IS NOT NULL AND cd_procedimento_p::text <> '') and (ie_origem_proced_p IS NOT NULL AND ie_origem_proced_p::text <> '') and (nr_seq_proc_interno_p IS NOT NULL AND nr_seq_proc_interno_p::text <> '') and (nr_seq_exame_p IS NOT NULL AND nr_seq_exame_p::text <> '') and (cd_setor_prescricao_p IS NOT NULL AND cd_setor_prescricao_p::text <> '') and (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') and (nr_prescricao_p IS NOT NULL AND nr_prescricao_p::text <> '') and (ie_origem_proced_uvar_p IS NOT NULL AND ie_origem_proced_uvar_p::text <> '') then 
	begin 
	ie_gerar_setor_w := obter_se_gerar_setor_rotina(cd_estabelecimento_p, 
							cd_funcao_p, 
							cd_procedimento_p, 
							ie_origem_proced_p, 
							nr_seq_proc_interno_p, 
							nr_seq_exame_p, 
							cd_setor_prescricao_p, 
							nm_usuario_p);
	if (ie_gerar_setor_w = 'S') then 
		begin 
		select	cd_setor_atendimento , 
			nr_atendimento 
		into STRICT	cd_setor_atendimento_w, 
			nr_atendimento_w 
		from	prescr_medica 
		where	nr_prescricao 	= nr_prescricao_p;
		 
		if (coalesce(cd_setor_atendimento_w::text, '') = '') then 
			begin 
			cd_setor_atendimento_w := obter_setor_atend_proc(cd_estabelecimento_p, 
									 cd_procedimento_p, 
									 ie_origem_proced_uvar_p, 
									 null, 
									 null, 
									 null, 
									 nr_seq_proc_interno_p, 
									 nr_atendimento_w);
			end;
			 
		else 
			begin 
			cd_setor_atendimento_w := obter_setor_atend_proc(cd_estabelecimento_p, 
 									 cd_procedimento_p, 
									 ie_origem_proced_uvar_p, 
									 null, 
									 cd_setor_prescricao_p, 
									 null, 
									 nr_seq_proc_interno_p, 
									 nr_atendimento_w);
			end;
		end if;
		end;
	end if;
	end;
end if;	
 
cd_setor_atendimento_p := cd_setor_atendimento_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE proced_adicionais_atribchange (cd_estabelecimento_p bigint, cd_funcao_p bigint, cd_procedimento_p bigint, ie_origem_proced_p bigint, ie_origem_proced_uvar_p bigint, nr_seq_proc_interno_p bigint, nr_seq_exame_p bigint, cd_setor_prescricao_p bigint, nm_usuario_p text, nr_prescricao_p bigint, cd_setor_atendimento_p INOUT bigint) FROM PUBLIC;

