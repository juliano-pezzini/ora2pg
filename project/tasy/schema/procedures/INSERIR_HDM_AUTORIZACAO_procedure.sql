-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_hdm_autorizacao (Seq_Hdm_Benef_Cubo_P bigint, Nr_Seq_Tipo_Atendimento_P bigint default null, Cd_Guia_Principal_P text Default Null, Ds_Especialidade_Solic_P text Default Null, Dt_Atendimento_P timestamp Default Null, Dt_Mes_Competencia_P text Default Null, Ie_Carater_Internacao_P text Default Null, Ie_Tipo_Guia_P text Default Null, Nm_Usuario_P text default null, Nr_Seq_Clinica_P bigint default null, Cd_Especialidade_P bigint Default Null, Cd_Guia_P text Default Null, Ie_Origem_P text Default Null, Seq_Hdm_Guia_Autor_Cubo_p INOUT bigint  DEFAULT NULL) AS $body$
DECLARE


Seq_Hdm_Guia_Autor_Cubo_W  bigint;
Sql_Errm_W varchar(255);


BEGIN

Select coalesce(max(nr_sequencia),0) Into STRICT Seq_Hdm_Guia_Autor_Cubo_W From Hdm_Guia_Autor_Cubo Where  Nr_Seq_Benef_Cubo = Seq_Hdm_Benef_Cubo_P and cd_guia = cd_guia_p;

if (Seq_Hdm_Guia_Autor_Cubo_W = 0) then

	begin

        Select nextval('hdm_guia_autor_cubo_seq') Into STRICT Seq_Hdm_Guia_Autor_Cubo_W;

	Insert Into Hdm_Guia_Autor_Cubo(Nr_Sequencia,
		Nr_Seq_Tipo_Atendimento,
		Cd_Guia_Principal,
		Ds_Especialidade_Solic,
		Ds_Tipo_Atendimento,
		Ds_Tipo_Internacao,
		Dt_Atendimento,
		Dt_Atualizacao,
		Dt_Atualizacao_Nrec,
		Dt_Mes_Competencia,
		Ie_Carater_Internacao,
		Ie_Tipo_Guia,
		Nm_Usuario,
		Nm_Usuario_Nrec,
		Nr_Seq_Benef_Cubo,
		Nr_Seq_Clinica,
		Cd_Especialidade,
		Cd_Guia,
		Ie_Origem)
        Values(Seq_Hdm_Guia_Autor_Cubo_W,
		Nr_Seq_Tipo_Atendimento_P,
		Cd_Guia_Principal_P,
		Ds_Especialidade_Solic_P,
		(SELECT Max(Ds_Tipo_Atendimento) From Pls_Tipo_Atendimento Where Cd_Tipo_Atendimento = Nr_Seq_Tipo_Atendimento_P),
		(select max(ds_clinica) from PLS_CLINICA where cd_clinica = NR_SEQ_CLINICA_P),
		Dt_Atendimento_P,
		clock_timestamp(),
		clock_timestamp(),
		Dt_Mes_Competencia_P,
		Ie_Carater_Internacao_P,
		Ie_Tipo_Guia_P,
		Nm_Usuario_P,
		Nm_Usuario_P,
		Seq_Hdm_Benef_Cubo_P,
		Nr_Seq_Clinica_P,
		Cd_Especialidade_P,
		Cd_Guia_P,
		Ie_Origem_P);
	Exception
	When Others Then
	Sql_Errm_W	:= Sqlerrm;
	Insert Into Hdm_Log_Integracao(Nr_Sequencia,
		Dt_Atualizacao,
		Nm_Usuario,
		Dt_Atualizacao_Nrec,
		Nm_Usuario_Nrec,
		Ie_Tipo_Log,
		Ds_Titulo,
		Ds_Log_Hdm)
	Values (nextval('hdm_log_integracao_seq'),
	clock_timestamp(),
	Nm_Usuario_P,
	clock_timestamp(),
	Nm_Usuario_P,
	'I',
	'Inserir HDM_GUIA_AUTOR_CUBO (Autorizacao)',
	Sql_Errm_W);
	end;
  End If;

  If (coalesce(Sql_Errm_W::text, '') = '') Then

    Seq_Hdm_Guia_Autor_Cubo_P := Seq_Hdm_Guia_Autor_Cubo_W;

    Else

    Seq_Hdm_Guia_Autor_Cubo_P := null;

  end if;


End;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_hdm_autorizacao (Seq_Hdm_Benef_Cubo_P bigint, Nr_Seq_Tipo_Atendimento_P bigint default null, Cd_Guia_Principal_P text Default Null, Ds_Especialidade_Solic_P text Default Null, Dt_Atendimento_P timestamp Default Null, Dt_Mes_Competencia_P text Default Null, Ie_Carater_Internacao_P text Default Null, Ie_Tipo_Guia_P text Default Null, Nm_Usuario_P text default null, Nr_Seq_Clinica_P bigint default null, Cd_Especialidade_P bigint Default Null, Cd_Guia_P text Default Null, Ie_Origem_P text Default Null, Seq_Hdm_Guia_Autor_Cubo_p INOUT bigint  DEFAULT NULL) FROM PUBLIC;

