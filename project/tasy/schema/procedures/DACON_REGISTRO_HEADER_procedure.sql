-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE dacon_registro_header (nm_usuario_p text, nr_seq_dacon_p bigint) AS $body$
DECLARE

 
ds_arquivo_w	varchar(2000);


BEGIN 
 
select	substr('DACONMS ',1,8) --ds_dacon, 
	||lpad(0,4,0)--ds_reservado, 
	||(to_char(dt_referencia, 'YYYY'))::numeric  --dt_ano_competencia, 
	||lpad(0,4,0) --ds_reservado, 
	||ie_indicador 
	||substr(obter_cgc_estabelecimento(cd_estabelecimento),1,14)--nr_identificacao 
	||'2'--ie_nr_identificacao 
	||lpad(nr_versao_pgd,3,0) 
	||coalesce(rpad(obter_razao_social(obter_cgc_estabelecimento(cd_estabelecimento)),60,' '), (rpad(' ',60,' '))) 
	||substr(nfe_obter_dados_pj(obter_cgc_estabelecimento(cd_estabelecimento),'UF'),1,2) 
	||lpad(0,10,0) 
	||lpad(' ',250,' ') 
	||lpad(0,3,0) 
	||lpad(0,10,0) 
into STRICT	ds_arquivo_w 
from	dacon 
where	nr_sequencia = nr_seq_dacon_p;
 
insert into w_dacon(NR_SEQUENCIA, 
	  DT_ATUALIZACAO, 
	  NM_USUARIO, 
	  DT_ATUALIZACAO_NREC, 
	  NM_USUARIO_NREC, 
	  DS_ARQUIVO, 
	  NR_LINHA, 
	  IE_TIPO_REGISTRO) 
values (nextval('w_dacon_seq'), 
	  clock_timestamp(), 
		nm_usuario_p, 
		clock_timestamp(), 
		nm_usuario_p, 
		ds_arquivo_w, 
		1, 
		05 );
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE dacon_registro_header (nm_usuario_p text, nr_seq_dacon_p bigint) FROM PUBLIC;

