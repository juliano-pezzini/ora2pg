-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE mprev_alterar_status_capt (nr_seq_captacao_p bigint,ie_status_p text,nm_usuario_p text) AS $body$
DECLARE


vl_parametro_w		varchar(1);
ie_status_w			varchar(1);
cd_pessoa_fisica_w  varchar(10);
/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
finalidade:  alterar o status da captação para "triagem".
-------------------------------------------------------------------------------------------------------------------
locais de chamada direta:
[ ]  objetos do dicionário [x] tasy (delphi/java) [  ] portal [  ]  relatórios [ ] outros:
 ------------------------------------------------------------------------------------------------------------------
pontos de atenção:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
BEGIN

	if (nr_seq_captacao_p IS NOT NULL AND nr_seq_captacao_p::text <> '') and (ie_status_p IS NOT NULL AND ie_status_p::text <> '') then

		select 	max(ie_status),
			max(cd_pessoa_fisica)
		into STRICT	ie_status_w,
			cd_pessoa_fisica_w
		from  	mprev_captacao
		where	nr_sequencia = nr_seq_captacao_p;

		vl_parametro_w := obter_param_usuario(10155, 10, wheb_usuario_pck.get_cd_perfil, nm_usuario_p, wheb_usuario_pck.get_cd_estabelecimento, vl_parametro_w);

		if (vl_parametro_w  = 'S') and (ie_status_w ='R') then

			update	mprev_grupo_cont_pessoa a
			set   	a.dt_exclusao 		= clock_timestamp()
			where 	cd_pessoa_fisica_w	= a.cd_pessoa_fisica;

		end if;

		update	mprev_captacao
		set	ie_status 	  	= ie_status_p,
			nm_usuario 	= nm_usuario_p,
			dt_atualizacao 	= clock_timestamp()
		where	nr_sequencia  	= nr_seq_captacao_p;

		commit;

	end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE mprev_alterar_status_capt (nr_seq_captacao_p bigint,ie_status_p text,nm_usuario_p text) FROM PUBLIC;

