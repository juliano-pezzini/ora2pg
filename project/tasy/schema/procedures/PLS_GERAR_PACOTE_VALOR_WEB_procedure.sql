-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gerar_pacote_valor_web ( nr_seq_guia_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint) AS $body$
DECLARE

				 
				 
	 
/* ie_tipo_item_p 
	P - Procedimento 
	M - Material 
*/
 
 
/* ie_origem_p 
	A - Autorização 
	C - Contas médicas 
*/
 
			 
nr_seq_item_w		bigint;
ie_tipo_item_w		varchar(1);
	
C01 CURSOR FOR 
	SELECT	'P' ie_tipo, 
		nr_sequencia 
	from	pls_guia_plano_proc 
	where	nr_seq_guia = nr_seq_guia_p 
	
union
 
	SELECT	'M' ie_tipo, 
		nr_sequencia 
	from	pls_guia_plano_mat 
	where	nr_seq_guia = nr_seq_guia_p;

BEGIN
 
open C01;
loop 
fetch C01 into	 
	ie_tipo_item_w, 
	nr_seq_item_w;	
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin		 
		CALL pls_gerar_conversao_pacote( null, nr_seq_item_w, ie_tipo_item_w, 'W', nm_usuario_p, cd_estabelecimento_p);
		if (ie_tipo_item_w = 'P') then 
			CALL pls_atualiza_valor_proc_aut(nr_seq_item_w, 'A', nm_usuario_p);
		end if;			
	end;
end loop;
close C01;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_pacote_valor_web ( nr_seq_guia_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint) FROM PUBLIC;

