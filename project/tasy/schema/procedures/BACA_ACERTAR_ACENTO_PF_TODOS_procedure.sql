-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_acertar_acento_pf_todos () AS $body$
DECLARE


/* Estrutura cliente */

trigger_name_w		varchar(255);
cont_w			bigint	:= 0;
cd_pessoa_fisica_w	varchar(10);
nm_pessoa_fisica_w	varchar(60);
ds_erro_w		varchar(4000);

c01 CURSOR FOR
SELECT	a.cd_pessoa_fisica,
	a.nm_pessoa_fisica
from	pessoa_fisica a
order by 2;

c02 CURSOR FOR
SELECT	trigger_name
from	user_triggers
where	table_name = 'PESSOA_FISICA'

union all

select	trigger_name
from	user_triggers
where	table_name = 'COMPL_PESSOA_FISICA'
order by 1;

c03 CURSOR FOR
SELECT	trigger_name
from	user_triggers
where	status = 'DISABLED'
order by
	1;


BEGIN

open c02;
loop
fetch c02 into
	trigger_name_w;
EXIT WHEN NOT FOUND; /* apply on c02 */
	begin
	CALL exec_sql_dinamico('OS110058_PF', 'alter trigger ' || trigger_name_w || ' disable');
	end;
end loop;
close c02;

open C01;
loop
fetch C01 into
	cd_pessoa_fisica_w,
	nm_pessoa_fisica_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin

	cont_w	:= cont_w + 1;

	begin
	update	pessoa_fisica a
	set	nm_pessoa_fisica_sem_acento	= elimina_acentuacao(nm_pessoa_fisica),
		nm_pessoa_pesquisa		= padronizar_nome(nm_pessoa_fisica)
	where	cd_pessoa_fisica		= cd_pessoa_fisica_w;

	exception when others then

		open c03;
		loop
		fetch c03 into
			trigger_name_w;
		EXIT WHEN NOT FOUND; /* apply on c03 */
			begin
			CALL exec_sql_dinamico('OS110058_PF', 'alter trigger ' || trigger_name_w || ' enable');
			end;
		end loop;
		close c03;

		ds_erro_w := sqlerrm || chr(13) || chr(10);
		CALL WHEB_MENSAGEM_PCK.Exibir_Mensagem_Abort(277975,'DS_ERRO='||ds_erro_w);
	end;

	if (cont_w >= 3000) then
		cont_w	:= 0;
		commit;
	end if;

	end;
end loop;
close C01;

commit;

open c03;
loop
fetch c03 into
	trigger_name_w;
EXIT WHEN NOT FOUND; /* apply on c03 */
	begin
	CALL exec_sql_dinamico('OS110058_PF', 'alter trigger ' || trigger_name_w || ' enable');
	end;
end loop;
close c03;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_acertar_acento_pf_todos () FROM PUBLIC;

