-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_agenda_exame_proced ( nr_seq_agenda_p bigint, cd_convenio_p bigint, cd_categoria_p text, cd_plano_p text, cd_estabelecimento_p bigint, dt_vigencia_p timestamp, cd_tipo_acomodacao_p bigint, ie_vago_varchar1_p text, ie_vago_varchar2_p text, ie_vago_varchar3_p text, ie_tipo_atendimento_p bigint, ie_vago_number2_p bigint, ie_vago_number3_p bigint, ie_vago_date_p timestamp) AS $body$
DECLARE

 
cd_procedimento_w	procedimento.cd_procedimento%type;
ie_origem_proced_w	procedimento.ie_origem_proced%type;						
NR_SEQ_PROC_INTERNO_w	agenda_paciente_proc.NR_SEQ_PROC_INTERNO%type;
nr_seq_agenda_w		agenda_paciente_proc.nr_seq_agenda%type;
					
C01 CURSOR FOR 
	SELECT	NR_SEQ_PROC_INTERNO, 
		nr_seq_agenda 
	from	agenda_paciente_proc 
	where	1 = 1 
	and 	nr_sequencia = nr_seq_agenda_p;	
						 

BEGIN 
 
open C01;
loop 
fetch C01 into	 
	NR_SEQ_PROC_INTERNO_w, 
	nr_seq_agenda_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin 
	 
	cd_procedimento_w := 0;
	ie_origem_proced_w := 0;
	 
	SELECT * FROM OBTER_PROC_TAB_INTER_AGENDA( NR_SEQ_PROC_INTERNO_w, 0, cd_convenio_p, cd_categoria_p, cd_plano_p, cd_estabelecimento_p, dt_vigencia_p, cd_tipo_acomodacao_p, ie_vago_varchar1_p, ie_vago_varchar2_p, ie_vago_varchar3_p, ie_tipo_atendimento_p, ie_vago_number2_p, ie_vago_number3_p, ie_vago_date_p, cd_procedimento_w, ie_origem_proced_w) INTO STRICT cd_procedimento_w, ie_origem_proced_w;
	 
	if (cd_procedimento_w > 0) then 
		update 	agenda_paciente_proc 
		set 	cd_procedimento = cd_procedimento_w, 
			ie_origem_proced = ie_origem_proced_w, 
			nm_usuario = wheb_usuario_pck.get_nm_usuario, 
			dt_atualizacao = clock_timestamp() 
		where 	nr_seq_agenda = nr_seq_agenda_w 
		and 	nr_sequencia = nr_seq_agenda_p;
	end if;
	end;
end loop;
close C01;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_agenda_exame_proced ( nr_seq_agenda_p bigint, cd_convenio_p bigint, cd_categoria_p text, cd_plano_p text, cd_estabelecimento_p bigint, dt_vigencia_p timestamp, cd_tipo_acomodacao_p bigint, ie_vago_varchar1_p text, ie_vago_varchar2_p text, ie_vago_varchar3_p text, ie_tipo_atendimento_p bigint, ie_vago_number2_p bigint, ie_vago_number3_p bigint, ie_vago_date_p timestamp) FROM PUBLIC;

