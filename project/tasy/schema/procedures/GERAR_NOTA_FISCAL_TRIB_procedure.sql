-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_nota_fiscal_trib (nr_seq_nota_fiscal_p bigint, ie_tipo_tributo_p text, vl_base_calculo_p bigint, vl_tributo_p bigint, nm_usuario_p text, ie_commit_p text) AS $body$
DECLARE


cd_tributo_w	tributo.cd_tributo%type;
tx_tributo_w	nota_fiscal_trib.tx_tributo%type;


BEGIN

select	max(a.cd_tributo)
into STRICT	cd_tributo_w
from	tributo a
where	a.ie_tipo_tributo	= ie_tipo_tributo_p;

if (cd_tributo_w IS NOT NULL AND cd_tributo_w::text <> '') then

	tx_tributo_w	:= (vl_tributo_p * 100) / vl_base_calculo_p;

	insert	into nota_fiscal_trib(cd_tributo,
		dt_atualizacao,
		dt_atualizacao_nrec,
		ie_pago_prev,
		nm_usuario,
		nm_usuario_nrec,
		nr_seq_interno,
		nr_sequencia,
		tx_tributo,
		vl_base_adic,
		vl_base_calculo,
		vl_base_nao_retido,
		vl_trib_adic,
		vl_trib_nao_retido,
		vl_tributo)
	values (cd_tributo_w,
		clock_timestamp(),
		clock_timestamp(),
		'V',
		nm_usuario_p,
		nm_usuario_p,
		nextval('nota_fiscal_trib_seq'),
		nr_seq_nota_fiscal_p,
		tx_tributo_w,
		0,
		vl_base_calculo_p,
		0,
		0,
		0,
		vl_tributo_p);

end if;

if (coalesce(ie_commit_p,'S')	= 'S') then

	commit;

end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_nota_fiscal_trib (nr_seq_nota_fiscal_p bigint, ie_tipo_tributo_p text, vl_base_calculo_p bigint, vl_tributo_p bigint, nm_usuario_p text, ie_commit_p text) FROM PUBLIC;

