-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE inserir_exec_proc_paciente ( cd_procedimento_p bigint, qt_procedimento_p bigint, nr_seq_exame_p bigint, nr_seq_proc_interno_p bigint, ie_origem_proced_p bigint, nm_usuario_p text, cd_medico_executor_p text, cd_setor_atendimento_p bigint, dt_procedimento_p timestamp, dt_acerto_conta_p timestamp, nr_interno_conta_p bigint, cd_medico_req_p text, ie_funcao_medico_p text, ie_via_acesso_p text, ie_tecnica_utilizada_p text ) AS $body$
DECLARE


	nr_sequencia_w			procedimento_paciente.nr_sequencia%type;
	ie_emite_conta_w  		varchar(3)	:= null;
	nr_seq_cor_exec_w		bigint	:= 369;
	param47_w				varchar(1);
	cd_acao_w				procedimento_paciente.cd_acao%type;



BEGIN


param47_w := Obter_param_Usuario(24, 47, obter_perfil_ativo, obter_usuario_ativo, obter_estabelecimento_ativo, param47_w);

/* verificaNegativos */

    if (param47_w = 'N' and qt_procedimento_p < 0) then

	   CALL wheb_mensagem_pck.exibir_mensagem_abort(176872);

	end if;


	if qt_procedimento_p > 0 then
	  cd_acao_w := '1';
	else
	  cd_acao_w := '2';
	end if;


select		nextval('procedimento_paciente_seq')
into STRICT		nr_sequencia_w
;



insert into procedimento_paciente(
			nr_sequencia,
			cd_procedimento,
			dt_procedimento,
			qt_procedimento,
			dt_acerto_conta,
			qt_devolvida,
			cd_acao,
			cd_setor_atendimento,
			cd_medico_req,
			ie_funcao_medico,
			ie_via_acesso,
			ie_tecnica_utilizada,
			ie_origem_proced,
			nr_seq_exame,
			nr_seq_proc_interno,
			nr_seq_cor_exec,
			nm_usuario_original,
			dt_atualizacao,
			nm_usuario,
			cd_medico_executor,
			nr_interno_conta)
		values (
			nr_sequencia_w,
			cd_procedimento_p,
			dt_procedimento_p,
			qt_procedimento_p,
			dt_acerto_conta_p,
			0,
			cd_acao_w,
			cd_setor_atendimento_p,
			cd_medico_req_p,
			ie_funcao_medico_p,
			ie_via_acesso_p,
			ie_tecnica_utilizada_p,
			ie_origem_proced_p,
			nr_seq_exame_p,
			nr_seq_proc_interno_p,
			nr_seq_cor_exec_w,
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			cd_medico_executor_p,
			nr_interno_conta_p);

-- nr_sequencia_p	:= nr_sequencia_w;
commit;


END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE inserir_exec_proc_paciente ( cd_procedimento_p bigint, qt_procedimento_p bigint, nr_seq_exame_p bigint, nr_seq_proc_interno_p bigint, ie_origem_proced_p bigint, nm_usuario_p text, cd_medico_executor_p text, cd_setor_atendimento_p bigint, dt_procedimento_p timestamp, dt_acerto_conta_p timestamp, nr_interno_conta_p bigint, cd_medico_req_p text, ie_funcao_medico_p text, ie_via_acesso_p text, ie_tecnica_utilizada_p text ) FROM PUBLIC;

