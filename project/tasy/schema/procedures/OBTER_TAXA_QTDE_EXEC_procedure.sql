-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';



CREATE TYPE campos AS (	tx_procedimento 	double precision,
			tx_medico		double precision,
			tx_custo_operacional	double precision,
			tx_auxiliar		double precision,
			tx_anestesista		double precision);


CREATE OR REPLACE PROCEDURE obter_taxa_qtde_exec (cd_estabelecimento_p bigint, nr_sequencia_p bigint, cd_convenio_p bigint, cd_categoria_p text, dt_procedimento_p timestamp, cd_procedimento_p bigint, ie_origem_proced_p bigint, nr_seq_proc_interno_p bigint, qt_procedimento_p bigint, ie_lado_p text, ie_responsavel_credito_p text, cd_edicao_amb_p bigint, tx_procedimento_p INOUT bigint, tx_custo_operacional_p INOUT bigint, tx_medico_p INOUT bigint, tx_auxiliar_p INOUT bigint, tx_anestesista_p INOUT bigint) AS $body$
DECLARE


/* NAO DAR COMMIT NESTA PROCEDURE, ELA E CHAMADA NUMA TRIGGER (PRESCR_PROCEDIMENTO_UPDATE), BRUNA 24/01/2007 */

type Vetor is table of campos index 	by integer;
Vetor_w			Vetor;

tx_proc_w			double precision;
tx_procedimento_w			double precision;
cd_grupo_proc_w			bigint;
cd_area_procedimento_w		bigint;
cd_especialidade_w		bigint;
nr_atendimento_w			bigint;
nr_interno_conta_w			bigint;
ie_regra_execucao_w		varchar(01);
qt_exec_max_w			double precision;
qt_exec_min_w			double precision;
qt_exec_w			double precision;
qt_exec_ww			double precision;
ie_regra_w			varchar(01)	:= 'N';
dt_procedimento_w			timestamp;
nr_sequencia_w			bigint;
tx_custo_oper_w			double precision;
tx_custo_operacional_w		double precision;
tx_medico_w			double precision;
tx_medico_proc_w			double precision;

cd_area_procedimento_regra_w	bigint;
cd_especialidade_regra_w 	bigint;
cd_grupo_proc_regra_w		bigint;
cd_procedimento_regra_w 	bigint;
ie_origem_proced_regra_w	bigint;
QT_MIN_REGRA_PER_w		bigint;
cd_setor_procedimento_w		integer;
cd_setor_atendimento_w		integer;
cd_pessoa_fisica_w		varchar(10);
ie_lado_w			varchar(10);
cd_edicao_amb_w			bigint;
cd_edicao_amb_filtro_w		bigint;
ie_regra_tx_qtde_exec_w		varchar(1);
ie_responsavel_credito_w	varchar(5);
ie_resp_cred_w			varchar(5);
qt_regra_w			bigint;
nr_prescricao_w			bigint;
tx_anestesista_w		double precision;
tx_auxiliar_w			double precision;
tx_aux_w			double precision;
tx_anest_w			double precision;
ie_tipo_atendimento_w		smallint;
cd_cgc_prestador_w              varchar(14);
ie_tipo_guia_w    		varchar(12);
cd_cgc_prestador_regra_w        varchar(14);
ie_tipo_guia_regra_w   		varchar(12);
dt_entrada_w			timestamp;
cd_medico_executor_w		varchar(10);
cd_medico_executor_regra_w	varchar(10);
cd_medico_exec_w		varchar(10);
nr_seq_proc_interno_w		bigint;
ie_via_acesso_w			varchar(1);
cd_plano_w			varchar(10);
k				integer := 0;
cd_tipo_procedimento_w		procedimento.cd_tipo_procedimento%type;
cd_tipo_proced_regra_w		convenio_regra_qtde.cd_tipo_procedimento%type;

c01 CURSOR FOR
	SELECT	ie_regra_execucao,
		nr_sequencia,
		cd_area_procedimento,
		cd_especialidade,
		cd_grupo_proc,
		cd_procedimento,
		ie_origem_proced,
		QT_MIN_REGRA_PER,
		cd_setor_atendimento,
		cd_edicao_amb,
		ie_responsavel_credito,
		a.ie_tipo_guia,
		a.cd_cgc_prestador,
		a.cd_medico_executor,
		nr_seq_proc_interno,
		a.cd_tipo_procedimento
	from	convenio_regra_qtde a
	where	a.cd_estabelecimento					= cd_estabelecimento_p
	and	a.cd_convenio						= cd_convenio_p
	and	coalesce(a.cd_categoria, cd_categoria_p)			= cd_categoria_p
	and	coalesce(a.cd_area_procedimento, cd_area_procedimento_w)	= cd_area_procedimento_w
	and	coalesce(a.cd_especialidade, cd_especialidade_w)		= cd_especialidade_w
	and	coalesce(a.cd_grupo_proc, cd_grupo_proc_w)			= cd_grupo_proc_w
	and	coalesce(a.cd_procedimento, cd_procedimento_p)		= cd_procedimento_p
	and	coalesce(a.ie_origem_proced, ie_origem_proced_p)		= ie_origem_proced_p
	and	coalesce(a.nr_seq_proc_interno, coalesce(nr_seq_proc_interno_p,0))= coalesce(nr_seq_proc_interno_p,0)
	and 	coalesce(a.cd_setor_atendimento, cd_setor_procedimento_w)	= cd_setor_procedimento_w
	and 	coalesce(a.ie_responsavel_credito, coalesce(ie_responsavel_credito_w, 'X')) = coalesce(ie_responsavel_credito_w,'X')
	and	coalesce(a.ie_lado,ie_lado_w)				= ie_lado_w
	and	coalesce(ie_regra_valor,'N')					= 'N'
	and	coalesce(cd_edicao_amb,cd_edicao_amb_w)			= cd_edicao_amb_w
	and	coalesce(a.ie_tipo_atendimento,coalesce(ie_tipo_atendimento_w,0))	= coalesce(ie_tipo_atendimento_w,0)
	and	coalesce(a.ie_tipo_guia,coalesce(ie_tipo_guia_w,0))	= coalesce(ie_tipo_guia_w,0)
	and	coalesce(a.cd_cgc_prestador,coalesce(cd_cgc_prestador_w,0))	= coalesce(cd_cgc_prestador_w,0)	
	and	coalesce(a.cd_medico_executor,coalesce(cd_medico_executor_w,'0'))	= coalesce(cd_medico_executor_w,'0')
	and	coalesce(a.cd_plano, coalesce(cd_plano_w,'0'))		        = coalesce(cd_plano_w,'0')
	and	coalesce(a.ie_via_acesso, coalesce(ie_via_acesso_w,'0'))		= coalesce(ie_via_acesso_w,'0')
	and	coalesce(a.cd_tipo_procedimento, coalesce(cd_tipo_procedimento_w,0)) = coalesce(cd_tipo_procedimento_w,0)
	and 	coalesce(a.ie_situacao,'A')					= 'A'
	and	a.ie_regra_execucao					<> 'O'
	and	a.dt_vigencia						=
			(SELECT		max(b.dt_vigencia)
			from	convenio_regra_qtde b
			where	b.cd_estabelecimento					= cd_estabelecimento_p
			and	b.cd_convenio						= cd_convenio_p
			and	coalesce(b.cd_categoria, cd_categoria_p)			= cd_categoria_p
			and	coalesce(b.cd_area_procedimento, cd_area_procedimento_w)	= cd_area_procedimento_w
			and	coalesce(b.cd_especialidade, cd_especialidade_w)		= cd_especialidade_w
			and	coalesce(b.cd_grupo_proc, cd_grupo_proc_w)			= cd_grupo_proc_w
			and	coalesce(b.cd_procedimento, cd_procedimento_p)		= cd_procedimento_p
			and	coalesce(b.ie_origem_proced, ie_origem_proced_p)		= ie_origem_proced_p
			and	coalesce(b.nr_seq_proc_interno, coalesce(nr_seq_proc_interno_p,0))= coalesce(nr_seq_proc_interno_p,0)
			and 	coalesce(b.cd_setor_atendimento, cd_setor_procedimento_w)	= cd_setor_procedimento_w
			and 	coalesce(b.ie_responsavel_credito, coalesce(ie_responsavel_credito_w, 'X')) = coalesce(ie_responsavel_credito_w,'X')
			and	coalesce(b.ie_tipo_atendimento,coalesce(ie_tipo_atendimento_w,0))	= coalesce(ie_tipo_atendimento_w,0)
			and	coalesce(b.ie_tipo_guia,coalesce(ie_tipo_guia_w,0))	= coalesce(ie_tipo_guia_w,0)
			and	coalesce(b.cd_cgc_prestador,coalesce(cd_cgc_prestador_w,0))	= coalesce(cd_cgc_prestador_w,0)
			and	coalesce(b.cd_medico_executor,coalesce(cd_medico_executor_w,0))	= coalesce(cd_medico_executor_w,0)
			and	coalesce(a.cd_plano, coalesce(cd_plano_w,'0'))		        = coalesce(cd_plano_w,'0')
			and	coalesce(b.ie_via_acesso, coalesce(ie_via_acesso_w,'0'))		= coalesce(ie_via_acesso_w,'0')
			and	coalesce(b.cd_tipo_procedimento, coalesce(cd_tipo_procedimento_w,0)) = coalesce(cd_tipo_procedimento_w,0)
			and 	coalesce(b.ie_situacao,'A')					= 'A'
			and	b.ie_regra_execucao					<> 'O'
			and	CASE WHEN coalesce(ie_tipo_data,'A')='A' THEN  dt_entrada_w WHEN coalesce(ie_tipo_data,'A')='E' THEN dt_procedimento_w END  > b.dt_vigencia)
	order by 	coalesce(a.cd_procedimento,0) desc,
			coalesce(a.cd_grupo_proc,0) desc,
			coalesce(a.cd_especialidade,0) desc,
			coalesce(a.cd_area_procedimento,0) desc;

c02 CURSOR FOR
	SELECT	qt_exec_min,
		qt_exec_max,
		tx_procedimento,
		tx_custo_operacional,
		tx_medico,
		tx_auxiliar,
		tx_anestesista
	from	convenio_regra_qtde_tx
	where	nr_seq_regra	= nr_sequencia_w;


BEGIN
tx_procedimento_w	:= tx_procedimento_p;
ie_lado_w		:= coalesce(ie_lado_p,'A');
cd_edicao_amb_w		:= coalesce(cd_edicao_amb_p,0);
ie_responsavel_credito_w:= coalesce(ie_responsavel_credito_p,'X');
begin


select 	cd_grupo_proc,
	cd_area_procedimento,
	cd_especialidade,
	cd_tipo_procedimento
into STRICT	cd_grupo_proc_w,
	cd_area_procedimento_w,
	cd_especialidade_w,
	cd_tipo_procedimento_w
from	estrutura_procedimento_v
where	cd_procedimento		= cd_procedimento_p
and	ie_origem_proced	= ie_origem_proced_p;
exception
     	 when others then
	 begin
	 cd_grupo_proc_w		:= 0;
	 cd_area_procedimento_w		:= 0;
	 cd_especialidade_w		:= 0;
	 end;
end;

begin
select	nr_atendimento,
	nr_interno_conta,
	dt_procedimento,
	cd_setor_atendimento,
	coalesce(nr_prescricao,0),
	cd_cgc_prestador,
	ie_tipo_guia,
	cd_medico_executor,
	ie_via_acesso
into STRICT	nr_atendimento_w,
	nr_interno_conta_w,
	dt_procedimento_w,
	cd_setor_procedimento_w, /*Fabricio em  16/09/2008 Inclui o campo Setor   OS 108909 */
	nr_prescricao_w,
	cd_cgc_prestador_w,
	ie_tipo_guia_w,
	cd_medico_executor_w,
	ie_via_acesso_w
from	procedimento_paciente
where	nr_sequencia	= nr_sequencia_p;
exception
     	 when others then
	 begin
	 nr_atendimento_w		:= 0;
	 nr_interno_conta_w		:= 0;
	 nr_prescricao_w		:= 0;
	 end;
end;

select 	coalesce(obter_pessoa_atendimento(nr_atendimento_w, 'C'),'0')
into STRICT	cd_pessoa_fisica_w
;

select	coalesce(max(ie_regra_tx_qtde_exec),'N')
into STRICT	ie_regra_tx_qtde_exec_w
from	parametro_faturamento
where	cd_estabelecimento	= cd_estabelecimento_p;

select 	ie_tipo_atendimento,
	dt_entrada,
	substr(obter_dado_atend_cat_conv(nr_atendimento, dt_procedimento_w, cd_convenio_p, cd_categoria_p, 'P'),1,10)
into STRICT	ie_tipo_atendimento_w,
	dt_entrada_w,
	cd_plano_w
from	atendimento_paciente
where	nr_atendimento =  nr_atendimento_w;


if (ie_regra_tx_qtde_exec_w	= 'S') then

	qt_regra_w:= 0;
	
	if (nr_atendimento_w <> 0) then
		begin
		
		open	c01;
		loop
		fetch	c01 into
			ie_regra_execucao_w,
			nr_sequencia_w,
			cd_area_procedimento_regra_w,
			cd_especialidade_regra_w,
			cd_grupo_proc_regra_w,
			cd_procedimento_regra_w,
			ie_origem_proced_regra_w,
			QT_MIN_REGRA_PER_w,
			cd_setor_atendimento_w,
			cd_edicao_amb_filtro_w,
			ie_resp_cred_w,
			ie_tipo_guia_regra_w,
			cd_cgc_prestador_regra_w,
			cd_medico_executor_regra_w,
			nr_seq_proc_interno_w,
			cd_tipo_proced_regra_w;
		EXIT WHEN NOT FOUND; /* apply on c01 */
			begin

			qt_regra_w			:= 1;
			ie_regra_w			:= 'N';


			if (ie_regra_execucao_w 	= 'A') then
				select	coalesce(sum(a.qt_procedimento),0)
				into STRICT	qt_exec_w
				from	estrutura_procedimento_v b,
					procedimento_paciente a
				where	a.cd_procedimento		= b.cd_procedimento
				and	a.ie_origem_proced		= b.ie_origem_proced
				and	((coalesce(cd_area_procedimento_regra_w::text, '') = '') or (b.cd_area_procedimento = cd_area_procedimento_regra_w))
				and	((coalesce(cd_especialidade_regra_w::text, '') = '') or (b.cd_especialidade = cd_especialidade_regra_w))
				and	((coalesce(cd_grupo_proc_regra_w::text, '') = '') or (b.cd_grupo_proc = cd_grupo_proc_regra_w))
				and	((coalesce(cd_procedimento_regra_w::text, '') = '') or (a.cd_procedimento = cd_procedimento_regra_w))
				and	((coalesce(ie_origem_proced_regra_w::text, '') = '') or (a.ie_origem_proced = ie_origem_proced_regra_w))
				and 	((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
				and 	((coalesce(ie_resp_cred_w::text, '') = '') or (coalesce(a.ie_responsavel_credito, ie_resp_cred_w) = ie_resp_cred_w))
				and	((coalesce(cd_edicao_amb_filtro_w::text, '') = '') or (coalesce(a.cd_edicao_amb,cd_edicao_amb_w) = cd_edicao_amb_filtro_w))
				and	coalesce(a.cd_motivo_exc_conta::text, '') = ''
				and	a.nr_atendimento		= nr_atendimento_w
				and	((coalesce(nr_seq_proc_interno_w::text, '') = '') or (a.nr_seq_proc_interno = nr_seq_proc_interno_w))
			/*	and	a.dt_procedimento		<= dt_procedimento_w;       Felipe Martini OS 106413, 107927*/

				and	a.nr_sequencia		< nr_sequencia_p
				and 	((coalesce(ie_tipo_guia_regra_w::text, '') = '') or (a.ie_tipo_guia = ie_tipo_guia_regra_w))
				and 	((coalesce(cd_cgc_prestador_regra_w::text, '') = '') or (a.cd_cgc_prestador = cd_cgc_prestador_regra_w))
				and	((coalesce(cd_medico_executor_regra_w::text, '') = '') or (a.cd_medico_executor = cd_medico_executor_regra_w))
				and	((coalesce(cd_tipo_proced_regra_w::text, '') = '') or (b.cd_tipo_procedimento = cd_tipo_proced_regra_w))
				and	not exists (SELECT 1 from conta_paciente x where a.nr_interno_conta = x.nr_interno_conta and (x.ie_cancelamento IS NOT NULL AND x.ie_cancelamento::text <> ''));
			elsif (ie_regra_execucao_w 	= 'D') then
				select	coalesce(sum(qt_procedimento),0)
				into STRICT	qt_exec_w
				from	estrutura_procedimento_v b,
					procedimento_paciente a
				where	a.cd_procedimento		= b.cd_procedimento
				and	a.ie_origem_proced		= b.ie_origem_proced
				and	((coalesce(cd_area_procedimento_regra_w::text, '') = '') or (b.cd_area_procedimento = cd_area_procedimento_regra_w))
				and	((coalesce(cd_especialidade_regra_w::text, '') = '') or (b.cd_especialidade = cd_especialidade_regra_w))
				and	((coalesce(cd_grupo_proc_regra_w::text, '') = '') or (b.cd_grupo_proc = cd_grupo_proc_regra_w))
				and	((coalesce(cd_procedimento_regra_w::text, '') = '') or (a.cd_procedimento = cd_procedimento_regra_w))
				and	((coalesce(ie_origem_proced_regra_w::text, '') = '') or (a.ie_origem_proced = ie_origem_proced_regra_w))
				and 	((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
				and 	((coalesce(ie_resp_cred_w::text, '') = '') or (coalesce(a.ie_responsavel_credito, ie_resp_cred_w) = ie_resp_cred_w))
				and	coalesce(a.cd_motivo_exc_conta::text, '') = ''
				and	a.nr_atendimento		= nr_atendimento_w
				and	((coalesce(nr_seq_proc_interno_w::text, '') = '') or (a.nr_seq_proc_interno = nr_seq_proc_interno_w))
				and	((coalesce(cd_edicao_amb_filtro_w::text, '') = '') or (coalesce(a.cd_edicao_amb,cd_edicao_amb_w) = cd_edicao_amb_filtro_w))
				and	a.nr_sequencia		< nr_sequencia_p	/* Fabricio OS 109214 */
				and	a.dt_procedimento		between PKG_DATE_UTILS.start_of(dt_procedimento_p, 'dd',0) and
								PKG_DATE_UTILS.end_of(dt_procedimento_p, 'DAY',0)
				and 	((coalesce(ie_tipo_guia_regra_w::text, '') = '') or (a.ie_tipo_guia = ie_tipo_guia_regra_w))
				and 	((coalesce(cd_cgc_prestador_regra_w::text, '') = '') or (a.cd_cgc_prestador = cd_cgc_prestador_regra_w))
				and	((coalesce(cd_medico_executor_regra_w::text, '') = '') or (a.cd_medico_executor = cd_medico_executor_regra_w))
				and	((coalesce(cd_tipo_proced_regra_w::text, '') = '') or (b.cd_tipo_procedimento = cd_tipo_proced_regra_w))
				and	not exists (SELECT 1 from conta_paciente x where a.nr_interno_conta = x.nr_interno_conta and (x.ie_cancelamento IS NOT NULL AND x.ie_cancelamento::text <> ''));
			elsif (ie_regra_execucao_w 	= 'P') then

				select	coalesce(sum(qt_procedimento),0)
				into STRICT	qt_exec_w
				from	estrutura_procedimento_v b,
					procedimento_paciente a
				where	a.cd_procedimento		= b.cd_procedimento
				and	a.ie_origem_proced		= b.ie_origem_proced
				and	((coalesce(cd_area_procedimento_regra_w::text, '') = '') or (b.cd_area_procedimento = cd_area_procedimento_regra_w))
				and	((coalesce(cd_especialidade_regra_w::text, '') = '') or (b.cd_especialidade = cd_especialidade_regra_w))
				and	((coalesce(cd_grupo_proc_regra_w::text, '') = '') or (b.cd_grupo_proc = cd_grupo_proc_regra_w))
				and	((coalesce(cd_procedimento_regra_w::text, '') = '') or (a.cd_procedimento = cd_procedimento_regra_w))
				and	((coalesce(ie_origem_proced_regra_w::text, '') = '') or (a.ie_origem_proced = ie_origem_proced_regra_w))
				and 	((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
				and 	((coalesce(ie_resp_cred_w::text, '') = '') or (coalesce(a.ie_responsavel_credito, ie_resp_cred_w) = ie_resp_cred_w))
				and	coalesce(a.cd_motivo_exc_conta::text, '') = ''
				and	a.nr_sequencia		< nr_sequencia_p
				and	a.nr_atendimento		= nr_atendimento_w
				and	((coalesce(nr_seq_proc_interno_w::text, '') = '') or (a.nr_seq_proc_interno = nr_seq_proc_interno_w))
				and	((coalesce(cd_edicao_amb_filtro_w::text, '') = '') or (coalesce(a.cd_edicao_amb,cd_edicao_amb_w) = cd_edicao_amb_filtro_w))
				and 	((coalesce(ie_tipo_guia_regra_w::text, '') = '') or (a.ie_tipo_guia = ie_tipo_guia_regra_w))
				and 	((coalesce(cd_cgc_prestador_regra_w::text, '') = '') or (a.cd_cgc_prestador = cd_cgc_prestador_regra_w))
				and	((coalesce(cd_medico_executor_regra_w::text, '') = '') or (a.cd_medico_executor = cd_medico_executor_regra_w))
				and	((coalesce(cd_tipo_proced_regra_w::text, '') = '') or (b.cd_tipo_procedimento = cd_tipo_proced_regra_w))
				and	a.dt_procedimento		between dt_procedimento_p - QT_MIN_REGRA_PER_w/1440 and
								dt_procedimento_p
				and	not exists (SELECT 1 from conta_paciente x where a.nr_interno_conta = x.nr_interno_conta and (x.ie_cancelamento IS NOT NULL AND x.ie_cancelamento::text <> ''));
			elsif (ie_regra_execucao_w 	= 'Q') then

				select	coalesce(sum(qt_procedimento),0)
				into STRICT	qt_exec_w
				from	estrutura_procedimento_v b,
					procedimento_paciente a
				where	a.cd_procedimento		= b.cd_procedimento
				and	a.ie_origem_proced		= b.ie_origem_proced
				and	((coalesce(cd_area_procedimento_regra_w::text, '') = '') or (b.cd_area_procedimento = cd_area_procedimento_regra_w))
				and	((coalesce(cd_especialidade_regra_w::text, '') = '') or (b.cd_especialidade = cd_especialidade_regra_w))
				and	((coalesce(cd_grupo_proc_regra_w::text, '') = '') or (b.cd_grupo_proc = cd_grupo_proc_regra_w))
				and	((coalesce(cd_procedimento_regra_w::text, '') = '') or (a.cd_procedimento = cd_procedimento_regra_w))
				and	((coalesce(ie_origem_proced_regra_w::text, '') = '') or (a.ie_origem_proced = ie_origem_proced_regra_w))
				and 	((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
				and 	((coalesce(ie_resp_cred_w::text, '') = '') or (coalesce(a.ie_responsavel_credito, ie_resp_cred_w) = ie_resp_cred_w))
				and	coalesce(a.cd_motivo_exc_conta::text, '') = ''
				and	a.nr_sequencia		< nr_sequencia_p
				and	a.nr_atendimento		= nr_atendimento_w
				and	((coalesce(nr_seq_proc_interno_w::text, '') = '') or (a.nr_seq_proc_interno = nr_seq_proc_interno_w))
				and	((coalesce(cd_edicao_amb_filtro_w::text, '') = '') or (coalesce(a.cd_edicao_amb,cd_edicao_amb_w) = cd_edicao_amb_filtro_w))
				and 	((coalesce(ie_tipo_guia_regra_w::text, '') = '') or (a.ie_tipo_guia = ie_tipo_guia_regra_w))
				and 	((coalesce(cd_cgc_prestador_regra_w::text, '') = '') or (a.cd_cgc_prestador = cd_cgc_prestador_regra_w))
				and	((coalesce(cd_medico_executor_regra_w::text, '') = '') or (a.cd_medico_executor = cd_medico_executor_regra_w))
				and	((coalesce(cd_tipo_proced_regra_w::text, '') = '') or (b.cd_tipo_procedimento = cd_tipo_proced_regra_w))
				and	((a.dt_procedimento between dt_procedimento_p - QT_MIN_REGRA_PER_w/1440 and dt_procedimento_p) or (a.dt_procedimento between dt_procedimento_p and dt_procedimento_p + QT_MIN_REGRA_PER_w/1440))
				and	not exists (SELECT 1 from conta_paciente x where a.nr_interno_conta = x.nr_interno_conta and (x.ie_cancelamento IS NOT NULL AND x.ie_cancelamento::text <> ''));
					
			elsif (ie_regra_execucao_w 	= 'M') then
				select	coalesce(sum(qt_procedimento),0)
				into STRICT	qt_exec_w
				from	estrutura_procedimento_v b,
					procedimento_paciente a
				where	a.cd_procedimento		= b.cd_procedimento
				and	a.ie_origem_proced		= b.ie_origem_proced
				and	((coalesce(cd_area_procedimento_regra_w::text, '') = '') or (b.cd_area_procedimento = cd_area_procedimento_regra_w))
				and	((coalesce(cd_especialidade_regra_w::text, '') = '') or (b.cd_especialidade = cd_especialidade_regra_w))
				and	((coalesce(cd_grupo_proc_regra_w::text, '') = '') or (b.cd_grupo_proc = cd_grupo_proc_regra_w))
				and	((coalesce(cd_procedimento_regra_w::text, '') = '') or (a.cd_procedimento = cd_procedimento_regra_w))
				and	((coalesce(ie_origem_proced_regra_w::text, '') = '') or (a.ie_origem_proced = ie_origem_proced_regra_w))
				and 	((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
				and	((coalesce(cd_edicao_amb_filtro_w::text, '') = '') or (coalesce(a.cd_edicao_amb,cd_edicao_amb_w) = cd_edicao_amb_filtro_w))
				and 	((coalesce(ie_resp_cred_w::text, '') = '') or (coalesce(a.ie_responsavel_credito, ie_resp_cred_w) = ie_resp_cred_w))
				and	coalesce(a.cd_motivo_exc_conta::text, '') = ''
				and	a.nr_atendimento		= nr_atendimento_w
				and	a.nr_sequencia			< nr_sequencia_p
				and	((coalesce(nr_seq_proc_interno_w::text, '') = '') or (a.nr_seq_proc_interno = nr_seq_proc_interno_w))
				and 	((coalesce(ie_tipo_guia_regra_w::text, '') = '') or (a.ie_tipo_guia = ie_tipo_guia_regra_w))
				and 	((coalesce(cd_cgc_prestador_regra_w::text, '') = '') or (a.cd_cgc_prestador = cd_cgc_prestador_regra_w))
				and	((coalesce(cd_medico_executor_regra_w::text, '') = '') or (a.cd_medico_executor = cd_medico_executor_regra_w))
				and	((coalesce(cd_tipo_proced_regra_w::text, '') = '') or (b.cd_tipo_procedimento = cd_tipo_proced_regra_w))
				and	a.dt_procedimento		between PKG_DATE_UTILS.start_of(dt_procedimento_p, 'month',0) and
								PKG_DATE_UTILS.end_of(PKG_DATE_UTILS.start_of(dt_procedimento_p, 'month',0), 'MONTH', 0)
				and	not exists (SELECT 1 from conta_paciente x where a.nr_interno_conta = x.nr_interno_conta and (x.ie_cancelamento IS NOT NULL AND x.ie_cancelamento::text <> ''));
			elsif (ie_regra_execucao_w 	= 'C') then
			
				select	coalesce(sum(qt_procedimento),0)
				into STRICT	qt_exec_w
				from	estrutura_procedimento_v b,
					procedimento_paciente a,
					atendimento_paciente c
				where	a.cd_procedimento		= b.cd_procedimento
				and	a.ie_origem_proced		= b.ie_origem_proced
				and	a.nr_atendimento		 = c.nr_atendimento
				and	((coalesce(cd_area_procedimento_regra_w::text, '') = '') or (b.cd_area_procedimento = cd_area_procedimento_regra_w))
				and	((coalesce(cd_especialidade_regra_w::text, '') = '') or (b.cd_especialidade = cd_especialidade_regra_w))
				and	((coalesce(cd_grupo_proc_regra_w::text, '') = '') or (b.cd_grupo_proc = cd_grupo_proc_regra_w))
				and	((coalesce(cd_procedimento_regra_w::text, '') = '') or (a.cd_procedimento = cd_procedimento_regra_w))
				and	((coalesce(ie_origem_proced_regra_w::text, '') = '') or (a.ie_origem_proced = ie_origem_proced_regra_w))
				and 	((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
				and	((coalesce(cd_edicao_amb_filtro_w::text, '') = '') or (coalesce(a.cd_edicao_amb,cd_edicao_amb_w) = cd_edicao_amb_filtro_w))
				and 	((coalesce(ie_resp_cred_w::text, '') = '') or (coalesce(a.ie_responsavel_credito, ie_resp_cred_w) = ie_resp_cred_w))
				and	coalesce(a.cd_motivo_exc_conta::text, '') = ''
				and	c.cd_pessoa_fisica = cd_pessoa_fisica_w
				and	a.nr_sequencia	< nr_sequencia_p
				and	((coalesce(nr_seq_proc_interno_w::text, '') = '') or (a.nr_seq_proc_interno = nr_seq_proc_interno_w))
				and 	((coalesce(ie_tipo_guia_regra_w::text, '') = '') or (a.ie_tipo_guia = ie_tipo_guia_regra_w))
				and 	((coalesce(cd_cgc_prestador_regra_w::text, '') = '') or (a.cd_cgc_prestador = cd_cgc_prestador_regra_w))
				and	((coalesce(cd_medico_executor_regra_w::text, '') = '') or (a.cd_medico_executor = cd_medico_executor_regra_w))
				and	((coalesce(cd_tipo_proced_regra_w::text, '') = '') or (b.cd_tipo_procedimento = cd_tipo_proced_regra_w))
				and	a.dt_procedimento		between PKG_DATE_UTILS.start_of(dt_procedimento_p, 'month',0) and
								PKG_DATE_UTILS.end_of(PKG_DATE_UTILS.start_of(dt_procedimento_p, 'month',0), 'MONTH', 0)
				and	not exists (SELECT 1 from conta_paciente x where a.nr_interno_conta = x.nr_interno_conta and (x.ie_cancelamento IS NOT NULL AND x.ie_cancelamento::text <> ''));
			elsif (ie_regra_execucao_w 	= 'I') then -- Dia (Por paciente)
				select	coalesce(sum(qt_procedimento),0)
				into STRICT	qt_exec_w
				from	estrutura_procedimento_v b,
					procedimento_paciente a,
					atendimento_paciente c
				where	a.cd_procedimento		= b.cd_procedimento
				and	a.ie_origem_proced		= b.ie_origem_proced
				and	a.nr_atendimento		 = c.nr_atendimento
				and	((coalesce(cd_area_procedimento_regra_w::text, '') = '') or (b.cd_area_procedimento = cd_area_procedimento_regra_w))
				and	((coalesce(cd_especialidade_regra_w::text, '') = '') or (b.cd_especialidade = cd_especialidade_regra_w))
				and	((coalesce(cd_grupo_proc_regra_w::text, '') = '') or (b.cd_grupo_proc = cd_grupo_proc_regra_w))
				and	((coalesce(cd_procedimento_regra_w::text, '') = '') or (a.cd_procedimento = cd_procedimento_regra_w))
				and	((coalesce(ie_origem_proced_regra_w::text, '') = '') or (a.ie_origem_proced = ie_origem_proced_regra_w))	
				and 	((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
				and 	((coalesce(ie_resp_cred_w::text, '') = '') or (coalesce(a.ie_responsavel_credito, ie_resp_cred_w) = ie_resp_cred_w))
				and	coalesce(a.cd_motivo_exc_conta::text, '') = ''
				and	c.cd_pessoa_fisica = cd_pessoa_fisica_w
				and	((coalesce(cd_edicao_amb_filtro_w::text, '') = '') or (coalesce(a.cd_edicao_amb,cd_edicao_amb_w) = cd_edicao_amb_filtro_w))
				and	a.nr_sequencia		< nr_sequencia_p	/* Fabricio OS 109214 */
				and	((coalesce(nr_seq_proc_interno_w::text, '') = '') or (a.nr_seq_proc_interno = nr_seq_proc_interno_w))
				and 	((coalesce(ie_tipo_guia_regra_w::text, '') = '') or (a.ie_tipo_guia = ie_tipo_guia_regra_w))
				and 	((coalesce(cd_cgc_prestador_regra_w::text, '') = '') or (a.cd_cgc_prestador = cd_cgc_prestador_regra_w))
				and	((coalesce(cd_medico_executor_regra_w::text, '') = '') or (a.cd_medico_executor = cd_medico_executor_regra_w))
				and	((coalesce(cd_tipo_proced_regra_w::text, '') = '') or (b.cd_tipo_procedimento = cd_tipo_proced_regra_w))
				and	a.dt_procedimento		between PKG_DATE_UTILS.start_of(dt_procedimento_p, 'dd',0) and
								PKG_DATE_UTILS.end_of(dt_procedimento_p, 'DAY',0)
				and	not exists (SELECT 1 from conta_paciente x where a.nr_interno_conta = x.nr_interno_conta and (x.ie_cancelamento IS NOT NULL AND x.ie_cancelamento::text <> ''));
			elsif (ie_regra_execucao_w 	= 'R') then -- Prescricao
				select	coalesce(sum(qt_procedimento),0)
				into STRICT	qt_exec_w
				from	estrutura_procedimento_v b,
					procedimento_paciente a
				where	a.cd_procedimento		= b.cd_procedimento
				and	a.ie_origem_proced		= b.ie_origem_proced
				and	((coalesce(cd_area_procedimento_regra_w::text, '') = '') or (b.cd_area_procedimento = cd_area_procedimento_regra_w))
				and	((coalesce(cd_especialidade_regra_w::text, '') = '') or (b.cd_especialidade = cd_especialidade_regra_w))
				and	((coalesce(cd_grupo_proc_regra_w::text, '') = '') or (b.cd_grupo_proc = cd_grupo_proc_regra_w))
				and	((coalesce(cd_procedimento_regra_w::text, '') = '') or (a.cd_procedimento = cd_procedimento_regra_w))
				and	((coalesce(ie_origem_proced_regra_w::text, '') = '') or (a.ie_origem_proced = ie_origem_proced_regra_w))	
				and 	((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
				and 	((coalesce(ie_resp_cred_w::text, '') = '') or (coalesce(a.ie_responsavel_credito, ie_resp_cred_w) = ie_resp_cred_w))
				and	coalesce(a.cd_motivo_exc_conta::text, '') = ''
				and	((coalesce(cd_edicao_amb_filtro_w::text, '') = '') or (coalesce(a.cd_edicao_amb,cd_edicao_amb_w) = cd_edicao_amb_filtro_w))
				and	a.nr_sequencia		< nr_sequencia_p	/* Fabricio OS 109214 */
				and	a.nr_atendimento		= nr_atendimento_w
				and	((coalesce(nr_seq_proc_interno_w::text, '') = '') or (a.nr_seq_proc_interno = nr_seq_proc_interno_w))				
				and 	((coalesce(ie_tipo_guia_regra_w::text, '') = '') or (a.ie_tipo_guia = ie_tipo_guia_regra_w))
				and 	((coalesce(cd_cgc_prestador_regra_w::text, '') = '') or (a.cd_cgc_prestador = cd_cgc_prestador_regra_w))
				and	((coalesce(cd_medico_executor_regra_w::text, '') = '') or (a.cd_medico_executor = cd_medico_executor_regra_w))
				and	((coalesce(cd_tipo_proced_regra_w::text, '') = '') or (b.cd_tipo_procedimento = cd_tipo_proced_regra_w))
				and 	((coalesce(a.nr_prescricao,0) > 0) and (coalesce(a.nr_prescricao,0) = nr_prescricao_w))
				and	not exists (SELECT 1 from conta_paciente x where a.nr_interno_conta = x.nr_interno_conta and (x.ie_cancelamento IS NOT NULL AND x.ie_cancelamento::text <> ''));

			elsif (ie_regra_execucao_w 	= 'E') then

				select	coalesce(sum(qt_procedimento),0)
				into STRICT	qt_exec_w
				from	estrutura_procedimento_v b,
					procedimento_paciente a
				where	a.cd_procedimento = b.cd_procedimento
				and	a.ie_origem_proced = b.ie_origem_proced
				and	((coalesce(cd_area_procedimento_regra_w::text, '') = '') or (b.cd_area_procedimento = cd_area_procedimento_regra_w))
				and	((coalesce(cd_especialidade_regra_w::text, '') = '') or (b.cd_especialidade = cd_especialidade_regra_w))
				and	((coalesce(cd_grupo_proc_regra_w::text, '') = '') or (b.cd_grupo_proc = cd_grupo_proc_regra_w))
				and	((coalesce(cd_procedimento_regra_w::text, '') = '') or (a.cd_procedimento = cd_procedimento_regra_w))
				and	((coalesce(ie_origem_proced_regra_w::text, '') = '') or (a.ie_origem_proced = ie_origem_proced_regra_w))
				and 	((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
				and 	((coalesce(ie_resp_cred_w::text, '') = '') or (coalesce(a.ie_responsavel_credito, ie_resp_cred_w) = ie_resp_cred_w))
				and	coalesce(a.cd_motivo_exc_conta::text, '') = ''
				and	a.nr_atendimento = nr_atendimento_w
				and	((coalesce(cd_edicao_amb_filtro_w::text, '') = '') or (coalesce(a.cd_edicao_amb,cd_edicao_amb_w) = cd_edicao_amb_filtro_w))
				and	a.nr_sequencia < nr_sequencia_p
				and	((coalesce(nr_seq_proc_interno_w::text, '') = '') or (a.nr_seq_proc_interno = nr_seq_proc_interno_w))
				and 	((coalesce(ie_tipo_guia_regra_w::text, '') = '') or (a.ie_tipo_guia = ie_tipo_guia_regra_w))
				and 	((coalesce(cd_cgc_prestador_regra_w::text, '') = '') or (a.cd_cgc_prestador = cd_cgc_prestador_regra_w))
				and	((coalesce(cd_medico_executor_regra_w::text, '') = '') or (a.cd_medico_executor = cd_medico_executor_regra_w))
				and	a.dt_procedimento between PKG_DATE_UTILS.start_of(dt_procedimento_p, 'dd',0) and PKG_DATE_UTILS.end_of(dt_procedimento_p, 'DAY',0)
				and 	((a.cd_medico_executor IS NOT NULL AND a.cd_medico_executor::text <> '') and (coalesce(a.cd_medico_executor,0) = cd_medico_executor_w))
				and	((coalesce(cd_tipo_proced_regra_w::text, '') = '') or (b.cd_tipo_procedimento = cd_tipo_proced_regra_w))
				and	not exists (SELECT 1 from conta_paciente x where a.nr_interno_conta = x.nr_interno_conta and (x.ie_cancelamento IS NOT NULL AND x.ie_cancelamento::text <> ''));
				
				
			end if;
			qt_exec_ww	:= 0;
			for i in 1..trunc(qt_procedimento_p) loop
				begin
				qt_exec_ww	:= qt_exec_ww+1;
				open	c02;
				loop
				fetch	c02 into
					qt_exec_min_w,
					qt_exec_max_w,
					tx_proc_w,
					tx_custo_oper_w,
					tx_medico_proc_w,
					tx_aux_w,
					tx_anest_w;
				EXIT WHEN NOT FOUND; /* apply on c02 */
					begin

					if	((qt_exec_w+qt_exec_ww)	between qt_exec_min_w and coalesce(qt_exec_max_w, qt_exec_w+qt_exec_ww)) then
						tx_procedimento_w	:= tx_proc_w;
						tx_custo_operacional_w	:= tx_custo_oper_w;
						tx_medico_w		:= tx_medico_proc_w;
						tx_auxiliar_w		:= tx_aux_w;
						tx_anestesista_w	:= tx_anest_w;
						ie_regra_w		:= 'S';

						Vetor_w[i].tx_procedimento	:= tx_proc_w;
						Vetor_w[i].tx_custo_operacional	:= tx_custo_oper_w;
						Vetor_w[i].tx_medico		:= tx_medico_proc_w;
						Vetor_w[i].tx_auxiliar		:= tx_aux_w;
						Vetor_w[i].tx_anestesista	:= tx_anest_w;
					end if;

					end;
				end loop;
				close c02;
				end;
			end loop;

			end;
		end loop;
		close c01;
		end;
	end if;

	if (coalesce(qt_regra_w,0) > 0) then
	
		if (tx_procedimento_w	= 0) then
			tx_procedimento_w	:= 100;
		end if;

		tx_procedimento_w	:= null;
		tx_medico_w		:= null;
		tx_custo_operacional_w	:= null;
		tx_auxiliar_w		:= null;
		tx_anestesista_w	:= null;
		if (Vetor_w.count > 0) then
			
			for k in Vetor_w.first .. Vetor_w.last loop
			if (Vetor_w.exists(k)) then
		
				if (Vetor_w[k](.tx_procedimento IS NOT NULL AND .tx_procedimento::text <> '')) then
					tx_procedimento_w	:= coalesce(tx_procedimento_w,0)	+ Vetor_w[k].tx_procedimento;
				end if;
				if (Vetor_w[k](.tx_medico IS NOT NULL AND .tx_medico::text <> '')) then
					tx_medico_w	:= coalesce(tx_medico_w,0)	+ Vetor_w[k].tx_medico;
				end if;
				if (Vetor_w[k](.tx_custo_operacional IS NOT NULL AND .tx_custo_operacional::text <> '')) then
					tx_custo_operacional_w	:= coalesce(tx_custo_operacional_w,0)	+ Vetor_w[k].tx_custo_operacional;
				end if;
				if (Vetor_w[k](.tx_auxiliar IS NOT NULL AND .tx_auxiliar::text <> '')) then
					tx_auxiliar_w	:= coalesce(tx_auxiliar_w,0)	+ Vetor_w[k].tx_auxiliar;
				end if;
				if (Vetor_w[k](.tx_anestesista IS NOT NULL AND .tx_anestesista::text <> '')) then
					tx_anestesista_w	:= coalesce(tx_anestesista_w,0)	+ Vetor_w[k].tx_anestesista;
				end if;
			end if;
			end loop;
			
		end if;

		if (tx_procedimento_w IS NOT NULL AND tx_procedimento_w::text <> '') then
			tx_procedimento_w	:= dividir(tx_procedimento_w,Vetor_w.Count);
		end if;

		if (tx_medico_w IS NOT NULL AND tx_medico_w::text <> '') then
			tx_medico_w	:= dividir(tx_medico_w,Vetor_w.Count);
		end if;

		if (tx_custo_operacional_w IS NOT NULL AND tx_custo_operacional_w::text <> '') then
			tx_custo_operacional_w	:= dividir(tx_custo_operacional_w,Vetor_w.Count);
		end if;
		if (tx_auxiliar_w IS NOT NULL AND tx_auxiliar_w::text <> '') then
			tx_auxiliar_w	:= dividir(tx_auxiliar_w,Vetor_w.Count);
		end if;
		if (tx_anestesista_w IS NOT NULL AND tx_anestesista_w::text <> '') then
			tx_anestesista_w	:= dividir(tx_anestesista_w,Vetor_w.Count);
		end if;
		if (coalesce(tx_procedimento_w,0)	= 0) then
			tx_procedimento_w	:= 100;
		end if;
	end if;
	
elsif (ie_regra_tx_qtde_exec_w	= 'N')then
	
	if (nr_atendimento_w <> 0) then
		begin

		open	c01;
		loop
		fetch	c01 into
			ie_regra_execucao_w,
			nr_sequencia_w,
			cd_area_procedimento_regra_w,
			cd_especialidade_regra_w,
			cd_grupo_proc_regra_w,
			cd_procedimento_regra_w,
			ie_origem_proced_regra_w,
			QT_MIN_REGRA_PER_w,
			cd_setor_atendimento_w,
			cd_edicao_amb_filtro_w,
			ie_resp_cred_w,
			ie_tipo_guia_regra_w,
			cd_cgc_prestador_regra_w,
			cd_medico_executor_regra_w,
			nr_seq_proc_interno_w,
			cd_tipo_proced_regra_w;
		EXIT WHEN NOT FOUND; /* apply on c01 */
			begin

			ie_regra_w			:= 'N';

			open	c02;
			loop
			fetch	c02 into
				qt_exec_min_w,
				qt_exec_max_w,
				tx_proc_w,
				tx_custo_oper_w,
				tx_medico_proc_w,
				tx_aux_w,
				tx_anest_w;
			EXIT WHEN NOT FOUND; /* apply on c02 */
				begin

				if (ie_regra_w	= 'N') then
					begin

					if (ie_regra_execucao_w 	= 'A') then
						select	coalesce(sum(a.qt_procedimento),0)
						into STRICT	qt_exec_w
						from	estrutura_procedimento_v b,
							procedimento_paciente a
						where	a.cd_procedimento		= b.cd_procedimento
						and	a.ie_origem_proced		= b.ie_origem_proced
						and	((coalesce(cd_area_procedimento_regra_w::text, '') = '') or (b.cd_area_procedimento = cd_area_procedimento_regra_w))
						and	((coalesce(cd_especialidade_regra_w::text, '') = '') or (b.cd_especialidade = cd_especialidade_regra_w))
						and	((coalesce(cd_grupo_proc_regra_w::text, '') = '') or (b.cd_grupo_proc = cd_grupo_proc_regra_w))
						and	((coalesce(cd_procedimento_regra_w::text, '') = '') or (a.cd_procedimento = cd_procedimento_regra_w))
						and	((coalesce(ie_origem_proced_regra_w::text, '') = '') or (a.ie_origem_proced = ie_origem_proced_regra_w))	
						and 	((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
						and	((coalesce(cd_edicao_amb_filtro_w::text, '') = '') or (coalesce(a.cd_edicao_amb,cd_edicao_amb_w) = cd_edicao_amb_filtro_w))
						and 	((coalesce(ie_resp_cred_w::text, '') = '') or (coalesce(a.ie_responsavel_credito, ie_resp_cred_w) = ie_resp_cred_w))
						and	coalesce(a.cd_motivo_exc_conta::text, '') = ''
						and	a.nr_atendimento		= nr_atendimento_w
					/*	and	a.dt_procedimento		<= dt_procedimento_w;       Felipe Martini OS 106413, 107927*/

						and	a.nr_sequencia		<= nr_sequencia_p
						and	((coalesce(nr_seq_proc_interno_w::text, '') = '') or (a.nr_seq_proc_interno = nr_seq_proc_interno_w))
						and 	((coalesce(a.NR_SEQ_REGRA_QTDE_EXEC,0)  = nr_sequencia_w) or (coalesce(a.NR_SEQ_REGRA_QTDE_EXEC,0) = 0))
						and 	((coalesce(ie_tipo_guia_regra_w::text, '') = '') or (a.ie_tipo_guia = ie_tipo_guia_regra_w))
						and 	((coalesce(cd_cgc_prestador_regra_w::text, '') = '') or (a.cd_cgc_prestador = cd_cgc_prestador_regra_w))
						and	((coalesce(cd_medico_executor_regra_w::text, '') = '') or (a.cd_medico_executor = cd_medico_executor_regra_w))
						and	((coalesce(cd_tipo_proced_regra_w::text, '') = '') or (b.cd_tipo_procedimento = cd_tipo_proced_regra_w))
						and	not exists (SELECT 1 from conta_paciente x where a.nr_interno_conta = x.nr_interno_conta and (x.ie_cancelamento IS NOT NULL AND x.ie_cancelamento::text <> ''));
					elsif (ie_regra_execucao_w 	= 'D') then
						select	coalesce(sum(qt_procedimento),0)
						into STRICT	qt_exec_w
						from	estrutura_procedimento_v b,
							procedimento_paciente a
						where	a.cd_procedimento		= b.cd_procedimento
						and	a.ie_origem_proced		= b.ie_origem_proced
						and	((coalesce(cd_area_procedimento_regra_w::text, '') = '') or (b.cd_area_procedimento = cd_area_procedimento_regra_w))
						and	((coalesce(cd_especialidade_regra_w::text, '') = '') or (b.cd_especialidade = cd_especialidade_regra_w))
						and	((coalesce(cd_grupo_proc_regra_w::text, '') = '') or (b.cd_grupo_proc = cd_grupo_proc_regra_w))
						and	((coalesce(cd_procedimento_regra_w::text, '') = '') or (a.cd_procedimento = cd_procedimento_regra_w))
						and	((coalesce(ie_origem_proced_regra_w::text, '') = '') or (a.ie_origem_proced = ie_origem_proced_regra_w))	
						and 	((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
						and 	((coalesce(ie_resp_cred_w::text, '') = '') or (coalesce(a.ie_responsavel_credito, ie_resp_cred_w) = ie_resp_cred_w))
						and	coalesce(a.cd_motivo_exc_conta::text, '') = ''
						and	a.nr_atendimento		= nr_atendimento_w
						and	((coalesce(nr_seq_proc_interno_w::text, '') = '') or (a.nr_seq_proc_interno = nr_seq_proc_interno_w))
						and	((coalesce(cd_edicao_amb_filtro_w::text, '') = '') or (coalesce(a.cd_edicao_amb,cd_edicao_amb_w) = cd_edicao_amb_filtro_w))
						and	a.nr_sequencia		<= nr_sequencia_p	/* Fabricio OS 109214 */
						and 	((coalesce(ie_tipo_guia_regra_w::text, '') = '') or (a.ie_tipo_guia = ie_tipo_guia_regra_w))
						and 	((coalesce(cd_cgc_prestador_regra_w::text, '') = '') or (a.cd_cgc_prestador = cd_cgc_prestador_regra_w))
						and	((coalesce(cd_medico_executor_regra_w::text, '') = '') or (a.cd_medico_executor = cd_medico_executor_regra_w))
						and	((coalesce(cd_tipo_proced_regra_w::text, '') = '') or (b.cd_tipo_procedimento = cd_tipo_proced_regra_w))
						and	a.dt_procedimento		between PKG_DATE_UTILS.start_of(dt_procedimento_p, 'dd',0) and
										PKG_DATE_UTILS.end_of(dt_procedimento_p, 'DAY',0)
						and	not exists (SELECT 1 from conta_paciente x where a.nr_interno_conta = x.nr_interno_conta and (x.ie_cancelamento IS NOT NULL AND x.ie_cancelamento::text <> ''));
					elsif (ie_regra_execucao_w 	= 'P') then
						
						select	coalesce(sum(qt_procedimento),0)
						into STRICT	qt_exec_w
						from	estrutura_procedimento_v b,
							procedimento_paciente a
						where	a.cd_procedimento		= b.cd_procedimento
						and	a.ie_origem_proced		= b.ie_origem_proced
						and	((coalesce(cd_area_procedimento_regra_w::text, '') = '') or (b.cd_area_procedimento = cd_area_procedimento_regra_w))
						and	((coalesce(cd_especialidade_regra_w::text, '') = '') or (b.cd_especialidade = cd_especialidade_regra_w))
						and	((coalesce(cd_grupo_proc_regra_w::text, '') = '') or (b.cd_grupo_proc = cd_grupo_proc_regra_w))
						and	((coalesce(cd_procedimento_regra_w::text, '') = '') or (a.cd_procedimento = cd_procedimento_regra_w))
						and	((coalesce(ie_origem_proced_regra_w::text, '') = '') or (a.ie_origem_proced = ie_origem_proced_regra_w))	
						and 	((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
						and 	((coalesce(ie_resp_cred_w::text, '') = '') or (coalesce(a.ie_responsavel_credito, ie_resp_cred_w) = ie_resp_cred_w))
						and	coalesce(a.cd_motivo_exc_conta::text, '') = ''
						and	a.nr_sequencia		<= nr_sequencia_p
						and	a.nr_atendimento		= nr_atendimento_w
						and	((coalesce(nr_seq_proc_interno_w::text, '') = '') or (a.nr_seq_proc_interno = nr_seq_proc_interno_w))
						and 	((coalesce(ie_tipo_guia_regra_w::text, '') = '') or (a.ie_tipo_guia = ie_tipo_guia_regra_w))
						and 	((coalesce(cd_cgc_prestador_regra_w::text, '') = '') or (a.cd_cgc_prestador = cd_cgc_prestador_regra_w))
						and	((coalesce(cd_edicao_amb_filtro_w::text, '') = '') or (coalesce(a.cd_edicao_amb,cd_edicao_amb_w) = cd_edicao_amb_filtro_w))
						and	((coalesce(cd_medico_executor_regra_w::text, '') = '') or (a.cd_medico_executor = cd_medico_executor_regra_w))
						and	((coalesce(cd_tipo_proced_regra_w::text, '') = '') or (b.cd_tipo_procedimento = cd_tipo_proced_regra_w))
						and	a.dt_procedimento		between dt_procedimento_p - QT_MIN_REGRA_PER_w/1440 and
										dt_procedimento_p
						and	not exists (SELECT 1 from conta_paciente x where a.nr_interno_conta = x.nr_interno_conta and (x.ie_cancelamento IS NOT NULL AND x.ie_cancelamento::text <> ''));
					elsif (ie_regra_execucao_w 	= 'Q') then
						
						select	coalesce(sum(qt_procedimento),0)
						into STRICT	qt_exec_w
						from	estrutura_procedimento_v b,
							procedimento_paciente a
						where	a.cd_procedimento		= b.cd_procedimento
						and	a.ie_origem_proced		= b.ie_origem_proced
						and	((coalesce(cd_area_procedimento_regra_w::text, '') = '') or (b.cd_area_procedimento = cd_area_procedimento_regra_w))
						and	((coalesce(cd_especialidade_regra_w::text, '') = '') or (b.cd_especialidade = cd_especialidade_regra_w))
						and	((coalesce(cd_grupo_proc_regra_w::text, '') = '') or (b.cd_grupo_proc = cd_grupo_proc_regra_w))
						and	((coalesce(cd_procedimento_regra_w::text, '') = '') or (a.cd_procedimento = cd_procedimento_regra_w))
						and	((coalesce(ie_origem_proced_regra_w::text, '') = '') or (a.ie_origem_proced = ie_origem_proced_regra_w))	
						and 	((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
						and 	((coalesce(ie_resp_cred_w::text, '') = '') or (coalesce(a.ie_responsavel_credito, ie_resp_cred_w) = ie_resp_cred_w))
						and	coalesce(a.cd_motivo_exc_conta::text, '') = ''
						and	a.nr_sequencia		<= nr_sequencia_p
						and	a.nr_atendimento		= nr_atendimento_w
						and	((coalesce(nr_seq_proc_interno_w::text, '') = '') or (a.nr_seq_proc_interno = nr_seq_proc_interno_w))
						and 	((coalesce(ie_tipo_guia_regra_w::text, '') = '') or (a.ie_tipo_guia = ie_tipo_guia_regra_w))
						and 	((coalesce(cd_cgc_prestador_regra_w::text, '') = '') or (a.cd_cgc_prestador = cd_cgc_prestador_regra_w))
						and	((coalesce(cd_edicao_amb_filtro_w::text, '') = '') or (coalesce(a.cd_edicao_amb,cd_edicao_amb_w) = cd_edicao_amb_filtro_w))
						and	((coalesce(cd_medico_executor_regra_w::text, '') = '') or (a.cd_medico_executor = cd_medico_executor_regra_w))
						and	((coalesce(cd_tipo_proced_regra_w::text, '') = '') or (b.cd_tipo_procedimento = cd_tipo_proced_regra_w))
						and	((a.dt_procedimento between dt_procedimento_p - QT_MIN_REGRA_PER_w/1440 and dt_procedimento_p) or (a.dt_procedimento between dt_procedimento_p and dt_procedimento_p + QT_MIN_REGRA_PER_w/1440))
						and	not exists (SELECT 1 from conta_paciente x where a.nr_interno_conta = x.nr_interno_conta and (x.ie_cancelamento IS NOT NULL AND x.ie_cancelamento::text <> ''));
					elsif (ie_regra_execucao_w 	= 'M') then
						select	coalesce(sum(qt_procedimento),0)
						into STRICT	qt_exec_w
						from	estrutura_procedimento_v b,
							procedimento_paciente a
						where	a.cd_procedimento		= b.cd_procedimento
						and	a.ie_origem_proced		= b.ie_origem_proced
						and	((coalesce(cd_area_procedimento_regra_w::text, '') = '') or (b.cd_area_procedimento = cd_area_procedimento_regra_w))
						and	((coalesce(cd_especialidade_regra_w::text, '') = '') or (b.cd_especialidade = cd_especialidade_regra_w))
						and	((coalesce(cd_grupo_proc_regra_w::text, '') = '') or (b.cd_grupo_proc = cd_grupo_proc_regra_w))
						and	((coalesce(cd_procedimento_regra_w::text, '') = '') or (a.cd_procedimento = cd_procedimento_regra_w))
						and	((coalesce(ie_origem_proced_regra_w::text, '') = '') or (a.ie_origem_proced = ie_origem_proced_regra_w))	
						and 	((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
						and	((coalesce(cd_edicao_amb_filtro_w::text, '') = '') or (coalesce(a.cd_edicao_amb,cd_edicao_amb_w) = cd_edicao_amb_filtro_w))
						and 	((coalesce(ie_resp_cred_w::text, '') = '') or (coalesce(a.ie_responsavel_credito, ie_resp_cred_w) = ie_resp_cred_w))
						and	coalesce(a.cd_motivo_exc_conta::text, '') = ''
						and	a.nr_atendimento		= nr_atendimento_w
						and	a.nr_sequencia			<= nr_sequencia_p
						and	((coalesce(nr_seq_proc_interno_w::text, '') = '') or (a.nr_seq_proc_interno = nr_seq_proc_interno_w))
						and 	((coalesce(ie_tipo_guia_regra_w::text, '') = '') or (a.ie_tipo_guia = ie_tipo_guia_regra_w))
						and 	((coalesce(cd_cgc_prestador_regra_w::text, '') = '') or (a.cd_cgc_prestador = cd_cgc_prestador_regra_w))
						and	((coalesce(cd_medico_executor_regra_w::text, '') = '') or (a.cd_medico_executor = cd_medico_executor_regra_w))
						and	((coalesce(cd_tipo_proced_regra_w::text, '') = '') or (b.cd_tipo_procedimento = cd_tipo_proced_regra_w))
						and	a.dt_procedimento		between PKG_DATE_UTILS.start_of(dt_procedimento_p, 'month',0) and
										PKG_DATE_UTILS.end_of(PKG_DATE_UTILS.start_of(dt_procedimento_p, 'month',0), 'MONTH', 0)
						and	not exists (SELECT 1 from conta_paciente x where a.nr_interno_conta = x.nr_interno_conta and (x.ie_cancelamento IS NOT NULL AND x.ie_cancelamento::text <> ''));
					elsif (ie_regra_execucao_w 	= 'C') then
						select	coalesce(sum(qt_procedimento),0)
						into STRICT	qt_exec_w
						from	estrutura_procedimento_v b,
							procedimento_paciente a,
							atendimento_paciente c
						where	a.cd_procedimento		= b.cd_procedimento
						and	a.ie_origem_proced		= b.ie_origem_proced
						and	a.nr_atendimento		= c.nr_atendimento
						and	((coalesce(cd_area_procedimento_regra_w::text, '') = '') or (b.cd_area_procedimento = cd_area_procedimento_regra_w))
						and	((coalesce(cd_especialidade_regra_w::text, '') = '') or (b.cd_especialidade = cd_especialidade_regra_w))
						and	((coalesce(cd_grupo_proc_regra_w::text, '') = '') or (b.cd_grupo_proc = cd_grupo_proc_regra_w))
						and	((coalesce(cd_procedimento_regra_w::text, '') = '') or (a.cd_procedimento = cd_procedimento_regra_w))
						and	((coalesce(ie_origem_proced_regra_w::text, '') = '') or (a.ie_origem_proced = ie_origem_proced_regra_w))	
						and 	((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
						and	((coalesce(cd_edicao_amb_filtro_w::text, '') = '') or (coalesce(a.cd_edicao_amb,cd_edicao_amb_w) = cd_edicao_amb_filtro_w))
						and 	((coalesce(ie_resp_cred_w::text, '') = '') or (coalesce(a.ie_responsavel_credito, ie_resp_cred_w) = ie_resp_cred_w))
						and	coalesce(a.cd_motivo_exc_conta::text, '') = ''
						and 	c.cd_pessoa_fisica = cd_pessoa_fisica_w
						and	a.nr_sequencia <= nr_sequencia_p
						and	((coalesce(nr_seq_proc_interno_w::text, '') = '') or (a.nr_seq_proc_interno = nr_seq_proc_interno_w))
						and 	((coalesce(ie_tipo_guia_regra_w::text, '') = '') or (a.ie_tipo_guia = ie_tipo_guia_regra_w))
						and 	((coalesce(cd_cgc_prestador_regra_w::text, '') = '') or (a.cd_cgc_prestador = cd_cgc_prestador_regra_w))
						and	((coalesce(cd_medico_executor_regra_w::text, '') = '') or (a.cd_medico_executor = cd_medico_executor_regra_w))
						and	((coalesce(cd_tipo_proced_regra_w::text, '') = '') or (b.cd_tipo_procedimento = cd_tipo_proced_regra_w))
						and	a.dt_procedimento		between PKG_DATE_UTILS.start_of(dt_procedimento_p, 'month',0) and
										PKG_DATE_UTILS.end_of(PKG_DATE_UTILS.start_of(dt_procedimento_p, 'month',0), 'MONTH', 0)
						and	not exists (SELECT 1 from conta_paciente x where a.nr_interno_conta = x.nr_interno_conta and (x.ie_cancelamento IS NOT NULL AND x.ie_cancelamento::text <> ''));
					elsif (ie_regra_execucao_w 	= 'I') then -- Dia (Por paciente)
						select	coalesce(sum(qt_procedimento),0)
						into STRICT	qt_exec_w
						from	estrutura_procedimento_v b,
							procedimento_paciente a,
							atendimento_paciente c
						where	a.cd_procedimento		= b.cd_procedimento
						and	a.ie_origem_proced		= b.ie_origem_proced
						and	a.nr_atendimento		= c.nr_atendimento
						and	((coalesce(cd_area_procedimento_regra_w::text, '') = '') or (b.cd_area_procedimento = cd_area_procedimento_regra_w))
						and	((coalesce(cd_especialidade_regra_w::text, '') = '') or (b.cd_especialidade = cd_especialidade_regra_w))
						and	((coalesce(cd_grupo_proc_regra_w::text, '') = '') or (b.cd_grupo_proc = cd_grupo_proc_regra_w))
						and	((coalesce(cd_procedimento_regra_w::text, '') = '') or (a.cd_procedimento = cd_procedimento_regra_w))
						and	((coalesce(ie_origem_proced_regra_w::text, '') = '') or (a.ie_origem_proced = ie_origem_proced_regra_w))	
						and 	((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
						and 	((coalesce(ie_resp_cred_w::text, '') = '') or (coalesce(a.ie_responsavel_credito, ie_resp_cred_w) = ie_resp_cred_w))
						and	coalesce(a.cd_motivo_exc_conta::text, '') = ''
						and 	c.cd_pessoa_fisica = cd_pessoa_fisica_w
						and	((coalesce(cd_edicao_amb_filtro_w::text, '') = '') or (coalesce(a.cd_edicao_amb,cd_edicao_amb_w) = cd_edicao_amb_filtro_w))
						and	a.nr_sequencia		<= nr_sequencia_p	/* Fabricio OS 109214 */
						and	((coalesce(nr_seq_proc_interno_w::text, '') = '') or (a.nr_seq_proc_interno = nr_seq_proc_interno_w))
						and 	((coalesce(ie_tipo_guia_regra_w::text, '') = '') or (a.ie_tipo_guia = ie_tipo_guia_regra_w))
						and 	((coalesce(cd_cgc_prestador_regra_w::text, '') = '') or (a.cd_cgc_prestador = cd_cgc_prestador_regra_w))
						and	((coalesce(cd_medico_executor_regra_w::text, '') = '') or (a.cd_medico_executor = cd_medico_executor_regra_w))
						and	((coalesce(cd_tipo_proced_regra_w::text, '') = '') or (b.cd_tipo_procedimento = cd_tipo_proced_regra_w))
						and	a.dt_procedimento		between PKG_DATE_UTILS.start_of(dt_procedimento_p, 'dd',0) and
										PKG_DATE_UTILS.end_of(dt_procedimento_p, 'DAY',0)
						and	not exists (SELECT 1 from conta_paciente x where a.nr_interno_conta = x.nr_interno_conta and (x.ie_cancelamento IS NOT NULL AND x.ie_cancelamento::text <> ''));
					elsif (ie_regra_execucao_w 	= 'R') then -- Prescricao
						select	coalesce(sum(qt_procedimento),0)
						into STRICT	qt_exec_w
						from	estrutura_procedimento_v b,
							procedimento_paciente a
						where	a.cd_procedimento		= b.cd_procedimento
						and	a.ie_origem_proced		= b.ie_origem_proced
						and	((coalesce(cd_area_procedimento_regra_w::text, '') = '') or (b.cd_area_procedimento = cd_area_procedimento_regra_w))
						and	((coalesce(cd_especialidade_regra_w::text, '') = '') or (b.cd_especialidade = cd_especialidade_regra_w))
						and	((coalesce(cd_grupo_proc_regra_w::text, '') = '') or (b.cd_grupo_proc = cd_grupo_proc_regra_w))
						and	((coalesce(cd_procedimento_regra_w::text, '') = '') or (a.cd_procedimento = cd_procedimento_regra_w))
						and	((coalesce(ie_origem_proced_regra_w::text, '') = '') or (a.ie_origem_proced = ie_origem_proced_regra_w))	
						and 	((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
						and 	((coalesce(ie_resp_cred_w::text, '') = '') or (coalesce(a.ie_responsavel_credito, ie_resp_cred_w) = ie_resp_cred_w))
						and	coalesce(a.cd_motivo_exc_conta::text, '') = ''
						and	((coalesce(cd_edicao_amb_filtro_w::text, '') = '') or (coalesce(a.cd_edicao_amb,cd_edicao_amb_w) = cd_edicao_amb_filtro_w))
						and	a.nr_sequencia		<= nr_sequencia_p	/* Fabricio OS 109214 */
						and	((coalesce(nr_seq_proc_interno_w::text, '') = '') or (a.nr_seq_proc_interno = nr_seq_proc_interno_w))
						and 	((coalesce(ie_tipo_guia_regra_w::text, '') = '') or (a.ie_tipo_guia = ie_tipo_guia_regra_w))
						and 	((coalesce(cd_cgc_prestador_regra_w::text, '') = '') or (a.cd_cgc_prestador = cd_cgc_prestador_regra_w))
						and	((coalesce(cd_medico_executor_regra_w::text, '') = '') or (a.cd_medico_executor = cd_medico_executor_regra_w))
						and	((coalesce(cd_tipo_proced_regra_w::text, '') = '') or (b.cd_tipo_procedimento = cd_tipo_proced_regra_w))
						and	a.nr_atendimento		= nr_atendimento_w						
						and 	((coalesce(a.nr_prescricao,0) > 0) and (coalesce(a.nr_prescricao,0) = nr_prescricao_w))
						and	not exists (SELECT 1 from conta_paciente x where a.nr_interno_conta = x.nr_interno_conta and (x.ie_cancelamento IS NOT NULL AND x.ie_cancelamento::text <> ''));
					
					elsif (ie_regra_execucao_w = 'E') then
					
						select	coalesce(sum(qt_procedimento),0)
						into STRICT	qt_exec_w
						from	estrutura_procedimento_v b,
							procedimento_paciente a
						where	a.cd_procedimento = b.cd_procedimento
						and	a.ie_origem_proced = b.ie_origem_proced
						and	((coalesce(cd_area_procedimento_regra_w::text, '') = '') or (b.cd_area_procedimento = cd_area_procedimento_regra_w))
						and	((coalesce(cd_especialidade_regra_w::text, '') = '') or (b.cd_especialidade = cd_especialidade_regra_w))
						and	((coalesce(cd_grupo_proc_regra_w::text, '') = '') or (b.cd_grupo_proc = cd_grupo_proc_regra_w))
						and	((coalesce(cd_procedimento_regra_w::text, '') = '') or (a.cd_procedimento = cd_procedimento_regra_w))
						and	((coalesce(ie_origem_proced_regra_w::text, '') = '') or (a.ie_origem_proced = ie_origem_proced_regra_w))	
						and 	((coalesce(cd_setor_atendimento_w::text, '') = '') or (a.cd_setor_atendimento = cd_setor_atendimento_w))
						and 	((coalesce(ie_resp_cred_w::text, '') = '') or (coalesce(a.ie_responsavel_credito, ie_resp_cred_w) = ie_resp_cred_w))
						and	coalesce(a.cd_motivo_exc_conta::text, '') = ''
						and	a.nr_atendimento = nr_atendimento_w
						and	((coalesce(cd_edicao_amb_filtro_w::text, '') = '') or (coalesce(a.cd_edicao_amb,cd_edicao_amb_w) = cd_edicao_amb_filtro_w))
						and	a.nr_sequencia	<= nr_sequencia_p
						and	((coalesce(nr_seq_proc_interno_w::text, '') = '') or (a.nr_seq_proc_interno = nr_seq_proc_interno_w))
						and 	((coalesce(ie_tipo_guia_regra_w::text, '') = '') or (a.ie_tipo_guia = ie_tipo_guia_regra_w))
						and 	((coalesce(cd_cgc_prestador_regra_w::text, '') = '') or (a.cd_cgc_prestador = cd_cgc_prestador_regra_w))
						and	((coalesce(cd_medico_executor_regra_w::text, '') = '') or (a.cd_medico_executor = cd_medico_executor_regra_w))
						and	a.dt_procedimento between PKG_DATE_UTILS.start_of(dt_procedimento_p, 'dd',0) and PKG_DATE_UTILS.end_of(dt_procedimento_p, 'DAY',0)
						and	(a.cd_medico_executor IS NOT NULL AND a.cd_medico_executor::text <> '' AND a.cd_medico_executor = cd_medico_executor_w)
						and	((coalesce(cd_tipo_proced_regra_w::text, '') = '') or (b.cd_tipo_procedimento = cd_tipo_proced_regra_w))
						and	not exists (SELECT 1 from conta_paciente x where a.nr_interno_conta = x.nr_interno_conta and (x.ie_cancelamento IS NOT NULL AND x.ie_cancelamento::text <> ''));
						
						
					end if;					
							
					if (qt_exec_w	between qt_exec_min_w and coalesce(qt_exec_max_w, qt_exec_w)) then
						tx_procedimento_w	:= tx_proc_w;
						tx_custo_operacional_w	:= tx_custo_oper_w;
						tx_medico_w		:= tx_medico_proc_w;
						tx_auxiliar_w		:= tx_aux_w;
						tx_anestesista_w	:= tx_anest_w;
						ie_regra_w		:= 'S';
						
						update	procedimento_paciente
						set	NR_SEQ_REGRA_QTDE_EXEC = nr_sequencia_w
						where 	nr_sequencia = nr_sequencia_p;
						
					end if;
			
					end;
					end if;
				end;
			end loop;
			close c02;
			end;
		end loop;
		close c01;
		end;
		
		-- Retirado o update daqui OS 285726

		/*update	procedimento_paciente
		set	NR_SEQ_REGRA_QTDE_EXEC = nr_sequencia_w
		where 	nr_sequencia = nr_sequencia_p;*/
		
	end if;

end if;

tx_procedimento_p	:= tx_procedimento_w;
tx_custo_operacional_p	:= tx_custo_operacional_w;
tx_medico_p		:= tx_medico_w;
tx_auxiliar_p		:= tx_auxiliar_w;
tx_anestesista_p	:= tx_anestesista_w;
--if (nvl(wheb_usuario_pck.get_ie_commit, 'S') = 'S') then commit; end if; Bruna, 24/01/07, OS49043
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_taxa_qtde_exec (cd_estabelecimento_p bigint, nr_sequencia_p bigint, cd_convenio_p bigint, cd_categoria_p text, dt_procedimento_p timestamp, cd_procedimento_p bigint, ie_origem_proced_p bigint, nr_seq_proc_interno_p bigint, qt_procedimento_p bigint, ie_lado_p text, ie_responsavel_credito_p text, cd_edicao_amb_p bigint, tx_procedimento_p INOUT bigint, tx_custo_operacional_p INOUT bigint, tx_medico_p INOUT bigint, tx_auxiliar_p INOUT bigint, tx_anestesista_p INOUT bigint) FROM PUBLIC;

