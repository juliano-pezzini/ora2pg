-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE grg_baixa_titulo_receber ( cd_estabelecimento_p bigint, cd_tipo_recebimento_p bigint, nr_titulo_p bigint, nr_seq_trans_financ_p bigint, dt_recebimento_p timestamp, nm_usuario_p text, vl_glosa_p bigint, vl_rec_maior_p bigint, vl_perdas_p bigint, vl_recurso_p bigint, vl_recebido_p bigint, nr_seq_mot_glosa_p bigint) AS $body$
DECLARE


cd_moeda_padrao_w		integer	:= 0;
nr_seq_baixa_w			integer	:= 0;
nr_seq_conta_banco_w		bigint;
vl_juros_w			double precision	:= 0;
vl_desconto_w			double precision	:= 0;
vl_multa_w			double precision	:= 0;
cd_centro_custo_desc_w		bigint;
nr_seq_motivo_desc_w		bigint;
vl_rec_maior_w			double precision	:= 0;
vl_perdas_w			double precision	:= 0;
nr_seq_solic_desc_w		bigint 	:= null;
ds_observacao_bordero_w		varchar(80);
vl_nota_credito_w		double precision;
nr_seq_regra_w			bigint;
ie_acao_baixa_w			varchar(5);
vl_saldo_titulo_w		double precision;
vl_recurso_w			double precision	:= 0;
vl_recebido_w			double precision	:= 0;


BEGIN

begin
select	cd_moeda_padrao
into STRICT	cd_moeda_padrao_w
from	parametro_contas_receber
where	cd_estabelecimento	= cd_estabelecimento_p;
exception
when 	no_data_found then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(238485);
end;

select	coalesce(max(nr_sequencia),0) + 1
into STRICT	nr_seq_baixa_w
from	titulo_receber_liq
where	nr_titulo	= nr_titulo_p;

vl_rec_maior_w	:= coalesce(vl_rec_maior_p, 0);
vl_perdas_w	:= coalesce(vl_perdas_p, 0);
vl_recurso_w	:= coalesce(vl_recurso_p, 0);
vl_recebido_w	:= coalesce(vl_recebido_p, 0);

insert into titulo_receber_liq(nr_titulo,
	nr_sequencia,
	dt_recebimento,
	vl_recebido,
	vl_descontos,
	vl_juros,
	vl_multa,
	vl_rec_maior,
	cd_moeda,
	dt_atualizacao,
	nm_usuario,
	cd_tipo_recebimento,
	ie_acao,
	cd_serie_nf_devol,
	nr_nota_fiscal_devol,
	cd_banco,
	cd_agencia_bancaria,
	nr_documento,
	nr_lote_banco,
	cd_cgc_emp_cred,
	nr_cartao_cred,
	nr_adiantamento,
	nr_lote_contabil,
	nr_seq_trans_fin,
	vl_glosa,
	ie_lib_caixa,
	nr_bordero,
	nr_seq_conta_banco,
	cd_centro_custo_desc,
	nr_seq_motivo_desc,
	vl_perdas,
	ds_observacao,
	vl_nota_credito,
	nr_lote_contab_antecip,
	nr_lote_contab_pro_rata,
	vl_recurso,
	nr_seq_mot_glosa)
values (nr_titulo_p,
	nr_seq_baixa_w,
	coalesce(dt_recebimento_p, trunc(clock_timestamp(),'dd')),
	vl_recebido_w,
	vl_desconto_w,
	vl_juros_w,
	vl_multa_w,
	vl_rec_maior_w,
	cd_moeda_padrao_w,
	clock_timestamp(),
	nm_usuario_p,
	cd_tipo_recebimento_p,
	'I',
	null,
	null,
	null,
	null,
	null,
	null,
	null,
	null,
	null,
	0,
	nr_seq_trans_financ_p,
	coalesce(vl_glosa_p,0),
	'S',
	null,
	null,
	cd_centro_custo_desc_w,
	nr_seq_motivo_desc_w,
	vl_perdas_w,
	ds_observacao_bordero_w,
	vl_nota_credito_w,
	0,
	0,
	vl_recurso_w,
	nr_seq_mot_glosa_p);

CALL gerar_titulo_rec_liq_cc(cd_estabelecimento_p,
		null,
		nm_usuario_p,
		nr_titulo_p,
		nr_seq_baixa_w);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE grg_baixa_titulo_receber ( cd_estabelecimento_p bigint, cd_tipo_recebimento_p bigint, nr_titulo_p bigint, nr_seq_trans_financ_p bigint, dt_recebimento_p timestamp, nm_usuario_p text, vl_glosa_p bigint, vl_rec_maior_p bigint, vl_perdas_p bigint, vl_recurso_p bigint, vl_recebido_p bigint, nr_seq_mot_glosa_p bigint) FROM PUBLIC;

