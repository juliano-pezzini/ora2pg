-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE man_gerar_posicao_os ( dt_inicio_p timestamp, dt_final_p timestamp, nr_seq_grupo_des_p bigint, nr_seq_grupo_sup_p bigint, nm_usuario_exec_p text, nr_seq_localizacao_p bigint, ie_classificacao_p text, ie_pendencia_p bigint, ie_apresentacao_p bigint, nm_usuario_p text, nr_seq_grupo_trab_p bigint, ie_prioridade_p text, ds_filtro_p text, ie_suporte_p text, nr_seq_gerencia_p bigint default 0, ie_grupo_sup_inf_p text default 'N', ie_grupo_des_inf_p text default 'N') AS $body$
DECLARE


dt_inicio_w	timestamp;
dt_final_w	timestamp;
dt_referencia_w	timestamp;


BEGIN
delete
from	w_man_posicao_os
where	nm_usuario		= nm_usuario_p;

dt_inicio_w			:= PKG_DATE_UTILS.start_of(dt_inicio_p,'dd',0);
dt_final_w			:= PKG_DATE_UTILS.END_OF(dt_final_p, 'DAY', 0);

if (ie_apresentacao_p <> 4) or (PKG_DATE_UTILS.start_of(dt_inicio_w,'month',0) = PKG_DATE_UTILS.start_of(dt_final_w,'month',0)) then
	Man_Gerar_Pos_OS_mes(dt_inicio_w,
				dt_final_w,
				nr_seq_grupo_des_p,
				nr_seq_grupo_sup_p,
				nm_usuario_exec_p,
				nr_seq_localizacao_p,
				ie_classificacao_p,
				ie_pendencia_p,
				nm_usuario_p,
				nr_seq_grupo_trab_p,
				ie_prioridade_p,
				ds_filtro_p,
				ie_suporte_p,
				nr_seq_gerencia_p,
				ie_grupo_sup_inf_p,
				ie_grupo_des_inf_p);
else
	dt_referencia_w	:= PKG_DATE_UTILS.start_of(dt_inicio_w,'month',0);
	while(dt_referencia_w < PKG_DATE_UTILS.start_of(dt_final_w,'month',0)) loop
		dt_referencia_w	:= PKG_DATE_UTILS.ADD_MONTH(dt_referencia_w,1,0);
		Man_Gerar_Pos_OS_mes(
				dt_referencia_w,
				PKG_DATE_UTILS.END_OF(dt_referencia_w, 'MONTH', 0),
				nr_seq_grupo_des_p,
				nr_seq_grupo_sup_p,
				nm_usuario_exec_p,
				nr_seq_localizacao_p,
				ie_classificacao_p,
				ie_pendencia_p,
				nm_usuario_p,
				nr_seq_grupo_trab_p,
				ie_prioridade_p,
				ds_filtro_p,
				ie_suporte_p,
				nr_seq_gerencia_p,
				ie_grupo_sup_inf_p,
				ie_grupo_des_inf_p);
	end loop;

end if;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE man_gerar_posicao_os ( dt_inicio_p timestamp, dt_final_p timestamp, nr_seq_grupo_des_p bigint, nr_seq_grupo_sup_p bigint, nm_usuario_exec_p text, nr_seq_localizacao_p bigint, ie_classificacao_p text, ie_pendencia_p bigint, ie_apresentacao_p bigint, nm_usuario_p text, nr_seq_grupo_trab_p bigint, ie_prioridade_p text, ds_filtro_p text, ie_suporte_p text, nr_seq_gerencia_p bigint default 0, ie_grupo_sup_inf_p text default 'N', ie_grupo_des_inf_p text default 'N') FROM PUBLIC;

