-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE update_evolucao_soap (cd_evolucao_p bigint, nr_sequencia_p bigint, nm_tabela_p text) AS $body$
DECLARE

ie_compl_data_exists  varchar(1) := 'N';

BEGIN
    if (upper(nm_tabela_p) = 'GESTAO_VAGA') then
        update gestao_vaga
        set cd_evolucao = cd_evolucao_p
        where nr_sequencia = nr_sequencia_p;
	elsif (upper(nm_tabela_p) = 'TRIAGEM_PRONTO_ATEND') then
        update TRIAGEM_PRONTO_ATEND
        set cd_evolucao = cd_evolucao_p
        where nr_sequencia = nr_sequencia_p;
	elsif (upper(nm_tabela_p) = 'ATEND_PREVISAO_ALTA') then
        update ATEND_PREVISAO_ALTA
        set cd_evolucao = cd_evolucao_p
        where nr_sequencia = nr_sequencia_p;
	elsif (upper(nm_tabela_p) = 'NURSING_CARE_ENCOUNTER') then
        update NURSING_CARE_ENCOUNTER
        set cd_evolucao = cd_evolucao_p
        where nr_sequencia = nr_sequencia_p;
	elsif (upper(nm_tabela_p) = 'AGENDA_CONSULTA') then
        select CASE WHEN count(1)=0 THEN 'N'  ELSE 'S' END
        into STRICT ie_compl_data_exists
        from agenda_consulta_adic
        where nr_seq_agenda = nr_sequencia_p;
        if (ie_compl_data_exists = 'N') then
            insert into agenda_consulta_adic(nr_seq_agenda,
                                              nm_usuario,
                                              dt_atualizacao,
                                              cd_evolucao)
                                      values (nr_sequencia_p,
                                              wheb_usuario_pck.get_nm_usuario,
                                              clock_timestamp(),
                                              cd_evolucao_p);
        else
            update agenda_consulta_adic
            set cd_evolucao = cd_evolucao_p  
            where nr_seq_agenda = nr_sequencia_p;
        end if;
    elsif (upper(nm_tabela_p) = 'AGENDA_PACIENTE') then
        select CASE WHEN count(1)=0 THEN 'N'  ELSE 'S' END
        into STRICT ie_compl_data_exists 
        from AGENDA_PACIENTE_INF_ADIC 
        where nr_seq_agenda = nr_sequencia_p;
        if (ie_compl_data_exists = 'N') then
		
			
            insert into AGENDA_PACIENTE_INF_ADIC(nr_sequencia,
			                           nr_seq_agenda,
                                                  nm_usuario,
                                                  dt_atualizacao,
                                                  DT_ATUALIZACAO_NREC,
                                                  nm_usuario_nrec,
                                                  cd_evolucao)
                                          values (nextval('agenda_paciente_inf_adic_seq'),
						   nr_sequencia_p,
                                                  wheb_usuario_pck.get_nm_usuario,
                                                  clock_timestamp(),
                                                  clock_timestamp(),
                                                  wheb_usuario_pck.get_nm_usuario,
                                                  cd_evolucao_p);
        else
            update AGENDA_PACIENTE_INF_ADIC
            set cd_evolucao = cd_evolucao_p  
            where nr_seq_agenda = nr_sequencia_p;
        end if;
    end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE update_evolucao_soap (cd_evolucao_p bigint, nr_sequencia_p bigint, nm_tabela_p text) FROM PUBLIC;

