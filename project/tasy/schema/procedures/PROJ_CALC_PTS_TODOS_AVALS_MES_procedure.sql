-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE proj_calc_pts_todos_avals_mes ( nr_seq_modelo_p bigint, dt_mes_p timestamp, nm_usuario_p text ) AS $body$
DECLARE


dt_mes_w			timestamp := trunc(dt_mes_p, 'dd');

c_avaliacoes_mes CURSOR FOR
SELECT	nr_sequencia
from	proj_consultor_aval
where	nr_seq_modelo = nr_seq_modelo_p
and	trunc(dt_avaliacao, 'month') = trunc(dt_mes_w, 'month')
order by	nr_sequencia;

BEGIN

for r_c_avaliacoes_mes in c_avaliacoes_mes loop
	CALL proj_calcular_ponto(r_c_avaliacoes_mes.nr_sequencia, nm_usuario_p);
end loop;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE proj_calc_pts_todos_avals_mes ( nr_seq_modelo_p bigint, dt_mes_p timestamp, nm_usuario_p text ) FROM PUBLIC;

