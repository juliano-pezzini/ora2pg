-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE substituir_macro_res_tasy ( nm_usuario_p text, cd_pessoa_fisica_p text, cd_profissional_p text, nr_seq_sumario_p text) AS $body$
DECLARE


macro_inicial_w		varchar(100);
macro_final_w		varchar(100);
macro_texto_final_w varchar(100);
retorno_macro_w		text;
ds_macro_filha_w	varchar(100);
macro_filha_inicial_w	varchar(100);
macro_filha_final_w	varchar(100);
retorno_filha_macro_w varchar(4000);
ds_informacao_w			text;
ds_informacao_filha_w 	text;
ds_informacao_cursor_w 	varchar(4000);
ds_retorno_w		text;
macro_texto_primcipal_w	text;
replace_w			text;
macro_next_variable_w	varchar(4000);
macro_next_variable_filha_w	varchar(4000);
macro_filha_final_teste_w   varchar(4000);
ie_possui_registro_w		varchar(1);
ie_possui_registro_filha_w	varchar(1);
ds_texto_principal_w	text;
ds_texto_filha_w		text;
qt_registro_filha_w		bigint;
qt_macros_w				bigint;
qt_macros_filha_w		bigint;
sqlerrm_w				varchar(4000);
ds_retorno_vazio_filha_w bigint;
ds_result1_w			varchar(2000);
ds_result2_w			varchar(2000);
ds_result3_w			varchar(2000);
ds_result4_w			varchar(2000);
ds_result5_w			varchar(2000);
cabecalho_exame_w		text;
corpo_exame_w			text;
final_exame_w			text;
ie_data_w				varchar(1);
exame_negrito_w			varchar(10);
exame_fim_negrito_w			varchar(10);
valor_w						xml;
ds_valor_final_w					text;
ds_titulo_w				varchar(255);
dt_informacao_w			timestamp;




C01 CURSOR FOR
	SELECT TO_CHAR(dt_atualizacao, 'dd/mm/yyyy hh24:mi:ss')|| ' - '||ds_informacao
	from res_paciente_resultado
	where cd_pessoa_fisica = cd_pessoa_fisica_p
	and cd_profissional_dest = cd_profissional_p
	and nm_usuario = nm_usuario_p
	and upper(ds_macro) like '%'||upper(trim(both retorno_macro_w))||'%'
	order by dt_informacao desc;

C02 CURSOR FOR
	SELECT TO_CHAR(dt_atualizacao, 'dd/mm/yyyy hh24:mi:ss')|| ' - '||ds_informacao
	from res_paciente_resultado
	where cd_pessoa_fisica = cd_pessoa_fisica_p
	and cd_profissional_dest = cd_profissional_p
	and nm_usuario = nm_usuario_p
	and upper(ds_macro) like '%'||upper(trim(both retorno_filha_macro_w))||'%'
	order by dt_informacao desc;

-- Exames laboratoriais ,  Sinais vitais  e Antropometria ( Modelo horizontal )
C03 CURSOR FOR
SELECT  ds_informacao,
		ds_result1,
		ds_result2,
		ds_result3,
		ds_result4,
		ds_result5,
		ie_data
	from 	res_paciente_resultado
	where 	cd_pessoa_fisica = cd_pessoa_fisica_p
	and 	cd_profissional_dest = cd_profissional_p
	and 	nm_usuario = nm_usuario_p
	and 	upper(ds_macro) like '%'||upper(trim(both retorno_filha_macro_w))||'%'
	and		(ie_horizontal IS NOT NULL AND ie_horizontal::text <> '')
    and		(ds_macro IS NOT NULL AND ds_macro::text <> '')
	order by ds_macro, ie_data, dt_informacao desc , ds_informacao;

-- Alergias, problemas e diagnósticos
C04 CURSOR FOR
	SELECT  ds_informacao ds_informacao,
			obter_tempo_problema_res(nr_Sequencia)
	from 	res_paciente_resultado
	where 	cd_pessoa_fisica = cd_pessoa_fisica_p
	and 	cd_profissional_dest = cd_profissional_p
	and 	nm_usuario = nm_usuario_p
	and		coalesce(ie_horizontal::text, '') = ''
	and		ie_tipo = 'DI'
	group by ds_informacao, obter_tempo_problema_res(nr_Sequencia)
	order by obter_tempo_problema_res(nr_Sequencia),ds_informacao;

-- Antecedentes familiares
C05 CURSOR FOR
	SELECT  ds_result1,
			ds_informacao,
			dt_informacao
	from 	res_paciente_resultado
	where 	cd_pessoa_fisica = cd_pessoa_fisica_p
	and 	cd_profissional_dest = cd_profissional_p
	and 	nm_usuario = nm_usuario_p
	and		coalesce(ie_horizontal::text, '') = ''
	and		ie_tipo = 'HSF'
	and 	upper(ds_macro) like '%'||upper(trim(both retorno_filha_macro_w))||'%'
	group by ds_informacao, ds_result1, dt_informacao
	order by dt_informacao desc;

--  Medicamentos
C06 CURSOR FOR
	SELECT  ds_informacao,
			ds_observacao,
			dt_informacao
	from 	res_paciente_resultado
	where 	cd_pessoa_fisica = cd_pessoa_fisica_p
	and 	cd_profissional_dest = cd_profissional_p
	and 	nm_usuario = nm_usuario_p
	and		coalesce(ie_horizontal::text, '') = ''
	and		ie_tipo = 'ME'
	and 	upper(ds_macro) like '%'||upper(trim(both retorno_filha_macro_w))||'%'
	group by ds_informacao, ds_observacao, dt_informacao
	order by dt_informacao desc, ds_informacao;

-- Procedimentos
C07 CURSOR FOR
	SELECT  ds_informacao,
			ds_observacao,
			dt_informacao
	from 	res_paciente_resultado
	where 	cd_pessoa_fisica = cd_pessoa_fisica_p
	and 	cd_profissional_dest = cd_profissional_p
	and 	nm_usuario = nm_usuario_p
	and		coalesce(ie_horizontal::text, '') = ''
	and		ie_tipo = 'PR'
	and 	upper(ds_macro) like '%'||upper(trim(both retorno_filha_macro_w))||'%'
	group by ds_informacao, ds_observacao, dt_informacao
	order by dt_informacao desc, ds_informacao;

-- Exames não laboratoriais
C08 CURSOR FOR
	SELECT  ds_informacao,
			ds_observacao,
			dt_informacao
	from 	res_paciente_resultado
	where 	cd_pessoa_fisica = cd_pessoa_fisica_p
	and 	cd_profissional_dest = cd_profissional_p
	and 	nm_usuario = nm_usuario_p
	and		coalesce(ie_horizontal::text, '') = ''
	and		ie_tipo = 'EI'
	and 	upper(ds_macro) like '%'||upper(trim(both retorno_filha_macro_w))||'%'
	group by ds_informacao, ds_observacao, dt_informacao
	order by dt_informacao desc, ds_informacao;

-- Tipo sanguíneo
C09 CURSOR FOR
	SELECT  ds_informacao,
			ds_observacao,
			dt_informacao
	from 	res_paciente_resultado
	where 	cd_pessoa_fisica = cd_pessoa_fisica_p
	and 	cd_profissional_dest = cd_profissional_p
	and 	nm_usuario = nm_usuario_p
	and		coalesce(ie_horizontal::text, '') = ''
	and		ie_tipo = 'TS'
	and 	upper(ds_macro) like '%'||upper(trim(both retorno_filha_macro_w))||'%'
	group by ds_informacao, ds_observacao, dt_informacao
	order by dt_informacao desc, ds_informacao;

-- Educação ao paciente
C10 CURSOR FOR
	SELECT  ds_informacao,
			ds_observacao,
			dt_informacao
	from 	res_paciente_resultado
	where 	cd_pessoa_fisica = cd_pessoa_fisica_p
	and 	cd_profissional_dest = cd_profissional_p
	and 	nm_usuario = nm_usuario_p
	and		coalesce(ie_horizontal::text, '') = ''
	and		ie_tipo = 'EDP'
	and 	upper(ds_macro) like '%'||upper(trim(both retorno_filha_macro_w))||'%'
	group by ds_informacao, ds_observacao, dt_informacao
	order by dt_informacao desc, ds_informacao;

-- Medicamentos
C11 CURSOR FOR
	SELECT  ds_informacao,
			ds_observacao,
			dt_informacao
	from 	res_paciente_resultado
	where 	cd_pessoa_fisica = cd_pessoa_fisica_p
	and 	cd_profissional_dest = cd_profissional_p
	and 	nm_usuario = nm_usuario_p
	and		coalesce(ie_horizontal::text, '') = ''
	and		ie_tipo = 'ME'
	and 	upper(ds_macro) like '%'||upper(trim(both retorno_filha_macro_w))||'%'
	group by ds_informacao, ds_observacao, dt_informacao
	order by dt_informacao desc, ds_informacao;

-- Imunizações
C12 CURSOR FOR
	SELECT  ds_informacao,
			ds_observacao,
			dt_informacao
	from 	res_paciente_resultado
	where 	cd_pessoa_fisica = cd_pessoa_fisica_p
	and 	cd_profissional_dest = cd_profissional_p
	and 	nm_usuario = nm_usuario_p
	and		coalesce(ie_horizontal::text, '') = ''
	and		ie_tipo = 'IM'
	and 	upper(ds_macro) like '%'||upper(trim(both retorno_filha_macro_w))||'%'
	group by ds_informacao, ds_observacao, dt_informacao
	order by dt_informacao desc, ds_informacao;

-- Antecedentes pessoais
C13 CURSOR FOR
	SELECT  ds_informacao,
			ds_observacao,
			dt_informacao
	from 	res_paciente_resultado
	where 	cd_pessoa_fisica = cd_pessoa_fisica_p
	and 	cd_profissional_dest = cd_profissional_p
	and 	nm_usuario = nm_usuario_p
	and		coalesce(ie_horizontal::text, '') = ''
	and		ie_tipo = 'HSA'
	and 	upper(ds_macro) like '%'||upper(trim(both retorno_filha_macro_w))||'%'
	group by ds_informacao, ds_observacao, dt_informacao
	order by dt_informacao desc, ds_informacao;

-- Solicitações de exames
C14 CURSOR FOR
	SELECT  ds_informacao,
			ds_observacao,
			dt_informacao
	from 	res_paciente_resultado
	where 	cd_pessoa_fisica = cd_pessoa_fisica_p
	and 	cd_profissional_dest = cd_profissional_p
	and 	nm_usuario = nm_usuario_p
	and		coalesce(ie_horizontal::text, '') = ''
	and		ie_tipo = 'EL'
	and 	upper(ds_macro) like '%'||upper(trim(both retorno_filha_macro_w))||'%'
	group by ds_informacao, ds_observacao, dt_informacao
	order by dt_informacao desc, ds_informacao;

-- Hábitos e vícios
C15 CURSOR FOR
	SELECT  ds_informacao,
			ds_result1,
			ds_result2,
			dt_informacao
	from 	res_paciente_resultado
	where 	cd_pessoa_fisica = cd_pessoa_fisica_p
	and 	cd_profissional_dest = cd_profissional_p
	and 	nm_usuario = nm_usuario_p
	and		coalesce(ie_horizontal::text, '') = ''
	and		ie_tipo = 'HSH'
	and 	upper(ds_macro) like '%'||upper(trim(both retorno_filha_macro_w))||'%'
	group by ds_informacao, ds_result1, ds_result2, dt_informacao
	order by dt_informacao desc, ds_informacao;

-- Pratica de exercicios
C16 CURSOR FOR
	SELECT  ds_result8,
			ds_result9,
			dt_informacao
	from 	res_paciente_resultado
	where 	cd_pessoa_fisica = cd_pessoa_fisica_p
	and 	cd_profissional_dest = cd_profissional_p
	and 	nm_usuario = nm_usuario_p
	and		coalesce(ie_horizontal::text, '') = ''
	and		ie_tipo = 'HSH'
	and 	upper(ds_macro) like '%'||upper(trim(both retorno_filha_macro_w))||'%'
	group by ds_result8, ds_result9, dt_informacao
	order by dt_informacao desc, ds_result8;


-- Obstetricia e nascimento
C17 CURSOR FOR
	SELECT  obter_desc_expressao(289481)||': '|| CASE WHEN upper(ds_result1)='TRUE' THEN obter_desc_expressao(327113) END  ds_gravida,
			obter_desc_expressao(294461)||': '|| ds_result2 qt_gestacao,
			dt_informacao dt_registro
	from 	res_paciente_resultado
	where 	cd_pessoa_fisica = cd_pessoa_fisica_p
	and 	cd_profissional_dest = cd_profissional_p
	and 	nm_usuario = nm_usuario_p
	and		coalesce(ie_horizontal::text, '') = ''
	and		ie_tipo = 'HSA'
	and 	upper(ds_macro) like '%'||upper(trim(both retorno_filha_macro_w))||'%'
	group by ds_result1, ds_result2, dt_informacao
	order by dt_informacao desc, ds_gravida;

BEGIN

SELECT 	ds_texto_macro
into STRICT 	ds_texto_principal_w
FROM 	config_imp_sumario
WHERE 	ie_tipo_sumario = 'RESU'
AND 	coalesce(nr_seq_texto_sup::text, '') = '';

select length(ds_texto_principal_w) - length(regexp_replace(ds_texto_principal_w,'@',''))
into STRICT qt_macros_w
;

macro_inicial_w := 1;
macro_final_w := 1;

for y IN 1..qt_macros_w LOOP

		ds_retorno_vazio_filha_w:= 0;

		select 	INSTR(regexp_substr(ds_texto_macro, '@[^.]*'),'@',macro_final_w)
		into STRICT 	macro_next_variable_w
		FROM 	config_imp_sumario
		WHERE 	ie_tipo_sumario = 'RESU'
		AND 	coalesce(nr_seq_texto_sup::text, '') = '';

		SELECT INSTR(SUBSTR(regexp_substr(ds_texto_macro, '@[^.]*'),macro_next_variable_w,100),'<','1')
		into STRICT 	macro_texto_final_w
		FROM 	config_imp_sumario
		WHERE 	ie_tipo_sumario = 'RESU'
		AND 	coalesce(nr_seq_texto_sup::text, '') = '';

		select 	SUBSTR(regexp_substr(ds_texto_macro, '@[^.]*'),macro_next_variable_w,macro_texto_final_w - 1) ds_macro
		into STRICT  	retorno_macro_w
		FROM 	config_imp_sumario
		WHERE 	ie_tipo_sumario = 'RESU'
		AND 	coalesce(nr_seq_texto_sup::text, '') = '';

		if (retorno_macro_w IS NOT NULL AND retorno_macro_w::text <> '') then
			SELECT  max(to_char(ds_texto_macro))
			into STRICT  	ds_texto_filha_w
			FROM 	config_imp_sumario
			WHERE 	ie_tipo_sumario = 'RESU'
			AND 	upper(ds_macro_referencia) LIKE '%'||upper(retorno_macro_w)||'%';


			if (ds_texto_filha_w IS NOT NULL AND ds_texto_filha_w::text <> '') then

				select length(ds_texto_filha_w) - length(regexp_replace(ds_texto_filha_w,'@',''))
				into STRICT qt_macros_filha_w
				;

				macro_filha_inicial_w := 1;
				macro_filha_final_w := 1;


				for x IN 1.. qt_macros_filha_w LOOP


					SELECT INSTR(regexp_substr(ds_texto_macro, '@[^.]*'),'@',macro_filha_final_w)
					into STRICT 	macro_next_variable_filha_w
					FROM 	config_imp_sumario
					WHERE 	ie_tipo_sumario = 'RESU'
					AND 	upper(ds_macro_referencia) LIKE '%'||upper(retorno_macro_w)||'%';


					SELECT INSTR(SUBSTR(regexp_substr(ds_texto_macro, '@[^.]*'),macro_next_variable_filha_w,10000),'<','1')
					into STRICT  macro_filha_final_teste_w
					FROM config_imp_sumario
					WHERE ie_tipo_sumario = 'RESU'
					AND UPPER(ds_macro_referencia) LIKE '%'||UPPER(retorno_macro_w)||'%';

					if (macro_filha_final_teste_w IS NOT NULL AND macro_filha_final_teste_w::text <> '') or (macro_filha_final_teste_w <> 0)  then

							SELECT 	SUBSTR(regexp_substr(ds_texto_macro, '@[^.]*'),macro_next_variable_filha_w,macro_filha_final_teste_w - 1) ds_macro
							into STRICT 	retorno_filha_macro_w
							FROM 	config_imp_sumario
							WHERE 	ie_tipo_sumario = 'RESU'
							AND 	upper(ds_macro_referencia) LIKE '%'||upper(retorno_macro_w)||'%';

							if ( retorno_filha_macro_w = '@pathology_test_result') then

								select count(*)
								into STRICT qt_registro_filha_w
								from res_paciente_resultado
								where cd_pessoa_fisica = cd_pessoa_fisica_p
								and cd_profissional_dest = cd_profissional_p
								and nm_usuario = nm_usuario_p
								and	(ie_horizontal IS NOT NULL AND ie_horizontal::text <> '')
								and upper(ds_macro) like '%'||upper(trim(both retorno_filha_macro_w))||'%';


							else


								select count(*)
								into STRICT qt_registro_filha_w
								from res_paciente_resultado
								where cd_pessoa_fisica = cd_pessoa_fisica_p
								and cd_profissional_dest = cd_profissional_p
								and nm_usuario = nm_usuario_p
								and upper(ds_macro) like '%'||upper(trim(both retorno_filha_macro_w))||'%';

							end if;

						    if ( qt_registro_filha_w > 0) then

								if ( retorno_filha_macro_w in ('@blood_pressure','@pulse','@respirations','@height_length','@body_weight')) then

									ds_retorno_w := ds_retorno_w || '<html tasy="html5"><p class="paragraph"> </p><table class="wrichedit-table" data-height="201" data-width="622"><tbody>';

									open C03;
									loop
									fetch C03 into
										ds_informacao_filha_w,
										ds_result1_w,
										ds_result2_w,
										ds_result3_w,
										ds_result4_w,
										ds_result5_w,
										ie_data_w;
									EXIT WHEN NOT FOUND; /* apply on C03 */
										begin

										exame_negrito_w :='';
										exame_fim_negrito_w :='';

										if ( ie_data_w = 'S') then

											exame_negrito_w :='<b>';
											exame_fim_negrito_w :='</b>';

										end if;

										corpo_exame_w := '<tr data-height="20" data-width="621">
																  <td data-height="20" data-width="62" style="max-width: 100.2px; overflow: overlay;">'||exame_negrito_w||ds_informacao_filha_w||exame_fim_negrito_w||'</td>
																  <td data-height="20" data-width="62" style="max-width: 30.2px; overflow: overlay; text-align: center;">'||exame_negrito_w||ds_result1_w||exame_fim_negrito_w||'</td>
																  <td data-height="20" data-width="62" style="max-width: 30.2px; overflow: overlay; text-align: center;">'||exame_negrito_w||ds_result2_w||exame_fim_negrito_w||'</td>
																  <td data-height="20" data-width="62" style="max-width: 30.2px; overflow: overlay; text-align: center;">'||exame_negrito_w||ds_result3_w||exame_fim_negrito_w||'</td>
																  <td data-height="20" data-width="62" style="max-width: 30.2px; overflow: overlay; text-align: center;">'||exame_negrito_w||ds_result4_w||exame_fim_negrito_w||'</td>
																  <td data-height="20" data-width="62" style="max-width: 30.2px; overflow: overlay; text-align: center;">'||exame_negrito_w||ds_result5_w||exame_fim_negrito_w||'</td>
																  </tr>';

										ds_retorno_w := ds_retorno_w||corpo_exame_w;


										end;
									end loop;
									Close C03;

									final_exame_w := '</tbody>
													 </table>
													</html>';

									ds_retorno_w := ds_retorno_w||final_exame_w;


								elsif ( retorno_filha_macro_w = '@problem_diagnosis') then

									ds_retorno_w := ds_retorno_w || '<html tasy="html5"><p class="paragraph"> </p><table class="wrichedit-table" data-height="201" data-width="622"><tbody>';


									open C04;
									loop
									fetch C04 into
										ds_informacao_cursor_w,
										ds_result1_w;
									EXIT WHEN NOT FOUND; /* apply on C04 */
										begin

										exame_negrito_w :='';
										exame_fim_negrito_w :='';

										corpo_exame_w := '<tr data-height="20" data-width="621">
															  <td data-height="20" data-width="62" style="max-width: 50px; overflow: overlay; border: 1px solid #fff!important;">'||exame_negrito_w||ds_informacao_cursor_w||exame_fim_negrito_w||'</td>
															  <td data-height="20" data-width="62" style="max-width: 100px; overflow: overlay; text-align: left; border: 1px solid #fff!important;">'||exame_negrito_w||ds_result1_w||exame_fim_negrito_w||'</td>
															  </tr>';


										ds_retorno_w := ds_retorno_w||corpo_exame_w;


										end;
									end loop;
									close C04;

									final_exame_w := '</tbody>
												 </table>
												 </html>';

									ds_retorno_w := ds_retorno_w||final_exame_w;

								elsif ( retorno_filha_macro_w in ('@family_history','@exclusion_family_history','@family_summary')) then

									if ( retorno_filha_macro_w = '@family_history') then

										ds_titulo_w := obter_desc_expressao(291339);

									elsif ( retorno_filha_macro_w = '@exclusion_family_history') then

										ds_titulo_w := obter_desc_expressao(289757);

									else

										ds_titulo_w := obter_desc_expressao(315608);

									end if;

									ds_retorno_w := ds_retorno_w||'<b>'|| ds_titulo_w ||'</b>';

									ds_retorno_w := ds_retorno_w || '<html tasy="html5"><p class="paragraph"> </p><table class="wrichedit-table" data-height="201" data-width="622"><tbody>';

									open C05;
									loop
									fetch C05 into
										ds_result1_w,
										ds_informacao_cursor_w,
										dt_informacao_w;
									EXIT WHEN NOT FOUND; /* apply on C05 */
										begin

											exame_negrito_w :='';
											exame_fim_negrito_w :='';

											If (ds_result1_w IS NOT NULL AND ds_result1_w::text <> '') then
												ds_informacao_cursor_w := ds_result1_w ||', '|| ds_informacao_cursor_w;
											end if;

											corpo_exame_w := '<tr data-height="20" data-width="621">
															  <td data-height="20" data-width="62" style="max-width: 200px; overflow: overlay; border: 1px solid #fff!important;">'||exame_negrito_w||ds_informacao_cursor_w||exame_fim_negrito_w||'</td>
															  <td data-height="20" data-width="62" style="max-width: 50px; overflow: overlay; text-align: right; border: 1px solid #fff!important;">'||exame_negrito_w||dt_informacao_w||exame_fim_negrito_w||'</td>
															  </tr>';

											ds_retorno_w := ds_retorno_w||chr(10)||corpo_exame_w;


										end;
									end loop;
									Close C05;

									final_exame_w := '</tbody>
												 </table>
												 </html>';

									ds_retorno_w := ds_retorno_w||final_exame_w;


								elsif ( retorno_filha_macro_w in ('@medication_order','@exclusion_medication')) then

									if ( retorno_filha_macro_w = '@medication_order') then

										ds_titulo_w := obter_desc_expressao(298654); -- Solicitado
									elsif ( retorno_filha_macro_w = '@exclusion_medication') then

										ds_titulo_w := obter_desc_expressao(289757); -- Exclusão
									end if;

									ds_retorno_w := ds_retorno_w||'<b>'|| ds_titulo_w ||'</b>';

									ds_retorno_w := ds_retorno_w || '<html tasy="html5"><p class="paragraph"> </p><table class="wrichedit-table" data-height="201" data-width="622"><tbody>';

									open C06;
									loop
									fetch C06 into
										ds_informacao_cursor_w,
										ds_result1_w,
										dt_informacao_w;
									EXIT WHEN NOT FOUND; /* apply on C06 */
										begin

											exame_negrito_w :='';
											exame_fim_negrito_w :='';

											corpo_exame_w := '<tr data-height="20" data-width="621">
															  <td data-height="20" data-width="62" style="max-width: 100px; overflow: overlay; border: 1px solid #fff!important;">'||exame_negrito_w||ds_informacao_cursor_w||exame_fim_negrito_w||'</td>
															  <td data-height="20" data-width="62" style="max-width: 80px; overflow: overlay; text-align: left; border: 1px solid #fff!important;">'||exame_negrito_w||ds_result1_w||exame_fim_negrito_w||'</td>
															  <td data-height="20" data-width="62" style="max-width: 50px; overflow: overlay; text-align: right; border: 1px solid #fff!important;">'||exame_negrito_w||dt_informacao_w||exame_fim_negrito_w||'</td>
															  </tr>';

											ds_retorno_w := ds_retorno_w||chr(10)||corpo_exame_w;


										end;
									end loop;
									Close C06;

									final_exame_w := '</tbody>
												 </table>
												 </html>';

									ds_retorno_w := ds_retorno_w||final_exame_w;

								elsif ( retorno_filha_macro_w in ('@procedure_undertaken','@procedure_request','@exclusion_procedure')) then

									if ( retorno_filha_macro_w = '@procedure_undertaken') then

										ds_titulo_w := obter_desc_expressao(873269); --  Realização
									elsif ( retorno_filha_macro_w = '@procedure_request') then

										ds_titulo_w := obter_desc_expressao(298640); -- Solicitação
									elsif ( retorno_filha_macro_w = '@exclusion_procedure') then

										ds_titulo_w := obter_desc_expressao(289757); -- Exclusão
									end if;

									ds_retorno_w := ds_retorno_w||'<b>'|| ds_titulo_w ||'</b>';

									ds_retorno_w := ds_retorno_w || '<html tasy="html5"><p class="paragraph"> </p><table class="wrichedit-table" data-height="201" data-width="622"><tbody>';

									open C07;
									loop
									fetch C07 into
										ds_informacao_cursor_w,
										ds_result1_w,
										dt_informacao_w;
									EXIT WHEN NOT FOUND; /* apply on C07 */
										begin

											exame_negrito_w :='';
											exame_fim_negrito_w :='';

											corpo_exame_w := '<tr data-height="20" data-width="621">
															  <td data-height="20" data-width="62" style="max-width: 200px; overflow: overlay; border: 1px solid #fff!important;">'||exame_negrito_w||ds_informacao_cursor_w||exame_fim_negrito_w||'</td>
															  <td data-height="20" data-width="62" style="max-width: 50px; overflow: overlay; text-align: right; border: 1px solid #fff!important;">'||exame_negrito_w||dt_informacao_w||exame_fim_negrito_w||'</td>
															  </tr>';

											ds_retorno_w := ds_retorno_w||chr(10)||corpo_exame_w;


										end;
									end loop;
									Close C07;

									final_exame_w := '</tbody>
												 </table>
												 </html>';

									ds_retorno_w := ds_retorno_w||final_exame_w;

								elsif ( retorno_filha_macro_w in ('@imaging_examination_request','@imaging_examination_result')) then

									if ( retorno_filha_macro_w = '@imaging_examination_request') then

										ds_titulo_w := obter_desc_expressao(298640); -- Solicitação
									elsif ( retorno_filha_macro_w = '@imaging_examination_result') then

										ds_titulo_w := obter_desc_expressao(297817); -- Resultado
									end if;

									ds_retorno_w := ds_retorno_w||'<b>'|| ds_titulo_w ||'</b>';

									ds_retorno_w := ds_retorno_w || '<html tasy="html5"><p class="paragraph"> </p><table class="wrichedit-table" data-height="201" data-width="622"><tbody>';

									open C08;
									loop
									fetch C08 into
										ds_informacao_cursor_w,
										ds_result1_w,
										dt_informacao_w;
									EXIT WHEN NOT FOUND; /* apply on C08 */
										begin

											exame_negrito_w :='';
											exame_fim_negrito_w :='';

											corpo_exame_w := '<tr data-height="20" data-width="621">
															  <td data-height="20" data-width="62" style="max-width: 200px; overflow: overlay; border: 1px solid #fff!important;">'||exame_negrito_w||ds_informacao_cursor_w||exame_fim_negrito_w||'</td>
															  <td data-height="20" data-width="62" style="max-width: 50px; overflow: overlay; text-align: right; border: 1px solid #fff!important;">'||exame_negrito_w||dt_informacao_w||exame_fim_negrito_w||'</td>
															  </tr>';

											ds_retorno_w := ds_retorno_w||chr(10)||corpo_exame_w;


										end;
									end loop;
									Close C08;

									final_exame_w := '</tbody>
												 </table>
												 </html>';

									ds_retorno_w := ds_retorno_w||final_exame_w;

								elsif ( retorno_filha_macro_w in ('@blood_matching')) then

									ds_retorno_w := ds_retorno_w || '<html tasy="html5"><p class="paragraph"> </p><table class="wrichedit-table" data-height="201" data-width="622"><tbody>';

									open C09;
									loop
									fetch C09 into
										ds_informacao_cursor_w,
										ds_result1_w,
										dt_informacao_w;
									EXIT WHEN NOT FOUND; /* apply on C09 */
										begin

											exame_negrito_w :='';
											exame_fim_negrito_w :='';


											if (ds_informacao_cursor_w IS NOT NULL AND ds_informacao_cursor_w::text <> '') and (ds_result1_w IS NOT NULL AND ds_result1_w::text <> '') then

												ds_informacao_cursor_w := obter_desc_expressao(283059)|| ': '||ds_informacao_cursor_w;
												ds_informacao_cursor_w := ds_informacao_cursor_w ||' '||obter_desc_expressao(311794)|| ': '||ds_result1_w;

												corpo_exame_w := '<tr data-height="20" data-width="621">
															  <td data-height="20" data-width="62" style="max-width: 200px; overflow: overlay; border: 1px solid #fff!important;">'||exame_negrito_w||ds_informacao_cursor_w||exame_fim_negrito_w||'</td>
															  <td data-height="20" data-width="62" style="max-width: 50px; overflow: overlay; text-align: right; border: 1px solid #fff!important;">'||exame_negrito_w||dt_informacao_w||exame_fim_negrito_w||'</td>
															  </tr>';

												ds_retorno_w := ds_retorno_w||chr(10)||corpo_exame_w;

												goto	proximo;

											end if;


										end;
									end loop;
									Close C09;

									<<proximo>>

									final_exame_w := '</tbody>
												 </table>
												 </html>';

									ds_retorno_w := ds_retorno_w||final_exame_w;


								elsif ( retorno_filha_macro_w in ('@health_education')) then

									ds_retorno_w := ds_retorno_w || '<html tasy="html5"><p class="paragraph"> </p><table class="wrichedit-table" data-height="201" data-width="622"><tbody>';

									open C10;
									loop
									fetch C10 into
										ds_informacao_cursor_w,
										ds_result1_w,
										dt_informacao_w;
									EXIT WHEN NOT FOUND; /* apply on C10 */
										begin

											exame_negrito_w :='';
											exame_fim_negrito_w :='';


											corpo_exame_w := '<tr data-height="20" data-width="621">
															  <td data-height="20" data-width="62" style="max-width: 200px; overflow: overlay; border: 1px solid #fff!important;">'||exame_negrito_w||ds_informacao_cursor_w||exame_fim_negrito_w||'</td>
															  <td data-height="20" data-width="62" style="max-width: 50px; overflow: overlay; text-align: right; border: 1px solid #fff!important;">'||exame_negrito_w||dt_informacao_w||exame_fim_negrito_w||'</td>
															  </tr>';

											ds_retorno_w := ds_retorno_w||chr(10)||corpo_exame_w;


										end;
									end loop;
									Close C10;

									final_exame_w := '</tbody>
												 </table>
												 </html>';

									ds_retorno_w := ds_retorno_w||final_exame_w;

								elsif ( retorno_filha_macro_w in ('@medication_order','@exclusion_medication')) then

									if ( retorno_filha_macro_w = '@medication_order') then

										ds_titulo_w := obter_desc_expressao(298640); -- Solicitação
									elsif ( retorno_filha_macro_w = '@exclusion_medication') then

										ds_titulo_w := obter_desc_expressao(297817); -- Resultado
									end if;

									ds_retorno_w := ds_retorno_w||'<b>'|| ds_titulo_w ||'</b>';

									ds_retorno_w := ds_retorno_w || '<html tasy="html5"><p class="paragraph"> </p><table class="wrichedit-table" data-height="201" data-width="622"><tbody>';

									open C11;
									loop
									fetch C11 into
										ds_informacao_cursor_w,
										ds_result1_w,
										dt_informacao_w;
									EXIT WHEN NOT FOUND; /* apply on C11 */
										begin

											exame_negrito_w :='';
											exame_fim_negrito_w :='';

											corpo_exame_w := '<tr data-height="20" data-width="621">
															  <td data-height="20" data-width="62" style="max-width: 100px; overflow: overlay; border: 1px solid #fff!important;">'||exame_negrito_w||ds_informacao_cursor_w||exame_fim_negrito_w||'</td>
															  <td data-height="20" data-width="62" style="max-width: 80px; overflow: overlay; text-align: left; border: 1px solid #fff!important;">'||exame_negrito_w||ds_result1_w||exame_fim_negrito_w||'</td>
															  <td data-height="20" data-width="62" style="max-width: 50px; overflow: overlay; text-align: right; border: 1px solid #fff!important;">'||exame_negrito_w||dt_informacao_w||exame_fim_negrito_w||'</td>
															  </tr>';

											ds_retorno_w := ds_retorno_w||chr(10)||corpo_exame_w;


										end;
									end loop;
									Close C11;

									final_exame_w := '</tbody>
												 </table>
												 </html>';

									ds_retorno_w := ds_retorno_w||final_exame_w;

								elsif ( retorno_filha_macro_w in ('@action_regarding_vaccine' , '@vaccination_summary' , '@exclusion_vaccine')) then

									if ( retorno_filha_macro_w = '@action_regarding_vaccine') then

										ds_titulo_w := obter_desc_expressao(321558); --  Administrado
									elsif ( retorno_filha_macro_w = '@vaccination_summary') then

										ds_titulo_w := obter_desc_expressao(315608); --  Sumário
									elsif ( retorno_filha_macro_w = '@exclusion_vaccine') then

										ds_titulo_w := obter_desc_expressao(289757); --  Exclusão
									end if;

									ds_retorno_w := ds_retorno_w||'<b>'|| ds_titulo_w ||'</b>';

									ds_retorno_w := ds_retorno_w || '<html tasy="html5"><p class="paragraph"> </p><table class="wrichedit-table" data-height="201" data-width="622"><tbody>';

									open C12;
									loop
									fetch C12 into
										ds_informacao_cursor_w,
										ds_result1_w,
										dt_informacao_w;
									EXIT WHEN NOT FOUND; /* apply on C12 */
										begin

											exame_negrito_w :='';
											exame_fim_negrito_w :='';

											corpo_exame_w := '<tr data-height="20" data-width="621">
															  <td data-height="20" data-width="62" style="max-width: 200px; overflow: overlay; border: 1px solid #fff!important;">'||exame_negrito_w||ds_informacao_cursor_w||exame_fim_negrito_w||'</td>
															  <td data-height="20" data-width="62" style="max-width: 50px; overflow: overlay; text-align: right; border: 1px solid #fff!important;">'||exame_negrito_w||dt_informacao_w||exame_fim_negrito_w||'</td>
															  </tr>';

											ds_retorno_w := ds_retorno_w||chr(10)||corpo_exame_w;


										end;
									end loop;
									Close C12;

									final_exame_w := '</tbody>
												 </table>
												 </html>';

									ds_retorno_w := ds_retorno_w||final_exame_w;


								elsif ( retorno_filha_macro_w in ('@social_history','@past_history','@obstetric_summary')) then

									if ( retorno_filha_macro_w = '@social_history') then

										ds_titulo_w := obter_desc_expressao(315608); -- Sumário
									elsif ( retorno_filha_macro_w = '@past_history') then

										ds_titulo_w := obter_desc_expressao(291339); -- Histórico
									elsif ( retorno_filha_macro_w = '@obstetric_summary') then

										ds_titulo_w := obter_desc_expressao(294686); -- Obstetrícia
									end if;

									ds_retorno_w := ds_retorno_w||'<b>'|| ds_titulo_w ||'</b>';

									ds_retorno_w := ds_retorno_w || '<html tasy="html5"><p class="paragraph"> </p><table class="wrichedit-table" data-height="201" data-width="622"><tbody>';


									if ( retorno_filha_macro_w in ('@social_history','@past_history')) then

										open C13;
										loop
										fetch C13 into
											ds_informacao_cursor_w,
											ds_result1_w,
											dt_informacao_w;
										EXIT WHEN NOT FOUND; /* apply on C13 */
											begin

												exame_negrito_w :='';
												exame_fim_negrito_w :='';

												corpo_exame_w := '<tr data-height="20" data-width="621">
																  <td data-height="20" data-width="200" style="max-width: 200px; overflow: overlay; border: 1px solid #fff!important;">'||exame_negrito_w||ds_informacao_cursor_w||exame_fim_negrito_w||'</td>
																  <td data-height="20" data-width="30" style="max-width: 50px; overflow: overlay; text-align: right; border: 1px solid #fff!important;">'||exame_negrito_w||dt_informacao_w||exame_fim_negrito_w||'</td>
																  </tr>';

												ds_retorno_w := ds_retorno_w||chr(10)||corpo_exame_w;


											end;
										end loop;
										Close C13;

									elsif ( retorno_filha_macro_w in ('@obstetric_summary')) then

										open C17;
										loop
										fetch C17 into
											ds_informacao_cursor_w,
											ds_result1_w,
											dt_informacao_w;
										EXIT WHEN NOT FOUND; /* apply on C17 */
											begin

												exame_negrito_w :='';
												exame_fim_negrito_w :='';

												corpo_exame_w := '<tr data-height="20" data-width="621">
																  <td data-height="20" data-width="200" style="max-width: 100px; overflow: overlay; border: 1px solid #fff!important;">'||exame_negrito_w||ds_informacao_cursor_w||exame_fim_negrito_w||'</td>
																  <td data-height="20" data-width="200" style="max-width: 50px; overflow: overlay; border: 1px solid #fff!important;">'||exame_negrito_w||ds_result1_w||exame_fim_negrito_w||'</td>
																  <td data-height="20" data-width="30" style="max-width: 50px; overflow: overlay; text-align: right; border: 1px solid #fff!important;">'||exame_negrito_w||dt_informacao_w||exame_fim_negrito_w||'</td>
																  </tr>';

												ds_retorno_w := ds_retorno_w||chr(10)||corpo_exame_w;


											end;
										end loop;
										Close C17;


									end if;

									final_exame_w := '</tbody>
												 </table>
												 </html>';

									ds_retorno_w := ds_retorno_w||final_exame_w;

								elsif ( retorno_filha_macro_w in ('@pathology_test_result','@pathology_test_request')) then

									if ( retorno_filha_macro_w = '@pathology_test_result') then

										ds_titulo_w := obter_desc_expressao(306200); -- Resultados
									elsif ( retorno_filha_macro_w = '@pathology_test_request') then

										ds_titulo_w := obter_desc_expressao(307746); --  Solicitações
									end if;

									ds_retorno_w := ds_retorno_w||'<b>'|| ds_titulo_w ||'</b>';

									if (retorno_filha_macro_w in ('@pathology_test_result')) then

										ds_retorno_w := ds_retorno_w || '<html tasy="html5"><p class="paragraph"> </p><table class="wrichedit-table" data-height="201" data-width="622"><tbody>';

										open C03;
										loop
										fetch C03 into
											ds_informacao_filha_w,
											ds_result1_w,
											ds_result2_w,
											ds_result3_w,
											ds_result4_w,
											ds_result5_w,
											ie_data_w;
										EXIT WHEN NOT FOUND; /* apply on C03 */
											begin

											exame_negrito_w :='';
											exame_fim_negrito_w :='';

											if ( ie_data_w = 'S') then

												exame_negrito_w :='<b>';
												exame_fim_negrito_w :='</b>';

											end if;

											corpo_exame_w := '<tr data-height="20" data-width="621">
																	  <td data-height="20" data-width="62" style="max-width: 100.2px; overflow: overlay;">'||exame_negrito_w||ds_informacao_filha_w||exame_fim_negrito_w||'</td>
																	  <td data-height="20" data-width="62" style="max-width: 30.2px; overflow: overlay; text-align: center;">'||exame_negrito_w||ds_result1_w||exame_fim_negrito_w||'</td>
																	  <td data-height="20" data-width="62" style="max-width: 30.2px; overflow: overlay; text-align: center;">'||exame_negrito_w||ds_result2_w||exame_fim_negrito_w||'</td>
																	  <td data-height="20" data-width="62" style="max-width: 30.2px; overflow: overlay; text-align: center;">'||exame_negrito_w||ds_result3_w||exame_fim_negrito_w||'</td>
																	  <td data-height="20" data-width="62" style="max-width: 30.2px; overflow: overlay; text-align: center;">'||exame_negrito_w||ds_result4_w||exame_fim_negrito_w||'</td>
																	  <td data-height="20" data-width="62" style="max-width: 30.2px; overflow: overlay; text-align: center;">'||exame_negrito_w||ds_result5_w||exame_fim_negrito_w||'</td>
																	  </tr>';

											ds_retorno_w := ds_retorno_w||corpo_exame_w;


											end;
										end loop;
										Close C03;

										final_exame_w := '</tbody>
														 </table>
														</html>';

										ds_retorno_w := ds_retorno_w||final_exame_w;



									else

										ds_retorno_w := ds_retorno_w || '<html tasy="html5"><p class="paragraph"> </p><table class="wrichedit-table" data-height="201" data-width="622"><tbody>';

										open C14;
										loop
										fetch C14 into
											ds_informacao_cursor_w,
											ds_result1_w,
											dt_informacao_w;
										EXIT WHEN NOT FOUND; /* apply on C14 */
											begin

												exame_negrito_w :='';
												exame_fim_negrito_w :='';

												corpo_exame_w := '<tr data-height="20" data-width="621">
																  <td data-height="20" data-width="200" style="max-width: 200px; overflow: overlay; border: 1px solid #fff!important;">'||exame_negrito_w||ds_informacao_cursor_w||exame_fim_negrito_w||'</td>
																  <td data-height="20" data-width="30" style="max-width: 50px; overflow: overlay; text-align: right; border: 1px solid #fff!important;">'||exame_negrito_w||dt_informacao_w||exame_fim_negrito_w||'</td>
																  </tr>';

												ds_retorno_w := ds_retorno_w||chr(10)||corpo_exame_w;


											end;
										end loop;
										Close C14;

										final_exame_w := '</tbody>
													 </table>
													 </html>';

										ds_retorno_w := ds_retorno_w||final_exame_w;

									end if;

								elsif ( retorno_filha_macro_w in ('@alcohol_use_summary', '@tobacco_use_summary', '@substance_use_summary','@physical_activity_summary')) then

									if ( retorno_filha_macro_w = '@physical_activity_summary') then

										ds_titulo_w := obter_desc_expressao(283895); -- Atividade física
									elsif ( retorno_filha_macro_w = '@alcohol_use_summary') then

										ds_titulo_w := obter_desc_expressao(498883); -- Álcool
									elsif ( retorno_filha_macro_w = '@tobacco_use_summary') then

										ds_titulo_w := obter_desc_expressao(487867); -- Tabaco
									elsif ( retorno_filha_macro_w = '@alcohol_use_summary') then

										ds_titulo_w := obter_desc_expressao(298923); -- Substância
									end if;

									ds_retorno_w := ds_retorno_w||'<b>'|| ds_titulo_w ||'</b>';

									if (retorno_filha_macro_w in ('@alcohol_use_summary', '@tobacco_use_summary', '@substance_use_summary')) then

										ds_retorno_w := ds_retorno_w || '<html tasy="html5"><p class="paragraph"> </p><table class="wrichedit-table" data-height="201" data-width="622"><tbody>';

										open C15;
										loop
										fetch C15 into
											ds_informacao_cursor_w,
											ds_result1_w,
											ds_result2_w,
											dt_informacao_w;
										EXIT WHEN NOT FOUND; /* apply on C15 */
											begin

												exame_negrito_w :='';
												exame_fim_negrito_w :='';

												corpo_exame_w := '<tr data-height="20" data-width="621">
																  <td data-height="20" data-width="200" style="max-width: 50px; overflow: overlay; border: 1px solid #fff!important;">'||exame_negrito_w||ds_result1_w||exame_fim_negrito_w||'</td>
																  <td data-height="20" data-width="200" style="max-width: 50px; overflow: overlay; border: 1px solid #fff!important;">'||exame_negrito_w||ds_result2_w||exame_fim_negrito_w||'</td>
																  <td data-height="20" data-width="30" style="max-width: 50px; overflow: overlay; text-align: right; border: 1px solid #fff!important;">'||exame_negrito_w||dt_informacao_w||exame_fim_negrito_w||'</td>
																  </tr>';

												ds_retorno_w := ds_retorno_w||chr(10)||corpo_exame_w;


											end;
										end loop;
										Close C15;

										final_exame_w := '</tbody>
													 </table>
													 </html>';

										ds_retorno_w := ds_retorno_w||final_exame_w;



									else

										ds_retorno_w := ds_retorno_w || '<html tasy="html5"><p class="paragraph"> </p><table class="wrichedit-table" data-height="201" data-width="622"><tbody>';

										open C16;
										loop
										fetch C16 into
											ds_informacao_cursor_w,
											ds_result1_w,
											dt_informacao_w;
										EXIT WHEN NOT FOUND; /* apply on C16 */
											begin

												exame_negrito_w :='';
												exame_fim_negrito_w :='';

												corpo_exame_w := '<tr data-height="20" data-width="621">
																  <td data-height="20" data-width="200" style="max-width: 200px; overflow: overlay; border: 1px solid #fff!important;">'||exame_negrito_w||ds_informacao_cursor_w||exame_fim_negrito_w||'</td>
																  <td data-height="20" data-width="30" style="max-width: 50px; overflow: overlay; text-align: right; border: 1px solid #fff!important;">'||exame_negrito_w||dt_informacao_w||exame_fim_negrito_w||'</td>
																  </tr>';

												ds_retorno_w := ds_retorno_w||chr(10)||corpo_exame_w;


											end;
										end loop;
										Close C16;

										final_exame_w := '</tbody>
													 </table>
													 </html>';

										ds_retorno_w := ds_retorno_w||final_exame_w;

									end if;

								else


									open C02;
									loop
									fetch C02 into
										ds_informacao_filha_w;
									EXIT WHEN NOT FOUND; /* apply on C02 */
										begin
											if (coalesce(ds_retorno_w::text, '') = '') then
												ds_retorno_w := ds_informacao_filha_w;
											else

												ds_retorno_w := ds_retorno_w ||  ''  || ds_informacao_filha_w;

											end if;
										end;
									end loop;
									Close C02;

								end if;

							else
								ds_retorno_w:= '';
								ds_retorno_vazio_filha_w := ds_retorno_vazio_filha_w +1;
							end if;


					else

						macro_filha_final_w := 0;

					end if;



						Select 	replace(ds_texto_filha_w,retorno_filha_macro_w,ds_retorno_w)
						into STRICT	ds_texto_filha_w
						;


					ds_retorno_w := '';

					macro_filha_final_w := macro_next_variable_filha_w +1;
					ie_possui_registro_filha_w:='';
				end loop;

					if (qt_macros_filha_w = ds_retorno_vazio_filha_w) then

						Select 	replace(ds_texto_principal_w,retorno_macro_w,'')
						into STRICT	ds_texto_principal_w
						;

					else

						Select 	replace(ds_texto_principal_w,retorno_macro_w,ds_texto_filha_w)
						into STRICT	ds_texto_principal_w
						;

					end if;
			else

				select 	coalesce(max('S'),'N')
				into STRICT 	ie_possui_registro_w
				from res_paciente_resultado
				where cd_pessoa_fisica = cd_pessoa_fisica_p
				and cd_profissional_dest = cd_profissional_p
				and nm_usuario = nm_usuario_p
				and upper(ds_macro) like '%'||upper(trim(both retorno_macro_w))||'%';


				if (ie_possui_registro_w = 'S') then
					open c01;
								loop
								fetch c01 into
									ds_informacao_w;
								EXIT WHEN NOT FOUND; /* apply on c01 */
									begin
											if (coalesce(ds_retorno_w::text, '') = '') then

												ds_retorno_w := ds_informacao_w;

											else

												ds_retorno_w := ds_retorno_w ||  ''  || ds_informacao_w;
											end if;
									end;
								end loop;
								Close C01;

					else
					ds_retorno_w:= retorno_macro_w;
				end if;
			end if;
					Select 	replace(ds_texto_principal_w,retorno_macro_w,ds_retorno_w)
					into STRICT	ds_texto_principal_w
					;
		end if;


					macro_final_w:= macro_next_variable_w +1;

end loop;


commit;

if (ds_texto_principal_w IS NOT NULL AND ds_texto_principal_w::text <> '') then

	Select 	replace(ds_texto_principal_w,'</br','')
	into STRICT	ds_texto_principal_w
	;

	SELECT 	DELETEXML(xmltype(ds_texto_principal_w),'html/div/p[.=""]')
	into STRICT 	valor_w
	;

	ds_valor_final_w := valor_w;


	INSERT INTO imp_sumario_pac_arquivo(nr_sequencia,
								   dt_atualizacao,
								   nm_usuario,
								   dt_atualizacao_nrec,
								   nm_usuario_nrec,
								   nr_seq_sumario,
								   ie_tipo_arquivo,
								   ds_conteudo) VALUES ( nextval('imp_sumario_pac_arquivo_seq'),
								   clock_timestamp(),
								   nm_usuario_p,
								   clock_timestamp(),
								   nm_usuario_p,
								   nr_seq_sumario_p,
								   'TFO',
								   ds_valor_final_w);

	commit;

end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE substituir_macro_res_tasy ( nm_usuario_p text, cd_pessoa_fisica_p text, cd_profissional_p text, nr_seq_sumario_p text) FROM PUBLIC;

