-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gerar_log_processo_scs ( ds_conteudo_p pls_log_tempo_processo_scs.ds_conteudo%type, nr_seq_log_scs_p INOUT pls_log_tempo_processo_scs.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
BEGIN

-- controle para decidir se o log será ou não gravado
if (pls_util_pck.get_grava_log_scs = 'S') then

	-- se a sequencia for nula, insere
	-- se tiver sequencia atualiza o tempo final e comita o registro
	if (coalesce(nr_seq_log_scs_p::text, '') = '') then

		insert	into pls_log_tempo_processo_scs(nr_sequencia, ds_conteudo, dt_inicio,
			 dt_fim, ds_tempo_exec)
		values (nextval('pls_log_tempo_processo_scs_seq'), ds_conteudo_p, clock_timestamp(),
			 null, null) returning nr_sequencia into nr_seq_log_scs_p;
		commit;
	else

		update	pls_log_tempo_processo_scs
		set	dt_fim		= clock_timestamp(),
			ds_tempo_exec	= pls_manipulacao_datas_pck.obter_tempo_execucao_format(dt_inicio, clock_timestamp())
		where	nr_sequencia = nr_seq_log_scs_p;

		-- deixa como nulo para não precisar ficar reinicializando a todo o momento
		nr_seq_log_scs_p := null;
		commit;
	end if;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_log_processo_scs ( ds_conteudo_p pls_log_tempo_processo_scs.ds_conteudo%type, nr_seq_log_scs_p INOUT pls_log_tempo_processo_scs.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;

