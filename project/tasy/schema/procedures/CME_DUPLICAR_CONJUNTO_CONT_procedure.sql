-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cme_duplicar_conjunto_cont ( nr_seq_cont_p bigint, qt_duplicar_p bigint, nr_seq_lote_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_sequencia_w			cm_conjunto_cont.nr_sequencia%type;
cd_estabelecimento_w		cm_conjunto_cont.cd_estabelecimento%type;
nr_seq_conjunto_w			cm_conjunto_cont.nr_seq_conjunto%type;
ie_status_conjunto_w		cm_conjunto_cont.ie_status_conjunto%type;
dt_origem_w			cm_conjunto_cont.dt_origem%type;
nm_usuario_origem_w		cm_conjunto_cont.nm_usuario_origem%type;
nr_seq_embalagem_w		cm_conjunto_cont.nr_seq_embalagem%type;
dt_recebimento_ester_w		cm_conjunto_cont.dt_receb_ester%type;
nm_usuario_ester_w		cm_conjunto_cont.nm_usuario_ester%type;
nr_seq_ciclo_w			cm_conjunto_cont.nr_seq_ciclo%type;
dt_validade_w			cm_conjunto_cont.dt_validade%type;
nr_seq_conj_fisico_w		cm_conjunto_cont.nr_seq_conj_fisico%type;
dt_saida_w			cm_conjunto_cont.dt_saida%type;
nm_usuario_saida_w		cm_conjunto_cont.nm_usuario_saida%type;
nr_seq_agenda_w			cm_conjunto_cont.nr_seq_agenda%type;
cd_pessoa_fisica_w		cm_conjunto_cont.cd_pessoa_fisica%type;
cd_medico_w			cm_conjunto_cont.cd_medico%type;
cd_pessoa_resp_w			cm_conjunto_cont.cd_pessoa_resp%type;
cd_cgc_w			cm_conjunto_cont.cd_cgc%type;
cd_local_estoque_w		cm_conjunto_cont.cd_local_estoque%type;
dt_aloc_agenda_w			cm_conjunto_cont.dt_aloc_agenda%type;
nm_usuario_agenda_w		cm_conjunto_cont.nm_usuario_agenda%type;
dt_baixa_cirurgia_w			cm_conjunto_cont.dt_baixa_cirurgia%type;
nr_cirurgia_w			cm_conjunto_cont.nr_cirurgia%type;
cd_setor_atend_orig_w		cm_conjunto_cont.cd_setor_atend_orig%type;
cd_setor_atend_dest_w		cm_conjunto_cont.cd_setor_atend_dest%type;
qt_ponto_w			cm_conjunto_cont.qt_ponto%type;
vl_esterilizacao_w			cm_conjunto_cont.vl_esterilizacao%type;
cd_setor_atendimento_w		cm_conjunto_cont.cd_setor_atendimento%type;
nr_seq_cliente_w			cm_conjunto_cont.nr_seq_cliente%type;
nr_seq_controle_w			cm_conjunto_cont.nr_seq_controle%type;
nr_seq_lote_w			cm_conjunto_cont.nr_seq_lote%type;
ie_tipo_esterilizacao_w		cm_conjunto_cont.ie_tipo_esterilizacao%type;
ds_observacao_w			cm_conjunto_cont.ds_observacao%type;
ie_indeterminado_w		cm_conjunto_cont.ie_indeterminado%type;

BEGIN

select	cd_estabelecimento,
	nr_seq_conjunto,
	ie_status_conjunto,
	dt_origem,
	nm_usuario_origem,
	nr_seq_embalagem,
	dt_receb_ester,
	nm_usuario_ester,
	nr_seq_ciclo,
	dt_validade,
	nr_seq_conj_fisico,
	dt_saida,
	nm_usuario_saida,
	nr_seq_agenda,
	cd_pessoa_fisica,
	cd_medico,
	cd_cgc,
	cd_local_estoque,
	dt_aloc_agenda,
	nm_usuario_agenda,
	dt_baixa_cirurgia,
	nr_cirurgia,
	cd_setor_atend_orig,
	cd_setor_atend_dest,
	qt_ponto,
	vl_esterilizacao,
	cd_setor_atendimento,
	nr_seq_cliente,
	nr_seq_controle,
	cd_pessoa_resp,
	ie_tipo_esterilizacao,
	ds_observacao,
	ie_indeterminado
into STRICT	cd_estabelecimento_w,
	nr_seq_conjunto_w,
	ie_status_conjunto_w,
	dt_origem_w,
	nm_usuario_origem_w,
	nr_seq_embalagem_w,
	dt_recebimento_ester_w,
	nm_usuario_ester_w,
	nr_seq_ciclo_w,
	dt_validade_w,
	nr_seq_conj_fisico_w,
	dt_saida_w,
	nm_usuario_saida_w,
	nr_seq_agenda_w,
	cd_pessoa_fisica_w,
	cd_medico_w,
	cd_cgc_w,
	cd_local_estoque_w,
	dt_aloc_agenda_w,
	nm_usuario_agenda_w,
	dt_baixa_cirurgia_w,
	nr_cirurgia_w,
	cd_setor_atend_orig_w,
	cd_setor_atend_dest_w,
	qt_ponto_w,
	vl_esterilizacao_w,
	cd_setor_atendimento_w,
	nr_seq_cliente_w,
	nr_seq_controle_w,
	cd_pessoa_resp_w,
	ie_tipo_esterilizacao_w,
	ds_observacao_w,
	ie_indeterminado_w
from	cm_conjunto_cont
where	nr_sequencia	= nr_seq_cont_p
and	coalesce(ie_situacao,'A') = 'A';

if (nr_seq_lote_p <> 0) then
	nr_seq_lote_w := nr_seq_lote_p;
end if;


for	i in 1 .. qt_duplicar_p loop
	begin

	select	nextval('cm_conjunto_cont_seq')
	into STRICT	nr_sequencia_w
	;

	insert	into cm_conjunto_cont(nr_sequencia,
		cd_estabelecimento,
		nr_seq_conjunto,
		dt_atualizacao,
		nm_usuario,
		ie_status_conjunto,
		dt_origem,
		nm_usuario_origem,
		nr_seq_embalagem,
		dt_receb_ester,
		nm_usuario_ester,
		nr_seq_ciclo,
		dt_validade,
		nr_seq_conj_fisico,
		dt_saida,
		nm_usuario_saida,
		nr_seq_agenda,
		cd_pessoa_fisica,
		cd_medico,
		cd_cgc,
		cd_local_estoque,
		dt_aloc_agenda,
		nm_usuario_agenda,
		dt_baixa_cirurgia,
		nr_cirurgia,
		cd_setor_atend_orig,
		cd_setor_atend_dest,
		qt_ponto,
		vl_esterilizacao,
		cd_setor_atendimento,
		nr_seq_cliente,
		nr_seq_controle,
		nr_seq_lote,
		cd_pessoa_resp,
		ie_tipo_esterilizacao,
		ds_observacao,
		ie_situacao,
		nr_seq_conj_origem,
		ie_indeterminado)
	values (nr_sequencia_w,
		cd_estabelecimento_w,
		nr_seq_conjunto_w,
		clock_timestamp(),
		nm_usuario_p,
		ie_status_conjunto_w,
		dt_origem_w,
		nm_usuario_origem_w,
		nr_seq_embalagem_w,
		dt_recebimento_ester_w,
		nm_usuario_ester_w,
		nr_seq_ciclo_w,
		dt_validade_w,
		nr_seq_conj_fisico_w,
		dt_saida_w,
		nm_usuario_saida_w,
		nr_seq_agenda_w,
		cd_pessoa_fisica_w,
		cd_medico_w,
		cd_cgc_w,
		cd_local_estoque_w,
		dt_aloc_agenda_w,
		nm_usuario_agenda_w,
		dt_baixa_cirurgia_w,
		nr_cirurgia_w,
		cd_setor_atend_orig_w,
		cd_setor_atend_dest_w,
		qt_ponto_w,
		vl_esterilizacao_w,
		cd_setor_atendimento_w,
		nr_seq_cliente_w,
		nr_seq_controle_w,
		nr_seq_lote_w,
		cd_pessoa_resp_w,
		ie_tipo_esterilizacao_w,
		ds_observacao_w,
		'A',
		nr_seq_cont_p,
		ie_indeterminado_w);
	end;
	CALL cme_incluir_itens_controle(nr_sequencia_w, nm_usuario_p);
end loop;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cme_duplicar_conjunto_cont ( nr_seq_cont_p bigint, qt_duplicar_p bigint, nr_seq_lote_p bigint, nm_usuario_p text) FROM PUBLIC;

