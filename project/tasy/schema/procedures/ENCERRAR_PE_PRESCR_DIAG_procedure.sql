-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE encerrar_pe_prescr_diag (nr_sequencia_p bigint, ds_motivo_p text) AS $body$
DECLARE

    dt_end_w        pe_prescr_diag.dt_end%type := clock_timestamp();


BEGIN
    update  patient_cp_intervention
    set     dt_end = dt_end_w
    where   coalesce(dt_end::text, '') = ''
    and     nr_seq_pat_cp_interv_plan in (SELECT nr_sequencia
                                            from    patient_cp_interv_plan
                                            where   nr_seq_prescr_diag = nr_sequencia_p);

    update  patient_cp_interv_plan
    set     dt_end = dt_end_w
    where   coalesce(dt_end::text, '') = ''
    and     nr_seq_prescr_diag = nr_sequencia_p;

    update  patient_cp_indicator
    set     dt_end = dt_end_w
    where   coalesce(dt_end::text, '') = ''
    and     nr_seq_pat_cp_goal in (SELECT nr_sequencia
                                    from    patient_cp_goal
                                    where   nr_seq_prescr_diag = nr_sequencia_p);

    update  patient_cp_goal
    set     dt_end = dt_end_w
    where   coalesce(dt_end::text, '') = ''
    and     nr_seq_prescr_diag = nr_sequencia_p;

    update  pe_prescr_proc
    set     dt_fim = dt_end_w
    where   coalesce(dt_fim::text, '') = ''
    and     nr_seq_rel_diag = nr_sequencia_p;

    update  pe_prescr_proc
    set     dt_fim = dt_end_w
    where   coalesce(dt_fim::text, '') = ''
    and     ie_related_problem = nr_sequencia_p;

    update  pe_prescr_diag
    set     ds_motivo = ds_motivo_p,
			dt_end = dt_end_w
    where   coalesce(dt_end::text, '') = ''
    and     nr_sequencia = nr_sequencia_p;

    commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE encerrar_pe_prescr_diag (nr_sequencia_p bigint, ds_motivo_p text) FROM PUBLIC;

