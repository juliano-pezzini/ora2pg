-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE tiss_baca_atualizar_cid () AS $body$
DECLARE


nr_interno_conta_w	bigint;

CD_CID_w		varchar(10);
CD_CID_2_w		varchar(10);
CD_CID_3_w		varchar(10);
CD_CID_4_w		varchar(10);
CD_CID_OBITO_w		varchar(10);
CD_TABELA_CID_w		varchar(10);
DS_CID_w		varchar(255);
IE_TIPO_CID_w		varchar(5);
IE_UNIDADE_TEMPO_CID_w	varchar(10);
QT_TEMPO_CID_w		bigint;
CD_TABELA_CID_2_w	varchar(10);
DS_CID_2_w		varchar(255);
CD_TABELA_CID_OBITO_w	varchar(20);
DS_CID_OBITO_w		varchar(255);

c01 CURSOR FOR
SELECT	a.nr_interno_conta,
	a.CD_CID,
	a.CD_CID_2,
	a.CD_CID_3,
	a.CD_CID_4,
	a.CD_CID_OBITO,
	a.CD_TABELA_CID,
	a.DS_CID,
	a.IE_TIPO_CID,
	a.IE_UNIDADE_TEMPO_CID,
	a.QT_TEMPO_CID,
	a.CD_TABELA_CID_2,
	a.DS_CID_2,
	a.CD_TABELA_CID_OBITO,
	a.DS_CID_OBITO
from	tiss_conta_atend a
where	(a.cd_cid IS NOT NULL AND a.cd_cid::text <> '')
and	exists (select	1
	from	tiss_conta_guia x
	where	x.nr_interno_conta	= a.nr_interno_conta
	and	coalesce(x.cd_cid::text, '') = '');


BEGIN

open c01;
loop
fetch c01 into
	nr_interno_conta_w,
	CD_CID_w,
	CD_CID_2_w,
	CD_CID_3_w,
	CD_CID_4_w,
	CD_CID_OBITO_w,
	CD_TABELA_CID_w,
	DS_CID_w,
	IE_TIPO_CID_w,
	IE_UNIDADE_TEMPO_CID_w,
	QT_TEMPO_CID_w,
	CD_TABELA_CID_2_w,
	DS_CID_2_w,
	CD_TABELA_CID_OBITO_w,
	DS_CID_OBITO_w;
EXIT WHEN NOT FOUND; /* apply on c01 */

	update	tiss_conta_guia
	set	CD_CID			= coalesce(CD_CID, CD_CID_w),
		CD_CID_2		= coalesce(CD_CID_2, CD_CID_2_w),
		CD_CID_3		= coalesce(CD_CID_3, CD_CID_3_w),
		CD_CID_4		= coalesce(CD_CID_4, CD_CID_4_w),
		CD_CID_OBITO		= coalesce(CD_CID_OBITO, CD_CID_OBITO_w),
		CD_TABELA_CID		= coalesce(CD_TABELA_CID, CD_TABELA_CID_w),
		DS_CID			= coalesce(DS_CID, DS_CID_w),
		IE_TIPO_CID		= coalesce(IE_TIPO_CID, IE_TIPO_CID_w),
		IE_UNIDADE_TEMPO_CID	= coalesce(IE_UNIDADE_TEMPO_CID, IE_UNIDADE_TEMPO_CID_w),
		QT_TEMPO_CID		= coalesce(QT_TEMPO_CID, QT_TEMPO_CID_w),
		CD_TABELA_CID_2		= coalesce(CD_TABELA_CID_2, CD_TABELA_CID_2_w),
		DS_CID_2		= coalesce(DS_CID_2, DS_CID_2_w),
		CD_TABELA_CID_OBITO	= coalesce(CD_TABELA_CID_OBITO, CD_TABELA_CID_OBITO_w),
		DS_CID_OBITO		= coalesce(DS_CID_OBITO, DS_CID_OBITO_w)
	where	nr_interno_conta	= nr_interno_conta_w;

	commit;

end loop;
close c01;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tiss_baca_atualizar_cid () FROM PUBLIC;

