-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_ihc_service_response ( nr_seq_response_p bigint, cd_service_p text, ds_service_p text, dt_end_p timestamp, dt_from_p timestamp, dt_service_p timestamp, qt_service_p bigint, vl_charge_p text, vl_fund_benefit_p bigint, nm_usuario_p text) AS $body$
DECLARE

nm_usuario_w ihc_service_response.nm_usuario%type;

BEGIN

select 	max(nm_usuario)
into STRICT 	nm_usuario_w
from 	sts_response
where 	cd_transaction = (SELECT max(a.cd_transaction) from ihc_response a where a.nr_sequencia = nr_seq_response_p)
and 	cd_process_status = 'COMPLETE';

insert into ihc_service_response( cd_service,
				  ds_service,
				  dt_end,
				  dt_from,
				  dt_service,
				  qt_service,
				  vl_charge,
				  vl_fund_benefit,
				  dt_atualizacao,
				  dt_atualizacao_nrec,
				  nm_usuario,
				  nm_usuario_nrec,
                                  nr_seq_response,
				  nr_sequencia)
			values (	  cd_service_p,
				  ds_service_p,
				  dt_end_p,
				  dt_from_p,
				  dt_service_p,
				  qt_service_p,
				  vl_charge_p,
				  vl_fund_benefit_p,
				  clock_timestamp(),
				  clock_timestamp(),
				  coalesce(nm_usuario_p, nm_usuario_w),
				  coalesce(nm_usuario_p, nm_usuario_w),
				  nr_seq_response_p,
				  nextval('ihc_service_response_seq'));
			
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_ihc_service_response ( nr_seq_response_p bigint, cd_service_p text, ds_service_p text, dt_end_p timestamp, dt_from_p timestamp, dt_service_p timestamp, qt_service_p bigint, vl_charge_p text, vl_fund_benefit_p bigint, nm_usuario_p text) FROM PUBLIC;

