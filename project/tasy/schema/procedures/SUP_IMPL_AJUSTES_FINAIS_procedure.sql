-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE sup_impl_ajustes_finais ( ie_tipo_p bigint, dt_mesano_referencia_p timestamp) AS $body$
DECLARE

 
 
dt_mesano_referencia_w		timestamp;
dt_mesano_referencia_ww		timestamp;
cd_estabelecimento_w		smallint;

 

BEGIN 
 
select	max(cd_estabelecimento) 
into STRICT	cd_estabelecimento_w 
from	sup_impl_estoque;
 
dt_mesano_referencia_w	:= trunc(dt_mesano_referencia_p,'mm');
dt_mesano_referencia_ww	:= trunc(clock_timestamp(),'mm');
 
 
CALL valorizar_estoque(dt_mesano_referencia_w, cd_estabelecimento_w, 'N', 'Carga');
CALL gerar_resumo_movto_estoque(dt_mesano_referencia_w, cd_estabelecimento_w, 'Carga');
if (dt_mesano_referencia_w <> dt_mesano_referencia_ww) then 
	CALL valorizar_estoque(dt_mesano_referencia_ww, cd_estabelecimento_w, 'N', 'Carga');
	CALL gerar_resumo_movto_estoque(dt_mesano_referencia_ww, cd_estabelecimento_w, 'Carga');
end if;
 
 
if (ie_tipo_p = 5) then 
	CALL calcular_ponto_pedido(cd_estabelecimento_w, 0, dt_mesano_referencia_w, null, null, null, null, null, 'Carga');
end if;
 
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE sup_impl_ajustes_finais ( ie_tipo_p bigint, dt_mesano_referencia_p timestamp) FROM PUBLIC;

