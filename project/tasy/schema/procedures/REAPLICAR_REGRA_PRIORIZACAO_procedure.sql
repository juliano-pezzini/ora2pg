-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE reaplicar_regra_priorizacao (nr_seq_regulacao_p bigint, cd_motivo_p bigint, nr_seq_list_esp_p bigint, nm_usuario_p text) AS $body$
DECLARE


dt_atualizacao_w				regulacao_status.dt_atualizacao_nrec%type;


BEGIN

	if (nr_seq_regulacao_p IS NOT NULL AND nr_seq_regulacao_p::text <> '') and (nr_seq_list_esp_p IS NOT NULL AND nr_seq_list_esp_p::text <> '') then
		begin

			select	max(dt_atualizacao_nrec)
			into STRICT	dt_atualizacao_w
			from	regulacao_status
			where	nr_seq_regulacao_atend = nr_seq_regulacao_p
			and		ie_status = 'FA';
			
			if (dt_atualizacao_w IS NOT NULL AND dt_atualizacao_w::text <> '') then
				begin

					update  agenda_lista_espera
					set     dt_entrada_lista = dt_atualizacao_w
					where   nr_sequencia = nr_seq_list_esp_p;

					CALL alterar_status_regulacao(nr_seq_regulacao_p, 'FA', obter_expressao_dic_objeto(cd_motivo_p), obter_pessoa_fisica_usuario(nm_usuario_p, null));

				end;
			end if;
		end;
	end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE reaplicar_regra_priorizacao (nr_seq_regulacao_p bigint, cd_motivo_p bigint, nr_seq_list_esp_p bigint, nm_usuario_p text) FROM PUBLIC;

