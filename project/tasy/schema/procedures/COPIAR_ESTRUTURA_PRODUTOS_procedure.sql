-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copiar_estrutura_produtos ( nr_sequencia_p bigint, nm_usuario_p text) AS $body$
DECLARE


produto_sequence_w		bigint;
area_sequence_w			bigint;
modulo_sequence_w		bigint;
funcao_sequence_w		bigint;
produto_requisito_sequence_w	bigint;
nr_seq_area_prod_w		bigint;
nr_seq_modulo_area_w		bigint;
cd_funcao_w			bigint;
nr_seq_area_w			bigint;
nr_seq_modulo_w			bigint;


C01 CURSOR FOR
	SELECT	nr_sequencia seq_area,
		nr_seq_area
	from	mkt_produto_area
	where	nr_seq_produto = nr_sequencia_p
	order by nr_sequencia;

C02 CURSOR FOR
	SELECT	nr_sequencia seq_modulo,
		nr_seq_modulo
	from	mkt_area_modulo
	where	nr_seq_prod_area = nr_seq_area_prod_w
	order by nr_sequencia;

C03 CURSOR FOR
	SELECT	nr_sequencia seq_funcao,
		cd_funcao
	from	mkt_modulo_funcao
	where	nr_seq_area_modulo = nr_seq_modulo_area_w
	order by nr_sequencia;

C04 CURSOR FOR
	SELECT	nr_sequencia seq_requisito
	from	mkt_produto_requisito
	where	nr_seq_produto = nr_sequencia_p
	order by nr_sequencia;
BEGIN

select	nextval('mkt_produto_seq')
into STRICT	produto_sequence_w
;


/* insert produto*/

insert	into	mkt_produto(	nr_sequencia,
				ds_produto,
				ds_versao_produto,
				cd_exp_produto,
				dt_atualizacao,
				dt_atualizacao_nrec,
				nm_usuario,
				nm_usuario_nrec)
	SELECT	produto_sequence_w ,
		ds_produto,
		ds_versao_produto,
		cd_exp_produto,
		clock_timestamp(),
		clock_timestamp(),
		nm_usuario_p,
		nm_usuario_p
	from	mkt_produto
	where	nr_sequencia = nr_sequencia_p;

	CALL copia_campo_long('MKT_PRODUTO','DS_OBSERVACAO','WHERE NR_SEQUENCIA = :NR_SEQUENCIA',
								 'NR_SEQUENCIA='||nr_sequencia_p,'NR_SEQUENCIA='||produto_sequence_w);

/* insert mercado produto*/

insert	into	mkt_produto_mercado(	nr_sequencia,
					dt_atualizacao,
					dt_atualizacao_nrec,
					nm_usuario,
					nm_usuario_nrec,
					nr_seq_mercado,
					nr_seq_produto)
	SELECT	nextval('mkt_produto_mercado_seq'),
		clock_timestamp(),
		clock_timestamp(),
		nm_usuario_p,
		nm_usuario_p,
		nr_seq_mercado,
		produto_sequence_w
	from	mkt_produto_mercado
	where	nr_seq_produto = nr_sequencia_p;

/* insert core funcao*/

insert	into	mkt_prod_core_funcao(	nr_sequencia,
					dt_atualizacao,
					dt_atualizacao_nrec,
					nm_usuario,
					nm_usuario_nrec,
					nr_seq_produto,
					cd_funcao)
	SELECT	nextval('mkt_prod_core_funcao_seq'),
		clock_timestamp(),
		clock_timestamp(),
		nm_usuario_p,
		nm_usuario_p,
		produto_sequence_w,
		cd_funcao
	from	mkt_prod_core_funcao
	where	nr_seq_produto = nr_sequencia_p;

for r_c04 in c04 loop

select	nextval('mkt_produto_requisito_seq')
into STRICT	produto_requisito_sequence_w
;

/* insert requisitos */

insert	into	mkt_produto_requisito(	nr_sequencia,
					dt_atualizacao,
					dt_atualizacao_nrec,
					nm_usuario,
					nm_usuario_nrec,
					nr_seq_produto)
	values (produto_requisito_sequence_w,
		clock_timestamp(),
		clock_timestamp(),
		nm_usuario_p,
		nm_usuario_p,
		produto_sequence_w);


	CALL copia_campo_long('mkt_produto_requisito','DS_REQUISITOS','WHERE NR_SEQUENCIA = :NR_SEQUENCIA',
								 'NR_SEQUENCIA='||r_c04.seq_requisito,'NR_SEQUENCIA='||produto_requisito_sequence_w);


end loop;

for r_c01 in c01 loop

select	nextval('mkt_produto_area_seq'),
	nr_seq_area
into STRICT	area_sequence_w,
	nr_seq_area_w
from	mkt_produto_area
where	nr_seq_produto = nr_sequencia_p
and	nr_seq_area = r_c01.nr_seq_area;


/* insert area */

insert	into	mkt_produto_area(	nr_sequencia,
					dt_atualizacao,
					dt_atualizacao_nrec,
					nm_usuario,
					nm_usuario_nrec,
					nr_seq_produto,
					nr_seq_area )
	values (	area_sequence_w,
		clock_timestamp(),
		clock_timestamp(),
		nm_usuario_p,
		nm_usuario_p,
		produto_sequence_w,
		nr_seq_area_w);



insert	into	mkt_area_mercado(	nr_sequencia,
					dt_atualizacao,
					dt_atualizacao_nrec,
					nm_usuario,
					nm_usuario_nrec,
					nr_seq_area,
					nr_seq_mercado)
	SELECT	nextval('mkt_area_mercado_seq'),
		clock_timestamp(),
		clock_timestamp(),
		nm_usuario_p,
		nm_usuario_p,
		area_sequence_w,
		nr_seq_mercado
	from  	mkt_area_mercado
	where 	nr_seq_area = r_c01.seq_area;

	nr_seq_area_prod_w := r_c01.seq_area;

	for r_c02 in c02 loop


	select	nextval('mkt_area_modulo_seq'),
		nr_seq_area,
		nr_seq_modulo
	into STRICT	modulo_sequence_w,
		nr_seq_area_w,
		nr_seq_modulo_w
	from	mkt_area_modulo
	where	nr_seq_prod_area = r_c01.seq_area
	and	nr_seq_modulo = r_c02.nr_seq_modulo;

	insert	into	mkt_area_modulo(	nr_sequencia,
						dt_atualizacao,
						dt_atualizacao_nrec,
						nm_usuario,
						nm_usuario_nrec,
						nr_seq_area,
						nr_seq_modulo,
						nr_seq_prod_area)
		values (	modulo_sequence_w,
			clock_timestamp(),
			clock_timestamp(),
			nm_usuario_p,
			nm_usuario_p,
			nr_seq_area_w,
			nr_seq_modulo_w,
			area_sequence_w);


	insert	into	mkt_modulo_mercado(	nr_sequencia,
						dt_atualizacao,
						dt_atualizacao_nrec,
						nm_usuario,
						nm_usuario_nrec,
						nr_seq_modulo,
						nr_seq_mercado)
		SELECT	nextval('mkt_modulo_mercado_seq'),
			clock_timestamp(),
			clock_timestamp(),
			nm_usuario_p,
			nm_usuario_p,
			modulo_sequence_w,
			nr_seq_mercado
		from	mkt_modulo_mercado
		where	nr_seq_modulo = r_c02.seq_modulo;


	insert	into	mkt_modulo_indicador(	nr_sequencia,
						dt_atualizacao,
						dt_atualizacao_nrec,
						nm_usuario,
						nm_usuario_nrec,
						nr_seq_modulo,
						nr_seq_indicador )
		SELECT	nextval('mkt_modulo_indicador_seq'),
			clock_timestamp(),
			clock_timestamp(),
			nm_usuario_p,
			nm_usuario_p,
			modulo_sequence_w,
			nr_seq_indicador
		from	mkt_modulo_indicador
		where	nr_seq_modulo = r_c02.seq_modulo;


	insert	into	mkt_modulo_integracao(	nr_sequencia,
						dt_atualizacao,
						dt_atualizacao_nrec,
						nm_usuario,
						nm_usuario_nrec,
						nr_seq_modulo,
						nr_seq_integracao)
		SELECT	nextval('mkt_modulo_integracao_seq'),
			clock_timestamp(),
			clock_timestamp(),
			nm_usuario_p,
			nm_usuario_p,
			modulo_sequence_w,
			nr_seq_integracao
		from	mkt_modulo_integracao
		where	nr_seq_modulo = r_c02.seq_modulo;


	insert	into	mkt_modulo_tabela(	nr_sequencia,
						dt_atualizacao,
						dt_atualizacao_nrec,
						nm_usuario,
						nm_usuario_nrec,
						nr_seq_modulo,
						nm_tabela)
		SELECT	nextval('mkt_modulo_tabela_seq'),
			clock_timestamp(),
			clock_timestamp(),
			nm_usuario_p,
			nm_usuario_p,
			modulo_sequence_w,
			nm_tabela
		from	mkt_modulo_tabela
		where	nr_seq_modulo = r_c02.seq_modulo;


	insert	into	mkt_modulo_relatorio(	nr_sequencia,
						dt_atualizacao,
						dt_atualizacao_nrec,
						nm_usuario,
						nm_usuario_nrec,
						nr_seq_modulo,
						nr_seq_relatorio)
		SELECT	nextval('mkt_modulo_relatorio_seq'),
			clock_timestamp(),
			clock_timestamp(),
			nm_usuario_p,
			nm_usuario_p,
			modulo_sequence_w,
			nr_seq_relatorio
		from	mkt_modulo_relatorio
		where	nr_seq_modulo = r_c02.seq_modulo;

	nr_seq_modulo_area_w := r_c02.seq_modulo;

	for r_c03 in c03 loop

		select	nextval('mkt_modulo_funcao_seq'),
			cd_funcao
		into STRICT	funcao_sequence_w,
			cd_funcao_w
		from	mkt_modulo_funcao
		where	nr_seq_area_modulo =  r_c02.seq_modulo
		and	cd_funcao = r_c03.cd_funcao;


		insert	into	mkt_modulo_funcao(	nr_sequencia,
							dt_atualizacao,
							dt_atualizacao_nrec,
							nm_usuario,
							nm_usuario_nrec,
							cd_funcao,
							nr_seq_area_modulo)
			values (	funcao_sequence_w,
				clock_timestamp(),
				clock_timestamp(),
				nm_usuario_p,
				nm_usuario_p,
				cd_funcao_w,
				modulo_sequence_w);


		insert	into	mkt_funcao_mercado(	nr_sequencia,
							dt_atualizacao,
							dt_atualizacao_nrec,
							nm_usuario,
							nm_usuario_nrec,
							nr_seq_mod_fun,
							nr_seq_mercado )
			SELECT	nextval('mkt_funcao_mercado_seq'),
				clock_timestamp(),
				clock_timestamp(),
				nm_usuario_p,
				nm_usuario_p,
				funcao_sequence_w,
				nr_seq_mercado
			from	mkt_funcao_mercado
			where	nr_seq_mod_fun = r_c03.seq_funcao;

		end loop;

	end loop;

end loop;

commit;



end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copiar_estrutura_produtos ( nr_sequencia_p bigint, nm_usuario_p text) FROM PUBLIC;

