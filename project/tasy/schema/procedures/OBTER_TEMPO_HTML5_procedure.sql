-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_tempo_html5 ( ie_tipo_componente_p text, nm_tabela_p text, nr_seq_visao_p bigint, cd_codigo_p bigint, nr_seq_legenda_p bigint, qt_colunas_grid_p INOUT bigint, qt_campos_detalhe_p INOUT bigint, qt_menu_itens_p INOUT bigint, qt_param_ativacao_p INOUT bigint, qt_niveis_tree_p INOUT bigint, qt_grupos_wscb_p INOUT bigint, ie_ativa_action_p INOUT text, ie_existe_regra_p INOUT text) AS $body$
DECLARE


qt_colunas_grid_w 		bigint := -1;
qt_campos_detalhe_w		bigint := -1;
qt_menu_itens_w			bigint := -1;
qt_param_ativacao_w		bigint := -1;
qt_niveis_tree_w		bigint := -1;
qt_grupos_wscb_w		bigint := -1;
ie_ativa_action_w	   varchar(1) := 'N';
ie_existe_regra_w	   varchar(1) := 'N';

BEGIN
if (ie_tipo_componente_p IS NOT NULL AND ie_tipo_componente_p::text <> '') then
	begin
	if (ie_tipo_componente_p = 'WCPanel') then
		begin
		if (cd_codigo_p IS NOT NULL AND cd_codigo_p::text <> '') then
			begin
			if (cd_codigo_p > 0) then
				begin
				select	count(*)
				into STRICT	qt_colunas_grid_w
				from	dic_objeto
				where	nr_seq_obj_sup = cd_codigo_p;

				select	length(ds_sql) - length(replace(ds_sql,':',''))
				into STRICT	qt_param_ativacao_w
				from	dic_objeto
				where	nr_sequencia = cd_codigo_p;
				end;
			else
				begin
				qt_colunas_grid_w  	:= 0;
				qt_param_ativacao_w := 0;
				end;
			end if;
			end;
		end if;
		end;
	elsif (ie_tipo_componente_p = 'WDBPanel') then
		begin
		if (nm_tabela_p IS NOT NULL AND nm_tabela_p::text <> '') then
			begin
			if (nr_seq_visao_p IS NOT NULL AND nr_seq_visao_p::text <> '') and (nr_seq_visao_p > 0) then
				begin
				select	count(*)
				into STRICT	qt_campos_detalhe_w
				from	tabela_visao_atributo
				where	nr_sequencia = nr_seq_visao_p
				and		(nr_seq_apresent IS NOT NULL AND nr_seq_apresent::text <> '')
				and ((cd_exp_label IS NOT NULL AND cd_exp_label::text <> '')
							or (ds_label IS NOT NULL AND ds_label::text <> ''));

				select	count(*)
				into STRICT	qt_colunas_grid_w
				from	tabela_visao_atributo
				where	nr_sequencia = nr_seq_visao_p
				and ((nr_seq_apresent IS NOT NULL AND nr_seq_apresent::text <> '')
							or (nr_seq_grid IS NOT NULL AND nr_seq_grid::text <> ''))
				and ((cd_exp_label_grid IS NOT NULL AND cd_exp_label_grid::text <> '')
							or (ds_label_grid IS NOT NULL AND ds_label_grid::text <> ''));

				select	length(ds_sql_ativacao) - length(replace(ds_sql_ativacao,':',''))
				into STRICT	qt_param_ativacao_w
				from	tabela_visao
				where	nr_sequencia = nr_seq_visao_p;
				end;
			else
				begin
				select	count(*)
				into STRICT	qt_campos_detalhe_w
				from	tabela_atributo
				where	nm_tabela = nm_tabela_p
				and		(nr_seq_apresent IS NOT NULL AND nr_seq_apresent::text <> '')
				and ((cd_exp_label IS NOT NULL AND cd_exp_label::text <> '')
							or (ds_label IS NOT NULL AND ds_label::text <> ''));

				select	count(*)
				into STRICT	qt_colunas_grid_w
				from	tabela_atributo
				where	nm_tabela = nm_tabela_p
				and ((nr_seq_apresent IS NOT NULL AND nr_seq_apresent::text <> '')
							or (nr_seq_grid IS NOT NULL AND nr_seq_grid::text <> ''))
				and ((cd_exp_label_grid IS NOT NULL AND cd_exp_label_grid::text <> '')
							or (ds_label_grid IS NOT NULL AND ds_label_grid::text <> ''));
				end;
			end if;
			end;
		end if;
		end;
	elsif (ie_tipo_componente_p = 'WSelecaoCB') then
		begin
		if (cd_codigo_p IS NOT NULL AND cd_codigo_p::text <> '') then
			begin
			if (cd_codigo_p > 0) then
				begin
				select	count(*)
				into STRICT	qt_grupos_wscb_w
				from	dic_objeto
				where	nr_seq_obj_sup = cd_codigo_p
				and		ie_tipo_objeto = 'GCWSCB';

				select	length(ds_informacao) - length(replace(ds_informacao,':',''))
				into STRICT	qt_param_ativacao_w
				from	dic_objeto
				where	nr_sequencia = cd_codigo_p;

				select  qt_param_ativacao_w + count(*)
				into STRICT	qt_param_ativacao_w
				from	dic_objeto
				where	nr_seq_obj_sup = cd_codigo_p
				and		ie_tipo_objeto = 'ACCWSCB';
				end;
			else
				begin
				qt_grupos_wscb_w 	:= 0;
				qt_param_ativacao_w := 0;
				end;
			end if;

			end;
		end if;
		end;
	elsif (ie_tipo_componente_p = 'WJPopUpMenu') then
		begin
		if (cd_codigo_p IS NOT NULL AND cd_codigo_p::text <> '') then
			begin
			select	count(*)
			into STRICT	qt_menu_itens_w
			from	dic_objeto
			where	nr_seq_obj_sup = cd_codigo_p;
			end;
		end if;
		end;
	elsif (ie_tipo_componente_p = 'WLegenda') then
		begin
		if (nr_seq_legenda_p IS NOT NULL AND nr_seq_legenda_p::text <> '') then
			begin
			select	CASE WHEN count(*)=0 THEN 'N'  ELSE 'S' END
			into STRICT	ie_existe_regra_w
			from	regra_condicao
			where	nr_seq_legenda = nr_seq_legenda_p;

			select	count(*)
			into STRICT	qt_campos_detalhe_w
			from	tasy_padrao_cor
			where	nr_seq_legenda = nr_seq_legenda_p;
			end;
		end if;
		end;
	elsif (ie_tipo_componente_p = 'WFiltro') then
		begin
		if (cd_codigo_p IS NOT NULL AND cd_codigo_p::text <> '') then
			begin
			select	count(*)
			into STRICT	qt_campos_detalhe_w
			from	dic_objeto_filtro
			where	nr_seq_objeto = cd_codigo_p;
			end;
		end if;
		end;
	elsif (ie_tipo_componente_p = 'WDetalhePanel') then
		begin
		if (cd_codigo_p IS NOT NULL AND cd_codigo_p::text <> '') then
			begin
			select	count(*)
			into STRICT	qt_campos_detalhe_w
			from	dic_objeto
			where	nr_seq_obj_sup = cd_codigo_p;

			select	length(ds_sql) - length(replace(ds_sql,':',''))
			into STRICT	qt_param_ativacao_w
			from	dic_objeto
			where	nr_sequencia = cd_codigo_p;
			end;
		end if;
		end;
	elsif (ie_tipo_componente_p = 'WJTreeNew') or (ie_tipo_componente_p = 'WJTree') then
		begin
		if (cd_codigo_p IS NOT NULL AND cd_codigo_p::text <> '') then
			begin
			select 	count(*)
			into STRICT	qt_niveis_tree_w
			from 	dic_objeto
			where	nr_seq_obj_sup = cd_codigo_p;

			select	count(*)
			into STRICT	qt_param_ativacao_w
			from	dic_objeto
			where	nr_seq_obj_sup in (
					SELECT 	x.nr_sequencia
					from	dic_objeto x
					where 	x.nr_seq_obj_sup = cd_codigo_p);

			if (qt_niveis_tree_w = 1) then
				begin
				select	length(ds_sql) - length(replace(upper(ds_sql),'@RESTRICAO',''))
				into STRICT	qt_campos_detalhe_w
				from	dic_objeto
				where	nr_seq_obj_sup = cd_codigo_p;

				if (qt_campos_detalhe_w > 0) then
					begin
					ie_ativa_action_w := 'S';
					end;
				end if;
				end;
			elsif (qt_niveis_tree_w = 0) then
				begin
				ie_ativa_action_w := 'S';
				end;
			end if;
			end;
		end if;
		end;
	end if;
	end;
end if;

commit;

qt_colunas_grid_p		:= qt_colunas_grid_w;
qt_campos_detalhe_p		:= qt_campos_detalhe_w;
qt_menu_itens_p			:= qt_menu_itens_w;
qt_param_ativacao_p		:= qt_param_ativacao_w;
qt_niveis_tree_p		:= qt_niveis_tree_w;
ie_ativa_action_p		:= ie_ativa_action_w;
ie_existe_regra_p		:= ie_existe_regra_w;
qt_grupos_wscb_p		:= qt_grupos_wscb_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_tempo_html5 ( ie_tipo_componente_p text, nm_tabela_p text, nr_seq_visao_p bigint, cd_codigo_p bigint, nr_seq_legenda_p bigint, qt_colunas_grid_p INOUT bigint, qt_campos_detalhe_p INOUT bigint, qt_menu_itens_p INOUT bigint, qt_param_ativacao_p INOUT bigint, qt_niveis_tree_p INOUT bigint, qt_grupos_wscb_p INOUT bigint, ie_ativa_action_p INOUT text, ie_existe_regra_p INOUT text) FROM PUBLIC;

