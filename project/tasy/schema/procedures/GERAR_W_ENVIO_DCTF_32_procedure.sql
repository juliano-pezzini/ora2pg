-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_w_envio_dctf_32 ( nr_seq_lote_p bigint, nm_usuario_p text) AS $body$
DECLARE


cd_natureza_juridica_w			varchar(4);
cd_contabilista_w			varchar(55);
nr_seq_envio_dctf_w			bigint;
cd_receita_w				varchar(12);
cd_receita_darf_w			varchar(10);
ds_bairro_w				varchar(20);
ds_complemento_w			varchar(21);
ds_crc_resp_w				varchar(15);
ds_email_w				varchar(40);
ds_email_representante_w		varchar(40);
ds_email_resp_w				varchar(40);
ds_hashcode_w				varchar(10);
ds_logradouro_w				varchar(40);
ds_municipio_w				varchar(50);
ds_numero_w				varchar(6);
ds_periodicidade_w			varchar(1);
ds_uf_caixa_postal_w			valor_dominio.vl_dominio%type;
ds_uf_crc_resp_w			valor_dominio.vl_dominio%type;
dt_apuracao_diario_w			varchar(4000);
dt_apur_diario_w			varchar(4000);
dt_apuracao_mensal_w			varchar(4000);
dt_fim_w				timestamp;
dt_inicio_w				timestamp;
dt_ocorrencia_evento_w			varchar(8);
dt_periodo_apuracao_w			timestamp;
dt_periodo_final_w			timestamp;
dt_periodo_inicial_w			timestamp;
dt_vencimento_w				timestamp;
ie_balanco_reducao_w			numeric(22);
ie_forma_tributacao_w			numeric(22);
ie_pj_balanco_w				numeric(22);
ie_pj_dctf_semestral_w			numeric(22);
ie_pj_inativa_w				numeric(22);
ie_pj_regime_especial_w			numeric(22);
ie_pj_scp_w				numeric(22);
ie_qualificacao_pj_w			numeric(22);
ie_saldo_quotas_w			numeric(22);
ie_situacao_w				varchar(1);
ie_tipo_w				varchar(3);
ie_tipo_declaracao_w			numeric(22);
ie_tipo_registro_w			numeric(22);
ie_criterio_rec_variacao_w		varchar(8);
ie_janeiro_w				varchar(8);
ie_fevereiro_w				varchar(8);
ie_marco_w				varchar(8);
ie_abril_w				varchar(8);
ie_maio_w				varchar(8);
ie_junho_w				varchar(8);
ie_julho_w				varchar(8);
ie_agosto_w				varchar(8);
ie_setembro_w				varchar(8);
ie_outubro_w				varchar(8);
ie_novembro_w				varchar(8);
ie_dezembro_w				varchar(8);
ie_regime_pis_cofins_w			bigint;
ie_iniciou_neste_mes_w			varchar(8);
ie_spc_inc_w				varchar(8);
nm_empresarial_w			varchar(255);
nm_representante_w			varchar(60);
nm_responsavel_w			varchar(60);
nr_ano_apuracao_w			timestamp;
nr_ano_declaracao_w			timestamp;
nr_caixa_postal_w			varchar(1);
nr_cep_w				varchar(8);
nr_cep_caixa_postal_w			varchar(8);
nr_cnpj_w				varchar(14);
nr_cnpj_darf_w				varchar(14);
nr_cnpj_incorporacao_w			varchar(14);
nr_cpf_representante_w			varchar(11);
nr_cpf_resp_w				varchar(11);
nr_ddd_fax_w				varchar(3);
nr_ddd_fax_representante_w		varchar(3);
nr_ddd_fax_resp_w			varchar(3);
nr_ddd_telefone_w			varchar(3);
nr_ddd_telefone_repr_w			varchar(3);
nr_ddd_telefone_resp_w			varchar(3);
nr_declaracao_w				numeric(22);
nr_fax_w				varchar(4000);
nr_fax_representante_w			varchar(4000);
nr_fax_resp_w				varchar(4000);
nr_grupo_tributo_w			varchar(2);
nr_mes_declaracao_w			timestamp;
nr_mes_ocorrencia_w			timestamp;
nr_ordem_estab_w			varchar(6);
nr_quota_w				numeric(22);
nr_ramal_representante_w		varchar(5);
nr_ramal_resp_w				varchar(5);
nr_recibo_w				varchar(255);
nr_referencia_w				varchar(20);
nr_seq_lote_w				bigint;
nr_telefone_w				varchar(4000);
nr_telefone_representante_w		varchar(4000);
nr_telefone_resp_w			varchar(4000);
nr_trimestre_apuracao_w			numeric(22);
nr_versao_w				numeric(22);
qt_registros_w				numeric(22);
sg_uf_w					valor_dominio.vl_dominio%type;
vl_debito_w				double precision;
vl_juros_w				double precision;
vl_multa_w				double precision;
vl_pago_debito_w			varchar(40);
vl_principal_w				double precision;
ds_registro_w				varchar(40);
nr_seq_darf_w				bigint;
cd_tipo_credito_w			varchar(255);
cd_processo_dcomp_w			varchar(255);
cd_formailizacao_pedido_w		bigint;
nr_crc_w				varchar(15);

c01 CURSOR FOR
SELECT	1
	ie_tipo_registro,
	a.nr_sequencia					nr_seq_lote,
	'DCTFM'						ds_registro,
	CASE WHEN a.ie_retificadora='N' THEN  0 WHEN a.ie_retificadora='S' THEN  1 END  ie_tipo_declaracao,
	b.cd_cgc 	nr_cnpj,
	320 		nr_versao,
	SUBSTR(obter_nome_empresa(b.cd_empresa),1,255) nm_empresarial,
	SUBSTR(obter_dados_pf_pj(null,b.cd_cgc,'UF'),1,2) sg_uf,
	a.ie_finalidade_dctf	ie_situacao,
	a.dt_referencia	nr_ano_declaracao,
	a.dt_referencia	nr_mes_declaracao,
	trunc(a.dt_referencia,'mm')  dt_periodo_inicial,
	trunc(fim_mes(a.dt_referencia),'dd') dt_periodo_final,
	CASE WHEN a.ie_finalidade_dctf=00 THEN '00000000'  ELSE clock_timestamp() END  dt_ocorrencia_evento,
	' ' ie_tipo,
	clock_timestamp() nr_mes_ocorrencia,
	clock_timestamp() dt_inicio,
	clock_timestamp() dt_fim,
	0 nr_declaracao,
	' ' nr_recibo,
	0 ie_forma_tributacao,
	0 ie_qualificacao_pj,
	0 ie_pj_balanco,
	0 ie_pj_scp,
	0 ie_pj_inativa,
	0 ie_pj_regime_especial,
	0 ie_pj_dctf_semestral,
	coalesce(ie_criterio_rec_variacao,0) ie_criterio_rec_variacao,
	CASE WHEN coalesce(ie_janeiro::text, '') = '' THEN 0 WHEN ie_janeiro='N' THEN 0 WHEN ie_janeiro='S' THEN 1 END  ie_janeiro,
	CASE WHEN coalesce(ie_fevereiro::text, '') = '' THEN 0 WHEN ie_fevereiro='N' THEN 0 WHEN ie_fevereiro='S' THEN 1 END  ie_fevereiro,
	CASE WHEN coalesce(ie_marco::text, '') = '' THEN 0 WHEN ie_marco='N' THEN 0 WHEN ie_marco='S' THEN 1 END  ie_marco,
	CASE WHEN coalesce(ie_abril::text, '') = '' THEN 0 WHEN ie_abril='N' THEN 0 WHEN ie_abril='S' THEN 1 END  ie_abril,
	CASE WHEN coalesce(ie_maio::text, '') = '' THEN 0 WHEN ie_maio='N' THEN 0 WHEN ie_maio='S' THEN 1 END  ie_maio,
	CASE WHEN coalesce(ie_junho::text, '') = '' THEN 0 WHEN ie_junho='N' THEN 0 WHEN ie_junho='S' THEN 1 END  ie_junho,
	CASE WHEN coalesce(ie_julho::text, '') = '' THEN 0 WHEN ie_julho='N' THEN 0 WHEN ie_julho='S' THEN 1 END  ie_julho,
	CASE WHEN coalesce(ie_agosto::text, '') = '' THEN 0 WHEN ie_agosto='N' THEN 0 WHEN ie_agosto='S' THEN 1 END  ie_agosto,
	CASE WHEN coalesce(ie_setembro::text, '') = '' THEN 0 WHEN ie_setembro='N' THEN 0 WHEN ie_setembro='S' THEN 1 END  ie_setembro,
	CASE WHEN coalesce(ie_outubro::text, '') = '' THEN 0 WHEN ie_outubro='N' THEN 0 WHEN ie_outubro='S' THEN 1 END  ie_outubro,
	CASE WHEN coalesce(ie_novembro::text, '') = '' THEN 0 WHEN ie_novembro='N' THEN 0 WHEN ie_novembro='S' THEN 1 END  ie_novembro,
	CASE WHEN coalesce(ie_dezembro::text, '') = '' THEN 0 WHEN ie_dezembro='N' THEN 0 WHEN ie_dezembro='S' THEN 1 END  ie_dezembro,
	coalesce(ie_regime_pis_cofins,0) ie_regime_pis_cofins,
	CASE WHEN coalesce(ie_iniciou_neste_mes::text, '') = '' THEN 0 WHEN ie_iniciou_neste_mes='N' THEN  0 WHEN ie_iniciou_neste_mes='S' THEN  1 WHEN ie_iniciou_neste_mes='E' THEN 2 WHEN ie_iniciou_neste_mes='P' THEN 3 WHEN ie_iniciou_neste_mes='J' THEN 4 END  ie_iniciou_neste_mes,
	' ' cd_natureza_juridica,
	' ' ds_logradouro,
	' ' ds_numero,
	' ' ds_complemento,
	' ' ds_bairro,
	' ' ds_municipio,
	' ' nr_cep,
	' ' nr_ddd_telefone,
	' ' nr_telefone,
	' ' nr_ddd_fax,
	' ' nr_fax,
	' ' nr_caixa_postal,
	' ' ds_uf_caixa_postal,
	' ' nr_cep_caixa_postal,
	' ' ds_email,
	' ' nm_representante,
	' ' nr_cpf_representante,
	' ' nr_ddd_telefone_representante,
	' ' nr_telefone_representante,
	' ' nr_ramal_representante,
	' ' nr_ddd_fax_representante,
	' ' nr_fax_representante,
	' ' ds_email_representante,
	' ' nm_responsavel,
	' ' nr_cpf_resp,
	' ' ds_crc_resp,
	' ' ds_uf_crc_resp,
	' ' nr_ddd_telefone_resp,
	' ' nr_telefone_resp,
	' ' nr_ramal_resp,
	' ' nr_ddd_fax_resp,
	' ' nr_fax_resp,
	' ' ds_email_resp,
	' ' nr_grupo_tributo,
	'0' cd_receita,
	' ' ds_periodicidade,
	clock_timestamp() nr_ano_apuracao,
	' ' dt_apuracao_mensal,
	' ' dt_apuracao_diario,
	' ' nr_ordem_estab,
	' ' nr_cnpj_incorporacao,
	0 vl_debito,
	0 ie_balanco_reducao,
	0 ie_saldo_quotas,
	clock_timestamp() dt_periodo_apuracao,
	' ' nr_cnpj_darf,
	'0' cd_receita_darf,
	clock_timestamp() dt_vencimento,
	' ' nr_referencia,
	0 vl_principal,
	0 vl_multa,
	0 vl_juros,
	0 vl_pago_debito,
	0 nr_trimestre_apuracao,
	0 nr_quota,
	0 qt_registros,
	' ' ds_hashcode
from	dctf_lote a,
	estabelecimento b
where	a.cd_estabelecimento	= b.cd_estabelecimento
and	a.nr_sequencia		= nr_seq_lote_p

union all

select	2
ie_tipo_registro,
	a.nr_sequencia					nr_seq_lote,
	' ' ds_registro,
	0 ie_tipo_declaracao,
	b.cd_cgc					nr_cnpj,
	0 nr_versao,
	' ' nm_empresarial,
	' ' sg_uf,
	a.ie_finalidade_dctf				ie_situacao,
	clock_timestamp() nr_ano_declaracao,
	clock_timestamp() nr_mes_declaracao,
	TRUNC(a.dt_referencia,'mm')
	dt_periodo_inicial,
	trunc(fim_mes(a.dt_referencia),'dd')
	dt_periodo_final,
	CASE WHEN a.ie_finalidade_dctf=00 THEN '00000000'  ELSE clock_timestamp() END
	dt_ocorrencia_evento,
	'R01'						ie_tipo,
	trunc(a.dt_referencia,'mm')
	nr_mes_ocorrencia,
	clock_timestamp() dt_inicio,
	clock_timestamp() dt_fim,
	CASE WHEN a.ie_retificadora='N' THEN 0 WHEN a.ie_retificadora='S' THEN 1 END 		nr_declaracao,
	substr(trim(both replace(replace(a.nr_recibo_retificada,'.',''),'-','')),1,50)		nr_recibo,
	c.ie_forma_tributacao
	ie_forma_tributacao,
	c.ie_qualificacao_pj
	ie_qualificacao_pj,
	CASE WHEN c.ie_balancete='N' THEN 0 WHEN c.ie_balancete='S' THEN 1 END 		ie_pj_balanco,
	CASE WHEN c.ie_debito_scp='N' THEN 0 WHEN c.ie_debito_scp='S' THEN 1 END 		ie_pj_scp,
	CASE WHEN c.ie_estab_inativo='N' THEN 0 WHEN c.ie_estab_inativo='S' THEN 1 END 		ie_pj_inativa,
	CASE WHEN c.ie_debito_regime_esp='N' THEN 0 WHEN c.ie_debito_regime_esp='S' THEN 1 END 
	ie_pj_regime_especial,
	--decode(c.ie_dctf_ano_anterior,'N',0,'S',1)
	0 ie_pj_dctf_semestral,
	coalesce(ie_criterio_rec_variacao,0) ie_criterio_rec_variacao,
	CASE WHEN coalesce(ie_janeiro::text, '') = '' THEN 0 WHEN ie_janeiro='N' THEN 0 WHEN ie_janeiro='S' THEN 1 END  ie_janeiro,
	CASE WHEN coalesce(ie_fevereiro::text, '') = '' THEN 0 WHEN ie_fevereiro='N' THEN 0 WHEN ie_fevereiro='S' THEN 1 END  ie_fevereiro,
	CASE WHEN coalesce(ie_marco::text, '') = '' THEN 0 WHEN ie_marco='N' THEN 0 WHEN ie_marco='S' THEN 1 END  ie_marco,
	CASE WHEN coalesce(ie_abril::text, '') = '' THEN 0 WHEN ie_abril='N' THEN 0 WHEN ie_abril='S' THEN 1 END  ie_abril,
	CASE WHEN coalesce(ie_maio::text, '') = '' THEN 0 WHEN ie_maio='N' THEN 0 WHEN ie_maio='S' THEN 1 END  ie_maio,
	CASE WHEN coalesce(ie_junho::text, '') = '' THEN 0 WHEN ie_junho='N' THEN 0 WHEN ie_junho='S' THEN 1 END  ie_junho,
	CASE WHEN coalesce(ie_julho::text, '') = '' THEN 0 WHEN ie_julho='N' THEN 0 WHEN ie_julho='S' THEN 1 END  ie_julho,
	CASE WHEN coalesce(ie_agosto::text, '') = '' THEN 0 WHEN ie_agosto='N' THEN 0 WHEN ie_agosto='S' THEN 1 END  ie_agosto,
	CASE WHEN coalesce(ie_setembro::text, '') = '' THEN 0 WHEN ie_setembro='N' THEN 0 WHEN ie_setembro='S' THEN 1 END  ie_setembro,
	CASE WHEN coalesce(ie_outubro::text, '') = '' THEN 0 WHEN ie_outubro='N' THEN 0 WHEN ie_outubro='S' THEN 1 END  ie_outubro,
	CASE WHEN coalesce(ie_novembro::text, '') = '' THEN 0 WHEN ie_novembro='N' THEN 0 WHEN ie_novembro='S' THEN 1 END  ie_novembro,
	CASE WHEN coalesce(ie_dezembro::text, '') = '' THEN 0 WHEN ie_dezembro='N' THEN 0 WHEN ie_dezembro='S' THEN 1 END  ie_dezembro,
	coalesce(ie_regime_pis_cofins,0) ie_regime_pis_cofins,
	CASE WHEN coalesce(ie_iniciou_neste_mes::text, '') = '' THEN 0 WHEN ie_iniciou_neste_mes='N' THEN  0 WHEN ie_iniciou_neste_mes='S' THEN  1 WHEN ie_iniciou_neste_mes='E' THEN 2 WHEN ie_iniciou_neste_mes='P' THEN 3 WHEN ie_iniciou_neste_mes='J' THEN 4 END  ie_iniciou_neste_mes,
	' ' cd_natureza_juridica,
	' ' ds_logradouro,
	' ' ds_numero,
	' ' ds_complemento,
	' ' ds_bairro,
	' ' ds_municipio,
	' ' nr_cep,
	' ' nr_ddd_telefone,
	' ' nr_telefone,
	' ' nr_ddd_fax,
	' ' nr_fax,
	' ' nr_caixa_postal,
	' ' ds_uf_caixa_postal,
	' ' nr_cep_caixa_postal,
	' ' ds_email,
	' ' nm_representante,
	' ' nr_cpf_representante,
	' ' nr_ddd_telefone_representante,
	' ' nr_telefone_representante,
	' ' nr_ramal_representante,
	' ' nr_ddd_fax_representante,
	' ' nr_fax_representante,
	' ' ds_email_representante,
	' ' nm_responsavel,
	' ' nr_cpf_resp,
	' ' ds_crc_resp,
	' ' ds_uf_crc_resp,
	' ' nr_ddd_telefone_resp,
	' ' nr_telefone_resp,
	' ' nr_ramal_resp,
	' ' nr_ddd_fax_resp,
	' ' nr_fax_resp,
	' ' ds_email_resp,
	' ' nr_grupo_tributo,
	'0' cd_receita,
	' ' ds_periodicidade,
	clock_timestamp() nr_ano_apuracao,
	' ' dt_apuracao_mensal,
	' ' dt_apuracao_diario,
	' ' nr_ordem_estab,
	' ' nr_cnpj_incorporacao,
	0 vl_debito,
	0 ie_balanco_reducao,
	0 ie_saldo_quotas,
	clock_timestamp() dt_periodo_apuracao,
	' ' nr_cnpj_darf,
	'0' cd_receita_darf,
	clock_timestamp() dt_vencimento,
	' ' nr_referencia,
	0 vl_principal,
	0 vl_multa,
	0 vl_juros,
	0 vl_pago_debito,
	0 nr_trimestre_apuracao,
	0 nr_quota,
	0 qt_registros,
	' ' ds_hashcode
from	dctf_lote a,
	estabelecimento b,
	estab_dctf c
where	a.cd_estabelecimento	= b.cd_estabelecimento
and	b.cd_estabelecimento	= c.cd_estabelecimento
and	c.nr_sequencia		= (select	max(x.nr_sequencia)
				   from		estab_dctf x
				   where		trunc(x.dt_inicio_vigencia,'dd') <= trunc(clock_timestamp(),'dd')
				   and		x.cd_estabelecimento	= b.cd_estabelecimento)
and	a.nr_sequencia		= nr_seq_lote_p

union all

select	3
	ie_tipo_registro,
	a.nr_sequencia
	nr_seq_lote,
	' ' ds_registro,
	0 ie_tipo_declaracao,
	b.cd_cgc
	nr_cnpj,
	0 nr_versao,
	SUBSTR(obter_nome_empresa(b.cd_empresa),1,255)	nm_empresarial,
	SUBSTR(obter_dados_pf_pj(null,b.cd_cgc,'UF'),1,2) sg_uf,
	a.ie_finalidade_dctf ie_situacao,
	clock_timestamp() nr_ano_declaracao,
	clock_timestamp() nr_mes_declaracao,
	TRUNC(a.dt_referencia,'mm') dt_periodo_inicial,
	trunc(fim_mes(a.dt_referencia),'dd') dt_periodo_final,
	CASE WHEN a.ie_finalidade_dctf=00 THEN '00000000'  ELSE clock_timestamp() END  dt_ocorrencia_evento,
	'R02' ie_tipo,
	TRUNC(a.dt_referencia,'mm') nr_mes_ocorrencia,
	clock_timestamp() dt_inicio,
	clock_timestamp() dt_fim,
	0 nr_declaracao,
	' ' nr_recibo,
	0 ie_forma_tributacao,
	0 ie_qualificacao_pj,
	0 ie_pj_balanco,
	0 ie_pj_scp,
	0 ie_pj_inativa,
	0 ie_pj_regime_especial,
	0 ie_pj_dctf_semestral,
	coalesce(ie_criterio_rec_variacao,0) ie_criterio_rec_variacao,
	CASE WHEN coalesce(ie_janeiro::text, '') = '' THEN 0 WHEN ie_janeiro='N' THEN 0 WHEN ie_janeiro='S' THEN 1 END  ie_janeiro,
	CASE WHEN coalesce(ie_fevereiro::text, '') = '' THEN 0 WHEN ie_fevereiro='N' THEN 0 WHEN ie_fevereiro='S' THEN 1 END  ie_fevereiro,
	CASE WHEN coalesce(ie_marco::text, '') = '' THEN 0 WHEN ie_marco='N' THEN 0 WHEN ie_marco='S' THEN 1 END  ie_marco,
	CASE WHEN coalesce(ie_abril::text, '') = '' THEN 0 WHEN ie_abril='N' THEN 0 WHEN ie_abril='S' THEN 1 END  ie_abril,
	CASE WHEN coalesce(ie_maio::text, '') = '' THEN 0 WHEN ie_maio='N' THEN 0 WHEN ie_maio='S' THEN 1 END  ie_maio,
	CASE WHEN coalesce(ie_junho::text, '') = '' THEN 0 WHEN ie_junho='N' THEN 0 WHEN ie_junho='S' THEN 1 END  ie_junho,
	CASE WHEN coalesce(ie_julho::text, '') = '' THEN 0 WHEN ie_julho='N' THEN 0 WHEN ie_julho='S' THEN 1 END  ie_julho,
	CASE WHEN coalesce(ie_agosto::text, '') = '' THEN 0 WHEN ie_agosto='N' THEN 0 WHEN ie_agosto='S' THEN 1 END  ie_agosto,
	CASE WHEN coalesce(ie_setembro::text, '') = '' THEN 0 WHEN ie_setembro='N' THEN 0 WHEN ie_setembro='S' THEN 1 END  ie_setembro,
	CASE WHEN coalesce(ie_outubro::text, '') = '' THEN 0 WHEN ie_outubro='N' THEN 0 WHEN ie_outubro='S' THEN 1 END  ie_outubro,
	CASE WHEN coalesce(ie_novembro::text, '') = '' THEN 0 WHEN ie_novembro='N' THEN 0 WHEN ie_novembro='S' THEN 1 END  ie_novembro,
	CASE WHEN coalesce(ie_dezembro::text, '') = '' THEN 0 WHEN ie_dezembro='N' THEN 0 WHEN ie_dezembro='S' THEN 1 END  ie_dezembro,
	coalesce(ie_regime_pis_cofins,0) ie_regime_pis_cofins,
	CASE WHEN coalesce(ie_iniciou_neste_mes::text, '') = '' THEN 0 WHEN ie_iniciou_neste_mes='N' THEN  0 WHEN ie_iniciou_neste_mes='S' THEN  1 WHEN ie_iniciou_neste_mes='E' THEN 2 WHEN ie_iniciou_neste_mes='P' THEN 3 WHEN ie_iniciou_neste_mes='J' THEN 4 END  ie_iniciou_neste_mes,
	c.cd_natureza_juridica cd_natureza_juridica,
	SUBSTR(obter_dados_pf_pj(NULL,b.cd_cgc,'R'),1,40) ds_logradouro,
	substr(coalesce(coalesce(obter_dados_pf_pj_estab(b.cd_estabelecimento, null, b.cd_cgc,'NR'),obter_compl_pj(b.cd_cgc,1,'NR')),obter_dados_pf_pj(b.cd_cgc,1,'NR')),1,6) ds_numero,
	SUBSTR(obter_dados_pf_pj(NULL,b.cd_cgc,'CO'),1,21) ds_complemento,
	SUBSTR(obter_dados_pf_pj(NULL,b.cd_cgc,'B'),1,20) ds_bairro,
	SUBSTR(obter_dados_pf_pj(NULL,b.cd_cgc,'CI'),1,50) ds_municipio,
	SUBSTR(obter_dados_pf_pj(NULL,b.cd_cgc,'CEP'),1,8) nr_cep,
	lpad(obter_dados_pf_pj(NULL,b.cd_cgc,'DDT'),3,' ') nr_ddd_telefone,
	substr(elimina_caracteres_especiais(obter_dados_pf_pj(NULL,b.cd_cgc,'T')),1,9) nr_telefone,
	Substr(obter_dados_pf_pj(NULL,b.cd_cgc,'DDF'),1,3) nr_ddd_fax,
	substr(elimina_caracteres_especiais(obter_dados_pf_pj(NULL,b.cd_cgc,'FAX')),1,9) nr_fax,
	' ' nr_caixa_postal,
	SUBSTR(obter_uf_localidade(b.cd_localidade),1,2) ds_uf_caixa_postal,
	SUBSTR(obter_dados_pf_pj(NULL,b.cd_cgc,'CEP'),1,8) nr_cep_caixa_postal,
	SUBSTR(coalesce(obter_dados_pf_pj(NULL,b.cd_cgc,'M'),obter_dados_pf_pj_estab(b.cd_estabelecimento,null,b.cd_cgc,'M')),1,40) ds_email,
	' ' nm_representante,
	' ' nr_cpf_representante,
	' ' nr_ddd_telefone_representante,
	' ' nr_telefone_representante,
	' ' nr_ramal_representante,
	' ' nr_ddd_fax_representante,
	' ' nr_fax_representante,
	' ' ds_email_representante,
	' ' nm_responsavel,
	' ' nr_cpf_resp,
	' ' ds_crc_resp,
	' ' ds_uf_crc_resp,
	' ' nr_ddd_telefone_resp,
	' ' nr_telefone_resp,
	' ' nr_ramal_resp,
	' ' nr_ddd_fax_resp,
	' ' nr_fax_resp,
	' ' ds_email_resp,
	' ' nr_grupo_tributo,
	'0' cd_receita,
	' ' ds_periodicidade,
	clock_timestamp() nr_ano_apuracao,
	' ' dt_apuracao_mensal,
	' ' dt_apuracao_diario,
	' ' nr_ordem_estab,
	' ' nr_cnpj_incorporacao,
	0 vl_debito,
	0 ie_balanco_reducao,
	0 ie_saldo_quotas,
	clock_timestamp() dt_periodo_apuracao,
	' ' nr_cnpj_darf,
	'0' cd_receita_darf,
	clock_timestamp() dt_vencimento,
	' ' nr_referencia,
	0 vl_principal,
	0 vl_multa,
	0 vl_juros,
	0 vl_pago_debito,
	0 nr_trimestre_apuracao,
	0 nr_quota,
	0 qt_registros,
	' ' ds_hashcode
from	dctf_lote a,
	estabelecimento b,
	estab_dctf c
where	a.cd_estabelecimento	= b.cd_estabelecimento
and	b.cd_estabelecimento	= c.cd_estabelecimento
and	c.nr_sequencia		= (select	max(x.nr_sequencia)
				   from		estab_dctf X
				   where 	trunc(x.dt_inicio_vigencia,'dd') <= trunc(clock_timestamp(),'dd')
				   and		x.cd_estabelecimento	= b.cd_estabelecimento)
and	a.nr_sequencia		= nr_seq_lote_p

union all

select	4
ie_tipo_registro,
	a.nr_sequencia					nr_seq_lote,
	' ' ds_registro,
	0 ie_tipo_declaracao,
	b.cd_cgc					nr_cnpj,
	0 nr_versao,
	' ' nm_empresarial,
	' ' sg_uf,
	a.ie_finalidade_dctf				ie_situacao,
	clock_timestamp() nr_ano_declaracao,
	clock_timestamp() nr_mes_declaracao,
	TRUNC(a.dt_referencia,'mm')
	dt_periodo_inicial,
	trunc(fim_mes(a.dt_referencia),'dd')
	dt_periodo_final,
	CASE WHEN a.ie_finalidade_dctf=00 THEN '00000000'  ELSE clock_timestamp() END 
	dt_ocorrencia_evento,
	'R03'						ie_tipo,
	TRUNC(a.dt_referencia,'mm')
	nr_mes_ocorrencia,
	clock_timestamp() dt_inicio,
	clock_timestamp() dt_fim,
	0 nr_declaracao,
	' ' nr_recibo,
	0 ie_forma_tributacao,
	0 ie_qualificacao_pj,
	0 ie_pj_balanco,
	0 ie_pj_scp,
	0 ie_pj_inativa,
	0 ie_pj_regime_especial,
	0 ie_pj_dctf_semestral,
	coalesce(ie_criterio_rec_variacao,0) ie_criterio_rec_variacao,
	CASE WHEN coalesce(ie_janeiro::text, '') = '' THEN 0 WHEN ie_janeiro='N' THEN 0 WHEN ie_janeiro='S' THEN 1 END  ie_janeiro,
	CASE WHEN coalesce(ie_fevereiro::text, '') = '' THEN 0 WHEN ie_fevereiro='N' THEN 0 WHEN ie_fevereiro='S' THEN 1 END  ie_fevereiro,
	CASE WHEN coalesce(ie_marco::text, '') = '' THEN 0 WHEN ie_marco='N' THEN 0 WHEN ie_marco='S' THEN 1 END  ie_marco,
	CASE WHEN coalesce(ie_abril::text, '') = '' THEN 0 WHEN ie_abril='N' THEN 0 WHEN ie_abril='S' THEN 1 END  ie_abril,
	CASE WHEN coalesce(ie_maio::text, '') = '' THEN 0 WHEN ie_maio='N' THEN 0 WHEN ie_maio='S' THEN 1 END  ie_maio,
	CASE WHEN coalesce(ie_junho::text, '') = '' THEN 0 WHEN ie_junho='N' THEN 0 WHEN ie_junho='S' THEN 1 END  ie_junho,
	CASE WHEN coalesce(ie_julho::text, '') = '' THEN 0 WHEN ie_julho='N' THEN 0 WHEN ie_julho='S' THEN 1 END  ie_julho,
	CASE WHEN coalesce(ie_agosto::text, '') = '' THEN 0 WHEN ie_agosto='N' THEN 0 WHEN ie_agosto='S' THEN 1 END  ie_agosto,
	CASE WHEN coalesce(ie_setembro::text, '') = '' THEN 0 WHEN ie_setembro='N' THEN 0 WHEN ie_setembro='S' THEN 1 END  ie_setembro,
	CASE WHEN coalesce(ie_outubro::text, '') = '' THEN 0 WHEN ie_outubro='N' THEN 0 WHEN ie_outubro='S' THEN 1 END  ie_outubro,
	CASE WHEN coalesce(ie_novembro::text, '') = '' THEN 0 WHEN ie_novembro='N' THEN 0 WHEN ie_novembro='S' THEN 1 END  ie_novembro,
	CASE WHEN coalesce(ie_dezembro::text, '') = '' THEN 0 WHEN ie_dezembro='N' THEN 0 WHEN ie_dezembro='S' THEN 1 END  ie_dezembro,
	coalesce(ie_regime_pis_cofins,0) ie_regime_pis_cofins,
	CASE WHEN coalesce(ie_iniciou_neste_mes::text, '') = '' THEN 0 WHEN ie_iniciou_neste_mes='N' THEN  0 WHEN ie_iniciou_neste_mes='S' THEN  1 WHEN ie_iniciou_neste_mes='E' THEN 2 WHEN ie_iniciou_neste_mes='P' THEN 3 WHEN ie_iniciou_neste_mes='J' THEN 4 END  ie_iniciou_neste_mes ,
	' ' cd_natureza_juridica,
	' ' ds_logradouro,
	' ' ds_numero,
	' ' ds_complemento,
	' ' ds_bairro,
	' ' ds_municipio,
	' ' nr_cep,
	' ' nr_ddd_telefone,
	' ' nr_telefone,
	' ' nr_ddd_fax,
	' ' nr_fax,
	' ' nr_caixa_postal,
	SUBSTR(obter_uf_localidade(b.cd_localidade),1,2) ds_uf_caixa_postal,
	' ' nr_cep_caixa_postal,
	' ' ds_email,
	substr(obter_nome_pf_pj(c.cd_titular,null),1,60) nm_representante,
	substr(obter_dados_pf(c.cd_titular,'CPF'),1,11)	nr_cpf_representante,
	lpad(substr(obter_compl_pf(c.cd_titular,2,'DDT'),1,3),3,' ') nr_ddd_telefone_representante,
	substr(elimina_caracteres_especiais(obter_compl_pf(c.cd_titular,2,'T')),1,9) nr_telefone_representante,
	substr(obter_compl_pf(c.cd_titular,2,'RAM'),1,5) nr_ramal_representante,
	lpad(substr(obter_compl_pf(c.cd_titular,2,'DDF'),1,3),3,' ') nr_ddd_fax_representante,
	substr(elimina_caracteres_especiais(obter_compl_pf(c.cd_titular,2,'FAX')),1,9) nr_fax_representante,
	substr(obter_compl_pf(c.cd_titular,2,'M'),1,40) ds_email_representante,
	substr(obter_nome_pf_pj(cd_contabilista_w,null),1,60) nm_responsavel,
	substr(obter_dados_pf(cd_contabilista_w,'CPF'),1,11) nr_cpf_resp,
	nr_crc_w ds_crc_resp,
	substr(obter_dados_pf_pj(cd_contabilista_w,null,'UF'),1,2) ds_uf_crc_resp,
	substr(obter_compl_pf(cd_contabilista_w,2,'DDT'),1,3) nr_ddd_telefone_resp,
	substr(elimina_caracteres_especiais(obter_compl_pf(cd_contabilista_w,2,'T')),1,9) nr_telefone_resp,
	substr(obter_compl_pf(cd_contabilista_w,2,'RAM'),1,5) nr_ramal_resp,
	substr(obter_compl_pf(cd_contabilista_w,2,'DDF'),1,3) nr_ddd_fax_resp,
	substr(elimina_caracteres_especiais(obter_compl_pf(cd_contabilista_w,2,'FAX')),1,9) nr_fax_resp,
	substr(obter_dados_pf_pj(cd_contabilista_w,null,'M'),1,40) ds_email_resp,
	' ' nr_grupo_tributo,
	'0' cd_receita,
	' ' ds_periodicidade,
	clock_timestamp() nr_ano_apuracao,
	' ' dt_apuracao_mensal,
	' ' dt_apuracao_diario,
	' ' nr_ordem_estab,
	' ' nr_cnpj_incorporacao,
	0 vl_debito,
	0 ie_balanco_reducao,
	0 ie_saldo_quotas,
	clock_timestamp() dt_periodo_apuracao,
	' ' nr_cnpj_darf,
	'0' cd_receita_darf,
	clock_timestamp() dt_vencimento,
	' ' nr_referencia,
	0 vl_principal,
	0 vl_multa,
	0 vl_juros,
	0 vl_pago_debito,
	0 nr_trimestre_apuracao,
	0 nr_quota,
	0 qt_registros,
	' ' ds_hashcode
from	dctf_lote a,
	estabelecimento b,
	empresa c
where	a.cd_estabelecimento	= b.cd_estabelecimento
and	b.cd_empresa		= c.cd_empresa
and	a.nr_sequencia		= nr_seq_lote_p
order by ie_tipo_registro;

c02 CURSOR FOR
/* R10 - Dbito Apurado e Crditos Vinculados */

SELECT	distinct
	5 ie_tipo_registro,
	a.nr_sequencia nr_seq_lote,
	' ' ds_registro,
	0 ie_tipo_declaracao,
	b.cd_cgc nr_cnpj,
	0 nr_versao,
	' ' nm_empresarial,
	' ' sg_uf,
	a.ie_finalidade_dctf ie_situacao,
	clock_timestamp() nr_ano_declaracao,
	clock_timestamp() nr_mes_declaracao,
	clock_timestamp()	dt_periodo_inicial,
	clock_timestamp()	dt_periodo_final,
	CASE WHEN a.ie_finalidade_dctf=00 THEN '00000000'  ELSE clock_timestamp() END  dt_ocorrencia_evento,
	'R10'						ie_tipo,
	TRUNC(a.dt_referencia,'mm') nr_mes_ocorrencia,
	clock_timestamp() dt_inicio,
	clock_timestamp() dt_fim,
	0 nr_declaracao,
	' ' nr_recibo,
	0 ie_forma_tributacao,
	0 ie_qualificacao_pj,
	0 ie_pj_balanco,
	0 ie_pj_scp,
	0 ie_pj_inativa,
	0 ie_pj_regime_especial,
	0 ie_pj_dctf_semestral,
	coalesce(ie_spc_inc,0) ie_spc_inc,
	' ' cd_natureza_juridica,
	' ' ds_logradouro,
	' ' ds_numero,
	' ' ds_complemento,
	' ' ds_bairro,
	' ' ds_municipio,
	' ' nr_cep,
	' ' nr_ddd_telefone,
	' ' nr_telefone,
	' ' nr_ddd_fax,
	' ' nr_fax,
	' ' nr_caixa_postal,
	' ' ds_uf_caixa_postal,
	' ' nr_cep_caixa_postal,
	' ' ds_email,
	' ' nm_representante,
	' ' nr_cpf_representante,
	' ' nr_ddd_telefone_representante,
	' ' nr_telefone_representante,
	' ' nr_ramal_representante,
	' ' nr_ddd_fax_representante,
	' ' nr_fax_representante,
	' ' ds_email_representante,
	' ' nm_responsavel,
	' ' nr_cpf_resp,
	' ' ds_crc_resp,
	' ' ds_uf_crc_resp,
	' ' nr_ddd_telefone_resp,
	' ' nr_telefone_resp,
	' ' nr_ramal_resp,
	' ' nr_ddd_fax_resp,
	' ' nr_fax_resp,
	' ' ds_email_resp,
	g.ie_grupo_tributo
	nr_grupo_tributo,
	d.cd_darf || lpad(CASE WHEN coalesce(coalesce(i.cd_variacao,f.cd_variacao)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'V')  ELSE coalesce(i.cd_variacao,f.cd_variacao) END ,2,0) 	cd_receita,
	CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END  ds_periodicidade,
	a.dt_referencia	nr_ano_apuracao,
	CASE WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='T' THEN 		obter_periodo_data(d.dt_apuracao,'T') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='U' THEN 		obter_periodo_data(d.dt_apuracao,'U') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='B' THEN 		obter_periodo_data(d.dt_apuracao,'B') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='E' THEN 		obter_periodo_data(d.dt_apuracao,'E') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='A' THEN '00'  ELSE obter_periodo_data(d.dt_apuracao,'M') END  dt_apuracao_mensal,
	CASE WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='S' THEN 		obter_periodo_data(d.dt_apuracao,'S') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='X' THEN 		obter_periodo_data(d.dt_apuracao,'X') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='Q' THEN 		obter_periodo_data(d.dt_apuracao,'Q') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='D' THEN 		obter_periodo_data(d.dt_apuracao,'D')  ELSE '00' END  dt_apuracao_diario,
CASE WHEN g.ie_grupo_tributo='03' THEN substr(b.cd_cgc,9,6) WHEN g.ie_grupo_tributo='09' THEN substr(b.cd_cgc,9,6)  ELSE '000000' END  nr_ordem_estab,
	CASE WHEN g.ie_grupo_tributo='10' THEN b.cd_cgc  ELSE '00000000000000' END  nr_cnpj_incorporacao,
	sum((SUBSTR(obter_dados_tit_pagar(i.nr_titulo,'V'),1,200))::numeric ) vl_debito,
	CASE WHEN coalesce(h.ie_balanco_reducao::text, '') = '' THEN 0 WHEN h.ie_balanco_reducao='N' THEN 0 WHEN h.ie_balanco_reducao='S' THEN 1 END 	ie_balanco_reducao,
	0						ie_saldo_quotas,
	clock_timestamp()	dt_periodo_apuracao,
	' ' nr_cnpj_darf,
	'0' cd_receita_darf,
	clock_timestamp()	dt_vencimento,
	' ' nr_referencia,
	0 vl_principal,
	0 vl_multa,
	0 vl_juros,
	0 vl_pago_debito,
	0 nr_trimestre_apuracao,
	0 nr_quota,
	0 qt_registros,
	' ' ds_hashcode
FROM estab_dctf h, tributo g, darf_titulo_pagar e, darf d, dctf_lote_darf c, estabelecimento b, dctf_lote a, titulo_pagar i
LEFT OUTER JOIN titulo_pagar_imposto f ON (i.nr_seq_tributo = f.nr_sequencia)
WHERE a.cd_estabelecimento	= b.cd_estabelecimento and a.nr_sequencia		= c.nr_seq_lote and c.nr_seq_darf		= d.nr_sequencia and d.nr_sequencia		= e.nr_seq_darf  and (f.cd_tributo		= g.cd_tributo or i.cd_tributo = g.cd_tributo) and h.cd_estabelecimento	= b.cd_estabelecimento and e.nr_titulo		= i.nr_titulo and h.nr_sequencia		= (select	max(x.nr_sequencia)
				   from		estab_dctf x
				   where	trunc(x.dt_inicio_vigencia,'dd') <= trunc(clock_timestamp(),'dd')
				   and		b.cd_estabelecimento	= x.cd_estabelecimento) and a.nr_sequencia		= nr_seq_lote_p group by a.nr_sequencia,
	a.ie_finalidade_dctf,
	a.dt_referencia,
	d.cd_darf || lpad(CASE WHEN coalesce(coalesce(i.cd_variacao,f.cd_variacao)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'V')  ELSE coalesce(i.cd_variacao,f.cd_variacao) END ,2,0),
	a.ie_spc_inc,
	CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ,
	CASE WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='T' THEN 		obter_periodo_data(d.dt_apuracao,'T') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='U' THEN 		obter_periodo_data(d.dt_apuracao,'U') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='B' THEN 		obter_periodo_data(d.dt_apuracao,'B') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='E' THEN 		obter_periodo_data(d.dt_apuracao,'E') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='A' THEN '00'  ELSE obter_periodo_data(d.dt_apuracao,'M') END ,
	CASE WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='S' THEN 		obter_periodo_data(d.dt_apuracao,'S') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='X' THEN 		obter_periodo_data(d.dt_apuracao,'X') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='Q' THEN 		obter_periodo_data(d.dt_apuracao,'Q') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='D' THEN 		obter_periodo_data(d.dt_apuracao,'D')  ELSE '00' END ,
	b.cd_cgc,
	g.ie_grupo_tributo,
	h.ie_balanco_reducao

union

select	distinct
	5 ie_tipo_registro,
	a.nr_sequencia nr_seq_lote,
	' ' ds_registro,
	0 ie_tipo_declaracao,
	b.cd_cgc nr_cnpj,
	0 nr_versao,
	' ' nm_empresarial,
	' ' sg_uf,
	a.ie_finalidade_dctf ie_situacao,
	clock_timestamp() nr_ano_declaracao,
	clock_timestamp() nr_mes_declaracao,
	clock_timestamp()	dt_periodo_inicial,
	clock_timestamp()	dt_periodo_final,
	CASE WHEN a.ie_finalidade_dctf=00 THEN '00000000'  ELSE clock_timestamp() END  dt_ocorrencia_evento,
	'R10'						ie_tipo,
	TRUNC(a.dt_referencia,'mm') nr_mes_ocorrencia,
	clock_timestamp() dt_inicio,
	clock_timestamp() dt_fim,
	0 nr_declaracao,
	' ' nr_recibo,
	0 ie_forma_tributacao,
	0 ie_qualificacao_pj,
	0 ie_pj_balanco,
	0 ie_pj_scp,
	0 ie_pj_inativa,
	0 ie_pj_regime_especial,
	0 ie_pj_dctf_semestral,
	coalesce(ie_spc_inc,0) ie_spc_inc,
	' ' cd_natureza_juridica,
	' ' ds_logradouro,
	' ' ds_numero,
	' ' ds_complemento,
	' ' ds_bairro,
	' ' ds_municipio,
	' ' nr_cep,
	' ' nr_ddd_telefone,
	' ' nr_telefone,
	' ' nr_ddd_fax,
	' ' nr_fax,
	' ' nr_caixa_postal,
	' ' ds_uf_caixa_postal,
	' ' nr_cep_caixa_postal,
	' ' ds_email,
	' ' nm_representante,
	' ' nr_cpf_representante,
	' ' nr_ddd_telefone_representante,
	' ' nr_telefone_representante,
	' ' nr_ramal_representante,
	' ' nr_ddd_fax_representante,
	' ' nr_fax_representante,
	' ' ds_email_representante,
	' ' nm_responsavel,
	' ' nr_cpf_resp,
	' ' ds_crc_resp,
	' ' ds_uf_crc_resp,
	' ' nr_ddd_telefone_resp,
	' ' nr_telefone_resp,
	' ' nr_ramal_resp,
	' ' nr_ddd_fax_resp,
	' ' nr_fax_resp,
	' ' ds_email_resp,
	d.ie_grupo_tributo
	nr_grupo_tributo,
	d.cd_darf || lpad(d.cd_variacao,2,'0') cd_receita,
	d.ie_periodicidade ds_periodicidade,
	a.dt_referencia	nr_ano_apuracao,
	CASE WHEN d.ie_periodicidade='T' THEN 		obter_periodo_data(d.dt_apuracao,'T') WHEN d.ie_periodicidade='U' THEN 		obter_periodo_data(d.dt_apuracao,'U') WHEN d.ie_periodicidade='B' THEN 		obter_periodo_data(d.dt_apuracao,'B') WHEN d.ie_periodicidade='E' THEN 		obter_periodo_data(d.dt_apuracao,'E') WHEN d.ie_periodicidade='A' THEN '00'  ELSE obter_periodo_data(d.dt_apuracao,'M') END  dt_apuracao_mensal,
	CASE WHEN d.ie_periodicidade='S' THEN 		obter_periodo_data(d.dt_apuracao,'S') WHEN d.ie_periodicidade='X' THEN 		obter_periodo_data(d.dt_apuracao,'X') WHEN d.ie_periodicidade='Q' THEN 		obter_periodo_data(d.dt_apuracao,'Q') WHEN d.ie_periodicidade='D' THEN 		obter_periodo_data(d.dt_apuracao,'D')  ELSE '00' END  dt_apuracao_diario,
CASE WHEN d.ie_grupo_tributo='03' THEN substr(b.cd_cgc,9,6) WHEN d.ie_grupo_tributo='09' THEN substr(b.cd_cgc,9,6)  ELSE '000000' END  nr_ordem_estab,
	CASE WHEN d.ie_grupo_tributo='10' THEN b.cd_cgc  ELSE '00000000000000' END  nr_cnpj_incorporacao,
	sum(d.vl_darf)				vl_debito,
	CASE WHEN coalesce(h.ie_balanco_reducao::text, '') = '' THEN 0 WHEN h.ie_balanco_reducao='N' THEN 0 WHEN h.ie_balanco_reducao='S' THEN 1 END 	ie_balanco_reducao,
	0						ie_saldo_quotas,
	clock_timestamp()	dt_periodo_apuracao,
	' ' nr_cnpj_darf,
	'0' cd_receita_darf,
	clock_timestamp()	dt_vencimento,
	' ' nr_referencia,
	0 vl_principal,
	0 vl_multa,
	0 vl_juros,
	0 vl_pago_debito,
	0 nr_trimestre_apuracao,
	0 nr_quota,
	0 qt_registros,
	' ' ds_hashcode
from	dctf_lote a,
	estabelecimento b,
	estab_dctf h,
	dctf_lote_externo c,
	dctf_lote_ext_darf d
where	a.cd_estabelecimento	= b.cd_estabelecimento
and	h.cd_estabelecimento	= b.cd_estabelecimento
and	a.nr_sequencia		= c.nr_seq_lote
and	c.nr_sequencia		= d.nr_Seq_lote_ext
and	h.nr_sequencia		= (select	max(x.nr_sequencia)
				   from		estab_dctf x
				   where	trunc(x.dt_inicio_vigencia,'dd') <= trunc(clock_timestamp(),'dd')
				   and		b.cd_estabelecimento	= x.cd_estabelecimento)
and	a.nr_sequencia		= nr_seq_lote_p
group by a.nr_sequencia,
	a.ie_finalidade_dctf,
	a.dt_referencia,
	d.cd_darf,
	d.cd_variacao,
	a.ie_spc_inc,
	CASE WHEN d.ie_periodicidade='T' THEN 		obter_periodo_data(d.dt_apuracao,'T') WHEN d.ie_periodicidade='U' THEN 		obter_periodo_data(d.dt_apuracao,'U') WHEN d.ie_periodicidade='B' THEN 		obter_periodo_data(d.dt_apuracao,'B') WHEN d.ie_periodicidade='E' THEN 		obter_periodo_data(d.dt_apuracao,'E') WHEN d.ie_periodicidade='A' THEN '00'  ELSE obter_periodo_data(d.dt_apuracao,'M') END ,
	CASE WHEN d.ie_periodicidade='S' THEN 		obter_periodo_data(d.dt_apuracao,'S') WHEN d.ie_periodicidade='X' THEN 		obter_periodo_data(d.dt_apuracao,'X') WHEN d.ie_periodicidade='Q' THEN 		obter_periodo_data(d.dt_apuracao,'Q') WHEN d.ie_periodicidade='D' THEN 		obter_periodo_data(d.dt_apuracao,'D')  ELSE '00' END ,
	d.ie_periodicidade,
	b.cd_cgc,
	d.ie_grupo_tributo,
	h.ie_balanco_reducao;

c03 CURSOR FOR
/* R11 - Pagamentos com DARF */

SELECT	distinct 6					ie_tipo_registro,
	a.nr_sequencia					nr_seq_lote,
	' ' ds_registro,
	0 ie_tipo_declaracao,
	b.cd_cgc					nr_cnpj,
	0 nr_versao,
	' ' nm_empresarial,
	' ' sg_uf,
	a.ie_finalidade_dctf				ie_situacao,
	clock_timestamp() nr_ano_declaracao,
	clock_timestamp() nr_mes_declaracao,
	TRUNC(a.dt_referencia,'mm')			dt_periodo_inicial,
	trunc(fim_mes(a.dt_referencia),'dd')		dt_periodo_final,
	CASE WHEN a.ie_finalidade_dctf=00 THEN '00000000'  ELSE clock_timestamp() END  dt_ocorrencia_evento,
	'R11'						ie_tipo,
	TRUNC(a.dt_referencia,'mm')			nr_mes_ocorrencia,
	clock_timestamp() dt_inicio,
	clock_timestamp() dt_fim,
	0 nr_declaracao,
	' ' nr_recibo,
	0 ie_forma_tributacao,
	0 ie_qualificacao_pj,
	0 ie_pj_balanco,
	0 ie_pj_scp,
	0 ie_pj_inativa,
	0 ie_pj_regime_especial,
	0 ie_pj_dctf_semestral,
	' ' cd_natureza_juridica,
	' ' ds_logradouro,
	' ' ds_numero,
	' ' ds_complemento,
	' ' ds_bairro,
	' ' ds_municipio,
	' ' nr_cep,
	' ' nr_ddd_telefone,
	' ' nr_telefone,
	' ' nr_ddd_fax,
	' ' nr_fax,
	' ' nr_caixa_postal,
	' ' ds_uf_caixa_postal,
	' ' nr_cep_caixa_postal,
	' ' ds_email,
	' ' nm_representante,
	' ' nr_cpf_representante,
	' ' nr_ddd_telefone_representante,
	' ' nr_telefone_representante,
	' ' nr_ramal_representante,
	' ' nr_ddd_fax_representante,
	' ' nr_fax_representante,
	' ' ds_email_representante,
	' ' nm_responsavel,
	' ' nr_cpf_resp,
	' ' ds_crc_resp,
	' ' ds_uf_crc_resp,
	' ' nr_ddd_telefone_resp,
	' ' nr_telefone_resp,
	' ' nr_ramal_resp,
	' ' nr_ddd_fax_resp,
	' ' nr_fax_resp,
	' ' ds_email_resp,
	g.ie_grupo_tributo
	nr_grupo_tributo,
	d.cd_darf|| lpad(CASE WHEN coalesce(coalesce(i.cd_variacao,f.cd_variacao)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'V')  ELSE coalesce(i.cd_variacao,f.cd_variacao) END ,2,'0') cd_receita,
	CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END
	ds_periodicidade,
	a.dt_referencia
	nr_ano_apuracao,
CASE WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='T' THEN obter_periodo_data(d.dt_apuracao,'T') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='U' THEN obter_periodo_data(d.dt_apuracao,'U') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='B' THEN obter_periodo_data(d.dt_apuracao,'B') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='E' THEN obter_periodo_data(d.dt_apuracao,'E') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='A' THEN '00'  ELSE obter_periodo_data(d.dt_apuracao,'M') END 
dt_apuracao_mensal,
CASE WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='S' THEN obter_periodo_data(d.dt_apuracao,'S') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='X' THEN obter_periodo_data(d.dt_apuracao,'X') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='Q' THEN obter_periodo_data(d.dt_apuracao,'Q') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='D' THEN obter_periodo_data(d.dt_apuracao,'D')  ELSE '00' END  dt_apuracao_diario,
CASE WHEN g.ie_grupo_tributo='03' THEN substr(b.cd_cgc,9,6) WHEN g.ie_grupo_tributo='09' THEN substr(b.cd_cgc,9,6)  ELSE '000000' END  nr_ordem_estab,
	CASE WHEN g.ie_grupo_tributo='10' THEN b.cd_cgc  ELSE '00000000000000' END 
nr_cnpj_incorporacao,
	0 vl_debito,
	0 ie_balanco_reducao,
	0 ie_saldo_quotas,
	d.dt_apuracao 			dt_periodo_apuracao,
	b.cd_cgc			nr_cnpj_darf,
	substr(d.cd_darf,1,4)		cd_receita_darf,
	d.dt_vencimento			dt_vencimento,
	d.nr_referencia			nr_referencia,
	obter_valor_total_darf_princ(d.nr_sequencia) - coalesce(d.vl_multa,0) - coalesce(d.vl_juros,0) vl_principal,
	coalesce(d.vl_multa,0)		vl_multa,
	coalesce(d.vl_juros,0)		vl_juros,
	obter_valor_total_darf_princ(d.nr_sequencia) - coalesce(d.vl_multa,0) - coalesce(d.vl_juros,0) vl_pago_debito,
	0 nr_trimestre_apuracao,
	0 nr_quota,
	0 qt_registros,
	' ' ds_hashcode,
	d.nr_sequencia
FROM tributo g, darf_titulo_pagar e, darf d, dctf_lote_darf c, estabelecimento b, dctf_lote a, titulo_pagar i
LEFT OUTER JOIN titulo_pagar_imposto f ON (i.nr_seq_tributo = f.nr_sequencia)
WHERE a.cd_estabelecimento	= b.cd_estabelecimento and a.nr_sequencia		= c.nr_seq_lote and c.nr_seq_darf		= d.nr_sequencia and d.nr_sequencia		= e.nr_seq_darf and e.nr_titulo		= i.nr_titulo  and (f.cd_tributo		= g.cd_tributo or i.cd_tributo = g.cd_tributo) and a.nr_sequencia		= nr_seq_lote_p and a.ie_agrupar_titulos	= 'S' --a.595202
  and d.cd_darf|| lpad(CASE WHEN coalesce(coalesce(i.cd_variacao,f.cd_variacao)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'V')  ELSE coalesce(i.cd_variacao,f.cd_variacao) END ,2,'0')	= cd_receita_w /*decode(decode(nvl(i.ie_periodicidade,f.ie_periodicidade),null,obter_cd_darf_variacao(g.cd_tributo,'P'),nvl(i.ie_periodicidade,f.ie_periodicidade)),'S',
		obter_periodo_data(d.dt_apuracao,'S'),'X',
		obter_periodo_data(d.dt_apuracao,'X'),'Q',
		obter_periodo_data(d.dt_apuracao,'Q'),'D',
		obter_periodo_data(d.dt_apuracao,'D'),'00')*/
  and CASE WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='T' THEN 	obter_periodo_data(d.dt_apuracao,'T') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='U' THEN 	obter_periodo_data(d.dt_apuracao,'U') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='B' THEN 	obter_periodo_data(d.dt_apuracao,'B') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='E' THEN 	obter_periodo_data(d.dt_apuracao,'E') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='A' THEN '00'  ELSE obter_periodo_data(d.dt_apuracao,'M') END  	= dt_apuracao_mensal_w and CASE WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='S', --,'S' THEN 	obter_periodo_data(d.dt_apuracao,'S') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='X' THEN 	obter_periodo_data(d.dt_apuracao,'X') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='Q' THEN 	obter_periodo_data(d.dt_apuracao,'Q') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='D' THEN 	obter_periodo_data(d.dt_apuracao,'D')  ELSE '00' END  = dt_apuracao_diario_w group by 	a.nr_sequencia,
	b.cd_cgc,
	a.ie_finalidade_dctf,
	TRUNC(a.dt_referencia,'mm'),
	trunc(fim_mes(a.dt_referencia),'dd'),
	CASE WHEN a.ie_finalidade_dctf=00 THEN '00000000'  ELSE clock_timestamp() END ,
	TRUNC(a.dt_referencia,'mm'),
	g.ie_grupo_tributo,
	d.cd_darf|| lpad(CASE WHEN coalesce(coalesce(i.cd_variacao,f.cd_variacao)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'V')  ELSE coalesce(i.cd_variacao,f.cd_variacao) END ,2,'0'),
	CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ,
	a.dt_referencia,
	CASE WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='T' THEN obter_periodo_data(d.dt_apuracao,'T') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='U' THEN obter_periodo_data(d.dt_apuracao,'U') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='B' THEN obter_periodo_data(d.dt_apuracao,'B') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='E' THEN obter_periodo_data(d.dt_apuracao,'E') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='A' THEN '00'  ELSE obter_periodo_data(d.dt_apuracao,'M') END ,
	CASE WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='S' THEN obter_periodo_data(d.dt_apuracao,'S') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='X' THEN obter_periodo_data(d.dt_apuracao,'X') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='Q' THEN obter_periodo_data(d.dt_apuracao,'Q') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='D' THEN obter_periodo_data(d.dt_apuracao,'D')  ELSE '00' END ,
	CASE WHEN g.ie_grupo_tributo='03' THEN substr(b.cd_cgc,9,6) WHEN g.ie_grupo_tributo='09' THEN substr(b.cd_cgc,9,6)  ELSE '000000' END ,
	CASE WHEN g.ie_grupo_tributo='10' THEN b.cd_cgc  ELSE '00000000000000' END ,
	d.dt_apuracao,
	b.cd_cgc,
	substr(d.cd_darf,1,4),
	d.dt_vencimento,
	d.nr_referencia,
	obter_valor_darf(d.nr_sequencia),
	coalesce(d.vl_multa,0),
	coalesce(d.vl_juros,0),
	d.nr_sequencia

union

select	distinct 6					ie_tipo_registro,
	a.nr_sequencia					nr_seq_lote,
	' ' ds_registro,
	0 ie_tipo_declaracao,
	c.cd_cgc					nr_cnpj,
	0 nr_versao,
	' ' nm_empresarial,
	' ' sg_uf,
	a.ie_finalidade_dctf				ie_situacao,
	clock_timestamp() nr_ano_declaracao,
	clock_timestamp() nr_mes_declaracao,
	TRUNC(a.dt_referencia,'mm')			dt_periodo_inicial,
	trunc(fim_mes(a.dt_referencia),'dd')		dt_periodo_final,
	CASE WHEN a.ie_finalidade_dctf=00 THEN '00000000'  ELSE clock_timestamp() END  dt_ocorrencia_evento,
	'R11'						ie_tipo,
	TRUNC(a.dt_referencia,'mm')			nr_mes_ocorrencia,
	clock_timestamp() dt_inicio,
	clock_timestamp() dt_fim,
	0 nr_declaracao,
	' ' nr_recibo,
	0 ie_forma_tributacao,
	0 ie_qualificacao_pj,
	0 ie_pj_balanco,
	0 ie_pj_scp,
	0 ie_pj_inativa,
	0 ie_pj_regime_especial,
	0 ie_pj_dctf_semestral,
	' ' cd_natureza_juridica,
	' ' ds_logradouro,
	' ' ds_numero,
	' ' ds_complemento,
	' ' ds_bairro,
	' ' ds_municipio,
	' ' nr_cep,
	' ' nr_ddd_telefone,
	' ' nr_telefone,
	' ' nr_ddd_fax,
	' ' nr_fax,
	' ' nr_caixa_postal,
	' ' ds_uf_caixa_postal,
	' ' nr_cep_caixa_postal,
	' ' ds_email,
	' ' nm_representante,
	' ' nr_cpf_representante,
	' ' nr_ddd_telefone_representante,
	' ' nr_telefone_representante,
	' ' nr_ramal_representante,
	' ' nr_ddd_fax_representante,
	' ' nr_fax_representante,
	' ' ds_email_representante,
	' ' nm_responsavel,
	' ' nr_cpf_resp,
	' ' ds_crc_resp,
	' ' ds_uf_crc_resp,
	' ' nr_ddd_telefone_resp,
	' ' nr_telefone_resp,
	' ' nr_ramal_resp,
	' ' nr_ddd_fax_resp,
	' ' nr_fax_resp,
	' ' ds_email_resp,
	d.ie_grupo_tributo
	nr_grupo_tributo,
	d.cd_darf|| lpad(coalesce(d.cd_variacao,d.cd_variacao),2,'0')	cd_receita,
	coalesce(d.ie_periodicidade,d.ie_periodicidade)
	ds_periodicidade,
	a.dt_referencia
	nr_ano_apuracao,
CASE WHEN coalesce(d.ie_periodicidade,d.ie_periodicidade)='T' THEN obter_periodo_data(d.dt_apuracao,'T') WHEN coalesce(d.ie_periodicidade,d.ie_periodicidade)='U' THEN obter_periodo_data(d.dt_apuracao,'U') WHEN coalesce(d.ie_periodicidade,d.ie_periodicidade)='B' THEN obter_periodo_data(d.dt_apuracao,'B') WHEN coalesce(d.ie_periodicidade,d.ie_periodicidade)='E' THEN obter_periodo_data(d.dt_apuracao,'E') WHEN coalesce(d.ie_periodicidade,d.ie_periodicidade)='A' THEN '00'  ELSE obter_periodo_data(d.dt_apuracao,'M') END 
dt_apuracao_mensal,
CASE WHEN coalesce(d.ie_periodicidade,d.ie_periodicidade)='S' THEN obter_periodo_data(d.dt_apuracao,'S') WHEN coalesce(d.ie_periodicidade,d.ie_periodicidade)='X' THEN obter_periodo_data(d.dt_apuracao,'X') WHEN coalesce(d.ie_periodicidade,d.ie_periodicidade)='Q' THEN obter_periodo_data(d.dt_apuracao,'Q') WHEN coalesce(d.ie_periodicidade,d.ie_periodicidade)='D' THEN obter_periodo_data(d.dt_apuracao,'D')  ELSE '00' END  dt_apuracao_diario,
CASE WHEN d.ie_grupo_tributo='03' THEN substr(c.cd_cgc,9,6) WHEN d.ie_grupo_tributo='09' THEN substr(c.cd_cgc,9,6)  ELSE '000000' END  nr_ordem_estab,
	CASE WHEN d.ie_grupo_tributo='10' THEN c.cd_cgc  ELSE '00000000000000' END 
nr_cnpj_incorporacao,
	0 vl_debito,
	0 ie_balanco_reducao,
	0 ie_saldo_quotas,
	d.dt_apuracao 			dt_periodo_apuracao,
	c.cd_cgc			nr_cnpj_darf,
	substr(d.cd_darf,1,4)		cd_receita_darf,
	d.dt_vencimento			dt_vencimento,
	d.nr_referencia			nr_referencia,
	obter_valor_total_darf_princ(d.nr_sequencia) - coalesce(d.vl_multa,0) - coalesce(d.vl_juros,0) vl_principal,
	coalesce(d.vl_multa,0)		vl_multa,
	coalesce(d.vl_juros,0)		vl_juros,
	obter_valor_total_darf_princ(d.nr_sequencia) - coalesce(d.vl_multa,0) - coalesce(d.vl_juros,0) vl_pago_debito,--obter_valor_pago_darf(d.nr_sequencia) vl_pago_debito,
	0 nr_trimestre_apuracao,
	0 nr_quota,
	0 qt_registros,
	' ' ds_hashcode,
	d.nr_sequencia
from	dctf_lote a,
	dctf_lote_externo c,
	dctf_lote_ext_darf d
where	a.nr_sequencia		= c.nr_seq_lote
and	c.nr_sequencia		= d.nr_Seq_lote_ext
and	a.nr_sequencia		= nr_seq_lote_p
and	a.ie_agrupar_titulos	= 'S'
and	d.cd_darf|| lpad(coalesce(d.cd_variacao,d.cd_variacao),2,'0')	= cd_receita_w
and	CASE WHEN coalesce(d.ie_periodicidade,d.ie_periodicidade)='T' THEN obter_periodo_data(d.dt_apuracao,'T') WHEN coalesce(d.ie_periodicidade,d.ie_periodicidade)='U' THEN obter_periodo_data(d.dt_apuracao,'U') WHEN coalesce(d.ie_periodicidade,d.ie_periodicidade)='B' THEN obter_periodo_data(d.dt_apuracao,'B') WHEN coalesce(d.ie_periodicidade,d.ie_periodicidade)='E' THEN obter_periodo_data(d.dt_apuracao,'E') WHEN coalesce(d.ie_periodicidade,d.ie_periodicidade)='A' THEN '00'  ELSE obter_periodo_data(d.dt_apuracao,'M') END  	= dt_apuracao_mensal_w
and	CASE WHEN coalesce(d.ie_periodicidade,d.ie_periodicidade)='S' THEN obter_periodo_data(d.dt_apuracao,'S') WHEN coalesce(d.ie_periodicidade,d.ie_periodicidade)='X' THEN obter_periodo_data(d.dt_apuracao,'X') WHEN coalesce(d.ie_periodicidade,d.ie_periodicidade)='Q' THEN obter_periodo_data(d.dt_apuracao,'Q') WHEN coalesce(d.ie_periodicidade,d.ie_periodicidade)='D' THEN obter_periodo_data(d.dt_apuracao,'D')  ELSE '00' END  = dt_apuracao_diario_w

UNION

SELECT	DISTINCT 6
ie_tipo_registro,
	a.nr_sequencia					nr_seq_lote,
	' ' ds_registro,
	0 ie_tipo_declaracao,
	b.cd_cgc					nr_cnpj,
	0 nr_versao,
	' ' nm_empresarial,
	' ' sg_uf,
	a.ie_finalidade_dctf				ie_situacao,
	clock_timestamp() nr_ano_declaracao,
	clock_timestamp() nr_mes_declaracao,
	TRUNC(a.dt_referencia,'mm')			dt_periodo_inicial,
	TRUNC(fim_mes(a.dt_referencia),'dd')		dt_periodo_final,
	CASE WHEN a.ie_finalidade_dctf=00 THEN '00000000'  ELSE clock_timestamp() END  dt_ocorrencia_evento,
	'R11'						ie_tipo,
	TRUNC(a.dt_referencia,'mm')			nr_mes_ocorrencia,
	clock_timestamp() dt_inicio,
	clock_timestamp() dt_fim,
	0 nr_declaracao,
	' ' nr_recibo,
	0 ie_forma_tributacao,
	0 ie_qualificacao_pj,
	0 ie_pj_balanco,
	0 ie_pj_scp,
	0 ie_pj_inativa,
	0 ie_pj_regime_especial,
	0 ie_pj_dctf_semestral,
	' ' cd_natureza_juridica,
	' ' ds_logradouro,
	' ' ds_numero,
	' ' ds_complemento,
	' ' ds_bairro,
	' ' ds_municipio,
	' ' nr_cep,
	' ' nr_ddd_telefone,
	' ' nr_telefone,
	' ' nr_ddd_fax,
	' ' nr_fax,
	' ' nr_caixa_postal,
	' ' ds_uf_caixa_postal,
	' ' nr_cep_caixa_postal,
	' ' ds_email,
	' ' nm_representante,
	' ' nr_cpf_representante,
	' ' nr_ddd_telefone_representante,
	' ' nr_telefone_representante,
	' ' nr_ramal_representante,
	' ' nr_ddd_fax_representante,
	' ' nr_fax_representante,
	' ' ds_email_representante,
	' ' nm_responsavel,
	' ' nr_cpf_resp,
	' ' ds_crc_resp,
	' ' ds_uf_crc_resp,
	' ' nr_ddd_telefone_resp,
	' ' nr_telefone_resp,
	' ' nr_ramal_resp,
	' ' nr_ddd_fax_resp,
	' ' nr_fax_resp,
	' ' ds_email_resp,
	g.ie_grupo_tributo
	nr_grupo_tributo,
	d.cd_darf|| lpad(CASE WHEN coalesce(coalesce(i.cd_variacao,f.cd_variacao)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'V')  ELSE coalesce(i.cd_variacao,f.cd_variacao) END ,2,'0')	cd_receita,
	CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN 	obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END 
	ds_periodicidade,
	a.dt_referencia
	nr_ano_apuracao,
CASE WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='T' THEN obter_periodo_data(d.dt_apuracao,'T') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='U' THEN obter_periodo_data(d.dt_apuracao,'U') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='B' THEN obter_periodo_data(d.dt_apuracao,'B') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='E' THEN obter_periodo_data(d.dt_apuracao,'E') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='A' THEN '00'  ELSE obter_periodo_data(d.dt_apuracao,'M') END 
dt_apuracao_mensal,
CASE WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='S' THEN obter_periodo_data(d.dt_apuracao,'S') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='X' THEN obter_periodo_data(d.dt_apuracao,'X') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='Q' THEN obter_periodo_data(d.dt_apuracao,'Q') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='D' THEN obter_periodo_data(d.dt_apuracao,'D')  ELSE '00' END  dt_apuracao_diario,
CASE WHEN g.ie_grupo_tributo='03' THEN SUBSTR(b.cd_cgc,9,6) WHEN g.ie_grupo_tributo='09' THEN SUBSTR(b.cd_cgc,9,6)  ELSE '000000' END  nr_ordem_estab,
	CASE WHEN g.ie_grupo_tributo='10' THEN b.cd_cgc  ELSE '00000000000000' END 
nr_cnpj_incorporacao,
	0 vl_debito,
	0 ie_balanco_reducao,
	0 ie_saldo_quotas,
	d.dt_apuracao 			dt_periodo_apuracao,
	b.cd_cgc			nr_cnpj_darf,
	SUBSTR(d.cd_darf,1,4)		cd_receita_darf,
	d.dt_vencimento			dt_vencimento,
	d.nr_referencia			nr_referencia,
	obter_valor_total_darf_princ(d.nr_sequencia) - coalesce(d.vl_multa,0) - coalesce(d.vl_juros,0) vl_principal,
	coalesce(i.vl_saldo_multa,0)		vl_multa,
	coalesce(i.vl_saldo_juros,0)		vl_juros,
	obter_valor_total_darf_princ(d.nr_sequencia) - coalesce(d.vl_multa,0) - coalesce(d.vl_juros,0) vl_pago_debito,---obter_valor_pago_darf(d.nr_sequencia) vl_pago_debito,
	0 nr_trimestre_apuracao,
	0 nr_quota,
	0 qt_registros,
	' ' ds_hashcode,
	d.nr_sequencia
FROM tributo g, darf_titulo_pagar e, darf d, dctf_lote_darf c, estabelecimento b, dctf_lote a, titulo_pagar i
LEFT OUTER JOIN titulo_pagar_baixa j ON (i.nr_titulo = j.nr_titulo)
LEFT OUTER JOIN titulo_pagar_imposto f ON (i.nr_seq_tributo = f.nr_sequencia)
WHERE a.cd_estabelecimento	= b.cd_estabelecimento AND a.nr_sequencia		= c.nr_seq_lote AND c.nr_seq_darf		= d.nr_sequencia AND d.nr_sequencia		= e.nr_seq_darf AND e.nr_titulo		= i.nr_titulo   AND (f.cd_tributo		= g.cd_tributo OR i.cd_tributo = g.cd_tributo) AND a.nr_sequencia		= nr_seq_lote_p and a.ie_agrupar_titulos	= 'N' AND d.cd_darf|| lpad(CASE WHEN coalesce(coalesce(i.cd_variacao,f.cd_variacao)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'V')  ELSE coalesce(i.cd_variacao,f.cd_variacao) END ,2,'0')	= cd_receita_w AND CASE WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='T' THEN obter_periodo_data(d.dt_apuracao,'T') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='U' THEN obter_periodo_data(d.dt_apuracao,'U') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='B' THEN obter_periodo_data(d.dt_apuracao,'B') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='E' THEN obter_periodo_data(d.dt_apuracao,'E') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='A' THEN '00'  ELSE obter_periodo_data(d.dt_apuracao,'M') END  	= dt_apuracao_mensal_w AND CASE WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='S' THEN obter_periodo_data(d.dt_apuracao,'S') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='X' THEN obter_periodo_data(d.dt_apuracao,'X') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='Q' THEN obter_periodo_data(d.dt_apuracao,'Q') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='D' THEN obter_periodo_data(d.dt_apuracao,'D')  ELSE '00' END  = dt_apuracao_diario_w GROUP BY 	a.nr_sequencia,
	b.cd_cgc,
	a.ie_finalidade_dctf,
	TRUNC(a.dt_referencia,'mm'),
	TRUNC(fim_mes(a.dt_referencia),'dd'),
	CASE WHEN a.ie_finalidade_dctf=00 THEN '00000000'  ELSE clock_timestamp() END ,
	TRUNC(a.dt_referencia,'mm'),
	g.ie_grupo_tributo,
	d.cd_darf|| lpad(CASE WHEN coalesce(coalesce(i.cd_variacao,f.cd_variacao)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'V')  ELSE coalesce(i.cd_variacao,f.cd_variacao) END ,2,'0'),
	CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN 	obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ,
	a.dt_referencia,
	CASE WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='T' THEN obter_periodo_data(d.dt_apuracao,'T') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='U' THEN obter_periodo_data(d.dt_apuracao,'U') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='B' THEN obter_periodo_data(d.dt_apuracao,'B') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='E' THEN obter_periodo_data(d.dt_apuracao,'E') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='A' THEN '00'  ELSE obter_periodo_data(d.dt_apuracao,'M') END ,
	CASE WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='S' THEN obter_periodo_data(d.dt_apuracao,'S') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='X' THEN obter_periodo_data(d.dt_apuracao,'X') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='Q' THEN obter_periodo_data(d.dt_apuracao,'Q') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='D' THEN obter_periodo_data(d.dt_apuracao,'D')  ELSE '00' END ,
	CASE WHEN g.ie_grupo_tributo='03' THEN SUBSTR(b.cd_cgc,9,6) WHEN g.ie_grupo_tributo='09' THEN SUBSTR(b.cd_cgc,9,6)  ELSE '000000' END ,
	CASE WHEN g.ie_grupo_tributo='10' THEN b.cd_cgc  ELSE '00000000000000' END ,
	d.dt_apuracao,
	b.cd_cgc,
	SUBSTR(d.cd_darf,1,4),
	d.dt_vencimento,
	d.nr_referencia,
	coalesce(i.vl_saldo_multa,0),
	coalesce(i.vl_saldo_juros,0),
	coalesce(d.vl_multa,0),
	coalesce(d.vl_juros,0),
	i.nr_titulo,
	d.nr_sequencia;

/*cursor c05 is
/* Outras Compensaes - Tipo R13 */

/*select	distinct 7 ie_tipo_registro,
	a.nr_sequencia nr_seq_lote,
	' ' ds_registro,
	0 ie_tipo_declaracao,
	b.cd_cgc	 nr_cnpj,
	0 nr_versao,
	' ' nm_empresarial,
	' ' sg_uf,
	a.ie_finalidade_dctf ie_situacao,
	sysdate nr_ano_declaracao,
	sysdate nr_mes_declaracao,
	TRUNC(a.dt_referencia,'mm') dt_periodo_inicial,
	trunc(fim_mes(a.dt_referencia),'dd') dt_periodo_final,
	decode(a.ie_finalidade_dctf,00,'00000000',sysdate) dt_ocorrencia_evento,
	'R13' ie_tipo,
	TRUNC(a.dt_referencia,'mm') nr_mes_ocorrencia,
	SYSDATE dt_inicio,
	SYSDATE dt_fim,
	0 nr_declaracao,
	' ' nr_recibo,
	0 ie_forma_tributacao,
	0 ie_qualificacao_pj,
	0 ie_pj_balanco,
	0 ie_pj_scp,
	0 ie_pj_inativa,
	0 ie_pj_regime_especial,
	0 ie_pj_dctf_semestral,
	' ' cd_natureza_juridica,
	' ' ds_logradouro,
	' ' ds_numero,
	' ' ds_complemento,
	' ' ds_bairro,
	' ' ds_municipio,
	' ' nr_cep,
	' ' nr_ddd_telefone,
	' ' nr_telefone,
	' ' nr_ddd_fax,
	' ' nr_fax,
	' ' nr_caixa_postal,
	' ' ds_uf_caixa_postal,
	' ' nr_cep_caixa_postal,
	' ' ds_email,
	' ' nm_representante,
	' ' nr_cpf_representante,
	' ' nr_ddd_telefone_representante,
	' ' nr_telefone_representante,
	' ' nr_ramal_representante,
	' ' nr_ddd_fax_representante,
	' ' nr_fax_representante,
	' ' ds_email_representante,
	' ' nm_responsavel,
	' ' nr_cpf_resp,
	' ' ds_crc_resp,
	' ' ds_uf_crc_resp,
	' ' nr_ddd_telefone_resp,
	' ' nr_telefone_resp,
	' ' nr_ramal_resp,
	' ' nr_ddd_fax_resp,
	' ' nr_fax_resp,
	' ' ds_email_resp,
	g.ie_grupo_tributo
	nr_grupo_tributo,
	d.cd_darf|| lpad(decode(nvl(i.cd_variacao,f.cd_variacao),null,obter_cd_darf_variacao(g.cd_tributo,'V'),nvl(i.cd_variacao,f.cd_variacao)),2,'0') cd_receita,
	decode(nvl(i.ie_periodicidade,f.ie_periodicidade),null,obter_cd_darf_variacao(g.cd_tributo,'P'),nvl(i.ie_periodicidade,f.ie_periodicidade)) ds_periodicidade,
	a.dt_referencia nr_ano_apuracao,
	decode(nvl(i.ie_periodicidade,f.ie_periodicidade),'T',obter_periodo_data(d.dt_apuracao,'T'),'U',obter_periodo_data(d.dt_apuracao,'U'),'B',obter_periodo_data(d.dt_apuracao,'B'),'E',obter_periodo_data(d.dt_apuracao,'E'),'A','00',obter_periodo_data(d.dt_apuracao,'M')) dt_apuracao_mensal,
	decode(nvl(i.ie_periodicidade,f.ie_periodicidade),'S',obter_periodo_data(d.dt_apuracao,'S'),'X',obter_periodo_data(d.dt_apuracao,'X'),'Q',obter_periodo_data(d.dt_apuracao,'Q'),'D',obter_periodo_data(d.dt_apuracao,'D'),'00') dt_apuracao_diario,
	decode(g.ie_grupo_tributo,'03',substr(b.cd_cgc,9,6),'09',substr(b.cd_cgc,9,6),'000000') nr_ordem_estab,
	decode(g.ie_grupo_tributo,'10',b.cd_cgc,'00000000000000') nr_cnpj_incorporacao,
	0 vl_debito,
	0 ie_balanco_reducao,
	0 ie_saldo_quotas,
	d.dt_apuracao dt_periodo_apuracao,
	b.cd_cgc nr_cnpj_darf,
	substr(d.cd_darf,1,4) cd_receita_darf,
	d.dt_vencimento dt_vencimento,
	d.nr_referencia nr_referencia,
	obter_valor_darf(d.nr_sequencia) vl_principal,
	nvl(d.vl_multa,0) vl_multa,
	nvl(d.vl_juros,0) vl_juros,
	substr(elimina_caractere_especial(d.vl_compensado_debito), 1, 14) vl_compensado_debito,
	0 nr_trimestre_apuracao,
	0 nr_quota,
	0 qt_registros,
	' ' ds_hashcode,
	d.nr_sequencia,
	d.cd_tipo_credito,
	d.cd_processo_dcomp,
	d.ie_formalizacao_pedido
from	dctf_lote a,
	estabelecimento b,
	dctf_lote_darf c,
	darf d,
	darf_titulo_pagar e,
	titulo_pagar_imposto f,
	tributo g,
	titulo_pagar i
where	a.cd_estabelecimento	= b.cd_estabelecimento
and	a.nr_sequencia		= c.nr_seq_lote
and	c.nr_seq_darf		= d.nr_sequencia
and	d.nr_sequencia		= e.nr_seq_darf
and	e.nr_titulo		= i.nr_titulo
and	i.nr_seq_tributo		= f.nr_sequencia(+)
and	(f.cd_tributo		= g.cd_tributo or i.cd_tributo = g.cd_tributo)
and	a.nr_sequencia		= nr_seq_lote_p
and	a.ie_agrupar_titulos	= 'S'
and	d.cd_tipo_credito is not null
and	d.cd_darf|| lpad(nvl(i.cd_variacao,f.cd_variacao),2,'0')	= cd_receita_w
and	decode(nvl(i.ie_periodicidade,f.ie_periodicidade),'T',obter_periodo_data(d.dt_apuracao,'T'),'U',obter_periodo_data(d.dt_apuracao,'U'),'B',obter_periodo_data
	(d.dt_apuracao,'B'),'E',obter_periodo_data(d.dt_apuracao,'E'),'A','00',obter_periodo_data(d.dt_apuracao,'M')) 	= dt_apuracao_mensal_w
and	decode(nvl(i.ie_periodicidade,f.ie_periodicidade),'S',obter_periodo_data(d.dt_apuracao,'S'),'X',obter_periodo_data(d.dt_apuracao,'X'),'Q',obter_periodo_data
	(d.dt_apuracao,'Q'),'D',obter_periodo_data(d.dt_apuracao,'D'),'00') = dt_apuracao_diario_w
group by
 	a.nr_sequencia,
	b.cd_cgc,
	a.ie_finalidade_dctf,
	TRUNC(a.dt_referencia,'mm'),
	trunc(fim_mes(a.dt_referencia),'dd'),
	decode(a.ie_finalidade_dctf,00,'00000000',sysdate),
	TRUNC(a.dt_referencia,'mm'),
	g.ie_grupo_tributo,
	d.cd_darf|| lpad(decode(nvl(i.cd_variacao,f.cd_variacao),null,obter_cd_darf_variacao(g.cd_tributo,'V'),nvl(i.cd_variacao,f.cd_variacao)),2,'0'),
	decode(nvl(i.ie_periodicidade,f.ie_periodicidade),null,obter_cd_darf_variacao(g.cd_tributo,'P'),nvl(i.ie_periodicidade,f.ie_periodicidade)),
	a.dt_referencia,
	decode(nvl(i.ie_periodicidade,f.ie_periodicidade),'T',obter_periodo_data(d.dt_apuracao,'T'),'U',obter_periodo_data(d.dt_apuracao,'U'),'B',obter_periodo_data(d.dt_apuracao,'B'),'E',obter_periodo_data(d.dt_apuracao,'E'),'A','00',obter_periodo_data(d.dt_apuracao,'M')),
	decode(nvl(i.ie_periodicidade,f.ie_periodicidade),'S',obter_periodo_data(d.dt_apuracao,'S'),'X',obter_periodo_data(d.dt_apuracao,'X'),'Q',obter_periodo_data(d.dt_apuracao,'Q'),'D',obter_periodo_data(d.dt_apuracao,'D'),'00'),
	decode(g.ie_grupo_tributo,'03',substr(b.cd_cgc,9,6),'09',substr(b.cd_cgc,9,6),'000000'),
	decode(g.ie_grupo_tributo,'10',b.cd_cgc,'00000000000000'),
	d.dt_apuracao,
	b.cd_cgc,
	substr(d.cd_darf,1,4),
	d.dt_vencimento,
	d.nr_referencia,
	obter_valor_darf(d.nr_sequencia),
	nvl(d.vl_multa,0),
	nvl(d.vl_juros,0),
	d.vl_compensado_debito,
	d.nr_sequencia,
	d.cd_tipo_credito,
	d.cd_processo_dcomp,
	d.ie_formalizacao_pedido
union
SELECT	DISTINCT 7 ie_tipo_registro,
	a.nr_sequencia nr_seq_lote,
	' ' ds_registro,
	0 ie_tipo_declaracao,
	b.cd_cgc nr_cnpj,
	0 nr_versao,
	' ' nm_empresarial,
	' ' sg_uf,
	a.ie_finalidade_dctf ie_situacao,
	SYSDATE nr_ano_declaracao,
	SYSDATE nr_mes_declaracao,
	TRUNC(a.dt_referencia,'mm') dt_periodo_inicial,
	TRUNC(fim_mes(a.dt_referencia),'dd') dt_periodo_final,
	DECODE(a.ie_finalidade_dctf,00,'00000000',SYSDATE) dt_ocorrencia_evento,
	'R13' ie_tipo,
	TRUNC(a.dt_referencia,'mm') nr_mes_ocorrencia,
	SYSDATE dt_inicio,
	SYSDATE dt_fim,
	0 nr_declaracao,
	' ' nr_recibo,
	0 ie_forma_tributacao,
	0 ie_qualificacao_pj,
	0 ie_pj_balanco,
	0 ie_pj_scp,
	0 ie_pj_inativa,
	0 ie_pj_regime_especial,
	0 ie_pj_dctf_semestral,
	' ' cd_natureza_juridica,
	' ' ds_logradouro,
	' ' ds_numero,
	' ' ds_complemento,
	' ' ds_bairro,
	' ' ds_municipio,
	' ' nr_cep,
	' ' nr_ddd_telefone,
	' ' nr_telefone,
	' ' nr_ddd_fax,
	' ' nr_fax,
	' ' nr_caixa_postal,
	' ' ds_uf_caixa_postal,
	' ' nr_cep_caixa_postal,
	' ' ds_email,
	' ' nm_representante,
	' ' nr_cpf_representante,
	' ' nr_ddd_telefone_representante,
	' ' nr_telefone_representante,
	' ' nr_ramal_representante,
	' ' nr_ddd_fax_representante,
	' ' nr_fax_representante,
	' ' ds_email_representante,
	' ' nm_responsavel,
	' ' nr_cpf_resp,
	' ' ds_crc_resp,
	' ' ds_uf_crc_resp,
	' ' nr_ddd_telefone_resp,
	' ' nr_telefone_resp,
	' ' nr_ramal_resp,
	' ' nr_ddd_fax_resp,
	' ' nr_fax_resp,
	' ' ds_email_resp,
	g.ie_grupo_tributo
	nr_grupo_tributo,
	d.cd_darf|| lpad(decode(NVL(i.cd_variacao,f.cd_variacao),null,obter_cd_darf_variacao(g.cd_tributo,'V'),NVL(i.cd_variacao,f.cd_variacao)),2,'0') cd_receita,
	decode(NVL(i.ie_periodicidade,f.ie_periodicidade),null,obter_cd_darf_variacao(g.cd_tributo,'P'),NVL(i.ie_periodicidade,f.ie_periodicidade)) ds_periodicidade,
	a.dt_referencia nr_ano_apuracao,
	DECODE(NVL(i.ie_periodicidade,f.ie_periodicidade),'T',obter_periodo_data(d.dt_apuracao,'T'),'U',obter_periodo_data(d.dt_apuracao,'U'),'B',obter_periodo_data(d.dt_apuracao,'B'),'E',obter_periodo_data(d.dt_apuracao,'E'),'A','00',obter_periodo_data(d.dt_apuracao,'M')) dt_apuracao_mensal,
	DECODE(NVL(i.ie_periodicidade,f.ie_periodicidade),'S',obter_periodo_data(d.dt_apuracao,'S'),'X',obter_periodo_data(d.dt_apuracao,'X'),'Q',obter_periodo_data(d.dt_apuracao,'Q'),'D',obter_periodo_data(d.dt_apuracao,'D'),'00') dt_apuracao_diario,
	DECODE(g.ie_grupo_tributo,'03',SUBSTR(b.cd_cgc,9,6),'09',SUBSTR(b.cd_cgc,9,6),'000000') nr_ordem_estab,
	DECODE(g.ie_grupo_tributo,'10',b.cd_cgc,'00000000000000') nr_cnpj_incorporacao,
	0 vl_debito,
	0 ie_balanco_reducao,
	0 ie_saldo_quotas,
	d.dt_apuracao dt_periodo_apuracao,
	b.cd_cgc nr_cnpj_darf,
	SUBSTR(d.cd_darf,1,4) cd_receita_darf,
	d.dt_vencimento dt_vencimento,
	d.nr_referencia nr_referencia,
	obter_valor_darf(d.nr_sequencia) vl_principal,
	NVL(i.vl_saldo_multa,0) vl_multa,
	NVL(i.vl_saldo_juros,0) vl_juros,
	substr(elimina_caractere_especial(d.vl_compensado_debito), 1, 14) vl_compensado_debito,
	0 nr_trimestre_apuracao,
	0 nr_quota,
	0 qt_registros,
	' ' ds_hashcode,
	d.nr_sequencia,
	d.cd_tipo_credito, -- varchar
	d.cd_processo_dcomp, --varchar
	d.ie_formalizacao_pedido -- number
FROM	dctf_lote a,
	estabelecimento b,
	dctf_lote_darf c,
	darf d,
	darf_titulo_pagar e,
	titulo_pagar_imposto f,
	tributo g,
	titulo_pagar i,
	titulo_pagar_baixa j
WHERE	a.cd_estabelecimento	= b.cd_estabelecimento
AND	a.nr_sequencia		= c.nr_seq_lote
AND	c.nr_seq_darf		= d.nr_sequencia
AND	d.nr_sequencia		= e.nr_seq_darf
AND	e.nr_titulo		= i.nr_titulo
and	i.nr_titulo		= j.nr_titulo(+)
AND	i.nr_seq_tributo		= f.nr_sequencia(+)
AND	(f.cd_tributo		= g.cd_tributo OR i.cd_tributo = g.cd_tributo)
AND	a.nr_sequencia		= nr_seq_lote_p
and	a.ie_agrupar_titulos	= 'N'
and	d.cd_tipo_credito is not null
AND	d.cd_darf|| lpad(NVL(i.cd_variacao,f.cd_variacao),2,'0')	= cd_receita_w
AND	DECODE(NVL(i.ie_periodicidade,f.ie_periodicidade),'T',obter_periodo_data(d.dt_apuracao,'T'),'U',obter_periodo_data(d.dt_apuracao,'U'),'B',obter_periodo_data
	(d.dt_apuracao,'B'),'E',obter_periodo_data(d.dt_apuracao,'E'),'A','00',obter_periodo_data(d.dt_apuracao,'M')) 	= dt_apuracao_mensal_w
AND	DECODE(NVL(i.ie_periodicidade,f.ie_periodicidade),'S',obter_periodo_data(d.dt_apuracao,'S'),'X',obter_periodo_data(d.dt_apuracao,'X'),'Q',obter_periodo_data
	(d.dt_apuracao,'Q'),'D',obter_periodo_data(d.dt_apuracao,'D'),'00') = dt_apuracao_diario_w
GROUP BY
 	a.nr_sequencia,
	b.cd_cgc,
	a.ie_finalidade_dctf,
	TRUNC(a.dt_referencia,'mm'),
	TRUNC(fim_mes(a.dt_referencia),'dd'),
	DECODE(a.ie_finalidade_dctf,00,'00000000',SYSDATE),
	TRUNC(a.dt_referencia,'mm'),
	g.ie_grupo_tributo,
	d.cd_darf|| lpad(decode(NVL(i.cd_variacao,f.cd_variacao),null,obter_cd_darf_variacao(g.cd_tributo,'V'),NVL(i.cd_variacao,f.cd_variacao)),2,'0'),
	decode(NVL(i.ie_periodicidade,f.ie_periodicidade),null,obter_cd_darf_variacao(g.cd_tributo,'P'),NVL(i.ie_periodicidade,f.ie_periodicidade)),
	a.dt_referencia,
	DECODE(NVL(i.ie_periodicidade,f.ie_periodicidade),'T',obter_periodo_data(d.dt_apuracao,'T'),'U',obter_periodo_data(d.dt_apuracao,'U'),'B',obter_periodo_data(d.dt_apuracao,'B'),'E',obter_periodo_data(d.dt_apuracao,'E'),'A','00',obter_periodo_data(d.dt_apuracao,'M')),
	DECODE(NVL(i.ie_periodicidade,f.ie_periodicidade),'S',obter_periodo_data(d.dt_apuracao,'S'),'X',obter_periodo_data(d.dt_apuracao,'X'),'Q',obter_periodo_data(d.dt_apuracao,'Q'),'D',obter_periodo_data(d.dt_apuracao,'D'),'00'),
	DECODE(g.ie_grupo_tributo,'03',SUBSTR(b.cd_cgc,9,6),'09',SUBSTR(b.cd_cgc,9,6),'000000'),
	DECODE(g.ie_grupo_tributo,'10',b.cd_cgc,'00000000000000'),
	d.dt_apuracao,
	b.cd_cgc,
	SUBSTR(d.cd_darf,1,4),
	d.dt_vencimento,
	d.nr_referencia,
	NVL(i.vl_saldo_multa,0),
	NVL(i.vl_saldo_juros,0),
	d.vl_compensado_debito,
	i.nr_titulo,
	d.nr_sequencia,
	d.cd_tipo_credito,
	d.cd_processo_dcomp,
	d.ie_formalizacao_pedido
union
SELECT	DISTINCT 7 ie_tipo_registro,
	a.nr_sequencia nr_seq_lote,
	' ' ds_registro,
	0 ie_tipo_declaracao,
	b.cd_cgc nr_cnpj,
	0 nr_versao,
	' ' nm_empresarial,
	' ' sg_uf,
	a.ie_finalidade_dctf ie_situacao,
	SYSDATE nr_ano_declaracao,
	SYSDATE nr_mes_declaracao,
	TRUNC(a.dt_referencia,'mm') dt_periodo_inicial,
	TRUNC(fim_mes(a.dt_referencia),'dd') dt_periodo_final,
	DECODE(a.ie_finalidade_dctf,00,'00000000',SYSDATE) dt_ocorrencia_evento,
	'R13' ie_tipo,
	TRUNC(a.dt_referencia,'mm') nr_mes_ocorrencia,
	SYSDATE dt_inicio,
	SYSDATE dt_fim,
	0 nr_declaracao,
	' ' nr_recibo,
	0 ie_forma_tributacao,
	0 ie_qualificacao_pj,
	0 ie_pj_balanco,
	0 ie_pj_scp,
	0 ie_pj_inativa,
	0 ie_pj_regime_especial,
	0 ie_pj_dctf_semestral,
	' ' cd_natureza_juridica,
	' ' ds_logradouro,
	' ' ds_numero,
	' ' ds_complemento,
	' ' ds_bairro,
	' ' ds_municipio,
	' ' nr_cep,
	' ' nr_ddd_telefone,
	' ' nr_telefone,
	' ' nr_ddd_fax,
	' ' nr_fax,
	' ' nr_caixa_postal,
	' ' ds_uf_caixa_postal,
	' ' nr_cep_caixa_postal,
	' ' ds_email,
	' ' nm_representante,
	' ' nr_cpf_representante,
	' ' nr_ddd_telefone_representante,
	' ' nr_telefone_representante,
	' ' nr_ramal_representante,
	' ' nr_ddd_fax_representante,
	' ' nr_fax_representante,
	' ' ds_email_representante,
	' ' nm_responsavel,
	' ' nr_cpf_resp,
	' ' ds_crc_resp,
	' ' ds_uf_crc_resp,
	' ' nr_ddd_telefone_resp,
	' ' nr_telefone_resp,
	' ' nr_ramal_resp,
	' ' nr_ddd_fax_resp,
	' ' nr_fax_resp,
	' ' ds_email_resp,
	g.ie_grupo_tributo
	nr_grupo_tributo,
	d.cd_darf|| lpad(decode(NVL(i.cd_variacao,f.cd_variacao),null,obter_cd_darf_variacao(g.cd_tributo,'V'),NVL(i.cd_variacao,f.cd_variacao)),2,'0') cd_receita,
	decode(NVL(i.ie_periodicidade,f.ie_periodicidade),null,obter_cd_darf_variacao(g.cd_tributo,'P'),NVL(i.ie_periodicidade,f.ie_periodicidade)) ds_periodicidade,
	a.dt_referencia nr_ano_apuracao,
	DECODE(NVL(i.ie_periodicidade,f.ie_periodicidade),'T',obter_periodo_data(d.dt_apuracao,'T'),'U',obter_periodo_data(d.dt_apuracao,'U'),'B',obter_periodo_data(d.dt_apuracao,'B'),'E',obter_periodo_data(d.dt_apuracao,'E'),'A','00',obter_periodo_data(d.dt_apuracao,'M')) dt_apuracao_mensal,
	DECODE(NVL(i.ie_periodicidade,f.ie_periodicidade),'S',obter_periodo_data(d.dt_apuracao,'S'),'X',obter_periodo_data(d.dt_apuracao,'X'),'Q',obter_periodo_data(d.dt_apuracao,'Q'),'D',obter_periodo_data(d.dt_apuracao,'D'),'00') dt_apuracao_diario,
	DECODE(g.ie_grupo_tributo,'03',SUBSTR(b.cd_cgc,9,6),'09',SUBSTR(b.cd_cgc,9,6),'000000') nr_ordem_estab,
	DECODE(g.ie_grupo_tributo,'10',b.cd_cgc,'00000000000000') nr_cnpj_incorporacao,
	0 vl_debito,
	0 ie_balanco_reducao,
	0 ie_saldo_quotas,
	d.dt_apuracao dt_periodo_apuracao,
	b.cd_cgc nr_cnpj_darf,
	SUBSTR(d.cd_darf,1,4) cd_receita_darf,
	d.dt_vencimento dt_vencimento,
	d.nr_referencia nr_referencia,
	obter_valor_darf(d.nr_sequencia) vl_principal,
	NVL(i.vl_saldo_multa,0) vl_multa,
	NVL(i.vl_saldo_juros,0) vl_juros,
	substr(elimina_caractere_especial(x.vl_perdcomp), 1, 14) vl_compensado_debito,
	0 nr_trimestre_apuracao,
	0 nr_quota,
	0 qt_registros,
	' ' ds_hashcode,
	d.nr_sequencia,
	x.cd_tipo_credito,
	x.cd_processo_dcomp,
	x.ie_formalizacao_pedido
from	dctf_lote a,
	estabelecimento b,
	dctf_lote_darf c,
	darf d,
	darf_titulo_pagar e,
	titulo_pagar_imposto f,
	tributo g,
	estab_dctf h,
	titulo_pagar i,
	darf_perdcomp x
where	a.cd_estabelecimento	= b.cd_estabelecimento
and	a.nr_sequencia		= c.nr_seq_lote
and	c.nr_seq_darf		= d.nr_sequencia
and	d.nr_sequencia		= e.nr_seq_darf
and	d.nr_sequencia		= x.nr_seq_darf
and	i.nr_seq_tributo	= f.nr_sequencia(+)
and	(f.cd_tributo		= g.cd_tributo or i.cd_tributo = g.cd_tributo)
and	h.cd_estabelecimento	= b.cd_estabelecimento
and	e.nr_titulo		= i.nr_titulo
and 	x.cd_tipo_credito 	 is not null
and	h.nr_sequencia		= (select	max(x.nr_sequencia)
				   from		estab_dctf x
				   where	trunc(x.dt_inicio_vigencia,'dd') <= trunc(sysdate,'dd')
				   and		b.cd_estabelecimento	= x.cd_estabelecimento)
and	a.nr_sequencia		= nr_seq_lote_p
and	d.cd_darf || lpad(decode(nvl(i.cd_variacao,f.cd_variacao),null,obter_cd_darf_variacao(g.cd_tributo,'V'),nvl(i.cd_variacao,f.cd_variacao)),2,'0') = cd_receita_w
and	decode(decode(nvl(i.ie_periodicidade,f.ie_periodicidade),null,obter_cd_darf_variacao(g.cd_tributo,'P'),nvl(i.ie_periodicidade,f.ie_periodicidade)),'T',
		obter_periodo_data(d.dt_apuracao,'T'),'U',
		obter_periodo_data(d.dt_apuracao,'U'),'B',
		obter_periodo_data(d.dt_apuracao,'B'),'E',
		obter_periodo_data(d.dt_apuracao,'E'),'A','00',
		obter_periodo_data(d.dt_apuracao,'M'))  = dt_apuracao_mensal_w
--decode(nvl(i.ie_periodicidade,f.ie_periodicidade),'T',obter_periodo_data(d.dt_apuracao,'T'),'U',obter_periodo_data(d.dt_apuracao,'U'),'B',obter_periodo_data(d.dt_apuracao,'B'),'E',obter_periodo_data(d.dt_apuracao,'E'),'A','00',obter_periodo_data(d.dt_apuracao,'M')) = dt_apuracao_mensal_w
and	decode(decode(nvl(i.ie_periodicidade,f.ie_periodicidade),null,obter_cd_darf_variacao(g.cd_tributo,'P'),nvl(i.ie_periodicidade,f.ie_periodicidade)),'S',
		obter_periodo_data(d.dt_apuracao,'S'),'X',
		obter_periodo_data(d.dt_apuracao,'X'),'Q',
		obter_periodo_data(d.dt_apuracao,'Q'),'D',
		obter_periodo_data(d.dt_apuracao,'D'),'00') = dt_apuracao_diario_w;*/
c06 CURSOR FOR
SELECT distinct 8		ie_tipo_registro,
	a.nr_sequencia		nr_seq_lote,
	' ' 			ds_registro,
	0 			ie_tipo_declaracao,
	lpad(b.cd_cgc,14,'0')	nr_cnpj,
	0 			nr_versao,
	' '			nm_empresarial,
	' ' 			sg_uf,
	a.ie_finalidade_dctf	ie_situacao,
	clock_timestamp() 		nr_ano_declaracao,
	clock_timestamp()			nr_mes_declaracao,
	TRUNC(a.dt_referencia,'mm') dt_periodo_inicial,
	trunc(fim_mes(a.dt_referencia),'dd') dt_periodo_final,
	CASE WHEN a.ie_finalidade_dctf=00 THEN '00000000'  ELSE clock_timestamp() END  dt_ocorrencia_evento,
	'R12' 			ie_tipo,
	TRUNC(a.dt_referencia,'mm') nr_mes_ocorrencia,
	clock_timestamp() dt_inicio,
	clock_timestamp() dt_fim,
	0 nr_declaracao,
	' ' nr_recibo,
	0 ie_forma_tributacao,
	0 ie_qualificacao_pj,
	0 ie_pj_balanco,
	0 ie_pj_scp,
	0 ie_pj_inativa,
	0 ie_pj_regime_especial,
	0 ie_pj_dctf_semestral,
	' ' cd_natureza_juridica,
	' ' ds_logradouro,
	' ' ds_numero,
	' ' ds_complemento,
	' ' ds_bairro,
	' ' ds_municipio,
	' ' nr_cep,
	' ' nr_ddd_telefone,
	' ' nr_telefone,
	' ' nr_ddd_fax,
	' ' nr_fax,
	' ' nr_caixa_postal,
	' ' ds_uf_caixa_postal,
	' ' nr_cep_caixa_postal,
	' ' ds_email,
	' ' nm_representante,
	' ' nr_cpf_representante,
	' ' nr_ddd_telefone_representante,
	' ' nr_telefone_representante,
	' ' nr_ramal_representante,
	' ' nr_ddd_fax_representante,
	' ' nr_fax_representante,
	' ' ds_email_representante,
	' ' nm_responsavel,
	' ' nr_cpf_resp,
	' ' ds_crc_resp,
	' ' ds_uf_crc_resp,
	' ' nr_ddd_telefone_resp,
	' ' nr_telefone_resp,
	' ' nr_ramal_resp,
	' ' nr_ddd_fax_resp,
	' ' nr_fax_resp,
	' ' ds_email_resp,
	substr(g.ie_grupo_tributo,1,2)	nr_grupo_tributo,
	d.cd_darf|| lpad(CASE WHEN coalesce(coalesce(i.cd_variacao,f.cd_variacao)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'V')  ELSE coalesce(i.cd_variacao,f.cd_variacao) END ,2,'0') cd_receita,
	CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END  ds_periodicidade,
	a.dt_referencia nr_ano_apuracao,
	CASE WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='T' THEN obter_periodo_data(d.dt_apuracao,'T') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='U' THEN obter_periodo_data(d.dt_apuracao,'U') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='B' THEN obter_periodo_data(d.dt_apuracao,'B') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='E' THEN obter_periodo_data(d.dt_apuracao,'E') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='A' THEN '00'  ELSE obter_periodo_data(d.dt_apuracao,'M') END  dt_apuracao_mensal,
	CASE WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='S' THEN obter_periodo_data(d.dt_apuracao,'S') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='X' THEN obter_periodo_data(d.dt_apuracao,'X') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='Q' THEN obter_periodo_data(d.dt_apuracao,'Q') WHEN coalesce(i.ie_periodicidade,f.ie_periodicidade)='D' THEN obter_periodo_data(d.dt_apuracao,'D')  ELSE '00' END  dt_apuracao_diario,
	lpad(CASE WHEN g.ie_grupo_tributo='03' THEN substr(b.cd_cgc,9,6) WHEN g.ie_grupo_tributo='09' THEN substr(b.cd_cgc,9,6)  ELSE '000000' END ,6,'0')  nr_ordem_estab,
	lpad(CASE WHEN g.ie_grupo_tributo='10' THEN b.cd_cgc  ELSE '00000000000000' END ,14,'0') nr_cnpj_incorporacao,
	0 vl_debito,
	0 ie_balanco_reducao,
	0 ie_saldo_quotas,
	d.dt_apuracao dt_periodo_apuracao,
	b.cd_cgc nr_cnpj_darf,
	substr(d.cd_darf,1,4) cd_receita_darf,
	d.dt_vencimento dt_vencimento,
	d.nr_referencia nr_referencia,
	obter_valor_darf(d.nr_sequencia) vl_principal,
	coalesce(d.vl_multa,0) vl_multa,
	coalesce(d.vl_juros,0) vl_juros,
	lpad(substr(elimina_caractere_especial(campo_mascara_virgula(x.vl_perdcomp)), 1, 14),14,'0') vl_compensado_debito,
	0 nr_trimestre_apuracao,
	0 nr_quota,
	0 qt_registros,
	' ' ds_hashcode,
	d.nr_sequencia,
	d.cd_tipo_credito,
	lpad(substr(elimina_caractere_especial(x.cd_processo_dcomp),1,24),24,'0'),
	substr(coalesce(x.ie_formalizacao_pedido,'0'),1,1)
FROM darf_perdcomp x, estab_dctf h, tributo g, darf_titulo_pagar e, darf d, dctf_lote_darf c, estabelecimento b, dctf_lote a, titulo_pagar i
LEFT OUTER JOIN titulo_pagar_imposto f ON (i.nr_seq_tributo = f.nr_sequencia)
WHERE a.cd_estabelecimento	= b.cd_estabelecimento and a.nr_sequencia		= c.nr_seq_lote and c.nr_seq_darf		= d.nr_sequencia and d.nr_sequencia		= e.nr_seq_darf and d.nr_sequencia		= x.nr_seq_darf  and (f.cd_tributo		= g.cd_tributo or i.cd_tributo = g.cd_tributo) and h.cd_estabelecimento	= b.cd_estabelecimento and e.nr_titulo		= i.nr_titulo --and 	x.cd_tipo_credito 	 is null
  and h.nr_sequencia		= (select	max(x.nr_sequencia)
				   from		estab_dctf x
				   where	trunc(x.dt_inicio_vigencia,'dd') <= trunc(clock_timestamp(),'dd')
				   and		b.cd_estabelecimento	= x.cd_estabelecimento) and a.nr_sequencia		= nr_seq_lote_p and d.cd_darf || lpad(CASE WHEN coalesce(coalesce(i.cd_variacao,f.cd_variacao)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'V')  ELSE coalesce(i.cd_variacao,f.cd_variacao) END ,2,'0') = cd_receita_w and CASE WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='T' THEN 		obter_periodo_data(d.dt_apuracao,'T') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='U' THEN 		obter_periodo_data(d.dt_apuracao,'U') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='B' THEN 		obter_periodo_data(d.dt_apuracao,'B') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='E' THEN 		obter_periodo_data(d.dt_apuracao,'E') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='A' THEN '00'  ELSE obter_periodo_data(d.dt_apuracao,'M') END   = dt_apuracao_mensal_w --decode(nvl(i.ie_periodicidade,f.ie_periodicidade),'T',obter_periodo_data(d.dt_apuracao,'T'),'U',obter_periodo_data(d.dt_apuracao,'U'),'B',obter_periodo_data(d.dt_apuracao,'B'),'E',obter_periodo_data(d.dt_apuracao,'E'),'A','00',obter_periodo_data(d.dt_apuracao,'M')) = dt_apuracao_mensal_w
  and CASE WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='S' THEN 		obter_periodo_data(d.dt_apuracao,'S') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='X' THEN 		obter_periodo_data(d.dt_apuracao,'X') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='Q' THEN 		obter_periodo_data(d.dt_apuracao,'Q') WHEN CASE WHEN coalesce(coalesce(i.ie_periodicidade,f.ie_periodicidade)::text, '') = '' THEN obter_cd_darf_variacao(g.cd_tributo,'P')  ELSE coalesce(i.ie_periodicidade,f.ie_periodicidade) END ='D' THEN 		obter_periodo_data(d.dt_apuracao,'D')  ELSE '00' END  = dt_apuracao_diario_w;
--and	decode(nvl(i.ie_periodicidade,f.ie_periodicidade),'S',obter_periodo_data(d.dt_apuracao,'S'),'X',obter_periodo_data(d.dt_apuracao,'X'),'Q',obter_periodo_data(d.dt_apuracao,'Q'),'D',obter_periodo_data(d.dt_apuracao,'D'),'00') = dt_apuracao_diario_w;
c04 CURSOR FOR
SELECT	9
	ie_tipo_registro,
	a.nr_sequencia					nr_seq_lote,
	' ' ds_registro,
	0 ie_tipo_declaracao,
	b.cd_cgc					nr_cnpj,
	0 nr_versao,
	' ' nm_empresarial,
	' ' sg_uf,
	a.ie_finalidade_dctf				ie_situacao,
	clock_timestamp() nr_ano_declaracao,
	clock_timestamp() nr_mes_declaracao,
	TRUNC(a.dt_referencia,'mm')
	dt_periodo_inicial,
	trunc(fim_mes(a.dt_referencia),'dd')
	dt_periodo_final,
	CASE WHEN a.ie_finalidade_dctf=00 THEN '00000000'  ELSE clock_timestamp() END
	dt_ocorrencia_evento,
	'T9'						ie_tipo,
	TRUNC(a.dt_referencia,'mm')
	nr_mes_ocorrencia,
	clock_timestamp() dt_inicio,
	clock_timestamp() dt_fim,
	0 nr_declaracao,
	' ' nr_recibo,
	0 ie_forma_tributacao,
	0 ie_qualificacao_pj,
	0 ie_pj_balanco,
	0 ie_pj_scp,
	0 ie_pj_inativa,
	0 ie_pj_regime_especial,
	0 ie_pj_dctf_semestral,
	' ' cd_natureza_juridica,
	' ' ds_logradouro,
	' ' ds_numero,
	' ' ds_complemento,
	' ' ds_bairro,
	' ' ds_municipio,
	' ' nr_cep,
	' ' nr_ddd_telefone,
	' ' nr_telefone,
	' ' nr_ddd_fax,
	' ' nr_fax,
	' ' nr_caixa_postal,
	' ' ds_uf_caixa_postal,
	' ' nr_cep_caixa_postal,
	' ' ds_email,
	' ' nm_representante,
	' ' nr_cpf_representante,
	' ' nr_ddd_telefone_representante,
	' ' nr_telefone_representante,
	' ' nr_ramal_representante,
	' ' nr_ddd_fax_representante,
	' ' nr_fax_representante,
	' ' ds_email_representante,
	' ' nm_responsavel,
	' ' nr_cpf_resp,
	' ' ds_crc_resp,
	' ' ds_uf_crc_resp,
	' ' nr_ddd_telefone_resp,
	' ' nr_telefone_resp,
	' ' nr_ramal_resp,
	' ' nr_ddd_fax_resp,
	' ' nr_fax_resp,
	' ' ds_email_resp,
	' ' nr_grupo_tributo,
	'999999' cd_receita,
	' ' ds_periodicidade,
	clock_timestamp() nr_ano_apuracao,
	' ' dt_apuracao_mensal,
	' ' dt_apuracao_diario,
	' ' nr_ordem_estab,
	' ' nr_cnpj_incorporacao,
	0 vl_debito,
	0 ie_balanco_reducao,
	0 ie_saldo_quotas,
	clock_timestamp() dt_periodo_apuracao,
	' ' nr_cnpj_darf,
	'0' cd_receita_darf,
	clock_timestamp() dt_vencimento,
	' ' nr_referencia,
	0 vl_principal,
	0 vl_multa,
	0 vl_juros,
	0 vl_pago_debito,
	0 nr_trimestre_apuracao,
	0 nr_quota,
	00000 		   				qt_registros,
	'          '					ds_hashcode
from	dctf_lote a,
	estabelecimento b
where	a.cd_estabelecimento	= b.cd_estabelecimento
and	a.nr_sequencia		= nr_seq_lote_p;


BEGIN

delete	from w_envio_dctf
where	nr_seq_lote	= nr_seq_lote_p;

select	cd_responsavel_dados
into STRICT	cd_contabilista_w
from	dctf_lote
where	nr_sequencia = nr_seq_lote_p;

if (cd_contabilista_w IS NOT NULL AND cd_contabilista_w::text <> '') then

	select	ds_codigo_prof
	into STRICT	nr_crc_w
	from	pessoa_fisica
	where	cd_pessoa_fisica = cd_contabilista_w;

	if (coalesce(nr_crc_w,'X') = 'X') then

		select	nr_crc
		into STRICT	nr_crc_w
		from	empresa
		where	cd_empresa = (	SELECT	e.cd_empresa
					from	estabelecimento e, dctf_lote d
					where	d.cd_estabelecimento = e.cd_estabelecimento
					and	d.nr_sequencia = nr_seq_lote_p);

	end if;

end if;

if (coalesce(cd_contabilista_w::text, '') = '') then
	select	cd_contabilista,
		nr_crc
	into STRICT	cd_contabilista_w,
		nr_crc_w
	from	empresa
	where	cd_empresa = (	SELECT	e.cd_empresa
				from	estabelecimento e, dctf_lote d
				where	d.cd_estabelecimento = e.cd_estabelecimento
				and	d.nr_sequencia = nr_seq_lote_p);

end if;

/* header / R01 - Dados iniciais / R02 - Dados cadastrais do
estabelecimento matriz / R03 - Dados dos responsveis pela PJ */
open c01;
loop
fetch c01 into
	ie_tipo_registro_w,
	nr_seq_lote_w,
	ds_registro_w,
	ie_tipo_declaracao_w,
	nr_cnpj_w,
	nr_versao_w,
	nm_empresarial_w,
	sg_uf_w,
	ie_situacao_w,
	nr_ano_declaracao_w,
	nr_mes_declaracao_w,
	dt_periodo_inicial_w,
	dt_periodo_final_w,
	dt_ocorrencia_evento_w,
	ie_tipo_w,
	nr_mes_ocorrencia_w,
	dt_inicio_w,
	dt_fim_w,
	nr_declaracao_w,
	nr_recibo_w,
	ie_forma_tributacao_w,
	ie_qualificacao_pj_w,
	ie_pj_balanco_w,
	ie_pj_scp_w,
	ie_pj_inativa_w,
	ie_pj_regime_especial_w,
	ie_pj_dctf_semestral_w,
	ie_criterio_rec_variacao_w,
	ie_janeiro_w,
	ie_fevereiro_w,
	ie_marco_w,
	ie_abril_w,
	ie_maio_w,
	ie_junho_w,
	ie_julho_w,
	ie_agosto_w,
	ie_setembro_w,
	ie_outubro_w,
	ie_novembro_w,
	ie_dezembro_w,
	ie_regime_pis_cofins_w,
	ie_iniciou_neste_mes_w,
	cd_natureza_juridica_w,
	ds_logradouro_w,
	ds_numero_w,
	ds_complemento_w,
	ds_bairro_w,
	ds_municipio_w,
	nr_cep_w,
	nr_ddd_telefone_w,
	nr_telefone_w,
	nr_ddd_fax_w,
	nr_fax_w,
	nr_caixa_postal_w,
	ds_uf_caixa_postal_w,
	nr_cep_caixa_postal_w,
	ds_email_w,
	nm_representante_w,
	nr_cpf_representante_w,
	nr_ddd_telefone_repr_w,
	nr_telefone_representante_w,
	nr_ramal_representante_w,
	nr_ddd_fax_representante_w,
	nr_fax_representante_w,
	ds_email_representante_w,
	nm_responsavel_w,
	nr_cpf_resp_w,
	ds_crc_resp_w,
	ds_uf_crc_resp_w,
	nr_ddd_telefone_resp_w,
	nr_telefone_resp_w,
	nr_ramal_resp_w,
	nr_ddd_fax_resp_w,
	nr_fax_resp_w,
	ds_email_resp_w,
	nr_grupo_tributo_w,
	cd_receita_w,
	ds_periodicidade_w,
	nr_ano_apuracao_w,
	dt_apuracao_mensal_w,
	dt_apuracao_diario_w,
	nr_ordem_estab_w,
	nr_cnpj_incorporacao_w,
	vl_debito_w,
	ie_balanco_reducao_w,
	ie_saldo_quotas_w,
	dt_periodo_apuracao_w,
	nr_cnpj_darf_w,
	cd_receita_darf_w,
	dt_vencimento_w,
	nr_referencia_w,
	vl_principal_w,
	vl_multa_w,
	vl_juros_w,
	vl_pago_debito_w,
	nr_trimestre_apuracao_w,
	nr_quota_w,
	qt_registros_w,
	ds_hashcode_w;
EXIT WHEN NOT FOUND; /* apply on c01 */

	select	nextval('w_envio_dctf_seq')
	into STRICT	nr_seq_envio_dctf_w
	;

	select	lpad(ie_qualificacao_pj_w,2,0)
	into STRICT	ie_qualificacao_pj_w
	;

	insert into w_envio_dctf(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		ie_tipo_registro,
		nr_seq_lote,
		ds_registro,
		ie_tipo_declaracao,
		nr_cnpj,
		nr_versao,
		nm_empresarial,
		sg_uf,
		ie_situacao,
		nr_ano_declaracao,
		nr_mes_declaracao,
		dt_periodo_inicial,
		dt_periodo_final,
		dt_ocorrencia_evento,
		ie_tipo,
		nr_mes_ocorrencia,
		dt_inicio,
		dt_fim,
		nr_declaracao,
		nr_recibo,
		ie_forma_tributacao,
		ie_qualificacao_pj,
		ie_pj_balanco,
		ie_pj_scp,
		ie_pj_inativa,
		ie_pj_regime_especial,
		ie_pj_dctf_semestral,
		ie_criterio_rec_variacao,
		ie_janeiro,
		ie_fevereiro,
		ie_marco,
		ie_abril,
		ie_maio,
		ie_junho,
		ie_julho,
		ie_agosto,
		ie_setembro,
		ie_outubro,
		ie_novembro,
		ie_dezembro,
		ie_regime_pis_cofins,
		ie_iniciou_neste_mes,
		cd_natureza_juridica,
		ds_logradouro,
		ds_numero,
		ds_complemento,
		ds_bairro,
		ds_municipio,
		nr_cep,
		nr_ddd_telefone,
		nr_telefone,
		nr_ddd_fax,
		nr_fax,
		nr_caixa_postal,
		ds_uf_caixa_postal,
		nr_cep_caixa_postal,
		ds_email,
		nm_representante,
		nr_cpf_representante,
		nr_ddd_telefone_representante,
		nr_telefone_representante,
		nr_ramal_representante,
		nr_ddd_fax_representante,
		nr_fax_representante,
		ds_email_representante,
		nm_responsavel,
		nr_cpf_resp,
		ds_crc_resp,
		ds_uf_crc_resp,
		nr_ddd_telefone_resp,
		nr_telefone_resp,
		nr_ramal_resp,
		nr_ddd_fax_resp,
		nr_fax_resp,
		ds_email_resp,
		nr_grupo_tributo,
		cd_receita,
		ds_periodicidade,
		nr_ano_apuracao,
		dt_apuracao_mensal,
		dt_apuracao_diario,
		nr_ordem_estab,
		nr_cnpj_incorporacao,
		vl_debito,
		ie_balanco_reducao,
		ie_saldo_quotas,
		dt_periodo_apuracao,
		nr_cnpj_darf,
		cd_receita_darf,
		dt_vencimento,
		nr_referencia,
		vl_principal,
		vl_multa,
		vl_juros,
		vl_pago_debito,
		nr_trimestre_apuracao,
		nr_quota,
		qt_registros,
		ds_hashcode)
	values (nr_seq_envio_dctf_w,
		nm_usuario_p,
		clock_timestamp(),
		ie_tipo_registro_w,
		nr_seq_lote_w,
		ds_registro_w,
		ie_tipo_declaracao_w,
		nr_cnpj_w,
		nr_versao_w,
		nm_empresarial_w,
		sg_uf_w,
		ie_situacao_w,
		to_char(nr_ano_declaracao_w,'dd/mm/yyyy'),
		nr_mes_declaracao_w,
		to_char(dt_periodo_inicial_w,'dd/mm/yyyy'),
		to_char(dt_periodo_final_w,'dd/mm/yyyy'),
		dt_ocorrencia_evento_w,
		ie_tipo_w,
		to_char(nr_mes_ocorrencia_w,'dd/mm/yyyy'),
		to_char(dt_inicio_w,'dd/mm/yyyy'),
		to_char(dt_fim_w,'dd/mm/yyyy'),
		nr_declaracao_w,
		nr_recibo_w,
		ie_forma_tributacao_w,
		ie_qualificacao_pj_w,
		ie_pj_balanco_w,
		ie_pj_scp_w,
		ie_pj_inativa_w,
		ie_pj_regime_especial_w,
		ie_pj_dctf_semestral_w,
		ie_criterio_rec_variacao_w,
		ie_janeiro_w,
		ie_fevereiro_w,
		ie_marco_w,
		ie_abril_w,
		ie_maio_w,
		ie_junho_w,
		ie_julho_w,
		ie_agosto_w,
		ie_setembro_w,
		ie_outubro_w,
		ie_novembro_w,
		ie_dezembro_w,
		ie_regime_pis_cofins_w,
		ie_iniciou_neste_mes_w,
		cd_natureza_juridica_w,
		ds_logradouro_w,
		ds_numero_w,
		ds_complemento_w,
		ds_bairro_w,
		ds_municipio_w,
		nr_cep_w,
		nr_ddd_telefone_w,
		nr_telefone_w,
		nr_ddd_fax_w,
		nr_fax_w,
		nr_caixa_postal_w,
		ds_uf_caixa_postal_w,
		nr_cep_caixa_postal_w,
		ds_email_w,
		nm_representante_w,
		nr_cpf_representante_w,
		nr_ddd_telefone_repr_w,
		nr_telefone_representante_w,
		nr_ramal_representante_w,
		nr_ddd_fax_representante_w,
		nr_fax_representante_w,
		ds_email_representante_w,
		nm_responsavel_w,
		nr_cpf_resp_w,
		ds_crc_resp_w,
		ds_uf_crc_resp_w,
		nr_ddd_telefone_resp_w,
		nr_telefone_resp_w,
		nr_ramal_resp_w,
		nr_ddd_fax_resp_w,
		nr_fax_resp_w,
		ds_email_resp_w,
		nr_grupo_tributo_w,
		cd_receita_w,
		ds_periodicidade_w,
		to_char(nr_ano_apuracao_w,'dd/mm/yyyy'),
		dt_apuracao_mensal_w,
		dt_apuracao_diario_w,
		nr_ordem_estab_w,
		nr_cnpj_incorporacao_w,
		vl_debito_w,
		ie_balanco_reducao_w,
		ie_saldo_quotas_w,
		to_char(dt_periodo_apuracao_w,'dd/mm/yyyy'),
		nr_cnpj_darf_w,
		cd_receita_darf_w,
		to_char(dt_vencimento_w,'dd/mm/yyyy'),
		nr_referencia_w,
		vl_principal_w,
		vl_multa_w,
		vl_juros_w,
		vl_pago_debito_w,
		nr_trimestre_apuracao_w,
		nr_quota_w,
		qt_registros_w,
		ds_hashcode_w);

end loop;
close c01;

open c02;
loop
fetch c02 into
	ie_tipo_registro_w,
	nr_seq_lote_w,
	ds_registro_w,
	ie_tipo_declaracao_w,
	nr_cnpj_w,
	nr_versao_w,
	nm_empresarial_w,
	sg_uf_w,
	ie_situacao_w,
	nr_ano_declaracao_w,
	nr_mes_declaracao_w,
	dt_periodo_inicial_w,
	dt_periodo_final_w,
	dt_ocorrencia_evento_w,
	ie_tipo_w,
	nr_mes_ocorrencia_w,
	dt_inicio_w,
	dt_fim_w,
	nr_declaracao_w,
	nr_recibo_w,
	ie_forma_tributacao_w,
	ie_qualificacao_pj_w,
	ie_pj_balanco_w,
	ie_pj_scp_w,
	ie_pj_inativa_w,
	ie_pj_regime_especial_w,
	ie_pj_dctf_semestral_w,
	ie_spc_inc_w,
	cd_natureza_juridica_w,
	ds_logradouro_w,
	ds_numero_w,
	ds_complemento_w,
	ds_bairro_w,
	ds_municipio_w,
	nr_cep_w,
	nr_ddd_telefone_w,
	nr_telefone_w,
	nr_ddd_fax_w,
	nr_fax_w,
	nr_caixa_postal_w,
	ds_uf_caixa_postal_w,
	nr_cep_caixa_postal_w,
	ds_email_w,
	nm_representante_w,
	nr_cpf_representante_w,
	nr_ddd_telefone_repr_w,
	nr_telefone_representante_w,
	nr_ramal_representante_w,
	nr_ddd_fax_representante_w,
	nr_fax_representante_w,
	ds_email_representante_w,
	nm_responsavel_w,
	nr_cpf_resp_w,
	ds_crc_resp_w,
	ds_uf_crc_resp_w,
	nr_ddd_telefone_resp_w,
	nr_telefone_resp_w,
	nr_ramal_resp_w,
	nr_ddd_fax_resp_w,
	nr_fax_resp_w,
	ds_email_resp_w,
	nr_grupo_tributo_w,
	cd_receita_w,
	ds_periodicidade_w,
	nr_ano_apuracao_w,
	dt_apuracao_mensal_w,
	dt_apuracao_diario_w,
	nr_ordem_estab_w,
	nr_cnpj_incorporacao_w,
	vl_debito_w,
	ie_balanco_reducao_w,
	ie_saldo_quotas_w,
	dt_periodo_apuracao_w,
	nr_cnpj_darf_w,
	cd_receita_darf_w,
	dt_vencimento_w,
	nr_referencia_w,
	vl_principal_w,
	vl_multa_w,
	vl_juros_w,
	vl_pago_debito_w,
	nr_trimestre_apuracao_w,
	nr_quota_w,
	qt_registros_w,
	ds_hashcode_w;
EXIT WHEN NOT FOUND; /* apply on c02 */

	select	nextval('w_envio_dctf_seq')
	into STRICT	nr_seq_envio_dctf_w
	;

	select	lpad(ie_qualificacao_pj_w,2,0)
	into STRICT	ie_qualificacao_pj_w
	;

	insert into w_envio_dctf(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		ie_tipo_registro,
		nr_seq_lote,
		ds_registro,
		ie_tipo_declaracao,
		nr_cnpj,
		nr_versao,
		nm_empresarial,
		sg_uf,
		ie_situacao,
		nr_ano_declaracao,
		nr_mes_declaracao,
		dt_periodo_inicial,
		dt_periodo_final,
		dt_ocorrencia_evento,
		ie_tipo,
		nr_mes_ocorrencia,
		dt_inicio,
		dt_fim,
		nr_declaracao,
		nr_recibo,
		ie_forma_tributacao,
		ie_qualificacao_pj,
		ie_pj_balanco,
		ie_pj_scp,
		ie_pj_inativa,
		ie_pj_regime_especial,
		ie_pj_dctf_semestral,
		ie_spc_inc,
		cd_natureza_juridica,
		ds_logradouro,
		ds_numero,
		ds_complemento,
		ds_bairro,
		ds_municipio,
		nr_cep,
		nr_ddd_telefone,
		nr_telefone,
		nr_ddd_fax,
		nr_fax,
		nr_caixa_postal,
		ds_uf_caixa_postal,
		nr_cep_caixa_postal,
		ds_email,
		nm_representante,
		nr_cpf_representante,
		nr_ddd_telefone_representante,
		nr_telefone_representante,
		nr_ramal_representante,
		nr_ddd_fax_representante,
		nr_fax_representante,
		ds_email_representante,
		nm_responsavel,
		nr_cpf_resp,
		ds_crc_resp,
		ds_uf_crc_resp,
		nr_ddd_telefone_resp,
		nr_telefone_resp,
		nr_ramal_resp,
		nr_ddd_fax_resp,
		nr_fax_resp,
		ds_email_resp,
		nr_grupo_tributo,
		cd_receita,
		ds_periodicidade,
		nr_ano_apuracao,
		dt_apuracao_mensal,
		dt_apuracao_diario,
		nr_ordem_estab,
		nr_cnpj_incorporacao,
		vl_debito,
		ie_balanco_reducao,
		ie_saldo_quotas,
		dt_periodo_apuracao,
		nr_cnpj_darf,
		cd_receita_darf,
		dt_vencimento,
		nr_referencia,
		vl_principal,
		vl_multa,
		vl_juros,
		vl_pago_debito,
		nr_trimestre_apuracao,
		nr_quota,
		qt_registros,
		ds_hashcode)
	values (nr_seq_envio_dctf_w,
		nm_usuario_p,
		clock_timestamp(),
		ie_tipo_registro_w,
		nr_seq_lote_w,
		ds_registro_w,
		ie_tipo_declaracao_w,
		nr_cnpj_w,
		nr_versao_w,
		nm_empresarial_w,
		sg_uf_w,
		ie_situacao_w,
		to_char(nr_ano_declaracao_w,'dd/mm/yyyy'),
		nr_mes_declaracao_w,
		to_char(dt_periodo_inicial_w,'dd/mm/yyyy'),
		to_char(dt_periodo_final_w,'dd/mm/yyyy'),
		dt_ocorrencia_evento_w,
		ie_tipo_w,
		to_char(nr_mes_ocorrencia_w,'dd/mm/yyyy'),
		to_char(dt_inicio_w,'dd/mm/yyyy'),
		to_char(dt_fim_w,'dd/mm/yyyy'),
		nr_declaracao_w,
		nr_recibo_w,
		ie_forma_tributacao_w,
		ie_qualificacao_pj_w,
		ie_pj_balanco_w,
		ie_pj_scp_w,
		ie_pj_inativa_w,
		ie_pj_regime_especial_w,
		ie_pj_dctf_semestral_w,
		ie_spc_inc_w,
		cd_natureza_juridica_w,
		ds_logradouro_w,
		ds_numero_w,
		ds_complemento_w,
		ds_bairro_w,
		ds_municipio_w,
		nr_cep_w,
		nr_ddd_telefone_w,
		nr_telefone_w,
		nr_ddd_fax_w,
		nr_fax_w,
		nr_caixa_postal_w,
		ds_uf_caixa_postal_w,
		nr_cep_caixa_postal_w,
		ds_email_w,
		nm_representante_w,
		nr_cpf_representante_w,
		nr_ddd_telefone_repr_w,
		nr_telefone_representante_w,
		nr_ramal_representante_w,
		nr_ddd_fax_representante_w,
		nr_fax_representante_w,
		ds_email_representante_w,
		nm_responsavel_w,
		nr_cpf_resp_w,
		ds_crc_resp_w,
		ds_uf_crc_resp_w,
		nr_ddd_telefone_resp_w,
		nr_telefone_resp_w,
		nr_ramal_resp_w,
		nr_ddd_fax_resp_w,
		nr_fax_resp_w,
		ds_email_resp_w,
		nr_grupo_tributo_w,
		cd_receita_w,
		ds_periodicidade_w,
		to_char(nr_ano_apuracao_w,'dd/mm/yyyy'),
		dt_apuracao_mensal_w,
		dt_apuracao_diario_w,
		nr_ordem_estab_w,
		nr_cnpj_incorporacao_w,
		vl_debito_w,
		ie_balanco_reducao_w,
		ie_saldo_quotas_w,
		to_char(dt_periodo_apuracao_w,'dd/mm/yyyy'),
		nr_cnpj_darf_w,
		cd_receita_darf_w,
		to_char(dt_vencimento_w,'dd/mm/yyyy'),
		nr_referencia_w,
		vl_principal_w,
		vl_multa_w,
		vl_juros_w,
		vl_pago_debito_w,
		nr_trimestre_apuracao_w,
		nr_quota_w,
		qt_registros_w,
		ds_hashcode_w);

	open c03;
	loop
	fetch c03 into
		ie_tipo_registro_w,
		nr_seq_lote_w,
		ds_registro_w,
		ie_tipo_declaracao_w,
		nr_cnpj_w,
		nr_versao_w,
		nm_empresarial_w,
		sg_uf_w,
		ie_situacao_w,
		nr_ano_declaracao_w,
		nr_mes_declaracao_w,
		dt_periodo_inicial_w,
		dt_periodo_final_w,
		dt_ocorrencia_evento_w,
		ie_tipo_w,
		nr_mes_ocorrencia_w,
		dt_inicio_w,
		dt_fim_w,
		nr_declaracao_w,
		nr_recibo_w,
		ie_forma_tributacao_w,
		ie_qualificacao_pj_w,
		ie_pj_balanco_w,
		ie_pj_scp_w,
		ie_pj_inativa_w,
		ie_pj_regime_especial_w,
		ie_pj_dctf_semestral_w,
		cd_natureza_juridica_w,
		ds_logradouro_w,
		ds_numero_w,
		ds_complemento_w,
		ds_bairro_w,
		ds_municipio_w,
		nr_cep_w,
		nr_ddd_telefone_w,
		nr_telefone_w,
		nr_ddd_fax_w,
		nr_fax_w,
		nr_caixa_postal_w,
		ds_uf_caixa_postal_w,
		nr_cep_caixa_postal_w,
		ds_email_w,
		nm_representante_w,
		nr_cpf_representante_w,
		nr_ddd_telefone_repr_w,
		nr_telefone_representante_w,
		nr_ramal_representante_w,
		nr_ddd_fax_representante_w,
		nr_fax_representante_w,
		ds_email_representante_w,
		nm_responsavel_w,
		nr_cpf_resp_w,
		ds_crc_resp_w,
		ds_uf_crc_resp_w,
		nr_ddd_telefone_resp_w,
		nr_telefone_resp_w,
		nr_ramal_resp_w,
		nr_ddd_fax_resp_w,
		nr_fax_resp_w,
		ds_email_resp_w,
		nr_grupo_tributo_w,
		cd_receita_w,
		ds_periodicidade_w,
		nr_ano_apuracao_w,
		dt_apuracao_mensal_w,
		dt_apur_diario_w,
		nr_ordem_estab_w,
		nr_cnpj_incorporacao_w,
		vl_debito_w,
		ie_balanco_reducao_w,
		ie_saldo_quotas_w,
		dt_periodo_apuracao_w,
		nr_cnpj_darf_w,
		cd_receita_darf_w,
		dt_vencimento_w,
		nr_referencia_w,
		vl_principal_w,
		vl_multa_w,
		vl_juros_w,
		vl_pago_debito_w,
		nr_trimestre_apuracao_w,
		nr_quota_w,
		qt_registros_w,
		ds_hashcode_w,
		nr_seq_darf_w;
	EXIT WHEN NOT FOUND; /* apply on c03 */

		select	nextval('w_envio_dctf_seq')
		into STRICT	nr_seq_envio_dctf_w
		;

		select	lpad(ie_qualificacao_pj_w,2,0)
		into STRICT	ie_qualificacao_pj_w
		;

		insert into w_envio_dctf(nr_sequencia,
			nm_usuario,
			dt_atualizacao,
			ie_tipo_registro,
			nr_seq_lote,
			ds_registro,
			ie_tipo_declaracao,
			nr_cnpj,
			nr_versao,
			nm_empresarial,
			sg_uf,
			ie_situacao,
			nr_ano_declaracao,
			nr_mes_declaracao,
			dt_periodo_inicial,
			dt_periodo_final,
			dt_ocorrencia_evento,
			ie_tipo,
			nr_mes_ocorrencia,
			dt_inicio,
			dt_fim,
			nr_declaracao,
			nr_recibo,
			ie_forma_tributacao,
			ie_qualificacao_pj,
			ie_pj_balanco,
			ie_pj_scp,
			ie_pj_inativa,
			ie_pj_regime_especial,
			ie_pj_dctf_semestral,
			cd_natureza_juridica,
			ds_logradouro,
			ds_numero,
			ds_complemento,
			ds_bairro,
			ds_municipio,
			nr_cep,
			nr_ddd_telefone,
			nr_telefone,
			nr_ddd_fax,
			nr_fax,
			nr_caixa_postal,
			ds_uf_caixa_postal,
			nr_cep_caixa_postal,
			ds_email,
			nm_representante,
			nr_cpf_representante,
			nr_ddd_telefone_representante,
			nr_telefone_representante,
			nr_ramal_representante,
			nr_ddd_fax_representante,
			nr_fax_representante,
			ds_email_representante,
			nm_responsavel,
			nr_cpf_resp,
			ds_crc_resp,
			ds_uf_crc_resp,
			nr_ddd_telefone_resp,
			nr_telefone_resp,
			nr_ramal_resp,
			nr_ddd_fax_resp,
			nr_fax_resp,
			ds_email_resp,
			nr_grupo_tributo,
			cd_receita,
			ds_periodicidade,
			nr_ano_apuracao,
			dt_apuracao_mensal,
			dt_apuracao_diario,
			nr_ordem_estab,
			nr_cnpj_incorporacao,
			vl_debito,
			ie_balanco_reducao,
			ie_saldo_quotas,
			dt_periodo_apuracao,
			nr_cnpj_darf,
			cd_receita_darf,
			dt_vencimento,
			nr_referencia,
			vl_principal,
			vl_multa,
			vl_juros,
			vl_pago_debito,
			nr_trimestre_apuracao,
			nr_quota,
			qt_registros,
			ds_hashcode)
		values (nr_seq_envio_dctf_w,
			nm_usuario_p,
			clock_timestamp(),
			ie_tipo_registro_w,
			nr_seq_lote_w,
			ds_registro_w,
			ie_tipo_declaracao_w,
			nr_cnpj_w,
			nr_versao_w,
			nm_empresarial_w,
			sg_uf_w,
			ie_situacao_w,
			to_char(nr_ano_declaracao_w,'dd/mm/yyyy'),
			nr_mes_declaracao_w,
			to_char(dt_periodo_inicial_w,'dd/mm/yyyy'),
			to_char(dt_periodo_final_w,'dd/mm/yyyy'),
			dt_ocorrencia_evento_w,
			ie_tipo_w,
			to_char(nr_mes_ocorrencia_w,'dd/mm/yyyy'),
			to_char(dt_inicio_w,'dd/mm/yyyy'),
			to_char(dt_fim_w,'dd/mm/yyyy'),
			nr_declaracao_w,
			nr_recibo_w,
			ie_forma_tributacao_w,
			ie_qualificacao_pj_w,
			ie_pj_balanco_w,
			ie_pj_scp_w,
			ie_pj_inativa_w,
			ie_pj_regime_especial_w,
			ie_pj_dctf_semestral_w,
			cd_natureza_juridica_w,
			ds_logradouro_w,
			ds_numero_w,
			ds_complemento_w,
			ds_bairro_w,
			ds_municipio_w,
			nr_cep_w,
			nr_ddd_telefone_w,
			nr_telefone_w,
			nr_ddd_fax_w,
			nr_fax_w,
			nr_caixa_postal_w,
			ds_uf_caixa_postal_w,
			nr_cep_caixa_postal_w,
			ds_email_w,
			nm_representante_w,
			nr_cpf_representante_w,
			nr_ddd_telefone_repr_w,
			nr_telefone_representante_w,
			nr_ramal_representante_w,
			nr_ddd_fax_representante_w,
			nr_fax_representante_w,
			ds_email_representante_w,
			nm_responsavel_w,
			nr_cpf_resp_w,
			ds_crc_resp_w,
			ds_uf_crc_resp_w,
			nr_ddd_telefone_resp_w,
			nr_telefone_resp_w,
			nr_ramal_resp_w,
			nr_ddd_fax_resp_w,
			nr_fax_resp_w,
			ds_email_resp_w,
			nr_grupo_tributo_w,
			cd_receita_w,
			ds_periodicidade_w,
			to_char(nr_ano_apuracao_w,'dd/mm/yyyy'),
			dt_apuracao_mensal_w,
			dt_apuracao_diario_w,
			nr_ordem_estab_w,
			nr_cnpj_incorporacao_w,
			vl_debito_w,
			ie_balanco_reducao_w,
			ie_saldo_quotas_w,
			to_char(dt_periodo_apuracao_w,'dd/mm/yyyy'),
			nr_cnpj_darf_w,
			cd_receita_darf_w,
			to_char(dt_vencimento_w,'dd/mm/yyyy'),
			nr_referencia_w,
			vl_principal_w,
			vl_multa_w,
			vl_juros_w,
			vl_pago_debito_w,
			nr_trimestre_apuracao_w,
			nr_quota_w,
			qt_registros_w,
			ds_hashcode_w);

	end loop;
	close c03;

	open C06;
	loop
	fetch C06 into
		ie_tipo_registro_w,
		nr_seq_lote_w,
		ds_registro_w,
		ie_tipo_declaracao_w,
		nr_cnpj_w,
		nr_versao_w,
		nm_empresarial_w,
		sg_uf_w,
		ie_situacao_w,
		nr_ano_declaracao_w,
		nr_mes_declaracao_w,
		dt_periodo_inicial_w,
		dt_periodo_final_w,
		dt_ocorrencia_evento_w,
		ie_tipo_w,
		nr_mes_ocorrencia_w,
		dt_inicio_w,
		dt_fim_w,
		nr_declaracao_w,
		nr_recibo_w,
		ie_forma_tributacao_w,
		ie_qualificacao_pj_w,
		ie_pj_balanco_w,
		ie_pj_scp_w,
		ie_pj_inativa_w,
		ie_pj_regime_especial_w,
		ie_pj_dctf_semestral_w,
		cd_natureza_juridica_w,
		ds_logradouro_w,
		ds_numero_w,
		ds_complemento_w,
		ds_bairro_w,
		ds_municipio_w,
		nr_cep_w,
		nr_ddd_telefone_w,
		nr_telefone_w,
		nr_ddd_fax_w,
		nr_fax_w,
		nr_caixa_postal_w,
		ds_uf_caixa_postal_w,
		nr_cep_caixa_postal_w,
		ds_email_w,
		nm_representante_w,
		nr_cpf_representante_w,
		nr_ddd_telefone_repr_w,
		nr_telefone_representante_w,
		nr_ramal_representante_w,
		nr_ddd_fax_representante_w,
		nr_fax_representante_w,
		ds_email_representante_w,
		nm_responsavel_w,
		nr_cpf_resp_w,
		ds_crc_resp_w,
		ds_uf_crc_resp_w,
		nr_ddd_telefone_resp_w,
		nr_telefone_resp_w,
		nr_ramal_resp_w,
		nr_ddd_fax_resp_w,
		nr_fax_resp_w,
		ds_email_resp_w,
		nr_grupo_tributo_w,
		cd_receita_w,
		ds_periodicidade_w,
		nr_ano_apuracao_w,
		dt_apuracao_mensal_w,
		dt_apur_diario_w,
		nr_ordem_estab_w,
		nr_cnpj_incorporacao_w,
		vl_debito_w,
		ie_balanco_reducao_w,
		ie_saldo_quotas_w,
		dt_periodo_apuracao_w,
		nr_cnpj_darf_w,
		cd_receita_darf_w,
		dt_vencimento_w,
		nr_referencia_w,
		vl_principal_w,
		vl_multa_w,
		vl_juros_w,
		vl_pago_debito_w,
		nr_trimestre_apuracao_w,
		nr_quota_w,
		qt_registros_w,
		ds_hashcode_w,
		nr_seq_darf_w,
		cd_tipo_credito_w,
		cd_processo_dcomp_w,
		cd_formailizacao_pedido_w;
	EXIT WHEN NOT FOUND; /* apply on C06 */
		begin

		select	nextval('w_envio_dctf_seq')
		into STRICT	nr_seq_envio_dctf_w
		;

		select	lpad(ie_qualificacao_pj_w,2,0)
		into STRICT	ie_qualificacao_pj_w
		;

		insert into w_envio_dctf(nr_sequencia,
			nm_usuario,
			dt_atualizacao,
			ie_tipo_registro,
			nr_seq_lote,
			ds_registro,
			ie_tipo_declaracao,
			nr_cnpj,
			nr_versao,
			nm_empresarial,
			sg_uf,
			ie_situacao,
			nr_ano_declaracao,
			nr_mes_declaracao,
			dt_periodo_inicial,
			dt_periodo_final,
			dt_ocorrencia_evento,
			ie_tipo,
			nr_mes_ocorrencia,
			dt_inicio,
			dt_fim,
			nr_declaracao,
			nr_recibo,
			ie_forma_tributacao,
			ie_qualificacao_pj,
			ie_pj_balanco,
			ie_pj_scp,
			ie_pj_inativa,
			ie_pj_regime_especial,
			ie_pj_dctf_semestral,
			cd_natureza_juridica,
			ds_logradouro,
			ds_numero,
			ds_complemento,
			ds_bairro,
			ds_municipio,
			nr_cep,
			nr_ddd_telefone,
			nr_telefone,
			nr_ddd_fax,
			nr_fax,
			nr_caixa_postal,
			ds_uf_caixa_postal,
			nr_cep_caixa_postal,
			ds_email,
			nm_representante,
			nr_cpf_representante,
			nr_ddd_telefone_representante,
			nr_telefone_representante,
			nr_ramal_representante,
			nr_ddd_fax_representante,
			nr_fax_representante,
			ds_email_representante,
			nm_responsavel,
			nr_cpf_resp,
			ds_crc_resp,
			ds_uf_crc_resp,
			nr_ddd_telefone_resp,
			nr_telefone_resp,
			nr_ramal_resp,
			nr_ddd_fax_resp,
			nr_fax_resp,
			ds_email_resp,
			nr_grupo_tributo,
			cd_receita,
			ds_periodicidade,
			nr_ano_apuracao,
			dt_apuracao_mensal,
			dt_apuracao_diario,
			nr_ordem_estab,
			nr_cnpj_incorporacao,
			vl_debito,
			ie_balanco_reducao,
			ie_saldo_quotas,
			dt_periodo_apuracao,
			nr_cnpj_darf,
			cd_receita_darf,
			dt_vencimento,
			nr_referencia,
			vl_principal,
			vl_multa,
			vl_juros,
			vl_pago_debito,
			nr_trimestre_apuracao,
			nr_quota,
			qt_registros,
			ds_hashcode,
			cd_tipo_credito,
			cd_processo_dcomp,
			cd_formalizacao_pedido)
		values (nr_seq_envio_dctf_w,
			nm_usuario_p,
			clock_timestamp(),
			ie_tipo_registro_w,
			nr_seq_lote_w,
			ds_registro_w,
			ie_tipo_declaracao_w,
			nr_cnpj_w,
			nr_versao_w,
			nm_empresarial_w,
			sg_uf_w,
			ie_situacao_w,
			to_char(nr_ano_declaracao_w,'dd/mm/yyyy'),
			nr_mes_declaracao_w,
			to_char(dt_periodo_inicial_w,'dd/mm/yyyy'),
			to_char(dt_periodo_final_w,'dd/mm/yyyy'),
			dt_ocorrencia_evento_w,
			ie_tipo_w,
			to_char(nr_mes_ocorrencia_w,'dd/mm/yyyy'),
			to_char(dt_inicio_w,'dd/mm/yyyy'),
			to_char(dt_fim_w,'dd/mm/yyyy'),
			nr_declaracao_w,
			nr_recibo_w,
			ie_forma_tributacao_w,
			ie_qualificacao_pj_w,
			ie_pj_balanco_w,
			ie_pj_scp_w,
			ie_pj_inativa_w,
			ie_pj_regime_especial_w,
			ie_pj_dctf_semestral_w,
			cd_natureza_juridica_w,
			ds_logradouro_w,
			ds_numero_w,
			ds_complemento_w,
			ds_bairro_w,
			ds_municipio_w,
			nr_cep_w,
			nr_ddd_telefone_w,
			nr_telefone_w,
			nr_ddd_fax_w,
			nr_fax_w,
			nr_caixa_postal_w,
			ds_uf_caixa_postal_w,
			nr_cep_caixa_postal_w,
			ds_email_w,
			nm_representante_w,
			nr_cpf_representante_w,
			nr_ddd_telefone_repr_w,
			nr_telefone_representante_w,
			nr_ramal_representante_w,
			nr_ddd_fax_representante_w,
			nr_fax_representante_w,
			ds_email_representante_w,
			nm_responsavel_w,
			nr_cpf_resp_w,
			ds_crc_resp_w,
			ds_uf_crc_resp_w,
			nr_ddd_telefone_resp_w,
			nr_telefone_resp_w,
			nr_ramal_resp_w,
			nr_ddd_fax_resp_w,
			nr_fax_resp_w,
			ds_email_resp_w,
			nr_grupo_tributo_w,
			cd_receita_w,
			ds_periodicidade_w,
			to_char(nr_ano_apuracao_w,'dd/mm/yyyy'),
			dt_apuracao_mensal_w,
			dt_apuracao_diario_w,
			nr_ordem_estab_w,
			nr_cnpj_incorporacao_w,
			vl_debito_w,
			ie_balanco_reducao_w,
			ie_saldo_quotas_w,
			to_char(dt_periodo_apuracao_w,'dd/mm/yyyy'),
			nr_cnpj_darf_w,
			cd_receita_darf_w,
			to_char(dt_vencimento_w,'dd/mm/yyyy'),
			nr_referencia_w,
			vl_principal_w,
			vl_multa_w,
			vl_juros_w,
			vl_pago_debito_w,
			nr_trimestre_apuracao_w,
			nr_quota_w,
			qt_registros_w,
			ds_hashcode_w,
			cd_tipo_credito_w,
			cd_processo_dcomp_w,
			cd_formailizacao_pedido_w);

		end;
	end loop;
	close C06;

	/*open C05;
	loop
	fetch C05 into
		ie_tipo_registro_w,
		nr_seq_lote_w,
		ds_registro_w,
		ie_tipo_declaracao_w,
		nr_cnpj_w,
		nr_versao_w,
		nm_empresarial_w,
		sg_uf_w,
		ie_situacao_w,
		nr_ano_declaracao_w,
		nr_mes_declaracao_w,
		dt_periodo_inicial_w,
		dt_periodo_final_w,
		dt_ocorrencia_evento_w,
		ie_tipo_w,
		nr_mes_ocorrencia_w,
		dt_inicio_w,
		dt_fim_w,
		nr_declaracao_w,
		nr_recibo_w,
		ie_forma_tributacao_w,
		ie_qualificacao_pj_w,
		ie_pj_balanco_w,
		ie_pj_scp_w,
		ie_pj_inativa_w,
		ie_pj_regime_especial_w,
		ie_pj_dctf_semestral_w,
		cd_natureza_juridica_w,
		ds_logradouro_w,
		ds_numero_w,
		ds_complemento_w,
		ds_bairro_w,
		ds_municipio_w,
		nr_cep_w,
		nr_ddd_telefone_w,
		nr_telefone_w,
		nr_ddd_fax_w,
		nr_fax_w,
		nr_caixa_postal_w,
		ds_uf_caixa_postal_w,
		nr_cep_caixa_postal_w,
		ds_email_w,
		nm_representante_w,
		nr_cpf_representante_w,
		nr_ddd_telefone_repr_w,
		nr_telefone_representante_w,
		nr_ramal_representante_w,
		nr_ddd_fax_representante_w,
		nr_fax_representante_w,
		ds_email_representante_w,
		nm_responsavel_w,
		nr_cpf_resp_w,
		ds_crc_resp_w,
		ds_uf_crc_resp_w,
		nr_ddd_telefone_resp_w,
		nr_telefone_resp_w,
		nr_ramal_resp_w,
		nr_ddd_fax_resp_w,
		nr_fax_resp_w,
		ds_email_resp_w,
		nr_grupo_tributo_w,
		cd_receita_w,
		ds_periodicidade_w,
		nr_ano_apuracao_w,
		dt_apuracao_mensal_w,
		dt_apur_diario_w,
		nr_ordem_estab_w,
		nr_cnpj_incorporacao_w,
		vl_debito_w,
		ie_balanco_reducao_w,
		ie_saldo_quotas_w,
		dt_periodo_apuracao_w,
		nr_cnpj_darf_w,
		cd_receita_darf_w,
		dt_vencimento_w,
		nr_referencia_w,
		vl_principal_w,
		vl_multa_w,
		vl_juros_w,
		vl_pago_debito_w,
		nr_trimestre_apuracao_w,
		nr_quota_w,
		qt_registros_w,
		ds_hashcode_w,
		nr_seq_darf_w,
		cd_tipo_credito_w,
		cd_processo_dcomp_w,
		cd_formailizacao_pedido_w;
	exit when C05%notfound;
		begin

		select	w_envio_dctf_seq.nextval
		into	nr_seq_envio_dctf_w
		from	dual;

		select	lpad(ie_qualificacao_pj_w,2,0)
		into	ie_qualificacao_pj_w
		from	dual;

		insert into w_envio_dctf
			(nr_sequencia,
			nm_usuario,
			dt_atualizacao,
			ie_tipo_registro,
			nr_seq_lote,
			ds_registro,
			ie_tipo_declaracao,
			nr_cnpj,
			nr_versao,
			nm_empresarial,
			sg_uf,
			ie_situacao,
			nr_ano_declaracao,
			nr_mes_declaracao,
			dt_periodo_inicial,
			dt_periodo_final,
			dt_ocorrencia_evento,
			ie_tipo,
			nr_mes_ocorrencia,
			dt_inicio,
			dt_fim,
			nr_declaracao,
			nr_recibo,
			ie_forma_tributacao,
			ie_qualificacao_pj,
			ie_pj_balanco,
			ie_pj_scp,
			ie_pj_inativa,
			ie_pj_regime_especial,
			ie_pj_dctf_semestral,
			cd_natureza_juridica,
			ds_logradouro,
			ds_numero,
			ds_complemento,
			ds_bairro,
			ds_municipio,
			nr_cep,
			nr_ddd_telefone,
			nr_telefone,
			nr_ddd_fax,
			nr_fax,
			nr_caixa_postal,
			ds_uf_caixa_postal,
			nr_cep_caixa_postal,
			ds_email,
			nm_representante,
			nr_cpf_representante,
			nr_ddd_telefone_representante,
			nr_telefone_representante,
			nr_ramal_representante,
			nr_ddd_fax_representante,
			nr_fax_representante,
			ds_email_representante,
			nm_responsavel,
			nr_cpf_resp,
			ds_crc_resp,
			ds_uf_crc_resp,
			nr_ddd_telefone_resp,
			nr_telefone_resp,
			nr_ramal_resp,
			nr_ddd_fax_resp,
			nr_fax_resp,
			ds_email_resp,
			nr_grupo_tributo,
			cd_receita,
			ds_periodicidade,
			nr_ano_apuracao,
			dt_apuracao_mensal,
			dt_apuracao_diario,
			nr_ordem_estab,
			nr_cnpj_incorporacao,
			vl_debito,
			ie_balanco_reducao,
			ie_saldo_quotas,
			dt_periodo_apuracao,
			nr_cnpj_darf,
			cd_receita_darf,
			dt_vencimento,
			nr_referencia,
			vl_principal,
			vl_multa,
			vl_juros,
			vl_pago_debito,
			nr_trimestre_apuracao,
			nr_quota,
			qt_registros,
			ds_hashcode,
			cd_tipo_credito,
			cd_processo_dcomp,
			cd_formalizacao_pedido)
		values (nr_seq_envio_dctf_w,
			nm_usuario_p,
			sysdate,
			ie_tipo_registro_w,
			nr_seq_lote_w,
			ds_registro_w,
			ie_tipo_declaracao_w,
			nr_cnpj_w,
			nr_versao_w,
			nm_empresarial_w,
			sg_uf_w,
			ie_situacao_w,
			nr_ano_declaracao_w,
			nr_mes_declaracao_w,
			dt_periodo_inicial_w,
			dt_periodo_final_w,
			dt_ocorrencia_evento_w,
			ie_tipo_w,
			nr_mes_ocorrencia_w,
			dt_inicio_w,
			dt_fim_w,
			nr_declaracao_w,
			nr_recibo_w,
			ie_forma_tributacao_w,
			ie_qualificacao_pj_w,
			ie_pj_balanco_w,
			ie_pj_scp_w,
			ie_pj_inativa_w,
			ie_pj_regime_especial_w,
			ie_pj_dctf_semestral_w,
			cd_natureza_juridica_w,
			ds_logradouro_w,
			ds_numero_w,
			ds_complemento_w,
			ds_bairro_w,
			ds_municipio_w,
			nr_cep_w,
			nr_ddd_telefone_w,
			nr_telefone_w,
			nr_ddd_fax_w,
			nr_fax_w,
			nr_caixa_postal_w,
			ds_uf_caixa_postal_w,
			nr_cep_caixa_postal_w,
			ds_email_w,
			nm_representante_w,
			nr_cpf_representante_w,
			nr_ddd_telefone_repr_w,
			nr_telefone_representante_w,
			nr_ramal_representante_w,
			nr_ddd_fax_representante_w,
			nr_fax_representante_w,
			ds_email_representante_w,
			nm_responsavel_w,
			nr_cpf_resp_w,
			ds_crc_resp_w,
			ds_uf_crc_resp_w,
			nr_ddd_telefone_resp_w,
			nr_telefone_resp_w,
			nr_ramal_resp_w,
			nr_ddd_fax_resp_w,
			nr_fax_resp_w,
			ds_email_resp_w,
			nr_grupo_tributo_w,
			cd_receita_w,
			ds_periodicidade_w,
			nr_ano_apuracao_w,
			dt_apuracao_mensal_w,
			dt_apuracao_diario_w,
			nr_ordem_estab_w,
			nr_cnpj_incorporacao_w,
			vl_debito_w,
			ie_balanco_reducao_w,
			ie_saldo_quotas_w,
			dt_periodo_apuracao_w,
			nr_cnpj_darf_w,
			cd_receita_darf_w,
			dt_vencimento_w,
			nr_referencia_w,
			vl_principal_w,
			vl_multa_w,
			vl_juros_w,
			vl_pago_debito_w,
			nr_trimestre_apuracao_w,
			nr_quota_w,
			qt_registros_w,
			ds_hashcode_w,
			cd_tipo_credito_w,
			cd_processo_dcomp_w,
			cd_formailizacao_pedido_w);

		end;
	end loop;
	close C05;*/
end loop;
close c02;

/* T9 - Trailler */

open c04;
loop
fetch c04 into
	ie_tipo_registro_w,
	nr_seq_lote_w,
	ds_registro_w,
	ie_tipo_declaracao_w,
	nr_cnpj_w,
	nr_versao_w,
	nm_empresarial_w,
	sg_uf_w,
	ie_situacao_w,
	nr_ano_declaracao_w,
	nr_mes_declaracao_w,
	dt_periodo_inicial_w,
	dt_periodo_final_w,
	dt_ocorrencia_evento_w,
	ie_tipo_w,
	nr_mes_ocorrencia_w,
	dt_inicio_w,
	dt_fim_w,
	nr_declaracao_w,
	nr_recibo_w,
	ie_forma_tributacao_w,
	ie_qualificacao_pj_w,
	ie_pj_balanco_w,
	ie_pj_scp_w,
	ie_pj_inativa_w,
	ie_pj_regime_especial_w,
	ie_pj_dctf_semestral_w,
	cd_natureza_juridica_w,
	ds_logradouro_w,
	ds_numero_w,
	ds_complemento_w,
	ds_bairro_w,
	ds_municipio_w,
	nr_cep_w,
	nr_ddd_telefone_w,
	nr_telefone_w,
	nr_ddd_fax_w,
	nr_fax_w,
	nr_caixa_postal_w,
	ds_uf_caixa_postal_w,
	nr_cep_caixa_postal_w,
	ds_email_w,
	nm_representante_w,
	nr_cpf_representante_w,
	nr_ddd_telefone_repr_w,
	nr_telefone_representante_w,
	nr_ramal_representante_w,
	nr_ddd_fax_representante_w,
	nr_fax_representante_w,
	ds_email_representante_w,
	nm_responsavel_w,
	nr_cpf_resp_w,
	ds_crc_resp_w,
	ds_uf_crc_resp_w,
	nr_ddd_telefone_resp_w,
	nr_telefone_resp_w,
	nr_ramal_resp_w,
	nr_ddd_fax_resp_w,
	nr_fax_resp_w,
	ds_email_resp_w,
	nr_grupo_tributo_w,
	cd_receita_w,
	ds_periodicidade_w,
	nr_ano_apuracao_w,
	dt_apuracao_mensal_w,
	dt_apuracao_diario_w,
	nr_ordem_estab_w,
	nr_cnpj_incorporacao_w,
	vl_debito_w,
	ie_balanco_reducao_w,
	ie_saldo_quotas_w,
	dt_periodo_apuracao_w,
	nr_cnpj_darf_w,
	cd_receita_darf_w,
	dt_vencimento_w,
	nr_referencia_w,
	vl_principal_w,
	vl_multa_w,
	vl_juros_w,
	vl_pago_debito_w,
	nr_trimestre_apuracao_w,
	nr_quota_w,
	qt_registros_w,
	ds_hashcode_w;
EXIT WHEN NOT FOUND; /* apply on c04 */

	select	nextval('w_envio_dctf_seq')
	into STRICT	nr_seq_envio_dctf_w
	;

	select	lpad(ie_qualificacao_pj_w,2,0) -- dsantos em 26/04/2010, OS200896
	into STRICT	ie_qualificacao_pj_w
	;

	/*
	programa DCTF mensal 1.6, da receita considera apenas a posio 55. Por isso, esta alteracao muda '07', por exemplo, para '70'
	*/
	insert into w_envio_dctf(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		ie_tipo_registro,
		nr_seq_lote,
		ds_registro,
		ie_tipo_declaracao,
		nr_cnpj,
		nr_versao,
		nm_empresarial,
		sg_uf,
		ie_situacao,
		nr_ano_declaracao,
		nr_mes_declaracao,
		dt_periodo_inicial,
		dt_periodo_final,
		dt_ocorrencia_evento,
		ie_tipo,
		nr_mes_ocorrencia,
		dt_inicio,
		dt_fim,
		nr_declaracao,
		nr_recibo,
		ie_forma_tributacao,
		ie_qualificacao_pj,
		ie_pj_balanco,
		ie_pj_scp,
		ie_pj_inativa,
		ie_pj_regime_especial,
		ie_pj_dctf_semestral,
		cd_natureza_juridica,
		ds_logradouro,
		ds_numero,
		ds_complemento,
		ds_bairro,
		ds_municipio,
		nr_cep,
		nr_ddd_telefone,
		nr_telefone,
		nr_ddd_fax,
		nr_fax,
		nr_caixa_postal,
		ds_uf_caixa_postal,
		nr_cep_caixa_postal,
		ds_email,
		nm_representante,
		nr_cpf_representante,
		nr_ddd_telefone_representante,
		nr_telefone_representante,
		nr_ramal_representante,
		nr_ddd_fax_representante,
		nr_fax_representante,
		ds_email_representante,
		nm_responsavel,
		nr_cpf_resp,
		ds_crc_resp,
		ds_uf_crc_resp,
		nr_ddd_telefone_resp,
		nr_telefone_resp,
		nr_ramal_resp,
		nr_ddd_fax_resp,
		nr_fax_resp,
		ds_email_resp,
		nr_grupo_tributo,
		cd_receita,
		ds_periodicidade,
		nr_ano_apuracao,
		dt_apuracao_mensal,
		dt_apuracao_diario,
		nr_ordem_estab,
		nr_cnpj_incorporacao,
		vl_debito,
		ie_balanco_reducao,
		ie_saldo_quotas,
		dt_periodo_apuracao,
		nr_cnpj_darf,
		cd_receita_darf,
		dt_vencimento,
		nr_referencia,
		vl_principal,
		vl_multa,
		vl_juros,
		vl_pago_debito,
		nr_trimestre_apuracao,
		nr_quota,
		qt_registros,
		ds_hashcode)
	values (	nr_seq_envio_dctf_w,
		nm_usuario_p,
		clock_timestamp(),
		ie_tipo_registro_w,
		nr_seq_lote_w,
		ds_registro_w,
		ie_tipo_declaracao_w,
		nr_cnpj_w,
		nr_versao_w,
		nm_empresarial_w,
		sg_uf_w,
		ie_situacao_w,
		to_char(nr_ano_declaracao_w,'dd/mm/yyyy'),
		nr_mes_declaracao_w,
		to_char(dt_periodo_inicial_w,'dd/mm/yyyy'),
		to_char(dt_periodo_final_w,'dd/mm/yyyy'),
		dt_ocorrencia_evento_w,
		ie_tipo_w,
		to_char(nr_mes_ocorrencia_w,'dd/mm/yyyy'),
		to_char(dt_inicio_w,'dd/mm/yyyy'),
		to_char(dt_fim_w,'dd/mm/yyyy'),
		nr_declaracao_w,
		nr_recibo_w,
		ie_forma_tributacao_w,
		ie_qualificacao_pj_w,
		ie_pj_balanco_w,
		ie_pj_scp_w,
		ie_pj_inativa_w,
		ie_pj_regime_especial_w,
		ie_pj_dctf_semestral_w,
		cd_natureza_juridica_w,
		ds_logradouro_w,
		ds_numero_w,
		ds_complemento_w,
		ds_bairro_w,
		ds_municipio_w,
		nr_cep_w,
		nr_ddd_telefone_w,
		nr_telefone_w,
		nr_ddd_fax_w,
		nr_fax_w,
		nr_caixa_postal_w,
		ds_uf_caixa_postal_w,
		nr_cep_caixa_postal_w,
		ds_email_w,
		nm_representante_w,
		nr_cpf_representante_w,
		nr_ddd_telefone_repr_w,
		nr_telefone_representante_w,
		nr_ramal_representante_w,
		nr_ddd_fax_representante_w,
		nr_fax_representante_w,
		ds_email_representante_w,
		nm_responsavel_w,
		nr_cpf_resp_w,
		ds_crc_resp_w,
		ds_uf_crc_resp_w,
		nr_ddd_telefone_resp_w,
		nr_telefone_resp_w,
		nr_ramal_resp_w,
		nr_ddd_fax_resp_w,
		nr_fax_resp_w,
		ds_email_resp_w,
		nr_grupo_tributo_w,
		cd_receita_w,
		ds_periodicidade_w,
		to_char(nr_ano_apuracao_w,'dd/mm/yyyy'),
		dt_apuracao_mensal_w,
		dt_apuracao_diario_w,
		nr_ordem_estab_w,
		nr_cnpj_incorporacao_w,
		vl_debito_w,
		ie_balanco_reducao_w,
		ie_saldo_quotas_w,
		to_char(dt_periodo_apuracao_w,'dd/mm/yyyy'),
		nr_cnpj_darf_w,
		cd_receita_darf_w,
		to_char(dt_vencimento_w,'dd/mm/yyyy'),
		nr_referencia_w,
		vl_principal_w,
		vl_multa_w,
		vl_juros_w,
		vl_pago_debito_w,
		nr_trimestre_apuracao_w,
		nr_quota_w,
		qt_registros_w,
		ds_hashcode_w);

end loop;
close c04;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_w_envio_dctf_32 ( nr_seq_lote_p bigint, nm_usuario_p text) FROM PUBLIC;

