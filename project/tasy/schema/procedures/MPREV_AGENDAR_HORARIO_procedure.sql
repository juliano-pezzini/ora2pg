-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE mprev_agendar_horario (nr_sequencia_p mprev_agendamento.nr_sequencia%type, cd_agenda_p mprev_agendamento.cd_agenda%type, nr_seq_participante_p mprev_agendamento.nr_seq_participante%type, nr_seq_turma_p mprev_agendamento.nr_seq_turma%type, nr_seq_horario_turma_p mprev_agendamento.nr_seq_horario_turma%type, ds_utilizacao_p mprev_agendamento.ds_utilizacao%type, cd_agenda_profissional_p mprev_agendamento.cd_agenda_profissional%type, cd_agenda_local_p mprev_agendamento.cd_agenda_local%type, dt_agendamento_p mprev_agendamento.dt_agenda%type, dt_final_agendamento_p mprev_agendamento.dt_agenda%type, nr_minutos_p mprev_agendamento.nr_minuto_duracao%type, ds_observacao_p mprev_agendamento.ds_observacao%type, ie_marcar_horario_p text, nm_usuario_p mprev_agendamento.nm_usuario%type, ie_forma_agendamento_p text, ie_confirmacao_p text, nr_seq_aprovacao_turma_p bigint, nr_seq_captacao_p bigint, ie_previsto_p mprev_agendamento.ie_previsto%type, nr_seq_partic_ciclo_item_p mprev_agendamento.nr_seq_partic_ciclo_item%type, ie_forma_atendimento_p mprev_agendamento.ie_forma_atendimento%type, nr_seq_ativ_extra_p mprev_agendamento.nr_seq_ativ_extra%type, ie_tipo_agendamento_p mprev_agendamento.ie_tipo_agendamento%type, ie_tipo_atendimento_p mprev_agendamento.ie_tipo_atendimento%type, nr_seq_w_agendamento_p w_mprev_agendamento.nr_sequencia%type, nr_seq_grupo_tema_p mprev_grupo_tema_encontro.nr_sequencia%type, nr_seq_forma_atend_p mprev_forma_atendimento.nr_sequencia%type, qt_mensagens_erro_p INOUT bigint, qt_mensagens_atencao_p INOUT bigint, qt_mensagens_confirm_p INOUT bigint, nr_seq_gerada_p INOUT bigint, nr_seq_pac_senha_fila_p mprev_agendamento.nr_seq_pac_senha_fila%type default null) AS $body$
DECLARE


qt_consist_w			bigint;
nr_seq_participante_w		mprev_participante.nr_sequencia%type;	
				

BEGIN

if (nr_seq_captacao_p IS NOT NULL AND nr_seq_captacao_p::text <> '') and (coalesce(nr_seq_participante_p::text, '') = '') then
	select	max(b.nr_sequencia)
	into STRICT	nr_seq_participante_w
	from	mprev_participante b,
		mprev_captacao a
	where	a.cd_pessoa_fisica	= b.cd_pessoa_fisica
	and	a.nr_sequencia		= nr_seq_captacao_p;
else
	nr_seq_participante_w	:= nr_seq_participante_p;
end if;

SELECT * FROM mprev_agenda_pck.agendar_horario(nr_sequencia_p, cd_agenda_p, nr_seq_participante_w, nr_seq_turma_p, nr_seq_horario_turma_p, ds_utilizacao_p, cd_agenda_profissional_p, cd_agenda_local_p, dt_agendamento_p, dt_final_agendamento_p, nr_minutos_p, ds_observacao_p, ie_marcar_horario_p, nm_usuario_p, ie_forma_agendamento_p, ie_confirmacao_p, 'S', nr_seq_aprovacao_turma_p, nr_seq_captacao_p, ie_previsto_p, nr_seq_partic_ciclo_item_p, ie_forma_atendimento_p, nr_seq_ativ_extra_p, ie_tipo_agendamento_p, ie_tipo_atendimento_p, nr_seq_w_agendamento_p, nr_seq_grupo_tema_p, nr_seq_forma_atend_p, null, qt_mensagens_erro_p, qt_mensagens_atencao_p, qt_mensagens_confirm_p, nr_seq_gerada_p, nr_seq_pac_senha_fila_p) INTO STRICT qt_mensagens_erro_p, qt_mensagens_atencao_p, qt_mensagens_confirm_p, nr_seq_gerada_p;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE mprev_agendar_horario (nr_sequencia_p mprev_agendamento.nr_sequencia%type, cd_agenda_p mprev_agendamento.cd_agenda%type, nr_seq_participante_p mprev_agendamento.nr_seq_participante%type, nr_seq_turma_p mprev_agendamento.nr_seq_turma%type, nr_seq_horario_turma_p mprev_agendamento.nr_seq_horario_turma%type, ds_utilizacao_p mprev_agendamento.ds_utilizacao%type, cd_agenda_profissional_p mprev_agendamento.cd_agenda_profissional%type, cd_agenda_local_p mprev_agendamento.cd_agenda_local%type, dt_agendamento_p mprev_agendamento.dt_agenda%type, dt_final_agendamento_p mprev_agendamento.dt_agenda%type, nr_minutos_p mprev_agendamento.nr_minuto_duracao%type, ds_observacao_p mprev_agendamento.ds_observacao%type, ie_marcar_horario_p text, nm_usuario_p mprev_agendamento.nm_usuario%type, ie_forma_agendamento_p text, ie_confirmacao_p text, nr_seq_aprovacao_turma_p bigint, nr_seq_captacao_p bigint, ie_previsto_p mprev_agendamento.ie_previsto%type, nr_seq_partic_ciclo_item_p mprev_agendamento.nr_seq_partic_ciclo_item%type, ie_forma_atendimento_p mprev_agendamento.ie_forma_atendimento%type, nr_seq_ativ_extra_p mprev_agendamento.nr_seq_ativ_extra%type, ie_tipo_agendamento_p mprev_agendamento.ie_tipo_agendamento%type, ie_tipo_atendimento_p mprev_agendamento.ie_tipo_atendimento%type, nr_seq_w_agendamento_p w_mprev_agendamento.nr_sequencia%type, nr_seq_grupo_tema_p mprev_grupo_tema_encontro.nr_sequencia%type, nr_seq_forma_atend_p mprev_forma_atendimento.nr_sequencia%type, qt_mensagens_erro_p INOUT bigint, qt_mensagens_atencao_p INOUT bigint, qt_mensagens_confirm_p INOUT bigint, nr_seq_gerada_p INOUT bigint, nr_seq_pac_senha_fila_p mprev_agendamento.nr_seq_pac_senha_fila%type default null) FROM PUBLIC;

