-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE diag_doenca_integra_loop (cd_tipo_evolucao_p text, cd_evolucao_p bigint) AS $body$
DECLARE


dt_chamada_procedure_w	timestamp;
qt_segundos_w bigint;
ie_encontrou_w char(1) := 'N';


BEGIN

select	qt_segundos_int
into STRICT	qt_segundos_w
from	tipo_evolucao
where 	cd_tipo_evolucao = cd_tipo_evolucao_p
and 	coalesce(ie_integrar_diagnostico,'N') = 'S';

dt_chamada_procedure_w := clock_timestamp() + qt_segundos_w/86400;

while ((dt_chamada_procedure_w > clock_timestamp()) and (ie_encontrou_w = 'N'))
loop

	select coalesce(max('S'),'N')
	into STRICT ie_encontrou_w
	from PEP_ITEM_PENDENTE 
	where ie_tipo_pendencia = 'R'
	and cd_evolucao = cd_evolucao_p;

end loop;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE diag_doenca_integra_loop (cd_tipo_evolucao_p text, cd_evolucao_p bigint) FROM PUBLIC;

