-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_laudo_todos_imp_web (nr_atendimento_p bigint, nr_sequencia_p text, ie_mapa_laudo_p text, ie_tipo_imp_p text, ie_status_p text, nm_usuario_p text) AS $body$
DECLARE


nr_seq_presricao_w		integer;
nr_prescricao_w		bigint;

C02 CURSOR FOR
	SELECT 	 b.nr_prescricao,
		 b.nr_sequencia
	from	 laudo_paciente c,
		 prescr_procedimento b,
	 	 prescr_medica a
	where 	 a.nr_atendimento  = nr_atendimento_p
	and	 c.nr_sequencia    = nr_sequencia_p
	and	 a.nr_prescricao   = b.nr_prescricao
	and	 b.nr_prescricao   = c.nr_prescricao
	and	 b.nr_sequencia    = c.NR_SEQ_PRESCRICAO
	and	 coalesce(obter_se_motivo_baixa_conta(b.cd_motivo_baixa), 'S') = 'S';
	--and	 upper('Processando') <> upper(ie_status_p);
BEGIN

if (nr_atendimento_p IS NOT NULL AND nr_atendimento_p::text <> '') then
	open C02;
	loop
	fetch C02 into
		nr_prescricao_w,
		nr_seq_presricao_w;
	EXIT WHEN NOT FOUND; /* apply on C02 */
		begin
			CALL atualizar_lab_prescr_proc_imp(nr_prescricao_w, nr_seq_presricao_w, ie_mapa_laudo_p, nm_usuario_p, ie_tipo_imp_p);
		end;
	end loop;
	close C02;
end if;
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_laudo_todos_imp_web (nr_atendimento_p bigint, nr_sequencia_p text, ie_mapa_laudo_p text, ie_tipo_imp_p text, ie_status_p text, nm_usuario_p text) FROM PUBLIC;

