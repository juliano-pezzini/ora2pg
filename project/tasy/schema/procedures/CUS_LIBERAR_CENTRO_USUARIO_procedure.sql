-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cus_liberar_centro_usuario ( cd_empresa_p bigint, cd_estabelecimento_p bigint, nm_usuario_lib_p text, ds_centro_controle_p text, nm_usuario_p text) AS $body$
DECLARE


cd_centro_controle_w			centro_controle.cd_centro_controle%type;
ds_centro_controle_w			varchar(4000);
nr_pos_sep_w				bigint;

BEGIN

ds_centro_controle_w	:= substr(ds_centro_controle_p,1,4000);

while (ds_centro_controle_w IS NOT NULL AND ds_centro_controle_w::text <> '') loop
	begin
	nr_pos_sep_w	:= coalesce(position(',' in ds_centro_controle_w),0);
	if (nr_pos_sep_w > 0) then
		cd_centro_controle_w	:= somente_numero(substr(ds_centro_controle_w,1,(nr_pos_sep_w - 1)));
	else
		cd_centro_controle_w	:= somente_numero(ds_centro_controle_w);
	end if;

	if (coalesce(cd_centro_controle_w,0) <> 0) then
		begin
		insert into centro_controle_usuario(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			cd_centro_controle,
			cd_estabelecimento,
			nm_usuario_lib,
			ie_dependente)
		values (	nextval('centro_controle_usuario_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			cd_centro_controle_w,
			cd_estabelecimento_p,
			nm_usuario_lib_p,
			'N');
		end;
	end if;
	ds_centro_controle_w	:= substr(ds_centro_controle_w, nr_pos_sep_w +1,4000);
	end;
end loop;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cus_liberar_centro_usuario ( cd_empresa_p bigint, cd_estabelecimento_p bigint, nm_usuario_lib_p text, ds_centro_controle_p text, nm_usuario_p text) FROM PUBLIC;

