-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_lote_imp_inclusao_benef ( nr_seq_lote_p text, nm_pessoa_fisica_p text, cd_estabelecimento_p text, nr_seq_contrato_p text, dt_nascimento_p text, cd_nacionalidade_p text, nm_mae_p text, nr_cpf_p text, ie_estado_civil_p text, ie_sexo_p text, ds_email_p text, nr_identidade_p text, dt_emissao_ci_p text, sg_emissora_ci_p text, nr_seq_pais_p text, ds_orgao_emissor_ci_p text, nr_reg_geral_estrang_p text, cd_cep_p text, ds_endereco_p text, nr_endereco_p text, ds_complemento_p text, ds_bairro_p text, cd_municipio_ibge_p text, sg_estado_p text, nr_ddd_telefone_p text, nr_ddi_telefone_p text, nr_telefone_p text, nr_ddd_celular_p text, nr_telefone_celular_p text, dt_admissao_p text, cd_cbo_p text, cd_matricula_est_p text, nr_ctps_p text, nr_serie_ctps_p text, uf_emissora_ctps_p text, nr_seq_plano_p text, nr_seq_proposta_p text, nr_seq_vinculo_estip_p text, nr_seq_parentesco_p text, dt_adocao_p text, nm_titular_prop_p text, cd_carteira_titular_p text, nr_seq_titular_cont_p text, nr_seq_titular_prop_p text, nr_seq_inclusao_p text, cd_local_repasse_p text, ie_tipo_operacao_p text, cd_usuario_plano_p text, ds_observacao_p text, nr_seq_motivo_rescisao_p text, nm_usuario_p text, cd_declaracao_nasc_vivo_p text, nr_cartao_nac_sus_p text, nr_seq_canal_venda_p text, cd_matricula_familia_p text, nr_pis_pasep_p text, nr_titulo_eleitor_p text, cd_tipo_logradouro_p text, nm_pai_p text, ds_municipio_nasc_p text, sg_estado_nasc_p text, dt_rescisao_p text, ds_lista_sca_p text, ie_permite_sca_p text, nr_seq_intercambio_p text, nr_nivel_faixa_salarial_p text, nr_seq_localizacao_benef_p text, nr_seq_tabela_p text, dt_contratacao_p text, nr_seq_motivo_inclusao_p text, nr_seq_codigo_externo_p text, nr_seq_subestipulante_p text, nr_linha_arq_p text default 0, ds_erro_p INOUT text DEFAULT NULL, nm_social_p text DEFAULT NULL, nr_protocolo_portabilidade_p text DEFAULT NULL, dt_inclusao_ops_origem_p text DEFAULT NULL, vl_preco_plano_origem_p text DEFAULT NULL, dt_emissao_prot_portab_p text DEFAULT NULL, nr_registro_ops_ans_p text DEFAULT NULL, ie_abrangencia_plano_origem_p text DEFAULT NULL, nr_registro_plano_origem_p text DEFAULT NULL, ie_tp_contr_plano_origem_p text DEFAULT NULL, dt_inclusao_operadora_p text DEFAULT NULL, dt_casamento_p text DEFAULT NULL, nr_cert_casamento_p text DEFAULT NULL, dt_reinclusao_p text DEFAULT NULL) AS $body$
DECLARE


/*
ROTINA UTILIZADA NA IMPORTACAO DE BENEFICIARIOS POR LOTE
Necessario colocar os tipos das variaveis de entradas como varchar2
*/
nr_seq_congenere_w		bigint;
qt_registros_w			bigint;
ds_municipio_w			varchar(255);
nr_seq_segurado_w		bigint := null;
nr_seq_vendedor_pf_w		bigint := null;
nr_seq_plano_proposta_w		bigint;
ie_aplicacao_regra_w		varchar(2);
nr_seq_faixa_salarial_w		pls_faixa_salarial.nr_sequencia%type;

ds_erro_w			varchar(255) := null;
nr_seq_lote_w			pls_inclusao_beneficiario.nr_seq_lote_inclusao%type;
nm_pessoa_fisica_w		pls_inclusao_beneficiario.nm_pessoa_fisica%type;
nm_social_w			pls_inclusao_beneficiario.nm_social%type;
cd_estabelecimento_w		pls_inclusao_beneficiario.cd_estabelecimento%type;
nr_seq_contrato_w		pls_inclusao_beneficiario.nr_seq_contrato%type;
dt_nascimento_w			pls_inclusao_beneficiario.dt_nascimento%type;
cd_nacionalidade_w		pls_inclusao_beneficiario.cd_nacionalidade%type;
nm_mae_w			pls_inclusao_beneficiario.nm_mae%type;
nr_cpf_w			pls_inclusao_beneficiario.nr_cpf%type;
ie_estado_civil_w		pls_inclusao_beneficiario.ie_estado_civil%type;
ie_sexo_w			pls_inclusao_beneficiario.ie_sexo%type;
ds_email_w			pls_inclusao_beneficiario.ds_email%type;
nr_identidade_w			pls_inclusao_beneficiario.nr_identidade%type;
dt_emissao_ci_w			pls_inclusao_beneficiario.dt_emissao_ci%type;
nr_seq_pais_w			pls_inclusao_beneficiario.nr_seq_pais%type;
ds_orgao_emissor_ci_w		pls_inclusao_beneficiario.ds_orgao_emissor_ci%type;
nr_reg_geral_estrang_w		pls_inclusao_beneficiario.nr_reg_geral_estrang%type;
cd_cep_w			pls_inclusao_beneficiario.cd_cep%type;
ds_endereco_w			pls_inclusao_beneficiario.ds_endereco%type;
nr_endereco_w			pls_inclusao_beneficiario.nr_endereco%type;
ds_complemento_w		pls_inclusao_beneficiario.ds_complemento%type;
ds_bairro_w			pls_inclusao_beneficiario.ds_bairro%type;
cd_municipio_ibge_w		pls_inclusao_beneficiario.cd_municipio_ibge%type;
sg_estado_w			pls_inclusao_beneficiario.sg_estado%type;
nr_ddd_telefone_w		pls_inclusao_beneficiario.nr_ddd_telefone%type;
nr_ddi_telefone_w		pls_inclusao_beneficiario.nr_ddi_telefone%type;
nr_telefone_w			pls_inclusao_beneficiario.nr_telefone%type;
nr_ddd_celular_w		pls_inclusao_beneficiario.nr_ddd_celular%type;
nr_telefone_celular_w		pls_inclusao_beneficiario.nr_telefone_celular%type;
dt_admissao_w			pls_inclusao_beneficiario.dt_admissao%type;
cd_cbo_w			pls_inclusao_beneficiario.cd_cbo%type;
cd_matricula_est_w		pls_inclusao_beneficiario.cd_matricula_est%type;
nr_ctps_w			pls_inclusao_beneficiario.nr_ctps%type;
nr_serie_ctps_w			pls_inclusao_beneficiario.nr_serie_ctps%type;
uf_emissora_ctps_w		pls_inclusao_beneficiario.uf_emissora_ctps%type;
nr_seq_plano_w			pls_inclusao_beneficiario.nr_seq_plano%type;
nr_seq_proposta_w		pls_inclusao_beneficiario.nr_seq_proposta%type;
nr_seq_vinculo_estip_w		pls_inclusao_beneficiario.nr_seq_vinculo_estip%type;
nr_seq_parentesco_w		pls_inclusao_beneficiario.nr_seq_parentesco%type;
dt_adocao_w			pls_inclusao_beneficiario.dt_adocao%type;
nm_titular_prop_w		pls_inclusao_beneficiario.nm_titular_inclusao%type;
cd_carteira_titular_w		pls_inclusao_beneficiario.cd_cartao_titular_imp%type;
nr_seq_titular_cont_w		pls_inclusao_beneficiario.nr_seq_titular_contrato%type;
nr_seq_titular_prop_w		pls_inclusao_beneficiario.nr_seq_titular_prop%type;
nr_seq_inclusao_w		pls_inclusao_beneficiario.nr_sequencia%type;
cd_local_repasse_w		pls_inclusao_beneficiario.cd_operadora_congenere%type;
ie_tipo_operacao_w		pls_inclusao_beneficiario.ie_tipo_operacao%type;
cd_usuario_plano_w		pls_inclusao_beneficiario.cd_usuario_plano%type;
ds_observacao_w			pls_inclusao_beneficiario.ds_observacao%type;
nr_seq_motivo_rescisao_w	pls_inclusao_beneficiario.nr_seq_motivo_cancelamento%type;
nm_usuario_w			pls_inclusao_beneficiario.nm_usuario%type;
cd_declaracao_nasc_vivo_w	pls_inclusao_beneficiario.cd_declaracao_nasc_vivo%type;
nr_cartao_nac_sus_w		pls_inclusao_beneficiario.nr_cartao_nac_sus%type;
nr_seq_canal_venda_w		pls_inclusao_beneficiario.nr_seq_vendedor_canal%type;
nr_seq_canal_venda_contr_w	pls_inclusao_beneficiario.nr_seq_vendedor_canal%type;
cd_matricula_familia_w		pls_inclusao_beneficiario.cd_matricula_familia%type;
nr_pis_pasep_w			pls_inclusao_beneficiario.nr_pis_pasep%type;
nr_titulo_eleitor_w		pls_inclusao_beneficiario.nr_titulo_eleitor%type;
cd_tipo_logradouro_w		pls_inclusao_beneficiario.cd_tipo_logradouro%type;
nm_pai_w			pls_inclusao_beneficiario.nm_pai%type;
ds_municipio_nasc_w		pls_inclusao_beneficiario.ds_municipio_nasc%type;
sg_estado_nasc_w		pls_inclusao_beneficiario.sg_estado_nasc%type;
ds_municipio_nasc_estrang_w	pls_inclusao_beneficiario.ds_municipio_nasc_estrangeiro%type;
dt_rescisao_w			pls_inclusao_beneficiario.dt_rescisao%type;
sg_emissora_ci_w		pls_inclusao_beneficiario.sg_emissora_ci%type;
nr_seq_intercambio_w		pls_inclusao_beneficiario.nr_seq_intercambio%type;
nr_nivel_faixa_salarial_w	pls_inclusao_beneficiario.nr_nivel_faixa_salarial%type;
nr_seq_localizacao_benef_w	pls_inclusao_beneficiario.nr_seq_localizacao_benef%type;
nr_seq_tabela_w			pls_inclusao_beneficiario.nr_seq_tabela%type;
dt_contratacao_w		pls_inclusao_beneficiario.dt_contratacao%type;
nr_seq_motivo_inclusao_w	pls_inclusao_beneficiario.nr_seq_motivo_inclusao%type;
nr_seq_codigo_externo_w		pls_inclusao_beneficiario.nr_seq_codigo_externo%type;
nr_seq_subestipulante_w		pls_inclusao_beneficiario.nr_seq_subestipulante%type;
nr_protocolo_portabilidade_w	pls_inclusao_beneficiario.nr_protocolo_portabilidade%type;
dt_inclusao_ops_origem_w	pls_inclusao_beneficiario.dt_inclusao_ops_origem%type;
vl_preco_plano_origem_w		pls_inclusao_beneficiario.vl_preco_plano_origem%type;
dt_emissao_prot_portab_w	pls_inclusao_beneficiario.dt_emissao_prot_portab%type;
nr_registro_ops_ans_w		pls_inclusao_beneficiario.nr_registro_ops_ans%type;
ie_abrangencia_plano_origem_w	pls_inclusao_beneficiario.ie_abrangencia_plano_origem%type;
nr_registro_plano_origem_w	pls_inclusao_beneficiario.nr_registro_plano_origem%type;
ie_tp_contr_plano_origem_w	pls_inclusao_beneficiario.ie_tp_contratacao_plano_origem%type;
dt_inclusao_operadora_w		pls_inclusao_beneficiario.dt_inclusao_operadora%type;
qt_plano_w			bigint;
qt_erro_w			bigint;
qt_estado_w			bigint;
cd_municipio_ibge_nasc_w	sus_municipio.cd_municipio_ibge%type;
dt_casamento_w			pls_inclusao_beneficiario.dt_emissao_cert_casamento%type;
nr_cert_casamento_w		pls_inclusao_beneficiario.nr_cert_casamento%type;
dt_reinclusao_w		pls_inclusao_beneficiario.dt_reinclusao%type;


BEGIN

begin
	nr_seq_lote_w := nr_seq_lote_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Numero do lote' || ';DS_VALOR_P=' || nr_seq_lote_p);
end;
begin
	nm_pessoa_fisica_w := nm_pessoa_fisica_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Nome pessoa fisica' || ';DS_VALOR_P=' || nm_pessoa_fisica_p);
end;
begin
	nm_social_w := nm_social_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Nome social' || ';DS_VALOR_P=' || nm_social_p);
end;
begin
	cd_estabelecimento_w := cd_estabelecimento_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Estabelecimento' || ';DS_VALOR_P=' || cd_estabelecimento_p);
end;
begin
	nr_seq_contrato_w := nr_seq_contrato_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Contrato' || ';DS_VALOR_P=' || nr_seq_contrato_p);
end;
begin
	dt_nascimento_w := to_date(dt_nascimento_p, 'dd/mm/yyyy');
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Data de nascimento' || ';DS_VALOR_P=' || dt_nascimento_p);
end;
begin
	cd_nacionalidade_w := cd_nacionalidade_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Nacionalidade' || ';DS_VALOR_P=' || cd_nacionalidade_p);
end;
begin
	nm_mae_w := nm_mae_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Nome da mae' || ';DS_VALOR_P=' || nm_mae_p);
end;
begin
	nr_cpf_w := nr_cpf_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'CPF' || ';DS_VALOR_P=' || nr_cpf_p);
end;
begin
	ie_estado_civil_w := ie_estado_civil_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Estado civil' || ';DS_VALOR_P=' || ie_estado_civil_p);
end;
begin
	ie_sexo_w := ie_sexo_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Sexo' || ';DS_VALOR_P=' || ie_sexo_p);
end;
begin
	ds_email_w := ds_email_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Email' || ';DS_VALOR_P=' || ds_email_p);
end;
begin
	nr_identidade_w := nr_identidade_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'RG' || ';DS_VALOR_P=' || nr_identidade_p);
end;
begin
	dt_emissao_ci_w := to_date(dt_emissao_ci_p, 'dd/mm/yyyy');
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Data emissao RG' || ';DS_VALOR_P=' || dt_emissao_ci_p);
end;
begin
	sg_emissora_ci_w := sg_emissora_ci_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'UF emissao RG' || ';DS_VALOR_P=' || sg_emissora_ci_p);
end;
begin
	nr_seq_pais_w := nr_seq_pais_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Pais emissor' || ';DS_VALOR_P=' || nr_seq_pais_p);
end;
begin
	ds_orgao_emissor_ci_w := ds_orgao_emissor_ci_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Orgao emissor' || ';DS_VALOR_P=' || ds_orgao_emissor_ci_p);
end;
begin
	nr_reg_geral_estrang_w := nr_reg_geral_estrang_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'RG estrangeiro' || ';DS_VALOR_P=' || nr_reg_geral_estrang_p);
end;
begin
	cd_cep_w := somente_numero_char(cd_cep_p);
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'CEP' || ';DS_VALOR_P=' || cd_cep_p);
end;
begin
	ds_endereco_w := ds_endereco_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Endereco' || ';DS_VALOR_P=' || ds_endereco_p);
end;
begin
	nr_endereco_w := nr_endereco_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Nr endereco' || ';DS_VALOR_P=' || nr_endereco_p);
end;
begin
	ds_complemento_w := ds_complemento_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Complemento' || ';DS_VALOR_P=' || ds_complemento_p);
end;
begin
	ds_bairro_w := ds_bairro_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Bairro' || ';DS_VALOR_P=' || ds_bairro_p);
end;
begin
	cd_municipio_ibge_w := cd_municipio_ibge_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Municipio' || ';DS_VALOR_P=' || cd_municipio_ibge_p);
end;
begin
	sg_estado_w := sg_estado_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'UF' || ';DS_VALOR_P=' || sg_estado_p);
end;
begin
	nr_ddd_telefone_w := nr_ddd_telefone_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'DDD' || ';DS_VALOR_P=' || nr_ddd_telefone_p);
end;
begin
	nr_ddi_telefone_w := nr_ddi_telefone_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'DDI' || ';DS_VALOR_P=' || nr_ddi_telefone_p);
end;
begin
	nr_telefone_w := somente_numero_char(nr_telefone_p);
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Telefone' || ';DS_VALOR_P=' || nr_telefone_p);
end;
begin
	nr_ddd_celular_w := nr_ddd_celular_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'DDDCCel' || ';DS_VALOR_P=' || nr_ddd_celular_p);
end;
begin
	nr_telefone_celular_w := somente_numero_char(nr_telefone_celular_p);
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Celular' || ';DS_VALOR_P=' || nr_telefone_celular_p);
end;
begin
	dt_admissao_w := to_date(dt_admissao_p, 'dd/mm/yyyy');
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Data admissao' || ';DS_VALOR_P=' || dt_admissao_p);
end;
begin
	cd_cbo_w := cd_cbo_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'CBO' || ';DS_VALOR_P=' || cd_cbo_p);
end;
begin
	cd_matricula_est_w := cd_matricula_est_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Matricula' || ';DS_VALOR_P=' || cd_matricula_est_p);
end;
begin
	nr_ctps_w := nr_ctps_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'CTPS' || ';DS_VALOR_P=' || nr_ctps_p);
end;
begin
	nr_serie_ctps_w := nr_serie_ctps_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Serie CTPS' || ';DS_VALOR_P=' || nr_serie_ctps_p);
end;
begin
	uf_emissora_ctps_w := uf_emissora_ctps_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'UF CTPS' || ';DS_VALOR_P=' || uf_emissora_ctps_p);
end;
begin
	nr_seq_plano_w := nr_seq_plano_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Produto' || ';DS_VALOR_P=' || nr_seq_plano_p);
end;
begin
	nr_seq_proposta_w := nr_seq_proposta_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Proposta' || ';DS_VALOR_P=' || nr_seq_proposta_p);
end;
begin
	nr_seq_vinculo_estip_w := nr_seq_vinculo_estip_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Vinculo estipulante' || ';DS_VALOR_P=' || nr_seq_vinculo_estip_p);
end;
begin
	nr_seq_parentesco_w := nr_seq_parentesco_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Parentesco' || ';DS_VALOR_P=' || nr_seq_parentesco_p);
end;
begin
	dt_adocao_w := dt_adocao_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Data de adocao' || ';DS_VALOR_P=' || dt_adocao_p);
end;
begin
	nm_titular_prop_w := nm_titular_prop_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Nome titular' || ';DS_VALOR_P=' || nm_titular_prop_p);
end;
begin
	cd_carteira_titular_w := cd_carteira_titular_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Carteira Titular' || ';DS_VALOR_P=' || cd_carteira_titular_p);
end;
begin
	nr_seq_titular_cont_w := nr_seq_titular_cont_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Titular contrato' || ';DS_VALOR_P=' || nr_seq_titular_cont_p);
end;
begin
	nr_seq_titular_prop_w := nr_seq_titular_prop_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Titular proposta' || ';DS_VALOR_P=' || nr_seq_titular_prop_p);
end;
begin
	cd_local_repasse_w := cd_local_repasse_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Local repasse' || ';DS_VALOR_P=' || cd_local_repasse_p);
end;
begin
	ie_tipo_operacao_w := trim(both ie_tipo_operacao_p);
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Tipo operacao' || ';DS_VALOR_P=' || ie_tipo_operacao_p);
end;
begin
	cd_usuario_plano_w := cd_usuario_plano_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Produto usuario' || ';DS_VALOR_P=' || cd_usuario_plano_p);
end;
begin
	ds_observacao_w := ds_observacao_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Observacao' || ';DS_VALOR_P=' || ds_observacao_p);
end;
begin
	nr_seq_motivo_rescisao_w := nr_seq_motivo_rescisao_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Motivo rescisao' || ';DS_VALOR_P=' || nr_seq_motivo_rescisao_p);
end;
begin
	nm_usuario_w := nm_usuario_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Usuario' || ';DS_VALOR_P=' || nm_usuario_p);
end;
begin
	cd_declaracao_nasc_vivo_w := cd_declaracao_nasc_vivo_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Declaracao nasc vivo' || ';DS_VALOR_P=' || cd_declaracao_nasc_vivo_p);
end;
begin
	nr_cartao_nac_sus_w := nr_cartao_nac_sus_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Cartao SUS' || ';DS_VALOR_P=' || nr_cartao_nac_sus_p);
end;
begin
	nr_seq_canal_venda_w := nr_seq_canal_venda_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Canal Venda' || ';DS_VALOR_P=' || nr_seq_canal_venda_p);
end;
begin
	cd_matricula_familia_w := cd_matricula_familia_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || 'NM_CAMPO_P=' || 'Matricula familia' || ';DS_VALOR_P=' || cd_matricula_familia_p);
end;
begin
	nr_pis_pasep_w := nr_pis_pasep_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'PIS' || ';DS_VALOR_P=' || nr_pis_pasep_p);
end;
begin
	nr_titulo_eleitor_w := nr_titulo_eleitor_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Titulo eleitor' || ';DS_VALOR_P=' || nr_titulo_eleitor_p);
end;
begin
	cd_tipo_logradouro_w := cd_tipo_logradouro_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Logradouro' || ';DS_VALOR_P=' || cd_tipo_logradouro_p);
end;
begin
	nm_pai_w := nm_pai_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Nome do pai' || ';DS_VALOR_P=' || nm_pai_p);
end;
begin
	ds_municipio_nasc_w := ds_municipio_nasc_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Municipio nascimento' || ';DS_VALOR_P=' || ds_municipio_nasc_p);
end;
begin
	sg_estado_nasc_w := sg_estado_nasc_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'UF nascimento' || ';DS_VALOR_P=' || sg_estado_nasc_p);
end;
begin
	dt_rescisao_w := to_date(dt_rescisao_p, 'dd/mm/yyyy');
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Data rescisao' || ';DS_VALOR_P=' || dt_rescisao_p);
end;
begin
	nr_seq_intercambio_w := nr_seq_intercambio_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Intercambio' || ';DS_VALOR_P=' || nr_seq_intercambio_p);
end;
begin
	nr_nivel_faixa_salarial_w := nr_nivel_faixa_salarial_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Faixa salarial' || ';DS_VALOR_P=' || nr_nivel_faixa_salarial_p);
end;
begin
	nr_seq_localizacao_benef_w := nr_seq_localizacao_benef_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Localizacao beneficiario' || ';DS_VALOR_P=' || nr_seq_localizacao_benef_p);
end;
begin
	nr_seq_tabela_w := nr_seq_tabela_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Tabela de preco' || ';DS_VALOR_P=' || nr_seq_tabela_p);
end;
begin
	dt_contratacao_w := to_date(dt_contratacao_p, 'dd/mm/yyyy');
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Data de contratacao' || ';DS_VALOR_P=' || dt_contratacao_p);
end;
begin
	nr_seq_motivo_inclusao_w := nr_seq_motivo_inclusao_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Nr motivo inclusao' || ';DS_VALOR_P=' || nr_seq_motivo_inclusao_p);
end;
begin
	nr_seq_codigo_externo_w := nr_seq_codigo_externo_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Nr codigo externo' || ';DS_VALOR_P=' || nr_seq_codigo_externo_p);
end;
begin
	nr_seq_subestipulante_w := nr_seq_subestipulante_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Nr subestipulante' || ';DS_VALOR_P=' || nr_seq_subestipulante_p);
end;
begin
	dt_inclusao_ops_origem_w := dt_inclusao_ops_origem_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Data contratacao plano origem' || ';DS_VALOR_P=' || dt_inclusao_ops_origem_p);
end;
begin
	vl_preco_plano_origem_w := vl_preco_plano_origem_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || ' Preco do plano de origem' || ';DS_VALOR_P=' || vl_preco_plano_origem_p);
end;
begin
	nr_protocolo_portabilidade_w := nr_protocolo_portabilidade_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Nr protocolo guia ANS' || ';DS_VALOR_P=' || nr_protocolo_portabilidade_p);
end;
begin
	dt_emissao_prot_portab_w := dt_emissao_prot_portab_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Data emissao do protocolo Guia ANS' || ';DS_VALOR_P=' || dt_emissao_prot_portab_p);
end;
begin
	nr_registro_ops_ans_w := nr_registro_ops_ans_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Operadora de origem' || ';DS_VALOR_P=' || nr_registro_ops_ans_p);
end;
begin
	ie_abrangencia_plano_origem_w := ie_abrangencia_plano_origem_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Abrangencia geografica do plano de origem' || ';DS_VALOR_P=' || ie_abrangencia_plano_origem_p);
end;
begin
	nr_registro_plano_origem_w := nr_registro_plano_origem_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'N do registro do produto de origem' || ';DS_VALOR_P=' || nr_registro_plano_origem_p);
end;
begin
	ie_tp_contr_plano_origem_w := ie_tp_contr_plano_origem_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Tipo de contratacao do plano de origem' || ';DS_VALOR_P=' || ie_tp_contr_plano_origem_p);
end;
begin
	dt_inclusao_operadora_w := dt_inclusao_operadora_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Data inclusao operadora' || ';DS_VALOR_P=' || dt_inclusao_operadora_p);
end;

begin
if ((trim(both dt_casamento_p) IS NOT NULL AND (trim(both dt_casamento_p))::text <> '')) then
	dt_casamento_w := to_date(dt_casamento_p,'dd/mm/yyyy');
end if;		
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Data casamento' || ';DS_VALOR_P=' || dt_casamento_p);
end;

begin
	nr_cert_casamento_w := trim(both nr_cert_casamento_p);
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Numero certificado casamento' || ';DS_VALOR_P=' || nr_cert_casamento_p);
end;

begin
	dt_reinclusao_w := dt_reinclusao_p;
exception
when others then
	ds_erro_w := ds_erro_w || chr(13) || wheb_mensagem_pck.get_texto(340665, 'NR_LINHA_P=' || nr_linha_arq_p || ';NM_CAMPO_P=' || 'Data reinclusao' || ';DS_VALOR_P=' || dt_reinclusao_p);
end;

if (coalesce(nr_seq_inclusao_p::text, '') = '') then
	select	nextval('pls_inclusao_beneficiario_seq')
	into STRICT	nr_seq_inclusao_w
	;
else
	nr_seq_inclusao_w	:= nr_seq_inclusao_p;
end if;

if (coalesce(nr_seq_contrato_w::text, '') = '') then
	if (nr_seq_intercambio_w IS NOT NULL AND nr_seq_intercambio_w::text <> '') then
		if (coalesce(nr_seq_plano_w,0) = 0) then
			select	max(nr_seq_plano)
			into STRICT	nr_seq_plano_w
			from	pls_intercambio_plano
			where	nr_seq_intercambio = nr_seq_intercambio_w
			and	coalesce(dt_inativacao::text, '') = '';
		end if;
	else
		select	max(nr_seq_plano)
		into STRICT	nr_seq_plano_proposta_w
		from	pls_proposta_plano
		where	nr_seq_proposta = nr_seq_proposta_w
		and	nr_seq_plano = nr_seq_plano_w;

		if (nr_seq_plano_proposta_w IS NOT NULL AND nr_seq_plano_proposta_w::text <> '') then
			nr_seq_plano_w := nr_seq_plano_proposta_w;
		else
			select	max(nr_seq_plano)
			into STRICT	nr_seq_plano_w
			from	pls_proposta_plano
			where	nr_seq_proposta = nr_seq_proposta_w;
		end if;
	end if;
else
	ie_aplicacao_regra_w := pls_obter_dados_contrato(nr_seq_contrato_w, 'AR');

	if (coalesce(ie_aplicacao_regra_w::text, '') = '' or ie_aplicacao_regra_w = 'A' or ie_aplicacao_regra_w = 'P') then
		nr_seq_canal_venda_contr_w := (pls_obter_dados_contrato(nr_seq_contrato_w, 'CV'))::numeric;
	if (coalesce(nr_seq_canal_venda_contr_w::text, '') = '' or nr_seq_canal_venda_contr_w = 0) then
		nr_seq_vendedor_pf_w := pls_obter_padrao_vend_canal(nr_seq_canal_venda_w);
	else
		nr_seq_canal_venda_w := nr_seq_canal_venda_contr_w;
		nr_seq_vendedor_pf_w := coalesce((pls_obter_dados_contrato(nr_seq_contrato_w, 'V'))::numeric ,pls_obter_padrao_vend_canal(nr_seq_canal_venda_w));
	end if;
end if;

if (coalesce(nr_seq_plano_w::text, '') = '') then
	select	max(nr_seq_plano)
	into STRICT	nr_seq_plano_w
	from	pls_contrato_plano
	where	nr_seq_contrato	= nr_seq_contrato_w
	and	coalesce(dt_inativacao::text, '') = '';
end if;
  if (nr_seq_plano_w IS NOT NULL AND nr_seq_plano_w::text <> '') then

	select	count(1)
	into STRICT	qt_plano_w
	from	pls_plano
	where	nr_sequencia	= nr_seq_plano_w;

	if (qt_plano_w = 0) then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(359871,'NR_SEQ_PLANO='||nr_seq_plano_w||';NR_LINHA='||nr_linha_arq_p);
	end if;
  end if;
end if;

if (nr_seq_titular_cont_w IS NOT NULL AND nr_seq_titular_cont_w::text <> '') then
	nr_seq_titular_cont_w := nr_seq_titular_cont_w;
	
elsif (cd_carteira_titular_w IS NOT NULL AND cd_carteira_titular_w::text <> '') then
	if (nr_seq_contrato_w IS NOT NULL AND nr_seq_contrato_w::text <> '') then
		select  max(a.nr_sequencia)
		into STRICT    nr_seq_titular_cont_w
		from    pls_segurado a,
			pls_segurado_carteira b
		where   a.nr_Sequencia = b.nr_seq_segurado
		and     b.cd_usuario_plano = cd_carteira_titular_w
		and     a.nr_seq_contrato = nr_seq_contrato_w;
	else
		select  max(a.nr_sequencia)
		into STRICT    nr_seq_titular_cont_w
		from    pls_segurado a,
		    pls_segurado_carteira b
		where   a.nr_Sequencia = b.nr_seq_segurado
		and     b.cd_usuario_plano = cd_carteira_titular_w;
	end if;
end if;

if (cd_local_repasse_w IS NOT NULL AND cd_local_repasse_w::text <> '') then
	select  coalesce(max(nr_sequencia),0)
	into STRICT    nr_seq_congenere_w
	from    pls_congenere
	where   cd_cooperativa	= cd_local_repasse_w;


	if (nr_seq_congenere_w = 0) then
		nr_seq_congenere_w	:= null;
	end if;
end if;

if (cd_municipio_ibge_w IS NOT NULL AND cd_municipio_ibge_w::text <> '') then
	ds_municipio_w  := substr(obter_desc_municipio_ibge(cd_municipio_ibge_w),1,255);

	if (coalesce(ds_municipio_w::text, '') = '') then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(356060,'CD_MUNICIPIO_IBGE='||cd_municipio_ibge_w||';NR_LINHA='||nr_linha_arq_p);
	end if;
end if;

if (nr_nivel_faixa_salarial_w IS NOT NULL AND nr_nivel_faixa_salarial_w::text <> '') then
	select	max(nr_sequencia)
	into STRICT	nr_seq_faixa_salarial_w
	from	pls_faixa_salarial
	where	nr_nivel = nr_nivel_faixa_salarial_w;
end if;

if (coalesce(ie_tipo_operacao_w,'I') <> 'I') then
	begin
		select  nr_seq_segurado
		into STRICT    nr_seq_segurado_w
		from    pls_segurado_carteira
		where   cd_usuario_plano	= cd_usuario_plano_w;
	exception
	when others then
		nr_seq_segurado_w  := null;
	end;
	
	if (nr_seq_segurado_w IS NOT NULL AND nr_seq_segurado_w::text <> '') then
		nm_pessoa_fisica_w	:= substr(pls_obter_dados_segurado(nr_seq_segurado_w,'NS'),1,255);
	end if;
end if;

if (ds_municipio_nasc_w IS NOT NULL AND ds_municipio_nasc_w::text <> '') then
	if (cd_nacionalidade_w = 10) then
		ds_municipio_nasc_estrang_w := null;
	else
	    ds_municipio_nasc_estrang_w := ds_municipio_nasc_w;
	    ds_municipio_nasc_w := null;
	end if;
	
	if (ds_municipio_nasc_w IS NOT NULL AND ds_municipio_nasc_w::text <> '') then
		select	max(cd_municipio_ibge)
		into STRICT	cd_municipio_ibge_nasc_w
		from	sus_municipio
		where	upper(ds_municipio) = trim(both upper(ds_municipio_nasc_w))
		and	upper(ds_unidade_federacao) = trim(both upper(sg_estado_nasc_w));
	else
		cd_municipio_ibge_nasc_w	:= null;
	end if;
end if;

if (cd_cbo_w IS NOT NULL AND cd_cbo_w::text <> '') then
	select	count(1)
	into STRICT	qt_registros_w
	from	sus_cbo
	where	cd_cbo  = cd_cbo_w;

  if (qt_registros_w = 0) then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(356324,'CD_CBO='||cd_cbo_w||';NR_LINHA='||nr_linha_arq_p);
  end if;
end if;

/* verifica consistencias de chaves  */

if (cd_nacionalidade_w IS NOT NULL AND cd_nacionalidade_w::text <> '') then

	select	count(1)
	into STRICT	qt_erro_w
	from	nacionalidade
	where	cd_nacionalidade = cd_nacionalidade_w;

	if (qt_erro_w = 0) then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(379919,'CD_NACIONALIDADE='||cd_nacionalidade_w||';NR_LINHA='||nr_linha_arq_p);
	end if;
end if;

if (nr_seq_pais_w IS NOT NULL AND nr_seq_pais_w::text <> '') then
	select	count(1)
	into STRICT	qt_erro_w
	from	pais
	where	nr_sequencia = nr_seq_pais_w;

	if (qt_erro_w = 0) then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(379927,'NR_SEQ_PAIS='||nr_seq_pais_w||';NR_LINHA='||nr_linha_arq_p);
	end if;
end if;

if (nr_seq_vinculo_estip_w IS NOT NULL AND nr_seq_vinculo_estip_w::text <> '') then
	select	count(1)
	into STRICT	qt_erro_w
	from	pls_vinculo_estipulante
	where	nr_sequencia = nr_seq_vinculo_estip_w;

	if (qt_erro_w = 0 ) then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(379930,'NR_SEQ_VINCULO='||nr_seq_vinculo_estip_w||';NR_LINHA='||nr_linha_arq_p);
	end if;
end if;


if (nr_seq_parentesco_w IS NOT NULL AND nr_seq_parentesco_w::text <> '') then

	select	count(1)
	into STRICT	qt_erro_w
	from	grau_parentesco
	where	nr_sequencia =  nr_seq_parentesco_w;

	if (qt_erro_w = 0) then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(379932,'NR_SEQ_PARENTESCO='||nr_seq_parentesco_w||';NR_LINHA='||nr_linha_arq_p);
	end if;
end if;

if (nr_seq_motivo_rescisao_w IS NOT NULL AND nr_seq_motivo_rescisao_w::text <> '') then

	select	count(1)
	into STRICT	qt_erro_w
	from	pls_motivo_cancelamento
	where	nr_sequencia =  nr_seq_motivo_rescisao_w;

	if (qt_erro_w = 0) then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(379934,'NR_SEQ_MOTIVO_RESCISAO='||nr_seq_motivo_rescisao_w||';NR_LINHA='||nr_linha_arq_p);
	end if;
end if;

if (nr_seq_tabela_w IS NOT NULL AND nr_seq_tabela_w::text <> '') then

	select	count(1)
	into STRICT	qt_erro_w
	from	pls_tabela_preco
	where	nr_sequencia =  nr_seq_tabela_w;

	if (qt_erro_w = 0) then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(379913,'NR_SEQ_TABELA='||nr_seq_tabela_w||';NR_LINHA='||nr_linha_arq_p);
	end if;
end if;

if (nr_seq_localizacao_benef_w IS NOT NULL AND nr_seq_localizacao_benef_w::text <> '') then

	select	count(1)
	into STRICT	qt_erro_w
	from	pls_localizacao_benef a,
		pls_localizacao_pj b
	where	a.nr_seq_localizacao_pj = b.nr_sequencia
	and	a.nr_sequencia = nr_seq_localizacao_benef_w;

	if (qt_erro_w = 0) then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(379917,'NR_SEQ_LOCALIZACAO='||nr_seq_localizacao_benef_w||';NR_LINHA='||nr_linha_arq_p);
	end if;
end if;

if (ie_estado_civil_w IS NOT NULL AND ie_estado_civil_w::text <> '') then

	select	somente_numero(ie_estado_civil_w)
	into STRICT	ie_estado_civil_w
	;

	if (ie_estado_civil_w =0 or ie_estado_civil_w >9) then
		ie_estado_civil_w := null;
	end if;
end if;

if (nr_titulo_eleitor_w IS NOT NULL AND nr_titulo_eleitor_w::text <> '') then
	select  pls_elimina_caracteres_esp(nr_titulo_eleitor_w)
	into STRICT    nr_titulo_eleitor_w
	;
end if;

if (nr_cartao_nac_sus_w IS NOT NULL AND nr_cartao_nac_sus_w::text <> '') then

	select  somente_numero(nr_cartao_nac_sus_w)
	into STRICT    nr_cartao_nac_sus_w
	;

	if (nr_cartao_nac_sus_w =0 ) then
		nr_cartao_nac_sus_w := null;
	end if;
end if;

if (nr_seq_motivo_inclusao_w IS NOT NULL AND nr_seq_motivo_inclusao_w::text <> '') then
	select count(1)
	into STRICT   qt_erro_w
	from   pls_motivo_inclusao_seg
	where  nr_sequencia =  nr_seq_motivo_inclusao_w;

	if (qt_erro_w = 0) then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(402582,'NR_SEQ_MOTIVO_INCLUSAO='||nr_seq_motivo_inclusao_w||';NR_LINHA='||nr_linha_arq_p);
	end if;
end if;

if (nr_seq_codigo_externo_w IS NOT NULL AND nr_seq_codigo_externo_w::text <> '') then
	select	rtrim(ltrim(nr_seq_codigo_externo_w))
	into STRICT	nr_seq_codigo_externo_w
	;
end if;

/*Se o nm_titular e cd_carteirinha_titular estiverem preechidos, considerar o cd_carteirinha_titular */

if (cd_carteira_titular_w IS NOT NULL AND cd_carteira_titular_w::text <> '' AND nm_titular_prop_w IS NOT NULL AND nm_titular_prop_w::text <> '') then
	nm_titular_prop_w := null;
end if;

if (sg_estado_w IS NOT NULL AND sg_estado_w::text <> '') then
	select	count(*)
	into STRICT	qt_estado_w
	from	valor_dominio_v
	where	cd_dominio = 50 
	and	vl_dominio = sg_estado_w;

	if (qt_estado_w = 0) then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(499409,'SG_ESTADO='||sg_estado_w||';NR_LINHA='||nr_linha_arq_p);
	end if;
end if;

if (sg_emissora_ci_w IS NOT NULL AND sg_emissora_ci_w::text <> '') then
	select	count(*)
	into STRICT	qt_estado_w
	from	valor_dominio_v
	where	cd_dominio = 50 
	and	vl_dominio = sg_emissora_ci_w;

	if (qt_estado_w = 0) then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(499422,'SG_EMISSORA='||sg_emissora_ci_w||';NR_LINHA='||nr_linha_arq_p);
	end if;
end if;

if (nr_seq_lote_w IS NOT NULL AND nr_seq_lote_w::text <> '') then
	insert	into pls_inclusao_beneficiario(
		nr_sequencia, nm_pessoa_fisica, cd_estabelecimento,
		ie_status, dt_solicitacao, nr_seq_contrato,
		dt_nascimento, cd_nacionalidade, nm_mae,
		dt_atualizacao, nm_usuario, dt_atualizacao_nrec,
		nm_usuario_nrec, nr_cpf, ie_estado_civil,
		ie_sexo, ds_email, nr_identidade,
		dt_emissao_ci, sg_emissora_ci, nr_seq_pais,
		ds_orgao_emissor_ci, nr_reg_geral_estrang, cd_cep,
		ds_endereco, nr_endereco, ds_complemento,
		ds_bairro, cd_municipio_ibge, sg_estado,
		nr_ddd_telefone, nr_ddi_telefone, nr_telefone,
		nr_telefone_celular, dt_admissao, cd_cbo,
		cd_matricula_est, nr_ctps, nr_serie_ctps,
		uf_emissora_ctps, nr_seq_plano, ie_processo,
		nr_seq_lote_inclusao, nr_seq_vinculo_estip, nr_seq_parentesco, dt_adocao,
		nr_seq_titular_contrato, ie_tipo_inclusao, nm_titular_inclusao,
		nr_seq_titular_prop, nr_seq_congenere, cd_operadora_congenere,
		nm_usuario_inclusao, ds_municipio, nr_seq_motivo_cancelamento,
		nr_seq_segurado, ds_observacao, ie_tipo_operacao,
		cd_declaracao_nasc_vivo, nr_cartao_nac_sus, nr_seq_vendedor_canal,
		nr_seq_vendedor_pf,cd_cartao_titular_imp, cd_matricula_familia,
		nr_pis_pasep, nr_titulo_eleitor, cd_tipo_logradouro,
		nm_pai, ds_municipio_nasc, sg_estado_nasc,
		dt_rescisao, nr_nivel_faixa_salarial, nr_seq_localizacao_benef,
		nr_seq_tabela, dt_contratacao, ie_status_mov, nr_seq_faixa_salarial,
		ds_municipio_nasc_estrangeiro,nr_seq_motivo_inclusao, nr_seq_codigo_externo,
		nr_seq_subestipulante, nr_ddd_celular, nm_social,
		nr_protocolo_portabilidade, dt_inclusao_ops_origem, vl_preco_plano_origem, 
		dt_emissao_prot_portab, nr_registro_ops_ans, ie_abrangencia_plano_origem, 
		nr_registro_plano_origem, ie_tp_contratacao_plano_origem, dt_inclusao_operadora,
		cd_municipio_ibge_nasc,dt_emissao_cert_casamento,nr_cert_casamento, nr_seq_intercambio,
		cd_usuario_plano, dt_reinclusao )
		values (  nr_seq_inclusao_w, rtrim(ltrim(nm_pessoa_fisica_w)), cd_estabelecimento_w,
		'P', clock_timestamp(), nr_seq_contrato_w,
		dt_nascimento_w, cd_nacionalidade_w, nm_mae_w,
		clock_timestamp(), nm_usuario_w, clock_timestamp(),
		nm_usuario_w,  nr_cpf_w, ie_estado_civil_w,
		ie_sexo_w, ds_email_w, nr_identidade_w,
		dt_emissao_ci_w,  sg_emissora_ci_w, nr_seq_pais_w,
		ds_orgao_emissor_ci_w, nr_reg_geral_estrang_w, cd_cep_w,
		ds_endereco_w, nr_endereco_w, ds_complemento_w,
		ds_bairro_w, cd_municipio_ibge_w, sg_estado_w,
		nr_ddd_telefone_w, nr_ddi_telefone_w, nr_telefone_w,
		nr_telefone_celular_w, dt_admissao_w, cd_cbo_w,
		cd_matricula_est_w, nr_ctps_w, nr_serie_ctps_w,
		uf_emissora_ctps_w, nr_seq_plano_w, 'W',
		nr_seq_lote_w, nr_seq_vinculo_estip_w,nr_seq_parentesco_w,dt_adocao_w,
		nr_seq_titular_cont_w, 'P', nm_titular_prop_w,
		nr_seq_titular_prop_w, nr_seq_congenere_w, cd_local_repasse_w,
		nm_usuario_w, ds_municipio_w, nr_seq_motivo_rescisao_w,
		nr_seq_segurado_w, ds_observacao_w, ie_tipo_operacao_w,
		cd_declaracao_nasc_vivo_w, nr_cartao_nac_sus_w, nr_seq_canal_venda_w,
		nr_seq_vendedor_pf_w,cd_carteira_titular_w, cd_matricula_familia_w,
		nr_pis_pasep_w, nr_titulo_eleitor_w, cd_tipo_logradouro_w,
		nm_pai_w, ds_municipio_nasc_w, sg_estado_nasc_w,
		dt_rescisao_w, nr_nivel_faixa_salarial_w, nr_seq_localizacao_benef_w,
		nr_seq_tabela_w, dt_contratacao_w, 1, nr_seq_faixa_salarial_w,
		ds_municipio_nasc_estrang_w, nr_seq_motivo_inclusao_w, nr_seq_codigo_externo_w,
		nr_seq_subestipulante_w, nr_ddd_celular_w,nm_social_w,
		nr_protocolo_portabilidade_w, dt_inclusao_ops_origem_w, vl_preco_plano_origem_w,
		dt_emissao_prot_portab_w, nr_registro_ops_ans_w, ie_abrangencia_plano_origem_w,
		nr_registro_plano_origem_w, ie_tp_contr_plano_origem_w, dt_inclusao_operadora_w,
		cd_municipio_ibge_nasc_w,dt_casamento_w,nr_cert_casamento_w, nr_seq_intercambio_w,
		CASE WHEN ie_tipo_operacao_w='I' THEN null  ELSE cd_usuario_plano_w END , dt_reinclusao_w);

	if (coalesce(ie_permite_sca_p,'N') = 'S') then
		CALL pls_atualizar_sca_inclusao_web( nr_seq_inclusao_w, nr_seq_contrato_w, ds_lista_sca_p, 
					'S', 'S',  nm_usuario_w);
	end if;

	if (coalesce(ie_tipo_operacao_w,'X') <> 'E') then
		pls_gerar_homonimo_pf(rtrim(ltrim(nm_pessoa_fisica_w)), dt_nascimento_w, nr_cpf_w, nr_seq_inclusao_w, nm_usuario_w);
	end if;

	select	count(1)
	into STRICT	qt_registros_w
	from	pls_inclusao_beneficiario
	where	nr_seq_lote_inclusao  = nr_seq_lote_w;

	if (qt_registros_w  = 1) then
		CALL pls_gerar_ci_solic_portal_web(  2, nr_seq_lote_w, null, null, null, null, nm_usuario_w);
	end if;
end if;

commit;

ds_erro_p := ds_erro_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_lote_imp_inclusao_benef ( nr_seq_lote_p text, nm_pessoa_fisica_p text, cd_estabelecimento_p text, nr_seq_contrato_p text, dt_nascimento_p text, cd_nacionalidade_p text, nm_mae_p text, nr_cpf_p text, ie_estado_civil_p text, ie_sexo_p text, ds_email_p text, nr_identidade_p text, dt_emissao_ci_p text, sg_emissora_ci_p text, nr_seq_pais_p text, ds_orgao_emissor_ci_p text, nr_reg_geral_estrang_p text, cd_cep_p text, ds_endereco_p text, nr_endereco_p text, ds_complemento_p text, ds_bairro_p text, cd_municipio_ibge_p text, sg_estado_p text, nr_ddd_telefone_p text, nr_ddi_telefone_p text, nr_telefone_p text, nr_ddd_celular_p text, nr_telefone_celular_p text, dt_admissao_p text, cd_cbo_p text, cd_matricula_est_p text, nr_ctps_p text, nr_serie_ctps_p text, uf_emissora_ctps_p text, nr_seq_plano_p text, nr_seq_proposta_p text, nr_seq_vinculo_estip_p text, nr_seq_parentesco_p text, dt_adocao_p text, nm_titular_prop_p text, cd_carteira_titular_p text, nr_seq_titular_cont_p text, nr_seq_titular_prop_p text, nr_seq_inclusao_p text, cd_local_repasse_p text, ie_tipo_operacao_p text, cd_usuario_plano_p text, ds_observacao_p text, nr_seq_motivo_rescisao_p text, nm_usuario_p text, cd_declaracao_nasc_vivo_p text, nr_cartao_nac_sus_p text, nr_seq_canal_venda_p text, cd_matricula_familia_p text, nr_pis_pasep_p text, nr_titulo_eleitor_p text, cd_tipo_logradouro_p text, nm_pai_p text, ds_municipio_nasc_p text, sg_estado_nasc_p text, dt_rescisao_p text, ds_lista_sca_p text, ie_permite_sca_p text, nr_seq_intercambio_p text, nr_nivel_faixa_salarial_p text, nr_seq_localizacao_benef_p text, nr_seq_tabela_p text, dt_contratacao_p text, nr_seq_motivo_inclusao_p text, nr_seq_codigo_externo_p text, nr_seq_subestipulante_p text, nr_linha_arq_p text default 0, ds_erro_p INOUT text DEFAULT NULL, nm_social_p text DEFAULT NULL, nr_protocolo_portabilidade_p text DEFAULT NULL, dt_inclusao_ops_origem_p text DEFAULT NULL, vl_preco_plano_origem_p text DEFAULT NULL, dt_emissao_prot_portab_p text DEFAULT NULL, nr_registro_ops_ans_p text DEFAULT NULL, ie_abrangencia_plano_origem_p text DEFAULT NULL, nr_registro_plano_origem_p text DEFAULT NULL, ie_tp_contr_plano_origem_p text DEFAULT NULL, dt_inclusao_operadora_p text DEFAULT NULL, dt_casamento_p text DEFAULT NULL, nr_cert_casamento_p text DEFAULT NULL, dt_reinclusao_p text DEFAULT NULL) FROM PUBLIC;

