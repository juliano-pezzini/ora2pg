-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_regra_copia_prescr ( nr_prescricao_p bigint, nr_prescricao_antiga bigint, nr_seq_regra_p bigint, cd_medico_p bigint, nr_seq_transcricao_p bigint, cd_perfil_p bigint, cd_estabelecimento_p bigint, nr_nova_prescricao_p INOUT bigint, nm_usuario_p text, cd_medic_posicionar_p INOUT bigint) AS $body$
DECLARE

 
			 
dt_prescricao_w			timestamp;
dt_primeiro_horario_w	varchar(5);
nr_atendimento_w		bigint;
nr_nova_prescricao_w	bigint;


BEGIN 
 
select	dt_prescricao, 
		substr(to_char(dt_primeiro_horario,'dd/mm/yyyy hh24:mi:ss'),12,5), 
		nr_atendimento 
into STRICT	dt_prescricao_w, 
		dt_primeiro_horario_w, 
		nr_atendimento_w 
from 	prescr_medica 
where 	nr_prescricao = nr_prescricao_antiga;
 
delete 	from prescr_medica 
where	nr_prescricao = nr_prescricao_p;
 
SELECT * FROM rep_copia_prescricao_regra(nr_prescricao_antiga, nr_atendimento_w, nr_seq_regra_p, nm_usuario_p, cd_medico_p, dt_prescricao_w, 'S', '', dt_primeiro_horario_w, null, cd_perfil_p, 0, '', '', '', dt_prescricao_w, null, nr_seq_transcricao_p, nr_nova_prescricao_w, 8030, cd_medic_posicionar_p) INTO STRICT nr_nova_prescricao_w, cd_medic_posicionar_p;
 
CALL gerar_dados_copia_rep(nr_prescricao_antiga, cd_perfil_p, cd_estabelecimento_p, nm_usuario_p);
 
nr_nova_prescricao_p := nr_nova_prescricao_w;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_regra_copia_prescr ( nr_prescricao_p bigint, nr_prescricao_antiga bigint, nr_seq_regra_p bigint, cd_medico_p bigint, nr_seq_transcricao_p bigint, cd_perfil_p bigint, cd_estabelecimento_p bigint, nr_nova_prescricao_p INOUT bigint, nm_usuario_p text, cd_medic_posicionar_p INOUT bigint) FROM PUBLIC;

