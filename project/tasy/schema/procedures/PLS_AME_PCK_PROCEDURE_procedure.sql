-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_ame_pck_procedure ( ie_opcao_p text, nr_seq_lote_rem_p pls_ame_lote_remessa.nr_sequencia%type, arquivos_mensalidade_p INOUT text, nm_procedure_p text, ds_linha_arquivo_p text, nr_seq_lote_retorno_p bigint, ie_origem_geracao_p text, nr_seq_segurado_p bigint, dt_rescisao_p timestamp, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE

/*
G - Gerar lote
D - Desfazer lote
C - Confirmar envio lote
A - Gerar arquivos
I - Importar arquivo
DI - Desfazer importação arquivo
GT - Gerar titulos lote
FI - Finaliza importação arquivo
AD  - Adicionar beneficiário liberação de débito
*/
BEGIN

CALL pls_ame_pck.set_nm_usuario(nm_usuario_p);
CALL pls_ame_pck.set_cd_estabelecimento(cd_estabelecimento_p);

if (ie_opcao_p = 'G') then
	CALL pls_ame_pck.inicia_processo_geracao_lote(nr_seq_lote_rem_p);
elsif (ie_opcao_p = 'D') then
	CALL pls_ame_pck.desfazer_lote_remessa(nr_seq_lote_rem_p);
elsif (ie_opcao_p = 'C') then
	CALL pls_ame_pck.confirmar_envio_lote_remessa(nr_seq_lote_rem_p);
elsif (ie_opcao_p = 'A') then
	arquivos_mensalidade_p := pls_ame_pck.gerar_arquivos_lote_remessa(nr_seq_lote_rem_p, ie_origem_geracao_p, arquivos_mensalidade_p);
elsif (ie_opcao_p = 'I') then
	CALL pls_ame_pck.importar_arquivo_retorno(nm_procedure_p, ds_linha_arquivo_p, nr_seq_lote_retorno_p);
elsif (ie_opcao_p = 'DI') then
	CALL pls_ame_pck.desfazer_importacao_arquivo(nr_seq_lote_retorno_p);
elsif (ie_opcao_p = 'GT') then
	CALL pls_ame_pck.gerar_titulos_lote(	nr_seq_lote_retorno_p);
elsif (ie_opcao_p = 'FI') then
	CALL pls_ame_pck.finaliza_importacao_arquivo(nr_seq_lote_retorno_p);
elsif (ie_opcao_p = 'AD') then
	CALL pls_ame_pck.adicionar_benef_lib_debito(nr_seq_lote_rem_p,nr_seq_segurado_p,dt_rescisao_p);
end if;

CALL pls_ame_pck.set_nm_usuario('');
CALL pls_ame_pck.set_cd_estabelecimento(null);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_ame_pck_procedure ( ie_opcao_p text, nr_seq_lote_rem_p pls_ame_lote_remessa.nr_sequencia%type, arquivos_mensalidade_p INOUT text, nm_procedure_p text, ds_linha_arquivo_p text, nr_seq_lote_retorno_p bigint, ie_origem_geracao_p text, nr_seq_segurado_p bigint, dt_rescisao_p timestamp, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

