-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE incluir_titulo_receber_cobr ( nr_seq_cobranca_p bigint, nr_titulo_p bigint, vl_cobranca_p bigint, cd_banco_p bigint, cd_agencia_bancaria_p text, nr_conta_p text, cd_moeda_p bigint, cd_estabelecimento_p bigint, ds_liquidacao_p text, vl_liquidacao_p bigint, ie_digito_conta_p text, cd_camara_compensacao_p bigint, vl_desconto_p bigint, vl_acrescimo_p bigint, cd_ocorrencia_p text, cd_instrucao_p text, qt_dias_instrucao_p bigint, nr_seq_ocorrencia_ret_p bigint, vl_despesa_bancaria_p bigint, nm_usuario_p text, ds_mascara_data_p text, tipo_carteira_tit_rec_p text) AS $body$
DECLARE

 
 
dt_liquidacao_w		timestamp;
ie_consiste_carteira_w	varchar(2);
ie_tipo_carteira_w		varchar(5);

 

BEGIN 
 
if (coalesce(ds_liquidacao_p,'X') = 'X') then 
	dt_liquidacao_w	:= null;
elsif (length(ds_liquidacao_p) = 6) then 
	if (coalesce(ds_mascara_data_p::text, '') = '') then 
    	dt_liquidacao_w := to_date(ds_liquidacao_p,'ddmmyy');
	else 
		dt_liquidacao_w := TO_DATE(ds_liquidacao_p,ds_mascara_data_p);
	end if;
elsif (length(ds_liquidacao_p) = 8) then 
	if (coalesce(ds_mascara_data_p::text, '') = '') then 
		dt_liquidacao_w := TO_DATE(ds_liquidacao_p,'ddmmyyyy');
    else 
		dt_liquidacao_w := TO_DATE(ds_liquidacao_p,ds_mascara_data_p);
	end if;
end if;
 
ie_tipo_carteira_w	:= obter_tipo_carteira_regra(nr_titulo_p);
ie_consiste_carteira_w := obter_param_usuario(815, 5, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, ie_consiste_carteira_w);
 
if (('S' = ie_consiste_carteira_w) and (tipo_carteira_tit_rec_p IS NOT NULL AND tipo_carteira_tit_rec_p::text <> '') and (ie_tipo_carteira_w = tipo_carteira_tit_rec_p) or ('N' = ie_consiste_carteira_w)) then 
 
	insert into titulo_receber_cobr( 	nr_seq_cobranca, 
						nr_titulo, 
						vl_cobranca, 
						dt_atualizacao, 
						nm_usuario, 
						cd_banco, 
						cd_agencia_bancaria, 
						nr_conta, 
						cd_moeda, 
						dt_liquidacao, 
						vl_liquidacao, 
						ie_digito_conta, 
						cd_camara_compensacao, 
						vl_desconto, 
						vl_acrescimo, 
						dt_atualizacao_nrec, 
						nm_usuario_nrec, 
						cd_ocorrencia, 
						cd_instrucao, 
						qt_dias_instrucao, 
						nr_seq_ocorrencia_ret, 
						nr_sequencia, 
						vl_despesa_bancaria) 
					values (nr_seq_cobranca_p, 
						nr_titulo_p, 
						vl_cobranca_p, 
						clock_timestamp(), 
						nm_usuario_p, 
						cd_banco_p, 
						cd_agencia_bancaria_p, 
						nr_conta_p, 
						cd_moeda_p, 
						obter_proximo_dia_util(cd_estabelecimento_p,dt_liquidacao_w), 
						vl_liquidacao_p, 
						ie_digito_conta_p, 
						cd_camara_compensacao_p, 
						vl_desconto_p, 
						vl_acrescimo_p, 
						clock_timestamp(), 
						nm_usuario_p, 
						cd_ocorrencia_p, 
						cd_instrucao_p, 
						qt_dias_instrucao_p, 
						nr_seq_ocorrencia_ret_p, 
						nextval('titulo_receber_cobr_seq'), 
						vl_despesa_bancaria_p);
 
	update	titulo_receber 
	set	ie_tipo_carteira	= ie_tipo_carteira_w 
	where	nr_titulo		= nr_titulo_p;
 
end if;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE incluir_titulo_receber_cobr ( nr_seq_cobranca_p bigint, nr_titulo_p bigint, vl_cobranca_p bigint, cd_banco_p bigint, cd_agencia_bancaria_p text, nr_conta_p text, cd_moeda_p bigint, cd_estabelecimento_p bigint, ds_liquidacao_p text, vl_liquidacao_p bigint, ie_digito_conta_p text, cd_camara_compensacao_p bigint, vl_desconto_p bigint, vl_acrescimo_p bigint, cd_ocorrencia_p text, cd_instrucao_p text, qt_dias_instrucao_p bigint, nr_seq_ocorrencia_ret_p bigint, vl_despesa_bancaria_p bigint, nm_usuario_p text, ds_mascara_data_p text, tipo_carteira_tit_rec_p text) FROM PUBLIC;

