-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE san_gerar_seq_arquivo_exp ( ie_integracao_p text, ie_gerar_seq_arquivo_p text, nr_seq_arquivo_p INOUT bigint, ds_erro_p INOUT text, nm_usuario_p text) AS $body$
DECLARE


nr_seq_integracao_w	san_seq_integracao.nr_sequencia%type;
nr_seq_arquivo_w	san_seq_integracao.nr_seq_arquivo%type;

BEGIN

if (coalesce(ie_integracao_p::text, '') = '') or (length(ie_integracao_p) <> 1) then
	ds_erro_p := WHEB_MENSAGEM_PCK.get_texto(392240);
else
	select	coalesce(max(nr_seq_arquivo), 0)
	into STRICT	nr_seq_arquivo_w
	from	san_seq_integracao
	where	ie_integracao = ie_integracao_p;

	if (ie_gerar_seq_arquivo_p IS NOT NULL AND ie_gerar_seq_arquivo_p::text <> '') and (ie_gerar_seq_arquivo_p = 'S') then

		nr_seq_arquivo_w := nr_seq_arquivo_w + 1;

		insert into san_seq_integracao(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			ie_integracao,
			nr_seq_arquivo
		) values (
			nextval('san_seq_integracao_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			ie_integracao_p,
			nr_seq_arquivo_w);
	end if;

	nr_seq_arquivo_p := nr_seq_arquivo_w;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE san_gerar_seq_arquivo_exp ( ie_integracao_p text, ie_gerar_seq_arquivo_p text, nr_seq_arquivo_p INOUT bigint, ds_erro_p INOUT text, nm_usuario_p text) FROM PUBLIC;

