-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_config_inconsist ( nr_sequencia_p bigint, dt_atualizacao_p timestamp, nm_usuario_p text, dt_atualizacao_nrec_p timestamp, nm_usuario_nrec_p text, nm_indice_p text, nm_tabela_p text, nm_integridade_referencial_p text, ie_acao_prioridade1_p text, ie_acao_prioridade2_p text, ie_acao_prioridade3_p text, ie_acao_prioridade4_p text, ie_acompanhamento_p text) AS $body$
DECLARE

					
qt_reg_w			bigint;

BEGIN

select	count(*)
into STRICT	qt_reg_w
from	TASY_CONFIG_INCONSISTENCIA
where	nr_sequencia = nr_sequencia_p;


if (qt_reg_w = 0) then
	
	select	count(*)
	into STRICT	qt_reg_w
	from (	SELECT	count(1)
				from	TASY_CONFIG_INCONSISTENCIA a
				where	a.nm_tabela				= nm_tabela_p
				and	(a.nm_integridade_referencial IS NOT NULL AND a.nm_integridade_referencial::text <> '')
				and	a.nm_integridade_referencial 		= nm_integridade_referencial_p
				
union

				SELECT	count(1)
				from	TASY_CONFIG_INCONSISTENCIA a
				where	a.nm_tabela				= nm_tabela_p
				and	(a.nm_indice IS NOT NULL AND a.nm_indice::text <> '')
				and	a.nm_indice 				= nm_indice_p
			) alias6;
		
end if;


if (qt_reg_w	= 0) then
	insert into tasy_config_inconsistencia(	nr_sequencia,
						dt_atualizacao,
						nm_usuario,
						dt_atualizacao_nrec,
						nm_usuario_nrec,
						nm_indice,
						nm_tabela,
						nm_integridade_referencial,
						ie_acao_prioridade1,
						ie_acao_prioridade2,
						ie_acao_prioridade3,
						ie_acao_prioridade4,
						ie_acompanhamento)
				values (	nr_sequencia_p,
						dt_atualizacao_p,
						nm_usuario_p,
						dt_atualizacao_nrec_p,
						nm_usuario_nrec_p,
						nm_indice_p,
						nm_tabela_p,
						nm_integridade_referencial_p,
						ie_acao_prioridade1_p,
						ie_acao_prioridade2_p,
						ie_acao_prioridade3_p,
						ie_acao_prioridade4_p,
						ie_acompanhamento_p);
else

	update	tasy_config_inconsistencia
	set	dt_atualizacao 			= dt_atualizacao_p,
		nm_usuario 			= nm_usuario_p,
		dt_atualizacao_nrec 		= dt_atualizacao_nrec_p,
		nm_usuario_nrec			= nm_usuario_nrec_p,
		nm_indice			= nm_indice_p,
		nm_tabela			= nm_tabela_p,
		nm_integridade_referencial	= nm_integridade_referencial_p,
		ie_acao_prioridade1		= ie_acao_prioridade1_p,
		ie_acao_prioridade2		= ie_acao_prioridade2_p,
		ie_acao_prioridade3		= ie_acao_prioridade3_p,
		ie_acao_prioridade4		= ie_acao_prioridade4_p,
		ie_acompanhamento		= ie_acompanhamento_p
	where	nr_sequencia			= nr_sequencia_p;


end if;
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_config_inconsist ( nr_sequencia_p bigint, dt_atualizacao_p timestamp, nm_usuario_p text, dt_atualizacao_nrec_p timestamp, nm_usuario_nrec_p text, nm_indice_p text, nm_tabela_p text, nm_integridade_referencial_p text, ie_acao_prioridade1_p text, ie_acao_prioridade2_p text, ie_acao_prioridade3_p text, ie_acao_prioridade4_p text, ie_acompanhamento_p text) FROM PUBLIC;

