-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_req_terceiro () AS $body$
BEGIN

CALL Exec_sql_Dinamico('Dropa tabela', ' drop table W_ELTON_TERCEIRO ');

CALL Exec_sql_Dinamico('Cria tabela', ' create table W_ELTON_TERCEIRO as (
	select	a.nr_requisicao Requisicao, substr(obter_nome_terceiro(nr_seq_terceiro),1,35) Terceiro,
	d.nr_sequencia Item, d.cd_material CodMat, substr(obter_desc_material(d.cd_material),1,40) Material,
	d.qt_material_requisitada QtReq, d.qt_material_atendida QtAtend
	from 	Operacao_estoque c,
		centro_custo b,
		item_requisicao_material d,
		requisicao_material a
	where	a.cd_centro_custo 		= b.cd_centro_custo
	and	a.cd_operacao_estoque	= c.cd_operacao_estoque
	and     b.nr_seq_terceiro is not null
	and	a.nr_requisicao = d.nr_requisicao
	and	d.cd_motivo_baixa = 1
	and	dt_solicitacao_requisicao >= sysdate - 360
	and	not exists
		(select 1
		from 	terceiro_operacao x
		where 	x.nr_seq_terceiro 	= b.nr_seq_terceiro
		and 	x.nr_doc		= d.nr_requisicao
		and 	x.nr_seq_doc		= d.nr_sequencia)) ');


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_req_terceiro () FROM PUBLIC;

