-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_ajuste_localizador_html (nr_seq_schematic_p bigint, nm_usuario_p text) AS $body$
DECLARE


nr_seq_visao_w bigint;
nr_seq_dic_objeto_w  bigint;

C01 CURSOR FOR
	SELECT 	ie_tipo_componente,
				nr_seq_dic_objeto,
				nr_seq_visao
	from  	objeto_schematic
	where 	ie_tipo_componente in ('WDBP', 'WF','WDF')
	and	  	nr_seq_funcao_schematic = nr_seq_schematic_p;

C02 CURSOR FOR
	SELECT nr_seq_localizador
	from   tabela_visao_atributo
	where  (nr_seq_localizador IS NOT NULL AND nr_seq_localizador::text <> '')
	and	 nr_sequencia = nr_seq_visao_w;


C03 CURSOR FOR
	SELECT nr_seq_localizador
	from   dic_objeto_filtro
	where  (nr_seq_localizador IS NOT NULL AND nr_seq_localizador::text <> '')
	and	 nr_seq_objeto = nr_seq_dic_objeto_w;

c01_w	c01%rowtype;
c02_w	c02%rowtype;
c03_w	c03%rowtype;


BEGIN

open C01;
loop
fetch C01 into
	c01_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin

	if (c01_w.ie_tipo_componente = 'WDBP') then
		nr_seq_visao_w := c01_w.nr_seq_visao;
		open C02;
		loop
		fetch C02 into
			c02_w;
		EXIT WHEN NOT FOUND; /* apply on C02 */
			begin
			CALL ajustar_localizador_html(c02_w.nr_seq_localizador,nm_usuario_p);
			end;
		end loop;
		close C02;
	end if;

	if (c01_w.ie_tipo_componente in ('WF','WDF')) then
		nr_seq_dic_objeto_w	:= c01_w.nr_seq_dic_objeto;
		open C03;
		loop
		fetch C03 into
			c03_w;
		EXIT WHEN NOT FOUND; /* apply on C03 */
			begin
			CALL ajustar_localizador_html(c03_w.nr_seq_localizador,nm_usuario_p);
			end;
		end loop;
		close C03;
	end if;

	end;
end loop;
close C01;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_ajuste_localizador_html (nr_seq_schematic_p bigint, nm_usuario_p text) FROM PUBLIC;

