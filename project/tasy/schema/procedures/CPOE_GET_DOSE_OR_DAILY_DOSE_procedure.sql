-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cpoe_get_dose_or_daily_dose ( ie_via_aplicacao_p text, cd_intervalo_p text, qt_dose_p INOUT bigint, qt_dose_dia_p INOUT bigint) AS $body$
DECLARE


  ie_formato_aplicacao_w  via_aplicacao.ie_formato_administracao%type := null;
  qt_operacao_w           intervalo_prescricao.qt_operacao%type := null;
  qt_dose_calc_w          cpoe_material.qt_dose%type := null;
  qt_dose_dia_calc_w      cpoe_material.qt_dose_dia%type := null;

BEGIN
  select  max(ie_formato_administracao)
  into STRICT    ie_formato_aplicacao_w
  from    via_aplicacao
  where   ie_via_aplicacao = ie_via_aplicacao_p;

  qt_operacao_w := OBTER_OCORRENCIA_INTERVALO(cd_intervalo_p, 24, 'O');

  if ((ie_formato_aplicacao_w IS NOT NULL AND ie_formato_aplicacao_w::text <> '') and qt_operacao_w > 0) then  
    if ((qt_dose_p IS NOT NULL AND qt_dose_p::text <> '') and coalesce(qt_dose_dia_p::text, '') = '') then
      qt_dose_dia_calc_w := qt_dose_p * qt_operacao_w;
    end if;
    if (coalesce(qt_dose_p::text, '') = '' and (qt_dose_dia_p IS NOT NULL AND qt_dose_dia_p::text <> '')) then
      qt_dose_calc_w := qt_dose_dia_p / qt_operacao_w;
    end if;
  end if;

  qt_dose_p := qt_dose_calc_w;
  qt_dose_dia_p := qt_dose_dia_calc_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_get_dose_or_daily_dose ( ie_via_aplicacao_p text, cd_intervalo_p text, qt_dose_p INOUT bigint, qt_dose_dia_p INOUT bigint) FROM PUBLIC;

