-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE san_transfusao_ae_js ( nr_atendimento_p bigint, nm_usuario_p text, cd_convenio_p INOUT bigint, cd_unidade_externa_p INOUT text, nr_sequencia_p INOUT bigint ) AS $body$
BEGIN

select  max(cd_convenio)
into STRICT	cd_convenio_p
from 	atend_categoria_convenio
where   nr_atendimento  = nr_atendimento_p;

select	max(cd_unidade_externa)
into STRICT	cd_unidade_externa_p
from	atend_paciente_unidade
where	nr_atendimento = nr_atendimento_p;

select	coalesce(max(a.nr_sequencia),0)
into STRICT	nr_sequencia_p
from  	san_entidade a
where	a.cd_Setor_atendimento = (	SELECT 	max(b.cd_setor_atendimento)
					from	 atend_paciente_unidade b
					where	 b.nr_seq_interno = (	select	max(c.nr_seq_interno)
									from		atend_paciente_unidade c
									where		c.nr_atendimento = nr_atendimento_p));
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE san_transfusao_ae_js ( nr_atendimento_p bigint, nm_usuario_p text, cd_convenio_p INOUT bigint, cd_unidade_externa_p INOUT text, nr_sequencia_p INOUT bigint ) FROM PUBLIC;

