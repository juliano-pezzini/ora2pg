-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_tiss_situacao_prot_guia (NR_SEQUENCIA_p bigint, NM_USUARIO_p text, NR_SEQ_SITUACAO_PROT_p bigint, DT_EMISSAO_GUIA_p timestamp, NR_INTERNO_CONTA_p text, CD_AUTORIZACAO_p text, NR_SEQ_PROT_RECEB_p bigint, VL_PROCESSADO_p bigint, VL_LIBERADO_p bigint, VL_GLOSA_p bigint, NR_SEQ_PROTOC_PARAM_p bigint default null) AS $body$
DECLARE


nr_interno_conta_w bigint;


BEGIN
begin
if (NR_SEQ_PROTOC_PARAM_p IS NOT NULL AND NR_SEQ_PROTOC_PARAM_p::text <> '') then
	select 	coalesce(tiss_obter_conta_guia_prest(NR_SEQ_PROTOC_PARAM_p,Somente_numero(NR_INTERNO_CONTA_p),CD_AUTORIZACAO_p),somente_numero(NR_INTERNO_CONTA_p))
	into STRICT	nr_interno_conta_w
	;
else
	nr_interno_conta_w	:= Somente_numero(NR_INTERNO_CONTA_p);
end if;	
exception
when others then
	nr_interno_conta_w := null;
end;

insert into TISS_SITUACAO_PROT_GUIA(NR_SEQUENCIA,
	DT_ATUALIZACAO,
	NM_USUARIO,
	DT_ATUALIZACAO_NREC,
	NM_USUARIO_NREC,
	NR_SEQ_SITUACAO_PROT,
	DT_EMISSAO_GUIA,
	NR_INTERNO_CONTA,
	CD_AUTORIZACAO,
	NR_SEQ_PROT_RECEB,
	VL_PROCESSADO,
	VL_LIBERADO,
	VL_GLOSA)
values (NR_SEQUENCIA_p,
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	NR_SEQ_SITUACAO_PROT_p,
	DT_EMISSAO_GUIA_p,
	nr_interno_conta_w,
	CD_AUTORIZACAO_p,
	NR_SEQ_PROT_RECEB_p,
	VL_PROCESSADO_p,
	VL_LIBERADO_p,
	VL_GLOSA_p);
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_tiss_situacao_prot_guia (NR_SEQUENCIA_p bigint, NM_USUARIO_p text, NR_SEQ_SITUACAO_PROT_p bigint, DT_EMISSAO_GUIA_p timestamp, NR_INTERNO_CONTA_p text, CD_AUTORIZACAO_p text, NR_SEQ_PROT_RECEB_p bigint, VL_PROCESSADO_p bigint, VL_LIBERADO_p bigint, VL_GLOSA_p bigint, NR_SEQ_PROTOC_PARAM_p bigint default null) FROM PUBLIC;

