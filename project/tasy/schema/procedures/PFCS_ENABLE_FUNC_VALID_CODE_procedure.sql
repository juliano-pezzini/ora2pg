-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pfcs_enable_func_valid_code ( cd_validation_code_p text, cd_cgc_client_p text, NM_USUARIO_P text ) AS $body$
DECLARE


cd_funcao_w bigint;
cd_funcao_pfcs_w bigint;


BEGIN

cd_funcao_w := GET_IF_ACTIVATION_KEY_VALID(cd_validation_code_p, cd_cgc_client_p);

select 	MAX(cd_funcao) into STRICT cd_funcao_pfcs_w
from PFCS_OFFICIAL_USE where cd_funcao = cd_funcao_w;

if (cd_funcao_pfcs_w IS NOT NULL AND cd_funcao_pfcs_w::text <> '') then
 CALL Wheb_mensagem_pck.exibir_mensagem_abort(1155537);
else

    select 	MAX(cd_funcao) into STRICT cd_funcao_pfcs_w
    from 	 funcao
    where 	 NR_SEQ_MODULO = 1606 and cd_funcao = cd_funcao_w;

    if (cd_funcao_pfcs_w IS NOT NULL AND cd_funcao_pfcs_w::text <> '') then
        INSERT INTO PFCS_OFFICIAL_USE(NR_SEQUENCIA, DT_ATUALIZACAO, NM_USUARIO, DT_ATUALIZACAO_NREC, NM_USUARIO_NREC, CD_FUNCAO, DS_VALIDATION_CODE) 
        VALUES (
        nextval('pfcs_official_use_seq'), 
        clock_timestamp(), 
        NM_USUARIO_P, 
        clock_timestamp(), 
        NM_USUARIO_P, 
        cd_funcao_w, 
        cd_validation_code_p
        );
    else
        CALL Wheb_mensagem_pck.exibir_mensagem_abort(1155455);
    end if;

end if;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pfcs_enable_func_valid_code ( cd_validation_code_p text, cd_cgc_client_p text, NM_USUARIO_P text ) FROM PUBLIC;

