-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ajustar_qtde_mat_atend_pac ( nr_atendimento_p bigint, nr_interno_conta_p bigint, cd_material_p bigint, dt_atendimento_p timestamp, dt_acerto_conta_p timestamp, cd_unidade_medida_p text, qt_material_p bigint, qt_executada_p bigint, cd_setor_atendimento_p bigint, qt_devolvida_p bigint, qt_estoque_p bigint, cd_kit_material_p bigint, cd_acao_p text, vl_unitario_p bigint, vl_material_p bigint, ie_valor_informado_p text, nm_usuario_p text) AS $body$
DECLARE


nr_sequencia_w			bigint;
dt_entrada_unidade_w		timestamp;
nr_seq_cor_exec_w		bigint	:= 369;
nr_seq_interno_w		bigint;


BEGIN

select  max(a.dt_entrada_unidade),
	max(a.nr_seq_interno)
into STRICT	dt_entrada_unidade_w,
	nr_seq_interno_w
from	tipo_acomodacao b,
	setor_atendimento c,
	atend_paciente_unidade a
where	a.cd_tipo_acomodacao	= b.cd_tipo_acomodacao
and	a.cd_setor_atendimento  = c.cd_setor_atendimento
and	nr_atendimento		= nr_atendimento_p
and	a.cd_setor_atendimento  = cd_setor_atendimento_p;

select	nextval('material_atend_paciente_seq')
into STRICT	nr_sequencia_w
;

insert into material_atend_paciente(	nr_sequencia,
					cd_material,
					dt_atendimento,
					dt_acerto_conta,
					dt_conta,
					nr_seq_atepacu,
					cd_setor_atendimento,
					dt_entrada_unidade,
					qt_material,
					qt_executada,
					dt_atualizacao,
					nm_usuario,
					nr_atendimento,
					nr_seq_cor_exec,
					cd_unidade_medida,
					qt_devolvida,
					qt_estoque,
					cd_kit_material,
					cd_acao,
					vl_unitario,
					vl_material,
					ie_valor_informado,
					nr_interno_conta)
			values (	nr_sequencia_w,
					cd_material_p,
					dt_atendimento_p,
					dt_acerto_conta_p,
					dt_atendimento_p,
					nr_seq_interno_w,
					cd_setor_atendimento_p,
					dt_entrada_unidade_w,
					qt_material_p,
					qt_executada_p,
					clock_timestamp(),
					nm_usuario_p,
					nr_atendimento_p,
					nr_seq_cor_exec_w,
					cd_unidade_medida_p,
					qt_devolvida_p,
					CASE WHEN qt_estoque_p=0.0 THEN  null  ELSE qt_estoque_p END ,
					CASE WHEN cd_kit_material_p=0 THEN  null  ELSE cd_kit_material_p END ,
					coalesce(cd_acao_p,'1'),
					coalesce(vl_unitario_p, 0),
					coalesce(vl_material_p, 0),
					coalesce(ie_valor_informado_p,'N'),
					nr_interno_conta_p);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ajustar_qtde_mat_atend_pac ( nr_atendimento_p bigint, nr_interno_conta_p bigint, cd_material_p bigint, dt_atendimento_p timestamp, dt_acerto_conta_p timestamp, cd_unidade_medida_p text, qt_material_p bigint, qt_executada_p bigint, cd_setor_atendimento_p bigint, qt_devolvida_p bigint, qt_estoque_p bigint, cd_kit_material_p bigint, cd_acao_p text, vl_unitario_p bigint, vl_material_p bigint, ie_valor_informado_p text, nm_usuario_p text) FROM PUBLIC;

