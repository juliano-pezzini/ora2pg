-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_alter_cep_varchar2 () AS $body$
DECLARE



/*
tabelas a alterar:		campo:

cep_loc:			cd_cep
cep_log:			cd_cep
cep_localidade:			cd_localidade
cep_logradouro:			cd_logradouro
*/
qt_total_w			bigint;
qt_menor_w			bigint;
qt_novo_w			bigint;
qt_existe_w			integer;
ds_retorno_w			varchar(255);




BEGIN

select	count(*)
into STRICT	qt_existe_w
from	user_tab_columns
where	table_name	= 'CEP_LOC'
AND	COLUMN_NAME	= 'CD_CEP2';

if (qt_existe_w = 0) then

	/*Criar campo temporário na tabela*/

	ds_retorno_w := Executar_SQL_Dinamico(' alter table cep_loc add (CD_CEP2 VARCHAR2(08))', ds_retorno_w);

	/*Setar os dados para o campo temporário*/

	ds_retorno_w := Executar_SQL_Dinamico(' update	cep_loc set cd_cep2 = cd_cep ', ds_retorno_w);

	/*Dropar campo number para criá-lo varchar2*/

	ds_retorno_w := Executar_SQL_Dinamico(' alter table cep_loc drop column cd_cep', ds_retorno_w);

	ds_retorno_w := Executar_SQL_Dinamico(' alter table cep_loc add (CD_CEP VARCHAR2(08))', ds_retorno_w);

	/*Ajustar ceps para 8 digitos, com zeros à esquerda*/

	ds_retorno_w := Executar_SQL_Dinamico(' update	cep_loc set cd_cep = lpad(cd_cep2,8,0) ', ds_retorno_w);

	/* Verifica se existe o indice CEPLOC_I1 */

	select	count(*)
	into STRICT	qt_existe_w
	from	user_indexes
	where	index_name = 'CEPLOC_I1';

	if (qt_existe_w = 0) then
		ds_retorno_w := Executar_SQL_Dinamico(' Create Index CEPLOC_I1 on CEP_LOC(CD_CEP) ', ds_retorno_w);
	end if;

	/* Verifica se existe o indice CEPLOC_I2 */

	select	count(*)
	into STRICT	qt_existe_w
	from	user_indexes
	where	index_name = 'CEPLOC_I2';

	if (qt_existe_w = 0) then
		ds_retorno_w := Executar_SQL_Dinamico(' Create Index CEPLOC_I2 on CEP_LOC(DS_UF) ', ds_retorno_w);
	end if;

	CALL valida_objetos_sistema();

end if;

/**************/

select	count(*)
into STRICT	qt_existe_w
from	user_tab_columns
where	table_name	= 'CEP_LOG'
aND	COLUMN_NAME	= 'CD_CEP2';

if (qt_existe_w = 0) then

	/*Criar campo temporário na tabela*/

	ds_retorno_w := Executar_SQL_Dinamico(' alter table cep_log add (CD_CEP2 VARCHAR2(08))', ds_retorno_w);

	/*Setar os dados para o campo temporário*/

	ds_retorno_w := Executar_SQL_Dinamico(' update	cep_log set cd_cep2 = cd_cep ', ds_retorno_w);

	/*Dropar campo number para criá-lo varchar2*/

	ds_retorno_w := Executar_SQL_Dinamico(' alter table cep_log drop column cd_cep', ds_retorno_w);

	ds_retorno_w := Executar_SQL_Dinamico(' alter table cep_log add (CD_CEP VARCHAR2(08))', ds_retorno_w);

	/*Ajustar ceps para 8 digitos, com zeros à esquerda*/

	ds_retorno_w := Executar_SQL_Dinamico(' update	cep_log set cd_cep = lpad(cd_cep2,8,0) ', ds_retorno_w);

	/* Verifica se existe o indice CEPLOG_I1 */

	select	count(*)
	into STRICT	qt_existe_w
	from	user_indexes
	where	index_name = 'CEPLOG_I1';

	if (qt_existe_w = 0) then
		ds_retorno_w := Executar_SQL_Dinamico(' Create Index CEPLOG_I1 on CEP_LOG(NR_SEQ_LOC) ', ds_retorno_w);
	end if;

	/* Verifica se existe o indice CEPLOG_I2 */

	select	count(*)
	into STRICT	qt_existe_w
	from	user_indexes
	where	index_name = 'CEPLOG_I2';

	if (qt_existe_w = 0) then
		ds_retorno_w := Executar_SQL_Dinamico(' Create Index CEPLOG_I2 on CEP_LOG(DS_UF) ', ds_retorno_w);
	end if;

	/* Verifica se existe o indice CEPLOG_I3 */

	select	count(*)
	into STRICT	qt_existe_w
	from	user_indexes
	where	index_name = 'CEPLOG_I3';

	if (qt_existe_w = 0) then
		ds_retorno_w := Executar_SQL_Dinamico(' Create Index CEPLOG_I3 on CEP_LOG(CD_CEP) ', ds_retorno_w);
	end if;

	/* Verifica se existe o indice CEPLOG_I4 */

	select	count(*)
	into STRICT	qt_existe_w
	from	user_indexes
	where	index_name = 'CEPLOG_I4';

	if (qt_existe_w = 0) then
		ds_retorno_w := Executar_SQL_Dinamico(' Create Index CEPLOG_I4 on CEP_LOG(NR_SEQ_LOC,CD_CEP) ', ds_retorno_w);
	end if;

	CALL valida_objetos_sistema();
end if;

/**************/

select	count(*)
into STRICT	qt_existe_w
from	user_tab_columns
where	table_name	= 'CEP_LOCALIDADE'
AND	COLUMN_NAME	= 'CD_CEP2';

if (qt_existe_w = 0) then

	/*Criar campo temporário na tabela*/

	ds_retorno_w := Executar_SQL_Dinamico(' alter table cep_localidade add (CD_CEP2 VARCHAR2(08))', ds_retorno_w);

	/*Setar os dados para o campo temporário*/

	ds_retorno_w := Executar_SQL_Dinamico(' update	cep_localidade set cd_cep2 = cd_localidade ', ds_retorno_w);

	/*Dropar campo number para criá-lo varchar2*/

	ds_retorno_w := Executar_SQL_Dinamico(' alter table cep_localidade drop column cd_localidade', ds_retorno_w);

	ds_retorno_w := Executar_SQL_Dinamico(' alter table cep_localidade add (CD_LOCALIDADE VARCHAR2(08))', ds_retorno_w);

	/*Ajustar ceps para 8 digitos, com zeros à esquerda*/

	ds_retorno_w := Executar_SQL_Dinamico(' update	cep_localidade set cd_localidade = lpad(cd_cep2,8,0) ', ds_retorno_w);

	/* Verifica se existe o indice CEPLOCA_CODIGO_I */

	select	count(*)
	into STRICT	qt_existe_w
	from	user_indexes
	where	index_name = 'CEPLOCA_CODIGO_I';

	if (qt_existe_w = 0) then
		ds_retorno_w := Executar_SQL_Dinamico(' Create Index CEPLOCA_CODIGO_I on CEP_LOCALIDADE(CD_LOCALIDADE) ', ds_retorno_w);
	end if;

	/* Verifica se existe o indice CEPLOCA_NOME_I */

	select	count(*)
	into STRICT	qt_existe_w
	from	user_indexes
	where	index_name = 'CEPLOCA_NOME_I';

	if (qt_existe_w = 0) then
		ds_retorno_w := Executar_SQL_Dinamico(' Create Index CEPLOCA_NOME_I on CEP_LOCALIDADE(NM_LOCALIDADE) ', ds_retorno_w);
	end if;

	/* Verifica se existe o indice CEP_LOC_I2 */

	select	count(*)
	into STRICT	qt_existe_w
	from	user_indexes
	where	index_name = 'CEP_LOC_I2';

	if (qt_existe_w = 0) then
		ds_retorno_w := Executar_SQL_Dinamico(' Create Index CEP_LOC_I2 on CEP_LOCALIDADE(CD_UNIDADE_FEDERACAO) ', ds_retorno_w);
	end if;

	CALL valida_objetos_sistema();
end if;


/**************/

select	count(*)
into STRICT	qt_existe_w
from	user_tab_columns
where	table_name	= 'CEP_LOGRADOURO'
AND	COLUMN_NAME	= 'CD_CEP2';

if (qt_existe_w = 0) then

	/*Criar campo temporário na tabela*/

	ds_retorno_w := Executar_SQL_Dinamico(' alter table cep_logradouro add (CD_CEP2 VARCHAR2(08))', ds_retorno_w);

	/*Setar os dados para o campo temporário*/

	ds_retorno_w := Executar_SQL_Dinamico(' update	cep_logradouro set cd_cep2 = cd_logradouro ', ds_retorno_w);

	/*Dropar campo number para criá-lo varchar2*/

	ds_retorno_w := Executar_SQL_Dinamico(' alter table cep_logradouro drop column cd_logradouro', ds_retorno_w);

	ds_retorno_w := Executar_SQL_Dinamico(' alter table cep_logradouro add (CD_LOGRADOURO VARCHAR2(08))', ds_retorno_w);

	/*Ajustar ceps para 8 digitos, com zeros à esquerda*/

	ds_retorno_w := Executar_SQL_Dinamico(' update	cep_logradouro set cd_logradouro = lpad(cd_cep2,8,0) ', ds_retorno_w);

	/* Verifica se existe o indice CEPLOGR_CODIGO_I */

	select	count(*)
	into STRICT	qt_existe_w
	from	user_indexes
	where	index_name = 'CEPLOGR_CODIGO_I';

	if (qt_existe_w = 0) then
		ds_retorno_w := Executar_SQL_Dinamico(' Create Index CEPLOGR_CODIGO_I on CEP_LOGRADOURO(CD_LOGRADOURO) ', ds_retorno_w);
	end if;

	/* Verifica se existe o indice CEPLOGR_NOME_I */

	select	count(*)
	into STRICT	qt_existe_w
	from	user_indexes
	where	index_name = 'CEPLOGR_NOME_I';

	if (qt_existe_w = 0) then
		ds_retorno_w := Executar_SQL_Dinamico(' Create Index CEPLOGR_NOME_I on CEP_LOGRADOURO(NM_LOGRADOURO) ', ds_retorno_w);
	end if;

	/* Verifica se existe o indice CEP_LOG_I2 */

	select	count(*)
	into STRICT	qt_existe_w
	from	user_indexes
	where	index_name = 'CEP_LOG_I2';

	if (qt_existe_w = 0) then
		ds_retorno_w := Executar_SQL_Dinamico(' Create Index CEP_LOG_I2 on CEP_LOGRADOURO(CD_UNIDADE_FEDERACAO) ', ds_retorno_w);
	end if;

	CALL valida_objetos_sistema();
end if;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_alter_cep_varchar2 () FROM PUBLIC;

