-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_atualizar_objetos (nr_seq_log_p bigint, ie_opcao_p text, qt_dia_p bigint, nm_usuario_p text) AS $body$
DECLARE


ds_comando_w	varchar(2000);
nm_objeto_w		varchar(50);
cursor_w		integer;
qt_registro_w  	bigint;

BEGIN

if (ie_opcao_p = 'C01') then

	ds_comando_w := ' select	nm_objeto ' ||
			' from		aplicacao_tasy b, ' ||
			'		tasy_versao.objeto_sistema a ' ||
			' where   	a.ds_aplicacao = b.cd_aplicacao_tasy ' ||
			' and		a.nm_objeto in (' || 	chr(39) || 'TASY_SINCRONIZAR_BASE'  || chr(39) ||',' ||
								chr(39) || 'GERAR_OBJETO_APLICACAO' || chr(39) || ')' ||
			' and		a.dt_atualizacao > b.dt_atualizacao';

elsif (ie_opcao_p = 'C02') then
	ds_comando_w := ' select	nm_objeto ' ||
			' from		tasy_versao.objeto_sistema' ||
			' where		ie_tipo_objeto not in (' || 	chr(39) || obter_desc_expressao(298066)/*'Script'*/ 	|| chr(39) || ',' ||
									chr(39) || 'Job' 	|| chr(39) || ',' ||
									chr(39) || 'Baca' 	|| chr(39) || ')' ||
			' and		dt_atualizacao > sysdate - '|| qt_dia_p ||
			' and		Gerar_Objeto_Aplicacao(ds_aplicacao) = ' || chr(39) || 'S' || chr(39) ||
			' order by	obter_ordem_Objeto(ie_tipo_objeto) ';

elsif (ie_opcao_p = 'C03') then
	ds_comando_w := ' select	b.nm_objeto ' ||
			' from		objetos_invalidos_v b, '||
			' 		tasy_versao.objeto_sistema a ' ||
			' where		a.nm_objeto = b.nm_objeto ' ||
			' order by	obter_ordem_Objeto(a.ie_tipo_objeto)';
end	if;

cursor_w := DBMS_SQL.OPEN_CURSOR;
DBMS_SQL.PARSE(cursor_w, ds_comando_w, dbms_sql.native);
DBMS_SQL.DEFINE_COLUMN(cursor_w, 1, nm_objeto_w,50);
qt_registro_w := DBMS_SQL.EXECUTE(cursor_w);

while( DBMS_SQL.FETCH_ROWS(cursor_w) > 0 ) loop
	DBMS_SQL.COLUMN_VALUE(cursor_w, 1, nm_objeto_w);
	insert	into Atualizar_Objeto(
		nr_sequencia,
		nr_seq_log,
		nm_objeto,
		dt_inicio,
		dt_fim,
		dt_atualizacao,
		nm_usuario)
	values (
		nextval('atualizar_objeto_seq'),
		nr_seq_log_p,
		nm_objeto_w,
		null,
		null,
		clock_timestamp(),
		nm_usuario_p);

end loop;
DBMS_SQL.CLOSE_CURSOR(cursor_w);

commit;

end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_atualizar_objetos (nr_seq_log_p bigint, ie_opcao_p text, qt_dia_p bigint, nm_usuario_p text) FROM PUBLIC;

