-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_obter_tit_rec_mens_ops ( nr_titulo_p bigint, nr_seq_tit_mens_p bigint, ds_mesano_comp_p timestamp, dt_mensagem_p timestamp, ie_opcao_p text, ie_fator_moderador_p text, ds_mensagem_p INOUT text) AS $body$
BEGIN
if (ie_opcao_p = '1') then
	if (ie_fator_moderador_p = 'S') then
		begin
		select  ' ' || rpad(coalesce(substr(nm_beneficiario,1,42),' '),42,' ')  ||
			rpad(to_char(to_date(dt_mensagem),'dd/mm/yyyy'),12,' ') ||
			rpad(coalesce(substr(ds_servico,1,48),' '),51,' ') ||
			lpad(campo_mascara_virgula(coalesce(vl_fator_moderador,vl_mensagem)),14,' ')
		into STRICT	ds_mensagem_p
		from	titulo_receber_mens_ops
		where	nr_sequencia		= nr_seq_tit_mens_p
		and	nr_titulo		= nr_titulo_p
		and	ie_fator_moderador	= 'S'
		order by dt_mensagem;
		exception
		when others then
			ds_mensagem_p := null;
		end;

	elsif (ie_fator_moderador_p = 'N') then
		begin
		select  coalesce(rpad(' '||substr(nm_beneficiario,1,32),33,' '),lpad(' ',33,' ')) ||
			rpad(to_char(to_date(dt_mensagem),'dd/mm/yyyy'),15,' ') ||
--			rpad(nvl(substr(ds_servico,1,39),' '),40,' ') ||
			rpad(coalesce(substr(ds_servico,1,31),' '),32,' ') ||
--			lpad(' ',5,' ') ||
			lpad(' ',12,' ') ||
--			nvl(rpad(substr(ds_prestador,1,30),31,' '),lpad(' ',31,' '))
			coalesce(rpad(substr(ds_prestador,1,29),31,' '),lpad(' ',31,' '))
		into STRICT	ds_mensagem_p
		from	titulo_receber_mens_ops
		where	nr_sequencia			= nr_seq_tit_mens_p
		and	nr_titulo			= nr_titulo_p
		and	coalesce(ie_fator_moderador,'N') 	= 'N'
		order by dt_mensagem;
		exception
		when others then
			ds_mensagem_p := null;
		end;
	end if;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_obter_tit_rec_mens_ops ( nr_titulo_p bigint, nr_seq_tit_mens_p bigint, ds_mesano_comp_p timestamp, dt_mensagem_p timestamp, ie_opcao_p text, ie_fator_moderador_p text, ds_mensagem_p INOUT text) FROM PUBLIC;

