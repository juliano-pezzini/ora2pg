-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_titulos_vipe ( nm_usuario_p text, nr_seq_regra_ordem_p bigint) AS $body$
DECLARE


cont_w			bigint;
cont_regra_w		bigint;
nr_seq_wadep_w		bigint;


BEGIN

/*Jejum*/

select	count(*)
into STRICT	cont_w
from	w_vipe_t
where	ie_tipo_item = 'J';

select	count(*)
into STRICT	cont_regra_w
from	REGRA_ORDEM_GRUPO_REP
where	nr_seq_regra	= nr_seq_regra_ordem_p
and	ie_grupo	= 'J';

if (cont_w = 0) and (cont_regra_w > 0) then
	select	nextval('w_vipe_t_seq')
	into STRICT	nr_seq_wadep_w
	;

	insert into w_vipe_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item)
	values (nr_seq_wadep_w,
		nm_usuario_p,
		'J');
end if;

/*Suplemento*/

select	count(*)
into STRICT	cont_w
from	w_vipe_t
where	ie_tipo_item = 'S';

select	count(*)
into STRICT	cont_regra_w
from	REGRA_ORDEM_GRUPO_REP
where	nr_seq_regra	= nr_seq_regra_ordem_p
and	ie_grupo	= 'S';

if (cont_w = 0) and (cont_regra_w > 0) then
	select	nextval('w_vipe_t_seq')
	into STRICT	nr_seq_wadep_w
	;

	insert into w_vipe_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item)
	values (nr_seq_wadep_w,
		nm_usuario_p,
		'S');
end if;

/*SNE*/

select	count(*)
into STRICT	cont_w
from	w_vipe_t
where	ie_tipo_item = 'SNE';

select	count(*)
into STRICT	cont_regra_w
from	REGRA_ORDEM_GRUPO_REP
where	nr_seq_regra	= nr_seq_regra_ordem_p
and	ie_grupo	= 'SNE';

if (cont_w = 0) and (cont_regra_w > 0) then
	select	nextval('w_vipe_t_seq')
	into STRICT	nr_seq_wadep_w
	;

	insert into w_vipe_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item)
	values (nr_seq_wadep_w,
		nm_usuario_p,
		'SNE');
end if;

/*Dieta*/

select	count(*)
into STRICT	cont_w
from	w_vipe_t
where	ie_tipo_item = 'D';

select	count(*)
into STRICT	cont_regra_w
from	REGRA_ORDEM_GRUPO_REP
where	nr_seq_regra	= nr_seq_regra_ordem_p
and	ie_grupo	= 'D';

if (cont_w = 0) and (cont_regra_w > 0) then
	select	nextval('w_vipe_t_seq')
	into STRICT	nr_seq_wadep_w
	;

	insert into w_vipe_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item)
	values (nr_seq_wadep_w,
		nm_usuario_p,
		'D');
end if;

/*NPT adulta*/

select	count(*)
into STRICT	cont_w
from	w_vipe_t
where	ie_tipo_item = 'NAN';

select	count(*)
into STRICT	cont_regra_w
from	REGRA_ORDEM_GRUPO_REP
where	nr_seq_regra	= nr_seq_regra_ordem_p
and	ie_grupo	= 'NAN';

if (cont_w = 0) and (cont_regra_w > 0) then
	select	nextval('w_vipe_t_seq')
	into STRICT	nr_seq_wadep_w
	;

	insert into w_vipe_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item)
	values (nr_seq_wadep_w,
		nm_usuario_p,
		'NAN');
end if;

/*Soluções*/

select	count(*)
into STRICT	cont_w
from	w_vipe_t
where	ie_tipo_item = 'SOL';

select	count(*)
into STRICT	cont_regra_w
from	REGRA_ORDEM_GRUPO_REP
where	nr_seq_regra	= nr_seq_regra_ordem_p
and	ie_grupo	= 'SOL';

if (cont_w = 0) and (cont_regra_w > 0) then
	select	nextval('w_vipe_t_seq')
	into STRICT	nr_seq_wadep_w
	;

	insert into w_vipe_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item)
	values (nr_seq_wadep_w,
		nm_usuario_p,
		'SOL');
end if;

/*Medicamentos*/

select	count(*)
into STRICT	cont_w
from	w_vipe_t
where	ie_tipo_item = 'M';

select	count(*)
into STRICT	cont_regra_w
from	REGRA_ORDEM_GRUPO_REP
where	nr_seq_regra	= nr_seq_regra_ordem_p
and	ie_grupo	= 'M';

if (cont_w = 0) and (cont_regra_w > 0) then
	select	nextval('w_vipe_t_seq')
	into STRICT	nr_seq_wadep_w
	;

	insert into w_vipe_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item)
	values (nr_seq_wadep_w,
		nm_usuario_p,
		'M');
end if;

/*Contorle de glicemia*/

select	count(*)
into STRICT	cont_w
from	w_vipe_t
where	ie_tipo_item = 'G';

select	count(*)
into STRICT	cont_regra_w
from	REGRA_ORDEM_GRUPO_REP
where	nr_seq_regra	= nr_seq_regra_ordem_p
and	ie_grupo	= 'G';

if (cont_w = 0) and (cont_regra_w > 0) then
	select	nextval('w_vipe_t_seq')
	into STRICT	nr_seq_wadep_w
	;

	insert into w_vipe_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item)
	values (nr_seq_wadep_w,
		nm_usuario_p,
		'G');
end if;

/*Assoc ao Contorle de glicemia*/

select	count(*)
into STRICT	cont_w
from	w_vipe_t
where	ie_tipo_item = 'IAG';

select	count(*)
into STRICT	cont_regra_w
from	REGRA_ORDEM_GRUPO_REP
where	nr_seq_regra	= nr_seq_regra_ordem_p
and	ie_grupo	= 'IAG';

if (cont_w = 0) and (cont_regra_w > 0) then
	select	nextval('w_vipe_t_seq')
	into STRICT	nr_seq_wadep_w
	;

	insert into w_vipe_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item)
	values (nr_seq_wadep_w,
		nm_usuario_p,
		'IAG');
end if;

/*Hemoterapias*/

select	count(*)
into STRICT	cont_w
from	w_vipe_t
where	ie_tipo_item = 'HM';

select	count(*)
into STRICT	cont_regra_w
from	REGRA_ORDEM_GRUPO_REP
where	nr_seq_regra	= nr_seq_regra_ordem_p
and	ie_grupo	= 'HM';

if (cont_w = 0) and (cont_regra_w > 0) then
	select	nextval('w_vipe_t_seq')
	into STRICT	nr_seq_wadep_w
	;

	insert into w_vipe_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item)
	values (nr_seq_wadep_w,
		nm_usuario_p,
		'HM');
end if;

/*Recomendações*/

select	count(*)
into STRICT	cont_w
from	w_vipe_t
where	ie_tipo_item = 'R';

select	count(*)
into STRICT	cont_regra_w
from	REGRA_ORDEM_GRUPO_REP
where	nr_seq_regra	= nr_seq_regra_ordem_p
and	ie_grupo	= 'R';

if (cont_w = 0) and (cont_regra_w > 0) then
	select	nextval('w_vipe_t_seq')
	into STRICT	nr_seq_wadep_w
	;

	insert into w_vipe_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item)
	values (nr_seq_wadep_w,
		nm_usuario_p,
		'R');
end if;

/*Procedimentos*/

select	count(*)
into STRICT	cont_w
from	w_vipe_t
where	ie_tipo_item = 'P';

select	count(*)
into STRICT	cont_regra_w
from	REGRA_ORDEM_GRUPO_REP
where	nr_seq_regra	= nr_seq_regra_ordem_p
and	ie_grupo	= 'P';

if (cont_w = 0) and (cont_regra_w > 0) then
	select	nextval('w_vipe_t_seq')
	into STRICT	nr_seq_wadep_w
	;

	insert into w_vipe_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item,
		ie_classif_adep)
	values (nr_seq_wadep_w,
		nm_usuario_p,
		'P',
		'P');
end if;

/*Gasoterapia*/

select	count(*)
into STRICT	cont_w
from	w_vipe_t
where	ie_tipo_item = 'O';

select	count(*)
into STRICT	cont_regra_w
from	REGRA_ORDEM_GRUPO_REP
where	nr_seq_regra	= nr_seq_regra_ordem_p
and	ie_grupo	= 'O';

if (cont_w = 0) and (cont_regra_w > 0) then
	select	nextval('w_vipe_t_seq')
	into STRICT	nr_seq_wadep_w
	;

	insert into w_vipe_t(nr_sequencia,
		nm_usuario,
		ie_tipo_item)
	values (nr_seq_wadep_w,
		nm_usuario_p,
		'O');
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_titulos_vipe ( nm_usuario_p text, nr_seq_regra_ordem_p bigint) FROM PUBLIC;

