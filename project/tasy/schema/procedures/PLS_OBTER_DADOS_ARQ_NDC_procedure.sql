-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_obter_dados_arq_ndc (nr_seq_nota_deb_p bigint, cd_banco_p INOUT text, cd_agencia_bancaria_p INOUT text, nr_nosso_numero_p INOUT text, ds_uso_banco_p INOUT text, cd_carteira_p INOUT text, ds_especie_p INOUT text, vl_titulo_p INOUT bigint, dt_documento_p INOUT timestamp, ds_especie_doc_p INOUT text, ds_aceite_p INOUT text, dt_processo_p INOUT timestamp, ds_local_pagto_p INOUT text, ds_obs_local_pagto_p INOUT text, ds_instrucao_p INOUT text, ds_observacao_p INOUT text, nr_linha_digitavel_p INOUT text, cd_barras_p INOUT text, tp_boleto_p INOUT text) AS $body$
DECLARE


/*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: Obter os dados para a geração do arquivo de nota de débito A560, com as tabelas PTU
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[X]  Objetos do dicionário [  ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/nr_seq_nota_deb_bol_w	bigint;


BEGIN
-- BOLETO
begin
select	x.nr_banco,
	x.agencia_cd_cedente,
	x.nosso_numero,
	x.uso_banco,
	x.ds_carteira,
	x.especie,
	x.vlr_documento,
	x.dt_documento,
	x.especie_doc,
	x.aceite,
	x.dt_proces,
	coalesce(trim(both x.local_pagto),'SEM INFORMACAO'),
	coalesce(trim(both x.obs_local_pagto),'SEM INFORMACAO'),
	x.nr_sequencia,
	x.tp_boleto
into STRICT	cd_banco_p,
	cd_agencia_bancaria_p,
	nr_nosso_numero_p,
	ds_uso_banco_p,
	cd_carteira_p,
	ds_especie_p,
	vl_titulo_p,
	dt_documento_p,
	ds_especie_doc_p,
	ds_aceite_p,
	dt_processo_p,
	ds_local_pagto_p,
	ds_obs_local_pagto_p,
	nr_seq_nota_deb_bol_w,
	tp_boleto_p
from	ptu_nota_deb_bol	x
where	x.nr_seq_nota_debito	= nr_seq_nota_deb_p;
exception
when others then
	cd_banco_p := ' ';
	cd_agencia_bancaria_p := ' ';
	nr_nosso_numero_p := ' ';
	ds_uso_banco_p := ' ';
	cd_carteira_p := ' ';
	ds_especie_p := ' ';
	vl_titulo_p := 0;
	dt_documento_p := null;
	ds_especie_doc_p := ' ';
	ds_aceite_p := ' ';
	dt_processo_p := null;
	ds_local_pagto_p := 'SEM INFORMACAO';
	ds_obs_local_pagto_p := 'SEM INFORMACAO';
	nr_seq_nota_deb_bol_w := null;
	tp_boleto_p := '1';
end;

-- INSTRUÇÕES
begin
select	coalesce(trim(both ds_instrucao),'SEM INFORMACAO')
into STRICT	ds_instrucao_p
from	ptu_nota_deb_bol_inst
where	nr_seq_nota_deb_bol	= nr_seq_nota_deb_bol_w;
exception
when others then
	ds_instrucao_p := 'SEM INFORMACAO';
end;

-- OBSERVAÇÕES
begin
select	coalesce(trim(both ds_observacao),'SEM INFORMACAO')
into STRICT	ds_observacao_p
from	ptu_nota_deb_bol_obs
where	nr_seq_nota_deb_bol	= nr_seq_nota_deb_bol_w;
exception
when others then
	ds_observacao_p := 'SEM INFORMACAO';
end;

-- LINHA DIGITAVEL
begin
select	linha_digitavel,
	cd_barras
into STRICT	nr_linha_digitavel_p,
	cd_barras_p
from	ptu_nota_deb_bol_ld
where	nr_seq_nota_deb_bol	= nr_seq_nota_deb_bol_w;
exception
when others then
	nr_linha_digitavel_p := ' ';
	cd_barras_p := ' ';
end;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_obter_dados_arq_ndc (nr_seq_nota_deb_p bigint, cd_banco_p INOUT text, cd_agencia_bancaria_p INOUT text, nr_nosso_numero_p INOUT text, ds_uso_banco_p INOUT text, cd_carteira_p INOUT text, ds_especie_p INOUT text, vl_titulo_p INOUT bigint, dt_documento_p INOUT timestamp, ds_especie_doc_p INOUT text, ds_aceite_p INOUT text, dt_processo_p INOUT timestamp, ds_local_pagto_p INOUT text, ds_obs_local_pagto_p INOUT text, ds_instrucao_p INOUT text, ds_observacao_p INOUT text, nr_linha_digitavel_p INOUT text, cd_barras_p INOUT text, tp_boleto_p INOUT text) FROM PUBLIC;

