-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consulta_paciente_restric_sql (IE_RESTRICAO_STATUS_P INOUT text, IE_RESTRICAO_ESTAB_P INOUT text, IE_EXECUTADO_P text DEFAULT NULL, IE_CANCELADAS_P text DEFAULT NULL) AS $body$
DECLARE

  i RECORD;

BEGIN
   ie_restricao_estab_p := ' AND nvl(a.cd_estabelecimento, -1) IN ( ';
   FOR i IN (SELECT x.cd_estabelecimento FROM usuario_estabelecimento_v x WHERE x.nm_usuario_param = obter_usuario_ativo) LOOP
      ie_restricao_estab_p := ie_restricao_estab_p || i.cd_estabelecimento || ',';
   END LOOP;
   ie_restricao_estab_p  := ie_restricao_estab_p || ' -1)';
   ie_restricao_status_p := ' and a.ie_status_agenda in( ';
   FOR i IN (SELECT vl_dominio
               FROM valor_dominio_v
              WHERE cd_dominio = 83
                AND vl_dominio NOT IN ('L', 'B', 'R', 'LF', 'PA', coalesce(ie_executado_p, 'X'), coalesce(ie_canceladas_p,'X'))) LOOP
      ie_restricao_status_p := ie_restricao_status_p || '''' || i.vl_dominio || '''' || ',';
   END LOOP;

   ie_restricao_status_p := ie_restricao_status_p || '''' || '__'')';

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consulta_paciente_restric_sql (IE_RESTRICAO_STATUS_P INOUT text, IE_RESTRICAO_ESTAB_P INOUT text, IE_EXECUTADO_P text DEFAULT NULL, IE_CANCELADAS_P text DEFAULT NULL) FROM PUBLIC;

