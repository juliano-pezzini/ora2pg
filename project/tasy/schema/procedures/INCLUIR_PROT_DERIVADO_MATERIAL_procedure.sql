-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE incluir_prot_derivado_material (cd_protocolo_dest_p bigint , nr_seq_destino_p bigint , cd_material_p text , nr_agrupamento_p bigint DEFAULT NULL, ie_agrupador_p bigint DEFAULT 2 /*Material*/
, qt_dose_p bigint  DEFAULT NULL, ds_dose_diferenciada_p text DEFAULT NULL, ie_via_aplicacao_p text DEFAULT NULL, cd_unidade_medida_p text DEFAULT NULL, ds_horarios_p text DEFAULT NULL, ie_checar_adep_p text DEFAULT NULL, cd_intervalo_p text DEFAULT NULL, hr_prim_horario_p text DEFAULT NULL, ie_aplic_bolus_p text DEFAULT 'N', ie_aplic_lenta_p text DEFAULT 'N', dt_atualizacao_p timestamp DEFAULT clock_timestamp(), ie_urgencia_p text DEFAULT 'N', ie_intervalo_fixo_p text DEFAULT 'N', ie_multiplicar_dose_p text DEFAULT 'N', ie_bomba_infusao_p text DEFAULT 'N', nr_seq_proc_p bigint DEFAULT NULL, nr_seq_solucao_p bigint DEFAULT NULL, nr_seq_diluicao_p bigint DEFAULT NULL, qt_hora_aplicacao_p bigint DEFAULT NULL, qt_minuto_aplicacao_p bigint DEFAULT NULL, nr_seq_gas_p bigint DEFAULT NULL, ie_continuo_p cpoe_dieta.ie_continuo%type DEFAULT NULL) AS $body$
DECLARE

  nm_usuario_w      varchar(255);
  nr_agrupamento_w  protocolo_medic_material.nr_agrupamento%TYPE;
  nr_seq_material_w protocolo_medic_material.nr_seq_material%TYPE;

BEGIN
    nm_usuario_w := wheb_usuario_pck.get_nm_usuario;

    nr_agrupamento_w := nr_agrupamento_p;

    SELECT Obter_seq_mat_prot_medic_mat(cd_protocolo_dest_p, nr_seq_destino_p)
           , coalesce(nr_agrupamento_w, Obter_agrup_prot_medic_mat(cd_protocolo_dest_p, nr_seq_destino_p, 0))
    INTO STRICT   nr_seq_material_w, nr_agrupamento_w
;

    begin

    INSERT INTO protocolo_medic_material(cd_protocolo
                 , nr_sequencia
                 , nr_seq_material
                 , cd_material
                 , qt_dose
                 , ds_dose_diferenciada
                 , ie_via_aplicacao
                 , cd_unidade_medida
                 , ds_horarios
                 , ie_checar_adep
                 , cd_intervalo
                 , hr_prim_horario
                 , ie_urgencia
                 , nr_agrupamento
                 , ie_agrupador
                 , ie_aplic_bolus
                 , ie_aplic_lenta
                 , dt_atualizacao
                 , ie_intervalo_fixo
                 , ie_multiplicar_dose
                 , ie_bomba_infusao
                 , nm_usuario
                 , nr_seq_proc
                 , nr_seq_solucao
                 , nr_seq_diluicao
                 , qt_hora_aplicacao
                 , qt_minuto_aplicacao
                 , nr_seq_gas
		 , ie_continuo)
    VALUES (cd_protocolo_dest_p
                 , nr_seq_destino_p
                 , nr_seq_material_w
                 , cd_material_p
                 , qt_dose_p
                 , ds_dose_diferenciada_p
                 , ie_via_aplicacao_p
                 , cd_unidade_medida_p
                 , ds_horarios_p
                 , ie_checar_adep_p
                 , cd_intervalo_p
                 , hr_prim_horario_p
                 , coalesce(ie_urgencia_p, 'N')
                 , nr_agrupamento_w
                 , ie_agrupador_p
                 , coalesce(ie_aplic_bolus_p, 'N')
                 , coalesce(ie_aplic_lenta_p, 'N')
                 , coalesce(dt_atualizacao_p, clock_timestamp())
                 , coalesce(ie_intervalo_fixo_p, 'N')
                 , coalesce(ie_multiplicar_dose_p, 'N')
                 , coalesce(ie_bomba_infusao_p, 'N')
                 , nm_usuario_w
                 , nr_seq_proc_p
                 , nr_seq_solucao_p
                 , nr_seq_diluicao_p
                 , qt_hora_aplicacao_p
                 , qt_minuto_aplicacao_p
                 , nr_seq_gas_p
		 , ie_continuo_p);

	exception
	when unique_violation then
		null;
	end;

    COMMIT;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE incluir_prot_derivado_material (cd_protocolo_dest_p bigint , nr_seq_destino_p bigint , cd_material_p text , nr_agrupamento_p bigint DEFAULT NULL, ie_agrupador_p bigint DEFAULT 2  , qt_dose_p bigint  DEFAULT NULL, ds_dose_diferenciada_p text DEFAULT NULL, ie_via_aplicacao_p text DEFAULT NULL, cd_unidade_medida_p text DEFAULT NULL, ds_horarios_p text DEFAULT NULL, ie_checar_adep_p text DEFAULT NULL, cd_intervalo_p text DEFAULT NULL, hr_prim_horario_p text DEFAULT NULL, ie_aplic_bolus_p text DEFAULT 'N', ie_aplic_lenta_p text DEFAULT 'N', dt_atualizacao_p timestamp DEFAULT clock_timestamp(), ie_urgencia_p text DEFAULT 'N', ie_intervalo_fixo_p text DEFAULT 'N', ie_multiplicar_dose_p text DEFAULT 'N', ie_bomba_infusao_p text DEFAULT 'N', nr_seq_proc_p bigint DEFAULT NULL, nr_seq_solucao_p bigint DEFAULT NULL, nr_seq_diluicao_p bigint DEFAULT NULL, qt_hora_aplicacao_p bigint DEFAULT NULL, qt_minuto_aplicacao_p bigint DEFAULT NULL, nr_seq_gas_p bigint DEFAULT NULL, ie_continuo_p cpoe_dieta.ie_continuo%type DEFAULT NULL) FROM PUBLIC;

