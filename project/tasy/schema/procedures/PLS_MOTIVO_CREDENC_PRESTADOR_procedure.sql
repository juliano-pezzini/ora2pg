-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_motivo_credenc_prestador ( nr_seq_prestador_p pls_prestador.nr_sequencia%type, nr_seq_motivo_p pls_prestador_situacao.nr_seq_motivo%type, ie_alteracao_p text, ds_observacao_p pls_prestador_situacao.ds_observacao%type, ie_nivel_exclusao_ptu_p pls_prestador_excl_subst.ie_nivel_exclusao_ptu%type, cd_exclusao_rede_p pls_prestador_excl_subst.cd_exclusao_rede%type, cd_exclusao_pla_prod_p pls_prestador_excl_subst.cd_exclusao_pla_prod%type, dt_termino_prest_p pls_prestador_excl_subst.dt_termino_prest%type, nr_seq_prestador_subst_p pls_prestador_excl_subst.nr_seq_prestador_subst%type, dt_inicio_prest_p pls_prestador_excl_subst.dt_inicio_prest%type, nr_seq_motivo_exclusao_p pls_prestador_excl_subst.nr_seq_motivo_exclusao%type, ie_exibe_portal_p pls_prestador_excl_subst.ie_exibe_portal%type, nr_seq_motivo_subst_p pls_prestador_excl_subst.nr_seq_motivo_subst%type, nr_oficio_p pls_prestador_excl_subst.nr_oficio%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
BEGIN

if (nr_seq_prestador_p IS NOT NULL AND nr_seq_prestador_p::text <> '') and (ie_alteracao_p IS NOT NULL AND ie_alteracao_p::text <> '') then
	insert into pls_prestador_situacao(nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_prestador,
		dt_alteracao,
		ie_alteracao,
		nr_seq_motivo,
		ds_observacao)
	values (nextval('pls_prestador_situacao_seq'),
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		nr_seq_prestador_p,
		clock_timestamp(),
		ie_alteracao_p,
		nr_seq_motivo_p,
		ds_observacao_p);
		
	if (ie_alteracao_p = 'D') and
		((ie_nivel_exclusao_ptu_p IS NOT NULL AND ie_nivel_exclusao_ptu_p::text <> '') or (cd_exclusao_rede_p IS NOT NULL AND cd_exclusao_rede_p::text <> '') or (cd_exclusao_pla_prod_p IS NOT NULL AND cd_exclusao_pla_prod_p::text <> '') or (dt_termino_prest_p IS NOT NULL AND dt_termino_prest_p::text <> '') or (nr_seq_prestador_subst_p IS NOT NULL AND nr_seq_prestador_subst_p::text <> '') or (dt_inicio_prest_p IS NOT NULL AND dt_inicio_prest_p::text <> '') or (nr_seq_motivo_exclusao_p IS NOT NULL AND nr_seq_motivo_exclusao_p::text <> '')) then
		
		insert into pls_prestador_excl_subst(dt_atualizacao_nrec,
			nm_usuario_nrec,
			cd_exclusao_pla_prod,
			cd_exclusao_rede,
			dt_inicio_prest,
			dt_termino_prest,
			ie_nivel_exclusao_ptu,
			nr_seq_prestador,
			nr_seq_prestador_subst,
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			nr_seq_motivo_exclusao,
			ie_exibe_portal,
			nr_seq_motivo_subst,
			nr_oficio)
		values (clock_timestamp(),
			nm_usuario_p,
			cd_exclusao_pla_prod_p,
			cd_exclusao_rede_p,
			dt_inicio_prest_p,
			dt_termino_prest_p,
			ie_nivel_exclusao_ptu_p,
			nr_seq_prestador_p,
			nr_seq_prestador_subst_p,
			nextval('pls_prestador_excl_subst_seq'),
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_motivo_exclusao_p,
			coalesce(ie_exibe_portal_p,'S'),
			nr_seq_motivo_subst_p,
			nr_oficio_p);
	end if;
	
	commit;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_motivo_credenc_prestador ( nr_seq_prestador_p pls_prestador.nr_sequencia%type, nr_seq_motivo_p pls_prestador_situacao.nr_seq_motivo%type, ie_alteracao_p text, ds_observacao_p pls_prestador_situacao.ds_observacao%type, ie_nivel_exclusao_ptu_p pls_prestador_excl_subst.ie_nivel_exclusao_ptu%type, cd_exclusao_rede_p pls_prestador_excl_subst.cd_exclusao_rede%type, cd_exclusao_pla_prod_p pls_prestador_excl_subst.cd_exclusao_pla_prod%type, dt_termino_prest_p pls_prestador_excl_subst.dt_termino_prest%type, nr_seq_prestador_subst_p pls_prestador_excl_subst.nr_seq_prestador_subst%type, dt_inicio_prest_p pls_prestador_excl_subst.dt_inicio_prest%type, nr_seq_motivo_exclusao_p pls_prestador_excl_subst.nr_seq_motivo_exclusao%type, ie_exibe_portal_p pls_prestador_excl_subst.ie_exibe_portal%type, nr_seq_motivo_subst_p pls_prestador_excl_subst.nr_seq_motivo_subst%type, nr_oficio_p pls_prestador_excl_subst.nr_oficio%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;

