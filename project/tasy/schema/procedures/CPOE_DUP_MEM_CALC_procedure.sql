-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cpoe_dup_mem_calc ( nr_seq_mat_cpoe_p cpoe_calc_memoria_usada.nr_seq_mat_cpoe%type, /* new sequence */
 IE_PESO_P cpoe_calc_memoria_usada.IE_PESO%type, QT_PESO_P cpoe_calc_memoria_usada.QT_PESO%type, QT_ALTURA_P cpoe_calc_memoria_usada.QT_ALTURA%type, QT_SC_P cpoe_calc_memoria_usada.QT_SC%type, QT_IMC_P cpoe_calc_memoria_usada.QT_IMC%type, CD_MATERIAL_P cpoe_calc_memoria_usada.CD_MATERIAL%type, QT_DOSE_P cpoe_calc_memoria_usada.QT_DOSE%type, CD_UNIDADE_MEDIDA_P cpoe_calc_memoria_usada.CD_UNIDADE_MEDIDA%type, CD_MAT_DIL_P cpoe_calc_memoria_usada.CD_MAT_DIL%type, QT_DOSE_DIL_P cpoe_calc_memoria_usada.QT_DOSE_DIL%type, CD_UNID_MED_DOSE_DIL_P cpoe_calc_memoria_usada.CD_UNID_MED_DOSE_DIL%type, QT_CONCENTRACAO_FINAL_P cpoe_calc_memoria_usada.QT_CONCENTRACAO_FINAL%type, QT_FATOR_P cpoe_calc_memoria_usada.QT_FATOR%type, QT_DOSE_TOTAL_FIXO_P cpoe_calc_memoria_usada.QT_DOSE_TOTAL_FIXO%type, IE_VOLUME_FIXO_P cpoe_calc_memoria_usada.IE_VOLUME_FIXO%type, QT_DOSE_TERAPEUTICA_P cpoe_calc_memoria_usada.QT_DOSE_TERAPEUTICA%type, CD_UNID_MED_DOSE_TERAPEUTICA_P cpoe_calc_memoria_usada.CD_UNID_MED_DOSE_TERAPEUTICA%type, QT_DOSAGEM_P cpoe_calc_memoria_usada.QT_DOSAGEM%type, IE_TIPO_DOSAGEM_P cpoe_calc_memoria_usada.IE_TIPO_DOSAGEM%type, QT_DOSE_TERAP_MIN_P cpoe_calc_memoria_usada.QT_DOSE_TERAP_MIN%type, CD_UNID_MED_TERAP_MIN_P cpoe_calc_memoria_usada.CD_UNID_MED_TERAP_MIN%type, QT_VEL_INF_TERAP_MIN_P cpoe_calc_memoria_usada.QT_VEL_INF_TERAP_MIN%type, IE_TIPO_DOSAGEM_MIN_P cpoe_calc_memoria_usada.IE_TIPO_DOSAGEM_MIN%type, QT_DOSE_TERAP_MAX_P cpoe_calc_memoria_usada.QT_DOSE_TERAP_MAX%type, CD_UNID_MED_TERAP_MAX_P cpoe_calc_memoria_usada.CD_UNID_MED_TERAP_MAX%type, QT_VEL_INF_TERAP_MAX_P cpoe_calc_memoria_usada.QT_VEL_INF_TERAP_MAX%type, IE_TIPO_DOSAGEM_MAX_P cpoe_calc_memoria_usada.IE_TIPO_DOSAGEM_MAX%type, IE_BOMBA_INFUSAO_P cpoe_calc_memoria_usada.IE_BOMBA_INFUSAO%type, QT_VOL_DISPOSITIVO_P cpoe_calc_memoria_usada.QT_VOL_DISPOSITIVO%type, IE_FATOR_CORRECAO_P cpoe_calc_memoria_usada.IE_FATOR_CORRECAO%type, QT_PERIODO_P cpoe_calc_memoria_usada.QT_PERIODO%type, QT_DOSE_MEDICAMENTO_P cpoe_calc_memoria_usada.QT_DOSE_MEDICAMENTO%type, QT_DOSE_SOL_P cpoe_calc_memoria_usada.QT_DOSE_SOL%type, QT_VOLUME_TOTAL_P cpoe_calc_memoria_usada.QT_VOLUME_TOTAL%type, QT_CORRIGIDO_MEDIC_P cpoe_calc_memoria_usada.QT_CORRIGIDO_MEDIC%type, QT_CORRIGIDO_DIL_P cpoe_calc_memoria_usada.QT_CORRIGIDO_DIL%type, QT_TOTAL_CORRIGIDO_P cpoe_calc_memoria_usada.QT_TOTAL_CORRIGIDO%type, QT_DOSE_CONVERT_P cpoe_calc_memoria_usada.QT_DOSE_CONVERT%type, QT_DOSE_DIL_CONVERT_P cpoe_calc_memoria_usada.QT_DOSE_DIL_CONVERT%type ) AS $body$
DECLARE


nr_seq_cpoe_anterior_w cpoe_material.nr_seq_cpoe_anterior%type;
ie_duplicar_w varchar(1) := 'N';

c01 CURSOR FOR
    SELECT *
    from cpoe_calc_memoria_usada
    where nr_seq_mat_cpoe = nr_seq_cpoe_anterior_w;

c01_w cpoe_calc_memoria_usada%rowtype;


BEGIN

    if (nr_seq_mat_cpoe_p > 0) then

        select coalesce(nr_seq_cpoe_anterior, 0)
        into STRICT nr_seq_cpoe_anterior_w
        from cpoe_material
        where nr_sequencia = nr_seq_mat_cpoe_p;

        open c01;
            fetch c01 into c01_w;
                if (
                    coalesce(c01_w.IE_PESO, 0) = coalesce(IE_PESO_P, 0) and
                    coalesce(c01_w.QT_PESO, 0) = coalesce(QT_PESO_P, 0) and
                    coalesce(c01_w.QT_ALTURA, 0) = coalesce(QT_ALTURA_P, 0) and
                    coalesce(c01_w.QT_SC, 0) = coalesce(QT_SC_P, 0) and
                    coalesce(c01_w.QT_IMC, 0) = coalesce(QT_IMC_P, 0) and
                    coalesce(c01_w.CD_MATERIAL, 0) = coalesce(CD_MATERIAL_P, 0) and
                    coalesce(c01_w.QT_DOSE, 0) = coalesce(QT_DOSE_P, 0) and
                    coalesce(c01_w.CD_UNIDADE_MEDIDA, 0) = coalesce(CD_UNIDADE_MEDIDA_P, 0) and
                    coalesce(c01_w.CD_MAT_DIL, 0) = coalesce(CD_MAT_DIL_P, 0) and
                    coalesce(c01_w.QT_DOSE_DIL, 0) = coalesce(QT_DOSE_DIL_P, 0) and
                    coalesce(c01_w.CD_UNID_MED_DOSE_DIL, 0) = coalesce(CD_UNID_MED_DOSE_DIL_P, 0) and
                    coalesce(c01_w.QT_CONCENTRACAO_FINAL, 0) = coalesce(QT_CONCENTRACAO_FINAL_P, 0) and
                    coalesce(c01_w.QT_FATOR, 0) = coalesce(QT_FATOR_P, 0) and
                    coalesce(c01_w.QT_DOSE_TOTAL_FIXO, 0) = coalesce(QT_DOSE_TOTAL_FIXO_P, 0) and
                    coalesce(c01_w.IE_VOLUME_FIXO, 0) = coalesce(IE_VOLUME_FIXO_P, 0) and
                    coalesce(c01_w.QT_DOSE_TERAPEUTICA, 0) = coalesce(QT_DOSE_TERAPEUTICA_P, 0) and
                    coalesce(c01_w.CD_UNID_MED_DOSE_TERAPEUTICA, 0) = coalesce(CD_UNID_MED_DOSE_TERAPEUTICA_P, 0) and
                    coalesce(c01_w.QT_DOSAGEM, 0) = coalesce(QT_DOSAGEM_P, 0) and
                    coalesce(c01_w.IE_TIPO_DOSAGEM, 0) = coalesce(IE_TIPO_DOSAGEM_P, 0) and
                    coalesce(c01_w.QT_DOSE_TERAP_MIN, 0) = coalesce(QT_DOSE_TERAP_MIN_P, 0) and
                    coalesce(c01_w.CD_UNID_MED_TERAP_MIN, 0) = coalesce(CD_UNID_MED_TERAP_MIN_P, 0) and
                    coalesce(c01_w.QT_VEL_INF_TERAP_MIN, 0) = coalesce(QT_VEL_INF_TERAP_MIN_P, 0) and
                    coalesce(c01_w.IE_TIPO_DOSAGEM_MIN, 0) = coalesce(IE_TIPO_DOSAGEM_MIN_P, 0) and
                    coalesce(c01_w.QT_DOSE_TERAP_MAX, 0) = coalesce(QT_DOSE_TERAP_MAX_P, 0) and
                    coalesce(c01_w.CD_UNID_MED_TERAP_MAX, 0) = coalesce(CD_UNID_MED_TERAP_MAX_P, 0) and
                    coalesce(c01_w.QT_VEL_INF_TERAP_MAX, 0) = coalesce(QT_VEL_INF_TERAP_MAX_P, 0) and
                    coalesce(c01_w.IE_TIPO_DOSAGEM_MAX, 0) = coalesce(IE_TIPO_DOSAGEM_MAX_P, 0) and
                    coalesce(c01_w.IE_BOMBA_INFUSAO, 0) = coalesce(IE_BOMBA_INFUSAO_P, 0) and
                    coalesce(c01_w.QT_VOL_DISPOSITIVO, 0) = coalesce(QT_VOL_DISPOSITIVO_P, 0) and
                    coalesce(c01_w.IE_FATOR_CORRECAO, 0) = coalesce(IE_FATOR_CORRECAO_P, 0) and
                    coalesce(c01_w.QT_PERIODO, 0) = coalesce(QT_PERIODO_P, 0) and
                    coalesce(c01_w.QT_DOSE_MEDICAMENTO, 0) = coalesce(QT_DOSE_MEDICAMENTO_P, 0) and
                    coalesce(c01_w.QT_DOSE_SOL, 0) = coalesce(QT_DOSE_SOL_P, 0) and
                    coalesce(c01_w.QT_VOLUME_TOTAL, 0) = coalesce(QT_VOLUME_TOTAL_P, 0) and
                    coalesce(c01_w.QT_CORRIGIDO_MEDIC, 0) = coalesce(QT_CORRIGIDO_MEDIC_P, 0) and
                    coalesce(c01_w.QT_CORRIGIDO_DIL, 0) = coalesce(QT_CORRIGIDO_DIL_P, 0) and
                    coalesce(c01_w.QT_TOTAL_CORRIGIDO, 0) = coalesce(QT_TOTAL_CORRIGIDO_P, 0) and
                    coalesce(c01_w.QT_DOSE_CONVERT, 0) = coalesce(QT_DOSE_CONVERT_P, 0) and
                    coalesce(c01_w.QT_DOSE_DIL_CONVERT, 0) = coalesce(QT_DOSE_DIL_CONVERT_P, 0)
                ) then
                    insert into cpoe_calc_memoria_usada(
                        NR_SEQUENCIA, NR_SEQ_MAT_CPOE, IE_PESO, QT_PESO, QT_ALTURA, QT_SC,
                        QT_IMC, CD_MATERIAL, QT_DOSE, CD_UNIDADE_MEDIDA, CD_MAT_DIL, QT_DOSE_DIL,
                        CD_UNID_MED_DOSE_DIL, QT_CONCENTRACAO_FINAL, QT_FATOR, QT_DOSE_TOTAL_FIXO,
                        IE_VOLUME_FIXO, QT_DOSE_TERAPEUTICA, CD_UNID_MED_DOSE_TERAPEUTICA,
                        QT_DOSAGEM, IE_TIPO_DOSAGEM, QT_DOSE_TERAP_MIN, CD_UNID_MED_TERAP_MIN,
                        QT_VEL_INF_TERAP_MIN, IE_TIPO_DOSAGEM_MIN, QT_DOSE_TERAP_MAX,
                        CD_UNID_MED_TERAP_MAX, QT_VEL_INF_TERAP_MAX, IE_TIPO_DOSAGEM_MAX,
                        IE_BOMBA_INFUSAO, QT_VOL_DISPOSITIVO, IE_FATOR_CORRECAO, QT_PERIODO,
                        QT_DOSE_MEDICAMENTO, QT_DOSE_SOL, QT_VOLUME_TOTAL, QT_CORRIGIDO_MEDIC,
                        QT_CORRIGIDO_DIL, QT_TOTAL_CORRIGIDO, QT_DOSE_CONVERT,
                        QT_DOSE_DIL_CONVERT
                    )
                    values (
                        nextval('cpoe_calc_memoria_usada_seq'), nr_seq_mat_cpoe_p, IE_PESO_P, QT_PESO_P,
                        QT_ALTURA_P, QT_SC_P, QT_IMC_P, CD_MATERIAL_P, QT_DOSE_P,
                        CD_UNIDADE_MEDIDA_P, CD_MAT_DIL_P, QT_DOSE_DIL_P,
                        CD_UNID_MED_DOSE_DIL_P, QT_CONCENTRACAO_FINAL_P,
                        QT_FATOR_P, QT_DOSE_TOTAL_FIXO_P, IE_VOLUME_FIXO_P,
                        QT_DOSE_TERAPEUTICA_P, CD_UNID_MED_DOSE_TERAPEUTICA_P,
                        QT_DOSAGEM_P, IE_TIPO_DOSAGEM_P, QT_DOSE_TERAP_MIN_P,
                        CD_UNID_MED_TERAP_MIN_P, QT_VEL_INF_TERAP_MIN_P,
                        IE_TIPO_DOSAGEM_MIN_P, QT_DOSE_TERAP_MAX_P,
                        CD_UNID_MED_TERAP_MAX_P, QT_VEL_INF_TERAP_MAX_P,
                        IE_TIPO_DOSAGEM_MAX_P, IE_BOMBA_INFUSAO_P,
                        QT_VOL_DISPOSITIVO_P, IE_FATOR_CORRECAO_P, QT_PERIODO_P,
                        QT_DOSE_MEDICAMENTO_P, QT_DOSE_SOL_P, QT_VOLUME_TOTAL_P,
                        QT_CORRIGIDO_MEDIC_P, QT_CORRIGIDO_DIL_P,
                        QT_TOTAL_CORRIGIDO_P, QT_DOSE_CONVERT_P,
                        QT_DOSE_DIL_CONVERT_P
                    );
                    commit;
                end if;
        close c01;

    end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_dup_mem_calc ( nr_seq_mat_cpoe_p cpoe_calc_memoria_usada.nr_seq_mat_cpoe%type,  IE_PESO_P cpoe_calc_memoria_usada.IE_PESO%type, QT_PESO_P cpoe_calc_memoria_usada.QT_PESO%type, QT_ALTURA_P cpoe_calc_memoria_usada.QT_ALTURA%type, QT_SC_P cpoe_calc_memoria_usada.QT_SC%type, QT_IMC_P cpoe_calc_memoria_usada.QT_IMC%type, CD_MATERIAL_P cpoe_calc_memoria_usada.CD_MATERIAL%type, QT_DOSE_P cpoe_calc_memoria_usada.QT_DOSE%type, CD_UNIDADE_MEDIDA_P cpoe_calc_memoria_usada.CD_UNIDADE_MEDIDA%type, CD_MAT_DIL_P cpoe_calc_memoria_usada.CD_MAT_DIL%type, QT_DOSE_DIL_P cpoe_calc_memoria_usada.QT_DOSE_DIL%type, CD_UNID_MED_DOSE_DIL_P cpoe_calc_memoria_usada.CD_UNID_MED_DOSE_DIL%type, QT_CONCENTRACAO_FINAL_P cpoe_calc_memoria_usada.QT_CONCENTRACAO_FINAL%type, QT_FATOR_P cpoe_calc_memoria_usada.QT_FATOR%type, QT_DOSE_TOTAL_FIXO_P cpoe_calc_memoria_usada.QT_DOSE_TOTAL_FIXO%type, IE_VOLUME_FIXO_P cpoe_calc_memoria_usada.IE_VOLUME_FIXO%type, QT_DOSE_TERAPEUTICA_P cpoe_calc_memoria_usada.QT_DOSE_TERAPEUTICA%type, CD_UNID_MED_DOSE_TERAPEUTICA_P cpoe_calc_memoria_usada.CD_UNID_MED_DOSE_TERAPEUTICA%type, QT_DOSAGEM_P cpoe_calc_memoria_usada.QT_DOSAGEM%type, IE_TIPO_DOSAGEM_P cpoe_calc_memoria_usada.IE_TIPO_DOSAGEM%type, QT_DOSE_TERAP_MIN_P cpoe_calc_memoria_usada.QT_DOSE_TERAP_MIN%type, CD_UNID_MED_TERAP_MIN_P cpoe_calc_memoria_usada.CD_UNID_MED_TERAP_MIN%type, QT_VEL_INF_TERAP_MIN_P cpoe_calc_memoria_usada.QT_VEL_INF_TERAP_MIN%type, IE_TIPO_DOSAGEM_MIN_P cpoe_calc_memoria_usada.IE_TIPO_DOSAGEM_MIN%type, QT_DOSE_TERAP_MAX_P cpoe_calc_memoria_usada.QT_DOSE_TERAP_MAX%type, CD_UNID_MED_TERAP_MAX_P cpoe_calc_memoria_usada.CD_UNID_MED_TERAP_MAX%type, QT_VEL_INF_TERAP_MAX_P cpoe_calc_memoria_usada.QT_VEL_INF_TERAP_MAX%type, IE_TIPO_DOSAGEM_MAX_P cpoe_calc_memoria_usada.IE_TIPO_DOSAGEM_MAX%type, IE_BOMBA_INFUSAO_P cpoe_calc_memoria_usada.IE_BOMBA_INFUSAO%type, QT_VOL_DISPOSITIVO_P cpoe_calc_memoria_usada.QT_VOL_DISPOSITIVO%type, IE_FATOR_CORRECAO_P cpoe_calc_memoria_usada.IE_FATOR_CORRECAO%type, QT_PERIODO_P cpoe_calc_memoria_usada.QT_PERIODO%type, QT_DOSE_MEDICAMENTO_P cpoe_calc_memoria_usada.QT_DOSE_MEDICAMENTO%type, QT_DOSE_SOL_P cpoe_calc_memoria_usada.QT_DOSE_SOL%type, QT_VOLUME_TOTAL_P cpoe_calc_memoria_usada.QT_VOLUME_TOTAL%type, QT_CORRIGIDO_MEDIC_P cpoe_calc_memoria_usada.QT_CORRIGIDO_MEDIC%type, QT_CORRIGIDO_DIL_P cpoe_calc_memoria_usada.QT_CORRIGIDO_DIL%type, QT_TOTAL_CORRIGIDO_P cpoe_calc_memoria_usada.QT_TOTAL_CORRIGIDO%type, QT_DOSE_CONVERT_P cpoe_calc_memoria_usada.QT_DOSE_CONVERT%type, QT_DOSE_DIL_CONVERT_P cpoe_calc_memoria_usada.QT_DOSE_DIL_CONVERT%type ) FROM PUBLIC;

