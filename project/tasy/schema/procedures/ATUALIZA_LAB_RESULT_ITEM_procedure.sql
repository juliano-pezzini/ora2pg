-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualiza_lab_result_item ( nr_seq_resultado_p bigint, nr_seq_exame_p bigint, nr_seq_prescr_p bigint, vl_exame_p text, ds_campo_p text, ds_uni_med_p text, ds_observacao_p text, nm_usuario_p text, ds_referencia_p text, ds_comando_p INOUT text) AS $body$
DECLARE



ds_comando_w		varchar(2000);
ds_parametros_w		varchar(4000);
sql_unid_med_w		varchar(300);
sql_unid_med_bv_w	varchar(300);
sql_refer_w		varchar(300) := '';
sql_refer_bv_w		varchar(4000) := '';
sql_observacao		varchar(4000);
sql_observacao_bv_w	varchar(4000);



BEGIN

begin

if (ds_referencia_p IS NOT NULL AND ds_referencia_p::text <> '') then
	sql_refer_w := ', ds_referencia = :ds_referencia';
	sql_refer_bv_w := ';ds_referencia='||replace(substr(ds_referencia_p,1,3500),chr(10),chr(13)||chr(10));
end if;

if (ds_uni_med_p IS NOT NULL AND ds_uni_med_p::text <> '')  then
	sql_unid_med_w 		:=  ', ds_unidade_medida = :ds_unidade_medida';
	sql_unid_med_bv_w   	:= ';ds_unidade_medida=' || ds_uni_med_p;
end if;

if (ds_observacao_p IS NOT NULL AND ds_observacao_p::text <> '') then
	sql_observacao		:=  ', ds_observacao = :ds_observacao';
	sql_observacao_bv_w	:=  ';ds_observacao=' || ds_observacao_p;
end if;



ds_comando_w := ' update exame_lab_result_item
			 set ' || ds_campo_p || '  = :vl_exame_filho,
			 nm_usuario = :nm_usuario ' || sql_unid_med_w || sql_refer_w || sql_observacao ||
		' where  nr_seq_resultado  = :nr_seq_resultado
		    and	 nr_seq_exame = :nr_seq_exame
		    and  nr_seq_prescr = :nr_seq_prescr';


ds_parametros_w  :=    'vl_exame_filho='|| vl_exame_p ||
		       ';nm_usuario=' || nm_usuario_p ||
		       sql_unid_med_bv_w ||
		       sql_refer_bv_w ||
		       sql_observacao_bv_w ||
		       ';nr_seq_resultado='|| nr_seq_resultado_p ||
		       ';nr_seq_exame='|| nr_seq_exame_p ||
		       ';nr_seq_prescr='|| nr_seq_prescr_p;
CALL exec_sql_dinamico_bv('ATUALIZA_LAB_RESULT_ITEM', ds_comando_w,ds_parametros_w);

exception
	when others then
		CALL gravar_log_lab(40,substr(sqlerrm,1,1900),nm_usuario_p,nr_seq_resultado_p);
		commit;

end;
commit;

--ds_comando_p := ds_comando_w + chr(13) + ds_parametros_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualiza_lab_result_item ( nr_seq_resultado_p bigint, nr_seq_exame_p bigint, nr_seq_prescr_p bigint, vl_exame_p text, ds_campo_p text, ds_uni_med_p text, ds_observacao_p text, nm_usuario_p text, ds_referencia_p text, ds_comando_p INOUT text) FROM PUBLIC;

