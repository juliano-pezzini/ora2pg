-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copia_permissao_agenda_selec (cd_agenda_p bigint, nr_seq_perm_copiar_p bigint, nm_usuario_destino_p text, cd_perfil_destino_p bigint, cd_setor_destino_p bigint) AS $body$
DECLARE


cd_pessoa_destino_w	varchar(10);


BEGIN
select	max(cd_pessoa_fisica)
into STRICT	cd_pessoa_destino_w
from	usuario
where	upper(nm_usuario) = upper(nm_usuario_destino_p);

if (nr_seq_perm_copiar_p IS NOT NULL AND nr_seq_perm_copiar_p::text <> '') and
	((cd_pessoa_destino_w	<> '0') or (cd_perfil_destino_p IS NOT NULL AND cd_perfil_destino_p::text <> '') or (cd_setor_destino_p IS NOT NULL AND cd_setor_destino_p::text <> '')) then
	insert into med_permissao(
					nr_sequencia,
					cd_medico_prop,
					dt_atualizacao,
					nm_usuario,
					ie_paciente,
					ie_atendimento,
					ie_evolucao,
					ie_protocolo,
					ie_receita,
					ie_solic_exame,
					ie_agenda,
					ie_resultado,
					ie_consulta,
					ie_fechar_atend,
					ie_med_padrao,
					ie_exame_padrao,
					ie_permissao,
					ie_config_relat,
					ie_grupo_medico,
					ie_diagnostico,
					ie_texto_adicional,
					ie_referencia,
					ie_eis,
					ie_enderecos,
					ie_texto_padrao,
					ie_parametro,
					ie_config_agenda,
					cd_pessoa_fisica,
					cd_medico,
					nr_seq_grupo,
					cd_perfil,
					cd_setor_atendimento,
					ie_permite_excluir_agenda,
					ie_permite_bloquear_agenda,
					cd_agenda)
					(SELECT	nextval('med_permissao_seq'),
							a.cd_medico_prop,
							a.dt_atualizacao,
							a.nm_usuario,
							a.ie_paciente,
							a.ie_atendimento,
							a.ie_evolucao,
							a.ie_protocolo,
							a.ie_receita,
							a.ie_solic_exame,
							a.ie_agenda,
							a.ie_resultado,
							a.ie_consulta,
							a.ie_fechar_atend,
							a.ie_med_padrao,
							a.ie_exame_padrao,
							a.ie_permissao,
							a.ie_config_relat,
							a.ie_grupo_medico,
							a.ie_diagnostico,
							a.ie_texto_adicional,
							a.ie_referencia,
							a.ie_eis,
							a.ie_enderecos,
							a.ie_texto_padrao,
							a.ie_parametro,
							a.ie_config_agenda,
							cd_pessoa_destino_w,
							a.cd_medico,
							a.nr_seq_grupo,
							cd_perfil_destino_p,
							cd_setor_destino_p,
							ie_permite_excluir_agenda,
							ie_permite_bloquear_agenda,
							cd_agenda_p
						from	med_permissao a
						where	a.nr_sequencia = nr_seq_perm_copiar_p);
end if;
commit;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copia_permissao_agenda_selec (cd_agenda_p bigint, nr_seq_perm_copiar_p bigint, nm_usuario_destino_p text, cd_perfil_destino_p bigint, cd_setor_destino_p bigint) FROM PUBLIC;

