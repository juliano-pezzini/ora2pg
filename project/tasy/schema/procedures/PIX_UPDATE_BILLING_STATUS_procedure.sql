-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pix_update_billing_status () AS $body$
DECLARE

  DS_DATA_W text;
  DS_RESULT_W text;

  RBILLING RECORD;

BEGIN
  FOR RBILLING IN (SELECT c.NR_SEQUENCIA pixBiilingId, t.NR_SEQUENCIA pixTransmissionId
                   FROM pix_transmissao t
LEFT OUTER JOIN pix_cobranca c ON (t.nr_seq_pix_cob = c.NR_SEQUENCIA)
WHERE c.DS_STATUS = 'ATIVA'  )
  LOOP
    DS_DATA_W := '{ "pixBillingId" : ' || RBILLING.pixBiilingId || ',' ||
                   ' "pixTransmissionId" : ' || RBILLING.pixTransmissionId || ', ' || 
                   ' "userName" : "' || Obter_Usuario_Ativo || '" ' ||
                   '}';

    ds_result_w := bifrost.send_integration(nm_event => 'pix.consultar.cobranca.imediata',
       nm_javaclass => 'com.philips.tasy.integration.pix.api.billing.inbound.callback.RequestBillingRegistrationCallback',
	   ds_arguments => ds_data_w , nm_user => Obter_Usuario_Ativo);

  END LOOP;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pix_update_billing_status () FROM PUBLIC;

