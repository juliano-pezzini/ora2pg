-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE bsc_duplicar_indicador ( nr_sequencia_p bigint, ie_informacao_p text, ie_regra_lib_p text, ie_regra_resp_p text, ie_regra_sumario_p text, nm_usuario_p text) AS $body$
DECLARE


nr_sequencia_w			bigint;
ds_info_complementar_w		text;


BEGIN

select 	nextval('bsc_indicador_seq')
into STRICT 	nr_sequencia_w
;

insert into bsc_indicador(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nm_indicador,
		ds_indicador,
		ie_situacao,
		ie_tipo,
		nr_seq_superior,
		ie_periodo,
		cd_ano_limite,
		dt_fechamento,
		ds_formula,
		nr_seq_medida,
		ie_regra_result,
		cd_classificacao,
		nr_seq_origem,
		ie_regra_intervalo,
		nr_dia_liberacao,
		ie_visualizacao,
		qt_ano_anterior,
		ie_informacao,
		ie_forma_consol_empresa,
		nr_seq_qualif,
		cd_estab_exclusivo,
		nr_seq_tipo,
		nr_seq_risco_vinc,
		vl_min_grafico,
		vl_max_grafico)
	SELECT	nr_sequencia_w,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		substr(wheb_mensagem_pck.get_texto(798595) || nm_indicador,1,255),
		ds_indicador,
		'A',
		ie_tipo,
		nr_seq_superior,
		ie_periodo,
		cd_ano_limite,
		dt_fechamento,
		ds_formula,
		nr_seq_medida,
		ie_regra_result,
		cd_classificacao,
		nr_seq_origem,
		ie_regra_intervalo,
		nr_dia_liberacao,
		ie_visualizacao,
		qt_ano_anterior,
		ie_informacao,
		ie_forma_consol_empresa,
		nr_seq_qualif,
		cd_estab_exclusivo,
		nr_seq_tipo,
		nr_seq_risco_vinc,
		vl_min_grafico,
		vl_max_grafico
	from 	bsc_indicador
	where 	nr_sequencia = nr_sequencia_p;

	select 	ds_info_complementar
	into STRICT	ds_info_complementar_w
	from	bsc_indicador
	where	nr_sequencia = nr_sequencia_p;

	update 	bsc_indicador
	set	ds_info_complementar 	= ds_info_complementar_w
	where	nr_sequencia 		= nr_sequencia_w;

if (ie_informacao_p = 'S') then
	insert into bsc_ind_inf(
		 nr_sequencia,
		 cd_empresa,
		 nr_seq_indicador,
		 dt_atualizacao,
		 nm_usuario,
		 dt_atualizacao_nrec,
		 nm_usuario_nrec,
		 cd_ano,
		 cd_periodo,
		 cd_estabelecimento,
		 qt_meta,
		 qt_real,
		 qt_limite,
		 ie_fechado,
		 nr_seq_result,
		 dt_liberacao,
		 qt_referencia,
		 ds_justificativa)
	SELECT	 nextval('bsc_ind_inf_seq'),
		 cd_empresa,
		 nr_sequencia_w,
		 clock_timestamp(),
		 nm_usuario_p,
		 clock_timestamp(),
		 nm_usuario_p,
		 cd_ano,
		 cd_periodo,
		 cd_estabelecimento,
		 qt_meta,
		 qt_real,
		 qt_limite,
		 'A',
		 nr_seq_result,
		 null,
		 qt_referencia,
		 ds_justificativa
	from	bsc_ind_inf
	where	nr_seq_indicador = nr_sequencia_p;
end if;

if (ie_regra_lib_p = 'S') then
	insert into bsc_ind_liberacao(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nm_usuario_lib,
		cd_setor_atendimento,
		cd_perfil,
		cd_cargo,
		ie_permite,
		nr_seq_indicador,
		nr_seq_grupo_usuario)
	SELECT	nextval('bsc_ind_liberacao_seq'),
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		nm_usuario_lib,
		cd_setor_atendimento,
		cd_perfil,
		cd_cargo,
		ie_permite,
		nr_sequencia_w,
		nr_seq_grupo_usuario
	from	bsc_ind_liberacao
	where	nr_seq_indicador = nr_sequencia_p;
end if;

if (ie_regra_resp_p = 'S') then
	insert into bsc_ind_resp(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_indicador,
		dt_inicio_vigencia,
		cd_pessoa_fisica,
		dt_fim_vigencia,
		ie_receb_comunic,
		ie_receb_comunic_inf)
	SELECT	nextval('bsc_ind_resp_seq'),
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		nr_sequencia_w,
		dt_inicio_vigencia,
		cd_pessoa_fisica,
		dt_fim_vigencia,
		ie_receb_comunic,
		ie_receb_comunic_inf
	from	bsc_ind_resp
	where	nr_seq_indicador = nr_sequencia_p;
end if;

if (ie_regra_sumario_p = 'S') then
	insert into bsc_ind_regra_inf(
		nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		nr_seq_indicador,
		ie_forma_calculo,
		ie_operacao,
		dt_atualizacao_nrec,
		nm_usuario_nrec)
	SELECT	nextval('bsc_ind_regra_inf_seq'),
		clock_timestamp(),
		nm_usuario_p,
		nr_sequencia_w,
		ie_forma_calculo,
		ie_operacao,
		clock_timestamp(),
		nm_usuario_p
	from	bsc_ind_regra_inf
	where	nr_seq_indicador = nr_sequencia_p;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE bsc_duplicar_indicador ( nr_sequencia_p bigint, ie_informacao_p text, ie_regra_lib_p text, ie_regra_resp_p text, ie_regra_sumario_p text, nm_usuario_p text) FROM PUBLIC;

