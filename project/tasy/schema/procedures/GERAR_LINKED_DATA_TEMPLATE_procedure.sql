-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_linked_data_template ( nr_seq_template_p bigint, nr_seq_linked_data_p bigint, nm_usuario_p text ) AS $body$
DECLARE


c01 CURSOR FOR
SELECT
          a.nm_atributo nm_atributo, 
          c.ie_tipo_atributo ie_tipo_atributo, 
          a.cd_exp_label cd_exp_label, 
          a.cd_exp_valores, 
          a.cd_dominio, 
          a.nr_seq_localizador, 
          a.ds_mascara, 
          a.nm_atributo_pai, 
          a.ds_label_grid, 
          a.nr_seq_apresent nr_seq_apres, 
          a.nr_seq_grid, 
          a.ie_nova_linha, 
          a.qt_tam_delphi qt_tamanho, 
          a.qt_altura, 
          a.vl_padrao, 
          a.ie_obrigatorio, 
          a.ie_readonly, 
          a.ie_tabstop, 
          c.ie_informacao_sensivel ie_sensivel, 
          a.qt_coluna, 
          a.ie_componente,
		  a.ds_valores
from    tabela_visao_atributo  a, 
        tabela_visao  b, 
        tabela_atributo  c, 
        linked_data  d 
where   d.nr_sequencia = nr_seq_linked_data_p
and     a.nr_sequencia = d.nr_seq_vision
and     b.nr_sequencia = a.nr_sequencia 
and     b.nm_tabela    = c.nm_tabela 
and     c.nm_atributo  = a.nm_atributo 
and     b.nm_tabela = d.nm_table 
order by a.nm_atributo;

nm_usuario_w                    tabela_atributo_linked.nm_usuario%type;
nr_atributo_seq_w               tabela_atributo_linked.nr_sequencia%type;
ie_not_visible_philips_w        tabela_atributo_linked.ie_not_visible_philips%type := 'N';
ie_readonly_philips_w           tabela_atributo_linked.ie_readonly_philips%type    := 'N';
ie_obrigatorio_philips_w        tabela_atributo_linked.ie_obrigatorio_philips%type := 'N';

BEGIN

if (nr_seq_template_p IS NOT NULL AND nr_seq_template_p::text <> '' AND nr_seq_linked_data_p IS NOT NULL AND nr_seq_linked_data_p::text <> '') then

  delete from tabela_atributo_linked
  where nr_seq_elemento = nr_seq_template_p;

  if (coalesce(nm_usuario_p::text, '') = '' or nm_usuario_p = '') then
    select obter_usuario_ativo
    into STRICT nm_usuario_w 
;
  else
    nm_usuario_w := nm_usuario_p;
  end if;

  for atributo in c01 loop
    select	nextval('tabela_atributo_linked_seq')
    into STRICT	nr_atributo_seq_w
;

    if (coalesce(atributo.nr_seq_apres::text, '') = '') then
      ie_not_visible_philips_w := 'S';
    end if;

    if (atributo.ie_readonly = 'S') then
      ie_readonly_philips_w := 'S';
    end if;

    if (atributo.ie_obrigatorio = 'S') then
      ie_obrigatorio_philips_w := 'S';
    end if;

    insert into tabela_atributo_linked(
                ds_elemento,
                ds_exp_cliente, 
                ds_formula, 
                ds_msg_aviso, 
                ds_msg_bloqueio, 
                ds_propriedade, 
                ds_sql, 
                dt_atualizacao_nrec, 
                dt_atualizacao, 
                ie_copia, 
                ie_evolucao, 
                ie_info_paciente, 
                ie_macro, 
                ie_not_visible_philips, 
                ie_obrigatorio_philips, 
                ie_opcional, 
                ie_readonly_philips, 
                nm_usuario_nrec, 
                nm_usuario, 
                nr_elemento, 
                nr_seq_camp_sup, 
                nr_seq_elem_visual, 
                nr_seq_elemento, 
                nr_seq_linked, 
                nr_seq_texto_padrao, 
                nr_sequencia, 
                qt_caracter, 
                vl_maximo_aviso, 
                vl_maximo_bloqueio, 
                vl_minimo_aviso, 
                vl_minimo_bloqueio, 
                /*--*/

                cd_dominio, 
                cd_exp_label, 
                cd_exp_valores, 
                ds_label_grid, 
                ds_mascara, 
                ie_componente,
                ie_nova_linha, 
                ie_obrigatorio, 
                ie_readonly, 
                ie_sensivel, 
                ie_tabstop, 
                ie_tipo_atributo, 
                nm_atributo_pai, 
                nm_atributo, 
                nr_seq_apres, 
                nr_seq_grid, 
                nr_seq_localizador, 
                qt_altura, 
                qt_coluna, 
                qt_tamanho, 
                vl_padrao,
				ds_valores
    ) values (
        null, 
        null, 
        null, 
        null, 
        null, 
        null, 
        null, 
        clock_timestamp(), 
        clock_timestamp(), 
        null, 
        null, 
        null, 
        null, 
        ie_not_visible_philips_w, 
        ie_obrigatorio_philips_w, 
        null, 
        ie_readonly_philips_w, 
        nm_usuario_w, 
        nm_usuario_w, 
        null, 
        null, 
        null, 
        nr_seq_template_p, 
        nr_seq_linked_data_p,
        null, 
        nr_atributo_seq_w,
        null, 
        null, 
        null, 
        null, 
        null, 
          /*--*/

        atributo.cd_dominio, 
        atributo.cd_exp_label, 
        atributo.cd_exp_valores, 
        atributo.ds_label_grid, 
        atributo.ds_mascara, 
        atributo.ie_componente,
        atributo.ie_nova_linha, 
        atributo.ie_obrigatorio, 
        atributo.ie_readonly, 
        atributo.ie_sensivel, 
        atributo.ie_tabstop, 
        atributo.ie_tipo_atributo, 
        atributo.nm_atributo_pai, 
        atributo.nm_atributo, 
        atributo.nr_seq_apres, 
        atributo.nr_seq_grid, 
        atributo.nr_seq_localizador, 
        atributo.qt_altura, 
        atributo.qt_coluna, 
        atributo.qt_tamanho, 
        atributo.vl_padrao,
		atributo.ds_valores
    );
  end loop;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_linked_data_template ( nr_seq_template_p bigint, nr_seq_linked_data_p bigint, nm_usuario_p text ) FROM PUBLIC;

