-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copia_param_conv_precos ( cd_convenio_orig_p bigint, cd_convenio_dest_p bigint, nm_tabela_p text, nm_usuario_p text, ie_excluir_p text, cd_estabelecimento_p bigint) AS $body$
DECLARE

nr_seq_w                                                           bigint;
nr_sequencia_w                                              bigint;
dt_liberacao_tabela_w                 timestamp;
cd_tabela_servico_w                     smallint;
nr_prioridade_w                                              bigint;
ie_situacao_w                                   varchar(1);
cd_categoria_w                                varchar(10);
cd_tab_preco_mat_w                   smallint;
tx_ajuste_tabela_mat_w                              double precision;
/*rafael em 09/05/2006 os33807*/

cd_material_w                                  integer;
dt_inicio_vigencia_w                     timestamp;
cd_grupo_material_w                   smallint;
cd_subgrupo_material_w                            smallint;
cd_classe_material_w                   integer;
tx_ajuste_w                                       double precision;
vl_negociado_w                                               double precision;
ie_preco_informado_w                varchar(1);
ie_glosa_w                                         varchar(1);
tx_brasindice_pfb_w                     REGRA_AJUSTE_MATERIAL.TX_BRASINDICE_PFB%type; -- number(15,4);
tx_brasindice_pmc_w                   CONVENIO_BRASINDICE.TX_BRASINDICE_PMC%type;--number(15,4);
tx_afaturar_w                                   double precision;
dt_final_vigencia_w                                       timestamp;
cd_tipo_acomodacao_w                              smallint;
ie_tipo_atendimento_w                               smallint;
cd_setor_atendimento_w                           integer;
qt_idade_min_w                                             bigint;
qt_idade_max_w                                             bigint;
tx_simpro_pfb_w                                            double precision;
tx_simpro_pmc_w                                          double precision;
ie_origem_preco_w                                       varchar(5);
ie_precedencia_preco_w                             varchar(1);
pr_glosa_w                                        double precision;
ie_tipo_material_w                                        varchar(3);
tx_pmc_neg_w                                 CONVENIO_BRASINDICE.TX_PMC_NEG%type;--number(15,4);
tx_pmc_pos_w                                 CONVENIO_BRASINDICE.TX_PMC_POS%type;--number(15,4);
cd_cid_w                                                             varchar(10);
cd_tabela_preco_w                                        bigint;
cd_motivo_exc_conta_w                             bigint;
nr_seq_ajuste_w                                             bigint;
vl_inicial_w                                         double precision;
vl_final_w                                                           double precision;
tx_ajustedif_w                                  double precision;
cd_plano_w                                       varchar(10);
ds_xml_w                                                           text;
qt_ajuste_w                                      smallint;
ds_documento_w                                           text;
ie_documento_w                                            varchar(3);
ds_arquivo_w                                   varchar(255);
ie_sexo_w                                          varchar(01);
ie_autor_particular_w                   varchar(01);
qt_reg_w                                            bigint;
ie_kit_material_w                           varchar(1);
cd_kit_material_w                          integer;
/*fim alteracao rafael (em 09/05/2006 os33807)*/

tx_pfb_neg_w                                  CONVENIO_BRASINDICE.TX_PFB_NEG%type;--number(15,4);
tx_pfb_pos_w                                   CONVENIO_BRASINDICE.TX_PFB_POS%type;--number(15,4);
nr_seq_estrutura_w                      bigint;

ie_origem_preco_ww                    varchar(5);
dt_termino_w                                  timestamp;
cd_tipo_baixa_w                                             smallint;
ie_tab_adicional_w                        varchar(1);
cd_tab_mat_atualizacao_w        smallint;
ie_integracao_opme_w                varchar(1);
tx_ajuste_geral_w               double precision;
ie_clinica_w                                       integer;
cd_convenio_glosa_w                   convenio.cd_convenio%type;
cd_categoria_glosa_w                   categoria_convenio.cd_categoria%type;
nr_seq_tiss_tabela_w 		convenio_servico.nr_seq_tiss_tabela%type;
ie_tipo_preco_autor_w	 	regra_ajuste_material.ie_tipo_preco_autor%type;

c001 CURSOR FOR
SELECT    nr_sequencia
from      regra_ajuste_proc
where   cd_convenio                      = cd_convenio_orig_p
and        cd_estabelecimento       = cd_estabelecimento_p;


c002 CURSOR FOR
SELECT    nr_sequencia
from      convenio_regra_qtde
where   cd_convenio                      = cd_convenio_orig_p
and        cd_estabelecimento       = cd_estabelecimento_p;

c003 CURSOR FOR
SELECT    cd_categoria,
                dt_liberacao_tabela,
                cd_tabela_servico,
                ie_situacao,
                nr_prioridade,
                dt_termino,
                tx_ajuste_geral,
	       nr_seq_tiss_tabela
from      convenio_servico
where   cd_convenio = cd_convenio_orig_p
and        cd_estabelecimento = cd_estabelecimento_p;


c004 CURSOR FOR
SELECT    cd_categoria,
                dt_liberacao_tabela,
                cd_tab_preco_mat,
                tx_ajuste_tabela_mat,
                ie_situacao,
                nr_prioridade,
                coalesce(ie_tab_adicional,'N'),
                dt_final_vigencia,
                dt_inicio_vigencia,
                cd_tab_mat_atualizacao,
                ie_integracao_opme
from      convenio_preco_mat
where   cd_convenio = cd_convenio_orig_p
and        cd_estabelecimento = cd_estabelecimento_p;

c005 CURSOR FOR
SELECT    nr_sequencia, dt_inicio_vigencia,  ie_situacao, cd_categoria,
                cd_grupo_material, cd_subgrupo_material, cd_classe_material, cd_material,
                tx_ajuste, vl_negociado, ie_preco_informado, ie_glosa,
                tx_brasindice_pfb, tx_brasindice_pmc, tx_afaturar, dt_final_vigencia,
                cd_tipo_acomodacao, ie_tipo_atendimento, cd_setor_atendimento, qt_idade_min,
                qt_idade_max,tx_simpro_pfb, tx_simpro_pmc, ie_origem_preco,
                ie_precedencia_preco, pr_glosa, ie_tipo_material, tx_pmc_neg,
                tx_pmc_pos, cd_cid, cd_tabela_preco, cd_motivo_exc_conta, ie_sexo, cd_plano,
                ie_autor_particular, ie_kit_material, cd_kit_material, tx_pfb_neg, tx_pfb_pos,
                nr_seq_estrutura, cd_tipo_baixa, ie_clinica, cd_convenio_glosa, cd_categoria_glosa,
				ie_tipo_preco_autor
from      regra_ajuste_material
where   cd_convenio                      = cd_convenio_orig_p
and        cd_estabelecimento       = cd_estabelecimento_p
and        coalesce(cd_material::text, '') = '';

c006 CURSOR FOR
SELECT    vl_inicial,
                vl_final,
                tx_ajuste,
                ie_origem_preco
from      regra_ajuste_indice_dif
where   nr_seq_regra    = nr_sequencia_w;


c007 CURSOR FOR
SELECT    nr_sequencia
from      mat_convenio_regra_qtde
where   cd_convenio                      = cd_convenio_orig_p
and        cd_estabelecimento       = cd_estabelecimento_p;

c008 CURSOR FOR
SELECT    nr_sequencia
from      tipo_taxa_cirurgica
where   cd_convenio                      = cd_convenio_orig_p
and        cd_estabelecimento       = cd_estabelecimento_p;

c009 CURSOR FOR
SELECT    nr_sequencia, dt_inicio_vigencia,  ie_situacao, cd_categoria,
                cd_grupo_material, cd_subgrupo_material, cd_classe_material, cd_material,
                tx_ajuste, vl_negociado, ie_preco_informado, ie_glosa,
                tx_brasindice_pfb, tx_brasindice_pmc, tx_afaturar, dt_final_vigencia,
                cd_tipo_acomodacao, ie_tipo_atendimento, cd_setor_atendimento, qt_idade_min,
                qt_idade_max,tx_simpro_pfb, tx_simpro_pmc, ie_origem_preco,
                ie_precedencia_preco, pr_glosa, ie_tipo_material, tx_pmc_neg,
                tx_pmc_pos, cd_cid, cd_tabela_preco, cd_motivo_exc_conta, ie_sexo, cd_plano,
                ie_autor_particular, ie_kit_material, cd_kit_material,tx_pfb_neg, tx_pfb_pos,
                nr_seq_estrutura, cd_tipo_baixa, ie_clinica, ie_tipo_preco_autor
from      regra_ajuste_material
where   cd_convenio                      = cd_convenio_orig_p
and        cd_estabelecimento       = cd_estabelecimento_p
and        (cd_material IS NOT NULL AND cd_material::text <> '');

c010 CURSOR FOR
SELECT    a.cd_categoria
from      categoria_convenio a
where   a.cd_convenio  = cd_convenio_dest_p
and        exists (              SELECT    1
                                                from      categoria_convenio x,
                                                                convenio_brasindice y
                                                where   x.cd_convenio  = cd_convenio_orig_p
                                                and        x.cd_categoria  = a.cd_categoria
                                                and        x.cd_convenio  = y.cd_convenio
                                                and        x.cd_categoria  = y.cd_categoria);



BEGIN

if (nm_tabela_p = 'CONVENIO_AMB') then
                if (ie_excluir_p = 'S') then
                                delete   from      convenio_amb
                                where   cd_convenio = cd_convenio_dest_p
                                and        cd_estabelecimento = cd_estabelecimento_p;
                end if;

                insert into convenio_amb(
                                                cd_estabelecimento, cd_convenio, cd_categoria, dt_inicio_vigencia,
                                                ie_prioridade, cd_edicao_amb, tx_ajuste_geral, dt_atualizacao,
                                                nm_usuario, vl_ch_honorarios, vl_ch_custo_oper, vl_filme,
                                                ie_situacao, dt_final_vigencia, nr_seq_cbhpm_edicao, nr_seq_tiss_tabela)
                                SELECT    cd_estabelecimento_p, cd_convenio_dest_p, cd_categoria,
                                                dt_inicio_vigencia, ie_prioridade, cd_edicao_amb,
                                                tx_ajuste_geral, clock_timestamp(), nm_usuario_p, vl_ch_honorarios,
                                                vl_ch_custo_oper, vl_filme, ie_situacao, dt_final_vigencia,
                                                nr_seq_cbhpm_edicao, nr_seq_tiss_tabela
                                from      convenio_amb
                                where   cd_convenio = cd_convenio_orig_p
                                and        cd_estabelecimento = cd_estabelecimento_p;
elsif (nm_tabela_p = 'REGRA_AJUSTE_PROC(Ajuste)') then
                if (ie_excluir_p = 'S') then
                                delete   from      regra_ajuste_proc_aviso
                                where   nr_seq_regra in (SELECT nr_sequencia
                                                                                from   regra_ajuste_proc
                                                                         where         cd_convenio = cd_convenio_dest_p
                                                                                and       cd_estabelecimento = cd_estabelecimento_p
                                                                                and       ((cd_procedimento IS NOT NULL AND cd_procedimento::text <> '') or (nr_seq_proc_interno IS NOT NULL AND nr_seq_proc_interno::text <> '') or (nr_seq_exame IS NOT NULL AND nr_seq_exame::text <> '')));
                                delete   from      regra_ajuste_proc
                                where   cd_convenio = cd_convenio_dest_p
                                and        cd_estabelecimento = cd_estabelecimento_p
                                and        ((cd_procedimento IS NOT NULL AND cd_procedimento::text <> '') or (nr_seq_proc_interno IS NOT NULL AND nr_seq_proc_interno::text <> '') or (nr_seq_exame IS NOT NULL AND nr_seq_exame::text <> ''));
                end if;
                begin
                open c001;
                                loop
                                fetch c001 into
                                                nr_seq_w;
                                EXIT WHEN NOT FOUND; /* apply on c001 */
                                                                begin
                                                                select    nextval('regra_ajuste_proc_seq')
                                                                into STRICT        nr_sequencia_w
;

                                                                insert into regra_ajuste_proc(
                                                                                nr_sequencia,
                                                                                cd_estabelecimento,
                                                                                cd_convenio,
                                                                                dt_inicio_vigencia,
                                                                                ie_situacao,
                                                                                dt_atualizacao,
                                                                                nm_usuario,
                                                                                cd_categoria,
                                                                                cd_edicao_amb,
                                                                                cd_area_procedimento,
                                                                                cd_especialidade,
                                                                                cd_grupo_proc,
                                                                                cd_procedimento,
                                                                                ie_origem_proced,
                                                                                ie_preco_informado,
                                                                                vl_proc_ajustado,
                                                                                ie_glosa,
                                                                                cd_procedimento_esp,
                                                                                tx_ajuste,
                                                                                nr_seq_regra_preco,
                                                                                dt_final_vigencia,
                                                                                cd_tipo_acomodacao,
                                                                                ie_tipo_atendimento,
                                                                                cd_setor_atendimento,
                                                                                vl_medico,
                                                                                vl_custo_operacional,
                                                                                qt_filme,
                                                                                nr_auxiliares,
                                                                                qt_porte_anestesico,
                                                                                tx_ajuste_custo_oper,
                                                                                tx_ajuste_medico,
                                                                                tx_ajuste_filme,
                                                                                ie_credenciado,
                                                                                pr_glosa,
                                                                                cd_cid,
                                                                                qt_idade_min,
                                                                                qt_idade_max,
                                                                                nr_seq_proc_interno,
                                                                                nr_seq_exame,
                                                                                cd_plano,
                                                                                ie_clinica,
                                                                                cd_empresa_ref,
                                                                                cd_motivo_exc_conta,
                                                                                cd_medico,
                                                                                ds_observacao,
                                                                                tx_ajuste_partic,
                                                                                vl_glosa,
                                                                                ie_sexo,
                                                                                ie_atend_retorno,
                                                                                ie_autor_particular,
                                                                                cd_equipamento,
                                                                                cd_setor_atend_prescr,
                                                                                ie_ignora_ch_edicao_amb,
                                                                                ie_consiste_prescr,
                                                                                ie_utiliza_video,
                                                                                ie_spect,
                                                                                cd_especialidade_medica,
                                                                                cd_usuario_convenio,
                                                                                qt_pos_inicial,
                                                                                qt_pos_final,
                                                                                ie_edicao_convenio,
                                                                                ie_prior_edicao_ajuste,
                                                                                cd_tabela_servico,
                                                                                NR_SEQ_AREA_INT,
                                                                                NR_SEQ_ESPEC_INT,
                                                                                NR_SEQ_GRUPO_INT,
                                                                                cd_dependente,
                                                                                nr_seq_origem,
                                                                                cd_convenio_glosa,
                                                                                cd_categoria_glosa,
                                                                                ie_origem_proc_ref,
                                                                                ie_proc_unico_sus,
                                                                                ie_origem_proc_refer,
                                                                                ie_gerar_sem_proc_ref_sus,
                                                                                ie_consiste_edicao_prior,
                                                                                ie_tx_edicao_amb_regra,
                                                                                ie_paciente_deficiente,
                                                                                ie_estrangeiro,
                                                                                ie_carater_inter_sus,
                                                                                qt_dias_inter_final,
                                                                                ie_beira_leito,
                                                                                tx_ajuste_matmed,
                                                                                tx_desconto,
                                                                                ie_tipo_atend_bpa,
                                                                                tx_adm,
                                                                                ie_vinculo_medico,
                                                                                vl_filme,
                                                                                vl_auxiliares,
                                                                                qt_dias_inter_inicio,
                                                                                ie_entra_filme_neg,
                                                                                ie_proc_qt_zero_sus,
                                                                                ie_complexidade_sus,
                                                                                vl_anestesista,
                                                                                ie_consider_level,
                                                                                vl_maxproc_regra_sus,
										nr_seq_estrutura)
                                                                SELECT    nr_sequencia_w,
                                                                                                cd_estabelecimento_p,
                                                                                                cd_convenio_dest_p,
                                                                                                dt_inicio_vigencia,
                                                                                                ie_situacao,
                                                                                                clock_timestamp(),
                                                                                                nm_usuario_p,
                                                                                                null,
                                                                                                cd_edicao_amb,
                                                                                                cd_area_procedimento,
                                                                                                cd_especialidade,
                                                                                                cd_grupo_proc,
                                                                                                cd_procedimento,
                                                                                                ie_origem_proced,
                                                                                                ie_preco_informado,
                                                                                                vl_proc_ajustado,
                                                                                                ie_glosa,
                                                                                                cd_procedimento_esp,
                                                                                                tx_ajuste,
                                                                                                nr_seq_regra_preco,
                                                                                                dt_final_vigencia,
                                                                                                cd_tipo_acomodacao,
                                                                                                ie_tipo_atendimento,
                                                                                                cd_setor_atendimento,
                                                                                                vl_medico,
                                                                                                vl_custo_operacional,
                                                                                                qt_filme,
                                                                                                nr_auxiliares,
                                                                                                qt_porte_anestesico,
                                                                                                tx_ajuste_custo_oper,
                                                                                                tx_ajuste_medico,
                                                                                                tx_ajuste_filme,
                                                                                                ie_credenciado,
                                                                                                pr_glosa,
                                                                                                cd_cid,
                                                                                                qt_idade_min,
                                                                                                qt_idade_max,
                                                                                                nr_seq_proc_interno,
                                                                                                nr_seq_exame,
                                                                                                null,
                                                                                                ie_clinica,
                                                                                                cd_empresa_ref,
                                                                                                cd_motivo_exc_conta,
                                                                                                cd_medico,
                                                                                                ds_observacao,
                                                                                                tx_ajuste_partic,
                                                                                                vl_glosa,
                                                                                                ie_sexo,
                                                                                                ie_atend_retorno,
                                                                                                ie_autor_particular,
                                                                                                cd_equipamento,
                                                                                                cd_setor_atend_prescr,
                                                                                                ie_ignora_ch_edicao_amb,
                                                                                                ie_consiste_prescr,
                                                                                                ie_utiliza_video,
                                                                                                ie_spect,
                                                                                                cd_especialidade_medica,
                                                                                                cd_usuario_convenio,
                                                                                                qt_pos_inicial,
                                                                                                qt_pos_final,
                                                                                                ie_edicao_convenio,
                                                                                                ie_prior_edicao_ajuste,
                                                                                                cd_tabela_servico,
                                                                                                NR_SEQ_AREA_INT,
                                                                                                NR_SEQ_ESPEC_INT,
                                                                                                NR_SEQ_GRUPO_INT,
                                                                                                cd_dependente,
                                                                                                nr_seq_origem,
                                                                                                cd_convenio_glosa,
                                                                                                cd_categoria_glosa,
                                                                                                ie_origem_proc_ref,
                                                                                                ie_proc_unico_sus,
                                                                                                ie_origem_proc_refer,
                                                                                                ie_gerar_sem_proc_ref_sus,
                                                                                                ie_consiste_edicao_prior,
                                                                                                ie_tx_edicao_amb_regra,
                                                                                                ie_paciente_deficiente,
                                                                                                ie_estrangeiro,
                                                                                                ie_carater_inter_sus,
                                                                                                qt_dias_inter_final,
                                                                                                ie_beira_leito,
                                                                                                tx_ajuste_matmed,
                                                                                                tx_desconto,
                                                                                                ie_tipo_atend_bpa,
                                                                                                tx_adm,
                                                                                                ie_vinculo_medico,
                                                                                                vl_filme,
                                                                                                vl_auxiliares,
                                                                                                qt_dias_inter_inicio,
                                                                                                ie_entra_filme_neg,
                                                                                                ie_proc_qt_zero_sus,
                                                                                                ie_complexidade_sus,
                                                                                                vl_anestesista,
                                                                                                ie_consider_level,
                                                                                                vl_maxproc_regra_sus,
												nr_seq_estrutura
                                                                from      regra_ajuste_proc
                                                                where   cd_convenio = cd_convenio_orig_p
                                                                and        cd_estabelecimento = cd_estabelecimento_p
                                                                and        nr_sequencia = nr_seq_w
                                                                and        ((cd_procedimento IS NOT NULL AND cd_procedimento::text <> '') or (nr_seq_proc_interno IS NOT NULL AND nr_seq_proc_interno::text <> '') or (nr_seq_exame IS NOT NULL AND nr_seq_exame::text <> ''));

                                                                insert into regra_ajuste_proc_aviso(
                                                                                                nr_sequencia, nr_seq_regra, dt_atualizacao, nm_usuario, nm_usuario_aviso,
                                                                                                cd_perfil_aviso, dt_atualizacao_nrec, nm_usuario_nrec)
                                                                                SELECT    nextval('regra_ajuste_proc_aviso_seq'), nr_sequencia_w, clock_timestamp(),
                                                                                                nm_usuario_p, nm_usuario_aviso, cd_perfil_aviso, clock_timestamp(), nm_usuario_p
                                                                                from      regra_ajuste_proc_aviso
                                                                                where   nr_seq_regra = nr_seq_w;
                                                                end;
                                end loop;
                close c001;
                end;
elsif (nm_tabela_p = 'REGRA_AJUSTE_PROC(Estrutura)') then
                if (ie_excluir_p = 'S') then
                                delete   from      regra_ajuste_proc_aviso
                                where   nr_seq_regra in (SELECT nr_sequencia
                                                                                from   regra_ajuste_proc
                                                                         where         cd_convenio = cd_convenio_dest_p
                                                                                and       cd_estabelecimento = cd_estabelecimento_p
                                                                                and       coalesce(cd_procedimento::text, '') = ''
                                                                                and       coalesce(nr_seq_proc_interno::text, '') = '');
                                delete   from      regra_ajuste_proc
                                where   cd_convenio = cd_convenio_dest_p
                                and        cd_estabelecimento = cd_estabelecimento_p
                                and        coalesce(cd_procedimento::text, '') = ''
                                and        coalesce(nr_seq_proc_interno::text, '') = '';
                end if;
                begin
                open c001;
                                loop
                                fetch c001 into
                                                nr_seq_w;
                                EXIT WHEN NOT FOUND; /* apply on c001 */
                                                                begin
                                                                select    nextval('regra_ajuste_proc_seq')
                                                                into STRICT        nr_sequencia_w
;

                                                                                insert into regra_ajuste_proc(
                                                                                                nr_sequencia,
                                                                                                cd_estabelecimento,
                                                                                                cd_convenio,
                                                                                                dt_inicio_vigencia,
                                                                                                ie_situacao,
                                                                                                dt_atualizacao,
                                                                                                nm_usuario,
                                                                                                cd_categoria,
                                                                                                cd_edicao_amb,
                                                                                                cd_area_procedimento,
                                                                                                cd_especialidade,
                                                                                                cd_grupo_proc,
                                                                                                cd_procedimento,
                                                                                                ie_origem_proced,
                                                                                                ie_preco_informado,
                                                                                                vl_proc_ajustado,
                                                                                                ie_glosa,
                                                                                                cd_procedimento_esp,
                                                                                                tx_ajuste,
                                                                                                nr_seq_regra_preco,
                                                                                                dt_final_vigencia,
                                                                                                cd_tipo_acomodacao,
                                                                                                ie_tipo_atendimento,
                                                                                                cd_setor_atendimento,
                                                                                                vl_medico,
                                                                                                vl_custo_operacional,
                                                                                                qt_filme,
                                                                                                nr_auxiliares,
                                                                                                qt_porte_anestesico,
                                                                                                tx_ajuste_custo_oper,
                                                                                                tx_ajuste_medico,
                                                                                                tx_ajuste_filme,
                                                                                                ie_credenciado,
                                                                                                pr_glosa,
                                                                                                cd_cid,
                                                                                                qt_idade_min,
                                                                                                qt_idade_max,
                                                                                                nr_seq_proc_interno,
                                                                                                nr_seq_exame,
                                                                                                cd_plano,
                                                                                                ie_clinica,
                                                                                                cd_empresa_ref,
                                                                                                cd_motivo_exc_conta,
                                                                                                cd_medico,
                                                                                                ds_observacao,
                                                                                                tx_ajuste_partic,
                                                                                                vl_glosa,
                                                                                                ie_sexo,
                                                                                                ie_atend_retorno,
                                                                                                ie_autor_particular,
                                                                                                cd_equipamento,
                                                                                                ie_ignora_ch_edicao_amb,
                                                                                                ie_consiste_prescr,
                                                                                                ie_utiliza_video,
                                                                                                ie_spect,
                                                                                                cd_especialidade_medica,
                                                                                                ie_prior_edicao_ajuste,
                                                                                                ie_edicao_convenio,
                                                                                                cd_tabela_servico,
                                                                                                cd_dependente,
                                                                                                cd_convenio_glosa,
                                                                                                cd_categoria_glosa,
                                                                                                ie_origem_proc_ref,
                                                                                                ie_proc_unico_sus,
                                                                                                ie_origem_proc_refer,
                                                                                                ie_gerar_sem_proc_ref_sus,
                                                                                                ie_consiste_edicao_prior,
                                                                                                ie_tx_edicao_amb_regra,
                                                                                                ie_paciente_deficiente,
                                                                                                ie_estrangeiro,
                                                                                                ie_carater_inter_sus,
                                                                                                qt_dias_inter_final,
                                                                                                ie_beira_leito,
                                                                                                tx_ajuste_matmed,
                                                                                                tx_desconto,
                                                                                                ie_tipo_atend_bpa,
                                                                                                tx_adm,
                                                                                                ie_vinculo_medico,
                                                                                                qt_pos_inicial,
                                                                                                vl_auxiliares,
                                                                                                vl_filme,
                                                                                                qt_dias_inter_inicio,
                                                                                                ie_entra_filme_neg,
                                                                                                ie_proc_qt_zero_sus,
                                                                                                qt_pos_final,
                                                                                                ie_complexidade_sus,
                                                                                                vl_anestesista,
                                                                                                ie_consider_level,
                                                                                                vl_maxproc_regra_sus,
												nr_seq_estrutura)
                                                                SELECT    nr_sequencia_w,
                                                                                                cd_estabelecimento_p,
                                                                                                cd_convenio_dest_p,
                                                                                                dt_inicio_vigencia,
                                                                                                ie_situacao,
                                                                                                clock_timestamp(),
                                                                                                nm_usuario_p,
                                                                                                null,
                                                                                                cd_edicao_amb,
                                                                                                cd_area_procedimento,
                                                                                                cd_especialidade,
                                                                                                cd_grupo_proc,
                                                                                                cd_procedimento,
                                                                                                ie_origem_proced,
                                                                                                ie_preco_informado,
                                                                                                vl_proc_ajustado,
                                                                                                ie_glosa,
                                                                                                cd_procedimento_esp,
                                                                                                tx_ajuste,
                                                                                                nr_seq_regra_preco,
                                                                                                dt_final_vigencia,
                                                                                                cd_tipo_acomodacao,
                                                                                                ie_tipo_atendimento,
                                                                                                cd_setor_atendimento,
                                                                                                vl_medico,
                                                                                                vl_custo_operacional,
                                                                                                qt_filme,
                                                                                                nr_auxiliares,
                                                                                                qt_porte_anestesico,
                                                                                                tx_ajuste_custo_oper,
                                                                                                tx_ajuste_medico,
                                                                                                tx_ajuste_filme,
                                                                                                ie_credenciado,
                                                                                                pr_glosa,
                                                                                                cd_cid,
                                                                                                qt_idade_min,
                                                                                                qt_idade_max,
                                                                                                nr_seq_proc_interno,
                                                                                                nr_seq_exame,
                                                                                                null,
                                                                                                ie_clinica,
                                                                                                cd_empresa_ref,
                                                                                                cd_motivo_exc_conta,
                                                                                                cd_medico,
                                                                                                ds_observacao,
                                                                                                tx_ajuste_partic,
                                                                                                vl_glosa,
                                                                                                ie_sexo,
                                                                                                ie_atend_retorno,
                                                                                                ie_autor_particular,
                                                                                                cd_equipamento,
                                                                                                ie_ignora_ch_edicao_amb,
                                                                                                ie_consiste_prescr,
                                                                                                ie_utiliza_video,
                                                                                                ie_spect,
                                                                                                cd_especialidade_medica,
                                                                                                ie_prior_edicao_ajuste,
                                                                                                ie_edicao_convenio,
                                                                                                cd_tabela_servico,
                                                                                                cd_dependente,
                                                                                                cd_convenio_glosa,
                                                                                                cd_categoria_glosa,
                                                                                                ie_origem_proc_ref,
                                                                                                ie_proc_unico_sus,
                                                                                                ie_origem_proc_refer,
                                                                                                ie_gerar_sem_proc_ref_sus,
                                                                                                ie_consiste_edicao_prior,
                                                                                                ie_tx_edicao_amb_regra,
                                                                                                ie_paciente_deficiente,
                                                                                                ie_estrangeiro,
                                                                                                ie_carater_inter_sus,
                                                                                                qt_dias_inter_final,
                                                                                                ie_beira_leito,
                                                                                                tx_ajuste_matmed,
                                                                                                tx_desconto,
                                                                                                ie_tipo_atend_bpa,
                                                                                                tx_adm,
                                                                                                ie_vinculo_medico,
                                                                                                qt_pos_inicial,
                                                                                                vl_auxiliares,
                                                                                                vl_filme,
                                                                                                qt_dias_inter_inicio,
                                                                                                ie_entra_filme_neg,
                                                                                                ie_proc_qt_zero_sus,
                                                                                                qt_pos_final,
                                                                                                ie_complexidade_sus,
                                                                                                vl_anestesista,
                                                                                                ie_consider_level,
                                                                                                vl_maxproc_regra_sus,
												nr_seq_estrutura
                                                                from      regra_ajuste_proc
                                                                where   cd_convenio = cd_convenio_orig_p
                                                                and        cd_estabelecimento = cd_estabelecimento_p
                                                                and        nr_sequencia = nr_seq_w
                                                                and        coalesce(cd_procedimento::text, '') = ''
                                                                and        coalesce(nr_seq_proc_interno::text, '') = '';


                                                                end;
                                end loop;
                close c001;
                end;
elsif (nm_tabela_p = 'CONVENIO_REGRA_QTDE') then
                if (ie_excluir_p = 'S') then
                                delete   from      convenio_regra_qtde_tx
                                where   nr_seq_regra in (SELECT nr_sequencia
                                                                                from   convenio_regra_qtde
                                                                         where         cd_convenio = cd_convenio_dest_p
                                                                                and       cd_estabelecimento = cd_estabelecimento_p);
                                delete   from      convenio_regra_qtde
                                where   cd_convenio = cd_convenio_dest_p
                                and        cd_estabelecimento = cd_estabelecimento_p;
                end if;
                begin
                open c002;
                                loop
                                fetch c002 into
                                                nr_seq_w;
                                EXIT WHEN NOT FOUND; /* apply on c002 */
                                                                begin
                                                                select    nextval('convenio_regra_qtde_seq')
                                                                into STRICT        nr_sequencia_w
;

                                                                insert into convenio_regra_qtde(
                                                                                nr_sequencia, cd_estabelecimento, cd_convenio,
                                                                                dt_atualizacao, nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec,
                                                                                cd_procedimento, ie_origem_proced, cd_area_procedimento, cd_especialidade,
                                                                                cd_grupo_proc, ie_regra_execucao, nr_seq_proc_interno,           dt_vigencia, qt_min_regra_per, cd_setor_atendimento,
                                                                                ie_regra_valor, ie_lado, cd_edicao_amb, ie_responsavel_credito, ie_tipo_atendimento, ie_tipo_guia, cd_cgc_prestador,
                                                                                cd_medico_executor, ie_via_acesso, ie_tipo_data, ie_situacao, cd_tipo_procedimento)
                                                                SELECT    nr_sequencia_w, cd_estabelecimento_p, cd_convenio_dest_p,
                                                                                clock_timestamp(), nm_usuario_p, clock_timestamp(), nm_usuario_p, cd_procedimento, ie_origem_proced,
                                                                                cd_area_procedimento, cd_especialidade, cd_grupo_proc, ie_regra_execucao,
                                                                                nr_seq_proc_interno, dt_vigencia, qt_min_regra_per, cd_setor_atendimento,
                                                                                ie_regra_valor, ie_lado, cd_edicao_amb, ie_responsavel_credito, ie_tipo_atendimento, ie_tipo_guia, cd_cgc_prestador,
                                                                                cd_medico_executor, ie_via_acesso, ie_tipo_data, coalesce(ie_situacao,'A'), cd_tipo_procedimento
                                                                from      convenio_regra_qtde
                                                                where   cd_convenio = cd_convenio_orig_p
                                                                and        cd_estabelecimento = cd_estabelecimento_p
                                                                and        nr_sequencia = nr_seq_w;

                                                                insert into convenio_regra_qtde_tx(
                                                                                nr_sequencia, nr_seq_regra, dt_atualizacao, nm_usuario, dt_atualizacao_nrec,
                                                                                nm_usuario_nrec, qt_exec_min,  qt_exec_max, tx_procedimento, tx_custo_operacional, tx_medico, tx_auxiliar, tx_anestesista )
                                                                SELECT    nextval('convenio_regra_qtde_tx_seq'), nr_sequencia_w, clock_timestamp(), nm_usuario_p,
                                                                                clock_timestamp(), nm_usuario_p,                qt_exec_min, qt_exec_max, tx_procedimento, tx_custo_operacional, tx_medico, tx_auxiliar, tx_anestesista
                                                                from      convenio_regra_qtde_tx
                                                                where   nr_seq_regra = nr_seq_w;
                                                                end;
                                end loop;
                close c002;
                end;
elsif (nm_tabela_p = 'CONVENIO_SERVICO') then
                if (ie_excluir_p = 'S') then
                                delete   from      convenio_servico
                                where   cd_convenio = cd_convenio_dest_p
                                and        cd_estabelecimento = cd_estabelecimento_p;
                end if;

                begin
                open c003;
                loop
                                fetch c003 into
                                                cd_categoria_w,
                                                dt_liberacao_tabela_w,
                                                cd_tabela_servico_w,
                                                ie_situacao_w,
                                                nr_prioridade_w,
                                                dt_termino_w,
                                                tx_ajuste_geral_w,
					   nr_seq_tiss_tabela_w;
                                EXIT WHEN NOT FOUND; /* apply on c003 */
                                begin

                                insert into convenio_servico(
                                                                nr_sequencia, cd_estabelecimento, cd_convenio, cd_categoria, dt_liberacao_tabela,
                                                                cd_tabela_servico, dt_atualizacao, nm_usuario, ie_situacao, nr_prioridade, dt_termino,
                                                                tx_ajuste_geral, nr_seq_tiss_tabela)
                                values (nextval('convenio_servico_seq'), cd_estabelecimento_p,  cd_convenio_dest_p, cd_categoria_w, dt_liberacao_tabela_w,
                                                                cd_tabela_servico_w, clock_timestamp(), nm_usuario_p, ie_situacao_w, nr_prioridade_w, dt_termino_w,
                                                                tx_ajuste_geral_w, nr_seq_tiss_tabela_w);

                                end;
                end loop;
                close c003;
                end;
elsif (nm_tabela_p = 'CONVENIO_PRECO_MAT') then
                if (ie_excluir_p = 'S') then
                                delete   from      convenio_preco_mat
                                where   cd_convenio = cd_convenio_dest_p
                                and        cd_estabelecimento = cd_estabelecimento_p;
                end if;

                begin
                open c004;
                loop
                                fetch c004 into
                                                cd_categoria_w,
                                                dt_liberacao_tabela_w,
                                                cd_tab_preco_mat_w,
                                                tx_ajuste_tabela_mat_w,
                                                ie_situacao_w,
                                                nr_prioridade_w,
                                                ie_tab_adicional_w,
                                                dt_final_vigencia_w,
                                                dt_inicio_vigencia_w,
                                                cd_tab_mat_atualizacao_w,
                                                ie_integracao_opme_w;
                                EXIT WHEN NOT FOUND; /* apply on c004 */
                                begin

                                insert into convenio_preco_mat(
                                                cd_estabelecimento, cd_convenio, cd_categoria, dt_liberacao_tabela, cd_tab_preco_mat,
                                                dt_atualizacao, nm_usuario, tx_ajuste_tabela_mat, ie_situacao, nr_prioridade, ie_tab_adicional,
                                                dt_final_vigencia, dt_inicio_vigencia, cd_tab_mat_atualizacao, ie_integracao_opme)
                                values (cd_estabelecimento_p, cd_convenio_dest_p, cd_categoria_w, dt_liberacao_tabela_w,
                                                cd_tab_preco_mat_w, clock_timestamp(), nm_usuario_p, tx_ajuste_tabela_mat_w, ie_situacao_w,
                                                nr_prioridade_w, ie_tab_adicional_w, dt_final_vigencia_w, dt_inicio_vigencia_w,
                                                cd_tab_mat_atualizacao_w, ie_integracao_opme_w);
                                end;
                end loop;
                close c004;
                end;
elsif (nm_tabela_p = 'CONVENIO_BRASINDICE') then

                if (ie_excluir_p = 'S') then
                                delete from convenio_brasindice
                                where   cd_convenio                      = cd_convenio_dest_p
                                and        cd_estabelecimento       = cd_estabelecimento_p;
                end if;

                insert into convenio_brasindice(
                                cd_convenio, cd_categoria, dt_inicio_vigencia, tx_preco_fabrica, dt_atualizacao,
                                nm_usuario, tx_brasindice_pmc, ie_situacao, qt_dia_fixo, dt_base_fixo, cd_estabelecimento,
                                tx_pmc_neg, tx_pmc_pos, nr_sequencia, cd_grupo_material, cd_classe_material, cd_subgrupo_material,
                                nr_seq_estrutura, ie_tipo_material, tx_pfb_neg, tx_pfb_pos, ie_dividir_indice_pmc, ie_dividir_indice_pfb,
                                ie_tipo_atendimento, dt_final_vigencia, cd_plano, vl_minimo, vl_maximo, ie_solucao, ie_restrito)
                SELECT    cd_convenio_dest_p, cd_categoria, dt_inicio_vigencia, tx_preco_fabrica, clock_timestamp(),
                                nm_usuario_p, tx_brasindice_pmc, ie_situacao, qt_dia_fixo, dt_base_fixo, cd_estabelecimento_p,
                                tx_pmc_neg, tx_pmc_pos, nextval('convenio_brasindice_seq'), cd_grupo_material, cd_classe_material, cd_subgrupo_material,
                                nr_seq_estrutura, ie_tipo_material, tx_pfb_neg, tx_pfb_pos, ie_dividir_indice_pmc, ie_dividir_indice_pfb,
                                ie_tipo_atendimento, dt_final_vigencia, cd_plano, vl_minimo, vl_maximo, ie_solucao, ie_restrito
                from      convenio_brasindice
                where   cd_convenio                      = cd_convenio_orig_p
                and        cd_estabelecimento       = cd_estabelecimento_p
                and        coalesce(cd_categoria::text, '') = '';


                open c010;
                loop
                fetch c010 into
                                cd_categoria_w;
                EXIT WHEN NOT FOUND; /* apply on c010 */
                                begin

                                insert into convenio_brasindice(
                                                cd_convenio, cd_categoria, dt_inicio_vigencia, tx_preco_fabrica, dt_atualizacao,
                                                nm_usuario, tx_brasindice_pmc, ie_situacao, qt_dia_fixo, dt_base_fixo, cd_estabelecimento,
                                                tx_pmc_neg, tx_pmc_pos, nr_sequencia, cd_grupo_material, cd_classe_material, cd_subgrupo_material,
                                                nr_seq_estrutura, ie_tipo_material, tx_pfb_neg, tx_pfb_pos, ie_dividir_indice_pmc, ie_dividir_indice_pfb, ie_tipo_atendimento, vl_minimo, vl_maximo, ie_solucao, ie_restrito)
                                SELECT    cd_convenio_dest_p, cd_categoria, dt_inicio_vigencia, tx_preco_fabrica, clock_timestamp(),
                                                nm_usuario_p, tx_brasindice_pmc, ie_situacao, qt_dia_fixo, dt_base_fixo, cd_estabelecimento_p,
                                                tx_pmc_neg, tx_pmc_pos, nextval('convenio_brasindice_seq'), cd_grupo_material, cd_classe_material, cd_subgrupo_material,
                                                nr_seq_estrutura, ie_tipo_material, tx_pfb_neg, tx_pfb_pos, ie_dividir_indice_pmc, ie_dividir_indice_pfb , ie_tipo_atendimento, vl_minimo, vl_maximo, ie_solucao, ie_restrito
                                from      convenio_brasindice
                                where   cd_convenio                      = cd_convenio_orig_p
                                and        cd_estabelecimento       = cd_estabelecimento_p
                                and        cd_categoria                      = cd_categoria_w
                                and        (cd_categoria IS NOT NULL AND cd_categoria::text <> '');

                                end;
                end loop;
                close c010;

elsif (nm_tabela_p = 'CONVENIO_SIMPRO') then
                if (ie_excluir_p = 'S') then
                                delete from convenio_simpro
                                where   cd_convenio                      = cd_convenio_dest_p;
                end if;
                insert into convenio_simpro(
                                                nr_sequencia, cd_convenio, cd_categoria, dt_inicio_vigencia, dt_atualizacao, nm_usuario,
                                                tx_preco_fabrica, tx_pmc, ie_situacao, qt_dia_fixo, dt_base_fixo, dt_atualizacao_nrec,
                                                nm_usuario_nrec, ie_tipo_preco, cd_grupo_material, cd_classe_material, cd_subgrupo_material,
                                                TX_PFB_POS, TX_PMC_POS, TX_PFB_NEG, TX_PMC_NEG, vl_minimo, vl_maximo, ie_primeira_versao)
                SELECT                    nextval('convenio_simpro_seq'), cd_convenio_dest_p, cd_categoria, dt_inicio_vigencia, clock_timestamp(),
                                                nm_usuario_p, tx_preco_fabrica, tx_pmc, ie_situacao, qt_dia_fixo, dt_base_fixo, clock_timestamp(),
                                                nm_usuario_p, ie_tipo_preco, cd_grupo_material, cd_classe_material, cd_subgrupo_material,
                                                TX_PFB_POS, TX_PMC_POS, TX_PFB_NEG, TX_PMC_NEG, vl_minimo, vl_maximo, ie_primeira_versao
                from                      convenio_simpro
                where                   cd_convenio                      = cd_convenio_orig_p;
elsif (nm_tabela_p = 'CONVENIO_CARGA_PRECO') then
                if (ie_excluir_p = 'S') then
                                delete from convenio_carga_preco
                                where   cd_convenio                      = cd_convenio_dest_p;
                end if;
                insert into convenio_carga_preco(
                                                nr_sequencia, cd_convenio, dt_atualizacao, nm_usuario, cd_item_convenio, ds_item_convenio,
                                                cd_unid_med_convenio, vl_item_convenio, ie_status, cd_material, vl_atual, dt_atualizacao_nrec,
                                                nm_usuario_nrec)
                SELECT                    nextval('convenio_carga_preco_seq'), cd_convenio_dest_p, clock_timestamp(), nm_usuario_p, cd_item_convenio,
                                                ds_item_convenio, cd_unid_med_convenio, vl_item_convenio, ie_status, cd_material, vl_atual,
                                                clock_timestamp(), nm_usuario_p
                from                      convenio_carga_preco
                where                   cd_convenio                      = cd_convenio_orig_p;

elsif (nm_tabela_p = 'REGRA_AJUSTE_MATERIAL(Estrutura)') then
                if (ie_excluir_p = 'S') then
                                delete   from regra_ajuste_material
                                where   cd_convenio = cd_convenio_dest_p
                                and        cd_estabelecimento       = cd_estabelecimento_p
                                and        coalesce(cd_material::text, '') = '';
                end if;

                open c005;
                                loop
                                fetch c005 into  nr_sequencia_w,  dt_inicio_vigencia_w,                ie_situacao_w, cd_categoria_w,
                                                                cd_grupo_material_w, cd_subgrupo_material_w, cd_classe_material_w, cd_material_w,
                                                                tx_ajuste_w, vl_negociado_w, ie_preco_informado_w, ie_glosa_w,
                                                                tx_brasindice_pfb_w, tx_brasindice_pmc_w, tx_afaturar_w, dt_final_vigencia_w,
                                                                cd_tipo_acomodacao_w, ie_tipo_atendimento_w, cd_setor_atendimento_w, qt_idade_min_w,
                                                                qt_idade_max_w, tx_simpro_pfb_w, tx_simpro_pmc_w, ie_origem_preco_w,
                                                                ie_precedencia_preco_w, pr_glosa_w, ie_tipo_material_w, tx_pmc_neg_w,
                                                                tx_pmc_pos_w,                cd_cid_w, cd_tabela_preco_w, cd_motivo_exc_conta_w, ie_sexo_w, cd_plano_w, ie_autor_particular_w,
                                                                ie_kit_material_w, cd_kit_material_w, tx_pfb_neg_w, tx_pfb_pos_w, nr_seq_estrutura_w, cd_tipo_baixa_w,
                                                                ie_clinica_w, cd_convenio_glosa_w, cd_categoria_glosa_w, ie_tipo_preco_autor_w;
                                EXIT WHEN NOT FOUND; /* apply on c005 */

                                select    count(*)
                                into STRICT        qt_reg_w
                                from      categoria_convenio
                                where   cd_convenio      = cd_convenio_dest_p
                                and        cd_categoria      = cd_categoria_w;

                                if (qt_reg_w          > 0) or (coalesce(cd_categoria_w::text, '') = '') then
                                                select    nextval('regra_ajuste_material_seq')
                                                into STRICT        nr_seq_w
;

                                                insert    into regra_ajuste_material(
                                                                nr_sequencia, dt_inicio_vigencia, ie_situacao,    cd_categoria, cd_grupo_material,
                                                                cd_subgrupo_material, cd_classe_material, cd_material, tx_ajuste, vl_negociado,
                                                                ie_preco_informado, ie_glosa, tx_brasindice_pfb, tx_brasindice_pmc,
                                                                tx_afaturar, dt_final_vigencia, cd_tipo_acomodacao, ie_tipo_atendimento,
                                                                cd_setor_atendimento, qt_idade_min, qt_idade_max, tx_simpro_pfb, tx_simpro_pmc,
                                                                ie_origem_preco, ie_precedencia_preco, pr_glosa, ie_tipo_material, tx_pmc_neg,
                                                                tx_pmc_pos, cd_cid, cd_tabela_preco, cd_motivo_exc_conta, cd_estabelecimento,
                                                                cd_convenio,dt_atualizacao,nm_usuario, ie_sexo, ie_autor_particular, ie_kit_material, cd_kit_material,
                                                                tx_pfb_neg, tx_pfb_pos, nr_seq_estrutura, cd_tipo_baixa, ie_clinica, cd_convenio_glosa,
                                                                cd_categoria_glosa, ie_tipo_preco_autor)
                                                values (
                                                                nr_seq_w, dt_inicio_vigencia_w, ie_situacao_w, cd_categoria_w, cd_grupo_material_w,
                                                                cd_subgrupo_material_w, cd_classe_material_w, cd_material_w, tx_ajuste_w, vl_negociado_w,
                                                                ie_preco_informado_w, ie_glosa_w, tx_brasindice_pfb_w, tx_brasindice_pmc_w, tx_afaturar_w,
                                                                dt_final_vigencia_w, cd_tipo_acomodacao_w, ie_tipo_atendimento_w, cd_setor_atendimento_w,
                                                                qt_idade_min_w, qt_idade_max_w,  tx_simpro_pfb_w, tx_simpro_pmc_w, ie_origem_preco_w,
                                                                ie_precedencia_preco_w, pr_glosa_w, ie_tipo_material_w, tx_pmc_neg_w, tx_pmc_pos_w,
                                                                cd_cid_w, cd_tabela_preco_w, cd_motivo_exc_conta_w, cd_estabelecimento_p, cd_convenio_dest_p,
                                                                clock_timestamp(), nm_usuario_p, ie_sexo_w, ie_autor_particular_w, ie_kit_material_w, cd_kit_material_w,
                                                                tx_pfb_neg_w, tx_pfb_pos_w, nr_seq_estrutura_w, cd_tipo_baixa_w, ie_clinica_w, cd_convenio_glosa_w,
                                                                cd_categoria_glosa_w, ie_tipo_preco_autor_w);

                                                select    count(*)
                                                into STRICT        qt_ajuste_w
                                                from      regra_ajuste_indice_dif
                                                where   nr_seq_regra = nr_sequencia_w;

                                                if (coalesce(qt_ajuste_w,0) > 0) then
                                                                begin
                                                                open c006;
                                                                                loop
                                                                                fetch c006 into  vl_inicial_w,
                                                                                                vl_final_w,
                                                                                                tx_ajustedif_w,
                                                                                                ie_origem_preco_ww;
                                                                                EXIT WHEN NOT FOUND; /* apply on c006 */

                                                                                select    nextval('regra_ajuste_indice_dif_seq')
                                                                                into STRICT        nr_seq_ajuste_w
;

                                                                                insert    into regra_ajuste_indice_dif(
                                                                                                nr_sequencia, vl_inicial, vl_final,
                                                                                                tx_ajuste, nr_seq_regra, dt_atualizacao,
                                                                                                nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec,ie_origem_preco)
                                                                                values (
                                                                                                nr_seq_ajuste_w, vl_inicial_w, vl_final_w,
                                                                                                tx_ajustedif_w, nr_seq_w, clock_timestamp(), nm_usuario_p,
                                                                                                clock_timestamp(), nm_usuario_p,ie_origem_preco_ww);
                                                                                end loop;
                                                                close c006;
                                                                end;
                                                end if;
                                end if;
                                end loop;
                close c005;
elsif (nm_tabela_p = 'REGRA_AJUSTE_MATERIAL(Ajuste)') then
                if (ie_excluir_p = 'S') then
                                delete   from regra_ajuste_material
                                where   cd_convenio = cd_convenio_dest_p
                                and        cd_estabelecimento       = cd_estabelecimento_p
                                and        (cd_material IS NOT NULL AND cd_material::text <> '');
                end if;

                open c009;
                                loop
                                fetch c009 into  nr_sequencia_w,  dt_inicio_vigencia_w,                ie_situacao_w, cd_categoria_w,
                                                                cd_grupo_material_w, cd_subgrupo_material_w, cd_classe_material_w, cd_material_w,
                                                                tx_ajuste_w, vl_negociado_w, ie_preco_informado_w, ie_glosa_w,
                                                                tx_brasindice_pfb_w, tx_brasindice_pmc_w, tx_afaturar_w, dt_final_vigencia_w,
                                                                cd_tipo_acomodacao_w, ie_tipo_atendimento_w, cd_setor_atendimento_w, qt_idade_min_w,
                                                                qt_idade_max_w, tx_simpro_pfb_w, tx_simpro_pmc_w, ie_origem_preco_w,
                                                                ie_precedencia_preco_w, pr_glosa_w, ie_tipo_material_w, tx_pmc_neg_w,
                                                                tx_pmc_pos_w,                cd_cid_w, cd_tabela_preco_w, cd_motivo_exc_conta_w, ie_sexo_w, cd_plano_w, ie_autor_particular_w,
                                                                ie_kit_material_w, cd_kit_material_w, tx_pfb_neg_w, tx_pfb_pos_w, nr_seq_estrutura_w, cd_tipo_baixa_w,
                                                                ie_clinica_w, ie_tipo_preco_autor_w;

                                EXIT WHEN NOT FOUND; /* apply on c009 */

                                select    count(*)
                                into STRICT        qt_reg_w
                                from      categoria_convenio
                                where   cd_convenio      = cd_convenio_dest_p
                                and        cd_categoria      = cd_categoria_w;

                                if (qt_reg_w          > 0) or (coalesce(cd_categoria_w::text, '') = '') then
                                                select    nextval('regra_ajuste_material_seq')
                                                into STRICT        nr_seq_w
;

                                                insert    into regra_ajuste_material(
                                                                nr_sequencia, dt_inicio_vigencia, ie_situacao,    cd_categoria, cd_grupo_material,
                                                                cd_subgrupo_material, cd_classe_material, cd_material, tx_ajuste, vl_negociado,
                                                                ie_preco_informado, ie_glosa, tx_brasindice_pfb, tx_brasindice_pmc,
                                                                tx_afaturar, dt_final_vigencia, cd_tipo_acomodacao, ie_tipo_atendimento,
                                                                cd_setor_atendimento, qt_idade_min, qt_idade_max, tx_simpro_pfb, tx_simpro_pmc,
                                                                ie_origem_preco, ie_precedencia_preco, pr_glosa, ie_tipo_material, tx_pmc_neg,
                                                                tx_pmc_pos, cd_cid, cd_tabela_preco, cd_motivo_exc_conta, cd_estabelecimento,
                                                                cd_convenio,dt_atualizacao,nm_usuario, ie_sexo, ie_autor_particular, ie_kit_material, cd_kit_material,
                                                                tx_pfb_neg, tx_pfb_pos, nr_seq_estrutura, cd_tipo_baixa, ie_clinica, ie_tipo_preco_autor)
                                                values (
                                                                nr_seq_w, dt_inicio_vigencia_w, ie_situacao_w, cd_categoria_w, cd_grupo_material_w,
                                                                cd_subgrupo_material_w, cd_classe_material_w, cd_material_w, tx_ajuste_w, vl_negociado_w,
                                                                ie_preco_informado_w, ie_glosa_w, tx_brasindice_pfb_w, tx_brasindice_pmc_w, tx_afaturar_w,
                                                                dt_final_vigencia_w, cd_tipo_acomodacao_w, ie_tipo_atendimento_w, cd_setor_atendimento_w,
                                                                qt_idade_min_w, qt_idade_max_w,  tx_simpro_pfb_w, tx_simpro_pmc_w, ie_origem_preco_w,
                                                                ie_precedencia_preco_w, pr_glosa_w, ie_tipo_material_w, tx_pmc_neg_w, tx_pmc_pos_w,
                                                                cd_cid_w, cd_tabela_preco_w, cd_motivo_exc_conta_w, cd_estabelecimento_p, cd_convenio_dest_p,
                                                                clock_timestamp(), nm_usuario_p, ie_sexo_w, ie_autor_particular_w, ie_kit_material_w, cd_kit_material_w,
                                                                tx_pfb_neg_w, tx_pfb_pos_w, nr_seq_estrutura_w, cd_tipo_baixa_w, ie_clinica_w, ie_tipo_preco_autor_w);

                                                select    count(*)
                                                into STRICT        qt_ajuste_w
                                                from      regra_ajuste_indice_dif
                                                where   nr_seq_regra = nr_sequencia_w;

                                                if (coalesce(qt_ajuste_w,0) > 0) then
                                                                begin
                                                                open c006;
                                                                                loop
                                                                                fetch c006 into  vl_inicial_w,
                                                                                                vl_final_w,
                                                                                                tx_ajustedif_w,
                                                                                                ie_origem_preco_ww;
                                                                                EXIT WHEN NOT FOUND; /* apply on c006 */

                                                                                select    nextval('regra_ajuste_indice_dif_seq')
                                                                                into STRICT        nr_seq_ajuste_w
;

                                                                                insert    into regra_ajuste_indice_dif(
                                                                                                nr_sequencia, vl_inicial, vl_final,
                                                                                                tx_ajuste, nr_seq_regra, dt_atualizacao,
                                                                                                nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec,ie_origem_preco)
                                                                                values (
                                                                                                nr_seq_ajuste_w, vl_inicial_w, vl_final_w,
                                                                                                tx_ajustedif_w, nr_seq_w, clock_timestamp(), nm_usuario_p,
                                                                                                clock_timestamp(), nm_usuario_p,ie_origem_preco_ww );
                                                                                end loop;
                                                                close c006;
                                                                end;
                                                end if;
                                end if;
                                end loop;
                close c009;
/*fim alteracao rafael (em 09/05/2006 os33807)*/

elsif (nm_tabela_p = 'MAT_CONVENIO_REGRA_QTDE') then
                if (ie_excluir_p = 'S') then
                                delete   from      mat_convenio_regra_qtde_tx
                                where   nr_seq_regra in (SELECT nr_sequencia
                                                                                from   mat_convenio_regra_qtde
                                                                         where         cd_convenio = cd_convenio_dest_p
                                                                                and       cd_estabelecimento = cd_estabelecimento_p);
                                delete   from      mat_convenio_regra_qtde
                                where   cd_convenio = cd_convenio_dest_p
                                and        cd_estabelecimento = cd_estabelecimento_p;
                end if;
                begin
                open c007;
                                loop
                                fetch c007 into
                                                nr_seq_w;
                                EXIT WHEN NOT FOUND; /* apply on c007 */
                                                                begin
                                                                select    nextval('mat_convenio_regra_qtde_seq')
                                                                into STRICT        nr_sequencia_w
;

                                                                insert into mat_convenio_regra_qtde(
                                                                                nr_sequencia, cd_estabelecimento, dt_atualizacao, nm_usuario, dt_atualizacao_nrec,
                                                                                nm_usuario_nrec, cd_convenio, dt_vigencia, cd_material,
                                                                                cd_grupo_material, cd_subgrupo_material, cd_classe_material, ie_regra_execucao)
                                                                SELECT    nr_sequencia_w, cd_estabelecimento_p, clock_timestamp(), nm_usuario_p, clock_timestamp(),
                                                                                nm_usuario_p, cd_convenio_dest_p, dt_vigencia, cd_material,
                                                                                cd_grupo_material, cd_subgrupo_material, cd_classe_material, ie_regra_execucao
                                                                from      mat_convenio_regra_qtde
                                                                where   cd_convenio = cd_convenio_orig_p
                                                                and        cd_estabelecimento = cd_estabelecimento_p
                                                                and        nr_sequencia = nr_seq_w;

                                                                insert into mat_convenio_regra_qtde_tx(
                                                                                nr_sequencia, nr_seq_regra, dt_atualizacao, nm_usuario, dt_atualizacao_nrec,
                                                                                nm_usuario_nrec, qt_exec_min, qt_exec_max, tx_material)
                                                                SELECT    nextval('mat_convenio_regra_qtde_tx_seq'), nr_sequencia_w, clock_timestamp(), nm_usuario_p,
                                                                                clock_timestamp(), nm_usuario_p,                qt_exec_min, qt_exec_max, tx_material
                                                                from      mat_convenio_regra_qtde_tx
                                                                where   nr_seq_regra = nr_seq_w;
                                                                end;
                                end loop;
                close c007;
                end;
elsif (nm_tabela_p = 'CONVENIO_TAXA_SERVICO') then
                if (ie_excluir_p = 'S') then
                                delete   from convenio_taxa_servico
                                where   cd_convenio                      = cd_convenio_dest_p
                                and        cd_estabelecimento       = cd_estabelecimento_p;
                end if;
                insert into convenio_taxa_servico(
                                cd_estabelecimento, cd_convenio, cd_categoria, ie_taxa_servico, cd_taxa_servico, dt_atualizacao,
                                nm_usuario, qt_min_seghr_cirurgia, qt_min_tolerancia, ie_origem_proced, nr_seq_evento, nr_seq_proc_interno, ie_situacao)
                SELECT    cd_estabelecimento_p, cd_convenio_dest_p,  cd_categoria, ie_taxa_servico, cd_taxa_servico,
                                clock_timestamp(), nm_usuario_p, qt_min_seghr_cirurgia, qt_min_tolerancia, ie_origem_proced, nr_seq_evento, nr_seq_proc_interno, ie_situacao
                from      convenio_taxa_servico
                where   cd_convenio = cd_convenio_orig_p
                and        cd_estabelecimento       = cd_estabelecimento_p;
elsif (nm_tabela_p = 'CONVENIO_TAXA_CIRURGIA') then
                if (ie_excluir_p = 'S') then
                                delete   from convenio_taxa_cirurgia
                                where   cd_convenio                      = cd_convenio_dest_p
                                and        cd_estabelecimento       = cd_estabelecimento_p;
                end if;
                insert into convenio_taxa_cirurgia(
                                cd_estabelecimento, cd_convenio, cd_categoria, nr_porte_anestesico, cd_taxa_cirurgia, dt_atualizacao,
                                nm_usuario, ie_origem_proced, cd_setor_atendimento, ie_tipo_atendimento, nr_sequencia, ie_tipo_regra,
                                cd_tipo_acomodacao, nr_seq_proc_interno, qt_procedimento)
                SELECT    cd_estabelecimento_p, cd_convenio_dest_p,  cd_categoria, nr_porte_anestesico, cd_taxa_cirurgia,
                                clock_timestamp(), nm_usuario_p, ie_origem_proced, cd_setor_atendimento, ie_tipo_atendimento,
                                nextval('convenio_taxa_cirurgia_seq'), ie_tipo_regra, cd_tipo_acomodacao, nr_seq_proc_interno, qt_procedimento
                from      convenio_taxa_cirurgia
                where   cd_convenio = cd_convenio_orig_p
                and        cd_estabelecimento = cd_estabelecimento_p;
elsif (nm_tabela_p = 'TIPO_TAXA_CIRURGICA') then
                if (ie_excluir_p = 'S') then
                                delete   from      tipo_taxa_proced
                                where   nr_seq_tipo_taxa in (SELECT nr_sequencia
                                                                                    from   tipo_taxa_cirurgica
                                                                             where  cd_convenio = cd_convenio_dest_p
                                                                                     and    cd_estabelecimento = cd_estabelecimento_p);
                                delete   from      tipo_taxa_cirurgica
                                where   cd_convenio = cd_convenio_dest_p
                                and        cd_estabelecimento = cd_estabelecimento_p;
                end if;
                begin
                open c008;
                                loop
                                fetch c008 into
                                                nr_seq_w;
                                EXIT WHEN NOT FOUND; /* apply on c008 */
                                                                begin
                                                                select    nextval('tipo_taxa_cirurgica_seq')
                                                                into STRICT        nr_sequencia_w
;

                                                                insert into tipo_taxa_cirurgica(
                                                                                nr_sequencia, cd_estabelecimento, cd_convenio, dt_atualizacao, nm_usuario,
                                                                                cd_procedimento, ie_origem_proced, dt_vigencia, ie_situacao, qt_porte,
                                                                                dt_atualizacao_nrec, nm_usuario_nrec, cd_setor_atendimento, nr_seq_proc_interno)
                                                                SELECT    nr_sequencia_w, cd_estabelecimento_p,  cd_convenio_dest_p, clock_timestamp(), nm_usuario_p,
                                                                                cd_procedimento, ie_origem_proced, dt_vigencia, ie_situacao, qt_porte, clock_timestamp(),
                                                                                nm_usuario_p, cd_setor_atendimento, nr_seq_proc_interno
                                                                from      tipo_taxa_cirurgica
                                                                where   cd_convenio = cd_convenio_orig_p
                                                                and        cd_estabelecimento = cd_estabelecimento_p
                                                                and        nr_sequencia = nr_seq_w;

                                                                insert into tipo_taxa_proced(
                                                                                nr_sequencia, nr_seq_tipo_taxa, dt_atualizacao, nm_usuario, cd_procedimento,
                                                                                ie_origem_proced, dt_atualizacao_nrec, nm_usuario_nrec, cd_setor_atendimento)
                                                                SELECT    nextval('tipo_taxa_proced_seq'), nr_sequencia_w, clock_timestamp(),                 nm_usuario_p,
                                                                                cd_procedimento, ie_origem_proced, clock_timestamp(), nm_usuario_p, cd_setor_atendimento
                                                                from      tipo_taxa_proced
                                                                where   nr_seq_tipo_taxa = nr_seq_w;
                                                                end;
                                end loop;
                close c008;
                end;

elsif (nm_tabela_p = 'HEALTH_FUND_DRG') then
	if (ie_excluir_p = 'S') then
		delete
		from health_fund_drg
		where cd_health_fund = cd_convenio_dest_p
		and cd_estabelecimento = cd_estabelecimento_p;
	end if;

	insert into health_fund_drg(
					nr_sequencia,
					cd_estabelecimento,
					cd_health_fund,
					nm_usuario,
					dt_atualizacao,
					dt_start_validity,
					dt_end_validity,
					nr_seq_edition )
				SELECT nextval('health_fund_drg_seq'),
					cd_estabelecimento_p,
					cd_convenio_dest_p,
					nm_usuario_p,
					clock_timestamp(),
					dt_start_validity,
					dt_end_validity,
					nr_seq_edition
				from   health_fund_drg
				where  cd_health_fund = cd_convenio_orig_p
				and    cd_estabelecimento = cd_estabelecimento_p;

elsif (nm_tabela_p = 'HEALTH_FUND_PRICE_LEVEL') then
	if (ie_excluir_p = 'S') then
		delete
		from health_fund_price_level
		where cd_convenio = cd_convenio_dest_p
		and cd_estabelecimento = cd_estabelecimento_p;
	end if;

	insert into health_fund_price_level(
					nr_sequencia,
					cd_convenio,
					nm_usuario,
					dt_atualizacao,
					cd_level,
					dt_start_validity,
					dt_end_validity,
					vl_price,
					cd_estabelecimento)
				SELECT nextval('health_fund_price_level_seq'),
					cd_convenio_dest_p,
					nm_usuario_p,
					clock_timestamp(),
					cd_level,
					dt_start_validity,
					dt_end_validity,
					vl_price,
					cd_estabelecimento_p
				from   health_fund_price_level
				where  cd_convenio = cd_convenio_orig_p
				and    cd_estabelecimento = cd_estabelecimento_p;

elsif (nm_tabela_p = 'CONVENIO_TAXA_EXAME') then
                if (ie_excluir_p = 'S') then
                                delete   from convenio_taxa_exame
                                where   cd_convenio                      = cd_convenio_dest_p
                                and        cd_estabelecimento       = cd_estabelecimento_p;
                end if;
                insert into convenio_taxa_exame(
                                cd_estabelecimento, cd_convenio, cd_categoria, cd_procedimento, cd_taxa_exame, dt_atualizacao,
                                nm_usuario, ie_origem_proced, tx_procedimento, ie_criterio_taxa, ie_evento_calculo, ie_origem_taxa,
                                ie_regra_filme, nr_sequencia, cd_especialidade, cd_grupo_proc, cd_area_procedimento, ie_situacao)
                SELECT    cd_estabelecimento_p, cd_convenio_dest_p,  cd_categoria, cd_procedimento, cd_taxa_exame, clock_timestamp(),
                                nm_usuario_p, ie_origem_proced, tx_procedimento, ie_criterio_taxa, ie_evento_calculo, ie_origem_taxa,
                                ie_regra_filme, nextval('convenio_taxa_exame_seq'), cd_especialidade, cd_grupo_proc, cd_area_procedimento, ie_situacao
                from      convenio_taxa_exame
                where   cd_convenio = cd_convenio_orig_p
                and        cd_estabelecimento       = cd_estabelecimento_p;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copia_param_conv_precos ( cd_convenio_orig_p bigint, cd_convenio_dest_p bigint, nm_tabela_p text, nm_usuario_p text, ie_excluir_p text, cd_estabelecimento_p bigint) FROM PUBLIC;

