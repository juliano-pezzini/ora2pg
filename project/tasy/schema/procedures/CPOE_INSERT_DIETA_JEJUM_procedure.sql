-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cpoe_insert_dieta_jejum ( nr_atendimento_p bigint, nr_prescricao_p bigint, nr_seq_dieta_p bigint, nr_seq_tipo_P bigint, hr_prim_horario_p text, ie_inicio_p text, dt_inicio_p timestamp, qt_min_ant_p bigint, qt_min_depois_p bigint, qt_hora_ant_p bigint, qt_hora_depois_p bigint, nr_seq_objetivo_p bigint, dt_evento_p timestamp, dt_fim_p timestamp, cd_perfil_p bigint, nm_usuario_p text, dt_atualizacao_p timestamp, ds_evento_p text, ds_observacao_p text) AS $body$
DECLARE


ie_inicio_w					rep_jejum.ie_inicio%type;
ds_erro_w					varchar(2000);


BEGIN

ie_inicio_w := 'N';
if (ie_inicio_p in ('C','P')) then
	ie_inicio_w := 'F';
elsif (ie_inicio_p = 'R') then
	ie_inicio_w := 'C';
end if;

insert into rep_jejum(nr_sequencia,
			nr_prescricao,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_tipo,
			nr_seq_objetivo,
			ie_inicio,
			dt_inicio,
			qt_min_ant,
			qt_min_depois,
			dt_evento,
			ds_evento,
			ds_observacao,
			dt_fim,
			qt_hora_ant,
			qt_hora_depois,
			ie_suspenso,
			ie_repete_copia,
			nr_seq_anterior,
			nr_prescricao_original,
			nr_seq_dieta_cpoe)
values (
			nextval('rep_jejum_seq'),
			nr_prescricao_p,
			dt_atualizacao_p,
			nm_usuario_p,
			dt_atualizacao_p,
			nm_usuario_p,
			nr_seq_tipo_p,
			nr_seq_objetivo_p,
			ie_inicio_w,
			dt_inicio_p,
			qt_min_ant_p,
			qt_min_depois_p,
			dt_evento_p,
			ds_evento_p,
			substr(ds_observacao_p,1,255),
			dt_fim_p,
			qt_hora_ant_p,
			qt_hora_depois_p,
			'N',
			'N',
			null,
			null,
			nr_seq_dieta_p);

commit;

exception when others then
	CALL gravar_log_cpoe(substr('CPOE_INSERT_DIETA_JEJUM EXCEPTION:'|| substr(to_char(sqlerrm),1,2000)
		||'nr_seq_dieta_p: '||nr_seq_dieta_p||' nr_prescricao_p :'||nr_prescricao_p||'nr_atendimento_p: '||nr_atendimento_p||' nr_seq_tipo_P : '|| nr_seq_tipo_P
		||'hr_prim_horario_p:'|| hr_prim_horario_p||' ie_inicio_p : '|| ie_inicio_p||'dt_inicio_p:'|| to_char(dt_inicio_p,'dd/mm/yyyy hh24:mi:ss')
		||'qt_min_ant_p:'|| qt_min_ant_p||'qt_min_depois_p:'||qt_min_depois_p||'qt_hora_ant_p:'||qt_hora_ant_p
		||'qt_hora_depois_p:'||qt_hora_depois_p||'nr_seq_objetivo_p:'|| nr_seq_objetivo_p||'dt_evento_p:'|| dt_evento_p
		||'dt_fim_p:'|| dt_fim_p||'cd_perfil_p :'|| cd_perfil_p||'nm_usuario_p:'|| nm_usuario_p
		||'dt_atualizacao_p:'|| dt_atualizacao_p||'ds_evento_p:'||ds_evento_p||'ds_observacao_p:'||ds_observacao_p,1,2000),
		nr_atendimento_p, 'N', nr_seq_dieta_p);
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_insert_dieta_jejum ( nr_atendimento_p bigint, nr_prescricao_p bigint, nr_seq_dieta_p bigint, nr_seq_tipo_P bigint, hr_prim_horario_p text, ie_inicio_p text, dt_inicio_p timestamp, qt_min_ant_p bigint, qt_min_depois_p bigint, qt_hora_ant_p bigint, qt_hora_depois_p bigint, nr_seq_objetivo_p bigint, dt_evento_p timestamp, dt_fim_p timestamp, cd_perfil_p bigint, nm_usuario_p text, dt_atualizacao_p timestamp, ds_evento_p text, ds_observacao_p text) FROM PUBLIC;

