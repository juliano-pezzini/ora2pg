-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE prescr_proc_lab_atribexit_eup (nr_seq_exame_p bigint, cd_convenio_p bigint, cd_categoria_p text, ie_tipo_atendimento_p bigint, cd_estabelecimento_p bigint, ie_tipo_convenio_p bigint, nr_seq_proc_interno_p bigint, cd_material_exame_p text, nr_prescricao_p bigint, cd_setor_atendimento_p bigint, ie_rotina_p text, cd_perfil_p bigint, cd_medico_p bigint, cd_procedimento_p INOUT bigint, ie_origem_proced_p INOUT bigint, ds_procedimento_p INOUT text, ds_erro_p INOUT text, cd_setor_p INOUT bigint, qt_material_exame_p INOUT bigint, nr_agrupamento_p INOUT bigint, ie_proc_urgente_p INOUT text, cd_classif_setor_p INOUT bigint) AS $body$
BEGIN
SELECT * FROM obter_exame_lab_conv_eup_js(nr_seq_exame_p, cd_convenio_p, cd_categoria_p, ie_tipo_atendimento_p, cd_estabelecimento_p, ie_tipo_convenio_p, nr_seq_proc_interno_p, cd_material_exame_p, nr_prescricao_p, cd_procedimento_p, ie_origem_proced_p, ds_procedimento_p, ds_erro_p, cd_setor_p, qt_material_exame_p) INTO STRICT cd_procedimento_p, ie_origem_proced_p, ds_procedimento_p, ds_erro_p, cd_setor_p, qt_material_exame_p;
 
SELECT	MAX(nr_agrupamento) +1 nr_agrupamento, 
	obter_se_proc_urgente(cd_setor_atendimento_p, cd_procedimento_p, ie_origem_proced_p, nr_seq_proc_interno_p, nr_seq_exame_p, 1, ie_rotina_p, 
		cd_perfil_p, cd_medico_p) ie_proc_urgente, 
	obter_classif_setor(cd_setor_atendimento_p) cd_classif_setor 
into STRICT 	nr_agrupamento_p, 
		ie_proc_urgente_p, 
		cd_classif_setor_p 
FROM  prescr_procedimento 
WHERE  nr_prescricao = nr_prescricao_p;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE prescr_proc_lab_atribexit_eup (nr_seq_exame_p bigint, cd_convenio_p bigint, cd_categoria_p text, ie_tipo_atendimento_p bigint, cd_estabelecimento_p bigint, ie_tipo_convenio_p bigint, nr_seq_proc_interno_p bigint, cd_material_exame_p text, nr_prescricao_p bigint, cd_setor_atendimento_p bigint, ie_rotina_p text, cd_perfil_p bigint, cd_medico_p bigint, cd_procedimento_p INOUT bigint, ie_origem_proced_p INOUT bigint, ds_procedimento_p INOUT text, ds_erro_p INOUT text, cd_setor_p INOUT bigint, qt_material_exame_p INOUT bigint, nr_agrupamento_p INOUT bigint, ie_proc_urgente_p INOUT text, cd_classif_setor_p INOUT bigint) FROM PUBLIC;

