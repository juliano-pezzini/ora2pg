-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE w_tiss_insert_demonstra_itens ( nm_usuario_p text, nr_seq_demonstra_ret_p bigint, cd_prestador_exec_p pls_status_protocolo_tiss.cd_prestador_exec%type, cd_cgc_prest_exec_p pls_status_protocolo_tiss.cd_cgc_prest_exec%type, cd_cpf_prest_exec_p pls_status_protocolo_tiss.cd_cpf_prest_exec%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, cd_versao_p pls_status_protocolo_tiss.cd_versao%type, nr_seq_protocolo_p bigint, nr_seq_protocolo_enc_p INOUT pls_protocolo_conta.nr_sequencia%type) AS $body$
DECLARE


nr_seq_protocolo_w	w_tiss_demonstra_ret_itens.nr_seq_protocolo%type;	
ie_rec_glosa_w      varchar(1) := 'N';		


BEGIN

--Utiliza essa procedure para salvar a comunicacao e tambem buscar o protocolo TISS
nr_seq_protocolo_w := pls_gera_status_protocolo_tiss(nr_seq_protocolo_p, cd_prestador_exec_p, cd_cgc_prest_exec_p, cd_cpf_prest_exec_p, '', cd_estabelecimento_p, cd_versao_p, nm_usuario_p, nr_seq_protocolo_w);

/*Busca o protocolo conforme a function*/

ie_rec_glosa_w := pls_obter_prot_rec_glosa(nr_seq_protocolo_p, cd_cgc_prest_exec_p, cd_cpf_prest_exec_p, cd_prestador_exec_p, cd_estabelecimento_p);

insert into w_tiss_demonstra_ret_itens( nm_usuario, 		dt_atualizacao,  	nr_sequencia,
					nr_seq_demonstra_ret, 	nr_seq_protocolo,  	nr_protocolo,	
					ie_rec_glosa)
			       values ( nm_usuario_p,  		clock_timestamp(),  		nextval('w_tiss_demonstra_ret_itens_seq'),
					nr_seq_demonstra_ret_p, nr_seq_protocolo_w , 	nr_seq_protocolo_p,	
					ie_rec_glosa_w);
					
nr_seq_protocolo_enc_p	:= nr_seq_protocolo_w;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE w_tiss_insert_demonstra_itens ( nm_usuario_p text, nr_seq_demonstra_ret_p bigint, cd_prestador_exec_p pls_status_protocolo_tiss.cd_prestador_exec%type, cd_cgc_prest_exec_p pls_status_protocolo_tiss.cd_cgc_prest_exec%type, cd_cpf_prest_exec_p pls_status_protocolo_tiss.cd_cpf_prest_exec%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, cd_versao_p pls_status_protocolo_tiss.cd_versao%type, nr_seq_protocolo_p bigint, nr_seq_protocolo_enc_p INOUT pls_protocolo_conta.nr_sequencia%type) FROM PUBLIC;

