-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE dados_cirurgia_prot (nr_cirurgia_p bigint, nr_seq_pepo_p bigint, ds_anestesista_p INOUT text , cd_medico_anestesista_p INOUT text, nr_seq_proc_interno_p INOUT bigint, ds_procedimento_p INOUT text) AS $body$
DECLARE

	 
parametro        varchar(1);
cd_medico_anestesista_w varchar(10):='';
ds_anestesista_w    varchar(255) :='';
nr_seq_proc_interno_w  bigint   :=0;
param_estrutura_pepo_w varchar(1) :='N';
ds_procedimento_w    procedimento.ds_procedimento%TYPE :='';

BEGIN
	 
	if ((nr_seq_pepo_p IS NOT NULL AND nr_seq_pepo_p::text <> '') and nr_seq_pepo_p > 0) then 
		 
		select cd_medico_anestesista, 
			  substr(obter_nome_pf(cd_medico_anestesista),1,255)ds_anestesia 
		into STRICT  cd_medico_anestesista_w,	 
			  ds_anestesista_w 
		from  pepo_cirurgia 
		where nr_sequencia = nr_seq_pepo_p;
	 
	elsif ((nr_cirurgia_p IS NOT NULL AND nr_cirurgia_p::text <> '') and nr_cirurgia_p > 0) then 
		 
		select cd_medico_anestesista, 
			  substr(obter_nome_pf(cd_medico_anestesista),1,255)ds_anestesia, 
			  nr_seq_proc_interno, 
			  substr(obter_exame_agenda(cd_procedimento_princ, ie_origem_proced, nr_seq_proc_interno),1,255) 
		into STRICT  cd_medico_anestesista_w, 
			  ds_anestesista_w, 
			  nr_seq_proc_interno_w, 
			  ds_procedimento_w 
		from  cirurgia 
		where nr_cirurgia = nr_cirurgia_p;
		 
  end if;
 
ds_anestesista_p    := substr(ds_anestesista_w,1,255);
cd_medico_anestesista_p := cd_medico_anestesista_w;
nr_seq_proc_interno_p  := nr_seq_proc_interno_w;
ds_procedimento_p    := substr(ds_procedimento_w,1,255);
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE dados_cirurgia_prot (nr_cirurgia_p bigint, nr_seq_pepo_p bigint, ds_anestesista_p INOUT text , cd_medico_anestesista_p INOUT text, nr_seq_proc_interno_p INOUT bigint, ds_procedimento_p INOUT text) FROM PUBLIC;

