-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_alterar_motivo_requisicao ( nr_seq_requisicao_p bigint, nr_seq_motivo_alt_p bigint, nm_usuario_p text) AS $body$
DECLARE


/*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:   Realizar alteracao do campo motivo da requisicao
----------------------------------------------------------------------------------------------------------------------------------------------------
Locais de chamada direta: 
[  ]  Objetos do dicionario [ x ] Tasy (Delphi/Java) [ ] Portal [  ] Relatorios [ ] Outros: HTML5
 ----------------------------------------------------------------------------------------------------------------------------------------------------
Pontos de atencao: Cuidar com a performance
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/ds_motivo_alteracao_w 		pls_motivo_inc_requisicao.ds_motivo_inclusao%type;
ds_motivo_requisicao_w		pls_motivo_inc_requisicao.ds_motivo_inclusao%type;


BEGIN
if (nr_seq_requisicao_p IS NOT NULL AND nr_seq_requisicao_p::text <> '') and (nr_seq_motivo_alt_p IS NOT NULL AND nr_seq_motivo_alt_p::text <> '') then
	
	select	max(ds_motivo_inclusao)
	into STRICT	ds_motivo_alteracao_w
	from	pls_motivo_inc_requisicao
	where	nr_sequencia = nr_seq_motivo_alt_p;
	
	select	max(ds_motivo_inclusao)
	into STRICT	ds_motivo_requisicao_w
	from	pls_motivo_inc_requisicao
	where	nr_sequencia = (	SELECT	max(nr_seq_motivo_inclusao)
					from	pls_requisicao
					where	nr_sequencia = nr_seq_requisicao_p);
					
	update	pls_requisicao
	set	nr_seq_motivo_inclusao = nr_seq_motivo_alt_p
	where	nr_sequencia = nr_seq_requisicao_p;
					
	CALL pls_requisicao_gravar_hist(nr_seq_requisicao_p,'L',substr(wheb_mensagem_pck.get_texto(1117723,'DS_MOTIVO_ANTIGO='||ds_motivo_requisicao_w||';DS_MOTIVO_NOVO='||ds_motivo_alteracao_w),1,4000),null,nm_usuario_p);
	
	commit;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_alterar_motivo_requisicao ( nr_seq_requisicao_p bigint, nr_seq_motivo_alt_p bigint, nm_usuario_p text) FROM PUBLIC;

