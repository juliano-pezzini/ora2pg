-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE calcular_escala_pim3_md ( ie_resposta_pupilas_p text, ie_adm_eletiva_p text, ie_ventilacao_mecanica_p text, qt_base_excess_p bigint, qt_pa_sitolica_p bigint, qt_rel_fio2_p bigint, qt_rel_pao2_p bigint, ie_proc_recuperacao_p text, ie_cirurgia_cardiaca_p text, ie_diag_altissimo_risco_p bigint, ie_diag_alto_risco_p bigint, ie_diag_baixo_risco_p text, qt_pto_resp_pupilas_p INOUT bigint, qt_pto_adm_eletiva_p INOUT bigint, qt_pto_vent_mec_p INOUT bigint, qt_pto_ph_sangue_p INOUT bigint, qt_pto_pa_sistolica_p INOUT bigint, qt_pto_pao2_fio2_p INOUT bigint, qt_pto_proc_recup_p INOUT bigint, qt_pto_diag_alto_risco_p INOUT bigint, qt_tx_mortalidade_p INOUT bigint ) AS $body$
DECLARE


  qt_pto_pa_sistolica_2_w double precision := 0;
  qt_pa_sitolica_w        smallint;
  qt_fio2_pao2_w          double precision := 0;
  logit_w                 double precision := 0;
  qt_pontuacao_w          double precision := 0;


BEGIN

	if (ie_resposta_pupilas_p = 'N') then
	  qt_pto_resp_pupilas_p := 0;
	elsif (ie_resposta_pupilas_p = 'S') then
	  qt_pto_resp_pupilas_p := 3.8233;
	else
	  qt_pto_resp_pupilas_p := 0;
	end if;

	if (ie_adm_eletiva_p = 'N') then
	  qt_pto_adm_eletiva_p := 0;
	elsif (ie_adm_eletiva_p = 'S') then
	  qt_pto_adm_eletiva_p := -0.5378;
	else
	  qt_pto_adm_eletiva_p := 0;
	end if;

	if (ie_ventilacao_mecanica_p = 'N') then
	  qt_pto_vent_mec_p := 0;
	elsif (ie_ventilacao_mecanica_p = 'S') then
	  qt_pto_vent_mec_p := 0.9763;
	else
	  qt_pto_vent_mec_p := 0;
	end if;

	if (qt_base_excess_p IS NOT NULL AND qt_base_excess_p::text <> '') then
	  qt_pto_ph_sangue_p := (qt_base_excess_p * 0.0671);
	else
	  qt_pto_ph_sangue_p := 0;
	end if;

	if (coalesce(qt_pa_sitolica_p::text, '') = '') then
	  qt_pa_sitolica_w := 120;
	else
	  qt_pa_sitolica_w := qt_pa_sitolica_p;
	end if;

	qt_pto_pa_sistolica_p := (qt_pa_sitolica_w * -0.0431);

	qt_pto_pa_sistolica_2_w := (0.1716 * (dividir_md((qt_pa_sitolica_w * qt_pa_sitolica_w), 1000)));

	if (coalesce(qt_rel_fio2_p::text, '') = '') or (coalesce(qt_rel_pao2_p::text, '') = '') then
	  qt_pto_pao2_fio2_p := 0.23;
	else
	  qt_fio2_pao2_w := dividir_md(dividir_md(qt_rel_fio2_p, 100), qt_rel_pao2_p) * 100;
	  qt_pto_pao2_fio2_p := qt_fio2_pao2_w * 0.4214;
	end if;
	
	if (ie_proc_recuperacao_p = 'N') then
	  qt_pto_proc_recup_p := 0;
	elsif (ie_proc_recuperacao_p = 'S') and (ie_cirurgia_cardiaca_p = 'S')then
	  qt_pto_proc_recup_p := -1.2246;
	elsif (ie_proc_recuperacao_p = 'S') and (ie_cirurgia_cardiaca_p = 'N')then
	  qt_pto_proc_recup_p := -0.8762;
	else
	  qt_pto_proc_recup_p := -1.5164;
	end if;

	if (coalesce(ie_diag_altissimo_risco_p, 0) = 0 ) and (coalesce(ie_diag_alto_risco_p, 0) = 0) and (coalesce(ie_diag_baixo_risco_p, 0) = 0) then
	  qt_pto_diag_alto_risco_p := 0;
	elsif (coalesce(ie_diag_altissimo_risco_p, 0) = 0) and (coalesce(ie_diag_alto_risco_p, 0) = 0) and ((ie_diag_baixo_risco_p = '1') or (ie_diag_baixo_risco_p = '2') or (ie_diag_baixo_risco_p = '3') or (ie_diag_baixo_risco_p = '4') or (ie_diag_baixo_risco_p = '5') or (ie_diag_baixo_risco_p = '6')) then
	  qt_pto_diag_alto_risco_p := -2.1766;
	elsif (coalesce(ie_diag_altissimo_risco_p, 0) = 0) and ((ie_diag_alto_risco_p = '1') or (ie_diag_alto_risco_p = '2') or (ie_diag_alto_risco_p = '3') or (ie_diag_alto_risco_p = '4') or (ie_diag_alto_risco_p = '5')) then
	  qt_pto_diag_alto_risco_p := 1.0725;
	elsif ((ie_diag_altissimo_risco_p = '1') or (ie_diag_altissimo_risco_p = '2') or (ie_diag_altissimo_risco_p = '3') or (ie_diag_altissimo_risco_p = '4') or (ie_diag_altissimo_risco_p = '5')) then
	  qt_pto_diag_alto_risco_p := 1.6225;
	else
	  qt_pto_diag_alto_risco_p := 0;
	end if;

	qt_pontuacao_w := coalesce(qt_pto_resp_pupilas_p, 0) + coalesce(qt_pto_adm_eletiva_p, 0) + coalesce(qt_pto_vent_mec_p, 0) + coalesce(qt_pto_ph_sangue_p, 0) +
	                  coalesce(qt_pto_pa_sistolica_p, 0) + coalesce(qt_pto_pao2_fio2_p, 0) + coalesce(qt_pto_proc_recup_p, 0) + coalesce(qt_pto_diag_alto_risco_p, 0) +
					  coalesce(qt_pto_pa_sistolica_2_w,0);


	logit_w :=  qt_pontuacao_w - 1.7928;

	qt_tx_mortalidade_p := dividir_md(exp(logit_w), 1 + exp(logit_w)) * 100;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE calcular_escala_pim3_md ( ie_resposta_pupilas_p text, ie_adm_eletiva_p text, ie_ventilacao_mecanica_p text, qt_base_excess_p bigint, qt_pa_sitolica_p bigint, qt_rel_fio2_p bigint, qt_rel_pao2_p bigint, ie_proc_recuperacao_p text, ie_cirurgia_cardiaca_p text, ie_diag_altissimo_risco_p bigint, ie_diag_alto_risco_p bigint, ie_diag_baixo_risco_p text, qt_pto_resp_pupilas_p INOUT bigint, qt_pto_adm_eletiva_p INOUT bigint, qt_pto_vent_mec_p INOUT bigint, qt_pto_ph_sangue_p INOUT bigint, qt_pto_pa_sistolica_p INOUT bigint, qt_pto_pao2_fio2_p INOUT bigint, qt_pto_proc_recup_p INOUT bigint, qt_pto_diag_alto_risco_p INOUT bigint, qt_tx_mortalidade_p INOUT bigint ) FROM PUBLIC;

