-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE adiciona_atualiza_img_ferida ( ds_arquivo_p cur_ferida_imagem_risk.ds_arquivo%type, dt_atualizacao_p cur_ferida_imagem_risk.dt_atualizacao%type, nm_usuario_p cur_ferida_imagem_risk.nm_usuario%type, dt_atualizacao_nrec_p cur_ferida_imagem_risk.dt_atualizacao_nrec%type, nm_usuario_nrec_p cur_ferida_imagem_risk.nm_usuario_nrec%type, cd_pessoa_fisica_p cur_ferida_imagem_risk.cd_pessoa_fisica%type, nr_atendimento_p cur_ferida_imagem_risk.nr_atendimento%type) AS $body$
DECLARE

    existe_w smallint;

BEGIN
    select count(*) into STRICT existe_w
    where exists (SELECT * FROM cur_ferida_imagem_risk where nr_atendimento = nr_atendimento_p);
    IF existe_w = 1 THEN
        update cur_ferida_imagem_risk set   ds_arquivo = ds_arquivo_p,
                                            dt_atualizacao_nrec = dt_atualizacao_nrec_p,
                                            nm_usuario_nrec = nm_usuario_nrec
        where nr_atendimento = nr_atendimento_p;
    ELSE
        insert into cur_ferida_imagem_risk(   nr_sequencia,
                                                ds_arquivo, 
                                                dt_atualizacao, 
                                                nm_usuario, 
                                                dt_atualizacao_nrec, 
                                                nm_usuario_nrec, 
                                                cd_pessoa_fisica, 
                                                nr_atendimento) 
        values (   nextval('cur_ferida_imagem_risk_seq'),
                                                ds_arquivo_p,
                                                dt_atualizacao_p,
                                                nm_usuario_p,
                                                null,
                                                null,
                                                cd_pessoa_fisica_p,
                                                nr_atendimento_p);
    END IF;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE adiciona_atualiza_img_ferida ( ds_arquivo_p cur_ferida_imagem_risk.ds_arquivo%type, dt_atualizacao_p cur_ferida_imagem_risk.dt_atualizacao%type, nm_usuario_p cur_ferida_imagem_risk.nm_usuario%type, dt_atualizacao_nrec_p cur_ferida_imagem_risk.dt_atualizacao_nrec%type, nm_usuario_nrec_p cur_ferida_imagem_risk.nm_usuario_nrec%type, cd_pessoa_fisica_p cur_ferida_imagem_risk.cd_pessoa_fisica%type, nr_atendimento_p cur_ferida_imagem_risk.nr_atendimento%type) FROM PUBLIC;

