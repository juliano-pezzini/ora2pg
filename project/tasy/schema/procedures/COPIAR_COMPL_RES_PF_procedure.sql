-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copiar_compl_res_pf (cd_pessoa_origem_p text, ie_tipo_complemento_p bigint, nm_usuario_p text) AS $body$
DECLARE


qt_compl_w	bigint;
qt_compl_res_w	bigint;
nr_sequencia_w	bigint;


BEGIN
if (cd_pessoa_origem_p IS NOT NULL AND cd_pessoa_origem_p::text <> '') then
	select	coalesce(count(*),0)
	into STRICT	qt_compl_w
	from	compl_pessoa_fisica
	where	cd_pessoa_fisica	= cd_pessoa_origem_p
	and	ie_tipo_complemento	= ie_tipo_complemento_p;

	if (coalesce(qt_compl_w,0) = 0) then
		select	coalesce(max(nr_sequencia),0) + 1
		into STRICT 	nr_sequencia_w
		from 	compl_pessoa_fisica
		where 	cd_pessoa_fisica = cd_pessoa_origem_p;


		select	coalesce(count(*),0)
		into STRICT	qt_compl_res_w
		from	compl_pessoa_fisica
		where	cd_pessoa_fisica	= cd_pessoa_origem_p
		and	ie_tipo_complemento	= 1;

		if (coalesce(qt_compl_res_w,0) > 0) then

			insert into compl_pessoa_fisica(
								cd_pessoa_fisica,
								nr_sequencia,
								ie_tipo_complemento,
								dt_atualizacao,
								nm_usuario,
								nm_contato,
								cd_cep,
								ds_endereco,
								ds_complemento,
								nr_endereco,
								ds_bairro,
								ds_municipio,
								cd_municipio_ibge,
								sg_estado,
								nr_telefone,
								nr_ramal,
								ds_fone_adic,
								ds_fax,
								ds_observacao,
								cd_tipo_logradouro,
								ds_email,
								nr_seq_pais,
								cd_zona_procedencia,
								nr_ddi_telefone,
								nr_ddd_telefone,
								nr_ddi_fax,
								nr_ddd_fax,
								nr_ddd_fone_adic,
								cd_profissao,
								cd_empresa_refer,
								ie_nao_possui_email,
								ie_obriga_email,
								ie_nf_correio,
								ie_mala_direta)
								(SELECT	cd_pessoa_origem_p,
									nr_sequencia_w,
									ie_tipo_complemento_p,
									clock_timestamp(),
									nm_usuario_p,
									b.nm_contato,
									b.cd_cep,
									b.ds_endereco,
									b.ds_complemento,
									b.nr_endereco,
									b.ds_bairro,
									b.ds_municipio,
									b.cd_municipio_ibge,
									b.sg_estado,
									b.nr_telefone,
									b.nr_ramal,
									b.ds_fone_adic,
									b.ds_fax,
									b.ds_observacao,
									b.cd_tipo_logradouro,
									b.ds_email,
									b.nr_seq_pais,
									b.cd_zona_procedencia,
									b.nr_ddi_telefone,
									b.nr_ddd_telefone,
									b.nr_ddi_fax,
									b.nr_ddd_fax,
									b.nr_ddd_fone_adic,
									b.cd_profissao,
									b.cd_empresa_refer,
									b.ie_nao_possui_email,
									b.ie_obriga_email,
									b.ie_nf_correio,
									b.ie_mala_direta
								from	compl_pessoa_fisica b
								where	b.cd_pessoa_fisica	= cd_pessoa_origem_p
								and	b.ie_tipo_complemento	= 1);
		end if;

	end if;
end if;
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copiar_compl_res_pf (cd_pessoa_origem_p text, ie_tipo_complemento_p bigint, nm_usuario_p text) FROM PUBLIC;

