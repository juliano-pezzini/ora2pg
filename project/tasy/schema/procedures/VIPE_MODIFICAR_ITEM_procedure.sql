-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE vipe_modificar_item ( nr_prescricao_p bigint, nr_prescricoes_p text, cd_intervalo_p text, hr_prim_horario_p timestamp, cd_item_p bigint, ds_dose_diferenciada_p text, ds_horarios_p INOUT text, ds_horarios3_p INOUT text) AS $body$
DECLARE

 
nr_prescricao_w		bigint := 0;
dt_inicio_prescr_w	timestamp;
nr_horas_validade_w	integer;
ds_horarios2_w		varchar(255);
nr_intervalo_w		real;
				

BEGIN 
 
if (nr_prescricao_p IS NOT NULL AND nr_prescricao_p::text <> '') then 
	nr_prescricao_w	:= nr_prescricao_p;
else 
	nr_prescricao_w	:= Obter_Max_NrPrescricao(nr_prescricoes_p);
end if;
 
if (coalesce(nr_prescricao_w::text, '') = '')then 
	nr_prescricao_w	:= 0;
end if;
 
select	max(dt_inicio_prescr) 
into STRICT	dt_inicio_prescr_w 
from	prescr_medica 
where	nr_prescricao in (nr_prescricoes_p);
 
select	max(nr_horas_validade) 
into STRICT	nr_horas_validade_w 
from	prescr_medica 
where	nr_prescricao in (nr_prescricoes_p);
 
SELECT * FROM calcular_horario_prescricao(nr_prescricao_w, cd_intervalo_p, dt_inicio_prescr_w, hr_prim_horario_p, nr_horas_validade_w, cd_item_p, 0, 0, nr_intervalo_w, ds_horarios_p, ds_horarios2_w, 'N', ds_dose_diferenciada_p) INTO STRICT nr_intervalo_w, ds_horarios_p, ds_horarios2_w;
 
ds_horarios3_p		:= substr(ds_horarios_p || ds_horarios2_w,1,255);
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE vipe_modificar_item ( nr_prescricao_p bigint, nr_prescricoes_p text, cd_intervalo_p text, hr_prim_horario_p timestamp, cd_item_p bigint, ds_dose_diferenciada_p text, ds_horarios_p INOUT text, ds_horarios3_p INOUT text) FROM PUBLIC;

