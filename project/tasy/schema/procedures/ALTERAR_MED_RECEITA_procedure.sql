-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE alterar_med_receita ( nr_sequencia_p bigint, texto_p text, nm_usuario_p text ) AS $body$
DECLARE



ds_texto_banco_w	text;
qtd bigint		:= 0;

BEGIN

select 	ds_receita
into STRICT	ds_texto_banco_w
from 	med_receita
where	nr_sequencia	=	nr_sequencia_p;

if ( ds_texto_banco_w = ' ' ) then

	ds_texto_banco_w := '{\rtf1\ansi\deff0{\fonttbl{\f0\fnil\fcharset0 MS Sans Serif;}}{\colortbl ;\red0\green0\blue0;}\viewkind4\uc1\pard\cf1\lang1046\f0\fs24 ';

else
-- Tirar a Ãºltima chave
	FOR contador IN REVERSE length(ds_texto_banco_w)..1 loop
		qtd := qtd + 1;
		if ( substr(ds_texto_banco_w,contador,1) = '}' ) then
			exit;
		end if;
	end loop;

	ds_texto_banco_w := substr(ds_texto_banco_w, 0, length(ds_texto_banco_w) - qtd) || '\par';

end if;


ds_texto_banco_w := ds_texto_banco_w || texto_p || ' \par }';

update 	med_receita
set	ds_receita		= 	ds_texto_banco_w,
	dt_atualizacao		=	clock_timestamp(),
	nm_usuario		=	nm_usuario_p
where	nr_sequencia		=	nr_sequencia_p;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE alterar_med_receita ( nr_sequencia_p bigint, texto_p text, nm_usuario_p text ) FROM PUBLIC;

