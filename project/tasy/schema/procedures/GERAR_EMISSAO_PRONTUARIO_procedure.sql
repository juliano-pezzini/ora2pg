-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_emissao_prontuario (nr_sequencia_p bigint, nr_atendimento_p bigint, cd_pessoa_fisica_p text, nm_usuario_p text, nr_seq_episodio_p bigint default null) AS $body$
DECLARE



cd_profissional_w				prontuario_emissao_dados.cd_profissional%type;
cd_pessoa_fisica_w      			pessoa_fisica.cd_pessoa_fisica%type;
dt_registro_w				prontuario_emissao_item.dt_registro%type;
nm_pessoa_fisica_w			tasy_log_alt_campo.ds_valor_old%type;
nm_pessoa_fisica_new_w			tasy_log_alt_campo.ds_valor_new%type;
nm_escala_w				varchar(255);
ie_sexo_new_w				tasy_log_alt_campo.ds_valor_new%type;
ie_sexo_w				tasy_log_alt_campo.ds_valor_old%type;
nr_sequencia_w				prontuario_emissao_dados.nr_sequencia%type;
ds_pontuacao_w				prontuario_emissao_dados.ds_pontuacao%type;
qt_pontuacao_w				vice_escala.nm_atributo_inf%type;
ds_sql_w					varchar(4000);
ie_lib_desfecho_w				parametro_medico.ie_liberar_desfecho%type;
ie_lib_escala_w				varchar(1);
	
ie_anamnese_w				prontuario_emissao.ie_anamnese%type;
ie_evolucao_w				prontuario_emissao.ie_evolucao%type;
ie_diagnostico_w				prontuario_emissao.ie_diagnostico%type;
ie_atestado_w				prontuario_emissao.ie_atestado%type;
ie_sinais_vitais_w				prontuario_emissao.ie_sinais_vitais%type;
ie_prescricao_w				prontuario_emissao.ie_prescricao%type;
ie_exame_lab_w				prontuario_emissao.ie_exame_lab%type;
ie_laudo_w				prontuario_emissao.ie_laudo%type;
ie_historico_saude_w			prontuario_emissao.ie_historico_saude%type;
ie_oftalmologia_w				prontuario_emissao.ie_oftalmologia%type;
ie_orientacao_alta_w			prontuario_emissao.ie_orientacao_alta%type;
ie_orientacoes_gerais_w			prontuario_emissao.ie_orientacoes_gerais%type;
ie_parecer_medico_w			prontuario_emissao.ie_parecer_medico%type;
ie_receita_w				prontuario_emissao.ie_receita%type;
ie_sae_w					prontuario_emissao.ie_sae%type;
ie_solic_exame_ext_w			prontuario_emissao.ie_solic_exame_ext%type;
ie_declaracao_receb_w			prontuario_emissao.ie_declaracao_receb%type;
ie_consentimento_w			prontuario_emissao.ie_consentimento%type;
ie_tipo_item_w				prontuario_emissao_item.ie_tipo_item%type;
dt_inicio_w				prontuario_emissao.dt_inicial%type;
dt_inicio_ww      varchar(255);
dt_final_ww   varchar(255);
dt_final_w				prontuario_emissao.dt_final%type;
cd_estabelecimento_w			atendimento_paciente.cd_estabelecimento%type;
ie_lib_anamnese_w				parametro_medico.ie_lib_anamnese%type;
ie_lib_evolucao_w				varchar(1);
ie_lib_atestado_w				parametro_medico.ie_lib_atestado%type;
ie_lib_diag_medico_w			parametro_medico.ie_lib_diag_medico%type;
ie_lib_sinal_vital_w				parametro_medico.ie_lib_sinal_vital%type;
ie_lib_receita_w				parametro_medico.ie_lib_receita%type;
ie_lib_orientacao_alta_w			parametro_medico.ie_lib_orientacao_alta%type;
ie_lib_hist_saude_w				parametro_medico.ie_liberar_hist_saude%type;
ie_lib_consentimento_w			parametro_medico.ie_lib_consentimento%type;
ie_consulta_Amb_w				prontuario_emissao.ie_consulta_amb%type;
ie_ganhos_perdas_w			prontuario_emissao.ie_ganho_perda%type;
ie_obs_nasc_w				prontuario_emissao.ie_obstetricia_nasc%type;
ie_avaliacao_w				prontuario_emissao.ie_avaliacao%type;
ie_checkup_w				prontuario_emissao.ie_checkup%type;
ie_diagnostico_tumor_w			prontuario_emissao.ie_diag_tumor%type;
ie_tratam_onc_w				prontuario_emissao.ie_trat_onco%type;
nr_atendimento_w				prontuario_emissao_item.nr_atendimento%type;
ie_alertas_w				prontuario_emissao.ie_alertas%type;
ie_care_directive_w     prontuario_emissao.ie_care_directive%type;
ie_wound_mngmnt_w     prontuario_emissao.ie_wound_mngmnt%type;
ie_ecm_w     prontuario_emissao.ie_ecm%type;
ie_infection_control_w     prontuario_emissao.ie_infection_control%type;
ie_estimated_discharge_w     prontuario_emissao.ie_estimated_discharge%type;
ie_dschrg_tnsfr_sumry_w     prontuario_emissao.ie_dschrg_tnsfr_sumry%type;
ie_events_w     prontuario_emissao.ie_events%type;
ie_justf_requests_w     prontuario_emissao.ie_justf_requests%type;
ie_call_history_w     prontuario_emissao.ie_call_history%type;
ie_nursing_actions_w     prontuario_emissao.ie_nursing_actions%type;
ie_icunsw_w     prontuario_emissao.ie_icunsw%type;
ie_death_certf_w     prontuario_emissao.ie_death_certf%type;
ie_procedures_w   prontuario_emissao.ie_procedures%type;
ie_time_motion_w     prontuario_emissao.ie_time_motion%type;
ie_instrument_w     prontuario_emissao.ie_instrument%type;
ie_intraoperative_care_w     prontuario_emissao.ie_intraoperative_care%type;
ie_equipment_w     prontuario_emissao.ie_equipment%type;
ie_attach_assmnt_w     prontuario_emissao.ie_attach_assmnt%type;
ie_attach_consents_w     prontuario_emissao.ie_attach_consents%type;
ie_attach_just_req_w     prontuario_emissao.ie_attach_just_req%type;
ie_attach_care_dir_w     prontuario_emissao.ie_attach_care_dir%type;
ie_attach_death_cert_w     prontuario_emissao.ie_attach_death_cert%type;
ie_attach_mpi_w     prontuario_emissao.ie_attach_mpi%type;
ie_attach_pathology_w     prontuario_emissao.ie_attach_pathology%type;
ie_attach_imaging_diag_w     prontuario_emissao.ie_attach_imaging_diag%type;
ie_dispositivo_w prontuario_emissao.IE_DISPOSITIVO%type;
ie_tourniquet_w prontuario_emissao.ie_tourniquet%type;
ie_diathermy_w prontuario_emissao.ie_diathermy%type;
ie_spec_path_w prontuario_emissao.ie_spec_path%type;
ie_demarcation_w prontuario_emissao.ie_demarcation%type;
ie_demarcation_conf_w prontuario_emissao.ie_demarcation_conf%type;
ie_plano_cuidado_w prontuario_emissao.ie_plano_cuidado%type;
ie_ciap_w prontuario_emissao.ie_ciap%type;
ie_encaminhamento_w prontuario_emissao.ie_encaminhamento%type;
ie_ged_w prontuario_emissao.ie_ged%type;

/* Inicio Escalas e Indices*/

ie_escalas_w		    		vice_escala.ie_escala%type;
ie_escala_w		  	  	prontuario_emissao.ie_escala%type;
	
ds_possum_w				prontuario_emissao_dados.ds_pontuacao%type  :=
											'''Escore fisiol''|| CHR(243) ||''gico: '' 	|| QT_PONTOS_FISIO  	|| CHR(13)||CHR(10)||'||
											'''Escore operat'' || CHR(243) || ''rio: '' 	|| QT_PONTOS_OPERATIVOS || CHR(13)||CHR(10)||'||
											'''Mortalidade (%): ''		|| PR_MORTALIDADE';
	
ds_creatinina_w				prontuario_emissao_dados.ds_pontuacao%type :=
											'''Cockcroft-Gault (ml/min) - adultos: '' 			 		|| QT_COCKCROFT_GAULT 		|| CHR(13)||CHR(10)||'||
											'''MDRD simplificada (ml/min) - adultos: ''		 			|| QT_MDRD					|| CHR(13)||CHR(10)||'||
											'''Jelliffe modificada (ml/min) - adultos: ''	 			|| QT_JELLIFFE				|| CHR(13)||CHR(10)||'||
											'''Schwartz (ml/min) - RN, crian''|| CHR(231) ||''a, adolescente: '' 		|| QT_SCHWARTZ				|| CHR(13)||CHR(10)||'||
											'''Counahan-Barratt (ml/min) - RN, crian''|| CHR(231) ||''a, adolescente: '' || QT_COUNHAHAN_BARRATT';
	
ds_toxicidade_w      			prontuario_emissao_dados.ds_pontuacao%type :=
											'''Hemoglobina (g/dl): ''    	|| IE_HEMOGLOBINA	|| CHR(13)||CHR(10)||'||
											'''Leuc''|| CHR(243) ||''citos 1.000/mm: ''   	|| IE_LEUCOCITO        	|| CHR(13)||CHR(10)||'||              
											'''Granul''|| CHR(243) ||''citos 1.000/mm: '' 	|| IE_GRANULOCITO      	|| CHR(13)||CHR(10)||'||
											'''Plaquetas 1.000/mm: ''    	|| IE_PLAQUETA         	|| CHR(13)||CHR(10)||'||
											'''Mucosite: ''             	|| IE_MUCOSITE         	|| CHR(13)||CHR(10)||'||
											'''N''|| CHR(225) ||''usea: ''             		|| IE_NAUSEA           	|| CHR(13)||CHR(10)||'||         
											'''V''|| CHR(244) ||''mito: ''                	|| IE_VOMITO           	|| CHR(13)||CHR(10)||'||
											'''Diarr''|| CHR(233) ||''ia: ''              		|| IE_DIARREIA         	|| CHR(13)||CHR(10)||'||
											'''Obstipac''|| CHR(231) || CHR(227) ||''o: ''            	|| IE_OBSTIPACAO       	|| CHR(13)||CHR(10)||'||
											'''Anorexia: ''	      	|| IE_ANOREXIA         	|| CHR(13)||CHR(10)||'||
											'''Disgeusia: ''             	|| IE_DISGEUSIA        	|| CHR(13)||CHR(10)||'||
											'''Alopecia: ''              	|| IE_ALOPECIA         	|| CHR(13)||CHR(10)||'||
											'''Neuropatia sensorial: ''  	|| IE_SINDROME_MAO_PE  	|| CHR(13)||CHR(10)||'||
											'''Fadiga: ''                	|| IE_FADIGA           		|| CHR(13)||CHR(10)||'||
											'''Ins''|| CHR(244) ||''nia: ''               		|| IE_INSONIA          	|| CHR(13)||CHR(10)||'||
											'''Dis''|| CHR(250) ||''ria: ''               		|| IE_DISURIA';
						
ds_graceII_w 				prontuario_emissao_dados.ds_pontuacao%type :=
											'''Risco no hospital (%): '' 						|| substr(Obter_Desc_Grace_II(nr_sequencia,''RH''),1,255)	|| CHR(13)||CHR(10)||'||
											'''Risco em 6 meses (%): ''   						|| substr(Obter_Desc_Grace_II(nr_sequencia,''R6''),1,255)  	|| CHR(13)||CHR(10)||'||              
											'''Risco em 1 ano (%): '' 						|| substr(Obter_Desc_Grace_II(nr_sequencia,''R1''),1,255)  	|| CHR(13)||CHR(10)||'||
											'''Risco em 3 anos (%): ''    						|| substr(Obter_Desc_Grace_II(nr_sequencia,''R3''),1,255)  	|| CHR(13)||CHR(10)||'||
											'''Risco de infarto do mioc''|| CHR(225) ||''rdio em 1 ano (%): ''	|| substr(Obter_Desc_Grace_II(nr_sequencia,''RMI''),1,255)';
	
ds_aval_nutri_global_w 			prontuario_emissao_dados.ds_pontuacao%type := ' substr(obter_valor_dominio(7048, IE_AVAL_NUT),1,100) || nvl2(DS_OBSERVACAO,'' - ''|| DS_OBSERVACAO,null)';
/* Fim Escalas e Indices*/



/* Itens do PEPO */

ie_agentes_anestesicos_w   		prontuario_emissao.ie_agentes_anestesicos%type;
ie_medicamentos_w 			prontuario_emissao.ie_medicamentos%type;
ie_tecnica_descricao_w 			prontuario_emissao.ie_tecnica_descricao%type;
ie_terapia_hidroeletrolitica_w 		prontuario_emissao.ie_terapia_hidroeletrolitica%type;
ie_hemoderivados_w 			prontuario_emissao.ie_hemoderivados%type;
ie_posicao_w 				prontuario_emissao.ie_posicao%type;
ie_materiais_w				prontuario_emissao.ie_materiais%type;
ie_pele_w 				prontuario_emissao.ie_pele%type;
ie_incisao_w 				prontuario_emissao.ie_incisao%type;
ie_curativo_w 				prontuario_emissao.ie_curativo%type;
ie_apae_w 				prontuario_emissao.ie_apae%type;
ie_resumo_descricao_w 			prontuario_emissao.ie_resumo_descricao%type;
ie_faturamento_medico_w 		prontuario_emissao.ie_faturamento_medico%type;
ie_utilizados_cirurgia_w		prontuario_emissao.ie_utilizados_cirurgia%type;
ie_liberacao_sra_w			prontuario_emissao.ie_liberacao_sra%type;
ie_template_w				prontuario_emissao.ie_template%type;
ie_lib_medicmaneto_pepo_w		parametro_medico.ie_libera_medic_pepo%type;
ie_libera_terapia_pepo_w		parametro_medico.ie_libera_terapia_pepo%type;
ie_libera_hemoder_pepo_w		parametro_medico.ie_libera_hemoder_pepo%type;
ie_libera_posicao_pepo_w		parametro_medico.ie_libera_posicao%type;
ie_libera_material_pepo_w		parametro_medico.ie_libera_material_pepo%type;
ie_libera_pele_pepo_w			parametro_medico.ie_libera_pele%type;
ie_libera_incisao_pepo_w		parametro_medico.ie_libera_incisao%type;
ie_libera_curativo_pepo_w		parametro_medico.ie_libera_curativo%type;
ie_lib_fatur_med_pepo_w			parametro_medico.ie_lib_fatur_med%type;
ie_libera_agente_pepo_w			parametro_medico.ie_libera_agente_pepo%type;
ie_libera_anestesia_pepo_w		parametro_medico.ie_libera_anestesia%type;
ie_resumo_descricao_pepo_w		varchar(1);
ie_mostra_excluidos_w			varchar(1);
/* Fim dos itens do PEPO */



/*Inicio dos itens da oftalmologia*/

ie_pupilometria_w               prontuario_emissao.ie_pupilometria%type;
ie_curva_tensional_w            prontuario_emissao.ie_curva_tensional%type;
ie_fotocoagulacao_w             prontuario_emissao.ie_fotocoagulacao%type;
ie_capsulotomia_w               prontuario_emissao.ie_capsulotomia%type;
ie_ultrassonografia_w           prontuario_emissao.ie_ultrassonografia%type;
ie_tomografia_coerencia_w       prontuario_emissao.ie_tomografia_coerencia%type;
ie_refracao_w                   prontuario_emissao.ie_refracao%type;
ie_gonioscopia_w                prontuario_emissao.ie_gonioscopia%type;
ie_biomicroscopia_w             prontuario_emissao.ie_biomicroscopia%type;
ie_fundoscopia_w                prontuario_emissao.ie_fundoscopia%type;
ie_microscopia_especular_w      prontuario_emissao.ie_microscopia_especular%type;
ie_angiofluoresceinografia_w    prontuario_emissao.ie_angiofluoresceinografia%type;
ie_acuidade_visual_w            prontuario_emissao.ie_acuidade_visual%type;
ie_anamnese_inicial_w           prontuario_emissao.ie_anamnese_inicial%type;
ie_exame_ocular_externo_w       prontuario_emissao.ie_exame_ocular_externo%type;
ie_motilidade_ocular_w          prontuario_emissao.ie_motilidade_ocular_completa%type;
ie_tonometria_pneumatica_w      prontuario_emissao.ie_tonometria_pneumatica%type;
ie_receita_oculos_w             prontuario_emissao.ie_receita_oculos%type;
ie_tonometria_aplanacao_w       prontuario_emissao.ie_tonometria_aplanacao%type;
ie_conduta_w                    prontuario_emissao.ie_conduta%type;
ie_paquimetria_w                prontuario_emissao.ie_paquimetria%type;
ie_campimetria_w                prontuario_emissao.ie_campimetria%type;
ie_ceratometria_w               prontuario_emissao.ie_ceratometria%type;
ie_potencial_acuidade_w         prontuario_emissao.ie_potencial_acuidade%type;
ie_iridectomia_w                prontuario_emissao.ie_iridectomia%type;
ie_daltonismo_w                 prontuario_emissao.ie_daltonismo%type;
ie_sobrecarga_hidrica_w         prontuario_emissao.ie_sobrecarga_hidrica%type;
ie_mapeamento_retina_w          prontuario_emissao.ie_mapeamento_retina%type;
ie_retinografia_w               prontuario_emissao.ie_retinografia%type;
ie_avaliacao_lacrimal_w         prontuario_emissao.ie_avaliacao_lacrimal%type;
ie_distancia_pupilar_w          prontuario_emissao.ie_distancia_pupilar%type;
ie_auto_refracao_w              prontuario_emissao.ie_auto_refracao%type;
ie_biometria_w                  prontuario_emissao.ie_biometria%type;
ie_tomografia_olho_w            prontuario_emissao.ie_tomografia_olho%type;
ie_libera_exames_oft_w          parametro_medico.ie_libera_exames_oft%type;
ie_aberrometria_ocular_w        prontuario_emissao.ie_aberrometria_ocular%type;
/*Fim dos itens da oftalmologia*/




/*Evolucao*/

C01 CURSOR FOR
	SELECT	a.cd_evolucao,
		a.dt_evolucao,
		a.nr_atendimento
	from 	evolucao_paciente a
	where 	a.dt_evolucao between dt_inicio_w and dt_final_w
	and 	((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and 	a.cd_pessoa_fisica = cd_pessoa_fisica_p
	and 	((ie_lib_evolucao_w = 'N') or (dt_liberacao IS NOT NULL AND dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Prescricao*/

C02 CURSOR FOR
	SELECT	a.nr_prescricao,
		a.dt_prescricao,
		a.nr_atendimento
	from	prescr_medica a
	where	((a.nr_atendimento	= nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	a.cd_pessoa_fisica = cd_pessoa_fisica_p
	and	a.dt_prescricao between dt_inicio_w and dt_final_w
	and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Anamnese*/

C03 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.dt_ananmese,
		a.nr_atendimento
	from	anamnese_paciente a
	where	a.dt_ananmese between dt_inicio_w and dt_final_w
	and	((a.nr_atendimento	= nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((coalesce(a.cd_pessoa_fisica, obter_pessoa_atendimento(a.nr_Atendimento, 'C')) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	((ie_lib_anamnese_w = 'N') or (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Atestado*/

C04 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.dt_atestado,
		a.nr_atendimento
	from	atestado_paciente a
	where	((a.nr_atendimento	= nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((coalesce(a.cd_pessoa_fisica, obter_pessoa_atendimento(a.nr_Atendimento, 'C')) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_atestado between dt_inicio_w and dt_final_w
	and	((ie_lib_atestado_w = 'N') or (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*SV*/

C05 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.dt_sinal_vital,
		a.nr_atendimento
	from	atendimento_sinal_vital a
	where	((a.nr_atendimento	= nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_Atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_sinal_vital between dt_inicio_w and dt_final_w
	and	((ie_lib_sinal_vital_w = 'N') or (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Diagnostico*/

C06 CURSOR FOR
	SELECT	b.nr_atendimento,
		b.dt_diagnostico
	from	diagnostico_doenca b
	where	((b.nr_atendimento	= nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_Atendimento(b.nr_Atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_diagnostico between dt_inicio_w and dt_final_w
	and	((ie_lib_diag_medico_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (b.nr_atendimento in ( 	SELECT a.nr_atendimento
					from atendimento_paciente a 
					where a.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Exame Lab*/

C07 CURSOR FOR
	SELECT	distinct
		b.nr_prescricao,
		b.dt_prescricao,
		b.nr_atendimento
	from 	pessoa_fisica g,
		grupo_exame_lab e,
		exame_laboratorio d,
		exame_lab_result_item f,
		exame_lab_resultado i,
		atendimento_paciente_v a,
		prescr_procedimento c,
		prescr_medica b
	where 	a.nr_atendimento	= b.nr_atendimento
	and 	b.nr_prescricao	= c.nr_prescricao
	and 	c.nr_seq_exame	= d.nr_seq_exame
	and 	d.nr_seq_grupo	= e.nr_sequencia
	and 	b.cd_medico	= g.cd_pessoa_fisica
	and 	b.nr_prescricao	= i.nr_prescricao
	and	i.nr_seq_resultado	= f.nr_seq_resultado
	and	f.nr_seq_prescr	= c.nr_sequencia
	and	(f.nr_seq_material IS NOT NULL AND f.nr_seq_material::text <> '')
	and	(b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '')
	and (coalesce(c.IE_SUSPENSO,'N') <> 'S' or pkg_i18n.get_user_locale <> 'en_AU')
	and	((b.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((a.cd_pessoa_fisica = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_prescricao between dt_inicio_w and dt_final_w
	and (b.nr_atendimento in ( 	SELECT h.nr_atendimento
					from atendimento_paciente h 
					where h.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0))
	
union
 
	SELECT 	b.nr_prescricao,
		b.dt_prescricao,
		b.nr_atendimento
	FROM	result_laboratorio a,
		prescr_procedimento c,
		prescr_medica b
	WHERE 	c.nr_prescricao  = a.nr_prescricao
	AND	c.nr_sequencia = a.nr_seq_prescricao
	AND	c.nr_prescricao  = b.nr_prescricao 
	AND	(a.ds_resultado IS NOT NULL AND a.ds_resultado::text <> '')
	AND	(c.nr_seq_exame IS NOT NULL AND c.nr_seq_exame::text <> '')
	AND	c.ie_status_atend >= 35 
	AND	coalesce(b.dt_suspensao::text, '') = '' 
	and	((b.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((b.cd_pessoa_fisica = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_prescricao between dt_inicio_w and dt_final_w
	and	coalesce(c.IE_SUSPENSO,'N') <> 'S'
	and (b.nr_atendimento in ( 	select h.nr_atendimento 
					from atendimento_paciente h 
					where h.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Laudo Paciente*/

C08 CURSOR FOR
	SELECT 	a.nr_sequencia,
		a.dt_laudo,
		a.nr_atendimento
	from 	laudo_paciente a
	where	((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_Atendimento(a.nr_Atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_laudo between Inicio_Dia(dt_inicio_w) and Fim_Dia(dt_final_w)
	and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and (coalesce(a.dt_cancelamento::text, '') = '' or pkg_i18n.get_user_locale <> 'en_AU')
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Historico de Saude*/

c09 CURSOR FOR
	SELECT	a.cd_pessoa_fisica,
		a.dt_registro	dt_registro,
		a.nr_atendimento
	from	paciente_alergia a
	where	((nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((coalesce(cd_pessoa_fisica, obter_pessoa_atendimento(nr_Atendimento, 'C')) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	dt_registro between dt_inicio_w and dt_final_w
	and	((ie_lib_hist_saude_w = 'N') or (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0))
	
union

	select	a.cd_pessoa_fisica,
		a.dt_registro	dt_registro,
		a.nr_atendimento
	from	paciente_habito_vicio a
	where	((nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((coalesce(cd_pessoa_fisica, obter_pessoa_atendimento(nr_Atendimento, 'C')) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	dt_registro between dt_inicio_w and dt_final_w
	and	((ie_lib_hist_saude_w = 'N') or (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0))
	
union

	select	a.cd_pessoa_fisica,
		a.dt_registro	dt_registro,
		a.nr_atendimento
	from	paciente_medic_uso a
	where	((nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((coalesce(cd_pessoa_fisica, obter_pessoa_atendimento(nr_Atendimento, 'C')) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	dt_registro between dt_inicio_w and dt_final_w
	and	((ie_lib_hist_saude_w = 'N') or (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0))
	
union

	select	a.cd_pessoa_fisica,
		a.dt_registro	dt_registro,
		a.nr_atendimento
	from	paciente_antec_clinico a
	where	((nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((coalesce(cd_pessoa_fisica, obter_pessoa_atendimento(nr_Atendimento, 'C')) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	dt_registro between dt_inicio_w and dt_final_w
	and	((ie_lib_hist_saude_w = 'N') or (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0))
	
union

	select	a.cd_pessoa_fisica,
		a.dt_cirurgia	dt_registro,
		a.nr_atendimento
	from	historico_saude_cirurgia a
	where	((cd_pessoa_fisica = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	dt_cirurgia between dt_inicio_w and dt_final_w
	and	((ie_lib_hist_saude_w = 'N') or (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''));

/*Oftalmologia*/

c10 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.dt_consulta
	from	OFT_CONSULTA_MEDICA a
	where	((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_Atendimento,'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	dt_consulta between dt_inicio_w and dt_final_w
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Orientacao Alta*/

c11 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.dt_atualizacao,
		a.nr_atendimento
	from 	atendimento_alta a
	where	((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_atualizacao between dt_inicio_w and dt_final_w
	and	(((a.ie_tipo_orientacao <> 'P') and ((ie_lib_orientacao_alta_w = 'N') or (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')))
	or (ie_lib_desfecho_w = 'N' or ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') and coalesce(a.dt_inativacao::text, '') = '')))
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Parecer Medico*/

c12 CURSOR FOR
	SELECT	distinct a.nr_parecer,
		a.dt_liberacao,
		a.nr_atendimento
	FROM 	PARECER_MEDICO b,
		parecer_medico_req a
	WHERE 	a.nr_parecer = b.nr_parecer
	and	((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((coalesce(a.cd_pessoa_fisica, obter_pessoa_Atendimento(a.nr_Atendimento, 'C')) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_liberacao between dt_inicio_w and dt_final_w
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Receita*/

c13 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.dt_receita,
		a.nr_atendimento_hosp
	from 	med_receita a
	where	((nr_atendimento_hosp	= nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((coalesce(a.cd_pessoa_fisica, obter_pessoa_atendimento(nr_Atendimento_hosp, 'C')) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	dt_receita between dt_inicio_w and dt_final_w
	and	((ie_lib_receita_w = 'N') or (dt_liberacao IS NOT NULL AND dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Consentimento*/

c14 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.dt_liberacao
	from	pep_pac_ci a
	where	((a.nr_atendimento	= nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((coalesce(a.cd_pessoa_fisica,obter_pessoa_atendimento(a.nr_Atendimento, 'C')) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	dt_atualizacao_nrec between dt_inicio_w and dt_final_w
	and	((ie_lib_consentimento_w = 'N') or (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*SAE*/

c15 CURSOR FOR
	SELECT	b.nr_sequencia,
		b.dt_prescricao,
		b.nr_atendimento
	from	pe_prescr_item_result a,
		PE_PRESCRICAO b
	where	a.nr_seq_prescr = b.nr_sequencia
	and	((b.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((coalesce(b.cd_pessoa_fisica, obter_pessoa_Atendimento(b.nr_Atendimento, 'C')) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	dt_prescricao between dt_inicio_w and dt_final_w
	and	(b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '')
	and (b.nr_atendimento in ( 	SELECT c.nr_atendimento
					from atendimento_paciente c
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

 /*SAENEW*/

c124 CURSOR FOR
	SELECT	b.nr_sequencia,
		b.dt_prescricao,
		b.nr_atendimento
	from	
		PE_PRESCRICAO b
	WHERE	((b.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((coalesce(b.cd_pessoa_fisica, obter_pessoa_Atendimento(b.nr_Atendimento, 'C')) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	dt_prescricao between dt_inicio_w and dt_final_w
	and	(b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '')
	and (b.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));


/*Solicitacao Exame Esterno*/

c16 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.dt_solicitacao,
		a.nr_atendimento
	from	pedido_exame_externo a
	where	((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((coalesce(a.cd_pessoa_fisica, obter_pessoa_atendimento(a.nr_Atendimento, 'C')) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_solicitacao between dt_inicio_w and dt_final_w
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Consulta Ambulatorial*/

c17 CURSOR FOR
	SELECT	coalesce(a.nr_sequencia,0) nr_sequencia,
		a.dt_registro
	from	ehr_registro a,
		ehr_reg_template b
	where	a.nr_sequencia = b.nr_Seq_reg
	and	((nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and (coalesce(a.cd_paciente, obter_pessoa_Atendimento(nr_atendimento, 'C')) = cd_pessoa_fisica_p)
	and	a.dt_registro between dt_inicio_w and dt_final_w
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Ganhos e Perdas*/
	
C18 CURSOR FOR
	SELECT	nr_sequencia,
		dt_medida,
		nr_atendimento
	from	atendimento_perda_ganho a
	where	((nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(nr_Atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	dt_medida between dt_inicio_w and dt_final_w
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Obstetricia/Nascimentos*/
	
C19 CURSOR FOR
	SELECT	dt_nascimento,
		nr_atendimento
	from	nascimento a
	where	((nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(nr_Atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	dt_nascimento between dt_inicio_w and dt_final_w
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Avaliacao*/

C20 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.dt_avaliacao,
		a.nr_atendimento
	from	med_avaliacao_paciente a
	where	((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((coalesce(a.cd_pessoa_fisica,obter_pessoa_atendimento(a.nr_Atendimento, 'C')) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_avaliacao between dt_inicio_w and dt_final_w
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Check-up Evolucoes*/

C21 CURSOR FOR
	SELECT	a.cd_evolucao,
		a.dt_evolucao,
		a.nr_atendimento
	from	evolucao_paciente a
	where	((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((coalesce(a.cd_pessoa_fisica,obter_pessoa_atendimento(a.nr_Atendimento, 'C')) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_evolucao between dt_inicio_w and dt_final_w
	and	a.ie_evolucao_clinica in ('AE', 'CO')
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Check-up Diagnostico*/

C22 CURSOR FOR
	SELECT	a.dt_registro,
		a.nr_sequencia
	from	checkup_diagnostico a
	where	((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_Atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_registro between dt_inicio_w and dt_final_w
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Check-up Orientacao*/
	
C23 CURSOR FOR
	SELECT	a.dt_registro,
		a.nr_sequencia
	from	checkup_orientacao a
	where	((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_Atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_registro between dt_inicio_w and dt_final_w
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Check-up Comentario adicional*/

C24 CURSOR FOR
	SELECT	a.dt_atualizacao_nrec,
		a.nr_sequencia
	from	checkup_coment_adic a
	where	((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_Atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_atualizacao_nrec between dt_inicio_w and dt_final_w
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Diagnostico do Tumor*/

C25 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.dt_avaliacao
	from	can_loco_regional a
	where	((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((coalesce(a.cd_pessoa_fisica,obter_pessoa_atendimento(a.nr_Atendimento, 'C')) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_avaliacao between dt_inicio_w and dt_final_w
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Tratamento Oncologico*/

C26 CURSOR FOR
	SELECT	nr_seq_paciente,
		dt_atualizacao
	from	paciente_setor
	where	((cd_pessoa_fisica = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	dt_atualizacao between dt_inicio_w and dt_final_w;

/*CIAP*/

C27 CURSOR FOR
	SELECT a.nr_sequencia,
	       a.dt_registro,
	       a.nr_atendimento		
	from ciap_atendimento a
	where ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and a.dt_registro between dt_inicio_w and dt_final_w 
	and (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and (a.nr_atendimento in ( 	
		SELECT b.nr_atendimento 
		from atendimento_paciente b
		where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*outpatient prescription*/

C30 CURSOR FOR
 SELECT	a.nr_sequencia,
		a.dt_receita,
		a.nr_atendimento
	from 	FA_RECEITA_FARMACIA a
	where	((nr_atendimento	= nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((coalesce(a.cd_pessoa_fisica, obter_pessoa_atendimento(nr_Atendimento, 'C')) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	dt_receita between dt_inicio_w and dt_final_w
	and	((ie_lib_receita_w = 'N') or (dt_liberacao IS NOT NULL AND dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento 
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Care directives*/
c31 CURSOR FOR                              
SELECT	a.nr_sequencia,
		a.DT_REGISTRATION,
		a.nr_atendimento
	from 	DIRETRIZ_ATENDIMENTO a
	where	coalesce(a.dt_inativacao::text, '') = ''
  and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_REGISTRATION between dt_inicio_w and dt_final_w
  and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));
/*Wound Management*/
c32 CURSOR FOR                              
SELECT	a.nr_sequencia,
		a.dt_liberacao,
		a.nr_atendimento
	from 	CUR_FERIDA a
	where	coalesce(a.dt_inativacao::text, '') = ''
  and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_INICIO_FERIDA between dt_inicio_w and dt_final_w
  and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Electronic content Management - ECM */
c33 CURSOR FOR                              
SELECT	a.nr_sequencia,
		a.DT_REGISTRO,
		a.nr_atendimento
	from 	GED_ATENDIMENTO a
	where	coalesce(a.dt_inativacao::text, '') = ''
  and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_REGISTRO between dt_inicio_w and dt_final_w
  and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*ECM- Encounter Attachments*/

c78 CURSOR FOR
SELECT	a.nr_sequencia,
		a.DT_ATUALIZACAO,
		a.nr_atendimento
	from 	ATENDIMENTO_PACIENTE_ANEXO a
	where	((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_ATUALIZACAO between dt_inicio_w and dt_final_w
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento
					from atendimento_paciente c
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Infection control */
c34 CURSOR FOR                              
SELECT	a.nr_sequencia,
		a.DT_REGISTRO,
		a.nr_atendimento
	from 	ATENDIMENTO_PRECAUCAO a
	where	coalesce(a.dt_inativacao::text, '') = ''
  and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_REGISTRO between dt_inicio_w and dt_final_w
  and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Estimated discharge*/
c35 CURSOR FOR                              
SELECT	a.nr_sequencia,
		a.DT_REGISTRO,
		a.nr_atendimento
	from 	ATEND_PREVISAO_ALTA a
	where	coalesce(a.dt_inativacao::text, '') = ''
  and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_REGISTRO between dt_inicio_w and dt_final_w
  and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Estimated discharge from departments*/
c35_1 CURSOR FOR                              
SELECT	a.nr_sequencia,
		a.DT_PROBABILIDADE_ALTA,
		a.nr_atendimento
	from 	PROBABILIDADE_ALTA_SETOR a
	where	((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_PROBABILIDADE_ALTA between dt_inicio_w and dt_final_w
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

 /*Estimated discharge contact history*/
c35_2 CURSOR FOR                              
SELECT	a.nr_sequencia,
		a.DT_ATUALIZACAO,
		a.nr_atendimento
	from 	ATEND_PROB_ALTA_HIST_CONT a
	where	((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_ATUALIZACAO between dt_inicio_w and dt_final_w
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Discharge / Transfer Summary*/
        -- DSCHGTRNSFSUMMPEP  
c36 CURSOR FOR
SELECT	a.nr_sequencia,
		a.DT_ALTA,
		a.nr_atendimento
	from 	ATEND_SUMARIO_ALTA a
	where	coalesce(a.dt_inativacao::text, '') = ''
  and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_ALTA between dt_inicio_w and dt_final_w
  and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Discharge instructions*/
        -- DSCHGTRNSFSUMMPEP  
c37 CURSOR FOR                              
SELECT	a.nr_sequencia,
		a.dt_registro,
		a.nr_atendimento
	from 	ATENDIMENTO_ALTA a
	where	coalesce(a.dt_inativacao::text, '') = ''
  and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_registro between dt_inicio_w and dt_final_w
  and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Events*/
        -- EVENTPEP  
c38 CURSOR FOR
SELECT	a.nr_sequencia,
		a.dt_evento,
		a.nr_atendimento
	from 	QUA_EVENTO_PACIENTE a
	where	coalesce(a.dt_inativacao::text, '') = ''
  and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_evento between dt_inicio_w and dt_final_w
  and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Justifications / Requests*/
        -- JUSTREQPEP  
c39 CURSOR FOR                              
SELECT	a.nr_sequencia,
		a.dt_JUSTIFICATIVA,
		a.nr_atendimento
	from 	PACIENTE_JUSTIFICATIVA a
	where	coalesce(a.dt_inativacao::text, '') = ''
  and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_JUSTIFICATIVA between dt_inicio_w and dt_final_w
  and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Call history*/
        -- CALLHISPEP  
c100 CURSOR FOR
SELECT	a.nr_sequencia,
		a.dt_chamado,
		a.nr_atendimento
	from 	ATEND_PAC_CHAMADO a
  where ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_chamado between dt_inicio_w and dt_final_w
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Nursing - Pending*/
c101 CURSOR FOR                              
SELECT	a.nr_sequencia,
		a.DT_ANOTACAO,
		a.nr_atendimento
	from 	atendimento_anot_enf a
	where	coalesce(a.dt_inativacao::text, '') = ''
  and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_ANOTACAO between dt_inicio_w and dt_final_w
  and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));
/*Intensive Care - NSW*/
c102 CURSOR FOR                              
SELECT	a.nr_sequencia,
		a.DT_ATUALIZACAO,
		a.nr_atendimento
	from 	ICUNSW a
	where	coalesce(a.dt_inativacao::text, '') = ''
  and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_ATUALIZACAO between dt_inicio_w and dt_final_w
  and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

 /*Death Certificate*/
  -- DEATHCERTFPEP 
c103 CURSOR FOR                              
SELECT	a.nr_sequencia,
		a.DT_OBITO,
		a.nr_atendimento
	from 	DECLARACAO_OBITO a
	where	coalesce(a.dt_inativacao::text, '') = ''
  and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_OBITO between dt_inicio_w and dt_final_w
  and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));
/* Procedures */

c108 CURSOR FOR
SELECT	a.nr_sequencia,
		a.DT_REGISTRO,
		a.nr_atendimento
	from 	PROC_PAC_DESCRICAO a
	where	coalesce(a.dt_inativacao::text, '') = ''
  and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_REGISTRO between dt_inicio_w and dt_final_w
  and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));



/*Attachments - Assessment */

C109 CURSOR FOR
	SELECT	b.nr_sequencia,
		b.DT_ATUALIZACAO,
		a.nr_atendimento
	from	med_avaliacao_paciente a , MED_AVALIACAO_PAC_ANEXO b
  where a.nr_sequencia = b.NR_SEQ_AVALIACAO
	and 	((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((coalesce(a.cd_pessoa_fisica,obter_pessoa_atendimento(a.nr_Atendimento, 'C')) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.DT_ATUALIZACAO between dt_inicio_w and dt_final_w
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Attachments - Consent */
 
C110 CURSOR FOR
	SELECT	b.nr_sequencia,
		b.DT_ATUALIZACAO_NREC,
		a.nr_atendimento
	from	PEP_PAC_CI a , PEP_PAC_CI_ANEXO b
  where a.nr_sequencia = b.NR_SEQ_PAC_CI
	and 	((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((coalesce(a.cd_pessoa_fisica,obter_pessoa_atendimento(a.nr_Atendimento, 'C')) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.DT_ATUALIZACAO_NREC between dt_inicio_w and dt_final_w
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Attachments - Justification Requests*/

c111 CURSOR FOR                              
SELECT	b.nr_sequencia,
		b.DT_ATUALIZACAO,
		a.nr_atendimento
	from 	PACIENTE_JUSTIFICATIVA a,PACIENTE_JUST_ANEXO b
	where	coalesce(a.dt_inativacao::text, '') = '' and a.nr_sequencia = b.NR_SEQ_JUSTIFICATIVA
  and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.DT_ATUALIZACAO between dt_inicio_w and dt_final_w
  and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));
/*Attachments - Care directives */

c112 CURSOR FOR
SELECT	b.nr_sequencia,
		b.DT_ATUALIZACAO,
		a.nr_atendimento
	from 	DIRETRIZ_ATENDIMENTO a, DIRETRIZ_ATENDIMENTO_ANEXO b
	where	coalesce(a.dt_inativacao::text, '') = '' and a.nr_sequencia = b.NR_SEQ_DIRETRIZ
  and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.DT_ATUALIZACAO between dt_inicio_w and dt_final_w
  and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Attachments - Death Certificates */

c113 CURSOR FOR                              
SELECT	a.nr_sequencia,
		a.DT_OBITO,
		a.nr_atendimento
	from 	DECLARACAO_OBITO a 
	where	coalesce(a.dt_inativacao::text, '') = ''
  and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_OBITO between dt_inicio_w and dt_final_w
  and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Attachments - Master Person Index (Consents)*/

C114 CURSOR FOR
	SELECT	a.nr_sequencia,
		b.DT_ATUALIZACAO_NREC,
		a.cd_pessoa_fisica
	from	PEP_PAC_CI a , PEP_PAC_CI_ANEXO b
  where a.nr_sequencia = b.NR_SEQ_PAC_CI
	and	((coalesce(a.cd_pessoa_fisica,obter_pessoa_atendimento(a.nr_Atendimento, 'C')) = cd_pessoa_fisica_p) or (cd_pessoa_fisica = cd_pessoa_fisica_p))
	and	b.DT_ATUALIZACAO_NREC between dt_inicio_w and dt_final_w;

/*Attachments - Master Person Index (Consents)*/

C115 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.DT_ATUALIZACAO_NREC,
		a.cd_pessoa_fisica
	from	PESSOA_DOCUMENTACAO a
  where cd_pessoa_fisica = cd_pessoa_fisica_p
	and	a.DT_ATUALIZACAO_NREC between dt_inicio_w and dt_final_w;

/*Attachments - Pathology */


/*Attachments - Imaging / Diagnostics */



/*Alertas*/

C41 CURSOR FOR
	SELECT	nr_sequencia,
		dt_alerta,
		'ALERTASPAC' ie_tipo_item
	from	alerta_paciente
	where	((cd_pessoa_fisica = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	dt_alerta between dt_inicio_w and dt_final_w
	
union

	SELECT	nr_sequencia,
		dt_alerta,
		'ALERTASATE' ie_tipo_item
	from	atendimento_alerta a
	where	((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_Atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_alerta between dt_inicio_w and dt_final_w
	and (a.nr_atendimento in ( 	select b.nr_atendimento
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));
					
/*Orientacoes Gerais*/

c42 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.dt_atualizacao,
		a.nr_atendimento
	from 	pep_orientacao_geral a
	where	((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_atualizacao between dt_inicio_w and dt_final_w
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c43 CURSOR FOR
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_curva_tencional b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c44 CURSOR FOR               
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_fotocoagulacao_laser b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c45 CURSOR FOR               
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_capsulotomia b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c46 CURSOR FOR               
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_ultrassonografia b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c47 CURSOR FOR               
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_oct b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c48 CURSOR FOR               
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_refracao b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));


c49 CURSOR FOR               
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_gonioscopia b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c50 CURSOR FOR
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_biomicroscopia b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c51 CURSOR FOR               
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_fundoscopia b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c52 CURSOR FOR               
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_microscopia_especular b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c53 CURSOR FOR
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_angio_retino b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   coalesce(ie_tipo_registro,'A') = 'A'
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c54 CURSOR FOR               
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_anamnese b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c55 CURSOR FOR               
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_exame_externo b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c56 CURSOR FOR
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_motilidade_ocular b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c57 CURSOR FOR
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_tonometria b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   b.ie_tipo_tonometria = 1
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c58 CURSOR FOR               
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_oculos b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c59 CURSOR FOR
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_tonometria b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   b.ie_tipo_tonometria = 2
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));


c60 CURSOR FOR
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_conduta b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c61 CURSOR FOR
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_paquimetria b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c62 CURSOR FOR                              
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_campimetria b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c63 CURSOR FOR                              
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_cerastocopia b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c64 CURSOR FOR
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_potencial_acuidade b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c65 CURSOR FOR                              
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_iridectomia b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c66 CURSOR FOR
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_daltonismo b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c67 CURSOR FOR
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_sobrecarga_hidrica b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c68 CURSOR FOR
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_mapeamento_retina b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c69 CURSOR FOR
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_angio_retino b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   coalesce(ie_tipo_registro,'A') = 'R'
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c70 CURSOR FOR                              
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_olho_seco b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c71 CURSOR FOR                              
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_dnp b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c72 CURSOR FOR                              
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_auto_refracao b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c73 CURSOR FOR                              
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_biometria b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c74 CURSOR FOR                              
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_tomografia_olho b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c75 CURSOR FOR                              
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_pupilometria b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c76 CURSOR FOR                              
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_correcao_atual b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c77 CURSOR FOR                              
SELECT	b.nr_sequencia,
		b.dt_atualizacao,
		a.nr_atendimento
	from 	oft_consulta a,
         oft_aberrometria b
	where	a.nr_sequencia = b.nr_seq_consulta
   and	coalesce(a.dt_cancelamento::text, '') = ''
   and   ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	b.dt_atualizacao between dt_inicio_w and dt_final_w
   and	((ie_libera_exames_oft_w = 'N') or (b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

               
/* Escalas e Indices*/

CursorEscalas 			REFCURSOR;
CursorRegistrosEscala		REFCURSOR;
	
/* ----------------------------------------------------- Inicio itens do PEPO	-----------------------------------------------------  */


/*Agentes anestesicos*/

C027 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.dt_atualizacao_nrec
	from	cirurgia_agente_anestesico a
	where	(( obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_atualizacao_nrec between dt_inicio_w and dt_final_w
	and	((ie_libera_agente_pepo_w = 'N') or (dt_liberacao IS NOT NULL AND dt_liberacao::text <> ''))
	and 	a.ie_tipo = 1
	and 	exists (SELECT  1
			from  	cirurgia x
			where 	((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)));


/*Terapia Hidroeletrolicica*/
				
C028 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.dt_atualizacao_nrec
	from	cirurgia_agente_anestesico a
	where	(( obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_atualizacao_nrec between dt_inicio_w and dt_final_w
	and	((ie_libera_terapia_pepo_w = 'N') or (dt_liberacao IS NOT NULL AND dt_liberacao::text <> ''))
	and 	a.ie_tipo = 2
	and 	exists (SELECT    1 
			from  	   cirurgia x
			where 	   ((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	   x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)));

/*Medicamentos*/

C029 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.dt_atualizacao_nrec
	from	cirurgia_agente_anestesico a
	where	(( obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_atualizacao_nrec between dt_inicio_w and dt_final_w
	and	((ie_lib_medicmaneto_pepo_w = 'N') or (dt_liberacao IS NOT NULL AND dt_liberacao::text <> ''))
	and	a.ie_tipo = 3
	and 	exists (SELECT  1
			from  	cirurgia x
			where 	((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)));
				
/*Anestesia - Tecnica e descricao*/

C030 CURSOR FOR			 
	SELECT	nr_sequencia,
		dt_atualizacao_nrec
	from	cirurgia_tec_anestesica a
	where	(( obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	dt_atualizacao_nrec between dt_inicio_w and dt_final_w
	and	((ie_libera_anestesia_pepo_w = 'N') or (dt_liberacao IS NOT NULL AND dt_liberacao::text <> ''))
	and 	exists (SELECT    1 
			from  	   cirurgia x
			where 	   ((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	   x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)));

/*Hemoderivados*/
			
C031 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.dt_atualizacao_nrec
	from	cirurgia_agente_anestesico a
	where	(( obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_atualizacao_nrec between dt_inicio_w and dt_final_w
	and	((ie_libera_hemoder_pepo_w = 'N') or (dt_liberacao IS NOT NULL AND dt_liberacao::text <> ''))
	and 	a.ie_tipo = 5
	and 	exists (SELECT    1 
			from  	   cirurgia x
			where 	   ((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	   x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)));

/*Posicao*/

C032 CURSOR FOR				
	SELECT	a.nr_sequencia,
		a.dt_atualizacao_nrec
	from	posicao_cirurgia a
	where	(( obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_atualizacao_nrec between dt_inicio_w and dt_final_w
	and	((ie_libera_posicao_pepo_w = 'N') or (dt_liberacao IS NOT NULL AND dt_liberacao::text <> ''))
	and 	exists (SELECT    1 
			from  	   cirurgia x
			where 	   ((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	   x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)));
			
/*Materiais*/
			 
C033 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.dt_atualizacao_nrec
	from	cirurgia_agente_anestesico a
	where	(( obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_atualizacao_nrec between dt_inicio_w and dt_final_w
	and	((ie_libera_material_pepo_w = 'N') or (dt_liberacao IS NOT NULL AND dt_liberacao::text <> ''))
	and 	a.ie_tipo = 4
	and 	exists (SELECT    1 
			from  	   cirurgia x
			where 	   ((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	   x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)));
		
/*Pele*/
			
C034 CURSOR FOR		
	SELECT	a.nr_sequencia,
		a.dt_atualizacao_nrec
	from	pepo_pele a
	where	( (obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_atualizacao_nrec between dt_inicio_w and dt_final_w
	and	((ie_libera_pele_pepo_w = 'N') or (dt_liberacao IS NOT NULL AND dt_liberacao::text <> ''))
	and 	exists (SELECT    1 
			from  	   cirurgia x
			where 	   ((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	   x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)));
			
/*Insicao cirurgica*/
			 
C035 CURSOR FOR		
	SELECT	a.nr_sequencia,
		a.dt_atualizacao_nrec
	from	incisao_cirurgia a
	where	( (obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_atualizacao_nrec between dt_inicio_w and dt_final_w
	and	((ie_libera_incisao_pepo_w = 'N') or (dt_liberacao IS NOT NULL AND dt_liberacao::text <> ''))
	and 	exists (SELECT    1 
			from  	   cirurgia x
			where 	   ((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	   x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)));
			
/*Curativo cirurgica*/
			 
C036 CURSOR FOR		
	SELECT	a.nr_sequencia,
		a.dt_atualizacao_nrec
	from	pepo_curativo a
	where	( (obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_atualizacao_nrec between dt_inicio_w and dt_final_w
	and	((ie_libera_curativo_pepo_w = 'N') or (dt_liberacao IS NOT NULL AND dt_liberacao::text <> ''))
	and 	exists (SELECT    1 
			from  	   cirurgia x
			where 	   ((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	   x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)));
			
/*APAE*/
			 
C037 CURSOR FOR			 
	SELECT	a.nr_sequencia,
		a.dt_atualizacao_nrec
	from	aval_pre_anestesica a
	where	(( obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_atualizacao_nrec between dt_inicio_w and dt_final_w
	and 	exists (SELECT    1 
			from  	   cirurgia x
			where 	   ((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	   x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)));
			
/*Cirurgia - resumo e descricao*/

C038 CURSOR FOR			 
	SELECT	a.nr_sequencia,
		a.dt_registro
	from	cirurgia_descricao a
	where	(( obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_registro between dt_inicio_w and dt_final_w
	and	((ie_resumo_descricao_pepo_w = 'S') or (dt_liberacao IS NOT NULL AND dt_liberacao::text <> ''))
	and 	exists (SELECT    1 
			from  	   cirurgia x
			where 	   ((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	   x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)));
			
/*Faturmento medico*/

C039 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.dt_atualizacao_nrec 
	from	pep_med_fatur a
	where	((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_Atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_atualizacao_nrec between dt_inicio_w and dt_final_w
	and	((ie_lib_fatur_med_pepo_w = 'N') or (dt_liberacao IS NOT NULL AND dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento 
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));
					
/*Materiais e medicamentos utilizados*/

C041 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.dt_conta
	from	material_atend_paciente a
	where	(( obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.dt_conta between dt_inicio_w and dt_final_w
	and 	exists (SELECT    1
			from  	   cirurgia x
			where 	   ((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	   x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)))
	and ((ie_mostra_excluidos_w = 'S') or (coalesce(a.cd_motivo_exc_conta::text, '') = ''));

/*Time and motion*/

C104 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.DT_REGISTRO
	from	EVENTO_CIRURGIA_PACIENTE a
	where	(( obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_REGISTRO between dt_inicio_w and dt_final_w
	and 	exists (SELECT    1 
			from  	   cirurgia x
			where 	   ((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	   x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)))
	and (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') and coalesce(a.dt_inativacao::text, '') = '';

   /*TOURNIQUET*/

C105 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.DT_RECORD,
    'TOURNIQUET' ie_tipo_item
	from	CIRURGIA_TOURNIQUET a
	where	(( obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_RECORD between dt_inicio_w and dt_final_w
	and 	exists (SELECT    1
			from  	   cirurgia x
			where 	   ((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	   x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)))
	and (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') and coalesce(a.dt_inativacao::text, '') = '';

   /*DIATHERMY*/

C205 CURSOR FOR 
  SELECT	a.nr_sequencia,
		a.DT_RECORD,
    'DIATHERMY' ie_tipo_item
	from	CIRURGIA_DIATHERMY a
	where	(( obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_RECORD between dt_inicio_w and dt_final_w
	and 	exists (SELECT    1 
			from  	   cirurgia x
			where 	   ((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	   x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)))
	and (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') and coalesce(a.dt_inativacao::text, '') = '';

/*PATHOLOGY_SPEC*/

C206 CURSOR FOR 
  SELECT	a.nr_sequencia,
		a.DT_RECORD,
    'PATHOLOGY_SPEC' ie_tipo_item
	from	CIRURGIA_PATHOLOGY_SPEC a
	where	(( obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_RECORD between dt_inicio_w and dt_final_w
	and 	exists (SELECT    1 
			from  	   cirurgia x
			where 	   ((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	   x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)))
	and (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') and coalesce(a.dt_inativacao::text, '') = '';

 /*DEMARCATION*/

C207 CURSOR FOR 
  SELECT	a.nr_sequencia,
		a.DT_MARCACAO,
    'DEMARCATION' ie_tipo_item
	from	CIRURGIA_MARCACAO_SITIO a
	where	(( obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_MARCACAO between dt_inicio_w and dt_final_w
	and 	exists (SELECT    1 
			from  	   cirurgia x
			where 	   ((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	   x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)))
	and (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') and coalesce(a.dt_inativacao::text, '') = '';

  /*DEMARCATION_CONF*/

C208 CURSOR FOR 
  SELECT	a.nr_sequencia,
		a.DT_REGISTRO,
    'DEMARC_CONF' ie_tipo_item
	from	PEPO_CONFIRM_DEMARCACAO a
	where	(( obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_REGISTRO between dt_inicio_w and dt_final_w
	and 	exists (SELECT    1 
			from  	   cirurgia x
			where 	   ((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	   x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)))
	and (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') and coalesce(a.dt_inativacao::text, '') = '';

/*Equipment*/

C106 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.DT_INICIO
	from	EQUIPAMENTO_CIRURGIA a
	where	(( obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_INICIO between dt_inicio_w and dt_final_w
	and 	exists (SELECT    1 
			from  	   cirurgia x
			where 	   ((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	   x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)))
	and (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') and coalesce(a.dt_inativacao::text, '') = '';

  /*Instrument tracking*/

C107 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.DT_ORIGEM
	from	CM_CONJUNTO_CONT a
	where	(( obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_ORIGEM between dt_inicio_w and dt_final_w
	and 	exists (SELECT    1 
			from  	   cirurgia x
			where 	   ((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	   x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)))
	and (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') and coalesce(a.dt_inativacao::text, '') = '';
	
/*Template*/

c40 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.dt_registro,
		a.nr_atendimento
	from	ehr_registro a
	where	((nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((cd_paciente = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and		dt_atualizacao between dt_inicio_w and dt_final_w
	and		(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0))
	order by a.dt_registro desc;
	
/*Hemodynamic Monitoring*/

C042 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.Dt_Monitoracao,
		a.nr_atendimento
	from	atend_monit_hemod a
	where	((a.nr_atendimento	= nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_Atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_MONITORACAO between dt_inicio_w and dt_final_w
	and	((ie_lib_sinal_vital_w = 'N') or (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Respiratory Monitoring*/

C043 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.DT_MONITORIZACAO,
		a.nr_atendimento
	from	atendimento_monit_resp a
	where	((a.nr_atendimento	= nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_Atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_MONITORIZACAO between dt_inicio_w and dt_final_w
	and	((ie_lib_sinal_vital_w = 'N') or (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Devices*/

C120 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.DT_INSTALACAO,
		a.nr_atendimento
	from	atend_pac_dispositivo a
	where	((a.nr_atendimento	= nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_Atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_INSTALACAO between dt_inicio_w and dt_final_w
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/*Declaration of brain death*/

c121 CURSOR FOR                              
SELECT	a.nr_sequencia,
		a.DT_DECLARACAO,
		a.nr_atendimento
	from 	DECLARACAO_MORTE_ENCEF a
	where ((a.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	((obter_pessoa_atendimento(a.nr_atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_DECLARACAO between dt_inicio_w and dt_final_w
	and (a.nr_atendimento in ( 	SELECT c.nr_atendimento 
					from atendimento_paciente c 
					where c.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

/* Time and motion - Surgical times */

c122 CURSOR FOR                              
	SELECT	a.nr_sequencia,
		a.DT_ATUALIZACAO
	from	TEMPO_CIRURGICO_CIRURGIA a
	where	(( obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_ATUALIZACAO between dt_inicio_w and dt_final_w
	and 	exists (SELECT    1 
			from  	   cirurgia x
			where 	   ((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	   x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)));


 /* Time and motion - Justification of delay */
 c123 CURSOR FOR   
	SELECT	a.nr_sequencia,
		a.DT_ATUALIZACAO
	from	CIRURGIA_TEMPO_ATRASO a
	where	(( obter_pessoa_fisica_cirurgia(a.nr_cirurgia) = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
	and	a.DT_ATUALIZACAO between dt_inicio_w and dt_final_w
	and 	exists (SELECT    1 
			from  	   cirurgia x
			where 	   ((x.nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
			and	   x.nr_cirurgia	  =	a.nr_cirurgia
			and (x.nr_atendimento in ( 	select b.nr_atendimento 
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0)))
	and (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') and coalesce(a.dt_inativacao::text, '') = '';
	
/* ----------------------------------------------------- Fim itens do PEPO	-----------------------------------------------------  */

	c125 CURSOR FOR
		SELECT      a.nr_sequencia,
					a.dt_prescricao DT_PRESCRICAO,
					a.nr_atendimento NR_ATENDIMENTO
		from        pe_prescricao a,
					patient_cp_summary c
		where 		((nr_atendimento = nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
		and			((obter_pessoa_atendimento(nr_Atendimento, 'C') = cd_pessoa_fisica_p) or (coalesce(cd_pessoa_fisica_p::text, '') = ''))
		and        	c.nr_seq_prescr = a.nr_sequencia
		and			dt_prescricao between dt_inicio_w and dt_final_w
		and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0))
		and         coalesce(a.dt_inativacao::text, '') = ''
		and         (c.ds_summary IS NOT NULL AND c.ds_summary::text <> '')
		order by    a.nr_sequencia desc;
	
c126 CURSOR FOR
  SELECT	a.nr_sequencia,
		a.dt_atualizacao,
		a.nr_atendimento
	from	atend_encaminhamento a
	where	((a.nr_atendimento	= nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	a.cd_pessoa_fisica = cd_pessoa_fisica_p
	and	a.dt_atualizacao between dt_inicio_w and dt_final_w
	and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento 
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));

c127 CURSOR FOR
  SELECT a.nr_sequencia,
		coalesce(a.DT_EXPEDICAO, a.dt_registro) dt_atualizacao,
		a.nr_atendimento
  from ged_atendimento a
  where ((a.nr_atendimento	= nr_atendimento_p) or (coalesce(nr_atendimento_p,0) = 0))
	and	a.cd_pessoa_fisica = cd_pessoa_fisica_p
	and	a.dt_registro between dt_inicio_w and dt_final_w
	and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and (a.nr_atendimento in ( 	SELECT b.nr_atendimento
					from atendimento_paciente b 
					where b.nr_seq_episodio = nr_seq_episodio_p) or (coalesce(nr_seq_episodio_p, 0) = 0));


	procedure  obterDadosAnteriores is
	;
BEGIN
	select	max(b.ds_valor_old),
			max(b.ds_valor_new)
		into STRICT	nm_pessoa_fisica_w,
			nm_pessoa_fisica_new_w
		from	tasy_log_alteracao a,
			tasy_log_alt_campo b
		where	a.nr_sequencia = b.nr_seq_log_alteracao
		and	a.nm_tabela = 'PESSOA_FISICA'
		and	upper(b.nm_atributo) = 'NM_PESSOA_FISICA'
		and	a.ds_chave_simples = cd_pessoa_fisica_p
		and	a.nr_sequencia = (	SELECT	max(c.nr_sequencia)
						from	tasy_log_alteracao c,
							tasy_log_alt_campo d
						where	c.nr_sequencia = d.nr_seq_log_alteracao
						and	c.nm_tabela = 'PESSOA_FISICA'
						and	upper(d.nm_atributo) = 'NM_PESSOA_FISICA'
						and	c.ds_chave_simples = cd_pessoa_fisica_p
						and	trunc(c.dt_atualizacao) = (	select	min(trunc(e.dt_atualizacao))
											from	tasy_log_alteracao e,
												tasy_log_alt_campo f
											where	e.nr_sequencia = f.nr_seq_log_alteracao
											and	e.nm_tabela = 'PESSOA_FISICA'
											and	upper(f.nm_atributo) = 'NM_PESSOA_FISICA'
											and	e.ds_chave_simples = cd_pessoa_fisica_p
											and	trunc(f.dt_atualizacao,'dd') > trunc(dt_registro_w,'dd')));
											
		select	max(b.ds_valor_old),
			max(b.ds_valor_new)
		into STRICT	ie_sexo_w,
			ie_sexo_new_w
		from	tasy_log_alteracao a,
			tasy_log_alt_campo b
		where	a.nr_sequencia = b.nr_seq_log_alteracao
		and	a.nm_tabela = 'PESSOA_FISICA'
		and	upper(b.nm_atributo) = 'IE_SEXO'
		and	a.ds_chave_simples = cd_pessoa_fisica_p
		and	a.nr_sequencia = (	SELECT	max(c.nr_sequencia)
						from	tasy_log_alteracao c,
							tasy_log_alt_campo d
						where	c.nr_sequencia = d.nr_seq_log_alteracao
						and	c.nm_tabela = 'PESSOA_FISICA'
						and	upper(d.nm_atributo) = 'IE_SEXO'
						and	c.ds_chave_simples = cd_pessoa_fisica_p
						and	trunc(c.dt_atualizacao) = (	select	min(trunc(e.dt_atualizacao))
											from	tasy_log_alteracao e,
												tasy_log_alt_campo f
											where	e.nr_sequencia = f.nr_seq_log_alteracao
											and	e.nm_tabela = 'PESSOA_FISICA'
											and	upper(f.nm_atributo) = 'IE_SEXO'
											and	e.ds_chave_simples = cd_pessoa_fisica_p
											and	trunc(f.dt_atualizacao,'dd') > trunc(dt_registro_w,'dd')));
	end;
	 	
BEGIN

delete	FROM prontuario_emissao_item
where	nm_usuario = nm_usuario_p;


select	coalesce(a.dt_inicial,trunc(b.dt_nascimento,'dd')),
	 coalesce(a.dt_final,clock_timestamp()),
   pkg_date_formaters.to_varchar(coalesce(a.dt_inicial,trunc(b.dt_nascimento,'dd')), 'shortDate', wheb_usuario_pck.get_cd_estabelecimento,wheb_usuario_pck.get_nm_usuario),
   pkg_date_formaters.to_varchar(coalesce(a.dt_final,clock_timestamp()), 'shortDate', wheb_usuario_pck.get_cd_estabelecimento,wheb_usuario_pck.get_nm_usuario),
	a.ie_anamnese,
	a.ie_evolucao,
	a.ie_diagnostico,
	a.ie_atestado,
	a.ie_sinais_vitais,
	a.ie_prescricao,
	a.ie_exame_lab,
	a.ie_laudo,
	a.ie_historico_saude,
	a.ie_oftalmologia,
	a.ie_orientacao_alta,
	a.ie_orientacoes_gerais,
	a.ie_parecer_medico,
	a.ie_receita,
	a.ie_sae,
	a.ie_solic_exame_ext,
	a.ie_declaracao_receb,
	a.ie_consentimento,
	a.ie_consulta_amb,
	a.ie_ganho_perda,
	a.ie_obstetricia_nasc,
	a.ie_avaliacao,
	a.ie_checkup,
	a.ie_diag_tumor,
	a.ie_trat_onco,
	a.ie_agentes_anestesicos, /*InicioitensdoPEPO*/
	a.ie_medicamentos,
	a.ie_tecnica_descricao,
	a.ie_terapia_hidroeletrolitica,
	a.ie_hemoderivados,
	a.ie_posicao,
	a.ie_materiais,
	a.ie_pele,
	a.ie_incisao,
	a.ie_curativo,
	a.ie_apae,
	a.ie_resumo_descricao,
	a.ie_faturamento_medico,
	a.ie_utilizados_cirurgia,
	a.ie_liberacao_sra,/*FimitensdoPEPO*/
	a.ie_template,
	a.ie_alertas,
	a.ie_escala,
   a.ie_pupilometria,
   a.ie_curva_tensional,
   a.ie_fotocoagulacao,
   a.ie_capsulotomia,
   a.ie_ultrassonografia,
   a.ie_tomografia_coerencia,
   a.ie_refracao,
   a.ie_gonioscopia,
   a.ie_biomicroscopia,
   a.ie_fundoscopia,
   a.ie_microscopia_especular,
   a.ie_angiofluoresceinografia,
   a.ie_acuidade_visual,
   a.ie_anamnese_inicial,
   a.ie_exame_ocular_externo,
   a.ie_motilidade_ocular_completa,
   a.ie_tonometria_pneumatica,
   a.ie_receita_oculos,
   a.ie_tonometria_aplanacao,
   a.ie_conduta,
   a.ie_paquimetria,
   a.ie_campimetria,
   a.ie_ceratometria,
   a.ie_potencial_acuidade,
   a.ie_iridectomia,
   a.ie_daltonismo,
   a.ie_sobrecarga_hidrica,
   a.ie_mapeamento_retina,
   a.ie_retinografia,
   a.ie_avaliacao_lacrimal,
   a.ie_distancia_pupilar,
   a.ie_auto_refracao,
   a.ie_biometria,
   a.ie_tomografia_olho,
   a.ie_aberrometria_ocular,
   a.ie_care_directive,
   a.ie_wound_mngmnt,
   a.ie_ecm,
    a.ie_infection_control,
    a.ie_estimated_discharge,
    a.ie_dschrg_tnsfr_sumry,
    a.ie_events,
    a.ie_justf_requests,
    a.ie_call_history,
    a.ie_nursing_actions,
    a.ie_icunsw,
    a.ie_death_certf,
    a.ie_procedures,
    a.ie_time_motion,
    a.ie_instrument,
    a.ie_intraoperative_care,
    a.ie_equipment,
    a.ie_attach_assmnt,
    a.ie_attach_consents,
    a.ie_attach_just_req,
    ie_attach_care_dir,
    a.ie_attach_death_cert,
    a.ie_attach_mpi,
    a.ie_attach_pathology,
    a.ie_attach_imaging_diag,
    a.ie_dispositivo,
    a.ie_tourniquet, 
    a.ie_diathermy,
    a.ie_spec_path,
    a.ie_demarcation, 
    a.ie_demarcation_conf,
    a.ie_plano_cuidado,
    a.ie_ciap,
    a.ie_encaminhamento,
    a.ie_ged
  into STRICT	dt_inicio_w,
	dt_final_w,
        dt_inicio_ww,
	dt_final_ww,
	ie_anamnese_w,
	ie_evolucao_w,
	ie_diagnostico_w,
	ie_atestado_w,
	ie_sinais_vitais_w,
	ie_prescricao_w,
	ie_exame_lab_w,
	ie_laudo_w,
	ie_historico_saude_w,
	ie_oftalmologia_w,
	ie_orientacao_alta_w,
	ie_orientacoes_gerais_w,
	ie_parecer_medico_w,
	ie_receita_w,
	ie_sae_w,
	ie_solic_exame_ext_w,
	ie_declaracao_receb_w,
	ie_consentimento_w,
	ie_consulta_amb_w,
	ie_ganhos_perdas_w,
	ie_obs_nasc_w,
	ie_avaliacao_w,
	ie_checkup_w,
	ie_diagnostico_tumor_w,
	ie_tratam_onc_w,
	ie_agentes_anestesicos_w, /*Inicio itens do PEPO*/
	ie_medicamentos_w,
	ie_tecnica_descricao_w,
	ie_terapia_hidroeletrolitica_w,
	ie_hemoderivados_w,
	ie_posicao_w,
	ie_materiais_w,
	ie_pele_w,
	ie_incisao_w,
	ie_curativo_w,
	ie_apae_w,
	ie_resumo_descricao_w,
	ie_faturamento_medico_w,
	ie_utilizados_cirurgia_w, 
	ie_liberacao_sra_w, /*FimitensdoPEPO*/
	ie_template_w,
	ie_alertas_w,
	ie_escala_w,
   ie_pupilometria_w,
   ie_curva_tensional_w,
   ie_fotocoagulacao_w,
   ie_capsulotomia_w,
   ie_ultrassonografia_w,
   ie_tomografia_coerencia_w,
   ie_refracao_w,
   ie_gonioscopia_w,
   ie_biomicroscopia_w,
   ie_fundoscopia_w,
   ie_microscopia_especular_w,
   ie_angiofluoresceinografia_w,
   ie_acuidade_visual_w,
   ie_anamnese_inicial_w,
   ie_exame_ocular_externo_w,
   ie_motilidade_ocular_w,
   ie_tonometria_pneumatica_w,
   ie_receita_oculos_w,
   ie_tonometria_aplanacao_w,
   ie_conduta_w,
   ie_paquimetria_w,
   ie_campimetria_w,
   ie_ceratometria_w,
   ie_potencial_acuidade_w,
   ie_iridectomia_w,
   ie_daltonismo_w,
   ie_sobrecarga_hidrica_w,
   ie_mapeamento_retina_w,
   ie_retinografia_w,
   ie_avaliacao_lacrimal_w,
   ie_distancia_pupilar_w,
   ie_auto_refracao_w,
   ie_biometria_w,
   ie_tomografia_olho_w,
   ie_aberrometria_ocular_w,
   ie_care_directive_w ,
   ie_wound_mngmnt_w ,
    ie_ecm_w ,
    ie_infection_control_w ,
    ie_estimated_discharge_w ,
    ie_dschrg_tnsfr_sumry_w ,
    ie_events_w ,
    ie_justf_requests_w ,
    ie_call_history_w ,
    ie_nursing_actions_w ,
    ie_icunsw_w ,
    ie_death_certf_w ,
    ie_procedures_w,
    ie_time_motion_w ,
    ie_instrument_w ,
    ie_intraoperative_care_w ,
    ie_equipment_w,
    ie_attach_assmnt_w ,
    ie_attach_consents_w ,
    ie_attach_just_req_w ,
    ie_attach_care_dir_w ,
    ie_attach_death_cert_w ,
    ie_attach_mpi_w ,
    ie_attach_pathology_w ,    
    ie_attach_imaging_diag_w,
    ie_dispositivo_w,
    ie_tourniquet_w, 
    ie_diathermy_w ,
    ie_spec_path_w ,
    ie_demarcation_w, 
    ie_demarcation_conf_w,
    ie_plano_cuidado_w,
    ie_ciap_w,
    ie_encaminhamento_w,
    ie_ged_w
from	prontuario_emissao a,
	pessoa_fisica b
where	a.cd_pessoa_fisica = b.cd_pessoa_fisica
and	a.nr_sequencia	= nr_sequencia_p;


if (coalesce(nr_atendimento_p,0) > 0) then
	select	cd_estabelecimento
	into STRICT	cd_estabelecimento_w
	from	atendimento_paciente
	where	nr_atendimento	= nr_atendimento_p;
end if;

if (coalesce(nr_seq_episodio_p, 0) > 0) then
	select	coalesce(max(cd_estabelecimento), 0)
	into STRICT	cd_estabelecimento_w
	from	atendimento_paciente
	where	nr_seq_episodio = nr_seq_episodio_p;
end if;	

ie_lib_evolucao_w := obter_param_usuario(0, 37, obter_perfil_ativo, nm_usuario_p, 0, ie_lib_evolucao_w);
ie_resumo_descricao_pepo_w := obter_param_usuario(872, 7, obter_perfil_ativo, nm_usuario_p, wheb_usuario_pck.get_cd_estabelecimento, ie_resumo_descricao_pepo_w);
ie_mostra_excluidos_w := obter_param_usuario(900, 211, obter_perfil_ativo, nm_usuario_p, wheb_usuario_pck.get_cd_estabelecimento, ie_mostra_excluidos_w);
ie_lib_escala_w := obter_param_usuario(281, 858, obter_perfil_ativo, nm_usuario_p, wheb_usuario_pck.get_cd_estabelecimento, ie_lib_escala_w);

SELECT	coalesce(MAX(ie_lib_anamnese),'N'),
	coalesce(MAX(ie_lib_atestado),'N'),
	coalesce(MAX(ie_lib_diag_medico),'N'),
	coalesce(MAX(ie_lib_sinal_vital),'N'),
	coalesce(MAX(ie_lib_receita),'N'),
	coalesce(MAX(ie_lib_orientacao_alta),'N'),
	coalesce(MAX(ie_liberar_hist_saude),'N'),
	coalesce(MAX(ie_lib_consentimento),'N'),
	coalesce(MAX(ie_libera_medic_pepo),'N'),
	coalesce(MAX(ie_libera_terapia_pepo),'N'),
	coalesce(MAX(ie_libera_hemoder_pepo),'N'),
	coalesce(MAX(ie_libera_posicao),'N'),
	coalesce(MAX(ie_libera_material_pepo),'N'),
	coalesce(MAX(ie_libera_pele),'N'),
	coalesce(MAX(ie_libera_incisao),'N'),
	coalesce(MAX(ie_libera_curativo),'N'),
	coalesce(MAX(ie_lib_fatur_med),'N'),
	coalesce(MAX(ie_libera_agente_pepo),'N'),
	coalesce(MAX(ie_libera_anestesia),'N'),
	coalesce(max(ie_liberar_desfecho),'N'),
   coalesce(max(ie_libera_exames_oft),'N')
into STRICT	ie_lib_anamnese_w,
	ie_lib_atestado_w,
	ie_lib_diag_medico_w,
	ie_lib_sinal_vital_w,
	ie_lib_receita_w,
	ie_lib_orientacao_alta_w,
	ie_lib_hist_saude_w,
	ie_lib_consentimento_w,
	ie_lib_medicmaneto_pepo_w,
	ie_libera_terapia_pepo_w,
	ie_libera_hemoder_pepo_w,
	ie_libera_posicao_pepo_w,
	ie_libera_material_pepo_w,
	ie_libera_pele_pepo_w,
	ie_libera_incisao_pepo_w,
	ie_libera_curativo_pepo_w,
	ie_lib_fatur_med_pepo_w,
	ie_libera_agente_pepo_w,
	ie_libera_anestesia_pepo_w,
	ie_lib_desfecho_w,
  ie_libera_exames_oft_w
from	parametro_medico
where	cd_estabelecimento	= cd_estabelecimento_w;

commit;

if (ie_evolucao_w = 'S') then
	for c01_w in c01 loop
                begin
                obterDadosAnteriores;
                insert into prontuario_emissao_item(
                        nr_sequencia,
                        dt_atualizacao,
                        nm_usuario,
                        dt_atualizacao_nrec,
                        nm_usuario_nrec,
                        nr_seq_item,
                        ie_tipo_item,
                        cd_pessoa_fisica,
                        dt_registro,
                        nm_pessoa_fisica,
                        ie_sexo,
                        nr_atendimento)
                values (	nextval('prontuario_emissao_item_seq'),
                        clock_timestamp(),
                        nm_usuario_p,
                        clock_timestamp(),
                        nm_usuario_p,
                        c01_w.cd_evolucao,
                        'EVOL',
                        cd_pessoa_fisica_p,
                        trunc(c01_w.dt_evolucao,'dd'),
                        coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
                        coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
                        c01_w.nr_atendimento);
                end;
	end loop;
end if;

if (ie_prescricao_w = 'S') then
        for C02_w in C02 loop
		begin

		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C02_w.nr_prescricao,
			'PRESCR',
			cd_pessoa_fisica_p,
			trunc(C02_w.dt_prescricao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C02_w.nr_atendimento);
			
		end;
	end loop;
end if;

/*
values(	prontuario_emissao_item_seq.nextval,
			sysdate,
			nm_usuario_p,
			sysdate,
			nm_usuario_p,
			C03_w.nr_sequencia,
			'ANAMN',
			cd_pessoa_fisica_p,
			trunc(C03_w.dt_anamnese,'dd'),
			nvl(nm_pessoa_fisica_w,decode(nm_pessoa_fisica_new_w, null, '0', nm_pessoa_fisica_w)),
			nvl(ie_sexo_w, decode(ie_sexo_new_w, null, '0', ie_sexo_w)),
			C03_w.nr_atendimento);
                        */
if (ie_anamnese_w = 'S') then
        for C03_w in C03 loop
		begin
		
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C03_w.nr_sequencia,
			'ANAMN',
			cd_pessoa_fisica_p,
			trunc(C03_w.dt_ananmese,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C03_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_atestado_w = 'S') then
        for C04_w in C04 loop
		begin
		
		obterDadosAnteriores;

		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C04_w.nr_sequencia,
			'ATEST',
			cd_pessoa_fisica_p,
			trunc(C04_w.dt_atestado,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C04_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_sinais_vitais_w = 'S') then
        for C05_w in C05 loop
		begin
			
		obterDadosAnteriores;
											
											
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C05_w.nr_sequencia,
			'SV',
			cd_pessoa_fisica_p,
			trunc(C05_w.dt_sinal_vital,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C05_w.nr_atendimento);
		end;
	end loop;
end if;
if (ie_sinais_vitais_w = 'S') then
        for C042_w in C042 loop
		begin
			
		obterDadosAnteriores;
											
											
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C042_w.nr_sequencia,
			'SVHEMOD',
			cd_pessoa_fisica_p,
			trunc(C042_w.DT_MONITORACAO,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C042_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_sinais_vitais_w = 'S') then
        for C043_w in C043 loop
		begin
			
		obterDadosAnteriores;
											
											
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C043_w.nr_sequencia,
			'SVRESP',
			cd_pessoa_fisica_p,
			trunc(C043_w.DT_MONITORIZACAO,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C043_w.nr_atendimento);
		end;
	end loop;
end if;
if (ie_diagnostico_w = 'S') then
        for C06_w in C06 loop
		begin
		
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C06_w.nr_atendimento,
			'DIAG',
			cd_pessoa_fisica_p,
			trunc(C06_w.dt_diagnostico,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C06_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_exame_lab_w = 'S') then
        for C07_w in C07 loop
		begin

		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C07_w.nr_prescricao,
			'EXAMLAB',
			cd_pessoa_fisica_p,
			trunc(C07_w.dt_prescricao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C07_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_laudo_w = 'S') then
        for C08_w in C08 loop
		begin

		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C08_w.nr_sequencia,
			'LAUDO',
			cd_pessoa_fisica_p,
			trunc(C08_w.dt_laudo,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C08_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_historico_saude_w = 'S') then
        for C09_w in C09 loop
		begin

		obterDadosAnteriores;
											
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C09_w.cd_pessoa_fisica,
			'HISTSAUDE',
			cd_pessoa_fisica_p,
			trunc(C09_w.dt_registro,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C09_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_oftalmologia_w = 'S') then
        for C10_w in C10 loop
		begin
		
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C10_w.nr_sequencia,
			'OFT',
			cd_pessoa_fisica_p,
			trunc(C10_w.dt_consulta,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (ie_orientacao_alta_w = 'S') then
        for C11_w in C11 loop
		begin

		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C11_w.nr_sequencia,
			'ORIALTA',
			cd_pessoa_fisica_p,
			trunc(C11_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C11_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_orientacoes_gerais_w = 'S') then
        for C42_w in C42 loop
		begin

		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C42_w.nr_sequencia,
			'ORIGERAL',
			cd_pessoa_fisica_p,
			trunc(C42_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C42_w.nr_atendimento);
		end;

	end loop;
end if;

if (ie_parecer_medico_w = 'S') then
        for C12_w in C12 loop
		begin
		
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C12_w.nr_parecer,
			'PARECER',
			cd_pessoa_fisica_p,
			trunc(C12_w.dt_liberacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C12_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_receita_w = 'S') then
        for C13_w in C13 loop
		begin

		obterDadosAnteriores;
											
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C13_w.nr_sequencia,
			'RECEITA',
			cd_pessoa_fisica_p,
			trunc(C13_w.dt_receita,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C13_w.nr_atendimento_hosp);
		end;
	end loop;
	
    for C30_w in C30 loop
		begin

		obterDadosAnteriores;
											
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C30_w.nr_sequencia,
			'OUTPRESCR',
			cd_pessoa_fisica_p,
			trunc(C30_w.dt_receita,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C30_w.nr_atendimento);
		end;
	end loop;

end if;

if (ie_care_directive_w = 'S') then
        for C31_w in C31 loop
		begin
		
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C31_w.nr_sequencia,
			'CARDIRPEP',
			cd_pessoa_fisica_p,
			trunc(C31_w.DT_REGISTRATION,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C31_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_wound_mngmnt_w = 'S') then
        for C32_w in C32 loop
		begin
		
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C32_w.nr_sequencia,
			'WNDMGNTPEP',
			cd_pessoa_fisica_p,
			trunc(C32_w.dt_liberacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C32_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_ecm_w = 'S') then
        for C33_w in C33 loop
		begin
		
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C33_w.nr_sequencia,
			'ATTACHMENTSPEP',
			cd_pessoa_fisica_p,
			trunc(C33_w.DT_REGISTRO,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C33_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_ecm_w = 'S') then
        for C78_w in C78 loop
		begin

		obterDadosAnteriores;

		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C78_w.nr_sequencia,
			'ECOUNTERATTACH',
			cd_pessoa_fisica_p,
			trunc(C78_w.DT_ATUALIZACAO,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C78_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_infection_control_w = 'S') then
        for C34_w in C34 loop
		begin
		
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C34_w.nr_sequencia,
			'INFCNTRLPEP',
			cd_pessoa_fisica_p,
			trunc(C34_w.DT_REGISTRO,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C34_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_estimated_discharge_w = 'S') then
    for C35_w in C35 loop
		begin
		
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C35_w.nr_sequencia,
			'ESTDDSCHDTPEP',
			cd_pessoa_fisica_p,
			trunc(C35_w.DT_REGISTRO,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C35_w.nr_atendimento);
		end;
	end loop;

    for C35_1_w in C35_1 loop
		begin
		
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C35_1_w.nr_sequencia,
			'ESTDSDEPTPEP',
			cd_pessoa_fisica_p,
			trunc(C35_1_w.DT_PROBABILIDADE_ALTA,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C35_1_w.nr_atendimento);
		end;
	end loop;

    for C35_2_w in C35_2 loop
		begin
		
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C35_2_w.nr_sequencia,
			'ESTDSCONTPEP',
			cd_pessoa_fisica_p,
			trunc(C35_2_w.DT_ATUALIZACAO,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C35_2_w.nr_atendimento);
		end;
	end loop;

  
end if;

if (ie_dschrg_tnsfr_sumry_w  = 'S') then
    for C36_w in C36 loop
		begin

		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C36_w.nr_sequencia,
			'DSCTRNFSUMPEP',
			cd_pessoa_fisica_p,
			trunc(C36_w.DT_ALTA,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C36_w.nr_atendimento);
		end;
	end loop;

  for C37_w in C37 loop
		begin
		
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C37_w.nr_sequencia,
			'DSCHINTRCTNPEP',
			cd_pessoa_fisica_p,
			trunc(C37_w.dt_registro,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C37_w.nr_atendimento);
		end;
	end loop;

end if;

if (ie_events_w = 'S') then -- EVENTPEP
        for C38_w in C38 loop
		begin
		
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C38_w.nr_sequencia,
			'EVENTPEP',
			cd_pessoa_fisica_p,
			trunc(C38_w.dt_evento,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C38_w.nr_atendimento);
		end;
	end loop;

end if;

if (IE_JUSTF_REQUESTS_w = 'S') then -- JUSTREQPEP
        for C39_w in C39 loop
		begin
		
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C39_w.nr_sequencia,
			'JUSTREQPEP',
			cd_pessoa_fisica_p,
			trunc(C39_w.dt_JUSTIFICATIVA,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C39_w.nr_atendimento);
		end;
	end loop;

end if;

if (IE_CALL_HISTORY_w = 'S') then -- JUSTREQPEP
        for C100_w in C100 loop
		begin
		
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C100_w.nr_sequencia,
			'CALLHISPEP',
			cd_pessoa_fisica_p,
			trunc(C100_w.dt_chamado,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C100_w.nr_atendimento);
		end;
	end loop;

end if;

if (IE_NURSING_ACTIONS_w = 'S') then -- NUROUTACTIONSPEP
        for C101_w in C101 loop
		begin
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C101_w.nr_sequencia,
			'NUROUTACTSPEP',
			cd_pessoa_fisica_p,
			trunc(C101_w.DT_ANOTACAO,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C101_w.nr_atendimento);
		end;
	end loop;

end if;

if (IE_ICUNSW_w = 'S') then -- ICUNSW
        for C102_w in C102 loop
		begin
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C102_w.nr_sequencia,
			'ICUNSWPEP',
			cd_pessoa_fisica_p,
			trunc(C102_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C102_w.nr_atendimento);
		end;
	end loop;

end if;

if (IE_DEATH_CERTF_w = 'S') then -- ICUNSW
        for C103_w in C103 loop
		begin
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C103_w.nr_sequencia,
			'DEATHCERTFPEP',
			cd_pessoa_fisica_p,
			trunc(C103_w.dt_obito,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C103_w.nr_atendimento);
		end;
	end loop;

    for C121_w in C121 loop
		begin
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C121_w.nr_sequencia,
			'BRAINDEATHPEP',
			cd_pessoa_fisica_p,
			trunc(C121_w.DT_DECLARACAO,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C121_w.nr_atendimento);
		end;
	end loop;

  
end if;

if (ie_procedures_w = 'S') then -- ICUNSW
        for C108_w in C108 loop
		begin
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C108_w.nr_sequencia,
			'PROCEDURESPEP',
			cd_pessoa_fisica_p,
			trunc(C108_w.dt_registro,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C108_w.nr_atendimento);
		end;
	end loop;

end if;

if (ie_attach_assmnt_w = 'S') then
        for C109_w in C109 loop
		begin
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C109_w.nr_sequencia,
			'ATTACHASMNTPEP',
			cd_pessoa_fisica_p,
			trunc(C109_w.DT_ATUALIZACAO,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C109_w.nr_atendimento);
		end;
	end loop;

end if;

if (ie_attach_consents_w = 'S') then
        for C110_w in C110 loop
		begin
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C110_w.nr_sequencia,
			'ATTCONSENTPEP',
			cd_pessoa_fisica_p,
			trunc(C110_w.DT_ATUALIZACAO_NREC,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C110_w.nr_atendimento);
		end;
	end loop;

end if;

--ie_attach_just_req_w     prontuario_emissao.ie_attach_just_req%type ; 
if (ie_attach_just_req_w = 'S') then
        for C111_w in C111 loop
		begin
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C111_w.nr_sequencia,
			'ATTJUSTREQPEP',
			cd_pessoa_fisica_p,
			trunc(C111_w.DT_ATUALIZACAO,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C111_w.nr_atendimento);
		end;
	end loop;

end if;

if (ie_attach_care_dir_w = 'S') then
        for C112_w in C112 loop
		begin
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C112_w.nr_sequencia,
			'ATTCAREDIRPEP',
			cd_pessoa_fisica_p,
			trunc(C112_w.DT_ATUALIZACAO,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C112_w.nr_atendimento);
		end;
	end loop;

end if;

if (ie_attach_death_cert_w = 'S') then
        for C113_w in C113 loop
		begin
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C113_w.nr_sequencia,
			'ATTDEATHCERT',
			cd_pessoa_fisica_p,
			trunc(C113_w.DT_obito,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C113_w.nr_atendimento);
		end;
	end loop;

end if;

if (ie_attach_mpi_w = 'S') then
    for C114_w in C114 loop
		begin
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C114_w.nr_sequencia,
			'ATTCONSENTMPI',
			cd_pessoa_fisica_p,
			trunc(C114_w.DT_ATUALIZACAO_NREC,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			null);
		end;
	end loop;

   for C115_w in C115 loop
		begin
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C115_w.nr_sequencia,
			'ATTDOCUMENTMPI',
			cd_pessoa_fisica_p,
			trunc(C115_w.DT_ATUALIZACAO_NREC,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			null);
		end;
	end loop;
end if;

if (ie_dispositivo_w = 'S') then
    for C120_w in C120 loop
		begin
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C120_w.nr_sequencia,
			'DEVICESPEP',
			cd_pessoa_fisica_p,
			trunc(C120_w.DT_INSTALACAO,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C120_w.nr_atendimento);
		end;
	end loop;

  end if;


if (ie_consentimento_W = 'S') then
        for C14_w in C14 loop
		begin

		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C14_w.nr_sequencia,
			'CONSENTIMENTO',
			cd_pessoa_fisica_p,
			trunc(C14_w.dt_liberacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (ie_sae_w = 'S') then
        for C15_w in C15 loop
		begin
		obterDadosAnteriores;				
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C15_w.nr_sequencia,
			'SAE',
			cd_pessoa_fisica_p,
			trunc(C15_w.dt_prescricao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C15_w.nr_atendimento);
		end;
	end loop;

  for C124_w in C124 loop
		begin
		obterDadosAnteriores;				
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C124_w.nr_sequencia,
			'SAENEW',
			cd_pessoa_fisica_p,
			trunc(C124_w.dt_prescricao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C124_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_plano_cuidado_w = 'S') then
	for C125_w in C125 loop
		begin
		obterDadosAnteriores;				
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C125_w.nr_sequencia,
			'PLC',
			cd_pessoa_fisica_p,
			trunc(C125_w.dt_prescricao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C125_w.nr_atendimento);
		end;
	end loop;
end if;
-- CIAP
if (ie_ciap_w = 'S') then
	for C27_w in C27 loop
		begin
		obterDadosAnteriores;				
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C27_w.nr_sequencia,
			'CIAP',
			cd_pessoa_fisica_p,
			trunc(C27_w.dt_registro,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C27_w.nr_atendimento);
		end;
	end loop;
end if;	

if (ie_solic_exame_ext_w = 'S') then
        for C16_w in C16 loop
		begin
		obterDadosAnteriores;									
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C16_w.nr_sequencia,
			'EXAMEEXT',
			cd_pessoa_fisica_p,
			trunc(C16_w.dt_solicitacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C16_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_consulta_amb_w = 'S') then
        for C17_w in C17 loop
		begin
		
		obterDadosAnteriores;		
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C17_w.nr_sequencia,
			'CONSAMB',
			cd_pessoa_fisica_p,
			trunc(C17_w.dt_registro,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (ie_ganhos_perdas_w = 'S') then
        for C18_w in C18 loop
		begin
		obterDadosAnteriores;
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C18_w.nr_sequencia,
			'GP',
			cd_pessoa_fisica_p,
			trunc(C18_w.dt_medida,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C18_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_obs_nasc_w = 'S') then
        for C19_w in C19 loop
		begin
			
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C19_w.nr_atendimento,
			'OBSNASC',
			cd_pessoa_fisica_p,
			trunc(C19_w.dt_nascimento,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C19_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_avaliacao_w = 'S') then
        for C20_w in C20 loop
		begin

		obterDadosAnteriores;

		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C20_w.nr_sequencia,
			'AVAL',
			cd_pessoa_fisica_p,
			trunc(C20_w.dt_avaliacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C20_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_checkup_w = 'S') then
        for C21_w in C21 loop
		begin
		
		obterDadosAnteriores;				
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C21_w.cd_evolucao,
			'CHECKUP',
			cd_pessoa_fisica_p,
			trunc(C21_w.dt_evolucao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			C21_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_checkup_w = 'S') then
        for C22_w in C22 loop
		begin
		obterDadosAnteriores;
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C22_w.nr_sequencia,
			'CHECKUP',
			cd_pessoa_fisica_p,
			trunc(C22_w.dt_registro,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (ie_checkup_w = 'S') then
        for C23_w in C23 loop
		begin
		obterDadosAnteriores;
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C23_w.nr_sequencia,
			'CHECKUP',
			cd_pessoa_fisica_p,
			trunc(C23_w.dt_registro,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (ie_checkup_w = 'S') then
        for C24_w in C24 loop
		begin
		obterDadosAnteriores;
		
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C24_w.nr_sequencia,
			'CHECKUP',
			cd_pessoa_fisica_p,
			trunc(C24_w.dt_atualizacao_nrec,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (ie_diagnostico_tumor_w = 'S') then
        for C25_w in C25 loop
		begin
		obterDadosAnteriores;
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C25_w.nr_sequencia,
			'DIAGTUMOR',
			cd_pessoa_fisica_p,
			trunc(C25_w.dt_avaliacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (ie_tratam_onc_w = 'S') then
        for C26_w in C26 loop
		begin
		obterDadosAnteriores;					
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C26_w.nr_seq_paciente,
			'ONCOLOGIA',
			cd_pessoa_fisica_p,
			trunc(C26_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (ie_alertas_w = 'S') then
        for C41_w in C41 loop
		begin
		obterDadosAnteriores;
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C41_w.nr_sequencia,
			C41_w.ie_tipo_item,
			cd_pessoa_fisica_p,
			trunc(C41_w.dt_alerta,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;
/* ----------------------------------------------------- Inicio itens do PEPO	-----------------------------------------------------  */

if (ie_agentes_anestesicos_w = 'S') then
        for C027_w in C027 loop
		begin
		obterDadosAnteriores;
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C027_w.nr_sequencia,
			'AGENTESPEPO',
			cd_pessoa_fisica_p,
			trunc(C027_w.dt_atualizacao_nrec,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;


if (ie_terapia_hidroeletrolitica_w = 'S') then
        for C028_w in C028 loop
		begin
		obterDadosAnteriores;
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C028_w.nr_sequencia,
			'TERAPIAHELETRO',
			cd_pessoa_fisica_p,
			trunc(C028_w.dt_atualizacao_nrec,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (ie_medicamentos_w = 'S') then
        for C029_w in C029 loop
		begin
		obterDadosAnteriores;
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C029_w.nr_sequencia,
			'MEDICAMENTOEPO',
			cd_pessoa_fisica_p,
			trunc(C029_w.dt_atualizacao_nrec,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (ie_tecnica_descricao_w = 'S') then
        for C030_w in C030 loop
		begin
		obterDadosAnteriores;
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C030_w.nr_sequencia,
			'TECNICADESCPEPO',
			cd_pessoa_fisica_p,
			trunc(C030_w.dt_atualizacao_nrec,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;


if (ie_hemoderivados_w = 'S') then
        for C031_w in C031 loop
		begin
		obterDadosAnteriores;
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C031_w.nr_sequencia,
			'HEMODERIVADPEPO',
			cd_pessoa_fisica_p,
			trunc(C031_w.dt_atualizacao_nrec,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (ie_posicao_w = 'S') then
        for C032_w in C032 loop
		begin
		obterDadosAnteriores;
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C032_w.nr_sequencia,
			'POSICAOPEPO',
			cd_pessoa_fisica_p,
			trunc(C032_w.dt_atualizacao_nrec,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (ie_materiais_w = 'S') then
        for C033_w in C033 loop
		begin
		obterDadosAnteriores;
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C033_w.nr_sequencia,
			'MATERIAISPEPO',
			cd_pessoa_fisica_p,
			trunc(C033_w.dt_atualizacao_nrec,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (ie_pele_w = 'S') then
        for C034_w in C034 loop
		begin
		obterDadosAnteriores;
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C034_w.nr_sequencia,
			'PELEPEPO',
			cd_pessoa_fisica_p,
			trunc(C034_w.dt_atualizacao_nrec,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;


if (ie_incisao_w = 'S') then
        for C035_w in C035 loop
                begin
		obterDadosAnteriores;
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C035_w.nr_sequencia,
			'INSICAOPEPO',
			cd_pessoa_fisica_p,
			trunc(C035_w.dt_atualizacao_nrec,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;



if (ie_curativo_w = 'S') then
        for C036_w in C036 loop
		begin
		obterDadosAnteriores;
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C036_w.nr_sequencia,
			'CURATIVOPEPO',
			cd_pessoa_fisica_p,
			trunc(C036_w.dt_atualizacao_nrec,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (ie_apae_w = 'S') then
        for C037_w in C037 loop
		begin
		obterDadosAnteriores;				
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C037_w.nr_sequencia,
			'APAEPEPO',
			cd_pessoa_fisica_p,
			trunc(C037_w.dt_atualizacao_nrec,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;


if (ie_resumo_descricao_w = 'S') then
        for C038_w in C038 loop
		begin
		obterDadosAnteriores;
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C038_w.nr_sequencia,
			'RESUMODESCPEPO',
			cd_pessoa_fisica_p,
			trunc(C038_w.dt_registro,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (ie_faturamento_medico_w = 'S') then
        for C039_w in C039 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C039_w.nr_sequencia,
			'FATURAMEDPEPO',
			cd_pessoa_fisica_p,
			trunc(C039_w.dt_atualizacao_nrec,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (ie_utilizados_cirurgia_w = 'S') then
        for C041_w in C041 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C041_w.nr_sequencia,
			'MATMEDUTILPEPO',
			cd_pessoa_fisica_p,
			trunc(C041_w.dt_conta,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (ie_escala_w = 'S') then
	
	begin
	
	delete from prontuario_emissao_dados where nm_usuario = nm_usuario_p;
	commit;
	open CursorEscalas for
		SELECT  ie_escala, 
		' select ' || '''' || replace(obter_valor_dominio(1799, IE_ESCALA),chr(39),'')  	|| '''' 								|| ' nm_escala, ' 	|| 
					' nr_sequencia, '												||
					case when ie_escala in (170,171) then ' null ' else 'nr_atendimento 'end ||' nr_atendimento, '   ||
					case when ie_escala in (170,171) then 'cd_pessoa_fisica' else 'obter_pessoa_atendimento(nr_atendimento,''C'') 'end ||' cd_pessoa_fisica, '	||
					case when ie_escala in (2,3,4,7,10,170,171) then 'cd_pessoa_fisica' else 'cd_profissional' end		|| ' cd_profissional, '	||
					nm_atributo_data 										|| ' dt_registro, '	||
					coalesce(qt_pontuacao,'''''')									|| ' qt_pontuacao, '	|| 
					coalesce(ds_pontuacao,'''''') || CASE WHEN ie_escala=5 THEN ' ||''%''' WHEN ie_escala=64 THEN  ' ||''%''' END  					|| ' ds_pontuacao ' 	||
					' from   ' || nm_tabela 									||
					' where ' || case when ie_escala in (170,171) 
								   then 'cd_pessoa_fisica = '||coalesce(cd_pessoa_fisica_p,0) 
								   else ' nr_atendimento  = ' || coalesce(nr_atendimento_p,0) end                        		||
					 CASE WHEN ie_escala=112 THEN  ' and nvl(ie_cam_icu_modificada,''S'') = ''N'' ' WHEN ie_escala=135 THEN  ' and nvl(ie_cam_icu_modificada,''N'') = ''S'' ' WHEN ie_escala=23 THEN  ' and nvl(ie_tipo_avaliacao,''X'') = ''D'' ' WHEN ie_escala=39 THEN  ' and nvl(ie_tipo_avaliacao,''X'') = ''O'' ' WHEN ie_escala=169 THEN  ' and nvl(ie_tipo_avaliacao,''X'') = ''A'' ' END  				||
					' and    dt_inativacao is null '									||
					' and    (('''||ie_lib_escala_w||''' = ''N'') or (dt_liberacao is not null))  ' || 
          ' and    ((  pkg_i18n.get_user_locale <> ''en_AU'' ) or (( pkg_i18n.get_user_locale = ''en_AU'')  and  ' ||  nm_atributo_data || ' between to_date(''' ||  dt_inicio_ww  || ''' , ''DD/MM/YYYY'') and fim_dia(to_date ( ''' || dt_final_ww|| ''',''DD/MM/YYYY'' ))))  '   ds_sql
		from    (
				(SELECT   max(CASE WHEN ie_tipo_atributo='VARCHAR2' THEN null WHEN ie_tipo_atributo='FUNCTION' THEN null  ELSE nm_atributo_inf END ) qt_pontuacao,
						max(CASE WHEN ie_tipo_atributo='VARCHAR2' THEN  CASE WHEN ie_escala=57 THEN 'IE_RISCO || '' - ''|| DS_RESULTADO'  ELSE ds_function END  WHEN ie_tipo_atributo='FUNCTION' THEN  ds_function WHEN ie_tipo_atributo='NUMBER' THEN  CASE WHEN ie_escala=109 THEN  '''Risco: ''|| PR_RISCO'  ELSE null END    ELSE null END ) ds_pontuacao,
						max(nm_atributo_data) nm_atributo_data, 
						max(nm_tabela) nm_tabela, 
						ie_escala
				from    vice_escala         d
				where ie_escala in (1,31,23,169,39,102,118,33,2,115,
						45,4,44,112,135,73,97,72,75,98,
						89,131,82,119,125,129,10,88,3,64,
						5,121,149,81,70,60,139,54,19,55,
						183,24,48,59,42,7,47,56,53,109,
						142,168,18)
				group by ie_escala)
				
union

				select null qt_pontuacao, ds_toxicidade_w ds_pontuacao, 'DT_AVALIACAO' nm_atributo_data, 'ESCALA_TOXIDADE' nm_tabela, 105 ie_escala 
				
union

				select null qt_pontuacao, ds_creatinina_w ds_pontuacao, 'DT_AVALIACAO' nm_atributo_data, 'PAC_CLEREANCE_CREATININA' nm_tabela, 17 ie_escala 
				
union

				select null qt_pontuacao, ds_graceII_w ds_pontuacao,  'DT_AVALIACAO' nm_atributo_data, 'ESCALA_GRACE_II' nm_tabela, 177 ie_escala 	
				
union

				select null qt_pontuacao, ds_aval_nutri_global_w ds_pontuacao, 'DT_AVALIACAO' nm_atributo_data, 'AVAL_NUTRIC_SUBJETIVA' nm_tabela, 169 ie_escala 
				
union

				select null qt_pontuacao, ds_possum_w ds_pontuacao, 'DT_AVALIACAO' nm_atributo_data, 'ESCALA_POSSUM' nm_tabela, 36 ie_escala 
        
union

        select null qt_pontuacao, 'substr(Obter_grau_depend_nicotina(QT_PONTOS),1,100)' ds_pontuacao, 'DT_AVALIACAO' nm_atributo_data, 'ESCALA_FARGESTROM' nm_tabela, 14 ie_escala 
        
union

        select null qt_pontuacao , null ds_pontuacao, 'DT_AVALIACAO' nm_atributo_data, 'ESCALA_STEWART' nm_tabela, 71 ie_escala 
        
union

        select null QT_PONTUACAO , null ds_pontuacao, 'DT_AVALIACAO' nm_atributo_data, 'ESCALA_ASIA' nm_tabela, 96 ie_escala 
        
union
 
        select null QT_PONTUACAO , null ds_pontuacao, 'DT_AVALIACAO' nm_atributo_data, 'ESCALA_MOCA' nm_tabela, 104 ie_escala 
        
union

        select null QT_PONTUACAO , null ds_pontuacao, 'DT_AVALIACAO' nm_atributo_data, 'ESCALA_WAT' nm_tabela, 157 ie_escala 
        
union

        select 'QT_SCORE' QT_PONTUACAO , ' substr(obter_desc_escala_cam_original(qt_score),1,255)' ds_pontuacao, 'DT_AVALIACAO' nm_atributo_data, 'ESCALA_CAM_ICU_ORIGINAL' nm_tabela, 204 ie_escala 
        
union

        select 'QT_SCORE' QT_PONTUACAO , ' substr(obter_desc_escala_cognitive(qt_score),1,255)' ds_pontuacao, 'DT_REGISTRO' nm_atributo_data, 'ESCALA_COGNITIVE' nm_tabela, 205 ie_escala 
        
union

        select 'QT_SCORE' QT_PONTUACAO , ' substr(obter_desc_escala_copd(qt_score),1,255)' ds_pontuacao, 'DT_REGISTRO' nm_atributo_data, 'ESCALA_COPD' nm_tabela, 206 ie_escala 
        
union

        select 'QT_SCORE' QT_PONTUACAO , ' substr(obter_desc_escala_hamilton(qt_score),1,255)' ds_pontuacao, 'DT_AVALIACAO' nm_atributo_data, 'ESCALA_HAMILTON' nm_tabela, 207 ie_escala 
        
union

        select 'QT_PONTUACAO' QT_PONTUACAO , ' obter_desc_escala_curb65(QT_PONTUACAO)' ds_pontuacao, 'DT_AVALIACAO' nm_atributo_data, 'ESCALA_CURB65' nm_tabela, 208 ie_escala 
        
union

        select 'QT_PONTUACAO' QT_PONTUACAO , ' substr(obter_desc_escala_perc(qt_pontuacao),1,255)' ds_pontuacao, 'DT_AVALIACAO' nm_atributo_data, 'ESCALA_PERC' nm_tabela, 209 ie_escala 
        
union

        select 'QT_ABCD2' QT_PONTUACAO , ' obter_desc_escala_abcd2(QT_ABCD2)' ds_pontuacao, 'DT_AVALIACAO' nm_atributo_data, 'ESCALA_ABCD2' nm_tabela, 210 ie_escala 
        
union

        select 'QT_AWS' QT_PONTUACAO , ' obter_desc_escala_aws(QT_AWS)' ds_pontuacao, 'DT_AVALIACAO' nm_atributo_data, 'ESCALA_AWS' nm_tabela, 211 ie_escala 
        
union

        select null QT_PONTUACAO , null ds_pontuacao, 'DT_AVALIACAO' nm_atributo_data, 'ESCALA_BRISTOL' nm_tabela, 212 ie_escala 
        
union

        select 'QT_WATERLOW' QT_PONTUACAO , ' obter_desc_escala_waterlow(QT_WATERLOW)' ds_pontuacao, 'DT_AVALIACAO' nm_atributo_data, 'ESCALA_WATERLOW' nm_tabela, 213 ie_escala 
        
union

        select 'QT_VTE' QT_PONTUACAO , ' obter_desc_escala_vte(qt_vte)' ds_pontuacao, 'DT_REGISTRO' nm_atributo_data, 'ESCALA_VTE' nm_tabela, 224 ie_escala 
        
union

        select 'QT_DOWNTON' QT_PONTUACAO , ' obter_descr_downton_index(QT_DOWNTON) ' ds_pontuacao, 'DT_REGISTRO' nm_atributo_data, 'ESCALA_DOWNTON_INDEX' nm_tabela, 225 ie_escala 
        
union

        select null QT_PONTUACAO , null ds_pontuacao, 'DT_REGISTRO' nm_atributo_data, 'ESCALA_ASIA_MOD' nm_tabela, 226 ie_escala 
				) d;
	loop
	fetch CursorEscalas into
			ie_escalas_w,
			ds_sql_w;
	EXIT WHEN NOT FOUND; /* apply on CursorEscalas */

		begin
    commit;
		open CursorRegistrosEscala for EXECUTE ds_sql_w;
		loop
		fetch CursorRegistrosEscala into
			nm_escala_w,
			nr_sequencia_w,
			nr_atendimento_w,
			cd_pessoa_fisica_w,
			cd_profissional_w,
			dt_registro_w,
			qt_pontuacao_w,
			ds_pontuacao_w;	
		EXIT WHEN NOT FOUND; /* apply on CursorRegistrosEscala */
			
			begin
			obterDadosAnteriores;

				insert into prontuario_emissao_item(
					nr_sequencia,
					dt_atualizacao,
					nm_usuario,
					dt_atualizacao_nrec,
					nm_usuario_nrec,
					nr_seq_item,
					ie_tipo_item,
					cd_pessoa_fisica,
					dt_registro,
					nm_pessoa_fisica,
					ie_sexo,
					nr_atendimento,
					ie_escala
					)
				values (
					nextval('prontuario_emissao_item_seq'),
					clock_timestamp(),
					nm_usuario_p,
					clock_timestamp(),
					nm_usuario_p,
					nr_sequencia_w,
					'ESC',
					cd_pessoa_fisica_p,
					trunc(dt_registro_w,'dd'),
					coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
					coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
					nr_atendimento_w,
					ie_escalas_w
				);
						
				insert into prontuario_emissao_dados(
					nr_sequencia,
					dt_atualizacao,
					nm_usuario,
					nr_atendimento,
					ie_escala,
					nr_seq_registro,
					cd_profissional,
					dt_registro,
					qt_pontuacao,
					ds_pontuacao
					)
				values (
					nextval('prontuario_emissao_dados_seq'),
					clock_timestamp(),
					nm_usuario_p,
					nr_atendimento_w,
					ie_escalas_w,
					nr_sequencia_w,
					cd_profissional_w,
					dt_registro_w,
					qt_pontuacao_w,
					ds_pontuacao_w 			
					);

			end;
		end loop;
		close CursorRegistrosEscala;
		
		end;
		
	end loop;

	close CursorEscalas;

	commit;

	end;
	
end if;

if (ie_tourniquet_w = 'S') then
        for C105_w in C105 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C105_w.nr_sequencia,
			C105_w.ie_tipo_item,
			cd_pessoa_fisica_p,
			trunc(C105_w.DT_RECORD,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (ie_diathermy_w = 'S') then
        for C205_w in C205 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C205_w.nr_sequencia,
			C205_w.ie_tipo_item,
			cd_pessoa_fisica_p,
			trunc(C205_w.DT_RECORD,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (ie_spec_path_w = 'S') then
        for C206_w in C206 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C206_w.nr_sequencia,
			C206_w.ie_tipo_item,
			cd_pessoa_fisica_p,
			trunc(C206_w.DT_RECORD,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (ie_demarcation_w = 'S') then
        for C207_w in C207 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C207_w.nr_sequencia,
			C207_w.ie_tipo_item,
			cd_pessoa_fisica_p,
			trunc(C207_w.DT_MARCACAO,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (ie_demarcation_conf_w = 'S') then
        for C208_w in C208 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C208_w.nr_sequencia,
			C208_w.ie_tipo_item,
			cd_pessoa_fisica_p,
			trunc(C208_w.DT_REGISTRO,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (IE_TIME_MOTION_w = 'S') then
    for C104_w in C104 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C104_w.nr_sequencia,
			'TIMEMOTIONPEPO',
			cd_pessoa_fisica_p,
			trunc(C104_w.DT_REGISTRO,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;

    for C123_w in C123 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C123_w.nr_sequencia,
			'DELAYJUSTFPEPO',
			cd_pessoa_fisica_p,
			trunc(C123_w.DT_ATUALIZACAO,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;

    for C122_w in C122 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C122_w.nr_sequencia,
			'SURGTIMEPEPO',
			cd_pessoa_fisica_p,
			trunc(C122_w.DT_ATUALIZACAO,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;

end if;

if (IE_EQUIPMENT_w = 'S') then
        for C106_w in C106 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C106_w.nr_sequencia,
			'EQUIPMENTOSPEPO',
			cd_pessoa_fisica_p,
			trunc(C106_w.DT_INICIO,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;

if (IE_INSTRUMENT_w = 'S') then
        for C107_w in C107 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			C107_w.nr_sequencia,
			'INSTRTRACKPEPO',
			cd_pessoa_fisica_p,
			trunc(C107_w.DT_ORIGEM,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ));
		end;
	end loop;
end if;


/* ----------------------------------------------------- Fim itens do PEPO	-----------------------------------------------------  */



/*Template*/

if (ie_template_w = 'S') then
        for c40_w in c40 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c40_w.nr_sequencia,
			'TEMPLATEPEP',
			cd_pessoa_fisica_p,
			trunc(c40_w.dt_registro,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c40_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_curva_tensional_w = 'S') then
        for c43_w in c43 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c43_w.nr_sequencia,
			'CURVATENSIONAL',
			cd_pessoa_fisica_p,
			trunc(c43_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c43_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_fotocoagulacao_w = 'S') then
        for c44_w in c44 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c44_w.nr_sequencia,
			'FOTOCOAGULACAO',
			cd_pessoa_fisica_p,
			trunc(c44_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c44_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_capsulotomia_w = 'S') then
        for c45_w in c45 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c45_w.nr_sequencia,
			'CAPSULOTOMIA',
			cd_pessoa_fisica_p,
			trunc(c45_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c45_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_ultrassonografia_w = 'S') then
        for c46_w in c46 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c46_w.nr_sequencia,
			'ULTRASSONOGRA',
			cd_pessoa_fisica_p,
			trunc(c46_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c46_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_tomografia_coerencia_w = 'S') then
        for c47_w in c47 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c47_w.nr_sequencia,
			'TOMOCOERENCIA',
			cd_pessoa_fisica_p,
			trunc(c47_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c47_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_refracao_w = 'S') then
        for c48_w in c48 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c48_w.nr_sequencia,
			'REFRACAO',
			cd_pessoa_fisica_p,
			trunc(c48_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c48_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_gonioscopia_w = 'S') then
        for c49_w in c49 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c49_w.nr_sequencia,
			'GONIOSCOPIA',
			cd_pessoa_fisica_p,
			trunc(c49_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c49_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_biomicroscopia_w = 'S') then
        for c50_w in c50 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c50_w.nr_sequencia,
			'BIOMICROSCOPIA',
			cd_pessoa_fisica_p,
			trunc(c50_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c50_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_fundoscopia_w = 'S') then
        for c51_w in c51 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c51_w.nr_sequencia,
			'FUNDOSCOPIA',
			cd_pessoa_fisica_p,
			trunc(c51_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c51_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_microscopia_especular_w = 'S') then
        for c52_w in c52 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c52_w.nr_sequencia,
			'MICROESPECULAR',
			cd_pessoa_fisica_p,
			trunc(c52_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c52_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_angiofluoresceinografia_w = 'S') then
        for c53_w in c53 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c53_w.nr_sequencia,
			'ANGIOFLUORES',
			cd_pessoa_fisica_p,
			trunc(c53_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c53_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_anamnese_inicial_w = 'S') then
        for c54_w in c54 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c54_w.nr_sequencia,
			'ANAMNESEINICIAL',
			cd_pessoa_fisica_p,
			trunc(c54_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c54_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_exame_ocular_externo_w = 'S') then
        for c55_w in c55 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c55_w.nr_sequencia,
			'EXAMEEXTERNO',
			cd_pessoa_fisica_p,
			trunc(c55_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c55_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_motilidade_ocular_w = 'S') then
        for c56_w in c56 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c56_w.nr_sequencia,
			'MOTILIDADECOMP',
			cd_pessoa_fisica_p,
			trunc(c56_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c56_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_tonometria_pneumatica_w = 'S') then
        for c57_w in c57 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c57_w.nr_sequencia,
			'TONOMETRIAPNEU',
			cd_pessoa_fisica_p,
			trunc(c57_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c57_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_receita_oculos_w = 'S') then
        for c58_w in c58 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c58_w.nr_sequencia,
			'RECEITAOCULOS',
			cd_pessoa_fisica_p,
			trunc(c58_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c58_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_tonometria_aplanacao_w = 'S') then
        for c59_w in c59 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c59_w.nr_sequencia,
			'TONOMETRIAAPLA',
			cd_pessoa_fisica_p,
			trunc(c59_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c59_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_conduta_w = 'S') then
        for c60_w in c60 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c60_w.nr_sequencia,
			'CONDUTA',
			cd_pessoa_fisica_p,
			trunc(c60_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c60_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_paquimetria_w = 'S') then
        for c61_w in c61 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c61_w.nr_sequencia,
			'PAQUIMETRIA',
			cd_pessoa_fisica_p,
			trunc(c61_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c61_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_campimetria_w = 'S') then
        for c62_w in c62 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c62_w.nr_sequencia,
			'CAMPIMETRIA',
			cd_pessoa_fisica_p,
			trunc(c62_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c62_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_ceratometria_w = 'S') then
        for c63_w in c63 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c63_w.nr_sequencia,
			'CERATOMETRIA',
			cd_pessoa_fisica_p,
			trunc(c63_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c63_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_potencial_acuidade_w = 'S') then
        for c64_w in c64 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c64_w.nr_sequencia,
			'POTENCIALACUI',
			cd_pessoa_fisica_p,
			trunc(c64_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c64_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_iridectomia_w = 'S') then
        for c65_w in c65 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c65_w.nr_sequencia,
			'IRIDECTOMIA',
			cd_pessoa_fisica_p,
			trunc(c65_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c65_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_daltonismo_w = 'S') then
        for c66_w in c66 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c66_w.nr_sequencia,
			'DALTONISMO',
			cd_pessoa_fisica_p,
			trunc(c66_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c66_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_sobrecarga_hidrica_w = 'S') then
        for c67_w in c67 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c67_w.nr_sequencia,
			'SOBRECARGA',
			cd_pessoa_fisica_p,
			trunc(c67_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c67_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_mapeamento_retina_w = 'S') then
        for c68_w in c68 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c68_w.nr_sequencia,
			'MAPEAMENTORETI',
			cd_pessoa_fisica_p,
			trunc(c68_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c68_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_retinografia_w = 'S') then
        for c69_w in c69 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c69_w.nr_sequencia,
			'RETINOGRAFIA',
			cd_pessoa_fisica_p,
			trunc(c69_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c69_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_avaliacao_lacrimal_w = 'S') then
        for c70_w in c70 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c70_w.nr_sequencia,
			'AVALLACRIMAL',
			cd_pessoa_fisica_p,
			trunc(c70_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c70_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_distancia_pupilar_w = 'S') then
        for c71_w in c71 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c71_w.nr_sequencia,
			'DISTANCIAPUPILA',
			cd_pessoa_fisica_p,
			trunc(c71_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c71_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_auto_refracao_w = 'S') then
        for c72_w in c72 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c72_w.nr_sequencia,
			'AUTOREFRACAO',
			cd_pessoa_fisica_p,
			trunc(c72_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c72_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_biometria_w = 'S') then
        for c73_w in c73 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c73_w.nr_sequencia,
			'BIOMETRIA',
			cd_pessoa_fisica_p,
			trunc(c73_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c73_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_tomografia_olho_w = 'S') then
        for c74_w in c74 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c74_w.nr_sequencia,
			'TOMOGRAFIAOLHO',
			cd_pessoa_fisica_p,
			trunc(c74_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c74_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_pupilometria_w = 'S') then
        for c75_w in c75 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c75_w.nr_sequencia,
			'PUPILOMETRIA',
			cd_pessoa_fisica_p,
			trunc(c75_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c75_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_acuidade_visual_w = 'S') then
        for c76_w in c76 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c76_w.nr_sequencia,
			'ACUIDADEVISUAL',
			cd_pessoa_fisica_p,
			trunc(c76_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c76_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_aberrometria_ocular_w = 'S') then
        for c77_w in c77 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c77_w.nr_sequencia,
			'ABERROMETRIA',
			cd_pessoa_fisica_p,
			trunc(c77_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c77_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_encaminhamento_w = 'S') then
        for c126_w in c126 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c126_w.nr_sequencia,
			'ENCAM',
			cd_pessoa_fisica_p,
			trunc(c126_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c126_w.nr_atendimento);
		end;
	end loop;
end if;

if (ie_ged_w = 'S') then
        for c127_w in c127 loop
		begin
		obterDadosAnteriores;			
		insert into prontuario_emissao_item(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_item,
			ie_tipo_item,
			cd_pessoa_fisica,
			dt_registro,
			nm_pessoa_fisica,
			ie_Sexo,
			nr_atendimento)
		values (	nextval('prontuario_emissao_item_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			c127_w.nr_sequencia,
			'GED',
			cd_pessoa_fisica_p,
			trunc(c127_w.dt_atualizacao,'dd'),
			coalesce(nm_pessoa_fisica_w,CASE WHEN coalesce(nm_pessoa_fisica_new_w::text, '') = '' THEN  '0'  ELSE nm_pessoa_fisica_w END ),
			coalesce(ie_sexo_w, CASE WHEN coalesce(ie_sexo_new_w::text, '') = '' THEN  '0'  ELSE ie_sexo_w END ),
			c127_w.nr_atendimento);
		end;
	end loop;
end if;

commit;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_emissao_prontuario (nr_sequencia_p bigint, nr_atendimento_p bigint, cd_pessoa_fisica_p text, nm_usuario_p text, nr_seq_episodio_p bigint default null) FROM PUBLIC;

