-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_processo_conta_html5 ( nr_seq_processo_p processo_atendimento.nr_sequencia%type, nr_atendimento_p atendimento_paciente.nr_atendimento%type, ie_tipo_acao_p text, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: Atualizar dados do processo função: Conta Paciente
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ x] HTML5
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
ie_tipo_acao_p
BP -  baixar processo
AP - adiar processo
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
BEGIN

--Baixar processo
if ( ie_tipo_acao_p = 'BP' ) then

	update	processo_atendimento
	set	dt_fim_real	= clock_timestamp(),
		ie_status	= 'F',
		nm_usuario	= nm_usuario_p
	where	nr_sequencia 	= nr_seq_processo_p
	and	nr_atendimento 	= nr_atendimento_p;
--Adiar processo
elsif ( ie_tipo_acao_p = 'AP' ) then

	update	processo_atendimento
	set	dt_fim_real	 = NULL,
		ie_status	= 'A',
		dt_fim_prev	= (clock_timestamp()+ nr_min_prev / 1440),
		nm_usuario	= nm_usuario_p
	where	nr_sequencia 	= nr_seq_processo_p
	and	nr_atendimento 	= nr_atendimento_p
	and	(nr_min_prev IS NOT NULL AND nr_min_prev::text <> '');

end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_processo_conta_html5 ( nr_seq_processo_p processo_atendimento.nr_sequencia%type, nr_atendimento_p atendimento_paciente.nr_atendimento%type, ie_tipo_acao_p text, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;

