-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE mims_imp_dcb_medic ( cd_dcb_p text, ds_dcb_p text, nm_usuario_p text, nr_sequencia_p INOUT bigint, nr_mims_ver_p bigint) AS $body$
DECLARE

nr_sequencia_w bigint;
dcb_medic_controlado_w imp_dcb_medic_controlado%rowtype;

BEGIN
SELECT	MAX(nr_sequencia)
        INTO STRICT	nr_sequencia_w
        FROM	imp_dcb_medic_controlado
        WHERE	cd_dcb = cd_dcb_p
		and nr_seq_mims_version = nr_mims_ver_p;

        IF (coalesce(nr_sequencia_w::text, '') = '') THEN
                SELECT	nextval('imp_dcb_medic_controlado_seq')
                INTO STRICT	nr_sequencia_w
;

                dcb_medic_controlado_w.nr_sequencia        := nr_sequencia_w;
                dcb_medic_controlado_w.cd_dcb              := cd_dcb_p;
                dcb_medic_controlado_w.ds_dcb              := ds_dcb_p;
                dcb_medic_controlado_w.nm_usuario          := nm_usuario_p;
                dcb_medic_controlado_w.nm_usuario_nrec     := nm_usuario_p;
                dcb_medic_controlado_w.dt_atualizacao      := clock_timestamp();
                dcb_medic_controlado_w.dt_atualizacao_nrec := clock_timestamp();
                dcb_medic_controlado_w.ie_situacao         := 'A';
		dcb_medic_controlado_w.nr_seq_mims_version := nr_mims_ver_p;

		INSERT INTO	imp_dcb_medic_controlado 
		VALUES (dcb_medic_controlado_w.*);

        END IF;
        nr_sequencia_p := nr_sequencia_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE mims_imp_dcb_medic ( cd_dcb_p text, ds_dcb_p text, nm_usuario_p text, nr_sequencia_p INOUT bigint, nr_mims_ver_p bigint) FROM PUBLIC;

