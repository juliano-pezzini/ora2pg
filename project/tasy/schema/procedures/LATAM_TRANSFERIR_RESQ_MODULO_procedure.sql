-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE latam_transferir_resq_modulo ( nr_sequencia_p LATAM_REQUISITO.NR_SEQUENCIA%type, nr_seq_gap_p LATAM_REQUISITO.NR_SEQ_GAP%type, nr_seq_modulo_p LATAM_REQUISITO.NR_SEQ_MODULO%type ) AS $body$
DECLARE


ie_type_requirement_w   LATAM_REQUISITO.IE_TYPE_REQUIREMENT%type;
nr_seq_superior_w       LATAM_REQUISITO.NR_SEQ_SUPERIOR%type;
ie_liberar_desenv_old_w LATAM_REQUISITO.IE_LIBERAR_DESENV%type;
nm_usuario_w            LATAM_REQUISITO.NM_USUARIO%type;


BEGIN

nm_usuario_w := wheb_usuario_pck.get_nm_usuario;

SELECT IE_TYPE_REQUIREMENT,
       NR_SEQ_SUPERIOR
INTO STRICT   ie_type_requirement_w,
       nr_seq_superior_w
FROM   LATAM_REQUISITO
WHERE  NR_SEQUENCIA = nr_sequencia_p;

IF ie_type_requirement_w = 'BR' THEN
    UPDATE LATAM_REQUISITO SET	
           NR_SEQ_MODULO   = nr_seq_modulo_p,
           NR_SEQ_GAP      = nr_seq_gap_p,
           NM_USUARIO      = nm_usuario_w,
           DT_ATUALIZACAO  = clock_timestamp()
    WHERE  NR_SEQ_SUPERIOR = nr_sequencia_p;
ELSIF coalesce(ie_type_requirement_w, 'SR') = 'SR' AND (nr_seq_superior_w IS NOT NULL AND nr_seq_superior_w::text <> '') THEN
    CALL wheb_mensagem_pck.exibir_mensagem_abort(1181916);
END IF;

UPDATE    LATAM_REQUISITO SET	
          NR_SEQ_MODULO     = nr_seq_modulo_p,
          NR_SEQ_GAP        = nr_seq_gap_p,
          NM_USUARIO        = nm_usuario_w,
          DT_ATUALIZACAO    = clock_timestamp()
WHERE     NR_SEQUENCIA      = nr_sequencia_p
RETURNING IE_LIBERAR_DESENV into ie_liberar_desenv_old_w;

COMMIT;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE latam_transferir_resq_modulo ( nr_sequencia_p LATAM_REQUISITO.NR_SEQUENCIA%type, nr_seq_gap_p LATAM_REQUISITO.NR_SEQ_GAP%type, nr_seq_modulo_p LATAM_REQUISITO.NR_SEQ_MODULO%type ) FROM PUBLIC;

