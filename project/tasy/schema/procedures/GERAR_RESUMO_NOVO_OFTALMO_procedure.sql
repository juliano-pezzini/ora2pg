-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_resumo_novo_oftalmo ( cd_estabelecimento_p bigint, nr_seq_consulta_p bigint, cd_pessoa_fisica_p text, ie_mostra_todos_p text, nm_usuario_p text) AS $body$
DECLARE

					 
nr_seq_item_w	bigint;	
nr_seq_aval_w	bigint;
nr_seq_apresentacao_w	bigint;
					
C01 CURSOR FOR 
	SELECT	nr_seq_item   
	from	configuracao_oft_resumo 
	order by nr_seq_apresentacao desc;
	
C11 CURSOR FOR 
	SELECT	a.nr_sequencia 
	FROM	med_avaliacao_paciente a, 
		med_tipo_avaliacao b 
	WHERE	b.nr_sequencia 		= a.nr_seq_tipo_avaliacao 
	AND	a.nr_atendimento 	= (SELECT MAX(nr_atendimento) FROM oft_consulta WHERE nr_sequencia = nr_seq_consulta_p) 
	AND	b.ie_resumo_oftalmo 	= 'S';	
	 

BEGIN 
 
delete from w_oft_resumo;
 
commit;
 
open C01;
loop 
fetch C01 into	 
	nr_seq_item_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin 
	if (nr_seq_item_w = 2) then 
		CALL gerar_resumo_anamnese(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);	
	elsif (nr_seq_item_w = 20) then 
		CALL gerar_resumo_acuidade(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 19) then 
		CALL gerar_resumo_correcao(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 9) then 
		CALL gerar_resumo_fundoscopia(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 8) then 
		CALL gerar_resumo_tonometria(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,1,nm_usuario_p);
	elsif (nr_seq_item_w = 23) then 
		CALL gerar_resumo_tonometria(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,2,nm_usuario_p);
	elsif (nr_seq_item_w = 17) then 
		CALL gerar_resumo_dnp(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 10) then 
		CALL gerar_resumo_biomicroscopia(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 4) then 
		CALL gerar_resumo_auto_refracao(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 4) then 
		CALL gerar_resumo_refracao(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 4) then 
		CALL gerar_resumo_ceratometria(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 175) then 
		CALL gerar_resumo_item_ceratometria(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 69) then 
		CALL gerar_resumo_curva_tencional(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 78) then 
		CALL gerar_resumo_biometria(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 80) then 
		CALL gerar_resumo_microscopia_esp(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 82) then 
		CALL gerar_resumo_pupilometria(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 71) then 
		CALL gerar_resumo_angio_retino(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 73) then 
		CALL gerar_resumo_gonioscopia(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 7) then 
		CALL gerar_resumo_motilidade_ocular(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 86) then 
		CALL gerar_res_motil_ocular_compl(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 84) then 
		CALL gerar_resumo_paquimetria(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 13) then 
		CALL gerar_resumo_oculos(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 160) then 
		CALL gerar_resumo_orien_geral(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 6) then 
		CALL gerar_resumo_exame_externo(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 28) then 
		CALL gerar_resumo_ates_paciente(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 24) then 
		CALL gerar_resumo_conduta(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 21) then 
		CALL gerar_resumo_pep_pac_ci(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 12) then 
		CALL gerar_resumo_diagnostico(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 14) then 
		CALL gerar_resumo_consulta_lente(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 89) then 
		CALL gerar_resumo_prescr_medica(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 16) then 
		CALL gerar_resumo_med_receita(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	--elsif  (nr_seq_item_w = 220) then 
		--gerar_resumo_avaliacoes(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p); 
	elsif (nr_seq_item_w = 162) then 
		CALL gerar_resumo_evolucoes(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	elsif (nr_seq_item_w = 165) then 
		CALL gerar_resumo_laudo_paciente(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);		
	elsif (nr_seq_item_w = 236) then 
		CALL gerar_resumo_potenc_acuidade(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	ELSIF (nr_seq_item_w = 220) THEN 
		OPEN C11;
		LOOP 
		FETCH C11 INTO 
			nr_seq_aval_w;
		EXIT WHEN NOT FOUND; /* apply on C11 */
			BEGIN 
			CALL gerar_resumo_aval_oft(nr_seq_aval_w,nm_usuario_p);
			END;
		END LOOP;
		CLOSE C11;
	ELSIF (nr_seq_item_w = 236) THEN 
		CALL gerar_resumo_potenc_acuidade(cd_estabelecimento_p,nr_seq_consulta_p,cd_pessoa_fisica_p,ie_mostra_todos_p,nr_seq_item_w,nm_usuario_p);
	END IF;
	END;
END LOOP;
CLOSE C01;
 
COMMIT;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_resumo_novo_oftalmo ( cd_estabelecimento_p bigint, nr_seq_consulta_p bigint, cd_pessoa_fisica_p text, ie_mostra_todos_p text, nm_usuario_p text) FROM PUBLIC;

