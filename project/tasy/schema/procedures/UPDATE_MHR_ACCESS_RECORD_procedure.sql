-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE update_mhr_access_record ( nm_usuario_p mhr_access_record.nm_usuario%type , cd_pessoa_fisica_p mhr_access_record.cd_pessoa_fisica%type , nr_seq_person_ihi_p mhr_access_record.nr_seq_person_ihi%type , ie_status_p mhr_access_record.ie_status%type , ie_access_type_p mhr_access_record.ie_access_type%type ) AS $body$
DECLARE


ie_status_w				mhr_access_record.ie_status%type;
nr_sequencia_w			mhr_access_record.nr_sequencia%type;
nr_seq_person_ihi_w		mhr_access_record.nr_seq_person_ihi%type;


BEGIN

	select 	max(nr_sequencia),
			max(ie_status),
			max(nr_seq_person_ihi)
	into STRICT	nr_sequencia_w,
			ie_status_w,
			nr_seq_person_ihi_w
	from 	mhr_access_record
	where 	cd_pessoa_fisica = cd_pessoa_fisica_p;
	
	if (nr_sequencia_w IS NOT NULL AND nr_sequencia_w::text <> '')	then
	
		if ((nr_seq_person_ihi_p IS NOT NULL AND nr_seq_person_ihi_p::text <> '') and nr_seq_person_ihi_p <> 0) then
			nr_seq_person_ihi_w := nr_seq_person_ihi_p;
		end if;
	
		update 		mhr_access_record
		set			nm_usuario = nm_usuario_p,
					nr_seq_person_ihi = nr_seq_person_ihi_w,
					ie_status = ie_status_p,
					ie_access_type = ie_access_type_p,
					--dt_atualizacao = sysdate,
					dt_last_access = clock_timestamp()
		where		nr_sequencia = nr_sequencia_w;
		
		commit;
			
	else
	
		insert into mhr_access_record(nr_sequencia, nm_usuario, cd_pessoa_fisica, nr_seq_person_ihi, ie_status, ie_access_type, dt_atualizacao, dt_last_access )
		values (nextval('mhr_access_record_seq'), nm_usuario_p, cd_pessoa_fisica_p, nr_seq_person_ihi_p, ie_status_p, ie_access_type_p, clock_timestamp(), clock_timestamp() );
		
		commit;
	
	end if;


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE update_mhr_access_record ( nm_usuario_p mhr_access_record.nm_usuario%type , cd_pessoa_fisica_p mhr_access_record.cd_pessoa_fisica%type , nr_seq_person_ihi_p mhr_access_record.nr_seq_person_ihi%type , ie_status_p mhr_access_record.ie_status%type , ie_access_type_p mhr_access_record.ie_access_type%type ) FROM PUBLIC;

