-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_dados_padrao_banda ( nr_seq_relatorio_p bigint, cd_relatorio_p bigint, nr_tipo_banda_p bigint, nm_usuario_p text) AS $body$
DECLARE


nm_relatorio_w varchar(80);
ds_campo_w varchar(80);
qt_campo_banda_w bigint;
qt_tamanho_banda_w bigint;
qt_altura_banda_w bigint;
cd_relatorio_w varchar(20);


BEGIN

	select count(nr_sequencia)
	into STRICT qt_campo_banda_w
	from relatorio_dinamico
	where nr_seq_relatorio = nr_seq_relatorio_p
	and nr_tipo_banda = nr_tipo_banda_p
	and cd_relatorio = cd_relatorio_p;

	if (qt_campo_banda_w > 0) then

		select max(qt_tamanho_banda),
		max(qt_altura_banda)
		into STRICT qt_tamanho_banda_w,
		qt_altura_banda_w
		from relatorio_dinamico
		where nr_seq_relatorio = nr_seq_relatorio_p
		and nr_tipo_banda = nr_tipo_banda_p
		and cd_relatorio = cd_relatorio_p;

	end if;

        select max(ds_titulo),
		max(cd_classif_relat) || ' - ' || max(cd_relatorio)
		into STRICT nm_relatorio_w,
		cd_relatorio_w
		from relatorio
		where nr_sequencia = nr_seq_relatorio_p
		and cd_relatorio = cd_relatorio_p;

	if (nr_tipo_banda_p = 1 and qt_campo_banda_w = 0) then /*header*/
		select substr(obter_desc_expressao(628060),0,80)
		into STRICT ds_campo_w
		;

		/*report name*/

		insert into relatorio_dinamico(
      nr_sequencia,        -- 1
			dt_atualizacao,      -- 2  
			nm_usuario,          -- 3
			dt_atualizacao_nrec, -- 4
			nm_usuario_nrec,     -- 5
			cd_relatorio,        -- 6
			cd_tipo,             -- 7
			ds_label,            -- 8
			nr_eixo_y,           -- 9
			nr_eixo_x,           -- 10
			nr_altura,           -- 11
			nr_comprimento,      -- 12
			qt_rotacao,          -- 13
			nm_label,            -- 14
			ie_ajustar_tamanho,  -- 15
			nr_seq_apres,        -- 16
			nr_tipo_banda,       -- 17
			nr_seq_relatorio,    -- 18
			qt_tamanho_banda,    -- 19
			qt_altura_banda,     -- 20
      ie_alinhamento,      -- 21
      ie_tipo_campo        -- 22
      )
		values (
      nextval('relatorio_dinamico_seq'), -- 1
			clock_timestamp(),                        -- 2
			nm_usuario_p,                   -- 3
			clock_timestamp(),                        -- 4
			nm_usuario_p,                   -- 5
			cd_relatorio_p,                 -- 6
			'N',                            -- 7
			null,                 -- 8
			'4',                            -- 9
			'0',                            -- 10
			'17',                           -- 11
			'720',                          -- 12
			'0',                            -- 13
			ds_campo_w,                     -- 14
			'S',                            -- 15
			'2',                            -- 16
			'1',                            -- 17
			nr_seq_relatorio_p,             -- 18
			coalesce(qt_tamanho_banda_w,'200'),  -- 19
			coalesce(qt_altura_banda_w,'500'),   -- 20
      'C',                            -- 21
      1                              -- 22
      );

	elsif (qt_campo_banda_w = 0) then/*footer*/
		select substr(obter_desc_expressao(286681),0,80)
		into STRICT ds_campo_w
		;

		/*report date*/

		insert into relatorio_dinamico(
      nr_sequencia,        -- 1
			dt_atualizacao,      -- 2
			nm_usuario,          -- 3
			dt_atualizacao_nrec, -- 4
			nm_usuario_nrec,     -- 5
			cd_relatorio,        -- 6
			cd_tipo,             -- 7
			ds_label,            -- 8
			nr_eixo_y,           -- 9
			nr_eixo_x,           -- 10
			nr_altura,           -- 11
			nr_comprimento,      -- 12
			qt_rotacao,          -- 13
			nm_label,            -- 14
			ie_ajustar_tamanho,  -- 15
			nr_seq_apres,        -- 16
			nr_tipo_banda,       -- 17
			nr_seq_relatorio,    -- 18
			qt_tamanho_banda,    -- 19
			qt_altura_banda      -- 20
      )
		values (
      nextval('relatorio_dinamico_seq'),-- 1
			clock_timestamp(),                       -- 2
			nm_usuario_p,                  -- 3
			clock_timestamp(),                       -- 4
			nm_usuario_p,                  -- 5
			cd_relatorio_p,                -- 6
			'D',                           -- 7
			null,                    -- 8
			'1',                           -- 9
			'1',                           -- 10
			'20',                          -- 11
			'40',                          -- 12
			'0',                           -- 13
			ds_campo_w,                    -- 14
			'S',                           -- 15
			'1',                           -- 16
			'4',                           -- 17
			nr_seq_relatorio_p,            -- 18
			coalesce(qt_tamanho_banda_w,'200'), -- 19
			coalesce(qt_altura_banda_w,'500')   -- 20
      );

		select substr(obter_desc_expressao(486594),0,80)
		into STRICT ds_campo_w
		;

		/*page*/

		insert into relatorio_dinamico(
      nr_sequencia,        -- 1
			dt_atualizacao,      -- 2
			nm_usuario,          -- 3
			dt_atualizacao_nrec, -- 4   
			nm_usuario_nrec,     -- 5
			cd_relatorio,        -- 6
			cd_tipo,             -- 7
			ds_label,            -- 8
			nr_eixo_y,           -- 9
			nr_eixo_x,           -- 10
			nr_altura,           -- 11
			nr_comprimento,      -- 12
			qt_rotacao,          -- 13
			nm_label,            -- 14
			ie_ajustar_tamanho,  -- 15
			nr_seq_apres,        -- 16
			nr_tipo_banda,       -- 17
			nr_seq_relatorio,    -- 18
			qt_tamanho_banda,    -- 19
			qt_altura_banda      -- 20
      )
		values (
      nextval('relatorio_dinamico_seq'), -- 1
			clock_timestamp(),                        -- 2
			nm_usuario_p,                   -- 3
			clock_timestamp(),                        -- 4
			nm_usuario_p,                   -- 5
			cd_relatorio_p,                 -- 6
			'P',                            -- 7
			null,                            -- 8
			'1',                            -- 9
			'1',                            -- 10
			'20',                           -- 11
			'40',                           -- 12
			'0',                            -- 13
			ds_campo_w,                     -- 14
			'S',                            -- 15
			'2',                            -- 16
			'4',                            -- 17
			nr_seq_relatorio_p,             -- 18
			coalesce(qt_tamanho_banda_w,'200'),  -- 19
			coalesce(qt_altura_banda_w,'500')    -- 20
      );

		select substr(obter_desc_expressao(314533),0,80) 
		into STRICT ds_campo_w
		;

		/*user*/

		insert into relatorio_dinamico(
      nr_sequencia,        -- 1
			dt_atualizacao,      -- 2  
			nm_usuario,          -- 3
			dt_atualizacao_nrec, -- 4   
			nm_usuario_nrec,     -- 5
			cd_relatorio,        -- 6
			cd_tipo,             -- 7
			ds_label,            -- 8
			nr_eixo_y,           -- 9
			nr_eixo_x,           -- 10
			nr_altura,           -- 11
			nr_comprimento,      -- 12
			qt_rotacao,          -- 13
			nm_label,            -- 14
			ie_ajustar_tamanho,  -- 15
			nr_seq_apres,        -- 16
			nr_tipo_banda,       -- 17
			nr_seq_relatorio,    -- 18
			qt_tamanho_banda,    -- 19
			qt_altura_banda      -- 20
      )
		values (
      nextval('relatorio_dinamico_seq'), -- 1
			clock_timestamp(),                        -- 2
			nm_usuario_p,                   -- 3
			clock_timestamp(),                        -- 4
			nm_usuario_p,                   -- 5
			cd_relatorio_p,                 -- 6
			'U',                            -- 7
      null,              -- 8
			'1',                            -- 9
			'1',                            -- 10
			'20',                           -- 11
			'40',                           -- 12
			'0',                            -- 13
			ds_campo_w,                     -- 14
			'S',                            -- 15
			'3',                            -- 16
			'4',                            -- 17
			nr_seq_relatorio_p,             -- 18
			coalesce(qt_tamanho_banda_w,'200'),  -- 19
			coalesce(qt_altura_banda_w,'500')    -- 20
      );

		select substr(obter_desc_expressao(285435),0,80)
		into STRICT ds_campo_w
		;

		/*report type code*/

		insert into relatorio_dinamico(
      nr_sequencia,        -- 1
			dt_atualizacao,      -- 2
			nm_usuario,          -- 3
			dt_atualizacao_nrec, -- 4   
			nm_usuario_nrec,     -- 5
			cd_relatorio,        -- 6
			cd_tipo,             -- 7
			ds_label,            -- 8
			nr_eixo_y,           -- 9
			nr_eixo_x,           -- 10
			nr_altura,           -- 11
			nr_comprimento,      -- 12
			qt_rotacao,          -- 13
			nm_label,            -- 14
			ie_ajustar_tamanho,  -- 15
			nr_seq_apres,        -- 16
			nr_tipo_banda,       -- 17
			nr_seq_relatorio,    -- 18
			qt_tamanho_banda,    -- 19
			qt_altura_banda      -- 20
      )
		values (
      nextval('relatorio_dinamico_seq'), -- 1
			clock_timestamp(),                        -- 2
			nm_usuario_p,                   -- 3
			clock_timestamp(),                        -- 4
			nm_usuario_p,                   -- 5
			cd_relatorio_p,                 -- 6
			'C',                            -- 7
			null,    -- 8
			'1',                            -- 9
			'1',                            -- 10
			'20',                           -- 11
			'40',                           -- 12
			'0',                            -- 13
			ds_campo_w,                     -- 14
			'S',                            -- 15
			'4',                            -- 16
			'4',                            -- 17
			nr_seq_relatorio_p,             -- 18
			coalesce(qt_tamanho_banda_w,'200'),  -- 19
			coalesce(qt_altura_banda_w,'500')    -- 20
      );
	end if;
	
	CALL ajustar_posicao_campos(nr_seq_relatorio_p, nr_tipo_banda_p);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_dados_padrao_banda ( nr_seq_relatorio_p bigint, cd_relatorio_p bigint, nr_tipo_banda_p bigint, nm_usuario_p text) FROM PUBLIC;

