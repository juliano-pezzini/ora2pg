-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_consistir_vinculo_agravo ( nr_seq_segurado_agravo_p bigint, vl_agravo_p bigint, qt_parcelas_p bigint, ds_erro_p INOUT text, nm_usuario_p text, tx_agravo_p pls_segurado_agravo.tx_agravo%type) AS $body$
DECLARE


vl_agravo_w		double precision;
qt_parcelas_w		bigint;
ds_erro_w		varchar(255)	:= '';
qt_parcelas_geradas_w	bigint;
tx_agravo_w	pls_segurado_agravo.tx_agravo%type;
	

BEGIN

select	count(*)
into STRICT	qt_parcelas_geradas_w
from	pls_segurado_agravo_parc
where	nr_seq_segurado_agravo	= nr_seq_segurado_agravo_p;

if (coalesce(qt_parcelas_geradas_w,0) <> 0) then
	select	vl_agravo,
		qt_parcelas,
		tx_agravo
	into STRICT	vl_agravo_w,
		qt_parcelas_w,
		tx_agravo_w
	from	pls_segurado_agravo
	where	nr_sequencia	= nr_seq_segurado_agravo_p;

	if	(vl_agravo_p <> vl_agravo_w AND qt_parcelas_p <> qt_parcelas_w) then
		ds_erro_w	:= wheb_mensagem_pck.get_texto(280928);
	elsif (qt_parcelas_p <> qt_parcelas_w) then
		ds_erro_w	:= wheb_mensagem_pck.get_texto(280931);
	elsif (vl_agravo_p <> vl_agravo_w) then
		ds_erro_w	:= wheb_mensagem_pck.get_texto(280932);
	elsif (coalesce(tx_agravo_p, 0) <> coalesce(tx_agravo_w,0)) then
		ds_erro_w	:= wheb_mensagem_pck.get_texto(1088378);
	end if;

	ds_erro_p	:= ds_erro_w;
else
	ds_erro_p	:= '';
end if;
	
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_consistir_vinculo_agravo ( nr_seq_segurado_agravo_p bigint, vl_agravo_p bigint, qt_parcelas_p bigint, ds_erro_p INOUT text, nm_usuario_p text, tx_agravo_p pls_segurado_agravo.tx_agravo%type) FROM PUBLIC;

