-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_consistir_codific_classif ( nr_seq_regra_esquema_p bigint, nr_seq_esquema_seg_p bigint, ie_codificacao_p text, vl_fixo_p text, cd_conta_contabil_p text, ie_debito_credito_p text, nm_usuario_p text) AS $body$
DECLARE


qt_regras_w		bigint;
qt_regras_reduzido_w	bigint;
qt_regras_pj_w		bigint;


BEGIN

if (ie_codificacao_p	= 'FX') and (coalesce(vl_fixo_p::text, '') = '') then
	CALL wheb_mensagem_pck.exibir_mensagem_abort( 203214, null);
	/* Para a codificação "Fixo", é necessário informar um valor no campo "Valor fixo". Favor verifique! */

end if;

if (ie_codificacao_p	= 'CR') and (coalesce(cd_conta_contabil_p::text, '') = '') then
	CALL wheb_mensagem_pck.exibir_mensagem_abort( 203215, null);
	/* Para a codificação "Código reduzido", é necessário informar um valor no campo "Código reduzido". Favor verifique! */

elsif (ie_codificacao_p	= 'CR') then
	select	count(*)
	into STRICT	qt_regras_w
	from	pls_esquema_contabil_seg
	where	nr_seq_regra_esquema	= nr_seq_regra_esquema_p
	and	nr_sequencia		<> nr_seq_esquema_seg_p
	and	ie_debito_credito	= ie_debito_credito_p;

	if (qt_regras_w > 0) then
		CALL wheb_mensagem_pck.exibir_mensagem_abort( 203216, null);
		/* Já foram informadas outras regras para esse esquema. Favor verifique! */

	end if;
end if;

select	count(*)
into STRICT	qt_regras_reduzido_w
from	pls_esquema_contabil_seg
where	nr_seq_regra_esquema	= nr_seq_regra_esquema_p
and	nr_sequencia		<> nr_seq_esquema_seg_p
and	ie_debito_credito	= ie_debito_credito_p
and	ie_codificacao		= 'CR';

if (qt_regras_reduzido_w > 0) then
	CALL wheb_mensagem_pck.exibir_mensagem_abort( 203217, null);
	/* Já foi informado um código reduzido para essa regra. Favor verifique! */

end if;

select	count(*)
into STRICT	qt_regras_pj_w
from	pls_esquema_contabil_seg
where	nr_seq_regra_esquema	= nr_seq_regra_esquema_p
and	nr_sequencia		<> nr_seq_esquema_seg_p
and	ie_debito_credito	= ie_debito_credito_p
and	ie_codificacao		in ('JR','JP');

if (qt_regras_pj_w > 0) then
	CALL wheb_mensagem_pck.exibir_mensagem_abort( 203218, null);
	/* Já foi informada a conta contábil da pessoa jurídica. Favor verifique! */

end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_consistir_codific_classif ( nr_seq_regra_esquema_p bigint, nr_seq_esquema_seg_p bigint, ie_codificacao_p text, vl_fixo_p text, cd_conta_contabil_p text, ie_debito_credito_p text, nm_usuario_p text) FROM PUBLIC;

