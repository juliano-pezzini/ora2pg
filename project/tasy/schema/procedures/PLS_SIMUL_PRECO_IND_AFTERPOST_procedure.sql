-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_simul_preco_ind_afterpost ( nr_sequencia_p bigint, nr_seq_titular_p INOUT bigint, qt_sca_bonif_tit_p INOUT bigint, qt_sca_bonif_pend_p INOUT bigint ) AS $body$
DECLARE


nr_seq_titular_w		bigint := 0;
qt_sca_bonif_tit_w		bigint := 0;
qt_sca_bonif_pend_w	bigint := 0;


BEGIN

if (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '') then
	begin

	select	max(nr_sequencia)
	into STRICT	nr_seq_titular_w
	from	pls_simulpreco_individual
	where	nr_seq_simulacao = nr_sequencia_p
	and	ie_tipo_benef = 'T';


	select	sum(qt_scas_bonificacao)
	into STRICT	qt_sca_bonif_tit_w
	from (	SELECT	count(*) qt_scas_bonificacao
			from	pls_bonificacao_vinculo
			where	nr_seq_segurado_simul	= nr_seq_titular_w
			
union all

			SELECT	count(*) qt_scas_bonificacao
			from	pls_sca_vinculo
			where	nr_seq_segurado_simul	= nr_seq_titular_w) alias3;

	select	sum(qt_scas_bonificacao)
	into STRICT	qt_sca_bonif_pend_w
	from (	SELECT	count(*) qt_scas_bonificacao
			from	pls_bonificacao_vinculo
			where	nr_seq_segurado_simul	= nr_sequencia_p
			
union all

			SELECT	count(*) qt_scas_bonificacao
			from	pls_sca_vinculo
			where	nr_seq_segurado_simul	= nr_sequencia_p) alias3;
	end;
end if;

nr_seq_titular_p		:= nr_seq_titular_w;
qt_sca_bonif_tit_p		:= qt_sca_bonif_tit_w;
qt_sca_bonif_pend_p	:= qt_sca_bonif_pend_w;


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_simul_preco_ind_afterpost ( nr_sequencia_p bigint, nr_seq_titular_p INOUT bigint, qt_sca_bonif_tit_p INOUT bigint, qt_sca_bonif_pend_p INOUT bigint ) FROM PUBLIC;

