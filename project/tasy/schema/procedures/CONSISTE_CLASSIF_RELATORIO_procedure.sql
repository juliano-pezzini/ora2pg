-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consiste_classif_relatorio ( cd_relatorio_p bigint, ds_consistencia_p INOUT text) AS $body$
DECLARE

 
qt_relatorios_w		bigint;
ie_base_wheb_w		smallint;
ds_sep_bv_w		varchar(10);


BEGIN 
select	obter_separador_bv 
into STRICT	ds_sep_bv_w
;
 
ie_base_wheb_w := obter_valor_dinamico_bv('select 1 from estabelecimento where cd_cgc = :cd_cgc and cd_estabelecimento = :cd_estabelecimento and ie_situacao = :ie_situacao', 'cd_cgc=01950338000177'||ds_sep_bv_w||'cd_estabelecimento=1'||ds_sep_bv_w||'ie_situacao=A', ie_base_wheb_w);
 
Select	count(*) 
into STRICT	qt_relatorios_w 
from	relatorio 
where	cd_relatorio = cd_relatorio_p 
and	(((ie_base_wheb_w = 1) and cd_classif_relat like 'W%') 
or (ie_base_wheb_w = 0));
 
if (qt_relatorios_w > 1) then 
	if (ie_base_wheb_w = 1) then 
		ds_consistencia_p	:= Wheb_mensagem_pck.get_texto(306282); -- 'Já existe um relatório de classificação W cadastrado'; 
	else          		-- 'Já existe um relatório com este código cadastrado.'  
		ds_consistencia_p	:= Wheb_mensagem_pck.get_texto(306284)|| chr(10) || Wheb_mensagem_pck.get_texto(306285); -- 'A liberação de relatórios duplicados para mesma função pode dificultar a impressão!'; 
	end if;
end if;
 
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consiste_classif_relatorio ( cd_relatorio_p bigint, ds_consistencia_p INOUT text) FROM PUBLIC;

