-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE somar_doses_dif_md (ds_dose_diferenciada_p text, qt_total_p INOUT bigint, qt_erro_p INOUT bigint ) AS $body$
DECLARE


  ds_dose_dif_aux_w	varchar(4000) := ds_dose_diferenciada_p;
  i					        integer;

BEGIN
    if (ds_dose_dif_aux_w IS NOT NULL AND ds_dose_dif_aux_w::text <> '') then
      if (substr(ds_dose_dif_aux_w,length(ds_dose_dif_aux_w)-1) <> '-') then
          ds_dose_dif_aux_w	:= ds_dose_dif_aux_w || '-';
      end if;

      while(ds_dose_dif_aux_w IS NOT NULL AND ds_dose_dif_aux_w::text <> '') loop
        begin
          i                   := position('-' in ds_dose_dif_aux_w);
          qt_total_p          := coalesce(qt_total_p,0) + coalesce((substr(ds_dose_dif_aux_w,1,i-1))::numeric ,0);
          ds_dose_dif_aux_w   := substr(ds_dose_dif_aux_w,i+1);
          qt_erro_p           := 0;
        exception when others then
          qt_total_p         := 0;
          ds_dose_dif_aux_w  := '';
          qt_erro_p          := 1;
        end;
      end loop;
    end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE somar_doses_dif_md (ds_dose_diferenciada_p text, qt_total_p INOUT bigint, qt_erro_p INOUT bigint ) FROM PUBLIC;

