-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualiza_codigo_corporativo_pf (CD_PESSOA_FISICA_P text, CD_CORPORATIVO_P bigint, NM_USUARIO_P text) AS $body$
DECLARE

  PESSOA_FISICA_AUX_W PESSOA_FISICA_AUX%ROWTYPE;
  IE_CONTINUE_W       boolean := FALSE;

BEGIN
  BEGIN
    SELECT PFA.*
      INTO STRICT PESSOA_FISICA_AUX_W
      FROM PESSOA_FISICA_AUX PFA
     WHERE PFA.CD_PESSOA_FISICA = CD_PESSOA_FISICA_P;

     IE_CONTINUE_W := TRUE;
  EXCEPTION
    WHEN no_data_found THEN
         IE_CONTINUE_W := TRUE;
    WHEN too_many_rows THEN -- Pois n√£o possui UK com o CD_PESSOA_FISICA
         UPDATE PESSOA_FISICA_AUX PFA
            SET PFA.CD_CORPORATIVO = CD_CORPORATIVO_P,
                PFA.NM_USUARIO     = NM_USUARIO_P,
                PFA.DT_ATUALIZACAO = clock_timestamp()
          WHERE PFA.CD_PESSOA_FISICA = CD_PESSOA_FISICA_P;
  END;

  IF (IE_CONTINUE_W) THEN
     PESSOA_FISICA_AUX_W.CD_PESSOA_FISICA := CD_PESSOA_FISICA_P;
     PESSOA_FISICA_AUX_W.CD_CORPORATIVO   := CD_CORPORATIVO_P;
     PESSOA_FISICA_AUX_W.NM_USUARIO       := NM_USUARIO_P;
     PESSOA_FISICA_AUX_W.DT_ATUALIZACAO   := clock_timestamp();

     IF (coalesce(PESSOA_FISICA_AUX_W.DT_ATUALIZACAO_NREC::text, '') = '') THEN
       PESSOA_FISICA_AUX_W.DT_ATUALIZACAO_NREC := PESSOA_FISICA_AUX_W.DT_ATUALIZACAO;
     END IF;

     IF (coalesce(PESSOA_FISICA_AUX_W.NM_USUARIO_NREC::text, '') = '') THEN
       PESSOA_FISICA_AUX_W.NM_USUARIO_NREC := PESSOA_FISICA_AUX_W.NM_USUARIO;
     END IF;

     IF (coalesce(PESSOA_FISICA_AUX_W.NR_SEQUENCIA::text, '') = '') THEN
        SELECT nextval('pessoa_fisica_aux_seq')
          INTO STRICT PESSOA_FISICA_AUX_W.NR_SEQUENCIA
;

        INSERT INTO PESSOA_FISICA_AUX
        VALUES (PESSOA_FISICA_AUX_W.*);
      ELSE
        UPDATE PESSOA_FISICA_AUX PFA
           SET ROW = PESSOA_FISICA_AUX_W
         WHERE PFA.NR_SEQUENCIA = PESSOA_FISICA_AUX_W.NR_SEQUENCIA;
      END IF;
  END IF;

  COMMIT;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualiza_codigo_corporativo_pf (CD_PESSOA_FISICA_P text, CD_CORPORATIVO_P bigint, NM_USUARIO_P text) FROM PUBLIC;

