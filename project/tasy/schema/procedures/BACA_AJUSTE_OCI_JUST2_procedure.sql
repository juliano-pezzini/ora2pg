-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE baca_ajuste_oci_just2 () AS $body$
DECLARE


ds_retorno_w		varchar(255);
nr_seq_diverg		bigint;


BEGIN

/* ----------------- dropar FK tabela DIVERGENCIA_OCI_JUSTIF ---------------------------- */

/*Dropa o Indice no banco*/

ds_retorno_w := Executar_SQL_Dinamico(' DROP INDEX NOTFIDI_DIVORCI_FK_I', ds_retorno_w);
ds_retorno_w := Executar_SQL_Dinamico(' ALTER TABLE DIVERGENCIA_OCI_JUSTIF DROP CONSTRAINT NOTFIDI_DIVORCI_FK', ds_retorno_w);

/*Dropa o Indice no dicion치rio*/

delete	from INDICE_ATRIBUTO
where	nm_tabela = 'DIVERGENCIA_OCI_JUSTIF'
and	nm_indice = 'NOTFIDI_DIVORCI_FK_I';

delete	from INDICE
where	nm_tabela = 'DIVERGENCIA_OCI_JUSTIF'
and	nm_indice = 'NOTFIDI_DIVORCI_FK_I';

delete	from INTEGRIDADE_ATRIBUTO
where	nm_tabela = 'DIVERGENCIA_OCI_JUSTIF'
and	nm_integridade_referencial =  'NOTFIDI_DIVORCI_FK';

delete from INTEGRIDADE_REFERENCIAL
where	nm_tabela = 'DIVERGENCIA_OCI_JUSTIF'
and	nm_integridade_referencial =  'NOTFIDI_DIVORCI_FK';

commit;

/*----------------- dropar PK tabela DIVERGENCIA_ORDEM_COMPRA_ITEM ---------------------------- */

/*dropa o indice no banco*/

ds_retorno_w := Executar_SQL_Dinamico(' DROP INDEX DIORITN_PK', ds_retorno_w);
ds_retorno_w := Executar_SQL_Dinamico(' ALTER TABLE DIVERGENCIA_ORDEM_COMPRA_ITEM DROP CONSTRAINT DIORITN_PK', ds_retorno_w);

/*dropa o indice no dicion치rio*/

delete	from INDICE_ATRIBUTO
where	nm_tabela = 'DIVERGENCIA_ORDEM_COMPRA_ITEM'
and	nm_indice = 'DIORITN_PK';

delete	from INDICE
where	nm_tabela = 'DIVERGENCIA_ORDEM_COMPRA_ITEM'
and	nm_indice = 'DIORITN_PK';

commit;

/*----------------- criar PK tabela DIVERGENCIA_ORDEM_COMPRA_ITEM---------------------------- */

/*Cria o indice no banco*/

ds_retorno_w := Executar_SQL_Dinamico(' 	ALTER TABLE DIVERGENCIA_ORDEM_COMPRA_ITEM ADD
			(	CONSTRAINT DIORITN_PK   Primary Key  (NR_SEQUENCIA)) ', ds_retorno_w);

/*Cria o indice no dicion치rio*/

insert into INDICE(
	nm_tabela,
	nm_indice,
	ie_tipo,
	dt_atualizacao,
	nm_usuario,
	ds_indice,
	ie_criar_alterar,
	ie_situacao,
	dt_criacao)
values ('DIVERGENCIA_ORDEM_COMPRA_ITEM',
	'DIORITN_PK',
	'PK',
	clock_timestamp(),
	'Tasy',
	'',
	'I',
	'A',
	clock_timestamp());

insert	into INDICE_ATRIBUTO(
	nm_tabela,
	nm_indice,
	nr_sequencia,
	nm_atributo,
	dt_atualizacao,
	nm_usuario)
values ('DIVERGENCIA_ORDEM_COMPRA_ITEM',
	'DIORITN_PK',
	1,
	'NR_SEQUENCIA',
	clock_timestamp(),
	'Tasy');
commit;

/*----------------- criar FK tabela DIVERGENCIA_OCI_JUSTIF-----------------------------*/

/*Cria FK no banco*/

ds_retorno_w := Executar_SQL_Dinamico(' 	ALTER TABLE DIVERGENCIA_OCI_JUSTIF ADD
				(CONSTRAINT NOTFIDI_DIVORCI_FK FOREIGN KEY (NR_SEQ_OCI_JUST)
				REFERENCES DIVERGENCIA_ORDEM_COMPRA_ITEM(NR_SEQUENCIA)) ', ds_retorno_w);

/*Cria FK no dicionario*/

insert	into INTEGRIDADE_REFERENCIAL(
	nm_tabela,
	nm_integridade_referencial,
	nm_tabela_referencia,
	dt_atualizacao,
	nm_usuario,
	ie_regra_delecao,
	ds_integridade_referencial,
	ie_criar_alterar,
	ie_situacao,
	dt_criacao)
values ('DIVERGENCIA_OCI_JUSTIF',
	'NOTFIDI_DIVORCI_FK',
	'DIVERGENCIA_ORDEM_COMPRA_ITEM',
	clock_timestamp(),
	'Tasy',
	'CASCADE',
	'',
	'I',
	'A',
	clock_timestamp());

insert into INTEGRIDADE_ATRIBUTO(
	nm_tabela,
	nm_integridade_referencial,
	nm_atributo,
	ie_sequencia_criacao,
	dt_atualizacao,
	nm_usuario)
values ('DIVERGENCIA_OCI_JUSTIF',
	'NOTFIDI_DIVORCI_FK',
	'NR_SEQ_OCI_JUST',
	1,
	clock_timestamp(),
	'Tasy');
commit;

/*----------------- criar Indice na tabela DIVERGENCIA_OCI_JUSTIF-----------------------------*/

/*Cria indice no banco*/

ds_retorno_w := Executar_SQL_Dinamico('	CREATE INDEX NOTFIDI_DIVORCI_FK_I ON DIVERGENCIA_OCI_JUSTIF(NR_SEQ_OCI_JUST)', ds_retorno_w);

/*Cria indice no dicion치rio*/

insert into INDICE(
	nm_tabela,
	nm_indice,
	ie_tipo,
	dt_atualizacao,
	nm_usuario,
	ds_indice,
	ie_criar_alterar,
	ie_situacao,
	dt_criacao)
values ('DIVERGENCIA_OCI_JUSTIF',
	'NOTFIDI_DIVORCI_FK_I',
	'I',
	clock_timestamp(),
	'Tasy',
	'',
	'I',
	'A',
	clock_timestamp());

insert	into INDICE_ATRIBUTO(
	nm_tabela,
	nm_indice,
	nr_sequencia,
	nm_atributo,
	dt_atualizacao,
	nm_usuario)
values ('DIVERGENCIA_OCI_JUSTIF',
	'NOTFIDI_DIVORCI_FK_I',
	1,
	'NR_SEQ_OCI_JUST',
	clock_timestamp(),
	'Tasy');
commit;
end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE baca_ajuste_oci_just2 () FROM PUBLIC;

