-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE sus_gerar_w_exp_dado_esus_cain ( nr_seq_lote_p esus_lote_envio.nr_sequencia%type, ie_tipo_lote_esus_p esus_lote_envio.ie_tipo_lote_esus%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE

 
nr_seq_ficha_w		esus_regra_exp_ficha.nr_sequencia%type;
nm_ficha_w		esus_regra_exp_ficha.nm_ficha%type;

nr_seq_classe_w		esus_regra_exp_classe.nr_sequencia%type;
nm_classe_w		esus_regra_exp_classe.nm_classe%type;

nr_seq_metodo_w		esus_regra_exp_metodo.nr_sequencia%type;
nm_metodo_w 		esus_regra_exp_metodo.nm_metodo%type;
nm_campo_w 		esus_regra_exp_metodo.nm_campo%type;
ie_tipo_valor_w 	esus_regra_exp_metodo.ie_tipo_valor%type;
ds_chamada_metodo_w 	esus_regra_exp_metodo.ds_chamada_metodo%type;	
nr_seq_reg_exp_w	bigint;	
 
cd_cbo_paciente_w	esus_cad_individual.cd_cbo_paciente%type;
cd_cnes_unidade_w	esus_cad_individual.cd_cnes_unidade%type;
cd_estabelecimento_w	esus_cad_individual.cd_estabelecimento%type;
cd_pessoa_fisica_w	esus_cad_individual.cd_pessoa_fisica%type;
cd_profissional_w	esus_cad_individual.cd_profissional%type;
ds_grau_parentesco_w	esus_cad_individual.ds_grau_parentesco%type;
ds_instit_acompanha_w	esus_cad_individual.ds_instit_acompanha%type;
ds_maternidade_ref_w	esus_cad_individual.ds_maternidade_ref%type;
ds_motivo_internacao_w	esus_cad_individual.ds_motivo_internacao%type;
ds_planta_medicinal_w	esus_cad_individual.ds_planta_medicinal%type;
ds_povo_comunidade_w	esus_cad_individual.ds_povo_comunidade%type;
ds_pri_cond_saude_w	esus_cad_individual.ds_pri_cond_saude%type;
ds_seg_cond_saude_w	esus_cad_individual.ds_seg_cond_saude%type;
ds_ter_cond_saude_w	esus_cad_individual.ds_ter_cond_saude%type;
dt_atendimento_w	esus_cad_individual.dt_atendimento%type;
dt_liberacao_w		esus_cad_individual.dt_liberacao%type;
ie_acamado_w		esus_cad_individual.ie_acamado%type;
ie_acesso_sanitario_w	esus_cad_individual.ie_acesso_sanitario%type;
ie_acomp_outra_inst_w	esus_cad_individual.ie_acomp_outra_inst%type;
ie_alcoolatra_w		esus_cad_individual.ie_alcoolatra%type;
ie_alimentacao_dia_w	esus_cad_individual.ie_alimentacao_dia%type;
ie_avc_derrame_w	esus_cad_individual.ie_avc_derrame%type;
ie_banho_w		esus_cad_individual.ie_banho%type;
ie_cancer_w		esus_cad_individual.ie_cancer%type;
ie_cardiaco_w		esus_cad_individual.ie_cardiaco%type;
ie_curso_frequentado_w	esus_cad_individual.ie_curso_frequentado%type;
ie_def_auditiva_w	esus_cad_individual.ie_def_auditiva%type;
ie_deficiente_w		esus_cad_individual.ie_deficiente%type;
ie_deficiente_fisico_w	esus_cad_individual.ie_deficiente_fisico%type;
ie_deficiente_visual_w	esus_cad_individual.ie_deficiente_visual%type;
ie_def_intelec_cogni_w	esus_cad_individual.ie_def_intelec_cogni%type;
ie_diabetico_w		esus_cad_individual.ie_diabetico%type;
ie_doenca_cardiaca_w	esus_cad_individual.ie_doenca_cardiaca%type;
ie_doenca_renal_w	esus_cad_individual.ie_doenca_renal%type;
ie_doenca_respi_asma_w	esus_cad_individual.ie_doenca_respi_asma%type;
ie_doenca_resp_outro_w	esus_cad_individual.ie_doenca_resp_outro%type;
ie_doen_res_nao_sabe_w	esus_cad_individual.ie_doen_res_nao_sabe%type;
ie_doe_res_dpoc_enfi_w	esus_cad_individual.ie_doe_res_dpoc_enfi%type;
ie_domiciliado_w	esus_cad_individual.ie_domiciliado%type;
ie_freq_cuidador_w	esus_cad_individual.ie_freq_cuidador%type;
ie_frequenta_escola_w	esus_cad_individual.ie_frequenta_escola%type;
ie_fumante_w		esus_cad_individual.ie_fumante%type;
ie_gestante_w		esus_cad_individual.ie_gestante%type;
ie_hanseniase_w		esus_cad_individual.ie_hanseniase%type;
ie_higiene_bucal_w	esus_cad_individual.ie_higiene_bucal%type;
ie_higiene_pessoal_w	esus_cad_individual.ie_higiene_pessoal%type;
ie_hipertenso_w		esus_cad_individual.ie_hipertenso%type;
ie_infarto_w		esus_cad_individual.ie_infarto%type;
ie_inf_orient_sexual_w	esus_cad_individual.ie_inf_orient_sexual%type;
ie_internacao_w		esus_cad_individual.ie_internacao%type;
ie_membro_povo_com_w	esus_cad_individual.ie_membro_povo_com%type;
ie_ori_ali_doac_rest_w	esus_cad_individual.ie_ori_ali_doac_rest%type;
ie_ori_ali_doa_grupo_w	esus_cad_individual.ie_ori_ali_doa_grupo%type;
ie_orient_sexual_w	esus_cad_individual.ie_orient_sexual%type;
ie_orig_alim_doa_pop_w	esus_cad_individual.ie_orig_alim_doa_pop%type;
ie_orig_ali_rest_pop_w	esus_cad_individual.ie_orig_ali_rest_pop%type;
ie_origem_alim_outro_w	esus_cad_individual.ie_origem_alim_outro%type;
ie_outra_deficiencia_w	esus_cad_individual.ie_outra_deficiencia%type;
ie_outra_higiene_w	esus_cad_individual.ie_outra_higiene%type;
ie_partic_grupo_com_w	esus_cad_individual.ie_partic_grupo_com%type;
ie_plano_saude_w	esus_cad_individual.ie_plano_saude%type;
ie_planta_medicinal_w	esus_cad_individual.ie_planta_medicinal%type;
ie_prat_integ_compl_w	esus_cad_individual.ie_prat_integ_compl%type;
ie_problema_renal_w	esus_cad_individual.ie_problema_renal%type;
ie_prob_mental_w	esus_cad_individual.ie_prob_mental%type;
ie_prob_respiratorio_w	esus_cad_individual.ie_prob_respiratorio%type;
ie_recebe_beneficio_w	esus_cad_individual.ie_recebe_beneficio%type;
ie_ref_familiar_w	esus_cad_individual.ie_ref_familiar%type;
ie_relacao_resp_w	esus_cad_individual.ie_relacao_resp%type;
ie_resp_crianca_w	esus_cad_individual.ie_resp_crianca%type;
ie_resp_familiar_w	esus_cad_individual.ie_resp_familiar%type;
ie_saida_cadastro_w	esus_cad_individual.ie_saida_cadastro%type;
ie_situacao_merc_trab	esus_cad_individual.ie_situacao_merc_trab%type;
ie_situacao_peso_w	esus_cad_individual.ie_situacao_peso%type;
ie_situacao_rua_w	esus_cad_individual.ie_situacao_rua%type;
ie_tempo_sit_rua_w	esus_cad_individual.ie_tempo_sit_rua%type;
ie_termo_recusa_w	esus_cad_individual.ie_termo_recusa%type;
ie_tuberculose_w	esus_cad_individual.ie_tuberculose%type;
ie_usa_drogas_w		esus_cad_individual.ie_usa_drogas%type;
ie_visita_familiar_w	esus_cad_individual.ie_visita_familiar%type;
nr_seq_sus_equipe_w	esus_cad_individual.nr_seq_sus_equipe%type;
nr_sequencia_w		esus_cad_individual.nr_sequencia%type;
ie_situacao_merc_trab_w	esus_cad_individual.ie_situacao_merc_trab%type;
nm_paciente_w		varchar(100);	
nm_profissional_w	varchar(100);

CadInd CURSOR FOR 
	SELECT	nr_sequencia, 
		nr_seq_sus_equipe, 
		cd_cbo_paciente, 
		cd_cnes_unidade, 
		cd_estabelecimento, 
		cd_pessoa_fisica, 
		cd_profissional, 
		ds_grau_parentesco, 
		ds_instit_acompanha, 
		ds_maternidade_ref, 
		ds_motivo_internacao, 
		ds_planta_medicinal, 
		ds_povo_comunidade, 
		ds_pri_cond_saude, 
		ds_seg_cond_saude, 
		ds_ter_cond_saude, 
		dt_atendimento, 
		dt_liberacao, 
		ie_acamado, 
		ie_acesso_sanitario, 
		ie_acomp_outra_inst, 
		ie_alcoolatra, 
		ie_alimentacao_dia, 
		ie_avc_derrame, 
		ie_banho, 
		ie_cancer, 
		ie_cardiaco, 
		ie_curso_frequentado, 
		ie_def_auditiva, 
		ie_deficiente, 
		ie_deficiente_fisico, 
		ie_deficiente_visual, 
		ie_def_intelec_cogni, 
		ie_diabetico, 
		ie_doenca_cardiaca, 
		ie_doenca_renal, 
		ie_doenca_respi_asma, 
		ie_doenca_resp_outro, 
		ie_doen_res_nao_sabe, 
		ie_doe_res_dpoc_enfi, 
		ie_domiciliado, 
		ie_freq_cuidador, 
		ie_frequenta_escola, 
		ie_fumante, 
		ie_gestante, 
		ie_hanseniase, 
		ie_higiene_bucal, 
		ie_higiene_pessoal, 
		ie_hipertenso, 
		ie_infarto, 
		ie_inf_orient_sexual, 
		ie_internacao, 
		ie_membro_povo_com, 
		ie_ori_ali_doac_rest, 
		ie_ori_ali_doa_grupo, 
		ie_orient_sexual, 
		ie_orig_alim_doa_pop, 
		ie_orig_ali_rest_pop, 
		ie_origem_alim_outro, 
		ie_outra_deficiencia, 
		ie_outra_higiene, 
		ie_partic_grupo_com, 
		ie_plano_saude, 
		ie_planta_medicinal, 
		ie_prat_integ_compl, 
		ie_problema_renal, 
		ie_prob_mental, 
		ie_prob_respiratorio, 
		ie_recebe_beneficio, 
		ie_ref_familiar, 
		ie_relacao_resp, 
		ie_resp_crianca, 
		ie_resp_familiar, 
		ie_saida_cadastro, 
		ie_situacao_merc_trab, 
		ie_situacao_peso, 
		ie_situacao_rua, 
		ie_tempo_sit_rua, 
		ie_termo_recusa, 
		ie_tuberculose, 
		ie_usa_drogas, 
		ie_visita_familiar, 
		substr(obter_nome_pf(cd_pessoa_fisica),1,100) nm_paciente, 
		substr(obter_nome_pf(cd_profissional),1,100) nm_profissional		 
	from	esus_cad_individual 
	where	nr_seq_lote_envio =	nr_seq_lote_p 
	order by nm_paciente, nm_profissional, nr_sequencia;

type 		fetch_array is table of CadInd%rowtype;
s_array 	fetch_array;
i		integer := 1;
type vetor is table of fetch_array index by integer;
vetor_CadInd_w			vetor;
	
BEGIN 
 
 
open CadInd;
loop 
fetch CadInd bulk collect into s_array limit 1000;
	vetor_CadInd_w(i) := s_array;
	i := i + 1;
EXIT WHEN NOT FOUND; /* apply on CadInd */
end loop;
close CadInd;
 
 
for i in 1..vetor_CadInd_w.count loop 
	begin 
	s_array := vetor_CadInd_w(i);
	for z in 1..s_array.count loop 
		begin 
		 
		nr_sequencia_w :=		s_array[z].nr_sequencia;	
		nr_seq_sus_equipe_w :=		s_array[z].nr_seq_sus_equipe;
		cd_cbo_paciente_w :=		s_array[z].cd_cbo_paciente;
		cd_cnes_unidade_w :=		s_array[z].cd_cnes_unidade;
		cd_estabelecimento_w :=		s_array[z].cd_estabelecimento;
		cd_pessoa_fisica_w :=		s_array[z].cd_pessoa_fisica;
		cd_profissional_w :=		s_array[z].cd_profissional;
		ds_grau_parentesco_w :=		s_array[z].ds_grau_parentesco;
		ds_instit_acompanha_w :=	s_array[z].ds_instit_acompanha;
		ds_maternidade_ref_w :=		s_array[z].ds_maternidade_ref;
		ds_motivo_internacao_w :=	s_array[z].ds_motivo_internacao;
		ds_planta_medicinal_w :=	s_array[z].ds_planta_medicinal;
		ds_povo_comunidade_w :=		s_array[z].ds_povo_comunidade;
		ds_pri_cond_saude_w :=		s_array[z].ds_pri_cond_saude;
		ds_seg_cond_saude_w :=		s_array[z].ds_seg_cond_saude;
		ds_ter_cond_saude_w :=		s_array[z].ds_ter_cond_saude;
		dt_atendimento_w :=		s_array[z].dt_atendimento;
		dt_liberacao_w :=		s_array[z].dt_liberacao;
		ie_acamado_w :=			s_array[z].ie_acamado;
		ie_acesso_sanitario_w :=	s_array[z].ie_acesso_sanitario;
		ie_acomp_outra_inst_w :=	s_array[z].ie_acomp_outra_inst;
		ie_alcoolatra_w :=		s_array[z].ie_alcoolatra;
		ie_alimentacao_dia_w :=		s_array[z].ie_alimentacao_dia;
		ie_avc_derrame_w :=		s_array[z].ie_avc_derrame;
		ie_banho_w :=			s_array[z].ie_banho;
		ie_cancer_w :=			s_array[z].ie_cancer;
		ie_cardiaco_w :=		s_array[z].ie_cardiaco;
		ie_curso_frequentado_w :=	s_array[z].ie_curso_frequentado;
		ie_def_auditiva_w :=		s_array[z].ie_def_auditiva;
		ie_deficiente_w :=		s_array[z].ie_deficiente;
		ie_deficiente_fisico_w :=	s_array[z].ie_deficiente_fisico;
		ie_deficiente_visual_w :=	s_array[z].ie_deficiente_visual;
		ie_def_intelec_cogni_w :=	s_array[z].ie_def_intelec_cogni;
		ie_diabetico_w :=		s_array[z].ie_diabetico;
		ie_doenca_cardiaca_w :=		s_array[z].ie_doenca_cardiaca;
		ie_doenca_renal_w :=		s_array[z].ie_doenca_renal;
		ie_doenca_respi_asma_w :=	s_array[z].ie_doenca_respi_asma;
		ie_doenca_resp_outro_w :=	s_array[z].ie_doenca_resp_outro;
		ie_doen_res_nao_sabe_w :=	s_array[z].ie_doen_res_nao_sabe;
		ie_doe_res_dpoc_enfi_w :=	s_array[z].ie_doe_res_dpoc_enfi;
		ie_domiciliado_w :=		s_array[z].ie_domiciliado;
		ie_freq_cuidador_w :=		s_array[z].ie_freq_cuidador;
		ie_frequenta_escola_w :=	s_array[z].ie_frequenta_escola;
		ie_fumante_w :=			s_array[z].ie_fumante;
		ie_gestante_w :=		s_array[z].ie_gestante;
		ie_hanseniase_w :=		s_array[z].ie_hanseniase;
		ie_higiene_bucal_w :=		s_array[z].ie_higiene_bucal;
		ie_higiene_pessoal_w :=		s_array[z].ie_higiene_pessoal;
		ie_hipertenso_w :=		s_array[z].ie_hipertenso;
		ie_infarto_w :=			s_array[z].ie_infarto;
		ie_inf_orient_sexual_w :=	s_array[z].ie_inf_orient_sexual;
		ie_internacao_w :=		s_array[z].ie_internacao;
		ie_membro_povo_com_w :=		s_array[z].ie_membro_povo_com;
		ie_ori_ali_doac_rest_w :=	s_array[z].ie_ori_ali_doac_rest;
		ie_ori_ali_doa_grupo_w :=	s_array[z].ie_ori_ali_doa_grupo;
		ie_orient_sexual_w :=		s_array[z].ie_orient_sexual;
		ie_orig_alim_doa_pop_w :=	s_array[z].ie_orig_alim_doa_pop;
		ie_orig_ali_rest_pop_w :=	s_array[z].ie_orig_ali_rest_pop;
		ie_origem_alim_outro_w :=	s_array[z].ie_origem_alim_outro;
		ie_outra_deficiencia_w :=	s_array[z].ie_outra_deficiencia;
		ie_outra_higiene_w :=		s_array[z].ie_outra_higiene;
		ie_partic_grupo_com_w :=	s_array[z].ie_partic_grupo_com;
		ie_plano_saude_w :=		s_array[z].ie_plano_saude;
		ie_planta_medicinal_w :=	s_array[z].ie_planta_medicinal;
		ie_prat_integ_compl_w :=	s_array[z].ie_prat_integ_compl;
		ie_problema_renal_w :=		s_array[z].ie_problema_renal;
		ie_prob_mental_w :=		s_array[z].ie_prob_mental;
		ie_prob_respiratorio_w :=	s_array[z].ie_prob_respiratorio;
		ie_recebe_beneficio_w :=	s_array[z].ie_recebe_beneficio;
		ie_ref_familiar_w :=		s_array[z].ie_ref_familiar;
		ie_relacao_resp_w :=		s_array[z].ie_relacao_resp;
		ie_resp_crianca_w :=		s_array[z].ie_resp_crianca;
		ie_resp_familiar_w :=		s_array[z].ie_resp_familiar;
		ie_saida_cadastro_w :=		s_array[z].ie_saida_cadastro;
		ie_situacao_merc_trab_w :=	s_array[z].ie_situacao_merc_trab;
		ie_situacao_peso_w :=		s_array[z].ie_situacao_peso;
		ie_situacao_rua_w :=		s_array[z].ie_situacao_rua;
		ie_tempo_sit_rua_w :=		s_array[z].ie_tempo_sit_rua;
		ie_termo_recusa_w :=		s_array[z].ie_termo_recusa;
		ie_tuberculose_w :=		s_array[z].ie_tuberculose;
		ie_usa_drogas_w :=		s_array[z].ie_usa_drogas;
		ie_visita_familiar_w :=		s_array[z].ie_visita_familiar;
		nm_paciente_w :=		s_array[z].nm_paciente;
		nm_profissional_w :=		s_array[z].nm_profissional;
			 
			 
 
	 
		end;
	end loop;
	end;
end loop;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE sus_gerar_w_exp_dado_esus_cain ( nr_seq_lote_p esus_lote_envio.nr_sequencia%type, ie_tipo_lote_esus_p esus_lote_envio.ie_tipo_lote_esus%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;

