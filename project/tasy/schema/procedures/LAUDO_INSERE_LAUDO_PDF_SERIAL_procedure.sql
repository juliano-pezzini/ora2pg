-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE laudo_insere_laudo_pdf_serial ( nr_seq_laudo_p bigint, nr_acesso_dicom_p text, ds_laudo_pdf_p text, nm_usuario_p text, ds_erro_p INOUT text, nr_seq_laudo_pdf_p INOUT bigint) AS $body$
DECLARE


nr_seq_laudo_pdf_w		laudo_paciente_pdf_serial.nr_sequencia%type;


BEGIN

if (nr_seq_laudo_p IS NOT NULL AND nr_seq_laudo_p::text <> '')	then

	select 	nextval('laudo_paciente_pdf_serial_seq')
	into STRICT	nr_seq_laudo_pdf_w
	;

	begin

	insert into laudo_paciente_pdf_serial(nr_sequencia,
									dt_atualizacao,
									nm_usuario,
									dt_atualizacao_nrec,
									nm_usuario_nrec,
									nr_acesso_dicom,
									nr_seq_laudo,
									ds_pdf_serial)
							values (nr_seq_laudo_pdf_w,
									clock_timestamp(),
									nm_usuario_p,
									clock_timestamp(),
									nm_usuario_p,
									nr_acesso_dicom_p,
									nr_seq_laudo_p,
									ds_laudo_pdf_p);


	--Atualizando o formato do resultado do laudo para buscar o laudo  em pdf serializado.
	update	laudo_paciente
	set		ie_formato = 4
	where	nr_sequencia = nr_seq_laudo_p;

	exception
		when others then
			ds_erro_p := substr(sqlerrm,1,4000);

	end;

end if;

commit;

nr_seq_laudo_pdf_p := nr_seq_laudo_pdf_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE laudo_insere_laudo_pdf_serial ( nr_seq_laudo_p bigint, nr_acesso_dicom_p text, ds_laudo_pdf_p text, nm_usuario_p text, ds_erro_p INOUT text, nr_seq_laudo_pdf_p INOUT bigint) FROM PUBLIC;

