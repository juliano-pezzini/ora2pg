-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cv_gerar_visitante_saida_js (nr_sequencia_p bigint, nm_usuario_p text, ds_botao_p text, ie_opcao_p text, nr_atendimento_p bigint, nr_dias_p bigint, ds_msg_senha_p INOUT text) AS $body$
DECLARE

 
cd_senha_w	integer;					
					 

BEGIN 
 
Gerar_visitante_saida(nr_sequencia_p, nm_usuario_p, ds_botao_p, ie_opcao_p);
 
if (coalesce(nr_atendimento_p,0) > 0) then 
 
	select	coalesce(min(nr_senha_espera),0) 
	into STRICT	cd_senha_w 
	from 	atendimento_visita 
	where 	nr_atendimento = nr_atendimento_p 
	and  	dt_entrada between clock_timestamp() - nr_dias_p and clock_timestamp() 
	and  	ie_status = 'A' 
	and	coalesce(ie_paciente,'N') = 'N' 
	and  	coalesce(dt_saida::text, '') = '';
 
	if (cd_senha_w > 0) then 
		ds_msg_senha_p := substr(obter_texto_dic_objeto(41644, wheb_usuario_pck.get_nr_seq_idioma, 'NR_SENHA_ESPERA='||cd_senha_w),1,255);
	end if;
 
end if;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cv_gerar_visitante_saida_js (nr_sequencia_p bigint, nm_usuario_p text, ds_botao_p text, ie_opcao_p text, nr_atendimento_p bigint, nr_dias_p bigint, ds_msg_senha_p INOUT text) FROM PUBLIC;

