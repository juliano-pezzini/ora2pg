-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE exec_verify_medicare ( patient_id_p text, nm_usuario_p text, ds_return_p INOUT text) AS $body$
DECLARE

ds_return_w             varchar(4000);
ie_verified_w           smallint;
nr_sequence_w           bigint;
ds_informacao_w         varchar(4000);


BEGIN
select  coalesce(max(nr_sequencia),0)
into STRICT    nr_sequence_w
from    verify_medicare_response
where   cd_pessoa_fisica = patient_id_p;
if (nr_sequence_w > 0) then
select  coalesce(substr(ds_response,1,4000),'Empty response')
into STRICT    ds_return_w
from    verify_medicare_response
where   nr_sequencia = nr_sequence_w;
end if;

select  coalesce(max(1),0)
into STRICT    ie_verified_w

where   ((upper(ds_return_w) like upper('%Medicare Card Number%')) or (upper(ds_return_w) like upper('%Direct CONTROL Medicare Number%')) or (upper(ds_return_w) like upper('%Veteran Number:%')) or (upper(ds_return_w) like upper('%Direct CONTROL Veteran Number:%')) or (upper(ds_return_w) like upper('%Veteran Entitlement:%')) or (upper(ds_return_w) like upper('%Direct CONTROL Veteran Entitlement:%')) or (upper(ds_return_w) like upper('%Medicare First Name:%')) or (upper(ds_return_w) like upper('%Direct CONTROL First Name:%')) or (upper(ds_return_w) like upper('%Direct CONTROL Family Name:%')) or (upper(ds_return_w) like upper('%Verification performed%')) or (upper(ds_return_w) like upper('%No Verifications performed%')));

if (ie_verified_w = 1) then
    ds_informacao_w := substr(wheb_mensagem_pck.get_texto(1075948,null),1,2000);
else
    ds_informacao_w := substr(wheb_mensagem_pck.get_texto(1075942,  'MACRO=' || ds_return_w ),1,2000);
end if;

ds_return_p := ds_informacao_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE exec_verify_medicare ( patient_id_p text, nm_usuario_p text, ds_return_p INOUT text) FROM PUBLIC;

