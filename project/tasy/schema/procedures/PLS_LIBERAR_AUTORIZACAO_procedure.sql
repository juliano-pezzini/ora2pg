-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_liberar_autorizacao ( nr_seq_guia_p bigint, cd_guia_p INOUT text, ds_beneficiario_p INOUT text, cd_senha_p INOUT text, ds_status_p INOUT text, dt_validade_p INOUT timestamp, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
cd_guia_w		varchar(20);
ds_beneficiario_w	varchar(30);
cd_senha_w		varchar(20);
ds_status_w		varchar(30);
dt_validade_w		timestamp;
		

BEGIN		 
 
if (nr_seq_guia_p > 0) then 
	begin 
	CALL pls_liberar_guia(nr_seq_guia_p, 0, 0, 'S', cd_estabelecimento_p, nm_usuario_p,null,null);
 
	select	cd_guia, 
		substr(pls_obter_dados_segurado(nr_seq_segurado,'N'),1,30), 
		cd_senha, 
		substr(obter_valor_dominio(1747,ie_status),1,30), 
		coalesce(to_char(dt_validade_senha, 'dd/mm/yyyy'),clock_timestamp()) 
	into STRICT	cd_guia_w, 
		ds_beneficiario_w, 
		cd_senha_w, 
		ds_status_w, 
		dt_validade_w 
	from	pls_guia_plano 
	where	nr_sequencia	= nr_seq_guia_p;
	end;
end if;
 
cd_guia_p		:= cd_guia_w;
ds_beneficiario_p	:= ds_beneficiario_w;
cd_senha_p		:= cd_senha_w;
ds_status_p		:= ds_status_w;
dt_validade_p		:= dt_validade_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_liberar_autorizacao ( nr_seq_guia_p bigint, cd_guia_p INOUT text, ds_beneficiario_p INOUT text, cd_senha_p INOUT text, ds_status_p INOUT text, dt_validade_p INOUT timestamp, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

