-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE derived_fees_xls ( nr_item_p text, vl_dva_percentile_p bigint, vl_mbs_group_fee_p bigint, vl_mbs_patient_fee_p bigint, vl_in_hosp_grp_fee_p bigint, vl_in_hosp_patient_fee_p bigint, vl_out_of_hosp_fee_p bigint, vl_out_pat_fee_p bigint, nr_edicao_p bigint, nm_usuario_p text) AS $body$
DECLARE


record_count	smallint;
length_item 	integer;
item_value 	varchar(5);


BEGIN

select	length(nr_item_p)
into STRICT 	length_item 
;

if (length_item = 5) then
	item_value := nr_item_p;
else
	case	length_item
	
	when 1 then

		select	concat('0000', nr_item_p) 
		into STRICT 	item_value 
		;
	
	when 2 then
		select	concat('000', nr_item_p)
		into STRICT 	item_value 
		;
	
	when 3 then
		select	concat('00', nr_item_p)
		into STRICT	item_value 
		;

	when	4 then
		select 	concat('0', nr_item_p)
		into STRICT 	item_value 
		;
	
	end case;
end if;

update	dva_price_catalogue
set 	vl_dva_percent 		= vl_dva_percentile_p,
	vl_mbs_grp_fee 		= vl_mbs_group_fee_p,
	vl_mbs_pat_fee 		= vl_mbs_patient_fee_p,
	vl_rmfs_in_hosp_grp_fee = vl_in_hosp_grp_fee_p,
	vl_rmfs_in 		= vl_in_hosp_patient_fee_p,
	vl_rmfs_out 		= vl_out_pat_fee_p,
	vl_out_of_hosp_pat_fee 	= vl_out_of_hosp_fee_p,
	dt_atualizacao  	= clock_timestamp(),
	dt_atualizacao_nrec 	= clock_timestamp(),
	nm_usuario 		= nm_usuario_p,
	nm_usuario_nrec 	= nm_usuario_p
where 	cd_procedimento_loc 	= item_value
and 	nr_edicao_amb 		= nr_edicao_p;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE derived_fees_xls ( nr_item_p text, vl_dva_percentile_p bigint, vl_mbs_group_fee_p bigint, vl_mbs_patient_fee_p bigint, vl_in_hosp_grp_fee_p bigint, vl_in_hosp_patient_fee_p bigint, vl_out_of_hosp_fee_p bigint, vl_out_pat_fee_p bigint, nr_edicao_p bigint, nm_usuario_p text) FROM PUBLIC;

