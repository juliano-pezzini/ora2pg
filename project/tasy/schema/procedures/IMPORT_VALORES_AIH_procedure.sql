-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE import_valores_aih (nr_sequencia_p bigint, nr_aih_p bigint, dt_comp_aih_p timestamp, dt_apresentacao_p timestamp, nr_linha_p bigint, cd_procedimento_p bigint, qt_procedimento_p bigint, vl_procedimento_p bigint, ie_prestador_p text, ie_rateio_p text, nr_cpf_p bigint, nr_cns_p text, cd_cbo_p text, cd_cnpj_p text, ie_doc_executor_p bigint, cd_doc_credito_p text, ie_opcao_p text, nm_usuario_p text) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: Importar dados AIH
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [X] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
ie_opcao_p
DL - Atualizacao_Padrao_parametros (delete)
IN - insere dado tabela w_sus_aih_valor
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
BEGIN
if (upper(ie_opcao_p) = 'DL') then
	delete	from w_sus_aih_valor
	where	trunc(dt_competencia, 'month') = trunc(to_date(dt_comp_aih_p), 'month');

elsif (upper(ie_opcao_p) = 'IN') then
	if (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '') and (nr_aih_p IS NOT NULL AND nr_aih_p::text <> '') and (dt_comp_aih_p IS NOT NULL AND dt_comp_aih_p::text <> '') and (dt_apresentacao_p IS NOT NULL AND dt_apresentacao_p::text <> '') and (cd_procedimento_p IS NOT NULL AND cd_procedimento_p::text <> '') and (vl_procedimento_p IS NOT NULL AND vl_procedimento_p::text <> '') then
			insert	into w_sus_aih_valor(nr_sequencia,
					nr_aih,
					dt_competencia,
					dt_apresentacao,
					nr_linha,
					cd_procedimento,
					qt_procedimento,
					vl_procedimento,
					ie_prestador,
					ie_rateio,
					dt_atualizacao,
					nm_usuario,
					dt_atualizacao_nrec,
					nm_usuario_nrec,
					nr_cpf,
					nr_cns,
					cd_cbo,
					cd_cnpj,
					ie_doc_executor,
					cd_doc_credito)
			values (nr_sequencia_p,
					nr_aih_p,
					dt_comp_aih_p,
					dt_apresentacao_p,
					nr_linha_p,
					cd_procedimento_p,
					qt_procedimento_p,
					vl_procedimento_p,
					ie_prestador_p,
					ie_rateio_p,
					clock_timestamp(),
					nm_usuario_p,
					clock_timestamp(),
					nm_usuario_p,
					nr_cpf_p,
					nr_cns_p,
					cd_cbo_p,
					cd_cnpj_p,
					ie_doc_executor_p,
					cd_doc_credito_p);
	end if;
end if;
commit;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE import_valores_aih (nr_sequencia_p bigint, nr_aih_p bigint, dt_comp_aih_p timestamp, dt_apresentacao_p timestamp, nr_linha_p bigint, cd_procedimento_p bigint, qt_procedimento_p bigint, vl_procedimento_p bigint, ie_prestador_p text, ie_rateio_p text, nr_cpf_p bigint, nr_cns_p text, cd_cbo_p text, cd_cnpj_p text, ie_doc_executor_p bigint, cd_doc_credito_p text, ie_opcao_p text, nm_usuario_p text) FROM PUBLIC;

