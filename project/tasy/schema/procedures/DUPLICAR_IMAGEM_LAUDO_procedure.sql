-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_imagem_laudo (nr_sequencia_p bigint, nm_usuario_p text, nr_seq_imagem_p text) AS $body$
DECLARE


nr_seq_imagem_w laudo_paciente_imagem.nr_seq_imagem%type;
ds_arquivo_imagem_w laudo_paciente_imagem.ds_arquivo_imagem%type;
ds_imagem_w laudo_paciente_imagem.ds_imagem%type;


BEGIN

select (max(nr_seq_imagem)+1) as nr_seq_imagem
into STRICT nr_seq_imagem_w
from laudo_paciente_imagem
where nr_sequencia = nr_sequencia_p;

select ds_arquivo_imagem, ds_imagem
into STRICT ds_arquivo_imagem_w, ds_imagem_w
from laudo_paciente_imagem
where nr_sequencia = nr_sequencia_p
and nr_seq_imagem = nr_seq_imagem_p;

insert into laudo_paciente_imagem( nr_sequencia,
                            nr_seq_imagem,
                            ds_arquivo_imagem,
                            ds_imagem,
                            nm_usuario,
                            dt_atualizacao,
                            nm_usuario_nrec,
                            dt_atualizacao_nrec)
values (nr_sequencia_p,
        nr_seq_imagem_w,
        ds_arquivo_imagem_w,
        ds_imagem_w,
        nm_usuario_p,
        clock_timestamp(),
        nm_usuario_p,
        clock_timestamp());

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_imagem_laudo (nr_sequencia_p bigint, nm_usuario_p text, nr_seq_imagem_p text) FROM PUBLIC;

