-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consiste_se_compra_aprovada ( nr_seq_processo_p bigint) AS $body$
DECLARE

 
dt_aprovacao_w		timestamp;				
ds_documento_w		varchar(15);
				

BEGIN 
 
begin 
select	a.dt_autorizacao, 
	Wheb_mensagem_pck.get_texto(388951) -- Solicitação 
into STRICT	dt_aprovacao_w, 
	ds_documento_w 
from	solic_compra a, 
	solic_compra_item b 
where	a.nr_solic_compra	= b.nr_solic_compra 
and	b.nr_seq_aprovacao	= nr_seq_processo_p  LIMIT 1;
exception when others then 
	dt_aprovacao_w := '';
end;
 
if (coalesce(dt_aprovacao_w::text, '') = '') then 
	begin 
	select	a.dt_aprovacao, 
		Wheb_mensagem_pck.get_texto(388952) --- Nota 
	into STRICT	dt_aprovacao_w, 
		ds_documento_w 
	from	nota_fiscal a, 
		nota_fiscal_item b 
	where	a.nr_sequencia	= b.nr_sequencia 
	and	b.nr_seq_aprovacao	= nr_seq_processo_p;
	exception when others then 
		dt_aprovacao_w := '';
	end;
end if;
 
if (coalesce(dt_aprovacao_w::text, '') = '') then 
	begin 
	select	a.dt_aprovacao, 
		Wheb_mensagem_pck.get_texto(388955) -- Licitação 
	into STRICT	dt_aprovacao_w, 
		ds_documento_w 
	from	reg_licitacao a, 
		reg_lic_item b 
	where	a.nr_sequencia	= b.nr_seq_licitacao 
	and	b.nr_seq_aprovacao	= nr_seq_processo_p;
	exception when others then 
		dt_aprovacao_w := '';
	end;
end if;
 
if (coalesce(dt_aprovacao_w::text, '') = '') then 
	begin 
	select	a.dt_aprovacao, 
		Wheb_mensagem_pck.get_texto(388956) -- Ordem 
	into STRICT	dt_aprovacao_w, 
		ds_documento_w 
	from	ordem_compra a, 
		ordem_compra_item b 
	where	a.nr_ordem_compra	= b.nr_ordem_compra 
	and	b.nr_seq_aprovacao	= nr_seq_processo_p;
	exception when others then 
		dt_aprovacao_w := '';
	end;
end if;
 
if (coalesce(dt_aprovacao_w::text, '') = '') then 
	begin 
	select	a.dt_aprovacao, 
		Wheb_mensagem_pck.get_texto(388958) -- Cotação 
	into STRICT	dt_aprovacao_w, 
		ds_documento_w 
	from	cot_compra a, 
		cot_compra_item b 
	where	a.nr_cot_compra	= b.nr_cot_compra 
	and	b.nr_seq_aprovacao	= nr_seq_processo_p;
	exception when others then 
		dt_aprovacao_w := '';
	end;
end if;
 
if (coalesce(dt_aprovacao_w::text, '') = '') then 
	begin 
	select	a.dt_aprovacao, 
		Wheb_mensagem_pck.get_texto(388959) -- Requisição 
	into STRICT	dt_aprovacao_w, 
		ds_documento_w 
	from	requisicao_material a, 
		item_requisicao_material b 
	where	a.nr_requisicao		= b.nr_requisicao 
	and	b.nr_seq_aprovacao	= nr_seq_processo_p;
	exception when others then 
		dt_aprovacao_w := '';
	end;
end if;
 
if (dt_aprovacao_w IS NOT NULL AND dt_aprovacao_w::text <> '') then 
	/*'Esta ' || DS_DOCUMENTO_W || ' já está aprovada ou reprovada. Favor atualizar a tela pressionando F5.');*/
 
	CALL wheb_mensagem_pck.exibir_mensagem_abort(191579,'DS_DOCUMENTO_W='||DS_DOCUMENTO_W);
end if;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consiste_se_compra_aprovada ( nr_seq_processo_p bigint) FROM PUBLIC;

