-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_eis_conta_paciente ( nr_interno_conta_p bigint) AS $body$
DECLARE


cd_Origem_e_Proc_w		varchar(10);
ie_tipo_atendimento_w	smallint;
cd_convenio_w			integer;
nr_atendimento_w		bigint;
cd_proc_retorno_w		varchar(255);

nr_sequencia_w		bigint;
dt_referencia_w		timestamp;
dt_alta_w			timestamp;
dt_producao_w		timestamp;

vl_medico_w			double precision;
vl_medico_fora_conta_w	double precision;
vl_material_w			double precision;
vl_diaria_w			double precision;
vl_sadt_fora_conta_w		double precision;
vl_custo_w			double precision;
vl_custo_variavel_w		double precision;
vl_custo_mao_obra_w		double precision;
vl_custo_dir_apoio_w		double precision;
vl_custo_direto_w		double precision;
vl_custo_indireto_w		double precision;
vl_custo_sadt_w		double precision;
vl_despesa_w			double precision;
vl_custo_hm_w			double precision;
vl_imposto_w			double precision;
vl_procedimento_w		double precision;
vl_item_w			double precision;
vl_receita_w			double precision;
vl_repasse_terceiro_w	double precision;
vl_desconto_w			double precision;
vl_original_w			double precision;
vl_desc_financ_w		double precision;
qt_resumo_w			double precision;
vl_glosa_w			double precision;
cd_procedimento_w		bigint;
ie_origem_proced_w		bigint;
cd_procedimento_ww		bigint;
ie_origem_proced_ww		bigint;
cd_proc_pacote_w		bigint;
ie_orig_proc_pacote_w	bigint;
nr_seq_proc_pacote_w		bigint;
cd_medico_w			varchar(10);
cd_especialidade_w		integer;
qt_dia_internacao_w		bigint	:= 0;
cd_estabelecimento_w		integer;
vl_repasse_calc_w		double precision;
ie_clinica_alta_w		varchar(03);
qt_regra_interna_w		bigint;
ds_erro_w			varchar(255);
ie_status_protocolo_w	smallint;
vl_especialidade_w		double precision;
cd_setor_atendimento_w		integer;
nr_cirurgia_w			bigint;
ie_clinica_w			integer;
vl_custo_excluido_w		double precision;
ie_tipo_convenio_w		smallint;

IE_PROC_MAT_w			varchar(01);
nr_seq_grupo_rec_w		bigint;

cd_estrutura_conta_w		varchar(5);
count_w				bigint;
vl_glosado_w			double precision;
vl_amenor_w			double precision;
vl_adicional_w			double precision;
vl_custo_mat_w			double precision;
ds_agenda_cir_w			varchar(50);
cd_agenda_cir_w			bigint;
ie_carater_cirurgia_w		varchar(1);
nr_seq_eis_conta_w		bigint;
cd_centro_custo_w		integer;
cd_conta_contabil_w		varchar(20);
dt_entrada_w			timestamp;
cd_pessoa_fisica_w		varchar(10);
cd_plano_convenio_w		varchar(10);
nr_seq_interno_w		bigint;
cd_estab_atend_w		smallint;
cd_convenio_atend_w		integer;
cd_especialidade_atend_w	eis_conta_paciente.cd_especialidade_atend%type;
cd_grupo_w			eis_conta_paciente.cd_grupo%type;
ds_grupo_w			eis_conta_paciente.ds_grupo%type;
cd_subgrupo_w			eis_conta_paciente.cd_subgrupo%type;
ds_subgrupo_w			eis_conta_paciente.ds_subgrupo%type;
cd_forma_organizacao_w		eis_conta_paciente.cd_forma_organizacao%type;
ds_forma_organizacao_w		eis_conta_paciente.ds_forma_organizacao%type;
ie_complexidade_w		eis_conta_paciente.ie_complexidade%type;
ie_tipo_conv_w			eis_conta_paciente.ie_tipo_convenio%type;
ds_tipo_conv_w			eis_conta_paciente.ds_tipo_convenio%type;
ie_protocolo_w			varchar(2);
nr_seq_protocolo_w		conta_paciente.nr_seq_protocolo%type;
ie_status_acerto_w		conta_paciente.ie_status_acerto%type;

cd_proc_real_aih_w		bigint;
ds_proc_real_aih_w		varchar(255);
ds_municipio_ibge_w		varchar(255);
cd_setor_atual_w		setor_atendimento.cd_setor_atendimento%type;
ds_setor_atual_w		setor_atendimento.ds_setor_atendimento%type;

c01 CURSOR FOR
SELECT	/*+ index(a) */	PKG_DATE_UTILS.start_of(coalesce(dt_mesano_referencia,clock_timestamp()),'month',0),
	PKG_DATE_UTILS.start_of(b.dt_referencia, 'month', 0),
	cd_convenio_parametro,
	cd_setor_atendimento,
	sum(coalesce(vl_medico,0) + coalesce(vl_anestesista,0) + coalesce(vl_auxiliares,0)) vl_medico,
	sum(coalesce(vl_medico_fora_conta,0)) vl_medico_fora_conta,
	sum(coalesce(vl_material,0)) vl_material,
	sum(CASE WHEN ie_diaria='S' THEN  coalesce(vl_procedimento,0)  ELSE 0 END ) vl_diaria,
	sum(coalesce(vl_sadt_fora_conta,0)) vl_sadt_fora_conta,
	sum(coalesce(vl_custo,0)) vl_custo,
	sum(coalesce(vl_custo_variavel,0)) vl_custo_variavel,
	sum(coalesce(vl_custo_dir_apoio,0)) vl_custo_dir_apoio,
	sum(coalesce(vl_custo_mao_obra,0)) vl_custo_mao_obra,
	sum(coalesce(vl_custo_direto,0)) vl_custo_direto,
	sum(coalesce(vl_custo_indireto,0)) vl_custo_indireto,
	sum(coalesce(vl_despesa,0)) vl_custo_despesa,
	sum(coalesce(vl_custo_hm,0)) vl_custo_hm,
	sum(coalesce(vl_imposto,0)) vl_imposto,
	sum(CASE WHEN ie_diaria='S' THEN 0  ELSE (coalesce(vl_materiais,0) + coalesce(vl_custo_operacional,0)) END ) vl_proced,
	sum(coalesce(vl_materiais,0) + coalesce(vl_custo_operacional,0) + coalesce(vl_material,0)) vl_item,
	sum(coalesce(vl_procedimento,0) + coalesce(vl_material,0) - coalesce(vl_repasse_terceiro,0)) vl_total_receita,
	sum(coalesce(vl_repasse_terceiro,0)) vl_repasse_terceiro,
	sum(coalesce(vl_repasse_calc,0)) vl_repasse_calc,
	sum(coalesce(b.vl_desconto,0)) vl_desconto,
	sum(coalesce(vl_original,0)) vl_original,
	sum(coalesce(vl_glosa,0)) vl_glosa,
	sum(CASE WHEN coalesce(cd_material,0)=0 THEN 0  ELSE vl_custo_variavel END ) vl_custo_mat,
	nr_seq_proc_pacote,
	sum(coalesce(vl_custo_sadt,0)) vl_custo_sadt,
	sum(coalesce(vl_desc_financ,0)),
	nr_cirugia,
	sum(coalesce(vl_custo_excluido,0)) vl_custo_excluido,
	b.ie_proc_mat,
	b.nr_seq_grupo_rec,
	b.cd_estrutura_conta,
	b.cd_conta_contabil,
	b.cd_grupo,
	b.ds_grupo,
	b.cd_subgrupo,
	b.ds_subgrupo,
	b.cd_forma_organizacao,
	b.ds_forma_organizacao,
	b.ie_complexidade,
	a.nr_seq_protocolo,
	a.ie_status_acerto
from	conta_paciente_resumo b,
	Conta_Paciente a
where	a.nr_interno_conta	= nr_interno_conta_p
  and 	a.nr_interno_conta	= b.nr_interno_conta
group by
	PKG_DATE_UTILS.start_of(coalesce(dt_mesano_referencia,clock_timestamp()),'month',0),
	PKG_DATE_UTILS.start_of(b.dt_referencia, 'month', 0),
	a.cd_convenio_parametro,
	cd_setor_atendimento,
	nr_seq_proc_pacote,
	nr_cirugia,
	b.ie_proc_mat,
	b.nr_seq_grupo_rec,
	b.cd_estrutura_conta,
	b.cd_conta_contabil,
	b.cd_grupo,
	b.ds_grupo,
	b.cd_subgrupo,
	b.ds_subgrupo,
	b.cd_forma_organizacao,
	b.ds_forma_organizacao,
	b.ie_complexidade,
	a.nr_seq_protocolo,
	a.ie_status_acerto;

c02 CURSOR FOR
SELECT	cd_especialidade,
	sum(coalesce(vl_procedimento,0) + coalesce(vl_material,0) - coalesce(vl_repasse_terceiro,0)) vl_total_receita
from	conta_paciente_resumo
where	nr_interno_conta	= nr_interno_conta_p
group by cd_especialidade
order by 2;


C03 CURSOR FOR
	SELECT	nr_sequencia
	from	eis_conta_paciente
	where 	nr_interno_conta = nr_interno_conta_p;


BEGIN

open C03;
loop
fetch C03 into
	nr_seq_eis_conta_w;
EXIT WHEN NOT FOUND; /* apply on C03 */
	begin

	delete from eis_conta_paciente
	where nr_sequencia = nr_seq_eis_conta_w;

	end;
end loop;
close C03;

begin
select	a.nr_atendimento,
	a.cd_convenio_parametro,
	b.ie_tipo_atendimento,
	b.cd_medico_resp,
	round(coalesce(dt_alta,clock_timestamp()) - dt_entrada),
	coalesce(a.cd_estabelecimento, b.cd_estabelecimento),
	ie_clinica_alta,
	ie_clinica,
	ie_tipo_convenio,
	b.dt_entrada,
	b.dt_alta,
	b.cd_pessoa_fisica,
	b.cd_estabelecimento
into STRICT	nr_atendimento_w,
	cd_convenio_w,
	ie_tipo_atendimento_w,
	cd_medico_w,
	qt_dia_internacao_w,
	cd_estabelecimento_w,
	ie_clinica_alta_w,
	ie_clinica_w,
	ie_tipo_convenio_w,
	dt_entrada_w,
	dt_alta_w,
	cd_pessoa_fisica_w,
	cd_estab_atend_w
from 	atendimento_paciente b,
	conta_paciente a
where	a.nr_atendimento 	= b.nr_atendimento
and	a.nr_interno_conta 	= nr_interno_conta_p;
exception
	when others then
		nr_atendimento_w	:= 0;

end;

if (nr_atendimento_w > 0) then
	begin

	begin
		select 	cd_plano_convenio,
			cd_convenio
		into STRICT 	cd_plano_convenio_w,
			cd_convenio_atend_w
		from 	atend_categoria_convenio a
		where 	a.nr_atendimento	= nr_atendimento_w
		order by a.dt_inicio_vigencia desc LIMIT 1;
	exception
	when others then
		cd_plano_convenio_w	:= null;
	end;

	select Campo_Numerico(obter_especialidade_medico(cd_medico_w, 'C'))
	into STRICT cd_especialidade_w
	;
	if (coalesce(cd_especialidade_w,0) = 0) then
		open	c02;
		loop
		fetch	c02 into
			cd_especialidade_w,
			vl_especialidade_w;
		EXIT WHEN NOT FOUND; /* apply on c02 */
			cd_especialidade_w	:= cd_especialidade_w;
		end loop;
		close c02;
	end if;
	cd_especialidade_w	:= coalesce(cd_especialidade_w,0);

	/*lhalves OS 656210 em 25/02/2014 - Buscar a especialidade do atendimento.
	Esta especialidade é informada pelo PEP, opção 'Alterar espec. médica no atendimento'*/
	begin
		select	cd_especialidade
		into STRICT	cd_especialidade_atend_w
		from	atendimento_troca_medico
		where	nr_atendimento	= nr_atendimento_w
		and	cd_medico_atual	= cd_medico_w  LIMIT 1;
	exception
	when others then
		cd_especialidade_atend_w	:= null;
	end;

	select	count(1)
	into STRICT	qt_regra_interna_w
	from	regra_int_proc_princ LIMIT 1;

	if (qt_regra_interna_w > 0) then
		SELECT * FROM obter_proc_princ_interno(
			nr_atendimento_w, ie_tipo_atendimento_w, cd_procedimento_w, ie_origem_proced_w, nr_interno_conta_p) INTO STRICT cd_procedimento_w, ie_origem_proced_w;

	else
		select	obter_proc_principal(
			nr_atendimento_w,
			cd_convenio_w,
			ie_tipo_atendimento_w,
			nr_interno_conta_p, 'CO')
		into STRICT	cd_proc_retorno_w
		;

		if (length(cd_proc_retorno_w) = 9) then
			begin
			cd_origem_e_proc_w		:= substr(cd_proc_retorno_w,1,9);
			if (cd_origem_e_proc_w IS NOT NULL AND cd_origem_e_proc_w::text <> '') and (length(cd_origem_e_proc_w) = 09) then
				begin
				cd_procedimento_w	:= substr(cd_origem_e_proc_w,2,8);
				ie_origem_proced_w	:= substr(cd_origem_e_proc_w,1,1);
				exception
					when others then
						cd_procedimento_w	:= null;
						ie_origem_proced_w	:= null;
				end;
			end if;
			end;
		elsif (length(cd_proc_retorno_w) = 10) then
			begin
			cd_origem_e_proc_w		:= substr(cd_proc_retorno_w,1,10);
			if (cd_origem_e_proc_w IS NOT NULL AND cd_origem_e_proc_w::text <> '') and (length(cd_origem_e_proc_w) = 10) then
				begin
				cd_procedimento_w	:= substr(cd_origem_e_proc_w,2,9);
				ie_origem_proced_w	:= substr(cd_origem_e_proc_w,1,1);
				exception
					when others then
						cd_procedimento_w	:= null;
						ie_origem_proced_w	:= null;
				end;
			end if;
			end;
		end if;
	end if;

	begin
	select cd_procedimento,
		ie_origem_proced
	into STRICT	cd_procedimento_w,
		ie_origem_proced_w
	from	procedimento
	where	cd_procedimento	= cd_procedimento_w
	  and ie_origem_proced	= ie_origem_proced_w;
	exception
		when others then
			cd_procedimento_w		:= null;
			ie_origem_proced_w	:= null;
	end;

	open	c01;
	loop
	fetch	c01 into
			dt_referencia_w,
			dt_producao_w,
			cd_convenio_w,
			cd_setor_atendimento_w,
			vl_medico_w,
			vl_medico_fora_conta_w,
			vl_material_w,
			vl_diaria_w,
			vl_sadt_fora_conta_w,
			vl_custo_w,
			vl_custo_variavel_w,
			vl_custo_dir_apoio_w,
			vl_custo_mao_obra_w,
			vl_custo_direto_w,
			vl_custo_indireto_w,
			vl_despesa_w,
			vl_custo_hm_w,
			vl_imposto_w,
			vl_procedimento_w,
			vl_item_w,
			vl_receita_w,
			vl_repasse_terceiro_w,
			vl_repasse_calc_w,
			vl_desconto_w,
			vl_original_w,
			vl_glosa_w,
			vl_custo_mat_w,
			nr_seq_proc_pacote_w,
			vl_custo_sadt_w,
			vl_desc_financ_w,
			nr_cirurgia_w,
			vl_custo_excluido_w,
			IE_PROC_MAT_w,
			nr_seq_grupo_rec_w,
			cd_estrutura_conta_w,
			cd_conta_contabil_w,
			cd_grupo_w,
			ds_grupo_w,
			cd_subgrupo_w,
			ds_subgrupo_w,
			cd_forma_organizacao_w,
			ds_forma_organizacao_w,
			ie_complexidade_w,
			nr_seq_protocolo_w,
			ie_status_acerto_w;
	EXIT WHEN NOT FOUND; /* apply on c01 */
		begin
		select 	nextval('eis_conta_paciente_seq')
		into STRICT	nr_sequencia_w
		;
		if (coalesce(nr_seq_proc_pacote_w::text, '') = '') then
			begin
			cd_proc_pacote_w		:= null;
			ie_orig_proc_pacote_w		:= null;
			end;
		else
			begin
			select	max(cd_procedimento),
				max(ie_origem_proced)
			into STRICT	cd_proc_pacote_w,
				ie_orig_proc_pacote_w
			from	Procedimento_paciente
			where	nr_sequencia		= nr_seq_proc_pacote_w;
			end;
		end if;
			begin

			select	count(1)
			into STRICT	count_w
			from	eis_conta_paciente
			where	nr_interno_conta	= nr_interno_conta_p  LIMIT 1;

			if (count_w = 0) then
				vl_glosado_w	:= coalesce(obter_valor_ret_conta(nr_interno_conta_p, 'G'),0);
				vl_amenor_w	:= coalesce(obter_valor_ret_conta(nr_interno_conta_p, 'AM'),0);
				vl_adicional_w	:= coalesce(obter_valor_ret_conta(nr_interno_conta_p, 'AD'),0);
			else
				vl_glosado_w	:= 0;
				vl_amenor_w	:= 0;
				vl_adicional_w	:= 0;
			end if;

			select	max(ie_status_protocolo)
			into STRICT	ie_status_protocolo_w
			from	protocolo_convenio a,
					conta_paciente b
			where	a.nr_seq_protocolo	= b.nr_seq_protocolo
			and		b.nr_interno_conta	= nr_interno_conta_p;

			cd_agenda_cir_w:= null;
			ds_agenda_cir_w:= null;
			ie_carater_cirurgia_w:= null;

			if (coalesce(nr_cirurgia_w,0) > 0) then
				select  coalesce(max(d.cd_agenda),0)
				into STRICT    cd_agenda_cir_w
				from    agenda d,
					agenda_paciente c,
					cirurgia b,
					procedimento_paciente a
				where   a.nr_cirurgia = b.nr_cirurgia
				and     b.nr_cirurgia = c.nr_cirurgia
				and     c.cd_agenda   = d.cd_agenda
				and     b.nr_cirurgia = nr_cirurgia_w;

				if (coalesce(cd_agenda_cir_w,0) > 0) then
					select 	coalesce(max(ds_agenda),Wheb_mensagem_pck.get_Texto(305936))
					into STRICT	ds_agenda_cir_w
					from 	agenda
					where 	cd_agenda = cd_agenda_cir_w;
				end if;

				select 	max(ie_carater_cirurgia)
				into STRICT	ie_carater_cirurgia_w
				from 	cirurgia
				where 	nr_cirurgia = nr_cirurgia_w;
			end if;

			begin
			cd_centro_custo_w := obter_centro_custo_setor(cd_setor_atendimento_w, 'C');
			exception
			when others then
			cd_centro_custo_w:= null;
			end;

			/* OS  735121 */

			if (coalesce(qt_dia_internacao_w,0) > 99999) then
				qt_dia_internacao_w := 99999;
			end if;

			select 	max(ie_tipo_convenio)
			into STRICT	ie_tipo_conv_w
			from 	convenio
			where	cd_convenio = cd_convenio_w;

			if (ie_tipo_conv_w IS NOT NULL AND ie_tipo_conv_w::text <> '') then
				select 	obter_valor_dominio(11, ie_tipo_conv_w)
				into STRICT	ds_tipo_conv_w
				;
			end if;

			ie_protocolo_w:= obter_status_conta_protocolo(nr_interno_conta_p, ie_status_acerto_w, nr_seq_protocolo_w);

			cd_proc_real_aih_w:= coalesce(sus_obter_proced_aih_eis(nr_interno_conta_p,2,'C'),0);

			select 	substr(coalesce(sus_obter_proced_aih_eis(nr_interno_conta_p,2,'D'),wheb_mensagem_pck.get_texto(804096)),1,255)
			into STRICT	ds_proc_real_aih_w
			;

			SELECT	coalesce(max(ds_municipio),wheb_mensagem_pck.get_texto(803574))
			INTO STRICT	ds_municipio_ibge_w
			FROM (SELECT b.ds_municipio
					 FROM	sus_municipio b,
					 		compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_w
					 AND	a.ie_tipo_complemento 	= 1
					 AND	b.cd_municipio_ibge		= a.cd_municipio_ibge
					 ORDER	BY a.nr_sequencia DESC) alias3 LIMIT 1;

			select	somente_numero(max(x.cd_setor_atendimento))
			into STRICT	cd_setor_atual_w
			from 	atend_paciente_unidade x
			where 	x.nr_atendimento = nr_atendimento_w
			and 	x.nr_seq_interno = obter_atepacu_paciente(nr_atendimento_w, 'A');

			select 	coalesce(max(ds_setor_atendimento), wheb_mensagem_pck.get_texto(803574))
			into STRICT 	ds_setor_atual_w
			from 	setor_atendimento
			where 	cd_setor_atendimento = cd_setor_atual_w;


			insert into Eis_Conta_Paciente(
				nr_sequencia,
				nr_interno_conta,
				dt_referencia,
				ie_tipo_atendimento,
				cd_convenio,
				dt_atualizacao,
				vl_medico,
				vl_medico_fora_conta,
				vl_material,
				vl_diaria,
				vl_sadt_fora_conta,
				vl_custo,
				vl_custo_variavel,
				vl_imposto,
				vl_procedimento,
				vl_item,
				vl_receita,
				vl_repasse_terceiro,
				vl_desconto,
				cd_procedimento,
				ie_origem_proced,
				cd_proc_pacote,
				ie_orig_proc_pacote,
				vl_original,
				cd_medico,
				cd_especialidade,
				qt_dia_internacao,
				vl_custo_dir_apoio,
				vl_custo_mao_obra,
				vl_custo_direto,
				vl_custo_indireto,
				vl_despesa,
				vl_glosa,
				vl_desc_financ,
				vl_repasse_calc,
				ie_clinica_alta,
				vl_custo_sadt,
				vl_custo_hm,
				ie_status_protocolo,
				dt_receita,
				cd_setor_atendimento,
				nr_cirurgia,
				ie_clinica,
				vl_custo_excluido,
				IE_PROC_MAT,
				nr_seq_grupo_rec,
				cd_estrutura_conta,
				vl_glosado,
				vl_amenor,
				vl_adicional,
				vl_custo_mat,
				ds_agenda_cir,
				cd_agenda_cir,
				ie_carater_cirurgia,
				cd_conta_contabil,
				cd_centro_custo_setor,
				dt_entrada,
				dt_alta,
				cd_pessoa_fisica,
				cd_plano_convenio,
				cd_estab_atend,
				cd_grupo,
				ds_grupo,
				cd_subgrupo,
				ds_subgrupo,
				cd_forma_organizacao,
				ds_forma_organizacao,
				ie_complexidade,
				cd_convenio_atend,
				cd_especialidade_atend,
				ie_tipo_convenio,
				ds_tipo_convenio,
				ie_protocolo,
				cd_proc_real_aih,
				ds_proc_real_aih,
				ds_municipio_ibge,
				cd_setor_atual,
				ds_setor_atual)
			values (
				nr_sequencia_w,
				nr_interno_conta_p,
				dt_referencia_w,
				ie_tipo_atendimento_w,
				cd_convenio_w,
				clock_timestamp(),
				vl_medico_w,
				vl_medico_fora_conta_w,
				vl_material_w,
				vl_diaria_w,
				vl_sadt_fora_conta_w,
				vl_custo_w,
				vl_custo_variavel_w,
				vl_imposto_w,
				vl_procedimento_w,
				vl_item_w,
				vl_receita_w,
				vl_repasse_terceiro_w,
				vl_desconto_w,
				cd_procedimento_w,
				ie_origem_proced_w,
				cd_proc_pacote_w,
				ie_orig_proc_pacote_w,
				vl_original_w,
				cd_medico_w,
				cd_especialidade_w,
				qt_dia_internacao_w,
				vl_custo_dir_apoio_w,
				vl_custo_mao_obra_w,
				vl_custo_direto_w,
				vl_custo_indireto_w,
				vl_despesa_w,
				vl_glosa_w,
				vl_desc_financ_w,
				vl_repasse_calc_w,
				ie_clinica_alta_w,
				vl_custo_sadt_w,
				vl_custo_hm_w,
				ie_status_protocolo_w,
				dt_producao_w,
				cd_setor_atendimento_w,
				nr_cirurgia_w,
				ie_clinica_w,
				vl_custo_excluido_w,
				IE_PROC_MAT_w,
				nr_seq_grupo_rec_w,
				cd_estrutura_conta_w,
				vl_glosado_w,
				vl_amenor_w,
				vl_adicional_w,
				vl_custo_mat_w,
				ds_agenda_cir_w,
				cd_agenda_cir_w,
				ie_carater_cirurgia_w,
				cd_conta_contabil_w,
				cd_centro_custo_w,
				dt_entrada_w,
				dt_alta_w,
				cd_pessoa_fisica_w,
				cd_plano_convenio_w,
				cd_estab_atend_w,
				cd_grupo_w,
				ds_grupo_w,
				cd_subgrupo_w,
				ds_subgrupo_w,
				cd_forma_organizacao_w,
				ds_forma_organizacao_w,
				ie_complexidade_w,
				cd_convenio_atend_w,
				cd_especialidade_atend_w,
				ie_tipo_conv_w,
				ds_tipo_conv_w,
				ie_protocolo_w,
				cd_proc_real_aih_w,
				ds_proc_real_aih_w,
				ds_municipio_ibge_w,
				cd_setor_atual_w,
				ds_setor_atual_w);
			exception
				when others then
					begin
					ds_erro_w	:= SQLERRM(SQLSTATE);
					/*r.aise_application_error(-20011,
						'Erro ao gravar a tabela Eis_Conta_Paciente' || chr(13) ||
						'Erro: ' || ds_erro_w || chr(13) ||
						'Conta: ' || nr_interno_conta_p || chr(13) ||
						'Seq: ' || nr_sequencia_w || chr(13) ||
						'Ref: ' || dt_referencia_w || chr(13) ||
						'T.A: ' || ie_tipo_atendimento_w || chr(13) ||
						'Conv: ' || cd_convenio_w || chr(13) ||
						'Vl.Medico: ' || vl_medico_w || chr(13) ||
						'Vl.Med.FC: ' || vl_medico_fora_conta_w || chr(13) ||
						'Vl.Mat: ' || vl_material_w || chr(13) ||
						'Vl.Diaria: ' || vl_diaria_w || chr(13) ||
						'Vl.SADT: ' || vl_sadt_fora_conta_w || chr(13) ||
						'Vl.Custo: ' || vl_custo_w || chr(13) ||
						'Vl.Custo Var: ' || vl_custo_variavel_w || chr(13) ||
						'Vl.Imposto: ' || vl_imposto_w || chr(13) ||
						'Vl.Proc: ' || vl_procedimento_w || chr(13) ||
						'Vl.Item: ' || vl_item_w || chr(13) ||
						'Vl.Rec: ' || vl_receita_w || chr(13) ||
						'Vl.Repasse: ' || vl_repasse_terceiro_w || chr(13) ||
						'Vl.Desc: ' || vl_desconto_w || chr(13) ||
						'Proc: ' || cd_procedimento_w || chr(13) ||
						'Orig.Proc: ' || ie_orig_proc_pacote_w || chr(13) ||
						'Proc Pac: ' || cd_proc_pacote_w || chr(13) ||
						'Orig.Pac: ' || ie_orig_proc_pacote_w || chr(13) ||
						'Vl.Orig: ' || vl_original_w || chr(13) ||
						'Médico: ' || cd_medico_w || chr(13) ||
						'Especial: ' || cd_especialidade_w || chr(13) ||
						'Custo Apoio: ' || vl_custo_dir_apoio_w || chr(13) ||
						'Mao Obra: ' || vl_custo_mao_obra_w || chr(13) ||
						'Custo Direto: ' || vl_custo_direto_w || chr(13) ||
						'Custo Ind: ' || vl_custo_indireto_w || chr(13) ||
						'Vl.Desp: ' || vl_despesa_w || chr(13) ||
						'Vl.Glosa: ' || vl_glosa_w || chr(13) ||
						'Vl.Custo HM: ' || vl_custo_hm_w || chr(13) ||
						'Vl.Desc.Fin: ' || vl_desc_financ_w) ;*/
					CALL wheb_mensagem_pck.exibir_mensagem_abort(263360,	'ds_erro_w='||ds_erro_w ||';'||
											'nr_interno_conta_p='||nr_interno_conta_p ||';'||
											'nr_sequencia_w='||nr_sequencia_w ||';'||
											'dt_referencia_w='||dt_referencia_w ||';'||
											'ie_tipo_atendimento_w='||ie_tipo_atendimento_w ||';'||
											'cd_convenio_w='|| cd_convenio_w ||';'||
											'vl_medico_w='|| vl_medico_w ||';'||
											'vl_medico_fora_conta_w='|| vl_medico_fora_conta_w ||';'||
											'vl_material_w='|| vl_material_w ||';'||
											'vl_diaria_w='|| vl_diaria_w ||';'||
											'vl_sadt_fora_conta_w='|| vl_sadt_fora_conta_w ||';'||
											'vl_custo_w='|| vl_custo_w ||';'||
											'vl_custo_variavel_w='|| vl_custo_variavel_w ||';'||
											'vl_imposto_w='|| vl_imposto_w ||';'||
											'vl_procedimento_w='|| vl_procedimento_w ||';'||
											'vl_item_w='|| vl_item_w ||';'||
											'vl_receita_w='|| vl_receita_w ||';'||
											'vl_repasse_terceiro_w='|| vl_repasse_terceiro_w ||';'||
											'vl_desconto_w='|| vl_desconto_w ||';'||
											'cd_procedimento_w='|| cd_procedimento_w ||';'||
											'ie_orig_proc_pacote_w='|| ie_orig_proc_pacote_w ||';'||
											'cd_proc_pacote_w='|| cd_proc_pacote_w ||';'||
											'ie_orig_proc_pacote_w='|| ie_orig_proc_pacote_w ||';'||
											'vl_original_w='|| vl_original_w ||';'||
											'cd_medico_w='|| cd_medico_w ||';'||
											'cd_especialidade_w='|| cd_especialidade_w ||';'||
											'vl_custo_dir_apoio_w='|| vl_custo_dir_apoio_w ||';'||
											'vl_custo_mao_obra_w='|| vl_custo_mao_obra_w ||';'||
											'vl_custo_direto_w='|| vl_custo_direto_w ||';'||
											'vl_custo_indireto_w='|| vl_custo_indireto_w ||';'||
											'vl_despesa_w='|| vl_despesa_w ||';'||
											'vl_glosa_w='|| vl_glosa_w ||';'||
											'vl_custo_hm_w='|| vl_custo_hm_w ||';'||
											'vl_desc_financ_w='|| vl_desc_financ_w);

					end;
				end;

		end;
	end loop;
	close c01;
	end;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_eis_conta_paciente ( nr_interno_conta_p bigint) FROM PUBLIC;

