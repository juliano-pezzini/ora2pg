-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE intcom_grava_sc_item_integrado ( nr_solic_compra_p bigint) AS $body$
DECLARE


type sc_item_id_table is table of solic_compra_item.nr_item_solic_compra%type index by integer;

list_sc_item_id sc_item_id_table;

c01 CURSOR FOR
SELECT b.nr_item_solic_compra
FROM solic_compra a,
  solic_compra_item b,
  parametro_compras c
WHERE a.nr_solic_compra                                        = b.nr_solic_compra
AND a.cd_estabelecimento                                       = c.cd_estabelecimento
AND a.nr_solic_compra                                          = nr_solic_compra_p
AND c.ie_forma_envio_cot                                      IN ('IC','TI')
AND (select obter_se_integra_sc_item(a.nr_solic_compra, b.cd_material) ) = 'S'
;

BEGIN

open c01;
loop fetch c01
BULK COLLECT INTO list_sc_item_id LIMIT 100;
	for indx in 1..list_sc_item_id.count
	loop
		update solic_compra_item
		set IE_ENVIADO_INTEGR = 'S'
		where nr_solic_compra = nr_solic_compra_p
		and nr_item_solic_compra = list_sc_item_id(indx);
	end loop;
	exit when list_sc_item_id.count = 0;
end loop;
close c01;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE intcom_grava_sc_item_integrado ( nr_solic_compra_p bigint) FROM PUBLIC;

