-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_copiar_resc_benef_depend ( nr_seq_rescisao_p pls_rescisao_contrato.nr_sequencia%type, nr_seq_titular_p pls_segurado.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
Copiar a rescisão programada do titular para os dependentes.
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [ x] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
C01 CURSOR FOR
	SELECT	nr_sequencia nr_seq_segurado
	from	pls_segurado
	where	nr_seq_titular	= nr_seq_titular_p
	and	coalesce(dt_rescisao::text, '') = '';

BEGIN

for C01_w in C01 loop
	begin
		insert into pls_rescisao_contrato( 	nr_sequencia, dt_atualizacao, nm_usuario,
							dt_atualizacao_nrec, nm_usuario_nrec, nr_seq_segurado,
							dt_rescisao, ds_observacao, ie_situacao,
							nr_seq_contrato, ie_tipo_solicitante, nm_usuario_solicitacao,
							dt_solicitacao, nr_seq_motivo_rescisao, ie_processo,
							nr_seq_pagador, nr_seq_intercambio, dt_limite_utilizacao,
							ie_devolucao_carteira, dt_obito, nr_certidao_obito,
							qt_meses_contribuicao, dt_concessao, dt_liberacao,
							ie_status_lib, ie_exige_liberacao_web, nr_seq_causa_rescisao
							)
						SELECT	nextval('pls_rescisao_contrato_seq'), clock_timestamp(), nm_usuario_p,
							clock_timestamp(), nm_usuario_p, C01_w.nr_seq_segurado,
							dt_rescisao, ds_observacao, ie_situacao,
							nr_seq_contrato, ie_tipo_solicitante, nm_usuario_solicitacao,
							dt_solicitacao, nr_seq_motivo_rescisao, ie_processo,
							nr_seq_pagador, nr_seq_intercambio, dt_limite_utilizacao,
							ie_devolucao_carteira, dt_obito, nr_certidao_obito,
							qt_meses_contribuicao, dt_concessao, dt_liberacao,
							ie_status_lib, ie_exige_liberacao_web, nr_seq_causa_rescisao
						from	pls_rescisao_contrato
						where	nr_sequencia	= nr_seq_rescisao_p;
	end;
end loop;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_copiar_resc_benef_depend ( nr_seq_rescisao_p pls_rescisao_contrato.nr_sequencia%type, nr_seq_titular_p pls_segurado.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;

