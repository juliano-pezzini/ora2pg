-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_script_expressoes ( dt_inicial_p timestamp, dt_final_p timestamp, nm_usuario_p text) AS $body$
DECLARE


ds_expressao_br_w		dic_expressao_idioma.ds_expressao%type;
ds_expressao_mx_w		dic_expressao_idioma.ds_expressao%type;
ds_expressao_us_w		dic_expressao_idioma.ds_expressao%type;
cd_expressao_w			bigint;
ds_resultado_w			varchar(4000) := '';

c01 CURSOR FOR
SELECT	obter_desc_expressao_idioma(cd_expressao, null, 1) ds_expressao_br,
	obter_desc_expressao_idioma(cd_expressao, null, 2) ds_expressao_mx,
	obter_desc_expressao_idioma(cd_expressao, null, 5) ds_expressao_us,
	cd_expressao
from	dic_expressao
where	dt_atualizacao between dt_inicial_p and dt_final_p
and	nm_usuario = nm_usuario_p;


BEGIN

delete	from w_dic_expressao_script
where	nm_usuario = nm_usuario_p;
commit;

open C01;
loop
fetch C01 into
	ds_expressao_br_w,
	ds_expressao_mx_w,
	ds_expressao_us_w,
	cd_expressao_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	ds_resultado_w :=	' update	dic_expressao_idioma ' ||
				' set		ds_expressao = ' || chr(39) || ds_expressao_br_w || chr(39) ||
				' where		cd_expressao = ' || cd_expressao_w ||
				' and		ds_idioma = ' || chr(39) || 'pt' || chr(39) ||
				' and		(ds_locale is null or ds_locale = expressao_pck.obter_locale_idioma(1));' || chr(10) || chr(13) ||
				' update	dic_expressao_idioma ' ||
				' set		ds_expressao = ' || chr(39) || ds_expressao_mx_w || chr(39) ||
				' where		cd_expressao = ' || cd_expressao_w ||
				' and		ds_idioma = ' || chr(39) || 'es' || chr(39) ||
				' and		(ds_locale is null or ds_locale = expressao_pck.obter_locale_idioma(2));' || chr(10) || chr(13) ||
				' update	dic_expressao_idioma ' ||
				' set		ds_expressao = ' || chr(39) || ds_expressao_us_w || chr(39) ||
				' where		cd_expressao = ' || cd_expressao_w ||
				' and		ds_idioma = ' || chr(39) || 'en' || chr(39) ||
				' and		(ds_locale is null or ds_locale = expressao_pck.obter_locale_idioma(5));' || chr(10) || chr(13);

	insert into w_dic_expressao_script(nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		ds_script)
	values (	nextval('w_dic_expressao_script_seq'),
		clock_timestamp(),
		nm_usuario_p,
		ds_resultado_w);

	commit;

end loop;
close C01;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_script_expressoes ( dt_inicial_p timestamp, dt_final_p timestamp, nm_usuario_p text) FROM PUBLIC;

