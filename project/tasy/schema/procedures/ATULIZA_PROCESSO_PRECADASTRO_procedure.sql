-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atuliza_processo_precadastro (nr_seq_processo_p bigint, ie_tipo_processo_p text, nm_usuario_p text) AS $body$
DECLARE


dt_liberacao_w timestamp := null;														
nm_usuario_lib_w varchar(255) := null;
														

BEGIN							 

if (ie_tipo_processo_p IS NOT NULL AND ie_tipo_processo_p::text <> '') then

	if (ie_tipo_processo_p = 'LIBERAR') then
		dt_liberacao_w := clock_timestamp();
		nm_usuario_lib_w := nm_usuario_p;
	end if;
	
	update processo_pre_cadastro set nm_usuario_lib = nm_usuario_lib_w, dt_liberacao = dt_liberacao_w where nr_sequencia = nr_seq_processo_p;
	
	insert into processo_precad_hist(nr_sequencia,
									dt_atualizacao,
									nm_usuario,
									dt_atualizacao_nrec,
									nm_usuario_nrec,
									dt_liberacao,
									nm_usuario_lib,
									nr_seq_processo,
									ds_historico
									) values (
									nextval('processo_precad_hist_seq'),
									clock_timestamp(),
									nm_usuario_p,
									clock_timestamp(),
									nm_usuario_p,
									dt_liberacao_w,
									nm_usuario_p,
									nr_seq_processo_p,
									ie_tipo_processo_p);
									
end if;
	
end;	
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atuliza_processo_precadastro (nr_seq_processo_p bigint, ie_tipo_processo_p text, nm_usuario_p text) FROM PUBLIC;

