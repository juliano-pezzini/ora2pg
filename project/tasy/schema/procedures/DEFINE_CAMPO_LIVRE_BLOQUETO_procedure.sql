-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE define_campo_livre_bloqueto ( cd_banco_p bigint, ds_campo_livre_p text, cd_agencia_cedente_p INOUT text, cd_carteira_p INOUT text, nr_banco_p INOUT text, nr_conta_cedente_p INOUT text, ie_digito_conta_p INOUT text) AS $body$
DECLARE


cd_agencia_cedente_w		varchar(10);
nr_conta_cedente_w		varchar(10);
cd_carteira_w			varchar(10);
nr_banco_w				varchar(20);
ds_campo_livre_w			varchar(255);
ie_digito_conta_w			varchar(02);


BEGIN

ds_campo_livre_w			:= ds_campo_livre_p;

if (cd_banco_p = 291) or (cd_banco_p = 237) then
	select	substr(ds_campo_livre_w,1,4),
		substr(ds_campo_livre_w,5,2),
		substr(ds_campo_livre_w,7,11),
		substr(ds_campo_livre_w,18,7),
		Calcula_Digito('Modulo11',substr(ds_campo_livre_w,18,7))
	into STRICT	cd_agencia_cedente_w,
		cd_carteira_w,
		nr_banco_w,
		nr_conta_cedente_w,
		ie_digito_conta_w
	;
/* Caixa Economica Federal */

elsif (cd_banco_p = 104) then
	select	substr(ds_campo_livre_w,1,4),
		substr(ds_campo_livre_w,5,2),
		substr(ds_campo_livre_w,7,11),
		substr(ds_campo_livre_w,18,8),
		Calcula_Digito('Modulo11',substr(ds_campo_livre_w,18,8))
	into STRICT	cd_agencia_cedente_w,
		cd_carteira_w,
		nr_banco_w,
		nr_conta_cedente_w,
		ie_digito_conta_w
	;
/* Unibanco */

elsif (cd_banco_p = 409) then
	select
		substr(ds_campo_livre_w,9,4),
		'0',
		substr(ds_campo_livre_w,14,11),
		'0',
		'0'
	into STRICT	cd_agencia_cedente_w,
		cd_carteira_w,
		nr_banco_w,
		nr_conta_cedente_w,
		ie_digito_conta_w
	;
/* Banco Ita√∫ */

elsif (cd_banco_p = 341) then
	select	substr(ds_campo_livre_w,13,4) cd_agencia_cedente,
		substr(ds_campo_livre_w,17,5) nr_conta_cedente,
		Calcula_Digito('Modulo11',substr(ds_campo_livre_w,17,5)) ie_digito_conta
	into STRICT	cd_agencia_cedente_w,
		nr_conta_cedente_w,
		ie_digito_conta_w
	;
end if;

cd_agencia_cedente_p		:= cd_agencia_cedente_w;
cd_carteira_p			:= cd_carteira_w;
nr_conta_cedente_p		:= nr_conta_cedente_w;
nr_banco_p				:= nr_banco_w;
ie_digito_conta_p			:= ie_digito_conta_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE define_campo_livre_bloqueto ( cd_banco_p bigint, ds_campo_livre_p text, cd_agencia_cedente_p INOUT text, cd_carteira_p INOUT text, nr_banco_p INOUT text, nr_conta_cedente_p INOUT text, ie_digito_conta_p INOUT text) FROM PUBLIC;

