-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE consistir_valores_neg_cr (nr_seq_negociacao_p bigint, nr_seq_registro_p bigint, nm_tabela_p text, vl_inserido_p bigint) AS $body$
DECLARE


vl_saldo_negociacao_w	double precision;
vl_registro_w		double precision	:= 0;


BEGIN

if (nr_seq_negociacao_p IS NOT NULL AND nr_seq_negociacao_p::text <> '') then
	if (nr_seq_registro_p IS NOT NULL AND nr_seq_registro_p::text <> '') then
		if (nm_tabela_p = 'NEGOCIACAO_CR_CHEQUE') then
			select	coalesce(sum(a.vl_cheque),0)
			into STRICT	vl_registro_w
			from	negociacao_cr_cheque a
			where	a.nr_sequencia	= nr_seq_registro_p;
		elsif (nm_tabela_p = 'NEGOCIACAO_CR_CARTAO') then
			select	coalesce(sum(a.vl_transacao),0)
			into STRICT	vl_registro_w
			from	negociacao_cr_cartao a
			where	a.nr_sequencia	= nr_seq_registro_p;
		elsif (nm_tabela_p = 'NEGOCIACAO_CR_ESPECIE') then
			select	coalesce(sum(a.vl_especie),0)
			into STRICT	vl_registro_w
			from	negociacao_cr_especie a
			where	a.nr_sequencia	= nr_seq_registro_p;
		elsif (nm_tabela_p = 'NEGOCIACAO_CR_BOLETO') then
			select	coalesce(sum(a.vl_parcela),0)
			into STRICT	vl_registro_w
			from	negociacao_cr_boleto a
			where	a.nr_sequencia	= nr_seq_registro_p;
		elsif (nm_tabela_p = 'NEGOCIACAO_CR_DEB_CC') then
			select	coalesce(sum(a.vl_debito),0)
			into STRICT	vl_registro_w
			from	negociacao_cr_deb_cc a
			where	a.nr_sequencia	= nr_seq_registro_p;
		elsif (nm_tabela_p = 'NEGOCIACAO_CR_PLS_MENS') then
			select	coalesce(sum(a.vl_mensalidade),0)
			into STRICT	vl_registro_w
			from	negociacao_cr_pls_mens a
			where	a.nr_sequencia	= nr_seq_registro_p;
		elsif (nm_tabela_p = 'NEGOCIACAO_CR_DEP_IDENT') then
			select	coalesce(sum(a.vl_deposito),0)
			into STRICT	vl_registro_w
			from	negociacao_cr_dep_ident a
			where	a.nr_sequencia	= nr_seq_registro_p;
		end if;
	end if;

	vl_saldo_negociacao_w	:= obter_valores_negociacao_cr(nr_seq_negociacao_p,'VS');

	if (vl_saldo_negociacao_w + vl_registro_w - coalesce(vl_inserido_p,0) < 0) then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(175600);
	end if;

end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE consistir_valores_neg_cr (nr_seq_negociacao_p bigint, nr_seq_registro_p bigint, nm_tabela_p text, vl_inserido_p bigint) FROM PUBLIC;

