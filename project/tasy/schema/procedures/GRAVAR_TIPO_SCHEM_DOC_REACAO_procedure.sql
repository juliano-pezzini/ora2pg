-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gravar_tipo_schem_doc_reacao ( nm_usuario_p text, nr_sequencia_p bigint, ie_reacao_p bigint, ds_comentario_p text) AS $body$
DECLARE


/*
1 - Curtir
2 - Comentar
3 - Informação adicional
*/
qt_w		bigint;


BEGIN

if (ie_reacao_p = '1') then --Curtir apenas 1 vez
	select	count(*)
	into STRICT	qt_w
	from	tipo_schem_doc_reacao
	where	nr_seq_tipo_schem_doc = nr_sequencia_p
	and	nm_usuario = nm_usuario_p
	and	ie_reacao_usuario = 1;

	if (qt_w = 0) then

		insert into tipo_schem_doc_reacao(nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_tipo_schem_doc,
			ie_reacao_usuario,
			ds_comentario)
		values (nextval('tipo_schem_doc_reacao_seq'),
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			nr_sequencia_p,
			ie_reacao_p,
			null);
	end if;

else
	insert into tipo_schem_doc_reacao(nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		nr_seq_tipo_schem_doc,
		ie_reacao_usuario,
		ds_comentario)
	values (nextval('tipo_schem_doc_reacao_seq'),
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		nr_sequencia_p,
		ie_reacao_p,
		ds_comentario_p);

end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gravar_tipo_schem_doc_reacao ( nm_usuario_p text, nr_sequencia_p bigint, ie_reacao_p bigint, ds_comentario_p text) FROM PUBLIC;

