-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_hist_alteracao_status (nr_sequencia_p text, cd_motivo_p bigint, ie_quimioterapia_p text, ds_historico_p text, nm_usuario_p text) AS $body$
BEGIN

if (coalesce(nr_sequencia_p,0) > 0) then
	insert into	gestao_vaga_hist(nr_sequencia,
								nr_seq_gestao,          
								dt_atualizacao,         
								nm_usuario,             
								dt_historico,           
								cd_pessoa_fisica,       
								ds_historico,
								nr_seq_motivo_historico,
								dt_atualizacao_nrec,    
								nm_usuario_nrec,
								nm_usuario_liberacao,
								dt_liberacao)
				values (nextval('gestao_vaga_hist_seq'),
							nr_sequencia_p,
							clock_timestamp(),
							nm_usuario_p,
							clock_timestamp(),
							obter_pf_usuario(nm_usuario_p,'C'),
							ds_historico_p,
							cd_motivo_p,
							clock_timestamp(),
							nm_usuario_p,
							nm_usuario_p,
							clock_timestamp());
	
	update	gestao_vaga
	set		ie_quimioterapia = CASE WHEN ie_quimioterapia_p=0 THEN 'S' WHEN ie_quimioterapia_p=1 THEN 'N' END
	where	nr_sequencia 	= nr_sequencia_p;
	
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_hist_alteracao_status (nr_sequencia_p text, cd_motivo_p bigint, ie_quimioterapia_p text, ds_historico_p text, nm_usuario_p text) FROM PUBLIC;

