-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE excluir_agenda_paciente (cd_agenda_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
qt_dia_historico_w		integer;
ds_chave_w			varchar(255);

BEGIN
 
select	coalesce(max(qt_dia_historico), 99999) 
into STRICT	qt_dia_historico_w 
from	agenda 
where	cd_agenda	= cd_agenda_p;
 
select	'F10 CD_AGENDA=' || cd_agenda || ', NR_SEQUENCIA=' || nr_sequencia || ', CD_PESSOA_FISICA=' || 
	cd_pessoa_fisica || ', DT_AGENDA=' || to_char(hr_inicio, 'dd/mm/yyyy hh24:mi:ss') 
into STRICT	ds_chave_w 
from	agenda_paciente 
where	cd_agenda	= cd_agenda_p 
and	qt_dia_historico_w <> 0 
and	dt_agenda	< clock_timestamp() - qt_dia_historico_w;
 
CALL gravar_log_exclusao('AGENDA_PACIENTE',nm_usuario_p,ds_chave_w,'N');
 
delete	from agenda_paciente 
where	cd_agenda	= cd_agenda_p 
and	qt_dia_historico_w <> 0 
and	dt_agenda	< clock_timestamp() - qt_dia_historico_w;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE excluir_agenda_paciente (cd_agenda_p bigint, nm_usuario_p text) FROM PUBLIC;

