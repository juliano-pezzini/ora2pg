-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE man_traduzir_cad_corp ( nm_usuario_p text, ds_texto_p text, nm_tabela_p text, nm_campo_p text, ds_contexto_p text default null, cd_expressao_p INOUT bigint  DEFAULT NULL) AS $body$
DECLARE


    cd_expressao_w		dic_expressao.cd_expressao%type;
    ds_glossario_w		dic_expressao.ds_glossario%type;
    ds_tabela_w         tabela_sistema.ds_tabela%type;
    ds_expressao_br_w   dic_expressao.ds_expressao_br%type;

    ds_erro_w				varchar(4000);

    dt_atualizacao_w        timestamp;


BEGIN
    dt_atualizacao_w := trunc(clock_timestamp(), 'MI');

    cd_expressao_w := Obter_valor_Dinamico_bv('select	dic_expressao_seq.nextval@whebl02_orcl from	dual ', null, cd_expressao_w);

    select max(DS_TABELA)
    into STRICT ds_tabela_w
    from tabela_sistema 
    where nm_tabela = nm_tabela_p;

    select max(ds_expressao_br)
    into STRICT ds_expressao_br_w
    from dic_expressao
    where cd_expressao = (SELECT CD_EXP_DESC 
                            from tabela_atributo 
                            where nm_tabela  = nm_tabela_p
                            and nm_atributo = nm_campo_p);

    ds_glossario_w	:= 'Generated by CORP: ' || ds_tabela_w || ' - ' || ds_expressao_br_w  || ' - ' || nm_usuario_p;

    if (ds_contexto_p IS NOT NULL AND ds_contexto_p::text <> '') then
        ds_glossario_w	:= ds_glossario_w || ' - ' || ds_contexto_p;
    end if;

    CALL Exec_Sql_Dinamico_bv('MAN_TRADUZIR_CAD_CORP -  CD_EXPRESSAO_W: ' || cd_expressao_w,
					'insert into dic_expressao@whebl02_orcl '||
					'		(nm_usuario, '||
					'		nm_usuario_nrec, ' ||
					'		dt_atualizacao, ' ||
					'		dt_atualizacao_nrec, ' ||
					'		cd_expressao, ' ||
					'		ds_glossario, ' ||
					'		ds_expressao_br) ' ||
					'	values	(:nm_usuario_p, ' ||
					'		:nm_usuario_p, ' ||
					'		:dt_atualizacao_p, ' ||
					'		:dt_atualizacao_p, ' ||
					'		:cd_expressao_p, ' ||
					'		:ds_glossario_p, ' ||
					'		:ds_texto_p) ',
					'nm_usuario_p=dbcorp;' ||
					'nm_usuario_p=dbcorp;' ||
					'cd_expressao_p=' || cd_expressao_w || ';' ||
					'dt_atualizacao_p=' || to_char(dt_atualizacao_w, 'DD/MM/YYYY HH24:MI') || ';' ||
					'ds_glossario_p=' || ds_glossario_w || ';' ||
					'ds_texto_p=' || ds_texto_p);

    insert into  dic_expressao(nm_usuario,
		nm_usuario_nrec,
		dt_atualizacao,
		dt_atualizacao_nrec,
		cd_expressao,
		ds_glossario,
		ds_expressao_br)
	values ('dbcorp',
		'dbcorp',
		dt_atualizacao_w,
		dt_atualizacao_w,
		cd_expressao_w,
		ds_glossario_w,
		ds_texto_p);

    insert into w_tra_sync_corp(cd_expressao, ie_locale) values (cd_expressao_w, 'pt_BR');
    insert into w_tra_sync_corp(cd_expressao, ie_locale) values (cd_expressao_w, 'es_MX');
    insert into w_tra_sync_corp(cd_expressao, ie_locale) values (cd_expressao_w, 'en_US');

commit;

cd_expressao_p := cd_expressao_w;

exception
when others then
begin
	ds_erro_w := SUBSTR(SQLERRM,1,4000);
	insert into LOG_CORP_TABELAS_TRADUCAO(nm_tabela, ds_log, dt_execucao) values (nm_tabela_p, ds_erro_w, null);
    commit;

end;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE man_traduzir_cad_corp ( nm_usuario_p text, ds_texto_p text, nm_tabela_p text, nm_campo_p text, ds_contexto_p text default null, cd_expressao_p INOUT bigint  DEFAULT NULL) FROM PUBLIC;

