-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE duplicar_anamnese_onc (nr_sequencia_p bigint, nm_usuario_p text) AS $body$
DECLARE


ds_queixa_principal_w		varchar(2000);
ds_hist_doenca_atual_w		varchar(4000);
ds_hist_patolog_pregr_w		varchar(4000);
ds_hist_famil_pai_w		varchar(500);
ds_hist_famil_mae_w		varchar(500);
ds_hist_famil_filho_w		varchar(500);
ds_hist_famil_irmao_w		varchar(500);
ds_obs_hist_famil_w		varchar(4000);
ds_gastro_intestinal_w		varchar(500);
ds_genito_urinario_w		varchar(500);
ds_cardio_respiratorio_w	varchar(500);
ds_neuro_muscular_w		varchar(500);
ds_hip_diag_w			varchar(500);
ds_estadiometria_w		varchar(500);
ds_conduta_w			varchar(500);
ds_exame_complementar_w		varchar(2000);
ds_obs_isda_w			varchar(500);
nr_sequencia_w			bigint;
nr_atendimento_w		bigint;
cd_pessoa_fisica_w		varchar(10);
ie_apenas_1_registros_w		varchar(1);
qt_registro_w			integer;


BEGIN
ie_apenas_1_registros_w := Obter_Param_Usuario(281, 231, obter_perfil_ativo, nm_usuario_p, wheb_usuario_pck.get_cd_estabelecimento, ie_apenas_1_registros_w);

select	count(*)
into STRICT	qt_registro_w
from	anamnese_oncologia
where	nr_atendimento = (	SELECT	max(x.nr_atendimento)
				from	anamnese_oncologia x
				where	x.nr_sequencia = nr_sequencia_p)
and	coalesce(dt_inativacao::text, '') = '';

if (ie_apenas_1_registros_w = 'S') and (qt_registro_w > 0) then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(197824);
end if;

select	ds_queixa_principal,
	ds_hist_doenca_atual,
	ds_hist_patolog_pregr,
	ds_hist_famil_pai,
	ds_hist_famil_mae,
	ds_hist_famil_filho,
	ds_hist_famil_irmao,
	ds_obs_hist_famil,
	ds_gastro_intestinal,
	ds_genito_urinario,
	ds_cardio_respiratorio,
	ds_neuro_muscular,
	ds_hip_diag,
	ds_estadiometria,
	ds_conduta,
	ds_exame_complementar,
	ds_obs_isda,
	nr_atendimento,
	cd_pessoa_fisica
into STRICT	ds_queixa_principal_w,
	ds_hist_doenca_atual_w,
	ds_hist_patolog_pregr_w,
	ds_hist_famil_pai_w,
	ds_hist_famil_mae_w,
	ds_hist_famil_filho_w,
	ds_hist_famil_irmao_w,
	ds_obs_hist_famil_w,
	ds_gastro_intestinal_w,
	ds_genito_urinario_w,
	ds_cardio_respiratorio_w,
	ds_neuro_muscular_w,
	ds_hip_diag_w,
	ds_estadiometria_w,
	ds_conduta_w,
	ds_exame_complementar_w,
	ds_obs_isda_w,
	nr_atendimento_w,
	cd_pessoa_fisica_w
from	anamnese_oncologia
where	nr_sequencia = nr_sequencia_p;

select	nextval('anamnese_oncologia_seq')
into STRICT	nr_sequencia_w
;

insert into anamnese_oncologia(
	nr_sequencia,
	nm_usuario,
	ie_situacao,
	dt_atualizacao,
	dt_atualizacao_nrec,
	nr_atendimento,
	cd_pessoa_fisica,
	ds_queixa_principal,
	ds_hist_doenca_atual,
	ds_hist_patolog_pregr,
	ds_hist_famil_pai,
	ds_hist_famil_mae,
	ds_hist_famil_filho,
	ds_hist_famil_irmao,
	ds_obs_hist_famil,
	ds_gastro_intestinal,
	ds_genito_urinario,
	ds_cardio_respiratorio,
	ds_neuro_muscular,
	ds_hip_diag,
	ds_estadiometria,
	ds_conduta,
	ds_exame_complementar,
	ds_obs_isda)
values (	nr_sequencia_w,
	nm_usuario_p,
	'A',
	clock_timestamp(),
	clock_timestamp(),
	nr_atendimento_w,
	cd_pessoa_fisica_w,
	ds_queixa_principal_w,
	ds_hist_doenca_atual_w,
	ds_hist_patolog_pregr_w,
	ds_hist_famil_pai_w,
	ds_hist_famil_mae_w,
	ds_hist_famil_filho_w,
	ds_hist_famil_irmao_w,
	ds_obs_hist_famil_w,
	ds_gastro_intestinal_w,
	ds_genito_urinario_w,
	ds_cardio_respiratorio_w,
	ds_neuro_muscular_w,
	ds_hip_diag_w,
	ds_estadiometria_w,
	ds_conduta_w,
	ds_exame_complementar_w,
	ds_obs_isda_w);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE duplicar_anamnese_onc (nr_sequencia_p bigint, nm_usuario_p text) FROM PUBLIC;

