-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE enviar_comunic_mudanca_nivel (cd_consultor_p bigint, dt_mud_nivel_P timestamp, nr_seq_nivel_p bigint, nm_usuario_p text) AS $body$
DECLARE

						 
ds_mensagem_w		varchar(2000);
nm_usuarios_w		varchar(2000);	
 

BEGIN			 
 
									 
ds_mensagem_w := 'O(a) consultor(a) ' || substr(obter_nome_pf_pj(cd_consultor_p, ''),1,200) || 
		' mudou para o nível ' || substr(obter_descricao_padrao('PROJ_NIVEL_CONSULTOR','DS_NIVEL',nr_seq_nivel_p),1,255) || 
		' a partir de ' || dt_mud_nivel_p ||'.';
		 
nm_usuarios_w := SUBSTR(obter_select_concatenado_bv('select nm_usuario_regra from proj_envio_ci_nivel', '', ', '),1,1000);		
 
	 
 
	 
		insert into 	comunic_interna(  
				dt_comunicado, 
				ds_titulo, 
				ds_comunicado, 
				nm_usuario, 
				dt_atualizacao, 
				ie_geral, 
				nm_usuario_destino, 
				nr_sequencia, 
				ie_gerencial, 
				nr_seq_classif, 
				cd_setor_destino, 
				cd_estab_destino, 
				ds_setor_adicional, 
				dt_liberacao) 
			values (clock_timestamp(), 
				'Aviso de Mudança de Nível de Consultor', 
				ds_mensagem_w, 
				nm_usuario_p, 
				clock_timestamp(), 
				'N', 
				nm_usuarios_w, 
				nextval('comunic_interna_seq'), 
				'N', 
				null, 
				null, 
				1, 
				null, 
				clock_timestamp());
 
		commit;
	 
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE enviar_comunic_mudanca_nivel (cd_consultor_p bigint, dt_mud_nivel_P timestamp, nr_seq_nivel_p bigint, nm_usuario_p text) FROM PUBLIC;

