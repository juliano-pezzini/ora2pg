-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE carregar_brasindice_apr ( cd_apresentacao_p text, ds_apresentacao_p text, qt_minima_unitaria_p bigint, nm_usuario_p text) AS $body$
DECLARE


ds_apresentacao_w	varchar(155);
qt_minima_unitaria_w	smallint;


BEGIN
if (cd_apresentacao_p IS NOT NULL AND cd_apresentacao_p::text <> '') and (ds_apresentacao_p IS NOT NULL AND ds_apresentacao_p::text <> '') and (qt_minima_unitaria_p IS NOT NULL AND qt_minima_unitaria_p::text <> '') and (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') then
	begin

	select	max(ds_apresentacao),
		max(qt_minima_unitaria)
	into STRICT	ds_apresentacao_w,
		qt_minima_unitaria_w
	from	brasindice_apresentacao
	where	cd_apresentacao = cd_apresentacao_p;

	if (coalesce(ds_apresentacao_w::text, '') = '') then
		insert
		into	brasindice_apresentacao(cd_apresentacao, ds_apresentacao, ie_situacao, qt_minima_unitaria, dt_atualizacao, nm_usuario)
		values (cd_apresentacao_p, ds_apresentacao_p, 'A', qt_minima_unitaria_p, clock_timestamp(), nm_usuario_p);
	elsif (ds_apresentacao_w <> ds_apresentacao_p) or (qt_minima_unitaria_w <> qt_minima_unitaria_p) then
		update	brasindice_apresentacao
		set	ds_apresentacao	= ds_apresentacao_p,
			qt_minima_unitaria	= qt_minima_unitaria_p
		where	cd_apresentacao	=  cd_apresentacao_p;
	end if;

	end;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE carregar_brasindice_apr ( cd_apresentacao_p text, ds_apresentacao_p text, qt_minima_unitaria_p bigint, nm_usuario_p text) FROM PUBLIC;

