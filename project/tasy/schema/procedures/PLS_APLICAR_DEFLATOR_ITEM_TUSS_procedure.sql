-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_aplicar_deflator_item_tuss ( cd_edicao_amb_p edicao_amb.cd_edicao_amb%type, vl_reajuste_p bigint, dt_vigencia_p timestamp, dt_inicio_vigencia_p timestamp, cd_procedimento_p preco_tuss.cd_procedimento%type, ie_origem_proced_p preco_tuss.ie_origem_proced%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
BEGIN

insert into preco_tuss(
	cd_moeda, cd_porte_cbhpm, cd_procedimento,
	dt_inicio_vigencia, ie_origem_proced, ie_situacao,
	nr_auxiliares_amb, nr_auxiliares_cbhpm, nr_porte_anest_amb,
	nr_porte_anest_cbhpm, qt_filme_amb, qt_filme_cbhpm,
	qt_incidencia_amb, qt_incidencia_cbhpm, qt_uco,
	tx_porte, vl_anestesista, vl_auxiliares,
	vl_custo_operacional, vl_filme, vl_medico,
	vl_procedimento, cd_edicao_amb, dt_atualizacao,
	dt_atualizacao_nrec, nm_usuario, nm_usuario_nrec,
	nr_sequencia
	) (
	SELECT	cd_moeda,
		cd_porte_cbhpm,
		cd_procedimento,
		dt_vigencia_p,
		ie_origem_proced,
		ie_situacao,
		nr_auxiliares_amb,
		nr_auxiliares_cbhpm,
		nr_porte_anest_amb,
		nr_porte_anest_cbhpm,
		qt_filme_amb,
		qt_filme_cbhpm,
		qt_incidencia_amb,
		qt_incidencia_cbhpm,
		qt_uco,
		tx_porte,
		vl_anestesista - ((vl_anestesista * vl_reajuste_p) / 100) vl_anestesista,
		vl_auxiliares - ((vl_auxiliares * vl_reajuste_p) / 100) vl_auxiliares,
		vl_custo_operacional - ((vl_custo_operacional * vl_reajuste_p) / 100) vl_custo_operacional,
		vl_filme - ((vl_filme * vl_reajuste_p) / 100) vl_filme,
		vl_medico - ((vl_medico * vl_reajuste_p) / 100) vl_medico,
		vl_procedimento - ((vl_procedimento * vl_reajuste_p) / 100) vl_procedimento,
		cd_edicao_amb,
		clock_timestamp(),
		clock_timestamp(),
		nm_usuario_p,
		nm_usuario_p,
		nextval('preco_tuss_seq')
	from	preco_tuss
	where	cd_edicao_amb = cd_edicao_amb_p
	and	cd_procedimento = cd_procedimento_p
	and 	ie_origem_proced = ie_origem_proced_p
	and	trunc(dt_inicio_vigencia) = trunc(dt_inicio_vigencia_p)
	);

commit;

update	preco_tuss
set	dt_final_vigencia = dt_vigencia_p -1
where	cd_edicao_amb = cd_edicao_amb_p
and	cd_procedimento = cd_procedimento_p
and 	ie_origem_proced = ie_origem_proced_p
and	trunc(dt_inicio_vigencia) = trunc(dt_inicio_vigencia_p);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_aplicar_deflator_item_tuss ( cd_edicao_amb_p edicao_amb.cd_edicao_amb%type, vl_reajuste_p bigint, dt_vigencia_p timestamp, dt_inicio_vigencia_p timestamp, cd_procedimento_p preco_tuss.cd_procedimento%type, ie_origem_proced_p preco_tuss.ie_origem_proced%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;

