-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gerar_hist_fin_pagador ( nr_seq_pagador_p text, ie_origem_p text, ds_historico_p text, nm_usuario_p text, cd_estabelecimento_p bigint) AS $body$
DECLARE

					
ds_historico_w 		varchar(4000);	
nm_usuario_lib_w	varchar(15);
dt_liberacao_w		timestamp;		


BEGIN

/*OS 1951075 - Liberar historico ao enviar email. Feito dessa forma para n criar novos parametros In nessa proc do OPS.*/

ds_historico_w := substr(ds_historico_p,1,4000);
if (position('#@LIB#@' in ds_historico_w) > 0) then

	nm_usuario_lib_w := substr(nm_usuario_p,1,15);
	dt_liberacao_w 	 := clock_timestamp();
	ds_historico_w   := replace(ds_historico_w,'#@LIB#@','');
	
end if;

insert into	pls_pagador_historico(nr_sequencia,
	nm_usuario,
	dt_atualizacao,
	nm_usuario_nrec,
	dt_atualizacao_nrec,
	cd_estabelecimento,
	nr_seq_pagador,
	ie_origem,
	ds_historico,
	ds_titulo,
	dt_historico,
	nm_usuario_historico,
	nm_usuario_lib,
	dt_liberacao)
values (nextval('pls_pagador_historico_seq'),
	nm_usuario_p,
	clock_timestamp(),
	nm_usuario_p,
	clock_timestamp(),
	cd_estabelecimento_p,
	nr_seq_pagador_p,
	ie_origem_p,
	ds_historico_w,
	'Hist√≥rico gerado pela Ficha Financeira',
	clock_timestamp(),
	nm_usuario_p,
	nm_usuario_lib_w,
	dt_liberacao_w);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_hist_fin_pagador ( nr_seq_pagador_p text, ie_origem_p text, ds_historico_p text, nm_usuario_p text, cd_estabelecimento_p bigint) FROM PUBLIC;

