-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE diops_zerar_valores_ev_ind ( nm_usuario_p text, nr_seq_periodo_p bigint, nm_campo_p text, ie_opcao_p text, nm_tabela_p text) AS $body$
DECLARE


nr_mes_w		bigint;
nm_atributo_w		varchar(255);
ds_colunas_w		varchar(5000);
ds_comando_w		varchar(5000);

c_colunas CURSOR FOR
	SELECT	nm_atributo
	from (SELECT	nm_atributo,
			somente_numero(nm_atributo) nr_mes
		from	tabela_atributo
		where	nm_tabela = nm_tabela_p
		and	nm_atributo like '%VL_MES_N%') alias1
	where	((ie_opcao_p = 'S'
	and	nr_mes = somente_numero(nm_campo_p))
	or (ie_opcao_p = 'U'
	and	nr_mes >= somente_numero(nm_campo_p)));


BEGIN

open c_colunas;
loop
fetch c_colunas into
	nm_atributo_w;
EXIT WHEN NOT FOUND; /* apply on c_colunas */
	begin

	if (coalesce(ds_colunas_w,'X') = 'X') then
		ds_colunas_w	:= nm_atributo_w || ' = 0 ';
	else
		ds_colunas_w	:= ds_colunas_w || ', ' || nm_atributo_w || ' = 0 ';
	end if;

	end;
end loop;
close c_colunas;

if (coalesce(ds_colunas_w,'X') <> 'X') then

	ds_comando_w	:= '	update	'|| nm_tabela_p || '
				set	' || ds_colunas_w ||
			   '	where	nr_seq_periodo = ' || nr_seq_periodo_p;

	CALL exec_sql_dinamico('Tasy', ds_comando_w);

	commit;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE diops_zerar_valores_ev_ind ( nm_usuario_p text, nr_seq_periodo_p bigint, nm_campo_p text, ie_opcao_p text, nm_tabela_p text) FROM PUBLIC;

