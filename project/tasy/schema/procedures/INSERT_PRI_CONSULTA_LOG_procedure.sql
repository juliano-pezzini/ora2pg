-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_pri_consulta_log ( json_data_p text, nm_usuario_p text) AS $body$
DECLARE


json_list_w    	philips_json_list;
json_data_w	philips_json;
ds_json_w	text;

BEGIN

delete from w_pri_consulta_log
where  nm_usuario = nm_usuario_p;

commit;

pls_convert_long_('LGPD_JSON','DS_JSON',' WHERE NM_USUARIO =  ' || chr(39) || nm_usuario_p || chr(39), '', ds_json_w);

if (ds_json_w IS NOT NULL AND ds_json_w::text <> '') then

	json_list_w := philips_json_list(ds_json_w);

	for i in 1 .. json_list_w.count loop

	json_data_w	:= philips_json(json_list_w.get(i));

	insert into w_pri_consulta_log(	nr_sequencia,
						dt_atualizacao,
						nm_usuario,
						dt_atualizacao_nrec,
						nm_usuario_nrec,
						cd_access_rule,
						cd_access_rule_su,
						cd_department,
						cd_establishment,
						cd_event_identifier,
						cd_filter,
						cd_function,
						cd_parent_identifier,
						cd_patient,
						cd_profile,
						cd_reason,
						cd_report,
						cd_root_identifier,
						ds_access_rule,
						ds_access_rule_su,
						ds_computer,
						ds_content,
						ds_department,
						ds_filter,
						ds_establishment,
						ds_filter_parameter,
						ds_from,
						ds_function,
						ds_function_item,
						ds_identifier,
						ds_justification,
						ds_login_step_info,
						ds_login_step_type,
						ds_name,
						ds_new_value,
						ds_old_value,
						ds_patient,
						ds_profile,
						ds_reason,
						ds_report_classification,
						ds_report_parameter,
						ds_second_user,
						ds_status,
						ds_to,
						ds_user_authorized,
						ds_user_authorized_fullname,
						ds_user_fullname,
						ds_username,
						dt_event,
						ie_generated,
						ie_patient_identity_allowed,
						ie_release_access,
						ie_sensitive_data_allowed,
						ie_support_mode,
						ie_timeout,
						ie_two_factor_auth_login,
						nm_field,
						nm_second_user,
						nm_table,
						qt_copy,
						qt_record,
						ds_type,
						ds_description,
						cd_type,
						cd_login_step_type
					)
					values (
						nextval('w_pri_consulta_log_seq'),
						clock_timestamp(),
						nm_usuario_p,
						clock_timestamp(),
						nm_usuario_p,
						substr(json_data_w.get['CD_ACCESS_RULE'].get_number(),1,255),
						substr(json_data_w.get['CD_ACCESS_RULE_SU'].get_number(),1,255),
						substr(json_data_w.get['CD_DEPARTMENT'].get_number(),1,255),
						substr(json_data_w.get['CD_ESTABLISHMENT'].get_number(),1,255),
						substr(json_data_w.get['CD_EVENT_IDENTIFIER'].get_string(),1,255),
						substr(json_data_w.get['CD_FILTER'].get_number(),1,255),
						substr(json_data_w.get['CD_FUNCTION'].get_number(),1,255),
						substr(json_data_w.get['CD_PARENT_IDENTIFIER'].get_string(),1,255),
						substr(json_data_w.get['CD_PATIENT'].get_string(),1,255),
						substr(json_data_w.get['CD_PROFILE'].get_number(),1,255),
						substr(json_data_w.get['CD_REASON'].get_number(),1,255),
						substr(json_data_w.get['CD_REPORT'].get_number(),1,255),
						substr(json_data_w.get['CD_ROOT_IDENTIFIER'].get_string(),1,255),
						substr(json_data_w.get['DS_ACCESS_RULE'].get_string(),1,255),
						substr(json_data_w.get['DS_ACCESS_RULE_SU'].get_string(),1,255),
						substr(json_data_w.get['DS_COMPUTER'].get_string(),1,255),
						substr(json_data_w.get['DS_CONTENT'].get_string(),1,255),
						substr(json_data_w.get['DS_DEPARTMENT'].get_string(),1,255),
						substr(json_data_w.get['DS_FILTER'].get_string(),1,255),
						substr(json_data_w.get['DS_ESTABLISHMENT'].get_string(),1,255),
						substr(json_data_w.get['DS_FILTER_PARAMETER'].get_string(),1,255),
						substr(json_data_w.get['DS_FROM'].get_string(),1,255),
						substr(json_data_w.get['DS_FUNCTION'].get_string(),1,255),
						substr(json_data_w.get['DS_FUNCTION_ITEM'].get_string(),1,255),
						substr(json_data_w.get['DS_IDENTIFIER'].get_string(),1,255),
						substr(json_data_w.get['DS_JUSTIFICATION'].get_string(),1,255),
						substr(json_data_w.get['DS_LOGIN_STEP_INFO'].get_string(),1,255),
						substr(json_data_w.get['DS_LOGIN_STEP_TYPE'].get_string(),1,255),
						substr(json_data_w.get['DS_NAME'].get_string(),1,255),
						substr(json_data_w.get['DS_NEW_VALUE'].get_string(),1,255),
						substr(json_data_w.get['DS_OLD_VALUE'].get_string(),1,255),
						substr(json_data_w.get['DS_PATIENT'].get_string(),1,255),
						substr(json_data_w.get['DS_PROFILE'].get_string(),1,255),
						substr(json_data_w.get['DS_REASON'].get_string(),1,255),
						substr(json_data_w.get['DS_REPORT_CLASSIFICATION'].get_string(),1,255),
						substr(json_data_w.get['DS_REPORT_PARAMETER'].get_string(),1,255),
						substr(json_data_w.get['DS_SECOND_USER'].get_string(),1,255),
						substr(json_data_w.get['DS_STATUS'].get_string(),1,255),
						substr(json_data_w.get['DS_TO'].get_string(),1,255),
						substr(json_data_w.get['DS_USER_AUTHORIZED'].get_string(),1,255),
						substr(json_data_w.get['DS_USER_AUTHORIZED_FULLNAME'].get_string(),1,255),
						substr(json_data_w.get['DS_USER_FULLNAME'].get_string(),1,255),
						substr(json_data_w.get['DS_USERNAME'].get_string(),1,255),
						to_date(replace(json_data_w.get['DT_EVENT'].get_string(), 'T', ' '), 'yyyy-mm-dd hh24:mi:ss.###'),
						substr(json_data_w.get['IE_GENERATED'].get_string(),1,255),
						substr(json_data_w.get['IE_PATIENT_IDENTITY_ALLOWED'].get_string(),1,255),
						substr(json_data_w.get['IE_RELEASE_ACCESS'].get_string(),1,255),
						substr(json_data_w.get['IE_SENSITIVE_DATA_ALLOWED'].get_string(),1,255),
						substr(json_data_w.get['IE_SUPPORT_MODE'].get_string(),1,255),
						substr(json_data_w.get['IE_TIMEOUT'].get_string(),1,255),
						substr(json_data_w.get['IE_TWO_FACTOR_AUTH_LOGIN'].get_string(),1,255),
						substr(json_data_w.get['NM_FIELD'].get_string(),1,255),
						substr(json_data_w.get['NM_SECOND_USER'].get_string(),1,255),
						substr(json_data_w.get['NM_TABLE'].get_string(),1,255),
						json_data_w.get['QT_COPY'].get_number(),
						json_data_w.get['QT_RECORD'].get_number(),
						substr(json_data_w.get['DS_TYPE'].get_string(),1,255),
						substr(json_data_w.get['DS_DESCRIPTION'].get_string(),1,255),
						substr(json_data_w.get['CD_TYPE'].get_string(),1,255),
						substr(json_data_w.get['CD_LOGIN_STEP_TYPE'].get_string(),1,255)
					);

	 commit;

     end loop;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_pri_consulta_log ( json_data_p text, nm_usuario_p text) FROM PUBLIC;

