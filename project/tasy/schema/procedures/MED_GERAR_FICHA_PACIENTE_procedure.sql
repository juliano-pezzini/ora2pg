-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE med_gerar_ficha_paciente (nr_seq_cliente_p bigint, nm_usuario_p text) AS $body$
DECLARE


CD_PESSOA_SIST_ORIG_W		varchar(10);
CD_MEDICO_W			varchar(10);


BEGIN

SELECT	CD_PESSOA_SIST_ORIG,
	CD_MEDICO
INTO STRICT	CD_PESSOA_SIST_ORIG_W,
	CD_MEDICO_W
FROM	MED_CLIENTE
WHERE	NR_SEQUENCIA		= nr_seq_cliente_p;

IF (coalesce(CD_PESSOA_SIST_ORIG_W::text, '') = '') THEN
	BEGIN
	SELECT	coalesce(MAX(coalesce((CD_PESSOA_SIST_ORIG)::numeric ,0)),0) + 1
	INTO STRICT		CD_PESSOA_SIST_ORIG_W
	FROM		MED_CLIENTE
	WHERE		CD_MEDICO		= CD_MEDICO_W;

	UPDATE	MED_CLIENTE
	SET		CD_PESSOA_SIST_ORIG	= CD_PESSOA_SIST_ORIG_W,
			nm_usuario		= nm_usuario_p
	WHERE		NR_SEQUENCIA		= nr_seq_cliente_p;

	END;
END IF;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE med_gerar_ficha_paciente (nr_seq_cliente_p bigint, nm_usuario_p text) FROM PUBLIC;

