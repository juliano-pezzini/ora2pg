-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_prs_sub_processo (nr_seq_crs bigint, ds_prs text, nm_usuario_p text) AS $body$
DECLARE


nr_seq_prs_w	latam_requisito_prs.nr_seq_prs%type;WITH RECURSIVE cte AS (


c01 CURSOR FOR
	SELECT	regexp_substr(ds_prs,'[^,]+', 1, level)
	
	(regexp_substr(ds_prs, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(ds_prs, '[^,]+', 1, level))::text <> '')  UNION ALL


c01 CURSOR FOR
	SELECT	regexp_substr(ds_prs,'[^,]+', 1, level) JOIN cte c ON ()

) SELECT * FROM cte;
;


BEGIN


open c01;
		loop
		fetch c01 into
			nr_seq_prs_w;
		EXIT WHEN NOT FOUND; /* apply on c01 */
			begin

			insert into latam_requisito_prs(NR_SEQUENCIA,
											 DT_ATUALIZACAO,
											 NM_USUARIO,
											 DT_ATUALIZACAO_NREC,
											 NM_USUARIO_NREC,
											 NR_SEQ_REQUISITO_CRS,
											 NR_SEQ_PRS)
			values (nextval('latam_requisito_prs_seq'),
					 clock_timestamp(),
					 nm_usuario_p,
					 clock_timestamp(),
					 nm_usuario_p,
					 nr_seq_crs,
					 nr_seq_prs_w);

			end;
		end loop;
close c01;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_prs_sub_processo (nr_seq_crs bigint, ds_prs text, nm_usuario_p text) FROM PUBLIC;

