-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE atualizar_observacao_cni ( nr_sequencia_cni_p bigint, nr_sequencia_cni_baixa_p bigint, ie_opcao_p bigint, nr_documento_p bigint, nm_usuario_p text) AS $body$
DECLARE

 
/*Rotina criada para atualizar a observacao no titulo quando baixado pelo CNI 
Como na baixa usa uma rotina de baixa de título genérica, e não grava a sequencia do 
CNI na TITULO_RECEBER_LIQ, nao foi tratado na rotina de baixa generica 
 
IE_OPCAO_P 
1 - Titulo Receber 
 
NR_DOCUMENTO_P 
Aqui vem o numero do título, adiantamento, cheque, bordero do CNI 
*/
	 
 
ds_observacao_w			movto_banco_pend_baixa.ds_observacao%type;	
nr_seq_baixa_w			movto_banco_pend_baixa.nr_seq_baixa%type;							
									 

BEGIN 
 
if ( coalesce(nr_sequencia_cni_p,0) <> 0) and ( coalesce(nr_sequencia_cni_baixa_p,0) <> 0 ) then 
 
	select	substr(max(a.ds_observacao),1,254), 
		max(nr_seq_baixa) 
	into STRICT	ds_observacao_w, 
		nr_seq_baixa_w 
	from	movto_banco_pend_baixa a 
	where	a.nr_seq_movto_pend	= nr_sequencia_cni_p 
	and	a.nr_sequencia		= nr_sequencia_cni_baixa_p;
 
	/*Titulo a Receber*/
 
 
	if (ie_opcao_p = 1) and (nr_documento_p IS NOT NULL AND nr_documento_p::text <> '') and (nr_seq_baixa_w IS NOT NULL AND nr_seq_baixa_w::text <> '') then 
	 
		update	titulo_receber_liq a 
		set	a.ds_observacao 	= ds_observacao_w 
		where	a.nr_titulo		= nr_documento_p 
		and	a.nr_sequencia	= nr_seq_baixa_w;	
	 
	end if;
 
end if;
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualizar_observacao_cni ( nr_sequencia_cni_p bigint, nr_sequencia_cni_baixa_p bigint, ie_opcao_p bigint, nr_documento_p bigint, nm_usuario_p text) FROM PUBLIC;

