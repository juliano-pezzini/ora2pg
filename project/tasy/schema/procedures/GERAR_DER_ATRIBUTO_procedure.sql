-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_der_atributo ( nr_seq_der_objeto_p bigint, nm_tabela_p text, nm_atributo_p text, ie_tipo_atributo_p text, qt_tamanho_p text, ie_obrigatorio_p text, nm_usuario_p text, ie_tipo_p text, vl_default_p text, ie_sequence_p text, ds_atributo_p text) AS $body$
DECLARE

qt_atributo_w		bigint;
qt_tamanho_w		bigint := null;
qt_decimais_w		bigint := null;
qt_aux_w		varchar(10);
ie_tipo_atributo_w	varchar(10);


BEGIN
Select	count(*)
into STRICT	qt_atributo_w
from	tabela_atributo
where	upper(nm_tabela) = upper(nm_tabela_p)
and	upper(nm_atributo) = upper(nm_atributo_p);

qt_aux_w	:= replace(replace(qt_tamanho_p,'(',''),')','');

if (position(',' in qt_aux_w) > 0) then
	qt_tamanho_w	:= substr(qt_aux_w,1,position(',' in qt_aux_w)-1);
	qt_decimais_w	:= substr(qt_aux_w,position(',' in qt_aux_w)+1,Length(qt_aux_w));
else
	qt_tamanho_w	:= qt_aux_w;
end if;

if (upper(ie_tipo_atributo_p) = 'VARCHAR') then
	ie_tipo_atributo_w	:= 'VARCHAR2';
elsif (upper(ie_tipo_atributo_p) = 'INTEGER') then
	ie_tipo_atributo_w	:= 'NUMBER';
elsif (upper(ie_tipo_atributo_p) = 'NUMERIC') then
	ie_tipo_atributo_w	:= 'NUMBER';
else
	ie_tipo_atributo_w	:= ie_tipo_atributo_p;
end if;

if (qt_atributo_w = 0) then
	insert into des_der_ent_atrib(	nr_sequencia,
					nm_atributo,
					ie_tipo_atributo,
					dt_atualizacao,
					nm_usuario,
					qt_tamanho,
					qt_decimais,
					ie_obrigatorio,
					nr_seq_der_objeto,
					ie_tipo,
					vl_default,
					ie_sequence,
					ds_atributo)
				values (	nextval('des_der_ent_atrib_seq'),
					nm_atributo_p,
					ie_tipo_atributo_w,
					clock_timestamp(),
					nm_usuario_p,
					qt_tamanho_w,
					qt_decimais_w,
					CASE WHEN ie_obrigatorio_p='1' THEN 'S'  ELSE 'N' END ,
					nr_seq_der_objeto_p,
					CASE WHEN ie_tipo_p='1' THEN 'PK'  ELSE '' END ,
					vl_default_p,
					CASE WHEN ie_sequence_p='1' THEN 'S'  ELSE 'N' END ,
					ds_atributo_p);

	commit;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_der_atributo ( nr_seq_der_objeto_p bigint, nm_tabela_p text, nm_atributo_p text, ie_tipo_atributo_p text, qt_tamanho_p text, ie_obrigatorio_p text, nm_usuario_p text, ie_tipo_p text, vl_default_p text, ie_sequence_p text, ds_atributo_p text) FROM PUBLIC;

