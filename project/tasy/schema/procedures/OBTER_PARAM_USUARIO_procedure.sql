-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_param_usuario ( cd_funcao_p bigint, nr_sequencia_p bigint, cd_perfil_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint, vl_parametro_p INOUT text) AS $body$
DECLARE


cd_estabelecimento_w	integer;


BEGIN

vl_parametro_p := param_pck.OBTER_PARAMETRO_USUARIO(	cd_funcao_p, nr_sequencia_p, cd_perfil_p, nm_usuario_p, cd_estabelecimento_p, vl_parametro_p);

cd_estabelecimento_w	:= coalesce(cd_estabelecimento_p, 1);

exception
when others then
	begin
	select	vl_parametro
	into STRICT	vl_parametro_p
	from 	funcao_param_Usuario
	where 	cd_funcao    = cd_funcao_p
	  and 	nr_sequencia = nr_sequencia_p
	  and 	nm_usuario_param = nm_usuario_p
	  and 	coalesce(cd_estabelecimento,cd_estabelecimento_w) = cd_estabelecimento_w;
	exception
	when others then
		begin
			select 	vl_parametro
			into STRICT	vl_parametro_p
			from (	SELECT	vl_parametro
						from funcao_param_perfil
						where cd_funcao    = cd_funcao_p
						  and nr_sequencia = nr_sequencia_p
						  and cd_perfil    = cd_perfil_p
						  and coalesce(cd_estabelecimento,cd_estabelecimento_w) = cd_estabelecimento_w
						order by coalesce(cd_estabelecimento,0) desc) alias2 LIMIT 1;
		exception
			when others then
				begin
					select	vl_parametro
					into STRICT	vl_parametro_p
					from 	funcao_param_estab
					where 	cd_funcao    = cd_funcao_p
					  and 	nr_seq_param = nr_sequencia_p
					  and 	cd_estabelecimento    = cd_estabelecimento_p;
				exception
					when others then
						begin
							select coalesce(vl_parametro, vl_parametro_padrao)
							into STRICT vl_parametro_p
							from funcao_parametro
							where cd_funcao    = cd_funcao_p
							  and nr_sequencia = nr_sequencia_p;
						exception
							when others then
							   vl_parametro_p := 'S';
						end;
				end;
		end;
	end;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_param_usuario ( cd_funcao_p bigint, nr_sequencia_p bigint, cd_perfil_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint, vl_parametro_p INOUT text) FROM PUBLIC;

