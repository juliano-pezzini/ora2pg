-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copiar_anamnese_atendimento ( nr_atendimento_p bigint, nr_atendimento_novo_p bigint) AS $body$
DECLARE




C01 CURSOR FOR
	SELECT 	a.*
	from 	anamnese_paciente a
	where 	a.nr_atendimento = nr_atendimento_p;

Vet01 C01%RowType;
teste_w	bigint;

BEGIN
	open C01;
	loop
	fetch C01 into
		Vet01;
	EXIT WHEN NOT FOUND; /* apply on C01 */
	begin


	INSERT INTO ANAMNESE_PACIENTE(
	NR_SEQUENCIA, DT_ANANMESE, NR_ATENDIMENTO,
	DT_ATUALIZACAO, NM_USUARIO, CD_MEDICO,
	DT_ATUALIZACAO_NREC, NM_USUARIO_NREC,
	DS_ANAMNESE, DT_LIBERACAO, IE_SITUACAO,
	DT_INATIVACAO, NM_USUARIO_INATIVACAO, DS_JUSTIFICATIVA,
	CD_PERFIL_ATIVO, QT_CARACTERES, CD_PESSOA_FISICA,
	NR_SEQ_ASSINATURA, nr_atend_alta )
	 VALUES (
	nextval('anamnese_paciente_seq'), clock_timestamp(), nr_atendimento_novo_p,
	clock_timestamp(), Vet01.NM_USUARIO, Vet01.CD_MEDICO,  clock_timestamp(), Vet01.NM_USUARIO_NREC,
	Vet01.DS_ANAMNESE, clock_timestamp(), Vet01.IE_SITUACAO,
	Vet01.DT_INATIVACAO, Vet01.NM_USUARIO_INATIVACAO, Vet01.DS_JUSTIFICATIVA,
	Vet01.CD_PERFIL_ATIVO, Vet01.QT_CARACTERES, Vet01.CD_PESSOA_FISICA,
	Vet01.NR_SEQ_ASSINATURA, nr_atendimento_p );



	end;
	end loop;
	close c01;
if (coalesce(wheb_usuario_pck.get_ie_commit, 'S') = 'S') then commit; end if;


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copiar_anamnese_atendimento ( nr_atendimento_p bigint, nr_atendimento_novo_p bigint) FROM PUBLIC;

