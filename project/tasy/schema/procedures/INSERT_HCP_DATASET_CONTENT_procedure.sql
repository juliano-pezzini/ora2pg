-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_hcp_dataset_content ( nm_usuario_p text, nr_seq_dataset_p bigint, ds_content_p text, returned_value_p INOUT bigint, other_exception_p INOUT text) AS $body$
DECLARE

  nr_ordem_w       integer;
  nr_seq_arquivo_w bigint;

BEGIN
    SELECT coalesce(Max(nr_seq_file), 0) 
    INTO STRICT   nr_seq_arquivo_w 
    FROM   hcp_dataset_send 
    WHERE  nr_sequencia = nr_seq_dataset_p;

    INSERT INTO hcp_dataset_content(nr_sequencia, 
                 dt_atualizacao, 
                 nm_usuario, 
                 dt_atualizacao_nrec, 
                 nm_usuario_nrec, 
                 ds_dataset_contents, 
                 nr_seq_dataset_send) 
    VALUES (nextval('hcp_dataset_content_seq'), 
                 clock_timestamp(), 
                 nm_usuario_p, 
                 clock_timestamp(), 
                 nm_usuario_p, 
                 ds_content_p, 
                 nr_seq_dataset_p);

    returned_value_p := 1;

    other_exception_p := NULL;
EXCEPTION 
  WHEN data_exception OR unique_violation OR invalid_cursor_state THEN 
             other_exception_p := Substr(SQLERRM, 1, 100);

             returned_value_p := 0;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_hcp_dataset_content ( nm_usuario_p text, nr_seq_dataset_p bigint, ds_content_p text, returned_value_p INOUT bigint, other_exception_p INOUT text) FROM PUBLIC;

