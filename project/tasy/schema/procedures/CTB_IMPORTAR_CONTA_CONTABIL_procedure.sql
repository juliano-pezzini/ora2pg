-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE ctb_importar_conta_contabil ( cd_empresa_p text, nm_usuario_p text) AS $body$
DECLARE


cd_conta_contabil_w		varchar(20);
ds_conta_contabil_w		varchar(255);
qt_registros_w			bigint	:= 0;
ds_retorno_w			varchar(4000);

c01 CURSOR FOR
SELECT	a.*
from	w_imp_conta_contabil a
order by a.nr_sequencia;

vet01	C01%RowType;

BEGIN

/*A consistencia de obrigatoriedade dos campos e demais informacoes, ja e realizada
na rotina ctb_consistir_plano_importacao*/
open C01;
loop
fetch C01 into
	vet01;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin

	cd_conta_contabil_w	:= vet01.cd_conta_contabil;
	ds_conta_contabil_w	:= vet01.ds_conta_contabil;

	if (coalesce(cd_conta_contabil_w, 'X') <> 'X') then

		select	count(*)
		into STRICT	qt_registros_w
		from	conta_contabil
		where	cd_conta_contabil	= cd_conta_contabil_w;

		if (qt_registros_w > 0) then

			select	coalesce(max(somente_numero(cd_conta_contabil)), 0) + 1
			into STRICT	cd_conta_contabil_w
			from	conta_contabil;
		end if;
	else
		select	coalesce(max(somente_numero(cd_conta_contabil)), 0) + 1
		into STRICT	cd_conta_contabil_w
		from	conta_contabil;

	end if;

	insert into conta_contabil(
		cd_conta_contabil,
		ds_conta_contabil,
		ie_situacao,
		dt_atualizacao,
		nm_usuario,
		ie_centro_custo,
		ie_tipo,
		cd_classificacao,
		cd_grupo,
		cd_empresa,
                cd_plano_ans,
		cd_centro_custo,
		cd_sistema_contabil,
		ie_compensacao,
		ie_versao_ans,
		dt_inicio_vigencia,
		dt_fim_vigencia,
		cd_classif_ecd,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		ie_ecd_reg_dre,
		ie_ecd_reg_bp,
		cd_classif_superior,
		ie_natureza_sped,
		cd_classificacao_atual,
		cd_classif_superior_atual)
	values (	cd_conta_contabil_w,
		ds_conta_contabil_w,
		'A',
		clock_timestamp(),
		nm_usuario_p,
		coalesce(vet01.ie_centro_custo,'N'),
		vet01.ie_tipo,
		vet01.cd_classificacao,
		vet01.cd_grupo,
		cd_empresa_p,
                vet01.cd_plano,
		null,
		vet01.cd_sistema_contabil,
		'N',
		null,
		vet01.dt_inicio_vig,
		vet01.dt_fim_vig,
		null,
		clock_timestamp(),
		nm_usuario_p,
		vet01.ie_ecd_reg_dre,
		vet01.ie_ecd_reg_bp,
		vet01.cd_classif_sup,
		vet01.ie_natureza_sped,
		vet01.cd_classificacao,
		vet01.cd_classif_sup);

	end;
end loop;
close C01;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ctb_importar_conta_contabil ( cd_empresa_p text, nm_usuario_p text) FROM PUBLIC;

