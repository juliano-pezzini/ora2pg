-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE intpd_gravar_integracao_sinc ( ie_evento_p text, nr_seq_documento_p text, nm_usuario_p text, reg_integracao_p text, ds_parametros_adic_p text, nr_seq_fila_p INOUT bigint, ds_log_p INOUT text) AS $body$
DECLARE


reg_integracao_w	gerar_int_padrao.reg_integracao;
count_w	bigint := 0;


BEGIN

select count(b.nr_sequencia)
into STRICT count_w
from intpd_eventos a,
 intpd_eventos_sistema b
where a.nr_sequencia = b.nr_seq_evento
and a.ie_evento = ie_evento_p
and a.ie_situacao = 'A'
and b.ie_situacao = 'A'  LIMIT 1;

if (coalesce(count_w,0) = 1) then
	begin

	reg_integracao_w.ie_status := 'R';
	reg_integracao_w.cd_estab_documento := obter_texto_entre_macro(reg_integracao_p, 'CD_ESTABELECIMENTO_P=', ';');
	reg_integracao_w.cd_convenio := obter_texto_entre_macro(reg_integracao_p, 'CD_CONVENIO_P=', ';');

	reg_integracao_w := gerar_int_padrao.gravar_integracao(ie_evento_p, nr_seq_documento_p, nm_usuario_p, reg_integracao_w, ds_parametros_adic_p);

	nr_seq_fila_p := reg_integracao_w.nr_seq_fila;
	end;
end if;

if (coalesce(nr_seq_fila_p,0) = 0) then
	ds_log_p := wheb_mensagem_pck.get_texto(1046230, 'CD_EVENTO_W=' || ie_evento_p);
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE intpd_gravar_integracao_sinc ( ie_evento_p text, nr_seq_documento_p text, nm_usuario_p text, reg_integracao_p text, ds_parametros_adic_p text, nr_seq_fila_p INOUT bigint, ds_log_p INOUT text) FROM PUBLIC;

