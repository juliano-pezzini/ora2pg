-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE intpd_ret_enviar_checklist_pac ( nr_sequencia_p bigint, ds_xml_p text) AS $body$
DECLARE

xml_base_w              xml;

c01 CURSOR FOR
    SELECT a.code, a.message
    from   xmltable(
			xmlnamespaces(
			:= 'http://www.christusmuguerza.com.mx/EnterpriseObjects/MedicalFees',
			'http://www.christusmuguerza.com.mx/EnterpriseObjects/GCM/Common' as "com",
			'http://www.w3.org/2003/05/soap-envelope' as "soap"),
			'/soap:Envelope/soap:Body/SyncCheckListResponseEBM/Response' passing xml_base_w columns
			code varchar(255) path 'com:Code/com:Code',
			message varchar(255) path 'com:Message/com:Message') a;
  c01_w                   c01%rowtype;


BEGIN

xml_base_w := xmlparse(DOCUMENT, convert_from(, 'utf-8'));

open c01;
loop
fetch c01 into c01_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
end loop;
close c01;

if (c01_w.code = '0000') then --qualquer coisa diferente de 0000 ser√° considerado erro
	update	intpd_fila_transmissao
	set	ds_xml_retorno = ds_xml_p,
		ie_status = 'S',
		ie_response_procedure	= 'S'
	where  	nr_sequencia = nr_sequencia_p;
else
	update	intpd_fila_transmissao
	set	ds_xml_retorno = ds_xml_p,
		ie_status = 'E',
		ds_log = c01_w.message,
		ie_response_procedure	= 'S'
	where	nr_sequencia = nr_sequencia_p;
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE intpd_ret_enviar_checklist_pac ( nr_sequencia_p bigint, ds_xml_p text) FROM PUBLIC;

