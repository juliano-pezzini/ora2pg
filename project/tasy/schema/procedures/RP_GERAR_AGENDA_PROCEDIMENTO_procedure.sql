-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE rp_gerar_agenda_procedimento ( nr_seq_agend_consulta_p bigint, nr_seq_rp_pac_agend_p bigint, ie_agend_ind_p text default 'N') AS $body$
DECLARE


nr_seq_agenda_consulta_w	AGENDA_CONSULTA_PROC.nr_sequencia%type;
										
get_agend_proc CURSOR FOR
	SELECT CD_PROCEDIMENTO, NR_SEQ_PROC_INTERNO, IE_ORIGEM_PROCED
	from RP_PAC_AGEND_PROCEDIMENTOS
	where 1=1
	and (nr_seq_pac_agend_individual = nr_seq_rp_pac_agend_p and coalesce(nr_seq_pac_mod_agend_item::text, '') = '' and ie_agend_ind_p = 'S')
	or (nr_seq_pac_mod_agend_item = nr_seq_rp_pac_agend_p and coalesce(nr_seq_pac_agend_individual::text, '') = '' and ie_agend_ind_p = 'N');


BEGIN
	for agend_proc_w in get_agend_proc loop
		select nextval('agenda_consulta_proc_seq')
		into STRICT nr_seq_agenda_consulta_w
		;
		
		insert into AGENDA_CONSULTA_PROC(
			NR_SEQUENCIA,
			NR_SEQ_AGENDA,
			CD_PROCEDIMENTO, 
			IE_ORIGEM_PROCED, 
			DT_ATUALIZACAO, 
			NM_USUARIO, 
			DT_ATUALIZACAO_NREC, 
			NM_USUARIO_NREC, 
			NR_SEQ_PROC_INTERNO, 
			IE_EXECUTAR_PROC, 
			NR_SEQ_EXAME, 
			QT_PROCEDIMENTO, 
			CD_MATERIAL_EXAME, 
			IE_REGRA, 
			IE_GLOSA, 
			NR_SEQ_REGRA, 
			DS_OBSERVACAO, 
			IE_LADO, 
			DT_AGENDA_EXTERNA, 
			IE_DEPENDENTE, 
			DS_MATERIAL_ESPECIAL, 
			IE_GERADO_REGRA
		) values (
			nr_seq_agenda_consulta_w,
			nr_seq_agend_consulta_p,
			agend_proc_w.cd_procedimento,
			agend_proc_w.ie_origem_proced,
			clock_timestamp(),
			wheb_usuario_pck.get_nm_usuario,
			clock_timestamp(),
			wheb_usuario_pck.get_nm_usuario,
			agend_proc_w.NR_SEQ_PROC_INTERNO,
			'S',
			null,
			null,
			null,
			null,
			null,
			null,
			null,
			null,
			null,
			null,
			null,
			'S'
		);	
	end loop;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE rp_gerar_agenda_procedimento ( nr_seq_agend_consulta_p bigint, nr_seq_rp_pac_agend_p bigint, ie_agend_ind_p text default 'N') FROM PUBLIC;

