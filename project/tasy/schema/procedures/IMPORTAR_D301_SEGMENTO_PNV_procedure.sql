-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE importar_d301_segmento_pnv ( nr_seq_dataset_p bigint, ds_conteudo_pnv_p text, nm_usuario_p text) AS $body$
DECLARE

 ds_conteudo_pnv_w    varchar(4000);

BEGIN

if (substr(ds_conteudo_pnv_p,1,3) = 'PNV') then

	ds_conteudo_pnv_w:=replace(ds_conteudo_pnv_p,'''','');

	insert into d301_segmento_pnv(nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		cd_usuario_convenio,
		cd_identificacao_pessoa,
		ds_dt_validade,
		nr_ik_hospital,
		nr_episodio_convenio,
		nr_arquivo_convenio,
		ds_dt_inicio_cobert_conv,
		nr_contrato_conv,
		ds_nome,
		ds_primeiro_nome,
		nr_seq_dataset,
		nr_seq_dataset_ret)
	values (nextval('d301_segmento_nad_seq'),
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		obter_valor_separador(ds_conteudo_pnv_w,2,'+'),
		obter_valor_separador(ds_conteudo_pnv_w,3,'+'),
		obter_valor_separador(ds_conteudo_pnv_w,4,'+'),
		obter_valor_separador(ds_conteudo_pnv_w,5,'+'),
		obter_valor_separador(ds_conteudo_pnv_w,6,'+'),
		obter_valor_separador(ds_conteudo_pnv_w,7,'+'),
		obter_valor_separador(ds_conteudo_pnv_w,8,'+'),
		obter_valor_separador(ds_conteudo_pnv_w,9,'+'),
		obter_valor_separador(ds_conteudo_pnv_w,10,'+'),
		obter_valor_separador(ds_conteudo_pnv_w,11,'+'),
		null,
		nr_seq_dataset_p);
	commit;

end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE importar_d301_segmento_pnv ( nr_seq_dataset_p bigint, ds_conteudo_pnv_p text, nm_usuario_p text) FROM PUBLIC;

