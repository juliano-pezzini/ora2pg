-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_fonetica_pf () AS $body$
DECLARE


qt_registro_w		integer;
cd_pessoa_fisica_w	varchar(10);
nr_sequencia_w		smallint;
nm_pessoa_fisica_w	varchar(60);
ds_fonetica_w		varchar(60);
ds_comando_w		varchar(2000);
ds_parametros_w		varchar(2000);
qt_controle_w		bigint;

/* obter pessoas gerar */

c01 CURSOR FOR
SELECT	cd_pessoa_fisica,
	nm_pessoa_fisica
from	pessoa_fisica;

/* obter complemento pessoas gerar */

c02 CURSOR FOR
SELECT  nm_contato,
	nr_sequencia,
	cd_pessoa_fisica
from	compl_pessoa_fisica
where	(nm_contato IS NOT NULL AND nm_contato::text <> '');


BEGIN

CALL wheb_usuario_pck.set_ie_executar_trigger('N');

qt_controle_w := 0;
CALL gravar_processo_longo('Fonética PESSOA_FISICA','GERAR_FONETICA_PF',qt_controle_w);

ds_comando_w	:= ' update	pessoa_fisica ' ||
		   ' set	ds_fonetica 	 = :ds_fonetica' ||
		   ' where	cd_pessoa_fisica = :cd_pessoa_fisica';
open c01;
loop
fetch c01 into
	cd_pessoa_fisica_w,
	nm_pessoa_fisica_w;
	EXIT WHEN NOT FOUND; /* apply on c01 */
	begin

	ds_fonetica_w	:= gera_fonetica(nm_pessoa_fisica_w,'N');


	ds_parametros_w	:= 'ds_fonetica='||ds_fonetica_w||';cd_pessoa_fisica='||cd_pessoa_fisica_w||';';

	CALL exec_sql_dinamico_bv('GERA FONETICA',ds_comando_w,ds_parametros_w);

	if (qt_registro_w = 10000) then
		commit;
		qt_registro_w := 0;
		qt_controle_w := qt_controle_w + 10000;
		CALL gravar_processo_longo('Fonética PESSOA_FISICA','GERAR_FONETICA_PF',qt_controle_w);
	else
		qt_registro_w := qt_registro_w + 1;
	end if;
	end;
end loop;
close c01;

commit;

qt_registro_w := 0;
ds_comando_w	:= ' update	compl_pessoa_fisica ' ||
		   ' set	ds_fonetica 	 = :ds_fonetica' ||
		   ' where	cd_pessoa_fisica = :cd_pessoa_fisica' ||
		   ' and	nr_sequencia	 = :nr_sequencia';
open c02;
loop
fetch c02 into
	nm_pessoa_fisica_w,
	nr_sequencia_w,
	cd_pessoa_fisica_w;
	EXIT WHEN NOT FOUND; /* apply on c02 */
	begin

	ds_fonetica_w	:= gera_fonetica(nm_pessoa_fisica_w,'N');

	ds_parametros_w	:= 'ds_fonetica='||ds_fonetica_w||';cd_pessoa_fisica='||cd_pessoa_fisica_w||';nr_sequencia='||nr_sequencia_w||';';

	CALL exec_sql_dinamico_bv('GERA FONETICA',ds_comando_w,ds_parametros_w);

	if (qt_registro_w = 10000) then
		commit;
		qt_registro_w := 0;
		qt_controle_w := qt_controle_w + 10000;
		CALL gravar_processo_longo('Fonética COMPL_PESSOA_FISICA','GERAR_FONETICA_PF',qt_controle_w);
	else
		qt_registro_w := qt_registro_w + 1;
	end if;
	end;
end loop;
close c02;

commit;


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_fonetica_pf () FROM PUBLIC;

