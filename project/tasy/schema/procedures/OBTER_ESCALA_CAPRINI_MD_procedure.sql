-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_escala_caprini_md ( qt_idade_p bigint, ie_cirurgia_p bigint, ie_pernas_p text, ie_varizes_p text, ie_bmi_p text, ie_cirur_mes_p text, ie_insuficiencia_card_p text, ie_descanso_p text, ie_ibd_p text, ie_dialise_p text, ie_sepsis_p text, ie_infeccao_p text, ie_hrt_p text, ie_gravida_p text, ie_aborto_p text, ie_outros_01_p text, ie_outros_02_p text, ie_outros_03_p text, ie_outros_04_p text, ie_cancer_p text, ie_cama_p text, ie_mobilidade_p text, ie_tubo_p text, ie_dvt_p text, ie_hist_familia_p text, ie_leiden_p text, ie_lesoes_multiplas_p text, ie_hit_p text, ie_hyperhomo_p text, ie_anti_card_p text, ie_outro_tromb_p text, ie_avc_p text, ie_fratura_p text, ie_paralesia_p text, qt_pontuacao_p INOUT bigint, ie_risco_p INOUT text, ds_resultado_p INOUT text ) AS $body$
DECLARE

  qt_risco_w bigint := 0;

BEGIN

    if (qt_idade_p >= 41 and qt_idade_p <= 60) then
        qt_risco_w := qt_risco_w + 1;
    elsif (qt_idade_p >= 61 and qt_idade_p <= 74 ) then
        qt_risco_w := qt_risco_w + 2;
    elsif (qt_idade_p >= 75 ) then
        qt_risco_w := qt_risco_w + 3;
    end if;

    qt_risco_w := qt_risco_w + coalesce(ie_cirurgia_p, 0);

    if (ie_pernas_p = 'S') then
        qt_risco_w := qt_risco_w + 1;
    end if;

    if (ie_varizes_p = 'S') then
        qt_risco_w := qt_risco_w + 1;
    end if;

    if (ie_bmi_p = 'S') then
        qt_risco_w := qt_risco_w + 1;
    end if;

    if (ie_cirur_mes_p = 'S') then
        qt_risco_w := qt_risco_w + 1;
    end if;

    if (ie_insuficiencia_card_p = 'S') then
        qt_risco_w := qt_risco_w + 1;
    end if;

    if (ie_insuficiencia_card_p = 'S') then
        qt_risco_w := qt_risco_w + 1;
    end if;

    if (ie_descanso_p = 'S') then
        qt_risco_w := qt_risco_w + 1;
    end if;

    if (ie_ibd_p = 'S') then
        qt_risco_w := qt_risco_w + 1;
    end if;

    if (ie_dialise_p = 'S') then
        qt_risco_w := qt_risco_w + 1;
    end if;

    if (ie_sepsis_p = 'S') then
        qt_risco_w := qt_risco_w + 1;
    end if;

    if (ie_infeccao_p = 'S') then
        qt_risco_w := qt_risco_w + 1;
    end if;

    if (ie_hrt_p = 'S') then
        qt_risco_w := qt_risco_w + 1;
    end if;

    if (ie_gravida_p = 'S') then
        qt_risco_w := qt_risco_w + 1;
    end if;

    if (ie_aborto_p = 'S') then
        qt_risco_w := qt_risco_w + 1;
    end if;

    if (ie_outros_01_p IS NOT NULL AND ie_outros_01_p::text <> '') then
        qt_risco_w := qt_risco_w + 1;
    end if;
    
    if (ie_outros_02_p IS NOT NULL AND ie_outros_02_p::text <> '') then
        qt_risco_w := qt_risco_w + 1;
    end if;

    if (ie_outros_03_p IS NOT NULL AND ie_outros_03_p::text <> '') then
        qt_risco_w := qt_risco_w + 1;
    end if;

    if (ie_outros_04_p IS NOT NULL AND ie_outros_04_p::text <> '') then
        qt_risco_w := qt_risco_w + 1;
    end if;

    if (ie_cancer_p = 'S') then
        qt_risco_w := qt_risco_w + 2;
    end if;

    if (ie_cama_p = 'S') then
        qt_risco_w := qt_risco_w + 2;
    end if;

    if (ie_mobilidade_p = 'S') then
        qt_risco_w := qt_risco_w + 2;
    end if;

    if (ie_tubo_p = 'S') then
        qt_risco_w := qt_risco_w + 2;
    end if;

    if (ie_dvt_p = 'S') then
        qt_risco_w := qt_risco_w + 3;
    end if;

    if (ie_hist_familia_p = 'S') then
        qt_risco_w := qt_risco_w + 3;
    end if;

    if (ie_leiden_p = 'S') then
        qt_risco_w := qt_risco_w + 3;
    end if;

    if (ie_lesoes_multiplas_p = 'S') then
        qt_risco_w := qt_risco_w + 3;
    end if;

    if (ie_hit_p = 'S') then
        qt_risco_w := qt_risco_w + 3;
    end if;

    if (ie_hyperhomo_p = 'S') then
        qt_risco_w := qt_risco_w + 3;
    end if;

    if (ie_anti_card_p = 'S') then
        qt_risco_w := qt_risco_w + 3;
    end if;

    if (ie_outro_tromb_p = 'S') then
        qt_risco_w := qt_risco_w + 3;
    end if;
    
    if (ie_avc_p = 'S') then
        qt_risco_w := qt_risco_w + 5;
    end if;

    if (ie_fratura_p = 'S') then
        qt_risco_w := qt_risco_w + 5;
    end if;

    if (ie_paralesia_p = 'S') then
        qt_risco_w := qt_risco_w + 5;
    end if;

    if (qt_risco_w = 0) then
        ie_risco_p := 'Z';
    elsif (qt_risco_w between 1 and 2) then
        ie_risco_p := 'B';
    elsif (qt_risco_w between 3 and 4) then
        ie_risco_p := 'M';
    elsif (qt_risco_w >= 5) then
        ie_risco_p := 'A';
    end if;

    qt_pontuacao_p := qt_risco_w;

    if (ie_risco_p = 'Z') and (ie_risco_p IS NOT NULL AND ie_risco_p::text <> '') then
        ds_resultado_p := obter_desc_expressao(802666);
    elsif (ie_risco_p = 'B') and (ie_risco_p IS NOT NULL AND ie_risco_p::text <> '') then
        ds_resultado_p := obter_desc_expressao(802668);
    elsif (ie_risco_p = 'M') and (ie_risco_p IS NOT NULL AND ie_risco_p::text <> '') then
        ds_resultado_p := obter_desc_expressao(802670);
    elsif (ie_risco_p = 'A') and (ie_risco_p IS NOT NULL AND ie_risco_p::text <> '') then
        ds_resultado_p := obter_desc_expressao(802672);
    end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_escala_caprini_md ( qt_idade_p bigint, ie_cirurgia_p bigint, ie_pernas_p text, ie_varizes_p text, ie_bmi_p text, ie_cirur_mes_p text, ie_insuficiencia_card_p text, ie_descanso_p text, ie_ibd_p text, ie_dialise_p text, ie_sepsis_p text, ie_infeccao_p text, ie_hrt_p text, ie_gravida_p text, ie_aborto_p text, ie_outros_01_p text, ie_outros_02_p text, ie_outros_03_p text, ie_outros_04_p text, ie_cancer_p text, ie_cama_p text, ie_mobilidade_p text, ie_tubo_p text, ie_dvt_p text, ie_hist_familia_p text, ie_leiden_p text, ie_lesoes_multiplas_p text, ie_hit_p text, ie_hyperhomo_p text, ie_anti_card_p text, ie_outro_tromb_p text, ie_avc_p text, ie_fratura_p text, ie_paralesia_p text, qt_pontuacao_p INOUT bigint, ie_risco_p INOUT text, ds_resultado_p INOUT text ) FROM PUBLIC;

