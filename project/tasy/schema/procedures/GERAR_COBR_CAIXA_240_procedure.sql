-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_cobr_caixa_240 ( nr_seq_cobr_escrit_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
DECLARE

			 
ds_conteudo_w			varchar(240);
nr_remessa_w			varchar(8);
qt_lote_arquivo_w		varchar(6) := 0;
qt_reg_lote_w			varchar(6) := 0;
qt_registro_lote_w		varchar(6) := 0;
nr_seq_arquivo_w		varchar(6) := 0;
nr_seq_registro_w		bigint := 0;
nm_empresa_w			varchar(30);
cd_cgc_w			varchar(14);
nm_banco_w			varchar(30);
dt_geracao_w			varchar(8);
hr_geracao_w			varchar(6);
nr_lote_w_w			varchar(4) := 0;
nr_lote_w			varchar(4);
cd_convenio_banco_w		varchar(16);
cd_agencia_banco_w		varchar(5);
ie_dig_agencia_banco_w		varchar(1);
cd_conta_banco_w		varchar(12);
ie_dig_conta_banco_w		varchar(1);

/* Segmentos */
 
nr_nosso_numero_w		varchar(15);
dt_vencimento_w			varchar(8);
vl_titulo_w			varchar(15);
dt_emissao_w			varchar(8);
cd_agencia_w			varchar(5);
ie_digito_agencia_w		varchar(1);
nr_conta_w			varchar(12);
ie_digito_conta_w		varchar(1);
cd_conta_cobr_w			varchar(9);
ie_conta_cobr_w			varchar(1);
nr_seu_numero_w			varchar(15);
ie_tipo_inscricao_w		varchar(1);
nr_inscricao_w			varchar(15);
nm_sacado_w			varchar(40);
ds_endereco_sacado_w		varchar(40);
ds_bairro_sacado_w		varchar(15);
cd_cep_sacado_w			varchar(8);
ds_municipio_sacado_w		varchar(15);
ds_estado_sacado_w		varchar(2);
cd_mov_remessa_w		varchar(2);
cd_transmissao_w		varchar(15);
nm_cedente_w			varchar(30);
nr_seq_pagador_w		bigint;
vl_multa_w			varchar(15);

nr_titulo_w			varchar(15);
ds_mensagem_4_w			varchar(40);
vl_mora_w			varchar(15);
nr_seq_mensalidade_w		bigint;
ds_carteira_w			varchar(11);
nm_segurado_w			varchar(29);
ds_idade_w			varchar(4);
vl_mensalidade_w		varchar(11);
ds_tipo_item_w			varchar(31);
ds_produto_w			varchar(62);
vl_juros_w			double precision;
vl_desconto_w			varchar(15);
cd_juros_w			varchar(1);
vl_juros_dia_w			varchar(15);
dt_credito_w			cobranca_escritural.dt_credito_bancario%type;
vl_totalizador_w		titulo_receber.vl_titulo%type := 0;
qt_titulos_w			bigint := 0;

/* Segmento P */
 
C01 CURSOR FOR 
SELECT	lpad(substr(coalesce(b.cd_agencia_bancaria,'0'),1,5),5,'0') cd_agencia, 
	lpad(substr(coalesce(b.ie_digito,'0'),1,1),1,'0') ie_digito_agencia, 
	lpad(substr(coalesce(e.cd_cedente,'0'),1,6),6,'0') nr_conta, 
	lpad(substr(coalesce(a.ie_digito_conta,'0'),1,1),1,'0') ie_digito_conta, 
	lpad(substr(CASE WHEN coalesce(c.nr_nosso_numero,'0')='0' THEN 82 || lpad(c.nr_titulo,8,'0') || calcula_digito('Modulo11',(82 || lpad(c.nr_titulo,8,'0')))  ELSE c.nr_nosso_numero END ,1,15),15,'0') nr_nosso_numero, 
	rpad(coalesce(a.nr_titulo,0),11,'0') nr_titulo, 
	lpad(coalesce(to_char(c.dt_pagamento_previsto,'ddmmyyyy'),'0'),8,'0') dt_vencimento, 
	lpad(coalesce(somente_numero(to_char(c.vl_titulo,'9999999999990.00')),0),15,'0') vl_titulo, 
	lpad(coalesce(to_char(c.dt_emissao,'ddmmyyyy'),'0'),8,'0') dt_emissao, 
	CASE WHEN coalesce(c.cd_cgc::text, '') = '' THEN '1'  ELSE '2' END  ie_tipo_inscricao, 
	lpad(coalesce(c.cd_cgc,coalesce(d.nr_cpf,'0')),15,'0') nr_inscricao, 
	rpad(substr(obter_nome_pf_pj(c.cd_pessoa_fisica,c.cd_cgc),1,40),40,' ') nm_sacado, 
	rpad(substr(obter_dados_pf_pj(c.cd_pessoa_fisica,c.cd_cgc,'R'),1,40),40,' ') ds_endereco_sacado, 
	rpad(substr(obter_dados_pf_pj(c.cd_pessoa_fisica,c.cd_cgc,'B'),1,15),15,' ') ds_bairro_sacado, 
	lpad(substr(obter_dados_pf_pj(c.cd_pessoa_fisica,c.cd_cgc,'CEP'),1,8),8,'0') cd_cep_sacado, 
	rpad(substr(obter_dados_pf_pj(c.cd_pessoa_fisica,c.cd_cgc,'CI'),1,15),15,' ') ds_municipio_sacado, 
	rpad(substr(obter_dados_pf_pj(c.cd_pessoa_fisica,c.cd_cgc,'UF'),1,2),2,' ') ds_estado_sacado, 
	lpad(coalesce(somente_numero(to_char(coalesce(a.vl_multa,0),'9999999999990.00')),0),15,'0') vl_multa, 
	c.nr_seq_mensalidade, 
	coalesce(a.vl_juros,0) vl_juros, 
	lpad(coalesce(somente_numero(to_char(coalesce(a.vl_desconto,0),'9999999999990.00')),0),15,'0') vl_desconto, 
	lpad(coalesce(somente_numero(to_char(coalesce(c.vl_titulo,0) * (coalesce(c.tx_juros,0) / 100),'9999999999990.00')),0),15,'0') vl_juros_dia 
FROM banco_estabelecimento e, agencia_bancaria b, titulo_receber_cobr a, titulo_receber c
LEFT OUTER JOIN pessoa_fisica d ON (c.cd_pessoa_fisica = d.cd_pessoa_fisica)
WHERE a.nr_titulo		= c.nr_titulo and a.cd_agencia_bancaria	= b.cd_agencia_bancaria and a.cd_banco		= b.cd_banco and c.nr_seq_conta_banco	= e.nr_sequencia and b.cd_agencia_bancaria	= e.cd_agencia_bancaria and a.nr_seq_cobranca	= nr_seq_cobr_escrit_p;

c02 CURSOR FOR 
SELECT	rpad(coalesce(CASE WHEN d.ie_tipo_contratacao='I' THEN substr(pls_obter_dados_segurado(b.nr_seq_segurado,'C'),1,11)  ELSE ' ' END ,' '),11,' ') ds_carteira, 
	rpad(coalesce(CASE WHEN d.ie_tipo_contratacao='I' THEN  substr(pls_obter_dados_segurado(b.nr_seq_segurado,'N'),1,29)  ELSE ' ' END ,' '),29,' ') nm_segurado, 
	rpad(coalesce(CASE WHEN d.ie_tipo_contratacao='I' THEN  to_char(b.qt_idade)  ELSE ' ' END ,' '),4,' ') ds_idade, 
	lpad(to_char(somente_numero(to_char(coalesce(CASE WHEN d.ie_tipo_contratacao='I' THEN  e.vl_item  ELSE 0 END ,0),'999999990.00'))),11,0) vl_mensalidade, 
	rpad(coalesce(CASE WHEN d.ie_tipo_contratacao='I' THEN  substr(obter_valor_dominio(1930,e.ie_tipo_item),1,31)  ELSE ' ' END ,' '),31,' ') ds_tipo_item, 
	rpad(coalesce(substr(CASE WHEN d.ie_tipo_contratacao='I' THEN  CASE WHEN e.ie_tipo_item='3' THEN 'Guia: ' || f.cd_guia || ' - Prestador: ' || substr(pls_obter_dados_prestador(g.nr_seq_prestador,'N'),1,255)  ELSE 'Produto: ' || c.nr_seq_plano || ' - ' || pls_obter_dados_produto(c.nr_seq_plano,'S') END   ELSE ' ' END ,1,62),' '),62,' ') ds_produto 
FROM pls_plano d, pls_segurado c, pls_mensalidade_segurado b, pls_mensalidade a, pls_conta f
LEFT OUTER JOIN pls_protocolo_conta g ON (f.nr_seq_protocolo = g.nr_sequencia)
, pls_mensalidade_seg_item e
LEFT OUTER JOIN pls_conta f ON (e.nr_seq_conta = f.nr_sequencia)
WHERE d.ie_tipo_contratacao	= 'I'   and b.nr_sequencia     = e.nr_seq_mensalidade_seg and c.nr_seq_plano		= d.nr_sequencia and b.nr_seq_segurado	= c.nr_sequencia and a.nr_sequencia		= b.nr_seq_mensalidade and a.nr_sequencia		= nr_seq_mensalidade_w;


BEGIN 
 
delete	from w_envio_banco 
where	nm_usuario	= nm_usuario_p;
 
/* Header Arquivo*/
 
select	rpad(elimina_acentuacao(substr(obter_nome_pf_pj(null,b.cd_cgc),1,30)),30,' ') nm_empresa, 
	rpad(upper(substr(obter_nome_banco(c.cd_banco),1,30)),30,' ') nm_banco, 
	lpad(b.cd_cgc,14,'0') cd_cgc, 
	lpad(to_char(coalesce(a.nr_remessa,a.nr_sequencia)),6,'0') nr_seq_arquivo, 
	to_char(clock_timestamp(),'ddmmyyyy') dt_geracao, 
	to_char(clock_timestamp(),'hh24miss') hr_geracao, 
	lpad(substr(coalesce(c.cd_transmissao,'0'),1,15),15,'0') cd_transmissao, 
	lpad(substr(coalesce(c.cd_convenio_banco,'0'),1,16),16,'0') cd_convenio_banco, 
	lpad(substr(coalesce(e.cd_agencia_bancaria,'0'),1,5),5,'0') cd_agencia_banco, 
	lpad(substr(coalesce(e.ie_digito,'0'),1,1),1,'0') ie_dig_agencia_banco, 
	lpad(substr(coalesce(c.cd_cedente,'0'),1,6),6,'0') cd_cedente, 
	lpad(substr(coalesce(c.ie_digito_conta,'0'),1,1),1,'0') ie_dig_conta_banco, 
	lpad(substr(coalesce(a.nr_remessa,a.nr_sequencia),1,8),8,'0') nr_remessa, 
	lpad(to_char(a.dt_credito_bancario,'ddmmyyyyy'),8,'0') dt_credito 
into STRICT	nm_empresa_w, 
	nm_banco_w, 
	cd_cgc_w, 
	nr_seq_arquivo_w, 
	dt_geracao_w, 
	hr_geracao_w, 
	cd_transmissao_w, 
	cd_convenio_banco_w, 
	cd_agencia_banco_w, 
	ie_dig_agencia_banco_w, 
	cd_conta_banco_w, 
	ie_dig_conta_banco_w, 
	nr_remessa_w, 
	dt_credito_w 
FROM agencia_bancaria e, banco_estabelecimento c, estabelecimento b, cobranca_escritural a
LEFT OUTER JOIN banco_carteira d ON (a.nr_seq_carteira_cobr = d.nr_sequencia)
WHERE c.cd_agencia_bancaria	= e.cd_agencia_bancaria and a.cd_estabelecimento	= b.cd_estabelecimento and a.nr_seq_conta_banco	= c.nr_sequencia  and a.nr_sequencia		= nr_seq_cobr_escrit_p;
 
ds_conteudo_w	:=	'104' || 
			'0000' || 
			'0' || 
			rpad(' ',9,' ') || 
			'1' || 
			cd_cgc_w || 
			--cd_convenio_banco_w || 
			rpad('0',20,'0') || 
			cd_agencia_banco_w || 
			ie_dig_agencia_banco_w || 
			cd_conta_banco_w || 
			'0000000' || 
			'0' || 
			nm_empresa_w || 
			nm_banco_w || 
			rpad(' ',10,' ') || 
			'1' || 
			dt_geracao_w || 
			hr_geracao_w || 
			nr_seq_arquivo_w || 
			'050' || 
			'00000' || 
			rpad(' ',20,' ') || 
			'REMESSA-PRODUCAO  '|| 
			rpad(' ',4,' ') || 
			rpad(' ',25,' ');
 
insert	into w_envio_banco(nr_sequencia, 
	dt_atualizacao, 
	nm_usuario, 
	dt_atualizacao_nrec, 
	nm_usuario_nrec, 
	cd_estabelecimento, 
	ds_conteudo, 
	nr_seq_apres, 
	nr_seq_apres_2) 
values (nextval('w_envio_banco_seq'), 
	clock_timestamp(), 
	nm_usuario_p, 
	clock_timestamp(), 
	nm_usuario_p, 
	cd_estabelecimento_p, 
	ds_conteudo_w, 
	1, 
	1);
 
qt_lote_arquivo_w	:= qt_lote_arquivo_w + 1;
/* Fim Header Arquivo */
 
 
/* Header Lote */
 
nr_lote_w_w	:= coalesce(nr_lote_w_w,0) + 1;
nr_lote_w	:= lpad(nr_lote_w_w,4,'0');
 
ds_conteudo_w	:=	'104' || 
			nr_lote_w || 
			'1' || 
			'R' || 
			'01' || 
			'00' || 
			'030' || 
			' ' || 
			'2' || 
			lpad(cd_cgc_w,15,'0') || 
			cd_conta_banco_w || 
			rpad('0',14,'0') || 
			cd_agencia_banco_w || 
			ie_dig_agencia_banco_w || 
			cd_conta_banco_w || 
			'0000000' || 
			'0' || 
			nm_empresa_w || 
			rpad(' ', 40, ' ') || 
			rpad(' ', 40, ' ') || 
			nr_remessa_w || 
			dt_geracao_w || 
			'00000000' || 
			rpad(' ', 33, ' ');
 
insert	into w_envio_banco(nr_sequencia, 
	dt_atualizacao, 
	nm_usuario, 
	dt_atualizacao_nrec, 
	nm_usuario_nrec, 
	cd_estabelecimento, 
	ds_conteudo, 
	nr_seq_apres, 
	nr_seq_apres_2) 
values (nextval('w_envio_banco_seq'), 
	clock_timestamp(), 
	nm_usuario_p, 
	clock_timestamp(), 
	nm_usuario_p, 
	cd_estabelecimento_p, 
	ds_conteudo_w, 
	2, 
	2);
	 
qt_lote_arquivo_w	:= qt_lote_arquivo_w + 1;
qt_registro_lote_w	:= qt_registro_lote_w + 1;
qt_reg_lote_w		:= qt_reg_lote_w + 1;
/* Fim Header Lote */
 
 
/* Inicio Segmentos */
 
open	C01;
loop 
fetch	C01 into	 
	cd_agencia_w, 
	ie_digito_agencia_w, 
	nr_conta_w, 
	ie_digito_conta_w, 
	nr_nosso_numero_w, 
	nr_titulo_w, 
	dt_vencimento_w, 
	vl_titulo_w, 
	dt_emissao_w, 
	ie_tipo_inscricao_w, 
	nr_inscricao_w, 
	nm_sacado_w, 
	ds_endereco_sacado_w, 
	ds_bairro_sacado_w, 
	cd_cep_sacado_w, 
	ds_municipio_sacado_w, 
	ds_estado_sacado_w, 
	vl_multa_w, 
	nr_seq_mensalidade_w, 
	vl_juros_w, 
	vl_desconto_w, 
	vl_juros_dia_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
 
	/* Segmento P */
 
	if (vl_juros_w	> 0) then 
		cd_juros_w	:= '1';
	else 
		cd_juros_w	:= '3';
	end if;
 
	nr_seq_registro_w	:= nr_seq_registro_w + 1;
	vl_totalizador_w	:= vl_totalizador_w + vl_titulo_w;
 
	ds_conteudo_w	:=	'104' || 
				nr_lote_w || 
				'3' || 
				lpad(coalesce(nr_seq_registro_w,0), 5, '0') || 
				'P' || 
				' ' || 
				'01' || 
				cd_agencia_w || 
				ie_digito_agencia_w || 
				cd_conta_banco_w || 
				rpad('0',11,'0') || 
				'14' || 
				lpad(coalesce(nr_nosso_numero_w,'0'),15,'0') || 
				'1' || 
				'1' || 
				'2' || 
				'2' || 
				'0' || 
				nr_titulo_w || 
				'  ' || 
				dt_vencimento_w || 
				vl_titulo_w || 
				'00000' || 
				'0' || 
				'99' || 
				'N' || 
				dt_emissao_w || 
				coalesce(cd_juros_w,'0') || 
				dt_vencimento_w || 
				vl_juros_dia_w || 
				'1' || 
				dt_vencimento_w || 
				vl_desconto_w || 
				lpad('0',15,'0') || 
				lpad('0',15,'0') || 
				rpad(nr_titulo_w,25,' ') || 
				'1' || 
				'10' || 
				'2' || 
				'000' || 
				'09' || 
				rpad('0', 10, '0') || 
				' ';
	 
	insert into w_envio_banco(nr_sequencia, 
		dt_atualizacao, 
		nm_usuario, 
		dt_atualizacao_nrec, 
		nm_usuario_nrec, 
		cd_estabelecimento, 
		ds_conteudo, 
		nr_seq_apres, 
		nr_seq_apres_2) 
	values (nextval('w_envio_banco_seq'), 
		clock_timestamp(), 
		nm_usuario_p, 
		clock_timestamp(), 
		nm_usuario_p, 
		cd_estabelecimento_p, 
		ds_conteudo_w, 
		3, 
		nr_seq_registro_w);
	/* Fim segmento P */
 
	 
	qt_lote_arquivo_w	:= qt_lote_arquivo_w + 1;
	qt_registro_lote_w	:= qt_registro_lote_w + 1;
	 
	qt_titulos_w		:= coalesce(qt_titulos_w,0) + 1;
 
	/* Segmento Q */
 
	ds_conteudo_w		:= null;
	nr_seq_registro_w	:= nr_seq_registro_w + 1;
	 
	ds_conteudo_w	:=	'104' || 
				nr_lote_w || 
				'3' || 
				lpad(coalesce(nr_seq_registro_w,0), 5, '0') || 
				'Q' || 
				' ' || 
				'01' || 
				ie_tipo_inscricao_w || 
				nr_inscricao_w || 
				nm_sacado_w || 
				ds_endereco_sacado_w || 
				ds_bairro_sacado_w || 
				cd_cep_sacado_w || 
				ds_municipio_sacado_w || 
				ds_estado_sacado_w || 
				'0' || 
				rpad('0', 15, '0') || 
				rpad(' ', 40, ' ') || 
				rpad('0',3,'0') || 
				rpad('0',20,'0') || 
				rpad(' ', 8, ' ');
				 
	insert	into w_envio_banco(nr_sequencia, 
		dt_atualizacao, 
		nm_usuario, 
		dt_atualizacao_nrec, 
		nm_usuario_nrec, 
		cd_estabelecimento, 
		ds_conteudo, 
		nr_seq_apres, 
		nr_seq_apres_2) 
	values (nextval('w_envio_banco_seq'), 
		clock_timestamp(), 
		nm_usuario_p, 
		clock_timestamp(), 
		nm_usuario_p, 
		cd_estabelecimento_p, 
		ds_conteudo_w, 
		3, 
		nr_seq_registro_w);
		 
	/* Fim segmento Q */
 
	qt_lote_arquivo_w	:= qt_lote_arquivo_w + 1;
	qt_registro_lote_w	:= qt_registro_lote_w + 1;
	 
	/* Segmento R */
 
	ds_conteudo_w		:= null;
	nr_seq_registro_w	:= nr_seq_registro_w + 1;
	 
	ds_conteudo_w	:=	'104' || 
				nr_lote_w || 
				'3' || 
				lpad(coalesce(nr_seq_registro_w,0), 5, '0') || 
				'R' || 
				' ' || 
				'01' || 
				rpad(' ',48,' ') || 
				'2' || 
				dt_vencimento_w || 
				vl_multa_w || 
				rpad(' ',151,' ');
				 
	insert	into w_envio_banco(nr_sequencia, 
		dt_atualizacao, 
		nm_usuario, 
		dt_atualizacao_nrec, 
		nm_usuario_nrec, 
		cd_estabelecimento, 
		ds_conteudo, 
		nr_seq_apres, 
		nr_seq_apres_2) 
	values (nextval('w_envio_banco_seq'), 
		clock_timestamp(), 
		nm_usuario_p, 
		clock_timestamp(), 
		nm_usuario_p, 
		cd_estabelecimento_p, 
		ds_conteudo_w, 
		3, 
		nr_seq_registro_w);
		 
	/* Fim segmento R */
 
	qt_lote_arquivo_w	:= qt_lote_arquivo_w + 1;
	qt_registro_lote_w	:= qt_registro_lote_w + 1;
	 
	open	C02;
	loop 
	fetch	C02 into	 
		ds_carteira_w, 
		nm_segurado_w, 
		ds_idade_w, 
		vl_mensalidade_w, 
		ds_tipo_item_w, 
		ds_produto_w;
	EXIT WHEN NOT FOUND; /* apply on C02 */
		begin 
 
		/* Segmento S */
 
		ds_conteudo_w		:= null;
		nr_seq_registro_w	:= nr_seq_registro_w + 1;
 
		ds_conteudo_w	:=	'104' || 
					nr_lote_w || 
					'3' || 
					lpad(coalesce(nr_seq_registro_w,0), 5, '0') || 
					'S' || 
					' ' || 
					'01' || 
					'3' || 
					ds_carteira_w || 
					nm_segurado_w || 
					ds_idade_w || 
					vl_mensalidade_w || 
					ds_tipo_item_w || 
					rpad(' ',12,' ') || 
					ds_produto_w || 
					rpad(' ',40,' ') || 
					rpad(' ',22,' ');
					 
		insert	into w_envio_banco(nr_sequencia, 
			dt_atualizacao, 
			nm_usuario, 
			dt_atualizacao_nrec, 
			nm_usuario_nrec, 
			cd_estabelecimento, 
			ds_conteudo, 
			nr_seq_apres, 
			nr_seq_apres_2) 
		values (nextval('w_envio_banco_seq'), 
			clock_timestamp(), 
			nm_usuario_p, 
			clock_timestamp(), 
			nm_usuario_p, 
			cd_estabelecimento_p, 
			ds_conteudo_w, 
			3, 
			nr_seq_registro_w);
			 
		/* Fim segmento S */
 
		qt_lote_arquivo_w	:= qt_lote_arquivo_w + 1;
		qt_registro_lote_w	:= qt_registro_lote_w + 1;
 
		end;
 
	end loop;
	close C02;
 
end	loop;
close	C01;
/*Fim Segmentos */
 
 
/* Trailler Lote*/
 
begin 
qt_lote_arquivo_w	:= qt_lote_arquivo_w + 1;
qt_registro_lote_w	:= qt_registro_lote_w + 1;
	 
ds_conteudo_w	:=	'104' || 
			nr_lote_w || 
			'5' || 
			lpad(' ', 9, ' ') || 
			lpad(qt_registro_lote_w, 6, '0') || 
			lpad(qt_titulos_w,6,'0') || 
			lpad(coalesce(somente_numero(to_char(vl_totalizador_w,'999999999999990.00')),0),15,'0') || 
			rpad('0',6,'0') || 
			rpad('0',17,'0') || 
			rpad('0',6,'0') || 
			rpad('0',19,'0') || 
			rpad(' ',31,' ') || 
			rpad(' ', 117, ' ');
 
insert	into w_envio_banco(nr_sequencia, 
	dt_atualizacao, 
	nm_usuario, 
	dt_atualizacao_nrec, 
	nm_usuario_nrec, 
	cd_estabelecimento, 
	ds_conteudo, 
	nr_seq_apres, 
	nr_seq_apres_2) 
values (nextval('w_envio_banco_seq'), 
	clock_timestamp(), 
	nm_usuario_p, 
	clock_timestamp(), 
	nm_usuario_p, 
	cd_estabelecimento_p, 
	ds_conteudo_w, 
	5, 
	5);
end;
/* Fim Trailler Lote*/
 
 
 
/* Trailler Arquivo*/
 
begin 
qt_lote_arquivo_w	:= qt_lote_arquivo_w + 1;
 
ds_conteudo_w	:=	'104' || 
			'9999' || 
			'9' || 
			lpad(' ', 9, ' ') || 
			lpad(qt_reg_lote_w, 6, '0') || 
			lpad(qt_lote_arquivo_w, 6, '0') || 
			rpad(' ', 6, ' ') || 
			rpad(' ', 205, ' ');
 
insert	into w_envio_banco(nr_sequencia, 
	dt_atualizacao, 
	nm_usuario, 
	dt_atualizacao_nrec, 
	nm_usuario_nrec, 
	cd_estabelecimento, 
	ds_conteudo, 
	nr_seq_apres, 
	nr_seq_apres_2) 
values (nextval('w_envio_banco_seq'), 
	clock_timestamp(), 
	nm_usuario_p, 
	clock_timestamp(), 
	nm_usuario_p, 
	cd_estabelecimento_p, 
	ds_conteudo_w, 
	6, 
	6);
end;
/* Fim Trailler Arquivo*/
 
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_cobr_caixa_240 ( nr_seq_cobr_escrit_p bigint, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

