-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_lanc_auto_item_carencia ( nr_seq_beneficiario_p bigint, nr_seq_regra_p bigint, nr_seq_tipo_carencia_p bigint, qt_dias_carencia_p bigint, ie_inicio_vig_carencia_p text, nm_usuario_p text) AS $body$
DECLARE


dt_inicio_vigencia_w		timestamp;


BEGIN
if (ie_inicio_vig_carencia_p	= 'A') then
	dt_inicio_vigencia_w		:= clock_timestamp();
elsif (ie_inicio_vig_carencia_p	= 'I') then
	select	coalesce(max(dt_inclusao_operadora),'')
	into STRICT	dt_inicio_vigencia_w
	from	pls_segurado
	where	nr_sequencia	= nr_seq_beneficiario_p;
elsif (ie_inicio_vig_carencia_p	= 'P') then
	select	dt_alteracao
	into STRICT	dt_inicio_vigencia_w
	from	pls_segurado_alt_plano
	where	nr_seq_segurado	= nr_seq_beneficiario_p
	and	nr_sequencia	=	(	SELECT	max(nr_sequencia)
						from 	pls_segurado_alt_plano 
						where 	nr_seq_segurado = nr_seq_beneficiario_p
						and	ie_situacao = 'A'
						and	trunc(dt_atualizacao) = trunc(clock_timestamp()));
end if;

insert into pls_carencia(nr_sequencia, dt_atualizacao, nm_usuario,
	dt_atualizacao_nrec, nm_usuario_nrec, nr_seq_plano,
	nr_seq_contrato, nr_seq_tipo_carencia, nr_seq_segurado,
	qt_dias, dt_inicio_vigencia, ds_observacao,
	nr_seq_pessoa_proposta, nr_seq_regra_aut,ie_origem_carencia_benef)
values (	nextval('pls_carencia_seq'), clock_timestamp(), nm_usuario_p,
	clock_timestamp(), nm_usuario_p, null,
	null, nr_seq_tipo_carencia_p, nr_seq_beneficiario_p,
	qt_dias_carencia_p, dt_inicio_vigencia_w, wheb_mensagem_pck.get_texto(1109033)||': ' || nr_seq_regra_p,
	null, nr_seq_regra_p,'P');

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_lanc_auto_item_carencia ( nr_seq_beneficiario_p bigint, nr_seq_regra_p bigint, nr_seq_tipo_carencia_p bigint, qt_dias_carencia_p bigint, ie_inicio_vig_carencia_p text, nm_usuario_p text) FROM PUBLIC;

