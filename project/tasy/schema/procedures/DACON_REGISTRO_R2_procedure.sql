-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE dacon_registro_r2 ( nm_usuario_p text, nr_seq_dacon_p bigint ) AS $body$
DECLARE

 
ds_arquivo_w	varchar(2000);


BEGIN 
 
select	rpad('R02',4,' ') --ds_tipo_registro, 
	||rpad(obter_cgc_estabelecimento(cd_estabelecimento),14,' ')--cd_cgc, 
	||rpad(obter_razao_social(obter_cgc_estabelecimento(cd_estabelecimento)),150,' ')--nm_pessoa_juridica, 
	||lpad((select coalesce(coalesce(n.CD_NAT_JURIDICA,j.nr_seq_nat_juridica), 0) FROM pessoa_juridica j
LEFT OUTER JOIN sup_natureza_juridica n ON (j.nr_seq_nat_juridica = n.nr_sequencia)
WHERE j.cd_cgc = obter_cgc_estabelecimento(cd_estabelecimento) ),4,0) --cd_natureza_juridica, 
	||lpad(0,7,0) --filler, 
	||coalesce(rpad(obter_dados_pf_pj(null,obter_cgc_estabelecimento(cd_estabelecimento),'LO'),20,' '),(rpad(' ',20,' ')))--ds_tipo_logradouro, 
	||rpad(obter_dados_pf_pj(null,obter_cgc_estabelecimento(cd_estabelecimento),'R'),150,' ')--ds_logradouro, 
	||coalesce(rpad((obter_dados_pf_pj(null,obter_cgc_estabelecimento(cd_estabelecimento),'NR')),6,' '), (rpad(' ',6,' ')))--nr_endereco, 
	||coalesce(rpad((obter_dados_pf_pj(null,obter_cgc_estabelecimento(cd_estabelecimento),'CO')),50,' '), (rpad(' ',50,' ')))--ds_comple, 
	||coalesce(rpad((obter_dados_pf_pj(null,obter_cgc_estabelecimento(cd_estabelecimento),'B')),50,' '), (rpad(' ',50,' ')))--ds_bairro, 
	||obter_dados_pf_pj(null,obter_cgc_estabelecimento(cd_estabelecimento),'UF')--ds_uf, 
	||rpad((obter_dados_pf_pj(null,obter_cgc_estabelecimento(cd_estabelecimento),'CI')),50,' ')--ds_municipio, 
	||coalesce(rpad(elimina_caractere_especial(obter_dados_pf_pj(null,obter_cgc_estabelecimento(cd_estabelecimento),'CEP')),8,' '), (rpad(' ',8,' ')))--nr_cep, 
	||coalesce(rpad((select nr_ddd_telefone from Pessoa_juridica where cd_cgc = obter_cgc_estabelecimento(cd_estabelecimento)),4,' '), (rpad(' ',4,' '))) --nr_ddd_telefone, 
	||coalesce(rpad(elimina_caractere_especial((select nr_telefone from Pessoa_juridica where cd_cgc = obter_cgc_estabelecimento(cd_estabelecimento))),9,' '), (rpad(' ',9,' '))) --nr_telefone, 
	||coalesce(rpad((select nr_ddd_fax from Pessoa_juridica where cd_cgc = obter_cgc_estabelecimento(cd_estabelecimento)),4,' '), (rpad(' ',4,' '))) --nr_ddd_fax, 
	||coalesce(rpad(elimina_caractere_especial((select nr_fax from Pessoa_juridica where cd_cgc = obter_cgc_estabelecimento(cd_estabelecimento))),9,' '), (rpad(' ',9,' '))) --nr_fax, 
	||rpad(' ', 6, ' ') --ds_caixa_postal, 
	||rpad(' ', 2, ' ') --uf_caixa_postal, 
	||rpad(' ', 8, ' ') --cd_cep_caixa_postal, 
	||coalesce(rpad((select ds_site_internet from pessoa_juridica where cd_cgc = obter_cgc_estabelecimento(cd_estabelecimento)),115,' '), (rpad(' ',115,' ')))--ds_correio_eletronico, 
	||lpad(0,10,0) --filler, 
into STRICT	ds_arquivo_w		 		 						 
from	dacon 
where	nr_sequencia = nr_seq_dacon_p;
 
insert into w_dacon(nr_sequencia, 
	  dt_atualizacao, 
	  nm_usuario,			 
	  dt_atualizacao_nrec, 
	  nm_usuario_nrec, 
	  ds_arquivo, 
	  nr_linha, 
	  ie_tipo_registro) 
values (nextval('w_dacon_seq'), 
	  clock_timestamp(), 
	  nm_usuario_p, 
	  clock_timestamp(), 
	  nm_usuario_p, 
	  ds_arquivo_w, 
	  1, 
 	  15);
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE dacon_registro_r2 ( nm_usuario_p text, nr_seq_dacon_p bigint ) FROM PUBLIC;

