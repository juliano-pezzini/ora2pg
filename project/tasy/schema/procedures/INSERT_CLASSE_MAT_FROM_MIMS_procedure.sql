-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE insert_classe_mat_from_mims ( cd_imp_material_p imp_material.cd_material%type, cd_subgrupo_material_w bigint, nm_usuario_p text, cd_classe_material_p INOUT classe_material.cd_classe_material%type) AS $body$
DECLARE

cd_classe_material_nseq_w classe_material.cd_classe_material%TYPE;
imp_classe_material_w     imp_classe_material%ROWTYPE;
cd_classe_mat_p        classe_material.cd_classe_material%type;

BEGIN

select	a.*  
into STRICT   	imp_classe_material_w 
from   	imp_classe_material a, 
	imp_material b 
where  	b.cd_material = cd_imp_material_p 
and 	b.cd_classe_material = a.cd_classe_material;

select	coalesce(max(cd_classe_material), 0) + 1  
into STRICT   	cd_classe_material_p 
from   	classe_material;
if (imp_classe_material_w.cd_classe_material IS NOT NULL AND imp_classe_material_w.cd_classe_material::text <> '') then 
               -- insert into subgrupo_material
select max(cd_classe_material)
into STRICT cd_classe_mat_p
from classe_material where ds_classe_material in (SELECT ds_classe_material from	imp_classe_material a
        where  	a.cd_classe_material =
    imp_classe_material_w.cd_classe_material);

	if (coalesce(cd_classe_mat_p,0) <> 0) then
    cd_classe_material_p  := cd_classe_mat_p;
	else
        insert	into 	classe_material(cd_classe_material,
		ds_classe_material, 
		cd_subgrupo_material, 
		ie_situacao, 
		dt_atualizacao, 
		nm_usuario, 
		ie_tipo_classe, 
		nr_seq_apres, 
		cd_sistema_ant) 
        SELECT 	cd_classe_material_p, 
		ds_classe_material, 
		cd_subgrupo_material_w, 
		ie_situacao, 
		clock_timestamp(), 
		nm_usuario_p, 
		ie_tipo_classe, 
		nr_seq_apres, 
		cd_sistema_ant 
        from	imp_classe_material a 
        where  	a.cd_classe_material = 
		imp_classe_material_w.cd_classe_material;
    end if;
end if;

exception 
	when no_data_found then 
	imp_classe_material_w := null;
             
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE insert_classe_mat_from_mims ( cd_imp_material_p imp_material.cd_material%type, cd_subgrupo_material_w bigint, nm_usuario_p text, cd_classe_material_p INOUT classe_material.cd_classe_material%type) FROM PUBLIC;

