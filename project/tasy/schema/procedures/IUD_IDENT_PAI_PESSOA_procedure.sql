-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE iud_ident_pai_pessoa ( cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%type, nm_usuario_p text, operation_type_p text, nr_ident_pai_p pessoa_fisica_aux.nr_ident_pai%type ) AS $body$
DECLARE

  nr_seq_pessoa_fisica_aux_w pessoa_fisica_aux.nr_sequencia%type;
  nr_seq_pessoa_aux_w pessoa_fisica_aux.nr_sequencia%type;

BEGIN
  SELECT MAX(nr_sequencia)
  INTO STRICT nr_seq_pessoa_aux_w
  FROM pessoa_fisica_aux
  WHERE cd_pessoa_fisica = cd_pessoa_fisica_p;
  IF (operation_type_p NOT IN ('DELETE')) THEN
    IF (coalesce(nr_seq_pessoa_aux_w::text, '') = '') THEN
      SELECT nextval('pessoa_fisica_aux_seq')
      INTO STRICT nr_seq_pessoa_fisica_aux_w LIMIT 1;
      INSERT
      INTO pessoa_fisica_aux(
          nr_sequencia,
          dt_atualizacao,
          nm_usuario,
          dt_atualizacao_nrec,
          nm_usuario_nrec,
          cd_pessoa_fisica,
          nr_ident_pai
        )
        VALUES (
          nr_seq_pessoa_fisica_aux_w,
          clock_timestamp(),
          nm_usuario_p,
          clock_timestamp(),
          nm_usuario_p,
          cd_pessoa_fisica_p,
          nr_ident_pai_p
        );
    ELSIF (nr_seq_pessoa_aux_w IS NOT NULL AND nr_seq_pessoa_aux_w::text <> '') THEN
      UPDATE pessoa_fisica_aux p
      SET p.nr_ident_pai       = nr_ident_pai_p,
        p.dt_atualizacao_nrec  = clock_timestamp(),
        p.nm_usuario_nrec      = nm_usuario_p
      WHERE p.cd_pessoa_fisica = cd_pessoa_fisica_p
      AND p.nr_sequencia       = nr_seq_pessoa_aux_w;
    END IF;
  ELSIF (operation_type_p = 'DELETE') THEN
    UPDATE pessoa_fisica_aux p
    SET p.nr_ident_pai        = NULL,
      p.dt_atualizacao_nrec  = clock_timestamp(),
      p.nm_usuario_nrec      = nm_usuario_p
    WHERE p.cd_pessoa_fisica = cd_pessoa_fisica_p
    AND p.nr_sequencia       = nr_seq_pessoa_aux_w;
  END IF;
  COMMIT;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE iud_ident_pai_pessoa ( cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%type, nm_usuario_p text, operation_type_p text, nr_ident_pai_p pessoa_fisica_aux.nr_ident_pai%type ) FROM PUBLIC;

