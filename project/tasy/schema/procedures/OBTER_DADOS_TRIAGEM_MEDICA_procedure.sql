-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_dados_triagem_medica (nr_atendimento_p bigint, qt_saturacao_o2_p INOUT bigint, cd_escala_dor_p INOUT text, qt_escala_dor_p INOUT text, qt_pa_sistolica_p INOUT bigint, qt_pa_diastolica_p INOUT bigint, qt_freq_cardiaca_p INOUT bigint, qt_freq_resp_p INOUT bigint, qt_temp_p INOUT bigint, qt_peso_mae_p INOUT bigint, qt_altura_cm_p INOUT bigint, ie_nivel_consciencia_p INOUT text, qt_gestacoes_p INOUT bigint, qt_natimortos_p INOUT bigint, qt_parto_normal_p INOUT bigint, qt_parto_cesario_p INOUT bigint, qt_filhos_vivos_p INOUT bigint, qt_abortos_p INOUT bigint, dt_ultima_menstruacao_p INOUT timestamp, dt_prov_parto_p INOUT timestamp) AS $body$
BEGIN

select max(qt_saturacao_o2),
	   max(cd_escala_dor),
	   max(qt_escala_dor),
	   max(qt_pa_sistolica),
	   max(qt_pa_diastolica),
	   max(qt_freq_cardiaca),
	   max(qt_freq_resp),
	   max(qt_temp),
	   max(qt_gestacoes),
	   max(qt_natimortos),
	   max(qt_parto_normal),
	   max(qt_parto_cesario),
	   max(qt_filhos_vivos),
	   max(qt_abortos),
	   max(dt_ultima_menstruacao),
	   max(dt_prov_parto)
into STRICT   qt_saturacao_o2_p,
	   cd_escala_dor_p,
	   qt_escala_dor_p,
	   qt_pa_sistolica_p,
	   qt_pa_diastolica_p,
	   qt_freq_cardiaca_p,
	   qt_freq_resp_p,
	   qt_temp_p,
	   qt_gestacoes_p,
	   qt_natimortos_p,
	   qt_parto_normal_p,
	   qt_parto_cesario_p,
	   qt_filhos_vivos_p,
	   qt_abortos_p,
	   dt_ultima_menstruacao_p,
	   dt_prov_parto_p
from   enf_tri_obstetrica
where  nr_sequencia = (SELECT max(nr_sequencia)
                       from   enf_tri_obstetrica
					   where  nr_atendimento = nr_atendimento_p
					   and    (dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
					   and    coalesce(dt_inativacao::text, '') = '');

select max(ie_nivel_consciencia)
into STRICT   ie_nivel_consciencia_p
from   atendimento_sinal_vital
where  nr_sequencia = (SELECT max(nr_sequencia)
                       from   atendimento_sinal_vital
					   where  nr_atendimento = nr_atendimento_p
					   and    (ie_nivel_consciencia IS NOT NULL AND ie_nivel_consciencia::text <> '')
					   and    (dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
					   and    coalesce(dt_inativacao::text, '') = '');

select max(qt_peso)
into STRICT   qt_peso_mae_p
from   atendimento_sinal_vital
where  nr_sequencia = (SELECT max(nr_sequencia)
                       from   atendimento_sinal_vital
					   where  nr_atendimento = nr_atendimento_p
					   and    (qt_peso IS NOT NULL AND qt_peso::text <> '')
					   and    (dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
					   and    coalesce(dt_inativacao::text, '') = '');

select max(qt_altura_cm)
into STRICT   qt_altura_cm_p
from   atendimento_sinal_vital
where  nr_sequencia = (SELECT max(nr_sequencia)
                       from   atendimento_sinal_vital
					   where  nr_atendimento = nr_atendimento_p
					   and    (qt_altura_cm IS NOT NULL AND qt_altura_cm::text <> '')
					   and    (dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
					   and    coalesce(dt_inativacao::text, '') = '');


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_dados_triagem_medica (nr_atendimento_p bigint, qt_saturacao_o2_p INOUT bigint, cd_escala_dor_p INOUT text, qt_escala_dor_p INOUT text, qt_pa_sistolica_p INOUT bigint, qt_pa_diastolica_p INOUT bigint, qt_freq_cardiaca_p INOUT bigint, qt_freq_resp_p INOUT bigint, qt_temp_p INOUT bigint, qt_peso_mae_p INOUT bigint, qt_altura_cm_p INOUT bigint, ie_nivel_consciencia_p INOUT text, qt_gestacoes_p INOUT bigint, qt_natimortos_p INOUT bigint, qt_parto_normal_p INOUT bigint, qt_parto_cesario_p INOUT bigint, qt_filhos_vivos_p INOUT bigint, qt_abortos_p INOUT bigint, dt_ultima_menstruacao_p INOUT timestamp, dt_prov_parto_p INOUT timestamp) FROM PUBLIC;

