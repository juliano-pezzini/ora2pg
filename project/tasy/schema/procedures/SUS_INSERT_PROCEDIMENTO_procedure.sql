-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE sus_insert_procedimento (cd_procedimento_p bigint, ds_procedimento_p text, cd_grupo_proc_p bigint, nm_usuario_p text, qt_dia_internacao_sus_p bigint, qt_max_procedimento_p bigint, nr_seq_forma_org_p bigint) AS $body$
DECLARE

			
ds_procedimento_w	procedimento.ds_procedimento%type;
qt_form_org_w		bigint;
nr_seq_forma_org_w	sus_forma_organizacao.nr_sequencia%type;


BEGIN

select	count(1)
into STRICT	qt_form_org_w
from	sus_forma_organizacao
where	nr_sequencia = nr_seq_forma_org_p
and	cd_forma_organizacao = substr(cd_procedimento_p, 1, 5);

if ( qt_form_org_w = 0 ) then
	begin
	select	nr_sequencia
	into STRICT	nr_seq_forma_org_w
	from	sus_forma_organizacao
	where	cd_forma_organizacao = substr(cd_procedimento_p, 1, 5);
	end;
else

	nr_seq_forma_org_w	:= nr_seq_forma_org_p;

end if;

ds_procedimento_w := substr(ds_procedimento_p,1,240);

insert into procedimento(cd_procedimento,
	ds_procedimento,
	ie_situacao, 
	cd_grupo_proc, 
	dt_atualizacao, 
	nm_usuario,
	ie_classificacao, 
	ie_origem_proced, 
	qt_dia_internacao_sus, 
	qt_max_procedimento,
	ie_exige_autor_sus, 
	qt_exec_barra, 
	ie_ativ_prof_bpa,
	ie_alta_complexidade, 
	ie_ignora_origem, 
	nr_seq_forma_org, 
	ie_classif_custo, 
	ie_localizador,
	ie_apuracao_custo)                                                                   
values (cd_procedimento_p, 
	ds_procedimento_w, 
	'A', 
	cd_grupo_proc_p, 
	clock_timestamp(), 
	nm_usuario_p,
	1, 
	7, 
	qt_dia_internacao_sus_p, 
	qt_max_procedimento_p,
	'N', 
	0, 
	'N', 
	'S', 
	'N', 
	nr_seq_forma_org_w, 
	'B', 
	'S',
	'Q');

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE sus_insert_procedimento (cd_procedimento_p bigint, ds_procedimento_p text, cd_grupo_proc_p bigint, nm_usuario_p text, qt_dia_internacao_sus_p bigint, qt_max_procedimento_p bigint, nr_seq_forma_org_p bigint) FROM PUBLIC;

