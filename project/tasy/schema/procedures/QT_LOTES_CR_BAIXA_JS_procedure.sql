-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE qt_lotes_cr_baixa_js ( baixa_lote_gerado_p text, dt_baixa_p timestamp, cd_estabelecimento_p bigint, cd_tipo_lote_contabil_p bigint, nr_sequencia_p bigint, qt_lotes_p INOUT bigint, qt_total_baixa_p INOUT bigint) AS $body$
DECLARE


qt_lotes_w  	integer := 0;
qt_total_baixa_w	integer := 0;


BEGIN
	if (baixa_lote_gerado_p = 'N') then
		begin
		select	max(nr_lote_contabil)
		into STRICT	qt_lotes_w
		from    	lote_contabil
		where   	dt_referencia  >= trunc(dt_baixa_p, 'dd')
		and	cd_estabelecimento      =  cd_estabelecimento_p
		and     	cd_tipo_lote_contabil   =  cd_tipo_lote_contabil_p
		and     	(dt_geracao_lote IS NOT NULL AND dt_geracao_lote::text <> '');
		end;
	else
		begin
		select	max(nr_lote_contabil)
		into STRICT	qt_lotes_w
		from   	lote_contabil
		where   	dt_referencia  = trunc(dt_baixa_p, 'dd')
		and	cd_estabelecimento      =  cd_estabelecimento_p
		and     	cd_tipo_lote_contabil   =  cd_tipo_lote_contabil_p
		and     	(dt_geracao_lote IS NOT NULL AND dt_geracao_lote::text <> '');
		end;
	end if;

if (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '') then
	begin
	select 	sum(vl_baixa)
	into STRICT 	qt_total_baixa_w
	from   	movto_cartao_cr_baixa
	where  	nr_seq_parcela = nr_sequencia_p;
	end;
end if;
qt_lotes_p 		:= qt_lotes_w;
qt_total_baixa_p 		:= qt_total_baixa_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE qt_lotes_cr_baixa_js ( baixa_lote_gerado_p text, dt_baixa_p timestamp, cd_estabelecimento_p bigint, cd_tipo_lote_contabil_p bigint, nr_sequencia_p bigint, qt_lotes_p INOUT bigint, qt_total_baixa_p INOUT bigint) FROM PUBLIC;

