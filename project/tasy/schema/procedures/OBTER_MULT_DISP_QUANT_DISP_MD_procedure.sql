-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_mult_disp_quant_disp_md (ie_regra_disp_p text, qt_material_p bigint, qt_multiplo_p bigint, qt_unitaria_p bigint, nr_ocorrencia_p bigint, nr_multiplo_p INOUT bigint, qt_Dispensar_p INOUT bigint ) AS $body$
BEGIN
    if (ie_regra_disp_p = 'M') then 
        qt_Dispensar_p := qt_material_p;

    elsif (ie_regra_disp_p = 'S') then
        if (trunc(qt_material_p,0) = qt_material_p) then
            qt_Dispensar_p	:= qt_material_p;
        else
            qt_Dispensar_p	:= trunc(qt_material_p,0) + 1;
        end if;

    elsif (ie_regra_disp_p = 'I') then        
        if (trunc(qt_material_p,0) = qt_material_p) then
            qt_Dispensar_p	:= qt_material_p;
        else
            qt_Dispensar_p	:= trunc(qt_material_p,0);
        end if;
    elsif (ie_regra_disp_p = 'C') then
        if	((trunc(qt_material_p / qt_multiplo_p) * qt_multiplo_p) = qt_material_p) then
            nr_multiplo_p	:= dividir_sem_round_md(qt_material_p,qt_multiplo_p);
        else
            nr_multiplo_p   := trunc(dividir_sem_round_md(qt_material_p,qt_multiplo_p)) + 1;
        end if;

        qt_Dispensar_p	:= qt_multiplo_p * nr_multiplo_p;
    else
        if	((trunc(qt_unitaria_p / qt_multiplo_p) * qt_multiplo_p) = qt_unitaria_p) then
            nr_multiplo_p	:= dividir_sem_round_md(qt_unitaria_p,qt_multiplo_p);
        else
            nr_multiplo_p   := trunc(dividir_sem_round_md(qt_unitaria_p,qt_multiplo_p)) + 1;
        end if;

        qt_Dispensar_p	:= qt_multiplo_p * nr_multiplo_p;
        qt_Dispensar_p	:= round((qt_Dispensar_p * nr_ocorrencia_p)::numeric,3);
    end if;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_mult_disp_quant_disp_md (ie_regra_disp_p text, qt_material_p bigint, qt_multiplo_p bigint, qt_unitaria_p bigint, nr_ocorrencia_p bigint, nr_multiplo_p INOUT bigint, qt_Dispensar_p INOUT bigint ) FROM PUBLIC;

