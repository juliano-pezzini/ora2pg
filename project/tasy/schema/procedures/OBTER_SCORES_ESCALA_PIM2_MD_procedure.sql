-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE obter_scores_escala_pim2_md (qt_rel_fio2_p bigint, qt_rel_pao2_p bigint, ie_adm_eletiva_p text, ie_proc_recuperacao_p text, ie_cirurgia_cardiaca_p text, ie_diag_alto_risco_p text, ie_resposta_pupilas_p text, ie_ventilacao_mecanica_p text, qt_pto_adm_eletiva_p bigint, qt_pto_proc_recup_p bigint, qt_pto_cirur_card_p bigint, qt_pto_diag_alto_risco_p bigint, qt_pto_resp_pupilas_p bigint, qt_pto_vent_mec_p bigint, qt_pa_sitolica_p bigint, qt_ph_sangue_p bigint, qt_pto_pa_sistolica_p INOUT bigint, qt_pto_ph_sangue_p INOUT bigint, qt_pto_pao2_fio2_p INOUT bigint, qt_tx_mortalidade_p INOUT bigint ) AS $body$
DECLARE


   logit_w          double precision := 0;
   qt_fio2_pao2_w   double precision := 0;
   qt_pto_valores_w bigint := 0;
   qt_pontuacao_w   double precision := 0;

BEGIN
  --- Inicio MD7
  qt_fio2_pao2_w := dividir_md((qt_rel_fio2_p * 100), qt_rel_pao2_p);

  qt_pto_pa_sistolica_p := 0.01395;

  qt_pto_ph_sangue_p := 0.1040;

  qt_pto_pao2_fio2_p := 0.2888;

  if (ie_adm_eletiva_p       = 'S') or (ie_proc_recuperacao_p    = 'S') or (ie_cirurgia_cardiaca_p   = 'S') or (ie_diag_alto_risco_p     = 'A') or (ie_diag_alto_risco_p     = 'B') or (ie_resposta_pupilas_p    = 'S') or (ie_ventilacao_mecanica_p = 'S') then
    qt_pto_valores_w	:= 1;
  else
    qt_pto_valores_w	:= 0;
  end if;

  qt_pontuacao_w := coalesce(qt_pto_adm_eletiva_p,0)	    +	
                    coalesce(qt_pto_proc_recup_p,0)	    +
                    coalesce(qt_pto_cirur_card_p,0)	    +	
                    coalesce(qt_pto_diag_alto_risco_p,0) +
                    coalesce(qt_pto_resp_pupilas_p,0)	  +	
                    coalesce(qt_pto_vent_mec_p,0);

  logit_w := (-4.8841) + (qt_pto_valores_w * qt_pontuacao_w) + coalesce((0.01395 * (abs(qt_pa_sitolica_p - 120))),0) + 
      coalesce((0.1040 * abs(qt_ph_sangue_p)),0) + (0.2888 * trunc((qt_fio2_pao2_w),1));

  qt_tx_mortalidade_p := dividir_md(exp(logit_w), 1 + exp(logit_w)) * 100;
  --- Fim MD7
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE obter_scores_escala_pim2_md (qt_rel_fio2_p bigint, qt_rel_pao2_p bigint, ie_adm_eletiva_p text, ie_proc_recuperacao_p text, ie_cirurgia_cardiaca_p text, ie_diag_alto_risco_p text, ie_resposta_pupilas_p text, ie_ventilacao_mecanica_p text, qt_pto_adm_eletiva_p bigint, qt_pto_proc_recup_p bigint, qt_pto_cirur_card_p bigint, qt_pto_diag_alto_risco_p bigint, qt_pto_resp_pupilas_p bigint, qt_pto_vent_mec_p bigint, qt_pa_sitolica_p bigint, qt_ph_sangue_p bigint, qt_pto_pa_sistolica_p INOUT bigint, qt_pto_ph_sangue_p INOUT bigint, qt_pto_pao2_fio2_p INOUT bigint, qt_tx_mortalidade_p INOUT bigint ) FROM PUBLIC;

