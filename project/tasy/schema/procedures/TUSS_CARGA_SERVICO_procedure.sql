-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE tuss_carga_servico ( cd_proc_p bigint, ds_proc_p text, cd_grupo_p bigint, nm_usuario_p text, ie_classificacao_p text, nr_seq_tuss_serv_p bigint default null, ds_erro_p INOUT text DEFAULT NULL) AS $body$
DECLARE


qt_registros_w	bigint;
qt_reg_proced_w	bigint;
qt_reg_estrut_w	bigint;
ds_erro_w	varchar(2000);
nr_sequencia_w	bigint;
cd_grupo_w	bigint;


BEGIN

qt_registros_w		:= 0;
ds_erro_w		:= WHEB_MENSAGEM_PCK.get_texto(280641);
cd_grupo_w		:= coalesce(cd_grupo_p,0);

/* Carga do procedimento */

begin
select 	count(*)
into STRICT	qt_registros_w
from	procedimento
where	cd_procedimento	= cd_proc_p
and	ie_origem_proced = 8;

select	count(*)
into STRICT	qt_reg_estrut_w
from	grupo_proc
where	cd_grupo_proc = cd_grupo_w;


if (qt_registros_w	= 0) and (qt_reg_estrut_w <> 0) then
	 begin
	 insert into procedimento(
			CD_PROCEDIMENTO,
			DS_PROCEDIMENTO,
			DS_COMPLEMENTO,
			IE_SITUACAO,
			CD_GRUPO_PROC,
			DT_ATUALIZACAO,
			NM_USUARIO,
			CD_TIPO_PROCEDIMENTO,
			IE_CLASSIFICACAO,
			CD_LAUDO_PADRAO,
			CD_SETOR_EXCLUSIVO,
			IE_ORIGEM_PROCED,
			QT_DIA_INTERNACAO_SUS,
			QT_IDADE_MINIMA_SUS,
			QT_IDADE_MAXIMA_SUS,
			IE_SEXO_SUS,
			IE_INREAL_SUS,
			IE_INATOM_SUS,
			CD_GRUPO_SUS,
			CD_DOENCA_CID,
			CD_CID_SECUNDARIO,
			DS_PROC_INTERNO,
			NR_PROC_INTERNO,
			IE_UTIL_PRESCRICAO,
			CD_KIT_MATERIAL,
			DS_ORIENTACAO,
			IE_VALOR_ESPECIAL,
			DT_CARGA,
			QT_MAX_PROCEDIMENTO,
			IE_EXIGE_LAUDO,
			IE_FORMA_APRESENTACAO,
			IE_APURACAO_CUSTO,
			QT_HORA_BAIXAR_PRESCR,
			NR_SEQ_GRUPO_REC,
			DS_PRESCRICAO,
			IE_EXIGE_AUTOR_SUS,
			QT_EXEC_BARRA,
			DS_PROCEDIMENTO_PESQUISA,
			IE_ATIV_PROF_BPA,
			IE_ALTA_COMPLEXIDADE,
			IE_IGNORA_ORIGEM,
			IE_CLASSIF_CUSTO,
			ie_localizador,
			NR_SEQ_TUSS_SERV)
	values (cd_proc_p,
			InitCap(substr(ds_proc_p,1,240)),
			null,
			'A',
			cd_grupo_w,
			clock_timestamp(),
			nm_usuario_p,
			 null,
			ie_classificacao_p,
			 null,
			 null,
			 8,
			 null,
			 null,
			 null,
			 null,
			 null,
			 null,
			 null,
			 null,
			 null,
			 InitCap(substr(ds_proc_p,1,80)),
			 cd_proc_p,
			 null,
			 null,
			 null,
			 null,
			 null,
			 null,
			 null,
			 null,
			 null,
			 null,
			 null,
			 null,
			 'N',
			 1,
			 null,
			'N',
			'N',
			'N',
			'B',
			'S',
			nr_seq_tuss_serv_p);
	exception
  	when others then
    		ds_erro_w	:= SQLERRM(SQLSTATE);
	end;
else

	begin

		update	procedimento
		set	ds_procedimento = ds_proc_p,
			nr_seq_tuss_serv = coalesce(nr_seq_tuss_serv_p, nr_seq_tuss_serv),
			nm_usuario = nm_usuario_p,
			dt_atualizacao = clock_timestamp()
		where	cd_procedimento = cd_proc_p;

	exception
	when others then
		ds_erro_w	:= SQLERRM(SQLSTATE);
	end;

end if;
end;

ds_erro_p	:= ds_erro_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tuss_carga_servico ( cd_proc_p bigint, ds_proc_p text, cd_grupo_p bigint, nm_usuario_p text, ie_classificacao_p text, nr_seq_tuss_serv_p bigint default null, ds_erro_p INOUT text DEFAULT NULL) FROM PUBLIC;

