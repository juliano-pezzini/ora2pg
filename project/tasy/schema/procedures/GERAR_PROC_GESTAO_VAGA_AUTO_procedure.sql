-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_proc_gestao_vaga_auto (nr_atendimento_p bigint) AS $body$
DECLARE


nr_seq_protocolo_w		varchar(10);
cd_tipo_solicitacao_w	varchar(5);
cd_tipo_vaga_w			varchar(5);
cd_motivo_transf_w		bigint;
cd_setor_desejado_w		integer;
cd_acomodacao_w			smallint;
cd_convenio_w			integer;
cd_categoria_w			varchar(10);
cd_plano_w				varchar(10);
cd_procedimento_w		bigint;
ds_hd_w					varchar(4000);
cd_clinica_w			integer;
cd_cid_w				varchar(10);
ie_nec_isolamento_w		varchar(1);
ie_nec_dialise_w		varchar(1);
nr_seq_proc_int_atend_w	bigint;
cd_medico_resp_w		varchar(10);
ie_origem_proced_w		bigint;
nr_qtd_vaga_protocolo_w bigint;
nr_sequencia_w gestao_vaga.nr_sequencia%TYPE;


BEGIN

nr_seq_protocolo_w := Obter_Param_Usuario(916, 980, obter_perfil_ativo, obter_usuario_ativo, obter_estabelecimento_ativo, nr_seq_protocolo_w);

select 	Obter_medico_resp_atend(nr_atendimento_p,'C')
into STRICT	cd_medico_resp_w
;

SELECT	COUNT(*)
INTO STRICT	nr_qtd_vaga_protocolo_w
FROM	gestao_vaga_protocolo
WHERE	ie_situacao = 'A'
	AND	nr_sequencia = nr_seq_protocolo_w;

if (nr_qtd_vaga_protocolo_w > 0) then
	begin
	select	cd_tipo_solicitacao,
		cd_tipo_vaga,
		cd_motivo_transf,
		cd_setor_desejado,
		cd_tipo_acomodacao,
		cd_convenio,
		cd_categoria,
		cd_plano,
		cd_procedimento,
		ds_hd_me,
		cd_clinica,
		cd_doenca_cid,
		ie_nec_isolamento,
		ie_nec_dialise,
		nr_seq_proc_interno,
		ie_origem_proced
	into STRICT	cd_tipo_solicitacao_w,
		cd_tipo_vaga_w,
		cd_motivo_transf_w,
		cd_setor_desejado_w,
		cd_acomodacao_w,
		cd_convenio_w,
		cd_categoria_w,
		cd_plano_w,
		cd_procedimento_w,
		ds_hd_w,
		cd_clinica_w,
		cd_cid_w,
		ie_nec_isolamento_w,
		ie_nec_dialise_w,
		nr_seq_proc_int_atend_w,
		ie_origem_proced_w
	from	gestao_vaga_protocolo
	where	ie_situacao = 'A'
		and	nr_sequencia = nr_seq_protocolo_w;



	nr_sequencia_w := Gerar_Necessidade_Vaga(	nr_atendimento_p, cd_tipo_solicitacao_w, cd_tipo_vaga_w, cd_motivo_transf_w, cd_setor_desejado_w, cd_acomodacao_w, obter_estabelecimento_ativo, cd_convenio_w, cd_categoria_w, cd_plano_w, ds_hd_w, cd_procedimento_w, ie_origem_proced_w, obter_usuario_ativo, nr_seq_proc_int_atend_w, cd_medico_resp_w, cd_clinica_w, cd_cid_w, ie_nec_isolamento_w, ie_nec_dialise_w, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, nr_sequencia_w);
	end;
end if;
commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_proc_gestao_vaga_auto (nr_atendimento_p bigint) FROM PUBLIC;

