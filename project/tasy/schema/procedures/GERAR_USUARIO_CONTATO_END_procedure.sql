-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE gerar_usuario_contato_end ( cd_pessoa_fisica_p text, nm_usuario_p text, nr_seq_contato_p bigint) AS $body$
DECLARE


nr_seq_end_w 		bigint;
nr_seq_compl_pes_w 	bigint;
ds_endereco_w 		varchar(40);
nr_endereco_w 		integer;
cd_cep_w 		varchar(15);
ds_bairro_w 		varchar(80);
ds_municipio_w 		varchar(40);
sg_estado_w 		compl_pessoa_fisica.sg_estado%type;
nr_telefone_w 		varchar(15);
nr_ramal_w 		integer;
ds_observacao_w 		varchar(255);
ds_complemento_w 	varchar(40);
NM_EMPRESA_w		varchar(255);

BEGIN

-- INSERCAO DO COMPLEMENTO RESIDENCIAL
select 	max(nr_sequencia),
	max(ds_endereco),
	max(nr_endereco),
	max(cd_cep),
	max(ds_bairro),
	max(ds_municipio),
	max(sg_estado),
	max(nr_telefone),
	max(nr_ramal),
	max(ds_observacao),
	max(ds_complemento),
	substr(max(OBTER_NOME_EMPRESA_REF(CD_EMPRESA_REFER)),1,50)
into STRICT 	nr_seq_compl_pes_w,
	ds_endereco_w,
	nr_endereco_w,
	cd_cep_w,
	ds_bairro_w,
	ds_municipio_w,
	sg_estado_w,
	nr_telefone_w,
	nr_ramal_w,
	ds_observacao_w,
	ds_complemento_w,
	NM_EMPRESA_w
from 	compl_pessoa_fisica
where 	ie_tipo_complemento = 1
and 	cd_pessoa_fisica = cd_pessoa_fisica_p;

if (nr_seq_compl_pes_w IS NOT NULL AND nr_seq_compl_pes_w::text <> '') then

	select nextval('usuario_contato_end_seq')
	into STRICT nr_seq_end_w
	;

	insert into usuario_contato_end(
		nr_sequencia,
		nr_seq_contato,
		ds_endereco,
		nr_endereco,
		cd_cep,
		ds_bairro,
		ds_municipio,
		sg_estado,
		nr_telefone,
		nr_ramal,
		ds_observacao,
		ds_complemento,
		ie_tipo_complemento,
		dt_atualizacao,
		nm_usuario,
		NM_EMPRESA)
	values (	nr_seq_end_w,
		nr_seq_contato_p,
		ds_endereco_w,
		nr_endereco_w,
		cd_cep_w,
		substr(ds_bairro_w,1,40),
		ds_municipio_w,
		sg_estado_w,
		nr_telefone_w,
		nr_ramal_w,
		ds_observacao_w,
		ds_complemento_w,
		0,
		clock_timestamp(),
		nm_usuario_p,
		NM_EMPRESA_w);
end if;

-- INSERCAO DO COMPLEMENTO COMERCIAL
select 	max(nr_sequencia),
	max(ds_endereco),
	max(nr_endereco),
	max(cd_cep),
	max(ds_bairro),
	max(ds_municipio),
	max(sg_estado),
	max(nr_telefone),
	max(nr_ramal),
	max(ds_observacao),
	max(ds_complemento),
	substr(max(OBTER_NOME_EMPRESA_REF(CD_EMPRESA_REFER)),1,50)
into STRICT 	nr_seq_compl_pes_w,
	ds_endereco_w,
	nr_endereco_w,
	cd_cep_w,
	ds_bairro_w,
	ds_municipio_w,
	sg_estado_w,
	nr_telefone_w,
	nr_ramal_w,
	ds_observacao_w,
	ds_complemento_w,
	NM_EMPRESA_w
from 	compl_pessoa_fisica
where 	ie_tipo_complemento = 2
and 	cd_pessoa_fisica = cd_pessoa_fisica_p;

if (nr_seq_compl_pes_w IS NOT NULL AND nr_seq_compl_pes_w::text <> '') then

	select nextval('usuario_contato_end_seq')
	into STRICT nr_seq_end_w
	;

	insert into usuario_contato_end(
		nr_sequencia,
		nr_seq_contato,
		ds_endereco,
		nr_endereco,
		cd_cep,
		ds_bairro,
		ds_municipio,
		sg_estado,
		nr_telefone,
		nr_ramal,
		ds_observacao,
		ds_complemento,
		ie_tipo_complemento,
		dt_atualizacao,
		nm_usuario,
		NM_EMPRESA)
	values (	nr_seq_end_w,
		nr_seq_contato_p,
		ds_endereco_w,
		nr_endereco_w,
		cd_cep_w,
		substr(ds_bairro_w,1,40),
		ds_municipio_w,
		sg_estado_w,
		nr_telefone_w,
		nr_ramal_w,
		ds_observacao_w,
		ds_complemento_w,
		1,
		clock_timestamp(),
		nm_usuario_p,
		NM_EMPRESA_w);
end if;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_usuario_contato_end ( cd_pessoa_fisica_p text, nm_usuario_p text, nr_seq_contato_p bigint) FROM PUBLIC;

