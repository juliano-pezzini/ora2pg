-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE abdata_gravar_log_import (ds_arquivo_p text, ie_tipo_erro_p text) AS $body$
DECLARE


abdamed_import_log_w	abdamed_import_log%rowtype;
ds_log_w		varchar(2000);


BEGIN

select	nextval('abdamed_import_log_seq')
into STRICT	abdamed_import_log_w.nr_sequencia
;

if (ie_tipo_erro_p = '1') then --O arquivo #@DS_ARQUIVO#@ não foi importado, pois não está definido na configuração do ABDATA.
	ds_log_w	:= wheb_mensagem_pck.GET_TEXTO(1039083,'DS_ARQUIVO='||DS_ARQUIVO_P);

elsif (ie_tipo_erro_p = '2') then --O arquivo #@DS_ARQUIVO#@ não foi importado, pois já foi importado arquivo de versão posterior.
	ds_log_w	:= wheb_mensagem_pck.GET_TEXTO(1039084,'DS_ARQUIVO='||DS_ARQUIVO_P);

elsif (ie_tipo_erro_p = '3') then --O arquivo #@DS_ARQUIVO#@ não foi importado. Verifique o layout do arquivo.
	ds_log_w	:= wheb_mensagem_pck.GET_TEXTO(1039502,'DS_ARQUIVO='||DS_ARQUIVO_P);
end if;

abdamed_import_log_w.nm_usuario			:= 'ABDATA';
abdamed_import_log_w.nm_usuario_nrec		:= 'ABDATA';
abdamed_import_log_w.dt_atualizacao		:= clock_timestamp();
abdamed_import_log_w.dt_atualizacao_nrec	:= clock_timestamp();
abdamed_import_log_w.nr_seq_import		:= null; --grava como null, para indicar que é um log geral.
abdamed_import_log_w.ie_tipo			:= 'E';
abdamed_import_log_w.ds_log			:= substr(ds_log_w,1,4000);

insert into abdamed_import_log values (abdamed_import_log_w.*);

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE abdata_gravar_log_import (ds_arquivo_p text, ie_tipo_erro_p text) FROM PUBLIC;

