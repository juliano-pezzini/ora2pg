-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copia_medicamento_padrao (nr_seq_medic_p bigint, nr_seq_medic_copia_p INOUT bigint, nm_usuario_p text) AS $body$
DECLARE



nr_seq_medicamento_w		bigint;


BEGIN


select	nextval('med_medic_padrao_seq')
into STRICT	nr_seq_medicamento_w
;



insert into med_medic_padrao(
		nr_sequencia,
		ds_material,
		dt_atualizacao,
		nm_usuario,
		ds_posologia,
		cd_medico,
		nr_seq_grupo_medic,
		ds_generico,
		ie_via_aplicacao,
		ds_observacao,
		ds_laboratorio,
		ds_contra_indicacao,
		ds_efeito,
		ds_forma_apres,
		ie_tipo_receita,
		ie_situacao,
		cd_estabelecimento,
		DS_INDICACAO,
		QT_MEDIC_CAIXA,
		NM_CURTO,
		IE_EXIBIR_RECEITA,
		DS_INTERACAO_MEDICAMENTOSA,
		DS_MATERIAL_SELECAO)
(SELECT nr_seq_medicamento_w,
  -- 347811 = CÃ³pia
	substr(obter_desc_expressao(347811)|| ds_material,1,100),
	clock_timestamp(),
	nm_usuario_p,
	ds_posologia,
	cd_medico,
	nr_seq_grupo_medic,
	ds_generico,
	ie_via_aplicacao,
	ds_observacao,
	ds_laboratorio,
	ds_contra_indicacao,
	ds_efeito,
	ds_forma_apres,
	ie_tipo_receita,
	ie_situacao,
	cd_estabelecimento,
	DS_INDICACAO,
	QT_MEDIC_CAIXA,
	NM_CURTO,
	IE_EXIBIR_RECEITA,
	DS_INTERACAO_MEDICAMENTOSA,
	CASE WHEN coalesce(DS_MATERIAL_SELECAO::text, '') = '' THEN null  ELSE substr(obter_desc_expressao(347811) || DS_MATERIAL_SELECAO,1,255) END
from	med_medic_padrao
where	nr_sequencia	= nr_seq_medic_p);

nr_seq_medic_copia_p	:= nr_seq_medicamento_w;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copia_medicamento_padrao (nr_seq_medic_p bigint, nr_seq_medic_copia_p INOUT bigint, nm_usuario_p text) FROM PUBLIC;

