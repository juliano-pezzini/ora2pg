-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gerar_guia_prestador ( cd_guia_p text, cd_guia_principal_imp_p text, ie_tipo_guia_p text, cd_usuario_plano_imp_p text, nm_segurado_imp_p text, ds_plano_imp_p text, dt_validade_cartao_imp_p timestamp, cd_ans_imp_p text, ie_carater_internacao_imp_p text, dt_solicitacao_imp_p timestamp, ds_indicacao_clinica_imp_p text, ie_regime_internacao_imp_p text, nr_seq_autorizacao_imp_p bigint, nr_seq_clinica_imp_p text, qt_dia_autorizado_imp_p text, dt_admissao_hosp_imp_p timestamp, dt_validade_senha_imp_p timestamp, cd_tipo_acomod_autor_imp_p text, nr_cartao_nac_sus_imp_p text, ds_observacao_imp_p text, cd_senha_imp_p text, nm_responsavel_autoriz_imp_p text, cd_estabelecimento_p bigint, nm_usuario_p text, cd_cgc_solicitado_imp_p text, nm_prestador_imp_p text, cd_cnes_imp_p text, nr_seq_prestador_imp_p bigint, cd_cgc_prestador_imp_p text, cd_cpf_prestador_imp_p text, nm_medico_solicitante_imp_p text, uf_crm_imp_p text, nr_crm_imp_p text, ds_conselho_profissional_imp_p text, cd_cbo_saude_imp_p text, cd_medico_solicitante_p text, nr_seq_guia_plano_p INOUT bigint) AS $body$
DECLARE


/*

cd_estabelecimento_p - Passar estabelecimento da Operadora

Solicitante
cd_cgc_solicitado_imp_p

Contratado solicitante
nm_prestador_imp_p
cd_cnes_imp_p,
nr_seq_prestador_imp_p,
cd_cgc_prestador_imp_p
cd_cpf_prestador_imp_p

Profissional
nm_medico_solicitante_imp_p
uf_crm_imp_p
nr_crm_imp_p
ds_conselho_profissional_imp_p
cd_cbo_saude_imp_p
*/
nr_seq_guia_plano_w	bigint;
cd_versao_tiss_ops_w	varchar(100);



BEGIN

select	pls_obter_versao_tiss
into STRICT	cd_versao_tiss_ops_w
;

select	nextval('pls_guia_plano_seq')
into STRICT	nr_seq_guia_plano_w
;

insert into pls_guia_plano(
	nr_sequencia, ie_estagio, cd_estabelecimento,
	cd_guia, cd_guia_imp, ie_status,
        ie_situacao,nm_usuario, dt_atualizacao,
        ie_tipo_guia, cd_usuario_plano_imp, nm_segurado_imp,
        ds_plano_imp, dt_validade_cartao_imp, cd_ans_imp,
        ie_carater_internacao_imp, dt_solicitacao_imp, ds_indicacao_clinica_imp,
        ie_regime_internacao_imp, nr_seq_autorizacao_imp, nr_seq_clinica_imp,
        qt_dia_autorizado_imp, dt_admissao_hosp_imp, dt_validade_senha_imp,
        cd_tipo_acomod_autor_imp, ie_tipo_processo, nr_cartao_nac_sus_imp,
        ds_observacao_imp, cd_senha_imp, nm_responsavel_autoriz_imp,
	cd_guia_manual_imp, cd_cgc_solicitado_imp, nm_prestador_imp,
	cd_cnes_imp, nr_seq_prestador_imp, cd_cgc_prestador_imp,
	cd_cpf_prestador_imp, nm_medico_solicitante_imp, uf_crm_imp,
	nr_crm_imp, ds_conselho_profissional_imp, cd_cbo_saude_imp,
	cd_medico_solicitante, nr_seq_prestador, cd_versao,
	dt_solicitacao)
values (nr_seq_guia_plano_w, 7, cd_estabelecimento_p,
        to_char(nr_seq_guia_plano_w), cd_guia_principal_imp_p, '2',
        'U', nm_usuario_p, clock_timestamp(),
        ie_tipo_guia_p, cd_usuario_plano_imp_p, nm_segurado_imp_p,
        ds_plano_imp_p, dt_validade_cartao_imp_p, cd_ans_imp_p,
        ie_carater_internacao_imp_p, dt_solicitacao_imp_p, ds_indicacao_clinica_imp_p,
        ie_regime_internacao_imp_p, nr_seq_autorizacao_imp_p, nr_seq_clinica_imp_p,
        qt_dia_autorizado_imp_p, dt_admissao_hosp_imp_p, dt_validade_senha_imp_p,
        cd_tipo_acomod_autor_imp_p, 'E', nr_cartao_nac_sus_imp_p,
        ds_observacao_imp_p, cd_senha_imp_p, nm_responsavel_autoriz_imp_p,
	cd_guia_principal_imp_p, cd_cgc_solicitado_imp_p, nm_prestador_imp_p,
	cd_cnes_imp_p, nr_seq_prestador_imp_p, cd_cgc_prestador_imp_p,
	cd_cpf_prestador_imp_p,  nm_medico_solicitante_imp_p, uf_crm_imp_p,
	nr_crm_imp_p, ds_conselho_profissional_imp_p, cd_cbo_saude_imp_p,
	cd_medico_solicitante_p, nr_seq_prestador_imp_p, cd_versao_tiss_ops_w,
	dt_solicitacao_imp_p);

nr_seq_guia_plano_p := nr_seq_guia_plano_w;

commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_guia_prestador ( cd_guia_p text, cd_guia_principal_imp_p text, ie_tipo_guia_p text, cd_usuario_plano_imp_p text, nm_segurado_imp_p text, ds_plano_imp_p text, dt_validade_cartao_imp_p timestamp, cd_ans_imp_p text, ie_carater_internacao_imp_p text, dt_solicitacao_imp_p timestamp, ds_indicacao_clinica_imp_p text, ie_regime_internacao_imp_p text, nr_seq_autorizacao_imp_p bigint, nr_seq_clinica_imp_p text, qt_dia_autorizado_imp_p text, dt_admissao_hosp_imp_p timestamp, dt_validade_senha_imp_p timestamp, cd_tipo_acomod_autor_imp_p text, nr_cartao_nac_sus_imp_p text, ds_observacao_imp_p text, cd_senha_imp_p text, nm_responsavel_autoriz_imp_p text, cd_estabelecimento_p bigint, nm_usuario_p text, cd_cgc_solicitado_imp_p text, nm_prestador_imp_p text, cd_cnes_imp_p text, nr_seq_prestador_imp_p bigint, cd_cgc_prestador_imp_p text, cd_cpf_prestador_imp_p text, nm_medico_solicitante_imp_p text, uf_crm_imp_p text, nr_crm_imp_p text, ds_conselho_profissional_imp_p text, cd_cbo_saude_imp_p text, cd_medico_solicitante_p text, nr_seq_guia_plano_p INOUT bigint) FROM PUBLIC;

