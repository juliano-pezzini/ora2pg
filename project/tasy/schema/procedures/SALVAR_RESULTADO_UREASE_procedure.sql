-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE salvar_resultado_urease ( NR_SEQ_LAUDO_P bigint, NR_PRESCRICAO_P bigint, NR_SEQ_PRESCRICAO_P bigint, DS_LAUDO_P text, DS_LAUDO_RELATORIO_P text, DS_LAUDO_ORIGINAL_P text, NM_USUARIO_P text, IE_UREASE_P text, ALTERACAO_UREASE_P text) AS $body$
DECLARE


IE_STATUS_P	bigint;


BEGIN
UPDATE LAUDO_PACIENTE
SET DS_LAUDO = DS_LAUDO_P,
DT_ATUALIZACAO = clock_timestamp(),
DT_UREASE = clock_timestamp(),
NM_USUARIO = NM_USUARIO_P,
IE_UREASE = IE_UREASE_P
WHERE NR_SEQUENCIA = NR_SEQ_LAUDO_P;

UPDATE LAUDO_PACIENTE_RELATORIO
SET DS_LAUDO = DS_LAUDO_RELATORIO_P,
DT_ATUALIZACAO = clock_timestamp(),
NM_USUARIO = NM_USUARIO_P
WHERE NR_SEQ_LAUDO = NR_SEQ_LAUDO_P;

 IF (ALTERACAO_UREASE_P = 'S') THEN
	IE_STATUS_P := 29;
	ELSE
	IE_STATUS_P := 28;
 END IF;

 INSERT INTO PRESCR_PROC_AUDITORIA(NR_SEQUENCIA,
 NR_PRESCRICAO,
 NR_SEQUENCIA_PRESCRICAO,
 DT_ATUALIZACAO,
 NM_USUARIO,
 DT_ATUALIZACAO_NREC,
 NM_USUARIO_NREC,
 IE_STATUS_AUDITORIA,
 DS_LAUDO)
 VALUES (
 nextval('prescr_proc_auditoria_seq'),
 NR_PRESCRICAO_P,
 NR_SEQ_PRESCRICAO_P,
 clock_timestamp(),
 NM_USUARIO_P, clock_timestamp(),
 NM_USUARIO_P,
 IE_STATUS_P,
 DS_LAUDO_ORIGINAL_P);

COMMIT;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE salvar_resultado_urease ( NR_SEQ_LAUDO_P bigint, NR_PRESCRICAO_P bigint, NR_SEQ_PRESCRICAO_P bigint, DS_LAUDO_P text, DS_LAUDO_RELATORIO_P text, DS_LAUDO_ORIGINAL_P text, NM_USUARIO_P text, IE_UREASE_P text, ALTERACAO_UREASE_P text) FROM PUBLIC;

