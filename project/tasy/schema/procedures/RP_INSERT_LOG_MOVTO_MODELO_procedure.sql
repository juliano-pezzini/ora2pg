-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE rp_insert_log_movto_modelo ( nr_seq_modelo_p bigint, nm_usuario_p text) AS $body$
DECLARE


qt_vagas_restantes_w	bigint;
qt_lista_espera_w	bigint;


BEGIN

if (nr_seq_modelo_p IS NOT NULL AND nr_seq_modelo_p::text <> '') then

	qt_vagas_restantes_w	:= Rp_obter_qtd_vaga_restante(nr_seq_modelo_p);
	qt_lista_espera_w	:= rp_obter_lista_espera_modelo(nr_seq_modelo_p);

	insert into rp_log_movto_modelo(
		NR_SEQUENCIA,
		NR_SEQ_MODELO,
		DT_ATUALIZACAO,
		NM_USUARIO,
		DT_ATUALIZACAO_NREC,
		NM_USUARIO_NREC,
		DT_LOG,
		QT_VAGAS_RESTANTES,
		QT_LISTA_ESPERA        )
	values (	nextval('rp_log_movto_modelo_seq'),
		nr_seq_modelo_p,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		qt_vagas_restantes_w,
		qt_lista_espera_w);
end if;


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE rp_insert_log_movto_modelo ( nr_seq_modelo_p bigint, nm_usuario_p text) FROM PUBLIC;

