-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_inserir_log_atendimento ( ds_mensagem_p text, ie_tipo_obervacao_p bigint, nr_seq_atendimento_p bigint, nm_usuario_p text) AS $body$
DECLARE


ds_observacao_w			varchar(4000) := '';
cd_estabelecimento_w bigint:= wheb_usuario_pck.get_cd_estabelecimento;


BEGIN

/* O parametro ie_tipo_obervacao_p. sera tratado por numeros, que iram identificar qual o tipo log e determinar qual sera a observacao gravada junto ao log. */


/*Cuidado, ao colocar sempre um novo numero,  verificar sempre se o mesmo ja existe. E caso desativar um tipo, apenas comente o if do tipo e nao utilize um numero que estiver comentado*/

begin
	if (ie_tipo_obervacao_p = 1) then
		ds_observacao_w := 'XML de resposta informando que ocorreu algum erro e sem resposta esperada.';
	elsif (ie_tipo_obervacao_p = 2) then
		ds_observacao_w := 'XML de resposta informando que existe uma nova chamada para o ramal.';
	elsif (ie_tipo_obervacao_p = 3) then
		ds_observacao_w := 'XML de resposta informando que a chamada foi atendida pelo operador.';
	elsif (ie_tipo_obervacao_p = 4) then
		ds_observacao_w := 'XML de resposta informando que a chamada foi encerrada pelo operador.';
	elsif (ie_tipo_obervacao_p = 5) then
		ds_observacao_w := 'XML de resposta informando que a chamada foi tranferida para outro ramal.';
	elsif (ie_tipo_obervacao_p = 6) then
		ds_observacao_w := 'XML de resposta temporaria para saber o status do ramal no servidor.';
	elsif (ie_tipo_obervacao_p = 7) then
		ds_observacao_w := 'XML de resposta informando ao sistema o status do ramal no servidor.';
	elsif (ie_tipo_obervacao_p = 8) then
		ds_observacao_w := 'XML de resposta informando que o ramal foi logado corretamente no sistema.';
	elsif (ie_tipo_obervacao_p = 9) then
		ds_observacao_w := 'XML de resposta informando que o ramal foi retirado da pausa no servidor.';
	elsif (ie_tipo_obervacao_p = 10) then
		ds_observacao_w := 'XML de resposta informando que o ramal foi deslogado do servidor.';
	elsif (ie_tipo_obervacao_p = 11) then
		ds_observacao_w := 'XML de resposta informando que o ramal foi colocado em pausa no servidor.';
	elsif (ie_tipo_obervacao_p = 12) then
		ds_observacao_w := 'Log gerado dentro da rotina pls_gravar_voz_atendimento, chamada depois do sistema receber o xml de LIGACAO_ENCERRADA.';
	elsif (ie_tipo_obervacao_p = 13) then
		ds_observacao_w := 'Log gerado depois de receber o xml de LIGACAO_ENCERRADA e antes de chamar a rotina pls_gravar_voz_atendimento.';
	elsif (ie_tipo_obervacao_p = 14) then
		ds_observacao_w := 'Log gerado dentro da "novaLigacao"';
	elsif (ie_tipo_obervacao_p = 15) then
		ds_observacao_w := 'Log gerado dentro da "chamadaAtendida"';
	elsif (ie_tipo_obervacao_p = 16) then
		ds_observacao_w := 'Log gerado dentro da "ligacaoTranferida"';
	elsif (ie_tipo_obervacao_p = 17) then
		ds_observacao_w := 'Log gerado dentro da "statusAlterado"';
	elsif (ie_tipo_obervacao_p = 18) then
		ds_observacao_w := 'Log gerado dentro da "grava_arquivo_voz"';
	end if;

	insert into
                pls_log_call_center(nr_sequencia, dt_atualizacao, nm_usuario,
                dt_atualizacao_nrec, nm_usuario_nrec, nr_seq_atendimento,
                dt_mensagem, ds_mensagem, ds_observacao, cd_estabelecimento)
        values (nextval('pls_log_call_center_seq'), clock_timestamp(), nm_usuario_p,
                clock_timestamp(), nm_usuario_p ,nr_seq_atendimento_p,
                clock_timestamp(), ds_mensagem_p, ds_observacao_w, cd_estabelecimento_w);
		
	commit;
exception
when others then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(1184283,'NR_SEQ_ATENDIMENTO=' || nr_seq_atendimento_p || chr(13) || chr(10) || sqlerrm);
end;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_inserir_log_atendimento ( ds_mensagem_p text, ie_tipo_obervacao_p bigint, nr_seq_atendimento_p bigint, nm_usuario_p text) FROM PUBLIC;

