-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE cpoe_inserir_material_fav (nr_atendimento_p cpoe_material.nr_atendimento%type, cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%type, nr_sequencia_p cpoe_fav_material.nr_sequencia%type, nm_usuario_p cpoe_fav_material.nm_usuario%type, cd_perfil_p bigint, cd_estabelecimento_p bigint, nr_seq_item_gerado_p INOUT bigint, nr_seq_transcricao_p bigint default null, ie_item_alta_p text default 'N', ie_prescritor_aux_p text default 'N', cd_medico_p bigint default null, ie_retrogrado_p text default 'N', dt_inicio_p timestamp default null, nr_seq_pepo_p bigint default null, nr_cirurgia_p bigint default null, nr_cirurgia_patologia_p bigint default null, nr_seq_agenda_p bigint default null, ie_oncologia_p text default 'N', nr_seq_conclusao_apae_p bigint default null, ie_futuro_p text default 'N', nr_seq_cpoe_rp_p cpoe_rp.nr_sequencia%type default null, nr_seq_cpoe_order_unit_p cpoe_order_unit.nr_sequencia%type default null) AS $body$
DECLARE


  cd_amostra_cih_w               cpoe_fav_material.cd_amostra_cih%type;
  cd_intervalo_w                    cpoe_fav_material.cd_intervalo%type;
  cd_intervalo_agora_w         cpoe_fav_material.cd_intervalo%type;
  cd_mat_comp1_w               cpoe_fav_material.cd_mat_comp1%type;
  cd_mat_comp2_w               cpoe_fav_material.cd_mat_comp2%type;
  cd_mat_comp3_w               cpoe_fav_material.cd_mat_comp3%type;
  cd_mat_comp4_w               cpoe_fav_material.cd_mat_comp4%type;
  cd_mat_comp5_w               cpoe_fav_material.cd_mat_comp5%type;
  cd_mat_comp6_w               cpoe_fav_material.cd_mat_comp6%type;
  cd_mat_comp7_w               cpoe_fav_material.cd_mat_comp7%type;
  cd_mat_dil_w                      cpoe_fav_material.cd_mat_dil%type;
  cd_material_w                     cpoe_fav_material.cd_material%type;
  cd_mat_recons_w               cpoe_fav_material.cd_mat_recons%type;
  cd_mat_red_w                    cpoe_fav_material.cd_mat_red%type;
  cd_mat_soluc1_w              cpoe_fav_material.cd_mat_soluc1%type;
  cd_mat_soluc2_w              cpoe_fav_material.cd_mat_soluc2%type;
  cd_mat_soluc3_w              cpoe_fav_material.cd_mat_soluc3%type;
  cd_mat_soluc4_w              cpoe_fav_material.cd_mat_soluc4%type;
  cd_mat_soluc5_w              cpoe_fav_material.cd_mat_soluc5%type;
  cd_microorganismo_cih_w      cpoe_fav_material.cd_microorganismo_cih%type;
  cd_topografia_cih_w          cpoe_fav_material.cd_topografia_cih%type;
  cd_unidade_medida_w          cpoe_fav_material.cd_unidade_medida%type;
  cd_unid_med_dose_comp1_w     cpoe_fav_material.cd_unid_med_dose_comp1%type;
  cd_unid_med_dose_comp2_w     cpoe_fav_material.cd_unid_med_dose_comp2%type;
  cd_unid_med_dose_comp3_w     cpoe_fav_material.cd_unid_med_dose_comp3%type;
  cd_unid_med_dose_comp4_w     cpoe_fav_material.cd_unid_med_dose_comp4%type;
  cd_unid_med_dose_comp5_w     cpoe_fav_material.cd_unid_med_dose_comp5%type;
  cd_unid_med_dose_comp6_w     cpoe_fav_material.cd_unid_med_dose_comp6%type;
  cd_unid_med_dose_dil_w       cpoe_fav_material.cd_unid_med_dose_dil%type;
  cd_unid_med_dose_recons_w    cpoe_fav_material.cd_unid_med_dose_recons%type;
  cd_unid_med_dose_red_w       cpoe_fav_material.cd_unid_med_dose_red%type;
  cd_unid_med_dose_sol1_w      cpoe_fav_material.cd_unid_med_dose_sol1%type;
  cd_unid_med_dose_sol2_w      cpoe_fav_material.cd_unid_med_dose_sol2%type;
  cd_unid_med_dose_sol3_w      cpoe_fav_material.cd_unid_med_dose_sol3%type;
  cd_unid_med_dose_sol4_w      cpoe_fav_material.cd_unid_med_dose_sol4%type;
  cd_unid_med_dose_sol5_w      cpoe_fav_material.cd_unid_med_dose_sol5%type;
  ds_dose_diferenciada_w       cpoe_fav_material.ds_dose_diferenciada%type;
  ds_observacao_w              cpoe_fav_material.ds_observacao%type;
  ds_orientacao_preparo_w      cpoe_fav_material.ds_orientacao_preparo%type;
  ds_solucao_w                 cpoe_fav_material.ds_solucao%type;
  hr_min_aplicacao_w           cpoe_fav_material.hr_min_aplicacao%type;
  ie_acm_w                     cpoe_fav_material.ie_acm%type;
  ie_administracao_w           cpoe_fav_material.ie_administracao%type;
  ie_antibiotico_w             cpoe_fav_material.ie_antibiotico%type;
  ie_aplic_bolus_w             cpoe_fav_material.ie_aplic_bolus%type;
  ie_aplic_lenta_w             cpoe_fav_material.ie_aplic_lenta%type;
  ie_bomba_infusao_w           cpoe_fav_material.ie_bomba_infusao%type;
  ie_controle_tempo_w          cpoe_fav_material.ie_controle_tempo%type;
  ie_duracao_w                 cpoe_fav_material.ie_duracao%type;
  ie_evento_unico_w            cpoe_fav_material.ie_evento_unico%type;
  ie_fator_correcao_w          cpoe_fav_material.ie_fator_correcao%type;
  ie_indicacao_w               cpoe_fav_material.ie_indicacao%type;
  ie_lado_w                    cpoe_fav_material.ie_lado%type;
  ie_medicacao_paciente_w      cpoe_fav_material.ie_medicacao_paciente%type;
  ie_objetivo_w                cpoe_fav_material.ie_objetivo%type;
  ie_origem_infeccao_w         cpoe_fav_material.ie_origem_infeccao%type;
  ie_pca_modo_prog_w           cpoe_fav_material.ie_pca_modo_prog%type;
  ie_ref_calculo_w             cpoe_fav_material.ie_ref_calculo%type;
  ie_se_necessario_w           cpoe_fav_material.ie_se_necessario%type;
  ie_solucao_w                 cpoe_fav_material.ie_solucao%type;
  ie_tipo_analgesia_w          cpoe_fav_material.ie_tipo_analgesia%type;
  ie_tipo_dosagem_w            cpoe_fav_material.ie_tipo_dosagem%type;
  ie_tipo_registro_w           cpoe_fav_material.ie_tipo_registro%type;
  ie_tipo_solucao_w            cpoe_fav_material.ie_tipo_solucao%type;
  ie_um_bolus_pca_w            cpoe_fav_material.ie_um_bolus_pca%type;
  ie_um_dose_inicio_pca_w      cpoe_fav_material.ie_um_dose_inicio_pca%type;
  ie_um_fluxo_pca_w            cpoe_fav_material.ie_um_fluxo_pca%type;
  ie_um_limite_hora_pca_w      cpoe_fav_material.ie_um_limite_hora_pca%type;
  ie_um_limite_pca_w           cpoe_fav_material.ie_um_limite_pca%type;
  ie_urgencia_w                cpoe_fav_material.ie_urgencia%type;
  ie_uso_antimicrobiano_w      cpoe_fav_material.ie_uso_antimicrobiano%type;
  ie_via_aplicacao_w           cpoe_fav_material.ie_via_aplicacao%type;
  nr_dia_util_w                cpoe_fav_material.nr_dia_util%type;
  nr_etapas_w                  cpoe_fav_material.nr_etapas%type;
  nr_ocorrencia_w              cpoe_fav_material.nr_ocorrencia%type;
  nr_seq_mat_diluicao_w        cpoe_fav_material.nr_seq_mat_diluicao%type;
  nr_seq_mat_reconst_w         cpoe_fav_material.nr_seq_mat_reconst%type;
  nr_seq_mat_rediluicao_w      cpoe_fav_material.nr_seq_mat_rediluicao%type;
  qt_bolus_pca_w               cpoe_fav_material.qt_bolus_pca%type;
  qt_dias_liberado_w           cpoe_fav_material.qt_dias_liberado%type;
  qt_dias_solicitado_w         cpoe_fav_material.qt_dias_solicitado%type;
  qt_dosagem_w                 cpoe_fav_material.qt_dosagem%type;
  qt_dose_w                    cpoe_fav_material.qt_dose%type;
  qt_dose_ref_w                cpoe_material.qt_dose%type;
  qt_dose_dia_w                cpoe_material.qt_dose_dia%type;
  qt_dose_ataque_w             cpoe_fav_material.qt_dose_ataque%type;
  qt_dose_comp1_w              cpoe_fav_material.qt_dose_comp1%type;
  qt_dose_comp2_w              cpoe_fav_material.qt_dose_comp2%type;
  qt_dose_comp3_w              cpoe_fav_material.qt_dose_comp3%type;
  qt_dose_comp4_w              cpoe_fav_material.qt_dose_comp4%type;
  qt_dose_comp5_w              cpoe_fav_material.qt_dose_comp5%type;
  qt_dose_comp6_w              cpoe_fav_material.qt_dose_comp6%type;
  qt_dose_correcao1_w          cpoe_fav_material.qt_dose_correcao1%type;
  qt_dose_correcao2_w          cpoe_fav_material.qt_dose_correcao2%type;
  qt_dose_correcao3_w          cpoe_fav_material.qt_dose_correcao3%type;
  qt_dose_correcao4_w          cpoe_fav_material.qt_dose_correcao4%type;
  qt_dose_correcao5_w          cpoe_fav_material.qt_dose_correcao5%type;
  qt_dose_dil_w                cpoe_fav_material.qt_dose_dil%type;
  qt_dose_inicial_pca_w        cpoe_fav_material.qt_dose_inicial_pca%type;
  qt_dose_recons_w             cpoe_fav_material.qt_dose_recons%type;
  qt_dose_red_w                cpoe_fav_material.qt_dose_red%type;
  qt_dose_soluc1_w             cpoe_fav_material.qt_dose_soluc1%type;
  qt_dose_soluc2_w             cpoe_fav_material.qt_dose_soluc2%type;
  qt_dose_soluc3_w             cpoe_fav_material.qt_dose_soluc3%type;
  qt_dose_soluc4_w             cpoe_fav_material.qt_dose_soluc4%type;
  qt_dose_soluc5_w             cpoe_fav_material.qt_dose_soluc5%type;
  qt_hora_aplicacao_w          cpoe_fav_material.qt_hora_aplicacao%type;
  qt_hora_fase_w               cpoe_fav_material.qt_hora_fase%type;
  qt_intervalo_bloqueio_w      cpoe_fav_material.qt_intervalo_bloqueio%type;
  qt_limite_quatro_hora_w      cpoe_fav_material.qt_limite_quatro_hora%type;
  qt_limite_uma_hora_w         cpoe_fav_material.qt_limite_uma_hora%type;
  qt_min_aplicacao_w           cpoe_fav_material.qt_min_aplicacao%type;
  qt_min_aplic_dose_ataque_w   cpoe_fav_material.qt_min_aplic_dose_ataque%type;
  qt_solucao_w                 cpoe_fav_material.qt_solucao%type;
  qt_solucao_dil_w             cpoe_fav_material.qt_solucao_dil%type;
  qt_solucao_red_w             cpoe_fav_material.qt_solucao_red%type;
  qt_solucao_total_w           cpoe_fav_material.qt_solucao_total%type;
  qt_tempo_aplicacao_w         cpoe_fav_material.qt_tempo_aplicacao%type;
  qt_total_dias_lib_w          cpoe_fav_material.qt_total_dias_lib%type;
  qt_vol_adic_reconst_w        cpoe_fav_material.qt_vol_adic_reconst%type;
  qt_vol_infusao_pca_w         cpoe_fav_material.qt_vol_infusao_pca%type;
  qt_volume_w                  cpoe_fav_material.qt_volume%type;
  ds_dose_diferenciada_comp1_w cpoe_fav_material.ds_dose_diferenciada_comp1%type;
  ds_dose_diferenciada_comp2_w cpoe_fav_material.ds_dose_diferenciada_comp2%type;
  ds_dose_diferenciada_comp3_w cpoe_fav_material.ds_dose_diferenciada_comp3%type;
  ds_dose_diferenciada_comp4_w cpoe_fav_material.ds_dose_diferenciada_comp4%type;
  ds_dose_diferenciada_comp5_w cpoe_fav_material.ds_dose_diferenciada_comp5%type;
  ds_dose_diferenciada_comp6_w cpoe_fav_material.ds_dose_diferenciada_comp6%type;
  ds_dose_diferenciada_dil_w   cpoe_fav_material.ds_dose_diferenciada_dil%type;
  ds_dose_diferenciada_rec_w   cpoe_fav_material.ds_dose_diferenciada_rec%type;
  ds_dose_diferenciada_red_w   cpoe_fav_material.ds_dose_diferenciada_red%type;
  qt_dosagem_diferenciada_w    cpoe_fav_material.qt_dosagem_diferenciada%type;
  qt_dose_correcao6_w cpoe_fav_material.qt_dose_correcao6%type;
  qt_dose_correcao7_w cpoe_fav_material.qt_dose_correcao7%type;
  qt_dose_correcao8_w cpoe_fav_material.qt_dose_correcao8%type;
  qt_vol_dil_corrigido_w  cpoe_fav_material.qt_vol_dil_corrigido%type;
  qt_vol_red_corrigido_w  cpoe_fav_material.qt_vol_red_corrigido%type;
  qt_vol_rec_corrigido_w  cpoe_fav_material.qt_vol_rec_corrigido%type;
  qt_final_concentration_w  cpoe_material.qt_final_concentration%type;
  ie_um_final_conc_pca_w    cpoe_material.ie_um_final_conc_pca%type;


  ie_material_w cpoe_fav_material.ie_material%type;
  ie_segunda_w  cpoe_fav_material.ie_segunda%type;
  ie_terca_w    cpoe_fav_material.ie_terca%type;
  ie_quarta_w   cpoe_fav_material.ie_quarta%type;
  ie_quinta_w   cpoe_fav_material.ie_quinta%type;
  ie_sexta_w    cpoe_fav_material.ie_sexta%type;
  ie_sabado_w   cpoe_fav_material.ie_sabado%type;
  ie_domingo_w  cpoe_fav_material.ie_domingo%type;

  nr_sequencia_w        			cpoe_material.nr_sequencia%type;
  ds_horarios_w         			cpoe_material.ds_horarios%type;
  ds_horarios_aux_w     			cpoe_material.ds_horarios%type;
  hr_prim_horario_w     			cpoe_material.hr_prim_horario%type;
  dt_inicio_w           			cpoe_material.dt_inicio%type;
  dt_fim_w              			cpoe_material.dt_fim%type;
  dt_primeiro_horario_w 			cpoe_material.dt_inicio%type;
  ds_ref_calculo_w                  cpoe_material.ds_ref_calculo%type;
  ie_dose_ataque_w                  cpoe_material.ie_dose_ataque%type;
  ie_paciente_comp1_w               cpoe_material.ie_paciente_comp1%type;
  ie_paciente_comp2_w               cpoe_material.ie_paciente_comp2%type;
  ie_paciente_comp3_w               cpoe_material.ie_paciente_comp3%type;
  ie_paciente_comp4_w               cpoe_material.ie_paciente_comp4%type;
  ie_paciente_comp5_w               cpoe_material.ie_paciente_comp5%type;
  ie_paciente_comp6_w               cpoe_material.ie_paciente_comp6%type;
  qt_hora_fase_diferenciada_w       cpoe_material.qt_hora_fase_diferenciada%type;

  ie_sol_continua_w      varchar(1);
  ie_tipo_item_w         varchar(1);
  ie_prescr_alta_agora_w varchar(1);
  ie_use_item_types_w    varchar(1);

  qt_min_intervalo_w   intervalo_prescricao.qt_min_intervalo%type;
  ie_dose_unica_cpoe_w intervalo_prescricao.ie_dose_unica_cpoe%type;
  ie_copiar_w          intervalo_prescricao.ie_copiar%type;
  cd_material_ret_w   material.cd_material%type;

  nr_dia_util_aux_w   cpoe_material.nr_dia_util%type;
  ie_tratamento_vig_w varchar(10);
  tipo_material_w   bigint;
  ie_drug_info_w    cpoe_order_unit.ie_drug_info%type := null;

  ie_via_aplicacao_rp_w             cpoe_rp.ie_via_aplicacao%type := null;
  nr_seq_grupo_interval_rp_w        cpoe_rp.nr_seq_grupo_interval%type := null;
  nr_seq_subgrupo_interval_rp_w     cpoe_rp.nr_seq_subgrupo_interval%type := null;
  cd_intervalo_rp_w                 cpoe_rp.cd_intervalo%type := null;
  dt_inicio_rp_w                    cpoe_rp.dt_inicio%type := null;
  dt_fim_rp_w                       cpoe_rp.dt_fim%type := null;
  ds_horarios_rp_w                  cpoe_rp.ds_horarios%type := null;
  ie_segunda_rp_w                   cpoe_rp.ie_segunda%type := null;
  ie_terca_rp_w                     cpoe_rp.ie_terca%type := null;
  ie_quarta_rp_w                    cpoe_rp.ie_quarta%type := null;
  ie_quinta_rp_w                    cpoe_rp.ie_quinta%type := null;
  ie_sexta_rp_w                     cpoe_rp.ie_sexta%type := null;
  ie_sabado_rp_w                    cpoe_rp.ie_sabado%type := null;
  ie_domingo_rp_w                   cpoe_rp.ie_domingo%type := null;
  ie_duracao_rp_w                   protocolo_medic_material.ie_duracao%type := null;
  ds_volume_diferenciado_w			    cpoe_material.ds_volume_diferenciado%type;

  ie_urgencia_rp_w                  cpoe_rp.ie_urgencia%type := null;
  ie_administracao_rp_w             cpoe_rp.ie_administracao%type := null;
  qt_solucao_total_rp_w             cpoe_rp.qt_solucao_total%type := null;
  qt_volume_rp_w                    cpoe_rp.qt_volume%type := null;
  ie_tipo_analgesia_rp_w            cpoe_rp.ie_tipo_analgesia%type := null;
  ie_pca_modo_prog_rp_w             cpoe_rp.ie_pca_modo_prog%type := null;
  qt_dose_inicial_pca_rp_w          cpoe_rp.qt_dose_inicial_pca%type := null;
  ie_um_dose_inicio_pca_rp_w        cpoe_rp.ie_um_dose_inicio_pca%type := null;
  ie_um_fluxo_pca_rp_w              cpoe_rp.ie_um_fluxo_pca%type := null;
  qt_vol_infusao_pca_rp_w           cpoe_rp.qt_vol_infusao_pca%type := null;
  qt_bolus_pca_rp_w                 cpoe_rp.qt_bolus_pca%type := null;
  ie_um_bolus_pca_rp_w              cpoe_rp.ie_um_bolus_pca%type := null;
  qt_intervalo_bloqueio_rp_w        cpoe_rp.qt_intervalo_bloqueio%type := null;
  qt_limite_quatro_hora_rp_w        cpoe_rp.qt_limite_quatro_hora%type := null;
  ie_um_limite_pca_rp_w             cpoe_rp.ie_um_limite_pca%type := null;
  qt_limite_uma_hora_rp_w           cpoe_rp.qt_limite_uma_hora%type := null;
  ie_um_limite_hora_pca_rp_w        cpoe_rp.ie_um_limite_hora_pca%type := null;
  si_rapid_infusion_rp_w            cpoe_rp.si_rapid_infusion%type := null;
  qt_final_concentration_rp_w       cpoe_rp.qt_final_concentration%type := null;
  ie_incrementar_rp_w               cpoe_rp.ie_incrementar%type := null;
  ie_tipo_dosagem_inc_rp_w          cpoe_rp.ie_tipo_dosagem_inc%type := null;
  ie_um_final_conc_pca_rp_w         cpoe_rp.ie_um_final_conc_pca%type := null;
  qt_dosagem_inc_rp_w               cpoe_rp.qt_dosagem_inc%type := null;
  ie_fator_correcao_rp_w            cpoe_rp.ie_fator_correcao%type := null;
  qt_dose_terapeutica_rp_w          cpoe_rp.qt_dose_terapeutica%type := null;
  cd_unid_medida_ori_w              material_conversao_unidade.cd_unidade_medida%type;

  c01 CURSOR FOR
    SELECT cd_amostra_cih,
           cd_intervalo,
           cd_mat_comp1,
           cd_mat_comp2,
           cd_mat_comp3,
           cd_mat_comp4,
           cd_mat_comp5,
           cd_mat_comp6,
           cd_mat_comp7,
           cd_mat_dil,
           cd_material,
           cd_mat_recons,
           cd_mat_red,
           cd_mat_soluc1,
           cd_mat_soluc2,
           cd_mat_soluc3,
           cd_mat_soluc4,
           cd_mat_soluc5,
           cd_microorganismo_cih,
           cd_topografia_cih,
           cd_unidade_medida,
           cd_unid_med_dose_comp1,
           cd_unid_med_dose_comp2,
           cd_unid_med_dose_comp3,
           cd_unid_med_dose_comp4,
           cd_unid_med_dose_comp5,
           cd_unid_med_dose_comp6,
           cd_unid_med_dose_dil,
           cd_unid_med_dose_recons,
           cd_unid_med_dose_red,
           cd_unid_med_dose_sol1,
           cd_unid_med_dose_sol2,
           cd_unid_med_dose_sol3,
           cd_unid_med_dose_sol4,
           cd_unid_med_dose_sol5,
           ds_dose_diferenciada,
           ds_observacao,
           ds_orientacao_preparo,
           ds_solucao,
           hr_min_aplicacao,
           ie_acm,
           ie_administracao,
           ie_aplic_bolus,
           ie_aplic_lenta,
           ie_bomba_infusao,
           ie_controle_tempo,
           ie_duracao,
           ie_evento_unico,
           coalesce(ie_fator_correcao, 'N'),
           ie_indicacao,
           ie_lado,
           ie_medicacao_paciente,
           ie_objetivo,
           ie_origem_infeccao,
           ie_pca_modo_prog,
           ie_ref_calculo,
           ie_se_necessario,
           ie_solucao,
           ie_tipo_analgesia,
           ie_tipo_dosagem,
           ie_tipo_registro,
           ie_tipo_solucao,
           ie_um_bolus_pca,
           ie_um_dose_inicio_pca,
           ie_um_fluxo_pca,
           ie_um_limite_hora_pca,
           ie_um_limite_pca,
           ie_urgencia,
           ie_uso_antimicrobiano,
           ie_via_aplicacao,
           nr_dia_util,
           nr_etapas,
           nr_ocorrencia,
           nr_seq_mat_diluicao,
           nr_seq_mat_reconst,
           nr_seq_mat_rediluicao,
           qt_bolus_pca,
           qt_dias_liberado,
           qt_dias_solicitado,
           qt_dosagem,
           qt_dose,
           qt_dose_ataque,
           qt_dose_comp1,
           qt_dose_comp2,
           qt_dose_comp3,
           qt_dose_comp4,
           qt_dose_comp5,
           qt_dose_comp6,
           qt_dose_correcao1,
           qt_dose_correcao2,
           qt_dose_correcao3,
           qt_dose_correcao4,
           qt_dose_correcao5,
           qt_dose_dil,
           qt_dose_inicial_pca,
           qt_dose_recons,
           qt_dose_red,
           qt_dose_soluc1,
           qt_dose_soluc2,
           qt_dose_soluc3,
           qt_dose_soluc4,
           qt_dose_soluc5,
           qt_hora_aplicacao,
           qt_hora_fase,
           qt_intervalo_bloqueio,
           qt_limite_quatro_hora,
           qt_limite_uma_hora,
           qt_min_aplicacao,
           qt_min_aplic_dose_ataque,
           qt_solucao,
           qt_solucao_dil,
           qt_solucao_red,
           qt_solucao_total,
           qt_tempo_aplicacao,
           qt_vol_adic_reconst,
           qt_vol_infusao_pca,
           qt_volume,
           ds_dose_diferenciada_comp1,
           ds_dose_diferenciada_comp2,
           ds_dose_diferenciada_comp3,
           ds_dose_diferenciada_comp4,
           ds_dose_diferenciada_comp5,
           ds_dose_diferenciada_comp6,
           ds_dose_diferenciada_dil,
           ds_dose_diferenciada_rec,
           ds_dose_diferenciada_red,
           qt_dosagem_diferenciada,
           ie_material,
           ie_segunda,
           ie_terca,
           ie_quarta,
           ie_quinta,
           ie_sexta,
           ie_sabado,
           ie_domingo,
		   qt_dose_correcao6,
           qt_dose_correcao7,
           qt_dose_correcao8,
           qt_vol_dil_corrigido,
           qt_vol_red_corrigido,
           qt_vol_rec_corrigido,
           qt_final_concentration,
           ie_um_final_conc_pca,
           ds_volume_diferenciado,
           ds_ref_calculo,
           ie_dose_ataque,
           ie_paciente_comp1,
           ie_paciente_comp2,
           ie_paciente_comp3,
           ie_paciente_comp4,
           ie_paciente_comp5,
           ie_paciente_comp6,
           qt_hora_fase_diferenciada
      from cpoe_fav_material
     where nr_sequencia = nr_sequencia_p;


BEGIN

ie_prescr_alta_agora_w := obter_param_usuario(924, 409, cd_perfil_p, nm_usuario_p, cd_estabelecimento_p, ie_prescr_alta_agora_w);

open C01;
  loop
  fetch c01 INTO
  cd_amostra_cih_w,
  cd_intervalo_w,
  cd_mat_comp1_w,
  cd_mat_comp2_w,
  cd_mat_comp3_w,
  cd_mat_comp4_w,
  cd_mat_comp5_w,
  cd_mat_comp6_w,
  cd_mat_comp7_w,
  cd_mat_dil_w,
  cd_material_w,
  cd_mat_recons_w,
  cd_mat_red_w,
  cd_mat_soluc1_w,
  cd_mat_soluc2_w,
  cd_mat_soluc3_w,
  cd_mat_soluc4_w,
  cd_mat_soluc5_w,
  cd_microorganismo_cih_w,
  cd_topografia_cih_w,
  cd_unidade_medida_w,
  cd_unid_med_dose_comp1_w,
  cd_unid_med_dose_comp2_w,
  cd_unid_med_dose_comp3_w,
  cd_unid_med_dose_comp4_w,
  cd_unid_med_dose_comp5_w,
  cd_unid_med_dose_comp6_w,
  cd_unid_med_dose_dil_w,
  cd_unid_med_dose_recons_w,
  cd_unid_med_dose_red_w,
  cd_unid_med_dose_sol1_w,
  cd_unid_med_dose_sol2_w,
  cd_unid_med_dose_sol3_w,
  cd_unid_med_dose_sol4_w,
  cd_unid_med_dose_sol5_w,
  ds_dose_diferenciada_w,
  ds_observacao_w,
  ds_orientacao_preparo_w,
  ds_solucao_w,
  hr_min_aplicacao_w,
  ie_acm_w,
  ie_administracao_w,
  ie_aplic_bolus_w,
  ie_aplic_lenta_w,
  ie_bomba_infusao_w,
  ie_controle_tempo_w,
  ie_duracao_w,
  ie_evento_unico_w,
  ie_fator_correcao_w,
  ie_indicacao_w,
  ie_lado_w,
  ie_medicacao_paciente_w,
  ie_objetivo_w,
  ie_origem_infeccao_w,
  ie_pca_modo_prog_w,
  ie_ref_calculo_w,
  ie_se_necessario_w,
  ie_solucao_w,
  ie_tipo_analgesia_w,
  ie_tipo_dosagem_w,
  ie_tipo_registro_w,
  ie_tipo_solucao_w,
  ie_um_bolus_pca_w,
  ie_um_dose_inicio_pca_w,
  ie_um_fluxo_pca_w,
  ie_um_limite_hora_pca_w,
  ie_um_limite_pca_w,
  ie_urgencia_w,
  ie_uso_antimicrobiano_w,
  ie_via_aplicacao_w,
  nr_dia_util_w,
  nr_etapas_w,
  nr_ocorrencia_w,
  nr_seq_mat_diluicao_w,
  nr_seq_mat_reconst_w,
  nr_seq_mat_rediluicao_w,
  qt_bolus_pca_w,
  qt_dias_liberado_w,
  qt_dias_solicitado_w,
  qt_dosagem_w,
  qt_dose_w,
  qt_dose_ataque_w,
  qt_dose_comp1_w,
  qt_dose_comp2_w,
  qt_dose_comp3_w,
  qt_dose_comp4_w,
  qt_dose_comp5_w,
  qt_dose_comp6_w,
  qt_dose_correcao1_w,
  qt_dose_correcao2_w,
  qt_dose_correcao3_w,
  qt_dose_correcao4_w,
  qt_dose_correcao5_w,
  qt_dose_dil_w,
  qt_dose_inicial_pca_w,
  qt_dose_recons_w,
  qt_dose_red_w,
  qt_dose_soluc1_w,
  qt_dose_soluc2_w,
  qt_dose_soluc3_w,
  qt_dose_soluc4_w,
  qt_dose_soluc5_w,
  qt_hora_aplicacao_w,
  qt_hora_fase_w,
  qt_intervalo_bloqueio_w,
  qt_limite_quatro_hora_w,
  qt_limite_uma_hora_w,
  qt_min_aplicacao_w,
  qt_min_aplic_dose_ataque_w,
  qt_solucao_w,
  qt_solucao_dil_w,
  qt_solucao_red_w,
  qt_solucao_total_w,
  qt_tempo_aplicacao_w,
  qt_vol_adic_reconst_w,
  qt_vol_infusao_pca_w,
  qt_volume_w,
  ds_dose_diferenciada_comp1_w,
  ds_dose_diferenciada_comp2_w,
  ds_dose_diferenciada_comp3_w,
  ds_dose_diferenciada_comp4_w,
  ds_dose_diferenciada_comp5_w,
  ds_dose_diferenciada_comp6_w,
  ds_dose_diferenciada_dil_w,
  ds_dose_diferenciada_rec_w,
  ds_dose_diferenciada_red_w,
  qt_dosagem_diferenciada_w,
  ie_material_w,
  ie_segunda_w,
  ie_terca_w,
  ie_quarta_w,
  ie_quinta_w,
  ie_sexta_w,
  ie_sabado_w,
  ie_domingo_w,
  qt_dose_correcao6_w,
  qt_dose_correcao7_w,
  qt_dose_correcao8_w,
  qt_vol_dil_corrigido_w,
  qt_vol_red_corrigido_w,
  qt_vol_rec_corrigido_w,
  qt_final_concentration_w,
  ie_um_final_conc_pca_w,
  ds_volume_diferenciado_w,
  ds_ref_calculo_w,
  ie_dose_ataque_w,
  ie_paciente_comp1_w,
  ie_paciente_comp2_w,
  ie_paciente_comp3_w,
  ie_paciente_comp4_w,
  ie_paciente_comp5_w,
  ie_paciente_comp6_w,
  qt_hora_fase_diferenciada_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
begin

  ie_antibiotico_w := obter_se_mat_ctrl_antibiotico(cd_material_w);

  if (ie_antibiotico_w = 'N' and obter_ctrl_antimicrobiano_mat(cd_material_w) > 0) then
	ie_antibiotico_w := 'S';
  end if;

  tipo_material_w := obter_tipo_material(cd_material_w, 'C');

  if (tipo_material_w = '3') then
    cd_material_ret_w := obter_regra_subst_gen(NULL, nr_atendimento_p, cd_material_w, wheb_usuario_pck.get_cd_estabelecimento);
  else
    cd_material_ret_w := obter_regra_subst_com(NULL,cd_material_w,nr_atendimento_p);
  end if;

  if (coalesce(cd_material_ret_w,0) = 0) then
    cd_material_ret_w := cpoe_substituir_medic_apres(cd_estabelecimento_p, obter_convenio_atendimento(nr_atendimento_p), cd_material_w);
  end if;


  IF (coalesce(cd_material_ret_w, 0) > 0) THEN
    cd_material_w := cd_material_ret_w;
  end if;

  if (coalesce(obter_se_marca_agora(cpoe_obter_setor_atend_prescr(nr_atendimento_p,cd_estabelecimento_p,cd_perfil_p,nm_usuario_p)),
      'N') = 'S') then
    cd_intervalo_agora_w := cpoe_busca_intervalo_agora(nr_atendimento_p,ie_tipo_item_w,cd_estabelecimento_p,cd_perfil_p,nm_usuario_p);

    if (cd_intervalo_agora_w IS NOT NULL AND cd_intervalo_agora_w::text <> '') then
      cd_intervalo_w   := cd_intervalo_agora_w;
      ie_urgencia_w    := '0';
      ie_ref_calculo_w := 'I';
    end if;
  end if;

  select max(qt_min_intervalo),
     coalesce(max(ie_dose_unica_cpoe), 'N'),
     coalesce(max(ie_copiar), 'S')
  into STRICT qt_min_intervalo_w, ie_dose_unica_cpoe_w, ie_copiar_w
  from intervalo_prescricao
  where cd_intervalo = cd_intervalo_w;

  if (coalesce(ie_dose_unica_cpoe_w, 'N') = 'S') then
    ie_administracao_w := 'P';
    ie_duracao_w       := 'P';
    ie_se_necessario_w := 'N';
    ie_acm_w           := 'N';
    ie_evento_unico_w  := 'S';
  end if;

  if ((coalesce(ie_dose_unica_cpoe_w, 'N') = 'S' or coalesce(ie_copiar_w, 'S') = 'N') and
    obter_ctrl_antimicrobiano_mat(cd_material_w) <> 0) then
    qt_dias_solicitado_w := 1;
  end if;

  ds_horarios_w     := '';
  hr_prim_horario_w := '';
  dt_inicio_w       := clock_timestamp();

  ie_tipo_item_w := 'M';

  if (coalesce(ie_prescr_alta_agora_w, 'N') = 'S') and (coalesce(ie_item_alta_p, 'N') = 'S') and (coalesce(ie_dose_unica_cpoe_w, 'N') <> 'S') then

    ie_urgencia_w := 0;

    select max(qt_min_intervalo)
    into STRICT qt_min_intervalo_w
    from intervalo_prescricao
    where cd_intervalo = cd_intervalo_w;

    SELECT * FROM cpoe_calcular_horario_prescr(nr_atendimento_p, cd_intervalo_w, cd_material_w, clock_timestamp(), 0, qt_min_intervalo_w, nr_ocorrencia_w, ds_horarios_w, ds_horarios_aux_w, nm_usuario_p, cd_estabelecimento_p, cd_perfil_p, null) INTO STRICT nr_ocorrencia_w, ds_horarios_w, ds_horarios_aux_w;

    ds_horarios_w := ds_horarios_w || ds_horarios_aux_w;

    hr_prim_horario_w := obter_prim_dshorarios(ds_horarios_w);

    dt_inicio_w := to_date(to_char(clock_timestamp(), 'dd/mm/yyyy ') || hr_prim_horario_w, 'dd/mm/yyyy hh24:mi');

    if (dt_inicio_w < clock_timestamp()) then
      dt_inicio_w := dt_inicio_w + 1;
    end if;

  elsif (coalesce(ie_dose_unica_cpoe_w, 'N') <> 'S') then
    SELECT * FROM cpoe_atualizar_periodo_vig_ant(ds_horarios_w, hr_prim_horario_w, dt_inicio_w) INTO STRICT ds_horarios_w, hr_prim_horario_w, dt_inicio_w;

  end if;

  if (ie_controle_tempo_w = 'S') then
    ie_tipo_item_w := '4';
  end if;

  if (cd_intervalo_w IS NOT NULL AND cd_intervalo_w::text <> '') and (obter_operacao_intervalo(cd_intervalo_w) = 'D') then
    dt_inicio_w := obter_proxima_dose_medic(dt_inicio_w,cd_intervalo_w,null,'N');
    end if;

    hr_prim_horario_w := substr(cpoe_obter_primeiro_horario(nr_atendimento_p, cd_intervalo_w, cd_material_w, cd_estabelecimento_p, cd_perfil_p, nm_usuario_p, cd_pessoa_fisica_p),1, 5);

    if ((coalesce(ie_administracao_w, 'P') = 'P') or (cd_intervalo_agora_w IS NOT NULL AND cd_intervalo_agora_w::text <> '')) then

    if (coalesce(ie_urgencia_w::text, '') = '') then
          dt_inicio_w := trunc(dt_inicio_w, 'hh24') + 1 / 24;

          if (hr_prim_horario_w IS NOT NULL AND hr_prim_horario_w::text <> '') then
            dt_inicio_w := to_date(to_char(dt_inicio_w, 'dd/mm/yyyy ') || hr_prim_horario_w, 'dd/mm/yyyy hh24:mi');
          end if;

  if (dt_inicio_w <= clock_timestamp()) then
    dt_inicio_w := dt_inicio_w + 1;
  end if;

        elsif (ie_urgencia_w = '0') then
          dt_inicio_w := dt_inicio_w + 1 / 1440;
        elsif (ie_urgencia_w = '5') then
          dt_inicio_w := dt_inicio_w + 5 / 1440;
        elsif (ie_urgencia_w = '10') then
          dt_inicio_w := dt_inicio_w + 10 / 1440;
        elsif (ie_urgencia_w = '15') then
          dt_inicio_w := dt_inicio_w + 15 / 1440;
        end if;

        hr_prim_horario_w := to_char(dt_inicio_w, 'hh24:mi');

        if (ie_controle_tempo_w = 'S') then
      nr_ocorrencia_w := nr_etapas_w;

      if (coalesce(ie_dose_unica_cpoe_w, 'N') <> 'S') then
        hr_prim_horario_w := coalesce(Obter_prim_horario_sol_regra(nr_etapas_w, dt_inicio_w, hr_prim_horario_w), to_char(dt_inicio_w, 'hh24:mi'));
      end if;

      dt_primeiro_horario_w := to_date(to_char(dt_inicio_w, 'dd/mm/yyyy ') || hr_prim_horario_w, 'dd/mm/yyyy hh24:mi');

      if ((coalesce(ie_dose_unica_cpoe_w, 'N') <> 'S') and (coalesce(ie_urgencia_w::text, '') = '') and (dt_primeiro_horario_w < dt_inicio_w)) then
        dt_primeiro_horario_w := dt_primeiro_horario_w + 1;
      end if;

      dt_inicio_w := dt_primeiro_horario_w;
      ie_sol_continua_w := 'N';

      if (ie_tipo_solucao_w = 'C') then
        ie_sol_continua_w := 'S';
      end if;

      SELECT * FROM CPOE_Calcula_horarios_etapas(nm_usuario_p, dt_primeiro_horario_w, ie_sol_continua_w, nr_etapas_w, cd_intervalo_w, qt_tempo_aplicacao_w, 0, 0, 'N') INTO STRICT nr_etapas_w, ds_horarios_w;
        else
          nr_ocorrencia_w := 0;
          SELECT * FROM cpoe_calcular_horario_prescr(nr_atendimento_p, cd_intervalo_w, cd_material_w, dt_inicio_w, 0, qt_min_intervalo_w, nr_ocorrencia_w, ds_horarios_w, ds_horarios_aux_w, nm_usuario_p, cd_estabelecimento_p, cd_perfil_p, null) INTO STRICT nr_ocorrencia_w, ds_horarios_w, ds_horarios_aux_w;

          ds_horarios_w := ds_horarios_w || ds_horarios_aux_w;
        end if;

    -- Clear out the text inside the line and adds the sufix of ":00" as needed, fitting it
    ds_horarios_w := REPLACE(Padroniza_horario_prescr(ds_horarios_w,NULL),'A','');

  end if;

  dt_fim_w := null;

  if (coalesce(ie_antibiotico_w, 'N') = 'S') then
    ie_duracao_w := 'P';
  end if;

  if (ie_duracao_w = 'P') then

    if (coalesce(ie_antibiotico_w, 'N') = 'S') then
      dt_fim_w := (dt_inicio_w + coalesce(qt_dias_solicitado_w, 1)) - 1 / 1440;
    else
      dt_fim_w := (dt_inicio_w + 1) - 1 / 1440;
    end if;

  end if;

  if (ie_retrogrado_p = 'S' or ie_futuro_p = 'S') then
    -- retrograde/backward item
    dt_inicio_w := dt_inicio_p;
    dt_fim_w    := (dt_inicio_w + 1) - 1 / 1440;
    ie_urgencia_w := null;
    ds_horarios_w     := '';
    ds_horarios_aux_w     := '';
    nr_ocorrencia_w := 0;
    ie_duracao_w  := 'P';

    select max(qt_min_intervalo)
    into STRICT qt_min_intervalo_w
    from intervalo_prescricao
    where cd_intervalo = cd_intervalo_w;

    SELECT * FROM cpoe_calcular_horario_prescr(nr_atendimento_p, cd_intervalo_w, cd_material_w, dt_inicio_w, 0, qt_min_intervalo_w, nr_ocorrencia_w, ds_horarios_w, ds_horarios_aux_w, nm_usuario_p, cd_estabelecimento_p, cd_perfil_p, null) INTO STRICT nr_ocorrencia_w, ds_horarios_w, ds_horarios_aux_w;

    ds_horarios_w   := ds_horarios_w || ds_horarios_aux_w;
    hr_prim_horario_w := obter_prim_dshorarios(ds_horarios_w);
  end if;

  select nextval('cpoe_material_seq')
  into STRICT nr_sequencia_w
;

  if (coalesce(ie_antibiotico_w, 'N') = 'S') then
    SELECT * FROM cpoe_obter_nr_dias_util_cih(nr_sequencia_w, nr_atendimento_p, cd_pessoa_fisica_p, cd_material_w, dt_inicio_w, dt_fim_w, null, /*dt_fim_cih_w*/
                  null, /*dt_suspensao_w */
                  null, /*dt_lib_suspensao_w */
                  null, /*nr_seq_cpoe_anterior_w */
                  nr_dia_util_aux_w, ie_tratamento_vig_w, qt_total_dias_lib_w) INTO STRICT 
                  nr_dia_util_aux_w, ie_tratamento_vig_w, qt_total_dias_lib_w;
  end if;


      --aqui precisa validar os campos.
      if ((cd_mat_dil_w > 0) and ((coalesce(cd_unid_med_dose_dil_w::text, '') = '') or (cd_unid_med_dose_dil_w = ''))) then
        cd_unid_med_dose_dil_w := obter_unidade_medida_med(cd_mat_dil_w,
                                                           cd_estabelecimento_p);
      end if;

        ie_use_item_types_w := obter_param_usuario(2314, 46, cd_perfil_p, nm_usuario_p, cd_estabelecimento_p, ie_use_item_types_w);
        if (coalesce(ie_use_item_types_w, 'N') = 'S') then
        select ie_drug_info
        into STRICT   ie_drug_info_w
        from   cpoe_order_unit
        where  nr_sequencia = nr_seq_cpoe_order_unit_p;

        if (coalesce(ie_material_w,'N') = 'N')  and (nr_seq_cpoe_rp_p IS NOT NULL AND nr_seq_cpoe_rp_p::text <> '') then

          select
            ie_via_aplicacao
            ,nr_seq_grupo_interval
            ,nr_seq_subgrupo_interval
            ,cd_intervalo
            ,dt_inicio
            ,dt_fim
            ,ds_horarios
            ,ie_segunda
            ,ie_terca
            ,ie_quarta
            ,ie_quinta
            ,ie_sexta
            ,ie_sabado
            ,ie_domingo
            ,ie_urgencia
            ,ie_administracao
            ,qt_solucao_total
            ,qt_volume
            ,ie_tipo_analgesia
            ,ie_pca_modo_prog
            ,qt_dose_inicial_pca
            ,ie_um_dose_inicio_pca
            ,ie_um_fluxo_pca
            ,qt_vol_infusao_pca
            ,qt_bolus_pca
            ,ie_um_bolus_pca
            ,qt_intervalo_bloqueio
            ,qt_limite_quatro_hora
            ,ie_um_limite_pca
            ,qt_limite_uma_hora
            ,ie_um_limite_hora_pca
            ,si_rapid_infusion
            ,qt_final_concentration
            ,ie_incrementar
            ,ie_tipo_dosagem_inc
            ,ie_um_final_conc_pca
            ,qt_dosagem_inc
            ,ie_fator_correcao
            ,qt_dose_terapeutica
          into STRICT
             ie_via_aplicacao_rp_w
            ,nr_seq_grupo_interval_rp_w
            ,nr_seq_subgrupo_interval_rp_w
            ,cd_intervalo_rp_w
            ,dt_inicio_rp_w
            ,dt_fim_rp_w
            ,ds_horarios_rp_w
            ,ie_segunda_rp_w
            ,ie_terca_rp_w
            ,ie_quarta_rp_w
            ,ie_quinta_rp_w
            ,ie_sexta_rp_w
            ,ie_sabado_rp_w
            ,ie_domingo_rp_w
            ,ie_urgencia_rp_w
            ,ie_administracao_rp_w
            ,qt_solucao_total_rp_w
            ,qt_volume_rp_w
            ,ie_tipo_analgesia_rp_w
            ,ie_pca_modo_prog_rp_w
            ,qt_dose_inicial_pca_rp_w
            ,ie_um_dose_inicio_pca_rp_w
            ,ie_um_fluxo_pca_rp_w
            ,qt_vol_infusao_pca_rp_w
            ,qt_bolus_pca_rp_w
            ,ie_um_bolus_pca_rp_w
            ,qt_intervalo_bloqueio_rp_w
            ,qt_limite_quatro_hora_rp_w
            ,ie_um_limite_pca_rp_w
            ,qt_limite_uma_hora_rp_w
            ,ie_um_limite_hora_pca_rp_w
            ,si_rapid_infusion_rp_w
            ,qt_final_concentration_rp_w
            ,ie_incrementar_rp_w
            ,ie_tipo_dosagem_inc_rp_w
            ,ie_um_final_conc_pca_rp_w
            ,qt_dosagem_inc_rp_w
            ,ie_fator_correcao_rp_w
            ,qt_dose_terapeutica_rp_w
          from cpoe_rp
          where  nr_sequencia = nr_seq_cpoe_rp_p;

        end if;

	    ie_duracao_rp_w := 'P';


      end if;
    
      if (obtain_user_locale(nm_usuario_p) = 'ja_JP') then
        qt_dose_ref_w := qt_dose_w;
        SELECT * FROM cpoe_get_dose_or_daily_dose(coalesce(ie_via_aplicacao_rp_w,ie_via_aplicacao_w), coalesce(cd_intervalo_rp_w,cd_intervalo_w), qt_dose_ref_w, qt_dose_dia_w) INTO STRICT qt_dose_ref_w, qt_dose_dia_w;
      end if;

    cd_unid_medida_ori_w := cd_unidade_medida_w;

	if (cd_unidade_medida_w IS NOT NULL AND cd_unidade_medida_w::text <> '') then
		--Validar e atualizar a unidade medida do item caso a mesma nao esteja mais liberada.	
		select coalesce(max(cd_unidade_medida),'XPTO')
		into STRICT	cd_unidade_medida_w
		from unidade_medida_dose_v
		where ie_prioridade  not in (8,9)
		and cd_material = cd_material_w
		and cd_unidade_medida = cd_unidade_medida_w
		AND coalesce(ie_unidade_adm,'S') = 'S'
		and coalesce(ie_permite_prescr,'S') = 'S'
		AND obter_se_unid_consumo(cd_material, cd_estabelecimento_p,ie_prioridade) = 'S';
		
		if (cd_unidade_medida_w = 'XPTO') then
			--buscar o padrao pois nao pode inserir unidade medida null na cpoe_material			
			cd_unidade_medida_w := cpoe_obter_padrao_param_prescr(nr_atendimento_p, cd_material_w,  coalesce(ie_via_aplicacao_rp_w,ie_via_aplicacao_w), 'N', 'U', coalesce(cd_intervalo_rp_w,cd_intervalo_w), 					      cd_estabelecimento_p, cd_perfil_p, nm_usuario_p, cd_pessoa_fisica_p);
            qt_dose_w := obter_dose_convertida(cd_material_w, qt_dose_w, cd_unid_medida_ori_w, cd_unidade_medida_w);
		end if;
	end if;

      insert into cpoe_material(nr_sequencia,
         nr_atendimento,
         cd_pessoa_fisica,
         nm_usuario,
         dt_atualizacao,
         nm_usuario_nrec,
         dt_atualizacao_nrec,
         dt_inicio,
         dt_fim,
         ds_horarios,
         hr_prim_horario,
         cd_amostra_cih,
         cd_intervalo,
         cd_mat_comp1,
         cd_mat_comp2,
         cd_mat_comp3,
         cd_mat_comp4,
         cd_mat_comp5,
         cd_mat_comp6,
         cd_mat_comp7,
         cd_mat_dil,
         cd_material,
         cd_mat_recons,
         cd_mat_red,
         cd_mat_soluc1,
         cd_mat_soluc2,
         cd_mat_soluc3,
         cd_mat_soluc4,
         cd_mat_soluc5,
         cd_microorganismo_cih,
         cd_topografia_cih,
         cd_unidade_medida,
         cd_unid_med_dose_comp1,
         cd_unid_med_dose_comp2,
         cd_unid_med_dose_comp3,
         cd_unid_med_dose_comp4,
         cd_unid_med_dose_comp5,
         cd_unid_med_dose_comp6,
         cd_unid_med_dose_dil,
         cd_unid_med_dose_recons,
         cd_unid_med_dose_red,
         cd_unid_med_dose_sol1,
         cd_unid_med_dose_sol2,
         cd_unid_med_dose_sol3,
         cd_unid_med_dose_sol4,
         cd_unid_med_dose_sol5,
         ds_dose_diferenciada,
         ds_observacao,
         ds_orientacao_preparo,
         ds_solucao,
         hr_min_aplicacao,
         ie_acm,
         ie_administracao,
         ie_antibiotico,
         ie_aplic_bolus,
         ie_aplic_lenta,
         ie_bomba_infusao,
         ie_controle_tempo,
         ie_duracao,
         ie_evento_unico,
         ie_fator_correcao,
         ie_indicacao,
         ie_lado,
         ie_medicacao_paciente,
         ie_objetivo,
         ie_origem_infeccao,
         ie_pca_modo_prog,
         ie_ref_calculo,
         ie_se_necessario,
         ie_solucao,
         ie_tipo_analgesia,
         ie_tipo_dosagem,
         ie_tipo_registro,
         ie_tipo_solucao,
         ie_um_bolus_pca,
         ie_um_dose_inicio_pca,
         ie_um_fluxo_pca,
         ie_um_limite_hora_pca,
         ie_um_limite_pca,
         ie_urgencia,
         ie_uso_antimicrobiano,
         ie_via_aplicacao,
         nr_dia_util,
         nr_etapas,
         nr_ocorrencia,
         nr_seq_mat_diluicao,
         nr_seq_mat_reconst,
         nr_seq_mat_rediluicao,
         qt_bolus_pca,
         qt_dias_solicitado,
         qt_dosagem,
         qt_dose,
         qt_dose_dia,
         qt_dose_ataque,
         qt_dose_comp1,
         qt_dose_comp2,
         qt_dose_comp3,
         qt_dose_comp4,
         qt_dose_comp5,
         qt_dose_comp6,
         qt_dose_correcao1,
         qt_dose_correcao2,
         qt_dose_correcao3,
         qt_dose_correcao4,
         qt_dose_correcao5,
         qt_dose_dil,
         qt_dose_inicial_pca,
         qt_dose_recons,
         qt_dose_red,
         qt_dose_soluc1,
         qt_dose_soluc2,
         qt_dose_soluc3,
         qt_dose_soluc4,
         qt_dose_soluc5,
         qt_hora_aplicacao,
         qt_hora_fase,
         qt_intervalo_bloqueio,
         qt_limite_quatro_hora,
         qt_limite_uma_hora,
         qt_min_aplicacao,
         qt_min_aplic_dose_ataque,
         qt_solucao,
         qt_solucao_dil,
         qt_solucao_red,
         qt_solucao_total,
         qt_tempo_aplicacao,
         qt_total_dias_lib,
         qt_vol_adic_reconst,
         qt_vol_infusao_pca,
         qt_volume,
         cd_perfil_ativo,
         ie_material,
         ds_dose_diferenciada_comp1,
         ds_dose_diferenciada_comp2,
         ds_dose_diferenciada_comp3,
         ds_dose_diferenciada_comp4,
         ds_dose_diferenciada_comp5,
         ds_dose_diferenciada_comp6,
         ds_dose_diferenciada_dil,
         ds_dose_diferenciada_rec,
         ds_dose_diferenciada_red,
         cd_funcao_origem,
         qt_dosagem_diferenciada,
         nr_seq_transcricao,
         ie_item_alta,
         ie_prescritor_aux,
         cd_medico,
         ie_retrogrado,
         nr_seq_pepo,
         nr_cirurgia,
         nr_cirurgia_patologia,
         nr_seq_agenda,
         ie_oncologia,
         nr_seq_conclusao_apae,
         ie_segunda,
         ie_terca,
         ie_quarta,
         ie_quinta,
         ie_sexta,
         ie_sabado,
         ie_domingo,
         ie_futuro,
         qt_dose_correcao6,
         qt_dose_correcao7,
         qt_dose_correcao8,
         qt_vol_dil_corrigido,
         qt_vol_red_corrigido,
         qt_vol_rec_corrigido,
         qt_final_concentration,
         ie_um_final_conc_pca,
         nr_seq_cpoe_rp,
         nr_seq_cpoe_order_unit,
         ie_drug_info,
         nr_seq_grupo_interval,
         nr_seq_subgrupo_interval,
         ds_volume_diferenciado,
         si_rapid_infusion,
         ie_incrementar,
         ie_tipo_dosagem_inc,
         qt_dosagem_inc,
         qt_dose_terapeutica,
         ds_ref_calculo,
         ie_dose_ataque,
         ie_paciente_comp1,
         ie_paciente_comp2,
         ie_paciente_comp3,
         ie_paciente_comp4,
         ie_paciente_comp5,
         ie_paciente_comp6,
         qt_hora_fase_diferenciada
		 )
      values (nr_sequencia_w,
         nr_atendimento_p,
         cd_pessoa_fisica_p,
         nm_usuario_p,
         clock_timestamp(),
         nm_usuario_p,
         clock_timestamp(),
         coalesce(dt_inicio_rp_w, dt_inicio_w),
         coalesce(dt_fim_rp_w,dt_fim_w),
         coalesce(ds_horarios_rp_w,ds_horarios_w),
         hr_prim_horario_w,
         cd_amostra_cih_w,
         coalesce(cd_intervalo_rp_w,cd_intervalo_w),
         cd_mat_comp1_w,
         cd_mat_comp2_w,
         cd_mat_comp3_w,
         cd_mat_comp4_w,
         cd_mat_comp5_w,
         cd_mat_comp6_w,
         cd_mat_comp7_w,
         cd_mat_dil_w,
         cd_material_w,
         cd_mat_recons_w,
         cd_mat_red_w,
         cd_mat_soluc1_w,
         cd_mat_soluc2_w,
         cd_mat_soluc3_w,
         cd_mat_soluc4_w,
         cd_mat_soluc5_w,
         cd_microorganismo_cih_w,
         cd_topografia_cih_w,
         cd_unidade_medida_w,
         cd_unid_med_dose_comp1_w,
         cd_unid_med_dose_comp2_w,
         cd_unid_med_dose_comp3_w,
         cd_unid_med_dose_comp4_w,
         cd_unid_med_dose_comp5_w,
         cd_unid_med_dose_comp6_w,
         cd_unid_med_dose_dil_w,
         cd_unid_med_dose_recons_w,
         cd_unid_med_dose_red_w,
         cd_unid_med_dose_sol1_w,
         cd_unid_med_dose_sol2_w,
         cd_unid_med_dose_sol3_w,
         cd_unid_med_dose_sol4_w,
         cd_unid_med_dose_sol5_w,
         ds_dose_diferenciada_w,
         ds_observacao_w,
         ds_orientacao_preparo_w,
         ds_solucao_w,
         hr_min_aplicacao_w,
         ie_acm_w,
         coalesce(ie_administracao_rp_w,ie_administracao_w),
         ie_antibiotico_w,
         ie_aplic_bolus_w,
         ie_aplic_lenta_w,
         ie_bomba_infusao_w,
         ie_controle_tempo_w,
         coalesce(ie_duracao_rp_w,ie_duracao_w),
         ie_evento_unico_w,
         coalesce(ie_fator_correcao_rp_w,ie_fator_correcao_w),
         ie_indicacao_w,
         ie_lado_w,
         ie_medicacao_paciente_w,
         ie_objetivo_w,
         ie_origem_infeccao_w,
         coalesce(ie_pca_modo_prog_rp_w,ie_pca_modo_prog_w),
         ie_ref_calculo_w,
         ie_se_necessario_w,
         ie_solucao_w,
         coalesce(ie_tipo_analgesia_rp_w,ie_tipo_analgesia_w),
         ie_tipo_dosagem_w,
         ie_tipo_registro_w,
         ie_tipo_solucao_w,
         coalesce(ie_um_bolus_pca_rp_w,ie_um_bolus_pca_w),
         coalesce(ie_um_dose_inicio_pca_rp_w,ie_um_dose_inicio_pca_w),
         coalesce(ie_um_fluxo_pca_rp_w,ie_um_fluxo_pca_w),
         coalesce(ie_um_limite_hora_pca_rp_w,ie_um_limite_hora_pca_w),
         coalesce(ie_um_limite_pca_rp_w,ie_um_limite_pca_w),
         coalesce(ie_urgencia_rp_w,ie_urgencia_w),
         ie_uso_antimicrobiano_w,
	     coalesce(ie_via_aplicacao_rp_w,ie_via_aplicacao_w),
         nr_dia_util_aux_w,
         nr_etapas_w,
         nr_ocorrencia_w,
         nr_seq_mat_diluicao_w,
         nr_seq_mat_reconst_w,
         nr_seq_mat_rediluicao_w,
         coalesce(qt_bolus_pca_rp_w,qt_bolus_pca_w),
         qt_dias_solicitado_w,
         qt_dosagem_w,
         qt_dose_w,
         qt_dose_dia_w,
         qt_dose_ataque_w,
         qt_dose_comp1_w,
         qt_dose_comp2_w,
         qt_dose_comp3_w,
         qt_dose_comp4_w,
         qt_dose_comp5_w,
         qt_dose_comp6_w,
         qt_dose_correcao1_w,
         qt_dose_correcao2_w,
         qt_dose_correcao3_w,
         qt_dose_correcao4_w,
         qt_dose_correcao5_w,
         qt_dose_dil_w,
         coalesce(qt_dose_inicial_pca_rp_w,qt_dose_inicial_pca_w),
         qt_dose_recons_w,
         qt_dose_red_w,
         qt_dose_soluc1_w,
         qt_dose_soluc2_w,
         qt_dose_soluc3_w,
         qt_dose_soluc4_w,
         qt_dose_soluc5_w,
         qt_hora_aplicacao_w,
         qt_hora_fase_w,
         coalesce(qt_intervalo_bloqueio_rp_w,qt_intervalo_bloqueio_w),
         coalesce(qt_limite_quatro_hora_rp_w,qt_limite_quatro_hora_w),
         coalesce(qt_limite_uma_hora_rp_w,qt_limite_uma_hora_w),
         qt_min_aplicacao_w,
         qt_min_aplic_dose_ataque_w,
         qt_solucao_w,
         qt_solucao_dil_w,
         qt_solucao_red_w,
         coalesce(qt_solucao_total_rp_w,qt_solucao_total_w),
         qt_tempo_aplicacao_w,
         qt_total_dias_lib_w,
         qt_vol_adic_reconst_w,
         coalesce(qt_vol_infusao_pca_rp_w,qt_vol_infusao_pca_w),
         coalesce(qt_volume_rp_w,qt_volume_w),
         cd_perfil_p,
         ie_material_w,
         ds_dose_diferenciada_comp1_w,
         ds_dose_diferenciada_comp2_w,
         ds_dose_diferenciada_comp3_w,
         ds_dose_diferenciada_comp4_w,
         ds_dose_diferenciada_comp5_w,
         ds_dose_diferenciada_comp6_w,
         ds_dose_diferenciada_dil_w,
         ds_dose_diferenciada_rec_w,
         ds_dose_diferenciada_red_w,
         2314,
         qt_dosagem_diferenciada_w,
         nr_seq_transcricao_p,
         ie_item_alta_p,
         ie_prescritor_aux_p,
         cd_medico_p,
         ie_retrogrado_p,
         nr_seq_pepo_p,
         nr_cirurgia_p,
         nr_cirurgia_patologia_p,
         nr_seq_agenda_p,
         ie_oncologia_p,
         nr_seq_conclusao_apae_p,
         coalesce(ie_segunda_rp_w, ie_segunda_w),
         coalesce(ie_terca_rp_w ,ie_terca_w),
         coalesce(ie_quarta_rp_w, ie_quarta_w),
         coalesce(ie_quinta_rp_w, ie_quinta_w),
         coalesce(ie_sexta_rp_w, ie_sexta_w),
         coalesce(ie_sabado_rp_w, ie_sabado_w),
         coalesce(ie_domingo_rp_w, ie_domingo_w),
         ie_futuro_p,
         qt_dose_correcao6_w,
         qt_dose_correcao7_w,
         qt_dose_correcao8_w,
         qt_vol_dil_corrigido_w,
         qt_vol_red_corrigido_w,
         qt_vol_rec_corrigido_w,
         coalesce(qt_final_concentration_rp_w,qt_final_concentration_w),
         coalesce(ie_um_final_conc_pca_rp_w,ie_um_final_conc_pca_w),
         nr_seq_cpoe_rp_p,
         nr_seq_cpoe_order_unit_p,
         ie_drug_info_w,
         nr_seq_grupo_interval_rp_w,
         nr_seq_subgrupo_interval_rp_w,
         ds_volume_diferenciado_w,
         si_rapid_infusion_rp_w,
         ie_incrementar_rp_w,
         ie_tipo_dosagem_inc_rp_w,
         qt_dosagem_inc_rp_w,
         qt_dose_terapeutica_rp_w,
         ds_ref_calculo_W,
         ie_dose_ataque_w,
         ie_paciente_comp1_w,
         ie_paciente_comp2_w,
         ie_paciente_comp3_w,
         ie_paciente_comp4_w,
         ie_paciente_comp5_w,
         ie_paciente_comp6_w,
         qt_hora_fase_diferenciada_w
    );

      nr_seq_item_gerado_p := nr_sequencia_w;
    CALL cpoe_consis_med_insert(nr_seq_item_gerado_p,nm_usuario_p);
    end;
  end loop;
  close c01;

  commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_inserir_material_fav (nr_atendimento_p cpoe_material.nr_atendimento%type, cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%type, nr_sequencia_p cpoe_fav_material.nr_sequencia%type, nm_usuario_p cpoe_fav_material.nm_usuario%type, cd_perfil_p bigint, cd_estabelecimento_p bigint, nr_seq_item_gerado_p INOUT bigint, nr_seq_transcricao_p bigint default null, ie_item_alta_p text default 'N', ie_prescritor_aux_p text default 'N', cd_medico_p bigint default null, ie_retrogrado_p text default 'N', dt_inicio_p timestamp default null, nr_seq_pepo_p bigint default null, nr_cirurgia_p bigint default null, nr_cirurgia_patologia_p bigint default null, nr_seq_agenda_p bigint default null, ie_oncologia_p text default 'N', nr_seq_conclusao_apae_p bigint default null, ie_futuro_p text default 'N', nr_seq_cpoe_rp_p cpoe_rp.nr_sequencia%type default null, nr_seq_cpoe_order_unit_p cpoe_order_unit.nr_sequencia%type default null) FROM PUBLIC;

