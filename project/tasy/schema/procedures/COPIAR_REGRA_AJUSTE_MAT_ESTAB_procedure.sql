-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE copiar_regra_ajuste_mat_estab ( nr_sequencia_p bigint, cd_estab_orig_p bigint, cd_estab_dest_p bigint, nm_usuario_p text) AS $body$
DECLARE



nr_seq_regra_ajuste_mat_w	bigint;


BEGIN

if (coalesce(cd_estab_dest_p,0) > 0) then
	select	nextval('regra_ajuste_material_seq')
	into STRICT	nr_seq_regra_ajuste_mat_w
	;
			
	insert into regra_ajuste_material(
		NR_SEQUENCIA,
		CD_ESTABELECIMENTO,                                                                                                                                                                                            
		CD_CONVENIO,                                                                                                                                                                                                   
		DT_INICIO_VIGENCIA,                                                                                                                                                                                            
		IE_SITUACAO,                                                                                                                                                                                                  
		DT_ATUALIZACAO,                                                                                                                                                                                               
		NM_USUARIO,                                                                                                                                                                                                    
		CD_CATEGORIA,                                                                                                                                                                                                  
		CD_GRUPO_MATERIAL,                                                                                                                                                                                             
		CD_SUBGRUPO_MATERIAL,                                                                                                                                                                                          
		CD_CLASSE_MATERIAL,                                                                                                                                                                                            
		CD_MATERIAL,                                                                                                                                                                                                   
		TX_AJUSTE,                                                                                                                                                                                                     
		VL_NEGOCIADO,                                                                                                                                                                                                  
		IE_PRECO_INFORMADO,                                                                                                                                                                                            
		IE_GLOSA,                                                                                                                                                                                                      
		TX_BRASINDICE_PFB,                                                                                                                                                                                             
		TX_BRASINDICE_PMC,                                                                                                                                                                                             
		TX_AFATURAR,                                                                                                                                                                                                   
		DT_FINAL_VIGENCIA,                                                                                                                                                                                             
		CD_TIPO_ACOMODACAO,                                                                                                                                                                                            
		IE_TIPO_ATENDIMENTO,                                                                                                                                                                                           
		CD_SETOR_ATENDIMENTO,                                                                                                                                                                                          
		QT_IDADE_MIN,                                                                                                                                                                                                  
		QT_IDADE_MAX,                                                                                                                                                                                                  
		TX_SIMPRO_PFB,                                                                                                                                                                                                 
		TX_SIMPRO_PMC,                                                                                                                                                                                                
		IE_ORIGEM_PRECO,                                                                                                                                                                                               
		IE_PRECEDENCIA_PRECO,                                                                                                                                                                                          
		PR_GLOSA,                                                                                                                                                                                                      
		IE_TIPO_MATERIAL,                                                                                                                                                                                              
		TX_PMC_NEG,                                                                                                                                                                                                    
		TX_PMC_POS,                                                                                                                                                                                                    
		CD_CID,                                                                                                                                                                                                        
		CD_TABELA_PRECO,                                                                                                                                                                                               
		CD_MOTIVO_EXC_CONTA,                                                                                                                                                                                           
		IE_SEXO,                                                                                                                                                                                                       
		CD_PLANO,                                                                                                                                                                                                      
		CD_PROC_REFERENCIA,                                                                                                                                                                                            
		IE_ORIGEM_PROCED,                                                                                                                                                                                              
		IE_AUTOR_PARTICULAR,                                                                                                                                                                                           
		CD_CONVENIO_GLOSA,                                                                                                                                                                                             
		CD_CATEGORIA_GLOSA,                                                                                                                                                                                            
		IE_KIT_MATERIAL,                                                                                                                                                                                               
		NR_SEQ_PROC_INTERNO,                                                                                                                                                                                           
		CD_KIT_MATERIAL,                                                                                                                                                                                               
		DS_OBSERVACAO,
		IE_DATA_REFERENCIA_VIG,                                                                                                                                                                                        
		IE_ATEND_RETORNO,                                                                                                                                                                                              
		TX_PFB_NEG,                                                                                                                                                                                                    
		TX_PFB_POS,                                                                                                                                                                                                   
		IE_TIPO_KIT,                                                                                                                                                                                                   
		NR_SEQ_FAMILIA,                                                                                                                                                                                                
		CD_TIPO_BAIXA,                                                                                                                                                                                                 
		IE_IGNORA_PRECO_VENDA,                                                                                                                                                                                         
		NR_SEQ_JUST_VALOR_INF,                                                                                                                                                                                         
		NR_SEQ_ESTRUTURA,                                                                                                                                                                                              
		NR_SEQ_ORIGEM,                                                                                                                                                                                                 
		NR_SEQ_COBERTURA,                                                                                                                                                                                              
		IE_IGNORA_DIVISAO_BRAS,                                                                                                                                                                                        
		TX_SIMPRO_POS_PFB,                                                                                                                                                                                             
		TX_SIMPRO_NEG_PFB,                                                                                                                                                                                             
		TX_SIMPRO_POS_PMC,                                                                                                                                                                                             
		TX_SIMPRO_NEG_PMC,                                                                                                                                                                                             
		QT_DIAS_INTER_INICIO,                                                                                                                                                                                          
		QT_DIAS_INTER_FINAL,                                                                                                                                                                                           
		NR_SEQ_REGRA_LANC,                                                                                                                                                                                             
		NR_SEQ_LIB_DIETA_CONV,                                                                                                                                                                                         
		IE_CLINICA,                                                                                                                                                                                                    
		CD_USUARIO_CONVENIO,                                                                                                                                                                                           
		QT_POS_INICIAL,                                                                                                                                                                                                
		QT_POS_FINAL,
		IE_TIPO_PRECO_AUTOR)                                                                                                                                                                                     

	SELECT	nr_seq_regra_ajuste_mat_w,                                                                                                                                                                                                  
		cd_estab_dest_p,                                                                                                                                                                                            
		CD_CONVENIO,                                                                                                                                                                                                   
		DT_INICIO_VIGENCIA,                                                                                                                                                                                            
		IE_SITUACAO,                                                                                                                                                                                                  

		clock_timestamp(),                                                                                                                                                                                               
		nm_usuario_p,                                                                                                                                                                                                    
		CD_CATEGORIA,                                                                                                                                                                                                  
		CD_GRUPO_MATERIAL,                                                                                                                                                                                             
		CD_SUBGRUPO_MATERIAL,                                                                                                                                                                                          
		CD_CLASSE_MATERIAL,                                                                                                                                                                                            
		CD_MATERIAL,                                                                                                                                                                                                   
		TX_AJUSTE,                                                                                                                                                                                                     
		VL_NEGOCIADO,                                                                                                                                                                                                  
		IE_PRECO_INFORMADO,                                                                                                                                                                                            
		IE_GLOSA,                                                                                                                                                                                                      
		TX_BRASINDICE_PFB,                                                                                                                                                                                             
		TX_BRASINDICE_PMC,                                                                                                                                                                                             
		TX_AFATURAR,                                                                                                                                                                                                   
		DT_FINAL_VIGENCIA,                                                                                                                                                                                             
		CD_TIPO_ACOMODACAO,                                                                                                                                                                                            
		IE_TIPO_ATENDIMENTO,                                                                                                                                                                                           
		CD_SETOR_ATENDIMENTO,                                                                                                                                                                                          
		QT_IDADE_MIN,                                                                                                                                                                                                  
		QT_IDADE_MAX,                                                                                                                                                                                                  
		TX_SIMPRO_PFB,                                                                                                                                                                                                 
		TX_SIMPRO_PMC,                                                                                                                                                                                                
		IE_ORIGEM_PRECO,                                                                                                                                                                                               
		IE_PRECEDENCIA_PRECO,                                                                                                                                                                                          
		PR_GLOSA,                                                                                                                                                                                                      
		IE_TIPO_MATERIAL,                                                                                                                                                                                              
		TX_PMC_NEG,                                                                                                                                                                                                    
		TX_PMC_POS,                                                                                                                                                                                                    
		CD_CID,                                                                                                                                                                                                        
		CD_TABELA_PRECO,                                                                                                                                                                                               
		CD_MOTIVO_EXC_CONTA,                                                                                                                                                                                           
		IE_SEXO,                                                                                                                                                                                                       
		CD_PLANO,                                                                                                                                                                                                      
		CD_PROC_REFERENCIA,                                                                                                                                                                                            
		IE_ORIGEM_PROCED,                                                                                                                                                                                              
		IE_AUTOR_PARTICULAR,                                                                                                                                                                                           
		CD_CONVENIO_GLOSA,                                                                                                                                                                                             
		CD_CATEGORIA_GLOSA,                                                                                                                                                                                            
		IE_KIT_MATERIAL,                                                                                                                                                                                               
		NR_SEQ_PROC_INTERNO,                                                                                                                                                                                           
		CD_KIT_MATERIAL,                                                                                                                                                                                               
		DS_OBSERVACAO,
		IE_DATA_REFERENCIA_VIG,                                                                                                                                                                                        
		IE_ATEND_RETORNO,                                                                                                                                                                                              
		TX_PFB_NEG,                                                                                                                                                                                                    
		TX_PFB_POS,                                                                                                                                                                                                   
		IE_TIPO_KIT,                                                                                                                                                                                                   
		NR_SEQ_FAMILIA,                                                                                                                                                                                                
		CD_TIPO_BAIXA,                                                                                                                                                                                                 
		IE_IGNORA_PRECO_VENDA,                                                                                                                                                                                         
		NR_SEQ_JUST_VALOR_INF,                                                                                                                                                                                         
		NR_SEQ_ESTRUTURA,                                                                                                                                                                                              
		NR_SEQ_ORIGEM,                                                                                                                                                                                                 
		NR_SEQ_COBERTURA,                                                                                                                                                                                              
		IE_IGNORA_DIVISAO_BRAS,                                                                                                                                                                                        
		TX_SIMPRO_POS_PFB,                                                                                                                                                                                             
		TX_SIMPRO_NEG_PFB,                                                                                                                                                                                             
		TX_SIMPRO_POS_PMC,                                                                                                                                                                                             
		TX_SIMPRO_NEG_PMC,                                                                                                                                                                                             
		QT_DIAS_INTER_INICIO,                                                                                                                                                                                          
		QT_DIAS_INTER_FINAL,                                                                                                                                                                                           
		NR_SEQ_REGRA_LANC,                                                                                                                                                                                             
		NR_SEQ_LIB_DIETA_CONV,                                                                                                                                                                                         
		IE_CLINICA,                                                                                                                                                                                                    
		CD_USUARIO_CONVENIO,                                                                                                                                                                                           
		QT_POS_INICIAL,                                                                                                                                                                                                
		QT_POS_FINAL,
		IE_TIPO_PRECO_AUTOR
	from	regra_ajuste_material
	where	nr_sequencia	= nr_sequencia_p
	and	cd_estabelecimento = cd_estab_orig_p;
	
	insert into REGRA_AJUSTE_MAT_PROC_VINC(
		NR_SEQUENCIA,
		NR_SEQ_REGRA_AJUSTE,
		DT_ATUALIZACAO,
		NM_USUARIO,          
		DT_ATUALIZACAO_NREC, 
		NM_USUARIO_NREC,     
		CD_PROCEDIMENTO,     
		IE_ORIGEM_PROCED,    
		IE_SITUACAO,         
		CD_AREA_PROCEDIMENTO,
		CD_ESPECIALIDADE,    
		CD_GRUPO_PROC )
	SELECT	nextval('regra_ajuste_mat_proc_vinc_seq'),        

		nr_seq_regra_ajuste_mat_w,
		clock_timestamp(),
		nm_usuario_p,          
		clock_timestamp(), 
		nm_usuario_p,     
		CD_PROCEDIMENTO,     
		IE_ORIGEM_PROCED,    
		IE_SITUACAO,         
		CD_AREA_PROCEDIMENTO,
		CD_ESPECIALIDADE,    
		CD_GRUPO_PROC  
	from	REGRA_AJUSTE_MAT_PROC_VINC
	where	NR_SEQ_REGRA_AJUSTE = nr_sequencia_p;
		
	insert into regra_ajuste_mat_aviso(
		cd_perfil_aviso,
		dt_atualizacao,
		dt_atualizacao_nrec,
		nm_usuario,
		nm_usuario_aviso,
		nm_usuario_nrec,
		nr_seq_regra,
		nr_sequencia)
	SELECT	cd_perfil_aviso,
		clock_timestamp(),
		clock_timestamp(),
		nm_usuario_p,
		nm_usuario_aviso,
		nm_usuario_p,
		nr_seq_regra_ajuste_mat_w,
		nextval('regra_ajuste_mat_aviso_seq')
	from	regra_ajuste_mat_aviso
	where	nr_seq_regra	= nr_sequencia_p;
	
	insert into REGRA_AJUSTE_INDICE_DIF(
		nr_Sequencia,
		NR_SEQ_REGRA,
		DT_ATUALIZACAO,     
		NM_USUARIO,         
		DT_ATUALIZACAO_NREC,
		NM_USUARIO_NREC,    
		VL_INICIAL,         
		VL_FINAL,           
		TX_AJUSTE,          
		IE_ORIGEM_PRECO)
	SELECT	nextval('regra_ajuste_indice_dif_seq'),

		nr_seq_regra_ajuste_mat_w,       
		clock_timestamp(),     
		NM_USUARIO_p,         
		clock_timestamp(),
		nm_usuario_p,    
		VL_INICIAL,         
		VL_FINAL,           
		TX_AJUSTE,          
		IE_ORIGEM_PRECO
	from 	REGRA_AJUSTE_INDICE_DIF
	where	nr_seq_regra	= nr_sequencia_p;
	
end if;


commit;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copiar_regra_ajuste_mat_estab ( nr_sequencia_p bigint, cd_estab_orig_p bigint, cd_estab_dest_p bigint, nm_usuario_p text) FROM PUBLIC;

