-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE bft_insert_hi_audit_log ( cd_pessoa_fisica_p hi_audit_log.cd_pessoa_fisica%type, ds_operation_p hi_audit_log.ds_operation%type, nr_message_p hi_audit_log.nr_message%type, nr_batch_p hi_audit_log.nr_batch%type, ds_version_p hi_audit_log.ds_version%type, ds_service_provider_p hi_audit_log.ds_service_provider%type, dt_generation_p hi_audit_log.dt_generation%type, ie_data_type_p hi_audit_log.ie_data_type%type, cd_estabelecimento_p hi_audit_log.cd_estabelecimento%type, nm_usuario_p hi_audit_log.nm_usuario%type, nr_provider_hpi_p hi_audit_log.nr_provider_hpi%type) AS $body$
DECLARE


nr_seq_person_hi_w       bigint;
nr_provider_hpi_w        hi_audit_log.nr_provider_hpi%type;


BEGIN

if (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') then

	select    max(nr_sequencia)
	into STRICT      nr_seq_person_hi_w
	from      person_ihi
	where   	cd_pessoa_fisica     = cd_pessoa_fisica_p
	and        ie_data_type     = ie_data_type_p;
	
	select 	get_person_ihi( obter_pessoa_fisica_usuario(nm_usuario_p, 'C') ,'P')
	into STRICT	nr_provider_hpi_w
	;
	


                insert into hi_audit_log(
                                nr_sequencia,
                                cd_estabelecimento,
                                nm_usuario,
                                nm_usuario_nrec,
                                dt_atualizacao,
                                dt_atualizacao_nrec,
                                cd_pessoa_fisica,
                                ds_operation,
                                nr_message,
                                nr_batch,
                                ds_version,
                                ds_service_provider,
                                dt_generation,
                                ie_data_type,
                                nr_seq_person_hi,
								nr_provider_hpi)
                values (
                                nextval('hi_audit_log_seq'),
                                cd_estabelecimento_p,
                                nm_usuario_p,
                                nm_usuario_p,
                                clock_timestamp(),
                                clock_timestamp(),
                                cd_pessoa_fisica_p,                       
                                ds_operation_p,
                                nr_message_p,
                                nr_batch_p,
                                ds_version_p,
                                ds_service_provider_p,                 
                                dt_generation_p,
                                ie_data_type_p,
                                nr_seq_person_hi_w, 
                                nr_provider_hpi_w );
                commit;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE bft_insert_hi_audit_log ( cd_pessoa_fisica_p hi_audit_log.cd_pessoa_fisica%type, ds_operation_p hi_audit_log.ds_operation%type, nr_message_p hi_audit_log.nr_message%type, nr_batch_p hi_audit_log.nr_batch%type, ds_version_p hi_audit_log.ds_version%type, ds_service_provider_p hi_audit_log.ds_service_provider%type, dt_generation_p hi_audit_log.dt_generation%type, ie_data_type_p hi_audit_log.ie_data_type%type, cd_estabelecimento_p hi_audit_log.cd_estabelecimento%type, nm_usuario_p hi_audit_log.nm_usuario%type, nr_provider_hpi_p hi_audit_log.nr_provider_hpi%type) FROM PUBLIC;

