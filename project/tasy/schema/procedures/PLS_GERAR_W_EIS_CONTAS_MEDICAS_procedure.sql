-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE PROCEDURE pls_gerar_w_eis_contas_medicas ( dt_mes_referencia_p timestamp, nm_usuario_p text, cd_estabelecimento_p bigint) AS $body$
DECLARE

 
qt_registros_w			bigint;
dt_referencia_w			timestamp;


BEGIN 
 
select	count(*) 
into STRICT	qt_registros_w 
from	w_pls_eis_contas_medicas;
 
if (qt_registros_w = 0) then 
	dt_referencia_w	:= null;
else 
	dt_referencia_w	:= dt_mes_referencia_p;
end if;
 
insert into w_pls_eis_contas_medicas(	nr_sequencia,		dt_atualizacao,		nm_usuario,		dt_atualizacao_nrec,	nm_usuario_nrec, 
					ie_tipo_item, 		nr_seq_protocolo, 	nr_seq_conta, 		nr_seq_conta_item, 	nr_seq_outorgante, 
					nm_operadora,		nr_seq_prestador,	ds_prestador,		ie_tipo_guia,		ds_status_protocolo, 
					ie_status_protocolo,	ds_status_conta,	ie_status_conta,	ds_plano,		nm_fantasia, 
					nr_seq_plano,		ie_segmentacao,		ds_segmentacao,		ie_tipo_contratacao,	ds_tipo_contratacao, 
					ds_tipo_atendimento,	nr_grupo_ans,		ds_tipo_despesa,	vl_liberado,		vl_procedimento_imp, 
					vl_glosa,		vl_saldo,		vl_coparticipacao,	dt_referencia,		ds_grupo, 
					ie_situacao,		nr_seq_clinica,		nr_seq_grau_partic,	nr_seq_grupo_ans,	ie_regime_internacao, 
					nr_seq_tipo_acomodacao,	nr_seq_tipo_atendimento,ie_tipo_despesa,	cd_cgc_outorgante,	ds_grau_participacao, 
					qt_ocorrencia,		vl_lib_sistema,		vl_lib_usuario,		cd_procedimento,	ds_procedimento, 
					cd_grupo_proc,		ds_grupo_proc,		cd_especialidade,	ds_especialidade,	cd_area_procedimento, 
					ds_area_procedimento,	ds_tipo_segurado,	ie_tipo_segurado,	ds_clinica,		ds_tipo_acomodacao, 
					ds_regime_internacao,	ie_tipo_atendimento,	ds_tipo_atendimento_conta,ds_medico_principal,	cd_medico, 
					ds_cbo,			nr_seq_cbo,		nr_seq_contrato,	nr_seq_cpt,		ds_cpt, 
					cd_doenca_cid,		ds_doenca_cid) 
				(SELECT	nextval('w_pls_eis_contas_medicas_seq'),clock_timestamp(),	nm_usuario_p,		clock_timestamp(),		nm_usuario_p, 
					ie_tipo_item, 		nr_seq_protocolo, 	nr_seq_conta, 		nr_seq_conta_item, 	nr_seq_outorgante, 
					nm_operadora,		nr_seq_prestador,	ds_prestador,		ie_tipo_guia,		ds_status_protocolo, 
					ie_status_protocolo,	ds_status_conta,	ie_status_conta,	ds_plano,		nm_fantasia, 
					nr_seq_plano,		ie_segmentacao,		ds_segmentacao,		ie_tipo_contratacao,	ds_tipo_contratacao, 
					ds_tipo_atendimento,	nr_grupo_ans,		ds_tipo_despesa,	vl_liberado,		vl_procedimento_imp, 
					vl_glosa,		vl_saldo,		vl_coparticipacao,	dt_referencia,		ds_grupo, 
					ie_situacao,		nr_seq_clinica,		nr_seq_grau_partic,	nr_seq_grupo_ans,	ie_regime_internacao, 
					nr_seq_tipo_acomodacao,	nr_seq_tipo_atendimento,ie_tipo_despesa,	cd_cgc_outorgante,	ds_grau_participacao, 
					qt_ocorrencia,		vl_lib_sistema,		vl_lib_usuario,		cd_procedimento,	ds_procedimento, 
					cd_grupo_proc,		ds_grupo_proc,		cd_especialidade,	ds_especialidade,	cd_area_procedimento, 
					ds_area_procedimento,	ds_tipo_segurado,	ie_tipo_segurado,	ds_clinica,		ds_tipo_acomodacao, 
					ds_regime_internacao,	ie_tipo_atendimento,	ds_tipo_atendimento_conta,ds_medico_principal,	cd_medico, 
					ds_cbo,			nr_seq_cbo,		nr_seq_contrato,	nr_seq_cpt,		ds_cpt, 
					cd_doenca_cid,		ds_doenca_cid 
				from	eis_pls_contas_medicas_v 
				where	dt_referencia	= coalesce(dt_referencia_w,dt_referencia));
 
commit;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_w_eis_contas_medicas ( dt_mes_referencia_p timestamp, nm_usuario_p text, cd_estabelecimento_p bigint) FROM PUBLIC;

