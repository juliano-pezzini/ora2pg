-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_conv_meio_ext_int ( nm_tabela_p text, nm_atributo_p text, cd_origem_p text, IE_SISTEMA_EXTERNO_p text) RETURNS varchar AS $body$
DECLARE



cd_conversao_w			varchar(80);
nm_atributo_w			varchar(50);
nm_tabela_w				varchar(50);


BEGIN

	cd_conversao_w	:= '';
	nm_atributo_w	:= upper(nm_atributo_p);
	nm_tabela_w		:= upper(nm_tabela_p);


	begin
		if (coalesce(ie_sistema_externo_p, 'XPTO') = 'LXC') then
			select	max(cd_externo)
			into STRICT	cd_conversao_w
			from	conversao_meio_externo
			where	upper(nm_tabela)	= upper(nm_tabela_w)
			and		upper(nm_atributo)	= upper(nm_atributo_w)
			and		upper(cd_interno)	= upper(cd_origem_p)
			and		ie_sistema_externo	= ie_sistema_externo_p;
		else
			select	max(cd_externo)
			into STRICT	cd_conversao_w
			from	conversao_meio_externo
			where	nm_tabela			= nm_tabela_w
			and		nm_atributo			= nm_atributo_w
			and		cd_interno			= cd_origem_p
			and		ie_sistema_externo = ie_sistema_externo_p;
		end if;
	exception when others then
		cd_conversao_w := null;
	end;


	return cd_conversao_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_conv_meio_ext_int ( nm_tabela_p text, nm_atributo_p text, cd_origem_p text, IE_SISTEMA_EXTERNO_p text) FROM PUBLIC;

