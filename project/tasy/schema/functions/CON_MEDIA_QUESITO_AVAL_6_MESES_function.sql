-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION con_media_quesito_aval_6_meses ( cd_consultor_p text) RETURNS varchar AS $body$
DECLARE

 
qt_retorno_w		varchar(15);
qt_resultado_w		varchar(15);
ds_classif_w		varchar(15);


BEGIN 
SELECT	ROUND(coalesce((SUM((vl_media_proj)::numeric )/COUNT(nr_seq_proj)),0),2) 
INTO STRICT	qt_resultado_w 
FROM	(SELECT	DISTINCT 
		nr_seq_proj, 
		SUBSTR(obter_ds_proj_projeto(NR_SEQ_PROJ),1,255) ds_titulo, 
		SUBSTR(con_media_quesito_aval(cd_executor,nr_seq_proj,'V'),1,40) vl_media_proj 
	FROM	proj_rat_v 
	WHERE	SUBSTR(con_media_quesito_aval(cd_executor,nr_seq_proj,'V'),1,40) <> 0 
	and	dt_inicio > (clock_timestamp() - interval '183 days') 
	AND	cd_executor = cd_consultor_p) alias14;
 
IF (qt_resultado_w <= 0) THEN 
	qt_retorno_w := '0';
END IF;
 
IF (qt_resultado_w > 0.00) AND (qt_resultado_w <= 1.40) THEN 
	ds_classif_w	:= wheb_mensagem_pck.get_texto(300253);
	qt_retorno_w	:= substr(qt_resultado_w||' - ' || ds_classif_w,1,15);
END IF;
 
IF (qt_resultado_w > 1.40) AND (qt_resultado_w <= 2.40) THEN 
	ds_classif_w	:= wheb_mensagem_pck.get_texto(300254);
	qt_retorno_w	:= substr(qt_resultado_w||' - ' || ds_classif_w,1,15);
END IF;
 
IF (qt_resultado_w > 2.40) AND (qt_resultado_w <= 3.40) THEN 
	ds_classif_w	:= wheb_mensagem_pck.get_texto(300255);
	qt_retorno_w	:= substr(qt_resultado_w||' - ' || ds_classif_w,1,15);
END IF;
 
IF (qt_resultado_w > 3.40) AND (qt_resultado_w <= 4.40) THEN 
	ds_classif_w	:= wheb_mensagem_pck.get_texto(300256);
	qt_retorno_w	:= substr(qt_resultado_w||' - ' || ds_classif_w,1,15);
END IF;
 
IF (qt_resultado_w > 4.40) THEN 
	ds_classif_w	:= wheb_mensagem_pck.get_texto(300257);
	qt_retorno_w	:= substr(qt_resultado_w||' - ' || ds_classif_w,1,15);
END IF;
 
RETURN	qt_retorno_w;
 
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION con_media_quesito_aval_6_meses ( cd_consultor_p text) FROM PUBLIC;

