-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION fis_obter_resp_reg_organograma (nr_sequencia_p bigint, cd_pessoa_fisica_p text, ie_option_table_p text) RETURNS varchar AS $body$
DECLARE


cd_pessoa_fisica_w usuario.cd_pessoa_fisica%TYPE;
response_w varchar(1) := 'S';


BEGIN
   IF (ie_option_table_p = 'DEPARTAMENTO_PHILIPS') THEN
        BEGIN
            SELECT max(coalesce(dp.cd_pessoa_fisica, 'T'))
            INTO STRICT cd_pessoa_fisica_w
            FROM departamento_philips dp
            WHERE dp.nr_sequencia = nr_sequencia_p
            AND (dp.cd_pessoa_fisica = cd_pessoa_fisica_p OR coalesce(dp.cd_pessoa_fisica::text, '') = '');
        EXCEPTION WHEN no_data_found THEN
            cd_pessoa_fisica_w := null;
        END;
    END IF;

    IF (ie_option_table_p = 'GERENCIA_WHEB') THEN
        BEGIN
            SELECT max(coalesce(g.cd_responsavel, 'T'))
            INTO STRICT cd_pessoa_fisica_w
            FROM gerencia_wheb g
            WHERE g.nr_sequencia = nr_sequencia_p
            AND (g.cd_responsavel = cd_pessoa_fisica_p OR coalesce(g.cd_responsavel::text, '') = '');
        EXCEPTION WHEN no_data_found THEN
            cd_pessoa_fisica_w := null;
        END;
    END IF;

    IF (cd_pessoa_fisica_w IS NOT NULL AND cd_pessoa_fisica_w::text <> '') THEN
        response_w := 'S';
    ELSE
        response_w := 'N';
    END IF;

RETURN response_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION fis_obter_resp_reg_organograma (nr_sequencia_p bigint, cd_pessoa_fisica_p text, ie_option_table_p text) FROM PUBLIC;

