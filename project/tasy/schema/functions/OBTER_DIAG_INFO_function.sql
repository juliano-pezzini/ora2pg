-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_diag_info ( nr_seq_prescr_p bigint, nr_seq_diag_p bigint, nr_seq_item_p bigint, nr_seq_result_p bigint) RETURNS varchar AS $body$
DECLARE


  qt_reg_w bigint;
  simple_selection_w char(1);


BEGIN
  
  SELECT MAX(ie_forma_selecao)
  INTO STRICT simple_selection_w
  FROM pe_item_examinar
  WHERE nr_sequencia = nr_seq_item_p;

  SELECT count(*)
  INTO STRICT qt_reg_w
  FROM pe_prescr_item_result A,
    pe_prescr_item_result_diag b,
    pe_prescr_diag c
  WHERE b.nr_seq_item = A.nr_sequencia
  AND b.nr_seq_diag   = c.nr_sequencia
  AND c.nr_seq_prescr = nr_seq_prescr_p
  AND c.nr_seq_diag   = nr_seq_diag_p
  AND A.nr_seq_item   = nr_seq_item_p
  AND (
      (simple_selection_w = 'S' AND (1 = 1))
      OR (simple_selection_w = 'N' AND (A.nr_seq_result = nr_seq_result_p))
    );

  IF (qt_reg_w > 0) THEN
    RETURN 'S';
  ELSE
    RETURN 'N';
  END IF;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_diag_info ( nr_seq_prescr_p bigint, nr_seq_diag_p bigint, nr_seq_item_p bigint, nr_seq_result_p bigint) FROM PUBLIC;

