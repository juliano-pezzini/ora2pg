-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_data_minutos ( nr_min_duracao_p bigint) RETURNS varchar AS $body$
DECLARE


ds_hora_formatada_w		varchar(255);
qt_dias_w				bigint 	:= 0;
qt_horas_w				bigint	:= 0;
qt_horas_ww				bigint	:= 0;
qt_minutos_w			bigint	:= 0;
ie_dia_completo_w		varchar(1);
ie_primeira_hora_dia_w	varchar(1);


BEGIN

if (nr_min_duracao_p IS NOT NULL AND nr_min_duracao_p::text <> '') then

	--Obter a qtd. total de horas para calcular a qtd. de dias
	select	round(floor(nr_min_duracao_p / 60))
	into STRICT	qt_horas_ww
	;

	--Validar o mínimo de horas para compreender 1 dia
	if (qt_horas_ww >= 24) then

		while(qt_horas_ww > 0) loop
			begin
			--Validar se é um dia completo(Ex.: 24h, 48h, 72h)
			select	CASE WHEN mod(qt_horas_ww,24)=0 THEN 'S'  ELSE 'N' END
			into STRICT	ie_dia_completo_w
			;

			if (ie_dia_completo_w = 'S') then
				qt_dias_w	:= qt_dias_w + 1;
			end if;

			--Decrementa 1 hora
			qt_horas_ww	:= qt_horas_ww - 1;
			end;
		end loop;
	else
		qt_dias_w	:= 0;
	end if;

	--Obter a qtd. total de horas
	select	floor(mod((nr_min_duracao_p / 60),24))
	into STRICT	qt_horas_w
	;

	--Validar se é a primeira hora do dia(0h)
	select	CASE WHEN mod(qt_horas_w,24)=0 THEN 'S'  ELSE 'N' END
	into STRICT	ie_primeira_hora_dia_w
	;

	if (ie_primeira_hora_dia_w = 'S') then
		qt_horas_w	:= 00;
	end if;

	--Obter a qtd. total de minutos
	select	round(mod(nr_min_duracao_p, 60))
	into STRICT	qt_minutos_w
	;

end if;

ds_hora_formatada_w	:= substr(coalesce(qt_dias_w,0) || 'd ' || lpad(coalesce(qt_horas_w,0),2,0) || 'h : ' || lpad(coalesce(qt_minutos_w,0),2,0) || 'min ',1,255);

return	ds_hora_formatada_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_data_minutos ( nr_min_duracao_p bigint) FROM PUBLIC;

