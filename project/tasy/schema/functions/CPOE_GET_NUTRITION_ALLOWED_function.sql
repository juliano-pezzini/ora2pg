-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cpoe_get_nutrition_allowed ( cd_material_p bigint default null, cd_unid_medida_solic_p text default null, cd_setor_atendimento_p bigint default null, cd_estabelecimento_p bigint default null, cd_pf_paciente_p text default null, nr_atendimento_p bigint default null, nm_usuario_p text default null, ds_blocking_rules_p text default null, ds_blocking_rules_nutrition_p text default null) RETURNS varchar AS $body$
DECLARE


	ds_retorno_w varchar(2000);
	
	SEP		constant varchar(1) := ';';


BEGIN
	ds_retorno_w := '';

	/* Regras Leites e Derivados */

	if ((coalesce(position('MILK_B' in ds_blocking_rules_p), 0) > 0) or (coalesce(position('L_S' in ds_blocking_rules_nutrition_p), 0) = 0)) then
		ds_retorno_w := 'MILK_N';
	else
		ds_retorno_w := 'MILK_S';
	end if;
	
	/* Regras Suplementos */

	if ((coalesce(position('SUP_B' in ds_blocking_rules_p), 0) > 0) or (coalesce(position('S_S' in ds_blocking_rules_nutrition_p), 0) = 0)) then
		ds_retorno_w := ds_retorno_w  || SEP || 'SUP_N';
	else
		ds_retorno_w := ds_retorno_w  || SEP || 'SUP_' || cpoe_obter_se_mostra_item('S', cd_material_p, cd_unid_medida_solic_p, cd_setor_atendimento_p, cd_estabelecimento_p, cd_pf_paciente_p, nr_atendimento_p, nm_usuario_p);
	end if;


	/* Regras Dieta Enteral */

	if ((coalesce(position('DEN_B' in ds_blocking_rules_p), 0) > 0) or (coalesce(position('E_S' in ds_blocking_rules_nutrition_p), 0) = 0)) then
		ds_retorno_w := ds_retorno_w  || SEP || 'ENT_N';
	else
		ds_retorno_w := ds_retorno_w  || SEP || 'ENT_' || cpoe_obter_se_mostra_item('DE', cd_material_p, cd_unid_medida_solic_p, cd_setor_atendimento_p, cd_estabelecimento_p, cd_pf_paciente_p, nr_atendimento_p, nm_usuario_p);
	end if;
	
	return ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_get_nutrition_allowed ( cd_material_p bigint default null, cd_unid_medida_solic_p text default null, cd_setor_atendimento_p bigint default null, cd_estabelecimento_p bigint default null, cd_pf_paciente_p text default null, nr_atendimento_p bigint default null, nm_usuario_p text default null, ds_blocking_rules_p text default null, ds_blocking_rules_nutrition_p text default null) FROM PUBLIC;

