-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION conta_total_plantoes (dt_mes_p text, dt_ano_p text, nr_seq_classif_p bigint, nr_seq_grupo_p bigint, nr_seq_escala_p bigint, cd_pessoa_fisica_p bigint, ds_periodo_p text, nr_sequencia_p bigint, nm_usuario_p text, ds_hora_p text, mes_p text, ano_p text, nm_professional_p text) RETURNS bigint AS $body$
DECLARE

total_w bigint;
dia1_w varchar(5);
dia2_w varchar(5);
dia3_w varchar(5);
dia4_w varchar(5);
dia5_w varchar(5);
dia6_w varchar(5);
dia7_w varchar(5);
dia8_w varchar(5);
dia9_w varchar(5);
dia10_w varchar(5);
dia11_w varchar(5);
dia12_w varchar(5);
dia13_w varchar(5);
dia14_w varchar(5);
dia15_w varchar(5);
dia16_w varchar(5);
dia17_w varchar(5);
dia18_w varchar(5);
dia19_w varchar(5);
dia20_w varchar(5);
dia21_w varchar(5);
dia22_w varchar(5);
dia23_w varchar(5);
dia24_w varchar(5);
dia25_w varchar(5);
dia26_w varchar(5);
dia27_w varchar(5);
dia28_w varchar(5);
dia29_w varchar(5);
dia30_w varchar(5);
dia31_w varchar(5);

c01 CURSOR FOR 
SELECT	DISTINCT 
	0, 
	dia1, 
	dia2, 
	dia3, 
	dia4, 
	dia5, 
	dia6, 
	dia7, 
	dia8, 
	dia9, 
	dia10, 
	dia11, 
	dia12, 
	dia13, 
	dia14, 
	dia15, 
	dia16, 
	dia17, 
	dia18, 
	dia19, 
	dia20, 
	dia21, 
	dia22, 
	dia23, 
	dia24, 
	dia25, 
	dia26, 
	dia27, 
	dia28, 
	dia29, 
	dia30, 
	dia31 
	FROM  escala_diaria_v 
	WHERE	dt_inicio = dt_mes_p 
	AND	dt_fim  = dt_ano_p 
	AND	((nr_seq_classif = nr_seq_classif_p) OR (coalesce(nr_seq_classif_p,0) = 0)) 
	AND	((nr_seq_grupo = nr_seq_grupo_p) OR (coalesce(nr_seq_grupo_p,0) = 0)) 
	AND	((nr_seq_escala = nr_seq_escala_p) OR (coalesce(nr_seq_escala_p,0) = 0)) 
	and	cd_pessoa_fisica = cd_pessoa_fisica_p 
	and	ds_periodo = ds_periodo_p 
	and	nr_sequencia = nr_sequencia_p 
	and	nm_usuario = nm_usuario_p 
	and	ds_hora = ds_hora_p 
	and	mes = mes_p 
	and	ano = ano_p 
	and	nm_profissional = nm_professional_p 
	ORDER BY  1;

 

BEGIN 
 
open c01;
loop 
fetch c01 into	 
	total_w, 
	dia1_w, 
	dia2_w, 
	dia3_w, 
    dia4_w, 
	dia5_w, 
	dia6_w, 
	dia7_w, 
	dia8_w, 
	dia9_w, 
	dia10_w, 
	dia11_w, 
	dia12_w, 
	dia13_w, 
	dia14_w, 
	dia15_w, 
	dia16_w, 
	dia17_w, 
	dia18_w, 
	dia19_w, 
	dia20_w, 
	dia21_w, 
	dia22_w, 
	dia23_w, 
	dia24_w, 
	dia25_w, 
	dia26_w, 
	dia27_w, 
	dia28_w, 
	dia29_w, 
	dia30_w, 
	dia31_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin 
		 
		if (dia1_w IS NOT NULL AND dia1_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia2_w IS NOT NULL AND dia2_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia3_w IS NOT NULL AND dia3_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia4_w IS NOT NULL AND dia4_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia5_w IS NOT NULL AND dia5_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia6_w IS NOT NULL AND dia6_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia7_w IS NOT NULL AND dia7_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia8_w IS NOT NULL AND dia8_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia9_w IS NOT NULL AND dia9_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia10_w IS NOT NULL AND dia10_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia11_w IS NOT NULL AND dia11_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia12_w IS NOT NULL AND dia12_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia13_w IS NOT NULL AND dia13_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia14_w IS NOT NULL AND dia14_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia15_w IS NOT NULL AND dia15_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia16_w IS NOT NULL AND dia16_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia17_w IS NOT NULL AND dia17_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia18_w IS NOT NULL AND dia18_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia19_w IS NOT NULL AND dia19_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia20_w IS NOT NULL AND dia20_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia21_w IS NOT NULL AND dia21_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia22_w IS NOT NULL AND dia22_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia23_w IS NOT NULL AND dia23_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia24_w IS NOT NULL AND dia24_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia25_w IS NOT NULL AND dia25_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia26_w IS NOT NULL AND dia26_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia27_w IS NOT NULL AND dia27_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia28_w IS NOT NULL AND dia28_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia29_w IS NOT NULL AND dia29_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia30_w IS NOT NULL AND dia30_w::text <> '') then 
		total_w := total_w +1;
		end if;
		if (dia31_w IS NOT NULL AND dia31_w::text <> '') then 
		total_w := total_w +1;
		end if;
	 end;
end loop;
close c01;
 
return total_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION conta_total_plantoes (dt_mes_p text, dt_ano_p text, nr_seq_classif_p bigint, nr_seq_grupo_p bigint, nr_seq_escala_p bigint, cd_pessoa_fisica_p bigint, ds_periodo_p text, nr_sequencia_p bigint, nm_usuario_p text, ds_hora_p text, mes_p text, ano_p text, nm_professional_p text) FROM PUBLIC;

