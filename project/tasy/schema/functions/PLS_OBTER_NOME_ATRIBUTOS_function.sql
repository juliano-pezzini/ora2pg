-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_nome_atributos ( nm_tabela_p text, ie_opcao_p text, ie_tipo_atributo_p text, ie_componente_p text) RETURNS varchar AS $body$
DECLARE


/*
ie_opcao_p
	S = somente obrigatórios
	N = somente não obrigatórios
	T = todos

ie_tipo_atributo_p
	BLOB
	CLOB
	DATE
	FUNCTION
	LONG
	LONG RAW
	NUMBER
	VARCHAR2
	VISUAL

ie_componente_p
	ai              Arquivo Imagem
	ail             Arquivo Imagem Link
	cb              CheckBox
	de              Edit
	dtp             DateTimePicker
	eb              Espaço em branco
	ec              Cores
	ft              Fonte
	ib              Imagem no banco
	lcb             LookUpComboBox
	me              Memo
	pd              Panel Data
	pe              Panel Editor
	rg              RadioGroup
	tx              Texto
	xml             Editor de XML
*/
ds_campos_aux_w		varchar(255);
ds_campos_w		varchar(5000);

C01 CURSOR FOR
	SELECT	lower(nm_atributo)||', '
	from	tabela_atributo
	where	nm_tabela		= upper(nm_tabela_p)
	and	upper(ie_tipo_atributo)	<> upper('function')
	and	upper(ie_tipo_atributo)	= upper(coalesce(ie_tipo_atributo_p,ie_tipo_atributo))
	and (upper(ie_obrigatorio)	= upper(ie_opcao_p) or (ie_opcao_p = 'T'))
	and	((upper(ie_componente)	= upper(coalesce(ie_componente_p,ie_componente))) or (coalesce(ie_componente::text, '') = ''));


BEGIN

open C01;
loop
fetch C01 into
	ds_campos_aux_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin
	ds_campos_w	:= ds_campos_w||ds_campos_aux_w;
	end;
end loop;
close C01;

return	substr(ds_campos_w,1, length(ds_campos_w)-2);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_nome_atributos ( nm_tabela_p text, ie_opcao_p text, ie_tipo_atributo_p text, ie_componente_p text) FROM PUBLIC;

