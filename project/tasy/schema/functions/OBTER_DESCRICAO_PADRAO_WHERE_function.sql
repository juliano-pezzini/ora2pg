-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_descricao_padrao_where (nm_tabela_p text, ds_campo_p text, ds_where_p text) RETURNS varchar AS $body$
DECLARE


ds_comando_w		varchar(2000);
ds_tipo_campo_w		varchar(10);
qt_tamanho_w		integer;

vl_retorno_w		varchar(4000);
c001			integer;
retorno_w		integer;


BEGIN
if (nm_tabela_p IS NOT NULL AND nm_tabela_p::text <> '') and (ds_campo_p IS NOT NULL AND ds_campo_p::text <> '') and (ds_where_p IS NOT NULL AND ds_where_p::text <> '') then
	begin

		begin
			select	ie_tipo_atributo,
				coalesce(qt_tamanho,50)
			into STRICT	ds_tipo_campo_w,
				qt_tamanho_w
			from	tabela_atributo
			where	nm_tabela = nm_tabela_p
			and	nm_atributo = ds_campo_p;
		exception when others then
			ds_tipo_campo_w := '';
		end;


		ds_comando_w	:= 'select ' || ds_campo_p || ' from ' || nm_tabela_p ||
					' where 1 = 1 ' || ds_where_p || ' ';

		begin
			C001 := DBMS_SQL.OPEN_CURSOR;
			DBMS_SQL.PARSE(C001, ds_comando_w, dbms_sql.Native);
			DBMS_SQL.DEFINE_COLUMN(c001,1,ds_campo_p,4000);
			retorno_w := DBMS_SQL.execute(c001);
			retorno_w := DBMS_SQL.fetch_rows(c001);
			DBMS_SQL.COLUMN_VALUE(C001, 1, vl_retorno_w );
			DBMS_SQL.CLOSE_CURSOR(C001);
		exception when others then
			DBMS_SQL.CLOSE_CURSOR(C001);
		end;

		if (vl_retorno_w IS NOT NULL AND vl_retorno_w::text <> '') and (ds_tipo_campo_w = 'DATE') then

			vl_retorno_w := pkg_date_utils.get_isoformat(to_date(vl_retorno_w));
		end if;
	end;
end if;

RETURN vl_retorno_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_descricao_padrao_where (nm_tabela_p text, ds_campo_p text, ds_where_p text) FROM PUBLIC;

