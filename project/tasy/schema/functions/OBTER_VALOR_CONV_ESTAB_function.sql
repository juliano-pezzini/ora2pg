-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_valor_conv_estab ( cd_convenio_p bigint, cd_estabelecimento_p bigint, nm_campo_p text) RETURNS varchar AS $body$
DECLARE



nm_campo_w			varchar(80);
ds_comando_w			varchar(2000);
ds_retorno_w			varchar(255);
qt_registros_w			integer	:= 0;

ie_exige_data_ult_pagto_w	varchar(1);
ie_exige_guia_w			varchar(1);
ie_exige_orc_atend_w		varchar(1);
ie_glosa_atendimento_w		varchar(1);
ie_preco_medio_material_w	varchar(1);
ie_agenda_consulta_w		varchar(1);
ie_rep_cod_usuario_w		varchar(1);
ie_exige_carteira_atend_w	varchar(1);
ie_exige_validade_atend_w	varchar(1);
ie_exige_plano_w		varchar(1);
ie_separa_conta_w		varchar(1);
ie_guia_unica_conta_w		varchar(1);
ie_valor_contabil_w		varchar(1);
ie_titulo_receber_w		varchar(1);
ie_conversao_mat_w		varchar(1);
ie_doc_convenio_w		varchar(3);
ie_exige_guia_princ_w		varchar(1)	:= 'N';
ie_exige_fim_vigencia_w		varchar(1);
ie_doc_retorno_w		varchar(15);
qt_conta_protocolo_w		integer;
qt_dia_fim_conta_w		smallint;
ie_exige_senha_atend_w		varchar(1);
ie_partic_cirurgia_w		smallint;
ie_exige_origem_w		varchar(1);/* Rafael em 01/03/2007 OS51372 */
cd_interno_w			varchar(15);
cd_regional_w			varchar(15);
ie_cancelar_conta_w		varchar(1)	:= 'S';
ie_exige_doc_conv_titulo_w	varchar(1)	:= 'N';
ie_doc_autorizacao_w		varchar(1)	:= 'N';
ie_CONTA_FIM_MES_w		varchar(01)	:= 'N';
IE_REPASSE_PROC_w		varchar(1);
IE_REPASSE_MAT_w		varchar(1);
IE_CGC_CIH_W			varchar(1);
IE_CONSISTE_GUIA_ATEND_w	varchar(01);
ie_exige_compl_usuario_w	varchar(1);
ie_obter_preco_mat_autor_w	varchar(1)	:= 'N';
ie_titulo_sem_nf_w		varchar(100);
ie_obter_fornec_mat_autor_w	varchar(1)	:= 'N';
ie_tipo_glosa_ret_w		varchar(2);
ie_conta_fim_dia_w		varchar(1)	:= 'N';
ie_cobertura_w			varchar(1)	:= 'N';
cd_ans_w			varchar(20);
ie_exige_passaporte_paciente_w	varchar(1)     := 'N';
ie_conv_categ_glosa_w		varchar(1)	:= 'N';
ie_exige_conv_glosa_w  		varchar(1)	:= 'N';
ie_exige_usuario_glosa_w 	varchar(1)	:= 'N';
ie_exige_compl_glosa_w   	varchar(1)	:= 'N';
ie_exige_validade_glosa_w	varchar(1)	:= 'N';
qt_exame_prescr_w		integer;
ie_funcao_medico_w		varchar(1)	:= 'N';
ie_tiss_tipo_saida_w		varchar(1)	:= 'N';
ds_caminho_exec_w		varchar(255);
ie_gerar_nf_w			varchar(1)	:= 'S';
ie_gerar_ciha_w			varchar(1)	:= 'S';
IE_EXIGE_LETRA_CARTEIRA_w	varchar(1)	:= 'N';
IE_PERMITE_INTERNAR_EUP_W	varchar(1)	:= 'S';
ie_calc_porte_w			convenio.ie_calc_porte%type;
ie_consiste_seq_conta_w		varchar(1)	:= 'N';



BEGIN

select	count(*)
into STRICT	qt_registros_w
from	convenio_estabelecimento where		cd_convenio		= cd_convenio_p
and		cd_estabelecimento	= cd_estabelecimento_p LIMIT 1;

begin
/* Obter dados do Convênio */

select	ie_exige_data_ult_pagto,
	ie_exige_guia,
	ie_exige_orc_atend,
	ie_glosa_atendimento,
	ie_preco_medio_material,
	ie_agenda_consulta,
	ie_rep_cod_usuario,
	ie_exige_carteira_atend,
	ie_exige_validade_atend,
	ie_exige_plano,
	ie_separa_conta,
	ie_guia_unica_conta,
	ie_valor_contabil,
	ie_titulo_receber,
	ie_conversao_mat,
	ie_doc_convenio,
	ie_doc_retorno,
	qt_conta_protocolo,
	qt_dia_fim_conta,
	ie_exige_senha_atend,
	ie_partic_cirurgia,
	ie_exige_origem,
	cd_interno,
	cd_regional,
	'S' ie_titulo_sem_nf,
	'N' ie_obter_fornec_mat_autor,
	ie_cobertura,
	ie_calc_porte
into STRICT	ie_exige_data_ult_pagto_w,
	ie_exige_guia_w,
	ie_exige_orc_atend_w,
	ie_glosa_atendimento_w,
	ie_preco_medio_material_w,
	ie_agenda_consulta_w,
	ie_rep_cod_usuario_w,
	ie_exige_carteira_atend_w,
	ie_exige_validade_atend_w,
	ie_exige_plano_w,
	ie_separa_conta_w,
	ie_guia_unica_conta_w,
	ie_valor_contabil_w,
	ie_titulo_receber_w,
	ie_conversao_mat_w,
	ie_doc_convenio_w,
	ie_doc_retorno_w,
	qt_conta_protocolo_w,
	qt_dia_fim_conta_w,
	ie_exige_senha_atend_w,
	ie_partic_cirurgia_w,
	ie_exige_origem_w,
	cd_interno_w,
	cd_regional_w,
	ie_titulo_sem_nf_w,
	ie_obter_fornec_mat_autor_w,
	ie_cobertura_w,
	ie_calc_porte_w
from	convenio
where	cd_convenio	= cd_convenio_p;
exception
when no_data_found then
	qt_registros_w	:= 0;
end;

/* Obter dados do Convênio estabelecimento */

if (qt_registros_w	> 0) then

	begin
	select	coalesce(ie_exige_data_ult_pagto,ie_exige_data_ult_pagto_w),
		coalesce(ie_exige_guia,ie_exige_guia_w),
		coalesce(ie_exige_orc_atend,ie_exige_orc_atend_w),
		coalesce(ie_glosa_atendimento,ie_glosa_atendimento_w),
		coalesce(ie_preco_medio_material,ie_preco_medio_material_w),
		coalesce(ie_agenda_consulta,ie_agenda_consulta_w),
		coalesce(ie_rep_cod_usuario,ie_rep_cod_usuario_w),
		coalesce(ie_exige_carteira_atend,ie_exige_carteira_atend_w),
		coalesce(ie_exige_validade_atend,ie_exige_validade_atend_w),
		coalesce(ie_exige_plano,ie_exige_plano_w),
		coalesce(ie_separa_conta,'N'),
		coalesce(ie_guia_unica_conta,ie_guia_unica_conta_w),
		coalesce(ie_valor_contabil,ie_valor_contabil_w),
		coalesce(ie_titulo_receber,ie_titulo_receber_w),
		coalesce(ie_conversao_mat,ie_conversao_mat_w),
		coalesce(ie_doc_convenio,ie_doc_convenio_w),
		coalesce(ie_doc_retorno,ie_doc_retorno_w),
		coalesce(qt_conta_protocolo,qt_conta_protocolo_w),
		coalesce(qt_dia_fim_conta,qt_dia_fim_conta_w),
		coalesce(ie_exige_senha_atend,ie_exige_senha_atend_w),
		coalesce(ie_partic_cirurgia,ie_partic_cirurgia_w),
		coalesce(ie_exige_origem,ie_exige_origem_w),
		coalesce(cd_interno,cd_interno_w),
		coalesce(cd_regional,cd_regional_w),
		coalesce(ie_cancelar_conta,ie_cancelar_conta_w),
		IE_EXIGE_GUIA_PRINC,
		coalesce(ie_exige_doc_conv_titulo,ie_exige_doc_conv_titulo_w),
		coalesce(ie_exige_fim_vigencia,'N'),
		coalesce(ie_doc_autorizacao,'N'),
		coalesce(ie_CONTA_FIM_MES,'N'),
		IE_REPASSE_PROC,
		IE_REPASSE_MAT,
		IE_CGC_CIH,
		coalesce(IE_CONSISTE_GUIA_ATEND,'N'),
		coalesce(ie_exige_compl_usuario,'N'),
		coalesce(ie_obter_preco_mat_autor,'N'),
		coalesce(ie_titulo_sem_nf,'S'),
		coalesce(ie_obter_fornec_mat_autor,'N'),
		coalesce(ie_tipo_glosa_ret,'N'),
		coalesce(ie_conta_fim_dia,'N'),
		coalesce(cd_ans,cd_ans_w),
		coalesce(ie_exige_passaporte_paciente,'N'),
		coalesce(ie_conv_categ_glosa,'N'),
		coalesce(ie_exige_conv_glosa,'N'),
		coalesce(ie_exige_usuario_glosa,'N'),
		coalesce(ie_exige_compl_glosa,'N'),
		coalesce(ie_exige_validade_glosa,'N'),
		coalesce(qt_exame_prescr,'0'),
		coalesce(ie_funcao_medico,'N'),
		coalesce(ie_tiss_tipo_saida,'N'),
		coalesce(ds_caminho_exec,''),
		coalesce(ie_gerar_nf,'S'),
		coalesce(ie_gerar_ciha,'S'),
		coalesce(IE_EXIGE_LETRA_CARTEIRA,'N'),
		coalesce(IE_PERMITE_INTERNAR_EUP,'S'),
		coalesce(ie_calc_porte_estab,ie_calc_porte_w),
		coalesce(ie_consiste_seq_conta,'N')
	into STRICT	ie_exige_data_ult_pagto_w,
		ie_exige_guia_w,
		ie_exige_orc_atend_w,
		ie_glosa_atendimento_w,
		ie_preco_medio_material_w,
		ie_agenda_consulta_w,
		ie_rep_cod_usuario_w,
		ie_exige_carteira_atend_w,
		ie_exige_validade_atend_w,
		ie_exige_plano_w,
		ie_separa_conta_w,
		ie_guia_unica_conta_w,
		ie_valor_contabil_w,
		ie_titulo_receber_w,
		ie_conversao_mat_w,
		ie_doc_convenio_w,
		ie_doc_retorno_w,
		qt_conta_protocolo_w,
		qt_dia_fim_conta_w,
		ie_exige_senha_atend_w,
		ie_partic_cirurgia_w,
		ie_exige_origem_w,
		cd_interno_w,
		cd_regional_w,
		ie_cancelar_conta_w,
		ie_exige_guia_princ_w,
		ie_exige_doc_conv_titulo_w,
		ie_exige_fim_vigencia_w,
		ie_doc_autorizacao_w,
		ie_conta_fim_mes_w,
		ie_repasse_proc_w,
		ie_repasse_mat_w,
		ie_cgc_cih_w,
		ie_consiste_guia_atend_w,
		ie_exige_compl_usuario_w,
		ie_obter_preco_mat_autor_w,
		ie_titulo_sem_nf_w,
		ie_obter_fornec_mat_autor_w,
		ie_tipo_glosa_ret_w,
		ie_conta_fim_dia_w,
		cd_ans_w,
		ie_exige_passaporte_paciente_w,
		ie_conv_categ_glosa_w,
		ie_exige_conv_glosa_w,
		ie_exige_usuario_glosa_w,
		ie_exige_compl_glosa_w,
		ie_exige_validade_glosa_w,
		qt_exame_prescr_w,
		ie_funcao_medico_w,
		ie_tiss_tipo_saida_w,
		ds_caminho_exec_w,
		ie_gerar_nf_w,
		ie_gerar_ciha_w,
		ie_exige_letra_carteira_w,
		ie_permite_internar_eup_w,
		ie_calc_porte_w,
		ie_consiste_seq_conta_w
	from	convenio_estabelecimento
	where	cd_convenio		= cd_convenio_p
	and	cd_estabelecimento	= cd_estabelecimento_p  LIMIT 1;
	exception
	when others then
		ie_exige_data_ult_pagto_w	:= ie_exige_data_ult_pagto_w;
		ie_exige_guia_w			:= ie_exige_guia_w;
		ie_exige_orc_atend_w		:= ie_exige_orc_atend_w;
		ie_glosa_atendimento_w		:= ie_glosa_atendimento_w;
		ie_preco_medio_material_w	:= ie_preco_medio_material_w;
		ie_agenda_consulta_w		:= ie_agenda_consulta_w;
		ie_rep_cod_usuario_w		:= ie_rep_cod_usuario_w;
		ie_exige_carteira_atend_w	:= ie_exige_carteira_atend_w;
		ie_exige_validade_atend_w	:= ie_exige_validade_atend_w;
		ie_exige_plano_w		:= ie_exige_plano_w;
		ie_separa_conta_w		:= 'N';
		ie_guia_unica_conta_w		:= ie_guia_unica_conta_w;
		ie_valor_contabil_w		:= ie_valor_contabil_w;
		ie_titulo_receber_w		:= ie_titulo_receber_w;
		ie_conversao_mat_w		:= ie_conversao_mat_w;
		ie_doc_convenio_w		:= ie_doc_convenio_w;
		ie_doc_retorno_w		:= ie_doc_retorno_w;
		qt_conta_protocolo_w		:= qt_conta_protocolo_w;
		qt_dia_fim_conta_w		:= qt_dia_fim_conta_w;
		ie_exige_senha_atend_w		:= ie_exige_senha_atend_w;
		ie_partic_cirurgia_w		:= ie_partic_cirurgia_w;
		ie_exige_origem_w		:= ie_exige_origem_w;
		cd_interno_w			:= cd_interno_w;
		cd_regional_w			:= cd_regional_w;
		ie_cancelar_conta_w		:= ie_cancelar_conta_w;
		ie_exige_doc_conv_titulo_w	:= ie_exige_doc_conv_titulo_w;
		ie_exige_fim_vigencia_w 	:= 'N';
		ie_doc_autorizacao_w		:= 'N';
		ie_conta_fim_mes_w		:= 'N';
		ie_consiste_guia_atend_w	:= 'N';
		ie_exige_compl_usuario_w	:= 'N';
		ie_obter_preco_mat_autor_w	:= 'N';
		ie_titulo_sem_nf_w		:= 'S';
		ie_obter_fornec_mat_autor_w	:= 'N';
		ie_tipo_glosa_ret_w		:= 'N';
		ie_conta_fim_dia_w		:= 'N';
		cd_ans_w			:= cd_ans_w;
		ie_exige_passaporte_paciente_w	:= 'N';
		ie_conv_categ_glosa_w		:= 'N';
		ie_exige_conv_glosa_w		:= 'N';
		ie_exige_usuario_glosa_w	:= 'N';
		ie_exige_compl_glosa_w		:= 'N';
		ie_exige_validade_glosa_w	:= 'N';
		qt_exame_prescr_w		:= '0';
		ie_funcao_medico_w		:= 'N';
		ie_tiss_tipo_saida_w		:= 'N';
		ds_caminho_exec_w		:= '';
		ie_gerar_nf_w			:= 'S';
		ie_gerar_ciha_w			:= 'S';
		ie_exige_letra_carteira_w	:= 'N';
		ie_permite_internar_eup_w	:= 'S';
		ie_calc_porte_w			:= ie_calc_porte_w;
		ie_consiste_seq_conta_w		:= 'N';
	end;

end if;

nm_campo_w	:= upper(nm_campo_p);

if (nm_campo_w	= 'IE_EXIGE_DATA_ULT_PAGTO') then
	ds_retorno_w	:= ie_exige_data_ult_pagto_w;
elsif (nm_campo_w	= 'IE_EXIGE_GUIA') then
	ds_retorno_w	:= ie_exige_guia_w;
elsif (nm_campo_w	= 'IE_EXIGE_ORC_ATEND') then
	ds_retorno_w	:= ie_exige_orc_atend_w;
elsif (nm_campo_w	= 'IE_GLOSA_ATENDIMENTO') then
	ds_retorno_w	:= ie_glosa_atendimento_w;
elsif (nm_campo_w	= 'IE_PRECO_MEDIO_MATERIAL') then
	ds_retorno_w	:= ie_preco_medio_material_w;
elsif (nm_campo_w	= 'IE_AGENDA_CONSULTA') then
	ds_retorno_w	:= ie_agenda_consulta_w;
elsif (nm_campo_w	= 'IE_REP_COD_USUARIO') then
	ds_retorno_w	:= ie_rep_cod_usuario_w;
elsif (nm_campo_w	= 'IE_EXIGE_CARTEIRA_ATEND') then
	ds_retorno_w	:= ie_exige_carteira_atend_w;
elsif (nm_campo_w	= 'IE_EXIGE_VALIDADE_ATEND') then
	ds_retorno_w	:= ie_exige_validade_atend_w;
elsif (nm_campo_w	= 'IE_EXIGE_PLANO') then
	ds_retorno_w	:= ie_exige_plano_w;
elsif (nm_campo_w	= 'IE_SEPARA_CONTA') then
	ds_retorno_w	:= ie_separa_conta_w;
elsif (nm_campo_w	= 'IE_GUIA_UNICA_CONTA') then
	ds_retorno_w	:= ie_guia_unica_conta_w;
elsif (nm_campo_w	= 'IE_VALOR_CONTABIL') then
	ds_retorno_w	:= ie_valor_contabil_w;
elsif (nm_campo_w	= 'IE_TITULO_RECEBER') then
	ds_retorno_w	:= ie_titulo_receber_w;
elsif (nm_campo_w	= 'IE_CONVERSAO_MAT') then
	ds_retorno_w	:= ie_conversao_mat_w;
elsif (nm_campo_w	= 'IE_DOC_CONVENIO') then
	ds_retorno_w	:= ie_doc_convenio_w;
elsif (nm_campo_w	= 'IE_DOC_RETORNO') then
	ds_retorno_w	:= ie_doc_retorno_w;
elsif (nm_campo_w	= 'QT_CONTA_PROTOCOLO') then
	ds_retorno_w	:= qt_conta_protocolo_w;
elsif (nm_campo_w	= 'QT_DIA_FIM_CONTA') then
	ds_retorno_w	:= qt_dia_fim_conta_w;
elsif (nm_campo_w	= 'IE_EXIGE_SENHA_ATEND') then
	ds_retorno_w	:= ie_exige_senha_atend_w;
elsif (nm_campo_w	= 'IE_PARTIC_CIRURGIA') then
	ds_retorno_w	:= ie_partic_cirurgia_w;
elsif (nm_campo_w	= 'IE_EXIGE_ORIGEM') then
	ds_retorno_w	:= ie_exige_origem_w;
elsif (nm_campo_w	= 'CD_INTERNO') then
	ds_retorno_w	:= cd_interno_w;
elsif (nm_campo_w	= 'CD_REGIONAL') then
	ds_retorno_w	:= cd_regional_w;
elsif (nm_campo_w	= 'IE_EXIGE_GUIA_PRINC') then
	ds_retorno_w	:= IE_EXIGE_GUIA_PRINC_w;
elsif (nm_campo_w	= 'IE_CANCELAR_CONTA') then
	ds_retorno_w	:= ie_cancelar_conta_w;
elsif (nm_campo_w	= 'IE_EXIGE_DOC_CONV_TITULO') then
	ds_retorno_w	:= ie_exige_doc_conv_titulo_w;
elsif (nm_campo_w	= 'IE_CONTA_FIM_MES') then
	ds_retorno_w	:= ie_CONTA_FIM_MES_w;
elsif (nm_campo_w	= 'IE_EXIGE_FIM_VIGENCIA') then
	ds_retorno_w	:= ie_exige_fim_vigencia_w;
elsif (nm_campo_w	= 'IE_DOC_AUTORIZACAO') then
	ds_retorno_w	:= ie_doc_autorizacao_w;
elsif (nm_campo_w	= 'IE_REPASSE_PROC') then
	ds_retorno_w	:= IE_REPASSE_PROC_w;
elsif (nm_campo_w	= 'IE_REPASSE_MAT') then
	ds_retorno_w	:= IE_REPASSE_MAT_w;
elsif (nm_campo_w	= 'IE_CGC_CIH') then
	ds_retorno_w	:= IE_CGC_CIH_W;
elsif (nm_campo_w	= 'IE_CONSISTE_GUIA_ATEND') then
	ds_retorno_w	:= IE_CONSISTE_GUIA_ATEND_w;
elsif (nm_campo_w	= 'IE_EXIGE_COMPL_USUARIO') then
	ds_retorno_w	:= ie_exige_compl_usuario_w;
elsif (nm_campo_w	= 'IE_OBTER_PRECO_MAT_AUTOR') then
	ds_retorno_w	:= ie_obter_preco_mat_autor_w;
elsif (nm_campo_w	= 'IE_TITULO_SEM_NF') then
	ds_retorno_w	:= ie_titulo_sem_nf_w;
elsif (nm_campo_w	= 'IE_OBTER_FORNEC_MAT_AUTOR') then
	ds_retorno_w	:= ie_obter_fornec_mat_autor_w;
elsif (nm_campo_w	= 'IE_TIPO_GLOSA_RET') then
	ds_retorno_w	:= ie_tipo_glosa_ret_w;
elsif (nm_campo_w	= 'IE_CONTA_FIM_DIA') then
	ds_retorno_w 	:= ie_conta_fim_dia_w;
elsif (nm_campo_w	= 'IE_COBERTURA') then
	ds_retorno_w 	:= ie_cobertura_w;
elsif (nm_campo_w	= 'CD_ANS') then
	ds_retorno_w 	:= cd_ans_w;
elsif (nm_campo_w	= 'IE_EXIGE_PASSAPORTE_PACIENTE') then
	ds_retorno_w 	:= ie_exige_passaporte_paciente_w;
elsif (nm_campo_w	= 'IE_CONV_CATEG_GLOSA') then
	ds_retorno_w    := ie_conv_categ_glosa_w;
elsif (nm_campo_w	= 'IE_EXIGE_CONV_GLOSA') then
	ds_retorno_w    := ie_exige_conv_glosa_w;
elsif (nm_campo_w	= 'IE_EXIGE_USUARIO_GLOSA') then
	ds_retorno_w    := ie_exige_usuario_glosa_w;
elsif (nm_campo_w	= 'IE_EXIGE_COMPL_GLOSA') then
	ds_retorno_w    := ie_exige_compl_glosa_w;
elsif (nm_campo_w	= 'IE_EXIGE_VALIDADE_GLOSA') then
	ds_retorno_w    := ie_exige_validade_glosa_w;
elsif (nm_campo_w	= 'QT_EXAME_PRESCR') then
	ds_retorno_w	:= qt_exame_prescr_w;
elsif (nm_campo_w	= 'IE_FUNCAO_MEDICO') then
	ds_retorno_w    := ie_funcao_medico_w;
elsif (nm_campo_w	= 'IE_TISS_TIPO_SAIDA') then
	ds_retorno_w    := ie_tiss_tipo_saida_w;
elsif (nm_campo_w	= 'DS_CAMINHO_EXEC') then
	ds_retorno_w    := ds_caminho_exec_w;
elsif (nm_campo_w	= 'IE_GERAR_NF') then
	ds_retorno_w	:= ie_gerar_nf_w;
elsif (nm_campo_w	= 'IE_GERAR_CIHA') then
	ds_retorno_w	:= ie_gerar_ciha_w;
elsif (nm_campo_w	= 'IE_EXIGE_LETRA_CARTEIRA') then
	ds_retorno_w	:= IE_EXIGE_LETRA_CARTEIRA_w;
elsif (nm_campo_w	= 'IE_PERMITE_INTERNAR_EUP') then
	ds_retorno_w	:= IE_PERMITE_INTERNAR_EUP_W;
elsif (nm_campo_w     = 'IE_CALC_PORTE') then
	ds_retorno_w	:= ie_calc_porte_w;
elsif (nm_campo_w     = 'IE_CONSISTE_SEQ_CONTA') then
	ds_retorno_w	:= ie_consiste_seq_conta_w;
end if;

return	ds_retorno_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_valor_conv_estab ( cd_convenio_p bigint, cd_estabelecimento_p bigint, nm_campo_p text) FROM PUBLIC;

