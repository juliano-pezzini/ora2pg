-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_setor (cd_setor_atendimento_p text) RETURNS varchar AS $body$
DECLARE


ds_conversao_w	conversao_meio_externo.cd_externo%type;
ds_retorno_w conversao_meio_externo.cd_externo%type;


BEGIN

select	max(cd_externo)
into STRICT	ds_conversao_w
from	conversao_meio_externo
where	nm_tabela	= 'SETOR_ATENDIMENTO'
and	nm_atributo	= 'CD_SETOR_ATENDIMENTO'
and	cd_interno	= 'SETOR_EPIMED';

if (upper(ds_conversao_w) = 'EPIMED') then

	SELECT Max(cd_setor_atendimento)
	into STRICT ds_retorno_w
	FROM SETOR_ATENDIMENTO
    WHERE IE_EPIMED = 'S'
    AND ie_situacao = 'A'
	AND cd_setor_atendimento = cd_setor_atendimento_p;

elsif (ds_conversao_w IS NOT NULL AND ds_conversao_w::text <> '') then
	ds_retorno_w := ds_conversao_w;
end if;

return ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_setor (cd_setor_atendimento_p text) FROM PUBLIC;

