-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pep_obter_pastas_visi_item_js ( nr_seq_item_pront_p bigint, cd_perfil_p bigint, ie_retorno_p text default 'C') RETURNS varchar AS $body$
DECLARE



ds_retorno_w	varchar(2000) := '';



BEGIN

if (nr_seq_item_pront_p IS NOT NULL AND nr_seq_item_pront_p::text <> '') then
	begin
	if (ie_retorno_p = 'C') then
		ds_retorno_w :=  obter_select_concatenado_bv('	SELECT	a.nr_seq_dic_obj
														FROM perfil e,
															perfil_item_pront d,
															perfil_item_pront_pasta c,
															prontuario_item_pasta b,
															prontuario_pasta a
														WHERE	a.nr_sequencia = b.nr_seq_pasta
														AND	b.nr_sequencia = c.nr_seq_item_pasta
														AND	d.nr_sequencia = c.nr_seq_item_perfil
														AND	d.cd_perfil = :cd_perfil_p
														AND	d.nr_seq_item_pront = :nr_seq_item_pront_p
														AND	NVL(e.cd_estabelecimento, :cd_estalecimento_p) = :cd_estalecimento_p
														AND	d.cd_perfil = e.cd_perfil
														AND	a.ie_situacao ='|| chr(39) || 'A' || chr(39),
														'cd_perfil_p=' || cd_perfil_p || ';nr_seq_item_pront_p=' || nr_seq_item_pront_p || ';cd_estalecimento_p=' || wheb_usuario_pck.get_cd_estabelecimento, ',' || chr(13));
	elsif (ie_retorno_p = 'N')then
		ds_retorno_w :=  obter_select_concatenado_bv('	SELECT	f.NM_OBJETO
														FROM perfil e,
															perfil_item_pront d,
															perfil_item_pront_pasta c,
															prontuario_item_pasta b,
															prontuario_pasta a,
															dic_objeto f
														WHERE	a.nr_sequencia = b.nr_seq_pasta
														AND	b.nr_sequencia = c.nr_seq_item_pasta
														AND	d.nr_sequencia = c.nr_seq_item_perfil
														AND	a.nr_seq_dic_obj = f.nr_sequencia
														AND	d.cd_perfil = :cd_perfil_p
														AND	d.nr_seq_item_pront = :nr_seq_item_pront_p
														AND	NVL(e.cd_estabelecimento, :cd_estalecimento_p) = :cd_estalecimento_p
														AND	d.cd_perfil = e.cd_perfil
														AND	a.ie_situacao ='|| chr(39) || 'A' || chr(39),
														'cd_perfil_p=' || cd_perfil_p || ';nr_seq_item_pront_p=' || nr_seq_item_pront_p || ';cd_estalecimento_p=' || wheb_usuario_pck.get_cd_estabelecimento, ',' || chr(13));
	elsif (ie_retorno_p = 'I')then
		ds_retorno_w :=  obter_select_concatenado_bv('	SELECT	a.nr_seq_dic_obj||'|| chr(39) || ';' || chr(39)||'||
																nvl(DS_ENDERECO_CLASSE,'|| chr(39) || ' ' || chr(39)||')||'|| chr(39) || ';' || chr(39)||'||
																nvl(NR_SEQ_PASTA_SUPERIOR,0)||'|| chr(39) || ';' || chr(39)||'||
																nvl(obter_desc_pastas_pep(d.nr_seq_item_pront,a.nr_seq_dic_obj),substr(obter_desc_expressao(cd_exp_texto),1,254))
														FROM perfil e,
															perfil_item_pront d,
															perfil_item_pront_pasta c,
															prontuario_item_pasta b,
															prontuario_pasta a,
															dic_objeto f
														WHERE	a.nr_sequencia = b.nr_seq_pasta
														AND	b.nr_sequencia = c.nr_seq_item_pasta
														AND	d.nr_sequencia = c.nr_seq_item_perfil
														AND	a.nr_seq_dic_obj = f.nr_sequencia
														AND	d.cd_perfil = :cd_perfil_p
														AND	d.nr_seq_item_pront = :nr_seq_item_pront_p
														AND	NVL(e.cd_estabelecimento, :cd_estalecimento_p) = :cd_estalecimento_p
														AND	d.cd_perfil = e.cd_perfil
														AND	a.ie_situacao ='|| chr(39) || 'A' || chr(39),
														'cd_perfil_p=' || cd_perfil_p || ';nr_seq_item_pront_p=' || nr_seq_item_pront_p || ';cd_estalecimento_p=' || wheb_usuario_pck.get_cd_estabelecimento, ',' || chr(13));
	elsif (ie_retorno_p = 'IC')then
		ds_retorno_w :=  obter_select_concatenado_bv('	SELECT	a.nr_seq_dic_obj
														FROM perfil e,
															perfil_item_pront d,
															perfil_item_pront_pasta c,
															prontuario_item_pasta b,
															prontuario_pasta a
														WHERE	a.nr_sequencia = b.nr_seq_pasta
														AND	b.nr_sequencia = c.nr_seq_item_pasta
														AND	d.nr_sequencia = c.nr_seq_item_perfil
														AND	d.cd_perfil = :cd_perfil_p
														AND	d.nr_seq_item_pront = :nr_seq_item_pront_p
														AND	NVL(e.cd_estabelecimento, :cd_estalecimento_p) = :cd_estalecimento_p
														AND	d.cd_perfil = e.cd_perfil
														and	nvl(NR_SEQ_PASTA_SUPERIOR,0) > 0
														AND	a.ie_situacao ='|| chr(39) || 'A' || chr(39),
														'cd_perfil_p=' || cd_perfil_p || ';nr_seq_item_pront_p=' || nr_seq_item_pront_p || ';cd_estalecimento_p=' || wheb_usuario_pck.get_cd_estabelecimento, ',' || chr(13));
	end if;
	end;

end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pep_obter_pastas_visi_item_js ( nr_seq_item_pront_p bigint, cd_perfil_p bigint, ie_retorno_p text default 'C') FROM PUBLIC;

