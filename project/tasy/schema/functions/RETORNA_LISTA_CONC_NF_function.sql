-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION retorna_lista_conc_nf (nr_sequencia_p caixa_receb.nr_sequencia%type) RETURNS varchar AS $body$
DECLARE


nr_sequencia_w caixa_receb.nr_sequencia%type := nr_sequencia_p;
retorno_w titulo_receber_liq.ds_stack%type;
concat_w constant  titulo_receber_liq.ie_acao%type := ';';

lista_nf CURSOR FOR
    SELECT distinct c.nr_seq_nf_saida
    from caixa_receb a, titulo_receber_liq b, titulo_receber c
    where b.nr_seq_caixa_rec = a.nr_sequencia
    and c.nr_titulo = b.nr_titulo
    and (c.nr_nota_fiscal IS NOT NULL AND c.nr_nota_fiscal::text <> '')
    and a.nr_sequencia = nr_sequencia_w;

BEGIN
    IF (nr_sequencia_w IS NOT NULL AND nr_sequencia_w::text <> '') THEN
        
        <<CONCATENAR_NOTAS_FISCAIS>>
        FOR nf in lista_nf LOOP
            IF (coalesce(retorno_w::text, '') = '') THEN
                retorno_w := nf.nr_seq_nf_saida;
            ELSE
                retorno_w := retorno_w||concat_w||nf.nr_seq_nf_saida;
            END IF;
        END LOOP CONCATENAR_NOTAS_FISCAIS;

    END IF;

    RETURN retorno_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION retorna_lista_conc_nf (nr_sequencia_p caixa_receb.nr_sequencia%type) FROM PUBLIC;

