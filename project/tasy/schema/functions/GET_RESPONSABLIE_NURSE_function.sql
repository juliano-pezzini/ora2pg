-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_responsablie_nurse (nr_atendimento_p atend_profissional.nr_atendimento%type, option_p text) RETURNS varchar AS $body$
DECLARE


nr_seq_phs_w	atend_profissional.nr_seq_phs%type;
phs_number_w    phs_phone_number.nr_phs%type;

c1 CURSOR FOR
SELECT   nr_seq_phs from (
    SELECT  ap.nr_seq_phs
    from    atend_profissional ap
    where   ap.nr_atendimento = nr_atendimento_p
    order by ap.nr_sequencia desc
) alias0 LIMIT 1;


BEGIN
open c1;
loop
    fetch c1 into
        nr_seq_phs_w;
    EXIT WHEN NOT FOUND; /* apply on c1 */
end loop;
close c1;

if option_p =  'N' then    
    return obter_prof_atend_vig(nr_atendimento_p);
else
    select coalesce(phs.nr_phs,'0')
    into STRICT phs_number_w
    from phs_phone_number phs where phs.nr_sequencia=nr_seq_phs_w;
    return phs_number_w;
end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_responsablie_nurse (nr_atendimento_p atend_profissional.nr_atendimento%type, option_p text) FROM PUBLIC;

