-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION buscar_desc_auditoria (p_vl_dominio text) RETURNS varchar AS $body$
DECLARE


v_ds_result	varchar(255)	:= '';
v_ds_dominio varchar(255)	:= '';
v_ds_regra varchar(255)	:= '';

/*
C	Conforme
NA	Não se aplica
NC	Não conforme
PC	Parcialmente conforme
*/
BEGIN

    select  Obter_Valor_Dominio(1290, p_vl_dominio)
    into STRICT    v_ds_dominio
;

    select	substr(max(r.ds_resultado), 1, 255)
    into STRICT    v_ds_regra
    from 	regra_result_audit r
    where   r.ie_resultado = p_vl_dominio
    and     r.ie_situacao = 'A'
    and (r.ds_resultado IS NOT NULL AND r.ds_resultado::text <> '');

    if (v_ds_regra IS NOT NULL AND v_ds_regra::text <> '') then
        v_ds_result := v_ds_regra;
    else
        v_ds_result := v_ds_dominio;
    end if;

    return v_ds_result;
exception
  when OTHERS then
    return '';

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION buscar_desc_auditoria (p_vl_dominio text) FROM PUBLIC;

