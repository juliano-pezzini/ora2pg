-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_valor_bandeira_estab ( nr_seq_bandeira_p bigint, cd_estabelecimento_p bigint, nm_campo_p text) RETURNS varchar AS $body$
DECLARE


ds_retorno_w			varchar(255);

nr_seq_bandeira_w		bigint;
nr_seq_conta_banco_w		bigint;
nr_seq_trans_financ_w		bigint;
nr_seq_trans_fin_caixa_w	bigint;
nr_seq_trans_fin_desp_w		bigint;
nr_seq_trans_desp_equip_w	bigint;
nr_seq_trans_indevido_w		bigint;
nm_objeto_extrato_w		varchar(255);
cd_sitef_w			varchar(10);

qt_registro_w			bigint;
nr_seq_trans_negociacao_w	bigint;


BEGIN

ds_retorno_w	:= null;

/* Obter dados da bandeira */

select	a.nr_seq_conta_banco,
	a.nr_seq_trans_financ,
	a.nr_seq_trans_fin_caixa,
	a.nr_seq_trans_fin_desp,
	a.nr_seq_trans_desp_equip,
	a.nr_seq_trans_indevido,
	a.nm_objeto_extrato,
	a.cd_sitef,
	a.nr_seq_trans_negociacao
into STRICT	nr_seq_conta_banco_w,
	nr_seq_trans_financ_w,
	nr_seq_trans_fin_caixa_w,
	nr_seq_trans_fin_desp_w,
	nr_seq_trans_desp_equip_w,
	nr_seq_trans_indevido_w,
	nm_objeto_extrato_w,
	cd_sitef_w,
	nr_seq_trans_negociacao_w
from	bandeira_cartao_cr a
where	a.nr_sequencia		= nr_seq_bandeira_p;


select	count(*)
into STRICT	qt_registro_w
from	bandeira_cartao_estab
where	nr_seq_bandeira		= nr_seq_bandeira_p
and	cd_estabelecimento	= cd_estabelecimento_p;

if (qt_registro_w > 0) then

	select	b.nr_seq_conta_banco,
		b.nr_seq_trans_financ,
		b.nr_seq_trans_fin_caixa,
		b.nr_seq_trans_fin_desp,
		b.nr_seq_trans_desp_equip,
		b.nr_seq_trans_indevido,
		b.nm_objeto_extrato,
		b.cd_sitef,
		b.nr_seq_trans_negociacao
	into STRICT	nr_seq_conta_banco_w,
		nr_seq_trans_financ_w,
		nr_seq_trans_fin_caixa_w,
		nr_seq_trans_fin_desp_w,
		nr_seq_trans_desp_equip_w,
		nr_seq_trans_indevido_w,
		nm_objeto_extrato_w,
		cd_sitef_w,
		nr_seq_trans_negociacao_w
	from	bandeira_cartao_estab b,
		bandeira_cartao_cr a
	where	a.nr_sequencia		= b.nr_seq_bandeira
	and	a.nr_sequencia		= nr_seq_bandeira_p
	and	b.cd_estabelecimento	= cd_estabelecimento_p;
end if;

if (upper(nm_campo_p) = 'NR_SEQ_CONTA_BANCO') then
	ds_retorno_w	:= nr_seq_conta_banco_w;
elsif (upper(nm_campo_p) = 'NR_SEQ_TRANS_FINANC') then
	ds_retorno_w	:= nr_seq_trans_financ_w;
elsif (upper(nm_campo_p) = 'NR_SEQ_TRANS_FIN_CAIXA') then
	ds_retorno_w	:= nr_seq_trans_fin_caixa_w;
elsif (upper(nm_campo_p) = 'NR_SEQ_TRANS_FIN_DESP') then
	ds_retorno_w	:= nr_seq_trans_fin_desp_w;
elsif (upper(nm_campo_p) = 'NR_SEQ_TRANS_DESP_EQUIP') then
	ds_retorno_w	:= nr_seq_trans_desp_equip_w;
elsif (upper(nm_campo_p) = 'NR_SEQ_TRANS_INDEVIDO') then
	ds_retorno_w	:= nr_seq_trans_indevido_w;
elsif (upper(nm_campo_p) = 'NM_OBJETO_EXTRATO') then
	ds_retorno_w	:= nm_objeto_extrato_w;
elsif (upper(nm_campo_p) = 'CD_SITEF') then
	ds_retorno_w	:= cd_sitef_w;
elsif (upper(nm_campo_p) = 'NR_SEQ_TRANS_NEGOCIACAO') then
	ds_retorno_w	:= cd_sitef_w;
end if;

return ds_retorno_w;


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_valor_bandeira_estab ( nr_seq_bandeira_p bigint, cd_estabelecimento_p bigint, nm_campo_p text) FROM PUBLIC;

