-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_sinal_vital_grafico ( nr_atendimento_p bigint, nr_cirurgia_p bigint, ie_sinal_p text) RETURNS bigint AS $body$
DECLARE

 
qt_sinal_vital_w 	double precision;
nr_apae_vinc_w		bigint;

BEGIN
 
if (ie_sinal_p = 'Peso') 	then 
	Select 	coalesce(obter_sinal_vital(nr_atendimento_p,'Peso'),0) 
	into STRICT	qt_sinal_vital_w	 
	;
	 
	if (qt_sinal_vital_w = 0) and (nr_cirurgia_p > 0)	then 
		select 	coalesce(max(qt_peso),0) 
		into STRICT	qt_sinal_vital_w 
		from	cirurgia 
		where	nr_cirurgia 	= 	nr_cirurgia_p;
		 
		if (qt_sinal_vital_w = 0) and (nr_cirurgia_p > 0)	then 
			 
			select 	coalesce(max(nr_sequencia),0) 
			into STRICT	nr_apae_vinc_w 
			from	aval_pre_anestesica 
			where	nr_cirurgia	=	nr_cirurgia_p;
			 
			if (nr_apae_vinc_w > 0) then 
				select 	coalesce(max(qt_peso),0) 
				into STRICT	qt_sinal_vital_w 
				from	exame_fisico_apae 
				where	nr_seq_aval_pre	=	nr_apae_vinc_w;	
				 
			end if;
		 
		end if;		
	end if;
elsif (ie_sinal_p = 'Altura') then 
	Select 	coalesce(obter_sinal_vital(nr_atendimento_p,'Altura'),0) 
	into STRICT	qt_sinal_vital_w	 
	;
	 
	if (qt_sinal_vital_w = 0) and (nr_cirurgia_p > 0)	then 
		 
		select 	coalesce(max(nr_sequencia),0) 
		into STRICT	nr_apae_vinc_w 
		from	aval_pre_anestesica 
		where	nr_cirurgia	=	nr_cirurgia_p;
		 
		if (nr_apae_vinc_w > 0) then 
			select 	coalesce(max(qt_altura_cm),0) 
			into STRICT	qt_sinal_vital_w 
			from	exame_fisico_apae 
			where	nr_seq_aval_pre	=	nr_apae_vinc_w;	
			 
		end if;
	 
	end if;		
end if;
 
if (qt_sinal_vital_w = 0) then 
	qt_sinal_vital_w := null;
end if;
 
return	qt_sinal_vital_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_sinal_vital_grafico ( nr_atendimento_p bigint, nr_cirurgia_p bigint, ie_sinal_p text) FROM PUBLIC;

