-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_simpro_seq (nr_seq_simp_preco_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


/* opções simpro

	COD = código simpro
	TP = tipo de preço
	TPE = tipo de embalagem
	TPF = tipo de fração
	EM = quantidade embalagem
	FR = quantidade fração
	PFF = preço fabrica fração
	RANV = registro anvisa
	TL = tipo de lista
	RES = restrito
	FRA = fracionado
	TUSS = código tuss
	PROD = descrição do produto
	FAB = fabricante
	DTFL = data fora linha

*/
ds_retorno_w			varchar(255)	:= '';
cd_simpro_w			bigint;
ie_tipo_preco_w			varchar(1);
ie_tipo_embalagem_w		varchar(3);
ie_tipo_fracao_w		varchar(4);
qt_embalagem_w			double precision;
qt_fracao_w 			double precision;
vl_preco_fabrica_fracao_w	double precision;
nr_reg_anvisa_w			varchar(18);
ie_tipo_lista_w			varchar(1);
ie_restrito_w			varchar(1);
ie_fracionado_w			varchar(1);
cd_tuss_w			bigint;
ds_produto_w			varchar(100);
cd_fabricante_w			varchar(20);
dt_fora_linha_item_w		varchar(15);



BEGIN

if (coalesce(nr_seq_simp_preco_p,0) > 0) then

	select	max(cd_simpro),
		max(ie_tipo_preco),
		max(ie_tipo_embalagem),
		max(ie_tipo_fracao),
		max(qt_embalagem),
		max(qt_fracao),
		max(vl_preco_fabrica_fracao),
		max(nr_reg_anvisa),
		max(ie_tipo_lista),
		max(ie_restrito),
		max(ie_fracionado),
		max(cd_tuss),
		max(dt_fora_linha_item)
	into STRICT	cd_simpro_w,
		ie_tipo_preco_w,
		ie_tipo_embalagem_w,
		ie_tipo_fracao_w,
		qt_embalagem_w,
		qt_fracao_w,
		vl_preco_fabrica_fracao_w,
		nr_reg_anvisa_w,
		ie_tipo_lista_w,
		ie_restrito_w,
		ie_fracionado_w,
		cd_tuss_w,
		dt_fora_linha_item_w
	from	simpro_preco
	where	nr_sequencia = nr_seq_simp_preco_p;

	select	max(ds_produto),
		max(cd_fabricante)
	into STRICT	ds_produto_w,
		cd_fabricante_w
	from	simpro_cadastro
	where	cd_simpro = cd_simpro_w;

	if (ie_opcao_p = 'COD') then
		ds_retorno_w	:= cd_simpro_w;
	elsif (ie_opcao_p = 'TP') then
		ds_retorno_w	:= ie_tipo_preco_w;
	elsif (ie_opcao_p = 'TPE') then
		ds_retorno_w	:= ie_tipo_embalagem_w;
	elsif (ie_opcao_p = 'TPF') then
		ds_retorno_w	:= ie_tipo_fracao_w;
	elsif (ie_opcao_p = 'EM') then
		ds_retorno_w	:= qt_embalagem_w;
	elsif (ie_opcao_p = 'FR') then
		ds_retorno_w	:= qt_fracao_w;
	elsif (ie_opcao_p = 'PFF') then
		ds_retorno_w	:= vl_preco_fabrica_fracao_w;
	elsif (ie_opcao_p = 'RANV') then
		ds_retorno_w	:= nr_reg_anvisa_w;
	elsif (ie_opcao_p = 'TL') then
		ds_retorno_w	:= ie_tipo_lista_w;
	elsif (ie_opcao_p = 'RES') then
		ds_retorno_w	:= ie_restrito_w;
	elsif (ie_opcao_p = 'FRA') then
		ds_retorno_w	:= ie_fracionado_w;
	elsif (ie_opcao_p = 'TUSS') then
		ds_retorno_w	:= cd_tuss_w;
	elsif (ie_opcao_p = 'PROD') then
		ds_retorno_w	:= ds_produto_w;
	elsif (ie_opcao_p = 'FAB') then
		ds_retorno_w	:= cd_fabricante_w;
	elsif (ie_opcao_p = 'DTFL') then
		ds_retorno_w	:= to_char(dt_fora_linha_item_w,'dd/mm/yyyy');
	end if;

end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_simpro_seq (nr_seq_simp_preco_p bigint, ie_opcao_p text) FROM PUBLIC;

