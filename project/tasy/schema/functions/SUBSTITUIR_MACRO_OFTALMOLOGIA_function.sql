-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION substituir_macro_oftalmologia ( cd_pessoa_fisica_pac_p text, nr_atendimento_p text, cd_pessoa_fisica_usu_p text, nr_seq_consulta_p text, nm_macro_p text) RETURNS varchar AS $body$
DECLARE

nm_atributo_w	varchar(50);
ds_macro_w	varchar(2000) := '';

BEGIN
if (nm_macro_p IS NOT NULL AND nm_macro_p::text <> '') then 
	begin 
	select	upper(max(nm_atributo)) 
	into STRICT	nm_atributo_w 
	from 	macro_prontuario 
	where	upper(nm_macro) = upper(nm_macro_p);
	if (nm_atributo_w IS NOT NULL AND nm_atributo_w::text <> '') then 
		begin 
		if (nm_atributo_w = 'CD_PESSOA_FISICA') and (cd_pessoa_fisica_pac_p IS NOT NULL AND cd_pessoa_fisica_pac_p::text <> '') then 
			begin 
			ds_macro_w := substituir_macro_texto_tasy(upper(nm_macro_p), nm_atributo_w, cd_pessoa_fisica_pac_p);
			end;
		elsif (nm_atributo_w = 'NR_ATENDIMENTO') and (nr_atendimento_p IS NOT NULL AND nr_atendimento_p::text <> '') then 
			begin 
			ds_macro_w := substituir_macro_texto_tasy(upper(nm_macro_p), nm_atributo_w, nr_atendimento_p);
			end;
		elsif (nm_atributo_w = 'CD_PESSOA_USUARIO') and (cd_pessoa_fisica_usu_p IS NOT NULL AND cd_pessoa_fisica_usu_p::text <> '') then 
			begin 
			ds_macro_w := substituir_macro_texto_tasy(upper(nm_macro_p), nm_atributo_w, cd_pessoa_fisica_usu_p);
			end;
		elsif (nm_atributo_w = 'NR_SEQ_CONSULTA') and (nr_seq_consulta_p IS NOT NULL AND nr_seq_consulta_p::text <> '') then 
			begin 
			ds_macro_w := substituir_macro_texto_tasy(upper(nm_macro_p), nm_atributo_w, nr_seq_consulta_p);
			end;	
		else 
			begin 
			ds_macro_w := substituir_macro_texto_tasy(upper(nm_macro_p), nm_atributo_w, '');
			end;
		end if;
		end;
	end if;
	end;
end if;
return ds_macro_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION substituir_macro_oftalmologia ( cd_pessoa_fisica_pac_p text, nr_atendimento_p text, cd_pessoa_fisica_usu_p text, nr_seq_consulta_p text, nm_macro_p text) FROM PUBLIC;

