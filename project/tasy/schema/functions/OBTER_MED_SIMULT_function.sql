-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_med_simult (cd_pessoa_fisica_p text default null, nm_maquina_p text default null, cd_maquina_ip_p text default null) RETURNS varchar AS $body$
DECLARE


ds_retorno_w		varchar(200);
nr_seq_terminal_w	man_equipamento_terminal.nr_sequencia%type;
nr_seq_equipamento_w	man_equipamento_terminal.nr_seq_equipamento%type;


BEGIN
if (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') then
	begin

    if (coalesce(pkg_i18n.get_user_locale, 'pt_BR') = 'ja_JP') then
      select substr(obter_nome_pessoa_fisica(cd_pessoa_fisica_p, null) || ' ' || obter_departamento_medico(cd_pessoa_fisica_p) || ', ' || coalesce(obter_compl_pf(cd_pessoa_fisica_p, 2, 'CEL'), obter_compl_pf(cd_pessoa_fisica_p, 2, 'T')), 1, 200)
      into STRICT ds_retorno_w
;

    elsif (coalesce(pkg_i18n.get_user_locale, 'pt_BR') <> 'ja_JP') then
        select substr(obter_nome_pessoa_fisica(cd_pessoa_fisica_p, null), 1, 200)
        into STRICT ds_retorno_w
;
    end if;
	end;
end if;

if ((nm_maquina_p IS NOT NULL AND nm_maquina_p::text <> '') or
	(cd_maquina_ip_p IS NOT NULL AND cd_maquina_ip_p::text <> '')) then
	begin
		select		max(met.nr_sequencia),
					max(met.nr_seq_equipamento)
		into STRICT 		nr_seq_terminal_w,
					nr_seq_equipamento_w
		from 	man_equipamento_terminal met
		where (met.ds_hostname = nm_maquina_p or met.ds_ipv4 = cd_maquina_ip_p)  LIMIT 1;
	
	end;
	if (nr_seq_terminal_w IS NOT NULL AND nr_seq_terminal_w::text <> '') THEN
		ds_retorno_w := ds_retorno_w || obter_desc_expressao(311718) || ': ' || nr_seq_terminal_w || ' - ' ||
			obter_desc_expressao(10651978) || ': ' || nr_seq_equipamento_w || ' - ' ||
			obter_desc_expressao(629943) || ': ' || nm_maquina_p || ' - ' ||
			obter_desc_expressao(289242) || ': ' || cd_maquina_ip_p;
	end if;
end if;

if (ds_retorno_w IS NOT NULL AND ds_retorno_w::text <> '') then
    ds_retorno_w := '<span class="ds_material_data">' || ds_retorno_w || '</span>';
end if;

return coalesce(ds_retorno_w, '');

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_med_simult (cd_pessoa_fisica_p text default null, nm_maquina_p text default null, cd_maquina_ip_p text default null) FROM PUBLIC;

