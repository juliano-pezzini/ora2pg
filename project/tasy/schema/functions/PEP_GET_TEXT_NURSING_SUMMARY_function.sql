-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pep_get_text_nursing_summary (ie_type_p sumario_enfermagem.ie_sumario_enf_lista%type, nr_atendimento_p enferm_perfil_feridas.nr_atendimento%type ) RETURNS text AS $body$
DECLARE


ds_retorno_w  varchar(32764);


BEGIN
        ds_retorno_w := '';

        if upper(ie_type_p) = '3'
        then

                select 
                rtrim(xmlagg(XMLELEMENT(name e, ds_field || ' ') order by ds_field).extract('//text()'), ', ') into STRICT ds_retorno_w
                FROM (

                        SELECT 
                        
                                trim(both obter_desc_expressao(596380)) || ' : '  ||
                                coalesce(cast(c.nr_prontuario as varchar(20)),'') || '\' || c.cd_pessoa_fisica || ' \r\n' ||

                                --trim(obter_desc_expressao(963540)) || ' : '  ||
                                --d.ds_kanji_name || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(298476)) || ' : '  ||
                                c.ie_sexo || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(287065)) || ' : '  ||
                                c.dt_nascimento || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(315123)) || ' : '  ||
                                a.ds_inf_med_outros || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(1042361)) || ' : '  ||
                                a.ie_inf_med_escaras || ' \r\n'  ||
                                
                                trim(both obter_desc_expressao(315123)) || ' : '  ||
                                a.ie_inf_med_sacral || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(315123)) || ' : '  ||
                                a.ie_inf_med_iliaca || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(315123)) || ' : '  ||
                                a.ie_inf_med_mand || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(315123)) || ' : '  ||
                                a.ie_inf_med_troc || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(315123)) || ' : '  ||
                                a.ie_inf_med_cocc || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(315123)) || ' : '  ||
                                a.ie_inf_med_calc || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(315123)) || ' : '  ||
                                a.ie_braden_escala || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(1052597)) || ' : '  ||
                                a.ie_inf_med_vida || ' \r\n' as ds_field
                        
                        FROM enferm_perfil a, pessoa_fisica c
LEFT OUTER JOIN person_name d ON (c.nr_seq_person_name = d.nr_sequencia)
WHERE a.nr_atendimento = nr_atendimento_p and a.cd_pessoa_fisica = c.cd_pessoa_fisica  
union all
 
                        
                        SELECT 
                                trim(both obter_desc_expressao(1052306)) || ' : '  ||
                                d.ie_comb_aut_sust || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(1051274)) || ' : '  ||
                                d.ie_mov_bed || ' \r\n' || 
                                
                                trim(both obter_desc_expressao(673719)) || ' : '  ||
                                d.ie_mov_main_post || ' \r\n' || 
                                
                                trim(both obter_desc_expressao(673719)) || ' : '  ||
                                d.ie_mon_decom_pos || ' \r\n' || 
                                
                                trim(both obter_desc_expressao(1051288)) || ' : '  ||
                                d.ie_patol_osso || ' \r\n' || 
                                
                                trim(both obter_desc_expressao(1051290)) || ' : '  ||
                                d.ie_artrogripose || ' \r\n' || 
                                
                                trim(both obter_desc_expressao(1051292)) || ' : '  ||
                                d.ie_est_nutr_dim || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(1051294)) || ' : '  ||
                                d.ie_pele_fragil || ' \r\n' || 
                                
                                trim(both obter_desc_expressao(1051294)) || ' : '  ||
                                d.ie_hiperidrose || ' \r\n' || 
                                
                                trim(both obter_desc_expressao(1051294)) || ' : '  ||
                                d.ie_incont_urinaria || ' ' || 
                                
                                trim(both obter_desc_expressao(1051294)) || ' : '  ||
                                d.ie_incont_fecal || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(1051306)) || ' : '  ||
                                d.ie_vuln_pele_edema || ' ' || 
                                
                                --trim(obter_desc_expressao(309311)) || ' : '  ||
                                --'braden scale - function' || ' \r\n' || 
                                
                                trim(both obter_desc_expressao(314977)) || ' : '  ||
                                d.ie_feridas || ' \r\n' || 
                                
                                trim(both obter_desc_expressao(315123)) || ' : '  ||
                                d.ie_ferida_momento || ' \r\n' || 
                                
                                trim(both obter_desc_expressao(1051312)) || ' : '  ||
                                d.ie_sacral || ' ' ||
                                
                                trim(both obter_desc_expressao(1051314)) || ' : '  ||
                                d.ie_isquietica || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(1051316)) || ' : '  ||
                                d.ie_pelvica_post || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(1051318)) || ' : '  ||
                                d.ie_iliaca || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(1051320)) || ' : '  ||
                                d.ie_trocanter_maior || ' \r\n' || 
                                
                                trim(both obter_desc_expressao(294286)) || ' : '  ||
                                d.ds_ferida || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(761158)) || ' : '  ||
                                d.dt_ocorrencia_ferida || ' ' ||
                                
                                trim(both obter_desc_expressao(299172)) || ' : '  ||
                                d.ie_hist_feridas || ' \r\n' || 
                                
                                trim(both obter_desc_expressao(644580))  || '  ' || trim(both obter_desc_expressao(1051312))  || ' : '  ||
                                d.ie_hist_sacral || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(644580))  || '  ' || trim(both obter_desc_expressao(1051314))  || ' : '  ||
                                d.ie_hist_isquiatica || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(644580))  || '  ' || trim(both obter_desc_expressao(1051316))  || ' : '  ||
                                d.ie_hist_pelv_post || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(644580))  || '  ' || trim(both obter_desc_expressao(1051318))  || ' : '  ||
                                d.ie_hist_iliaca || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(644580))  || '  ' || trim(both obter_desc_expressao(1051320))  || ' : '  ||
                                d.ie_hist_trocan_maior || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(644580))  || '  ' || trim(both obter_desc_expressao(1051322))  || ' : '  ||
                                d.ie_hist_calcanea || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(294286))  || ' : '  ||
                                d.ds_hist_ferida || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(1045733)) || ' : '  ||
                                d.ie_desc_cama || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(1051328)) || ' : '  ||
                                d.ie_est_choque || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(1051330)) || ' : '  ||
                                d.ie_insuf_circul || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(1051332)) || ' : '  ||
                                d.ie_cont_analg || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(1051336)) || ' : '  ||
                                d.ie_surg_seis_horas || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(1051340)) || ' : '  ||
                                d.ie_surg_esp_pos || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(1051344)) || ' : '  ||
                                d.ie_diarreia_pers || ' ' ||
                                
                                trim(both obter_desc_expressao(1051348)) || ' : '  ||
                                d.ie_hidrat_pele || ' \r\n' ||
                                
                                trim(both obter_desc_expressao(1051352)) || ' : '  ||
                                d.ie_uso_med_equip as ds_field
                        
                        from enferm_perfil_feridas d
                        where d.nr_atendimento = nr_atendimento_p
                        
                ) all_items;
        elsif (upper(ie_type_p) = '4')
        then
                select  rtrim(xmlagg(XMLELEMENT(name e, ds_field || ' ') order by ds_field).extract('//text()'), ', ')  into STRICT ds_retorno_w
                FROM (
                SELECT 

                        trim(both obter_desc_expressao(596380)) || ' : '  ||
                        coalesce(cast(c.nr_prontuario as varchar(20)),'') || '\' || c.cd_pessoa_fisica || ' \r\n' ||

                        --trim(obter_desc_expressao(963540)) || ' : '  ||
                        --d.ds_kanji_name || ' \r\n' ||
                        --trim(obter_desc_expressao(963544)) || ' : '  ||
                        --d.ds_katakana_name || ' \r\n' ||
                        trim(both obter_desc_expressao(298476)) || ' : '  ||
                        c.ie_sexo || ' \r\n' ||

                        trim(both obter_desc_expressao(287065)) || ' : '  ||
                        c.dt_nascimento || ' \r\n' ||

                        trim(both obter_desc_expressao(286529)) || ' : '  ||
                        a.dt_admissao || ' \r\n' ||

                        trim(both obter_desc_expressao(289232)) || ' : '  ||
                        e.ds_endereco || ' \r\n' || --DS_ADDRESS_CATALOG
                        trim(both obter_desc_expressao(299149)) || ' : '  ||
                        e.nr_telefone || ' \r\n'  ||


                        trim(both obter_desc_expressao(1035893)) || ' : '  ||
                        a.ds_pessoa_chave || ' \r\n' ||

                        trim(both obter_desc_expressao(317079)) || ' : '  ||
                        a.ie_relacionamento || ' \r\n' ||

                        trim(both obter_desc_expressao(315123)) || ' : '  || -- TROCAR EXP
                        j.ie_dentadura  || ' \r\n' ||

                        trim(both obter_desc_expressao(682551)) || ' : '  ||
                        f.ie_autocuidado_refeicao || ' \r\n' ||

                        trim(both obter_desc_expressao(1050830)) || ' : '  ||
                        f.ie_autocuidado_postura || ' \r\n' ||





                        trim(both obter_desc_expressao(1050834)) || ' : '  ||
                        f.ie_autocuidado_banheiro || ' \r\n' ||

                        trim(both obter_desc_expressao(1035086)) || ' : '  ||
                        f.ie_autocuidado_roupa || ' \r\n' ||


                        trim(both obter_desc_expressao(1052135)) || ' : '  ||
                        g.ie_deficiencia_auditiva || ' \r\n' ||


                        --trim(obter_desc_expressao(1052135)) || ' : '  ||
                        --g.cd_deficiencia_ouv || ' \r\n' ||
                        --trim(obter_desc_expressao(1052137)) || ' : '  ||
                        --g.cd_otofone || ' \r\n' ||
                        trim(both obter_desc_expressao(1047519)) || ' : '  ||
                        g.ie_linguagem_sinais || ' \r\n' ||

                        trim(both obter_desc_expressao(753406)) || ' : '  ||
                        g.ds_obs_deficiencia_aud || ' \r\n' ||

                        trim(both obter_desc_expressao(287367)) || ' : '  ||
                        g.ie_deficiencia_visual || ' \r\n' ||

                        --trim(obter_desc_expressao(287367)) || ' : '  ||
                        --g.cd_deficiencia_visual || ' \r\n' ||
                        --trim(obter_desc_expressao(1052140)) || ' : '  ||
                        --g.cd_olho_artificial || ' \r\n' ||
                        trim(both obter_desc_expressao(1052142)) || ' : '  ||
                        g.ie_bengala_branca || ' \r\n' ||


                        trim(both obter_desc_expressao(1047511)) || ' : '  ||
                        g.ie_cao_guia || ' \r\n' ||

                        trim(both obter_desc_expressao(1052144)) || ' : '  ||
                        g.ie_braille || ' \r\n' ||

                        trim(both obter_desc_expressao(753406)) || ' : '  ||
                        g.ds_obs_deficiencia_vis || ' \r\n' ||


                        trim(both obter_desc_expressao(1051826)) || ' : '  ||
                        h.ds_item_inspecao || ' \r\n' ||



                        trim(both obter_desc_expressao(1051826)) || ' : '  ||
                        h.ds_item_inspecao || ' \r\n' ||

                        trim(both obter_desc_expressao(772913)) || ' : '  ||
                        h.dt_inspecao || ' \r\n' ||

                        trim(both obter_desc_expressao(297815)) || ' : '  ||
                        h.ds_resultado || ' \r\n' ||

                        trim(both obter_desc_expressao(285521)) || ' : '  ||
                        h.ds_comentario || ' \r\n' ||


                        trim(both obter_desc_expressao(315123)) || ' : '  ||
                        f.ie_movimento || ' \r\n' ||

                        trim(both obter_desc_expressao(315123)) || ' : '  ||
                        f.ie_movimento_cima_direita || ' \r\n' ||

                        trim(both obter_desc_expressao(315123)) || ' : '  ||
                        f.ie_movimento_cima_esquerda || ' \r\n' ||

                        trim(both obter_desc_expressao(315123)) || ' : '  ||
                        f.ie_movimento_baixo_direita || ' \r\n' ||

                        trim(both obter_desc_expressao(315123)) || ' : '  ||
                        f.ie_movimento_baixo_esquerda || ' \r\n' ||

                        trim(both obter_desc_expressao(315123)) || ' : '  ||
                        f.ie_movimento_cervical || ' \r\n' ||


                        trim(both obter_desc_expressao(315123)) || ' : '  ||
                        f.ie_movimento_torax || ' \r\n' ||

                        trim(both obter_desc_expressao(315123)) || ' : '  ||
                        f.IE_MOVIMENTO_LOMBAR || ' \r\n' ||

                        trim(both obter_desc_expressao(315123)) || ' : '  ||
                        f.ds_movimento || ' \r\n' ||

                        trim(both obter_desc_expressao(315123)) || ' : '  ||
                        f.ie_autocuidado_excrecao || ' \r\n' ||

                        trim(both obter_desc_expressao(315123)) || ' : '  ||
                        f.ie_autocuidado_urina || ' \r\n' ||

                        trim(both obter_desc_expressao(315123)) || ' : '  ||
                        i.ie_peso_familia_casa || ' \r\n' ||

                        trim(both obter_desc_expressao(315123)) || ' : '  ||
                        i.ds_peso_familia_casa || ' \r\n' ||

                        trim(both obter_desc_expressao(315123)) || ' : '  ||
                        i.ie_comb1_trabalhando || ' \r\n' ||

                        trim(both obter_desc_expressao(315123)) || ' : '  ||
                        i.ds_cons_dom_gerente || ' \r\n' ||

                        trim(both obter_desc_expressao(315123)) || ' : '  ||
                        i.ds_cons_dom_contato || ' \r\n' ||

                        trim(both obter_desc_expressao(315123)) || ' : '  ||
                        i.ie_serv_domestico || ' \r\n' as ds_field

                FROM enferm_perfil a
LEFT OUTER JOIN enferm_perfil_ativ_desc f ON (a.nr_atendimento = f.nr_atendimento)
LEFT OUTER JOIN enferm_perfil_cognicao g ON (a.nr_atendimento = g.nr_atendimento)
LEFT OUTER JOIN enferm_perfil_cr_infec h ON (a.nr_atendimento = h.nr_atendimento)
LEFT OUTER JOIN enferm_perfil_relac_funcao i ON (a.nr_atendimento = i.nr_atendimento)
LEFT OUTER JOIN enferm_perfil_nutricao j ON (a.nr_atendimento = j.nr_atendimento)
, pessoa_fisica c
LEFT OUTER JOIN person_name d ON (c.nr_seq_person_name = d.nr_sequencia)
LEFT OUTER JOIN compl_pessoa_fisica e ON (c.cd_pessoa_fisica = e.cd_pessoa_fisica)
WHERE a.nr_atendimento = nr_atendimento_p and a.cd_pessoa_fisica = c.cd_pessoa_fisica        ) alias95;	
        end if;


        return	(ds_retorno_w);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pep_get_text_nursing_summary (ie_type_p sumario_enfermagem.ie_sumario_enf_lista%type, nr_atendimento_p enferm_perfil_feridas.nr_atendimento%type ) FROM PUBLIC;

