-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION egk_obter_se_mesma_pessoa ( cd_pessoa_fisica_p pessoa_fisica_egk.cd_pessoa_fisica%type, nr_sequencia_p pessoa_fisica_egk.nr_sequencia%type) RETURNS varchar AS $body$
DECLARE

pessoa_cartao_row            pessoa_fisica_egk%rowtype;
qt_pessoa_selecionada_w      bigint;
qt_pessoa_cartao_w           bigint;
ds_given_name_w             person_name.ds_given_name%type;
ds_family_name_w            person_name.ds_family_name%type;
dt_nascimento_w             pessoa_fisica.dt_nascimento%type;
resultado_w varchar(2);


BEGIN

resultado_w := 'S';

select  count(*)
into STRICT    qt_pessoa_selecionada_w
from    pessoa_fisica_egk
where   cd_pessoa_fisica = cd_pessoa_fisica_p;

select  count(*)
into STRICT    qt_pessoa_cartao_w
from    pessoa_fisica_egk
where   nr_sequencia = nr_sequencia_p;

if (qt_pessoa_selecionada_w > 0 and qt_pessoa_cartao_w > 0)then

    select  max(pn.ds_given_name),
            max(pn.ds_family_name),
            max(pf.dt_nascimento)
    into STRICT    ds_given_name_w,
            ds_family_name_w,
            dt_nascimento_w
    from    pessoa_fisica pf,
            person_name pn
    where   pf.cd_pessoa_fisica     = cd_pessoa_fisica_p
    and     pf.nr_seq_person_name   = pn.nr_sequencia;

    select  *
    into STRICT    pessoa_cartao_row
    from    pessoa_fisica_egk
    where   nr_sequencia = nr_sequencia_p;

    if (     ds_given_name_w         <> pessoa_cartao_row.vorname
        or  ds_family_name_w        <> pessoa_cartao_row.nachname
        or  trunc(dt_nascimento_w)  <>  trunc(pessoa_cartao_row.geburtsdatum)) then
        resultado_w := 'N';
    end if;

else
    resultado_w := 'N';
end if;

return resultado_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION egk_obter_se_mesma_pessoa ( cd_pessoa_fisica_p pessoa_fisica_egk.cd_pessoa_fisica%type, nr_sequencia_p pessoa_fisica_egk.nr_sequencia%type) FROM PUBLIC;

