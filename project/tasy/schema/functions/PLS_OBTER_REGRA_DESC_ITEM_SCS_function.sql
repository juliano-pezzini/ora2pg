-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_regra_desc_item_scs ( cd_proc_mat_conv_p bigint, ie_tipo_item_p text, nr_seq_requisicao_p bigint, nr_seq_guia_p bigint, nr_seq_req_guia_itens_p bigint) RETURNS varchar AS $body$
DECLARE

/*
IE_TIPO_ITEM_P
P - Procedimento
M - Material
*/
ds_retorno_w		varchar(255);
ie_tipo_descricao_w	varchar(4);
ds_proc_mat_generico_w	varchar(255);
cd_servico_w		bigint;


BEGIN

begin
	select	substr(ds_proc_mat_generico,1,80),
		ie_tipo_descricao
	into STRICT	ds_proc_mat_generico_w,
		ie_tipo_descricao_w
	from	pls_regra_generico_ptu
	where	cd_proc_mat_generico	= cd_proc_mat_conv_p
	and	ie_situacao		= 'A';
exception
when others then
	ds_proc_mat_generico_w	:= '';
	ie_tipo_descricao_w	:= '';
end;

if (nr_seq_requisicao_p IS NOT NULL AND nr_seq_requisicao_p::text <> '') then
	if (ie_tipo_descricao_w	= 'DR') then
		ds_retorno_w	:= ds_proc_mat_generico_w;
	elsif (ie_tipo_descricao_w	= 'DI') and (ie_tipo_item_p	= 'P') then
		begin
			select	substr(obter_descricao_procedimento(cd_procedimento,ie_origem_proced),1,255)
			into STRICT	ds_retorno_w
			from	pls_requisicao_proc
			where	nr_sequencia		= nr_seq_req_guia_itens_p;
		exception
		when others then
			ds_retorno_w	:= '';
		end;
	elsif (ie_tipo_descricao_w	= 'DI') and (ie_tipo_item_p	= 'M') then
		begin
			select	substr(pls_obter_desc_material(nr_seq_material),1,255)
			into STRICT	ds_retorno_w
			from	pls_requisicao_mat
			where	nr_sequencia		= nr_seq_req_guia_itens_p;
		exception
		when others then
			ds_retorno_w	:= '';
		end;
	end if;
elsif (nr_seq_guia_p IS NOT NULL AND nr_seq_guia_p::text <> '') then
		if (ie_tipo_descricao_w	= 'DR') then
		ds_retorno_w	:= ds_proc_mat_generico_w;
	elsif (ie_tipo_descricao_w	= 'DI') and (ie_tipo_item_p	= 'P') then
		begin
			select	substr(obter_descricao_procedimento(cd_procedimento,ie_origem_proced),1,255)
			into STRICT	ds_retorno_w
			from	pls_guia_plano_proc
			where	nr_sequencia		= nr_seq_req_guia_itens_p;
		exception
		when others then
			ds_retorno_w	:= '';
		end;
	elsif (ie_tipo_descricao_w	= 'DI') and (ie_tipo_item_p	= 'M') then
		begin
			select	substr(pls_obter_desc_material(nr_seq_material),1,255)
			into STRICT	ds_retorno_w
			from	pls_guia_plano_mat
			where	nr_sequencia		= nr_seq_req_guia_itens_p;
		exception
		when others then
			ds_retorno_w	:= '';
		end;
	end if;
end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_regra_desc_item_scs ( cd_proc_mat_conv_p bigint, ie_tipo_item_p text, nr_seq_requisicao_p bigint, nr_seq_guia_p bigint, nr_seq_req_guia_itens_p bigint) FROM PUBLIC;

