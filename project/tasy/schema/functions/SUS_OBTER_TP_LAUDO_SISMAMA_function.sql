-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION sus_obter_tp_laudo_sismama ( nr_seq_laudo_p bigint, it_tipo_retorno_p bigint) RETURNS varchar AS $body$
DECLARE

qt_laudo_mamo_w		bigint := 0;
qt_laudo_cito_w		bigint := 0;
qt_laudo_histo_w	bigint := 0;
ds_retorno_w		varchar(100);
/*Tipo retorno:
	1 - número:
		1 - mamografia
		2 - citopatológico
		3 - histopatológico
	2 - descrição*/
BEGIN

select	count(*)
into STRICT	qt_laudo_mamo_w
from	sismama_mam_ind_clinica
where	nr_seq_sismama = nr_seq_laudo_p;

if (qt_laudo_mamo_w = 0) then
	begin
	select	count(*)
	into STRICT	qt_laudo_mamo_w
	from	sismama_mam_conclusao
	where	nr_seq_sismama = nr_seq_laudo_p;
	if (qt_laudo_mamo_w = 0) then
		begin
		select	count(*)
		into STRICT	qt_laudo_mamo_w
		from	sismama_mam_anamnese
		where	nr_seq_sismama = nr_seq_laudo_p;
		if (qt_laudo_mamo_w = 0) then
			begin
			select	count(*)
			into STRICT	qt_laudo_mamo_w
			from	sismama_anamnese_rad
			where	nr_seq_sismama = nr_seq_laudo_p;
			end;
		end if;
		end;
	end if;
	end;
end if;

select	count(*)
into STRICT	qt_laudo_cito_w
from	sismama_cit_anamnese
where	nr_seq_sismama = nr_seq_laudo_p;

if (qt_laudo_cito_w = 0) then
	begin
	select	count(*)
	into STRICT	qt_laudo_cito_w
	from	sismama_cit_exame_clinico
	where	nr_seq_sismama = nr_seq_laudo_p;
	if (qt_laudo_cito_w = 0) then
		begin
		select	count(*)
		into STRICT	qt_laudo_cito_w
		from	sismama_cit_resultados
		where	nr_seq_sismama = nr_seq_laudo_p;
		end;
	end if;
	end;
end if;

select	count(*)
into STRICT	qt_laudo_histo_w
from	sismama_his_dados_clinico
where	nr_seq_sismama = nr_seq_laudo_p;

if (qt_laudo_histo_w = 0) then
	begin
	select	count(*)
	into STRICT	qt_laudo_histo_w
	from	sismama_his_exame_micro
	where	nr_seq_sismama = nr_seq_laudo_p;
	if (qt_laudo_histo_w = 0) then
		begin
		select	count(*)
		into STRICT	qt_laudo_histo_w
		from	sismama_his_resultado
		where	nr_seq_sismama = nr_seq_laudo_p;
		end;
	end if;
	end;
end if;

if (qt_laudo_mamo_w > 0) then
	begin
	if (it_tipo_retorno_p = 1) then
		ds_retorno_w := '1';
	else
		--ds_retorno_w := 'Mamografia';
		ds_retorno_w := wheb_mensagem_pck.get_texto(314222);
	end if;
	end;
elsif (qt_laudo_cito_w > 0) then
	begin
	if (it_tipo_retorno_p = 1) then
		ds_retorno_w := '2';
	else
		--ds_retorno_w := 'Citopatológico';
		ds_retorno_w := wheb_mensagem_pck.get_texto(313993);
	end if;
	end;
elsif (qt_laudo_histo_w > 0) then
	begin
	if (it_tipo_retorno_p = 1) then
		ds_retorno_w := '3';
	else
		--ds_retorno_w := 'Histopatológico';
		ds_retorno_w := wheb_mensagem_pck.get_texto(313994);
	end if;
	end;
end if;

return	coalesce(ds_retorno_w,'');

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION sus_obter_tp_laudo_sismama ( nr_seq_laudo_p bigint, it_tipo_retorno_p bigint) FROM PUBLIC;

