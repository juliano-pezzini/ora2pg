-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION fanp_obter_pastas_vis_item_js ( nr_seq_item_fanep_p bigint, cd_perfil_p bigint, ie_retorno_p text DEFAULT 'C') RETURNS varchar AS $body$
DECLARE



ds_retorno_w	varchar(2000) := '';



BEGIN


IF (nr_seq_item_fanep_p IS NOT NULL AND nr_seq_item_fanep_p::text <> '') THEN
	BEGIN

	IF (ie_retorno_p = 'C') THEN
		ds_retorno_w := obter_select_concatenado_bv('SELECT	a.nr_seq_dic_obj
													FROM	perfil_item_fanep d,
															perfil_item_pront_pasta c,
															prontuario_item_pasta b,
															prontuario_pasta a
													WHERE	a.nr_sequencia = b.nr_seq_pasta_fanep
													AND		b.nr_sequencia = c.nr_seq_item_pasta
													AND     d.nr_sequencia = c.nr_seq_item_perfil_fanep
													AND		d.cd_perfil = :cd_perfil_p
													AND		d.nr_seq_item = :nr_seq_item_fanep_p
													and		a.ie_situacao = '|| CHR(39) || 'A' || CHR(39),
						'cd_perfil_p=' || cd_perfil_p || ';nr_seq_item_fanep_p=' || nr_seq_item_fanep_p, ',' || CHR(13));

	ELSIF (ie_retorno_p = 'I')THEN
		ds_retorno_w :=  obter_select_concatenado_bv('	SELECT	a.nr_seq_dic_obj||'|| CHR(39) || ';' || CHR(39)||'||
																	NVL(DS_ENDERECO_CLASSE,'|| CHR(39) || ' ' || CHR(39)||')||'|| CHR(39) || ';' || CHR(39)||'||
																	NVL(NR_SEQ_PASTA_SUPERIOR,0)||'|| CHR(39) || ';' || CHR(39)||'||
																	nvl(obter_desc_pastas_pep(d.nr_seq_item,a.nr_seq_dic_obj),substr(obter_desc_expressao(cd_exp_texto),1,254))
														FROM 	perfil e,
																perfil_item_fanep d,
																perfil_item_pront_pasta c,
																prontuario_item_pasta b,
																prontuario_pasta a,
																dic_objeto f
														WHERE	a.nr_sequencia =  b.nr_seq_pasta_fanep
														AND		b.nr_sequencia = c.nr_seq_item_pasta
														AND		d.nr_sequencia = c.nr_seq_item_perfil_fanep
														AND		a.nr_seq_dic_obj = f.nr_sequencia
														AND		d.cd_perfil = :cd_perfil_p
														AND		d.nr_seq_item = :nr_seq_item_fanep_p
														AND		NVL(e.cd_estabelecimento, :cd_estalecimento_p) = :cd_estalecimento_p
														AND		d.cd_perfil = e.cd_perfil
														AND	a.ie_situacao ='|| CHR(39) || 'A' || CHR(39),
						'cd_perfil_p=' || cd_perfil_p || ';nr_seq_item_fanep_p=' || nr_seq_item_fanep_p || ';cd_estalecimento_p=' || wheb_usuario_pck.get_cd_estabelecimento, ',' || CHR(13));
	ELSIF (ie_retorno_p = 'IC')THEN
		ds_retorno_w :=  obter_select_concatenado_bv('	SELECT	 a.nr_seq_dic_obj
														FROM 	 perfil e,
																 perfil_item_fanep d,
																 perfil_item_pront_pasta c,
																 prontuario_item_pasta b,
																 prontuario_pasta a,
																 dic_objeto f
														WHERE	 a.nr_sequencia =  b.nr_seq_pasta_fanep
														AND		 b.nr_sequencia = c.nr_seq_item_pasta
														AND		 d.nr_sequencia = c.nr_seq_item_perfil_fanep
														AND		 a.nr_seq_dic_obj = f.nr_sequencia
														AND		 d.cd_perfil = :cd_perfil_p
														AND		 d.nr_seq_item = :nr_seq_item_fanep_p
														AND		 NVL(e.cd_estabelecimento, :cd_estalecimento_p) = :cd_estalecimento_p
														AND		 d.cd_perfil = e.cd_perfil
														AND	a.ie_situacao ='|| CHR(39) || 'A' || CHR(39),
						'cd_perfil_p=' || cd_perfil_p || ';nr_seq_item_fanep_p=' || nr_seq_item_fanep_p || ';cd_estalecimento_p=' || wheb_usuario_pck.get_cd_estabelecimento, ',' || CHR(13));
	END IF;

	END;
END IF;

RETURN	ds_retorno_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION fanp_obter_pastas_vis_item_js ( nr_seq_item_fanep_p bigint, cd_perfil_p bigint, ie_retorno_p text DEFAULT 'C') FROM PUBLIC;

