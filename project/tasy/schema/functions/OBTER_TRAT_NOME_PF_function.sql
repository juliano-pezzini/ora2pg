-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_trat_nome_pf (cd_pessoa_fisica_p text) RETURNS varchar AS $body$
DECLARE

 
ds_retorno_w	varchar(255);
qt_idade_w	bigint;
ds_profissao_w	varchar(80);
nm_pessoa_w	varchar(60);
ie_sexo_w varchar(1);


BEGIN 
if (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') then 
 
	select	(obter_idade(dt_nascimento, coalesce(dt_obito,clock_timestamp()),'A'))::numeric , 
		substr(obter_desc_profissao(b.cd_profissao),1,255), 
		substr(obter_nome_pf(a.cd_pessoa_fisica),1,255), 
                a.IE_SEXO 
	into STRICT	qt_idade_w, 
		ds_profissao_w, 
		nm_pessoa_w, 
                ie_sexo_w 
	from	pessoa_fisica a, 
		compl_pessoa_fisica b 
	where	a.cd_pessoa_fisica = b.cd_pessoa_fisica 
	and	a.cd_pessoa_fisica = cd_pessoa_fisica_p 
	and	b.ie_tipo_complemento = '1';
 
	ds_retorno_w	:= nm_pessoa_w;
 
	if	(qt_idade_w > 18 AND ie_sexo_w = 'F')then 
  begin 
   ds_retorno_w	:= 'Sra.'||nm_pessoa_w;
    if (upper(sem_acento(ds_profissao_w)) like upper('%Medico%')) then 
      ds_retorno_w	:= 'Dra.'||nm_pessoa_w;
    end if;
	 end;
 end if;
	 
 if	(qt_idade_w > 18 AND ie_sexo_w = 'M')then 
  begin 
   ds_retorno_w	:= 'Sr.'||nm_pessoa_w;
    if (upper(sem_acento(ds_profissao_w)) like upper('%Medico%')) then 
      ds_retorno_w	:= 'Dr.'||nm_pessoa_w;
    end if;
	 end;
 end if;
 
	 
  if (qt_idade_w < 18)then 
  begin 
  ds_retorno_w	:= 'Menor: '||nm_pessoa_w;
  end;
  end if;	
 
end if;
 
return	ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_trat_nome_pf (cd_pessoa_fisica_p text) FROM PUBLIC;

