-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_usuario_gestor_conta ( nr_seq_ordem_serv_p man_ordem_servico.nr_sequencia%type, ie_apresenta_erro_p text default 'N') RETURNS varchar AS $body$
DECLARE

	nr_seq_cliente_w	com_cliente.nr_sequencia%type;
	nm_usuario_gestor_w	varchar(50);


BEGIN

	select	max(mos.nr_seq_cliente)
	into STRICT	nr_seq_cliente_w
	from	man_ordem_servico mos
	where	mos.nr_sequencia = nr_seq_ordem_serv_p;
	
	select	max(substr(coalesce(obter_usuario_pf(ccc.cd_pessoa_fisica), 'pcfelix') ,1, 40))
	into STRICT	nm_usuario_gestor_w
	from	com_cliente_conta ccc
	where	ccc.nr_seq_cliente = nr_seq_cliente_w
	and	clock_timestamp() between ccc.dt_inicial and coalesce(dt_final, clock_timestamp());
	
	if (coalesce(nm_usuario_gestor_w::text, '') = ''
		and ie_apresenta_erro_p = 'S') then
		begin
			CALL wheb_mensagem_pck.exibir_mensagem_abort(1088612);
		end;
	end if;

return nm_usuario_gestor_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_usuario_gestor_conta ( nr_seq_ordem_serv_p man_ordem_servico.nr_sequencia%type, ie_apresenta_erro_p text default 'N') FROM PUBLIC;

