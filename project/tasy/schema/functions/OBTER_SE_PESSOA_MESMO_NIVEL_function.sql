-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_pessoa_mesmo_nivel ( cd_pessoa_padrao_p bigint, cd_pessoa_verificar_p bigint, cd_estabelecimento_p bigint) RETURNS varchar AS $body$
DECLARE

 
ie_mesmo_nivel_w			varchar(1) := 'N';
nr_nivel_aprovacao_w		bigint;
nr_nivel_aprovacao_ww		bigint;
ie_aprovacao_nivel_w		varchar(1);
nm_usuario_padrao_w		varchar(15);
nm_usuario_verificar_w		varchar(15);


BEGIN 
 
select	coalesce(ie_aprovacao_nivel,'N') 
into STRICT	ie_aprovacao_nivel_w 
from	parametro_compras 
where	cd_estabelecimento = cd_Estabelecimento_p;
 
if (ie_aprovacao_nivel_w = 'S') then 
		 
	select	obter_usuario_pessoa(cd_pessoa_padrao_p), 
		obter_usuario_pessoa(cd_pessoa_verificar_p) 
	into STRICT	nm_usuario_padrao_w, 
		nm_usuario_verificar_w 
	;
	 
	if (nm_usuario_padrao_w IS NOT NULL AND nm_usuario_padrao_w::text <> '') and (nm_usuario_verificar_w IS NOT NULL AND nm_usuario_verificar_w::text <> '') then 
	 
		select	nr_nivel_aprovacao 
		into STRICT	nr_nivel_aprovacao_w 
		from	usuario 
		where	nm_usuario = nm_usuario_padrao_w;
 
		select	nr_nivel_aprovacao 
		into STRICT	nr_nivel_aprovacao_ww 
		from	usuario 
		where	nm_usuario = nm_usuario_verificar_w;
 
		if (nr_nivel_aprovacao_w IS NOT NULL AND nr_nivel_aprovacao_w::text <> '') and (nr_nivel_aprovacao_w = nr_nivel_aprovacao_ww) then 
			ie_mesmo_nivel_w := 'S';
		end if;
	end if;
end if;
 
return ie_mesmo_nivel_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_pessoa_mesmo_nivel ( cd_pessoa_padrao_p bigint, cd_pessoa_verificar_p bigint, cd_estabelecimento_p bigint) FROM PUBLIC;

