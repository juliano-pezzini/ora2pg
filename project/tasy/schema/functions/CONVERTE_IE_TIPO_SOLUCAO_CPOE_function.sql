-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION converte_ie_tipo_solucao_cpoe ( nr_seq_mat_cpoe_p cpoe_material.nr_sequencia%type ) RETURNS bigint AS $body$
DECLARE


/*
prescr_solucao ie_tipo_sol dominio 3121
1 Solucao intermitente (medicamentos de horario ou solucoes nao-continuas cujo tempo de infusao e menor que o intervalo entre as doses)
2 Solucao em esquema alternado (quando ha periodos do dia com e sem etapas a serem infundidas)
3 Solucao continua (etapas ligadas, sem espaco de tempo entre elas)
4 Solucao especial (com velocidade de infusao variavel)
5 Solucao para analgesia controlada pelo paciente (PCA)

cpoe_material ie_tipo_solucao
C Continua (Solucao com etapas ligadas, sem espaco de tempo entre elas)
I Intermitente (Solucao com medicamentos de horario ou solucoes nao-continuas cujo tempo de infusao e menor que o intervalo entre as doses)
V Veloc infusao variavel (Solucao especial com medicamentos que podem ter uma velocidade de infusao variada)
P PCA (Solucao para analgesia controlada pelo paciente)

equivalencia
1 = I
3 = C
4 = V
5 = P
*/
ie_tipo_solucao_w cpoe_material.ie_tipo_solucao%type;
ie_tipo_sol_conv_w bigint;


BEGIN

if (nr_seq_mat_cpoe_p IS NOT NULL AND nr_seq_mat_cpoe_p::text <> '') then
    select  max(a.ie_tipo_solucao)
    into STRICT    ie_tipo_solucao_w
    from    cpoe_material a
    where   a.nr_sequencia = nr_seq_mat_cpoe_p;

    if (ie_tipo_solucao_w = 'I') then
        ie_tipo_sol_conv_w := 1;
    elsif (ie_tipo_solucao_w = 'C') then
        ie_tipo_sol_conv_w := 3;
    elsif (ie_tipo_solucao_w = 'V') then
        ie_tipo_sol_conv_w := 4;
    elsif (ie_tipo_solucao_w = 'P') then
        ie_tipo_sol_conv_w := 5;
    end if;
end if;

return ie_tipo_sol_conv_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION converte_ie_tipo_solucao_cpoe ( nr_seq_mat_cpoe_p cpoe_material.nr_sequencia%type ) FROM PUBLIC;

