-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION is_analito_pepa ( nr_seq_resultado_p exame_lab_result_item.nr_seq_resultado%TYPE, nr_seq_material_p exame_lab_result_item.nr_seq_material%TYPE, nr_seq_exame_p exame_lab_result_item.nr_seq_exame%TYPE ) RETURNS varchar AS $body$
DECLARE

    nr_seq_superior_w   exame_laboratorio.nr_seq_superior%TYPE;
    ie_analito_w        varchar(1) := 'N';

BEGIN
    IF coalesce(nr_seq_material_p::text, '') = '' THEN
        BEGIN
            SELECT
                nr_seq_superior
            INTO STRICT nr_seq_superior_w
            FROM
                exame_laboratorio
            WHERE
                nr_seq_exame = nr_seq_exame_p
                AND (nr_seq_superior IS NOT NULL AND nr_seq_superior::text <> '');

            SELECT
                CASE WHEN COUNT(1)=0 THEN  'N'  ELSE 'S' END
            INTO STRICT ie_analito_w
            FROM
                exame_lab_result_item
            WHERE
                nr_seq_exame = nr_seq_superior_w
                AND nr_seq_resultado = nr_seq_resultado_p;

        EXCEPTION
            WHEN no_data_found OR too_many_rows OR data_exception THEN
                NULL;
        END;
    END IF;

    RETURN ie_analito_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION is_analito_pepa ( nr_seq_resultado_p exame_lab_result_item.nr_seq_resultado%TYPE, nr_seq_material_p exame_lab_result_item.nr_seq_material%TYPE, nr_seq_exame_p exame_lab_result_item.nr_seq_exame%TYPE ) FROM PUBLIC;

