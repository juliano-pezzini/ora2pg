-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_exame_fisico_pe ( nr_atendimento_p bigint) RETURNS varchar AS $body$
DECLARE



ds_opcao_etilismo_w		varchar(50);
ds_opcao_droga_W		varchar(50);
ds_opcao_tabagismo_w		varchar(50);
ds_opcao_alergia_W		varchar(50);
ds_alergia_w			varchar(255);
ds_droga_w			varchar(255);
ds_antecedente_clinico_w	varchar(255);
ds_retorno_w			varchar(2000);


BEGIN
if (nr_atendimento_p IS NOT NULL AND nr_atendimento_p::text <> '') then
	begin
	select  substr(obter_valor_dominio(1020, ie_etilismo),1,35) ds_opcao_etilismo,
		substr(obter_valor_dominio(1021, ie_droga),1,35) ds_opcao_droga,
		substr(obter_valor_dominio(1023, ie_tabagismo),1,35) ds_opcao_tabagismo,
		substr(obter_valor_dominio(1022, ie_alergia),1,35) ds_opcao_alergia,
		ds_alergia,
		ds_droga,
		ds_antecedente_clinico
	into STRICT 	ds_opcao_etilismo_w,
		ds_opcao_droga_W,
		ds_opcao_tabagismo_w,
		ds_opcao_alergia_W,
		ds_alergia_w,
		ds_droga_w,
		ds_antecedente_clinico_w
	from 	pe_historico
	where 	nr_atendimento = nr_atendimento_p;

	ds_retorno_w	:= 	ds_opcao_alergia_w || ' (' || ds_alergia_w || ' ), ' ||
				ds_opcao_etilismo_w || ' , ' || ds_opcao_droga_w || ' (' ||
				ds_droga_w || ' ), ' || ds_Opcao_tabagismo_w || CHR(10) || CHR(13) ||
                        	ds_antecedente_clinico_w;
	end;
end if;

RETURN ds_retorno_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_exame_fisico_pe ( nr_atendimento_p bigint) FROM PUBLIC;

