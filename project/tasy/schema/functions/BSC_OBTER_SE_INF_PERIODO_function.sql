-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION bsc_obter_se_inf_periodo ( ie_periodo_p text, cd_ano_p bigint, cd_periodo_p bigint, dt_referencia_p timestamp) RETURNS varchar AS $body$
DECLARE


cd_ano_ref_w			smallint;
dt_referencia_w			timestamp;
ie_periodo_w			varchar(1);
ie_retorno_w			varchar(1)	:= 'N';

BEGIN

ie_periodo_w		:= coalesce(ie_periodo_p,'M');
cd_ano_ref_w		:= PKG_DATE_UTILS.extract_field('YEAR', dt_referencia_p);


if (ie_periodo_w = 'A') then
	begin
	if (cd_ano_p = cd_ano_ref_w)  then
		ie_retorno_w	:= 'S';
	end if;
	end;
elsif (ie_periodo_w = 'M') then
	begin
	dt_referencia_w	:= PKG_DATE_UTILS.get_Date(cd_ano_p, cd_periodo_p, 01);
	if (dt_referencia_w = dt_referencia_p) then
		ie_retorno_w	:= 'S';
	end if;
	end;
elsif (ie_periodo_w = 'T') then
	begin
	dt_referencia_w	:= PKG_DATE_UTILS.get_Date(cd_ano_p, cd_periodo_p * 3, 01);
	if (cd_ano_p = cd_ano_ref_w) then

		if (dt_referencia_p <= dt_referencia_w) and (PKG_DATE_UTILS.ADD_MONTH(dt_referencia_p,-2,0) >= dt_referencia_w) then
			ie_retorno_w	:= 'S';
		end if;
	end if;
	end;
elsif (ie_periodo_w = 'S') then
	begin
	dt_referencia_w	:= PKG_DATE_UTILS.get_Date(cd_ano_p, cd_periodo_p * 6, 01);
	if (cd_ano_p = cd_ano_ref_w) then

		if (dt_referencia_p <= dt_referencia_w) and (PKG_DATE_UTILS.ADD_MONTH(dt_referencia_p,-5,0) >= dt_referencia_w) then
			ie_retorno_w	:= 'S';
		end if;
	end if;
	end;
end if;
return	substr(ie_retorno_w,1,1);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION bsc_obter_se_inf_periodo ( ie_periodo_p text, cd_ano_p bigint, cd_periodo_p bigint, dt_referencia_p timestamp) FROM PUBLIC;

