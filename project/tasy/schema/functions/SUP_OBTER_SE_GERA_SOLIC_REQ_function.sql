-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION sup_obter_se_gera_solic_req ( cd_estabelecimento_p bigint, cd_material_p bigint) RETURNS varchar AS $body$
DECLARE


cd_grupo_material_w	grupo_material.cd_grupo_material%type;
cd_subgrupo_material_w	subgrupo_material.cd_subgrupo_material%type;
cd_classe_material_w	classe_material.cd_classe_material%type;
nr_seq_familia_w		material.nr_seq_familia%type;
ie_material_estoque_w	varchar(1)	:=	'N';

ie_gerar_w		varchar(1)	:=	'N';

c01 CURSOR FOR
SELECT	ie_gerar
from	sup_regra_gerar_solic_req
where	coalesce(cd_grupo_material, cd_grupo_material_w) = cd_grupo_material_w
and	coalesce(cd_subgrupo_material, cd_subgrupo_material_w) = cd_subgrupo_material_w
and	coalesce(cd_classe_material, cd_classe_material_w) = cd_classe_material_w
and	coalesce(cd_material, cd_material_p) = cd_material_p
and	coalesce(nr_seq_familia, nr_seq_familia_w) = nr_seq_familia_w
and	((ie_material_estoque = 'A') or (ie_material_estoque = ie_material_estoque_w))
and	coalesce(cd_estab_regra, cd_estabelecimento_p) = cd_estabelecimento_p
order by	cd_material desc,
	nr_seq_familia desc,
	cd_classe_material desc,
	cd_subgrupo_material desc,
	cd_grupo_material desc,
	cd_estab_regra desc,
	ie_material_estoque asc;


BEGIN

begin
select	cd_grupo_material,
	cd_subgrupo_material,
	cd_classe_material,
	coalesce(nr_seq_familia,0)
into STRICT	cd_grupo_material_w,
	cd_subgrupo_material_w,
	cd_classe_material_w,
	nr_seq_familia_w
from	estrutura_material_v
where	cd_material = cd_material_p;

ie_material_estoque_w	:=	 coalesce(obter_se_material_estoque(cd_estabelecimento_p,null,cd_material_p),'N');
exception
when others then
	null;
end;

open c01;
loop
fetch c01 into
	ie_gerar_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
end loop;
close c01;

return	coalesce(ie_gerar_w,'N');

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION sup_obter_se_gera_solic_req ( cd_estabelecimento_p bigint, cd_material_p bigint) FROM PUBLIC;

