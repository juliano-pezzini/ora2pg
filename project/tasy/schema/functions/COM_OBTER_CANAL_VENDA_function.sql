-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION com_obter_canal_venda ( nr_seq_cliente_p bigint, ie_valor_canal_p text) RETURNS varchar AS $body$
DECLARE


nr_seq_canal_cliente_w	bigint;
nr_seq_canal_w		bigint;
ds_canal_w		varchar(60);
ds_valor_canal_w	varchar(60);


BEGIN
if (nr_seq_cliente_p IS NOT NULL AND nr_seq_cliente_p::text <> '') then
	begin
	select	coalesce(max(a.nr_sequencia),0)
	into STRICT	nr_seq_canal_cliente_w
	from	com_canal b,
		com_canal_cliente a
	where	b.nr_sequencia = a.nr_seq_canal
	and	a.nr_seq_cliente = nr_seq_cliente_p
	and	a.ie_tipo_atuacao = 'V'
	and	coalesce(a.dt_fim_atuacao::text, '') = ''
	and	coalesce(a.ie_situacao,'A') = 'A';

	if (nr_seq_canal_cliente_w > 0) then
		begin
		select	max(b.nr_sequencia),
			max(b.nm_guerra)
		into STRICT	nr_seq_canal_w,
			ds_canal_w
		from	com_canal b,
			com_canal_cliente a
		where	b.nr_sequencia = a.nr_seq_canal
		and	a.nr_sequencia = nr_seq_canal_cliente_w;

		if (ie_valor_canal_p = 'C') then
			begin
			ds_valor_canal_w := nr_seq_canal_w;
			end;
		else
			begin
			ds_valor_canal_w := ds_canal_w;
			end;
		end if;
		end;
	end if;

	end;
end if;
return ds_valor_canal_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION com_obter_canal_venda ( nr_seq_cliente_p bigint, ie_valor_canal_p text) FROM PUBLIC;

