-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_valores_lista_hl (cd_pesssoa_fisica_p text, nm_tabela_p text, ie_informacao_p text default null) RETURNS varchar AS $body$
DECLARE


ds_retorno_w	varchar(400);

BEGIN

if (cd_pesssoa_fisica_p IS NOT NULL AND cd_pesssoa_fisica_p::text <> '') then
	if (nm_tabela_p = 'TX_HLA') then
		if (ie_informacao_p = 'HLA_CLASSE_1') then
			select ('A: ' || coalesce(max(nr_locus_a1),0) || ',' || coalesce(max(nr_locus_a2),0) ||
					'; B: ' || coalesce(max(nr_locus_b1),0) || ','|| coalesce(max(nr_locus_b2),0) || 
					'; BW: ' || coalesce(max(nr_locus_bw1),0) || ',' || coalesce(max(nr_locus_bw2),0))
			into STRICT	ds_retorno_w
			from	tx_hla
			where	cd_pessoa_fisica = cd_pesssoa_fisica_p;
		elsif (ie_informacao_p = 'HLA_CLASSE_2') then
			select ('DRB1: ' || coalesce(max(nr_locus_dr1),0) || ',' || coalesce(max(nr_locus_dr2),0) ||
					';DQB1: ' || coalesce(max(nr_locus_dqb11),0) || ','|| coalesce(max(nr_locus_dqb12),0) || 
					'; DRB3: ' || coalesce(max(nr_locus_drb31),0) || ',' || coalesce(max(nr_locus_drb32),0) || 
					'; DRB4: ' || coalesce(max(nr_locus_drb41),0) || ',' || coalesce(max(nr_locus_drb42),0) || 
					'; DRB5: ' || coalesce(max(nr_locus_drb51),0) || ',' || coalesce(max(nr_locus_drb52),0))
			into STRICT	ds_retorno_w
			from	tx_hla
			where	cd_pessoa_fisica = cd_pesssoa_fisica_p;
		end if;
	elsif (nm_tabela_p = 'TX_PAINEL') then
		select ('Clase I: ' || CASE WHEN max(ie_result_classe_i)='N' THEN  'NEG' WHEN max(ie_result_classe_i)='P' THEN  'POS'  ELSE '    ' END  || ' ' || max(pr_result_classe_i) ||
				'%; Clase II: ' || CASE WHEN max(ie_result_classe_ii)='N' THEN  'NEG' WHEN max(ie_result_classe_ii)='P' THEN  'POS'  ELSE '    ' END  || ' ' || max(pr_result_classe_ii) || '%')
		into STRICT	ds_retorno_w
		from	tx_painel
		where	cd_pessoa_fisica = cd_pesssoa_fisica_p;
	end if;
end if;

return ds_retorno_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_valores_lista_hl (cd_pesssoa_fisica_p text, nm_tabela_p text, ie_informacao_p text default null) FROM PUBLIC;

