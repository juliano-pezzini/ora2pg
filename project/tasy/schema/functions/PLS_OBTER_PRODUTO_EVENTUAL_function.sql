-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_produto_eventual ( nr_seq_segurado_p bigint) RETURNS bigint AS $body$
DECLARE

			 
nr_seq_plano_w			bigint;
nr_seq_congenere_w		bigint;
cd_estabelecimento_w		smallint;
cd_usuario_plano_w		varchar(30);
cd_operadora_empresa_w		bigint;
nr_seq_emissor_w		bigint;

/*Cursor C01 is 
	select	a.nr_seq_plano 
	from	pls_plano_usuario_eventual	a 
	where	a.ie_situacao	= 'A' 
	and	trunc(sysdate) between trunc(a.dt_inicio_vigencia) and trunc(nvl(a.dt_fim_vigencia, sysdate +1)) 
	and	((a.nr_seq_congenere is null) or (a.nr_seq_congenere = nr_seq_congenere_w)) 
	and	((cd_operadora_empresa_w is null) or (cd_operadora_empresa = cd_operadora_empresa_w)) 
	order by nvl(nr_seq_congenere,0);*/
 
 

BEGIN 
 
/* Obter dados do beneficiário */
 
begin 
select	nr_seq_congenere, 
	cd_estabelecimento 
into STRICT	nr_seq_congenere_w, 
	cd_estabelecimento_w 
from	pls_segurado 
where	nr_sequencia	= nr_seq_segurado_p;
exception 
when others then 
	nr_seq_congenere_w	:= null;
	cd_estabelecimento_w	:= null;
end;
 
/* Obter a carteirinha do beneficiário */
 
cd_usuario_plano_w	:= pls_obter_dados_segurado(nr_seq_segurado_p, 'C');
 
nr_seq_plano_w	:= pls_obter_nome_empresa_cart(cd_usuario_plano_w, 'P', cd_estabelecimento_w);
 
/* Obter o emissor de carteirinha da operadora */
 
/*select	max(nr_seq_emissor) 
into	nr_seq_emissor_w 
from	pls_parametros 
where	cd_estabelecimento	= cd_estabelecimento_w;*/
 
 
/* Obter o Código de controle de empresa na OPS */
 
/*cd_operadora_empresa_w	:= pls_obter_nome_empresa_cart(cd_usuario_plano_w, nr_seq_emissor_w, 'CE');*/
 
 
/*open C01; 
loop 
fetch C01 into	 
	nr_seq_plano_w; 
exit when C01%notfound; 
end loop; 
close C01; 
*/
 
return	nr_seq_plano_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_produto_eventual ( nr_seq_segurado_p bigint) FROM PUBLIC;

