-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pic_obter_email_content ( cd_requisito_p LATAM_REQUISITO.CD_REQUISITO%TYPE, status_p LATAM_REQUISITO.IE_LIBERAR_DESENV%TYPE, old_status_p LATAM_REQUISITO.IE_LIBERAR_DESENV%TYPE ) RETURNS varchar AS $body$
DECLARE


ds_analista_w       PESSOA_FISICA.NM_PESSOA_FISICA%TYPE;
ds_analista_ba_w    PESSOA_FISICA.NM_PESSOA_FISICA%TYPE;
ds_consultor_w      PESSOA_FISICA.NM_PESSOA_FISICA%TYPE;
ds_requisito_w      LATAM_REQUISITO.DS_REQUISITO%TYPE;
ds_obs_w            LATAM_REQUISITO.DS_OBSERVACAO%TYPE;
ds_gap_w            LATAM_GAP.DS_GAP%TYPE;
ds_modulo_w         LATAM_CADASTRO_MODULO.DS_MODULO%TYPE;
ds_status_w         DIC_EXPRESSAO.DS_EXPRESSAO_BR%TYPE;
ds_old_status_w     DIC_EXPRESSAO.DS_EXPRESSAO_BR%TYPE;
lb_code_w           DIC_EXPRESSAO.DS_EXPRESSAO_BR%TYPE;
lb_title_w          DIC_EXPRESSAO.DS_EXPRESSAO_BR%TYPE;
lb_gap_w            DIC_EXPRESSAO.DS_EXPRESSAO_BR%TYPE;
lb_module_w         DIC_EXPRESSAO.DS_EXPRESSAO_BR%TYPE;
lb_status_w         DIC_EXPRESSAO.DS_EXPRESSAO_BR%TYPE;
lb_old_status_w     DIC_EXPRESSAO.DS_EXPRESSAO_BR%TYPE;
lb_analyst_w        DIC_EXPRESSAO.DS_EXPRESSAO_BR%TYPE;
lb_analyst_ba_w     DIC_EXPRESSAO.DS_EXPRESSAO_BR%TYPE;
lb_consultant_w     DIC_EXPRESSAO.DS_EXPRESSAO_BR%TYPE;
lb_observacao_w     DIC_EXPRESSAO.DS_EXPRESSAO_BR%TYPE;

ds_content_w        varchar(4000);


BEGIN

lb_code_w           := obter_desc_expressao(285358);
lb_title_w          := obter_desc_expressao(1058806);
lb_gap_w            := obter_desc_expressao(1059939);
lb_module_w         := obter_desc_expressao(293400);
lb_status_w         := obter_desc_expressao(1075711);
lb_old_status_w     := obter_desc_expressao(1075713);
lb_analyst_w        := obter_desc_expressao(685672);
lb_analyst_ba_w     := obter_desc_expressao(669285);
lb_consultant_w     := obter_desc_expressao(285919);
lb_observacao_w     := obter_desc_expressao(604913);

SELECT  OBTER_NOME_PF(MAX(a.CD_RESPONSAVEL))        ANALISTA,
		OBTER_NOME_PF(MAX(a.CD_RESPONSAVEL_BA))     ANALISTA_NEGOCIOS,
		OBTER_NOME_PF(MAX(a.CD_CONSULTOR_RESP))     CONSULTOR,
		MAX(a.DS_REQUISITO)                         TITULO,
		MAX(a.DS_OBSERVACAO)                        OBSERVACAO,
		MAX(b.DS_GAP)                               GAP,
		MAX(d.DS_MODULO)                            DSMODULO
INTO STRICT    ds_analista_w,
		ds_analista_ba_w,
		ds_consultor_w,
		ds_requisito_w,
		ds_obs_w,
		ds_gap_w,
		ds_modulo_w
FROM latam_requisito a
LEFT OUTER JOIN latam_gap b ON (a.NR_SEQ_GAP = b.NR_SEQUENCIA)
LEFT OUTER JOIN latam_modulo c ON (a.NR_SEQ_MODULO = c.NR_SEQUENCIA)
LEFT OUTER JOIN latam_cadastro_modulo d ON (c.NR_SEQ_MODULO = d.NR_SEQUENCIA)
WHERE a.CD_REQUISITO   = cd_requisito_p;

SELECT  OBTER_DESC_EXPRESSAO(MAX(cd_exp_valor_dominio)) STATUS
INTO STRICT    ds_status_w
FROM    VALOR_DOMINIO_V
WHERE   CD_DOMINIO = 8158
AND     VL_DOMINIO = status_p;

SELECT  OBTER_DESC_EXPRESSAO(MAX(cd_exp_valor_dominio)) OLDSTATUS
INTO STRICT    ds_old_status_w
FROM    VALOR_DOMINIO_V
WHERE   CD_DOMINIO = 8158
AND     VL_DOMINIO = old_status_p;

ds_content_w := lb_code_w       || ': ' || cd_requisito_p   || chr(10) ||
				lb_title_w      || ': ' || ds_requisito_w   || chr(10) ||
				lb_gap_w        || ': ' || ds_gap_w         || chr(10) ||
				lb_module_w     || ': ' || ds_modulo_w      || chr(10) ||
				lb_status_w     || ': ' || ds_status_w      || chr(10) ||
				lb_old_status_w || ': ' || ds_old_status_w  || chr(10) ||
				lb_analyst_w    || ': ' || ds_analista_w    || chr(10) ||
				lb_analyst_ba_w || ': ' || ds_analista_ba_w || chr(10) ||
				lb_consultant_w || ': ' || ds_consultor_w   || chr(10) ||
				lb_observacao_w || ': ' || ds_obs_w         || chr(10);

RETURN ds_content_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pic_obter_email_content ( cd_requisito_p LATAM_REQUISITO.CD_REQUISITO%TYPE, status_p LATAM_REQUISITO.IE_LIBERAR_DESENV%TYPE, old_status_p LATAM_REQUISITO.IE_LIBERAR_DESENV%TYPE ) FROM PUBLIC;

