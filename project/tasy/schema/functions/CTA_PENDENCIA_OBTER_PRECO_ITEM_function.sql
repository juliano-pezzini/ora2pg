-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cta_pendencia_obter_preco_item ( nr_seq_pendencia_p bigint, cd_item_p bigint, ie_origem_proced_p bigint, qt_item_p bigint, ie_proc_mat_p text) RETURNS bigint AS $body$
DECLARE

 
nr_interno_conta_w   bigint;
nr_atendimento_w    bigint;
cd_convenio_w      integer;
cd_categoria_w     varchar(20);
vl_retorno_w      double precision;
cd_estabelecimento_w  bigint;
dt_pendencia_w     timestamp;


BEGIN 
 
begin 
select nr_interno_conta, 
    nr_atendimento, 
    dt_pendencia 
into STRICT  nr_interno_conta_w, 
    nr_atendimento_w, 
    dt_pendencia_w 
from  cta_pendencia 
where  nr_sequencia = nr_seq_pendencia_p;
exception 
	when others then 
	nr_interno_conta_w	:= 0;
    nr_atendimento_w	:= 0;
    dt_pendencia_w		:= clock_timestamp();
end;
 
vl_retorno_w:= 0;
 
if (coalesce(nr_interno_conta_w,0) > 0) then 
 
    select cd_convenio_parametro, 
        cd_categoria_parametro, 
        cd_estabelecimento 
    into STRICT  cd_convenio_w, 
        cd_categoria_w, 
        cd_estabelecimento_w 
    from  conta_paciente 
    where  nr_interno_conta = nr_interno_conta_w;
 
    if (ie_proc_mat_p = 'M') then 
 
        vl_retorno_w  := Obter_Preco_Material(    cd_estabelecimento_w, 
                                cd_convenio_w, 
                                cd_categoria_w, 
                                dt_pendencia_w, 
                                cd_item_p, 
                                0, 
                                0, 
                                0, 
                                null, 
                                0, 
                                0);
        vl_retorno_w  := (vl_retorno_w * qt_item_p);
 
    elsif (ie_proc_mat_p = 'P') then 
 
        vl_retorno_w  := Obter_preco_procedimento(  cd_estabelecimento_w, 
                                cd_convenio_w, 
                                cd_categoria_w, 
                                dt_pendencia_w, 
                                cd_item_p, 
                                ie_origem_proced_p, 
                                0, 
                                0, 
                                0, 
                                null, 
                                null, 
                                null, 
                                null, 
                                0, 
                                0, 
                                'P');
        vl_retorno_w  := (vl_retorno_w * qt_item_p);
 
    end if;
end if;
 
return vl_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cta_pendencia_obter_preco_item ( nr_seq_pendencia_p bigint, cd_item_p bigint, ie_origem_proced_p bigint, qt_item_p bigint, ie_proc_mat_p text) FROM PUBLIC;

