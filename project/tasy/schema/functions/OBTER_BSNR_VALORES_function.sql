-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_bsnr_valores (cd_pessoa_fisica_p text) RETURNS varchar AS $body$
DECLARE

    -- Variável para concatenacao
    resultado_w     varchar(400);
    nr_bsnr_w       varchar(400);

    -- Cursor para armazenar os registros do médico
    c_registros CURSOR FOR
        SELECT distinct NR_BSNR
        from medico_espec_bsnr
        where 1 = 1
            and cd_pessoa_fisica = cd_pessoa_fisica_p
;--            and cd_especialidade = cd_especialidade_p;
BEGIN
    -- Fazer a concatecação dos BSNR's
    for linha_cursor in c_registros() loop
        nr_bsnr_w := linha_cursor.nr_bsnr;

        if (nr_bsnr_w IS NOT NULL AND nr_bsnr_w::text <> '')then
            if (coalesce(resultado_w::text, '') = '') then
                resultado_w := nr_bsnr_w;
            else
                resultado_w := resultado_w || '; ' ||nr_bsnr_w;
            end if;
        end if;

    end loop;

    RETURN resultado_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_bsnr_valores (cd_pessoa_fisica_p text) FROM PUBLIC;

