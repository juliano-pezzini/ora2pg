-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION adep_obter_regra_inclusao ( ie_tipo_regra_p text, cd_estabelecimento_p bigint, cd_setor_atendimento_p bigint, cd_perfil_p bigint, cd_material_p text, cd_procedimento_p text, ie_origem_proced_p bigint, nr_seq_proc_interno_p bigint, cd_setor_prescricao_p bigint, cd_setor_exec_proc_p bigint, nr_prescricao_p bigint default null, nr_seq_exame_p bigint /*Apenas passado na ADEP_GERAR_HORARIOS_PCK,
					nos item que usam a function ADEp_Obter_Inclusao_regra*/
  DEFAULT NULL) RETURNS varchar AS $body$
DECLARE


ie_regra_inclusao_w		varchar(3)	:= 'S';
cd_setor_atendimento_w	setor_atendimento.cd_setor_atendimento%type;
cd_perfil_w			perfil.cd_perfil%type;
cd_material_w			bigint;
cd_procedimento_w		bigint;

c01 CURSOR FOR
SELECT	ie_dieta_oral
from	adep_regra_inclusao
where	cd_estabelecimento					= cd_estabelecimento_p
and		coalesce(cd_setor_atendimento, cd_setor_atendimento_w)	= cd_setor_atendimento_w
and		coalesce(cd_perfil, cd_perfil_w)				= cd_perfil_w
order by
	coalesce(cd_setor_atendimento,99999) desc,
	coalesce(cd_perfil,99999) desc,
	nr_sequencia;

c02 CURSOR FOR
SELECT	ie_suplemento_oral
from	adep_regra_inclusao
where	cd_estabelecimento					= cd_estabelecimento_p
and		coalesce(cd_setor_atendimento, cd_setor_atendimento_w)	= cd_setor_atendimento_w
and		coalesce(cd_perfil, cd_perfil_w)				= cd_perfil_w
order by
	coalesce(cd_setor_atendimento,99999) desc,
	coalesce(cd_perfil,99999) desc,
	nr_sequencia;

c03 CURSOR FOR
SELECT	ie_solucao
from	adep_regra_inclusao
where	cd_estabelecimento					= cd_estabelecimento_p
and		coalesce(cd_setor_atendimento, cd_setor_atendimento_w)	= cd_setor_atendimento_w
and		coalesce(cd_perfil, cd_perfil_w)				= cd_perfil_w
order by
	coalesce(cd_setor_atendimento,99999) desc,
	coalesce(cd_perfil,99999) desc,
	nr_sequencia;

c04 CURSOR FOR
SELECT	ie_medicamento
from	adep_regra_inclusao
where	cd_estabelecimento					= cd_estabelecimento_p
and		coalesce(cd_setor_atendimento, cd_setor_atendimento_w)	= cd_setor_atendimento_w
and		coalesce(cd_perfil, cd_perfil_w)				= cd_perfil_w
order by
	coalesce(cd_setor_atendimento,99999) desc,
	coalesce(cd_perfil,99999) desc,
	nr_sequencia;

c05 CURSOR FOR
SELECT	ie_material
from	adep_regra_inclusao
where	cd_estabelecimento					= cd_estabelecimento_p
and		coalesce(cd_setor_atendimento, cd_setor_atendimento_w)	= cd_setor_atendimento_w
and		coalesce(cd_perfil, cd_perfil_w)				= cd_perfil_w
order by
	coalesce(cd_setor_atendimento,99999) desc,
	coalesce(cd_perfil,99999) desc,
	nr_sequencia;

c06 CURSOR FOR
SELECT	ie_procedimento
from	adep_regra_inclusao
where	cd_estabelecimento					= cd_estabelecimento_p
and		coalesce(cd_setor_atendimento, cd_setor_atendimento_w)	= cd_setor_atendimento_w
and		coalesce(cd_perfil, cd_perfil_w)				= cd_perfil_w
order by
	coalesce(cd_setor_atendimento,99999) desc,
	coalesce(cd_perfil,99999) desc,
	nr_sequencia;

c07 CURSOR FOR
SELECT	ie_coleta
from	adep_regra_inclusao
where	cd_estabelecimento					= cd_estabelecimento_p
and		coalesce(cd_setor_atendimento, cd_setor_atendimento_w)	= cd_setor_atendimento_w
and		coalesce(cd_perfil, cd_perfil_w)				= cd_perfil_w
order by
	coalesce(cd_setor_atendimento,99999) desc,
	coalesce(cd_perfil,99999) desc,
	nr_sequencia;

c08 CURSOR FOR
SELECT	ie_ccg
from	adep_regra_inclusao
where	cd_estabelecimento					= cd_estabelecimento_p
and		coalesce(cd_setor_atendimento, cd_setor_atendimento_w)	= cd_setor_atendimento_w
and		coalesce(cd_perfil, cd_perfil_w)				= cd_perfil_w
order by
	coalesce(cd_setor_atendimento,99999) desc,
	coalesce(cd_perfil,99999) desc,
	nr_sequencia;

c09 CURSOR FOR
SELECT	ie_cig
from	adep_regra_inclusao
where	cd_estabelecimento					= cd_estabelecimento_p
and		coalesce(cd_setor_atendimento, cd_setor_atendimento_w)	= cd_setor_atendimento_w
and		coalesce(cd_perfil, cd_perfil_w)				= cd_perfil_w
order by
	coalesce(cd_setor_atendimento,99999) desc,
	coalesce(cd_perfil,99999) desc,
	nr_sequencia;

c10 CURSOR FOR
SELECT	ie_recomendacao
from	adep_regra_inclusao
where	cd_estabelecimento					= cd_estabelecimento_p
and		coalesce(cd_setor_atendimento, cd_setor_atendimento_w)	= cd_setor_atendimento_w
and		coalesce(cd_perfil, cd_perfil_w)				= cd_perfil_w
order by
	coalesce(cd_setor_atendimento,99999) desc,
	coalesce(cd_perfil,99999) desc,
	nr_sequencia;

c11 CURSOR FOR
SELECT	ie_sae
from	adep_regra_inclusao
where	cd_estabelecimento					= cd_estabelecimento_p
and		coalesce(cd_setor_atendimento, cd_setor_atendimento_w)	= cd_setor_atendimento_w
and		coalesce(cd_perfil, cd_perfil_w)				= cd_perfil_w
order by
	coalesce(cd_setor_atendimento,99999) desc,
	coalesce(cd_perfil,99999) desc,
	nr_sequencia;

c12 CURSOR FOR
SELECT	ie_ivc
from	adep_regra_inclusao
where	cd_estabelecimento					= cd_estabelecimento_p
and		coalesce(cd_setor_atendimento, cd_setor_atendimento_w)	= cd_setor_atendimento_w
and		coalesce(cd_perfil, cd_perfil_w)				= cd_perfil_w
order by
	coalesce(cd_setor_atendimento,99999) desc,
	coalesce(cd_perfil,99999) desc,
	nr_sequencia;

c13 CURSOR FOR
SELECT	ie_oxigenio
from	adep_regra_inclusao
where	cd_estabelecimento					= cd_estabelecimento_p
and		coalesce(cd_setor_atendimento, cd_setor_atendimento_w)	= cd_setor_atendimento_w
and		coalesce(cd_perfil, cd_perfil_w)				= cd_perfil_w
order by
	coalesce(cd_setor_atendimento,99999) desc,
	coalesce(cd_perfil,99999) desc,
	nr_sequencia;

c14 CURSOR FOR
SELECT	ie_hemoterapia
from	adep_regra_inclusao
where	cd_estabelecimento					= cd_estabelecimento_p
and		coalesce(cd_setor_atendimento, cd_setor_atendimento_w)	= cd_setor_atendimento_w
and		coalesce(cd_perfil, cd_perfil_w)				= cd_perfil_w
order by
	coalesce(cd_setor_atendimento,99999) desc,
	coalesce(cd_perfil,99999) desc,
	nr_sequencia;

c15 CURSOR FOR
SELECT	ie_sup_nutricional
from	adep_regra_inclusao
where	cd_estabelecimento					= cd_estabelecimento_p
and		coalesce(cd_setor_atendimento, cd_setor_atendimento_w)	= cd_setor_atendimento_w
and		coalesce(cd_perfil, cd_perfil_w)				= cd_perfil_w
order by
	coalesce(cd_setor_atendimento,99999) desc,
	coalesce(cd_perfil,99999) desc,
	nr_sequencia;

c16 CURSOR FOR
SELECT	ie_npt_adulta
from	adep_regra_inclusao
where	cd_estabelecimento					= cd_estabelecimento_p
and		coalesce(cd_setor_atendimento, cd_setor_atendimento_w)	= cd_setor_atendimento_w
and		coalesce(cd_perfil, cd_perfil_w)				= cd_perfil_w
order by
	coalesce(cd_setor_atendimento,99999) desc,
	coalesce(cd_perfil,99999) desc,
	nr_sequencia;

c17 CURSOR FOR
SELECT	ie_npt_neonatal
from	adep_regra_inclusao
where	cd_estabelecimento					= cd_estabelecimento_p
and		coalesce(cd_setor_atendimento, cd_setor_atendimento_w)	= cd_setor_atendimento_w
and		coalesce(cd_perfil, cd_perfil_w)				= cd_perfil_w
order by
	coalesce(cd_setor_atendimento,99999) desc,
	coalesce(cd_perfil,99999) desc,
	nr_sequencia;

c18 CURSOR FOR
SELECT	ie_dialise
from	adep_regra_inclusao
where	cd_estabelecimento					= cd_estabelecimento_p
and		coalesce(cd_setor_atendimento, cd_setor_atendimento_w)	= cd_setor_atendimento_w
and		coalesce(cd_perfil, cd_perfil_w)				= cd_perfil_w
order by
	coalesce(cd_setor_atendimento,99999) desc,
	coalesce(cd_perfil,99999) desc,
	nr_sequencia;

c19 CURSOR FOR
SELECT	ie_leite_deriv
from	adep_regra_inclusao
where	cd_estabelecimento					= cd_estabelecimento_p
and		coalesce(cd_setor_atendimento, cd_setor_atendimento_w)	= cd_setor_atendimento_w
and		coalesce(cd_perfil, cd_perfil_w)				= cd_perfil_w
order by
	coalesce(cd_setor_atendimento,99999) desc,
	coalesce(cd_perfil,99999) desc,
	nr_sequencia;


BEGIN
if (ie_tipo_regra_p IS NOT NULL AND ie_tipo_regra_p::text <> '') and (cd_estabelecimento_p IS NOT NULL AND cd_estabelecimento_p::text <> '') then

	cd_setor_atendimento_w	:= coalesce(cd_setor_atendimento_p,0);
	cd_perfil_w		:= coalesce(cd_perfil_p,0);

	if (ie_tipo_regra_p = 'DO') then

		open c01;
		loop
		fetch c01 into	ie_regra_inclusao_w;
		EXIT WHEN NOT FOUND; /* apply on c01 */
			begin
			ie_regra_inclusao_w	:= ie_regra_inclusao_w;
			end;
		end loop;
		close c01;

	elsif (ie_tipo_regra_p = 'SO') then

		open c02;
		loop
		fetch c02 into	ie_regra_inclusao_w;
		EXIT WHEN NOT FOUND; /* apply on c02 */
			begin
			ie_regra_inclusao_w	:= ie_regra_inclusao_w;
			end;
		end loop;
		close c02;


		if (ie_regra_inclusao_w = 'R') then
			if (cd_material_p IS NOT NULL AND cd_material_p::text <> '') then
				cd_material_w		:= (cd_material_p)::numeric;
			end if;
			if (cd_procedimento_p IS NOT NULL AND cd_procedimento_p::text <> '') then
				cd_procedimento_w	:= (cd_procedimento_p)::numeric;
			end if;

			ie_regra_inclusao_w	:= adep_obter_inclusao_regra(ie_tipo_regra_p, nr_prescricao_p, cd_estabelecimento_p, cd_setor_atendimento_p, cd_perfil_p, cd_material_w, cd_procedimento_w, ie_origem_proced_p, nr_seq_proc_interno_p,cd_setor_prescricao_p,cd_setor_exec_proc_p, nr_seq_exame_p);
		end if;

	elsif (ie_tipo_regra_p = 'SOL') then

		open c03;
		loop
		fetch c03 into	ie_regra_inclusao_w;
		EXIT WHEN NOT FOUND; /* apply on c03 */
			begin
			ie_regra_inclusao_w	:= ie_regra_inclusao_w;
			end;
		end loop;
		close c03;

	elsif (ie_tipo_regra_p = 'MED') then

		open c04;
		loop
		fetch c04 into	ie_regra_inclusao_w;
		EXIT WHEN NOT FOUND; /* apply on c04 */
			begin
			ie_regra_inclusao_w	:= ie_regra_inclusao_w;
			end;
		end loop;
		close c04;

		if (ie_regra_inclusao_w = 'R') then
			if (cd_material_p IS NOT NULL AND cd_material_p::text <> '') then
				cd_material_w		:= (cd_material_p)::numeric;
			end if;
			if (cd_procedimento_p IS NOT NULL AND cd_procedimento_p::text <> '') then
				cd_procedimento_w	:= (cd_procedimento_p)::numeric;
			end if;

			ie_regra_inclusao_w	:= adep_obter_inclusao_regra(ie_tipo_regra_p, nr_prescricao_p, cd_estabelecimento_p, cd_setor_atendimento_p, cd_perfil_p, cd_material_w, cd_procedimento_w, ie_origem_proced_p, nr_seq_proc_interno_p,cd_setor_prescricao_p,cd_setor_exec_proc_p, nr_seq_exame_p);
		end if;

	elsif (ie_tipo_regra_p = 'MAT') then

		open c05;
		loop
		fetch c05 into	ie_regra_inclusao_w;
		EXIT WHEN NOT FOUND; /* apply on c05 */
			begin
			ie_regra_inclusao_w	:= ie_regra_inclusao_w;
			end;
		end loop;
		close c05;

		if (ie_regra_inclusao_w = 'R') then
			if (cd_material_p IS NOT NULL AND cd_material_p::text <> '') then
				cd_material_w		:= (cd_material_p)::numeric;
			end if;
			if (cd_procedimento_p IS NOT NULL AND cd_procedimento_p::text <> '') then
				cd_procedimento_w	:= (cd_procedimento_p)::numeric;
			end if;
			ie_regra_inclusao_w	:= adep_obter_inclusao_regra(ie_tipo_regra_p, nr_prescricao_p, cd_estabelecimento_p, cd_setor_atendimento_p, cd_perfil_p, cd_material_w, cd_procedimento_w, ie_origem_proced_p, nr_seq_proc_interno_p,cd_setor_prescricao_p,cd_setor_exec_proc_p, nr_seq_exame_p);
		end if;

	elsif (ie_tipo_regra_p = 'PROC') then

		open c06;
		loop
		fetch c06 into	ie_regra_inclusao_w;
		EXIT WHEN NOT FOUND; /* apply on c06 */
			begin
			ie_regra_inclusao_w	:= ie_regra_inclusao_w;
			end;
		end loop;
		close c06;

		if (ie_regra_inclusao_w = 'R') then
			if (cd_material_p IS NOT NULL AND cd_material_p::text <> '') then
				cd_material_w		:= (cd_material_p)::numeric;
			end if;
			if (cd_procedimento_p IS NOT NULL AND cd_procedimento_p::text <> '') then
				cd_procedimento_w	:= (cd_procedimento_p)::numeric;
			end if;

			ie_regra_inclusao_w	:= adep_obter_inclusao_regra( ie_tipo_regra_p, nr_prescricao_p,cd_estabelecimento_p, cd_setor_atendimento_p, cd_perfil_p, cd_material_w, cd_procedimento_w, ie_origem_proced_p, nr_seq_proc_interno_p,cd_setor_prescricao_p,cd_setor_exec_proc_p, nr_seq_exame_p);
		end if;

	elsif (ie_tipo_regra_p = 'LAB') then

		open c07;
		loop
		fetch c07 into	ie_regra_inclusao_w;
		EXIT WHEN NOT FOUND; /* apply on c07 */
			begin
			ie_regra_inclusao_w	:= ie_regra_inclusao_w;
			end;
		end loop;
		close c07;

		if (ie_regra_inclusao_w = 'R') then
			if (cd_material_p IS NOT NULL AND cd_material_p::text <> '') then
				cd_material_w		:= (cd_material_p)::numeric;
			end if;
			if (cd_procedimento_p IS NOT NULL AND cd_procedimento_p::text <> '') then
				cd_procedimento_w	:= (cd_procedimento_p)::numeric;
			end if;

			ie_regra_inclusao_w	:= adep_obter_inclusao_regra( ie_tipo_regra_p, nr_prescricao_p,cd_estabelecimento_p, cd_setor_atendimento_p, cd_perfil_p, cd_material_w, cd_procedimento_w, ie_origem_proced_p, nr_seq_proc_interno_p,cd_setor_prescricao_p,cd_setor_exec_proc_p, nr_seq_exame_p);
		end if;

	elsif (ie_tipo_regra_p = 'CCG') then

		open c08;
		loop
		fetch c08 into	ie_regra_inclusao_w;
		EXIT WHEN NOT FOUND; /* apply on c08 */
			begin
			ie_regra_inclusao_w	:= ie_regra_inclusao_w;
			end;
		end loop;
		close c08;

	elsif (ie_tipo_regra_p = 'CIG') then

		open c09;
		loop
		fetch c09 into	ie_regra_inclusao_w;
		EXIT WHEN NOT FOUND; /* apply on c09 */
			begin
			ie_regra_inclusao_w	:= ie_regra_inclusao_w;
			end;
		end loop;
		close c09;

	elsif (ie_tipo_regra_p = 'REC') then

		open c10;
		loop
		fetch c10 into	ie_regra_inclusao_w;
		EXIT WHEN NOT FOUND; /* apply on c10 */
			begin
			ie_regra_inclusao_w	:= ie_regra_inclusao_w;
			end;
		end loop;
		close c10;

	elsif (ie_tipo_regra_p = 'SAE') then

		open c11;
		loop
		fetch c11 into	ie_regra_inclusao_w;
		EXIT WHEN NOT FOUND; /* apply on c11 */
			begin
			ie_regra_inclusao_w	:= ie_regra_inclusao_w;
			end;
		end loop;
		close c11;

	elsif (ie_tipo_regra_p = 'IVC') then

		open c12;
		loop
		fetch c12 into
			ie_regra_inclusao_w;
		EXIT WHEN NOT FOUND; /* apply on c12 */
			begin
			ie_regra_inclusao_w	:= ie_regra_inclusao_w;
			end;
		end loop;
		close c12;

	elsif (ie_tipo_regra_p in ('OX','GAS')) then

		open c13;
		loop
		fetch c13 into
			ie_regra_inclusao_w;
		EXIT WHEN NOT FOUND; /* apply on c13 */
			begin
			ie_regra_inclusao_w	:= ie_regra_inclusao_w;
			end;
		end loop;
		close c13;
	elsif (ie_tipo_regra_p = 'HM') then

		open c14;
		loop
		fetch c14 into
			ie_regra_inclusao_w;
		EXIT WHEN NOT FOUND; /* apply on c14 */
			begin
			ie_regra_inclusao_w	:= ie_regra_inclusao_w;
			end;
		end loop;
		close c14;
	elsif (ie_tipo_regra_p = 'SNE') then

		open c15;
		loop
		fetch c15 into
			ie_regra_inclusao_w;
		EXIT WHEN NOT FOUND; /* apply on c15 */
			begin
			ie_regra_inclusao_w	:= ie_regra_inclusao_w;
			end;
		end loop;
		close c15;

	elsif (ie_tipo_regra_p = 'NPA') then

		open c16;
		loop
		fetch c16 into
			ie_regra_inclusao_w;
		EXIT WHEN NOT FOUND; /* apply on c16 */
			begin
			ie_regra_inclusao_w	:= ie_regra_inclusao_w;
			end;
		end loop;
		close c16;
	elsif (ie_tipo_regra_p = 'NPN') then

		open c17;
		loop
		fetch c17 into
			ie_regra_inclusao_w;
		EXIT WHEN NOT FOUND; /* apply on c17 */
			begin
			ie_regra_inclusao_w	:= ie_regra_inclusao_w;
			end;
		end loop;
		close c17;

	elsif (ie_tipo_regra_p = 'DI') then

		open c18;
		loop
		fetch c18 into
			ie_regra_inclusao_w;
		EXIT WHEN NOT FOUND; /* apply on c18 */
			begin
			ie_regra_inclusao_w	:= ie_regra_inclusao_w;
			end;
		end loop;
		close c18;

	elsif (ie_tipo_regra_p = 'LD') then

		open c19;
		loop
		fetch c19 into
			ie_regra_inclusao_w;
		EXIT WHEN NOT FOUND; /* apply on c19 */
			begin
			ie_regra_inclusao_w	:= ie_regra_inclusao_w;
			end;
		end loop;
		close c19;

	end if;

end if;

return ie_regra_inclusao_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION adep_obter_regra_inclusao ( ie_tipo_regra_p text, cd_estabelecimento_p bigint, cd_setor_atendimento_p bigint, cd_perfil_p bigint, cd_material_p text, cd_procedimento_p text, ie_origem_proced_p bigint, nr_seq_proc_interno_p bigint, cd_setor_prescricao_p bigint, cd_setor_exec_proc_p bigint, nr_prescricao_p bigint default null, nr_seq_exame_p bigint  DEFAULT NULL) FROM PUBLIC;

