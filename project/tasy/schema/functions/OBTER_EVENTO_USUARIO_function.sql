-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_evento_usuario ( nm_usuario_p text, ie_filtra_exames_p text) RETURNS varchar AS $body$
DECLARE


/*Coloquei o parametro ie_filtra_exames_p para o parametro 8 do Tasymon, mas
  pode ser utilizado futuramente caso tenha outra filtragem por usuário.*/
ds_resultado_w		varchar(4000);
ie_tipo_evento_w		integer;
cd_setor_usuario_w		integer;
ds_tipo_evento_w		varchar(100);
cd_pessoa_usuario_w	varchar(10);
cd_evento_w		varchar(30);
nm_medico_w		varchar(80);
desc_compl_w		varchar(200);
ds_evento_w		varchar(2000);
dt_evento_w		timestamp;
nr_min_comunic_w		bigint;
nr_seq_aprovacao_w	bigint;
cd_cargo_w		bigint;

ie_tipo_aprov_w		varchar(01);
nr_seq_ord_sol_w		bigint;
nr_seq_item_w		bigint;
vl_material_w		double precision;
qt_material_w		double precision;
dt_aprovacao_w		timestamp;
ds_material_w		varchar(255);
nm_solic_w		varchar(255);
dt_liberacao_w		timestamp;
nr_seq_proc_aprov_W	bigint;
ie_etapa_w		varchar(2);
cd_estabelecimento_w	smallint;
nr_solic_compra_w	bigint;

ie_evento_agenda_w	varchar(001);
ie_evento_sac_w		varchar(001);
ie_evento_processo_w	varchar(001);
ie_evento_prescr_w	varchar(001);
ie_evento_hemo_w	varchar(001);
ie_evento_procage_w	varchar(001);
ie_evento_comunic_w	varchar(001);
ie_evento_alerta_w		varchar(001);
ie_evento_aprovacao_w	varchar(001);
ie_evento_exame_urg_w	varchar(001);
ie_evento_lib_telefone_w	varchar(001);
ie_evento_ordem_serv_w	varchar(001);
ie_evento_obj_inv_w	varchar(001);
ie_evento_recoleta_w	varchar(001);
ie_evento_susp_exame_w	varchar(001);
ie_grupo_ordem_serv_w	varchar(1)	:= 'N';
ie_evento_med_cih_w	varchar(1);
dt_final_cih_w		timestamp;
dt_inicial_cih_w		timestamp;
dt_final_w		timestamp;
nr_seq_operador_w	pls_operador.nr_sequencia%type;

ie_evento_solic_pront_w		varchar(1)	:= 'N';

ie_evento_int_agenda_san_w		varchar(1)	:= 'N';
ie_evento_vinc_agenda_san_w	varchar(1)	:= 'N';
ie_evento_canc_cir_san_w		varchar(1)	:= 'N';
ie_evento_canc_agenda_san_w	varchar(1)	:= 'N';
ie_evento_enc_agenda_san_w	varchar(1)	:= 'N';
ie_evento_transf_agenda_san_w	varchar(1)	:= 'N';
ie_evento_paciente_w		varchar(1)	:= 'N';
ie_evento_estrangeiro_w 		varchar(1)	:= 'N';

ie_evento_alteracao_param_w	varchar(1)	:= 'N';
ie_evento_alta_partic_w		varchar(1)	:= 'N';
ie_evento_alerta_medico_w		varchar(1)	:= 'N';

ie_evento_prev_alta_w		varchar(1)	:= 'N';

qt_regra_ordem_serv_w		bigint;
ie_somente_comunic_lib_w		varchar(1);
ie_restrige_estab_logado_w		varchar(1) 	:= 'S';

ie_evento_alta_partic_ext_w		varchar(1)	:= 'N';
ie_evento_alta_regra_w		varchar(1)	:= 'N';
ds_material_direto_w		varchar(255);
ds_observacao_w			varchar(255);

ie_evento_os_programar_w		varchar(1)	:= 'N';
nr_seq_grupo_des_w		bigint;
ie_evento_dieta_prescrita_w		varchar(1);

cd_setor_atendimento_w		varchar(255);
ie_evento_agenda_comercial_w	varchar(1);
ie_evento_alt_status_san_w		varchar(1);
ie_evento_requisicao_lib_w		varchar(1);
ie_ocorrencia_retorno_w		varchar(1);
IE_EVENTO_SOLIC_COMPRA_w	varchar(1);
itens_solicitacao_w			varchar(2000);
ie_evento_forma_entrega_w		varchar(1);
ie_evento_sc_urgente_w		varchar(1);
ie_evento_agenda_carater_w		varchar(1);
ie_carater_cir_w			varchar(30);
ie_tipo_atend_processo_w		varchar(255);
ie_evento_lib_receb_pp_w		varchar(1);
ie_evento_higienizacao_leito_w  varchar(1);
ie_evento_retorno_ligacao_w	varchar(1);

ie_evento_vaga_pend_aprov_w	varchar(1);


/* Eventos do TasyMon
	0 - Convite da agenda
	1 - Alarme da agenda
	2 - Eventos do SAC,
	3 - Processos pendentes
	4 - Prescrições incorretas
	5 - Processo Agenda
	6 - Comunicação Interna
	7 - Alertas do tasy - qualidade
	10 - Exames urgentes
	11 - Bloqueio/Liberação de telefones
	12 - Ordem Serviço
	13 - Objetos inválidos no sistema
	14 - Exames para recoleta
	15 - Prescrições suspensas
	16 - Liberação de medicamentos CIH
	17 - Equipamento em Manutenção
	18 - Liberação de solicitação de prontuário
	19 - Internação de paciente com agendamento cirurgico /bolsa
	20 - Vinculação de atendimento já internado com agendamento / bolsa
	21 - Cancelamento de cirurgia de paciente com agendamento bolsa/
	22 - Cancelamento de agendamento de paciente /bolsa
	23 - Agendamento de uma emergência(encaixe) /bolsa
	24 - Transferência de horário da agenda com solicitação de bolsa
	25 - Alteração de parâmetros
	26 - Eventos do paciente
	27 - Evento paciente estrangeiro
	28 - Evento de alta particular

	33 - OS programação

	42 - Dieta Prescrita
	43 - Requisição liberada
	44 - Agenda comercial
	45 - Alteração do status do hemocomponente do agendamento / Banco de sangue
	46 - Novo atendimento para paciente que fez reclamação no SAC
	47 - Evento de liberação da prescrição de exames não externos
	48 - Evento de liberação da ordem de compra
	50 - Alteração da forma de entrega do laudo da prescrição
	51 - Liberação de solicitação urgente
	52 - Agendamento de cirurgia com carácter especifico
	53 - Liberação de recebimentos dos pertences paciente
	55 - Higienização de Leito

	57 - Alerta de alteração de tabela na tela "Cadastro gerais"
	58 - Call Center - Retornar ligação (nova tentativa contato)
	59 - Avisar evento Vagas com status Aguardando pelo TasyMon
*/
C01 CURSOR FOR
	SELECT	0 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299143) ds_tipo_evento, /*'Convite Agenda'*/
		to_char(a.nr_sequencia) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299153,'NM_PESSOA_FISICA_W='||substr(obter_nome_usuario(a.nm_usuario),1,90)||';DS_AGENDA_W='||a.ds_agenda) ds_evento, /*'De ' || substr(obter_nome_usuario(a.nm_usuario),1,90) || ': ' || a.ds_agenda*/
		'' nm_medico,
		a.dt_agenda dt_evento,
		a.dt_final
	from	agenda_tasy_convite b,
			agenda_tasy a
	where	a.nr_sequencia		= b.nr_seq_agenda
	and		b.nm_usuario_convidado	= nm_usuario_p
	and	a.dt_agenda		>= trunc(clock_timestamp())
	and	coalesce(b.dt_confirmacao::text, '') = ''
	and	ie_evento_agenda_w	= 'S'
	
union

	SELECT	1 ie_tipo_evento,
		c.ds_tipo_agenda ds_tipo_evento,
		to_char(a.nr_sequencia) cd_evento,
		a.ds_agenda ds_evento,
		'' nm_medico,
		a.dt_agenda dt_evento,
		a.dt_final
	from	tipo_agenda_tasy c,
		agenda_tasy_alarme b,
		agenda_tasy a
	where	a.nr_seq_tipo		= b.nr_seq_tipo
	and	a.ie_status		= 'M'
	and	a.dt_agenda		between trunc(clock_timestamp()) and trunc(clock_timestamp()) + b.qt_tempo
	and	a.nm_usuario_agenda	= b.nm_usuario_agenda
	and	a.nm_usuario_agenda	= nm_usuario_p
	and	b.nr_seq_tipo		= c.nr_sequencia
	and	b.ie_unid_tempo		= 'D'
	and	ie_evento_agenda_w	= 'S'
	
union all

	select	1 ie_tipo_evento,
		c.ds_tipo_agenda ds_tipo_evento,
		to_char(a.nr_sequencia) cd_evento,
		a.ds_agenda ds_evento,
		'' nm_medico,
		a.dt_agenda dt_evento,
		a.dt_final
	from	tipo_agenda_tasy c,
		agenda_tasy_alarme b,
		agenda_tasy a
	where	a.nr_seq_tipo		= b.nr_seq_tipo
	and	a.ie_status		= 'M'
	and	a.dt_agenda		between trunc(clock_timestamp()) and clock_timestamp() + (b.qt_tempo / 1440)
	and	a.nm_usuario_agenda	= b.nm_usuario_agenda
	and	a.nm_usuario_agenda	= nm_usuario_p
	and	b.nr_seq_tipo		= c.nr_sequencia
	and	b.ie_unid_tempo		= 'M'
	and	ie_evento_agenda_w	= 'S';

c02 CURSOR FOR
	SELECT	2 ie_tipo_evento,
       		'SAC' ds_tipo_evento,
		to_char(b.nr_sequencia) cd_evento,
		' ' ds_evento,
		'' nm_medico,
		clock_timestamp() dt_evento
	from	sac_resp_bol_ocor b
	where (Obter_dados_sac_resp(b.nr_seq_responsavel,nm_usuario_p,'E') = 'S')
	and	coalesce(b.dt_usuario_ciente::text, '') = ''
	and	b.ie_status = 'A'
	and	ie_evento_sac_w		= 'S';

c03 CURSOR FOR
	SELECT	3 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299161) ds_tipo_evento, /*'Processo'*/
		to_char(a.nr_atendimento) || ',' ||
		to_char(a.cd_processo) || ',' ||
		to_char(a.nr_sequencia) cd_evento,
	        to_char(a.nr_atendimento) || ' - ' ||
		obter_nome_pessoa_fisica(t.cd_pessoa_fisica, null) || ' - ' ||
		obter_unidade_atendimento(t.nr_atendimento, 'A', 'SU') || ' - ' ||
		obter_dados_processo(a.cd_processo,'T') || ' - ' ||
		substr(obter_desc_convenio(obter_convenio_atendimento(a.nr_atendimento)),1,90) ds_evento,
		'' nm_medico,
		coalesce(a.dt_fim_prev,clock_timestamp()) dt_evento
	FROM	PROCESSO_ETAPA B,
		ATENDIMENTO_PACIENTE T,
		PROCESSO_ATENDIMENTO A
	WHERE a.NR_ATENDIMENTO   = T.NR_ATENDIMENTO
	  AND A.CD_PROCESSO      = B.CD_PROCESSO
	  AND A.NR_SEQUENCIA     = B.NR_SEQUENCIA
	  AND T.IE_FIM_CONTA     <> 'F'
	  AND A.IE_STATUS	= 'P'
	  AND coalesce(A.DT_FIM_REAL::text, '') = ''
	  and	((obter_se_contido(t.ie_tipo_atendimento,	ie_tipo_atend_processo_w) = 'S') or (ie_tipo_atend_processo_w = '0'))
	  AND ((upper(B.NM_USUARIO_RESP)  = upper(nm_usuario_p)) or (obter_se_contido_char(upper(nm_usuario_p),upper(b.ds_usuario_adicional)) = 'S'))
	and	ie_evento_processo_w	= 'S'
	
union all

	SELECT	3 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299161) ds_tipo_evento, /*'Processo'*/
		to_char(a.nr_atendimento) || ',' ||
		to_char(a.cd_processo) || ',' ||
		to_char(a.nr_sequencia) cd_evento,
	      to_char(a.nr_atendimento) || ' - ' ||
		obter_nome_pessoa_fisica(t.cd_pessoa_fisica, null) || ' - ' ||
		obter_unidade_atendimento(t.nr_atendimento, 'A', 'SU') || ' - ' ||
		obter_dados_processo(a.cd_processo,'T') || ' - ' ||
		substr(obter_desc_convenio(obter_convenio_atendimento(a.nr_atendimento)),1,90) ds_evento,
		'' nm_medico,
		coalesce(a.dt_fim_prev,clock_timestamp()) dt_evento
	FROM	PROCESSO_ETAPA B,
		ATENDIMENTO_PACIENTE T,
		PROCESSO_ATENDIMENTO A
	WHERE a.NR_ATENDIMENTO   = T.NR_ATENDIMENTO
	AND A.CD_PROCESSO      = B.CD_PROCESSO
	  AND A.NR_SEQUENCIA     = B.NR_SEQUENCIA
	  AND T.IE_FIM_CONTA     <> 'F'
	  AND A.IE_STATUS		= 'P'
	  AND coalesce(A.DT_FIM_REAL::text, '') = ''
	  and	((obter_se_contido(t.ie_tipo_atendimento,	ie_tipo_atend_processo_w) = 'S') or (ie_tipo_atend_processo_w = '0'))
	  AND A.CD_SETOR_RESP    = cd_setor_usuario_w
	and	ie_evento_processo_w	= 'S'
	
union all

	select	3 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299161) ds_tipo_evento, /*'Processo'*/
		to_char(a.nr_atendimento) || ',' ||
		to_char(a.cd_processo) || ',' ||
		to_char(a.nr_sequencia) cd_evento,
	      to_char(a.nr_atendimento) || ' - ' ||
		obter_nome_pessoa_fisica(t.cd_pessoa_fisica, null) || ' - ' ||
		obter_unidade_atendimento(t.nr_atendimento, 'A', 'SU') || ' - ' ||
		obter_dados_processo(a.cd_processo,'T') || ' - ' ||
		substr(obter_desc_convenio(obter_convenio_atendimento(a.nr_atendimento)),1,90) ds_evento,
		'' nm_medico,
		coalesce(a.dt_fim_prev,clock_timestamp()) dt_evento
	FROM	PROCESSO_ETAPA B,
		ATENDIMENTO_PACIENTE T,
		PROCESSO_ATENDIMENTO A
	WHERE a.NR_ATENDIMENTO   = T.NR_ATENDIMENTO
	  AND A.CD_PROCESSO      = B.CD_PROCESSO
	  AND A.NR_SEQUENCIA     = B.NR_SEQUENCIA
	  and	((obter_se_contido(t.ie_tipo_atendimento,	ie_tipo_atend_processo_w) = 'S') or (ie_tipo_atend_processo_w = '0'))
	  AND T.IE_FIM_CONTA     <> 'F'
	  AND A.IE_STATUS		= 'P'
	  AND coalesce(A.DT_FIM_REAL::text, '') = ''
	  AND A.CD_PESSOA_FISICA_RESP = cd_pessoa_usuario_w
	and	ie_evento_processo_w	= 'S';

c04 CURSOR FOR
	SELECT 	4 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299162) ds_tipo_evento, /*'Prescrição Incorreta'*/
		b.nr_prescricao || ',' || b.nr_sequencia cd_evento,
		b.nr_prescricao || ' - ' ||
		SUBSTR(OBTER_NOME_PF(p.CD_PESSOA_FISICA),0,80) || ' - ' ||
		substr(c.ds_procedimento,1,250) || ' - ' ||
		b.ds_integracao ds_evento,
		obter_nome_pessoa_fisica(a.cd_medico, null) nm_medico,
		a.dt_prescricao dt_evento
	from	pessoa_fisica p,
		procedimento c,
		prescr_procedimento b,
		prescr_medica a
	where 	a.nr_prescricao		= b.nr_prescricao
	  and 	a.cd_medico		<> cd_pessoa_usuario_w
	  and	a.cd_pessoa_fisica	= p.cd_pessoa_fisica
	  and	a.nm_usuario_original	= nm_usuario_p
	  and	b.cd_procedimento	= c.cd_procedimento
	  and	b.ie_origem_proced	= c.ie_origem_proced
	  and	b.cd_motivo_baixa = 0
	  and 	(b.dt_integracao IS NOT NULL AND b.dt_integracao::text <> '')
	and	ie_evento_prescr_w	= 'S'
	
union all

	SELECT 	4 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299162) ds_tipo_evento, /*'Prescrição Incorreta'*/
		b.nr_prescricao || ',' || b.nr_sequencia cd_evento,
		b.nr_prescricao || ' - ' ||
		SUBSTR(OBTER_NOME_PF(p.CD_PESSOA_FISICA),0,80) || ' - ' ||
		substr(c.ds_procedimento,1,250) || ' - ' ||
		b.ds_integracao ds_evento,
		obter_nome_pessoa_fisica(a.cd_medico, null) nm_medico,
		a.dt_prescricao dt_evento
	from	pessoa_fisica p,
		procedimento c,
		prescr_procedimento b,
		prescr_medica a
	where 	a.nr_prescricao	= b.nr_prescricao
	  and 	b.cd_setor_atendimento	= cd_setor_usuario_w
	  and 	a.cd_medico		<> cd_pessoa_usuario_w
	  and	a.cd_pessoa_fisica	= p.cd_pessoa_fisica
	  and	b.cd_procedimento	= c.cd_procedimento
	  and	b.ie_origem_proced	= c.ie_origem_proced
	  and	b.cd_motivo_baixa = 0
	  and 	(b.dt_integracao IS NOT NULL AND b.dt_integracao::text <> '')
	and	ie_evento_prescr_w	= 'S'
	
union all

	select 	 /*+ index (PRESPRO_I2 b) */		4 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299162) ds_tipo_evento, /*'Prescrição Incorreta'*/
		b.nr_prescricao || ',' || b.nr_sequencia cd_evento,
		b.nr_prescricao || ' - ' ||
		SUBSTR(OBTER_NOME_PF(p.CD_PESSOA_FISICA),0,80)  || ' - ' ||
		substr(c.ds_procedimento,1,250)  || ' - ' ||
		b.ds_integracao ds_evento,
		obter_nome_pessoa_fisica(a.cd_medico, null) nm_medico,
		a.dt_prescricao dt_evento
	from	pessoa_fisica p,
		procedimento c,
		prescr_procedimento b, prescr_medica a
	where 	a.nr_prescricao		= b.nr_prescricao
	  and 	a.cd_medico		= cd_pessoa_usuario_w
	  and	a.cd_pessoa_fisica	= p.cd_pessoa_fisica
	  and	b.cd_procedimento	= c.cd_procedimento
	  and	b.ie_origem_proced	= c.ie_origem_proced
	  and	b.cd_motivo_baixa = 0
	  and 	(b.dt_integracao IS NOT NULL AND b.dt_integracao::text <> '')
	and	ie_evento_prescr_w	= 'S';

c05 CURSOR FOR
	SELECT	5 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299163) ds_tipo_evento, /*'Processo Agenda'*/
		to_char(a.nr_seq_agenda) || ',' ||
		to_char(a.cd_processo) || ',' ||
		to_char(a.nr_seq_etapa) cd_evento,
	      	to_char(a.nr_seq_agenda) || ' - ' ||
		obter_nome_pessoa_fisica(t.cd_pessoa_fisica, null) || ' - ' ||
		obter_unidade_atendimento(t.nr_atendimento, 'A', 'SU') ds_evento,
		'' nm_medico,
		a.dt_fim_prev dt_evento
	FROM	PROCESSO_ETAPA B,
		agenda_paciente T,
		agenda_pac_processo A
	WHERE A.CD_PROCESSO      = B.CD_PROCESSO
	  AND A.NR_SEQ_etapa     = B.NR_SEQUENCIA
	  and a.NR_seq_agenda    = T.NR_sequencia
	  AND A.IE_STATUS	 = 'P'
	  AND A.NM_USUARIO_RESP  = nm_usuario_p
	  AND coalesce(A.DT_FIM_REAL::text, '') = ''
	and	ie_evento_procage_w	= 'S'
	
union all

	SELECT	5 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299163) ds_tipo_evento, /*'Processo Agenda'*/
		to_char(a.nr_seq_agenda) || ',' ||
		to_char(a.cd_processo) || ',' ||
		to_char(a.nr_seq_etapa) cd_evento,
	      	to_char(a.nr_seq_agenda) || ' - ' ||
		obter_nome_pessoa_fisica(t.cd_pessoa_fisica, null) || ' - ' ||
		obter_unidade_atendimento(t.nr_atendimento, 'A', 'SU') ds_evento,
		'' nm_medico,
		a.dt_fim_prev dt_evento
	FROM	PROCESSO_ETAPA B,
		agenda_paciente T,
		agenda_pac_processo A
	WHERE A.CD_PROCESSO      = B.CD_PROCESSO
	  AND A.NR_SEQ_etapa     = B.NR_SEQUENCIA
	  and a.NR_seq_agenda    = T.NR_sequencia
	  AND A.IE_STATUS	= 'P'
	  AND A.CD_SETOR_RESP    = cd_setor_usuario_w
	  AND coalesce(A.DT_FIM_REAL::text, '') = ''
	and	ie_evento_procage_w	= 'S'
	
union all

	select	5 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299163) ds_tipo_evento, /*'Processo Agenda'*/
		to_char(a.nr_seq_agenda) || ',' ||
		to_char(a.cd_processo) || ',' ||
		to_char(a.nr_seq_etapa) cd_evento,
	      	to_char(a.nr_seq_agenda) || ' - ' ||
		obter_nome_pessoa_fisica(t.cd_pessoa_fisica, null) || ' - ' ||
		obter_unidade_atendimento(t.nr_atendimento, 'A', 'SU') ds_evento,
		'' nm_medico,
		a.dt_fim_prev dt_evento
	FROM	PROCESSO_ETAPA B,
		agenda_paciente T,
		agenda_pac_processo A
	WHERE A.CD_PROCESSO      = B.CD_PROCESSO
	  AND A.NR_SEQ_etapa     = B.NR_SEQUENCIA
	  and a.NR_seq_agenda    = T.NR_sequencia
	  AND A.IE_STATUS	 = 'P'
	  AND coalesce(A.DT_FIM_REAL::text, '') = ''
	  AND A.CD_PESSOA_FISICA_RESP = cd_pessoa_usuario_w
	and	ie_evento_procage_w	= 'S';

c06 CURSOR FOR

	SELECT	6 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299165) ds_tipo_evento, /*'Comunicação Interna'*/
		to_char(a.nr_sequencia) cd_evento,
	      	WHEB_MENSAGEM_PCK.get_texto(299167,'DS_TITULO_W='||a.ds_titulo||';NM_PESSOA_FISICA_W='||obter_pessoa_fisica_usuario(a.nm_usuario,'D')) ds_evento, /*a.ds_titulo || ' (Enviada por: ' || obter_pessoa_fisica_usuario(a.nm_usuario,'D') || ')' */
		'' nm_medico,
		a.dt_comunicado dt_evento
	FROM	comunic_interna a
	WHERE 	a.dt_comunicado >= (clock_timestamp() - (nr_min_comunic_w / 1440))
	and	nr_min_comunic_w > 0
	/*and	obter_se_comunic_interna_lida(a.nr_sequencia, nm_usuario_p) = 'N'
	and	obter_se_mostra_comunic(a.nr_sequencia, nm_usuario_p, 'N', 'N', 0) = 'S'
	Francisco - OS 169764 - 16/10/2009 - Já trata tudo no obter_se_mostra_comunicacao */
	and (obter_se_mostra_comunicacao(a.nr_sequencia,
					nm_usuario_p,
					'S',
					'N',
					null,
					a.nm_usuario,
					substr(a.nm_usuario_destino,1,2000),
					substr(a.nm_usuario_destino,2001,2000),
              				a.ie_geral,
					a.ie_gerencial,
					a.cd_perfil,
					a.nr_seq_classif,
					substr(a.ds_perfil_adicional,1,2000),
					substr(a.ds_perfil_adicional,2001,2000),
              				a.ds_setor_adicional,
					a.cd_setor_destino,
					a.cd_estab_destino,
					a.ds_grupo,
					a.nm_usuario_oculto,
					substr(a.ds_grupo_perfil,1,2000),
					a.ds_usuarios_ocultos,
					ie_restrige_estab_logado_w, -- Era setado como fixo 'S', desta forma recebendo independente do estabelecimento logado,
					a.ds_estab_adicional,
					a.cd_especialidade,
					a.cd_cargo,
					a.cd_perfil_origem,
					a.ie_envio_terceiro,
					a.ie_funcionario) = 'S')
	and	(((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or (a.nm_usuario = nm_usuario_p)) or ie_somente_comunic_lib_w = 'N')
	and	ie_evento_comunic_w	= 'S';

c07 CURSOR FOR
	SELECT	7 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299168) ds_tipo_evento, /*'Alerta'*/
		to_char(a.nr_sequencia) cd_evento,
	      	b.nm_alerta ds_evento,
		'' nm_medico,
		a.dt_alerta dt_evento
	FROM	alerta_tasy b,
		alerta_tasy_ocor a
	WHERE 	a.nr_seq_alerta		= b.nr_sequencia
	and	a.nm_usuario_alertado	= nm_usuario_p
	and	a.ie_usuario_ciente	= 'N'
	and	ie_evento_alerta_w	= 'S';

c08 CURSOR FOR
SELECT	10 ie_tipo_evento,
	Wheb_mensagem_pck.get_Texto(299169) ds_tipo_evento, /*Hemoterapia*/
	TO_CHAR(b.nr_prescricao) || ',' || TO_CHAR(b.nr_sequencia) cd_evento,
	replace(SUBSTR(Wheb_mensagem_pck.get_Texto(299170) || substr(Obter_desc_san_derivado(b.nr_seq_derivado),1,50) || Wheb_mensagem_pck.get_Texto(299171) ||
	SUBSTR(obter_pessoa_atendimento(a.nr_atendimento, 'N'),1,100) ||
	Wheb_mensagem_pck.get_Texto(299172) || a.nr_prescricao ||
	Wheb_mensagem_pck.get_Texto(299174) || TO_CHAR(a.nr_controle) ||
	Wheb_mensagem_pck.get_Texto(299175) || SUBSTR(obter_unidade_atendimento(a.nr_atendimento,'A','SU'),1,30) ||
	Wheb_mensagem_pck.get_Texto(299176) || a.nr_atendimento ||
	Wheb_mensagem_pck.get_Texto(299177) || TO_CHAR(a.dt_prescricao,'dd/mm/yyyy hh24:mi:ss') ||
	Wheb_mensagem_pck.get_Texto(299178) || SUBSTR(OBTER_DESC_LOCAL_PA(nr_seq_local_pa),1,80) ||
	Wheb_mensagem_pck.get_Texto(299179) || SUBSTR(obter_dados_unidade2(Obter_Atepacu_paciente(a.nr_atendimento,'IAA'),'NSUBUC'),1,90) ||
	Wheb_mensagem_pck.get_Texto(299181) || b.ds_observacao,1,2000), chr(10), '') ds_evento,
	'' nm_medico,
	a.dt_prescricao dt_evento
from	atendimento_paciente d,
	prescr_procedimento b,
	prescr_medica a
where 	a.nr_prescricao	= b.nr_prescricao
and	a.nr_atendimento = d.nr_atendimento
and 	a.dt_prescricao > clock_timestamp() - interval '43200 seconds'
and		(b.nr_seq_derivado IS NOT NULL AND b.nr_seq_derivado::text <> '')
and		ie_evento_hemo_w <> 'N'
and 	not exists
	(select 1
	from 	prescr_proc_ciente x
	where 	x.nr_prescricao = b.nr_prescricao
	and 	x.nr_seq_prescr = b.nr_sequencia
	and	((ie_filtra_exames_p = 'S' and x.nm_usuario = nm_usuario_p) or (ie_filtra_exames_p = 'N')));

c10 CURSOR FOR
	SELECT	10 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299182) ds_tipo_evento, /*'Exame Urgente'*/
		TO_CHAR(b.nr_prescricao) || ',' || TO_CHAR(b.nr_sequencia) cd_evento,
		SUBSTR(WHEB_MENSAGEM_PCK.get_texto(299183,
			'NM_EXAME_W='||c.nm_exame||
			';NM_PACIENTE_W='||SUBSTR(obter_pessoa_atendimento(a.nr_atendimento, 'N'),1,100)||
			';NR_PRESCRICAO_W='||a.nr_prescricao||
			';NR_CONTROLE_W='||TO_CHAR(a.nr_controle)||
			';DS_LOCAL_W='||SUBSTR(obter_unidade_atendimento(a.nr_atendimento,'A','SU'),1,30)||
			';NR_ATENDIMENTO_W='||a.nr_atendimento||
			';DT_PRESCRICAO_W='||TO_CHAR(a.dt_prescricao,'dd/mm/yyyy hh24:mi:ss')||
			';DS_LOCAL_PA_W='||SUBSTR(OBTER_DESC_LOCAL_PA(nr_seq_local_pa),1,80)||
			';DS_SETOR_W='||SUBSTR(obter_dados_unidade2(Obter_Atepacu_paciente(a.nr_atendimento,'IAA'),'NSUBUC'),1,90)||
			';DS_OBSERVACAO_W='||b.ds_observacao),1,2000) ds_evento,
		'' nm_medico,
		a.dt_prescricao dt_evento
	from	exame_laboratorio c,
		atendimento_paciente d,
		prescr_procedimento b,
		prescr_medica a
	where 	a.nr_prescricao	= b.nr_prescricao
	and	a.nr_atendimento = d.nr_atendimento
	and 	b.nr_seq_exame	= c.nr_seq_exame
	and 	a.dt_prescricao > clock_timestamp() - interval '43200 seconds'
	and	((b.ie_urgencia	  = 'S' and ie_evento_exame_urg_w = 'S') or ie_evento_exame_urg_w = 'T')
	and	ie_evento_exame_urg_w <> 'N'
	and 	not exists
		(SELECT 1
		from 	prescr_proc_ciente x
		where 	x.nr_prescricao = b.nr_prescricao
		and 	x.nr_seq_prescr = b.nr_sequencia
		and	((ie_filtra_exames_p = 'S' and x.nm_usuario = nm_usuario_p) or (ie_filtra_exames_p = 'N')));

c11 CURSOR FOR
	SELECT	11 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299184) ds_tipo_evento, /*'Liberação de telefone'*/
		substr(nr_sequencia,1,10) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299187,'NR_RAMAL_W='||substr(nr_ramal,1,20)||';DS_SETOR_W='||substr(obter_nome_setor(cd_setor_atendimento),1,100)||';CD_UNIDADE_BASICA_W='||cd_unidade_basica||';CD_UNIDADE_COMPL_W='||cd_unidade_compl) ds_evento,
		'' nm_medico,
		dt_evento dt_evento
	from	tel_reg_evento
	where	coalesce(dt_realizacao::text, '') = ''
	and	nr_seq_acao	= 16
	and	nr_seq_evento	= 10
	and	ie_evento_lib_telefone_w = 'S'
	
union all

	SELECT	11 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299188) ds_tipo_evento, /*'Bloqueio de telefone'*/
		substr(nr_sequencia,1,10) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299189,'NR_RAMAL_W='||substr(nr_ramal,1,20)||';DS_SETOR_W='||substr(obter_nome_setor(cd_setor_atendimento),1,100)||';CD_UNIDADE_BASICA_W='||cd_unidade_basica||';CD_UNIDADE_COMPL_W='||cd_unidade_compl) ds_evento,
		'' nm_medico,
		dt_evento dt_evento
	from	tel_reg_evento
	where	coalesce(dt_realizacao::text, '') = ''
	and	nr_seq_acao	= 16
	and	nr_seq_evento	= 12
	and	ie_evento_lib_telefone_w = 'S';

c13 CURSOR FOR
	SELECT	13 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299190) ds_tipo_evento, /*Objetos inválidos*/
		to_char(0) cd_evento,
		Wheb_mensagem_pck.get_Texto(299191, 'QT_OBJETOS_W='||count(*)), /*'Há ' || count(*) || ' objetos inválido(s) no sistema!' ds_evento,*/
		'' nm_medico,
		clock_timestamp() dt_evento
	from	objetos_invalidos_v
	where	ie_evento_obj_inv_w = 'S'
	having	count(*) > 0;

c14 CURSOR FOR
	SELECT	14 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299192) ds_tipo_evento, /*Recoleta de exames*/
		to_char(0) cd_evento,
		Wheb_mensagem_pck.get_Texto(299194) || a.nr_prescricao ||
		Wheb_mensagem_pck.get_Texto(299197) || substr(obter_nome_pf(b.cd_pessoa_fisica),1,60) ||
		CASE WHEN coalesce(obter_telefone_pf(b.cd_pessoa_fisica,1)::text, '') = '' THEN ''  ELSE Wheb_mensagem_pck.get_Texto(299198) || obter_telefone_pf(b.cd_pessoa_fisica,1) END  ||
		Wheb_mensagem_pck.get_Texto(299199) || c.ds_motivo_recoleta ds_evento,
		substr(obter_nome_medico(b.cd_medico,'N'),1,60) nm_medico,
		a.dt_atualizacao dt_evento
	from	lab_motivo_recoleta c,
		prescr_medica b,
		prescr_procedimento a
	where	a.nr_prescricao		= b.nr_prescricao
	and	a.nr_seq_recoleta	= c.nr_sequencia
	and	(ie_etapa_w <  (SELECT	max(x.ie_etapa)
				from	prescr_proc_etapa x
				where	x.nr_seq_prescricao	= a.nr_sequencia
				and	x.nr_prescricao		= a.nr_prescricao))
	and	a.dt_atualizacao > clock_timestamp() - interval '43200 seconds'
	and	a.ie_status_atend	= ie_etapa_w
	and	ie_evento_recoleta_w	= 'S';

c15 CURSOR FOR
	SELECT	15 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299200) ds_tipo_evento, /*Exame suspenso*/
		to_char(a.nr_prescricao) || ',' || to_char(a.nr_sequencia) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299201,'NR_PRESCRICAO_W='||a.nr_prescricao||';NM_PACIENTE_W='||substr(obter_nome_pf(b.cd_pessoa_fisica),1,60)||';DS_EXAME_W='||substr(obter_desc_exame(a.nr_seq_exame),1,250)) ds_evento,
		substr(obter_nome_medico(b.cd_medico,'N'),1,60) nm_medico,
		a.dt_atualizacao dt_evento
	from	prescr_medica b,
		prescr_procedimento a
	where	a.nr_prescricao		= b.nr_prescricao
	and	(a.nr_seq_exame IS NOT NULL AND a.nr_seq_exame::text <> '')
	and	a.dt_atualizacao > clock_timestamp() - interval '43200 seconds'
	and	a.ie_suspenso		= 'S'
	and	ie_evento_susp_exame_w	= 'S'
	and 	not exists
		(SELECT 1
		from 	prescr_proc_ciente x
		where 	x.nr_prescricao = a.nr_prescricao
		and 	x.nr_seq_prescr = a.nr_sequencia
		and	((ie_filtra_exames_p = 'S' and x.nm_usuario = nm_usuario_p) or (ie_filtra_exames_p = 'N')));

c16 CURSOR FOR
	SELECT	16 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299203) ds_tipo_evento, /*Liberação de medicamentos*/
		to_char(a.nr_prescricao) || ',' || to_char(a.nr_sequencia) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299204,'NR_PRESCRICAO_W='||a.nr_prescricao||';NM_PACIENTE_W='||substr(obter_nome_pf(b.cd_pessoa_fisica),1,60)||';DS_MATERIAL_W='||c.ds_material||';DS_MOTIVO_W='||CASE WHEN a.cd_motivo_baixa=0 THEN ' '  ELSE ' ' || wheb_mensagem_pck.get_texto(802753) END ) ds_evento,
		substr(obter_nome_medico(b.cd_medico,'N'),1,60) nm_medico,
		a.dt_atualizacao dt_evento
	from	atendimento_paciente d,
		material c,
		prescr_medica b,
		prescr_material a
	where	a.nr_prescricao	= b.nr_prescricao
	and	a.cd_material	= c.cd_material
	and	b.nr_atendimento	= d.nr_atendimento
	and     b.dt_prescricao between dt_inicial_cih_w and dt_final_cih_w
	and	(a.ds_justificativa IS NOT NULL AND a.ds_justificativa::text <> '')
	and	coalesce(a.qt_dias_liberado::text, '') = ''
	and	(c.cd_medicamento IS NOT NULL AND c.cd_medicamento::text <> '')
	and	ie_evento_med_cih_w = 'S';

c17 CURSOR FOR
	SELECT	17 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299207) ds_tipo_evento, /*Equipamento em Manutenção*/
		to_char(a.nr_sequencia) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299208,
			'NR_SEQUENCIA_W='||a.nr_sequencia||
			';DS_EQUIPAMENTO_W='||substr(man_obter_desc_equipamento(a.nr_seq_equipamento),1,200)||
			';DS_LOCALIZACAO_W='||substr(obter_descricao_padrao('MAN_LOCALIZACAO','DS_LOCALIZACAO',a.nr_seq_localizacao),1,80)||
			';DS_DANO_BREVE_W='||a.ds_dano_breve) ds_evento,
		'' nm_medico,
		a.dt_ordem_servico dt_evento
	from	man_ordem_servico a
	where	a.dt_ordem_servico > clock_timestamp() - interval '43200 seconds'
	and	exists (SELECT	1
			from	man_regra_envio_mon y,
				man_regra_envio_usuario x
			where	x.nr_seq_regra	= y.nr_sequencia
			and	y.cd_estabelecimento	= cd_estabelecimento_w
			and	coalesce(y.nr_grupo_trabalho,a.nr_grupo_trabalho)	= a.nr_grupo_trabalho
			and	coalesce(y.nr_seq_equipamento,a.nr_seq_equipamento)	= a.nr_seq_equipamento
			and	x.nm_usuario_ref				= nm_usuario_p)
	and	not exists (select	1
				from	man_ordem_serv_ciente x
				where	x.nr_seq_ordem		= a.nr_sequencia
				and	x.nm_usuario		= nm_usuario_p)
	and	qt_regra_ordem_serv_w > 0;

c18 CURSOR FOR
	SELECT	18 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299211) ds_tipo_evento, /*Liberação de solicitação de prontuário*/
		to_char(a.nr_sequencia) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299212,
			'NR_SEQUENCIA_W='||a.nr_sequencia||
			';NR_ATENDIMENTO_W='||a.nr_atendimento||
			';NM_PESSOA_W='||substr(obter_nome_pf(cd_pessoa_fisica),1,80)),
		'' nm_medico,
		a.dt_liberacao dt_evento
	from	same_solic_pront a
	where	a.dt_liberacao > clock_timestamp() - interval '43200 seconds'
	and	not exists (SELECT	1
				from	same_solic_ciente x
				where	x.nr_seq_solic		= a.nr_sequencia
				and	x.nm_usuario		= nm_usuario_p)
	and	ie_evento_solic_pront_w = 'S';

c19 CURSOR FOR
	SELECT 	19 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299214) ds_tipo_evento,/*Internação de paciente com agendamento cirurgico que possui solicitação de bolsa*/
		TO_CHAR(a.nr_sequencia) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299215,
			'NM_PESSOA_FISICA_W='||SUBSTR(OBTER_NOME_PF(c.CD_PESSOA_FISICA),1,80)||
			';NR_PRONTUARIO_W='||nr_prontuario||
			';NR_LEITO_W='||SUBSTR(OBTER_UNIDADE_ATENDIMENTO(y.nr_atendimento,'A','SU'),1,90)||
			';DT_CIRURGIA_W='||TO_CHAR(hr_inicio,'dd/mm/yyyy hh24:mi:ss')||
			';NR_PROC_W='||SUBSTR(obter_exame_agenda(cd_procedimento, ie_origem_proced, a.nr_seq_proc_interno),1,240)),
		'' nm_medico,
		y.dt_entrada dt_evento
	FROM  agenda_pac_sangue b,
		 pessoa_fisica c,
		 agenda_paciente a,
		 atendimento_paciente y
	WHERE a.nr_sequencia = b.nr_seq_agenda
	AND coalesce(a.dt_cancelamento::text, '') = ''
	AND y.cd_pessoa_fisica = a.cd_pessoa_fisica
	AND c.cd_pessoa_fisica = y.cd_pessoa_fisica
	AND a.ie_status_agenda NOT IN ('E','B','C')
	AND coalesce(y.dt_alta::text, '') = ''
	AND y.ie_tipo_atendimento = 1
	AND	y.dt_entrada > clock_timestamp() - interval '43200 seconds'
	AND	NOT EXISTS (SELECT	1
					FROM	agenda_pac_sangue_ciente x
					WHERE	x.nr_seq_agenda		= a.nr_sequencia
					AND		x.nm_usuario		= nm_usuario_p
					AND     x.ie_tipo_evento IN ('IAB','AIB'))
	and ie_evento_int_agenda_san_w	 = 'S';

c20 CURSOR FOR
	SELECT 	20 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299218) ds_tipo_evento, /*'Vinculação de atendimento já internado com agendamento cirurgico que possui solicitação de bolsa'*/
		TO_CHAR(a.nr_sequencia) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299219,
			'NM_PESSOA_FISICA_W='||SUBSTR(OBTER_NOME_PF(c.CD_PESSOA_FISICA),1,80)||
			';NR_PRONTUARIO_W='||nr_prontuario||
			';NR_LEITO_W='||SUBSTR(OBTER_UNIDADE_ATENDIMENTO(y.nr_atendimento,'A','SU'),1,90)||
			';DT_CIRURGIA_W='||TO_CHAR(hr_inicio,'dd/mm/yyyy hh24:mi:ss')||
			';DS_PROC_W='||SUBSTR(obter_exame_agenda(cd_procedimento, ie_origem_proced, a.nr_seq_proc_interno),1,240)),
		'' nm_medico,
		a.dt_vinculacao_atendimento dt_evento
	FROM  	agenda_pac_sangue b,
		 pessoa_fisica c,
		 agenda_paciente a,
		 atendimento_paciente y
	WHERE a.nr_sequencia = b.nr_seq_agenda
	AND coalesce(a.dt_cancelamento::text, '') = ''
	AND y.nr_atendimento = a.nr_atendimento
	AND c.cd_pessoa_fisica = y.cd_pessoa_fisica
	AND a.ie_status_agenda NOT IN ('E','B','C')
	AND a.dt_vinculacao_atendimento > clock_timestamp() - interval '43200 seconds'
	AND NOT EXISTS (SELECT	1
			FROM	agenda_pac_sangue_ciente x
			WHERE	x.nr_seq_agenda		= a.nr_sequencia
			AND		x.nm_usuario		= nm_usuario_p
			AND     x.ie_tipo_evento IN ('IAB','AIB'))
	and ie_evento_vinc_agenda_san_w = 'S';

c21 CURSOR FOR
	SELECT 	21 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299222) ds_tipo_evento, /*Cancelamento de cirurgia de paciente com agendamento cirurgico que possui solicitação de bolsa*/
		TO_CHAR(a.nr_sequencia) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299223,
			'NM_PESSOA_FISICA_W='||SUBSTR(OBTER_NOME_PF(c.CD_PESSOA_FISICA),1,80)||
			';NR_PRONTUARIO_W='||nr_prontuario||
			';NR_LEITO_W='||SUBSTR(OBTER_UNIDADE_ATENDIMENTO(y.nr_atendimento,'A','SU'),1,90)||
			';DT_CIRURGIA_W='||TO_CHAR(hr_inicio,'dd/mm/yyyy hh24:mi:ss')||
			';DS_PROC_W='||SUBSTR(obter_exame_agenda(cd_procedimento, a.ie_origem_proced, a.nr_seq_proc_interno),1,240)),
		'' nm_medico,
		a.dt_cancelamento dt_evento
	FROM  	agenda_pac_sangue b,
		pessoa_fisica c,
		cirurgia d,
		agenda_paciente a,
		atendimento_paciente y
	WHERE 	a.nr_sequencia = b.nr_seq_agenda
	AND 	d.nr_cirurgia = a.nr_cirurgia
	AND 	y.nr_atendimento = a.nr_atendimento
	AND	c.cd_pessoa_fisica = y.cd_pessoa_fisica
	AND 	d.dt_cancelamento > clock_timestamp() - interval '43200 seconds'
	AND	NOT EXISTS (SELECT	1
				FROM	agenda_pac_sangue_ciente x
				WHERE	x.nr_seq_agenda		= a.nr_sequencia
				AND		x.nm_usuario		= nm_usuario_p
				AND     x.ie_tipo_evento IN ('CCB','CAB'))
	and ie_evento_canc_cir_san_w = 'S';

c22 CURSOR FOR
	SELECT 	22 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299225) ds_tipo_evento, /*Cancelamento de agendamento de paciente com solicitação de bolsa*/
		TO_CHAR(a.nr_sequencia) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299226,
			'NM_PESSOA_FISICA_W='||SUBSTR(OBTER_NOME_PF(c.CD_PESSOA_FISICA),1,80)||
			';NR_PRONTUARIO_W='||nr_prontuario||
			';NR_LEITO_W='||SUBSTR(OBTER_UNIDADE_ATENDIMENTO(y.nr_atendimento,'A','SU'),1,90)||
			';DT_CIRURGIA_W='||TO_CHAR(hr_inicio,'dd/mm/yyyy hh24:mi:ss')||
			';DS_PROC_W='||SUBSTR(obter_exame_agenda(cd_procedimento, a.ie_origem_proced, a.nr_seq_proc_interno),1,240)),
		'' nm_medico,
		a.dt_cancelamento dt_evento
	FROM pessoa_fisica c, agenda_pac_sangue b, agenda_paciente a
LEFT OUTER JOIN atendimento_paciente y ON (a.nr_atendimento = y.nr_atendimento)
WHERE a.nr_sequencia = b.nr_seq_agenda  AND c.cd_pessoa_fisica = a.cd_pessoa_fisica AND a.dt_cancelamento > clock_timestamp() - interval '43200 seconds' AND NOT EXISTS (SELECT	1
					FROM	agenda_pac_sangue_ciente x
					WHERE	x.nr_seq_agenda		= a.nr_sequencia
					AND		x.nm_usuario		= nm_usuario_p
					AND     x.ie_tipo_evento IN ('CCB','CAB')) and ie_evento_canc_agenda_san_w = 'S';

c23 CURSOR FOR
	SELECT 	23 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299227) ds_tipo_evento, /*Agendamento de uma emergência(encaixe) com solicitação de bolsa*/
		TO_CHAR(a.nr_sequencia) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299230,
			'NM_PESSOA_FISICA_W='||SUBSTR(OBTER_NOME_PF(c.CD_PESSOA_FISICA),1,80)||
			';NR_PRONTUARIO_W='||nr_prontuario||
			';NR_LEITO_W='||SUBSTR(OBTER_UNIDADE_ATENDIMENTO(y.nr_atendimento,'A','SU'),1,90)||
			';DT_CIRURGIA_W='||TO_CHAR(hr_inicio,'dd/mm/yyyy hh24:mi:ss')||
			';DS_PROC_W='||SUBSTR(obter_exame_agenda(cd_procedimento, a.ie_origem_proced, a.nr_seq_proc_interno),1,240)),
		'' nm_medico,
		a.dt_geracao_encaixe dt_evento
	FROM pessoa_fisica c, agenda_pac_sangue b, agenda_paciente a
LEFT OUTER JOIN atendimento_paciente y ON (a.nr_atendimento = y.nr_atendimento)
WHERE a.nr_sequencia = b.nr_seq_agenda  AND c.cd_pessoa_fisica = a.cd_pessoa_fisica AND a.dt_geracao_encaixe > clock_timestamp() - interval '43200 seconds' AND NOT EXISTS (SELECT	1
					FROM	agenda_pac_sangue_ciente x
					WHERE	x.nr_seq_agenda		= a.nr_sequencia
					AND		x.nm_usuario		= nm_usuario_p
					AND     x.ie_tipo_evento IN ('GEB')) and ie_evento_enc_agenda_san_w = 'S';

c24 CURSOR FOR
	SELECT 	24 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299232) ds_tipo_evento, /*Transferência de horário da agenda com solicitação de bolsa*/
		TO_CHAR(a.nr_sequencia) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299233,
			'NM_PESSOA_FISICA_W='||SUBSTR(OBTER_NOME_PF(c.CD_PESSOA_FISICA),1,80)||
			';NR_PRONTUARIO_W='||nr_prontuario||
			';NR_LEITO_W='||SUBSTR(OBTER_UNIDADE_ATENDIMENTO(y.nr_atendimento,'A','SU'),1,90)||
			';DT_CIRURGIA_W='||TO_CHAR(hr_inicio,'dd/mm/yyyy hh24:mi:ss')||
			';DS_PROC_W='||SUBSTR(obter_exame_agenda(cd_procedimento, a.ie_origem_proced, a.nr_seq_proc_interno),1,240)),
		'' nm_medico,
		d.dt_acao dt_evento
	FROM agenda_historico_acao d, pessoa_fisica c, agenda_pac_sangue b, agenda_paciente a
LEFT OUTER JOIN atendimento_paciente y ON (a.nr_atendimento = y.nr_atendimento)
WHERE a.nr_sequencia = b.nr_seq_agenda  AND d.nr_seq_agenda  = a.nr_sequencia AND d.ie_acao		 = 'T' AND c.cd_pessoa_fisica = a.cd_pessoa_fisica AND dt_acao > clock_timestamp() - interval '43200 seconds' AND NOT EXISTS (SELECT	1
					FROM	agenda_pac_sangue_ciente x
					WHERE	x.nr_seq_agenda		= a.nr_sequencia
					AND		x.nm_usuario		= nm_usuario_p
					AND     x.ie_tipo_evento IN ('TAB')) and ie_evento_transf_agenda_san_w = 'S';

c25 CURSOR FOR
	SELECT	25 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299234) ds_tipo_evento, /*Alteração de parâmetro hospital*/
		to_char(c.cd_funcao) || ':' || TO_CHAR(c.nr_sequencia) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299236,
			'DS_FUNCAO_W='|| substr(obter_desc_funcao(c.cd_funcao),1,80) ||
			';NR_SEQUENCIA_W='|| c.nr_sequencia ||
			';DS_PARAMETRO_W='|| substr(c.ds_parametro,1,255) ||
			';NM_PESSOA_W='||substr(obter_pessoa_fisica_usuario(c.nm_usuario,'N'),1,80) ||
			';VL_ALTERADO_W='|| substr(CASE WHEN obter_se_param_senha(c.cd_funcao,c.nr_sequencia)='S' THEN  rpad('*',LENGTH(c.vl_parametro),'*')  ELSE c.vl_parametro END ,1,20)),
		'' nm_medico,
		c.dt_atualizacao dt_evento
	from	funcao_parametro c
	where	c.dt_atualizacao > clock_timestamp() - interval '43200 seconds'
	and	(c.vl_parametro IS NOT NULL AND c.vl_parametro::text <> '')
	and	not exists (SELECT	1
				from	usuario_param_ciente x
				where	x.nm_usuario	= nm_usuario_p
				and	x.cd_funcao	= c.cd_funcao
				and	x.nr_seq_param	= c.nr_sequencia
				and	x.dt_atualizacao > c.dt_atualizacao)
	and	ie_evento_alteracao_param_w = 'S'
	
union all

	select	25 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299237) ds_tipo_evento, /*'Alteração de parâmetro perfil*/
		to_char(c.cd_funcao) || ':' || TO_CHAR(c.nr_sequencia) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299244,
			'DS_FUNCAO_W='|| substr(obter_desc_funcao(c.cd_funcao),1,80) ||
			';NR_SEQUENCIA_W='|| c.nr_sequencia ||
			';DS_PARAMENTRO_W='|| obter_descricao_parametro(c.cd_funcao, c.nr_sequencia) ||
			';DS_PERFIL_W='|| substr(obter_desc_perfil(c.cd_perfil),1,255) ||
			';NM_PESSOA_W='|| substr(obter_pessoa_fisica_usuario(c.nm_usuario,'N'),1,80) ||
			';VL_ALTERADO_W='|| substr(CASE WHEN obter_se_param_senha(c.cd_funcao,c.nr_sequencia)='S' THEN  rpad('*',LENGTH(c.vl_parametro),'*')  ELSE c.vl_parametro END ,1,20)),
		'' nm_medico,
		c.dt_atualizacao dt_evento
	from	funcao_param_perfil c
	where	c.dt_atualizacao > clock_timestamp() - interval '43200 seconds'
	and	not exists (select	1
				from	usuario_param_ciente x
				where	x.nm_usuario	= nm_usuario_p
				and	x.cd_funcao	= c.cd_funcao
				and	x.nr_seq_param	= c.nr_sequencia
				and	x.dt_atualizacao > c.dt_atualizacao)
	and	ie_evento_alteracao_param_w = 'S'
	
union all

	select	25 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299247) ds_tipo_evento, /*Alteração de parâmetro usuário*/
		to_char(c.cd_funcao) || ':' || TO_CHAR(c.nr_sequencia) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299249,
			'DS_FUNCAO_W='|| substr(obter_desc_funcao(c.cd_funcao),1,80) ||
			';NR_SEQUENCIA_W='|| c.nr_sequencia ||
			';DS_PARAMETRO_W='|| obter_descricao_parametro(c.cd_funcao, c.nr_sequencia) ||
			';NM_PESSOA_W='||substr(obter_pessoa_fisica_usuario(c.nm_usuario,'N'),1,80) ||
			';VL_ALTERADO_W='|| substr(CASE WHEN obter_se_param_senha(c.cd_funcao,c.nr_sequencia)='S' THEN  rpad('*',LENGTH(c.vl_parametro),'*')  ELSE c.vl_parametro END ,1,20)),
		'' nm_medico,
		c.dt_atualizacao dt_evento
	from	funcao_param_usuario c
	where	c.dt_atualizacao > clock_timestamp() - interval '43200 seconds'
	and	not exists (select	1
				from	usuario_param_ciente x
				where	x.nm_usuario	= nm_usuario_p
				and	x.cd_funcao	= c.cd_funcao
				and	x.nr_seq_param	= c.nr_sequencia
				and	x.dt_atualizacao > c.dt_atualizacao)
	and	ie_evento_alteracao_param_w = 'S'
	
union all

	select	25 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299250) ds_tipo_evento, /*'Exclusão de parâmetro usuário'*/
		to_char(c.cd_funcao) || ':' || TO_CHAR(c.nr_seq_parametro) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299251,
			'DS_FUNCAO_W='|| substr(obter_desc_funcao(c.cd_funcao),1,80) ||
			';NR_SEQ_PARAMETRO_W='|| c.nr_seq_parametro ||
			';DS_PARAMETRO_W='|| obter_descricao_parametro(c.cd_funcao, c.nr_seq_parametro) ||
			';NM_PESSOA_FISICA_W='|| substr(obter_pessoa_fisica_usuario(c.nm_usuario_param,'N'),1,80) ||
			';NM_USUARIO_EXC_W='|| substr(obter_pessoa_fisica_usuario(c.nm_usuario,'N'),1,80)),
		'' nm_medico,
		c.dt_atualizacao dt_evento
	from	log_exclusao_param c
	where	c.dt_atualizacao > clock_timestamp() - interval '43200 seconds'
	and	(c.nm_usuario_param IS NOT NULL AND c.nm_usuario_param::text <> '')
	and	not exists (select	1
				from	usuario_param_ciente x
				where	x.nm_usuario	= nm_usuario_p
				and	x.cd_funcao	= c.cd_funcao
				and	x.nr_seq_param	= c.nr_seq_parametro
				and	x.dt_atualizacao > c.dt_atualizacao)
	and	ie_evento_alteracao_param_w = 'S'
	
union all

	select	25 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299252) ds_tipo_evento, /*'Exclusão de parâmetro perfil' */
		to_char(c.cd_funcao) || ':' || TO_CHAR(c.nr_seq_parametro) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299253,
			'DS_FUNCAO_W='|| substr(obter_desc_funcao(c.cd_funcao),1,80) ||
			';NR_SEQ_PARAMETRO_W='|| c.nr_seq_parametro ||
			';DS_PARAMETRO_W='|| obter_descricao_parametro(c.cd_funcao, c.nr_seq_parametro) ||
			';NM_PESSOA_FISICA_W='|| substr(obter_pessoa_fisica_usuario(c.nm_usuario_param,'N'),1,80) ||
			';NM_USUARIO_EXC_W='|| substr(obter_pessoa_fisica_usuario(c.nm_usuario,'N'),1,80)),
		'' nm_medico,
		c.dt_atualizacao dt_evento
	from	log_exclusao_param c
	where	c.dt_atualizacao > clock_timestamp() - interval '43200 seconds'
	and	(c.cd_perfil IS NOT NULL AND c.cd_perfil::text <> '')
	and	not exists (select	1
				from	usuario_param_ciente x
				where	x.nm_usuario	= nm_usuario_p
				and	x.cd_funcao	= c.cd_funcao
				and	x.nr_seq_param	= c.nr_seq_parametro
				and	x.dt_atualizacao > c.dt_atualizacao)
	and	ie_evento_alteracao_param_w = 'S';

c_processo_aprov CURSOR FOR
	SELECT	distinct
		nr_sequencia,
		nr_seq_proc_aprov
	from	processo_aprov_compra
	where	((cd_pessoa_fisica = cd_pessoa_usuario_w) or (cd_cargo = cd_cargo_w))
	and	ie_aprov_reprov		= 'P'
	and	(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
	and	ie_evento_aprovacao_w	= 'S'
	
union all

	SELECT	distinct
		nr_sequencia,
		nr_seq_proc_aprov
	from	processo_aprov_compra
	where	cd_cargo in
		(select	x.cd_cargo
		from	pessoa_fisica x,
			pessoa_fisica_Delegacao y
		where	x.cd_pessoa_fisica		= y.cd_pessoa_fisica
        	and	(x.cd_cargo IS NOT NULL AND x.cd_cargo::text <> '')
		and	((coalesce(trunc(y.dt_inicio_limite),trunc(clock_timestamp())) <= trunc(clock_timestamp())) and (trunc(y.dt_limite) >= trunc(clock_timestamp())))
		and	y.cd_pessoa_substituta	= cd_pessoa_usuario_w
		and	coalesce(y.ie_objetivo,'AC')	in ('AC','AA'))
	and	ie_aprov_reprov		= 'P'
	and	(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
	and	ie_evento_aprovacao_w	= 'S'
	order by 1;

c_solic_compra CURSOR FOR
	SELECT 'O' ie_tipo_aprov,
		o.nr_ordem_compra nr_sequencia,
	       o.nr_item_oci nr_seq_item,
	       o.vl_unitario_material vl_material,
	       o.qt_material,
	       o.dt_aprovacao,
	       m.ds_material,
	       substr(obter_nome_pessoa_fisica(coalesce(o.cd_pessoa_solicitante,p.cd_pessoa_solicitante), null),1,200) nm_solicitante,
	       s.dt_liberacao dt_liberacao_solic,
		null,
		null
	FROM ordem_compra p, material m, ordem_compra_item o
LEFT OUTER JOIN solic_compra s ON (o.nr_solic_compra = s.nr_solic_compra)
WHERE m.cd_material      = o.cd_material and o.nr_ordem_compra  = p.nr_ordem_compra and o.nr_seq_aprovacao = nr_seq_aprovacao_w
union

	SELECT 'S' ie_tipo_aprov,
		o.nr_solic_compra nr_sequencia,
	       o.nr_item_solic_compra nr_seq_item,
	       coalesce(o.vl_unit_previsto,0) vl_material,
	       o.qt_material,
	       o.dt_autorizacao dt_aprovacao,
	       m.ds_material,
	       substr(obter_nome_pessoa_fisica(p.cd_pessoa_solicitante, null),1,200) nm_solicitante,
	       p.dt_liberacao dt_liberacao_solic,
		o.ds_material_direto,
		o.ds_observacao
	from   solic_compra_item o,
	       solic_compra p,
	       material m
	where  m.cd_material = o.cd_material
	  and  o.nr_solic_compra = p.nr_solic_compra
	  and  o.nr_seq_aprovacao = nr_seq_aprovacao_w
	
union

	select 'R' ie_tipo_aprov,
		o.nr_requisicao nr_sequencia,
	       o.nr_sequencia nr_seq_item,
	       0 vl_material,
	       o.qt_material_requisitada,
	       o.dt_aprovacao,
	       m.ds_material,
	       substr(obter_nome_pessoa_fisica(p.cd_pessoa_requisitante, null),1,200) nm_solicitante,
	       p.dt_liberacao dt_liberacao_solic,
	       null ds_material_direto,
	        o.ds_observacao
	from   item_requisicao_material o,
	       requisicao_material p,
	       material m
	where  m.cd_material = o.cd_material
	  and  o.nr_requisicao = p.nr_requisicao
	  and  o.nr_seq_aprovacao = nr_seq_aprovacao_w


	order by 2;

c26 CURSOR FOR
	SELECT 	26 ie_tipo_evento,
			Wheb_mensagem_pck.get_Texto(299255) ds_tipo_evento, /*'Evento registrado no PEP e liberado'*/
			to_char(a.nr_sequencia) cd_evento,
			replace(substr( Wheb_mensagem_pck.get_Texto(299256) || to_char(a.nr_atendimento) ||
			Wheb_mensagem_pck.get_Texto(299171) || OBTER_PESSOA_ATENDIMENTO(a.nr_atendimento, 'N') ||
			Wheb_mensagem_pck.get_Texto(299259) || ds_evento,1,350), chr(10), '') ds_evento,
			'' nm_medico,
			a.dt_evento
	from	qua_evento_paciente a
	where	a.ie_situacao = 'A'
	  and	ie_evento_paciente_w = 'S'
	  and	coalesce(ie_tipo_evento,'E') = 'E'
	  and   (dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
	  and 	dt_atualizacao > (clock_timestamp() - interval '15 days')
	  and   not exists (SELECT 1
			    from	evento_paciente_ciente
			    where	nr_seq_evento = a.nr_sequencia
			      and	nm_usuario = nm_usuario_p)
	order by 2;

c27 CURSOR FOR
	SELECT	27 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299260) ds_tipo_evento, /*Entrada de paciente estrangeiro*/
		to_char(a.nr_atendimento) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299261,
			'NM_PESSOA_FISICA_W='|| SUBSTR(OBTER_NOME_PF(b.CD_PESSOA_FISICA),0,80) ||
			';DS_NACIONALIDADE_W='|| c.ds_nacionalidade ||
			';DS_SETOR_W='|| obter_nome_setor(obter_setor_atendimento(a.nr_atendimento))),
		'' nm_medico,
		a.dt_atualizacao dt_evento
	from	nacionalidade c,
		pessoa_fisica b,
		atendimento_paciente a
	where	b.cd_pessoa_fisica 	= 	a.cd_pessoa_fisica
	and	c.cd_nacionalidade	=	b.cd_nacionalidade
	and	a.dt_alta_interno > clock_timestamp()
	and	coalesce(a.dt_alta::text, '') = ''
	and	coalesce(a.dt_fim_conta::text, '') = ''
	and	a.ie_fim_conta = 'A'
	and	ie_evento_estrangeiro_w =	'S'
	and	a.dt_entrada	>	(clock_timestamp() - interval '1 days')
	and	coalesce(c.ie_brasileiro,'N') =	'N'
	and	a.ie_fim_conta 		<>	'F'
	and 	not exists (SELECT	1
				from	evento_estrangeiro x
				where	x.nr_atendimento	= a.nr_atendimento
				and	x.nm_usuario		= nm_usuario_p)
	order by 2;

c28 CURSOR FOR
	SELECT	28 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299262) ds_tipo_evento, /*Alta de paciente particular*/
		to_char(a.nr_atendimento) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299263,
			'NM_PESSOA_FISICA_W='|| SUBSTR(OBTER_NOME_PF(b.CD_PESSOA_FISICA),0,80) ||
			';DS_UNIDADE_W='|| obter_Unidade_Atendimento(a.nr_atendimento,'A','U') ||
			';DS_SETOR_W='|| obter_nome_setor(obter_setor_atendimento(a.nr_atendimento)) ||
			';NR_ATENDIMENTO_W='|| a.nr_atendimento) ds_evento,
		obter_nome_pf(a.cd_medico_resp) nm_medico,
		a.dt_atualizacao dt_evento
	from	atendimento_paciente a,
		pessoa_fisica b,
		atend_categoria_convenio c,
		convenio d
	where	b.cd_pessoa_fisica 	= 	a.cd_pessoa_fisica
	and	c.nr_atendimento	= 	a.nr_atendimento
	and	d.cd_convenio		=	c.cd_convenio
	and	d.ie_tipo_convenio	=	1
	and	a.ie_tipo_atendimento	=	1
	and (a.dt_alta + 3)		>=	clock_timestamp()
	and	not exists (
				SELECT 1
				from 	atend_alta_ciente x
				where	x.nr_atendimento	=	a.nr_atendimento
				and	x.nm_usuario		=	nm_usuario_p
				)
	order by 2;

c29 CURSOR FOR
	SELECT	29 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299265) ds_tipo_evento, /*'Inclusão de novo médico'*/
		to_char(a.cd_pessoa_fisica) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299267,
			'CD_PESSOA_FISICA_W='|| to_char(a.cd_pessoa_fisica) ||
			';NM_PESSOA_FISICA_W='|| substr(OBTER_NOME_PF(a.CD_PESSOA_FISICA),1,80) ||
			';NR_CRM_W='|| b.nr_crm ||
			';NM_GUERRA_W='|| b.nm_guerra ||
			';DS_ESPECIALIDADE_W='|| coalesce(substr(obter_especialidade_medico(a.cd_pessoa_fisica,'D'),1,40),wheb_mensagem_pck.get_texto(793287))) ds_evento,
		substr(OBTER_NOME_PF(a.CD_PESSOA_FISICA),1,80) nm_medico,
		a.dt_atualizacao dt_evento
	from	pessoa_fisica a,
		medico b
	where	a.cd_pessoa_fisica = b.cd_pessoa_fisica
	and	b.ie_situacao = 'A'
	and	a.dt_atualizacao_nrec > (clock_timestamp() - interval '1 days')
	and	coalesce(ie_evento_alerta_medico_w,'N') = 'S'
	and	a.cd_pessoa_fisica not in (
					SELECT	cd_pessoa_fisica
					from	medico_ciente x
					where	x.nm_usuario = nm_usuario_p
					and	x.cd_pessoa_fisica = a.cd_pessoa_fisica)
	order by	nm_medico;

c30 CURSOR FOR
	SELECT	30 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299268) ds_tipo_evento, /*'Previsão de alta informada' */
		to_char(a.nr_atendimento) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299269,
			'NM_PESSOA_FISICA_W='|| SUBSTR(OBTER_NOME_PF(b.CD_PESSOA_FISICA),0,80) ||
			';DT_PREVISTO_ALTA_W='|| a.dt_previsto_alta ||
			';DS_SETOR_W='|| obter_nome_setor(obter_setor_atendimento(a.nr_atendimento)) ||
			';DS_UNIDADE_W='||  obter_Unidade_Atendimento(a.nr_atendimento,'A','U')) ds_evento,
		obter_nome_pf(a.cd_medico_resp) nm_medico,
		a.dt_atualizacao dt_evento
	from	pessoa_fisica b,
		atendimento_paciente a
	where	b.cd_pessoa_fisica 	= a.cd_pessoa_fisica
	and	(a.dt_previsto_alta IS NOT NULL AND a.dt_previsto_alta::text <> '')
	and	a.dt_alta_interno > clock_timestamp()
	and	coalesce(a.dt_alta::text, '') = ''
	and	coalesce(a.dt_fim_conta::text, '') = ''
	and	a.ie_fim_conta = 'A'
	and	a.dt_atualizacao 	>	(clock_timestamp() - interval '1 days')
	and	not exists (
				SELECT 	1
				from 	atend_prev_alta_ciente 	x
				where	x.nr_atendimento	=	a.nr_atendimento
				and	x.nm_usuario		=	nm_usuario_p
				)
	order by 2;

c31 CURSOR FOR
	SELECT	31 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299270) ds_tipo_evento, /*'Alta de paciente particular'*/
		to_char(a.nr_atendimento) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299271,
			'NM_PESSOA_FISICA_W='|| SUBSTR(OBTER_NOME_PF(b.CD_PESSOA_FISICA),0,80) ||
			';DS_UNIDADE_W='|| obter_Unidade_Atendimento(a.nr_atendimento,'A','U')  ||
			';DS_SETOR_W='|| obter_nome_setor(obter_setor_atendimento(a.nr_atendimento))  ||
			';DS_ATEND_W='|| a.nr_atendimento) ds_evento,
		obter_nome_pf(a.cd_medico_resp) nm_medico,
		a.dt_atualizacao dt_evento
	from	atendimento_paciente a,
		pessoa_fisica b,
		atend_categoria_convenio c,
		convenio d
	where	b.cd_pessoa_fisica 	= 	a.cd_pessoa_fisica
	and	c.nr_atendimento	= 	a.nr_atendimento
	and	d.cd_convenio		=	c.cd_convenio
	and	d.ie_tipo_convenio	=	1
	and	a.ie_tipo_atendimento	=	7
	and (a.dt_alta + 3)		>=	clock_timestamp()
	and	not exists (
				SELECT 1
				from 	atend_alta_ciente x
				where	x.nr_atendimento	=	a.nr_atendimento
				and	x.nm_usuario		=	nm_usuario_p
				)
	order by 2;

c32 CURSOR FOR
	SELECT	32 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299272)  ds_tipo_evento, /*'Alta de paciente regra'*/
		to_char(a.nr_atendimento) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299273,
			'CD_MATERIAL_W='|| obter_Unidade_Atendimento(a.nr_atendimento,'A','U') ||
			';NM_PESSOA_FISICA_W='|| SUBSTR(OBTER_NOME_PF(b.CD_PESSOA_FISICA),0,80) ||
			';NR_ATENDIMENTO_W='|| a.nr_atendimento ||
			';DS_SETOR_W='|| obter_nome_setor(obter_setor_atendimento(a.nr_atendimento))||
			';DT_ALTA_W='|| to_char(dt_alta, 'dd/mm/yyyy hh24:mi:ss')) ds_evento,
		obter_nome_pf(a.cd_medico_resp) nm_medico,
		a.dt_alta dt_evento
	from	atendimento_paciente a,
		pessoa_fisica b,
		atend_categoria_convenio c
	where	b.cd_pessoa_fisica 	= 	a.cd_pessoa_fisica
	and	c.nr_atendimento	= 	a.nr_atendimento
	and (a.dt_alta + 3)		>=	clock_timestamp()
	and	exists ( 	SELECT 	1
				from  	regra_envio_mensagem_alta e
				where 	a.ie_tipo_atendimento		= e.ie_tipo_atendimento
				and	coalesce(e.cd_convenio, c.cd_convenio) = c.cd_convenio
				and	((coalesce(e.nr_minutos,0) = 0) or
					 (clock_timestamp() <= (a.dt_alta + (coalesce(e.nr_minutos,0)/ 1440))))
				)
	and	not exists (
				select 1
				from 	atend_alta_ciente x
				where	x.nr_atendimento	=	a.nr_atendimento
				and	x.nm_usuario		=	nm_usuario_p
				)
	order by 2;

c33 CURSOR FOR
	SELECT	12 ie_tipo_evento,
			Wheb_mensagem_pck.get_Texto(299276) ds_tipo_evento, /*Novo histórico na OS*/
			to_char(a.nr_sequencia) cd_evento,
			WHEB_MENSAGEM_PCK.get_texto(299277,
				'NR_SEQUENCIA_W='|| a.nr_sequencia ||
				';DS_LOCALIZACAO_W='|| substr(obter_descricao_padrao('MAN_LOCALIZACAO','DS_LOCALIZACAO',a.nr_seq_localizacao),1,80) ||
				';NM_SOLICITANTE_W='|| substr(obter_nome_pessoa_fisica(a.cd_pessoa_solicitante, null),1,60) ||
				';DS_DANO_BREVE_W='|| a.ds_dano_breve) ds_evento,
			'' nm_medico,
			c.dt_historico dt_evento
	FROM man_ordem_serv_tecnico c, man_ordem_servico a
LEFT OUTER JOIN man_ordem_servico_exec b ON (a.nr_sequencia = b.nr_seq_ordem)
WHERE a.nr_sequencia = c.nr_seq_ordem_serv and ((b.nm_usuario_exec = nm_usuario_p) or (obter_se_usuario_grupo_trab(a.nr_grupo_trabalho,nm_usuario_p) = 'S' and ie_grupo_ordem_serv_w = 'S')) and c.dt_historico > clock_timestamp() - interval '43200 seconds' and coalesce(b.dt_ult_visao,to_date('01/01/1910','dd/mm/yyyy')) < c.dt_historico and (((coalesce(b.nr_sequencia::text, '') = '' and ie_grupo_ordem_serv_w = 'S') or (b.nm_usuario_exec = nm_usuario_p))  or ie_grupo_ordem_serv_w = 'N') and ie_evento_ordem_serv_w = 'S' and coalesce(c.nm_usuario_lib,c.nm_usuario) <> nm_usuario_p and coalesce(a.dt_fim_real::text, '') = ''
	
union all

	SELECT	12 ie_tipo_evento,
			Wheb_mensagem_pck.get_Texto(299278) ds_tipo_evento, /*Nova Ordem de serviço*/
			to_char(a.nr_sequencia) cd_evento,
			substr(WHEB_MENSAGEM_PCK.get_texto(299279,
				'NR_SEQUENCIA_W='|| a.nr_sequencia ||
				';DS_LOCALIZACAO_W='|| substr(obter_descricao_padrao('MAN_LOCALIZACAO','DS_LOCALIZACAO',a.nr_seq_localizacao),1,80) ||
				';NM_SOLICITANTE_W='|| substr(obter_nome_pessoa_fisica(a.cd_pessoa_solicitante, null),1,60) ||
				';DS_DANO_BREVE_W='|| a.ds_dano_breve ||
				';DS_PRIORIDADE_W='|| substr(obter_valor_dominio(1046, a.ie_prioridade),1,50) ||
				';DS_EQUIPAMENTO_W='|| obter_desc_man_equipamento(a.nr_seq_equipamento,'N')||
				';DT_CONCLUSAO_DESEJADA_W='|| to_char(a.dt_conclusao_desejada, 'dd/mm/yyyy')),1,255)  ds_evento,
			'' nm_medico,
			a.dt_ordem_servico dt_evento
	FROM man_ordem_servico a
LEFT OUTER JOIN man_ordem_servico_exec b ON (a.nr_sequencia = b.nr_seq_ordem)
WHERE ((b.nm_usuario_exec = nm_usuario_p) or (obter_se_usuario_grupo_trab(a.nr_grupo_trabalho,nm_usuario_p) = 'S' and ie_grupo_ordem_serv_w = 'S')) and a.dt_ordem_servico > clock_timestamp() - interval '43200 seconds' and coalesce(b.dt_ult_visao::text, '') = '' and (((coalesce(b.nr_sequencia::text, '') = '' and ie_grupo_ordem_serv_w = 'S') or (b.nm_usuario_exec = nm_usuario_p))  or ie_grupo_ordem_serv_w = 'N') and ie_evento_ordem_serv_w = 'S' and coalesce(a.nm_usuario_nrec,a.nm_usuario) <> nm_usuario_p and coalesce(a.dt_fim_real::text, '') = '' and not exists (select	1
				from	man_ordem_serv_ciente x
				where	x.nr_seq_ordem		= a.nr_sequencia
				and	x.nm_usuario		= nm_usuario_p)
	 
union all

	select	12 ie_tipo_evento,
			Wheb_mensagem_pck.get_Texto(299278) ds_tipo_evento, /*Nova Ordem de serviço*/
			to_char(a.nr_sequencia) cd_evento,
			substr(WHEB_MENSAGEM_PCK.get_texto(299281,
				'NR_SEQUENCIA_W='|| a.nr_sequencia  ||
				';DS_LOCALIZACAO_W='|| substr(obter_descricao_padrao('MAN_LOCALIZACAO','DS_LOCALIZACAO',a.nr_seq_localizacao),1,80) ||
				';NM_SOLICITANTE_W='|| substr(obter_nome_pessoa_fisica(a.cd_pessoa_solicitante, null),1,60)  ||
				';DS_DANO_BREVE_W='|| a.ds_dano_breve  ||
				';DS_PRIORIDADE_W='|| substr(obter_valor_dominio(1046, a.ie_prioridade),1,50) ||
				';DS_EQUIPAMENTO_W='|| obter_desc_man_equipamento(a.nr_seq_equipamento,'N') ||
				';DT_CONCLUSAO_W='|| to_char(a.dt_conclusao_desejada, 'dd/mm/yyyy')),1,255)  ds_evento,
			'' nm_medico,
			a.dt_reabertura dt_evento
	FROM man_ordem_servico a
LEFT OUTER JOIN man_ordem_servico_exec b ON (a.nr_sequencia = b.nr_seq_ordem)
WHERE ((b.nm_usuario_exec = nm_usuario_p) or (obter_se_usuario_grupo_trab(a.nr_grupo_trabalho,nm_usuario_p) = 'S' and ie_grupo_ordem_serv_w = 'S')) and a.dt_reabertura > clock_timestamp() - interval '43200 seconds' and coalesce(b.dt_ult_visao::text, '') = '' and (((coalesce(b.nr_sequencia::text, '') = '' and ie_grupo_ordem_serv_w = 'S') or (b.nm_usuario_exec = nm_usuario_p))  or ie_grupo_ordem_serv_w = 'N') and ie_evento_ordem_serv_w = 'S' and coalesce(a.dt_fim_real::text, '') = '' and not exists (select	1
				from	man_ordem_serv_ciente x
				where	x.nr_seq_ordem		= a.nr_sequencia
				and	x.nm_usuario		= nm_usuario_p);

c34 CURSOR FOR
	SELECT	12 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299278) ds_tipo_evento, /*Nova Ordem de serviço*/
		to_char(a.nr_sequencia) cd_evento,
		substr(WHEB_MENSAGEM_PCK.get_texto(299281,
			'NR_SEQUENCIA_W='|| a.nr_sequencia  ||
			';DS_LOCALIZACAO_W='|| substr(obter_descricao_padrao('MAN_LOCALIZACAO','DS_LOCALIZACAO',a.nr_seq_localizacao),1,80) ||
			';NM_SOLICITANTE_W='|| substr(obter_nome_pessoa_fisica(a.cd_pessoa_solicitante, null),1,60)  ||
			';DS_DANO_BREVE_W='|| a.ds_dano_breve  ||
			';DS_PRIORIDADE_W='|| substr(obter_valor_dominio(1046, a.ie_prioridade),1,50) ||
			';DS_EQUIPAMENTO_W='|| obter_desc_man_equipamento(a.nr_seq_equipamento,'N') ||
			';DT_CONCLUSAO_W='|| to_char(a.dt_conclusao_desejada, 'dd/mm/yyyy')),1,255)  ds_evento,
		'' nm_medico,
		a.dt_ordem_servico dt_evento
	FROM man_ordem_servico a
LEFT OUTER JOIN man_ordem_servico_exec b ON (a.nr_sequencia = b.nr_seq_ordem)
WHERE ((b.nm_usuario_exec = nm_usuario_p) or (obter_se_usuario_grupo_trab(a.nr_grupo_trabalho,nm_usuario_p) = 'S' and ie_grupo_ordem_serv_w = 'S')) and a.dt_ordem_servico > clock_timestamp() - interval '43200 seconds' and coalesce(b.dt_ult_visao::text, '') = '' and (((coalesce(b.nr_sequencia::text, '') = '' and ie_grupo_ordem_serv_w = 'S') or (b.nm_usuario_exec = nm_usuario_p))  or ie_grupo_ordem_serv_w = 'N') and ie_evento_ordem_serv_w = 'O' and coalesce(a.dt_fim_real::text, '') = '' and not exists (SELECT	1
				from	man_ordem_serv_ciente x
				where	x.nr_seq_ordem		= a.nr_sequencia
				and	x.nm_usuario		= nm_usuario_p)
	
union all

	select	12 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299278) ds_tipo_evento, /*Nova Ordem de serviço*/
		to_char(a.nr_sequencia) cd_evento,
		substr(WHEB_MENSAGEM_PCK.get_texto(299281,
			'NR_SEQUENCIA_W='|| a.nr_sequencia  ||
			';DS_LOCALIZACAO_W='|| substr(obter_descricao_padrao('MAN_LOCALIZACAO','DS_LOCALIZACAO',a.nr_seq_localizacao),1,50) ||
			';NM_SOLICITANTE_W='|| substr(obter_nome_pessoa_fisica(a.cd_pessoa_solicitante, null),1,60)  ||
			';DS_DANO_BREVE_W='|| a.ds_dano_breve  ||
			';DS_PRIORIDADE_W='|| substr(obter_valor_dominio(1046, a.ie_prioridade),1,50) ||
			';DS_EQUIPAMENTO_W='|| obter_desc_man_equipamento(a.nr_seq_equipamento,'N') ||
			';DT_CONCLUSAO_W='|| to_char(a.dt_conclusao_desejada, 'dd/mm/yyyy')),1,255)  ds_evento,
		'' nm_medico,
		a.dt_reabertura dt_evento
	FROM man_ordem_servico a
LEFT OUTER JOIN man_ordem_servico_exec b ON (a.nr_sequencia = b.nr_seq_ordem)
WHERE ((b.nm_usuario_exec = nm_usuario_p) or (obter_se_usuario_grupo_trab(a.nr_grupo_trabalho,nm_usuario_p) = 'S' and ie_grupo_ordem_serv_w = 'S')) and a.dt_reabertura > clock_timestamp() - interval '43200 seconds' and coalesce(b.dt_ult_visao::text, '') = '' and (((coalesce(b.nr_sequencia::text, '') = '' and ie_grupo_ordem_serv_w = 'S') or (b.nm_usuario_exec = nm_usuario_p))  or ie_grupo_ordem_serv_w = 'N') and ie_evento_ordem_serv_w = 'O' and coalesce(a.dt_fim_real::text, '') = '' and not exists (select	1
				from	man_ordem_serv_ciente x
				where	x.nr_seq_ordem		= a.nr_sequencia
				and	x.nm_usuario		= nm_usuario_p);

c35 CURSOR FOR
	SELECT	12 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299278) ds_tipo_evento, /*Nova Ordem de serviço*/
		to_char(a.nr_sequencia) cd_evento,
		substr(WHEB_MENSAGEM_PCK.get_texto(299281,
			'NR_SEQUENCIA_W='|| a.nr_sequencia  ||
			';DS_LOCALIZACAO_W='|| substr(obter_descricao_padrao('MAN_LOCALIZACAO','DS_LOCALIZACAO',a.nr_seq_localizacao),1,80) ||
			';NM_SOLICITANTE_W='|| substr(obter_nome_pessoa_fisica(a.cd_pessoa_solicitante, null),1,60)  ||
			';DS_DANO_BREVE_W='|| a.ds_dano_breve  ||
			';DS_PRIORIDADE_W='|| substr(obter_valor_dominio(1046, a.ie_prioridade),1,50) ||
			';DS_EQUIPAMENTO_W='|| obter_desc_man_equipamento(a.nr_seq_equipamento,'N') ||
			';DT_CONCLUSAO_W='|| to_char(a.dt_conclusao_desejada, 'dd/mm/yyyy')),1,255)  ds_evento,
		'' nm_medico,
		a.dt_ordem_servico dt_evento
	FROM man_ordem_servico a
LEFT OUTER JOIN man_ordem_servico_exec b ON (a.nr_sequencia = b.nr_seq_ordem)
WHERE ((b.nm_usuario_exec = nm_usuario_p) or (obter_se_usuario_grupo_planej(a.nr_grupo_planej,nm_usuario_p) = 'S')) and a.dt_ordem_servico > clock_timestamp() - interval '43200 seconds' and coalesce(b.dt_ult_visao::text, '') = '' and ie_evento_ordem_serv_w = 'P' and coalesce(a.dt_fim_real::text, '') = '' and not exists (SELECT	1
				from	man_ordem_serv_ciente x
				where	x.nr_seq_ordem		= a.nr_sequencia
				and	x.nm_usuario		= nm_usuario_p)
	
union all

	select	12 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299278) ds_tipo_evento, /*Nova Ordem de serviço*/
		to_char(a.nr_sequencia) cd_evento,
		substr(WHEB_MENSAGEM_PCK.get_texto(299281,
			'NR_SEQUENCIA_W='|| a.nr_sequencia  ||
			';DS_LOCALIZACAO_W='|| substr(obter_descricao_padrao('MAN_LOCALIZACAO','DS_LOCALIZACAO',a.nr_seq_localizacao),1,80) ||
			';NM_SOLICITANTE_W='|| substr(obter_nome_pessoa_fisica(a.cd_pessoa_solicitante, null),1,60)  ||
			';DS_DANO_BREVE_W='|| a.ds_dano_breve  ||
			';DS_PRIORIDADE_W='|| substr(obter_valor_dominio(1046, a.ie_prioridade),1,50) ||
			';DS_EQUIPAMENTO_W='|| obter_desc_man_equipamento(a.nr_seq_equipamento,'N') ||
			';DT_CONCLUSAO_W='|| to_char(a.dt_conclusao_desejada, 'dd/mm/yyyy')),1,255)  ds_evento,
		'' nm_medico,
		a.dt_reabertura dt_evento
	FROM man_ordem_servico a
LEFT OUTER JOIN man_ordem_servico_exec b ON (a.nr_sequencia = b.nr_seq_ordem)
WHERE ((b.nm_usuario_exec = nm_usuario_p) or (obter_se_usuario_grupo_planej(a.nr_grupo_planej,nm_usuario_p) = 'S')) and a.dt_reabertura > clock_timestamp() - interval '43200 seconds' and coalesce(b.dt_ult_visao::text, '') = '' and ie_evento_ordem_serv_w = 'P' and coalesce(a.dt_fim_real::text, '') = '' and not exists (select	1
				from	man_ordem_serv_ciente x
				where	x.nr_seq_ordem		= a.nr_sequencia
				and	x.nm_usuario		= nm_usuario_p);

c36 CURSOR FOR
	SELECT	12 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299278) ds_tipo_evento, /*Nova Ordem de serviço*/
		to_char(a.nr_sequencia) cd_evento,
		substr(WHEB_MENSAGEM_PCK.get_texto(299281,
			'NR_SEQUENCIA_W='|| a.nr_sequencia  ||
			';DS_LOCALIZACAO_W='|| substr(obter_descricao_padrao('MAN_LOCALIZACAO','DS_LOCALIZACAO',a.nr_seq_localizacao),1,80) ||
			';NM_SOLICITANTE_W='|| substr(obter_nome_pessoa_fisica(a.cd_pessoa_solicitante, null),1,60)  ||
			';DS_DANO_BREVE_W='|| a.ds_dano_breve  ||
			';DS_PRIORIDADE_W='|| substr(obter_valor_dominio(1046, a.ie_prioridade),1,50) ||
			';DS_EQUIPAMENTO_W='|| obter_desc_man_equipamento(a.nr_seq_equipamento,'N') ||
			';DT_CONCLUSAO_W='|| to_char(a.dt_conclusao_desejada, 'dd/mm/yyyy')),1,255)  ds_evento,
			'' nm_medico,
			a.dt_ordem_servico dt_evento
	FROM man_ordem_servico a
LEFT OUTER JOIN man_ordem_servico_exec b ON (a.nr_sequencia = b.nr_seq_ordem)
WHERE coalesce(b.nm_usuario_exec::text, '') = '' and obter_se_usuario_grupo_planej(a.nr_grupo_planej,nm_usuario_p) = 'S' and a.dt_ordem_servico > clock_timestamp() - interval '43200 seconds' and coalesce(b.dt_ult_visao::text, '') = '' and ie_evento_ordem_serv_w = 'X' and coalesce(a.dt_fim_real::text, '') = '' and not exists (SELECT	1
				from	man_ordem_serv_ciente x
				where	x.nr_seq_ordem		= a.nr_sequencia
				and	x.nm_usuario		= nm_usuario_p)
	
union all

	select	12 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299278) ds_tipo_evento, /*Nova Ordem de serviço*/
		to_char(a.nr_sequencia) cd_evento,
		substr(WHEB_MENSAGEM_PCK.get_texto(299281,
			'NR_SEQUENCIA_W='|| a.nr_sequencia  ||
			';DS_LOCALIZACAO_W='|| substr(obter_descricao_padrao('MAN_LOCALIZACAO','DS_LOCALIZACAO',a.nr_seq_localizacao),1,80) ||
			';NM_SOLICITANTE_W='|| substr(obter_nome_pessoa_fisica(a.cd_pessoa_solicitante, null),1,60)  ||
			';DS_DANO_BREVE_W='|| a.ds_dano_breve  ||
			';DS_PRIORIDADE_W='|| substr(obter_valor_dominio(1046, a.ie_prioridade),1,50) ||
			';DS_EQUIPAMENTO_W='|| obter_desc_man_equipamento(a.nr_seq_equipamento,'N') ||
			';DT_CONCLUSAO_W='|| to_char(a.dt_conclusao_desejada, 'dd/mm/yyyy')),1,255)  ds_evento,
		'' nm_medico,
		a.dt_reabertura dt_evento
	FROM man_ordem_servico a
LEFT OUTER JOIN man_ordem_servico_exec b ON (a.nr_sequencia = b.nr_seq_ordem)
WHERE coalesce(b.nm_usuario_exec::text, '') = '' and obter_se_usuario_grupo_planej(a.nr_grupo_planej,nm_usuario_p) = 'S' and a.dt_reabertura > clock_timestamp() - interval '43200 seconds' and coalesce(b.dt_ult_visao::text, '') = '' and ie_evento_ordem_serv_w = 'X' and coalesce(a.dt_fim_real::text, '') = '' and not exists (select	1
				from	man_ordem_serv_ciente x
				where	x.nr_seq_ordem		= a.nr_sequencia
				and	x.nm_usuario		= nm_usuario_p);

/* Alertar novo histórico Interno onde sou solicitante*/

c37 CURSOR FOR
	SELECT	12 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299286) ds_tipo_evento, /*'Novo histórico na OS'*/
		to_char(a.nr_sequencia) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299287,
			'NR_SEQUENCIA_W='|| a.nr_sequencia ||
			';DS_LOCALIZACAO_W='|| substr(obter_descricao_padrao('MAN_LOCALIZACAO','DS_LOCALIZACAO',a.nr_seq_localizacao),1,80) ||
			';DS_SOLICITANTE_W='|| substr(obter_nome_pessoa_fisica(a.cd_pessoa_solicitante, null),1,60) ||
			';DS_DANO_BREVE_W='|| a.ds_dano_breve) ds_evento,
			'' nm_medico,
			c.dt_historico dt_evento
	FROM man_ordem_serv_tecnico c, man_ordem_servico a
LEFT OUTER JOIN man_ordem_servico_exec b ON (a.nr_sequencia = b.nr_seq_ordem)
WHERE a.nr_sequencia = c.nr_seq_ordem_serv and c.dt_historico > clock_timestamp() - interval '43200 seconds' and coalesce(b.dt_ult_visao,to_date('01/01/1910','dd/mm/yyyy')) < c.dt_historico and ie_evento_ordem_serv_w = 'H' and c.ie_origem = 'I' and substr(obter_usuario_pessoa(a.cd_pessoa_solicitante),1,100) = nm_usuario_p and coalesce(c.nm_usuario_lib,c.nm_usuario) <> nm_usuario_p and coalesce(a.dt_fim_real::text, '') = '';

/* Alertar novo histórico Externo onde sou solicitante*/

c38 CURSOR FOR
	SELECT	12 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299286) ds_tipo_evento, /*'Novo histórico na OS'*/
		to_char(a.nr_sequencia) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299287,
			'NR_SEQUENCIA_W='|| a.nr_sequencia ||
			';DS_LOCALIZACAO_W='|| substr(obter_descricao_padrao('MAN_LOCALIZACAO','DS_LOCALIZACAO',a.nr_seq_localizacao),1,80) ||
			';DS_SOLICITANTE_W='|| substr(obter_nome_pessoa_fisica(a.cd_pessoa_solicitante, null),1,60) ||
			';DS_DANO_BREVE_W='|| a.ds_dano_breve) ds_evento,
		'' nm_medico,
		c.dt_historico dt_evento
	FROM man_ordem_serv_tecnico c, man_ordem_servico a
LEFT OUTER JOIN man_ordem_servico_exec b ON (a.nr_sequencia = b.nr_seq_ordem)
WHERE a.nr_sequencia = c.nr_seq_ordem_serv and c.dt_historico > clock_timestamp() - interval '43200 seconds' and coalesce(b.dt_ult_visao,to_date('01/01/1910','dd/mm/yyyy')) < c.dt_historico and ie_evento_ordem_serv_w = 'E' and c.ie_origem = 'E' and substr(obter_usuario_pessoa(a.cd_pessoa_solicitante),1,100) = nm_usuario_p and coalesce(c.nm_usuario_lib,c.nm_usuario) <> nm_usuario_p and coalesce(a.dt_fim_real::text, '') = '';

c39 CURSOR FOR
	SELECT	12 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299278) ds_tipo_evento, /*Nova Ordem de serviço*/
		to_char(a.nr_sequencia) cd_evento,
		substr(WHEB_MENSAGEM_PCK.get_texto(299281,
			'NR_SEQUENCIA_W='|| a.nr_sequencia  ||
			';DS_LOCALIZACAO_W='|| substr(obter_descricao_padrao('MAN_LOCALIZACAO','DS_LOCALIZACAO',a.nr_seq_localizacao),1,80) ||
			';NM_SOLICITANTE_W='|| substr(obter_nome_pessoa_fisica(a.cd_pessoa_solicitante, null),1,60)  ||
			';DS_DANO_BREVE_W='|| a.ds_dano_breve  ||
			';DS_PRIORIDADE_W='|| substr(obter_valor_dominio(1046, a.ie_prioridade),1,50) ||
			';DS_EQUIPAMENTO_W='|| obter_desc_man_equipamento(a.nr_seq_equipamento,'N') ||
			';DT_CONCLUSAO_W='|| to_char(a.dt_conclusao_desejada, 'dd/mm/yyyy')),1,255)  ds_evento,
		'' nm_medico,
		a.dt_ordem_servico dt_evento
	FROM man_ordem_servico a
LEFT OUTER JOIN man_ordem_servico_exec b ON (a.nr_sequencia = b.nr_seq_ordem)
WHERE ((b.nm_usuario_exec = nm_usuario_p) or (obter_se_usuario_grupo_trab(a.nr_grupo_trabalho,nm_usuario_p) = 'S')) and a.dt_ordem_servico > clock_timestamp() - interval '43200 seconds' and coalesce(b.dt_ult_visao::text, '') = '' and ie_evento_ordem_serv_w = 'G' and coalesce(a.dt_fim_real::text, '') = '' and not exists (SELECT	1
				from	man_ordem_serv_ciente x
				where	x.nr_seq_ordem		= a.nr_sequencia
				and	x.nm_usuario		= nm_usuario_p)
	
union all

	select	12 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299278) ds_tipo_evento, /*Nova Ordem de serviço*/
		to_char(a.nr_sequencia) cd_evento,
		substr(WHEB_MENSAGEM_PCK.get_texto(299281,
			'NR_SEQUENCIA_W='|| a.nr_sequencia  ||
			';DS_LOCALIZACAO_W='|| substr(obter_descricao_padrao('MAN_LOCALIZACAO','DS_LOCALIZACAO',a.nr_seq_localizacao),1,80) ||
			';NM_SOLICITANTE_W='|| substr(obter_nome_pessoa_fisica(a.cd_pessoa_solicitante, null),1,60)  ||
			';DS_DANO_BREVE_W='|| a.ds_dano_breve  ||
			';DS_PRIORIDADE_W='|| substr(obter_valor_dominio(1046, a.ie_prioridade),1,50) ||
			';DS_EQUIPAMENTO_W='|| obter_desc_man_equipamento(a.nr_seq_equipamento,'N') ||
			';DT_CONCLUSAO_W='|| to_char(a.dt_conclusao_desejada, 'dd/mm/yyyy')),1,255)  ds_evento,
		'' nm_medico,
		a.dt_reabertura dt_evento
	FROM man_ordem_servico a
LEFT OUTER JOIN man_ordem_servico_exec b ON (a.nr_sequencia = b.nr_seq_ordem)
WHERE ((b.nm_usuario_exec = nm_usuario_p) or (obter_se_usuario_grupo_trab(a.nr_grupo_trabalho,nm_usuario_p) = 'S')) and a.dt_reabertura > clock_timestamp() - interval '43200 seconds' and coalesce(b.dt_ult_visao::text, '') = '' and ie_evento_ordem_serv_w = 'G' and coalesce(a.dt_fim_real::text, '') = '' and not exists (select	1
				from	man_ordem_serv_ciente x
				where	x.nr_seq_ordem		= a.nr_sequencia
				and	x.nm_usuario		= nm_usuario_p);


c40 CURSOR FOR
	SELECT	12 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299278) ds_tipo_evento, /*Nova Ordem de serviço*/
		to_char(a.nr_sequencia) cd_evento,
		substr(WHEB_MENSAGEM_PCK.get_texto(299281,
			'NR_SEQUENCIA_W='|| a.nr_sequencia  ||
			';DS_LOCALIZACAO_W='|| substr(obter_descricao_padrao('MAN_LOCALIZACAO','DS_LOCALIZACAO',a.nr_seq_localizacao),1,80) ||
			';NM_SOLICITANTE_W='|| substr(obter_nome_pessoa_fisica(a.cd_pessoa_solicitante, null),1,60)  ||
			';DS_DANO_BREVE_W='|| a.ds_dano_breve  ||
			';DS_PRIORIDADE_W='|| substr(obter_valor_dominio(1046, a.ie_prioridade),1,50) ||
			';DS_EQUIPAMENTO_W='|| obter_desc_man_equipamento(a.nr_seq_equipamento,'N') ||
			';DT_CONCLUSAO_W='|| to_char(a.dt_conclusao_desejada, 'dd/mm/yyyy')),1,255)  ds_evento,
		'' nm_medico,
		a.dt_ordem_servico dt_evento
	FROM man_ordem_servico a
LEFT OUTER JOIN man_ordem_servico_exec b ON (a.nr_sequencia = b.nr_seq_ordem)
WHERE coalesce(b.nm_usuario_exec::text, '') = '' and obter_se_usuario_grupo_trab(a.nr_grupo_trabalho,nm_usuario_p) = 'S' and a.dt_ordem_servico > clock_timestamp() - interval '43200 seconds' and coalesce(b.dt_ult_visao::text, '') = '' and ie_evento_ordem_serv_w = 'R' and coalesce(a.dt_fim_real::text, '') = '' and not exists (SELECT	1
				from	man_ordem_serv_ciente x
				where	x.nr_seq_ordem		= a.nr_sequencia
				and	x.nm_usuario		= nm_usuario_p)
	
union all

	select	12 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299278) ds_tipo_evento, /*Nova Ordem de serviço*/
		to_char(a.nr_sequencia) cd_evento,
		substr(WHEB_MENSAGEM_PCK.get_texto(299281,
			'NR_SEQUENCIA_W='|| a.nr_sequencia  ||
			';DS_LOCALIZACAO_W='|| substr(obter_descricao_padrao('MAN_LOCALIZACAO','DS_LOCALIZACAO',a.nr_seq_localizacao),1,80) ||
			';NM_SOLICITANTE_W='|| substr(obter_nome_pessoa_fisica(a.cd_pessoa_solicitante, null),1,60)  ||
			';DS_DANO_BREVE_W='|| a.ds_dano_breve  ||
			';DS_PRIORIDADE_W='|| substr(obter_valor_dominio(1046, a.ie_prioridade),1,50) ||
			';DS_EQUIPAMENTO_W='|| obter_desc_man_equipamento(a.nr_seq_equipamento,'N') ||
			';DT_CONCLUSAO_W='|| to_char(a.dt_conclusao_desejada, 'dd/mm/yyyy')),1,255)  ds_evento,
		'' nm_medico,
		a.dt_reabertura dt_evento
	FROM man_ordem_servico a
LEFT OUTER JOIN man_ordem_servico_exec b ON (a.nr_sequencia = b.nr_seq_ordem)
WHERE coalesce(b.nm_usuario_exec::text, '') = '' and obter_se_usuario_grupo_trab(a.nr_grupo_trabalho,nm_usuario_p) = 'S' and a.dt_reabertura > clock_timestamp() - interval '43200 seconds' and coalesce(b.dt_ult_visao::text, '') = '' and ie_evento_ordem_serv_w = 'R' and coalesce(a.dt_fim_real::text, '') = '' and not exists (select	1
				from	man_ordem_serv_ciente x
				where	x.nr_seq_ordem		= a.nr_sequencia
				and	x.nm_usuario		= nm_usuario_p);
c41 CURSOR FOR
	SELECT	distinct
		33 ie_tipo_evento,
		CASE WHEN a.ie_tipo_os='ATR' THEN Wheb_mensagem_pck.get_Texto(299289) WHEN a.ie_tipo_os='SDP' THEN Wheb_mensagem_pck.get_Texto(299290) WHEN a.ie_tipo_os='SAP' THEN Wheb_mensagem_pck.get_Texto(299291) END  ds_tipo_evento,
		to_char(a.nr_sequencia) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299292,
			'DS_DANO_BREVE_W='|| substr(a.ds_dano_breve,1,150) ||
			';DS_LOCALIZACAO_W='|| substr(a.ds_localizacao,1,100) ||
			';QT_DIAS_W='|| trunc(clock_timestamp() - trunc(a.dt_ordem_servico))) ds_evento,
		'' nm_medico,
		a.dt_atualizacao dt_evento
	from	usuario_grupo_des b,
		man_ordem_serv_programar_v a
	where	a.nm_usuario_prev	= b.nm_usuario_grupo
	and	b.nr_seq_grupo		= nr_seq_grupo_des_w
	and	(nr_seq_grupo_des_w IS NOT NULL AND nr_seq_grupo_des_w::text <> '')
	and   	exists (SELECT	1
			from    man_ordem_servico_exec	x
			where	x.nr_seq_ordem	= a.nr_sequencia
			and	x.nm_usuario_exec = a.nm_usuario_prev
			and	coalesce(x.dt_fim_execucao::text, '') = '')
	and	not exists (select	1
				from	man_ordem_serv_ciente y
				where	y.nr_seq_ordem	= a.nr_sequencia
				and	y.nm_usuario	= nm_usuario_p
				and	y.dt_atualizacao > a.dt_atualizacao);
c42 CURSOR FOR
	SELECT	distinct 42 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299295) ds_tipo_evento, /*Dieta prescrita*/
		to_char(c.nr_prescricao) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299297,
			'DS_SETOR_W='|| substr(obter_ds_descricao_setor(obter_setor_atendimento(a.nr_atendimento)),1,255) ||
			';NR_ATENDIMENTO_W='|| to_char(a.nr_atendimento) ||
			';NM_PACIENTE_W='|| substr(obter_nome_pf(a.cd_pessoa_fisica),1,255)) ds_evento,
		'' nm_medico,
		a.dt_entrada dt_evento
	from	atendimento_paciente a,
		prescr_medica b,
		prescr_dieta c
	where	a.nr_atendimento = b.nr_atendimento
	and	b.nr_prescricao = c.nr_prescricao
	and	(c.cd_dieta IS NOT NULL AND c.cd_dieta::text <> '')
	and	((obter_se_contido_char(to_char(obter_setor_atendimento(a.nr_atendimento)),cd_setor_atendimento_w) = 'S') or (coalesce(cd_setor_atendimento_w,'X') = 'X'))
	--and	((to_char(obter_setor_atendimento(a.nr_atendimento)) = cd_setor_atendimento_w) or (nvl(cd_setor_atendimento_w,'X') = 'X'))   --116
	and	a.dt_entrada between clock_timestamp() - interval '15 days' and clock_timestamp()
	--and	a.nr_atend_alta is not null
	and 	not exists (SELECT	1
				from	dieta_prescrita_ciente x
				where	x.nr_prescricao		= c.nr_prescricao
				and	lower(x.nm_usuario)		= lower(nm_usuario_p));

c43 CURSOR FOR
	SELECT	distinct 43 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299298) ds_tipo_evento, /*'Requisição liberada'*/
		to_char(a.nr_sequencia) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299299,
			'NR_SEQUENCIA_W='|| a.nr_sequencia ||
			';DS_SETOR_W='|| substr(obter_ds_descricao_setor(a.cd_setor_atendimento),1,255) ||
			';NM_REQUISITANTE_W='|| substr(obter_nome_pf(a.cd_pessoa_requisitante),1,255)) ds_evento,
		'' nm_medico,
		a.dt_requisicao dt_evento
	from	cm_requisicao a
	where	a.dt_requisicao >= clock_timestamp() - interval '30 days'
	and	(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
	/*and	a.cd_pessoa_requisitante = (	select max(x.cd_pessoa_fisica)
						from	usuario x
						where	lower(x.nm_usuario) = lower(nm_usuario_p))*/
	and 	not exists (SELECT	1
				from	mon_ciente_evento x
				where	x.nr_seq_evento	= a.nr_sequencia
				and	x.ie_tipo_evento = '43'
				and	lower(x.nm_usuario) = lower(nm_usuario_p));

c44 CURSOR FOR
	SELECT	distinct 44 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299300) ds_tipo_evento, /*Verificar agenda comercial*/
		to_char(a.nr_sequencia) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299301,
			'NM_PESSOA_W='|| substr(obter_nome_pf_pj(b.cd_pessoa_fisica,b.cd_cnpj),1,255) ||
			';DS_HORARIO_W='|| to_char(a.dt_agenda,'dd/mm/yyyyy hh24:mi:ss') ||
			';DS_ASSUNTO_W='|| a.ds_assunto) ds_evento,
		'' nm_medico,
		a.dt_agenda dt_evento
	from	cml_prospect_agenda a,
		cml_prospect b
	where	a.nr_seq_prospect = b.nr_sequencia
	and	dt_agenda between clock_timestamp() - interval '950 seconds' and dt_agenda + 1
	and 	not exists (SELECT	1
				from	mon_ciente_evento x
				where	x.nr_seq_evento	= a.nr_sequencia
				and	x.ie_tipo_evento = '44'
				and	lower(x.nm_usuario) = lower(nm_usuario_p));

c45 CURSOR FOR
	SELECT 	45 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299302)  ds_tipo_evento, /*'Evento registrado na agenda cirúrgica'*/
		a.nr_sequencia cd_evento,
		SUBSTR(a.ds_acao,1,255) ||
		WHEB_MENSAGEM_PCK.get_texto(299303,
			'NM_PACIENTE_W='|| SUBSTR(coalesce(obter_nome_pf(c.cd_pessoa_fisica),c.nm_paciente),1,255) ||
			';DT_CIRURGIA_W='||  TO_CHAR(c.hr_inicio,'dd/mm/yyyy hh24:mi:ss') ||
			';DS_PROC_W='|| SUBSTR(obter_exame_agenda(c.cd_procedimento, c.ie_origem_proced, c.nr_seq_proc_interno),1,240) ||
			';DS_SALA_W='|| SUBSTR(obter_desc_agenda(c.cd_agenda),1,255)) ds_evento,
		'' nm_medico,
		a.dt_atualizacao dt_evento
	FROM   	agenda_pac_sangue_hist a,
		agenda_pac_sangue b,
		agenda_paciente c
	WHERE  	a.nr_seq_sangue = b.nr_sequencia
	AND	b.nr_seq_agenda = c.nr_sequencia
	and	ie_evento_alt_status_san_w = 'S'
	AND    	a.dt_atualizacao > clock_timestamp() - interval '43200 seconds'
	AND	a.ie_acao = '1'
	AND    	c.ie_status_agenda NOT IN ('C','L')
	and 	not exists (SELECT	1
				from	mon_ciente_evento x
				where	x.nr_seq_evento	= a.nr_sequencia
				and	x.ie_tipo_evento = '45'
				and	lower(x.nm_usuario) = lower(nm_usuario_p));

c46 CURSOR FOR
	SELECT 	46 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299305) ds_tipo_evento, /*Retorno de paciente com reclamação no SAC*/
		to_char(b.nr_atendimento) cd_evento,
		Wheb_mensagem_pck.get_Texto(299307) || substr(replace(obter_nome_pf(b.cd_pessoa_fisica),';',' '), 1, 60) ds_evento,
		obter_nome_medico(b.cd_medico_resp, 'G') nm_medico,
		b.dt_entrada dt_evento
	from  	sac_boletim_ocorrencia a,
		atendimento_paciente b
	where	a.cd_pessoa_fisica = b.cd_pessoa_fisica
	and	b.ie_tipo_atendimento = 1
	and	b.nr_atendimento = (  	SELECT max(f.nr_atendimento)
					from	atendimento_paciente f
					where	f.cd_pessoa_fisica = a.cd_pessoa_fisica)
					and	a.nr_sequencia = (select max(z.nr_sequencia)
								  from	 sac_boletim_ocorrencia z,
									 sac_resp_bol_ocor y
								  where  z.cd_pessoa_fisica = a.cd_pessoa_fisica
								  and    y.nr_seq_bo = z.nr_sequencia
								  and    y.nr_seq_classif in (  select   d.nr_sequencia
												from     sac_classif_ocorrencia d
												where    d.ie_tipo_classif = 'R'))
	and  	b.dt_entrada > clock_timestamp() - interval '43200 seconds'
	and   	not exists (	select  1
				from  mon_ciente_evento x
				where  x.nr_seq_evento  = b.nr_atendimento
				and  x.ie_tipo_evento = '46'
				and	lower(x.nm_usuario) = lower(nm_usuario_p))
	order by b.dt_entrada;

C47 CURSOR FOR
	 SELECT	47 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299309)  ds_tipo_evento, /*'Exame prescrito'*/
		TO_CHAR(b.nr_prescricao) || ',' || TO_CHAR(b.nr_sequencia) cd_evento,
		SUBSTR(WHEB_MENSAGEM_PCK.get_texto(299315,
			'NM_EXAME_W='|| c.nm_exame ||
			';NM_PACIENTE_W='|| SUBSTR(obter_pessoa_atendimento(a.nr_atendimento, 'N'),1,100) ||
			';NR_PRESCRICAO_W='|| a.nr_prescricao ||
			';NR_CONTROLE_W='|| TO_CHAR(a.nr_controle) ||
			';DS_LOCAL_W='|| SUBSTR(obter_unidade_atendimento(a.nr_atendimento,'A','SU'),1,30)  ||
			';NR_ATENDIMENTO_W='|| a.nr_atendimento ||
			';DT_PRESCRICAO_W='|| TO_CHAR(a.dt_prescricao,'dd/mm/yyyy hh24:mi:ss') ||
			';DS_LOCAL_PA_W='|| SUBSTR(OBTER_DESC_LOCAL_PA(nr_seq_local_pa),1,80) ||
			';DS_SETOR_W='|| SUBSTR(obter_dados_unidade2(Obter_Atepacu_paciente(a.nr_atendimento,'IAA'),'NSUBUC'),1,90) ||
			';DS_OBSERVACAO_W='|| b.ds_observacao) ,1,2000) ds_evento,
		'' nm_medico,
		a.dt_prescricao dt_evento
	FROM	exame_laboratorio c,
		atendimento_paciente d,
		prescr_procedimento b,
		prescr_medica a
	WHERE 	a.nr_prescricao	= b.nr_prescricao
	AND	a.nr_atendimento = d.nr_atendimento
	AND 	b.nr_seq_exame	= c.nr_seq_exame
	AND 	a.dt_prescricao > clock_timestamp() - interval '43200 seconds'
	AND	 ie_evento_exame_urg_w = 'U'
	AND	 ((b.ie_urgencia = 'S' AND IE_TIPO_ATENDIMENTO = 7)
	OR (ie_tipo_atendimento <> 7))
	and 	not exists
		(SELECT 1
		from 	prescr_proc_ciente x
		where 	x.nr_prescricao = b.nr_prescricao
		and 	x.nr_seq_prescr = b.nr_sequencia
		and	((ie_filtra_exames_p = 'S' and x.nm_usuario = nm_usuario_p) or (ie_filtra_exames_p = 'N')));

c48 CURSOR FOR
	SELECT distinct 48 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299317) ds_tipo_evento,/*Liberação de solicitação*/
	       to_char(s.NR_SOLIC_COMPRA) cd_evento,
	       '' nm_medico,
	       s.dt_liberacao dt_evento,
	       Wheb_mensagem_pck.get_Texto(299318) || substr(obter_nome_pessoa_fisica(S.CD_PESSOA_SOLICITANTE, NULL),1,200)  desc_compl
	FROM material m, solic_compra_item o
LEFT OUTER JOIN solic_compra s ON (o.nr_solic_compra = s.nr_solic_compra)
WHERE m.cd_material      = o.cd_material -- AND  s.NR_SOLIC_COMPRA = nr_solic_compra_w
	--  AND  s.dt_autorizacao IS NULL
  AND coalesce(S.DT_BAIXA::text, '') = '' and s.ie_situacao = 'A' and s.dt_liberacao between(clock_timestamp() - interval '93 days') and clock_timestamp() -- AND  o.dt_aprovacao IS NULL
  AND (s.dt_liberacao IS NOT NULL AND s.dt_liberacao::text <> '') AND NOT EXISTS (SELECT	1
		FROM	mon_ciente_evento x
		WHERE	x.nr_seq_evento	= s.NR_SOLIC_COMPRA
		AND	x.ie_tipo_evento = '48'
		AND	LOWER(x.nm_usuario) = LOWER(nm_usuario_p)) ORDER BY 1, s.dt_liberacao desc;

--cursor c49 is
--	select  distinct substr(o.CD_MATERIAL || ' - ' || 'Vl: '|| o.VL_UNIT_PREVISTO || ' - '||'Qt: '|| o.qt_material,1,2000) ds_evento
--	FROM   Solic_compra s,
--	       SOLIC_compra_item o,
--	       material m
--	WHERE  m.cd_material      = o.cd_material
--	AND    S.DT_BAIXA  IS NULL
--	and    s.ie_situacao = 'A'
--	and    s.dt_liberacao between (sysdate - 93) and sysdate
--	AND    o.nr_solic_compra  = s.nr_solic_compra (+)
--	AND    s.dt_liberacao IS NOT NULL
--	and    s.nr_solic_compra = cd_evento_w
--	ORDER BY 1;
c50 CURSOR FOR
	SELECT 	50 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299319) ds_tipo_evento, /*Aviso de forma de entrega de laudo - ISO*/
		to_char(c.nr_prescricao) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299321,
			'NM_PACIENTE_W='|| substr(replace(obter_nome_pf(b.cd_pessoa_fisica),';',' '), 1, 60) ||
			';NR_ATENDIMENTO_W='|| b.nr_atendimento ||
			';NR_PRESCRICAO_W='|| c.nr_prescricao ||
			';DS_PROC_W='|| substr(obter_desc_proc_prescr(c.nr_prescricao),1,400) ||
			';DS_FORMA_W='|| a.ds_forma) ds_evento,
		obter_nome_medico(b.cd_medico_resp, 'G') nm_medico,
		b.dt_atualizacao dt_evento
	from  	atendimento_paciente b,
		forma_entrega_laudo a,
		prescr_medica c
	where	a.nr_sequencia = c.nr_seq_forma_laudo
	and	c.nr_atendimento = b.nr_atendimento
	and	  ((coalesce(a.ie_gerar_alerta_tasymon,'N') = 'S') or (coalesce(a.ie_gerar_alerta_tasymon,'N') = 'L') and exists (SELECT 1
														from laudo_paciente y
														where y.nr_prescricao = c.nr_prescricao
														and	  coalesce(y.dt_liberacao::text, '') = ''))
	and  	c.dt_prescricao > clock_timestamp() - interval '43200 seconds'
	and	  ie_evento_forma_entrega_w = 'S'
	and   	not exists (	select  1
				from  	mon_ciente_evento x
				where  	x.nr_seq_evento  = c.nr_prescricao
				and  	x.ie_tipo_evento = '50'
				and	lower(x.nm_usuario) = lower(nm_usuario_p))
	order by b.dt_entrada;

C51 CURSOR FOR
	SELECT	distinct
		51 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299323) ds_tipo_evento, /*Liberação de solicitação urgente*/
		to_char(a.nr_solic_compra) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299324,
			'NR_SOLIC_COMPRA_W='|| a.nr_solic_compra ||
			';DS_LOCAL_W='|| substr(obter_desc_local_estoque(a.cd_local_estoque),1,200) ||
			';NM_SOLIC_W='|| substr(obter_nome_pessoa_fisica(a.cd_pessoa_solicitante, null),1,200))  ds_evento,
		'' nm_medico,
		a.dt_liberacao dt_evento
	from	solic_compra a
	where	coalesce(a.dt_baixa::text, '') = ''
	and	ie_urgente = 'S'
	and	a.ie_situacao = 'A'
	and	a.dt_liberacao between(clock_timestamp() - interval '10 days') and clock_timestamp()
	and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and	not exists (	SELECT	1
				from	mon_ciente_evento x
				where	x.nr_seq_evento = a.nr_solic_compra
				and	x.ie_tipo_evento = '51'
				and	lower(x.nm_usuario) = lower(nm_usuario_p))
	order by 1, a.dt_liberacao desc;

C52 CURSOR FOR
	SELECT 	distinct
		52 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299325, 'DS_CATACTER_W='||substr(obter_valor_dominio(1016, a.ie_carater_cirurgia),1,255)) ds_tipo_evento,
		to_char(a.nr_sequencia) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299326,
			'NM_PACIENTE_W='|| substr(obter_nome_pf(a.cd_pessoa_fisica),1,80) ||
			';NR_ATENDIMENTO_W='|| a.nr_atendimento ||
			';DT_CIRURGIA_W='|| to_char(a.hr_inicio,'dd/mm/yyyy hh24:mi:ss') ||
			';DS_PROC_W='|| substr(obter_exame_agenda(a.cd_procedimento, a.ie_origem_proced, a.nr_seq_proc_interno),1,240) ||
			';DS_CONV_W='|| substr(obter_desc_convenio(cd_convenio),1,240)) ds_evento,
		substr(obter_nome_medico(a.cd_medico, 'G'),1,80) nm_medico,
		a.hr_inicio dt_evento
	from  	agenda_paciente a
	where 	obter_se_contido_char(a.ie_carater_cirurgia,ie_carater_cir_w) = 'S'
	and	dt_agenda between(clock_timestamp() - interval '1 days') and clock_timestamp()
	and	a.ie_status_agenda not in ('L','C','B')
	and	not exists (SELECT	1
				 from	mon_ciente_evento x
				 where	x.nr_seq_evento		= a.nr_sequencia
				 and	x.ie_tipo_evento	= '52'
				 and	lower(x.nm_usuario) = lower(nm_usuario_p))
	order by dt_evento, ds_tipo_evento;

C53 CURSOR FOR
	SELECT 	distinct
		53 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299327) ds_tipo_evento, /*Liberação de recebimentos dos pertences paciente*/
		to_char(a.nr_sequencia) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299328,
			'NR_ATENDIMENTO_W='|| a.nr_atendimento ||
			';DT_ATUALIZACAO_NREC_W='|| to_char(c.dt_atualizacao_nrec,'dd/mm/yyyy hh24:mi:ss')) ds_evento,
		'' nm_medico,
		c.dt_atualizacao_nrec dt_evento
	from	pertence_paciente a,
			pertence_paciente_item c
	where	c.dt_atualizacao_nrec > clock_timestamp() - interval '2 days'
	and		a.nr_sequencia = c.nr_seq_pertence_paciente
	and	not exists (SELECT 1
				from	pertence_paciente_ciente x
				where	x.nr_seq_pertence	= a.nr_sequencia
				and	x.nm_usuario		= nm_usuario_p)
	and	ie_evento_lib_receb_pp_w = 'S'
	and (select max(b.ie_evento_lib_receb) from pertence_item b where b.nr_sequencia = c.nr_seq_pertence) = 'S';

c54 CURSOR FOR
	SELECT	12 ie_tipo_evento,
			Wheb_mensagem_pck.get_Texto(299278) ds_tipo_evento, /*Nova Ordem de serviço*/
			to_char(a.nr_sequencia) cd_evento,
			substr(WHEB_MENSAGEM_PCK.get_texto(299281,
				'NR_SEQUENCIA_W='|| a.nr_sequencia  ||
				';DS_LOCALIZACAO_W='|| substr(obter_descricao_padrao('MAN_LOCALIZACAO','DS_LOCALIZACAO',a.nr_seq_localizacao),1,80) ||
				';NM_SOLICITANTE_W='|| substr(obter_nome_pessoa_fisica(a.cd_pessoa_solicitante, null),1,60)  ||
				';DS_DANO_BREVE_W='|| a.ds_dano_breve  ||
				';DS_PRIORIDADE_W='|| substr(obter_valor_dominio(1046, a.ie_prioridade),1,50) ||
				';DS_EQUIPAMENTO_W='|| obter_desc_man_equipamento(a.nr_seq_equipamento,'N') ||
				';DT_CONCLUSAO_W='|| to_char(a.dt_conclusao_desejada, 'dd/mm/yyyy')),1,255)  ds_evento,
			'' nm_medico,
			a.dt_ordem_servico dt_evento
	FROM man_ordem_servico a
LEFT OUTER JOIN man_ordem_servico_exec b ON (a.nr_sequencia = b.nr_seq_ordem)
WHERE ((b.nm_usuario_exec = nm_usuario_p) or (obter_se_usuario_grupo_trab(a.nr_grupo_trabalho,nm_usuario_p) = 'S' and ie_grupo_ordem_serv_w = 'S')) and a.dt_ordem_servico > clock_timestamp() - interval '43200 seconds' and coalesce(b.dt_ult_visao::text, '') = '' and (((coalesce(b.nr_sequencia::text, '') = '' and ie_grupo_ordem_serv_w = 'S') or (b.nm_usuario_exec = nm_usuario_p))  or ie_grupo_ordem_serv_w = 'N') and ie_evento_ordem_serv_w = 'V' and coalesce(a.dt_fim_real::text, '') = '' and ie_prioridade = 'E' and not exists (SELECT	1
				from	man_ordem_serv_ciente x
				where	x.nr_seq_ordem		= a.nr_sequencia
				and	x.nm_usuario		= nm_usuario_p)
	
union all

	select	12 ie_tipo_evento,
			Wheb_mensagem_pck.get_Texto(299278) ds_tipo_evento, /*Nova Ordem de serviço*/
			to_char(a.nr_sequencia) cd_evento,
			substr(WHEB_MENSAGEM_PCK.get_texto(299281,
				'NR_SEQUENCIA_W='|| a.nr_sequencia  ||
				';DS_LOCALIZACAO_W='|| substr(obter_descricao_padrao('MAN_LOCALIZACAO','DS_LOCALIZACAO',a.nr_seq_localizacao),1,80) ||
				';NM_SOLICITANTE_W='|| substr(obter_nome_pessoa_fisica(a.cd_pessoa_solicitante, null),1,60)  ||
				';DS_DANO_BREVE_W='|| a.ds_dano_breve  ||
				';DS_PRIORIDADE_W='|| substr(obter_valor_dominio(1046, a.ie_prioridade),1,50) ||
				';DS_EQUIPAMENTO_W='|| obter_desc_man_equipamento(a.nr_seq_equipamento,'N') ||
				';DT_CONCLUSAO_W='|| to_char(a.dt_conclusao_desejada, 'dd/mm/yyyy')),1,255)  ds_evento,
			'' nm_medico,
			a.dt_reabertura dt_evento
	FROM man_ordem_servico a
LEFT OUTER JOIN man_ordem_servico_exec b ON (a.nr_sequencia = b.nr_seq_ordem)
WHERE ((b.nm_usuario_exec = nm_usuario_p) or (obter_se_usuario_grupo_trab(a.nr_grupo_trabalho,nm_usuario_p) = 'S' and ie_grupo_ordem_serv_w = 'S')) and a.dt_reabertura > clock_timestamp() - interval '43200 seconds' and coalesce(b.dt_ult_visao::text, '') = '' and (((coalesce(b.nr_sequencia::text, '') = '' and ie_grupo_ordem_serv_w = 'S') or (b.nm_usuario_exec = nm_usuario_p))  or ie_grupo_ordem_serv_w = 'N') and ie_evento_ordem_serv_w = 'V' and coalesce(a.dt_fim_real::text, '') = '' and ie_prioridade = 'E' and not exists (select	1
				from	man_ordem_serv_ciente x
				where	x.nr_seq_ordem		= a.nr_sequencia
				and	x.nm_usuario		= nm_usuario_p);

C55 CURSOR FOR
	SELECT	55 ie_evento,
			wheb_mensagem_pck.get_texto(802754) ds_tipo_evento,
			TO_CHAR(a.nr_sequencia)cd_evento,
			' - ' || wheb_mensagem_pck.get_texto(796345) || ' ' || SUBSTR( obter_nome_setor(b.cd_setor_atendimento) ||
			' - ' || wheb_mensagem_pck.get_texto(802755) || ' ' || b.cd_unidade_basica || b.cd_unidade_compl ||
			' - ' || wheb_mensagem_pck.get_texto(802756) || ': ' || to_char(a.dt_historico, pkg_date_formaters.localize_mask('short', pkg_date_formaters.getUserLanguageTag(wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck.get_nm_usuario))) ||
			' - ' || wheb_mensagem_pck.get_texto(791220) || ': ' || a.nm_usuario,1,255) ds_evento,
			'' nm_medico,
			a.dt_historico dt_evento
	FROM	UNIDADE_ATEND_HIST a,
			UNIDADE_ATENDIMENTO b
	WHERE	a.nr_seq_unidade = b.nr_seq_interno
	AND		a.ie_status_unidade = 'H'
	AND		a.dt_historico > clock_timestamp() - interval '43200 seconds'
	and 	not exists (SELECT	1
				from	mon_ciente_evento x
				where	x.nr_seq_evento	= a.nr_sequencia
				and	x.ie_tipo_evento = '55'
				and	lower(x.nm_usuario) = lower(nm_usuario_p))
	order by a.dt_historico;

c56 CURSOR FOR
	SELECT	distinct
		56 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299331) ds_tipo_evento, /*'Alta de paciente regra' */
		to_char(a.nr_atendimento) cd_evento,
		WHEB_MENSAGEM_PCK.get_texto(299334,
			'DS_UNID_W='|| obter_Unidade_Atendimento(a.nr_atendimento,'A','U') ||
			';NM_PACIENTE_W='|| substr(obter_nome_pf(a.cd_pessoa_fisica),1,80) ||
			';NR_ATENDIMENTO_W='|| a.nr_atendimento  ||
			';DS_SETOR_W='|| obter_nome_setor(obter_setor_atendimento(a.nr_atendimento)) ||
			';DT_ALTA_W='|| to_char(dt_alta, 'dd/mm/yyyy hh24:mi:ss')) ds_evento,
		obter_nome_pf(a.cd_medico_resp) nm_medico,
		a.dt_alta dt_evento
	from	atendimento_paciente a,
		atend_categoria_convenio c,
		prescr_medica b
	where	b.nr_atendimento = a.nr_atendimento
	and	c.nr_atendimento = a.nr_atendimento
	and (a.dt_alta + 1) >= clock_timestamp()
	and	coalesce(b.dt_suspensao::text, '') = ''
	and	(b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '')
	and	b.nr_prescricao in (
		SELECT	x.nr_prescricao
		from	ap_lote x
		where	x.nr_prescricao = b.nr_prescricao
		and	x.ie_status_lote = 'D')
	and	exists(	select 	1
			from	regra_envio_mensagem_alta e
			where	coalesce(e.ie_tipo_atendimento, a.ie_tipo_atendimento) = a.ie_tipo_atendimento
			and	coalesce(e.cd_convenio, c.cd_convenio) = c.cd_convenio
			and	((coalesce(e.nr_minutos,0) = 0) or
				(clock_timestamp() <= (a.dt_alta + (coalesce(e.nr_minutos,0)/ 1440)))))
	and	not exists (	select 1
				from 	atend_alta_ciente x
				where	x.nr_atendimento = a.nr_atendimento
				and	x.nm_usuario = nm_usuario_p)
	order by 2;

c57 CURSOR FOR
	SELECT	57 ie_tipo_evento,
		Wheb_mensagem_pck.get_Texto(299336) ds_tipo_evento, /*Alerta alteração em tabela através da tela "Cadastros gerais"*/
		a.nr_sequencia cd_evento,
		a.ds_alerta ds_evento,
		'' nm_medico,
		a.dt_atualizacao_nrec dt_evento
	from	alerta_alteracao_tabela a,
		usuario_alerta_tabela b
	where	a.nm_tabela = b.nm_tabela
	and	b.nm_usuario = nm_usuario_p
	and	not exists (SELECT	1
			   from		mon_cad_gerais_ciente c
			   where	c.nr_seq_alteracao = a.nr_sequencia);

c58 CURSOR FOR
	SELECT 	58 ie_tipo_evento,
		wheb_mensagem_pck.get_texto(323460) ds_tipo_evento,-- /*Call Center - Retornar ligação (nova tentativa contato)*/
		a.nr_sequencia cd_evento,
		SUBSTR(WHEB_MENSAGEM_PCK.get_texto(323462,
			'DT_SUGERIDA='||to_char(a.dt_sugerida,'dd/mm/yyyy hh24:mi')||
			';NM_PESSOA_ATEND='||obter_nome_pessoa_fisica(b.cd_pessoa_fisica, null)),1,2000) ds_evento,
		'' nm_medico,
		a.dt_atualizacao_nrec dt_evento
	from 	pls_atend_sugestao_contato a, pls_atendimento b
	where 	exists (	SELECT 	1
				from	pls_atendimento x
				where	x.nr_sequencia = a.nr_seq_atendimento
				and	x.nr_seq_operador = nr_seq_operador_w )
	and	coalesce(a.dt_aviso::text, '') = ''
	and	a.nr_seq_atendimento = b.nr_sequencia
	and	a.dt_sugerida <= clock_timestamp() + ((1/24/60)*5)/*trunc(sysdate+((1/24/60)*5) adiciona 5 minutos no horário atual para apresentar a mensagem com 5 min. antes do horário sugerido.*/
	order by a.dt_sugerida;

c59 CURSOR FOR
	SELECT 	59 ie_tipo_evento,
		wheb_mensagem_pck.get_texto(333178) ds_tipo_evento,
		a.nr_sequencia cd_evento,
		SUBSTR(WHEB_MENSAGEM_PCK.get_texto(333187,
			'DT_PREVISTA='||to_char(a.dt_prevista,'dd/mm/yyyy hh24:mi')||
			';NM_PESSOA_RESERVA='||obter_nome_pessoa_fisica(a.cd_pessoa_fisica, null)),1,2000) ds_evento,
		'' nm_medico,
		dt_atualizacao_nrec dt_evento
	from	gestao_vaga a
	where	ie_status = 'A'
	and	a.dt_atualizacao_nrec > clock_timestamp() - interval '10 days';



BEGIN

dt_inicial_cih_w	:= clock_timestamp() - interval '3 days';
dt_final_cih_w		:= clock_timestamp() + interval '3 days';

select	coalesce(max(coalesce(vl_parametro, vl_parametro_padrao)),0)
into STRICT	nr_min_comunic_w
from	funcao_parametro
where	cd_funcao	= 5001
and	nr_sequencia	= 1;

select	coalesce(max(vl_parametro), nr_min_comunic_w)
into STRICT	nr_min_comunic_w
from	funcao_param_usuario
where	cd_funcao	= 5001
and	nr_sequencia	= 1
and	nm_usuario	= nm_usuario_p;

select	coalesce(ie_evento_agenda,'N'),
	coalesce(ie_evento_sac,'N'),
	coalesce(ie_evento_processo,'N'),
	coalesce(ie_evento_prescr,'N'),
	coalesce(ie_evento_proc_agenda,'N'),
	coalesce(ie_evento_comunic,'N'),
	coalesce(ie_evento_alerta,'N'),
	coalesce(ie_evento_aprov_compra,'N'),
	coalesce(ie_evento_exame_urg,'N'),
	coalesce(ie_evento_lib_telefone,'N'),
	coalesce(ie_evento_ordem_serv,'N'),
	coalesce(ie_evento_obj_inv,'N'),
	coalesce(ie_evento_recoleta,'N'),
	coalesce(ie_evento_susp_exame,'N'),
	coalesce(ie_evento_med_cih,'N'),
	coalesce(ie_evento_solic_pront,'N'),
	coalesce(ie_evento_int_agenda_san,'N'),
	coalesce(ie_evento_vinc_agenda_san,'N'),
	coalesce(ie_evento_canc_cir_san,'N'),
	coalesce(ie_evento_canc_agenda_san,'N'),
	coalesce(ie_evento_enc_agenda_san,'N'),
	coalesce(ie_evento_transf_agenda_san,'N'),
	coalesce(ie_evento_alteracao_param,'N'),
	coalesce(ie_evento_paciente,'N'),
	coalesce(ie_evento_estrangeiro,'N'),
	coalesce(ie_evento_alta_partic,'N'),
	coalesce(ie_evento_alerta_medico,'N'),
	coalesce(ie_evento_prev_alta,'N'),
	coalesce(ie_evento_alta_partic_ext,'N'),
	coalesce(ie_evento_alta_regra,'N'),
	coalesce(ie_evento_os_programar,'N'),
	coalesce(ie_dieta_prescrita,'N'),
	coalesce(ie_evento_agenda_comercial,'N'),
	coalesce(ie_evento_requisicao_lib,'N'),
	coalesce(ie_evento_alt_status_san,'N'),
	coalesce(ie_ocorrencia_retorno,'N'),
	coalesce(IE_EVENTO_SOLIC_COMPRA, 'N'),
	coalesce(ie_alerta_forma_entrega,'N'),
	coalesce(ie_evento_hemo,'N'),
	coalesce(ie_evento_sc_urgente,'N'),
	coalesce(ie_evento_agenda_carater,'N'),
	coalesce(ie_evento_lib_receb_pp,'N'),
	coalesce(ie_evento_higienizacao_leito, 'N'),
	coalesce(ie_evento_retorno_ligacao, 'N'),
	coalesce(ie_evento_vaga_pend_aprov, 'N')
into STRICT	ie_evento_agenda_w,
	ie_evento_sac_w,
	ie_evento_processo_w,
	ie_evento_prescr_w,
	ie_evento_procage_w,
	ie_evento_comunic_w,
	ie_evento_alerta_w,
	ie_evento_aprovacao_w,
	ie_evento_exame_urg_w,
	ie_evento_lib_telefone_w,
	ie_evento_ordem_serv_w,
	ie_evento_obj_inv_w,
	ie_evento_recoleta_w,
	ie_evento_susp_exame_w,
	ie_evento_med_cih_w,
	ie_evento_solic_pront_w,
	ie_evento_int_agenda_san_w,
	ie_evento_vinc_agenda_san_w,
	ie_evento_canc_cir_san_w,
	ie_evento_canc_agenda_san_w,
	ie_evento_enc_agenda_san_w,
	ie_evento_transf_agenda_san_w,
	ie_evento_alteracao_param_w,
	ie_evento_paciente_w,
	ie_evento_estrangeiro_w,
	ie_evento_alta_partic_w,
	ie_evento_alerta_medico_w,
	ie_evento_prev_alta_w,
	ie_evento_alta_partic_ext_w,
	ie_evento_alta_regra_w,
	ie_evento_os_programar_w,
	ie_evento_dieta_prescrita_w,
	ie_evento_agenda_comercial_w,
	ie_evento_requisicao_lib_w,
	ie_evento_alt_status_san_w,
	ie_ocorrencia_retorno_w,
	IE_EVENTO_SOLIC_COMPRA_w,
	ie_evento_forma_entrega_w,
	ie_evento_hemo_w,
	ie_evento_sc_urgente_w,
	ie_evento_agenda_carater_w,
	ie_evento_lib_receb_pp_w,
	ie_evento_higienizacao_leito_w,
	ie_evento_retorno_ligacao_w,
	ie_evento_vaga_pend_aprov_w
from	usuario
where	nm_usuario	= nm_usuario_p;

select	a.cd_setor_atendimento,
	a.cd_pessoa_fisica,
	b.cd_cargo
into STRICT	cd_setor_usuario_w,
	cd_pessoa_usuario_w,
	cd_cargo_w
FROM usuario a
LEFT OUTER JOIN pessoa_fisica b ON (a.cd_pessoa_fisica = b.cd_pessoa_fisica)
WHERE a.nm_usuario		= nm_usuario_p;

select	cd_estabelecimento
into STRICT	cd_estabelecimento_w
from	usuario
where	nm_usuario	= nm_usuario_p;

ie_etapa_w := obter_param_usuario(722, 12, null, nm_usuario_p, cd_estabelecimento_w, ie_etapa_w);
ie_carater_cir_w := obter_param_usuario(871, 671, null, nm_usuario_p, cd_estabelecimento_w, ie_carater_cir_w);
cd_setor_atendimento_w := obter_param_usuario(5001, 23, null, nm_usuario_p, cd_estabelecimento_w, cd_setor_atendimento_w);
ie_tipo_atend_processo_w := obter_param_usuario(17, 4, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_w, ie_tipo_atend_processo_w);

if (ie_evento_comunic_w = 'S') then
	ie_somente_comunic_lib_w 	:= coalesce(obter_valor_param_usuario(87,9,obter_perfil_ativo,nm_usuario_p,cd_estabelecimento_w),'N');
	ie_restrige_estab_logado_w	:= coalesce(obter_valor_param_usuario(87,36,obter_perfil_ativo,nm_usuario_p,cd_estabelecimento_w),'N');
end if;

select	coalesce(obter_valor_param_usuario(5001,15,obter_perfil_ativo,nm_usuario_p,cd_estabelecimento_w),'N')
into STRICT	ie_grupo_ordem_serv_w
;

select	count(*)
into STRICT	qt_regra_ordem_serv_w
from	man_regra_envio_mon
where	cd_estabelecimento	= cd_estabelecimento_w;

select	max(a.nr_seq_grupo)
into STRICT	nr_seq_grupo_des_w
from	usuario_grupo_des a
where	a.nm_usuario_grupo	= nm_usuario_p;

select	max(a.nr_sequencia)
into STRICT	nr_seq_operador_w
from	pls_operador	a
where	a.cd_pessoa_fisica 	= cd_pessoa_usuario_w;

if (ie_evento_agenda_w = 'S') then
	Open	c01;
	Loop
	Fetch	c01 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w,
		dt_final_w;
	EXIT WHEN NOT FOUND; /* apply on c01 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
	 								to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;' ||
									to_char(dt_final_w, 'dd/mm/yyyy hh24:mi:ss') || ';' || chr(10);
		end if;
	end loop;
	close c01;
end if;

if (ie_evento_sac_w = 'S') then
	Open	c02;
	Loop
	Fetch	c02 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c02 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c02;
end if;

if (ie_evento_processo_w = 'S') then
	Open	c03;
	Loop
	Fetch	c03 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c03 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c03;
end if;

if (ie_evento_prescr_w = 'S') then
	Open	c04;
	Loop
	Fetch	c04 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c04 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
	 								to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c04;
end if;

if (ie_evento_procage_w = 'S') then
	Open	c05;
	Loop
	Fetch	c05 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c05 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c05;
end if;

if (ie_evento_comunic_w = 'S') then
	Open	c06;
	Loop
	Fetch	c06 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c06 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
										cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c06;
end if;

if (ie_evento_alerta_w = 'S') then
	Open	c07;
	Loop
	Fetch	c07 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c07 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
	 								to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c07;
end if;

if (ie_evento_hemo_w <> 'N') then
	Open	c08;
	Loop
	Fetch	c08 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c08 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
	 								to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c08;
end if;

if	(ie_evento_exame_urg_w <> 'N' AND ie_evento_exame_urg_w <> 'U') then
	Open	c10;
	Loop
	Fetch	c10 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c10 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
	 								to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c10;
end if;

if (ie_evento_lib_telefone_w = 'S') then
	Open	c11;
	Loop
	Fetch	c11 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c11 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c11;
end if;

/*if	(ie_evento_ordem_serv_w in ('S','O','P','X')) then

	Open	c12;
	Loop
	Fetch	c12 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	exit	when c12%notfound;
		if	(ds_resultado_w is null) or
			(length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c12;
end if; */
if (ie_evento_obj_inv_w = 'S') then
	Open	c13;
	Loop
	Fetch	c13 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c13 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c13;
end if;

if (ie_evento_recoleta_w = 'S') then
	Open	c14;
	Loop
	Fetch	c14 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c14 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c14;
end if;

if (ie_evento_susp_exame_w = 'S') then
	Open	c15;
	Loop
	Fetch	c15 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c15 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c15;
end if;

if (ie_evento_med_cih_w = 'S') then
	Open	c16;
	Loop
	Fetch	c16 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c16 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c16;
end if;

if (qt_regra_ordem_serv_w > 0) then
	Open	c17;
	Loop
	Fetch	c17 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c17 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c17;
end if;

if (ie_evento_solic_pront_w = 'S') then
	Open	c18;
	Loop
	Fetch	c18 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c18 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c18;
end if;

if (ie_evento_int_agenda_san_w = 'S') then
	Open	c19;
	Loop
	Fetch	c19 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c19 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c19;
end if;

if (ie_evento_vinc_agenda_san_w = 'S') then
	Open	c20;
	Loop
	Fetch	c20 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c20 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c20;
end if;

if (ie_evento_canc_cir_san_w = 'S') then
	Open	c21;
	Loop
	Fetch	c21 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c21 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c21;
end if;

if (ie_evento_canc_agenda_san_w = 'S') then
	Open	c22;
	Loop
	Fetch	c22 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c22 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c22;
end if;

if (ie_evento_enc_agenda_san_w = 'S') then
	Open	c23;
	Loop
	Fetch	c23 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c23 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c23;
end if;

if (ie_evento_transf_agenda_san_w = 'S') then
	Open	c24;
	Loop
	Fetch	c24 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c24 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c24;
end if;

if (ie_evento_alteracao_param_w = 'S') then
	Open	c25;
	Loop
	Fetch	c25 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c25 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c25;
end if;

if (ie_evento_paciente_w = 'S') then
	open	c26;
	loop
	fetch	c26 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c26 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= 	ds_resultado_w	||
									ie_tipo_evento_w 	|| ';' ||
									ds_tipo_evento_w 	|| ';' ||
									cd_evento_w		 	|| ';' ||
									ds_evento_w			|| ';' ||
									nm_medico_w			|| ';' ||
									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c26;
end if;

if (ie_evento_estrangeiro_w = 'S') then
	open	c27;
	loop
	fetch	c27 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c27 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= 	ds_resultado_w	||
									ie_tipo_evento_w 	|| ';' ||
									ds_tipo_evento_w 	|| ';' ||
									cd_evento_w		 	|| ';' ||
									ds_evento_w			|| ';' ||
									nm_medico_w			|| ';' ||
									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c27;
end if;


if (ie_evento_alta_partic_w = 'S') then

	open	c28;
	loop
	fetch	c28 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c28 */

		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then

			ds_resultado_w			:= 	ds_resultado_w	||
									ie_tipo_evento_w 	|| ';' ||
									ds_tipo_evento_w 	|| ';' ||
									cd_evento_w		 	|| ';' ||
									ds_evento_w			|| ';' ||
									nm_medico_w			|| ';' ||
									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;

	end loop;

	close c28;
end if;

if (ie_evento_aprovacao_w = 'S') then

	open	c_processo_aprov;
	loop
	fetch	c_processo_aprov into nr_seq_aprovacao_w,
			 nr_seq_proc_aprov_w;
	EXIT WHEN NOT FOUND; /* apply on c_processo_aprov */
		begin

		open	c_solic_compra;
		loop
		fetch	c_solic_compra into
			ie_tipo_aprov_w,
			nr_seq_ord_sol_w,
			nr_seq_item_w,
			vl_material_w,
			qt_material_w,
			dt_aprovacao_w,
			ds_material_w,
			nm_solic_w,
			dt_liberacao_w,
			ds_material_direto_w,
			ds_observacao_w;
		EXIT WHEN NOT FOUND; /* apply on c_solic_compra */
			begin

			if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
				begin
				if (ie_tipo_aprov_w = 'O') then
					ds_resultado_w	:= ds_resultado_w ||
								Wheb_mensagem_pck.get_Texto(299337)|| nr_seq_ord_sol_w ||';' ||
								nr_seq_aprovacao_w || ',' || nr_seq_proc_aprov_w || ';' ||
								Wheb_mensagem_pck.get_Texto(299339) || ds_material_W || Wheb_mensagem_pck.get_Texto(299340) || campo_mascara(vl_material_w, 2)  ||
								Wheb_mensagem_pck.get_Texto(299341) || campo_mascara(qt_material_w,2) ||
								Wheb_mensagem_pck.get_Texto(299342) || nm_solic_w ||';;' ||
								to_char(dt_aprovacao_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
				elsif (ie_tipo_aprov_w = 'S') then
					ds_resultado_w	:= ds_resultado_w ||
								Wheb_mensagem_pck.get_Texto(299343) || nr_seq_ord_sol_w ||';' ||
								nr_seq_aprovacao_w || ',' || nr_seq_proc_aprov_w || ';' ||
								Wheb_mensagem_pck.get_Texto(299345) || ds_material_W || Wheb_mensagem_pck.get_Texto(299340) || campo_mascara(vl_material_w, 2)  ||
								Wheb_mensagem_pck.get_Texto(299341) || campo_mascara(qt_material_w,2) ||
								Wheb_mensagem_pck.get_Texto(299342) || nm_solic_w ||';;' ||
								to_char(dt_aprovacao_w, 'dd/mm/yyyy hh24:mi:ss') || ';' ||
								replace(ds_material_direto_w,chr(10),'') || ';' || replace(ds_observacao_w,chr(10),'') || ';;' || chr(10);
				else
					ds_resultado_w	:= ds_resultado_w ||
								Wheb_mensagem_pck.get_Texto(299346) || nr_seq_ord_sol_w ||';' ||
								nr_seq_aprovacao_w || ',' || nr_seq_proc_aprov_w || ';' ||
								Wheb_mensagem_pck.get_Texto(299339) || ds_material_W || Wheb_mensagem_pck.get_Texto(299340) || campo_mascara(vl_material_w, 2)  ||
								Wheb_mensagem_pck.get_Texto(299341) || campo_mascara(qt_material_w,2) ||
								Wheb_mensagem_pck.get_Texto(299347) || nm_solic_w ||';;' ||
								to_char(dt_aprovacao_w, 'dd/mm/yyyy hh24:mi:ss') || ';;' ||
								replace(ds_observacao_w,chr(10),'') || ';;' || chr(10);
				end if;

				end;
			end if;
			end;
		end loop;
		close c_solic_compra;
		end;
	end loop;
	close c_processo_aprov;
end if;

if (ie_evento_alerta_medico_w = 'S') then

	open	c29;
	loop
	fetch	c29 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c29 */

		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then

			ds_resultado_w			:= 	ds_resultado_w	||
									ie_tipo_evento_w 	|| ';' ||
									ds_tipo_evento_w 	|| ';' ||
									cd_evento_w		 	|| ';' ||
									ds_evento_w			|| ';' ||
									nm_medico_w			|| ';' ||
									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;

	end loop;

	close c29;
end if;

if (ie_evento_prev_alta_w = 'S') then

	open	c30;
	loop
	fetch	c30 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c30 */

		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then

			ds_resultado_w			:= 	ds_resultado_w	||
									ie_tipo_evento_w 	|| ';' ||
									ds_tipo_evento_w 	|| ';' ||
									cd_evento_w		 	|| ';' ||
									ds_evento_w			|| ';' ||
									nm_medico_w			|| ';' ||
									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;

	end loop;

	close c30;
end if;


if (ie_evento_alta_partic_ext_w = 'S') then

	open	c31;
	loop
	fetch	c31 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c31 */

		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then

			ds_resultado_w			:= 	ds_resultado_w	||
									ie_tipo_evento_w 	|| ';' ||
									ds_tipo_evento_w 	|| ';' ||
									cd_evento_w		 	|| ';' ||
									ds_evento_w			|| ';' ||
									nm_medico_w			|| ';' ||
									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;

	end loop;

	close c31;
end if;

if (ie_evento_alta_regra_w = 'S') then

	open	c32;
	loop
	fetch	c32 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c32 */

		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then

			ds_resultado_w			:= 		ds_resultado_w	||
									ie_tipo_evento_w 	|| ';' ||
									ds_tipo_evento_w 	|| ';' ||
									cd_evento_w		 	|| ';' ||
									ds_evento_w			|| ';' ||
									nm_medico_w			|| ';' ||
									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;

	end loop;

	close c32;
end if;

if (ie_evento_ordem_serv_w = 'S') then

	Open	c33;
	Loop
	Fetch	c33 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c33 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c33;
end if;

if (ie_evento_ordem_serv_w = 'O') then

	Open	c34;
	Loop

	Fetch	c34 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;

	EXIT WHEN NOT FOUND; /* apply on c34 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;

	close c34;
end if;

if (ie_evento_ordem_serv_w = 'P') then

	Open	c35;
	Loop
	Fetch	c35 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c35 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c35;
end if;

if (ie_evento_ordem_serv_w = 'X') then

	Open	c36;
	Loop
	Fetch	c36 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c36 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c36;
end if;

if (ie_evento_ordem_serv_w = 'H') then

	Open	c37;
	Loop
	Fetch	c37 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c37 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c37;
end if;

if (ie_evento_ordem_serv_w = 'E') then

	Open	c38;
	Loop
	Fetch	c38 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c38 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c38;
end if;



if (ie_evento_ordem_serv_w = 'G') then

	Open	c39;
	Loop
	Fetch	c39 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c39 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c39;
end if;

if (ie_evento_ordem_serv_w = 'R') then

	Open	c40;
	Loop
	Fetch	c40 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c40 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c40;
end if;

if (ie_evento_ordem_serv_w = 'V') then

	Open	c54;
	Loop
	Fetch	c54 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c54 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
 									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c54;
end if;

if (ie_evento_os_programar_w = 'S') then
	open	c41;
	loop
	fetch	c41 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c41 */

		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then

			ds_resultado_w			:= 		ds_resultado_w	||
									ie_tipo_evento_w 	|| ';' ||
									ds_tipo_evento_w 	|| ';' ||
									cd_evento_w		 	|| ';' ||
									ds_evento_w			|| ';' ||
									nm_medico_w			|| ';' ||
									to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;

	end loop;
	close c41;
end if;

if (ie_evento_dieta_prescrita_w = 'S') then
	open	c42;
	loop
	fetch	c42 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c42 */

		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then

			ds_resultado_w			:= 	ds_resultado_w	||
								ie_tipo_evento_w 	|| ';' ||
								ds_tipo_evento_w 	|| ';' ||
								cd_evento_w		 	|| ';' ||
								ds_evento_w			|| ';' ||
								nm_medico_w			|| ';' ||
								to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;

	end loop;
	close c42;
end if;

if (ie_evento_requisicao_lib_w = 'S') then
	open	c43;
	loop
	fetch	c43 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c43 */

		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then

			ds_resultado_w			:= 	ds_resultado_w	||
								ie_tipo_evento_w 	|| ';' ||
								ds_tipo_evento_w 	|| ';' ||
								cd_evento_w		 	|| ';' ||
								ds_evento_w			|| ';' ||
								nm_medico_w			|| ';' ||
								to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;

	end loop;
	close c43;
end if;

if (ie_evento_agenda_comercial_w = 'S') then
	open	c44;
	loop
	fetch	c44 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c44 */

		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then

			ds_resultado_w			:= 	ds_resultado_w	||
								ie_tipo_evento_w 	|| ';' ||
								ds_tipo_evento_w 	|| ';' ||
								cd_evento_w		|| ';' ||
								ds_evento_w		|| ';' ||
								nm_medico_w		|| ';' ||
								to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;

	end loop;
	close c44;
end if;

if (ie_evento_alt_status_san_w = 'S') then
	open	c45;
	loop
	fetch	c45 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c45 */

		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then

			ds_resultado_w			:= 	ds_resultado_w	||
								ie_tipo_evento_w 	|| ';' ||
								ds_tipo_evento_w 	|| ';' ||
								cd_evento_w		|| ';' ||
								ds_evento_w		|| ';' ||
								nm_medico_w		|| ';' ||
								to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;

	end loop;
	close c45;
end if;

if (ie_ocorrencia_retorno_w = 'S') then
	open	c46;
	loop
	fetch	c46 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c46 */

		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then

			ds_resultado_w	:= 	ds_resultado_w		||
						ie_tipo_evento_w 	|| ';' ||
						ds_tipo_evento_w 	|| ';' ||
						cd_evento_w		|| ';' ||
						ds_evento_w		|| ';' ||
						nm_medico_w		|| ';' ||
						to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;

	end loop;
	close c46;
end if;

if (ie_evento_exame_urg_w = 'U') then
	Open	c47;
	Loop
	Fetch	c47 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c47 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
			ds_resultado_w			:= ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	ds_evento_w || ';' ||
									nm_medico_w || ';' ||
	 								to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c47;
end if;


if (IE_EVENTO_SOLIC_COMPRA_w <> 'N') then
open	c48;
loop
fetch	c48 into
	ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		nm_medico_w,
		dt_evento_w,
		desc_compl_w;
	EXIT WHEN NOT FOUND; /* apply on c48 */
	begin
	 --  open c49;
	 --  loop
	 --  fetch c49 into
	 --     itens_solicitacao_w;
	 --  exit when c49%notfound;
	 --    begin
	--	  ds_evento_w:=  substr(ds_evento_w ||' - ' ||itens_solicitacao_w,1,2000);
	   --  end;
	   --end loop;
	   --close c49;
	   if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then
	      begin
		ds_resultado_w			:= substr(ds_resultado_w ||	ie_tipo_evento_w || ';' ||
									ds_tipo_evento_w || ';' ||
									cd_evento_w || ';' ||
								 	Wheb_mensagem_pck.get_Texto(299348) || cd_evento_w || ';'|| -- ds_evento_w || ';' ||
									nm_medico_w || ';' ||
	 								to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';'||
									desc_compl_w || ';;;' || chr(10),1,4000);
	      end;
	   end if;
	end;
end loop;
close c48;
end if;

if (ie_evento_forma_entrega_w = 'S') then
	open	c50;
	loop
	fetch	c50 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c50 */

		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then

			ds_resultado_w	:= 	ds_resultado_w		||
						ie_tipo_evento_w 	|| ';' ||
						ds_tipo_evento_w 	|| ';' ||
						cd_evento_w		|| ';' ||
						ds_evento_w		|| ';' ||
						nm_medico_w		|| ';' ||
						to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;

	end loop;
	close c50;
end if;

if (ie_evento_sc_urgente_w <> 'N') then
	open	c51;
	loop
	fetch	c51 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c51 */

		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then

			ds_resultado_w	:= 	ds_resultado_w		||
						ie_tipo_evento_w 	|| ';' ||
						ds_tipo_evento_w 	|| ';' ||
						cd_evento_w		|| ';' ||
						ds_evento_w		|| ';' ||
						nm_medico_w		|| ';' ||
						to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;

	end loop;
	close c51;
end if;

if (ie_evento_agenda_carater_w <> 'N') then
	open	c52;
	loop
	fetch	c52 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c52 */

		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then

			ds_resultado_w	:= 	ds_resultado_w		||
						ie_tipo_evento_w 	|| ';' ||
						ds_tipo_evento_w 	|| ';' ||
						cd_evento_w		|| ';' ||
						ds_evento_w		|| ';' ||
						nm_medico_w		|| ';' ||
						to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;

	end loop;
	close c52;
end if;

if (ie_evento_lib_receb_pp_w <> 'N') then
	open 	c53;
	loop
	fetch	c53 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c53 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then

			ds_resultado_w := 	ds_resultado_w		||
						ie_tipo_evento_w	|| ';' ||
						ds_tipo_evento_w	|| ';' ||
						cd_evento_w		|| ';' ||
						ds_evento_w		|| ';' ||
						nm_medico_w		|| ';' ||
						to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c53;

end if;

if (ie_evento_higienizacao_leito_w = 'S') then
	open 	c55;
	loop
	fetch	c55 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c55 */
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then

			ds_resultado_w := 	ds_resultado_w		||
						ie_tipo_evento_w	|| ';' ||
						ds_tipo_evento_w	|| ';' ||
						cd_evento_w		|| ';' ||
						ds_evento_w		|| ';' ||
						nm_medico_w		|| ';' ||
						to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end loop;
	close c55;
end if;

if (ie_evento_alta_regra_w = 'S') then

	open	c56;
	loop
	fetch	c56 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c56 */

		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then

			ds_resultado_w	:=	ds_resultado_w	||
						ie_tipo_evento_w || ';' ||
						ds_tipo_evento_w || ';' ||
						cd_evento_w || ';' ||
						ds_evento_w || ';' ||
						nm_medico_w || ';' ||
						to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
			end if;
	end loop;

	close c56;
end if;

open c57;
loop
fetch c57 into
	ie_tipo_evento_w,
	ds_tipo_evento_w,
	cd_evento_w,
	ds_evento_w,
	nm_medico_w,
	dt_evento_w;
EXIT WHEN NOT FOUND; /* apply on c57 */
	begin
		if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then

			ds_resultado_w	:=	ds_resultado_w	||
						ie_tipo_evento_w || ';' ||
						ds_tipo_evento_w || ';' ||
						cd_evento_w || ';' ||
						ds_evento_w || ';' ||
						nm_medico_w || ';' ||
						to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
		end if;
	end;
end loop;
close c57;

if (ie_evento_retorno_ligacao_w = 'S') then
	open c58;
	loop
	fetch c58 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c58 */
		begin
			if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then

				ds_resultado_w	:=	ds_resultado_w	||
							ie_tipo_evento_w || ';' ||
							ds_tipo_evento_w || ';' ||
							cd_evento_w	|| ';'	||
							ds_evento_w || ';' ||
							nm_medico_w ||';'||
							to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
			end if;
		end;
	end loop;
	close c58;
end if;

if (ie_evento_vaga_pend_aprov_w = 'S') then
	open c59;
	loop
	fetch c59 into
		ie_tipo_evento_w,
		ds_tipo_evento_w,
		cd_evento_w,
		ds_evento_w,
		nm_medico_w,
		dt_evento_w;
	EXIT WHEN NOT FOUND; /* apply on c59 */
		begin
			if (coalesce(ds_resultado_w::text, '') = '') or (length(ds_resultado_w) < 3500) then

				ds_resultado_w	:=	ds_resultado_w	||
							ie_tipo_evento_w || ';' ||
							ds_tipo_evento_w || ';' ||
							cd_evento_w	|| ';'	||
							ds_evento_w || ';' ||
							nm_medico_w ||';'||
							to_char(dt_evento_w, 'dd/mm/yyyy hh24:mi:ss') || ';;;;' || chr(10);
			end if;
		end;
	end loop;
	close c59;
end if;

return substr(ds_resultado_w,1,3999);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_evento_usuario ( nm_usuario_p text, ie_filtra_exames_p text) FROM PUBLIC;

