-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_consistir_funcionalidade ( cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, ie_tipo_outorgante_p pls_outorgante.ie_tipo_outorgante%type, ie_sub_tipo_outorgante_p text, ie_acao_p text ) RETURNS varchar AS $body$
DECLARE

--IE_TIPO_OUTORGANTE_P
--1	Administradora
--2	Autogestão
--3	Cooperativa médica
--4	Cooperativa odontológica
--5	Filantropia
--6	Medicina de grupo
--7	Odontologia de grupo
--8	Seguradora especializada
-- IE_SUB_TIPO_OUTORGANTE_P
-- U	Unimed
-- IE_ACAO_P
-- F	Função
-- P	Pasta
ds_retorno_w			varchar(4000) := null;
ie_tipo_outorgante_w		pls_outorgante.ie_tipo_outorgante%type;
cd_cgc_outorgante_w		pls_outorgante.cd_cgc_outorgante%type;
ds_tipo_outorgante_w		varchar(255);
ds_razao_social_w		pessoa_juridica.ds_razao_social%type;


BEGIN

select	max(cd_cgc_outorgante),
	max(ie_tipo_outorgante),
	substr(obter_valor_dominio(1753,max(ie_tipo_outorgante_p)),1,255) ds_tipo_outorgante
into STRICT	cd_cgc_outorgante_w,
	ie_tipo_outorgante_w,
	ds_tipo_outorgante_w
from	pls_outorgante
where	cd_estabelecimento = cd_estabelecimento_p;

if (ie_tipo_outorgante_w != ie_tipo_outorgante_p) then
	ds_retorno_w := obter_texto_dic_objeto( 454237 ,wheb_usuario_pck.get_nr_seq_idioma, 'DS_TIPO_OUTORGANTE=' || ds_tipo_outorgante_w || ';');
end if;

if (coalesce(ds_retorno_w::text, '') = '') and (ie_tipo_outorgante_w = 3) and (ie_sub_tipo_outorgante_p = 'U') then
	select	max(ds_razao_social)
	into STRICT	ds_razao_social_w
	from	pessoa_juridica
	where	cd_cgc	= cd_cgc_outorgante_w;

	if (upper(ds_razao_social_w) not like '%UNIMED%') then
		ds_retorno_w := obter_texto_dic_objeto( 454237 ,wheb_usuario_pck.get_nr_seq_idioma, 'DS_TIPO_OUTORGANTE=' || ds_tipo_outorgante_w || ';');
	end if;
end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_consistir_funcionalidade ( cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, ie_tipo_outorgante_p pls_outorgante.ie_tipo_outorgante%type, ie_sub_tipo_outorgante_p text, ie_acao_p text ) FROM PUBLIC;

