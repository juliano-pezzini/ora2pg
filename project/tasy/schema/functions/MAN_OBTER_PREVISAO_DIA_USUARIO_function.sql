-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION man_obter_previsao_dia_usuario ( dt_previsao_p timestamp, nm_usuario_p text, ie_setor_p text, ie_opcap_p text) RETURNS bigint AS $body$
DECLARE


/*	ie_opcap_p
	QMP	qt_min_previsto;
	QMR	qt_min_realizado;
	QML	qt_min_lanche;
	QMAL	qt_min_almoco;
	QMC	qt_min_carga_horaria;
	QMD	qt_min_diferenca;
	QMA	qt_min_atividade;
	QMT	qt_min_trabalhado;
	QME	qt_min_extra;
	QMAT	qt_atrasada;
	QSAP	qt_sem_ativ_prev;
	QSDP	qt_sem_data_prev;
	QMTT	qt_total_os;		*/
ds_retorno_w			bigint := 0;
qt_min_previsto_w			bigint;
qt_min_realizado_w			bigint;
qt_min_lanche_w			bigint;
qt_min_almoco_w			bigint;
qt_min_carga_horaria_w		bigint;
qt_min_diferenca_w			bigint;
qt_min_atividade_w			bigint;
qt_min_trabalhado_w		bigint;
qt_min_extra_w			bigint;
qt_atrasada_w			bigint;
qt_sem_ativ_prev_w		bigint;
qt_sem_data_prev_w		bigint;
qt_total_os_w			bigint;


BEGIN

begin
select	coalesce(qt_min_previsto,0),
	coalesce(qt_min_realizado,0),
	coalesce(qt_min_lanche,0),
	coalesce(qt_min_almoco,0),
	coalesce(qt_min_carga_horaria,0),
	coalesce(qt_min_diferenca,0),
	coalesce(qt_min_atividade,0),
	coalesce(qt_min_trabalhado,0),
	coalesce(qt_min_extra,0),
	coalesce(qt_atrasada,0),
	coalesce(qt_sem_ativ_prev,0),
	coalesce(qt_sem_data_prev,0),
	coalesce(qt_total_os,0)
into STRICT	qt_min_previsto_w,
	qt_min_realizado_w,
	qt_min_lanche_w,
	qt_min_almoco_w,
	qt_min_carga_horaria_w,
	qt_min_diferenca_w,
	qt_min_atividade_w,
	qt_min_trabalhado_w,
	qt_min_extra_w,
	qt_atrasada_w,
	qt_sem_ativ_prev_w,
	qt_sem_data_prev_w,
	qt_total_os_w
from	man_previsao_dia
where	dt_dia_previsao = dt_previsao_p
and	nm_usuario_prev = nm_usuario_p
and	coalesce(ie_setor_p,coalesce(ie_setor,'0')) = coalesce(ie_setor,'0');

if (ie_opcap_p = 'QMP') then
	ds_retorno_w := qt_min_previsto_w;
elsif (ie_opcap_p = 'QMR') then
	ds_retorno_w := qt_min_realizado_w;
elsif (ie_opcap_p = 'QML') then
	ds_retorno_w := qt_min_lanche_w;
elsif (ie_opcap_p = 'QMAL') then
	ds_retorno_w := qt_min_almoco_w;
elsif (ie_opcap_p = 'QMC') then
	ds_retorno_w := qt_min_carga_horaria_w;
elsif (ie_opcap_p = 'QMD') then
	ds_retorno_w := qt_min_diferenca_w;
elsif (ie_opcap_p = 'QMA') then
	ds_retorno_w := qt_min_atividade_w;
elsif (ie_opcap_p = 'QMT') then
	ds_retorno_w := qt_min_trabalhado_w;
elsif (ie_opcap_p = 'QME') then
	ds_retorno_w := qt_min_extra_w;
elsif (ie_opcap_p = 'QMAT') then
	ds_retorno_w := qt_atrasada_w;
elsif (ie_opcap_p = 'QSAP') then
	ds_retorno_w := qt_sem_ativ_prev_w;
elsif (ie_opcap_p = 'QSDP') then
	ds_retorno_w := qt_sem_data_prev_w;
elsif (ie_opcap_p = 'QMTT') then
	ds_retorno_w := qt_total_os_w;
end if;
exception
when others then
	ds_retorno_w := 0;
end;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION man_obter_previsao_dia_usuario ( dt_previsao_p timestamp, nm_usuario_p text, ie_setor_p text, ie_opcap_p text) FROM PUBLIC;

