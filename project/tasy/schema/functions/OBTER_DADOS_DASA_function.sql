-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_dasa ( cd_estabelecimento_p bigint, ie_tipo_atendimento_p bigint, ie_tipo_informacao_p text ) RETURNS varchar AS $body$
DECLARE

    ds_retorno_w varchar(4000) := NULL;


BEGIN
      DECLARE
                DS_URL_PEDIDO_w                varchar(200);
                DS_URL_RESULTADO_w             varchar(200);
                DS_URL_TOKEN_w                 varchar(200);
                DS_CLIENT_ID_w                 varchar(200);
                DS_CLIENT_SECRET_w             varchar(200);
                DS_USERNAME_w                  varchar(60);
                DS_SIGLS_ESTABELECIMENTO_W     varchar(200);
      begin
            begin
                  select  DS_URL_PEDIDO,
                          DS_URL_RESULTADO,
                          DS_URL_TOKEN,
                          DS_CLIENT_ID,
                          DS_CLIENT_SECRET,
                          DS_USERNAME,
                          DS_SIGLS_ESTABELECIMENTO

                  into STRICT    DS_URL_PEDIDO_w,
                          DS_URL_RESULTADO_w,
                          DS_URL_TOKEN_w,
                          DS_CLIENT_ID_w,
                          DS_CLIENT_SECRET_w,
                          DS_USERNAME_W,
                          DS_SIGLS_ESTABELECIMENTO_W
                  FROM lab_integracao_dasa
                  WHERE cd_estabelecimento =cd_estabelecimento_p
                  AND ie_tipo_atendimento = ie_tipo_atendimento_p;

              EXCEPTION WHEN no_data_found then

                 select DS_URL_PEDIDO,
                        DS_URL_RESULTADO,
                        DS_URL_TOKEN,
                        DS_CLIENT_ID,
                        DS_CLIENT_SECRET,
                        DS_USERNAME,
                        DS_SIGLS_ESTABELECIMENTO

                 into STRICT   DS_URL_PEDIDO_w,
                        DS_URL_RESULTADO_w,
                        DS_URL_TOKEN_w,
                        DS_CLIENT_ID_w,
                        DS_CLIENT_SECRET_w,
                        DS_USERNAME_w,
                        DS_SIGLS_ESTABELECIMENTO_W
                 FROM lab_integracao_dasa
                 WHERE cd_estabelecimento =cd_estabelecimento_p
                 AND coalesce(ie_tipo_atendimento::text, '') = '';
            end;

      if (ie_tipo_informacao_p = 'A') then
          return DS_URL_TOKEN_w||','||DS_CLIENT_ID_w||','||DS_CLIENT_SECRET_w;
        elsif (ie_tipo_informacao_p = 'P') then
          return DS_URL_PEDIDO_w;
        elsif (ie_tipo_informacao_p = 'R') then
          return DS_URL_RESULTADO_w;
        elsif (ie_tipo_informacao_p = 'USERNAME') then
          return DS_USERNAME_w;
        elsif (ie_tipo_informacao_p = 'SIGLA') then
          return DS_SIGLS_ESTABELECIMENTO_W;
      end if;
    end;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_dasa ( cd_estabelecimento_p bigint, ie_tipo_atendimento_p bigint, ie_tipo_informacao_p text ) FROM PUBLIC;

