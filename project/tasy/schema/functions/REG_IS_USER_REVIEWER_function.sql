-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION reg_is_user_reviewer ( nr_seq_revision_p bigint, nm_usuario_p text, ie_tipo_revisor_p text ) RETURNS varchar AS $body$
DECLARE


nm_author_w			reg_doc_revisor.nm_usuario_revisor%type;
ie_user_reviewer_w		varchar(1);


BEGIN

if (ie_tipo_revisor_p = 'C') then

	select	reg_fetch_revision_author(nr_seq_revision_p)
	into STRICT	nm_author_w
	;

	select	CASE WHEN count(1)=0 THEN  'N'  ELSE 'S' END
	into STRICT	ie_user_reviewer_w
	from	reg_version_revision
	where	nr_sequencia = nr_seq_revision_p
	and (nm_author_w = nm_usuario_p or reg_doc_has_user_delegation(nr_seq_documento, 'C', nm_author_w, nm_usuario_p) = 'S');

else

	select	CASE WHEN count(1)=0 THEN  'N'  ELSE 'S' END
	into STRICT	ie_user_reviewer_w
	from	reg_version_revision vr,
		reg_version_approvers va
	where	vr.nr_sequencia = va.nr_seq_revision
	and	vr.nr_sequencia = nr_seq_revision_p
	and (va.nm_approver = nm_usuario_p or reg_doc_has_user_delegation(vr.nr_seq_documento, ie_tipo_revisor_p, va.nm_approver, nm_usuario_p) = 'S')
	and	va.ie_approver_type = ie_tipo_revisor_p;

end if;

return ie_user_reviewer_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION reg_is_user_reviewer ( nr_seq_revision_p bigint, nm_usuario_p text, ie_tipo_revisor_p text ) FROM PUBLIC;

