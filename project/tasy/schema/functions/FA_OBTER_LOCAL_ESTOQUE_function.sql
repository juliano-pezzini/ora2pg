-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION fa_obter_local_estoque (nm_computador_p text, nr_atendimento_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint) RETURNS bigint AS $body$
DECLARE

			 
cd_local_estoque_w	integer;			
vl_parametro_w		varchar(255);

BEGIN
vl_parametro_w := Obter_Param_Usuario(10015, 63, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p, vl_parametro_w);	
 
if (vl_parametro_w = 'C') then 
	select	coalesce(max(cd_local_estoque),0) 
	into STRICT	cd_local_estoque_w 
	from  	local_estoque_computador b, 
		computador a 
	where 	a.nr_sequencia = b.nr_seq_computador 
	and  	a.nm_computador_pesquisa = padronizar_nome(upper(nm_computador_p));
end if;
 
if (vl_parametro_w = 'P') then 
	select	coalesce(max(obter_local_estoque_setor(a.cd_setor_atendimento,cd_estabelecimento_p)),0) 
	into STRICT	cd_local_estoque_w 
	from  	setor_atendimento a	 
	where	obter_setor_atendimento(nr_atendimento_p) = (a.cd_setor_atendimento);
	 
end if;
	 
if (vl_parametro_w = 'U') then 
	select	coalesce(max(obter_local_estoque_setor(b.cd_setor_atendimento,cd_estabelecimento_p)),0) 
	into STRICT	cd_local_estoque_w 
	from  	usuario a, 
		setor_atendimento b 
	where  a.cd_setor_atendimento = b.cd_setor_atendimento 
	and   a.nm_usuario = nm_usuario_p;
end if;
return	cd_local_estoque_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION fa_obter_local_estoque (nm_computador_p text, nr_atendimento_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint) FROM PUBLIC;

