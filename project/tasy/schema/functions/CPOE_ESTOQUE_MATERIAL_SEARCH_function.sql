-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cpoe_estoque_material_search ( cd_material_p material_order_type.cd_material%TYPE, nm_usuario_p text, cd_setor_atendimento_p bigint, ismedicineinstock_p text) RETURNS varchar AS $body$
DECLARE

  nr_count_w smallint;

BEGIN
    IF ( ismedicineinstock_p = 'S' ) THEN
      SELECT Count(*)
      INTO STRICT   nr_count_w
      FROM   movimento_estoque
      WHERE  cd_local_estoque IN((SELECT cd_local_estoque
                                  FROM   setor_atendimento
                                  WHERE
             cd_setor_atendimento IN ( cd_setor_atendimento_p )

UNION

                                  SELECT cd_local_estoque
                                  FROM   setor_local
                                  WHERE
             cd_setor_atendimento IN ( cd_setor_atendimento_p )))
             AND cd_material = cd_material_p;

      IF ( nr_count_w = 0 ) THEN
        RETURN 'N';
      END IF;
    END IF;

    RETURN 'S';
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_estoque_material_search ( cd_material_p material_order_type.cd_material%TYPE, nm_usuario_p text, cd_setor_atendimento_p bigint, ismedicineinstock_p text) FROM PUBLIC;

