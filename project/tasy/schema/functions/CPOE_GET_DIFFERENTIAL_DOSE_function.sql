-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cpoe_get_differential_dose ( ds_dose_diferenciada_p text default null) RETURNS varchar AS $body$
DECLARE

  ds_dose_diferenciada_w varchar(20);
  ds_diff_dose_w         varchar(200);
  nr_seq_level 			 smallint;WITH RECURSIVE cte AS (

  c01 CURSOR FOR
    SELECT level id, regexp_substr(ds_dose_diferenciada_p, '[^-]+', 1, level) as data

      (regexp_substr(ds_dose_diferenciada_p, '[^-]+', 1, level) IS NOT NULL AND (regexp_substr(ds_dose_diferenciada_p, '[^-]+', 1, level))::text <> '')  UNION ALL

  c01 CURSOR FOR
    SELECT level id, regexp_substr(ds_dose_diferenciada_p, '[^-]+', 1, level) as data
    
      (regexp_substr(ds_dose_diferenciada_p, '[^-]+', 1, level) IS NOT NULL AND (regexp_substr(ds_dose_diferenciada_p, '[^-]+', 1, level))::text <> '') JOIN cte c ON ()

) SELECT * FROM cte;
;

BEGIN
  open c01;
  loop
    fetch c01 into nr_seq_level, ds_dose_diferenciada_w;
    EXIT WHEN NOT FOUND; /* apply on c01 */
    begin
      if (ds_dose_diferenciada_w IS NOT NULL AND ds_dose_diferenciada_w::text <> '') then
        if (nr_seq_level          =1) then
          ds_diff_dose_w        := '['||ds_dose_diferenciada_w|| ']';
        else
          ds_diff_dose_w := ds_diff_dose_w||' ['||ds_dose_diferenciada_w|| ']';
        end if;
      end if;
    end;
  end loop;
close c01;
return ds_diff_dose_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_get_differential_dose ( ds_dose_diferenciada_p text default null) FROM PUBLIC;

