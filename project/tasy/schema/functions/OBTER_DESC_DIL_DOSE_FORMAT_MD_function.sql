-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_desc_dil_dose_format_md ( ie_user_local_p text, ds_material_p text, qt_dose_mat_str_p bigint, nr_casas_diluicao_p bigint, ds_uom_p text, qt_dose_p bigint, cd_uni_medida_p text, desc_material_p text, ds_mat_comp_p text, qt_dose_dil_p bigint, ds_ml_p text, ds_item_concat_p text ) RETURNS varchar AS $body$
DECLARE

  ds_item_concat_w varchar(2000) := ds_item_concat_p;
  qt_resul_calc_w  varchar(20);
  ds_mat_comp_w    varchar(2000);

BEGIN

	if (ie_user_local_p <> 'en_AU') then
		if (coalesce(qt_dose_mat_str_p, 0) > 0) or (coalesce(qt_dose_p, 0) > 0) then

      if (coalesce(qt_dose_mat_str_p, 0) > 0) then
  			
  			qt_resul_calc_w := formatar_dosage_md(round(qt_dose_mat_str_p, nr_casas_diluicao_p));
  			
  			ds_item_concat_w := ds_item_concat_w || ' ' || qt_resul_calc_w || ' '|| ds_uom_p ||' ';
  		else
  			
  			qt_resul_calc_w := formatar_dosage_md(qt_dose_p);
  		
  			ds_item_concat_w := ds_item_concat_w || ' ' || qt_resul_calc_w || ' ' || cd_uni_medida_p || ' ';
  		end if;

  	  ds_item_concat_w := ds_item_concat_w || wheb_mensagem_pck.get_texto(307090) || ' ' || desc_material_p;
    else

      ds_mat_comp_w := ds_mat_comp_p;

      if (substr(ds_mat_comp_w, 1, 1) = ',') then
          ds_mat_comp_w := substr(ds_mat_comp_w, 2, length(ds_mat_comp_w));
      elsif (substr(ds_mat_comp_w, 1, length(wheb_mensagem_pck.get_texto(309413))+1) = ' '||wheb_mensagem_pck.get_texto(309413)) then
          ds_mat_comp_w := substr(ds_mat_comp_w, length(wheb_mensagem_pck.get_texto(309413))+2, length(ds_mat_comp_w));
      end if;

    end if;

    ds_item_concat_w := ds_item_concat_w || coalesce(ds_mat_comp_w, ds_mat_comp_p);
	
	    qt_resul_calc_w := formatar_dosage_md(round(qt_dose_dil_p, nr_casas_diluicao_p));		

		ds_item_concat_w := ds_item_concat_w || ' ' || wheb_mensagem_pck.get_texto(307087) || ' ' || qt_resul_calc_w || ' ' || ds_ml_p
						                     || ' ' || wheb_mensagem_pck.get_texto(307090) || ' ' ||ds_material_p;
	end if;
	
	return ds_item_concat_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_desc_dil_dose_format_md ( ie_user_local_p text, ds_material_p text, qt_dose_mat_str_p bigint, nr_casas_diluicao_p bigint, ds_uom_p text, qt_dose_p bigint, cd_uni_medida_p text, desc_material_p text, ds_mat_comp_p text, qt_dose_dil_p bigint, ds_ml_p text, ds_item_concat_p text ) FROM PUBLIC;

