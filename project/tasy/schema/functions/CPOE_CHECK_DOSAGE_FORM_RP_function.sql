-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cpoe_check_dosage_form_rp ( cd_material_insert_p bigint, cd_material_to_compare_p bigint) RETURNS varchar AS $body$
DECLARE


ie_uso_forma_farm_insert_w				varchar(1);
ie_uso_forma_farm_compare_w				varchar(1);
ds_retorno_w                            varchar(4000) := null;
ds_forma_medic_w 						varchar(255);
ds_forma_rp_w 							varchar(255);


BEGIN
    begin
        select  tipo.ie_uso_forma_farm,
                obter_valor_dominio(5702, tipo.ie_uso_forma_farm)
        into STRICT	ie_uso_forma_farm_insert_w,
                ds_forma_medic_w
        from    forma_farm_tipo tipo,
                anvisa_forma_formaceutica anvisa,
                material
        where   material.nr_seq_forma_farm = anvisa.nr_sequencia
        and     anvisa.nr_sequencia = tipo.nr_seq_forma_farm
        and     material.cd_material = cd_material_insert_p;

        select  tipo.ie_uso_forma_farm,
                obter_valor_dominio(5702, tipo.ie_uso_forma_farm)
        into STRICT	ie_uso_forma_farm_compare_w,
                ds_forma_rp_w
        from    forma_farm_tipo tipo,
                anvisa_forma_formaceutica anvisa,
                material
        where   material.nr_seq_forma_farm = anvisa.nr_sequencia
        and     anvisa.nr_sequencia = tipo.nr_seq_forma_farm
        and     material.cd_material = cd_material_to_compare_p;

        if (ie_uso_forma_farm_insert_w != ie_uso_forma_farm_compare_w) then    
            ds_retorno_w := wheb_mensagem_pck.get_texto(1172636, 'DS_FORMA_MEDIC=' || ds_forma_medic_w || ';DS_FORMA_RP=' || ds_forma_rp_w);
        end if;

    exception when others then
        return ds_retorno_w;
    end;

    return ds_retorno_w;
	
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_check_dosage_form_rp ( cd_material_insert_p bigint, cd_material_to_compare_p bigint) FROM PUBLIC;

