-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION san_obter_lotes_reagentes ( nr_seq_exame_lote_p bigint, nr_seq_exame_p bigint ) RETURNS varchar AS $body$
DECLARE

 
			 
ds_lotes_w		varchar(2000) := '';
ds_lote_w		varchar(255);
nr_seq_lote_fornec_w	bigint;	
 
c01 CURSOR FOR 
	SELECT	nr_seq_lote_fornec 
	from	san_reagentes_exame 
	where	nr_seq_exame	=	nr_seq_exame_p 
	order by 1;
			

BEGIN 
 
if (nr_seq_exame_lote_p IS NOT NULL AND nr_seq_exame_lote_p::text <> '' AND nr_seq_exame_p IS NOT NULL AND nr_seq_exame_p::text <> '') then 
 
	open C01;
	loop 
	fetch C01 into	 
		nr_seq_lote_fornec_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */
		begin 
		if (nr_seq_lote_fornec_w IS NOT NULL AND nr_seq_lote_fornec_w::text <> '') then 
			ds_lote_w := substr(Obter_dados_lote_fornec(nr_seq_lote_fornec_w,'D'),1,255);
			if (ds_lote_w IS NOT NULL AND ds_lote_w::text <> '') then 
				ds_lotes_w := ds_lotes_w || ds_lote_w || ',';
			end if;
		end if;
		end;
	end loop;
	close C01;
	 
	ds_lote_w := obter_lote_reagente(nr_seq_exame_lote_p, nr_seq_exame_p);
	 
	if (ds_lote_w IS NOT NULL AND ds_lote_w::text <> '') then 
		ds_lotes_w:= ds_lotes_w || ds_lote_w || ',';
	end if;
	 
	if (ds_lotes_w IS NOT NULL AND ds_lotes_w::text <> '') then 
		ds_lotes_w := substr(substr(ds_lotes_w,1, length(ds_lotes_w)-1),1,255);
	end if;
	 
 
end if;
 
return	substr(ds_lotes_w,1,255);
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION san_obter_lotes_reagentes ( nr_seq_exame_lote_p bigint, nr_seq_exame_p bigint ) FROM PUBLIC;

