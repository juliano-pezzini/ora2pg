-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION is_valid_doc_section_apap (NR_SEQUENCIA_P DOCUMENTO_SECAO.NR_SEQUENCIA%TYPE) RETURNS varchar AS $body$
DECLARE

    IS_VALID_W  DOCUMENTO_SECAO.IE_CHART_VIEW%TYPE;

C_SUBSECTION CURSOR FOR
    SELECT
                CASE
                    WHEN SEC.IE_CHART_VIEW = 'S' AND coalesce(SUB.IE_PLOT_STYLE::text, '') = '' THEN 'N'
                    ELSE 'S'
                END IS_VALID
    FROM        DOCUMENTO_SECAO SEC
    INNER JOIN  DOCUMENTO_SUBSECAO SUB ON (SUB.NR_SEQ_DOCUMENTO_SECAO = SEC.NR_SEQUENCIA)
    WHERE       SEC.NR_SEQUENCIA = NR_SEQUENCIA_P
    AND         coalesce(SUB.NR_SEQ_SUPERIOR::text, '') = ''
    ORDER BY    IS_VALID DESC;

BEGIN
    FOR R_SUBSECTION IN C_SUBSECTION
    LOOP
        IS_VALID_W := R_SUBSECTION.IS_VALID;
        IF (IS_VALID_W = 'S') THEN
            EXIT;
        END IF;
    END LOOP;

    RETURN IS_VALID_W;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION is_valid_doc_section_apap (NR_SEQUENCIA_P DOCUMENTO_SECAO.NR_SEQUENCIA%TYPE) FROM PUBLIC;

