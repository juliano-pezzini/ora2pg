-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_intervencoes_sae ( NR_SEQUENCIA_P bigint) RETURNS varchar AS $body$
DECLARE

 
QUEBRA_W		varchar(10) := CHR(13)||CHR(10);
DS_RETORNO_W		varchar(400);
DS_PROCEDIMENTO_W	varchar(400);
			
 
C01 CURSOR FOR 
SELECT 	DS_PROCEDIMENTO 
FROM  	PE_PRESCR_PROC A, 
	PE_PROCEDIMENTO B, 
	PE_PRESCRICAO C 
WHERE 	C.NR_SEQUENCIA = NR_SEQUENCIA_P 
AND	A.NR_SEQ_PROC = B.NR_SEQUENCIA 
AND	A.NR_SEQ_PRESCR = C.NR_SEQUENCIA;

 

BEGIN 
 
OPEN C01;	
LOOP 
FETCH C01 INTO 
	DS_PROCEDIMENTO_W;
EXIT WHEN NOT FOUND; /* apply on C01 */
	BEGIN 
	BEGIN 
	IF (coalesce(DS_RETORNO_W::text, '') = '') THEN 
		DS_RETORNO_W:= DS_PROCEDIMENTO_W;
	ELSE 
		DS_RETORNO_W := DS_RETORNO_W || QUEBRA_W ||DS_PROCEDIMENTO_W;
	END IF;	
	EXCEPTION 
	WHEN OTHERS THEN 
		DS_RETORNO_W	:= DS_RETORNO_W|| SUBSTR(DS_PROCEDIMENTO_W,4,3000||QUEBRA_W||DS_RETORNO_W);
	END;
	END;	
END LOOP;
CLOSE C01;
 
RETURN 	SUBSTR(DS_RETORNO_W,1,3000);
 
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_intervencoes_sae ( NR_SEQUENCIA_P bigint) FROM PUBLIC;

