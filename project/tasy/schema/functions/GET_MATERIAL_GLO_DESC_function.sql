-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_material_glo_desc (cd_material_glo_p material_global.cd_material_glo%type) RETURNS MATERIAL_GLOBAL.DS_MATERIAL_GLO%TYPE AS $body$
DECLARE


vl_retorno_w            material_global.ds_material_glo%type;
cd_material_w           material_global.cd_material_glo%type;

nm_material_w           material_global.ds_material_glo%type;
form_presentation_w     forma_apres_matglobal.ds_forma_apresentacao%type;
unit_measure_w          unidade_medida_matglobal.ds_unidade%type;
route_administration_w  viaadm_matglobal.ds_via_adm%type;
concentration_w         concentracao_matglobal.ds_concentracao%type;


BEGIN
vl_retorno_w := null;
cd_material_w := cd_material_glo_p;

    if (cd_material_w IS NOT NULL AND cd_material_w::text <> '') then

        select      max(m.DS_MATERIAL_GLO),
                    max(f.ds_forma_apresentacao),
                    max(u.ds_unidade),
                    max(v.ds_via_adm),
                    max(c.ds_concentracao)
        into STRICT        nm_material_w,
                    form_presentation_w,
                    unit_measure_w,
                    route_administration_w,
                    concentration_w
        FROM material_global m
LEFT OUTER JOIN forma_apres_matglobal f ON (m.cd_forma_apresentacao = f.cd_forma_apresentacao)
LEFT OUTER JOIN unidade_medida_matglobal u ON (m.cd_unidade = u.cd_unidade)
LEFT OUTER JOIN viaadm_matglobal v ON (m.cd_via_adm = v.cd_via_adm)
LEFT OUTER JOIN concentracao_matglobal c ON (m.cd_concentracao = c.cd_concentracao)
WHERE m.cd_material_glo = cd_material_w;

        if (nm_material_w IS NOT NULL AND nm_material_w::text <> '') then
            vl_retorno_w := nm_material_w;
        end if;

        if (form_presentation_w IS NOT NULL AND form_presentation_w::text <> '') then
            vl_retorno_w := vl_retorno_w || ' ' ||  form_presentation_w;
        end if;

        if (unit_measure_w IS NOT NULL AND unit_measure_w::text <> '') then
            vl_retorno_w :=  vl_retorno_w || ' ' || unit_measure_w;
        end if;

        if (route_administration_w IS NOT NULL AND route_administration_w::text <> '') then
            vl_retorno_w  :=  vl_retorno_w || ' ' || route_administration_w;
        end if;

        if (concentration_w IS NOT NULL AND concentration_w::text <> '') then
            vl_retorno_w :=  vl_retorno_w || ' ' || concentration_w;
        end if;

    end if;


RETURN vl_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_material_glo_desc (cd_material_glo_p material_global.cd_material_glo%type) FROM PUBLIC;

