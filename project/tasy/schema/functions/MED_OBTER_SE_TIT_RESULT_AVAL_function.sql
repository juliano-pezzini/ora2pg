-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION med_obter_se_tit_result_aval (nr_seq_avaliacao_p bigint, nr_seq_tipo_aval_p bigint, nr_seq_titulo_p bigint) RETURNS varchar AS $body$
DECLARE


ds_retorno_w		varchar(01);
nr_seq_item_niv1_w	bigint;
nr_seq_item_niv2_w	bigint;
nr_seq_item_niv3_w	bigint;
nr_seq_item_niv4_w	bigint;
nr_seq_item_niv5_w	bigint;

c01 CURSOR FOR
	SELECT	nr_sequencia
	from	med_item_avaliar
	where	nr_seq_tipo	= nr_seq_tipo_aval_p
	and	nr_seq_superior	= nr_seq_titulo_p;

c02 CURSOR FOR
	SELECT	nr_sequencia
	from	med_item_avaliar
	where	nr_seq_tipo	= nr_seq_tipo_aval_p
	and	nr_seq_superior	= nr_seq_item_niv1_w;

c03 CURSOR FOR
	SELECT	nr_sequencia
	from	med_item_avaliar
	where	nr_seq_tipo	= nr_seq_tipo_aval_p
	and	nr_seq_superior	= nr_seq_item_niv2_w;

c04 CURSOR FOR
	SELECT	nr_sequencia
	from	med_item_avaliar
	where	nr_seq_tipo	= nr_seq_tipo_aval_p
	and	nr_seq_superior	= nr_seq_item_niv3_w;

c05 CURSOR FOR
	SELECT	nr_sequencia
	from	med_item_avaliar
	where	nr_seq_tipo	= nr_seq_tipo_aval_p
	and	nr_seq_superior	= nr_seq_item_niv4_w;


BEGIN

ds_retorno_w	:= 'N';

open	c01;
loop
fetch	c01 into nr_seq_item_niv1_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin

	select	coalesce(max('S'), 'N')
	into STRICT	ds_retorno_w
	from	med_avaliacao_result
	where	nr_seq_avaliacao	= nr_seq_avaliacao_p
	and	nr_seq_item		= nr_seq_item_niv1_w;

	if (ds_retorno_w	= 'S') then
		exit;
	elsif (ds_retorno_w	= 'N') then
		begin

		open	c02;
		loop

		fetch	c02 into nr_seq_item_niv2_w;
		EXIT WHEN NOT FOUND; /* apply on c02 */
			begin

			select	coalesce(max('S'), 'N')
			into STRICT	ds_retorno_w
			from	med_avaliacao_result
			where	nr_seq_avaliacao	= nr_seq_avaliacao_p
			and	nr_seq_item		= nr_seq_item_niv2_w;

			if (ds_retorno_w	= 'S') then
				exit;
			elsif (ds_retorno_w	= 'N') then
				begin

				open	c03;
				loop

				fetch	c03 into nr_seq_item_niv3_w;
				EXIT WHEN NOT FOUND; /* apply on c03 */
					begin

					select	coalesce(max('S'), 'N')
					into STRICT	ds_retorno_w
					from	med_avaliacao_result
					where	nr_seq_avaliacao	= nr_seq_avaliacao_p
					and	nr_seq_item		= nr_seq_item_niv3_w;

					if (ds_retorno_w	= 'S') then
						exit;
					elsif (ds_retorno_w	= 'N') then
						begin

						open	c04;
						loop

						fetch	c04 into nr_seq_item_niv4_w;
						EXIT WHEN NOT FOUND; /* apply on c04 */
							begin

							select	coalesce(max('S'), 'N')
							into STRICT	ds_retorno_w
							from	med_avaliacao_result
							where	nr_seq_avaliacao	= nr_seq_avaliacao_p
							and	nr_seq_item		= nr_seq_item_niv4_w;


							if (ds_retorno_w	= 'S') then
								exit;
							elsif (ds_retorno_w	= 'N') then
								begin

								open	c05;
								loop

								fetch	c05 into nr_seq_item_niv5_w;
								EXIT WHEN NOT FOUND; /* apply on c05 */
									begin

									select	coalesce(max('S'), 'N')
									into STRICT	ds_retorno_w
									from	med_avaliacao_result
									where	nr_seq_avaliacao	= nr_seq_avaliacao_p
									and	nr_seq_item		= nr_seq_item_niv5_w;


								end;
								end loop;
								close c05;
								end;
							end if;

							end;
						end loop;

						close c04;

						end;
					end if;

					end;
				end loop;
				close c03;

				end;
			end if;
			end;
		end loop;
		close c02;
		end;
	end if;

	end;
end loop;
close c01;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION med_obter_se_tit_result_aval (nr_seq_avaliacao_p bigint, nr_seq_tipo_aval_p bigint, nr_seq_titulo_p bigint) FROM PUBLIC;

