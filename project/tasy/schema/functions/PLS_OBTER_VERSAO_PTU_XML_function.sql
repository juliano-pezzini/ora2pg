-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_versao_ptu_xml (ie_tipo_ptu_w text) RETURNS varchar AS $body$
DECLARE


 nr_versao_xml_w   varchar(5);
 nr_versao_xml_conf_w integer;


BEGIN

-- se for do tipo A500
case	ie_tipo_ptu_w 
	when 'A500' then

		-- busca a configuracao na gestao de operadora
		nr_versao_xml_conf_w := somente_numero(ds_campo_p => ptu_batch_xml_pck.obter_versao_dominio(	cd_estabelecimento_p 	=> wheb_usuario_pck.get_cd_estabelecimento,
														nr_seq_congenere_p   	=>  null,
														cd_cooperativa_p    	=>  null,
														dt_referencia_p     	=>  clock_timestamp(),
														ie_tipo_ptu_p       	=>  'A500'));

		-- faz a conversao da configuracao para o valor da versao do manual do PTU XML
		case	nr_versao_xml_conf_w
			when 10 then nr_versao_xml_w := '01';
			when 11 then nr_versao_xml_w := '02';
			when 20 then nr_versao_xml_w := '03';
		end case;

	-- se for A550
	when 'A550' then

		-- busca a configuracao na gestao de operadora
		nr_versao_xml_conf_w := somente_numero(ds_campo_p => ptu_batch_xml_pck.obter_versao_dominio(	cd_estabelecimento_p 	=> wheb_usuario_pck.get_cd_estabelecimento,
														nr_seq_congenere_p   	=>  null,
														cd_cooperativa_p    	=>  null,
														dt_referencia_p     	=>  clock_timestamp(),
														ie_tipo_ptu_p       	=>  'A550'));

		-- faz a conversao da configuracao para o valor da versao do manual do PTU XML
		case	nr_versao_xml_conf_w
			when 10 then nr_versao_xml_w := '01';
			when 11 then nr_versao_xml_w := '02';
			when 20 then nr_versao_xml_w := '03';
		end case;

	-- se for A560
	when 'A560' then

		-- busca a configuracao na gestao de operadora
		nr_versao_xml_conf_w := somente_numero(ds_campo_p => ptu_batch_xml_pck.obter_versao_dominio(	cd_estabelecimento_p 	=> wheb_usuario_pck.get_cd_estabelecimento,
														nr_seq_congenere_p   	=>  null,
														cd_cooperativa_p    	=>  null,
														dt_referencia_p     	=>  clock_timestamp(),
														ie_tipo_ptu_p       	=>  'A560'));

		-- faz a conversao da configuracao para o valor da versao do manual do PTU XML
		case	nr_versao_xml_conf_w
			when 10 then nr_versao_xml_w := '01';
			when 11 then nr_versao_xml_w := '02';
		end case;

end case;

return nr_versao_xml_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_versao_ptu_xml (ie_tipo_ptu_w text) FROM PUBLIC;

