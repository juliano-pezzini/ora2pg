-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_conv_url_valid_usuario ( cd_convenio_p bigint, ie_tipo_atendimento_p bigint, nr_seq_classif_atend_p bigint, cd_estabelecimento_p bigint, cod_usuario_p text) RETURNS varchar AS $body$
DECLARE

 
ds_retorno_w	varchar(4000);
ds_url_w		varchar(255);
cd_interno_w	varchar(15);


BEGIN 
 
	select 	coalesce(max(ds_url),'X') 
	into STRICT	ds_url_w 
	from 	conv_url_valid_usuario 
	where 	cd_convenio = cd_convenio_p 
	and 	cd_estabelecimento = cd_estabelecimento_p 
	and	coalesce(ie_tipo_atendimento,ie_tipo_atendimento_p) 	= ie_tipo_atendimento_p	 
	and 	coalesce(nr_seq_classif_atend,nr_seq_classif_atend_p) 	= nr_seq_classif_atend_p 
	and 	coalesce(ie_situacao,'A') = 'A';
	 
	select 	coalesce(max(cd_interno),0) 
	into STRICT	cd_interno_w 
	from 	convenio_estabelecimento 
	where 	cd_convenio 	 = cd_convenio_p 
	and 	cd_estabelecimento = cd_estabelecimento_p;	
 
begin 
if (coalesce(ds_url_w,'X') <> 'X') then 
	ds_retorno_w := ds_url_w;
	ds_retorno_w := replace_macro(ds_retorno_w,'@cod_interno', cd_interno_w);
	ds_retorno_w := replace_macro(ds_retorno_w,'@cod_usuario', cod_usuario_p);
end if;
exception 
when others then 
	ds_retorno_w	:= null;
end;
 
return	ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_conv_url_valid_usuario ( cd_convenio_p bigint, ie_tipo_atendimento_p bigint, nr_seq_classif_atend_p bigint, cd_estabelecimento_p bigint, cod_usuario_p text) FROM PUBLIC;

