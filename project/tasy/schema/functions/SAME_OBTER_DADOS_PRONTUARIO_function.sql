-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION same_obter_dados_prontuario ( nr_seq_prontuario_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE

					 
cd_pessoa_fisica_w	varchar(10);
nr_atendimento_w	bigint;
ie_tipo_w		varchar(5);
ie_status_w		varchar(5);
dt_periodo_inicial_w	timestamp;
dt_periodo_final_w	timestamp;
ds_status_w		varchar(40);
ds_tipo_w		varchar(40);
nm_pessoa_fisica_w	varchar(60);
ds_tipo_atendimento_w	varchar(40);
nr_prontuario_w		varchar(40);
ds_local_same_w		varchar(50);

ds_retorno_w		varchar(80)	:= '';


BEGIN 
 
select	max(cd_pessoa_fisica), 
	max(nr_atendimento), 
	max(ie_tipo), 
	max(ie_status), 
	max(dt_periodo_inicial), 
	max(dt_periodo_final), 
	max(substr(obter_valor_dominio(1220,ie_status),1,40)), 
	max(substr(obter_valor_dominio(1219,ie_tipo),1,40)), 
	max(substr(obter_nome_pf(cd_pessoa_fisica),1,60)), 
	max(substr(obter_tipo_atendimento(nr_atendimento),1,40)), 
	max(substr(obter_prontuario_paciente(cd_pessoa_fisica),1,40)), 
	max(substr(Obter_Desc_Local_Same(nr_seq_local),1,50)) 
into STRICT	cd_pessoa_fisica_w, 
	nr_atendimento_w, 
	ie_tipo_w, 
	ie_status_w, 
	dt_periodo_inicial_w, 
	dt_periodo_final_w, 
	ds_status_w, 
	ds_tipo_w, 
	nm_pessoa_fisica_w, 
	ds_tipo_atendimento_w, 
	nr_prontuario_w, 
	ds_local_same_w 
from	same_prontuario 
where	nr_sequencia	= nr_seq_prontuario_p;
 
if (ie_opcao_p = 'CP') then 
	ds_retorno_w	:= cd_pessoa_fisica_w;
elsif (ie_opcao_p = 'NP') then 
	ds_retorno_w	:= nm_pessoa_fisica_w;
elsif (ie_opcao_p = 'NA') then 
	ds_retorno_w	:= nr_atendimento_w;
elsif (ie_opcao_p = 'TP') then 
	ds_retorno_w	:= ie_tipo_w;
elsif (ie_opcao_p = 'ST') then 
	ds_retorno_w	:= ie_status_w;
elsif (ie_opcao_p = 'DI') then 
	ds_retorno_w	:= to_char(dt_periodo_inicial_w, 'dd/mm/yyyy');
elsif (ie_opcao_p = 'DF') then 
	ds_retorno_w	:= to_char(dt_periodo_final_w, 'dd/mm/yyyy');
elsif (ie_opcao_p = 'SS') then 
	ds_retorno_w	:= ds_status_w;
elsif (ie_opcao_p = 'SP') then 
	ds_retorno_w	:= ds_tipo_w;
elsif (ie_opcao_p = 'NP') then 
	ds_retorno_w	:= ds_tipo_atendimento_w;
elsif (ie_opcao_p = 'NP') then 
	ds_retorno_w	:= nr_prontuario_w;	
elsif (ie_opcao_p = 'LS') then 
	ds_retorno_w	:= ds_local_same_w;
end if;
 
 
return	ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION same_obter_dados_prontuario ( nr_seq_prontuario_p bigint, ie_opcao_p text) FROM PUBLIC;

