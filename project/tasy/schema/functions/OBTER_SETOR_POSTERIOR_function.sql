-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_setor_posterior ( nr_atendimento_p bigint, dt_entrada_unidade_p timestamp) RETURNS varchar AS $body$
DECLARE

 
cd_setor_w		varchar(80);
ds_setor_w		varchar(80);
ds_retorno_w		varchar(2000);	
 
 
C01 CURSOR FOR 
SELECT	substr(obter_nome_setor(cd_setor_atendimento),1,50) 
from 	atend_paciente_unidade 
where	nr_atendimento		= nr_atendimento_p 
and	dt_entrada_unidade	> dt_entrada_unidade_p 
and	obter_classif_setor(cd_setor_atendimento) = 3 
order by 
	dt_entrada_unidade desc;


BEGIN 
 
open C01;
loop	 
	fetch C01 into 
		ds_setor_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */
end loop;
close C01;
 
 
if (coalesce(ds_setor_w::text, '') = '') then 
	ds_retorno_w := substr(obter_Motivo_Alta_Atend(nr_atendimento_p),1,50);
else 
	ds_retorno_w := ds_setor_w;
end if;
 
 
return	ds_retorno_w;
 
 
end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_setor_posterior ( nr_atendimento_p bigint, dt_entrada_unidade_p timestamp) FROM PUBLIC;

