-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_dados_partic_pos (nr_seq_partic_p bigint, nr_seq_partic_pos_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


ds_retorno_w		varchar(400);
nr_seq_partic_pos_w		bigint;

--	IE_OPCAO_P

-- VC	-	vl_calculado

-- VL	-	vl_liberado

-- NMM	-	Nome do medico

-- GRP	-	Grau de participacao
									

BEGIN
if (coalesce(nr_seq_partic_pos_p::text, '') = '') then
	select	max(nr_sequencia)
	into STRICT	nr_seq_partic_pos_w
	from	pls_conta_pos_estab_partic
	where	nr_seq_proc_partic	= nr_seq_partic_p;
else
	nr_seq_partic_pos_w	:= nr_seq_partic_pos_p;
end if;

if (upper(ie_opcao_p) = 'VC') then
	begin
	select	coalesce(coalesce(b.vl_participante,0) - coalesce(a.vl_liberado,0),0)
	into STRICT	ds_retorno_w
	from	pls_proc_participante	b,
		pls_conta_pos_estab_partic	a
	where	b.nr_sequencia = a.nr_seq_proc_partic
	and	a.nr_sequencia	=	nr_seq_partic_pos_w;
	exception
	when others then
		ds_retorno_w := '0';
	end;
	
elsif (upper(ie_opcao_p) = 'VL') then
	select	coalesce(max(a.vl_liberado),0)
	into STRICT	ds_retorno_w
	from	pls_conta_pos_estab_partic	a
	where	a.nr_sequencia	=	nr_seq_partic_pos_w;

elsif (upper(ie_opcao_p) = 'NMM') then

	begin
	select	obter_nome_pf(coalesce(a.cd_medico, b.cd_medico))
	into STRICT	ds_retorno_w
	from	pls_proc_participante		b,
		pls_conta_pos_estab_partic	a
	where	b.nr_sequencia			= a.nr_seq_proc_partic
	and	a.nr_sequencia			= nr_seq_partic_pos_w;
	exception
	when others then
		ds_retorno_w := '';
	end;
	
elsif (upper(ie_opcao_p) = 'GRP') then

	begin
	select	substr(lpad(cd_tiss,2,0)||' - '||ds_grau_participacao,1,255)
	into STRICT	ds_retorno_w
	from	pls_grau_participacao		a, 	
		pls_conta_pos_estab_partic	b
	where	a.nr_sequencia			= b.nr_seq_grau_partic
	and	b.nr_sequencia			= nr_seq_partic_pos_w;
	exception
	when others then
		ds_retorno_w := '';
	end;

end if;




return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_dados_partic_pos (nr_seq_partic_p bigint, nr_seq_partic_pos_p bigint, ie_opcao_p text) FROM PUBLIC;

