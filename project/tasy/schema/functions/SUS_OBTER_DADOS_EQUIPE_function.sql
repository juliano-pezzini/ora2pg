-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION sus_obter_dados_equipe (nr_sequencia_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


/*IE_OPCAO_P:
AR - código da área
CM - código do município IBGE
TP - código dp tipo
CP - Data de competência
FV - Data final de vigência
IV - Data final de vigência
NM - Nome
CN - CNES
SE - Seq equipe
*/
ds_retorno_w		varchar(255) := '';
cd_area_equipe_w	varchar(4);
cd_municipio_ibge_w	varchar(6);
cd_tipo_equipe_w	varchar(2);
dt_competencia_w	timestamp;
dt_final_vigencia_w	timestamp;
dt_inicio_vigencia_w	timestamp;
nm_equipe_w		varchar(60);
nr_cnes_equipe_w	varchar(7);
nr_seq_equipe_w		varchar(8);
nr_sequencia_w		bigint;


BEGIN

select	cd_area_equipe,
	cd_municipio_ibge,
	cd_tipo_equipe,
	dt_competencia,
	dt_final_vigencia,
	dt_inicio_vigencia,
	nm_equipe,
	nr_cnes_equipe,
	nr_seq_equipe
into STRICT	cd_area_equipe_w,
	cd_municipio_ibge_w,
	cd_tipo_equipe_w,
	dt_competencia_w,
	dt_final_vigencia_w,
	dt_inicio_vigencia_w,
	nm_equipe_w,
	nr_cnes_equipe_w,
	nr_seq_equipe_w
from	sus_equipe
where	nr_sequencia = nr_sequencia_p;

if (ie_opcao_p = 'NM') then
	ds_retorno_w	:= nm_equipe_w;
elsif (ie_opcao_p = 'AR') then
	ds_retorno_w	:= cd_area_equipe_w;
elsif (ie_opcao_p = 'CM') then
	ds_retorno_w	:= cd_municipio_ibge_w;
elsif (ie_opcao_p = 'TP') then
	ds_retorno_w	:= cd_tipo_equipe_w;
elsif (ie_opcao_p = 'CP') then
	ds_retorno_w	:= to_char(dt_competencia_w,'dd/mm/yyyy');
elsif (ie_opcao_p = 'FV') then
	ds_retorno_w	:= to_char(dt_final_vigencia_w,'dd/mm/yyyy');
elsif (ie_opcao_p = 'IV') then
	ds_retorno_w	:= to_char(dt_inicio_vigencia_w,'dd/mm/yyyy');
elsif (ie_opcao_p = 'CN') then
	ds_retorno_w	:= nr_cnes_equipe_w;
elsif (ie_opcao_p = 'SE') then
	ds_retorno_w	:= lpad(nr_seq_equipe_w,10,'0');
end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION sus_obter_dados_equipe (nr_sequencia_p bigint, ie_opcao_p text) FROM PUBLIC;

