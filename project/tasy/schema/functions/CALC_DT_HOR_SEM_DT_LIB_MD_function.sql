-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION calc_dt_hor_sem_dt_lib_md ( dt_prev_execucao_p timestamp, dt_prescricao_pp timestamp, ie_estendido_p text, ds_hora_proc_p text, qt_dia_adic_p bigint, ie_proc_urgente_p text) RETURNS timestamp AS $body$
DECLARE

	
dt_horario_proc_w     timestamp;
ie_add_dia_w          varchar(1) := 'S';

BEGIN

    if (dt_prev_execucao_p >= dt_prescricao_pp) and (ie_estendido_p = 'N') then
        dt_horario_proc_w := pkg_date_utils.get_time(dt_prev_execucao_p, replace(ds_hora_proc_p, 'A', ''), 0);
    else
        dt_horario_proc_w := pkg_date_utils.get_time(dt_prev_execucao_p + qt_dia_adic_p, replace(ds_hora_proc_p, 'A', ''), 0);
        ie_add_dia_w := 'N';
    end if;

    if	(( dt_horario_proc_w < trunc(dt_prescricao_pp, 'mi')) or
		 ( qt_dia_adic_p > 0  AND  ie_add_dia_w = 'S' )) and (ie_proc_urgente_p = 'N') then
        dt_horario_proc_w := dt_horario_proc_w + 1;
    end if;

    return dt_horario_proc_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION calc_dt_hor_sem_dt_lib_md ( dt_prev_execucao_p timestamp, dt_prescricao_pp timestamp, ie_estendido_p text, ds_hora_proc_p text, qt_dia_adic_p bigint, ie_proc_urgente_p text) FROM PUBLIC;

