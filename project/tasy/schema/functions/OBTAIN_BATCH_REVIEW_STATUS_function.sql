-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obtain_batch_review_status (nr_seq_lote_p bigint, cd_resp_type_p text) RETURNS varchar AS $body$
DECLARE

  ie_status_review_w ap_lote_review.ie_status_review%type;
  cd_status_review_w varchar(256);

BEGIN
    ie_status_review_w := 'X';
    cd_status_review_w := 'NA';

    if (nr_seq_lote_p IS NOT NULL AND nr_seq_lote_p::text <> '') then
      select coalesce(ie_status_review,'X')
      into STRICT   ie_status_review_w
      from   ap_lote_review
      where  nr_seq_lote = nr_seq_lote_p;
    end if;

    if ( coalesce(cd_resp_type_p, 'NA') = 'CD' ) then
        cd_status_review_w := ie_status_review_w;
    elsif ( coalesce(cd_resp_type_p, 'NA') = 'DS' ) then
        if (ie_status_review_w = 'X') then
            cd_status_review_w  := 'NA';
        else
            select SUBSTR(expressao_pck.obter_desc_expressao(CD_EXP_VALOR_DOMINIO, PKG_I18N.get_user_locale()), 1, 255)
                into STRICT cd_status_review_w
            from valor_dominio
            where cd_dominio = 10425 and vl_dominio = ie_status_review_w;
        end if;
    else
        cd_status_review_w := 'NA';
    end if;



    return cd_status_review_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obtain_batch_review_status (nr_seq_lote_p bigint, cd_resp_type_p text) FROM PUBLIC;

