-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_valor_liquidacao ( nr_seq_escrit_p bigint, cd_banco_p bigint) RETURNS bigint AS $body$
DECLARE

VL_LIQUIDACAO_W		titulo_pagar_escrit.vl_escritural%type;

BEGIN
	select (coalesce(sum(a.vl_escritural),0) -
	coalesce(sum(a.vl_desconto),0) +
	coalesce(sum(a.vl_acrescimo),0) +
	coalesce(sum(a.vl_despesa),0) +
	coalesce(sum(a.vl_juros),0) +
	coalesce(sum(a.vl_multa),0))
	into STRICT VL_LIQUIDACAO_W
	from	titulo_pagar_escrit a
	where
		coalesce(instr(ds_erro,(SELECT  max(x.CD_RETORNO_LIQ)
	from	BANCO_RETORNO_CP x where x.cd_banco = coalesce(cd_banco_p,0))),0) > 0
		and   a.nr_seq_escrit = coalesce(nr_seq_escrit_p,0);

return	VL_LIQUIDACAO_W;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_valor_liquidacao ( nr_seq_escrit_p bigint, cd_banco_p bigint) FROM PUBLIC;

