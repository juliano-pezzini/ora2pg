-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_val_honor_ocor ( nr_seq_honorario_crit_p pls_conta_proc.nr_seq_honorario_crit%type, vl_procedimento_p pls_conta_proc.vl_procedimento%type, vl_total_partic_p pls_conta_proc.vl_total_partic%type, vl_materiais_p pls_conta_proc.vl_materiais%type, vl_custo_operacional_p pls_conta_proc.vl_custo_operacional%type) RETURNS PLS_TIPOS_OCOR_PCK.DADOS_VALOR_GLOSA_9919 AS $body$
DECLARE



ie_repassa_medico_w		pls_regra_honorario.ie_repassa_medico%type;
vl_repasse_glosa_w		double precision;
ds_observacao_w			varchar(1000);
dados_valor_glosa_9919_w	pls_tipos_ocor_pck.dados_valor_glosa_9919;


BEGIN

select	max(ie_repassa_medico)
into STRICT	ie_repassa_medico_w
from	pls_regra_honorario
where	nr_sequencia	= nr_seq_honorario_crit_p;

if (ie_repassa_medico_w	= 'S') then
	vl_repasse_glosa_w		:= vl_procedimento_p;
elsif (ie_repassa_medico_w	= 'H') then
	ds_observacao_w	:= ds_observacao_w||'3)Regra de honorário paga ao médico executor os honorário médicos, porém o mesmo não foi calculado.';
	vl_repasse_glosa_w		:= vl_total_partic_p;
elsif (ie_repassa_medico_w	= 'N') then
	ds_observacao_w	:= ds_observacao_w||'3)Regra de honorário paga ao médico executor o CO e Filme, porém o mesmo não foi calculado.';
	vl_repasse_glosa_w		:= coalesce(vl_materiais_p,0) + coalesce(vl_custo_operacional_p,0);
end if;

dados_valor_glosa_9919_w.vl_glosa 	:= vl_repasse_glosa_w;
dados_valor_glosa_9919_w.ds_observacao	:= ds_observacao_w;

return dados_valor_glosa_9919_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_val_honor_ocor ( nr_seq_honorario_crit_p pls_conta_proc.nr_seq_honorario_crit%type, vl_procedimento_p pls_conta_proc.vl_procedimento%type, vl_total_partic_p pls_conta_proc.vl_total_partic%type, vl_materiais_p pls_conta_proc.vl_materiais%type, vl_custo_operacional_p pls_conta_proc.vl_custo_operacional%type) FROM PUBLIC;

