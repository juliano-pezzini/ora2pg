-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obtain_type_prescription (nr_atendimento_p bigint, cd_resp_type_p text) RETURNS varchar AS $body$
DECLARE

  si_type_of_prescription_w cpoe_order_unit.si_type_of_prescription%type;
  cd_type_of_prescription_w varchar(256);

BEGIN
    si_type_of_prescription_w := 'X';
    cd_type_of_prescription_w := 'NA';

    if (nr_atendimento_p IS NOT NULL AND nr_atendimento_p::text <> '') then
      select max(coalesce(si_type_of_prescription,'X'))
      into STRICT   si_type_of_prescription_w
      from   cpoe_order_unit
      where  nr_atendimento = nr_atendimento_p;
    end if;

    if ( coalesce(cd_resp_type_p, 'NA') = 'CD' ) then
        cd_type_of_prescription_w := si_type_of_prescription_w;
    elsif ( coalesce(cd_resp_type_p, 'NA') = 'DS' ) then
        if (si_type_of_prescription_w = 'X') then
            cd_type_of_prescription_w  := 'NA';
        else
            select substr(expressao_pck.obter_desc_expressao(cd_exp_valor_dominio, pkg_i18n.get_user_locale()), 1, 255)
            into STRICT cd_type_of_prescription_w from valor_dominio where cd_dominio = 10080 and vl_dominio = si_type_of_prescription_w;
        end if;
    else
        cd_type_of_prescription_w := 'NA';
    end if;



    return cd_type_of_prescription_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obtain_type_prescription (nr_atendimento_p bigint, cd_resp_type_p text) FROM PUBLIC;

