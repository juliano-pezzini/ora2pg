-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION verificar_dose_dif_onc ( nr_seq_paciente_p bigint, nr_seq_atendiment_p bigint, nr_seq_material_p bigint, ds_dose_diferenciada_p text default null, cd_intervalo_p text default null) RETURNS varchar AS $body$
DECLARE


ie_dose_diferenciada_w	varchar(1);
ds_mensagem_w		varchar(255);
ds_retorno_w		varchar(255);
ds_dose_diferenciada_w	varchar(50);
cd_intervalo_w		varchar(7);


BEGIN
if (coalesce(nr_seq_paciente_p,0) > 0) then
	select	max(ds_dose_diferenciada),
		max(cd_intervalo)
	into STRICT	ds_dose_diferenciada_w,
		cd_intervalo_w
	from	paciente_protocolo_medic
	where	nr_seq_paciente = nr_seq_paciente_p
	and	nr_seq_material = nr_seq_material_p;

elsif (coalesce(nr_seq_atendiment_p,0) > 0) then
	select	max(ds_dose_diferenciada),
		max(cd_intervalo)
	into STRICT	ds_dose_diferenciada_w,
		cd_intervalo_w
	from	paciente_atend_medic
	where	nr_seq_atendimento = nr_seq_atendiment_p
	and	nr_seq_material = nr_seq_material_p;
end if;

if (ds_dose_diferenciada_p IS NOT NULL AND ds_dose_diferenciada_p::text <> '') then
  ds_dose_diferenciada_w := ds_dose_diferenciada_p;
end if;

if (cd_intervalo_p IS NOT NULL AND cd_intervalo_p::text <> '') then
  cd_intervalo_w := cd_intervalo_p;
end if;

Select	max(ie_dose_diferenciada)
into STRICT	ie_dose_diferenciada_w
from	intervalo_prescricao
where	cd_intervalo = cd_intervalo_w;

if (ie_dose_diferenciada_w <> 'N') then

    if	((ie_dose_diferenciada_w = 'S') or (ie_dose_diferenciada_w = 'O')) and (coalesce(trim(both ds_dose_diferenciada_w)::text, '') = '') then
            ds_mensagem_w := obter_desc_expressao(681914);
    elsif (ie_dose_diferenciada_w <> 'N') and ((trim(both ds_dose_diferenciada_w) IS NOT NULL AND (trim(both ds_dose_diferenciada_w))::text <> '')) then
            ds_retorno_w := consiste_dose_operacao(ds_dose_diferenciada_w, cd_intervalo_w, ds_retorno_w);
            if (ds_retorno_w = 'N') then
                  ds_mensagem_w := obter_desc_expressao(681916);
            end if;
    end if;
end if;

return	ds_mensagem_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION verificar_dose_dif_onc ( nr_seq_paciente_p bigint, nr_seq_atendiment_p bigint, nr_seq_material_p bigint, ds_dose_diferenciada_p text default null, cd_intervalo_p text default null) FROM PUBLIC;

