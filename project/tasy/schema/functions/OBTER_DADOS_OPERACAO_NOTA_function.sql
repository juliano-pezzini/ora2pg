-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_operacao_nota ( cd_operacao_nf_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


cd_operacao_nf_w		smallint;
ds_operacao_nf_w		varchar(255);
cd_natureza_operacao_w	smallint;
nr_codigo_serv_prest_w	varchar(10);
ds_retorno_w		varchar(255);
cd_operacao_estoque_w	smallint;
ie_pergunta_nf_eletronica_w	varchar(1);
ie_operacao_fiscal_w	varchar(1);
nr_documento_ext_w	varchar(80);
ie_nf_eletronica_w		varchar(1);
ie_servico_w		varchar(1);
ie_nf_modelo_w		operacao_nota.ie_nf_modelo%type;	
ie_nota_reemisao_w	operacao_nota.ie_nota_reemisao%type;
nr_seq_trib_prestador_w natureza_operacao.nr_seq_trib_prestador%type;

/*ie_opcao_p
1 - Descricao
2 - Natureza da operacao
3 - Codigo servico prestado
4 - Operacao Estoque
5 - Pergunta se nota fiscal eletrenica
6 - Operacao fiscal
7 - Cod sistema externo
8 - ie_nf_eletrenica
9 - Operacao de servico
10- ie_nf_modelo
11- Nota de remessa
12- Exigibilidade
*/
BEGIN

if (coalesce(cd_operacao_nf_p,0) > 0) then
	select	cd_operacao_nf,
		ds_operacao_nf,
		cd_natureza_operacao,
		nr_codigo_serv_prest,
		cd_operacao_estoque,
		ie_pergunta_nf_eletronica,
		ie_operacao_fiscal,
		nr_documento_ext,
		ie_nf_eletronica,
		coalesce(ie_servico,'N'),
		coalesce(ie_nf_modelo,'N'),
		coalesce(ie_nota_reemisao,'N')
	into STRICT	cd_operacao_nf_w,
		ds_operacao_nf_w,
		cd_natureza_operacao_w,
		nr_codigo_serv_prest_w,
		cd_operacao_estoque_w,
		ie_pergunta_nf_eletronica_w,
		ie_operacao_fiscal_w,
		nr_documento_ext_w,
		ie_nf_eletronica_w,
		ie_servico_w,
		ie_nf_modelo_w,
		ie_nota_reemisao_w
	from	operacao_nota
	where	cd_operacao_nf = cd_operacao_nf_p;

	if (ie_opcao_p = '1') then
		ds_retorno_w	:= ds_operacao_nf_w;
	elsif (ie_opcao_p = '2') then
		ds_retorno_w	:= cd_natureza_operacao_w;
	elsif (ie_opcao_p = '3') then
		ds_retorno_w	:= nr_codigo_serv_prest_w;
	elsif (ie_opcao_p = '4') then
		ds_retorno_w	:= cd_operacao_estoque_w;
	elsif (ie_opcao_p = '5') then
		ds_retorno_w	:= ie_pergunta_nf_eletronica_w;
	elsif (ie_opcao_p = '6') then
		ds_retorno_w	:= ie_operacao_fiscal_w;
	elsif (ie_opcao_p = '7') then
		ds_retorno_w	:= nr_documento_ext_w;
	elsif (ie_opcao_p = '8') then
		ds_retorno_w	:= ie_nf_eletronica_w;
	elsif (ie_opcao_p = '9') then
		ds_retorno_w	:= ie_servico_w;
	elsif (ie_opcao_p = '10') then
		ds_retorno_w	:= ie_nf_modelo_w;
	elsif (ie_opcao_p = '11') then
		ds_retorno_w	:= ie_nota_reemisao_w;
  elsif (ie_opcao_p = '12') then
    select  nr_seq_trib_prestador
    into STRICT    nr_seq_trib_prestador_w
    from    natureza_operacao 
    where   cd_natureza_operacao = cd_natureza_operacao_w;

    ds_retorno_w := nr_seq_trib_prestador_w;
	end if;
end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_operacao_nota ( cd_operacao_nf_p bigint, ie_opcao_p text) FROM PUBLIC;

