-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION ger_obter_qt_lidos (nr_seq_carga_arq_p bigint, ds_condicao_p text default null, ie_status_p text default null) RETURNS bigint AS $body$
DECLARE


vl_retorno_w		varchar(10);
vl_resultado_w		varchar(10);
nm_tabela_w		ger_tipo_carga_arq.nm_tabela%type;
ds_comando_w		varchar(2000);
c001			integer;		
		

BEGIN

select	max(c.nm_tabela)
into STRICT	nm_tabela_w
from	ger_carga_arq b,
	ger_tipo_carga_arq c
where	b.nr_sequencia		= nr_seq_carga_arq_p
and	b.nr_seq_tipo_arq	= c.nr_sequencia;

if (nm_tabela_w IS NOT NULL AND nm_tabela_w::text <> '') then

	ds_comando_w := ' select count(1) qt from '||nm_tabela_w||' where nr_seq_carga_arq = '||nr_seq_carga_arq_p||' ';
	if (ie_status_p IS NOT NULL AND ie_status_p::text <> '') then
		ds_comando_w := ds_comando_w ||' and ie_status '||ds_condicao_p||' '||chr(39)||ie_status_p||chr(39);
	end if;	

	c001	:= dbms_sql.open_cursor;
	dbms_sql.parse(c001,ds_comando_w,dbms_sql.native);
	dbms_sql.define_column(c001, 1, vl_retorno_w, 255);
	vl_resultado_w	:= dbms_sql.execute(c001);
	vl_resultado_w	:= dbms_sql.fetch_rows(c001);
	dbms_sql.column_value(c001, 1, vl_retorno_w);
	dbms_sql.close_cursor(c001);

end if;

return	somente_numero(vl_retorno_w);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION ger_obter_qt_lidos (nr_seq_carga_arq_p bigint, ds_condicao_p text default null, ie_status_p text default null) FROM PUBLIC;

