-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_tel_formatado ( nr_telefone_p text, ie_tipo_p text ) RETURNS bigint AS $body$
DECLARE


nr_retorno_w		bigint;
ds_numero_tmp_w		varchar(20);
ds_numero_w		varchar(20);

ds_ddd_w		varchar(10);
ds_ddi_w		varchar(10);
nr_tamanho_w		bigint;


BEGIN

ds_numero_tmp_w :=  substr(to_char(somente_numero(nr_telefone_p)),1,19);

nr_tamanho_w := length(ds_numero_tmp_w);

if (nr_tamanho_w > 8) then

	ds_numero_w := substr(ds_numero_tmp_w, nr_tamanho_w - 7 ,8);

	ds_numero_tmp_w := substr(ds_numero_tmp_w,1,position(ds_numero_w in ds_numero_tmp_w));

	ds_ddd_w := substr(ds_numero_tmp_w, length(ds_numero_tmp_w) - 2, 2);

	ds_ddi_w := substr(ds_numero_tmp_w,1, 2);

else

	ds_ddd_w := '';
	ds_ddi_w := '';
	ds_numero_w := ds_numero_tmp_w;

end if;


if (ie_tipo_p = 'NR') then

	nr_retorno_w := ds_numero_w;

elsif (ie_tipo_p = 'DDD') then

	nr_retorno_w :=  ds_ddd_w;

elsif (ie_tipo_p = 'DDI') then

	nr_retorno_w := ds_ddi_w;

end if;


return	nr_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_tel_formatado ( nr_telefone_p text, ie_tipo_p text ) FROM PUBLIC;

