-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_movto_concil (nr_sequencia_p bigint, dt_referencia_p timestamp) RETURNS varchar AS $body$
DECLARE


ie_retorno_w		varchar(1)	:= 'N';
nr_seq_concil_w		bigint;
dt_concil_w		timestamp;
ie_conciliacao_w	varchar(1)	:= 'N';


BEGIN

select	max(a.nr_seq_concil),
	max(trunc(b.dt_atualizacao,'dd')),
	max(ie_conciliacao)
into STRICT	nr_seq_concil_w,
	dt_concil_w,
	ie_conciliacao_w
FROM movto_trans_financ a
LEFT OUTER JOIN concil_banc_movto b ON (a.nr_seq_concil = b.nr_sequencia)
WHERE a.nr_sequencia	= nr_sequencia_p;


if (coalesce(nr_seq_concil_w::text, '') = '') and (ie_conciliacao_w = 'N') then
	ie_retorno_w	:= 'N';
elsif (nr_seq_concil_w IS NOT NULL AND nr_seq_concil_w::text <> '') or (ie_conciliacao_w = 'S') then
	if (dt_concil_w <= dt_referencia_p) then
		ie_retorno_w	:= 'S';
	else
		ie_retorno_w	:= 'N';
	end if;
end if;

return ie_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_movto_concil (nr_sequencia_p bigint, dt_referencia_p timestamp) FROM PUBLIC;

