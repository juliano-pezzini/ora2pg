-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_compl_prescr_mat (nr_prescricao_p bigint, nr_sequencia_p bigint) RETURNS varchar AS $body$
DECLARE


ds_resultado_w		varchar(3000)	:= '';
ds_aplicacao_w		varchar(30);
ds_bolus_w			varchar(30);
ds_lentamente_w		varchar(30);
ds_dose_especial_w	varchar(60);
ds_bomba_w			varchar(50);



BEGIN

select	CASE WHEN a.ie_aplic_bolus='S' THEN  obter_desc_expressao(289111)/*'em "bolus"'*/  ELSE null END ,
		CASE WHEN a.ie_aplic_lenta='S' THEN  obter_desc_expressao(292501)/*'lentamente'*/  ELSE null END ,
		CASE WHEN coalesce(a.qt_dose_especial::text, '') = '' THEN  null  ELSE obter_desc_expressao(288237)/*'Dose Especial: '*/
||': '|| replace(campo_mascara(a.qt_dose_especial,1), '.', ',') ||  ' ' || 			a.cd_unidade_medida_dose || ' às ' ||  a.hr_dose_especial || ' h' END ,
		CASE WHEN a.ie_bomba_infusao='S' THEN  'Em Bomba de Infusão.' WHEN a.ie_bomba_infusao='A' THEN 'Em Bomba de Seringa'  ELSE null END
into STRICT
	ds_bolus_w,
	ds_lentamente_w,
	ds_dose_especial_w,
	ds_bomba_w
from  	prescr_material a
where 	a.nr_prescricao  		= nr_prescricao_p
and	a.nr_sequencia		= nr_sequencia_p;

if (ds_dose_especial_w IS NOT NULL AND ds_dose_especial_w::text <> '') then
	ds_resultado_w := ds_resultado_w || ds_dose_especial_w;
end if;
if (ds_bolus_w IS NOT NULL AND ds_bolus_w::text <> '') then
	ds_resultado_w := ds_resultado_w || '     ' || ds_bolus_w;
end if;
if (ds_lentamente_w IS NOT NULL AND ds_lentamente_w::text <> '') then
	ds_resultado_w := ds_resultado_w || '     ' || ds_lentamente_w;
end if;
if (ds_bomba_w IS NOT NULL AND ds_bomba_w::text <> '') then
	ds_resultado_w := ds_resultado_w || '     ' || ds_bomba_w;
end if;

RETURN ds_resultado_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_compl_prescr_mat (nr_prescricao_p bigint, nr_sequencia_p bigint) FROM PUBLIC;

