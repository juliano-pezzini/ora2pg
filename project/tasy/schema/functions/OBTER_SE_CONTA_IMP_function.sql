-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_conta_imp ( NR_SEQ_CONTA_P bigint, CD_DOENCA_P text, IE_TIPO_P text) RETURNS varchar AS $body$
DECLARE


ds_retorno_w		varchar(300);



BEGIN

IF (IE_TIPO_P = 'C') THEN
	select CASE WHEN imp=0 THEN 'N'  ELSE 'S' END  ie_imp
		into STRICT ds_retorno_w
	from (SELECT 	count(a.nr_seq_conta) imp

	from 	pls_diagnostico_conta a,
		w_pls_diagnostico_conta b
	where   a.nr_seq_conta = nr_seq_conta_p
	and 	a.cd_doenca = cd_doenca_p
	and	a.nr_seq_conta = b.nr_seq_conta
	and ((a.ie_tipo_doenca_imp IS NOT NULL AND a.ie_tipo_doenca_imp::text <> '')
	or	(a.ie_indicacao_acidente_imp IS NOT NULL AND a.ie_indicacao_acidente_imp::text <> '')
	or	(a.ie_classificacao_imp IS NOT NULL AND a.ie_classificacao_imp::text <> '')
	or	(a.cd_doenca_imp IS NOT NULL AND a.cd_doenca_imp::text <> '')
	or	(a.ds_diagnostico_imp IS NOT NULL AND a.ds_diagnostico_imp::text <> '')
	or	(a.nm_tabela_imp IS NOT NULL AND a.nm_tabela_imp::text <> '')
	or 	(a.ds_doenca_imp IS NOT NULL AND a.ds_doenca_imp::text <> '')
	or	(a.nr_declaracao_obito_imp IS NOT NULL AND a.nr_declaracao_obito_imp::text <> '') )) alias11;
end if;
IF (IE_TIPO_P = 'O') then
	select  CASE WHEN imp=0 THEN 'N'  ELSE 'S' END ie_imp
	into STRICT	ds_retorno_w
	from (SELECT 	count(a.nr_seq_conta) imp
	from 	pls_diagnost_conta_obito a,
		w_pls_diagnost_conta_obito b
	where 	a.nr_seq_conta = nr_seq_conta_p
	and 	a.cd_doenca = cd_doenca_p
	and	a.nr_seq_conta = b.nr_seq_conta
	and ((a.cd_doenca_imp IS NOT NULL AND a.cd_doenca_imp::text <> '')
	or	(a.ds_doenca_imp IS NOT NULL AND a.ds_doenca_imp::text <> '')
	or	(a.ie_indicador_dorn_imp IS NOT NULL AND a.ie_indicador_dorn_imp::text <> '')
	or	(a.nm_tabela_imp IS NOT NULL AND a.nm_tabela_imp::text <> '')
	or	(a.nr_declaracao_obito_imp IS NOT NULL AND a.nr_declaracao_obito_imp::text <> ''))) alias8;
end if;
IF (IE_TIPO_P = 'N') then
	select CASE WHEN imp=0 THEN 'N'  ELSE 'S' END  ie_imp
	into STRICT	ds_retorno_w
	from (SELECT count(a.nr_seq_conta) imp
	from 	pls_diagnostico_nasc_vivo a,
		w_pls_diagnostico_nasc_viv b
	where
	a.nr_seq_conta = nr_seq_conta_p
	and	a.nr_seq_conta = b.nr_seq_conta
	and ((a.ie_indicador_dorn_imp IS NOT NULL AND a.ie_indicador_dorn_imp::text <> '')
	or	(a.nr_decl_nasc_vivo_imp IS NOT NULL AND a.nr_decl_nasc_vivo_imp::text <> ''))) alias5;
END IF;


RETURN ds_retorno_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_conta_imp ( NR_SEQ_CONTA_P bigint, CD_DOENCA_P text, IE_TIPO_P text) FROM PUBLIC;

