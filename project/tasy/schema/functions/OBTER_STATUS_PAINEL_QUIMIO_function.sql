-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_status_painel_quimio (nr_seq_local_p bigint, nr_agenda_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE

 
ie_controle_w		varchar(1);
ie_status_w		varchar(10);
qt_itens_w		bigint;
nr_atendimento_w	bigint;
ie_sexo_w		varchar(1);
ie_faixa_etaria_w	varchar(15);

/* 
Opção 
	AQ - Agenda de Quimioterapia 
	Q - Quimioterapia 
*/
 
 

BEGIN 
 
if (nr_agenda_p IS NOT NULL AND nr_agenda_p::text <> '') and (ie_opcao_p = 'AQ') then 
 
	select	max(ie_sexo), 
		max(Obter_classif_etaria(1,b.cd_pessoa_fisica,'C')) 
	into STRICT	ie_sexo_w, 
		ie_faixa_etaria_w 
	from	agenda_quimio a, 
		pessoa_fisica b 
	where	a.cd_pessoa_fisica	= b.cd_pessoa_fisica 
	and	a.nr_sequencia		= nr_agenda_p;
elsif (nr_agenda_p IS NOT NULL AND nr_agenda_p::text <> '') and (ie_opcao_p = 'Q') then 
	 
	select	max(ie_sexo), 
		max(Obter_classif_etaria(1,b.cd_pessoa_fisica,'C')) 
	into STRICT	ie_sexo_w, 
		ie_faixa_etaria_w 
	from	paciente_atendimento a, 
		pessoa_fisica b 
	where	obter_dados_paciente_setor(a.nr_seq_paciente,'C')	= b.cd_pessoa_fisica 
	and	a.nr_seq_atendimento					= nr_agenda_p;
end if;
ie_status_w := 'CL';
 
if (coalesce(nr_agenda_p::text, '') = '') then 
	ie_status_w := 'L';	
else 
	if (ie_sexo_w = 'M') then 
	 
		if (ie_faixa_etaria_w = 'A') then 
			ie_status_w := 'MA';
		elsif (ie_faixa_etaria_w = 'C') then 
			ie_status_w := 'MIN';
		elsif (ie_faixa_etaria_w = 'I') then 
			ie_status_w := 'MID';
		elsif (ie_faixa_etaria_w = 'L') then 
			ie_status_w := 'MAD';
		end if;	
	elsif (ie_sexo_w = 'F') then 
		if (ie_faixa_etaria_w = 'A') then 
			ie_status_w := 'FA';
		elsif (ie_faixa_etaria_w = 'C') then 
			ie_status_w := 'FIN';
		elsif (ie_faixa_etaria_w = 'I') then 
			ie_status_w := 'FID';
		elsif (ie_faixa_etaria_w = 'L') then 
			ie_status_w := 'FAD';
		end if;	
	end if;
end if;
 
return	ie_status_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_status_painel_quimio (nr_seq_local_p bigint, nr_agenda_p bigint, ie_opcao_p text) FROM PUBLIC;

