-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION nut_obter_prescr_origin ( nr_prescricao_p bigint) RETURNS bigint AS $body$
DECLARE


nr_prescr_retorno_w 	prescr_medica.nr_prescricao%type := 0;


BEGIN

if ( (nr_prescricao_p IS NOT NULL AND nr_prescricao_p::text <> '') and nr_prescricao_p > 0 ) then
		
	
	SELECT	MIN(nr_prescricao)
		into STRICT	nr_prescr_retorno_w
        FROM
		(	SELECT MIN(x.nr_prescricao) nr_prescricao
			FROM prescr_dieta x
			WHERE x.nr_seq_dieta_cpoe =
				(	SELECT	MIN(y.nr_seq_dieta_cpoe)
					FROM	prescr_dieta y
					WHERE	y.nr_prescricao = nr_prescricao_p
				)
			
UNION


			SELECT	MIN(x.nr_prescricao) nr_prescricao
			FROM	prescr_material x
			WHERE	x.nr_seq_dieta_cpoe =
				(	SELECT	MAX(y.nr_seq_dieta_cpoe)
					FROM	prescr_material y
					WHERE	y.nr_prescricao = nr_prescricao_p
				)
		) alias9;
        	
end if;	

return	nr_prescr_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION nut_obter_prescr_origin ( nr_prescricao_p bigint) FROM PUBLIC;

