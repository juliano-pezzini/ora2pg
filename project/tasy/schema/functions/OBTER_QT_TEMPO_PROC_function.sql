-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_qt_tempo_proc (cd_procedimento_p bigint, dt_agenda_p timestamp) RETURNS bigint AS $body$
DECLARE

			 
qt_tempo_proc_w		bigint;

ie_dia_semana_w		smallint;	
 

BEGIN 
 
select	obter_cod_dia_semana(dt_agenda_p) 
into STRICT	ie_dia_semana_w
;
 
select coalesce(max(obter_tempo_duracao_proced(a.cd_agenda, 
					a.cd_medico_exec, 
					a.cd_procedimento, 
					a.ie_origem_proced, 
					a.cd_pessoa_fisica, 
					a.nr_seq_proc_interno, 
					a.ie_lado, 
					a.cd_convenio, 
					a.cd_categoria, 
					a.cd_plano, 
					null, 
					ie_dia_semana_w)),0) 
into STRICT	qt_tempo_proc_w 
from	agenda_paciente a, 
	tempo_procedimento b 
where	a.cd_agenda = b.cd_agenda 
and	a.nr_seq_proc_interno = b.nr_seq_proc_interno 
and	a.dt_agenda = dt_agenda_p 
and	a.cd_procedimento = cd_procedimento_p 
and	((b.ie_dia_semana = ie_dia_semana_w) or ((b.ie_dia_semana = 9) and (ie_dia_semana_w not in (1,7))) or (coalesce(ie_dia_semana::text, '') = ''));
 
return	qt_tempo_proc_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_qt_tempo_proc (cd_procedimento_p bigint, dt_agenda_p timestamp) FROM PUBLIC;

