-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION gqa_obter_acao_pendente ( nr_sequencia_p bigint, nr_seq_regra_acao_p bigint default null) RETURNS varchar AS $body$
DECLARE


ds_retorno_w    varchar(1) := 'N';
nr_seq_regra_acao_w  bigint;
nr_seq_proc_w    bigint;
cd_protocolo_w    bigint;
nr_seq_protocolo_w  bigint;
ie_reg_w      varchar(1);
ie_reg_sae_w    varchar(1);
ie_reg_prescricao_w  varchar(1);
ie_reg_programa_w   varchar(1);
ie_reg_escala_w    varchar(1);
ie_reg_protocolo_w  varchar(1);
ie_reg_meta_w varchar(1);


BEGIN
--Raise_application_error(-20011,nr_seq_regra_acao_p);
IF (nr_seq_regra_acao_p IS NOT NULL AND nr_seq_regra_acao_p::text <> '') THEN
  	
    SELECT   coalesce(max('S'),'N')
    INTO STRICT  ie_reg_w
    FROM  GQA_ACAO
    WHERE  nr_sequencia = nr_seq_regra_acao_p
    AND    coalesce(IE_SITUACAO,'A') = 'A'
    AND (coalesce(ie_executar,'N') = 'N')
    AND    (((nr_seq_proc IS NOT NULL AND nr_seq_proc::text <> '') OR (nr_seq_proc_saps IS NOT NULL AND nr_seq_proc_saps::text <> ''))
          OR (cd_protocolo IS NOT NULL AND cd_protocolo::text <> '') OR (nr_seq_protocolo IS NOT NULL AND nr_seq_protocolo::text <> '') OR (nr_seq_mprev_programa IS NOT NULL AND nr_seq_mprev_programa::text <> '') OR (nr_seq_escala IS NOT NULL AND nr_seq_escala::text <> '') OR (NR_SEQ_PROTOCOLO_GER IS NOT NULL AND NR_SEQ_PROTOCOLO_GER::text <> '') OR (nr_seq_meta IS NOT NULL AND nr_seq_meta::text <> ''));
	  	
    IF ( ie_reg_w = 'S') THEN
      
      ds_retorno_w := 'S';

      SELECT  coalesce(max('S'),'N')
      INTO STRICT  ie_reg_sae_w
      FROM    Pe_prescricao
      WHERE   nr_seq_pend_pac_acao = nr_sequencia_p;

      if ( ie_reg_sae_w = 'N') then
        
        SELECT  coalesce(max('S'),'N')
        INTO STRICT  ie_reg_prescricao_w
        FROM    prescr_medica
        WHERE   nr_seq_pend_pac_acao = nr_sequencia_p;
    
        if ( ie_reg_prescricao_w = 'N') then    
      
          SELECT  coalesce(max('S'),'N')
          INTO STRICT  ie_reg_programa_w
          FROM    atend_programa_saude
          WHERE   nr_seq_pend_pac_acao = nr_sequencia_p;

          if ( ie_reg_programa_w = 'N') then    
          
            SELECT  coalesce(max('S'),'N')
            INTO STRICT  ie_reg_escala_w
            FROM  escala_pend_pac_acao
            WHERE  nr_seq_pend_pac_acao = nr_sequencia_p;

            if ( ie_reg_escala_w = 'N') then    
            
              SELECT  coalesce(max('S'),'N')
              INTO STRICT  ie_reg_protocolo_w
              FROM  gqa_protocolo_pac
              WHERE  nr_seq_pend_pac_acao = nr_sequencia_p;

            end if;
	
		if ( ie_reg_protocolo_w = 'N') then    
		
	          SELECT  coalesce(max('S'),'N')
	          INTO STRICT  ie_reg_meta_w
	          FROM  tof_meta_atend
	          WHERE  nr_seq_pend_pac_acao = nr_sequencia_p;	
		      
		end if;	
          end if;
        end if;
      end if;

      IF (ie_reg_sae_w = 'S') OR (ie_reg_prescricao_w = 'S') OR (ie_reg_protocolo_w = 'S') OR (ie_reg_programa_w = 'S') OR (ie_reg_escala_w = 'S') OR (ie_reg_meta_w = 'S') THEN
        
        ds_retorno_w := 'N';

      END IF;

    END IF;

END IF;

RETURN ds_retorno_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION gqa_obter_acao_pendente ( nr_sequencia_p bigint, nr_seq_regra_acao_p bigint default null) FROM PUBLIC;

