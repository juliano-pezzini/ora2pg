-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION se_possui_regist_item_consulta ( nr_seq_consulta_p bigint, nr_seq_item_p bigint, cd_pessoa_fisica_p text) RETURNS varchar AS $body$
DECLARE

						
qt_registro_w  		bigint;
ds_retorno_w		varchar(255);
ie_auto_refracao_w	varchar(2);
cd_perfil_w		integer;
ie_visualiza_inativos_w	varchar(1) := 'S';
visualizar_aval_inati_w	varchar(1);



BEGIN

cd_perfil_w := obter_perfil_ativo;

select max(coalesce(ie_visualiza_inativo,'S'))
into STRICT   ie_visualiza_inativos_w	
from   perfil_item_oftalmologia
where  nr_seq_item = nr_seq_item_p
and    cd_perfil = cd_perfil_w;


if (nr_seq_item_p = 2) then
	
	select count(*)
	into STRICT 	qt_registro_w
	from    oft_anamnese
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
		
elsif (nr_seq_item_p = 233) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_CONSULTA_PADRAO
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
	
elsif (nr_seq_item_p = 4) then
    ie_auto_refracao_w := Obter_Param_Usuario(3010, 45, cd_perfil_w, wheb_usuario_pck.get_nm_usuario, wheb_usuario_pck.get_cd_estabelecimento, ie_auto_refracao_w);
	if ((ie_auto_refracao_w = 'AR') or (ie_auto_refracao_w = 'N')) then
		select count(*)
		into STRICT 	qt_registro_w
		from    OFT_AUTO_REFRACAO
		where   nr_seq_consulta  = nr_seq_consulta_p
		and ((ie_refracao_sugerida = 'N') OR (coalesce(ie_refracao_sugerida::text, '') = ''))
		AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
	elsif (ie_auto_refracao_w = 'S') then
		select count(*)
		into STRICT 	qt_registro_w
		from    OFT_REFRACAO
		where   nr_seq_consulta  = nr_seq_consulta_p
		and ((ie_refracao_sugerida = 'N') OR (coalesce(ie_refracao_sugerida::text, '') = ''))
		AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
		
	
	end if;
		
elsif ( nr_seq_item_p = 6) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_EXAME_EXTERNO
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
	
elsif (nr_seq_item_p = 7) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_MOTILIDADE_OCULAR
	where   nr_seq_consulta = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));

elsif (nr_seq_item_p = 8) then

	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_TONOMETRIA
	WHERE    nr_seq_consulta = nr_seq_consulta_p
	AND ie_tipo_tonometria = 1
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));

elsif (nr_seq_item_p = 9) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_FUNDOSCOPIA
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
elsif (nr_seq_item_p = 10) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_BIOMICROSCOPIA
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
elsif (nr_seq_item_p = 13) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_OCULOS
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));

elsif (nr_seq_item_p = 14) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_CONSULTA_LENTE
	where   nr_seq_consulta = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
	
elsif (nr_seq_item_p = 15) then
	select count(*)
	into STRICT 	qt_registro_w
	from    cirurgia
	where   cd_pessoa_fisica = nr_seq_consulta_p;
	
elsif (nr_seq_item_p = 16) then
	select count(*)
	into STRICT 	qt_registro_w
	from    MED_RECEITA
	where   nr_atendimento_hosp IN (SELECT nr_atendimento
					FROM   atendimento_paciente 
					WHERE  cd_pessoa_fisica = cd_pessoa_fisica_p)
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));	

elsif (nr_seq_item_p = 17) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_DNP
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));	
elsif (nr_seq_item_p = 19) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_CORRECAO_ATUAL
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
elsif (nr_seq_item_p = 20) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_ACUIDADE_VISUAL
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND (( ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
elsif (nr_seq_item_p = 21) then
	select count(*)
	into STRICT 	qt_registro_w
	from    PEP_PAC_CI
	where   cd_pessoa_fisica = cd_pessoa_fisica_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));

elsif (nr_seq_item_p = 23) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_TONOMETRIA
	WHERE    nr_seq_consulta = nr_seq_consulta_p
	AND ie_tipo_tonometria = 2
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));

elsif (nr_seq_item_p = 24) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_CONDUTA
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));	
					
elsif (nr_seq_item_p = 28) then
	select count(*)
	into STRICT 	qt_registro_w
	from    ATESTADO_PACIENTE
	where   cd_pessoa_fisica = cd_pessoa_fisica_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));

elsif (nr_seq_item_p = 31) then
	SELECT   COUNT(*)
	into STRICT 	qt_registro_w
	FROM     OFT_ANEXO					
	WHERE    nr_seq_consulta = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
					
elsif (nr_seq_item_p = 69) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_CURVA_TENCIONAL
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
elsif (nr_seq_item_p = 71) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_ANGIO_RETINO
	where   nr_seq_consulta  = nr_seq_consulta_p
   and   coalesce(ie_tipo_registro,'A') = 'A'
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
elsif (nr_seq_item_p = 298) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_ANGIO_RETINO
	where   nr_seq_consulta  = nr_seq_consulta_p
   and   coalesce(ie_tipo_registro,'A') = 'R'
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
elsif (nr_seq_item_p = 73) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_GONIOSCOPIA
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));	

elsif (nr_seq_item_p = 78) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_BIOMETRIA
	where   nr_seq_consulta = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));	
elsif (nr_seq_item_p = 80) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_MICROSCOPIA_ESPECULAR
	where   nr_seq_consulta = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));

elsif (nr_seq_item_p = 82) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_PUPILOMETRIA
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));

elsif (nr_seq_item_p = 84) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_PAQUIMETRIA
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND 	((IE_TIPO_PAQUIMETRIA = 'S') OR (coalesce(IE_TIPO_PAQUIMETRIA::text, '') = ''))
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));

elsif (nr_seq_item_p = 86) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_MOTILIDADE_OCULAR
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));

elsif (nr_seq_item_p = 160) then
	select count(*)
	into STRICT 	qt_registro_w
	from    PEP_ORIENTACAO_GERAL
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));

elsif (nr_seq_item_p = 162) then
	select count(*)
	into STRICT 	qt_registro_w
	from    EVOLUCAO_PACIENTE
	where   cd_pessoa_fisica = cd_pessoa_fisica_p
	and 	ie_tipo_evolucao <> '9'
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));

elsif (nr_seq_item_p = 168) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_TOPOGRAFIA_CORNEANA
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));

elsif (nr_seq_item_p = 171) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_CAMPIMETRIA
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
elsif (nr_seq_item_p = 173) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_TOMOGRAFIA_OLHO
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
elsif (nr_seq_item_p = 175) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_CERASTOCOPIA
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
elsif (nr_seq_item_p = 177) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_OCT
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
elsif (nr_seq_item_p = 242) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_IRIDECTOMIA
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
elsif (nr_seq_item_p = 254) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_FOTOCOAGULACAO_LASER
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
elsif (nr_seq_item_p = 255) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_SOBRECARGA_HIDRICA
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
elsif (nr_seq_item_p = 256) then
	select count(*)
	into STRICT 	qt_registro_w
	from    OFT_CAPSULOTOMIA
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
elsif (nr_seq_item_p = 220) then
	select count(*)
	into STRICT 	qt_registro_w
	from    MED_AVALIACAO_PACIENTE
	where   cd_pessoa_fisica = cd_pessoa_fisica_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
	
elsif (nr_seq_item_p = 165) then
select count(*)
into STRICT 	qt_registro_w
from   laudo_paciente_v a
where  a.nr_atendimento in (SELECT nr_atendimento
                            from   atendimento_paciente 
                            where  cd_pessoa_fisica = cd_pessoa_fisica_p);		
elsif (nr_seq_item_p = 277) then
	select  count(*)
	into STRICT 	  qt_registro_w
	from    OFT_ULTRASSONOGRAFIA
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));
elsif (nr_seq_item_p = 276) then
	select  count(*)
	into STRICT 	  qt_registro_w
	from    OFT_MAPEAMENTO_RETINA
	where   nr_seq_consulta  = nr_seq_consulta_p
	AND ((ie_visualiza_inativos_w = 'S') OR (ie_visualiza_inativos_w = 'N' AND coalesce(ie_situacao,'A') = 'A'));	
end if;

if (qt_registro_w > 0) or (nr_seq_item_p = 3) or (nr_seq_item_p = 5) then
	ds_retorno_w := 'S';
else
        ds_retorno_w := 'N';  	

end if;

	
return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION se_possui_regist_item_consulta ( nr_seq_consulta_p bigint, nr_seq_item_p bigint, cd_pessoa_fisica_p text) FROM PUBLIC;

