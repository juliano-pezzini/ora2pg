-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_desc_inf_npt_adulta ( nr_prescricao_p bigint, nr_sequencia_p bigint) RETURNS varchar AS $body$
DECLARE



ie_via_adm_w		varchar(70);
qt_hora_inf_w		bigint;
qt_vel_inf_w		double precision;
qt_volume_diario_w	double precision;


ds_via_adm_w		varchar(255) := null;
ds_hora_inf_w		varchar(255) := null;
ds_vel_inf_w		varchar(255) := null;
ds_volume_diario_w	varchar(255) := null;
ds_fase_npt_w		varchar(255) := null;

ds_retorno_w		varchar(1000);



BEGIN
if (coalesce(nr_prescricao_p,0) <> 0) then
	begin


	select	substr(obter_valor_dominio(1953,ie_via_administracao),1,50) ie_via_adm,
		qt_hora_inf,
		coalesce(obter_vel_infusao_npt(nr_prescricao, nr_sequencia), qt_gotejo_npt) qt_gotejo_npt,
		qt_volume_diario,
		substr(qt_fase_npt ||obter_desc_expressao(726222)/*' fase(s) '*/
|| coalesce(obter_desc_intervalo(cd_intervalo),obter_desc_intervalo_prescr(cd_intervalo)),1,240) ds_fase_npt
	into STRICT	ie_via_adm_w,
		qt_hora_inf_w,
		qt_vel_inf_w,
		qt_volume_diario_w,
		ds_fase_npt_w
	from	nut_pac
	where	nr_prescricao	= nr_prescricao_p
	and	nr_sequencia 	= nr_sequencia_p;

	if (qt_volume_diario_w IS NOT NULL AND qt_volume_diario_w::text <> '') then
		ds_volume_diario_w := substr(qt_volume_diario_w || ' ml/',1,255);
	end if;

	if (qt_hora_inf_w IS NOT NULL AND qt_hora_inf_w::text <> '') then
		ds_hora_inf_w	:= substr(qt_hora_inf_w ||'H,',1,255);
	end if;

	if (ds_fase_npt_w IS NOT NULL AND ds_fase_npt_w::text <> '') then
		ds_fase_npt_w	:= substr(ds_fase_npt_w || ' ,',1,255);
	end if;

	if (ie_via_adm_w IS NOT NULL AND ie_via_adm_w::text <> '') then
		ds_via_adm_w := substr(obter_desc_expressao(301665) /*'Via admin'*/
||' '|| ie_via_adm_w ||', a ',1,255);
	end if;

	if (qt_vel_inf_w IS NOT NULL AND qt_vel_inf_w::text <> '') then
		ds_vel_inf_w := substr(qt_vel_inf_w || ' ml/H' ,1,255);
	end if;

	--ds_retorno_w := substr(ds_via_adm_w || ds_vel_inf_w || ds_hora_inf_w || ds_volume_diario_w,1,1000);
	ds_retorno_w	:= substr(ds_volume_diario_w|| ds_hora_inf_w|| ds_fase_npt_w || ds_via_adm_w||ds_vel_inf_w,1,1000);
	end;

	/*
	33,8 ml/24H,4 fase(s), Via admin: Central, a 1 ml/H
	*/
end if;

return ds_retorno_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_desc_inf_npt_adulta ( nr_prescricao_p bigint, nr_sequencia_p bigint) FROM PUBLIC;

