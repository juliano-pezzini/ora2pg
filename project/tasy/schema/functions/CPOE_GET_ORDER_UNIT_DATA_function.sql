-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cpoe_get_order_unit_data ( nr_seq_cpoe_p bigint, ie_tipo_item_p text, ie_info_p text) RETURNS varchar AS $body$
DECLARE


ds_retorno_w                    varchar(255);
nr_seq_cpoe_order_unit_w        cpoe_order_unit.nr_sequencia%type;
nr_seq_cpoe_rp_w	        cpoe_rp.nr_sequencia%type;


BEGIN

if (nr_seq_cpoe_p IS NOT NULL AND nr_seq_cpoe_p::text <> '') and (ie_tipo_item_p IS NOT NULL AND ie_tipo_item_p::text <> '') then
	if (ie_tipo_item_p in ('P','L')) then
		select	nr_seq_cpoe_order_unit
		into STRICT	nr_seq_cpoe_order_unit_w
		from	cpoe_procedimento
		where	nr_sequencia = nr_seq_cpoe_p;
	elsif (ie_tipo_item_p in ('D','J','SNE','LD','S','NPTA','NPTI')) then
		select	nr_seq_cpoe_order_unit
		into STRICT	nr_seq_cpoe_order_unit_w
		from	cpoe_dieta
		where	nr_sequencia = nr_seq_cpoe_p;
	elsif (ie_tipo_item_p in ('MAT','SOL','M')) then
		select	nr_seq_cpoe_order_unit,
		        nr_seq_cpoe_rp
		into STRICT	nr_seq_cpoe_order_unit_w,
		        nr_seq_cpoe_rp_w
		from	cpoe_material
		where	nr_sequencia = nr_seq_cpoe_p;
	elsif (ie_tipo_item_p = 'O') then
		select	nr_seq_cpoe_order_unit
		into STRICT	nr_seq_cpoe_order_unit_w
		from	cpoe_gasoterapia
		where	nr_sequencia = nr_seq_cpoe_p;
	elsif (ie_tipo_item_p = 'R') then
		select	nr_seq_cpoe_order_unit
		into STRICT	nr_seq_cpoe_order_unit_w
		from	cpoe_recomendacao
		where	nr_sequencia = nr_seq_cpoe_p;
	elsif (ie_tipo_item_p = 'HM') then
		select	nr_seq_cpoe_order_unit
		into STRICT	nr_seq_cpoe_order_unit_w
		from	cpoe_hemoterapia
		where	nr_sequencia = nr_seq_cpoe_p;
	elsif (ie_tipo_item_p = 'DI') then
		select	nr_seq_cpoe_order_unit
		into STRICT	nr_seq_cpoe_order_unit_w
		from	cpoe_dialise
		where	nr_sequencia = nr_seq_cpoe_p;
	elsif (ie_tipo_item_p = 'AP') then
		select	nr_seq_cpoe_order_unit
		into STRICT	nr_seq_cpoe_order_unit_w
		from	cpoe_anatomia_patologica
		where	nr_sequencia = nr_seq_cpoe_p;
	end if;
end if;

if (nr_seq_cpoe_order_unit_w IS NOT NULL AND nr_seq_cpoe_order_unit_w::text <> '') and (ie_info_p = 'NR_ORDER_UNIT') then
	select	nr_order_unit
	into STRICT	ds_retorno_w
	from	cpoe_order_unit
	where	nr_sequencia = nr_seq_cpoe_order_unit_w;
elsif (nr_seq_cpoe_order_unit_w IS NOT NULL AND nr_seq_cpoe_order_unit_w::text <> '') and (ie_info_p = 'SI_TYPE_OF_PRESCRIPTION') then
	select	si_type_of_prescription
	into STRICT	ds_retorno_w
	from	cpoe_order_unit
	where	nr_sequencia = nr_seq_cpoe_order_unit_w;
elsif (nr_seq_cpoe_order_unit_w IS NOT NULL AND nr_seq_cpoe_order_unit_w::text <> '') and (ie_info_p = 'DS_COLOR_TYPE_PRESCR') then
	begin
	        select	b.ds_color_type_prescr
	        into STRICT	ds_retorno_w
	        FROM cpoe_order_unit a
LEFT OUTER JOIN cpoe_type_of_prescription b ON (a.nr_seq_cpoe_tipo_pedido = b.nr_seq_cpoe_tipo_pedido AND a.si_type_of_prescription = b.si_type_of_prescription)
WHERE a.nr_sequencia = nr_seq_cpoe_order_unit_w;
	exception when others then
		ds_retorno_w	:= null;
	end;
elsif (nr_seq_cpoe_rp_w IS NOT NULL AND nr_seq_cpoe_rp_w::text <> '') and (ie_info_p = 'NR_SEQUENCIA_RP') then
	select	nr_sequencia_rp
	into STRICT	ds_retorno_w
	from	cpoe_rp
	where	nr_sequencia = nr_seq_cpoe_rp_w;
end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_get_order_unit_data ( nr_seq_cpoe_p bigint, ie_tipo_item_p text, ie_info_p text) FROM PUBLIC;

