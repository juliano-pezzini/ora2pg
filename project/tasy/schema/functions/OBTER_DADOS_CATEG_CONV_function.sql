-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_categ_conv ( nr_atendimento_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


ds_retorno_w			varchar(255) := '';
cd_usuario_convenio_w		varchar(40);
cd_plano_w			varchar(20);
cd_empresa_w			bigint;
cd_tipo_acomodacao_w		bigint;
cd_complemento_w			varchar(30);
dt_validade_carteira_w		varchar(10);
ds_plano_w			varchar(80);
ds_categoria_w			varchar(100);
cd_categoria_w			varchar(10);
cd_senha_w			varchar(20);
nr_doc_convenio_w		varchar(20);
nr_doc_conv_principal_w		varchar(20);
ie_tipo_guia_w			varchar(10);
ie_lib_dieta_w			varchar(5):=null;
cd_dependente_w			smallint;
ds_observacao_w			varchar(4000);
ds_empresa_ref_w			varchar(80) := '';
nr_seq_origem_w			bigint;
nr_seq_cobertura_w		bigint;
dt_inicio_vigencia_w		timestamp;
dt_fim_vigencia_w			timestamp;
nr_acompanhante_w		smallint;
nr_seq_lib_dieta_conv_w		bigint;
nr_seq_interno_w		bigint;
nr_biometria_conv_w		atend_categoria_convenio.nr_biometria_conv%type;
/*	opção
	E	- EMPRESA DE REFERÊNCIA
	P	- PLANO
	U	- CÓDIDO DO USUÁRIO NO PLANO
	C	- COMPLEMENTO
	V	- VALIDADE
	A	- TIPO DE ACOMODAÇÃO
	UCV	- CÓDIDO DO USUÁRIO NO PLANO / COMPLEMENTO / VALIDADE
	DP	- DESCRIÇÃO DO PLANO
	DC	- DESCRIÇÃO DA CATEGORIA DO CONVÊNIO
	CA	- CATEGORIA
	S	- SENHA
	G	- GUIA
	GP	- GUIA PRINCIPAL
	TG	- TIPO GUIA
	DL	- DIETA LIBERADA (DOMINIO 1396)
	DEP	- Dependente
	OBS	- Observação
	DE	-Desc Empresa ref
	OC	-Origem conv
	COB	-Cobertura
	DIV	-Data início vigência/GUIA
	CFV	-Data finao vigência/GUIA
	B	- Biometria
*/
BEGIN

select	max(obter_atecaco_atendimento(nr_atendimento_p))
into STRICT	nr_seq_interno_w
;

begin
/*Alterado por lhalves OS 754449 em 08/07/2014 - Este indice não existe mais.
select	/*+ index (a atecaco_i3) */select	cd_plano_convenio,
	cd_usuario_convenio,
	cd_complemento,
	to_char(dt_validade_carteira,'dd/mm/yyyy'),
	cd_empresa,
	cd_tipo_acomodacao,
	substr(obter_desc_plano(cd_convenio,cd_plano_convenio),1,80),
	substr(obter_categoria_convenio(cd_convenio,cd_categoria),1,100),
	cd_categoria,
	cd_senha,
	nr_doc_convenio,
	nr_doc_conv_principal,
	ie_tipo_guia,
	ie_lib_dieta,
	cd_dependente,
	substr(obter_nome_emp_ref(cd_empresa),1,80),
	nr_seq_origem,
	nr_seq_cobertura,
	dt_inicio_vigencia,
	dt_final_vigencia,
	nr_acompanhante,
	nr_seq_lib_dieta_conv,
	nr_biometria_conv
into STRICT	cd_plano_w,
	cd_usuario_convenio_w,
	cd_complemento_w,
	dt_validade_carteira_w,
	cd_empresa_w,
	cd_tipo_acomodacao_w,
	ds_plano_w,
	ds_categoria_w,
	cd_categoria_w,
	cd_senha_w,
	nr_doc_convenio_w,
	nr_doc_conv_principal_w,
	ie_tipo_guia_w,
	ie_lib_dieta_w,
	cd_dependente_w,
	ds_empresa_ref_w,
	nr_seq_origem_w,
	nr_seq_cobertura_w,
	dt_inicio_vigencia_w,
	dt_fim_vigencia_w,
	nr_acompanhante_w,
	nr_seq_lib_dieta_conv_w,
	nr_biometria_conv_w
from	atend_categoria_convenio
where	nr_seq_interno	= nr_seq_interno_w
and	nr_atendimento	= nr_atendimento_p;
exception
	when others then
		ds_retorno_w	:= null;
end;

if (ie_opcao_p = 'P') then
	ds_retorno_w		:= cd_plano_w;
elsif (ie_opcao_p = 'E') then
	ds_retorno_w		:= cd_empresa_w;
elsif (ie_opcao_p = 'U') then
	ds_retorno_w		:= cd_usuario_convenio_w;
elsif (ie_opcao_p = 'A') then
	ds_retorno_w		:= cd_tipo_acomodacao_w;
elsif (ie_opcao_p = 'C') then
	ds_retorno_w		:= cd_complemento_w;
elsif (ie_opcao_p = 'V') then
	ds_retorno_w		:= dt_validade_carteira_w;
elsif (ie_opcao_p = 'UCV') then
	ds_retorno_w		:= cd_usuario_convenio_w ||' / '||cd_complemento_w ||' / '||dt_validade_carteira_w;
elsif (ie_opcao_p = 'DP') then
	ds_retorno_w		:= ds_plano_w;
elsif (ie_opcao_p = 'DC') then
	ds_retorno_w		:= ds_categoria_w;
elsif (ie_opcao_p = 'CA') then
	ds_retorno_w		:= cd_categoria_w;
elsif (ie_opcao_p = 'S') then
	ds_retorno_w		:= cd_senha_w;
elsif (ie_opcao_p = 'G') then
	ds_retorno_w		:= nr_doc_convenio_w;
elsif (ie_opcao_p = 'GP') then
	ds_retorno_w		:= nr_doc_conv_principal_w;
elsif (ie_opcao_p = 'TG') then
	ds_retorno_w		:= ie_tipo_guia_w;
elsif (ie_opcao_p = 'DL') then
	ds_retorno_w		:= ie_lib_dieta_w;
elsif (ie_opcao_p = 'DEP') then
	ds_retorno_w		:= cd_dependente_w;
elsif (ie_opcao_p = 'OBS') then
	ds_retorno_w		:= ds_observacao_w;
elsif (ie_opcao_p = 'DE') then
	ds_retorno_w		:= ds_empresa_ref_w;
elsif (ie_opcao_p = 'OC') then
	ds_retorno_w		:= nr_seq_origem_w;
elsif (ie_opcao_p = 'COB') then
	ds_retorno_w		:= nr_seq_cobertura_w;
elsif (ie_opcao_p = 'DIV') then
	ds_retorno_w		:= dt_inicio_vigencia_w;
elsif (ie_opcao_p = 'CFV') then
	ds_retorno_w		:= dt_fim_vigencia_w;
elsif (ie_opcao_p = 'NAC') then
	ds_retorno_w		:= nr_acompanhante_w;
elsif (ie_opcao_p = 'LDC') then
	ds_retorno_w		:= nr_seq_lib_dieta_conv_w;
elsif (ie_opcao_p = 'B') then
	ds_retorno_w		:= nr_biometria_conv_w;
end if;

return ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_categ_conv ( nr_atendimento_p bigint, ie_opcao_p text) FROM PUBLIC;

