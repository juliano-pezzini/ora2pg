-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION com_obter_dados_dt_ofic_uso ( nr_seq_cliente_p bigint, ie_opcao_p text) RETURNS timestamp AS $body$
DECLARE


/* ie_opcao_p
DO - Data de oficialização de uso
DG - Data de geração
DP - Data de previsão de uso
*/
dt_oficializacao_w	timestamp;
dt_geracao_w		timestamp;
dt_prev_ofic_w		timestamp;


BEGIN
select	max(a.dt_oficializacao),
	max(a.dt_geracao),
	max(a.dt_prev_ofic)
into STRICT	dt_oficializacao_w,
	dt_geracao_w,
	dt_prev_ofic_w
from	com_cli_ofic_uso a
where	a.nr_sequencia = (	SELECT	max(x.nr_sequencia)
				from	com_cli_ofic_uso x
				where	x.nr_seq_cliente = nr_seq_cliente_p);

if (coalesce(ie_opcao_p,'X') = 'DO') then
	return dt_oficializacao_w;
elsif (coalesce(ie_opcao_p,'X') = 'DG') then
	return dt_geracao_w;
elsif (coalesce(ie_opcao_p,'X') = 'DP') then
	return dt_prev_ofic_w;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION com_obter_dados_dt_ofic_uso ( nr_seq_cliente_p bigint, ie_opcao_p text) FROM PUBLIC;

