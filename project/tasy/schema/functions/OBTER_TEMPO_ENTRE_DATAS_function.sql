-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_tempo_entre_datas ( dt_inicial_p timestamp, dt_final_p timestamp, ie_opcao_p text) RETURNS bigint AS $body$
DECLARE


/*=======================================================================================================
ie_opcao_p
D = DIAS
H = HORAS
M = MINUTOS
T =  HORAS (DIAS + HORAS + MINUTOS)
=======================================================================================================*/
qt_retorno_w		numeric(35);
qt_dias_w		numeric(35);
qt_horas_w		numeric(35);
qt_minutos_w		numeric(35);
dt_inicial_w		timestamp;
dt_final_w		timestamp;


BEGIN

select	min(dt_param)
into STRICT	dt_inicial_w
from (SELECT dt_inicial_p dt_param
	
	 
union

	 SELECT dt_final_p dt_param
	 ) alias1;

select	max(dt_param)
into STRICT	dt_final_w
from (SELECT dt_inicial_p dt_param
	
	 
union

	 SELECT dt_final_p dt_param
	 ) alias1;

qt_dias_w	:= trunc(dt_final_w - dt_inicial_w);
qt_horas_w	:= trunc((dt_final_w - dt_inicial_w) * 24);
qt_minutos_w	:= trunc((dt_final_w - dt_inicial_w) * 1440);

if (qt_dias_w	> 0) then
	qt_horas_w	:= qt_horas_w - (qt_dias_w * 24);
	qt_minutos_w	:= qt_minutos_w	- (qt_dias_w * 1440);
end if;

if (qt_horas_w	> 0) then
	qt_minutos_w	:= qt_minutos_w	- (qt_horas_w * 60);
end if;

if (upper(ie_opcao_p)	= 'D') then
	qt_retorno_w := qt_dias_w;
elsif (upper(ie_opcao_p)	= 'H') then
	qt_retorno_w := qt_horas_w;
elsif (upper(ie_opcao_p)	= 'M') then
	qt_retorno_w := qt_minutos_w;
elsif (upper(ie_opcao_p)	= 'T') then
	qt_retorno_w := ((qt_dias_w * 24) + qt_horas_w + (qt_minutos_w / 60));
end if;

return	qt_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_tempo_entre_datas ( dt_inicial_p timestamp, dt_final_p timestamp, ie_opcao_p text) FROM PUBLIC;

