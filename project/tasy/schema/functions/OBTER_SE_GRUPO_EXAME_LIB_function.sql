-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_grupo_exame_lib ( nr_seq_grupo_p bigint, nr_atendimento_p bigint default null) RETURNS varchar AS $body$
DECLARE

 
 
qt_registro_lib_w	bigint;
ie_tipo_convenio_w	bigint;
ie_tipo_atendimento_w	bigint := 0;
cd_especialidade_w   integer := 0;
cd_pessoa_fisica_w	varchar(10);


BEGIN 
 
if (coalesce(nr_atendimento_p,0) > 0) then 
	select	max(ie_tipo_convenio), 
			max(ie_tipo_atendimento) 
	into STRICT	ie_tipo_convenio_w, 
			ie_tipo_atendimento_w 
	from	atendimento_paciente 
	where	nr_atendimento = nr_atendimento_p;
end if;
 
select 	count(*) 
into STRICT	qt_registro_lib_w 
from	med_grupo_exame_lib 
where	nr_seq_grupo	= 	nr_seq_grupo_p;
 
if (qt_registro_lib_w	> 0) then 
	 
	cd_pessoa_fisica_w := coalesce(Obter_Pf_Usuario(Obter_Usuario_Ativo,'C'),0);
	 
	select 	count(*) 
	into STRICT	qt_registro_lib_w 
	from	med_grupo_exame_lib 
	where	nr_seq_grupo	= 	nr_seq_grupo_p 
	and		coalesce(cd_perfil, obter_perfil_ativo)		=	obter_perfil_ativo 
	and		((coalesce(nr_atendimento_p,0) = 0) or (coalesce(ie_tipo_convenio, coalesce(ie_tipo_convenio_w, 0))	=	coalesce(ie_tipo_convenio_w, 0))) 
	and	coalesce(ie_tipo_atendimento,ie_tipo_atendimento_w)	= ie_tipo_atendimento_w 
	and   ( (coalesce(cd_especialidade,0) > 0 
	and   cd_especialidade in (SELECT cd_especialidade 
				   from  medico_especialidade 
				   where cd_pessoa_fisica = cd_pessoa_fisica_w)) 
	or   coalesce(cd_especialidade,0) = 0 );
 
	if (qt_registro_lib_w	= 0) then 
		return 'N';
	end if;
end if;
 
return	'S';
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_grupo_exame_lib ( nr_seq_grupo_p bigint, nr_atendimento_p bigint default null) FROM PUBLIC;

