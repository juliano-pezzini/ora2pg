-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION sus_obter_desc_estrut_proc ( nr_sequencia_p bigint, ie_opcao_p text, ie_estrutura_p text) RETURNS varchar AS $body$
DECLARE



/* IE_OPCAO_P
        C  - Código
	D  - Descrição
	CD - Código + Descrição
*/
/* IE_ESTRUTURA_P
        F - Forma organizacao
        S - SubGrupo
        G - Grupo
*/
cd_forma_organizacao_w          integer;
ds_forma_organizacao_w          varchar(100);
cd_subgrupo_w                   smallint;
ds_subgrupo_w                   varchar(100);
cd_grupo_w                      smallint;
ds_grupo_w                      varchar(100);



BEGIN

/* ESSA FUNCTION É UTILIZADA NA TABELA SUS_PROCEDIMENTO NO DICIONARIO DE DADOS */

if (ie_estrutura_p = 'F') then
        select	max(ds_forma_organizacao),
		max(cd_forma_organizacao)
	into STRICT	ds_forma_organizacao_w,
		cd_forma_organizacao_w
	from	sus_forma_organizacao
	where	nr_sequencia	= nr_sequencia_p;
elsif (ie_estrutura_p = 'S') then
        select	max(ds_subgrupo),
		max(cd_subgrupo)
	into STRICT	ds_subgrupo_w,
		cd_subgrupo_w
	from	sus_subgrupo
	where	nr_sequencia	= nr_sequencia_p;
elsif (ie_estrutura_p = 'G') then
	select	max(ds_grupo),
		max(cd_grupo)
	into STRICT	ds_grupo_w,
		cd_grupo_w
	from	sus_grupo
	where	nr_sequencia	= nr_sequencia_p;
end if;

if (ie_opcao_p = 'D') then
	if (ie_estrutura_p = 'F') then
		return ds_forma_organizacao_w;
	elsif (ie_estrutura_p = 'S') then
		return ds_subgrupo_w;
	elsif (ie_estrutura_p = 'G') then
		return ds_grupo_w;
	end if;
elsif (ie_opcao_p = 'C') then
	if (ie_estrutura_p = 'F') then
		return cd_forma_organizacao_w;
	elsif (ie_estrutura_p = 'S') then
		return cd_subgrupo_w;
	elsif (ie_estrutura_p = 'G') then
		return cd_grupo_w;
	end if;
elsif (ie_opcao_p = 'CD') then
	if (ie_estrutura_p = 'F') then
		return cd_forma_organizacao_w || ' - ' || ds_forma_organizacao_w;
	elsif (ie_estrutura_p = 'S') then
		return cd_subgrupo_w || ' - ' || ds_subgrupo_w;
	elsif (ie_estrutura_p = 'G') then
		return cd_grupo_w || ' - ' || ds_grupo_w;
	end if;
end if;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION sus_obter_desc_estrut_proc ( nr_sequencia_p bigint, ie_opcao_p text, ie_estrutura_p text) FROM PUBLIC;

