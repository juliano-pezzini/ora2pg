-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_pac_biobanco_agecirur ( nr_atendimento_p text) RETURNS varchar AS $body$
DECLARE



-- Utilizado no REL 2770 HSL
nr_seq_agenda_w		agenda_pac_servico.nr_seq_agenda%type;
nr_seq_proc_interno_w	bigint;
cd_estabelecimeto_w	bigint;
qt_biobanco_w		bigint;

ie_biobanco_w		varchar(1) := 'N';


BEGIN

select	max(cd_estabelecimento)
into STRICT	cd_estabelecimeto_w
from	atendimento_paciente
where	nr_atendimento = nr_atendimento_p;

begin
	nr_seq_proc_interno_w := obter_dados_param_atend(cd_estabelecimeto_w, 'PE');
exception
	when 	others then
		nr_seq_proc_interno_w := null;
end;

If (nr_seq_proc_interno_w IS NOT NULL AND nr_seq_proc_interno_w::text <> '') then

	select	max(nr_sequencia)
	into STRICT	nr_seq_agenda_w
	from	agenda_paciente
	where	nr_atendimento = nr_atendimento_p;

	If (nr_seq_agenda_w IS NOT NULL AND nr_seq_agenda_w::text <> '') then
		
		begin
			select	1
			into STRICT	qt_biobanco_w
			from	agenda_pac_servico
			where	nr_seq_agenda = nr_seq_agenda_w
			and	nr_seq_proc_servico = nr_seq_proc_interno_w  LIMIT 1;		
		exception
			when	no_data_found then
				qt_biobanco_w := 0;
		end;
		
		If (qt_biobanco_w > 0) then
			ie_biobanco_w := 'S';
		Else	
			ie_biobanco_w := 'N';
		End if;		
		
	End if;
	
End if;

return	ie_biobanco_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_pac_biobanco_agecirur ( nr_atendimento_p text) FROM PUBLIC;

