-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_hist_saude_habito (nr_sequencia_p bigint) RETURNS varchar AS $body$
DECLARE


ds_retorno_w		varchar(4000);
ds_frequencia_w		varchar(60);
dt_inicio_w		timestamp;
dt_fim_w		timestamp;
ds_quantidade_w		varchar(80);
ds_consequencia_w	varchar(255);
ds_observacao_w		varchar(255);
ds_duracao_w		varchar(20);
qt_utilizacao_w		double precision;
cd_unidade_medida_w	bigint;
ds_unidade_medida_w	varchar(100);


BEGIN

select	substr(obter_valor_dominio(1336,ie_frequencia),1,60),
	dt_inicio,
	dt_fim,
	ds_quantidade,
	qt_utilizacao,
	cd_unidade_medida,
	ds_consequencia,
	ds_observacao,
	substr(obter_idade(dt_inicio,coalesce(dt_fim,clock_timestamp()),'S'),1,20)
into STRICT	ds_frequencia_w,
	dt_inicio_w,
	dt_fim_w,
	ds_quantidade_w,
	qt_utilizacao_w,
	cd_unidade_medida_w,
	ds_consequencia_w,
	ds_observacao_w,
	ds_duracao_w
from	paciente_habito_vicio
where	nr_sequencia	= nr_sequencia_p;

if (cd_unidade_medida_w IS NOT NULL AND cd_unidade_medida_w::text <> '') then
	select	ds_unidade_medida
	into STRICT	ds_unidade_medida_w
	from	unid_med_habito_vicio
	where	nr_sequencia	= cd_unidade_medida_w;
end if;

ds_retorno_w	:= Wheb_mensagem_pck.get_texto(309582) || '  '/*'Desde  '*/||to_char(dt_inicio_w,'dd/mm/yyyy')||chr(13) || chr(10);

if (dt_fim_w IS NOT NULL AND dt_fim_w::text <> '') then
	ds_retorno_w	:= Wheb_mensagem_pck.get_texto(309582) || '  ' /*'Desde  '*/||to_char(dt_inicio_w,'dd/mm/yyyy')|| ' ' || lower(Wheb_mensagem_pck.get_texto(309583)) || ' ' /*' até '*/||to_char(dt_fim_w,'dd/mm/yyyy')|| '   ' ||Wheb_mensagem_pck.get_texto(309584) || ' ' /*'   Duração '*/||ds_duracao_w||chr(13) || chr(10);
end if;

if (ds_frequencia_w IS NOT NULL AND ds_frequencia_w::text <> '') then
	ds_retorno_w	:= ds_retorno_w ||Wheb_mensagem_pck.get_texto(309585) || '  ' /*'Frequência  '*/||ds_frequencia_w||chr(13) || chr(10);
end if;

if (ds_quantidade_w IS NOT NULL AND ds_quantidade_w::text <> '') then
	ds_retorno_w	:= ds_retorno_w ||Wheb_mensagem_pck.get_texto(309586) || '  ' /*'Quantidade  '*/||ds_quantidade_w||chr(13) || chr(10);
end if;

if (qt_utilizacao_w IS NOT NULL AND qt_utilizacao_w::text <> '') and (ds_unidade_medida_w IS NOT NULL AND ds_unidade_medida_w::text <> '') then
	ds_retorno_w	:= ds_retorno_w ||Wheb_mensagem_pck.get_texto(309586) || '  ' /*'Quantidade  '*/||qt_utilizacao_w ||' '||ds_unidade_medida_w||chr(13) || chr(10);
end if;

if (ds_consequencia_w IS NOT NULL AND ds_consequencia_w::text <> '') then
	ds_retorno_w	:= ds_retorno_w ||Wheb_mensagem_pck.get_texto(309587) || '  ' /*'Consequência  '*/||ds_consequencia_w||chr(13) || chr(10);
end if;

if (ds_observacao_w IS NOT NULL AND ds_observacao_w::text <> '') then
	ds_retorno_w	:= ds_retorno_w ||Wheb_mensagem_pck.get_texto(309588) || '  ' /*'Observação  '*/||ds_observacao_w||chr(13) || chr(10);
end if;


return ds_retorno_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_hist_saude_habito (nr_sequencia_p bigint) FROM PUBLIC;

