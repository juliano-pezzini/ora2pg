-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_par_antrop_pz ( nr_atendimento_p bigint, ie_tipo_p text, peso_p bigint, altura_p bigint, dt_registro_p timestamp, anos_p bigint default null, meses_p bigint default null, qt_imc_p bigint default null, qt_circ_braco_p bigint default null, qt_prega_cut_tricip_p bigint default null) RETURNS varchar AS $body$
DECLARE


ds_retorno_w 	varchar(2000);

qt_1_w			real;
qt_3_w			real;
qt_5_w			real;
qt_15_w			real;
qt_25_w			real;
qt_50_w			real;
qt_75_w			real;
qt_85_w			real;
qt_95_w			real;
qt_97_w			real;
qt_99_w			real;

QT_SD_MENOS_3_W		real;
QT_SD_MENOS_2_W		real;
QT_SD_MENOS_1_W		real;
QT_MEDIA_W			real;
QT_SD_MAIS_1_W		real;
QT_SD_MAIS_2_W		real;
QT_SD_MAIS_3_W		real;

qt_valor_w real;
ie_tipo_w  varchar(4);


BEGIN

    ie_tipo_w := 'Z'||ie_tipo_p;

	if (ie_tipo_p in ('PI', 'PA')) then
		qt_valor_w := peso_p;

	elsif (ie_tipo_p = 'IMC') then
		qt_valor_w := qt_imc_p;
		ie_tipo_w := 'ZMC';

	elsif (ie_tipo_p = 'AI')then
		qt_valor_w := altura_p;
	end if;

	SELECT * FROM Obter_percentil(nr_atendimento_p, ie_tipo_p, peso_p, altura_p, dt_registro_p, anos_p, meses_p, qt_imc_p, qt_1_w, qt_3_w, qt_5_w, qt_15_w, qt_25_w, qt_50_w, qt_75_w, qt_85_w, qt_95_w, qt_97_w, qt_99_w) INTO STRICT qt_1_w, qt_3_w, qt_5_w, qt_15_w, qt_25_w, qt_50_w, qt_75_w, qt_85_w, qt_95_w, qt_97_w, qt_99_w;

	SELECT * FROM Obter_score_z(nr_atendimento_p, ie_tipo_w, peso_p, altura_p, dt_registro_p, anos_p, meses_p, qt_imc_p, qt_circ_braco_p, qt_prega_cut_tricip_p, QT_SD_MENOS_3_W, QT_SD_MENOS_2_W, QT_SD_MENOS_1_W, QT_MEDIA_W, QT_SD_MAIS_1_W, QT_SD_MAIS_2_W, QT_SD_MAIS_3_W) INTO STRICT QT_SD_MENOS_3_W, QT_SD_MENOS_2_W, QT_SD_MENOS_1_W, QT_MEDIA_W, QT_SD_MAIS_1_W, QT_SD_MAIS_2_W, QT_SD_MAIS_3_W;

	if (anos_p <= 5) then
		if (qt_valor_w < qt_1_w and qt_valor_w < QT_SD_MENOS_3_W) then
			if (ie_tipo_p = 'PI'	) then
				ds_retorno_w := obter_desc_expressao(1078563,'Muito baixo peso para a idade');
			elsif (ie_tipo_p = 'PA'	) then
				ds_retorno_w := obter_desc_expressao(783086,'Magreza acentuada');
			elsif (ie_tipo_p in ('IMC', 'IMCI')) then
				ds_retorno_w := obter_desc_expressao(783086,'Magreza acentuada');
			elsif (ie_tipo_p = 'AI') then
				ds_retorno_w := obter_desc_expressao(1078571,'Muito baixa estatura para a idade');
			end if;	

		elsif (qt_valor_w >= qt_1_w and qt_valor_w < qt_3_w AND qt_valor_w >= QT_SD_MENOS_3_W and qt_valor_w < QT_SD_MENOS_2_W) then
			if (ie_tipo_p = 'PI'	) then
				ds_retorno_w := obter_desc_expressao(1078565,'Baixo peso para idade');
			elsif (ie_tipo_p = 'PA'	) then
				ds_retorno_w := obter_desc_expressao(783088,'Magreza');
			elsif (ie_tipo_p in ('IMC', 'IMCI')) then
				ds_retorno_w := obter_desc_expressao(783088,'Magreza');
			elsif (ie_tipo_p = 'AI') then
				ds_retorno_w := obter_desc_expressao(1078573,'Baixa estatura para a idade');
			end if;

		elsif (qt_valor_w >= qt_3_w and qt_valor_w < qt_15_w AND qt_valor_w >= QT_SD_MENOS_2_W and qt_valor_w < QT_SD_MENOS_1_W) then
			if (ie_tipo_p = 'PI'	) then
				ds_retorno_w := obter_desc_expressao(1078567,'Peso adequado para a idade');
			elsif (ie_tipo_p = 'PA'	) then
				ds_retorno_w := obter_desc_expressao(347463,'Eutrofia');
			elsif (ie_tipo_p in ('IMC', 'IMCI')) then
				ds_retorno_w := obter_desc_expressao(347463,'Eutrofia');
			elsif (ie_tipo_p = 'AI') then
				ds_retorno_w := obter_desc_expressao(1078575,'Estatura adequada para a idade');
			end if;

		elsif (qt_valor_w >= qt_15_w and qt_valor_w < qt_85_w AND qt_valor_w >= QT_SD_MENOS_1_W and qt_valor_w <= QT_SD_MAIS_1_W) then
			if (ie_tipo_p = 'PI'	) then
				ds_retorno_w := obter_desc_expressao(1078567,'Peso adequado para a idade');
			elsif (ie_tipo_p = 'PA'	) then
				ds_retorno_w := obter_desc_expressao(347463,'Eutrofia');
			elsif (ie_tipo_p in ('IMC', 'IMCI')) then
				ds_retorno_w := obter_desc_expressao(347463,'Eutrofia');
			elsif (ie_tipo_p = 'AI') then
				ds_retorno_w := obter_desc_expressao(1078575,'Estatura adequada para a idade');
			end if;	

		elsif (qt_valor_w > qt_85_w and qt_valor_w <= qt_97_w AND qt_valor_w > QT_SD_MAIS_1_W and qt_valor_w <= QT_SD_MAIS_2_W) then
			if (ie_tipo_p = 'PI'	) then
				ds_retorno_w := obter_desc_expressao(1078567,'Peso adequado para a idade');
			elsif (ie_tipo_p = 'PA'	) then
				ds_retorno_w := obter_desc_expressao(783090,'Risco de sobrepeso');
			elsif (ie_tipo_p in ('IMC', 'IMCI')) then
				ds_retorno_w := obter_desc_expressao(783090,'Risco de sobrepeso');
			elsif (ie_tipo_p = 'AI') then
				ds_retorno_w := obter_desc_expressao(1078575,'Estatura adequada para a idade');
			end if;

		elsif (qt_valor_w > qt_97_w and qt_valor_w <= qt_99_w AND qt_valor_w > QT_SD_MAIS_2_W and qt_valor_w <= QT_SD_MAIS_3_W) then
			if (ie_tipo_p = 'PI'	) then
				ds_retorno_w := obter_desc_expressao(1078569,'Peso elevado para a idade');
			elsif (ie_tipo_p = 'PA'	) then
				ds_retorno_w := obter_desc_expressao(488188,'Sobrepeso');
			elsif (ie_tipo_p in ('IMC', 'IMCI')) then
				ds_retorno_w := obter_desc_expressao(488188,'Sobrepeso');
			elsif (ie_tipo_p = 'AI') then
				ds_retorno_w := obter_desc_expressao(1078575,'Estatura adequada para a idade');
			end if;

		if (qt_valor_w > qt_99_w and qt_valor_w > QT_SD_MAIS_3_W) then
			if (ie_tipo_p = 'PI'	) then
				ds_retorno_w := obter_desc_expressao(1078569,'Peso elevado para a idade');
			elsif (ie_tipo_p = 'PA'	) then
				ds_retorno_w := obter_desc_expressao(294557,'Obesidade');
			elsif (ie_tipo_p in ('IMC', 'IMCI')) then
				ds_retorno_w := obter_desc_expressao(294557,'Obesidade');
			elsif (ie_tipo_p = 'AI') then
				ds_retorno_w := obter_desc_expressao(1078575,'Estatura adequada para a idade');
			end if;
		end if;
		end if;


	elsif (anos_p > 5 and anos_p >= 10) then
		if (qt_valor_w < qt_1_w and qt_valor_w < QT_SD_MENOS_3_W) then
			if (ie_tipo_p = 'PI'	) then
				ds_retorno_w := obter_desc_expressao(1078563,'Muito baixo peso para a idade');
			elsif (ie_tipo_p in ('IMC', 'IMCI')) then
				ds_retorno_w := obter_desc_expressao(783086,'Magreza acentuada');
			elsif (ie_tipo_p = 'AI') then
				ds_retorno_w := obter_desc_expressao(1078571,'Muito baixa estatura para a idade');
			end if;

		elsif (qt_valor_w >= qt_1_w and qt_valor_w < qt_3_w AND qt_valor_w >= QT_SD_MENOS_3_W and qt_valor_w < QT_SD_MENOS_2_W) then
			if (ie_tipo_p = 'PI'	) then
				ds_retorno_w := obter_desc_expressao(1078573,'Baixa estatura para a idade');
			elsif (ie_tipo_p in ('IMC', 'IMCI')) then
				ds_retorno_w := obter_desc_expressao(783088,'Magreza');
			elsif (ie_tipo_p = 'AI') then
				ds_retorno_w := obter_desc_expressao(1078573,'Baixa estatura para a idade');
			end if;

		elsif (qt_valor_w >= qt_3_w and qt_valor_w < qt_15_w AND qt_valor_w >= QT_SD_MENOS_2_W and qt_valor_w < QT_SD_MENOS_1_W) then
			if (ie_tipo_p = 'PI'	) then
				ds_retorno_w := obter_desc_expressao(1078567,'Peso adequado para a idade');
			elsif (ie_tipo_p in ('IMC', 'IMCI')) then
				ds_retorno_w := obter_desc_expressao(347463,'Eutrofia');
			elsif (ie_tipo_p = 'AI') then
				ds_retorno_w := obter_desc_expressao(1078575,'Estatura adequada para a idade');
			end if;

		elsif (qt_valor_w >= qt_15_w and qt_valor_w < qt_85_w AND qt_valor_w >= QT_SD_MENOS_1_W and qt_valor_w <= QT_SD_MAIS_1_W) then
			if (ie_tipo_p = 'PI'	) then
				ds_retorno_w := obter_desc_expressao(1078567,'Peso adequado para a idade');
			elsif (ie_tipo_p in ('IMC', 'IMCI')) then
				ds_retorno_w := obter_desc_expressao(347463,'Eutrofia');
			elsif (ie_tipo_p = 'AI') then
				ds_retorno_w := obter_desc_expressao(1078575,'Estatura adequada para a idade');
			end if;

		elsif (qt_valor_w > qt_85_w and qt_valor_w <= qt_97_w AND qt_valor_w > QT_SD_MAIS_1_W and qt_valor_w <= QT_SD_MAIS_2_W) then
			if (ie_tipo_p = 'PI'	) then
				ds_retorno_w := obter_desc_expressao(1078567,'Peso adequado para a idade');
			elsif (ie_tipo_p in ('IMC', 'IMCI')) then
				ds_retorno_w := obter_desc_expressao(488188,'Sobrepeso');
			elsif (ie_tipo_p = 'AI') then
				ds_retorno_w := obter_desc_expressao(1078575,'Estatura adequada para a idade');
			end if;

		elsif (qt_valor_w > qt_97_w and qt_valor_w <= qt_99_w AND qt_valor_w > QT_SD_MAIS_2_W and qt_valor_w <= QT_SD_MAIS_3_W) then
			if (ie_tipo_p = 'PI'	) then
				ds_retorno_w := obter_desc_expressao(1078569,'Peso elevado para a idade');
			elsif (ie_tipo_p in ('IMC', 'IMCI')) then
				ds_retorno_w := obter_desc_expressao(294557,'Obesidade');
			elsif (ie_tipo_p = 'AI') then
				ds_retorno_w := obter_desc_expressao(1078575,'Estatura adequada para a idade');
			end if;

		if (qt_valor_w > qt_99_w and qt_valor_w > QT_SD_MAIS_3_W) then
			if (ie_tipo_p = 'PI'	) then
				ds_retorno_w := obter_desc_expressao(1078569,'Peso elevado para a idade');
			elsif (ie_tipo_p in ('IMC', 'IMCI')) then
				ds_retorno_w := obter_desc_expressao(783092,'Obesidade grave');
			elsif (ie_tipo_p = 'AI') then
				ds_retorno_w := obter_desc_expressao(1078575,'Estatura adequada para a idade');
			end if;
		end if;

	end if;
	end if;

return ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_par_antrop_pz ( nr_atendimento_p bigint, ie_tipo_p text, peso_p bigint, altura_p bigint, dt_registro_p timestamp, anos_p bigint default null, meses_p bigint default null, qt_imc_p bigint default null, qt_circ_braco_p bigint default null, qt_prega_cut_tricip_p bigint default null) FROM PUBLIC;

