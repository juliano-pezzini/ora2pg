-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION converte_char_data ( ds_dia_p text, ds_hora_p text, dt_alternativa_p timestamp) RETURNS timestamp AS $body$
DECLARE


dt_convertida_w		timestamp;				
qt_dia_w		bigint;
qt_mes_w		bigint;
qt_hora_w		bigint;
qt_min_w		bigint;
qt_seg_w		bigint;
ie_alternativa_w	varchar(1)	:= 'N';
ds_hora_w		varchar(8);


BEGIN

if (length(ds_dia_p)	<> 10) or (substr(ds_dia_p,3,1)	<> '/') or (substr(ds_dia_p,6,1)	<> '/') or (substr(ds_hora_p,3,1)	<> ':') or
	((length(ds_hora_p)	<> 5) and (length(ds_hora_p)	<> 8)) then
	ie_alternativa_w	:= 'S';
else
	begin
	qt_dia_w	:= (substr(ds_dia_p,1,2))::numeric;
	qt_mes_w	:= (substr(ds_dia_p,4,2))::numeric;
	qt_hora_w	:= (substr(ds_hora_p,1,2))::numeric;	
	qt_min_w	:= (substr(ds_hora_p,4,2))::numeric;
	if (length(ds_hora_p)	= 8) then
		qt_seg_w	:= (substr(ds_hora_p,7,2))::numeric;
	else
		qt_seg_w	:= 0;
	end if;	
	if (qt_dia_w	> 31) or (qt_dia_w	= 0) or (qt_mes_w	> 12) or (qt_mes_w	= 0) or (qt_hora_w	> 23) or (qt_min_w	> 59) or (qt_seg_w	> 59) then
		ie_alternativa_w	:= 'S';
	else
		if (length(ds_hora_p)	= 5) then
			ds_hora_w	:= ds_hora_p || ':00';
		else
			ds_hora_w	:= ds_hora_p;
		end if;
		dt_convertida_w	:= ESTABLISHMENT_TIMEZONE_UTILS.dateAtTime(to_date(ds_dia_p), coalesce(ds_hora_w,'00:00'));
	end if;	
	exception
	when others then
	ie_alternativa_w	:= 'S';
	end;

end if;

if (ie_alternativa_w	= 'S') then
	dt_convertida_w	:= dt_alternativa_p;
end if;
	
return	dt_convertida_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION converte_char_data ( ds_dia_p text, ds_hora_p text, dt_alternativa_p timestamp) FROM PUBLIC;

