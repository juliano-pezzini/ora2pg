-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_excecao_nome_mx ( ds_texto_p text, ie_primeiro_nome_p text, ie_sobrenome_pai_p text, nm_primeiro_nome_p text) RETURNS varchar AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [  ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
-------------------------------------------------------------------------------------------------------------------
Referências:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
ds_retorno_w			varchar(255);
ds_texto_w			varchar(255);
qt_pos_composto_w		bigint	:= 0;


BEGIN
ds_texto_w	:= substr(upper(ds_texto_p),1,255);

-- Passo 1 -
ds_texto_w	:= replace(ds_texto_w, 'Ñ', 'X');

if (ie_primeiro_nome_p = 'S') then
	--Passo 2
	ds_texto_w	:= replace(ds_texto_w,'MARIA ','');
	ds_texto_w	:= replace(ds_texto_w,'MA ','');
	ds_texto_w	:= replace(ds_texto_w,'MA. ','');
	ds_texto_w	:= replace(ds_texto_w,'JOSE ','');
	ds_texto_w	:= replace(ds_texto_w,'JOSÉ ','');
	ds_texto_w	:= replace(ds_texto_w,' JOSE','');
	ds_texto_w	:= replace(ds_texto_w,' JOSÉ','');
	ds_texto_w	:= replace(ds_texto_w,'J ','');
	ds_texto_w	:= replace(ds_texto_w,'J. ','');
	ds_texto_w	:= replace(ds_texto_w,'DE ','');
end if;

-- Passo 3
ds_texto_w	:= replace(replace(ds_texto_w, '/', 'X'), '-', 'X');

-- Passo 4
ds_texto_w	:= replace(replace(replace(replace(ds_texto_w, 'Ä', 'A'), 'Ë', 'E'), 'Ö', 'O'), 'Ü', 'U');

if (ie_sobrenome_pai_p = 'S') then
	--Passo 5
	qt_pos_composto_w	:= position(' ' in ds_texto_p);

	if (qt_pos_composto_w > 0) then
		ds_texto_w	:= substr(ds_texto_p, 1, position(' ' in ds_texto_p) - 1);
	end if;

	-- Passo 6
	ds_texto_w	:= replace(ds_texto_w,'DA ','');
	ds_texto_w	:= replace(ds_texto_w,'DAS ','');
	ds_texto_w	:= replace(ds_texto_w,'DE ','');
	ds_texto_w	:= replace(ds_texto_w,'DEL ','');
	ds_texto_w	:= replace(ds_texto_w,'DER ','');
	ds_texto_w	:= replace(ds_texto_w,'DI ','');
	ds_texto_w	:= replace(ds_texto_w,'DIE ','');
	ds_texto_w	:= replace(ds_texto_w,'DD ','');
	ds_texto_w	:= replace(ds_texto_w,'EL ','');
	ds_texto_w	:= replace(ds_texto_w,'LA ','');
	ds_texto_w	:= replace(ds_texto_w,'LOS ','');
	ds_texto_w	:= replace(ds_texto_w,'LAS ','');
	ds_texto_w	:= replace(ds_texto_w,'LE ','');
	ds_texto_w	:= replace(ds_texto_w,'LES ','');
	ds_texto_w	:= replace(ds_texto_w,'MAC ','');
	ds_texto_w	:= replace(ds_texto_w,'MC ','');
	ds_texto_w	:= replace(ds_texto_w,'VAN ','');
	ds_texto_w	:= replace(ds_texto_w,'VON ','');
	ds_texto_w	:= replace(ds_texto_w,'Y ','');
end if;

return ds_texto_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_excecao_nome_mx ( ds_texto_p text, ie_primeiro_nome_p text, ie_sobrenome_pai_p text, nm_primeiro_nome_p text) FROM PUBLIC;

