-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_dacon_estab ( cd_estabelecimento_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


/* Opcao para dados referentes a DACON
CDE - Código do estabelecimento
PIS - Código do tributo PIS cadastrado na regra
COFINS - Código do tributo COFINS cadastrado na regra
SE - Situaçõ especial
DES - Desenquadramento
IS - Inclusão no simples
QUA - Qualificação
TE - Tipo de entidade
RA - Regime de apuração
APC - Apuração PIS COFINS
AD - Apuração diferenciado
AUM - Apuração unidade medida
AST - Apuração substituto tributário
AMA - Adição meses anteriores
CM - Contribuição mês
CRTM - Credito transferido mês
COTM - Contribuição transferido mês
DM - Desconto mês
MD - Determinação dos créditos
DST - Apuração diferenciada do substituto tributário
*/
ds_retorno_w				varchar(4);
cd_estabelecimento_w			varchar(4);
cd_tributo_pis_w				varchar(3);
cd_tributo_cofins_w				varchar(3);
ie_situacao_especial_w			varchar(2);
ie_desenquadramento_w			varchar(2);
ie_inclusao_simples_w			varchar(2);
ie_qualificacao_w				varchar(2);
ie_tipo_entidade_w				varchar(2);
ie_regime_apuracao_w			varchar(2);
ie_apuracao_pis_cofins_w			varchar(2);
ie_apuracao_diferenciado_w			varchar(2);
ie_apuracao_unidade_medida_w		varchar(2);
ie_apuracao_substituto_trib_w		varchar(2);
ie_adicao_mes_anteriores_w			varchar(2);
ie_contribuicao_mes_w			varchar(2);
ie_credito_trans_mes_w			varchar(2);
ie_contribuicao_trans_mes_w			varchar(2);
ie_desconto_mes_w			varchar(2);
ie_metodo_determinacao_w			varchar(2);
ie_apuracao_difer_st_w			varchar(2);


BEGIN

select	cd_estabelecimento,
	cd_tributo_pis,
	cd_tributo_cofins,
	ie_situacao_especial,
	ie_desenquadramento,
	ie_inclusao_simples,
	ie_qualificacao,
	ie_tipo_entidade,
	ie_regime_apuracao,
	ie_apuracao_pis_cofins,
	ie_apuracao_diferenciado,
	ie_apuracao_unidade_medida,
	ie_apuracao_substituto_trib,
	ie_adicao_mes_anteriores,
	ie_contribuicao_mes,
	ie_credito_transferido_mes,
	ie_contribuicao_transf_mes,
	ie_desconto_mes,
	ie_metodo_determinacao,
	ie_apuracao_difer_st
into STRICT	cd_estabelecimento_w,
	cd_tributo_pis_w,
	cd_tributo_cofins_w,
	ie_situacao_especial_w,
	ie_desenquadramento_w,
	ie_inclusao_simples_w,
	ie_qualificacao_w,
	ie_tipo_entidade_w,
	ie_regime_apuracao_w,
	ie_apuracao_pis_cofins_w,
	ie_apuracao_diferenciado_w,
	ie_apuracao_unidade_medida_w,
	ie_apuracao_substituto_trib_w,
	ie_adicao_mes_anteriores_w,
	ie_contribuicao_mes_w,
	ie_credito_trans_mes_w,
	ie_contribuicao_trans_mes_w,
	ie_desconto_mes_w,
	ie_metodo_determinacao_w,
	ie_apuracao_difer_st_w
from	dacon_estab
where	nr_sequencia = (SELECT max(nr_sequencia) from dacon_estab where cd_estabelecimento = cd_estabelecimento_p)
and	cd_estabelecimento = cd_estabelecimento_p;

	if (ie_opcao_p = 'CDE') then
		return cd_estabelecimento_w;
	elsif (ie_opcao_p = 'PIS') then
		return cd_tributo_pis_w;
	elsif (ie_opcao_p = 'COFINS') then
		return cd_tributo_cofins_w;
	elsif (ie_opcao_p = 'SE') then
		return ie_situacao_especial_w;
	elsif (ie_opcao_p = 'DES') then
		return ie_desenquadramento_w;
	elsif (ie_opcao_p = 'IS') then
		return ie_inclusao_simples_w;
	elsif (ie_opcao_p = 'QUA') then
		return ie_qualificacao_w;
	elsif (ie_opcao_p = 'TE') then
		return ie_tipo_entidade_w;
	elsif (ie_opcao_p = 'RA') then
		return ie_regime_apuracao_w;
	elsif (ie_opcao_p = 'APC') then
		return ie_apuracao_pis_cofins_w;
	elsif (ie_opcao_p = 'AD') then
		return ie_apuracao_diferenciado_w;
	elsif (ie_opcao_p = 'AUM') then
		return ie_apuracao_unidade_medida_w;
	elsif (ie_opcao_p = 'AST') then
		return ie_apuracao_substituto_trib_w;
	elsif (ie_opcao_p = 'AMA') then
		return ie_adicao_mes_anteriores_w;
	elsif (ie_opcao_p = 'CM') then
		return ie_contribuicao_mes_w;
	elsif (ie_opcao_p = 'CRTM') then
		return 	ie_credito_trans_mes_w;
	elsif (ie_opcao_p = 'COTM') then
		return 	ie_contribuicao_trans_mes_w;
	elsif (ie_opcao_p = 'DM') then
		return  ie_desconto_mes_w;
	elsif (ie_opcao_p = 'MD') then
		return	ie_metodo_determinacao_w;
	elsif (ie_opcao_p = 'DST') then
		return	ie_apuracao_difer_st_w;
	end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_dacon_estab ( cd_estabelecimento_p bigint, ie_opcao_p text) FROM PUBLIC;

