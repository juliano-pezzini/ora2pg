-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION nfe_obter_dados_pj (cnpj_w text, ie_tipo_w text) RETURNS varchar AS $body$
DECLARE

/* Tipo
UF = Sigla do Estado
IBGE = codigo da cidade IBGE
RZ = Razao social
NM = Nome Fantasia
IN = inscricao estadual
EN = endereco
NR = numero endereco
CM = complemento
BA = bairro
MU = municipio
CEP = cep
DDDT = DDDTELEFONE
DDDF = DDDFAX
EM =  email
IM= Inscricao Municial
TC = Tipo de Contribuinte

*/
sg_estado_w			pessoa_juridica.sg_estado%type;
cd_municipio_ibge_w		varchar(20);
ds_razao_social_w		pessoa_juridica.ds_razao_social%type;
nm_fantasia_w			pessoa_juridica.nm_fantasia%type;
nr_inscricao_w			pessoa_juridica.nr_inscricao_estadual%type;
ds_retorno_w			varchar(255);
ds_logradouro_w			pessoa_juridica.ds_endereco%type;
nr_numero_w			pessoa_juridica.nr_endereco%type;
ds_complemento_w		pessoa_juridica.ds_complemento%type;
ds_bairro_w			pessoa_juridica.ds_bairro%type;
nm_municipio_w			pessoa_juridica.ds_municipio%type;
cd_cep_w			pessoa_juridica.cd_cep%type;
nr_telefone_ddd_w		varchar(255);
nr_fax_ddd_w			varchar(255);
ds_mail_w			varchar(255);
cd_municipio_ibge_exc_w 	pessoa_juridica.cd_municipio_ibge%type;
nr_inscricao_municipal_w	pessoa_juridica.nr_inscricao_municipal%type;
ie_tipo_contribuinte_w	    pessoa_juridica.ie_tipo_contribuinte%type;


BEGIN

select 	coalesce(sg_estado,''),
	CASE WHEN obter_se_pf_pj_estrangeiro(null,cd_cgc)='N' THEN	coalesce(cd_municipio_ibge ,substr(obter_municipio_ibge(coalesce(ELIMINA_CARACTERES_ESPECIAIS(cd_cep),0)),1,14)) ||  substr(calcula_digito('MODULO10',coalesce(cd_municipio_ibge ,substr(obter_municipio_ibge(coalesce(ELIMINA_CARACTERES_ESPECIAIS(cd_cep),0)),1,14))),1,1)  ELSE null END  cd_municipio_ibge,
	substr(ds_razao_social,1,255),
	substr(nm_fantasia,1,255),
	nr_inscricao_estadual,
	cd_cep,
	substr(ds_endereco,1,255),
	nr_endereco,
	substr(ds_complemento,1,255),
	substr(ds_bairro,1,255),
	substr(ds_municipio,1,255),
	nr_ddd_telefone || nr_telefone,
	nr_ddd_fax || nr_fax,
	substr(ds_email,1,255),
	cd_municipio_ibge,
	nr_inscricao_municipal,
	ie_tipo_contribuinte
into STRICT	sg_estado_w,
	cd_municipio_ibge_w,
	ds_razao_social_w,
	nm_fantasia_w,
	nr_inscricao_w,
	cd_cep_w,
	ds_logradouro_w,
	nr_numero_w,
	ds_complemento_w,
	ds_bairro_w,
	nm_municipio_w,
	nr_telefone_ddd_w,
	nr_fax_ddd_w,
	ds_mail_w,
	cd_municipio_ibge_exc_w,
	nr_inscricao_municipal_w,
	ie_tipo_contribuinte_w
from	pessoa_juridica
where	cd_cgc = cnpj_w;

if (ie_tipo_w = 'UF') then
	ds_retorno_w := sg_estado_w;
elsif (ie_tipo_w = 'IBGE') then
	case cd_municipio_ibge_exc_w
	when '430587' then ds_retorno_w := '4305871';
	when '220191' then ds_retorno_w := '2201919';
	when '220225' then ds_retorno_w := '2202251';
	when '220198' then ds_retorno_w := '2201988';
	when '261153' then ds_retorno_w := '2611533';
	when '311783' then ds_retorno_w := '3117836';
	when '315213' then ds_retorno_w := '3152131';
	when '520393' then ds_retorno_w := '5203939';
	when '520396' then ds_retorno_w := '5203962';
	else ds_retorno_w	:= cd_municipio_ibge_w;
	end case;

	ds_retorno_w	:= cd_municipio_ibge_w;
elsif (ie_tipo_w = 'RZ') then
	ds_retorno_w	:= ds_razao_social_w;
elsif (ie_tipo_w = 'NM') then
	ds_retorno_w	:= nm_fantasia_w;
elsif (ie_tipo_w = 'IN') then
	ds_retorno_w	:= nr_inscricao_w;	
elsif (ie_tipo_w = 'EN') then	
	ds_retorno_w	:= ds_logradouro_w;	
elsif (ie_tipo_w = 'NR') then		
	ds_retorno_w	:= nr_numero_w;
elsif (ie_tipo_w = 'CM') then			
	ds_retorno_w	:= ds_complemento_w;
elsif (ie_tipo_w = 'BA') then			
	ds_retorno_w	:= ds_bairro_w;	
elsif (ie_tipo_w = 'MU') then			
	ds_retorno_w	:= nm_municipio_w;		
elsif (ie_tipo_w = 'CEP') then			
	ds_retorno_w	:= cd_cep_w;			
elsif (ie_tipo_w = 'DDDT') then			
	ds_retorno_w	:= nr_telefone_ddd_w;				
elsif (ie_tipo_w = 'DDDF') then			
	ds_retorno_w	:= nr_fax_ddd_w;		
elsif (ie_tipo_w = 'EM') then			
	ds_retorno_w	:= ds_mail_w;	
elsif (ie_tipo_w = 'IM') then			
	ds_retorno_w	:= nr_inscricao_municipal_w;	
elsif (ie_tipo_w = 'TC') then			
	ds_retorno_w	:= ie_tipo_contribuinte_w;		
end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION nfe_obter_dados_pj (cnpj_w text, ie_tipo_w text) FROM PUBLIC;

