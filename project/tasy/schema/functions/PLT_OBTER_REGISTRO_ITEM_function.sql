-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION plt_obter_registro_item ( nr_sequencia_p bigint, nr_prescricao_p bigint, ie_tipo_item_p text) RETURNS varchar AS $body$
DECLARE


ds_registro_w		varchar(1000);


BEGIN

if (ie_tipo_item_p = 'J') then

	select	'J'||somente_numero(to_char(dt_inicio,'dd/mm/yyyy hh24:mi:ss') || '-' || to_char(dt_fim,'dd/mm/yyyy hh24:mi:ss'))||
		somente_numero(obter_desc_expressao(301700)||': ' || to_char(dt_inicio,'dd/mm/yyyy hh24:mi:ss') || obter_desc_expressao(347642) || to_char(dt_fim,'dd/mm/yyyy hh24:mi:ss'))
	into STRICT	ds_registro_w
	from	rep_jejum
	where	nr_prescricao	= nr_prescricao_p
	and	nr_sequencia	= nr_sequencia_p;

elsif (ie_tipo_item_p = 'D') then

	select	'D'||cd_dieta||somente_numero(substr(obter_desc_intervalo_prescr(cd_intervalo),1,15))
	into STRICT	ds_registro_w
	from	prescr_dieta
	where	nr_prescricao	= nr_prescricao_p
	and	nr_sequencia	= nr_sequencia_p;

elsif (ie_tipo_item_p in ('S','SNE','MAT','LD')) then

	select	ie_tipo_item_p||cd_material||somente_numero(substr(adep_obter_um_dosagem_prescr(nr_prescricao,nr_sequencia,ie_acm,ie_se_necessario),1,100))
	into STRICT	ds_registro_w
	from	prescr_material
	where	nr_prescricao	= nr_prescricao_p
	and	nr_sequencia	= nr_sequencia_p;

elsif (ie_tipo_item_p in ('SOL','DI')) then

	select	ie_tipo_item_p||nr_prescricao||nr_seq_solucao||somente_numero(substr(obter_desc_vol_etapa_adep2(nr_prescricao,nr_seq_solucao,ie_acm,ie_se_necessario),1,240))
	into STRICT	ds_registro_w
	from	prescr_solucao
	where	nr_prescricao	= nr_prescricao_p
	and	nr_seq_solucao	= nr_sequencia_p;

elsif (ie_tipo_item_p in ('NAN','NPN')) then

	ds_registro_w	:= ie_tipo_item_p||nr_prescricao_p||nr_sequencia_p;

elsif (ie_tipo_item_p in ('HM','P','C','G','IVC')) then

	select	ie_tipo_item_p||cd_procedimento||somente_numero(substr(adep_obter_dados_prescr_proc(nr_prescricao,nr_sequencia,'QIL','S',ie_acm,ie_se_necessario),1,100))
	into STRICT	ds_registro_w
	from	prescr_procedimento
	where	nr_prescricao	= nr_prescricao_p
	and	nr_sequencia	= nr_sequencia_p;

elsif (ie_tipo_item_p = 'M') then

	select	ie_tipo_item_p||cd_material||somente_numero(cd_intervalo)||qt_dose
	into STRICT	ds_registro_w
	from	prescr_material
	where	nr_prescricao	= nr_prescricao_p
	and	nr_sequencia	= nr_sequencia_p;

elsif (ie_tipo_item_p = 'L') then

	select	ie_tipo_item_p||cd_procedimento||somente_numero(cd_intervalo)||qt_procedimento
	into STRICT	ds_registro_w
	from	prescr_procedimento
	where	nr_prescricao	= nr_prescricao_p
	and	nr_sequencia	= nr_sequencia_p;

elsif (ie_tipo_item_p = 'O') then

	select	ie_tipo_item_p||nr_seq_gas||somente_numero(cd_intervalo)||qt_gasoterapia
	into STRICT	ds_registro_w
	from	prescr_gasoterapia
	where	nr_prescricao	= nr_prescricao_p
	and	nr_sequencia	= nr_sequencia_p;

elsif (ie_tipo_item_p = 'R') then

	select	ie_tipo_item_p||substr(coalesce(cd_recomendacao,somente_numero(ds_recomendacao)),1,255)||somente_numero(cd_intervalo)||qt_recomendacao
	into STRICT	ds_registro_w
	from	prescr_recomendacao
	where	nr_prescricao	= nr_prescricao_p
	and	nr_sequencia	= nr_sequencia_p;

end if;

return	ds_registro_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION plt_obter_registro_item ( nr_sequencia_p bigint, nr_prescricao_p bigint, ie_tipo_item_p text) FROM PUBLIC;

