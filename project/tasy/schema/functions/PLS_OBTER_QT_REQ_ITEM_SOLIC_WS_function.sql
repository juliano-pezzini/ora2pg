-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_qt_req_item_solic_ws ( nr_seq_item_p bigint, ie_tipo_item_p text) RETURNS bigint AS $body$
DECLARE


/*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:   Obter a quantidade solicitada do item da requisição a partir do nr_sequencia do item da guia.
Se a operadora não estiver parametrizada para trabalhar com Requisições, é retornado NULL.
----------------------------------------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [  ] Tasy (Delphi/Java) [ x ] Portal [  ] Relatórios [ ] Outros:
 ----------------------------------------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
IE_TIPO_ITEM
	'M' -> Material
	'P' -> Procedimento
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/qt_item_solic_w			double precision;
ie_funcao_atend_utilizada_w	varchar(1);


BEGIN

ie_funcao_atend_utilizada_w := substr(pls_obter_param_atend_geral('FA'), 1, 1);

if ( ie_funcao_atend_utilizada_w = '2'/*Requisição*/
 ) then
	if ( ie_tipo_item_p = 'P'/*Procedimento*/
 ) then

		-- Selectiona a guia do item, a requisição através da guia e o item pela requisição.
		select	rp.qt_solicitado
		into STRICT	qt_item_solic_w
		from	pls_requisicao_proc rp,
			pls_guia_plano_proc gp,
			pls_execucao_requisicao ex
		where	rp.nr_seq_requisicao	= ex.nr_seq_requisicao
		and	ex.nr_seq_guia		= gp.nr_seq_guia
		and	rp.cd_procedimento	= gp.cd_procedimento
		and	rp.ie_origem_proced	= gp.ie_origem_proced
		and	gp.nr_sequencia		= nr_seq_item_p;
	elsif ( ie_tipo_item_p = 'M'/*Material*/
 ) then
		-- Selectiona a guia do item, a requisição através da guia e o item pela requisição.
		select	rm.qt_solicitado
		into STRICT	qt_item_solic_w
		from	pls_requisicao_mat rm,
			pls_guia_plano_mat gm,
			pls_execucao_requisicao ex
		where	rm.nr_seq_requisicao	= ex.nr_seq_requisicao
		and	ex.nr_seq_guia		= gm.nr_seq_guia
		and	rm.nr_seq_material	= gm.nr_seq_material
		and	gm.nr_sequencia		= nr_seq_item_p;

	end if;
else
	--Se a operadora não está parametrizada para usar requisições então é retornado NULL
	qt_item_solic_w := null;
end if;

return	qt_item_solic_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_qt_req_item_solic_ws ( nr_seq_item_p bigint, ie_tipo_item_p text) FROM PUBLIC;

