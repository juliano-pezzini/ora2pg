-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_integracao_compras ( nr_solic_compra_p bigint, nr_cot_compra_p bigint, cd_material_P bigint, cd_cnpj_p text, ie_opcao_retorno_p text) RETURNS varchar AS $body$
DECLARE

 
/*ie_opcao_retorno_p 
1 - cd_estabelecimento 
2 - cd_comprador 
3 - ds_comprador 
4 - cd_pessoa_solicitante 
5 - ds_solicitante 
6 - ie_status_envio 
7 - ds_status_envio 
 
*/
			 
			 
ds_retorno_w			varchar(255);
cd_estabelecimento_w		bigint;
cd_comprador_w			varchar(10);
ds_comprador_w			varchar(100);
cd_pessoa_solicitante_w		varchar(10);
ds_solicitante_w		varchar(100);
ie_status_envio_w		varchar(10);
ds_status_envio_w		varchar(100);


BEGIN 
 
if (nr_solic_compra_p > 0) then 
	 
	select	cd_estabelecimento, 
		cd_comprador_resp, 
		substr(sup_obter_nome_comprador(cd_estabelecimento, cd_comprador_resp),1,100) ds_comprador, 
		cd_pessoa_solicitante, 
		substr(obter_nome_pf_pj(cd_pessoa_solicitante,null),1,100) ds_solicitante, 
		ie_status_envio, 
		substr(obter_valor_dominio(4156,ie_status_envio),1,100) ds_status_envio 
	into STRICT	cd_estabelecimento_w, 
		cd_comprador_w, 
		ds_comprador_w, 
		cd_pessoa_solicitante_w, 
		ds_solicitante_w, 
		ie_status_envio_w, 
		ds_status_envio_w 
	from	solic_compra 
	where	nr_solic_compra = nr_solic_compra_p;
		 
elsif (nr_cot_compra_p > 0) then 
 
	select	cd_estabelecimento, 
		cd_comprador, 
		substr(sup_obter_nome_comprador(cd_estabelecimento, cd_comprador),1,100) ds_comprador, 
		cd_pessoa_solicitante, 
		substr(obter_nome_pf_pj(cd_pessoa_solicitante,null),1,100) ds_solicitante, 
		ie_status_envio, 
		substr(obter_valor_dominio(4156,ie_status_envio),1,100) ds_status_envio 
	into STRICT	cd_estabelecimento_w, 
		cd_comprador_w, 
		ds_comprador_w, 
		cd_pessoa_solicitante_w, 
		ds_solicitante_w, 
		ie_status_envio_w, 
		ds_status_envio_w 
	from	cot_compra 
	where	nr_cot_compra = nr_cot_compra_p;
 
elsif (cd_material_p > 0) then 
	 
	select	ie_status_envio, 
		substr(obter_valor_dominio(4156,ie_status_envio),1,100) ds_status_envio 
	into STRICT	ie_status_envio_w, 
		ds_status_envio_w 
	from	material 
	where	cd_material = cd_material_p;
 
elsif (cd_cnpj_p IS NOT NULL AND cd_cnpj_p::text <> '') then 
	 
	select	ie_status_envio, 
		substr(obter_valor_dominio(4156,ie_status_envio),1,100) ds_status_envio 
	into STRICT	ie_status_envio_w, 
		ds_status_envio_w 
	from	pessoa_juridica 
	where	cd_cgc = cd_cnpj_p;
	 
end if;
 
if (ie_opcao_retorno_p = 1) then 
	ds_retorno_w := cd_estabelecimento_w;
elsif (ie_opcao_retorno_p = 2) then 
	ds_retorno_w := cd_comprador_w;
elsif (ie_opcao_retorno_p = 3) then 
	ds_retorno_w := ds_comprador_w;
elsif (ie_opcao_retorno_p = 4) then 
	ds_retorno_w := cd_pessoa_solicitante_w;	
elsif (ie_opcao_retorno_p = 5) then 
	ds_retorno_w := ds_solicitante_w;
elsif (ie_opcao_retorno_p = 6) then 
	ds_retorno_w := ie_status_envio_w;
elsif (ie_opcao_retorno_p = 7) then 
	ds_retorno_w := ds_status_envio_w;
end if;
 
 
 
return	ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_integracao_compras ( nr_solic_compra_p bigint, nr_cot_compra_p bigint, cd_material_P bigint, cd_cnpj_p text, ie_opcao_retorno_p text) FROM PUBLIC;

