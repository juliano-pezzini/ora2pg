-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_quebra_texto (ds_texto_p text, qt_pos_inicial_p bigint, qt_tamanho_p bigint) RETURNS varchar AS $body$
DECLARE


i			bigint;
qt_pos_inicial_w	bigint;
qt_pos_final_w		bigint;
ds_texto_aux_w		varchar(4000);
ds_retorno_w		varchar(4000);
ds_texto_completo_w	varchar(4000);


type vetor is table of varchar(255) index by integer;

vetor_w	vetor;


BEGIN

ds_texto_aux_w		:= ds_texto_p;
i			:= 0;
qt_pos_inicial_w	:= qt_pos_inicial_p;
while(qt_pos_inicial_w	> 0) loop
	qt_pos_final_w		:= position(' ' in ds_texto_aux_w);
	if (qt_pos_final_w	= 0) then
		qt_pos_final_w	:= 9999;
	end if;
	vetor_w(i)		:= substr(ds_texto_aux_w, 1, qt_pos_final_w);
	if (qt_pos_final_w	= 9999) then
		qt_pos_inicial_w	:= 0;
	else
		qt_pos_inicial_w	:= length(vetor_w(i));
	end if;

	vetor_w(i)		:= trim(both vetor_w(i));

	ds_texto_aux_w		:= trim(both substr(ds_texto_aux_w, qt_pos_inicial_w, length(ds_texto_aux_w)));
	i			:= i+1;

end loop;

ds_retorno_w		:= '';
ds_texto_completo_w	:= '';
i			:= 0;
for i in 0..vetor_w.count - 1 loop
	ds_texto_completo_w	:= trim(both ds_texto_completo_w || ' ' || vetor_w(i));
	if (coalesce(length(ds_texto_completo_w),0) >= qt_pos_inicial_p) and ((qt_pos_inicial_p - coalesce(length(ds_texto_completo_w),0)) > 0) then
		ds_retorno_w	:= trim(both ds_retorno_w || ' ' || vetor_w(i));
	elsif	((coalesce(length(ds_retorno_w), 0) + length(vetor_w(i) || ' ')) <= qt_tamanho_p) and (coalesce(length(ds_texto_completo_w),0) > qt_pos_inicial_p) then
		ds_retorno_w	:= trim(both ds_retorno_w || ' ' || vetor_w(i));
	elsif (coalesce(length(ds_texto_completo_w),0) > qt_tamanho_p) then
		exit;
	end if;
end loop;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_quebra_texto (ds_texto_p text, qt_pos_inicial_p bigint, qt_tamanho_p bigint) FROM PUBLIC;

