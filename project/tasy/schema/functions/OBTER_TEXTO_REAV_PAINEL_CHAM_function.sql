-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_texto_reav_painel_cham (nr_atendimento_p text) RETURNS varchar AS $body$
DECLARE

 
ds_texto_w				varchar(2000) := '';
ds_texto_parametro_w	varchar(2000);
qt_reg_w				bigint;
		

BEGIN 
 
ds_texto_parametro_w := obter_param_usuario(1132, 32, obter_perfil_ativo, wheb_usuario_pck.get_nm_usuario, wheb_usuario_pck.get_cd_estabelecimento, ds_texto_parametro_w);
 
select	count(*) 
into STRICT	qt_reg_w 
from  atendimento_paciente 
where	(dt_chamada_reavaliacao IS NOT NULL AND dt_chamada_reavaliacao::text <> '') 
and 	coalesce(dt_inicio_reavaliacao::text, '') = '' 
and		nr_atendimento = nr_atendimento_p;
 
if (qt_reg_w > 0) and (ds_texto_parametro_w IS NOT NULL AND ds_texto_parametro_w::text <> '') then 
	 
	ds_texto_w := ' - '||ds_texto_parametro_w;
 
end if;
 
return substr(ds_texto_w,1,60);
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_texto_reav_painel_cham (nr_atendimento_p text) FROM PUBLIC;

