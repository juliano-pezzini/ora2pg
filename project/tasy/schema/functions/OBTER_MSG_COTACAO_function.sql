-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_msg_cotacao ( nr_cot_compra_p bigint, nr_item_cot_compra_p bigint, cd_cgc_fornecedor_venc_alt_p text, ds_mensagem_p text) RETURNS varchar AS $body$
DECLARE



ds_retorno_w			varchar(4000);
dt_fechamento_lic_w		timestamp;
nr_seq_reg_compra_w		bigint;
nr_seq_reg_licitacao_w	bigint;



BEGIN

if (nr_cot_compra_p IS NOT NULL AND nr_cot_compra_p::text <> '') then

	select	max(dt_fechamento_lic),
		max(nr_seq_reg_compra),
		max(nr_seq_reg_licitacao)
	into STRICT	dt_fechamento_lic_w,
		nr_seq_reg_compra_w,
		nr_seq_reg_licitacao_w
	from	cot_compra
	where	nr_cot_compra	= nr_cot_compra_p;


	if (dt_fechamento_lic_w IS NOT NULL AND dt_fechamento_lic_w::text <> '') then
		ds_retorno_w	:= wheb_mensagem_pck.get_texto(136219);
	elsif (NR_SEQ_REG_COMPRA_w IS NOT NULL AND NR_SEQ_REG_COMPRA_w::text <> '') then
		ds_retorno_w	:= wheb_mensagem_pck.get_texto( 136216 ,'NR_SEQ_REG_COMPRA='||NR_SEQ_REG_COMPRA_w);
	elsif (nr_seq_reg_licitacao_w IS NOT NULL AND nr_seq_reg_licitacao_w::text <> '') then
		ds_retorno_w	:= wheb_mensagem_pck.get_texto( 136210 ,'NR_SEQ_REG_LICITACAO='||nr_seq_reg_licitacao_w);
	elsif (ds_mensagem_p IS NOT NULL AND ds_mensagem_p::text <> '') then
		ds_retorno_w	:= ds_mensagem_p;
	elsif (cd_cgc_fornecedor_venc_alt_p IS NOT NULL AND cd_cgc_fornecedor_venc_alt_p::text <> '') then

		select	max(ds_motivo_venc_alt || chr(13) || chr(10) || substr( obter_desc_expressao(327458) || obter_valor_dominio(4444, ie_motivo_alter_venc),1,255))  	ds_motivo_venc_alt
		into STRICT	ds_retorno_w
		from	cot_compra_item
		where 	nr_cot_compra = nr_cot_compra_p
		and	nr_item_cot_compra = nr_item_cot_compra_p;

	end if;


end if;


return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_msg_cotacao ( nr_cot_compra_p bigint, nr_item_cot_compra_p bigint, cd_cgc_fornecedor_venc_alt_p text, ds_mensagem_p text) FROM PUBLIC;

