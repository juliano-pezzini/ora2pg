-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_atend_sumario_alta ( cd_paciente_p text, opcao_p text) RETURNS varchar AS $body$
DECLARE


       ds_retorno_w varchar(255 );
       ds_causa_morte_w atend_sumario_alta.ds_causa_morte%type;
       ie_necropsia_w varchar(1 );


BEGIN
       begin
if (cd_paciente_p IS NOT NULL AND cd_paciente_p::text <> '') then
       select distinct
              ds_causa_morte ,
              a.ie_necropsia
       into STRICT
              ds_causa_morte_w ,
              ie_necropsia_w
       from
              atendimento_paciente x ,
              atend_sumario_alta a
       where
              a.nr_atendimento       = x.nr_atendimento
              and x.cd_pessoa_fisica = cd_paciente_p
              and a.cd_motivo_alta   =7;
end if;

if (opcao_p='N') then
       ds_retorno_w:=ie_necropsia_w;

 elsif (opcao_p='R') then
       ds_retorno_w:=ds_causa_morte_w;
end if;

exception
when others then
	 ds_retorno_w:='';
end;
return ds_retorno_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_atend_sumario_alta ( cd_paciente_p text, opcao_p text) FROM PUBLIC;

