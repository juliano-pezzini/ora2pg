-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION manipular_json_medreceita ( acao_p text, nr_seq_med_receita_p med_receita.nr_sequencia%type, dt_receita_p med_receita.dt_receita%type, ds_receita_p med_receita.ds_receita%type, nr_atendimento_hosp_p med_receita.nr_atendimento_hosp%type, cd_pessoa_fisica_p med_receita.cd_pessoa_fisica%type, cd_medico_p med_receita.cd_medico%type, ie_tipo_receita_p med_receita.ie_tipo_receita%type, ie_situacao_p med_receita.ie_situacao%type, cd_perfil_ativo_p med_receita.cd_perfil_ativo%type, ie_rn_p med_receita.ie_rn%type, ie_restricao_visualizacao_p med_receita.ie_restricao_visualizacao%type, ie_nivel_atencao_p med_receita.ie_nivel_atencao%type, ds_utc_p med_receita.ds_utc%type, ie_acao_p med_receita.ie_acao%type, dt_vigencia_p med_receita.dt_vigencia%type, cd_ext_referencia_p med_receita.cd_ext_referencia%type, ie_ext_certdigital_p med_receita.ie_ext_certdigital%type, ds_ext_codvalidacao_p med_receita.ds_ext_codvalidacao%type, cd_ext_idprescricao_p med_receita.cd_ext_idprescricao%type, ie_ext_especial_p med_receita.ie_ext_especial%type, dt_ext_criacao_p med_receita.dt_ext_criacao%type, ie_ext_recpapel_p med_receita.ie_ext_recpapel%type, ie_ext_assinada_p med_receita.ie_ext_assinada%type, ds_ext_urlpdf_p med_receita.ds_ext_urlpdf%type, ds_ext_recurlpdf_p med_receita.ds_ext_recurlpdf%type, ds_ext_atsurlpdf_p med_receita.ds_ext_atsurlpdf%type, ds_ext_exmurlpdf_p med_receita.ds_ext_exmurlpdf%type) RETURNS MED_RECEITA.NR_SEQUENCIA%TYPE AS $body$
DECLARE


nr_seq_med_receita_w     med_receita.nr_sequencia%type;


BEGIN
    if (acao_p = 'I') then
    begin
        select   nextval('med_receita_seq')
        into STRICT     nr_seq_med_receita_w
;

        insert into med_receita(  nr_sequencia,
           dt_atualizacao,
	   nm_usuario,
	   dt_receita,
	   ds_receita,
           nr_atendimento_hosp,cd_pessoa_fisica,cd_medico,
	   ie_tipo_receita,ie_situacao,cd_perfil_ativo,
           ie_rn,ie_restricao_visualizacao,
           ie_nivel_atencao,ds_utc,
           dt_atualizacao_nrec,nm_usuario_nrec,
           ie_acao,dt_vigencia,
           cd_ext_referencia,ie_ext_certdigital,
	   ds_ext_codvalidacao)
        values (  nr_seq_med_receita_w,
           clock_timestamp(),
	   wheb_usuario_pck.get_nm_usuario,
	   clock_timestamp(),
	   ds_receita_p,
           nr_atendimento_hosp_p,
	   cd_pessoa_fisica_p,
	   cd_medico_p,
	   ie_tipo_receita_p,
	   ie_situacao_p,
	   cd_perfil_ativo_p,
           ie_rn_p,
	   ie_restricao_visualizacao_p,
           ie_nivel_atencao_p,
	   ds_utc_p,
           clock_timestamp(),
	   wheb_usuario_pck.get_nm_usuario,
           ie_acao_p,
	   dt_vigencia_p,
           cd_ext_referencia_p,
	   ie_ext_certdigital_p,
	   ds_ext_codvalidacao_p
	);
    end;
    elsif (acao_p = 'U') then
    begin
      nr_seq_med_receita_w := nr_seq_med_receita_p;
       update med_receita
       set cd_ext_idprescricao = cd_ext_idprescricao_p,
           ie_ext_especial     = ie_ext_especial_p,
           dt_ext_criacao      = dt_ext_criacao_p,
           ie_ext_recpapel     = ie_ext_recpapel_p,
           ie_ext_assinada     = ie_ext_assinada_p,
           ds_ext_urlpdf       = ds_ext_urlpdf_p,
           ds_ext_recurlpdf    = ds_ext_recurlpdf_p,
           ds_ext_atsurlpdf    = ds_ext_atsurlpdf_p,
           ds_ext_exmurlpdf    = ds_ext_exmurlpdf_p
        where nr_sequencia = nr_seq_med_receita_p;
    end;
   else
   begin
     nr_seq_med_receita_w := nr_seq_med_receita_p;
   end;
  end if;
 return nr_seq_med_receita_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION manipular_json_medreceita ( acao_p text, nr_seq_med_receita_p med_receita.nr_sequencia%type, dt_receita_p med_receita.dt_receita%type, ds_receita_p med_receita.ds_receita%type, nr_atendimento_hosp_p med_receita.nr_atendimento_hosp%type, cd_pessoa_fisica_p med_receita.cd_pessoa_fisica%type, cd_medico_p med_receita.cd_medico%type, ie_tipo_receita_p med_receita.ie_tipo_receita%type, ie_situacao_p med_receita.ie_situacao%type, cd_perfil_ativo_p med_receita.cd_perfil_ativo%type, ie_rn_p med_receita.ie_rn%type, ie_restricao_visualizacao_p med_receita.ie_restricao_visualizacao%type, ie_nivel_atencao_p med_receita.ie_nivel_atencao%type, ds_utc_p med_receita.ds_utc%type, ie_acao_p med_receita.ie_acao%type, dt_vigencia_p med_receita.dt_vigencia%type, cd_ext_referencia_p med_receita.cd_ext_referencia%type, ie_ext_certdigital_p med_receita.ie_ext_certdigital%type, ds_ext_codvalidacao_p med_receita.ds_ext_codvalidacao%type, cd_ext_idprescricao_p med_receita.cd_ext_idprescricao%type, ie_ext_especial_p med_receita.ie_ext_especial%type, dt_ext_criacao_p med_receita.dt_ext_criacao%type, ie_ext_recpapel_p med_receita.ie_ext_recpapel%type, ie_ext_assinada_p med_receita.ie_ext_assinada%type, ds_ext_urlpdf_p med_receita.ds_ext_urlpdf%type, ds_ext_recurlpdf_p med_receita.ds_ext_recurlpdf%type, ds_ext_atsurlpdf_p med_receita.ds_ext_atsurlpdf%type, ds_ext_exmurlpdf_p med_receita.ds_ext_exmurlpdf%type) FROM PUBLIC;

