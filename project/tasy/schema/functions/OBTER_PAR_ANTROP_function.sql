-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_par_antrop ( nr_atendimento_p bigint, ie_tipo_p text, peso_p bigint, altura_p bigint, dt_registro_p timestamp, anos_p bigint default null, meses_p bigint default null, qt_imc_p bigint default null) RETURNS varchar AS $body$
DECLARE


ds_retorno_w 	varchar(255);
anos_w		bigint;
meses_w		bigint;
parametro_p	bigint;
nr_sequencia_w	bigint;
sql_w varchar(3000);


qt_1_w			real;
qt_3_w			real;
qt_5_w			real;
qt_15_w			real;
qt_25_w			real;
qt_50_w			real;
qt_75_w			real;
qt_85_w			real;
qt_95_w			real;
qt_97_w			real;
qt_99_w			real;

ie_valor_inicio_w	varchar(3);
ie_valor_final_w	varchar(3);
ie_valor_igual_w	varchar(3);

cd_pf_w 		bigint;
ds_sexo_w 		varchar(1);
meses_calc_w	bigint;


BEGIN

	SELECT * FROM Obter_percentil(nr_atendimento_p, ie_tipo_p, peso_p, altura_p, dt_registro_p, anos_p, meses_p, qt_imc_p, qt_1_w, qt_3_w, qt_5_w, qt_15_w, qt_25_w, qt_50_w, qt_75_w, qt_85_w, qt_95_w, qt_97_w, qt_99_w) INTO STRICT qt_1_w, qt_3_w, qt_5_w, qt_15_w, qt_25_w, qt_50_w, qt_75_w, qt_85_w, qt_95_w, qt_97_w, qt_99_w;

  begin
    sql_w := 'BEGIN obter_valores_par_antrop_md(:1, :2, :3, :4, :5, :6, :7, :8, :9, :10, :11, :12, :13, :14, :15, :16, :17, :18, :19, :20); END;';

    EXECUTE sql_w USING IN ie_tipo_p,
                                  IN peso_p,
                                  IN qt_imc_p,
                                  IN altura_p,
                                  OUT ie_valor_inicio_w,
                                  OUT ie_valor_final_w,
                                  OUT ie_valor_igual_w,
                                  IN qt_97_w,
                                  IN qt_99_w,
                                  IN qt_95_w,
                                  IN qt_85_w,
                                  IN qt_75_w,
                                  IN qt_50_w,
                                  IN qt_25_w,
                                  IN qt_15_w,
                                  IN qt_5_w,
                                  IN qt_3_w,
                                  IN qt_1_w,
                                  OUT ds_retorno_w,
                                  IN anos_w;
  exception
    when others then
      ie_valor_inicio_w    := null;
      ie_valor_final_w     := null;
      ie_valor_igual_w     := null;
      ds_retorno_w         := null;
  end;
      sql_w := null;	


  begin 
      sql_w := 'CALL obter_ds_retorno_par_antrop_md(:1, :2, :3, :4) INTO :ds_retorno_w';
      EXECUTE sql_w USING IN ie_tipo_p,
                                    IN ie_valor_igual_w,
                                    IN ie_valor_inicio_w,
                                    IN ie_valor_final_w,                                 
                                    OUT ds_retorno_w;
  exception
    when others then
      ds_retorno_w := null;
  end;
      sql_w := null;

if (ie_tipo_p = 'AIP') then
	select	max(qt_50)
	into STRICT	ds_retorno_w
	from 	w_aval_who
	where 	qt_anos = anos_p
	and 	ie_sexo = ds_sexo_w
	and		qt_meses = meses_w
	and ie_tipo = ie_tipo_p;
end if;

return ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_par_antrop ( nr_atendimento_p bigint, ie_tipo_p text, peso_p bigint, altura_p bigint, dt_registro_p timestamp, anos_p bigint default null, meses_p bigint default null, qt_imc_p bigint default null) FROM PUBLIC;

