-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_regra_atributo3 ( nm_tabela_p text, nr_seq_visao_p bigint, cd_estabelecimento_p bigint, cd_perfil_p bigint, cd_funcao_p bigint, nm_usuario_p text) RETURNS varchar AS $body$
DECLARE


/* Fernando Piccini - 08/03/2013 */

nm_atributo_p	varchar(50);
qt_tam_max_p	integer;
qt_tam_min_p	integer;
ds_tam_min_p	varchar(2000) := '';
ds_tam_max_p	varchar(2000) := '';

C01 CURSOR FOR
	SELECT	nm_atributo,
		qt_tam_max,
		qt_tam_min
	from	tabela_atrib_regra
	where	nm_tabela 		= nm_tabela_p
	and ((qt_tam_max IS NOT NULL AND qt_tam_max::text <> '') or (qt_tam_min IS NOT NULL AND qt_tam_min::text <> ''))
	and	coalesce(cd_estabelecimento,	cd_estabelecimento_p)	= cd_estabelecimento_p
	and	coalesce(cd_perfil, 		cd_perfil_p)		= cd_perfil_p
	and	coalesce(cd_funcao, 		cd_funcao_p)		= cd_funcao_p
	and	coalesce(nm_usuario_param, 	nm_usuario_p) 		= nm_usuario_p
	and	coalesce(nr_seq_visao, 	nr_seq_visao_p)		= nr_seq_visao_p
	order by
		coalesce(nm_usuario_param,'AAA'),
		coalesce(cd_perfil,0),
		coalesce(cd_estabelecimento,0),
		coalesce(cd_funcao,0),
		coalesce(nr_seq_visao,0),
		coalesce(nr_seq_regra_funcao,0);


BEGIN

open C01;
loop
fetch C01 into
	nm_atributo_p,
	qt_tam_max_p,
	qt_tam_min_p;
EXIT WHEN NOT FOUND; /* apply on C01 */
	if (qt_tam_min_p IS NOT NULL AND qt_tam_min_p::text <> '') then
		ds_tam_min_p	:= ds_tam_min_p || nm_atributo_p || '=' || qt_tam_min_p || ';';
	end	if;
	if (qt_tam_max_p IS NOT NULL AND qt_tam_max_p::text <> '') then
		ds_tam_max_p	:= ds_tam_max_p || nm_atributo_p || '=' || qt_tam_max_p || ';';
	end	if;
end	loop;
close C01;

return(ds_tam_min_p || '<FIM1>' || ds_tam_max_p || '<FIM2>');

end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_regra_atributo3 ( nm_tabela_p text, nr_seq_visao_p bigint, cd_estabelecimento_p bigint, cd_perfil_p bigint, cd_funcao_p bigint, nm_usuario_p text) FROM PUBLIC;

