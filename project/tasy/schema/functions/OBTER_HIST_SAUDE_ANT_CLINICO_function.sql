-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_hist_saude_ant_clinico (nr_sequencia_p bigint) RETURNS varchar AS $body$
DECLARE


ds_retorno_w		varchar(4000);
ds_status_w		varchar(60);
dt_inicio_w		timestamp;
dt_fim_w		timestamp;
ds_abordagem_w		varchar(255);
ds_observacao_w		varchar(255);
ds_duracao_w		varchar(20);


BEGIN

select	substr(obter_valor_dominio(1332,ie_status),1,60),
	dt_inicio,
	dt_fim,
	ds_abordagem,
	ds_observacao,
	substr(obter_idade(dt_inicio,coalesce(dt_fim,clock_timestamp()),'S'),1,20)
into STRICT	ds_status_w,
	dt_inicio_w,
	dt_fim_w,
	ds_abordagem_w,
	ds_observacao_w,
	ds_duracao_w
from	paciente_antec_clinico
where	nr_sequencia	= nr_sequencia_p;

ds_retorno_w	:= wheb_mensagem_pck.get_texto(309160) || '  '||to_char(dt_inicio_w,'dd/mm/yyyy') || chr(13) || chr(10);

if (dt_fim_w IS NOT NULL AND dt_fim_w::text <> '') then
	ds_retorno_w	:= wheb_mensagem_pck.get_texto(309160) || '  '||to_char(dt_inicio_w,'dd/mm/yyyy')||' ' || wheb_mensagem_pck.get_texto(309164) || ' '||to_char(dt_fim_w,'dd/mm/yyyy')||'   ' || wheb_mensagem_pck.get_texto(309167) || ' '||ds_duracao_w||chr(13) || chr(10);
end if;

if (ds_status_w IS NOT NULL AND ds_status_w::text <> '') then
	ds_retorno_w	:= ds_retorno_w || wheb_mensagem_pck.get_texto(309189) || '  '||ds_status_w || chr(13) || chr(10); -- Status
end if;

if (ds_abordagem_w IS NOT NULL AND ds_abordagem_w::text <> '') then
	ds_retorno_w	:= ds_retorno_w || wheb_mensagem_pck.get_texto(309181) || '  '||ds_abordagem_w || chr(13) || chr(10);
end if;

if (ds_observacao_w IS NOT NULL AND ds_observacao_w::text <> '') then
	ds_retorno_w	:= ds_retorno_w || wheb_mensagem_pck.get_texto(309183) || '  '||ds_observacao_w || chr(13) || chr(10);
end if;

return ds_retorno_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_hist_saude_ant_clinico (nr_sequencia_p bigint) FROM PUBLIC;

