-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_periodo_data ( dt_referencia_p timestamp, ie_tipo_p text) RETURNS varchar AS $body$
DECLARE


/*	--IE_TIPO_P--
	D - Dia
	S - Semana do mês
	X - Decendio do mês
	Q - Quinzena do mês
	M - Mês
	T - Trimestre
	A - Ano
	U - Quadrimestre
	B - Bimestre
	E - Semestre
*/
vl_retorno_w	varchar(2);


BEGIN

if (ie_tipo_p = 'D') then
	select	to_char(dt_referencia_p,'dd')
	into STRICT	vl_retorno_w
	;

elsif (ie_tipo_p = 'S') then
	select	to_char(dt_referencia_p,'w')
	into STRICT	vl_retorno_w
	;

elsif (ie_tipo_p = 'X') then
	select	vl_retorno
	into STRICT	vl_retorno_w
	from (
		SELECT	'01' vl_retorno
		
		where	(to_char(dt_referencia_p,'dd'))::numeric  <= 10
		
UNION

		SELECT	'02' vl_retorno
		
		where ((to_char(dt_referencia_p,'dd'))::numeric  > 10 and (to_char(dt_referencia_p,'dd'))::numeric  <= 20)
		
UNION

		select	'03' vl_retorno
		
		where	(to_char(dt_referencia_p,'dd'))::numeric  > 20) alias10;

elsif (ie_tipo_p = 'Q') then
	select	vl_retorno
	into STRICT	vl_retorno_w
	from (
		SELECT	'01' vl_retorno
		
		where	(to_char(dt_referencia_p,'dd'))::numeric  <= 15
		
UNION

		SELECT	'02' vl_retorno
		
		where	(to_char(dt_referencia_p,'dd'))::numeric  > 15) alias5;

elsif (ie_tipo_p = 'M') then
	select	to_char(dt_referencia_p,'mm')
	into STRICT	vl_retorno_w
	;

elsif (ie_tipo_p = 'T') then
	select	vl_retorno
	into STRICT	vl_retorno_w
	from (
		SELECT	'01' vl_retorno
		
		where	to_char(dt_referencia_p,'mm') in ('01','02','03')
		
UNION

		SELECT	'02' vl_retorno
		
		where	to_char(dt_referencia_p,'mm') in ('04','05','06')
		
UNION

		select	'03' vl_retorno
		
		where	to_char(dt_referencia_p,'mm') in ('07','08','09')
		
UNION

		select	'04' vl_retorno
		
		where	to_char(dt_referencia_p,'mm') in ('10','11','12')) alias9;

elsif (ie_tipo_p = 'A') then
	select	to_char(dt_referencia_p,'yy')
	into STRICT	vl_retorno_w
	;

elsif (ie_tipo_p = 'U') then
	select	vl_retorno
	into STRICT	vl_retorno_w
	from (
		SELECT	'01' vl_retorno
		
		where	to_char(dt_referencia_p,'mm') in ('01','02','03','04')
		
UNION

		SELECT	'02' vl_retorno
		
		where	to_char(dt_referencia_p,'mm') in ('05','06','07','08')
		
UNION

		select	'03' vl_retorno
		
		where	to_char(dt_referencia_p,'mm') in ('09','10','11','12')) alias7;

elsif (ie_tipo_p = 'B') then
	select	vl_retorno
	into STRICT	vl_retorno_w
	from (
		SELECT	'01' vl_retorno
		
		where	to_char(dt_referencia_p,'mm') in ('01','02')
		
UNION

		SELECT	'02' vl_retorno
		
		where	to_char(dt_referencia_p,'mm') in ('03','04')
		
UNION

		select	'03' vl_retorno
		
		where	to_char(dt_referencia_p,'mm') in ('05','06')
		
UNION

		select	'04' vl_retorno
		
		where	to_char(dt_referencia_p,'mm') in ('07','08')
		
UNION

		select	'05' vl_retorno
		
		where	to_char(dt_referencia_p,'mm') in ('09','10')
		
UNION

		select	'06' vl_retorno
		
		where	to_char(dt_referencia_p,'mm') in ('11','12')) alias13;

elsif (ie_tipo_p = 'E') then
	select	vl_retorno
	into STRICT	vl_retorno_w
	from (
		SELECT	'01' vl_retorno
		
		where	to_char(dt_referencia_p,'mm') in ('01','02','03','04','05','06')
		
UNION

		SELECT	'02' vl_retorno
		
		where	to_char(dt_referencia_p,'mm') in ('07','08','09','10','11','12')) alias5;
end if;

return	lpad(vl_retorno_w,2,0);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_periodo_data ( dt_referencia_p timestamp, ie_tipo_p text) FROM PUBLIC;

