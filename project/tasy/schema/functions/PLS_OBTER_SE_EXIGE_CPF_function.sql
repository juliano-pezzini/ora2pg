-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_se_exige_cpf ( dt_nascimento_p text, nr_seq_usuario_p bigint ) RETURNS varchar AS $body$
DECLARE

 
/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
Finalidade: 
Utilizada para verificar se o preenchimento do CPF será obrigatório nos cadastros de beneficiários 
eventuais, de acordo com a idade mínima cadastrada no parâmetro [3] - Idade mínima para exigência de CPF no cadastro do beneficiário, 
da função OPSW - Identificação de beneficiário. 
------------------------------------------------------------------------------------------------------------------- 
Locais de chamada direta: 
[ ] Objetos do dicionário [ ] Tasy (Delphi/Java) [  ] Portal [ X] Relatórios [ ] Outros: 
 ------------------------------------------------------------------------------------------------------------------ 
Pontos de atenção: 
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
 
 
ds_retorno_w			varchar(10) := 'N';
nr_seq_perfil_web_w		pls_perfil_web.nr_sequencia%type;
qt_idade_min_cpf_w		smallint;
qt_idade_min_cpf_ww		varchar(10);
qt_idade_w			smallint;
vl_parametros_w			varchar(2000);


BEGIN 
if (nr_seq_usuario_p IS NOT NULL AND nr_seq_usuario_p::text <> '' AND dt_nascimento_p IS NOT NULL AND dt_nascimento_p::text <> '') then 
	begin 
		select	nr_seq_perfil_web 
		into STRICT	nr_seq_perfil_web_w 
		from	pls_usuario_web 
		where	nr_sequencia	= nr_seq_usuario_p;
	exception 
	when others then 
		nr_seq_perfil_web_w	:= null;
	end;
	vl_parametros_w := pls_obter_parametros_funcao(null, null, nr_seq_usuario_p, null, '1294', null, 'P', null, nr_seq_perfil_web_w, null, vl_parametros_w);	
	qt_idade_min_cpf_ww	:= pls_obter_valor_parametro(3, vl_parametros_w);	
	qt_idade_w		:= (coalesce(Obter_Idade(dt_nascimento_p, clock_timestamp(), 'A'), 0))::numeric;
	 
	if (qt_idade_min_cpf_ww IS NOT NULL AND qt_idade_min_cpf_ww::text <> '') then 
		qt_idade_min_cpf_w	:= (Somente_Numero(qt_idade_min_cpf_ww))::numeric;	
		if (qt_idade_min_cpf_w <> 0) then 
			if (qt_idade_w >= qt_idade_min_cpf_w) then 
				ds_retorno_w	:= 'S';
			else 
				ds_retorno_w	:= 'N';
			end if;	
		else		 
			ds_retorno_w	:= 'S';
		end if;
	end if;
end if;
 
return	ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_se_exige_cpf ( dt_nascimento_p text, nr_seq_usuario_p bigint ) FROM PUBLIC;

