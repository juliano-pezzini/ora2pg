-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_material ( cd_material_p bigint, ie_tipo_dado_p text) RETURNS varchar AS $body$
DECLARE


/* OJP - Obriga justificativa padrão
   SIT - Situacao
   UME - Unidade Medida Estoque
   UMC - Unidade Medida Consumo
   UMP - Unidade Medida Compra
   UMS - Unidade Medida Solicitacao
   CON - Tipo consignado
   EST - Material de estoque
   MCD - Disponivel Mercado
   TIP - Tipo material
   CLA - Descrição da Classe
   CCLA - Código da Classe
   SUB - Descrição do SubGrupo
   CSUB - Código do SubGrupo
   CGRU - Código do Grupo
   GRU - Descrição do Grupo
   QEC - QT_Conv_Estoque_Consumo
   QCE - QT_Conv_Compra_Estoque
   D   - Descrição material
   DR - Descrição reduzida do material
   DC  - Descrição material comercial
   CLS - Classe e subgrupos concatenados
   REC - Receita (Port.344/98)
   L - Localização
   DL - Descrição da Localização
   QMS - qt_minimo_multiplo_solic
   NCA - Certificado aprovação
   CR - Código fabricante -- part number ou referência
   NRF - Número de sequencia do fabricante
   OJ - Obriga justificativa
   FA - Sequencia da família
   DFA - Descrição da família
   FT - Ficha técnica
   MSG - Mensagem
   EXTR - R extravazamento
   MC  - qt_melhor_compra
   DJG -Dias para nova Justif. Item Gas.
   CSA - Cod sistema ant
   PAPR - Prioridade apresentação
   CODM - Código do medicamento (CD_MEDICAMENTO)
   AV - Alta Vigilância
*/
ds_retorno_w			varchar(255);


BEGIN

if (ie_tipo_dado_p IS NOT NULL AND ie_tipo_dado_p::text <> '') then

	if (ie_tipo_dado_p = 'OJP')	then
		select	coalesce(obter_dados_medic_atb_var(max(a.cd_material),wheb_usuario_pck.get_cd_estabelecimento,max(a.ie_justificativa_padrao),'JP',null,null,null), 'N')
		into STRICT		ds_retorno_w
		from		material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'SIT') then
		select	max(a.ie_situacao)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'UME') then
		select	max(a.cd_unidade_medida_estoque)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'UMC') then
		select	max(a.cd_unidade_medida_consumo)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'UMP') then
		select	max(a.cd_unidade_medida_compra)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'UMS') then
		select	max(a.cd_unidade_medida_solic)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'CON') then
		select	max(a.ie_consignado)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'CSA') then
		select	max(a.cd_sistema_ant)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'MCD') then
		select	max(a.ie_disponivel_mercado)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'EST') then
		select	max(a.cd_material_estoque)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;
	elsif (ie_tipo_dado_p = 'GEN') then
		select	max(a.cd_material_generico)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;
	elsif (ie_tipo_dado_p = 'TIP') then
		select	max(a.ie_tipo_material)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'CLA') then
		select	substr(max(b.ds_classe_material),1,255)
		into STRICT	ds_retorno_w
		from	estrutura_material_v b
		where 	b.cd_material = cd_material_p;
	--Pietro
	elsif (ie_tipo_dado_p = 'CCLA') then
		select	substr(max(b.cd_classe_material),1,255)
		into STRICT	ds_retorno_w
		from	estrutura_material_v b
		where 	b.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'SUB') then
		select	substr(max(b.ds_subgrupo_material),1,255)
		into STRICT	ds_retorno_w
		from	estrutura_material_v b
		where 	b.cd_material = cd_material_p;
	--Pietro
	elsif (ie_tipo_dado_p = 'CSUB') then
		select	substr(max(b.cd_subgrupo_material),1,255)
		into STRICT	ds_retorno_w
		from	estrutura_material_v b
		where 	b.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'CGRU') then
		select	substr(max(b.cd_grupo_material),1,100)
		into STRICT	ds_retorno_w
		from	estrutura_material_v b
		where 	b.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'GRU') then
		select	substr(max(b.ds_grupo_material),1,255)
		into STRICT	ds_retorno_w
		from	estrutura_material_v b
		where 	b.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'QEC') then
		select	max(a.qt_conv_estoque_consumo)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'QCE') then
		select	max(a.qt_conv_compra_estoque)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'L') then
		select	max(a.nr_seq_localizacao)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'DL') then
		select	substr(Obter_Desc_Material_Local(max(a.nr_seq_localizacao)),1,60)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'D') then
		select	substr(max(a.ds_material),1,100)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'DR') then
		select	substr(max(a.ds_reduzida),1,100)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'QMS') then
		select	max(a.qt_minimo_multiplo_solic)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'CLS') then
		select	substr(max(b.ds_classe_material || ' - ' || b.ds_subgrupo_material),1,255)
		into STRICT	ds_retorno_w
		from	estrutura_material_v b
		where 	b.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'DC') then
		ds_retorno_w	:= substr(obter_mat_comercial(cd_material_p, 'D'),1,100);

	elsif (ie_tipo_dado_p = 'REC') then
		select	max(a.ie_receita)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'NCA') then
		select	max(a.nr_certificado_aprovacao)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'CR')	then
		select	max(a.cd_fabricante)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;
	--mmmacedo
	elsif (ie_tipo_dado_p = 'NRF') then
		select max(a.NR_SEQ_FABRIC)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'OJ')	then
		select	obter_dados_medic_atb_var(max(a.cd_material),wheb_usuario_pck.get_cd_estabelecimento,max(a.ie_obriga_justificativa),'OJ',null,null,null)
		into STRICT		ds_retorno_w
		from		material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'FA')	then
		select	max(a.nr_seq_familia)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'DFA')	then
		select	substr(obter_desc_familia_mat(max(a.nr_seq_familia)),1,255)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'FT')	then
		select	max(a.nr_seq_ficha_tecnica)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p	= 'MSG') then
		select	substr(max(a.ds_mensagem),1,254)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p	= 'EXTR') then
		select	max(a.ie_extravazamento)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p	= 'MC') then
		select	coalesce(max(a.qt_compra_melhor),0)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p	= 'DJG') then
		select	coalesce(max(a.nr_dias_justif),0)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'PAPR') then
		select	max(a.qt_prioridade_apres)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'CODM') then
		select	max(a.cd_medicamento)
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	elsif (ie_tipo_dado_p = 'AV') then
		select	coalesce(max(a.ie_alta_vigilancia),'N')
		into STRICT	ds_retorno_w
		from	material a
		where 	a.cd_material = cd_material_p;

	end if;

end if;

return ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_material ( cd_material_p bigint, ie_tipo_dado_p text) FROM PUBLIC;

