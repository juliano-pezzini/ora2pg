-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_situacao_especial (cd_cnpj_p text) RETURNS bigint AS $body$
DECLARE


ds_retorno_w		bigint := 0;
cd_tipo_pessoa_w	pessoa_juridica.cd_tipo_pessoa%type;
ie_orgao_publico_w	tipo_pessoa_juridica.ie_orgao_publico%type;
ie_conv_sus_w		varchar(1);


BEGIN

select	CASE WHEN count(*)=0 THEN 'N'  ELSE 'S' END
into STRICT	ie_conv_sus_w
from	convenio
where	cd_cgc	= cd_cnpj_p
and	ie_tipo_convenio = 3;

if (ie_conv_sus_w = 'S')then
	ds_retorno_w	:=	1;
else
	ds_retorno_w	:=	0;
end if;

if ds_retorno_w = 0 then
	select 	cd_tipo_pessoa
	into STRICT	cd_tipo_pessoa_w
	from 	pessoa_juridica
	where	cd_cgc = cd_cnpj_p;

	if (coalesce(cd_tipo_pessoa_w,0) <> 0)then

		select 	coalesce(ie_orgao_publico,'N')
		into STRICT	ie_orgao_publico_w
		from	tipo_pessoa_juridica
		where	cd_tipo_pessoa = cd_tipo_pessoa_w;

		if (ie_orgao_publico_w = 'S')then
			ds_retorno_w	:=	2;
		else
			ds_retorno_w	:=	0;
		end if;

	end if;
end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_situacao_especial (cd_cnpj_p text) FROM PUBLIC;

