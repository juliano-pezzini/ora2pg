-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_medico_principal ( NR_INTERNO_CONTA_P bigint, IE_FUNCAO_P text, IE_OPCAO_P text) RETURNS varchar AS $body$
DECLARE

 
cd_medico_principal_w	bigint;
nm_medico_principal_w	varchar(255);
nr_seq_propaci_w	bigint;
nr_atendimento_w	bigint;


BEGIN 
 
select 	coalesce(min(nr_sequencia),0) 
into STRICT 	nr_seq_propaci_w 
from 	procedimento_paciente 
where 	coalesce(cd_motivo_exc_conta::text, '') = '' 
and 	coalesce(ie_proc_princ_atend,'N') = 'S' 
and	nr_interno_conta = nr_interno_conta_p;
 
select 	d.cd_pessoa_fisica cd_medico, 
	substr(obter_nome_pessoa_fisica(d.CD_PESSOA_FISICA, NULL),1,100) nm_medico 
into STRICT	cd_medico_principal_w, 
	nm_medico_principal_w 
from 	procedimento_participante d, 
	procedimento_paciente b 
where 	b.nr_sequencia		= nr_seq_propaci_w 
and	b.nr_sequencia		= d.nr_sequencia 
and	d.ie_funcao	= ie_funcao_p;
 
if (ie_opcao_p 	= 'C') then 
	RETURN cd_medico_principal_w;
elsif (ie_opcao_p	= 'D') then 
	RETURN nm_medico_principal_w;
end if;
 
 
END 	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_medico_principal ( NR_INTERNO_CONTA_P bigint, IE_FUNCAO_P text, IE_OPCAO_P text) FROM PUBLIC;

