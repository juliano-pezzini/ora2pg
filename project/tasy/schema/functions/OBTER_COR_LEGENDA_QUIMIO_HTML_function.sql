-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_cor_legenda_quimio_html ( nr_sequencia_p bigint) RETURNS bigint AS $body$
DECLARE


cd_pessoa_fisica_w	varchar(10);
nm_paciente_w		varchar(80);
dt_confirmacao_w	timestamp;
ie_status_agenda_w	varchar(2);
ie_encaixe_w		varchar(1);
cd_retorno_w		bigint;


BEGIN

cd_retorno_w := 0;

if (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '') then

	select 	cd_pessoa_fisica,
			nm_paciente,
			dt_confirmacao,
			ie_status_agenda,
			ie_encaixe
	into STRICT	cd_pessoa_fisica_w,
			nm_paciente_w,
			dt_confirmacao_w,
			ie_status_agenda_w,
			ie_encaixe_w
	from	agenda_consulta
	where	nr_sequencia = nr_sequencia_p;


	if ( ( (cd_pessoa_fisica_w IS NOT NULL AND cd_pessoa_fisica_w::text <> '') or (nm_paciente_w IS NOT NULL AND nm_paciente_w::text <> '')) and ( coalesce(dt_confirmacao_w::text, '') = '' ) and
		not( 	ie_status_agenda_w = 'A' or
				ie_status_agenda_w = 'O' or
				ie_status_agenda_w = 'E' or
				ie_status_agenda_w = 'AD' ) and
				ie_encaixe_w = 'S' ) then

				cd_retorno_w := 833;
	elsif ( ((cd_pessoa_fisica_w IS NOT NULL AND cd_pessoa_fisica_w::text <> '') or (nm_paciente_w IS NOT NULL AND nm_paciente_w::text <> '')) and (coalesce(dt_confirmacao_w::text, '') = '') and
		not( 	ie_status_agenda_w = 'L' or
				ie_status_agenda_w = 'F' or
				ie_status_agenda_w = 'I' or
				ie_status_agenda_w = 'A' or
				ie_status_agenda_w = 'O' or
				ie_status_agenda_w = 'AD' or
				ie_status_agenda_w = 'ET' or
				ie_status_agenda_w = 'AR' or
				ie_status_agenda_w = 'AC' or
				ie_status_agenda_w = 'E' )) then

				cd_retorno_w := 834;

	elsif ( ((cd_pessoa_fisica_w IS NOT NULL AND cd_pessoa_fisica_w::text <> '') or (nm_paciente_w IS NOT NULL AND nm_paciente_w::text <> '')) and (dt_confirmacao_w IS NOT NULL AND dt_confirmacao_w::text <> '') and
			not( 	ie_status_agenda_w = 'A' or
					ie_status_agenda_w = 'O' or
					ie_status_agenda_w = 'E' or
					ie_status_agenda_w = 'AD' )) then

					cd_retorno_w := 835;

    end if;

end if;

return	cd_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_cor_legenda_quimio_html ( nr_sequencia_p bigint) FROM PUBLIC;

