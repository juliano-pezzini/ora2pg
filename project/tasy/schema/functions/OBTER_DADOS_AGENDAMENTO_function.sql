-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_agendamento (nr_seq_agenda_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE

 
/* 
ie_opcao_p -> futuras customizaçoes. 
 
CDP - CÓDIGO PESSOA FISICA DO PACIENTE. 
CSA - CÓDIGO DO SETOR DA AGENDA 
 
*/
 
 
cd_pessoa_fisica_w 	bigint:=NULL;
CD_SETOR_AGENDA_W	bigint:=NULL;
ds_retorno_w		varchar(4000):=NULL;


BEGIN 
 
IF ie_opcao_p = 'CDP' THEN 
	SELECT 	MAX(a.cd_pessoa_fisica) 
	INTO STRICT	cd_pessoa_fisica_w 
	FROM  	agenda_consulta a 
	WHERE 	a.nr_sequencia = nr_seq_agenda_p;
	ds_retorno_w := cd_pessoa_fisica_w;
END IF;
 
IF ie_opcao_p = 'CSA' THEN 
	SELECT	MAX(a.cd_setor) 
	INTO STRICT	cd_setor_agenda_w 
	FROM ( 
		SELECT 	MAX(coalesce(a.cd_setor_agenda,a.cd_setor_exclusivo)) cd_setor 
		FROM	agenda a, 
			agenda_consulta b 
		WHERE	a.cd_agenda 	= b.cd_agenda	 
		AND	b.nr_sequencia 	= nr_seq_agenda_p 
		
UNION
 
		SELECT 	MAX(coalesce(a.cd_setor_agenda,a.cd_setor_exclusivo)) 
		FROM	agenda a, 
			agenda_paciente b 
		WHERE	a.cd_agenda 	= b.cd_agenda	 
		AND	b.nr_sequencia 	= nr_seq_agenda_p 
	)a;
	DS_RETORNO_W := CD_SETOR_AGENDA_W;
END IF;
 
RETURN	ds_retorno_w;
 
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_agendamento (nr_seq_agenda_p bigint, ie_opcao_p text) FROM PUBLIC;

