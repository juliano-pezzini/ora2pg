-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION valida_campos_leito_integracao ( nr_seq_interno_p unidade_atendimento.nr_seq_interno%type, nm_leito_integracao_p unidade_atendimento.nm_leito_integracao%type, nm_setor_integracao_p unidade_atendimento.nm_setor_integracao%type ) RETURNS varchar AS $body$
DECLARE

	ds_setor_atendimento_w   setor_atendimento.ds_setor_atendimento%type;
	cd_unidade_basica_w      unidade_atendimento.cd_unidade_basica%type;
	cd_unidade_compl_w       unidade_atendimento.cd_unidade_compl%type;
	nm_retorno_msg_w         varchar(1000);

BEGIN
	select
		min(sa.ds_setor_atendimento) keep(dense_rank first order by nr_seq_interno) ds_setor_atendimento,
		min(ua.cd_unidade_basica) keep(dense_rank first order by nr_seq_interno) cd_unidade_basica,
		min(ua.cd_unidade_compl) keep(dense_rank first order by nr_seq_interno) cd_unidade_compl
	into STRICT
		ds_setor_atendimento_w,
		cd_unidade_basica_w,
		cd_unidade_compl_w
	from
		unidade_atendimento   ua,
		setor_atendimento     sa
	where
		ua.ie_situacao = 'A'
		and ua.cd_setor_atendimento = sa.cd_setor_atendimento
		and ua.nr_seq_interno <> nr_seq_interno_p
		and ua.nm_leito_integracao = nm_leito_integracao_p
		and ua.nm_setor_integracao = nm_setor_integracao_p
	order by
		nr_seq_interno;
	if (ds_setor_atendimento_w IS NOT NULL AND ds_setor_atendimento_w::text <> '') then select
		                                               replace(replace(replace(expressao_pck.obter_desc_expressao(1079844), '#@DS_SETOR_ATENDIMENTO#@'
		                                               , ds_setor_atendimento_w), '#@NM_UNIDADE_BASICA#@', cd_unidade_basica_w), '#@NM_UNIDADE_COMPL#@'
		                                               , cd_unidade_compl_w)
	                                               into STRICT nm_retorno_msg_w
	;
	end if;
	return nm_retorno_msg_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION valida_campos_leito_integracao ( nr_seq_interno_p unidade_atendimento.nr_seq_interno%type, nm_leito_integracao_p unidade_atendimento.nm_leito_integracao%type, nm_setor_integracao_p unidade_atendimento.nm_setor_integracao%type ) FROM PUBLIC;

