-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pfcs_get_encounter_device_name ( nr_encounter bigint, ds_filter_type text, cd_estabelecimento_p text ) RETURNS varchar AS $body$
DECLARE


ds_device varchar(100);

ie_telemetria varchar(5) :='S';
ie_rec_status varchar(5) :='S';
ie_not_rec_status varchar(5) :='F';


BEGIN

select
        eq.ds_equipamento into STRICT ds_device
			from
        unidade_atend_equip uae,
        equipamento eq,
        unidade_atendimento ua,
        atend_paciente_unidade apu,
        atendimento_paciente ap,
        cpoe_recomendacao cr,
        tipo_recomendacao tr,
        setor_atendimento sa
			where eq.cd_estabelecimento = cd_estabelecimento_p
      and eq.ie_tipo_equipamento = ds_filter_type
      and uae.cd_equipamento        = eq.cd_equipamento
			and uae.cd_unidade_basica       = ua.cd_unidade_basica
			and uae.cd_setor_atendimento    = ua.cd_setor_atendimento
			and ap.nr_atendimento         = apu.nr_atendimento
			and apu.cd_unidade_basica    = uae.cd_unidade_basica
			and apu.cd_setor_atendimento = uae.cd_setor_atendimento
			and apu.cd_unidade_compl     = uae.cd_unidade_compl
      and ap.nr_atendimento         = cr.nr_atendimento
      and cr.cd_recomendacao = tr.cd_tipo_recomendacao
      and uae.cd_setor_atendimento = sa.cd_setor_atendimento
      and tr.ie_telemetria = ie_telemetria
      and apu.nr_atendimento = nr_encounter  LIMIT 1;

return ds_device;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pfcs_get_encounter_device_name ( nr_encounter bigint, ds_filter_type text, cd_estabelecimento_p text ) FROM PUBLIC;

