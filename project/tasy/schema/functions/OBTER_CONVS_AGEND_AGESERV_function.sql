-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_convs_agend_ageserv ( dt_agendamento_p text, cd_estabelecimento_p bigint) RETURNS varchar AS $body$
DECLARE

 
ds_sql_w	varchar(2000);
ds_parametros_w	varchar(2000);
ds_retorno_w	varchar(4000);


BEGIN 
 
if (obter_se_convenio_lib_func(cd_estabelecimento_p, null, 866, 'QT', to_date(dt_agendamento_p, 'dd/mm/yyyy hh24:mi:ss')) = '0') then 
	begin 
	ds_sql_w	:= 
		'select	cd_convenio 
		from	convenio a 
		where	exists 
			(select	1 
			from	convenio_estabelecimento b 
			where	b.cd_estabelecimento = :cd_estabelecimento_p 
			and	b.cd_convenio = a.cd_convenio) 
		and	a.ie_situacao = ' || chr(39) || 'A' || chr(39);
 
	ds_parametros_w	:= 'cd_estabelecimento_p=' || cd_estabelecimento_p;
	end;
else 
	begin 
	ds_sql_w	:= 
		'select	cd_convenio 
		from	convenio 
		where	obter_se_convenio_lib_func(:cd_estabelecimento_p, cd_convenio, 866, null, :dt_agendamento_p) = ' || chr(39) || 'S' || chr(39) || ' 
		and	ie_situacao = ' || chr(39) || 'A' || chr(39);
 
	ds_parametros_w	:= 'cd_estabelecimento_p=' || cd_estabelecimento_p;
	ds_parametros_w	:= ds_parametros_w || ';dt_agendamento_p=' || dt_agendamento_p;
	end;
end if;
 
ds_retorno_w	:= obter_select_concatenado_bv(ds_sql_w, ds_parametros_w, ',');
 
return	ds_retorno_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_convs_agend_ageserv ( dt_agendamento_p text, cd_estabelecimento_p bigint) FROM PUBLIC;

