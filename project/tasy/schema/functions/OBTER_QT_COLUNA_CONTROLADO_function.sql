-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_qt_coluna_controlado ( ie_coluna_desejada_p bigint, ie_entrada_saida_p text, ie_tipo_requisicao_p text, ie_coluna_controlado_p bigint, cd_acao_p bigint, qt_estoque_p bigint) RETURNS bigint AS $body$
DECLARE


qt_coluna_w		double precision;
nr_coluna_w		bigint;
qt_estoque_w		double precision;

/* Coluna
	1 - Entrada
	2 - Saida
	3 - Perda
	4 - TransferÃªncia
*/
BEGIN

nr_coluna_w		:= 0;
qt_coluna_w		:= 0;
qt_estoque_w		:= coalesce(qt_estoque_p,0);

if (coalesce(ie_coluna_controlado_p,0) in (1,2,3,4,11,12,13,14)) then
	nr_coluna_w		:= ie_coluna_controlado_p;
elsif (ie_tipo_requisicao_p	in ('2','21')) then
	nr_coluna_w		:= 4;
elsif (ie_entrada_saida_p 	= 'E') then
	nr_coluna_w		:= 1;
else
	nr_coluna_w		:= 2;
end if;

if (cd_acao_p = '2') then
	begin

	if (nr_coluna_w = 11) then
		nr_coluna_w	:= 2;
	elsif (nr_coluna_w in (12,13,14)) then
		nr_coluna_w	:= 1;
	else
		qt_estoque_w		:= qt_estoque_w * -1;
	end if;

	end;
else
	begin

	if (nr_coluna_w = 11) then
		nr_coluna_w	:= 1;
	elsif (nr_coluna_w = 12) then
		nr_coluna_w	:= 2;
	elsif (nr_coluna_w = 13) then
		nr_coluna_w	:= 3;
	elsif (nr_coluna_w = 14) then
		nr_coluna_w	:= 4;
	end if;

	end;
end if;

if (nr_coluna_w = 4) and (ie_entrada_saida_p = 'E') then
	qt_estoque_w		:= qt_estoque_w * -1;
end if;

if (ie_coluna_desejada_p = nr_coluna_w) then
	qt_coluna_w		:= qt_estoque_w;
end if;

return qt_coluna_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 IMMUTABLE;
-- REVOKE ALL ON FUNCTION obter_qt_coluna_controlado ( ie_coluna_desejada_p bigint, ie_entrada_saida_p text, ie_tipo_requisicao_p text, ie_coluna_controlado_p bigint, cd_acao_p bigint, qt_estoque_p bigint) FROM PUBLIC;

