-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION mp_obter_proc_ativ_conexao (nr_seq_proc_obj_p bigint) RETURNS varchar AS $body$
DECLARE


ds_retorno_w			varchar(255)	:= null;
nr_seq_proc_obj_destino_w	bigint;
nr_seq_proc_obj_origem_w	bigint;
nr_seq_processo_destino_w	bigint;
nm_processo_w			varchar(255);
nm_objeto_w			varchar(255);
nr_seq_conexao_w		bigint;


BEGIN

if (nr_seq_proc_obj_p IS NOT NULL AND nr_seq_proc_obj_p::text <> '') then
	select	max(nr_seq_proc_obj_destino)
	into STRICT	nr_seq_proc_obj_destino_w
	from	mp_proc_obj_ref
	where	nr_seq_proc_obj_origem	= nr_seq_proc_obj_p;

	if (nr_seq_proc_obj_destino_w IS NOT NULL AND nr_seq_proc_obj_destino_w::text <> '') then
		select	b.nm_processo,
			a.nm_objeto
		into STRICT	nm_processo_w,
			nm_objeto_w
		from	mp_processo b,
			mp_processo_objeto a
		where	a.nr_seq_processo	= b.nr_sequencia
		and	a.nr_sequencia		= nr_seq_proc_obj_destino_w;

		ds_retorno_w	:= replace(replace(nm_processo_w,chr(13),null),chr(10),null) || '/' || chr(13) || replace(replace(nm_objeto_w,chr(13),null),chr(10),null);
	else
		/* Obter fluxo que está ligada no destino */

		select	max(a.nr_sequencia)
		into STRICT	nr_seq_conexao_w
		from	mp_processo_objeto a
		where	a.nr_seq_obj_origem	= nr_seq_proc_obj_p;

		if (nr_seq_conexao_w IS NOT NULL AND nr_seq_conexao_w::text <> '') then
			/* Obter atividade liga a conexão */

			select	max(a.nr_seq_obj_destino)
			into STRICT	nr_seq_proc_obj_destino_w
			from	mp_processo_objeto a
			where	a.nr_sequencia	= nr_seq_conexao_w;

			if (nr_seq_proc_obj_destino_w IS NOT NULL AND nr_seq_proc_obj_destino_w::text <> '') then

				/*Obter o objeto origem */

				select	max(a.nr_seq_proc_obj_origem)
				into STRICT	nr_seq_proc_obj_origem_w
				from	mp_proc_obj_ref a
				where	a.nr_seq_proc_obj_destino	= nr_seq_proc_obj_destino_w;

				if (nr_seq_proc_obj_origem_w IS NOT NULL AND nr_seq_proc_obj_origem_w::text <> '') then
					/* Obter fluxo do objeto origem */

					select	max(a.nr_sequencia)
					into STRICT	nr_seq_conexao_w
					from	mp_processo_objeto a
					where	a.nr_seq_obj_destino	= nr_seq_proc_obj_origem_w;

					if (nr_seq_conexao_w IS NOT NULL AND nr_seq_conexao_w::text <> '') then
						/* Obter atividade ligada a conexão */

						select	max(a.nr_seq_obj_origem)
						into STRICT	nr_seq_proc_obj_origem_w
						from	mp_processo_objeto a
						where	a.nr_sequencia	= nr_seq_conexao_w;

						if (nr_seq_proc_obj_origem_w IS NOT NULL AND nr_seq_proc_obj_origem_w::text <> '') then
							select	b.nm_processo,
								a.nm_objeto
							into STRICT	nm_processo_w,
								nm_objeto_w
							from	mp_processo b,
								mp_processo_objeto a
							where	a.nr_seq_processo	= b.nr_sequencia
							and	a.nr_sequencia		= nr_seq_proc_obj_origem_w;

							ds_retorno_w	:= replace(replace(nm_processo_w,chr(13),null),chr(10),null) || '/' || chr(13) || replace(replace(nm_objeto_w,chr(13),null),chr(10),null);
						end if;
					end if;
				end if;
			end if;
		end if;
	end if;
end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION mp_obter_proc_ativ_conexao (nr_seq_proc_obj_p bigint) FROM PUBLIC;

