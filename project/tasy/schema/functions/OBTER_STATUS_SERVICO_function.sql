-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_status_servico ( nr_atendimento_p bigint, nr_prescricao_p bigint, nr_seq_dieta_p bigint, dt_inicial_p timestamp, dt_final_p timestamp, dt_parametro_p timestamp) RETURNS varchar AS $body$
DECLARE


ie_status_w	varchar(15);


BEGIN

select	max(CASE WHEN coalesce(x.dt_bloqueio::text, '') = '' THEN CASE WHEN coalesce(d.dt_suspensao::text, '') = '' THEN x.ie_status_adep  ELSE 'S' END   ELSE 'B' END )
into STRICT	ie_status_w
from	prescr_dieta d,
	nut_atend_serv_dia x,
	nut_atend_serv_dia_rep c,
	nut_servico b
where	x.nr_atendimento 	= nr_atendimento_p
and	d.nr_prescricao		= nr_prescricao_p
and	d.nr_sequencia		= nr_seq_dieta_p
and	x.nr_seq_servico 	= b.nr_sequencia
and	x.dt_servico 		between dt_inicial_p and dt_final_p
and	x.dt_servico		= dt_parametro_p
and	c.nr_prescr_oral	= nr_prescricao_p
and	c.nr_seq_serv_dia 	= x.nr_sequencia
and 	((coalesce(b.IE_TIPO_PRESCRICAO_SERVICO::text, '') = '') or (b.IE_TIPO_PRESCRICAO_SERVICO = '1'));

return	ie_status_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_status_servico ( nr_atendimento_p bigint, nr_prescricao_p bigint, nr_seq_dieta_p bigint, dt_inicial_p timestamp, dt_final_p timestamp, dt_parametro_p timestamp) FROM PUBLIC;

