-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pfcs_get_distance_locale ( vl_latitude1_p bigint, vl_longitude1_p bigint, vl_latitude2_p bigint, vl_longitude2_p bigint, vl_radius_p bigint default 6387.7) RETURNS varchar AS $body$
DECLARE

-- Convert degrees to radians
vl_deg_to_rad_w 	bigint := 57.29577951;
ds_locale_w		user_locale.ds_locale%type;
ds_result_w		varchar(255);


BEGIN

if (vl_latitude1_p = vl_latitude2_p) and (vl_longitude1_p = vl_longitude2_p) then
	ds_result_w :=	0;
else
	ds_result_w :=	(coalesce(vl_radius_p,0) * acos((sin(coalesce(vl_latitude1_p,0) / vl_deg_to_rad_w) * sin(coalesce(vl_latitude2_p,0) / vl_deg_to_rad_w)) +
			(cos(coalesce(vl_latitude1_p,0) / vl_deg_to_rad_w) * cos(coalesce(vl_latitude2_p,0) / vl_deg_to_rad_w) *
			cos(coalesce(vl_longitude2_p,0) / vl_deg_to_rad_w - coalesce(vl_longitude1_p,0)/ vl_deg_to_rad_w))));
end if;
	
select	max(obtain_user_locale(wheb_usuario_pck.get_nm_usuario))
into STRICT	ds_locale_w
;

if (ds_locale_w = 'en_US') then
	ds_result_w := round(ds_result_w * 0.621371) || 'Mi';
else
	ds_result_w := round(ds_result_w) || 'Km';
end if;

return ds_result_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pfcs_get_distance_locale ( vl_latitude1_p bigint, vl_longitude1_p bigint, vl_latitude2_p bigint, vl_longitude2_p bigint, vl_radius_p bigint default 6387.7) FROM PUBLIC;

