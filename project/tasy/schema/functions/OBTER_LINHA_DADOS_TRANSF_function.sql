-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_linha_dados_transf ( nr_atendimento_p bigint, ie_opcao_p text, nr_linha_p bigint) RETURNS varchar AS $body$
DECLARE

 
ds_retorno_w			varchar(255);
dt_entrada_unidade_w		timestamp;


BEGIN 
 
SELECT 	a.dt_entrada_unidade 
INTO STRICT	dt_entrada_unidade_w 
FROM (SELECT b.*, 
	row_number() OVER () AS linha 
	FROM (	SELECT	c.dt_entrada_unidade 
		FROM	atend_paciente_unidade c 
		WHERE	c.nr_atendimento = nr_atendimento_p 
		AND 	coalesce(c.ie_passagem_setor, 'N') = 'N' 
		AND	obter_classif_setor(c.cd_setor_atendimento) IN (3,4) 
		AND	Obter_Tipo_Unidade_Atend(c.nr_atendimento, c.nr_seq_interno, c.ie_passagem_setor) = 'N' 
		ORDER BY c.dt_entrada_unidade) b 
			) a 
WHERE linha = nr_linha_p;
 
IF (ie_opcao_p = 'DEU') THEN 
	ds_retorno_w := TO_CHAR(dt_entrada_unidade_w,'dd/mm/yyyy hh24:mi:ss');
END IF;
 
RETURN	ds_retorno_w;
 
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_linha_dados_transf ( nr_atendimento_p bigint, ie_opcao_p text, nr_linha_p bigint) FROM PUBLIC;

