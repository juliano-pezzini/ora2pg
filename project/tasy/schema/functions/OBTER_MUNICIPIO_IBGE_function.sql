-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_municipio_ibge (CD_CEP_P text) RETURNS varchar AS $body$
DECLARE


cd_mun_ibge_w		varchar(6);


BEGIN

select 	coalesce(max(cd_municipio_ibge),0)
into STRICT 	cd_mun_ibge_w
from (SELECT	max(a.cd_municipio_ibge) cd_municipio_ibge
	from	sus_municipio b,
		cep_municipio a
	where	a.cd_municipio_ibge = b.cd_municipio_ibge
	and	a.cd_cep = cd_cep_p
	
union

	SELECT	max(a.cd_municipio_ibge) cd_municipio_ibge
	from	sus_municipio b,
		sus_cep a
	where	a.cd_municipio_ibge = b.cd_municipio_ibge
	and	a.cd_cep = cd_cep_p) alias4;

if (cd_mun_ibge_w = '0') then
	select 	max(cd_municipio_ibge)
	into STRICT	cd_mun_ibge_w
	from (SELECT	max(b.cd_municipio_ibge)cd_municipio_ibge
		from	sus_municipio b,
			cep_municipio a
		where	a.cd_municipio = b.cd_municipio_sinpas
		and	a.cd_cep = cd_cep_p
		
union

		SELECT	max(b.cd_municipio_ibge)cd_municipio_ibge
		from	sus_municipio b,
			sus_cep a
		where	a.cd_municipio_ibge = b.cd_municipio_sinpas
		and	a.cd_cep = cd_cep_p) alias4;
end if;

return campo_numerico(cd_mun_ibge_w);

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_municipio_ibge (CD_CEP_P text) FROM PUBLIC;

