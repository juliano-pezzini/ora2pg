-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_professional_account (nr_interno_conta_p bigint, cd_doctor_resp_p bigint) RETURNS varchar AS $body$
DECLARE




ds_retorno_w		varchar(60);
cd_profissional_w	varchar(10);

c01 CURSOR FOR
SELECT	b.cd_pessoa_fisica
from	procedimento_paciente b,
        pessoa_fisica c
where	b.nr_interno_conta	= nr_interno_conta_p
and     (b.cd_pessoa_fisica IS NOT NULL AND b.cd_pessoa_fisica::text <> '')
and     c.cd_pessoa_fisica	= b.cd_pessoa_fisica
and     c.nr_seq_conselho	= 18;


BEGIN
if (nr_interno_conta_p IS NOT NULL AND nr_interno_conta_p::text <> '') then

  open c01;
	loop
	fetch c01 into	cd_profissional_w;
		EXIT WHEN NOT FOUND; /* apply on c01 */
		begin
		cd_profissional_w	:= cd_profissional_w;
		end;
	end loop;
	close c01;

	if (cd_profissional_w IS NOT NULL AND cd_profissional_w::text <> '') then
				ds_retorno_w	:= cd_profissional_w;
  else
        ds_retorno_w	:=  cd_doctor_resp_p;
  end if;

end if;

return	ds_retorno_w;

end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_professional_account (nr_interno_conta_p bigint, cd_doctor_resp_p bigint) FROM PUBLIC;

