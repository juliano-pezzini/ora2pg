-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_oc_cta_obter_restr_prot ( ie_opcao_p text, dados_regra_p pls_tipos_ocor_pck.dados_regra, cursor_p integer, dados_filtro_prot_p pls_tipos_ocor_pck.dados_filtro_prot) RETURNS varchar AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:  Montar as restrições e binds dos campos de filtro de protocolo das ocorrências
combinadas
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  X]  Objetos do dicionário [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
Quando houver campo IMP, não esquecer de tratar..
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
/* IE_OPCAO_P

RESTRICAO -Obter restrições
BIND - Atualizar Binds

*/
ds_restricao_w		varchar(4000);


BEGIN

-- Inicializar as variáveis.
ds_restricao_w := null;

if (dados_filtro_prot_p.nr_sequencia IS NOT NULL AND dados_filtro_prot_p.nr_sequencia::text <> '') then
	-- Apresentacao
	if (dados_filtro_prot_p.ie_apresentacao <> 'T') then
		if (ie_opcao_p = 'RESTRICAO') then
			ds_restricao_w	:= ds_restricao_w || pls_tipos_ocor_pck.enter_w || 'and	prot.ie_apresentacao = :ie_apresentacao';
		else
			dbms_sql.bind_variable(cursor_p, ':ie_apresentacao', dados_filtro_prot_p.ie_apresentacao);
		end if;
	end if;

	if (dados_filtro_prot_p.cd_versao_tiss IS NOT NULL AND dados_filtro_prot_p.cd_versao_tiss::text <> '') then
		if (ie_opcao_p = 'RESTRICAO') then
			ds_restricao_w	:= ds_restricao_w || pls_tipos_ocor_pck.enter_w || 'and	prot.cd_versao_tiss = :cd_versao_tiss';
		else
			dbms_sql.bind_variable(cursor_p, ':cd_versao_tiss', dados_filtro_prot_p.cd_versao_tiss);
		end if;
	end if;
end if;

return	ds_restricao_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_oc_cta_obter_restr_prot ( ie_opcao_p text, dados_regra_p pls_tipos_ocor_pck.dados_regra, cursor_p integer, dados_filtro_prot_p pls_tipos_ocor_pck.dados_filtro_prot) FROM PUBLIC;

