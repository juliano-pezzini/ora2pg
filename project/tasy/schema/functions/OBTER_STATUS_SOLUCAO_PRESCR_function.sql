-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_status_solucao_prescr (ie_tipo_solucao_p bigint, nr_prescricao_p bigint, nr_seq_solucao_p bigint, ie_susp_remove_cpoe_p text default 'N') RETURNS varchar AS $body$
DECLARE


ie_status_w		varchar(3);
ie_status_aux_w		varchar(3);
qt_vol_infundido_w	double precision;
qt_vol_desprezado_w	double precision;
nr_sequencia_w		bigint;
nr_seq_nut_pac_w	nut_paciente.nr_sequencia%type;
ie_etapas_w         	smallint;
ie_troca_frasco_w	adep_motivo_interrupcao.ie_troca_frasco%type;
nr_count_adm_w		bigint;
nr_seq_cpoe_w       cpoe_dieta.nr_sequencia%type;
cd_funcao_w         prescr_solucao_evento.cd_funcao%type;
qt_etapas_pendentes_w bigint;


BEGIN
if (ie_tipo_solucao_p IS NOT NULL AND ie_tipo_solucao_p::text <> '') and (nr_prescricao_p IS NOT NULL AND nr_prescricao_p::text <> '') and (nr_seq_solucao_p IS NOT NULL AND nr_seq_solucao_p::text <> '') then
	/* obter status conforme tipo solucao */

	if (ie_tipo_solucao_p = 1) then -- solucao
		/* obter se solucao suspensa */

		select	coalesce(max(ie_suspenso),'N')
		into STRICT	ie_status_w
		from	prescr_solucao
		where	nr_prescricao	= nr_prescricao_p
		and	nr_seq_solucao	= nr_seq_solucao_p;

		if (ie_status_w <> 'S') then
			ie_status_w := '';
			/* obter sequencia evento */

			select	coalesce(max(nr_sequencia),0)
			into STRICT	nr_sequencia_w
			from	prescr_solucao_evento
			where	nr_prescricao	= nr_prescricao_p
			and	nr_seq_solucao	= nr_seq_solucao_p
			and	ie_tipo_solucao	= 1
			and	ie_alteracao	in (1,2,3,4,35)
			and	ie_evento_valido	= 'S';

			/* obter status solucao */

			if (nr_sequencia_w > 0) then
				select	CASE WHEN ie_alteracao=1 THEN  'I' WHEN ie_alteracao=2 THEN  'INT' WHEN ie_alteracao=3 THEN  'R' WHEN ie_alteracao=4 THEN  'T' WHEN ie_alteracao=35 THEN 'I' END
				into STRICT	ie_status_w
				from	prescr_solucao_evento
				where	nr_sequencia = nr_sequencia_w;

				/* tratar interromper sobre interromper */

				if (ie_status_w = 'INT') then
				
					select 	coalesce(obter_se_motivo_troca_frasco(nr_seq_motivo),'N')
					into STRICT	ie_troca_frasco_w
					from 	prescr_solucao_evento
					where 	nr_sequencia = nr_sequencia_w;
					
					if (ie_troca_frasco_w = 'N') and (ie_susp_remove_cpoe_p = 'S') then
						ie_status_w := 'ITX';
					end if;
				
					select	coalesce(max(qt_vol_infundido),-1),
						coalesce(max(qt_vol_desprezado),-1)
					into STRICT	qt_vol_infundido_w,
						qt_vol_desprezado_w
					from	prescr_solucao_evento
					where	nr_sequencia = nr_sequencia_w;

					if (qt_vol_infundido_w = -1) and (qt_vol_desprezado_w = -1) then
						ie_status_w := 'II';
					end if;
				end if;
			else
				ie_status_w := 'N';
			end if;
		end if;

	elsif (ie_tipo_solucao_p = 2) then -- suporte nutricional enteral
		/* obter se solucao suspensa */

		select	coalesce(max(ie_suspenso),'N'),
                max(nr_seq_dieta_cpoe)
		into STRICT	ie_status_w,
                nr_seq_cpoe_w
		from	prescr_material
		where	nr_prescricao	= nr_prescricao_p
		and	nr_sequencia	= nr_seq_solucao_p
		and	ie_agrupador	= 8;

		if (ie_status_w = 'N' AND nr_seq_cpoe_w IS NOT NULL AND nr_seq_cpoe_w::text <> '') then
		    select  coalesce(max('S'),'N')
		    into STRICT    ie_status_w
		    from    cpoe_dieta    a
		    where   a.nr_sequencia = nr_seq_cpoe_w
		    and     a.dt_suspensao <= clock_timestamp()
		    and     (a.dt_lib_suspensao IS NOT NULL AND a.dt_lib_suspensao::text <> '');
		end if;
		
		ie_status_aux_w := ie_status_w;
		
		/* obter sequencia evento */

		select	coalesce(max(nr_sequencia),0)
		into STRICT	nr_sequencia_w
		from	prescr_solucao_evento
		where	nr_prescricao	= nr_prescricao_p
		and	    nr_seq_material	= nr_seq_solucao_p
		and	    ie_tipo_solucao	= 2
		and	    ie_alteracao	in (1,2,3,4,35)
		and	    ie_evento_valido	= 'S';
			
		if (ie_status_w <> 'S' or (nr_sequencia_w > 0 and nr_sequencia_w != 4)) then
		ie_status_w := '';

			/* obter status solucao */

			if (nr_sequencia_w > 0) then
				select	CASE WHEN ie_alteracao=1 THEN  'I' WHEN ie_alteracao=2 THEN  'INT' WHEN ie_alteracao=3 THEN  'R' WHEN ie_alteracao=4 THEN  'T' WHEN ie_alteracao=35 THEN 'I' END
				into STRICT	ie_status_w
				from	prescr_solucao_evento
				where	nr_sequencia = nr_sequencia_w;

				/* tratar interromper sobre interromper */

				if (ie_status_w = 'INT') then
				
					select 	coalesce(obter_se_motivo_troca_frasco(nr_seq_motivo),'N')
					into STRICT	ie_troca_frasco_w
					from 	prescr_solucao_evento
					where 	nr_sequencia = nr_sequencia_w;
					
					if (ie_troca_frasco_w = 'N') and (ie_susp_remove_cpoe_p = 'S')  then
						ie_status_w := 'ITX';
					end if;
					
					select	coalesce(max(qt_vol_infundido), -1),
							coalesce(max(qt_vol_desprezado), -1),
							coalesce(max(cd_funcao), 1113)
					into STRICT	qt_vol_infundido_w,
							qt_vol_desprezado_w,
							cd_funcao_w
					from	prescr_solucao_evento
					where	nr_sequencia = nr_sequencia_w;

					if (qt_vol_infundido_w = -1) and (qt_vol_desprezado_w = -1) and (ie_troca_frasco_w = 'N' or cd_funcao_w <> 88) then
						ie_status_w := 'II';
					end if;
				end if;
			else
			
				select	count(1)
				into STRICT	nr_count_adm_w
				from	prescr_mat_hor
				where	nr_prescricao	= nr_prescricao_p
				and	nr_seq_material	= nr_seq_solucao_p
				and 	(dt_fim_horario IS NOT NULL AND dt_fim_horario::text <> '');
				
				if (nr_count_adm_w = 0) and (ie_susp_remove_cpoe_p = 'S') then
					ie_status_w := 'X';
				else
					ie_status_w := 'N';
				end if;
			end if;
		end if;
		
		if (ie_status_aux_w = 'S' and ie_status_w = 'INT' and ie_troca_frasco_w = 'S') then
			ie_status_w := ie_status_aux_w;
		end if;

	elsif (ie_tipo_solucao_p = 3) then -- hemocomponente
		/* obter se solucao suspensa */

		select	coalesce(ie_suspenso,'N')
		into STRICT	ie_status_w
		from	prescr_procedimento
		where	nr_prescricao		= nr_prescricao_p
		and	nr_sequencia		= nr_seq_solucao_p
		and	(nr_seq_solic_sangue IS NOT NULL AND nr_seq_solic_sangue::text <> '');
		--and	nr_seq_derivado	is not null;
		if (ie_status_w <> 'S') then
			ie_status_w := '';
			/* obter sequencia evento */

			select	coalesce(max(nr_sequencia),0)
			into STRICT	nr_sequencia_w
			from	prescr_solucao_evento
			where	ie_evento_valido = 'S'
			and		ie_alteracao in (1,2,3,4,37,39)
			and		ie_tipo_solucao = 3
			and		nr_seq_procedimento	= nr_seq_solucao_p
			and		nr_prescricao		= nr_prescricao_p;

			/* obter status solucao */

			if (nr_sequencia_w > 0) then
                select  CASE WHEN a.ie_alteracao=1 THEN  'I' WHEN a.ie_alteracao=2 THEN  'INT' WHEN a.ie_alteracao=3 THEN  'R' WHEN a.ie_alteracao=4 THEN  'T' WHEN a.ie_alteracao=37 THEN  'N' WHEN a.ie_alteracao=39 THEN  'N' END ,
                        a.cd_funcao
                into STRICT    ie_status_w,
                        cd_funcao_w
                from    prescr_solucao_evento a
                where   a.nr_sequencia = nr_sequencia_w;

				/* tratar interromper sobre interromper */

				if (ie_status_w = 'INT') then
				
					select 	coalesce(obter_se_motivo_troca_frasco(nr_seq_motivo),'N')
					into STRICT	ie_troca_frasco_w
					from 	prescr_solucao_evento
					where 	nr_sequencia = nr_sequencia_w;
					
					if (ie_troca_frasco_w = 'N') and (ie_susp_remove_cpoe_p = 'S')  then
						ie_status_w := 'ITX';
					end if;
				
					select	coalesce(max(qt_vol_infundido),-1),
							coalesce(max(qt_vol_desprezado),-1)
					into STRICT	qt_vol_infundido_w,
							qt_vol_desprezado_w
					from	prescr_solucao_evento
					where	nr_sequencia = nr_sequencia_w;

					if (qt_vol_infundido_w = -1) and (qt_vol_desprezado_w = -1) then
						ie_status_w := 'II';
					end if;
                elsif (ie_status_w = 'T' and cd_funcao_w = 88) then -- funcao 88 = PALM WEB PDA
                    select  count(a.nr_sequencia)
                    into STRICT    qt_etapas_pendentes_w
                    from    prescr_proc_hor a
                    where   a.nr_prescricao = nr_prescricao_p
                    and     a.nr_seq_procedimento = nr_seq_solucao_p
                    and     coalesce(coalesce(a.dt_fim_horario, a.dt_suspensao)::text, '') = ''
                    and (coalesce(a.ie_horario_especial,'N') = 'N');

                    --No palm da pra "Desligar" a etapa, mas nao pode finalizar a Hemoterapia, apenas a etapa, por isso deixamos ela como INT.
                    if (qt_etapas_pendentes_w >= 1) then
                        ie_status_w := 'INT';
                    end if;
				end if;
			else
				ie_status_w := 'N';
			end if;
-- Este tratamento foi comentado, pois estava invalidando os eventos da tabela PRESCR_SOLUCAO_EVENTO
--			if	(ie_status_w <> 'T') then
--				select	nvl(max(ie_status),'N')
--				into	ie_status_w
--				from	prescr_procedimento
--				where	nr_prescricao = nr_prescricao_p
--				and	nr_sequencia = nr_seq_solucao_p;
--			end if;
		end if;

	elsif (ie_tipo_solucao_p = 4) then -- npt adulta
		if (nr_seq_solucao_p > 0) then
			/* obter se solucao suspensa */

			select	coalesce(ie_suspenso,'N')
			into STRICT	ie_status_w
			from	nut_paciente
			where	nr_prescricao	= nr_prescricao_p
			and	nr_sequencia	= nr_seq_solucao_p;

			if (ie_status_w <> 'S') then
				ie_status_w := '';
				/* obter sequencia evento */

				select	coalesce(max(nr_sequencia),0)
				into STRICT	nr_sequencia_w
				from	prescr_solucao_evento
				where	nr_prescricao		= nr_prescricao_p
				and	nr_seq_nut		= nr_seq_solucao_p
				and	ie_tipo_solucao		= 4
				and	ie_alteracao		in (1,2,3,4)
				and	ie_evento_valido		= 'S';

				/* obter status solucao */

				if (nr_sequencia_w > 0) then
					select	CASE WHEN ie_alteracao=1 THEN  'I' WHEN ie_alteracao=2 THEN  'INT' WHEN ie_alteracao=3 THEN  'R' WHEN ie_alteracao=4 THEN  'T' END
					into STRICT	ie_status_w
					from	prescr_solucao_evento
					where	nr_sequencia = nr_sequencia_w;

					/* tratar interromper sobre interromper */

					if (ie_status_w = 'INT') then
					
						select 	coalesce(obter_se_motivo_troca_frasco(nr_seq_motivo),'N')
						into STRICT	ie_troca_frasco_w
						from 	prescr_solucao_evento
						where 	nr_sequencia = nr_sequencia_w;
						
						if (ie_troca_frasco_w = 'N') and (ie_susp_remove_cpoe_p = 'S')  then
							ie_status_w := 'ITX';
						end if;
					
						select	coalesce(max(qt_vol_infundido),-1),
							coalesce(max(qt_vol_desprezado),-1)
						into STRICT	qt_vol_infundido_w,
							qt_vol_desprezado_w
						from	prescr_solucao_evento
						where	nr_sequencia = nr_sequencia_w;

						if (qt_vol_infundido_w = -1) and (qt_vol_desprezado_w = -1) then
							ie_status_w := 'II';
						end if;
					end if;
				else
					ie_status_w := 'N';
				end if;
			end if;
		else

			select	max(nr_sequencia),
					max(coalesce(ie_suspenso,'N'))
			into STRICT	nr_seq_nut_pac_w,
					ie_status_w
			from	nut_paciente
			where	nr_prescricao	= nr_prescricao_p;

			if (ie_status_w <> 'S') then
				ie_status_w := '';

				select	coalesce(max(nr_sequencia),0)
				into STRICT	nr_sequencia_w
				from	prescr_solucao_evento
				where	nr_prescricao		= nr_prescricao_p
				and		nr_seq_nut			= nr_seq_nut_pac_w
				and		ie_tipo_solucao		= 4
				and		ie_alteracao		in (1,2,3,4)
				and		ie_evento_valido	= 'S';

				if (nr_sequencia_w > 0) then

					select	CASE WHEN ie_alteracao=1 THEN  'I' WHEN ie_alteracao=2 THEN  'INT' WHEN ie_alteracao=3 THEN  'R' WHEN ie_alteracao=4 THEN  'T' END
					into STRICT	ie_status_w
					from	prescr_solucao_evento
					where	nr_sequencia = nr_sequencia_w;

					if (ie_status_w = 'INT') then
					
						select 	coalesce(obter_se_motivo_troca_frasco(nr_seq_motivo),'N')
						into STRICT	ie_troca_frasco_w
						from 	prescr_solucao_evento
						where 	nr_sequencia = nr_sequencia_w;
						
						if (ie_troca_frasco_w = 'N') and (ie_susp_remove_cpoe_p = 'S')  then
							ie_status_w := 'ITX';
						end if;

						select	coalesce(max(qt_vol_infundido),-1),
							coalesce(max(qt_vol_desprezado),-1)
						into STRICT	qt_vol_infundido_w,
							qt_vol_desprezado_w
						from	prescr_solucao_evento
						where	nr_sequencia = nr_sequencia_w;

						if (qt_vol_infundido_w = -1) and (qt_vol_desprezado_w = -1) then
							ie_status_w := 'II';
						end if;

					end if;
				else
					ie_status_w := 'N';
				end if;
			end if;
		end if;
	elsif (ie_tipo_solucao_p = 5) then -- npt neo
		/* obter se solucao suspensa */

		select	coalesce(ie_suspenso,'N')
		into STRICT	ie_status_w
		from	nut_pac
		where	nr_prescricao	= nr_prescricao_p
		and	nr_sequencia	= nr_seq_solucao_p;

		if (ie_status_w <> 'S') then
			ie_status_w := '';
			/* obter sequencia evento */

			select	coalesce(max(nr_sequencia),0)
			into STRICT	nr_sequencia_w
			from	prescr_solucao_evento
			where	nr_prescricao	= nr_prescricao_p
			and	nr_seq_nut_neo	= nr_seq_solucao_p
			and	ie_tipo_solucao	= 5
			and	ie_alteracao	in (1,2,3,4)
			and	ie_evento_valido	= 'S';

			/* obter status solucao */

			if (nr_sequencia_w > 0) then
				select	CASE WHEN ie_alteracao=1 THEN  'I' WHEN ie_alteracao=2 THEN  'INT' WHEN ie_alteracao=3 THEN  'R' WHEN ie_alteracao=4 THEN  'T' END
				into STRICT	ie_status_w
				from	prescr_solucao_evento
				where	nr_sequencia = nr_sequencia_w;

				/* tratar interromper sobre interromper */

				if (ie_status_w = 'INT') then
				
					select 	coalesce(obter_se_motivo_troca_frasco(nr_seq_motivo),'N')
					into STRICT	ie_troca_frasco_w
					from 	prescr_solucao_evento
					where 	nr_sequencia = nr_sequencia_w;
					
					if (ie_troca_frasco_w = 'N') and (ie_susp_remove_cpoe_p = 'S')  then
						ie_status_w := 'ITX';
					end if;
				
					select	coalesce(max(qt_vol_infundido),-1),
						coalesce(max(qt_vol_desprezado),-1)
					into STRICT	qt_vol_infundido_w,
						qt_vol_desprezado_w
					from	prescr_solucao_evento
					where	nr_sequencia = nr_sequencia_w;

					if (qt_vol_infundido_w = -1) and (qt_vol_desprezado_w = -1) then
						ie_status_w := 'II';
					end if;
				end if;
			else
				ie_status_w := 'N';
			end if;
		end if;
	elsif (ie_tipo_solucao_p = 6) then -- npt Adulta 2
		/* obter se solucao suspensa */

		select	coalesce(ie_suspenso,'N')
		into STRICT	ie_status_w
		from	nut_pac
		where	nr_prescricao	= nr_prescricao_p
		and	nr_sequencia	= nr_seq_solucao_p;

		if (ie_status_w <> 'S') then
			ie_status_w := '';
			/* obter sequencia evento */

			select	coalesce(max(nr_sequencia),0)
			into STRICT	nr_sequencia_w
			from	prescr_solucao_evento
			where	nr_prescricao	= nr_prescricao_p
			and	nr_seq_nut_neo	= nr_seq_solucao_p
			and	ie_tipo_solucao	= 6
			and	ie_alteracao	in (1,2,3,4,35)
			and	ie_evento_valido	= 'S';

			/* obter status solucao */

			if (nr_sequencia_w > 0) then
				select	CASE WHEN ie_alteracao=1 THEN  'I' WHEN ie_alteracao=2 THEN  'INT' WHEN ie_alteracao=3 THEN  'R' WHEN ie_alteracao=4 THEN  'T' WHEN ie_alteracao=35 THEN  'I' END
				into STRICT	ie_status_w
				from	prescr_solucao_evento
				where	nr_sequencia = nr_sequencia_w;

				/* tratar interromper sobre interromper */

				if (ie_status_w = 'INT') then
				
					select 	coalesce(obter_se_motivo_troca_frasco(nr_seq_motivo),'N')
					into STRICT	ie_troca_frasco_w
					from 	prescr_solucao_evento
					where 	nr_sequencia = nr_sequencia_w;
					
					if (ie_troca_frasco_w = 'N') and (ie_susp_remove_cpoe_p = 'S')  then
						ie_status_w := 'ITX';
					end if;
				
					select	coalesce(max(qt_vol_infundido),-1),
						    coalesce(max(qt_vol_desprezado),-1)
					into STRICT	qt_vol_infundido_w,
						    qt_vol_desprezado_w
					from	prescr_solucao_evento
					where	nr_sequencia = nr_sequencia_w;

					if (qt_vol_infundido_w = -1) and (qt_vol_desprezado_w = -1) then
						ie_status_w := 'II';
					end if;
				end if;
			else
				ie_status_w := 'N';
			end if;
		end if;
	elsif (ie_tipo_solucao_p = 7) then -- npt Pediatrica
		/* obter se solucao suspensa */

		select	coalesce(ie_suspenso,'N')
		into STRICT	ie_status_w
		from	nut_pac
		where	nr_prescricao	= nr_prescricao_p
		and	nr_sequencia	= nr_seq_solucao_p;

		if (ie_status_w <> 'S') then
			ie_status_w := '';
			/* obter sequencia evento */

			select	coalesce(max(nr_sequencia),0)
			into STRICT	nr_sequencia_w
			from	prescr_solucao_evento
			where	nr_prescricao	= nr_prescricao_p
			and	nr_seq_nut_neo	= nr_seq_solucao_p
			and	ie_tipo_solucao	= 7
			and	ie_alteracao	in (1,2,3,4)
			and	ie_evento_valido	= 'S';

			/* obter status solucao */

			if (nr_sequencia_w > 0) then
				select	CASE WHEN ie_alteracao=1 THEN  'I' WHEN ie_alteracao=2 THEN  'INT' WHEN ie_alteracao=3 THEN  'R' WHEN ie_alteracao=4 THEN  'T' END
				into STRICT	ie_status_w
				from	prescr_solucao_evento
				where	nr_sequencia = nr_sequencia_w;

				/* tratar interromper sobre interromper */

				if (ie_status_w = 'INT') then
				
					select 	coalesce(obter_se_motivo_troca_frasco(nr_seq_motivo),'N')
					into STRICT	ie_troca_frasco_w
					from 	prescr_solucao_evento
					where 	nr_sequencia = nr_sequencia_w;
					
					if (ie_troca_frasco_w = 'N') and (ie_susp_remove_cpoe_p = 'S')  then
						ie_status_w := 'ITX';
					end if;
				
					select	coalesce(max(qt_vol_infundido),-1),
						coalesce(max(qt_vol_desprezado),-1)
					into STRICT	qt_vol_infundido_w,
						qt_vol_desprezado_w
					from	prescr_solucao_evento
					where	nr_sequencia = nr_sequencia_w;

					if (qt_vol_infundido_w = -1) and (qt_vol_desprezado_w = -1) then
						ie_status_w := 'II';
					end if;
				end if;
			else
				ie_status_w := 'N';
			end if;
		end if;
	elsif (ie_tipo_solucao_p = 8) then -- dialise
		select	coalesce(max(ie_status),'N')
		into STRICT	ie_status_w
		from	prescr_solucao
		where	nr_prescricao	= nr_prescricao_p
		and	nr_seq_solucao	= nr_seq_solucao_p;

		if (ie_status_w <> 'T') then
			ie_status_w := '';
			/* obter sequencia evento */

            -- ANALISAR ESSAS CONDICOES
			select	coalesce(max(nr_sequencia),0)
			into STRICT	nr_sequencia_w
			from	hd_prescricao_evento
			where	nr_prescricao	= nr_prescricao_p
            and     ie_evento in ('II','IT','T');

			/* obter status solucao */

			if (nr_sequencia_w > 0) then
				select	CASE WHEN ie_evento='II' THEN 'I' WHEN ie_evento='IT' THEN 'T'  ELSE ie_evento END
				into STRICT	ie_status_w
				from	hd_prescricao_evento
				where	nr_sequencia = nr_sequencia_w;

				/* tratar interromper sobre interromper */

                /*
				if	(ie_status_w = 'INT') then
					select	nvl(max(qt_vol_infundido),-1),
						nvl(max(qt_vol_desprezado),-1)
					into	qt_vol_infundido_w,
						qt_vol_desprezado_w
					from	prescr_solucao_evento
					where	nr_sequencia = nr_sequencia_w;

					if	(qt_vol_infundido_w = -1) and
						(qt_vol_desprezado_w = -1) then
						ie_status_w := 'II';
					end if;
				end if;
                */
			else
				ie_status_w := 'N';
			end if;
		end if;
	elsif (ie_tipo_solucao_p = 9) then -- gasoterapia
		select	coalesce(max(ie_suspenso),'N')
		into STRICT	ie_status_w
		from	prescr_gasoterapia
		where	nr_prescricao	= nr_prescricao_p
		and	    nr_sequencia    = nr_seq_solucao_p;

		if (ie_status_w <> 'S') then
			ie_status_w := '';

            select	coalesce(max(nr_sequencia),0)
			into STRICT	nr_sequencia_w
			from	prescr_gasoterapia_evento
			where	nr_seq_gasoterapia = nr_seq_solucao_p
            and     ie_evento in ('I', 'IN', 'R','T')
            and     ie_evento_valido = 'S';

			if (nr_sequencia_w > 0) then

				select	ie_evento
				into STRICT	ie_status_w
				from	prescr_gasoterapia_evento
				where	nr_sequencia = nr_sequencia_w;

			else
				ie_status_w := 'N';
			end if;
		end if;
	end if;
end if;

return ie_status_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_status_solucao_prescr (ie_tipo_solucao_p bigint, nr_prescricao_p bigint, nr_seq_solucao_p bigint, ie_susp_remove_cpoe_p text default 'N') FROM PUBLIC;

