-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION is_valid_document_apap (NR_SEQ_DOCUMENTO_P DOCUMENTO.NR_SEQUENCIA%TYPE) RETURNS varchar AS $body$
DECLARE

    IS_VALID_W  DOCUMENTO_SECAO.IE_CHART_VIEW%TYPE;
    nm_usuario_w         usuario.nm_usuario%type                   := wheb_usuario_pck.get_nm_usuario;

C_SECTION CURSOR FOR
    SELECT      SEC.NR_SEQUENCIA
    FROM        DOCUMENTO_SECAO SEC
    INNER JOIN  DOCUMENTO DOC ON (DOC.NR_SEQUENCIA = SEC.NR_SEQ_DOCUMENTO)
    WHERE SEC.NR_SEQ_DOCUMENTO = NR_SEQ_DOCUMENTO_P
    AND SEC.IE_CHART_VIEW = 'S'
    AND         (SEC.NR_SEQ_LINKED_DATA IS NOT NULL AND SEC.NR_SEQ_LINKED_DATA::text <> '');

BEGIN
  FOR R_SECTION IN C_SECTION
    LOOP
        IS_VALID_W := IS_VALID_DOC_SECTION_APAP(R_SECTION.NR_SEQUENCIA);
        IF (IS_VALID_W = 'N') THEN
            EXIT;
        END IF;
    END LOOP;

    RETURN IS_VALID_W;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION is_valid_document_apap (NR_SEQ_DOCUMENTO_P DOCUMENTO.NR_SEQUENCIA%TYPE) FROM PUBLIC;

