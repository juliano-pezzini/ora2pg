-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION sinan_obter_dados_inv_rel ( nr_seq_notificacao_p bigint, nr_linha_p bigint, ie_domiciliar_p text, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE

nm_contato_w		varchar(255);
qt_idade_w		smallint;
ie_sintomatico_w	varchar(3);
ds_observacao_w		varchar(255);
nr_linha_w		smallint;
ds_retorno_w		varchar(255);
ie_tipo_contato_w	varchar(20);

BEGIN
select 	NM_CONTATO,
	QT_IDADE,
	IE_SINTOMATICO,
	DS_OBSERVACAO,
	IE_TIPO_CONTATO,
	linha
into STRICT	nm_contato_w,
        qt_idade_w,
        ie_sintomatico_w,
        ds_observacao_w,
	ie_tipo_contato_w,
        nr_linha_w
from (
	SELECT	a.NM_CONTATO NM_CONTATO,
		a.QT_IDADE QT_IDADE,
		CASE WHEN a.IE_SINTOMATICO='1' THEN 'Sim' WHEN a.IE_SINTOMATICO='2' THEN 'NÃ£o' END  IE_SINTOMATICO,
		a.DS_OBSERVACAO DS_OBSERVACAO,
		CASE WHEN a.ie_tipo_contato='1' THEN wheb_mensagem_pck.get_texto(803080) WHEN a.ie_tipo_contato='2' THEN upper(wheb_mensagem_pck.get_texto(803081)) WHEN a.ie_tipo_contato='3' THEN wheb_mensagem_pck.get_texto(803082) WHEN a.ie_tipo_contato='4' THEN wheb_mensagem_pck.get_texto(803083) END  ie_tipo_contato,
		row_number() OVER () AS linha
	from  	SINAN_INVESTIGACAO a,
		notificacao_sinan c
	where	a.nr_seq_notificacao = c.nr_sequencia
	and	c.nr_sequencia = nr_seq_notificacao_p
	and	a.ie_domiciliar = ie_domiciliar_p
	order by 1) alias5
where linha = nr_linha_p;

if (ie_opcao_p = 'N') then
	ds_retorno_w := nm_contato_w;
elsif (ie_opcao_p = 'I') then
	ds_retorno_w := qt_idade_w;
elsif (ie_opcao_p = 'S') then
	ds_retorno_w := ie_sintomatico_w;
elsif (ie_opcao_p = 'O') then
	ds_retorno_w := ds_observacao_w;
elsif (ie_opcao_p = 'TC') then
	ds_retorno_w := ie_tipo_contato_w;

end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION sinan_obter_dados_inv_rel ( nr_seq_notificacao_p bigint, nr_linha_p bigint, ie_domiciliar_p text, ie_opcao_p text) FROM PUBLIC;

