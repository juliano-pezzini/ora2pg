-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_desc_alergia (nr_seq_alergia_p text) RETURNS varchar AS $body$
DECLARE


    ds_retorno_w        varchar(300) := null;
    ds_dcb_w            varchar(300) := null;
    ds_material_w       varchar(300) := null;
    ds_classe_mat_w     varchar(300) := null;
    ds_ficha_tecnica_w  varchar(300) := null;
    ds_familia_mat_w    varchar(300) := null;
    ds_tipo_w           varchar(300) := null;
	ie_nega_alergias_w  varchar(1) := null;
	ds_medic_nao_cad_w  varchar(300) := null;
    cd_doenca_w         varchar(300) := null;

    nr_seq_dcb_w bigint;
    cd_material_w bigint;
    cd_classe_mat_w bigint;
    nr_seq_ficha_tecnica_w bigint;
    nr_seq_familia_w bigint;
    nr_seq_tipo_w bigint;


BEGIN
    -- select allergie
    select
        nr_seq_dcb,
        cd_material,
        cd_classe_mat,
        nr_seq_ficha_tecnica,
        nr_seq_familia,
        nr_seq_tipo,
		coalesce(ie_nega_alergias, 'N'),
		ds_medic_nao_cad,
		cd_doenca
    into STRICT
        nr_seq_dcb_w,
        cd_material_w,
        cd_classe_mat_w,
        nr_seq_ficha_tecnica_w,
        nr_seq_familia_w,
        nr_seq_tipo_w,
		ie_nega_alergias_w,
		ds_medic_nao_cad_w,
		cd_doenca_w
    from
        paciente_alergia
    where
        nr_sequencia = nr_seq_alergia_p;


    -- get descriptions
    select obter_desc_dcb(nr_seq_dcb_w)
    into STRICT ds_dcb_w
;

    select substr(obter_desc_material(cd_material_w),1,254)
    into STRICT ds_material_w
;

    select substr(obter_desc_classe_mat(cd_classe_mat_w),1,255)
    into STRICT ds_classe_mat_w
;

    select obter_desc_ficha_tecnica(nr_seq_ficha_tecnica_w)
    into STRICT ds_ficha_tecnica_w
;

    select obter_desc_familia_mat(nr_seq_familia_w)
    into STRICT ds_familia_mat_w
;

    select substr(obter_desc_alergeno(nr_seq_tipo_w),1,80)
    into STRICT ds_tipo_w
;

	select substr(obter_desc_cid(cd_doenca_w),1,300)
    into STRICT cd_doenca_w
;

    -- select description
    if (ie_nega_alergias_w = 'S') then
		ds_retorno_w := obter_desc_expressao(294051);
    elsif (ds_dcb_w IS NOT NULL AND ds_dcb_w::text <> '')then
        ds_retorno_w := ds_dcb_w;

    elsif (ds_material_w IS NOT NULL AND ds_material_w::text <> '')then
        ds_retorno_w := ds_material_w;

    elsif (ds_classe_mat_w IS NOT NULL AND ds_classe_mat_w::text <> '')then
        ds_retorno_w := ds_classe_mat_w;

    elsif (ds_ficha_tecnica_w IS NOT NULL AND ds_ficha_tecnica_w::text <> '')then
        ds_retorno_w := ds_ficha_tecnica_w;

    elsif (ds_familia_mat_w IS NOT NULL AND ds_familia_mat_w::text <> '')then
        ds_retorno_w := ds_familia_mat_w;
    elsif (ds_tipo_w IS NOT NULL AND ds_tipo_w::text <> '')then
        ds_retorno_w := ds_tipo_w;
	elsif (cd_doenca_w IS NOT NULL AND cd_doenca_w::text <> '')then
        ds_retorno_w := cd_doenca_w;
	elsif (ds_medic_nao_cad_w IS NOT NULL AND ds_medic_nao_cad_w::text <> '')then
        ds_retorno_w := ds_medic_nao_cad_w;
    end if;


    return substr(ds_retorno_w, 1, 255);

end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_desc_alergia (nr_seq_alergia_p text) FROM PUBLIC;

