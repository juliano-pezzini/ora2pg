-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_medic_conveniado ( cd_pessoa_fisica_p text, nr_atendimento_p bigint, nr_sequencia_p bigint default 0) RETURNS varchar AS $body$
DECLARE




ie_retorno_w			varchar(1) := 'N';
cd_convenio_w			integer;
nr_seq_atecaco_w		bigint;
cd_estabelecimento_w		bigint := wheb_usuario_pck.get_cd_estabelecimento;
cd_plano_w			varchar(10);
cd_categoria_w			varchar(10);



BEGIN


if (nr_atendimento_p IS NOT NULL AND nr_atendimento_p::text <> '') then
	begin
	select 	max(a.cd_convenio),
		max(a.cd_plano_convenio),
		max(a.cd_categoria)
	into STRICT	   cd_convenio_w,
		   cd_plano_w,
		   cd_categoria_w
	from       atend_categoria_convenio a
	where     a.nr_seq_interno = obter_atecaco_atendimento(nr_atendimento_p);
	end;
else
	select 	max(a.cd_convenio),
		max(a.cd_plano),
		max(a.cd_categoria)
	into STRICT	   cd_convenio_w,
		   cd_plano_w,
		   cd_categoria_w
	from       agenda_paciente a
	where	nr_sequencia = nr_sequencia_p;
end if;


if (cd_convenio_w IS NOT NULL AND cd_convenio_w::text <> '') and (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '')  then
	begin
	select	obter_se_medico_credenciado(cd_estabelecimento_w, cd_pessoa_fisica_p, cd_convenio_w,
	'', '',coalesce(cd_categoria_w,''),'',coalesce(cd_plano_w,''),'','','','')
	into STRICT	ie_retorno_w
	;

	end;
end if;

return ie_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_medic_conveniado ( cd_pessoa_fisica_p text, nr_atendimento_p bigint, nr_sequencia_p bigint default 0) FROM PUBLIC;

