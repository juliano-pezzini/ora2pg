-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_ie_consulta_ass_dig (nr_seq_projeto_p tasy_projeto_assinatura.nr_sequencia%type) RETURNS TASY_PROJ_ASSIN_PERFIL.IE_CONSULTA%TYPE AS $body$
DECLARE


ie_retorno_w		tasy_proj_assin_perfil.ie_consulta%type;
cd_perfil_atual_w	perfil.cd_perfil%type;

cRegras CURSOR FOR
SELECT	a.nr_sequencia nr_seq_regra_w,
		a.cd_perfil cd_perfil_w,
		a.ie_consulta ie_perfil_liberado_w
from	tasy_proj_assin_perfil a
where	a.nr_seq_proj = nr_seq_projeto_p
order by	coalesce(a.cd_perfil, 99999);

BEGIN
ie_retorno_w := 'N';
if (nr_seq_projeto_p > 0) then
	cd_perfil_atual_w := wheb_usuario_pck.get_cd_perfil;

	for cRegras_w in cRegras loop
		begin
			if (cd_perfil_atual_w = cRegras_w.cd_perfil_w) or (coalesce(cRegras_w.cd_perfil_w::text, '') = '') then
				ie_retorno_w := cRegras_w.ie_perfil_liberado_w;
				exit;
			end if;
		end;
	end loop;
end if;

return	ie_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_ie_consulta_ass_dig (nr_seq_projeto_p tasy_projeto_assinatura.nr_sequencia%type) FROM PUBLIC;

