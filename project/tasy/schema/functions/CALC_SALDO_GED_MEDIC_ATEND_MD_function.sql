-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION calc_saldo_ged_medic_atend_md ( qt_saldo_p bigint, qt_unitaria_especial_p bigint, qt_unitaria_p bigint, qt_total_dispensar_p bigint, qt_unitaria_2p bigint, ie_dose_menor_p text, qt_material_aux_p bigint, tp_retorno_p bigint, ie_horario_especial_p text ) RETURNS bigint AS $body$
DECLARE

    qt_saldo_aux_w double precision;

BEGIN

    IF ( tp_retorno_p = 1 ) THEN
      if (ie_horario_especial_p <> 'S') then --Quando eh horario especial, nao deve diminuir o saldo,  pois eh um horario sem aprazamento.
        qt_saldo_aux_w := coalesce(qt_saldo_p, 0) - coalesce(qt_unitaria_especial_p, qt_unitaria_p);
      end if;
    END IF;

    IF ( tp_retorno_p = 2 ) THEN
        qt_saldo_aux_w := coalesce(qt_total_dispensar_p,0) - coalesce(qt_unitaria_2p,0);
    END IF;

    IF ( tp_retorno_p = 3 ) THEN
        IF ( ie_dose_menor_p = 'N' ) THEN
            qt_saldo_aux_w := coalesce(qt_material_aux_p,0) + coalesce(qt_saldo_p, 0);
        ELSE
            qt_saldo_aux_w := qt_material_aux_p;
        END IF;
    END IF;

    RETURN qt_saldo_aux_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION calc_saldo_ged_medic_atend_md ( qt_saldo_p bigint, qt_unitaria_especial_p bigint, qt_unitaria_p bigint, qt_total_dispensar_p bigint, qt_unitaria_2p bigint, ie_dose_menor_p text, qt_material_aux_p bigint, tp_retorno_p bigint, ie_horario_especial_p text ) FROM PUBLIC;

