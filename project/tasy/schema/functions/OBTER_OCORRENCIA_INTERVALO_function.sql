-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_ocorrencia_intervalo (cd_intervalo_p text, qt_hora_p bigint, ie_opcao_p text ) RETURNS bigint AS $body$
DECLARE

nr_ocorrencia_w  double precision;
qt_hora_w        double precision;
qt_operacao_w    intervalo_prescricao.qt_operacao%type;
ie_operacao_w    varchar(1);
EXEC_W           varchar(200);
result_w         bigint;

BEGIN
  if (cd_intervalo_p IS NOT NULL AND cd_intervalo_p::text <> '') then
    select coalesce(max(qt_operacao),1),
          coalesce(max(ie_operacao),'F')
    into STRICT   qt_operacao_w,
          ie_operacao_w
    from   intervalo_prescricao
    where  cd_intervalo = cd_intervalo_p;

    begin
      EXEC_W := 'BEGIN OBTER_OCORR_HORA_INTERVALO_MD(:1,:2,:3,:4,:5); END;';

      EXECUTE EXEC_W USING IN ie_operacao_w,
                                     IN qt_operacao_w,
                                     IN qt_hora_p,
                                     OUT nr_ocorrencia_w,
                                     OUT qt_hora_w;
    exception
      when others then
        nr_ocorrencia_w := null;
        qt_hora_w       := null;
    end;
  end if;

  begin
    EXEC_W := 'CALL OBTER_RESULT_OCORR_INTERV_MD(:1,:2,:3) INTO :RESULT';

    EXECUTE EXEC_W USING IN ie_opcao_p,
                                   IN nr_ocorrencia_w,
                                   IN qt_hora_w,
                                   OUT result_w;
  exception
    when others then
      result_w := null;
  end;

  return result_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_ocorrencia_intervalo (cd_intervalo_p text, qt_hora_p bigint, ie_opcao_p text ) FROM PUBLIC;

