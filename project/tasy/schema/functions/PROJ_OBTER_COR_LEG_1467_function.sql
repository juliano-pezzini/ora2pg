-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION proj_obter_cor_leg_1467 (nr_seq_proj_cron_etapa_p bigint) RETURNS bigint AS $body$
DECLARE


nr_seq_cor_w bigint;


BEGIN

nr_seq_cor_w := 6797;

select (CASE WHEN (			select count(1)			from proj_cron_etapa a			where nr_sequencia = nr_seq_proj_cron_etapa_p			and pr_etapa <> 100				and (((exists (							select 1							from man_ordem_servico							where nr_seq_proj_cron_etapa = a.nr_sequencia								and ie_status_ordem <> 3							)							and a.dt_fim_prev < clock_timestamp())						or a.dt_fim_prev < clock_timestamp())					or (						exists (select 1							from proj_cron_etapa b							where nr_seq_superior = a.nr_sequencia								and b.pr_etapa <> 100								and (									(exists (										select 1										from man_ordem_servico										where nr_seq_proj_cron_etapa = b.nr_sequencia											and ie_status_ordem <> 3										)										and b.dt_fim_prev < clock_timestamp())									or b.dt_fim_prev < clock_timestamp())							)						)					)			)=0 THEN 		/*seq cor legenda Normal*/
 6797  ELSE /*seq cor legenda Atraso*/
 6798 END ) nr_seq_cor
into STRICT nr_seq_cor_w
;

return	nr_seq_cor_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION proj_obter_cor_leg_1467 (nr_seq_proj_cron_etapa_p bigint) FROM PUBLIC;

