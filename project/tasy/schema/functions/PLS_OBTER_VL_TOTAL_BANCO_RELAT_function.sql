-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_vl_total_banco_relat (ie_opcao_p text, ie_tipo_data_p text, dt_inicial_p timestamp, dt_final_p timestamp, nr_seq_lote_p bigint, nr_seq_conta_banco_p bigint, ie_tipo_contratacao_p text, ie_regulamentacao_p text, cd_banco_p bigint) RETURNS bigint AS $body$
DECLARE

/* 
ie_opcao_p 
	T = Total geral (vl_total + vl_coparticipação) 
	V = vl_total 
	C = vl_coparticipação 
 
	QTT = Qt. total título 
	QTM = total vl. média 
	 
	TPVR = Total produtos valor regulamentado 
	TPQR = Total produtos quantidade regulamentados 
*/
 
ds_retorno_w		double precision;
vl_total_w		double precision;
vl_coparticipacao_w	double precision;
vl_media_w		double precision;
qt_titulo_w		bigint;


BEGIN 
 
if (ie_opcao_p in ('T','V','C')) then 
	select	sum(vl_total), 
		sum(vl_coparticipacao) 
	into STRICT	vl_total_w, 
		vl_coparticipacao_w 
	from	( 
		SELECT	CASE WHEN c.ie_tipo_item='3' THEN 0  ELSE coalesce(sum(c.vl_item),0) END  vl_total, 
			CASE WHEN c.ie_tipo_item='3' THEN coalesce(sum(c.vl_item),0)  ELSE 0 END  vl_coparticipacao 
		from	banco_estabelecimento_v		k, 
			titulo_receber			j, 
			pls_contrato			h, 
			pls_plano			g, 
			pls_contrato_pagador_fin	f, 
			pls_contrato_pagador		e, 
			pls_segurado			d, 
			pls_mensalidade_seg_item	c, 
			pls_mensalidade_segurado	b, 
			pls_mensalidade			a 
		where	c.nr_seq_mensalidade_seg	= b.nr_sequencia 
		and	b.nr_seq_mensalidade		= a.nr_sequencia 
		and	b.nr_seq_segurado		= d.nr_sequencia 
		and	d.nr_seq_pagador		= e.nr_sequencia 
		and	f.nr_seq_pagador		= e.nr_sequencia 
		and	d.nr_seq_plano			= g.nr_sequencia 
		and	j.nr_seq_mensalidade		= a.nr_sequencia 
		and	e.nr_seq_contrato		= h.nr_sequencia 
		and	f.nr_seq_conta_banco		= k.nr_sequencia 
		and	((g.ie_tipo_contratacao 	= coalesce(ie_tipo_contratacao_p,0)) or (coalesce(ie_tipo_contratacao_p,0) = '0')) 
		and	((g.ie_regulamentacao = coalesce(ie_regulamentacao_p,0)) or (coalesce(ie_regulamentacao_p,0) = '0')) 
		and	((a.nr_seq_lote = coalesce(nr_seq_lote_p,0)) or (coalesce(nr_seq_lote_p,0) = 0)) 
		and	((ie_tipo_data_p = 'N') or 
			((ie_tipo_data_p = 'E') and j.dt_emissao between dt_inicial_p and fim_dia(dt_final_p)) or 
			((ie_tipo_data_p = 'V') and j.dt_vencimento between dt_inicial_p and fim_dia(dt_final_p)) or 
			((ie_tipo_data_p = 'R') and j.dt_liquidacao between dt_inicial_p and fim_dia(dt_final_p))) 
		and	k.nr_sequencia	= nr_seq_conta_banco_p 
		and	coalesce(a.ie_cancelamento::text, '') = '' 
		group by	c.ie_tipo_item, 
				d.nr_seq_plano, 
				c.nr_seq_vinculo_sca, 
				c.nr_seq_bonificacao_vinculo, 
				g.ds_plano 
		
union all
 
		SELECT	coalesce(sum(c.vl_item),0) vl_total, 
			0 vl_coparticipacao 
		from	banco_estabelecimento_v		k, 
			titulo_receber			j, 
			pls_contrato			h, 
			pls_plano			g, 
			pls_contrato_pagador_fin	f, 
			pls_contrato_pagador		e, 
			pls_mensalidade_seg_item	c, 
			pls_mensalidade			a 
		where	c.nr_seq_mensalidade		= a.nr_sequencia 
		and	f.nr_seq_pagador		= e.nr_sequencia 
		and	j.nr_seq_mensalidade		= a.nr_sequencia 
		and	e.nr_seq_contrato		= h.nr_sequencia 
		and	f.nr_seq_conta_banco		= k.nr_sequencia 
		and	a.nr_seq_pagador		= e.nr_sequencia 
		and	g.nr_sequencia		= (	select	max(nr_seq_plano) 
							from	pls_contrato_plano x 
							where	x.nr_seq_contrato = h.nr_sequencia 
							and	x.ie_situacao		= 'A') 
		and	((g.ie_tipo_contratacao = coalesce(ie_tipo_contratacao_p,0)) or (coalesce(ie_tipo_contratacao_p,0) = '0')) 
		and	((g.ie_regulamentacao = coalesce(ie_regulamentacao_p,0)) or (coalesce(ie_regulamentacao_p,0) = '0')) 
		and	((a.nr_seq_lote = coalesce(nr_seq_lote_p,0)) or (coalesce(nr_seq_lote_p,0) = 0)) 
		and	((ie_tipo_data_p = 'N') or 
			((ie_tipo_data_p = 'E') and j.dt_emissao between dt_inicial_p and fim_dia(dt_final_p)) or 
			((ie_tipo_data_p = 'V') and j.dt_vencimento between dt_inicial_p and fim_dia(dt_final_p)) or 
			((ie_tipo_data_p = 'R') and j.dt_liquidacao between dt_inicial_p and fim_dia(dt_final_p))) 
		and	k.nr_sequencia	= nr_seq_conta_banco_p 
		and	coalesce(a.ie_cancelamento::text, '') = '' 
		group by	c.ie_tipo_item 
		) alias66;
	 
	if (ie_opcao_p	= 'T') then 
		ds_retorno_w	:= vl_total_w + vl_coparticipacao_w;
	elsif (ie_opcao_p	= 'V') then 
		ds_retorno_w	:= vl_total_w;
	elsif (ie_opcao_p	= 'C') then 
		ds_retorno_w	:= vl_coparticipacao_w;
	end if;
elsif (ie_opcao_p in ('QTT','QTM')) then 
	select (sum(vl_media) / count(*)), 
		count(*) 
	into STRICT	vl_media_w, 
		qt_titulo_w 
	from	( 
		SELECT	Obter_Dados_Titulo_Receber(nr_titulo,'VT') vl_media, 
			nr_titulo 
		from	( 
			SELECT	j.nr_titulo 
			from	banco_estabelecimento_v		k, 
				titulo_receber			j, 
				pls_contrato			h, 
				pls_plano			g, 
				pls_contrato_pagador_fin	f, 
				pls_contrato_pagador		e, 
				pls_segurado			d, 
				pls_mensalidade_seg_item	c, 
				pls_mensalidade_segurado	b, 
				pls_mensalidade			a 
			where	c.nr_seq_mensalidade_seg	= b.nr_sequencia 
			and	b.nr_seq_mensalidade		= a.nr_sequencia 
			and	b.nr_seq_segurado		= d.nr_sequencia 
			and	d.nr_seq_pagador		= e.nr_sequencia 
			and	f.nr_seq_pagador		= e.nr_sequencia 
			and	d.nr_seq_plano			= g.nr_sequencia 
			and	j.nr_seq_mensalidade		= a.nr_sequencia 
			and	e.nr_seq_contrato		= h.nr_sequencia 
			and	f.nr_seq_conta_banco		= k.nr_sequencia 
			and	((g.ie_tipo_contratacao = coalesce(ie_tipo_contratacao_p,0)) or (coalesce(ie_tipo_contratacao_p,0) = '0')) 
			and	((g.ie_regulamentacao = coalesce(ie_regulamentacao_p,0)) or (coalesce(ie_regulamentacao_p,0) = '0')) 
			and	((a.nr_seq_lote = coalesce(nr_seq_lote_p,0)) or (coalesce(nr_seq_lote_p,0) = 0)) 
			and	((ie_tipo_data_p = 'N') or 
				((ie_tipo_data_p = 'E') and j.dt_emissao between dt_inicial_p and fim_dia(dt_final_p)) or 
				((ie_tipo_data_p = 'V') and j.dt_vencimento between dt_inicial_p and fim_dia(dt_final_p)) or 
				((ie_tipo_data_p = 'R') and j.dt_liquidacao between dt_inicial_p and fim_dia(dt_final_p))) 
			and	coalesce(a.ie_cancelamento::text, '') = '' 
			and	((k.cd_banco	= cd_banco_p) or (coalesce(cd_banco_p::text, '') = '')) 
			group by	j.nr_titulo 
			
union all
 
			select	j.nr_titulo 
			from	banco_estabelecimento_v		k, 
				titulo_receber			j, 
				pls_contrato			h, 
				pls_plano			g, 
				pls_contrato_pagador_fin	f, 
				pls_contrato_pagador		e, 
				pls_mensalidade_seg_item	c, 
				pls_mensalidade			a 
			where	c.nr_seq_mensalidade		= a.nr_sequencia 
			and	f.nr_seq_pagador		= e.nr_sequencia 
			and	j.nr_seq_mensalidade		= a.nr_sequencia 
			and	e.nr_seq_contrato		= h.nr_sequencia 
			and	f.nr_seq_conta_banco		= k.nr_sequencia 
			and	a.nr_seq_pagador		= e.nr_sequencia 
			and	g.nr_sequencia		= (	select	max(nr_seq_plano) 
								from	pls_contrato_plano x 
								where	x.nr_seq_contrato = h.nr_sequencia 
								and	x.ie_situacao		= 'A') 
			and	((g.ie_tipo_contratacao = coalesce(ie_tipo_contratacao_p,0)) or (coalesce(ie_tipo_contratacao_p,0) = '0')) 
			and	((g.ie_regulamentacao = coalesce(ie_regulamentacao_p,0)) or (coalesce(ie_regulamentacao_p,0) = '0')) 
			and	((a.nr_seq_lote = coalesce(nr_seq_lote_p,0)) or (coalesce(nr_seq_lote_p,0) = 0)) 
			and	((ie_tipo_data_p = 'N') or 
				((ie_tipo_data_p = 'E') and j.dt_emissao between dt_inicial_p and fim_dia(dt_final_p)) or 
				((ie_tipo_data_p = 'V') and j.dt_vencimento between dt_inicial_p and fim_dia(dt_final_p)) or 
				((ie_tipo_data_p = 'R') and j.dt_liquidacao between dt_inicial_p and fim_dia(dt_final_p))) 
			and	coalesce(a.ie_cancelamento::text, '') = '' 
			and	((k.cd_banco	= cd_banco_p) or (coalesce(cd_banco_p::text, '') = '')) 
			group by	j.nr_titulo) alias71 
		group by	nr_titulo) alias72;
	 
	if (ie_opcao_p	= 'QTT') then 
		ds_retorno_w	:= qt_titulo_w;
	elsif (ie_opcao_p	= 'QTM') then 
		ds_retorno_w	:= vl_media_w;
	end if;
elsif (ie_opcao_p in ('TPVR','TPQR')) then 
	select	CASE WHEN ie_opcao_p='TPVR' THEN sum(vl_total) WHEN ie_opcao_p='TPQR' THEN count(*) END  
	into STRICT	ds_retorno_w 
	from	( 
		SELECT	sum(c.vl_item) vl_total, 
			b.nr_sequencia 
		from	banco_estabelecimento_v		k, 
			titulo_receber			j, 
			pls_contrato			h, 
			pls_plano			g, 
			pls_contrato_pagador_fin	f, 
			pls_contrato_pagador		e, 
			pls_segurado			d, 
			pls_mensalidade_seg_item	c, 
			pls_mensalidade_segurado	b, 
			pls_mensalidade			a 
		where	c.nr_seq_mensalidade_seg	= b.nr_sequencia 
		and	b.nr_seq_mensalidade		= a.nr_sequencia 
		and	b.nr_seq_segurado		= d.nr_sequencia 
		and	d.nr_seq_pagador		= e.nr_sequencia 
		and	f.nr_seq_pagador		= e.nr_sequencia 
		and	d.nr_seq_plano			= g.nr_sequencia 
		and	j.nr_seq_mensalidade		= a.nr_sequencia 
		and	e.nr_seq_contrato		= h.nr_sequencia 
		and	f.nr_seq_conta_banco		= k.nr_sequencia 
		and	((g.ie_tipo_contratacao = coalesce(ie_tipo_contratacao_p,0)) or (coalesce(ie_tipo_contratacao_p,0) = '0')) 
		and	((g.ie_regulamentacao = coalesce(ie_regulamentacao_p,0)) or (coalesce(ie_regulamentacao_p,0) = '0')) 
		and	((a.nr_seq_lote = coalesce(nr_seq_lote_p,0)) or (coalesce(nr_seq_lote_p,0) = 0)) 
		and	((ie_tipo_data_p = 'N') or 
			((ie_tipo_data_p = 'E') and j.dt_emissao between dt_inicial_p and fim_dia(dt_final_p)) or 
			((ie_tipo_data_p = 'V') and j.dt_vencimento between dt_inicial_p and fim_dia(dt_final_p)) or 
			((ie_tipo_data_p = 'R') and j.dt_liquidacao between dt_inicial_p and fim_dia(dt_final_p))) 
		and	coalesce(a.ie_cancelamento::text, '') = '' 
		and	((k.nr_sequencia	= nr_seq_conta_banco_p) or (coalesce(nr_seq_conta_banco_p,0) = 0)) 
		--and	c.ie_tipo_item = '1' 
		and	g.ie_regulamentacao <> 'R'    
		group by	b.nr_sequencia) alias36;
elsif (ie_opcao_p in ('TPVNR','TPQNR')) then 
	select	CASE WHEN ie_opcao_p='TPVNR' THEN sum(vl_total) WHEN ie_opcao_p='TPQNR' THEN count(*) END  
	into STRICT	ds_retorno_w 
	from	( 
		SELECT	sum(c.vl_item) vl_total, 
			b.nr_sequencia 
		from	banco_estabelecimento_v		k, 
			titulo_receber			j, 
			pls_contrato			h, 
			pls_plano			g, 
			pls_contrato_pagador_fin	f, 
			pls_contrato_pagador		e, 
			pls_segurado			d, 
			pls_mensalidade_seg_item	c, 
			pls_mensalidade_segurado	b, 
			pls_mensalidade			a 
		where	c.nr_seq_mensalidade_seg	= b.nr_sequencia 
		and	b.nr_seq_mensalidade		= a.nr_sequencia 
		and	b.nr_seq_segurado		= d.nr_sequencia 
		and	d.nr_seq_pagador		= e.nr_sequencia 
		and	f.nr_seq_pagador		= e.nr_sequencia 
		and	d.nr_seq_plano			= g.nr_sequencia 
		and	j.nr_seq_mensalidade		= a.nr_sequencia 
		and	e.nr_seq_contrato		= h.nr_sequencia 
		and	f.nr_seq_conta_banco		= k.nr_sequencia 
		and	((g.ie_tipo_contratacao = coalesce(ie_tipo_contratacao_p,0)) or (coalesce(ie_tipo_contratacao_p,0) = '0')) 
		and	((g.ie_regulamentacao = coalesce(ie_regulamentacao_p,0)) or (coalesce(ie_regulamentacao_p,0) = '0')) 
		and	((a.nr_seq_lote = coalesce(nr_seq_lote_p,0)) or (coalesce(nr_seq_lote_p,0) = 0)) 
		and	((ie_tipo_data_p = 'N') or 
			((ie_tipo_data_p = 'E') and j.dt_emissao between dt_inicial_p and fim_dia(dt_final_p)) or 
			((ie_tipo_data_p = 'V') and j.dt_vencimento between dt_inicial_p and fim_dia(dt_final_p)) or 
			((ie_tipo_data_p = 'R') and j.dt_liquidacao between dt_inicial_p and fim_dia(dt_final_p))) 
		and	coalesce(a.ie_cancelamento::text, '') = '' 
		and	((k.nr_sequencia	= nr_seq_conta_banco_p) or (coalesce(nr_seq_conta_banco_p,0) = 0)) 
		--and	c.ie_tipo_item = '1' 
		and	g.ie_regulamentacao = 'R'    
		group by	b.nr_sequencia) alias36;
elsif (ie_opcao_p in ('TPVI','TPQI')) then 
	select	CASE WHEN ie_opcao_p='TPVI' THEN sum(vl_total) WHEN ie_opcao_p='TPQI' THEN count(*) END  
	into STRICT	ds_retorno_w 
	from	( 
		SELECT	coalesce(sum(c.vl_item),0) vl_total, 
			b.nr_sequencia 
		from	banco_estabelecimento_v 	k, 
			titulo_receber			j, 
			pls_contrato			h, 
			pls_plano			g, 
			pls_contrato_pagador_fin	f, 
			pls_contrato_pagador		e, 
			pls_segurado			d, 
			pls_mensalidade_seg_item	c, 
			pls_mensalidade_segurado	b, 
			pls_mensalidade			a 
		where	c.nr_seq_mensalidade_seg	= b.nr_sequencia 
		and	b.nr_seq_mensalidade		= a.nr_sequencia 
		and	b.nr_seq_segurado		= d.nr_sequencia 
		and	d.nr_seq_pagador		= e.nr_sequencia 
		and	f.nr_seq_pagador		= e.nr_sequencia 
		and	d.nr_seq_plano			= g.nr_sequencia 
		and	j.nr_seq_mensalidade		= a.nr_sequencia 
		and	e.nr_seq_contrato		= h.nr_sequencia 
		and	f.nr_seq_conta_banco		= k.nr_sequencia 
		and	((g.ie_tipo_contratacao = coalesce(ie_tipo_contratacao_p,0)) or (coalesce(ie_tipo_contratacao_p,0) = '0')) 
		and	((g.ie_regulamentacao = coalesce(ie_regulamentacao_p,0)) or (coalesce(ie_regulamentacao_p,0) = '0')) 
		and	((a.nr_seq_lote = coalesce(nr_seq_lote_p,0)) or (coalesce(nr_seq_lote_p,0) = 0)) 
		and	((ie_tipo_data_p = 'N') or 
			((ie_tipo_data_p = 'E') and j.dt_emissao between dt_inicial_p and fim_dia(dt_final_p)) or 
			((ie_tipo_data_p = 'V') and j.dt_vencimento between dt_inicial_p and fim_dia(dt_final_p)) or 
			((ie_tipo_data_p = 'R') and j.dt_liquidacao between dt_inicial_p and fim_dia(dt_final_p))) 
		and	coalesce(a.ie_cancelamento::text, '') = '' 
		and	((k.nr_sequencia	= nr_seq_conta_banco_p) or (coalesce(nr_seq_conta_banco_p,0) = 0)) 
		and	c.ie_tipo_item = '17' 
		group by	b.nr_sequencia 
		
union all
 
		SELECT	coalesce(sum(c.vl_item),0) vl_total, 
			e.nr_sequencia 
		from	banco_estabelecimento_v		k, 
			titulo_receber			j, 
			pls_contrato			h, 
			pls_plano			g, 
			pls_contrato_pagador_fin	f, 
			pls_contrato_pagador		e, 
			pls_mensalidade_seg_item	c, 
			pls_mensalidade			a 
		where	c.nr_seq_mensalidade		= a.nr_sequencia 
		and	f.nr_seq_pagador		= e.nr_sequencia 
		and	j.nr_seq_mensalidade		= a.nr_sequencia 
		and	e.nr_seq_contrato		= h.nr_sequencia 
		and	f.nr_seq_conta_banco		= k.nr_sequencia 
		and	a.nr_seq_pagador		= e.nr_sequencia 
		and	g.nr_sequencia		= (	select	max(nr_seq_plano) 
					from	pls_contrato_plano x 
					where	x.nr_seq_contrato = h.nr_sequencia 
					and	x.ie_situacao		= 'A') 
		and	((g.ie_tipo_contratacao = coalesce(ie_tipo_contratacao_p,0)) or (coalesce(ie_tipo_contratacao_p,0) = '0')) 
		and	((g.ie_regulamentacao = coalesce(ie_regulamentacao_p,0)) or (coalesce(ie_regulamentacao_p,0) = '0')) 
		and	((a.nr_seq_lote = coalesce(nr_seq_lote_p,0)) or (coalesce(nr_seq_lote_p,0) = 0)) 
		and	((ie_tipo_data_p = 'N') or 
			((ie_tipo_data_p = 'E') and j.dt_emissao between dt_inicial_p and fim_dia(dt_final_p)) or 
			((ie_tipo_data_p = 'V') and j.dt_vencimento between dt_inicial_p and fim_dia(dt_final_p)) or 
			((ie_tipo_data_p = 'R') and j.dt_liquidacao between dt_inicial_p and fim_dia(dt_final_p))) 
		and	coalesce(a.ie_cancelamento::text, '') = '' 
		and	((k.nr_sequencia	= nr_seq_conta_banco_p) or (coalesce(nr_seq_conta_banco_p,0) = 0)) 
		and	c.ie_tipo_item = '17' 
		group by	e.nr_sequencia) alias72;
elsif (ie_opcao_p in ('TPVB','TPQB')) then 
	select	CASE WHEN ie_opcao_p='TPVB' THEN sum(vl_total) WHEN ie_opcao_p='TPQB' THEN count(*) END  
	into STRICT	ds_retorno_w 
	from	( 
		SELECT	coalesce(sum(c.vl_item),0) vl_total, 
			b.nr_sequencia 
		from	banco_estabelecimento_v 	k, 
			titulo_receber			j, 
			pls_contrato			h, 
			pls_plano			g, 
			pls_contrato_pagador_fin	f, 
			pls_contrato_pagador		e, 
			pls_segurado			d, 
			pls_mensalidade_seg_item	c, 
			pls_mensalidade_segurado	b, 
			pls_mensalidade			a 
		where	c.nr_seq_mensalidade_seg	= b.nr_sequencia 
		and	b.nr_seq_mensalidade		= a.nr_sequencia 
		and	b.nr_seq_segurado		= d.nr_sequencia 
		and	d.nr_seq_pagador		= e.nr_sequencia 
		and	f.nr_seq_pagador		= e.nr_sequencia 
		and	d.nr_seq_plano			= g.nr_sequencia 
		and	j.nr_seq_mensalidade		= a.nr_sequencia 
		and	e.nr_seq_contrato		= h.nr_sequencia 
		and	f.nr_seq_conta_banco		= k.nr_sequencia 
		and	((g.ie_tipo_contratacao = coalesce(ie_tipo_contratacao_p,0)) or (coalesce(ie_tipo_contratacao_p,0) = '0')) 
		and	((g.ie_regulamentacao = coalesce(ie_regulamentacao_p,0)) or (coalesce(ie_regulamentacao_p,0) = '0')) 
		and	((a.nr_seq_lote = coalesce(nr_seq_lote_p,0)) or (coalesce(nr_seq_lote_p,0) = 0)) 
		and	((ie_tipo_data_p = 'N') or 
			((ie_tipo_data_p = 'E') and j.dt_emissao between dt_inicial_p and fim_dia(dt_final_p)) or 
			((ie_tipo_data_p = 'V') and j.dt_vencimento between dt_inicial_p and fim_dia(dt_final_p)) or 
			((ie_tipo_data_p = 'R') and j.dt_liquidacao between dt_inicial_p and fim_dia(dt_final_p))) 
		and	coalesce(a.ie_cancelamento::text, '') = '' 
		and	((k.nr_sequencia	= nr_seq_conta_banco_p) or (coalesce(nr_seq_conta_banco_p,0) = 0)) 
		and	c.ie_tipo_item = '14' 
		group by	b.nr_sequencia 
		
union all
 
		SELECT	coalesce(sum(c.vl_item),0) vl_total, 
			e.nr_sequencia 
		from	banco_estabelecimento_v		k, 
			titulo_receber			j, 
			pls_contrato			h, 
			pls_plano			g, 
			pls_contrato_pagador_fin	f, 
			pls_contrato_pagador		e, 
			pls_mensalidade_seg_item	c, 
			pls_mensalidade			a 
		where	c.nr_seq_mensalidade		= a.nr_sequencia 
		and	f.nr_seq_pagador		= e.nr_sequencia 
		and	j.nr_seq_mensalidade		= a.nr_sequencia 
		and	e.nr_seq_contrato		= h.nr_sequencia 
		and	f.nr_seq_conta_banco		= k.nr_sequencia 
		and	a.nr_seq_pagador		= e.nr_sequencia 
		and	g.nr_sequencia		= (	select	max(nr_seq_plano) 
					from	pls_contrato_plano x 
					where	x.nr_seq_contrato = h.nr_sequencia 
					and	x.ie_situacao		= 'A') 
		and	((g.ie_tipo_contratacao = coalesce(ie_tipo_contratacao_p,0)) or (coalesce(ie_tipo_contratacao_p,0) = '0')) 
		and	((g.ie_regulamentacao = coalesce(ie_regulamentacao_p,0)) or (coalesce(ie_regulamentacao_p,0) = '0')) 
		and	((a.nr_seq_lote = coalesce(nr_seq_lote_p,0)) or (coalesce(nr_seq_lote_p,0) = 0)) 
		and	((ie_tipo_data_p = 'N') or 
			((ie_tipo_data_p = 'E') and j.dt_emissao between dt_inicial_p and fim_dia(dt_final_p)) or 
			((ie_tipo_data_p = 'V') and j.dt_vencimento between dt_inicial_p and fim_dia(dt_final_p)) or 
			((ie_tipo_data_p = 'R') and j.dt_liquidacao between dt_inicial_p and fim_dia(dt_final_p))) 
		and	coalesce(a.ie_cancelamento::text, '') = '' 
		and	((k.nr_sequencia	= nr_seq_conta_banco_p) or (coalesce(nr_seq_conta_banco_p,0) = 0)) 
		and	c.ie_tipo_item = '14' 
		group by	e.nr_sequencia) alias72;
end if;
	 
return	ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_vl_total_banco_relat (ie_opcao_p text, ie_tipo_data_p text, dt_inicial_p timestamp, dt_final_p timestamp, nr_seq_lote_p bigint, nr_seq_conta_banco_p bigint, ie_tipo_contratacao_p text, ie_regulamentacao_p text, cd_banco_p bigint) FROM PUBLIC;

