-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_horario_adep_sol ( dt_prescricao_p timestamp, dt_inicio_prescr_p timestamp, hr_horario_p text, ie_agora_p text, ie_sn_p text, ie_acm_p text) RETURNS timestamp AS $body$
DECLARE


dt_prescricao_w	timestamp;
hr_prescricao_w	varchar(5);
dt_inicio_prescr_w	timestamp;
hr_inicio_prescr_w	varchar(5);
dt_horario_w	timestamp;


BEGIN

dt_prescricao_w	:= trunc(dt_prescricao_p,'dd');
hr_prescricao_w	:= to_char(dt_prescricao_p,'hh24:mi');
dt_inicio_prescr_w	:= trunc(dt_inicio_prescr_p,'dd');
hr_inicio_prescr_w	:= to_char(dt_inicio_prescr_p,'hh24:mi');

if (coalesce(ie_agora_p,'N') = 'S') then
	begin
	if (hr_horario_p IS NOT NULL AND hr_horario_p::text <> '') and (hr_horario_p >= hr_prescricao_w) then
		dt_horario_w	:= to_date(to_char(dt_prescricao_w,'dd/mm/yyyy') || ' ' || hr_horario_p || ':00','dd/mm/yyyy hh24:mi:ss');
	else
		dt_horario_w	:= to_date(to_char(dt_prescricao_w,'dd/mm/yyyy') || ' ' || hr_prescricao_w || ':00','dd/mm/yyyy hh24:mi:ss');
	end if;
	end;
elsif (coalesce(ie_sn_p,'N') = 'S') or (coalesce(ie_acm_p,'N') = 'S') then
	begin
	dt_horario_w	:= null;
	end;
elsif (hr_horario_p IS NOT NULL AND hr_horario_p::text <> '') and (hr_horario_p >= hr_inicio_prescr_w) then
	begin
	dt_horario_w	:= to_date(to_char(dt_inicio_prescr_w,'dd/mm/yyyy') || ' ' || hr_horario_p || ':00','dd/mm/yyyy hh24:mi:ss');
	end;
else
	begin
	dt_horario_w	:= dt_inicio_prescr_p;
	end;
end if;

return dt_horario_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_horario_adep_sol ( dt_prescricao_p timestamp, dt_inicio_prescr_p timestamp, hr_horario_p text, ie_agora_p text, ie_sn_p text, ie_acm_p text) FROM PUBLIC;

