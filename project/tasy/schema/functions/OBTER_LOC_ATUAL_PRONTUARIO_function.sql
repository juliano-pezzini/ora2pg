-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_loc_atual_prontuario ( nr_prontuario_p bigint, cd_estabelecimento_p bigint) RETURNS varchar AS $body$
DECLARE

 
ds_local_atual_w	varchar(160) := wheb_mensagem_pck.get_texto(309570); -- SAME 
C01 CURSOR FOR 
SELECT	substr(obter_nome_setor(cd_setor_atendimento),1,100) ||' - '||substr(obter_nome_agenda(cd_agenda),1,50) 
from	same_cpi_emp 
where	nr_prontuario		= nr_prontuario_p 
and	cd_estabelecimento	= cd_estabelecimento_p 
and	coalesce(dt_devolucao::text, '') = '' 
order by dt_emprestimo;


BEGIN 
 
OPEN C01;
LOOP 
FETCH C01 into 
	ds_local_atual_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	ds_local_atual_w	:= ds_local_atual_w;
END LOOP;
Close C01;
 
return ds_local_atual_w;
 
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_loc_atual_prontuario ( nr_prontuario_p bigint, cd_estabelecimento_p bigint) FROM PUBLIC;

