-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_end_prest_descre ( cd_pessoa_fisica_p text, cd_cgc_p text, ie_tipo_compl_prest_p text, ie_compl_pj_adic_p text, nr_seq_compl_adic_p bigint, nr_seq_tipo_compl_adic_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE

				 
/* 
ie_opcao_p 
E - Endereço completo 
EG - Endereço para pesquisa no GMPAS 
T - Telefone com DDD 
*/
				 
			 
ds_retorno_w		varchar(255);
ds_endereco_w		varchar(255);
ds_complemento_w	varchar(255);
ds_bairro_w		varchar(255);
cd_cep_w		varchar(255);
nr_telefone_w		varchar(30);
ds_email_w		varchar(255);
nr_ddi_telefone_w	varchar(6);
nr_ddd_telefone_w	varchar(6);
nr_endereco_w		varchar(5);
nr_ramal_w		integer;
cd_municipio_ibge_w	varchar(20);
sg_estado_w		pessoa_juridica.sg_estado%type;
ds_fax_w		varchar(80);
nr_ddd_fax_w		varchar(3);
ds_municipio_w		varchar(40);
ds_fone_adic_w		varchar(255);
ds_website_w		varchar(255);


BEGIN 
 
SELECT * FROM pls_obter_dados_end_prest_gm(	cd_pessoa_fisica_p, cd_cgc_p, ie_tipo_compl_prest_p, ie_compl_pj_adic_p, nr_seq_compl_adic_p, nr_seq_tipo_compl_adic_p, null, ds_endereco_w, nr_endereco_w, ds_complemento_w, ds_bairro_w, cd_cep_w, nr_telefone_w, ds_email_w, ds_website_w, nr_ddi_telefone_w, nr_ddd_telefone_w, nr_ramal_w, cd_municipio_ibge_w, sg_estado_w, ds_fax_w, nr_ddd_fax_w, ds_municipio_w, ds_fone_adic_w) INTO STRICT ds_endereco_w, nr_endereco_w, ds_complemento_w, ds_bairro_w, cd_cep_w, nr_telefone_w, ds_email_w, ds_website_w, nr_ddi_telefone_w, nr_ddd_telefone_w, nr_ramal_w, cd_municipio_ibge_w, sg_estado_w, ds_fax_w, nr_ddd_fax_w, ds_municipio_w, ds_fone_adic_w;
 
if (ie_opcao_p = 'E') then 
	if (ds_endereco_w IS NOT NULL AND ds_endereco_w::text <> '') then 
		ds_retorno_w	:= ds_endereco_w||', ';
	end if;
	 
	if (nr_endereco_w IS NOT NULL AND nr_endereco_w::text <> '') then 
		ds_retorno_w	:= ds_retorno_w||nr_endereco_w||', ';
	end if;
	 
	if (ds_bairro_w IS NOT NULL AND ds_bairro_w::text <> '') then 
		ds_retorno_w	:= ds_retorno_w||ds_bairro_w||' - ';
	end if;
	 
	if (cd_cep_w IS NOT NULL AND cd_cep_w::text <> '') then 
		ds_retorno_w	:= ds_retorno_w||cd_cep_w||' - ';
	end if;
	 
	if (ds_municipio_w IS NOT NULL AND ds_municipio_w::text <> '') then 
		ds_retorno_w	:= ds_retorno_w||ds_municipio_w;
	end if;
	 
	if (sg_estado_w IS NOT NULL AND sg_estado_w::text <> '') then 
		ds_retorno_w	:= ds_retorno_w||' / ' ||sg_estado_w;
	end if;
	 
elsif (ie_opcao_p = 'T') then 
	 
	if (nr_ddd_telefone_w IS NOT NULL AND nr_ddd_telefone_w::text <> '') then 
		ds_retorno_w	:= nr_ddd_telefone_w;
	end if;
	 
	if (nr_telefone_w IS NOT NULL AND nr_telefone_w::text <> '') then 
		ds_retorno_w	:= ds_retorno_w||nr_telefone_w;
	end if;
	 
elsif (ie_opcao_p = 'EG') then 
 
	if (nr_endereco_w IS NOT NULL AND nr_endereco_w::text <> '') then 
		ds_retorno_w	:= nr_endereco_w||', ';
	end if;
 
	if (ds_endereco_w IS NOT NULL AND ds_endereco_w::text <> '') then 
		ds_retorno_w	:= ds_retorno_w||ds_endereco_w;
	end if;
	 
	if (ds_municipio_w IS NOT NULL AND ds_municipio_w::text <> '') then 
		ds_retorno_w	:= ds_retorno_w||', '|| ds_municipio_w;
	end if;
	 
	if (sg_estado_w IS NOT NULL AND sg_estado_w::text <> '') then 
		ds_retorno_w	:= ds_retorno_w||', ' ||sg_estado_w;
	end if;
	 
	if (cd_cep_w IS NOT NULL AND cd_cep_w::text <> '') then 
		ds_retorno_w	:= ds_retorno_w||', '||cd_cep_w;
	end if;
	 
	ds_retorno_w	:= elimina_acentos(ds_retorno_w);
 
end if;
 
return	ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_end_prest_descre ( cd_pessoa_fisica_p text, cd_cgc_p text, ie_tipo_compl_prest_p text, ie_compl_pj_adic_p text, nr_seq_compl_adic_p bigint, nr_seq_tipo_compl_adic_p bigint, ie_opcao_p text) FROM PUBLIC;

