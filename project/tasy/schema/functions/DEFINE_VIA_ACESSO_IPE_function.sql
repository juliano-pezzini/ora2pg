-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION define_via_acesso_ipe (nr_interno_conta_p bigint, cd_item_p bigint, pr_via_acesso_p bigint) RETURNS bigint AS $body$
DECLARE


/* 00 - Única ou principal				Quando existe somente um procedimento */

/* 31 - Mesma via de honorário anterior		duas cirurgias diferentes c/mesma via */

/* 32 - vias diferentes					duas cirurgias diferentes c/via diferente */

/* 33 - cirurgia bilateral				mesma cirurgia Ex:(perna esquerda e direita) */

ie_vias_acesso_ipe_w	smallint;
qt_cirurgias_w		integer;



BEGIN
/* Inicializa com padrão */

ie_vias_acesso_ipe_w	:= 00;

select count(*)
into STRICT	 qt_cirurgias_w
from	 estrutura_procedimento_v a,
	 procedimento_paciente b
where	 b.nr_interno_conta	= nr_interno_conta_p
and	 b.cd_procedimento	= a.cd_procedimento
and	 b.ie_origem_proced	= a.ie_origem_proced
and	 a.cd_area_procedimento	= 4
and	 b.cd_procedimento_convenio <> '16000005';

if (qt_cirurgias_w	= 1) then
	 ie_vias_acesso_ipe_w	:= 00;
else
	 begin
	 select count(*)
	 into STRICT	 qt_cirurgias_w
	 from	 procedimento_paciente b
	 where b.nr_interno_conta	= nr_interno_conta_p
	 and	 b.cd_procedimento	= cd_item_p;
	 if (qt_cirurgias_w	> 1) then
	 	 ie_vias_acesso_ipe_w	:= 33;
	 else
		 begin
		 if (pr_via_acesso_p	= 100) then
	 	 	ie_vias_acesso_ipe_w	:= 32;
		 else
	 	 	ie_vias_acesso_ipe_w	:= 31;
		 end if;
		 end;
	 end if;
	end;
end if;

return ie_vias_acesso_ipe_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION define_via_acesso_ipe (nr_interno_conta_p bigint, cd_item_p bigint, pr_via_acesso_p bigint) FROM PUBLIC;

