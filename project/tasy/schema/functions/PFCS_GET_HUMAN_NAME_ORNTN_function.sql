-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pfcs_get_human_name_orntn ( nr_sequencia_p bigint, ds_role_p text default 'Patient', delim text default ',', orientation bigint default 1) RETURNS varchar AS $body$
DECLARE


  ds_name 				varchar(300) := '';
  family_name 			varchar(255) := '';
  given_name 			varchar(255) := '';
  ds_pat                varchar(15) := 'Patient';
  ds_prac             	varchar(15) := 'Practitioner';

BEGIN

	if (ds_role_p = ds_pat) then

		select family, given into STRICT family_name, given_name
		from pfcs_human_name
		where nr_seq_patient = nr_sequencia_p;

	elsif (ds_role_p = ds_prac) then
	
		select family, given into STRICT family_name, given_name
		from pfcs_human_name
		where nr_seq_practitioner = nr_sequencia_p;
		
	end if;

	if (family_name IS NOT NULL AND family_name::text <> '') then
		ds_name := family_name;
	end if;
	
	if ( orientation =1) then
		if (given_name IS NOT NULL AND given_name::text <> '') then
			ds_name := ds_name
				|| delim
				||   substr(given_name, 0, 1)
				|| '.';
		end if;
	else
		if (given_name IS NOT NULL AND given_name::text <> '') then
			ds_name := substr(given_name, 0, 1)
				|| delim
				||  ds_name;
		end if;
	end if;
	

	

	return ds_name;

	exception
		-- If there are no records found
		when no_data_found then
		  return ds_name;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pfcs_get_human_name_orntn ( nr_sequencia_p bigint, ds_role_p text default 'Patient', delim text default ',', orientation bigint default 1) FROM PUBLIC;

