-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';



CREATE TYPE horario AS (horario_w varchar(255));


CREATE OR REPLACE FUNCTION cpoe_reordena_das_as ( dt_incial_p timestamp, ds_horarios_p text) RETURNS varchar AS $body$
DECLARE

type vetor is table of horario index by integer;

ds_hora_w 			vetor;

ds_das_w			varchar(255) := obter_texto_tasy(439834, wheb_usuario_pck.get_nr_seq_idioma);
ds_as_w				varchar(50) := obter_texto_tasy(439836, wheb_usuario_pck.get_nr_seq_idioma);
ds_horarios_w		varchar(255);
ds_horarios_aux_w	varchar(255);
ds_horario_w		varchar(255);
ds_horario_aux_w	varchar(255);
qt_seg_w			bigint;
nr_hora_w			bigint;
nr_inicial_w		bigint;
nr_index_w			bigint := 0;


BEGIN

for nr_index_w in 0..23 loop
	begin
	ds_hora_w[nr_index_w].horario_w := '';
	end;
end loop;
if (to_char(dt_incial_p,'mi') <> '00') then
	nr_inicial_w	:= (to_char(dt_incial_p + 1/24,'hh24'))::numeric;
else
	nr_inicial_w	:= (to_char(dt_incial_p,'hh24'))::numeric;
end if;

ds_horarios_aux_w 	:= ds_horarios_p;

qt_seg_w := 0;
loop
exit when position(';' in ds_horarios_aux_w) = 0;
	begin
	qt_seg_w := qt_seg_w  + 1;
	ds_horario_aux_w := substr(ds_horarios_aux_w,1,position(';' in ds_horarios_aux_w));
	ds_horarios_aux_w := substr(ds_horarios_aux_w,position(';' in ds_horarios_aux_w) + 2, length(ds_horarios_aux_w));

	ds_horario_w := substr(ds_horario_aux_w,length(ds_das_w) + 2, length(ds_horario_aux_w));
	ds_horario_w := substr(ds_horario_w,1, position(ds_as_w in ds_horario_w) -1);
	nr_hora_w	 := (substr(ds_horario_w,1,2))::numeric;

	if (nr_hora_w IS NOT NULL AND nr_hora_w::text <> '') then
		ds_hora_w[nr_hora_w].horario_w := ds_horario_aux_w;
	end if;

	if (qt_seg_w > 100) then
		exit;
	end if;
	end;
end loop;


nr_index_w := 0;
for nr_index_w in nr_inicial_w..23 loop
	begin
	if (ds_hora_w[nr_index_w](.horario_w IS NOT NULL AND .horario_w::text <> '')) then
		ds_horarios_w := ds_horarios_w||ds_hora_w[nr_index_w].horario_w||' ';
	end if;
	end;
end loop;

RAISE NOTICE '% %', obter_desc_expressao(771970), DS_HORARIOS_W;--HORÃRIOS
if (nr_inicial_w > 0) then
	nr_index_w := 0;
	for nr_index_w in 0..nr_inicial_w loop
		begin
		if (ds_hora_w[nr_index_w](.horario_w IS NOT NULL AND .horario_w::text <> '')) then
			ds_horarios_w := ds_horarios_w||ds_hora_w[nr_index_w].horario_w||' ';
		end if;
		end;
	end loop;
end if;

return ds_horarios_w;

end; --cpoe_obter_horarios_limpo;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_reordena_das_as ( dt_incial_p timestamp, ds_horarios_p text) FROM PUBLIC;

