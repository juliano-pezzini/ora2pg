-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_vl_exame_nom (nr_seq_proc_p bigint, nr_prescricao_p bigint, nr_seq_exame_p bigint) RETURNS varchar AS $body$
DECLARE


qt_valor_exame_w		varchar(50);				
				

BEGIN

select	max(substr(lab_obter_resultado_exame(f.nr_seq_resultado, f.nr_sequencia), 1, 50))
into STRICT	qt_valor_exame_w
from   	atendimento_paciente a,
		prescr_medica b,
		prescr_procedimento c,
		exame_laboratorio d,
		exame_lab_resultado e,
		exame_lab_result_item f
where	b.nr_atendimento          	= a.nr_atendimento
and    	c.nr_prescricao           	= b.nr_prescricao
and    	d.nr_seq_exame            	= f.nr_seq_exame
and    	e.nr_prescricao           	= b.nr_prescricao
and    	e.nr_atendimento          	= a.nr_atendimento
and    	f.nr_seq_resultado        	= e.nr_seq_resultado
and    	f.nr_seq_prescr           	= c.nr_sequencia
and    	(c.cd_material_exame IS NOT NULL AND c.cd_material_exame::text <> '')
and    	f.nr_seq_exame            	= nr_seq_exame_p
and    	coalesce(c.ie_suspenso,'N')    	= 'N'
and     c.nr_prescricao 			= nr_prescricao_p 
and     c.nr_sequencia  			= nr_seq_proc_p;

return	qt_valor_exame_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_vl_exame_nom (nr_seq_proc_p bigint, nr_prescricao_p bigint, nr_seq_exame_p bigint) FROM PUBLIC;

