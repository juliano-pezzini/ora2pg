-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_nome_responsavel (nr_atendimento_p bigint) RETURNS varchar AS $body$
DECLARE

 
ds_retorno_w			varchar(180);
ie_responsavel_w		varchar(015);
cd_pessoa_fisica_w		varchar(10);
cd_pessoa_resp_w		varchar(10);
nm_responsavel_w		varchar(180);


BEGIN 
select		coalesce(max(campo_numerico(ie_responsavel)),2), 
		max(cd_pessoa_fisica), 
		max(cd_pessoa_responsavel) 
into STRICT		ie_responsavel_w, 
		cd_pessoa_fisica_w, 
		cd_pessoa_resp_w 
from		Atendimento_paciente 
where		nr_atendimento	= nr_atendimento_p;
 
if (cd_pessoa_resp_w IS NOT NULL AND cd_pessoa_resp_w::text <> '') then 
	select	max(substr(obter_nome_pf(cd_pessoa_fisica),1,180))	 
	into STRICT		nm_responsavel_w 
	from		Pessoa_fisica 
	where	cd_pessoa_fisica	= cd_pessoa_resp_w;
else 
	select max(substr(obter_compl_pf(cd_pessoa_fisica_w, ie_responsavel_w,'N'),1,80)) 
	into STRICT nm_responsavel_w 
	;
end if;
RETURN nm_responsavel_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_nome_responsavel (nr_atendimento_p bigint) FROM PUBLIC;

