-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_have_prescr_integr_out (ds_value_p text, ds_type_p text) RETURNS varchar AS $body$
DECLARE


/* ds_type_p - types of acceptable values
R - recomendation
P - procedure
G - gas
I - internal procedure
T - type of fasting (diet)
O - oral diet
*/
count_w smallint := 0;


BEGIN

if (ds_type_p not in ('R','P','G','I','T','O') or coalesce(ds_value_p::text, '') = '') then
	return 'N';
end if;

select count(1)
into STRICT count_w
from PRESCRICAO_INTEGRACAO c,
	PRESCR_ITEM_INTEGRACAO d
where c.nr_sequencia = d.nr_presc_integracao
and (
	(ds_type_p = 'R' and c.CD_RECOMENDACAO = ds_value_p)
	or (ds_type_p = 'P' and c.CD_PROCEDIMENTO = ds_value_p)
	or (ds_type_p = 'G' and c.NR_SEQ_GAS = ds_value_p)
	or (ds_type_p = 'I' and c.NR_SEQ_PROC_INTERNO = ds_value_p)
	or (ds_type_p = 'T' and c.NR_SEQ_TIPO = ds_value_p)
	or (ds_type_p = 'O' and c.CD_DIETA = ds_value_p)
	)
and d.IE_ENVIO_RECEB in ('E', 'A')
;	

if (count_w > 0) then
	return 'S';
else
	return 'N';
end if;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_have_prescr_integr_out (ds_value_p text, ds_type_p text) FROM PUBLIC;

