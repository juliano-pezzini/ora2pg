-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_count_primary_site ( nr_atendimento_p bigint , nr_sequencia_p bigint ) RETURNS varchar AS $body$
DECLARE


       ds_retorno_w varchar(2 ) := '01';
       nr_sequencia_w registro_cancer.nr_sequencia%type;
       nr_atendimento_w registro_cancer.nr_atendimento%type;
       loopcount smallint :=1;

       c01 CURSOR FOR
              SELECT
                     nr_atendimento ,
                     nr_sequencia
              from
                     registro_cancer
              where
                     nr_atendimento=nr_atendimento_p;


BEGIN

       open c01;
       loop
              fetch
                     c01
              into
                     nr_atendimento_w ,
                     nr_sequencia_w;
              EXIT WHEN NOT FOUND; /* apply on c01 */

              begin
                     if ( nr_sequencia_w =nr_sequencia_p ) then
                            exit;
                     end if;
              end;
              loopcount:=loopcount+1;
       end loop;
close c01;

select
       CASE WHEN  sign( loopcount-10 ) =-1 THEN  '0'||       loopcount  WHEN  sign( loopcount-10 ) =0 THEN  ''                     ||       loopcount   ELSE ''                         ||       loopcount END
into STRICT
       ds_retorno_w
;
return ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_count_primary_site ( nr_atendimento_p bigint , nr_sequencia_p bigint ) FROM PUBLIC;

