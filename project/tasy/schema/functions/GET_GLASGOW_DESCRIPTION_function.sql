-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_glasgow_description ( nr_atendimento_p bigint, ie_value_type_p text, ie_value_p text ) RETURNS varchar AS $body$
DECLARE

  ds_result_w   varchar(255)  := '';
  ie_adultage_w bigint         :=0;
  ie_age_w      bigint         :=0;
  ie_patient_type_w varchar(1) := 'P';
  cd_expression_w bigint    :=0;

BEGIN
  ie_adultage_w := obter_param_usuario(281, 331, wheb_usuario_pck.get_cd_perfil, wheb_usuario_pck.get_nm_usuario, wheb_usuario_pck.get_cd_estabelecimento, ie_adultage_w);
  SELECT obter_idade(pf.dt_nascimento,clock_timestamp(),'A')
  INTO STRICT ie_age_w
  FROM atendimento_paciente ap
  INNER JOIN pessoa_fisica pf
  ON ap.cd_pessoa_fisica = pf.cd_pessoa_fisica
  WHERE nr_atendimento   = nr_atendimento_p;
  IF (ie_age_w < ie_adultage_w) THEN
    ie_patient_type_w     := 'P';
  ELSE
    ie_patient_type_w := 'A';
  END IF;
IF (ie_patient_type_w ='A') THEN
  BEGIN
    IF (ie_value_type_p ='M') THEN
      SELECT CASE WHEN ie_value_p=6 THEN 1057205 WHEN ie_value_p=5 THEN 1057204 WHEN ie_value_p=4 THEN 1057206 WHEN ie_value_p=3 THEN 1057207 WHEN ie_value_p=2 THEN 1057208 WHEN ie_value_p=1 THEN 1057209 END
      INTO STRICT cd_expression_w
;
    elsif (ie_value_type_p ='V') THEN
      SELECT CASE WHEN ie_value_p=5 THEN 1057215 WHEN ie_value_p=4 THEN 1057216 WHEN ie_value_p=3 THEN 1057218 WHEN ie_value_p=2 THEN 1057219 WHEN ie_value_p=1 THEN 1057209 END
      INTO STRICT cd_expression_w
;
    elsif (ie_value_type_p ='P2018') THEN
      SELECT CASE WHEN ie_value_p=2 THEN 1131608 WHEN ie_value_p=1 THEN 1131609 WHEN ie_value_p=0 THEN 1131610 END
      INTO STRICT cd_expression_w
;
    elsif (ie_value_type_p ='M2018') THEN
      SELECT CASE WHEN ie_value_p=6 THEN 1131594 WHEN ie_value_p=5 THEN 1131595 WHEN ie_value_p=4 THEN 1131596 WHEN ie_value_p=3 THEN 1131597 WHEN ie_value_p=2 THEN 1131598 WHEN ie_value_p=1 THEN 1131599 WHEN ie_value_p=0 THEN 1131600 END
      INTO STRICT cd_expression_w
;
   elsif (ie_value_type_p ='V2018') THEN
      SELECT CASE WHEN ie_value_p=5 THEN 1131601 WHEN ie_value_p=4 THEN 1131602 WHEN ie_value_p=3 THEN 1131603 WHEN ie_value_p=2 THEN 1131604 WHEN ie_value_p=1 THEN 1131599 WHEN ie_value_p=0 THEN 1131600 END
      INTO STRICT cd_expression_w
;
  elsif (ie_value_type_p ='O2018') THEN
      SELECT CASE WHEN ie_value_p=4 THEN 1131605 WHEN ie_value_p=3 THEN 1131606 WHEN ie_value_p=2 THEN 1131607 WHEN ie_value_p=1 THEN 1131599 WHEN ie_value_p=0 THEN 1131600 END 
      INTO STRICT cd_expression_w
;
    ELSE
      SELECT CASE WHEN ie_value_p=4 THEN 1057220 WHEN ie_value_p=3 THEN 1057223 WHEN ie_value_p=2 THEN 1057222 WHEN ie_value_p=1 THEN 1057209 END
      INTO STRICT cd_expression_w
;
    END IF;
  END;
ELSE
  BEGIN
    IF (ie_value_type_p ='M') THEN
      SELECT CASE WHEN ie_value_p=6 THEN 1057205 WHEN ie_value_p=5 THEN 1057210 WHEN ie_value_p=4 THEN 1057211 WHEN ie_value_p=3 THEN 1057212 WHEN ie_value_p=2 THEN 1057214 WHEN ie_value_p=1 THEN 1057209 END
      INTO STRICT cd_expression_w
;
    elsif (ie_value_type_p ='V') THEN
      SELECT CASE WHEN ie_value_p=5 THEN 1057224 WHEN ie_value_p=4 THEN 1057226 WHEN ie_value_p=3 THEN 1057227 WHEN ie_value_p=2 THEN 1057229 WHEN ie_value_p=1 THEN 1057209 END
      INTO STRICT cd_expression_w
;
    elsif (ie_value_type_p ='P2018') THEN
      SELECT CASE WHEN ie_value_p=2 THEN 1131608 WHEN ie_value_p=1 THEN 1131609 WHEN ie_value_p=0 THEN 1131610 END
      INTO STRICT cd_expression_w
;
    elsif (ie_value_type_p ='M2018') THEN
      SELECT CASE WHEN ie_value_p=6 THEN 1131594 WHEN ie_value_p=5 THEN 1131595 WHEN ie_value_p=4 THEN 1131596 WHEN ie_value_p=3 THEN 1131597 WHEN ie_value_p=2 THEN 1131598 WHEN ie_value_p=1 THEN 1131599 WHEN ie_value_p=0 THEN 1131600 END
      INTO STRICT cd_expression_w
;
   elsif (ie_value_type_p ='V2018') THEN
      SELECT CASE WHEN ie_value_p=5 THEN 1131601 WHEN ie_value_p=4 THEN 1131602 WHEN ie_value_p=3 THEN 1131603 WHEN ie_value_p=2 THEN 1131604 WHEN ie_value_p=1 THEN 1131599 WHEN ie_value_p=0 THEN 1131600 END
      INTO STRICT cd_expression_w
;
   elsif (ie_value_type_p ='O2018') THEN
      SELECT CASE WHEN ie_value_p=4 THEN 1131605 WHEN ie_value_p=3 THEN 1131606 WHEN ie_value_p=2 THEN 1131607 WHEN ie_value_p=1 THEN 1131599 WHEN ie_value_p=0 THEN 1131600 END 
      INTO STRICT cd_expression_w
;
    ELSE
      SELECT CASE WHEN ie_value_p=4 THEN 1057220 WHEN ie_value_p=3 THEN 1057223 WHEN ie_value_p=2 THEN 1057222 WHEN ie_value_p=1 THEN 1057209 END
      INTO STRICT cd_expression_w
;
    END IF;
  END;
END IF;
SELECT OBTER_TEXTO_TASY(cd_expression_w,philips_param_pck.get_nr_seq_idioma)
INTO STRICT ds_result_w
;
RETURN ds_result_w;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_glasgow_description ( nr_atendimento_p bigint, ie_value_type_p text, ie_value_p text ) FROM PUBLIC;

