-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_vl_juros_diario_tit (nr_tit_pagar_p bigint, nr_tit_receber_p bigint) RETURNS bigint AS $body$
DECLARE


vl_saldo_juros_w		double precision := 0;
vl_saldo_multa_w		double precision := 0;
tx_juros_w			double precision := 0;
tx_multa_w			double precision := 0;
cd_tipo_taxa_juro_w		bigint;
cd_tipo_taxa_multa_w		bigint;
vl_saldo_titulo_w		double precision := 0;
pr_juros_w			double precision := 0;
ie_tipo_taxa_w			varchar(255);
vl_retorno_w			double precision := 0;


BEGIN

if (coalesce(nr_tit_pagar_p,0) > 0) then

	select	tx_juros,
		tx_multa,
		cd_tipo_taxa_juro,
		vl_saldo_titulo
	into STRICT	tx_juros_w,
		tx_multa_w,
		cd_tipo_taxa_juro_w,
		vl_saldo_titulo_w
	from	titulo_pagar
	where	nr_titulo		= nr_tit_pagar_p;

elsif (coalesce(nr_tit_receber_p,0) > 0) then

	select	tx_juros,
		tx_multa,
		cd_tipo_taxa_juro,
		vl_saldo_titulo
	into STRICT	tx_juros_w,
		tx_multa_w,
		cd_tipo_taxa_juro_w,
		vl_saldo_titulo_w
	from	titulo_receber
	where	nr_titulo		= nr_tit_receber_p;

end if;

if (tx_juros_w > 0) then

	select	ie_tipo_taxa
	into STRICT	ie_tipo_taxa_w
	from	tipo_taxa
	where	cd_tipo_taxa	= cd_tipo_taxa_juro_w;

	if (ie_tipo_taxa_w = 'A') then
		pr_juros_w	:= dividir_sem_round((tx_juros_w)::numeric, 365);
	elsif (ie_tipo_taxa_w = 'M') then
		pr_juros_w	:= dividir_sem_round((tx_juros_w)::numeric, 30);
	elsif (ie_tipo_taxa_w = 'D') then
		pr_juros_w	:= tx_juros_w;
	end if;

	if (ie_tipo_taxa_w = 'V') then
		vl_saldo_juros_w	:= tx_juros_w;
	else
		vl_saldo_juros_w	:= vl_saldo_titulo_w * dividir_sem_round((pr_juros_w)::numeric,100);
	end if;

end if;

vl_retorno_w := vl_saldo_juros_w;


return	vl_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_vl_juros_diario_tit (nr_tit_pagar_p bigint, nr_tit_receber_p bigint) FROM PUBLIC;

