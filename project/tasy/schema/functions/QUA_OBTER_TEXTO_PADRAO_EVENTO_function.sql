-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION qua_obter_texto_padrao_evento (nr_seq_evento_pac_p bigint) RETURNS varchar AS $body$
DECLARE

nr_seq_evento_w		bigint;
ie_status_w		varchar(15);
ds_evento_w		varchar(255);
nr_sequencia_w		bigint;
ds_mensagem_w		varchar(4000);
ds_status_w		varchar(255);
nr_atendimento_w		bigint;
ds_desc_evento_w		varchar(255);
nm_paciente_w		varchar(255);
ds_det_evento_w		varchar(255);
ie_classificacao_w		varchar(10);
ds_classificacao_w		varchar(255);
ds_gravidade_w		varchar(255);


BEGIN 
 
if (coalesce(nr_seq_evento_pac_p,0) > 0) then 
	select	a.nr_seq_evento, 
		a.ie_status, 
		substr(a.ds_evento,1,255), 
		a.nr_atendimento, 
		substr(Obter_Descricao_Padrao('QUA_EVENTO','DS_EVENTO',a.nr_seq_evento),1,255), 
		substr(obter_valor_dominio(3502,a.ie_status),1,255), 
		substr(OBTER_PESSOA_ATENDIMENTO(a.nr_atendimento, 'N'),1,255), 
		substr(Obter_Descricao_Padrao('QUA_EVENTO_CLASSIF','DS_CLASSIFICACAO',a.nr_seq_classif_evento),1,255) ds_det_evento, 
		a.ie_classificacao, 
		substr(Obter_Descricao_Padrao('QUA_GRAVIDADE_EVENTO','DS_GRAVIDADE',a.nr_seq_gravidade),1,255) ds_gravidade 
	into STRICT	nr_seq_evento_w, 
		ie_status_w, 
		ds_evento_w, 
		nr_atendimento_w, 
		ds_desc_evento_w, 
		ds_status_w, 
		nm_paciente_w, 
		ds_det_evento_w, 
		ie_classificacao_w, 
		ds_gravidade_w 
	from	qua_evento_paciente a 
	where	nr_sequencia = nr_seq_evento_pac_p;
	 
	select 	max(nr_sequencia) 
	into STRICT	nr_sequencia_w 
	from	qua_regra_text_pad_evento 
	where	ie_situacao	= 'A' 
	and	ie_status_evento 	= coalesce(ie_status_w,0);
	 
	if (ie_classificacao_w IS NOT NULL AND ie_classificacao_w::text <> '') then 
		select	max(ds_classificacao) 
		into STRICT	ds_classificacao_w 
		from	qua_classif_evento 
		where	ie_classificacao = ie_classificacao_w;
	end if;
	 
	if (coalesce(nr_sequencia_w,0) > 0)	then 
		select	coalesce(substr(ds_comunicado,1,2000),'') 
		into STRICT	ds_mensagem_w 
		from	qua_regra_text_pad_evento 
		where	nr_sequencia	=	nr_sequencia_w;
	end if;
	 
	ds_mensagem_w := substr(replace_macro(ds_mensagem_w,'@nr_atendimento',nr_atendimento_w),1,4000);
	ds_mensagem_w := substr(replace_macro(ds_mensagem_w,'@ds_evento',ds_evento_w),1,4000);	
	ds_mensagem_w := substr(replace_macro(ds_mensagem_w,'@ds_descricao_evento',ds_desc_evento_w),1,4000);
	ds_mensagem_w := substr(replace_macro(ds_mensagem_w,'@ds_status',ds_status_w),1,4000);
	ds_mensagem_w := substr(replace_macro(ds_mensagem_w,'@nm_paciente',nm_paciente_w),1,4000);
	ds_mensagem_w := substr(replace_macro(ds_mensagem_w,'@ds_detalhamento',ds_det_evento_w),1,4000);
	ds_mensagem_w := substr(replace_macro(ds_mensagem_w,'@ds_classificacao',ds_classificacao_w),1,4000);	
	ds_mensagem_w := substr(replace_macro(ds_mensagem_w,'@ds_gravidade',ds_gravidade_w),1,4000);
end if;
 
return	ds_mensagem_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION qua_obter_texto_padrao_evento (nr_seq_evento_pac_p bigint) FROM PUBLIC;

