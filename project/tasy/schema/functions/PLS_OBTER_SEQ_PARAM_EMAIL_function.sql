-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_seq_param_email ( ie_origem_p pls_email_parametros.ie_origem%type, cd_perfil_p pls_email.cd_perfil%type, nm_usuario_p pls_email.nm_usuario%type, cd_estabelecimento_p pls_email.cd_estabelecimento%type) RETURNS PLS_EMAIL_PARAMETROS.NR_SEQUENCIA%TYPE AS $body$
DECLARE

nr_seq_parametros_w	pls_email_parametros.nr_sequencia%type	:= null;

C01 CURSOR FOR
	SELECT	a.nr_sequencia
	FROM pls_email_parametros a
LEFT OUTER JOIN pls_email_parametros_lib b ON (a.nr_sequencia = b.nr_seq_regra)
WHERE a.ie_situacao = 'A' and a.ie_origem = ie_origem_p and a.cd_estabelecimento = cd_estabelecimento_p and (b.nm_usuario_liberacao = nm_usuario_p or coalesce(b.nm_usuario_liberacao::text, '') = '') and (b.cd_perfil_liberacao  = cd_perfil_p or coalesce(b.cd_perfil_liberacao::text, '') = '') order by coalesce(b.nm_usuario_liberacao, ' '), coalesce(b.cd_perfil_liberacao,0);
BEGIN
for c01_w in C01 loop
	begin
	nr_seq_parametros_w	:= c01_w.nr_sequencia;
	end;
end loop;

return	nr_seq_parametros_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_seq_param_email ( ie_origem_p pls_email_parametros.ie_origem%type, cd_perfil_p pls_email.cd_perfil%type, nm_usuario_p pls_email.nm_usuario%type, cd_estabelecimento_p pls_email.cd_estabelecimento%type) FROM PUBLIC;

