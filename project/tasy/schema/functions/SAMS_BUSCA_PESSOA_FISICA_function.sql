-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION sams_busca_pessoa_fisica ( CD_SISTEMA_ANT_P text , NR_CPF_P text , NR_CARTAO_NAC_SUS_P text , NM_PESSOA_FISICA_P text , DT_NASCIMENTO_P timestamp ) RETURNS varchar AS $body$
DECLARE

  CD_PESSOA_FISICA_W varchar(10) := NULL;

BEGIN
  IF (CD_SISTEMA_ANT_P IS NOT NULL AND CD_SISTEMA_ANT_P::text <> '') THEN
    SELECT
      MAX(CD_PESSOA_FISICA) INTO STRICT CD_PESSOA_FISICA_W
    FROM PESSOA_FISICA
    WHERE
      CD_SISTEMA_ANT = CD_SISTEMA_ANT_P  LIMIT 1;
  END IF;

  IF ((NR_CPF_P IS NOT NULL AND NR_CPF_P::text <> '') AND coalesce(CD_PESSOA_FISICA_W::text, '') = '') THEN
    SELECT
      MAX(CD_PESSOA_FISICA) INTO STRICT CD_PESSOA_FISICA_W
    FROM PESSOA_FISICA
    WHERE
      NR_CPF = NR_CPF_P  LIMIT 1;
  END IF;

  IF ((NR_CARTAO_NAC_SUS_P IS NOT NULL AND NR_CARTAO_NAC_SUS_P::text <> '') AND coalesce(CD_PESSOA_FISICA_W::text, '') = '') THEN
    SELECT
      MAX(CD_PESSOA_FISICA) INTO STRICT CD_PESSOA_FISICA_W
    FROM PESSOA_FISICA
    WHERE
      NR_CARTAO_NAC_SUS = NR_CARTAO_NAC_SUS_P  LIMIT 1;
  END IF;

  IF ((NM_PESSOA_FISICA_P IS NOT NULL AND NM_PESSOA_FISICA_P::text <> '') AND (DT_NASCIMENTO_P IS NOT NULL AND DT_NASCIMENTO_P::text <> '') AND coalesce(CD_PESSOA_FISICA_W::text, '') = '') THEN
    SELECT
      MAX(CD_PESSOA_FISICA) INTO STRICT CD_PESSOA_FISICA_W
    FROM PESSOA_FISICA
    WHERE
      NM_PESSOA_FISICA = NM_PESSOA_FISICA_P
      AND DT_NASCIMENTO = DT_NASCIMENTO_P  LIMIT 1;
  END IF;

  RETURN CD_PESSOA_FISICA_W;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION sams_busca_pessoa_fisica ( CD_SISTEMA_ANT_P text , NR_CPF_P text , NR_CARTAO_NAC_SUS_P text , NM_PESSOA_FISICA_P text , DT_NASCIMENTO_P timestamp ) FROM PUBLIC;

