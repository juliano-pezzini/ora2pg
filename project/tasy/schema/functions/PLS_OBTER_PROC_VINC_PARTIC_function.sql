-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_proc_vinc_partic ( nr_seq_partic_proc_p bigint, nr_seq_item_ref_p bigint ) RETURNS varchar AS $body$
DECLARE

 
 
nr_seq_conta_proc_w		bigint;
ds_retorno_w			varchar(500);
ds_item_despesa_w		varchar(255);
cd_item_w				numeric(22);
nr_identificador_w		varchar(22);
cd_procedimento_w		varchar(10);
ie_origem_proced_w		bigint;


BEGIN 
 
if (coalesce(nr_seq_partic_proc_p,0) > 0) then 
	begin 
	select	b.nr_sequencia, 
			cd_procedimento, 
			ie_origem_proced 
	into STRICT	nr_seq_conta_proc_w, 
			cd_procedimento_w, 
			ie_origem_proced_w 
	from 	pls_proc_participante a, 
			pls_conta_proc	b 
	where	a.nr_seq_conta_proc 	= b.nr_sequencia 
	and		a.nr_sequencia 		= nr_seq_partic_proc_p;
	exception 
	when others then 
			ds_retorno_w := '';
	end;
elsif (coalesce(nr_seq_item_ref_p,0) > 0) then 
		nr_seq_conta_proc_w := nr_seq_item_ref_p;
end if;
 
begin 
select	ds_item_despesa, 
		'Id: '||nr_identificador||' ' 
into STRICT	ds_item_despesa_w, 
		nr_identificador_w 
from 	pls_resumo_conta_v 
where	nr_seq_item = nr_seq_conta_proc_w 
and		ie_tipo_item in ('P', 'I');
exception 
when others then 
		select	max(substr(obter_descricao_procedimento(cd_procedimento,ie_origem_proced),1,255)) 
		into STRICT	ds_item_despesa_w 
		from	pls_conta_proc 
		where	nr_sequencia = nr_seq_conta_proc_w;
end;
 
if (coalesce(nr_seq_item_ref_p,0) > 0) then 
	nr_identificador_w := null;
end if;
 
/*descricao do procedimento do qual o participante esta vinculado*/
 
ds_retorno_w	:= 	substr(nr_identificador_w||replace(ds_item_despesa_w,'     ','') , 1,255)||chr(13)||chr(10);
 
return ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_proc_vinc_partic ( nr_seq_partic_proc_p bigint, nr_seq_item_ref_p bigint ) FROM PUBLIC;

