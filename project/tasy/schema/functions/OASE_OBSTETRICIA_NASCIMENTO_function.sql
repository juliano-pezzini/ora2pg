-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION oase_obstetricia_nascimento (ie_opcao_p text, dt_nascto_p timestamp) RETURNS bigint AS $body$
DECLARE

quantidade_w bigint := 0;


BEGIN 
	if (ie_opcao_p = 'A') then 
		  select count(a.dt_nascimento) qt_cesareo_convenio 
		  into STRICT	 quantidade_w 
	    from	 nascimento a, 
				 atendimento_paciente b, 
	       pessoa_fisica c, 
	       parto e 
	    where a.nr_atendimento  = b.nr_atendimento 
	    and  b.cd_pessoa_fisica = c.cd_pessoa_fisica 
	    and  b.nr_atendimento  = e.nr_atendimento 
		  and	 a.dt_nascimento 	= dt_nascto_p		  
		  and	 e.IE_PARTO_CESARIA = 'S' 
	    and  obter_tipo_convenio(obter_convenio_atendimento(a.nr_atendimento)) = 2;
	elsif (ie_opcao_p = 'B') then 
		  select count(a.dt_nascimento) qt_cesareo_particular 
		  into STRICT	 quantidade_w 
	    from  nascimento a, 
	    	    atendimento_paciente b, 
	    	    pessoa_fisica c, 
	    	    parto e 
	    where a.nr_atendimento  = b.nr_atendimento 
	    and  b.cd_pessoa_fisica = c.cd_pessoa_fisica 
	    and  b.nr_atendimento  = e.nr_atendimento 
		  and	 a.dt_nascimento = dt_nascto_p 
		  and		e.IE_PARTO_CESARIA = 'S' 
	    and  obter_tipo_convenio(obter_convenio_atendimento(a.nr_atendimento)) = 1;
	elsif (ie_opcao_p = 'C') then 
			select count(a.dt_nascimento) qt_cesareo_sus 
			into STRICT	 quantidade_w 
	    from  nascimento a, 
	    	    atendimento_paciente b, 
	    	    pessoa_fisica c, 
	    	    parto e 
	    where a.nr_atendimento  = b.nr_atendimento 
	    and  b.cd_pessoa_fisica = c.cd_pessoa_fisica 
	    and  b.nr_atendimento  = e.nr_atendimento 
		  and	 a.dt_nascimento = dt_nascto_p 
		  and		e.IE_PARTO_CESARIA = 'S' 
		  and  obter_tipo_convenio(obter_convenio_atendimento(a.nr_atendimento)) = 3;
	elsif (ie_opcao_p = 'D') then 
			select count(a.dt_nascimento) qt_normal_convenio 
			into STRICT	 quantidade_w 
	    from  nascimento a, 
	    	    atendimento_paciente b, 
	    	    pessoa_fisica c, 
	    	    parto e 
	    where a.nr_atendimento  = b.nr_atendimento 
	    and  b.cd_pessoa_fisica = c.cd_pessoa_fisica 
	    and  b.nr_atendimento  = e.nr_atendimento 
		  and	 a.dt_nascimento = dt_nascto_p 
		  and		e.IE_PARTO_normal = 'S' 
			and  obter_tipo_convenio(obter_convenio_atendimento(a.nr_atendimento)) = 2;
	elsif (ie_opcao_p = 'E') then 
			select count(a.dt_nascimento) qt_normal_particular 
			into STRICT	 quantidade_w 
	    from  nascimento a, 
	    	    atendimento_paciente b, 
	    	    pessoa_fisica c, 
	    	    parto e 
	    where a.nr_atendimento  = b.nr_atendimento 
	    and  b.cd_pessoa_fisica = c.cd_pessoa_fisica 
	    and  b.nr_atendimento  = e.nr_atendimento 
		  and	 a.dt_nascimento = dt_nascto_p 
		  and		e.IE_PARTO_normal = 'S' 
			and  obter_tipo_convenio(obter_convenio_atendimento(a.nr_atendimento)) = 1;
	elsif (ie_opcao_p = 'F') then 
			select count(a.dt_nascimento) qt_normal_sus 
			into STRICT	 quantidade_w 
	    from  nascimento a, 
	    	    atendimento_paciente b, 
	    	    pessoa_fisica c, 
	    	    parto e 
	    where a.nr_atendimento  = b.nr_atendimento 
	    and  b.cd_pessoa_fisica = c.cd_pessoa_fisica 
	    and  b.nr_atendimento  = e.nr_atendimento 
		  and	 a.dt_nascimento = dt_nascto_p 
		  and		e.IE_PARTO_normal = 'S' 
			and  obter_tipo_convenio(obter_convenio_atendimento(a.nr_atendimento)) = 3;
	elsif (ie_opcao_p = 'G') then 
			select count(a.dt_nascimento) qt_nasc_fem 
			into STRICT	 quantidade_w 
	    from  nascimento a, 
	    	    atendimento_paciente b, 
	    	    pessoa_fisica c, 
	    	    parto e 
	    where a.nr_atendimento  = b.nr_atendimento 
	    and  b.cd_pessoa_fisica = c.cd_pessoa_fisica 
	    and  b.nr_atendimento  = e.nr_atendimento 
		  and	 a.dt_nascimento = dt_nascto_p 
			and  a.ie_sexo = 'F';
	elsif (ie_opcao_p = 'H') then 
			select count(a.dt_nascimento) qt_nasc_masc 
			into STRICT	 quantidade_w 
	    from  nascimento a, 
	    	    atendimento_paciente b, 
	    	    pessoa_fisica c, 
	    	    parto e 
	    where a.nr_atendimento  = b.nr_atendimento 
	    and  b.cd_pessoa_fisica = c.cd_pessoa_fisica 
	    and  b.nr_atendimento  = e.nr_atendimento 
		  and	 a.dt_nascimento = dt_nascto_p 
			and  a.ie_sexo = 'M';
	elsif (ie_opcao_p = 'I') then 
			select count(a.dt_nascimento) qt_nascimento 
			into STRICT	 quantidade_w 
		  from  nascimento a, 
	    	  	  atendimento_paciente b, 
	    	  	  pessoa_fisica c, 
	    	  	  parto e 
		  where a.nr_atendimento  = b.nr_atendimento 
		  and  b.cd_pessoa_fisica = c.cd_pessoa_fisica 
		  and  b.nr_atendimento  = e.nr_atendimento 
			and	 a.dt_nascimento = dt_nascto_p;
	end if;
	 
return	quantidade_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION oase_obstetricia_nascimento (ie_opcao_p text, dt_nascto_p timestamp) FROM PUBLIC;

