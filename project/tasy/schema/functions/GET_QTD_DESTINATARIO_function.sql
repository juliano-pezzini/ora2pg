-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_qtd_destinatario (NR_SEQUENCIA_P bigint) RETURNS varchar AS $body$
DECLARE

  retorno_w      bigint := 0;
  destComMedID_w bigint := 0;
  destMarcado_w  bigint := 0;
  cdMedicoResp_w varchar(20);


BEGIN

    SELECT MAX(CD_MEDICO_RESPONSAVEL)
    INTO STRICT cdMedicoResp_w
    FROM CARTA_MEDICA
    WHERE NR_SEQUENCIA = NR_SEQUENCIA_P;

    SELECT COUNT(1)
    INTO STRICT destComMedID_w
    FROM MEDICO_ESPECIALIDADE
    WHERE (IE_MEDICALNET_ID IS NOT NULL AND IE_MEDICALNET_ID::text <> '')
    AND CD_PESSOA_FISICA = cdMedicoResp_w;

    SELECT COUNT(1)
    INTO STRICT destMarcado_w
    FROM DESTINATARIO_CARTA_MEDICA
    WHERE NR_SEQ_CARTA_MAE = NR_SEQUENCIA_P
    AND IE_ENVIA_MEDICALNET = 'S';

    retorno_w := destComMedID_w + destMarcado_w;

    RETURN retorno_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_qtd_destinatario (NR_SEQUENCIA_P bigint) FROM PUBLIC;

