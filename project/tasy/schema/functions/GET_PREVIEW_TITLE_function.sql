-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_preview_title (NR_SEQ_PROTOCOLO_INT_PAC_P bigint) RETURNS varchar AS $body$
DECLARE


    c1 CURSOR FOR
        SELECT ds_tratamento,
               a.ie_tipo_atendimento,
               obter_descricao_dominio(12, a.ie_tipo_atendimento) ds_tipo_atendimento,
               obter_descricao_dominio(9892, b.ie_status) ie_status
          FROM ATENDIMENTO_PACIENTE a
             , PROTOCOLO_INT_PACIENTE b
         WHERE a.NR_ATENDIMENTO = b.NR_ATENDIMENTO_ORIGEM
           AND b.NR_SEQUENCIA = NR_SEQ_PROTOCOLO_INT_PAC_P;

    title_w varchar(200) := '';
    c1_w c1%rowtype;


BEGIN

    OPEN c1;
    FETCH c1 INTO c1_w;
    CLOSE c1;

    title_w := c1_w.ds_tratamento;
    title_w := title_w || ' - ';
    IF c1_w.ie_tipo_atendimento IN (1, 8)THEN
        title_w := title_w || c1_w.ds_tipo_atendimento;
        title_w := title_w || ' - ';
    END IF;
    title_w := title_w || c1_w.ie_status;

    RETURN title_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_preview_title (NR_SEQ_PROTOCOLO_INT_PAC_P bigint) FROM PUBLIC;

