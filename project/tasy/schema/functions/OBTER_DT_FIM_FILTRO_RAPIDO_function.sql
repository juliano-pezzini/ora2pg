-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dt_fim_filtro_rapido ( vl_dominio_p text ) RETURNS timestamp AS $body$
DECLARE

/* ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:  Obter data fim para filtro rápido conforme o domínio 8181
---------------------------------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[X]  Objetos do dicionário [ ] Tasy (Delphi/Java) [ ] Portal [ ]  Relatórios [ ] Outros:
 --------------------------------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
dt_retorno_w timestamp := clock_timestamp();
nr_aux_w integer;


BEGIN
  if (vl_dominio_p = 'T') then
     dt_retorno_w :=  fim_dia(clock_timestamp());
  end if;

  if (vl_dominio_p = 'NW') then
     dt_retorno_w :=  fim_dia(clock_timestamp()) + 7;

     nr_aux_w := pkg_date_utils.get_weekday(dt_retorno_w);

     if nr_aux_w < 6 then
        nr_aux_w := 6 - nr_aux_w;
        dt_retorno_w := dt_retorno_w + nr_aux_w;
     else
        nr_aux_w := nr_aux_w - 6;
        dt_retorno_w := dt_retorno_w - nr_aux_w;
     end if;

  end if;

  if (vl_dominio_p = 'N2W') then
     dt_retorno_w :=  fim_dia(clock_timestamp()) + 14;
     nr_aux_w := pkg_date_utils.get_weekday(dt_retorno_w);

     if nr_aux_w < 6 then
        nr_aux_w := 6 - nr_aux_w;
        dt_retorno_w := dt_retorno_w + nr_aux_w;
     else
        nr_aux_w := nr_aux_w - 6;
        dt_retorno_w := dt_retorno_w - nr_aux_w;
     end if;
  end if;


  if (vl_dominio_p = 'Q') then

     nr_aux_w := to_char(clock_timestamp(),'mm');

     if nr_aux_w in (1,2,3) then
        dt_retorno_w := fim_dia(to_date('30/06'||to_char(clock_timestamp(),'yyyy')));
     end if;

     if nr_aux_w in (4,5,6) then
        dt_retorno_w := fim_dia(to_date('30/09'||to_char(clock_timestamp(),'yyyy')));
     end if;

     if nr_aux_w in (7,8,9) then
        dt_retorno_w := fim_dia(to_date('31/12'||to_char(clock_timestamp(),'yyyy')));
     end if;

     if nr_aux_w in (10,11,12) then
        dt_retorno_w := fim_dia(to_date('31/03'||(to_char(clock_timestamp(),'yyyy')+1)));
     end if;

  end if;

  return  dt_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dt_fim_filtro_rapido ( vl_dominio_p text ) FROM PUBLIC;

