-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION desc_treenode_by_obj (nr_seq_obj_p bigint) RETURNS varchar AS $body$
DECLARE


cd_desc_tvn_w bigint;
superior_seq_w bigint;
tipo_obj_w varchar(30);
cd_funca_w bigint;
nm_tabela_w varchar(30);
ie_novo_parametro_w varchar(1);


BEGIN
	ie_novo_parametro_w := obter_param_usuario(872, 552, obter_perfil_ativo, wheb_usuario_pck.get_nm_usuario, wheb_usuario_pck.get_cd_estabelecimento, ie_novo_parametro_w);

    select os.ie_tipo_objeto, os.cd_exp_desc_obj, os.nr_seq_obj_sup, os.cd_funcao, nm_tabela
      into STRICT tipo_obj_w, cd_desc_tvn_w, superior_seq_w, cd_funca_w, nm_tabela_w
      from objeto_schematic os
    where os.nr_sequencia = nr_seq_obj_p;

    if (coalesce(superior_seq_w::text, '') = '') then
        return null;
    else
		if (nr_seq_obj_p in (40807, 39411, 40545, 40549, 40557, 40561, 40565, 40569, 40573, 40578,40582, 40586, 40590, 40594, 40598, 
                            40602, 40606, 700889, 40614, 40618, 40622, 40626, 988889, 1084124, 1084125, 1104261, 1104986, 1108210) and tipo_obj_w in ('T')) then
			return cd_desc_tvn_w;
		
        elsif (tipo_obj_w in ('TVN') or (nr_seq_obj_p = 250334 and superior_seq_w = 247298)) then
            return cd_desc_tvn_w;
        else
			if ((ie_novo_parametro_w IS NOT NULL AND ie_novo_parametro_w::text <> '') and cd_funca_w = 872 and nm_tabela_w = 'CIRURGIA') then
				return '1001067';
			else
				return desc_treenode_by_obj(superior_seq_w);
			end if;
        end if;
    end if;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION desc_treenode_by_obj (nr_seq_obj_p bigint) FROM PUBLIC;

