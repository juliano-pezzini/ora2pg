-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_ds_schedule_event_status (cd_confirmation_text_p bigint, ie_evento_p text, ie_agenda_p text, ie_tipo_agenda_p bigint, nr_seq_agenda_p bigint ) RETURNS varchar AS $body$
DECLARE


ds_confirmation_text	varchar(255) := 'N';
nr_seq_reg_w		status_evento_agenda.nr_sequencia%type;
ds_domain_status_w	varchar(30);
nm_patient_w		varchar(60);
cd_estabelecimento_w	usuario.cd_estabelecimento%type;


BEGIN

cd_estabelecimento_w := wheb_usuario_pck.get_cd_estabelecimento;

select	max(nr_sequencia),
	max(obter_valor_dominio(83,ie_status))
into STRICT	nr_seq_reg_w,
	ds_domain_status_w
from	status_evento_agenda
where	cd_estabelecimento = cd_estabelecimento_w
and	ie_evento = ie_evento_p
and	((ie_agenda = ie_agenda_p) or (ie_agenda = 'T'))
order 	by	coalesce(cd_agenda,0),
			coalesce(cd_perfil,0),
			coalesce(ie_evolucao_clinica,'0'),
			coalesce(ie_classif_agenda,'*'),
			coalesce(cd_convenio,0),
			coalesce(nr_seq_tipo_atend,0),
			ie_status;

if (nr_seq_reg_w > 0) then
	nm_patient_w := substr(obter_dados_agendas(ie_tipo_agenda_p, nr_seq_agenda_p, 'NP'),1,60);
	ds_confirmation_text := substr(obter_texto_dic_objeto(cd_confirmation_text_p,wheb_usuario_pck.get_nr_seq_idioma,'PATIENT='||nm_patient_w||';STATUS='||ds_domain_status_w),1,255);
end if;

return ds_confirmation_text;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_ds_schedule_event_status (cd_confirmation_text_p bigint, ie_evento_p text, ie_agenda_p text, ie_tipo_agenda_p bigint, nr_seq_agenda_p bigint ) FROM PUBLIC;

