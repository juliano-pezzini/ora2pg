-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_intervalo_correto ( ds_horarios_p text, cd_intervalo_p text) RETURNS varchar AS $body$
DECLARE


ds_horarios_w		varchar(2000);
hr_horario_atual_w	timestamp;
hr_horario_anterior_w	timestamp;
i			bigint;
qt_min_intervalo_w	bigint;
ie_intervalo_correto_w	varchar(1) := 'S';


BEGIN

if	(ds_horarios_p IS NOT NULL AND ds_horarios_p::text <> '' AND cd_intervalo_p IS NOT NULL AND cd_intervalo_p::text <> '') then

	qt_min_intervalo_w	:= coalesce(obter_ocorrencia_intervalo(cd_intervalo_p,null,1),0) * 60;

	if (ds_horarios_p IS NOT NULL AND ds_horarios_p::text <> '') and (obter_ocorrencias_horarios_rep(ds_horarios_p) > 1) and (qt_min_intervalo_w > 0) then
		ds_horarios_w := replace(padroniza_horario(ds_horarios_p),'A','') || ' ';
	end if;

	while(ds_horarios_w IS NOT NULL AND ds_horarios_w::text <> '') loop
		begin
		select	position(' ' in ds_horarios_w)
		into STRICT 	i
		;

		if (i > 1) then
			hr_horario_atual_w	:= to_date('01/01/2001 ' || substr(ds_horarios_w,1,i-1) || ':00','dd/mm/yyyy hh24:mi:ss');
		end if;

		if (hr_horario_atual_w < hr_horario_anterior_w) then
			hr_horario_atual_w	:= hr_horario_atual_w + 1;
		end if;


		if (hr_horario_anterior_w IS NOT NULL AND hr_horario_anterior_w::text <> '') and (hr_horario_atual_w IS NOT NULL AND hr_horario_atual_w::text <> '') and
			(trunc((hr_horario_atual_w - hr_horario_anterior_w) * 1440) <> qt_min_intervalo_w)  then
			ie_intervalo_correto_w	:= 'N';
			exit;
		end if;

		hr_horario_anterior_w	:= hr_horario_atual_w;

		ds_horarios_w	:= substr(ds_horarios_w,i+1,length(ds_horarios_w));

		end;
	end loop;
end if;

return	ie_intervalo_correto_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_intervalo_correto ( ds_horarios_p text, cd_intervalo_p text) FROM PUBLIC;

