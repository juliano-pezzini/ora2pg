-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION eis_obter_atend_periodo (cd_proc_principal_p bigint, ie_origem_proced_p bigint, dt_inicial_p timestamp, dt_final_p timestamp, ie_tipo_atendimento_p bigint) RETURNS bigint AS $body$
DECLARE

 
qt_atend_w		bigint;
qt_materiais_w		bigint;
qt_proced_w		bigint;


BEGIN 
 
/* 
select	count(distinct b.nr_interno_conta) 
into	qt_atend_w 
from	conta_paciente b, 
	eis_conta_paciente a 
where	a.nr_interno_conta	= b.nr_interno_conta 
and	a.cd_procedimento	= cd_proc_principal_p 
and	a.ie_origem_proced	= ie_origem_proced_p 
and	a.ie_tipo_atendimento=ie_tipo_atendimento_p 
and	a.dt_referencia		between dt_inicial_p and dt_final_p; 
*/
 
 
select	count(*) 
into STRICT	qt_materiais_w 
from	conta_paciente b, 
	material_atend_paciente c, 
	eis_conta_paciente a 
where	a.nr_interno_conta	= b.nr_interno_conta 
and	a.cd_procedimento	= cd_proc_principal_p 
and	a.ie_origem_proced	= ie_origem_proced_p 
and	a.ie_tipo_atendimento=ie_tipo_atendimento_p 
and	b.nr_interno_conta	= c.nr_interno_conta 
and	a.dt_referencia		between dt_inicial_p and dt_final_p;
 
 
select	count(*) 
into STRICT	qt_proced_w 
from	conta_paciente b, 
	procedimento_paciente c, 
	eis_conta_paciente a 
where	a.nr_interno_conta	= b.nr_interno_conta 
and	a.cd_procedimento	= cd_proc_principal_p 
and	a.ie_origem_proced	= ie_origem_proced_p 
and	a.ie_tipo_atendimento=ie_tipo_atendimento_p 
and	b.nr_interno_conta	= c.nr_interno_conta 
and	a.dt_referencia		between dt_inicial_p and dt_final_p;
 
 
qt_atend_w	:= qt_materiais_w + qt_proced_w;
 
return qt_atend_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION eis_obter_atend_periodo (cd_proc_principal_p bigint, ie_origem_proced_p bigint, dt_inicial_p timestamp, dt_final_p timestamp, ie_tipo_atendimento_p bigint) FROM PUBLIC;

