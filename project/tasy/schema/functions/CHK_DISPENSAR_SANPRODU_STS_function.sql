-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION chk_dispensar_sanprodu_sts ( nr_seq_transfusao_p bigint) RETURNS varchar AS $body$
DECLARE

  qt_dt_dispatch bigint;
  qt_blood_prod  bigint;
  ie_retorno_w   varchar(1);

BEGIN
ie_retorno_w   := 'S';
qt_blood_prod :=0;
  qt_dt_dispatch := 0;
	begin

	SELECT COUNT(*)
	  INTO STRICT qt_blood_prod
	  FROM san_producao_v a
	  INNER JOIN SAN_TRANSFUSAO tr
	  ON tr.NR_SEQUENCIA        = a.nr_seq_transfusao
	  WHERE a.nr_seq_transfusao = nr_seq_transfusao_p;

	  SELECT COUNT(*)
	  INTO STRICT qt_dt_dispatch
	  FROM san_producao_v a
	  INNER JOIN SAN_TRANSFUSAO tr
	  ON tr.NR_SEQUENCIA        = a.nr_seq_transfusao
	  WHERE a.nr_seq_transfusao = nr_seq_transfusao_p
	  AND coalesce(DT_DISPENSACAO::text, '') = '';
	
	end;
 IF (qt_dt_dispatch > 0 or qt_blood_prod=0) THEN
		ie_retorno_w := 'N';
	 END IF;
return ie_retorno_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION chk_dispensar_sanprodu_sts ( nr_seq_transfusao_p bigint) FROM PUBLIC;

