-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION hdm_pessoa_ja_cadastrada ( cd_pessoa_fisica_p text, ie_tipo_cadastro_p text, nr_sequencia_p bigint) RETURNS varchar AS $body$
DECLARE

/*
ie_tipo_cadastro_p =
I - chamado da aba Indicações
D - chamado da aba Demanda Espontânea
B - chamado da aba Busca empresarial
T - atende Todas as abas
*/
ie_aba_pessoa_ja_cadastrada_w	varchar(255);

BEGIN

if (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') then

	select	CASE WHEN count(*)=0 THEN  null  ELSE substr(obter_desc_expressao(291846), 1, 255) END
	into STRICT	ie_aba_pessoa_ja_cadastrada_w
	from	mprev_indicacao_paciente
	where	cd_pessoa_fisica = cd_pessoa_fisica_p
	and (nr_sequencia <> coalesce(nr_sequencia_p, 0) or
		ie_tipo_cadastro_p <> 'I');

	if (coalesce(ie_aba_pessoa_ja_cadastrada_w::text, '') = '') then

		select	CASE WHEN count(*)=0 THEN  null  ELSE substr(obter_desc_expressao(596869), 1, 255) END
		into STRICT	ie_aba_pessoa_ja_cadastrada_w
		from	mprev_demanda_espont
		where	cd_pessoa_fisica = cd_pessoa_fisica_p
		and (nr_sequencia <> coalesce(nr_sequencia_p, 0) or
			ie_tipo_cadastro_p <> 'D');

	end if;

	if (coalesce(ie_aba_pessoa_ja_cadastrada_w::text, '') = '') then

		select	CASE WHEN count(*)=0 THEN  null  ELSE substr(obter_desc_expressao(657316), 1, 255) END
		into STRICT	ie_aba_pessoa_ja_cadastrada_w
		from	mprev_busca_empresarial
		where	cd_pessoa_fisica = cd_pessoa_fisica_p
		and (nr_sequencia <> coalesce(nr_sequencia_p, 0) or
			ie_tipo_cadastro_p <> 'B');

	end if;

end if;

return	ie_aba_pessoa_ja_cadastrada_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION hdm_pessoa_ja_cadastrada ( cd_pessoa_fisica_p text, ie_tipo_cadastro_p text, nr_sequencia_p bigint) FROM PUBLIC;

