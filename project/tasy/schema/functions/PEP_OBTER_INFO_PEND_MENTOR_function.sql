-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pep_obter_info_pend_mentor (nr_seq_pend_p bigint, ie_informacao_p char) RETURNS varchar AS $body$
DECLARE


ie_regra_da_acao_w                char(1) := 'R';
ie_regra_w                                char(1) := 'K';  -- Regra a partir da ação
ie_acao_w                                 char(1) := 'A';
ie_acao_exige_justificar_w       char(1) := 'J';
ie_nr_seq_acao_pend_w          char(1) := 'N';
ie_decisao_criterio_medico_w   char(1) := 'D';
ie_seq_acao_w                         char(1) := 'Q';
ie_superior_w                           char(1) := 'S';

ds_result_w   varchar(255);
nr_seq_acao_w bigint;


BEGIN

    case ie_informacao_p

        when ie_regra_w then
            
            select   substr(d.ds_regra, 1,255)
            into STRICT     ds_result_w            
            from     gqa_pendencia_regra d
            where    d.nr_sequencia     = nr_seq_pend_p;

        when ie_regra_da_acao_w then
        
            select   substr(d.ds_regra, 1,255)
            into STRICT     ds_result_w
            from     gqa_pendencia_pac a,
                     gqa_pend_pac_acao b,
                     gqa_pendencia_regra d
            where    a.nr_sequencia     = b.nr_seq_pend_pac
            and      d.nr_sequencia     = a.nr_seq_pend_regra
            and      b.nr_sequencia     = nr_seq_pend_p;

        when ie_acao_w then 
            
            select substr(ds_acao, 1, 255)
            into STRICT   ds_result_w
            from   gqa_pend_pac_acao 
            where  nr_sequencia = nr_seq_pend_p;
			
		when ie_seq_acao_w then
		
			select coalesce(max(nr_seq_regra_acao),0)
            into STRICT   ds_result_w
            from   gqa_pend_pac_acao
            where  nr_sequencia = nr_seq_pend_p;

        when ie_acao_exige_justificar_w then 
		
			select coalesce(max(nr_seq_regra_acao),0)
            into STRICT   nr_seq_acao_w
            from   gqa_pend_pac_acao 
            where  nr_sequencia = nr_seq_pend_p;

            select   substr(coalesce(max(ie_justificar), 'N'), 1, 255)
            into STRICT     ds_result_w
            from     gqa_pendencia_pac      a,
                     gqa_pend_pac_acao      b,
                     gqa_pendencia_regra    d,
                     gqa_acao               e
            where    a.nr_sequencia         = b.nr_seq_pend_pac
            and      d.nr_sequencia         = a.nr_seq_pend_regra
            and      e.nr_seq_pend_regra    = d.nr_sequencia
            and      b.nr_sequencia         = nr_seq_pend_p
			and      e.nr_sequencia	=	nr_seq_acao_w;

	when ie_nr_seq_acao_pend_w then
                   
            select   substr(coalesce(max(nr_seq_pend_pac), '0'), 1, 255)
            into STRICT     ds_result_w            
	        from     gqa_pend_pac_acao
	        where    nr_sequencia = nr_seq_pend_p;

    when ie_decisao_criterio_medico_w then
            
            select   substr(coalesce(max(ie_acoes_opcionais), 'N'), 1, 255)
            into STRICT     ds_result_w
            from     gqa_pendencia_pac      a,
                     gqa_pend_pac_acao      b,
                     gqa_pendencia_regra    d,
                     gqa_acao               e
            where    a.nr_sequencia         = b.nr_seq_pend_pac
            and      d.nr_sequencia         = a.nr_seq_pend_regra
            and      e.nr_seq_pend_regra    = d.nr_sequencia
            and      b.nr_sequencia         = nr_seq_pend_p;
			
	when ie_superior_w then
	
		select   coalesce(max(coalesce(nr_seq_superior, nr_seq_superior_saps)),0)
		into STRICT      ds_result_w
		from    gqa_pend_pac_acao
		where nr_sequencia = nr_seq_pend_p;

    end case;


    return ds_result_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pep_obter_info_pend_mentor (nr_seq_pend_p bigint, ie_informacao_p char) FROM PUBLIC;

