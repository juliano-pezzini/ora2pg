-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION ageint_valida_regra_inco (cd_inconsistencia_p text) RETURNS varchar AS $body$
DECLARE


ds_retorno_w varchar(1) := 'N';
nm_usuario_ativo_w	usuario.nm_usuario%type;
cd_perfil_ativo_w	perfil.cd_perfil%type;
nr_seq_regra_w		ageint_regra_inco_smart.nr_sequencia%type;
ie_regra_w			ageint_regra_inco_smart.ie_regra%type;

C01 CURSOR FOR
SELECT	a.nr_sequencia,
		a.ie_regra
from	ageint_regra_inco_smart a
where 	coalesce(a.nm_usuario_regra, nm_usuario_ativo_w) = nm_usuario_ativo_w
and		coalesce(a.cd_perfil, cd_perfil_ativo_w) = cd_perfil_ativo_w
and		coalesce(a.ie_situacao, 'A') = 'A'
order by a.cd_perfil, a.nm_usuario_regra;

BEGIN
cd_perfil_ativo_w	:= obter_perfil_ativo;
nm_usuario_ativo_w	:= wheb_usuario_pck.get_nm_usuario;
	
	for regra_inco in c01 loop
		nr_seq_regra_w 	:= regra_inco.nr_sequencia;
		ie_regra_w		:= regra_inco.ie_regra;
	end loop;
	
	if (nr_seq_regra_w > 0) then
		if (ie_regra_w	= 'N') then
			SELECT 	coalesce(max('S'), 'N')
			INTO STRICT 	ds_retorno_w
			FROM  	ageint_inco_regra b
			WHERE 	b.nr_seq_regra = nr_seq_regra_w
			AND 	b.cd_inconsistencia = cd_inconsistencia_p;
		else
			SELECT 	coalesce(max('N'), 'S')
			INTO STRICT 	ds_retorno_w
			FROM  	ageint_inco_regra b
			WHERE 	b.nr_seq_regra = nr_seq_regra_w
			AND 	b.cd_inconsistencia = cd_inconsistencia_p;
		end if;
	end if;
RETURN ds_retorno_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION ageint_valida_regra_inco (cd_inconsistencia_p text) FROM PUBLIC;

