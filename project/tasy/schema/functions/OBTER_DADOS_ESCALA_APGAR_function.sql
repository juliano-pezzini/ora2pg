-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_escala_apgar ( ie_dado_p text, nr_atendimento_p bigint, nr_recem_nascido_p bigint, ie_minuto_p bigint) RETURNS bigint AS $body$
DECLARE


/*
 * ie_dado_p
 * 'FQ' - Frequencia cardiaca
 * 'CO' - Cor da pele
 * 'TM' - Tonus muscular
 * 'IR' - Irritabilidade reflexa
 * 'ES' - Esforco
 * 'TT' - Total
 */
qt_dado_FQ_w bigint;
qt_dado_CO_w bigint;
qt_dado_TM_w bigint;
qt_dado_IR_w bigint;
qt_dado_ES_w bigint;
qt_dado_TT_w bigint;
qt_dado_retorno_w bigint;


BEGIN

select a.qt_freq_cardiaca, a.qt_cor, a.qt_tonus_muscular,
a.qt_irritabilidade_reflexa, a.qt_esforco, a.qt_pontuacao
into STRICT qt_dado_FQ_w,
     qt_dado_CO_w,
     qt_dado_TM_w,
     qt_dado_IR_w,
     qt_dado_ES_w,
     qt_dado_TT_w
from escala_apgar a
where a.nr_atendimento = nr_atendimento_p 
and a.nr_recem_nascido = nr_recem_nascido_p       
and a.ie_minuto = ie_minuto_p
and a.nr_sequencia = 
(SELECT max(b.nr_sequencia) 
from escala_apgar b
where b.nr_atendimento = a.nr_atendimento
and b.nr_recem_nascido = a.nr_recem_nascido 
and b.ie_minuto = a.ie_minuto);

if (ie_dado_p = 'FQ') then
  qt_dado_retorno_w := qt_dado_FQ_w;
elsif (ie_dado_p = 'CO') then
  qt_dado_retorno_w := qt_dado_CO_w;
elsif (ie_dado_p = 'TM') then
  qt_dado_retorno_w := qt_dado_TM_w;
elsif (ie_dado_p = 'IR') then
  qt_dado_retorno_w := qt_dado_IR_w;
elsif (ie_dado_p = 'ES') then
  qt_dado_retorno_w := qt_dado_ES_w;
elsif (ie_dado_p = 'TT') then
  qt_dado_retorno_w := qt_dado_TT_w;
end if;

return qt_dado_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_escala_apgar ( ie_dado_p text, nr_atendimento_p bigint, nr_recem_nascido_p bigint, ie_minuto_p bigint) FROM PUBLIC;

