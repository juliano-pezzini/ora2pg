-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_desc_item_pep_nivel ( nr_seq_item_pep_p bigint, cd_perfil_p bigint default null, ie_soap_p text default null) RETURNS varchar AS $body$
DECLARE


ds_retorno_w 		varchar(255);
ie_nivel_atencao_w	varchar(5);



BEGIN

if (nr_seq_item_pep_p IS NOT NULL AND nr_seq_item_pep_p::text <> '') then

	if (cd_perfil_p IS NOT NULL AND cd_perfil_p::text <> '')then

		select coalesce(ie_nivel_atencao,'T')
		into STRICT ie_nivel_atencao_w
		from perfil
		where cd_perfil = cd_perfil_p;

	else
		ie_nivel_atencao_w := coalesce(wheb_assist_pck.get_nivel_atencao_perfil,'T');
	end if;

	if (ie_nivel_atencao_w = 'P') then

		SELECT max(obter_desc_expressao(CD_EXP_DESC_ITEM_AP, ''))
		INTO STRICT DS_RETORNO_W
		FROM PRONTUARIO_ITEM_SOAP
		WHERE (CD_EXP_DESC_ITEM_AP IS NOT NULL AND CD_EXP_DESC_ITEM_AP::text <> '')
		AND NR_SEQ_ITEM_PRONT = NR_SEQ_ITEM_PEP_P
		and IE_ETAPA_SOAP = coalesce(ie_soap_p,IE_ETAPA_SOAP);


	end if;

end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_desc_item_pep_nivel ( nr_seq_item_pep_p bigint, cd_perfil_p bigint default null, ie_soap_p text default null) FROM PUBLIC;

