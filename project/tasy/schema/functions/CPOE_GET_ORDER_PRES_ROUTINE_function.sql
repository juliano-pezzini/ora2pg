-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cpoe_get_order_pres_routine ( cd_perfil_p bigint, ie_tipo_p text) RETURNS bigint AS $body$
DECLARE

											
nr_seq_apresen_enteral_w		cpoe_presentation_routine.nr_seq_apresen_enteral%type;
nr_seq_apresen_esp_w			cpoe_presentation_routine.nr_seq_apresen_esp%type;
nr_seq_apresen_gas_w			cpoe_presentation_routine.nr_seq_apresen_gas%type;
nr_seq_apresen_ap_w			cpoe_presentation_routine.nr_seq_apresen_anat%type;
nr_seq_apresen_lab_w			cpoe_presentation_routine.nr_seq_apresen_lab%type;
nr_seq_apresen_medic_w			cpoe_presentation_routine.nr_seq_apresen_medic%type;
nr_seq_apresen_nao_lab_w		cpoe_presentation_routine.nr_seq_apresen_nao_lab%type;
nr_seq_apresen_oral_w			cpoe_presentation_routine.nr_seq_apresen_oral%type;
nr_seq_apresen_rec_w			cpoe_presentation_routine.nr_seq_apresen_rec%type;
nr_seq_apresen_sol_w			cpoe_presentation_routine.nr_seq_apresen_sol%type;
nr_seq_apresen_mat_w			cpoe_presentation_routine.nr_seq_apresen_mat%type;
nr_seq_apresen_sup_w			cpoe_presentation_routine.nr_seq_apresen_sup%type;
nr_seq_apresen_milk_w			cpoe_presentation_routine.nr_seq_apresen_milk%type;
nr_seq_apresen_resp_w			cpoe_presentation_routine.nr_seq_apresen_resp%type;
nr_sequencia_w					cpoe_presentation_rule.nr_sequencia%type;
nr_seq_apresent_w				bigint := 9999999;

/* Opcoes disponiveis	Dominio =  7246 */

		

BEGIN

select	coalesce(max(nr_sequencia),0)
into STRICT	nr_sequencia_w
from (SELECT nr_sequencia
	from	cpoe_presentation_rule
	where 	coalesce(cd_perfil, coalesce(cd_perfil_p,0)) = coalesce(cd_perfil_p,0)
	and	coalesce(cd_estabelecimento, coalesce(wheb_usuario_pck.get_cd_estabelecimento,0)) = coalesce(wheb_usuario_pck.get_cd_estabelecimento,0)
	order by cd_perfil, cd_estabelecimento) alias8 LIMIT 1;

if (nr_sequencia_w > 0) then
	select	max(coalesce(nr_seq_apresen_enteral,9999999)),
			max(coalesce(nr_seq_apresen_esp,9999999)),
			max(coalesce(nr_seq_apresen_gas,9999999)),
      max(coalesce(nr_seq_apresen_anat,9999999)),
			max(coalesce(nr_seq_apresen_lab,9999999)),
			max(coalesce(nr_seq_apresen_medic,9999999)),
			max(coalesce(nr_seq_apresen_nao_lab,9999999)),
			max(coalesce(nr_seq_apresen_oral,9999999)),
			max(coalesce(nr_seq_apresen_rec,9999999)),
			max(coalesce(nr_seq_apresen_sol,9999999)),
			max(coalesce(nr_seq_apresen_mat,9999999)),
			max(coalesce(nr_seq_apresen_sup,9999999)),
			max(coalesce(nr_seq_apresen_milk,9999999)),
			max(coalesce(nr_seq_apresen_resp,9999999))
	into STRICT	nr_seq_apresen_enteral_w,
			nr_seq_apresen_esp_w,
			nr_seq_apresen_gas_w,
      nr_seq_apresen_ap_w,
			nr_seq_apresen_lab_w,
			nr_seq_apresen_medic_w,
			nr_seq_apresen_nao_lab_w,
			nr_seq_apresen_oral_w,
			nr_seq_apresen_rec_w,
			nr_seq_apresen_sol_w,
			nr_seq_apresen_mat_w,
			nr_seq_apresen_sup_w,
			nr_seq_apresen_milk_w,
			nr_seq_apresen_resp_w
	from	cpoe_presentation_routine
	where	nr_seq_rule = nr_sequencia_w;
	
	if (ie_tipo_p = 'DE') then
		return 	nr_seq_apresen_enteral_w;
	elsif (ie_tipo_p = 'DL') then
		return	nr_seq_apresen_milk_w;	
	elsif (ie_tipo_p = 'DO') then
		return	nr_seq_apresen_oral_w;
	elsif (ie_tipo_p = 'DS') then
		return	nr_seq_apresen_sup_w;
	elsif (ie_tipo_p = 'ES') then
		return 	nr_seq_apresen_esp_w;
	elsif (ie_tipo_p = 'EX') then
		return	nr_seq_apresen_lab_w;
	elsif (ie_tipo_p = 'G') then
		return	nr_seq_apresen_gas_w;
  elsif (ie_tipo_p = 'AP') then
		return	nr_seq_apresen_ap_w;
	elsif (ie_tipo_p = 'M') then
		return	nr_seq_apresen_medic_w;
	elsif (ie_tipo_p = 'P') then
		return	nr_seq_apresen_nao_lab_w;
	elsif (ie_tipo_p = 'R') then
		return	nr_seq_apresen_rec_w;
	elsif (ie_tipo_p = 'S') then
		return	nr_seq_apresen_sol_w;
	elsif (ie_tipo_p = 'MA') then
		return	nr_seq_apresen_mat_w;
	elsif (ie_tipo_p = 'TR') then
		return	nr_seq_apresen_resp_w;
	end if;

end if;

return	nr_seq_apresent_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_get_order_pres_routine ( cd_perfil_p bigint, ie_tipo_p text) FROM PUBLIC;

