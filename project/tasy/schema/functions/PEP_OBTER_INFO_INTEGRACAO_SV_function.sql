-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pep_obter_info_integracao_sv ( nr_sequencia_p bigint) RETURNS varchar AS $body$
DECLARE

ie_integracao_extra_w     char(1) := 'N';
ie_integracao_mentor_w    char(1) := 'N';
ie_integracao_regra_w	  char(1) := 'N';
nr_seq_min_philips_w	  bigint;
ds_mensagem_w             varchar(4000);
nm_usuario_w              varchar(255);
quebra_linha_w            constant varchar(255)    := chr(13) || chr(10);
qt_min_item_philips_w     bigint;
ds_atributos_integrados_w varchar(255);


BEGIN

select coalesce(max(ie_integracao_regra)  , 'N'),
       coalesce(max(ie_integracao_mentor) , 'N'),
       coalesce(max(nr_seq_min_philips)   ,  0 ),
       coalesce(max(ie_integracao_extra)  , 'N'),
       coalesce(max(nm_usuario)           , '' )
into STRICT   ie_integracao_regra_w,
       ie_integracao_mentor_w,
       nr_seq_min_philips_w,
       ie_integracao_extra_w,
       nm_usuario_w
from   atendimento_sinal_vital
where  nr_sequencia = nr_sequencia_p;

if 'PHILIPS' = nm_usuario_w then
    ds_mensagem_w := ds_mensagem_w || wheb_mensagem_pck.get_texto(389617) || quebra_linha_w; --- Gerado a partir de equipamento philips
end if;

if ie_integracao_extra_w <> 'S' then
    ds_mensagem_w := ds_mensagem_w || wheb_mensagem_pck.get_texto(389623) || quebra_linha_w; --- Periódico
else
     ds_mensagem_w := ds_mensagem_w || wheb_mensagem_pck.get_texto(389668) || quebra_linha_w; --- APeriódico
end if;

if ie_integracao_mentor_w = 'S' then
    ds_mensagem_w := ds_mensagem_w || wheb_mensagem_pck.get_texto(389674) || quebra_linha_w; --- Com pendências do mentor devido aos cadastros de suporte a decisão clínica
end if;

if ie_integracao_regra_w = 'S' then

            select  max(a.qt_min_item_philips)
            into STRICT    qt_min_item_philips_w
            from    lib_itens_sv_philips     a,
                    lib_itens_regra_sv       b,
                    sv_integracao_philips    c,
                    atendimento_sinal_vital  d
            where   b.nr_seq_regra_tempo = a.nr_sequencia
            and     a.nr_seq_regra       = c.nr_sequencia
            and     a.nr_sequencia       = d.nr_seq_min_philips
            and     d.nr_sequencia       = nr_sequencia_p;

    ds_mensagem_w := ds_mensagem_w || wheb_mensagem_pck.get_texto(389691, 'MINUTOS='||qt_min_item_philips_w) || quebra_linha_w; --- Gerado a partir da regra de #@MINUTOS#@ minutos do Cadastro de importação sinais vitais Philips
end if;



return substr(ds_mensagem_w,1,4000);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pep_obter_info_integracao_sv ( nr_sequencia_p bigint) FROM PUBLIC;

