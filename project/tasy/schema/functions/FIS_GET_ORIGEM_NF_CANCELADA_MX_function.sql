-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION fis_get_origem_nf_cancelada_mx (seq_nf_atual_p fis_origem_nf_cancel.seq_nf_atual%type) RETURNS FIS_ORIGEM_NF_CANCEL.SEQ_NF_CANCELADA%TYPE AS $body$
DECLARE


seq_nf_origem_w			fis_origem_nf_cancel.seq_nf_cancelada%type;
seq_nf_atual_w			fis_origem_nf_cancel.seq_nf_atual%type;
cd_estabelecimento_w	fis_origem_nf_cancel.cd_estabelecimento%type;
ie_loop_w				boolean := true;

BEGIN
	seq_nf_origem_w := null;
	seq_nf_atual_w := seq_nf_atual_p;
	
	select	coalesce(cd_estabelecimento,0)
	into STRICT	cd_estabelecimento_w
	from 	nota_fiscal
	where	nr_sequencia = seq_nf_atual_p;
	
	while ie_loop_w
	loop
	   	begin
			select	seq_nf_cancelada
			into STRICT	seq_nf_origem_w
			from	fis_origem_nf_cancel
			where	seq_nf_atual = seq_nf_atual_w
			and		cd_estabelecimento = cd_estabelecimento_w  LIMIT 1;
		exception
			WHEN OTHERS THEN
                ie_loop_w := false;
		end;
		
		seq_nf_atual_w := seq_nf_origem_w;

	end loop;
	
	return seq_nf_origem_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION fis_get_origem_nf_cancelada_mx (seq_nf_atual_p fis_origem_nf_cancel.seq_nf_atual%type) FROM PUBLIC;

