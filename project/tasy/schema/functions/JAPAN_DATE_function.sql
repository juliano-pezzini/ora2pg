-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION japan_date (ds_data_japan_p text) RETURNS timestamp AS $body$
DECLARE

  ds_abreviacao_w varchar(1);
  qt_ano_w        smallint;
  ds_ano_cal_w    varchar(4);
  ds_mes_dia_w    varchar(4);
  dt_data         timestamp;
  dt_inicio_w     timestamp;
  dt_final_w      timestamp;

BEGIN
  ds_abreviacao_w := substr(ds_data_japan_p, 1, 1);
  qt_ano_w        := (substr(ds_data_japan_p, 2, 2))::numeric;
  ds_mes_dia_w    := substr(ds_data_japan_p, 4, 4);
  BEGIN
    SELECT extract(YEAR FROM add_months(dt_inicio, (qt_ano_w - 1) * 12)),
           dt_inicio,
           dt_fim
      INTO STRICT ds_ano_cal_w,
           dt_inicio_w,
           dt_final_w
      FROM calendario_jap_imperial
     WHERE ds_abreviacao = ds_abreviacao_w;
    dt_data := to_date(ds_ano_cal_w || ds_mes_dia_w, 'yyyymmdd');
    IF dt_data < dt_inicio_w OR
       dt_data > dt_final_w THEN
      dt_data := NULL;
    END IF;
  EXCEPTION
    WHEN OTHERS THEN
      dt_data := NULL;
  END;
  RETURN dt_data;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION japan_date (ds_data_japan_p text) FROM PUBLIC;

