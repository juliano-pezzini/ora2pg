-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_quant_turno_sep_hor (nr_prescricao_p bigint, cd_material_p bigint, ie_turno_p bigint) RETURNS varchar AS $body$
DECLARE

 
dt_primeiro_horario_w	timestamp;
hr_prim_horario_w	varchar(5);
ds_retorno_w		varchar(255);
cd_setor_atendimento_w	integer;
cd_estabelecimento_w	smallint;
hr_prim_turno_w		varchar(5);
hr_seg_turno_w		varchar(5);
hr_ter_turno_w		varchar(5);
nr_sequencia_w		integer;
qt_total_dispensar_w	double precision;
qt_total_disp_w		double precision;
nr_ocorrencia_w		double precision;

hr_prim_horario_sol_w	varchar(5);

 
ds_horarios_w		varchar(2000);
ds_horarios_dif_w	varchar(2000);
qt_manha_w		double precision := 0;
qt_tarde_w		double precision := 0;
qt_noite_w		double precision := 0;
qt_exedente_w		double precision := 0;
qt_sobra_w		double precision := 0;
ds_hora_w		varchar(255);
qt_unitaria_w		double precision;
ie_agupador_w		smallint;
nr_sequencia_diluicao_w	integer;
nr_sequencia_solucao_w	integer;
k			integer;
y			integer;
qt_flag_w		integer := 0;

ie_agrupador_w		smallint;

hr_inicio_w		varchar(5);
ds_horario_tot_w	varchar(2000);	
ds_horario_tot2_w	varchar(2000);	
 
qt_hora00_w		double precision := 0;
qt_hora01_w		double precision := 0;
qt_hora02_w		double precision := 0;
qt_hora03_w		double precision := 0;
qt_hora04_w		double precision := 0;
qt_hora05_w		double precision := 0;
qt_hora06_w		double precision := 0;
qt_hora07_w		double precision := 0;
qt_hora08_w		double precision := 0;
qt_hora09_w		double precision := 0;
qt_hora10_w		double precision := 0;
qt_hora11_w		double precision := 0;
qt_hora12_w		double precision := 0;
qt_hora13_w		double precision := 0;
qt_hora14_w		double precision := 0;
qt_hora15_w		double precision := 0;
qt_hora16_w		double precision := 0;
qt_hora17_w		double precision := 0;
qt_hora18_w		double precision := 0;
qt_hora19_w		double precision := 0;
qt_hora20_w		double precision := 0;
qt_hora21_w		double precision := 0;
qt_hora22_w		double precision := 0;
qt_hora23_w		double precision := 0;

C01 CURSOR FOR 
	SELECT	a.nr_sequencia, 
		a.ie_agrupador, 
		a.nr_sequencia_diluicao, 
		a.nr_sequencia_solucao, 
		a.hr_prim_horario 
	from	material b, 
		prescr_material a 
	where	a.nr_prescricao	= nr_prescricao_p 
	and	a.cd_material	= cd_material_p 
	and	a.cd_material	= b.cd_material 
	and	coalesce(a.ie_urgencia,'N')			<> 'S' 
	and	coalesce(a.ie_medicacao_paciente,'N')	<> 'S' 
	and	coalesce(a.ie_suspenso,'N')			<> 'S' 
	order by a.ie_agrupador;

BEGIN
 
select	coalesce(cd_setor_atendimento,obter_setor_atendimento(nr_atendimento)), 
	cd_estabelecimento, 
	dt_primeiro_horario 
into STRICT	cd_setor_atendimento_w, 
	cd_estabelecimento_w, 
	dt_primeiro_horario_w 
from	prescr_medica 
where	nr_prescricao = nr_prescricao_p;
 
begin 
select	hr_prim_turno, 
	hr_seg_turno, 
	hr_ter_turno 
into STRICT	hr_prim_turno_w, 
	hr_seg_turno_w, 
	hr_ter_turno_w 
from	regra_turno_prescr 
where	cd_estabelecimento	= cd_estabelecimento_w 
and	nr_sequencia		= (	SELECT	min(b.nr_sequencia) 
					from	regra_turno_prescr b 
					where	cd_setor_atendimento = cd_setor_atendimento_w);
exception 
	when others then 
		hr_prim_turno_w := null;
end;
 
if (coalesce(hr_prim_turno_w::text, '') = '') then 
	begin 
	select	hr_prim_turno, 
		hr_seg_turno, 
		hr_ter_turno 
	into STRICT	hr_prim_turno_w, 
		hr_seg_turno_w, 
		hr_ter_turno_w 
	from	regra_turno_prescr 
	where	cd_estabelecimento	= cd_estabelecimento_w 
	and	nr_sequencia		= (	SELECT	min(b.nr_sequencia) 
						from	regra_turno_prescr b 
						where	coalesce(cd_setor_atendimento::text, '') = '');
	exception 
		when others then 
			hr_prim_turno_w := null;
	end;	
end if;
 
 
 
if (hr_prim_turno_w IS NOT NULL AND hr_prim_turno_w::text <> '') then 
	OPEN C01;
	LOOP 
		FETCH C01 into 
			nr_sequencia_w, 
			ie_agrupador_w, 
			nr_sequencia_diluicao_w, 
			nr_sequencia_solucao_w, 
			hr_prim_horario_w;
		EXIT WHEN NOT FOUND; /* apply on C01 */
		begin 
		 
		select	padroniza_horario_prescr(ds_horarios, '00:00'), 
			ds_horarios, 
			dividir(qt_total_dispensar,nr_ocorrencia), 
			ie_agrupador, 
			nr_sequencia_diluicao, 
			qt_total_dispensar 
		into STRICT	ds_horarios_w, 
			ds_horarios_dif_w, 
			qt_unitaria_w, 
			ie_agupador_w, 
			nr_sequencia_diluicao_w, 
			qt_total_disp_w 
		from	prescr_material 
		where	nr_prescricao	= nr_prescricao_p 
		and	nr_sequencia	= nr_sequencia_w;
 
		if (ie_agrupador_w in (1,3,7,9,12)) then 
			if (ie_agupador_w in (3,7,9)) then 
				select	padroniza_horario_prescr(ds_horarios, '00:00'), 
					ds_horarios, 
					qt_total_dispensar, 
					nr_ocorrencia 
				into STRICT	ds_horarios_w, 
					ds_horarios_dif_w, 
					qt_total_dispensar_w, 
					nr_ocorrencia_w 
				from	prescr_material 
				where	nr_prescricao	= nr_prescricao_p 
				and	nr_sequencia	= nr_sequencia_diluicao_w;
			end if;
 
			if (ie_agrupador_w = 9) then 
				qt_unitaria_w	:= dividir(qt_total_dispensar_w,nr_ocorrencia_w);
			end if;
						 
			if (coalesce(ds_horarios_w::text, '') = '') and (hr_prim_horario_w IS NOT NULL AND hr_prim_horario_w::text <> '') then	 
				ds_horarios_w	:= hr_prim_horario_w||' ';
			elsif (coalesce(ds_horarios_w::text, '') = '') and (coalesce(hr_prim_horario_w::text, '') = '') then 
				ds_horarios_w	:= to_char(dt_primeiro_horario_w,'hh24:mi')||' ';
			end if;
 
			ds_horarios_w	:= replace(ds_horarios_w, 'A','');
			qt_flag_w	:= 0;
			while	(ds_horarios_w IS NOT NULL AND ds_horarios_w::text <> '') LOOP 
				begin 
				select	position(' ' in ds_horarios_w) 
				into STRICT	k 
				;
				if (k > 1) and ((substr(ds_horarios_w, 1, k -1) IS NOT NULL AND (substr(ds_horarios_w, 1, k -1))::text <> '')) then 
					ds_hora_w		:= substr(ds_horarios_w, 1, k-1);
					ds_hora_w		:= replace(ds_hora_w, ' ','');
					ds_horarios_w		:= substr(ds_horarios_w, k + 1, 200);
				elsif (ds_horarios_w IS NOT NULL AND ds_horarios_w::text <> '') then 
					ds_hora_w 		:= replace(ds_horarios_w,' ','');
					ds_horarios_w		:= '';
				end if;
	 
				if (hr_ter_turno_w IS NOT NULL AND hr_ter_turno_w::text <> '') and 
					((ds_hora_w >= hr_ter_turno_w) or (ds_hora_w < hr_prim_turno_w)) then 
					qt_noite_w	:= qt_noite_w + qt_unitaria_w;
				elsif (hr_seg_turno_w IS NOT NULL AND hr_seg_turno_w::text <> '') and (ds_hora_w >= hr_seg_turno_w) and (ds_hora_w < coalesce(hr_ter_turno_w,'99999')) then 
					qt_tarde_w	:= qt_tarde_w + qt_unitaria_w;
				elsif (hr_prim_turno_w IS NOT NULL AND hr_prim_turno_w::text <> '') and (ds_hora_w IS NOT NULL AND ds_hora_w::text <> '') then 
					qt_manha_w	:= qt_manha_w + qt_unitaria_w;
				end if;
					 
				if (ds_hora_w >= '24:00') or (substr(ds_hora_w,1,2) = '00') then 
					qt_hora00_w	:= qt_hora00_w + qt_unitaria_w;
				elsif (ds_hora_w >= '23:00') then 
					qt_hora23_w	:= qt_hora23_w + qt_unitaria_w;
				elsif (ds_hora_w >= '22:00') then	 
					qt_hora22_w	:= qt_hora22_w + qt_unitaria_w;
				elsif (ds_hora_w >= '21:00') then 
					qt_hora21_w	:= qt_hora21_w + qt_unitaria_w;
				elsif (ds_hora_w >= '20:00') then 
					qt_hora20_w	:= qt_hora20_w + qt_unitaria_w;
				elsif (ds_hora_w >= '19:00') then 
					qt_hora19_w	:= qt_hora19_w + qt_unitaria_w;
				elsif (ds_hora_w >= '18:00') then 
					qt_hora18_w	:= qt_hora18_w + qt_unitaria_w;
				elsif (ds_hora_w >= '17:00') then 
					qt_hora17_w	:= qt_hora17_w + qt_unitaria_w;
				elsif (ds_hora_w >= '16:00') then 
					qt_hora16_w	:= qt_hora16_w + qt_unitaria_w;
				elsif (ds_hora_w >= '15:00') then 
					qt_hora15_w	:= qt_hora15_w + qt_unitaria_w;
				elsif (ds_hora_w >= '14:00') then 
					qt_hora14_w	:= qt_hora14_w + qt_unitaria_w;
				elsif (ds_hora_w >= '13:00') then 
					qt_hora13_w	:= qt_hora13_w + qt_unitaria_w;
				elsif (ds_hora_w >= '12:00') then 
					qt_hora12_w	:= qt_hora12_w + qt_unitaria_w;
				elsif (ds_hora_w >= '11:00') then 
					qt_hora11_w	:= qt_hora11_w + qt_unitaria_w;
				elsif (ds_hora_w >= '10:00') then 
					qt_hora10_w	:= qt_hora10_w + qt_unitaria_w;
				elsif (ds_hora_w >= '09:00') then 
					qt_hora09_w	:= qt_hora09_w + qt_unitaria_w;
				elsif (ds_hora_w >= '08:00') then 
					qt_hora08_w	:= qt_hora08_w + qt_unitaria_w;
				elsif (ds_hora_w >= '07:00') then 
					qt_hora07_w	:= qt_hora07_w + qt_unitaria_w;
				elsif (ds_hora_w >= '06:00') then 
					qt_hora06_w	:= qt_hora06_w + qt_unitaria_w;
				elsif (ds_hora_w >= '05:00') then 
					qt_hora05_w	:= qt_hora05_w + qt_unitaria_w;
				elsif (ds_hora_w >= '04:00') then 
					qt_hora04_w	:= qt_hora04_w + qt_unitaria_w;
				elsif (ds_hora_w >= '03:00') then 
					qt_hora03_w	:= qt_hora03_w + qt_unitaria_w;
				elsif (ds_hora_w >= '02:00') then 
					qt_hora02_w	:= qt_hora02_w + qt_unitaria_w;
				elsif (ds_hora_w >= '01:00') then 
					qt_hora01_w	:= qt_hora01_w + qt_unitaria_w;
				end if;		
 
				qt_flag_w	:= qt_flag_w + 1;
				if (qt_flag_w > 30) then	 
					ds_horarios_w	:= '';
				end if;
				end;
			END LOOP;
			 
		end if;
 
		if (ie_agrupador_w = 2) then 
						 
			if (coalesce(ds_horarios_w::text, '') = '') and (hr_prim_horario_w IS NOT NULL AND hr_prim_horario_w::text <> '') then	 
				ds_horarios_w	:= hr_prim_horario_w||' ';
				qt_unitaria_w	:= qt_total_disp_w;
			elsif (coalesce(ds_horarios_w::text, '') = '') and (coalesce(hr_prim_horario_w::text, '') = '') then 
				ds_horarios_w	:= to_char(dt_primeiro_horario_w,'hh24:mi')||' ';
				qt_unitaria_w	:= qt_total_disp_w;
			end if;
 
			ds_horarios_w	:= replace(ds_horarios_w, 'A','');
			qt_flag_w	:= 0;
			while	(ds_horarios_w IS NOT NULL AND ds_horarios_w::text <> '') LOOP 
				begin 
				select	position(' ' in ds_horarios_w) 
				into STRICT	k 
				;
				if (k > 1) and ((substr(ds_horarios_w, 1, k -1) IS NOT NULL AND (substr(ds_horarios_w, 1, k -1))::text <> '')) then 
					ds_hora_w		:= substr(ds_horarios_w, 1, k-1);
					ds_hora_w		:= replace(ds_hora_w, ' ','');
					ds_horarios_w		:= substr(ds_horarios_w, k + 1, 200);
				elsif (ds_horarios_w IS NOT NULL AND ds_horarios_w::text <> '') then 
					ds_hora_w 		:= replace(ds_horarios_w,' ','');
					ds_horarios_w		:= '';
				end if;
	 
				if (hr_ter_turno_w IS NOT NULL AND hr_ter_turno_w::text <> '') and 
					((ds_hora_w >= hr_ter_turno_w) or (ds_hora_w < hr_prim_turno_w)) then 
					qt_noite_w	:= qt_noite_w + qt_unitaria_w;
				elsif (hr_seg_turno_w IS NOT NULL AND hr_seg_turno_w::text <> '') and (ds_hora_w >= hr_seg_turno_w) and (ds_hora_w < coalesce(hr_ter_turno_w,'99999')) then 
					qt_tarde_w	:= qt_tarde_w + qt_unitaria_w;
				elsif (hr_prim_turno_w IS NOT NULL AND hr_prim_turno_w::text <> '') and (ds_hora_w IS NOT NULL AND ds_hora_w::text <> '') then 
					qt_manha_w	:= qt_manha_w + qt_unitaria_w;
				end if;
			 
				if (ds_hora_w >= '24:00') or (substr(ds_hora_w,1,2) = '00') then 
					qt_hora00_w	:= qt_hora00_w + qt_unitaria_w;
				elsif (ds_hora_w >= '23:00') then 
					qt_hora23_w	:= qt_hora23_w + qt_unitaria_w;
				elsif (ds_hora_w >= '22:00') then	 
					qt_hora22_w	:= qt_hora22_w + qt_unitaria_w;
				elsif (ds_hora_w >= '21:00') then 
					qt_hora21_w	:= qt_hora21_w + qt_unitaria_w;
				elsif (ds_hora_w >= '20:00') then 
					qt_hora20_w	:= qt_hora20_w + qt_unitaria_w;
				elsif (ds_hora_w >= '19:00') then 
					qt_hora19_w	:= qt_hora19_w + qt_unitaria_w;
				elsif (ds_hora_w >= '18:00') then 
					qt_hora18_w	:= qt_hora18_w + qt_unitaria_w;
				elsif (ds_hora_w >= '17:00') then 
					qt_hora17_w	:= qt_hora17_w + qt_unitaria_w;
				elsif (ds_hora_w >= '16:00') then 
					qt_hora16_w	:= qt_hora16_w + qt_unitaria_w;
				elsif (ds_hora_w >= '15:00') then 
					qt_hora15_w	:= qt_hora15_w + qt_unitaria_w;
				elsif (ds_hora_w >= '14:00') then 
					qt_hora14_w	:= qt_hora14_w + qt_unitaria_w;
				elsif (ds_hora_w >= '13:00') then 
					qt_hora13_w	:= qt_hora13_w + qt_unitaria_w;
				elsif (ds_hora_w >= '12:00') then 
					qt_hora12_w	:= qt_hora12_w + qt_unitaria_w;
				elsif (ds_hora_w >= '11:00') then 
					qt_hora11_w	:= qt_hora11_w + qt_unitaria_w;
				elsif (ds_hora_w >= '10:00') then 
					qt_hora10_w	:= qt_hora10_w + qt_unitaria_w;
				elsif (ds_hora_w >= '09:00') then 
					qt_hora09_w	:= qt_hora09_w + qt_unitaria_w;
				elsif (ds_hora_w >= '08:00') then 
					qt_hora08_w	:= qt_hora08_w + qt_unitaria_w;
				elsif (ds_hora_w >= '07:00') then 
					qt_hora07_w	:= qt_hora07_w + qt_unitaria_w;
				elsif (ds_hora_w >= '06:00') then 
					qt_hora06_w	:= qt_hora06_w + qt_unitaria_w;
				elsif (ds_hora_w >= '05:00') then 
					qt_hora05_w	:= qt_hora05_w + qt_unitaria_w;
				elsif (ds_hora_w >= '04:00') then 
					qt_hora04_w	:= qt_hora04_w + qt_unitaria_w;
				elsif (ds_hora_w >= '03:00') then 
					qt_hora03_w	:= qt_hora03_w + qt_unitaria_w;
				elsif (ds_hora_w >= '02:00') then 
					qt_hora02_w	:= qt_hora02_w + qt_unitaria_w;
				elsif (ds_hora_w >= '01:00') then 
					qt_hora01_w	:= qt_hora01_w + qt_unitaria_w;
				end if;
 
				qt_flag_w	:= qt_flag_w + 1;
				if (qt_flag_w > 30) then	 
					ds_horarios_w	:= '';
				end if;
				end;
			END LOOP;
			 
		end if;
 
		if (ie_agrupador_w	= 4) then 
 
			select	hr_prim_horario, 
				coalesce(ds_horarios,to_char(dt_primeiro_horario_w,'hh24:mi')||' ') 
			into STRICT	hr_prim_horario_sol_w, 
				ds_horarios_w 
			from	prescr_solucao 
			where	nr_prescricao	= nr_prescricao_p 
			and	nr_seq_solucao	= nr_sequencia_solucao_w;
 
			if (ds_horarios_w IS NOT NULL AND ds_horarios_w::text <> '') then 
				ds_horarios_w	:= ds_horarios_w ||' ';
			end if;
			qt_flag_w	:= 0;
			while	(ds_horarios_w IS NOT NULL AND ds_horarios_w::text <> '') LOOP 
				begin 
				select	position('das' in ds_horarios_w) 
				into STRICT	k 
				;
				if (k > 0) then 
					ds_horarios_w		:= substr(ds_horarios_w, k + 4, 255);
					select	position(' ' in ds_horarios_w) 
					into STRICT	y 
					;
					ds_hora_w		:= substr(ds_horarios_w, 1, y-1);
					ds_hora_w		:= replace(ds_hora_w, ' ','');
					ds_horarios_w		:= substr(ds_horarios_w, y + 1, 200);
				elsif (ds_horarios_w IS NOT NULL AND ds_horarios_w::text <> '') then 
					ds_hora_w 		:= replace(ds_horarios_w,' ','');
					ds_horarios_w		:= '';
				end if;
 
				if (position(':' in ds_hora_w) = 0) then 
					ds_hora_w	:= ds_hora_w||':00';
				end if;
	 
				if (hr_ter_turno_w IS NOT NULL AND hr_ter_turno_w::text <> '') and 
					((ds_hora_w >= hr_ter_turno_w) or (ds_hora_w < hr_prim_turno_w)) then 
					qt_noite_w	:= qt_noite_w + qt_unitaria_w;
				elsif (hr_seg_turno_w IS NOT NULL AND hr_seg_turno_w::text <> '') and (ds_hora_w >= hr_seg_turno_w) and (ds_hora_w < coalesce(hr_ter_turno_w,'99999')) then 
					qt_tarde_w	:= qt_tarde_w + qt_unitaria_w;
				elsif (hr_prim_turno_w IS NOT NULL AND hr_prim_turno_w::text <> '') and (ds_hora_w IS NOT NULL AND ds_hora_w::text <> '') then 
					qt_manha_w	:= qt_manha_w + qt_unitaria_w;
				end if;
				 
				if (ds_hora_w >= '24:00') or (substr(ds_hora_w,1,2) = '00') then 
					qt_hora00_w	:= qt_hora00_w + qt_unitaria_w;
				elsif (ds_hora_w >= '23:00') then 
					qt_hora23_w	:= qt_hora23_w + qt_unitaria_w;
				elsif (ds_hora_w >= '22:00') then	 
					qt_hora22_w	:= qt_hora22_w + qt_unitaria_w;
				elsif (ds_hora_w >= '21:00') then 
					qt_hora21_w	:= qt_hora21_w + qt_unitaria_w;
				elsif (ds_hora_w >= '20:00') then 
					qt_hora20_w	:= qt_hora20_w + qt_unitaria_w;
				elsif (ds_hora_w >= '19:00') then 
					qt_hora19_w	:= qt_hora19_w + qt_unitaria_w;
				elsif (ds_hora_w >= '18:00') then 
					qt_hora18_w	:= qt_hora18_w + qt_unitaria_w;
				elsif (ds_hora_w >= '17:00') then 
					qt_hora17_w	:= qt_hora17_w + qt_unitaria_w;
				elsif (ds_hora_w >= '16:00') then 
					qt_hora16_w	:= qt_hora16_w + qt_unitaria_w;
				elsif (ds_hora_w >= '15:00') then 
					qt_hora15_w	:= qt_hora15_w + qt_unitaria_w;
				elsif (ds_hora_w >= '14:00') then 
					qt_hora14_w	:= qt_hora14_w + qt_unitaria_w;
				elsif (ds_hora_w >= '13:00') then 
					qt_hora13_w	:= qt_hora13_w + qt_unitaria_w;
				elsif (ds_hora_w >= '12:00') then 
					qt_hora12_w	:= qt_hora12_w + qt_unitaria_w;
				elsif (ds_hora_w >= '11:00') then 
					qt_hora11_w	:= qt_hora11_w + qt_unitaria_w;
				elsif (ds_hora_w >= '10:00') then 
					qt_hora10_w	:= qt_hora10_w + qt_unitaria_w;
				elsif (ds_hora_w >= '09:00') then 
					qt_hora09_w	:= qt_hora09_w + qt_unitaria_w;
				elsif (ds_hora_w >= '08:00') then 
					qt_hora08_w	:= qt_hora08_w + qt_unitaria_w;
				elsif (ds_hora_w >= '07:00') then 
					qt_hora07_w	:= qt_hora07_w + qt_unitaria_w;
				elsif (ds_hora_w >= '06:00') then 
					qt_hora06_w	:= qt_hora06_w + qt_unitaria_w;
				elsif (ds_hora_w >= '05:00') then 
					qt_hora05_w	:= qt_hora05_w + qt_unitaria_w;
				elsif (ds_hora_w >= '04:00') then 
					qt_hora04_w	:= qt_hora04_w + qt_unitaria_w;
				elsif (ds_hora_w >= '03:00') then 
					qt_hora03_w	:= qt_hora03_w + qt_unitaria_w;
				elsif (ds_hora_w >= '02:00') then 
					qt_hora02_w	:= qt_hora02_w + qt_unitaria_w;
				elsif (ds_hora_w >= '01:00') then 
					qt_hora01_w	:= qt_hora01_w + qt_unitaria_w;
				end if;			
 
				qt_flag_w	:= qt_flag_w + 1;
				if (qt_flag_w > 30) then	 
					ds_horarios_w	:= '';
				end if;
				select	position('das' in ds_horarios_w) 
				into STRICT	k 
				;
				if (k = 0) then 
					ds_horarios_w	:= '';
				end if;
				end;
			END LOOP;			
 
		end if;
 
		if (ie_agrupador_w = 6) then 
			 
			ds_hora_w	:= to_char(dt_primeiro_horario_w,'hh24:mi:ss');
	 
			if (hr_ter_turno_w IS NOT NULL AND hr_ter_turno_w::text <> '') and 
				((ds_hora_w >= hr_ter_turno_w) or (ds_hora_w < hr_prim_turno_w)) then 
				qt_noite_w	:= qt_noite_w + qt_unitaria_w;
			elsif (hr_seg_turno_w IS NOT NULL AND hr_seg_turno_w::text <> '') and (ds_hora_w >= hr_seg_turno_w) and (ds_hora_w < coalesce(hr_ter_turno_w,'99999')) then 
				qt_tarde_w	:= qt_tarde_w + qt_unitaria_w;
			elsif (hr_prim_turno_w IS NOT NULL AND hr_prim_turno_w::text <> '') and (ds_hora_w IS NOT NULL AND ds_hora_w::text <> '') then 
				qt_manha_w	:= qt_manha_w + qt_unitaria_w;
			end if;
 
			if (ds_hora_w >= '24:00') or (substr(ds_hora_w,1,2) = '00') then 
				qt_hora00_w	:= qt_hora00_w + qt_unitaria_w;
			elsif (ds_hora_w >= '23:00') then 
				qt_hora23_w	:= qt_hora23_w + qt_unitaria_w;
			elsif (ds_hora_w >= '22:00') then	 
				qt_hora22_w	:= qt_hora22_w + qt_unitaria_w;
			elsif (ds_hora_w >= '21:00') then 
				qt_hora21_w	:= qt_hora21_w + qt_unitaria_w;
			elsif (ds_hora_w >= '20:00') then 
				qt_hora20_w	:= qt_hora20_w + qt_unitaria_w;
			elsif (ds_hora_w >= '19:00') then 
				qt_hora19_w	:= qt_hora19_w + qt_unitaria_w;
			elsif (ds_hora_w >= '18:00') then 
				qt_hora18_w	:= qt_hora18_w + qt_unitaria_w;
			elsif (ds_hora_w >= '17:00') then 
				qt_hora17_w	:= qt_hora17_w + qt_unitaria_w;
			elsif (ds_hora_w >= '16:00') then 
				qt_hora16_w	:= qt_hora16_w + qt_unitaria_w;
			elsif (ds_hora_w >= '15:00') then 
				qt_hora15_w	:= qt_hora15_w + qt_unitaria_w;
			elsif (ds_hora_w >= '14:00') then 
				qt_hora14_w	:= qt_hora14_w + qt_unitaria_w;
			elsif (ds_hora_w >= '13:00') then 
				qt_hora13_w	:= qt_hora13_w + qt_unitaria_w;
			elsif (ds_hora_w >= '12:00') then 
				qt_hora12_w	:= qt_hora12_w + qt_unitaria_w;
			elsif (ds_hora_w >= '11:00') then 
				qt_hora11_w	:= qt_hora11_w + qt_unitaria_w;
			elsif (ds_hora_w >= '10:00') then 
				qt_hora10_w	:= qt_hora10_w + qt_unitaria_w;
			elsif (ds_hora_w >= '09:00') then 
				qt_hora09_w	:= qt_hora09_w + qt_unitaria_w;
			elsif (ds_hora_w >= '08:00') then 
				qt_hora08_w	:= qt_hora08_w + qt_unitaria_w;
			elsif (ds_hora_w >= '07:00') then 
				qt_hora07_w	:= qt_hora07_w + qt_unitaria_w;
			elsif (ds_hora_w >= '06:00') then 
				qt_hora06_w	:= qt_hora06_w + qt_unitaria_w;
			elsif (ds_hora_w >= '05:00') then 
				qt_hora05_w	:= qt_hora05_w + qt_unitaria_w;
			elsif (ds_hora_w >= '04:00') then 
				qt_hora04_w	:= qt_hora04_w + qt_unitaria_w;
			elsif (ds_hora_w >= '03:00') then 
				qt_hora03_w	:= qt_hora03_w + qt_unitaria_w;
			elsif (ds_hora_w >= '02:00') then 
				qt_hora02_w	:= qt_hora02_w + qt_unitaria_w;
			elsif (ds_hora_w >= '01:00') then 
				qt_hora01_w	:= qt_hora01_w + qt_unitaria_w;
			end if;
		end if;
 
		if (ie_agrupador_w	in (8)) then 
			if (ds_horarios_w IS NOT NULL AND ds_horarios_w::text <> '') then 
				ds_horarios_w	:= ds_horarios_w ||' ';
			end if;
			 
 
			if (position('das' in ds_horarios_dif_w) > 0) then 
 
				ds_horarios_w	:= ds_horarios_dif_w ||' ';
				qt_flag_w	:= 0;
				while	(ds_horarios_w IS NOT NULL AND ds_horarios_w::text <> '') LOOP 
					begin 
					select	position('das' in ds_horarios_w) 
					into STRICT	k 
					;
					if (k > 0) then 
						ds_horarios_w		:= substr(ds_horarios_w, k + 4, 255);
						select	position(' ' in ds_horarios_w) 
						into STRICT	y 
						;
						ds_hora_w		:= substr(ds_horarios_w, 1, y-1);
						ds_hora_w		:= replace(ds_hora_w, ' ','');
						ds_horarios_w		:= substr(ds_horarios_w, y + 1, 200);
					elsif (ds_horarios_w IS NOT NULL AND ds_horarios_w::text <> '') then 
						ds_hora_w 		:= replace(ds_horarios_w,' ','');
						ds_horarios_w		:= '';
					end if;
	 
					if (position(':' in ds_hora_w) = 0) then 
						ds_hora_w	:= ds_hora_w||':00';
					end if;
		 
					if (hr_ter_turno_w IS NOT NULL AND hr_ter_turno_w::text <> '') and 
						((ds_hora_w >= hr_ter_turno_w) or (ds_hora_w < hr_prim_turno_w)) then 
						qt_noite_w	:= qt_noite_w + qt_unitaria_w;
					elsif (hr_seg_turno_w IS NOT NULL AND hr_seg_turno_w::text <> '') and (ds_hora_w >= hr_seg_turno_w) and (ds_hora_w < coalesce(hr_ter_turno_w,'99999')) then 
						qt_tarde_w	:= qt_tarde_w + qt_unitaria_w;
					elsif (hr_prim_turno_w IS NOT NULL AND hr_prim_turno_w::text <> '') and (ds_hora_w IS NOT NULL AND ds_hora_w::text <> '') then 
						qt_manha_w	:= qt_manha_w + qt_unitaria_w;
					end if;
					 
					if (ds_hora_w >= '24:00') or (substr(ds_hora_w,1,2) = '00') then 
						qt_hora00_w	:= qt_hora00_w + qt_unitaria_w;
					elsif (ds_hora_w >= '23:00') then 
						qt_hora23_w	:= qt_hora23_w + qt_unitaria_w;
					elsif (ds_hora_w >= '22:00') then	 
						qt_hora22_w	:= qt_hora22_w + qt_unitaria_w;
					elsif (ds_hora_w >= '21:00') then 
						qt_hora21_w	:= qt_hora21_w + qt_unitaria_w;
					elsif (ds_hora_w >= '20:00') then 
						qt_hora20_w	:= qt_hora20_w + qt_unitaria_w;
					elsif (ds_hora_w >= '19:00') then 
						qt_hora19_w	:= qt_hora19_w + qt_unitaria_w;
					elsif (ds_hora_w >= '18:00') then 
						qt_hora18_w	:= qt_hora18_w + qt_unitaria_w;
					elsif (ds_hora_w >= '17:00') then 
						qt_hora17_w	:= qt_hora17_w + qt_unitaria_w;
					elsif (ds_hora_w >= '16:00') then 
						qt_hora16_w	:= qt_hora16_w + qt_unitaria_w;
					elsif (ds_hora_w >= '15:00') then 
						qt_hora15_w	:= qt_hora15_w + qt_unitaria_w;
					elsif (ds_hora_w >= '14:00') then 
						qt_hora14_w	:= qt_hora14_w + qt_unitaria_w;
					elsif (ds_hora_w >= '13:00') then 
						qt_hora13_w	:= qt_hora13_w + qt_unitaria_w;
					elsif (ds_hora_w >= '12:00') then 
						qt_hora12_w	:= qt_hora12_w + qt_unitaria_w;
					elsif (ds_hora_w >= '11:00') then 
						qt_hora11_w	:= qt_hora11_w + qt_unitaria_w;
					elsif (ds_hora_w >= '10:00') then 
						qt_hora10_w	:= qt_hora10_w + qt_unitaria_w;
					elsif (ds_hora_w >= '09:00') then 
						qt_hora09_w	:= qt_hora09_w + qt_unitaria_w;
					elsif (ds_hora_w >= '08:00') then 
						qt_hora08_w	:= qt_hora08_w + qt_unitaria_w;
					elsif (ds_hora_w >= '07:00') then 
						qt_hora07_w	:= qt_hora07_w + qt_unitaria_w;
					elsif (ds_hora_w >= '06:00') then 
						qt_hora06_w	:= qt_hora06_w + qt_unitaria_w;
					elsif (ds_hora_w >= '05:00') then 
						qt_hora05_w	:= qt_hora05_w + qt_unitaria_w;
					elsif (ds_hora_w >= '04:00') then 
						qt_hora04_w	:= qt_hora04_w + qt_unitaria_w;
					elsif (ds_hora_w >= '03:00') then 
						qt_hora03_w	:= qt_hora03_w + qt_unitaria_w;
					elsif (ds_hora_w >= '02:00') then 
						qt_hora02_w	:= qt_hora02_w + qt_unitaria_w;
					elsif (ds_hora_w >= '01:00') then 
						qt_hora01_w	:= qt_hora01_w + qt_unitaria_w;
					end if;
				 
					qt_flag_w	:= qt_flag_w + 1;
					if (qt_flag_w > 30) then	 
						ds_horarios_w	:= '';
					end if;
					select	position('das' in ds_horarios_w) 
					into STRICT	k 
					;
					if (k = 0) then 
						ds_horarios_w	:= '';
					end if;
					end;
				END LOOP;
			elsif (ds_horarios_w IS NOT NULL AND ds_horarios_w::text <> '') then 
 
				ds_horarios_w	:= replace(ds_horarios_w, 'A','');
				ds_horarios_w	:= ds_horarios_w|| ' ';
				qt_flag_w	:= 0;
				while	(ds_horarios_w IS NOT NULL AND ds_horarios_w::text <> '') LOOP 
					begin 
					select	position(' ' in ds_horarios_w) 
					into STRICT	k 
					;
					if (k > 1) and ((substr(ds_horarios_w, 1, k -1) IS NOT NULL AND (substr(ds_horarios_w, 1, k -1))::text <> '')) then 
						ds_hora_w		:= substr(ds_horarios_w, 1, k-1);
						ds_hora_w		:= replace(ds_hora_w, ' ','');
						ds_horarios_w		:= substr(ds_horarios_w, k + 1, 200);
					elsif (ds_horarios_w IS NOT NULL AND ds_horarios_w::text <> '') then 
						ds_hora_w 		:= replace(ds_horarios_w,' ','');
						ds_horarios_w		:= '';
					end if;
	 
					if (hr_ter_turno_w IS NOT NULL AND hr_ter_turno_w::text <> '') and 
						((ds_hora_w >= hr_ter_turno_w) or (ds_hora_w < hr_prim_turno_w)) then 
						qt_noite_w	:= qt_noite_w + qt_unitaria_w;
					elsif (hr_seg_turno_w IS NOT NULL AND hr_seg_turno_w::text <> '') and (ds_hora_w >= hr_seg_turno_w) and (ds_hora_w < coalesce(hr_ter_turno_w,'99999')) then 
						qt_tarde_w	:= qt_tarde_w + qt_unitaria_w;
					elsif (hr_prim_turno_w IS NOT NULL AND hr_prim_turno_w::text <> '') and (ds_hora_w IS NOT NULL AND ds_hora_w::text <> '') then 
						qt_manha_w	:= qt_manha_w + qt_unitaria_w;
					end if;
					 
					if (ds_hora_w >= '24:00') or (substr(ds_hora_w,1,2) = '00') then 
						qt_hora00_w	:= qt_hora00_w + qt_unitaria_w;
					elsif (ds_hora_w >= '23:00') then 
						qt_hora23_w	:= qt_hora23_w + qt_unitaria_w;
					elsif (ds_hora_w >= '22:00') then	 
						qt_hora22_w	:= qt_hora22_w + qt_unitaria_w;
					elsif (ds_hora_w >= '21:00') then 
						qt_hora21_w	:= qt_hora21_w + qt_unitaria_w;
					elsif (ds_hora_w >= '20:00') then 
						qt_hora20_w	:= qt_hora20_w + qt_unitaria_w;
					elsif (ds_hora_w >= '19:00') then 
						qt_hora19_w	:= qt_hora19_w + qt_unitaria_w;
					elsif (ds_hora_w >= '18:00') then 
						qt_hora18_w	:= qt_hora18_w + qt_unitaria_w;
					elsif (ds_hora_w >= '17:00') then 
						qt_hora17_w	:= qt_hora17_w + qt_unitaria_w;
					elsif (ds_hora_w >= '16:00') then 
						qt_hora16_w	:= qt_hora16_w + qt_unitaria_w;
					elsif (ds_hora_w >= '15:00') then 
						qt_hora15_w	:= qt_hora15_w + qt_unitaria_w;
					elsif (ds_hora_w >= '14:00') then 
						qt_hora14_w	:= qt_hora14_w + qt_unitaria_w;
					elsif (ds_hora_w >= '13:00') then 
						qt_hora13_w	:= qt_hora13_w + qt_unitaria_w;
					elsif (ds_hora_w >= '12:00') then 
						qt_hora12_w	:= qt_hora12_w + qt_unitaria_w;
					elsif (ds_hora_w >= '11:00') then 
						qt_hora11_w	:= qt_hora11_w + qt_unitaria_w;
					elsif (ds_hora_w >= '10:00') then 
						qt_hora10_w	:= qt_hora10_w + qt_unitaria_w;
					elsif (ds_hora_w >= '09:00') then 
						qt_hora09_w	:= qt_hora09_w + qt_unitaria_w;
					elsif (ds_hora_w >= '08:00') then 
						qt_hora08_w	:= qt_hora08_w + qt_unitaria_w;
					elsif (ds_hora_w >= '07:00') then 
						qt_hora07_w	:= qt_hora07_w + qt_unitaria_w;
					elsif (ds_hora_w >= '06:00') then 
						qt_hora06_w	:= qt_hora06_w + qt_unitaria_w;
					elsif (ds_hora_w >= '05:00') then 
						qt_hora05_w	:= qt_hora05_w + qt_unitaria_w;
					elsif (ds_hora_w >= '04:00') then 
						qt_hora04_w	:= qt_hora04_w + qt_unitaria_w;
					elsif (ds_hora_w >= '03:00') then 
						qt_hora03_w	:= qt_hora03_w + qt_unitaria_w;
					elsif (ds_hora_w >= '02:00') then 
						qt_hora02_w	:= qt_hora02_w + qt_unitaria_w;
					elsif (ds_hora_w >= '01:00') then 
						qt_hora01_w	:= qt_hora01_w + qt_unitaria_w;
					end if;				
 
					qt_flag_w	:= qt_flag_w + 1;
					if (qt_flag_w > 30) then	 
						ds_horarios_w	:= '';
					end if;
					end;
				END LOOP;			
			end if;
		end if;
		 
		if (ie_agrupador_w	= 5) then 
			 
			ds_horarios_w	:= replace(ds_horarios_w, 'A','');
			qt_flag_w	:= 0;
			while	(ds_horarios_w IS NOT NULL AND ds_horarios_w::text <> '') LOOP 
				begin 
				select	position(' ' in ds_horarios_w) 
				into STRICT	k 
				;
				if (k > 1) and ((substr(ds_horarios_w, 1, k -1) IS NOT NULL AND (substr(ds_horarios_w, 1, k -1))::text <> '')) then 
					ds_hora_w		:= substr(ds_horarios_w, 1, k-1);
					ds_hora_w		:= replace(ds_hora_w, ' ','');
					ds_horarios_w		:= substr(ds_horarios_w, k + 1, 200);
				elsif (ds_horarios_w IS NOT NULL AND ds_horarios_w::text <> '') then 
					ds_hora_w 		:= replace(ds_horarios_w,' ','');
					ds_horarios_w		:= '';
				end if;
	 
				if (hr_ter_turno_w IS NOT NULL AND hr_ter_turno_w::text <> '') and 
					((ds_hora_w >= hr_ter_turno_w) or (ds_hora_w < hr_prim_turno_w)) then 
					qt_noite_w	:= qt_noite_w + qt_unitaria_w;
				elsif (hr_seg_turno_w IS NOT NULL AND hr_seg_turno_w::text <> '') and (ds_hora_w >= hr_seg_turno_w) and (ds_hora_w < coalesce(hr_ter_turno_w,'99999')) then 
					qt_tarde_w	:= qt_tarde_w + qt_unitaria_w;
				elsif (hr_prim_turno_w IS NOT NULL AND hr_prim_turno_w::text <> '') and (ds_hora_w IS NOT NULL AND ds_hora_w::text <> '') then 
					qt_manha_w	:= qt_manha_w + qt_unitaria_w;
				end if;
			 
				if (ds_hora_w >= '24:00') or (substr(ds_hora_w,1,2) = '00') then 
					qt_hora00_w	:= qt_hora00_w + qt_unitaria_w;
				elsif (ds_hora_w >= '23:00') then 
					qt_hora23_w	:= qt_hora23_w + qt_unitaria_w;
				elsif (ds_hora_w >= '22:00') then	 
					qt_hora22_w	:= qt_hora22_w + qt_unitaria_w;
				elsif (ds_hora_w >= '21:00') then 
					qt_hora21_w	:= qt_hora21_w + qt_unitaria_w;
				elsif (ds_hora_w >= '20:00') then 
					qt_hora20_w	:= qt_hora20_w + qt_unitaria_w;
				elsif (ds_hora_w >= '19:00') then 
					qt_hora19_w	:= qt_hora19_w + qt_unitaria_w;
				elsif (ds_hora_w >= '18:00') then 
					qt_hora18_w	:= qt_hora18_w + qt_unitaria_w;
				elsif (ds_hora_w >= '17:00') then 
					qt_hora17_w	:= qt_hora17_w + qt_unitaria_w;
				elsif (ds_hora_w >= '16:00') then 
					qt_hora16_w	:= qt_hora16_w + qt_unitaria_w;
				elsif (ds_hora_w >= '15:00') then 
					qt_hora15_w	:= qt_hora15_w + qt_unitaria_w;
				elsif (ds_hora_w >= '14:00') then 
					qt_hora14_w	:= qt_hora14_w + qt_unitaria_w;
				elsif (ds_hora_w >= '13:00') then 
					qt_hora13_w	:= qt_hora13_w + qt_unitaria_w;
				elsif (ds_hora_w >= '12:00') then 
					qt_hora12_w	:= qt_hora12_w + qt_unitaria_w;
				elsif (ds_hora_w >= '11:00') then 
					qt_hora11_w	:= qt_hora11_w + qt_unitaria_w;
				elsif (ds_hora_w >= '10:00') then 
					qt_hora10_w	:= qt_hora10_w + qt_unitaria_w;
				elsif (ds_hora_w >= '09:00') then 
					qt_hora09_w	:= qt_hora09_w + qt_unitaria_w;
				elsif (ds_hora_w >= '08:00') then 
					qt_hora08_w	:= qt_hora08_w + qt_unitaria_w;
				elsif (ds_hora_w >= '07:00') then 
					qt_hora07_w	:= qt_hora07_w + qt_unitaria_w;
				elsif (ds_hora_w >= '06:00') then 
					qt_hora06_w	:= qt_hora06_w + qt_unitaria_w;
				elsif (ds_hora_w >= '05:00') then 
					qt_hora05_w	:= qt_hora05_w + qt_unitaria_w;
				elsif (ds_hora_w >= '04:00') then 
					qt_hora04_w	:= qt_hora04_w + qt_unitaria_w;
				elsif (ds_hora_w >= '03:00') then 
					qt_hora03_w	:= qt_hora03_w + qt_unitaria_w;
				elsif (ds_hora_w >= '02:00') then 
					qt_hora02_w	:= qt_hora02_w + qt_unitaria_w;
				elsif (ds_hora_w >= '01:00') then 
					qt_hora01_w	:= qt_hora01_w + qt_unitaria_w;
				end if;
 
				qt_flag_w	:= qt_flag_w + 1;
				if (qt_flag_w > 30) then	 
					ds_horarios_w	:= '';
				end if;
				end;
			END LOOP;
		end if;
			 
		end;
	END LOOP;
	CLOSE C01;	
 
end if;
 
qt_tarde_w	:= round((qt_tarde_w)::numeric,1);
qt_noite_w	:= round((qt_noite_w)::numeric,1);
qt_manha_w	:= round((qt_manha_w)::numeric,1);
 
qt_exedente_w	:= mod(qt_tarde_w,1);
 
if (qt_exedente_w > 0) then 
	qt_tarde_w	:= trunc(qt_tarde_w) +1;
	qt_sobra_w	:= 1 - qt_exedente_w;
end if;	
 
if (qt_noite_w > 0) then 
	qt_exedente_w	:= mod(qt_noite_w,1);
 
	if (qt_sobra_w >= qt_exedente_w) then 
		qt_noite_w	:= trunc(qt_noite_w);	
	else 
		qt_noite_w	:= trunc(qt_noite_w) + 1;
		qt_sobra_w	:= qt_sobra_w + 1 - qt_exedente_w;
	end if;
end if;
 
if (qt_sobra_w > 0) then 
	qt_manha_w	:= trunc(qt_manha_w);
elsif (qt_manha_w > 0) and (qt_sobra_w = 0) then 
	qt_manha_w	:= trunc(qt_manha_w);
elsif (qt_manha_w > 0) then 
	qt_manha_w	:= trunc(qt_manha_w) + 1;
end if;
 
if (ie_turno_p = 1) then 
	if (qt_hora01_w > 0) and ('01:00' >= hr_prim_turno_w) and ('01:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= '01:00 - '||qt_hora01_w ||' / ';
	end if;
	if (qt_hora02_w > 0) and ('02:00' >= hr_prim_turno_w) and ('02:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '02:00 - '||qt_hora02_w ||' / ';
	end if;
	if (qt_hora03_w > 0) and ('03:00' >= hr_prim_turno_w) and ('03:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '03:00 - '||qt_hora03_w ||' / ';
	end if;	
	if (qt_hora04_w > 0) and ('04:00' >= hr_prim_turno_w) and ('04:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '04:00 - '||qt_hora04_w ||' / ';
	end if;
	if (qt_hora05_w > 0) and ('05:00' >= hr_prim_turno_w) and ('05:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '05:00 - '||qt_hora05_w ||' / ';
	end if;
	if (qt_hora06_w > 0) and ('06:00' >= hr_prim_turno_w) and ('06:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '06:00 - '||qt_hora06_w ||' / ';
	end if;
	if (qt_hora07_w > 0) and ('07:00' >= hr_prim_turno_w) and ('07:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '07:00 - '||qt_hora07_w ||' / ';
	end if;
	if (qt_hora08_w > 0) and ('08:00' >= hr_prim_turno_w) and ('08:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '08:00 - '||qt_hora08_w ||' / ';
	end if;
	if (qt_hora09_w > 0) and ('09:00' >= hr_prim_turno_w) and ('09:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '09:00 - '||qt_hora09_w ||' / ';
	end if;
	if (qt_hora10_w > 0) and ('10:00' >= hr_prim_turno_w) and ('10:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '10:00 - '||qt_hora10_w ||' / ';
	end if;
	if (qt_hora11_w > 0) and ('11:00' >= hr_prim_turno_w) and ('11:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '11:00 - '||qt_hora11_w ||' / ';
	end if;
	if (qt_hora12_w > 0) and ('12:00' >= hr_prim_turno_w) and ('12:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '12:00 - '||qt_hora12_w ||' / ';
	end if;
	if (qt_hora13_w > 0) and ('13:00' >= hr_prim_turno_w) and ('13:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '13:00 - '||qt_hora13_w ||' / ';
	end if;
	if (qt_hora14_w > 0) and ('14:00' >= hr_prim_turno_w) and ('14:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '14:00 - '||qt_hora14_w ||' / ';
	end if;
	if (qt_hora15_w > 0) and ('15:00' >= hr_prim_turno_w) and ('15:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '15:00 - '||qt_hora15_w ||' / ';
	end if;
	if (qt_hora16_w > 0) and ('16:00' >= hr_prim_turno_w) and ('16:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '16:00 - '||qt_hora16_w ||' / ';
	end if;
	if (qt_hora17_w > 0) and ('17:00' >= hr_prim_turno_w) and ('17:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '17:00 - '||qt_hora17_w ||' / ';
	end if;
	if (qt_hora18_w > 0) and ('18:00' >= hr_prim_turno_w) and ('18:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '18:00 - '||qt_hora18_w ||' / ';
	end if;
	if (qt_hora19_w > 0) and ('19:00' >= hr_prim_turno_w) and ('19:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '19:00 - '||qt_hora19_w ||' / ';
	end if;
	if (qt_hora20_w > 0) and ('20:00' >= hr_prim_turno_w) and ('20:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '20:00 - '||qt_hora20_w ||' / ';
	end if;
	if (qt_hora21_w > 0) and ('21:00' >= hr_prim_turno_w) and ('21:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '21:00 - '||qt_hora21_w ||' / ';
	end if;
	if (qt_hora22_w > 0) and ('22:00' >= hr_prim_turno_w) and ('22:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '22:00 - '||qt_hora22_w ||' / ';
	end if;
	if (qt_hora23_w > 0) and ('23:00' >= hr_prim_turno_w) and ('23:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '23:00 - '||qt_hora23_w ||' / ';
	end if;
	if (qt_hora00_w > 0) and ('24:00' >= hr_prim_turno_w) and ('24:00' < coalesce(hr_seg_turno_w,hr_ter_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '24:00 - '||qt_hora00_w ||' / ';
	end if;
	ds_retorno_w	:= wheb_mensagem_pck.get_texto(309282) || ' '||qt_manha_w ||' / '||ds_horario_tot_w; -- Manhã 
elsif (ie_turno_p = 2) and (hr_seg_turno_w IS NOT NULL AND hr_seg_turno_w::text <> '') then
	if (qt_hora01_w > 0) and 
		(('01:00' >= hr_seg_turno_w AND '01:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('01:00' >= hr_seg_turno_w) or ('01:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= '01:00 - '||qt_hora01_w ||' / ';
	end if;
	if (qt_hora02_w > 0) and 
		(('02:00' >= hr_seg_turno_w AND '02:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('02:00' >= hr_seg_turno_w) or ('02:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '02:00 - '||qt_hora02_w ||' / ';
	end if;
	if (qt_hora03_w > 0) and 
		(('03:00' >= hr_seg_turno_w AND '03:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('03:00' >= hr_seg_turno_w) or ('03:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '03:00 - '||qt_hora03_w ||' / ';
	end if;	
	if (qt_hora04_w > 0) and 
		(('04:00' >= hr_seg_turno_w AND '04:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('04:00' >= hr_seg_turno_w) or ('04:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '04:00 - '||qt_hora04_w ||' / ';
	end if;
	if (qt_hora05_w > 0) and 
		(('05:00' >= hr_seg_turno_w AND '05:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('05:00' >= hr_seg_turno_w) or ('05:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '05:00 - '||qt_hora05_w ||' / ';
	end if;
	if (qt_hora06_w > 0) and 
		(('06:00' >= hr_seg_turno_w AND '06:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('06:00' >= hr_seg_turno_w) or ('06:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '06:00 - '||qt_hora06_w ||' / ';
	end if;
	if (qt_hora07_w > 0) and 
		(('07:00' >= hr_seg_turno_w AND '07:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('07:00' >= hr_seg_turno_w) or ('07:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '07:00 - '||qt_hora07_w ||' / ';
	end if;
	if (qt_hora08_w > 0) and 
		(('08:00' >= hr_seg_turno_w AND '08:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('08:00' >= hr_seg_turno_w) or ('08:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '08:00 - '||qt_hora08_w ||' / ';
	end if;
	if (qt_hora09_w > 0) and 
		(('09:00' >= hr_seg_turno_w AND '09:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('09:00' >= hr_seg_turno_w) or ('09:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '09:00 - '||qt_hora09_w ||' / ';
	end if;
	if (qt_hora10_w > 0) and 
		(('10:00' >= hr_seg_turno_w AND '10:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('10:00' >= hr_seg_turno_w) or ('10:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '10:00 - '||qt_hora10_w ||' / ';
	end if;
	if (qt_hora11_w > 0) and 
		(('11:00' >= hr_seg_turno_w AND '11:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('11:00' >= hr_seg_turno_w) or ('11:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '11:00 - '||qt_hora11_w ||' / ';
	end if;
	if (qt_hora12_w > 0) and 
		(('12:00' >= hr_seg_turno_w AND '12:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('12:00' >= hr_seg_turno_w) or ('22:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '12:00 - '||qt_hora12_w ||' / ';
	end if;
	if (qt_hora13_w > 0) and 
		(('13:00' >= hr_seg_turno_w AND '13:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('13:00' >= hr_seg_turno_w) or ('13:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '13:00 - '||qt_hora13_w ||' / ';
	end if;
	if (qt_hora14_w > 0) and 
		(('14:00' >= hr_seg_turno_w AND '14:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('14:00' >= hr_seg_turno_w) or ('14:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '14:00 - '||qt_hora14_w ||' / ';
	end if;
	if (qt_hora15_w > 0) and 
		(('15:00' >= hr_seg_turno_w AND '15:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('15:00' >= hr_seg_turno_w) or ('15:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '15:00 - '||qt_hora15_w ||' / ';
	end if;
	if (qt_hora16_w > 0) and 
		(('16:00' >= hr_seg_turno_w AND '16:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('16:00' >= hr_seg_turno_w) or ('16:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '16:00 - '||qt_hora16_w ||' / ';
	end if;
	if (qt_hora17_w > 0) and 
		(('17:00' >= hr_seg_turno_w AND '17:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('17:00' >= hr_seg_turno_w) or ('17:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '17:00 - '||qt_hora17_w ||' / ';
	end if;
	if (qt_hora18_w > 0) and 
		(('18:00' >= hr_seg_turno_w AND '18:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('18:00' >= hr_seg_turno_w) or ('18:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '18:00 - '||qt_hora18_w ||' / ';
	end if;
	if (qt_hora19_w > 0) and 
		(('19:00' >= hr_seg_turno_w AND '19:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('19:00' >= hr_seg_turno_w) or ('19:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '19:00 - '||qt_hora19_w ||' / ';
	end if;
	if (qt_hora20_w > 0) and 
		(('20:00' >= hr_seg_turno_w AND '20:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('20:00' >= hr_seg_turno_w) or ('20:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '20:00 - '||qt_hora20_w ||' / ';
	end if;
	if (qt_hora21_w > 0) and 
		(('21:00' >= hr_seg_turno_w AND '21:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('22:00' >= hr_seg_turno_w) or ('22:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '21:00 - '||qt_hora21_w ||' / ';
	end if;
	if (qt_hora22_w > 0) and 
		(('22:00' >= hr_seg_turno_w AND '22:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('22:00' >= hr_seg_turno_w) or ('22:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '22:00 - '||qt_hora22_w ||' / ';
	end if;
	if (qt_hora23_w > 0) and 
		(('23:00' >= hr_seg_turno_w AND '23:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('23:00' >= hr_seg_turno_w) or ('23:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '23:00 - '||qt_hora23_w ||' / ';
	end if;
	if (qt_hora00_w > 0) and 
		(('24:00' >= hr_seg_turno_w AND '24:00' < hr_ter_turno_w) or 
		 ((coalesce(hr_ter_turno_w::text, '') = '') and 
		 (('24:00' >= hr_seg_turno_w) or ('24:00' < hr_prim_turno_w)))) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '24:00 - '||qt_hora00_w ||' / ';
	end if;
	ds_retorno_w	:= wheb_mensagem_pck.get_texto(309281) || ' '||qt_tarde_w ||' / '||ds_horario_tot_w; -- Tarde 
	
elsif (ie_turno_p = 3) and (hr_ter_turno_w IS NOT NULL AND hr_ter_turno_w::text <> '') then 
	if (qt_hora01_w > 0) and 
		(('01:00' >= hr_ter_turno_w) or ('01:00' < hr_prim_turno_w)) then 
		ds_horario_tot_w	:= '01:00 - '||qt_hora01_w ||' / ';
	end if;
	if (qt_hora02_w > 0) and 
		(('02:00' >= hr_ter_turno_w) or ('02:00' < hr_prim_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '02:00 - '||qt_hora02_w ||' / ';
	end if;
	if (qt_hora03_w > 0) and 
		(('03:00' >= hr_ter_turno_w) or ('03:00' < hr_prim_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '03:00 - '||qt_hora03_w ||' / ';
	end if;	
	if (qt_hora04_w > 0) and 
		(('04:00' >= hr_ter_turno_w) or ('04:00' < hr_prim_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '04:00 - '||qt_hora04_w ||' / ';
	end if;
	if (qt_hora05_w > 0) and 
		(('05:00' >= hr_ter_turno_w) or ('05:00' < hr_prim_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '05:00 - '||qt_hora05_w ||' / ';
	end if;
	if (qt_hora06_w > 0) and 
		(('06:00' >= hr_ter_turno_w) or ('06:00' < hr_prim_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '06:00 - '||qt_hora06_w ||' / ';
	end if;
	if (qt_hora07_w > 0) and 
		(('07:00' >= hr_ter_turno_w) or ('07:00' < hr_prim_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '07:00 - '||qt_hora07_w ||' / ';
	end if;
	if (qt_hora08_w > 0) and 
		(('08:00' >= hr_ter_turno_w) or ('08:00' < hr_prim_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '08:00 - '||qt_hora08_w ||' / ';
	end if;
	if (qt_hora09_w > 0) and 
		(('09:00' >= hr_ter_turno_w) or ('09:00' < hr_prim_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '09:00 - '||qt_hora09_w ||' / ';
	end if;
	if (qt_hora10_w > 0) and 
		(('10:00' >= hr_ter_turno_w) or ('10:00' < hr_prim_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '10:00 - '||qt_hora10_w ||' / ';
	end if;
	if (qt_hora11_w > 0) and 
		(('11:00' >= hr_ter_turno_w) or ('11:00' < hr_prim_turno_w)) then 
		ds_horario_tot_w	:= ds_horario_tot_w || '11:00 - '||qt_hora11_w ||' / ';
	end if;
	if (qt_hora12_w > 0) and 
		(('12:00' >= hr_ter_turno_w) or ('12:00' < hr_prim_turno_w)) then 
		ds_horario_tot2_w	:= ds_horario_tot2_w || '12:00 - '||qt_hora12_w ||' / ';
	end if;
	if (qt_hora13_w > 0) and 
		(('13:00' >= hr_ter_turno_w) or ('13:00' < hr_prim_turno_w)) then 
		ds_horario_tot2_w	:= ds_horario_tot2_w || '13:00 - '||qt_hora13_w ||' / ';
	end if;
	if (qt_hora14_w > 0) and 
		(('14:00' >= hr_ter_turno_w) or ('14:00' < hr_prim_turno_w)) then 
		ds_horario_tot2_w	:= ds_horario_tot2_w || '14:00 - '||qt_hora14_w ||' / ';
	end if;
	if (qt_hora15_w > 0) and 
		(('15:00' >= hr_ter_turno_w) or ('15:00' < hr_prim_turno_w)) then 
		ds_horario_tot2_w	:= ds_horario_tot2_w || '15:00 - '||qt_hora15_w ||' / ';
	end if;
	if (qt_hora16_w > 0) and 
		(('16:00' >= hr_ter_turno_w) or ('16:00' < hr_prim_turno_w)) then 
		ds_horario_tot2_w	:= ds_horario_tot2_w || '16:00 - '||qt_hora16_w ||' / ';
	end if;
	if (qt_hora17_w > 0) and 
		(('17:00' >= hr_ter_turno_w) or ('17:00' < hr_prim_turno_w)) then 
		ds_horario_tot2_w	:= ds_horario_tot2_w || '17:00-'||qt_hora17_w ||' / ';
	end if;
	if (qt_hora18_w > 0) and 
		(('18:00' >= hr_ter_turno_w) or ('18:00' < hr_prim_turno_w)) then 
		ds_horario_tot2_w	:= ds_horario_tot2_w || '18:00 - '||qt_hora18_w ||' / ';
	end if;
	if (qt_hora19_w > 0) and 
		(('19:00' >= hr_ter_turno_w) or ('19:00' < hr_prim_turno_w)) then 
		ds_horario_tot2_w	:= ds_horario_tot2_w || '19:00 - '||qt_hora19_w ||' / ';
	end if;
	if (qt_hora20_w > 0) and 
		(('20:00' >= hr_ter_turno_w) or ('20:00' < hr_prim_turno_w)) then 
		ds_horario_tot2_w	:= ds_horario_tot2_w || '20:00 - '||qt_hora20_w ||' / ';
	end if;
	if (qt_hora21_w > 0) and 
		(('21:00' >= hr_ter_turno_w) or ('21:00' < hr_prim_turno_w)) then 
		ds_horario_tot2_w	:= ds_horario_tot2_w || '21:00 - '||qt_hora21_w ||' / ';
	end if;
	if (qt_hora22_w > 0) and 
		(('22:00' >= hr_ter_turno_w) or ('22:00' < hr_prim_turno_w)) then 
		ds_horario_tot2_w	:= ds_horario_tot2_w || '22:00 - '||qt_hora22_w ||' / ';
	end if;
	if (qt_hora23_w > 0) and 
		(('23:00' >= hr_ter_turno_w) or ('23:00' < hr_prim_turno_w)) then 
		ds_horario_tot2_w	:= ds_horario_tot2_w || '23:00 - '||qt_hora23_w ||' / ';
	end if;
	if (qt_hora00_w > 0) and 
		(('24:00' >= hr_ter_turno_w) or ('24:00' < hr_prim_turno_w)) then 
		ds_horario_tot2_w	:= ds_horario_tot2_w || '24:00 - '||qt_hora00_w ||' / ';
	end if;
	if (ds_horario_tot2_w IS NOT NULL AND ds_horario_tot2_w::text <> '') then 
		ds_horario_tot_w	:= ds_horario_tot2_w ||ds_horario_tot_w;
	end if;
	ds_retorno_w	:= wheb_mensagem_pck.get_texto(309280) || ' '||qt_noite_w ||' / '||ds_horario_tot_w; -- Noite 
end if;
ds_retorno_w	:= replace(replace(ds_retorno_w,' .',' 0,'),'-,','- 0,');
 
return ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_quant_turno_sep_hor (nr_prescricao_p bigint, cd_material_p bigint, ie_turno_p bigint) FROM PUBLIC;

