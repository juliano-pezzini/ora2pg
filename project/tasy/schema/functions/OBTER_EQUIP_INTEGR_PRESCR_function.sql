-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_equip_integr_prescr ( cd_exame_equip_p text, ds_sigla_p text, nr_prescricao_p bigint, nr_seq_grupo_p bigint, nr_seq_lab_p text, ie_opcao_p bigint) RETURNS varchar AS $body$
DECLARE

/*
	1 - Exame
	2 - Equipamento
*/
cd_equipamento_w	integer;
nr_seq_exame_w		bigint;
resultado_w		varchar(20);


BEGIN

SELECT 	coalesce(MAX(a.nr_seq_exame),NULL),
	coalesce(MAX(a.cd_equipamento),NULL)
INTO STRICT	nr_seq_exame_w,
	cd_equipamento_w
FROM	equipamento_lab b,
	lab_exame_equip a,
	exame_laboratorio d,
	prescr_procedimento c
WHERE	a.cd_equipamento = b.cd_equipamento
AND	a.nr_seq_exame = c.nr_seq_exame
and	c.nr_seq_lab = nr_seq_lab_p
and	d.nr_seq_exame = a.nr_seq_exame
and	d.nr_seq_grupo = nr_seq_grupo_p
AND	a.cd_exame_equip = cd_exame_equip_p
AND	b.ds_sigla	 = ds_sigla_p
and	c.nr_prescricao = nr_prescricao_p;

IF (ie_opcao_p = 1) THEN
	resultado_w := nr_seq_exame_w;
ELSIF (ie_opcao_p = 2) THEN
	resultado_w := cd_equipamento_w;

END IF;

RETURN resultado_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_equip_integr_prescr ( cd_exame_equip_p text, ds_sigla_p text, nr_prescricao_p bigint, nr_seq_grupo_p bigint, nr_seq_lab_p text, ie_opcao_p bigint) FROM PUBLIC;

