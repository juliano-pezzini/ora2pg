-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_volume_aspirado ( nr_seq_ordem_p bigint) RETURNS bigint AS $body$
DECLARE


qt_volume_aspirado_w	can_ordem_prod.qt_volume_aspirado%type;


BEGIN

select 	max(obter_conversao_unid_med_cons(c.cd_material,obter_material_ordem_prod(a.nr_sequencia,'U'), obter_material_ordem_prod(a.nr_sequencia,'D')) * coalesce(d.qt_conversao,0)) qt_volume_aspirado
into STRICT	qt_volume_aspirado_w
FROM material_conversao_unidade d, can_ordem_prod a, obter_material_ordem_prod(a
LEFT OUTER JOIN material c ON (obter_material_ordem_prod(a.nr_sequencia,'C') = c.cd_material)
WHERE a.nr_sequencia = nr_seq_ordem_p and upper(d.cd_unidade_medida) = upper(obter_unid_med_usua('ML')) and c.cd_material = d.cd_material;

--qt_volume_aspirado_w := (qt_dose_p * obter_conversao_unid_med_cons(cd_material_p,cd_unidade_medida_p,qt_dose_p)) + volume_diluente_p;
return	qt_volume_aspirado_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_volume_aspirado ( nr_seq_ordem_p bigint) FROM PUBLIC;

