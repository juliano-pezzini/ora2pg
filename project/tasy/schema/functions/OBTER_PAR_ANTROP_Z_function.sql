-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_par_antrop_z (nr_atendimento_p bigint, ie_tipo_p text, peso_p bigint, altura_p bigint, dt_registro_p timestamp, anos_p bigint default null, meses_p bigint default null, qt_imc_p bigint default null, qt_circ_braco_p bigint default null, qt_prega_cut_tricip_p bigint default null) RETURNS varchar AS $body$
DECLARE


ds_retorno_w 	varchar(255);
anos_w		bigint;
meses_w		bigint;
parametro_p	bigint;
nr_sequencia_w	bigint;
c01	  	integer;
retorno_w	integer;

QT_SD_MENOS_3_W		real;
QT_SD_MENOS_2_W		real;
QT_SD_MENOS_1_W		real;
QT_MEDIA_W			real;
QT_SD_MAIS_1_W		real;
QT_SD_MAIS_2_W		real;
QT_SD_MAIS_3_W		real;

ie_valor_inicio_w	varchar(20);
ie_valor_final_w	varchar(20);
ie_valor_igual_w	varchar(20);

param_valor_attribute_w double precision;


BEGIN

	SELECT * FROM Obter_score_z(nr_atendimento_p, ie_tipo_p, peso_p, altura_p, dt_registro_p, anos_p, meses_p, qt_imc_p, qt_circ_braco_p, qt_prega_cut_tricip_p, QT_SD_MENOS_3_W, QT_SD_MENOS_2_W, QT_SD_MENOS_1_W, QT_MEDIA_W, QT_SD_MAIS_1_W, QT_SD_MAIS_2_W, QT_SD_MAIS_3_W) INTO STRICT QT_SD_MENOS_3_W, QT_SD_MENOS_2_W, QT_SD_MENOS_1_W, QT_MEDIA_W, QT_SD_MAIS_1_W, QT_SD_MAIS_2_W, QT_SD_MAIS_3_W;

	if (param_valor_attribute_w >= QT_SD_MAIS_3_W)then
		ie_valor_final_w:= '3';

		if (param_valor_attribute_w = QT_SD_MAIS_3_W) then
			ie_valor_igual_w := '3';
		end if;

	elsif (param_valor_attribute_w >= QT_SD_MAIS_2_W) then
		ie_valor_inicio_w := '2';
		ie_valor_final_w := '3';

		if (param_valor_attribute_w = QT_SD_MAIS_2_W) then
			ie_valor_igual_w := '2';
		end if;

	elsif (param_valor_attribute_w >= QT_SD_MAIS_1_W) then
		ie_valor_inicio_w := '1';
		ie_valor_final_w := '2';

		if (param_valor_attribute_w = QT_SD_MAIS_1_W) then
			ie_valor_igual_w := '1';
		end if;

	elsif (param_valor_attribute_w >= qt_media_w) then
		ie_valor_inicio_w := 'Media';
		ie_valor_final_w := '1';

		if (param_valor_attribute_w = qt_media_w) then
			ie_valor_igual_w := 'Media';
		end if;

	elsif (param_valor_attribute_w >= QT_SD_MENOS_1_W) then
		ie_valor_inicio_w := '-1';
		ie_valor_final_w := 'Media';

		if (param_valor_attribute_w = QT_SD_MENOS_1_W) then
			ie_valor_igual_w := '-1';
		end if;

	elsif (param_valor_attribute_w >= QT_SD_MENOS_2_W)then
		ie_valor_inicio_w := '-2';
		ie_valor_final_w := '-1';

		if (param_valor_attribute_w = QT_SD_MENOS_2_W) then
			ie_valor_igual_w := '-2';
		end if;

	elsif (param_valor_attribute_w >= QT_SD_MENOS_3_W) then
		ie_valor_inicio_w := '-3';
		ie_valor_final_w := '-2';

		if (param_valor_attribute_w = QT_SD_MENOS_3_W) then
			ie_valor_igual_w := '-3';
		end if;

	else
		ie_valor_inicio_w := '-3';
	end if;


	if (ie_valor_igual_w IS NOT NULL AND ie_valor_igual_w::text <> '') then
		ds_retorno_w := obter_desc_expressao(1046822,'Escore Z')||' '|| ie_valor_igual_w;
	elsif (ie_valor_inicio_w IS NOT NULL AND ie_valor_inicio_w::text <> '') and (ie_valor_final_w IS NOT NULL AND ie_valor_final_w::text <> '') then
		ds_retorno_w := obter_desc_expressao(1046822,'Escore Z')||' '|| obter_desc_expressao(763609,'entre')||' '||ie_valor_inicio_w ||' '||  obter_desc_expressao(312342,'e') ||' '||ie_valor_final_w;
	elsif ( coalesce(ie_valor_inicio_w::text, '') = '') and (ie_valor_final_w IS NOT NULL AND ie_valor_final_w::text <> '') then
		ds_retorno_w := obter_desc_expressao(1046822,'Escore Z')||' '|| lower(obter_desc_expressao(724788,'maior que'))||' '||ie_valor_final_w;
	elsif (ie_valor_inicio_w IS NOT NULL AND ie_valor_inicio_w::text <> '') and ( coalesce(ie_valor_final_w::text, '') = '') then
		ds_retorno_w := obter_desc_expressao(1046822,'Escore Z')||' '|| lower(obter_desc_expressao(498433,'menor que'))||' '||ie_valor_inicio_w;
	end if;

	/*elsif (ie_tipo_p = 'ZMC') then
		if (qt_imc_p >= QT_SD_MENOS_3_W) and (qt_imc_p < QT_SD_MENOS_2_W) then
			ds_retorno_w := obter_desc_expressao(783088,'Magreza');
	   elsif (qt_imc_p < QT_SD_MENOS_3_W) then
	        ds_retorno_w := obter_desc_expressao(1047103,'Magreza acentuada');
		elsif (qt_imc_p >= QT_SD_MENOS_2_W) and (qt_imc_p < QT_SD_MENOS_1_W) then
			ds_retorno_w := obter_desc_expressao(347463,'Eutrofia');
			elsif (anos_w <= 5) and (qt_imc_p > QT_SD_MAIS_1_W) and (qt_imc_p <= QT_SD_MAIS_2_W) then
				ds_retorno_w := obter_desc_expressao(783090,'Risco de sobrepeso');
		elsif (qt_imc_p >= QT_SD_MENOS_1_W) and (qt_imc_p <= QT_SD_MAIS_1_W) then
			ds_retorno_w := obter_desc_expressao(347463,'Eutrofia');
			elsif (qt_imc_p > QT_SD_MAIS_1_W) and (qt_imc_p <= QT_SD_MAIS_3_W) then
				ds_retorno_w := obter_desc_expressao(488188,'Sobrepeso');
		elsif (qt_imc_p > QT_SD_MAIS_2_W) and (qt_imc_p <= QT_SD_MAIS_3_W) then
			ds_retorno_w := obter_desc_expressao(294557,'Obesidade');
		elsif (anos_w > 5) and (qt_imc_p > QT_SD_MAIS_3_W) then
			ds_retorno_w := obter_desc_expressao(783092,'Obesidade grave');
		end if;

	end if;		*/
return ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_par_antrop_z (nr_atendimento_p bigint, ie_tipo_p text, peso_p bigint, altura_p bigint, dt_registro_p timestamp, anos_p bigint default null, meses_p bigint default null, qt_imc_p bigint default null, qt_circ_braco_p bigint default null, qt_prega_cut_tricip_p bigint default null) FROM PUBLIC;

