-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';



CREATE TYPE Doses AS (ds_dose		varchar(255));


CREATE OR REPLACE FUNCTION obter_valores_etapa (nr_prescricao_p bigint, nr_sequencia_p bigint, nr_etapa_p bigint) RETURNS varchar AS $body$
DECLARE

type VetDose is table of Doses index by integer;
Etapas_w		VetDose;
i			integer := 0;
x			integer := 0;
ds_dose_dif_w		varchar(255);
ds_valor_w		varchar(25);




BEGIN


Select	ds_dose_diferenciada
into STRICT	ds_dose_dif_w
from	prescr_material
where	nr_prescricao		= nr_prescricao_p
and	nr_sequencia		= nr_sequencia_p;


Etapas_w[i].ds_dose	:= ds_dose_dif_w||'-';



For i in 1.. nr_etapa_p LOOP
	begin

	ds_valor_w	:= '';

	select	substr(Etapas_w[x].ds_dose, 1, position('-' in Etapas_w[x].ds_dose) - 1)
	into STRICT	ds_valor_w
	;

	Etapas_w[x].ds_dose	:= substr(Etapas_w[x].ds_dose, position('-' in Etapas_w[x].ds_dose) + 1, length(Etapas_w[x].ds_dose));

	end;
END LOOP;

return ds_valor_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_valores_etapa (nr_prescricao_p bigint, nr_sequencia_p bigint, nr_etapa_p bigint) FROM PUBLIC;

