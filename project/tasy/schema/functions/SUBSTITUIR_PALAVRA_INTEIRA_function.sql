-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION substituir_palavra_inteira ( ds_texto_p text, ds_procurar_p text, ds_substituir_p text) RETURNS varchar AS $body$
DECLARE


ds_procurar_w				varchar(4000);
ds_retorno_w				varchar(4000);
ds_texto_w				varchar(4000);
ie_pos_w				bigint;
qt_ocorrencia_w				bigint;
qt_tam_w				bigint;
ie_caracter_ant_w			varchar(1);
ie_caracter_pos_w			varchar(1);

/*
Function utilizada nos cÃ¡lculos do demonstrativo da Contabilidade

*/
BEGIN

ds_texto_w	:= ds_texto_p;
ds_procurar_w	:= ds_procurar_p;

ie_pos_w	:= coalesce(position(ds_procurar_w in ds_texto_p),0);
qt_tam_w	:= coalesce(length(ds_procurar_w),0);
qt_ocorrencia_w	:= 1;
while(ie_pos_w > 0) and (qt_tam_w > 0) loop
	begin
	qt_ocorrencia_w		:= qt_ocorrencia_w + 1;
	ie_caracter_ant_w	:= '';
	if (ie_pos_w > 1) then
		ie_caracter_ant_w	:= substr(ds_texto_w,ie_pos_w-1,1);
	end if;
	ie_caracter_pos_w	:= substr(ds_texto_w,(ie_pos_w+qt_tam_w),1);

	if (coalesce(ie_caracter_ant_w,'+') in (chr(32),'(','+','-','/','*','[','{')) and (coalesce(ie_caracter_pos_w,'+') in (chr(32),')','+','-','/','*',']','}')) then
		ds_texto_w	:= 	substr(substr(ds_texto_w,1,ie_pos_w-1) ||
					replace(substr(ds_texto_w,ie_pos_w,qt_tam_w),ds_procurar_w,ds_substituir_p) ||
					substr(ds_texto_w,(ie_pos_w+qt_tam_w),4000),1,4000);
	end if;

	ie_pos_w	:= coalesce(instr(ds_texto_w, ds_procurar_w,1,qt_ocorrencia_w),0);

	end;
end loop;

ds_retorno_w	:= ds_texto_w;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION substituir_palavra_inteira ( ds_texto_p text, ds_procurar_p text, ds_substituir_p text) FROM PUBLIC;

