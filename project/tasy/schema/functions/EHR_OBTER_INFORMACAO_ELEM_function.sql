-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION ehr_obter_informacao_elem (nr_atendimento_p bigint, cd_pessoa_fisica_p text, nr_seq_template_p bigint) RETURNS varchar AS $body$
DECLARE

 
cd_empresa_w			smallint;
cd_estabelecimento_w		smallint;
cd_pessoa_fisica_w		varchar(10);
nm_atributo_w			varchar(50);
ds_retorno_w			varchar(2000)	:= '';
ds_valor_atrib_w		varchar(255);
ds_valor_atrib2_w		varchar(255);
ie_informacao_w			varchar(15);
ie_origem_w			varchar(15);
nr_seq_elemento_w		bigint;
qt_resultado_w			varchar(4000);
pr_resultado_w			double precision;
qt_result_w			double precision;
pr_result_w			double precision;
qt_pa_sistolica_w		smallint;
qt_pa_diastolica_w		smallint;
qt_pam_w			smallint;
dt_resultado_w			timestamp;
dt_resultado_por_w		timestamp;
ie_atendimento_w		varchar(1);
ie_result_exame_w		varchar(15);
cd_classif_setor_w		varchar(2);
nr_seq_exame_w			bigint;
ds_diagnostico_w  		varchar(4000);
ds_resumo_cirurgia_w  	varchar(4000);
ds_diagnostico_pos_w  	varchar(4000);
ds_exame_rad_w  		varchar(4000);
ds_exame_anatomo_w  	varchar(4000);
ds_achados_operatorios_w  varchar(4000);

 
 
C01 CURSOR FOR 
	SELECT	c.ie_informacao, 
		d.ie_origem_inf, 
		b.nr_seq_elemento, 
		c.ie_result_exame, 
		coalesce(c.ie_atendimento,'S') 
	FROM	ehr_elemento d, 
		ehr_template_cont_inf c, 
		ehr_template_conteudo b, 
		ehr_template a 
	WHERE	a.nr_sequencia		= nr_seq_template_p 
	AND	a.nr_sequencia		= b.nr_seq_template 
	AND	b.nr_sequencia		= c.nr_seq_temp_conteudo 
	AND	b.nr_seq_elemento	= d.nr_sequencia 
	AND	((c.cd_estabelecimento	= cd_estabelecimento_w) OR (coalesce(c.cd_estabelecimento::text, '') = '')) 
	AND	(d.ie_origem_inf IS NOT NULL AND d.ie_origem_inf::text <> '');

c02 CURSOR FOR 
	SELECT 	b.qt_resultado, 
		b.pr_resultado, 
		a.dt_resultado 
	FROM 	exame_lab_result_item b, 
		exame_lab_resultado a, 
		prescr_procedimento x, 
		prescr_medica c 
	WHERE	a.nr_seq_resultado	= b.nr_seq_resultado 
	AND	a.nr_prescricao		= c.nr_prescricao 
	AND	x.nr_sequencia		= b.nr_seq_prescr 
	AND	x.nr_prescricao		= c.nr_prescricao 
	AND	b.nr_seq_exame		= nr_seq_exame_w 
	AND	((ie_atendimento_w = 'S' AND c.nr_atendimento = nr_atendimento_p) OR (ie_atendimento_w <> 'S') AND (c.cd_pessoa_fisica = cd_pessoa_fisica_p)) 
	AND (obter_classif_setor(c.cd_setor_atendimento)	= cd_classif_setor_w OR coalesce(cd_classif_setor_w::text, '') = '') 
	AND	x.ie_status_atend		>= 35 
	ORDER BY b.dt_aprovacao;

c03 CURSOR FOR 
	SELECT 	b.qt_resultado, 
		b.pr_resultado, 
		a.dt_resultado 
	FROM 	exame_lab_result_item b, 
		exame_lab_resultado a, 
		prescr_procedimento x, 
		prescr_medica c 
	WHERE	a.nr_seq_resultado	= b.nr_seq_resultado 
	AND	a.nr_prescricao		= c.nr_prescricao 
	AND	x.nr_sequencia		= b.nr_seq_prescr 
	AND	x.nr_prescricao		= c.nr_prescricao 
	AND	b.nr_seq_exame		= nr_seq_exame_w 
	AND	((ie_atendimento_w = 'S' AND c.nr_atendimento = nr_atendimento_p) OR (ie_atendimento_w <> 'S') AND (c.cd_pessoa_fisica = cd_pessoa_fisica_p)) 
	AND (obter_classif_setor(c.cd_setor_atendimento)	= cd_classif_setor_w OR coalesce(cd_classif_setor_w::text, '') = '') 
	AND	x.ie_status_atend	>= 35 
	ORDER BY b.dt_aprovacao DESC;
	
c04 CURSOR FOR 
	SELECT	a.qt_pa_sistolica, 
		a.qt_pa_diastolica, 
		a.qt_pam 
	FROM	atendimento_sinal_vital a 
	WHERE	(a.qt_pa_sistolica IS NOT NULL AND a.qt_pa_sistolica::text <> '') 
	AND	(a.qt_pa_diastolica IS NOT NULL AND a.qt_pa_diastolica::text <> '') 
	AND	(a.qt_pam IS NOT NULL AND a.qt_pam::text <> '') 
	AND (ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) OR (ie_atendimento_w = 'N' AND EXISTS (	SELECT	1 
							FROM	atendimento_paciente b 
							WHERE	b.nr_atendimento	= a.nr_atendimento 
							AND	b.cd_pessoa_fisica	= cd_pessoa_fisica_p)) 
	ORDER BY a.qt_pa_sistolica, 
		a.qt_pa_diastolica;

c05 CURSOR FOR 
	SELECT	a.qt_pa_sistolica, 
		a.qt_pa_diastolica, 
		a.qt_pam 
	FROM	atendimento_sinal_vital a 
	WHERE	(a.qt_pa_sistolica IS NOT NULL AND a.qt_pa_sistolica::text <> '') 
	AND	(a.qt_pa_diastolica IS NOT NULL AND a.qt_pa_diastolica::text <> '') 
	AND	(a.qt_pam IS NOT NULL AND a.qt_pam::text <> '') 
	AND (ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) OR (ie_atendimento_w = 'N' AND EXISTS (	SELECT	1 
							FROM	atendimento_paciente b 
							WHERE	b.nr_atendimento	= a.nr_atendimento 
							AND	b.cd_pessoa_fisica	= cd_pessoa_fisica_p)) 
	ORDER BY a.qt_pa_sistolica DESC, 
		a.qt_pa_diastolica DESC;
	
c06 CURSOR FOR 
	SELECT 	b.qt_resultado, 
		a.dt_resultado 
	FROM 	exame_lab_result_item b, 
		exame_lab_resultado a, 
		prescr_procedimento x, 
		prescr_medica c 
	WHERE	a.nr_seq_resultado	= b.nr_seq_resultado 
	AND	a.nr_prescricao		= c.nr_prescricao 
	AND	x.nr_sequencia		= b.nr_seq_prescr 
	AND	x.nr_prescricao		= c.nr_prescricao 
	AND	b.nr_seq_exame		= nr_seq_exame_w 
	AND	((ie_atendimento_w = 'S' AND c.nr_atendimento = nr_atendimento_p) OR (ie_atendimento_w <> 'S') AND (c.cd_pessoa_fisica = cd_pessoa_fisica_p)) 
	AND (obter_classif_setor(c.cd_setor_atendimento)	= cd_classif_setor_w OR coalesce(cd_classif_setor_w::text, '') = '') 
	AND	x.ie_status_atend	>= 35 
	ORDER BY b.qt_resultado DESC;
	
c07 CURSOR FOR 
	SELECT 	b.pr_resultado, 
		a.dt_resultado 
	FROM 	exame_lab_result_item b, 
		exame_lab_resultado a, 
		prescr_procedimento x, 
		prescr_medica c 
	WHERE	a.nr_seq_resultado	= b.nr_seq_resultado 
	AND	a.nr_prescricao		= c.nr_prescricao 
	AND	x.nr_sequencia		= b.nr_seq_prescr 
	AND	x.nr_prescricao		= c.nr_prescricao 
	AND	b.nr_seq_exame		= nr_seq_exame_w 
	AND	((ie_atendimento_w = 'S' AND c.nr_atendimento = nr_atendimento_p) OR (ie_atendimento_w <> 'S') AND (c.cd_pessoa_fisica = cd_pessoa_fisica_p)) 
	AND (obter_classif_setor(c.cd_setor_atendimento)	= cd_classif_setor_w OR coalesce(cd_classif_setor_w::text, '') = '') 
	AND	x.ie_status_atend	>= 35 
	ORDER BY b.pr_resultado DESC;

	 
c08 CURSOR FOR	 
	SELECT 	b.qt_resultado, 
		a.dt_resultado 
	FROM 	exame_lab_result_item b, 
		exame_lab_resultado a, 
		prescr_procedimento x, 
		prescr_medica c 
	WHERE	a.nr_seq_resultado	= b.nr_seq_resultado 
	AND	a.nr_prescricao		= c.nr_prescricao 
	AND	x.nr_sequencia		= b.nr_seq_prescr 
	AND	x.nr_prescricao		= c.nr_prescricao 
	AND	b.nr_seq_exame		= nr_seq_exame_w 
	AND	((ie_atendimento_w = 'S' AND c.nr_atendimento = nr_atendimento_p) OR (ie_atendimento_w <> 'S') AND (c.cd_pessoa_fisica = cd_pessoa_fisica_p)) 
	AND (obter_classif_setor(c.cd_setor_atendimento)	= cd_classif_setor_w OR coalesce(cd_classif_setor_w::text, '') = '') 
	AND	x.ie_status_atend	>= 35 
	ORDER BY qt_resultado;

c09 CURSOR FOR	 
	SELECT 	b.pr_resultado, 
		a.dt_resultado 
	FROM 	exame_lab_result_item b, 
		exame_lab_resultado a, 
		prescr_procedimento x, 
		prescr_medica c 
	WHERE	a.nr_seq_resultado	= b.nr_seq_resultado 
	AND	a.nr_prescricao		= c.nr_prescricao 
	AND	x.nr_sequencia		= b.nr_seq_prescr 
	AND	x.nr_prescricao		= c.nr_prescricao 
	AND	b.nr_seq_exame		= nr_seq_exame_w 
	AND	((ie_atendimento_w = 'S' AND c.nr_atendimento = nr_atendimento_p) OR (ie_atendimento_w <> 'S') AND (c.cd_pessoa_fisica = cd_pessoa_fisica_p)) 
	AND (obter_classif_setor(c.cd_setor_atendimento)	= cd_classif_setor_w OR coalesce(cd_classif_setor_w::text, '') = '') 
	AND	x.ie_status_atend	>= 35 
	ORDER BY pr_resultado;
	
	 
C10 CURSOR FOR 
	SELECT	a.DS_DIAGNOSTICO, 
			a.DS_RESUMO_CIRURGIA, 
			a.DS_DIAGNOSTICO_POS, 
			a.DS_EXAME_RAD, 
			a.DS_EXAME_ANATOMO, 
			a.DS_ACHADOS_OPERATORIOS 
	FROM	CIRURGIA_DESCRICAO a, 
			cirurgia b 
	WHERE	a.nr_cirurgia = b.nr_cirurgia 
	AND		b.nr_atendimento	= nr_atendimento_p;
	

BEGIN 
 
SELECT	MAX(cd_pessoa_fisica), 
	MAX(cd_estabelecimento) 
INTO STRICT	cd_pessoa_fisica_w, 
	cd_estabelecimento_w 
FROM	atendimento_paciente 
WHERE	nr_atendimento	= nr_atendimento_p;
 
SELECT	cd_empresa 
INTO STRICT	cd_empresa_w 
FROM	estabelecimento 
WHERE	cd_estabelecimento	= cd_estabelecimento_w;
 
OPEN	c01;
LOOP 
FETCH	c01 INTO 
	ie_informacao_w, 
	ie_origem_w, 
	nr_seq_elemento_w, 
	ie_result_exame_w, 
	ie_atendimento_w;
EXIT WHEN NOT FOUND; /* apply on c01 */	
	BEGIN	 
	IF (ie_origem_w = 'SV') THEN 
		BEGIN 
		IF (ie_informacao_w = 'Primeira') THEN 
			BEGIN 
			IF (nr_seq_elemento_w = 24) THEN 
 
				BEGIN 
 
 
				SELECT	MIN(a.qt_peso) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MIN(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.qt_peso IS NOT NULL AND b.qt_peso::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
 
				END;
 
			ELSIF (nr_seq_elemento_w = 25) THEN 
				BEGIN 
 
				SELECT	MIN(a.qt_altura_cm) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MIN(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.qt_altura_cm IS NOT NULL AND b.qt_altura_cm::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
													 
														 
				END;
 
			ELSIF (nr_seq_elemento_w = 26) THEN 
				BEGIN 
 
				SELECT	MIN(a.qt_imc) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MIN(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.qt_imc IS NOT NULL AND b.qt_imc::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
								 
													 
 
				END;
 
			ELSIF (nr_seq_elemento_w = 28) THEN 
 
				BEGIN 
 
				SELECT	MIN(a.qt_temp) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MIN(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.qt_temp IS NOT NULL AND b.qt_temp::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
 
				END;
 
			ELSIF (nr_seq_elemento_w = 30) THEN 
 
				BEGIN 
 
 
				SELECT	MIN(a.qt_freq_resp) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MIN(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.qt_freq_resp IS NOT NULL AND b.qt_freq_resp::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
 
				END;
 
			ELSIF (nr_seq_elemento_w = 31) THEN 
 
				BEGIN 
 
 
				SELECT	MIN(a.qt_pa_sistolica) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MIN(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.qt_pa_sistolica IS NOT NULL AND b.qt_pa_sistolica::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
 
				END;
 
			ELSIF (nr_seq_elemento_w = 33) THEN 
 
				BEGIN 
 
 
				SELECT	MIN(a.qt_freq_cardiaca) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MIN(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.qt_freq_cardiaca IS NOT NULL AND b.qt_freq_cardiaca::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
													 
				END;
 
			ELSIF (nr_seq_elemento_w = 32) THEN 
 
				BEGIN 
 
 
				SELECT	MIN(a.qt_pa_diastolica) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MIN(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.qt_pa_diastolica IS NOT NULL AND b.qt_pa_diastolica::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
 
				END;
 
			ELSIF (nr_seq_elemento_w = 43) THEN 
 
				BEGIN 
 
 
				SELECT	MIN(a.qt_superf_corporia) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MIN(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.qt_superf_corporia IS NOT NULL AND b.qt_superf_corporia::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
 
				END;
 
			ELSIF (nr_seq_elemento_w = 761) THEN 
 
				BEGIN 
 
 
				SELECT	MIN(a.qt_glicemia_capilar) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MIN(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.qt_glicemia_capilar IS NOT NULL AND b.qt_glicemia_capilar::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
	 
				END;	
 
			ELSIF (nr_seq_elemento_w = 1092) THEN 
 
				BEGIN 
 
				SELECT	MIN(a.QT_SATURACAO_O2) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MIN(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.QT_SATURACAO_O2 IS NOT NULL AND b.QT_SATURACAO_O2::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
 
 
				END;
 
			END IF;
 
			END;
 
		ELSIF (ie_informacao_w = 'Ultima') THEN 
 
			BEGIN 
 
			IF (nr_seq_elemento_w = 24) THEN 
 
				BEGIN 
 
 
				SELECT	MAX(a.qt_peso) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MAX(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.qt_peso IS NOT NULL AND b.qt_peso::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
														 
 
				END;
 
			ELSIF (nr_seq_elemento_w = 25) THEN 
 
				BEGIN 
 
 
				SELECT	MAX(a.qt_altura_cm) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MAX(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.qt_altura_cm IS NOT NULL AND b.qt_altura_cm::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
 
				END;
 
			ELSIF (nr_seq_elemento_w = 26) THEN 
 
				BEGIN 
 
				SELECT	MAX(a.qt_imc) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MAX(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.qt_imc IS NOT NULL AND b.qt_imc::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
 
				END;
 
			ELSIF (nr_seq_elemento_w = 28) THEN 
 
				BEGIN 
 
 
				SELECT	MAX(a.qt_temp) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MAX(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.qt_temp IS NOT NULL AND b.qt_temp::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
 
				END;
 
			ELSIF (nr_seq_elemento_w = 30) THEN 
 
				BEGIN 
 
 
				SELECT	MAX(a.qt_freq_resp) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MAX(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.qt_freq_resp IS NOT NULL AND b.qt_freq_resp::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
 
				END;
 
			ELSIF (nr_seq_elemento_w = 31) THEN 
 
				BEGIN 
 
 
				SELECT	MAX(a.qt_pa_sistolica) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MAX(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.qt_pa_sistolica IS NOT NULL AND b.qt_pa_sistolica::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
 
				END;
 
			ELSIF (nr_seq_elemento_w = 33) THEN 
 
				BEGIN 
 
 
				SELECT	MAX(a.qt_freq_cardiaca) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MAX(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.qt_freq_cardiaca IS NOT NULL AND b.qt_freq_cardiaca::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
 
				END;
 
			ELSIF (nr_seq_elemento_w = 32) THEN 
 
				BEGIN 
 
 
				SELECT	MAX(a.qt_pa_diastolica) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MAX(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.qt_pa_diastolica IS NOT NULL AND b.qt_pa_diastolica::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
 
				END;
 
			ELSIF (nr_seq_elemento_w = 43) THEN 
 
				BEGIN 
 
 
				SELECT	MAX(a.qt_superf_corporia) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MAX(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.qt_superf_corporia IS NOT NULL AND b.qt_superf_corporia::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
 
				END;
 
			ELSIF (nr_seq_elemento_w = 761) THEN 
 
				BEGIN 
 
 
				SELECT	MAX(a.qt_glicemia_capilar) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MAX(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.qt_glicemia_capilar IS NOT NULL AND b.qt_glicemia_capilar::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
 
				END;	
 
			ELSIF (nr_seq_elemento_w = 1092) THEN 
 
				BEGIN 
 
 
				SELECT	MAX(a.QT_SATURACAO_O2) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a 
				WHERE	a.nr_sequencia	= (	SELECT	MAX(b.nr_sequencia) 
								FROM	atendimento_sinal_vital b, 
									atendimento_paciente c 
								WHERE	c.nr_atendimento = b.nr_atendimento 
								AND	(b.QT_SATURACAO_O2 IS NOT NULL AND b.QT_SATURACAO_O2::text <> '') 
								AND	((ie_atendimento_w = 'S' AND b.nr_atendimento = nr_atendimento_p) 
								OR (ie_atendimento_w = 'N' AND c.cd_pessoa_fisica	= cd_pessoa_fisica_p)));
 
 
				END;
 
			END IF;
 
			END;
 
		ELSIF (ie_informacao_w = 'Maior') THEN 
 
			BEGIN 
 
			IF (nr_seq_elemento_w = 24) THEN 
 
				BEGIN 
 
 
				SELECT	MAX(a.qt_peso) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a, 
					atendimento_paciente b 
				WHERE	b.nr_atendimento	= a.nr_atendimento 
				AND	(a.qt_peso IS NOT NULL AND a.qt_peso::text <> '') 
				AND	((ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) 
				OR (ie_atendimento_w = 'N' AND b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
										 
 
				END;
 
			ELSIF (nr_seq_elemento_w = 25) THEN 
 
				BEGIN 
 
				SELECT	MAX(a.qt_altura_cm) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a, 
					atendimento_paciente b 
				WHERE	b.nr_atendimento	= a.nr_atendimento 
				AND	(a.qt_altura_cm IS NOT NULL AND a.qt_altura_cm::text <> '') 
				AND	((ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) 
				OR (ie_atendimento_w = 'N' AND b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
 
				END;
 
			ELSIF (nr_seq_elemento_w = 26) THEN 
 
				BEGIN 
 
				SELECT	MAX(a.qt_imc) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a, 
					atendimento_paciente b 
				WHERE	b.nr_atendimento	= a.nr_atendimento 
				AND	(a.qt_imc IS NOT NULL AND a.qt_imc::text <> '') 
				AND	((ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) 
				OR (ie_atendimento_w = 'N' AND b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
 
				END;
 
			ELSIF (nr_seq_elemento_w = 28) THEN 
 
				BEGIN 
 
				SELECT	MAX(a.qt_temp) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a, 
					atendimento_paciente b 
				WHERE	b.nr_atendimento	= a.nr_atendimento 
				AND	(a.qt_temp IS NOT NULL AND a.qt_temp::text <> '') 
				AND	((ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) 
				OR (ie_atendimento_w = 'N' AND b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
 
				END;
 
			ELSIF (nr_seq_elemento_w = 30) THEN 
 
				BEGIN 
 
 
				SELECT	MAX(a.qt_freq_resp) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a, 
					atendimento_paciente b 
				WHERE	b.nr_atendimento	= a.nr_atendimento 
				AND	(a.qt_freq_resp IS NOT NULL AND a.qt_freq_resp::text <> '') 
				AND	((ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) 
				OR (ie_atendimento_w = 'N' AND b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
 
				END;
 
			ELSIF (nr_seq_elemento_w IN (31,32)) THEN 
 
				BEGIN 
 
				OPEN	c04;
 
				LOOP 
 
				FETCH	c04 INTO 
 
					qt_pa_sistolica_w, 
					qt_pa_diastolica_w, 
					qt_pam_w;
 
				EXIT WHEN NOT FOUND; /* apply on c04 */	
 
					BEGIN	 
 
					 
 
					qt_pa_sistolica_w	:= qt_pa_sistolica_w;
					qt_pa_diastolica_w	:= qt_pa_diastolica_w;
					qt_pam_w		:= qt_pam_w;
 
 
 
					END;
 
				END LOOP;
 
				CLOSE c04;
 
 
 
				IF (nr_seq_elemento_w = 31) THEN 
 
					qt_resultado_w	:= qt_pa_sistolica_w;
 
				ELSIF (nr_seq_elemento_w = 32) THEN 
 
					qt_resultado_w	:= qt_pa_diastolica_w;
 
				END IF;
 
 
 
				END;
 
			ELSIF (nr_seq_elemento_w = 33) THEN 
 
				BEGIN 
 
				SELECT	MAX(a.qt_freq_cardiaca) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a, 
					atendimento_paciente b 
				WHERE	b.nr_atendimento	= a.nr_atendimento 
				AND	(a.qt_freq_cardiaca IS NOT NULL AND a.qt_freq_cardiaca::text <> '') 
				AND	((ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) 
				OR (ie_atendimento_w = 'N' AND b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
 
				END;
 
			ELSIF (nr_seq_elemento_w = 43) THEN 
 
				BEGIN 
 
				SELECT	MAX(a.qt_superf_corporia) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a, 
					atendimento_paciente b 
				WHERE	b.nr_atendimento	= a.nr_atendimento 
				AND	(a.qt_superf_corporia IS NOT NULL AND a.qt_superf_corporia::text <> '') 
				AND	((ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) 
				OR (ie_atendimento_w = 'N' AND b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
 
				END;
 
			ELSIF (nr_seq_elemento_w = 761) THEN 
 
				BEGIN 
 
				SELECT	MAX(a.qt_glicemia_capilar) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a, 
					atendimento_paciente b 
				WHERE	b.nr_atendimento	= a.nr_atendimento 
				AND	(a.qt_glicemia_capilar IS NOT NULL AND a.qt_glicemia_capilar::text <> '') 
				AND	((ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) 
				OR (ie_atendimento_w = 'N' AND b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
 
				END;	
 
			ELSIF (nr_seq_elemento_w = 1092) THEN 
 
				BEGIN 
 
				SELECT	MAX(a.QT_SATURACAO_O2) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a, 
					atendimento_paciente b 
				WHERE	b.nr_atendimento	= a.nr_atendimento 
				AND	(a.QT_SATURACAO_O2 IS NOT NULL AND a.QT_SATURACAO_O2::text <> '') 
				AND	((ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) 
				OR (ie_atendimento_w = 'N' AND b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
 
				END;
 
			END IF;
 
			END;
 
		ELSIF (ie_informacao_w = 'Menor') THEN 
 
			BEGIN 
 
			IF (nr_seq_elemento_w = 24) THEN 
 
				BEGIN 
 
		 
				SELECT	MIN(a.qt_peso) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a, 
					atendimento_paciente b 
				WHERE	b.nr_atendimento	= a.nr_atendimento 
				AND	(a.qt_peso IS NOT NULL AND a.qt_peso::text <> '') 
				AND	((ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) 
				OR (ie_atendimento_w = 'N' AND b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
 
 
				END;
				 
			ELSIF (nr_seq_elemento_w = 25) THEN 
 
				BEGIN 
 
				 
				SELECT	MIN(a.qt_altura_cm) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a, 
					atendimento_paciente b 
				WHERE	b.nr_atendimento	= a.nr_atendimento 
				AND	(a.qt_altura_cm IS NOT NULL AND a.qt_altura_cm::text <> '') 
				AND	((ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) 
				OR (ie_atendimento_w = 'N' AND b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
	 
 
				END;
 
			ELSIF (nr_seq_elemento_w = 26) THEN 
 
				BEGIN 
 
				 
				SELECT	MIN(a.qt_imc) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a, 
					atendimento_paciente b 
				WHERE	b.nr_atendimento	= a.nr_atendimento 
				AND	(a.qt_imc IS NOT NULL AND a.qt_imc::text <> '') 
				AND	((ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) 
				OR (ie_atendimento_w = 'N' AND b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
	 
				END;
 
			ELSIF (nr_seq_elemento_w = 28) THEN 
 
				BEGIN 
 
				 
				SELECT	MIN(a.qt_temp) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a, 
					atendimento_paciente b 
				WHERE	b.nr_atendimento	= a.nr_atendimento 
				AND	(a.qt_temp IS NOT NULL AND a.qt_temp::text <> '') 
				AND	((ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) 
				OR (ie_atendimento_w = 'N' AND b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
	 
				END;
 
			ELSIF (nr_seq_elemento_w = 30) THEN 
 
				BEGIN 
 
				 
				SELECT	MIN(a.qt_freq_resp) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a, 
					atendimento_paciente b 
				WHERE	b.nr_atendimento	= a.nr_atendimento 
				AND	(a.qt_freq_resp IS NOT NULL AND a.qt_freq_resp::text <> '') 
				AND	((ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) 
				OR (ie_atendimento_w = 'N' AND b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
	 
				END;
 
			ELSIF (nr_seq_elemento_w IN (31,32)) THEN 
 
				BEGIN 
 
				OPEN	c05;
 
				LOOP 
 
				FETCH	c05 INTO 
 
					qt_pa_sistolica_w, 
					qt_pa_diastolica_w, 
					qt_pam_w;
 
				EXIT WHEN NOT FOUND; /* apply on c05 */	
 
					BEGIN					 
 
					qt_pa_sistolica_w	:= qt_pa_sistolica_w;
					qt_pa_diastolica_w	:= qt_pa_diastolica_w;
					qt_pam_w		:= qt_pam_w;
 
					END;
 
				END LOOP;
 
				CLOSE c05;
 
 
 
				IF (nr_seq_elemento_w = 31) THEN 
 
					qt_resultado_w	:= qt_pa_sistolica_w;
 
				ELSIF (nr_seq_elemento_w = 32) THEN 
 
					qt_resultado_w	:= qt_pa_diastolica_w;
 
				END IF;
 
 
 
				END;
 
			ELSIF (nr_seq_elemento_w = 33) THEN 
 
				BEGIN 
 
				 
				SELECT	MIN(a.qt_freq_cardiaca) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a, 
					atendimento_paciente b 
				WHERE	b.nr_atendimento	= a.nr_atendimento 
				AND	(a.qt_freq_cardiaca IS NOT NULL AND a.qt_freq_cardiaca::text <> '') 
				AND	((ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) 
				OR (ie_atendimento_w = 'N' AND b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
	 
				END;
 
			ELSIF (nr_seq_elemento_w = 43) THEN 
 
				BEGIN 
 
				 
				SELECT	MIN(a.qt_superf_corporia) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a, 
					atendimento_paciente b 
				WHERE	b.nr_atendimento	= a.nr_atendimento 
				AND	(a.qt_superf_corporia IS NOT NULL AND a.qt_superf_corporia::text <> '') 
				AND	((ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) 
				OR (ie_atendimento_w = 'N' AND b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
	 
				END;
 
			ELSIF (nr_seq_elemento_w = 761) THEN 
 
				BEGIN 
 
 
				SELECT	MIN(a.qt_glicemia_capilar) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a, 
					atendimento_paciente b 
				WHERE	b.nr_atendimento	= a.nr_atendimento 
				AND	(a.qt_glicemia_capilar IS NOT NULL AND a.qt_glicemia_capilar::text <> '') 
				AND	((ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) 
				OR (ie_atendimento_w = 'N' AND b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
	 
				END;
 
			ELSIF (nr_seq_elemento_w = 1092) THEN 
 
				BEGIN 
 
 
				SELECT	MIN(a.QT_SATURACAO_O2) 
				INTO STRICT	qt_resultado_w 
				FROM	atendimento_sinal_vital a, 
					atendimento_paciente b 
				WHERE	b.nr_atendimento	= a.nr_atendimento 
				AND	(a.QT_SATURACAO_O2 IS NOT NULL AND a.QT_SATURACAO_O2::text <> '') 
				AND	((ie_atendimento_w = 'S' AND a.nr_atendimento = nr_atendimento_p) 
				OR (ie_atendimento_w = 'N' AND b.cd_pessoa_fisica	= cd_pessoa_fisica_p));
 
				END;
 
			END IF;
 
			END;
 
		END IF;	
 
		END;
 
	ELSIF (ie_origem_w = 'EL') THEN 
 
		BEGIN 
 
		IF (ie_informacao_w = 'Primeira') THEN 
 
			BEGIN 
 
				 
 
			OPEN	c03;
 
			LOOP 
 
			FETCH	c03 INTO 
 
				qt_result_w, 
				pr_result_w, 
				dt_resultado_w;
 
			EXIT WHEN NOT FOUND; /* apply on c03 */	
 
				BEGIN	 
 
				IF (coalesce(qt_result_w,0) <> 0) THEN 
 
					qt_resultado_w	:= qt_result_w;
 
				END IF;				
 
				 
 
				IF (coalesce(pr_result_w,0) <> 0) THEN 
 
					pr_resultado_w	:= pr_result_w;
 
				END IF;		
 
					END;
 
			END LOOP;
 
			CLOSE c03;
 
			END;
 
		ELSIF (ie_informacao_w = 'Ultima') THEN 
 
			BEGIN 
 
			OPEN	c02;
 
			LOOP 
 
			FETCH	c02 INTO 
 
				qt_result_w, 
				pr_result_w, 
				dt_resultado_w;
 
			EXIT WHEN NOT FOUND; /* apply on c02 */	
 
				BEGIN	 
 
				IF (coalesce(qt_result_w,0) <> 0) THEN 
 
					qt_resultado_w	:= qt_result_w;
 
				END IF;				
 
				 
 
				IF (coalesce(pr_result_w,0) <> 0) THEN 
 
					pr_resultado_w	:= pr_result_w;
 
				END IF;		
 
					END;
 
			END LOOP;
 
			CLOSE c02;
 
			END;
 
		ELSIF (ie_informacao_w = 'Maior') THEN 
 
			BEGIN 
 
			OPEN C06;
 
			LOOP 
 
			FETCH C06 INTO	 
 
				qt_resultado_w, 
				dt_resultado_w;
 
			EXIT WHEN NOT FOUND; /* apply on C06 */
 
				BEGIN 
 
				qt_resultado_w	:= qt_resultado_w;
				dt_resultado_w	:= dt_resultado_w;
 
				EXIT;
 
				END;
 
			END LOOP;
 
			CLOSE C06;
			 
 
			OPEN C07;
 
			LOOP 
 
			FETCH C07 INTO	 
 
				qt_resultado_w, 
				dt_resultado_por_w;
 
			EXIT WHEN NOT FOUND; /* apply on C07 */
 
				BEGIN 
 
				qt_resultado_w		:= qt_resultado_w;
				dt_resultado_por_w	:= dt_resultado_por_w;
 
				EXIT;
 
				END;
 
			END LOOP;
 
			CLOSE C07;
 
			 
 
			END;
 
		ELSIF (ie_informacao_w = 'Menor') THEN 
 
			BEGIN 
 
	 
			OPEN C08;
 
			LOOP 
 
			FETCH C08 INTO	 
 
				qt_resultado_w, 
				dt_resultado_w;
 
			EXIT WHEN NOT FOUND; /* apply on C08 */
 
				BEGIN 
 
				qt_resultado_w	:= qt_resultado_w;
				dt_resultado_w	:= dt_resultado_w;
 
				EXIT;
 
				END;
 
			END LOOP;
 
			CLOSE C08;
 
			 
 
			OPEN C09;
 
			LOOP 
 
			FETCH C09 INTO	 
 
				qt_resultado_w, 
				dt_resultado_por_w;
 
			EXIT WHEN NOT FOUND; /* apply on C09 */
 
				BEGIN 
 
				qt_resultado_w		:= qt_resultado_w;
				dt_resultado_por_w	:= dt_resultado_por_w;
 
				EXIT;
 
				END;
 
			END LOOP;
 
			CLOSE C09;
 
 
			END;
 
		END IF;
 
		IF (ie_result_exame_w = 'P') THEN 
 
			BEGIN 
 
			qt_resultado_w	:= pr_resultado_w;
 
			END;
 
		END IF;
		END;
	ELSIF (ie_origem_w	= 'DAT') THEN 
		BEGIN 
	 
		OPEN C10;
		LOOP 
		FETCH C10 INTO	 
				ds_diagnostico_w, 
				ds_resumo_cirurgia_w , 
				ds_diagnostico_pos_w, 
				ds_exame_rad_w, 
				ds_exame_anatomo_w, 
				ds_achados_operatorios_w;
		EXIT WHEN NOT FOUND; /* apply on C10 */
			BEGIN 
		 
			IF (nr_seq_elemento_w = 1220) THEN 
				qt_resultado_w	:= DS_RESUMO_CIRURGIA_w;
			ELSIF (nr_seq_elemento_w	= 1221) THEN 
				qt_resultado_w	:= ds_diagnostico_pos_w;
			ELSIF (nr_seq_elemento_w	= 1222) THEN 
				qt_resultado_w	:= ds_achados_operatorios_w;
			ELSIF (nr_seq_elemento_w	= 1223) THEN 
				qt_resultado_w	:= ds_exame_rad_w;
			ELSIF (nr_seq_elemento_w	= 1224) THEN 
				qt_resultado_w	:= ds_exame_anatomo_w;
			ELSIF (nr_seq_elemento_w	= 1219) THEN 
				qt_resultado_w	:= ds_diagnostico_w;
			END IF;
			 
			END;
		END LOOP;
		CLOSE C10;
		END;
	ELSIF (nr_seq_elemento_w	= 1358) THEN 
		SELECT	MAX(ie_clinica) 
		INTO STRICT	qt_resultado_w 
		FROM	atendimento_paciente 
		WHERE	nr_atendimento	 = nr_atendimento_p;
	END IF;
	 
	ds_retorno_w	:= SUBSTR(ds_retorno_w || TO_CHAR(nr_seq_elemento_w) ||'='||TO_CHAR(qt_resultado_w) ||'#@#@',1,2000);
	END;
 
END LOOP;
 
CLOSE c01;
 
RETURN ds_retorno_w;
 
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION ehr_obter_informacao_elem (nr_atendimento_p bigint, cd_pessoa_fisica_p text, nr_seq_template_p bigint) FROM PUBLIC;

