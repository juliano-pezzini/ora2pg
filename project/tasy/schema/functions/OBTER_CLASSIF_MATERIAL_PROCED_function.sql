-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_classif_material_proced ( cd_material_p bigint, cd_procedimento_p bigint, ie_origem_proced_p bigint) RETURNS varchar AS $body$
DECLARE

cd_material_w		bigint;
cd_procedimento_w	bigint;
ie_origem_proced_w	bigint;

ie_classif_w	varchar(3);

BEGIN

cd_material_w		:= cd_material_p;
cd_procedimento_w	:= cd_procedimento_p;
ie_origem_proced_w	:= ie_origem_proced_p;

/* Para os casos que possuem c√≥digo de material igual de procedimentos cadastrados (IPE) */

if (cd_material_w IS NOT NULL AND cd_material_w::text <> '')		and (cd_procedimento_w IS NOT NULL AND cd_procedimento_w::text <> '')	then
	begin
	if (ie_origem_proced_w IS NOT NULL AND ie_origem_proced_w::text <> '') then
		cd_material_w		:= null;
	else
		cd_procedimento_w	:= null;
	end if;
	end;
end if;

if (cd_material_w IS NOT NULL AND cd_material_w::text <> '') then
	select ie_tipo_material
	into STRICT ie_classif_w
	from material
	where cd_material = cd_material_w;
elsif (cd_procedimento_w IS NOT NULL AND cd_procedimento_w::text <> '') and (ie_origem_proced_w IS NOT NULL AND ie_origem_proced_w::text <> '') then
	select ie_classificacao
	into STRICT ie_classif_w
	from procedimento
	where cd_procedimento = cd_procedimento_w
	  and ie_origem_proced = ie_origem_proced_w;
end if;

return ie_classif_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_classif_material_proced ( cd_material_p bigint, cd_procedimento_p bigint, ie_origem_proced_p bigint) FROM PUBLIC;

