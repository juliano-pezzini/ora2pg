-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_habilita_opcao ( ie_tipo_item_p text, cd_perfil_p bigint) RETURNS varchar AS $body$
DECLARE


ie_habilita_w	varchar(1);
qt_regra_w		bigint;

BEGIN
select 	count(cd_perfil)
into STRICT	qt_regra_w
from	vipe_regra_acao
where	cd_perfil = cd_perfil_p;

if (qt_regra_w > 0) then
	select	coalesce(max('S'),'N')
	into STRICT	ie_habilita_w
	from	vipe_regra_acao
	where	(((ie_tipo_item_p = 'L')   			and (coalesce(ie_coleta,'S') = 'S')) 		or
			 ((ie_tipo_item_p in ('C','G'))   	and (coalesce(ie_controle_glic,'S') = 'S')) 	or
			 ((ie_tipo_item_p = 'MD')  			and (coalesce(ie_dialise,'S') = 'S')) 	  	or
			 ((ie_tipo_item_p = 'D')   			and (coalesce(ie_dieta,'S') = 'S'))		 	or
			 ((ie_tipo_item_p = 'O')   			and (coalesce(ie_gasoterapia,'S') = 'S'))  	or
			 ((ie_tipo_item_p = 'HM')  			and (coalesce(ie_hemoterapia,'S') = 'S'))   	or
			 ((ie_tipo_item_p = 'I')   			and (coalesce(ie_ivc,'S') = 'S')) 		  	or
			 ((ie_tipo_item_p = 'J')   			and (coalesce(ie_jejum,'S') = 'S')) 		  	or
			 ((ie_tipo_item_p = 'LD')   		and (coalesce(ie_leite,'S') = 'S')) 	  	  	or
			 ((ie_tipo_item_p = 'MAT') 			and (coalesce(ie_material,'S') = 'S')) 	  	or
			 ((ie_tipo_item_p = 'M')   			and (coalesce(ie_medicamento,'S') = 'S'))   	or
			 ((ie_tipo_item_p = 'NAN') 			and (coalesce(ie_npt_adulta,'S') = 'S'))    	or
			 ((ie_tipo_item_p = 'NPN') 			and (coalesce(ie_npt_neo,'S') = 'S')) 	  	or
			 ((ie_tipo_item_p = 'NPP') 			and (coalesce(ie_npt_ped,'S') = 'S')) 	  	or
			 ((ie_tipo_item_p = 'P')   			and (coalesce(ie_procedimento,'S') = 'S'))  	or
			 ((ie_tipo_item_p = 'R')   			and (coalesce(ie_recomendacao,'S') = 'S'))  	or
			 ((ie_tipo_item_p = 'SOL') 			and (coalesce(ie_solucao,'S') = 'S'))       	or
			 ((ie_tipo_item_p = 'S')   			and (coalesce(ie_suplemento,'S') = 'S')) 	or
			 ((ie_tipo_item_p = 'SNE')   		and (coalesce(ie_sne,'S') = 'S')))
	and		coalesce(cd_perfil,cd_perfil_p) 	 		= cd_perfil_p;
else
	ie_habilita_w := 'S';
end if;
return	ie_habilita_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_habilita_opcao ( ie_tipo_item_p text, cd_perfil_p bigint) FROM PUBLIC;

