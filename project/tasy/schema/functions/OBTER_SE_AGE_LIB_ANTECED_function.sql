-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_age_lib_anteced (nr_sequencia_p bigint, qt_tempo_anteced_p bigint) RETURNS varchar AS $body$
DECLARE


dt_Atual_w timestamp := NULL;
dt_agendamento_w timestamp := NULL;
dt_horario_disp_w timestamp := NULL;


BEGIN

IF (qt_tempo_anteced_p > 0) AND (nr_sequencia_p > 0) THEN

SELECT 	TO_DATE(TO_CHAR(clock_timestamp(),'dd/mm/yyyy hh24:mi'),'dd/mm/yyyy hh24:mi') dt_atual,
	MAX(dt_agenda) dt_agendamento,
	TO_DATE(TO_CHAR((MAX(clock_timestamp()))+(qt_tempo_anteced_p/24),'dd/mm/yyyy hh24:mi'),'dd/mm/yyyy hh24:mi') dt_horario_disp
INTO STRICT	dt_atual_w,
		dt_agendamento_w,
		dt_horario_disp_w
FROM   agenda_consulta
WHERE  nr_sequencia = nr_sequencia_p;

	IF (dt_agendamento_w >= dt_horario_disp_w) THEN
		RETURN  'S';
	ELSE
		RETURN  'N';
	END IF;
END IF;

RETURN	NULL;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_age_lib_anteced (nr_sequencia_p bigint, qt_tempo_anteced_p bigint) FROM PUBLIC;

