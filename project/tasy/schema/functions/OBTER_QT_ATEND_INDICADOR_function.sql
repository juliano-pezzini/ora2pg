-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_qt_atend_indicador (ie_periodo_p text, dt_inicio_p timestamp, dt_fim_p timestamp, cd_setor_atend_p text, ie_total text default 'N') RETURNS bigint AS $body$
DECLARE


cd_retorno_w		bigint;


BEGIN

    if (ie_total != 'N') then
    
        select 
            COUNT(DISTINCT eplv.NR_ATENDIMENTO || eplv.CD_SETOR_ATENDIMENTO)
        into STRICT
            cd_retorno_w
        from
            EIS_PROCED_LABORAT_V eplv 
        where
            eplv.ie_periodo = ie_periodo_p and
            eplv.dt_atend between dt_inicio_p and dt_fim_p and
            eplv.CD_SETOR_ATENDIMENTO in (
                SELECT
                    eplv_ss.CD_SETOR_ATENDIMENTO
                from
                    EIS_PROCED_LABORAT_V eplv_ss 
                where
                    eplv_ss.dt_referencia between dt_inicio_p and dt_fim_p
            );

    else
    
        select 
            COUNT(DISTINCT eplv.NR_ATENDIMENTO || eplv.CD_SETOR_ATENDIMENTO)
        into STRICT
             cd_retorno_w
        from
            EIS_PROCED_LABORAT_V eplv 
        where
            eplv.ie_periodo = ie_periodo_p and
            eplv.dt_atend between dt_inicio_p and dt_fim_p and
            to_char(eplv.CD_SETOR_ATENDIMENTO) = cd_setor_atend_p;

    end if;

    
    return	cd_retorno_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_qt_atend_indicador (ie_periodo_p text, dt_inicio_p timestamp, dt_fim_p timestamp, cd_setor_atend_p text, ie_total text default 'N') FROM PUBLIC;

