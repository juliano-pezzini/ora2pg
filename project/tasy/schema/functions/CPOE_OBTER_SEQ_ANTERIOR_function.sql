-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cpoe_obter_seq_anterior ( nr_seq_reg_item_p cpoe_material.nr_sequencia%type, ie_opcao_prescr_p text ) RETURNS CPOE_MATERIAL.NR_SEQUENCIA%TYPE AS $body$
DECLARE

	nr_seq_cpoe_anterior_w	cpoe_material.nr_seq_cpoe_anterior%type;

BEGIN
	if (nr_seq_reg_item_p IS NOT NULL AND nr_seq_reg_item_p::text <> '' AND ie_opcao_prescr_p IS NOT NULL AND ie_opcao_prescr_p::text <> '') then
		case ie_opcao_prescr_p
			when 'MA' then
				begin
					select  max(nr_seq_cpoe_anterior)
					into STRICT    nr_seq_cpoe_anterior_w
					from    cpoe_material
					where   nr_sequencia = nr_seq_reg_item_p;
				end;
			when 'M' then
				begin
					select  max(nr_seq_cpoe_anterior)
					into STRICT    nr_seq_cpoe_anterior_w
					from    cpoe_material
					where   nr_sequencia = nr_seq_reg_item_p;
				end;
			when 'N' then --Nutricao
				begin
					select  max(nr_seq_cpoe_anterior)
					into STRICT    nr_seq_cpoe_anterior_w
					from    cpoe_dieta
					where   nr_sequencia = nr_seq_reg_item_p;
				end;
			when 'P' then --Procedimentos
				begin
					select  max(nr_seq_cpoe_anterior)
					into STRICT    nr_seq_cpoe_anterior_w
					from    cpoe_procedimento
					where   nr_sequencia = nr_seq_reg_item_p;
				end;
			when 'G' then --Gasoterapia
				begin
					select  max(nr_seq_cpoe_anterior)
					into STRICT    nr_seq_cpoe_anterior_w
					from    cpoe_gasoterapia
					where   nr_sequencia = nr_seq_reg_item_p;
				end;
			when 'R' then --Recomendação
				begin
					select  max(nr_seq_cpoe_anterior)
					into STRICT    nr_seq_cpoe_anterior_w
					from    cpoe_recomendacao
					where   nr_sequencia = nr_seq_reg_item_p;
				end;
			when 'H' then --Hemoterapia
				begin
					select  max(nr_seq_cpoe_anterior)
					into STRICT    nr_seq_cpoe_anterior_w
					from    cpoe_hemoterapia
					where   nr_sequencia = nr_seq_reg_item_p;
				end;
			when 'DI' then --Dialysis
				begin
					select  max(nr_seq_cpoe_anterior)
					into STRICT    nr_seq_cpoe_anterior_w
					from    cpoe_dialise
					where   nr_sequencia = nr_seq_reg_item_p;
				end;
			when 'DP' then --Dialysis
				begin
					select  max(nr_seq_cpoe_anterior)
					into STRICT    nr_seq_cpoe_anterior_w
					from    cpoe_dialise
					where   nr_sequencia = nr_seq_reg_item_p;
				end;
			when 'AP' then --Anatomia Patológica
				begin
					select  max(nr_seq_cpoe_anterior)
					into STRICT    nr_seq_cpoe_anterior_w
					from    cpoe_anatomia_patologica
					where   nr_sequencia = nr_seq_reg_item_p;
				end;
		end case;
	end if;

return coalesce(nr_seq_cpoe_anterior_w, 0);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_obter_seq_anterior ( nr_seq_reg_item_p cpoe_material.nr_sequencia%type, ie_opcao_prescr_p text ) FROM PUBLIC;

