-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cpoe_obter_inicio_prescr_ant (nr_seq_mat_cpoe_p bigint, cd_material_p bigint, dt_referencia_p timestamp) RETURNS timestamp AS $body$
DECLARE


  ds_retorno_w timestamp;

  d01 RECORD;

BEGIN

  if (nr_seq_mat_cpoe_p IS NOT NULL AND nr_seq_mat_cpoe_p::text <> '') then
    for d01 in (SELECT x.dt_inicio_medic
                  from prescr_material x, prescr_medica m
                 where x.nr_prescricao = m.nr_prescricao
                   and x.nr_seq_mat_cpoe = nr_seq_mat_cpoe_p
                   and cd_material = cd_material_p
                   and m.dt_prescricao < dt_referencia_p
                 order by x.nr_prescricao) loop

      ds_retorno_w := d01.dt_inicio_medic;

    end loop;
  end if;

  RETURN ds_retorno_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_obter_inicio_prescr_ant (nr_seq_mat_cpoe_p bigint, cd_material_p bigint, dt_referencia_p timestamp) FROM PUBLIC;

