-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_param_funcao_usu ( cd_funcao_p bigint, nr_sequencia_p bigint, cd_perfil_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint, cd_funcao_ativa_p bigint) RETURNS varchar AS $body$
DECLARE


cd_estabelecimento_w	integer;
vl_parametro_w varchar(2000);

BEGIN

cd_estabelecimento_w	:= coalesce(cd_estabelecimento_p, 1);

select
	coalesce((select vl_parametro from funcao_param_Usuario
	where 	cd_funcao    = cd_funcao_p
	  and 	nr_sequencia = nr_sequencia_p
	  and 	nm_usuario_param = nm_usuario_p
	  and 	coalesce(cd_estabelecimento,cd_estabelecimento_w) = cd_estabelecimento_w)
  ,
 	(select vl_parametro from (	select	vl_parametro
                 from funcao_param_perfil
		  where cd_funcao    = cd_funcao_p
		   and nr_sequencia = nr_sequencia_p
		   and cd_perfil    = cd_perfil_p
		   and coalesce(cd_estabelecimento,cd_estabelecimento_w) = cd_estabelecimento_w
		 order by coalesce(cd_estabelecimento,0) desc) alias4 LIMIT 1)
  ,
   (select vl_parametro	from FUNCAO_PARAM_FUNCAO
	where 	cd_funcao    = cd_funcao_p
          and cd_funcao_config = cd_funcao_ativa_p
 	  and 	nr_seq_param = nr_sequencia_p)
  ,
		(select vl_parametro from funcao_param_estab
      	 	where cd_funcao = cd_funcao_p
		  and nr_seq_param = nr_sequencia_p
		  and cd_estabelecimento = cd_estabelecimento_p)
  ,              
	 ( select coalesce(vl_parametro, vl_parametro_padrao) as vl_parametro from funcao_parametro
          where cd_funcao = cd_funcao_p
	  and nr_sequencia = nr_sequencia_p)
  ,
   ( select  'S' as vl_parametro  )
  ) into STRICT vl_parametro_w;

 return vl_parametro_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_param_funcao_usu ( cd_funcao_p bigint, nr_sequencia_p bigint, cd_perfil_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint, cd_funcao_ativa_p bigint) FROM PUBLIC;

