-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_surgery_summary_number ( nr_surgery_p bigint, ie_option_p text) RETURNS bigint AS $body$
DECLARE

  nr_return_w double precision;
  nr_seq_urine_type_w bigint;
  nr_seq_blood_type_w bigint;


BEGIN
  select
  a.nr_seq_urine, 
  a.nr_seq_blood_loss
  into STRICT
  nr_seq_urine_type_w,
  nr_seq_blood_type_w
  from surg_summ_param a
  where a.cd_estabelecimento = wheb_usuario_pck.get_cd_estabelecimento;

  if (nr_surgery_p IS NOT NULL AND nr_surgery_p::text <> '' AND ie_option_p IS NOT NULL AND ie_option_p::text <> '') then
    if ( ie_option_p = 'UOP' and (nr_seq_urine_type_w IS NOT NULL AND nr_seq_urine_type_w::text <> '') ) then
        select sum(c.qt_volume)
        into STRICT nr_return_w
        from atendimento_perda_ganho c
        where nr_cirurgia = nr_surgery_p
        and c.nr_seq_tipo      = nr_seq_urine_type_w
        and (c.dt_liberacao IS NOT NULL AND c.dt_liberacao::text <> '')
        and coalesce(c.dt_inativacao::text, '') = '';
    elsif ( ie_option_p = 'BLEED' and (nr_seq_blood_type_w IS NOT NULL AND nr_seq_blood_type_w::text <> '') ) then
        select sum(c.qt_volume)
        into STRICT nr_return_w
        from atendimento_perda_ganho c
        where nr_cirurgia = nr_surgery_p
        and c.nr_seq_tipo      = nr_seq_blood_type_w
        and (c.dt_liberacao IS NOT NULL AND c.dt_liberacao::text <> '')
        and coalesce(c.dt_inativacao::text, '') = '';
    end if;
  end if;
return nr_return_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_surgery_summary_number ( nr_surgery_p bigint, ie_option_p text) FROM PUBLIC;

