-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_agenda_consulta (nr_atendimento_p bigint, ie_tipo_retorno_p text) RETURNS varchar AS $body$
DECLARE

 
ds_retorno_w		varchar(2000)	:= '';
ds_status_w		varchar(100)	:= '';
ds_classif_w		varchar(100)	:= '';
ds_observacao_w		varchar(2000)	:= '';
cd_pf_agenda_w		agenda.cd_pessoa_fisica%type;

/*	S - Status Agenda 
	C - Classif. Agenda */
 
 
c01 CURSOR FOR 
	SELECT	b.ds_status_agenda, 
		c.ds_classif_agenda, 
		a.ds_observacao, 
		d.cd_pessoa_fisica 
	from	status_agenda_v b, 
		classif_agenda_consulta_v c, 
		agenda d, 
		agenda_consulta a 
	where	a.ie_status_agenda	= b.cd_status_agenda 
	and	a.ie_classif_agenda	= c.cd_classif_agenda 
	and	a.cd_agenda = d.cd_agenda 
	and	a.nr_atendimento	= nr_atendimento_p 
	order	by dt_agenda;


BEGIN 
 
open	c01;
loop 
fetch	c01 into 
	ds_status_w, 
	ds_classif_w, 
	ds_observacao_w, 
	cd_pf_agenda_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin 
 
	if (ie_tipo_retorno_p 	= 'S') then 
		ds_retorno_w		:= ds_status_w;
	elsif (ie_tipo_retorno_p 	= 'C') then 
		ds_retorno_w		:= ds_classif_w;
	elsif (ie_tipo_retorno_p	= 'O') then 
		ds_retorno_w		:= ds_observacao_w;
	elsif (ie_tipo_retorno_p	= 'M') then 
		ds_retorno_w 		:= cd_pf_agenda_w;
	end if;
	end;
end loop;
close c01;
 
return	ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_agenda_consulta (nr_atendimento_p bigint, ie_tipo_retorno_p text) FROM PUBLIC;

