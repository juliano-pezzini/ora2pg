-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION hem_obter_via_acesso ( nr_seq_proc_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE



ds_retorno_w		varchar(255);
ds_texto_w		varchar(255);
tx_dispositivo_w 	varchar(100);
tx_oclusor_w		varchar(100);

--AL -> Acesso e lateralidade
--R	-> Relat√≥rio
c01 CURSOR FOR
  SELECT
    substr(obter_valor_dominio(1489,ie_vaso_acesso),1,255) || ' ' ||
    lower(substr(obter_valor_dominio(1483,ie_acesso),1,255)) ||
    lower(CASE WHEN coalesce(ie_lat_acesso::text, '') = '' THEN ' '  ELSE ' '|| substr(obter_valor_dominio(1488,ie_lat_acesso),1,255) ||' ' END ) ||
    CASE WHEN coalesce(nr_seq_oclusor::text, '') = '' THEN ''  ELSE '('||lower(obter_desc_expressao(878849))||    lower(CASE WHEN coalesce(qt_oclusor::text, '') = '' THEN ''  ELSE ' '||qt_oclusor END ) ||    lower(CASE WHEN coalesce(nr_seq_oclusor::text, '') = '' THEN ''  ELSE ' '||substr(hem_obter_desc_oclusor(nr_seq_oclusor),1,255) END )    ||').' END
  from hem_acesso
  where	nr_seq_proc = nr_seq_proc_p;

BEGIN



if (nr_seq_proc_p IS NOT NULL AND nr_seq_proc_p::text <> '') then

	tx_dispositivo_w := lower(obter_desc_expressao(847205)); --dispositivo
	tx_oclusor_w := lower(obter_desc_expressao(651700)); --oclusor
	if (ie_opcao_p = 'R') then
		open C01;
		loop
		fetch C01 into
			ds_texto_w;
		EXIT WHEN NOT FOUND; /* apply on C01 */
			begin
			ds_retorno_w := ds_retorno_w || ds_texto_w || chr(13);
			end;
		end loop;
		close C01;
	else

		select	max(obter_valor_dominio(1483,a.ie_acesso) ||' '|| obter_valor_dominio(1488,a.ie_lat_acesso))
		into STRICT	ds_retorno_w
		from   	hem_acesso a
		where 	nr_seq_proc = nr_seq_proc_p;
	end if;
end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION hem_obter_via_acesso ( nr_seq_proc_p bigint, ie_opcao_p text) FROM PUBLIC;

