-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_usuario_confirm_bionexo ( nr_ordem_compra_p bigint) RETURNS varchar AS $body$
DECLARE

 
ds_retorno_w			varchar(30);
cd_estabelecimento_w		integer;
nm_usuario_aprov_w		varchar(15);
ie_enviar_usuario_conf_bio_w	varchar(1);


BEGIN 
 
select	cd_estabelecimento, 
	nm_usuario_aprov 
into STRICT	cd_estabelecimento_w, 
	nm_usuario_aprov_w 
from	ordem_compra 
where	nr_ordem_compra = nr_ordem_compra_p;
 
select	coalesce(max(ie_enviar_usuario_conf_bio),'N') 
into STRICT	ie_enviar_usuario_conf_bio_w 
from	parametro_compras 
where	cd_estabelecimento = cd_estabelecimento_w;
 
if (ie_enviar_usuario_conf_bio_w = 'S') and (nm_usuario_aprov_w IS NOT NULL AND nm_usuario_aprov_w::text <> '') then 
	begin 
 
	select	max(cd_externo) 
	into STRICT	ds_retorno_w 
	from	conversao_meio_externo 
	where	upper(nm_tabela)		= 'USUARIO' 
	and	upper(nm_atributo)	= 'NM_USUARIO' 
	and	ie_sistema_externo		= 'B' 
	and	upper(cd_interno)		= upper(nm_usuario_aprov_w);
 
	end;
end if;
 
return	ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_usuario_confirm_bionexo ( nr_ordem_compra_p bigint) FROM PUBLIC;

