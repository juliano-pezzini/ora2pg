-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_tiss_regra_agrup (nr_seq_procedimento_p bigint) RETURNS varchar AS $body$
DECLARE


    cd_grupo_proc_w          tiss_regra_agrup.cd_grupo_proc%type;
    cd_area_procedimento_w   tiss_regra_agrup.cd_area_procedimento%type;
    cd_especialidade_w       tiss_regra_agrup.cd_especialidade%type;
    cd_procedimento_w        tiss_regra_agrup.cd_procedimento%type;
    cd_estabelecimento_w     bigint;
    cd_convenio_w            bigint;
    ie_tipo_atendimento_w    tiss_regra_agrup.ie_tipo_atendimento%type;
    ie_tipo_atend_conta_w    tiss_regra_agrup.ie_tipo_atend_conta%type;
    ie_agrupar_w             tiss_regra_agrup.ie_agrupar%type;

c01 CURSOR FOR
SELECT	ie_agrupar
from	tiss_regra_agrup
where	cd_estabelecimento						= cd_estabelecimento_w
and	cd_convenio						= cd_convenio_w
and	coalesce(cd_procedimento, coalesce(cd_procedimento_w, -1))			= coalesce(cd_procedimento_w, -1)
and	coalesce(cd_grupo_proc, coalesce(cd_grupo_proc_w, -1))			= coalesce(cd_grupo_proc_w, -1)
and	coalesce(cd_area_procedimento, coalesce(cd_area_procedimento_w, -1))	= coalesce(cd_area_procedimento_w, -1)
and	coalesce(cd_especialidade, coalesce(cd_especialidade_w, -1))		= coalesce(cd_especialidade_w, -1)
and	coalesce(ie_tipo_atendimento, coalesce(ie_tipo_atendimento_w, 0))		= coalesce(ie_tipo_atendimento_w, 0)
and	coalesce(ie_tipo_atend_conta, coalesce(ie_tipo_atend_conta_w, 0))		= coalesce(ie_tipo_atend_conta_w, 0)
order by coalesce(cd_procedimento,0),
	coalesce(cd_grupo_proc,0),
	coalesce(cd_especialidade,0),
	coalesce(cd_area_procedimento,0),
	coalesce(ie_tipo_atend_conta,0),
	coalesce(ie_tipo_atendimento,0);


BEGIN

select	cd_procedimento,
	obter_grupo_procedimento(a.cd_procedimento, a.ie_origem_proced, 'C'),
	obter_area_procedimento(a.cd_procedimento, a.ie_origem_proced),
	obter_especialidade_proced(a.cd_procedimento, a.ie_origem_proced),
	b.cd_estabelecimento,
	b.cd_convenio_parametro,
	b.ie_tipo_atend_conta,
	c.ie_tipo_atendimento
into STRICT	cd_procedimento_w,
	cd_grupo_proc_w,
	cd_area_procedimento_w,
	cd_especialidade_w,
	cd_estabelecimento_w,
	cd_convenio_w,
	ie_tipo_atend_conta_w,
	ie_tipo_atendimento_w
from	conta_paciente b,
	procedimento_paciente a,
	atendimento_paciente c
where	b.nr_interno_conta	= a.nr_interno_conta
and	b.nr_atendimento	= c.nr_atendimento
and	a.nr_sequencia		= nr_seq_procedimento_p;

open c01;
loop
fetch c01 into
	ie_agrupar_w;
EXIT WHEN NOT FOUND; /* apply on c01 */

end loop;
close c01;

if (coalesce(ie_agrupar_w, 'S') = 'S') then
	return	'S';
else
	return	'N';
end if;

end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_tiss_regra_agrup (nr_seq_procedimento_p bigint) FROM PUBLIC;

