-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION return_guidance ( guidance_origin_p text, nr_seq_origin_p bigint, nm_usuario_p text ) RETURNS text AS $body$
DECLARE


return_guidance_w	text;
newline_w			varchar(100) := chr(13) || chr(10);
cd_perfil_ativo_w	bigint;
ds_fonte_w			varchar(100);
ds_tam_fonte_w		varchar(100);
nr_tam_fonte_w		integer;
ds_cabecalho_w		varchar(32000);


  guidance RECORD;

BEGIN
    
	cd_perfil_ativo_w := obter_perfil_ativo;
	ds_fonte_w := obter_param_usuario(281, 5, cd_perfil_ativo_w, nm_usuario_p, cd_perfil_ativo_w, ds_fonte_w);
	ds_tam_fonte_w := obter_param_usuario(281, 6, cd_perfil_ativo_w, nm_usuario_p, cd_perfil_ativo_w, ds_tam_fonte_w);
	nr_tam_fonte_w := somente_numero(ds_tam_fonte_w) * 2;

	if guidance_origin_p = 'CP_INTERV_PLAN_GUID' then
		for guidance in (
							SELECT	distinct cpg.nr_sequencia,
									cpg.ds_guidance
							from	cp_interv_plan_guid cpipg
							inner join	cp_guidance cpg
								on	cpipg.nr_seq_guidance = cpg.nr_sequencia
							where	cpipg.nr_seq_interv_plan = nr_seq_origin_p
							and		cpipg.ie_situacao = 'A'
							order by cpg.nr_sequencia
						) loop
						
			return_guidance_w := return_guidance_w || ('\u9632    ' || guidance.ds_guidance || newline_w);
		end loop;
	elsif guidance_origin_p = 'CP_INDICATOR_GUID' then
		for guidance in (
                    SELECT		distinct cpg.nr_sequencia,
                                cpg.ds_guidance
                    from        cp_indicator_guid cpig
                    inner join  cp_guidance cpg
                    on          cpig.nr_seq_guidance = cpg.nr_sequencia
                    where       cpig.nr_seq_indicator = nr_seq_origin_p
					and			cpig.ie_situacao = 'A'
					order by	cpg.nr_sequencia

		) loop
		
            return_guidance_w := return_guidance_w || ('\u9632    ' || guidance.ds_guidance || newline_w);
        end loop;
	elsif guidance_origin_p = 'CP_INDICATOR_MEASURE_GUID' then
		for guidance in (
                    SELECT		distinct cpg.nr_sequencia,
                                cpg.ds_guidance
                    from        cp_indicator_measure_guid cpimg
                    inner join  cp_guidance cpg
                    on          cpimg.nr_seq_guidance = cpg.nr_sequencia
                    where       cpimg.nr_seq_indic_measure = nr_seq_origin_p
					and			cpimg.ie_situacao = 'A'
					order by	cpg.nr_sequencia

		) loop
		
            return_guidance_w := return_guidance_w || ('\u9632    ' || guidance.ds_guidance || newline_w);
        end loop;
	end if;
	
	ds_cabecalho_w := ('{\rtf1\ansi\ansicpg1252\deff0\deflang1046{\fonttbl{\f0\fswiss\fcharset0 '
		|| ds_fonte_w
		|| ';}}'
		|| '{\*\generator msftedit 5.41.15.1507;}\viewkind4\uc1\pard\f0\fs'
		|| nr_tam_fonte_w
		|| ' ');

	return_guidance_w := ds_cabecalho_w || (replace(return_guidance_w, chr(13) || chr(10), ' \par ') || '}');
	
	
return return_guidance_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION return_guidance ( guidance_origin_p text, nr_seq_origin_p bigint, nm_usuario_p text ) FROM PUBLIC;

