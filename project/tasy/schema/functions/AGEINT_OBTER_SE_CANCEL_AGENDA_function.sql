-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION ageint_obter_se_cancel_agenda ( nr_seq_agenda_int_p bigint) RETURNS varchar AS $body$
DECLARE


qt_nao_agendado_w	bigint;
qt_agendado_cons_w	bigint;
qt_agendado_exame_w	bigint;
qt_agendado_quimio_w	bigint;
qt_pendencias_quimio_w	bigint;
qt_agendamento_quimio_w	bigint;
ds_Retorno_w		varchar(1)	:= 'N';


BEGIN

select	count(*)
into STRICT	qt_nao_agendado_w
from	agenda_integrada_item
where	nr_seq_agenda_int	= nr_seq_agenda_int_p
and	coalesce(nr_seq_agenda_exame::text, '') = ''
and	coalesce(nr_seq_agenda_cons::text, '') = ''
and	ie_tipo_agendamento	<> 'Q';

select	count(*)
into STRICT	qt_agendado_quimio_w
from	agenda_integrada_item a,
	agenda_quimio b
where	a.nr_sequencia	= b.nr_seq_ageint_item
and	b.ie_status_agenda <> 'C'
and	a.ie_tipo_agendamento <> 'Q'
and	a.nr_seq_agenda_int = nr_seq_agenda_int_p;


select	count(*)
into STRICT	qt_pendencias_quimio_w
from	agenda_integrada_item a
where	Qt_Obter_Status_Pendencia(a.nr_seq_pend_quimio) in ('S', 'A')
and	a.ie_tipo_agendamento = 'Q'
and	(a.nr_seq_pend_quimio IS NOT NULL AND a.nr_seq_pend_quimio::text <> '')
and	a.nr_seq_agenda_int = nr_seq_agenda_int_p;


select	count(*)
into STRICT	qt_agendado_exame_w
from	agenda_paciente a,
	agenda_integrada_item b
where	a.nr_sequencia	= b.nr_seq_agenda_exame
and	(b.nr_seq_agenda_exame IS NOT NULL AND b.nr_seq_agenda_exame::text <> '')
and	a.ie_status_agenda	<> 'C'
and	b.nr_seq_agenda_int	= nr_seq_agenda_int_p;

select	count(*)
into STRICT	qt_agendado_cons_w
from	agenda_consulta a,
	agenda_integrada_item b
where	a.nr_sequencia	= b.nr_seq_agenda_cons
and	(b.nr_seq_agenda_cons IS NOT NULL AND b.nr_seq_agenda_cons::text <> '')
and	a.ie_status_agenda	<> 'C'
and	b.nr_seq_agenda_int	= nr_seq_agenda_int_p;


select	count(*)
into STRICT	qt_agendamento_quimio_w
from	agenda_quimio a,
	agenda_integrada_item b
where	a.nr_seq_ageint_item = b.nr_sequencia
and	a.ie_status_agenda <> 'C'
and	b.nr_seq_agenda_int = nr_seq_agenda_int_p;

if (qt_nao_agendado_w	= 0) and (qt_agendado_cons_w	= 0) and (qt_agendado_exame_w	= 0) and (qt_agendado_quimio_w	= 0) and (qt_agendamento_quimio_w = 0) and (qt_pendencias_quimio_w = 0)then
	ds_retorno_w	:= 'S';
else
	ds_retorno_w	:= 'N';
end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION ageint_obter_se_cancel_agenda ( nr_seq_agenda_int_p bigint) FROM PUBLIC;

