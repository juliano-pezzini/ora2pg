-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_visualiza_contato (pf_contato_p text, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE

			 
ie_exibe_w		varchar(1)	:= 'S';
nm_usuario_w		varchar(15) := Wheb_usuario_pck.get_nm_usuario;
cd_perfil_w		bigint  := wheb_usuario_pck.get_cd_perfil;
cd_pessoa_w		varchar(10);
qt_pf_regra_w		integer;


BEGIN 
 
select substr(obter_pessoa_fisica_usuario(nm_usuario_w,'C'),1,255) 
into STRICT	cd_pessoa_w
;
 
select count(*) 
into STRICT	qt_pf_regra_w 
from 	regra_consulta_contato 
where	cd_pessoa_fisica = pf_contato_p;
 
if (qt_pf_regra_w > 0) then 
	select	coalesce(max(a.ie_permite_visualizar_contato),'N') 
	into STRICT	ie_exibe_w 
	from 	regra_consulta_contato_lib a, 
		regra_consulta_contato b 
	where 	a.nr_seq_regra_consulta 		= b.nr_sequencia 
	and	coalesce(a.cd_pessoa_fisica,cd_pessoa_w)	= cd_pessoa_w 
	and	coalesce(a.cd_perfil, cd_perfil_w)		= cd_perfil_w	 
	and	b.cd_pessoa_fisica 			= pf_contato_p;
	 
end if;	
	 
return	ie_exibe_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_visualiza_contato (pf_contato_p text, ie_opcao_p text) FROM PUBLIC;

