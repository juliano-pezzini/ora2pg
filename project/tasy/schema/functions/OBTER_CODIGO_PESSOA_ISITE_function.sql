-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_codigo_pessoa_isite (cd_pessoa_fisica_p text) RETURNS varchar AS $body$
DECLARE


cd_pessoa_retorno_w		varchar(20);
cd_pessoa_fisica_w		varchar(20);
ie_pessoa_alt_w			varchar(2);
ie_origem_pessoa_fisica_w	varchar(10);


BEGIN

select 	coalesce(max(ie_utiliza_pessoa_alternativa),'N'),
	coalesce(max(ie_origem_pessoa_fisica),1)
into STRICT	ie_pessoa_alt_w,
	ie_origem_pessoa_fisica_w
from	empresa_integr_dados
where	nr_seq_empresa_integr = 4;


cd_pessoa_fisica_w := cd_pessoa_fisica_p;

if (ie_origem_pessoa_fisica_w = '2') then

	cd_pessoa_fisica_w := obter_select_concatenado_bv(' select SF_RETORNA_ID_PAC_TASY(:nr_prontuario)
							    from dual',
				'nr_prontuario='||obter_prontuario_pf(cd_pessoa_fisica_p,wheb_usuario_pck.get_cd_estabelecimento),
							  '');
	if (coalesce(cd_pessoa_fisica_w::text, '') = '') then
		cd_pessoa_fisica_w := cd_pessoa_fisica_p;
	end if;


end if;



if	((ie_pessoa_alt_w = 'S') and (length(cd_pessoa_fisica_w) <= 6))	then

	cd_pessoa_retorno_w := 'M' || lpad(cd_pessoa_fisica_w,6, '0');

else

	cd_pessoa_retorno_w := cd_pessoa_fisica_w;

end if;

return	cd_pessoa_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_codigo_pessoa_isite (cd_pessoa_fisica_p text) FROM PUBLIC;

