-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_pessoa_internada (cd_pessoa_fisica_p text) RETURNS varchar AS $body$
DECLARE


ie_pac_internado_w	varchar(1);
ie_tipo_internado_w	varchar(1);


BEGIN

if (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') then

	select	coalesce(max(ie_pac_inter_legenda),'N')
	into STRICT	ie_tipo_internado_w
	from	parametro_agenda
	where	cd_estabelecimento =  wheb_usuario_pck.get_cd_estabelecimento;

	if (ie_tipo_internado_w = 'N') then
		select	coalesce(max('S'),'N')
		into STRICT	ie_pac_internado_w
		from    setor_atendimento c,
				unidade_atendimento a,
				atendimento_paciente b,
				table(lista_pck.obter_lista('3,4,8')) d
		where   a.nr_atendimento        = b.nr_atendimento
		and     a.cd_setor_atendimento  = c.cd_setor_atendimento
		and		c.cd_classif_setor 		= d.nr_registro
		and		b.cd_pessoa_fisica      = cd_pessoa_fisica_p;
	else
		select	coalesce(max('S'),'N')
		into STRICT	ie_pac_internado_w
		from    atendimento_paciente b
		where   b.ie_tipo_atendimento	= 1
		and	b.cd_pessoa_fisica      = cd_pessoa_fisica_p
		and	coalesce(b.dt_alta::text, '') = '';
	end if;
end if;

return	ie_pac_internado_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_pessoa_internada (cd_pessoa_fisica_p text) FROM PUBLIC;

