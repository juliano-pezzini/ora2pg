-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_valores_conta_pag ( nr_seq_conta_p bigint, nr_seq_lote_pgto_p bigint, ie_opcao_p text) RETURNS bigint AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[X]  Objetos do dicionário [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
/* ie_opcao_p
VLP 	- Valor liberado para pagamento
VL 	- Valor total liberado conta
VNL 	- Valor não liberado para pagamento
VLO 	- Valor liberado para outro pagamento
*/
vl_retorno_w	double precision;


BEGIN
if (nr_seq_conta_p IS NOT NULL AND nr_seq_conta_p::text <> '') and (nr_seq_lote_pgto_p IS NOT NULL AND nr_seq_lote_pgto_p::text <> '') and (ie_opcao_p IS NOT NULL AND ie_opcao_p::text <> '') then
	if (ie_opcao_p = 'VLP') then
		select	coalesce(sum(b.vl_liberado),0)
		into STRICT	vl_retorno_w
		from	pls_conta_medica_resumo	b,
			pls_conta		a
		where	a.nr_sequencia 		= b.nr_seq_conta
		and	b.nr_seq_lote_pgto 	= nr_seq_lote_pgto_p
		and	a.nr_sequencia		= nr_seq_conta_p;
	elsif (ie_opcao_p = 'VL') then
		select	coalesce(sum(a.vl_total),0)
		into STRICT	vl_retorno_w
		from	pls_conta a
		where	a.nr_sequencia = nr_seq_conta_p;
	elsif (ie_opcao_p = 'VNL') then
		select	coalesce(sum(b.vl_liberado),0)
		into STRICT	vl_retorno_w
		from	pls_conta_medica_resumo	b,
			pls_conta		a
		where	a.nr_sequencia 		= b.nr_seq_conta
		and	a.nr_sequencia		= nr_seq_conta_p
		and	coalesce(b.nr_seq_lote_pgto::text, '') = '';
	elsif (ie_opcao_p = 'VLO') then
		select	coalesce(sum(b.vl_liberado),0)
		into STRICT	vl_retorno_w
		from	pls_conta_medica_resumo	b,
			pls_conta		a
		where	a.nr_sequencia 		= b.nr_seq_conta
		and	b.nr_seq_lote_pgto 	= nr_seq_lote_pgto_p
		and	a.nr_sequencia		<> nr_seq_conta_p
		and	(b.nr_seq_lote_pgto IS NOT NULL AND b.nr_seq_lote_pgto::text <> '');

	-- Pagamento NOVO
	elsif (ie_opcao_p = 'NVLP') then
		select	coalesce(sum(b.vl_liberado),0)
		into STRICT	vl_retorno_w
		from	pls_conta_medica_resumo	b,
			pls_conta		a
		where	a.nr_sequencia 		= b.nr_seq_conta
		and	b.nr_seq_pp_lote 	= nr_seq_lote_pgto_p
		and	a.nr_sequencia		= nr_seq_conta_p;
	elsif (ie_opcao_p = 'NVL') then
		select	coalesce(sum(a.vl_total),0)
		into STRICT	vl_retorno_w
		from	pls_conta a
		where	a.nr_sequencia = nr_seq_conta_p;
	elsif (ie_opcao_p = 'NVNL') then
		select	coalesce(sum(b.vl_liberado),0)
		into STRICT	vl_retorno_w
		from	pls_conta_medica_resumo	b,
			pls_conta		a
		where	a.nr_sequencia 		= b.nr_seq_conta
		and	a.nr_sequencia		= nr_seq_conta_p
		and	coalesce(b.nr_seq_pp_lote::text, '') = '';
	elsif (ie_opcao_p = 'NVLO') then
		select	coalesce(sum(b.vl_liberado),0)
		into STRICT	vl_retorno_w
		from	pls_conta_medica_resumo	b,
			pls_conta		a
		where	a.nr_sequencia 		= b.nr_seq_conta
		and	b.nr_seq_pp_lote 	= nr_seq_lote_pgto_p
		and	a.nr_sequencia		<> nr_seq_conta_p
		and	(b.nr_seq_pp_lote IS NOT NULL AND b.nr_seq_pp_lote::text <> '');
	end if;
end if;

return	vl_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_valores_conta_pag ( nr_seq_conta_p bigint, nr_seq_lote_pgto_p bigint, ie_opcao_p text) FROM PUBLIC;

