-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_texto_dic_objeto ( nr_seq_objeto_p bigint, nr_seq_idioma_p bigint, ds_valores_macros_p text) RETURNS varchar AS $body$
DECLARE


ds_texto_w		varchar(4000);
ds_valores_macros_w	varchar(4000);
nr_ctrl_loop_w		smallint := 0;
nr_pos_separador_w	smallint;
ds_macro_e_valor_w	varchar(1000);
ds_macro_w		varchar(1000);
ds_valor_w		varchar(1000);


BEGIN
if (nr_seq_objeto_p IS NOT NULL AND nr_seq_objeto_p::text <> '') then
	begin
	select	max(obter_desc_expressao_idioma(cd_exp_informacao, ds_informacao, nr_seq_idioma_p))
	into STRICT	ds_texto_w
	from	dic_objeto
	where	nr_sequencia = nr_seq_objeto_p;

	if (ds_texto_w IS NOT NULL AND ds_texto_w::text <> '') and (ds_valores_macros_p IS NOT NULL AND ds_valores_macros_p::text <> '') then
		begin
		ds_valores_macros_w := ds_valores_macros_p;

		while(ds_valores_macros_w IS NOT NULL AND ds_valores_macros_w::text <> '') and (nr_ctrl_loop_w < 100) loop
			begin
			nr_pos_separador_w	:= position(';' in ds_valores_macros_w);

			if (nr_pos_separador_w > 0) then
				begin
				ds_macro_e_valor_w	:= substr(ds_valores_macros_w, 1, nr_pos_separador_w-1);
				ds_valores_macros_w	:= substr(ds_valores_macros_w, nr_pos_separador_w+1, length(ds_valores_macros_w));
				end;
			else
				begin
				ds_macro_e_valor_w	:= ds_valores_macros_w;
				ds_valores_macros_w	:= null;
				end;
			end if;

			nr_pos_separador_w	:= position('=' in ds_macro_e_valor_w);

			if (nr_pos_separador_w > 0) then
				begin
				ds_macro_w	:= substr(ds_macro_e_valor_w, 1, nr_pos_separador_w-1);
				ds_valor_w	:= substr(ds_macro_e_valor_w, nr_pos_separador_w+1, length(ds_macro_e_valor_w));

				if (ds_macro_w IS NOT NULL AND ds_macro_w::text <> '') and (ds_valor_w IS NOT NULL AND ds_valor_w::text <> '') then
					begin
					ds_texto_w := replace(ds_texto_w, '#@' || upper(ds_macro_w) || '#@', ds_valor_w);
					end;
				end if;
				end;
			end if;

			nr_ctrl_loop_w := nr_ctrl_loop_w + 1;
			end;
		end loop;
		end;
	end if;
	end;
end if;
return ds_texto_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_texto_dic_objeto ( nr_seq_objeto_p bigint, nr_seq_idioma_p bigint, ds_valores_macros_p text) FROM PUBLIC;

