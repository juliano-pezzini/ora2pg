-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_tiss_obter_tipo_dbcr ( cd_tributo_p text) RETURNS varchar AS $body$
DECLARE


ds_retorno_w			varchar(2) := 0;
ie_tipo_tributo_W		varchar(20);

/*	Retornos possiveis para a versão 3.01.00:
	01-IRRF
	02-ISS
	03-INSS
	04-PIS
	05-COFINS
	06-CSLL
	07-Descontos financeiros
	08-Ajuste de pagamento anterior
	09-Determinação judicial

	Valores do Dominio 1205
	CD_DOMINIO		DS_DOMINIO
	COFINS          COFINS
	COFINSST        COFINS ST
	CSLL            Contribuição social lucro líquido (CSLL)
	ICMS            ICMS
	ICMSST          ICMSST
	INSS            INSS
	INSSP           INSS Patronal
	IPI             IPI
	IR              Imposto de renda
	ISS             ISSQN
	ISSST           ISS ST
	O               Outros
	PIS             PIS
	PISCOFINSCSLL   Retenção PIS/Cofins/CSLL
	PISST           PIS ST
	STI             Substituição tributária - ICMS	*/
BEGIN

if (cd_tributo_p IS NOT NULL AND cd_tributo_p::text <> '') then

	begin

		select 	ie_tipo_tributo
		into STRICT	ie_tipo_tributo_W
		from 	tributo
		where	cd_tributo = cd_tributo_p;

		if (	position('IR' in ie_tipo_tributo_W) > 0	) then

			ds_retorno_w := '01';

		elsif (	position('ISS' in ie_tipo_tributo_W) > 0	) then

			ds_retorno_w := '02';

		elsif (	position('INSS' in ie_tipo_tributo_W) > 0	) then

			ds_retorno_w := '03';

		elsif (	position('PIS' in ie_tipo_tributo_W) > 0	) then

			ds_retorno_w := '04';

		elsif (	position('COFINS' in ie_tipo_tributo_W) > 0	) then

			ds_retorno_w := '05';

		elsif (	position('CSLL' in ie_tipo_tributo_W) > 0	) then

			ds_retorno_w := '06';

		else

			ds_retorno_w := '07';

		end if;

	exception
		when others then
			ds_retorno_w	:= '0';
	end;

end	if;

return	ds_retorno_w;

end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_tiss_obter_tipo_dbcr ( cd_tributo_p text) FROM PUBLIC;

