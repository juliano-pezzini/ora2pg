-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION gpt_funcao_prescr_liberada ( cd_perfil_p bigint, ie_prescr_uausrio_p bigint) RETURNS varchar AS $body$
DECLARE


				
ie_possui_regra_w		varchar(1):='N';
ie_funcao_medico_lib_w	gpt_presentation_rule.ie_funcao_medico_lib%type;
ie_funcao_enf_lib_w		gpt_presentation_rule.ie_funcao_enf_lib%type;
ie_funcao_farm_lib_w	gpt_presentation_rule.ie_funcao_farm_lib%type;
ie_funcao_fisio_lib_w	gpt_presentation_rule.ie_funcao_fisio_lib%type;
ie_funcao_nutric_lib_w	gpt_presentation_rule.ie_funcao_nutric_lib%type;
ie_funcao_odont_lib_w	gpt_presentation_rule.ie_funcao_odont_lib%type;
ie_funcao_tec_enf_w	gpt_presentation_rule.ie_funcao_tec_enf%type;


										

BEGIN

if (cd_perfil_p IS NOT NULL AND cd_perfil_p::text <> '') then	
		select max(coalesce('S','N'))
		into STRICT	ie_possui_regra_w
		from 	gpt_presentation_rule
		where 	((cd_perfil = cd_perfil_p) or (coalesce(cd_perfil::text, '') = ''));
	
		if (coalesce(ie_possui_regra_w,'N') = 'S') then				
			select	max(coalesce(ie_funcao_medico_lib,'S')),
				max(coalesce(ie_funcao_enf_lib,'S')),
				max(coalesce(ie_funcao_farm_lib,'S')),
				max(coalesce(ie_funcao_fisio_lib,'S')),
				max(coalesce(ie_funcao_nutric_lib,'S')),
        max(coalesce(ie_funcao_tec_enf, 'S')),
                max(coalesce(ie_funcao_odont_lib,'S'))
			into STRICT	ie_funcao_medico_lib_w,
				ie_funcao_enf_lib_w,
				ie_funcao_farm_lib_w,
				ie_funcao_fisio_lib_w,
				ie_funcao_nutric_lib_w,
        ie_funcao_tec_enf_w,
                ie_funcao_odont_lib_w
			from 	gpt_presentation_rule
			where 	((cd_perfil = cd_perfil_p) or (coalesce(cd_perfil::text, '') = ''));
				
			if (ie_prescr_uausrio_p = 1) then --Medico
				return coalesce(ie_funcao_medico_lib_w,'N');				
			elsif (ie_prescr_uausrio_p = 8) then -- farmaceutico 				
				return coalesce(ie_funcao_farm_lib_w,'N');				
			elsif (ie_prescr_uausrio_p = 3) then -- enfermeiro 					
				return coalesce(ie_funcao_enf_lib_w,'N');				
			elsif (ie_prescr_uausrio_p = 4) then -- nutricionista
				return coalesce(ie_funcao_nutric_lib_w,'N');				
			elsif (ie_prescr_uausrio_p = 10) then -- fisioterapeuta
				return coalesce(ie_funcao_fisio_lib_w,'N');	
            elsif (ie_prescr_uausrio_p = 12) then -- odontologista
				return coalesce(ie_funcao_odont_lib_w,'N');
      elsif (ie_prescr_uausrio_p = 13) then
        return coalesce(ie_funcao_tec_enf_w, 'N');
			else
				return 'N';					
			end if;		
		end if;	
end if;										

return 	'S';
								
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION gpt_funcao_prescr_liberada ( cd_perfil_p bigint, ie_prescr_uausrio_p bigint) FROM PUBLIC;

