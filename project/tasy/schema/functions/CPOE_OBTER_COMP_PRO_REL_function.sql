-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cpoe_obter_comp_pro_rel ( nr_seq_exame_lab_p bigint, nr_seq_proc_interno_p bigint, cd_material_exame_p text, cd_intervalo_p text, nr_seq_condicao_p bigint, nr_seq_topografia_p bigint, ie_lado_p text, ie_evento_unico_p text, ie_administracao_p text, ie_urgente_p text default null) RETURNS varchar AS $body$
DECLARE


ds_retorno_w		varchar(4000);

	function tipo_adm return text is
	;
BEGIN
		if (ie_administracao_p = 'N' ) then
			return obter_desc_expressao(298074, '');
		elsif ( ie_administracao_p = 'C') then
			return obter_desc_expressao(689215, '');
		end if;

		return '';
	end;

	function material_exame return varchar2 is
		ds_retorno_ww		varchar2(255);
	begin
		select 	obter_desc_expressao(292970) || ': ' || b.ds_material_exame ds
		into STRICT	ds_retorno_ww
		from 	material_exame_lab b
		where 	b.cd_material_exame  = cd_material_exame_p;

		return ' ' || ds_retorno_ww || ' ';
	end;

	function desc_intervalo return varchar2 is
	begin
		if (cd_intervalo_p IS NOT NULL AND cd_intervalo_p::text <> '')  then
			return ' ' || obter_desc_expressao(292190, '') ||': '|| obter_desc_intervalo(cd_intervalo_p) || ' ';
		end if;

		return '';
	end;

	function condicao return varchar2 is
	begin
		return ' ' || obter_desc_condicao_exame(nr_seq_condicao_p) || ' ';
	end;

	function topografia return varchar2 is
	ds_retorno_ww		varchar2(255) := null;
	begin
		if (nr_seq_topografia_p IS NOT NULL AND nr_seq_topografia_p::text <> '') then
			ds_retorno_ww := substr(obter_desc_topografia_dor(nr_seq_topografia_p),1,60);
		end if;

		return ' ' || ds_retorno_ww || ' ';
	end;

	function descricao_lado return varchar2 is
	begin
		if (ie_lado_p IS NOT NULL AND ie_lado_p::text <> '') then
			return	obter_texto_dic_objeto(449775, wheb_usuario_pck.get_nr_seq_idioma,null)||': '|| obter_valor_dominio(7279, ie_lado_p) || ' ';
		end if;

		return '';
	end;

	function evento_unico return varchar2 is
	ds_retorno_ww		varchar2(255);
	begin
		select	CASE WHEN ie_evento_unico_p='S' THEN  'Sim' WHEN ie_evento_unico_p='N' THEN 'Não'  ELSE obter_desc_expressao(327119)/*'Não informado'*/ END
		into STRICT	ds_retorno_ww
		;

		return ' '|| ds_retorno_ww || ' ';
	end;

	function ds_urgencia return varchar2 is
	begin
		if (ie_administracao_p = 'P') and (ie_urgente_p IS NOT NULL AND ie_urgente_p::text <> '') then
			return  ' ' || obter_valor_dominio(7069, ie_urgente_p) ||' ';
		end if;

		return '';
	end;

begin
	if (nr_seq_exame_lab_p IS NOT NULL AND nr_seq_exame_lab_p::text <> '') then
		ds_retorno_w := material_exame() || tipo_adm() || desc_intervalo() || condicao()||ds_urgencia();
	elsif (coalesce(nr_seq_exame_lab_p::text, '') = '') then
		ds_retorno_w := tipo_adm() ||  topografia() || descricao_lado() || condicao() || desc_intervalo() || ds_urgencia();
	end if;

	return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_obter_comp_pro_rel ( nr_seq_exame_lab_p bigint, nr_seq_proc_interno_p bigint, cd_material_exame_p text, cd_intervalo_p text, nr_seq_condicao_p bigint, nr_seq_topografia_p bigint, ie_lado_p text, ie_evento_unico_p text, ie_administracao_p text, ie_urgente_p text default null) FROM PUBLIC;

