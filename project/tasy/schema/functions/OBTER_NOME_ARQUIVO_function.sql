-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_nome_arquivo ( ds_arquivo_p text, ie_com_extensao_p text) RETURNS varchar AS $body$
DECLARE


/*Essa funtion serve para retornar somente o nome do arquivo.
Exemplo: Agente passa para a procedure a string c:\Hospital\Tasy\teste.xml
A function retorna somente o nome do arquivo, ou seja, teste.xml

ie_com_extensao_p
S - Retorna o nome do arquivo com a extensao. Exemplo teste.xml
N - Retorna o nome do arquivo sem a extensão. Exemplo: teste*/
ds_retorno_w			varchar(2000);
ds_arquivo_w			varchar(2000);
ds_arquivo_ww			varchar(2000);
qt_posicao_w			bigint;
qt_posicao_ww			bigint := 0;


BEGIN
ds_arquivo_w		:= substr(ds_arquivo_p,1,2000);

while position('\' in ds_arquivo_w) > 0 loop
	begin
	ds_arquivo_w := substr(ds_arquivo_w,position('\' in ds_arquivo_w)+1,2000);
	end;
end loop;

if (ie_com_extensao_p = 'S') and (position('.' in ds_arquivo_w) > 0) then
	ds_arquivo_ww := ds_arquivo_w;
	/*esse while é para pegar o ultimo ponto (.) para depois fazer substr de 1 ate a posicao deste ultimo ponto*/

	while position('.' in ds_arquivo_ww) > 0 loop
		begin
		qt_posicao_w	:= position('.' in ds_arquivo_ww);
		ds_arquivo_ww 	:= substr(ds_arquivo_ww, qt_posicao_w +1,2000);
		qt_posicao_ww	:= qt_posicao_ww + qt_posicao_w;
		end;
	end loop;
	ds_arquivo_w := substr(ds_arquivo_w,1,qt_posicao_ww -1);
end if;

return	ds_arquivo_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_nome_arquivo ( ds_arquivo_p text, ie_com_extensao_p text) FROM PUBLIC;

