-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';



CREATE TYPE campos AS (qt_dose 	double precision);


CREATE OR REPLACE FUNCTION obter_qt_material_dose_dif (cd_material_p bigint, cd_unidade_medida_p text, ds_dose_dif_p text) RETURNS bigint AS $body$
DECLARE

type vetor is table of campos index 	by integer;
vetor_w	vetor;
x	varchar(1);
k 	integer := 1;
buff_w	varchar(10);
qt_dose_total_w	double precision := 0;
ds_dose_w	varchar(255);
BEGIN
vetor_w.delete;
buff_w := '';
for i in 1..length(ds_dose_dif_p) loop
	begin
	x	:= substr(ds_dose_dif_p, i, 1);
	if (x <> '-') then
		buff_w := buff_w || x;
	end if;
	if (x = '-') or (i = length(ds_dose_dif_p)) then
		if (buff_w = '1/2') then
			buff_w := to_char(0.5);
		elsif (coalesce(somente_numero_char(buff_w),'0') = '0') then
			buff_W := to_char(0);
		end if;
		vetor_w[k].qt_dose := (buff_w)::numeric;
		buff_w := '';
		k := k + 1;
	end if;
	end;
end loop;

for i in 1..vetor_w.count loop
	begin
	qt_dose_total_w := qt_dose_total_w + vetor_w[i].qt_dose;
	end;
end loop;
return	obter_conversao_unid_med_cons(cd_material_p, cd_unidade_medida_p, qt_dose_total_w );

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION obter_qt_material_dose_dif (cd_material_p bigint, cd_unidade_medida_p text, ds_dose_dif_p text) FROM PUBLIC;

