-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cpoe_integracao_count ( ie_item_type_cpoe_p text, nr_sequence_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


	quantity_w		          smallint;
	rule_quantity_w	        smallint;
	ie_ciencia_interface_w	varchar(1);


BEGIN

	select	count(*)
	into STRICT	  rule_quantity_w
	from	  cpoe_regra_ator;

	if (rule_quantity_w = 0) then
		quantity_w := 0;
	else		
		if (ie_opcao_p = 'BTN') then
			if (ie_item_type_cpoe_p = 'N') then /*Nutrition*/
				select	count(nr_sequencia)
				into STRICT	  quantity_w
				from 	  cpoe_integracao
				where 	nr_seq_diet_cpoe = nr_sequence_p
				and		  coalesce(dt_ack_interface::text, '') = '';
			elsif (ie_item_type_cpoe_p = 'M') then /*Medicine*/
				select	count(nr_sequencia)
				into STRICT	  quantity_w
				from 	  cpoe_integracao
				where 	nr_seq_mat_cpoe = nr_sequence_p
				and		  coalesce(dt_ack_interface::text, '') = '';
			elsif (ie_item_type_cpoe_p = 'DI') then /*Dialysis*/
				select	count(nr_sequencia)
				into STRICT	  quantity_w
				from 	  cpoe_integracao
				where 	nr_seq_dial_cpoe = nr_sequence_p
				and		  coalesce(dt_ack_interface::text, '') = '';
			elsif (ie_item_type_cpoe_p = 'P') then /*Procedure*/
				select	count(nr_sequencia)
				into STRICT	  quantity_w
				from 	  cpoe_integracao
				where 	nr_seq_proc_cpoe = nr_sequence_p
				and		  coalesce(dt_ack_interface::text, '') = '';
			elsif (ie_item_type_cpoe_p = 'G') then /*Gas therapy*/
				select	count(nr_sequencia)
				into STRICT	  quantity_w
				from 	  cpoe_integracao
				where 	nr_seq_gaso_cpoe = nr_sequence_p
				and		  coalesce(dt_ack_interface::text, '') = '';
			elsif (ie_item_type_cpoe_p = 'R') then /*Recomendation*/
				select	count(nr_sequencia)
				into STRICT	  quantity_w
				from 	  cpoe_integracao
				where 	nr_seq_rec_cpoe = nr_sequence_p
				and		  coalesce(dt_ack_interface::text, '') = '';
			elsif (ie_item_type_cpoe_p = 'H') then /*Hemotherapy*/
				select	count(nr_sequencia)
				into STRICT    quantity_w
				from 	  cpoe_integracao
				where 	nr_seq_hemo_cpoe = nr_sequence_p
				and		  coalesce(dt_ack_interface::text, '') = '';
			elsif (ie_item_type_cpoe_p = 'MA') then /*Material*/
				select	count(nr_sequencia)
				into STRICT	  quantity_w
				from 	  cpoe_integracao
				where 	nr_seq_mat_cpoe = nr_sequence_p
				and		  coalesce(dt_ack_interface::text, '') = '';
			elsif (ie_item_type_cpoe_p = 'AP') then
				select	count(nr_sequencia)
				into STRICT	  quantity_w
				from 	  cpoe_integracao
				where 	nr_seq_mat_cpoe = nr_sequence_p
				and		  coalesce(dt_ack_interface::text, '') = '';
			end if;
		elsif (ie_opcao_p = 'TAG') then
			if (ie_item_type_cpoe_p = 'N') then /*Nutrition*/
				select	count(nr_sequencia)
				into STRICT	  quantity_w
				from 	  cpoe_integracao
				where 	nr_seq_diet_cpoe = nr_sequence_p
				and		  (dt_ack_interface IS NOT NULL AND dt_ack_interface::text <> '');
			elsif (ie_item_type_cpoe_p = 'M') then /*Medicine*/
				select	count(nr_sequencia)
				into STRICT	  quantity_w
				from 	  cpoe_integracao
				where 	nr_seq_mat_cpoe = nr_sequence_p
				and		  (dt_ack_interface IS NOT NULL AND dt_ack_interface::text <> '');
			elsif (ie_item_type_cpoe_p = 'DI') then /*Dialysis*/
				select	count(nr_sequencia)
				into STRICT	  quantity_w
				from 	  cpoe_integracao
				where 	nr_seq_dial_cpoe = nr_sequence_p
				and		  (dt_ack_interface IS NOT NULL AND dt_ack_interface::text <> '');
			elsif (ie_item_type_cpoe_p = 'P') then /*Procedure*/
				select	count(nr_sequencia)
				into STRICT	  quantity_w
				from 	  cpoe_integracao
				where 	nr_seq_proc_cpoe = nr_sequence_p
				and		  (dt_ack_interface IS NOT NULL AND dt_ack_interface::text <> '');
			elsif (ie_item_type_cpoe_p = 'G') then /*Gas therapy*/
				select	count(nr_sequencia)
				into STRICT	  quantity_w
				from 	  cpoe_integracao
				where 	nr_seq_gaso_cpoe = nr_sequence_p
				and		  (dt_ack_interface IS NOT NULL AND dt_ack_interface::text <> '');
			elsif (ie_item_type_cpoe_p = 'R') then /*Recomendation*/
				select	count(nr_sequencia)
				into STRICT	  quantity_w
				from 	  cpoe_integracao
				where 	nr_seq_rec_cpoe = nr_sequence_p
				and		  (dt_ack_interface IS NOT NULL AND dt_ack_interface::text <> '');
			elsif (ie_item_type_cpoe_p = 'H') then /*Hemotherapy*/
				select	count(nr_sequencia)
				into STRICT    quantity_w
				from 	  cpoe_integracao
				where 	nr_seq_hemo_cpoe = nr_sequence_p
				and		  (dt_ack_interface IS NOT NULL AND dt_ack_interface::text <> '');
			elsif (ie_item_type_cpoe_p = 'MA') then /*Material*/
				select	count(nr_sequencia)
				into STRICT	  quantity_w
				from 	  cpoe_integracao
				where 	nr_seq_mat_cpoe = nr_sequence_p
				and		  (dt_ack_interface IS NOT NULL AND dt_ack_interface::text <> '');
			elsif (ie_item_type_cpoe_p = 'AP') then
				select	count(nr_sequencia)
				into STRICT	  quantity_w
				from 	  cpoe_integracao
				where 	nr_seq_mat_cpoe = nr_sequence_p
				and		  (dt_ack_interface IS NOT NULL AND dt_ack_interface::text <> '');
			end if;
		end if;
	end if;	

	if (quantity_w > 0) then
    return 'S';
  else
    return 'N';
  end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_integracao_count ( ie_item_type_cpoe_p text, nr_sequence_p bigint, ie_opcao_p text) FROM PUBLIC;

