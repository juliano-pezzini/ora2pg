-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_valida_alteracao_ocor_aut ( nr_seq_ocor_aut_combinada_p bigint, nr_seq_ocor_aut_filtro_p bigint, nr_seq_ocor_regra_p bigint, nr_seq_regra_ocor_p bigint, nr_seq_tabela_ocor_p bigint) RETURNS varchar AS $body$
DECLARE


/* ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:  Validar as regras de ocorrências com os logs gerados, caso a regra já tenha sido aplicada
em alguma guia, requisição ou execução, não será permitido excluir a mesma.
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [ x  ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
Tratamento dos parâmetros a serem passados.
NR_SEQ_OCOR_AUT_COMBINADA_P	Referente ao registro da tabela PLS_OCOR_AUT_COMBINADAfs
NR_SEQ_OCOR_AUT_FILTRO_P		Referente ao registro da tabela PLS_OCOR_AUT_FILTRO
NR_SEQ_OCOR_REGRA_P  		Referente ao registro da tabela PLS_OCORRENCIA_REGRA

Quando passar o campo  NR_SEQ_REGRA_OCOR_P  (sequencia da regra) é obrigatório passar o campo
NR_SEQ_TABELA_OCOR_P (sequencia da tabela da regra) estes campos serão verificados na tabela
PLS_OCOR_AUT_TABELA_LOG
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/
/*  ie_permite_excluir
	S - Permite excluir a regra
	N - Não permite excluir a regra
*/
qt_registros_w			bigint;
ie_permite_excluir_w		varchar(1);


BEGIN

select	count(1) qt
into STRICT	qt_registros_w
from	pls_ocor_aut_benef_log
where	nr_seq_ocor_regra = nr_seq_ocor_regra_p;

if (qt_registros_w > 0) then
	ie_permite_excluir_w	:= 'N';
else
	ie_permite_excluir_w	:= 'S';
end if;

return	ie_permite_excluir_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_valida_alteracao_ocor_aut ( nr_seq_ocor_aut_combinada_p bigint, nr_seq_ocor_aut_filtro_p bigint, nr_seq_ocor_regra_p bigint, nr_seq_regra_ocor_p bigint, nr_seq_tabela_ocor_p bigint) FROM PUBLIC;

