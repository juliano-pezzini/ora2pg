-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_titulo_nf ( nr_seq_nota_p bigint, ie_tipo_dado_p text) RETURNS varchar AS $body$
DECLARE

				
ds_retorno_w			varchar(255)	:= null;
nr_titulo_receber_w		titulo_receber.nr_titulo%type;
nr_titulo_pagar_w		titulo_pagar.nr_titulo%type;

/* 	1 - Titulo a receber
	2 - Titulo a pagar
	3 - Valor do titulo a receber
	4 - Valor do titulo a pagar
	5 - Data de vencimento do titulo a receber
	6 - Data de vencimento do titulo a pagar
	7 - Situacao do titulo a receber
	8 - Situacao do titulo a pagar
	9 - Data de liquidacao do titulo a receber
	10 - Data de liquidacao do titulo a pagar
	11 - Valor do saldo do titulo a receber
	12 - Valor do saldo do titulo a pagar */
				

BEGIN
if (nr_seq_nota_p IS NOT NULL AND nr_seq_nota_p::text <> '') then
	select	max(nr_titulo)
	into STRICT	nr_titulo_receber_w
	from	titulo_receber
	where	nr_seq_nf_saida = nr_seq_nota_p
	and	ie_origem_titulo = 1;

	select	max(nr_titulo)
	into STRICT	nr_titulo_pagar_w
	from	titulo_pagar
	where	nr_seq_nota_fiscal = nr_seq_nota_p
	and	ie_origem_titulo = 1
	and coalesce(nr_seq_tributo::text, '') = '';
end if;

if (ie_tipo_dado_p = 1) then
	ds_retorno_w := nr_titulo_receber_w;
	
elsif (ie_tipo_dado_p = 2) then
	ds_retorno_w := nr_titulo_pagar_w;

elsif (ie_tipo_dado_p = 3) then
	select	coalesce(max(vl_titulo),0)
	into STRICT	ds_retorno_w
	from	titulo_receber
	where	nr_titulo = nr_titulo_receber_w;
	
elsif (ie_tipo_dado_p = 4) then
	select	coalesce(max(vl_titulo),0)
	into STRICT	ds_retorno_w
	from	titulo_pagar
	where	nr_titulo = nr_titulo_pagar_w;
	
elsif (ie_tipo_dado_p = 5) then
	select	max(dt_pagamento_previsto)
	into STRICT	ds_retorno_w
	from	titulo_receber
	where	nr_titulo = nr_titulo_receber_w;
	
elsif (ie_tipo_dado_p = 6) then
	select	max(dt_vencimento_atual)
	into STRICT	ds_retorno_w
	from	titulo_pagar
	where	nr_titulo = nr_titulo_pagar_w;
	
elsif (ie_tipo_dado_p = 7) then
	select	obter_descricao_dominio(710,max(ie_situacao))
	into STRICT	ds_retorno_w
	from	titulo_receber
	where	nr_titulo = nr_titulo_receber_w;
	
elsif (ie_tipo_dado_p = 8) then
	select	obter_descricao_dominio(501,max(ie_situacao))
	into STRICT	ds_retorno_w
	from	titulo_pagar
	where	nr_titulo = nr_titulo_pagar_w;
	
elsif (ie_tipo_dado_p = 9) then
	select	max(dt_liquidacao)
	into STRICT	ds_retorno_w
	from	titulo_receber
	where	nr_titulo = nr_titulo_receber_w;
	
elsif (ie_tipo_dado_p = 10) then
	select	max(dt_liquidacao)
	into STRICT	ds_retorno_w
	from	titulo_pagar
	where	nr_titulo = nr_titulo_pagar_w;
	
elsif (ie_tipo_dado_p = 11) then
	select	coalesce(max(vl_saldo_titulo),0)
	into STRICT	ds_retorno_w
	from	titulo_receber
	where	nr_titulo = nr_titulo_receber_w;
	
elsif (ie_tipo_dado_p = 12) then
	select	coalesce(max(vl_saldo_titulo),0)
	into STRICT	ds_retorno_w
	from	titulo_pagar
	where	nr_titulo = nr_titulo_pagar_w;
end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_titulo_nf ( nr_seq_nota_p bigint, ie_tipo_dado_p text) FROM PUBLIC;

