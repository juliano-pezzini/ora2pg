-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cpoe_verify_pres_item_routine ( cd_perfil_p bigint, ie_tipo_p text) RETURNS varchar AS $body$
DECLARE


ie_enteral_diet_w	cpoe_presentation_routine.ie_enteral_diet%type;
ie_oral_diet_w		cpoe_presentation_routine.ie_oral_diet%type;
ie_supplement_w		cpoe_presentation_routine.ie_supplement%type;
ie_special_rout_w	cpoe_presentation_routine.ie_special_rout%type;
ie_exam_w			cpoe_presentation_routine.ie_exam%type;
ie_gas_w			cpoe_presentation_routine.ie_gas%type;
ie_pathologocical_anatomy_w				cpoe_presentation_routine.ie_anatomia_patologica%type;
ie_medicine_w		cpoe_presentation_routine.ie_medicine%type;
ie_procedure_w		cpoe_presentation_routine.ie_procedure%type;
ie_recomendation_w	cpoe_presentation_routine.ie_recomendation%type;
ie_solution_w		cpoe_presentation_routine.ie_solution%type;
ie_material_w		cpoe_presentation_routine.ie_material%type;
ie_milk_w			cpoe_presentation_routine.ie_milk%type;
ie_resp_therapy_w	cpoe_presentation_routine.ie_respiratory_therapy%type;
nr_sequencia_w		cpoe_presentation_rule.nr_sequencia%type;
ds_retorno_w		varchar(1) := 'S';

/*	IE_TIPO_P	= Opcoes disponiveis	

DE	=	Dietas enterais
DL	=	Leites e formulas infantis
DO	=	Dietas Orais
DS	=	Suplementos
ES	=	Rotinas Especiais
EX	=	Exames Laboratoriais
G	=	Gasoterapias
M	=	Medicamentos
P	=	Exames nao laboratoriais
R	=	Recomendacoes
S	=	Solucoes
TR	=	Respiratory Therapy
AP  = Pathological Anatomy
*/
BEGIN

select	coalesce(max(nr_sequencia),0)
into STRICT	nr_sequencia_w
from (SELECT nr_sequencia
	from	cpoe_presentation_rule
	where 	coalesce(cd_perfil, coalesce(cd_perfil_p,0)) = coalesce(cd_perfil_p,0)
	and	coalesce(cd_estabelecimento, coalesce(wheb_usuario_pck.get_cd_estabelecimento,0)) = coalesce(wheb_usuario_pck.get_cd_estabelecimento,0)
	order by cd_perfil, cd_estabelecimento) alias8 LIMIT 1;

if (nr_sequencia_w > 0) then
	select	max(coalesce(ie_enteral_diet,'S')),
		max(coalesce(ie_oral_diet,'S')),
		max(coalesce(ie_supplement,'S')),
		max(coalesce(ie_special_rout, 'S')),
		max(coalesce(ie_exam,'S')),
		max(coalesce(ie_gas,'S')),
    max(coalesce(ie_anatomia_patologica,'S')),
		max(coalesce(ie_medicine,'S')),
		max(coalesce(ie_procedure,'S')),
		max(coalesce(ie_recomendation,'S')),
		max(coalesce(ie_solution,'S')),
		max(coalesce(ie_material,'S')),
		max(coalesce(ie_milk,'S')),
		max(coalesce(ie_respiratory_therapy,'N'))
	into STRICT	ie_enteral_diet_w,
		ie_oral_diet_w,
		ie_supplement_w,
		ie_special_rout_w,
		ie_exam_w,
		ie_gas_w,
    ie_pathologocical_anatomy_w,
		ie_medicine_w,
		ie_procedure_w,
		ie_recomendation_w,
		ie_solution_w,
		ie_material_w,
		ie_milk_w,
		ie_resp_therapy_w
	from	cpoe_presentation_routine
	where	nr_seq_rule = nr_sequencia_w;

	if (ie_tipo_p = 'DE') then
		return 	ie_enteral_diet_w;
	elsif (ie_tipo_p = 'DL') then
		return	ie_milk_w;
	elsif (ie_tipo_p = 'DO') then
		return	ie_oral_diet_w;
	elsif (ie_tipo_p = 'DS') then
		return	ie_supplement_w;
	elsif (ie_tipo_p = 'ES') then
		return 	ie_special_rout_w;
	elsif (ie_tipo_p = 'EX') then
		return	ie_exam_w;
	elsif (ie_tipo_p = 'G') then
		return	ie_gas_w;
  elsif (ie_tipo_p = 'AP') then
		return	ie_pathologocical_anatomy_w;
	elsif (ie_tipo_p = 'M') then
		return	ie_medicine_w;
	elsif (ie_tipo_p = 'P') then
		return	ie_procedure_w;
	elsif (ie_tipo_p = 'R') then
		return	ie_recomendation_w;
	elsif (ie_tipo_p = 'S') then
		return	ie_solution_w;
	elsif (ie_tipo_p = 'MA') then
		return	ie_material_w;
	elsif (ie_tipo_p = 'TR') then	
		return ie_resp_therapy_w;
	end if;
end if;
return	ds_retorno_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_verify_pres_item_routine ( cd_perfil_p bigint, ie_tipo_p text) FROM PUBLIC;

