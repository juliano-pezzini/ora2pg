-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_grupo_sup_des ( nr_sequencia_p bigint, ie_opcao_p text, ie_sup_des_p text) RETURNS varchar AS $body$
DECLARE

 
/*Só tratei para grupo desenv, mas já está preparada para buscar as inf do suporte*/
 
 
ds_retorno_w			varchar(255);
ds_grupo_w			varchar(80);
nm_usuario_lider_grupo_w		varchar(15);
ds_gerencia_w			varchar(80);
cd_resp_gerencia_w		varchar(10);

nm_gerente_w			varchar(255);
nm_analista_grupo_w		varchar(255);

/*ie_opcao_p 
NA - nome analista grupo 
NG - nome gerente 
RG - Ramal do gerente 
*/
 
 

BEGIN 
 
if (nr_sequencia_p > 0) then 
	begin 
	if (ie_sup_des_p = 'D') then 
		select	a.ds_grupo, 
			c.nm_usuario_grupo, 
			b.ds_gerencia, 
			b.cd_responsavel 
		into STRICT	ds_grupo_w, 
			nm_usuario_lider_grupo_w, 
			ds_gerencia_w, 
			cd_resp_gerencia_w 
		FROM usuario_grupo_des c, gerencia_wheb b
LEFT OUTER JOIN grupo_desenvolvimento a ON (b.nr_sequencia = a.nr_seq_gerencia)
WHERE a.nr_sequencia = c.nr_seq_grupo and c.ie_funcao_usuario = 'S' and a.nr_sequencia = nr_sequencia_p   LIMIT 1;
		 
		if (ie_opcao_p = 'NA') then 
			select	ds_usuario 
			into STRICT	ds_retorno_w 
			from	usuario 
			where	nm_usuario = nm_usuario_lider_grupo_w;
		elsif (ie_opcao_p = 'NG') then 
			select	substr(obter_nome_pf(cd_pessoa_fisica), 1, 255) 
			into STRICT	ds_retorno_w 
			from	pessoa_fisica 
			where	cd_pessoa_fisica = cd_resp_gerencia_w;		
		elsif (ie_opcao_p = 'RG') then 
			select	max(nr_ramal) 
			into STRICT	ds_retorno_w 
			from	usuario 
			where	cd_pessoa_fisica = cd_resp_gerencia_w;
		end if;
	end if;
	end;
end if;
 
return	ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_grupo_sup_des ( nr_sequencia_p bigint, ie_opcao_p text, ie_sup_des_p text) FROM PUBLIC;

