-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_quebra_linha ( ds_texto_p text, qt_tamanho_p bigint, nr_linha_retorno_p bigint) RETURNS varchar AS $body$
DECLARE


i			bigint;

qt_pos_final_w		bigint;
ie_caracter_w		varchar(1);

ds_texto_aux_w		varchar(4000);
ds_linha_w		varchar(4000);

ds_retorno_w		varchar(4000);


type vetor is table of varchar(255) index by integer;

vetor_w	vetor;

BEGIN

ds_texto_aux_w		:= ds_texto_p;
i			:= 0;

while(coalesce(ds_texto_aux_w,'#@NULL#@') <> '#@NULL#@') loop
	begin
	if (length(ds_texto_aux_w) <= qt_tamanho_p) then
		begin
		ds_linha_w	:=	ds_texto_aux_w;
		ds_texto_aux_w	:=	null;
		qt_pos_final_w	:=	0;
		end;
	else
		begin
		ds_linha_w	:=	substr(ds_texto_aux_w, 1, qt_tamanho_p);

		ie_caracter_w	:=	substr(ds_linha_w, qt_tamanho_p, 1);

		if (ie_caracter_w in (' ', '.', ',', ';')) then
			qt_pos_final_w	:=	qt_tamanho_p;
		else
			qt_pos_final_w	:=	instr(ds_linha_w, ' ', -1);
			ds_linha_w	:=	substr(ds_linha_w, 1, qt_pos_final_w);
		end if;

		ds_texto_aux_w	:=	substr(ds_texto_aux_w, qt_pos_final_w + 1, 4000);
		end;
	end if;

	vetor_w(i)		:= trim(both ds_linha_w);

	i			:= i + 1;
	end;
end loop;

begin
ds_retorno_w	:=	vetor_w(nr_linha_retorno_p-1);
exception
when others then
	ds_retorno_w	:=	null;
end;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_quebra_linha ( ds_texto_p text, qt_tamanho_p bigint, nr_linha_retorno_p bigint) FROM PUBLIC;

