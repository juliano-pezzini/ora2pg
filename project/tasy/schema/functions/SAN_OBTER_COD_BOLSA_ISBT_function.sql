-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION san_obter_cod_bolsa_isbt ( nr_seq_derivado_p bigint, ie_lavado_p text, ie_irradiado_p text, ie_filtrado_p text, ie_aliquotado_p text, qt_volume_p bigint default null, nr_seq_conservante_p bigint default null) RETURNS varchar AS $body$
DECLARE

cd_bolsa_w	varchar(50);

C01 CURSOR FOR
	SELECT	a.nr_bolsa
	from	san_derivado_bolsa a
	where	a.nr_seq_derivado	= nr_seq_derivado_p
	and	((a.ie_lavado		= coalesce(ie_lavado_p,a.ie_lavado)) or (coalesce(a.ie_lavado::text, '') = ''))
	and	((a.ie_irradiado	= coalesce(ie_irradiado_p,a.ie_irradiado)) or (coalesce(a.ie_irradiado::text, '') = ''))
	and	((a.ie_filtrado		= coalesce(ie_filtrado_p,a.ie_filtrado)) or (coalesce(a.ie_filtrado::text, '') = ''))
	and	((a.ie_aliquotado	= coalesce(ie_aliquotado_p,a.ie_aliquotado)) or (coalesce(a.ie_aliquotado::text, '') = ''))
	and	((a.nr_seq_conservante	= nr_seq_conservante_p) or (coalesce(a.nr_seq_conservante::text, '') = ''))
	and	((a.qt_volume_inicial	<= coalesce(qt_volume_p,0)) or (coalesce(a.qt_volume_inicial::text, '') = ''))
	and	((a.qt_volume_final	>= coalesce(qt_volume_p,0)) or (coalesce(a.qt_volume_final::text, '') = ''))
	order by a.qt_volume_inicial desc,
		a.qt_volume_final desc,
		a.nr_seq_conservante desc,
		a.ie_aliquotado desc,
		a.ie_filtrado desc,
		a.ie_irradiado desc,
		a.ie_lavado desc;


BEGIN
if (coalesce(nr_seq_derivado_p,0) > 0) then

	open C01;
	loop
	fetch C01 into	
		cd_bolsa_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */
		begin
		cd_bolsa_w := cd_bolsa_w;
		end;
	end loop;
	close C01;

end if;

return	cd_bolsa_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION san_obter_cod_bolsa_isbt ( nr_seq_derivado_p bigint, ie_lavado_p text, ie_irradiado_p text, ie_filtrado_p text, ie_aliquotado_p text, qt_volume_p bigint default null, nr_seq_conservante_p bigint default null) FROM PUBLIC;

