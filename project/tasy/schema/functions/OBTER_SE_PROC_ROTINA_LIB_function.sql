-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_proc_rotina_lib ( nr_seq_rotina_p bigint) RETURNS varchar AS $body$
DECLARE


 ds_retorno_w   varchar(1) := 'S';
 ie_tem_regra_w   varchar(1);
 cd_perfil_w    bigint;
 cd_estabelecimento_w bigint;
 cd_pessoa_fisica_w  varchar(255);

 
BEGIN
 
 cd_pessoa_fisica_w := obter_pf_usuario(wheb_usuario_pck.get_nm_usuario,'C');
 cd_perfil_w := obter_perfil_ativo;
 cd_estabelecimento_w := obter_estabelecimento_ativo;

 select coalesce(max('S'), 'N')
 into STRICT ie_tem_regra_w
 from pep_procedimento_rot_lib
 where nr_seq_proc_rotina = nr_seq_rotina_p;

 if (ie_tem_regra_w = 'S') then 
   select coalesce(max('S'), 'N')
   into STRICT   ds_retorno_w
   from   pep_procedimento_rot_lib
   where  nr_seq_proc_rotina = nr_seq_rotina_p
   and    coalesce(cd_estabelecimento, cd_estabelecimento_w) = coalesce(cd_estabelecimento_w, cd_estabelecimento)
   and    coalesce(cd_perfil,cd_perfil_w) = cd_perfil_w
   and    coalesce(cd_pessoa_fisica,cd_pessoa_fisica_w) = cd_pessoa_fisica_w
   and    obter_se_especialidade_medico(cd_pessoa_fisica_w, cd_especialidade) = 'S';
  end if;

 return ds_retorno_w;

 end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_proc_rotina_lib ( nr_seq_rotina_p bigint) FROM PUBLIC;

