-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_lado_proced_atend ( nr_atendimento_p bigint, cd_proc_principal_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


/*
C - Código;
D - Descrição;
*/
/*
Esta funtion foi criada para o Hospital HBO, a partir da OS 28090,
para atender a solicitação, referente ao relatório (CATE 2906 HBO -  Etiqueta Atendimento).
Conforme histórico documentado na OS de 13.01.06 12:30:55
*/
ds_retorno_w		varchar(255);
ie_lado_w		varchar(01);


BEGIN

if (nr_atendimento_p IS NOT NULL AND nr_atendimento_p::text <> '') and (cd_proc_principal_p IS NOT NULL AND cd_proc_principal_p::text <> '') then
	select	max(a.ie_lado)
	into STRICT	ie_lado_w
	from	prescr_procedimento a,
		prescr_medica b
	where	a.nr_prescricao	= b.nr_prescricao
	and	a.nr_prescricao	=
				(
				SELECT	max(x.nr_prescricao)
		  		from   	prescr_procedimento x,
					prescr_medica y
				where  	x.nr_prescricao		= y.nr_prescricao
				and	x.cd_procedimento   	= cd_proc_principal_p
				and	y.nr_atendimento	= nr_atendimento_p
				)
	and	a.cd_procedimento	= cd_proc_principal_p
	and	b.nr_atendimento 	= nr_atendimento_p;

	if (ie_opcao_p	= 'C')	then
		ds_retorno_w	:= ie_lado_w;
	elsif (ie_opcao_p	= 'D')	then
		ds_retorno_w	:= obter_valor_dominio(1372, ie_lado_w);
	end if;
end if;

RETURN	ds_retorno_w;

END	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_lado_proced_atend ( nr_atendimento_p bigint, cd_proc_principal_p bigint, ie_opcao_p text) FROM PUBLIC;

