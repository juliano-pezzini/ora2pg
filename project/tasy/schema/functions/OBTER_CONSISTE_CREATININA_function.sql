-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_consiste_creatinina ( nr_sequencia_p bigint, nr_seq_material_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


/*
Pasta protocolo 		Nr_seq_paciente_w 	:= nr_sequencia_p
			Ie_opcao_p	:= P

Pasta atendimento do ciclo	Nr_seq_atendimento_w := nr_sequencia_p
			Ie_opcao_p	:= A
*/
nr_sequencia_w	integer;
qt_reg_w	bigint;


BEGIN

if (ie_opcao_p = 'P') then

	select   count(*)
	into STRICT	 qt_reg_w
	from     paciente_protocolo_medic a
	where    coalesce(a.nr_seq_diluicao::text, '') = ''
	and	 a.nr_seq_paciente = nr_sequencia_p
	and	 a.nr_seq_material = nr_seq_material_p
	and 	 coalesce(a.nr_seq_diluicao::text, '') = ''
	and 	 coalesce(a.nr_seq_solucao::text, '') = ''
	and 	 coalesce(a.nr_seq_procedimento::text, '') = ''
	and 	exists (SELECT   1
		     from     unidade_medida b
		     where    a.cd_unidade_medida = b.cd_unidade_medida
		     and      b.cd_unidade_medida <> b.cd_unidade_med_princ
		     and      b.cd_unidade_med_sec = 'mgc');

elsif (ie_opcao_p = 'A') then

	select   count(*)
	into STRICT	 qt_reg_w
	from     paciente_atend_medic a
	where    coalesce(a.nr_seq_diluicao::text, '') = ''
	and	 a.nr_seq_atendimento = nr_sequencia_p
	and      a.nr_seq_material = nr_seq_material_p
	and 	 coalesce(a.nr_seq_diluicao::text, '') = ''
	and 	 coalesce(a.nr_seq_solucao::text, '') = ''
	and 	 coalesce(a.nr_seq_procedimento::text, '') = ''
	and exists (SELECT   1
		     from     unidade_medida b
		     where    a.cd_unid_med_dose = b.cd_unidade_medida
		     and      b.cd_unidade_medida <> b.cd_unidade_med_princ
		     and      b.cd_unidade_med_sec = 'mgc');
end if;

if (qt_reg_w > 0) then
	return	'S';
else
	return	'N';
end	if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_consiste_creatinina ( nr_sequencia_p bigint, nr_seq_material_p bigint, ie_opcao_p text) FROM PUBLIC;

