-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_dados_evento_portal ( ie_tipo_evento_p text, ie_tipo_usuario_p text, nr_seq_evento_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE



/*
ie_opcao_p
'SEQMOD' - SequÃªncia do modelo
*/
nr_seq_modelo_w		bigint;
ds_retorno_w		varchar(255);

BEGIN

select 	coalesce(max(nr_seq_modelo),0)
into STRICT	nr_seq_modelo_w
from   	pls_evento_portal_web
where  	(dt_inicio_vigencia IS NOT NULL AND dt_inicio_vigencia::text <> '')
and    	ie_tipo_usuario = ie_tipo_usuario_p
and    	nr_sequencia = nr_seq_evento_p
and    	ie_tipo_evento = ie_tipo_evento_p
and    	ie_situacao = 'A'
and    	(nr_seq_modelo IS NOT NULL AND nr_seq_modelo::text <> '')
and (clock_timestamp() between to_date(dt_inicio_vigencia) and to_date(dt_fim_vigencia+1) or (coalesce(dt_fim_vigencia::text, '') = '' and clock_timestamp() > dt_inicio_vigencia));

if (ie_opcao_p = 'SEQMOD') then
	ds_retorno_w	:= to_char(nr_seq_modelo_w);
end if;

return ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_dados_evento_portal ( ie_tipo_evento_p text, ie_tipo_usuario_p text, nr_seq_evento_p bigint, ie_opcao_p text) FROM PUBLIC;

