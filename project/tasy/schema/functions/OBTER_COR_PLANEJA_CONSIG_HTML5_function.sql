-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_cor_planeja_consig_html5 ( nr_seq_agenda_p bigint, nr_seq_age_consig_p bigint, ie_linha_coluna_p text, ie_coluna_p text) RETURNS bigint AS $body$
DECLARE



nr_seq_retorno_w	bigint	:= NULL;
nr_seq_cor_w		bigint	:= NULL;

c00 CURSOR FOR
	SELECT	nr_sequencia
	FROM	(SELECT	a.nr_sequencia,
			b.dt_atualizacao
		FROM	regra_cor_planej_consig a,
			agenda_reg_cor_plan_consig b
		WHERE	a.nr_sequencia		= b.nr_seq_status
		AND	((b.nr_seq_age_consig	= nr_seq_age_consig_p AND nr_seq_age_consig_p IS NOT NULL AND nr_seq_age_consig_p::text <> '') OR
			 (b.nr_seq_agenda	= nr_seq_agenda_p AND nr_seq_agenda_p IS NOT NULL AND nr_seq_agenda_p::text <> ''))
		AND	b.ie_linha_coluna	= ie_linha_coluna_p
		AND	coalesce(b.ie_coluna,'XPTO')	= coalesce(ie_coluna_p,'XPTO')
		AND	coalesce(a.ie_situacao,'A')	= 'A'
		
UNION

		SELECT	NULL nr_sequencia,
			dt_atualizacao
		FROM	agenda_reg_cor_plan_consig
		WHERE	coalesce(nr_seq_status::text, '') = ''
		AND	((nr_seq_age_consig	= nr_seq_age_consig_p AND nr_seq_age_consig_p IS NOT NULL AND nr_seq_age_consig_p::text <> '') OR
			 (nr_seq_agenda	= nr_seq_agenda_p AND nr_seq_agenda_p IS NOT NULL AND nr_seq_agenda_p::text <> ''))
		AND	ie_linha_coluna		= ie_linha_coluna_p
		AND	coalesce(ie_coluna,'XPTO')	= coalesce(ie_coluna_p,'XPTO')) alias12
	ORDER BY dt_atualizacao;


BEGIN

OPEN c00;
LOOP
FETCH c00 INTO
	nr_seq_cor_w;
EXIT WHEN NOT FOUND; /* apply on c00 */
	nr_seq_retorno_w	:= nr_seq_cor_w;
END LOOP;
CLOSE c00;

RETURN	nr_seq_retorno_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_cor_planeja_consig_html5 ( nr_seq_agenda_p bigint, nr_seq_age_consig_p bigint, ie_linha_coluna_p text, ie_coluna_p text) FROM PUBLIC;

