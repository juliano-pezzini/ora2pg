-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_tnm_loco_regional ( NR_SEQUENCIA_P bigint) RETURNS varchar AS $body$
DECLARE

  ds_retorno_w varchar(4);

BEGIN
  SELECT TO_CHAR(MAX(dt_edicao),'yyyy')
  INTO STRICT ds_retorno_w
  FROM CAN_LOCO_REGIONAL a,
    CAN_ESTADIO b,
    CAN_TNM_LOCALIZACAO c
  WHERE (CD_ESTADIO IS NOT NULL AND CD_ESTADIO::text <> '')
  AND coalesce(a.CD_TUMOR_PRIMARIO,0)      = coalesce(b.CD_TUMOR_PRIMARIO,0)
  AND coalesce(a.CD_LINFONODO_REGIONAL,0)  = coalesce(b.CD_LINFONODO_REGIONAL,0)
  AND coalesce(a.CD_METASTASE_DISTANCIA,0) = coalesce(b.CD_METASTASE_DISTANCIA,0)
  AND coalesce(a.CD_GRAU_HISTO,0)          = coalesce(b.CD_GRAU_HISTO,0)
  AND coalesce(a.CD_CATEGORIA,0)           = coalesce(b.CD_CATEGORIA,0)
  AND coalesce(a.CD_DUNKES,0)              = coalesce(b.CD_DUNKES,0)
  AND coalesce(a.CD_MAC,0)                 = coalesce(b.CD_MAC,0)
  AND b.nr_seq_loc_tnm                = c.nr_sequencia
  AND a.nr_sequencia                  = NR_SEQUENCIA_P
  AND c.IE_SITUACAO                   = 'A';
  RETURN ds_retorno_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_tnm_loco_regional ( NR_SEQUENCIA_P bigint) FROM PUBLIC;

