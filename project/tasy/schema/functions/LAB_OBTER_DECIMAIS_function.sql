-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION lab_obter_decimais ( ds_regra_p text, qt_decimal_p bigint, qt_resultado_p bigint, pr_resultado_p bigint, ds_resultado_p text) RETURNS bigint AS $body$
DECLARE


qt_decimal_w	smallint;
ds_regra_w	varchar(255);
vl_resultado_w	double precision;


BEGIN

qt_decimal_w	:= qt_decimal_p;

if (ds_regra_p IS NOT NULL AND ds_regra_p::text <> '') then
	if (position('(' in ds_regra_p) > 0) then
		ds_regra_w := substr(ds_regra_p, position('(' in ds_regra_p) + 1, 255);
		ds_regra_w := substr(ds_regra_w, 0, position(')' in ds_regra_p) - 1);
	end if;
end if;

if (ds_regra_w IS NOT NULL AND ds_regra_w::text <> '') then
	ds_regra_w	:= replace(ds_regra_w,'P',pr_resultado_p);
	ds_regra_w	:= replace(ds_regra_w,'V',qt_resultado_p);
	ds_regra_w	:= replace(ds_regra_w,'D',ds_resultado_p);
	if (position('P' in ds_regra_w) = 0) and (position('V' in ds_regra_w) = 0) and (position('D' in ds_regra_w) = 0) then
		if (coalesce(pr_resultado_p,0) <> 0) then
			ds_regra_w := pr_resultado_p || ds_regra_w;
		elsif (coalesce(qt_resultado_p,0) <> 0) then
			ds_regra_w := qt_resultado_p || ds_regra_w;
		elsif (coalesce(ds_resultado_p,0) <> '') then
			ds_regra_w := ds_resultado_p || ds_regra_w;
		end if;
	end if;
	qt_decimal_w	:= substr(ds_regra_w, position(';' in ds_regra_w) + 1, 1);
	ds_regra_w	:= substr(ds_regra_w, 0, position(';' in ds_regra_w) - 1);
	ds_regra_w	:= replace(ds_regra_w,',','.');

	vl_resultado_w := obter_valor_dinamico('select 1 from dual where ' || ds_regra_w, vl_resultado_w);

	if (coalesce(vl_resultado_w,0) <> 1) then
		qt_decimal_w :=	qt_decimal_p;
	end if;
end if;

return qt_decimal_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION lab_obter_decimais ( ds_regra_p text, qt_decimal_p bigint, qt_resultado_p bigint, pr_resultado_p bigint, ds_resultado_p text) FROM PUBLIC;

