-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_tipo_os_proj_migr (nr_seq_os_p bigint) RETURNS varchar AS $body$
DECLARE


ie_tipo_os_w	varchar(1);


BEGIN
if (nr_seq_os_p IS NOT NULL AND nr_seq_os_p::text <> '') then
	begin
	select	CASE WHEN count(*)=0 THEN 'X'  ELSE 'P' END
	into STRICT	ie_tipo_os_w
	from	proj_projeto x
	where	x.nr_seq_ordem_serv = nr_seq_os_p
	and	x.nr_seq_gerencia = 9
	and	x.nr_seq_classif = 14;

	if (ie_tipo_os_w = 'X') then
		begin
		select	CASE WHEN count(*)=0 THEN 'X'  ELSE 'R' END
		into STRICT	ie_tipo_os_w
		from	proj_projeto x,
			proj_ordem_servico o
		where	x.nr_sequencia = o.nr_seq_proj
		and	x.nr_seq_gerencia = 9
		and	x.nr_seq_classif = 14
		and	o.nr_seq_ordem = nr_seq_os_p
		and	o.ie_tipo_ordem = 'R';

		if (ie_tipo_os_w = 'X') then
			begin
			select	CASE WHEN count(*)=0 THEN 'X'  ELSE 'V' END
			into STRICT	ie_tipo_os_w
			from	proj_projeto x,
				proj_ordem_servico o
			where	x.nr_sequencia = o.nr_seq_proj
			and	x.nr_seq_gerencia = 9
			and	x.nr_seq_classif = 14
			and	o.nr_seq_ordem = nr_seq_os_p
			and	o.ie_tipo_ordem = 'V';

			if (ie_tipo_os_w = 'X') then
				begin
				select	CASE WHEN count(*)=0 THEN 'X'  ELSE 'T' END
				into STRICT	ie_tipo_os_w
				from	proj_projeto x,
					proj_ordem_servico o
				where	x.nr_sequencia = o.nr_seq_proj
				and	x.nr_seq_gerencia = 9
				and	x.nr_seq_classif = 14
				and	o.nr_seq_ordem = nr_seq_os_p
				and	o.ie_tipo_ordem = 'T';

				if (ie_tipo_os_w = 'X') then
					begin
					select	CASE WHEN count(*)=0 THEN 'X'  ELSE 'C' END
					into STRICT	ie_tipo_os_w
					from	proj_projeto x,
						proj_ordem_servico o
					where	x.nr_sequencia = o.nr_seq_proj
					and	x.nr_seq_gerencia = 9
					and	x.nr_seq_classif = 14
					and	o.nr_seq_ordem = nr_seq_os_p
					and	o.ie_tipo_ordem = 'C';

					if (ie_tipo_os_w = 'X') then
						begin
						select	CASE WHEN count(*)=0 THEN 'X'  ELSE 'U' END
						into STRICT	ie_tipo_os_w
						from	proj_projeto x,
							proj_ordem_servico o
						where	x.nr_sequencia = o.nr_seq_proj
						and	x.nr_seq_gerencia = 9
						and	x.nr_seq_classif = 14
						and	o.nr_seq_ordem = nr_seq_os_p
						and	o.ie_tipo_ordem = 'U';
						end;
					end if;
					end;
				end if;
				end;
			end if;
			end;
		end if;
		end;
	end if;
	end;
end if;
return ie_tipo_os_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_tipo_os_proj_migr (nr_seq_os_p bigint) FROM PUBLIC;

