-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_desc_proc_mat_conv (nr_sequencia_p bigint, nr_item_nf_p bigint) RETURNS varchar AS $body$
DECLARE


cd_proc_convenio_w 	nota_fiscal_item.cd_proc_convenio%type;
ds_proc_convenio_w 	nota_fiscal_item.ds_proc_convenio%type;
cd_material_convenio_w  nota_fiscal_item.cd_material_convenio%type;
ds_material_convenio_w  nota_fiscal_item.ds_material_convenio%type;
						

BEGIN


select  max(cd_proc_convenio),
	max(ds_proc_convenio), 
	max(cd_material_convenio), 
	max(ds_material_convenio)
into STRICT	cd_proc_convenio_w, 
	ds_proc_convenio_w, 
	cd_material_convenio_w,
	ds_material_convenio_w
from    nota_fiscal a,
	nota_fiscal_item b
where   a.nr_sequencia = b.nr_sequencia
and     a.nr_sequencia = nr_sequencia_p
and     b.nr_item_nf = nr_item_nf_p;

if (cd_proc_convenio_w IS NOT NULL AND cd_proc_convenio_w::text <> '') then

return to_char(cd_proc_convenio_w) || ' - ' || ds_proc_convenio_w;

elsif (cd_material_convenio_w IS NOT NULL AND cd_material_convenio_w::text <> '') then

return to_char(cd_material_convenio_w) || ' - ' || ds_material_convenio_w;

else

return null;

end if;
	

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_desc_proc_mat_conv (nr_sequencia_p bigint, nr_item_nf_p bigint) FROM PUBLIC;

