-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_origem_acesso ( NM_USUARIO_P text, DATAACESSO_P TIMESTAMP) RETURNS varchar AS $body$
DECLARE

DS_RESULTADO_W	varchar(200);

BEGIN
	BEGIN
		SELECT	A.ORIGEM_ACESSO
		INTO STRICT	DS_RESULTADO_W
		FROM ( SELECT (CD_APLICACAO_TASY || ' - ' || NM_MAQ_CLIENTE) ORIGEM_ACESSO
			FROM	TASY_LOG_ACESSO
			WHERE	UPPER(NM_USUARIO) = UPPER(NM_USUARIO_P)
			AND 	DT_ACESSO BETWEEN DATAACESSO_P-1 AND DATAACESSO_P
			ORDER 	BY DT_ACESSO DESC ) A LIMIT 1;
	EXCEPTION
	WHEN OTHERS THEN
		DS_RESULTADO_W	:= NM_USUARIO_P;
	END;
RETURN DS_RESULTADO_W;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_origem_acesso ( NM_USUARIO_P text, DATAACESSO_P TIMESTAMP) FROM PUBLIC;

