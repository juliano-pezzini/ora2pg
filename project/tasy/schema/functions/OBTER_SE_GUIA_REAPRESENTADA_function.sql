-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_guia_reapresentada ( nr_seq_ret_item_p bigint) RETURNS varchar AS $body$
DECLARE


ie_retorno_w	varchar(1) := 'N';

vl_pago_w		double precision;
vl_glosado_w	double precision;
vl_adicional_w	double precision;
vl_amenor_w		double precision;
vl_adequado_w	double precision;
vl_guia_w		double precision;


BEGIN

select	a.vl_pago,
		a.vl_glosado,
		a.vl_adicional,
		a.vl_amenor,
		a.vl_adequado,
		coalesce(b.vl_guia,0)
into STRICT	vl_pago_w,
	vl_glosado_w,
	vl_adicional_w,
	vl_amenor_w,
	vl_adequado_w,
	vl_guia_w
from conta_paciente_guia b,
	convenio_retorno_item a
where a.nr_interno_conta	= b.nr_interno_conta
  and a.cd_autorizacao		= b.cd_autorizacao
  and a.nr_sequencia		= nr_seq_ret_item_p;

if (vl_guia_w <> vl_pago_w) then
	if (vl_pago_w + vl_amenor_w + vl_glosado_w <> vl_guia_w) then
 			ie_retorno_w := 'S';
	end if;
end if;

return	ie_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_guia_reapresentada ( nr_seq_ret_item_p bigint) FROM PUBLIC;

