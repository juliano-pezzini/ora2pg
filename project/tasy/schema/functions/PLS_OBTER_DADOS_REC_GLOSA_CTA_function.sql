-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_dados_rec_glosa_cta (nr_seq_rec_glosa_cta_p pls_rec_glosa_conta.nr_sequencia%type, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


ds_retorno_w		varchar(255);
nr_seq_conta_imp_w	pls_rec_glosa_conta.nr_sequencia%type;

/*
ie_opcao_p
	'G'	- 	Guia
	'GP'	-	Guia do prestador
	'GR'	-	Guia recurso
	'S'	-	Senha
	'DTRC'	-	Dt recurso
	'DTR'	-	Dt realização
	'DTF'	-	Dt fim internação
	'CDP'	-	Prestador exec - Código
	'NDP'	-	Prestador exec - Nome
	'VLR'	-	Vl recursado
	'VLA'	- 	Vl acatado
	'LP'	- 	Lote Pagamento
*/
		

BEGIN

select	max(nr_seq_conta_imp)
into STRICT	nr_seq_conta_imp_w
from	pls_rec_glosa_conta
where	nr_sequencia	=  nr_seq_rec_glosa_cta_p;

if (ie_opcao_p = 'G') then
	select	max(cd_guia)
	into STRICT	ds_retorno_w
	from	pls_rec_glosa_conta_imp
	where	nr_sequencia = nr_seq_conta_imp_w;
	
elsif (ie_opcao_p = 'GP') then
	select	max(cd_guia_prestador)
	into STRICT	ds_retorno_w
	from	pls_rec_glosa_conta_imp
	where	nr_sequencia = nr_seq_conta_imp_w;
	
elsif (ie_opcao_p = 'GR') then
	select	max(cd_guia_recurso)
	into STRICT	ds_retorno_w
	from	pls_rec_glosa_conta_imp
	where	nr_sequencia = nr_seq_conta_imp_w;
	
elsif (ie_opcao_p = 'S') then
	select	max(ds_senha)
	into STRICT	ds_retorno_w
	from	pls_rec_glosa_conta_imp
	where	nr_sequencia = nr_seq_conta_imp_w;
	
elsif (ie_opcao_p = 'DTRC') then
	select	max(dt_recurso)
	into STRICT	ds_retorno_w
	from	pls_rec_glosa_conta_imp
	where	nr_sequencia = nr_seq_conta_imp_w;
	
elsif (ie_opcao_p = 'DTR') then
	select	max(dt_realizacao)
	into STRICT	ds_retorno_w
	from	pls_rec_glosa_conta_imp
	where	nr_sequencia = nr_seq_conta_imp_w;
	
elsif (ie_opcao_p = 'DTF') then
	select	max(dt_fim_internacao)
	into STRICT	ds_retorno_w
	from	pls_rec_glosa_conta_imp
	where	nr_sequencia = nr_seq_conta_imp_w;
	
elsif (ie_opcao_p = 'CDP') then
	select	max(cd_prestador_executor)
	into STRICT	ds_retorno_w
	from	pls_rec_glosa_conta_imp
	where	nr_sequencia	= nr_seq_conta_imp_w;
	
elsif (ie_opcao_p = 'NDP') then
	select	max(nm_prestador_executor)
	into STRICT	ds_retorno_w
	from	pls_rec_glosa_conta_imp
	where	nr_sequencia = nr_seq_conta_imp_w;

elsif (ie_opcao_p = 'VLR') then
	select	max(vl_total_recursado)
	into STRICT	ds_retorno_w
	from	pls_rec_glosa_conta_imp
	where	nr_sequencia = nr_seq_conta_imp_w;
	
elsif (ie_opcao_p = 'VLA') then
	select	coalesce(sum(coalesce(vl_acatado,0)),0)
	into STRICT	ds_retorno_w
	from (SELECT	vl_acatado
		from	pls_rec_glosa_proc
		where	nr_seq_conta_rec	= nr_seq_rec_glosa_cta_p
		
union all

		SELECT	vl_acatado
		from	pls_rec_glosa_mat
		where	nr_seq_conta_rec	= nr_seq_rec_glosa_cta_p) alias4;
		
elsif (ie_opcao_p = 'VLP') then
	select	coalesce(sum(coalesce(ri.vl_liberado,0)),0)
	into STRICT	ds_retorno_w
	from	pls_conta_rec_resumo_item ri
	where	ri.nr_seq_conta_rec = nr_seq_rec_glosa_cta_p;

elsif (ie_opcao_p = 'VGP') then
	select	coalesce(sum(coalesce(ri.vl_glosa,0)),0)
	into STRICT	ds_retorno_w
	from	pls_conta_rec_resumo_item ri
	where	ri.nr_seq_conta_rec = nr_seq_rec_glosa_cta_p;
elsif (ie_opcao_p = 'LP')	 then
	select	max(coalesce(ri.nr_seq_lote_pgto, ri.nr_seq_pp_lote))
	into STRICT	ds_retorno_w
	from	pls_conta_rec_resumo_item ri
	where	ri.nr_seq_conta_rec = nr_seq_rec_glosa_cta_p;
end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_dados_rec_glosa_cta (nr_seq_rec_glosa_cta_p pls_rec_glosa_conta.nr_sequencia%type, ie_opcao_p text) FROM PUBLIC;

