-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_rot_esp (nr_sequencia_p text, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


count_w			 bigint := 0;
ie_retorno_w	 varchar(1) := 'N';

/* ie_opcao_p
'PG' -  Protocolo de glicemia
'I'   -  Intervalo */
BEGIN


IF (ie_opcao_p = 'PG') THEN
	SELECT COUNT(b.nr_sequencia)
	INTO STRICT	count_w
	FROM   procedimento_rotina a,
		   rotina_exame b
	WHERE 1 = 1
	AND	  a.nr_seq_rotina = b.nr_sequencia
	AND	  b.nr_sequencia  = nr_sequencia_p
	AND	  coalesce(a.ie_questionar_protocolo,'N') = 'S'
	AND	  SUBSTR(obter_ctrl_glic_proc(a.nr_proc_interno),1,3) IN ('CIG','CCG');
ELSIF (ie_opcao_p = 'I') THEN
   SELECT COUNT(b.nr_sequencia)
   INTO STRICT	count_w
   FROM   procedimento_rotina a,
		  rotina_exame b
   WHERE  1 = 1
   AND	  a.nr_seq_rotina = b.nr_sequencia
   AND	  b.nr_sequencia  = nr_sequencia_p
   AND	  coalesce(a.ie_intervalo,'N') = 'S';
END IF;

IF (count_w = 1) THEN
	ie_retorno_w := 'S';
ELSE
	ie_retorno_w := 'N';
END IF;


RETURN	ie_retorno_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_rot_esp (nr_sequencia_p text, ie_opcao_p text) FROM PUBLIC;

