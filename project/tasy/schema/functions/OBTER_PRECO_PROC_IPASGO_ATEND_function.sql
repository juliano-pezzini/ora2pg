-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_preco_proc_ipasgo_atend ( nr_atendimento_p bigint, dt_conta_p timestamp, cd_procedimento_p bigint, ie_origem_proced_p bigint, nr_seq_proc_interno_p bigint, ie_resp_credito_p text, ie_opcao_p text, nr_sequencia_p bigint default 0) RETURNS bigint AS $body$
DECLARE

vl_resultado_w			double precision;
ie_tipo_atendimento_w		bigint;
cd_tipo_acomodacao_w		bigint;
cd_setor_Atendimento_w		bigint;
cd_convenio_w			bigint;
cd_categoria_w			varchar(20);
cd_plano_w			varchar(20);
cd_estabelecimento_w		bigint;
ie_clinica_w			bigint;

BEGIN
select	ie_tipo_atendimento,
	cd_tipo_acomod_conv,
	cd_setor_atendimento,
	cd_convenio,
	cd_categoria,
	cd_plano_convenio,
	cd_estabelecimento,
	ie_clinica
into STRICT	ie_tipo_atendimento_w,
	cd_tipo_acomodacao_w,
	cd_setor_Atendimento_w,
	cd_convenio_w,
	cd_categoria_w,
	cd_plano_w,
	cd_estabelecimento_w,
	ie_clinica_w
from	atendimento_paciente_v
where	nr_atendimento	= nr_atendimento_p;

if (nr_sequencia_p > 0) then

	begin
		select 	cd_setor_atendimento,
			coalesce(cd_convenio, cd_convenio_w),
			coalesce(cd_categoria, cd_categoria_w)
		into STRICT	cd_setor_Atendimento_w,
			cd_convenio_w,
			cd_categoria_w
		from 	procedimento_paciente
		where 	nr_sequencia = nr_sequencia_p;
	exception
		when others then
			cd_setor_Atendimento_w 	:= cd_setor_Atendimento_w;
			cd_convenio_w			:=	cd_convenio_w;
			cd_categoria_w			:= cd_categoria_w;
	end;

end if;

vl_resultado_w	:= obter_preco_proc_ipasgo(	cd_estabelecimento_w,
						cd_convenio_w,
						cd_categoria_w,
						dt_conta_p,
						cd_procedimento_p,
						ie_origem_proced_p,
						nr_seq_proc_interno_p,
						cd_tipo_acomodacao_w,
						ie_tipo_atendimento_w,
						cd_setor_atendimento_w,
						null,
						null,
						null,
						cd_plano_w,
						ie_clinica_w,
						null,
						ie_resp_credito_p,
						ie_opcao_p,
						nr_sequencia_p);

return	vl_resultado_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_preco_proc_ipasgo_atend ( nr_atendimento_p bigint, dt_conta_p timestamp, cd_procedimento_p bigint, ie_origem_proced_p bigint, nr_seq_proc_interno_p bigint, ie_resp_credito_p text, ie_opcao_p text, nr_sequencia_p bigint default 0) FROM PUBLIC;

