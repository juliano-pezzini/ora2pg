-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_alertas_glicemia ( NR_SEQ_ATEND_GLICEMIA_P bigint) RETURNS varchar AS $body$
DECLARE


ds_return_w			varchar(4000) := null;
ie_first_value		varchar(1) := 1;

c01 CURSOR FOR
    SELECT a.ds_alerta
    from  gqa_alerta a,
    gqa_pendencia_regra b,
    gqa_pendencia_pac c,
    atendimento_glicemia d
    where d.nr_atendimento = c.nr_atendimento
    and c.nr_seq_pend_regra = b.nr_sequencia
    and b.nr_seq_alerta = a.nr_sequencia
    and d.nr_sequencia = NR_SEQ_ATEND_GLICEMIA_P;

BEGIN

if (NR_SEQ_ATEND_GLICEMIA_P IS NOT NULL AND NR_SEQ_ATEND_GLICEMIA_P::text <> '') then

	for r_c01 in c01 loop
		if (r_c01.ds_alerta IS NOT NULL AND r_c01.ds_alerta::text <> '') then
			if (ie_first_value = 1) then
				ds_return_w := ds_return_w || r_c01.ds_alerta;
				ie_first_value := 0;
			else
				ds_return_w := ds_return_w || ',' || r_c01.ds_alerta;
			end if;
		end if;
	end loop;
end if;

return ds_return_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_alertas_glicemia ( NR_SEQ_ATEND_GLICEMIA_P bigint) FROM PUBLIC;

