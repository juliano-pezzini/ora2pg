-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION rxt_obter_status_fase (NR_SEQ_FASE_P bigint) RETURNS varchar AS $body$
DECLARE


dt_lib_prim_fisico_w    rxt_fase_tratamento.dt_lib_prim_fisico%type;
dt_aprovacao_medico_w   rxt_fase_tratamento.dt_aprovacao_medico%type;
dt_lib_seg_fisico_w     rxt_fase_tratamento.dt_lib_seg_fisico%type;
ds_status_fase_w	    varchar(10) := '';


BEGIN

select  dt_lib_prim_fisico,dt_aprovacao_medico,dt_lib_seg_fisico
into STRICT    dt_lib_prim_fisico_w,dt_aprovacao_medico_w,dt_lib_seg_fisico_w
from rxt_fase_tratamento
where nr_seq_fase_p = nr_sequencia;

if (dt_lib_seg_fisico_w IS NOT NULL AND dt_lib_seg_fisico_w::text <> '') then
    ds_status_fase_w := 'LS';
elsif (dt_aprovacao_medico_w IS NOT NULL AND dt_aprovacao_medico_w::text <> '') then
    ds_status_fase_w := 'LM';
elsif (dt_lib_prim_fisico_w IS NOT NULL AND dt_lib_prim_fisico_w::text <> '') then
    ds_status_fase_w := 'LF';
else
    ds_status_fase_w := '';
end if;
/*
ie_tipo_log
LF	Liberação do primeiro físico
LM	Liberação do médico
LS	Liberação do segundo físico
*/
return ds_status_fase_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION rxt_obter_status_fase (NR_SEQ_FASE_P bigint) FROM PUBLIC;

