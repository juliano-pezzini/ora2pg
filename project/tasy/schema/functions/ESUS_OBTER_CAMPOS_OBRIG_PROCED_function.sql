-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION esus_obter_campos_obrig_proced (nr_sequencia_p esus_ficha_proc_profis.nr_sequencia%type) RETURNS varchar AS $body$
DECLARE


nr_sequencia_w			esus_ficha_procedimento.nr_sequencia%type;
nr_sequencia_ww			esus_ficha_pro_proced.nr_sequencia%type;
ie_acupuntura_w 		esus_ficha_procedimento.ie_acupuntura%type;
ie_admini_vitamina_a_w		esus_ficha_procedimento.ie_admini_vitamina_a%type;
ie_cateterismo_vesic_w		esus_ficha_procedimento.ie_cateterismo_vesic%type;
ie_cauteriza_quimica_w		esus_ficha_procedimento.ie_cauteriza_quimica%type;
ie_cirurgia_unha_can_w		esus_ficha_procedimento.ie_cirurgia_unha_can%type;
ie_cuidado_estomas_w		esus_ficha_procedimento.ie_cuidado_estomas%type;
ie_curativo_especial_w		esus_ficha_procedimento.ie_curativo_especial%type;
ie_drenagem_abscesso_w		esus_ficha_procedimento.ie_drenagem_abscesso%type;
ie_eletrocardiograma_w		esus_ficha_procedimento.ie_eletrocardiograma%type;
ie_coleta_citop_colo_w		esus_ficha_procedimento.ie_coleta_citop_colo%type;
ie_exame_pe_diabetic_w		esus_ficha_procedimento.ie_exame_pe_diabetic%type;
ie_exe_bio_pun_tumor_w		esus_ficha_procedimento.ie_exe_bio_pun_tumor%type;
ie_fundoscopia_olho_w		esus_ficha_procedimento.ie_fundoscopia_olho%type;
ie_inf_cavi_sinovial_w		esus_ficha_procedimento.ie_inf_cavi_sinovial%type;
ie_rem_corpo_aud_nas_w		esus_ficha_procedimento.ie_rem_corpo_aud_nas%type;
ie_ret_pont_cirurgia_w		esus_ficha_procedimento.ie_ret_pont_cirurgia%type;
ie_triagem_oftalmolo_w		esus_ficha_procedimento.ie_triagem_oftalmolo%type;
ie_tamponam_epistaxe_w		esus_ficha_procedimento.ie_tamponam_epistaxe%type;
ie_test_rap_gravidez_w		esus_ficha_procedimento.ie_test_rap_gravidez%type;
ie_tr_dosag_proteinu_w		esus_ficha_procedimento.ie_tr_dosag_proteinu%type;
ie_teste_rapido_hiv_w		esus_ficha_procedimento.ie_teste_rapido_hiv%type;
ie_te_rap_hepatite_c_w		esus_ficha_procedimento.ie_te_rap_hepatite_c%type;
ie_teste_rap_sifilis_w		esus_ficha_procedimento.ie_teste_rap_sifilis%type;
ie_admin_medica_oral_w		esus_ficha_procedimento.ie_admin_medica_oral%type;
ie_adm_med_intramusc_w		esus_ficha_procedimento.ie_adm_med_intramusc%type;
ie_adm_me_endovenosa_w		esus_ficha_procedimento.ie_adm_me_endovenosa%type;
ie_adm_med_inal_nebu_w		esus_ficha_procedimento.ie_adm_med_inal_nebu%type;
ie_admin_medi_topica_w		esus_ficha_procedimento.ie_admin_medi_topica%type;
ie_penicili_trat_sif_w		esus_ficha_procedimento.ie_penicili_trat_sif%type;
ie_adim_medic_subcutanea_w	esus_ficha_procedimento.ie_adim_medic_subcutanea%type;
ie_sutura_simples_w		esus_ficha_procedimento.ie_sutura_simples%type;
qt_procedimento_w		bigint;

ds_retorno_w 	varchar(1) := 'N';

C01 CURSOR FOR
	SELECT	coalesce(max(b.nr_sequencia),0)
	from	esus_ficha_proc_profis a,
		esus_ficha_procedimento b
	where	a.nr_sequencia = b.nr_seq_ficha_pro_prof
	and	a.nr_sequencia = nr_sequencia_p;


BEGIN

open C01;
loop
fetch C01 into
	nr_sequencia_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin
	select  coalesce(ie_acupuntura,'N'),
		coalesce(ie_admini_vitamina_a,'N'),
		coalesce(ie_cateterismo_vesic,'N'),
		coalesce(ie_cauteriza_quimica,'N'),
		coalesce(ie_cirurgia_unha_can,'N'),
		coalesce(ie_cuidado_estomas,'N'),
		coalesce(ie_curativo_especial,'N'),
		coalesce(ie_drenagem_abscesso,'N'),
		coalesce(ie_eletrocardiograma,'N'),
		coalesce(ie_coleta_citop_colo,'N'),
		coalesce(ie_exame_pe_diabetic,'N'),
		coalesce(ie_exe_bio_pun_tumor,'N'),
		coalesce(ie_fundoscopia_olho,'N'),
		coalesce(ie_inf_cavi_sinovial,'N'),
		coalesce(ie_rem_corpo_aud_nas,'N'),
		coalesce(ie_ret_pont_cirurgia,'N'),
		coalesce(ie_triagem_oftalmolo,'N'),
		coalesce(ie_tamponam_epistaxe,'N'),
		coalesce(ie_test_rap_gravidez,'N'),
		coalesce(ie_tr_dosag_proteinu,'N'),
		coalesce(ie_teste_rapido_hiv,'N'),
		coalesce(ie_te_rap_hepatite_c,'N'),
		coalesce(ie_teste_rap_sifilis,'N'),
		coalesce(ie_admin_medica_oral,'N'),
		coalesce(ie_adm_med_intramusc,'N'),
		coalesce(ie_adm_me_endovenosa,'N'),
		coalesce(ie_adm_med_inal_nebu,'N'),
		coalesce(ie_admin_medi_topica,'N'),
		coalesce(ie_penicili_trat_sif,'N'),
		coalesce(ie_adim_medic_subcutanea,'N'),
		coalesce(ie_sutura_simples,'N')
	into STRICT	ie_acupuntura_w,
		ie_admini_vitamina_a_w,
		ie_cateterismo_vesic_w,
		ie_cauteriza_quimica_w,
		ie_cirurgia_unha_can_w,
		ie_cuidado_estomas_w,
		ie_curativo_especial_w,
		ie_drenagem_abscesso_w,
		ie_eletrocardiograma_w,
		ie_coleta_citop_colo_w,
		ie_exame_pe_diabetic_w,
		ie_exe_bio_pun_tumor_w,
		ie_fundoscopia_olho_w,
		ie_inf_cavi_sinovial_w,
		ie_rem_corpo_aud_nas_w,
		ie_ret_pont_cirurgia_w,
		ie_triagem_oftalmolo_w,
		ie_tamponam_epistaxe_w,
		ie_test_rap_gravidez_w,
		ie_tr_dosag_proteinu_w,
		ie_teste_rapido_hiv_w,
		ie_te_rap_hepatite_c_w,
		ie_teste_rap_sifilis_w,
		ie_admin_medica_oral_w,
		ie_adm_med_intramusc_w,
		ie_adm_me_endovenosa_w,
		ie_adm_med_inal_nebu_w,
		ie_admin_medi_topica_w,
		ie_penicili_trat_sif_w,
		ie_adim_medic_subcutanea_w,
		ie_sutura_simples_w
	from esus_ficha_procedimento
	where nr_sequencia = nr_sequencia_w;

	if (ds_retorno_w = 'N') then
		begin
		if ((ie_acupuntura_w = 'N') and (ie_admini_vitamina_a_w = 'N') and (ie_cateterismo_vesic_w = 'N') and (ie_cauteriza_quimica_w = 'N') and (ie_cirurgia_unha_can_w = 'N') and (ie_cuidado_estomas_w = 'N') and (ie_curativo_especial_w = 'N') and (ie_drenagem_abscesso_w = 'N') and (ie_eletrocardiograma_w = 'N') and (ie_coleta_citop_colo_w = 'N') and (ie_exame_pe_diabetic_w = 'N') and (ie_exe_bio_pun_tumor_w = 'N') and (ie_fundoscopia_olho_w = 'N') and (ie_inf_cavi_sinovial_w = 'N') and (ie_rem_corpo_aud_nas_w = 'N') and (ie_ret_pont_cirurgia_w = 'N') and (ie_triagem_oftalmolo_w = 'N') and (ie_tamponam_epistaxe_w = 'N') and (ie_test_rap_gravidez_w = 'N') and (ie_tr_dosag_proteinu_w = 'N') and (ie_teste_rapido_hiv_w = 'N') and (ie_te_rap_hepatite_c_w = 'N') and (ie_teste_rap_sifilis_w = 'N') and (ie_admin_medica_oral_w = 'N') and (ie_adm_med_intramusc_w = 'N') and (ie_adm_me_endovenosa_w = 'N') and (ie_adm_med_inal_nebu_w = 'N') and (ie_admin_medi_topica_w = 'N') and (ie_penicili_trat_sif_w = 'N') and (ie_adim_medic_subcutanea_w = 'N') and (ie_sutura_simples_w = 'N')) then
			ds_retorno_w := 'S';
		end if;

		select  count(*)
		into STRICT	qt_procedimento_w
		from 	esus_ficha_pro_proced
		where 	nr_seq_ficha_proc = nr_sequencia_w;

		if (qt_procedimento_w = 0) then
			ds_retorno_w := 'S';
		end if;
		end;
	end if;
	end;
end loop;
close C01;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION esus_obter_campos_obrig_proced (nr_sequencia_p esus_ficha_proc_profis.nr_sequencia%type) FROM PUBLIC;

