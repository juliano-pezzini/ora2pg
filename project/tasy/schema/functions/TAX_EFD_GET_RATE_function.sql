-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION tax_efd_get_rate (tribute_code_p bigint, establishment_code_p bigint, invoice_code_p bigint) RETURNS bigint AS $body$
DECLARE

  rate_w        double precision;

BEGIN
  /* NOTA_FISCAL_ITEM_TRIB */

  select  max(tx_tributo)
  into STRICT    rate_w
  from    nota_fiscal_item_trib
  where   nr_sequencia = invoice_code_p
  and     cd_estabelecimento = establishment_code_p
  and     cd_tributo = tribute_code_p;

  if coalesce(rate_w::text, '') = '' then
    /* NOTA_FISCAL_TRIB */

    select  max(tx_tributo)
    into STRICT    rate_w
    from    nota_fiscal_trib
    where   nr_sequencia = invoice_code_p
    and     cd_tributo = tribute_code_p;
  end if;

  return coalesce(rate_w, obter_pr_imposto(tribute_code_p, establishment_code_p));
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION tax_efd_get_rate (tribute_code_p bigint, establishment_code_p bigint, invoice_code_p bigint) FROM PUBLIC;

