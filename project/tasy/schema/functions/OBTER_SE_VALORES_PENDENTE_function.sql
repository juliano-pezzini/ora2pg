-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_valores_pendente ( cd_pessoa_fisica_p text, cd_estabelecimento_p bigint, ie_parametro_p text, ie_chamada_rotina_p text default null) RETURNS varchar AS $body$
DECLARE

 
count_w			bigint;
ds_retorno_w		varchar(255);
ie_gera_atendimento_w	varchar(2);
nm_usuario_w		varchar(255);
ie_valores_pendentes_w	varchar(1);


BEGIN 
 
select	wheb_usuario_pck.get_nm_usuario 
into STRICT	nm_usuario_w
;
 
ie_gera_atendimento_w := Obter_Param_Usuario(916, 1026, obter_perfil_ativo, nm_usuario_w, cd_estabelecimento_p, ie_gera_atendimento_w);
ie_valores_pendentes_w := Obter_Param_Usuario(-815, 6, obter_perfil_ativo, nm_usuario_w, cd_estabelecimento_p, ie_valores_pendentes_w);
 
/*lhalves em 18/07/2013. 
Alterada function para fazer os demais selects apenas se não encontrar no anterior, pois se existir em um já retorno S 
*/
 
 
/* títulos */
 
 
if (coalesce(ie_valores_pendentes_w,'N') = 'N') then 
	 
	begin 
	select	1 
	into STRICT	count_w 
	from	parametro_contas_receber e, 
		atend_categoria_convenio d, 
		convenio c, 
		atendimento_paciente a, 
		titulo_receber b 
	where	b.nr_atendimento 	= a.nr_atendimento 
	and	a.nr_atendimento 	= d.nr_atendimento 
	and	b.cd_estabelecimento	= e.cd_estabelecimento 
	and	obter_atecaco_atendimento(a.nr_atendimento) = d.nr_seq_interno 
	and 	((b.ie_situacao  = 1 or 
		exists (	SELECT  1 
			from   cobranca o 
			where  o.nr_titulo = b.nr_titulo 
			and   o.ie_status = 'P')) or (e.ie_tit_perda_pendencia = 'S' 
		and exists (	select	1 
				from	titulo_receber_liq x, 
					tipo_recebimento z 
				where	x.cd_tipo_recebimento = z.cd_tipo_recebimento 
				and	b.nr_titulo = x.nr_titulo 
				and	z.ie_tipo_consistencia = 9) 
		and exists (	select	1 
				from	cobranca o 
				where	o.nr_titulo = b.nr_titulo 
				and	o.ie_status = 'E'))) 
	and	coalesce(b.nr_interno_conta::text, '') = '' 
	and	d.cd_convenio		= c.cd_convenio 
	and	a.cd_pessoa_fisica	= cd_pessoa_fisica_p 
	and	c.ie_tipo_convenio	= 1 
	and (0 = cd_estabelecimento_p or 
		b.cd_estabelecimento 	= cd_estabelecimento_p or 
		obter_estab_financeiro(b.cd_estabelecimento) = cd_estabelecimento_p) 
	and	((coalesce(trunc(b.dt_pagamento_previsto),clock_timestamp() - interval '1 days') < trunc(clock_timestamp())) or (ie_parametro_p = 'N'))  LIMIT 1;
	exception 
	when no_data_found then 
		count_w := 0;
	end;
else 
	begin 
	 
	select	1 
	into STRICT	count_w 
	from( 
	SELECT	1 
	from	parametro_contas_receber e, 
		atend_categoria_convenio d, 
		convenio c, 
		atendimento_paciente a, 
		titulo_receber b 
	where	b.nr_atendimento 	= a.nr_atendimento 
	and	a.nr_atendimento 	= d.nr_atendimento 
	and	b.cd_estabelecimento	= e.cd_estabelecimento 
	and	obter_atecaco_atendimento(a.nr_atendimento) = d.nr_seq_interno 
	and 	((b.ie_situacao  = 1 or 
		exists (	SELECT  1 
			from   cobranca o 
			where  o.nr_titulo = b.nr_titulo 
			and   o.ie_status = 'P')) or (e.ie_tit_perda_pendencia = 'S' 
		and exists (	select	1 
				from	titulo_receber_liq x, 
					tipo_recebimento z 
				where	x.cd_tipo_recebimento = z.cd_tipo_recebimento 
				and	b.nr_titulo = x.nr_titulo 
				and	z.ie_tipo_consistencia = 9) 
		and exists (	select	1 
				from	cobranca o 
				where	o.nr_titulo = b.nr_titulo 
				and	o.ie_status = 'E'))) 
	and	coalesce(b.nr_interno_conta::text, '') = '' 
	and	d.cd_convenio		= c.cd_convenio 
	and	a.cd_pessoa_fisica	= cd_pessoa_fisica_p 
	and	c.ie_tipo_convenio	= 1 
	and (0 = cd_estabelecimento_p or 
		b.cd_estabelecimento 	= cd_estabelecimento_p or 
		obter_estab_financeiro(b.cd_estabelecimento) = cd_estabelecimento_p) 
	and	((coalesce(trunc(b.dt_pagamento_previsto),clock_timestamp() - interval '1 days') < trunc(clock_timestamp())) or (ie_parametro_p = 'N'))  
	
union
 
	select	1 
	from	parametro_contas_receber e, 
		atend_categoria_convenio d, 
		convenio c, 
		atendimento_paciente a, 
		titulo_receber b 
	where	b.nr_atendimento 	= a.nr_atendimento 
	and	a.nr_atendimento 	= d.nr_atendimento 
	and	b.cd_estabelecimento	= e.cd_estabelecimento 
	and	obter_atecaco_atendimento(a.nr_atendimento) = d.nr_seq_interno 
	and 	((b.ie_situacao  = 1 or 
	exists (	select  1 
		from   cobranca o 
		where  o.nr_titulo = b.nr_titulo 
		and   o.ie_status = 'P')) or (e.ie_tit_perda_pendencia = 'S' 
	and exists (	select	1 
			from	titulo_receber_liq x, 
				tipo_recebimento z 
			where	x.cd_tipo_recebimento = z.cd_tipo_recebimento 
			and	b.nr_titulo = x.nr_titulo 
			and	z.ie_tipo_consistencia = 9) 
	and exists (	select	1 
			from	cobranca o 
			where	o.nr_titulo = b.nr_titulo 
			and	o.ie_status = 'E'))) 
	and	coalesce(b.nr_interno_conta::text, '') = '' 
	and	d.cd_convenio		= c.cd_convenio 
	and	exists (select 1 
		from  compl_pessoa_fisica x 
		where  x.cd_pessoa_fisica   = a.cd_pessoa_fisica 
		and   x.ie_tipo_complemento  = 3 
		and   x.cd_pessoa_fisica_ref = cd_pessoa_fisica_p) 
	and	c.ie_tipo_convenio	= 1 
	and (0 = cd_estabelecimento_p or b.cd_estabelecimento 	= cd_estabelecimento_p or obter_estab_financeiro(b.cd_estabelecimento) = cd_estabelecimento_p) 
	and	((coalesce(trunc(b.dt_pagamento_previsto),clock_timestamp() - interval '1 days') < trunc(clock_timestamp())) or (ie_parametro_p = 'N'))  LIMIT 1);
	exception 
	when no_data_found then 
	count_w := 0;
	end;
end if;
 
if (count_w = 0) then 
 
	if (coalesce(ie_valores_pendentes_w,'N') = 'N') then 
		begin 
		select	1 
		into STRICT	count_w 
		from	parametro_contas_receber e, 
			convenio d, 
			titulo_receber c, 
			conta_paciente b, 
			atendimento_paciente a 
		where	a.nr_atendimento	= b.nr_atendimento 
		and	b.nr_interno_conta	= c.nr_interno_conta 
		and	b.cd_convenio_parametro	= d.cd_convenio 
		and	c.cd_estabelecimento	= e.cd_estabelecimento 
		and	d.ie_tipo_convenio	= 1 
		and	a.cd_pessoa_fisica	= cd_pessoa_fisica_p 
		and 	((c.ie_situacao  = 1 or 
			exists (	SELECT  1 
				from   cobranca o 
				where  o.nr_titulo = c.nr_titulo 
				and   o.ie_status = 'P')) or (e.ie_tit_perda_pendencia = 'S' 
			and exists (	select	1 
					from	titulo_receber_liq x, 
						tipo_recebimento z 
					where	x.cd_tipo_recebimento = z.cd_tipo_recebimento 
					and	c.nr_titulo = x.nr_titulo 
					and	z.ie_tipo_consistencia = 9) 
			and exists (	select	1 
					from	cobranca o 
					where	o.nr_titulo = c.nr_titulo 
					and	o.ie_status = 'E'))) 
		and (0 = cd_estabelecimento_p or 
			c.cd_estabelecimento 	= cd_estabelecimento_p or 
			obter_estab_financeiro(c.cd_estabelecimento) = cd_estabelecimento_p) 
		and	((coalesce(trunc(c.dt_pagamento_previsto),clock_timestamp() - interval '1 days') < trunc(clock_timestamp())) or (ie_parametro_p = 'N'))  LIMIT 1;
		exception 
		when no_data_found then 
			count_w := 0;
		end;
	else 
		begin 
		select	1 
		into STRICT	count_w 
		from( 
		SELECT	1 
		from	parametro_contas_receber e, 
			convenio d, 
			titulo_receber c, 
			conta_paciente b, 
			atendimento_paciente a 
		where	a.nr_atendimento	= b.nr_atendimento 
		and	b.nr_interno_conta	= c.nr_interno_conta 
		and	b.cd_convenio_parametro	= d.cd_convenio 
		and	c.cd_estabelecimento	= e.cd_estabelecimento 
		and	d.ie_tipo_convenio	= 1 
		and	a.cd_pessoa_fisica	= cd_pessoa_fisica_p 
		and 	((c.ie_situacao  = 1 or 
			exists (	SELECT  1 
				from   cobranca o 
				where  o.nr_titulo = c.nr_titulo 
				and   o.ie_status = 'P')) or (e.ie_tit_perda_pendencia = 'S' 
			and exists (	select	1 
					from	titulo_receber_liq x, 
						tipo_recebimento z 
					where	x.cd_tipo_recebimento = z.cd_tipo_recebimento 
					and	c.nr_titulo = x.nr_titulo 
					and	z.ie_tipo_consistencia = 9) 
			and exists (	select	1 
					from	cobranca o 
					where	o.nr_titulo = c.nr_titulo 
					and	o.ie_status = 'E'))) 
		and (0 = cd_estabelecimento_p or 
			c.cd_estabelecimento 	= cd_estabelecimento_p or 
			obter_estab_financeiro(c.cd_estabelecimento) = cd_estabelecimento_p) 
		and	((coalesce(trunc(c.dt_pagamento_previsto),clock_timestamp() - interval '1 days') < trunc(clock_timestamp())) or (ie_parametro_p = 'N'))  
		
union
 
		select	1 
		from	parametro_contas_receber e, 
			convenio d, 
			titulo_receber c, 
			conta_paciente b, 
			atendimento_paciente a 
		where	a.nr_atendimento	= b.nr_atendimento 
		and	b.nr_interno_conta	= c.nr_interno_conta 
		and	b.cd_convenio_parametro	= d.cd_convenio 
		and	c.cd_estabelecimento	= e.cd_estabelecimento 
		and	d.ie_tipo_convenio	= 1 
		and	exists (select 1 
				from  compl_pessoa_fisica x 
				where  x.cd_pessoa_fisica   = a.cd_pessoa_fisica 
				and   x.ie_tipo_complemento  = 3 
				and   x.cd_pessoa_fisica_ref = cd_pessoa_fisica_p) 
		and 	((c.ie_situacao  = 1 or 
			exists (	select  1 
				from   cobranca o 
				where  o.nr_titulo = c.nr_titulo 
				and   o.ie_status = 'P')) or (e.ie_tit_perda_pendencia = 'S' 
			and exists (	select	1 
					from	titulo_receber_liq x, 
						tipo_recebimento z 
					where	x.cd_tipo_recebimento = z.cd_tipo_recebimento 
					and	c.nr_titulo = x.nr_titulo 
					and	z.ie_tipo_consistencia = 9) 
			and exists (	select	1 
					from	cobranca o 
					where	o.nr_titulo = c.nr_titulo 
					and	o.ie_status = 'E'))) 
		and (0 = cd_estabelecimento_p or 
			c.cd_estabelecimento 	= cd_estabelecimento_p or 
			obter_estab_financeiro(c.cd_estabelecimento) = cd_estabelecimento_p) 
		and	((coalesce(trunc(c.dt_pagamento_previsto),clock_timestamp() - interval '1 days') < trunc(clock_timestamp())) or (ie_parametro_p = 'N'))  LIMIT 1);
		exception 
		when no_data_found then 
			count_w := 0;
		end;
	end if;
 
	if (count_w = 0) then 
 
		if (coalesce(ie_valores_pendentes_w,'N') = 'N') then 
		 
			begin 
			select	1 
			into STRICT	count_w 
			from	parametro_contas_receber e, 
				convenio d, 
				titulo_receber c 
			where	c.cd_convenio_conta 	= d.cd_convenio 
			and	c.cd_estabelecimento	= e.cd_estabelecimento 
			and	c.cd_pessoa_fisica	= cd_pessoa_fisica_p 
			and	coalesce(c.nr_atendimento::text, '') = '' 
			and	coalesce(c.nr_interno_conta::text, '') = '' 
			and	coalesce(c.nr_seq_protocolo::text, '') = '' 
			and	d.ie_tipo_convenio	= 1 
			and 	((c.ie_situacao  = 1 or 
				exists (	SELECT  1 
					from   cobranca o 
					where  o.nr_titulo = c.nr_titulo 
					and   o.ie_status = 'P')) or (e.ie_tit_perda_pendencia = 'S' 
				and exists (	select	1 
						from	titulo_receber_liq x, 
							tipo_recebimento z 
						where	x.cd_tipo_recebimento = z.cd_tipo_recebimento 
						and	c.nr_titulo = x.nr_titulo 
						and	z.ie_tipo_consistencia = 9) 
				and exists (	select	1 
						from	cobranca o 
						where	o.nr_titulo = c.nr_titulo 
						and	o.ie_status = 'E'))) 
			and (0 = cd_estabelecimento_p or 
				c.cd_estabelecimento = cd_estabelecimento_p or 
				obter_estab_financeiro(c.cd_estabelecimento) = cd_estabelecimento_p) 
			and	((coalesce(trunc(c.dt_pagamento_previsto),clock_timestamp() - interval '1 days') < trunc(clock_timestamp())) or (ie_parametro_p = 'N'))  LIMIT 1;
			exception 
			when no_data_found then 
				count_w := 0;
			end;
		else 
			begin 
			select	1 
			into STRICT	count_w 
			from( 
			SELECT	1 
			from	parametro_contas_receber e, 
				convenio d, 
				titulo_receber c 
			where	c.cd_convenio_conta 	= d.cd_convenio 
			and	c.cd_estabelecimento	= e.cd_estabelecimento 
			and	c.cd_pessoa_fisica	= cd_pessoa_fisica_p 
			and	coalesce(c.nr_atendimento::text, '') = '' 
			and	coalesce(c.nr_interno_conta::text, '') = '' 
			and	coalesce(c.nr_seq_protocolo::text, '') = '' 
			and	d.ie_tipo_convenio	= 1 
			and 	((c.ie_situacao  = 1 or 
				exists (	SELECT  1 
					from   cobranca o 
					where  o.nr_titulo = c.nr_titulo 
					and   o.ie_status = 'P')) or (e.ie_tit_perda_pendencia = 'S' 
				and exists (	select	1 
						from	titulo_receber_liq x, 
							tipo_recebimento z 
						where	x.cd_tipo_recebimento = z.cd_tipo_recebimento 
						and	c.nr_titulo = x.nr_titulo 
						and	z.ie_tipo_consistencia = 9) 
				and exists (	select	1 
						from	cobranca o 
						where	o.nr_titulo = c.nr_titulo 
						and	o.ie_status = 'E'))) 
			and (0 = cd_estabelecimento_p or 
				c.cd_estabelecimento = cd_estabelecimento_p or 
				obter_estab_financeiro(c.cd_estabelecimento) = cd_estabelecimento_p) 
			and	((coalesce(trunc(c.dt_pagamento_previsto),clock_timestamp() - interval '1 days') < trunc(clock_timestamp())) or (ie_parametro_p = 'N'))  
			
union
 
			select	1 
			from	parametro_contas_receber e, 
				convenio d, 
				titulo_receber c 
			where	c.cd_convenio_conta 	= d.cd_convenio 
			and	c.cd_estabelecimento	= e.cd_estabelecimento 
			and	exists (select 1 
					from  compl_pessoa_fisica x 
					where  x.cd_pessoa_fisica   = c.cd_pessoa_fisica 
					and   x.ie_tipo_complemento  = 3 
					and   x.cd_pessoa_fisica_ref = cd_pessoa_fisica_p) 
			and	coalesce(c.nr_atendimento::text, '') = '' 
			and	coalesce(c.nr_interno_conta::text, '') = '' 
			and	coalesce(c.nr_seq_protocolo::text, '') = '' 
			and	d.ie_tipo_convenio	= 1 
			and 	((c.ie_situacao  = 1 or 
				exists (	select  1 
					from   cobranca o 
					where  o.nr_titulo = c.nr_titulo 
					and   o.ie_status = 'P')) or (e.ie_tit_perda_pendencia = 'S' 
				and exists (	select	1 
						from	titulo_receber_liq x, 
							tipo_recebimento z 
						where	x.cd_tipo_recebimento = z.cd_tipo_recebimento 
						and	c.nr_titulo = x.nr_titulo 
						and	z.ie_tipo_consistencia = 9) 
				and exists (	select	1 
						from	cobranca o 
						where	o.nr_titulo = c.nr_titulo 
						and	o.ie_status = 'E'))) 
			and (0 = cd_estabelecimento_p or 
				c.cd_estabelecimento = cd_estabelecimento_p or 
				obter_estab_financeiro(c.cd_estabelecimento) = cd_estabelecimento_p) 
			and	((coalesce(trunc(c.dt_pagamento_previsto),clock_timestamp() - interval '1 days') < trunc(clock_timestamp())) or (ie_parametro_p = 'N'))  LIMIT 1);
			exception 
			when no_data_found then 
				count_w := 0;
			end;
		end if;
 
		if (count_w = 0) then 
 
			if (coalesce(ie_valores_pendentes_w,'N') = 'N') then 
				begin 
				select	1 
				into STRICT	count_w 
				from	parametro_contas_receber e, 
					titulo_receber c 
				where	c.cd_estabelecimento	= e.cd_estabelecimento 
				and	c.cd_pessoa_fisica	= cd_pessoa_fisica_p 
				and	coalesce(c.nr_atendimento::text, '') = '' 
				and	coalesce(c.nr_interno_conta::text, '') = '' 
				and	coalesce(c.nr_seq_protocolo::text, '') = '' 
				and	coalesce(c.cd_convenio_conta::text, '') = '' 
				and 	((c.ie_situacao  = 1 or 
					exists (	SELECT  1 
						from   cobranca o 
						where  o.nr_titulo = c.nr_titulo 
						and   o.ie_status = 'P')) or (e.ie_tit_perda_pendencia = 'S' 
					and exists (	select	1 
							from	titulo_receber_liq x, 
								tipo_recebimento z 
							where	x.cd_tipo_recebimento = z.cd_tipo_recebimento 
							and	c.nr_titulo = x.nr_titulo 
							and	z.ie_tipo_consistencia = 9) 
					and exists (	select	1 
							from	cobranca o 
							where	o.nr_titulo = c.nr_titulo 
							and	o.ie_status = 'E'))) 
				and (0 = cd_estabelecimento_p or 
					c.cd_estabelecimento = cd_estabelecimento_p or 
					obter_estab_financeiro(c.cd_estabelecimento) = cd_estabelecimento_p) 
				and	((coalesce(trunc(c.dt_pagamento_previsto),clock_timestamp() - interval '1 days') < trunc(clock_timestamp())) or (ie_parametro_p = 'N'))  LIMIT 1;
				exception 
				when no_data_found then 
					count_w := 0;
				end;
			else 
				begin 
				select	1 
				into STRICT	count_w 
				from( 
				SELECT	1 
				from	parametro_contas_receber e, 
					titulo_receber c 
				where	c.cd_estabelecimento	= e.cd_estabelecimento 
				and	c.cd_pessoa_fisica	= cd_pessoa_fisica_p 
				and	coalesce(c.nr_atendimento::text, '') = '' 
				and	coalesce(c.nr_interno_conta::text, '') = '' 
				and	coalesce(c.nr_seq_protocolo::text, '') = '' 
				and	coalesce(c.cd_convenio_conta::text, '') = '' 
				and 	((c.ie_situacao  = 1 or 
					exists (	SELECT  1 
						from   cobranca o 
						where  o.nr_titulo = c.nr_titulo 
						and   o.ie_status = 'P')) or (e.ie_tit_perda_pendencia = 'S' 
					and exists (	select	1 
							from	titulo_receber_liq x, 
								tipo_recebimento z 
							where	x.cd_tipo_recebimento = z.cd_tipo_recebimento 
							and	c.nr_titulo = x.nr_titulo 
							and	z.ie_tipo_consistencia = 9) 
					and exists (	select	1 
							from	cobranca o 
							where	o.nr_titulo = c.nr_titulo 
							and	o.ie_status = 'E'))) 
				and (0 = cd_estabelecimento_p or 
					c.cd_estabelecimento = cd_estabelecimento_p or 
					obter_estab_financeiro(c.cd_estabelecimento) = cd_estabelecimento_p) 
				and	((coalesce(trunc(c.dt_pagamento_previsto),clock_timestamp() - interval '1 days') < trunc(clock_timestamp())) or (ie_parametro_p = 'N'))  
				
union
 
				select	1 
				from	parametro_contas_receber e, 
					titulo_receber c 
				where	c.cd_estabelecimento	= e.cd_estabelecimento 
				and	exists (select 1 
						from  compl_pessoa_fisica x 
						where  x.cd_pessoa_fisica   = c.cd_pessoa_fisica 
						and   x.ie_tipo_complemento  = 3 
						and   x.cd_pessoa_fisica_ref = cd_pessoa_fisica_p) 
				and	coalesce(c.nr_atendimento::text, '') = '' 
				and	coalesce(c.nr_interno_conta::text, '') = '' 
				and	coalesce(c.nr_seq_protocolo::text, '') = '' 
				and	coalesce(c.cd_convenio_conta::text, '') = '' 
				and 	((c.ie_situacao  = 1 or 
					exists (	select  1 
						from   cobranca o 
						where  o.nr_titulo = c.nr_titulo 
						and   o.ie_status = 'P')) or (e.ie_tit_perda_pendencia = 'S' 
					and exists (	select	1 
							from	titulo_receber_liq x, 
								tipo_recebimento z 
							where	x.cd_tipo_recebimento = z.cd_tipo_recebimento 
							and	c.nr_titulo = x.nr_titulo 
							and	z.ie_tipo_consistencia = 9) 
					and exists (	select	1 
							from	cobranca o 
							where	o.nr_titulo = c.nr_titulo 
							and	o.ie_status = 'E'))) 
				and (0 = cd_estabelecimento_p or 
					c.cd_estabelecimento = cd_estabelecimento_p or 
					obter_estab_financeiro(c.cd_estabelecimento) = cd_estabelecimento_p) 
				and	((coalesce(trunc(c.dt_pagamento_previsto),clock_timestamp() - interval '1 days') < trunc(clock_timestamp())) or (ie_parametro_p = 'N'))  LIMIT 1);
				exception 
				when no_data_found then 
					count_w := 0;
				end;
			end if;
 
			if (count_w = 0) then 
 
				/* cheques */
 
				begin 
				select	1 
				into STRICT	count_w 
				FROM cheque_cr a
LEFT OUTER JOIN titulo_receber b ON (a.nr_titulo = b.nr_titulo)
LEFT OUTER JOIN atendimento_paciente c ON (b.nr_atendimento = c.nr_atendimento)
WHERE obter_status_cheque(a.nr_seq_cheque) in (3,5,10) and a.cd_pessoa_fisica	= cd_pessoa_fisica_p and (0 = cd_estabelecimento_p or 
					a.cd_estabelecimento = cd_estabelecimento_p or 
					obter_estab_financeiro(a.cd_estabelecimento) = cd_estabelecimento_p)   LIMIT 1;
				exception 
				when no_data_found then 
					count_w := 0;
				end;
 
				if (count_w = 0) then 
 
					/* os 76007 - 12/12/2007 - trazer cheques do recebimento de caixa */
 
					begin 
					select	1 
					into STRICT	count_w 
					from	atendimento_paciente d, 
						titulo_receber c, 
						titulo_receber_liq b, 
						cheque_cr a 
					where	b.nr_titulo		= c.nr_titulo 
					and	c.nr_atendimento	= d.nr_atendimento 
					and	a.nr_seq_caixa_rec	= b.nr_seq_caixa_rec 
					and	d.cd_pessoa_fisica	= cd_pessoa_fisica_p 
					and (0 = cd_estabelecimento_p or 
						a.cd_estabelecimento = cd_estabelecimento_p or 
						obter_estab_financeiro(a.cd_estabelecimento) = cd_estabelecimento_p) 
					and	obter_status_cheque(a.nr_seq_cheque) in (3,5,10) 
					and	coalesce(a.nr_titulo::text, '') = ''  LIMIT 1;
					exception 
					when no_data_found then 
						count_w := 0;
					end;
				end if;
				 
				if (count_w = 0) and (coalesce(ie_chamada_rotina_p,'X') = 'EUP') and (ie_gera_atendimento_w in ('R','PR','PE')) then 
					/* os 761266 - 22/07/2014 - Parâmetro Entrada Única R ou PR ou PE */
 
					begin 
					select	1 
					into STRICT	count_w 
					from	atendimento_paciente d, 
						titulo_receber c, 
						titulo_receber_liq b, 
						cheque_cr a 
					where	b.nr_titulo		= c.nr_titulo 
					and	c.nr_atendimento	= d.nr_atendimento 
					and	a.nr_seq_caixa_rec	= b.nr_seq_caixa_rec 
					and	d.cd_pessoa_responsavel	= cd_pessoa_fisica_p 
					and (0 = cd_estabelecimento_p or 
						a.cd_estabelecimento = cd_estabelecimento_p or 
						obter_estab_financeiro(a.cd_estabelecimento) = cd_estabelecimento_p) 
					and	obter_status_cheque(a.nr_seq_cheque) in (3,5,10) 
					and	coalesce(a.nr_titulo::text, '') = ''  LIMIT 1;
					exception 
					when no_data_found then 
						count_w := 0;
					end;
				end if;
				 
				if (count_w = 0) and (coalesce(ie_chamada_rotina_p,'X') = 'EUP') and (ie_gera_atendimento_w in ('P','PR','PE')) then 
					/* os 761266 - 22/07/2014 - Parâmetro Entrada Única P ou PR ou PE */
 
					begin 
					select	1 
					into STRICT	count_w 
					from	atendimento_paciente d, 
						titulo_receber c, 
						titulo_receber_liq b, 
						cheque_cr a 
					where	b.nr_titulo		= c.nr_titulo 
					and	c.nr_atendimento	= d.nr_atendimento 
					and	a.nr_seq_caixa_rec	= b.nr_seq_caixa_rec 
					and	d.cd_pessoa_fisica	= cd_pessoa_fisica_p 
					and	coalesce(d.cd_pessoa_responsavel::text, '') = '' 
					and (0 = cd_estabelecimento_p or 
						a.cd_estabelecimento = cd_estabelecimento_p or 
						obter_estab_financeiro(a.cd_estabelecimento) = cd_estabelecimento_p) 
					and	obter_status_cheque(a.nr_seq_cheque) in (3,5,10) 
					and	coalesce(a.nr_titulo::text, '') = ''  LIMIT 1;
					exception 
					when no_data_found then 
						count_w := 0;
					end;
				end if;
				 
			end if;
		end if;
	end if;
end if;
 
if (count_w > 0) then 
	ds_retorno_w	:= 'S';
else 
	ds_retorno_w	:= 'N';
end if;
 
return 	ds_retorno_w;
 
end 	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_valores_pendente ( cd_pessoa_fisica_p text, cd_estabelecimento_p bigint, ie_parametro_p text, ie_chamada_rotina_p text default null) FROM PUBLIC;

