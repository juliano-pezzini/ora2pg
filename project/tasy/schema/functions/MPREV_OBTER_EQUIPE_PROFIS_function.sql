-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION mprev_obter_equipe_profis (nr_sequencia_p mprev_partic_ciclo_item.nr_sequencia%type) RETURNS bigint AS $body$
DECLARE

/*
finalidade: obter o Ãºltimo profissional ou equipe inserida na tabela mprev_part_cic_item_resp.
locais de chamada: java; hdm - acompanhamento do plano de atendimento
*/
nr_sequencia_w 				mprev_part_cic_item_resp.nr_sequencia%type;
cd_profissional_w				mprev_part_cic_item_resp.cd_profissional%type;
nr_seq_equipe_w	 			mprev_part_cic_item_resp.nr_seq_equipe%type;
ds_result_w				bigint;


BEGIN

select 	max(nr_sequencia)
into STRICT   	nr_sequencia_w
from  	mprev_part_cic_item_resp
where 	nr_seq_partic_ciclo_item = nr_sequencia_p;

select 	max(cd_profissional),
	max(nr_seq_equipe)
into STRICT   	cd_profissional_w,
	nr_seq_equipe_w
from  	mprev_part_cic_item_resp
where nr_sequencia = nr_sequencia_w;

if (cd_profissional_w IS NOT NULL AND cd_profissional_w::text <> '') then

	select 	max(nr_seq_equipe)
	into STRICT 	ds_result_w
	from  	mprev_equipe_profissional
	where  	cd_pessoa_fisica = cd_profissional_w;

elsif (nr_seq_equipe_w IS NOT NULL AND nr_seq_equipe_w::text <> '') then
ds_result_w := nr_seq_equipe_w;

else
ds_result_w := 0;

end if;

return ds_result_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION mprev_obter_equipe_profis (nr_sequencia_p mprev_partic_ciclo_item.nr_sequencia%type) FROM PUBLIC;

