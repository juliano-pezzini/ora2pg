-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION lab_obter_convenio_externo (nm_tabela_p text, nm_atributo_p text, cd_interno_p text, ie_sistema_externo_p text) RETURNS varchar AS $body$
DECLARE


cd_externo_w 	convenio.ds_convenio%type;


BEGIN

if (nm_tabela_p IS NOT NULL AND nm_tabela_p::text <> '')
	and (nm_atributo_p IS NOT NULL AND nm_atributo_p::text <> '')
	and (cd_interno_p IS NOT NULL AND cd_interno_p::text <> '') then

	begin
		select	cd_externo
		into STRICT  	cd_externo_w
		from	conversao_meio_externo
		where	upper(ie_sistema_externo) = upper(ie_sistema_externo_p)
		and	upper(nm_tabela)   	  = upper(nm_tabela_p)
		and	upper(nm_atributo)        = upper(nm_atributo_p)
		and	cd_interno 	   	  = cd_interno_p
		and	coalesce(ie_envio_receb, 'A') in ('E','A');
		exception
		when others then
			cd_externo_w := '';
	end;

	if (coalesce(cd_externo_w::text, '') = '' or cd_externo_w = '') then
		begin
			select 	ds_convenio
			into STRICT	cd_externo_w
			from 	convenio
			where	cd_convenio = cd_interno_p;
			exception
			when others then
				cd_externo_w := cd_interno_p;
		end;
	end if;
end if;

return cd_externo_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION lab_obter_convenio_externo (nm_tabela_p text, nm_atributo_p text, cd_interno_p text, ie_sistema_externo_p text) FROM PUBLIC;

