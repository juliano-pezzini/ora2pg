-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_valor_imposto_orc_pac ( nr_seq_orcamento_p bigint) RETURNS bigint AS $body$
DECLARE


vl_total_imposto_proc_w 	double precision := 0;
vl_total_imposto_mat_w 		double precision := 0;


BEGIN

/*Soma os impostos dos procedimentos do orçamento*/

select 	coalesce(sum(vl_imposto),0) vl_itens_imposto
into STRICT  	vl_total_imposto_proc_w
from  	orcamento_paciente_proc 	a,
		orcamento_proc_imposto  	b
where 	a.nr_sequencia 				= b.nr_seq_proc
and 	a.nr_sequencia_orcamento 	= nr_seq_orcamento_p;

/*soma os impostos dos materiais do orçamento*/

select 	coalesce(sum(vl_imposto),0) 		vl_itens_imposto
into STRICT 	vl_total_imposto_mat_w
from  	orcamento_paciente_mat 		a,
		orcamento_mat_imposto  		b
where 	a.nr_sequencia 				= b.nr_seq_mat
and 	a.nr_sequencia_orcamento 	= nr_seq_orcamento_p;

return(vl_total_imposto_proc_w + vl_total_imposto_mat_w);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_valor_imposto_orc_pac ( nr_seq_orcamento_p bigint) FROM PUBLIC;

