-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_campo_relatorio_dinamico ( nr_seq_campo_relatorio_p bigint) RETURNS varchar AS $body$
DECLARE


nr_sequencia_w 			varchar(20);
dt_atualizacao_w 		timestamp;
nm_usuario_w 			varchar(15);
dt_atualizacao_nrec_w 		timestamp;
nm_usuario_nrec_w 		varchar(15);
cd_relatorio_w 			varchar(10);
cd_tipo_w 			varchar(15);
cd_label_w 			varchar(15);
nr_altura_w 			varchar(10);
nr_comprimento_w 		varchar(10);
nr_eixo_y_w 			varchar(15);
nr_eixo_x_w 			varchar(15);
nr_tipo_banda_w 		varchar(10);
ds_label_w 			varchar(255);
ds_cor_fundo_label_w 		varchar(20);
ds_cor_fundo_descricao_w 	varchar(20);
nm_label_w 			varchar(80);
ie_ajustar_tamanho_w 		varchar(1);
nr_seq_apres_w 			varchar(10);
ie_tipo_fonte_w 		varchar(10);
nr_tam_fonte_w 			varchar(20);
ie_italico_w 			varchar(1);
ie_negrito_w 			varchar(1);
ie_imagem_campo2_w 		varchar(255);
qt_rotacao_w 			varchar(10);
ds_resultado_w 			varchar(500);
calculo_comprimento_w bigint;


BEGIN

	declare
		json_config_campo_w   philips_json;
		ds_resultado_w text;

	begin
		json_config_campo_w := philips_json();

		select nr_sequencia,
			dt_atualizacao,
			nm_usuario, 
			dt_atualizacao_nrec, 
			nm_usuario_nrec, 
			cd_relatorio, 
			obter_tipo_campo_relatorio(cd_tipo), 
			cd_label, 
			nr_altura, 
			nr_comprimento, 
			nr_eixo_y,
			nr_eixo_x , 
			nr_tipo_banda, 
			ds_label, 
			ds_cor_fundo_label, 
			ds_cor_fundo_descricao, 
			nm_label, 
			ie_ajustar_tamanho, 
			nr_seq_apres,
			ie_tipo_fonte, 
			nr_tam_fonte,
			ie_italico,
			ie_negrito,    
			ie_imagem_campo2,
			qt_rotacao
		into STRICT nr_sequencia_w,
			dt_atualizacao_w,
			nm_usuario_w,
			dt_atualizacao_nrec_w,
			nm_usuario_nrec_w,
			cd_relatorio_w,
			cd_tipo_w,
			cd_label_w,
			nr_altura_w,
			nr_comprimento_w,
			nr_eixo_y_w,
			nr_eixo_x_w,
			nr_tipo_banda_w,
			ds_label_w,
			ds_cor_fundo_label_w,
			ds_cor_fundo_descricao_w,
			nm_label_w,
			ie_ajustar_tamanho_w,
			nr_seq_apres_w,
			ie_tipo_fonte_w, 
			nr_tam_fonte_w, 
			ie_italico_w,
			ie_negrito_w,      
			ie_imagem_campo2_w,
			qt_rotacao_w
		from relatorio_dinamico
		where nr_sequencia = nr_seq_campo_relatorio_p;

        select length(ds_label_w) * 7
        into STRICT calculo_comprimento_w
;

		json_config_campo_w.put('key', coalesce(nr_sequencia_w,' '));
		json_config_campo_w.put('type',	coalesce(cd_tipo_w,' '));
		json_config_campo_w.put('label', coalesce(ds_label_w,' '));	
		json_config_campo_w.put('x', coalesce(nr_eixo_x_w,' '));
		json_config_campo_w.put('y', coalesce(nr_eixo_y_w,' '));
		json_config_campo_w.put('width', coalesce(nr_comprimento_w,calculo_comprimento_w));
		json_config_campo_w.put('height', coalesce(nr_altura_w,'50'));
		json_config_campo_w.put('rotation', coalesce(qt_rotacao_w,' '));

		dbms_lob.createtemporary(ds_resultado_w, TRUE);
		json_config_campo_w.(ds_resultado_w);

		return ds_resultado_w;
	end;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_campo_relatorio_dinamico ( nr_seq_campo_relatorio_p bigint) FROM PUBLIC;

