-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';



CREATE TYPE vr_escala AS (vr_escala escala_sledai.ie_convulsao%type[24]);
CREATE TYPE vr_pontos AS (vr_pontos smallint[24]);


CREATE OR REPLACE FUNCTION obter_score_escala_sledai ( ie_convulsao_p escala_sledai.ie_convulsao%type, ie_psicose_p escala_sledai.ie_psicose%type, ie_scerebral_organico_p escala_sledai.ie_scerebral_organico%type, ie_disturbio_visual_p escala_sledai.ie_disturbio_visual%type, ie_alter_nervos_cranianos_p escala_sledai.ie_alteracao_nervos_cranianos%type, ie_dor_cabeca_sle_p escala_sledai.ie_dor_cabeca_sle%type, ie_acidente_vasc_cerebral_p escala_sledai.ie_acidente_vascular_cerebral%type, ie_vasculite_p escala_sledai.ie_vasculite%type, ie_artrite_p escala_sledai.ie_artrite%type, ie_miosite_p escala_sledai.ie_miosite%type, ie_cilindros_p escala_sledai.ie_cilindros%type, ie_hematuria_p escala_sledai.ie_hematuria%type, ie_proteinuria_p escala_sledai.ie_proteinuria%type, ie_piuria_p escala_sledai.ie_piuria%type, ie_erupcao_pele_p escala_sledai.ie_erupcao_pele%type, ie_alopecia_p escala_sledai.ie_alopecia%type, ie_ulcera_mucosa_p escala_sledai.ie_ulcera_mucosa%type, ie_pleurisia_p escala_sledai.ie_pleurisia%type, ie_pericardite_p escala_sledai.ie_pericardite%type, ie_hipocomplementemia_p escala_sledai.ie_hipocomplementemia%type, ie_aumento_ligacao_dna_p escala_sledai.ie_aumento_ligacao_dna%type, ie_febre_p escala_sledai.ie_febre%type, ie_trombocitopenia_p escala_sledai.ie_trombocitopenia%type, ie_leucopenia_p escala_sledai.ie_leucopenia%type) RETURNS bigint AS $body$
DECLARE


ie_convulsao_w  escala_sledai.ie_convulsao%type := ie_convulsao_p;
ie_psicose_w  escala_sledai.ie_psicose%type := ie_psicose_p;
ie_scerebral_organico_w  escala_sledai.ie_scerebral_organico%type := ie_scerebral_organico_p;
ie_disturbio_visual_w  escala_sledai.ie_disturbio_visual%type := ie_disturbio_visual_p;
ie_alter_nervos_cranianos_w  escala_sledai.ie_alteracao_nervos_cranianos%type := ie_alter_nervos_cranianos_p;
ie_dor_cabeca_sle_w  escala_sledai.ie_dor_cabeca_sle%type := ie_dor_cabeca_sle_p;
ie_acidente_vasc_cerebral_w  escala_sledai.ie_acidente_vascular_cerebral%type := ie_acidente_vasc_cerebral_p;
ie_vasculite_w  escala_sledai.ie_vasculite%type := ie_vasculite_p;
ie_artrite_w  escala_sledai.ie_artrite%type := ie_artrite_p;
ie_miosite_w  escala_sledai.ie_miosite%type := ie_miosite_p;
ie_cilindros_w  escala_sledai.ie_cilindros%type := ie_cilindros_p;
ie_hematuria_w  escala_sledai.ie_hematuria%type := ie_hematuria_p;
ie_proteinuria_w  escala_sledai.ie_proteinuria%type := ie_proteinuria_p;
ie_piuria_w  escala_sledai.ie_piuria%type := ie_piuria_p;
ie_erupcao_pele_w  escala_sledai.ie_erupcao_pele%type := ie_erupcao_pele_p;
ie_alopecia_w  escala_sledai.ie_alopecia%type := ie_alopecia_p;
ie_ulcera_mucosa_w  escala_sledai.ie_ulcera_mucosa%type := ie_ulcera_mucosa_p;
ie_pleurisia_w  escala_sledai.ie_pleurisia%type := ie_pleurisia_p;
ie_pericardite_w  escala_sledai.ie_pericardite%type := ie_pericardite_p;
ie_hipocomplementemia_w  escala_sledai.ie_hipocomplementemia%type := ie_hipocomplementemia_p;
ie_aumento_ligacao_dna_w  escala_sledai.ie_aumento_ligacao_dna%type := ie_aumento_ligacao_dna_p;
ie_febre_w  escala_sledai.ie_febre%type := ie_febre_p;
ie_trombocitopenia_w  escala_sledai.ie_trombocitopenia%type := ie_trombocitopenia_p;
ie_leucopenia_w  escala_sledai.ie_leucopenia%type := ie_leucopenia_p;
ds_valor_padrao_n_w   escala_sledai.ie_leucopenia%type := 'N';
ds_valor_padrao_s_w   escala_sledai.ie_leucopenia%type := 'S';
valor_padrao_0_w    escala_sledai.qt_pontuacao%type := 0;
valor_padrao_1_w    escala_sledai.qt_pontuacao%type := 1;
valor_padrao_2_w    escala_sledai.qt_pontuacao%type := 2;
valor_padrao_4_w    escala_sledai.qt_pontuacao%type := 4;
valor_padrao_8_w    escala_sledai.qt_pontuacao%type := 8;

ds_escala_w   vr_escala := vr_escala( coalesce(ie_leucopenia_w, ds_valor_padrao_n_w),
                                      coalesce(ie_trombocitopenia_w, ds_valor_padrao_n_w),
                                      coalesce(ie_febre_w, ds_valor_padrao_n_w),
                                      coalesce(ie_aumento_ligacao_dna_w, ds_valor_padrao_n_w),
                                      coalesce(ie_hipocomplementemia_w, ds_valor_padrao_n_w),
                                      coalesce(ie_pericardite_w, ds_valor_padrao_n_w),
                                      coalesce(ie_pleurisia_w, ds_valor_padrao_n_w),
                                      coalesce(ie_ulcera_mucosa_w, ds_valor_padrao_n_w),
                                      coalesce(ie_alopecia_w, ds_valor_padrao_n_w),
                                      coalesce(ie_erupcao_pele_w, ds_valor_padrao_n_w),
                                      coalesce(ie_piuria_w, ds_valor_padrao_n_w),
                                      coalesce(ie_proteinuria_w, ds_valor_padrao_n_w),
                                      coalesce(ie_hematuria_w, ds_valor_padrao_n_w),
                                      coalesce(ie_cilindros_w, ds_valor_padrao_n_w),
                                      coalesce(ie_miosite_w, ds_valor_padrao_n_w),
                                      coalesce(ie_artrite_w, ds_valor_padrao_n_w),
                                      coalesce(ie_vasculite_w, ds_valor_padrao_n_w),
                                      coalesce(ie_acidente_vasc_cerebral_w, ds_valor_padrao_n_w),
                                      coalesce(ie_dor_cabeca_sle_w, ds_valor_padrao_n_w),
                                      coalesce(ie_alter_nervos_cranianos_w, ds_valor_padrao_n_w),
                                      coalesce(ie_disturbio_visual_w, ds_valor_padrao_n_w),
                                      coalesce(ie_scerebral_organico_w, ds_valor_padrao_n_w),
                                      coalesce(ie_psicose_w, ds_valor_padrao_n_w),
                                      coalesce(ie_convulsao_w, ds_valor_padrao_n_w));

qt_pontos_w   vr_pontos := vr_pontos(valor_padrao_1_w, valor_padrao_1_w, valor_padrao_1_w, valor_padrao_2_w, valor_padrao_2_w, valor_padrao_2_w, 
                                     valor_padrao_2_w, valor_padrao_2_w, valor_padrao_2_w, valor_padrao_2_w, valor_padrao_4_w, valor_padrao_4_w, 
                                     valor_padrao_4_w, valor_padrao_4_w, valor_padrao_4_w, valor_padrao_4_w, valor_padrao_8_w, valor_padrao_8_w, 
                                     valor_padrao_8_w, valor_padrao_8_w, valor_padrao_8_w, valor_padrao_8_w, valor_padrao_8_w, valor_padrao_8_w);

qt_resultado_w  escala_sledai.qt_pontuacao%type := valor_padrao_0_w;

BEGIN
  <<LOOP_PRINCIPAL>>
  FOR id_registro IN 1 .. ds_escala_w.COUNT LOOP
    IF (ds_escala_w(id_registro) = ds_valor_padrao_s_w) THEN
      qt_resultado_w  := qt_resultado_w + qt_pontos_w(id_registro);
    END IF;
  END LOOP LOOP_PRINCIPAL;

RETURN qt_resultado_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_score_escala_sledai ( ie_convulsao_p escala_sledai.ie_convulsao%type, ie_psicose_p escala_sledai.ie_psicose%type, ie_scerebral_organico_p escala_sledai.ie_scerebral_organico%type, ie_disturbio_visual_p escala_sledai.ie_disturbio_visual%type, ie_alter_nervos_cranianos_p escala_sledai.ie_alteracao_nervos_cranianos%type, ie_dor_cabeca_sle_p escala_sledai.ie_dor_cabeca_sle%type, ie_acidente_vasc_cerebral_p escala_sledai.ie_acidente_vascular_cerebral%type, ie_vasculite_p escala_sledai.ie_vasculite%type, ie_artrite_p escala_sledai.ie_artrite%type, ie_miosite_p escala_sledai.ie_miosite%type, ie_cilindros_p escala_sledai.ie_cilindros%type, ie_hematuria_p escala_sledai.ie_hematuria%type, ie_proteinuria_p escala_sledai.ie_proteinuria%type, ie_piuria_p escala_sledai.ie_piuria%type, ie_erupcao_pele_p escala_sledai.ie_erupcao_pele%type, ie_alopecia_p escala_sledai.ie_alopecia%type, ie_ulcera_mucosa_p escala_sledai.ie_ulcera_mucosa%type, ie_pleurisia_p escala_sledai.ie_pleurisia%type, ie_pericardite_p escala_sledai.ie_pericardite%type, ie_hipocomplementemia_p escala_sledai.ie_hipocomplementemia%type, ie_aumento_ligacao_dna_p escala_sledai.ie_aumento_ligacao_dna%type, ie_febre_p escala_sledai.ie_febre%type, ie_trombocitopenia_p escala_sledai.ie_trombocitopenia%type, ie_leucopenia_p escala_sledai.ie_leucopenia%type) FROM PUBLIC;

