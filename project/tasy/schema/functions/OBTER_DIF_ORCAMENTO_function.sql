-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dif_orcamento ( nm_usuario_p text, cd_classif_des_p text, cd_classif_res_p text, ie_opcao_p bigint ) RETURNS bigint AS $body$
DECLARE


vl_orcado_mes_w		double precision;
vl_real_mes_w		double precision;
vl_variacao_mes_w		double precision;
vl_orcado_acum_w		double precision;
vl_real_acum_w		double precision;
vl_variacao_acum_w	double precision;
vl_saldo_w		double precision;

vl_orcado_mes_d_w		double precision;
vl_real_mes_d_w		double precision;
vl_variacao_mes_d_w	double precision;
vl_orcado_acum_d_w	double precision;
vl_real_acum_d_w		double precision;
vl_variacao_acum_d_w	double precision;
vl_saldo_d_w		double precision;

vl_resultado_w		double precision;


BEGIN

select	vl_orcado_mes,
	vl_real_mes,
	(coalesce(vl_real_mes,0) - coalesce(vl_orcado_mes,0)),
	vl_orcado_acum,
	vl_real_acum,
	(coalesce(vl_real_acum,0) - coalesce(vl_orcado_acum,0)),
	vl_saldo
into STRICT	vl_orcado_mes_w,
	vl_real_mes_w,
	vl_variacao_mes_w,
	vl_orcado_acum_w,
	vl_real_acum_w,
	vl_variacao_acum_w,
	vl_saldo_w
from	w_ctb_acomp_orcamento
where	nm_usuario	  = nm_usuario_p
and	cd_classificacao 	  = cd_classif_res_p;

select	vl_orcado_mes,
	vl_real_mes,
	(coalesce(vl_real_mes,0) - coalesce(vl_orcado_mes,0)),
	vl_orcado_acum,
	vl_real_acum,
	(coalesce(vl_real_acum,0) - coalesce(vl_orcado_acum,0)),
	vl_saldo
into STRICT	vl_orcado_mes_d_w,
	vl_real_mes_d_w,
	vl_variacao_mes_d_w,
	vl_orcado_acum_d_w,
	vl_real_acum_d_w,
	vl_variacao_acum_d_w,
	vl_saldo_d_w
from	w_ctb_acomp_orcamento
where	nm_usuario	  = nm_usuario_p
and	cd_classificacao 	  = cd_classif_des_p;

if (ie_opcao_p = 1) then
	vl_resultado_w := abs(vl_orcado_mes_w) - abs(vl_orcado_mes_d_w);
elsif (ie_opcao_p = 2) then
	vl_resultado_w := abs(vl_real_mes_w) - abs(vl_real_mes_d_w);
elsif (ie_opcao_p = 3) then
	vl_resultado_w := abs(vl_variacao_mes_w) - abs(vl_variacao_mes_d_w);
elsif (ie_opcao_p = 4) then
	vl_resultado_w := abs(vl_orcado_acum_w) - abs(vl_orcado_acum_d_w);
elsif (ie_opcao_p = 5) then
	vl_resultado_w := abs(vl_real_acum_w) - abs(vl_real_acum_d_w);
elsif (ie_opcao_p = 6) then
	vl_resultado_w := abs(vl_variacao_acum_w) - abs(vl_variacao_acum_d_w);
elsif (ie_opcao_p = 7) then
	vl_resultado_w := abs(vl_saldo_w) - abs(vl_saldo_d_w);
end if;

return	vl_resultado_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dif_orcamento ( nm_usuario_p text, cd_classif_des_p text, cd_classif_res_p text, ie_opcao_p bigint ) FROM PUBLIC;

