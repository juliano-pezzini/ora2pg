-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_nr_atendimento_planned ( nr_atendimento_p bigint) RETURNS varchar AS $body$
DECLARE

			
nr_atendimento_w    atendimento_paciente.nr_atendimento%type;
ds_retorno_w        varchar(100);


BEGIN

ds_retorno_w := '';

if (nr_atendimento_p IS NOT NULL AND nr_atendimento_p::text <> '') then

    if (coalesce(pkg_i18n.get_user_locale, 'pt_BR') = 'de_DE') then

        select  max(apt.nr_atendimento)
        into STRICT    nr_atendimento_w
        from    atendimento_paciente apt
        where   apt.nr_seq_episodio in (    SELECT  max(ap.nr_seq_episodio)
                                            from    atendimento_paciente ap
                                            where   ap.nr_atendimento = nr_atendimento_p)
        and     coalesce(apt.dt_cancelamento::text, '') = ''
        and     coalesce(apt.dt_alta::text, '') = ''
        and     obter_se_atendimento_futuro(apt.nr_atendimento) = 'N';

        if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
            ds_retorno_w:= nr_atendimento_w;
        end if;
    else
		ds_retorno_w:= nr_atendimento_p;
	end if;

end if;
return ds_retorno_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_nr_atendimento_planned ( nr_atendimento_p bigint) FROM PUBLIC;

