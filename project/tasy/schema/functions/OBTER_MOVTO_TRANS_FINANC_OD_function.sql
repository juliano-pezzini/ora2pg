-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_movto_trans_financ_od ( nr_seq_movto_trans_financ_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE

/* 
Origem Destino da Transação 
Opcao - 'C' Retorna número 
	 'D' Retorna descrição 
*/
 
 
ds_retorno_w			varchar(254)	:=null;
/*Códigos */
cd_pessoa_fisica_w		varchar(10)	:=null;
cd_cgc_w			varchar(14)	:=null;
nr_seq_titulo_pagar_w		bigint 	:=null;
nr_seq_titulo_receber_w 	bigint 	:=null;
nr_bordero_w			bigint 	:=null;
nr_bordero_rec_w		bigint	:=null;
nr_adiantamento_w		bigint 	:=null;
nr_adiant_pago_w		bigint 	:=null;
nr_seq_banco_od_w		bigint 	:=null;
nr_seq_caixa_od_w		bigint 	:=null;
nr_seq_nota_fiscal_w		bigint 	:=null;
nr_nota_fiscal_w		varchar(255) 	:=null;
nr_interno_conta_w		bigint 	:=null;
nr_seq_conv_receb_w		bigint 	:=null;
nr_seq_cheque_w			bigint 	:=null;
nr_seq_deposito_w		bigint 	:=null;
nr_seq_cheque_cp_w		bigint	:=null;
nr_seq_bordero_cheque_w     bigint	:=null;
nr_seq_movto_cartao_w		bigint	:=null;


BEGIN 
 
BEGIN 
SELECT	cd_pessoa_fisica, 
	cd_cgc, 
	nr_seq_titulo_pagar, 
	nr_seq_titulo_receber, 
	nr_bordero, 
	nr_bordero_rec, 
	nr_adiantamento, 
	nr_adiant_pago, 
	nr_seq_banco_od, 
	nr_seq_caixa_od, 
	nr_seq_nota_fiscal, 
	nr_interno_conta, 
	nr_seq_conv_receb, 
	nr_seq_cheque, 
	nr_seq_deposito, 
	nr_seq_cheque_cp, 
	nr_seq_bordero_cheque, 
	nr_seq_movto_cartao 
INTO STRICT	cd_pessoa_fisica_w,	 
	cd_cgc_w,			 
	nr_seq_titulo_pagar_w,	 
	nr_seq_titulo_receber_w, 
	nr_bordero_w,		 
	nr_bordero_rec_w, 
	nr_adiantamento_w,	 
	nr_adiant_pago_w, 
	nr_seq_banco_od_w,	 
	nr_seq_caixa_od_w,	 
	nr_seq_nota_fiscal_w,	 
	nr_interno_conta_w,	 
	nr_seq_conv_receb_w,	 
	nr_seq_cheque_w,		 
	nr_seq_deposito_w, 
	nr_seq_cheque_cp_w, 
	nr_seq_bordero_cheque_w, 
	nr_seq_movto_cartao_w 
FROM	movto_trans_financ 
WHERE	nr_sequencia = nr_seq_movto_trans_financ_p;
 
IF (cd_pessoa_fisica_w IS NOT NULL AND cd_pessoa_fisica_w::text <> '') THEN 
	BEGIN 
	select	CASE WHEN ie_opcao_p='D' THEN SUBSTR(OBTER_NOME_PF(CD_PESSOA_FISICA),0,254)  ELSE cd_pessoa_fisica END  
	into STRICT		ds_retorno_w 
	from		pessoa_fisica 
	where		cd_pessoa_fisica = cd_pessoa_fisica_w;			 	
	END;
ELSIF (cd_cgc_w IS NOT NULL AND cd_cgc_w::text <> '') THEN 
	BEGIN 
	select	CASE WHEN ie_opcao_p='D' THEN ds_razao_social  ELSE cd_cgc END  
	into STRICT		ds_retorno_w 
	from		pessoa_juridica 
	where		cd_cgc = cd_cgc_w;			 	
	END;
ELSIF (nr_seq_titulo_pagar_w IS NOT NULL AND nr_seq_titulo_pagar_w::text <> '') THEN 
	BEGIN 
	select	CASE WHEN ie_opcao_p='D' THEN substr(obter_nome_pf_pj(cd_pessoa_fisica,cd_cgc),1,250)  ELSE nr_titulo END  
	into STRICT		ds_retorno_w 
	from		titulo_pagar 
	where		nr_titulo = nr_seq_titulo_pagar_w;			 	
	END;
ELSIF (nr_seq_titulo_receber_w IS NOT NULL AND nr_seq_titulo_receber_w::text <> '') THEN 
	BEGIN 
	select	CASE WHEN ie_opcao_p='D' THEN substr(obter_nome_pf_pj(cd_pessoa_fisica,cd_cgc),1,250)  ELSE nr_titulo END  
	into STRICT		ds_retorno_w 
	from		titulo_receber 
	where		nr_titulo = nr_seq_titulo_receber_w;			 	
	END;
ELSIF (nr_bordero_w IS NOT NULL AND nr_bordero_w::text <> '') THEN 
	BEGIN 
	select	CASE WHEN ie_opcao_p='D' THEN ds_bordero  ELSE nr_bordero END  
	into STRICT		ds_retorno_w 
	from		bordero_pagamento 
	where		nr_bordero = nr_bordero_w;			 	
	END;
ELSIF (nr_bordero_rec_w IS NOT NULL AND nr_bordero_rec_w::text <> '') THEN 
	BEGIN 
	select	CASE WHEN ie_opcao_p='D' THEN ds_bordero  ELSE nr_bordero END  
	into STRICT		ds_retorno_w 
	from		bordero_recebimento 
	where		nr_bordero = nr_bordero_rec_w;			 	
	END;
ELSIF (nr_seq_bordero_cheque_w IS NOT NULL AND nr_seq_bordero_cheque_w::text <> '') THEN 
	BEGIN 
	select	CASE WHEN ie_opcao_p='D' THEN ds_bordero  ELSE null END  
	into STRICT		ds_retorno_w 
	from		bordero_cheque 
	where		nr_sequencia = nr_seq_bordero_cheque_w;			 	
	END;
ELSIF (nr_adiantamento_w IS NOT NULL AND nr_adiantamento_w::text <> '') THEN 
	BEGIN 
	select	CASE WHEN ie_opcao_p='D' THEN substr(obter_nome_pf_pj(cd_pessoa_fisica,cd_cgc),1,250)  ELSE nr_adiantamento END  
	into STRICT		ds_retorno_w 
	from		adiantamento 
	where		nr_adiantamento = nr_adiantamento_w;			 	
	END;
ELSIF (nr_adiant_pago_w IS NOT NULL AND nr_adiant_pago_w::text <> '') THEN 
	BEGIN 
	select	CASE WHEN ie_opcao_p='D' THEN substr(obter_nome_pf_pj(cd_pessoa_fisica,cd_cgc),1,250)  ELSE nr_adiantamento END  
	into STRICT		ds_retorno_w 
	from		adiantamento_pago 
	where		nr_adiantamento = nr_adiant_pago_w;			 	
	END;
ELSIF (nr_seq_banco_od_w IS NOT NULL AND nr_seq_banco_od_w::text <> '') THEN 
	BEGIN		 
	select	CASE WHEN ie_opcao_p='D' THEN ds_conta  ELSE nr_sequencia END  
	into STRICT		ds_retorno_w 
	from		banco_estabelecimento_v 
	where		nr_sequencia = nr_seq_banco_od_w;			 	
	END;
ELSIF (nr_seq_caixa_od_w IS NOT NULL AND nr_seq_caixa_od_w::text <> '') THEN 
	BEGIN 
	select	CASE WHEN ie_opcao_p='D' THEN ds_caixa  ELSE nr_sequencia END  
	into STRICT		ds_retorno_w 
	from		caixa 
	where		nr_sequencia = nr_seq_caixa_od_w;			 	
	END;
ELSIF (nr_seq_nota_fiscal_w IS NOT NULL AND nr_seq_nota_fiscal_w::text <> '') THEN 
	BEGIN 
	select	substr(CASE WHEN ie_opcao_p='D' THEN substr(obter_nome_pf_pj(cd_pessoa_fisica,cd_cgc),1,250)  ELSE nr_nota_fiscal END ,1,254) 
	into STRICT		ds_retorno_w 
	from		nota_fiscal 
	where		nr_sequencia = nr_seq_nota_fiscal_w;			 	
	END;
ELSIF (nr_interno_conta_w IS NOT NULL AND nr_interno_conta_w::text <> '') THEN 
	BEGIN 
	select	CASE WHEN ie_opcao_p='D' THEN substr(obter_nome_pf(a.cd_pessoa_fisica),1,100)  ELSE a.nr_atendimento END  
	into STRICT		ds_retorno_w 
	from		atendimento_paciente a, 
			conta_paciente b 
	where		b.nr_interno_conta = nr_interno_conta_w 
	and		a.nr_atendimento = b.nr_atendimento;			 	
	END;
ELSIF (nr_seq_conv_receb_w IS NOT NULL AND nr_seq_conv_receb_w::text <> '') THEN 
	BEGIN 
	select	CASE WHEN ie_opcao_p='D' THEN substr(obter_nome_convenio(cd_convenio),1,250)  ELSE cd_convenio END  
	into STRICT		ds_retorno_w 
	from		convenio_receb 
	where		nr_sequencia = nr_seq_conv_receb_w;			 	
	END;
ELSIF (nr_seq_cheque_w IS NOT NULL AND nr_seq_cheque_w::text <> '') THEN 
	BEGIN 
	select	CASE WHEN ie_opcao_p='D' THEN substr(obter_nome_pf_pj(cd_pessoa_fisica,cd_cgc),1,250)  ELSE nr_cheque END  
	into STRICT		ds_retorno_w 
	from		cheque_cr 
	where		nr_seq_cheque = nr_seq_cheque_w;
	END;
ELSIF (nr_seq_deposito_w IS NOT NULL AND nr_seq_deposito_w::text <> '') THEN 
	BEGIN 
	select	CASE WHEN ie_opcao_p='D' THEN substr(obter_nome_conta_deposito(nr_sequencia),1,200)  ELSE nr_conta END  
	into STRICT		ds_retorno_w 
	from		deposito 
	where		nr_sequencia = nr_seq_deposito_w;			 	
	END;
ELSIF (nr_seq_cheque_cp_w IS NOT NULL AND nr_seq_cheque_cp_w::text <> '') THEN 
	BEGIN 
	select	CASE WHEN ie_opcao_p='D' THEN substr(obter_nome_pf_pj(cd_pessoa_DESTINATARIO,cd_cgc_DESTINATARIO),1,250)  ELSE nr_cheque END  
	into STRICT		ds_retorno_w 
	from		cheque 
	where		nr_sequencia = nr_seq_cheque_cp_w;
	END;
ELSIF (nr_seq_movto_cartao_w IS NOT NULL AND nr_seq_movto_cartao_w::text <> '') THEN 
	BEGIN 
	select	CASE WHEN ie_opcao_p='D' THEN nr_cartao  ELSE nr_cartao END  
	into STRICT		ds_retorno_w 
	from		movto_cartao_cr 
	where		nr_sequencia = nr_seq_movto_cartao_w;
	END;
END IF;
EXCEPTION 
	WHEN OTHERS THEN 
		ds_retorno_w		:= '';
END;
 
RETURN ds_retorno_w;
 
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_movto_trans_financ_od ( nr_seq_movto_trans_financ_p bigint, ie_opcao_p text) FROM PUBLIC;

