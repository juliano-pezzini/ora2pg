-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_tit_pagar_dt ( nr_titulo_p bigint, ie_tipo_dado_p text) RETURNS timestamp AS $body$
DECLARE

 
/* 
'DC' - data contábil 
'DL' - data liquidação 
'DTES' data entrada/saída da nota fiscal. 
'DTL' Data de liberacao 
'VE' - vencimento 
'VO' - vencimento original 
*/
 
 
ds_retorno_w		timestamp;
dt_vencimento_w		timestamp;
dt_emissao_w		timestamp;
dt_contabil_w		timestamp;
dt_liquidacao_w		timestamp;
dt_vencimento_original_w	timestamp;

c01 CURSOR FOR 
SELECT	vl_alteracao 
from	titulo_pagar_alt_valor 
where	nr_titulo	= nr_titulo_p 
order	by nr_sequencia;

c02 CURSOR FOR 
SELECT	distinct nr_bordero 
from	titulo_pagar_bordero_v 
where	nr_titulo	= nr_titulo_p;


BEGIN 
select a.dt_vencimento_atual, 
	a.dt_emissao, 
	a.dt_contabil, 
	a.dt_liquidacao, 
	a.dt_vencimento_original 
into STRICT dt_vencimento_w, 
	dt_emissao_w, 
	dt_contabil_w, 
	dt_liquidacao_w, 
	dt_vencimento_original_w 
from	titulo_pagar a 
where	nr_titulo = nr_titulo_p;
 
if (ie_tipo_dado_p = 'VE') then 
	ds_retorno_w := dt_vencimento_w;
elsif (ie_tipo_dado_p = 'EM') then 
	ds_retorno_w := dt_emissao_w;
elsif (ie_tipo_dado_p = 'DC') then 
	ds_retorno_w := dt_contabil_w;
elsif (ie_tipo_dado_p = 'DL') then 
	ds_retorno_w := dt_liquidacao_w;
elsif (ie_tipo_dado_p = 'VO') then 
	ds_retorno_w	:= dt_vencimento_original_w;
elsif (ie_tipo_dado_p = 'DTL') then 
	select	dt_liberacao 
	into STRICT	ds_retorno_w 
	from	titulo_pagar	b 
	where	b.nr_titulo	= nr_titulo_p  LIMIT 1;
end if;
 
return ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_tit_pagar_dt ( nr_titulo_p bigint, ie_tipo_dado_p text) FROM PUBLIC;

