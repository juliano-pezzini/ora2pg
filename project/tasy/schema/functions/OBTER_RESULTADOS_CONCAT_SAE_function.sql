-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_resultados_concat_sae ( nr_seq_item_p bigint, nr_sequencia_p bigint) RETURNS varchar AS $body$
DECLARE


ds_resultado_w		varchar(255);
ds_item_w			varchar(255);
ds_retorno_w		varchar(4000) := '';
ds_observacao_w		varchar(2000);
ds_retorno_aux_w	varchar(4000) := '';
ds_espaco_w			varchar(4000);
ds_parametro_w		varchar(2) := '';
espaco_w			varchar(255) := '';
nr_seq_topografia_w	bigint;
ds_topografia_w		varchar(4000);
nr_tamanho_coluna_w	bigint := 100;
nr_diferencia_coluna_W	bigint;
nr_seq_item_w		bigint;
ie_lado_w		    varchar(255);
nr_sequencia_w		bigint;
nr_sequencia_item_w		bigint;
ds_topografia_ww	varchar(4000);
ds_lado_w		    varchar(1);
ds_config_w			varchar(255);
nr_seq_apres_w		integer;

c01 CURSOR FOR
SELECT	distinct c.ds_item ||': ' ds_item,
	substr(obter_desc_item_resultado(a.nr_seq_result),1,255),
	a.ds_observacao,
	a.nr_seq_topografia,
	a.nr_sequencia,
	a.ie_lado
from	pe_item_tipo_item d, 
	pe_item_examinar c, 
	pe_item_resultado b, 
	pe_prescr_item_result a 
where	a.nr_seq_prescr = nr_sequencia_p 
and	a.nr_seq_result = b.nr_sequencia 
and	b.nr_seq_item = c.nr_sequencia 
and	c.nr_sequencia = d.nr_seq_item
and	d.nr_seq_tipo_item = nr_seq_item_p
order	by ds_item; --, ds_resultado;
c02 CURSOR FOR
SELECT	distinct substr(c.ds_item ,1,255),
	d.nr_seq_tipo_item,
	--a.nr_sequencia,
	c.nr_sequencia
from	pe_item_tipo_item d,
	pe_item_examinar c, 
	pe_item_resultado b, 
	pe_prescr_item_result a 
where	a.nr_seq_prescr = nr_sequencia_p 
and	a.nr_seq_result = b.nr_sequencia 
and	b.nr_seq_item = c.nr_sequencia 
and	c.nr_sequencia = d.nr_seq_item
and	d.nr_seq_tipo_item = nr_seq_item_p;

c03 CURSOR FOR
SELECT	distinct c.ds_item ||': ' ds_item,
	substr(obter_desc_item_resultado(a.nr_seq_result),1,255) ds_resultado,
	a.ds_observacao,
	a.nr_seq_topografia,
	a.nr_sequencia,
	a.ie_lado
from	pe_item_tipo_item d, 
	pe_item_examinar c, 
	pe_item_resultado b, 
	pe_prescr_item_result a 
where	a.nr_seq_prescr = nr_sequencia_p 
and	a.nr_seq_result = b.nr_sequencia 
and	b.nr_seq_item = c.nr_sequencia 
and	c.nr_sequencia = d.nr_seq_item
and	d.nr_seq_tipo_item = nr_seq_item_p
order by ds_item;

c04 CURSOR FOR
SELECT	distinct substr(obter_desc_item_resultado(a.nr_seq_result),1,255),
	a.ds_observacao,
	a.nr_seq_topografia,
	a.nr_sequencia
from	pe_item_tipo_item d,
	pe_item_examinar c, 
	pe_item_resultado b, 
	pe_prescr_item_result a 
where	a.nr_seq_prescr = nr_sequencia_p 
and	a.nr_seq_result = b.nr_sequencia 
and	b.nr_seq_item = c.nr_sequencia 
and	c.nr_sequencia = d.nr_seq_item
--and	d.nr_seq_tipo_item = nr_seq_item_w;
and	c.nr_sequencia = nr_sequencia_item_w;

c05 CURSOR FOR
SELECT	distinct substr(c.ds_item ||': ',1,80) ds_item,
	substr(obter_desc_item_resultado(a.nr_seq_result),1,255) ds_resultado,
	a.ds_observacao,
	a.nr_seq_topografia,
	a.nr_sequencia,
	a.ie_lado,
	d.nr_seq_apres
from	pe_item_tipo_item d,
	pe_item_examinar c, 
	pe_item_resultado b, 
	pe_prescr_item_result a 
where	a.nr_seq_prescr = nr_sequencia_p 
and	a.nr_seq_result = b.nr_sequencia 
and	b.nr_seq_item = c.nr_sequencia 
and	c.nr_sequencia = d.nr_seq_item
and	d.nr_seq_tipo_item = nr_seq_item_p
order by d.nr_seq_apres;

c06 CURSOR FOR
SELECT  coalesce(ie_lado,'N'),
		substr(obter_desc_topografia_dor(nr_seq_topografia),1,255)
from	pe_prescr_item_result_topo
where	nr_seq_item = 	nr_sequencia_w;

BEGIN

ds_parametro_w := Obter_param_Usuario(281, 619, obter_perfil_ativo, wheb_usuario_pck.get_nm_usuario, 0, ds_parametro_w);

if (coalesce(ds_parametro_w,'N') = 'S')then
	open c01;
	loop
	fetch	c01 into
		ds_item_w,
		ds_resultado_w,
		ds_observacao_w,
		nr_seq_topografia_w,
		nr_sequencia_w,
		ds_lado_w;
	 	EXIT WHEN NOT FOUND; /* apply on c01 */
			ds_topografia_w	:= '';
			ie_lado_w		:= '';
			if (nr_seq_topografia_w IS NOT NULL AND nr_seq_topografia_w::text <> '') then
				select	max(DS_TOPOGRAFIA)
				into STRICT	ds_topografia_w
				from	TOPOGRAFIA_DOR
				where	nr_sequencia	= nr_seq_topografia_w;	

				if (ds_lado_w IS NOT NULL AND ds_lado_w::text <> '') then
					ds_topografia_w	:= substr(chr(13) || chr(10) ||'            ' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_w,1,255)||
					substr('   ' || wheb_mensagem_pck.get_texto(308871) || ': '||substr(obter_valor_dominio(1372,ds_lado_w),1,100),1,100);	--Lado 
				else		
					ds_topografia_w	:= substr(chr(13) || chr(10) ||'            ' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_w,1,255);				
				end if;			
			elsif (coalesce(nr_seq_topografia_w::text, '') = '')	then
				open c06;
				loop
				fetch	c06 into
					ie_lado_w,
					ds_topografia_ww;
				    EXIT WHEN NOT FOUND; /* apply on c06 */
					  ds_topografia_w	:= ds_topografia_w || substr(chr(13) || chr(10) || ' ' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_ww,1,255)||
					  substr(chr(13) || chr(10)|| ' ' || wheb_mensagem_pck.get_texto(308871) || ': '||substr(obter_valor_dominio(1372,ie_lado_w),1,100),1,100);				
				    end loop;
				close c06;
			end if;
				
			if (ds_observacao_w IS NOT NULL AND ds_observacao_w::text <> '') then
				ds_observacao_w	:= substr(' (' || wheb_mensagem_pck.get_texto(341899) || '.: '||ds_observacao_w||')',1,2000);
			end if;
			if (length(ds_retorno_w ||ds_observacao_w||ds_item_w||ds_resultado_w|| chr(13) || chr(10) || '       ') < 4000) then
				if (ds_retorno_aux_w  = ds_item_w) then
					ds_item_w := '';
					ds_espaco_w := '';
				else
					ds_retorno_aux_w := ds_item_w;
				end if;					
				
				if (ds_item_w = '') then
					ds_retorno_w := ds_retorno_w ||chr(13) || chr(10) || '        '|| ds_item_w || ds_resultado_w || ds_observacao_w || ds_topografia_w||chr(13) || chr(10)|| ';' ||chr(13) || chr(10) || '       '||chr(13) || chr(10) || '       ';
				else
					if (coalesce(ds_topografia_w::text, '') = '') then
						ds_retorno_w := ds_retorno_w ||ds_espaco_w||ds_item_w || ds_resultado_w || ds_observacao_w || ', '; -- TESTE
					else
						ds_retorno_w := ds_retorno_w ||ds_espaco_w||ds_item_w || ds_resultado_w || ds_observacao_w || ds_topografia_w ||'; '; -- TESTE
					end if;
					ds_espaco_w := chr(13) || chr(10)|| '       ';
				end if;			
			end if;
	 	end loop;
	close c01;
elsif (coalesce(ds_parametro_w,'N') = 'N') then
	open c05;
	loop
	fetch	c05 into
		ds_item_w,
		ds_resultado_w,
		ds_observacao_w,
		nr_seq_topografia_w,
		nr_sequencia_w,
		ds_lado_w,
		nr_seq_apres_w;
	 	EXIT WHEN NOT FOUND; /* apply on c05 */
			
			ds_topografia_w	:= '';
			ie_lado_w		:= '';
			if (nr_seq_topografia_w IS NOT NULL AND nr_seq_topografia_w::text <> '') then
				select	max(DS_TOPOGRAFIA)
				into STRICT	ds_topografia_w
				from	TOPOGRAFIA_DOR
				where	nr_sequencia	= nr_seq_topografia_w;	
				if (ds_lado_w IS NOT NULL AND ds_lado_w::text <> '') then
					ds_topografia_w	:= substr(chr(13) || chr(10) ||'	' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_w,1,255)||
					substr('   ' || wheb_mensagem_pck.get_texto(308871) || ': '||substr(obter_valor_dominio(1372,ds_lado_w),1,100),1,100);	--Lado 
				else	
					ds_topografia_w	:= substr(chr(13) || chr(10) ||'	' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_w,1,255);				
				end if;
			elsif (coalesce(nr_seq_topografia_w::text, '') = '')	then
				open c06;
				loop
				fetch	c06 into
					ie_lado_w,
					ds_topografia_ww;
				    EXIT WHEN NOT FOUND; /* apply on c06 */
					  ds_topografia_w	:= ds_topografia_w || substr(chr(13) || chr(10) || ' ' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_ww,1,255)||
					  substr(chr(13) || chr(10)|| wheb_mensagem_pck.get_texto(308871) || ': '||substr(obter_valor_dominio(1372,ie_lado_w),1,100),1,100);				
				    end loop;
				close c06;
			end if;
			
			if (ds_observacao_w IS NOT NULL AND ds_observacao_w::text <> '') then
				ds_observacao_w	:= substr(chr(13) || chr(10) ||'	' || wheb_mensagem_pck.get_texto(341899) || '.: '||ds_observacao_w,1,2000);
			end if;
			if (length(ds_retorno_w ||ds_observacao_w|| '\b ' ||ds_item_w||' \b0 '|| ds_resultado_w|| chr(13) || chr(10)) < 4000) then
				if (ds_observacao_w IS NOT NULL AND ds_observacao_w::text <> '') then
					begin
					ds_retorno_w := ds_retorno_w || '\b ' ||ds_item_w||' \b0 '|| ds_resultado_w || '; ' ||ds_topografia_w||ds_observacao_w|| chr(13) || chr(10);
					end;
				else
					begin
					ds_retorno_w := ds_retorno_w || '\b ' ||ds_item_w||' \b0 '|| ds_resultado_w || '; ' ||ds_topografia_w||chr(13) || chr(10);	
					end;
				end if;
			end if;
	 	end loop;
	close c05;
elsif (coalesce(ds_parametro_w,'N') = 'T') then
	open c02;
	loop
	fetch	c02 into
		ds_item_w,
		nr_seq_item_w,
		--nr_sequencia_w,
		nr_sequencia_item_w;
	 	EXIT WHEN NOT FOUND; /* apply on c02 */
		begin
		
				
			ds_topografia_w	:= '';
			ie_lado_w		:= '';
			/*
			if	(nr_seq_topografia_w	is not null) then
				select	max(DS_TOPOGRAFIA)
				into	ds_topografia_w
				from	TOPOGRAFIA_DOR
				where	nr_sequencia	= nr_seq_topografia_w;	

				if (ds_lado_w is not null) then
					ds_topografia_w	:= substr(chr(13) || chr(10) ||'	' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_w,1,255)|| 
					substr('   ' || wheb_mensagem_pck.get_texto(308871) || ': '||substr(obter_valor_dominio(1372,ds_lado_w),1,100),1,100);	--Lado 
				else	
					ds_topografia_w	:= substr(chr(13) || chr(10) ||'	' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_w,1,255);				
				end if;
			elsif (nr_seq_topografia_w is null)	then
				open c06;
				loop
				fetch	c06 into
					ie_lado_w,
					ds_topografia_ww;
				    exit 	when c06%notfound;
					  ds_topografia_w	:= ds_topografia_w || substr(chr(13) || chr(10) || ' ' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_ww,1,255)|| 
					  substr(chr(13) || chr(10)|| wheb_mensagem_pck.get_texto(308871) || ': '||substr(obter_valor_dominio(1372,ie_lado_w),1,100),1,100);				  
				    end loop;
				close c06;
			end if;
			
			if	(length(ds_retorno_w ||ds_observacao_w||ds_resultado_w||chr(13) || chr(10) || '	') < 4000) then
	  			ds_retorno_w := ds_retorno_w||ds_item_w||' : ' ;				
			end if;
			*/
		
		open C04;
		loop
		fetch C04 into	
			ds_resultado_w,
			ds_observacao_w,
			nr_seq_topografia_w,
			nr_sequencia_w;
		EXIT WHEN NOT FOUND; /* apply on C04 */
			begin
			--ds_topografia_w	:= '';

			--ie_lado_w		:= '';
			if (nr_seq_topografia_w IS NOT NULL AND nr_seq_topografia_w::text <> '') then
				select	max(DS_TOPOGRAFIA)
				into STRICT	ds_topografia_w
				from	TOPOGRAFIA_DOR
				where	nr_sequencia	= nr_seq_topografia_w;	

				if (ds_lado_w IS NOT NULL AND ds_lado_w::text <> '') then
					ds_topografia_w	:= substr(chr(13) || chr(10) ||'	' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_w,1,255)||
					substr('   ' || wheb_mensagem_pck.get_texto(308871) || ': '||substr(obter_valor_dominio(1372,ds_lado_w),1,100),1,100);	--Lado 
				else	
					ds_topografia_w	:= substr(chr(13) || chr(10) ||'	' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_w,1,255);				
				end if;
			elsif (coalesce(nr_seq_topografia_w::text, '') = '')	then
				open c06;
				loop
				fetch	c06 into
					ie_lado_w,
					ds_topografia_ww;
				    EXIT WHEN NOT FOUND; /* apply on c06 */
					  ds_topografia_w	:= ds_topografia_w || substr(chr(13) || chr(10) || ' ' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_ww,1,255)||
					  substr(chr(13) || chr(10)|| wheb_mensagem_pck.get_texto(308871) || ': '||substr(obter_valor_dominio(1372,ie_lado_w),1,100),1,100);				
				    end loop;
				close c06;
			end if;
			
			if (length(ds_retorno_w ||ds_observacao_w||ds_resultado_w||chr(13) || chr(10) || '	') < 4000) then
	  			ds_retorno_w := ds_retorno_w||ds_item_w||' : ';				
			end if;
			
			if (ds_observacao_w IS NOT NULL AND ds_observacao_w::text <> '') then
				ds_observacao_w	:= substr(' '||ds_observacao_w,1,350);
			end if;
			
			ds_retorno_w :=	ds_retorno_w|| ' '||ds_resultado_w || ';' ||ds_topografia_w || chr(13) || chr(10)|| ds_observacao_w||chr(13) || chr(10)||chr(9);
			
			end;
		end loop;
		close C04;
		end;
	 	end loop;
	close c02;
elsif (coalesce(ds_parametro_w,'N') = 'C')then	
	open c03;
	loop
	fetch	c03 into	
		ds_item_w,
		ds_resultado_w,
		ds_observacao_w,
		nr_seq_topografia_w,
		nr_sequencia_w,
		ds_lado_w;
	 	EXIT WHEN NOT FOUND; /* apply on c03 */
			ds_topografia_w	:= '';
			ie_lado_w		:= '';
			if (nr_seq_topografia_w IS NOT NULL AND nr_seq_topografia_w::text <> '') then
				select	max(DS_TOPOGRAFIA)
				into STRICT	ds_topografia_w
				from	TOPOGRAFIA_DOR
				where	nr_sequencia	= nr_seq_topografia_w;	
				if (ds_lado_w IS NOT NULL AND ds_lado_w::text <> '') then
					ds_topografia_w	:= substr(chr(13) || chr(10) ||'	' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_w,1,255)||
					substr('   ' || wheb_mensagem_pck.get_texto(308871) || ': '||substr(obter_valor_dominio(1372,ds_lado_w),1,100),1,100);	--Lado 
				else	
					ds_topografia_w	:= substr(chr(13) || chr(10) ||'	' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_w,1,255);				
				end if;
			elsif (coalesce(nr_seq_topografia_w::text, '') = '')	then
				open c06;
				loop
				fetch	c06 into
					ie_lado_w,
					ds_topografia_ww;
				    EXIT WHEN NOT FOUND; /* apply on c06 */
					  ds_topografia_w	:= ds_topografia_w || substr(chr(13) || chr(10) || ' ' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_ww,1,255)||
					  substr(chr(13) || chr(10)|| wheb_mensagem_pck.get_texto(308871) || ': '||substr(obter_valor_dominio(1372,ie_lado_w),1,100),1,100);				
				    end loop;
				close c06;
			end if;
			
			if (ds_observacao_w IS NOT NULL AND ds_observacao_w::text <> '') then
				ds_observacao_w	:= substr('(' || wheb_mensagem_pck.get_texto(341899) || '.:  '||ds_observacao_w||')',1,1500);
			end if;
			if (length(ds_retorno_w ||ds_observacao_w||ds_item_w||ds_resultado_w|| chr(13) || chr(10) || '	') < 4000) then
				if (ds_retorno_aux_w  = ds_item_w) then
					ds_item_w := null;
				else
					ds_retorno_aux_w := ds_item_w;
				end if;
			
			
				if (coalesce(ds_item_w::text, '') = '') then
					ds_retorno_w := ds_retorno_w || ds_resultado_w || ds_topografia_w || ie_lado_w || ds_observacao_w|| '; ';
				else	
					if (trim(both ds_topografia_w) <> '') then
						ds_topografia_w	:= ds_topografia_w || chr(13) || chr(10);
					end if;
				
					ds_retorno_w := ds_retorno_w ||ds_espaco_w || ds_item_w || ds_topografia_w || ds_resultado_w || ds_observacao_w|| '; ';
					ds_espaco_w := chr(13) || chr(10)|| '           ';
				end if;
				
			end if;
	 	end loop;
	close c03;
elsif (coalesce(ds_parametro_w,'N') = 'R')then	
	open c03;
	loop
	fetch	c03 into	
		ds_item_w,
		ds_resultado_w,
		ds_observacao_w,
		nr_seq_topografia_w,
		nr_sequencia_w,
		ds_lado_w;
	 	EXIT WHEN NOT FOUND; /* apply on c03 */
			ds_topografia_w	:= '';
			ie_lado_w		:= '';
			if (nr_seq_topografia_w IS NOT NULL AND nr_seq_topografia_w::text <> '') then
				select	max(DS_TOPOGRAFIA)
				into STRICT	ds_topografia_w
				from	TOPOGRAFIA_DOR
				where	nr_sequencia	= nr_seq_topografia_w;	

				if (ds_lado_w IS NOT NULL AND ds_lado_w::text <> '') then
					ds_topografia_w	:= substr(chr(13) || chr(10) ||'            ' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_w,1,255)||
					substr('   ' || wheb_mensagem_pck.get_texto(308871) || ': '||substr(obter_valor_dominio(1372,ds_lado_w),1,100),1,100);	--Lado 
				else	
					ds_topografia_w	:= substr(chr(13) || chr(10) ||'            ' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_w,1,255);				
				end if;
			elsif (coalesce(nr_seq_topografia_w::text, '') = '')	then
				open c06;
				loop
				fetch	c06 into
					ie_lado_w,
					ds_topografia_ww;
				    EXIT WHEN NOT FOUND; /* apply on c06 */
					  ds_topografia_w	:= ds_topografia_w || substr(chr(13) || chr(10) || ' ' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_ww,1,255)||
					  substr(chr(13) || chr(10)|| wheb_mensagem_pck.get_texto(308871) || ': '||substr(obter_valor_dominio(1372,ie_lado_w),1,100),1,100);				
				    end loop;
				close c06;
			end if;
			
			if (ds_observacao_w IS NOT NULL AND ds_observacao_w::text <> '') then
				ds_observacao_w	:= substr('(' || wheb_mensagem_pck.get_texto(341899) || '.:  '||ds_observacao_w||')',1,350);
			end if;
			if (length(ds_retorno_w ||ds_observacao_w||ds_item_w||ds_resultado_w|| chr(13) || chr(10) || '          ') < 4000) then
				if (ds_retorno_aux_w  = ds_item_w) then
					ds_item_w := null;
				else
					ds_retorno_aux_w := ds_item_w;
				end if;				
				ds_retorno_w := ds_retorno_w || ds_resultado_w || '; ';
							
			end if;
	 	end loop;
	close c03;
elsif (coalesce(ds_parametro_w,'N') = 'O')then	
	open c03;
	loop
	fetch	c03 into	
		ds_item_w,
		ds_resultado_w,
		ds_observacao_w,
		nr_seq_topografia_w,
		nr_sequencia_w,
		ds_lado_w;
	 	EXIT WHEN NOT FOUND; /* apply on c03 */
			ds_topografia_w	:= '';
			ie_lado_w		:= '';
			if (nr_seq_topografia_w IS NOT NULL AND nr_seq_topografia_w::text <> '') then
				select	max(DS_TOPOGRAFIA)
				into STRICT	ds_topografia_w
				from	TOPOGRAFIA_DOR
				where	nr_sequencia	= nr_seq_topografia_w;	
				if (ds_lado_w IS NOT NULL AND ds_lado_w::text <> '') then
					ds_topografia_w	:= substr(chr(13) || chr(10) ||'            ' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_w,1,255)||
				  substr('   ' || wheb_mensagem_pck.get_texto(308871) || ': '||substr(obter_valor_dominio(1372,ds_lado_w),1,100),1,100);	--Lado 
				else	
					ds_topografia_w	:= substr(chr(13) || chr(10) ||'            ' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_w,1,255);				
				end if;
			elsif (coalesce(nr_seq_topografia_w::text, '') = '')	then
				open c06;
				loop
				fetch	c06 into
					ie_lado_w,
					ds_topografia_ww;
				    EXIT WHEN NOT FOUND; /* apply on c06 */
					  ds_topografia_w	:= ds_topografia_w || substr(chr(13) || chr(10) || ' ' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_ww,1,255)||
					  substr(chr(13) || chr(10)|| wheb_mensagem_pck.get_texto(308871) || ': '||substr(obter_valor_dominio(1372,ie_lado_w),1,100),1,100);				
				    end loop;
				close c06;
			end if;
			
			if (ds_observacao_w IS NOT NULL AND ds_observacao_w::text <> '') then
				ds_observacao_w	:= substr('(' || wheb_mensagem_pck.get_texto(341899) || '.:  '||ds_observacao_w||')',1,2000);
			end if;
			if (length(ds_retorno_w ||ds_observacao_w||ds_item_w||ds_resultado_w|| chr(13) || chr(10) || '          ') < 4000) then
				if (ds_retorno_aux_w  = ds_item_w) then
					ds_item_w := null;
				else
					ds_retorno_aux_w := ds_item_w;
				end if;				
				ds_retorno_w := ds_retorno_w || ds_resultado_w || ds_observacao_w ||'; ';
							
			end if;
	 	end loop;
	close c03;
elsif (coalesce(ds_parametro_w,'N') = 'G')then
	open c03;
	loop
	fetch	c03 into	
		ds_item_w,
		ds_resultado_w,
		ds_observacao_w,
		nr_seq_topografia_w,
		nr_sequencia_w,
		ds_lado_w;
	 	EXIT WHEN NOT FOUND; /* apply on c03 */
			ds_topografia_w	:= '';
			ie_lado_w		:= '';
			
			if (nr_seq_topografia_w IS NOT NULL AND nr_seq_topografia_w::text <> '')	then
				open c06;
				loop
				fetch	c06 into
					ie_lado_w,
					ds_topografia_ww;
				    EXIT WHEN NOT FOUND; /* apply on c06 */
					  ds_topografia_w	:= ds_topografia_w || substr('    ' || wheb_mensagem_pck.get_texto(341897) ||': '||ds_topografia_ww,1,255)||
					  substr('   ' || wheb_mensagem_pck.get_texto(308871) || ': '||substr(obter_valor_dominio(1372,ie_lado_w),1,100),1,100);	--Lado 			  
				    end loop;
				close c06;
				
				if (coalesce(ds_topografia_w::text, '') = '') then
					select	max(DS_TOPOGRAFIA)
					into STRICT	ds_topografia_w
					from	TOPOGRAFIA_DOR
					where	nr_sequencia	= nr_seq_topografia_w;	

					if (ds_lado_w IS NOT NULL AND ds_lado_w::text <> '') then
						ds_topografia_w	:= substr('    ' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_w,1,255)||
					  substr('   ' || wheb_mensagem_pck.get_texto(308871) || ': '||substr(obter_valor_dominio(1372,ds_lado_w),1,100),1,100);	--Lado 
					else					
						ds_topografia_w	:= substr('    ' || wheb_mensagem_pck.get_texto(341897) || ': '||ds_topografia_w,1,255);--Topografia
					end if;
				end if;
			end if;
			
			if (ds_observacao_w IS NOT NULL AND ds_observacao_w::text <> '') then
				ds_observacao_w	:= substr('(' || wheb_mensagem_pck.get_texto(341899) || '.:  '||ds_observacao_w||')',1,2000);--Obs 
			end if;
			if (length(ds_retorno_w ||ds_observacao_w||ds_item_w||ds_resultado_w||ds_topografia_w|| chr(13) || chr(10) || '	') < 4000) then
				if (ds_retorno_aux_w  = ds_item_w) then
					ds_item_w := null;
				else
					ds_retorno_aux_w := ds_item_w;
				end if;				
				ds_retorno_w := ds_retorno_w || ds_resultado_w || ds_topografia_w || ds_observacao_w ||'; ';
							
			end if;
	 	end loop;
	close c03;
end if;


return ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_resultados_concat_sae ( nr_seq_item_p bigint, nr_sequencia_p bigint) FROM PUBLIC;

