-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_juros_multa_titulo ( nr_titulo_p titulo_receber.nr_titulo%type, dt_referencia_p timestamp, ie_juros_multa_p text) RETURNS bigint AS $body$
DECLARE


vl_juros_w			double precision;
vl_multa_w			double precision;
dt_vencimento_w			titulo_receber.dt_vencimento%type;
ie_dt_vencimento_dia_util_w	varchar(1);
dt_referencia_util_w		timestamp;
dt_vencimento_util_w		timestamp;


BEGIN

select	max(dt_vencimento)
into STRICT	dt_vencimento_w
from	titulo_receber
where	nr_titulo = nr_titulo_p;

dt_referencia_util_w	:= obter_proximo_dia_util(wheb_usuario_pck.get_cd_estabelecimento, dt_referencia_p);

dt_vencimento_util_w	:= obter_proximo_dia_util(wheb_usuario_pck.get_cd_estabelecimento, dt_vencimento_w);

select	obter_se_dia_util(dt_vencimento_w, wheb_usuario_pck.get_cd_estabelecimento)
into STRICT	ie_dt_vencimento_dia_util_w
;

if (coalesce(ie_dt_vencimento_dia_util_w, 'S') = 'N') and (to_date(dt_referencia_util_w,'dd/mm/yyyy') = to_date(dt_vencimento_util_w,'dd/mm/yyyy')) then
	return 0;
else
	return	obter_juros_multa_titulo(nr_titulo_p, dt_referencia_p, 'R', ie_juros_multa_p);
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_juros_multa_titulo ( nr_titulo_p titulo_receber.nr_titulo%type, dt_referencia_p timestamp, ie_juros_multa_p text) FROM PUBLIC;

