-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_proxima_versao_escala ( dt_base_p timestamp, nr_seq_ordem_servico_p bigint, nr_seq_idioma_p bigint default null) RETURNS varchar AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[ X ]  Objetos do dicionário [ X ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
-------------------------------------------------------------------------------------------------------------------
Referências:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
dt_liberacao_w					timestamp;
dt_liberacao_format_w			varchar(20);
ds_mensagem_w 					varchar(32766);


BEGIN
select	min(d.dt_fim)
into STRICT	dt_liberacao_w
from	escala_diaria d
where	d.nr_seq_escala = 21
and		d.dt_inicio > dt_base_p;

if (nr_seq_idioma_p = 5) then
	select	to_char(dt_liberacao_w, 'dd/mon/yyyy', 'nls_date_language=English')
	into STRICT	dt_liberacao_format_w
	;
else
	select	pkg_date_formaters.to_varchar(dt_liberacao_w, 'shortThreeLetterMonth', wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck.get_nm_usuario)
	into STRICT	dt_liberacao_format_w
	;
end if;

select	max(obter_desc_expressao_idioma(cd_exp_informacao, ds_informacao, coalesce(nr_seq_idioma_p, man_obter_idioma_os_local(nr_seq_ordem_servico_p))))
into STRICT	ds_mensagem_w
from	dic_objeto
where	nr_sequencia = 373402
and		ie_tipo_objeto = 'T';

return	ds_mensagem_w || ' ' || dt_liberacao_format_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_proxima_versao_escala ( dt_base_p timestamp, nr_seq_ordem_servico_p bigint, nr_seq_idioma_p bigint default null) FROM PUBLIC;

