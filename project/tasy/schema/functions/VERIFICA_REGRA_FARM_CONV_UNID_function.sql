-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION verifica_regra_farm_conv_unid ( cd_material_p bigint, cd_setor_p bigint, cd_unidade_medida_p text) RETURNS varchar AS $body$
DECLARE

ds_unidade_medida_w	varchar(50);
material_liberado_w		varchar(1);
qt_registro_regra_w		bigint;



BEGIN

select 	coalesce(max('S'),'N')
into STRICT	ds_unidade_medida_w
from 	material_conversao_unidade
where	cd_material	= cd_material_p;

select 	count(1)
into STRICT	qt_registro_regra_w
from 	regra_setor_conv_unid
where	cd_material			= cd_material_p;

if (ds_unidade_medida_w <> 'N') and (qt_registro_regra_w > 0) then

	select 	coalesce(max('S'),'N')
	into STRICT	material_liberado_w
	from 	regra_setor_conv_unid
	where	cd_material		= cd_material_p
	and	cd_setor_atendimento	= cd_setor_p
	and	cd_unidade_medida	= cd_unidade_medida_p;

	return  material_liberado_w;
else
	return 'S';
end if;


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION verifica_regra_farm_conv_unid ( cd_material_p bigint, cd_setor_p bigint, cd_unidade_medida_p text) FROM PUBLIC;

