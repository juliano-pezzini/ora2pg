-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION calcular_esforco_total ( nr_sequencia_p LATAM_REQUISITO.NR_SEQUENCIA%type, nr_seq_gap_p LATAM_REQUISITO.NR_SEQ_GAP%type, nr_seq_prs_p LATAM_REQUISITO.NR_SEQ_PRS%type, ie_necessita_design_p LATAM_REQUISITO.IE_NECESSITA_DESIGN%type, ie_necessita_tecnologia_p LATAM_REQUISITO.IE_NECESSITA_TECNOLOGIA%type, ie_necessita_traducao_p LATAM_REQUISITO.IE_NECESSITA_TRADUCAO%type, ie_esforco_desenv_p LATAM_REQUISITO.IE_ESFORCO_DESENV%type, ie_complexidade_p LATAM_REQUISITO.IE_COMPLEXIDADE%type, pr_confianca_p LATAM_REQUISITO.PR_CONFIANCA%type ) RETURNS bigint AS $body$
DECLARE


qt_esforco_requisito_w  LATAM_REQUISITO.QT_TEMPO_HORAS%type;
qt_esforco_total_w  	LATAM_REQUISITO.QT_TEMPO_HORAS%type;


BEGIN

qt_esforco_requisito_w := coalesce(CALCULAR_ESFORCO_REQUISITO(
							nr_sequencia_p,
							nr_seq_gap_p,
							nr_seq_prs_p, 
							ie_esforco_desenv_p, 
							ie_complexidade_p,
							pr_confianca_p
                          ), 0);

qt_esforco_total_w := (
                        qt_esforco_requisito_w +
                        coalesce(CALCULAR_ESFORCO_AREA(
							nr_sequencia_p,
							nr_seq_gap_p,
							nr_seq_prs_p,
							'TE',
							ie_necessita_design_p,
							ie_necessita_tecnologia_p,
							qt_esforco_requisito_w,
							ie_necessita_traducao_p
						), 0) +
                        coalesce(CALCULAR_ESFORCO_AREA(
							nr_sequencia_p,
							nr_seq_gap_p,
							nr_seq_prs_p,
							'DE',
							ie_necessita_design_p,
							ie_necessita_tecnologia_p, 
							qt_esforco_requisito_w,
							ie_necessita_traducao_p
						), 0) +
                        coalesce(CALCULAR_ESFORCO_AREA(
							nr_sequencia_p,
							nr_seq_gap_p,
							nr_seq_prs_p, 
							'TR',
							ie_necessita_design_p,
							ie_necessita_tecnologia_p,
							qt_esforco_requisito_w,
							ie_necessita_traducao_p
						), 0)
                     );

RETURN qt_esforco_total_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION calcular_esforco_total ( nr_sequencia_p LATAM_REQUISITO.NR_SEQUENCIA%type, nr_seq_gap_p LATAM_REQUISITO.NR_SEQ_GAP%type, nr_seq_prs_p LATAM_REQUISITO.NR_SEQ_PRS%type, ie_necessita_design_p LATAM_REQUISITO.IE_NECESSITA_DESIGN%type, ie_necessita_tecnologia_p LATAM_REQUISITO.IE_NECESSITA_TECNOLOGIA%type, ie_necessita_traducao_p LATAM_REQUISITO.IE_NECESSITA_TRADUCAO%type, ie_esforco_desenv_p LATAM_REQUISITO.IE_ESFORCO_DESENV%type, ie_complexidade_p LATAM_REQUISITO.IE_COMPLEXIDADE%type, pr_confianca_p LATAM_REQUISITO.PR_CONFIANCA%type ) FROM PUBLIC;

