-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_ordem_compra ( nr_ordem_compra_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


/*
ie_opcao_p
F	= Fornecedor
DE	= Documento externo
C	= Comprador
NC	= Nome do comprador
S	= Solicitante
CF	= CNPJ
U	= Urgente
M	= Moeda
D	= Desconto
FR	= Frete
DA	= Despesa acessoria
SA	= Setor de atendimento
NA	= Numero do atendimento
CP	= Código da Condição Pagamento
DC	= Descrição da Condição Pagamento
CE	= Nr controle edital
TF	= Tipo de Frete
PI	= Número processo interno
TC	= NR_SEQ_TIPO_COMPRA
AP	= dt_aprovacao,
DI 	= dt_inclusão
DO	= dt_ordem_compra
COT	= Numero da cotação
TP 	= Tipo ordem
*/
ds_resultado_w		varchar(254);
nm_fornecedor_w		varchar(254);
nr_documento_externo_w	ordem_compra.nr_documento_externo%type;
nr_atendimento_w	bigint;
cd_comprador_w		bigint;
cd_pessoa_solicitante_w	varchar(10);
cd_cgc_fornecedor_w	varchar(14);
ie_urgente_w		varchar(1);
cd_moeda_w		integer;
vl_desconto_w		double precision;
vl_frete_w		double precision;
vl_despesa_acessoria_w	double precision;
cd_setor_atendimento_w	integer;
cd_condicao_pagamento_w	bigint;
ds_condicao_pagamento_w	varchar(80);
nr_controle_edital_w	varchar(100);
ie_frete_w		varchar(1);
nr_processo_interno_w	varchar(100);
nr_seq_tipo_compra_w	bigint;
dt_aprovacao_w		timestamp;
dt_inclusao_w		timestamp;
dt_ordem_compra_w	timestamp;
nr_cot_compra_w		bigint;
ie_tipo_ordem_w		varchar(1);
nm_comprador_w		comprador.nm_guerra%type;



BEGIN
select	substr(obter_nome_pf_pj(cd_pessoa_fisica,cd_cgc_fornecedor),1,254),
	nr_documento_externo,
	nr_atendimento,
	cd_comprador,
	cd_pessoa_solicitante,
	cd_cgc_fornecedor,
	ie_urgente,
	cd_moeda,
	vl_desconto,
	vl_frete,
	ie_frete,
	vl_despesa_acessoria,
	cd_setor_atendimento,
	cd_condicao_pagamento,
	substr(obter_desc_cond_pagto(cd_condicao_pagamento),1,80) ds_condicao_pagamento,
	nr_controle_edital,
	nr_processo_interno,
	nr_seq_tipo_compra,
	dt_aprovacao,
	dt_inclusao,
	dt_ordem_compra,
	ie_tipo_ordem,
	substr(sup_obter_nome_comprador(cd_estabelecimento, cd_comprador),1,255)
into STRICT	nm_fornecedor_w,
	nr_documento_externo_w,
	nr_atendimento_w,
	cd_comprador_w,
	cd_pessoa_solicitante_w,
	cd_cgc_fornecedor_w,
	ie_urgente_w,
	cd_moeda_w,
	vl_desconto_w,
	vl_frete_w,
	ie_frete_w,
	vl_despesa_acessoria_w,
	cd_setor_atendimento_w,
	cd_condicao_pagamento_w,
	ds_condicao_pagamento_w,
	nr_controle_edital_w,
	nr_processo_interno_w,
	nr_seq_tipo_compra_w,
	dt_aprovacao_w,
	dt_inclusao_w,
	dt_ordem_compra_w,
	ie_tipo_ordem_w,
	nm_comprador_w
from	ordem_compra
where	nr_ordem_compra	= nr_ordem_compra_p;

select	max(nr_cot_compra)
into STRICT	nr_cot_compra_w
from	ordem_compra_item
where	nr_ordem_compra = nr_ordem_compra_p;


if (ie_opcao_p = 'F') then
	ds_resultado_w	:= nm_fornecedor_w;
elsif (ie_opcao_p = 'DE') then
	ds_resultado_w	:= nr_documento_externo_w;
elsif (ie_opcao_p = 'C') then
	ds_resultado_w	:= cd_comprador_w;
elsif (ie_opcao_p = 'S') then
	ds_resultado_w	:= cd_pessoa_solicitante_w;
elsif (ie_opcao_p = 'CF') then
	ds_resultado_w	:= cd_cgc_fornecedor_w;
elsif (ie_opcao_p = 'U') then
	ds_resultado_w	:= ie_urgente_w;
elsif (ie_opcao_p = 'M') then
	ds_resultado_w	:= cd_moeda_w;
elsif (ie_opcao_p = 'D') then
	ds_resultado_w	:= vl_desconto_w;
elsif (ie_opcao_p = 'FR') then
	ds_resultado_w	:= vl_frete_w;
elsif (ie_opcao_p = 'TF') then
	ds_resultado_w	:= ie_frete_w;
elsif (ie_opcao_p = 'DA') then
	ds_resultado_w	:= vl_despesa_acessoria_w;
elsif (ie_opcao_p = 'SA') then
	ds_resultado_w	:= cd_setor_atendimento_w;
elsif (ie_opcao_p = 'NA') then
	ds_resultado_w	:= nr_atendimento_w;
elsif (ie_opcao_p = 'CP') then
	ds_resultado_w	:= cd_condicao_pagamento_w;
elsif (ie_opcao_p = 'DC') then
	ds_resultado_w	:= ds_condicao_pagamento_w;
elsif (ie_opcao_p = 'CE') then
	ds_resultado_w	:= nr_controle_edital_w;
elsif (ie_opcao_p = 'PI') then
	ds_resultado_w	:= nr_processo_interno_w;
elsif (ie_opcao_p = 'TC') then
	ds_resultado_w	:= nr_seq_tipo_compra_w;
elsif (ie_opcao_p = 'AP') then
	ds_resultado_w	:= dt_aprovacao_w;
elsif (ie_opcao_p = 'DI') then
	ds_resultado_w	:= dt_inclusao_w;
elsif (ie_opcao_p = 'DO') then
	ds_resultado_w	:= dt_ordem_compra_w;
elsif (ie_opcao_p = 'COT') then
	ds_resultado_w	:= nr_cot_compra_w;
elsif (ie_opcao_p = 'TP') then
	ds_resultado_w	:= ie_tipo_ordem_w;
elsif (ie_opcao_p = 'NC') then
	ds_resultado_w	:= nm_comprador_w;
end if;

return ds_resultado_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_ordem_compra ( nr_ordem_compra_p bigint, ie_opcao_p text) FROM PUBLIC;

