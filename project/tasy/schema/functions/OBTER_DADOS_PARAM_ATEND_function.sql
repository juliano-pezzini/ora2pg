-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_param_atend (cd_estabelecimento_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


ds_retorno_w	varchar(255) := '';	
ds_comando_w			varchar(2000);
vl_retorno_w			bigint;
retorno_w				integer;
c001					integer;
/*
   ie_opcao_p
	XX - Utilizado para identificar a existencia de um registro na tabela parametro_atendimento para o estabelecimento ('S' = Existe o registro, 'N' = Nao existe o registro)
	OH - Obitos Institucionais
	TO - Padronizacao do calculo da Taxa de ocupacao dos subindicadores do Censo
	PC - No CIHA, gerar procedimentos ambulatoriais direto da Conta
	TA- Regra Tipo Atendimento CIHA
	LI - Tratar leitos interditados
	ME - Consiste medico por esbelecimento
	AG - Integracao com o sistema Aghos
	PE - Proc. interno referente a extracao de tecido para armazenamento
	US - Usuario padrao do sistema Aghos
	AI - Gerar alta automatica para Internacao	
	LP - Considerar regra de entrega de laudos para os exames de anatomia patologica
	GI - Integracao com sistema de regulacao de leitos GERINT
	CA - To show the Insurance holder if there is only one record
	SI - update Insurance Holder values in master person index
*/
BEGIN


if (ie_opcao_p = 'XX') then
	select	CASE WHEN count(1)=0 THEN 'N'  ELSE 'S' END
	into STRICT	ds_retorno_w
	from	parametro_atendimento
	where	cd_estabelecimento = cd_estabelecimento_p;
elsif (ie_opcao_p = 'OH') then
	select	coalesce(max(ie_obito_institucional),'N')
	into STRICT	ds_retorno_w
	from	parametro_atendimento
	where	cd_estabelecimento = cd_estabelecimento_p;
elsif (ie_opcao_p = 'TO') then
	select	coalesce(max(ie_calculo_tx_ocup), 'N')
	into STRICT	ds_retorno_w
	from	parametro_atendimento
	where	cd_estabelecimento = cd_estabelecimento_p;
elsif (ie_opcao_p = 'PC') then
	select	coalesce(max(ie_procedimento_conta), 'N')
	into STRICT	ds_retorno_w
	from	parametro_atendimento
	where	cd_estabelecimento = cd_estabelecimento_p;
elsif (ie_opcao_p = 'TA') then
	select	coalesce(max(ie_tipo_atendimento_ciha), 2)
	into STRICT	ds_retorno_w
	from	parametro_atendimento
	where	cd_estabelecimento = cd_estabelecimento_p;
elsif (ie_opcao_p = 'LI') then
	select	coalesce(max(ie_leitos_interditados),'S')
	into STRICT	ds_retorno_w
	from	parametro_atendimento
	where	cd_estabelecimento = cd_estabelecimento_p;	
elsif (ie_opcao_p = 'ME') then
	select	coalesce(max(ie_consite_medico_estab),'S')
	into STRICT	ds_retorno_w
	from	parametro_atendimento
	where	cd_estabelecimento = cd_estabelecimento_p;
elsif (ie_opcao_p = 'AG') then
	select	coalesce(max(ie_integracao_aghos),'N')
	into STRICT	ds_retorno_w
	from	parametro_atendimento
	where	cd_estabelecimento = cd_estabelecimento_p;
elsif (ie_opcao_p = 'PE') then
	select	max(nr_seq_proc_interno)
	into STRICT	ds_retorno_w
	from	parametro_atendimento
	where	cd_estabelecimento = cd_estabelecimento_p;	
elsif (ie_opcao_p = 'US') then
	select	max(nm_usuario_aghos)
	into STRICT	ds_retorno_w
	from	parametro_atendimento
	where	cd_estabelecimento = cd_estabelecimento_p;	
elsif (ie_opcao_p = 'AI') then
	select	max(coalesce(IE_GERAR_ALTA_AUT_INT, 'N'))
	into STRICT	ds_retorno_w
	from	parametro_atendimento
	where	cd_estabelecimento = cd_estabelecimento_p;	
elsif (ie_opcao_p = 'ACC') then
	select	max(coalesce(IE_GERAR_ALTA_AUT_PASS_CC, 'N'))
	into STRICT	ds_retorno_w
	from	parametro_atendimento
	where	cd_estabelecimento = cd_estabelecimento_p;		
elsif (ie_opcao_p = 'LP') then
	select	max(coalesce(ie_regra_laudo_patol, 'N'))
	into STRICT	ds_retorno_w
	from	parametro_atendimento
	where	cd_estabelecimento = cd_estabelecimento_p;	
elsif (ie_opcao_p = 'GI') then
	select	max(coalesce(ie_regulacao_gerint,'N'))
	into STRICT	ds_retorno_w
	from	parametro_atendimento
	where	cd_estabelecimento = cd_estabelecimento_p;
elsif (ie_opcao_p = 'CA') then
	select	max(coalesce(ie_selec_conv_aut,'N'))
	into STRICT	ds_retorno_w
	from	parametro_atendimento
	where	cd_estabelecimento = cd_estabelecimento_p;
elsif (ie_opcao_p = 'SI') then
	select	max(coalesce(ie_save_insurance_holder,'N'))
	into STRICT	ds_retorno_w
	from	parametro_atendimento
	where	cd_estabelecimento = cd_estabelecimento_p;
end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_param_atend (cd_estabelecimento_p bigint, ie_opcao_p text) FROM PUBLIC;

