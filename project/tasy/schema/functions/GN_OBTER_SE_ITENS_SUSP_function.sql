-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION gn_obter_se_itens_susp (nr_prescricao_p bigint) RETURNS char AS $body$
DECLARE


ie_item_susp_w	char(1)	:= 'N';
qt_susp_w		bigint;


BEGIN

select	count(*)
into STRICT	qt_susp_w
from	prescr_dieta where 	ie_suspenso = 'S'
and		nr_prescricao = nr_prescricao_p LIMIT 1;

if (qt_susp_w = 0) then
	select	count(*)
	into STRICT	qt_susp_w
	from	rep_jejum where		ie_suspenso = 'S'
	and		nr_prescricao = nr_prescricao_p LIMIT 1;

	if (qt_susp_w = 0) then
		select	count(*)
		into STRICT	qt_susp_w
		from	prescr_material where 	ie_suspenso = 'S'
		and 	ie_agrupador = 12
		and		nr_prescricao = nr_prescricao_p LIMIT 1;

		if (qt_susp_w = 0) then
			select	count(*)
			into STRICT	qt_susp_w
			from	prescr_material where		ie_suspenso = 'S'
			and 	ie_agrupador = 8
			and	nr_prescricao = nr_prescricao_p LIMIT 1;

			if (qt_susp_w = 0) then
				select	count(*)
				into STRICT	qt_susp_w
				from	nut_pac where		ie_suspenso = 'S'
				and	ie_npt_adulta = 'S'
				and	nr_prescricao = nr_prescricao_p LIMIT 1;

					if (qt_susp_w = 0) then
						select	count(*)
						into STRICT	qt_susp_w
						from	nut_pac where		ie_suspenso = 'S'
						and	ie_npt_adulta = 'N'
						and	nr_prescricao = nr_prescricao_p LIMIT 1;

						if (qt_susp_w = 0) then
							select	count(*)
							into STRICT	qt_susp_w
							from	nut_pac where		ie_suspenso = 'S'
							and	ie_npt_adulta = 'P'
							and	nr_prescricao = nr_prescricao_p LIMIT 1;

							if (qt_susp_w = 0) then
								select	count(*)
								into STRICT	qt_susp_w
								from (	SELECT	1
											from	prescr_material a where		a.nr_prescricao = nr_prescricao_p
											and	a.ie_suspenso = 'S'
											and	a.ie_agrupador = 16
											
union all

											SELECT	1
											from	prescr_material a,
													prescr_material b where		a.nr_prescricao = b.nr_prescricao
											and	b.nr_sequencia_diluicao = a.nr_seq_material
											and	b.ie_agrupador = 17
											and	a.nr_prescricao = nr_prescricao_p
											and	a.ie_suspenso = 'S' LIMIT 1) alias2;
								if (qt_susp_w = 0) then
									ie_item_susp_w	:= 'N';
								else
									ie_item_susp_w	:= 'S';
								end if;
							else
								ie_item_susp_w	:= 'S';
							end if;

						else
							ie_item_susp_w	:= 'S';
						end if;

					else
						ie_item_susp_w	:= 'S';
					end if;

			else
				ie_item_susp_w	:= 'S';
			end if;

		else
			ie_item_susp_w	:= 'S';
		end if;
	else
		ie_item_susp_w	:= 'S';
	end if;
else
	ie_item_susp_w	:= 'S';
end if;

return	ie_item_susp_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION gn_obter_se_itens_susp (nr_prescricao_p bigint) FROM PUBLIC;

