-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION usage_config_obter_parent_nav ( nr_sequencia_p bigint) RETURNS bigint AS $body$
DECLARE

        retorno_w OBJETO_SCHEMATIC.nr_seq_obj_sup%type;

BEGIN
        SELECT MAX(nr_seq_sup)
        INTO STRICT    retorno_w
        FROM
                (WITH RECURSIVE cte AS (
SELECT aa.nr_seq_obj_sup nr_seq_sup
                FROM objeto_schematic aa
LEFT OUTER JOIN objeto_schematic bb ON (aa.nr_seq_obj_sup = bb.nr_sequencia)
 WHERE aa.nr_sequencia         = nr_sequencia_p
  UNION ALL
SELECT aa.nr_seq_obj_sup nr_seq_sup
                FROM objeto_schematic aa
LEFT OUTER JOIN objeto_schematic bb ON (aa.nr_seq_obj_sup = bb.nr_sequencia)
 JOIN cte c ON (c.prior nr_seq_obj_sup = aa.nr_sequencia)

) SELECT * FROM cte WHERE ((bb.ie_tipo_objeto               IN ('TVN','T','IT','DDM','VMI')
                     OR (bb.ie_tipo_objeto                 = 'MN'
                    AND bb.ie_tipo_obj_navegador           = 'TG'))
                     OR (aa.ie_tipo_objeto                 = 'T'
                    AND bb.ie_tipo_objeto                  = 'MN'
                    AND bb.ie_tipo_obj_navegador           = 'T')
                     OR (aa.ie_tipo_objeto                 = 'DDM'
                    AND bb.ie_tipo_objeto                  = 'MN'
                    AND bb.ie_tipo_obj_navegador           = 'DDM')) ORDER BY  level
                ;
) alias7
        WHERE   1      =1  LIMIT 1;
        RETURN retorno_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION usage_config_obter_parent_nav ( nr_sequencia_p bigint) FROM PUBLIC;

