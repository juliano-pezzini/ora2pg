-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_tipo_ped_impug ( nr_seq_conta_p pls_processo_conta.nr_sequencia%type, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


/*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [  ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/ie_tipo_pedido_w	pls_proc_conta_pedido.ie_tipo_pedido%type;
vl_pedido_w		pls_proc_conta_pedido.vl_pedido%type;
ds_memoria_calc_w	pls_proc_conta_pedido.ds_memoria_calc%type;
ds_retorno_w		varchar(4000);


BEGIN

select	max(coalesce(ie_tipo_pedido, '0')) ie_tipo_pedido,
	max(coalesce(vl_pedido, 0)) vl_pedido,
	max(coalesce(ds_memoria_calc, '0')) ds_memoria_calc
into STRICT	ie_tipo_pedido_w,
	vl_pedido_w,
	ds_memoria_calc_w
from	pls_proc_conta_pedido
where	nr_seq_proc_conta = nr_seq_conta_p;

if (ie_opcao_p = 'A') then
	if (ie_tipo_pedido_w = 'A') then
		ds_retorno_w := '(x)Anulação';
	elsif((ie_tipo_pedido_w = '0') or (ie_tipo_pedido_w <> 'A')) then
		ds_retorno_w := '( )Anulação';
	end if;
elsif (ie_opcao_p = 'R') then
	if (ie_tipo_pedido_w = 'R') then
		select	'(x)Redução do valor original'||chr(13)|| chr(10)||
			'(Valor ou porcentagem: '||campo_mascara_virgula(vl_pedido_w)||' )'||chr(13)||chr(10)||
			'Memória de calculo: '||campo_mascara_virgula(ds_memoria_calc_w)
		into STRICT	ds_retorno_w
		;
	elsif ((ie_tipo_pedido_w = '0') or (ie_tipo_pedido_w <> 'R')) then
		select	'( )Redução do valor original'||chr(13)|| chr(10)||
			'(Valor ou porcentagem:_______)'||chr(13)||chr(10)||
			'Memória de calculo:__________ '
		into STRICT	ds_retorno_w
		;
	end if;

elsif (ie_opcao_p = 'RA') then
	if (ie_tipo_pedido_w = 'RA') then
		select	'(x)Anulação / Redução do valor original'||chr(13)||chr(10)||
			'(Valor ou porcentagem: '||campo_mascara_virgula(vl_pedido_w)||' )'||chr(13)||chr(10)||
			'Memória de calculo: '||campo_mascara_virgula(ds_memoria_calc_w)
		into STRICT	ds_retorno_w
		;
	elsif ((ie_tipo_pedido_w = '0') or (ie_tipo_pedido_w <> 'RA')) then
		select	'( )Anulação / Redução do valor original'||chr(13)||chr(10)||
			'(Valor ou porcentagem:_________ )'||chr(13)||chr(10)||
			'Memória de calculo:____________ '
		into STRICT	ds_retorno_w
		;
	end if;
end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_tipo_ped_impug ( nr_seq_conta_p pls_processo_conta.nr_sequencia%type, ie_opcao_p text) FROM PUBLIC;

