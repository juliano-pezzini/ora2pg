-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_atend_nota_est_can (nr_atendimento_p bigint) RETURNS varchar AS $body$
DECLARE

 
ie_possui_nota_est_can_w	varchar(1);
qt_titulo_w			varchar(1);
			

BEGIN 
 
begin 
	select	nr_interno_conta 
	into STRICT	qt_titulo_w 
	from	conta_paciente 
	where	nr_atendimento = nr_atendimento_p 
	and	((substr(obter_nf_conta(NR_INTERNO_CONTA,2),1,100) is not null) or (substr(obter_titulo_conta_protocolo(0, NR_INTERNO_CONTA),1,100) is not null))  LIMIT 1;
exception 
	when 	no_data_found then 
		qt_titulo_w := 0;
end;
	 
select	coalesce(max('S'),'N') 
into STRICT	ie_possui_nota_est_can_w 
from	conta_paciente 
where	nr_atendimento = nr_atendimento_p 
and	((substr(obter_nf_conta(NR_INTERNO_CONTA,2),1,100) is not null) or (substr(obter_titulo_conta_protocolo(0, NR_INTERNO_CONTA),1,100) is not null)) 
and	coalesce(ie_cancelamento::text, '') = '';
 
return	ie_possui_nota_est_can_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_atend_nota_est_can (nr_atendimento_p bigint) FROM PUBLIC;

