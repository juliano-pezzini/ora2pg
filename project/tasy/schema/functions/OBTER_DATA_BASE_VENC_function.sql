-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_data_base_venc (DT_BASE_P timestamp, IE_FORMA_PAGAMENTO_P bigint) RETURNS timestamp AS $body$
DECLARE



dt_base_w		timestamp;
dia_semana_w		bigint;
dia_mes_w		bigint;


BEGIN

dt_base_w		:= PKG_DATE_UTILS.start_of(dt_base_p, 'dd',0);

/* define data base para condicao (fora semana) */

if    ie_forma_pagamento_p = 3 then
      begin
      dia_semana_w := pkg_date_utils.get_weekday(dt_base_w);
      if   dia_semana_w > 1 then
           dt_base_w := dt_base_w + (8 - dia_semana_w);
      end if;
      end;
end if;

/* define data base para condicao (fora dezena) */

if    ie_forma_pagamento_p = 4 then
      begin
      dia_mes_w := (PKG_DATE_UTILS.extract_field('DAY',dt_base_w))::numeric;
      if   dia_mes_w < 10 then
           dt_base_w := pkg_date_utils.get_date(10, dt_base_w, 0);
      else
           if   dia_mes_w < 20 then
                dt_base_w := pkg_date_utils.get_date(20, dt_base_w, 0);
           else
                dt_base_w := pkg_date_utils.get_date(1, pkg_date_utils.add_month(dt_base_w, 1,0), 0);
           end if;
      end if;
      end;
end if;

/* define data base para condicao (fora quinzena) */

if    ie_forma_pagamento_p = 5 then
      begin
      dia_mes_w := (PKG_DATE_UTILS.extract_field('DAY',dt_base_w))::numeric;
      if   dia_mes_w < 15 then
           dt_base_w := pkg_date_utils.get_date(15, dt_base_w, 0);
      else
           dt_base_w := pkg_date_utils.get_date(1, pkg_date_utils.add_month(dt_base_w, 1, 0), 0);
      end if;
      end;
end if;

/* define data base para condicao (fora mes) */

if    ie_forma_pagamento_p = 6 then
      dt_base_w := pkg_date_utils.get_date(1, pkg_date_utils.add_month(dt_base_w, 1,0), 0);
end if;

Return dt_base_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_data_base_venc (DT_BASE_P timestamp, IE_FORMA_PAGAMENTO_P bigint) FROM PUBLIC;

