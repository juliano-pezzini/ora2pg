-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_cd_setor_atend_padrao ( nr_seq_proc_interno_p bigint, nr_seq_rotina_p bigint, cd_estabelecimento_p bigint, cd_setor_atendimento_p bigint, nr_atendimento_p bigint) RETURNS bigint AS $body$
DECLARE

		
cd_setor_atendimento_w		procedimento_setor_atend.cd_setor_atendimento%type;
cd_procedimento_w			proc_interno.cd_procedimento%type;
ie_origem_proced_w			proc_interno.ie_origem_proced%type;
nr_seq_exame_w				prescr_procedimento.nr_seq_exame%type;
param_CPOE_493_w            varchar(1) := 'N';
ie_retorno_w				varchar(2) := 'N';
ie_tipo_atendimento_w       procedimento_setor_atend.IE_PRIORIDADE%type;
cd_setor_atendimento_jp_w   procedimento_setor_atend.cd_setor_atendimento%type;


BEGIN

    ie_tipo_atendimento_w := OBTER_TIPO_ATENDIMENTO(nr_atendimento_p);

	param_CPOE_493_w := Obter_param_Usuario(924, 493, WHEB_USUARIO_PCK.get_cd_perfil, WHEB_USUARIO_PCK.get_nm_usuario, coalesce(WHEB_USUARIO_PCK.get_cd_estabelecimento, obter_estabelecimento_ativo), param_CPOE_493_w);
	SELECT * FROM Obter_Proc_Tab_Interno(nr_seq_proc_interno_p, null, nr_atendimento_p, 0, cd_procedimento_w, ie_origem_proced_w) INTO STRICT cd_procedimento_w, ie_origem_proced_w;
	nr_seq_exame_w := obter_nr_seq_exame( nr_seq_proc_interno_p, nr_atendimento_p, nr_seq_rotina_p);

	if (param_CPOE_493_w = 'N') then
		if (coalesce(nr_seq_exame_w, 0) > 0) then -- e exame?
            if (coalesce(pkg_i18n.get_user_locale, 'pt_BR') = 'ja_JP') then
                cd_setor_atendimento_jp_w := Obter_Set_exec_proc_interno_jp(nr_seq_proc_interno_p, null, null);

                if (coalesce(cd_setor_atendimento_jp_w, 0) > 0) then

                    cd_setor_atendimento_w := cd_setor_atendimento_jp_w;

                else

                    if (ie_tipo_atendimento_w = 1) then 

                        cd_setor_atendimento_w := coalesce(obter_setor_atual_paciente(nr_atendimento_p), 0);

                    else

                        cd_setor_atendimento_w := coalesce(obter_setor_usuario(WHEB_USUARIO_PCK.get_nm_usuario), 0);

                    end if;

                end if;

            else

                cd_setor_atendimento_w := Obter_setor_Atend_proc_lab(cd_estabelecimento_p,cd_procedimento_w,ie_origem_proced_w,null,cd_setor_atendimento_p,null,nr_seq_exame_w, nr_atendimento_p);

            end if;

		else

             if (coalesce(pkg_i18n.get_user_locale, 'pt_BR') = 'ja_JP') then

                cd_setor_atendimento_jp_w := Obter_Set_exec_proc_interno_jp(nr_seq_proc_interno_p, null, null);
				if (coalesce(cd_setor_atendimento_jp_w, 0) > 0) then

                    cd_setor_atendimento_w := cd_setor_atendimento_jp_w;

                else

                    if (ie_tipo_atendimento_w = 1) then 

                        cd_setor_atendimento_w := coalesce(obter_setor_atual_paciente(nr_atendimento_p), 0);

                    else

                        cd_setor_atendimento_w := coalesce(obter_setor_usuario(WHEB_USUARIO_PCK.get_nm_usuario), 0);

                    end if;

                end if;

            else

                cd_setor_atendimento_w := obter_setor_atend_proc(cd_estabelecimento_p, cd_procedimento_w, ie_origem_proced_w, null, null, null, nr_seq_proc_interno_p, nr_atendimento_p);

            end if;

		end if;

		if (coalesce(cd_setor_atendimento_w, 0) = 0) then
			cd_setor_atendimento_w := obter_setor_atend_proc_estab(cd_procedimento_w, ie_origem_proced_w, null, cd_setor_atendimento_p, null, nr_seq_proc_interno_p, nr_atendimento_p);
		end if;

	else

        cd_setor_atendimento_w := obter_setor_atual_paciente(nr_atendimento_p);

	end if;
	return cd_setor_atendimento_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_cd_setor_atend_padrao ( nr_seq_proc_interno_p bigint, nr_seq_rotina_p bigint, cd_estabelecimento_p bigint, cd_setor_atendimento_p bigint, nr_atendimento_p bigint) FROM PUBLIC;

