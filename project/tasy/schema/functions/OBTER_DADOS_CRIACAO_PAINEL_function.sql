-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_criacao_painel ( nr_seq_indicador_p bigint, nm_usuario_p text, ie_opacao_p text, cd_perfil_p bigint) RETURNS varchar AS $body$
DECLARE

/*
LP	-	lista de paneis
TP	-	topo do painel
EP	-	esquerda do painel
AL	-	altura do painel
LA	-	largura do painel
CO	-	cor do painel
FO	-	fonte do painel
TF	-	tamanho fonte painel

*/
painel_w		bigint;
lista_painel_w		varchar(4000);
qt_esquerda_w		integer;
qt_topo_w		integer;
qt_altura_w		integer;
qt_largura_w		integer;
ds_cor_padrao_w		varchar(15);
qt_fonte_w			smallint;
ds_fonte_w		varchar(30);


c01 CURSOR FOR
	SELECT	distinct nr_seq_indicador
	from	indicador_gestao_usuario
	where	nm_usuario = nm_usuario_p;


c02 CURSOR FOR
	SELECT	distinct nr_seq_indicador
	from	indicador_gestao_usuario
	where	cd_perfil = cd_perfil_p;


BEGIN

if (ie_opacao_p = 'LP') then
	if (cd_perfil_p IS NOT NULL AND cd_perfil_p::text <> '') and (cd_perfil_p <> 0) then
		open c02;
			loop
			fetch c02 into
				painel_w;
			EXIT WHEN NOT FOUND; /* apply on c02 */
				begin
					lista_painel_w := substr(to_char(painel_w) || ',' || lista_painel_w,1,4000);
				end;
			end loop;
		close c02;
	else
		open c01;
			loop
			fetch c01 into
				painel_w;
			EXIT WHEN NOT FOUND; /* apply on c01 */
				begin
					lista_painel_w := substr(to_char(painel_w) || ',' || lista_painel_w,1,4000);
				end;
			end loop;
		close c01;
	end if;

	return lista_painel_w;
end if;

select	qt_altura,
		qt_largura,
		coalesce(ds_cor_padrao,'clWhite'),
		ds_tipo_fonte,
		qt_fonte
into STRICT	qt_altura_w,
		qt_largura_w,
		ds_cor_padrao_w,
		ds_fonte_w,
		qt_fonte_w
from	indicador_gestao
where	nr_sequencia = nr_seq_indicador_p;


select	a.qt_topo,
	a.qt_esquerda,
	coalesce(a.qt_altura, qt_altura_w),
	coalesce(a.qt_largura, qt_largura_w),
	coalesce(a.ds_cor, ds_cor_padrao_w)
into STRICT	qt_topo_w,
	qt_esquerda_w,
	qt_altura_w,
	qt_largura_w,
	ds_cor_padrao_w
from	indicador_gestao_usuario a,
	indicador_gestao b
where	a.nr_seq_indicador = b.nr_sequencia
and	a.nr_seq_indicador = nr_seq_indicador_p
and	(((nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') and (nm_usuario_p <> 'x') and (a.nm_usuario = nm_usuario_p)) or
	 (cd_perfil_p IS NOT NULL AND cd_perfil_p::text <> '' AND cd_perfil = cd_perfil_p));

if (ie_opacao_p = 'TP') then
	return	qt_topo_w;
elsif (ie_opacao_p = 'EP') then
	return	qt_esquerda_w;
elsif (ie_opacao_p = 'AL') then
	return	qt_altura_w;
elsif (ie_opacao_p = 'LA') then
	return	qt_largura_w;
elsif (ie_opacao_p = 'CO') then
	return	ds_cor_padrao_w;
elsif (ie_opacao_p = 'FO') then
	return	ds_fonte_w;
elsif (ie_opacao_p = 'TF') then
	return	qt_fonte_w;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_criacao_painel ( nr_seq_indicador_p bigint, nm_usuario_p text, ie_opacao_p text, cd_perfil_p bigint) FROM PUBLIC;

