-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION con_media_geral_quesito_aval ( cd_consultor_p text) RETURNS varchar AS $body$
DECLARE

 
qt_retorno_w		varchar(15);
qt_resultado_w		varchar(15);			
 

BEGIN 
select	round(coalesce((sum((vl_media_proj)::numeric )/count(nr_seq_proj)),0),2) 
into STRICT	qt_resultado_w 
from (SELECT	distinct 
		nr_seq_proj, 
		substr(obter_ds_proj_projeto(NR_SEQ_PROJ),1,255) ds_titulo, 
		substr(con_media_quesito_aval(cd_executor,nr_seq_proj,'V'),1,40) vl_media_proj 
	from	proj_rat_v 
	where	substr(con_media_quesito_aval(cd_executor,nr_seq_proj,'V'),1,40) <> 0 
	and	cd_executor = cd_consultor_p) alias12;
 
if (qt_resultado_w <= 0) then 
qt_retorno_w := '0';
end if;
if (qt_resultado_w > 0.00) and (qt_resultado_w <= 1.40) then 
qt_retorno_w := qt_resultado_w||' - Péssimo';
end if;
if (qt_resultado_w > 1.40) and (qt_resultado_w <= 2.40) then 
qt_retorno_w := qt_resultado_w||' - Ruim';
end if;
if (qt_resultado_w > 2.40) and (qt_resultado_w <= 3.40) then 
qt_retorno_w := qt_resultado_w||' - Regular';
end if;
if (qt_resultado_w > 3.40) and (qt_resultado_w <= 4.40) then 
qt_retorno_w := qt_resultado_w||' - Bom';
end if;
if (qt_resultado_w > 4.40) then 
qt_retorno_w := qt_resultado_w||' - Ótimo';
end if;
 
return	qt_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION con_media_geral_quesito_aval ( cd_consultor_p text) FROM PUBLIC;

