-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_medico_indicado (nm_usuario_p text) RETURNS varchar AS $body$
DECLARE

 
cd_medico_w	varchar(10);
			

BEGIN 
 
select	cd_medico 
into STRICT	cd_medico_w 
from	(SELECT	substr(obter_nome_pf(a.cd_medico),1,150) nm_medico, 
		a.cd_medico, 
		(select	count(*) 
		from  	atendimento_paciente x 
		where 	to_char(x.dt_entrada,'dd/mm/yyyy') = to_char(clock_timestamp(),'dd/mm/yyyy') 
		and  	x.cd_medico_resp = a.cd_medico) qt_atendimento 
from 	medico_plantao a 
where	(a.dt_inicial IS NOT NULL AND a.dt_inicial::text <> '') 
and	coalesce(a.dt_final::text, '') = '' 
order by qt_atendimento,nm_medico) alias9 LIMIT 1;
 
return	cd_medico_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_medico_indicado (nm_usuario_p text) FROM PUBLIC;

