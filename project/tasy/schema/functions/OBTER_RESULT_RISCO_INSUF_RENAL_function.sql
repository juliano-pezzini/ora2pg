-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_result_risco_insuf_renal (nr_sequencia_p bigint) RETURNS varchar AS $body$
DECLARE


ie_creatinina_w				varchar(1);
ie_clearance_w				varchar(1);
qt_risco_leve_moderado_w	bigint;
ds_retorno_w		        varchar(4000);
sql_w                       varchar(200);

BEGIN
if (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '') then
	select	coalesce(ie_creatinina,'N'),
			coalesce(ie_clearance,'N'),
			(CASE WHEN coalesce(ie_clearance_maior,'N')='S' THEN 1  ELSE 0 END  +
			CASE WHEN coalesce(ie_icc,'N')='S' THEN 1  ELSE 0 END  +
			CASE WHEN coalesce(ie_dm,'N')='S' THEN 1  ELSE 0 END  +
			CASE WHEN coalesce(ie_ictericia,'N')='S' THEN 1  ELSE 0 END  +
			CASE WHEN coalesce(ie_desidratacao,'N')='S' THEN 1  ELSE 0 END  +
			CASE WHEN coalesce(ie_rel_ureia_creat,'N')='S' THEN 1  ELSE 0 END )
	into STRICT	ie_creatinina_w,
			ie_clearance_w,
			qt_risco_leve_moderado_w
	from	escala_risco_insuf_renal
	where	nr_sequencia = nr_sequencia_p;
--INICIO MD 1
    BEGIN
        sql_w := 'CALL OBTER_DS_EXP_RIS_INS_RENAL_MD(:1, :2, :3, :4, :5, :6) INTO :ds_retorno_w';
        EXECUTE sql_w
            USING IN ie_creatinina_w ,IN ie_clearance_w, IN qt_risco_leve_moderado_w,
                  IN obter_desc_expressao(283400), IN obter_desc_expressao(347040),
                  IN obter_desc_expressao(347844), OUT ds_retorno_w;

    EXCEPTION
        WHEN OTHERS THEN
            ds_retorno_w := NULL;
    END;

    RETURN ds_retorno_w;

else
	return	'';
    --FIM MD 1
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_result_risco_insuf_renal (nr_sequencia_p bigint) FROM PUBLIC;

