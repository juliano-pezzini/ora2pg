-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION man_obter_tempo_sla_formatado (qt_minutos_p bigint) RETURNS varchar AS $body$
DECLARE


qt_min_positivo_w	bigint;
qt_horas_w		bigint;
qt_min_w		bigint;
qt_dias_w		bigint;
ds_minutos 		varchar(2000);


BEGIN
ds_minutos := '';
if (qt_minutos_p IS NOT NULL AND qt_minutos_p::text <> '') then

    if qt_minutos_p >= 0 then
        qt_min_positivo_w := qt_minutos_p;
    else
        qt_min_positivo_w := qt_minutos_p *-1;
    end if;

    if qt_min_positivo_w > 59 then
        qt_dias_w		:= TRUNC(qt_min_positivo_w/1440);
        qt_horas_w		:= TRUNC(((qt_min_positivo_w / 1440)-qt_dias_w)*24);
        qt_min_w		:= TRUNC(((((qt_min_positivo_w / 1440)-qt_dias_w)*24)-qt_horas_w)*60);
    else
        qt_dias_w		:= 0;
        qt_horas_w		:= 0;
        qt_min_w		:= qt_min_positivo_w;
    end if;

	if (qt_dias_w > 0) then
        if qt_minutos_p >= 0 then
            ds_minutos := to_char(qt_dias_w)|| 'D ';
        else
            ds_minutos := to_char(qt_dias_w*-1)|| 'D ';
        end if;
	end if;

	if (qt_horas_w > 0)  then
        if (qt_minutos_p >= 0) or (qt_minutos_p < 0 and (qt_dias_w > 0)) then
    		ds_minutos := ds_minutos || to_char(qt_horas_w)|| 'H ';
        else
    		ds_minutos := ds_minutos || to_char(qt_horas_w*-1)|| 'H ';
        end if;
	end if;

    if qt_min_w > 0 then
        if (qt_minutos_p >= 0) or (qt_minutos_p < 0 and (qt_horas_w > 0)) then
            ds_minutos := ds_minutos || to_char(TRUNC(qt_min_w)) ||'m';
        else
            ds_minutos := ds_minutos || to_char(TRUNC(qt_min_w)*-1)||'m';
        end if;
    end if;
end if;
return ds_minutos;


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION man_obter_tempo_sla_formatado (qt_minutos_p bigint) FROM PUBLIC;

