-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION gqa_obter_protocolo_prox_etapa (nr_sequencia_p bigint) RETURNS bigint AS $body$
DECLARE


  return_w              gqa_protocolo_etapa_pac.nr_sequencia%type := null;


BEGIN
  begin
    select ww.nr_sequencia
    into STRICT return_w
    from (
        SELECT
              a.nr_sequencia, 
              a.nr_seq_prot_pac,
              a.nr_seq_etapa,
              a.dt_fim,
              obter_dependencia_etapa((SELECT nr_seq_protocolo from gqa_protocolo_pac where nr_sequencia = nr_sequencia_p), a.nr_seq_etapa, 'O') hierarquia
        from gqa_protocolo_etapa_pac a
        where a.nr_seq_prot_pac = nr_sequencia_p
          and coalesce(gqa_obter_se_inicia_etapa(a.nr_sequencia), 'N') = 'S'
          and coalesce(a.dt_fim::text, '') = ''
        order by hierarquia asc
    ) ww LIMIT 1;
  exception
    when others then
      null;
  end;

  return return_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION gqa_obter_protocolo_prox_etapa (nr_sequencia_p bigint) FROM PUBLIC;

