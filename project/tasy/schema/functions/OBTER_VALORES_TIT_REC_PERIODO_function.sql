-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_valores_tit_rec_periodo (nr_titulo_p bigint, nm_atributo_p text, dt_inicial_p timestamp, dt_final_p timestamp) RETURNS bigint AS $body$
DECLARE

 
vl_retorno_w		double precision;


BEGIN 
 
if (upper(nm_atributo_p) = 'VL_GLOSA') then 
	select	sum(vl_glosa) 
	into STRICT	vl_retorno_w 
	from	titulo_receber_liq 
	where	nr_titulo			= nr_titulo_p 
	and	coalesce(ie_lib_caixa, 'S') = 'S' 
	and	trunc(dt_recebimento,'dd')	between trunc(coalesce(dt_inicial_p, to_date('01/01/1900','dd/mm/yyyy')),'dd') 
						and	 trunc(coalesce(dt_final_p, to_date('01/01/2900','dd/mm/yyyy')), 'dd');
end if;
 
if (upper(nm_atributo_p) = 'VL_RECEBIDO') then 
	select	sum(vl_recebido) 
	into STRICT	vl_retorno_w 
	from 	titulo_receber_liq 
	where	nr_titulo	= nr_titulo_p 
	and	coalesce(ie_lib_caixa, 'S') = 'S' 
	and	trunc(dt_recebimento,'dd')	between trunc(coalesce(dt_inicial_p, to_date('01/01/1900','dd/mm/yyyy')),'dd') 
						and	 trunc(coalesce(dt_final_p, to_date('01/01/2900','dd/mm/yyyy')), 'dd');
end if;
 
if (upper(nm_atributo_p) = 'VL_DESCONTOS') then 
	select	sum(vl_descontos) 
	into STRICT	vl_retorno_w 
	from 	titulo_receber_liq 
	where	nr_titulo	= nr_titulo_p 
	and	coalesce(ie_lib_caixa, 'S') = 'S' 
	and	trunc(dt_recebimento,'dd')	between trunc(coalesce(dt_inicial_p, to_date('01/01/1900','dd/mm/yyyy')),'dd') 
						and	 trunc(coalesce(dt_final_p, to_date('01/01/2900','dd/mm/yyyy')), 'dd');
end if;
 
if (upper(nm_atributo_p) = 'VL_JUROS') then 
	select	sum(vl_juros) 
	into STRICT	vl_retorno_w 
	from 	titulo_receber_liq 
	where	nr_titulo	= nr_titulo_p 
	and	coalesce(ie_lib_caixa, 'S') = 'S' 
	and	trunc(dt_recebimento,'dd')	between trunc(coalesce(dt_inicial_p, to_date('01/01/1900','dd/mm/yyyy')),'dd') 
						and	 trunc(coalesce(dt_final_p, to_date('01/01/2900','dd/mm/yyyy')), 'dd');
end if;
 
if (upper(nm_atributo_p) = 'VL_MULTA') then 
	select	sum(vl_multa) 
	into STRICT	vl_retorno_w 
	from 	titulo_receber_liq 
	where	nr_titulo	= nr_titulo_p 
	and	coalesce(ie_lib_caixa, 'S') = 'S' 
	and	trunc(dt_recebimento,'dd')	between trunc(coalesce(dt_inicial_p, to_date('01/01/1900','dd/mm/yyyy')),'dd') 
						and	 trunc(coalesce(dt_final_p, to_date('01/01/2900','dd/mm/yyyy')), 'dd');
end if;
 
if (upper(nm_atributo_p) = 'VL_REC_MAIOR') then 
	select	sum(vl_rec_maior) 
	into STRICT	vl_retorno_w 
	from 	titulo_receber_liq 
	where	nr_titulo	= nr_titulo_p 
	and	coalesce(ie_lib_caixa, 'S') = 'S' 
	and	trunc(dt_recebimento,'dd')	between trunc(coalesce(dt_inicial_p, to_date('01/01/1900','dd/mm/yyyy')),'dd') 
						and	 trunc(coalesce(dt_final_p, to_date('01/01/2900','dd/mm/yyyy')), 'dd');
end if;
 
if (upper(nm_atributo_p) = 'VL_CANCELADO') then 
	select	sum(vl_recebido) 
	into STRICT	vl_retorno_w 
	from 	titulo_receber_liq 
	where	nr_titulo	= nr_titulo_p 
	and	coalesce(ie_lib_caixa, 'S') = 'S' 
	and	trunc(dt_recebimento,'dd')	between trunc(coalesce(dt_inicial_p, to_date('01/01/1900','dd/mm/yyyy')),'dd') 
						and	 trunc(coalesce(dt_final_p, to_date('01/01/2900','dd/mm/yyyy')), 'dd') 
	and	cd_tipo_recebimento in (SELECT	cd_tipo_recebimento 
			from	tipo_recebimento 
			where	ie_tipo_consistencia = 4);
end if;
 
if (upper(nm_atributo_p) = 'VL_DESDOBRADO') then 
	select	coalesce(sum(vl_titulo), 0) 
	into STRICT	vl_retorno_w 
	from	titulo_receber_desdob 
	where	nr_titulo	= nr_titulo_p 
	and	trunc(dt_atualizacao,'dd')	between trunc(coalesce(dt_inicial_p, to_date('01/01/1900','dd/mm/yyyy')),'dd') 
						and	 trunc(coalesce(dt_final_p, to_date('01/01/2900','dd/mm/yyyy')), 'dd');
end if;
 
if (upper(nm_atributo_p) = 'VL_PERDAS') then 
	select	sum(vl_perdas) 
	into STRICT	vl_retorno_w 
	from 	titulo_receber_liq 
	where	nr_titulo	= nr_titulo_p 
	and	coalesce(ie_lib_caixa, 'S') = 'S' 
	and	trunc(dt_recebimento,'dd')	between trunc(coalesce(dt_inicial_p, to_date('01/01/1900','dd/mm/yyyy')),'dd') 
						and	 trunc(coalesce(dt_final_p, to_date('01/01/2900','dd/mm/yyyy')), 'dd');
end if;
 
return	coalesce(vl_retorno_w,0);
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_valores_tit_rec_periodo (nr_titulo_p bigint, nm_atributo_p text, dt_inicial_p timestamp, dt_final_p timestamp) FROM PUBLIC;

