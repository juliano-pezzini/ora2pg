-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION verificar_senha_existente (nm_usuario_p text, ds_senha_p text, qt_senha_p bigint) RETURNS varchar AS $body$
DECLARE


ie_retorno_w	varchar(1) := 'N';
qt_reg_w	bigint;

  linha RECORD;

BEGIN

qt_reg_w := 0;
for linha in (  SELECT  obter_sha2(ds_senha_p || ds_tec, 256) ds_hash_gerado_w,
			ds_senha
                FROM    USUARIO_HIST_SENHA
                WHERE   upper(nm_usuario) = upper(nm_usuario_p)
                ORDER BY dt_atualizacao DESC) loop

        if (qt_reg_w < qt_senha_p) then
                if (linha.ds_hash_gerado_w = linha.ds_senha) then
			ie_retorno_w := 'S';
		end     if;
	end     if;

	qt_reg_w        := qt_reg_w + 1;
end loop;

return ie_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION verificar_senha_existente (nm_usuario_p text, ds_senha_p text, qt_senha_p bigint) FROM PUBLIC;

