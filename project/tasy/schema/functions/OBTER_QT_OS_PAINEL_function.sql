-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_qt_os_painel ( nr_seq_gerencia_p bigint, nr_seq_grupo_des_p bigint, ie_informacao_p bigint) RETURNS bigint AS $body$
DECLARE

 
qt_retorno_w			bigint;
qt_total_os_w			bigint;
qt_tot_os_antiga_prev_w		bigint;
qt_tot_os_antiga_w		bigint;


BEGIN 
 
select	sum(qt_ordem) qt_ordem, 
	sum(qt_tot_os_antiga) qt_tot_os_antiga, 
	sum(qt_tot_prev_os_antiga) 
into STRICT	qt_total_os_w, 
	qt_tot_os_antiga_w, 
	qt_tot_os_antiga_prev_w 
from	( 
SELECT	0 ie_tipo, 
	b.ds_grupo ds_grupo_des, 
	a.nr_seq_grupo_des, 
	count(*) qt_ordem, 
	coalesce(sum(CASE WHEN obter_se_ordem_vinc_projeto2(a.nr_sequencia)='S' THEN 0  ELSE CASE WHEN obter_se_data_periodo(trunc(a.dt_ordem_servico, 'dd'), to_date('01/01/2007','dd/mm/yyyy'), trunc(clock_timestamp() - interval '15 days','dd'))='S' THEN  1  ELSE 0 END  END ),0) qt_tot_os_antiga, 
	coalesce(sum(CASE WHEN obter_se_os_antiga(a.nr_sequencia)=1 THEN CASE WHEN man_obter_data_prevista_os(a.nr_sequencia)=trunc(clock_timestamp()) THEN 1  ELSE 0 END  END ),0) qt_tot_prev_os_antiga 
from	man_ordem_servico a, 
	grupo_desenvolvimento b, 
	gerencia_wheb c 
where	c.nr_sequencia	= b.nr_seq_gerencia 
and	b.nr_sequencia	= a.nr_seq_grupo_des 
/*and	(substr(obter_se_os_pend_cliente(a.nr_sequencia),1,1) = 'N')*/
 
and (substr(Obter_Se_OS_Desenv(a.nr_sequencia),1,1) = 'S') 
and	a.ie_status_ordem	<> 3 
and	c.nr_sequencia		<> 5 
and	c.nr_sequencia = nr_seq_gerencia_p 
and	((a.nr_seq_grupo_des = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0)) 
and (coalesce(proj_obter_dados_ordem_serv(a.nr_sequencia, 'PROJD')::text, '') = '') 
group by b.ds_grupo, a.nr_seq_grupo_des) alias27 
where	1 = 1;
 
if (ie_informacao_p = 1) then 
	qt_retorno_w	:= coalesce(qt_total_os_w,0);
elsif (ie_informacao_p = 2) then 
	qt_retorno_w	:= coalesce(qt_tot_os_antiga_w,0);
elsif (ie_informacao_p = 3) then 
	qt_retorno_w	:= coalesce(qt_tot_os_antiga_prev_w,0);
end if;
 
return	qt_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_qt_os_painel ( nr_seq_gerencia_p bigint, nr_seq_grupo_des_p bigint, ie_informacao_p bigint) FROM PUBLIC;

