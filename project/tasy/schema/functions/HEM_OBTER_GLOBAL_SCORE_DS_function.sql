-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION hem_obter_global_score_ds (cd_syntax_score_p bigint, qt_score_euro_p bigint, nr_atendimento_p bigint default 0) RETURNS varchar AS $body$
DECLARE


ds_return_w		varchar(20);
cd_pessoa_fisica_w	varchar(15);
nr_seq_syntax_w		bigint;
cd_syntax_score_w	double precision;
qt_score_euro_w		double precision;
sql_w             varchar(250);

BEGIN
  if ((cd_syntax_score_p IS NOT NULL AND cd_syntax_score_p::text <> '' AND qt_score_euro_p IS NOT NULL AND qt_score_euro_p::text <> '') or (coalesce(nr_atendimento_p,0) > 0)) then
    begin
      cd_syntax_score_w	:= coalesce(cd_syntax_score_p,0);
      qt_score_euro_w		:= coalesce(qt_score_euro_p,0);

      if (coalesce(nr_atendimento_p,0) > 0) then

        select	max(cd_pessoa_fisica)
        into STRICT	cd_pessoa_fisica_w
        from	atendimento_paciente
        where	nr_atendimento = nr_atendimento_p;

        select	max(nr_sequencia)
        into STRICT	nr_seq_syntax_w
        from	hem_syntax
        where	cd_pessoa_fisica = cd_pessoa_fisica_w;

        select	max(cd_syntax_score)
        into STRICT	cd_syntax_score_w
        from	hem_syntax
        where	nr_sequencia = nr_seq_syntax_w;

        select	max(qt_score)
        into STRICT	qt_score_euro_w
        from	euroscore
        where	nr_atendimento = nr_atendimento_p;

      end if;

      begin
        sql_w := 'CALL obter_global_score_ds_md(:1, :2) INTO :ds_return_w';
        EXECUTE sql_w USING IN cd_syntax_score_p,
                                      IN qt_score_euro_p,
                                      OUT ds_return_w;
      exception
        when others then
          ds_return_w := null;
        end;
    end;
  end if;
return	ds_return_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION hem_obter_global_score_ds (cd_syntax_score_p bigint, qt_score_euro_p bigint, nr_atendimento_p bigint default 0) FROM PUBLIC;

