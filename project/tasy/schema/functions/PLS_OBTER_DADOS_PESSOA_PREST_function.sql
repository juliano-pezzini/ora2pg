-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_dados_pessoa_prest ( cd_pessoa_fisica_p text, cd_cgc_p text, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


/*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: Verificar se a pessoa fisica/juridica é prestador
----------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [X] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ---------------------------------------------------------------------------------------------------
Pontos de atenção: Foi adicionado o IE_OPCAO_P, caso seja necessária outras finalidades

ROTINA UTILIZADA NA FUNÇÃO OPS - PRESTADORES
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/ds_retorno_w            varchar(255) := null;
qt_registro_w           bigint := 0;
cd_cgc_w		varchar(255);
cd_pessoa_fisica_w	varchar(255);


BEGIN
if (upper(ie_opcao_p) = upper('VR')) then
        if (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') then
		select	length(cd_pessoa_fisica_p)
		into STRICT	qt_registro_w
		;

		if (qt_registro_w <= 10) then
			cd_pessoa_fisica_w := somente_numero_char(cd_pessoa_fisica_p);
		else
			cd_pessoa_fisica_w := somente_numero_char(cd_pessoa_fisica_p);
			cd_pessoa_fisica_w := substr(cd_pessoa_fisica_w,1,length(cd_pessoa_fisica_w) - 1);
		end if;

		qt_registro_w := 0;

                select  count(1)
                into STRICT    qt_registro_w
                from    pls_prestador
                where   cd_pessoa_fisica = cd_pessoa_fisica_w  LIMIT 1;
        end if;

        if (qt_registro_w = 0) and (cd_cgc_p IS NOT NULL AND cd_cgc_p::text <> '') then
		cd_cgc_w := somente_numero_char(cd_cgc_p);

                select  count(1)
                into STRICT    qt_registro_w
                from    pls_prestador
                where   cd_cgc = cd_cgc_w  LIMIT 1;
        end if;

        if (qt_registro_w > 0) then
                ds_retorno_w := 'S';
        else
                ds_retorno_w := 'N';
        end if;
end if;

return  ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_dados_pessoa_prest ( cd_pessoa_fisica_p text, cd_cgc_p text, ie_opcao_p text) FROM PUBLIC;

