-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_glosa_ativa_evento ( cd_motivo_glosa_p motivo_glosa.cd_motivo_glosa%type, ie_evento_p pls_glosa_evento.ie_evento%type) RETURNS varchar AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
Verifica se a glosa está ativa para o evento informado

ie_evento_p ->  domínio 1977
IA              Importação do arquivo conta
IG              Importação do arquivo guia
CC              Consistir Conta
CG              Consistir Guia
CR              Consistir Reembolso
I5              Importação do arquivo PTU A500
RG              Importação Recurso de Glosa
DC              Digitação de conta pelo portal
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [ ] Tasy (Delphi/Java) [   ] Portal [  ]  Relatórios [ x] Outros: WebService
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
ds_retorno_w		varchar(1)	:= 'N';
cd_estabelecimento_w	estabelecimento.cd_estabelecimento%type;
ie_ocorrencia_w		pls_controle_estab.ie_ocorrencia%type := 'N';


BEGIN
cd_estabelecimento_w := wheb_usuario_pck.get_cd_estabelecimento;
ie_ocorrencia_w := pls_obter_se_controle_estab('GO');

if (ie_ocorrencia_w = 'S') and (cd_estabelecimento_w IS NOT NULL AND cd_estabelecimento_w::text <> '') then
	select 	max(coalesce(a.ie_plano, 'N'))
	into STRICT	ds_retorno_w
	from	pls_glosa_evento a,
		tiss_motivo_glosa b
	where	a.nr_seq_motivo_glosa	= b.nr_sequencia
	and	b.cd_motivo_tiss	= cd_motivo_glosa_p
	and	a.ie_evento		= ie_evento_p
	and	a.cd_estabelecimento	= cd_estabelecimento_w;
else
	select 	max(coalesce(a.ie_plano, 'N'))
	into STRICT	ds_retorno_w
	from	pls_glosa_evento a,
		tiss_motivo_glosa b
	where	a.nr_seq_motivo_glosa	= b.nr_sequencia
	and	b.cd_motivo_tiss	= cd_motivo_glosa_p
	and	a.ie_evento		= ie_evento_p;
end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_glosa_ativa_evento ( cd_motivo_glosa_p motivo_glosa.cd_motivo_glosa%type, ie_evento_p pls_glosa_evento.ie_evento%type) FROM PUBLIC;

