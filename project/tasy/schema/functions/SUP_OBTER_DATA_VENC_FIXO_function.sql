-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION sup_obter_data_venc_fixo ( qt_dia_limite_p bigint, dt_venc_original_p timestamp) RETURNS timestamp AS $body$
DECLARE


ds_mes_vencimento_w	varchar(7);
qt_ultimo_dia_w		smallint;
dt_vencimento_w		timestamp;


BEGIN

dt_vencimento_w	:= PKG_DATE_UTILS.start_of(dt_venc_original_p, 'dd', 0);

if (coalesce(qt_dia_limite_p,0) > 0) then
	begin

	if ((substr(to_char(dt_vencimento_w),1,2))::numeric  <= qt_dia_limite_p) then
		ds_mes_vencimento_w	:= to_char(dt_vencimento_w,'mm/yyyy');
	elsif ((substr(to_char(dt_vencimento_w),1,2))::numeric  > qt_dia_limite_p) then
		ds_mes_vencimento_w	:= to_char(PKG_DATE_UTILS.ADD_MONTH(dt_vencimento_w,1,0),'mm/yyyy');
	end if;

	qt_ultimo_dia_w	:= (substr(PKG_DATE_UTILS.END_OF(to_date(ds_mes_vencimento_w,'mm/yyyy'), 'MONTH', 0),1,2))::numeric;

	if (qt_ultimo_dia_w < qt_dia_limite_p) then
		dt_vencimento_w	:= to_date((to_char(qt_ultimo_dia_w) || '/' || ds_mes_vencimento_w),'dd/mm/yyyy');
	else
		dt_vencimento_w	:= to_date((to_char(qt_dia_limite_p) || '/' || ds_mes_vencimento_w),'dd/mm/yyyy');
	end if;

	end;
end if;

return	dt_vencimento_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION sup_obter_data_venc_fixo ( qt_dia_limite_p bigint, dt_venc_original_p timestamp) FROM PUBLIC;

