-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION sismama_obter_desc_ind_clin ( nr_seq_sismama_p bigint, ie_lado_p text) RETURNS varchar AS $body$
DECLARE


ds_retorno_w	varchar(2000) := '';
ds_mam_diag_w	varchar(255) := 'X';
ds_lesao_dir_w	varchar(255);
ds_desc_dir_w	varchar(255);
ds_nod_dir_w	varchar(255);
ds_esp_dir_w	varchar(255);
ds_lesao_esq_w	varchar(255);
ds_desc_esq_w	varchar(255);
ds_nod_esq_w	varchar(255);
ds_esp_esq_w	varchar(255);
ds_con_dir_w	varchar(255);
ds_con_esq_w	varchar(255);
ds_les_dir_w	varchar(255);
ds_les_esq_w	varchar(255);




BEGIN

begin
--select	substr(decode(b.ie_mamografia_diag,'N',decode(b.ie_mam_rastreamento,'S','Mamografia rastreamento'),'Mamografia Diagnóstica'),1,255)
select	substr(CASE WHEN b.ie_mamografia_diag='N' THEN CASE WHEN b.ie_mam_rastreamento='S' THEN wheb_mensagem_pck.get_texto(312137) END   ELSE wheb_mensagem_pck.get_texto(312138) END ,1,255)
into STRICT	ds_mam_diag_w
from	sismama_atendimento a,
	sismama_mam_ind_clinica b
where	a.nr_sequencia	= nr_seq_sismama_p
and	a.nr_sequencia	= b.nr_seq_sismama;
exception
when others then
	ds_mam_diag_w := 'X';
end;

if (ie_lado_p = 'D') and (ds_mam_diag_w <> 'X') then
	begin

	begin
	--select	substr(decode(b.ie_achado_exame_clin,'S',decode(b.ie_lesao_pap_dir,'S','Lesão palpável')),1,255)
	select	substr(CASE WHEN b.ie_achado_exame_clin='S' THEN CASE WHEN b.ie_lesao_pap_dir='S' THEN wheb_mensagem_pck.get_texto(312139) END  END ,1,255)
	into STRICT	ds_lesao_dir_w
	from	sismama_atendimento a,
		sismama_mam_ind_clinica b
	where	a.nr_sequencia	= nr_seq_sismama_p
	and	a.nr_sequencia	= b.nr_seq_sismama
	and (b.ie_mam_rastreamento <> 'S')
	and (b.ie_mamografia_diag = 'A' or b.ie_mamografia_diag = ie_lado_p);
	exception
	when others then
		ds_lesao_dir_w := 'X';
	end;

	begin
	--select	substr(decode(b.ie_descarga_pap_dir,'C','Descarga papilar espontânea, cristalina. ','H','Descarga papilar espontânea, hemorrágica. '),1,255)
	select	substr(CASE WHEN b.ie_descarga_pap_dir='C' THEN wheb_mensagem_pck.get_texto(312140) WHEN b.ie_descarga_pap_dir='H' THEN wheb_mensagem_pck.get_texto(312141) END ,1,255)
	into STRICT	ds_desc_dir_w
	from	sismama_atendimento a,
		sismama_mam_ind_clinica b
	where	a.nr_sequencia	= nr_seq_sismama_p
	and	a.nr_sequencia	= b.nr_seq_sismama
	and (b.ie_mam_rastreamento <> 'S')
	and (b.ie_mamografia_diag = 'A' or b.ie_mamografia_diag = ie_lado_p);
	exception
	when others then
		ds_desc_dir_w := 'X';
	end;

	begin
	select	substr(CASE WHEN a.ie_nod_qsl_dir='S' THEN 'QSL' WHEN a.ie_nod_qsl_dir=CASE WHEN a.ie_nod_qil_dir='S' THEN 'QIL' WHEN a.ie_nod_qil_dir=CASE WHEN a.ie_nod_qsm_dir='S' THEN 'QSM' WHEN a.ie_nod_qsm_dir=CASE WHEN a.ie_nod_qim_dir='S' THEN 'QIM' WHEN a.ie_nod_qim_dir=CASE WHEN a.ie_nod_uqlat_dir='S' THEN 'UQLat' WHEN a.ie_nod_uqlat_dir=CASE WHEN a.ie_nod_uqsup_dir='S' THEN 'UQSup' WHEN a.ie_nod_uqsup_dir=CASE WHEN a.ie_nod_uqmed_dir='S' THEN 'UQMed' WHEN a.ie_nod_uqmed_dir=CASE WHEN a.ie_nod_uqinf_dir='S' THEN 'UQInf' WHEN a.ie_nod_uqinf_dir=CASE WHEN a.ie_nod_rra_dir='S' THEN 'RRA' WHEN a.ie_nod_rra_dir=CASE WHEN a.ie_nod_pa_dir='S' THEN 'PA'  ELSE '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END ,1,255)
	into STRICT	ds_nod_dir_w
	from	sismama_mam_ind_clinica a
	where	a.nr_seq_sismama = nr_seq_sismama_p
	and (a.ie_mam_rastreamento <> 'S')
	and (a.ie_mamografia_diag = 'A' or a.ie_mamografia_diag = ie_lado_p);
	exception
	when others then
		ds_nod_dir_w := 'X';
	end;

	begin
	select	substr(CASE WHEN a.ie_esp_qsl_dir='S' THEN 'QSL' WHEN a.ie_esp_qsl_dir=CASE WHEN a.ie_esp_qil_dir='S' THEN 'QIL' WHEN a.ie_esp_qil_dir=CASE WHEN a.ie_esp_qsm_dir='S' THEN 'QSM' WHEN a.ie_esp_qsm_dir=CASE WHEN a.ie_esp_qim_dir='S' THEN 'QIM' WHEN a.ie_esp_qim_dir=CASE WHEN a.ie_esp_uqlat_dir='S' THEN 'UQLat' WHEN a.ie_esp_uqlat_dir=CASE WHEN a.ie_esp_uqsup_dir='S' THEN 'UQSup' WHEN a.ie_esp_uqsup_dir=CASE WHEN a.ie_esp_uqmed_dir='S' THEN 'UQMed' WHEN a.ie_esp_uqmed_dir=CASE WHEN a.ie_esp_uqinf_dir='S' THEN 'UQInf' WHEN a.ie_esp_uqinf_dir=CASE WHEN a.ie_esp_rra_dir='S' THEN 'RRA' WHEN a.ie_esp_rra_dir=CASE WHEN a.ie_esp_pa_dir='S' THEN 'PA'  ELSE '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END ,1,255)
	into STRICT	ds_esp_dir_w
	from	sismama_mam_ind_clinica a
	where	a.nr_seq_sismama = nr_seq_sismama_p
	and (a.ie_mam_rastreamento <> 'S')
	and (a.ie_mamografia_diag = 'A' or a.ie_mamografia_diag = ie_lado_p);
	exception
	when others then
		ds_esp_dir_w := 'X';
	end;

	begin
	/*select	decode(ie_diag_nodulo_dir,'S',', nódulo','')||
		decode(ie_diag_microcalcif_dir,'S',', microcalcificação','')||
		decode(ie_diag_assim_focal_dir,'S',', assimetria focal','')||
		decode(ie_diag_assim_difusa_dir,'S',', assimetria difusa','')||
		decode(ie_diag_area_densa_dir,'S',', área densa','')||
		decode(ie_diag_distorcao_focal_dir,'S',', distorção focal','')*/
	select	CASE WHEN ie_diag_nodulo_dir='S' THEN ', ' || wheb_mensagem_pck.get_texto(312142)  ELSE '' END ||
		CASE WHEN ie_diag_microcalcif_dir='S' THEN ', ' || wheb_mensagem_pck.get_texto(312143)  ELSE '' END ||
		CASE WHEN ie_diag_assim_focal_dir='S' THEN ', ' || wheb_mensagem_pck.get_texto(312144)  ELSE '' END ||
		CASE WHEN ie_diag_assim_difusa_dir='S' THEN ', ' || wheb_mensagem_pck.get_texto(312146)  ELSE '' END ||
		CASE WHEN ie_diag_area_densa_dir='S' THEN ', ' || wheb_mensagem_pck.get_texto(312147)  ELSE '' END ||
		CASE WHEN ie_diag_distorcao_focal_dir='S' THEN ', ' || wheb_mensagem_pck.get_texto(312148)  ELSE '' END
	into STRICT	ds_les_dir_w
	from	sismama_mam_ind_clinica
	where	ie_lesao_diag_cancer = 'S'
	and	nr_seq_sismama = nr_seq_sismama_p;
	exception
	when others then
		ds_les_dir_w := 'X';
	end;

	begin
	--select	' Controle radiológico  '||
	select	wheb_mensagem_pck.get_texto(312145) ||
		CASE WHEN ie_rad_nodulo_dir='S' THEN ', ' || wheb_mensagem_pck.get_texto(312142)  ELSE '' END ||
		CASE WHEN ie_rad_microcalcif_dir='S' THEN ', ' || wheb_mensagem_pck.get_texto(312143)  ELSE '' END ||
		CASE WHEN ie_rad_assim_focal_dir='S' THEN ', ' || wheb_mensagem_pck.get_texto(312144)  ELSE '' END ||
		CASE WHEN ie_rad_assim_difusa_dir='S' THEN ', ' || wheb_mensagem_pck.get_texto(312146)  ELSE '' END ||
		CASE WHEN ie_rad_area_densa_dir=', ' || wheb_mensagem_pck.get_texto(312147) THEN '' END ||
		CASE WHEN ie_rad_distorcao_focal_dir='S' THEN ', ' || wheb_mensagem_pck.get_texto(312148)  ELSE '' END
	into STRICT	ds_con_dir_w
	from	sismama_mam_ind_clinica
	where	ie_controle_rad = 'S'
	and	nr_seq_sismama = nr_seq_sismama_p;
	exception
	when others then
		ds_con_dir_w := 'X';
	end;

	ds_retorno_w := substr(ds_mam_diag_w,1,2000);

	if (ds_lesao_dir_w <> 'X') then
		ds_retorno_w := substr(ds_retorno_w ||' - '|| ds_lesao_dir_w,1,2000);
	end if;
	if (ds_desc_dir_w <> 'X') then
		ds_retorno_w := substr(ds_retorno_w ||' - '|| ds_desc_dir_w,1,2000);
	end if;
	if (ds_nod_dir_w <> 'X') then
		--ds_retorno_w := substr(ds_retorno_w ||' - nódulo '|| ds_nod_dir_w,1,2000);
		ds_retorno_w := substr(ds_retorno_w ||' - ' || wheb_mensagem_pck.get_texto(312142) || ' '|| ds_nod_dir_w,1,2000);
	end if;
	if (ds_esp_dir_w <> 'X') then
		--ds_retorno_w := substr(ds_retorno_w ||' - espessamento '|| ds_esp_dir_w,1,2000);
		ds_retorno_w := substr(ds_retorno_w ||' - ' || wheb_mensagem_pck.get_texto(312149) || ' '|| ds_esp_dir_w,1,2000);
	end if;
	if (ds_con_dir_w <> 'X') then
		ds_retorno_w := substr(ds_retorno_w || ds_con_dir_w,1,2000);
	end if;
	if (ds_les_dir_w <> 'X') then
		ds_retorno_w := substr(ds_retorno_w || ds_les_dir_w,1,2000);
	end if;

	--ds_retorno_w := substr(ds_retorno_w ||' - '||' Mama direita',1,2000);
	ds_retorno_w := substr(ds_retorno_w ||' - '|| wheb_mensagem_pck.get_texto(312150),1,2000);

	end;
elsif (ie_lado_p = 'E') and (ds_mam_diag_w <> 'X') then
	begin

	begin
	--select	substr(decode(b.ie_achado_exame_clin,'S',decode(b.ie_lesao_pap_esq,'S','Lesão palpável')),1,255)
	select	substr(CASE WHEN b.ie_achado_exame_clin='S' THEN CASE WHEN b.ie_lesao_pap_esq='S' THEN wheb_mensagem_pck.get_texto(312139) END  END ,1,255)
	into STRICT	ds_lesao_esq_w
	from	sismama_atendimento a,
		sismama_mam_ind_clinica b
	where	a.nr_sequencia	= nr_seq_sismama_p
	and	a.nr_sequencia	= b.nr_seq_sismama
	and (b.ie_mam_rastreamento <> 'S')
	and (b.ie_mamografia_diag = 'A' or b.ie_mamografia_diag = 'E');
	exception
	when others then
		ds_lesao_esq_w := 'X';
	end;

	begin
	--select	substr(decode(b.ie_descarga_pap_esq,'C','Descarga papilar espontânea, cristalina. ','H','Descarga papilar espontânea, hemorrágica. '),1,255)
	select	substr(CASE WHEN b.ie_descarga_pap_esq='C' THEN wheb_mensagem_pck.get_texto(312140) WHEN b.ie_descarga_pap_esq='H' THEN wheb_mensagem_pck.get_texto(312141) END ,1,255)
	into STRICT	ds_desc_esq_w
	from	sismama_atendimento a,
		sismama_mam_ind_clinica b
	where	a.nr_sequencia	= nr_seq_sismama_p
	and	a.nr_sequencia	= b.nr_seq_sismama
	and (b.ie_mam_rastreamento <> 'S')
	and (b.ie_mamografia_diag = 'A' or b.ie_mamografia_diag = ie_lado_p);
	exception
	when others then
		ds_desc_esq_w := 'X';
	end;

	begin
	select	substr(CASE WHEN a.ie_nod_qsl_esq='S' THEN 'QSL' WHEN a.ie_nod_qsl_esq=CASE WHEN a.ie_nod_qil_esq='S' THEN 'QIL' WHEN a.ie_nod_qil_esq=CASE WHEN a.ie_nod_qsm_esq='S' THEN 'QSM' WHEN a.ie_nod_qsm_esq=CASE WHEN a.ie_nod_qim_esq='S' THEN 'QIM' WHEN a.ie_nod_qim_esq=CASE WHEN a.ie_nod_uqlat_esq='S' THEN 'UQLat' WHEN a.ie_nod_uqlat_esq=CASE WHEN a.ie_nod_uqsup_esq='S' THEN 'UQSup' WHEN a.ie_nod_uqsup_esq=CASE WHEN a.ie_nod_uqmed_esq='S' THEN 'UQMed' WHEN a.ie_nod_uqmed_esq=CASE WHEN a.ie_nod_uqinf_esq='S' THEN 'UQInf' WHEN a.ie_nod_uqinf_esq=CASE WHEN a.ie_nod_rra_esq='S' THEN 'RRA' WHEN a.ie_nod_rra_esq=CASE WHEN a.ie_nod_pa_esq='S' THEN 'PA'  ELSE '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END ,1,255)
	into STRICT	ds_nod_esq_w
	from	sismama_mam_ind_clinica a
	where	a.nr_seq_sismama = nr_seq_sismama_p
	and (a.ie_mam_rastreamento <> 'S')
	and (a.ie_mamografia_diag = 'A' or a.ie_mamografia_diag = ie_lado_p);
	exception
	when others then
		ds_nod_esq_w := 'X';
	end;

	begin
	select	substr(CASE WHEN a.ie_esp_qsl_esq='S' THEN 'QSL' WHEN a.ie_esp_qsl_esq=CASE WHEN a.ie_esp_qil_esq='S' THEN 'QIL' WHEN a.ie_esp_qil_esq=CASE WHEN a.ie_esp_qsm_esq='S' THEN 'QSM' WHEN a.ie_esp_qsm_esq=CASE WHEN a.ie_esp_qim_esq='S' THEN 'QIM' WHEN a.ie_esp_qim_esq=CASE WHEN a.ie_esp_uqlat_esq='S' THEN 'UQLat' WHEN a.ie_esp_uqlat_esq=CASE WHEN a.ie_esp_uqsup_esq='S' THEN 'UQSup' WHEN a.ie_esp_uqsup_esq=CASE WHEN a.ie_esp_uqmed_esq='S' THEN 'UQMed' WHEN a.ie_esp_uqmed_esq=CASE WHEN a.ie_esp_uqinf_esq='S' THEN 'UQInf' WHEN a.ie_esp_uqinf_esq=CASE WHEN a.ie_esp_rra_esq='S' THEN 'RRA' WHEN a.ie_esp_rra_esq=CASE WHEN a.ie_esp_pa_esq='S' THEN 'PA'  ELSE '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END  THEN '' END ,1,255)
	into STRICT	ds_esp_esq_w
	from	sismama_mam_ind_clinica a
	where	a.nr_seq_sismama = nr_seq_sismama_p
	and (a.ie_mam_rastreamento <> 'S')
	and (a.ie_mamografia_diag = 'A' or a.ie_mamografia_diag = ie_lado_p);
	exception
	when others then
		ds_esp_esq_w := 'X';
	end;

	begin
	/*select	decode(ie_diag_nodulo_esq,'S',', nódulo','')||
		decode(ie_diag_microcalcif_esq,'S',', microcalcificação','')||
		decode(ie_diag_assim_focal_esq,'S',', assimetria focal','')||
		decode(ie_diag_assim_difusa_esq,'S',', assimetria difusa','')||
		decode(ie_diag_area_densa_esq,'S',', área densa','')||
		decode(ie_diag_distorcao_focal_esq,'S',', distorção focal','')*/
	select	CASE WHEN ie_diag_nodulo_esq='S' THEN ', ' || wheb_mensagem_pck.get_texto(312142)  ELSE '' END ||
		CASE WHEN ie_diag_microcalcif_esq='S' THEN ', ' || wheb_mensagem_pck.get_texto(312143)  ELSE '' END ||
		CASE WHEN ie_diag_assim_focal_esq='S' THEN ', ' || wheb_mensagem_pck.get_texto(312144)  ELSE '' END ||
		CASE WHEN ie_diag_assim_difusa_esq='S' THEN ', ' || wheb_mensagem_pck.get_texto(312146)  ELSE '' END ||
		CASE WHEN ie_diag_area_densa_esq='S' THEN ', ' || wheb_mensagem_pck.get_texto(312147)  ELSE '' END ||
		CASE WHEN ie_diag_distorcao_focal_esq='S' THEN ', ' || wheb_mensagem_pck.get_texto(312148)  ELSE '' END
	into STRICT	ds_les_esq_w
	from	sismama_mam_ind_clinica
	where	ie_controle_rad = 'S'
	and	nr_seq_sismama = nr_seq_sismama_p;
	exception
	when others then
		ds_les_esq_w := 'X';
	end;

	begin
	--select	' Controle radiológico '||
	select	wheb_mensagem_pck.get_texto(312145) ||
		CASE WHEN ie_rad_nodulo_esq='S' THEN ', ' || wheb_mensagem_pck.get_texto(312142)  ELSE '' END ||
		CASE WHEN ie_rad_microcalcif_esq='S' THEN ', ' || wheb_mensagem_pck.get_texto(312143)  ELSE '' END ||
		CASE WHEN ie_rad_assim_focal_esq='S' THEN ', ' || wheb_mensagem_pck.get_texto(312144)  ELSE '' END ||
		CASE WHEN ie_rad_assim_difusa_esq='S' THEN ', ' || wheb_mensagem_pck.get_texto(312146)  ELSE '' END ||
		CASE WHEN ie_rad_area_densa_esq='S' THEN ', ' || wheb_mensagem_pck.get_texto(312147)  ELSE '' END ||
		CASE WHEN ie_rad_distorcao_focal_esq='S' THEN ', ' || wheb_mensagem_pck.get_texto(312148)  ELSE '' END
	into STRICT	ds_con_esq_w
	from	sismama_mam_ind_clinica
	where	ie_controle_rad = 'S'
	and	nr_seq_sismama = nr_seq_sismama_p;
	exception
	when others then
		ds_con_esq_w := 'X';
	end;

	ds_retorno_w := substr(ds_mam_diag_w,1,2000);

	if (ds_lesao_esq_w <> 'X') then
		ds_retorno_w := substr(ds_retorno_w ||' - '|| ds_lesao_esq_w,1,2000);
	end if;
	if (ds_desc_esq_w <> 'X') then
		ds_retorno_w := substr(ds_retorno_w ||' - '|| ds_desc_esq_w,1,2000);
	end if;
	if (ds_nod_esq_w <> 'X') then
		--ds_retorno_w := substr(ds_retorno_w ||' - nódulo '|| ds_nod_esq_w,1,2000);
		ds_retorno_w := substr(ds_retorno_w ||' - ' || wheb_mensagem_pck.get_texto(312142) || ' '|| ds_nod_esq_w,1,2000);
	end if;
	if (ds_esp_esq_w <> 'X') then
		--ds_retorno_w := substr(ds_retorno_w ||' - espessamento '|| ds_esp_esq_w,1,2000);
		ds_retorno_w := substr(ds_retorno_w ||' - ' || wheb_mensagem_pck.get_texto(312149) || ' '|| ds_esp_esq_w,1,2000);
	end if;
	if (ds_con_esq_w <> 'X') then
		ds_retorno_w := substr(ds_retorno_w || ds_con_esq_w,1,2000);
	end if;
	if (ds_les_esq_w <> 'X') then
		ds_retorno_w := substr(ds_retorno_w || ds_les_esq_w,1,2000);
	end if;

	--ds_retorno_w := substr(ds_retorno_w ||' - '||'Mama esquerda',1,2000);
	ds_retorno_w := substr(ds_retorno_w ||' - '|| wheb_mensagem_pck.get_texto(312151),1,2000);
	end;
end if;


return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION sismama_obter_desc_ind_clin ( nr_seq_sismama_p bigint, ie_lado_p text) FROM PUBLIC;

