-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION plt_obter_qtd_item_liberado ( ie_tipo_item_p text, cd_perfil_p bigint, nm_usuario_p text) RETURNS varchar AS $body$
DECLARE


qt_item_liberado_w	bigint;
retorna_w		varchar(20);
ie_apresenta_qtd_w	varchar(1);



BEGIN

ie_apresenta_qtd_w := Obter_Param_Usuario(950, 152, cd_perfil_p, nm_usuario_p, wheb_usuario_pck.get_cd_estabelecimento, ie_apresenta_qtd_w);

if (ie_apresenta_qtd_w = 'S') then
	select	count(cd_item)
	into STRICT	qt_item_liberado_w
	from	w_rep_t
	where	((ie_tipo_item 	= ie_tipo_item_p) or (ie_tipo_item in ('C','G')  and (ie_tipo_item_p in ('C','G'))) or (ie_tipo_item in ('D','DE') and (ie_tipo_item_p in ('D','DE'))) or (ie_tipo_item in ('ME','MD')and (ie_tipo_item_p in ('ME','MD'))))
	and	ie_liberado 	= 'S'
	and	coalesce(dt_atualizacao,clock_timestamp()) between(clock_timestamp() - interval '1 days') and (clock_timestamp() + interval '1 days')
	and	nm_usuario	= nm_usuario_p;

	if (qt_item_liberado_w = 0) then
		retorna_w := '';
	else
		retorna_w := '  ( '||qt_item_liberado_w||' )';
	end if;
else
	retorna_w := '';
end if;


return	retorna_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION plt_obter_qtd_item_liberado ( ie_tipo_item_p text, cd_perfil_p bigint, nm_usuario_p text) FROM PUBLIC;

