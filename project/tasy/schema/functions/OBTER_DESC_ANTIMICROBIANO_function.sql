-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_desc_antimicrobiano ( nr_prescricao_p bigint, nr_sequencia_p bigint) RETURNS varchar AS $body$
DECLARE


ds_retorno_w		varchar(3000);
ie_uso_antimicrobiano_w	varchar(1);
ie_objetivo_w		varchar(60);
ie_origem_infeccao_w	varchar(60);
cd_microorganismo_cih_w	varchar(60);
cd_amostra_cih_w	varchar(60);
cd_topografia_cih_w	varchar(100);
ie_indicacao_w		varchar(60);
qt_dias_solicitado_w	smallint;


BEGIN

select	substr(obter_valor_dominio(1927,ie_indicacao),1,60),
	coalesce(ie_uso_antimicrobiano,'N'),
	substr(obter_valor_dominio(1280,ie_objetivo),1,60),
	substr(obter_valor_dominio(1288,ie_origem_infeccao),1,60),
	substr(obter_cih_microorganismo(cd_microorganismo_cih),1,60),
	substr(obter_cih_amostra(cd_amostra_cih),1,60),
	substr(obter_cih_topografia(cd_topografia_cih),1,100),
	coalesce(qt_dias_solicitado,0)qt_dias_solicitado
into STRICT	ie_indicacao_w,
	ie_uso_antimicrobiano_w,
	ie_objetivo_w,
	ie_origem_infeccao_w,
	cd_microorganismo_cih_w,
	cd_amostra_cih_w,
	cd_topografia_cih_w,
	qt_dias_solicitado_w
from	prescr_material
where	nr_prescricao	= nr_prescricao_p
and	nr_sequencia	= nr_sequencia_p
and	nr_dia_util	= 1;

if (ie_objetivo_w IS NOT NULL AND ie_objetivo_w::text <> '') then
	ds_retorno_w	:= Wheb_mensagem_pck.get_texto(308919) || ': ' /*'Objetivo do uso: '*/||ie_objetivo_w ||' - ';
end if;

if (cd_microorganismo_cih_w IS NOT NULL AND cd_microorganismo_cih_w::text <> '') then
	ds_retorno_w	:= ds_retorno_w ||Wheb_mensagem_pck.get_texto(308920) || ': ' /*'Microorganismo: '*/||cd_microorganismo_cih_w ||' - ';
end if;

if (cd_amostra_cih_w IS NOT NULL AND cd_amostra_cih_w::text <> '') then
	ds_retorno_w	:= ds_retorno_w ||Wheb_mensagem_pck.get_texto(308921) || ': ' /*'Amostra(Material): '*/||cd_amostra_cih_w ||' - ';
end if;

if (ie_origem_infeccao_w IS NOT NULL AND ie_origem_infeccao_w::text <> '') then
	ds_retorno_w	:= ds_retorno_w ||Wheb_mensagem_pck.get_texto(308922) || ': ' /*'Origem da infecção: '*/||ie_origem_infeccao_w ||' - ';
end if;

if (cd_topografia_cih_w IS NOT NULL AND cd_topografia_cih_w::text <> '') then
	ds_retorno_w	:= ds_retorno_w ||Wheb_mensagem_pck.get_texto(308954) || ': ' /*'Topografia: '*/||cd_topografia_cih_w ||' - ';
end if;

if (qt_dias_solicitado_w IS NOT NULL AND qt_dias_solicitado_w::text <> '') then
	ds_retorno_w	:= ds_retorno_w || Wheb_mensagem_pck.get_texto(308955) || ': ' /*'Dias previsto: '*/ || qt_dias_solicitado_w || ' - ';
end if;

if (ie_indicacao_w IS NOT NULL AND ie_indicacao_w::text <> '') then
	ds_retorno_w	:= ds_retorno_w || Wheb_mensagem_pck.get_texto(308956) || ': ' /*'Indicação: '*/ || ie_indicacao_w || ' - ';
end if;

ds_retorno_w	:= ds_retorno_w ||Wheb_mensagem_pck.get_texto(308957) || ': ' /*'Uso anterior de antimicrobiano: '*/||ie_uso_antimicrobiano_w ||' - ';


RETURN ds_retorno_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_desc_antimicrobiano ( nr_prescricao_p bigint, nr_sequencia_p bigint) FROM PUBLIC;

