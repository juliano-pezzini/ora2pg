-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_prescr_proc_conf_or_susp ( nr_seq_item_sae_p prescr_mat_alteracao.nr_seq_item_sae%type, ie_alteracao_p text ) RETURNS varchar AS $body$
DECLARE

    ds_retorno_w     varchar(1) := 'N';
    ie_alteracao_w   varchar(3);
    ie_current_alt_w varchar(20);
    alteracoes_w     varchar(20);

BEGIN
    select  ie_alteracao
            into STRICT ie_alteracao_w
    from (
            SELECT  to_char(pma.ie_alteracao) ie_alteracao
            from    prescr_mat_alteracao pma
            where   pma.nr_seq_item_sae = nr_seq_item_sae_p
            and     pma.ie_alteracao in (1, 3, 5)
            order by
                    pma.nr_sequencia desc
    ) alias2 LIMIT 1;

    alteracoes_w := ie_alteracao_p;
    while (alteracoes_w IS NOT NULL AND alteracoes_w::text <> '' AND ds_retorno_w = 'N')
    loop
      if (INSTR(alteracoes_w, '|', 1, 1) = 0) then
        ie_current_alt_w := alteracoes_w;
        alteracoes_w := null;
      else
        ie_current_alt_w := SUBSTR(alteracoes_w, 1, INSTR(alteracoes_w, '|', 1, 1) -1);
        alteracoes_w := SUBSTR(alteracoes_w, INSTR(alteracoes_w, '|', 1, 1) +1);
      end if;

      if (ie_current_alt_w = ie_alteracao_w) then
        ds_retorno_w := 'S';
      end if;
    end loop;

	return ds_retorno_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_prescr_proc_conf_or_susp ( nr_seq_item_sae_p prescr_mat_alteracao.nr_seq_item_sae%type, ie_alteracao_p text ) FROM PUBLIC;

