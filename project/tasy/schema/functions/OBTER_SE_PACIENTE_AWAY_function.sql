-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_paciente_away (nr_atendimento_p bigint, cd_classif_setor_p bigint default null) RETURNS varchar AS $body$
DECLARE


ds_retorno_w    varchar(1) := 'N';
count_v 	bigint;

BEGIN

	select count(*)
	into STRICT count_v
	from 	atend_paciente_unidade a ,
		setor_atendimento b,
		atend_paciente_unidade c,
		setor_atendimento d
	where coalesce(a.dt_saida_unidade::text, '') = ''
	  and b.cd_classif_setor     	in (3, 4)
	  and a.cd_setor_atendimento  = b.cd_setor_atendimento
	  and d.cd_classif_setor not 	in (3, 4)
	  and c.cd_setor_atendimento  = d.cd_setor_atendimento
	  and coalesce(c.dt_saida_unidade::text, '') = ''
	  and c.nr_atendimento        = a.nr_atendimento
	  and a.nr_atendimento        = nr_atendimento_p;
	if count_v > 0  then
    		if (cd_classif_setor_p IS NOT NULL AND cd_classif_setor_p::text <> '') and cd_classif_setor_p not in (2,5) then
		      	ds_retorno_w := 'S';
	        elsif coalesce(cd_classif_setor_p::text, '') = '' then
	    		ds_retorno_w := 'S';
		end if;

	end if;
	return ds_retorno_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_paciente_away (nr_atendimento_p bigint, cd_classif_setor_p bigint default null) FROM PUBLIC;

