-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pat_obter_mes_calculado ( dt_referencia_p timestamp, cd_estabelecimento_p bigint, ie_tipo_p text) RETURNS varchar AS $body$
DECLARE


ie_situacao_w		varchar(01);
ds_situacao_w		varchar(15);

/*	Tipo
'C'	-	'D'
 0	-	NÃ£o Calculado
 1	-	Calculado     */
BEGIN

select	coalesce(ie_situacao,'0')
into STRICT	ie_situacao_w
from	pat_mes_ref
where	dt_mes_ref		= dt_referencia_p
and	cd_estabelecimento	= cd_estabelecimento_p;

if (ie_tipo_p = 'C') then
	ds_situacao_w	:= ie_situacao_w;
elsif (ie_tipo_p = 'D') then
	begin
	if (ie_situacao_w = '0') then
		ds_situacao_w	:= wheb_mensagem_pck.get_texto(799255);
	elsif (ie_situacao_w = '1') then
		ds_situacao_w	:= wheb_mensagem_pck.get_texto(799256);
	end if;
	end;
end if;

RETURN ds_situacao_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pat_obter_mes_calculado ( dt_referencia_p timestamp, cd_estabelecimento_p bigint, ie_tipo_p text) FROM PUBLIC;

