-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_pertence_gerencia ( ds_gerencias_p text, nr_seq_ordem_p bigint) RETURNS varchar AS $body$
DECLARE


ds_retorno_w		varchar(255) := 'N';
lista_gerencias_w	dbms_sql.varchar2_table;
ie_area_gerencia_w	gerencia_wheb.ie_area_gerencia%type;

BEGIN
	lista_gerencias_w := obter_lista_string(ds_gerencias_p, ',');

	for	i in lista_gerencias_w.first..lista_gerencias_w.last loop
	begin
		SELECT 	ie_area_gerencia
		into STRICT	ie_area_gerencia_w
		FROM	gerencia_wheb
		where	nr_sequencia = obter_somente_numero(lista_gerencias_w(i));

		if (ie_area_gerencia_w = 'DES') then

			select	CASE WHEN count(1)=0 THEN 'N'  ELSE 'S' END
			into STRICT	ds_retorno_w
			from	gerencia_wheb a,
				grupo_desenvolvimento b,
				man_ordem_servico c
			where	a.nr_sequencia = b.nr_seq_gerencia
			and	b.nr_sequencia = c.nr_seq_grupo_des
			and	a.nr_sequencia = obter_somente_numero(lista_gerencias_w(i))
			and	c.nr_sequencia = nr_seq_ordem_p  LIMIT 1;

		elsif (ie_area_gerencia_w = 'SUP') then

			select	CASE WHEN count(1)=0 THEN 'N'  ELSE 'S' END
			into STRICT	ds_retorno_w
			from	gerencia_wheb a,
				grupo_suporte b,
				man_ordem_servico c
			where	a.nr_sequencia = b.nr_seq_gerencia_sup
			and	b.nr_sequencia = c.nr_seq_grupo_sup
			and	a.nr_sequencia = obter_somente_numero(lista_gerencias_w(i))
			and	c.nr_sequencia = nr_seq_ordem_p  LIMIT 1;

		end if;

		exit when ds_retorno_w = 'S';


	exception
	when others then
		ds_retorno_w := 'N';
	end;
	end loop;

if (coalesce(ds_retorno_w::text, '') = '') then
	ds_retorno_w := 'N';
end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_pertence_gerencia ( ds_gerencias_p text, nr_seq_ordem_p bigint) FROM PUBLIC;

