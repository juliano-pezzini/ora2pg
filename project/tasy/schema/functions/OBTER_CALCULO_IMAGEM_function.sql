-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_calculo_imagem ( nr_sequencia_p bigint, ie_opcao_p text, nm_tabela_p text) RETURNS bigint AS $body$
DECLARE

vl_retorno_w	integer:= 0;
qt_reg_w	integer;
qt_reg_ww	integer;
/* 
A	- Altura da Imagem 
L	- Largura da Imagem 
QL	- Quantidade de Linhas 
QC	- Quantidade de Colunas 
Q	- Quantidade de Imagens no Banco 
Q2	- Quantidade de Imagens Editadas 
*/
BEGIN 
if (nm_tabela_p = 'can_loco_reg_imagem') then 
	if (ie_opcao_p = 'Q2') then 
		select	count(*) 
		into STRICT	qt_reg_w 
		from	can_loco_reg_imagem 
		where	nr_seq_loco_reg	= nr_sequencia_p;
	else 
		select	count(*) 
		into STRICT	qt_reg_w 
		from	can_tnm_imagem		d, 
			can_tnm_localizacao	c, 
			cido_topografia		b, 
			can_loco_regional	a 
		where	a.nr_sequencia		= nr_sequencia_p 
		and	a.cd_topografia		= b.cd_topografia 
		and	b.nr_seq_loc_tnm	= c.nr_sequencia 
		and	c.nr_sequencia		= d.nr_seq_loc_tnm;
		select	count(*) 
		into STRICT	qt_reg_ww 
		from	can_tnm_imagem 
		where	coalesce(nr_seq_loc_tnm::text, '') = '';
		qt_reg_w	:= qt_reg_w + qt_reg_ww;
	end	if;	
elsif (nm_tabela_p = 'med_avaliacao_pac_imagem') then 
	if (ie_opcao_p = 'Q2') then 
		select	count(*) 
		into STRICT	qt_reg_w 
		from	med_avaliacao_pac_imagem 
		where	nr_seq_aval_pac	= nr_sequencia_p;
	else 
		select	count(*) 
		into STRICT	qt_reg_w 
		from	med_avaliacao_imagem d, 
			med_tipo_avaliacao a, 
			med_avaliacao_paciente b 
		where	a.nr_sequencia = d.nr_seq_tipo 
		and	b.nr_seq_tipo_avaliacao = a.nr_sequencia 
		and	b.nr_sequencia = nr_sequencia_p;
	end	if;
elsif (nm_tabela_p = 'atend_marcacao_imagem') then 
	if (ie_opcao_p = 'Q2') then 
		select	count(*) 
		into STRICT	qt_reg_w 
		from	atend_marcacao_imagem 
		where	nr_seq_marcacao	= nr_sequencia_p;
	else 
		select	count(*) 
		into STRICT	qt_reg_w 
		from	atendimento_marcacao a, 
			marcacao_imagem b 
		where	a.nr_sequencia	= nr_sequencia_p 
		and	b.ie_tipo_marcacao = a.ie_tipo_marcacao;
	end	if;
elsif (nm_tabela_p = 'rxt_trat_fase_imagem') then 
	if (ie_opcao_p = 'Q2') then 
		select	count(*) 
		into STRICT	qt_reg_w 
		from	rxt_trat_fase_imagem 
		where	nr_seq_fase	= nr_sequencia_p;
	else 
		select	count(*) 
		into STRICT	qt_reg_w 
		from	rxt_protocolo_fase_imagem a, 
			rxt_fase_tratamento b 
		where  a.nr_seq_fase = b.nr_seq_fase_prot 
		and	b.nr_sequencia = nr_sequencia_p;
	end	if;
elsif (nm_tabela_p = 'evolucao_paciente_imagem') then 
	if (ie_opcao_p = 'Q2') then 
		select	count(*) 
		into STRICT	qt_reg_w 
		from	evolucao_paciente_imagem 
		where	cd_evolucao	= nr_sequencia_p;
	else 
		select	count(*) 
		into STRICT	qt_reg_w 
		from 	evolucao_paciente b, 
			evolucao_imagem a 
		where  a.ie_tipo_evolucao =   b.ie_evolucao_clinica 
		and   b.cd_evolucao   = nr_sequencia_p;
		select	count(*) 
		into STRICT	qt_reg_w 
		from	evolucao_imagem 
		where 	coalesce(ie_tipo_evolucao::text, '') = '';
	end	if;
	 
elsif (nm_tabela_p = 'oft_consulta_imagem') then 
	if (ie_opcao_p = 'Q2') then 
		select	count(*) 
		into STRICT	qt_reg_w 
		from	oft_consulta_imagem 
		where	nr_seq_cons_med	= nr_sequencia_p;
	else 
 
		select	count(*) 
		into STRICT	qt_reg_w 
		from	oft_imagem;
	end	if;
elsif (nm_tabela_p = 'protocolo_cir_banco_imagem') then 
	if (ie_opcao_p = 'Q2') then 
		select	count(*) 
		into STRICT	qt_reg_w 
		from	protocolo_cir_banco_imagem 
		where  nr_seq_protocolo = nr_sequencia_p;
	else 
		select	count(*) 
		into STRICT	qt_reg_w 
		from	cirurgia_banco_imagem 
		where	ie_situacao = 'A';
	end	if;	
elsif (nm_tabela_p = 'imagem_cirurgia') then 
	if (ie_opcao_p = 'Q2') then 
		select count(*) 
		into STRICT	qt_reg_w 
		from  imagem_cirurgia 
		where  nr_seq_prot_cirurgia = nr_sequencia_p;
	else 
		select count(*) 
		into STRICT	qt_reg_w 
		from  protocolo_cir_banco_imagem a, 
			cirurgia_descricao b 
		where	a.nr_seq_protocolo = b.nr_seq_protocolo 
		and	b.nr_sequencia = nr_sequencia_p;
	end	if;	
elsif (nm_tabela_p = 'laudo_pac_imagem_edicao') then 
	if (ie_opcao_p = 'Q2') then 
		select count(*) 
		into STRICT  qt_reg_w 
		from  laudo_pac_imagem_edicao 
		where nr_sequencia			=	nr_sequencia_p;
	else 
		select count(*) 
		into STRICT	qt_reg_w 
		from  laudo_paciente_imagem_bco;	
	end	if;	
end if;
if (qt_reg_w > 64) then 
	qt_reg_w	:= 64;
end	if;
/*	Quantidade de Linhas	*/
 
if (ie_opcao_p = 'QL') then 
	if (qt_reg_w in (1,2)) then 
		vl_retorno_w	:= 1;
	elsif (qt_reg_w between 3 and 6) then 
		vl_retorno_w	:= 2;
	elsif (qt_reg_w between 7 and 12) then 
		vl_retorno_w	:= 3;
	elsif (qt_reg_w between 13 and 16) then 
		vl_retorno_w	:= 4;
	elsif (qt_reg_w between 17 and 25) then 
		vl_retorno_w	:= 5;
	elsif (qt_reg_w between 26 and 36) then 
		vl_retorno_w	:= 6;
	elsif (qt_reg_w between 37 and 49) then 
		vl_retorno_w	:= 7;
	end	if;
/*	Quantidade de Colunas	*/
 
elsif (ie_opcao_p = 'QC') then 
	if (qt_reg_w = 1) then 
		vl_retorno_w	:= 1;
	elsif (qt_reg_w between 2 and 4) then 
		vl_retorno_w	:= 2;
	elsif (qt_reg_w between 5 and 9) then 
		vl_retorno_w	:= 3;
	elsif (qt_reg_w between 10 and 16) then 
		vl_retorno_w	:= 4;
	elsif (qt_reg_w between 17 and 30) then 
		vl_retorno_w	:= 5;
	elsif (qt_reg_w between 26 and 32) then 
		vl_retorno_w	:= 6;
	elsif (qt_reg_w between 37 and 49) then 
		vl_retorno_w	:= 7;
	end	if;
/*	Largura da Imagem	*/
 
elsif (ie_opcao_p = 'L') then 
	if (qt_reg_w = 1) then 
		vl_retorno_w	:= 660;
	elsif (qt_reg_w between 2 and 4) then 
		vl_retorno_w	:= 320;
	elsif (qt_reg_w between 5 and 9) then 
		vl_retorno_w	:= 206;
	elsif (qt_reg_w between 10 and 16) then 
		vl_retorno_w	:= 150;
	elsif (qt_reg_w between 17 and 64) then 
		vl_retorno_w	:= 115;
	end	if;
/*	Altura da Imagem	*/
 
elsif (ie_opcao_p = 'A') then 
	if (qt_reg_w in (1,2)) then 
		vl_retorno_w	:= 490;
	elsif (qt_reg_w between 3 and 6) then 
		vl_retorno_w	:= 232;
	elsif (qt_reg_w between 7 and 12) then 
		vl_retorno_w	:= 146;
	elsif (qt_reg_w between 13 and 16) then 
		vl_retorno_w	:= 104;
	elsif (qt_reg_w between 17 and 64) then 
		vl_retorno_w	:= 75;
	end	if;
/*	Quantidade de Registros	*/
 
elsif (ie_opcao_p in ('Q','Q2')) then 
		vl_retorno_w	:= qt_reg_w;
end	if;
return	vl_retorno_W;	
end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_calculo_imagem ( nr_sequencia_p bigint, ie_opcao_p text, nm_tabela_p text) FROM PUBLIC;

