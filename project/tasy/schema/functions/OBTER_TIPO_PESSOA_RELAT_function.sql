-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_tipo_pessoa_relat (cd_cgc_p text, cd_estabelecimento_p bigint, ie_notin_p text, ds_sql_p text) RETURNS varchar AS $body$
DECLARE


ds_retorno_w		varchar(1);
cd_tipo_pessoa_w	pessoa_juridica.cd_tipo_pessoa%type;

C01 CURSOR FOR
SELECT	a.cd_tipo_pessoa
from	pessoa_jur_tipo_adic a
where	a.cd_cgc		= cd_cgc_p
and	a.cd_estabelecimento	= cd_estabelecimento_p

union

select	a.cd_tipo_pessoa
from	pessoa_juridica a
where	a.cd_cgc		= cd_cgc_p;


BEGIN

open C01;
loop
fetch C01 into
	cd_tipo_pessoa_w;
EXIT WHEN NOT FOUND or (ds_retorno_w = 'N' and ie_notin_p = 'S') or (ds_retorno_w = 'S' and ie_notin_p = 'N');  /* apply on C01 */
	begin

	select	coalesce(max('S'),'N')
	into STRICT	ds_retorno_w
	
	where	((ie_notin_p = 'S') and (', ' || trim(both ds_sql_p) || ',' not like '%, ' || cd_tipo_pessoa_w || ',%')) or
		((ie_notin_p = 'N') and (', ' || trim(both ds_sql_p) || ',' like '%, ' || cd_tipo_pessoa_w || ',%'));

	end;
end loop;
close C01;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_tipo_pessoa_relat (cd_cgc_p text, cd_estabelecimento_p bigint, ie_notin_p text, ds_sql_p text) FROM PUBLIC;

