-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION plt_obter_item_orig ( nr_prescricao_p bigint, nr_sequencia_p bigint, nm_tabela_p text, ie_opcao_p text) RETURNS bigint AS $body$
DECLARE

/*				
ie_opcao
P - nr_prescricao
S - nr_sequencia				
*/
nr_prescricao_w		bigint;
nr_sequencia_w		bigint;


BEGIN

if (upper(nm_tabela_p) = 'PRESCR_MATERIAL') then

	select	max(coalesce(nr_prescricao_original,nr_prescricao)),
		max(coalesce(nr_seq_anterior,nr_sequencia))
	into STRICT	nr_prescricao_w,
		nr_sequencia_w
	from	prescr_material
	where	nr_prescricao	= nr_prescricao_p
	and	nr_sequencia	= nr_sequencia_p;	
		
elsif (upper(nm_tabela_p) = 'PRESCR_DIETA') then

	select	max(coalesce(nr_prescricao_original,nr_prescricao)),
			max(coalesce(nr_seq_anterior,nr_sequencia))
	into STRICT	nr_prescricao_w,
		nr_sequencia_w
	from	prescr_dieta
	where	nr_prescricao	= nr_prescricao_p
	and	nr_sequencia	= nr_sequencia_p;	

elsif (upper(nm_tabela_p) = 'REP_JEJUM') then

	select	coalesce(nr_seq_anterior,nr_sequencia),
		nr_prescricao
	into STRICT	nr_sequencia_w,
		nr_prescricao_w
	from	rep_jejum
	where	nr_sequencia	= nr_sequencia_p;

elsif (upper(nm_tabela_p) = 'NUT_PAC') then

	select	coalesce(nr_seq_anterior,nr_sequencia),
		nr_prescricao
	into STRICT	nr_sequencia_w,
		nr_prescricao_w
	from	nut_pac
	where	nr_sequencia	= nr_sequencia_p;	

elsif (upper(nm_tabela_p) = 'PRESCR_SOLUCAO') then

	select	coalesce(nr_prescricao_original,nr_prescricao),
		coalesce(nr_seq_anterior,nr_seq_solucao)
	into STRICT	nr_prescricao_w,
		nr_sequencia_w
	from	prescr_solucao
	where	nr_prescricao	= nr_prescricao_p
	and	nr_seq_solucao	= nr_sequencia_p;	

elsif (upper(nm_tabela_p) = 'PRESCR_GASOTERAPIA') then

	select	coalesce(nr_seq_anterior,nr_sequencia),
		nr_prescricao
	into STRICT	nr_sequencia_w,
		nr_prescricao_w
	from	prescr_gasoterapia
	where	nr_sequencia	= nr_sequencia_p;

elsif (upper(nm_tabela_p) = 'PRESCR_PROCEDIMENTO') then
	
	select	coalesce(nr_prescricao_original,nr_prescricao),
		coalesce(nr_seq_anterior,nr_sequencia)
	into STRICT	nr_prescricao_w,
		nr_sequencia_w
	from	prescr_procedimento
	where	nr_prescricao	= nr_prescricao_p
	and	nr_sequencia	= nr_sequencia_p;	

elsif (upper(nm_tabela_p) = 'PRESCR_RECOMENDACAO') then

	select	coalesce(nr_prescricao_original,nr_prescricao),
		coalesce(nr_seq_anterior,nr_sequencia)
	into STRICT	nr_prescricao_w,
		nr_sequencia_w
	from	prescr_recomendacao
	where	nr_prescricao	= nr_prescricao_p
	and	nr_sequencia	= nr_sequencia_p;	

end if;

if (ie_opcao_p	= 'P') then
	return	nr_prescricao_w;
else
	return	nr_sequencia_w;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION plt_obter_item_orig ( nr_prescricao_p bigint, nr_sequencia_p bigint, nm_tabela_p text, ie_opcao_p text) FROM PUBLIC;

