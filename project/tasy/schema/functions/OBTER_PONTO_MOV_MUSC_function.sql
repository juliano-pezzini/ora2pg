-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_ponto_mov_musc (cd_pessoa_fisica_p text, nr_seq_art_mov_musculo_p bigint, nr_seq_toxina_p bigint default 1) RETURNS bigint AS $body$
DECLARE


qt_retorno_w		double precision;
qt_idade_w		integer;
qt_peso_w		double precision;


BEGIN
SELECT	MAX(obter_idade(dt_nascimento,clock_timestamp(),'A'))
INTO STRICT	qt_idade_w
FROM	pessoa_fisica
WHERE	cd_pessoa_fisica = cd_pessoa_fisica_p;


select	coalesce(max(qt_peso),0)
into STRICT	qt_peso_w
from	atendimento_sinal_vital
where	nr_sequencia = (SELECT	coalesce(max(nr_sequencia),-1)
			from	atendimento_sinal_vital
			where	(qt_peso IS NOT NULL AND qt_peso::text <> '')
			and	cd_paciente	= cd_pessoa_fisica_p
			and	ie_situacao = 'A'
			and	coalesce(IE_RN,'N')	= 'N');

SELECT	MAX(a.qt_pontos_padrao)
INTO STRICT	qt_retorno_w
FROM 	artic_mov_musculo_regra a
WHERE 	a.nr_seq_art_mov_musculo = nr_seq_art_mov_musculo_p
AND	qt_idade_w BETWEEN a.qt_idade_min AND a.qt_idade_max
and 	qt_peso_w between coalesce(a.qt_peso_min,0) and coalesce(a.qt_peso_max,999)
and	coalesce(a.nr_seq_toxina,nr_seq_toxina_p) = nr_seq_toxina_p;

return	qt_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_ponto_mov_musc (cd_pessoa_fisica_p text, nr_seq_art_mov_musculo_p bigint, nr_seq_toxina_p bigint default 1) FROM PUBLIC;

