-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_temperatura ( nr_seq_item_p bigint, cd_setor_atendimento_p bigint, nr_seq_turno_p bigint, dt_medicao_p timestamp, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


qt_temp_inicial_w 		setor_temperatura_item.qt_temp_inicial%type;
qt_temp_max_w 			setor_temperatura_item.qt_temp_max%type;
qt_temp_min_w 			setor_temperatura_item.qt_temp_min%type;
nm_usuario_w 			varchar(15);
dt_atualizacao_w		varchar(10);
dt_atualizacao_nrec_w		varchar(10);
qt_umidade_final_w		setor_temperatura_item.qt_umidade_final%type;
qt_umidade_max_w		setor_temperatura_item.qt_umidade_max%type;
qt_umidade_min_w		setor_temperatura_item.qt_umidade_min%type;

/* opcoes
dia: dia do registro
hr: data
ti: temperatura inicial
tmx: temperatura max
tm: temperatura min
ur : umidade relativa
umx: umidade max
um: umidade min
nmu: nome usu√°rio
*/
BEGIN
select	to_char(b.qt_temp_inicial),
	to_char(b.qt_temp_max),
	to_char(b.qt_temp_min),
	to_char(b.nm_usuario_nrec),
	to_char(b.dt_atualizacao,'hh24:mi'),
	to_char(b.qt_umidade_final),
	to_char(b.qt_umidade_max),
	to_char(b.qt_umidade_min)
into STRICT	qt_temp_inicial_w,
	qt_temp_max_w,
	qt_temp_min_w,
	nm_usuario_w,
	dt_atualizacao_w,
	qt_umidade_final_w,
	qt_umidade_max_w,
	qt_umidade_min_w
from	setor_temperatura_item b,
	setor_temperatura a
where	b.nr_seq_setor_temp = a.nr_sequencia
and	a.cd_setor_atendimento = cd_setor_atendimento_p
and	trunc(b.dt_medicao, 'dd') = trunc(dt_medicao_p,'dd')
and	a.nr_seq_turno = nr_seq_turno_p  LIMIT 1;

if (ie_opcao_p = 'HR') then
	return dt_atualizacao_w;
elsif (ie_opcao_p = 'TI') then
	return qt_temp_inicial_w;
elsif (ie_opcao_p = 'TMX') then
	return qt_temp_max_w;
elsif (ie_opcao_p = 'TM') then
	return qt_temp_min_w;
elsif (ie_opcao_p = 'NMU') then
	return 	nm_usuario_w;
elsif (ie_opcao_p = 'DIA') then
	return dt_atualizacao_nrec_w;
elsif (ie_opcao_p = 'UR') then
	return qt_umidade_final_w;
elsif (ie_opcao_p = 'UMX') then
	return qt_umidade_max_w;
elsif (ie_opcao_p = 'UM') then
	return qt_umidade_min_w;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_temperatura ( nr_seq_item_p bigint, cd_setor_atendimento_p bigint, nr_seq_turno_p bigint, dt_medicao_p timestamp, ie_opcao_p text) FROM PUBLIC;

