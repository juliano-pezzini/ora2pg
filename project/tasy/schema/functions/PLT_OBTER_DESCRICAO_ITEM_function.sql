-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION plt_obter_descricao_item ( nr_prescr_titulo_p bigint, cd_perfil_p bigint, ie_tipo_item_p text, ds_prescrito_p text, cd_estabelecimento_p bigint, nm_usuario_p text) RETURNS varchar AS $body$
DECLARE


ds_retorno_w			varchar(255) := substr(ds_prescrito_p,1,254);
ds_titulo_w			varchar(255);
ie_tipo_item_w			varchar(255);
ds_espacamento_w		varchar(10) := '';
ie_espaco_titulo_w		varchar(1);


BEGIN

ie_espaco_titulo_w := Obter_Param_Usuario(950, 40, cd_perfil_p, nm_usuario_p, cd_estabelecimento_p, ie_espaco_titulo_w);

case	ie_tipo_item_p
	when 'D'   then ie_tipo_item_w := '2';
	when 'O'   then ie_tipo_item_w := '3';
	when 'HM'  then ie_tipo_item_w := '4';
	when 'J'   then ie_tipo_item_w := '5';
	when 'MAT' then ie_tipo_item_w := '6';
	when 'M'   then ie_tipo_item_w := '7';
	when 'NAN' then ie_tipo_item_w := '8';
	when 'NPN' then ie_tipo_item_w := '9';
	when 'NPP' then ie_tipo_item_w := '10';
	when 'P'   then ie_tipo_item_w := '12';
	when 'R'   then ie_tipo_item_w := '13';
	when 'SNE' then ie_tipo_item_w := '14';
	when 'S'   then ie_tipo_item_w := '15';
	when 'SOL' then ie_tipo_item_w := '16';
	when 'G'   then ie_tipo_item_w := '18';
	when 'C'   then ie_tipo_item_w := '18';
	when 'I'   then ie_tipo_item_w := '19';
	when 'L'   then ie_tipo_item_w := '20';
	when 'LD'  then ie_tipo_item_w := '21';
	else ie_tipo_item_w := '';
end case;

if (nr_prescr_titulo_p IS NOT NULL AND nr_prescr_titulo_p::text <> '') then
	if (cd_perfil_p IS NOT NULL AND cd_perfil_p::text <> '') then
		select	max(ds_item)
		into STRICT	ds_titulo_w
		from	plt_nomenclatura
		where (cd_perfil = cd_perfil_p)
		and	ie_tipo_item = ie_tipo_item_w;
	else
		select	max(ds_item)
		into STRICT	ds_titulo_w
		from	plt_nomenclatura
		where (coalesce(cd_perfil::text, '') = '')
		and	ie_tipo_item = ie_tipo_item_w;
	end if;

	if (ds_titulo_w IS NOT NULL AND ds_titulo_w::text <> '') then

		ds_retorno_w	:= ds_titulo_w;

	end if;

end if;

if	((ie_espaco_titulo_w = 'S' AND nr_prescr_titulo_p IS NOT NULL AND nr_prescr_titulo_p::text <> '') or
	 ((ie_espaco_titulo_w = 'N') and (coalesce(nr_prescr_titulo_p::text, '') = ''))) then
	ds_espacamento_w := '          ';
end if;

return	ds_espacamento_w||ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION plt_obter_descricao_item ( nr_prescr_titulo_p bigint, cd_perfil_p bigint, ie_tipo_item_p text, ds_prescrito_p text, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;

