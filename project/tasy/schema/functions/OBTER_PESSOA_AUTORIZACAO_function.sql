-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_pessoa_autorizacao (nr_seq_autorizacao_p bigint) RETURNS varchar AS $body$
DECLARE


cd_pessoa_fisica_w		varchar(255);
nr_atendimento_w		bigint;
nr_seq_agenda_w			autorizacao_convenio.nr_seq_agenda%type;
nr_seq_agenda_integ_w		bigint;
nr_seq_agenda_consulta_w	agenda_consulta.nr_sequencia%type;
nr_seq_paciente_setor_w		bigint;
nr_seq_gestao_w			bigint;
cd_pessoa_fisica_autor_w	varchar(255);	


BEGIN

select 	max(nr_atendimento),
	max(nr_seq_agenda),
	max(nr_seq_age_integ),
	max(nr_seq_agenda_consulta),
	max(nr_seq_paciente_setor),
	max(nr_seq_gestao),
	max(cd_pessoa_fisica)
into STRICT 	nr_atendimento_w,
	nr_seq_agenda_w,
	nr_seq_agenda_integ_w,
	nr_seq_agenda_consulta_w,
	nr_seq_paciente_setor_w,
	nr_seq_gestao_w,
	cd_pessoa_fisica_autor_w
from 	autorizacao_convenio
where	nr_sequencia 	= nr_seq_autorizacao_p;


if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
	select	max(cd_pessoa_fisica)
	into STRICT	cd_pessoa_fisica_w
	from	atendimento_paciente
	where	nr_atendimento	= nr_atendimento_w;

elsif (nr_seq_agenda_w IS NOT NULL AND nr_seq_agenda_w::text <> '') then
	select	max(cd_pessoa_fisica)
	into STRICT	cd_pessoa_fisica_w
	from	agenda_paciente
	where	nr_sequencia	= nr_seq_agenda_w;

elsif (nr_seq_agenda_integ_w IS NOT NULL AND nr_seq_agenda_integ_w::text <> '') then
	select	max(cd_pessoa_fisica)
	into STRICT	cd_pessoa_fisica_w
	from	agenda_integrada
	where	nr_sequencia	= nr_seq_agenda_integ_w;

elsif (nr_seq_agenda_consulta_w IS NOT NULL AND nr_seq_agenda_consulta_w::text <> '') then
	select	max(cd_pessoa_fisica)
	into STRICT	cd_pessoa_fisica_w
	from	agenda_consulta
	where	nr_sequencia	= nr_seq_agenda_consulta_w;

elsif (nr_seq_paciente_setor_w IS NOT NULL AND nr_seq_paciente_setor_w::text <> '') then
	select 	max(cd_pessoa_fisica)
	into STRICT	cd_pessoa_fisica_w
	from 	paciente_setor
	where	nr_seq_paciente	= nr_seq_paciente_setor_w;
elsif (nr_seq_gestao_w IS NOT NULL AND nr_seq_gestao_w::text <> '') then
	select 	max(cd_pessoa_fisica)
	into STRICT	cd_pessoa_fisica_w
	from 	gestao_vaga
	where	nr_sequencia	= nr_seq_gestao_w;	
elsif (cd_pessoa_fisica_autor_w IS NOT NULL AND cd_pessoa_fisica_autor_w::text <> '') then
	cd_pessoa_fisica_w	:= cd_pessoa_fisica_autor_w;
end if;

return	cd_pessoa_fisica_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_pessoa_autorizacao (nr_seq_autorizacao_p bigint) FROM PUBLIC;

