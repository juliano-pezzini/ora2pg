-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_agenda_a_seguir ( nr_seq_agenda_p bigint ) RETURNS varchar AS $body$
DECLARE


ie_as_w		varchar(1);
hr_inicio_w	timestamp;
hr_inicio_ww	timestamp;
cd_medico_w	varchar(10);


BEGIN

select	a.hr_inicio,
	a.cd_medico
into STRICT	hr_inicio_w,
	cd_medico_w
from	agenda_paciente a
where	a.nr_sequencia	=	nr_seq_agenda_p;

hr_inicio_ww	:= hr_inicio_w - (10/1440);

select	coalesce(max('S'),'N')
into STRICT	ie_as_w
from	agenda_paciente x
where	x.hr_inicio between hr_inicio_ww  and hr_inicio_w
and	x.cd_medico	= cd_medico_w
and	x.nr_sequencia	<> nr_seq_agenda_p;

return	ie_as_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_agenda_a_seguir ( nr_seq_agenda_p bigint ) FROM PUBLIC;

