-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_localizacao_material ( cd_material_p bigint, cd_local_estoque_p bigint) RETURNS varchar AS $body$
DECLARE


ds_localizacao_w		varchar(80)	:=	'X';
ds_localizacao_ww		varchar(80);
nr_seq_estrut_mat_w	localizacao_estoque_local.nr_seq_estrut_mat%type;
nr_seq_local_w		localizacao_estoque_local.nr_seq_local%type;


BEGIN

select	max(nr_seq_estrut_mat),
	max(nr_seq_local),
	coalesce(max(ds_localizacao),'X')
into STRICT	nr_seq_estrut_mat_w,
	nr_seq_local_w,
	ds_localizacao_ww
from	localizacao_estoque_local
where	cd_material		= cd_material_p
and	cd_local_estoque	= cd_local_estoque_p;

if (nr_seq_estrut_mat_w IS NOT NULL AND nr_seq_estrut_mat_w::text <> '') then
	ds_localizacao_w	:=	substr(coalesce(obter_desc_estrut_loc_material(nr_seq_estrut_mat_w),'X'),1,80);
elsif (nr_seq_local_w IS NOT NULL AND nr_seq_local_w::text <> '') then
	begin
	select	substr(coalesce(ds_local,'X'),1,80)
	into STRICT	ds_localizacao_w
	from	material_local
	where	nr_sequencia = nr_seq_local_w;
	exception
	when others then
		ds_localizacao_w	:=	'X';
	end;
elsif (ds_localizacao_ww <> 'X') then
	ds_localizacao_w	:=	ds_localizacao_ww;
end if;

if (ds_localizacao_w = 'X') then
	begin
	select	max(nr_seq_estrut_mat),
		coalesce(max(ds_localizacao),'X')
	into STRICT	nr_seq_estrut_mat_w,
		ds_localizacao_ww
	from 	padrao_estoque_local b,
		material a
	where	a.cd_material_estoque 	= b.cd_material
	and	a.cd_material		= cd_material_p
	and	b.cd_local_estoque		= cd_local_estoque_p;

	if (nr_seq_estrut_mat_w IS NOT NULL AND nr_seq_estrut_mat_w::text <> '') then
		ds_localizacao_w	:=	substr(coalesce(obter_desc_estrut_loc_material(nr_seq_estrut_mat_w),'X'),1,80);
	elsif (ds_localizacao_ww <> 'X') then
		ds_localizacao_w	:=	ds_localizacao_ww;
	end if;

	if (ds_localizacao_w = 'X') then
		ds_localizacao_w	:= substr(obter_dados_material(cd_material_p, 'DL'),1,80);
	end if;
	end;
end if;


return ds_localizacao_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_localizacao_material ( cd_material_p bigint, cd_local_estoque_p bigint) FROM PUBLIC;

