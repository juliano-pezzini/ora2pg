-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_cat_municipio ( cd_municipio_ibge_p sus_municipio.cd_municipio_ibge%type, ie_tipo_inf_p text) RETURNS varchar AS $body$
DECLARE


ds_retorno_w			varchar(255);
nr_seq_municipio_mx_w		sus_municipio.nr_seq_municipio_mx%type;
cd_cat_entidades_w		cat_municipio.cd_cat_entidades%type;
cd_cat_municipio_w		cat_municipio.cd_cat_municipio%type;
ds_cat_municipio_w		cat_municipio.ds_cat_municipio%type;



BEGIN
if (cd_municipio_ibge_p IS NOT NULL AND cd_municipio_ibge_p::text <> '') then

	select 	max(nr_seq_municipio_mx)
	into STRICT	nr_seq_municipio_mx_w
	from 	sus_municipio
	where 	cd_municipio_ibge = cd_municipio_ibge_p;

	if (nr_seq_municipio_mx_w IS NOT NULL AND nr_seq_municipio_mx_w::text <> '') then
		select	cd_cat_entidades,
			cd_cat_municipio,
			ds_cat_municipio
		into STRICT	cd_cat_entidades_w,
			cd_cat_municipio_w,
			ds_cat_municipio_w
		from	cat_municipio
		where	nr_sequencia	= nr_seq_municipio_mx_w;

		if (ie_tipo_inf_p = 'CD_CAT_ENTIDADES') then
			ds_retorno_w 	:= cd_cat_entidades_w;

		elsif (ie_tipo_inf_p = 'CD_CAT_MUNICIPIO') then
			ds_retorno_w 	:= cd_cat_municipio_w;

		elsif (ie_tipo_inf_p = 'DS_CAT_MUNICIPIO') then
			ds_retorno_w 	:= ds_cat_municipio_w;
		end if;
	end if;
end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_cat_municipio ( cd_municipio_ibge_p sus_municipio.cd_municipio_ibge%type, ie_tipo_inf_p text) FROM PUBLIC;

