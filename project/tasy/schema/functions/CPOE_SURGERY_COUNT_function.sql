-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cpoe_surgery_count ( NR_ATENDIMENTO_P bigint ) RETURNS bigint AS $body$
DECLARE


count_record_w		bigint;


BEGIN
  select count(a.nr_atendimento) into STRICT count_record_w
  from    cirurgia a,
      cirurgia_agente_anestesico b
  where    a.nr_atendimento = nr_atendimento_p
  and    a.nr_cirurgia = b.nr_cirurgia
  and b.ie_tipo in (2,3)
  and    CPOE_REGRA_CIRURGIA(b.cd_material) = 'C'
  and    (coalesce(b.nr_seq_mat_cpoe, b.nr_seq_diet_cpoe) IS NOT NULL AND (coalesce(b.nr_seq_mat_cpoe, b.nr_seq_diet_cpoe))::text <> '');

  
  RETURN count_record_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_surgery_count ( NR_ATENDIMENTO_P bigint ) FROM PUBLIC;

