-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_vl_carreg_rel_2434 ( nr_seq_segurado_p pls_segurado.nr_sequencia%type) RETURNS bigint AS $body$
DECLARE

 
ie_tipo_contratacao_w	pls_plano.ie_tipo_contratacao%type;
ie_regulamentacao_w	pls_plano.ie_regulamentacao%type;
ie_tipo_pessoa_w	varchar(10);
ie_tipo_valor_w		varchar(10);
vl_carregamento_w	double precision;

BEGIN
 
vl_carregamento_w := 1;
if (nr_seq_segurado_p IS NOT NULL AND nr_seq_segurado_p::text <> '') then 
	-- obter o tipo de contratacao do produto 
	ie_tipo_contratacao_w := substr(pls_obter_dados_segurado(nr_seq_segurado_p,'TCC'),1,2);
	if (ie_tipo_contratacao_w IS NOT NULL AND ie_tipo_contratacao_w::text <> '') then 
		-- obter a regulamentacao do plano do segurado 
		ie_regulamentacao_w := substr(pls_obter_dados_segurado(nr_seq_segurado_p,'RPL'),1,2);
		if (ie_regulamentacao_w IS NOT NULL AND ie_regulamentacao_w::text <> '') then 
			-- obter se plano tipo PF PJ; 
			select	CASE WHEN ie_tipo_contratacao_w='I' THEN 'PF'  ELSE 'PJ' END  
			into STRICT	ie_tipo_pessoa_w 
			;
			 
			if (ie_tipo_pessoa_w IS NOT NULL AND ie_tipo_pessoa_w::text <> '') then 
				-- Obter se PJ ou se PF identificar a regulamentação do plano. 
				select	CASE WHEN ie_tipo_pessoa_w='PJ' THEN 'PJ'  ELSE CASE WHEN ie_regulamentacao_w='R' THEN 'PFNR'  ELSE 'PFR' END  END  
				into STRICT	ie_tipo_valor_w 
				;
				 
				-- Oter os valores carregamentos o tipo de pessoa do benef 
				if (ie_tipo_valor_w = 'PJ') then 
					select	max(vl_carregamento_pj) 
					into STRICT	vl_carregamento_w 
					from	w_pls_param_relat_2434;
				elsif (ie_tipo_valor_w = 'PFNR') then 
					select	max(vl_carregamento_pf_nr) 
					into STRICT	vl_carregamento_w 
					from	w_pls_param_relat_2434;
				elsif (ie_tipo_valor_w = 'PFR') then 
					select	max(vl_carregamento_pf_r) 
					into STRICT	vl_carregamento_w 
					from	w_pls_param_relat_2434;
				else 
					vl_carregamento_w := 1;
				end if;				
			end if;
		end if;
	end if;
end if;
 
return	vl_carregamento_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_vl_carreg_rel_2434 ( nr_seq_segurado_p pls_segurado.nr_sequencia%type) FROM PUBLIC;

