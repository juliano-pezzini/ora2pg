-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION sus_obter_valores_procpaci ( nr_sequencia_p bigint, ie_opcao_p bigint) RETURNS bigint AS $body$
DECLARE

 
/* 
ie_opcao_p 
 1 - Valor Rateio SADT 
*/
 
		 
 
vl_sadt_w		double precision;
vl_retorno_w		double precision;		

BEGIN 
 
 
begin 
select		coalesce(sum(Sus_Obter_Valor_Sadt(b.nr_sequencia)),0) vl_sadt 
into STRICT		vl_sadt_w 
from		sus_estrutura_procedimento_v	x, 
		procedimento_paciente		b, 
		conta_paciente			c 
where		b.nr_sequencia 			= nr_sequencia_p 
and		c.nr_interno_conta		= b.nr_interno_conta 
and		b.cd_procedimento		= x.cd_procedimento 
and		b.ie_origem_proced		= x.ie_origem_proced 
and		coalesce(Sus_Obter_Valor_Sadt(b.nr_sequencia),0) <= coalesce(Sus_Obter_Valor_Item_Proc(b.nr_sequencia,1),0) 
and		coalesce(c.ie_cancelamento::text, '') = '' 
and		coalesce(b.cd_motivo_exc_conta::text, '') = '';
exception 
		when no_data_found then 
		begin 
		vl_sadt_w	:= 0;
		end;
end;
 
vl_retorno_w			:= vl_sadt_w;
 
return	vl_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION sus_obter_valores_procpaci ( nr_sequencia_p bigint, ie_opcao_p bigint) FROM PUBLIC;

