-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_observacao_intervencao ( NR_SEQUENCIA_P bigint) RETURNS varchar AS $body$
DECLARE

  ds_observacao_w varchar(4000) := '';

BEGIN

  IF ((NR_SEQUENCIA_P IS NOT NULL AND NR_SEQUENCIA_P::text <> '') AND (pkg_i18n.get_user_locale() = 'ja_JP')) THEN
    BEGIN
      SELECT MAX(CASE WHEN coalesce(a.DS_OBSERVACAO::text, '') = '' THEN ''  ELSE '('|| a.DS_OBSERVACAO ||')' END )
      INTO STRICT ds_observacao_w
      FROM PE_PRESCR_PROC_OBS a
      WHERE a.NR_SEQ_PE_PROC = NR_SEQUENCIA_P
      AND a.NR_SEQUENCIA = (
        SELECT MAX(NR_SEQUENCIA) FROM PE_PRESCR_PROC_OBS b WHERE b.NR_SEQ_PE_PROC = a.NR_SEQ_PE_PROC AND coalesce(b.DT_INATIVACAO::text, '') = '' AND (b.DT_LIBERACAO IS NOT NULL AND b.DT_LIBERACAO::text <> '')
      )
      ORDER BY a.NR_SEQUENCIA DESC;
    END;
  END IF;
RETURN ds_observacao_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_observacao_intervencao ( NR_SEQUENCIA_P bigint) FROM PUBLIC;

