-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_status_timbrado ( nr_adiantamento_p adiantamento_dev.nr_adiantamento%type ) RETURNS varchar AS $body$
DECLARE


    nr_sequencia_w   bigint;
    nr_nfe_imp_w     bigint;
    timbrado_w       varchar(20);

BEGIN
    SELECT
        coalesce(obter_nota_fiscal_adiant(nr_adiantamento_p), 0)
    INTO STRICT nr_sequencia_w
;

    IF ( nr_sequencia_w <> 0 ) THEN
        SELECT
            coalesce(c.nr_nfe_imp, 0)
        INTO STRICT nr_nfe_imp_w
        FROM
            nota_fiscal c
        WHERE
            c.nr_sequencia = nr_sequencia_w;

        IF ( nr_nfe_imp_w <> 0 ) THEN
            timbrado_w := wheb_mensagem_pck.get_texto(1127812);
        ELSE
            timbrado_w := wheb_mensagem_pck.get_texto(1127813);
        END IF;

    ELSE
        timbrado_w := wheb_mensagem_pck.get_texto(1127813);
    END IF;

    RETURN timbrado_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_status_timbrado ( nr_adiantamento_p adiantamento_dev.nr_adiantamento%type ) FROM PUBLIC;

