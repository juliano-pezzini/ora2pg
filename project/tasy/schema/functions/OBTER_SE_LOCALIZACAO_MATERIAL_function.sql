-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_localizacao_material ( cd_material_p bigint ) RETURNS varchar AS $body$
DECLARE


ds_retorno_w	varchar(255) := ' ';
ds_localizacao_w	varchar(255) := ' ';

C001 CURSOR FOR

SELECT	SUBSTR(obter_localizacao_material(a.cd_material, a.cd_local_estoque),1,255)
FROM	saldo_estoque a
WHERE	cd_material    		= cd_material_p
AND	dt_mesano_referencia	= (	SELECT	MAX(dt_mesano_referencia)
					FROM	saldo_estoque x
					WHERE	x.cd_material = a.cd_material
					AND	(obter_localizacao_material(x.cd_material, x.cd_local_estoque) IS NOT NULL AND (obter_localizacao_material(x.cd_material, x.cd_local_estoque))::text <> ''))
AND	(obter_localizacao_material(a.cd_material, a.cd_local_estoque) IS NOT NULL AND (obter_localizacao_material(a.cd_material, a.cd_local_estoque))::text <> '')
AND	a.cd_local_estoque = 1
ORDER	BY 1;



BEGIN

OPEN C001;
LOOP
FETCH	C001	INTO
		ds_localizacao_w;
EXIT WHEN NOT FOUND; /* apply on c001 */

	if ( ds_retorno_w <> ' ' ) then
		ds_retorno_w	:=	ds_retorno_w || '   ';
	end if;

	ds_retorno_w	:=	ds_retorno_w || ds_localizacao_w;

END LOOP;
CLOSE C001;

return ds_retorno_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_localizacao_material ( cd_material_p bigint ) FROM PUBLIC;

