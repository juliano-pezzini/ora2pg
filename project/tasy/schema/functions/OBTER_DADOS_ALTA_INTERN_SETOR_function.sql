-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_alta_intern_setor ( nr_atendimento_p bigint, ie_retorno_p text, nr_seq_atepacu_p bigint default null) RETURNS varchar AS $body$
DECLARE

 
ds_retorno_w		varchar(100);
nr_Seq_interno_ww 	bigint;

			 
/* ie_retorno_p 
 DAS - Data alta setor 
 MAS - Motivo alta setor 
 PAS - Procedência alta setor 
 MIS - Motivo internação setor 
 SIS - Submotivo internação setor 
 DS - Descrição do setor de atendimento 
*/
			 
						 

BEGIN 
begin 
if (nr_seq_atepacu_p IS NOT NULL AND nr_seq_atepacu_p::text <> '') then 
	nr_seq_interno_ww	:= nr_seq_atepacu_p;
else 
	nr_seq_interno_ww	:= obter_atepacu_paciente(nr_atendimento_p, 'A');
end if;
 
If (ie_retorno_p = 'DAS') then 
	 select to_char(dt_alta_medico_setor, 'dd/mm/yyyy hh24:mi:ss') 
	 into STRICT	ds_retorno_w 
	 from	atend_paciente_unidade 
	 where	nr_seq_interno = nr_seq_interno_ww;
elsif (ie_retorno_p = 'MAS') then 
	 select Obter_motivo_alta_setor(cd_motivo_alta_setor) 
	 into STRICT	ds_retorno_w 
	 from	atend_paciente_unidade 
	 where	nr_seq_interno = nr_seq_interno_ww;
elsif (ie_retorno_p = 'PAS') then 
	 select Obter_proced_alta_setor(cd_procedencia_setor) 
	 into STRICT	ds_retorno_w 
	 from	atend_paciente_unidade 
	 where	nr_seq_interno = nr_seq_interno_ww;
elsif (ie_retorno_p = 'MIS') then 
	 select Obter_motivo_intern_setor(nr_seq_motivo_int) 
	 into STRICT	ds_retorno_w 
	 from	atend_paciente_unidade 
	 where	nr_seq_interno = nr_seq_interno_ww;
elsif (ie_retorno_p = 'SIS') then 
	 select obter_submotivo_intern_setor(nr_seq_motivo_int_sub) 
	 into STRICT	ds_retorno_w 
	 from	atend_paciente_unidade 
	 where	nr_seq_interno = nr_seq_interno_ww;
elsif (ie_retorno_p = 'DS') then 
	select	max(c.ds_setor_atendimento) 
	into STRICT	ds_retorno_w 
	from	setor_atendimento c, 
		unidade_atendimento b,	 
		atend_paciente_unidade a 
	where	b.cd_setor_atendimento = c.cd_setor_atendimento 
	and 	a.cd_setor_atendimento = b.cd_setor_atendimento 
	and	a.cd_unidade_basica = b.cd_unidade_basica 
	and 	a.cd_unidade_compl = b.cd_unidade_compl 
	and 	a.nr_seq_interno = nr_seq_interno_ww;
end if;
 
 
exception 
	 when others then 
	 ds_retorno_w	:= null;
end;
 
return	ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_alta_intern_setor ( nr_atendimento_p bigint, ie_retorno_p text, nr_seq_atepacu_p bigint default null) FROM PUBLIC;

