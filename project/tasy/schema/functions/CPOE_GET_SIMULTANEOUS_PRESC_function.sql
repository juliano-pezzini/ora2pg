-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cpoe_get_simultaneous_presc ( TP_CPOE_P text, DT_REFERENCIA_P timestamp, NR_ATENDIMENTO_P bigint) RETURNS bigint AS $body$
DECLARE

  C_DIETA CURSOR FOR
    SELECT NR_SEQUENCIA,
           SUBSTR(OBTER_DESC_DIETA(CD_DIETA), 1, 255) DS_ITEM,
           'D'                                        IE_TIPO_ITEM,
           NR_ATENDIMENTO,
           CD_PESSOA_FISICA,
           HR_PRIM_HORARIO,
           DT_INICIO,
           'N'                                        IE_TIPO_ITEM_CPOE,
           CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  NULL  ELSE DT_SUSPENSAO END      DT_SUSPENSAO,
           NULL                                       CD_MATERIAL,
           NM_USUARIO,
           DT_LIBERACAO
    FROM   CPOE_DIETA
    WHERE  CPOE_REG_VALIDO_ATIVACAO(CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  DT_FIM  ELSE CPOE_OBTER_DATA_MAIOR(                                    DT_SUSPENSAO, DT_FIM) END ,
                  DT_INICIO, clock_timestamp()) = 'S'
           AND IE_TIPO_DIETA = 'O'
           AND NR_ATENDIMENTO = NR_ATENDIMENTO_P
           AND NM_USUARIO <> WHEB_USUARIO_PCK.GET_NM_USUARIO
           AND ( (DT_LIBERACAO IS NOT NULL AND DT_LIBERACAO::text <> '')
                  OR DT_LIBERACAO > DT_REFERENCIA_P )

UNION ALL

    SELECT NR_SEQUENCIA,
           SUBSTR(OBTER_DESC_MATERIAL(CD_MATERIAL), 1, 255) DS_ITEM,
           'SNE'                                            IE_TIPO_ITEM,
           NR_ATENDIMENTO,
           CD_PESSOA_FISICA,
           HR_PRIM_HORARIO,
           DT_INICIO,
           'N'                                              IE_TIPO_ITEM_CPOE,
           CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  NULL  ELSE DT_SUSPENSAO END            DT_SUSPENSAO,
           CD_MATERIAL,
           NM_USUARIO,
           DT_LIBERACAO
    FROM   CPOE_DIETA
    WHERE  CPOE_REG_VALIDO_ATIVACAO(CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  DT_FIM  ELSE CPOE_OBTER_DATA_MAIOR(                                    DT_SUSPENSAO, DT_FIM) END ,
                  DT_INICIO, clock_timestamp()) = 'S'
           AND IE_TIPO_DIETA = 'E'
           AND NR_ATENDIMENTO = NR_ATENDIMENTO_P
           AND NM_USUARIO <> WHEB_USUARIO_PCK.GET_NM_USUARIO
           AND ( (DT_LIBERACAO IS NOT NULL AND DT_LIBERACAO::text <> '')
                  OR DT_LIBERACAO > DT_REFERENCIA_P )
    
UNION ALL

    SELECT NR_SEQUENCIA,
           SUBSTR(OBTER_DESC_MATERIAL(CD_MATERIAL), 1, 255) DS_ITEM,
           'S'                                              IE_TIPO_ITEM,
           NR_ATENDIMENTO,
           CD_PESSOA_FISICA,
           HR_PRIM_HORARIO,
           DT_INICIO,
           'N'                                              IE_TIPO_ITEM_CPOE,
           CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  NULL  ELSE DT_SUSPENSAO END            DT_SUSPENSAO,
           CD_MATERIAL,
           NM_USUARIO,
           DT_LIBERACAO
    FROM   CPOE_DIETA
    WHERE  CPOE_REG_VALIDO_ATIVACAO(CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  DT_FIM  ELSE CPOE_OBTER_DATA_MAIOR(                                    DT_SUSPENSAO, DT_FIM) END ,
                  DT_INICIO, clock_timestamp()) = 'S'
           AND IE_TIPO_DIETA = 'S'
           AND NR_ATENDIMENTO = NR_ATENDIMENTO_P
           AND NM_USUARIO <> WHEB_USUARIO_PCK.GET_NM_USUARIO
           AND ( (DT_LIBERACAO IS NOT NULL AND DT_LIBERACAO::text <> '')
                  OR DT_LIBERACAO > DT_REFERENCIA_P )
    
UNION ALL

    SELECT NR_SEQUENCIA,
           SUBSTR(OBTER_DESC_TIPO_JEJUM(NR_SEQ_TIPO), 1, 255) DS_ITEM,
           'J'                                                IE_TIPO_ITEM,
           NR_ATENDIMENTO,
           CD_PESSOA_FISICA,
           HR_PRIM_HORARIO,
           DT_INICIO,
           'N'                                                IE_TIPO_ITEM_CPOE,
           CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  NULL  ELSE DT_SUSPENSAO END              DT_SUSPENSAO,
           NULL                                               CD_MATERIAL,
           NM_USUARIO,
           DT_LIBERACAO
    FROM   CPOE_DIETA
    WHERE  CPOE_REG_VALIDO_ATIVACAO(CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  DT_FIM  ELSE CPOE_OBTER_DATA_MAIOR(                                    DT_SUSPENSAO, DT_FIM) END ,
                  DT_INICIO, clock_timestamp()) = 'S'
           AND IE_TIPO_DIETA = 'J'
           AND NR_ATENDIMENTO = NR_ATENDIMENTO_P
           AND NM_USUARIO <> WHEB_USUARIO_PCK.GET_NM_USUARIO
           AND ( (DT_LIBERACAO IS NOT NULL AND DT_LIBERACAO::text <> '')
                  OR DT_LIBERACAO > DT_REFERENCIA_P )
    
UNION ALL

    SELECT NR_SEQUENCIA,
           SUBSTR(OBTER_DESC_MATERIAL(CD_MAT_PROD1), 1, 255) DS_ITEM,
           'LD'                                              IE_TIPO_ITEM,
           NR_ATENDIMENTO,
           CD_PESSOA_FISICA,
           HR_PRIM_HORARIO,
           DT_INICIO,
           'N'                                               IE_TIPO_ITEM_CPOE,
           CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  NULL  ELSE DT_SUSPENSAO END             DT_SUSPENSAO,
           CD_MAT_PROD1                                      CD_MATERIAL,
           NM_USUARIO,
           DT_LIBERACAO
    FROM   CPOE_DIETA
    WHERE  CPOE_REG_VALIDO_ATIVACAO(CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  DT_FIM  ELSE CPOE_OBTER_DATA_MAIOR(                                    DT_SUSPENSAO, DT_FIM) END ,
                  DT_INICIO, clock_timestamp()) = 'S'
           AND IE_TIPO_DIETA = 'L'
           AND NR_ATENDIMENTO = NR_ATENDIMENTO_P
           AND NM_USUARIO <> WHEB_USUARIO_PCK.GET_NM_USUARIO
           AND ( (DT_LIBERACAO IS NOT NULL AND DT_LIBERACAO::text <> '')
                  OR DT_LIBERACAO > DT_REFERENCIA_P )
    
UNION ALL

    SELECT NR_SEQUENCIA,
           'NPT '
           ||SUBSTR(OBTER_DESC_PROT_NPT(NR_SEQ_PROTOCOLO), 1, 255) DS_ITEM,
           'NA'                                                    IE_TIPO_ITEM,
           NR_ATENDIMENTO,
           CD_PESSOA_FISICA,
           HR_PRIM_HORARIO,
           DT_INICIO,
           'N'
           IE_TIPO_ITEM_CPOE
           ,
           CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  NULL  ELSE DT_SUSPENSAO END                   DT_SUSPENSAO,
           NULL                                                    CD_MATERIAL,
           NM_USUARIO,
           DT_LIBERACAO
    FROM   CPOE_DIETA
    WHERE  CPOE_REG_VALIDO_ATIVACAO(CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  DT_FIM  ELSE CPOE_OBTER_DATA_MAIOR(                                    DT_SUSPENSAO, DT_FIM) END ,
                  DT_INICIO, clock_timestamp()) = 'S'
           AND IE_TIPO_DIETA = 'P'
           AND NR_ATENDIMENTO = NR_ATENDIMENTO_P
           AND NM_USUARIO <> WHEB_USUARIO_PCK.GET_NM_USUARIO
           AND ( (DT_LIBERACAO IS NOT NULL AND DT_LIBERACAO::text <> '')
                  OR DT_LIBERACAO > DT_REFERENCIA_P )
    
UNION ALL

    SELECT NR_SEQUENCIA,
           'NPT '
           ||SUBSTR(OBTER_DESC_PROT_NPT(NR_SEQ_PROTOCOLO), 1, 255) DS_ITEM,
           'NP'                                                    IE_TIPO_ITEM,
           NR_ATENDIMENTO,
           CD_PESSOA_FISICA,
           HR_PRIM_HORARIO,
           DT_INICIO,
           'N'
           IE_TIPO_ITEM_CPOE
           ,
           CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  NULL  ELSE DT_SUSPENSAO END                   DT_SUSPENSAO,
           NULL                                                    CD_MATERIAL,
           NM_USUARIO,
           DT_LIBERACAO
    FROM   CPOE_DIETA
    WHERE  CPOE_REG_VALIDO_ATIVACAO(CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  DT_FIM  ELSE CPOE_OBTER_DATA_MAIOR(                                    DT_SUSPENSAO, DT_FIM) END ,
                  DT_INICIO, clock_timestamp()) = 'S'
           AND IE_TIPO_DIETA = 'I'
           AND NR_ATENDIMENTO = NR_ATENDIMENTO_P
           AND NM_USUARIO <> WHEB_USUARIO_PCK.GET_NM_USUARIO
           AND ( (DT_LIBERACAO IS NOT NULL AND DT_LIBERACAO::text <> '')
                  OR DT_LIBERACAO > DT_REFERENCIA_P );
  C_MATERIAL CURSOR FOR
    SELECT NR_SEQUENCIA,
           SUBSTR(OBTER_DESC_MATERIAL(CD_MATERIAL), 1, 255) DS_ITEM,
           'M'                                              IE_TIPO_ITEM,
           NR_ATENDIMENTO,
           CD_PESSOA_FISICA,
           HR_PRIM_HORARIO,
           DT_INICIO,
           'M'                                              IE_TIPO_ITEM_CPOE,
           CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  NULL  ELSE DT_SUSPENSAO END            DT_SUSPENSAO,
           CD_MATERIAL,
           NM_USUARIO,
           DT_LIBERACAO
    FROM   CPOE_MATERIAL
    WHERE  CPOE_REG_VALIDO_ATIVACAO(CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN                                     coalesce(DT_FIM_CIH, DT_FIM)  ELSE CPOE_OBTER_DATA_MAIOR(                                    DT_SUSPENSAO, DT_FIM) END ,
                  DT_INICIO, clock_timestamp()) = 'S'
           AND (DT_LIBERACAO IS NOT NULL AND DT_LIBERACAO::text <> '')
           AND IE_CONTROLE_TEMPO = 'N'
           AND coalesce(IE_MATERIAL, 'N') = 'N'
           AND NR_ATENDIMENTO = NR_ATENDIMENTO_P
           AND NM_USUARIO <> WHEB_USUARIO_PCK.GET_NM_USUARIO
           AND ( (DT_LIBERACAO IS NOT NULL AND DT_LIBERACAO::text <> '')
                  OR DT_LIBERACAO > DT_REFERENCIA_P )

UNION ALL

    SELECT NR_SEQUENCIA,
           SUBSTR(OBTER_DESC_MATERIAL(CD_MATERIAL), 1, 255) DS_ITEM,
           'SOL'                                            IE_TIPO_ITEM,
           NR_ATENDIMENTO,
           CD_PESSOA_FISICA,
           HR_PRIM_HORARIO,
           DT_INICIO,
           'M'                                              IE_TIPO_ITEM_CPOE,
           CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  NULL  ELSE DT_SUSPENSAO END            DT_SUSPENSAO,
           CD_MATERIAL,
           NM_USUARIO,
           DT_LIBERACAO
    FROM   CPOE_MATERIAL
    WHERE  CPOE_REG_VALIDO_ATIVACAO(CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN                                     coalesce(DT_FIM_CIH, DT_FIM)  ELSE CPOE_OBTER_DATA_MAIOR(                                    DT_SUSPENSAO, DT_FIM) END ,
                  DT_INICIO, clock_timestamp()) = 'S'
           AND (DT_LIBERACAO IS NOT NULL AND DT_LIBERACAO::text <> '')
           AND IE_CONTROLE_TEMPO = 'S'
           AND coalesce(IE_MATERIAL, 'N') = 'N'
           AND NR_ATENDIMENTO = NR_ATENDIMENTO_P
           AND NM_USUARIO <> WHEB_USUARIO_PCK.GET_NM_USUARIO
           AND ( (DT_LIBERACAO IS NOT NULL AND DT_LIBERACAO::text <> '')
                  OR DT_LIBERACAO > DT_REFERENCIA_P )
    
UNION ALL

    SELECT NR_SEQUENCIA,
           SUBSTR(OBTER_DESC_MATERIAL(CD_MATERIAL), 1, 255) DS_ITEM,
           'MAT'                                            IE_TIPO_ITEM,
           NR_ATENDIMENTO,
           CD_PESSOA_FISICA,
           HR_PRIM_HORARIO,
           DT_INICIO,
           'MA'                                             IE_TIPO_ITEM_CPOE,
           CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  NULL  ELSE DT_SUSPENSAO END            DT_SUSPENSAO,
           CD_MATERIAL,
           NM_USUARIO,
           DT_LIBERACAO
    FROM   CPOE_MATERIAL
    WHERE  CPOE_REG_VALIDO_ATIVACAO(CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  DT_FIM  ELSE CPOE_OBTER_DATA_MAIOR(                                    DT_SUSPENSAO, DT_FIM) END ,
                  DT_INICIO, clock_timestamp()) = 'S'
           AND (DT_LIBERACAO IS NOT NULL AND DT_LIBERACAO::text <> '')
           AND coalesce(IE_MATERIAL, 'N') = 'S'
           AND NR_ATENDIMENTO = NR_ATENDIMENTO_P
           AND NM_USUARIO <> WHEB_USUARIO_PCK.GET_NM_USUARIO
           AND ( (DT_LIBERACAO IS NOT NULL AND DT_LIBERACAO::text <> '')
                  OR DT_LIBERACAO > DT_REFERENCIA_P );
  C_PROCEDIMENTO CURSOR FOR
    SELECT NR_SEQUENCIA,
           SUBSTR(OBTER_DESC_PROC_INTERNO(NR_SEQ_PROC_INTERNO), 1, 255) DS_ITEM,
           'P'
           IE_TIPO_ITEM
    ,
           NR_ATENDIMENTO,
           CD_PESSOA_FISICA,
           HR_PRIM_HORARIO,
           DT_INICIO,
           'P'
    IE_TIPO_ITEM_CPOE,
           CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  NULL  ELSE DT_SUSPENSAO END
           DT_SUSPENSAO
    ,
           NULL
           CD_MATERIAL
    ,
           NM_USUARIO,
           DT_LIBERACAO
    FROM   CPOE_PROCEDIMENTO
    WHERE  CPOE_REG_VALIDO_ATIVACAO(CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  DT_FIM  ELSE CPOE_OBTER_DATA_MAIOR(                                    DT_SUSPENSAO, DT_FIM) END ,
                  DT_INICIO, clock_timestamp()) = 'S'
           AND NR_ATENDIMENTO = NR_ATENDIMENTO_P
           AND NM_USUARIO <> WHEB_USUARIO_PCK.GET_NM_USUARIO
           AND ( (DT_LIBERACAO IS NOT NULL AND DT_LIBERACAO::text <> '')
                  OR DT_LIBERACAO > DT_REFERENCIA_P );
  C_GASOTERAPIA CURSOR FOR
    SELECT NR_SEQUENCIA,
           SUBSTR(OBTER_DESC_GAS(NR_SEQ_GAS), 1, 255) DS_ITEM,
           'O'                                        IE_TIPO_ITEM,
           NR_ATENDIMENTO,
           CD_PESSOA_FISICA,
           HR_PRIM_HORARIO,
           DT_INICIO,
           'G'                                        IE_TIPO_ITEM_CPOE,
           CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  NULL  ELSE DT_SUSPENSAO END      DT_SUSPENSAO,
           NULL                                       CD_MATERIAL,
           NM_USUARIO,
           DT_LIBERACAO
    FROM   CPOE_GASOTERAPIA
    WHERE  CPOE_REG_VALIDO_ATIVACAO(CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  DT_FIM  ELSE CPOE_OBTER_DATA_MAIOR(                                    DT_SUSPENSAO, DT_FIM) END ,
                  DT_INICIO, clock_timestamp()) = 'S'
           AND NR_ATENDIMENTO = NR_ATENDIMENTO_P
           AND NM_USUARIO <> WHEB_USUARIO_PCK.GET_NM_USUARIO
           AND ( (DT_LIBERACAO IS NOT NULL AND DT_LIBERACAO::text <> '')
                  OR DT_LIBERACAO > DT_REFERENCIA_P );
  C_RECOMENDACAO CURSOR FOR
    SELECT NR_SEQUENCIA,
           SUBSTR(OBTER_DESC_RECOMENDACAO(CD_RECOMENDACAO), 1, 255) DS_ITEM,
           'R'                                                      IE_TIPO_ITEM
           ,
           NR_ATENDIMENTO,
           CD_PESSOA_FISICA,
           HR_PRIM_HORARIO,
           DT_INICIO,
           'R'
    IE_TIPO_ITEM_CPOE,
           CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  NULL  ELSE DT_SUSPENSAO END                    DT_SUSPENSAO
           ,
           NULL
           CD_MATERIAL,
           NM_USUARIO,
           DT_LIBERACAO
    FROM   CPOE_RECOMENDACAO
    WHERE  CPOE_REG_VALIDO_ATIVACAO(CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  DT_FIM  ELSE CPOE_OBTER_DATA_MAIOR(                                    DT_SUSPENSAO, DT_FIM) END ,
                  DT_INICIO, clock_timestamp()) = 'S'
           AND NR_ATENDIMENTO = NR_ATENDIMENTO_P
           AND NM_USUARIO <> WHEB_USUARIO_PCK.GET_NM_USUARIO
           AND ( (DT_LIBERACAO IS NOT NULL AND DT_LIBERACAO::text <> '')
                  OR DT_LIBERACAO > DT_REFERENCIA_P );
  C_HEMOTERAPIA CURSOR FOR
    SELECT NR_SEQUENCIA,
           SUBSTR(CPOE_OBTER_DESC_INFO_HEMOTE(NR_SEQUENCIA), 1, 255) DS_ITEM,
           'HM'
           IE_TIPO_ITEM,
           NR_ATENDIMENTO,
           CD_PESSOA_FISICA,
           TO_CHAR(DT_INICIO, 'HH24:MI')
           HR_PRIM_HORARIO
    ,
           DT_INICIO,
           'H'
    IE_TIPO_ITEM_CPOE,
           CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  NULL  ELSE DT_SUSPENSAO END
           DT_SUSPENSAO,
           NULL                                                      CD_MATERIAL
           ,
           NM_USUARIO,
           DT_LIBERACAO
    FROM   CPOE_HEMOTERAPIA
    WHERE  CPOE_REG_VALIDO_ATIVACAO(CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  DT_FIM  ELSE CPOE_OBTER_DATA_MAIOR(                                    DT_SUSPENSAO, DT_FIM) END ,
                  DT_INICIO, clock_timestamp()) = 'S'
           AND NR_ATENDIMENTO = NR_ATENDIMENTO_P
           AND NM_USUARIO <> WHEB_USUARIO_PCK.GET_NM_USUARIO
           AND ( (DT_LIBERACAO IS NOT NULL AND DT_LIBERACAO::text <> '')
                  OR DT_LIBERACAO > DT_REFERENCIA_P );
  C_DIALISE CURSOR FOR
    SELECT NR_SEQUENCIA,
           SUBSTR(CPOE_OBTER_DESC_DIALISE(IE_TIPO_DIALISE, NR_SEQ_PROTOCOLO,
                  DT_LIB_SUSPENSAO,
                         DT_SUSPENSAO, QT_FLUXO_SANGUE, QT_HORA_MIN_SESSAO, 'N',
                  IE_HEMODIALISE,
                         IE_TIPO_PERITONEAL, QT_VOLUME_CICLO,
                  QT_HORA_MIN_DURACAO,
                  IE_CATEGORIA), 1, 255)          DS_ITEM,
           'DI'                                   IE_TIPO_ITEM,
           NR_ATENDIMENTO,
           CD_PESSOA_FISICA,
           TO_CHAR(DT_INICIO, 'HH24:MI')          HR_PRIM_HORARIO,
           DT_INICIO,
           'D'                                    IE_TIPO_ITEM_CPOE,
           CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  NULL  ELSE DT_SUSPENSAO END  DT_SUSPENSAO,
           NULL                                   CD_MATERIAL,
           NM_USUARIO,
           DT_LIBERACAO
    FROM   CPOE_DIALISE
    WHERE  CPOE_REG_VALIDO_ATIVACAO(CASE WHEN coalesce(DT_LIB_SUSPENSAO::text, '') = '' THEN  DT_FIM  ELSE CPOE_OBTER_DATA_MAIOR(                                    DT_SUSPENSAO, DT_FIM) END ,
                  DT_INICIO, clock_timestamp()) = 'S'
           AND NR_ATENDIMENTO = NR_ATENDIMENTO_P
           AND NM_USUARIO <> WHEB_USUARIO_PCK.GET_NM_USUARIO
           AND ( (DT_LIBERACAO IS NOT NULL AND DT_LIBERACAO::text <> '')
                  OR DT_LIBERACAO > DT_REFERENCIA_P );
  PRM_RETURN_CPOE         smallint := 0;
  PRM_RETURN_DIETA        smallint := 0;
  PRM_RETURN_MATERIAL     smallint := 0;
  PRM_RETURN_PROCEDIMENTO smallint := 0;
  PRM_RETURN_GASOTERAPIA  smallint := 0;
  PRM_RETURN_RECOMENDACAO smallint := 0;
  PRM_RETURN_HEMOTERAPIA  smallint := 0;
BEGIN
    IF TP_CPOE_P = 'D' THEN
      FOR REG_DIETA IN C_DIETA LOOP
          PRM_RETURN_DIETA := 1;

          RETURN 1;
      END LOOP;
    END IF;

    --
    --  MATERIAL AND MEDICINE
    IF TP_CPOE_P = 'M' THEN
      FOR REG_MATERIAL IN C_MATERIAL LOOP
          PRM_RETURN_MATERIAL := 1;

          PRM_RETURN_CPOE := 1;
      END LOOP;
    END IF;

    IF TP_CPOE_P = 'P' THEN
      FOR REG_PROCEDIMENTO IN C_PROCEDIMENTO LOOP
          PRM_RETURN_PROCEDIMENTO := 1;

          PRM_RETURN_CPOE := 1;
      END LOOP;
    END IF;

    IF TP_CPOE_P = 'G' THEN
      FOR REG_GASOTERAPIA IN C_GASOTERAPIA LOOP
          PRM_RETURN_GASOTERAPIA := 1;

          PRM_RETURN_CPOE := 1;
      END LOOP;
    END IF;

    IF TP_CPOE_P = 'R' THEN
      FOR REG_RECOMENDACAO IN C_RECOMENDACAO LOOP
          PRM_RETURN_RECOMENDACAO := 1;

          PRM_RETURN_CPOE := 1;
      END LOOP;
    END IF;

    IF TP_CPOE_P = 'H' THEN
      FOR REG_HEMOTERAPIA IN C_HEMOTERAPIA LOOP
          PRM_RETURN_HEMOTERAPIA := 1;

          PRM_RETURN_CPOE := 1;
      END LOOP;
    END IF;

    RETURN PRM_RETURN_CPOE;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_get_simultaneous_presc ( TP_CPOE_P text, DT_REFERENCIA_P timestamp, NR_ATENDIMENTO_P bigint) FROM PUBLIC;

