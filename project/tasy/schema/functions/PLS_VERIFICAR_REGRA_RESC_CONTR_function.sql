-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_verificar_regra_resc_contr ( nr_seq_contrato_p pls_contrato.nr_sequencia%type, nr_seq_intercambio_p pls_intercambio.nr_sequencia%type default null) RETURNS varchar AS $body$
DECLARE


ie_rescindir_contrato_w		varchar(1);
ie_pf_pj_w			varchar(2);
ie_rescindir_contrato_benef_w	pls_parametros.ie_rescindir_contrato_benef%type;
ie_rescindir_contr_pj_benef_w	pls_parametros.ie_rescindir_contrato_pj_benef%type;


BEGIN

if	((nr_seq_contrato_p IS NOT NULL AND nr_seq_contrato_p::text <> '') or (nr_seq_intercambio_p IS NOT NULL AND nr_seq_intercambio_p::text <> '')) then
	if (nr_seq_contrato_p IS NOT NULL AND nr_seq_contrato_p::text <> '') then
		select	CASE WHEN coalesce(cd_cgc_estipulante::text, '') = '' THEN  'PF'  ELSE 'PJ' END
		into STRICT	ie_pf_pj_w
		from	pls_contrato
		where	nr_sequencia = nr_seq_contrato_p;
	else
		select	CASE WHEN coalesce(cd_cgc::text, '') = '' THEN  'PF'  ELSE 'PJ' END
		into STRICT	ie_pf_pj_w
		from	pls_intercambio
		where	nr_sequencia = nr_seq_intercambio_p;
	end if;
	
	select	coalesce(max(ie_rescindir_contrato_benef), 'N'),
		max(ie_rescindir_contrato_pj_benef)
	into STRICT	ie_rescindir_contrato_benef_w,
		ie_rescindir_contr_pj_benef_w
	from	pls_parametros
	where	cd_estabelecimento = wheb_usuario_pck.get_cd_estabelecimento;
	
	if (ie_pf_pj_w = 'PF') then
		ie_rescindir_contrato_w	:= ie_rescindir_contrato_benef_w;
	else
		ie_rescindir_contrato_w	:= coalesce(ie_rescindir_contr_pj_benef_w, ie_rescindir_contrato_benef_w);
	end if;
else
	ie_rescindir_contrato_w	:= 'N';
end if;

return	ie_rescindir_contrato_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_verificar_regra_resc_contr ( nr_seq_contrato_p pls_contrato.nr_sequencia%type, nr_seq_intercambio_p pls_intercambio.nr_sequencia%type default null) FROM PUBLIC;

