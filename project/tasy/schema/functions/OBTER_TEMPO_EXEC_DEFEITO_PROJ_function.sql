-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_tempo_exec_defeito_proj ( NR_SEQ_PROJ_CRON_ETAPA_P bigint, CD_SETOR_ATENDIMENTO_P bigint DEFAULT -1, IE_ADERENCIA_P text DEFAULT '0') RETURNS bigint AS $body$
DECLARE

 PR_RETORNO_W	bigint := 0;

 OS_ADERENCIA_1 bigint := -1;
 OS_ADERENCIA_2 bigint := -1;
 OS_ADERENCIA_3 bigint := -1;
 OS_ADERENCIA_4 bigint := -1;
 OS_ADERENCIA_5 bigint := -1;

BEGIN
  IF IE_ADERENCIA_P = '0' THEN
    SELECT coalesce(OBTER_OS_ADERENCIA_PROJ(NR_SEQ_PROJ_CRON_ETAPA_P, '1'), -1) INTO STRICT OS_ADERENCIA_1;
    SELECT coalesce(OBTER_OS_ADERENCIA_PROJ(NR_SEQ_PROJ_CRON_ETAPA_P, '2'), -1) INTO STRICT OS_ADERENCIA_2;
    SELECT coalesce(OBTER_OS_ADERENCIA_PROJ(NR_SEQ_PROJ_CRON_ETAPA_P, '3'), -1) INTO STRICT OS_ADERENCIA_3;
    SELECT coalesce(OBTER_OS_ADERENCIA_PROJ(NR_SEQ_PROJ_CRON_ETAPA_P, '4'), -1) INTO STRICT OS_ADERENCIA_4;
    SELECT coalesce(OBTER_OS_ADERENCIA_PROJ(NR_SEQ_PROJ_CRON_ETAPA_P, '5'), -1) INTO STRICT OS_ADERENCIA_5;
  ELSE
    SELECT coalesce(OBTER_OS_ADERENCIA_PROJ(NR_SEQ_PROJ_CRON_ETAPA_P, IE_ADERENCIA_P), -1) INTO STRICT OS_ADERENCIA_1;
  END IF;

  BEGIN
    SELECT coalesce(SUM(RETORNA_TEMPO_EXEC_OS_SETOR(OS.NR_SEQUENCIA, CD_SETOR_ATENDIMENTO_P)),0)
      INTO STRICT PR_RETORNO_W
      FROM MAN_ORDEM_SERVICO OS
     WHERE OS.NR_SEQ_ORIGEM IN (OS_ADERENCIA_1, OS_ADERENCIA_2, OS_ADERENCIA_3, OS_ADERENCIA_4, OS_ADERENCIA_5);
 EXCEPTION
 	WHEN no_data_found THEN
 		PR_RETORNO_W := 0;
 	WHEN OTHERS THEN
 		PR_RETORNO_W := 0;
	END;

RETURN	PR_RETORNO_W;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_tempo_exec_defeito_proj ( NR_SEQ_PROJ_CRON_ETAPA_P bigint, CD_SETOR_ATENDIMENTO_P bigint DEFAULT -1, IE_ADERENCIA_P text DEFAULT '0') FROM PUBLIC;

