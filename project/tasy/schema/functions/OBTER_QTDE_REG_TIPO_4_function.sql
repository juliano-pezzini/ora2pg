-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_qtde_reg_tipo_4 (nr_seq_protocolo_p bigint, nr_interno_conta_p bigint) RETURNS bigint AS $body$
DECLARE


qt_reg_w	bigint:= 0;


BEGIN

select 	coalesce(sum(a.qt_reg),0)
into STRICT	qt_reg_W
from (
	SELECT	count(*) qt_reg
	FROM w_interf_conta_cab c, w_interf_conta_header a, w_interf_conta_item b
LEFT OUTER JOIN regra_honorario z ON (b.ie_responsavel_credito = z.cd_regra)
WHERE b.nr_seq_protocolo	= a.nr_seq_protocolo and b.nr_seq_protocolo	= c.nr_seq_protocolo and b.nr_interno_conta	= c.nr_interno_conta and coalesce(b.nr_seq_proc_pacote,b.nr_seq_item) = b.nr_seq_item  and coalesce(z.ie_entra_conta,'S') = 'S' and b.ie_tipo_item		  = 1 and b.qt_item		 <> 0 AND somente_numero(B.IE_EMITE_CONTA) <> 71 and b.nr_seq_protocolo = nr_seq_protocolo_p and b.nr_interno_conta = nr_interno_conta_p AND (B.ie_total_interf <> 4 OR coalesce(B.IE_TOTAL_INTERF,0) = 0) and b.cd_item in (SELECT 	x.cd_procedimento
			     from 	estrutura_procedimento_v x
			     where 	x.cd_area_procedimento in (1,4,11,13))
	having sum(b.qt_item) > 0
	
union all

	select	count(*) qt_reg
	FROM w_interf_conta_cab c, w_interf_conta_header a, w_interf_conta_item b
LEFT OUTER JOIN regra_honorario z ON (b.ie_responsavel_credito = z.cd_regra)
WHERE b.nr_seq_protocolo	= a.nr_seq_protocolo and b.nr_seq_protocolo	= c.nr_seq_protocolo and b.nr_interno_conta	= c.nr_interno_conta and coalesce(b.nr_seq_proc_pacote,b.nr_seq_item) = b.nr_seq_item  and coalesce(z.ie_entra_conta,'S') = 'S' and b.qt_item			<> 0 AND coalesce(b.ie_tipo_item,0) <> 2 and b.nr_seq_protocolo = nr_seq_protocolo_p and b.nr_interno_conta = nr_interno_conta_p AND somente_numero(B.IE_EMITE_CONTA) <> 71 AND (B.ie_total_interf <> 4 OR coalesce(B.IE_TOTAL_INTERF,0) = 0) and b.cd_item not in (select x.cd_procedimento
			         from 	estrutura_procedimento_v x
			         where 	x.cd_area_procedimento in (1,4,11,13)
				 AND 	b.cd_item NOT IN (SELECT x.cd_procedimento
  					       	     	 FROM  estrutura_procedimento_v x
  						     	 WHERE x.cd_grupo_proc IN (7,4)))
	having 	sum(b.qt_item) > 0
	 
union all

	SELECT	count(*) qt_reg
	FROM w_interf_conta_cab c, w_interf_conta_header a, w_interf_conta_item b
LEFT OUTER JOIN regra_honorario z ON (b.ie_responsavel_credito = z.cd_regra)
WHERE b.nr_seq_protocolo	= a.nr_seq_protocolo and b.nr_seq_protocolo	= c.nr_seq_protocolo and b.nr_interno_conta	= c.nr_interno_conta and coalesce(b.nr_seq_proc_pacote,b.nr_seq_item) = b.nr_seq_item  and coalesce(z.ie_entra_conta,'S') = 'S' and b.qt_item			<> 0 AND somente_numero(B.IE_EMITE_CONTA) <> 71 and b.nr_seq_protocolo = nr_seq_protocolo_p and b.nr_interno_conta = nr_interno_conta_p AND (B.ie_total_interf <> 4 OR coalesce(B.IE_TOTAL_INTERF,0) = 0) and (coalesce(b.ie_tipo_item,0) = 2)
	having 	sum(b.qt_item) > 0
	 ) a;

return qt_reg_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_qtde_reg_tipo_4 (nr_seq_protocolo_p bigint, nr_interno_conta_p bigint) FROM PUBLIC;

