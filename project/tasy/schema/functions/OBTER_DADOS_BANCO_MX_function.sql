-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_banco_mx ( nr_seq_retorno_p bigint, nr_seq_ret_item_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


ds_retorno_w   varchar(255);



BEGIN
-- Informações do Banco da asseguradora
	if (ie_opcao_p = 'RFC')then

		select	max(fis_obter_rfc_convenio(a.cd_convenio,'RFC')) --RFC do banco da asseguradora
		into STRICT	ds_retorno_w
		from	CONVENIO_RECEB a,
			banco_estabelecimento_v b,
			agencia_bancaria c,
			convenio_ret_receb d,
			convenio_retorno e,
			convenio_retorno_item f
		where 	a.NR_SEQ_CONTA_BANCO 	= b.nr_sequencia
		and 	b.cd_banco		= c.cd_banco
		and	b.cd_agencia_bancaria 	= c.cd_agencia_bancaria
		and	f.nr_seq_retorno 	= e.nr_sequencia
		and	a.nr_sequencia 		= d.nr_seq_receb
		and	f.nr_seq_retorno        = nr_seq_retorno_p
		and	f.nr_sequencia		= nr_seq_ret_item_p
		and	e.nr_sequencia 		= d.nr_seq_retorno;

	elsif (ie_opcao_p = 'B') then

		select	max(fis_obter_rfc_convenio(a.cd_convenio,'NBANCO')) -- nome do banco da asseguradora
		into STRICT	ds_retorno_w
		from	CONVENIO_RECEB a,
			banco_estabelecimento_v b,
			agencia_bancaria c,
			convenio_ret_receb d,
			convenio_retorno e,
			convenio_retorno_item f
		where 	a.NR_SEQ_CONTA_BANCO 	= b.nr_sequencia
		and 	b.cd_banco		= c.cd_banco
		and	b.cd_agencia_bancaria 	= c.cd_agencia_bancaria
		and	f.nr_seq_retorno 	= e.nr_sequencia
		and	a.nr_sequencia 		= d.nr_seq_receb
		and	f.nr_seq_retorno        = nr_seq_retorno_p
		and	f.nr_sequencia		= nr_seq_ret_item_p
		and	e.nr_sequencia 		= d.nr_seq_retorno;

	elsif (ie_opcao_p = 'C') then

		select	max(fis_obter_rfc_convenio(a.cd_convenio,'CONTA')) -- conta do banco da asseguradora
		into STRICT	ds_retorno_w
		from	CONVENIO_RECEB a,
			banco_estabelecimento_v b,
			agencia_bancaria c,
			convenio_ret_receb d,
			convenio_retorno e,
			convenio_retorno_item f
		where 	a.NR_SEQ_CONTA_BANCO 	= b.nr_sequencia
		and 	b.cd_banco		= c.cd_banco
		and	b.cd_agencia_bancaria 	= c.cd_agencia_bancaria
		and	f.nr_seq_retorno 	= e.nr_sequencia
		and	a.nr_sequencia 		= d.nr_seq_receb
		and	f.nr_seq_retorno        = nr_seq_retorno_p
		and	f.nr_sequencia		= nr_seq_ret_item_p
		and	e.nr_sequencia 		= d.nr_seq_retorno;

-- Informações do banco do hospital
	elsif (ie_opcao_p = 'CONTAB')then -- conta do banco do hospital
		select	max(b.CD_CONTA)
		into STRICT	ds_retorno_w
		from	CONVENIO_RECEB a,
			banco_estabelecimento_v b,
			agencia_bancaria c,
			convenio_ret_receb d,
			convenio_retorno e,
			convenio_retorno_item f
		where 	a.NR_SEQ_CONTA_BANCO 	= b.nr_sequencia
		and 	b.cd_banco		= c.cd_banco
		and	b.cd_agencia_bancaria 	= c.cd_agencia_bancaria
		and	f.nr_seq_retorno 	= e.nr_sequencia
		and	a.nr_sequencia 		= d.nr_seq_receb
		and	f.nr_seq_retorno        = nr_seq_retorno_p
		and	f.nr_sequencia		= nr_seq_ret_item_p
		and	e.nr_sequencia 		= d.nr_seq_retorno;

	elsif (ie_opcao_p = 'RFCB')then -- rfc do banco do hospital
		select	max(OBTER_DADOS_PF_PJ(null,c.cd_cgc_agencia,'RFC'))
		into STRICT	ds_retorno_w
		from	CONVENIO_RECEB a,
			banco_estabelecimento_v b,
			agencia_bancaria c,
			convenio_ret_receb d,
			convenio_retorno e,
			convenio_retorno_item f
		where 	a.NR_SEQ_CONTA_BANCO 	= b.nr_sequencia
		and 	b.cd_banco		= c.cd_banco
		and	b.cd_agencia_bancaria 	= c.cd_agencia_bancaria
		and	f.nr_seq_retorno 	= e.nr_sequencia
		and	a.nr_sequencia 		= d.nr_seq_receb
		and	f.nr_seq_retorno        = nr_seq_retorno_p
		and	f.nr_sequencia		= nr_seq_ret_item_p
		and	e.nr_sequencia 		= d.nr_seq_retorno;

	end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_banco_mx ( nr_seq_retorno_p bigint, nr_seq_ret_item_p bigint, ie_opcao_p text) FROM PUBLIC;

