-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION man_obter_estado_versao (cd_versao_p text) RETURNS varchar AS $body$
DECLARE


ie_tipo_versao_w	varchar(100);
cd_versao_w		varchar(20);
ie_controle_proc_w	smallint := 0;
dt_versao_w			timestamp;

C01 CURSOR FOR
SELECT	cd_versao,
dt_versao
from (
	SELECT	cd_versao cd_versao,
		dt_versao dt_versao
	from	aplicacao_tasy_versao
	where	cd_aplicacao_tasy = 'Tasy'
	and	coalesce(IE_VERSAO_OFICIAL, 'N') = 'S'
	order by dt_versao desc) alias1
where (clock_timestamp() - dt_versao) > 3  LIMIT 3;


BEGIN

	open C01;
	loop
	fetch C01 into
		cd_versao_w,
		dt_versao_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */
		begin

		ie_controle_proc_w := ie_controle_proc_w + 1;

		if (cd_versao_w = cd_versao_p) then
			begin
			-- Se entrar nessa condição é a última versão gerada e ainda não foi liberada para os clientes.
			if (ie_controle_proc_w = 1) then
				begin

				ie_tipo_versao_w := obter_desc_expressao(778072);

				end;
			-- Se entrar nessa condição é a versão que está disponível na extranet
			elsif (ie_controle_proc_w = 2) then
				begin

				ie_tipo_versao_w := obter_desc_expressao(778074);

				end;
			-- Ultima versão oficial que recebera manutenção. Já está fora da extranet
			elsif (ie_controle_proc_w = 3) then
				begin

				ie_tipo_versao_w := obter_desc_expressao(778076);

				end;
			end if;

			end;
		end if;


		end;
	end loop;
	close C01;

return	ie_tipo_versao_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION man_obter_estado_versao (cd_versao_p text) FROM PUBLIC;

