-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION consiste_dispensacao_ap_lote ( nr_seq_lote bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE

 
/* 
ie_opcao_p: 
C - Consistencias; 
A - Alta; 
*/
 
 
nr_prescricao_w		bigint;
cd_setor_atual_w	integer;
cd_setor_lote_w		integer;
ie_alta_w		varchar(1);
ie_inconsistente_w	varchar(1) := 'N';


BEGIN 
select	nr_prescricao 
into STRICT	nr_prescricao_w 
from	ap_lote 
where	nr_sequencia = nr_seq_lote;
 
select	cd_setor_atendimento 
into STRICT	cd_setor_lote_w 
from	ap_lote 
where	nr_sequencia = nr_seq_lote;
 
cd_setor_atual_w := obter_setor_atendimento(obter_dados_prescricao(nr_prescricao_w,'A'));
ie_alta_w    := obter_se_atendimento_alta(obter_atendimento_prescr(nr_prescricao_w));
 
if	((ie_opcao_p = 'C') and ((cd_setor_atual_w <> cd_setor_lote_w) or (ie_alta_w = 'S'))) then 
		ie_inconsistente_w := 'S';
elsif	(ie_opcao_p = 'A' AND ie_alta_w = 'S') then 
		ie_inconsistente_w := 'S';
end if;
 
return	ie_inconsistente_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION consiste_dispensacao_ap_lote ( nr_seq_lote bigint, ie_opcao_p text) FROM PUBLIC;

