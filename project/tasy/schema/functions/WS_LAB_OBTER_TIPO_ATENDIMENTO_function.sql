-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION ws_lab_obter_tipo_atendimento (nr_atendimento_p bigint ) RETURNS varchar AS $body$
DECLARE

 
ds_retorno_w			varchar(5) := '';
ie_tipo_convenio_w		smallint;


BEGIN 
 
 
if (nr_atendimento_p > 0) then 
 
	select 	ie_tipo_convenio 
	into STRICT	ie_tipo_convenio_w 
	from	convenio 
	where 	cd_convenio =	obter_convenio_atendimento(nr_atendimento_p);
	 
	 
	if (ie_tipo_convenio_w = 1) then --Particular 
	 
		ds_retorno_w := 'PA';
	 
	elsif (ie_tipo_convenio_w = 2) then --Convênio 
		 
		ds_retorno_w := 'CV';
		 
	elsif ((ie_tipo_convenio_w = 3) and (Obter_Dados_Atendimento(nr_atendimento_p, 'TA') = 7 )) then --SUS - Tipo Externo 
 
		ds_retorno_w := 'SE';
		 
	elsif (ie_tipo_convenio_w = 5) then --Próprio 
		 
		ds_retorno_w := 'PA';
		 
	elsif (ie_tipo_convenio_w = 4) then --Sem Remuneração / Filantrópicos 
		 
		ds_retorno_w := 'SC';
			 
	else 
	 
		ds_retorno_w := 'CV';
			 
	end if;	
 
end if;
 
 
return	ds_retorno_w;
 
end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION ws_lab_obter_tipo_atendimento (nr_atendimento_p bigint ) FROM PUBLIC;

