-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_cod_dia_semana (dt_referencia_p timestamp) RETURNS varchar AS $body$
DECLARE


cd_dia_semana_w	smallint	:= 0;

/*
	Favor não alterar mais esta Rotina sem antes realizar uma analise de impacto, pois é utilizada em todas as Agendas, e impacta diretamente a geração de horários. OS 1355737
*/
BEGIN
if (dt_referencia_p IS NOT NULL AND dt_referencia_p::text <> '') then
	if (philips_param_pck.get_nr_seq_idioma = 2) then -- Espanhol  - México(MX)
	select	CASE WHEN (to_char(dt_referencia_p, 'd'))::numeric =1 THEN  2 WHEN (to_char(dt_referencia_p, 'd'))::numeric =2 THEN  3 WHEN (to_char(dt_referencia_p, 'd'))::numeric =3 THEN  4 WHEN (to_char(dt_referencia_p, 'd'))::numeric =4 THEN  5 WHEN (to_char(dt_referencia_p, 'd'))::numeric =5 THEN  6 WHEN (to_char(dt_referencia_p, 'd'))::numeric =6 THEN  7 WHEN (to_char(dt_referencia_p, 'd'))::numeric =7 THEN  1 END
		into STRICT	cd_dia_semana_w
		;
	else
		select	CASE WHEN pkg_date_utils.get_weekday(dt_referencia_p)=1 THEN  1 WHEN pkg_date_utils.get_weekday(dt_referencia_p)=2 THEN  2 WHEN pkg_date_utils.get_weekday(dt_referencia_p)=3 THEN  3 WHEN pkg_date_utils.get_weekday(dt_referencia_p)=4 THEN  4 WHEN pkg_date_utils.get_weekday(dt_referencia_p)=5 THEN  5 WHEN pkg_date_utils.get_weekday(dt_referencia_p)=6 THEN  6 WHEN pkg_date_utils.get_weekday(dt_referencia_p)=7 THEN  7 END
		into STRICT	cd_dia_semana_w
		;
	end if;
end if;

return	cd_dia_semana_w;
END	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_cod_dia_semana (dt_referencia_p timestamp) FROM PUBLIC;

