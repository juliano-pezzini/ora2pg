-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_estoque_minimo_derivado (nr_seq_derivado_p bigint, Ie_fator_rh_p text, ie_tipo_sanguineo_p text, ie_opcao_p bigint ) RETURNS varchar AS $body$
DECLARE

resultado_w		varchar(40);
qt_estoque_minimo_w	bigint;


c01 CURSOR FOR
	SELECT 	coalesce(a.qt_estoque_minimo,0)
	from   	san_derivado_estoque a
	where  	a.nr_seq_derivado = nr_seq_derivado_p
	and (coalesce(a.ie_fator_rh, ie_fator_rh_p) 		= ie_fator_rh_p or coalesce(ie_fator_rh_p::text, '') = '')
	and (coalesce(a.ie_tipo_sanguineo, ie_tipo_sanguineo_p) = ie_tipo_sanguineo_p or coalesce(ie_tipo_sanguineo_p::text, '') = '')
	order by coalesce(nr_seq_derivado_p,0), coalesce(ie_fator_rh_p,0), coalesce(ie_tipo_sanguineo_p,0);


BEGIN
OPEN C01;
LOOP
FETCH C01 into
		qt_estoque_minimo_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
END LOOP;
CLOSE C01;

resultado_w :=	qt_estoque_minimo_w;

return resultado_w;


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_estoque_minimo_derivado (nr_seq_derivado_p bigint, Ie_fator_rh_p text, ie_tipo_sanguineo_p text, ie_opcao_p bigint ) FROM PUBLIC;

