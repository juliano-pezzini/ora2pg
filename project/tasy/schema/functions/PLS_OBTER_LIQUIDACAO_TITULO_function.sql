-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_liquidacao_titulo ( nr_seq_proc_rec_p pls_conta_rec_resumo_item.nr_seq_proc_rec%type, nr_seq_mat_rec_p pls_conta_rec_resumo_item.nr_seq_mat_rec%type) RETURNS varchar AS $body$
DECLARE

 
ds_liquidacao_w		varchar(255);


BEGIN 
if (nr_seq_proc_rec_p IS NOT NULL AND nr_seq_proc_rec_p::text <> '') then 
 
	select 	max(titulo.dt_liquidacao) 
	into STRICT	ds_liquidacao_w 
	from	pls_pagamento_prestador  pgto,  
		pls_pag_prest_vencimento  venc, 
		pls_conta_rec_resumo_item resumo, 
		titulo_pagar   	  titulo 
	where 	resumo.nr_seq_proc_rec = nr_seq_proc_rec_p 
	and 	pgto.nr_seq_lote = resumo.nr_seq_lote_pgto 
	and	pgto.nr_seq_prestador = resumo.nr_seq_prestador_pgto 
	and	coalesce(pgto.ie_cancelamento::text, '') = '' 
	and 	venc.nr_seq_pag_prestador = pgto.nr_sequencia 
	and 	titulo.nr_titulo = venc.nr_titulo;
 
elsif (nr_seq_mat_rec_p IS NOT NULL AND nr_seq_mat_rec_p::text <> '') then 
 
	select 	max(titulo.dt_liquidacao) 
	into STRICT	ds_liquidacao_w 
	from	pls_pagamento_prestador  pgto,  
		pls_pag_prest_vencimento  venc, 
		pls_conta_rec_resumo_item resumo, 
		titulo_pagar   	  titulo 
	where 	resumo.nr_seq_mat_rec = nr_seq_mat_rec_p 
	and 	pgto.nr_seq_lote = resumo.nr_seq_lote_pgto 
	and	pgto.nr_seq_prestador = resumo.nr_seq_prestador_pgto 
	and	coalesce(pgto.ie_cancelamento::text, '') = '' 
	and 	venc.nr_seq_pag_prestador = pgto.nr_sequencia 
	and 	titulo.nr_titulo = venc.nr_titulo;
end if;
 
return	ds_liquidacao_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_liquidacao_titulo ( nr_seq_proc_rec_p pls_conta_rec_resumo_item.nr_seq_proc_rec%type, nr_seq_mat_rec_p pls_conta_rec_resumo_item.nr_seq_mat_rec%type) FROM PUBLIC;

