-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_ocupacao_setor (cd_estabelecimento_p bigint, cd_setor_atendimento_p bigint, dt_ano_p text, dt_mes_p text, dt_inicial_p timestamp, dt_final_p timestamp) RETURNS varchar AS $body$
DECLARE


pr_ocupacao_w	varchar(20);


BEGIN

select	(dividir(sum(nr_leitos_ocupados) * 100, sum(nr_unidades_setor)))::numeric  pr_ocupacao
into STRICT	pr_ocupacao_w
from	eis_ocupacao_setor_v
where	dt_referencia between trunc(dt_inicial_p,'year') and dt_final_p
and	to_char(TRUNC(dt_referencia,'MONTH'),'yyyy') = dt_ano_p
and	((cd_estabelecimento	= cd_estabelecimento_p)	 or (coalesce(cd_estabelecimento_p,0)    = 0))
and	((cd_setor_atendimento	= cd_setor_atendimento_p) or (coalesce(cd_setor_atendimento_p,0) = 0))
and	ie_periodo	= 'D'
and	IE_OCUP_HOSPITALAR = 'S'
and	cd_classif_setor	= 4
and	to_char(TRUNC(dt_referencia,'MONTH'),'mm') = dt_mes_p
group by TRUNC(dt_referencia,'MONTH');

return	pr_ocupacao_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_ocupacao_setor (cd_estabelecimento_p bigint, cd_setor_atendimento_p bigint, dt_ano_p text, dt_mes_p text, dt_inicial_p timestamp, dt_final_p timestamp) FROM PUBLIC;

