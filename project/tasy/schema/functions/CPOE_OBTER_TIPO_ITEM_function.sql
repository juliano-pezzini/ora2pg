-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cpoe_obter_tipo_item ( nm_tabela_p text, nr_sequencia_p cpoe_dieta.nr_sequencia%type, ie_tipo_dieta_p cpoe_dieta.ie_tipo_dieta%type default null, ie_controle_tempo_p cpoe_material.ie_controle_tempo%type default null, ie_material_p cpoe_material.ie_material%type default null) RETURNS varchar AS $body$
DECLARE


ie_tipo_item_w		varchar(255);
ie_tipo_dieta_w		cpoe_dieta.ie_tipo_dieta%type;
ie_material_w		cpoe_material.ie_material%type;
ie_controle_tempo_w	cpoe_material.ie_controle_tempo%type;


BEGIN

if (nm_tabela_p	= 'CPOE_PROCEDIMENTO') then
	ie_tipo_item_w	:= 'P';
elsif (nm_tabela_p	= 'CPOE_DIETA') then
	begin
		if (coalesce(ie_tipo_dieta_p::text, '') = '') then
			select	max(ie_tipo_dieta)
			into STRICT	ie_tipo_dieta_w
			from	cpoe_dieta
			where	nr_sequencia	= nr_sequencia_p;
		else
			ie_tipo_dieta_w := ie_tipo_dieta_p;
		end if;

		case	ie_tipo_dieta_w
			when 'O' then
				ie_tipo_item_w	:= 'D';
			when 'J' then
				ie_tipo_item_w	:= 'J';
			when 'E' then
				ie_tipo_item_w	:= 'SNE';
			when 'L' then
				ie_tipo_item_w	:= 'LD';
			when 'S' then
				ie_tipo_item_w	:= 'S';
			when 'P' then
				ie_tipo_item_w	:= 'NPTA';
			when 'I' then
				ie_tipo_item_w	:= 'NPTI';
		end case;
	end;
elsif (nm_tabela_p	= 'CPOE_MATERIAL') then
	begin
		if (coalesce(ie_controle_tempo_p::text, '') = '' or coalesce(ie_material_p::text, '') = '') then
			select	max(ie_controle_tempo),
					max(ie_material)
			into STRICT	ie_controle_tempo_w,
					ie_material_w
			from	cpoe_material
			where	nr_sequencia = nr_sequencia_p;
		else
			ie_controle_tempo_w := ie_controle_tempo_p;
			ie_material_w		:= ie_material_p;
		end if;
		if (ie_material_w	= 'S') then
			ie_tipo_item_w	:= 'MAT';
		elsif (ie_controle_tempo_w	= 'S') then
			ie_tipo_item_w	:= 'SOL';
		elsif (ie_controle_tempo_w	= 'N') then
			ie_tipo_item_w	:= 'M';
		end if;
	end;
elsif (nm_tabela_p	= 'CPOE_GASOTERAPIA') then
	ie_tipo_item_w	:= 'O';
elsif (nm_tabela_p	= 'CPOE_RECOMENDACAO') then
	ie_tipo_item_w	:= 'R';
elsif (nm_tabela_p	= 'CPOE_HEMOTERAPIA') then
	ie_tipo_item_w	:= 'HM';
elsif (nm_tabela_p	= 'CPOE_DIALISE') then
	ie_tipo_item_w	:= 'DI';
elsif (nm_tabela_p	= 'CPOE_ANATOMIA_PATOLOGICA') then
	ie_tipo_item_w	:= 'AP';
end if;

return	ie_tipo_item_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_obter_tipo_item ( nm_tabela_p text, nr_sequencia_p cpoe_dieta.nr_sequencia%type, ie_tipo_dieta_p cpoe_dieta.ie_tipo_dieta%type default null, ie_controle_tempo_p cpoe_material.ie_controle_tempo%type default null, ie_material_p cpoe_material.ie_material%type default null) FROM PUBLIC;

