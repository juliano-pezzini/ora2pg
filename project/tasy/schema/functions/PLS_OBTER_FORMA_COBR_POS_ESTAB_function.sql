-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_forma_cobr_pos_estab ( cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, ie_tipo_segurado_p pls_segurado.ie_tipo_segurado%type) RETURNS varchar AS $body$
DECLARE


ie_forma_cobranca_w		pls_regra_pos_estab.ie_forma_cobranca%type := null;

c01 CURSOR(	cd_estabelecimento_pc		estabelecimento.cd_estabelecimento%type,
		ie_tipo_segurado_pc		pls_segurado.ie_tipo_segurado%type) FOR
	SELECT	a.ie_forma_cobranca
	from	pls_regra_pos_estab a
	where	a.cd_estabelecimento	= cd_estabelecimento_pc
	and (a.ie_tipo_segurado	= ie_tipo_segurado_pc	or coalesce(a.ie_tipo_segurado::text, '') = '')
	order by
		a.ie_tipo_segurado;

BEGIN

for r_c01_w in c01( cd_estabelecimento_p, ie_tipo_segurado_p) loop
	ie_forma_cobranca_w := r_c01_w.ie_forma_cobranca;
end loop;

return	coalesce(ie_forma_cobranca_w,'M'); -- Por padrão cobrança na OPS - Mensalidade
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_forma_cobr_pos_estab ( cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, ie_tipo_segurado_p pls_segurado.ie_tipo_segurado%type) FROM PUBLIC;

