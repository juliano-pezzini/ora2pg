-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_check_digit (nr_generic_id_p bigint) RETURNS bigint AS $body$
DECLARE

  nr_id_length_w       bigint;
  nr_id_indicator_w    bigint;
  nr_odd_multiplier_w  bigint := 2;
  nr_even_multiplier_w bigint := 1;
  nr_seq_w             bigint := 0;
  nr_id_start_w        bigint := 1;
  nr_parity_w          bigint := 0;

BEGIN
    nr_id_length_w := Length(nr_generic_id_p);

    WHILE nr_seq_w <> nr_id_length_w LOOP
        nr_id_indicator_w := Substr(nr_generic_id_p, nr_id_start_w, 1);

        IF MOD(nr_id_start_w, 2) <> 0 THEN
          nr_parity_w := nr_parity_w + Substr(nr_id_indicator_w * nr_odd_multiplier_w, 1, 1)
                      + coalesce(Substr(nr_id_indicator_w * nr_odd_multiplier_w, 2, 1) , 0);
        ELSE
          nr_parity_w := nr_parity_w + nr_id_indicator_w * nr_even_multiplier_w;
        END IF;

        nr_seq_w := nr_seq_w + 1;
        nr_id_start_w := nr_id_start_w + 1;

    END LOOP;

    nr_parity_w := Substr(10 - Substr(nr_parity_w, -1, 1), -1, 1);

    RETURN( nr_parity_w );

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_check_digit (nr_generic_id_p bigint) FROM PUBLIC;

