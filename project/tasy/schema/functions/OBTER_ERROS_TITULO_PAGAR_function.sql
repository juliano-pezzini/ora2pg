-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_erros_titulo_pagar ( ds_erro_p text) RETURNS varchar AS $body$
DECLARE


cd_erro_w				varchar(3);
ds_erro_w	 			varchar(120);
ds_erro_escritural_w			varchar(120);
Resultado_w	 			varchar(2000) := null;


BEGIN

ds_erro_w		:= ds_erro_p;
while length(ds_erro_w) > 0 LOOP
	begin
	cd_erro_w	:= substr(ds_erro_w,1, 3);
	ds_erro_w	:= substr(ds_erro_w,4, 120);
	if (cd_erro_w IS NOT NULL AND cd_erro_w::text <> '') then
		select max(ds_erro)
		into STRICT ds_erro_escritural_w
		from erro_escritural
		where cd_erro = cd_erro_w;
	end if;
	if (ds_erro_escritural_w IS NOT NULL AND ds_erro_escritural_w::text <> '') then
		begin
		if (coalesce(Resultado_w::text, '') = '') then
			Resultado_w	:= Resultado_w || cd_erro_w || ' ' || ds_erro_escritural_w;
		else
			Resultado_w	:= Resultado_w ||  chr(10) || cd_erro_w || ' ' || ds_erro_escritural_w;
		end if;
		end;
	end if;
	end;
END LOOP;

RETURN resultado_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_erros_titulo_pagar ( ds_erro_p text) FROM PUBLIC;

