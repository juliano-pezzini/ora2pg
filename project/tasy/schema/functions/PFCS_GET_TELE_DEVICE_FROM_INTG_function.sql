-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pfcs_get_tele_device_from_intg ( ds_device_type_p text, ds_filter_type_p text, cd_estabelecimento_p text ) RETURNS bigint AS $body$
DECLARE


  nr_retorno_w 				bigint;
  ds_dev_active_status		varchar(15) := 'ACTIVE';
  ds_dev_inactive_status	varchar(15) := 'INACTIVE';
  ds_dev_unknown_status		varchar(15) := 'UNKNOWN';

  ds_device_type			varchar(15) := 'Monitor';



BEGIN

	nr_retorno_w := 0;
	-- ds_filter_type A is for devices available
	if (ds_filter_type_p = 'A') then
		select count(*) into STRICT nr_retorno_w
		from pfcs_device dev
		where 
			dev.si_status in (ds_dev_unknown_status, ds_dev_inactive_status)
			and dev.ds_device_type = ds_device_type
			and dev.nr_seq_organization = cd_estabelecimento_p;
	-- ds_filter_type U is for devices in use
	elsif (ds_filter_type_p = 'U') then
		select count(*) into STRICT nr_retorno_w
		from pfcs_device dev
		where 
			dev.si_status = ds_dev_active_status
			and dev.ds_device_type = ds_device_type
			and dev.nr_seq_organization = cd_estabelecimento_p;
	else
	-- when ds_filter_type is not passed then all devices are considered
	  select count(*) into STRICT nr_retorno_w
		from pfcs_device dev
		where 
			dev.ds_device_type = ds_device_type
			and dev.nr_seq_organization = cd_estabelecimento_p;
	end if;
	return nr_retorno_w;

	exception
		-- If there are no records found
		when no_data_found then
		  return nr_retorno_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pfcs_get_tele_device_from_intg ( ds_device_type_p text, ds_filter_type_p text, cd_estabelecimento_p text ) FROM PUBLIC;

