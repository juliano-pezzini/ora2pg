-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pfcs_get_patient_age (total_months_p text) RETURNS varchar AS $body$
DECLARE


  ie_resposta_w       varchar(10);
  qt_years_w          smallint :=0;
  qt_months_w         smallint :=0;
  year_expression_w   varchar(1);
  months_expression_w varchar(1);
  cd_idioma_w         bigint := null;

BEGIN
    begin
        select wheb_usuario_pck.get_nr_seq_idioma into STRICT cd_idioma_w;
    end;
    if (coalesce(total_months_p::text, '') = '') then
          ie_resposta_w := null;
    elsif ((total_months_p)::numeric  >= 12) then
           qt_years_w   := TRUNC((total_months_p)::numeric  / 12);
           year_expression_w   := SUBSTR(obter_desc_expressao_idioma(620432, null, cd_idioma_w), 1, 1);
           ie_resposta_w := concat(to_char(qt_years_w), year_expression_w);
    else
           qt_years_w   := 0;
           qt_months_w  := (total_months_p)::numeric;
           months_expression_w := SUBSTR(obter_desc_expressao_idioma(348664, null, cd_idioma_w), 1, 1);
           ie_resposta_w := concat(to_char(qt_months_w), months_expression_w);
    end if;

	
	return ie_resposta_w;

	exception
		-- If there are no records found
		when no_data_found then
		  return null;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pfcs_get_patient_age (total_months_p text) FROM PUBLIC;

