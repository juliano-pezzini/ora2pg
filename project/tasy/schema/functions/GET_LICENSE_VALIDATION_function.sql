-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_license_validation ( DT_START_P timestamp, DT_VALIDADE_P timestamp, CD_PESSOA_FISICA_P text, SI_SPECIAL_LICENSE_P text, NR_SEQ_DOCUMENTO_P bigint ) RETURNS varchar AS $body$
DECLARE

  IE_RETURN_W              varchar(100) := 'S';

  C1 CURSOR FOR
  SELECT DT_START,
      DT_VALIDADE,
      CD_PESSOA_FISICA
    FROM PESSOA_DOCUMENTACAO
    WHERE IE_SITUACAO      = 'A'
    AND NR_SEQ_DOCUMENTO   = NR_SEQ_DOCUMENTO_P
    AND SI_SPECIAL_LICENSE = SI_SPECIAL_LICENSE_P
    AND CD_PESSOA_FISICA   = CD_PESSOA_FISICA_P
   order by DT_ATUALIZACAO;

BEGIN
   for i in C1 
   loop
   IF (i.CD_PESSOA_FISICA IS NOT NULL AND i.CD_PESSOA_FISICA::text <> '') THEN
    IF((DT_START_P        >= i.DT_START AND i.DT_VALIDADE >= DT_VALIDADE_P) OR (DT_START_P <= i.DT_START AND DT_VALIDADE_P >= i.DT_START ) OR (DT_START_P <= i.DT_VALIDADE AND DT_VALIDADE_P >= i.DT_VALIDADE )) THEN
      IE_RETURN_W         := 'N' || ',' ||  to_char((i.DT_START), 'yyyy-mm-dd') || ',' || to_char((i.DT_VALIDADE), 'yyyy-mm-dd');
    END IF;
  END IF;
  end loop;
RETURN IE_RETURN_W;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_license_validation ( DT_START_P timestamp, DT_VALIDADE_P timestamp, CD_PESSOA_FISICA_P text, SI_SPECIAL_LICENSE_P text, NR_SEQ_DOCUMENTO_P bigint ) FROM PUBLIC;

