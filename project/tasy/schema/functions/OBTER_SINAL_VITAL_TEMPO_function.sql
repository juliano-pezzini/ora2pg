-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_sinal_vital_tempo ( cd_pessoa_fisica_p text, qt_minutos_p bigint, ie_sinal_p text, cd_escala_dor_p text) RETURNS bigint AS $body$
DECLARE


vl_retorno_w		double precision;


BEGIN

IF (coalesce(cd_pessoa_fisica_p,'0') <> '0') AND (ie_sinal_p IS NOT NULL AND ie_sinal_p::text <> '') THEN
	BEGIN
	IF (ie_sinal_p = 'Temp') THEN
		SELECT	MAX(qt_temp)
		INTO STRICT	vl_retorno_w
		FROM	atendimento_sinal_vital
		WHERE	nr_sequencia = (SELECT	coalesce(MAX(nr_sequencia),0)
					FROM	atendimento_sinal_vital
					WHERE	(qt_temp IS NOT NULL AND qt_temp::text <> '')
					AND	cd_paciente	= cd_pessoa_fisica_p
					AND	ie_situacao 	= 'A'
					AND	coalesce(IE_RN,'N')	= 'N'
					AND	clock_timestamp() BETWEEN dt_sinal_vital AND (dt_sinal_vital + (qt_minutos_p/1440)));
	ELSIF (ie_sinal_p = 'FC') THEN
		SELECT	MAX(qt_freq_cardiaca)
		INTO STRICT	vl_retorno_w
		FROM	atendimento_sinal_vital
		WHERE	nr_sequencia = (SELECT	coalesce(MAX(nr_sequencia),0)
					FROM	atendimento_sinal_vital
					WHERE	(qt_freq_cardiaca IS NOT NULL AND qt_freq_cardiaca::text <> '')
					AND	cd_paciente	= cd_pessoa_fisica_p
					AND	ie_situacao 	= 'A'
					AND	coalesce(IE_RN,'N')	= 'N'
					AND	clock_timestamp() BETWEEN dt_sinal_vital AND (dt_sinal_vital + (qt_minutos_p/1440)));
	ELSIF (ie_sinal_p = 'FR') THEN
		SELECT	MAX(qt_freq_resp)
		INTO STRICT	vl_retorno_w
		FROM	atendimento_sinal_vital
		WHERE	nr_sequencia = (SELECT	coalesce(MAX(nr_sequencia),0)
					FROM	atendimento_sinal_vital
					WHERE	(qt_freq_resp IS NOT NULL AND qt_freq_resp::text <> '')
					AND	cd_paciente	= cd_pessoa_fisica_p
					AND	ie_situacao 	= 'A'
					AND	coalesce(IE_RN,'N')	= 'N'
					AND	clock_timestamp() BETWEEN dt_sinal_vital AND (dt_sinal_vital + (qt_minutos_p/1440)));
	ELSIF (ie_sinal_p = 'PAMIN') THEN
		SELECT	MAX(qt_pa_diastolica)
		INTO STRICT	vl_retorno_w
		FROM	atendimento_sinal_vital
		WHERE	nr_sequencia = (SELECT	coalesce(MAX(nr_sequencia),0)
					FROM	atendimento_sinal_vital
					WHERE	(qt_pa_diastolica IS NOT NULL AND qt_pa_diastolica::text <> '')
					AND	(qt_pa_sistolica IS NOT NULL AND qt_pa_sistolica::text <> '')
					AND	cd_paciente	= cd_pessoa_fisica_p
					AND	ie_situacao 	= 'A'
					AND	coalesce(IE_RN,'N')	= 'N'
					AND	clock_timestamp() BETWEEN dt_sinal_vital AND (dt_sinal_vital + (qt_minutos_p/1440)));
	ELSIF (ie_sinal_p = 'PAMAX') THEN
		SELECT	MAX(qt_pa_sistolica)
		INTO STRICT	vl_retorno_w
		FROM	atendimento_sinal_vital
		WHERE	nr_sequencia = (SELECT	coalesce(MAX(nr_sequencia),0)
					FROM	atendimento_sinal_vital
					WHERE	(qt_pa_sistolica IS NOT NULL AND qt_pa_sistolica::text <> '')
					AND	(qt_pa_diastolica IS NOT NULL AND qt_pa_diastolica::text <> '')
					AND	cd_paciente	= cd_pessoa_fisica_p
					AND	ie_situacao 	= 'A'
					AND	coalesce(IE_RN,'N')	= 'N'
					AND	clock_timestamp() BETWEEN dt_sinal_vital AND (dt_sinal_vital + (qt_minutos_p/1440)));
	ELSIF (ie_sinal_p = 'PAM') THEN
		SELECT	MAX(qt_pam)
		INTO STRICT	vl_retorno_w
		FROM	atendimento_sinal_vital
		WHERE	nr_sequencia = (SELECT	coalesce(MAX(nr_sequencia),0)
					FROM	atendimento_sinal_vital
					WHERE	(qt_pam IS NOT NULL AND qt_pam::text <> '')
					AND	cd_paciente	= cd_pessoa_fisica_p
					AND	ie_situacao 	= 'A'
					AND	coalesce(IE_RN,'N')	= 'N'
					AND	clock_timestamp() BETWEEN dt_sinal_vital AND (dt_sinal_vital + (qt_minutos_p/1440)));
	ELSIF (ie_sinal_p = 'ESCDOR') THEN
		SELECT	MAX(qt_escala_dor)
		INTO STRICT	vl_retorno_w
		FROM	atendimento_sinal_vital
		WHERE	nr_sequencia = (SELECT	coalesce(MAX(nr_sequencia),0)
					FROM	atendimento_sinal_vital
					WHERE	(qt_escala_dor IS NOT NULL AND qt_escala_dor::text <> '')
					AND	cd_paciente	= cd_pessoa_fisica_p
					AND	ie_situacao 	= 'A'
					AND	coalesce(IE_RN,'N')	= 'N'
					AND	((coalesce(cd_escala_dor_p::text, '') = '') OR (cd_escala_dor = cd_escala_dor_p))
					AND	clock_timestamp() BETWEEN dt_sinal_vital AND (dt_sinal_vital + (qt_minutos_p/1440)));
	ELSIF (ie_sinal_p = 'GLIC') THEN
		SELECT	MAX(QT_GLICEMIA_CAPILAR)
		INTO STRICT	vl_retorno_w
		FROM	atendimento_sinal_vital
		WHERE	nr_sequencia = (SELECT	coalesce(MAX(nr_sequencia),0)
					FROM	atendimento_sinal_vital
					WHERE	(QT_GLICEMIA_CAPILAR IS NOT NULL AND QT_GLICEMIA_CAPILAR::text <> '')
					AND	cd_paciente	= cd_pessoa_fisica_p
					AND	ie_situacao 	= 'A'
					AND	coalesce(IE_RN,'N')	= 'N'
					AND	((coalesce(cd_escala_dor_p::text, '') = '') OR (cd_escala_dor = cd_escala_dor_p))
					AND	clock_timestamp() BETWEEN dt_sinal_vital AND (dt_sinal_vital + (qt_minutos_p/1440)));
	ELSIF (ie_sinal_p = 'SAT') THEN
		SELECT	MAX(QT_SATURACAO_O2)
		INTO STRICT	vl_retorno_w
		FROM	atendimento_sinal_vital
		WHERE	nr_sequencia = (SELECT	coalesce(MAX(nr_sequencia),0)
					FROM	atendimento_sinal_vital
					WHERE	(QT_SATURACAO_O2 IS NOT NULL AND QT_SATURACAO_O2::text <> '')
					AND	cd_paciente	= cd_pessoa_fisica_p
					AND	ie_situacao 	= 'A'
					AND	coalesce(IE_RN,'N')	= 'N'
					AND	((coalesce(cd_escala_dor_p::text, '') = '') OR (cd_escala_dor = cd_escala_dor_p))
					AND	clock_timestamp() BETWEEN dt_sinal_vital AND (dt_sinal_vital + (qt_minutos_p/1440)));
	ELSIF (ie_sinal_p = 'NIVCON')THEN
		SELECT	MAX(ie_nivel_consciencia)
		INTO STRICT	vl_retorno_w
		FROM	atendimento_sinal_vital
		WHERE	nr_sequencia = (SELECT	coalesce(MAX(nr_sequencia),0)
					FROM	atendimento_sinal_vital
					WHERE	(ie_nivel_consciencia IS NOT NULL AND ie_nivel_consciencia::text <> '')
					AND	cd_paciente	= cd_pessoa_fisica_p
					AND	ie_situacao 	= 'A'
					AND	coalesce(IE_RN,'N')	= 'N'
					AND	clock_timestamp() BETWEEN dt_sinal_vital AND (dt_sinal_vital + (qt_minutos_p/1440)));
	END IF;
	END;
END IF;

RETURN	vl_retorno_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_sinal_vital_tempo ( cd_pessoa_fisica_p text, qt_minutos_p bigint, ie_sinal_p text, cd_escala_dor_p text) FROM PUBLIC;

