-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cpoe_permite_prescr_pac_alta ( nm_usuario_p text, cd_estabelecimento_p bigint, cd_perfil_p bigint, nr_atendimento_p bigint) RETURNS varchar AS $body$
DECLARE

 
qt_minutos_regra_w 	 		bigint;
qt_minutos_param43_w 		bigint;
ie_tipos_atendimento_alta_w	varchar(255);
dt_inicio_atual_w			timestamp;
ie_tipo_atendimento_w		smallint;

BEGIN
 
qt_minutos_param43_w := Obter_param_Usuario(924, 43, cd_perfil_p, nm_usuario_p, coalesce(cd_estabelecimento_p,1), qt_minutos_param43_w);
ie_tipos_atendimento_alta_w := Obter_param_Usuario(924, 1112, cd_perfil_p, nm_usuario_p, coalesce(cd_estabelecimento_p,1), ie_tipos_atendimento_alta_w);
ie_tipo_atendimento_w := obter_tipo_atendimento(nr_atendimento_p);
qt_minutos_regra_w := obter_min_REP_apos_alta(ie_tipo_atendimento_w);
 
if (coalesce(qt_minutos_regra_w,0) > 0) then 
	qt_minutos_param43_w := qt_minutos_regra_w;
end if;
 
if (coalesce(qt_minutos_param43_w,0) > 0) and (coalesce(nr_atendimento_p,0) > 0) then 
	 
	if (coalesce(ie_tipos_atendimento_alta_w::text, '') = '' or (obter_se_valor_contido(ie_tipo_atendimento_w, ie_tipos_atendimento_alta_w) = 'S')) then 
 
		select (coalesce(dt_alta,dt_alta_medico) + qt_minutos_param43_w / 1440) 
		into STRICT dt_inicio_atual_w 
		from atendimento_paciente 
		where nr_atendimento = nr_atendimento_p;
	 
		if (dt_inicio_atual_w IS NOT NULL AND dt_inicio_atual_w::text <> '') and (dt_inicio_atual_w > clock_timestamp()) then 
			return 'S';
		end if;
	end if;
	 
end if;
 
return 'N';
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_permite_prescr_pac_alta ( nm_usuario_p text, cd_estabelecimento_p bigint, cd_perfil_p bigint, nr_atendimento_p bigint) FROM PUBLIC;

