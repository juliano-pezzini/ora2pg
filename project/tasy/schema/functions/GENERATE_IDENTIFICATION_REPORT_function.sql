-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION generate_identification_report () RETURNS varchar AS $body$
DECLARE


	identification_code_w varchar(250);
	random_count          smallint;
	identification_code_temp varchar(250);


BEGIN
	select nextval('identification_report_seq') into STRICT identification_code_temp;
    select concat(concat(to_char(clock_timestamp(),'YYYYMMDD' ),'-'),identification_code_temp)  into STRICT identification_code_w;

	while 1 = 1

	loop

		select  COUNT(*)
			into STRICT random_count
			from PACIENTE_MEDIC_USO
			where CD_IDENTIFICATION_REPORT = identification_code_w;

		exit when random_count = 0;

		if random_count                 > 0 then

			select nextval('identification_report_seq') into STRICT identification_code_temp;
			select concat(concat(to_char(clock_timestamp(),'YYYYMMDD' ),'-'),identification_code_temp)  into STRICT identification_code_w;

		end if;

	end loop;

return identification_code_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION generate_identification_report () FROM PUBLIC;

