-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_sim_valor_conta (nr_interno_conta_p bigint, nr_seq_sim_p bigint, ie_opcao_p bigint) RETURNS bigint AS $body$
DECLARE


/* ie_opcao 		0 - Valor Conta
			1 - Valor Procedimentos
			2 - Valor Materiais
			3 - Valor Custo
*/
vl_item_w			double precision;
vl_procedimento_w		double precision;
vl_material_w			double precision;
vl_resultado_w			double precision := 0;
vl_custo_w			double precision;
vl_custo_ant_w			double precision;
ie_exibir_custos		varchar(1);


BEGIN

ie_exibir_custos := obter_valor_param_usuario(1800, 9, obter_perfil_ativo, wheb_usuario_pck.get_nm_usuario, wheb_usuario_pck.get_cd_estabelecimento);

select 	coalesce(sum(vl_material + vl_procedimento),0),
	coalesce(sum(vl_procedimento),0),
	coalesce(sum(vl_material),0),
	coalesce(sum(vl_custo),0),
	coalesce(sum(vl_custo_resumo),0)
into STRICT	vl_item_w,
	vl_procedimento_w,
	vl_material_w,
	vl_custo_w,
	vl_custo_ant_w
from    sim_valor
where   nr_interno_conta = nr_interno_conta_p
and 	nr_seq_sim	 = nr_seq_sim_p;

if	ie_opcao_p = 0 then
		vl_resultado_w := vl_item_w;
elsif	ie_opcao_p = 1 then
	vl_resultado_w := vl_procedimento_w;
elsif	ie_opcao_p = 2 then
	vl_resultado_w := vl_material_w;
elsif	ie_opcao_p = 3 then
	if (ie_exibir_custos = 'S') then
		vl_resultado_w := vl_custo_w;
	else
		vl_resultado_w := 0;
	end if;
elsif	ie_opcao_p = 4 then
	if (ie_exibir_custos = 'S') then
		vl_resultado_w := vl_custo_ant_w;
	else
		vl_resultado_w := 0;
	end if;
end if;

return coalesce(vl_resultado_w,0);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_sim_valor_conta (nr_interno_conta_p bigint, nr_seq_sim_p bigint, ie_opcao_p bigint) FROM PUBLIC;

