-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_situacao_cadastro_pf_hsc (cd_pessoa_fisica_p text, ie_cadastro_p text) RETURNS varchar AS $body$
DECLARE

 
/* 
Function criada para atender a OS 35580 - HSC. Rafael em 04/07/2006. 
*/
 
 
dt_nascimento_w				timestamp;
cd_nacionalidade_w			varchar(8);
ie_estado_civil_w			varchar(2);
ie_sexo_w					varchar(1);
ie_grau_instrucao_w			smallint;	
cd_religiao_w				integer;
nr_telefone_celular_w		varchar(40);
nr_identidade_w				varchar(15);
nr_cpf_w					varchar(11);
nr_cep_cidade_nasc_w		varchar(15);
cd_cep_w					varchar(15);
nr_endereco_w				integer;
ds_bairro_w					varchar(80);
ds_municipio_w				varchar(40);
cd_municipio_ibge_w			varchar(6);
sg_estado_w					compl_pessoa_fisica.sg_estado%type;
cd_profissao_w				bigint;
cd_empresa_refer_w			integer;
nm_pai_w					varchar(60);
nm_mae_w					varchar(60);
nm_conjuge_w				varchar(60);

ds_retorno_w				varchar(255);


BEGIN 
if (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') then 
	if (coalesce(ie_cadastro_p, 'I') = 'I') then 
		select	b.dt_nascimento, 
			b.cd_nacionalidade, 
			b.ie_estado_civil, 
			b.ie_sexo, 
			b.ie_grau_instrucao, 
			b.cd_religiao, 
			b.nr_telefone_celular, 
			b.nr_identidade, 
			b.nr_cpf, 
			b.nr_cep_cidade_nasc, 
			c.cd_cep, 
			c.nr_endereco, 
			c.ds_bairro, 
			c.ds_municipio, 
			c.cd_municipio_ibge, 
			c.sg_estado, 
			c.cd_profissao, 
			c.cd_empresa_refer, 
			obter_compl_pf(cd_pessoa_fisica_p, 4, 'N'), 
			obter_compl_pf(cd_pessoa_fisica_p, 5, 'N'), 
			obter_compl_pf(cd_pessoa_fisica_p, 6, 'N') 
		into STRICT	dt_nascimento_w, 
			cd_nacionalidade_w, 
			ie_estado_civil_w, 
			ie_sexo_w, 
			ie_grau_instrucao_w, 
			cd_religiao_w, 
			nr_telefone_celular_w, 
	   		nr_identidade_w, 
			nr_cpf_w, 
			nr_cep_cidade_nasc_w, 
			cd_cep_w, 
			nr_endereco_w, 
			ds_bairro_w, 
			ds_municipio_w, 
	    	cd_municipio_ibge_w, 
			sg_estado_w, 
			cd_profissao_w, 
			cd_empresa_refer_w, 
			nm_pai_w, 
			nm_mae_w,	 
			nm_conjuge_w 
		from	compl_pessoa_fisica c, 
			pessoa_fisica b 
		where	c.cd_pessoa_fisica		= b.cd_pessoa_fisica 
		and	c.ie_tipo_complemento	= 1 
		and	b.cd_pessoa_fisica		= cd_pessoa_fisica_p 
		and	((coalesce(b.dt_nascimento::text, '') = '')	or (coalesce(b.cd_nacionalidade::text, '') = '')	or (coalesce(b.ie_estado_civil::text, '') = '')	or (coalesce(b.ie_sexo::text, '') = '')	or (coalesce(b.ie_grau_instrucao::text, '') = '')	or (coalesce(b.cd_religiao::text, '') = '')	or (coalesce(b.nr_telefone_celular::text, '') = '')	or (coalesce(b.nr_identidade::text, '') = '')	or (coalesce(b.nr_cpf::text, '') = '')	or (coalesce(b.nr_cep_cidade_nasc::text, '') = '')	or (coalesce(c.cd_cep::text, '') = '')	or (coalesce(c.nr_endereco::text, '') = '')	or (coalesce(c.ds_bairro::text, '') = '')	or (coalesce(c.ds_municipio::text, '') = '')	or (coalesce(c.cd_municipio_ibge::text, '') = '')	or (coalesce(c.sg_estado::text, '') = '')	or (coalesce(c.cd_profissao::text, '') = '')	or (coalesce(c.cd_empresa_refer::text, '') = '')	or (exists (SELECT	1 
					from	compl_pessoa_fisica x 
					where	x.ie_tipo_complemento	in (4,5,6) 
					and	coalesce(x.nm_contato::text, '') = '' 
					and	x.cd_pessoa_fisica		= b.cd_pessoa_fisica))) 
	group by	b.dt_nascimento, 
			b.cd_nacionalidade, 
			b.ie_estado_civil, 
			b.ie_sexo, 
			b.ie_grau_instrucao, 
			b.cd_religiao, 
			b.nr_telefone_celular, 
			b.nr_identidade, 
			b.nr_cpf, 
			b.nr_cep_cidade_nasc, 
			c.cd_cep, 
			c.nr_endereco, 
			c.ds_bairro, 
			c.ds_municipio, 
			c.cd_municipio_ibge, 
			c.sg_estado, 
			c.cd_profissao, 
			c.cd_empresa_refer, 
			obter_compl_pf(cd_pessoa_fisica_p, 4, 'N'), 
			obter_compl_pf(cd_pessoa_fisica_p, 5, 'N'), 
			obter_compl_pf(cd_pessoa_fisica_p, 6, 'N');
 
	if (coalesce(dt_nascimento_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(288726) ||','; /*' Dt nascimento,'*/
	end if;
	if (coalesce(cd_nacionalidade_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(293906) ||','; /*' Nacionalidade,'*/
	end if;
	if (coalesce(ie_estado_civil_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(625399) ||','; /*' Estado civil,'*/
	end if;
	if (coalesce(ie_sexo_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| ' Sexo,';
	end if;
	if (coalesce(ie_grau_instrucao_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(290989) ||','; /*' Grau instrução,'*/
	end if;
	if (coalesce(cd_religiao_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(297619) ||','; /*' Religião,'*/
	end if;
	if (coalesce(nr_telefone_celular_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(290216) ||','; /*' Fone contato,'*/
	end if;
	if (coalesce(nr_identidade_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| ' RG,';
	end if;
	if (coalesce(nr_cpf_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| ' CPF,';
	end if;
	if (coalesce(nr_cep_cidade_nasc_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(284943) ||','; /*' Cidade natal,'*/
	end if;
	if (coalesce(cd_cep_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| ' CEP,';
	end if;
	if (coalesce(nr_endereco_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| ' Nº,';
	end if;
	if (coalesce(ds_bairro_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(284200) ||','; /*' Bairro,'*/
	end if;
	if (coalesce(ds_municipio_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(293659) ||',';/*' Município,'*/
	end if;
	if (coalesce(cd_municipio_ibge_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(293668) ||','; /*' Município IBGE,'*/
	end if;
	if (coalesce(sg_estado_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(289525) ||','; /*' Estado,'*/
	end if;
	if (coalesce(cd_profissao_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(296507) ||','; /*' Profissão,'*/
	end if;
	if (coalesce(cd_empresa_refer_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(289182) ||','; /*' Empresa,'*/
	end if;
	if (coalesce(nm_pai_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(294234) ||','; /*' Nome pai,'*/
	end if;
	if (coalesce(nm_mae_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(294226) ||','; /*' Nome mãe,'*/
	end if;
	if (coalesce(nm_conjuge_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(312772) ||','; /*' Nome cônjuge,'*/
	end if;
 
	elsif (coalesce(ie_cadastro_p, 'I') = 'O') then 
		select	b.dt_nascimento, 
			b.ie_sexo, 
			b.ie_grau_instrucao, 
			b.nr_telefone_celular, 
			b.nr_identidade, 
			b.nr_cpf, 
			b.nr_cep_cidade_nasc, 
			c.cd_cep, 
			c.nr_endereco, 
			c.ds_bairro, 
			c.ds_municipio, 
			c.cd_municipio_ibge, 
			c.sg_estado, 
			obter_compl_pf(cd_pessoa_fisica_p, 4, 'N'), 
			obter_compl_pf(cd_pessoa_fisica_p, 5, 'N') 
		into STRICT	dt_nascimento_w, 
			ie_sexo_w, 
			ie_grau_instrucao_w, 
			nr_telefone_celular_w, 
	   		nr_identidade_w, 
			nr_cpf_w, 
			nr_cep_cidade_nasc_w, 
			cd_cep_w, 
			nr_endereco_w, 
			ds_bairro_w, 
			ds_municipio_w, 
	    	cd_municipio_ibge_w, 
			sg_estado_w, 
			nm_pai_w, 
			nm_mae_w 
		from	compl_pessoa_fisica c, 
			pessoa_fisica b 
		where	c.cd_pessoa_fisica		= b.cd_pessoa_fisica 
		and	c.ie_tipo_complemento	= 1 
		and	b.cd_pessoa_fisica		= cd_pessoa_fisica_p 
		and	((coalesce(b.dt_nascimento::text, '') = '')	or (coalesce(b.ie_sexo::text, '') = '')	or (coalesce(b.nr_telefone_celular::text, '') = '')	or (coalesce(b.nr_identidade::text, '') = '')	or (coalesce(b.nr_cpf::text, '') = '')	or (coalesce(c.cd_cep::text, '') = '')	or (coalesce(c.nr_endereco::text, '') = '')	or (coalesce(c.ds_bairro::text, '') = '')	or (coalesce(c.ds_municipio::text, '') = '')	or (coalesce(c.cd_municipio_ibge::text, '') = '')	or (coalesce(c.sg_estado::text, '') = '')	or (exists (SELECT	1 
					from	compl_pessoa_fisica x 
					where	x.ie_tipo_complemento	in (4,5) 
					and	coalesce(x.nm_contato::text, '') = '' 
					and	x.cd_pessoa_fisica		= b.cd_pessoa_fisica))) 
	group by	b.dt_nascimento, 
			b.ie_sexo, 
			b.ie_grau_instrucao, 
			b.nr_telefone_celular, 
			b.nr_identidade, 
			b.nr_cpf, 
			b.nr_cep_cidade_nasc, 
			c.cd_cep, 
			c.nr_endereco, 
			c.ds_bairro, 
			c.ds_municipio, 
			c.cd_municipio_ibge, 
			c.sg_estado, 
			obter_compl_pf(cd_pessoa_fisica_p, 4, 'N'), 
			obter_compl_pf(cd_pessoa_fisica_p, 5, 'N');
 
	if (coalesce(dt_nascimento_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(288726) ||','; /*' Dt nascimento,'*/
	end if;
	if (coalesce(ie_sexo_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| ' Sexo,';
	end if;
	if (coalesce(nr_telefone_celular_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(290216) ||','; /*' Fone contato,'*/
	end if;
	if (coalesce(nr_identidade_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| ' RG,';
	end if;
	if (coalesce(nr_cpf_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| ' CPF,';
	end if;
	if (coalesce(cd_cep_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| ' CEP,';
	end if;
	if (coalesce(nr_endereco_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| ' Nº,';
	end if;
	if (coalesce(ds_bairro_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(284200)||','; /*' Bairro,'*/
	end if;
	if (coalesce(ds_municipio_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(293659) ||','; /*' Município,'*/
	end if;
	if (coalesce(cd_municipio_ibge_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(293668) ||','; /*' Município IBGE,'*/
	end if;
	if (coalesce(sg_estado_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(289525) ||','; /*' Estado,'*/
	end if;
	if (coalesce(nm_pai_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(294234) ||','; /*' Nome pai,'*/
	end if;
	if (coalesce(nm_mae_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(294226) ||','; /*' Nome mãe,'*/
	end if;
 
	/* incluído a pedido de fabiano HSC em 15/9/7 OS68574 */
 
	elsif (coalesce(ie_cadastro_p, 'I') = 'V') then 
		select	b.dt_nascimento, 
			b.ie_sexo, 
			b.nr_identidade, 
			b.nr_cpf 
		into STRICT	dt_nascimento_w, 
			ie_sexo_w, 
	   		nr_identidade_w, 
		    	nr_cpf_w 
		from	compl_pessoa_fisica c, 
			pessoa_fisica b 
		where	c.cd_pessoa_fisica		= b.cd_pessoa_fisica 
		and	c.ie_tipo_complemento	= 1 
		and	b.cd_pessoa_fisica		= cd_pessoa_fisica_p 
		and	((coalesce(b.dt_nascimento::text, '') = '')	or (coalesce(b.ie_sexo::text, '') = '')	or (coalesce(b.nr_identidade::text, '') = '')	or (coalesce(b.nr_cpf::text, '') = '')	or (exists (SELECT	1 
					from	compl_pessoa_fisica x 
					where	x.ie_tipo_complemento	in (4,5) 
					and	coalesce(x.nm_contato::text, '') = '' 
					and	x.cd_pessoa_fisica		= b.cd_pessoa_fisica))) 
	group by	b.dt_nascimento, 
			b.ie_sexo, 
			b.nr_identidade, 
			b.nr_cpf;
 
	if (coalesce(dt_nascimento_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| obter_desc_expressao(288726) ||','; /*' Dt nascimento,'*/
	end if;
	if (coalesce(ie_sexo_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| ' Sexo,';
	end if;
	if (coalesce(nr_identidade_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| ' RG,';
	end if;
	if (coalesce(nr_cpf_w::text, '') = '') then 
		ds_retorno_w	:= ds_retorno_w	|| ' CPF,';
	end if;
 
	end if;		
end if;
 
RETURN	ds_retorno_w;
 
END	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_situacao_cadastro_pf_hsc (cd_pessoa_fisica_p text, ie_cadastro_p text) FROM PUBLIC;

