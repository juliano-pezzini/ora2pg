-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_diretor ( cd_estabelecimento_p text, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


cd_pessoa_fisica_w	varchar(10);
nr_seq_person_name_w	varchar(10);
ds_medico_w	varchar(255);


BEGIN

select	max(cd_pessoa_fisica)
into STRICT	cd_pessoa_fisica_w
from	ESTAB_DIRETORIA
where	ie_cargo		= 'DTM'
and		cd_estabelecimento	= cd_estabelecimento_p
and	clock_timestamp()	between dt_inicial and coalesce(dt_fim_vigencia,clock_timestamp() + interval '1 days');


if (ie_opcao_p = 'GN')then
	if (person_name_enabled = 'S') then
			select 	max(nr_seq_person_name)
			into STRICT 	nr_seq_person_name_w
			from 	pessoa_fisica
			where 	cd_pessoa_fisica = cd_pessoa_fisica_w;

			select max(nm_pessoa_fisica)
			into STRICT ds_medico_w
			from table(search_names_dev(null, null, nr_seq_person_name_w, 'givenName', 'social,main'));
	else
			select 	max(nm_primeiro_nome)
			into STRICT 	ds_medico_w
			from	pessoa_fisica
			where 	cd_pessoa_fisica = cd_pessoa_fisica_w;
	end if;
elsif (ie_opcao_p = 'FN')then
	if (person_name_enabled = 'S') then
			select 	max(nr_seq_person_name)
			into STRICT 	nr_seq_person_name_w
			from 	pessoa_fisica
			where 	cd_pessoa_fisica = cd_pessoa_fisica_w;

			select max(nm_pessoa_fisica)
			into STRICT ds_medico_w
			from table(search_names_dev(null, null, nr_seq_person_name_w, 'familyName', 'social,main'));
	else
			select 	max(nm_sobrenome_pai)
			into STRICT 	ds_medico_w
			from	pessoa_fisica
			where 	cd_pessoa_fisica = cd_pessoa_fisica_w;
	end if;
end if;

return	ds_medico_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_diretor ( cd_estabelecimento_p text, ie_opcao_p text) FROM PUBLIC;

