-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_tipo_os_proj_migr_usu ( nr_seq_os_p bigint, nm_usuario_p text) RETURNS varchar AS $body$
DECLARE

	 
nr_seq_projeto_w	bigint;
ie_tipo_os_w		varchar(2) := 'X';
	

BEGIN 
if (nr_seq_os_p IS NOT NULL AND nr_seq_os_p::text <> '') and (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') then 
	begin 
	select	CASE WHEN count(*)=0 THEN 'X'  ELSE 'PU' END  
	into STRICT	ie_tipo_os_w 
	from	proj_projeto x 
	where	x.nr_seq_ordem_serv = nr_seq_os_p 
	and	x.nr_seq_gerencia = 9 
	and	x.nr_seq_classif = 14 
	and	exists ( 
			SELECT	1 
			from	proj_equipe e, 
				proj_equipe_papel p 
			where	x.nr_sequencia = e.nr_seq_proj 
			and	e.nr_sequencia = p.nr_seq_equipe 
			and	e.nr_seq_equipe_funcao = 11 
			and	p.nr_seq_funcao = 44 
			and	p.cd_pessoa_fisica = obter_pessoa_fisica_usuario(nm_usuario_p,'C') 
			and	coalesce(p.ie_situacao,'A') = 'A' 
			and	coalesce(p.ie_funcao_rec_migr,'M') = 'M');
			 
	if (ie_tipo_os_w = 'X') then 
		begin 
		select	CASE WHEN count(*)=0 THEN 'X'  ELSE 'PT' END  
		into STRICT	ie_tipo_os_w 
		from	proj_projeto x 
		where	x.nr_seq_ordem_serv = nr_seq_os_p 
		and	x.nr_seq_gerencia = 9 
		and	x.nr_seq_classif = 14 
		and	not exists ( 
				SELECT	1 
				from	proj_equipe e, 
					proj_equipe_papel p 
				where	x.nr_sequencia = e.nr_seq_proj 
				and	e.nr_sequencia = p.nr_seq_equipe 
				and	e.nr_seq_equipe_funcao = 11 
				and	p.nr_seq_funcao = 44 
				and	p.cd_pessoa_fisica = obter_pessoa_fisica_usuario(nm_usuario_p,'C') 
				and	coalesce(p.ie_situacao,'A') = 'A' 
				and	coalesce(p.ie_funcao_rec_migr,'M') = 'M');
				 
		if (ie_tipo_os_w = 'X') then 
			begin 
			select	CASE WHEN count(*)=0 THEN 'X'  ELSE 'RU' END  
			into STRICT	ie_tipo_os_w 
			from	proj_projeto x, 
				proj_ordem_servico o 
			where	x.nr_sequencia = o.nr_seq_proj 
			and	x.nr_seq_gerencia = 9 
			and	x.nr_seq_classif = 14 
			and	o.nr_seq_ordem = nr_seq_os_p 
			and	o.ie_tipo_ordem = 'R' 
			and	exists ( 
					SELECT	1 
					from	proj_equipe e, 
						proj_equipe_papel p 
					where	x.nr_sequencia = e.nr_seq_proj 
					and	e.nr_sequencia = p.nr_seq_equipe 
					and	e.nr_seq_equipe_funcao = 11 
					and	p.nr_seq_funcao = 44 
					and	p.cd_pessoa_fisica = obter_pessoa_fisica_usuario(nm_usuario_p,'C') 
					and	coalesce(p.ie_situacao,'A') = 'A' 
					and	coalesce(p.ie_funcao_rec_migr,'M') = 'R');
					 
			if (ie_tipo_os_w = 'X') then 
				begin 
				select	CASE WHEN count(*)=0 THEN 'X'  ELSE 'RT' END  
				into STRICT	ie_tipo_os_w 
				from	proj_projeto x, 
					proj_ordem_servico o 
				where	x.nr_sequencia = o.nr_seq_proj 
				and	x.nr_seq_gerencia = 9 
				and	x.nr_seq_classif = 14 
				and	o.nr_seq_ordem = nr_seq_os_p 
				and	o.ie_tipo_ordem = 'R' 
				and	not exists ( 
						SELECT	1 
						from	proj_equipe e, 
							proj_equipe_papel p 
						where	x.nr_sequencia = e.nr_seq_proj 
						and	e.nr_sequencia = p.nr_seq_equipe 
						and	e.nr_seq_equipe_funcao = 11 
						and	p.nr_seq_funcao = 44 
						and	p.cd_pessoa_fisica = obter_pessoa_fisica_usuario(nm_usuario_p,'C') 
						and	coalesce(p.ie_situacao,'A') = 'A' 
						and	coalesce(p.ie_funcao_rec_migr,'M') = 'R');
						 
				if (ie_tipo_os_w = 'X') then 
					begin 
					select	CASE WHEN count(*)=0 THEN 'X'  ELSE 'VU' END  
					into STRICT	ie_tipo_os_w 
					from	proj_projeto x, 
						proj_ordem_servico o 
					where	x.nr_sequencia = o.nr_seq_proj 
					and	x.nr_seq_gerencia = 9 
					and	x.nr_seq_classif = 14 
					and	o.nr_seq_ordem = nr_seq_os_p 
					and	o.ie_tipo_ordem = 'V' 
					and	exists ( 
							SELECT	1 
							from	proj_equipe e, 
								proj_equipe_papel p 
							where	x.nr_sequencia = e.nr_seq_proj 
							and	e.nr_sequencia = p.nr_seq_equipe 
							and	e.nr_seq_equipe_funcao = 11 
							and	p.nr_seq_funcao = 44 
							and	p.cd_pessoa_fisica = obter_pessoa_fisica_usuario(nm_usuario_p,'C') 
							and	coalesce(p.ie_situacao,'A') = 'A' 
							and	coalesce(p.ie_funcao_rec_migr,'M') in ('M','R','T'));
							 
					if (ie_tipo_os_w = 'X') then 
						begin 
						select	CASE WHEN count(*)=0 THEN 'X'  ELSE 'DU' END  
						into STRICT	ie_tipo_os_w 
						from	proj_projeto x, 
							proj_dependencia o 
						where	x.nr_sequencia = o.nr_seq_projeto 
						and	x.nr_seq_gerencia = 9 
						and	x.nr_seq_classif = 14 
						and	o.nr_seq_ordem_serv = nr_seq_os_p 
						and	exists ( 
								SELECT	1 
								from	proj_equipe e, 
									proj_equipe_papel p 
								where	x.nr_sequencia = e.nr_seq_proj 
								and	e.nr_sequencia = p.nr_seq_equipe 
								and	e.nr_seq_equipe_funcao = 11 
								and	p.nr_seq_funcao = 44 
								and	p.cd_pessoa_fisica = obter_pessoa_fisica_usuario(nm_usuario_p,'C') 
								and	coalesce(p.ie_situacao,'A') = 'A' 
								and	coalesce(p.ie_funcao_rec_migr,'M') in ('M','R','T'));						
						 
						if (ie_tipo_os_w = 'X') then 
							begin 
							select	CASE WHEN count(*)=0 THEN 'X'  ELSE 'VT' END  
							into STRICT	ie_tipo_os_w 
							from	proj_projeto x, 
								proj_ordem_servico o 
							where	x.nr_sequencia = o.nr_seq_proj 
							and	x.nr_seq_gerencia = 9 
							and	x.nr_seq_classif = 14 
							and	o.nr_seq_ordem = nr_seq_os_p 
							and	o.ie_tipo_ordem = 'V' 
							and	not exists ( 
									SELECT	1 
									from	proj_equipe e, 
										proj_equipe_papel p 
									where	x.nr_sequencia = e.nr_seq_proj 
									and	e.nr_sequencia = p.nr_seq_equipe 
									and	e.nr_seq_equipe_funcao = 11 
									and	p.nr_seq_funcao = 44 
									and	p.cd_pessoa_fisica = obter_pessoa_fisica_usuario(nm_usuario_p,'C') 
									and	coalesce(p.ie_situacao,'A') = 'A' 
									and	coalesce(p.ie_funcao_rec_migr,'M') in ('M','R','T'));
									 
							if (ie_tipo_os_w = 'X') then 
								begin 
								select	CASE WHEN count(*)=0 THEN 'X'  ELSE 'DT' END  
								into STRICT	ie_tipo_os_w 
								from	proj_projeto x, 
									proj_dependencia o 
								where	x.nr_sequencia = o.nr_seq_projeto 
								and	x.nr_seq_gerencia = 9 
								and	x.nr_seq_classif = 14 
								and	o.nr_seq_ordem_serv = nr_seq_os_p 
								and	not exists ( 
										SELECT	1 
										from	proj_equipe e, 
											proj_equipe_papel p 
										where	x.nr_sequencia = e.nr_seq_proj 
										and	e.nr_sequencia = p.nr_seq_equipe 
										and	e.nr_seq_equipe_funcao = 11 
										and	p.nr_seq_funcao = 44 
										and	p.cd_pessoa_fisica = obter_pessoa_fisica_usuario(nm_usuario_p,'C') 
										and	coalesce(p.ie_situacao,'A') = 'A' 
										and	coalesce(p.ie_funcao_rec_migr,'M') in ('M','R','T'));
										 
								if (ie_tipo_os_w = 'X') then 
									begin 
									select	CASE WHEN count(*)=0 THEN 'X'  ELSE 'TU' END  
									into STRICT	ie_tipo_os_w 
									from	proj_projeto x, 
										proj_ordem_servico o 
									where	x.nr_sequencia = o.nr_seq_proj 
									and	x.nr_seq_gerencia = 9 
									and	x.nr_seq_classif = 14 
									and	o.nr_seq_ordem = nr_seq_os_p 
									and	o.ie_tipo_ordem = 'T' 
									and	exists ( 
											SELECT	1 
											from	proj_equipe e, 
												proj_equipe_papel p 
											where	x.nr_sequencia = e.nr_seq_proj 
											and	e.nr_sequencia = p.nr_seq_equipe 
											and	e.nr_seq_equipe_funcao = 11 
											and	p.nr_seq_funcao = 44 
											and	p.cd_pessoa_fisica = obter_pessoa_fisica_usuario(nm_usuario_p,'C') 
											and	coalesce(p.ie_situacao,'A') = 'A' 
											and	coalesce(p.ie_funcao_rec_migr,'M') = 'T');
									 
									select	CASE WHEN count(*)=0 THEN 'X'  ELSE 'T' END  
									into STRICT	ie_tipo_os_w 
									from	proj_projeto x, 
										proj_ordem_servico o 
									where	x.nr_sequencia = o.nr_seq_proj 
									and	x.nr_seq_gerencia = 9 
									and	x.nr_seq_classif = 14 
									and	o.nr_seq_ordem = nr_seq_os_p 
									and	o.ie_tipo_ordem = 'T';
											 
									if (ie_tipo_os_w = 'X') then 
										begin 
										/*select	decode(count(*),0,'X','TT') 
										into	ie_tipo_os_w 
										from	proj_projeto x, 
											proj_ordem_servico o 
										where	x.nr_sequencia = o.nr_seq_proj 
										and	x.nr_seq_gerencia = 9 
										and	x.nr_seq_classif = 14 
										and	o.nr_seq_ordem = nr_seq_os_p 
										and	o.ie_tipo_ordem = 'T' 
										and	not exists ( 
												select	1 
												from	proj_equipe e, 
													proj_equipe_papel p 
												where	x.nr_sequencia = e.nr_seq_proj 
												and	e.nr_sequencia = p.nr_seq_equipe 
												and	e.nr_seq_equipe_funcao = 11 
												and	p.nr_seq_funcao = 44 
												and	p.cd_pessoa_fisica = obter_pessoa_fisica_usuario(nm_usuario_p,'C') 
												and	nvl(p.ie_situacao,'A') = 'A' 
												and	nvl(p.ie_funcao_rec_migr,'M') = 'T');*/
 
												 
										select	CASE WHEN count(*)=0 THEN 'X'  ELSE 'T' END  
										into STRICT	ie_tipo_os_w 
										from	proj_projeto x, 
											proj_ordem_servico o 
										where	x.nr_sequencia = o.nr_seq_proj 
										and	x.nr_seq_gerencia = 9 
										and	x.nr_seq_classif = 14 
										and	o.nr_seq_ordem = nr_seq_os_p 
										and	o.ie_tipo_ordem = 'T';
												 
										if (ie_tipo_os_w = 'X') then 
											begin 
											select	CASE WHEN count(*)=0 THEN 'X'  ELSE 'CU' END  
											into STRICT	ie_tipo_os_w 
											from	proj_projeto x, 
												proj_ordem_servico o 
											where	x.nr_sequencia = o.nr_seq_proj 
											and	x.nr_seq_gerencia = 9 
											and	x.nr_seq_classif = 14 
											and	o.nr_seq_ordem = nr_seq_os_p 
											and	o.ie_tipo_ordem = 'C' 
											and	exists ( 
													SELECT	1 
													from	proj_equipe e, 
														proj_equipe_papel p 
													where	x.nr_sequencia = e.nr_seq_proj 
													and	e.nr_sequencia = p.nr_seq_equipe 
													and	e.nr_seq_equipe_funcao = 11 
													and	p.nr_seq_funcao = 44 
													and	p.cd_pessoa_fisica = obter_pessoa_fisica_usuario(nm_usuario_p,'C') 
													and	coalesce(p.ie_situacao,'A') = 'A' 
													and	coalesce(p.ie_funcao_rec_migr,'M') = 'C');
													 
											if (ie_tipo_os_w = 'X') then 
												begin 
												select	CASE WHEN count(*)=0 THEN 'X'  ELSE 'CT' END  
												into STRICT	ie_tipo_os_w 
												from	proj_projeto x, 
													proj_ordem_servico o 
												where	x.nr_sequencia = o.nr_seq_proj 
												and	x.nr_seq_gerencia = 9 
												and	x.nr_seq_classif = 14 
												and	o.nr_seq_ordem = nr_seq_os_p 
												and	o.ie_tipo_ordem = 'C' 
												and	not exists ( 
														SELECT	1 
														from	proj_equipe e, 
															proj_equipe_papel p 
														where	x.nr_sequencia = e.nr_seq_proj 
														and	e.nr_sequencia = p.nr_seq_equipe 
														and	e.nr_seq_equipe_funcao = 11 
														and	p.nr_seq_funcao = 44 
														and	p.cd_pessoa_fisica = obter_pessoa_fisica_usuario(nm_usuario_p,'C') 
														and	coalesce(p.ie_situacao,'A') = 'A' 
														and	coalesce(p.ie_funcao_rec_migr,'M') = 'C');
														 
												if (ie_tipo_os_w = 'X') then 
													begin 
													select	CASE WHEN count(*)=0 THEN 'X'  ELSE 'UU' END  
													into STRICT	ie_tipo_os_w 
													from	proj_projeto x, 
														proj_ordem_servico o 
													where	x.nr_sequencia = o.nr_seq_proj 
													and	x.nr_seq_gerencia = 9 
													and	x.nr_seq_classif = 14 
													and	o.nr_seq_ordem = nr_seq_os_p 
													and	o.ie_tipo_ordem = 'U' 
													and	exists ( 
															SELECT	1 
															from	proj_equipe e, 
																proj_equipe_papel p 
															where	x.nr_sequencia = e.nr_seq_proj 
															and	e.nr_sequencia = p.nr_seq_equipe 
															and	e.nr_seq_equipe_funcao = 11 
															and	p.nr_seq_funcao = 44 
															and	p.cd_pessoa_fisica = obter_pessoa_fisica_usuario(nm_usuario_p,'C') 
															and	coalesce(p.ie_situacao,'A') = 'A' 
															and	coalesce(p.ie_funcao_rec_migr,'M') = 'T');
															 
													if (ie_tipo_os_w = 'X') then 
														begin 
														select	CASE WHEN count(*)=0 THEN 'X'  ELSE 'UT' END  
														into STRICT	ie_tipo_os_w 
														from	proj_projeto x, 
															proj_ordem_servico o 
														where	x.nr_sequencia = o.nr_seq_proj 
														and	x.nr_seq_gerencia = 9 
														and	x.nr_seq_classif = 14 
														and	o.nr_seq_ordem = nr_seq_os_p 
														and	o.ie_tipo_ordem = 'U' 
														and	not exists ( 
																SELECT	1 
																from	proj_equipe e, 
																	proj_equipe_papel p 
																where	x.nr_sequencia = e.nr_seq_proj 
																and	e.nr_sequencia = p.nr_seq_equipe 
																and	e.nr_seq_equipe_funcao = 11 
																and	p.nr_seq_funcao = 44 
																and	p.cd_pessoa_fisica = obter_pessoa_fisica_usuario(nm_usuario_p,'C') 
																and	coalesce(p.ie_situacao,'A') = 'A' 
																and	coalesce(p.ie_funcao_rec_migr,'M') = 'T');
														end;
													end if;
													end;
												end if;														
												end;
											end if;													
											end;
										end if;
										end;
									end if;
									end;
								end if;					
								end;
							end if;								
							end;
						end if;
						end;
					end if;
					end;
				end if;
				end;
			end if;
			end;
		end if;
		end;
	end if;
	end;
end if;
return ie_tipo_os_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_tipo_os_proj_migr_usu ( nr_seq_os_p bigint, nm_usuario_p text) FROM PUBLIC;

