-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_ativos_med_plan_report ( cd_material_p bigint, ie_opcao_p text, ds_princ_ativo text) RETURNS varchar AS $body$
DECLARE


qtd_actives_w	smallint;
ds_retorno_w	varchar(4000) := null;


BEGIN

	if (cd_material_p IS NOT NULL AND cd_material_p::text <> '') then
		ds_retorno_w :=	obter_princ_ativo_plano(cd_material_p, ie_opcao_p);
	else
		ds_retorno_w := ds_princ_ativo;
	end if;
	
	
	select length(coalesce(ds_retorno_w,'')) - length(replace(coalesce(ds_retorno_w, ''), '+',''))
	into STRICT qtd_actives_w	
	;
	
	if (qtd_actives_w > 2) then
		 if (ie_opcao_p = 'P') then
			ds_retorno_w := obter_desc_expressao(971834);
		else
			ds_retorno_w := '';
    end if;
	else
		ds_retorno_w := replace(ds_retorno_w, ' + ', chr(13) ||' ');
	end if;
	
	
	return ds_retorno_w;
  
end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_ativos_med_plan_report ( cd_material_p bigint, ie_opcao_p text, ds_princ_ativo text) FROM PUBLIC;

