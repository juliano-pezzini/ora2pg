-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_cta_val_obter_restr_prod ( ie_opcao_p text, cursor_p integer, dados_filtro_prod_p pls_tipos_cta_val_pck.dados_filtro_prod) RETURNS varchar AS $body$
DECLARE


ds_restricao_w		varchar(4000);
ds_select_prod_w	varchar(4000);
ds_filtro_prod_w	varchar(4000);

BEGIN

--Inicializar as variáveis.
ds_filtro_prod_w	:= null;
ds_restricao_w		:= null;

if (ie_opcao_p = 'RESTRICAO') then
	-- Montar o subselect base.
	ds_select_prod_w := pls_util_pck.enter_w ||	'and	exists (' || pls_util_pck.enter_w||
					'			select	1 ' || pls_util_pck.enter_w||
					'			from	pls_segurado	 benef, ' || pls_util_pck.enter_w||
					'				pls_plano	 plano ' || pls_util_pck.enter_w||
					'			where	benef.nr_sequencia = proc.nr_seq_segurado ' || pls_util_pck.enter_w||
					'			and	plano.nr_sequencia = benef.nr_seq_plano ';
end if;

-- Formação de preço
if (dados_filtro_prod_p.ie_preco IS NOT NULL AND dados_filtro_prod_p.ie_preco::text <> '') then
	if (ie_opcao_p = 'RESTRICAO') then
		ds_filtro_prod_w := ds_filtro_prod_w || pls_util_pck.enter_w || ' and	plano.ie_preco = :ie_preco ';
	else
		dbms_sql.bind_variable(cursor_p, ':ie_preco', dados_filtro_prod_p.ie_preco);
	end if;
end if;

if (ie_opcao_p = 'RESTRICAO') then
	ds_select_prod_w := ds_select_prod_w || pls_util_pck.enter_w || ds_filtro_prod_w ||'		)';

	ds_restricao_w := ds_select_prod_w;
end if;

return	ds_restricao_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_cta_val_obter_restr_prod ( ie_opcao_p text, cursor_p integer, dados_filtro_prod_p pls_tipos_cta_val_pck.dados_filtro_prod) FROM PUBLIC;

