-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_oc_cta_obter_filtro_contr ( dados_regra_p pls_tipos_ocor_pck.dados_regra, dados_filtro_p pls_tipos_ocor_pck.dados_filtro, dados_benef_p pls_tipos_ocor_pck.dados_benef) RETURNS PLS_TIPOS_OCOR_PCK.RET_FILTRO AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: Verificar se a conta se encaixa nos filtros específicos de contrato para
as ocorrências combinadas de conta médica
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  X]  Objetos do dicionário [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
Não esquecer de passar todos os campos do retorno, conforme pck
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
retorno_w	pls_tipos_ocor_pck.ret_filtro	:= null;
ie_valido_w	varchar(1)	:= 'S';

c_filtro CURSOR(nr_seq_filtro_pc	pls_oc_cta_filtro.nr_sequencia%type) FOR
	SELECT	a.nr_sequencia,
		a.nr_contrato,
		a.nr_seq_grupo_contrato
	from	pls_oc_cta_filtro_contrato a
	where	a.nr_seq_oc_cta_filtro	= nr_seq_filtro_pc;

BEGIN
/* Inicializar retorno */

retorno_w.ie_gera_ocorrencia	:= 'S';
retorno_w.ie_incidiu_filtro	:= 'N';
retorno_w.ie_excecao		:= 'N';
retorno_w.nr_sequencia		:= null;

if (dados_filtro_p.nr_sequencia > 0) and (dados_benef_p.nr_sequencia > 0) then

	/* Abrir vetor com todas as combinações de filtro da regra */

	for r_c_filtro in c_filtro(dados_filtro_p.nr_sequencia) loop
		/* Ainda não implementado
		Tratar como nas procedures PLS_OC_CTA_OBTER_FILTRO_CONTA ou PLS_OC_CTA_OBTER_FILTRO_PROC*/
		/* Se ao menos um filtro for válido, já não precisa verificar as demais opções */

		if (ie_valido_w = 'S') then
			retorno_w.ie_gera_ocorrencia	:= 'S';
			retorno_w.ie_incidiu_filtro	:= 'S';
			retorno_w.ie_excecao		:= 'N';
			retorno_w.nr_sequencia		:= r_c_filtro.nr_sequencia;

			exit;
		end if;
	end loop;
end if;

return	retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_oc_cta_obter_filtro_contr ( dados_regra_p pls_tipos_ocor_pck.dados_regra, dados_filtro_p pls_tipos_ocor_pck.dados_filtro, dados_benef_p pls_tipos_ocor_pck.dados_benef) FROM PUBLIC;

