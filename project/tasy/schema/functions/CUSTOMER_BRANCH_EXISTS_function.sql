-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION customer_branch_exists (NR_SEQ_SO_ORIGIN_P bigint) RETURNS varchar AS $body$
DECLARE


cd_version_w man_custom_branch.cd_version%type;
cd_build_w man_custom_branch.cd_build_tag%type;
part_branch_name_w varchar(20) := null;
ret_w varchar(100) := null;
count_w bigint := 0;

BEGIN
  select trim(both substr(mos.nr_versao_cliente_abertura,0,9)), mos.nr_versao_cliente_abertura
       , trim(both lpad(REGEXP_REPLACE(REGEXP_SUBSTR(ml.ds_localizacao, '(\S*)(\s)', 1)||REGEXP_SUBSTR(ml.ds_localizacao, '(\S*)(\s)', 1, 2), '\s|''|\\|\.', ''),20))
    into STRICT cd_version_w, cd_build_w, part_branch_name_w
    from man_ordem_servico mos
    inner join man_localizacao ml ON (mos.nr_seq_localizacao = ml.nr_sequencia)
    where mos.nr_sequencia = NR_SEQ_SO_ORIGIN_P;

    ret_w := cd_version_w||'-'||part_branch_name_w;
    select count(nr_sequencia)
      into STRICT count_w
      from man_custom_branch
     where branch_name = ret_w;

    if (count_w <= 0) then
        ret_w := null;
    end if;

   return trim(both ret_w);

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION customer_branch_exists (NR_SEQ_SO_ORIGIN_P bigint) FROM PUBLIC;

