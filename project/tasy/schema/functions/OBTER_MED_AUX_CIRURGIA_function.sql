-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_med_aux_cirurgia ( nr_cirurgia_p bigint, nr_sequencia_p bigint, ie_cod_desc_p text) RETURNS varchar AS $body$
DECLARE



cd_pessoa_fisica_w		varchar(10);
nm_participante_w		varchar(100);
qt_reg_w			bigint;
nr_sequencia_w		bigint;
nr_seq_w			bigint;

C01 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.cd_pessoa_fisica,
		a.nm_participante
	from	funcao_medico b,
		cirurgia_participante a
	where	a.ie_funcao	= b.cd_funcao
	and	b.ie_medico	= 'S'
	and	b.ie_auxiliar	= 'S'
	and	a.nr_cirurgia	= nr_cirurgia_p;


BEGIN

select	count(*)
into STRICT	qt_reg_w
from	cirurgia_participante a
where	nr_cirurgia	= nr_cirurgia_p;

nr_seq_w		:= 0;
if (qt_reg_w > 0) then
	OPEN C01;
	LOOP
	FETCH C01 into
		nr_sequencia_w,
		cd_pessoa_fisica_w,
		nm_participante_w;
	EXIT WHEN NOT FOUND; /* apply on c01 */
		nr_seq_w	:= nr_seq_w + 1;
		if (nr_sequencia_p	= nr_seq_w) then
			exit;
		end if;
	END LOOP;
	CLOSE C01;
end if;

if (ie_cod_desc_p = 'C') then
	return	cd_pessoa_fisica_w;
else
	return	nm_participante_w;
end if;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_med_aux_cirurgia ( nr_cirurgia_p bigint, nr_sequencia_p bigint, ie_cod_desc_p text) FROM PUBLIC;

