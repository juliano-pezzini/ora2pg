-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_vl_cheque_banco_saldo (nr_seq_banco_saldo_p bigint) RETURNS bigint AS $body$
DECLARE

vl_cheque_w 	double precision;
vl_cheque_cp_w 	double precision;
vl_cheque_cr_w 	double precision;


BEGIN

select 	sum(CASE WHEN c.ie_banco='C' THEN a.vl_cheque * -1  ELSE a.vl_cheque END ) vl_cheque
into STRICT 	vl_cheque_cp_w
from 	cheque a,
	movto_trans_financ b,
	transacao_financeira c
where	a.nr_sequencia		= b.nr_seq_cheque_cp
and	b.nr_seq_trans_financ	= c.nr_sequencia
and	b.nr_seq_saldo_banco	= nr_seq_banco_saldo_p
and	coalesce(dt_compensacao::text, '') = ''
and	coalesce(dt_cancelamento::text, '') = '';

select 	sum(CASE WHEN c.ie_banco='C' THEN a.vl_cheque * -1  ELSE a.vl_cheque END ) vl_cheque_cr
into STRICT	vl_cheque_cr_w
from 	cheque_cr a,
	movto_trans_financ b,
	transacao_financeira c
where	a.nr_seq_cheque		= b.nr_seq_cheque
and	b.nr_seq_trans_financ	= c.nr_sequencia
and	b.nr_seq_saldo_banco	= nr_seq_banco_saldo_p
and	coalesce(dt_compensacao::text, '') = '';

vl_cheque_w := coalesce(vl_cheque_cp_w,0) 	+ coalesce(vl_cheque_cr_w,0);

return vl_cheque_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_vl_cheque_banco_saldo (nr_seq_banco_saldo_p bigint) FROM PUBLIC;

