-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_mat_estabelecimento ( cd_estabelecimento_p bigint, cd_estabelecimento_base_p bigint, cd_material_p bigint, ie_campo_p text) RETURNS bigint AS $body$
DECLARE


/* campos para retorno (ie_campo_p)
MI	- qt_estoque_minimo_w
PP	- qt_ponto_pedido_w
MA	- qt_estoque_maximo_w
IR	- qt_dia_interv_ressup_w
RF	- qt_dia_ressup_forn_w
DM	- qt_dia_estoque_minimo_w
DC	- nr_minimo_cotacao_w
CM	- qt_consumo_mensal_w
CMR	- t_consumo_mensal_ressup_w
MC	- cd_material_conta_w
KT	- cd_kit_material_w
KG	- qt_peso_kg_w
DP	- Desvio padrao
QC	- qt_mes_consumo

*/
cd_estabelecimento_base_w		integer;
qt_estoque_minimo_w		double precision;
qt_ponto_pedido_w			double precision;
qt_estoque_maximo_w		double precision;
qt_dia_interv_ressup_w		smallint;
qt_dia_ressup_forn_w		smallint;
qt_dia_estoque_minimo_w		smallint;
nr_minimo_cotacao_w		smallint;
qt_consumo_mensal_w		double precision;
qt_consumo_mensal_ressup_w	double precision;
cd_material_conta_w		integer;
cd_kit_material_w			integer;
vl_retorno_w			double precision;
vl_resultado_w			double precision;
qt_peso_kg_w			double precision;
qt_reg_w				bigint;
qt_desvio_padrao_cons_w		double precision;
qt_mes_consumo_w		bigint;



BEGIN

select	count(*)
into STRICT	qt_reg_w
from	material_estab
where	cd_material = cd_material_p
and	cd_estabelecimento = cd_estabelecimento_p;

if (qt_reg_w > 0) then
	select	qt_estoque_minimo,
		qt_ponto_pedido,
		qt_estoque_maximo,
		qt_dia_interv_ressup,
		qt_dia_ressup_forn,
		qt_dia_estoque_minimo,
		nr_minimo_cotacao,
		qt_consumo_mensal,
		cd_material_conta,
		cd_kit_material,
		qt_peso_kg,
		qt_desvio_padrao_cons,
		qt_mes_consumo,
		qt_consumo_mensal_ressup
	into STRICT	qt_estoque_minimo_w,
		qt_ponto_pedido_w,
		qt_estoque_maximo_w,
		qt_dia_interv_ressup_w,
		qt_dia_ressup_forn_w,
		qt_dia_estoque_minimo_w,
		nr_minimo_cotacao_w,
		qt_consumo_mensal_w,
		cd_material_conta_w,
		cd_kit_material_w,
		qt_peso_kg_w,
		qt_desvio_padrao_cons_w,
		qt_mes_consumo_w,
		qt_consumo_mensal_ressup_w
	from	material_estab
	where	cd_material = cd_material_p
	and	cd_estabelecimento = cd_estabelecimento_p;
else
	cd_estabelecimento_base_w	:= cd_estabelecimento_base_p;
	if (cd_estabelecimento_base_p = 0) or (coalesce(cd_estabelecimento_base_p::text, '') = '') then
		select	coalesce(max(cd_estabelecimento_base),0)
		into STRICT	cd_estabelecimento_base_w
		from	parametro_geral_tasy;
	end if;
	if (cd_estabelecimento_p = cd_estabelecimento_base_w) then
		select	qt_estoque_minimo,
			qt_ponto_pedido,
			qt_estoque_maximo,
			qt_dia_interv_ressup,
			qt_dia_ressup_forn,
			qt_dia_estoque_minimo,
			nr_minimo_cotacao,
			qt_consumo_mensal,
			cd_material_conta,
			cd_kit_material
		into STRICT	qt_estoque_minimo_w,
			qt_ponto_pedido_w,
			qt_estoque_maximo_w,
			qt_dia_interv_ressup_w,
			qt_dia_ressup_forn_w,
			qt_dia_estoque_minimo_w,
			nr_minimo_cotacao_w,
			qt_consumo_mensal_w,
			cd_material_conta_w,
			cd_kit_material_w
		from	material
		where	cd_material = cd_material_p;
	end if;
end if;

if (ie_campo_p = 'MI') then
	vl_resultado_w	:= qt_estoque_minimo_w;
elsif (ie_campo_p = 'PP') then
	vl_resultado_w	:= qt_ponto_pedido_w;
elsif (ie_campo_p = 'MA') then
	vl_resultado_w	:= qt_estoque_maximo_w;
elsif (ie_campo_p = 'IR') then
	vl_resultado_w	:= qt_dia_interv_ressup_w;
elsif (ie_campo_p = 'RF') then
	vl_resultado_w	:= qt_dia_ressup_forn_w;
elsif (ie_campo_p = 'DM') then
	vl_resultado_w	:= qt_dia_estoque_minimo_w;
elsif (ie_campo_p = 'DC') then
	vl_resultado_w	:= nr_minimo_cotacao_w;
elsif (ie_campo_p = 'CM') then
	vl_resultado_w	:= qt_consumo_mensal_w;
elsif (ie_campo_p = 'MC') then
	vl_resultado_w	:= cd_material_conta_w;
elsif (ie_campo_p = 'KT') then
	vl_resultado_w	:= cd_kit_material_w;
elsif (ie_campo_p = 'KG') then
	vl_resultado_w	:= qt_peso_kg_w;
elsif (ie_campo_p = 'DP') then
	vl_resultado_w	:= qt_desvio_padrao_cons_w;
elsif (ie_campo_p = 'QC') then
	vl_resultado_w	:= qt_mes_consumo_w;
elsif (ie_campo_p = 'CMR') then
	vl_resultado_w	:= qt_consumo_mensal_ressup_w;
end if;

vl_retorno_w	:= vl_resultado_w;

RETURN vl_retorno_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_mat_estabelecimento ( cd_estabelecimento_p bigint, cd_estabelecimento_base_p bigint, cd_material_p bigint, ie_campo_p text) FROM PUBLIC;

