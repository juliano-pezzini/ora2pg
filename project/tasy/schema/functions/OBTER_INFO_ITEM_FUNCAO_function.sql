-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_info_item_funcao (nr_seq_obj_inf_p bigint, ie_tipo_obj_sup_p text, nr_seq_fun_schematic_p bigint, ie_tipo_info_p text default null) RETURNS bigint AS $body$
DECLARE


nr_sequencia_w		objeto_schematic.nr_sequencia%type;
nr_seq_obj_sup_w	objeto_schematic.nr_seq_obj_sup%type;
cd_exp_desc_obj_w	objeto_schematic.cd_exp_desc_obj%type;
nr_seq_item_pepo_w	pepo_item.nr_sequencia%type;WITH RECURSIVE cte AS (



BEGIN

select 	a.nr_sequencia,a.nr_seq_obj_sup,a.cd_exp_desc_obj
into STRICT	nr_sequencia_w,nr_seq_obj_sup_w,cd_exp_desc_obj_w
from 	objeto_schematic a WHERE a.nr_sequencia = nr_seq_obj_inf_p
  UNION ALL



BEGIN

select 	a.nr_sequencia,a.nr_seq_obj_sup,a.cd_exp_desc_obj
into STRICT	nr_sequencia_w,nr_seq_obj_sup_w,cd_exp_desc_obj_w
from 	objeto_schematic a JOIN cte c ON (c.nr_seq_obj_sup = a.nr_sequencia)

) SELECT * FROM cte WHERE ie_tipo_objeto = ie_tipo_obj_sup_p
and 	nr_seq_funcao_schematic = nr_seq_fun_schematic_p
and 	nr_sequencia <> nr_seq_obj_inf_p;
;

if (ie_tipo_info_p = 'CDEXP') then
	return cd_exp_desc_obj_w;	
elsif (ie_tipo_info_p = 'NRSUP') then
	return nr_seq_obj_sup_w;
elsif (ie_tipo_info_p = 'NRITEMPEPO') then
	select 	a.nr_sequencia
	into STRICT	nr_seq_item_pepo_w
	from   	pepo_item a
	where  	coalesce(a.nr_seq_superior::text, '') = ''
	and (a.ie_situacao_html5 = 'A' or coalesce(a.ie_situacao_html5::text, '') = '')
	and (OBTER_ITEM_ARVORE_PEPO(a.nr_sequencia, null) = nr_sequencia_w);
	
	return nr_seq_item_pepo_w;
else
	return nr_sequencia_w;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_info_item_funcao (nr_seq_obj_inf_p bigint, ie_tipo_obj_sup_p text, nr_seq_fun_schematic_p bigint, ie_tipo_info_p text default null) FROM PUBLIC;

