-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_icone_apap ( ie_grupo_p valor_dominio.vl_dominio%type, nm_usuario_p usuario.nm_usuario%type default null, ie_opcao_p valor_dominio.vl_dominio%type default null) RETURNS varchar AS $body$
DECLARE


ds_caminho_w 				w_apap_legenda.ds_caminho%TYPE		:= null;
nr_sequencia_w				w_apap_legenda.nr_sequencia%TYPE	:= null;
ie_profissional_medico_w	valor_dominio.vl_dominio%TYPE		:= 'N';
ds_retorno_w				w_apap_legenda.ds_caminho%TYPE		:= null;

BEGIN

if (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '') then
	ie_profissional_medico_w := obter_se_usuario_medico(nm_usuario_p);
end if;	

SELECT	MAX(wal.ds_caminho),
		max(wal.nr_sequencia)
INTO STRICT 	ds_caminho_w,
		nr_sequencia_w
FROM	w_apap_legenda wal
WHERE 	1 = 1
AND 	wal.ie_grupo = ie_grupo_p
AND 	wal.ie_profissional_medico = ie_profissional_medico_w;

if (coalesce(ie_opcao_p,'C') = 'C') then	
	ds_retorno_w	:= 	ds_caminho_w;
else	
	ds_retorno_w	:= 	nr_sequencia_w;
end if;

RETURN	ds_retorno_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 IMMUTABLE;
-- REVOKE ALL ON FUNCTION obter_icone_apap ( ie_grupo_p valor_dominio.vl_dominio%type, nm_usuario_p usuario.nm_usuario%type default null, ie_opcao_p valor_dominio.vl_dominio%type default null) FROM PUBLIC;

