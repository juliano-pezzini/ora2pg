-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_proc_conv_agenda (cd_estabelecimento_p bigint, cd_agenda_p bigint, cd_convenio_p bigint, cd_procedimento_p bigint, ie_origem_proced_p bigint, nr_seq_proc_interno_p bigint, cd_medico_p text) RETURNS varchar AS $body$
DECLARE

ds_erro_w		varchar(255);
ie_agenda_w		varchar(1);
cd_procedimento_w	bigint;
ie_origem_proced_w	bigint;
cd_retorno_w		bigint;
ie_restringir_w		varchar(1);


BEGIN 
cd_procedimento_w	:= cd_procedimento_p;
ie_origem_proced_w	:= ie_origem_proced_p;
 
 
ie_restringir_w := Obter_Param_Usuario(-1007, 23, obter_perfil_ativo, wheb_usuario_pck.get_nm_usuario, wheb_usuario_pck.get_cd_estabelecimento, ie_restringir_w);
 
if (ie_restringir_w = 'S') then 
 
	if (coalesce(nr_seq_proc_interno_p,0) > 0) then 
		SELECT * FROM obter_procedimento_tab_interna(nr_seq_proc_interno_p, cd_convenio_p, cd_estabelecimento_p, clock_timestamp(), cd_procedimento_w, ie_origem_proced_w) INTO STRICT cd_procedimento_w, ie_origem_proced_w;
	end if;
	 
	SELECT * FROM consistir_proc_conv_global(cd_estabelecimento_p, null, trunc(clock_timestamp()), cd_agenda_p, cd_convenio_p, null, cd_procedimento_w, ie_origem_proced_w, nr_seq_proc_interno_p, cd_medico_p, 'E', null, ds_erro_w, ie_agenda_w, null, cd_retorno_w) INTO STRICT ds_erro_w, ie_agenda_w, cd_retorno_w;
	 
else 
	ie_agenda_w	:= 'S';
end if;
	 
return ie_agenda_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_proc_conv_agenda (cd_estabelecimento_p bigint, cd_agenda_p bigint, cd_convenio_p bigint, cd_procedimento_p bigint, ie_origem_proced_p bigint, nr_seq_proc_interno_p bigint, cd_medico_p text) FROM PUBLIC;

