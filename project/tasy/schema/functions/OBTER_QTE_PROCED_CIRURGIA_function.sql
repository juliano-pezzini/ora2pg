-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_qte_proced_cirurgia ( cd_procedimento_p bigint, ie_origem_proced_p bigint, dt_procedimento_p timestamp, dt_inicio_procedimento_p timestamp) RETURNS bigint AS $body$
DECLARE


nr_dias_w	integer;
nr_horas_w	double precision;
nr_minutos_w	integer;
ie_forma_apresentacao_w	smallint;

nr_horas_ww	double precision;



BEGIN

nr_dias_w 	:= TRUNC(dt_procedimento_p - dt_inicio_procedimento_p);
nr_horas_w	:= TRUNC((dt_procedimento_p - dt_inicio_procedimento_p) * 24);
nr_minutos_w	:= (((dt_procedimento_p - dt_inicio_procedimento_p) * 24)) * 60;

nr_horas_ww	:= (dt_procedimento_p - dt_inicio_procedimento_p) * 24;

if (mod(nr_horas_ww,2) > 0) then
	nr_horas_ww:= trunc(nr_horas_ww) + 1;
end if;

SELECT	max(ie_forma_apresentacao)
INTO STRICT	ie_forma_apresentacao_w
FROM	procedimento
WHERE	cd_procedimento		= cd_procedimento_p
AND	ie_origem_proced	= ie_origem_proced_p;

IF (ie_forma_apresentacao_W = 2) THEN
	RETURN nr_minutos_w;
ELSIF (ie_forma_apresentacao_W = 3) THEN
	RETURN ((nr_dias_w * 24) + nr_horas_w);
ELSIF (ie_forma_apresentacao_w = 10) THEN
	if	((nr_minutos_w / 30) > round(nr_minutos_w / 30)) then
		RETURN coalesce(round(nr_minutos_w / 30) + 1,0);
	else
		RETURN coalesce(round(nr_minutos_w / 30),0);
	end if;
ELSIF (ie_forma_apresentacao_W = 11) THEN
	RETURN nr_horas_ww;
ELSIF (ie_forma_apresentacao_W = 12) THEN
	RETURN mod(trunc(nr_minutos_w),60);
ELSIF (ie_forma_apresentacao_W = 13) THEN
	if (mod(trunc(nr_minutos_w),60) > 0) then
		if (mod(trunc(nr_minutos_w),60) > 30) then
			RETURN 2;
		else
			RETURN 1;
		end if;
	else		
		RETURN 0;
	end if;	
ELSIF (ie_forma_apresentacao_W = 14) THEN
	if (nr_minutos_w <= 60) then
		return 1;	
	else
		nr_minutos_w := nr_minutos_w - 60;
		if	((nr_minutos_w / 30) > round(nr_minutos_w / 30)) then
			RETURN coalesce(round(nr_minutos_w / 30) + 1,0);
		else
			RETURN coalesce(round(nr_minutos_w / 30),0);
		end if;
	end if;
ELSIF (ie_forma_apresentacao_W = 15) THEN
	if (nr_minutos_w <= 75) then
		return 1;	
	else
		nr_minutos_w := nr_minutos_w - 75;
		
		if	((nr_minutos_w / 60) > round(nr_minutos_w / 60)) then
			RETURN coalesce(round(nr_minutos_w / 60) + 1,0) + 1;
		else
			RETURN coalesce(round(nr_minutos_w / 60),0) + 1;
		end if;
	end if;	
ELSIF (ie_forma_apresentacao_W = 17) THEN
	if (nr_minutos_w <= 60) then
		return 0;
	else
		return nr_minutos_w - 60;
	end if;
END 	IF;

END	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_qte_proced_cirurgia ( cd_procedimento_p bigint, ie_origem_proced_p bigint, dt_procedimento_p timestamp, dt_inicio_procedimento_p timestamp) FROM PUBLIC;

