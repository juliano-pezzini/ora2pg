-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_email_valido (ds_email_p text) RETURNS varchar AS $body$
DECLARE

	
ds_email_w	varchar(255);
ds_direita_w	varchar(255);
ds_esquerda_w	varchar(255);
nao_permite_w	varchar(255);
nao_permite_wx	varchar(255);
nao_permite_wy	varchar(255);
ie_valido_w	varchar(255);
qt_erro_w	bigint;
i		bigint;
ie_ponto_w	bigint;


BEGIN

ie_valido_w		:=	'N';
nao_permite_w	:=	chr(31)||chr(32)||chr(34)||chr(231)||chr(199)||chr(33)||chr(35)||chr(36)||chr(37)||chr(168)||chr(38)||chr(42)||chr(40)||chr(41)||chr(43)||chr(123)||chr(125)||chr(91)||chr(93)||chr(96)||chr(94)||chr(126)||chr(47)||chr(92)||chr(191)||chr(63)||chr(60)||chr(62)||chr(171)||chr(187)||chr(58)||chr(59)||chr(44)||chr(124)||chr(181)||chr(166)||chr(185)||chr(178)||chr(179)||chr(175)||chr(183)||chr(180)||chr(151)||chr(180);
nao_permite_wx := chr(225)||chr(193)||chr(233)||chr(201)||chr(237)||chr(205)||chr(243)||chr(211)||chr(250)||chr(218)||chr(224)||chr(192)||chr(232)||chr(200)||chr(236)||chr(204)||chr(242)||chr(210)||chr(217)||chr(249)||chr(226)||chr(194)||chr(202)||chr(234)||chr(238)||chr(206)||chr(212)||chr(244)||chr(251)||chr(219)||chr(195)||chr(227)||chr(245)||chr(213)||chr(196)||chr(228)||chr(235)||chr(203)||chr(207)||chr(239)||chr(246)||chr(214)||chr(220)||chr(252);


     

if (ds_email_p IS NOT NULL AND ds_email_p::text <> '') then

	ds_email_w	:=	ds_email_p;	

	if position('@' in ds_email_w) > 0 then	
		if not(ds_email_w like '%@%@%') and
			not(ds_email_w like '%..%') and 
			not(substr(ds_email_w, 1, 1) = '.') and 
			not(substr(ds_email_w, length(ds_email_w), length(ds_email_w))	= '.') then
			i		:= 1;
			qt_erro_w	:= 0;

			while(i <> length(nao_permite_w)) and (qt_erro_w = 0)loop
				if (position(substr(nao_permite_w,i,1) in ds_email_w) > 0) or (position(substr(nao_permite_wx,i,1) in ds_email_w) > 0) then				
					qt_erro_w	:=	1;
				end if;
				i	:=	i + 1;
			end loop;

			if (qt_erro_w = 0) then		
  				ds_esquerda_w	:=	substr(ds_email_w, 1, position('@' in ds_email_w) -1);
						
				if (ds_esquerda_w IS NOT NULL AND ds_esquerda_w::text <> '') then		
					if not(substr(ds_esquerda_w, length(ds_esquerda_w), length(ds_esquerda_w))	= '.') then
						ds_direita_w	:=	substr(ds_email_w, position('@' in ds_email_w) + 1,length(ds_email_w));	
	
						if (ds_direita_W IS NOT NULL AND ds_direita_W::text <> '') then						
							if not(substr(ds_direita_w, 1, 1) = '.') then								
								select	position('.' in ds_direita_w)
								into STRICT	ie_ponto_w
								;							
							
								if (ie_ponto_w > 0)  then
									ie_valido_w	:= 'S';
								end if;							
							end if;
						end if;	
					end if;
				end if;
			end if;
		end if;
	end if;
end if;

return ie_valido_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_email_valido (ds_email_p text) FROM PUBLIC;

