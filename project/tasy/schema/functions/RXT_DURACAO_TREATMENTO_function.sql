-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION rxt_duracao_treatmento ( nr_seq_tumor_p bigint, nm_usuario_p text, nr_seq_protocolo_p bigint) RETURNS bigint AS $body$
DECLARE

  ie_braquiterapia_prot_w varchar(1);
  ie_tipo_trat_w          varchar(2);
  qt_duracao_trat_w       bigint;

BEGIN
  ie_braquiterapia_prot_w := obter_valor_param_usuario(3030, 31, obter_perfil_ativo, nm_usuario_p, wheb_usuario_pck.get_cd_estabelecimento);
  SELECT coalesce(MAX(rxt_obter_tipo_trat_prot(nr_seq_protocolo_p)),'X')
  INTO STRICT ie_tipo_trat_w
;
  IF (ie_tipo_trat_w <> 'R') AND ((ie_tipo_trat_w <> 'B') OR (ie_braquiterapia_prot_w = 'N')) THEN
    SELECT coalesce(SUM(coalesce(qt_dia_trat,0)),0)
    INTO STRICT qt_duracao_trat_w
    FROM rxt_fase_protocolo
    WHERE nr_seq_protocolo = nr_seq_protocolo_p;
  elsif (ie_tipo_trat_w    = 'R') THEN
    SELECT coalesce(SUM(coalesce(qt_dia_trat,0)),0)
    INTO STRICT qt_duracao_trat_w
    FROM rxt_campo_prot_roentgen
    WHERE nr_seq_protocolo = nr_seq_protocolo_p;
  elsif (ie_tipo_trat_w    = 'B') OR (ie_braquiterapia_prot_w = 'S') THEN
   SELECT coalesce(SUM(coalesce(ie_frequencia,0)),0)
    INTO STRICT qt_duracao_trat_w
    FROM rxt_protocolo
    WHERE nr_sequencia = nr_seq_protocolo_p;
  END IF;
RETURN qt_duracao_trat_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION rxt_duracao_treatmento ( nr_seq_tumor_p bigint, nm_usuario_p text, nr_seq_protocolo_p bigint) FROM PUBLIC;

