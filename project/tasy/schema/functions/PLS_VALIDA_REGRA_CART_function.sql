-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_valida_regra_cart ( nr_seq_segurado_p bigint, nr_seq_regra_atend_cart_p bigint) RETURNS varchar AS $body$
DECLARE


cd_carteira_w			varchar(255);
cd_usuario_plano_w		varchar(30);
cd_faixa_carteira_w		varchar(30);
ie_valido_w			varchar(1)	:= 'N';
nr_seq_oc_atend_cart_regra_w	bigint;
qt_pos_inicio_w			bigint;
qt_pos_final_w			bigint;

C01 CURSOR FOR
	SELECT	a.nr_sequencia,
		a.qt_pos_inicio,
		a.qt_pos_final
	from	pls_oc_atend_cart_regra	a
	where	a.nr_seq_regra	= nr_seq_regra_atend_cart_p;

C02 CURSOR( nr_seq_oc_atend_cart_regra_pc 	pls_oc_atend_cart_regra.nr_sequencia%type,
	     cd_carteira_pc			pls_oc_atend_cart_cod.cd_carteira%type) FOR
	SELECT	a.cd_carteira, nr_seq_regra_cart
	from	pls_oc_atend_cart_cod	a
	where	a.nr_seq_regra_cart	= nr_seq_oc_atend_cart_regra_pc
	AND	a.cd_carteira 		= cd_carteira_pc;
BEGIN

if (nr_seq_segurado_p IS NOT NULL AND nr_seq_segurado_p::text <> '') then
	cd_usuario_plano_w	:= pls_obter_dados_segurado(nr_seq_segurado_p,'C');

	for r_c01_w in C01() loop
		begin

		qt_pos_inicio_w	:= r_c01_w.qt_pos_inicio;
		qt_pos_final_w	:= r_c01_w.qt_pos_final;

		cd_faixa_carteira_w	:= substr(cd_usuario_plano_w,qt_pos_inicio_w,(qt_pos_final_w - qt_pos_inicio_w)+1);

		for r_c02_w in C02(r_c01_w.nr_sequencia, cd_faixa_carteira_w) loop
			begin

				ie_valido_w	:= 'S';
				exit;


			end;
		end loop;

		if (ie_valido_w	= 'S') then
			exit;
		end if;

		end;
	end loop;
end if;

return ie_valido_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_valida_regra_cart ( nr_seq_segurado_p bigint, nr_seq_regra_atend_cart_p bigint) FROM PUBLIC;

