-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_particip_medico_rec (cd_procedimento_p bigint, ie_origem_proced_p bigint, dt_inicial_p timestamp, dt_final_p timestamp, cd_medico_p text, vl_origem_p bigint) RETURNS bigint AS $body$
DECLARE

 
pr_particip_w		double precision	:= 0;
vl_total_w		double precision	:= 0;


BEGIN 
 
select	sum(b.vl_procedimento) 
into STRICT	vl_total_w 
from	procedimento c, 
	procedimento_paciente b, 
	atendimento_paciente a 
where	a.nr_atendimento	= b.nr_atendimento 
and	b.cd_procedimento	= c.cd_procedimento 
and	b.ie_origem_proced	= c.ie_origem_proced 
and	a.cd_medico_resp	= coalesce(cd_medico_p, a.cd_medico_resp) 
and	b.cd_procedimento	= cd_procedimento_p 
and	b.ie_origem_proced	= ie_origem_proced_p 
and	trunc(dt_entrada, 'dd') between dt_inicial_p and dt_final_p + 86400/86300;
 
pr_particip_w	:= dividir(vl_origem_p, vl_total_w) * 100;
 
return	pr_particip_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_particip_medico_rec (cd_procedimento_p bigint, ie_origem_proced_p bigint, dt_inicial_p timestamp, dt_final_p timestamp, cd_medico_p text, vl_origem_p bigint) FROM PUBLIC;

