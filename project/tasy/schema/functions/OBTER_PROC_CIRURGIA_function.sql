-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_proc_cirurgia (nr_atendimento_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


/* IE_OPCAO_P

C	- Código
D	- Descrição
*/
cd_procedimento_princ_w	bigint;
ds_procedimento_w	PROCEDIMENTO.DS_PROCEDIMENTO%type;
ds_retorno_w		varchar(300);


BEGIN

SELECT	max(a.cd_procedimento_princ),
	max(b.ds_procedimento)
INTO STRICT	cd_procedimento_princ_w,
	ds_procedimento_w
FROM	procedimento b,
	cirurgia a
WHERE	a.nr_atendimento	= nr_atendimento_p
AND	a.cd_procedimento_princ	= b.cd_procedimento
AND	a.ie_origem_proced	= b.ie_origem_proced;

IF (ie_opcao_p		= 'C') THEN
	ds_retorno_w		:= cd_procedimento_princ_w;
ELSIF (ie_opcao_p		= 'D') THEN
	ds_retorno_w		:= ds_procedimento_w;
END IF;

RETURN	ds_retorno_w;

END	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_proc_cirurgia (nr_atendimento_p bigint, ie_opcao_p text) FROM PUBLIC;

