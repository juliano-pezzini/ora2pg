-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_vl_orcamento_contab (cd_centro_custo_p text, dt_inicio_p timestamp, dt_fim_p timestamp) RETURNS bigint AS $body$
DECLARE

vl_realizado_w			double precision;

BEGIN



if (upper(cd_centro_custo_p) like upper('GEN')) then
	select	sum(a.vl_realizado)
	into STRICT	vl_realizado_w
	from	ctb_orcamento a
	where	a.cd_conta_contabil in (3131, 3130, 3135, 3136)
	and		a.nr_seq_mes_ref in (SELECT b.nr_sequencia
								from   ctb_mes_ref b
								where  b.dt_referencia between inicio_dia(dt_inicio_p) and fim_dia(dt_fim_p));

	else if (upper(cd_centro_custo_p) like upper('QR')) then
		select	sum(a.vl_realizado)
		into STRICT	vl_realizado_w
		from	ctb_orcamento a
		where	a.cd_conta_contabil in (3131, 3130, 3135, 3136)
		and		a.cd_centro_custo in (91,104)
		and		a.nr_seq_mes_ref in (SELECT b.nr_sequencia
									from   ctb_mes_ref b
									where  b.dt_referencia between inicio_dia(dt_inicio_p) and fim_dia(dt_fim_p));

		else if (upper(cd_centro_custo_p) like upper('FA')) then
			select	sum(a.vl_realizado)
			into STRICT	vl_realizado_w
			from	ctb_orcamento a
			where	a.cd_conta_contabil in (3131, 3130, 3135, 3136)
			and		a.cd_centro_custo in (12,105)
			and		a.nr_seq_mes_ref in (SELECT b.nr_sequencia
										from   ctb_mes_ref b
										where  b.dt_referencia between inicio_dia(dt_inicio_p) and fim_dia(dt_fim_p));

			else if (upper(cd_centro_custo_p) like upper('HR')) then
				select	sum(a.vl_realizado)
				into STRICT	vl_realizado_w
				from	ctb_orcamento a
				where	a.cd_conta_contabil in (3131, 3130, 3135, 3136)
				and		a.cd_centro_custo in (26,106)
				and		a.nr_seq_mes_ref in (SELECT b.nr_sequencia
											from   ctb_mes_ref b
											where  b.dt_referencia between inicio_dia(dt_inicio_p) and fim_dia(dt_fim_p));

				else if (upper(cd_centro_custo_p) like upper('SM')) then
					select	sum(a.vl_realizado)
					into STRICT	vl_realizado_w
					from	ctb_orcamento a
					where	a.cd_conta_contabil in (3131, 3130, 3135, 3136)
					and		a.cd_centro_custo in (16, 42, 41, 43, 13, 14, 24, 136, 137, 107)
					and		a.nr_seq_mes_ref in (SELECT b.nr_sequencia
												from   ctb_mes_ref b
												where  b.dt_referencia between inicio_dia(dt_inicio_p) and fim_dia(dt_fim_p));

					else if (upper(cd_centro_custo_p) like upper('RD')) then
						select	sum(a.vl_realizado)
						into STRICT	vl_realizado_w
						from	ctb_orcamento a
						where	a.cd_conta_contabil in (3131, 3130, 3135, 3136)
						and		a.cd_centro_custo in (17, 7, 36, 31, 32, 33, 34, 35, 37, 23, 114, 115)
						and		a.nr_seq_mes_ref in (SELECT b.nr_sequencia
													from   ctb_mes_ref b
													where  b.dt_referencia between inicio_dia(dt_inicio_p) and fim_dia(dt_fim_p));

						else if (upper(cd_centro_custo_p) like upper('SCS')) then
							select	sum(a.vl_realizado)
							into STRICT	vl_realizado_w
							from	ctb_orcamento a
							where	a.cd_conta_contabil in (3131, 3130, 3135, 3136)
							and		a.cd_centro_custo in (29, 30, 68, 76, 92, 8, 21, 95, 39, 28, 122, 123, 124, 132, 133)
							and		a.nr_seq_mes_ref in (SELECT b.nr_sequencia
													    from   ctb_mes_ref b
														where  b.dt_referencia between inicio_dia(dt_inicio_p) and

fim_dia(dt_fim_p));
							else if (upper(cd_centro_custo_p) like upper('HTML5')) then
								select	sum(a.vl_realizado)
								into STRICT	vl_realizado_w
								from	ctb_orcamento a
								where	a.cd_conta_contabil in (3131, 3130, 3135, 3136)
								and		a.cd_centro_custo in (206)
								and		a.nr_seq_mes_ref in (SELECT b.nr_sequencia
												    from   ctb_mes_ref b
													where  b.dt_referencia between inicio_dia(dt_inicio_p) and fim_dia(dt_fim_p));
							end if;
						end if;

					end if;
				end if;
			end if;
		end if;
	end if;
end if;

if (coalesce(vl_realizado_w::text, '') = '') then
	vl_realizado_w := 0;
end if;

return	vl_realizado_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_vl_orcamento_contab (cd_centro_custo_p text, dt_inicio_p timestamp, dt_fim_p timestamp) FROM PUBLIC;

