-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_status_lib_repasse (nr_seq_proc_rep_p bigint, nr_seq_mat_rep_p bigint) RETURNS varchar AS $body$
DECLARE


ds_status_w				varchar(255)	:= obter_desc_expressao(347311);--'NÃ£o encontrado';
vl_repasse_w			double precision;
vl_liberado_w			double precision;
vl_original_repasse_w	double precision;


BEGIN

if (nr_seq_proc_rep_p IS NOT NULL AND nr_seq_proc_rep_p::text <> '') then

	select	coalesce(max(a.vl_liberado),0),
		coalesce(max(a.vl_original_repasse),0),
		coalesce(max(a.vl_repasse),0)
	into STRICT	vl_liberado_w,
		vl_original_repasse_w,
		vl_repasse_w
	from	procedimento_repasse a
	where	a.nr_sequencia	= nr_seq_proc_rep_p;

	if (vl_liberado_w <> 0) and (vl_liberado_w = vl_repasse_w) then
		ds_status_w	:= obter_desc_expressao(725610);--'Total';
	elsif (vl_original_repasse_w = vl_repasse_w) then
		ds_status_w	:= obter_desc_expressao(295406);--'Pendente';
	else
		ds_status_w	:= obter_desc_expressao(295282);--'Parcial';
	end if;

elsif (nr_seq_mat_rep_p IS NOT NULL AND nr_seq_mat_rep_p::text <> '') then

	select	coalesce(max(a.vl_liberado),0),
		coalesce(max(a.vl_original_repasse),0),
		coalesce(max(a.vl_repasse),0)
	into STRICT	vl_liberado_w,
		vl_original_repasse_w,
		vl_repasse_w
	from	material_repasse a
	where	a.nr_sequencia	= nr_seq_mat_rep_p;

	if (vl_liberado_w <> 0) and (vl_liberado_w = vl_repasse_w) then
		ds_status_w	:= obter_desc_expressao(725610);--'Total';
	elsif (vl_original_repasse_w = vl_repasse_w) then
		ds_status_w	:= obter_desc_expressao(295406);--'Pendente';
	else
		ds_status_w	:= obter_desc_expressao(295282);--'Parcial';
	end if;

end if;

RETURN ds_status_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_status_lib_repasse (nr_seq_proc_rep_p bigint, nr_seq_mat_rep_p bigint) FROM PUBLIC;

