-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_idade_imc_nom ( NR_ATENDIMENTO_P bigint, DT_NASCIMENTO_P timestamp, DT_AGENDA_P timestamp, IE_IMC_IDADE_P text) RETURNS bigint AS $body$
DECLARE


DS_RETORNO_W bigint;


BEGIN
IF (NR_ATENDIMENTO_P IS NOT NULL AND NR_ATENDIMENTO_P::text <> '') THEN
	IF (IE_IMC_IDADE_P = 'IMC') THEN
		IF (TO_CHAR(OBTER_SINAL_VITAL(NR_ATENDIMENTO_P, 'IMC')) > '30') THEN
		DS_RETORNO_W := 1;
		ELSIF (TO_CHAR(OBTER_SINAL_VITAL(NR_ATENDIMENTO_P, 'IMC')) BETWEEN '25' AND '29,9') THEN
		DS_RETORNO_W := 2;
		ELSIF (TO_CHAR(OBTER_SINAL_VITAL(NR_ATENDIMENTO_P, 'IMC')) BETWEEN '18,5' AND '24,9') THEN
		DS_RETORNO_W := 3;
		ELSIF (TO_CHAR(OBTER_SINAL_VITAL(NR_ATENDIMENTO_P, 'IMC')) < '18,4') THEN
		DS_RETORNO_W := 4;
		END IF;
	ELSIF ((IE_IMC_IDADE_P = 'EDAD') OR (IE_IMC_IDADE_P = 'CLAVEEDAD')) THEN
		IF (OBTER_IDADE(DT_NASCIMENTO_P, DT_AGENDA_P, 'M') = 0) THEN
			IF (IE_IMC_IDADE_P = 'EDAD') THEN
				DS_RETORNO_W := OBTER_IDADE(DT_NASCIMENTO_P, DT_AGENDA_P, 'DIAS');
			ELSE
				DS_RETORNO_W := 3;
			END IF;
		ELSIF (OBTER_IDADE(DT_NASCIMENTO_P, DT_AGENDA_P, 'M') < 12) THEN
			IF (IE_IMC_IDADE_P = 'EDAD') THEN
				DS_RETORNO_W := OBTER_IDADE(DT_NASCIMENTO_P, DT_AGENDA_P, 'M');
			ELSE
				DS_RETORNO_W := 4;
			END IF;
		ELSIF (OBTER_IDADE(DT_NASCIMENTO_P, DT_AGENDA_P, 'M') >= 12) THEN
			IF (IE_IMC_IDADE_P = 'EDAD') THEN
				DS_RETORNO_W := OBTER_IDADE(DT_NASCIMENTO_P, DT_AGENDA_P, 'A');
			ELSE
				DS_RETORNO_W := 5;
			END IF;
		END IF;
	END IF;
END IF;

RETURN DS_RETORNO_W;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_idade_imc_nom ( NR_ATENDIMENTO_P bigint, DT_NASCIMENTO_P timestamp, DT_AGENDA_P timestamp, IE_IMC_IDADE_P text) FROM PUBLIC;

