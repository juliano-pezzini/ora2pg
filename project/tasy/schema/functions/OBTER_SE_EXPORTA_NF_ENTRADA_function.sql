-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_exporta_nf_entrada (nr_sequencia_p bigint) RETURNS varchar AS $body$
DECLARE

			 
cd_estabelecimento_w		nota_fiscal.cd_estabelecimento%type;
ie_tipo_nota_w			nota_fiscal.ie_tipo_nota%type;
ie_servico_w			operacao_nota.ie_servico%type;
cd_municipio_ibge_w		pessoa_juridica.cd_municipio_ibge%type;
cd_municipio_estab_w		pessoa_juridica.cd_municipio_ibge%type;
ie_exporta_nfe_entrada_w	parametro_compras.ie_exporta_nfe_entrada%type;	
ds_retorno_w			varchar(1) := 'S';

 

BEGIN 
 
select	max(a.cd_estabelecimento), 
	max(a.ie_tipo_nota), 
	coalesce(max(o.ie_servico),'S'), 
	coalesce(max(nfse_obter_dados_pf_pj(cd_pessoa_fisica, cd_cgc,'CDM')),0) 
into STRICT	cd_estabelecimento_w, 
	ie_tipo_nota_w, 
	ie_servico_w, 
	cd_municipio_ibge_w 
from	nota_fiscal a, 
	operacao_nota o 
where	a.cd_operacao_nf = o.cd_operacao_nf 
and	a.nr_sequencia = nr_sequencia_p;
 
select	coalesce(nfse_obter_dados_pf_pj(null,cd_cgc_estab,'CDM'),0) 
into STRICT	cd_municipio_estab_w 
from (SELECT	max(cd_cgc) cd_cgc_estab 
	 from	estabelecimento 
	 where	cd_estabelecimento = cd_estabelecimento_w) alias3;
	 
select	coalesce(max(ie_exporta_nfe_entrada),'S') 
into STRICT	ie_exporta_nfe_entrada_w 
from	parametro_compras 
where	cd_estabelecimento = cd_estabelecimento_w;
 
if	(( or ) AND cd_municipio_ibge_w = cd_municipio_estab_w) then 
	begin 
	ds_retorno_w := 'N';
	end;
end if;
 
 
 
return	ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_exporta_nf_entrada (nr_sequencia_p bigint) FROM PUBLIC;

