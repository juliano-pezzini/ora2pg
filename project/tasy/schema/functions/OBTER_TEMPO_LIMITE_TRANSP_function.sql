-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_tempo_limite_transp (nr_atendimento_p bigint) RETURNS varchar AS $body$
DECLARE

ds_retorno_w		varchar(1) := 'S';
ds_tempo_limite_w	bigint;

BEGIN
ds_tempo_limite_w := Obter_param_Usuario(10050, 18, obter_perfil_ativo, obter_usuario_ativo, coalesce(wheb_usuario_pck.get_cd_estabelecimento, 1), ds_tempo_limite_w);
IF	((nr_atendimento_p IS NOT NULL AND nr_atendimento_p::text <> '') and (coalesce(ds_tempo_limite_w,0) > 0)) THEN
	select 	CASE WHEN count(*)=0 THEN 'N'  ELSE 'S' END
	into STRICT	ds_retorno_w
	from 	atendimento_paciente a
	where 	a.nr_atendimento = nr_atendimento_p
	and 	(   (  (a.dt_alta IS NOT NULL AND a.dt_alta::text <> '') 
                   and a.dt_alta between clock_timestamp()-(ds_tempo_limite_w/24/60) and clock_timestamp())
              or coalesce(a.dt_alta::text, '') = '');
END IF;
RETURN	ds_retorno_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_tempo_limite_transp (nr_atendimento_p bigint) FROM PUBLIC;

