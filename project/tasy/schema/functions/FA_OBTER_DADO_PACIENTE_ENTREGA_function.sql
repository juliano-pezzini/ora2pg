-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION fa_obter_dado_paciente_entrega (nr_atendimento_p bigint, cd_pessoa_fisica_p text, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE

 
ds_retorno_w		varchar(100);
dt_entrada_w		varchar(20);
cd_pessoa_fisica_w	varchar(10);
nm_pessoa_fisica_w	varchar(100);
nr_prontuario_w		varchar(10);
ds_senha_w		varchar(10);
ie_pmc_w		varchar(2);
ds_status_entrega_w	varchar(100);
ie_entrega_w		varchar(2);


BEGIN 
 
if (nr_atendimento_p IS NOT NULL AND nr_atendimento_p::text <> '') or (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') then 
 
	select	max(a.dt_entrada), 
		max(a.cd_pessoa_fisica), 
		max(obter_nome_pf(a.cd_pessoa_fisica)), 
		max(obter_prontuario_paciente(a.cd_pessoa_fisica)), 
		max(a.ds_senha), 
		max(CASE WHEN coalesce(a.nr_seq_paciente_pmc::text, '') = '' THEN 'N'  ELSE 'S' END ), 
		max(obter_valor_dominio(3460,a.ie_status_paciente)), 
		max(a.ie_status_paciente) 
	into STRICT	dt_entrada_w, 
		cd_pessoa_fisica_w, 
		nm_pessoa_fisica_w, 
		nr_prontuario_w, 
		ds_senha_w, 
		ie_pmc_w, 
		ds_status_entrega_w, 
		ie_entrega_w 
	from	fa_paciente_entrega a 
	where	((a.cd_pessoa_fisica = cd_pessoa_fisica_p) or (a.nr_atendimento = nr_atendimento_p));
	 
	if (ie_opcao_p = 'DT') then 
		ds_retorno_w	:=	dt_entrada_w;
	elsif (ie_opcao_p = 'CD') then 
		ds_retorno_w	:=	cd_pessoa_fisica_w;
	elsif (ie_opcao_p = 'NM') then 
		ds_retorno_w	:=	nm_pessoa_fisica_w;
	elsif (ie_opcao_p = 'PR') then 
		ds_retorno_w	:=	nr_prontuario_w;
	elsif (ie_opcao_p = 'SE') then 
		ds_retorno_w	:=	ds_senha_w;
	elsif (ie_opcao_p = 'PMC') then 
		ds_retorno_w	:= ie_pmc_w;
	elsif (ie_opcao_p = 'ENTREGA') then 
		ds_retorno_w	:= ds_status_entrega_w;
	elsif (ie_opcao_p = 'IE_ENT') then 
		ds_retorno_w	:=	ie_entrega_w;
	end if;
 
end if;
 
return	ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION fa_obter_dado_paciente_entrega (nr_atendimento_p bigint, cd_pessoa_fisica_p text, ie_opcao_p text) FROM PUBLIC;

