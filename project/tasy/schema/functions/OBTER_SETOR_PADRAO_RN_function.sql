-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_setor_padrao_rn ( nr_atendimento_p bigint, nm_usuario_p text ) RETURNS bigint AS $body$
DECLARE

 
cd_estabelecimento_w		bigint;
ds_regra_exibicao_setor_w	varchar(255);
ie_clinica_w				bigint;
ie_tipo_atendimento_w		bigint;
cd_convenio_w				bigint;
cd_categoria_w				bigint;
cd_setor_atendimeto_w		bigint;
		
 

BEGIN 
 
if (nr_atendimento_p IS NOT NULL AND nr_atendimento_p::text <> '') then 
 
	cd_estabelecimento_w := wheb_usuario_pck.get_cd_estabelecimento;
	ds_regra_exibicao_setor_w := obter_param_usuario(281, 624, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_w, ds_regra_exibicao_setor_w);
	 
	Select 	max(a.ie_tipo_atendimento), 
			max(a.ie_clinica), 
			max(b.cd_convenio), 
			max(b.cd_categoria) 
	into STRICT	ie_tipo_atendimento_w, 
			ie_clinica_w, 
			cd_convenio_w, 
			cd_categoria_w	 
	from	atendimento_paciente a, 
			ATEND_CATEGORIA_CONVENIO b 
	where	a.nr_atendimento = nr_atendimento_p 
	and		a.nr_atendimento = b.nr_atendimento;
 
	 
	SELECT  max(cd_setor_atendimento) 
	into STRICT	 cd_setor_atendimeto_w 
	FROM   SETOR_ATENDIMENTO 
	where  ie_situacao = 'A' 
	and   cd_estabelecimento = cd_estabelecimento_w 
	and   Obter_Se_Setor_Regra_Entrada(cd_setor_atendimento, ie_clinica_w,ie_tipo_atendimento_w, ds_regra_exibicao_setor_w, 0, cd_convenio_w, cd_categoria_w	, nm_usuario_p) = 'S' 
	and   substr(obter_se_cosns_setor_unid_conv(cd_setor_atendimento, nr_atendimento_p),1,1) = 'S' 
	and	   coalesce( IE_SETOR_RN,'S') = 'S' 
	and		 coalesce(IE_SETOR_PADRAO_RN,'N') = 'S';
	 
 
end if;
 
return cd_setor_atendimeto_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_setor_padrao_rn ( nr_atendimento_p bigint, nm_usuario_p text ) FROM PUBLIC;

