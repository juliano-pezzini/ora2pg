-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION gpt_se_item_doc_reval_atual ( nm_tabela_p text default null, nr_seq_cpoe_p bigint DEFAULT NULL, ie_gpt_item_p text default null, ie_opcao_p integer DEFAULT NULL, nm_usuario_nrec_p text default null, ie_tipo_item_p text default null, ie_tipo_grupo_p text default null) RETURNS varchar AS $body$
DECLARE


/*
ie_opcao_p:
1 - Retorna tipo do item se pendente
2 - Retorna se esta pendente (S)
*/
ds_retorno_w			varchar(5) := 'XPTO';
ie_profissional_w		usuario.ie_profissional%type;
ie_dados_usuario_w		usuario.ie_tipo_evolucao%type;
cd_perfil_w				perfil.cd_perfil%type;


BEGIN

if ((nm_tabela_p IS NOT NULL AND nm_tabela_p::text <> '') or (ie_gpt_item_p IS NOT NULL AND ie_gpt_item_p::text <> '')) and (nr_seq_cpoe_p IS NOT NULL AND nr_seq_cpoe_p::text <> '') and (ie_opcao_p IS NOT NULL AND ie_opcao_p::text <> '') then

	if (nm_usuario_nrec_p IS NOT NULL AND nm_usuario_nrec_p::text <> '') then

		ie_profissional_w := gpt_obter_Profissional_Usuario(nm_usuario_nrec_p);
		ie_dados_usuario_w := Obter_dados_usuario_opcao(nm_usuario_nrec_p, 'F');
		cd_perfil_w := wheb_usuario_pck.get_cd_perfil;

		if(('S' = gpt_obter_se_apresenta_grupo(cd_perfil_w, ie_tipo_grupo_p)) and (
			(((ie_profissional_w IS NOT NULL AND ie_profissional_w::text <> '') and  gpt_funcao_prescr_liberada(cd_perfil_w ,ie_profissional_w) = 'S') or
			((coalesce(ie_profissional_w::text, '') = '') and gpt_funcao_prescr_liberada(cd_perfil_w ,ie_dados_usuario_w) = 'S')))) then

				if (ie_opcao_p = 1) then
					ds_retorno_w := ie_tipo_item_p;
				else
					ds_retorno_w := 'S';
				end if;

		end if;

	end if;

end if;

	return ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION gpt_se_item_doc_reval_atual ( nm_tabela_p text default null, nr_seq_cpoe_p bigint DEFAULT NULL, ie_gpt_item_p text default null, ie_opcao_p integer DEFAULT NULL, nm_usuario_nrec_p text default null, ie_tipo_item_p text default null, ie_tipo_grupo_p text default null) FROM PUBLIC;

