-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_status_approv_disc_summary (nr_sequencia_p bigint) RETURNS varchar AS $body$
DECLARE

  dt_submit_w      timestamp;
  dt_approval_w    timestamp;
  dt_disapproval_w timestamp;
  ds_result_w      valor_dominio.vl_dominio%TYPE;

BEGIN
    SELECT dt_liberacao, 
           dt_approval, 
           dt_disapproval 
    INTO STRICT   dt_submit_w, dt_approval_w, dt_disapproval_w 
    FROM   atend_sumario_alta 
    WHERE  nr_sequencia = nr_sequencia_p;

    IF ( coalesce(dt_submit_w::text, '') = '' ) THEN 
      ds_result_w := 'AS';
    ELSIF (dt_disapproval_w IS NOT NULL AND dt_disapproval_w::text <> '') THEN 
      ds_result_w := 'DI';
    ELSIF (dt_submit_w IS NOT NULL AND dt_submit_w::text <> '') 
         AND ( coalesce(dt_approval_w::text, '') = '' ) THEN 
      ds_result_w := 'AA';
    ELSIF (dt_approval_w IS NOT NULL AND dt_approval_w::text <> '') THEN 
      ds_result_w := 'AP';
    
    END IF;

    RETURN ds_result_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_status_approv_disc_summary (nr_sequencia_p bigint) FROM PUBLIC;

