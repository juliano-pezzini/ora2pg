-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_time_by_minutes (minutes_p bigint) RETURNS varchar AS $body$
DECLARE

  result_w  varchar(100);
  just_days_w  bigint;
  diff_days_in_hours_w bigint;
  just_hours_w  bigint;
  hours_only_w	bigint;
  minutes_only_w	bigint;

BEGIN

if (minutes_p <= 0) then
    result_w := trunc(minutes_p) || wheb_mensagem_pck.get_texto(1105414);
end if;

	if (minutes_p > 0 and minutes_p < 60) then
		Select floor(minutes_p)
		into STRICT minutes_only_w
		;

		select to_char(minutes_only_w) || wheb_mensagem_pck.get_texto(1105414) ||' '
        into STRICT result_w
;
	end if;

	if (minutes_p >= 60 and minutes_p < 1440) then
		 Select trunc(minutes_p / 60) hours_only_w,
		  case when ((minutes_p/60) - trunc(minutes_p/60))*100 > 0 then floor(minutes_p - trunc(minutes_p / 60)*60) end minutes_only_w
		 into STRICT hours_only_w,
              minutes_only_w
	;

		 if (minutes_only_w > 0) then
            select  to_char(hours_only_w) || wheb_mensagem_pck.get_texto(1105413) ||' '|| to_char(minutes_only_w) || wheb_mensagem_pck.get_texto(1105414)
            into STRICT result_w
;
		 else
            select to_char(hours_only_w) || wheb_mensagem_pck.get_texto(1105413)
            into STRICT result_w
;
         end if;
	end if;

    if (minutes_p >= 1440) then

		Select trunc((minutes_p / 60)/24) just_days,
				case when(minutes_p / 60)/24 > trunc((minutes_p/60)/24) then (((minutes_p/60)/24) - trunc((minutes_p / 60)/24))*100 end diff_days_in_hours_w,
				trunc((minutes_p/60) - trunc((minutes_p / 60)/24)*24)  hours_only_w
		into STRICT 
			just_days_w,
			diff_days_in_hours_w,
			hours_only_w 
		;

        if (diff_days_in_hours_w > 0 and hours_only_w > 0) then
			select case when (minutes_p - (just_days_w*1440)) >= 1440 then just_days_w + ((minutes_p - (just_days_w*1440))/1440) else just_days_w end,
				   case when (minutes_p - (just_days_w*1440)) >= 1440 then	hours_only_w - ((minutes_p - (just_days_w*1440))/1440) else hours_only_w end
			into STRICT just_days_w,
				 hours_only_w
			;

            select to_char(just_days_w) || wheb_mensagem_pck.get_texto(1105411) ||' '|| to_char(hours_only_w) || wheb_mensagem_pck.get_texto(1105413)
            into STRICT result_w
;
        else
            select to_char(just_days_w) || wheb_mensagem_pck.get_texto(1105411)
            into STRICT result_w
;
        end if;
    end if;
    return result_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_time_by_minutes (minutes_p bigint) FROM PUBLIC;

