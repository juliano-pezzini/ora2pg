-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_validade_cart_benef ( dt_contratacao_p timestamp, dt_contrato_p timestamp, dt_base_carteira_p timestamp, dt_validade_cart_param_int_p pls_parametros.dt_base_validade_carteira%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) RETURNS timestamp AS $body$
DECLARE


dt_retorno_w			timestamp;


BEGIN
if (dt_validade_cart_param_int_p = 'B') then
	dt_retorno_w		:= dt_contratacao_p;
elsif (dt_validade_cart_param_int_p = 'C') then
	/*aaschlote 20/07/2012 OS - 473527 - Quando a base da validade for o contrato, então coloca o mês e o dia do contrato e o ano será a data de adesão do beneficiário*/

	begin
	dt_retorno_w		:= to_date(to_char(dt_contrato_p,'dd/mm/') || to_char(dt_contratacao_p,'yyyy'));
	exception
	when others then
		if (to_char(dt_contrato_p,'mm') = '02') then
			dt_retorno_w		:= to_date('28/02/' || to_char(dt_contratacao_p,'yyyy'));
		end if;
	end;
elsif (dt_validade_cart_param_int_p = 'A') then
	dt_retorno_w	:= dt_contrato_p;
elsif (dt_validade_cart_param_int_p = 'V') then
	dt_retorno_w	:= dt_base_carteira_p;
end if;

return	dt_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_validade_cart_benef ( dt_contratacao_p timestamp, dt_contrato_p timestamp, dt_base_carteira_p timestamp, dt_validade_cart_param_int_p pls_parametros.dt_base_validade_carteira%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) FROM PUBLIC;

