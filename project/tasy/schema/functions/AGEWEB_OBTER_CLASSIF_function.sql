-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION ageweb_obter_classif (cd_especialidade_p bigint, qt_idade_p bigint, dt_agenda_p timestamp, cd_profissional_p text) RETURNS varchar AS $body$
DECLARE


nr_seq_regra_w		bigint;
ie_classif_agenda_w	varchar(5);

C01 CURSOR FOR
	SELECT	nr_sequencia
	from	ageweb_regra_classif
	where	((cd_especialidade = cd_especialidade_p) or (coalesce(cd_especialidade::text, '') = ''))
	and	((cd_pessoa_fisica = cd_profissional_p) or (coalesce(cd_pessoa_fisica::text, '') = ''))
	and	qt_idade_p between coalesce(qt_idade_min,0) and coalesce(qt_idade_max,999)
	and	dt_agenda_p between to_date(to_char(dt_agenda_p,'dd/mm/yyyy') || ' ' || coalesce(to_char(dt_inicio_vigencia,'hh24:mi:ss'),'00:00:00'),'dd/mm/yyyy hh24:mi:ss') and
				    to_date(to_char(dt_agenda_p,'dd/mm/yyyy') || ' ' || coalesce(to_char(dt_fim_vigencia,'hh24:mi:ss'),'23:59:59'),'dd/mm/yyyy hh24:mi:ss')
	order by
		coalesce(cd_pessoa_fisica,'0'),
		coalesce(cd_especialidade,0);


BEGIN

open C01;
loop
fetch C01 into
	nr_seq_regra_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin
	nr_seq_regra_w := nr_seq_regra_w;
	end;
end loop;
close C01;

select	max(ie_classif_agenda)
into STRICT	ie_classif_agenda_w
from	ageweb_regra_classif
where	nr_sequencia = nr_seq_regra_w;

return	ie_classif_agenda_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION ageweb_obter_classif (cd_especialidade_p bigint, qt_idade_p bigint, dt_agenda_p timestamp, cd_profissional_p text) FROM PUBLIC;

