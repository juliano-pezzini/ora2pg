-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_valor_ident_pat_bol ( cd_pessoa_fisica_p text) RETURNS varchar AS $body$
DECLARE

			
ds_retorno_w	        varchar(4000);
nr_identidade_w         pessoa_fisica.nr_identidade%type;
nr_digito_verif_w       pessoa_fisica_aux.ds_digito_verif%type;
nr_passaporte_w         pessoa_fisica.nr_passaporte%type;
nr_reg_geral_strang_w   pessoa_fisica.nr_reg_geral_estrang%type;


BEGIN
        begin
                select  pf.nr_identidade,
                        pf.nr_passaporte, 
                        pf.nr_reg_geral_estrang 
                into STRICT    nr_identidade_w, 
                        nr_passaporte_w, 
                        nr_reg_geral_strang_w
                from    pessoa_fisica pf
                where   pf.cd_pessoa_fisica = cd_pessoa_fisica_p;
        exception
        when no_data_found then
                nr_identidade_w := null;
                nr_passaporte_w := null;
                nr_reg_geral_strang_w := null;
        when too_many_rows then
                nr_identidade_w := null;
                nr_passaporte_w := null;
                nr_reg_geral_strang_w := null;
        end;

        begin
                select  pfu.ds_digito_verif 
                into STRICT    nr_digito_verif_w
                from    pessoa_fisica_aux pfu
                where   pfu.cd_pessoa_fisica = cd_pessoa_fisica_p;
        exception
        when no_data_found then
                nr_digito_verif_w := null;
        when too_many_rows then
                nr_digito_verif_w := null;
        end;

    if (nr_identidade_w IS NOT NULL AND nr_identidade_w::text <> '') then
        ds_retorno_w	:= nr_identidade_w;
        
        if (nr_digito_verif_w IS NOT NULL AND nr_digito_verif_w::text <> '') then        
                ds_retorno_w	:= substr(ds_retorno_w || '-' || nr_digito_verif_w, 1, 4000);
        end if;
    elsif (nr_passaporte_w IS NOT NULL AND nr_passaporte_w::text <> '') then
        ds_retorno_w	:= nr_passaporte_w;
    elsif (nr_reg_geral_strang_w IS NOT NULL AND nr_reg_geral_strang_w::text <> '') then
        ds_retorno_w	:= nr_reg_geral_strang_w;
    end if;

    return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_valor_ident_pat_bol ( cd_pessoa_fisica_p text) FROM PUBLIC;

