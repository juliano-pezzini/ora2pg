-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_info_end_endereco (nr_seq_pessoa_endereco_p bigint, ie_informacao_p text, ie_codigo_desc_p text) RETURNS varchar AS $body$
DECLARE


/*
'BAIRRO_VILA' - neighborhood
'CODIGO_POSTAL' - postalCode
'COMPLEMENTO'	- complement
'DISTRITO'		- district
'ESTADO_PROVINCI' - stateName
'LOCALIDADE'	- location
'MUNICIPIO') - city
'NUMERO'	- house_number
'RUA_VIALIDADE' - street
'TIPO_BAIRRO' - type of neighborhood
'TIPO_LOGRAD'  - type of street
'PAIS'	- Country
*/
			

ds_valor_w				pessoa_endereco_item.ds_valor%type	:= null;
nr_seq_pais_w			pais.nr_sequencia%type;
cd_endereco_catalogo_w	end_endereco.cd_endereco_catalogo%type;
ds_endereco_w			pessoa_endereco_item.ds_valor%type;


BEGIN

if (nr_seq_pessoa_endereco_p IS NOT NULL AND nr_seq_pessoa_endereco_p::text <> '') and (ie_informacao_p IS NOT NULL AND ie_informacao_p::text <> '') then
	
	if (ie_codigo_desc_p = 'C') then
		select	max(b.cd_endereco_catalogo)
		into STRICT	ds_valor_w
		FROM pessoa_endereco_item a
LEFT OUTER JOIN end_endereco b ON (a.nr_seq_end_endereco = b.nr_sequencia)
WHERE a.nr_seq_pessoa_endereco = nr_seq_pessoa_endereco_p and a.ie_informacao = ie_informacao_p;
    elsif (ie_codigo_desc_p = 'CD') then
		begin
        select	max(b.cd_endereco_catalogo),
				max(coalesce(b.ds_endereco,a.ds_valor))
		into STRICT	cd_endereco_catalogo_w,
				ds_endereco_w
		FROM pessoa_endereco_item a
LEFT OUTER JOIN end_endereco b ON (a.nr_seq_end_endereco = b.nr_sequencia)
WHERE a.nr_seq_pessoa_endereco = nr_seq_pessoa_endereco_p and a.ie_informacao = ie_informacao_p;
		
		if (cd_endereco_catalogo_w IS NOT NULL AND cd_endereco_catalogo_w::text <> '') and (ds_endereco_w IS NOT NULL AND ds_endereco_w::text <> '') then
			begin
			ds_valor_w := cd_endereco_catalogo_w || ' - ' || ds_endereco_w;
			end;
		elsif (cd_endereco_catalogo_w IS NOT NULL AND cd_endereco_catalogo_w::text <> '') then
			begin
			ds_valor_w := cd_endereco_catalogo_w;
			end;
		else
			begin
			ds_valor_w := ds_endereco_w;
			end;
		end if;
		end;
    else
        select	max(coalesce(b.ds_endereco,a.ds_valor))
        into STRICT	ds_valor_w
        FROM pessoa_endereco_item a
LEFT OUTER JOIN end_endereco b ON (a.nr_seq_end_endereco = b.nr_sequencia)
WHERE a.nr_seq_pessoa_endereco = nr_seq_pessoa_endereco_p and a.ie_informacao = ie_informacao_p;
	end if;
	
	
	if (coalesce(ds_valor_w::text, '') = '') and (ie_informacao_p = 'PAIS') then
		select	max(c.nr_seq_pais)
		into STRICT	nr_seq_pais_w
		from	end_catalogo c,
				end_endereco b,
				pessoa_endereco_item a
		where	b.nr_seq_catalogo = c.nr_sequencia
		and		a.nr_seq_end_endereco	= b.nr_sequencia
		and		b.ie_informacao = 'PAIS'
		and		a.nr_seq_pessoa_endereco = nr_seq_pessoa_endereco_p;
		
		if (nr_seq_pais_w IS NOT NULL AND nr_seq_pais_w::text <> '') then
			select	a.cd_codigo_pais
			into STRICT	ds_valor_w
			from	pais a
			where	a.nr_sequencia= nr_seq_pais_w;
		end if;
	end if;
end if;

return	ds_valor_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_info_end_endereco (nr_seq_pessoa_endereco_p bigint, ie_informacao_p text, ie_codigo_desc_p text) FROM PUBLIC;

