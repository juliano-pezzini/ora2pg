-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_referral_letter_details (ie_type_information_p text, nr_atendimento_p bigint) RETURNS timestamp AS $body$
DECLARE

dt_referral_letter_w timestamp;
dt_validity_w timestamp;
nr_atendimento_w atendimento_paciente_inf.nr_atendimento%type := nr_atendimento_p;
return_w            timestamp;

BEGIN
if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
select  a.dt_referencia,
		a.dt_validade
into STRICT    dt_referral_letter_w,
		dt_validity_w
from    atendimento_paciente_inf a
where   a.nr_sequencia = (SELECT max(x.nr_sequencia) from atendimento_paciente_inf x where x.nr_atendimento = nr_atendimento_w);
else
dt_referral_letter_w := null;
end if;
if (ie_type_information_p = 1) then
    return_w := dt_referral_letter_w;
elsif (ie_type_information_p = 2) then
    return_w := dt_validity_w;
end if;
return return_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_referral_letter_details (ie_type_information_p text, nr_atendimento_p bigint) FROM PUBLIC;

