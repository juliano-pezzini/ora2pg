-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_nome_pf_isite ( CD_PESSOA_FISICA_P pessoa_fisica.cd_pessoa_fisica%TYPE, IE_TIPO_NOME_P text) RETURNS varchar AS $body$
DECLARE


retorno_nome_pf	        	varchar(255);
nm_pessoa_fisica_w          pessoa_fisica.nm_pessoa_fisica%TYPE;
nm_social_w                 pessoa_fisica.nm_social%TYPE;
ie_envia_nome_social_w      varchar(2);

/*
    PR: Primeiro nome
    SO: Sobrenome
*/
BEGIN
    select max(coalesce(ie_envia_nome_social,'N'))
    into STRICT ie_envia_nome_social_w
    from parametro_cdi;

    select nm_pessoa_fisica
    into STRICT nm_pessoa_fisica_w
    from pessoa_fisica
    where cd_pessoa_fisica = cd_pessoa_fisica_p;

    select nm_social
    into STRICT nm_social_w
    from pessoa_fisica 
    where cd_pessoa_fisica = cd_pessoa_fisica_p;

if((ie_envia_nome_social_w = 'N' OR coalesce(nm_social_w::text, '') = '') and (IE_TIPO_NOME_P = 'PR')) then
    retorno_nome_pf := substr(Obter_Parte_Nome_phillips_pf(nm_pessoa_fisica_w,'nome'),1,50);

elsif((ie_envia_nome_social_w = 'N' OR coalesce(nm_social_w::text, '') = '') and (IE_TIPO_NOME_P = 'SO')) then
    retorno_nome_pf := Obter_Parte_Nome_phillips_pf(nm_pessoa_fisica_w,'sobrenome');

elsif (ie_envia_nome_social_w = 'S' AND IE_TIPO_NOME_P = 'PR') then
    retorno_nome_pf := substr(Obter_Parte_Nome_phillips_pf(OBTER_NOME_SOCIAL_PF(cd_pessoa_fisica_p),'nome') || '(' || nm_pessoa_fisica_w || ')',1,50);

elsif (ie_envia_nome_social_w = 'S' AND IE_TIPO_NOME_P = 'SO') then
    retorno_nome_pf := obter_nome_sobrenome_pessoa(cd_pessoa_fisica_p, 'S');

end if;

    RETURN retorno_nome_pf;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_nome_pf_isite ( CD_PESSOA_FISICA_P pessoa_fisica.cd_pessoa_fisica%TYPE, IE_TIPO_NOME_P text) FROM PUBLIC;

