-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION sus_obter_se_cns_inconsistente (nr_cns_p bigint) RETURNS varchar AS $body$
DECLARE


ds_retorno_w	varchar(1)	:= 'N';
nr_pis_w	bigint;
nr_soma_pis_w	bigint;
nr_resto_w	bigint;
nr_digito_verificador_w	bigint;
nr_cns_result_w	bigint;


BEGIN

if (substr(nr_cns_p,1,1) in (7,8,9)) then
	begin
	/*Cart√£o do SUS deve possuir 15 caracteres*/

	if (length(nr_cns_p) <> 15) then
		begin
		ds_retorno_w	:= 'S';
		end;
	else
		nr_soma_pis_w	:= ((substr(nr_cns_p,1,1) * 15) +
					(substr(nr_cns_p,2,1) * 14) +
					(substr(nr_cns_p,3,1) * 13) +
					(substr(nr_cns_p,4,1) * 12) +
					(substr(nr_cns_p,5,1) * 11) +
					(substr(nr_cns_p,6,1) * 10) +
					(substr(nr_cns_p,7,1) * 9) +
					(substr(nr_cns_p,8,1) * 8) +
					(substr(nr_cns_p,9,1) * 7) +
					(substr(nr_cns_p,10,1) * 6) +
					(substr(nr_cns_p,11,1) * 5) +
					(substr(nr_cns_p,12,1) * 4) +
					(substr(nr_cns_p,13,1) * 3) +
					(substr(nr_cns_p,14,1) * 2) +
					(substr(nr_cns_p,15,1) * 1));
		nr_resto_w	:= mod(nr_soma_pis_w, 11);
		if (nr_resto_w	<> 0) then
			begin
			ds_retorno_w	:= 'S';
			end;
		end if;
	end if;
	end;
else
	begin
	if (length(nr_cns_p) <> 15) then
		begin
		ds_retorno_w	:= 'S';
		end;
	else
		begin
		nr_pis_w	:= substr(nr_cns_p,1,11);
		nr_soma_pis_w	:= ((substr(nr_pis_w,1,1) * 15) +
				(substr(nr_pis_w,2,1) * 14) +
				(substr(nr_pis_w,3,1) * 13) +
				(substr(nr_pis_w,4,1) * 12) +
				(substr(nr_pis_w,5,1) * 11) +
				(substr(nr_pis_w,6,1) * 10) +
				(substr(nr_pis_w,7,1) * 9) +
				(substr(nr_pis_w,8,1) * 8) +
				(substr(nr_pis_w,9,1) * 7) +
				(substr(nr_pis_w,10,1) * 6) +
				(substr(nr_pis_w,11,1) * 5));
		nr_resto_w	:= mod(nr_soma_pis_w, 11);
		nr_digito_verificador_w	:= 11 - nr_resto_w;
		if (nr_digito_verificador_w	= 11) then
			begin
			nr_digito_verificador_w	:= 0;
			end;
		end if;
		if (nr_digito_verificador_w	= 10) then
			begin
			nr_soma_pis_w	:= (((substr(nr_pis_w,1,1) * 15) +
				(substr(nr_pis_w,2,1) * 14) +
				(substr(nr_pis_w,3,1) * 13) +
				(substr(nr_pis_w,4,1) * 12) +
				(substr(nr_pis_w,5,1) * 11) +
				(substr(nr_pis_w,6,1) * 10) +
				(substr(nr_pis_w,7,1) * 9) +
				(substr(nr_pis_w,8,1) * 8) +
				(substr(nr_pis_w,9,1) * 7) +
				(substr(nr_pis_w,10,1) * 6) +
				(substr(nr_pis_w,11,1) * 5)) + 2);
			nr_resto_w	:= mod(nr_soma_pis_w, 11);
			nr_digito_verificador_w	:= 11 - nr_resto_w;
			nr_cns_result_w	:= nr_pis_w || '001' || nr_digito_verificador_w;
			end;
		else
			begin
			nr_cns_result_w	:= nr_pis_w || '000' || nr_digito_verificador_w;
			end;
		end if;
		if (nr_cns_p <> nr_cns_result_w) then
			begin
			ds_retorno_w	:= 'S';
			end;
		end if;
		end;
	end if;
	end;
end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION sus_obter_se_cns_inconsistente (nr_cns_p bigint) FROM PUBLIC;

