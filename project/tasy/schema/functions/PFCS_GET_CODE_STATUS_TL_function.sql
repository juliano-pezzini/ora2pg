-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pfcs_get_code_status_tl ( nr_seq_patient_p bigint, ie_return_color char default 'N') RETURNS varchar AS $body$
DECLARE

ie_cd_flag     varchar(255);


BEGIN

select cd_flag into STRICT ie_cd_flag from (
    SELECT cd_flag from pfcs_patient_flag
    where nr_seq_patient = nr_seq_patient_p
    and upper(cd_flag) in ('DNR', 'DNI', 'FULL', 'OTHER')
    order by dt_atualizacao desc
) alias2 LIMIT 1;

if (ie_return_color = 'S') then
    if (upper(ie_cd_flag) in ('DNR', 'DNI')) then
        ie_cd_flag := concat(ie_cd_flag, 'color#D780FF');
    end if;
end if;

IF NOT FOUND THEN
    ie_cd_flag:='';
END IF;

RETURN ie_cd_flag;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pfcs_get_code_status_tl ( nr_seq_patient_p bigint, ie_return_color char default 'N') FROM PUBLIC;

