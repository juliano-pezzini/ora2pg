-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_gestao_doc_item ( nr_sequencia_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE

 
/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
Finalidade: 
------------------------------------------------------------------------------------------------------------------- 
Locais de chamada direta: 
[ ] Objetos do dicionário [ ] Tasy (Delphi/Java) [ ] Portal [ ] Relatórios [ ] Outros: 
 ------------------------------------------------------------------------------------------------------------------ 
Pontos de atenção: 
------------------------------------------------------------------------------------------------------------------- 
Referências: 
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
 
 
ds_retorno_w			varchar(255);
nr_seq_gestao_doc_w		gestao_documento.nr_sequencia%type;
nr_seq_interno_w		gestao_doc_item.nr_seq_interno%type;


BEGIN 
if (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '') then 
	select	max(a.nr_seq_gestao_doc), 
		max(a.nr_seq_interno) 
	into STRICT	nr_seq_gestao_doc_w, 
		nr_seq_interno_w 
	from	gestao_doc_item	a 
	where	a.nr_sequencia	= nr_sequencia_p;
	 
	if (ie_opcao_p = 'NI') then 
		ds_retorno_w	:= nr_seq_interno_w;
	elsif (ie_opcao_p = 'NP') then 
		ds_retorno_w	:= substr(obter_dados_conta_paciente(nr_seq_interno_w, ie_opcao_p),1,255);
	elsif (ie_opcao_p = 'LO') then 
		select	max(b.ds_local) 
		into STRICT	ds_retorno_w 
		from	gestao_documento	a, 
			doc_local_armazenamento	b 
		where	b.nr_sequencia	= a.nr_seq_local 
		and	a.nr_sequencia	= nr_seq_gestao_doc_w;
	elsif (ie_opcao_p = 'CO') then 
		select	max(b.ds_corredor) 
		into STRICT	ds_retorno_w 
		from	gestao_documento	a, 
			doc_local_armazenamento	b 
		where	b.nr_sequencia	= a.nr_seq_local 
		and	a.nr_sequencia	= nr_seq_gestao_doc_w;
	elsif (ie_opcao_p = 'PR') then 
		select	max(b.ds_prateleira) 
		into STRICT	ds_retorno_w 
		from	gestao_documento	a, 
			doc_local_armazenamento	b 
		where	b.nr_sequencia	= a.nr_seq_local 
		and	a.nr_sequencia	= nr_seq_gestao_doc_w;
	elsif (ie_opcao_p = 'CX') then 
		select	max(a.nr_caixa) 
		into STRICT	ds_retorno_w 
		from	gestao_documento	a 
		where	a.nr_sequencia	= nr_seq_gestao_doc_w;
	end if;
end if;
 
return ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_gestao_doc_item ( nr_sequencia_p bigint, ie_opcao_p text) FROM PUBLIC;

