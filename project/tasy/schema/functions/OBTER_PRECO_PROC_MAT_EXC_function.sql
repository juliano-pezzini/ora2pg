-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_preco_proc_mat_exc (nr_sequencia_p bigint, ie_proc_mat_p text) RETURNS bigint AS $body$
DECLARE

 
vl_preco_proc_mat_w	double precision;


BEGIN 
 
if (ie_proc_mat_p = '1') then 
	 
	select 	Obter_preco_procedimento(b.cd_estabelecimento, 
					a.cd_convenio, 
					a.cd_categoria, 
					a.dt_procedimento, 
					a.cd_procedimento, 
					a.ie_origem_proced, 
					0, 0, 
					a.cd_setor_atendimento, 
					null, null, null, null, 
					0, 0, 'P') 
	into STRICT	vl_preco_proc_mat_w 
	from 	procedimento_paciente	a, 
		atendimento_paciente	b 
	where 	a.nr_atendimento = b.nr_atendimento 
	and 	a.nr_sequencia = nr_sequencia_p;
 
elsif (ie_proc_mat_p = '2') then 
	 
	select 	Obter_preco_material(b.cd_estabelecimento, 
				 	a.cd_convenio, 
					a.cd_categoria, 
					a.dt_atendimento, 
					a.cd_material, 
					0, 0, 
					a.cd_setor_atendimento, 
					null, 0, 0) 
	into STRICT	vl_preco_proc_mat_w 
	from 	material_atend_paciente	a, 
		atendimento_paciente	b 
	where 	a.nr_atendimento = b.nr_atendimento 
	and 	a.nr_sequencia = nr_sequencia_p;
 
 
end if;
 
return coalesce(vl_preco_proc_mat_w,0);
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_preco_proc_mat_exc (nr_sequencia_p bigint, ie_proc_mat_p text) FROM PUBLIC;

