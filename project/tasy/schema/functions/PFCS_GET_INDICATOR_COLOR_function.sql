-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pfcs_get_indicator_color ( nr_seq_indicator_p bigint, vl_indicator_p bigint, ds_column_p text default 'fourthCell', ie_reverse_colors_p text default 'N') RETURNS varchar AS $body$
DECLARE


ds_color_w		varchar(255);
ie_rule_w		varchar(1);
qt_initial_target_w	pfcs_indicator_target.qt_initial_target%type;
qt_final_target_w	pfcs_indicator_target.qt_final_target%type;
ds_aux_w		varchar(255);


BEGIN

select	coalesce(max('S'),'N')
into STRICT	ie_rule_w
from	pfcs_indicator_target a,
        pfcs_indicator_rule b
where	a.nr_seq_rule = b.nr_sequencia
    and b.nr_seq_indicator	= nr_seq_indicator_p;

if (ie_rule_w = 'S') then
	select	max(a.qt_initial_target) qt_initial_target,
		max(a.qt_final_target) qt_final_target
	into STRICT	qt_initial_target_w,
		qt_final_target_w
	from	pfcs_indicator_target a,
            pfcs_indicator_rule b
	where	a.nr_seq_rule = b.nr_sequencia
        and b.nr_seq_indicator	= nr_seq_indicator_p;
else
	select	max(a.qt_initial_target) qt_initial_target,
		max(a.qt_final_target) qt_final_target
	into STRICT	qt_initial_target_w,
		qt_final_target_w
	from	pfcs_indicator_target_def a
	where	a.nr_seq_indicator	= nr_seq_indicator_p;
end if;

if (ds_column_p = 'DF') then /* Dynamic Form */
	ds_aux_w	:= '';
else
	ds_aux_w	:= ds_column_p || ':';
end if;
	
if (vl_indicator_p < qt_initial_target_w) then
    if (ie_reverse_colors_p = 'S') then
         ds_color_w	:= ds_aux_w || '#FF6D59'; --''; /* red */
    else
        ds_color_w	:= ds_aux_w || '#FFFFFF'; --''; /* white */
    end if;
elsif (vl_indicator_p >= qt_initial_target_w) and (vl_indicator_p <= qt_final_target_w) then
    ds_color_w	:= ds_aux_w || '#FFCD05'; /* yellow */
elsif (vl_indicator_p > qt_final_target_w) then
    if (ie_reverse_colors_p = 'S') then
        ds_color_w	:= ds_aux_w || '#FFFFFF'; --''; /* white */
    else
        ds_color_w	:= ds_aux_w || '#FF6D59'; /* red */
    end if;
else
    ds_color_w	:= '';
end if;

return	ds_color_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pfcs_get_indicator_color ( nr_seq_indicator_p bigint, vl_indicator_p bigint, ds_column_p text default 'fourthCell', ie_reverse_colors_p text default 'N') FROM PUBLIC;

