-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION proj_obter_tipo_recurso ( nr_seq_viagem_p bigint) RETURNS bigint AS $body$
DECLARE


nr_retorno_w		smallint := 0;
cd_pessoa_fisica_w	varchar(10);
cd_consultor_w		varchar(10);
ie_nivel_w		bigint;


BEGIN
select	coalesce(max(a.cd_pessoa_fisica),0)
into STRICT	cd_pessoa_fisica_w
from	via_viagem a
where	a.nr_sequencia = nr_seq_viagem_p;

select	coalesce(max(a.cd_pessoa_fisica),0)
into STRICT	cd_consultor_w
from	com_canal_consultor a
where	a.cd_pessoa_fisica = cd_pessoa_fisica_w;

if (coalesce(cd_consultor_w,0) > 0) then
	begin
	select	coalesce(max(a.nr_seq_nivel),0)
	into STRICT	ie_nivel_w
	from	proj_consultor_nivel a
	where	a.cd_consultor = cd_consultor_w;

	if (ie_nivel_w in (6,5,1)) then
		nr_retorno_w := 2;
	else
		nr_retorno_w := 3;
	end if;
	end;
else
	nr_retorno_w := 1;
end if;

return	nr_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION proj_obter_tipo_recurso ( nr_seq_viagem_p bigint) FROM PUBLIC;

