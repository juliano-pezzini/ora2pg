-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION nut_check_if_exist_menu_cycle ( nr_seq_cardapio_p bigint,                         -- Menu sequence
 nr_seq_cycle_day_p text,                       -- cycle sequence days ( from selected checkboxs)
 nr_seq_cycle_p NUT_CARDAPIO_DIA.NR_SEQ_CYCLE%type, -- sequence of active cycle
 nr_seq_serv_destino_p bigint,                      -- Destination Service
 ie_tipo_copia_p text,                    -- type of copy
 nr_seq_local_p bigint) RETURNS varchar AS $body$
                      -- Location
DECLARE

  ds_retorno_w            	varchar(1) := 'N';
  qt_cardapios_w          	bigint;
  nr_seq_grupo_producao_w 	bigint;
  cd_dieta_w              	bigint;
  nr_seq_opcao_w          	bigint;
  nr_seq_local_w         	bigint;
  nr_seq_servico_w        	bigint;
  sql_stmt               	 	varchar(1000);

BEGIN
    SELECT nr_seq_grupo_producao,
      cd_dieta,
      nr_seq_opcao,
      nr_seq_local,
      nr_seq_servico
    INTO STRICT nr_seq_grupo_producao_w,
      cd_dieta_w,
      nr_seq_opcao_w,
      nr_seq_local_w,
      nr_seq_servico_w
    FROM nut_cardapio_dia
    WHERE nr_sequencia = nr_seq_cardapio_p;

    sql_stmt := 'SELECT COUNT(*)
    FROM nut_cardapio_dia
    WHERE nr_seq_servico             = NVL(:1,:2)
    AND NVL(nr_seq_grupo_producao,0) = NVL(:3,0)
    AND NVL(cd_dieta,0)              = NVL(:4,0)
    AND NVL(nr_seq_opcao,0)          = NVL(:5,0)
    AND NVL(nr_seq_local,0)          = NVL(:6,:7)
    AND NVL(NR_SEQ_CYCLE,0)          = NVL(:8,0)
    AND NR_SEQ_CYCLE_DAY            IN ('|| nr_seq_cycle_day_p ||')';

    EXECUTE sql_stmt into STRICT qt_cardapios_w USING nr_seq_serv_destino_p, nr_seq_servico_w, nr_seq_grupo_producao_w, cd_dieta_w, nr_seq_opcao_w, nr_seq_local_p, nr_seq_local_w,
      nr_seq_cycle_p;

    IF (qt_cardapios_w               > 0) THEN
      ds_retorno_w                  := 'S';
    END IF;
RETURN ds_retorno_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION nut_check_if_exist_menu_cycle ( nr_seq_cardapio_p bigint, nr_seq_cycle_day_p text, nr_seq_cycle_p NUT_CARDAPIO_DIA.NR_SEQ_CYCLE%type, nr_seq_serv_destino_p bigint, ie_tipo_copia_p text, nr_seq_local_p bigint) FROM PUBLIC;

