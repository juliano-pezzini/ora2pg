-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION eme_converte_macro_regra_email (nr_seq_faturamento_p text, ds_conteudo_p text) RETURNS varchar AS $body$
DECLARE

			
ds_retorno_w			varchar(4000);
nr_seq_contrato_w		eme_faturamento.nr_seq_contrato%type;
dt_emissao_w			eme_faturamento.dt_emissao%type;
dt_vencimento_w			eme_faturamento.dt_vencimento%type;
dt_competencia_w		eme_faturamento.dt_competencia%type;
dt_emissao_bloqueto_w	eme_faturamento.dt_emissao_bloqueto%type;
vl_fatura_w				eme_faturamento.vl_fatura%type;


BEGIN

select	max(nr_seq_contrato),
		max(dt_emissao),
		max(dt_vencimento),
		max(dt_competencia),
		max(dt_emissao_bloqueto),
		max(vl_fatura)
into STRICT	nr_seq_contrato_w,
		dt_emissao_w,
		dt_vencimento_w,
		dt_competencia_w,
		dt_emissao_bloqueto_w,
		vl_fatura_w
from eme_faturamento
where nr_sequencia = nr_seq_faturamento_p;


ds_retorno_w	:= ds_conteudo_p;
ds_retorno_w	:= substr(replace(ds_retorno_w,'#@NR_SEQ_CONTRATO#@',nr_seq_contrato_w),1,4000);
ds_retorno_w	:= substr(replace(ds_retorno_w,'#@DT_EMISSAO#@',to_char(dt_emissao_w,'dd/mm/yyyy')),1,4000);
ds_retorno_w	:= substr(replace(ds_retorno_w,'#@DT_VENCIMENTO#@',to_char(dt_vencimento_w,'dd/mm/yyyy')),1,4000);
ds_retorno_w	:= substr(replace(ds_retorno_w,'#@DT_COMPETENCIA#@',to_char(dt_competencia_w,'mm/yyyy')),1,4000);
ds_retorno_w	:= substr(replace(ds_retorno_w,'#@DT_EMISSAO_BLOQUETO#@',to_char(dt_emissao_bloqueto_w,'dd/mm/yyyy')),1,4000);
ds_retorno_w	:= substr(replace(ds_retorno_w,'#@VL_FATURA#@', vl_fatura_w),1,4000);

return	substr(ds_retorno_w,1,255);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION eme_converte_macro_regra_email (nr_seq_faturamento_p text, ds_conteudo_p text) FROM PUBLIC;

