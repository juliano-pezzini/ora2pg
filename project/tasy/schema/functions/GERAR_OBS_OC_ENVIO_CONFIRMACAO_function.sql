-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION gerar_obs_oc_envio_confirmacao ( nr_ordem_compra_p bigint) RETURNS varchar AS $body$
DECLARE

 
ds_obs_ordem_w			varchar(4000);	
cd_estabelecimento_w		bigint;
ds_obs_integr_compras_ws_w	varchar(255);
			

BEGIN 
 
select	CASE WHEN ie_grava_obs_oc_wbs='N' THEN ''  ELSE a.ds_observacao END , 
	a.cd_estabelecimento 
into STRICT	ds_obs_ordem_w, 
	cd_estabelecimento_w 
from	ordem_compra a, 
	parametro_compras b 
where	a.cd_estabelecimento = b.cd_estabelecimento 
and	a.nr_ordem_compra = nr_ordem_compra_p;
 
if (cd_estabelecimento_w > 0) then 
 
	select	ds_obs_integr_compras_ws 
	into STRICT	ds_obs_integr_compras_ws_w 
	from	parametro_compras 
	where	cd_estabelecimento = cd_estabelecimento_w;
	 
	if (ds_obs_integr_compras_ws_w IS NOT NULL AND ds_obs_integr_compras_ws_w::text <> '') then	 
		ds_obs_integr_compras_ws_w := substr(replace_macro(ds_obs_integr_compras_ws_w,'@ordem',nr_ordem_compra_p),1,255);
	end if;
end if;
 
if (ds_obs_ordem_w IS NOT NULL AND ds_obs_ordem_w::text <> '') then 
	ds_obs_ordem_w := substr(ds_obs_ordem_w || chr(13) || chr(10) || ds_obs_integr_compras_ws_w,1,4000);
else 
	ds_obs_ordem_w := ds_obs_integr_compras_ws_w;
end if;
 
ds_obs_ordem_w := elimina_acentuacao(tiss_eliminar_caractere(ds_obs_ordem_w));
 
return	ds_obs_ordem_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION gerar_obs_oc_envio_confirmacao ( nr_ordem_compra_p bigint) FROM PUBLIC;

