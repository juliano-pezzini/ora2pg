-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_cheque_pendente (nr_seq_cheque_p bigint, dt_parametro_p timestamp) RETURNS varchar AS $body$
DECLARE


/* L - Liquidado    A - Em Aberto */

ds_resultado_w		varchar(1);
dt_registro_w		timestamp;
dt_deposito_w		timestamp;
dt_devolucao_banco_w	timestamp;
dt_reapresentacao_w	timestamp;
dt_seg_devolucao_w	timestamp;
dt_devolucao_w		timestamp;
dt_parametro_w		timestamp;
dt_venda_terc_w		timestamp;
dt_seg_reapresentacao_w	timestamp;
dt_terc_devolucao_w		timestamp;


BEGIN

dt_parametro_w		:= trunc(dt_parametro_p,'dd');
SELECT		coalesce(trunc(dt_registro,'dd'),dt_parametro_w + 1),
		coalesce(trunc(dt_deposito,'dd'),dt_parametro_w + 1),
		coalesce(trunc(dt_devolucao_banco,'dd'),dt_parametro_w + 1),
		coalesce(trunc(dt_reapresentacao,'dd'),dt_parametro_w + 1),
		coalesce(trunc(dt_seg_devolucao,'dd'),dt_parametro_w + 1),
		coalesce(trunc(dt_devolucao,'dd'),dt_parametro_w + 1),
		coalesce(trunc(dt_venda_terc,'dd'),dt_parametro_w + 1),
		coalesce(trunc(dt_seg_reapresentacao,'dd'),dt_parametro_w + 1),
		coalesce(trunc(dt_terc_devolucao,'dd'),dt_parametro_w + 1)
INTO STRICT		dt_registro_w,
		dt_deposito_w,
		dt_devolucao_banco_w,
		dt_reapresentacao_w,
		dt_seg_devolucao_w,
		dt_devolucao_w,
		dt_venda_terc_w,
		dt_seg_reapresentacao_w,
		dt_terc_devolucao_w
FROM		cheque_cr
WHERE		nr_seq_cheque	= nr_seq_cheque_p;

if (dt_parametro_w		< dt_registro_w) then
	ds_resultado_w		:= 'L';
elsif (dt_parametro_w		>= dt_devolucao_w) then
	ds_resultado_w		:= 'L';
elsif (dt_parametro_w	>= dt_terc_devolucao_w)	then
	ds_resultado_w		:= 'A';
elsif (dt_parametro_w	>= dt_seg_reapresentacao_w)	then
	ds_resultado_w		:= 'L';
elsif (dt_parametro_w		>= dt_seg_devolucao_w) then
	ds_resultado_w		:= 'A';
elsif (dt_parametro_w		>= dt_reapresentacao_w) then
	ds_resultado_w		:= 'L';
elsif (dt_parametro_w		>= dt_devolucao_banco_w) then
	ds_resultado_w		:= 'A';
elsif (dt_parametro_w		>= dt_deposito_w) then
	ds_resultado_w		:= 'L';
elsif (dt_parametro_w		>= dt_registro_w) then
	ds_resultado_w		:= 'A';
elsif (dt_parametro_w		>= dt_venda_terc_w) then
	ds_resultado_w		:= 'L';
end if;

RETURN	ds_resultado_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_cheque_pendente (nr_seq_cheque_p bigint, dt_parametro_p timestamp) FROM PUBLIC;

