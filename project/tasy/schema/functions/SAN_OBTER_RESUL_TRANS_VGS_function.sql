-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION san_obter_resul_trans_vgs (seq_transfusao_p integer, seq_producao_p integer, ie_tipo_exame_p text) RETURNS varchar AS $body$
DECLARE


resuld_w	varchar(100);


BEGIN

    BEGIN
    select a.ds_resultado
    into STRICT resuld_w
    from (SELECT f.ds_resultado,
        row_number() over (order by f.dt_liberacao desc)as num_linha
        from	san_exame    y,
            san_exame_realizado f,
            san_exame_lote g
        where	f.nr_seq_exame_lote	= g.nr_sequencia
        and	y.nr_sequencia = f.nr_seq_exame
        and (f.dt_liberacao IS NOT NULL AND f.dt_liberacao::text <> '')
        and (f.ds_resultado IS NOT NULL AND f.ds_resultado::text <> '')
        and (g.nr_seq_producao = seq_producao_p or g.nr_seq_transfusao = seq_transfusao_p)
        and	y.ie_tipo_exame = ie_tipo_exame_p) a
    where a.num_linha = 1;

    exception
    when no_data_found then
        resuld_w := '';
    end;
    return resuld_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION san_obter_resul_trans_vgs (seq_transfusao_p integer, seq_producao_p integer, ie_tipo_exame_p text) FROM PUBLIC;

