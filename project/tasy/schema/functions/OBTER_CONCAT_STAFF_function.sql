-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_concat_staff ( NR_SEQUENCIA_P bigint , PROF_P bigint ) RETURNS varchar AS $body$
DECLARE


data_w varchar(1000);
Assist_Physician varchar(1000);
Sec_nurse varchar(1000);

  i RECORD;

BEGIN

IF (PROF_P=3) then --Assist_Physician 
for i in (SELECT (CD_PHYSICIAN) as Assist_Physician from MED_TREATMENT_PLAN_TEAM where SI_PERSON_TYPE=2 and NR_SEQ_MED_TREAT_PLAN=NR_SEQUENCIA_P)
loop
data_w := data_w ||',' ||i.Assist_Physician;
end loop;

end if;

IF (PROF_P=4) then --Nurse Secondary 
for i in (SELECT (CD_PERSON) as Sec_nurse   from MED_TREATMENT_PLAN_TEAM  where SI_PERSON_TYPE=5 and NR_SEQ_MED_TREAT_PLAN=NR_SEQUENCIA_P and cd_position in (717,707,441))
loop
data_w := data_w||','||i.Sec_nurse;
end loop;
end if;


  RETURN ltrim(data_w,',');
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_concat_staff ( NR_SEQUENCIA_P bigint , PROF_P bigint ) FROM PUBLIC;

