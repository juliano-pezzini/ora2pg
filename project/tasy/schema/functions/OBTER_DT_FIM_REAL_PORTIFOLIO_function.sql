-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dt_fim_real_portifolio ( nr_seq_portifolio_p bigint ) RETURNS timestamp AS $body$
DECLARE

/* ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:  Obter data fim real de um portifolio
---------------------------------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[X]  Objetos do dicionário [ ] Tasy (Delphi/Java) [ ] Portal [ ]  Relatórios [ ] Outros:
 --------------------------------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
dt_retorno_w timestamp := null;


BEGIN
  select  t.dt_fim_real
  into STRICT    dt_retorno_w
  from ( SELECT    c1.nr_seq_proj, e1.ds_atividade, e1.dt_fim_real, e1.dt_fim_prev
            from      proj_portifolio pf1,
                      proj_programa pr1,
                      proj_projeto p1,
                      proj_cronograma c1,
                      proj_cron_etapa e1
            where     pf1.nr_sequencia     = pr1.nr_seq_portifolio
            and       pr1.nr_sequencia     = p1.nr_seq_programa
            and       p1.nr_sequencia      = c1.nr_seq_proj
            and       c1.nr_sequencia      = e1.nr_seq_cronograma
            and       c1.ie_situacao       = 'A'
            and       e1.ie_fase           = 'N'
	    and	      (c1.dt_aprovacao IS NOT NULL AND c1.dt_aprovacao::text <> '')
            and       pf1.nr_sequencia     = nr_seq_portifolio_p
            order by  e1.dt_fim_prev desc
          ) t LIMIT 1;

  return dt_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dt_fim_real_portifolio ( nr_seq_portifolio_p bigint ) FROM PUBLIC;

