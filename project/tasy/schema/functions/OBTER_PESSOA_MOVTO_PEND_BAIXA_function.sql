-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_pessoa_movto_pend_baixa ( nr_seq_movto_baixa_p bigint, ie_tipo_dado_p text, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE

 
/*	ie_tipo_dado_p 
 
'C'	- Código 
'N'	- Nome 
'CF'	- Código pessoa física 
'CJ'	- Código pessoa jurídica 
'NF'	- Nome pessoa física 
'NJ'	- Nome pessoa jurídica 
 
	ie_opcao_p 
 
'GE'	- Geral 
 
'AD'	- Adiantamento 
'BR'	- Borderô de Recebimento 
'CH'	- Cheque 
'Rc'	- Recebimento de Convênio 
'TR'	- Título a Receber 
*/
 
 
cd_pessoa_fisica_w		varchar(10);
cd_cgc_w			varchar(14);
nr_titulo_w			bigint;
nr_adiantamento_w		bigint;
nr_seq_cheque_w			bigint;
nr_bordero_rec_w		bigint;
nr_seq_conv_receb_w		bigint;

ds_retorno_w			varchar(255);


BEGIN 
 
select	a.nr_adiantamento, 
	a.nr_bordero_rec, 
	a.nr_seq_cheque, 
	a.nr_seq_conv_receb, 
	a.nr_titulo 
into STRICT	nr_adiantamento_w, 
	nr_bordero_rec_w, 
	nr_seq_cheque_w, 
	nr_seq_conv_receb_w, 
	nr_titulo_w 
from	movto_banco_pend_baixa a 
where	a.nr_sequencia	= nr_seq_movto_baixa_p;
 
if (ie_opcao_p = 'AD') or ((coalesce(ie_opcao_p,'GE') = 'GE') and (coalesce(cd_pessoa_fisica_w,0) = 0) and (coalesce(cd_cgc_w,0) = 0)) then 
	select	max(a.cd_pessoa_fisica), 
		max(a.cd_cgc) 
	into STRICT	cd_pessoa_fisica_w, 
		cd_cgc_w 
	from	adiantamento a 
	where	a.nr_adiantamento	= nr_adiantamento_w;
end if;
 
if (ie_opcao_p = 'BR') or ((coalesce(ie_opcao_p,'GE') = 'GE') and (coalesce(cd_pessoa_fisica_w,0) = 0) and (coalesce(cd_cgc_w,0) = 0)) then 
	select	max(a.cd_pessoa_pagamento), 
		max(a.cd_cgc_pagamento) 
	into STRICT	cd_pessoa_fisica_w, 
		cd_cgc_w 
	from	bordero_recebimento a 
	where	a.nr_bordero		= nr_bordero_rec_w;
end if;
 
if (ie_opcao_p = 'CH') or ((coalesce(ie_opcao_p,'GE') = 'GE') and (coalesce(cd_pessoa_fisica_w,0) = 0) and (coalesce(cd_cgc_w,0) = 0)) then 
	select	max(a.cd_pessoa_fisica), 
		max(a.cd_cgc) 
	into STRICT	cd_pessoa_fisica_w, 
		cd_cgc_w 
	from	cheque_cr a 
	where	a.nr_seq_cheque		= nr_seq_cheque_w;
end if;
 
if (ie_opcao_p = 'RC') or ((coalesce(ie_opcao_p,'GE') = 'GE') and (coalesce(cd_pessoa_fisica_w,0) = 0) and (coalesce(cd_cgc_w,0) = 0)) then 
	select	null, 
		max(b.cd_cgc) 
	into STRICT	cd_pessoa_fisica_w, 
		cd_cgc_w 
	from	convenio b, 
		convenio_receb a 
	where	a.nr_sequencia		= nr_seq_conv_receb_w 
	and	a.cd_convenio		= b.cd_convenio;
end if;
 
if (ie_opcao_p = 'TR') or ((coalesce(ie_opcao_p,'GE') = 'GE') and (coalesce(cd_pessoa_fisica_w,0) = 0) and (coalesce(cd_cgc_w,0) = 0)) then 
	select	max(a.cd_pessoa_fisica), 
		max(a.cd_cgc) 
	into STRICT	cd_pessoa_fisica_w, 
		cd_cgc_w 
	from	titulo_receber a 
	where	a.nr_titulo		= nr_titulo_w;
end if;
 
if (ie_tipo_dado_p = 'C') then 
	ds_retorno_w	:= coalesce(cd_pessoa_fisica_w, cd_cgc_w);
elsif (ie_tipo_dado_p = 'CF') then 
	ds_retorno_w	:= cd_pessoa_fisica_w;
elsif (ie_tipo_dado_p = 'CJ') then 
	ds_retorno_w	:= cd_cgc_w;
elsif (ie_tipo_dado_p = 'N') then 
	ds_retorno_w	:= substr(obter_nome_pf_pj(cd_pessoa_fisica_w, cd_cgc_w),1,60);
elsif (ie_tipo_dado_p = 'NF') then 
	ds_retorno_w	:= substr(obter_nome_pf_pj(cd_pessoa_fisica_w, null),1,60);
elsif (ie_tipo_dado_p = 'NJ') then 
	ds_retorno_w	:= substr(obter_nome_pf_pj(null, cd_cgc_w),1,60);
end if;
 
return	ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_pessoa_movto_pend_baixa ( nr_seq_movto_baixa_p bigint, ie_tipo_dado_p text, ie_opcao_p text) FROM PUBLIC;

