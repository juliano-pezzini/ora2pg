-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION hd_monitora_tempo_serv_doacao (ie_tipo_p text, nr_sequencia_p bigint) RETURNS bigint AS $body$
DECLARE

dt_cadastro_w	timestamp;
dt_triagem_fisica_w	timestamp;
dt_triagem_w	timestamp;
dt_coleta_w	timestamp;
dt_fim_coleta_w	timestamp;
tempo_servico_w	numeric(20);
tempo_doacao_w	numeric(20);
tempo_tri_fisica_w	numeric(20);
tempo_triagem_w	numeric(20);
tempo_coleta_w	numeric(20);


/* ie_tipo = D  doação
    ie_tipo = TF Triagem física
    ie_tipo = TC Triagem
    ie_tipo = C Coleta
    ie_tipo = T tempo total
*/
BEGIN

tempo_servico_w := 0;

select	dt_doacao,
	dt_triagem_fisica,
	dt_triagem,
	dt_inicio_coleta,
	dt_fim_coleta
into STRICT	dt_cadastro_w,
	dt_triagem_fisica_w,
	dt_triagem_w,
	dt_coleta_w,
	dt_fim_coleta_w
from	san_doacao
where 	nr_sequencia = nr_sequencia_p;

if (ie_tipo_p = 'D') then
	begin
	tempo_servico_w := ((dt_triagem_fisica_w - dt_cadastro_w) * 1440);
	end;
elsif (ie_tipo_p = 'TF') then
	begin
	tempo_servico_w := ((dt_triagem_w - dt_triagem_fisica_w) * 1440);
	end;
elsif (ie_tipo_p = 'TC') then
	begin
	tempo_servico_w := ((dt_coleta_w - dt_triagem_w) * 1440);
	end;
elsif (ie_tipo_p = 'C') then
	begin
	tempo_servico_w := ((dt_fim_coleta_w - dt_coleta_w) * 1440);
	end;
elsif (ie_tipo_p = 'T') then
	begin
	tempo_doacao_w := coalesce(((dt_triagem_fisica_w - dt_cadastro_w) * 1440),0);
	tempo_tri_fisica_w := coalesce(((dt_triagem_w - dt_triagem_fisica_w) * 1440),0);
	tempo_triagem_w := coalesce(((dt_coleta_w - dt_triagem_w) * 1440),0);
	tempo_coleta_w := coalesce(((dt_fim_coleta_w - dt_coleta_w) * 1440),0);

	tempo_servico_w := (tempo_doacao_w + tempo_tri_fisica_w + tempo_triagem_w + tempo_coleta_w);
	end;
end if;


return	tempo_servico_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION hd_monitora_tempo_serv_doacao (ie_tipo_p text, nr_sequencia_p bigint) FROM PUBLIC;

