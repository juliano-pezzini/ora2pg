-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_asa_aval_pre_anest (nr_sequencia_w bigint, ie_opcao_w text) RETURNS varchar AS $body$
DECLARE


ds_retorno_w		varchar(255);
nr_seq_aval_pre_w 	bigint;

expressao1_w	varchar(255) := obter_desc_expressao_idioma(774272, null, wheb_usuario_pck.get_nr_seq_idioma);--I - Paciente hígido (saudável)
expressao2_w	varchar(255) := obter_desc_expressao_idioma(774273, null, wheb_usuario_pck.get_nr_seq_idioma);--II -  Paciente com doença sistêmica leve ou moderada sem limitação funcional
expressao3_w	varchar(255) := obter_desc_expressao_idioma(774274, null, wheb_usuario_pck.get_nr_seq_idioma);--III - Paciente com doença sistêmica grave com limitação funcional mas não incapacitante
expressao4_w	varchar(255) := obter_desc_expressao_idioma(774275, null, wheb_usuario_pck.get_nr_seq_idioma);--IV - Paciente com doença sistêmica grave e incapacitante
expressao5_w	varchar(255) := obter_desc_expressao_idioma(774276, null, wheb_usuario_pck.get_nr_seq_idioma);--V - Paciente moribundo sem esperança de vida por mais de 24 horas com ou sem cirurgia
expressao6_w	varchar(255) := obter_desc_expressao_idioma(774279, null, wheb_usuario_pck.get_nr_seq_idioma);--VI - Paciente com morte cerebral. Doador de órgãos
BEGIN


if (coalesce(nr_sequencia_w,0) > 0) and (ie_opcao_w = 'A') then

	select max(nr_sequencia)
	into STRICT   nr_seq_aval_pre_w
	from   aval_pre_anestesica
	where  nr_seq_agenda = nr_sequencia_w;

elsif (coalesce(nr_sequencia_w,0) > 0) and (ie_opcao_w = 'L') then

	select max(nr_sequencia)
	into STRICT   nr_seq_aval_pre_w
	from   aval_pre_anestesica
	where  nr_seq_lista_espera = nr_sequencia_w;

end if;

if (coalesce(nr_seq_aval_pre_w,0) > 0) then

	select	substr(CASE WHEN ie_asa=1 THEN expressao1_w WHEN ie_asa=2 THEN expressao2_w WHEN ie_asa=3 THEN expressao3_w WHEN ie_asa=4 THEN expressao4_w WHEN ie_asa=5 THEN expressao5_w WHEN ie_asa=6 THEN expressao6_w END ,1,255)
	into STRICT	ds_retorno_w
	from	asa_apae
	where	nr_seq_aval_pre	=	nr_seq_aval_pre_w;

end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_asa_aval_pre_anest (nr_sequencia_w bigint, ie_opcao_w text) FROM PUBLIC;

