-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION hrp_obter_info_man_sf ( NR_ATENDIMENTO_P bigint, NR_ROWNUM_P bigint, DS_INFO_P text) RETURNS varchar AS $body$
DECLARE


DS_RETORNO_W        varchar(100);
DT_AVAL_W           timestamp;
DS_RESULT_W           varchar(100);


BEGIN

    select  dt_avaliacao,
            ds_result
    into STRICT    DT_AVAL_W,
            DS_RESULT_W
    from (   SELECT  x.dt_avaliacao,
                    substr(obter_result_man_sf(x.qt_pontuacao),1,80) ds_result,
                    ROW_NUMBER() OVER (order by x.dt_avaliacao desc) NR_LINHA
            from    ESCALA_MAN_LF x
            where   x.nr_atendimento = NR_ATENDIMENTO_P
            order by x.dt_avaliacao desc ) alias4
    where     nr_linha = NR_ROWNUM_P;


    if (DS_INFO_P   = 'DT') then
        DS_RETORNO_W := TO_CHAR(DT_AVAL_W,'dd/mm/yyyy hh24:mi:ss');
    elsif (DS_INFO_P = 'DS') then
        DS_RETORNO_W := DS_RESULT_W;
    end if;

return DS_RETORNO_W;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION hrp_obter_info_man_sf ( NR_ATENDIMENTO_P bigint, NR_ROWNUM_P bigint, DS_INFO_P text) FROM PUBLIC;

