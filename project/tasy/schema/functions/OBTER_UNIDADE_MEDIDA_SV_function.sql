-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_unidade_medida_sv (nr_seq_sv_p bigint, ds_atributo_p text, ie_um_sv_p text default null) RETURNS varchar AS $body$
DECLARE


ds_um_w			varchar(255);
ds_retorno_w	varchar(255);
ds_celsius_w  varchar(2);
ds_fahrenheit_w  varchar(2);


BEGIN
ds_celsius_w := chr(176)||'C';
ds_fahrenheit_w := chr(176)||'F';
if ((trim(both ds_atributo_p) IS NOT NULL AND (trim(both ds_atributo_p))::text <> '')) then

	select	max(ie_unidade_medida)
	into STRICT	ds_um_w
	from	usuario_sinal_vital_config
	where	nr_seq_sinal_vital = nr_seq_sv_p
	and		nm_usuario = obter_usuario_ativo;

	if (nr_seq_sv_p = 4) then -- Temperatura
		
		if (ds_um_w = ds_fahrenheit_w) and (coalesce(ie_um_sv_p, ds_celsius_w) = ds_celsius_w) then
		
			ds_retorno_w := round(((ds_atributo_p * 1.8) + 32), 1);
			
		elsif (ds_um_w = ds_celsius_w) and (coalesce(ie_um_sv_p, ds_celsius_w) = ds_fahrenheit_w) then
			
			ds_retorno_w := round(((ds_atributo_p - 32) / 1.8), 1);
		
		else
		
			ds_retorno_w := ds_atributo_p;
		
		end if;
		
		ds_retorno_w := ds_retorno_w || ' ' || coalesce(ds_um_w,ie_um_sv_p);
		
	elsif (nr_seq_sv_p in (1,2,8)) then -- PA maxima / PA minima / PAM
	
		select	max(ie_unidade_medida)
		into STRICT	ds_um_w
		from	usuario_sinal_vital_config
		where	nr_seq_sinal_vital = 1
		and		nm_usuario = obter_usuario_ativo;
		
		ds_retorno_w := ds_atributo_p;
		
		if (ds_um_w = 'cmHg') then
			ds_retorno_w := ds_atributo_p / 10;
		end if;

		ds_retorno_w := ds_retorno_w || ' ' || coalesce(ds_um_w,ie_um_sv_p);
		
	elsif (nr_seq_sv_p = 9) then -- FC
		ds_retorno_w := ds_atributo_p || ' ' || coalesce(ds_um_w,ie_um_sv_p);
		
	elsif (nr_seq_sv_p = 3) then -- FR
		ds_retorno_w := ds_atributo_p || ' ' || coalesce(ds_um_w,ie_um_sv_p);

	elsif (nr_seq_sv_p = 12) then -- Peso
		/*  --------- O VALOR PASSADO SEMPRE SERA EM GRAMAS ---------   */

		if (coalesce(ds_um_w,'Kg') = 'Kg') then
		
			ds_retorno_w := (ds_atributo_p / 1000);
		  ds_retorno_w := ds_retorno_w || ' Kg';
		
    elsif (coalesce(ds_um_w,'Kg') = 'g') then
		  ds_retorno_w := ds_atributo_p || ' g';
		else
		
			ds_retorno_w := ds_atributo_p;
		  ds_retorno_w := ds_retorno_w || ' ' || ie_um_sv_p;
		
		end if;
		
	elsif (nr_seq_sv_p = 13) then -- Altura
		/*  --------- O VALOR PASSADO SEMPRE SERA EM CENTIMETROS ---------   */

		if (coalesce(ds_um_w,'m') = 'm') then
			ds_retorno_w := (ds_atributo_p / 100);
		  ds_retorno_w := ds_retorno_w || ' m';

		elsif (coalesce(ds_um_w,'cm') = 'cm') then
		  ds_retorno_w := ds_atributo_p || ' cm';

    elsif (coalesce(ds_um_w,'cm') = 'ft') then
      ds_retorno_w := round((ds_atributo_p * 0.0328084)::numeric, 2);
		  ds_retorno_w := ds_retorno_w || ' ft';
    elsif (coalesce(ds_um_w,'cm') = 'in') then
      ds_retorno_w := round((ds_atributo_p * 0.393701)::numeric, 2);
		  ds_retorno_w := ds_retorno_w || ' in';
		else
			
			ds_retorno_w := ds_atributo_p;
		  ds_retorno_w := ds_retorno_w || ' ' || ie_um_sv_p;
			
		end if;
		
	elsif (nr_seq_sv_p = 14) then -- IMC
		ds_retorno_w := ds_atributo_p || ' ' || coalesce(ds_um_w,ie_um_sv_p);
		
	elsif (nr_seq_sv_p = 15) then -- SC
		ds_retorno_w := ds_atributo_p || ' ' || coalesce(ds_um_w,ie_um_sv_p);
	
	end if;

end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_unidade_medida_sv (nr_seq_sv_p bigint, ds_atributo_p text, ie_um_sv_p text default null) FROM PUBLIC;

