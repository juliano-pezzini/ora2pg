-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_concepto_acreencia ( cd_material_p material.cd_material%type ) RETURNS NUMERIC AS $body$
DECLARE


nr_seq_concepto_acreencia_w	concepto_acreencia.nr_sequencia%type;
nr_seq_fis_agrupar_acreencia_w	fis_agrupar_acreencia.nr_sequencia%type;
cd_grupo_w 			grupo_material.cd_grupo_material%type;
cd_subgrupo_w			subgrupo_material.cd_subgrupo_material%type;
cd_classe_w			classe_material.cd_classe_material%type;


BEGIN
	SELECT	coalesce(OBTER_ESTRUTURA_MATERIAL(cd_material_p, 'G'), 0),
		coalesce(OBTER_ESTRUTURA_MATERIAL(cd_material_p, 'S'), 0),
		coalesce(OBTER_ESTRUTURA_MATERIAL(cd_material_p, 'C'), 0)
	INTO STRICT	cd_grupo_w,
		cd_subgrupo_w,
		cd_classe_w
	;

	select	MAX(a.nr_sequencia)
	into STRICT	nr_seq_fis_agrupar_acreencia_w
	from	fis_agrupar_acreencia a
	where	coalesce(a.cd_material, cd_material_p) = cd_material_p
	and	coalesce(a.cd_classe_material, cd_classe_w) = cd_classe_w
	and	coalesce(a.cd_subgrupo_material, cd_subgrupo_w) = cd_subgrupo_w
	and	coalesce(a.cd_grupo_material, cd_grupo_w) = cd_grupo_w
	order by a.nr_sequencia,
		coalesce(a.cd_material, 0),
		coalesce(a.cd_classe_material, 0),
		coalesce(a.cd_subgrupo_material, 0),
		coalesce(a.cd_grupo_material, 0);

	SELECT	MAX(a.nr_seq_concepto_acreencia)
	INTO STRICT	nr_seq_concepto_acreencia_w
	FROM	fis_agrupar_acreencia a
	WHERE	a.nr_sequencia = nr_seq_fis_agrupar_acreencia_w;

	RETURN	nr_seq_concepto_acreencia_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_concepto_acreencia ( cd_material_p material.cd_material%type ) FROM PUBLIC;

