-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION fis_converte_macro_regra_email (cd_material_p text, ds_mensagem_p text) RETURNS varchar AS $body$
DECLARE


ds_retorno_w		varchar(4000);
ds_classe_material_w	varchar(255);
ds_grupo_material_w	varchar(255);
ds_subgrupo_material_w	varchar(255);
ds_material_w		varchar(255);
ie_tipo_w		varchar(255);
ds_material_generico_w	varchar(255);
cd_material_w		varchar(10);
ie_padronizado_w	varchar(10);
ie_situacao_w		varchar(10);


BEGIN

select	c.ds_classe_material,
	g.ds_grupo_material,
	s.ds_subgrupo_material,
	m.cd_material,
	m.ds_material,
	obter_valor_dominio(29,m.ie_tipo_material),
	a.ds_material,
	m.ie_padronizado,
	m.ie_situacao
into STRICT	ds_classe_material_w,
	ds_grupo_material_w,
	ds_subgrupo_material_w,
	cd_material_w,
	ds_material_w,
	ie_tipo_w,
	ds_material_generico_w,
	ie_padronizado_w,
	ie_situacao_w
FROM subgrupo_material s, grupo_material g, classe_material c, material m
LEFT OUTER JOIN material a ON (m.cd_material_generico = a.cd_material)
WHERE m.cd_classe_material = c.cd_classe_material and c.cd_subgrupo_material = s.cd_subgrupo_material and s.cd_grupo_material = g.cd_grupo_material and m.cd_material = cd_material_p;


ds_retorno_w	:= ds_mensagem_p;
ds_retorno_w	:= substr(replace_macro(ds_retorno_w,'@codigo',cd_material_w),1,4000);
ds_retorno_w	:= substr(replace_macro(ds_retorno_w,'@descricao',coalesce(ds_material_w,'')),1,4000);
ds_retorno_w	:= substr(replace_macro(ds_retorno_w,'@tipo',coalesce(ie_tipo_w,'')),1,4000);
ds_retorno_w	:= substr(replace_macro(ds_retorno_w,'@nome_generico',coalesce(ds_material_generico_w,'')),1,4000);
ds_retorno_w	:= substr(replace_macro(ds_retorno_w,'@grupo',coalesce(ds_grupo_material_w,'')),1,4000);
ds_retorno_w	:= substr(replace_macro(ds_retorno_w,'@subgrupo',coalesce(ds_subgrupo_material_w,'')),1,4000);
ds_retorno_w	:= substr(replace_macro(ds_retorno_w,'@classe',coalesce(ds_classe_material_w,'')),1,4000);
ds_retorno_w	:= substr(replace_macro(ds_retorno_w,'@situacao',coalesce(ie_situacao_w,'')),1,4000);
ds_retorno_w	:= substr(replace_macro(ds_retorno_w,'@padronizado',coalesce(ie_padronizado_w,'')),1,4000);

return	substr(ds_retorno_w,1,255);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION fis_converte_macro_regra_email (cd_material_p text, ds_mensagem_p text) FROM PUBLIC;

