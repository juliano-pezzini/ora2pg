-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION busca_total_orcamento_custo ( ie_orcado_real_p text, cd_empresa_p bigint, cd_estabelecimento_p bigint, cd_centro_controle_p bigint, dt_referencia_p timestamp) RETURNS bigint AS $body$
DECLARE


total_w		double precision;


BEGIN

SELECT SUM(a.vl_orcado) total
into STRICT   total_w
FROM	grupo_natureza_gasto e,
	natureza_gasto d,
	centro_controle c,
	tabela_custo b,
	orcamento_custo a
WHERE	a.cd_tabela_custo	= b.cd_tabela_custo
AND	b.ie_orcado_real        = ie_orcado_real_p
AND	a.cd_estabelecimento	= b.cd_estabelecimento
AND	a.cd_centro_controle	= c.cd_centro_controle
AND	a.cd_estabelecimento	= c.cd_estabelecimento
AND	a.nr_seq_ng		= d.nr_sequencia
AND	d.nr_seq_gng		= e.nr_sequencia
AND	a.cd_estabelecimento	= coalesce(d.cd_estabelecimento,a.cd_estabelecimento)
AND	a.cd_estabelecimento	= coalesce(e.cd_estabelecimento,a.cd_estabelecimento)
AND	e.cd_empresa		= d.cd_empresa
AND	e.cd_empresa		= cd_empresa_p
AND	a.cd_estabelecimento	= cd_estabelecimento_p
AND (c.cd_centro_controle	= cd_centro_controle_p)
AND	PKG_DATE_UTILS.start_of(b.dt_mes_referencia, 'month', 0) BETWEEN PKG_DATE_UTILS.start_of(PKG_DATE_UTILS.ADD_MONTH(dt_referencia_p, -2, 0), 'month', 0) AND PKG_DATE_UTILS.start_of(dt_referencia_p, 'month', 0);

return	total_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION busca_total_orcamento_custo ( ie_orcado_real_p text, cd_empresa_p bigint, cd_estabelecimento_p bigint, cd_centro_controle_p bigint, dt_referencia_p timestamp) FROM PUBLIC;

