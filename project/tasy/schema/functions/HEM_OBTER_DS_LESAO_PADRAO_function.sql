-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION hem_obter_ds_lesao_padrao (nr_seq_proc_p hem_proc.nr_sequencia%type) RETURNS varchar AS $body$
DECLARE


C01 CURSOR FOR
	SELECT	ds_lesao
	from	hem_lesao
	where	nr_seq_proc = nr_seq_proc_p
	order by 1;

qt_registros_w 		bigint;
ds_nova_lesao_w		hem_lesao.ds_lesao%type;
nr_contador_w		bigint;
ds_texto_w	varchar(10);


BEGIN

select	count(1)
into STRICT	qt_registros_w
from	hem_lesao
where	nr_seq_proc = nr_seq_proc_p;

ds_texto_w := wheb_mensagem_pck.get_Texto(1008092); --Lesão
nr_contador_w := 1;

if (qt_registros_w > 0) then

	ds_nova_lesao_w :=  ds_texto_w ||' '|| (qt_registros_w + 1);

	-- Verificar se existe alguma descrição igual para gerar a próxima.
	/*for r_C01 in C01 loop
		begin
		if	(r_C01.ds_lesao = ds_nova_lesao_w) then
			nr_contador_w := nr_contador_w + 1;
			ds_nova_lesao_w := ds_texto_w ||' '|| nr_contador_w;
		end if;
		end;
	end loop;*/
else
	ds_nova_lesao_w :=  ds_texto_w ||' 1';
end if;

return	ds_nova_lesao_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION hem_obter_ds_lesao_padrao (nr_seq_proc_p hem_proc.nr_sequencia%type) FROM PUBLIC;

