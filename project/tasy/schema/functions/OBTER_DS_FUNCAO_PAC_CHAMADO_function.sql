-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_ds_funcao_pac_chamado (NR_SEQ_SENHA_P bigint) RETURNS varchar AS $body$
DECLARE


cd_funcao_ativa_w bigint;
cd_func_w         bigint;

c01 CURSOR FOR
	SELECT  cd_funcao_ativa
	from 	paciente_senha_fila_hist
	where 	nr_seq_senha = nr_seq_senha_p
	and 	cd_funcao_ativa in (281,722,935)
	order by dt_atualizacao desc;


BEGIN

open c01;
loop
fetch c01 into
	cd_func_w;
	EXIT WHEN NOT FOUND; /* apply on c01 */
	begin
		if (coalesce(cd_funcao_ativa_w::text, '') = '') then
			cd_funcao_ativa_w := cd_func_w;
			exit;
		end if;
	end;
end loop;
close c01;

if (cd_funcao_ativa_w = 281) then
	return 'S';
elsif (cd_funcao_ativa_w = 935) then
	return 'PA';
elsif (cd_funcao_ativa_w = 722) then
	return 'EXAM';
else
	return 'N';
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_ds_funcao_pac_chamado (NR_SEQ_SENHA_P bigint) FROM PUBLIC;

