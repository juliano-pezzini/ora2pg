-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_exibe_populacional ( nr_seq_regiao_p bigint default null, nr_seq_micro_regiao_p bigint default null, ie_opcao_p text DEFAULT NULL, cd_cep_p text default null, ds_endereco_p text default null, ds_bairro_p text default null, cd_domicilio_p text default null, cd_cidadao_p text default null, nr_cpf_p text default null, dt_inicio_cons_p timestamp default null, dt_fim_cons_p timestamp default null, cd_profissional_p text default null, nr_seq_servico_p bigint default null, ie_vacina_pend_p text default 'N', ie_gravida_p text default 'N', ie_exame_pend_p text default 'N', ie_receita_fim_p text default 'N', ie_tipo_doenca_p text default null, cd_ciap_p text default null, cd_doenca_p text default null, nr_seq_problema_p bigint default null, ie_cronico_p text default null, ie_intensidade_p text default null, ie_tipo_domicilio_p text default null, ie_tratamento_agua_p text default null, ie_tipo_agua_p text default null, ie_destino_lixo_p text default null, ie_esgoto_sanitario_p text default null, ie_tipo_comunicacao_p text default null, ie_tipo_doenca_res_p text default null, ie_tipo_transporte_p text default null, ie_sem_energia_eletrica_p text default null, cd_empresa_refer_p bigint default null, nr_seq_setor_p bigint default null) RETURNS varchar AS $body$
DECLARE


ds_retorno_w 	varchar(1)  := 'S';
				
				

BEGIN

if (ie_opcao_p = 'R') then


	select	coalesce(max('S'),'N')
	into STRICT	ds_retorno_w
	from	psf_micro_area a,
			domicilio_familia b,
			pessoa_fisica c
	where   a.nr_seq_area = coalesce(nr_seq_regiao_p,a.nr_seq_area )
	and		a.nr_sequencia = coalesce(nr_seq_micro_regiao_p,a.nr_sequencia)
	and		b.nr_seq_microarea = a.nr_sequencia
	and		b.cd_pessoa_fisica = c.cd_pessoa_fisica
	and     coalesce(a.ie_situacao,'A') = 'A'
	and		((coalesce(cd_cep_p::text, '') = '') or (b.cd_cep = cd_cep_p))
	and		((coalesce(ds_endereco_p::text, '') = '') or (upper(b.DS_ENDERECO) like upper('%'||ds_endereco_p||'%')))
	and		((coalesce(ds_bairro_p::text, '') = '') or (upper(b.ds_bairro) like upper('%'||ds_bairro_p||'%')))
	and		((coalesce(cd_cidadao_p::text, '') = '') or (c.cd_pessoa_fisica = cd_cidadao_p))
	and		((coalesce(nr_cpf_p::text, '') = '') or (somente_numero(c.nr_cpf) = somente_numero(nr_cpf_p)))
	and		(((coalesce(dt_inicio_cons_p::text, '') = '') and (coalesce(dt_fim_cons_p::text, '') = '') and (coalesce(cd_profissional_p::text, '') = '') and (coalesce(nr_seq_servico_p::text, '') = '')) or ( obter_dados_qt_gestao_popul(c.cd_pessoa_fisica,'QC',dt_inicio_cons_p,dt_fim_cons_p, cd_profissional_p,nr_seq_servico_p) > 0))
	and		((coalesce(ie_vacina_pend_p,'N') = 'N') or (obter_dados_pend_gestao_popul(c.cd_pessoa_fisica,'VP') > 0))
	and		((coalesce(ie_gravida_p,'N') = 'N') or (obter_dados_pend_gestao_popul(c.cd_pessoa_fisica,'G') > 0))
	and		((coalesce(ie_exame_pend_p,'N') = 'N') or (obter_dados_pend_gestao_popul(c.cd_pessoa_fisica,'EP') > 0))
	and		((coalesce(ie_receita_fim_p,'N') = 'N') or (obter_dados_pend_gestao_popul(c.cd_pessoa_fisica,'RP') > 0))
	and		(((coalesce(nr_seq_problema_p::text, '') = '') and (coalesce(ie_tipo_doenca_p::text, '') = '') and (coalesce(cd_ciap_p::text, '') = '') and (coalesce(cd_doenca_p::text, '') = '') and (coalesce(ie_cronico_p,'N') = 'N') and (coalesce(ie_intensidade_p,'T') = 'T')) or ( obter_dados_doenca_gest_popul(c.cd_pessoa_fisica,'P',ie_tipo_doenca_p,cd_ciap_p, cd_doenca_p , nr_seq_problema_p,ie_cronico_p, ie_intensidade_p) = 'S'))
	and		(((coalesce(ie_tipo_domicilio_p::text, '') = '') and (coalesce(ie_tratamento_agua_p::text, '') = '') and (coalesce(ie_tipo_agua_p::text, '') = '') and (coalesce(ie_destino_lixo_p::text, '') = '') and (coalesce(ie_esgoto_sanitario_p::text, '') = '') and (coalesce(ie_tipo_comunicacao_p::text, '') = '') and (coalesce(ie_tipo_doenca_res_p::text, '') = '') and (coalesce(ie_tipo_transporte_p::text, '') = '') and (coalesce( ie_sem_energia_eletrica_p,'N') = 'N'))
			or (obter_dados_residen_gest_popul(cd_domicilio,'R',ie_tipo_domicilio_p,ie_tratamento_agua_p,ie_tipo_agua_p,ie_destino_lixo_p,ie_esgoto_sanitario_p,ie_tipo_comunicacao_p,
																ie_tipo_doenca_res_p,ie_tipo_transporte_p,ie_sem_energia_eletrica_p)   = 'S'))
	and		(((coalesce(cd_empresa_refer_p::text, '') = '') and (coalesce(nr_seq_setor_p::text, '') = ''))
			or (obter_dados_emp_set_gest_popul(c.cd_pessoa_fisica,cd_empresa_refer_p,nr_seq_setor_p) > 0));
	

elsif (ie_opcao_p = 'M') then	

	select	coalesce(max('S'),'N')
	into STRICT	ds_retorno_w
	from   	domicilio_familia b,
			pessoa_fisica c
	where  	b.nr_seq_microarea = coalesce(nr_seq_micro_regiao_p,b.nr_seq_microarea)
	and		b.cd_pessoa_fisica = c.cd_pessoa_fisica
	and		((coalesce(cd_cep_p::text, '') = '') or (b.cd_cep = cd_cep_p))
	and		((coalesce(ds_endereco_p::text, '') = '') or (upper(b.DS_ENDERECO) like upper('%'||ds_endereco_p||'%')))
	and		((coalesce(ds_bairro_p::text, '') = '') or (upper(b.ds_bairro) like upper('%'||ds_bairro_p||'%')))
	and		((coalesce(cd_cidadao_p::text, '') = '') or (c.cd_pessoa_fisica = cd_cidadao_p))
	and		((coalesce(nr_cpf_p::text, '') = '') or (somente_numero(c.nr_cpf) = somente_numero(nr_cpf_p)))
	and		(((coalesce(dt_inicio_cons_p::text, '') = '') and (coalesce(dt_fim_cons_p::text, '') = '') and (coalesce(cd_profissional_p::text, '') = '') and (coalesce(nr_seq_servico_p::text, '') = '')) or ( obter_dados_qt_gestao_popul(c.cd_pessoa_fisica,'QC',dt_inicio_cons_p,dt_fim_cons_p, cd_profissional_p,nr_seq_servico_p) > 0))
	and		((coalesce(ie_vacina_pend_p,'N') = 'N') or (obter_dados_pend_gestao_popul(c.cd_pessoa_fisica,'VP') > 0))
	and		((coalesce(ie_gravida_p,'N') = 'N') or (obter_dados_pend_gestao_popul(c.cd_pessoa_fisica,'G') > 0))
	and		((coalesce(ie_exame_pend_p,'N') = 'N') or (obter_dados_pend_gestao_popul(c.cd_pessoa_fisica,'EP') > 0))
	and		((coalesce(ie_receita_fim_p,'N') = 'N') or (obter_dados_pend_gestao_popul(c.cd_pessoa_fisica,'RP') > 0))
	and		(((coalesce(nr_seq_problema_p::text, '') = '') and (coalesce(ie_tipo_doenca_p::text, '') = '') and (coalesce(cd_ciap_p::text, '') = '') and (coalesce(cd_doenca_p::text, '') = '') and (coalesce(ie_cronico_p,'N') = 'N') and (coalesce(ie_intensidade_p,'T') = 'T')) or ( obter_dados_doenca_gest_popul(c.cd_pessoa_fisica,'P',ie_tipo_doenca_p,cd_ciap_p, cd_doenca_p , nr_seq_problema_p,ie_cronico_p, ie_intensidade_p) = 'S'))
	and		(((coalesce(ie_tipo_domicilio_p::text, '') = '') and (coalesce(ie_tratamento_agua_p::text, '') = '') and (coalesce(ie_tipo_agua_p::text, '') = '') and (coalesce(ie_destino_lixo_p::text, '') = '') and (coalesce(ie_esgoto_sanitario_p::text, '') = '') and (coalesce(ie_tipo_comunicacao_p::text, '') = '') and (coalesce(ie_tipo_doenca_res_p::text, '') = '') and (coalesce(ie_tipo_transporte_p::text, '') = '') and (coalesce( ie_sem_energia_eletrica_p,'N') = 'N'))
			or (obter_dados_residen_gest_popul(cd_domicilio,'R',ie_tipo_domicilio_p,ie_tratamento_agua_p,ie_tipo_agua_p,ie_destino_lixo_p,ie_esgoto_sanitario_p,ie_tipo_comunicacao_p,
																ie_tipo_doenca_res_p,ie_tipo_transporte_p,ie_sem_energia_eletrica_p)   = 'S'))
	and		(((coalesce(cd_empresa_refer_p::text, '') = '') and (coalesce(nr_seq_setor_p::text, '') = ''))
			or (obter_dados_emp_set_gest_popul(c.cd_pessoa_fisica,cd_empresa_refer_p,nr_seq_setor_p) > 0));


elsif (ie_opcao_p = 'C') then
	
	select	coalesce(max('S'),'N')
	into STRICT	ds_retorno_w
	from    pessoa_fisica c,
			domicilio_familia b
	where   b.cd_domicilio = coalesce(cd_domicilio_p,b.cd_domicilio)
	and		b.cd_pessoa_fisica = c.cd_pessoa_fisica
	and		((coalesce(cd_cidadao_p::text, '') = '') or (c.cd_pessoa_fisica = cd_cidadao_p))
	and		((coalesce(nr_cpf_p::text, '') = '') or (somente_numero(c.nr_cpf) = somente_numero(nr_cpf_p)))
	and		(((coalesce(dt_inicio_cons_p::text, '') = '') and (coalesce(dt_fim_cons_p::text, '') = '') and (coalesce(cd_profissional_p::text, '') = '') and (coalesce(nr_seq_servico_p::text, '') = '')) or ( obter_dados_qt_gestao_popul(c.cd_pessoa_fisica,'QC',dt_inicio_cons_p,dt_fim_cons_p, cd_profissional_p,nr_seq_servico_p) > 0 ))
	and		((coalesce(ie_vacina_pend_p,'N') = 'N') or (obter_dados_pend_gestao_popul(c.cd_pessoa_fisica,'VP') > 0))
	and		((coalesce(ie_gravida_p,'N') = 'N') or (obter_dados_pend_gestao_popul(c.cd_pessoa_fisica,'G') > 0))
	and		((coalesce(ie_exame_pend_p,'N') = 'N') or (obter_dados_pend_gestao_popul(c.cd_pessoa_fisica,'EP') > 0))
	and		((coalesce(ie_receita_fim_p,'N') = 'N') or (obter_dados_pend_gestao_popul(c.cd_pessoa_fisica,'RP') > 0))
	and		(((coalesce(nr_seq_problema_p::text, '') = '') and (coalesce(ie_tipo_doenca_p::text, '') = '') and (coalesce(cd_ciap_p::text, '') = '') and (coalesce(cd_doenca_p::text, '') = '') and (coalesce(ie_cronico_p,'N') = 'N') and (coalesce(ie_intensidade_p,'T') = 'T')) or ( obter_dados_doenca_gest_popul(c.cd_pessoa_fisica,'P',ie_tipo_doenca_p,cd_ciap_p, cd_doenca_p , nr_seq_problema_p,ie_cronico_p, ie_intensidade_p) = 'S'))
	and		(((coalesce(cd_empresa_refer_p::text, '') = '') and (coalesce(nr_seq_setor_p::text, '') = ''))
			or (obter_dados_emp_set_gest_popul(c.cd_pessoa_fisica,cd_empresa_refer_p,nr_seq_setor_p) > 0));
	
	
end if;	

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_exibe_populacional ( nr_seq_regiao_p bigint default null, nr_seq_micro_regiao_p bigint default null, ie_opcao_p text DEFAULT NULL, cd_cep_p text default null, ds_endereco_p text default null, ds_bairro_p text default null, cd_domicilio_p text default null, cd_cidadao_p text default null, nr_cpf_p text default null, dt_inicio_cons_p timestamp default null, dt_fim_cons_p timestamp default null, cd_profissional_p text default null, nr_seq_servico_p bigint default null, ie_vacina_pend_p text default 'N', ie_gravida_p text default 'N', ie_exame_pend_p text default 'N', ie_receita_fim_p text default 'N', ie_tipo_doenca_p text default null, cd_ciap_p text default null, cd_doenca_p text default null, nr_seq_problema_p bigint default null, ie_cronico_p text default null, ie_intensidade_p text default null, ie_tipo_domicilio_p text default null, ie_tratamento_agua_p text default null, ie_tipo_agua_p text default null, ie_destino_lixo_p text default null, ie_esgoto_sanitario_p text default null, ie_tipo_comunicacao_p text default null, ie_tipo_doenca_res_p text default null, ie_tipo_transporte_p text default null, ie_sem_energia_eletrica_p text default null, cd_empresa_refer_p bigint default null, nr_seq_setor_p bigint default null) FROM PUBLIC;

