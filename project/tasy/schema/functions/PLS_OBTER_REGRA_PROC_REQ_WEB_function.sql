-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_regra_proc_req_web ( ie_tipo_guia_p text, ie_evento_p text, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) RETURNS varchar AS $body$
DECLARE


/*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:  Obter as regras de lançamento automático
----------------------------------------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [  ] Tasy (Delphi/Java) [ x ] Portal [  ] Relatórios [ ] Outros:
 ----------------------------------------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/nr_retorno_w			integer;
ds_retorno_w			varchar(255)	:= 'S';
ie_restringe_estab_w		varchar(2);


BEGIN

ie_restringe_estab_w	:= pls_obter_se_controle_estab('LA');

select	count(1)
into STRICT	nr_retorno_w
from	pls_regra_lanc_automatico a,
	pls_regra_lanc_aut_item b
where	b.nr_seq_regra = a.nr_sequencia
and	a.ie_situacao	= 'A'
and	a.ie_evento 	= ie_evento_p
and	a.ie_tipo_guia	= ie_tipo_guia_p
and (coalesce(a.ie_origem_lancamento::text, '') = '' or a.ie_origem_lancamento = 'P' or a.ie_origem_lancamento = 'A')
and	((ie_restringe_estab_w	= 'N')
or	(ie_restringe_estab_w	= 'S' AND cd_estabelecimento = cd_estabelecimento_p));

if (nr_retorno_w	= 0) then
	ds_retorno_w	:= 'N';
end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_regra_proc_req_web ( ie_tipo_guia_p text, ie_evento_p text, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) FROM PUBLIC;

