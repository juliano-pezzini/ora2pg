-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cpoe_enable_dias_solic_antimic (cd_material_p bigint, nr_dia_util_p bigint, qt_dias_liberado_p bigint) RETURNS varchar AS $body$
DECLARE


ie_controle_medico_w			material.ie_controle_medico%type;
ie_dias_util_medic_w			material.ie_dias_util_medic%type;

ie_dias_validade_w				varchar(1);
ie_atb_pessoa_w					varchar(1);
ie_enable_w						varchar(1) := 'N';


BEGIN

--Consiste_Util_medic(	nr_prescricao_p, nr_atendimento_p, dt_inicio_prescr_p, cd_material_w,
				--nr_dia_util_w, qt_dias_liberado_w, ie_controle_medico_w, qt_total_dias_lib_w );
select	coalesce(max(a.ie_controle_medico),0),
		coalesce(max(a.ie_dias_util_medic),'O')
into STRICT	ie_controle_medico_w,
		ie_dias_util_medic_w
from	material a
where	a.cd_material		 = cd_material_p;

if (ie_controle_medico_w <> 0) then
	if	((ie_dias_util_medic_w = 'S' AND nr_dia_util_p > 1) or
		 (ie_dias_util_medic_w = 'O' AND nr_dia_util_p > 0)) then
			if (qt_dias_liberado_p > 0) then
				if (ie_dias_util_medic_w = 'O') then
					if (nr_dia_util_p < qt_dias_liberado_p) then
						ie_enable_w := 'N';
					else
						if (nr_dia_util_p - qt_dias_liberado_p = 0) then
							ie_enable_w := 'S';
						else
							ie_enable_w := 'N';
						end if;
					end if;
				elsif (ie_dias_util_medic_w = 'S') then
					if (nr_dia_util_p <= qt_dias_liberado_p) then
						ie_enable_w := 'N';
					else
						if (nr_dia_util_p - qt_dias_liberado_p = 1) then
							ie_enable_w := 'S';
						else
							ie_enable_w := 'N';
						end if;
					end if;
				end if;
			else
				ie_enable_w := 'N';
			end if;
	end if;
else
	ie_enable_w := 'N';
end if;

return ie_enable_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_enable_dias_solic_antimic (cd_material_p bigint, nr_dia_util_p bigint, qt_dias_liberado_p bigint) FROM PUBLIC;

