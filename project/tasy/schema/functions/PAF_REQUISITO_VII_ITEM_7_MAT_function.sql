-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION paf_requisito_vii_item_7_mat (cd_material_p bigint, cd_estabelecimento_p bigint) RETURNS varchar AS $body$
DECLARE


ds_retorno_w	varchar(2000);
cd_cgc_w	varchar(20);


BEGIN

select 	cd_cgc
into STRICT	cd_cgc_w
from	estabelecimento
where	cd_estabelecimento = cd_estabelecimento_p;

select	'P2' ||
	substr(lpad(cd_cgc_w,14,'0'),1,14) ||
	substr(lpad(a.cd_material,14,'0'),1,14) ||
	substr(rpad(a.ds_material,50,' '),1,50) ||
	substr(rpad(coalesce(b.cd_unidade_venda,' '),06,' '),1,6) ||
	'T' ||
	'T' ||
	coalesce(b.ie_situacao_tributaria,'N') ||
	lpad(CASE WHEN b.ie_situacao_tributaria='T' THEN coalesce(b.nr_icms,0) WHEN b.ie_situacao_tributaria='S' THEN coalesce(b.nr_iss,0)  ELSE '0' END ,4,'0') ||
	lpad(replace(campo_mascara(coalesce(far_obter_preco_material(cd_material_p,cd_estabelecimento_p,null),'0'),2),'.',''),12,0)
into STRICT	ds_retorno_w
from	material a,
	material_estab b
where	a.cd_material = b.cd_material
and	a.cd_material = cd_material_p
and	b.cd_estabelecimento = cd_estabelecimento_p;


return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION paf_requisito_vii_item_7_mat (cd_material_p bigint, cd_estabelecimento_p bigint) FROM PUBLIC;

