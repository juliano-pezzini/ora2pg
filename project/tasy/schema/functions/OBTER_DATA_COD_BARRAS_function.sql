-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_data_cod_barras (nr_bloqueto_p text, ie_opcao_p text) RETURNS timestamp AS $body$
DECLARE


/*	ie_opcao_p

DT	vencimento

*/
cd_banco_w		varchar(3);
dt_vencimento_w		timestamp;


BEGIN

select	substr(nr_bloqueto_p,1,3)
into STRICT	cd_banco_w
;


	/* HSBC */

	if (cd_banco_w = '399') then

		if (ie_opcao_p	= 'DT') then

			dt_vencimento_w		:= to_date('07/10/1997','dd/mm/yyyy') + somente_numero(substr(nr_bloqueto_p,6,4));

		end if;


	/* Itaú */

	elsif (cd_banco_w = '341') then

		if (ie_opcao_p	= 'DT') then

			dt_vencimento_w		:= to_date('07/10/1997','dd/mm/yyyy') + somente_numero(substr(nr_bloqueto_p,6,4));
		end if;

	/* Banco do Brasil */

	elsif (cd_banco_w = '001') then

		if (ie_opcao_p	= 'DT') then

			dt_vencimento_w		:= to_date('07/10/1997','dd/mm/yyyy') + somente_numero(substr(nr_bloqueto_p,6,4));
		end if;

	/* Bradesco */

	elsif (cd_banco_w in ('237', '291')) then

		if (ie_opcao_p	= 'DT') then

			dt_vencimento_w		:= to_date('07/10/1997','dd/mm/yyyy') + somente_numero(substr(nr_bloqueto_p,6,4));
		end if;

	/* Caixa Economica Federal */

	elsif (cd_banco_w = '104') then

		if (ie_opcao_p	= 'DT') then

			dt_vencimento_w		:= to_date('07/10/1997','dd/mm/yyyy') + somente_numero(substr(nr_bloqueto_p,6,4));
		end if;


	/* Unibanco */

	elsif (cd_banco_w = '409') then

		if (ie_opcao_p	= 'DT') then

			dt_vencimento_w		:= to_date('07/10/1997','dd/mm/yyyy') + somente_numero(substr(nr_bloqueto_p,6,4));
		end if;

	/* ABN Amro Real SA */

	elsif (cd_banco_w = '356') then

		if (ie_opcao_p	= 'DT') then

			dt_vencimento_w		:= to_date('07/10/1997','dd/mm/yyyy') + somente_numero(substr(nr_bloqueto_p,6,4));
		end if;

	/* Citibank */

	elsif (cd_banco_w = '745') then

		if (ie_opcao_p	= 'DT') then

			dt_vencimento_w		:= to_date('07/10/1997','dd/mm/yyyy') + somente_numero(substr(nr_bloqueto_p,6,4));
		end if;

	/* Banco Santander Banespa */

	elsif (cd_banco_w = '033') then

		if (ie_opcao_p	= 'DT') then

			dt_vencimento_w		:= to_date('07/10/1997','dd/mm/yyyy') + somente_numero(substr(nr_bloqueto_p,6,4));
		end if;

	/*Banco Safra*/

	elsif (cd_banco_w = '422') then

		if (ie_opcao_p	= 'DT') then

			dt_vencimento_w		:= to_date('07/10/1997','dd/mm/yyyy') + somente_numero(substr(nr_bloqueto_p,6,4));
		end if;

	/*Banco Industrial e Comercial*/

	elsif (cd_banco_w = '320') then

		if (ie_opcao_p	= 'DT') then

			dt_vencimento_w		:= to_date('07/10/1997','dd/mm/yyyy') + somente_numero(substr(nr_bloqueto_p,6,4));
		end if;

	/* Unicred */

	elsif (cd_banco_w = '136') then
		if (ie_opcao_p	= 'DT') then

			dt_vencimento_w		:= to_date('07/10/1997','dd/mm/yyyy') + somente_numero(substr(nr_bloqueto_p,6,4));
		end if;

	/* Sicredi */

	elsif (cd_banco_w = '748') then
		if (ie_opcao_p	= 'DT') then

			dt_vencimento_w		:= to_date('07/10/1997','dd/mm/yyyy') + somente_numero(substr(nr_bloqueto_p,6,4));
		end if;

	/* Banrisul */

	elsif (cd_banco_w = '041') then
		if (ie_opcao_p	= 'DT') then

			dt_vencimento_w		:= to_date('07/10/1997','dd/mm/yyyy') + somente_numero(substr(nr_bloqueto_p,6,4));
		end if;

	else
		/* Caso não seja dos bancos acima, retira o valor do bloqueto e data de vencimento da posição padrão da Febraban */

		if (ie_opcao_p	= 'DT') then

			dt_vencimento_w		:= to_date('07/10/1997','dd/mm/yyyy') + somente_numero(substr(nr_bloqueto_p,6,4));
		end if;
	end if;


if (ie_opcao_p	= 'DT') then
	return	dt_vencimento_w;
else
	return	null;
end if;

end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_data_cod_barras (nr_bloqueto_p text, ie_opcao_p text) FROM PUBLIC;

