-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_it_servs_nf_contat (nr_sequencia_nf_p bigint) RETURNS varchar AS $body$
DECLARE


retorno_w	varchar(4000);
item_atual_w	varchar(300);

c01 CURSOR FOR
--	SELECT	'Material ' ||a.cd_material||' - '||decode(a.cd_procedimento, null, 'Procedimento n√£o cadastrado','Procedimento '|| a.cd_procedimento)|| ' - ' || SUBSTR(obter_desc_material(a.cd_material),1,300) || ' - ' || ' R$ ' ||(TO_CHAR(vl_total_item_nf, 'FM999G999G999D90'))
	SELECT	wheb_mensagem_pck.get_texto(299657,null) || ' ' ||a.cd_material||' - '||CASE WHEN coalesce(a.cd_procedimento::text, '') = '' THEN  wheb_mensagem_pck.get_texto(299764,null)  ELSE wheb_mensagem_pck.get_texto(286020,null) || ' '|| a.cd_procedimento END || ' - ' || SUBSTR(obter_desc_material(a.cd_material),1,300) || ' - ' || wheb_mensagem_pck.get_texto(299769,null) || ' ' ||(TO_CHAR(vl_total_item_nf, 'FM999G999G999D90'))
	FROM	nota_fiscal_item a,
		nota_fiscal_venc b
	WHERE 	a.nr_sequencia = nr_sequencia_nf_p
	AND	b.nr_sequencia = nr_sequencia_nf_p;


BEGIN

	open c01;
	loop
	fetch c01 into
		item_atual_w;
	EXIT WHEN NOT FOUND; /* apply on c01 */
		retorno_w := retorno_w || ' ' || chr(13) || ' ' || item_atual_w;
	end loop;
	close c01;
return retorno_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_it_servs_nf_contat (nr_sequencia_nf_p bigint) FROM PUBLIC;

