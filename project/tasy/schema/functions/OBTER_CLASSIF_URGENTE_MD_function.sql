-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_classif_urgente_md ( ie_param_controll_p bigint, ie_classif_nao_padrao_p text, ie_padronizado_dil_p text, ie_padronizado_p text, ie_classif_normal_acm_sn_p text, ie_se_necessario_dil_p text, ie_se_necessario_p text, ie_acm_dil_p text, ie_acm_p text, dt_horario_p timestamp, dt_limite_agora_p timestamp, ie_urgente_p text, ie_agora_impressao_p text, ie_define_agora_p text, qt_min_antes_atend_p bigint, dt_limite_especial_p timestamp ) RETURNS varchar AS $body$
DECLARE

  ie_classif_urgente_w varchar(3);

BEGIN
  if (ie_param_controll_p = 0) then
    if (coalesce(ie_classif_nao_padrao_p::text, '') = '') or (ie_padronizado_dil_p = 'S') then
      begin
        ie_classif_urgente_w := 'N';
        if ((coalesce(ie_classif_normal_acm_sn_p, 'N') = 'N') or ((coalesce(ie_classif_normal_acm_sn_p, 'N') = 'S') and (coalesce(ie_se_necessario_dil_p, 'N') = 'N') and (coalesce(ie_acm_dil_p, 'N') = 'N'))) then
          if (dt_horario_p <= dt_limite_agora_p) or (ie_urgente_p = 'S') then
            ie_classif_urgente_w := 'A';
          elsif ((dt_limite_agora_p <= clock_timestamp()) and (ie_agora_impressao_p = 'S') and (ie_define_agora_p = 'N')) then
            ie_classif_urgente_w := 'A';
          elsif (ie_agora_impressao_p = 'S' and ie_define_agora_p = 'S') and (dt_horario_p <= (clock_timestamp() + (dividir_sem_round_md(qt_min_antes_atend_p, 1440)))) then
            ie_classif_urgente_w := 'A';
          elsif (dt_horario_p <= dt_limite_especial_p) then
            ie_classif_urgente_w := 'E';
          end if;
        end if;
      end;
    else
      ie_classif_urgente_w := ie_classif_nao_padrao_p;
    end if;
  elsif (ie_param_controll_p = 1) then
    if (coalesce(ie_classif_nao_padrao_p::text, '') = '') or (ie_padronizado_p = 'S') then
      begin
        ie_classif_urgente_w := 'N';
        if ((coalesce(ie_classif_normal_acm_sn_p, 'N') = 'N') or ((coalesce(ie_classif_normal_acm_sn_p, 'N') = 'S') and (coalesce(ie_se_necessario_p, 'N') = 'N') and (coalesce(ie_acm_p, 'N') = 'N'))) then
          if (dt_horario_p <= dt_limite_agora_p) or (ie_urgente_p = 'S') then
            ie_classif_urgente_w := 'A';
          elsif ((dt_limite_agora_p <= clock_timestamp()) and (ie_agora_impressao_p = 'S') and (ie_define_agora_p = 'N')) then
            ie_classif_urgente_w := 'A';
          elsif (ie_agora_impressao_p = 'S' and ie_define_agora_p = 'S') and (dt_horario_p <= (clock_timestamp() + (dividir_sem_round_md(qt_min_antes_atend_p, 1440)))) then
            ie_classif_urgente_w := 'A';
          elsif (dt_horario_p <= dt_limite_especial_p) then
            ie_classif_urgente_w := 'E';
          end if;
        end if;
      end;
    else
      ie_classif_urgente_w := ie_classif_nao_padrao_p;
	end if;
  end if;
	
  return ie_classif_urgente_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_classif_urgente_md ( ie_param_controll_p bigint, ie_classif_nao_padrao_p text, ie_padronizado_dil_p text, ie_padronizado_p text, ie_classif_normal_acm_sn_p text, ie_se_necessario_dil_p text, ie_se_necessario_p text, ie_acm_dil_p text, ie_acm_p text, dt_horario_p timestamp, dt_limite_agora_p timestamp, ie_urgente_p text, ie_agora_impressao_p text, ie_define_agora_p text, qt_min_antes_atend_p bigint, dt_limite_especial_p timestamp ) FROM PUBLIC;

