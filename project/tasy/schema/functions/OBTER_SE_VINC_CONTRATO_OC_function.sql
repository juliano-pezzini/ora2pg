-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_vinc_contrato_oc ( nr_seq_contrato_p bigint) RETURNS varchar AS $body$
DECLARE


cd_estabelecimento_w			bigint;
nr_seq_tipo_contrato_w			bigint;
nr_seq_subtipo_contrato_w			bigint;
ie_renovacao_w				varchar(1);
cd_condicao_pagamento_w			bigint;
qt_registros_w				bigint;
ie_vincular_w				varchar(1) := 'N';


BEGIN

select	cd_estabelecimento,
	nr_seq_tipo_contrato,
	nr_seq_subtipo_contrato,
	ie_renovacao,
	cd_condicao_pagamento
into STRICT	cd_estabelecimento_w,
	nr_seq_tipo_contrato_w,
	nr_seq_subtipo_contrato_w,
	ie_renovacao_w,
	cd_condicao_pagamento_w
from	contrato
where	nr_sequencia = nr_seq_contrato_p;

select	count(*)
into STRICT	qt_registros_w
from	regra_contrato_vinc_oc
where	cd_estabelecimento = cd_estabelecimento_w
and	ie_situacao = 'A'
and	ie_vincular = 'S'
and	coalesce(nr_seq_tipo_contrato, nr_seq_tipo_contrato_w)	= nr_seq_tipo_contrato_w
and	coalesce(ie_renovacao, ie_renovacao_w)			= ie_renovacao_w
and	((coalesce(nr_seq_subtipo_contrato, nr_seq_subtipo_contrato_w)	= nr_seq_subtipo_contrato_w) or (coalesce(nr_seq_subtipo_contrato::text, '') = ''))
and	((coalesce(cd_condicao_pagamento, cd_condicao_pagamento_w)= cd_condicao_pagamento_w) or (coalesce(cd_condicao_pagamento::text, '') = ''));

if (qt_registros_w > 0) then
	ie_vincular_w := 'S';
end if;

return	ie_vincular_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_vinc_contrato_oc ( nr_seq_contrato_p bigint) FROM PUBLIC;

