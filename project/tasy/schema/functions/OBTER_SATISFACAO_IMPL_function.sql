-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_satisfacao_impl ( dt_inicio_p timestamp, dt_fim_p timestamp) RETURNS bigint AS $body$
DECLARE

pr_retorno_w	bigint;

BEGIN

select	round((sum(qt_ponto/qt_reg))/count(*),1)
into STRICT	pr_retorno_w
from (SELECT	sum(a.qt_ponto) qt_ponto,
				sum(coalesce(qt_ponto_orig,a.qt_ponto)) qt_ponto_orig,
				count(*) qt_reg,
				a.nr_seq_quesito
		from	proj_consultor_aval_quesito a,
				proj_consultor_aval b
		where	a.nr_seq_avaliacao = b.nr_sequencia
		and		b.nr_seq_cliente = nr_seq_cliente
		and		b.dt_avaliacao between dt_inicio_p and dt_fim_p
		and		a.nr_seq_quesito in (208,209,210,212,213,214,215,216,217,218)
		group by a.nr_seq_quesito
		
union all

		SELECT	sum(a.qt_ponto),
				sum(coalesce(qt_ponto_orig,a.qt_ponto)) qt_ponto_orig,
				count(*),
				9999
		from	proj_consultor_aval_quesito a,
				proj_consultor_aval b
		where	a.nr_seq_avaliacao = b.nr_sequencia
		and		b.dt_avaliacao between dt_inicio_p and dt_fim_p
		and		a.nr_seq_quesito in (208,209,210,212,213,214,215,216,217,218)
		order by nr_seq_quesito) alias14;

return	pr_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_satisfacao_impl ( dt_inicio_p timestamp, dt_fim_p timestamp) FROM PUBLIC;

