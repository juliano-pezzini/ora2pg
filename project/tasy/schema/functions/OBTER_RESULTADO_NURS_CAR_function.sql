-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_resultado_nurs_car ( nr_sequencia_p bigint, cd_pessoa_fisica_p text, nr_atendimento_p bigint, ie_tipo_resultado_p text DEFAULT 'C', ret_seq_p text default 'N') RETURNS varchar AS $body$
DECLARE

    ds_sql_w         nursing_care_item.ds_sql%type;
    ds_retorno_w     nursing_care_result.qt_ponto%type;
    ds_resultado_w   nursing_care_result.ds_resultado%type;
    ds_retorno_act_w  varchar(255);
    ds_retorno_seq nursing_care_result.nr_sequencia%type;

BEGIN
    SELECT
        ds_sql
    INTO STRICT ds_sql_w
    FROM
        nursing_care_item
    WHERE
        nr_sequencia = nr_sequencia_p;

    IF (ds_sql_w IS NOT NULL AND ds_sql_w::text <> '') THEN
        ds_sql_w := replace(upper(ds_sql_w), ':NR_ATENDIMENTO', nr_atendimento_p);
        ds_sql_w := replace(upper(ds_sql_w), ':CD_PESSOA_FISICA', chr(39)
                                                                  || cd_pessoa_fisica_p
                                                                  || chr(39));
        EXECUTE ds_sql_w
        INTO STRICT ds_retorno_seq;
    END IF;

    if (ds_retorno_seq IS NOT NULL AND ds_retorno_seq::text <> '') then
		select qt_ponto
		into STRICT ds_retorno_w
		from nursing_care_result
		where nr_seq_item = nr_sequencia_p
			AND nr_sequencia = ds_retorno_seq;
    end if;

    IF ( ie_tipo_resultado_p = 'D' ) THEN
        SELECT
            ds_resultado
        INTO STRICT ds_resultado_w
        FROM
            nursing_care_result
        WHERE
            qt_ponto = ds_retorno_w
            AND nr_sequencia = ds_retorno_seq;
    END IF;

    if ( ie_tipo_resultado_p = 'C' and ret_seq_p = 'N') THEN
      ds_retorno_act_w:= ds_retorno_w;
    elsif ( ie_tipo_resultado_p = 'C' and ret_seq_p = 'S') then
      ds_retorno_act_w:= ds_retorno_seq;
    else
        ds_retorno_act_w := ds_resultado_w;
    end  if;

    return ds_retorno_act_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_resultado_nurs_car ( nr_sequencia_p bigint, cd_pessoa_fisica_p text, nr_atendimento_p bigint, ie_tipo_resultado_p text DEFAULT 'C', ret_seq_p text default 'N') FROM PUBLIC;

