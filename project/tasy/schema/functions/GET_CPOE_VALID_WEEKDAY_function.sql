-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_cpoe_valid_weekday (cd_cureent_date_p timestamp, nr_seq_cpoe_rp_p bigint) RETURNS varchar AS $body$
DECLARE

							
week_index_w	    bigint;
ds_matched_w	    varchar(30) := 'N';
ie_segunda_w		cpoe_rp.ie_segunda%type;
ie_terca_w			cpoe_rp.ie_terca%type;
ie_quarta_w			cpoe_rp.ie_quarta%type;
ie_quinta_w			cpoe_rp.ie_quinta%type;
ie_sexta_w			cpoe_rp.ie_sexta%type;
ie_sabado_w			cpoe_rp.ie_sabado%type;
ie_domingo_w		cpoe_rp.ie_domingo%type;



BEGIN
if (cd_cureent_date_p IS NOT NULL AND cd_cureent_date_p::text <> '' AND nr_seq_cpoe_rp_p IS NOT NULL AND nr_seq_cpoe_rp_p::text <> '') then
	select	max(ie_segunda),
		max(ie_terca),
		max(ie_quarta),
		max(ie_quinta),
		max(ie_sexta),
		max(ie_sabado),
		max(ie_domingo)
	into STRICT	ie_segunda_w,
		ie_terca_w,
		ie_quarta_w,
		ie_quinta_w,
		ie_sexta_w,
		ie_sabado_w,
		ie_domingo_w
	from	cpoe_rp
	where	nr_sequencia	= nr_seq_cpoe_rp_p;
	
	SELECT TO_CHAR(cd_cureent_date_p, 'D') into STRICT week_index_w;

	if (ie_domingo_w = 'S' and week_index_w = 1) then
		ds_matched_w := 'S';

	elsif (ie_segunda_w = 'S' and week_index_w = 2) then
		ds_matched_w := 'S';

	elsif (ie_terca_w = 'S' and week_index_w = 3) then
		ds_matched_w := 'S';

	elsif (ie_quarta_w = 'S' and week_index_w = 4) then
		ds_matched_w := 'S';

	elsif (ie_quinta_w = 'S' and week_index_w = 5) then
		ds_matched_w := 'S';

	elsif (ie_sexta_w = 'S' and week_index_w = 6) then
		ds_matched_w := 'S';

	elsif (ie_sabado_w = 'S' and week_index_w = 7) then
		ds_matched_w := 'S';
	else
	ds_matched_w := 'N';

    end if;

    if (coalesce(ie_domingo_w::text, '') = '' and coalesce(ie_segunda_w::text, '') = '' and coalesce(ie_terca_w::text, '') = '' and coalesce(ie_quarta_w::text, '') = '' and coalesce(ie_quinta_w::text, '') = '' and coalesce(ie_sexta_w::text, '') = '' and coalesce(ie_sabado_w::text, '') = '') then
    ds_matched_w := 'S';
    end if;

    if (ie_domingo_w = 'N' and ie_segunda_w = 'N' and ie_terca_w = 'N' and ie_quarta_w = 'N' and ie_quinta_w = 'N' and ie_sexta_w = 'N' and ie_sabado_w = 'N') then
    ds_matched_w := 'S';
    end if;

end if;
return trim(both ds_matched_w);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_cpoe_valid_weekday (cd_cureent_date_p timestamp, nr_seq_cpoe_rp_p bigint) FROM PUBLIC;

