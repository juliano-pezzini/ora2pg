-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_endereco_cobr_pf_pj ( cd_pessoa_fisica_p text, cd_cgc_p text, ie_opcao_p text ) RETURNS varchar AS $body$
DECLARE

 
cd_cep_w	varchar(255);
ds_endereco_w	varchar(255);
ds_bairro_w	varchar(255);
ds_municipio_w	varchar(255);
sg_estado_w	varchar(255);

IE_ENDERECO_CORRESPONDENCIA_W	bigint;
IE_TIPO_COMPL_CORRESP_W		bigint;
ds_complemento_w	varchar(100);

/* 
C	Cep 
M	Município 
ES	Estado 
EN	Endereço 
B	Bairro 
COMPL 	complemento 
END	endereco completo 
*/
 
 

BEGIN 
 
if (cd_cgc_p IS NOT NULL AND cd_cgc_p::text <> '') then 
 
	select	max(a.IE_ENDERECO_CORRESPONDENCIA) 
	into STRICT	IE_ENDERECO_CORRESPONDENCIA_W 
	from	PESSOA_JURIDICA_ESTAB a 
	where	a.cd_cgc	= cd_cgc_p;
 
	select	max(a.cd_cep), 
		max(a.ds_endereco) || ', ' || max(a.nr_endereco), 
		max(a.ds_bairro), 
		max(a.ds_municipio), 
		max(a.sg_estado), 
		max(a.ds_complemento) 
	into STRICT	cd_cep_w, 
		ds_endereco_w, 
		ds_bairro_w, 
		ds_municipio_w, 
		sg_estado_w, 
		ds_complemento_w 
	from	PESSOA_JURIDICA_COMPL a 
	where	a.cd_cgc			= cd_cgc_p 
	and	a.ie_tipo_complemento	= coalesce(ie_endereco_correspondencia_w, a.ie_tipo_complemento);
 
elsif (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') then 
 
	select	max(a.IE_TIPO_COMPL_CORRESP) 
	into STRICT	IE_TIPO_COMPL_CORRESP_W 
	from	pessoa_fisica_estab a 
	where	a.cd_pessoa_fisica		= cd_pessoa_fisica_p;
 
	select	max(a.cd_cep), 
		max(a.ds_endereco) || ', ' || max(a.nr_endereco), 
		max(a.ds_bairro), 
		max(a.ds_municipio), 
		max(a.sg_estado), 
		max(a.ds_complemento) 
	into STRICT	cd_cep_w, 
		ds_endereco_w, 
		ds_bairro_w, 
		ds_municipio_w, 
		sg_estado_w, 
		ds_complemento_w 
	from	compl_pessoa_fisica a 
	where	a.cd_pessoa_fisica		= cd_pessoa_fisica_p 
	and	a.IE_TIPO_COMPLEMENTO	= coalesce(IE_TIPO_COMPL_CORRESP_W, a.IE_TIPO_COMPLEMENTO);
	 
end if;
 
if (ie_opcao_p = 'C') then 
	return	cd_cep_w;
elsif (ie_opcao_p = 'M') then 
	return	ds_municipio_w;
elsif (ie_opcao_p = 'ES') then 
	return	sg_estado_w;
elsif (ie_opcao_p = 'EN') then 
	return	ds_endereco_w;
elsif (ie_opcao_p = 'B') then 
	return	ds_bairro_w;
elsif (ie_opcao_p = 'COMPL') then 
	return ds_complemento_w;
elsif (ie_opcao_p = 'END') then 
	begin 
		if (coalesce(ds_complemento_w::text, '') = '') then 
			return ds_endereco_w|| ' - ' || cd_cep_w || ' - ' ||ds_municipio_w|| ' - '||sg_estado_w;
		else 
			return ds_endereco_w|| ' - ' || cd_cep_w || ' - '||ds_complemento_w || ' - '||ds_municipio_w|| ' - '||sg_estado_w;
		end if;
	end;
end if;
 
end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_endereco_cobr_pf_pj ( cd_pessoa_fisica_p text, cd_cgc_p text, ie_opcao_p text ) FROM PUBLIC;

