-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_susp_transfer (cd_setor_atendimento_p bigint, ie_tipo_item_p text) RETURNS varchar AS $body$
DECLARE

								
nr_seq_regra_w CPOE_RULE_SUSP_TRANSFER.NR_SEQUENCIA%TYPE;
ds_retorno_w varchar(1) := 'N';
								

BEGIN

/** ie_tipo_item_p
AP              Anatomia patologica
N               Nutricao
M               Solucoes e Medicamentos
P               Exames e Procedimentos
G               Gasoterapia
R               Recomendacoes
H               Hemoterapia
D               Dialise
I               Intervencoes de enfermagem
MA              Materiais
**/
-- anotacoes: somente apresentar regra de medic e proc quando o grupo selecionar for este
-- obrigar campo grupo na tabela CPOE_RULE_SUSP_ITEMS
select	max(a.nr_sequencia)
into STRICT	nr_seq_regra_w
from	CPOE_RULE_SUSP_TRANSFER a
where	a.CD_SETOR_ATENDIMENTO = cd_setor_atendimento_p
and		a.IE_SITUACAO = 'S';

if (nr_seq_regra_w > 0) then -- if there is rule for the department
	
	select	coalesce(max('S'), 'N') -- if there is rule, return S, Else, N.
	into STRICT	ds_retorno_w
	from	CPOE_RULE_SUSP_ITEMS b
	where	b.NR_SEQ_RULE_SUSP = nr_seq_regra_w
	and		b.IE_GRUPO = ie_tipo_item_p
	and		b.IE_SITUACAO = 'S';
	
end if;

return ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_susp_transfer (cd_setor_atendimento_p bigint, ie_tipo_item_p text) FROM PUBLIC;

