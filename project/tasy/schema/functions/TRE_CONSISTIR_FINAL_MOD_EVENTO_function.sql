-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION tre_consistir_final_mod_evento (nr_seq_evento_p bigint, nr_seq_mod_evento_p bigint) RETURNS varchar AS $body$
DECLARE


ie_consiste_w		boolean		:= FALSE;
ds_retorno_w		varchar(4000)	:= 'N';
ds_msg_w			varchar(4000)	:= '';
nr_seq_curso_w		bigint;
ds_modulo_w			varchar(255);
nr_consistencia_w	smallint := 0;

-- não tem anexo
c01 CURSOR FOR
SELECT	b.nr_sequencia,
	b.ds_modulo
FROM	tre_evento_modulo a,
	tre_curso_modulo b
WHERE	a.nr_seq_evento 	= nr_seq_evento_p
AND	a.nr_sequencia		= nr_seq_mod_evento_p
AND	b.nr_sequencia 	= a.nr_seq_modulo
AND	NOT EXISTS (SELECT 1
		FROM tre_modulo_anexo b
		WHERE a.nr_sequencia = b.nr_seq_modulo);


BEGIN
OPEN C01;
LOOP
FETCH C01 INTO
	nr_seq_curso_w,
	ds_modulo_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	BEGIN
	nr_consistencia_w 	:= nr_consistencia_w + 1;
	ie_consiste_w 	:= TRUE;
	ds_msg_w	:= ds_msg_w||TO_CHAR(nr_consistencia_w)||' - O módulo ' || TO_CHAR(nr_seq_curso_w) || ' - ' || ds_modulo_w || ' não possui anexo.' || CHR(13);
	END;
END LOOP;
CLOSE C01;

IF (ie_consiste_w) THEN
	ds_retorno_w := obter_desc_expressao(511643)/*' Consistência(s): '*/
 ||': '|| CHR(13)||CHR(13) || ds_msg_w;
END IF;

RETURN	ds_retorno_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION tre_consistir_final_mod_evento (nr_seq_evento_p bigint, nr_seq_mod_evento_p bigint) FROM PUBLIC;

