-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pfcs_get_location ( nr_encounter_p bigint, ds_filter_type_p text default 'Bed') RETURNS varchar AS $body$
DECLARE


	ds_active_status 			varchar(10) := 'ACTIVE';
	ds_bed						varchar(10) := 'Bed';
	ds_room_bed					varchar(10) := 'Room-Bed';
	ds_department				varchar(20) := 'Department';
	ds_filtered_loc 			varchar(255) := null;
	
	
BEGIN

	if (ds_filter_type_p = ds_bed ) then
		select loc.ds_bed into STRICT ds_filtered_loc
		from 	pfcs_encounter_location el,
				pfcs_location loc
		where 	el.nr_seq_encounter = nr_encounter_p
				and el.nr_seq_location = loc.nr_sequencia
				and loc.si_status = ds_active_status;
	elsif (ds_filter_type_p = ds_room_bed ) then
		select	loc.ds_room || '-' || loc.ds_bed
          into STRICT	ds_filtered_loc
		  from 	pfcs_encounter_location el,
				pfcs_location loc
		 where 	el.nr_seq_encounter = nr_encounter_p
		   and	el.nr_seq_location = loc.nr_sequencia
		   and	loc.si_status = ds_active_status;
	elsif (ds_filter_type_p = ds_department ) then
		select 	loc.ds_department into STRICT ds_filtered_loc
		from 	pfcs_encounter_location el,
				pfcs_location loc
		where 	el.nr_seq_encounter = nr_encounter_p
				and el.nr_seq_location = loc.nr_sequencia
				and loc.si_status = ds_active_status;
	end if;

return ds_filtered_loc;

exception
-- If there will be no record
when no_data_found then
  return ds_filtered_loc;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pfcs_get_location ( nr_encounter_p bigint, ds_filter_type_p text default 'Bed') FROM PUBLIC;

