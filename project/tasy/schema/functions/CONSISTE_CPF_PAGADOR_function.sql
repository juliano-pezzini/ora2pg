-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION consiste_cpf_pagador ( nr_atendimento_p bigint) RETURNS varchar AS $body$
DECLARE

 
 
cd_pessoa_fisica_w	varchar(10);
nr_cpf_w		varchar(11);
ie_brasileiro_w		varchar(1);
ds_retorno_w		varchar(1)	:= 'N';
cd_cgc_w		varchar(14);
qt_idade_w		bigint;

 

BEGIN 
 
select	coalesce(max(cd_pessoa_fisica),'') 
into STRICT	cd_pessoa_fisica_w 
from	atendimento_paciente 
where	nr_atendimento	= nr_atendimento_p;
 
select	coalesce(max(cd_pessoa_fisica),cd_pessoa_fisica_w), 
	coalesce(max(cd_cgc),'0') 
into STRICT	cd_pessoa_fisica_w, 
	cd_cgc_w 
from	atendimento_pagador 
where	nr_atendimento	= nr_atendimento_p;
 
select	obter_cpf_pessoa_fisica(cd_pessoa_fisica_w), 
	obter_se_brasileiro(cd_pessoa_fisica_w), 
	obter_idade_pf(cd_pessoa_fisica_w, clock_timestamp(), 'A') 
into STRICT	nr_cpf_w, 
	ie_brasileiro_w, 
	qt_idade_w
;
 
if (coalesce(nr_cpf_w::text, '') = '') and (ie_brasileiro_w	= 'S') then 
	ds_retorno_w		:= 'S';
end if;
 
if (qt_idade_w < 18) and (coalesce(nr_cpf_w::text, '') = '') and (ie_brasileiro_w = 'S') and (coalesce(cd_cgc_w,'0') <> '0') then 
	ds_retorno_w := 'N';
end if;
 
return	ds_retorno_w;
 
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION consiste_cpf_pagador ( nr_atendimento_p bigint) FROM PUBLIC;

