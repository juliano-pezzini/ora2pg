-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_pseudo_internal_procedures ( nr_seq_proc_interno_p bigint ) RETURNS varchar AS $body$
DECLARE


ds_exame_w proc_interno.ds_proc_exame%type;
ds_retorno_w varchar(4000) := '';

c01 CURSOR FOR
  SELECT  trim(both ds_pseudo) ds_pseudo
  FROM    proc_interno_pseudo
  WHERE   nr_seq_proc_interno = nr_seq_proc_interno_p
  ORDER BY 1;

BEGIN
  FOR x IN c01 LOOP
    IF (length(ds_retorno_w) < 250 OR coalesce(ds_retorno_w::text, '') = '') THEN
      ds_retorno_w := ds_retorno_w || x.ds_pseudo || ', ';
    END IF;
  END LOOP;

  ds_retorno_w := substr(ds_retorno_w, 1, length(ds_retorno_w) - 2);
  
  IF (length(ds_retorno_w) > 250) THEN
    ds_retorno_w := substr(ds_retorno_w, 1 , 250) || '...';
  END IF;

  IF (ds_retorno_w IS NOT NULL AND ds_retorno_w::text <> '') THEN
    ds_retorno_w := ' (' || ds_retorno_w || ')';
  END IF;

  SELECT  ds_proc_exame
  INTO STRICT    ds_exame_w
  FROM    proc_interno
  WHERE   nr_sequencia = nr_seq_proc_interno_p;

  RETURN ds_exame_w || ds_retorno_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_pseudo_internal_procedures ( nr_seq_proc_interno_p bigint ) FROM PUBLIC;

