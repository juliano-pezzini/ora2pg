-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_desc_horario_etapa ( Campo_p text, nr_etapa_p bigint, nr_prescricao_p bigint, nr_seq_solucao_p bigint) RETURNS varchar AS $body$
DECLARE


ds_horario_w	varchar(100);
qt_dosagem_w	double precision;
Controle_w	bigint := 0;
ds_retorno_w	varchar(100);
qt_volume_w	double precision;

C01 CURSOR FOR
	SELECT	ds_horario,
		qt_dosagem,
		qt_volume
	from	prescr_solucao_esquema
	where	nr_prescricao = nr_prescricao_p
	and	nr_seq_solucao = nr_seq_solucao_p
	order	by
		nr_sequencia;


BEGIN

OPEN C01;
LOOP
FETCH C01 into	ds_horario_w,
		qt_dosagem_w,
		qt_volume_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	Controle_w := Controle_w + 1;

	if (Campo_p = 'H') then
		ds_retorno_w := ds_horario_w;
	elsif (Campo_p = 'D') then
		ds_retorno_w := to_char(qt_dosagem_w);
	elsif (Campo_p = 'Q') then
		ds_retorno_w := to_char(qt_volume_w);
	end if;

	if (Controle_w = nr_etapa_p) then
		Exit;
	end if;

END LOOP;
CLOSE C01;

if (Controle_w < nr_etapa_p) then
	ds_retorno_w := '';
end if;

return ds_retorno_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_desc_horario_etapa ( Campo_p text, nr_etapa_p bigint, nr_prescricao_p bigint, nr_seq_solucao_p bigint) FROM PUBLIC;

