-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_finalidade_procedimento ( nr_cirurgia_p CIRURGIA.nr_cirurgia%type, nr_seq_proc_interno PROC_INTERNO.nr_sequencia%type ) RETURNS varchar AS $body$
DECLARE

    finalidade_procedimento_w   finalidade_cirurgia.cd_finalidade%type;

BEGIN

    IF (nr_cirurgia_p IS NOT NULL AND nr_cirurgia_p::text <> '') THEN
        SELECT  MAX(a.cd_finalidade)
        INTO STRICT    finalidade_procedimento_w
        FROM    FINALIDADE_CIRURGIA a,
                CIRURGIA b
        WHERE   b.nr_seq_fin_cirurgia = a.nr_sequencia
        AND     b.nr_cirurgia = nr_cirurgia_p;
    ELSE
        SELECT  MAX(a.cd_finalidade)
        INTO STRICT    finalidade_procedimento_w
        FROM    FINALIDADE_CIRURGIA a,
                PROC_INTERNO b
        WHERE   b.nr_seq_fin_cirurgia = a.nr_sequencia
        AND     b.nr_sequencia = nr_seq_proc_interno;
    END IF;

    RETURN finalidade_procedimento_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_finalidade_procedimento ( nr_cirurgia_p CIRURGIA.nr_cirurgia%type, nr_seq_proc_interno PROC_INTERNO.nr_sequencia%type ) FROM PUBLIC;

