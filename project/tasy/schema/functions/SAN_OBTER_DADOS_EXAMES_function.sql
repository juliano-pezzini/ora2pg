-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION san_obter_dados_exames ( nr_seq_lote_p bigint, nr_seq_exame_p bigint, ie_tipo_dado_p text) RETURNS varchar AS $body$
DECLARE

/* 
NRD	-	sequencia doação 
NDO	-	doador 
TDO	-	tipo doacao 
DDO	-	data doacao 
NRS	-	numero do sangue 
TIP	-	tipagem 
RES	-	Resultado 
VAL	-	Valor 
*/
 
 
vl_retorno_w		varchar(255);

BEGIN
 
if (ie_tipo_dado_p	= 'NDO') then 
	begin 
	select	substr(obter_iniciais_nome(max(a.cd_pessoa_fisica),null),1,50) 
	into STRICT	vl_retorno_w 
	from	san_doacao a, 
		san_exame_lote b 
	where	a.nr_sequencia = b.nr_seq_doacao 
	and	b.nr_sequencia = nr_seq_lote_p;
	end;
elsif (ie_tipo_dado_p	= 'TDO') then 
	begin 
	select	c.ds_tipo_doacao 
	into STRICT	vl_retorno_w 
	from	san_doacao a, 
		san_tipo_doacao c, 
		san_exame_lote b 
	where	a.nr_sequencia = b.nr_seq_doacao 
	and	a.nr_seq_tipo = c.nr_sequencia 
	and	b.nr_sequencia = nr_seq_lote_p;
	end;
elsif (ie_tipo_dado_p	= 'DDO') then 
	begin 
	select	to_char(a.dt_doacao,'dd/mm/yyyy') 
	into STRICT	vl_retorno_w 
	from	san_doacao a, 
		san_exame_lote b 
	where	a.nr_sequencia = b.nr_seq_doacao 
	and	b.nr_sequencia = nr_seq_lote_p;
	end;
elsif (ie_tipo_dado_p	= 'NRS') then 
	begin 
	select	nr_sangue 
	into STRICT	vl_retorno_w 
	from	san_doacao a, 
		san_exame_lote b 
	where	a.nr_sequencia = b.nr_seq_doacao 
	and	b.nr_sequencia = nr_seq_lote_p;
	end;
elsif (ie_tipo_dado_p	= 'TIP') then 
	begin 
	select (c.ie_tipo_sangue || c.ie_fator_rh) 
	into STRICT	vl_retorno_w 
	from	san_doacao a, 
		pessoa_fisica c, 
		san_exame_lote b 
	where	a.nr_sequencia		= b.nr_seq_doacao 
	and	c.cd_pessoa_fisica 	= a.cd_pessoa_fisica 
	and	b.nr_sequencia 		= nr_seq_lote_p;
	end;
elsif (ie_tipo_dado_p	= 'RES') then 
	begin 
	select	ds_resultado 
	into STRICT	vl_retorno_w 
	from	san_exame_lote b, 
		san_exame_realizado a 
	where	b.nr_sequencia = a.nr_seq_exame_lote 
	and	b.nr_sequencia = nr_seq_lote_p 
	and	a.nr_seq_exame = nr_seq_exame_p;
	end;
elsif (ie_tipo_dado_p	= 'VAL') then 
	begin 
	select	to_char(vl_resultado) 
	into STRICT	vl_retorno_w 
	from	san_exame_lote b, 
		san_exame_realizado a 
	where	b.nr_sequencia = a.nr_seq_exame_lote 
	and	b.nr_sequencia = nr_seq_lote_p 
	and	a.nr_seq_exame = nr_seq_exame_p;
	end;
elsif (ie_tipo_dado_p	= 'NRD') then 
	begin 
	select	to_char(b.nr_seq_doacao) 
	into STRICT	vl_retorno_w 
	from	san_exame_lote b 
	where	b.nr_sequencia = nr_seq_lote_p;
	end;
end if;
 
return	vl_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION san_obter_dados_exames ( nr_seq_lote_p bigint, nr_seq_exame_p bigint, ie_tipo_dado_p text) FROM PUBLIC;

