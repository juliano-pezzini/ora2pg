-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_status_solic_compra (nr_solic_compra_p bigint) RETURNS varchar AS $body$
DECLARE

 
dt_liberacao_w		timestamp;
dt_autorizacao_w		timestamp;
dt_baixa_w			timestamp;
nr_seq_motivo_cancel_w	bigint;
ds_retorno_w			varchar(20);


BEGIN 
 
select	coalesce(dt_liberacao,null), 
	coalesce(dt_autorizacao,null), 
	coalesce(dt_baixa,null), 
	coalesce(nr_seq_motivo_cancel,null) 
into STRICT	dt_liberacao_w, 
	dt_autorizacao_w, 
	dt_baixa_w, 
	nr_seq_motivo_cancel_w 
from	solic_compra 
where	nr_solic_compra = nr_solic_compra_p;
 
if (dt_baixa_w IS NOT NULL AND dt_baixa_w::text <> '') and (coalesce(nr_seq_motivo_cancel_w::text, '') = '') then 
	ds_retorno_w := wheb_mensagem_pck.get_texto(306109) /*'Baixada'*/
;
elsif (dt_baixa_w IS NOT NULL AND dt_baixa_w::text <> '') and (nr_seq_motivo_cancel_w IS NOT NULL AND nr_seq_motivo_cancel_w::text <> '') then 
	ds_retorno_w := wheb_mensagem_pck.get_texto(306110) /*'Cancelada'*/
;
elsif (dt_autorizacao_w IS NOT NULL AND dt_autorizacao_w::text <> '') then 
	ds_retorno_w := wheb_mensagem_pck.get_texto(306111) /*'Aprovada'*/
;
elsif (dt_liberacao_w IS NOT NULL AND dt_liberacao_w::text <> '') then 
	ds_retorno_w := wheb_mensagem_pck.get_texto(306112) /*'Liberada'*/
;
elsif (coalesce(dt_liberacao_w::text, '') = '') then 
	ds_retorno_w := wheb_mensagem_pck.get_texto(306113) /*'NÃ£o Liberada'*/
;
end if;
 
return ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_status_solic_compra (nr_solic_compra_p bigint) FROM PUBLIC;

