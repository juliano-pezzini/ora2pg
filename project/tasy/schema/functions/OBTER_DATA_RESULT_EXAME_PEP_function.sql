-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_data_result_exame_pep ( dt_resultado_p timestamp, dt_result_item_p timestamp DEFAULT NULL, dt_digitacao_p timestamp DEFAULT NULL, dt_coleta_p timestamp DEFAULT NULL, dt_prev_execucao_p timestamp DEFAULT NULL, ie_data_p text DEFAULT NULL, dt_aprovacao_p timestamp DEFAULT NULL, dt_exame_ext_p timestamp DEFAULT NULL, ie_truncamento_p text DEFAULT 'S') RETURNS timestamp AS $body$
DECLARE

    dt_pep_w timestamp;

BEGIN
    IF (dt_digitacao_p IS NOT NULL AND dt_digitacao_p::text <> '') AND ( ie_data_p = 'D' ) THEN
        dt_pep_w := trunc(dt_digitacao_p, 'dd');
    ELSIF (dt_coleta_p IS NOT NULL AND dt_coleta_p::text <> '') AND ( ie_data_p = 'C' ) THEN
        dt_pep_w := dt_coleta_p;
    ELSIF ( ie_data_p = 'P' ) AND (dt_prev_execucao_p IS NOT NULL AND dt_prev_execucao_p::text <> '') THEN
        dt_pep_w := dt_prev_execucao_p;
    ELSIF ( ie_data_p = 'A' ) AND (dt_aprovacao_p IS NOT NULL AND dt_aprovacao_p::text <> '') THEN
        dt_pep_w := dt_aprovacao_p;
    ELSIF ( ie_data_p = 'E' ) AND (dt_exame_ext_p IS NOT NULL AND dt_exame_ext_p::text <> '') THEN
        dt_pep_w := dt_exame_ext_p;
    ELSE
        dt_pep_w := coalesce(dt_result_item_p, dt_resultado_p);
    END IF;

    IF ie_truncamento_p = 'S' THEN
        dt_pep_w := trunc(dt_pep_w, 'mi');
    END IF;
    RETURN dt_pep_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_data_result_exame_pep ( dt_resultado_p timestamp, dt_result_item_p timestamp DEFAULT NULL, dt_digitacao_p timestamp DEFAULT NULL, dt_coleta_p timestamp DEFAULT NULL, dt_prev_execucao_p timestamp DEFAULT NULL, ie_data_p text DEFAULT NULL, dt_aprovacao_p timestamp DEFAULT NULL, dt_exame_ext_p timestamp DEFAULT NULL, ie_truncamento_p text DEFAULT 'S') FROM PUBLIC;

