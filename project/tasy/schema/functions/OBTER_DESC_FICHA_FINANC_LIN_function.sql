-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_desc_ficha_financ_lin (nr_sequencia_p bigint) RETURNS varchar AS $body$
DECLARE


nr_seq_superior_w		capa_ficha_financ_lin.nr_seq_superior%type;
ds_linha_ww				capa_ficha_financ_lin.ds_linha%type;
ds_linha_w				capa_ficha_financ_lin.ds_linha%type;

type array_t is table of bigint;
array_sequences array_t := array_t();
i integer := 1;


BEGIN

	begin

		select	ds_linha,
			nr_seq_superior
		into STRICT	ds_linha_w,
			nr_seq_superior_w
		from	capa_ficha_financ_lin
		where	nr_sequencia = nr_sequencia_p;
	exception
		when no_data_found then 
			ds_linha_w := null;
			nr_seq_superior_w := null;
		when too_many_rows then
			ds_linha_w := null;
			nr_seq_superior_w := null;
		end;

	<<while_loop>>
	while((nr_seq_superior_w IS NOT NULL AND nr_seq_superior_w::text <> '') and nr_seq_superior_w not member of array_sequences) loop
		begin

			array_sequences.extend();
			array_sequences(i) := nr_seq_superior_w;
			i := i + 1;

			select	ds_linha,
				nr_seq_superior
			into STRICT	ds_linha_ww,
				nr_seq_superior_w
			from	capa_ficha_financ_lin
			where	nr_sequencia = nr_seq_superior_w;

			ds_linha_w := substr(ds_linha_ww || ' > ' || ds_linha_w,1,255);
		exception
			when no_data_found then raise;
			when too_many_rows then raise;
		end;
	end loop while_loop;

	return	ds_linha_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 IMMUTABLE;
-- REVOKE ALL ON FUNCTION obter_desc_ficha_financ_lin (nr_sequencia_p bigint) FROM PUBLIC;

