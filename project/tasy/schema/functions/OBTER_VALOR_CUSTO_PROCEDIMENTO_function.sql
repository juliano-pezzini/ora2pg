-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_valor_custo_procedimento (cd_estabelecimento_p bigint, cd_procedimento_p bigint, ie_origem_proced_p bigint, nr_seq_proc_interno_p bigint, nr_seq_exame_p bigint, cd_tabela_custo_p bigint, cd_convenio_p bigint, cd_setor_Atendimento_p bigint, vl_procedimento_p bigint, vl_Custo_Oper_p bigint, vl_Medico_p bigint, vl_Material_p bigint, ie_apuracao_custo_p text, ie_opcao_p text) RETURNS bigint AS $body$
DECLARE

/*
 ie_opcao = 'C'; Custo procedimento
*/
vl_retorno_w				double precision;
ie_apuracao_custo_w 			varchar(10);
vl_custo_w		  	  	double precision := 0;
vl_custo_variavel_w	  	 	double precision := 0;
vl_custo_sadt_w	  	  		double precision := 0;
vl_custo_dir_apoio_w	  	 	double precision := 0;
vl_custo_mao_obra_w	  	  	double precision := 0;
vl_custo_direto_w	  	  		double precision := 0;
vl_custo_indireto_w	  	 		double precision := 0;
vl_Despesa_w		  	  	double precision := 0;
vl_custo_hm_w		  	  	double precision := 0;
pr_imposto_w				double precision;
vl_preco_calculado_w		double precision;




BEGIN

ie_apuracao_custo_w	:= ie_apuracao_custo_p;

SELECT * FROM Obter_Custo_Procedimento(	cd_estabelecimento_p, cd_procedimento_p, ie_origem_proced_p, nr_seq_proc_interno_p, nr_seq_exame_p, cd_tabela_custo_p, cd_convenio_p, cd_setor_Atendimento_p, vl_procedimento_p, vl_Custo_Oper_p, vl_Medico_p, vl_Material_p, ie_apuracao_custo_w, vl_custo_w, vl_custo_variavel_w, vl_custo_sadt_w, vl_custo_dir_apoio_w, vl_custo_mao_obra_w, vl_custo_direto_w, vl_custo_indireto_w, vl_despesa_w, vl_custo_hm_w, pr_imposto_w, null, null, null, null, null, vl_preco_calculado_w, null, 'N', null, null, null) INTO STRICT ie_apuracao_custo_w, vl_custo_w, vl_custo_variavel_w, vl_custo_sadt_w, vl_custo_dir_apoio_w, vl_custo_mao_obra_w, vl_custo_direto_w, vl_custo_indireto_w, vl_despesa_w, vl_custo_hm_w, pr_imposto_w, vl_preco_calculado_w;

if (ie_opcao_p	= 'C') then
	vl_custo_w	:=	vl_custo_variavel_w + vl_custo_sadt_w + vl_custo_dir_apoio_w +
				vl_custo_mao_obra_w + vl_custo_direto_w +
				vl_custo_indireto_w + vl_despesa_w + vl_custo_hm_w;
	vl_retorno_w	:= vl_custo_w;
end if;

return	vl_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_valor_custo_procedimento (cd_estabelecimento_p bigint, cd_procedimento_p bigint, ie_origem_proced_p bigint, nr_seq_proc_interno_p bigint, nr_seq_exame_p bigint, cd_tabela_custo_p bigint, cd_convenio_p bigint, cd_setor_Atendimento_p bigint, vl_procedimento_p bigint, vl_Custo_Oper_p bigint, vl_Medico_p bigint, vl_Material_p bigint, ie_apuracao_custo_p text, ie_opcao_p text) FROM PUBLIC;

