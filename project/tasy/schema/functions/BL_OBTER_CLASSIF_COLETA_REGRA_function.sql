-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION bl_obter_classif_coleta_regra (nr_seq_doacao_p bigint, dt_coleta_p timestamp) RETURNS varchar AS $body$
DECLARE


dt_parto_w		timestamp;
ie_classificacao_w	varchar(1);


BEGIN
if (coalesce(nr_seq_doacao_p,0) > 0) then
	select	max(dt_parto)
	into STRICT	dt_parto_w
	from	bl_parto
	where	nr_seq_banco_leite = nr_seq_doacao_p;

	if (dt_parto_w IS NOT NULL AND dt_parto_w::text <> '') and (dt_coleta_p IS NOT NULL AND dt_coleta_p::text <> '') then
		select	max(ie_classificacao)
		into STRICT	ie_classificacao_w
		from	bl_regra_classif_leite
		where	ceil(dt_coleta_p - dt_parto_w) between qt_dias_min and qt_dias_max;
	end if;
end if;

return	ie_classificacao_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION bl_obter_classif_coleta_regra (nr_seq_doacao_p bigint, dt_coleta_p timestamp) FROM PUBLIC;

