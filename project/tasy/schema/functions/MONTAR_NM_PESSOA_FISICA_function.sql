-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION montar_nm_pessoa_fisica ( cd_pessoa_fisica_p text, nm_primeiro_nome_p text, nm_sobrenome_pai_p text, nm_sobrenome_mae_p text, nm_usuario_p text, nr_seq_person_name_p bigint default null) RETURNS varchar AS $body$
DECLARE


nm_retorno_w		varchar(60);
country_code_w		varchar(2);


BEGIN
if (nm_primeiro_nome_p IS NOT NULL AND nm_primeiro_nome_p::text <> '') then
	country_code_w := philips_param_pck.get_cd_pais();
	if (country_code_w = 2) then
		nm_retorno_w	:= substr(nm_primeiro_nome_p || ' ' ||
				nm_sobrenome_pai_p || ' ' ||
				nm_sobrenome_mae_p,1,60);
	else
		nm_retorno_w	:= substr(nm_primeiro_nome_p || ' ' ||
				nm_sobrenome_mae_p || ' ' ||
				nm_sobrenome_pai_p,1,60);		
	end if;
	nm_retorno_w	:= substr(replace(nm_retorno_w,'  ',' '),1,60);
elsif (coalesce(nr_seq_person_name_p, 0) > 0) then
	country_code_w := philips_param_pck.get_cd_pais();
	if (country_code_w = 2) then
		select 	max(substr(ds_given_name || ' ' || ds_family_name || ' ' || ds_component_name_1,1,60))
		into STRICT	nm_retorno_w
		from	person_name
		where 	nr_sequencia = nr_seq_person_name_p
		  and	ds_type = 'main';
	elsif (country_code_w = 3) then
		select 	max(substr(ds_given_name || ' ' || ds_component_name_1 || ' ' || ds_family_name || ' ' || ds_component_name_2 || ' ' || ds_component_name_3,1,60))
		into STRICT	nm_retorno_w
		from	person_name
		where 	nr_sequencia = nr_seq_person_name_p
		and		ds_type = 'main';
	else
		select 	max(substr(ds_given_name || ' ' || ds_component_name_1 || ' ' || ds_family_name,1,60))
		into STRICT	nm_retorno_w
		from	person_name
		where 	nr_sequencia = nr_seq_person_name_p
		and		ds_type = 'main';
	end if;
	nm_retorno_w	:= substr(replace(nm_retorno_w,'  ',' '),1,60);
end if;

return nm_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION montar_nm_pessoa_fisica ( cd_pessoa_fisica_p text, nm_primeiro_nome_p text, nm_sobrenome_pai_p text, nm_sobrenome_mae_p text, nm_usuario_p text, nr_seq_person_name_p bigint default null) FROM PUBLIC;

