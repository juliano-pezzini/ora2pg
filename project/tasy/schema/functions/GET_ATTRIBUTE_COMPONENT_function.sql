-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_attribute_component ( nm_table_p text, nm_attribute_p text) RETURNS varchar AS $body$
DECLARE


ds_result_w 	varchar(255);
ds_component_w	varchar(60);
nr_position_w	bigint;

c01 CURSOR FOR
	SELECT	distinct(substr(trim(both obter_valor_dominio_idioma(1043, a.ie_componente, 5)), 1, 60))
	from	tabela_visao_atributo a,
		tabela_visao b,
		objeto_schematic c,
		funcao_schematic d,
		funcao e
	where	a.nr_sequencia = b.nr_sequencia
	and	a.nr_sequencia = c.nr_seq_visao
	and	b.nm_tabela = c.nm_tabela
	and	d.nr_sequencia = c.nr_seq_funcao_schematic
	and	c.cd_funcao = e.cd_funcao
	and	b.ie_utilizacao = 'H' --HTML5
	and	(a.nr_seq_apresent IS NOT NULL AND a.nr_seq_apresent::text <> '')
	and	(a.cd_exp_label IS NOT NULL AND a.cd_exp_label::text <> '')
	and	d.ie_situacao_funcao = 'A' --Active Schematic Function
	and	e.ie_situacao in ('A', 'C') --Active Function
	and	e.ie_status_html = '
A' --HTML5 Active Function
	and	(a.ie_componente IS NOT NULL AND a.ie_componente::text <> '')
	and	b.nm_tabela = nm_table_p
	and	a.nm_atributo = nm_attribute_p;


BEGIN

open c01;
loop
fetch c01 into
	ds_component_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	ds_result_w := substr(ds_result_w || ds_component_w || ', ', 1, 255);
end loop;

if (ds_result_w IS NOT NULL AND ds_result_w::text <> '') then
	ds_result_w := substr(ds_result_w, 1, length(ds_result_w) -2);
	nr_position_w := instr(ds_result_w, ',', -1);
	if (nr_position_w > 0) then
		ds_result_w := substr(ds_result_w, 1, (nr_position_w-1)) || obter_desc_expressao_idioma(716239, null, 5) || substr(ds_result_w, (nr_position_w+2), length(ds_result_w));
	end if;
end if;

return ds_result_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_attribute_component ( nm_table_p text, nm_attribute_p text) FROM PUBLIC;

