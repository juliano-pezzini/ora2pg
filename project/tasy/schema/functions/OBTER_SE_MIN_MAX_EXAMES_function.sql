-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_min_max_exames ( nr_sequencia_p bigint ) RETURNS bigint AS $body$
DECLARE



nr_seq_tipo_dado_w	bigint;
qt_dado_w		varchar(160);
qt_retorno_w		smallint := -1;
vl_maximo_w		double precision;
vl_minimo_w		double precision;

/*
RETORNO

0 - N√ÉO ALTERA
1 - ABAIXO
2 - ACIMA
*/
BEGIN

begin
select	nr_seq_tipo_dado,
	(qt_dado)::numeric
into STRICT	nr_seq_tipo_dado_w,
	qt_dado_w
from	aval_pre_anest_dado_estat
where	nr_sequencia	=	nr_sequencia_p;
exception
when others then
	qt_retorno_w	:= 0;
end;

if (qt_retorno_w <> 0) then
	select	vl_ref_inicial,
		vl_ref_final
	into STRICT	vl_minimo_w,
		vl_maximo_w
	from	apa_dado_estat
	where	nr_sequencia	=	nr_seq_tipo_dado_w;

	if (qt_dado_w < vl_minimo_w) then
		qt_retorno_w	:= 1;
	elsif (qt_dado_w > vl_maximo_w) then
		qt_retorno_w	:= 2;
	else
		qt_retorno_w	:= 0;
	end if;
end if;

return qt_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_min_max_exames ( nr_sequencia_p bigint ) FROM PUBLIC;

