-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_qt_clearence_creatinina (cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%TYPE, qt_creatinina_serica_p double precision) RETURNS double precision AS $body$
DECLARE

  black_race_w              cor_pele.ie_negro%TYPE;
  nr_idade_w                bigint;
  ie_sexo_w                 pessoa_fisica.ie_sexo%TYPE;
  qt_clearence_creatinina_w double precision;


BEGIN
  if ( qt_creatinina_serica_p <= 0 ) then
    return 0;
  else
    select round( pkg_date_utils.get_diffdate( dt_nascimento, clock_timestamp(), 'YEAR' ) ),
           get_race( cd_pessoa_fisica ),
           pf.ie_sexo
      into STRICT nr_idade_w, 
           black_race_w, 
           ie_sexo_w
      from pessoa_fisica pf
     where cd_pessoa_fisica = cd_pessoa_fisica_p;

    if ( coalesce(nr_idade_w::text, '') = '' ) then
      CALL Wheb_mensagem_pck.exibir_mensagem_abort( 1099889 );
    end if;

    qt_clearence_creatinina_w := 186 *
                                 ( POWER( qt_creatinina_serica_p, -1.154 ) ) *
                                 ( POWER( nr_idade_w, -0.203 ) );
    if ( coalesce(black_race_w::text, '') = '' ) then
      CALL Wheb_mensagem_pck.exibir_mensagem_abort( 1099304 );
    else
      if ( black_race_w = 'S' ) then
        qt_clearence_creatinina_w := ( qt_clearence_creatinina_w * 1.212 );
      end if;
    end if;

    if ( coalesce(ie_sexo_w::text, '') = '' ) then
    CALL Wheb_mensagem_pck.exibir_mensagem_abort( 1099888 );
    else
      if ( ie_sexo_w = 'F' ) then
        qt_clearence_creatinina_w := ( qt_clearence_creatinina_w * 0.742 );
      end if;
    end if;
  end if;

  return qt_clearence_creatinina_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_qt_clearence_creatinina (cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%TYPE, qt_creatinina_serica_p double precision) FROM PUBLIC;

