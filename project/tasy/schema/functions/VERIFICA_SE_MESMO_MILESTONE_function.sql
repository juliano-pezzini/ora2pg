-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION verifica_se_mesmo_milestone (nr_seq_rat_p bigint, nr_seq_nova_ativ_p bigint ) RETURNS varchar AS $body$
DECLARE


ie_mesmo_milestone_w		varchar(1);
nr_seq_ativ_w			bigint;
ie_rat_milestone_w		varchar(1);


BEGIN
	ie_mesmo_milestone_w := 'N';

	select	coalesce(c.ie_rat_milestone, 'N')
	into STRICT	ie_rat_milestone_w
	from	proj_rat b,
		proj_cronograma c
	where	b.nr_sequencia = nr_seq_rat_p
	and	c.nr_sequencia = nr_seq_cronograma;

	if (ie_rat_milestone_w <> 'N') then
		select	coalesce(max(a.nr_seq_etapa_cron), 0)
		into STRICT	nr_seq_ativ_w
		from	proj_rat_ativ a
		where	a.nr_seq_rat = nr_seq_rat_p;

		if (nr_seq_ativ_w = 0) or (retorna_milestone_ativ(nr_seq_ativ_w) = retorna_milestone_ativ(nr_seq_nova_ativ_p)) then
			ie_mesmo_milestone_w := 'S';
		end if;
	else
		ie_mesmo_milestone_w := 'S';
	end if;

return	ie_mesmo_milestone_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION verifica_se_mesmo_milestone (nr_seq_rat_p bigint, nr_seq_nova_ativ_p bigint ) FROM PUBLIC;

