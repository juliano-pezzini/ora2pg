-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_percetual_ocupacao ( nr_unidades_setor_p bigint, nr_unidades_temporarias_p bigint, nr_unidades_ocupadas_p bigint, qt_unidade_acomp_p bigint, nr_unidades_interditadas_p bigint, nr_unidades_livres_p bigint, nr_unidades_higienizacao_p bigint, nr_unidades_reservadas_p bigint, qt_unidades_isolamento_p bigint, qt_unidades_alta_p bigint, nr_unid_temp_ocup_p bigint, nr_unid_temp_ocupadas_p bigint, qt_unid_temp_acomp_p bigint, nr_unid_temp_interditadas_p bigint, nr_unid_temp_livres_p bigint, nr_unid_temp_higienizacao_p bigint, nr_unid_temp_reservadas_p bigint, qt_unid_temp_isolamento_p bigint, qt_unid_temp_alta_p bigint, qt_unidade_manut_p bigint, Ie_forma_calculo_p text ) RETURNS bigint AS $body$
DECLARE

pr_ocupacao_w	double precision;

ie_forma_calculo_w	varchar(2);


BEGIN
ie_forma_calculo_w := Ie_forma_calculo_p;
If (Ie_forma_calculo_p = 'X') then
	ie_forma_calculo_w := Obter_param_Usuario(44, 130, obter_perfil_ativo, wheb_usuario_pck.get_nm_usuario, wheb_usuario_pck.get_cd_estabelecimento, ie_forma_calculo_w);
end if;

if (ie_forma_calculo_w = '1') then
	pr_ocupacao_w	:= dividir((nr_unidades_ocupadas_p*100),(nr_unidades_setor_p-nr_unidades_temporarias_p+nr_unid_temp_ocup_p));
	
elsif (ie_forma_calculo_w = '2') then
	pr_ocupacao_w	:= dividir((qt_unidades_alta_p+nr_unidades_ocupadas_p+qt_unidades_isolamento_p)*100,
				nr_unidades_setor_p-nr_unidades_temporarias_p-
				qt_unidade_acomp_p-nr_unidades_interditadas_p-
				nr_unidades_reservadas_p+nr_unid_temp_ocupadas_p);
				
elsif (ie_forma_calculo_w = '3') then
	pr_ocupacao_w	:= dividir((nr_unidades_ocupadas_p*100),(nr_unidades_setor_p - nr_unidades_interditadas_p -
								 nr_unidades_temporarias_p + nr_unid_temp_ocup_p));
elsif (ie_forma_calculo_w = '4') then
	pr_ocupacao_w	:= dividir((nr_unidades_ocupadas_p*100),(nr_unidades_setor_p - nr_unidades_interditadas_p -
								 nr_unidades_temporarias_p));
elsif (ie_forma_calculo_w = '5') then
	pr_ocupacao_w	:= dividir((nr_unidades_ocupadas_p*100),(nr_unidades_setor_p - nr_unidades_interditadas_p -
								 qt_unidade_manut_p));								 								
elsif (ie_forma_calculo_w = '6') then
	pr_ocupacao_w	:= dividir(((nr_unidades_ocupadas_p + qt_unidades_isolamento_p) * 100),
				(nr_unidades_setor_p - nr_unidades_interditadas_p - nr_unidades_temporarias_p + nr_unid_temp_ocup_p));
elsif (ie_forma_calculo_w = '7') then
	pr_ocupacao_w	:= dividir(((nr_unid_temp_ocupadas_p + nr_unidades_ocupadas_p)*100),(nr_unidades_setor_p - nr_unidades_interditadas_p -
								 nr_unidades_temporarias_p));
elsif (ie_forma_calculo_w = '8') then
	pr_ocupacao_w	:= dividir((nr_unidades_ocupadas_p*100),(nr_unidades_setor_p - nr_unidades_temporarias_p));								
end if;

if (pr_ocupacao_w > 100)
and (ie_forma_calculo_w <> '4') then
	pr_ocupacao_w := 100;
end if;

return	pr_ocupacao_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_percetual_ocupacao ( nr_unidades_setor_p bigint, nr_unidades_temporarias_p bigint, nr_unidades_ocupadas_p bigint, qt_unidade_acomp_p bigint, nr_unidades_interditadas_p bigint, nr_unidades_livres_p bigint, nr_unidades_higienizacao_p bigint, nr_unidades_reservadas_p bigint, qt_unidades_isolamento_p bigint, qt_unidades_alta_p bigint, nr_unid_temp_ocup_p bigint, nr_unid_temp_ocupadas_p bigint, qt_unid_temp_acomp_p bigint, nr_unid_temp_interditadas_p bigint, nr_unid_temp_livres_p bigint, nr_unid_temp_higienizacao_p bigint, nr_unid_temp_reservadas_p bigint, qt_unid_temp_isolamento_p bigint, qt_unid_temp_alta_p bigint, qt_unidade_manut_p bigint, Ie_forma_calculo_p text ) FROM PUBLIC;

