-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_dados_solic ( nr_sequencia_p bigint, ie_tipo_acesso_p text, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE

 
/* 
	IE_OPCAO_P 
	N - Nome de quem fez a solicitação 
	T - Tipo do usuário 
*/
 
			 
ds_retorno_w		varchar(255);
nm_usuario_w		varchar(15);
ds_chave_simples_w	varchar(255);
ds_chave_composta_w	varchar(500);
qt_registro_w		smallint;
nm_solicitante_w	varchar(255);
ds_tipo_usu_solic_w	varchar(60);
k			smallint;
cd_pf_pj_w		varchar(255);


BEGIN 
 
select	nm_usuario_nrec, 
	ds_chave_simples, 
	ds_chave_composta 
into STRICT	nm_usuario_w, 
	ds_chave_simples_w, 
	ds_chave_composta_w 
from	tasy_solic_alt_campo 
where	nr_sequencia = nr_sequencia_p;
 
if (ds_chave_simples_w IS NOT NULL AND ds_chave_simples_w::text <> '') then 
	cd_pf_pj_w := ds_chave_simples_w;
else 
	k := position('#@#@' in ds_chave_composta_w);
	ds_chave_simples_w := substr(ds_chave_composta_w,1,k-1);
	k := position('=' in ds_chave_simples_w);
	cd_pf_pj_w := substr(ds_chave_simples_w,k+1,k-1);
end if;
 
 
 
if (ie_tipo_acesso_p = 'B') then 
	nm_solicitante_w 	:= pls_obter_dados_segurado(nm_usuario_w, 'N');
	ds_tipo_usu_solic_w 	:= 'Beneficiário';
elsif (ie_tipo_acesso_p = 'E') then 
	nm_solicitante_w 	:= pls_obter_nm_estipulante_web(nm_usuario_w);
	ds_tipo_usu_solic_w 	:= 'Estipulante';
elsif (ie_tipo_acesso_p = 'GC') then 
	nm_solicitante_w 	:= pls_obter_dados_grupo_web(nm_usuario_w,'N');
	ds_tipo_usu_solic_w 	:= 'Grupo contrato';
elsif (ie_tipo_acesso_p = 'P') then 
	nm_solicitante_w 	:= pls_obter_dados_prestador(nm_usuario_w,'N');
	ds_tipo_usu_solic_w 	:= 'Prestador';
end if;
 
/* 
select	count(*) 
into	qt_registro_w 
from	pls_segurado 
where	nr_sequencia 	= nm_usuario_w 
and	cd_pessoa_fisica = cd_pf_pj_ w; 
 
if	(qt_registro_w > 0) then 
	nm_solicitante_w 	:= pls_obter_dados_segurado(nm_usuario_w, 'N'); 
	ds_tipo_usu_solic_w 	:= 'Beneficiário'; 
else 
	nm_solicitante_w 	:= pls_obter_nm_estipulante_web(nm_usuario_w); 
	ds_tipo_usu_solic_w 	:= 'Estipulante'; 
end if; 
*/
 
 
if (ie_opcao_p = 'N') then 
	ds_retorno_w := nm_solicitante_w;
elsif (ie_opcao_p = 'T') then 
	ds_retorno_w := ds_tipo_usu_solic_w;
end if;
 
return	ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_dados_solic ( nr_sequencia_p bigint, ie_tipo_acesso_p text, ie_opcao_p text) FROM PUBLIC;

