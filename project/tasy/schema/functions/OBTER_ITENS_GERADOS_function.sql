-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_itens_gerados (nr_sequencia_p bigint, nm_usuario_p text) RETURNS varchar AS $body$
DECLARE

 
nr_seq_item_w	bigint;
ds_item_w	varchar(255);
ds_item_agrup_w	varchar(1000) := null;

C01 CURSOR FOR 
	SELECT	distinct 1, 
		'- ' || obter_desc_expressao(283455) ds 
	from	prontuario_emissao 
	where	ie_anamnese = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (SELECT 1 from prontuario_emissao_item where ie_tipo_item = 'ANAMN' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 2, 
		'- ' || obter_desc_expressao(289676) 
	from	prontuario_emissao 
	where	ie_evolucao = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'EVOL' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 3, 
		'- ' || obter_desc_expressao(287694) 
	from	prontuario_emissao 
	where	ie_diagnostico = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'DIAG' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 4, 
		'- ' || obter_desc_expressao(283879) 
	from	prontuario_emissao 
	where	ie_atestado = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'ATEST' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 5, 
		'- ' || obter_desc_expressao(298520) 
	from	prontuario_emissao 
	where	ie_sinais_vitais = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'SV' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 6, 
		'- ' || obter_desc_expressao(296216) 
	from	prontuario_emissao 
	where	ie_prescricao = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'PRESCR' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 7, 
		'- ' || obter_desc_expressao(289736) 
	from	prontuario_emissao 
	where	ie_exame_lab = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'EXAMLAB' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 8, 
		'- ' || obter_desc_expressao(289737)	 
	from	prontuario_emissao 
	where	ie_laudo = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'LAUDO' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 9, 
		'- ' || obter_desc_expressao(291350)	 
	from	prontuario_emissao 
	where	ie_historico_saude = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'HISTSAUDE' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 10, 
		'- ' || obter_desc_expressao(294764) 
	from	prontuario_emissao 
	where	ie_oftalmologia = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'OFT' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 11, 
		'- ' || obter_desc_expressao(314813) 
	from	prontuario_emissao 
	where	ie_orientacao_alta = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'ORIALTA' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 12, 
		'- ' || obter_desc_expressao(295288) 
	from	prontuario_emissao 
	where	ie_parecer_medico = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'PARECER' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 13, 
		'- ' || obter_desc_expressao(297315) 
	from	prontuario_emissao 
	where	ie_receita = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'RECEITA' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 14, 
		'- ' || obter_desc_expressao(297968) 
	from	prontuario_emissao 
	where	ie_sae = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'SAE' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 15, 
		'- ' || obter_desc_expressao(673307) 
	from	prontuario_emissao 
	where	ie_solic_exame_ext = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'EXAMEEXT' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 16, 
		'- Declaração de Recebimentos' 
	from	prontuario_emissao 
	where	ie_declaracao_receb = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'ANAMN' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 17, 
		'- ' || obter_desc_expressao(285718) 
	from	prontuario_emissao 
	where	ie_consentimento = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'CONSENTIMENTO' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 18, 
		'- ' || obter_desc_expressao(285917) 
	from	prontuario_emissao 
	where	ie_consulta_amb = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'CONSAMB' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 19, 
		'- ' || obter_desc_expressao(316986) 
	from	prontuario_emissao 
	where	ie_ganho_perda = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'GP' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 20, 
		'- ' || obter_desc_expressao(294687) 
	from	prontuario_emissao 
	where	ie_obstetricia_nasc = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'OBSNASC' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 21, 
		'- ' || obter_desc_expressao(284861) 
	from	prontuario_emissao 
	where	ie_checkup = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'CHECKUP' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 22, 
		'- ' || obter_desc_expressao(287703) 
	from	prontuario_emissao 
	where	ie_diag_tumor = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'DIAGTUMOR' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 23, 
		'- ' || obter_desc_expressao(300457) 
	from	prontuario_emissao 
	where	ie_trat_onco = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'ONCOLOGIA' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 24, 
		'- ' || obter_desc_expressao(284113) 
	from	prontuario_emissao 
	where	ie_avaliacao = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item = 'AVAL' and nm_usuario = nm_usuario_p) 
	
union
 
	select	distinct 25, 
		'- ' || obter_desc_expressao(283352) 
	from	prontuario_emissao 
	where	ie_alertas = 'S' 
	and	nr_sequencia = nr_sequencia_p 
	and	exists (select 1 from prontuario_emissao_item where ie_tipo_item in ('ALERTASPAC','ALERTASATE') and nm_usuario = nm_usuario_p) 
	order by 1;


BEGIN 
open C01;
loop 
fetch C01 into	 
	nr_seq_item_w, 
	ds_item_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin 
	if (coalesce(ds_item_agrup_w::text, '') = '') then 
		ds_item_agrup_w := ds_item_w;
	else 
		ds_item_agrup_w := ds_item_agrup_w || chr(10) || chr(13) ||ds_item_w;
	end if;	
	exception 
	when others then 
		ds_item_agrup_w	:= ds_item_agrup_w || substr(ds_item_w,1,(3000-length(ds_item_agrup_w)));
	end;
end loop;
close C01;
 
return	ds_item_agrup_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_itens_gerados (nr_sequencia_p bigint, nm_usuario_p text) FROM PUBLIC;

