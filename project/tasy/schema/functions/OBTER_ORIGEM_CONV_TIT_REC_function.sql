-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_origem_conv_tit_rec (nr_titulo_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE
	
/* 
	'C' - Código 
	'D' - Descricao 
*/
 
 
ds_retorno_w			varchar(255) := null;
ds_descricao_w			varchar(255);
nr_interno_conta_w		bigint;
cd_origem_w			bigint;


BEGIN 
if (ie_opcao_p = 'C') then 
	select 	max(nr_interno_conta) 
	into STRICT	nr_interno_conta_w 
	from	titulo_receber 
	where	nr_titulo	= nr_titulo_p;
 
	ds_retorno_w	:= null;
	 
	if (nr_interno_conta_w IS NOT NULL AND nr_interno_conta_w::text <> '') then 
		select	max(a.nr_seq_origem) 
		into STRICT	cd_origem_w 
		from	atend_categoria_convenio a, 
			atendimento_paciente b, 
			conta_paciente c 
		where	a.nr_atendimento	= b.nr_atendimento 
		and	b.nr_atendimento	= c.nr_atendimento 
		and	a.nr_seq_interno	= obter_atecaco_atendimento(b.nr_atendimento) 
		and	c.nr_interno_conta	= nr_interno_conta_w;
		 
		ds_retorno_w			:= cd_origem_w;
	end if;
 
elsif (ie_opcao_p = 'D') then 
	select	max(nr_interno_conta) 
	into STRICT	nr_interno_conta_w 
	from	titulo_receber 
	where	nr_titulo	= nr_titulo_p;
 
	ds_retorno_w	:= null;
 
	if (nr_interno_conta_w IS NOT NULL AND nr_interno_conta_w::text <> '') then 
		select 	max(s.ds_origem) 
		into STRICT	ds_descricao_w 
		from	atend_categoria_convenio t, 
			convenio_origem_usuario s, 
			atendimento_paciente b, 
			conta_paciente c 
		where	t.nr_seq_origem		= s.nr_sequencia 
		and	t.nr_atendimento	= b.nr_atendimento 
		and	t.nr_seq_interno	= obter_atecaco_atendimento(b.nr_atendimento) 
		and	b.nr_atendimento	= c.nr_atendimento 
		and	c.nr_interno_conta	= nr_interno_conta_w;
		 
		--ds_retorno_w			:= nvl(ds_descricao_w,'Não Informado'); 
		ds_retorno_w			:= coalesce(ds_descricao_w,wheb_mensagem_pck.get_texto(303273));
	 
	end if;
end if;
 
return ds_retorno_w;
	 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_origem_conv_tit_rec (nr_titulo_p bigint, ie_opcao_p text) FROM PUBLIC;

