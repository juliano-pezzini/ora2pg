-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_equipamento_exame_dados ( nr_seq_exame_p bigint, cd_equipamento_p bigint, nr_Seq_material_p bigint, ds_sigla_p text, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


cd_equipamento_w		integer;
ds_sigla_w			varchar(10);
ds_equipamento_w		varchar(50);
cd_exame_equip_w		varchar(20);
cd_exame_equip_integr_w		varchar(20);
Resultado_w	 		varchar(50);
cd_material_integr_w		varchar(50);

/* Opções
	M - Busca o material  para a sigla
*/
C01 CURSOR FOR
	SELECT	coalesce((b.cd_material_integr),null)
	from 	equipamento_lab a,
	     	lab_exame_equip b
       where 	a.cd_equipamento	= b.cd_equipamento
	 and 	b.nr_seq_exame 		= nr_seq_exame_p
	 and 	((b.nr_seq_material 	=  coalesce(nr_seq_material_p,nr_seq_material)) or (coalesce(nr_seq_material::text, '') = ''))
	 and 	a.ds_sigla 	= ds_sigla_p
       order by coalesce(nr_seq_material,0);


BEGIN

resultado_w :=  null;

OPEN C01;
LOOP
FETCH C01 into
	cd_material_integr_w;
EXIT WHEN NOT FOUND; /* apply on c01 */

	if (ie_opcao_p = 'M') then
		resultado_w := cd_material_integr_w;
	end if;

END LOOP;
CLOSE C01;


RETURN resultado_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_equipamento_exame_dados ( nr_seq_exame_p bigint, cd_equipamento_p bigint, nr_Seq_material_p bigint, ds_sigla_p text, ie_opcao_p text) FROM PUBLIC;

