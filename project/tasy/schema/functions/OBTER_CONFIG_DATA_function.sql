-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_config_data ( ie_record_type_p text, nr_sequencia_p text, nr_atendimento_p bigint, config_option_p bigint ) RETURNS varchar AS $body$
DECLARE


    ds_txt_w          varchar(32000);
    ds_form_txt       varchar(32000);
    data_w            varchar(32000);
    pessoa_fisica_w   varchar(2000);
  i RECORD;

BEGIN
    SELECT
        cd_pessoa_fisica
    INTO STRICT pessoa_fisica_w
    FROM
        atendimento_paciente
    WHERE
        nr_atendimento = nr_atendimento_p;

-- Surgery : Below Record type is based on the expression returned using obter_desc_expressao(284979)
    IF ( ie_record_type_p = 284979 ) THEN
        IF ( config_option_p = 1 ) THEN
            FOR i IN (WITH RECURSIVE cte AS (

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w

                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
              UNION ALL

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w
                
                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
             JOIN cte c ON ()

) SELECT * FROM cte;
) LOOP
                SELECT
                    obter_desc_expressao(310240)
                    || '-'
                    || obter_desc_proc_interno(nr_seq_proc_interno)
                    || '</br>'
                    || obter_desc_expressao(288408)
                    || '-'
                    || pkg_date_formaters.to_varchar(dt_inicio_prevista, 'shortDate', wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck
                    .get_nm_usuario)
                    || '</br>'
                    || obter_desc_expressao(298359)
                    || '-'
                    || obter_ds_setor_atendimento(cd_setor_atendimento)
                INTO STRICT ds_form_txt
                FROM
                    cirurgia
                WHERE
                    nr_atendimento = nr_atendimento_p
                    AND nr_cirurgia = i.data_w;

                ds_txt_w := ds_txt_w
                            ||'</br>'
                            || CHR(149)||Chr(32)||Chr(32)
                            || ds_form_txt;
            END LOOP;

        END IF;

    END IF;

--    Diagnosis : Below Record type is based on the expression returned using obter_desc_expressao(287694)
    IF ( ie_record_type_p = 287694 ) THEN
        IF ( config_option_p = 1 ) THEN
            FOR i IN (WITH RECURSIVE cte AS (

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w

                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
              UNION ALL

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w
                
                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
             JOIN cte c ON ()

) SELECT * FROM cte;
) LOOP
                SELECT
                    obter_desc_expressao(689299)
                    || ' - '
                    || obter_desc_cid_doenca(cd_doenca)
                INTO STRICT ds_form_txt
                FROM
                    diagnostico_doenca
                WHERE
                    nr_atendimento = nr_atendimento_p
                    AND nr_seq_interno = i.data_w;

                ds_txt_w := ds_txt_w
                            ||'</br>'
                            || CHR(149)||Chr(32)||Chr(32)
                            || ds_form_txt;
            END LOOP;

        ELSIF ( config_option_p = 2 ) THEN
            FOR i IN (WITH RECURSIVE cte AS (

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w

                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
              UNION ALL

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w
                
                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
             JOIN cte c ON ()

) SELECT * FROM cte;
) LOOP
                SELECT
                    obter_desc_expressao(689299)
                    || ' - '
                    || obter_desc_cid_doenca(cd_doenca)
                    || '</br>'
                    || obter_desc_expressao(630413)
                    || ' - '
                    || obter_desc_setor_atend(cd_setor_atendimento)
                INTO STRICT ds_form_txt
                FROM
                    diagnostico_doenca
                WHERE
                    nr_atendimento = nr_atendimento_p
                    AND nr_seq_interno = i.data_w;

                ds_txt_w := ds_txt_w
                            ||'</br>'
                            || CHR(149)||Chr(32)||Chr(32)
                            || ds_form_txt;
            END LOOP;
        ELSIF ( config_option_p = 3 ) THEN
            FOR i IN (WITH RECURSIVE cte AS (

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w

                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
              UNION ALL

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w
                
                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
             JOIN cte c ON ()

) SELECT * FROM cte;
) LOOP
                SELECT
                    obter_desc_expressao(689299)
                    || ' - '
                    || obter_desc_cid_doenca(cd_doenca)
                    || '</br>'
                    || obter_desc_expressao(629181)
                    || ' - '
                    || (
                        SELECT
                            ds_status
                        FROM
                            diagnostico_status
                        WHERE
                            ie_status = a.ie_classificacao_doenca
                            AND ie_situacao = 'A' 
                     LIMIT 1)
                    || '</br>'
                    || obter_desc_expressao(298359)
                    || ' - '
                    || obter_desc_setor_atend(cd_setor_atendimento)
                    || '</br>'
                    || obter_desc_expressao(926591)
                    || ' - '
                    || pkg_date_formaters.to_varchar(dt_inicio, 'shortDate', wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck
                    .get_nm_usuario)
                    || '~'
                    || pkg_date_formaters.to_varchar(dt_fim, 'shortDate', wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck
                    .get_nm_usuario)
                    || '</br>'
                    || obter_desc_expressao(287595)
                    || ' - '
                    || obter_status_problema(ie_status_problema)
                INTO STRICT ds_form_txt
                FROM
                    diagnostico_doenca a
                WHERE
                    nr_atendimento = nr_atendimento_p
                    AND nr_seq_interno = i.data_w;

                ds_txt_w := ds_txt_w
                            ||'</br>'
                            || CHR(149)||Chr(32)||Chr(32)
                            || ds_form_txt;
            END LOOP;
        END IF;
    END IF;

        -- Admission History : Below Record type is based on the expression returned using obter_desc_expressao(1031045)
    IF ( ie_record_type_p = 1031045 ) THEN
        IF ( config_option_p = 1 ) THEN
            FOR i IN (WITH RECURSIVE cte AS (

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w

                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
              UNION ALL

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w
                
                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
             JOIN cte c ON ()

) SELECT * FROM cte;
) LOOP
                SELECT
                    obter_desc_expressao(1031482)
                    || '-'
                    || to_char(a.dt_internacao, 'YYYY')
                    || ' '
                    || to_char(a.dt_internacao, 'MM')
                    || '</br>'
                    || obter_desc_expressao(964806)
                    || '-'
                    || abs(round((clock_timestamp() - to_date(b.dt_nascimento)) / 365))
                    || '</br>'
                    || obter_desc_expressao(283455)
                    || '-'
                    || obter_desc_cid_doenca(a.cd_doenca)
                    || '('
                    || obter_desc_expressao(825075)
                    || ')'
                INTO STRICT ds_form_txt
                FROM
                    historico_saude_internacao   a,
                    pessoa_fisica                b
                WHERE
                    a.nr_sequencia = i.data_w
                    AND a.cd_pessoa_fisica = b.cd_pessoa_fisica
                    AND a.cd_pessoa_fisica = pessoa_fisica_w;

                ds_txt_w := ds_txt_w
                            ||'</br>'
                            || CHR(149)||Chr(32)||Chr(32)
                            || ds_form_txt;
            END LOOP;

        END IF;
    END IF;


        -- Surgical History : Below Record type is based on the expression returned using obter_desc_expressao(662457)
    IF ( ie_record_type_p = 662457 ) THEN
        IF ( config_option_p = 1 ) THEN
            FOR i IN (WITH RECURSIVE cte AS (

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w

                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
              UNION ALL

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w
                
                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
             JOIN cte c ON ()

) SELECT * FROM cte;
) LOOP
                SELECT
                    obter_desc_expressao(1031482)
                    || '-'
                    || to_char(a.dt_inicio, 'YYYY')
                    || ' '
                    || to_char(a.dt_inicio, 'MM')
                    || '</br>'
                    || obter_desc_expressao(964806)
                    || '-'
                    || abs(round((clock_timestamp() - to_date(b.dt_nascimento)) / 365))
                    || '</br>'
                    || obter_desc_expressao(283455)
                    || '-'
                    || a.ds_procedimento_inf
                    || '('
                    || obter_desc_expressao(314307)
                    || ')'
                INTO STRICT ds_form_txt
                FROM
                    historico_saude_cirurgia   a,
                    pessoa_fisica              b
                WHERE
                    a.cd_pessoa_fisica = b.cd_pessoa_fisica
                    AND a.nr_atendimento = nr_atendimento_p
                    AND a.nr_sequencia = i.data_w;

                ds_txt_w := ds_txt_w
                            ||'</br>'
                            || CHR(149)||Chr(32)||Chr(32)
                            || ds_form_txt;
            END LOOP;

        END IF;
    END IF;

         -- Transfusion History: Below Record type is based on the expression returned using obter_desc_expressao(1031049)
    IF ( ie_record_type_p = 1031049 ) THEN
        IF ( config_option_p = 1 ) THEN
            FOR i IN (WITH RECURSIVE cte AS (

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w

                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
              UNION ALL

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w
                
                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
             JOIN cte c ON ()

) SELECT * FROM cte;
) LOOP
                SELECT
                    obter_desc_expressao(1031482)
                    || '-'
                    || to_char(a.dt_transfusao, 'YYYY')
                    || ' '
                    || to_char(a.dt_transfusao, 'MM')
                    || '</br>'
                    || obter_desc_expressao(964806)
                    || '-'
                    || abs(round((clock_timestamp() - to_date(b.dt_nascimento)) / 365))
                    || '</br>'
                    || obter_desc_expressao(283455)
                    || '-'
                    || obter_desc_san_derivado(a.nr_seq_derivado)
                    || '('
                    || obter_desc_expressao(300409)
                    || ')'
                INTO STRICT ds_form_txt
                FROM
                    paciente_transfusao   a,
                    pessoa_fisica         b
                WHERE
                    a.cd_pessoa_fisica = b.cd_pessoa_fisica
                    AND a.cd_pessoa_fisica = pessoa_fisica_w
                    AND a.nr_sequencia = i.data_w;

                ds_txt_w := ds_txt_w
                            ||'</br>'
                           || CHR(149)||Chr(32)||Chr(32)
                            || ds_form_txt;
            END LOOP;

        END IF;
    END IF;

          -- Family History:Below Record type is based on the expression returned using obter_desc_expressao(1007486)
    IF ( ie_record_type_p = 1007486 ) THEN
        IF ( config_option_p = 1 ) THEN
            FOR i IN (WITH RECURSIVE cte AS (

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w

                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
              UNION ALL

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w
                
                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
             JOIN cte c ON ()

) SELECT * FROM cte;
) LOOP
                SELECT
                    obter_desc_expressao(317079)
                    || '-'
                    || obter_desc_parentesco(nr_seq_parentesco)
                    || '</br>'
                    || obter_desc_expressao(1007486)
                    || '-'
                    || obter_desc_cid_doenca(cd_doenca)
                INTO STRICT ds_form_txt
                FROM
                    paciente_antec_clinico
                WHERE
                    nr_atendimento = nr_atendimento_p
                    AND nr_sequencia = i.data_w;

                ds_txt_w := ds_txt_w
                            ||'</br>'
                            || CHR(149)||Chr(32)||Chr(32)
                            || ds_form_txt;
            END LOOP;

        END IF;
    END IF;

        -- Prescription : Below Record type is based on the expression returned using obter_desc_expressao(297315)
    IF ( ie_record_type_p = 297315 ) THEN
        IF ( config_option_p = 1 ) THEN
            FOR i IN (WITH RECURSIVE cte AS (

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w
                
                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
              UNION ALL

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w
                
                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
             JOIN cte c ON ()

) SELECT * FROM cte;
) LOOP
                SELECT
                    obter_desc_expressao(1006234)
                    || '-'
                    || obter_desc_material(cd_material)
                    || '</br>'
                    || obter_desc_expressao(288219)
                    || '-'
                    || qt_dose
                    || cd_unid_med
                INTO STRICT ds_form_txt
                FROM
                    paciente_medic_uso
                WHERE
                    nr_sequencia = i.data_w
                    AND nr_atendimento = nr_atendimento_p;

                ds_txt_w := ds_txt_w
                            ||'</br>'
                            || CHR(149)||Chr(32)||Chr(32)
                            || ds_form_txt;
            END LOOP;

        ELSIF ( config_option_p = 2 ) THEN
            FOR i IN (WITH RECURSIVE cte AS (

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w

                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
              UNION ALL

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w
                
                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
             JOIN cte c ON ()

) SELECT * FROM cte;
) LOOP
                SELECT
                    obter_desc_expressao(617431)
                    || '-'
                    || pkg_date_formaters.to_varchar(dt_inicio, 'shortDate', wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck
                    .get_nm_usuario)
                    || '('
                    || obter_desc_expressao(298359)
                    || '-'
                    || obter_ds_setor_atendimento(cd_setor_atendimento)
                    || ')'
                    || '</br>'
                    || obter_desc_expressao(1006234)
                    || '-'
                    || obter_desc_material(cd_material)
                    || '</br>'
                    || obter_desc_expressao(288219)
                    || '-'
                    || qt_dose
                    || cd_unid_med
                    || '</br>'
                    || obter_desc_expressao(315931)
                    || '-'
                    || obter_desc_intervalo_prescr(cd_intervalo)
                    || '</br>'
                    || obter_desc_expressao(294611)
                    || '-'
                    || ds_reacao
                INTO STRICT ds_form_txt
                FROM
                    paciente_medic_uso
                WHERE
                    nr_sequencia = i.data_w
                    AND nr_atendimento = nr_atendimento_p;

                ds_txt_w := ds_txt_w
                            ||'</br>'
                            || CHR(149)||Chr(32)||Chr(32)
                            || ds_form_txt;
            END LOOP;
        END IF;
    END IF;

     -- DPC:Below Record type is based on the expression returned using obter_desc_expressao(968213)
    IF ( ie_record_type_p = 968213 ) THEN
        IF ( config_option_p = 1 ) THEN
            FOR i IN (WITH RECURSIVE cte AS (

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w

                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
              UNION ALL

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w
                
                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
             JOIN cte c ON ()

) SELECT * FROM cte;
) LOOP
                SELECT
                    obter_desc_expressao(288148)
                    || '-'
                    || ds.nm_dpc
                    || '</br>'
                    || obter_desc_expressao(617431)
                    || '-'
                    || pkg_date_formaters.to_varchar(pd.dt_start_dpc, 'shortDate', wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck
                    .get_nm_usuario)
                INTO STRICT ds_form_txt
                FROM atendimento_paciente ap, patient_dpc pd
LEFT OUTER JOIN departamento_medico dm ON (pd.cd_departamento = dm.cd_departamento)
LEFT OUTER JOIN dpc_score ds ON (pd.nr_seq_dpc_score = ds.nr_sequencia)
LEFT OUTER JOIN diagnostico_doenca dd ON (pd.nr_seq_most_exp_diagnosis = dd.nr_seq_interno)
LEFT OUTER JOIN cid_doenca cd ON (dd.cd_doenca = cd.cd_doenca)
WHERE pd.nr_atendimento = ap.nr_atendimento     AND pd.nr_atendimento = nr_atendimento_p AND pd.nr_sequencia = i.data_w;

                ds_txt_w := ds_txt_w
                            || '</br>'
                            || CHR(149)||Chr(32)||Chr(32)
                            || ds_form_txt;
            END LOOP;

        ELSIF ( config_option_p = 2 ) THEN
            FOR i IN (WITH RECURSIVE cte AS (

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w

                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
              UNION ALL

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w
                
                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
             JOIN cte c ON ()

) SELECT * FROM cte;
) LOOP
                SELECT
                    obter_desc_expressao(10652083)
                    || '-'
                    || pkg_date_formaters.to_varchar(ap.dt_entrada, 'shortDate', wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck
                    .get_nm_usuario)
                    || '</br>'
                    || obter_desc_expressao(302875)
                    || '-'
                    || (
                        SELECT
                            b.ds_valor_dominio
                        FROM
                            valor_dominio b
                        WHERE
                            cd_dominio = obter_valor_dominio(9603, vl_dominio)
                            AND vl_dominio = si_category
                    )
                    || '</br>'
                    || obter_desc_expressao(298359)
                    || '-'
                    || dm.ds_departamento
                    || '</br>'
                    || obter_desc_expressao(968263)
                    || '-'
                    || ds.cd_dpc
                    || '</br>'
                    || obter_desc_expressao(288148)
                    || '-'
                    || ds.nm_dpc
                    || '</br>'
                    || obter_desc_expressao(617431)
                    || '-'
                    || pkg_date_formaters.to_varchar(pd.dt_start_dpc, 'shortDate', wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck
                    .get_nm_usuario)
                    || '</br>'
                    || obter_desc_expressao(968801)
                    || ':'
                    || dd.cd_doenca
                    || ' - '
                    || cd.ds_doenca_cid
                INTO STRICT ds_form_txt
                FROM atendimento_paciente ap, patient_dpc pd
LEFT OUTER JOIN departamento_medico dm ON (pd.cd_departamento = dm.cd_departamento)
LEFT OUTER JOIN dpc_score ds ON (pd.nr_seq_dpc_score = ds.nr_sequencia)
LEFT OUTER JOIN diagnostico_doenca dd ON (pd.nr_seq_most_exp_diagnosis = dd.nr_seq_interno)
LEFT OUTER JOIN cid_doenca cd ON (dd.cd_doenca = cd.cd_doenca)
WHERE pd.nr_atendimento = ap.nr_atendimento     AND pd.nr_atendimento = nr_atendimento_p AND pd.nr_sequencia = i.data_w;

                ds_txt_w := ds_txt_w
                            || '</br>'
                            || CHR(149)||Chr(32)||Chr(32)
                            || ds_form_txt;
            END LOOP;
        END IF;
    END IF;

      -- Hospitalization History : Below Record type is based on the expression returned using obter_desc_expressao(1031051)  
    IF ( ie_record_type_p = 1031051 ) THEN
        IF ( config_option_p = 1 ) THEN
            FOR i IN (WITH RECURSIVE cte AS (

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w

                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
              UNION ALL

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w
                
                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
             JOIN cte c ON ()

) SELECT * FROM cte;
) LOOP
                SELECT
                    obter_desc_expressao(974390)
                    || '-'
                    || pkg_date_formaters.to_varchar(c.dt_entrada_unidade, 'shortDate', wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck
                    .get_nm_usuario)
                    || '</br>'
                    || obter_desc_expressao(656520)
                    || '-'
                    || pkg_date_formaters.to_varchar(c.dt_saida_unidade, 'shortDate', wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck
                    .get_nm_usuario)
                    || '</br>'
                    || obter_desc_expressao(332098)
                    || '-'
                    || dm.ds_departamento
                    || '</br>'
                    || obter_desc_expressao(298359)
                    || ' - '
                    || e.ds_setor_atendimento
                INTO STRICT ds_form_txt
                FROM setor_atendimento e, convenio d, atend_categoria_convenio b, atendimento_paciente a, atend_paciente_unidade c
LEFT OUTER JOIN departamento_medico dm ON (c.cd_departamento = dm.cd_departamento)
WHERE a.nr_atendimento = c.nr_atendimento AND c.nr_seq_interno = obter_atepacu_paciente(a.nr_atendimento, 'A') AND b.nr_seq_interno = obter_atecaco_atendimento(a.nr_atendimento) AND c.cd_setor_atendimento = e.cd_setor_atendimento AND b.cd_convenio = d.cd_convenio  AND a.cd_pessoa_fisica = pessoa_fisica_w AND a.nr_atendimento = nr_atendimento_p AND a.cd_medico_resp = i.data_w;

                ds_txt_w := ds_txt_w
                            ||'</br>'
                            || CHR(149)||Chr(32)||Chr(32)
                            || ds_form_txt;
            END LOOP;

        END IF;
    END IF;

       -- Lab Test: Below Record type is based on the expression returned using obter_desc_expressao(289683)
    IF ( ie_record_type_p = 289683 ) THEN
        IF ( config_option_p = 1 ) THEN
            FOR i IN (WITH RECURSIVE cte AS (

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w

                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
              UNION ALL

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w
                
                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
             JOIN cte c ON ()

) SELECT * FROM cte;
) LOOP
                SELECT
                    obter_desc_expressao(761511)
                    || '-'
                    || ds_exame
                    || '</br>'
                    || obter_desc_expressao(288414)
                    || '-'
                    || dt_coleta
                    || '</br>'
                    || obter_desc_expressao(622546)
                    || '-'
                    || ds_material
                    || '</br>'
                    || obter_desc_expressao(1023729)
                    || '-'
                    || exame_result
                    || '</br>'
                    || obter_desc_expressao(285638)
                    || '-'
                    || ds_status_lab
                INTO STRICT ds_form_txt
                FROM (
                        SELECT
                            b.nr_sequencia        nr_seq_prescr,
                            b.cd_procedimento,
                            b.ie_origem_proced,
                            b.nr_prescricao,
                            b.nr_sequencia,
                            c.cd_exame,
                            b.dt_coleta,
                            substr(c.nm_exame, 1, 200) ds_exame,
                            a.nr_atendimento,
                            a.ie_recem_nato,
                            b.ie_status,
                            substr(obter_nome_medico(a.cd_medico, 'N'), 1, 60) nm_medico,
                            substr(obter_material_exame_lab(obter_mat_exame_lab_prescr(b.nr_prescricao, b.nr_sequencia, 1), NULL,
                            3), 1, 90) ds_material,
                            b.nr_sequencia        nr_seq_prescr_proc,
                            dt_prev_execucao,
                            obter_data_aprov_lab(a.nr_prescricao, b.nr_sequencia) dt_aprovacao,
                            obter_data_impressao_result(b.nr_sequencia, a.nr_prescricao, 0) dt_impressao,
                            b.dt_emissao_resultado,
                            substr(obter_valor_dominio_status_lis(b.ie_status_atend), 1, 100) ds_status_lab,
                            b.nr_sequencia        nr_seq_proc,
                            b.ds_observacao_coleta,
                            result.ds_resultado   exame_result
                        FROM
                            exame_laboratorio       c,
                            prescr_procedimento     b,
                            prescr_medica           a
                            ,
                            exame_lab_result_item   result
                        WHERE
                            b.nr_prescricao = a.nr_prescricao
                            AND b.nr_seq_exame = c.nr_seq_exame
                            AND b.nr_seq_exame = result.nr_seq_exame
                            AND b.nr_sequencia = result.nr_sequencia
                            AND nr_atendimento = nr_atendimento_p
                            AND b.cd_procedimento = i.data_w
                            AND result.nm_usuario = wheb_usuario_pck.get_nm_usuario
                    ) alias23;

                ds_txt_w := ds_txt_w
                            ||'</br>'
                            || CHR(149)||Chr(32)||Chr(32)
                            || ds_form_txt;
            END LOOP;

        END IF;
    END IF;

        -- SNCP : Below Record type is based on the expression returned using obter_desc_expressao(929193)
    IF ( ie_record_type_p = 929193 ) THEN
        IF ( config_option_p = 1 ) THEN
            FOR i IN (WITH RECURSIVE cte AS (

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w

                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
              UNION ALL

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w
                
                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
             JOIN cte c ON ()

) SELECT * FROM cte;
) LOOP
                SELECT
                    clipboard_util_pkg.concatenate_list(CURSOR(
                        SELECT
                            obter_desc_expressao(822287)
                            || '-'
                            || di.ds_diagnostico
                        FROM
                            pe_prescricao    a, pe_prescr_diag   b, pe_diagnostico   di
                        WHERE
                            a.nr_sequencia = b.nr_seq_prescr
                            AND di.nr_sequencia = b.nr_seq_diag
                            AND nr_atendimento = nr_atendimento_p
                            AND a.nr_sequencia = i.data_w
                    ))
                INTO STRICT ds_form_txt
;

                ds_txt_w := ds_txt_w
                            ||'</br>'
                            || CHR(149)||Chr(32)||Chr(32)
                            || ds_form_txt;
            END LOOP;

        ELSIF ( config_option_p = 2 ) THEN
            FOR i IN (WITH RECURSIVE cte AS (

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w

                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
              UNION ALL

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w
                
                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
             JOIN cte c ON ()

) SELECT * FROM cte;
) LOOP
                SELECT
                    clipboard_util_pkg.concatenate_list(CURSOR(
                        SELECT
                            obter_desc_expressao(822287)
                            || '-'
                            || di.ds_diagnostico
                            || '</br>'
                            || obter_desc_expressao(288452)
                            || '-'
                            || pkg_date_formaters.to_varchar(b.dt_atualizacao, 'shortDate', wheb_usuario_pck.get_cd_estabelecimento
                            , wheb_usuario_pck.get_nm_usuario)
                            || '</br>'
                            || obter_desc_expressao(315181)
                            || '-'
                            || coalesce(substr(sae_obter_result_esperado(i.data_w), 1, 200), substr(obter_result_diag_concat(i.data_w
                            ), 1, 255))
                        FROM
                            pe_prescricao    a, pe_prescr_diag   b, pe_diagnostico   di
                        WHERE
                            a.nr_sequencia = b.nr_seq_prescr
                            AND di.nr_sequencia = b.nr_seq_diag
                            AND nr_atendimento = nr_atendimento_p
                            AND a.nr_sequencia = i.data_w
                    ))
                INTO STRICT ds_form_txt
;


                    ds_txt_w := ds_txt_w
                            ||'</br>'
                            || CHR(149)||Chr(32)||Chr(32)
                            || ds_form_txt;

            END LOOP;
        ELSIF ( config_option_p = 3 ) THEN
            FOR i IN (WITH RECURSIVE cte AS (

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w

                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
              UNION ALL

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w
                
                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
             JOIN cte c ON ()

) SELECT * FROM cte;
) LOOP
                SELECT
                    null
                INTO STRICT ds_form_txt
;

                ds_txt_w := ds_txt_w
                            ||'</br>'
                            || CHR(149)||Chr(32)||Chr(32)
                            || ds_form_txt;
            END LOOP;
        END IF;
    END IF;



   -- Clinical Staff: Below Record type is based on the expression returned using obter_desc_expressao(1003955)     
    IF ( ie_record_type_p = 1003955 ) THEN
        IF ( config_option_p = 1 ) THEN
            FOR i IN (WITH RECURSIVE cte AS (

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w

                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
              UNION ALL

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w
                
                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
             JOIN cte c ON ()

) SELECT * FROM cte;
) LOOP
                SELECT

                    obter_desc_expressao(1001780)
                    || '-'
                    || obter_clinical_staff(nr_sequencia, 1)
                    || '</br>'
                    || obter_desc_expressao(1015943)
                    || '-'
                    || obter_clinical_staff(nr_sequencia, 2)
                INTO STRICT ds_form_txt
                FROM
                    med_treatment_plan
                WHERE
                    nr_atendimento = nr_atendimento_p
                    AND nr_sequencia = i.data_w;

                ds_txt_w := ds_txt_w
                            ||'</br>'
                           || CHR(149)||Chr(32)||Chr(32)
                            || ds_form_txt;
            END LOOP;

        ELSIF ( config_option_p = 2 ) THEN
            FOR i IN (WITH RECURSIVE cte AS (

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w

                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
              UNION ALL

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w
                
                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
             JOIN cte c ON ()

) SELECT * FROM cte;
) LOOP
                SELECT

                     obter_desc_expressao(1001780)
                    || '-'
                    || obter_clinical_staff(nr_sequencia, 1)
                    || '</br>'
                    || obter_desc_expressao(486333)
                    || '-'
                    || obter_clinical_staff(nr_sequencia, 3)
                INTO STRICT ds_form_txt
                FROM
                    med_treatment_plan
                WHERE
                    nr_atendimento = nr_atendimento_p
                    AND nr_sequencia = i.data_w;

                ds_txt_w := ds_txt_w
                           ||'</br>'
                            || CHR(149)||Chr(32)||Chr(32)
                            || ds_form_txt;
            END LOOP;
        ELSIF ( config_option_p = 3 ) THEN
            FOR i IN (WITH RECURSIVE cte AS (

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w

                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
              UNION ALL

                SELECT
                    regexp_substr(nr_sequencia_p, '[^,]+', 1, level) AS data_w
                
                (regexp_substr(nr_sequencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencia_p, '[^,]+', 1, level))::text <> '')
             JOIN cte c ON ()

) SELECT * FROM cte;
) LOOP
                SELECT

                     obter_desc_expressao(1015943)
                    || '-'
                    || obter_clinical_staff(nr_sequencia, 2)
                    || '</br>'
                    || obter_desc_expressao(1036610)
                    || '-'
                    || obter_clinical_staff(nr_sequencia, 4)
                INTO STRICT ds_form_txt
                FROM
                    med_treatment_plan
                WHERE
                    nr_atendimento = nr_atendimento_p
                    AND nr_sequencia = i.data_w;

                ds_txt_w := ds_txt_w
                            ||'</br>'
                            || CHR(149)||Chr(32)||Chr(32)
                            || ds_form_txt;
            END LOOP;
        END IF;
    END IF;

    RETURN substr(ltrim(ds_txt_w, '</br>'),1,32000);
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_config_data ( ie_record_type_p text, nr_sequencia_p text, nr_atendimento_p bigint, config_option_p bigint ) FROM PUBLIC;

