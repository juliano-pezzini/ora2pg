-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_users_build (build_pendente text default 'N', liberacao_build text default 'N', solicitacao_emer text default 'N', solicitacao_pmo text default 'N', build_fila text default 'N') RETURNS varchar AS $body$
DECLARE

  l_text  varchar(32767) := NULL;
  ds_email varchar(2000) := null;
  c010 integer;
  ds_comando_cursor_w varchar(4000) := 'SELECT u.nm_usuario FROM usuario u ' ||
						'inner join man_cad_dados_inf_build b on b.cd_pessoa_fisica = u.cd_pessoa_fisica ' ||
						'where B.IE_SITUACAO = ''A''';
  retorno_w integer;

BEGIN
  if (upper(build_pendente) = 'S') then
    ds_comando_cursor_w := ds_comando_cursor_w || ' AND B.IE_RECEBE_BUILD_PENDENTE = ''S''';
  END IF;
  if (upper(liberacao_build) = 'S') then
    ds_comando_cursor_w := ds_comando_cursor_w || ' AND B.IE_RECEBE_BUILD_LIB = ''S''';
  END IF;
  if (upper(solicitacao_emer) = 'S') then
    ds_comando_cursor_w := ds_comando_cursor_w || ' AND B.IE_RECEBE_SOLIC_EMER = ''S''';
  END IF;
  if (upper(solicitacao_pmo) = 'S') then
    ds_comando_cursor_w := ds_comando_cursor_w || ' AND B.IE_RECEBE_SOLIC_PMO = ''S''';
  END IF;
  if (upper(build_fila) = 'S') then
    ds_comando_cursor_w := ds_comando_cursor_w || ' AND B.IE_RECEBE_BUILD_QUEUE = ''S''';
  END IF;

  C010 := DBMS_SQL.OPEN_CURSOR;
  DBMS_SQL.PARSE(C010, ds_comando_cursor_w, dbms_sql.Native);
  DBMS_SQL.DEFINE_COLUMN(C010, 1, ds_email,2000);
  retorno_w := DBMS_SQL.execute(c010);

  while( DBMS_SQL.FETCH_ROWS(C010) > 0 ) loop
    DBMS_SQL.COLUMN_VALUE(C010, 1, ds_email);
    l_text := l_text || ';' || ds_email;
  end loop;
  DBMS_SQL.CLOSE_CURSOR(C010);
  RETURN LTRIM(l_text, ';');
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_users_build (build_pendente text default 'N', liberacao_build text default 'N', solicitacao_emer text default 'N', solicitacao_pmo text default 'N', build_fila text default 'N') FROM PUBLIC;

