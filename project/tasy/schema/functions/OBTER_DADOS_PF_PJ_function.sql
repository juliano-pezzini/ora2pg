-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_pf_pj ( cd_pessoa_fisica_p text, cd_cgc_p text, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


ds_retorno_w			varchar(255)  := null;
nr_seq_pessoa_endereco_w	pessoa_juridica.nr_seq_pessoa_endereco%type;
ds_complemento_w		pessoa_juridica.ds_complemento%type;
nr_seq_ident_cnes_w		pessoa_juridica.nr_seq_ident_cnes%type;
cd_cnes_w			pessoa_juridica.cd_cnes%type;
nr_seq_pais_w			pessoa_juridica.nr_seq_pais%type;
cd_pf_resp_tecnico_w		pessoa_juridica.cd_pf_resp_tecnico%type;
nr_seq_pj_conta_w		pessoa_juridica_conta.nr_sequencia%type;
cd_banco_w			pessoa_juridica_conta.cd_banco%type;
nr_agencia_w			pessoa_juridica_conta.cd_agencia_bancaria%type;
nr_conta_w			pessoa_juridica_conta.nr_conta%type;
ie_digito_agencia_w		pessoa_juridica_conta.ie_digito_agencia%type;
nr_digito_conta_w		pessoa_juridica_conta.nr_digito_conta%type;
cd_municipio_ibge_w		pessoa_juridica.cd_municipio_ibge%type;
ds_endereco_w			compl_pessoa_fisica.ds_endereco%type;
nr_endereco_w			pessoa_juridica.nr_endereco%type;
ds_bairro_w			compl_pessoa_fisica.ds_bairro%type;
ds_municipio_w			compl_pessoa_fisica.ds_municipio%type;
ds_estado_w			pessoa_endereco_item.ds_valor%type;
cd_cep_w			compl_pessoa_fisica.cd_cep%type;
sg_estado_w			compl_pessoa_fisica.sg_estado%type;


BEGIN
	if (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') then
		return obter_compl_pf(cd_pessoa_fisica_p, 1, ie_opcao_p);
	else
		begin
		
			select	a.nr_seq_pessoa_endereco,
				a.ds_complemento,
				a.ds_endereco,
				a.nr_endereco,
				a.ds_bairro,
				a.sg_estado,
				a.ds_municipio,
				a.nr_seq_ident_cnes,
				a.cd_cnes,
				a.cd_municipio_ibge,
				a.cd_cep,
				a.nr_seq_pais,
				a.cd_pf_resp_tecnico
			into STRICT	nr_seq_pessoa_endereco_w,
				ds_complemento_w,
				ds_endereco_w,
				nr_endereco_w,
				ds_bairro_w,
				sg_estado_w,
				ds_municipio_w,
				nr_seq_ident_cnes_w,
				cd_cnes_w,
				cd_municipio_ibge_w,
				cd_cep_w,
				nr_seq_pais_w,
				cd_pf_resp_tecnico_w
			FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
			
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
				
					select	street,
						house_number,
						complement,
						neighborhood,
						city,
						stateName,
						postalCode,
						stateCode
					into STRICT	ds_endereco_w,
						nr_endereco_w,
						ds_complemento_w,
						ds_bairro_w,
						ds_municipio_w,
						ds_estado_w,
						cd_cep_w,
						sg_estado_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
					
			end if;
			
			if (ie_opcao_p = 'N') then
			
				select	a.ds_razao_social
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'F') then
			
				select	a.nm_fantasia
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'T') then
			
				select	a.nr_telefone
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
			
			elsif (ie_opcao_p = 'CI') then
				
				select	a.ds_municipio
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;	
				
			elsif (ie_opcao_p = 'R') then
				
				select	a.ds_endereco
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'UF') then
				
				select	a.sg_estado
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'CEP') then
				
				ds_retorno_w := cd_cep_w;
				
			elsif (ie_opcao_p = 'B') then
			
				select	a.ds_bairro
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'OE') then
				
				select	a.cd_operadora_empresa
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'E') then
			
				if (ds_complemento_w IS NOT NULL AND ds_complemento_w::text <> '') then
					ds_retorno_w :=  ds_endereco_w || ', ' || nr_endereco_w || ', ' || ds_complemento_w;
				else
					ds_retorno_w :=  ds_endereco_w || ', ' || nr_endereco_w;
				end if;
				
			elsif (ie_opcao_p = 'EN') then
				
				ds_retorno_w := ds_endereco_w;
				
			elsif (ie_opcao_p = 'EC') then
			
				ds_retorno_w := ds_endereco_w ||', ' || nr_endereco_w || ', ' || ds_complemento_w || ', ' || ds_bairro_w || ', ' || sg_estado_w;
				
			elsif (ie_opcao_p = 'ECM') then
			
				ds_retorno_w := ds_endereco_w ||', ' || nr_endereco_w || ', ' || ds_bairro_w || ' ' || ds_complemento_w || ', ' || ds_municipio_w || ', ' || sg_estado_w;
				
			elsif (ie_opcao_p = 'ES') then
				
				ds_retorno_w := ds_endereco_w ||', ' || nr_endereco_w || ', ' || ds_bairro_w || ', ' || ds_complemento_w;
				
			elsif (ie_opcao_p = 'NR') then
			
				ds_retorno_w := nr_endereco_w;
				
			elsif (ie_opcao_p = 'CO') then
			
				ds_retorno_w := ds_complemento_w;
				
			elsif (ie_opcao_p = 'M') then
				
				select	a.ds_email
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'C') then
			
				select	a.cd_cgc
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'FAX') then
				
				select	a.nr_fax
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'IE') then
				
				select	a.nr_inscricao_estadual
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'IM') then
			
				select	a.nr_inscricao_municipal
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'VL') then
			
				select	coalesce(a.vl_minimo_nf,0)
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'RE') then
				
				select	a.ie_forma_revisao
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'TP') then
				
				select	a.cd_tipo_pessoa
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'LO') then
			
				select	c.ds_tipo_logradouro
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'EV') then
				
				ds_retorno_w := ds_endereco_w || ', ' || nr_endereco_w || ', ' || ds_complemento_w;
				
				if (substr(ds_retorno_w, length(ds_retorno_w) - 1, length(ds_retorno_w)) = ', ') then
					ds_retorno_w :=	substr(ds_retorno_w, 1, length(ds_retorno_w) - 2);
				end if;
				
			elsif (ie_opcao_p = 'TPD') then
				
				select	b.ds_tipo_pessoa
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'ANS') then
				
				select	a.cd_ans
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'CNES') then
			
				if (nr_seq_ident_cnes_w IS NOT NULL AND nr_seq_ident_cnes_w::text <> '') then
					select	CASE WHEN coalesce(max(cd_cnes)::text, '') = '' THEN  cd_cnes_w  ELSE max(cd_cnes) END
					into STRICT	ds_retorno_w
					from	cnes_identificacao
					where	nr_sequencia	= nr_seq_ident_cnes_w;
				end if;
				
			elsif (ie_opcao_p = 'CINT') then
			
				select	a.cd_internacional
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'P') then
				
				select	a.nr_seq_pais
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'ABV') then
			
				select	a.ds_nome_abrev
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'PLS') then
				
				select	a.nr_registro_pls
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'CDM') then
				
				ds_retorno_w := cd_municipio_ibge_w;
				
			elsif (ie_opcao_p = 'CDMDV') then
			
				if (cd_municipio_ibge_w IS NOT NULL AND cd_municipio_ibge_w::text <> '') then
					ds_retorno_w := substr(cd_municipio_ibge_w || substr(calcula_digito('MODULO10',cd_municipio_ibge_w),1,1),1,255);
				end if;
				
			elsif (ie_opcao_p = 'DIT') then
			
				select	a.nr_ddi_telefone
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'DDT') then
				
				select	a.nr_ddd_telefone
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'DIF') then
				
				select	a.nr_ddi_fax
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'DDF') then
				
				select	a.nr_ddd_fax
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'WS') then
			
				select	a.ds_site_internet
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'CTT') then
				
				select	a.nm_pessoa_contato
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'S') then
				
				select	a.ie_situacao
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'CNAE') then
				
				select	a.nr_seq_cnae
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'CCE') then
			
				ds_retorno_w := cd_cep_w || ' - ' || ds_municipio_w || ' - ' || sg_estado_w;
				
			elsif (ie_opcao_p = 'PAIS') then
			
				select	substr(obter_nome_pais(nr_seq_pais_w),1,200)
				into STRICT	ds_retorno_w
				;
				
			elsif (ie_opcao_p = 'ENCB') then
			
				select	substr(endereco,1,255)
				into STRICT	ds_retorno_w
				from (SELECT ds_endereco 	|| CASE WHEN coalesce(nr_endereco::text, '') = '' THEN ' - '  ELSE ', '|| to_char(nr_endereco) END  || ' ' || ds_complemento ||
											' ' || ds_bairro endereco
						 from	pessoa_juridica a
						 where	a.cd_cgc = cd_cgc_p
						 order	by a.cd_cgc desc) alias4 LIMIT 1;
				
			elsif (ie_opcao_p = 'RP') then
			
				select	substr(obter_nome_pf(cd_pessoa_fisica),0,255)
				into STRICT	ds_retorno_w
				from	pessoa_fisica
				where	cd_pessoa_fisica	= cd_pf_resp_tecnico_w;

			elsif (ie_opcao_p = 'CRP') then
			
				ds_retorno_w := cd_pf_resp_tecnico_w;
				
			elsif (ie_opcao_p = 'CCM') then
			
				select	a.nr_ccm
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'CDPAIS') then
			
				select	a.cd_bacen
				into STRICT	ds_retorno_w
				from	pais a,
					pessoa_juridica p
				where	a.nr_sequencia = p.nr_seq_pais
				and 	a.nr_sequencia = nr_seq_pais_w
				and	p.cd_cgc = cd_cgc_p;

			elsif (ie_opcao_p = 'ME') then
			
				ds_retorno_w := ds_municipio_w || ' - ' || sg_estado_w;
				
			elsif (ie_opcao_p = 'TT') then
			
				select	a.ie_tipo_tributacao
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'NASM') then
			
				select	a.nr_alvara_sanitario_munic
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'EP') then
			
				if (ds_endereco_w IS NOT NULL AND ds_endereco_w::text <> '') then
					ds_retorno_w := ds_retorno_w || ', '|| ds_endereco_w;
				end if;
				
				if (nr_endereco_w IS NOT NULL AND nr_endereco_w::text <> '') then
					ds_retorno_w := ds_retorno_w || ', '|| nr_endereco_w;
				end if;
				
				if (ds_complemento_w IS NOT NULL AND ds_complemento_w::text <> '') then
					ds_retorno_w := ds_retorno_w || ', ' || ds_complemento_w;
				end if;
				
				if (ds_bairro_w IS NOT NULL AND ds_bairro_w::text <> '') then
					ds_retorno_w := ds_retorno_w || ', ' || ds_bairro_w;
				end if;
				
				if (ds_municipio_w IS NOT NULL AND ds_municipio_w::text <> '') then
					ds_retorno_w := ds_retorno_w || ', ' || ds_municipio_w;
				end if;
				
				if (cd_cep_w IS NOT NULL AND cd_cep_w::text <> '') then
					ds_retorno_w := ds_retorno_w || ', ' || cd_cep_w;
				end if;
				
				if (sg_estado_w IS NOT NULL AND sg_estado_w::text <> '') then
					ds_retorno_w := ds_retorno_w || ', ' || sg_estado_w;
				end if;
				
				ds_retorno_w := substr(ds_retorno_w,2,255);

			elsif (ie_opcao_p = 'SNR') then
				
				select	a.ds_endereco
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'RFC') then
				
				select	a.cd_rfc
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'CURP') then
				
				select	a.cd_curp
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p = 'CSA') then
				
				select	a.cd_sistema_ant
				into STRICT	ds_retorno_w
				FROM tipo_pessoa_juridica b, pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro c ON (a.nr_seq_tipo_logradouro = c.nr_sequencia)
WHERE a.cd_tipo_pessoa		= b.cd_tipo_pessoa  and a.cd_cgc			= cd_cgc_p;
				
			elsif (ie_opcao_p in ('UB','UA','UCC','UAD','UCCD')) then
			
				select 	max(nr_sequencia)
				into STRICT	nr_seq_pj_conta_w
				from 	pessoa_juridica_conta
				where 	cd_cgc = cd_cgc_p;

				if (nr_seq_pj_conta_w IS NOT NULL AND nr_seq_pj_conta_w::text <> '') then
					
					select 	cd_banco,
						cd_agencia_bancaria,
						nr_conta,
						ie_digito_agencia,
						nr_digito_conta
					into STRICT	cd_banco_w,
						nr_agencia_w,
						nr_conta_w,
						ie_digito_agencia_w,
						nr_digito_conta_w
					from 	pessoa_juridica_conta
					where 	nr_sequencia = nr_seq_pj_conta_w;
					
				end if;

				if (ie_opcao_p = 'UB') then
					ds_retorno_w := cd_banco_w;
				elsif (ie_opcao_p = 'UA') then
					ds_retorno_w := nr_agencia_w;
				elsif (ie_opcao_p = 'UCC') then
					ds_retorno_w := nr_conta_w;
				elsif (ie_opcao_p = 'UAD') then
					ds_retorno_w := nr_agencia_w || ie_digito_agencia_w;
				elsif (ie_opcao_p = 'UCCD') then
					ds_retorno_w := nr_conta_w || nr_digito_conta_w;
				end if;
				
			elsif (ie_opcao_p = 'DS_UF') then
			
				if (coalesce(ds_estado_w::text, '') = '') and (sg_estado_w IS NOT NULL AND sg_estado_w::text <> '') then
					ds_retorno_w := obter_valor_dominio(50, sg_estado_w);
				end if;

			elsif (ie_opcao_p = 'RFR') then
				
				select	max(cd_regime_fiscal)
				into STRICT	ds_retorno_w
				from	pessoa_juridica
				where	cd_cgc			= cd_cgc_p;
				
			else
				ds_retorno_w := wheb_mensagem_pck.get_texto(456254);
			end if;
		exception
		when no_data_found or too_many_rows then
			ds_retorno_w := null;

		end;
	end if;
	
return ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_pf_pj ( cd_pessoa_fisica_p text, cd_cgc_p text, ie_opcao_p text) FROM PUBLIC;

