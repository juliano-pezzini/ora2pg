-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_resultado_escala_tev_md ( ie_clinico_cirurgico_p text, ie_risco_p text, ie_risco_reclassif_p text, qt_idade_p bigint, ie_mobilidade_reduzida_p text, qt_reg_p bigint, qt_peso_p bigint, qt_clearence_p bigint, qt_contra_indicacao_p bigint, qt_imc_p bigint, qt_contra_prof_mec_p bigint, ie_bariatrica_p text, qt_absoluta_p bigint, qt_relativa_p bigint, ie_cir_grande_medio_porte_p text, ie_artroplastia_quadril_p text, ie_artroplastia_joelho_p text, ie_fratura_quadril_p text, ie_trauma_medular_p text, ie_politrauma_p text, ie_oncol_curativa_p text ) RETURNS bigint AS $body$
DECLARE

  nr_seq_resposta_w bigint := 0;

BEGIN
    if (ie_clinico_cirurgico_p = 'C') then
	
		if (ie_risco_p = 'N') then
		  nr_seq_resposta_w := 71;
		end if;	

		if (coalesce(ie_risco_reclassif_p, ie_risco_p) = 'B') then
		  if (qt_idade_p >= 40) and (ie_mobilidade_reduzida_p = 'S') and (qt_reg_p = 0) then
		    nr_seq_resposta_w := 69;
		  elsif (qt_idade_p <= 40) and (ie_mobilidade_reduzida_p = 'S') then
		    nr_seq_resposta_w := 73;
		  else	
		    nr_seq_resposta_w := 74;
		  end if;			

		elsif (coalesce(ie_risco_reclassif_p, ie_risco_p) = 'A') then
		  if ((qt_idade_p > 75) or (qt_peso_p < 50) or (qt_clearence_p < 30)) then
		    if (qt_contra_indicacao_p > 0) and (qt_contra_prof_mec_p > 0) then
		      nr_seq_resposta_w := 63;
		    elsif (qt_contra_indicacao_p > 0) then
		      nr_seq_resposta_w := 64;
		    else	
		      nr_seq_resposta_w := 59;
		    end if;
		  elsif (qt_imc_p > 40) then
		    nr_seq_resposta_w := 58;
		  else	
		    if (qt_contra_indicacao_p > 0) and (qt_contra_prof_mec_p > 0) then
		      nr_seq_resposta_w := 62;
		    elsif (qt_contra_indicacao_p > 0) then
		      nr_seq_resposta_w := 75;
		    else	
		      nr_seq_resposta_w := 58;
		    end if;
		  end if;
		end if;	
		
    elsif (ie_clinico_cirurgico_p = 'I') then
	
		if (ie_risco_p = 'B') then
		  nr_seq_resposta_w := 7;
		elsif (ie_risco_p = 'M') then
		  if (ie_bariatrica_p = 'S') then
		    if (qt_contra_prof_mec_p > 0) and (qt_absoluta_p > 0) then
		      nr_seq_resposta_w := 15;
		    elsif (qt_contra_prof_mec_p > 0) and (qt_relativa_p > 0) then
		      nr_seq_resposta_w := 14;
		    elsif (qt_absoluta_p > 0) then
		      nr_seq_resposta_w := 13;
		    elsif (qt_relativa_p > 0) then
		      nr_seq_resposta_w := 38;
		    else
		      nr_seq_resposta_w := 9;
		    end if;	
		  else
		    if (qt_contra_prof_mec_p > 0) and (qt_absoluta_p > 0) then
		      nr_seq_resposta_w := 5;
		    elsif (qt_contra_prof_mec_p > 0) and (qt_relativa_p > 0) then
		      nr_seq_resposta_w := 6;
		    elsif (qt_absoluta_p > 0) then
		      nr_seq_resposta_w := 3;
		    elsif (qt_relativa_p > 0) then
		      nr_seq_resposta_w := 4;
		    else
		      nr_seq_resposta_w := 1;
		    end if;
		  end if;
		elsif (ie_risco_p = 'A') then
		  if (ie_cir_grande_medio_porte_p = 'S') then
		    if (ie_bariatrica_p = 'S') then
			  if (qt_contra_prof_mec_p > 0) and (qt_absoluta_p > 0) then
				nr_seq_resposta_w := 15;
			  elsif (qt_contra_prof_mec_p > 0) and (qt_relativa_p > 0) then
				nr_seq_resposta_w := 14;
			  elsif (qt_absoluta_p > 0) then
				nr_seq_resposta_w := 13;
			  elsif (qt_relativa_p > 0) then
				nr_seq_resposta_w := 38;
			  else
				nr_seq_resposta_w := 39;
			  end if;			
			else
			  if (qt_contra_prof_mec_p > 0) and (qt_absoluta_p > 0) then
				nr_seq_resposta_w := 15;
			  elsif (qt_contra_prof_mec_p > 0) and (qt_relativa_p > 0) then
			    nr_seq_resposta_w := 14;
			  elsif (qt_absoluta_p > 0) then
				nr_seq_resposta_w := 13;
			  elsif (qt_relativa_p > 0) then
				nr_seq_resposta_w := 12;
			  else
				nr_seq_resposta_w := 9;
			  end if;
			end if;
		  elsif (ie_artroplastia_quadril_p = 'S') then
		    if (qt_clearence_p < 30) then
			  if (qt_contra_prof_mec_p > 0) and (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 15;
		      elsif (qt_contra_prof_mec_p > 0) and (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 14;
		      elsif (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 13;
		      elsif (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 18;
		      else
		        nr_seq_resposta_w := 42;
		      end if;
			elsif (qt_idade_p > 75) or (qt_clearence_p between 30 and 50) or (qt_peso_p < 50) then
			  if (qt_contra_prof_mec_p > 0) and (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 15;
		      elsif (qt_contra_prof_mec_p > 0) and (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 14;
		      elsif (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 13;
		      elsif (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 20;
		      else
		        nr_seq_resposta_w := 41;
		      end if;
		    else
			  if (qt_contra_prof_mec_p > 0) and (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 15;
		      elsif (qt_contra_prof_mec_p > 0) and (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 14;
		      elsif (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 13;
		      elsif (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 16;
		      else
		        nr_seq_resposta_w := 40;
		      end if;
		    end if;
		  elsif (ie_artroplastia_joelho_p = 'S') then
		    if (qt_clearence_p < 30) then
			  if (qt_contra_prof_mec_p > 0) and (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 15;
		      elsif (qt_contra_prof_mec_p > 0) and (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 14;
		      elsif (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 13;
		      elsif (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 23;
		      else
		        nr_seq_resposta_w := 46;
		      end if;
			elsif (qt_idade_p> 75) or (qt_clearence_p between 30 and 50) or (qt_peso_p < 50) then
			  if (qt_contra_prof_mec_p > 0) and (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 15;
		      elsif (qt_contra_prof_mec_p > 0) and (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 14;
		      elsif (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 13;
		      elsif (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 24;
		      else
		        nr_seq_resposta_w := 45;
		      end if;
		    else
			  if (qt_contra_prof_mec_p > 0) and (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 15;
		      elsif (qt_contra_prof_mec_p > 0) and (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 14;
		      elsif (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 13;
		      elsif (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 22;
		      else
		        nr_seq_resposta_w := 44;
		      end if;
			end if;
		  elsif (ie_fratura_quadril_p = 'S') then
		    if (qt_idade_p> 75) or (qt_clearence_p <30) or (qt_peso_p < 50) then
			  if (qt_contra_prof_mec_p > 0) and (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 15;
		      elsif (qt_contra_prof_mec_p > 0) and (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 14;
		      elsif (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 13;
		      elsif (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 27;
		      else
		        nr_seq_resposta_w := 49;
		      end if;
			else
			  if (qt_contra_prof_mec_p > 0) and (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 15;
		      elsif (qt_contra_prof_mec_p > 0) and (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 14;
		      elsif (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 13;
		      elsif (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 26;
		      else
		        nr_seq_resposta_w := 48;
		      end if;
			end if;
		  elsif (ie_trauma_medular_p = 'S') then
		    if (qt_idade_p> 75) or (qt_clearence_p <30) or (qt_peso_p < 50) then
			  if (qt_contra_prof_mec_p > 0) and (qt_absoluta_p > 0) then
			    nr_seq_resposta_w := 15;
			  elsif (qt_contra_prof_mec_p > 0) and (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 14;
		      elsif (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 13;
		      elsif (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 29;
		      else
		        nr_seq_resposta_w := 51;
		      end if;
		    else
			  if (qt_contra_prof_mec_p > 0) and (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 15;
			  elsif (qt_contra_prof_mec_p > 0) and (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 14;
		      elsif (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 13;
		      elsif (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 28;
		      else
		        nr_seq_resposta_w := 50;
		      end if;
			end if;
		  elsif (ie_politrauma_p = 'S') then
		    if (qt_idade_p> 75) or (qt_clearence_p < 30) or (qt_peso_p < 50) then
			  if (qt_contra_prof_mec_p > 0) and (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 15;
		      elsif (qt_contra_prof_mec_p > 0) and (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 14;
		      elsif (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 13;
		      elsif (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 35;
		      else
		        nr_seq_resposta_w := 53;
		      end if;
			else
			  if (qt_contra_prof_mec_p > 0) and (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 15;
		      elsif (qt_contra_prof_mec_p > 0) and (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 14;
		      elsif (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 13;
		      elsif (qt_relativa_p > 0) then
		        nr_seq_resposta_w := 30;
		      else
		        nr_seq_resposta_w := 52;
		      end if;
			end if;
		  elsif (ie_oncol_curativa_p = 'S') then
		    if (qt_idade_p> 75) or (qt_clearence_p < 30) or (qt_peso_p < 50) then
			  if (qt_contra_prof_mec_p > 0) and (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 15;
		      elsif (qt_contra_prof_mec_p > 0) and (qt_relativa_p > 0) then
				nr_seq_resposta_w := 14;
			  elsif (qt_absoluta_p > 0) then
				nr_seq_resposta_w := 13;
			  elsif (qt_relativa_p > 0) then
				nr_seq_resposta_w := 37;
			  else
				nr_seq_resposta_w := 55;
			  end if;
			else
			  if (qt_contra_prof_mec_p > 0) and (qt_absoluta_p > 0) then
		        nr_seq_resposta_w := 15;
			  elsif (qt_contra_prof_mec_p > 0) and (qt_relativa_p > 0) then
				nr_seq_resposta_w := 14;
			  elsif (qt_absoluta_p > 0) then
				nr_seq_resposta_w := 13;
			  elsif (qt_relativa_p > 0) then
				nr_seq_resposta_w := 36;
			  else
				nr_seq_resposta_w := 54;
			  end if;
			end if;
		  end if;
		end if;	
	end if;
	return nr_seq_resposta_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_resultado_escala_tev_md ( ie_clinico_cirurgico_p text, ie_risco_p text, ie_risco_reclassif_p text, qt_idade_p bigint, ie_mobilidade_reduzida_p text, qt_reg_p bigint, qt_peso_p bigint, qt_clearence_p bigint, qt_contra_indicacao_p bigint, qt_imc_p bigint, qt_contra_prof_mec_p bigint, ie_bariatrica_p text, qt_absoluta_p bigint, qt_relativa_p bigint, ie_cir_grande_medio_porte_p text, ie_artroplastia_quadril_p text, ie_artroplastia_joelho_p text, ie_fratura_quadril_p text, ie_trauma_medular_p text, ie_politrauma_p text, ie_oncol_curativa_p text ) FROM PUBLIC;

