-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_dia_util_oncologia (dt_referencia_p timestamp, cd_estabelecimento_p bigint, nm_usuario_p text, ie_tipo_atendimento_p bigint default null, cd_protocolo_p bigint default null, nr_seq_medicacao_p bigint default null) RETURNS varchar AS $body$
DECLARE


    ie_dia_semana_w	 varchar(01);
    ie_feriado_w     varchar(01);
    ie_dia_util_w    varchar(01)	:= 'N';
    vl_parametro_w	 varchar(255);
    vl_parametro_ww  varchar(255) := null;
    EXEC_w           varchar(200);

BEGIN
    select coalesce(obter_valor_param_usuario(281, 92, Obter_Perfil_Ativo, nm_usuario_p, cd_estabelecimento_p),'TD')
    into STRICT	 vl_parametro_w
;

    select obter_regra_dia_gera_ciclo(ie_tipo_atendimento_p,Obter_Perfil_Ativo,'',nm_usuario_p, cd_protocolo_p, nr_seq_medicacao_p)
    into STRICT   vl_parametro_ww
;

    ie_dia_semana_w := to_char(pkg_date_utils.get_WeekDay(dt_referencia_p));

    select coalesce(max('S'), 'N')
    into STRICT   ie_feriado_w
    from   feriado
    where  dt_feriado		between trunc(dt_referencia_p) and trunc(dt_referencia_P) + 86399/86400
    and	cd_estabelecimento	= cd_estabelecimento_p;

    begin
      EXEC_w := 'CALL OBTER_SE_DIA_UTIL_ONCOLOG_MD(:1,:2,:3,:4) INTO :result';
			
      EXECUTE EXEC_w USING IN vl_parametro_w,
                                     IN vl_parametro_ww,
                                     IN ie_dia_semana_w,
                                     IN ie_feriado_w,
                                     OUT ie_dia_util_w;
    exception
       when others then
          ie_dia_util_w := null;
    end;

    return ie_dia_util_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_dia_util_oncologia (dt_referencia_p timestamp, cd_estabelecimento_p bigint, nm_usuario_p text, ie_tipo_atendimento_p bigint default null, cd_protocolo_p bigint default null, nr_seq_medicacao_p bigint default null) FROM PUBLIC;

