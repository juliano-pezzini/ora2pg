-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_exibe_evol_soap ( ie_evol_clinica_p text, ie_soap_p text) RETURNS varchar AS $body$
DECLARE

	
	retorno_w	varchar(1) := 'N';	
				

BEGIN

if (coalesce(trim(both ie_evol_clinica_p)::text, '') = '') then -- OS 1874257 - Santa Luiza, usuários não estavam informadno o tipo de evolução
	return 'S';
end if;

select	coalesce(max('S'),'N')
into STRICT	retorno_w
from	tipo_evolucao a
where	a.cd_tipo_evolucao = ie_evol_clinica_p
and		coalesce(IE_EVOLUCAO_SOAP,'N') = 'S';

if (retorno_w = 'N') then
	if (ie_soap_p = 'S') then  --Subjective
		select	coalesce(max('S'),'N')
		into STRICT	retorno_w
		from	tipo_evolucao a
		where	a.cd_tipo_evolucao = ie_evol_clinica_p
		and		coalesce(a.ie_evolucao_exame_fisico,'N') = 'N'
		and 	coalesce(a.ie_evolucao_soap,'N') = 'N';

	elsif (ie_soap_p = 'O') then
		
		select	coalesce(max('S'),'N')
		into STRICT	retorno_w
		from	tipo_evolucao a
		where	a.cd_tipo_evolucao = ie_evol_clinica_p
		and		coalesce(a.ie_evolucao_subjetivo,'N') = 'N'
		and 	coalesce(a.ie_evolucao_soap,'N') = 'N';
		
	else
		
		select	coalesce(max('S'),'N') 
		into STRICT	retorno_w
		from	tipo_evolucao a
		where	a.cd_tipo_evolucao = ie_evol_clinica_p
		and		coalesce(a.ie_evolucao_subjetivo,'N') = 'N'
		and 	coalesce(a.ie_evolucao_exame_fisico,'N') = 'N';
		
	end if;
end if;
	
return retorno_w;		

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_exibe_evol_soap ( ie_evol_clinica_p text, ie_soap_p text) FROM PUBLIC;

