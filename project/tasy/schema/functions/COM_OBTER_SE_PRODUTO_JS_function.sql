-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION com_obter_se_produto_js (nr_seq_solic_sd_p bigint, nr_seq_modulo_p bigint) RETURNS varchar AS $body$
DECLARE


ie_produto_w		varchar(14);
ie_prod_convertido_w	varchar(14);
ie_possui_mod_w		varchar(1):= 'S';


BEGIN

/*
EQUIVALENCIA DO DOMINIO 2668 (CAMPO IE_PRODUTO DA TABELA COM_CLIENTE, FUNÇÃO GESTÃO COMERCIAL PHILIPS) COM O CAMPO IE_CLASSIF_PRODUTO ()(P,O,R,C,A)(Prestador,Operadora,RIS,PACS,Ambos)  DA TABELA FUNCAO USADA NA FUNÇÃO GESTÃO DE PRODUTOS PHILIPS

DOMINIO 2668                       IE_CLASSIF_PRODUTO

iSITE 4.1   I                                        C
Multimed  M	                   R
MMED Diagnostico MD	                   R
DCX          MDC	                  C
Tasy Operadora O	                  O
Tasy Prestador P	                  P
*/
if (coalesce(nr_seq_solic_sd_p,0) > 0) and (coalesce(nr_seq_modulo_p,0) > 0) then

	select 	ie_produto
	into STRICT	ie_produto_w
	from	com_cliente a, com_solic_sd b
	where	b.nr_sequencia = nr_seq_solic_sd_p
	and 	a.nr_sequencia = b.nr_seq_cliente;

	if (ie_produto_w = 'I') then
		ie_prod_convertido_w := 'C';
	elsif (ie_produto_w = 'M') then
		ie_prod_convertido_w := 'R';
	elsif (ie_produto_w = 'MD') then
		ie_prod_convertido_w := 'R';
	elsif (ie_produto_w = 'MDC') then
		ie_prod_convertido_w := 'C';
	elsif (ie_produto_w = 'O') then
		ie_prod_convertido_w := 'O';
	elsif (ie_produto_w = 'P') then
		ie_prod_convertido_w := 'P';
	end if;

	select	CASE WHEN count(*)=0 THEN 'N'  ELSE 'S' END
	into STRICT	ie_possui_mod_w
	from	funcao
	where	nr_seq_mod_impl = nr_seq_modulo_p
	and	((ie_classif_produto = ie_prod_convertido_w) or (ie_classif_produto = 'A'));

end if;

return	ie_possui_mod_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION com_obter_se_produto_js (nr_seq_solic_sd_p bigint, nr_seq_modulo_p bigint) FROM PUBLIC;

