-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION check_diagnosis_is_recurrence ( cd_pessoa_fisica_p pe_prescricao.cd_pessoa_fisica%type, nr_seq_prescr_p bigint, nr_seq_diag_p bigint) RETURNS varchar AS $body$
DECLARE

    nr_count_w          bigint := 0;
    ds_retorno_w	    varchar(1) := 'N';

BEGIN
    select  count(*)
    into STRICT    nr_count_w
    from    pe_prescricao pp,
            pe_prescr_diag ppd
    where   ppd.nr_seq_prescr = pp.nr_sequencia
    and ((pp.dt_liberacao IS NOT NULL AND pp.dt_liberacao::text <> '') or (pp.dt_suspensao IS NOT NULL AND pp.dt_suspensao::text <> ''))
    and     (ppd.dt_end IS NOT NULL AND ppd.dt_end::text <> '')
    and     coalesce(wheb_assist_pck.get_nivel_atencao_perfil, 'T') = pp.ie_nivel_atencao
    and     pp.cd_pessoa_fisica = cd_pessoa_fisica_p
    and (coalesce(nr_seq_prescr_p::text, '') = '' or pp.nr_sequencia <> nr_seq_prescr_p)
    and     ppd.nr_seq_diag = nr_seq_diag_p;

    if (nr_count_w > 0) then
        ds_retorno_w := 'Y';
    end if;

	return ds_retorno_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION check_diagnosis_is_recurrence ( cd_pessoa_fisica_p pe_prescricao.cd_pessoa_fisica%type, nr_seq_prescr_p bigint, nr_seq_diag_p bigint) FROM PUBLIC;

