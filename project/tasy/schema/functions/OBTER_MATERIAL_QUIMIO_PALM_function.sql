-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_material_quimio_palm (nr_seq_ordem_p bigint) RETURNS varchar AS $body$
DECLARE


ds_retorno_w		varchar(255);
ie_exibe_sem_apresent_w varchar(1);
nr_sequencia_w		bigint;


BEGIN
ie_exibe_sem_apresent_w := Obter_Param_Usuario(3130, 180, obter_perfil_ativo, wheb_usuario_pck.get_nm_usuario, wheb_usuario_pck.get_cd_estabelecimento, ie_exibe_sem_apresent_w);

if (ie_exibe_sem_apresent_w = 'S') then
	select 	max(substr(obter_desc_material(b.cd_material),1,100))
	into STRICT	ds_retorno_w
	from   	material e,
		paciente_atend_medic b,
		prescr_material c,
		can_ordem_prod d
	where  	c.nr_seq_atendimento 	= b.nr_seq_atendimento
	and    	c.nr_seq_material	= b.nr_seq_material
	and	c.nr_prescricao  	= d.nr_prescricao
	and	c.nr_seq_ordem_prod  	= d.nr_sequencia
	and 	e.cd_material		= c.cd_material
	and	e.ie_mistura 		= 'S'
	and 	d.nr_sequencia 		= nr_seq_ordem_p;

	if (coalesce(ds_retorno_w::text, '') = '') then

		select	min(nr_sequencia)
		into STRICT	nr_sequencia_w
		from	can_ordem_item_prescr
		where	nr_seq_ordem	= nr_seq_ordem_p
		and	coalesce(nr_sequencia_diluente::text, '') = '';

		select	distinct
			max(substr(obter_desc_material(a.cd_material),1,60))
		into STRICT	ds_retorno_w
		from	material b,
			can_ordem_item_prescr a
		where	b.cd_material	= a.cd_material
		and 	ie_mistura	= 'S'
		and 	a.nr_sequencia	= nr_sequencia_w;
	end if;
end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_material_quimio_palm (nr_seq_ordem_p bigint) FROM PUBLIC;

