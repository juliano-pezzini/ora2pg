-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION com_obter_dados_ofic_uso ( nr_seq_cliente_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE

 
/* ie_opcao_p 
C - Cliente 
W - Wheb 
P - Produto 
S - SequÃªncia dos clientes com o mesmo cnpj 
*/
 
 
nm_pf_cliente_w		varchar(80);
nm_pf_wheb_w		varchar(80);
ds_produto_w		varchar(80);
cd_cnpj_w		varchar(14);
nr_sequencia_w		bigint;
ds_retorno_w		varchar(255) := '';

c01 CURSOR FOR 
SELECT	a.nr_sequencia 
from	com_cliente a 
where	a.cd_cnpj = cd_cnpj_w;


BEGIN 
select	substr(obter_nome_pf(a.cd_pf_cliente),1,80), 
	substr(obter_nome_pf(a.cd_pf_wheb),1,80) 
into STRICT	nm_pf_cliente_w, 
	nm_pf_wheb_w 
from	com_cli_ofic_uso a 
where	a.nr_sequencia = (	SELECT	max(x.nr_sequencia) 
				from	com_cli_ofic_uso x 
				where	x.nr_seq_cliente = nr_seq_cliente_p);
 
if (coalesce(ie_opcao_p,'X') = 'C') then 
	return nm_pf_cliente_w;
elsif (coalesce(ie_opcao_p,'X') = 'W') then 
	return nm_pf_wheb_w;
elsif (coalesce(ie_opcao_p,'X') = 'P') then 
	begin 
	select	obter_valor_dominio(2668,a.ie_produto) 
	into STRICT	ds_produto_w 
	from	com_cliente a 
	where	a.nr_sequencia = nr_seq_cliente_p;
	return ds_produto_w;
	end;
elsif (coalesce(ie_opcao_p,'X') = 'S') then 
	begin 
	select	max(coalesce(a.cd_cnpj,'X')) 
	into STRICT	cd_cnpj_w 
	from	com_cliente a 
	where	a.nr_sequencia = nr_seq_cliente_p;
	if (cd_cnpj_w <> 'X') then 
		begin 
		open C01;
		loop 
		fetch C01 into	 
			nr_sequencia_w;
		EXIT WHEN NOT FOUND; /* apply on C01 */
			begin 
			ds_retorno_w := (ds_retorno_w || nr_sequencia_w || ',');
			end;
		end loop;
		close C01;
		ds_retorno_w := ( '(' || ds_retorno_w || '0)' );
		end;
	else	ds_retorno_w := '(0)';
	end if;
	return ds_retorno_w;
	end;
end if;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION com_obter_dados_ofic_uso ( nr_seq_cliente_p bigint, ie_opcao_p text) FROM PUBLIC;

