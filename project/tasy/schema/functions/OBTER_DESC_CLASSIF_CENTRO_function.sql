-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_desc_classif_centro ( cd_estabelecimento_p bigint, cd_classificacao_p text) RETURNS varchar AS $body$
DECLARE


ds_retorno_w centro_custo.ds_centro_custo%type;


BEGIN

begin
    select  x.ds_centro_custo
    into STRICT    ds_retorno_w
    from (
    SELECT (
            case a.ie_situacao
            when 'A'
                then
                    case
                    when(a.cd_estabelecimento = coalesce(cd_estabelecimento_p,wheb_usuario_pck.get_cd_estabelecimento)) then 1
                    when(obter_empresa_estab(a.cd_estabelecimento) = obter_empresa_estab(coalesce(cd_estabelecimento_p,wheb_usuario_pck.get_cd_estabelecimento))) then 2
                    else 3
                    end
            else 4
            end
            ) ie_ordem,
            a.ds_centro_custo
    from    centro_custo a
    where   a.cd_classificacao = cd_classificacao_p
    and     a.cd_estabelecimento = coalesce(cd_estabelecimento_p, cd_estabelecimento)
    order by
        ie_ordem,
        cd_estabelecimento,
        cd_centro_custo
    ) x LIMIT 1;
exception
when no_data_found then
    ds_retorno_w := null;
end;

return ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_desc_classif_centro ( cd_estabelecimento_p bigint, cd_classificacao_p text) FROM PUBLIC;

