-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_data_referencia_proc (nr_atendimento_p bigint) RETURNS timestamp AS $body$
DECLARE


date_w 		timestamp := null;
ie_data_cid_w 	bigint := null;


BEGIN

begin
	select	a.ie_data_cid
	into STRICT 	ie_data_cid_w
	from 	parametro_atendimento a,
		atendimento_paciente b
	where 	a.cd_estabelecimento 	= b.cd_estabelecimento
	and	b.nr_atendimento	= nr_atendimento_p  LIMIT 1;
exception
when others then
	ie_data_cid_w	:= null;
end;

if 	(ie_data_cid_w IS NOT NULL AND ie_data_cid_w::text <> '') then
	if 	ie_data_cid_w = 1 then
		begin
		select	dt_entrada
		into STRICT 	date_w
		from 	atendimento_paciente
		where 	nr_atendimento 	= nr_atendimento_p  LIMIT 1;
		exception
		when others then
			date_w	:= null;
		end;
	elsif 	ie_data_cid_w = 2 then
		date_w	:= clock_timestamp();
	end if;
end if;

return date_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_data_referencia_proc (nr_atendimento_p bigint) FROM PUBLIC;

