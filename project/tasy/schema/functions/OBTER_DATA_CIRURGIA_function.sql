-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_data_cirurgia (cd_pessoa_fisica_p text) RETURNS timestamp AS $body$
DECLARE

 
dt_hr_inicio_W	timestamp;
dt_inicio_w	timestamp;
dt_final_w	timestamp;


BEGIN 
 
dt_inicio_w	:= clock_timestamp();
dt_final_w	:= clock_timestamp() + interval '180 days';
 
select	min(b.hr_inicio) 
into STRICT	dt_hr_inicio_w 
from  	agenda_paciente b, 
	agenda a 
where 	a.cd_agenda		= b.cd_agenda 
and	b.hr_inicio between dt_inicio_w and dt_final_w 
and	a.cd_tipo_agenda	= 1 
and	b.ie_status_agenda not in ('L','I','C','B','F') 
and	b.cd_pessoa_fisica 	= cd_pessoa_fisica_p;
 
RETURN	dt_hr_inicio_w;
 
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_data_cirurgia (cd_pessoa_fisica_p text) FROM PUBLIC;

