-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_cor_curativo ( cd_pessoa_ferida_p bigint, nr_seq_area_p bigint) RETURNS varchar AS $body$
DECLARE


ds_cor_w				varchar(15) := '';
nr_seq_ferida_w			bigint;
nr_seq_localizacao_w	bigint;
qt_score_w				bigint;
ie_pend_curativo_w		varchar(15);


BEGIN

if (cd_pessoa_ferida_p IS NOT NULL AND cd_pessoa_ferida_p::text <> '') and (nr_seq_area_p IS NOT NULL AND nr_seq_area_p::text <> '') then


	Select 	max(nr_seq_localizacao)
	into STRICT	nr_seq_localizacao_w
	from	area_imagem_item
	where	nr_seq_area = nr_seq_area_p;


	Select  max(a.nr_sequencia)
	into STRICT	nr_seq_ferida_w
	from	cur_ferida a
	where	a.cd_pessoa_fisica = cd_pessoa_ferida_p
	and		a.nr_seq_localizacao = nr_seq_localizacao_w;

	if (nr_seq_ferida_w IS NOT NULL AND nr_seq_ferida_w::text <> '') then

		ie_pend_curativo_w := obter_se_curativo_vencido(nr_seq_ferida_w);


		if (ie_pend_curativo_w = 'S') then

			ds_cor_w := obter_cor_cadastro(5296,obter_perfil_ativo,wheb_usuario_pck.get_cd_estabelecimento,1);

		else

			Select  max(qt_escore)
			into STRICT	qt_score_w
			from	cur_curativo
			where   nr_seq_ferida = nr_seq_ferida_w;

			if (qt_score_w	>=1) and (qt_score_w	<=12) then
				ds_cor_w := obter_cor_cadastro(5279,obter_perfil_ativo,wheb_usuario_pck.get_cd_estabelecimento,1);
			elsif (qt_score_w	>=13) and (qt_score_w	<=64) then
				ds_cor_w := obter_cor_cadastro(5280,obter_perfil_ativo,wheb_usuario_pck.get_cd_estabelecimento,1);
			elsif (qt_score_w	>= 65) then
				ds_cor_w := obter_cor_cadastro(5281,obter_perfil_ativo,wheb_usuario_pck.get_cd_estabelecimento,1);
			end if;

		end if;

	end if;

end if;

return ds_cor_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_cor_curativo ( cd_pessoa_ferida_p bigint, nr_seq_area_p bigint) FROM PUBLIC;

