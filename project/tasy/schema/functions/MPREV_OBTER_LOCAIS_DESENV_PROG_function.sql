-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION mprev_obter_locais_desenv_prog (nr_seq_programa_p bigint) RETURNS varchar AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
ds_retorno_w		varchar(255);
ds_municipio_w		varchar(255);
ds_estado_w		varchar(255);
ds_regiao_w		varchar(255);
ds_municipios_w		varchar(255);
ds_estados_w		varchar(255);
ds_regiaos_w		varchar(255);

C01 CURSOR FOR
	SELECT 	substr(obter_desc_municipio_ibge(cd_municipio_ibge),1,255) ds_municipio,
		substr(obter_valor_dominio(50,sg_uf_municipio),1,255) ds_estado,
		substr(pls_obter_descricao_regiao(nr_seq_regiao),1,255) ds_regiao
	from 	mprev_prog_area_atuacao
	where 	nr_seq_programa = nr_seq_programa_p;



BEGIN

	open C01;
	loop
	fetch C01 into
		ds_municipio_w,
		ds_estado_w,
		ds_regiao_w;
		EXIT WHEN NOT FOUND; /* apply on C01 */
		begin
			if (ds_municipio_w IS NOT NULL AND ds_municipio_w::text <> '') then
				ds_municipios_w := ds_municipios_w || ds_municipio_w || CHR(13) || CHR(10);
			elsif (ds_estado_w IS NOT NULL AND ds_estado_w::text <> '')then
				ds_estados_w 	:= ds_estados_w || ds_estado_w || CHR(13) || CHR(10);
			elsif (ds_regiao_w IS NOT NULL AND ds_regiao_w::text <> '') then
				ds_regiaos_w 	:= ds_regiaos_w || ds_regiao_w || CHR(13) || CHR(10);
			end if;
		end;
	end loop;
	close C01;

	if (ds_municipios_w IS NOT NULL AND ds_municipios_w::text <> '') then
		ds_retorno_w :=  obter_texto_tasy(249150, wheb_usuario_pck.get_nr_seq_idioma) || CHR(13) || CHR(10) || ds_municipios_w;
	end if;
	if (ds_estados_w IS NOT NULL AND ds_estados_w::text <> '')then
		ds_retorno_w 	:= ds_retorno_w || obter_texto_tasy(249151, wheb_usuario_pck.get_nr_seq_idioma) || CHR(13) || CHR(10) || ds_estados_w;
	end if;
	if (ds_regiaos_w IS NOT NULL AND ds_regiaos_w::text <> '') then
		ds_retorno_w 	:= ds_retorno_w || obter_texto_tasy(249152, wheb_usuario_pck.get_nr_seq_idioma) || CHR(13) || CHR(10) || ds_regiaos_w;
	end if;


return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION mprev_obter_locais_desenv_prog (nr_seq_programa_p bigint) FROM PUBLIC;

