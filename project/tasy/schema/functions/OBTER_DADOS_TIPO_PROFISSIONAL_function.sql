-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_tipo_profissional (nr_atendimento_p bigint, tipo_dado_p text) RETURNS varchar AS $body$
DECLARE


	ds_codigo_prof_w	pessoa_fisica.ds_codigo_prof%type;
	nr_crm_w		medico.nr_crm%type;
	retorno_w 		varchar(100);


BEGIN

  if (upper(tipo_dado_p) = 'CEDULA') then 
  begin
    select pf.ds_codigo_prof,
		       m.nr_crm
		into STRICT ds_codigo_prof_w,
		     nr_crm_w
		from pessoa_fisica pf, atendimento_paciente a, medico m
		where pf.cd_pessoa_fisica  = a.cd_medico_resp
		and pf.cd_pessoa_fisica  = m.cd_pessoa_fisica
		and a.nr_atendimento 	 =  nr_atendimento_p;

    select
		max(case 
			when profissional.ie_profissional in ('2','3','4','6','8')
			then coalesce(lpad(coalesce(ds_codigo_prof_w, nr_crm_w),8,0),0)   
			else '0'
		end)
		into STRICT retorno_w -- cedula_profissional_w
		from atend_profissional profissional 
		where profissional.nr_atendimento = nr_atendimento_p;

  end;
  elsif (upper(tipo_dado_p) = 'CODIGO') then
    select max(profissional.ie_profissional)
		into STRICT retorno_w -- tipo_profissional_w  
		from atend_profissional profissional 
		where profissional.nr_atendimento = nr_atendimento_p;

  elsif (upper(tipo_dado_p) = 'TIPO') then
    select max(CASE WHEN profissional.ie_profissional='12' THEN obter_desc_expressao(308221) END ) 
		into STRICT retorno_w -- ds_tipo_profissional_w
		from atend_profissional profissional 
		where profissional.nr_atendimento = nr_atendimento_p;
  else
      retorno_w := '';
end if;

return	retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_tipo_profissional (nr_atendimento_p bigint, tipo_dado_p text) FROM PUBLIC;

