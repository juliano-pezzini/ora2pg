-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dt_ini_fim_teste_proj ( NR_OS_ADERENCIA_P bigint, IE_TIPO_DT_P text) RETURNS timestamp AS $body$
DECLARE

  DT_ENC_W      timestamp  := NULL;
  DT_INI_W      timestamp  := NULL;
  PR_RETORNO_W	timestamp  := NULL;

BEGIN
  --DT_FIM
	BEGIN
    SELECT MAX(DT_FIM_REAL)
      INTO STRICT DT_ENC_W
      FROM MAN_ORDEM_SERVICO OS
     WHERE OS.NR_SEQUENCIA    = NR_OS_ADERENCIA_P
       AND OS.NR_SEQ_ESTAGIO IN (9);
	EXCEPTION
		WHEN no_data_found THEN
			DT_ENC_W := NULL;
		WHEN OTHERS THEN
			DT_ENC_W := NULL;
	END;

  --DT_INI
	BEGIN
    SELECT MIN(DT_ATIVIDADE)
      INTO STRICT DT_INI_W
      FROM MAN_ORDEM_SERVICO OS,
           MAN_ORDEM_SERV_ATIV ASP
     WHERE OS.NR_SEQUENCIA = ASP.NR_SEQ_ORDEM_SERV
       AND OS.NR_SEQUENCIA = NR_OS_ADERENCIA_P;
	EXCEPTION
		WHEN no_data_found THEN
			DT_INI_W := NULL;
		WHEN OTHERS THEN
			DT_INI_W := NULL;
	END;

  IF IE_TIPO_DT_P = 'I' THEN
    PR_RETORNO_W := DT_INI_W;
  ELSIF IE_TIPO_DT_P = 'E' THEN
    PR_RETORNO_W := DT_ENC_W;
  ELSE
    PR_RETORNO_W := NULL;
  END IF;

  RETURN	PR_RETORNO_W;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dt_ini_fim_teste_proj ( NR_OS_ADERENCIA_P bigint, IE_TIPO_DT_P text) FROM PUBLIC;

