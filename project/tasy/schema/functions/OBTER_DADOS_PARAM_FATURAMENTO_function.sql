-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_param_faturamento ( cd_estabelecimento_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


cd_convenio_w		bigint	:= null;
cd_categoria_w		bigint	:= null;
cd_convenio_sus_w	bigint	:= null;
ds_retorno_w		varchar(2000)	:= null;
ie_fluxo_mmed_w		varchar(1)	:= null;
ie_forma_consist_tit_w  varchar(1)	:= null;
/*
ie_opcao_p

CONP		Código Convênio Particular
CATP		Código Categoria Particular
CSUS		Código Convênio SUS
FLUXO_MMED	Utiliza fluxo Mmed
BAIXA_TITULO	Forma de consistir a baixa de título
*/
BEGIN

	if (cd_estabelecimento_p IS NOT NULL AND cd_estabelecimento_p::text <> '' AND ie_opcao_p IS NOT NULL AND ie_opcao_p::text <> '') then
		select 	max(cd_convenio_partic),
			max(cd_categoria_partic),
			max(cd_convenio_sus),
			coalesce(max(ie_fluxo_mmed),'N'),
			coalesce(max(ie_forma_consistir_titulo),'0')
		into STRICT	cd_convenio_w,
			cd_categoria_w,
			cd_convenio_sus_w,
			ie_fluxo_mmed_w,
			ie_forma_consist_tit_w
		from   	parametro_faturamento
		where  	cd_estabelecimento = cd_estabelecimento_p;
	end if;

	if 	ie_opcao_p = 'CONP' then
			ds_retorno_w := cd_convenio_w;
	elsif 	ie_opcao_p = 'CATP' then
			ds_retorno_w := cd_categoria_w;
	elsif 	ie_opcao_p = 'CSUS' then
			ds_retorno_w := cd_convenio_sus_w;
	elsif	ie_opcao_p = 'FLUXO_MMED' then
			ds_retorno_w := ie_fluxo_mmed_w;
	elsif 	ie_opcao_p = 'BAIXA_TITULO' then
			ds_retorno_w := ie_forma_consist_tit_w;
	end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_param_faturamento ( cd_estabelecimento_p bigint, ie_opcao_p text) FROM PUBLIC;

