-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_desc_setor_rn ( nr_atendimento_p bigint) RETURNS varchar AS $body$
DECLARE


ds_retorno_w	varchar(255);

BEGIN

if (coalesce(nr_atendimento_p,0) > 0) then

	begin
	select	max(a.ds_setor_atendimento)
	into STRICT	ds_retorno_w
	from	setor_atendimento a,
		atend_paciente_unidade c,
		unidade_atendimento e
	where	e.cd_setor_atendimento	= c.cd_setor_atendimento
	and	e.cd_unidade_basica	= c.cd_unidade_basica
	and	e.cd_unidade_compl	= c.cd_unidade_compl
	and	a.cd_setor_atendimento	= e.cd_setor_atendimento
	and	a.cd_estabelecimento	= obter_estabelecimento_ativo
	and	c.nr_seq_interno	=
		(	SELECT	coalesce(max(x.nr_seq_interno),0)
			from	atend_paciente_unidade x
			where	x.nr_atendimento = nr_atendimento_p
			and 	coalesce(x.dt_saida_unidade, x.dt_entrada_unidade + 9999)	=
					(	select	max(coalesce(t.dt_saida_unidade, t.dt_entrada_unidade + 9999))
						from	Setor_Atendimento y,
							atend_paciente_unidade t
						where 	nr_atendimento 	= nr_atendimento_p
						and	t.cd_setor_atendimento	= y.cd_setor_atendimento
						and	y.cd_classif_setor in (9)))  LIMIT 1;
	exception
	when others then
		ds_retorno_w := '';
	end;

end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_desc_setor_rn ( nr_atendimento_p bigint) FROM PUBLIC;

