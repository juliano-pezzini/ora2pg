-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_cod_medico_assistente ( cd_crm_uf_p text) RETURNS varchar AS $body$
DECLARE


cd_medico_laudante_w  varchar(10);
nr_crm_w            varchar(20);
uf_crm_w            varchar(2);
pos_inicio_uf_w        bigint;


BEGIN

if (cd_crm_uf_p IS NOT NULL AND cd_crm_uf_p::text <> '') then

  pos_inicio_uf_w := length(cd_crm_uf_p) - 2;
  nr_crm_w := substr(cd_crm_uf_p,1,pos_inicio_uf_w);
  uf_crm_w := substr(cd_crm_uf_p,pos_inicio_uf_w + 1,2);

   select m.cd_pessoa_fisica
    into STRICT cd_medico_laudante_w
    from medico m
   inner join pessoa_fisica pf on pf.cd_pessoa_fisica = m.cd_pessoa_fisica
   inner join conselho_profissional cp on cp.nr_sequencia = pf.nr_seq_conselho and
                                       cp.sg_conselho = 'CRM'
   where m.nr_crm = nr_crm_w
     and m.uf_crm = uf_crm_w;
end if;
  return cd_medico_laudante_w;


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_cod_medico_assistente ( cd_crm_uf_p text) FROM PUBLIC;

