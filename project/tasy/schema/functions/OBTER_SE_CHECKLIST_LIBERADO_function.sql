-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_checklist_liberado ( nr_sequencia_p bigint, nr_seq_checklist_p bigint) RETURNS varchar AS $body$
DECLARE

				 
ds_retorno	varchar(1);


BEGIN 
ds_retorno := 'N';
if (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '') and (nr_seq_checklist_p IS NOT NULL AND nr_seq_checklist_p::text <> '') then 
	 
	select 	coalesce(max('S'),'N') 
	into STRICT	ds_retorno 
	from 	med_avaliacao_paciente a 
	where	a.nr_seq_atend_checklist = nr_sequencia_p  
	and	a.nr_seq_checklist_item = nr_seq_checklist_p 
	and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') 
	and not exists (SELECT	1 
			from	med_avaliacao_paciente b 
			where	b.nr_seq_atend_checklist = a.nr_seq_atend_checklist 
			and	b.nr_seq_checklist_item = a.nr_seq_checklist_item 
			and	coalesce(b.dt_liberacao::text, '') = '');	
	 
end if;
 
return	ds_retorno;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_checklist_liberado ( nr_sequencia_p bigint, nr_seq_checklist_p bigint) FROM PUBLIC;

