-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION sus_obter_nota_fiscal ( nr_sequencia_p bigint, cd_procedimento_p bigint, nr_nota_fiscal_p bigint) RETURNS bigint AS $body$
DECLARE


nr_nota_fiscal_w		numeric(20);
ie_motivo_alta_uti_neo_w	smallint;
qt_peso_grama_w		smallint;
qt_mes_gestacao_w		smallint;


BEGIN

if (cd_procedimento_p = 96004037) or (cd_procedimento_p = 96004029) or (cd_procedimento_p = 96004010) or (cd_procedimento_p = 96003022) or (cd_procedimento_p = 96003030) or (cd_procedimento_p = 96003014) then
	begin
	select max(ie_motivo_alta_uti_neo),
		max(qt_peso_grama),
		max(qt_mes_gestacao)
	into STRICT	ie_motivo_alta_uti_neo_w,
		qt_peso_grama_w,
		qt_mes_gestacao_w
	from	sus_aih c,
		procedimento_paciente a
	where	a.nr_atendimento	= c.nr_atendimento
	and	a.nr_sequencia	= nr_sequencia_p;
	nr_nota_fiscal_w		:= Campo_Numerico(
					to_char(ie_motivo_alta_uti_neo_w) ||
					to_char(qt_peso_grama_w,'FM0000') ||
					to_char(qt_mes_gestacao_w));
	end;
else
	nr_nota_fiscal_w	:= nr_nota_fiscal_p;
end if;

return	nr_nota_fiscal_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION sus_obter_nota_fiscal ( nr_sequencia_p bigint, cd_procedimento_p bigint, nr_nota_fiscal_p bigint) FROM PUBLIC;

