-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION lab_cons_val_ref_massas (nr_seq_exame_p bigint, qt_result_p bigint, ds_result_p text, nr_seq_prescr_p bigint, ie_opcao_p bigint, nr_seq_resultado_p bigint, nr_seq_patologia_p bigint, nr_seq_grupo_pat_p bigint) RETURNS varchar AS $body$
DECLARE


ds_retorno_w		varchar(4000);
qt_dias_w		double precision	:= 0;
qt_horas_w		bigint	:= 0;
ie_tipo_valor_w		bigint	:= 0;
ie_valor_percent_w	varchar(10);
ie_sexo_w		varchar(1);
nr_sequencia_w		bigint;
contador_abaixo_w	bigint;
contador_acima_w	bigint;
qt_percent_min_w	bigint;
qt_percent_max_w	bigint;
qt_result_min_w		bigint;
qt_result_max_w		bigint;
ds_msg_criterio_w	varchar(4000);
ds_acao_criterio_w	varchar(4000);
cd_pessoa_fisica_w	varchar(10);
nr_prescricao_w		bigint;
qt_dias_prev_w		varchar(255);
dt_coleta_w			timestamp;
dt_transf_w			timestamp;
qt_dias_coleta_w	bigint := 0;
qt_horas_coleta_w	bigint := 0;
qt_dias_transf_w	bigint := 0;
qt_horas_transf_w	bigint := 0;
ie_tipo_busca_w		varchar(1);
ie_acao_criterio_w	lote_ent_patol_exam_crit.ie_acao_criterio%type;
ds_resultado_sugerido_w  varchar(255);
ds_material_criterio_w		varchar(255);
ds_metodo_criterio_w		varchar(255);
qt_minima_patol_w			double precision;
qt_maxima_patol_w			double precision;
ds_observacao_ref_w			varchar(2000);


BEGIN


/*
ie_opcao_p
1 - Retorna descrição do tipo de valor
2 - Retorna o ie_tipo_valor como number
3 - Retorna a mensagem do criterio
4 - Retorna a acao cadastrada no criterio
5 - Retorna o QT_DIAS cadastrado no criterio
6 - Retorna o TIPO DE BUSCA cadastrado para o criterio
7 - Retorna código IE_ACAO_CRITERIO
8 - Retorna resultado sugerido
9 - Retorna o material do critério
10 - Retorna o método do critério
11 - Retorna o qt_minina da referencia da patologia
12 - Retorna o qt_maxima da referencia da patologia
13 - Retorna o ds_observacao da referencia da patologia
*/
/*select 	obter_dias_entre_datas(Lab_obter_data_coleta(nr_prescricao_w, nr_seq_prescr_p),sysdate),
	round(Obter_Hora_Entre_datas(Lab_obter_data_coleta(nr_prescricao_w, nr_seq_prescr_p),sysdate))
into 	qt_dias_w,
	qt_horas_w
from 	dual;*/
select	max(nr_prescricao)
into STRICT	nr_prescricao_w
from	exame_lab_resultado
where	nr_seq_resultado = nr_seq_resultado_p;

select 	cd_pessoa_fisica
into STRICT	cd_pessoa_fisica_w
from	prescr_medica
where	nr_prescricao = nr_prescricao_w;

select 	obter_dias_entre_datas(obter_data_nascto_pf(cd_pessoa_fisica_w),clock_timestamp()),
	round(Obter_Hora_Entre_datas(obter_data_nascto_pf(cd_pessoa_fisica_w),clock_timestamp()))
into STRICT 	qt_dias_w,
	qt_horas_w
;

select 	max(IE_FORMATO_RESULTADO)
into STRICT	ie_valor_percent_w
from	exame_laboratorio
where	nr_seq_exame = nr_seq_exame_p;

select 	max(Obter_Sexo_Prescricao(nr_prescricao_w))
into STRICT	ie_sexo_w
;

select	TO_DATE(TO_CHAR(max(coalesce(b.DT_COLETA_FICHA_F,clock_timestamp())),'dd/mm/yyyy')||' '||TO_CHAR(max(coalesce(b.HR_COLETA_F,clock_timestamp())),'hh24:mi:ss'),'dd/mm/yyyy hh24:mi:ss'),
		max(coalesce(b.DT_TRANSF_F,clock_timestamp()))
into STRICT	dt_coleta_w,
		dt_transf_w
from	prescr_procedimento a,
		lote_ent_sec_ficha b
where	a.nr_prescricao = b.nr_prescricao
and		a.nr_prescricao = nr_prescricao_w;


if (dt_coleta_w IS NOT NULL AND dt_coleta_w::text <> '') then

	select 	obter_dias_entre_datas(obter_data_nascto_pf(cd_pessoa_fisica_w), dt_coleta_w),
			round(Obter_Hora_Entre_datas(obter_data_nascto_pf(cd_pessoa_fisica_w),dt_coleta_w))
	into STRICT 	qt_dias_coleta_w,
			qt_horas_coleta_w
	;

end if;

if (dt_transf_w IS NOT NULL AND dt_transf_w::text <> '') then

	select 	obter_dias_entre_datas(dt_transf_w,dt_coleta_w),
			round(Obter_Hora_Entre_datas(dt_transf_w,dt_coleta_w))
	into STRICT 	qt_dias_transf_w,
			qt_horas_transf_w
	;

end if;

if (ie_valor_percent_w = 'P') then
	begin
	select 	a.ie_tipo_valor,
			a.nr_sequencia,
			a.qt_minima,
			a.qt_maxima,
			a.ds_observacao
	into STRICT	ie_tipo_valor_w,
			nr_sequencia_w,
			qt_minima_patol_w,
			qt_maxima_patol_w,
			ds_observacao_ref_w
	from 	LOTE_ENT_PATOL_EXAM_REF a,
			lab_patologia_exame b,
			lab_patologia c
	where 	a.nr_seq_exame = b.nr_seq_exame
	--and a.nr_seq_patologia = nr_seq_patologia_p
	and		b.nr_seq_patologia = nr_seq_patologia_p
	and		c.nr_seq_grupo_pat = nr_seq_grupo_pat_p
	and		((a.ie_sexo = coalesce(ie_sexo_w,'0')) or (a.ie_sexo = '0'))
	and 	a.nr_seq_exame = nr_seq_exame_p
--	and 	nvl(a.nr_seq_material,nr_seq_material_p) = nr_seq_material_p
	and 	(((coalesce(a.ie_tipo_data,'N') = 'N') and (((coalesce(trunc((qt_dias_w / 365.25),2),0) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'A')) or
			(((coalesce((qt_dias_w / 365.25),0) * 12) between a.qt_idade_min and qt_idade_max) and (a.ie_periodo = 'M')) or
			(((coalesce(qt_dias_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'D')) or
			(((coalesce(qt_horas_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'H'))))
		or	((coalesce(a.ie_tipo_data,'N') = 'C') and (((coalesce((qt_dias_coleta_w / 365.25),0) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'A')) or
			(((coalesce((qt_dias_coleta_w / 365.25),0) * 12) between a.qt_idade_min and qt_idade_max) and (a.ie_periodo = 'M')) or
			(((coalesce(qt_dias_coleta_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'D')) or
			(((coalesce(qt_horas_coleta_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'H'))))
		or	((coalesce(a.ie_tipo_data,'N') = 'T') and (((coalesce((qt_dias_transf_w / 365.25),0) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'A')) or
			(((coalesce((qt_dias_transf_w / 365.25),0) * 12) between a.qt_idade_min and qt_idade_max) and (a.ie_periodo = 'M')) or
			(((coalesce(qt_dias_transf_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'D')) or
			(((coalesce(qt_horas_transf_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'H')))))
	--and 	qt_result_p between a.qt_percent_min and a.qt_percent_max
	and	a.ie_tipo_valor = 0
	order by a.NR_SEQ_PRIORIDADE, a.nr_seq_material, a.ie_sexo, a.ie_tipo_valor LIMIT 1;
	exception
		when no_data_found then
			ie_tipo_valor_w := 0;
	end;
elsif (ie_valor_percent_w = 'V') then
	begin
	select 	a.ie_tipo_valor,
			a.nr_sequencia,
			a.qt_minima,
			a.qt_maxima,
			a.ds_observacao
	into STRICT	ie_tipo_valor_w,
			nr_sequencia_w,
			qt_minima_patol_w,
			qt_maxima_patol_w,
			ds_observacao_ref_w
	from 	LOTE_ENT_PATOL_EXAM_REF a,
			lab_patologia_exame b,
			lab_patologia c
	where 	a.nr_seq_exame = b.nr_seq_exame
	--and a.nr_seq_patologia = nr_seq_patologia_p
	and		b.nr_seq_patologia = c.nr_sequencia
	and		b.nr_seq_patologia = nr_seq_patologia_p
	and		c.nr_seq_grupo_pat = nr_seq_grupo_pat_p
	and		((a.ie_sexo = coalesce(ie_sexo_w,'0')) or (a.ie_sexo = '0'))
	and 	a.nr_seq_exame = nr_seq_exame_p
--	and 	nvl(a.nr_seq_material,nr_seq_material_p) = nr_seq_material_p
	and 	(((coalesce(a.ie_tipo_data,'N') = 'N') and (((coalesce(trunc((qt_dias_w / 365.25),2),0) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'A')) or
			(((coalesce((qt_dias_w / 365.25),0) * 12) between a.qt_idade_min and qt_idade_max) and (a.ie_periodo = 'M')) or
			(((coalesce(qt_dias_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'D')) or
			(((coalesce(qt_horas_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'H'))))
		or	((coalesce(a.ie_tipo_data,'N') = 'C') and (((coalesce((qt_dias_coleta_w / 365.25),0) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'A')) or
			(((coalesce((qt_dias_coleta_w / 365.25),0) * 12) between a.qt_idade_min and qt_idade_max) and (a.ie_periodo = 'M')) or
			(((coalesce(qt_dias_coleta_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'D')) or
			(((coalesce(qt_horas_coleta_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'H'))))
		or	((coalesce(a.ie_tipo_data,'N') = 'T') and (((coalesce((qt_dias_transf_w / 365.25),0) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'A')) or
			(((coalesce((qt_dias_transf_w / 365.25),0) * 12) between a.qt_idade_min and qt_idade_max) and (a.ie_periodo = 'M')) or
			(((coalesce(qt_dias_transf_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'D')) or
			(((coalesce(qt_horas_transf_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'H')))))
	--and 	qt_result_p between a.qt_minima and a.qt_maxima
	and	a.ie_tipo_valor = 0
	order by a.NR_SEQ_PRIORIDADE, a.nr_seq_material, a.ie_sexo, a.ie_tipo_valor LIMIT 1;
	exception
		when no_data_found then
			ie_tipo_valor_w := 0;
	end;
elsif (ie_valor_percent_w = 'D') then
	begin
	select 	a.ie_tipo_valor,
			a.nr_sequencia,
			a.qt_minima,
			a.qt_maxima,
			a.ds_observacao
	into STRICT	ie_tipo_valor_w,
			nr_sequencia_w,
			qt_minima_patol_w,
			qt_maxima_patol_w,
			ds_observacao_ref_w
	from 	LOTE_ENT_PATOL_EXAM_REF a,
			lab_patologia_exame b,
			lab_patologia c
	where 	a.nr_seq_exame = b.nr_seq_exame
	and		b.nr_seq_patologia = c.nr_sequencia
	--and a.nr_seq_patologia = nr_seq_patologia_p
	and		b.nr_seq_patologia = nr_seq_patologia_p
	and		c.nr_seq_grupo_pat = nr_seq_grupo_pat_p
	and		((a.ie_sexo = coalesce(ie_sexo_w,'0')) or (a.ie_sexo = '0'))
	and 	a.nr_seq_exame = nr_seq_exame_p
--	and 	nvl(a.nr_seq_material,nr_seq_material_p) = nr_seq_material_p
	and 	(((coalesce(a.ie_tipo_data,'N') = 'N') and (((coalesce(trunc((qt_dias_w / 365.25),2),0) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'A')) or
			(((coalesce((qt_dias_w / 365.25),0) * 12) between a.qt_idade_min and qt_idade_max) and (a.ie_periodo = 'M')) or
			(((coalesce(qt_dias_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'D')) or
			(((coalesce(qt_horas_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'H'))))
		or	((coalesce(a.ie_tipo_data,'N') = 'C') and (((coalesce((qt_dias_coleta_w / 365.25),0) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'A')) or
			(((coalesce((qt_dias_coleta_w / 365.25),0) * 12) between a.qt_idade_min and qt_idade_max) and (a.ie_periodo = 'M')) or
			(((coalesce(qt_dias_coleta_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'D')) or
			(((coalesce(qt_horas_coleta_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'H'))))
		or	((coalesce(a.ie_tipo_data,'N') = 'T') and (((coalesce((qt_dias_transf_w / 365.25),0) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'A')) or
			(((coalesce((qt_dias_transf_w / 365.25),0) * 12) between a.qt_idade_min and qt_idade_max) and (a.ie_periodo = 'M')) or
			(((coalesce(qt_dias_transf_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'D')) or
			(((coalesce(qt_horas_transf_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'H')))))
	--and 	upper(ELIMINA_ACENTOS(ds_result_p)) like upper(ELIMINA_ACENTOS(a.DS_OBSERVACAO))
	and	a.ie_tipo_valor = 0
	order by a.NR_SEQ_PRIORIDADE, a.nr_seq_material, a.ie_sexo, a.ie_tipo_valor LIMIT 1;
	exception
		when no_data_found then
			ie_tipo_valor_w := 0;
	end;
elsif (ie_valor_percent_w = 'DV') then
	if (coalesce(ds_result_p,'0') <> '0') then
		begin
		select 	a.ie_tipo_valor,
				a.nr_sequencia,
				a.qt_minima,
				a.qt_maxima,
				a.ds_observacao
		into STRICT	ie_tipo_valor_w,
				nr_sequencia_w,
				qt_minima_patol_w,
				qt_maxima_patol_w,
				ds_observacao_ref_w
		from 	LOTE_ENT_PATOL_EXAM_REF a,
				lab_patologia_exame b,
				lab_patologia c
		where 	a.nr_seq_exame = b.nr_seq_exame
		--and a.nr_seq_patologia = nr_seq_patologia_p
		and		b.nr_seq_patologia = c.nr_sequencia
		and		b.nr_seq_patologia = nr_seq_patologia_p
		and		c.nr_seq_grupo_pat = nr_seq_grupo_pat_p
		and		((a.ie_sexo = coalesce(ie_sexo_w,'0')) or (a.ie_sexo = '0'))
		and 	a.nr_seq_exame = nr_seq_exame_p
	--	and 	nvl(a.nr_seq_material,nr_seq_material_p) = nr_seq_material_p
		and 	(((coalesce(a.ie_tipo_data,'N') = 'N') and (((coalesce(trunc((qt_dias_w / 365.25),2),0) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'A')) or
				(((coalesce((qt_dias_w / 365.25),0) * 12) between a.qt_idade_min and qt_idade_max) and (a.ie_periodo = 'M')) or
				(((coalesce(qt_dias_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'D')) or
				(((coalesce(qt_horas_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'H'))))
			or	((coalesce(a.ie_tipo_data,'N') = 'C') and (((coalesce((qt_dias_coleta_w / 365.25),0) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'A')) or
				(((coalesce((qt_dias_coleta_w / 365.25),0) * 12) between a.qt_idade_min and qt_idade_max) and (a.ie_periodo = 'M')) or
				(((coalesce(qt_dias_coleta_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'D')) or
				(((coalesce(qt_horas_coleta_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'H'))))
			or	((coalesce(a.ie_tipo_data,'N') = 'T') and (((coalesce((qt_dias_transf_w / 365.25),0) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'A')) or
				(((coalesce((qt_dias_transf_w / 365.25),0) * 12) between a.qt_idade_min and qt_idade_max) and (a.ie_periodo = 'M')) or
				(((coalesce(qt_dias_transf_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'D')) or
				(((coalesce(qt_horas_transf_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'H')))))
		--and 	upper(ELIMINA_ACENTOS(ds_result_p)) like upper(ELIMINA_ACENTOS(a.DS_OBSERVACAO))
		and	a.ie_tipo_valor = 0
		order by a.NR_SEQ_PRIORIDADE, a.nr_seq_material, a.ie_sexo, a.ie_tipo_valor LIMIT 1;
		exception
			when no_data_found then
				ie_tipo_valor_w := 0;
		end;

	else

		begin
		select 	a.ie_tipo_valor,
				a.nr_sequencia,
				a.qt_minima,
				a.qt_maxima,
				a.ds_observacao
		into STRICT	ie_tipo_valor_w,
				nr_sequencia_w,
				qt_minima_patol_w,
				qt_maxima_patol_w,
				ds_observacao_ref_w
		from 	LOTE_ENT_PATOL_EXAM_REF a,
				lab_patologia_exame b,
				lab_patologia c
		where 	a.nr_seq_exame = b.nr_seq_exame
	--	and a.nr_seq_patologia = nr_seq_patologia_p
		and		b.nr_seq_patologia = c.nr_sequencia
		and		b.nr_seq_patologia = nr_seq_patologia_p
		and		c.nr_seq_grupo_pat = nr_seq_grupo_pat_p
		and		((a.ie_sexo = coalesce(ie_sexo_w,'0')) or (a.ie_sexo = '0'))
		and 	a.nr_seq_exame = nr_seq_exame_p
	--	and 	nvl(a.nr_seq_material,nr_seq_material_p) = nr_seq_material_p
		and 	(((coalesce(a.ie_tipo_data,'N') = 'N') and (((coalesce(trunc((qt_dias_w / 365.25),2),0) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'A')) or
				(((coalesce((qt_dias_w / 365.25),0) * 12) between a.qt_idade_min and qt_idade_max) and (a.ie_periodo = 'M')) or
				(((coalesce(qt_dias_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'D')) or
				(((coalesce(qt_horas_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'H'))))
			or	((coalesce(a.ie_tipo_data,'N') = 'C') and (((coalesce((qt_dias_coleta_w / 365.25),0) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'A')) or
				(((coalesce((qt_dias_coleta_w / 365.25),0) * 12) between a.qt_idade_min and qt_idade_max) and (a.ie_periodo = 'M')) or
				(((coalesce(qt_dias_coleta_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'D')) or
				(((coalesce(qt_horas_coleta_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'H'))))
			or	((coalesce(a.ie_tipo_data,'N') = 'T') and (((coalesce((qt_dias_transf_w / 365.25),0) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'A')) or
				(((coalesce((qt_dias_transf_w / 365.25),0) * 12) between a.qt_idade_min and qt_idade_max) and (a.ie_periodo = 'M')) or
				(((coalesce(qt_dias_transf_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'D')) or
				(((coalesce(qt_horas_transf_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = 'H')))))
		--and 	qt_result_p between a.qt_minima and a.qt_maxima
		and	a.ie_tipo_valor = 0
		order by a.NR_SEQ_PRIORIDADE, a.nr_seq_material, a.ie_sexo, a.ie_tipo_valor LIMIT 1;
		exception
			when no_data_found then
				ie_tipo_valor_w := 0;
		end;

	end if;

	if (ie_opcao_p = 1) then
		if (ie_tipo_valor_w = 0)	then
			ds_retorno_w := Wheb_mensagem_pck.get_texto(308858); --'Referência';
		elsif (ie_tipo_valor_w = 1)	then
			ds_retorno_w := Wheb_mensagem_pck.get_texto(308859); --'Aceitável';
		elsif (ie_tipo_valor_w = 2) 	then
			ds_retorno_w := Wheb_mensagem_pck.get_texto(308860); --'Não aceitável';
		end if;
	elsif (ie_opcao_p = 2) then
		if (ie_tipo_valor_w = 0)	then
			ds_retorno_w := '0';
		elsif (ie_tipo_valor_w = 1)	then
			ds_retorno_w := '1';
		elsif (ie_tipo_valor_w = 2) 	then
			ds_retorno_w := '2';
		end if;
	elsif (ie_opcao_p = 11) then
		ds_retorno_w := to_char(qt_minima_patol_w);
	elsif (ie_opcao_p = 12) then
		ds_retorno_w := to_char(qt_maxima_patol_w);
	elsif (ie_opcao_p = 13) then
		ds_retorno_w := substr(ds_observacao_ref_w,1,255);
	end if;
end if;

if (ie_tipo_valor_w = 0)	and (coalesce(nr_sequencia_w,0) <> 0) then

	if (ie_opcao_p = 1) then
		ds_retorno_w := Wheb_mensagem_pck.get_texto(308858); --'Referência';
	elsif (ie_opcao_p = 2) then
		ds_retorno_w := '0';
	elsif (ie_opcao_p = 11) then
		ds_retorno_w := to_char(qt_minima_patol_w);
	elsif (ie_opcao_p = 12) then
		ds_retorno_w := to_char(qt_maxima_patol_w);
	elsif (ie_opcao_p = 13) then
		ds_retorno_w := substr(ds_observacao_ref_w,1,255);
	end if;

end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION lab_cons_val_ref_massas (nr_seq_exame_p bigint, qt_result_p bigint, ds_result_p text, nr_seq_prescr_p bigint, ie_opcao_p bigint, nr_seq_resultado_p bigint, nr_seq_patologia_p bigint, nr_seq_grupo_pat_p bigint) FROM PUBLIC;

