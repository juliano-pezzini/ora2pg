-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pcs_obter_dados_tipo_parecer ( nr_seq_tipo_parecer_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE

ds_retorno_w	varchar(255);
cd_estabelecimento_w smallint;


BEGIN

cd_estabelecimento_w := wheb_usuario_pck.get_cd_estabelecimento;


if (ie_opcao_p = 'HPR') then

	select	coalesce(to_char(hr_resposta,'hh24:mi:ss'),to_char(clock_timestamp(),'hh24:mi:ss'))
	into STRICT	ds_retorno_w
	from	pcs_tipo_parecer
	where	nr_sequencia = nr_seq_tipo_parecer_p;

elsif (ie_opcao_p = 'CPD') then

	select	max(cd_pessoa_dest)
	into STRICT	ds_retorno_w
	from	pcs_regra_tipo_parecer
	where	nr_seq_tipo_parecer = nr_seq_tipo_parecer_p
	and	((coalesce(cd_estab_regra::text, '') = '' and (nr_seq_regional IS NOT NULL AND nr_seq_regional::text <> '') and pcs_obter_se_estab_regional(cd_estabelecimento_w,nr_seq_regional) = 'S') or ((cd_estab_regra IS NOT NULL AND cd_estab_regra::text <> '') and cd_estab_regra = cd_estabelecimento_w) or (coalesce(nr_seq_regional::text, '') = '' and coalesce(cd_estab_regra::text, '') = ''));

elsif (ie_opcao_p = 'NGD') then

	select	max(nr_seq_grupo_dest)
	into STRICT	ds_retorno_w
	from	pcs_regra_tipo_parecer
	where	nr_seq_tipo_parecer = nr_seq_tipo_parecer_p
	and	((coalesce(cd_estab_regra::text, '') = ''  and (nr_seq_regional IS NOT NULL AND nr_seq_regional::text <> '') and pcs_obter_se_estab_regional(cd_estabelecimento_w,nr_seq_regional) = 'S') or ((cd_estab_regra IS NOT NULL AND cd_estab_regra::text <> '') and cd_estab_regra = cd_estabelecimento_w) or (coalesce(nr_seq_regional::text, '') = '' and coalesce(cd_estab_regra::text, '') = ''));

end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pcs_obter_dados_tipo_parecer ( nr_seq_tipo_parecer_p bigint, ie_opcao_p text) FROM PUBLIC;

