-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_tempo_total_proced ( nr_seq_proc_interno_p bigint, cd_medico_p text, cd_estab_agenda_p bigint default 0, ie_soma_hig_p text default 'S') RETURNS bigint AS $body$
DECLARE


qt_min_cirugia_w	bigint := null;
qt_min_higienizacao_w	bigint := 0;
cd_estabelecimento_w	smallint;


BEGIN

if (coalesce(cd_estab_agenda_p,0) = 0) then
	cd_estabelecimento_w	:=  coalesce(wheb_usuario_pck.get_cd_estabelecimento,0);
else
	cd_estabelecimento_w	:=  cd_estab_agenda_p;
end if;	
		

select	max(qt_min_cirugia)
into STRICT	qt_min_cirugia_w
from	proc_interno_tempo
where	nr_seq_proc_interno		= nr_seq_proc_interno_p
and	coalesce(cd_medico,coalesce(cd_medico_p,'X')) = coalesce(cd_medico_p,'X')
and	coalesce(cd_estabelecimento,cd_estabelecimento_w)	= cd_estabelecimento_w;

if (coalesce(qt_min_cirugia_w::text, '') = '') then
	select	coalesce(max(qt_min_cirurgia),0)
	into STRICT	qt_min_cirugia_w
	from	proc_interno
	where	nr_sequencia		= nr_seq_proc_interno_p;
end if;

if (ie_soma_hig_p = 'S') then
	select	coalesce(max(qt_min_higienizacao), 0)
	into STRICT	qt_min_higienizacao_w
	from	proc_interno
	where	nr_sequencia = nr_seq_proc_interno_p;
end if;

return qt_min_cirugia_w + qt_min_higienizacao_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_tempo_total_proced ( nr_seq_proc_interno_p bigint, cd_medico_p text, cd_estab_agenda_p bigint default 0, ie_soma_hig_p text default 'S') FROM PUBLIC;

