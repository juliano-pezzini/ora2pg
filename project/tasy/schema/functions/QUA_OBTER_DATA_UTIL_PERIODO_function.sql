-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION qua_obter_data_util_periodo ( cd_estabelecimento_p bigint, dt_inicial_p timestamp, qt_dias_p text) RETURNS timestamp AS $body$
DECLARE

/*
qt_dias
C-30  = 30 dias corridos
U-30 = 30 dias úteis

ie_opcao
C - Dias Corridos
U - Dias Úteis
*/
dt_retorno_w		timestamp	:= null;
qt_dia_util_w		bigint;
qt_dia_corrido_w		bigint;

ie_tipo_dia_w		varchar(1);
qt_dias_w		bigint;


BEGIN

select	substr(qt_dias_p,1,1)
into STRICT	ie_tipo_dia_w
;

select	somente_numero(qt_dias_p)
into STRICT	qt_dias_w
;


if (ie_tipo_dia_w = 'U') then

	qt_dia_corrido_w		:= 0;
	qt_dia_util_w		:= 0;

	while(qt_dia_util_w <= qt_dias_w ) loop

		if (obter_se_dia_util(dt_inicial_p + qt_dia_corrido_w, cd_estabelecimento_p) = 'S') then
			qt_dia_util_w	:= qt_dia_util_w + 1;
		end if;
		qt_dia_corrido_w	:= qt_dia_corrido_w + 1;

	end loop;

	dt_retorno_w := dt_inicial_p + qt_dia_corrido_w - 1;

else
	dt_retorno_w := dt_inicial_p + qt_dias_w;
end if;

return	dt_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION qua_obter_data_util_periodo ( cd_estabelecimento_p bigint, dt_inicial_p timestamp, qt_dias_p text) FROM PUBLIC;

