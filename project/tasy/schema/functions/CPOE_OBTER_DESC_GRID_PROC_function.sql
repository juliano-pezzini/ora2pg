-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cpoe_obter_desc_grid_proc (ds_procedimento_p text, ds_intervalo_p text, qt_procedimento_p bigint, cd_mat_proc1_p bigint, qt_dose_mat1_p bigint, cd_unid_medida_dose_mat1_p text, ie_assoc_adep1_p text, cd_mat_proc2_p bigint, qt_dose_mat2_p bigint, cd_unid_medida_dose_mat2_p text, ie_assoc_adep2_p text, cd_mat_proc3_p bigint, qt_dose_mat3_p bigint, cd_unid_medida_dose_mat3_p text, ie_assoc_adep3_p text, cd_mat_proc4_p bigint, qt_dose_mat4_p bigint, cd_unid_medida_dose_mat4_p text, ie_assoc_adep4_p text, cd_mat_proc5_p bigint, qt_dose_mat5_p bigint, cd_unid_medida_dose_mat5_p text, ie_assoc_adep5_p text, dt_lib_suspensao_p timestamp default null, dt_suspensao_p timestamp default null, ie_administracao_p text default null, dt_inicio_p timestamp default null, ie_apresenta_exec_hoje_p text default 'N', cd_mat_proc6_p bigint default null, qt_dose_mat6_p bigint default null, cd_unid_medida_dose_mat6_p text default null, ie_assoc_adep6_p text default null, cd_mat_proc7_p bigint default null, qt_dose_mat7_p bigint default null, cd_unid_medida_dose_mat7_p text default null, ie_assoc_adep7_p text default null, cd_mat_dil1_p bigint default null, qt_dose_dil1_p bigint default null, cd_unid_medida_dose_dil1_p text default null, cd_mat_dil2_p bigint default null, qt_dose_dil2_p bigint default null, cd_unid_medida_dose_dil2_p text default null, cd_mat_dil3_p bigint default null, qt_dose_dil3_p bigint default null, cd_unid_medida_dose_dil3_p text default null, cd_mat_dil4_p bigint default null, qt_dose_dil4_p bigint default null, cd_unid_medida_dose_dil4_p text default null, cd_mat_dil5_p bigint default null, qt_dose_dil5_p bigint default null, cd_unid_medida_dose_dil5_p text default null, cd_mat_dil6_p bigint default null, qt_dose_dil6_p bigint default null, cd_unid_medida_dose_dil6_p text default null, cd_mat_dil7_p bigint default null, qt_dose_dil7_p bigint default null, cd_unid_medida_dose_dil7_p text default null, cd_mat_recons1_p bigint default null, qt_dose_recons1_p bigint default null, cd_unid_medida_dose_recons1_p text default null, cd_mat_recons2_p bigint default null, qt_dose_recons2_p bigint default null, cd_unid_medida_dose_recons2_p text default null, cd_mat_recons3_p bigint default null, qt_dose_recons3_p bigint default null, cd_unid_medida_dose_recons3_p text default null, cd_mat_recons4_p bigint default null, qt_dose_recons4_p bigint default null, cd_unid_medida_dose_recons4_p text default null, cd_mat_recons5_p bigint default null, qt_dose_recons5_p bigint default null, cd_unid_medida_dose_recons5_p text default null, cd_mat_recons6_p bigint default null, qt_dose_recons6_p bigint default null, cd_unid_medida_dose_recons6_p text default null, cd_mat_recons7_p bigint default null, qt_dose_recons7_p bigint default null, cd_unid_medida_dose_recons7_p text default null, ie_baixado_por_alta_p cpoe_procedimento.ie_baixado_por_alta%type default null, dt_alta_medico_p cpoe_procedimento.dt_alta_medico%type default null, ie_exibe_dil_p text default 'S', ie_adep_p text default 'N', ds_lado_p text default null, ds_horarios_p cpoe_procedimento.ds_horarios%type default null, nr_sequencia_p bigint default null, nr_seq_prot_glic bigint default null, parenteses_p text default 'N', ie_urgencia_p cpoe_procedimento.ie_urgencia%type default null, ie_pre_cons_exam_p cpoe_procedimento.ie_pre_cons_exam%type default null, cd_material_exame_p text default null, dt_fim_grid_p timestamp default null, ie_revalidacao_p text default 'N', nr_seq_cpoe_p cpoe_procedimento.nr_sequencia%type default null) RETURNS varchar AS $body$
DECLARE


  ds_retorno_w         varchar(4000);
  ds_mat_proc1_w       varchar(100);
  ds_mat_proc2_w       varchar(100);
  ds_mat_proc3_w       varchar(100);
  ds_mat_proc4_w       varchar(100);
  ds_mat_proc5_w       varchar(100);
  ds_mat_proc6_w       varchar(100);
  ds_mat_proc7_w       varchar(100);
  ds_mat_dil1_w        varchar(100);
  ds_mat_dil2_w        varchar(100);
  ds_mat_dil3_w        varchar(100);
  ds_mat_dil4_w        varchar(100);
  ds_mat_dil5_w        varchar(100);
  ds_mat_dil6_w        varchar(100);
  ds_mat_dil7_w        varchar(100);
  ds_mat_recons1_w     varchar(100);
  ds_mat_recons2_w     varchar(100);
  ds_mat_recons3_w     varchar(100);
  ds_mat_recons4_w     varchar(100);
  ds_mat_recons5_w     varchar(100);
  ds_mat_recons6_w     varchar(100);
  ds_mat_recons7_w     varchar(100);
  ds_exame_w           varchar(100);
  ds_indentific_proc_w varchar(30); -- NO REMOVE - Verfificar OS: 979988
  ds_glicemia          varchar(100);
  ds_estrutura_proc_w  varchar(200);
  ie_urgent_exam_w	   varchar(1);
  ds_material_exame_w  varchar(50);
  ds_tempo_adm_grid_w	varchar(100);
  nr_seq_proc_interno_w cpoe_procedimento.nr_seq_proc_interno%type;
  ds_retorno_tag_w varchar(1000);
  ds_class_tag_w   varchar(5);
  ie_needs_ackn_interface_w 	varchar(2);
  ie_confirm_ackn_interface_w	varchar(2);
  rule_quantity_w		integer;
  ie_dbcheck_mat_proc1_w	varchar(1);
  ie_dbcheck_mat_proc2_w	varchar(1);
  ie_dbcheck_mat_proc3_w	varchar(1);
  ie_dbcheck_mat_proc4_w	varchar(1);
  ie_dbcheck_mat_proc5_w	varchar(1);
  ie_dbcheck_mat_proc6_w	varchar(1);
  ie_dbcheck_mat_proc7_w	varchar(1);
  ie_dbcheck_mat_dil1_w		varchar(1);
  ie_dbcheck_mat_dil2_w		varchar(1);
  ie_dbcheck_mat_dil3_w		varchar(1);
  ie_dbcheck_mat_dil4_w		varchar(1);
  ie_dbcheck_mat_dil5_w		varchar(1);
  ie_dbcheck_mat_dil6_w		varchar(1);
  ie_dbcheck_mat_dil7_w		varchar(1);
  ie_dbcheck_mat_recons1_w	varchar(1);
  ie_dbcheck_mat_recons2_w	varchar(1);
  ie_dbcheck_mat_recons3_w	varchar(1);
  ie_dbcheck_mat_recons4_w	varchar(1);
  ie_dbcheck_mat_recons5_w	varchar(1);
  ie_dbcheck_mat_recons6_w	varchar(1);
  ie_dbcheck_mat_recons7_w	varchar(1);

  c_01 CURSOR FOR
    SELECT p.ds_proc_exame
      from cpoe_exames_int c
     inner join proc_interno p on c.nr_seq_proc_interno = p.nr_sequencia
     where coalesce(c.nr_seq_proc_cpoe, c.nr_seq_proc_edit) = nr_sequencia_p;

  function bold(ds_valor_p text) return text is

;
BEGIN
    return '<strong ' || ds_indentific_proc_w || '>' || ds_valor_p || '</strong>';

  end;

  function cpoe_add_span_adic_info(ds_informacao_p varchar2) return varchar2 is
    ds_span_w_aqua varchar2(2000);
  begin

    ds_span_w_aqua := '<span class=''cpoe_color_aqua''> ' || ds_informacao_p || '</span>';

    return ds_span_w_aqua;
  end;	
	
	function cpoe_add_span_adic_info(ds_informacao_p	varchar2, ds_style_adic_p varchar2) return  varchar2 is
		ds_span_w	varchar2(2000 char);
		begin
			if ((trim(both ds_informacao_p) IS NOT NULL AND (trim(both ds_informacao_p))::text <> '')) then
				begin
				ds_span_w	:= '<span class=''material-adic-info '|| ds_style_adic_p ||'''> '||ds_informacao_p||'</span>';
				end;
			end if;
			return ds_span_w;
		end;
		
	function obter_se_item_futuro(nr_seq_cpoe_p cpoe_procedimento.nr_sequencia%type, ie_revalidacao_p varchar2)  return varchar2 is
	begin
	    if (coalesce(ie_revalidacao_p,'N') = 'S') then
			select max(CPOE_obter_prox_adm_grid_ang( nr_sequencia, 'P',	
										nm_usuario, nr_atendimento, 	
										ie_administracao, cd_intervalo,	
										coalesce(dt_prox_geracao, clock_timestamp()),	
										dt_inicio, dt_fim,				
										'prescr_procedimento',  'nr_seq_proc_cpoe',
										'prescr_proc_hor', 'nr_seq_procedimento', null, dt_fim_grid_p, obter_funcao_ativa, ie_revalidacao_p)) ds_tempo_adm_grid
							into STRICT ds_tempo_adm_grid_w 			
							from cpoe_procedimento
							where nr_sequencia = nr_seq_cpoe_p
							and (dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
							and coalesce(dt_lib_suspensao::text, '') = '';
			
			if (ds_tempo_adm_grid_w IS NOT NULL AND ds_tempo_adm_grid_w::text <> '') then
				return cpoe_add_span_adic_info(ds_tempo_adm_grid_w, 'cpoe_color_yellow cpoe_text_legend');
			end if;
		end if;
		return null;
	end;
	
	function get_order_interface(	ie_tipo_item_p in varchar2,
									nr_sequencia_p in number) return varchar2 is
	
	begin
		ie_needs_ackn_interface_w := cpoe_integracao_count(ie_tipo_item_p, nr_sequencia_p, 'BTN');
		ie_confirm_ackn_interface_w := cpoe_integracao_count(ie_tipo_item_p, nr_sequencia_p, 'TAG');
		
		if (ie_adep_p = 'S') then
			ds_class_tag_w := 'adep';
		else
			ds_class_tag_w := 'gpt';
		end if;
		
		ds_retorno_tag_w := '</div><div class="legend-cell-status-text-' || ds_class_tag_w ||'" style="cursor: default; flex-wrap: wrap;">
                <div class="legend-cell-content-tag-' || ds_class_tag_w ||'" style="cursor: default;">';

                        
    
		if (ie_adep_p = 'S') then
			ds_retorno_tag_w := ds_retorno_tag_w || '<div class="legend-cell-tag-adep" style="background-color: #FFE9AB; cursor: default; margin-top: 4px;"</div>';			
		else
			ds_retorno_tag_w := ds_retorno_tag_w || '<div class="legend-cell-tag-gpt" style="background-color: #FFE9AB; cursor: default; margin-top: 4px;" </div>';
		end if;
		
		if (ie_needs_ackn_interface_w = 'S') then
			ds_retorno_tag_w :=  ds_retorno_tag_w || obter_desc_expressao_idioma(1000214, null, wheb_usuario_pck.get_nr_seq_idioma)
			|| ' </div>
              </div>
          </div><div style="display:none">;';
		elsif (ie_confirm_ackn_interface_w = 'S') then
			ds_retorno_tag_w :=  ds_retorno_tag_w || obter_desc_expressao_idioma(1012943, null, wheb_usuario_pck.get_nr_seq_idioma)
			|| ' </div>
              </div>
          </div><div style="display:none">;';
    else
      ds_retorno_tag_w := null;
		end if;

		return ds_retorno_tag_w;
	end;
	
	function verifyDoubleCheckItem(	ie_double_check_w in varchar2) return varchar2 is

	begin

		ds_class_tag_w := 'adep';

		ds_retorno_tag_w := '</div><div class="legend-cell-status-text-' || ds_class_tag_w ||'" style="cursor: default; flex-wrap: wrap;">
                <div class="legend-cell-content-tag-' || ds_class_tag_w ||'" style="cursor: default;">';

		ds_retorno_tag_w := ds_retorno_tag_w || '<div class="legend-cell-tag-adep" style="background-color: #97B326; cursor: default; margin-top: 4px;"</div>';
		
		if (ie_double_check_w = 'S') then
			ds_retorno_tag_w :=  ds_retorno_tag_w || obter_desc_expressao_idioma(729215, null, wheb_usuario_pck.get_nr_seq_idioma)
			|| ' </div>
              </div>';
		else
			ds_retorno_tag_w := null;
		end if;

		return ds_retorno_tag_w;
	end;

begin

  ds_indentific_proc_w := 'class=''' || 'DS_PROC_IDENTIFIC' || ''''; -- NO REMOVE - Verfificar OS: 979988
  -- nr_seq_prot_glic OS 2133192
  if (nr_seq_prot_glic IS NOT NULL AND nr_seq_prot_glic::text <> '')
  then
    ds_glicemia := ' ' || cpoe_add_span_adic_info(obter_desc_expressao(624689,null));/*Expressao Controle de Glicemia*/
  end if;

  if (coalesce(pkg_i18n.get_user_locale, 'pt_BR') = 'ja_JP')
  then
    ds_estrutura_proc_w := cpoe_obter_desc_estrutura_proc(nr_sequencia_p);
    if (ds_estrutura_proc_w IS NOT NULL AND ds_estrutura_proc_w::text <> '')
    then
      ds_estrutura_proc_w := ' ' || ds_estrutura_proc_w;
    end if;
    if (cd_material_exame_p IS NOT NULL AND cd_material_exame_p::text <> '')
    then
      ds_material_exame_w := ' ('||Obter_Desc_Material_Exame_Lab(cd_material_exame_p)||')';
    end if;
  end if;


  if ((ds_procedimento_p IS NOT NULL AND ds_procedimento_p::text <> '') and coalesce(parenteses_p, 'N') = 'S')
  then
    ds_retorno_w := bold(ds_procedimento_p) || cpoe_add_span(ds_material_exame_w) || ds_estrutura_proc_w || ds_glicemia ||
                    cpoe_add_span_exl(obter_desc_interv_prescr(ds_intervalo_p),cd_material_exame_p) || cpoe_add_span(ds_horarios_p) ||
                    cpoe_obter_sigla_tipo_adm(ie_administracao_p);

  elsif (ds_procedimento_p IS NOT NULL AND ds_procedimento_p::text <> '')
  then
    ds_retorno_w := bold(ds_procedimento_p) || cpoe_add_span(ds_material_exame_w) || ds_estrutura_proc_w || ds_glicemia ||
                    cpoe_add_span(obter_desc_interv_prescr(ds_intervalo_p)) || cpoe_add_span(ds_horarios_p) ||
                    cpoe_obter_sigla_tipo_adm(ie_administracao_p);
    if (ie_urgencia_p IS NOT NULL AND ie_urgencia_p::text <> '')	then
	SELECT
			nr_seq_proc_interno
			INTO STRICT nr_seq_proc_interno_w
      FROM CPOE_PROCEDIMENTO
      WHERE nr_sequencia = nr_sequencia_p;

	SELECT (
            CASE
                WHEN nr_seq_exame_lab_p > 0 THEN
                    ie_urgent_exam_p
                WHEN nr_seq_exame_lab > 0 THEN
                    ie_urgent_exam
                WHEN nr_seq_exame_lab_l > 0 THEN
                    ie_urgent_exam_l
                WHEN nr_seq_classif > 0 THEN
                    ie_urgent_classif
                ELSE
                    ie_urgent_classif_l
            END
        )
		into STRICT ie_urgent_exam_w
		FROM ( SELECT
					coalesce(MAX(c.ie_agora), 'N') ie_urgent_exam,
					coalesce(MAX(b.ie_urgent), 'N') ie_urgent_classif,
					coalesce(MAX(a.nr_seq_classif),0) nr_seq_classif,
					coalesce(MAX(a.nr_seq_exame_lab),0) nr_seq_exame_lab
				FROM proc_interno a
LEFT OUTER JOIN exame_laboratorio c ON (a.nr_seq_exame_lab = c.nr_seq_exame)
LEFT OUTER JOIN proc_interno_classif b ON (a.nr_seq_classif = b.nr_sequencia)
WHERE a.nr_sequencia = nr_seq_proc_interno_w
			 ) proc_interno_exames , (
				SELECT
					coalesce(MAX(c.ie_agora), 'N') ie_urgent_exam_l,
					coalesce(MAX(b.ie_urgent), 'N') ie_urgent_classif_l,
					coalesce(MAX(a.nr_seq_classif),0) nr_seq_classif_l,
					coalesce(MAX(a.nr_seq_exame_lab),0) nr_seq_exame_lab_l
				FROM exame_laboratorio c, proc_interno a
LEFT OUTER JOIN proc_interno_classif b ON (a.nr_seq_classif = b.nr_sequencia)
WHERE a.nr_sequencia = c.nr_seq_proc_interno  AND c.nr_seq_proc_interno = nr_seq_proc_interno_w  order by c.nr_seq_exame desc
			 LIMIT 1) exames_proc_interno,(
				SELECT
					coalesce(MAX(c.ie_agora), 'N') ie_urgent_exam_p,
					MAX('N') as ie_urgent_classif_p,
					MAX(0) as nr_seq_classif_p,
					coalesce(MAX(c.nr_seq_exame),0) nr_seq_exame_lab_p
				FROM
					exame_laboratorio c,
					exame_lab_rotina r
				WHERE
					r.nr_seq_exame_interno = nr_seq_proc_interno_w
					and r.nr_seq_exame = c.nr_seq_exame 
			 LIMIT 1) exames_pep;
		if coalesce(ie_urgent_exam_w, 'N') = 'S' then
			ds_retorno_w := ds_retorno_w || ' ' || bold(obter_desc_expressao(300867, null));
		end if;
    end if;
    if (ie_pre_cons_exam_p = 'S')
    then
      ds_retorno_w := ds_retorno_w || ' ' || bold(obter_desc_expressao(1041766, null));
    end if;
  end if;

  if (coalesce(ie_adep_p, 'N') = 'N')
  then

    if (dt_inicio_p IS NOT NULL AND dt_inicio_p::text <> '') and (coalesce(ie_apresenta_exec_hoje_p, 'N') = 'S') and (establishment_timezone_utils.startofday(dt_inicio_p) <= establishment_timezone_utils.startofday(clock_timestamp()))
    then
      ds_retorno_w := ds_retorno_w || bold(' (' || obter_desc_expressao(798997, null) || ')');
    end if;

    if (cd_mat_proc1_p IS NOT NULL AND cd_mat_proc1_p::text <> '') and (coalesce(ie_assoc_adep1_p, 'N') = 'N') and (coalesce(obter_tipo_material(cd_mat_proc1_p, 'C'), '1') <> '1')
    then
      ds_mat_proc1_w := substr(obter_desc_material(cd_mat_proc1_p), 1, 80);
      ds_retorno_w := substr(ds_retorno_w || ' <br> ' || cpoe_add_span_mat_comp(ds_mat_proc1_w) ||
                             cpoe_add_span(qt_dose_mat1_p || ' ' || cd_unid_medida_dose_mat1_p),
                             1,
                             4000);
      if (ie_exibe_dil_p = 'S')
      then
        if (cd_mat_dil1_p IS NOT NULL AND cd_mat_dil1_p::text <> '')
        then
          ds_mat_dil1_w := substr(obter_desc_material(cd_mat_dil1_p), 1, 80);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || cpoe_add_span_mat_comp(ds_mat_dil1_w) ||
                                 cpoe_add_span(qt_dose_dil1_p || ' ' || cd_unid_medida_dose_dil1_p),
                                 1,
                                 4000);
        end if;

        if (cd_mat_recons1_p IS NOT NULL AND cd_mat_recons1_p::text <> '')
        then
          ds_mat_recons1_w := substr(obter_desc_material(cd_mat_recons1_p), 1, 80);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || cpoe_add_span_mat_comp(ds_mat_recons1_w) ||
                                 cpoe_add_span(qt_dose_recons1_p || ' ' || cd_unid_medida_dose_recons1_p),
                                 1,
                                 4000);
        end if;
      end if;
    end if;

    if (cd_mat_proc2_p IS NOT NULL AND cd_mat_proc2_p::text <> '') and (coalesce(ie_assoc_adep2_p, 'N') = 'N') and (coalesce(obter_tipo_material(cd_mat_proc2_p, 'C'), '1') <> '1')
    then
      ds_mat_proc2_w := substr(obter_desc_material(cd_mat_proc2_p), 1, 80);
      ds_retorno_w := substr(ds_retorno_w || ' <br> ' || cpoe_add_span_mat_comp(ds_mat_proc2_w) ||
                             cpoe_add_span(qt_dose_mat2_p || ' ' || cd_unid_medida_dose_mat2_p),
                             1,
                             4000);
      if (ie_exibe_dil_p = 'S')
      then
        if (cd_mat_dil2_p IS NOT NULL AND cd_mat_dil2_p::text <> '')
        then
          ds_mat_dil2_w := substr(obter_desc_material(cd_mat_dil2_p), 1, 80);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || cpoe_add_span_mat_comp(ds_mat_dil2_w) ||
                                 cpoe_add_span(qt_dose_dil2_p || ' ' || cd_unid_medida_dose_dil2_p),
                                 1,
                                 4000);
        end if;

        if (cd_mat_recons2_p IS NOT NULL AND cd_mat_recons2_p::text <> '')
        then
          ds_mat_recons2_w := substr(obter_desc_material(cd_mat_recons2_p), 1, 80);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || cpoe_add_span_mat_comp(ds_mat_recons2_w) ||
                                 cpoe_add_span(qt_dose_recons2_p || ' ' || cd_unid_medida_dose_recons2_p),
                                 1,
                                 4000);
        end if;
      end if;
    end if;

    if (cd_mat_proc3_p IS NOT NULL AND cd_mat_proc3_p::text <> '') and (coalesce(ie_assoc_adep3_p, 'N') = 'N') and (coalesce(obter_tipo_material(cd_mat_proc3_p, 'C'), '1') <> '1')
    then
      ds_mat_proc3_w := substr(obter_desc_material(cd_mat_proc3_p), 1, 80);
      ds_retorno_w := substr(ds_retorno_w || ' <br> ' || cpoe_add_span_mat_comp(ds_mat_proc3_w) ||
                             cpoe_add_span(qt_dose_mat3_p || ' ' || cd_unid_medida_dose_mat3_p),
                             1,
                             4000);
      if (ie_exibe_dil_p = 'S')
      then
        if (cd_mat_dil3_p IS NOT NULL AND cd_mat_dil3_p::text <> '')
        then
          ds_mat_dil3_w := substr(obter_desc_material(cd_mat_dil3_p), 1, 80);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || cpoe_add_span_mat_comp(ds_mat_dil3_w) ||
                                 cpoe_add_span(qt_dose_dil3_p || ' ' || cd_unid_medida_dose_dil3_p),
                                 1,
                                 4000);
        end if;

        if (cd_mat_recons3_p IS NOT NULL AND cd_mat_recons3_p::text <> '')
        then
          ds_mat_recons3_w := substr(obter_desc_material(cd_mat_recons3_p), 1, 80);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || cpoe_add_span_mat_comp(ds_mat_recons3_w) ||
                                 cpoe_add_span(qt_dose_recons3_p || ' ' || cd_unid_medida_dose_recons3_p),
                                 1,
                                 4000);
        end if;
      end if;
    end if;

    if (cd_mat_proc4_p IS NOT NULL AND cd_mat_proc4_p::text <> '') and (coalesce(ie_assoc_adep4_p, 'N') = 'N') and (coalesce(obter_tipo_material(cd_mat_proc4_p, 'C'), '1') <> '1')
    then
      ds_mat_proc4_w := substr(obter_desc_material(cd_mat_proc4_p), 1, 80);
      ds_retorno_w := substr(ds_retorno_w || ' <br> ' || cpoe_add_span_mat_comp(ds_mat_proc4_w) ||
                             cpoe_add_span(qt_dose_mat4_p || ' ' || cd_unid_medida_dose_mat4_p),
                             1,
                             4000);

      if (ie_exibe_dil_p = 'S')
      then
        if (cd_mat_dil4_p IS NOT NULL AND cd_mat_dil4_p::text <> '')
        then
          ds_mat_dil4_w := substr(obter_desc_material(cd_mat_dil4_p), 1, 80);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || cpoe_add_span_mat_comp(ds_mat_dil4_w) ||
                                 cpoe_add_span(qt_dose_dil4_p || ' ' || cd_unid_medida_dose_dil4_p),
                                 1,
                                 4000);
        end if;

        if (cd_mat_recons4_p IS NOT NULL AND cd_mat_recons4_p::text <> '')
        then
          ds_mat_recons4_w := substr(obter_desc_material(cd_mat_recons4_p), 1, 80);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || cpoe_add_span_mat_comp(ds_mat_recons4_w) ||
                                 cpoe_add_span(qt_dose_recons4_p || ' ' || cd_unid_medida_dose_recons4_p),
                                 1,
                                 4000);
        end if;
      end if;
    end if;

    if (cd_mat_proc5_p IS NOT NULL AND cd_mat_proc5_p::text <> '') and (coalesce(ie_assoc_adep5_p, 'N') = 'N') and (coalesce(obter_tipo_material(cd_mat_proc5_p, 'C'), '1') <> '1')
    then
      ds_mat_proc5_w := substr(obter_desc_material(cd_mat_proc5_p), 1, 80);
      ds_retorno_w := substr(ds_retorno_w || ' <br> ' || cpoe_add_span_mat_comp(ds_mat_proc5_w) ||
                             cpoe_add_span(qt_dose_mat5_p || ' ' || cd_unid_medida_dose_mat5_p),
                             1,
                             4000);
      if (ie_exibe_dil_p = 'S')
      then
        if (cd_mat_dil5_p IS NOT NULL AND cd_mat_dil5_p::text <> '')
        then
          ds_mat_dil5_w := substr(obter_desc_material(cd_mat_dil5_p), 1, 80);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || cpoe_add_span_mat_comp(ds_mat_dil5_w) ||
                                 cpoe_add_span(qt_dose_dil5_p || ' ' || cd_unid_medida_dose_dil5_p),
                                 1,
                                 4000);
        end if;

        if (cd_mat_recons5_p IS NOT NULL AND cd_mat_recons5_p::text <> '')
        then
          ds_mat_recons5_w := substr(obter_desc_material(cd_mat_recons5_p), 1, 80);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || cpoe_add_span_mat_comp(ds_mat_recons5_w) ||
                                 cpoe_add_span(qt_dose_recons5_p || ' ' || cd_unid_medida_dose_recons5_p),
                                 1,
                                 4000);
        end if;
      end if;
    end if;

    if (cd_mat_proc6_p IS NOT NULL AND cd_mat_proc6_p::text <> '') and (coalesce(ie_assoc_adep6_p, 'N') = 'N') and (coalesce(obter_tipo_material(cd_mat_proc6_p, 'C'), '1') <> '1')
    then
      ds_mat_proc6_w := substr(obter_desc_material(cd_mat_proc6_p), 1, 80);
      ds_retorno_w := substr(ds_retorno_w || ' <br> ' || cpoe_add_span_mat_comp(ds_mat_proc6_w) ||
                             cpoe_add_span(qt_dose_mat6_p || ' ' || cd_unid_medida_dose_mat6_p),
                             1,
                             4000);
      if (ie_exibe_dil_p = 'S')
      then
        if (cd_mat_dil6_p IS NOT NULL AND cd_mat_dil6_p::text <> '')
        then
          ds_mat_dil6_w := substr(obter_desc_material(cd_mat_dil6_p), 1, 80);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || cpoe_add_span_mat_comp(ds_mat_dil6_w) ||
                                 cpoe_add_span(qt_dose_dil6_p || ' ' || cd_unid_medida_dose_dil6_p),
                                 1,
                                 4000);
        end if;

        if (cd_mat_recons6_p IS NOT NULL AND cd_mat_recons6_p::text <> '')
        then
          ds_mat_recons6_w := substr(obter_desc_material(cd_mat_recons6_p), 1, 80);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || cpoe_add_span_mat_comp(ds_mat_recons6_w) ||
                                 cpoe_add_span(qt_dose_recons6_p || ' ' || cd_unid_medida_dose_recons6_p),
                                 1,
                                 4000);
        end if;
      end if;
    end if;

    if (cd_mat_proc7_p IS NOT NULL AND cd_mat_proc7_p::text <> '') and (coalesce(ie_assoc_adep7_p, 'N') = 'N') and (coalesce(obter_tipo_material(cd_mat_proc7_p, 'C'), '1') <> '1')
    then
      ds_mat_proc7_w := substr(obter_desc_material(cd_mat_proc7_p), 1, 80);
      ds_retorno_w := substr(ds_retorno_w || ' <br> ' || cpoe_add_span_mat_comp(ds_mat_proc7_w) ||
                             cpoe_add_span(qt_dose_mat7_p || ' ' || cd_unid_medida_dose_mat7_p),
                             1,
                             4000);
      if (ie_exibe_dil_p = 'S')
      then
        if (cd_mat_dil7_p IS NOT NULL AND cd_mat_dil7_p::text <> '')
        then
          ds_mat_dil7_w := substr(obter_desc_material(cd_mat_dil7_p), 1, 80);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || cpoe_add_span_mat_comp(ds_mat_dil7_w) ||
                                 cpoe_add_span(qt_dose_dil7_p || ' ' || cd_unid_medida_dose_dil7_p),
                                 1,
                                 4000);
        end if;

        if (cd_mat_recons7_p IS NOT NULL AND cd_mat_recons7_p::text <> '')
        then
          ds_mat_recons7_w := substr(obter_desc_material(cd_mat_recons7_p), 1, 80);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || cpoe_add_span_mat_comp(ds_mat_recons7_w) ||
                                 cpoe_add_span(qt_dose_recons7_p || ' ' || cd_unid_medida_dose_recons7_p),
                                 1,
                                 4000);
        end if;
      end if;
    end if;

    open c_01;
    loop
      fetch c_01
        into ds_exame_w;
      EXIT WHEN NOT FOUND; /* apply on c_01 */
      begin
        ds_retorno_w := substr(ds_retorno_w || ' <br> ' || ds_exame_w, 1, 4000);
      end;
    end loop;
    close c_01;

  else

    ds_retorno_w := ds_retorno_w || cpoe_add_span(wheb_mensagem_pck.get_texto(458428) || qt_procedimento_p);

    if (ds_lado_p IS NOT NULL AND ds_lado_p::text <> '')
    then
      ds_retorno_w := ds_retorno_w || cpoe_add_span(ds_lado_p);
    end if;

    if (cd_mat_proc1_p IS NOT NULL AND cd_mat_proc1_p::text <> '') and (coalesce(ie_assoc_adep1_p, 'N') = 'N') and (coalesce(obter_tipo_material(cd_mat_proc1_p, 'C'), '1') <> '1')
    then
      ds_mat_proc1_w := substr(obter_desc_material(cd_mat_proc1_p), 1, 80);
	  ie_dbcheck_mat_proc1_w := obter_se_medic_dupla_chec(cd_mat_proc1_p, wheb_usuario_pck.get_cd_estabelecimento, null);
      ds_retorno_w := substr(ds_retorno_w || ' <br> ' || adep_add_span_mat_comp(ds_mat_proc1_w) ||
                             cpoe_add_span(qt_dose_mat1_p || ' ' || obter_desc_unid_med(cd_unid_medida_dose_mat1_p)),
                             1,
                             4000);
      if (ie_exibe_dil_p = 'S')
      then
        if (cd_mat_dil1_p IS NOT NULL AND cd_mat_dil1_p::text <> '')
        then
          ds_mat_dil1_w := substr(obter_desc_material(cd_mat_dil1_p), 1, 80);
		  ie_dbcheck_mat_dil1_w := obter_se_medic_dupla_chec(cd_mat_dil1_p, wheb_usuario_pck.get_cd_estabelecimento, null);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || adep_add_span_mat_comp(ds_mat_dil1_w) ||
                                 cpoe_add_span(qt_dose_dil1_p || ' ' || obter_desc_unid_med(cd_unid_medida_dose_dil1_p)),
                                 1,
                                 4000);
        end if;

        if (cd_mat_recons1_p IS NOT NULL AND cd_mat_recons1_p::text <> '')
        then
          ds_mat_recons1_w := substr(obter_desc_material(cd_mat_recons1_p), 1, 80);
		  ie_dbcheck_mat_recons1_w := obter_se_medic_dupla_chec(cd_mat_recons1_p, wheb_usuario_pck.get_cd_estabelecimento, null);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || adep_add_span_mat_comp(ds_mat_recons1_w) ||
                                 cpoe_add_span(qt_dose_recons1_p || ' ' ||
                                               obter_desc_unid_med(cd_unid_medida_dose_recons1_p)),
                                 1,
                                 4000);
        end if;
      end if;
    end if;

    if (cd_mat_proc2_p IS NOT NULL AND cd_mat_proc2_p::text <> '') and (coalesce(ie_assoc_adep2_p, 'N') = 'N') and (coalesce(obter_tipo_material(cd_mat_proc2_p, 'C'), '1') <> '1')
    then
      ds_mat_proc2_w := substr(obter_desc_material(cd_mat_proc2_p), 1, 80);
	  ie_dbcheck_mat_proc2_w := obter_se_medic_dupla_chec(cd_mat_proc2_p, wheb_usuario_pck.get_cd_estabelecimento, null);
      ds_retorno_w := substr(ds_retorno_w || ' <br> ' || adep_add_span_mat_comp(ds_mat_proc2_w) ||
                             cpoe_add_span(qt_dose_mat2_p || ' ' || obter_desc_unid_med(cd_unid_medida_dose_mat2_p)),
                             1,
                             4000);
      if (ie_exibe_dil_p = 'S')
      then
        if (cd_mat_dil2_p IS NOT NULL AND cd_mat_dil2_p::text <> '')
        then
          ds_mat_dil2_w := substr(obter_desc_material(cd_mat_dil2_p), 1, 80);
		  ie_dbcheck_mat_dil2_w := obter_se_medic_dupla_chec(cd_mat_dil2_p, wheb_usuario_pck.get_cd_estabelecimento, null);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || adep_add_span_mat_comp(ds_mat_dil2_w) ||
                                 cpoe_add_span(qt_dose_dil2_p || ' ' || obter_desc_unid_med(cd_unid_medida_dose_dil2_p)),
                                 1,
                                 4000);
        end if;

        if (cd_mat_recons2_p IS NOT NULL AND cd_mat_recons2_p::text <> '')
        then
          ds_mat_recons2_w := substr(obter_desc_material(cd_mat_recons2_p), 1, 80);
		  ie_dbcheck_mat_recons2_w := obter_se_medic_dupla_chec(cd_mat_recons2_p, wheb_usuario_pck.get_cd_estabelecimento, null);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || adep_add_span_mat_comp(ds_mat_recons2_w) ||
                                 cpoe_add_span(qt_dose_recons2_p || ' ' ||
                                               obter_desc_unid_med(cd_unid_medida_dose_recons2_p)),
                                 1,
                                 4000);
        end if;
      end if;
    end if;

    if (cd_mat_proc3_p IS NOT NULL AND cd_mat_proc3_p::text <> '') and (coalesce(ie_assoc_adep3_p, 'N') = 'N') and (coalesce(obter_tipo_material(cd_mat_proc3_p, 'C'), '1') <> '1')
    then
      ds_mat_proc3_w := substr(obter_desc_material(cd_mat_proc3_p), 1, 80);
	  ie_dbcheck_mat_proc3_w := obter_se_medic_dupla_chec(cd_mat_proc3_p, wheb_usuario_pck.get_cd_estabelecimento, null);
      ds_retorno_w := substr(ds_retorno_w || ' <br> ' || adep_add_span_mat_comp(ds_mat_proc3_w) ||
                             cpoe_add_span(qt_dose_mat3_p || ' ' || obter_desc_unid_med(cd_unid_medida_dose_mat3_p)),
                             1,
                             4000);
      if (ie_exibe_dil_p = 'S')
      then
        if (cd_mat_dil3_p IS NOT NULL AND cd_mat_dil3_p::text <> '')
        then
          ds_mat_dil3_w := substr(obter_desc_material(cd_mat_dil3_p), 1, 80);
		  ie_dbcheck_mat_dil3_w := obter_se_medic_dupla_chec(cd_mat_dil3_p, wheb_usuario_pck.get_cd_estabelecimento, null);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || adep_add_span_mat_comp(ds_mat_dil3_w) ||
                                 cpoe_add_span(qt_dose_dil3_p || ' ' || obter_desc_unid_med(cd_unid_medida_dose_dil3_p)),
                                 1,
                                 4000);
        end if;

        if (cd_mat_recons3_p IS NOT NULL AND cd_mat_recons3_p::text <> '')
        then
          ds_mat_recons3_w := substr(obter_desc_material(cd_mat_recons3_p), 1, 80);
		  ie_dbcheck_mat_recons3_w := obter_se_medic_dupla_chec(cd_mat_recons3_p, wheb_usuario_pck.get_cd_estabelecimento, null);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || adep_add_span_mat_comp(ds_mat_recons3_w) ||
                                 cpoe_add_span(qt_dose_recons3_p || ' ' ||
                                               obter_desc_unid_med(cd_unid_medida_dose_recons3_p)),
                                 1,
                                 4000);
        end if;
      end if;
    end if;

    if (cd_mat_proc4_p IS NOT NULL AND cd_mat_proc4_p::text <> '') and (coalesce(ie_assoc_adep4_p, 'N') = 'N') and (coalesce(obter_tipo_material(cd_mat_proc4_p, 'C'), '1') <> '1')
    then
      ds_mat_proc4_w := substr(obter_desc_material(cd_mat_proc4_p), 1, 80);
	  ie_dbcheck_mat_proc4_w := obter_se_medic_dupla_chec(cd_mat_proc4_p, wheb_usuario_pck.get_cd_estabelecimento, null);
      ds_retorno_w := substr(ds_retorno_w || ' <br> ' || adep_add_span_mat_comp(ds_mat_proc4_w) ||
                             cpoe_add_span(qt_dose_mat4_p || ' ' || obter_desc_unid_med(cd_unid_medida_dose_mat4_p)),
                             1,
                             4000);

      if (ie_exibe_dil_p = 'S')
      then
        if (cd_mat_dil4_p IS NOT NULL AND cd_mat_dil4_p::text <> '')
        then
          ds_mat_dil4_w := substr(obter_desc_material(cd_mat_dil4_p), 1, 80);
		  ie_dbcheck_mat_dil4_w := obter_se_medic_dupla_chec(cd_mat_dil4_p, wheb_usuario_pck.get_cd_estabelecimento, null);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || adep_add_span_mat_comp(ds_mat_dil4_w) ||
                                 cpoe_add_span(qt_dose_dil4_p || ' ' || obter_desc_unid_med(cd_unid_medida_dose_dil4_p)),
                                 1,
                                 4000);
        end if;

        if (cd_mat_recons4_p IS NOT NULL AND cd_mat_recons4_p::text <> '')
        then
          ds_mat_recons4_w := substr(obter_desc_material(cd_mat_recons4_p), 1, 80);
		  ie_dbcheck_mat_recons4_w := obter_se_medic_dupla_chec(cd_mat_recons4_p, wheb_usuario_pck.get_cd_estabelecimento, null);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || adep_add_span_mat_comp(ds_mat_recons4_w) ||
                                 cpoe_add_span(qt_dose_recons4_p || ' ' ||
                                               obter_desc_unid_med(cd_unid_medida_dose_recons4_p)),
                                 1,
                                 4000);
        end if;
      end if;
    end if;

    if (cd_mat_proc5_p IS NOT NULL AND cd_mat_proc5_p::text <> '') and (coalesce(ie_assoc_adep5_p, 'N') = 'N') and (coalesce(obter_tipo_material(cd_mat_proc5_p, 'C'), '1') <> '1')
    then
      ds_mat_proc5_w := substr(obter_desc_material(cd_mat_proc5_p), 1, 80);
	  ie_dbcheck_mat_proc5_w := obter_se_medic_dupla_chec(cd_mat_proc5_p, wheb_usuario_pck.get_cd_estabelecimento, null);
      ds_retorno_w := substr(ds_retorno_w || ' <br> ' || adep_add_span_mat_comp(ds_mat_proc5_w) ||
                             cpoe_add_span(qt_dose_mat5_p || ' ' || obter_desc_unid_med(cd_unid_medida_dose_mat5_p)),
                             1,
                             4000);
      if (ie_exibe_dil_p = 'S')
      then
        if (cd_mat_dil5_p IS NOT NULL AND cd_mat_dil5_p::text <> '')
        then
          ds_mat_dil5_w := substr(obter_desc_material(cd_mat_dil5_p), 1, 80);
		  ie_dbcheck_mat_dil5_w := obter_se_medic_dupla_chec(cd_mat_dil5_p, wheb_usuario_pck.get_cd_estabelecimento, null);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || adep_add_span_mat_comp(ds_mat_dil5_w) ||
                                 cpoe_add_span(qt_dose_dil5_p || ' ' || obter_desc_unid_med(cd_unid_medida_dose_dil5_p)),
                                 1,
                                 4000);
        end if;

        if (cd_mat_recons5_p IS NOT NULL AND cd_mat_recons5_p::text <> '')
        then
          ds_mat_recons5_w := substr(obter_desc_material(cd_mat_recons5_p), 1, 80);
		  ie_dbcheck_mat_recons5_w := obter_se_medic_dupla_chec(cd_mat_recons5_p, wheb_usuario_pck.get_cd_estabelecimento, null);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || adep_add_span_mat_comp(ds_mat_recons5_w) ||
                                 cpoe_add_span(qt_dose_recons5_p || ' ' ||
                                               obter_desc_unid_med(cd_unid_medida_dose_recons5_p)),
                                 1,
                                 4000);
        end if;
      end if;
    end if;

    if (cd_mat_proc6_p IS NOT NULL AND cd_mat_proc6_p::text <> '') and (coalesce(ie_assoc_adep6_p, 'N') = 'N') and (coalesce(obter_tipo_material(cd_mat_proc6_p, 'C'), '1') <> '1')
    then
      ds_mat_proc6_w := substr(obter_desc_material(cd_mat_proc6_p), 1, 80);
	  ie_dbcheck_mat_proc6_w := obter_se_medic_dupla_chec(cd_mat_proc6_p, wheb_usuario_pck.get_cd_estabelecimento, null);
      ds_retorno_w := substr(ds_retorno_w || ' <br> ' || adep_add_span_mat_comp(ds_mat_proc6_w) ||
                             cpoe_add_span(qt_dose_mat6_p || ' ' || obter_desc_unid_med(cd_unid_medida_dose_mat6_p)),
                             1,
                             4000);
      if (ie_exibe_dil_p = 'S')
      then
        if (cd_mat_dil6_p IS NOT NULL AND cd_mat_dil6_p::text <> '')
        then
          ds_mat_dil6_w := substr(obter_desc_material(cd_mat_dil6_p), 1, 80);
		  ie_dbcheck_mat_dil6_w := obter_se_medic_dupla_chec(cd_mat_dil6_p, wheb_usuario_pck.get_cd_estabelecimento, null);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || adep_add_span_mat_comp(ds_mat_dil6_w) ||
                                 cpoe_add_span(qt_dose_dil6_p || ' ' || obter_desc_unid_med(cd_unid_medida_dose_dil6_p)),
                                 1,
                                 4000);
        end if;

        if (cd_mat_recons6_p IS NOT NULL AND cd_mat_recons6_p::text <> '')
        then
          ds_mat_recons6_w := substr(obter_desc_material(cd_mat_recons6_p), 1, 80);
		  ie_dbcheck_mat_recons6_w := obter_se_medic_dupla_chec(cd_mat_recons6_p, wheb_usuario_pck.get_cd_estabelecimento, null);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || adep_add_span_mat_comp(ds_mat_recons6_w) ||
                                 cpoe_add_span(qt_dose_recons6_p || ' ' ||
                                               obter_desc_unid_med(cd_unid_medida_dose_recons6_p)),
                                 1,
                                 4000);
        end if;
      end if;
    end if;

    if (cd_mat_proc7_p IS NOT NULL AND cd_mat_proc7_p::text <> '') and (coalesce(ie_assoc_adep7_p, 'N') = 'N') and (coalesce(obter_tipo_material(cd_mat_proc7_p, 'C'), '1') <> '1')
    then
      ds_mat_proc7_w := substr(obter_desc_material(cd_mat_proc7_p), 1, 80);
	  ie_dbcheck_mat_proc7_w := obter_se_medic_dupla_chec(cd_mat_proc7_p, wheb_usuario_pck.get_cd_estabelecimento, null);
      ds_retorno_w := substr(ds_retorno_w || ' <br> ' || adep_add_span_mat_comp(ds_mat_proc7_w) ||
                             cpoe_add_span(qt_dose_mat7_p || ' ' || obter_desc_unid_med(cd_unid_medida_dose_mat7_p)),
                             1,
                             4000);
      if (ie_exibe_dil_p = 'S')
      then
        if (cd_mat_dil7_p IS NOT NULL AND cd_mat_dil7_p::text <> '')
        then
          ds_mat_dil7_w := substr(obter_desc_material(cd_mat_dil7_p), 1, 80);
		  ie_dbcheck_mat_dil7_w := obter_se_medic_dupla_chec(cd_mat_dil7_p, wheb_usuario_pck.get_cd_estabelecimento, null);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || adep_add_span_mat_comp(ds_mat_dil7_w) ||
                                 cpoe_add_span(qt_dose_dil7_p || ' ' || obter_desc_unid_med(cd_unid_medida_dose_dil7_p)),
                                 1,
                                 4000);
        end if;

        if (cd_mat_recons7_p IS NOT NULL AND cd_mat_recons7_p::text <> '')
        then
          ds_mat_recons7_w := substr(obter_desc_material(cd_mat_recons7_p), 1, 80);
		  ie_dbcheck_mat_recons7_w := obter_se_medic_dupla_chec(cd_mat_recons7_p, wheb_usuario_pck.get_cd_estabelecimento, null);
          ds_retorno_w := substr(ds_retorno_w || ' <br> ' || adep_add_span_mat_comp(ds_mat_recons7_w) ||
                                 cpoe_add_span(qt_dose_recons7_p || ' ' ||
                                               obter_desc_unid_med(cd_unid_medida_dose_recons7_p)),
                                 1,
                                 4000);
        end if;
      end if;
    end if;

  end if;

  if ((dt_lib_suspensao_p IS NOT NULL AND dt_lib_suspensao_p::text <> '')        and (dt_suspensao_p IS NOT NULL AND dt_suspensao_p::text <> '')             and (dt_suspensao_p <= clock_timestamp())              and (ie_adep_p <> 'S'))                      or
     ((coalesce(dt_lib_suspensao_p::text, '') = '')            and (dt_fim_grid_p <= clock_timestamp())               and 
     ie_adep_p = 'N')
  then
    ds_retorno_w := '<del> ' || substr(ds_retorno_w, 1, 3988) || '</del>';
  end if;

ds_retorno_w := ds_retorno_w || obter_se_item_futuro(nr_seq_cpoe_p, ie_revalidacao_p);

if (ie_adep_p = 'S' and (ie_dbcheck_mat_proc1_w = 'S' or ie_dbcheck_mat_proc2_w = 'S' or ie_dbcheck_mat_proc3_w = 'S' or ie_dbcheck_mat_proc4_w = 'S' or
	ie_dbcheck_mat_proc5_w = 'S' or ie_dbcheck_mat_proc6_w = 'S' or ie_dbcheck_mat_proc7_w = 'S' or
	ie_dbcheck_mat_dil1_w = 'S' or ie_dbcheck_mat_dil2_w = 'S' or ie_dbcheck_mat_dil3_w = 'S' or ie_dbcheck_mat_dil4_w = 'S' or
	ie_dbcheck_mat_dil5_w = 'S' or ie_dbcheck_mat_dil6_w = 'S' or ie_dbcheck_mat_dil7_w = 'S' or
	ie_dbcheck_mat_recons1_w = 'S' or ie_dbcheck_mat_recons2_w = 'S' or	ie_dbcheck_mat_recons3_w = 'S' or ie_dbcheck_mat_recons4_w = 'S' or
	ie_dbcheck_mat_recons5_w = 'S' or ie_dbcheck_mat_recons6_w= 'S' or ie_dbcheck_mat_recons7_w = 'S')) then
	ds_retorno_w := ds_retorno_w || verifyDoubleCheckItem('S');
end if;

select	count(*)
into STRICT	rule_quantity_w
from	cpoe_regra_ator LIMIT 1;
		
if (rule_quantity_w > 0 and (nr_seq_cpoe_p IS NOT NULL AND nr_seq_cpoe_p::text <> '')) then
	ds_retorno_w := ds_retorno_w || get_order_interface('P',nr_seq_cpoe_p);
end if;

return ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_obter_desc_grid_proc (ds_procedimento_p text, ds_intervalo_p text, qt_procedimento_p bigint, cd_mat_proc1_p bigint, qt_dose_mat1_p bigint, cd_unid_medida_dose_mat1_p text, ie_assoc_adep1_p text, cd_mat_proc2_p bigint, qt_dose_mat2_p bigint, cd_unid_medida_dose_mat2_p text, ie_assoc_adep2_p text, cd_mat_proc3_p bigint, qt_dose_mat3_p bigint, cd_unid_medida_dose_mat3_p text, ie_assoc_adep3_p text, cd_mat_proc4_p bigint, qt_dose_mat4_p bigint, cd_unid_medida_dose_mat4_p text, ie_assoc_adep4_p text, cd_mat_proc5_p bigint, qt_dose_mat5_p bigint, cd_unid_medida_dose_mat5_p text, ie_assoc_adep5_p text, dt_lib_suspensao_p timestamp default null, dt_suspensao_p timestamp default null, ie_administracao_p text default null, dt_inicio_p timestamp default null, ie_apresenta_exec_hoje_p text default 'N', cd_mat_proc6_p bigint default null, qt_dose_mat6_p bigint default null, cd_unid_medida_dose_mat6_p text default null, ie_assoc_adep6_p text default null, cd_mat_proc7_p bigint default null, qt_dose_mat7_p bigint default null, cd_unid_medida_dose_mat7_p text default null, ie_assoc_adep7_p text default null, cd_mat_dil1_p bigint default null, qt_dose_dil1_p bigint default null, cd_unid_medida_dose_dil1_p text default null, cd_mat_dil2_p bigint default null, qt_dose_dil2_p bigint default null, cd_unid_medida_dose_dil2_p text default null, cd_mat_dil3_p bigint default null, qt_dose_dil3_p bigint default null, cd_unid_medida_dose_dil3_p text default null, cd_mat_dil4_p bigint default null, qt_dose_dil4_p bigint default null, cd_unid_medida_dose_dil4_p text default null, cd_mat_dil5_p bigint default null, qt_dose_dil5_p bigint default null, cd_unid_medida_dose_dil5_p text default null, cd_mat_dil6_p bigint default null, qt_dose_dil6_p bigint default null, cd_unid_medida_dose_dil6_p text default null, cd_mat_dil7_p bigint default null, qt_dose_dil7_p bigint default null, cd_unid_medida_dose_dil7_p text default null, cd_mat_recons1_p bigint default null, qt_dose_recons1_p bigint default null, cd_unid_medida_dose_recons1_p text default null, cd_mat_recons2_p bigint default null, qt_dose_recons2_p bigint default null, cd_unid_medida_dose_recons2_p text default null, cd_mat_recons3_p bigint default null, qt_dose_recons3_p bigint default null, cd_unid_medida_dose_recons3_p text default null, cd_mat_recons4_p bigint default null, qt_dose_recons4_p bigint default null, cd_unid_medida_dose_recons4_p text default null, cd_mat_recons5_p bigint default null, qt_dose_recons5_p bigint default null, cd_unid_medida_dose_recons5_p text default null, cd_mat_recons6_p bigint default null, qt_dose_recons6_p bigint default null, cd_unid_medida_dose_recons6_p text default null, cd_mat_recons7_p bigint default null, qt_dose_recons7_p bigint default null, cd_unid_medida_dose_recons7_p text default null, ie_baixado_por_alta_p cpoe_procedimento.ie_baixado_por_alta%type default null, dt_alta_medico_p cpoe_procedimento.dt_alta_medico%type default null, ie_exibe_dil_p text default 'S', ie_adep_p text default 'N', ds_lado_p text default null, ds_horarios_p cpoe_procedimento.ds_horarios%type default null, nr_sequencia_p bigint default null, nr_seq_prot_glic bigint default null, parenteses_p text default 'N', ie_urgencia_p cpoe_procedimento.ie_urgencia%type default null, ie_pre_cons_exam_p cpoe_procedimento.ie_pre_cons_exam%type default null, cd_material_exame_p text default null, dt_fim_grid_p timestamp default null, ie_revalidacao_p text default 'N', nr_seq_cpoe_p cpoe_procedimento.nr_sequencia%type default null) FROM PUBLIC;

