-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obtem_se_tele_terc ( NR_SEQ_AGECONS_P NUMERIC ) RETURNS varchar AS $body$
DECLARE

  IE_UTILIZA_TELEMEDICINA_W AGENDA_CLASSIF.IE_UTILIZA_TELEMEDICINA%TYPE := NULL;
  IE_INTEGRA_TELEMEDICINA_W AGENDA_CLASSIF.IE_UTILIZA_TELEMEDICINA%TYPE := 'N';

BEGIN
  SELECT
    coalesce(MAX(B.IE_UTILIZA_TELEMEDICINA), 'N') IE_UTILIZA_TELEMEDICINA
  INTO STRICT
    IE_UTILIZA_TELEMEDICINA_W
  FROM AGENDA_CONSULTA A 
  INNER JOIN AGENDA_CLASSIF B ON (
    A.IE_CLASSIF_AGENDA = B.CD_CLASSIFICACAO
  )
  WHERE
    A.NR_SEQUENCIA = NR_SEQ_AGECONS_P;

  IF (IE_UTILIZA_TELEMEDICINA_W = 'S') THEN
    SELECT
      (CASE WHEN (MAX(DS_URL_TELE_TERC) IS NOT NULL AND (MAX(DS_URL_TELE_TERC))::text <> '') THEN 'S' ELSE 'N' END) IE_INTEGRA_TELEMEDICINA
    INTO STRICT
      IE_INTEGRA_TELEMEDICINA_W
    FROM AGENDA_CONSULTA_ADIC A
    WHERE
      A.NR_SEQ_AGENDA = NR_SEQ_AGECONS_P;
  END IF;

  RETURN IE_INTEGRA_TELEMEDICINA_W;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obtem_se_tele_terc ( NR_SEQ_AGECONS_P NUMERIC ) FROM PUBLIC;

