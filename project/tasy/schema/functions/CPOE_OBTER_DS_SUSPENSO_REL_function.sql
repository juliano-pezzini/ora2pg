-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cpoe_obter_ds_suspenso_rel (nr_sequencia_p bigint, ie_tipo_item_p text, dt_inicial_p timestamp, dt_fim_p timestamp, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE

									 
dt_inicial_w		timestamp;
dt_suspensao_w		timestamp;
dt_lib_suspensao_w	timestamp;
qt_horas_ant_w		cpoe_presentation_rule.qt_horas_anteriores%type := 0;


BEGIN 
 
 
if (coalesce(nr_sequencia_p,0) > 0) then 
	 
	dt_suspensao_w := cpoe_obter_dt_suspensao(nr_sequencia_p,ie_tipo_item_p);
	dt_lib_suspensao_w := cpoe_obter_dt_lib_suspensao(nr_sequencia_p,ie_tipo_item_p);
 
	if ((dt_inicial_p <> clock_timestamp()) and (trunc(dt_inicial_p + cpoe_obter_quant_horas_ant(obter_perfil_ativo)) = trunc(clock_timestamp())))then 
		qt_horas_ant_w := cpoe_obter_quant_horas_ant(obter_perfil_ativo);
	end if;
	 
	if	(((dt_suspensao_w IS NOT NULL AND dt_suspensao_w::text <> '') and (dt_lib_suspensao_w IS NOT NULL AND dt_lib_suspensao_w::text <> '') and (ie_opcao_p = 'S')) and 
			(trunc(dt_inicial_p + (qt_horas_ant_w/24)) >= trunc(dt_lib_suspensao_w))) then 
	 
		return ' ( ' || upper(wheb_mensagem_pck.get_texto(670558))|| ' ' ||upper(obter_desc_expressao(283041, ''))|| ' ' || to_char(dt_suspensao_w, 'dd/mm hh24:mi')|| ' ) ';
 
	end if;
end if;
 
return	'';
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_obter_ds_suspenso_rel (nr_sequencia_p bigint, ie_tipo_item_p text, dt_inicial_p timestamp, dt_fim_p timestamp, ie_opcao_p text) FROM PUBLIC;

