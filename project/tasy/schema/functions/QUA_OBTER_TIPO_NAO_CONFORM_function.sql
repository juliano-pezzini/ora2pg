-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION qua_obter_tipo_nao_conform ( nr_seq_tipo_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


ie_acao_imediata_w		varchar(3);
ie_causa_w			varchar(3);
ie_acao_w			varchar(3);
ie_eficacia_w			varchar(3);
ie_setor_envolvido_w		varchar(3);
ie_ativ_prevista_acao_w	varchar(3);
ie_ativ_real_acao_w		varchar(3);
ds_retorno_w			varchar(3);

/* Opção
I - Ação imediata
C - Causa
A - Ação
E - Eficácia
S - Setores envolvidos
P - Atividade Prevista Ação
R - Atividade Realizada Ação
*/
C01 CURSOR FOR
	SELECT	coalesce(max(ie_acao_imediata), 'OB'),
		coalesce(max(ie_causa), 'OB'),
		coalesce(max(ie_acao), 'OB'),
		coalesce(max(ie_eficacia), 'OB'),
		coalesce(max(ie_setor_envolvido), 'OB'),
		coalesce(max(ie_ativ_prevista_acao), 'OB'),
		coalesce(max(ie_ativ_real_acao), 'OB')
	from	qua_tipo_nao_conform
	where	nr_sequencia = nr_seq_tipo_p;


BEGIN

open c01;
loop
fetch c01 into
	ie_acao_imediata_w,
	ie_causa_w,
	ie_acao_w,
	ie_eficacia_w,
	ie_setor_envolvido_w,
	ie_ativ_prevista_acao_w,
	ie_ativ_real_acao_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin
	if (ie_opcao_p = 'I') then
		ds_retorno_w	:= ie_acao_imediata_w;
	elsif (ie_opcao_p = 'C') then
		ds_retorno_w	:= ie_causa_w;
	elsif (ie_opcao_p = 'A') then
		ds_retorno_w	:= ie_acao_w;
	elsif (ie_opcao_p = 'E') then
		ds_retorno_w	:= ie_eficacia_w;
	elsif (ie_opcao_p = 'S') then
		ds_retorno_w	:= ie_setor_envolvido_w;
	elsif (ie_opcao_p = 'P') then
		ds_retorno_w	:= ie_ativ_prevista_acao_w;
	elsif (ie_opcao_p = 'R') then
		ds_retorno_w	:= ie_ativ_real_acao_w;
	end if;
	end;
end loop;
close c01;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION qua_obter_tipo_nao_conform ( nr_seq_tipo_p bigint, ie_opcao_p text) FROM PUBLIC;

