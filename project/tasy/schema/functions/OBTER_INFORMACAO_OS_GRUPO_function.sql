-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_informacao_os_grupo (dt_parametro_p timestamp, nr_seq_grupo_des_p bigint, ie_tipo_inf_p text, ie_tipo_valor_p text, ie_area_gerencia_p text default 'DES,TEC') RETURNS bigint AS $body$
DECLARE


/*
ie_tipo_inf_p
QT - Quantidade total de OS no mes
QTD - Quantidade total de OS no mes do desenvolvimento
ER - Quantidade total de Erros no mes
ERI- Quantidade de erros identificados internamente na wheb
ERE-Quantidade de erros identificados externamente pelo cliente
QTI - Quantidade total de Insatisfacao no mes
QTY - Quantidade total de Insatisfacao no mes do desenvolvimento
QTDPE - Quantidade media de defeitos por pessoa do grupo
PRI - Percentual de insatisfacao
EN - Quantidade total de OS encerrada
ENS - Quantidade total de OS encerrada com satisfacao
PR - Percentual de erro no mes
PRIN- Percentual de erro no mes identificados internamente na Philips
PREX- Percentual de erro no mes identificados externamente pelos clientes
VEVOS - Quantidade de O.Ss de defeito do setor de VeV
PHIOS - Quantidade de O.Ss de defeito identificados na Philips que nao sao do VV
PRVEV - Percentual de O.Ss de defeito do setor de VeV
PRPHI - Percentual de O.Ss de defeito identificados na Philips que nao sao do VV
PRANTIGA - Percental de OSs antigas pendentes no desenvolvimento
QTANTIGA - Quantidade de OSs antigas pendentes no desenvolvimento
QTSLA - Quantidade de SLA pendentes no desenvolvimento.
QTBACKLOGDEF = Quantidade de defeitos pendentes no desenvolvimento
QTBACKLOG - Quantidade de OSs pendentes no desenvolvimento no momento.
QTANNE - Quantidade de analistas de negocio
QTANSI - Quantidade de analistas de sistema
QTANMA - Quantidade de analistas de manutencao
QTPROG - Quantidade de programadores
QTESTA - Quantidade de estagiarios
QAUSEN - Quantidade de pessoas ausentes no perido (ferias ou afastamentos atestados por periodo maiores.)
QTHORADIA - Quantidade de horas registradas em ordens de servico por dia no periodo
QTHORAOS - Quantidade de horas registradas para encerrar cada ordens de servico no periodo
QTHORADIA - Quantidade de horas registradas em ordens de servico por dia no periodo
QTHORAOSINT - Quantidade de horas registradas para encerrar cada ordens de servico interna (aberta pela Philips) no periodo
QTHORAOSCLI - Quantidade de horas registradas para encerrar cada ordens de servico externa (aberta pelo cliente) no periodo
QTRECEBDIA - Quantidade de OSs recebidas no dia corrente.
QTRECEBDIACLI - Quantidade de OSs recebidas no dia corrente abertas por clientes
QTRECEBDIAINT - Quantidade de OSs recebidas no dia corrente abertas internamente
QTRECCLI - Quantidade de OSs recebidas dos clientes. Fora OSs abertas internamente.
QTRECINT - Quantidade de OSs abertas internamente na Philips.
QTBACKCLI - Quantidade de OSs pendentes no desenvolvimento que foram abertas pelos clientes
QTBACKINT - Quantidade de OSs pendentes no desenvolvimento que foram abertas internamente pela Philips.
QTBACKPENDCLI - Quantidade de OSs que passaram pelo desenvolvimento e que no momento estao pendentes com o cliente.
QTBACKPENDVEV - Quantidade de OSs que foram customizadas pelo desenvolvimento e que estao pendentes de testes pelo VeV
CAEU 	- Total de OS encerrada, classificadas com complexidade Alta, Muito alta ou Alto risco vinculadas ao grupo.
QTHE - Total de horas extras do grupo no periodo.
MEHEPF - Media de hora extra por pessoa.
QTNET - Quantidade de NETs documentados no periodo.
PRINOV - Percentual de horas trabalhadas em OSs de inivacao que agregam valor ao produto
QTPESSOA - Quantidade de pessoas no ultimo dia de cada mes no periodo (descontando apenas os gerentes)
QTPFPRODUT - Quantidade de pessoas produtivas no ultimo dia de cada mes descontando gerente, estagiarios e pessoas ausentes.
QTPFDELPHI - Quantidade de pessoas trabalhando em OS de Delphi fora projetos capitalizaveis
QTPFJAVA - Quantidade de pessoas trabalhando em OS de Java fora projetos capitalizaveis
QTPFHTML5 - Quantidade de pessoas trabalhando em OS de HTML5 fora projetos capitalizaveis
QFPFCAP - Quantidade de pessoas trabalhando em OSs vinculadas em projetos capitalizaveis
*/
qt_total_os_w			double precision;
qt_total_tec_w			double precision := 0;
qt_erro_w			double precision;
qt_retorno_w			double precision;
qt_os_encerrada_w		double precision;
qt_os_encerrada_classif_w	double precision;
qt_os_insatisf_w		double precision;
dt_ref_mes_w			timestamp;
dt_fim_mes_w			timestamp;
dt_inicio_w			timestamp;
dt_final_w			timestamp;
qt_os_vev_w			double precision := 0;
qt_os_philips_w			double precision := 0;
qt_pessoas_w			double precision;
ds_sep_bv_w			varchar(30)	:= obter_separador_bv;
qt_dias_util_w			bigint;


BEGIN

dt_ref_mes_w			:= PKG_DATE_UTILS.start_of(dt_parametro_p,'month',0);
dt_fim_mes_w			:= PKG_DATE_UTILS.END_OF(dt_ref_mes_w, 'MONTH', 0);

if (ie_tipo_valor_p	= 'A') then /*Mes corrente*/
	dt_ref_mes_w		:= PKG_DATE_UTILS.ADD_MONTH(PKG_DATE_UTILS.start_of(dt_parametro_p,'month', 0), -11, 0);
	dt_fim_mes_w		:= PKG_DATE_UTILS.start_of(dt_parametro_p,'month',0);
elsif (ie_tipo_valor_p	= 'AC') then /*Ano corrente de 01/01/xxxx ate a data atual*/
	dt_ref_mes_w		:= PKG_DATE_UTILS.start_of(dt_parametro_p,'YEAR',0);
	dt_fim_mes_w		:= PKG_DATE_UTILS.END_OF(dt_parametro_p, 'MONTH', 0);
elsif (ie_tipo_valor_p	= 'ACM') then /*Ano corrente de 01/01/xxxx ate o ultimo mes cheio*/
	dt_ref_mes_w		:= PKG_DATE_UTILS.start_of(dt_parametro_p,'YEAR',0);
	dt_fim_mes_w		:= PKG_DATE_UTILS.END_OF(PKG_DATE_UTILS.start_of(dt_parametro_p,'month',0) - 1, 'MONTH', 0);
end if;

if (ie_tipo_inf_p in ('QT','QTD','PR','PRIN','PREX','PRJIN','PRINSJ','PRPHI','PRVEV'))   then

	/*Quantidade de OS recebidas independetente se passou para o Desenvolvimento/Tecnologia*/

	if (coalesce(nr_seq_grupo_des_p::text, '') = '') then
		select 	count(distinct nr_sequencia)
		into STRICT	qt_total_os_w
		from	os_recebida_gerencia_v
		where	dt_ordem_servico between dt_ref_mes_w and dt_fim_mes_w
		and      ((nr_seq_grupo_des_p = 0) or (nr_seq_grupo_des = nr_seq_grupo_des_p));
	elsif (ie_tipo_inf_p = 'QTD') then
		select 	count(distinct nr_sequencia)
		into STRICT	qt_total_os_w
		from	os_recebida_gerencia_desenv_v
		where	dt_ordem_servico between dt_ref_mes_w and dt_fim_mes_w
		and     nr_seq_grupo_des = nr_seq_grupo_des_p;
	elsif (nr_seq_grupo_des_p in (510,511,512)) then -- grupos traducao DEC
		select 	count(distinct nr_sequencia)
		into STRICT	qt_total_os_w
		from	os_recebida_gerencia_grupo_v
		where	dt_ordem_servico between dt_ref_mes_w and dt_fim_mes_w
		and     nr_seq_gerencia = 17; --DEC
	else
		select 	count(distinct nr_sequencia)
		into STRICT	qt_total_os_w
		from	os_recebida_gerencia_grupo_v
		where	dt_ordem_servico between dt_ref_mes_w and dt_fim_mes_w
		and      ((nr_seq_grupo_des_p = 0) or (nr_seq_grupo_des = nr_seq_grupo_des_p));

	end if;
end if;

/*Retorna a quantidade de erros considerando o DOC ERRO*/

if (ie_tipo_inf_p in ('ER','PR','QTDPE')) then

		select	count(distinct nr_sequencia)
		into STRICT	qt_erro_w
		from	os_erro_gerencia_v
		where	dt_ordem_servico between dt_ref_mes_w and dt_fim_mes_w
		and	(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
		and (nr_seq_grupo = nr_seq_grupo_des_p or nr_seq_grupo_des_p = 0);

/*Retorna a quantidade de erros considerando o DOC ERRO identificados na base da Wheb*/

elsif (ie_tipo_inf_p in ('PRIN')) then

		select	count(distinct nr_sequencia)
		into STRICT	qt_erro_w
		from	os_erro_gerencia_v
		where	dt_ordem_servico between dt_ref_mes_w and dt_fim_mes_w
		and	ie_ident_erro	= 'W'
		and	(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
		and (nr_seq_grupo = nr_seq_grupo_des_p or nr_seq_grupo_des_p = 0);

/*Retorna a quantidade de erros considerando o DOC ERRO externamente pelos clientes */

elsif (ie_tipo_inf_p in ('PREX','QTEXT')) then

		select	count(distinct a.nr_sequencia)
		into STRICT	qt_erro_w
		from	os_erro_gerencia_v a
		where	a.dt_ordem_servico between dt_ref_mes_w and dt_fim_mes_w
		and	a.ie_ident_erro	<> 'W'
		and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
		AND 	((EXISTS (SELECT 1
					    FROM  proj_projeto x
						WHERE  x.nr_sequencia = a.nr_seq_proj_def 
						AND	  (x.dt_fim_real IS NOT NULL AND x.dt_fim_real::text <> '')
						AND     obter_dias_entre_datas(x.dt_fim_real,a.dt_ordem_servico) > 120))
		OR (coalesce(a.nr_seq_proj_def::text, '') = ''))
		and (a.nr_seq_grupo = nr_seq_grupo_des_p or nr_seq_grupo_des_p = 0);

/*Retorna a quantidade de erros encontrados na base Wheb  fora do VV*/

elsif (ie_tipo_inf_p in ('PRPHI','QTPHI')) then

		select	count(distinct nr_sequencia)
		into STRICT	qt_erro_w
		from	os_erro_gerencia_v
		where	dt_ordem_servico between dt_ref_mes_w and dt_fim_mes_w
		and	ie_ident_erro	= 'W'
		and	(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
		and	nr_seq_equipamento not in (2897,5818)
		and (nr_seq_grupo = nr_seq_grupo_des_p or nr_seq_grupo_des_p = 0);

/*Retorna a quantidade de erros encontrados pelo VV */

elsif (ie_tipo_inf_p in ('PRVEV')) then

		select	count(distinct nr_sequencia)
		into STRICT	qt_erro_w
		from	os_erro_gerencia_v
		where	dt_ordem_servico between dt_ref_mes_w and dt_fim_mes_w
		and	ie_ident_erro	= 'W'
		and	(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
		and	nr_seq_equipamento in (2897,5818)
		and (nr_seq_grupo = nr_seq_grupo_des_p or nr_seq_grupo_des_p = 0);

/*Retorna a quantidade de erros considerando o DOC ERRO que foram identificados internamente na Wheb*/

elsif (ie_tipo_inf_p in ('ERI')) then

		select	count(distinct nr_sequencia)
		into STRICT	qt_erro_w
		from	os_erro_gerencia_v
		where	dt_ordem_servico between dt_ref_mes_w and dt_fim_mes_w
		and	ie_ident_erro	= 'W'
		and	(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
		and (nr_seq_grupo = nr_seq_grupo_des_p or nr_seq_grupo_des_p = 0);

/*Retorna a quantidade de erros considerando o DOC ERRO que foram identificados externamente pelos clientes*/

elsif (ie_tipo_inf_p in ('ERE')) then

		select	count(distinct nr_sequencia)
		into STRICT	qt_erro_w
		from	os_erro_gerencia_v
		where	dt_ordem_servico between dt_ref_mes_w and dt_fim_mes_w
		and	ie_ident_erro	<> 'W'
		and	(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
		and (nr_seq_grupo = nr_seq_grupo_des_p or nr_seq_grupo_des_p = 0);

/*Retorna a quantidade de OS encerrada que passou pelo Desenvolvimento/Tecnologia*/

elsif (ie_tipo_inf_p = 'EN') then

	select   count(*)
	into STRICT	 qt_os_encerrada_w
	from     os_encerrada_gerencia_v
	where	((nr_seq_grupo_des_p = 0) or (nr_seq_grupo_des = nr_seq_grupo_des_p))
	and	dt_fim_real between dt_ref_mes_w and dt_fim_mes_w;

/*Retorna a quantidade de OS encerrada com Grau de Satisfacao*/

elsif ( ie_tipo_inf_p in ('PRI','ENS', 'PRY')) then

	select	count(*)
	into STRICT	qt_os_encerrada_classif_w
	from	gerencia_wheb b,
		os_encerrada_satisf_gerencia_v a,
		man_localizacao c
	where	a.nr_seq_gerencia = b.nr_sequencia
	and	a.nr_seq_localizacao = c.nr_sequencia
	and	c.ie_terceiro = 'S'
	and	a.dt_fim_real between dt_ref_mes_w and dt_fim_mes_w
	and	b.ie_area_gerencia in (WITH RECURSIVE cte AS (

						SELECT	trim(both regexp_substr(ie_area_gerencia_p,'[^,]+', 1, level))
						
						(regexp_substr(ie_area_gerencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(ie_area_gerencia_p, '[^,]+', 1, level))::text <> '')
					  UNION ALL

						SELECT	trim(both regexp_substr(ie_area_gerencia_p,'[^,]+', 1, level)) JOIN cte c ON ()

) SELECT * FROM cte;
)	
	and (a.nr_seq_grupo_des = nr_seq_grupo_des_p or coalesce(nr_seq_grupo_des_p::text, '') = '');
	
/*Retorna a quantidade de OS encerrada com Grau de Satisfacao do desenvolvimento*/

elsif ( ie_tipo_inf_p = 'ENY') then
	select   count(*)
	into STRICT	 qt_os_encerrada_classif_w
	from     os_encerrada_satisf_gerencia_v a,
		grupo_desenvolvimento b
	where   ((nr_seq_grupo_des_p = 0) or (a.nr_seq_grupo_des = nr_seq_grupo_des_p))
	and	a.nr_seq_grupo_des	= b.nr_sequencia
	and	a.nr_seq_gerencia 	= b.nr_seq_gerencia
	and	a.dt_fim_real between dt_ref_mes_w and dt_fim_mes_w;

/*Retorna a quantidade de erros considerando o DOC ERRO identificados na base da Wheb - Somente para migracao JAVA */

elsif (ie_tipo_inf_p in ('PRJIN')) then

		select	count(distinct nr_sequencia)
		into STRICT	qt_erro_w
		from	os_erro_gerencia_v
		where	dt_ordem_servico between dt_ref_mes_w and dt_fim_mes_w
		and	ie_ident_erro	= 'W'
		and	ie_forma_origem = '10'
		and	(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
		and (nr_seq_grupo = nr_seq_grupo_des_p or nr_seq_grupo_des_p = 0);

/*Retorna a quantidade de erros considerando o DOC ERRO identificados na base da Wheb - Exceto para migracao JAVA */

elsif (ie_tipo_inf_p in ('PRINSJ')) then

		select	count(distinct nr_sequencia)
		into STRICT	qt_erro_w
		from	os_erro_gerencia_v
		where	dt_ordem_servico between dt_ref_mes_w and dt_fim_mes_w
		and	ie_ident_erro	= 'W'
		and	ie_forma_origem <> '10'
		and	(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
		and (nr_seq_grupo = nr_seq_grupo_des_p or nr_seq_grupo_des_p = 0);

/*Retorna a quantidade de erros considerando o DOC ERRO identificados na base da Wheb pelo setor de VV */

elsif (ie_tipo_inf_p in ('VEVOS')) then
	
	select	count(distinct nr_sequencia)
	into STRICT	qt_os_vev_w
	from	os_erro_gerencia_v
	where	dt_ordem_servico between dt_ref_mes_w and dt_fim_mes_w
	and	(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
	and	ie_ident_erro	= 'W'
	and	nr_seq_equipamento in (2897,5818)
	and (nr_seq_grupo = nr_seq_grupo_des_p or nr_seq_grupo_des_p = 0);

elsif (ie_tipo_inf_p in ('PHIOS')) then
	
	select	count(distinct nr_sequencia)
	into STRICT	qt_os_philips_w
	from	os_erro_gerencia_v
	where	dt_ordem_servico between dt_ref_mes_w and dt_fim_mes_w
	and	(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
	and	ie_ident_erro	= 'W'
	and	nr_seq_equipamento not in (2897,5818)
	and (nr_seq_grupo = nr_seq_grupo_des_p or nr_seq_grupo_des_p = 0);

elsif (ie_tipo_inf_p in ('PRANTIGA','QTANTIGA')) then

	select	COUNT(*)
	into STRICT	qt_erro_w
	from	man_estagio_processo c,
		man_ordem_servico a
	where	c.nr_sequencia = a.nr_seq_estagio
	and (c.ie_desenv = 'S' or c.ie_tecnologia = 'S')
	and	a.ie_status_ordem <> '3'
	AND	a.dt_ordem_servico < clock_timestamp() - interval '30 days'
	and (a.nr_seq_grupo_des = nr_seq_grupo_des_p or nr_seq_grupo_des_p = 0);

elsif (ie_tipo_inf_p = 'QTBACKLOG') then
	select	COUNT(*)
	into STRICT	qt_total_os_w
	from	man_estagio_processo c,
		man_ordem_servico a
	where	c.nr_sequencia = a.nr_seq_estagio
	and (c.ie_desenv = 'S' or c.ie_tecnologia = 'S')
	and	a.ie_status_ordem <> '3' 
	and	((a.nr_seq_grupo_des = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0));

elsif (ie_tipo_inf_p = 'QTRECCLI') then
	
	select 	count(distinct a.nr_sequencia)
	into STRICT	qt_total_os_w
	FROM os_recebida_gerencia_desenv_v a
LEFT OUTER JOIN man_localizacao b ON (a.nr_seq_localizacao = b.nr_sequencia)
WHERE a.dt_ordem_servico between dt_ref_mes_w and dt_fim_mes_w  and coalesce(ie_terceiro,'S')	= 'S' and ((a.nr_seq_grupo_des = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0));
	
elsif (ie_tipo_inf_p = 'QTRECINT') then
	
	select 	count(distinct a.nr_sequencia)
	into STRICT	qt_total_os_w
	FROM os_recebida_gerencia_desenv_v a
LEFT OUTER JOIN man_localizacao b ON (a.nr_seq_localizacao = b.nr_sequencia)
WHERE a.dt_ordem_servico between dt_ref_mes_w and dt_fim_mes_w  and coalesce(ie_terceiro,'S')	= 'N' and ((a.nr_seq_grupo_des = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0));

elsif (ie_tipo_inf_p = 'QTBACKCLI') then
	select	COUNT(*)
	into STRICT	qt_total_os_w
	FROM man_estagio_processo c, man_ordem_servico a
LEFT OUTER JOIN man_localizacao m ON (a.nr_seq_localizacao = m.nr_sequencia)
WHERE c.nr_sequencia = a.nr_seq_estagio  and coalesce(m.ie_terceiro,'S')	= 'S' and (c.ie_desenv = 'S' or c.ie_tecnologia = 'S') and a.ie_status_ordem <> '3' and ((a.nr_seq_grupo_des = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0));

elsif (ie_tipo_inf_p = 'QTBACKINT') then
	select	COUNT(*)
	into STRICT	qt_total_os_w
	FROM man_estagio_processo c, man_ordem_servico a
LEFT OUTER JOIN man_localizacao m ON (a.nr_seq_localizacao = m.nr_sequencia)
WHERE c.nr_sequencia = a.nr_seq_estagio  and coalesce(m.ie_terceiro,'S')	= 'N' and (c.ie_desenv = 'S' or c.ie_tecnologia = 'S') and a.ie_status_ordem <> '3' and ((a.nr_seq_grupo_des = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0));

elsif (ie_tipo_inf_p = 'QTBACKPENDCLI') then
	select	COUNT(*)
	into STRICT	qt_total_os_w
	FROM man_estagio_processo c, os_recebida_gerencia_desenv_v b, man_ordem_servico a
LEFT OUTER JOIN man_localizacao m ON (a.nr_seq_localizacao = m.nr_sequencia)
WHERE c.nr_sequencia		= a.nr_seq_estagio and a.nr_sequencia		= b.nr_sequencia  and coalesce(m.ie_terceiro,'S')	= 'S' and (coalesce(c.ie_desenv,'X') <> 'S' or coalesce(c.ie_tecnologia, 'X') <> 'S') and a.ie_status_ordem <> '3' and c.ie_acao = 2 and ((a.nr_seq_grupo_des = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0));

elsif (ie_tipo_inf_p = 'QTBACKPENDVEV') then
	select	COUNT(*)
	into STRICT	qt_total_os_w
	from	man_estagio_processo c,
		os_recebida_gerencia_desenv_v b,
		man_ordem_servico a
	where	c.nr_sequencia		= a.nr_seq_estagio
	and	a.nr_sequencia		= b.nr_sequencia
	and	coalesce(c.ie_testes,'X') = 'S'
	and	a.ie_status_ordem <> '3' 
	and	((a.nr_seq_grupo_des = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0));
	
elsif (ie_tipo_inf_p = 'CAEU') then
	select	count(distinct a.nr_sequencia)
	into STRICT	qt_total_os_w
	from	man_ordem_servico m,
			os_encerrada_gerencia_v a
	where	a.dt_fim_real between dt_ref_mes_w and dt_fim_mes_w
	and		a.nr_sequencia	= m.nr_sequencia
	and		m.nr_seq_complex in (4,5,6)
	and		((m.nr_seq_grupo_des = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0));

elsif (ie_tipo_inf_p = 'QTSLA') then			--GRUPO
	select	count(*)
	into STRICT	qt_total_os_w
	from	man_estagio_processo c,
    		man_ordem_servico  a,
		man_ordem_serv_sla s
	where 	a.nr_sequencia	= s.nr_seq_ordem
	and   	s.nr_seq_status <> 412
	and	c.nr_sequencia	= a.nr_seq_estagio
	and (c.ie_desenv = 'S' or c.ie_tecnologia = 'S')
	and (a.nr_seq_grupo_des = nr_seq_grupo_des_p or nr_seq_grupo_des_p = 0)
	and   	a.ie_status_ordem	<> '3'
	-- desconsiderar regra de sla da "TI - Philips SLA"
	and    	s.nr_seq_sla <> 210 
	and	s.nr_seq_sla <> sla_dashboard_pck.obter_nr_seq_regra_alldef();

elsif (ie_tipo_inf_p = 'QTBACKLOGDEF') then
	select	COUNT(*)
	into STRICT	qt_total_os_w
	from	man_estagio_processo c,
		man_ordem_servico a
	where	c.nr_sequencia		= a.nr_seq_estagio
	and	a.ie_classificacao	= 'E'
	and (c.ie_desenv = 'S' or c.ie_tecnologia = 'S')
	and	a.ie_status_ordem	<> '3' 
	and (a.nr_seq_grupo_des = nr_seq_grupo_des_p or nr_seq_grupo_des_p = 0);

elsif (ie_tipo_inf_p = 'QTBACKLOG') then
	select	COUNT(*)
	into STRICT	qt_total_os_w
	from	man_estagio_processo c,
		man_ordem_servico a
	where	c.nr_sequencia = a.nr_seq_estagio
	and (c.ie_desenv = 'S' or c.ie_tecnologia = 'S')
	and	a.ie_status_ordem <> '3' 
	and (a.nr_seq_grupo_des = nr_seq_grupo_des_p or nr_seq_grupo_des_p = 0);

elsif (ie_tipo_inf_p in ('QTANNE','QTANSI','QTANMA','QTPROG','QTESTA')) then
	begin
	select	coalesce(sum(phi_obter_valor_usu_grupo(dt_parametro_p,c.nm_usuario_grupo,c.nr_seq_grupo,null,1)),0)
	into STRICT	qt_total_os_w
	from	usuario_grupo_des c,
		grupo_desenvolvimento b,
		gerencia_wheb a
	where	a.nr_sequencia = b.nr_seq_gerencia
	and	b.nr_sequencia = c.nr_seq_grupo
	and	c.ie_funcao_usuario = ie_tipo_valor_p
	and	b.ie_situacao = 'A' --
	and (b.nr_sequencia = nr_seq_grupo_des_p or nr_seq_grupo_des_p = 0)
	and	dt_parametro_p between c.dt_inicio_vigencia and fim_mes(coalesce(c.dt_fim_vigencia,dt_parametro_p));
	end;
elsif (ie_tipo_inf_p = 'QAUSEN') then
	begin
	select	coalesce(sum(phi_obter_valor_usu_grupo(dt_parametro_p,c.nm_usuario_grupo,c.nr_seq_grupo,null,2)),0)
	into STRICT	qt_total_os_w
	from	usuario_grupo_des c,
		grupo_desenvolvimento b,
		gerencia_wheb a
	where	a.nr_sequencia = b.nr_seq_gerencia
	and	b.nr_sequencia = c.nr_seq_grupo
	and	c.ie_funcao_usuario in ('P','S','N','M')
	and	b.ie_situacao = 'A' --
	and (b.nr_sequencia = nr_seq_grupo_des_p or nr_seq_grupo_des_p = 0)
	and	dt_parametro_p between c.dt_inicio_vigencia and fim_mes(coalesce(c.dt_fim_vigencia,dt_parametro_p));
	end;
elsif (ie_tipo_inf_p = 'QTHORADIA') then

	select	dividir(sum(qt_minuto),60)
	into STRICT	qt_total_os_w
	from	MAN_ORDEM_SERV_ATIV a
	where	(a.dt_atividade IS NOT NULL AND a.dt_atividade::text <> '')
	and	(a.dt_fim_atividade IS NOT NULL AND a.dt_fim_atividade::text <> '')
	and	a.dt_atividade between dt_ref_mes_w and dt_fim_mes_w
	and	exists (	SELECT	1
				from	gerencia_wheb w,
					usuario_grupo_des c,
					grupo_desenvolvimento b
				where	b.nr_sequencia		= c.nr_seq_grupo
				and	w.nr_sequencia		= b.nr_seq_gerencia
				and	b.ie_situacao		= 'A'
				and	w.ie_situacao		= 'A'
				and	c.nm_usuario_grupo	= a.nm_usuario_exec
				and	((b.nr_sequencia = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0)));

elsif (ie_tipo_inf_p = 'QTHORAOS') then
	select	dividir(dividir(sum(qt_minuto),60), count(distinct m.nr_sequencia))
	into STRICT	qt_total_os_w
	from	MAN_ORDEM_SERV_ATIV a,
		man_ordem_servico m
	where	m.nr_sequencia	= a.nr_seq_ordem_serv
	and	m.dt_fim_real between dt_ref_mes_w and dt_fim_mes_w
	and	((m.nr_seq_grupo_des = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0))
	and	m.ie_status_ordem = '3'
	and	(a.dt_atividade IS NOT NULL AND a.dt_atividade::text <> '')
	and	(a.dt_fim_atividade IS NOT NULL AND a.dt_fim_atividade::text <> '')
	and	exists (	SELECT	1
				from	gerencia_wheb w,
					usuario_grupo_des c,
					grupo_desenvolvimento b
				where	b.nr_sequencia		= c.nr_seq_grupo
				and	w.nr_sequencia		= b.nr_seq_gerencia
				and	b.ie_situacao		= 'A'
				and	w.ie_situacao		= 'A'
				and	c.nm_usuario_grupo	= a.nm_usuario_exec
				and	((b.nr_sequencia = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0)));

elsif (ie_tipo_inf_p = 'QTHORAOSCLI') then
	select	dividir(dividir(sum(qt_minuto),60), count(distinct m.nr_sequencia))
	into STRICT	qt_total_os_w
	from	man_localizacao l,
		MAN_ORDEM_SERV_ATIV a,
		man_ordem_servico m
	where	m.nr_sequencia		= a.nr_seq_ordem_serv
	and	l.nr_sequencia		= m.nr_seq_localizacao
	and	coalesce(l.ie_terceiro,'S')	= 'S'
	and	((m.nr_seq_grupo_des = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0))
	and	m.dt_fim_real between dt_ref_mes_w and dt_fim_mes_w
	and	m.ie_status_ordem = '3'
	and	(a.dt_atividade IS NOT NULL AND a.dt_atividade::text <> '')
	and	(a.dt_fim_atividade IS NOT NULL AND a.dt_fim_atividade::text <> '')
	and	exists (	SELECT	1
				from	gerencia_wheb w,
					usuario_grupo_des c,
					grupo_desenvolvimento b
				where	b.nr_sequencia		= c.nr_seq_grupo
				and	w.nr_sequencia		= b.nr_seq_gerencia
				and	b.ie_situacao		= 'A'
				and	w.ie_situacao		= 'A'
				and	c.nm_usuario_grupo	= a.nm_usuario_exec
				and	((b.nr_sequencia = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0)));

elsif (ie_tipo_inf_p = 'QTHORAOSINT') then
	select	dividir(dividir(sum(qt_minuto),60), count(distinct m.nr_sequencia))
	into STRICT	qt_total_os_w
	from	man_localizacao l,
		MAN_ORDEM_SERV_ATIV a,
		man_ordem_servico m
	where	m.nr_sequencia		= a.nr_seq_ordem_serv
	and	l.nr_sequencia		= m.nr_seq_localizacao
	and	coalesce(l.ie_terceiro,'S')	= 'N'
	and	((m.nr_seq_grupo_des = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0))
	and	m.dt_fim_real between dt_ref_mes_w and dt_fim_mes_w
	and	m.ie_status_ordem = '3'
	and	(a.dt_atividade IS NOT NULL AND a.dt_atividade::text <> '')
	and	(a.dt_fim_atividade IS NOT NULL AND a.dt_fim_atividade::text <> '')
	and	exists (	SELECT	1
				from	gerencia_wheb w,
					usuario_grupo_des c,
					grupo_desenvolvimento b
				where	b.nr_sequencia		= c.nr_seq_grupo
				and	w.nr_sequencia		= b.nr_seq_gerencia
				and	b.ie_situacao		= 'A'
				and	w.ie_situacao		= 'A'
				and	c.nm_usuario_grupo	= a.nm_usuario_exec
				and	((b.nr_sequencia = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0)));

elsif (ie_tipo_inf_p = 'QTRECEBDIA') then

	dt_ref_mes_w	:= PKG_DATE_UTILS.start_of(dt_parametro_p,'dd',0);
	dt_fim_mes_w	:= PKG_DATE_UTILS.END_OF(dt_ref_mes_w, 'DAY', 0);

	select 	count(distinct nr_sequencia)
	into STRICT	qt_total_os_w
	from	os_recebida_gerencia_desenv_v
	where	dt_ordem_servico between dt_ref_mes_w and dt_fim_mes_w
	and	((nr_seq_grupo_des = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0));

elsif (ie_tipo_inf_p = 'QTRECEBDIACLI') then

	dt_ref_mes_w	:= PKG_DATE_UTILS.start_of(dt_parametro_p,'dd',0);
	dt_fim_mes_w	:= PKG_DATE_UTILS.END_OF(dt_ref_mes_w, 'DAY', 0);

	select 	count(distinct a.nr_sequencia)
	into STRICT	qt_total_os_w
	from	man_localizacao b,
		os_recebida_gerencia_desenv_v a
	where	a.dt_ordem_servico between dt_ref_mes_w and dt_fim_mes_w
	and	a.nr_seq_localizacao	= b.nr_sequencia
	and	coalesce(b.ie_terceiro,'S')	= 'S'
	and	((a.nr_seq_grupo_des = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0));

elsif (ie_tipo_inf_p = 'QTRECEBDIAINT') then

	dt_ref_mes_w	:= PKG_DATE_UTILS.start_of(dt_parametro_p,'dd',0);
	dt_fim_mes_w	:= PKG_DATE_UTILS.END_OF(dt_ref_mes_w, 'DAY', 0);

	select 	count(distinct a.nr_sequencia)
	into STRICT	qt_total_os_w
	from	man_localizacao b,
		os_recebida_gerencia_desenv_v a
	where	a.dt_ordem_servico between dt_ref_mes_w and dt_fim_mes_w
	and	a.nr_seq_localizacao	= b.nr_sequencia
	and	coalesce(b.ie_terceiro,'S')	= 'N'
	and	((a.nr_seq_grupo_des = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0));

elsif (ie_tipo_inf_p in ('QTHE','MEHEPF')) then

	select	round(sum(a.qt_min_trab) / 60)
	into STRICT	qt_total_os_w
	from	pf_hora_trabalhada a,
		usuario u,
		grupo_desenvolvimento b,
		usuario_grupo_des c,
		gerencia_wheb g
	where	a.cd_pessoa_fisica	= u.cd_pessoa_fisica
	and	u.nm_usuario		= c.NM_USUARIO_GRUPO
	and	c.nr_seq_grupo		= b.nr_sequencia
	and	b.nr_seq_gerencia	= g.nr_sequencia
	and	a.dt_referencia between dt_ref_mes_w and dt_fim_mes_w
	and	a.cd_sistema in (301,302,303,304,305,306,501,502,504,505)
	and	((b.nr_sequencia = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0));

elsif (ie_tipo_inf_p = 'QTNET') then
	qt_total_os_w := obter_valor_dinamico_bv('select count(1) from alteracao_tasy@whebl02_orcl a, man_ordem_servico b where a.nr_seq_ordem_serv = b.nr_sequencia and b.nr_seq_grupo_des = :nr_grupo and a.dt_alteracao between :dt_inicio and :dt_fim', 'nr_grupo='||to_char(nr_seq_grupo_des_p)||ds_sep_bv_w||'dt_inicio='||dt_ref_mes_w||ds_sep_bv_w||'dt_fim='||dt_fim_mes_w, qt_total_os_w);

elsif (ie_tipo_inf_p = 'PRINOV') then

	SELECT	ROUND(dividir((SUM(qt_inov)*100),SUM(qt_total)),2) qt_percent
	into STRICT	qt_total_os_w
	FROM	(
	SELECT	round((dividir(SUM(qt_minuto),60))::numeric,2) qt_inov,
		0 qt_total
	FROM	(	
		SELECT	SUM(b.qt_minuto) qt_minuto
		FROM	grupo_desenvolvimento d,
			usuario_grupo_des e,
			man_ordem_servico a,
			man_ordem_serv_ativ b,
			usuario c
		WHERE	a.nr_sequencia = b.nr_seq_ordem_serv
		AND	c.nm_usuario   = b.nm_usuario_exec
		and 	d.nr_sequencia = e.nr_seq_grupo
		and 	e.nm_usuario_grupo = c.nm_usuario
		and	((a.nr_seq_grupo_des = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0))
		AND	a.nr_seq_nivel_valor IN (1,3)
		and 	b.dt_atividade between dt_ref_mes_w and dt_fim_mes_w
		and	not exists (
						select	1
						from	man_ordem_serv_tecnico x
						where	a.nr_sequencia = x.nr_seq_ordem_serv
						and	nr_seq_tipo = 129)
		and	a.nr_seq_classif <> 49) alias16
	
UNION ALL

	SELECT	0 qt_inov,
		round((dividir(SUM(qt_minuto),60))::numeric,2) qt_total
	FROM	(	
		SELECT	SUM(b.qt_minuto) qt_minuto
		FROM	grupo_desenvolvimento d,
			usuario_grupo_des e,
			man_ordem_servico a,
			man_ordem_serv_ativ b,
			usuario c
		WHERE	a.nr_sequencia = b.nr_seq_ordem_serv
		AND	c.nm_usuario   = b.nm_usuario_exec
		and	d.nr_sequencia = e.nr_seq_grupo
		and	e.nm_usuario_grupo = c.nm_usuario
		and 	((a.nr_seq_grupo_des = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0))
		and	(a.nr_seq_nivel_valor IS NOT NULL AND a.nr_seq_nivel_valor::text <> '')
		and	b.dt_atividade between dt_ref_mes_w and dt_fim_mes_w
		and	not exists (
						select	1
						from	man_ordem_serv_tecnico x
						where	a.nr_sequencia = x.nr_seq_ordem_serv
						and	nr_seq_tipo = 129)
		and	a.nr_seq_classif <> 49) alias27) alias28;

elsif (ie_tipo_inf_p = 'QTPESSOA') then
	
	SELECT	sum(a.qt_total_pessoas)
	into STRICT	qt_total_os_w
	from	w_indicador_desenv_apres a 
	WHERE	a.dt_referencia = PKG_DATE_UTILS.start_of(PKG_DATE_UTILS.END_OF(a.dt_referencia, 'MONTH', 0),'dd', 0)
	and	a.IE_ABRANGENCIA = 'GRU' 
	and 	((a.nr_seq_grupo = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0))
	and	a.dt_referencia between dt_ref_mes_w and dt_fim_mes_w;

elsif (ie_tipo_inf_p = 'QTPFPRODUT') then
	
	SELECT	sum(a.qt_total_pessoas - a.qt_pessoa_ausente)
	into STRICT	qt_total_os_w
	from	w_indicador_desenv_apres a
	WHERE	a.dt_referencia = PKG_DATE_UTILS.start_of(PKG_DATE_UTILS.END_OF(a.dt_referencia, 'MONTH', 0),'dd', 0)
	and	a.IE_ABRANGENCIA = 'GRU' 
	and 	((a.nr_seq_grupo = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0))
	and	a.dt_referencia between dt_ref_mes_w and dt_fim_mes_w;

elsif (ie_tipo_inf_p = 'QTPFDELPHI') then

	if (trunc(clock_timestamp()) < trunc(dt_fim_mes_w)) then
		dt_fim_mes_w	:= PKG_DATE_UTILS.END_OF(clock_timestamp(), 'DAY', 0);
	end if;

	qt_dias_util_w	:= obter_dias_uteis_periodo(dt_ref_mes_w,dt_fim_mes_w,1);

	select	trunc(sum(b.QT_MINUTO/60)/7/qt_dias_util_w,2)
	into STRICT	qt_total_os_w
	from	man_ordem_servico a,
		MAN_ORDEM_SERV_ATIV b
	where	a.nr_sequencia = b.NR_SEQ_ORDEM_SERV
	and	b.DT_ATIVIDADE between dt_ref_mes_w and dt_fim_mes_w
	and	a.ie_plataforma = 'D'
	and	obter_se_ordem_vinc_projeto(a.nr_sequencia,'4') = 'N'
	and	exists (	SELECT 1
				from	gerencia_wheb c,
					grupo_desenvolvimento d,
					USUARIO_GRUPO_DES e
				where	c.nr_sequencia = d.nr_seq_gerencia
				and	d.nr_sequencia = e.NR_SEQ_GRUPO
				and	c.ie_situacao = 'A'
				and	d.ie_situacao = 'A'
				and	((d.nr_sequencia = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0))
				and	e.NM_USUARIO_GRUPO	= b.NM_USUARIO_EXEC);

elsif (ie_tipo_inf_p = 'QTPFJAVA') then

	if (trunc(clock_timestamp()) < trunc(dt_fim_mes_w)) then
		dt_fim_mes_w	:= PKG_DATE_UTILS.END_OF(clock_timestamp(), 'DAY', 0);
	end if;

	qt_dias_util_w	:= obter_dias_uteis_periodo(dt_ref_mes_w,dt_fim_mes_w,1);

	select	trunc(sum(b.QT_MINUTO/60)/7/qt_dias_util_w,2)
	into STRICT	qt_total_os_w
	from	man_ordem_servico a,
		MAN_ORDEM_SERV_ATIV b
	where	a.nr_sequencia = b.NR_SEQ_ORDEM_SERV
	and	b.DT_ATIVIDADE between dt_ref_mes_w and dt_fim_mes_w
	and	a.ie_plataforma = 'S'
	and	obter_se_ordem_vinc_projeto(a.nr_sequencia,'4') = 'N'
	and	exists (	SELECT 1
				from	gerencia_wheb c,
					grupo_desenvolvimento d,
					USUARIO_GRUPO_DES e
				where	c.nr_sequencia = d.nr_seq_gerencia
				and	d.nr_sequencia = e.NR_SEQ_GRUPO
				and	c.ie_situacao = 'A'
				and	d.ie_situacao = 'A'
				and	((d.nr_sequencia = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0))
				and	e.NM_USUARIO_GRUPO	= b.NM_USUARIO_EXEC);

elsif (ie_tipo_inf_p = 'QTPFHTML5') then

	if (trunc(clock_timestamp()) < trunc(dt_fim_mes_w)) then
		dt_fim_mes_w	:= PKG_DATE_UTILS.END_OF(clock_timestamp(), 'DAY', 0);
	end if;

	qt_dias_util_w	:= obter_dias_uteis_periodo(dt_ref_mes_w,dt_fim_mes_w,1);

	select	trunc(sum(b.QT_MINUTO/60)/7/qt_dias_util_w,2)
	into STRICT	qt_total_os_w
	from	man_ordem_servico a,
		MAN_ORDEM_SERV_ATIV b
	where	a.nr_sequencia = b.NR_SEQ_ORDEM_SERV
	and	b.DT_ATIVIDADE between dt_ref_mes_w and dt_fim_mes_w
	and	a.ie_plataforma = 'H'
	and	obter_se_ordem_vinc_projeto(a.nr_sequencia,'4') = 'N'
	and	exists (	SELECT 1
				from	gerencia_wheb c,
					grupo_desenvolvimento d,
					USUARIO_GRUPO_DES e
				where	c.nr_sequencia = d.nr_seq_gerencia
				and	d.nr_sequencia = e.NR_SEQ_GRUPO
				and	c.ie_situacao = 'A'
				and	d.ie_situacao = 'A'
				and	((d.nr_sequencia = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0))
				and	e.NM_USUARIO_GRUPO	= b.NM_USUARIO_EXEC);

elsif (ie_tipo_inf_p = 'QFPFCAP') then

	if (trunc(clock_timestamp()) < trunc(dt_fim_mes_w)) then
		dt_fim_mes_w	:= PKG_DATE_UTILS.END_OF(clock_timestamp(), 'DAY', 0);
	end if;

	qt_dias_util_w	:= obter_dias_uteis_periodo(dt_ref_mes_w,dt_fim_mes_w,1);

	select	trunc(sum(b.QT_MINUTO/60)/7/qt_dias_util_w,2)
	into STRICT	qt_total_os_w
	from	man_ordem_servico a,
		MAN_ORDEM_SERV_ATIV b
	where	a.nr_sequencia = b.NR_SEQ_ORDEM_SERV
	and	b.DT_ATIVIDADE between dt_ref_mes_w and dt_fim_mes_w
	and	obter_se_ordem_vinc_projeto(a.nr_sequencia,'4') = 'S'
	and	exists (	SELECT 1
				from	gerencia_wheb c,
					grupo_desenvolvimento d,
					USUARIO_GRUPO_DES e
				where	c.nr_sequencia = d.nr_seq_gerencia
				and	d.nr_sequencia = e.NR_SEQ_GRUPO
				and	c.ie_situacao = 'A'
				and	d.ie_situacao = 'A'
				and	((d.nr_sequencia = nr_seq_grupo_des_p) or (nr_seq_grupo_des_p = 0))
				and	e.NM_USUARIO_GRUPO	= b.NM_USUARIO_EXEC);

end if;



/*Esses ifs nao podem ser com elsif*/



/*Retorna a quantidade de OS encerrada com Grau de Satisfacao Irregular*/

if (ie_tipo_inf_p in ('QTI','PRI')) then
	
	select	count(*)
	into STRICT	qt_os_insatisf_w
	from	os_insatisfacao_gerencia_v a,
		man_localizacao c
	where	a.nr_seq_localizacao = c.nr_sequencia
	and	c.ie_terceiro = 'S'
	and	a.dt_fim_real between dt_ref_mes_w and dt_fim_mes_w
	and	a.ie_area_gerencia in (WITH RECURSIVE cte AS (

						SELECT	trim(both regexp_substr(ie_area_gerencia_p,'[^,]+', 1, level))
						
						(regexp_substr(ie_area_gerencia_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(ie_area_gerencia_p, '[^,]+', 1, level))::text <> '')
					  UNION ALL

						SELECT	trim(both regexp_substr(ie_area_gerencia_p,'[^,]+', 1, level)) JOIN cte c ON ()

) SELECT * FROM cte;
)	
	and (a.nr_seq_grupo = nr_seq_grupo_des_p or coalesce(nr_seq_grupo_des_p::text, '') = '');
		
end if;

if (ie_tipo_inf_p = 'PRANTIGA') then
	select	COUNT(*)
	into STRICT	qt_total_os_w
	from	man_estagio_processo c,
		man_ordem_servico a
	where	c.nr_sequencia = a.nr_seq_estagio
	and (c.ie_desenv = 'S' or c.ie_tecnologia = 'S')
	and	a.ie_status_ordem <> '3' 
	and (a.nr_seq_grupo_des = nr_seq_grupo_des_p or nr_seq_grupo_des_p = 0);
end if;

/*Retorna a quantidade de OS encerrada com Grau de Satisfacao Irregular do desenvolvimento */

if (ie_tipo_inf_p in ('QTY','PRY')) then

	select	count(*)
	into STRICT	qt_os_insatisf_w
	from	os_insatisfacao_gerencia_v a,
		grupo_desenvolvimento b
	where   ((nr_seq_grupo_des_p = 0) or (a.nr_seq_grupo = nr_seq_grupo_des_p))
	and	a.nr_seq_grupo	= b.nr_sequencia
	and	a.nr_seq_gerencia = b.nr_seq_gerencia
	and	coalesce(a.nr_seq_gerencia_insatisf, b.nr_seq_gerencia) = b.nr_seq_gerencia
	and	pkg_date_utils.start_of(a.dt_encerramento_ordem, 'month', 0) between dt_ref_mes_w and dt_fim_mes_w;

end if;

if (ie_tipo_inf_p in ('QTDPE','MEHEPF')) then

	select	count(distinct nm_usuario_grupo)
	into STRICT	qt_pessoas_w
	from	usuario_grupo_des
	where	nr_seq_grupo	= nr_seq_grupo_des_p
	and	ie_funcao_usuario in ('M','N','S','P');

end if;


if (ie_tipo_inf_p in ('QT','CAEU','QTD','QTSLA','QTBACKLOGDEF','QTBACKLOG','QTRECCLI','QTRECINT','QTBACKCLI','QTBACKINT','QTANNE','QTANSI','QTANMA','QTPROG','QTHORADIA','QTHORAOS','QTHORADIA','QTHORAOSINT',
			'QTHORAOSCLI','QTRECEBDIA','QTRECEBDIAINT','QTRECEBDIACLI','QTESTA','QTBACKPENDCLI','QTBACKPENDVEV','QAUSEN','QTHE','QTNET','PRINOV','QTPESSOA','QTPFPRODUT','QTPFDELPHI','QTPFJAVA',
			'QTPFHTML5','QFPFCAP')) then
	return qt_total_os_w;
elsif (ie_tipo_inf_p in ('ER','QTEXT','QTPHI','QTANTIGA')) then
	return qt_erro_w;
elsif (ie_tipo_inf_p = 'EN') then
	return qt_os_encerrada_w;
elsif (ie_tipo_inf_p in ('PR','PRIN','PREX','PRPHI','PRVEV','PRJIN','PRINSJ','PRANTIGA')) then
	return dividir(qt_erro_w, qt_total_os_w)*100;
elsif (ie_tipo_inf_p in ('QTI','QTY')) then
	return	qt_os_insatisf_w;
elsif (ie_tipo_inf_p in ('PRI', 'PRY')) then
	return dividir(qt_os_insatisf_w, qt_os_encerrada_classif_w)*100;
elsif (ie_tipo_inf_p in ('ENS', 'ENY')) then
	return	qt_os_encerrada_classif_w;
elsif (ie_tipo_inf_p = 'VEVOS') then
	return qt_os_vev_w;
elsif (ie_tipo_inf_p = 'PHIOS') then
	return qt_os_philips_w;
elsif (ie_tipo_inf_p = 'QTDPE') then
	return	dividir(qt_erro_w,qt_pessoas_w);
elsif (ie_tipo_inf_p = 'ERE') then
	return	qt_erro_w;
elsif (ie_tipo_inf_p = 'MEHEPF') then
	return	dividir(qt_total_os_w,qt_pessoas_w);
else
	return 0;
end if;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_informacao_os_grupo (dt_parametro_p timestamp, nr_seq_grupo_des_p bigint, ie_tipo_inf_p text, ie_tipo_valor_p text, ie_area_gerencia_p text default 'DES,TEC') FROM PUBLIC;

