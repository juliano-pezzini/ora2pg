-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_media_tempo_pa ( qt_tempo_p bigint, vl_dominio_p bigint) RETURNS varchar AS $body$
DECLARE

 
qt_media_w			double precision;
qt_pac_w			bigint;
qt_tempo_w			double precision;
ds_retorno_w		varchar(50);


BEGIN 
select	count(*) qt_paciente 
into STRICT	qt_pac_w 
from	atendimento_ps_v a 
where	coalesce(hr_inicio_consulta::text, '') = '' 
and		a.ie_clinica = vl_dominio_p 
and		dt_entrada between clock_timestamp()-qt_tempo_p/24 and clock_timestamp();
 
select	trunc(sum(((a.dt_chamada_paciente - a.dt_entrada)/1*24*60)),5) 
into STRICT	qt_tempo_w 
from	atendimento_ps_v a 
where	coalesce(hr_inicio_consulta::text, '') = '' 
and		a.ie_clinica = vl_dominio_p 
and		dt_entrada between clock_timestamp()-qt_tempo_p/24 and clock_timestamp();
 
qt_media_w := (qt_tempo_w/qt_pac_w);
 
select	max(obter_horas_minutos(qt_media_w)) 
into STRICT	ds_retorno_w
;
 
return	ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_media_tempo_pa ( qt_tempo_p bigint, vl_dominio_p bigint) FROM PUBLIC;

