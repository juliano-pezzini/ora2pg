-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_compl_pf (cd_pessoa_fisica_p text, ie_tipo_complemento_p bigint, ie_descricao_p text) RETURNS varchar AS $body$
DECLARE




ds_descricao_w             	varchar(255)  := '';
cd_municipio_ibge_w		varchar(255);
nr_seq_pessoa_endereco_w	pessoa_endereco.nr_sequencia%type	:= null;
ds_adic_w			varchar(255);
cd_regime_fiscal_w		pessoa_juridica.cd_regime_fiscal%type;

/* utilizar sempre sql distintos para consulta para reduzir consumo de memoria do oracle
coelho - os110330

ie_tipo_complemento_p

   1 - residencial
   2 - comercial
   3 - responsavel
   4 - pai
   5 - mae
   6 - conjuge
   7 - comercial 2

ie_descricao_p
   n - nome
   t - telefone
   c - nr cpf
   i - nr identidade
   ec - endereco completo
   ecct - endereco completo + cep + telefone
   es - endereco simples
   r  - endereco simples
   esc - endereco simples
   en - so endereco
   e  - endereco + num + compl
   encb - endereco + num + compl + bairro
   EDN - Endereco e numero
   p - profissao
   s - empresa
   o - observacao
   ci - cidade
   uf - estado
   cep - cep
   b - bairro
   m - email
   co - complemento
   nr - numero
   NREND - Numero do endereco 
   cdm - codigo municipio
   dm - descricao do municipio ibge
   cdm/dm - codigo municipio + descricao do municipio ibge
   cce - cep + cidade + uf
   gp - grau de parentesco (descricao)
   TC - Tipo Custodia
   IEC - Custodiante - Responsavel pela tutela da pessoa
   na - nascionalidade
   ram - nr ramal
   npr - nome pessoa fisica referencia
   fax - nr fax
   tls - tipo logradouro sus
   dit - numero ddi telefone
   ddt - numero ddd telefone
   dif - numero ddi fax
   ddf - numero ddd fax
   ws - website
   ta - telefone adicional
   pais - pais,
   cpais - codigo do pais
   NFC - Receber nf correio
   TPD - Tipo de pessoa juridica da PF
   TP - Codigo do tipo de pessoa juridica CD_TIPO_PJ
   Z - Zona
   DSM - Descricao do municipio
   CNES - Codigo CNES do complemento
   CS - Codigo empresa
   CCM - Cadastro de Contribuinte Mobiliario
   NOMECONJ  - Nome Pessoa_Fisica do Conjuge
   DTNASCONJ - Data Nascimento do Conjuge
   IDADECONJ - Idade do Conjuge
   SEXOCONJ  - Sexo do Conjuge
   ME - Municipio  + Estado
   TIPOSANGUECONJ - Tipo sanguineo conjugue
   FATORRH - Fator rh do conj
   CEL - Celular
   DDDCEL - ddd do Celular
   COMIB - Coordenadoria do municipio IBGE
   NP - Sequencia do pais
   SNR - Somente o nome da rua
   ENDR - Endereco completo para relatorio
   RFC - Codigo RFC (Mexico)
   CURP - Codigo CURP (Mexico)
   DDDC - DDD Celular complemento
   TCEL - Telefone celular complemento
   NCN - Nome do Cartorio Nasc
   TDDI - Telefone com o numero do DDI (codigo do pais de origem)
   TADDI - Telefone adicional com o numero do DDI
   DDIC - DDI Celular complemento
   DDICEL - DDI do celular
   DDIFAX - DDI do Fax
   IM - Inscricao Municipal
   RFR - Regimen Fiscal Receptor
*/
BEGIN


if (coalesce(cd_pessoa_fisica_p::text, '') = '') then --Does not require to load the patient data, when the person code is null. This is related to the performance issue.
	return ds_descricao_w;
end if;


BEGIN
	IF (ie_tipo_complemento_p > 0) THEN
		BEGIN
		if (address_pck.get_address_feature_enabled = 'S') then
			SELECT	nr_seq_pessoa_endereco
			INTO STRICT	nr_seq_pessoa_endereco_w
			FROM (SELECT nr_seq_pessoa_endereco
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias2 LIMIT 1;
		end if;

		IF (ie_descricao_p = 'N') THEN
			SELECT	nm_contato
			INTO STRICT	ds_descricao_w
			FROM (SELECT a.nm_contato
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'T') THEN
			SELECT	nr_telefone
			INTO STRICT	ds_descricao_w
			FROM (SELECT (CASE WHEN pkg_i18n.get_user_locale = 'de_DE' OR pkg_i18n.get_user_locale = 'de_AT'
								THEN coalesce(a.ds_fone_adic, a.nr_telefone)
								ELSE a.nr_telefone 
								END) nr_telefone
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias3 LIMIT 1;

		ELSIF (ie_descricao_p = 'TCEL') THEN

			SELECT	nr_telefone_celular
			INTO STRICT	ds_descricao_w
			FROM (SELECT a.nr_telefone_celular
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'DDDC') THEN
			SELECT	nr_ddd_celular
			INTO STRICT	ds_descricao_w
			FROM (SELECT a.nr_ddd_celular
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;


		ELSIF (ie_descricao_p = 'DDIC') THEN
			SELECT	nr_ddi_celular
			INTO STRICT	ds_descricao_w
			FROM (SELECT a.nr_ddi_celular
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;			

		ELSIF (ie_descricao_p = 'C') THEN

			SELECT	nr_cpf
			INTO STRICT	ds_descricao_w
			FROM (SELECT coalesce(a.nr_cpf, b.nr_cpf) nr_cpf
					 FROM	compl_pessoa_fisica 	a,	
						pessoa_fisica		b
					 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
					 AND	a.cd_pessoa_fisica = b.cd_pessoa_fisica
					 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias2 LIMIT 1;

		ELSIF (ie_descricao_p = 'I') THEN
			SELECT	nr_identidade
			INTO STRICT	ds_descricao_w
			FROM (SELECT a.nr_identidade
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;
		ELSIF (ie_descricao_p = 'CI') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	city
					into STRICT	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				SELECT	ds_municipio
				INTO STRICT	ds_descricao_w
				FROM (SELECT a.ds_municipio
						 FROM	compl_pessoa_fisica a
						 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
						 ORDER	BY a.nr_sequencia DESC) alias2 LIMIT 1;
			end if;
		ELSIF (ie_descricao_p = 'UF') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then

					select	city
					into STRICT	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;


			if (coalesce(ds_descricao_w::text, '') = '') then
				SELECT	sg_estado
				INTO STRICT	ds_descricao_w
				FROM (SELECT a.sg_estado
						 FROM	compl_pessoa_fisica a
						 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
						 ORDER	BY a.nr_sequencia DESC) alias2 LIMIT 1;
			end if;
		ELSIF (ie_descricao_p = 'CEP') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	postalCode
					into STRICT	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				SELECT	cd_cep
				INTO STRICT	ds_descricao_w
				FROM (SELECT a.cd_cep
						 FROM	compl_pessoa_fisica a
						WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
						 ORDER	BY a.nr_sequencia DESC) alias2 LIMIT 1;
			end if;

		ELSIF (ie_descricao_p = 'B') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then	
					select	neighborhood
					into STRICT	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				SELECT	ds_bairro
				INTO STRICT	ds_descricao_w
				FROM (SELECT a.ds_bairro
						 FROM	compl_pessoa_fisica a
						 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
						 ORDER	BY a.nr_sequencia DESC) alias2 LIMIT 1;
			end if;
		ELSIF (ie_descricao_p = 'M') THEN
			SELECT	ds_email
			INTO STRICT	ds_descricao_w
			FROM (SELECT a.ds_email
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'E') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then

					select	street || CASE WHEN coalesce(house_number::text, '') = '' THEN ' - '  ELSE ' , '|| TO_CHAR(house_number) END  ||' '|| complement
					into STRICT	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				/* Christian - 14/06/2010 - OS 222558 - Trocado o caractere x por hifen quando nao havia numero */

				SELECT	endereco
				INTO STRICT	ds_descricao_w
				FROM (SELECT ds_endereco || CASE WHEN coalesce(nr_endereco::text, '') = '' THEN ' - '  ELSE ' , '|| TO_CHAR(nr_endereco) END  ||' '|| ds_complemento endereco
						 FROM	compl_pessoa_fisica a
						 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
						 ORDER	BY a.nr_sequencia DESC) alias4 LIMIT 1;
			end if;
		ELSIF (ie_descricao_p = 'EN') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	street
					into STRICT	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				SELECT	endereco
				INTO STRICT	ds_descricao_w
				FROM (SELECT ds_endereco endereco
						 FROM	compl_pessoa_fisica a
						 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
						 ORDER	BY a.nr_sequencia DESC) alias2 LIMIT 1;
			end if;
		ELSIF (ie_descricao_p = 'EDN') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	street || CASE WHEN coalesce(house_number::text, '') = '' THEN ''  ELSE ' ' || to_char(house_number) END
					into STRICT	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				select	ds_endereco
				into STRICT	ds_descricao_w
				from (SELECT	ds_endereco || CASE WHEN coalesce(nr_endereco::text, '') = '' THEN ''  ELSE ' ' || to_char(nr_endereco) END  ds_endereco
					from	compl_pessoa_fisica a
					where	a.cd_pessoa_fisica = cd_pessoa_fisica_p
					and	a.ie_tipo_complemento = ie_tipo_complemento_p
					order by a.nr_sequencia desc) alias4 LIMIT 1;
			end if;
		ELSIF (ie_descricao_p = 'EC') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then	
					select	street || CASE WHEN coalesce(house_number::text, '') = '' THEN ' - '  ELSE ', '|| TO_CHAR(house_number) END  ||
						' ' || complement ||
						' ' || neighborhood ||
						' ' || city ||
						' ' || coalesce(stateCode,stateName)
					into STRICT	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				/* Christian - 14/06/2010 - OS 222558 - Trocado o caractere x por hifen quando nao havia numero */

				SELECT	substr(ds_endereco,1,255)
				INTO STRICT	ds_descricao_w
				FROM (SELECT	ds_endereco || CASE WHEN coalesce(nr_endereco::text, '') = '' THEN ' - '  ELSE ', '|| TO_CHAR(nr_endereco) END  ||
						' ' || ds_complemento ||
						' ' || ds_bairro ||
						' ' || ds_municipio ||
						' ' || sg_estado ds_endereco
					FROM	compl_pessoa_fisica a
					WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
					AND	a.ie_tipo_complemento = ie_tipo_complemento_p
					ORDER BY a.nr_sequencia DESC) alias5 LIMIT 1;
			end if;

		ELSIF (ie_descricao_p = 'ENCB') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	street || CASE WHEN coalesce(house_number::text, '') = '' THEN ' - '  ELSE ', '|| TO_CHAR(house_number) END  || ' ' || complement ||
											' ' || neighborhood
					into STRICT	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				/* Christian - 14/06/2010 - OS 222558 - Trocado o caractere x por hifen quando nao havia numero */

				SELECT	endereco
				INTO STRICT	ds_descricao_w
				FROM (SELECT ds_endereco 	|| CASE WHEN coalesce(nr_endereco::text, '') = '' THEN ' - '  ELSE ', '|| TO_CHAR(nr_endereco) END  || ' ' || ds_complemento ||
											' ' || ds_bairro endereco
						 FROM	compl_pessoa_fisica a
						 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
						 ORDER	BY a.nr_sequencia DESC) alias4 LIMIT 1;
			end if;
		ELSIF (ie_descricao_p = 'ECCT') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					SELECT	substr(nr_telefone,1,255)
					INTO STRICT	ds_adic_w
					FROM (SELECT	nr_telefone
						FROM	compl_pessoa_fisica a
						WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
						AND	a.ie_tipo_complemento = ie_tipo_complemento_p
						ORDER BY a.nr_sequencia DESC) alias4 LIMIT 1;

					select	street || CASE WHEN coalesce(house_number::text, '') = '' THEN ' - '  ELSE ','|| TO_CHAR(house_number) END  ||
						complement ||
						' ' || neighborhood ||
						' ' || city ||
						' ' || coalesce(stateCode,stateName) ||
						' ' || postalCode ||
						' ' || obter_desc_expressao(511267) || ' '  || ds_adic_w
					into STRICT	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				/* Christian - 14/06/2010 - OS 222558 - Trocado o caractere x por hifen quando nao havia numero */

				SELECT	substr(ds_endereco,1,255)
				INTO STRICT	ds_descricao_w
				FROM (SELECT	ds_endereco || CASE WHEN coalesce(nr_endereco::text, '') = '' THEN ' - '  ELSE ','|| TO_CHAR(nr_endereco) END  ||
						ds_complemento ||
						' ' || ds_bairro ||
						' ' || ds_municipio ||
						' ' || sg_estado ||
						' ' || cd_cep ||
						' ' || obter_desc_expressao(511267) || ' '  || nr_telefone ds_endereco
					FROM	compl_pessoa_fisica a
					WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
					AND	a.ie_tipo_complemento = ie_tipo_complemento_p
					ORDER BY a.nr_sequencia DESC) alias6 LIMIT 1;
			end if;
		ELSIF (ie_descricao_p = 'ES') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	street || ' ' ||
						CASE WHEN coalesce(house_number::text, '') = '' THEN ' - '  ELSE ', '|| TO_CHAR(house_number) END  || ' ' ||
						neighborhood || ' ' || complement
					into STRICT	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				/* Christian - 14/06/2010 - OS 222558 - Trocado o caractere x por hifen quando nao havia numero */

				SELECT	endereco
				INTO STRICT	ds_descricao_w
				FROM (SELECT ds_endereco || ' ' ||
						CASE WHEN coalesce(nr_endereco::text, '') = '' THEN ' - '  ELSE ', '|| TO_CHAR(nr_endereco) END  || ' ' ||
						ds_bairro || ' ' || ds_complemento endereco
						 FROM	compl_pessoa_fisica a
						 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
						 ORDER	BY a.nr_sequencia DESC) alias4 LIMIT 1;
			end if;
		ELSIF (ie_descricao_p = 'LES') THEN
			/* Christian - 14/06/2010 - OS 222558 - Trocado o caractere x por hifen quando nao havia numero */

			SELECT	substr(ds_endereco,1,255)
			INTO STRICT	ds_descricao_w
			FROM (SELECT	SUBSTR(Sus_Obter_Desc_TipoLog(cd_tipo_logradouro),1,40)||' '||ds_endereco || ' ' ||
					CASE WHEN coalesce(nr_endereco::text, '') = '' THEN ' - '  ELSE ', '|| TO_CHAR(nr_endereco) END  || ' ' ||
					ds_bairro || ' ' || ds_complemento ds_endereco
				FROM	compl_pessoa_fisica a
				WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
				AND	a.ie_tipo_complemento = ie_tipo_complemento_p
				ORDER	BY a.nr_sequencia DESC) alias6 LIMIT 1;

		ELSIF (ie_descricao_p = 'ESC') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	street || ' ' ||
						CASE WHEN coalesce(house_number::text, '') = '' THEN ' - '  ELSE ', '|| TO_CHAR(house_number) END  || ' ' ||
							complement || ' ' || neighborhood
					into STRICT ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;


			if (coalesce(ds_descricao_w::text, '') = '') then
				/* Christian - 14/06/2010 - OS 222558 - Trocado o caractere x por hifen quando nao havia numero */

				SELECT	endereco
				INTO STRICT	ds_descricao_w
				FROM (SELECT ds_endereco || ' ' ||
						CASE WHEN coalesce(nr_endereco::text, '') = '' THEN ' - '  ELSE ', '|| TO_CHAR(nr_endereco) END  || ' ' ||
							ds_complemento || ' ' || ds_bairro endereco
						 FROM	compl_pessoa_fisica a
						 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
						 ORDER	BY a.nr_sequencia DESC) alias4 LIMIT 1;
			end if;
		ELSIF (ie_descricao_p = 'R') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	street ||
						CASE WHEN coalesce(house_number::text, '') = '' THEN ' - '  ELSE ','|| TO_CHAR(house_number) END  || ' ' ||
						neighborhood || ' ' || complement
					into STRICT 	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				/* Christian - 14/06/2010 - OS 222558 - Trocado o caractere x por hifen quando nao havia numero */

				SELECT	endereco
				INTO STRICT	ds_descricao_w
				FROM (SELECT ds_endereco ||
						CASE WHEN coalesce(nr_endereco::text, '') = '' THEN ' - '  ELSE ','|| TO_CHAR(nr_endereco) END  || ' ' ||
						ds_bairro || ' ' || ds_complemento endereco
						 FROM	compl_pessoa_fisica a
						 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
						 ORDER	BY a.nr_sequencia DESC) alias4 LIMIT 1;
			end if;
		ELSIF (ie_descricao_p = 'P') THEN
			SELECT	ds_profissao
			INTO STRICT	ds_descricao_w
			FROM (SELECT b.ds_profissao
					 FROM	profissao b,
						compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
					 AND	a.cd_profissao = b.cd_profissao
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'S') THEN
			SELECT	nm_empresa
			INTO STRICT	ds_descricao_w
			FROM (SELECT b.nm_empresa
					 FROM	empresa_referencia b,
							compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
					 AND	a.cd_empresa_refer      = b.cd_empresa
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'CS') THEN
			SELECT	cd_empresa_refer
			INTO STRICT	ds_descricao_w
			FROM (SELECT cd_empresa_refer
					 FROM	empresa_referencia b,
							compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
					 AND	a.cd_empresa_refer      = b.cd_empresa
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'O') THEN
			SELECT	ds_observacao
			INTO STRICT	ds_descricao_w
			FROM (SELECT a.ds_observacao
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'NREND') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	house_number
					into STRICT 	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;
			if (coalesce(ds_descricao_w::text, '') = '') then
				SELECT	ds_compl_end
				INTO STRICT	ds_descricao_w
				FROM (SELECT a.ds_compl_end
						 FROM	compl_pessoa_fisica a
						 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
						 ORDER	BY a.nr_sequencia DESC) alias2 LIMIT 1;
			end if;

		ELSIF (ie_descricao_p = 'NR') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	house_number
					into STRICT 	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;
			if (coalesce(ds_descricao_w::text, '') = '') then
				SELECT	nr_endereco
				INTO STRICT	ds_descricao_w
				FROM (SELECT a.nr_endereco
						 FROM	compl_pessoa_fisica a
						 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
						 ORDER	BY a.nr_sequencia DESC) alias2 LIMIT 1;
			end if;
		ELSIF (ie_descricao_p = 'CO') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	complement
					into STRICT 	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				SELECT	ds_complemento
				INTO STRICT	ds_descricao_w
				FROM (SELECT a.ds_complemento
						 FROM	compl_pessoa_fisica a
						 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
						 ORDER	BY a.nr_sequencia DESC) alias2 LIMIT 1;
			end if;
		ELSIF (ie_descricao_p = 'CDM') THEN

			SELECT	cd_municipio_ibge
			INTO STRICT	ds_descricao_w
			FROM (SELECT cd_municipio_ibge
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'DM') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	city
					into STRICT 	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				SELECT	ds_municipio
				INTO STRICT	ds_descricao_w
				FROM (SELECT b.ds_municipio
						 FROM	sus_municipio b,
								compl_pessoa_fisica a
						 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
						 AND	b.cd_municipio_ibge		= a.cd_municipio_ibge
						 ORDER	BY a.nr_sequencia DESC) alias2 LIMIT 1;
			end if;
		ELSIF (ie_descricao_p = 'CDM/DM') THEN

			/* Christian - 14/06/2010 - OS 222558 - Trocado o caractere x por hifen quando nao havia numero */

			SELECT	ds_municipio
			INTO STRICT	ds_descricao_w
			FROM (SELECT b.cd_municipio_ibge ||' - '|| b.ds_municipio ds_municipio
					 FROM	sus_municipio b,
					 		compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
					 AND	b.cd_municipio_ibge		= a.cd_municipio_ibge
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'CDMDV') THEN
			SELECT	cd_municipio_ibge
			INTO STRICT	cd_municipio_ibge_w
			FROM (SELECT	MAX(a.cd_municipio_ibge) cd_municipio_ibge
				FROM	compl_pessoa_fisica a
				WHERE	a.cd_pessoa_fisica  = cd_pessoa_fisica_p
				AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
				ORDER	BY a.cd_municipio_ibge DESC) alias2 LIMIT 1;

			IF (cd_municipio_ibge_w IS NOT NULL AND cd_municipio_ibge_w::text <> '') THEN
				ds_descricao_w := SUBSTR(cd_municipio_ibge_w || SUBSTR(calcula_digito('MODULO10',cd_municipio_ibge_w),1,1),1,255);
			END IF;

		ELSIF (ie_descricao_p = 'CCE') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	postalCode ||' - '|| city ||' - '|| coalesce(stateCode,stateName)
					into STRICT 	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				/* Christian - 14/06/2010 - OS 222558 - Trocado o caractere x por hifen quando nao havia numero */

				SELECT	ds_descricao
				INTO STRICT	ds_descricao_w
				FROM (SELECT a.cd_cep ||' - '||a.ds_municipio||' - '||a.sg_estado ds_descricao
						 FROM	compl_pessoa_fisica a
						 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
						 ORDER	BY a.nr_sequencia DESC) alias2 LIMIT 1;
			end if;

		ELSIF (ie_descricao_p = 'LCCE') THEN

			/* Christian - 14/06/2010 - OS 222558 - Trocado o caractere x por hifen quando nao havia numero */

			SELECT	ds_descricao
			INTO STRICT	ds_descricao_w
			FROM (SELECT SUBSTR(Sus_Obter_Desc_TipoLog(cd_tipo_logradouro),1,40)||' '||a.cd_cep ||' - '||a.ds_municipio||' - '||a.sg_estado ds_descricao
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias3 LIMIT 1;

		ELSIF (ie_descricao_p = 'GP') THEN
			SELECT	ds_parentesco
			INTO STRICT	ds_descricao_w
			FROM (SELECT ds_parentesco
					 FROM	grau_parentesco b,
							compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
					 AND	a.nr_seq_parentesco		= b.nr_sequencia
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;
		elsif (ie_descricao_p = 'TC') THEN
			select	ds_tipo
			into STRICT	ds_descricao_w
			from (SELECT ds_tipo
					 from	tipo_custodia b,
							compl_pessoa_fisica a
					 where	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 and	a.ie_tipo_complemento 	= ie_tipo_complemento_p
					 and	a.nr_seq_tipo_custodia	= b.nr_sequencia
					 order	by a.nr_sequencia desc) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'IEC') THEN

		select	ie_custodiante
		into STRICT	ds_descricao_w
		from (SELECT a.ie_custodiante
				 from	compl_pessoa_fisica a
				 where	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
				 and	a.ie_tipo_complemento 	= ie_tipo_complemento_p
				 order	by a.nr_sequencia desc) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'NA') THEN

			SELECT	ds_nacionalidade
			INTO STRICT	ds_descricao_w
			FROM (SELECT ds_nacionalidade
					 FROM	nacionalidade b,
							pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	a.cd_nacionalidade		= b.cd_nacionalidade) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'RAM') THEN

			SELECT	nr_ramal
			INTO STRICT	ds_descricao_w
			FROM (SELECT a.nr_ramal
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'NPR') THEN
			SELECT	nm_pessoa_fisica
			INTO STRICT	ds_descricao_w
			FROM (SELECT obter_nome_pf(a.cd_pessoa_fisica) nm_pessoa_fisica
					 FROM	pessoa_fisica a,
							compl_pessoa_fisica b
					 WHERE	b.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	b.ie_tipo_complemento 	= ie_tipo_complemento_p
					 AND	b.cd_pessoa_fisica_ref  = a.cd_pessoa_fisica) alias2 LIMIT 1;

		ELSIF (ie_descricao_p = 'FAX') THEN

			SELECT	ds_fax
			INTO STRICT	ds_descricao_w
			FROM (SELECT a.ds_fax
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'DDIFAX') THEN

			SELECT	nr_ddi_fax
			INTO STRICT	ds_descricao_w
			FROM (SELECT a.nr_ddi_fax
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;			

		ELSIF (ie_descricao_p = 'TLS') THEN

			SELECT	cd_tipo_logradouro
			INTO STRICT	ds_descricao_w
			FROM (SELECT a.cd_tipo_logradouro
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'DIT') THEN

			SELECT	nr_ddi_telefone
			INTO STRICT	ds_descricao_w
			FROM (SELECT a.nr_ddi_telefone
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'DDT') THEN
			SELECT	nr_ddd_telefone
			INTO STRICT	ds_descricao_w
			FROM (SELECT a.nr_ddd_telefone
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'DIF') THEN
			SELECT	nr_ddi_fax
			INTO STRICT	ds_descricao_w
			FROM (SELECT a.nr_ddi_fax
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'DDF') THEN
			SELECT	nr_ddd_fax
			INTO STRICT	ds_descricao_w
			FROM (SELECT a.nr_ddd_fax
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'WS') THEN
			SELECT	ds_website
			INTO STRICT	ds_descricao_w
			FROM (SELECT a.ds_website
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'TA') THEN

			SELECT	ds_fone_adic
			INTO STRICT	ds_descricao_w
			FROM (SELECT a.ds_fone_adic
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'PAIS') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	SUBSTR(obter_nome_pais(countrySeq),1,200)
					into STRICT 	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				SELECT	SUBSTR(obter_nome_pais(nr_seq_pais),1,200)
				INTO STRICT	ds_descricao_w
				FROM (SELECT a.nr_seq_pais
						 FROM	compl_pessoa_fisica a
						 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
						 ORDER	BY a.nr_sequencia DESC) alias4 LIMIT 1;
			end if;
		ELSIF (ie_descricao_p = 'CPAIS') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	SUBSTR(obter_codigo_pais(countrySeq),1,200)
					into STRICT 	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				SELECT	SUBSTR(obter_codigo_pais(nr_seq_pais),1,200)
				INTO STRICT	ds_descricao_w
				FROM (SELECT a.nr_seq_pais
						 FROM	compl_pessoa_fisica a
						 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
						 ORDER	BY a.nr_sequencia DESC) alias4 LIMIT 1;
			end if;
		ELSIF (ie_descricao_p = 'CBPAIS') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	SUBSTR(obter_cd_bacen_pais(countrySeq),1,10)
					into STRICT 	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				SELECT	SUBSTR(obter_cd_bacen_pais(nr_seq_pais),1,10)
				INTO STRICT	ds_descricao_w
				FROM (SELECT a.nr_seq_pais
						 FROM	compl_pessoa_fisica a
						 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
						 ORDER	BY a.nr_sequencia DESC) alias4 LIMIT 1;
			end if;

		ELSIF (ie_descricao_p = 'NFC') THEN
			SELECT	ie_nf_correio
			INTO STRICT	ds_descricao_w
			FROM (SELECT	ie_nf_correio
				FROM	compl_pessoa_fisica a
				WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
				AND	a.ie_tipo_complemento = ie_tipo_complemento_p
				ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'TPD') THEN
			SELECT	MAX(DS_TIPO_PESSOA)
			INTO STRICT	ds_descricao_w
			FROM	tipo_pessoa_juridica b,
				pessoa_fisica a
			WHERE	a.cd_tipo_pj		= b.cd_tipo_pessoa
			AND	a.cd_pessoa_fisica	= cd_pessoa_fisica_p;

		ELSIF (ie_descricao_p = 'TP') THEN
			SELECT	a.cd_tipo_pj
			INTO STRICT	ds_descricao_w
			FROM	pessoa_fisica a
			WHERE	a.cd_pessoa_fisica	= cd_pessoa_fisica_p;

		ELSIF (ie_descricao_p = 'Z') THEN
			SELECT	cd_zona_procedencia
			INTO STRICT	ds_descricao_w
			FROM (SELECT a.cd_zona_procedencia
					 FROM	compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
					 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'DSM') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	city
					into STRICT 	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				SELECT	ds_municipio
				INTO STRICT	ds_descricao_w
				FROM (SELECT a.ds_municipio
						 FROM	compl_pessoa_fisica a
						 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
						 ORDER	BY a.nr_sequencia DESC) alias2 LIMIT 1;
			end if;
		ELSIF (ie_descricao_p = 'CNES') THEN
			SELECT	MAX(a.cd_cnes)
			INTO STRICT	ds_descricao_w
			FROM	compl_pessoa_fisica b,
				cnes_identificacao a
			WHERE	b.nr_seq_ident_cnes	= a.nr_sequencia
			AND	b.cd_pessoa_fisica	= cd_pessoa_fisica_p
			AND	ie_tipo_complemento	= ie_tipo_complemento_p;


			IF (coalesce(ds_descricao_w::text, '') = '') THEN
				SELECT	cd_cnes
				INTO STRICT	ds_descricao_w
				FROM	pessoa_fisica
				WHERE	cd_pessoa_fisica	= cd_pessoa_fisica_p;
			END IF;

		ELSIF (ie_descricao_p = 'CCM') THEN
			SELECT 	nr_ccm
			INTO STRICT	ds_descricao_w
			FROM	pessoa_fisica
			WHERE	cd_pessoa_fisica	= cd_pessoa_fisica_p;


		ELSIF (ie_descricao_p = 'NOMECONJ') THEN

			SELECT	substr(obter_nome_pf(cd_pessoa_fisica),1,255)
			INTO STRICT	ds_descricao_w
			FROM	pessoa_fisica
			WHERE	cd_pessoa_fisica = (SELECT cd_pessoa_fisica_ref
						    FROM 	compl_pessoa_fisica a
					            WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
   						    AND		a.ie_tipo_complemento = ie_tipo_complemento_p);

		ELSIF (ie_descricao_p = 'DTNASCONJ') THEN

			SELECT	TO_CHAR(dt_nascimento,'dd/mm/yyyy')
			INTO STRICT	ds_descricao_w
			FROM	pessoa_fisica
			WHERE	cd_pessoa_fisica = (SELECT cd_pessoa_fisica_ref
						    FROM 	compl_pessoa_fisica a
					            WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
   						    AND		a.ie_tipo_complemento = ie_tipo_complemento_p);

		ELSIF (ie_descricao_p = 'IDADECONJ') THEN
			SELECT	obter_idade(dt_nascimento,clock_timestamp(),'S')
			INTO STRICT	ds_descricao_w
			FROM	pessoa_fisica
			WHERE	cd_pessoa_fisica = (SELECT cd_pessoa_fisica_ref
						    FROM	compl_pessoa_fisica a
					            WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
 						    AND		a.ie_tipo_complemento = ie_tipo_complemento_p);

		ELSIF (ie_descricao_p = 'SEXOCONJ') THEN

			SELECT	ie_sexo
			INTO STRICT	ds_descricao_w
			FROM	pessoa_fisica
			WHERE	cd_pessoa_fisica = (SELECT cd_pessoa_fisica_ref
						    FROM	compl_pessoa_fisica a
					            WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
  						    AND		a.ie_tipo_complemento = ie_tipo_complemento_p);

		ELSIF (ie_descricao_p = 'PFREF') THEN
			SELECT MAX(cd_pessoa_fisica_ref)
			INTO STRICT	ds_descricao_w
			FROM	compl_pessoa_fisica a
			WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
			AND	a.ie_tipo_complemento = ie_tipo_complemento_p;
		ELSIF (ie_descricao_p = 'ME') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	city || ' - ' || coalesce(stateCode,stateName)
					into STRICT 	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				SELECT	ds_descricao
				INTO STRICT	ds_descricao_w
				FROM (SELECT	a.ds_municipio||' - '||a.sg_estado ds_descricao
						FROM	compl_pessoa_fisica a
						WHERE	a.cd_pessoa_fisica	= cd_pessoa_fisica_p
						AND	a.ie_tipo_complemento	= ie_tipo_complemento_p
						ORDER	BY a.nr_sequencia DESC) alias2 LIMIT 1;
			end if;

		ELSIF (ie_descricao_p = 'CP') THEN
			SELECT	ds_profissao
			INTO STRICT	ds_descricao_w
			FROM (SELECT cd_profissao ds_profissao
				 FROM	compl_pessoa_fisica a
				 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
				 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
				 ORDER	BY a.nr_sequencia DESC) alias1 LIMIT 1;

		ELSIF (ie_descricao_p = 'TIPOSANGUECONJ') THEN
			SELECT	ie_tipo_sangue
			INTO STRICT	ds_descricao_w
			FROM	compl_pessoa_fisica a
			WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
			AND	a.ie_tipo_complemento = ie_tipo_complemento_p;

		ELSIF (ie_descricao_p = 'FATORRH') THEN
			SELECT	ie_fator_rh
			INTO STRICT	ds_descricao_w
			FROM	compl_pessoa_fisica a
			WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
			AND	a.ie_tipo_complemento = ie_tipo_complemento_p;

		ELSIF (ie_descricao_p = 'CEL') THEN
			SELECT	a.nr_telefone_celular
			INTO STRICT	ds_descricao_w
			FROM	pessoa_fisica a
			WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p;

		ELSIF (ie_descricao_p = 'DDDCEL') THEN
			SELECT  nr_ddd_celular
			INTO STRICT	ds_descricao_w
			FROM	pessoa_fisica a
			WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p;


		ELSIF (ie_descricao_p = 'DDICEL') THEN
			SELECT  nr_ddi_celular
			INTO STRICT	ds_descricao_w
			FROM	pessoa_fisica a
			WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p;			


		ELSIF (ie_descricao_p = 'SE') THEN
			SELECT	ie_sexo
			INTO STRICT	ds_descricao_w
			FROM	pessoa_fisica
			WHERE	cd_pessoa_fisica = cd_pessoa_fisica_p;

		ELSIF (ie_descricao_p = 'NP') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	countrySeq
					into STRICT 	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				SELECT	nr_seq_pais
				INTO STRICT	ds_descricao_w
				FROM (SELECT a.nr_seq_pais
						 FROM	compl_pessoa_fisica a
						 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
						 ORDER	BY a.nr_sequencia DESC) alias2 LIMIT 1;
			end if;

		ELSIF (ie_descricao_p = 'COMIB') THEN
			SELECT	ds_coordenadoria
			INTO STRICT	ds_descricao_w
			FROM (SELECT SUBSTR(sus_obter_desc_coordenad(nr_seq_coordenadoria),1,255) ds_coordenadoria
					 FROM	sus_municipio b,
					 		compl_pessoa_fisica a
					 WHERE	a.cd_pessoa_fisica 		= cd_pessoa_fisica_p
					 AND	a.ie_tipo_complemento 	= ie_tipo_complemento_p
					 AND	b.cd_municipio_ibge		= a.cd_municipio_ibge
					 ORDER	BY a.nr_sequencia DESC) alias3 LIMIT 1;

		ELSIF (ie_descricao_p = 'SNR') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	street
					into STRICT	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				SELECT	max(a.ds_endereco)
				INTO STRICT	ds_descricao_w
				FROM	compl_pessoa_fisica a
				WHERE	a.ie_tipo_complemento	= ie_tipo_complemento_p
				and	a.cd_pessoa_fisica	= cd_pessoa_fisica_p;
			end if;
		elsif (ie_descricao_p = 'ENDR') then
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	street || ', ' || TO_CHAR(house_number) || ', ' || complement || ', ' || neighborhood ||
						'                                  ' || OBTER_DESC_EXPRESSAO(302837) || ': ' || city || 
						'                                  ' || OBTER_DESC_EXPRESSAO(284796) || ': ' || postalCode || 
						'                                  ' || OBTER_DESC_EXPRESSAO(289525) || ': ' || coalesce(stateCode,stateName)
					into STRICT	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				SELECT	substr(ds_endereco,1,255)
				INTO STRICT	ds_descricao_w
				FROM (SELECT a.ds_endereco || ', ' || TO_CHAR(a.nr_endereco) || ', ' || a.ds_complemento || ', ' || a.ds_bairro ||
						'                                  ' || OBTER_DESC_EXPRESSAO(302837) || ': ' || a.ds_municipio || 
						'                                  ' || OBTER_DESC_EXPRESSAO(284796) || ': ' || a.cd_cep || 
						'                                  ' || OBTER_DESC_EXPRESSAO(289525) || ': ' || a.sg_estado ds_endereco
					FROM	compl_pessoa_fisica a
					WHERE	a.cd_pessoa_fisica	= cd_pessoa_fisica_p
					AND	a.ie_tipo_complemento	= ie_tipo_complemento_p
					ORDER	BY a.nr_sequencia DESC) alias7 LIMIT 1;
			end if;
		elsif (ie_descricao_p = 'RFC') THEN
			SELECT	a.cd_rfc
			INTO STRICT	ds_descricao_w
			FROM	pessoa_fisica a
			WHERE	a.cd_pessoa_fisica	= cd_pessoa_fisica_p;

		elsif (ie_descricao_p = 'CURP') THEN
			SELECT	a.cd_curp
			INTO STRICT	ds_descricao_w
			FROM	pessoa_fisica a
			WHERE	a.cd_pessoa_fisica	= cd_pessoa_fisica_p;

		elsif (ie_descricao_p = 'IM') THEN
			SELECT	a.nr_inscricao_municipal
			INTO STRICT	ds_descricao_w
			FROM	pessoa_fisica a
			WHERE	a.cd_pessoa_fisica	= cd_pessoa_fisica_p;

		elsif (ie_descricao_p = 'PAISSISCOSERV') THEN
			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	SUBSTR(obter_cd_siscoserv_pais(countrySeq),1,10)
					into STRICT	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;

			if (coalesce(ds_descricao_w::text, '') = '') then
				SELECT	SUBSTR(obter_cd_siscoserv_pais(nr_seq_pais),1,10)
				INTO STRICT	ds_descricao_w
				FROM ( SELECT a.nr_seq_pais
						 FROM	compl_pessoa_fisica a
						 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
						 ORDER	BY a.nr_sequencia DESC) alias4 LIMIT 1;
			end if;
		elsif (ie_descricao_p = 'NCN') then
			select	substr(ds_cartorio,1,100)
			into STRICT	ds_descricao_w
			from (SELECT	c.ds_cartorio
				 from	cartorio c,
					pessoa_fisica a
				where	c.nr_sequencia = a.nr_seq_cartorio_nasc
				and	a.cd_pessoa_fisica = 179678) alias2 LIMIT 1;
		ELSIF (ie_descricao_p = 'TDDI')THEN
			SELECT Obter_Nr_Cel_Int(A.nr_ddi_telefone, A.nr_telefone)
			INTO STRICT	 ds_descricao_w
			FROM	COMPL_PESSOA_FISICA A
			WHERE	A.cd_pessoa_fisica = cd_pessoa_fisica_p
			AND	A.ie_tipo_complemento = ie_tipo_complemento_p
			ORDER	BY A.nr_sequencia DESC;
		ELSIF (ie_descricao_p = 'TADDI') THEN
			SELECT	Obter_Nr_Cel_Int(nr_ddi_fone_adic, ds_fone_adic)
			INTO STRICT	ds_descricao_w
			FROM (SELECT A.ds_fone_adic,
					A.nr_ddi_fone_adic
					FROM	COMPL_PESSOA_FISICA A
					WHERE	A.cd_pessoa_fisica	= cd_pessoa_fisica_p
					AND	A.ie_tipo_complemento	= ie_tipo_complemento_p
					ORDER	BY A.nr_sequencia DESC) alias2 LIMIT 1;
		ELSIF (ie_descricao_p = 'DS_UF') THEN

			if (address_pck.get_address_feature_enabled = 'S') and (nr_seq_pessoa_endereco_w IS NOT NULL AND nr_seq_pessoa_endereco_w::text <> '') then
					select	stateName
					into STRICT	ds_descricao_w
					from	table(address_pck.get_address_fields(nr_seq_pessoa_endereco_w));
			end if;
			if (coalesce(ds_descricao_w::text, '') = '') then
				SELECT	substr(obter_valor_dominio(50,sg_estado),1,255)
				INTO STRICT	ds_descricao_w
				FROM ( SELECT a.sg_estado
						 FROM	compl_pessoa_fisica a
						 WHERE	a.cd_pessoa_fisica = cd_pessoa_fisica_p
						 AND	a.ie_tipo_complemento = ie_tipo_complemento_p
						 ORDER	BY a.nr_sequencia DESC) alias4 LIMIT 1;
			end if;
		elsif (ie_descricao_p = 'RFR') then
			select	max(b.cd_regime_fiscal)
			into STRICT	ds_descricao_w
			from	pessoa_fisica a,
				pessoa_fisica_aux b
			where	a.cd_pessoa_fisica = cd_pessoa_fisica_p
			and	a.cd_pessoa_fisica = b.cd_pessoa_fisica
			and 	(b.cd_regime_fiscal IS NOT NULL AND b.cd_regime_fiscal::text <> '');
		END IF;


	   	END;

	END IF;

EXCEPTION

WHEN OTHERS THEN

	ds_descricao_w := '';

END;

RETURN ds_descricao_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_compl_pf (cd_pessoa_fisica_p text, ie_tipo_complemento_p bigint, ie_descricao_p text) FROM PUBLIC;

