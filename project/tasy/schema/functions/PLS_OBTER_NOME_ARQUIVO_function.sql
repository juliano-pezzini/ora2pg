-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_nome_arquivo ( ds_arquivo_p text, ie_com_extensao_p text) RETURNS varchar AS $body$
DECLARE



/*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:   Retornar somente o nome do arquivo (anexo), sem o diretório
----------------------------------------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [ ] Tasy (Delphi/Java) [ X ] Portal [  ] Relatórios [ ] Outros:
 ----------------------------------------------------------------------------------------------------------------------------------------------------
Pontos de atenção:

IE_COM_EXTENSAO_P
S - Retorna o nome do arquivo com a extensao.
N - Retorna o nome do arquivo sem a extensão.

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/ds_retorno_w			varchar(2000);
ds_arquivo_w			varchar(2000);
ds_arquivo_ww			varchar(2000);
qt_posicao_w			bigint;
qt_posicao_ww			bigint := 0;


BEGIN
ds_arquivo_w		:= substr(ds_arquivo_p,1,2000);

if (position('tasy-storage' in ds_arquivo_w) > 0) then
	ds_arquivo_w	:= substr(ds_arquivo_w, instr(ds_arquivo_w,'?',1,1) + 1,length(ds_arquivo_w));

	if (ie_com_extensao_p = 'N') and (position('.' in ds_arquivo_w) > 0) then
		ds_arquivo_w	:= substr(ds_arquivo_w, 0, instr(ds_arquivo_w,'.',1,1) -1);
	end if;
else
	while position('\') > 0 loop --'
		begin
		ds_arquivo_w := substr(ds_arquivo_w,instr(ds_arquivo_w,'\')+1,2000); --'
		end;
	end loop;

	if	(ie_com_extensao_p = 'N') and
		(instr(ds_arquivo_w,'.') > 0) then
		ds_arquivo_ww := ds_arquivo_w;

		while instr(ds_arquivo_ww,'.') > 0 loop
			begin
			qt_posicao_w	:= instr(ds_arquivo_ww,'.' in ds_arquivo_w);
			ds_arquivo_ww 	:= substr(ds_arquivo_ww, qt_posicao_w +1,2000);
			qt_posicao_ww	:= qt_posicao_ww + qt_posicao_w;
			end;
		end loop;
		ds_arquivo_w := substr(ds_arquivo_w,1,qt_posicao_ww -1);
	end if;
end if;

return	ds_arquivo_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_nome_arquivo ( ds_arquivo_p text, ie_com_extensao_p text) FROM PUBLIC;

