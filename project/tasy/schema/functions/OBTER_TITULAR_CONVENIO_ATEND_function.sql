-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_titular_convenio_atend ( nr_atendimento_p bigint, cd_convenio_p bigint, ie_opcao_p text ) RETURNS varchar AS $body$
DECLARE


/*	ie_valor_p		C - Codigo
				D - Descricao
*/
    ds_resultado_w        varchar(60);
    cd_pessoa_titular_w   atend_categoria_convenio.cd_pessoa_titular%type;

BEGIN
    SELECT
        MAX(acc.cd_pessoa_titular)
    INTO STRICT
    	cd_pessoa_titular_w
    FROM
        atend_categoria_convenio   acc,
        atendimento_paciente       ap
    WHERE
        acc.nr_atendimento = ap.nr_atendimento
        AND ap.nr_atendimento = nr_atendimento_p
        AND acc.cd_convenio = cd_convenio_p;

    IF ( upper(ie_opcao_p) = 'C' ) THEN
        ds_resultado_w := cd_pessoa_titular_w;
    ELSE
        IF (cd_pessoa_titular_w IS NOT NULL AND cd_pessoa_titular_w::text <> '') THEN
            ds_resultado_w := substr(obter_nome_pf(cd_pessoa_titular_w), 1, 60);
        END IF;
    END IF;

    RETURN ds_resultado_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_titular_convenio_atend ( nr_atendimento_p bigint, cd_convenio_p bigint, ie_opcao_p text ) FROM PUBLIC;

