-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_qt_erro_total_calibracao ( nr_sequencia_p bigint) RETURNS bigint AS $body$
DECLARE


qt_incerteza_medicao_w			double precision;
qt_media_leitura_w				double precision;
vl_saida_w				double precision;
vl_erro_1_w				double precision := 0;
vl_erro_2_w				double precision := 0;
vl_resultado_w				double precision := 0;
cd_estabelecimento_w			estabelecimento.cd_estabelecimento%type	:= wheb_usuario_pck.get_cd_estabelecimento;
nm_usuario_w				usuario.nm_usuario%type	:= wheb_usuario_pck.get_nm_usuario;
ie_valor_modulo_w			varchar(1)	:= 'N';


BEGIN

select	coalesce(qt_incerteza_medicao,0),
	coalesce(qt_media_leitura,0),
	coalesce(vl_saida,0)
into STRICT	qt_incerteza_medicao_w,
	qt_media_leitura_w,
	vl_saida_w
from	man_calibracao
where	nr_sequencia = nr_sequencia_p;

vl_erro_1_w := ((qt_media_leitura_w - vl_saida_w) + qt_incerteza_medicao_w);
vl_erro_2_w := ((qt_media_leitura_w - vl_saida_w) - qt_incerteza_medicao_w);

ie_valor_modulo_w := obter_param_usuario(298, 105, obter_perfil_Ativo, nm_usuario_w, cd_estabelecimento_w, ie_valor_modulo_w);

if	((vl_erro_1_w = vl_erro_2_w) or (abs(vl_erro_1_w) > abs(vl_erro_2_w))) then
	if (ie_valor_modulo_w = 'S') then
		vl_resultado_w := abs(vl_erro_1_w);
	else
		vl_resultado_w := vl_erro_1_w;
	end if;
else
	if (ie_valor_modulo_w = 'S') then
		vl_resultado_w := abs(vl_erro_2_w);
	else
		vl_resultado_w := vl_erro_2_w;
	end if;
end if;

return vl_resultado_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_qt_erro_total_calibracao ( nr_sequencia_p bigint) FROM PUBLIC;

