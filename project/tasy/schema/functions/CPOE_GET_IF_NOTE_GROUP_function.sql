-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cpoe_get_if_note_group ( nr_sequencia_p bigint, cd_material_p bigint, cd_mat_comp1_p bigint, cd_mat_comp2_p bigint, cd_mat_comp3_p bigint, cd_mat_comp4_p bigint, cd_mat_comp5_p bigint, cd_mat_comp6_p bigint, cd_mat_comp7_p bigint, cd_mat_dil_p bigint) RETURNS varchar AS $body$
DECLARE


qt_count_w					bigint := 0;
cd_material_regra_w			cpoe_observacao_material.cd_material%type;
cd_estabelecimento_w		estabelecimento.cd_estabelecimento%type;
cd_classe_material_w		material.cd_classe_material%type;
cd_grupo_material_w			subgrupo_material.cd_grupo_material%type;
cd_subgrupo_material_w		classe_material.cd_subgrupo_material%type;


BEGIN

cd_estabelecimento_w := obter_estabelecimento_ativo();

if (nr_sequencia_p IS NOT NULL AND nr_sequencia_p::text <> '') then

	if (cd_material_p IS NOT NULL AND cd_material_p::text <> '') then
			

		cd_classe_material_w 	:= Obter_estrutura_material(cd_material_p, 'C');
		cd_grupo_material_w	 	:= Obter_estrutura_material(cd_material_p, 'G');
		cd_subgrupo_material_w 	:= Obter_estrutura_material(cd_material_p, 'S');
		
		select  count(*)
		into STRICT    qt_count_w
		from    cpoe_observacao_material
		where 	nr_sequencia = nr_sequencia_p
		and (coalesce(cd_material::text, '') = '' or cd_material = cd_material_p)
		and (coalesce(cd_classe_material::text, '') = '' or cd_classe_material = cd_classe_material_w)
		and (coalesce(cd_grupo_material::text, '') = '' or cd_grupo_material = cd_grupo_material_w)
		and (coalesce(cd_subgrupo_material::text, '') = '' or cd_subgrupo_material = cd_subgrupo_material_w)
		and		coalesce(ie_situacao, 'N') = 'A'
		and    	cd_estabelecimento = cd_estabelecimento_w;
		if (qt_count_w > 0) then
			return 'S';
		end if;
	end if;
	
	if (cd_mat_comp1_p IS NOT NULL AND cd_mat_comp1_p::text <> '') then
		
		cd_classe_material_w 	:= Obter_estrutura_material(cd_mat_comp1_p,'C');
		cd_grupo_material_w	 	:= Obter_estrutura_material(cd_mat_comp1_p,'G');
		cd_subgrupo_material_w 	:= Obter_estrutura_material(cd_mat_comp1_p,'S');
		
		select  count(*)
		into STRICT    qt_count_w
		from    cpoe_observacao_material
		where 	nr_sequencia = nr_sequencia_p
		and ((cd_material IS NOT NULL AND cd_material::text <> '') and cd_material = cd_mat_comp1_p)
		and (coalesce(cd_classe_material::text, '') = '' or cd_classe_material = cd_classe_material_w)
		and (coalesce(cd_grupo_material::text, '') = '' or cd_grupo_material = cd_grupo_material_w)
		and (coalesce(cd_subgrupo_material::text, '') = '' or cd_subgrupo_material = cd_subgrupo_material_w)
		and		coalesce(ie_situacao, 'N') = 'A'
		and    	cd_estabelecimento = cd_estabelecimento_w;
		if (qt_count_w > 0) then
			return 'S';
		end if;
	end if;
	
	if (cd_mat_comp2_p IS NOT NULL AND cd_mat_comp2_p::text <> '') then
		
		cd_classe_material_w 	:= Obter_estrutura_material(cd_mat_comp2_p,'C');
		cd_grupo_material_w	 	:= Obter_estrutura_material(cd_mat_comp2_p,'G');
		cd_subgrupo_material_w 	:= Obter_estrutura_material(cd_mat_comp2_p,'S');
		
		select  count(*)
		into STRICT    qt_count_w
		from    cpoe_observacao_material
		where 	nr_sequencia = nr_sequencia_p
		and (coalesce(cd_material::text, '') = '' or cd_material = cd_mat_comp2_p)
		and (coalesce(cd_classe_material::text, '') = '' or cd_classe_material = cd_classe_material_w)
		and (coalesce(cd_grupo_material::text, '') = '' or cd_grupo_material = cd_grupo_material_w)
		and (coalesce(cd_subgrupo_material::text, '') = '' or cd_subgrupo_material = cd_subgrupo_material_w)
		and		coalesce(ie_situacao, 'N') = 'A'
		and    	cd_estabelecimento = cd_estabelecimento_w;
		if (qt_count_w > 0) then
			return 'S';
		end if;
	end if;
	
	if (cd_mat_comp3_p IS NOT NULL AND cd_mat_comp3_p::text <> '') then
		
		cd_classe_material_w 	:= Obter_estrutura_material(cd_mat_comp3_p,'C');
		cd_grupo_material_w	 	:= Obter_estrutura_material(cd_mat_comp3_p,'G');
		cd_subgrupo_material_w 	:= Obter_estrutura_material(cd_mat_comp3_p,'S');
		
		select  count(*)
		into STRICT    qt_count_w
		from    cpoe_observacao_material
		where 	nr_sequencia = nr_sequencia_p
		and (coalesce(cd_material::text, '') = '' or cd_material = cd_mat_comp3_p)
		and (coalesce(cd_classe_material::text, '') = '' or cd_classe_material = cd_classe_material_w)
		and (coalesce(cd_grupo_material::text, '') = '' or cd_grupo_material = cd_grupo_material_w)
		and (coalesce(cd_subgrupo_material::text, '') = '' or cd_subgrupo_material = cd_subgrupo_material_w)
		and		coalesce(ie_situacao, 'N') = 'A'
		and    	cd_estabelecimento = cd_estabelecimento_w;
		if (qt_count_w > 0) then
			return 'S';
		end if;
	end if;
	
	if (cd_mat_comp4_p IS NOT NULL AND cd_mat_comp4_p::text <> '') then
		
		cd_classe_material_w 	:= Obter_estrutura_material(cd_mat_comp4_p,'C');
		cd_grupo_material_w	 	:= Obter_estrutura_material(cd_mat_comp4_p,'G');
		cd_subgrupo_material_w 	:= Obter_estrutura_material(cd_mat_comp4_p,'S');
		
		select  count(*)
		into STRICT    qt_count_w
		from    cpoe_observacao_material
		where 	nr_sequencia = nr_sequencia_p
		and (coalesce(cd_material::text, '') = '' or cd_material = cd_mat_comp4_p)
		and (coalesce(cd_classe_material::text, '') = '' or cd_classe_material = cd_classe_material_w)
		and (coalesce(cd_grupo_material::text, '') = '' or cd_grupo_material = cd_grupo_material_w)
		and (coalesce(cd_subgrupo_material::text, '') = '' or cd_subgrupo_material = cd_subgrupo_material_w)
		and		coalesce(ie_situacao, 'N') = 'A'
		and    	cd_estabelecimento = cd_estabelecimento_w;
		if (qt_count_w > 0) then
			return 'S';
		end if;
	end if;
	
	if (cd_mat_comp5_p IS NOT NULL AND cd_mat_comp5_p::text <> '') then
		
		cd_classe_material_w 	:= Obter_estrutura_material(cd_mat_comp5_p,'C');
		cd_grupo_material_w	 	:= Obter_estrutura_material(cd_mat_comp5_p,'G');
		cd_subgrupo_material_w 	:= Obter_estrutura_material(cd_mat_comp5_p,'S');
		
		select  count(*)
		into STRICT    qt_count_w
		from    cpoe_observacao_material
		where 	nr_sequencia = nr_sequencia_p
		and (coalesce(cd_material::text, '') = '' or cd_material = cd_mat_comp5_p)
		and (coalesce(cd_classe_material::text, '') = '' or cd_classe_material = cd_classe_material_w)
		and (coalesce(cd_grupo_material::text, '') = '' or cd_grupo_material = cd_grupo_material_w)
		and (coalesce(cd_subgrupo_material::text, '') = '' or cd_subgrupo_material = cd_subgrupo_material_w)
		and		coalesce(ie_situacao, 'N') = 'A'
		and    	cd_estabelecimento = cd_estabelecimento_w;
		if (qt_count_w > 0) then
			return 'S';
		end if;
	end if;
	
	if (cd_mat_comp6_p IS NOT NULL AND cd_mat_comp6_p::text <> '') then
		
		cd_classe_material_w 	:= Obter_estrutura_material(cd_mat_comp6_p,'C');
		cd_grupo_material_w	 	:= Obter_estrutura_material(cd_mat_comp6_p,'G');
		cd_subgrupo_material_w 	:= Obter_estrutura_material(cd_mat_comp6_p,'S');
		
		select  count(*)
		into STRICT    qt_count_w
		from    cpoe_observacao_material
		where 	nr_sequencia = nr_sequencia_p
		and (coalesce(cd_material::text, '') = '' or cd_material = cd_mat_comp6_p)
		and (coalesce(cd_classe_material::text, '') = '' or cd_classe_material = cd_classe_material_w)
		and (coalesce(cd_grupo_material::text, '') = '' or cd_grupo_material = cd_grupo_material_w)
		and (coalesce(cd_subgrupo_material::text, '') = '' or cd_subgrupo_material = cd_subgrupo_material_w)
		and		coalesce(ie_situacao, 'N') = 'A'
		and    	cd_estabelecimento = cd_estabelecimento_w;
		if (qt_count_w > 0) then
			return 'S';
		end if;
	end if;
	
	if (cd_mat_comp7_p IS NOT NULL AND cd_mat_comp7_p::text <> '') then
		
		cd_classe_material_w 	:= Obter_estrutura_material(cd_mat_comp7_p,'C');
		cd_grupo_material_w	 	:= Obter_estrutura_material(cd_mat_comp7_p,'G');
		cd_subgrupo_material_w 	:= Obter_estrutura_material(cd_mat_comp7_p,'S');
		
		select  count(*)
		into STRICT    qt_count_w
		from    cpoe_observacao_material
		where 	nr_sequencia = nr_sequencia_p
		and (coalesce(cd_material::text, '') = '' or cd_material = cd_mat_comp7_p)
		and (coalesce(cd_classe_material::text, '') = '' or cd_classe_material = cd_classe_material_w)
		and (coalesce(cd_grupo_material::text, '') = '' or cd_grupo_material = cd_grupo_material_w)
		and (coalesce(cd_subgrupo_material::text, '') = '' or cd_subgrupo_material = cd_subgrupo_material_w)
		and		coalesce(ie_situacao, 'N') = 'A'
		and    	cd_estabelecimento = cd_estabelecimento_w;
		if (qt_count_w > 0) then
			return 'S';
		end if;
	end if;
	
	if (cd_mat_dil_p IS NOT NULL AND cd_mat_dil_p::text <> '') then
		
		cd_classe_material_w 	:= Obter_estrutura_material(cd_mat_dil_p,'C');
		cd_grupo_material_w	 	:= Obter_estrutura_material(cd_mat_dil_p,'G');
		cd_subgrupo_material_w 	:= Obter_estrutura_material(cd_mat_dil_p,'S');
		
		select  count(*)
		into STRICT    qt_count_w
		from    cpoe_observacao_material
		where 	nr_sequencia = nr_sequencia_p
		and (coalesce(cd_material::text, '') = '' or cd_material = cd_mat_dil_p)
		and (coalesce(cd_classe_material::text, '') = '' or cd_classe_material = cd_classe_material_w)
		and (coalesce(cd_grupo_material::text, '') = '' or cd_grupo_material = cd_grupo_material_w)
		and (coalesce(cd_subgrupo_material::text, '') = '' or cd_subgrupo_material = cd_subgrupo_material_w)
		and		coalesce(ie_situacao, 'N') = 'A'
		and    	cd_estabelecimento = cd_estabelecimento_w;
		if (qt_count_w > 0) then
			return 'S';
		end if;
	end if;

	return 'N';

end if;

return 'N';

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_get_if_note_group ( nr_sequencia_p bigint, cd_material_p bigint, cd_mat_comp1_p bigint, cd_mat_comp2_p bigint, cd_mat_comp3_p bigint, cd_mat_comp4_p bigint, cd_mat_comp5_p bigint, cd_mat_comp6_p bigint, cd_mat_comp7_p bigint, cd_mat_dil_p bigint) FROM PUBLIC;

