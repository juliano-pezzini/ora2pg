-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_hist_saude_dados_biomet (nr_atendimento_p bigint) RETURNS varchar AS $body$
DECLARE


ds_retorno_w		varchar(4000);
qt_peso_w		double precision;
qt_altura_cm_w		double precision;
qt_imc_w		real;
qt_superf_corporia_w	double precision;
dt_sinal_vital_w	timestamp;


BEGIN

begin
select	qt_peso,
	qt_altura_cm,
	qt_imc,
	qt_superf_corporia,
	dt_sinal_vital
into STRICT	qt_peso_w,
	qt_altura_cm_w,
	qt_imc_w,
	qt_superf_corporia_w,
	dt_sinal_vital_w
from	atendimento_sinal_vital
where	nr_atendimento	= nr_atendimento_p
and	dt_sinal_vital	= (	SELECT	max(b.dt_sinal_vital)
				from	atendimento_sinal_vital b
				where	b.nr_atendimento	= nr_atendimento_p
				and	(qt_peso IS NOT NULL AND qt_peso::text <> '')
				and	(qt_altura_cm IS NOT NULL AND qt_altura_cm::text <> '')
				and	(qt_imc IS NOT NULL AND qt_imc::text <> '')
				and	(qt_superf_corporia IS NOT NULL AND qt_superf_corporia::text <> ''));
exception
	when others then
	dt_sinal_vital_w	:= null;
end;

if (dt_sinal_vital_w IS NOT NULL AND dt_sinal_vital_w::text <> '') then
	ds_retorno_w	:= wheb_mensagem_pck.get_texto(309195,	'DT_SINAL_VITAL_W=' || to_char(dt_sinal_vital_w,'dd/mm/yyyy hh24:mi:ss') || ';' ||
															'QT_PESO_W=' || qt_peso_w || ';' ||
															'QT_ALTURA_CM_W=' || qt_altura_cm_w || ';' ||
															'QT_IMC_W=' || qt_imc_w || ';' ||
															'QT_SUPERF_CORPORIA_W=' || qt_superf_corporia_w);
					/*
						Última verificação em #@DT_SINAL_VITAL_W#@
						Peso    #@QT_PESO_W#@ Kg
						Altura  #@QT_ALTURA_CM_W#@ cm
						IMC     #@QT_IMC_W#@ Kg/m²
						SC      #@QT_SUPERF_CORPORIA_W#@ m²

					*/
end if;


begin
select	qt_peso,
	qt_altura_cm,
	qt_imc,
	qt_superf_corporia,
	dt_sinal_vital
into STRICT	qt_peso_w,
	qt_altura_cm_w,
	qt_imc_w,
	qt_superf_corporia_w,
	dt_sinal_vital_w
from	atendimento_sinal_vital
where	nr_atendimento	= nr_atendimento_p
and	dt_sinal_vital	= (	SELECT	min(b.dt_sinal_vital)
				from	atendimento_sinal_vital b
				where	b.nr_atendimento	= nr_atendimento_p
				and	(qt_peso IS NOT NULL AND qt_peso::text <> '')
				and	(qt_altura_cm IS NOT NULL AND qt_altura_cm::text <> '')
				and	(qt_imc IS NOT NULL AND qt_imc::text <> '')
				and	(qt_superf_corporia IS NOT NULL AND qt_superf_corporia::text <> ''));
exception
	when others then
	dt_sinal_vital_w	:= null;
end;

if (dt_sinal_vital_w IS NOT NULL AND dt_sinal_vital_w::text <> '') then
	ds_retorno_w	:= wheb_mensagem_pck.get_texto(309199,	'DT_SINAL_VITAL_W=' || to_char(dt_sinal_vital_w,'dd/mm/yyyy hh24:mi:ss') || ';' ||
															'QT_PESO_W=' || qt_peso_w || ';' ||
															'QT_ALTURA_CM_W=' || qt_altura_cm_w || ';' ||
															'QT_IMC_W=' || qt_imc_w || ';' ||
															'QT_SUPERF_CORPORIA_W=' || qt_superf_corporia_w);
					/*
						Última verificação em #@DT_SINAL_VITAL_W#@
						Peso    #@QT_PESO_W#@ Kg
						Altura  #@QT_ALTURA_CM_W#@ cm
						IMC     #@QT_IMC_W#@ Kg/m²
						SC      #@QT_SUPERF_CORPORIA_W#@ m²

					*/
end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_hist_saude_dados_biomet (nr_atendimento_p bigint) FROM PUBLIC;

