-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION ehr_obter_regra_templ_elem ( nr_seq_temp_conteudo_p bigint, cd_estabelecimento_p bigint, cd_perfil_p bigint, cd_pessoa_fisica_p text) RETURNS varchar AS $body$
DECLARE


nr_seq_regra_w		bigint;
ie_tipo_regra_w		varchar(15);
ds_retorno_w		varchar(10000);
ie_vazio_w		varchar(1);
ie_edicao_w		varchar(1);
cd_dominio_w		integer;

C01 CURSOR FOR
	SELECT	a.nr_seq_regra,
		b.ie_tipo_regra,
		b.ie_vazio,
		b.ie_edicao,
		b.cd_dominio
	from	ehr_regra_template b,
		ehr_template_elem_regra a
	where	a.nr_seq_temp_conteudo	= nr_seq_temp_conteudo_p
	and	a.nr_seq_regra		= b.nr_sequencia
	and	coalesce(a.cd_perfil,coalesce(cd_perfil_p,0))			= coalesce(cd_perfil_p,0)
	and	coalesce(a.cd_estabelecimento,coalesce(cd_estabelecimento_p,0))	= coalesce(cd_estabelecimento_p,0)
	and	coalesce(a.cd_pessoa_fisica,coalesce(cd_pessoa_fisica_p,0))	= coalesce(cd_pessoa_fisica_p,0)
	order by coalesce(a.cd_estabelecimento,0),
		coalesce(a.cd_pessoa_fisica,0),
		coalesce(a.cd_perfil,0);


BEGIN

open C01;
loop
fetch C01 into
	nr_seq_regra_w,
	ie_tipo_regra_w,
	ie_vazio_w,
	ie_edicao_w,
	cd_dominio_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin
	ds_retorno_w	:= ds_retorno_w ||	'Seq='	|| to_char(nr_seq_regra_w)	|| ';'	||
						'Reg='	|| ie_tipo_regra_w 		|| ';'	||
				 		'V=' 	|| ie_vazio_w			|| ';'	||
						'E='	|| ie_edicao_w			|| ';'	||
						'Dom='	|| cd_dominio_w			|| ';'	|| '#@#@';
	end;
end loop;
close C01;

return substr(ds_retorno_w,1,2000);

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION ehr_obter_regra_templ_elem ( nr_seq_temp_conteudo_p bigint, cd_estabelecimento_p bigint, cd_perfil_p bigint, cd_pessoa_fisica_p text) FROM PUBLIC;

