-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_exibe_kit_proced ( nr_atendimento_p bigint, nr_seq_proc_interno_p bigint, cd_setor_atendimento_p bigint, cd_estabelecimento_p bigint, cd_medico_p text, cd_convenio_p bigint, cd_procedimento_p bigint, ie_origem_proced_p bigint) RETURNS varchar AS $body$
DECLARE

						 
ie_retorno_w		varchar(1);
count_w				bigint;

BEGIN
select	count(*) 
into STRICT		count_w 
from (	SELECT	cd_kit_material 
			from		proc_interno_kit 
			where	nr_seq_proc_interno	= nr_seq_proc_interno_p 
			and		coalesce(cd_setor_atendimento,coalesce(cd_setor_atendimento_p,0))	= coalesce(cd_setor_atendimento_p,0) 
			and		cd_estabelecimento	= cd_estabelecimento_p 
			and		coalesce(cd_medico,coalesce(cd_medico_p,0))	= coalesce(cd_medico_p,0)	 
			and (select	max(obter_idade(b.dt_nascimento,coalesce(b.dt_obito,clock_timestamp()),'DIA')) 
					 from	atendimento_paciente a, 
							pessoa_fisica b 
					 where	a.cd_pessoa_fisica = b.cd_pessoa_fisica 
					 and	a.nr_atendimento = nr_atendimento_p) between obter_idade_kit_proced(nr_sequencia,'MIN') and obter_idade_kit_proced(nr_sequencia,'MAX') 
			and	coalesce(cd_convenio, coalesce(cd_convenio_p,0))	= cd_convenio_p 
			
union
 
			SELECT	cd_kit_material 
			from		proc_interno 
			where	nr_sequencia	= nr_seq_proc_interno_p 
			
union
 
			select	cd_kit_material 
			from 	procedimento 
			where	cd_procedimento		= cd_procedimento_p 
			and		ie_origem_proced	= ie_origem_proced_p) alias16 
where	(cd_kit_material IS NOT NULL AND cd_kit_material::text <> '');
 
if (count_w > 0) then 
	ie_retorno_w := 'S';
else 
	ie_retorno_w := 'N';
end if;
	 
return	ie_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_exibe_kit_proced ( nr_atendimento_p bigint, nr_seq_proc_interno_p bigint, cd_setor_atendimento_p bigint, cd_estabelecimento_p bigint, cd_medico_p text, cd_convenio_p bigint, cd_procedimento_p bigint, ie_origem_proced_p bigint) FROM PUBLIC;

