-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION sac_obter_se_existe_bo_pend ( cd_level_arvore_p bigint, nr_seq_level_0_p bigint, nr_seq_level_1_p bigint, nr_seq_level_2_p bigint, nr_seq_level_3_p bigint, nm_usuario_p text) RETURNS varchar AS $body$
DECLARE


ie_retorno_w		varchar(1) := 'S';
ie_arvore_grupo_resp_w	varchar(255);
ds_lista_status_desc_w	varchar(255);
nr_seq_level_0_w		bigint := nr_seq_level_0_p;
nr_seq_level_1_w		bigint := nr_seq_level_1_p;


BEGIN
select	coalesce(obter_valor_param_usuario(2000,161,obter_perfil_ativo,nm_usuario_p,wheb_usuario_pck.get_cd_estabelecimento),'N'),
	obter_valor_param_usuario(2000,104,obter_perfil_ativo,nm_usuario_p,wheb_usuario_pck.get_cd_estabelecimento)
into STRICT	ie_arvore_grupo_resp_w,
	ds_lista_status_desc_w
;

if (ie_arvore_grupo_resp_w = 'N') then
	begin
	if (cd_level_arvore_p = 0) then
		begin
		select	CASE WHEN nr_seq_level_0_p=-1 THEN null  ELSE nr_seq_level_0_p END
		into STRICT	nr_seq_level_0_w
		;

		begin
		select	'S'
		into STRICT	ie_retorno_w
		from	sac_resp_bol_ocor a
		where	a.nr_seq_responsavel = coalesce(nr_seq_level_0_w,a.nr_seq_responsavel)
		and	obter_se_contido_char(a.ie_status,ds_lista_status_desc_w) = 'N'
		and	obter_dados_sac_resp(a.nr_seq_responsavel,nm_usuario_p,'R') = 'S'  LIMIT 1;
		exception
		when others then
			ie_retorno_w := 'N';
		end;
		end;
	elsif (cd_level_arvore_p = 1) then
		begin
		select	'S'
		into STRICT	ie_retorno_w
		from	sac_resp_bol_ocor a
		where	a.nr_seq_responsavel = nr_seq_level_0_w
		and	a.nr_seq_classif = nr_seq_level_1_w
		and	obter_se_contido_char(a.ie_status,ds_lista_status_desc_w) = 'N'  LIMIT 1;
		exception
		when others then
			ie_retorno_w := 'N';
		end;
	elsif (cd_level_arvore_p = 2) then
		begin
		select	'S'
		into STRICT	ie_retorno_w
		from	sac_resp_bol_ocor a
		where	a.nr_seq_responsavel = nr_seq_level_0_w
		and	a.nr_seq_classif = nr_seq_level_1_w
		and	a.nr_seq_gravidade = nr_seq_level_2_p
		and	obter_se_contido_char(a.ie_status,ds_lista_status_desc_w) = 'N'  LIMIT 1;
		exception
		when others then
			ie_retorno_w := 'N';
		end;
	end if;
	end;
elsif (ie_arvore_grupo_resp_w = 'S') then
	begin
	if (cd_level_arvore_p = 0) then
		begin
		select	CASE WHEN nr_seq_level_0_p=-1 THEN null  ELSE nr_seq_level_0_p END
		into STRICT	nr_seq_level_0_w
		;

		begin
		select	'S'
		into STRICT	ie_retorno_w
		from	sac_grupo_responsavel c,
			sac_responsavel b,
			sac_resp_bol_ocor a
		where	b.nr_sequencia = a.nr_seq_responsavel
		and	c.nr_sequencia = b.nr_seq_grupo
		and	coalesce(b.ie_situacao,'A') = 'A'
		and	c.nr_sequencia = coalesce(nr_seq_level_0_w,c.nr_sequencia)
		and	obter_se_contido_char(a.ie_status,ds_lista_status_desc_w) = 'N'
		and	obter_dados_sac_resp(b.nr_sequencia,nm_usuario_p,'R') = 'S'  LIMIT 1;
		exception
		when others then
			ie_retorno_w := 'N';
		end;
		end;
	elsif (cd_level_arvore_p = 1) then
		begin
		select	CASE WHEN nr_seq_level_1_p=-1 THEN null  ELSE nr_seq_level_1_p END
		into STRICT	nr_seq_level_1_w
		;

		begin
		select	'S'
		into STRICT	ie_retorno_w
		from	sac_responsavel b,
			sac_resp_bol_ocor a
		where	b.nr_sequencia = a.nr_seq_responsavel
		and	b.nr_seq_grupo = nr_seq_level_0_w
		and	b.nr_sequencia = coalesce(nr_seq_level_1_w,b.nr_sequencia)
		and	obter_se_contido_char(a.ie_status,ds_lista_status_desc_w) = 'N'
		and	obter_dados_sac_resp(b.nr_sequencia,nm_usuario_p,'R') = 'S'  LIMIT 1;
		exception
		when others then
			ie_retorno_w := 'N';
		end;
		end;
	elsif (cd_level_arvore_p = 2) then
		begin
		select	'S'
		into STRICT	ie_retorno_w
		from	sac_resp_bol_ocor a
		where	a.nr_seq_responsavel = nr_seq_level_1_w
		and	a.nr_seq_classif = nr_seq_level_2_p
		and	obter_se_contido_char(a.ie_status,ds_lista_status_desc_w) = 'N'  LIMIT 1;
		exception
		when others then
			ie_retorno_w := 'N';
		end;
	elsif (cd_level_arvore_p = 3) then
		begin
		select	'S'
		into STRICT	ie_retorno_w
		from	sac_resp_bol_ocor a
		where	a.nr_seq_responsavel = nr_seq_level_1_w
		and	a.nr_seq_classif = nr_seq_level_2_p
		and	a.nr_seq_gravidade = nr_seq_level_3_p
		and	obter_se_contido_char(a.ie_status,ds_lista_status_desc_w) = 'N'  LIMIT 1;
		exception
		when others then
			ie_retorno_w := 'N';
		end;
	end if;
	end;
end if;

return	ie_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION sac_obter_se_existe_bo_pend ( cd_level_arvore_p bigint, nr_seq_level_0_p bigint, nr_seq_level_1_p bigint, nr_seq_level_2_p bigint, nr_seq_level_3_p bigint, nm_usuario_p text) FROM PUBLIC;

