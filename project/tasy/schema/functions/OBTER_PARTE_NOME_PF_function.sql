-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_parte_nome_pf (nm_inteiro_p text, ds_parte_p text) RETURNS varchar AS $body$
DECLARE


ds_retorno_w			varchar(100);
nm_pessoa_w				varchar(100);

qt_pos_fim_nome_w 		bigint;
qt_pos_ini_sobrenome_w 	bigint;

ds_nome_w				varchar(100);
ds_sobre_w				varchar(100);
ds_resto_w				varchar(100);

BEGIN

nm_pessoa_w	:= nm_inteiro_p;

if (nm_pessoa_w IS NOT NULL AND nm_pessoa_w::text <> '') then
    	
    for i in 1..length(nm_pessoa_w) loop
    	begin
    	if (substr(nm_pessoa_w,i,1) = ' ') then
    		if (coalesce(qt_pos_fim_nome_w::text, '') = '' ) then
    			qt_pos_fim_nome_w := i;
    			if (i < length(nm_pessoa_w)) then
    				qt_pos_ini_sobrenome_w := i;
    			end if;
    		else
    			qt_pos_ini_sobrenome_w := i;
    		end if;
    		
    	end if;
    	end;
    end loop;

    ds_nome_w 		:= substr(nm_pessoa_w,1,qt_pos_fim_nome_w);
    qt_pos_ini_sobrenome_w 	:= qt_pos_ini_sobrenome_w + 1;
    ds_sobre_w 		:= substr(nm_pessoa_w,qt_pos_ini_sobrenome_w,length(nm_pessoa_w));
    ds_resto_w		:= substr(nm_pessoa_w,qt_pos_fim_nome_w+1,length(nm_pessoa_w)-length(ds_sobre_w) - length(ds_nome_w));

    if (lower(ds_parte_p) = 'nome') then
    	ds_retorno_w := ds_nome_w;
    elsif (lower(ds_parte_p) = lower(obter_desc_expressao(325926))/*'sobrenome'*/
) or (lower(ds_parte_p) = 'sobrenome') then
    	ds_retorno_w := ds_sobre_w;
    elsif (lower(ds_parte_p) = 'restonome')then
    	ds_retorno_w := ds_resto_w;
    end	if;

end if;

return	substr(ds_retorno_w,1,100);

end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_parte_nome_pf (nm_inteiro_p text, ds_parte_p text) FROM PUBLIC;

