-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION ageint_obter_se_apres_aval (nr_seq_tipo_aval_p bigint, nr_seq_ageint_p bigint, nr_seq_proc_interno_p bigint) RETURNS varchar AS $body$
DECLARE

			 
ie_retorno_w		varchar(1);
ie_exige_aval_w		varchar(1);
cd_procedimento_w 	bigint;
ie_origem_proced_w	bigint;
cd_convenio_w		integer;	
cd_categoria_w		varchar(10);
cd_estabelecimento_w	smallint;
cd_plano_w		varchar(10);


BEGIN 
 
select	cd_estabelecimento, 
	cd_convenio, 
	cd_categoria, 
	cd_plano 
into STRICT	cd_estabelecimento_w, 
	cd_convenio_w, 
	cd_categoria_w, 
	cd_plano_w 
from	agenda_integrada 
where	nr_sequencia = nr_seq_ageint_p;
 
SELECT * FROM obter_proc_tab_interno_conv( 
				nr_seq_proc_interno_p, cd_estabelecimento_w, cd_convenio_w, cd_categoria_w, cd_plano_w, null, cd_procedimento_w, ie_origem_proced_w, null, clock_timestamp(), null, null, null, null, null, null, null, null) INTO STRICT cd_procedimento_w, ie_origem_proced_w;
				 
				 
select	CASE WHEN count(*)='0' THEN 'N'  ELSE 'S' END  
into STRICT	ie_retorno_w 
from	med_tipo_aval_proc 
where	nr_seq_tipo_aval = nr_seq_tipo_aval_p 
and	ie_obrigatorio = 'S' 
and	ie_origem_proced = ie_origem_proced_w and (cd_procedimento = cd_procedimento_w) or (nr_seq_proc_interno = nr_seq_proc_interno_p) or (cd_area_procedimento = obter_area_procedimento(cd_procedimento_w, ie_origem_proced_w)) or (cd_especialidade = obter_especialidade_proced(cd_procedimento_w, ie_origem_proced_w)) or (cd_grupo_proc = obter_grupo_procedimento(cd_procedimento_w, ie_origem_proced_w,'C'));
	 
return	ie_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION ageint_obter_se_apres_aval (nr_seq_tipo_aval_p bigint, nr_seq_ageint_p bigint, nr_seq_proc_interno_p bigint) FROM PUBLIC;

