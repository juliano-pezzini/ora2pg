-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION man_obter_desc_equip_os_par ( nr_seq_equipamento_p bigint, ie_desc_adic_equip_p text) RETURNS varchar AS $body$
DECLARE


cd_estabelecimento_w		estabelecimento.cd_estabelecimento%type		:= wheb_usuario_pck.get_cd_estabelecimento;
cd_perfil_w			perfil.cd_perfil%type				:= obter_perfil_ativo;
nm_usuario_w			usuario.nm_usuario%type				:= wheb_usuario_pck.get_nm_usuario;
ie_desc_adic_equip_w		varchar(255);
ds_retorno_w			varchar(2000);
ds_equipamento_w		man_equipamento.ds_equipamento%type;
ds_modelo_w			varchar(255);
ds_marca_w			varchar(255);
ds_fabricante_w			varchar(255);
ds_grupo_trabalho_w		varchar(255);
ds_tipo_equip_w			varchar(255);
qt_reg_w			bigint;
nr_seq_modelo_w			man_equipamento.nr_seq_modelo%type;
nr_seq_marca_w			man_equipamento.nr_seq_marca%type;
nr_seq_fabricante_w		man_equipamento.nr_seq_fabricante%type;
nr_seq_trab_w			man_equipamento.nr_seq_trab%type;
nr_seq_tipo_equip_w		man_equipamento.nr_seq_tipo_equip%type;


BEGIN

select	count(1)
into STRICT	qt_reg_w
from	man_equipamento
where	nr_sequencia	= nr_seq_equipamento_p  LIMIT 1;

if (qt_reg_w > 0) then
	begin
	ie_desc_adic_equip_w := ie_desc_adic_equip_p;

	select	ds_equipamento,
		substr(ds_modelo,1,255),
		substr(ds_marca,1,255),
		nr_seq_modelo,
		nr_seq_marca,
		nr_seq_fabricante,
		nr_seq_trab,
		nr_seq_tipo_equip
	into STRICT	ds_equipamento_w,
		ds_modelo_w,
		ds_marca_w,
		nr_seq_modelo_w,
		nr_seq_marca_w,
		nr_seq_fabricante_w,
		nr_seq_trab_w,
		nr_seq_tipo_equip_w
	from	man_equipamento
	where	nr_sequencia = nr_seq_equipamento_p;

	ds_retorno_w	:= substr(ds_equipamento_w,1,2000);

	if (ie_desc_adic_equip_w = 'S') then
		begin
		if (coalesce(ds_modelo_w::text, '') = '') and (nr_seq_modelo_w IS NOT NULL AND nr_seq_modelo_w::text <> '') then
			ds_modelo_w	:= substr(obter_desc_man_modelo(nr_seq_modelo_w),1,255);
		end if;

		if (coalesce(ds_marca_w::text, '') = '') and (nr_seq_marca_w IS NOT NULL AND nr_seq_marca_w::text <> '') then
			ds_marca_w	:= substr(obter_desc_man_marca(nr_seq_marca_w),1,255);
		end if;

		if (nr_seq_fabricante_w IS NOT NULL AND nr_seq_fabricante_w::text <> '') then
			ds_fabricante_w	:= substr(man_obter_desc_fabricante(nr_seq_fabricante_w),1,255);
		end if;

		if (coalesce(ds_fabricante_w,'0') <> '0') then
			ds_retorno_w	:= substr(ds_retorno_w || '/' || ds_fabricante_w,1,2000);
		end if;

		if (coalesce(ds_marca_w,'0') <> '0') then
			ds_retorno_w	:= substr(ds_retorno_w || '/' || ds_marca_w,1,2000);
		end if;

		if (coalesce(ds_modelo_w,'0') <> '0') then
			ds_retorno_w	:= substr(ds_retorno_w || '/' || ds_modelo_w,1,2000);
		end if;
		end;
	elsif (ie_desc_adic_equip_w = 'G') then
		begin
		if (nr_seq_trab_w IS NOT NULL AND nr_seq_trab_w::text <> '') then
			ds_grupo_trabalho_w	:= substr(obter_desc_grupo_trab(nr_seq_trab_w),1,255);
		end if;

		if (nr_seq_tipo_equip_w IS NOT NULL AND nr_seq_tipo_equip_w::text <> '') then
			ds_tipo_equip_w	:= substr(man_obter_desc_tipo_equip(nr_seq_tipo_equip_w),1,255);
		end if;

		if (coalesce(ds_grupo_trabalho_w,'0') <> '0') then
			ds_retorno_w	:= substr(ds_retorno_w || '/' || ds_grupo_trabalho_w,1,2000);
		end if;

		if (coalesce(ds_tipo_equip_w,'0') <> '0') then
			ds_retorno_w	:= substr(ds_retorno_w || '/' || ds_tipo_equip_w,1,2000);
		end if;
		end;
	end if;
	end;
end if;

return ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION man_obter_desc_equip_os_par ( nr_seq_equipamento_p bigint, ie_desc_adic_equip_p text) FROM PUBLIC;

