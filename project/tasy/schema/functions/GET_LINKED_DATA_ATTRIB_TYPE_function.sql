-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_linked_data_attrib_type ( nr_seq_linked_data_p linked_data.nr_sequencia%type, nm_atributo_linked_p linked_data_atributo.nm_atributo_linked%type default null) RETURNS varchar AS $body$
DECLARE

attribute_type_w    tabela_atributo.ie_tipo_atributo%type;
table_name_w        linked_data_atributo.nm_tabela%type;
is_compound_w       varchar(1) := 'N';


BEGIN
    select CASE WHEN count(1)=0 THEN  'N'  ELSE 'S' END 
    into STRICT is_compound_w
    from linked_data_atributo a, linked_data_atrib_comp b
    where a.nr_seq_linked_data = nr_seq_linked_data_p
    and a.nm_atributo_linked = nm_atributo_linked_p
    and b.nr_seq_atrib = a.nr_sequencia;

    if (is_compound_w = 'N') then
        select b.ie_tipo_atributo
        into STRICT attribute_type_w
        from linked_data_atributo a, tabela_atributo b
        where a.nr_seq_linked_data = nr_seq_linked_data_p
        and a.nm_atributo_linked = nm_atributo_linked_p
        and b.nm_tabela = a.nm_tabela
        and b.nm_atributo = a.nm_atributo;
    else
        select a.nm_tabela
        into STRICT table_name_w
        from linked_data_atributo a
        where a.nr_seq_linked_data = nr_seq_linked_data_p
        and a.nm_atributo_linked = nm_atributo_linked_p;

        if (table_name_w IS NOT NULL AND table_name_w::text <> '') then
            select b.ie_tipo_atributo
            into STRICT attribute_type_w
            from linked_data_atributo a, tabela_atributo b
            where a.nr_seq_linked_data = nr_seq_linked_data_p
            and a.nm_atributo_linked = nm_atributo_linked_p
            and b.nm_tabela = a.nm_tabela
            and b.nm_atributo = a.nm_atrib_vl_graf;
        else
            select c.ie_tipo_atributo
            into STRICT attribute_type_w
            from linked_data a, linked_data_atributo b, tabela_atributo c
            where a.nr_sequencia = nr_seq_linked_data_p
            and b.nr_seq_linked_data = a.nr_sequencia
            and b.nm_atributo_linked = nm_atributo_linked_p
            and c.nm_tabela = a.nm_table
            and c.nm_atributo = b.nm_atrib_vl_graf;
        end if;
    end if;

    return attribute_type_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_linked_data_attrib_type ( nr_seq_linked_data_p linked_data.nr_sequencia%type, nm_atributo_linked_p linked_data_atributo.nm_atributo_linked%type default null) FROM PUBLIC;

