-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_baixa_conta_financ ( nr_titulo_p bigint, nr_seq_conta_financ_p bigint, nr_seq_classif_p bigint, ie_opcao_p text) RETURNS bigint AS $body$
DECLARE

 
/* retorna o valor de baixa do título proporcional à classificação 
 
ie_opcao_p 
 
	'TP'	Título a Pagar 
	'TR'	Título a Receber 
 
*/
 
 
vl_baixa_w		double precision;
vl_classif_w		double precision;
vl_baixa_classif_w	double precision;


BEGIN 
 
if (ie_opcao_p	= 'TP') then 
 
	select	coalesce(sum(a.vl_pago),0) 
	into STRICT	vl_baixa_w 
	from	titulo_pagar_baixa a 
	where	a.nr_titulo	= nr_titulo_p;
 
	select	coalesce(sum(a.vl_titulo),0) 
	into STRICT	vl_classif_w 
	from	titulo_pagar_classif a 
	where	a.nr_titulo	= nr_titulo_p 
	and	coalesce(a.nr_seq_conta_financ,0)	= coalesce(coalesce(nr_seq_conta_financ_p,a.nr_seq_conta_financ),0) 
	and	a.nr_sequencia	= coalesce(nr_seq_classif_p,a.nr_sequencia);
 
	vl_baixa_classif_w	:= dividir_sem_round((coalesce(vl_classif_w,0) * coalesce(vl_baixa_w,0)),coalesce((obter_dados_tit_pagar(nr_titulo_p,'V'))::numeric ,0));
 
end if;
 
RETURN vl_baixa_classif_w;
 
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_baixa_conta_financ ( nr_titulo_p bigint, nr_seq_conta_financ_p bigint, nr_seq_classif_p bigint, ie_opcao_p text) FROM PUBLIC;

