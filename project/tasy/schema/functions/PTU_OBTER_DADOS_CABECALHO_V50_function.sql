-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION ptu_obter_dados_cabecalho_v50 ( nr_seq_transacao_p bigint, ie_tipo_transacao_p bigint, ie_campo_p text) RETURNS varchar AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [ ] Tasy (Delphi/Java) [  x ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
Código dos pedidos para saber como montar o cabeçalho

1 - Pedido autorização
2 - Resposta pedido autorização
3 - Pedido de complemento de autorização
4 - Resposta pedido complemento autorização
5 - Pedido de insistência
6 - Confirmação insistência
7 -  Respota auditoria
8 - Confirmação resposta auditoria
9 - Cancelamento
10 - Confirmação cancelamento
11 - Status da Transação
12 - Resposta de Status da Transação
13 - Comunicação de Decurso de Prazo
14 - Confirmação decurso prazo
15 - Ordem de Serviço
16 - Resposta de Ordem de Serviço
17 - Autorização de Ordem de Serviço
18 - Confirmação  autorização Ordem de Serviço
30 - Consulta dados beneficiário
31- Resposta consulta dados beneficiário
32 - Consutla dados prestador
33 - Resposta consulta dados prestador
34 - Requisição Contagem Benef.
35 - Resposta Contagem Benef.


Transações
<!-- 00600 - Pedido de Autorização -->
<!-- 00605 - Pedido de Complemento de Autorização -->
<!-- 00501 - Resposta de Pedido de Autorização -->
<!-- 00302 - Pedido de Insistência -->
<!-- 00309 - Confirmação -->
<!-- 00404 - Resposta de Auditoria -->
<!-- 00311 - Cancelamento -->
<!-- 00360 - Status da Transação -->
<!-- 00361 - Resposta do Status da Transação -->
<!-- 00700 - Comunicação de Decurso de Prazo -->
<!-- 00806 - Ordem de Serviço -->
<!-- 00807 - Resposta de Ordem de Serviço -->
<!-- 00804 - Autorização de Ordem de Serviço -->



<!-- 00412 - Consulta de Dados do Beneficiário -->
<!-- 00413 - Resposta de Consulta de Dados do Beneficiário -->
<!-- 00418 - Consulta Dados do Prestador-->
<!-- 00419 - Resposta de Consulta de Dados do Prestador-->
<!-- 00310 - Erro Inesperado -->
<!-- 00430 - Requisição de Contagem de Beneficiários -->
<!-- 00431 - Resposta de Requisição de Contagem de Beneficiários -->

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
ds_retorno_w			varchar(255);
cd_transacao_w			varchar(10);
cd_unimed_executora_w		varchar(30);
cd_unimed_beneficiario_w	varchar(30);
ie_tipo_cliente_w		varchar(10);



BEGIN

-- 1 - Pedido autorização
if ( ie_tipo_transacao_p = 1  ) then
	select	'00600',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_pedido_autorizacao
	where	nr_sequencia = nr_seq_transacao_p;


--2 - Resposta pedido autorização ou  4 - Resposta pedido complemento autorização
elsif ( ie_tipo_transacao_p = 2 or ie_tipo_transacao_p = 4  ) then
	select	'00501',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_resposta_autorizacao
	where	nr_sequencia = nr_seq_transacao_p;

--3 - Pedido de complemento de autorização
elsif ( ie_tipo_transacao_p = 3  ) then
	select	'00605',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_pedido_compl_aut
	where	nr_sequencia = nr_seq_transacao_p;

--5 - Pedido de insistência
elsif ( ie_tipo_transacao_p = 5  ) then
	select	'00302',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_pedido_insistencia
	where	nr_sequencia = nr_seq_transacao_p;

--6 - Confirmação insistência  	8 - Confirmação resposta auditoria   10 - Confirmação cancelamento
--14 - Confirmação decurso prazo  	18 - Confirmação  autorização Ordem de Serviço
elsif ( ie_tipo_transacao_p = 6  ) then
	select	'00309',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_confirmacao
	where	nr_sequencia = nr_seq_transacao_p;

--7 -  Respota auditoria
elsif ( ie_tipo_transacao_p = 7  ) then
	select	'00404',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_resposta_autorizacao
	where	nr_sequencia = nr_seq_transacao_p;

--9 - Cancelamento
elsif ( ie_tipo_transacao_p = 9  ) then
	select	'00311',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_cancelamento
	where	nr_sequencia = nr_seq_transacao_p;

--11 - Status da Transação
elsif ( ie_tipo_transacao_p = 11  ) then
	select	'00360',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_pedido_status
	where	nr_sequencia = nr_seq_transacao_p;

--12 - Resposta de Status da Transação
elsif ( ie_tipo_transacao_p = 12 ) then
	select	'00361',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_resp_pedido_status
	where	nr_sequencia = nr_seq_transacao_p;

--13 - Comunicação de Decurso de Prazo
elsif ( ie_tipo_transacao_p = 13 ) then
	select	'00700',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_decurso_prazo
	where	nr_sequencia = nr_seq_transacao_p;

--15 - Ordem de Serviço
elsif ( ie_tipo_transacao_p = 15 ) then
	select	'00806',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_requisicao_ordem_serv
	where	nr_sequencia = nr_seq_transacao_p;

--16 - Resposta de Ordem de Serviço
elsif ( ie_tipo_transacao_p = 16 ) then
	select	'00807',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_resposta_req_ord_serv
	where	nr_sequencia = nr_seq_transacao_p;

--17 - Autorização de Ordem de Serviço
elsif ( ie_tipo_transacao_p = 17 ) then
	select	'00804',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_autorizacao_ordem_serv
	where	nr_sequencia = nr_seq_transacao_p;

--30 - Consulta dados beneficiário
elsif ( ie_tipo_transacao_p = 30 ) then
	select	'00412',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_consulta_beneficiario
	where	nr_sequencia = nr_seq_transacao_p;

--31- Resposta consulta dados beneficiário
elsif ( ie_tipo_transacao_p = 31 ) then
	select	'00413',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_resp_consulta_benef
	where	nr_sequencia = nr_seq_transacao_p;

--32 - Consulta dados prestador
elsif ( ie_tipo_transacao_p = 32 ) then
	select	'00418',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_consulta_prestador
	where	nr_sequencia = nr_seq_transacao_p;

--33 - Resposta consulta dados prestador
elsif ( ie_tipo_transacao_p = 33 ) then
	select	'00419',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_resp_consulta_prest
	where	nr_sequencia = nr_seq_transacao_p;

--34 - Requisição Contagem Benef
elsif ( ie_tipo_transacao_p = 35 ) then
	select	'00431',
		cd_unimed_destino,
		cd_unimed_requisitante,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_resp_contagem_benef
	where	nr_sequencia = nr_seq_transacao_p;
end if;

--Tipo de transação que será gerada no XML
if ( ie_campo_p = 'TT' ) then
	ds_retorno_w := cd_transacao_w;
--Código unimed executora
elsif ( ie_campo_p = 'CDUE' 	 ) then
	ds_retorno_w := cd_unimed_executora_w;
--Código unimed do beneficiário
elsif ( ie_campo_p = 'CDUB' 	 ) then
	ds_retorno_w := cd_unimed_beneficiario_w;
--Código tipo cliente
elsif ( ie_campo_p = 'CTC' 	 ) then
	ds_retorno_w := ie_tipo_cliente_w;

end if;


return	ds_retorno_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION ptu_obter_dados_cabecalho_v50 ( nr_seq_transacao_p bigint, ie_tipo_transacao_p bigint, ie_campo_p text) FROM PUBLIC;

