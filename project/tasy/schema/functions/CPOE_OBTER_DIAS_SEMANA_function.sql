-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cpoe_obter_dias_semana (nr_seq_cpoe_p bigint, ie_tipo_item_p text ) RETURNS varchar AS $body$
DECLARE


ie_segunda_w   varchar(100);
ie_terca_w     varchar(100);
ie_quarta_w    varchar(100);
ie_quinta_w    varchar(100);
ie_sexta_w     varchar(100);
ie_sabado_w    varchar(100);
ie_domingo_w   varchar(100);

ds_dia_semana_w    varchar(2000);
ds_retorno_html_w  varchar(4000);


BEGIN

    if (ie_tipo_item_p in ('M', 'SOL')) then
        select CASE WHEN ie_segunda='S' THEN  obter_desc_expressao(298106) || '<br>'  ELSE '' END ,
               CASE WHEN ie_terca='S' THEN  obter_desc_expressao(299302) || '<br>'  ELSE '' END ,
               CASE WHEN ie_quarta='S' THEN  obter_desc_expressao(297139) || '<br>'  ELSE '' END ,
               CASE WHEN ie_quinta='S' THEN  obter_desc_expressao(297214) || '<br>'  ELSE '' END ,
               CASE WHEN ie_sexta='S' THEN  obter_desc_expressao(298488) || '<br>'  ELSE '' END ,
               CASE WHEN ie_sabado='S' THEN  obter_desc_expressao(297960) || '<br>'  ELSE '' END ,
               CASE WHEN ie_domingo='S' THEN  obter_desc_expressao(288200) || '<br>'  ELSE '' END 
          into STRICT ie_segunda_w,
               ie_terca_w,
               ie_quarta_w,
               ie_quinta_w,
               ie_sexta_w,
               ie_sabado_w,
               ie_domingo_w
          from cpoe_material
        where nr_sequencia = nr_seq_cpoe_p;
		
	elsif (ie_tipo_item_p in ('DI', 'DP')) then
		select CASE WHEN ie_segunda='S' THEN  obter_desc_expressao(298106) || '<br>'  ELSE '' END ,
			   CASE WHEN ie_terca='S' THEN  obter_desc_expressao(299302) || '<br>'  ELSE '' END ,
			   CASE WHEN ie_quarta='S' THEN  obter_desc_expressao(297139) || '<br>'  ELSE '' END ,
			   CASE WHEN ie_quinta='S' THEN  obter_desc_expressao(297214) || '<br>'  ELSE '' END ,
			   CASE WHEN ie_sexta='S' THEN  obter_desc_expressao(298488) || '<br>'  ELSE '' END ,
			   CASE WHEN ie_sabado='S' THEN  obter_desc_expressao(297960) || '<br>'  ELSE '' END ,
			   CASE WHEN ie_domingo='S' THEN  obter_desc_expressao(288200) || '<br>'  ELSE '' END
			into STRICT ie_segunda_w,
			   ie_terca_w,
			   ie_quarta_w,
			   ie_quinta_w,
			   ie_sexta_w,
			   ie_sabado_w,
			   ie_domingo_w
			from cpoe_dialise
			where nr_sequencia = nr_seq_cpoe_p;
	elsif (ie_tipo_item_p in ('P')) then
		select CASE WHEN ie_segunda='S' THEN  obter_desc_expressao(298106) || '<br>'  ELSE '' END ,
			   CASE WHEN ie_terca='S' THEN  obter_desc_expressao(299302) || '<br>'  ELSE '' END ,
			   CASE WHEN ie_quarta='S' THEN  obter_desc_expressao(297139) || '<br>'  ELSE '' END ,
			   CASE WHEN ie_quinta='S' THEN  obter_desc_expressao(297214) || '<br>'  ELSE '' END ,
			   CASE WHEN ie_sexta='S' THEN  obter_desc_expressao(298488) || '<br>'  ELSE '' END ,
			   CASE WHEN ie_sabado='S' THEN  obter_desc_expressao(297960) || '<br>'  ELSE '' END ,
			   CASE WHEN ie_domingo='S' THEN  obter_desc_expressao(288200) || '<br>'  ELSE '' END
			into STRICT ie_segunda_w,
			   ie_terca_w,
			   ie_quarta_w,
			   ie_quinta_w,
			   ie_sexta_w,
			   ie_sabado_w,
			   ie_domingo_w
			from cpoe_procedimento
			where nr_sequencia = nr_seq_cpoe_p;
    end if;

    ds_dia_semana_w := ie_segunda_w || ie_terca_w || ie_quarta_w || ie_quinta_w || ie_sexta_w || ie_sabado_w || ie_domingo_w;

    if (ds_dia_semana_w IS NOT NULL AND ds_dia_semana_w::text <> '') then
        ds_retorno_html_w := '<div>' || replace(obter_desc_expressao(1040439), '#@DIAS_SEMANA#@', '<br>' || ds_dia_semana_w) || '</div>';
    end if;

    return ds_retorno_html_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_obter_dias_semana (nr_seq_cpoe_p bigint, ie_tipo_item_p text ) FROM PUBLIC;

