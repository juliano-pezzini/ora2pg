-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_orient_ageint_concat ( nr_sequencia_p bigint, nm_usuario_p text, cd_estalecimento_p bigint) RETURNS varchar AS $body$
DECLARE

	
c01 CURSOR FOR
	SELECT 	SUBSTR(obter_orientacao_proc_agexame(a.cd_procedimento, a.ie_origem_proced, b.cd_convenio, a.nr_seq_proc_interno, NULL,
			b.nr_seq_tipo_classif_pac, a.nr_seq_agenda_exame),1,4000) ds_orientacao,
			SUBSTR(obter_exame_agenda(a.cd_procedimento, a.ie_origem_proced, a.nr_seq_proc_interno),1,240) ds_procedimento
	FROM 	agenda_integrada_item a,
			agenda_integrada b
	WHERE 	a.nr_seq_agenda_int = b.nr_sequencia
	AND 	b.nr_sequencia = nr_sequencia_p
	AND 	(Obter_Horario_item_Ageint(a.nr_seq_agenda_cons,a.nr_Seq_Agenda_exame,a.nr_sequencia) IS NOT NULL AND (Obter_Horario_item_Ageint(a.nr_seq_agenda_cons,a.nr_Seq_Agenda_exame,a.nr_sequencia))::text <> '')

union all

  SELECT 	SUBSTR(obter_orientacao_proc_agexame(c.cd_procedimento, c.ie_origem_proced, b.cd_convenio, c.nr_seq_proc_interno, NULL,
			b.nr_seq_tipo_classif_pac, a.nr_seq_agenda_exame),1,4000) ds_orientacao,
			SUBSTR(obter_exame_agenda(c.cd_procedimento, c.ie_origem_proced, c.nr_seq_proc_interno),1,240) ds_procedimento
	FROM 	agenda_integrada_item a,
			agenda_integrada b,
      ageint_exame_adic_item c
	WHERE 	a.nr_seq_agenda_int = b.nr_sequencia
  and c.nr_seq_item = a.nr_sequencia
  AND 	b.nr_sequencia = nr_sequencia_p
	AND 	(Obter_Horario_item_Ageint(a.nr_seq_agenda_cons,a.nr_Seq_Agenda_exame,a.nr_sequencia) IS NOT NULL AND (Obter_Horario_item_Ageint(a.nr_seq_agenda_cons,a.nr_Seq_Agenda_exame,a.nr_sequencia))::text <> '');
	
 ds_retorno_w varchar(4000);

BEGIN

	for orientacoes_exames in c01
	loop
		
		if (orientacoes_exames.ds_orientacao IS NOT NULL AND orientacoes_exames.ds_orientacao::text <> '') then
			ds_retorno_w := substr(ds_retorno_w || '<b>' || wheb_mensagem_pck.get_texto(1051514) || ' ' || orientacoes_exames.ds_procedimento || '</b>' || chr(13) || 
							wheb_mensagem_pck.get_texto(1051515) || chr(13) || orientacoes_exames.ds_orientacao || chr(13) || chr(13),1,4000);
			
		end if;
	end loop;

  return ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_orient_ageint_concat ( nr_sequencia_p bigint, nm_usuario_p text, cd_estalecimento_p bigint) FROM PUBLIC;

