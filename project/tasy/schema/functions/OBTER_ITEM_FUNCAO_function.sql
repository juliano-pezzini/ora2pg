-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_item_funcao (nr_seq_dic_obj_p bigint, cd_funcao_p bigint) RETURNS varchar AS $body$
DECLARE


nr_seq_pasta_w   bigint;
ds_resultado_w   varchar(4000) := '';
nm_componente_w  varchar(255);

C01 CURSOR FOR
	SELECT	substr(coalesce(DS_ITEM_INSTITUICAO,obter_desc_expressao(CD_EXP_DESC_ITEM,DS_ITEM)),1,255) ds
	from      prontuario_pasta a,
               PRONTUARIO_ITEM b,
               PRONTUARIO_ITEM_PASTA c
     where     nr_seq_dic_obj = nr_seq_dic_obj_p
     and       c.nr_seq_pasta = a.nr_sequencia
     and       c.nr_Seq_item = b.nr_sequencia
	order by ds;


BEGIN
     if (cd_funcao_p = 281) and (nr_seq_dic_obj_p IS NOT NULL AND nr_seq_dic_obj_p::text <> '') then

          open C01;
          loop
          fetch C01 into
          	nm_componente_w;
          EXIT WHEN NOT FOUND; /* apply on C01 */
          	begin

               if (nm_componente_w IS NOT NULL AND nm_componente_w::text <> '') then

                    if (coalesce(ds_resultado_w::text, '') = '') then

                         ds_resultado_w := nm_componente_w;

                    else
                         ds_resultado_w := substr(ds_resultado_w ||' / '|| nm_componente_w,1,255);

                    end if;

               end if;

          	end;
          end loop;
          close C01;

     end if;

return ds_resultado_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_item_funcao (nr_seq_dic_obj_p bigint, cd_funcao_p bigint) FROM PUBLIC;

