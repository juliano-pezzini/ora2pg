-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_qt_dias_uti_apach_md (qt_idade_p bigint, qt_pt_idade1_p bigint, qt_pt_idade2_p bigint, qt_pt_idade3_p bigint, qt_pt_idade4_p bigint, qt_pt_idade5_p bigint, qt_pontos_aps_p bigint, qt_pt_aps1_p bigint, qt_pt_aps2_p bigint, qt_pt_aps3_p bigint, qt_pt_aps4_p bigint, qt_pt_aps5_p bigint, ie_ventilacao_p text, qt_po2_p bigint, qt_fio2_p bigint, ie_origem_paciente_p bigint, ie_emergencia_p text, qt_dias_antes_uti_p bigint, ie_aids_p text, ie_hepatica_p text, ie_linfoma_p text, ie_cancer_metastatico_p text, ie_leuc_mileoma_mult_p text, ie_imunosupressao_p text, ie_cirrose_p text, ie_readmissao_p text, qt_pt_diag_p bigint, ie_terapia_trombo_p text, ie_glasgow_indis_p text, qt_escala_glasgow_p bigint ) RETURNS bigint AS $body$
DECLARE


   qt_logit_w	  bigint;
   qt_los_w	      bigint := 0;
   qt_los1_w	  bigint := 0;
   qt_los2_w	  bigint := 0;
   qt_los3_w	  bigint := 0;
   qt_los4_w	  bigint := 0;

   qt_dias_uti_w  real;

BEGIN
	--INICIO MD27
	qt_logit_w	:=	1.673887925;
	qt_logit_w	:=	qt_logit_w + (qt_idade_p		* ( 0.017603395));
	qt_logit_w	:=	qt_logit_w + (qt_pt_idade1_p	* (-7.68259E-06));
	qt_logit_w	:=	qt_logit_w + (qt_pt_idade2_p	* ( 3.95667E-05));
	qt_logit_w	:=	qt_logit_w + (qt_pt_idade3_p	* (-0.000166793));
	qt_logit_w	:=	qt_logit_w + (qt_pt_idade4_p	* ( 0.000228156));
	qt_logit_w	:=	qt_logit_w + (qt_pt_idade5_p	* (-9.32478E-05));

	qt_logit_w	:=	qt_logit_w + (qt_pontos_aps_p	*	( 0.04442699));
	qt_logit_w	:=	qt_logit_w + (qt_pt_aps1_p			*	(-5.83049E-05));
	qt_logit_w	:=	qt_logit_w + (qt_pt_aps2_p			*	( 0.000297008));
	qt_logit_w	:=	qt_logit_w + (qt_pt_aps3_p			*	(-0.000404434));
	qt_logit_w	:=	qt_logit_w + (qt_pt_aps4_p			*	( 0.000189251));
	qt_logit_w	:=	qt_logit_w + (qt_pt_aps5_p			*	(-2.35199E-05));

	if (ie_ventilacao_p	=	'S') then
		qt_logit_w	:=	qt_logit_w + 1.835309541;
	end if;

	qt_logit_w	:=	qt_logit_w + (dividir_md(qt_po2_p,dividir_md(qt_fio2_p,100))*(-0.004581842));

	if (ie_origem_paciente_p = 1) then
		qt_logit_w	:=	qt_logit_w + (-0.599591763);
	elsif (ie_origem_paciente_p = 2) then
		qt_logit_w	:=	qt_logit_w + 0.855505043;
	elsif (ie_origem_paciente_p = 3) then
		qt_logit_w	:=	qt_logit_w + 0.006529382;
	end if;

	if (ie_emergencia_p = 'S') then
		qt_logit_w	:=	qt_logit_w + 1.040690632;
	end if;

	qt_los_w	:=	sqrt(qt_dias_antes_uti_p);

	qt_los_w	:=	sqrt(qt_los_w);
	if	((qt_los_w - 0.121) > 0) then
		qt_los1_w	:=	power((qt_los_w - 0.121), 3);
	end if;
	if	((qt_los_w - 0.423) > 0) then
		qt_los2_w	:=	power((qt_los_w - 0.423), 3);
	end if;
	if	((qt_los_w - 0.794) > 0) then
		qt_los3_w	:=	power((qt_los_w - 0.794), 3);
	end if;
	if	((qt_los_w - 2.806) > 0) then
		qt_los4_w	:=	power((qt_los_w - 2.806), 3);
	end if;

	qt_logit_w	:=	qt_logit_w + (qt_los_w	*0.459823129);
	qt_logit_w	:=	qt_logit_w + (qt_los1_w	*0.397791937);
	qt_logit_w	:=	qt_logit_w + (qt_los2_w	*(-0.945210953));
	qt_logit_w	:=	qt_logit_w + (qt_los3_w	*0.588651266);
	qt_logit_w	:=	qt_logit_w + (qt_los4_w	*(-0.041232251));

	if (ie_aids_p = 'S') then
		qt_logit_w	:=	qt_logit_w + (-0.10285942);
	elsif (ie_hepatica_p = 'S') then
		qt_logit_w	:=	qt_logit_w + (-0.16012995);
	elsif (ie_linfoma_p = 'S') then
		qt_logit_w	:=	qt_logit_w + (-0.28079854);
	elsif (ie_cancer_metastatico_p = 'S') then
		qt_logit_w	:=	qt_logit_w + (-0.491932974);
	elsif (ie_leuc_mileoma_mult_p = 'S') then
		qt_logit_w	:=	qt_logit_w + (-0.803754341);
	elsif (ie_imunosupressao_p = 'S') then
		qt_logit_w	:=	qt_logit_w + (-0.07438064);
	elsif (ie_cirrose_p = 'S') then
		qt_logit_w	:=	qt_logit_w + 0.362658613;
	end if;
		
	if (ie_readmissao_p = 'S') then
		qt_logit_w	:=	qt_logit_w + 0.540368459;
	end if;

	if (qt_pt_diag_p IS NOT NULL AND qt_pt_diag_p::text <> '') then
		qt_logit_w := qt_logit_w + qt_pt_diag_p;
	end if;

	if (ie_terapia_trombo_p = 'S') then
		qt_logit_w	:=	qt_logit_w	+	(0.062385214);
	end if;

	if (ie_glasgow_indis_p = 'S') then
		qt_logit_w	:=	qt_logit_w + 1.789326613;
	else
		qt_logit_w	:=	qt_logit_w + ((15-qt_escala_glasgow_p) * (-0.015182904));
	end if;

	qt_dias_uti_w	:=	round((qt_logit_w)::numeric,2);
	--- Fim MD27
    RETURN qt_dias_uti_w;
   
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_qt_dias_uti_apach_md (qt_idade_p bigint, qt_pt_idade1_p bigint, qt_pt_idade2_p bigint, qt_pt_idade3_p bigint, qt_pt_idade4_p bigint, qt_pt_idade5_p bigint, qt_pontos_aps_p bigint, qt_pt_aps1_p bigint, qt_pt_aps2_p bigint, qt_pt_aps3_p bigint, qt_pt_aps4_p bigint, qt_pt_aps5_p bigint, ie_ventilacao_p text, qt_po2_p bigint, qt_fio2_p bigint, ie_origem_paciente_p bigint, ie_emergencia_p text, qt_dias_antes_uti_p bigint, ie_aids_p text, ie_hepatica_p text, ie_linfoma_p text, ie_cancer_metastatico_p text, ie_leuc_mileoma_mult_p text, ie_imunosupressao_p text, ie_cirrose_p text, ie_readmissao_p text, qt_pt_diag_p bigint, ie_terapia_trombo_p text, ie_glasgow_indis_p text, qt_escala_glasgow_p bigint ) FROM PUBLIC;

