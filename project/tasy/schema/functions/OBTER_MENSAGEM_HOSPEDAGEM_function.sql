-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_mensagem_hospedagem (nr_sequencia_p bigint) RETURNS varchar AS $body$
DECLARE

 
/* MACROS 
Hotel 
Observação 
Entrada_hotel 
Saida_hotel 
Endereco_hotel 
Bairro_hotel 
Cidade_hotel 
*/
 
 
nm_hotel_w		varchar(255);
dt_entrada_hotel_w		timestamp;
dt_saida_hotel_w		timestamp;
ds_mensagem_w		varchar(2000);
ds_endereco_w		varchar(265);
ds_bairro_w		varchar(255);
ds_cidade_w		varchar(255);
ds_observacao_w		varchar(255);


BEGIN 
select	substr(obter_nome_hotel(max(c.nr_seq_hotel)),1,255), 
	max(c.dt_entrada_hotel), 
	max(c.dt_saida_hotel), 
	substr(obter_dados_hotel(max(c.nr_seq_hotel), 'E'),1,265), 
	substr(obter_dados_hotel(max(c.nr_seq_hotel), 'B'),1,255), 
	substr(obter_dados_hotel(max(c.nr_seq_hotel), 'C'),1,255) 
into STRICT	nm_hotel_w, 
	dt_entrada_hotel_w, 
	dt_saida_hotel_w, 
	ds_endereco_w, 
	ds_bairro_w, 
	ds_cidade_w 
from	via_reserva c 
where 	c.nr_sequencia = nr_sequencia_p;
 
select	a.ds_mensagem 
into STRICT	ds_mensagem_w 
from	via_regra_mensagem a 
where	a.ie_tipo_mensagem = 'H' 
and	a.dt_atualizacao = (	SELECT	max(b.dt_atualizacao) 
				from	via_regra_mensagem b 
				where	b.ie_tipo_mensagem = 'H');
 
ds_mensagem_w	:= replace_macro(ds_mensagem_w,'@Hotel',nm_hotel_w);
ds_mensagem_w	:= replace_macro(ds_mensagem_w,'@Entrada_hotel', to_char(dt_entrada_hotel_w,'dd/mm hh24:mi'));
ds_mensagem_w	:= replace_macro(ds_mensagem_w,'@Saida_hotel', to_char(dt_saida_hotel_w,'dd/mm hh24:mi'));
ds_mensagem_w	:= replace_macro(ds_mensagem_w,'@Endereco_hotel',ds_endereco_w);
ds_mensagem_w	:= replace_macro(ds_mensagem_w,'@Bairro_hotel',ds_bairro_w);
ds_mensagem_w	:= replace_macro(ds_mensagem_w,'@Cidade_hotel',ds_cidade_w);
 
return ds_mensagem_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_mensagem_hospedagem (nr_sequencia_p bigint) FROM PUBLIC;

