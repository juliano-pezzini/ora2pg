-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION ugf_obter_atend_rn259 ( dt_inicial_p timestamp, dt_final_p timestamp, cd_agenda_p bigint, cd_tipo_agenda_p bigint) RETURNS varchar AS $body$
DECLARE

					 
 
qt_dias_portaria_w		bigint;
qt_dias_atendimento_w		bigint;
cd_especialidade_agenda_w	integer;
ds_retorno_w			varchar(255);
					

BEGIN 
qt_dias_portaria_w	:= 0;
qt_dias_atendimento_w	:= 0;
 
select	coalesce(obter_especialidade_agenda(cd_agenda_p), 0) 
into STRICT	cd_especialidade_agenda_w
;	
 
if (dt_final_p <> to_date('30/12/1899','dd/mm/yyyy')) then 
	 
	select 	obter_dias_entre_datas_uteis(dt_inicial_p,dt_final_p) 
	into STRICT	qt_dias_atendimento_w 
	;	
 
	if (cd_tipo_agenda_p = 3)then 
	 
		if (cd_especialidade_agenda_w <> 0) and (cd_especialidade_agenda_w in (3, 4, 9, 20)) then 
			qt_dias_portaria_w	:= 7;	
 
			if (qt_dias_atendimento_w > qt_dias_portaria_w) then 
				ds_retorno_w := 'Fora do Prazo';
			else 
				ds_retorno_w := 'Dentro do Prazo';
			end if;		
		elsif (cd_especialidade_agenda_w not in (3, 4, 9, 20)) then 
				qt_dias_portaria_w	:= 14;	
				 
				if (qt_dias_atendimento_w > qt_dias_portaria_w) then 
					ds_retorno_w := 'Fora do Prazo';
				else 
					ds_retorno_w := 'Dentro do Prazo';
				end if;	
			 
		end if;
		 
	elsif (cd_tipo_agenda_p = 5) then 
	 
		select coalesce(CASE WHEN cd_agenda_p=1075 THEN 3 WHEN cd_agenda_p=3626 THEN 3 WHEN cd_agenda_p=3496 THEN 3 WHEN cd_agenda_p=1005 THEN 3 WHEN cd_agenda_p=1015 THEN 3 WHEN cd_agenda_p=1025 THEN 3 WHEN cd_agenda_p=1045 THEN 3 WHEN cd_agenda_p=1055 THEN 3 WHEN cd_agenda_p=1056 THEN 3 WHEN cd_agenda_p=1057 THEN 3 WHEN cd_agenda_p=1058 THEN 3 WHEN cd_agenda_p=1065 THEN 3 WHEN cd_agenda_p=1066 THEN 3 WHEN cd_agenda_p=2855 THEN 3 WHEN cd_agenda_p=2856 THEN 3 WHEN cd_agenda_p=4655 THEN 3 WHEN cd_agenda_p=4656 THEN 3 WHEN cd_agenda_p=4657 THEN 3 WHEN cd_agenda_p=4658 THEN 3 WHEN cd_agenda_p=4495 THEN 10 WHEN cd_agenda_p=2305 THEN 10 WHEN cd_agenda_p=4767 THEN 0 WHEN cd_agenda_p=107 THEN 0 WHEN cd_agenda_p=3555 THEN 0 WHEN cd_agenda_p=4826 THEN 0 WHEN cd_agenda_p=4785 THEN 0 WHEN cd_agenda_p=5125 THEN 0 WHEN cd_agenda_p=3138 THEN 0 WHEN cd_agenda_p=3140 THEN 0 WHEN cd_agenda_p=337 THEN 0 WHEN cd_agenda_p=3143 THEN 0 WHEN cd_agenda_p=3142 THEN 0 WHEN cd_agenda_p=308 THEN 0 WHEN cd_agenda_p=3206 THEN 0 WHEN cd_agenda_p=309 THEN 0 WHEN cd_agenda_p=358 THEN 0 WHEN cd_agenda_p=125 THEN 0 WHEN cd_agenda_p=295 THEN 0 WHEN cd_agenda_p=307 THEN 0 WHEN cd_agenda_p=236 THEN 0 WHEN cd_agenda_p=359 THEN 0 WHEN cd_agenda_p=3141 THEN 0 WHEN cd_agenda_p=4697 THEN 0 WHEN cd_agenda_p=3556 THEN 0 WHEN cd_agenda_p=360 THEN 0 WHEN cd_agenda_p=3957 THEN 0 WHEN cd_agenda_p=355 THEN 0 WHEN cd_agenda_p=247 THEN 0 WHEN cd_agenda_p=3144 THEN 0 WHEN cd_agenda_p=2995 THEN 0 WHEN cd_agenda_p=3136 THEN 0 WHEN cd_agenda_p=278 THEN 0 WHEN cd_agenda_p=4355 THEN 0 WHEN cd_agenda_p=4636 THEN 0 WHEN cd_agenda_p=4466 THEN 0 WHEN cd_agenda_p=4415 THEN 0 WHEN cd_agenda_p=5157 THEN 0 WHEN cd_agenda_p=248 THEN 0 WHEN cd_agenda_p=157 THEN 0 WHEN cd_agenda_p=249 THEN 0 WHEN cd_agenda_p=4775 THEN 0 WHEN cd_agenda_p=246 THEN 0 WHEN cd_agenda_p=825 THEN 0 WHEN cd_agenda_p=365 THEN 0 WHEN cd_agenda_p=126 THEN 0 WHEN cd_agenda_p=4689 THEN 0 WHEN cd_agenda_p=3139 THEN 0 WHEN cd_agenda_p=4965 THEN 0 WHEN cd_agenda_p=245 THEN 0 WHEN cd_agenda_p=4245 THEN 0 WHEN cd_agenda_p=3906 THEN 0 WHEN cd_agenda_p=4185 THEN 0 WHEN cd_agenda_p=4125 THEN 0 WHEN cd_agenda_p=3697 THEN 0 WHEN cd_agenda_p=4435 THEN 0 WHEN cd_agenda_p=4635 THEN 0 WHEN cd_agenda_p=5295 THEN 0 WHEN cd_agenda_p=115 THEN 0 WHEN cd_agenda_p=104 THEN 0 WHEN cd_agenda_p=2825 THEN 0 WHEN cd_agenda_p=1645 THEN 0 WHEN cd_agenda_p=645 THEN 0 						 END ,0) 
		into STRICT	qt_dias_portaria_w 
		;				
			 
		if (qt_dias_atendimento_w > qt_dias_portaria_w) then 
			ds_retorno_w := 'Fora do Prazo';
		else 
			ds_retorno_w := 'Dentro do Prazo';
		end if;	
		 
	else 
		 
		select	coalesce(CASE WHEN cd_agenda_p=1265 THEN  21 WHEN cd_agenda_p=1225 THEN  21 WHEN cd_agenda_p=1285 THEN  10 WHEN cd_agenda_p=1275 THEN  21 WHEN cd_agenda_p=1205 THEN  10 WHEN cd_agenda_p=1215 THEN  10 WHEN cd_agenda_p=1905 THEN  10 WHEN cd_agenda_p=1625 THEN  10 WHEN cd_agenda_p=1615 THEN  10 WHEN cd_agenda_p=1845 THEN  10 WHEN cd_agenda_p=1835 THEN  10 WHEN cd_agenda_p=1605 THEN  10 WHEN cd_agenda_p=2345 THEN  10 WHEN cd_agenda_p=2305 THEN  10 WHEN cd_agenda_p=1985 THEN  10 END , 0) 
		into STRICT	qt_dias_portaria_w 
		;
 
		if (qt_dias_portaria_w <> 0)then 
		 
			if (qt_dias_atendimento_w > qt_dias_portaria_w) then 
				ds_retorno_w := 'Fora do Prazo';
			else 
				ds_retorno_w := 'Dentro do Prazo';
			end if;	
		else 
			ds_retorno_w := 'Fora do Prazo';
		end if;
		 
	end if;
	 
else 
	ds_retorno_w := 'Fora do Prazo';
	 
end if;
return	ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION ugf_obter_atend_rn259 ( dt_inicial_p timestamp, dt_final_p timestamp, cd_agenda_p bigint, cd_tipo_agenda_p bigint) FROM PUBLIC;

