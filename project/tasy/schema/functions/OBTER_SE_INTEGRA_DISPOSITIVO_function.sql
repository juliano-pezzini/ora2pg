-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_integra_dispositivo ( ie_integracao_p text, nr_seq_dispositivo_p bigint) RETURNS varchar AS $body$
DECLARE



ie_result_w	         varchar(1) :=	'S';
ie_regra_w           varchar(1) := 'N';
cd_estabelecimento_w estabelecimento.cd_estabelecimento%type := wheb_usuario_pck.get_cd_estabelecimento;


BEGIN

if (ie_integracao_p IS NOT NULL AND ie_integracao_p::text <> '') and (nr_seq_dispositivo_p IS NOT NULL AND nr_seq_dispositivo_p::text <> '') then
   select   coalesce(max('S'),'N')
   into STRICT     ie_regra_w
   from     integracao_sistema_cliente
   where    ie_integracao = ie_integracao_p;

   if (ie_regra_w = 'S') then
      select   coalesce(max('S'),'N')
      into STRICT     ie_result_w
      from     integracao_sistema_cliente a,
               integracao_cliente_disp b
      where    a.nr_sequencia       =  b.nr_seq_integracao
      and      a.ie_integracao      =  ie_integracao_p
      and      b.nr_seq_dispositivo =  nr_seq_dispositivo_p
      and      b.cd_estabelecimento =  coalesce(cd_estabelecimento_w,b.cd_estabelecimento);
   end if;
end if;	

return ie_result_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_integra_dispositivo ( ie_integracao_p text, nr_seq_dispositivo_p bigint) FROM PUBLIC;

