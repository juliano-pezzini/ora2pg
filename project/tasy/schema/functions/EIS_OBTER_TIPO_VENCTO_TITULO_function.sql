-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION eis_obter_tipo_vencto_titulo ( nr_titulo_p bigint, dt_referencia_p timestamp) RETURNS bigint AS $body$
DECLARE

 
ie_tipo_vencimento_w		bigint;
dt_pagamento_previsto_w		timestamp;
dt_parametro_w			timestamp;


BEGIN 
 
select	dt_pagamento_previsto 
into STRICT	dt_pagamento_previsto_w 
from 	titulo_receber_v 
where	nr_titulo	= nr_titulo_p;
 
dt_parametro_w	:= trunc(dt_referencia_p, 'dd');
 
if (dt_pagamento_previsto_w >= dt_parametro_w + 90) then 
	ie_tipo_vencimento_w	:= 5;
elsif (dt_pagamento_previsto_w >= dt_parametro_w + 60) then 
	ie_tipo_vencimento_w	:= 4;
elsif (dt_pagamento_previsto_w >= dt_parametro_w + 30) then 
	ie_tipo_vencimento_w	:= 3;
elsif (dt_pagamento_previsto_w >= dt_parametro_w + 15) then 
	ie_tipo_vencimento_w	:= 2;
elsif (dt_pagamento_previsto_w >= dt_parametro_w) then 
	ie_tipo_vencimento_w	:= 1;
elsif (dt_pagamento_previsto_w >= dt_parametro_w - 15) then 
	ie_tipo_vencimento_w	:= 6;
elsif (dt_pagamento_previsto_w >= dt_parametro_w- 30) then 
	ie_tipo_vencimento_w	:= 7;
elsif (dt_pagamento_previsto_w >= dt_parametro_w- 60) then 
	ie_tipo_vencimento_w	:= 8;
elsif (dt_pagamento_previsto_w >= dt_parametro_w - 90) then 
	ie_tipo_vencimento_w	:= 9;
else	 
	ie_tipo_vencimento_w	:= 10;
end if;
 
return ie_tipo_vencimento_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION eis_obter_tipo_vencto_titulo ( nr_titulo_p bigint, dt_referencia_p timestamp) FROM PUBLIC;

