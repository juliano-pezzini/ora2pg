-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_item_ordem ( nr_ordem_compra_p bigint, nr_item_oci_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


/*ie_opcao_p
S	- Série
Q	- Quantidade
UMC	- Unidade Medida Compra
SC	- Nr solic compra
NF	- Max(Nr_sequencia) Nota fiscal.
NFN	- Número da nota fiscal
MAT	- Código do material
MAR	- Código da marca
L	- Local de estoque
*/
ds_resultado_w			varchar(80);
nr_serie_material_w			varchar(80);
qt_material_w			double precision;
cd_unidade_medida_compra_w	varchar(30);
nr_solic_compra_w			bigint;
nr_seq_nf_w			bigint;
cd_material_w			bigint;
nr_seq_marca_w			bigint;
cd_local_estoque_w		ordem_compra_item.cd_local_estoque%type;


BEGIN

select	nr_serie_material,
	qt_material,
	cd_unidade_medida_compra,
	nr_solic_compra,
	cd_material,
	nr_seq_marca,
	cd_local_estoque
into STRICT	nr_serie_material_w,
	qt_material_w,
	cd_unidade_medida_compra_w,
	nr_solic_compra_w,
	cd_material_w,
	nr_seq_marca_w,
	cd_local_estoque_w
from	ordem_compra_item
where	nr_ordem_compra	= nr_ordem_compra_p
and	nr_item_oci = nr_item_oci_p;

if (ie_opcao_p = 'S') then
	ds_resultado_w	:= nr_serie_material_w;
elsif (ie_opcao_p = 'Q') then
	ds_resultado_w := qt_material_w;
elsif (ie_opcao_p = 'UMC') then
	ds_resultado_w := cd_unidade_medida_compra_w;
elsif (ie_opcao_p = 'MAT') then
	ds_resultado_w := cd_material_w;
elsif (ie_opcao_p = 'MAR') then
	ds_resultado_w := nr_seq_marca_w;
elsif (ie_opcao_p = 'L') then
	ds_resultado_w := cd_local_estoque_w;
elsif (ie_opcao_p = 'SC') then
	ds_resultado_w := nr_solic_compra_w;
elsif (ie_opcao_p in ('NF','NFN')) then
	begin
	ds_resultado_w	:= null;

	select	max(nr_sequencia)
	into STRICT	nr_seq_nf_w
	from	nota_fiscal_item
	where	nr_ordem_compra = nr_ordem_compra_p
	and	nr_item_oci = nr_item_oci_p;

	if (ie_opcao_p = 'NFN') then
		select	substr(nr_nota_fiscal,1,80)
		into STRICT	ds_resultado_w
		from	nota_fiscal
		where	nr_sequencia = nr_seq_nf_w;
	else
		ds_resultado_w := nr_seq_nf_w;
	end if;
	end;
end if;

return ds_resultado_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_item_ordem ( nr_ordem_compra_p bigint, nr_item_oci_p bigint, ie_opcao_p text) FROM PUBLIC;

