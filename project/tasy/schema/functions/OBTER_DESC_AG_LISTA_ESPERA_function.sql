-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_desc_ag_lista_espera (cd_parametro_p text, cd_Agenda_p bigint) RETURNS varchar AS $body$
DECLARE

 
ds_agenda_w	varchar(255);
ie_ordenacao_w	varchar(10);


BEGIN 
 
if (cd_parametro_p = 'N') THEN 
	select 	max(a.ds_agenda) 
	into STRICT	ds_agenda_w 
	from 	agenda a 
	where	a.cd_agenda = cd_Agenda_p;
elsif (cd_parametro_p = 'DEC') then 
	select	max(SUBSTR ((a.ds_agenda||' - '||SUBSTR(obter_desc_espec_agenda(a.cd_especialidade),1,40)||' - '||a.ds_complemento),1,255)) ds_agenda 
	into STRICT	ds_agenda_w 
	from	agenda a 
	where	a.cd_agenda = cd_Agenda_p;
elsif (cd_parametro_p = 'A') then 
	select	max(ie_ordenacao) 
	into STRICT	ie_ordenacao_w 
	from	agenda 
	where	cd_agenda = cd_agenda_p;
	 
	if (ie_ordenacao_w = 'CED') then 
		select	max(SUBSTR ((a.ds_complemento||' - '||SUBSTR(obter_desc_espec_agenda(a.cd_especialidade),1,40)||' - '||a.ds_agenda),1,255)) ds_agenda 
		into STRICT	ds_agenda_w 
		from	agenda a 
		where	a.cd_agenda = cd_Agenda_p;
	elsif (ie_ordenacao_w = 'EDC') then 
		select	max(SUBSTR ((SUBSTR(obter_desc_espec_agenda(a.cd_especialidade),1,40)||' - '||a.ds_agenda||' - '||a.ds_complemento),1,255)) ds_agenda 
		into STRICT	ds_agenda_w 
		from	agenda a 
		where	a.cd_agenda = cd_Agenda_p;
	elsif (ie_ordenacao_w = 'DEC') then 
		select	max(SUBSTR ((a.ds_agenda||' - '||SUBSTR(obter_desc_espec_agenda(a.cd_especialidade),1,40)||' - '||a.ds_complemento),1,255)) ds_agenda 
		into STRICT	ds_agenda_w 
		from	agenda a 
		where	a.cd_agenda = cd_Agenda_p;
	else 
		select 	max(a.ds_agenda) 
		into STRICT	ds_agenda_w 
		from 	agenda a 
		where	a.cd_agenda = cd_Agenda_p;
	end if;
end if;	
 
 
RETURN ds_agenda_w;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_desc_ag_lista_espera (cd_parametro_p text, cd_Agenda_p bigint) FROM PUBLIC;

