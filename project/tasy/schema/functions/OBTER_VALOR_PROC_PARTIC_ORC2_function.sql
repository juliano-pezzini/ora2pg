-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_valor_proc_partic_orc2 ( cd_procedimento_p bigint, ie_origem_proced_p bigint, ie_tipo_atendimento_p bigint, cd_medico_p text, ie_clinica_p bigint, nr_seq_proc_interno_p bigint, nr_seq_exame_p bigint, nr_seq_orcamento_p bigint, nm_usuario_P text) RETURNS bigint AS $body$
DECLARE

 
cd_convenio_w		integer;			
cd_categoria_w		varchar(10);
vl_procedimento_w	double precision;
vl_Retorno_w		double precision;
vl_lanc_automatico_w	double precision;
cd_estabelecimento_w	smallint;
ie_classsif_proced_w		varchar(10);
nr_seq_proc_interno_w bigint;


BEGIN 
 
begin 
ie_classsif_proced_w := obter_classificacao_proced(cd_procedimento_p,ie_origem_proced_p,'C');
 
if (ie_classsif_proced_w = 1) then 
	nr_seq_proc_interno_w := nr_seq_proc_interno_p;
else 
	nr_seq_proc_interno_w:= null;
end if;
exception 
when others then 
    nr_seq_proc_interno_w := nr_seq_proc_interno_p;
end;
 
 
select	wheb_usuario_pck.get_cd_estabelecimento 
into STRICT	cd_estabelecimento_w
;
 
 
SELECT * FROM obter_convenio_particular(cd_estabelecimento_w, cd_convenio_w, cd_categoria_w) INTO STRICT cd_convenio_w, cd_categoria_w;
 
select	obter_preco_proced( 
				cd_estabelecimento_w, 
				cd_convenio_w, 
				cd_categoria_w, 
				clock_timestamp(), 
				cd_procedimento_p, 
				ie_origem_proced_p, 
				null, 
				ie_tipo_atendimento_p, 
				null, 
				cd_medico_p, 
				null, 
				null, 
				null, 
				ie_clinica_p, 
				null, 
				'P', 
				nr_seq_exame_p, 
				nr_seq_proc_interno_w) 
into STRICT	vl_procedimento_w
;
 
vl_lanc_automatico_w:= 0;
begin 
select obter_valor_regra_lanc_aut2(cd_estabelecimento_w, cd_convenio_w, cd_categoria_w, cd_procedimento_p, 
                  ie_origem_proced_p, nr_seq_proc_interno_p, 34, nr_seq_exame_p, 'T', 
								  nr_seq_orcamento_p, nm_usuario_p) 
into STRICT  vl_lanc_automatico_w
;
exception 
when others then 
    vl_lanc_automatico_w  := 0;
end;
 
vl_retorno_w	:= vl_procedimento_w + vl_lanc_automatico_w;
 
return	vl_Retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_valor_proc_partic_orc2 ( cd_procedimento_p bigint, ie_origem_proced_p bigint, ie_tipo_atendimento_p bigint, cd_medico_p text, ie_clinica_p bigint, nr_seq_proc_interno_p bigint, nr_seq_exame_p bigint, nr_seq_orcamento_p bigint, nm_usuario_P text) FROM PUBLIC;

