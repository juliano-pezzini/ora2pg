-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION rp_obter_horario_inicio (cd_agenda_p bigint, ie_dia_semana_p bigint, hr_horario_p text) RETURNS varchar AS $body$
DECLARE


    horarios_inicio_validos_w varchar(2000);
    horario_inicio_w          varchar(5);

    c01 CURSOR FOR
        SELECT to_char(hr_inicial, 'hh24:mi')
          FROM agenda_turno
         WHERE cd_agenda = cd_agenda_p
           AND ie_dia_semana = ie_dia_semana_p
         GROUP BY to_char(hr_inicial, 'hh24:mi')
         ORDER BY to_char(hr_inicial, 'hh24:mi');


BEGIN

    horarios_inicio_validos_w := '';

    OPEN c01;
    LOOP
        FETCH c01
            INTO horario_inicio_w;

        EXIT WHEN NOT FOUND; /* apply on c01 */
        BEGIN
            IF (horario_inicio_w = substr(hr_horario_p, 1, 5)) THEN
                horarios_inicio_validos_w := '';
                EXIT;
            ELSE
                horarios_inicio_validos_w := horarios_inicio_validos_w || '  ' || horario_inicio_w;
            END IF;
        END;

    END LOOP;
    CLOSE c01;

    RETURN horarios_inicio_validos_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION rp_obter_horario_inicio (cd_agenda_p bigint, ie_dia_semana_p bigint, hr_horario_p text) FROM PUBLIC;

