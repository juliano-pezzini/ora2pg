-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION ptu_conversao_tipo_tabela ( ie_tipo_tabela_p text, cd_servico_p text, ie_tipo_transacao_p text, ie_origem_servico_p text) RETURNS varchar AS $body$
DECLARE


--Rotina para conversao de tabela dos itens do PTU Online 8.0
/*----------------------------------------------------------------------------------------------------------------------------------------------------
IE_TIPO_TABELA_TISS      IE_TIPO_TABELA

22 (TUSS Procedimentos) 	0 (Rol Unimed)
18 (TUSS Taxas)		1 (Tx, diaria, gases)
00 (Tabela Propria das Operadoras)      2 (Mat (TNUMM))    substr 1,2  19
00 (Tabela Propria das Operadoras)      3 (Med (TNUMM))    substr 1,2  20
98 (Tabela Propria de Pacotes)        4 (Pacotes)
19 (TUSS Materiais)              5 (Mat (TUSS))
20 (TUSS Medicamentos)            6 (Med (TUSS))

*/
ie_tipo_tabela_w 	varchar(10);


BEGIN

begin
if (pls_obter_versao_scs in ('080','090')) then
	if (ie_tipo_transacao_p = 'E') then
		select  case ie_tipo_tabela_p
			when '0' then CASE WHEN ie_origem_servico_p=4 THEN  '00'  ELSE '22' END
			when '1' then CASE WHEN ie_origem_servico_p=4 THEN  '00'  ELSE '18' END 
			when '2' then '00'
			when '3' then '00'
			when '4' then '98'
			when '5' then '19'
			when '6' then '20'
			else 'N'
			end
		into STRICT  ie_tipo_tabela_w
		;

	elsif (ie_tipo_transacao_p = 'R') then
		select	case ie_tipo_tabela_p
			when '22' then '0'
			when '18' then '1'
			when '00' then '00'
			when '0'  then '00'
			when '98' then '4'
			when '19' then '5'
			when '20' then '6'
			else 'N'
			end
		into STRICT	ie_tipo_tabela_w
		;

		if (ie_tipo_tabela_w = '00') then
			select	case substr(cd_servico_p,1,2)
				when '22' then '0'
				when '18' then '1'
				when '19' then '2'
				when '20' then '3'
				else ie_tipo_tabela_w
				end
			into STRICT	ie_tipo_tabela_w
			;
		end if;
	end if;
else
	ie_tipo_tabela_w := ie_tipo_tabela_p;
end if;

exception
when others then
	ie_tipo_tabela_w := ie_tipo_tabela_p;
end;

return  ie_tipo_tabela_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION ptu_conversao_tipo_tabela ( ie_tipo_tabela_p text, cd_servico_p text, ie_tipo_transacao_p text, ie_origem_servico_p text) FROM PUBLIC;

