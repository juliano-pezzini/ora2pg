-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_parte_nome_fleury ( nm_pessoa_fisica_p text, ie_tipo_nome_p text) RETURNS varchar AS $body$
DECLARE



ds_retorno_w		varchar(255);
nm_pessoa_fisica_w	varchar(255);
complemento_nome_w	varchar(255);
ds_nome_w		varchar(255);
ds_sobrenome_w		varchar(255);

pos			bigint;
tam			bigint;
tamNome			bigint;
tamResto		bigint;


BEGIN

nm_pessoa_fisica_w := trim(both nm_pessoa_fisica_p);


if (upper(Obter_Parte_Nome(nm_pessoa_fisica_w,'sobrenome')) in ('II','III','IV','V','VI','VII','PRIMEIRO','SEGUNDO','TERCEIRO','QUARTO','QUINTO','SEXTO','SETIMO','DE','FILHO','FO','JUNIOR','JR','SOBRINHO','NETO','NETTO','SENIOR')) then


	pos		   := Instr(nm_pessoa_fisica_w, chr(32),-1);

	complemento_nome_w := substr(nm_pessoa_fisica_w, pos + 1, 100);

	nm_pessoa_fisica_w := trim(both substr(nm_pessoa_fisica_w, 1 ,pos));

	if	not(position(chr(32) in nm_pessoa_fisica_w) > 0) then

		complemento_nome_w := '';
		nm_pessoa_fisica_w := trim(both nm_pessoa_fisica_p);

	end if;

end if;

pos		:= Instr(nm_pessoa_fisica_w, chr(32),-1);

ds_sobrenome_w 	:= substr(nm_pessoa_fisica_w, pos + 1, 100);
ds_nome_w 	:= substr(nm_pessoa_fisica_w, 1 ,pos);


tam := length(ds_nome_w||ds_sobrenome_w||complemento_nome_w);
if (tam >= 40) then

	tamNome  := length(ds_nome_w);
	tamResto := length(ds_sobrenome_w||complemento_nome_w);

	if	( tamNome < (tam - tamResto)) then

		ds_nome_w := substr(ds_nome_w ,1 , 1 );

		complemento_nome_w := '';

	else

		ds_nome_w := substr(ds_nome_w ,1 , tamNome - (tam - 38));

	end if;

end if;



tam := length(ds_nome_w||ds_sobrenome_w||complemento_nome_w);

if (tam >= 40) then

	tamResto := length(ds_sobrenome_w||complemento_nome_w);

	complemento_nome_w := '';

	tam := length(ds_nome_w||ds_sobrenome_w||complemento_nome_w);
	if (tam >= 40) then
		ds_sobrenome_w := substr(ds_sobrenome_w,1,38);
	end if;


end if;



if (lower(ie_tipo_nome_p) = 'nome') then

	ds_retorno_w := ds_nome_w;

elsif (lower(ie_tipo_nome_p) = 'sobrenome') then

	ds_retorno_w := ds_sobrenome_w;

elsif (lower(ie_tipo_nome_p) = 'complementonome') then

	ds_retorno_w := complemento_nome_w;

end if;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_parte_nome_fleury ( nm_pessoa_fisica_p text, ie_tipo_nome_p text) FROM PUBLIC;

