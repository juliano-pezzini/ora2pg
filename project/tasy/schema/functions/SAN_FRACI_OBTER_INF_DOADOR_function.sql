-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION san_fraci_obter_inf_doador (nr_seq_doacao_p bigint, cd_barras_integracao_p text, ie_retorno_p text) RETURNS varchar AS $body$
DECLARE

 
ie_barras_valido_w	varchar(1);
ds_iniciais_w		varchar(50);
dt_doacao_w		varchar(120);
ie_tipo_bolsa_w		varchar(10);
ds_tipo_bolsa_w		varchar(150);
nr_seq_antic_w		varchar(10);
ds_soluc_anti_w		varchar(150);
ds_retorno_w		varchar(255);
ds_valor_param_331_w	varchar(255);

BEGIN
if (cd_barras_integracao_p IS NOT NULL AND cd_barras_integracao_p::text <> '') then 
	ds_valor_param_331_w := obter_valor_param_usuario(450, 331, wheb_usuario_pck.get_cd_perfil, wheb_usuario_pck.get_nm_usuario, wheb_usuario_pck.get_cd_estabelecimento);
	 
	if (ds_valor_param_331_w = 'B') then		 
		select	substr(obter_iniciais_nome(a.cd_pessoa_fisica,''),1,50), 
			to_char(a.dt_doacao,'dd/mm/yyyy hh24:mi:ss'), 
			to_char(a.ie_tipo_bolsa), 
			substr(obter_valor_dominio(2176,a.ie_tipo_bolsa),1,100), 
			a.nr_seq_antic, 
			(select ds_anticoagulante from san_anticoagulante where ie_situacao = 'A' and nr_sequencia = a.nr_seq_antic) 
		into STRICT	ds_iniciais_w, 
			dt_doacao_w, 
			ie_tipo_bolsa_w, 
			ds_tipo_bolsa_w, 
			nr_seq_antic_w, 
			ds_soluc_anti_w 
		from	san_doacao a 
		where	obter_isbt_doador(a.nr_sequencia, NULL,'I')	= cd_barras_integracao_p 
		and	a.nr_sequencia					= nr_seq_doacao_p;
	else		 
		select	substr(obter_iniciais_nome(a.cd_pessoa_fisica,''),1,50), 
			to_char(a.dt_doacao,'dd/mm/yyyy hh24:mi:ss'), 
			to_char(a.ie_tipo_bolsa), 
			substr(obter_valor_dominio(2176,a.ie_tipo_bolsa),1,100), 
			a.nr_seq_antic, 
			(select ds_anticoagulante from san_anticoagulante where ie_situacao = 'A' and nr_sequencia = a.nr_seq_antic) 
		into STRICT	ds_iniciais_w, 
			dt_doacao_w, 
			ie_tipo_bolsa_w, 
			ds_tipo_bolsa_w, 
			nr_seq_antic_w, 
			ds_soluc_anti_w 
		from	san_doacao a 
		where	a.cd_barras_integracao 	= cd_barras_integracao_p 
		and	a.nr_sequencia		= nr_seq_doacao_p;
	end if;
 
	if (ie_retorno_p = 'INI') then		ds_retorno_w	:= ds_iniciais_w;
	elsif (ie_retorno_p = 'DT') then		ds_retorno_w	:= dt_doacao_w;
	elsif (ie_retorno_p = 'BL') then		ds_retorno_w	:= ie_tipo_bolsa_w;
	elsif (ie_retorno_p = 'BLS') then		ds_retorno_w	:= ds_tipo_bolsa_w;
	elsif (ie_retorno_p = 'NSOL') then		ds_retorno_w	:= nr_seq_antic_w;
	elsif (ie_retorno_p = 'SOL') then		ds_retorno_w	:= ds_soluc_anti_w;
	end if;
 
end if;
return	ds_retorno_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION san_fraci_obter_inf_doador (nr_seq_doacao_p bigint, cd_barras_integracao_p text, ie_retorno_p text) FROM PUBLIC;

