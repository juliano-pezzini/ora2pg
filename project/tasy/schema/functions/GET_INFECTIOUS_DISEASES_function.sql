-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_infectious_diseases ( cd_pessoa_fisica_p text ) RETURNS varchar AS $body$
DECLARE


    investigacao_w    varchar(250) := NULL;
    investigacao_ww   varchar(10000) := NULL;
    c01 CURSOR FOR
    SELECT
        ds_item_investigacao
    FROM
        historico_infeccao
    WHERE
        cd_pessoa_fisica = cd_pessoa_fisica_p
        AND ie_situacao = 'A'
        AND (dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
        AND (ds_item_investigacao IS NOT NULL AND ds_item_investigacao::text <> '')
        AND  coalesce(dt_fim::text, '') = '';



BEGIN
    OPEN c01;
    LOOP
        FETCH c01 INTO investigacao_w;
        EXIT WHEN NOT FOUND; /* apply on c01 */
        investigacao_ww := investigacao_ww
                           || ', '
                           || investigacao_w;
    END LOOP;

    CLOSE c01;
    RETURN ltrim(investigacao_ww, ',');
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_infectious_diseases ( cd_pessoa_fisica_p text ) FROM PUBLIC;

