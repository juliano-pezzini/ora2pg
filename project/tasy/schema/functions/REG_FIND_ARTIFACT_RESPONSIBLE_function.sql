-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION reg_find_artifact_responsible ( ie_obj_type_p text, nr_seq_object_p bigint ) RETURNS varchar AS $body$
DECLARE

	nr_seq_cr_w		reg_resp_cr.nr_seq_cr%type;
	nr_seq_feature_w	reg_resp_feature.nr_seq_feature%type;
	nr_seq_group_w		reg_resp_group.nr_seq_group%type;

	ds_responsible		varchar(4000);

BEGIN

	if ('PR' = ie_obj_type_p) then
		select	nr_customer_requirement
		into STRICT	nr_seq_cr_w
		from	reg_product_requirement
		where	nr_sequencia = nr_seq_object_p;

		select	nr_seq_features
		into STRICT	nr_seq_feature_w
		from	reg_customer_requirement
		where	nr_sequencia = nr_seq_cr_w;

		select	nr_seq_area_customer
		into STRICT	nr_seq_group_w
		from	reg_features_customer
		where	nr_sequencia = nr_seq_feature_w;

	elsif ('AR' = ie_obj_type_p) then
		return reg_get_ds_responsibles(nr_seq_object_p, 'GR');
	elsif ('CR' = ie_obj_type_p) then
		nr_seq_cr_w := nr_seq_object_p;

		select	nr_seq_features
		into STRICT	nr_seq_feature_w
		from	reg_customer_requirement
		where	nr_sequencia = nr_seq_cr_w;

		select	nr_seq_area_customer
		into STRICT	nr_seq_group_w
		from	reg_features_customer
		where	nr_sequencia = nr_seq_feature_w;

	elsif ('FE' = ie_obj_type_p) then
		return coalesce(reg_get_ds_responsibles(nr_seq_object_p, 'FE', 'N'),
					reg_get_ds_responsibles(nr_seq_group_w, 'GR', 'N'));
	elsif ('IU' = ie_obj_type_p) then
		select	nm_usuario_nrec
		into STRICT	ds_responsible
		from	reg_intencao_uso
		where	nr_sequencia = nr_seq_object_p;
		return ds_responsible;
	elsif ('TC' = ie_obj_type_p) then
		select	nm_usuario_nrec
		into STRICT	ds_responsible
		from	reg_caso_teste
		where	nr_sequencia = nr_seq_object_p;
		return ds_responsible;
	end if;

	return coalesce(reg_get_ds_responsibles(nr_seq_cr_w, 'CR', 'N'),
					coalesce(reg_get_ds_responsibles(nr_seq_feature_w, 'FE', 'N'),
					reg_get_ds_responsibles(nr_seq_group_w, 'GR', 'N')));


end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION reg_find_artifact_responsible ( ie_obj_type_p text, nr_seq_object_p bigint ) FROM PUBLIC;

