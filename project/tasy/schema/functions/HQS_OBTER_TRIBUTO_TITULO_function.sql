-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION hqs_obter_tributo_titulo ( nr_titulo_p bigint, ie_opcao_p text) RETURNS bigint AS $body$
DECLARE



vl_tributo_w		double precision;


/*opções
INSS - tributos de inss conforme descriçãp da tabela título_pagar_imposto
PCC - pis/cofins/csll
IR - imposto de renda
ISS - imposto sobre serviço
*/
BEGIN

if (ie_opcao_p = 'INSS') then
	select max(vl_imposto)
	into STRICT	vl_tributo_w
	from titulo_pagar_imposto
	where	nr_titulo	= nr_titulo_p
	  and	cd_tributo	= 7
	  and	ie_pago_prev	= 'V';
elsif (ie_opcao_p = 'PCC') then
	select max(vl_imposto)
	into STRICT	vl_tributo_w
	from titulo_pagar_imposto
	where	nr_titulo	= nr_titulo_p
	  and	cd_tributo	in (18, 19, 17, 52, 12)
	  and	ie_pago_prev	= 'V';
elsif (ie_opcao_p = 'IR') then
	  select max(vl_imposto)
	into STRICT	vl_tributo_w
	from titulo_pagar_imposto
	where	nr_titulo	= nr_titulo_p
	  and	cd_tributo	in (16, 15, 11)
	  and	ie_pago_prev	= 'V';
elsif (ie_opcao_p = 'ISS') then
	  select max(vl_imposto)
	into STRICT	vl_tributo_w
	from titulo_pagar_imposto
	where	nr_titulo	= nr_titulo_p
	  and	cd_tributo	in (20 ,10)
	  and	ie_pago_prev	= 'V';
end if;

Return vl_tributo_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION hqs_obter_tributo_titulo ( nr_titulo_p bigint, ie_opcao_p text) FROM PUBLIC;

