-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_father_objeto_schematics (p_nr_sequencia bigint) RETURNS bigint AS $body$
DECLARE


	w_nr_sequencia bigint := 0;
	w_nr_seq_obj_sup bigint := 0;
	w_cd_exp_desc_obj bigint := 0;
	w_ie_tipo_objeto varchar(10) := NULL;
	w_ie_tipo_componente varchar(10) := NULL;
	w_ds_Saiu varchar(50) := NULL;

	c_get_information CURSOR(p_nr_seq bigint) FOR
		SELECT nr_sequencia, nr_seq_obj_sup, cd_exp_desc_obj, ie_tipo_objeto, ie_tipo_componente
		FROM objeto_schematic
		WHERE nr_sequencia = p_nr_seq;

	 FUNCTION get_father_sequence(p_nr_seq_father IN bigint) RETURN bigint IS

	  w_nr_sequencia bigint := 0;
	  w_nr_seq_obj_sup bigint := 0;
	  w_cd_exp_desc_obj bigint := 0;
	  w_ds_saiu varchar(50) := NULL;
	  w_ie_tipo_objeto varchar(10) := NULL;
	  w_ie_tipo_componente varchar(10) := NULL;

	  c_get_information_father CURSOR FOR
		  SELECT nr_sequencia, nr_seq_obj_sup, cd_exp_desc_obj, ie_tipo_objeto, ie_tipo_componente
		  FROM objeto_schematic
		  WHERE nr_sequencia = p_nr_seq_father;

	
BEGIN
	   OPEN c_get_information_father;
	   FETCH c_get_information_father INTO w_nr_sequencia,
	   		 						  	   w_nr_seq_obj_sup,
										   w_cd_exp_desc_obj,
										   w_ie_tipo_objeto,
										   w_ie_tipo_componente;

	     IF (((w_ie_tipo_objeto = 'MN') AND (w_cd_exp_desc_obj = 700743 OR (w_cd_exp_desc_obj = 100330405))) OR (w_ie_tipo_objeto IN ('SCH', 'TV', 'MR', 'R', 'P')) OR (w_ie_tipo_objeto = 'C' AND w_ie_tipo_componente <> 'WP' AND w_ie_tipo_componente <> 'WDLG') OR (w_ie_tipo_objeto = 'T' AND w_cd_exp_desc_obj = 692495) OR (w_ie_tipo_objeto = 'MN' AND w_cd_exp_desc_obj = 306577)) THEN
	       w_ds_saiu := get_father_sequence(w_nr_seq_obj_sup);
	     ELSE
		   RETURN w_nr_sequencia;
	     END IF;
	       RETURN w_ds_saiu;
	   CLOSE c_get_information_father;

       RETURN 0;

	 END;
BEGIN
  OPEN c_get_information(p_nr_sequencia);
  FETCH c_get_information INTO w_nr_sequencia,
  						  	   w_nr_seq_obj_sup,
							   w_cd_exp_desc_obj,
							   w_ie_tipo_objeto,
							   w_ie_tipo_componente;

     w_ds_saiu := get_father_sequence(w_nr_seq_obj_sup);

  CLOSE c_get_information;

  RETURN w_ds_saiu;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_father_objeto_schematics (p_nr_sequencia bigint) FROM PUBLIC;

