-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_item_prescr_vig ( nr_prescricao_p bigint, dt_inicial_p timestamp, dt_final_p timestamp) RETURNS varchar AS $body$
DECLARE


ie_item_vigente_w	varchar(1) := 'N';

C01 CURSOR FOR
SELECT	coalesce(max('S'),'N')
from	prescr_material a,
	prescr_mat_hor b
where	a.nr_prescricao			=	nr_prescricao_p
and	a.nr_prescricao			=	b.nr_prescricao
and	a.nr_sequencia			=	b.nr_seq_material
and	coalesce(a.ie_suspenso,'N')		<>	'S'
and	coalesce(a.ie_administrar,'S')	=	'S'
and	b.dt_horario between dt_inicial_p and dt_final_p

union

select	coalesce(max('S'),'N')
from	prescr_dieta a,
	prescr_dieta_hor b
where	a.nr_prescricao = nr_prescricao_p
and	a.nr_prescricao = b.nr_prescricao
and	a.nr_sequencia  = b.nr_seq_dieta
and	coalesce(a.ie_suspenso,'N')	<> 'S'
and	b.dt_horario between dt_inicial_p and dt_final_p

union

select	coalesce(max('S'),'N')
from	prescr_procedimento a,
	prescr_proc_hor b
where  	a.nr_prescricao = nr_prescricao_p
and	a.nr_prescricao = b.nr_prescricao
and	a.nr_sequencia  = b.nr_seq_procedimento
and	obter_se_exibe_proced(a.nr_prescricao,a.nr_sequencia,a.ie_tipo_proced,'O') = 'S'
and	coalesce(a.nr_seq_solic_sangue::text, '') = ''
and	coalesce(a.ie_suspenso,'N')	<> 'S'
and	coalesce(a.nr_seq_origem::text, '') = ''
and	coalesce(a.nr_seq_prescr_mat::text, '') = ''
and	coalesce(a.nr_seq_prescr_sol::text, '') = ''
and	b.dt_horario between dt_inicial_p and dt_final_p

union

select	coalesce(max('S'),'N')
from	prescr_recomendacao a,
	prescr_rec_hor b
where	a.nr_prescricao = nr_prescricao_p
and	a.nr_prescricao = b.nr_prescricao
and	a.nr_sequencia  = b.nr_seq_recomendacao
and	coalesce(a.ie_suspenso,'N')	<> 'S'
and	b.dt_horario between dt_inicial_p and dt_final_p;


BEGIN

open C01;
loop
fetch C01 into
	ie_item_vigente_w;
exit when(ie_item_vigente_w = 'S') or C01%notfound;
end loop;
close C01;

return	ie_item_vigente_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_item_prescr_vig ( nr_prescricao_p bigint, dt_inicial_p timestamp, dt_final_p timestamp) FROM PUBLIC;

