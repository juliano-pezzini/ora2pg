-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_medic_regulado (CD_MATERIAL_P bigint, NR_ATENDIMENTO_P bigint DEFAULT NULL) RETURNS varchar AS $body$
DECLARE


  IE_REGULADO_W varchar(1) := 'N';


BEGIN

  IF (IE_REGULADO_W IS NOT NULL AND IE_REGULADO_W::text <> '' AND NR_ATENDIMENTO_P IS NOT NULL AND NR_ATENDIMENTO_P::text <> '') THEN

    SELECT CASE WHEN coalesce(MAX(CD_MATERIAL), '0')='0' THEN  'N'  ELSE 'S' END 
    
      INTO STRICT IE_REGULADO_W
    
      FROM REGRA_REGULACAO
    
     WHERE CD_MATERIAL = CD_MATERIAL_P;

    IF (IE_REGULADO_W LIKE 'S') THEN
      SELECT obter_se_convenio_regulacao(nr_atendimento_p)
        INTO STRICT IE_REGULADO_W
;
    END IF;

  END IF;

  RETURN IE_REGULADO_W;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_medic_regulado (CD_MATERIAL_P bigint, NR_ATENDIMENTO_P bigint DEFAULT NULL) FROM PUBLIC;

