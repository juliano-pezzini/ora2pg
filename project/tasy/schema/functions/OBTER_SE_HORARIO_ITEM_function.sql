-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_horario_item (ds_horarios_p text, cd_material_p bigint) RETURNS varchar AS $body$
DECLARE


ie_horario_item_w	varchar(1) := 'S';
ds_horarios_w		varchar(2000);
hr_inicio_w		varchar(5);
hr_fim_w		varchar(5);
ds_hora_w		varchar(10);
k			bigint;

c01 CURSOR FOR
SELECT	hr_inicio,
	hr_final
from	material_horario_padrao
where	cd_material	= cd_material_p;


BEGIN

if (ds_horarios_p	<> 'ACM') and (ds_horarios_p	<> 'SN') then

	open c01;
	loop
	fetch c01 into
		hr_inicio_w,
		hr_fim_w;
	EXIT WHEN NOT FOUND; /* apply on c01 */

		ds_horarios_w	:= trim(both ds_horarios_p);
		ds_horarios_w	:= ds_horarios_w ||' ';

		while	(ds_horarios_w IS NOT NULL AND ds_horarios_w::text <> '') LOOP
			begin
			select	position(' ' in ds_horarios_w)
			into STRICT	k
			;

			if (k > 1) and ((substr(ds_horarios_w, 1, k -1) IS NOT NULL AND (substr(ds_horarios_w, 1, k -1))::text <> '')) then
				begin
				ds_hora_w		:= substr(ds_horarios_w, 1, k-1);
				ds_hora_w		:= replace(ds_hora_w, ' ','');
				ds_horarios_w		:= substr(ds_horarios_w, k + 1, 2000);

				if (position(':' in ds_hora_w) = 0) then
					ds_hora_w	:= ds_hora_w || ':00';
				end if;

				if (ds_hora_w < hr_inicio_w) or (ds_hora_w > hr_fim_w) then
					ie_horario_item_w := 'N';
					exit;
				end if;

				end;
			elsif (ds_horarios_w IS NOT NULL AND ds_horarios_w::text <> '') then
				ds_horarios_w		:= '';
			end if;
			end;
		END LOOP;

	end loop;
	close c01;
end if;

return	ie_horario_item_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_horario_item (ds_horarios_p text, cd_material_p bigint) FROM PUBLIC;

