-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_adic_diag (cd_doenca_p text, ie_classif_doenca_p text, ie_lado_p text, ie_tipo_diagnostico_p text, nr_seq_episodio_p bigint, ie_diag_tratamento_p text default 'N', ie_diag_referencia_p text default 'N') RETURNS varchar AS $body$
DECLARE


		ie_permite_diag_w varchar(1);	


BEGIN	

	select 	coalesce(max('N'),'S')
	into STRICT	ie_permite_diag_w
	from 	diagnostico_doenca
	where	coalesce(cd_doenca,0) = coalesce(cd_doenca_p, 0)
	and 	coalesce(ie_classificacao_doenca, 0) = coalesce(ie_classif_doenca_p,  0)
	and 	coalesce(ie_lado,0) = coalesce(ie_lado_p,0)
	and 	coalesce(ie_tipo_diagnostico, 0) = coalesce(ie_tipo_diagnostico_p,  0)
	and		(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
	and		coalesce(dt_inativacao::text, '') = ''
	and		((ie_diag_tratamento_p = 'S' and IE_DIAG_TRATAMENTO = 'S') or (ie_diag_referencia_p = 'S' and ie_diag_referencia  = 'S') or (ie_diag_tratamento_p = 'N' and ie_diag_referencia_p = 'N') )
	and 	nr_atendimento in (	SELECT 	a.nr_atendimento
								from   	atendimento_paciente a, 
										episodio_paciente b 
								where  	a.nr_Seq_episodio = b.nr_Sequencia 
								and 	b.nr_sequencia = nr_seq_episodio_p);

return ie_permite_diag_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_adic_diag (cd_doenca_p text, ie_classif_doenca_p text, ie_lado_p text, ie_tipo_diagnostico_p text, nr_seq_episodio_p bigint, ie_diag_tratamento_p text default 'N', ie_diag_referencia_p text default 'N') FROM PUBLIC;

