-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_status_cheque_scob (nr_seq_cheque_p bigint, dt_parametro_p timestamp) RETURNS varchar AS $body$
DECLARE


/*	Edgar 15/01/2009, OS 123662, function para posição contábil do cheque sem considerar a cobrança

	1 - À DEPOSITAR
	2 - DEPOSITADO
	3 - DEVOLVIDO
	4 - REAPRESENTADO
	5 - SEGUNDA DEVOLUCAO
	6 - DEVOLUCAO PACIENTE
	8 - VENDIDO PARA TERCEIROS
	9 - SEGUNDA REAPRESENTAÇÃO
	10 - TERCEIRA DEVOLUÇAO

*/
dt_parametro_w			timestamp;
dt_registro_w			timestamp;
dt_deposito_w			timestamp;
dt_devolucao_banco_w		timestamp;
dt_reapresentacao_w		timestamp;
dt_seg_devolucao_w		timestamp;
dt_seq_reapresentacao_w		timestamp;
dt_terc_devolucao_w		timestamp;
dt_devolucao_w			timestamp;
dt_venda_terc_w			timestamp;
ie_status_cheque_w		bigint;



BEGIN

dt_parametro_w		:= trunc(dt_parametro_p,'dd');
SELECT		coalesce(trunc(dt_registro,'dd'),dt_parametro_w + 1),
		coalesce(trunc(dt_deposito,'dd'),dt_parametro_w + 1),
		coalesce(trunc(dt_devolucao_banco,'dd'),dt_parametro_w + 1),
		coalesce(trunc(dt_reapresentacao,'dd'),dt_parametro_w + 1),
		coalesce(trunc(dt_seg_devolucao,'dd'),dt_parametro_w + 1),
		coalesce(trunc(dt_devolucao,'dd'),dt_parametro_w + 1),
		coalesce(trunc(dt_venda_terc,'dd'),dt_parametro_w + 1),
		coalesce(trunc(dt_seg_reapresentacao, 'dd'),dt_parametro_w + 1),
		coalesce(trunc(dt_terc_devolucao,'dd'),dt_parametro_w + 1)
INTO STRICT		dt_registro_w,
		dt_deposito_w,
		dt_devolucao_banco_w,
		dt_reapresentacao_w,
		dt_seg_devolucao_w,
		dt_devolucao_w,
		dt_venda_terc_w,
		dt_seq_reapresentacao_w,
		dt_terc_devolucao_w
FROM		cheque_cr
WHERE		nr_seq_cheque	= nr_seq_cheque_p;


ie_status_cheque_w		:= 1;

if (dt_parametro_w	>= dt_registro_w) then	-- à depositar
	ie_status_cheque_w	:= 1;
end if;

if (dt_parametro_w	>= dt_deposito_w) then	-- depositado
	ie_status_cheque_w	:= 2;
end if;

if (dt_parametro_w	>= dt_devolucao_banco_w) then	-- devolvido
	ie_status_cheque_w	:= 3;
end if;

if (dt_parametro_w	>= dt_reapresentacao_w) then	-- reapresentado
	ie_status_cheque_w	:= 4;
end if;

if (dt_parametro_w	>= dt_seg_devolucao_w) then	-- segunda devolução
	ie_status_cheque_w	:= 5;
end if;

if (dt_parametro_w	>= dt_seq_reapresentacao_w) then	-- segunda reapresentação
	ie_status_cheque_w	:= 9;
end if;

if (dt_parametro_w	>= dt_terc_devolucao_w) then	-- terceira devolução
	ie_status_cheque_w	:= 10;
end if;

if (dt_parametro_w	>= dt_devolucao_w) then		-- devolução ao paciente
	ie_status_cheque_w	:= 6;
end if;

if (dt_parametro_w	>= dt_venda_terc_w) then		-- vendido para terceiros
	ie_status_cheque_w	:= 8;
end if;

return	ie_status_cheque_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_status_cheque_scob (nr_seq_cheque_p bigint, dt_parametro_p timestamp) FROM PUBLIC;

