-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION get_weight_difference ( final_package_weight_p bigint, package_sequence_p bigint, nm_usuario_p text ) RETURNS varchar AS $body$
DECLARE


weight_percentage_w	bigint;
total_package_weight double precision;
param237_value_w varchar(100);
msg_out_w varchar(255) := '';


BEGIN

 param237_value_w := obter_param_usuario(406, 237, wheb_usuario_pck.get_cd_perfil, nm_usuario_p, wheb_usuario_pck.get_cd_estabelecimento, param237_value_w);

select qt_peso into STRICT total_package_weight from CM_CONJUNTO where nr_sequencia = package_sequence_p;

weight_percentage_w := ((final_package_weight_p - total_package_weight)/total_package_weight)*100;

	if (abs(weight_percentage_w) > param237_value_w) then

     if (weight_percentage_w > 0 ) then
     msg_out_w		:= obter_desc_exp_idioma(925734,wheb_usuario_pck.get_nr_seq_idioma,'PCT=' ||to_char(abs(weight_percentage_w)));
     else
     msg_out_w		:= obter_desc_exp_idioma(925736,wheb_usuario_pck.get_nr_seq_idioma,'PCT=' ||to_char(abs(weight_percentage_w)));
     end if;

	end if;

RETURN msg_out_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_weight_difference ( final_package_weight_p bigint, package_sequence_p bigint, nm_usuario_p text ) FROM PUBLIC;

