-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_valores_reembolso (nr_seq_protocolo_p bigint, ie_tipo_valor_p text) RETURNS bigint AS $body$
DECLARE

/*
 R = reembolso
D = Despesa
F = Diferenca
*/
vl_liberado_proc_w	double precision;
vl_liberado_mat_w	double precision;
vl_procedimento_w	double precision;
vl_material_w		double precision;
vl_reembolso_w		double precision;
vl_despesa_w		double precision;
vl_retorno_w		double precision;

BEGIN

select 	coalesce(sum(a.vl_liberado),0),
	coalesce(sum(a.vl_procedimento_imp),0)
into STRICT	vl_liberado_proc_w,
	vl_procedimento_w
from	pls_conta_proc 	a,
	pls_conta	b
where 	b.nr_seq_protocolo		= nr_seq_protocolo_p
and 	a.nr_seq_conta			= b.nr_sequencia;

select 	coalesce(sum(a.vl_liberado),0),
	coalesce(sum(a.vl_material_imp),0)
into STRICT	vl_liberado_mat_w,
	vl_material_w
from	pls_conta_mat 	a,
	pls_conta	b
where 	b.nr_seq_protocolo		= nr_seq_protocolo_p
and 	a.nr_seq_conta			= b.nr_sequencia;

vl_reembolso_w	:= vl_liberado_proc_w 	+ vl_liberado_mat_w;
vl_despesa_w	:= vl_material_w	+ vl_procedimento_w;

if (ie_tipo_valor_p = 'R')	then
	vl_retorno_w	:= vl_reembolso_w;
elsif (ie_tipo_valor_p = 'D')	then
	vl_retorno_w	:= vl_despesa_w;
elsif (ie_tipo_valor_p = 'F')	then
	vl_retorno_w	:= vl_despesa_w - vl_reembolso_w;
end if;

return vl_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_valores_reembolso (nr_seq_protocolo_p bigint, ie_tipo_valor_p text) FROM PUBLIC;

