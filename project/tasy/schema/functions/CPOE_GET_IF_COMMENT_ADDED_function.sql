-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION cpoe_get_if_comment_added (NR_SEQ_STD_COMMENT_P bigint, NR_SEQ_CPOE_MATERIAL_P bigint default null, NR_SEQ_CPOE_PROCED_P bigint default null, NR_SEQ_CPOE_NUTRICAO_P bigint default null, NR_SEQ_CPOE_RECOMEND_P bigint default null, NR_SEQ_CPOE_DIALISE_P bigint default null, NR_SEQ_CPOE_ANAT_PAT_P bigint default null, NR_SEQ_CPOE_GASOTERAPIA_P bigint default null, NR_SEQ_CPOE_HEMOTERAPIA_P bigint default null, NR_SEQ_CPOE_JUST_ITEM_P bigint default null, SI_VALIDATION_TYPE_P text default null, IE_TIPO_ITEM_JUST_P text default null, NR_SEQ_CPOE_JUST_INTER_P bigint default null, NR_SEQ_CPOE_ORDER_UNIT_P bigint default null, NR_SEQ_CPOE_RP_P bigint default null) RETURNS varchar AS $body$
DECLARE

                                    SI_ADDED_W varchar(2);

BEGIN
IF (NR_SEQ_CPOE_MATERIAL_P IS NOT NULL AND NR_SEQ_CPOE_MATERIAL_P::text <> '') THEN
    SELECT    CASE WHEN COUNT(1)=0 THEN 'N'  ELSE 'Y' END
    INTO STRICT    SI_ADDED_W
    FROM (SELECT 1
        FROM    CPOE_COMMENT_LINKAGE
        WHERE    NR_SEQ_CPOE_MATERIAL = NR_SEQ_CPOE_MATERIAL_P
        AND        NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P
		AND		coalesce(SI_VALIDATION_TYPE, 0) = coalesce(SI_VALIDATION_TYPE_P,0)
		AND		coalesce(IE_TIPO_ITEM_JUST, 0) = coalesce(IE_TIPO_ITEM_JUST_P,0)
        
UNION ALL

        SELECT 1
        FROM    CPOE_COMMENT_LINKAGE
        WHERE    coalesce(NR_SEQ_CPOE_MATERIAL::text, '') = ''
        AND        NR_SEQ_CPOE_MATERIAL_TMP = NR_SEQ_CPOE_MATERIAL_P
        AND        NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P
		AND		coalesce(SI_VALIDATION_TYPE, 0) = coalesce(SI_VALIDATION_TYPE_P,0)
		AND		coalesce(IE_TIPO_ITEM_JUST, 0) = coalesce(IE_TIPO_ITEM_JUST_P,0)) alias11;
ELSIF (NR_SEQ_CPOE_PROCED_P IS NOT NULL AND NR_SEQ_CPOE_PROCED_P::text <> '') THEN
    SELECT    CASE WHEN COUNT(1)=0 THEN 'N'  ELSE 'Y' END
    INTO STRICT    SI_ADDED_W
    FROM (SELECT    1
        FROM    CPOE_COMMENT_LINKAGE
        WHERE    NR_SEQ_CPOE_PROCED = NR_SEQ_CPOE_PROCED_P
        AND        NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P
        
UNION ALL

        SELECT    1
        FROM    CPOE_COMMENT_LINKAGE
        WHERE    coalesce(NR_SEQ_CPOE_PROCED::text, '') = ''
        AND        NR_SEQ_CPOE_PROCED_TMP = NR_SEQ_CPOE_PROCED_P
        AND        NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P) alias3;
ELSIF (NR_SEQ_CPOE_NUTRICAO_P IS NOT NULL AND NR_SEQ_CPOE_NUTRICAO_P::text <> '') THEN
    SELECT    CASE WHEN COUNT(1)=0 THEN 'N'  ELSE 'Y' END
    INTO STRICT    SI_ADDED_W
    FROM (SELECT    1
        FROM    CPOE_COMMENT_LINKAGE
        WHERE    NR_SEQ_CPOE_NUTRICAO = NR_SEQ_CPOE_NUTRICAO_P
        AND        NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P
        
UNION ALL

        SELECT    1
        FROM    CPOE_COMMENT_LINKAGE
        WHERE    coalesce(NR_SEQ_CPOE_NUTRICAO::text, '') = ''
        AND        NR_SEQ_CPOE_NUTRICAO_TMP = NR_SEQ_CPOE_NUTRICAO_P
        AND        NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P) alias3;
ELSIF (NR_SEQ_CPOE_RECOMEND_P IS NOT NULL AND NR_SEQ_CPOE_RECOMEND_P::text <> '') THEN
    SELECT CASE WHEN COUNT(1)=0 THEN 'N'  ELSE 'Y' END
    INTO STRICT SI_ADDED_W
    FROM (SELECT 1
        FROM CPOE_COMMENT_LINKAGE
        WHERE NR_SEQ_CPOE_RECOMEND = NR_SEQ_CPOE_RECOMEND_P
        AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P
        
UNION ALL

        SELECT 1
        FROM CPOE_COMMENT_LINKAGE
        WHERE coalesce(NR_SEQ_CPOE_RECOMEND::text, '') = ''
        AND NR_SEQ_CPOE_RECOMEND_TMP = NR_SEQ_CPOE_RECOMEND_P
        AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P) alias3;
ELSIF (NR_SEQ_CPOE_DIALISE_P IS NOT NULL AND NR_SEQ_CPOE_DIALISE_P::text <> '') THEN
    SELECT CASE WHEN COUNT(1)=0 THEN 'N'  ELSE 'Y' END
    INTO STRICT SI_ADDED_W
    FROM (SELECT 1
        FROM CPOE_COMMENT_LINKAGE
        WHERE NR_SEQ_CPOE_DIALISE = NR_SEQ_CPOE_DIALISE_P
        AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P
        
UNION ALL

        SELECT 1
        FROM CPOE_COMMENT_LINKAGE
        WHERE coalesce(NR_SEQ_CPOE_DIALISE::text, '') = ''
        AND NR_SEQ_CPOE_DIALISE_TMP = NR_SEQ_CPOE_DIALISE_P
        AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P) alias3;
ELSIF (NR_SEQ_CPOE_ANAT_PAT_P IS NOT NULL AND NR_SEQ_CPOE_ANAT_PAT_P::text <> '') THEN
    SELECT CASE WHEN COUNT(1)=0 THEN 'N'  ELSE 'Y' END
    INTO STRICT SI_ADDED_W
    FROM (SELECT 1
        FROM CPOE_COMMENT_LINKAGE
        WHERE NR_SEQ_CPOE_ANAT_PAT = NR_SEQ_CPOE_ANAT_PAT_P
        AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P
        
UNION ALL

        SELECT 1
        FROM CPOE_COMMENT_LINKAGE
        WHERE coalesce(NR_SEQ_CPOE_ANAT_PAT::text, '') = ''
        AND NR_SEQ_CPOE_ANAT_PAT_TMP = NR_SEQ_CPOE_ANAT_PAT_P
        AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P) alias3;
 ELSIF (NR_SEQ_CPOE_GASOTERAPIA_P IS NOT NULL AND NR_SEQ_CPOE_GASOTERAPIA_P::text <> '') THEN
    SELECT CASE WHEN COUNT(1)=0 THEN 'N'  ELSE 'Y' END
    INTO STRICT SI_ADDED_W
    FROM (SELECT 1
        FROM CPOE_COMMENT_LINKAGE
        WHERE NR_SEQ_CPOE_GASOTERAPIA = NR_SEQ_CPOE_GASOTERAPIA_P
        AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P
        
UNION ALL

        SELECT 1
        FROM CPOE_COMMENT_LINKAGE
        WHERE coalesce(NR_SEQ_CPOE_GASOTERAPIA::text, '') = ''
        AND NR_SEQ_CPOE_GASOTERAPIA_TMP = NR_SEQ_CPOE_GASOTERAPIA_P
        AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P) alias3;
ELSIF (NR_SEQ_CPOE_HEMOTERAPIA_P IS NOT NULL AND NR_SEQ_CPOE_HEMOTERAPIA_P::text <> '') THEN
    SELECT CASE WHEN COUNT(1)=0 THEN 'N'  ELSE 'Y' END
    INTO STRICT SI_ADDED_W
    FROM (SELECT 1
        FROM CPOE_COMMENT_LINKAGE
        WHERE NR_SEQ_CPOE_HEMOTERAPIA = NR_SEQ_CPOE_HEMOTERAPIA_P
        AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P
        
UNION ALL

        SELECT 1
        FROM CPOE_COMMENT_LINKAGE
        WHERE coalesce(NR_SEQ_CPOE_HEMOTERAPIA::text, '') = ''
        AND NR_SEQ_CPOE_HEMOTERAPIA_TMP = NR_SEQ_CPOE_HEMOTERAPIA_P
        AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P) alias3;
ELSIF (NR_SEQ_CPOE_JUST_ITEM_P IS NOT NULL AND NR_SEQ_CPOE_JUST_ITEM_P::text <> '')THEN
    SELECT CASE WHEN COUNT(1)=0 THEN 'N'  ELSE 'Y' END 
    INTO STRICT SI_ADDED_W
    FROM (SELECT 1
        FROM CPOE_COMMENT_LINKAGE
        WHERE NR_SEQ_CPOE_JUST_ITEM = NR_SEQ_CPOE_JUST_ITEM_P
        AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P
		AND SI_VALIDATION_TYPE = SI_VALIDATION_TYPE_P
		AND IE_TIPO_ITEM_JUST = IE_TIPO_ITEM_JUST_P
        
UNION ALL

        SELECT 1
        FROM CPOE_COMMENT_LINKAGE
        WHERE coalesce(NR_SEQ_CPOE_JUST_ITEM::text, '') = ''
        AND NR_SEQ_CPOE_JUST_ITEM_TMP = NR_SEQ_CPOE_JUST_ITEM_P
        AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P
		AND SI_VALIDATION_TYPE = SI_VALIDATION_TYPE_P
		AND IE_TIPO_ITEM_JUST = IE_TIPO_ITEM_JUST_P) alias3;
ELSIF (NR_SEQ_CPOE_JUST_INTER_P IS NOT NULL AND NR_SEQ_CPOE_JUST_INTER_P::text <> '')THEN
    SELECT CASE WHEN COUNT(1)=0 THEN 'N'  ELSE 'Y' END
    INTO STRICT SI_ADDED_W
    FROM (SELECT 1
        FROM CPOE_COMMENT_LINKAGE
        WHERE NR_SEQ_CPOE_JUST_INTER = NR_SEQ_CPOE_JUST_INTER_p
        AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P
        
UNION ALL

        SELECT 1
        FROM CPOE_COMMENT_LINKAGE
        WHERE coalesce(NR_SEQ_CPOE_JUST_INTER::text, '') = ''
        AND NR_SEQ_CPOE_JUST_INTER_TMP = NR_SEQ_CPOE_JUST_INTER_P
        AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P) alias3;
ELSIF (NR_SEQ_CPOE_ORDER_UNIT_P IS NOT NULL AND NR_SEQ_CPOE_ORDER_UNIT_P::text <> '')THEN
    SELECT CASE WHEN COUNT(1)=0 THEN 'N'  ELSE 'Y' END
    INTO STRICT SI_ADDED_W
    FROM (SELECT 1
        FROM CPOE_COMMENT_LINKAGE
        WHERE NR_SEQ_CPOE_ORDER_UNIT = NR_SEQ_CPOE_ORDER_UNIT_P
        AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P
        
UNION ALL

        SELECT 1
        FROM CPOE_COMMENT_LINKAGE
        WHERE coalesce(NR_SEQ_CPOE_ORDER_UNIT::text, '') = ''
        AND NR_SEQ_CPOE_ORDER_UNIT_TMP = NR_SEQ_CPOE_ORDER_UNIT_P
        AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P) alias3;
ELSIF (NR_SEQ_CPOE_RP_P IS NOT NULL AND NR_SEQ_CPOE_RP_P::text <> '')THEN
    SELECT CASE WHEN COUNT(1)=0 THEN 'N'  ELSE 'Y' END
    INTO STRICT SI_ADDED_W
    FROM (SELECT 1
        FROM CPOE_COMMENT_LINKAGE
        WHERE NR_SEQ_CPOE_RP = NR_SEQ_CPOE_RP_P
        AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P
        
UNION ALL

        SELECT 1
        FROM CPOE_COMMENT_LINKAGE
        WHERE coalesce(NR_SEQ_CPOE_RP::text, '') = ''
        AND NR_SEQ_CPOE_RP_TMP = NR_SEQ_CPOE_RP_P
        AND NR_SEQ_STD_COMMENT = NR_SEQ_STD_COMMENT_P) alias3;
END IF;
RETURN SI_ADDED_W;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION cpoe_get_if_comment_added (NR_SEQ_STD_COMMENT_P bigint, NR_SEQ_CPOE_MATERIAL_P bigint default null, NR_SEQ_CPOE_PROCED_P bigint default null, NR_SEQ_CPOE_NUTRICAO_P bigint default null, NR_SEQ_CPOE_RECOMEND_P bigint default null, NR_SEQ_CPOE_DIALISE_P bigint default null, NR_SEQ_CPOE_ANAT_PAT_P bigint default null, NR_SEQ_CPOE_GASOTERAPIA_P bigint default null, NR_SEQ_CPOE_HEMOTERAPIA_P bigint default null, NR_SEQ_CPOE_JUST_ITEM_P bigint default null, SI_VALIDATION_TYPE_P text default null, IE_TIPO_ITEM_JUST_P text default null, NR_SEQ_CPOE_JUST_INTER_P bigint default null, NR_SEQ_CPOE_ORDER_UNIT_P bigint default null, NR_SEQ_CPOE_RP_P bigint default null) FROM PUBLIC;

