-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_duplic_rg ( cd_pessoa_fisica_p text, nr_rg_p text, ds_orgao_emissor_ci_p text default '') RETURNS varchar AS $body$
DECLARE


qt_rg_w			bigint;
ie_rg_w			varchar(1) := 'N';
ie_forma_consist_w		varchar(15);
cd_estabelecimento_w	smallint := wheb_usuario_pck.get_cd_estabelecimento;
nm_usuario_w		varchar(15) := wheb_usuario_pck.get_nm_usuario;


BEGIN
if (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') and (nr_rg_p IS NOT NULL AND nr_rg_p::text <> '') then
	ie_forma_consist_w := obter_param_usuario(5, 224, obter_perfil_Ativo, nm_usuario_w, cd_estabelecimento_w, ie_forma_consist_w);

	if (coalesce(ie_forma_consist_w,'N') = 'S') then
		select	coalesce(count(*),0)
		into STRICT	qt_rg_w
		from	pessoa_fisica
		where	cd_pessoa_fisica <> cd_pessoa_fisica_p
		and	(nr_identidade IS NOT NULL AND nr_identidade::text <> '')
		and	nr_identidade = nr_rg_p
		and	coalesce(ie_status_usuario_event,'A') <> 'I' /*aaschlote 24/05/2012 OS - 445360*/
;

		if (qt_rg_w > 0) then
			ie_rg_w := 'S';
		end if;
	elsif (coalesce(ie_forma_consist_w,'N') = 'E') then
		select	coalesce(count(*),0)
		into STRICT	qt_rg_w
		from	pessoa_fisica
		where	cd_pessoa_fisica <> cd_pessoa_fisica_p
		and	(nr_identidade IS NOT NULL AND nr_identidade::text <> '')
		and	nr_identidade = nr_rg_p
		and	(ds_orgao_emissor_ci IS NOT NULL AND ds_orgao_emissor_ci::text <> '')
		and	ds_orgao_emissor_ci = ds_orgao_emissor_ci_p
		and	coalesce(ie_status_usuario_event,'A') <> 'I' /*aaschlote 24/05/2012 OS - 445360*/
;

		if (qt_rg_w > 0) then
			ie_rg_w := 'S';
		end if;
	end if;
end if;

return ie_rg_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_duplic_rg ( cd_pessoa_fisica_p text, nr_rg_p text, ds_orgao_emissor_ci_p text default '') FROM PUBLIC;

