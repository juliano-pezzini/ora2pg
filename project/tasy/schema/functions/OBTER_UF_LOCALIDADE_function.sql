-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_uf_localidade (CD_LOCALIDADE_P text) RETURNS varchar AS $body$
DECLARE


DS_RESULTADO_W		CEP_LOC.DS_UF%type;
ie_cep_novo_w		varchar(1);

C01 CURSOR FOR
	SELECT	CD_UNIDADE_FEDERACAO
	FROM	CEP_LOCALIDADE
	WHERE	CD_LOCALIDADE	= CD_LOCALIDADE_P;

C02 CURSOR FOR
	SELECT	DS_UF
	FROM	CEP_LOC
	WHERE	CD_CEP	= CD_LOCALIDADE_P;



BEGIN

if (CD_LOCALIDADE_P IS NOT NULL AND CD_LOCALIDADE_P::text <> '') then

	select	coalesce(vl_parametro, vl_parametro_padrao)
	into STRICT	ie_cep_novo_w
	from	funcao_parametro
	where	cd_funcao	= 0
	and	nr_sequencia	= 25;

	IF (ie_cep_novo_w = 'N') THEN

		BEGIN
		OPEN C01;
		LOOP
		FETCH	C01 INTO DS_RESULTADO_W;
			EXIT WHEN NOT FOUND; /* apply on C01 */
		END LOOP;
		CLOSE C01;

		EXCEPTION
			WHEN OTHERS THEN
				DS_RESULTADO_W	:= '';
		END;

	ELSE
		BEGIN
		OPEN C02;
		LOOP
		FETCH	C02 INTO DS_RESULTADO_W;
			EXIT WHEN NOT FOUND; /* apply on C02 */
		END LOOP;
		CLOSE C02;

		EXCEPTION
			WHEN OTHERS THEN
				DS_RESULTADO_W	:= '';
		END;
	END IF;

end if;

RETURN	DS_RESULTADO_W;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_uf_localidade (CD_LOCALIDADE_P text) FROM PUBLIC;

