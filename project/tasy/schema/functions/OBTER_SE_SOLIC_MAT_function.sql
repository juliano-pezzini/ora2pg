-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_solic_mat ( cd_material_p bigint) RETURNS char AS $body$
DECLARE


ie_retorno_w		char(1) := 'N';
cd_classe_w			classe_material.cd_classe_material%type;
cd_subgrupo_w		subgrupo_material.cd_subgrupo_material%type;
cd_grupo_w			grupo_material.cd_grupo_material%type;
ds_sql_w			varchar(10000);


BEGIN
if (cd_material_p IS NOT NULL AND cd_material_p::text <> '') then

	ds_sql_w	:=
		' select	coalesce(max(''S''),''N'') ' ||
		' from		medic_liberacao_solic ' ||
		' where		rownum = 1 ';

	if (cd_material_p > 0) then
		ds_sql_w	:=	ds_sql_w || ' and		nvl(cd_material,' || cd_material_p || ') = ' || cd_material_p || ' ';

		select	max(cd_classe_material)
		into STRICT	cd_classe_w
		from	material
		where	cd_material = cd_material_p;

		if (cd_classe_w IS NOT NULL AND cd_classe_w::text <> '') then
			ds_sql_w	:=	ds_sql_w || ' and		nvl(cd_classe_material,' || cd_classe_w || ') = ' || cd_classe_w || ' ';

			select	max(cd_subgrupo_material)
			into STRICT	cd_subgrupo_w
			from	classe_material
			where	cd_classe_material = cd_classe_w;

			if (cd_subgrupo_w IS NOT NULL AND cd_subgrupo_w::text <> '') then
				ds_sql_w	:=	ds_sql_w || ' and		nvl(cd_subgrupo_material,' || cd_subgrupo_w || ') = ' || cd_subgrupo_w || ' ';

				select	max(cd_grupo_material)
				into STRICT	cd_grupo_w
				from	subgrupo_material
				where	cd_subgrupo_material = cd_subgrupo_w;

				if (cd_grupo_w IS NOT NULL AND cd_grupo_w::text <> '') then
					ds_sql_w	:=	ds_sql_w || ' and		nvl(cd_grupo_material,' || cd_grupo_w || ') = ' || cd_grupo_w || ' ';
				else
					ds_sql_w	:=	ds_sql_w || ' and		cd_grupo_material is null ';
				end if;
			else
				ds_sql_w	:=	ds_sql_w || ' and		cd_subgrupo_material is null ';
			end if;
		else
			ds_sql_w	:=	ds_sql_w || ' and		cd_classe_material is null ';
		end if;
	else
		ds_sql_w	:=	ds_sql_w || ' and		cd_material is null ';
	end if;

	EXECUTE ds_sql_w into STRICT ie_retorno_w;

end if;

return ie_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_solic_mat ( cd_material_p bigint) FROM PUBLIC;

