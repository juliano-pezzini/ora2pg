-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION ptu_obter_dados_cabecalho_v60 ( nr_seq_transacao_p bigint, ie_tipo_transacao_p bigint, ie_campo_p text) RETURNS varchar AS $body$
DECLARE

							
/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
-------------------------------------------------------------------------------------------------------------------

Locais de chamada direta: 
[  ]  Objetos do dicionario [ ] Tasy (Delphi/Java) [  x ] Portal [  ]  Relatorios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------

Pontos de atencao: 
Codigo dos pedidos para saber como montar o cabecalho

1 - Pedido autorizacao
2 - Resposta pedido autorizacao
3 - Pedido de complemento de autorizacao
4 - Resposta pedido complemento autorizacao
5 - Pedido de insistencia
6 - Confirmacao insistencia
7 -  Respota auditoria
8 - Confirmacao resposta auditoria
9 - Cancelamento
10 - Confirmacao cancelamento
11 - Status da Transacao  
12 - Resposta de Status da Transacao 
13 - Comunicacao de Decurso de Prazo  
14 - Confirmacao decurso prazo
15 - Ordem de Servico
16 - Resposta de Ordem de Servico 
17 - Autorizacao de Ordem de Servico 
18 - Confirmacao  autorizacao Ordem de Servico
30 - Consulta dados beneficiario
31- Resposta consulta dados beneficiario
32 - Consutla dados prestador
33 - Resposta consulta dados prestador
34 - Requisicao Contagem Benef.     
35 - Resposta Contagem Benef. 

50 - A1100
51 - A1100 - Resposta


Transacoes
<!-- 00600 - Pedido de Autorizacao -->
<!-- 00605 - Pedido de Complemento de Autorizacao -->
<!-- 00501 - Resposta de Pedido de Autorizacao -->
<!-- 00302 - Pedido de Insistencia -->
<!-- 00309 - Confirmacao -->
<!-- 00404 - Resposta de Auditoria -->
<!-- 00311 - Cancelamento -->
<!-- 00360 - Status da Transacao -->
<!-- 00361 - Resposta do Status da Transacao -->
<!-- 00700 - Comunicacao de Decurso de Prazo -->
<!-- 00806 - Ordem de Servico -->
<!-- 00807 - Resposta de Ordem de Servico -->
<!-- 00804 - Autorizacao de Ordem de Servico -->



<!-- 00412 - Consulta de Dados do Beneficiario -->
<!-- 00413 - Resposta de Consulta de Dados do Beneficiario -->
<!-- 00418 - Consulta Dados do Prestador-->
<!-- 00419 - Resposta de Consulta de Dados do Prestador-->
<!-- 00310 - Erro Inesperado -->
<!-- 00430 - Requisicao de Contagem de Beneficiarios -->
<!-- 00431 - Resposta de Requisicao de Contagem de Beneficiarios -->



<!-- 01100 - Consultas transacoes Respondidas pelo WSD  -->
<!-- 01101 - Resposta da Consultas transacoes Respondidas pelo WSD -->

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
			

ds_retorno_w			varchar(255);
cd_transacao_w			varchar(10);
cd_unimed_executora_w		varchar(30);
cd_unimed_beneficiario_w	varchar(30);
ie_tipo_cliente_w		varchar(10);
cd_cgc_outorgante_w		pls_outorgante.cd_cgc_outorgante%type;
cd_cooperativa_w		pls_congenere.cd_cooperativa%type;



BEGIN

-- 1 - Pedido autorizacao
if ( ie_tipo_transacao_p = 1  ) then	
	select	'00600',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_pedido_autorizacao
	where	nr_sequencia = nr_seq_transacao_p;	
	
	
--2 - Resposta pedido autorizacao ou  4 - Resposta pedido complemento autorizacao
elsif ( ie_tipo_transacao_p = 2 or ie_tipo_transacao_p = 4  ) then	
	select	'00501',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_resposta_autorizacao
	where	nr_sequencia = nr_seq_transacao_p;	
	
--3 - Pedido de complemento de autorizacao
elsif ( ie_tipo_transacao_p = 3  ) then	
	select	'00605',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_pedido_compl_aut
	where	nr_sequencia = nr_seq_transacao_p;
	
--5 - Pedido de insistencia
elsif ( ie_tipo_transacao_p = 5  ) then	
	select	'00302',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_pedido_insistencia
	where	nr_sequencia = nr_seq_transacao_p;
	
--6 - Confirmacao insistencia  	8 - Confirmacao resposta auditoria   10 - Confirmacao cancelamento

--14 - Confirmacao decurso prazo  	18 - Confirmacao  autorizacao Ordem de Servico
elsif ( ie_tipo_transacao_p = 6  ) then
	select	'00309',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_confirmacao
	where	nr_sequencia = nr_seq_transacao_p;
	
--7 -  Respota auditoria
elsif ( ie_tipo_transacao_p = 7  ) then
	select	'00404',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_resposta_auditoria
	where	nr_sequencia = nr_seq_transacao_p;	

--9 - Cancelamento
elsif ( ie_tipo_transacao_p = 9  ) then
	select	'00311',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_cancelamento
	where	nr_sequencia = nr_seq_transacao_p;
	
--11 - Status da Transacao
elsif ( ie_tipo_transacao_p = 11  ) then
	select	'00360',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_pedido_status
	where	nr_sequencia = nr_seq_transacao_p;
	
--12 - Resposta de Status da Transacao 
elsif ( ie_tipo_transacao_p = 12 ) then
	select	'00361',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_resp_pedido_status
	where	nr_sequencia = nr_seq_transacao_p;

--13 - Comunicacao de Decurso de Prazo  
elsif ( ie_tipo_transacao_p = 13 ) then
	select	'00700',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_decurso_prazo
	where	nr_sequencia = nr_seq_transacao_p;

--15 - Ordem de Servico
elsif ( ie_tipo_transacao_p = 15 ) then
	select	'00806',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_requisicao_ordem_serv
	where	nr_sequencia = nr_seq_transacao_p;

--16 - Resposta de Ordem de Servico 
elsif ( ie_tipo_transacao_p = 16 ) then
	select	'00807',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_resposta_req_ord_serv
	where	nr_sequencia = nr_seq_transacao_p;
	
--17 - Autorizacao de Ordem de Servico 
elsif ( ie_tipo_transacao_p = 17 ) then
	select	'00804',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_autorizacao_ordem_serv
	where	nr_sequencia = nr_seq_transacao_p;
	
--30 - Consulta dados beneficiario	
elsif ( ie_tipo_transacao_p = 30 ) then
	select	'00412',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_consulta_beneficiario
	where	nr_sequencia = nr_seq_transacao_p;
	
--31- Resposta consulta dados beneficiario
elsif ( ie_tipo_transacao_p = 31 ) then
	select	'00413',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_resp_consulta_benef
	where	nr_sequencia = nr_seq_transacao_p;
	
--32 - Consulta dados prestador
elsif ( ie_tipo_transacao_p = 32 ) then
	select	'00418',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_consulta_prestador
	where	nr_sequencia = nr_seq_transacao_p;

--33 - Resposta consulta dados prestador
elsif ( ie_tipo_transacao_p = 33 ) then
	select	'00419',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_resp_consulta_prest
	where	nr_sequencia = nr_seq_transacao_p;	

--34 - Requisicao Contagem Benef
elsif ( ie_tipo_transacao_p = 35 ) then
	select	'00431',
		cd_unimed_destino,
		cd_unimed_requisitante,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_beneficiario_w,
		cd_unimed_executora_w,
		ie_tipo_cliente_w
	from	ptu_resp_contagem_benef
	where	nr_sequencia = nr_seq_transacao_p;
	
-- 50, 51 - A1100 e A1101 - Resposta
elsif ( ie_tipo_transacao_p in (36,37) ) then
	
	cd_unimed_executora_w 		:= null;
	cd_unimed_beneficiario_w	:= null;
	
	select	max(cd_cgc_outorgante)
	into STRICT	cd_cgc_outorgante_w
	from	pls_outorgante;

	select	max(cd_cooperativa)
	into STRICT	cd_cooperativa_w
	from	pls_congenere
	where	cd_cgc			= cd_cgc_outorgante_w
	and	(cd_cooperativa IS NOT NULL AND cd_cooperativa::text <> '');

	select	'01100',
		'UNIMED' ie_tipo_cliente
	into STRICT	cd_transacao_w,
		ie_tipo_cliente_w
	;
elsif ( ie_tipo_transacao_p = 38 ) then
	select	'00750',
		cd_unimed_executora,
		cd_unimed_beneficiario,
		CASE WHEN ie_tipo_cliente='P' THEN 'PORTAL' WHEN ie_tipo_cliente='R' THEN 'PRESTADOR'  ELSE 'UNIMED' END  ie_tipo_cliente
	into STRICT	cd_transacao_w,
		cd_unimed_executora_w,
		cd_unimed_beneficiario_w,
		ie_tipo_cliente_w
	from	ptu_comunicacao_internacao
	where	nr_sequencia = nr_seq_transacao_p;
end if;

--Tipo de transacao que sera gerada no XML
if ( ie_campo_p = 'TT' ) then
	ds_retorno_w := cd_transacao_w;			
--Codigo unimed executora
elsif ( ie_campo_p = 'CDUE' 	 ) then
	ds_retorno_w := cd_unimed_executora_w;	
--Codigo unimed do beneficiario
elsif ( ie_campo_p = 'CDUB' 	 ) then
	ds_retorno_w := cd_unimed_beneficiario_w;
--Codigo tipo cliente
elsif ( ie_campo_p = 'CTC' 	 ) then
	ds_retorno_w := ie_tipo_cliente_w;
--Codigo unimed solicitante
elsif ( ie_campo_p = 'CDUS'	) then
	ds_retorno_w := cd_cooperativa_w;
	
end if;		


return	ds_retorno_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION ptu_obter_dados_cabecalho_v60 ( nr_seq_transacao_p bigint, ie_tipo_transacao_p bigint, ie_campo_p text) FROM PUBLIC;

