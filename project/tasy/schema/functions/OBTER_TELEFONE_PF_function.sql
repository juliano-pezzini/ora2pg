-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_telefone_pf (cd_pessoa_fisica_p text, ie_tipo_telefone_p bigint) RETURNS varchar AS $body$
DECLARE




ds_telefone_w		varchar(255);



/*

Tipos

	1 - Residencial

	2 - Comercial

	7 - Bip/Pager

	8 - Comercial

	9 - Contato

	10 -Contato com DDD

	0 - Celular (cadastro pessoa f√≠sica) - Rafael em 30/10/2006 OS43519

	11- Fax

	12- DDD / Celular

	13- DDD / Residencial

*/
BEGIN



IF (ie_tipo_telefone_p = 1) THEN

	BEGIN

	SELECT	MAX(p.nr_telefone)

	INTO STRICT	ds_telefone_w

	FROM	compl_pessoa_fisica p

	WHERE	p.cd_pessoa_fisica = cd_pessoa_fisica_p

	AND	p.ie_tipo_complemento = 1;

	END;



ELSIF (ie_tipo_telefone_p = 2) THEN

	BEGIN

	SELECT	MAX(p.nr_telefone)

	INTO STRICT	ds_telefone_w

	FROM	compl_pessoa_fisica p

	WHERE	p.cd_pessoa_fisica = cd_pessoa_fisica_p

	AND	p.ie_tipo_complemento = 2;

	END;

ELSIF (ie_tipo_telefone_p = 4) THEN

	BEGIN

	SELECT	MAX(CASE WHEN coalesce(p.NR_DDD_TELEFONE::text, '') = '' THEN ''  ELSE '('||p.NR_DDD_TELEFONE||') ' END ) || MAX(p.nr_telefone)

	INTO STRICT	ds_telefone_w

	FROM	compl_pessoa_fisica p

	WHERE	p.cd_pessoa_fisica = cd_pessoa_fisica_p

	AND	p.ie_tipo_complemento = 1;

	END;



ELSIF (ie_tipo_telefone_p = 5) THEN

	BEGIN

	SELECT	MAX(CASE WHEN coalesce(p.NR_DDD_TELEFONE::text, '') = '' THEN ''  ELSE '('||p.NR_DDD_TELEFONE||') ' END ) || MAX(p.nr_telefone)

	INTO STRICT	ds_telefone_w

	FROM	compl_pessoa_fisica p

	WHERE	p.cd_pessoa_fisica = cd_pessoa_fisica_p

	AND	p.ie_tipo_complemento = 2;

	END;

ELSIF (ie_tipo_telefone_p = 8) THEN

	BEGIN

	SELECT	MAX(p.nr_ramal)

	INTO STRICT	ds_telefone_w

	FROM	compl_pessoa_fisica p

	WHERE	p.cd_pessoa_fisica = cd_pessoa_fisica_p

	AND	p.ie_tipo_complemento = 2;

	END;





ELSIF (ie_tipo_telefone_p = 9) THEN

	BEGIN

	SELECT	MAX(nr_telefone_celular)

	INTO STRICT	ds_telefone_w

	FROM	pessoa_fisica

	WHERE	cd_pessoa_fisica = cd_pessoa_fisica_p;

	END;

ELSIF (ie_tipo_telefone_p = 10) THEN

	BEGIN

	SELECT	MAX(CASE WHEN coalesce(NR_DDD_CELULAR::text, '') = '' THEN ''  ELSE '('||NR_DDD_CELULAR||') ' END ) || MAX(NR_TELEFONE_CELULAR)

	INTO STRICT	ds_telefone_w

	FROM	pessoa_fisica

	WHERE	cd_pessoa_fisica = cd_pessoa_fisica_p;

	END;

ELSIF (ie_tipo_telefone_p = 7) THEN

	BEGIN

	SELECT	MAX(nr_pager_bip)

	INTO STRICT	ds_telefone_w

	FROM	pessoa_fisica

	WHERE	cd_pessoa_fisica = cd_pessoa_fisica_p;

	END;



ELSIF (ie_tipo_telefone_p = 0) THEN

	BEGIN

	SELECT	MAX(nr_telefone_celular)

	INTO STRICT	ds_telefone_w

	FROM	pessoa_fisica

	WHERE	cd_pessoa_fisica = cd_pessoa_fisica_p;

	END;



ELSIF (ie_tipo_telefone_p = 11) THEN

	BEGIN

	SELECT	MAX(CASE WHEN coalesce(p.NR_DDD_FAX::text, '') = '' THEN ''  ELSE '('||p.NR_DDD_FAX||')' END ) || MAX(p.ds_fax)

	INTO STRICT	ds_telefone_w

	FROM	compl_pessoa_fisica p

	WHERE	p.cd_pessoa_fisica = cd_pessoa_fisica_p

	AND	p.ie_tipo_complemento = 1;

	END;


ELSIF (ie_tipo_telefone_p = 12) THEN

	BEGIN

	SELECT	CASE WHEN coalesce(MAX(NR_DDD_CELULAR)::text, '') = '' THEN  MAX(nr_telefone_celular)  ELSE '(' || MAX(NR_DDD_CELULAR) || ') ' || MAX(nr_telefone_celular) END

	INTO STRICT	ds_telefone_w

	FROM	pessoa_fisica

	WHERE	cd_pessoa_fisica = cd_pessoa_fisica_p;

	END;


ELSIF (ie_tipo_telefone_p = 13) THEN

	BEGIN

	SELECT	CASE WHEN coalesce(MAX(NR_DDD_TELEFONE)::text, '') = '' THEN  MAX(nr_telefone)  ELSE '(' || MAX(NR_DDD_TELEFONE) || ')' || MAX(nr_telefone) END

	INTO STRICT	ds_telefone_w

	FROM	compl_pessoa_fisica p

	WHERE	p.cd_pessoa_fisica = cd_pessoa_fisica_p

	AND	p.ie_tipo_complemento = 1;

	END;



END IF;



RETURN ds_telefone_w;



END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_telefone_pf (cd_pessoa_fisica_p text, ie_tipo_telefone_p bigint) FROM PUBLIC;

