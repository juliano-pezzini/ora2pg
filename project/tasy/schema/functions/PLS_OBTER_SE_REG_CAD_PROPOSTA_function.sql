-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_se_reg_cad_proposta ( nr_seq_proposta_p bigint, ds_campo_p text) RETURNS varchar AS $body$
DECLARE


/*
ds_campo_p
NOME,
DT_NASCIMENTO,
NACIONALIDADE,
NATURALIDADE,
CERT_NASC,
RG,
UF_RG,
DT_EMISSAO_RG,
ORGAO_EMISSOR,
PAIS_EMISSOR,
CPF,
CEP,
DS_ENDERECO_COMPL
DS_MUNICIPIO,
ESTADO,
NR_TEL,
NR_CEL,
NM_MAE,
NM_PAI,
CNS,
EMAIL,
IE_REVISAR
*/
ds_retorno_w		varchar(255);
nome_w			varchar(10);
dt_nascimento_w		varchar(10);
nacionalidade_w		varchar(10);
naturalidade_w		varchar(10);
cert_nasc_w		varchar(10);
rg_w			varchar(10);
uf_rg_w			valor_dominio.vl_dominio%type;
dt_emissao_rg_w		varchar(10);
orgao_emissor_w		varchar(10);
pais_emissor_w		varchar(10);
cpf_w		 	varchar(10);
cep_w			varchar(10);
ds_endereco_compl_w	varchar(10);
ds_municipio_w		varchar(10);
estado_w		valor_dominio.vl_dominio%type;
NR_TEL_w		varchar(10);
nr_cel_w		varchar(10);
Nm_mae_w		varchar(10);
nm_pai_w		varchar(10);
cns_w			varchar(10);
email_w			varchar(10);
IE_REVISAO_W		varchar(10);
espaco_vazio_w		varchar(10) := '      ';


C01 CURSOR FOR
	SELECT	CASE WHEN coalesce(b.NM_PESSOA_FISICA::text, '') = '' THEN '  '  ELSE 'X' END  nome,
		CASE WHEN coalesce(b.dt_nascimento::text, '') = '' THEN '  '  ELSE 'X' END  dt_nascimento,
		CASE WHEN coalesce(b.cd_nacionalidade::text, '') = '' THEN '  '  ELSE 'X' END  nacionalidade,
		CASE WHEN coalesce(b.nr_cep_cidade_nasc::text, '') = '' THEN '  '  ELSE 'X' END  naturalidade,
		CASE WHEN coalesce(b.nr_cert_nasc::text, '') = '' THEN '  '  ELSE 'X' END  cert_nasc,
		CASE WHEN coalesce(b.nr_identidade::text, '') = '' THEN '  '  ELSE 'X' END  rg,
		CASE WHEN coalesce(b.sg_emissora_ci::text, '') = '' THEN '  '  ELSE 'X' END  uf_rg,
		CASE WHEN coalesce(b.dt_emissao_ci::text, '') = '' THEN '  '  ELSE 'X' END  dt_emissao_rg,
		CASE WHEN coalesce(b.DS_ORGAO_EMISSOR_CI::text, '') = '' THEN '  '  ELSE 'X' END  orgao_emissor,
		CASE WHEN coalesce(b.nr_seq_pais::text, '') = '' THEN '  '  ELSE 'X' END  pais_emissor,
		CASE WHEN coalesce(b.nr_cpf::text, '') = '' THEN '  '  ELSE 'X' END  cpf,
		CASE WHEN a.cd_cep='' THEN '  '  ELSE CASE WHEN a.ds_endereco='' THEN '  '  ELSE CASE WHEN coalesce(a.nr_endereco::text, '') = '' THEN '  '  ELSE CASE WHEN a.ds_bairro='' THEN '  '  ELSE 'X' END  END  END  END ,
		CASE WHEN coalesce(a.ds_municipio::text, '') = '' THEN '  '  ELSE 'X' END  ds_municipio,
		CASE WHEN coalesce(a.SG_ESTADO::text, '') = '' THEN '  '  ELSE 'X' END  estado,
		CASE WHEN coalesce(a.NR_TELEFONE::text, '') = '' THEN '  '  ELSE 'X' END  NR_TEL,
		CASE WHEN coalesce(a.nr_telefone_celular::text, '') = '' THEN '  '  ELSE 'X' END  nr_cel,
		CASE WHEN coalesce(b.nr_cartao_nac_sus::text, '') = '' THEN '  '  ELSE 'X' END  cns,
		CASE WHEN coalesce(a.ds_email::text, '') = '' THEN '  '  ELSE 'X' END  email,
		CASE WHEN trim(both substr(OBTER_NOME_CONTATO(b.cd_pessoa_fisica,5),1,255)) IS NULL THEN '  '  ELSE 'X' END  nm_mae,
		CASE WHEN trim(both substr(OBTER_NOME_CONTATO(b.cd_pessoa_fisica,4),1,255)) IS NULL THEN '  '  ELSE 'X' END  nm_pai,
		b.IE_REVISAR
	from	pls_proposta_beneficiario	c,
		pessoa_fisica			b,
		compl_pessoa_fisica		a
	where	a.cd_pessoa_fisica	= b.cd_pessoa_fisica
	and	c.cd_beneficiario	= b.cd_pessoa_fisica
	and	c.nr_seq_proposta	= nr_seq_proposta_p
	and	a.ie_tipo_complemento = 1
	and	coalesce(c.dt_cancelamento::text, '') = '';


BEGIN

open C01;
loop
fetch C01 into
	nome_w,
	dt_nascimento_w,
	nacionalidade_w,
	naturalidade_w,
	cert_nasc_w,
	rg_w,
	uf_rg_w,
	dt_emissao_rg_w,
	orgao_emissor_w,
	pais_emissor_w,
	cpf_w,
	ds_endereco_compl_w,
	ds_municipio_w,
	estado_w,
	NR_TEL_w,
	nr_cel_w,
	cns_w,
	email_w,
	Nm_mae_w,
	nm_pai_w,
	IE_REVISAO_W;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin

	if (ds_campo_p = 'NOME') then
		ds_retorno_w	:= ds_retorno_w || espaco_vazio_w || nome_w;
	elsif (ds_campo_p = 'DT_NASCIMENTO') then
		ds_retorno_w	:= ds_retorno_w || espaco_vazio_w || dt_nascimento_w;
	elsif (ds_campo_p = 'NACIONALIDADE') then
		ds_retorno_w	:= ds_retorno_w || espaco_vazio_w || nacionalidade_w;
	elsif (ds_campo_p = 'NATURALIDADE') then
		ds_retorno_w	:= ds_retorno_w || espaco_vazio_w || naturalidade_w;
	elsif (ds_campo_p = 'CERT_NASC') then
		ds_retorno_w	:= ds_retorno_w || espaco_vazio_w || cert_nasc_w;
	elsif (ds_campo_p = 'RG') then
		ds_retorno_w	:= ds_retorno_w || espaco_vazio_w || rg_w;
	elsif (ds_campo_p = 'UF_RG') then
		ds_retorno_w	:= ds_retorno_w || espaco_vazio_w ||uf_rg_w;
	elsif (ds_campo_p = 'DT_EMISSAO_RG') then
		ds_retorno_w	:= ds_retorno_w || espaco_vazio_w || dt_emissao_rg_w;
	elsif (ds_campo_p = 'ORGAO_EMISSOR') then
		ds_retorno_w	:= ds_retorno_w ||espaco_vazio_w|| orgao_emissor_w;
	elsif (ds_campo_p = 'PAIS_EMISSOR') then
		ds_retorno_w	:= ds_retorno_w || espaco_vazio_w || pais_emissor_w;
	elsif (ds_campo_p = 'CPF') then
		ds_retorno_w	:= ds_retorno_w ||espaco_vazio_w || cpf_w;
	elsif (ds_campo_p = 'CEP') then
		ds_retorno_w	:= ds_retorno_w ||espaco_vazio_w|| cep_w;
	elsif (ds_campo_p = 'DS_ENDERECO_COMPL') then
		ds_retorno_w	:= ds_retorno_w || espaco_vazio_w || ds_endereco_compl_w;
	elsif (ds_campo_p = 'DS_MUNICIPIO') then
		ds_retorno_w	:= ds_retorno_w || espaco_vazio_w|| ds_municipio_w;
	elsif (ds_campo_p = 'ESTADO') then
		ds_retorno_w	:= ds_retorno_w || espaco_vazio_w || estado_w;
	elsif (ds_campo_p = 'NR_TEL') then
		ds_retorno_w	:= ds_retorno_w || espaco_vazio_w || NR_TEL_w;
	elsif (ds_campo_p = 'NR_CEL') then
		ds_retorno_w	:= ds_retorno_w || espaco_vazio_w || nr_cel_w;
	elsif (ds_campo_p = 'NM_CONTATO') then
		ds_retorno_w	:= ds_retorno_w || espaco_vazio_w || nome_w;
	elsif (ds_campo_p = 'CNS') then
		ds_retorno_w	:= ds_retorno_w || espaco_vazio_w || cns_w;
	elsif (ds_campo_p = 'EMAIL') then
		ds_retorno_w	:= ds_retorno_w || espaco_vazio_w || email_w;
	elsif (ds_campo_p = 'NM_MAE') then
		ds_retorno_w	:= ds_retorno_w || espaco_vazio_w || Nm_mae_w;
	elsif (ds_campo_p = 'NM_PAI') then
		ds_retorno_w	:= ds_retorno_w || espaco_vazio_w || Nm_PAI_w;
	elsif (ds_campo_p = 'IE_REVISAR') then
		ds_retorno_w	:= ds_retorno_w ||espaco_vazio_w || IE_REVISAO_W;
	end if;
	end;
end loop;
close C01;


return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_se_reg_cad_proposta ( nr_seq_proposta_p bigint, ds_campo_p text) FROM PUBLIC;

