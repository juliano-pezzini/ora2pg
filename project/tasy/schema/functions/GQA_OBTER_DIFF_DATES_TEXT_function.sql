-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION gqa_obter_diff_dates_text (date1_p timestamp, date2_p timestamp, tipo_p text) RETURNS varchar AS $body$
DECLARE


ds_retorno_w          varchar(100) := null;
str_hora          varchar(20);
str_minuto        varchar(20);
str_dia          varchar(20);

int_dia          bigint;
int_hora          bigint;
int_minuto        bigint;

diff double precision;

BEGIN
  if (coalesce(date1_p::text, '') = '' or coalesce(date2_p::text, '') = '' or coalesce(tipo_p::text, '') = '') then
    return null;
  end if;

  str_dia := obter_desc_expressao(500514);
  str_hora := obter_desc_expressao(487631);
  str_minuto := obter_desc_expressao(883687);

  if (tipo_p = 'DHM') then --DIAS, HORAS e MINUTOS apenas 
    select
           trunc(difference                     ) as days,
           trunc(mod( difference * 24,       24)) as hours,
           trunc(mod( difference * 24 * 60,  60)) as minutes
    into STRICT 
            int_dia,
            int_hora,
            int_minuto
    from (SELECT abs(date1_p - date2_p) as difference ) alias7;

    int_dia := coalesce(int_dia, 0);
    int_hora := coalesce(int_hora, 0);
    int_minuto := coalesce(int_minuto, 0);

    if (int_dia > 0) then
      ds_retorno_w :=  ds_retorno_w || TO_CHAR(int_dia) || str_dia || ' ';
    end if;
    if (int_dia > 0 or int_hora > 0) then
      ds_retorno_w :=  ds_retorno_w || TO_CHAR(int_hora) || str_hora || ' ';
    end if;

    ds_retorno_w :=  ds_retorno_w || TO_CHAR(int_minuto) || str_minuto || ' ';
  end if;

  return ds_retorno_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION gqa_obter_diff_dates_text (date1_p timestamp, date2_p timestamp, tipo_p text) FROM PUBLIC;

