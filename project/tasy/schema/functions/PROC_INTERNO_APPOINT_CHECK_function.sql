-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION proc_interno_appoint_check ( nr_seq_proc_interno_p bigint, pre_cons_validacao_p text default null) RETURNS varchar AS $body$
DECLARE




pre_cons_w varchar(1) := 'N';
exam_schedule_w varchar(1) := 'S';
cons_schedule_w varchar(1) := 'S';
return_w varchar(1) := 'N';




BEGIN

 

if ((nr_seq_proc_interno_p IS NOT NULL AND nr_seq_proc_interno_p::text <> '') and pre_cons_validacao_p = 'S') then

 

    select    coalesce(max('S'), 'N')
    into STRICT    pre_cons_w
    from    proc_interno a,
        proc_interno_classif b
    where    a.nr_seq_classif = b.nr_sequencia
    and    a.nr_sequencia = nr_seq_proc_interno_p
    and    a.ie_situacao = 'A'
    and    b.ie_pre_cons_exam_classif = 'S';

    select    coalesce(max('S'), 'N')
    into STRICT    exam_schedule_w
    from    agenda a,
        agenda_regra b
    where    a.cd_agenda = b.cd_agenda
    and    a.ie_situacao = 'A'
    and    b.nr_seq_proc_interno = nr_seq_proc_interno_p;



    if (exam_schedule_w = 'N') then
    
        select    coalesce(max('S'), 'N')
        into STRICT    cons_schedule_w
        from    agenda a,
            agenda_cons_regra_proc b
        where    a.cd_agenda = b.cd_agenda
        and    a.ie_situacao = 'A'
        and    b.nr_seq_proc_interno = nr_seq_proc_interno_p;

    end if;

    if (pre_cons_w = 'S'
        and exam_schedule_w = 'N'
        and cons_schedule_w = 'N') then
        
        return_w := 'S';

    end if;

elsif ((nr_seq_proc_interno_p IS NOT NULL AND nr_seq_proc_interno_p::text <> '') and coalesce(pre_cons_validacao_p::text, '') = '') then

 

    select    coalesce(max('S'), 'N')
    into STRICT    return_w
    from    agenda a,
        agenda_regra b
    where    a.cd_agenda = b.cd_agenda
    and    a.ie_situacao = 'A'
    and    b.nr_seq_proc_interno = nr_seq_proc_interno_p;



    if (return_w = 'N') then
    
        select    coalesce(max('S'), 'N')
        into STRICT    return_w
        from    agenda a,
            agenda_cons_regra_proc b
        where    a.cd_agenda = b.cd_agenda
        and    a.ie_situacao = 'A'
        and    b.nr_seq_proc_interno = nr_seq_proc_interno_p;

    end if;
end if;
return return_w;
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION proc_interno_appoint_check ( nr_seq_proc_interno_p bigint, pre_cons_validacao_p text default null) FROM PUBLIC;

