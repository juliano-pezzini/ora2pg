-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_vl_orcamento_markt (ie_tipo_markt_p text, dt_inicio_p timestamp, dt_fim_p timestamp) RETURNS bigint AS $body$
DECLARE

vl_orcado_w	double precision;

BEGIN

if (ie_tipo_markt_p = 'M') then
	select	sum(a.vl_realizado)
	into STRICT	vl_orcado_w
	from	ctb_orcamento a
	where	a.cd_centro_custo in (13)
	AND		cd_conta_contabil IN (2844, 2852, 2895, 3133, 1060, 1713, 1873, 3049, 2950, 3272, 1822, 1879, 1867, 3050, 1820, 3042, 1874, 3018, 3000, 3026, 3034, 3134, 3093, 2925, 3115, 1870, 1875, 3698, 1895, 1899, 3514, 3247, 3255, 3271, 3298, 3360, 3361, 3362, 3363, 1872, 3138, 3139, 1881, 2909, 3077, 3085, 3069)
	and		a.nr_seq_mes_ref in (SELECT b.nr_sequencia
								from   ctb_mes_ref b
								where  b.dt_referencia between inicio_dia(dt_inicio_p) and fim_dia(dt_fim_p));

	else if (ie_tipo_markt_p = 'E') then
		select	sum(a.vl_realizado)
		into STRICT	vl_orcado_w
		from	ctb_orcamento a
		where	a.cd_centro_custo in (213)
		AND		cd_conta_contabil IN (2844, 2852, 2895, 3133, 1060, 1713, 1873, 3049, 2950, 3272, 1822, 1879, 1867, 3050, 1820, 3042, 1874, 3018, 3000, 3026, 3034, 3134, 3093, 2925, 3115, 1870, 1875, 3698, 1895, 1899, 3514, 3247, 3255, 3271, 3298, 3360, 3361, 3362, 3363, 1872, 3138, 3139, 1881, 2909, 3077, 3085, 3069)
		and		a.nr_seq_mes_ref in (SELECT b.nr_sequencia
									from   ctb_mes_ref b
									where  b.dt_referencia between inicio_dia(dt_inicio_p) and fim_dia(dt_fim_p));
	end if;

end if;

if (coalesce(vl_orcado_w::text, '') = '') then
	vl_orcado_w := 0;
end if;

return	vl_orcado_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_vl_orcamento_markt (ie_tipo_markt_p text, dt_inicio_p timestamp, dt_fim_p timestamp) FROM PUBLIC;

