-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION consiste_med_corpo_cli ( nr_prescricao_p bigint) RETURNS varchar AS $body$
DECLARE




cd_procedimento_w	bigint;

cd_medico_exec_w		varchar(10);

ds_resultado_w		varchar(2500);

ie_origem_proced_w	bigint;



C01 CURSOR FOR

SELECT	cd_procedimento,

	ie_origem_proced,

	cd_medico_exec

from	prescr_procedimento

where 	nr_prescricao = nr_prescricao_p

and	ie_suspenso = 'N';




BEGIN

ds_resultado_w	:= ' ';



open C01;

loop

	fetch C01 into	cd_procedimento_w,

			ie_origem_proced_w,

			cd_medico_exec_w;

	EXIT WHEN NOT FOUND; /* apply on C01 */

	if (obter_se_medico(cd_medico_exec_w,'C') = 'N') and (cd_medico_exec_w > '0') and (length(ds_resultado_w) < 1800) then

		ds_resultado_w	:=	ds_resultado_w||chr(10) ||

					substr(obter_descricao_procedimento(cd_procedimento_w,ie_origem_proced_w),1,80);

	end if;

end loop;

close c01;



if (ds_resultado_w <> ' ') then

  ds_resultado_w :=	wheb_mensagem_pck.get_texto(1042788)|| chr(10) ||' : ' || chr(10) || ds_resultado_w||chr(10);

end if;



return ds_resultado_w;



end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION consiste_med_corpo_cli ( nr_prescricao_p bigint) FROM PUBLIC;

