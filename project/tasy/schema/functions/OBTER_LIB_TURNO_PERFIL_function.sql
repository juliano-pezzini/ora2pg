-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_lib_turno_perfil (cd_perfil_p bigint, cd_tipo_ocorrencia_p text) RETURNS varchar AS $body$
DECLARE


ds_retorno_w		varchar(1);
qt_reg_tipo_oco_w	integer;
qt_registros_perfil_w	integer;
ie_tipo_evolucao_w	varchar(3);


BEGIN

select  coalesce(max(ie_tipo_evolucao),'X')
into STRICT	ie_tipo_evolucao_w
from	usuario
where	nm_usuario = wheb_usuario_pck.get_nm_usuario;


select 	count(1)
into STRICT	qt_reg_tipo_oco_w
from 	TIPO_OCORRENCIA_TURNO_LIB
where	cd_tipo_ocorrencia = cd_tipo_ocorrencia_p;

If (qt_reg_tipo_oco_w > 0) Then
	 select count(cd_perfil)
	 into STRICT	qt_registros_perfil_w
	 from 	TIPO_OCORRENCIA_TURNO_LIB
	 where	cd_tipo_ocorrencia 				= cd_tipo_ocorrencia_p
	 and	coalesce(cd_perfil,cd_perfil_p)	   		= cd_perfil_p
	 and	coalesce(ie_tipo_evolucao,ie_tipo_evolucao_w)	= ie_tipo_evolucao_w;

	 If (qt_registros_perfil_w > 0) Then
		ds_retorno_w := 'S';
	 Else
		ds_retorno_w := 'N';
	 End If;
Else	 ds_retorno_w := 'S';

End If;

return	ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_lib_turno_perfil (cd_perfil_p bigint, cd_tipo_ocorrencia_p text) FROM PUBLIC;

