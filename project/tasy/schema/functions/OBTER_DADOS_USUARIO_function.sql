-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_usuario (nm_usuario_p text, ds_separador_p text default null,/* The separator to be added between the required infomration values */
 ds_retorno_p text default null) RETURNS varchar AS $body$
/* Defines the information that needs to be retrieved C = Cargo, R = Ramal, S = Setor, may receive only one character or a combination of them fot example: 'C','CR', 'RS', 'CRS' */
DECLARE


ds_dados_w			varchar(255);
ds_usuario_w		varchar(100);
ds_setor_w			varchar(100);
nr_ramal_w			varchar(20);
cd_pessoa_fisica_w	varchar(20);
ds_cargo_w			varchar(100);


BEGIN

select	ds_usuario,
	substr(obter_nome_setor(cd_setor_atendimento),1,100),
	nr_ramal,
	cd_pessoa_fisica
into STRICT	ds_usuario_w,
	ds_setor_w,
	nr_ramal_w,
	cd_pessoa_fisica_w
from	usuario
where	nm_usuario	= nm_usuario_p;

Select	max(obter_desc_cargo(cd_cargo))
into STRICT	ds_cargo_w
from	pessoa_fisica
where	cd_pessoa_fisica	= cd_pessoa_fisica_w;

ds_dados_w		:= ds_usuario_w;
if	((ds_cargo_w IS NOT NULL AND ds_cargo_w::text <> '') AND ((coalesce(ds_retorno_p::text, '') = '') OR (position('C' in ds_retorno_p) > 0))) then
	if (ds_separador_p IS NOT NULL AND ds_separador_p::text <> '') then
		ds_dados_w	:= ds_dados_w || ds_separador_p;
	end if;
    ds_dados_w	:= ds_dados_w || obter_desc_expressao(330234)/*' Cargo: '*/
 || ds_cargo_w;
end if;

if	((nr_ramal_w IS NOT NULL AND nr_ramal_w::text <> '') AND ((coalesce(ds_retorno_p::text, '') = '') OR (position('R' in ds_retorno_p) > 0))) then
	if (ds_separador_p IS NOT NULL AND ds_separador_p::text <> '') then
		ds_dados_w	:= ds_dados_w || ds_separador_p;
	end if;
	ds_dados_w	:= ds_dados_w || obter_desc_expressao(612281)/*' Ramal: '*/
 || nr_ramal_w;	
end if;

if	((ds_setor_w IS NOT NULL AND ds_setor_w::text <> '') AND ((coalesce(ds_retorno_p::text, '') = '') OR (position('S' in ds_retorno_p) > 0))) then
	if (ds_separador_p IS NOT NULL AND ds_separador_p::text <> '') then
		ds_dados_w	:= ds_dados_w || ds_separador_p;
	end if;
	ds_dados_w	:= ds_dados_w || obter_desc_expressao(329821)/*' Setor: '*/
 || ds_setor_w;
end if;

Return ds_dados_w;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_usuario (nm_usuario_p text, ds_separador_p text default null, ds_retorno_p text default null) FROM PUBLIC;

