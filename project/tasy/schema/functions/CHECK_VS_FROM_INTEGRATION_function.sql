-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION check_vs_from_integration (NR_CIRURGIA_P bigint) RETURNS varchar AS $body$
DECLARE


COUNT_REGISTROS bigint;


BEGIN
    select SUM(registros) INTO STRICT COUNT_REGISTROS from (
        SELECT count(*) registros from atendimento_sinal_vital
        where ie_integracao = 'S' and coalesce(dt_liberacao::text, '') = '' and ie_situacao != 'I' and nr_cirurgia = NR_CIRURGIA_P

union

        SELECT count(*) registros from atendimento_monit_resp
        where ie_integracao = 'S' and coalesce(dt_liberacao::text, '') = '' and ie_situacao != 'I'  and nr_cirurgia = NR_CIRURGIA_P
        
union

        select count(*) registros from ATEND_MONIT_HEMOD
        where ie_integracao = 'S' and coalesce(dt_liberacao::text, '') = '' and ie_situacao != 'I'  and nr_cirurgia = NR_CIRURGIA_P
        
union

        select count(*) registros from atend_aval_analgesia a
        where nr_atendimento = (select c.nr_atendimento from cirurgia c where c.nr_cirurgia = NR_CIRURGIA_P  LIMIT 1)
    ) alias9;
  RETURN COUNT_REGISTROS;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION check_vs_from_integration (NR_CIRURGIA_P bigint) FROM PUBLIC;

