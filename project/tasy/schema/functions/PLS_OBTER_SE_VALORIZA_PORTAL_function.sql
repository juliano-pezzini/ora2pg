-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION pls_obter_se_valoriza_portal ( ie_origem_protocolo_p pls_protocolo_conta.ie_origem_protocolo%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) RETURNS PLS_REGRA_VALORIZACAO_CTA.IE_VALORIZA%TYPE AS $body$
DECLARE


ie_valoriza_w		pls_regra_valorizacao_cta.ie_valoriza%type := 'N';
ie_controle_producao_w	pls_controle_estab.ie_controle_producao%type;

C01 CURSOR(	ie_origem_protocolo_pc	pls_protocolo_conta.ie_origem_protocolo%type,
		cd_estabelecimento_pc	estabelecimento.cd_estabelecimento%type,
		ie_controle_producao_pc	pls_controle_estab.ie_controle_producao%type) FOR
	SELECT	ie_valoriza
	from	pls_regra_valorizacao_cta
	where	((ie_controle_producao_pc = 'S') or (cd_estabelecimento = cd_estabelecimento_pc))
	and	((coalesce(ie_origem_protocolo::text, '') = '') or (ie_origem_protocolo = ie_origem_protocolo_pc))
	order by
		coalesce(ie_origem_protocolo,'0');

BEGIN

ie_controle_producao_w := pls_obter_se_controle_estab('CPM');

for r_C01_w in C01(ie_origem_protocolo_p, cd_estabelecimento_p, ie_controle_producao_w) loop
	ie_valoriza_w := r_C01_w.ie_valoriza;
end loop;

return	ie_valoriza_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_obter_se_valoriza_portal ( ie_origem_protocolo_p pls_protocolo_conta.ie_origem_protocolo%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) FROM PUBLIC;

