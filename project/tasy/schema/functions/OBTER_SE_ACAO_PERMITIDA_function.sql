-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_acao_permitida ( nr_seq_estagio_regra_p bigint) RETURNS varchar AS $body$
DECLARE


retorno_w varchar(255);
ie_status_execucao_w varchar(10);
nr_seq_status_w status_regra_entrega.nr_sequencia%TYPE;

/*
GERAR_MALOTE_POR_BARRAS("1")
GERAR_ENVELOPE("2")
CONFERIR_ENVELOPE("3")
CONFIRMAR_RECEBIMENTO_ANDAR("4")
REGISTRAR_SAIDA_MALOTE("5")
CONFIRMAR_RECEBIMENTO_MALOTE("6")
ENTREGA_ENVELOPE_POR_BARRAS("7")
ENTREGA_ENVELOPE("8")
ENVELOPAMENTO_MANUAL("9")
CONFERIR_ENVELOPE_ATEND("10")
DESVINCULAR_ENVELOPE("11")
ALTERAR_FORMA_ENTREGA("12")
DESFAZER_ENVELOPAMENTO("13")
DESFAZER_CONFERENCIA("14")
DESFAZER_ENTREGA("15")
GERAR_MALOTE_POR_BARRAS_SEM_CONFERENCIA("16")
ENTREGA_ENVELOPE_SEM_REGISTRO_SAIDA("17")
ENTREGA_ENVELOPE_SEM_MALOTE("18")
ENTREGA_ENVELOPE_SEM_ENVELOPE("19")*/
BEGIN
retorno_w := 'N';

select nr_seq_status
into STRICT nr_seq_status_w
from estagio_status_entrega
where nr_sequencia = nr_seq_estagio_regra_p;

select ie_status_execucao
into STRICT ie_status_execucao_w
from status_regra_entrega
where nr_sequencia = nr_seq_status_w;

if (ie_status_execucao_w = '40') then
  retorno_w := '2,9,12,19';
elsif (ie_status_execucao_w = '45') then
  retorno_w := '1,3,4,5,6,7,8,10,11,12,13,14,16,17,18';
elsif (ie_status_execucao_w >= '60') then
  retorno_w := '15';
end if;

return retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_acao_permitida ( nr_seq_estagio_regra_p bigint) FROM PUBLIC;

