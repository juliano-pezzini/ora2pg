-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dados_cot_compra_item ( nr_cot_compra_p bigint, nr_item_cot_compra_p bigint, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


/*ie_opcao_p
D	= Data limite entrega
E	= Estabelecimento
RP	= Regra preço
DMD	= Descrição do material direto
UMC	= Unidade medida compra
CDM	= Codigo do material
SIT	= Situação
FOA	= Fornecedor alterado
MVA	= Motivo do vencedor alterado
SC	= Solicitação compras
ISC	= Item solic compra
DBI	= Data da baixa do item da solicitação
DTR	= Data de reprovação
PRE	= Projeto recurso
*/
ds_retorno_w			varchar(255);
dt_limite_entrega_w			timestamp;
cd_estabelecimento_w		smallint;
ie_regra_preco_w			varchar(15);
ds_material_direto_w_w		varchar(255);
cd_unidade_medida_compra_w	varchar(30);
cd_material_w			integer;
ie_situacao_w			varchar(1);
cd_cgc_fornecedor_venc_alt_w	varchar(14);
ds_motivo_venc_alt_w		varchar(255);
nr_solic_compra_w			bigint;
nr_item_solic_compra_w			bigint;
dt_baixa_item_solic_w		timestamp;
dt_reprovacao_w			timestamp;
nr_seq_proj_rec_w		bigint;


BEGIN
select	dt_limite_entrega,
	cd_estab_item,
	ie_regra_preco,
	substr(ds_material_direto_w,1,255),
	cd_unidade_medida_compra,
	cd_material,
	ie_situacao,
	cd_cgc_fornecedor_venc_alt,
	substr(ds_motivo_venc_alt,1,255),
	nr_solic_compra,
	nr_item_solic_compra,
	dt_reprovacao,
	nr_seq_proj_rec
into STRICT	dt_limite_entrega_w,
	cd_estabelecimento_w,
	ie_regra_preco_w,
	ds_material_direto_w_w,
	cd_unidade_medida_compra_w,
	cd_material_w,
	ie_situacao_w,
	cd_cgc_fornecedor_venc_alt_w,
	ds_motivo_venc_alt_w,
	nr_solic_compra_w,
	nr_item_solic_compra_w,
	dt_reprovacao_w,
	nr_seq_proj_rec_w
from	cot_compra_item
where	nr_cot_compra = nr_cot_compra_p
and	nr_item_cot_compra = nr_item_cot_compra_p;

if (ie_opcao_p = 'DBI') and (nr_solic_compra_w > 0) and (nr_item_solic_compra_w > 0) then

	select	dt_baixa
	into STRICT	dt_baixa_item_solic_w
	from	solic_compra_item
	where	nr_solic_compra = nr_solic_compra_w
	and	nr_item_solic_compra = nr_item_solic_compra_w;

end if;

if (ie_opcao_p = 'D') then
	ds_retorno_w	:= dt_limite_entrega_w;
elsif (ie_opcao_p = 'E') then
	ds_retorno_w	:= cd_estabelecimento_w;
elsif (ie_opcao_p = 'RP') then
	ds_retorno_w	:= ie_regra_preco_w;
elsif (ie_opcao_p = 'DMD') then
	ds_retorno_w	:= ds_material_direto_w_w;
elsif (ie_opcao_p = 'UMC') then
	ds_retorno_w	:= cd_unidade_medida_compra_w;
elsif (ie_opcao_p = 'CDM') then
	ds_retorno_w	:= cd_material_w;
elsif (ie_opcao_p = 'SIT') then
	ds_retorno_w	:= ie_situacao_w;
elsif (ie_opcao_p = 'FOA') then
	ds_retorno_w	:= cd_cgc_fornecedor_venc_alt_w;
elsif (ie_opcao_p = 'MVA') then
	ds_retorno_w	:= ds_motivo_venc_alt_w;
elsif (ie_opcao_p = 'SC') then
	ds_retorno_w	:= nr_solic_compra_w;
elsif (ie_opcao_p = 'ISC') then
	ds_retorno_w	:= nr_item_solic_compra_w;
elsif (ie_opcao_p = 'DBI') then
	ds_retorno_w	:= dt_baixa_item_solic_w;
elsif (ie_opcao_p = 'DTR') then
	ds_retorno_w	:= dt_reprovacao_w;
elsif (ie_opcao_p = 'PRE') then
	ds_retorno_w	:= nr_seq_proj_rec_w;
end if;

return ds_retorno_w;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dados_cot_compra_item ( nr_cot_compra_p bigint, nr_item_cot_compra_p bigint, ie_opcao_p text) FROM PUBLIC;

