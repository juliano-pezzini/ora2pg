-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_dt_venc_tit_rec ( cd_cgc_p text, dt_vencimento_p timestamp, ie_regra_p text, cd_banco_p bigint, cd_pessoa_fisica_p text) RETURNS timestamp AS $body$
DECLARE


dt_retorno_w	timestamp;
qt_dias_w	bigint;


BEGIN

dt_retorno_w	:= dt_vencimento_p;

if (ie_regra_p = 'S') then

	select	max(qt_dias_atraso)
	into STRICT	qt_dias_w
	from	regra_atraso_venc_cr a
	where (coalesce(a.cd_cgc, coalesce(cd_cgc_p,'X'))	= coalesce(cd_cgc_p,'X'))
	and (coalesce(a.cd_pessoa_fisica, coalesce(cd_pessoa_fisica_p,'X'))	= coalesce(cd_pessoa_fisica_p,'X'))
	and	coalesce(a.cd_banco,coalesce(cd_banco_p,0)) 	= coalesce(cd_banco_p,0);

	if (coalesce(qt_dias_w,0) <> 0) then -- Coloquei diferente de zero e nao maior que zero, para consistir tb dias negativos informados na regra.
		dt_retorno_w	:= dt_retorno_w + qt_dias_w;
	end if;


end if;

return	dt_retorno_w;

end	;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_dt_venc_tit_rec ( cd_cgc_p text, dt_vencimento_p timestamp, ie_regra_p text, cd_banco_p bigint, cd_pessoa_fisica_p text) FROM PUBLIC;

