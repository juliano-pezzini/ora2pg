-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_proximo_service_pack (CD_VERSAO_P text, nr_seq_ordem_serv_p bigint) RETURNS varchar AS $body$
DECLARE


SERVICE_PACK_W bigint;
ds_mensagem_w varchar(1000);
ds_comando_cursor_w text;
C010 integer;
retorno_w bigint;


BEGIN

	service_pack_w := null;
	--retorna o numero do proximo service pack quando nao for o 00
	ds_comando_cursor_w := 'select count(1) ' ||chr(13)||
	'from man_service_pack_versao@dblink ' ||chr(13)||
	'where cd_versao = :CD_VERSAO_P';

	if OBTER_SE_BASE_WHEB = 'S' then
		ds_comando_cursor_w := replace(ds_comando_cursor_w,'@dblink','@whebl01_dbcorp');
		ds_comando_cursor_w := replace(ds_comando_cursor_w,'man_service_pack_versao','corp.man_service_pack_versao');
	else
		ds_comando_cursor_w := replace(ds_comando_cursor_w,'@dblink','');
	end if;

	C010 := DBMS_SQL.OPEN_CURSOR;
	DBMS_SQL.PARSE(C010, ds_comando_cursor_w, dbms_sql.Native);
	DBMS_SQL.bind_variable(c010,':CD_VERSAO_P', cd_versao_p);
	DBMS_SQL.DEFINE_COLUMN(C010, 1, service_pack_w);
	retorno_w := DBMS_SQL.execute(c010);

	if (DBMS_SQL.FETCH_ROWS(C010) > 0 ) then
		DBMS_SQL.COLUMN_VALUE(C010, 1, service_pack_w);
	end if;
	DBMS_SQL.CLOSE_CURSOR(C010);

	if (coalesce(service_pack_w::text, '') = '') then
		service_pack_w := 0;
	end if;

	-- Os ajustes estarao disponiveis no service pack #@SERVICE_PACK#@ da versao #@CD_VERSAO#@.
	select	max(obter_texto_dic_objeto(nr_sequencia, man_obter_idioma_os_local(nr_seq_ordem_serv_p),'SERVICE_PACK='||lpad(SERVICE_PACK_W,3,'0')||';CD_VERSAO='||CD_VERSAO_P||';'))
	into STRICT	ds_mensagem_w
	from	dic_objeto
	where	nr_sequencia = 1050763
	and	ie_tipo_objeto = 'T';

	return substr(trim(both ds_mensagem_w),1,1000);

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_proximo_service_pack (CD_VERSAO_P text, nr_seq_ordem_serv_p bigint) FROM PUBLIC;

