-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';





CREATE OR REPLACE FUNCTION obter_se_usuario_perm_agenda (cd_agenda_p bigint, cd_pessoa_fisica_p text, cd_perfil_p bigint, cd_setor_atendimento_p bigint) RETURNS varchar AS $body$
DECLARE

 
ie_permissao_w	varchar(1) := 'N';


BEGIN 
if (cd_agenda_p IS NOT NULL AND cd_agenda_p::text <> '') and (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') then 
 
	/* verificar agenda x pessoa usuario */
 
	if (ie_permissao_w = 'N') then 
		select	CASE WHEN count(*)=0 THEN 'N'  ELSE 'S' END  
		into STRICT	ie_permissao_w 
		from	agenda 
		where	cd_agenda		= cd_agenda_p 
		and	cd_pessoa_fisica	= cd_pessoa_fisica_p;
	end if;
 
	/* verificar permissao agenda x pessoa usuario */
 
	if (ie_permissao_w = 'N') then 
		select	CASE WHEN count(*)=0 THEN 'N'  ELSE 'S' END  
		into STRICT	ie_permissao_w 
		from	med_permissao 
		where	cd_agenda		= cd_agenda_p 
		and	cd_pessoa_fisica	= cd_pessoa_fisica_p 
		and	coalesce(cd_perfil::text, '') = '' 
		and	coalesce(cd_setor_atendimento::text, '') = '';
	end if;
 
	/* verificar permissao agenda x perfil usuario */
 
	if (ie_permissao_w = 'N') then 
		select	CASE WHEN count(*)=0 THEN 'N'  ELSE 'S' END  
		into STRICT	ie_permissao_w 
		from	med_permissao 
		where	cd_agenda		= cd_agenda_p 
		and	coalesce(cd_pessoa_fisica::text, '') = '' 
		and	cd_perfil		= cd_perfil_p 
		and	coalesce(cd_setor_atendimento::text, '') = '';
	end if;
 
	/* verificar permissao agenda x setor usuario */
 
	if (ie_permissao_w = 'N') then 
		select	CASE WHEN count(*)=0 THEN 'N'  ELSE 'S' END  
		into STRICT	ie_permissao_w 
		from	med_permissao 
		where	cd_agenda		= cd_agenda_p 
		and	coalesce(cd_pessoa_fisica::text, '') = '' 
		and	coalesce(cd_perfil::text, '') = '' 
		and	cd_setor_atendimento	= cd_setor_atendimento_p;
	end if;
 
	/* verificar permissao agenda x pessoa x perfil x setor usuario */
 
	if (ie_permissao_w = 'N') then 
		select	CASE WHEN count(*)=0 THEN 'N'  ELSE 'S' END  
		into STRICT	ie_permissao_w 
		from	med_permissao 
		where	cd_agenda		= cd_agenda_p 
		and	cd_pessoa_fisica	= cd_pessoa_fisica_p 
		and	cd_perfil		= cd_perfil_p 
		and	cd_setor_atendimento	= cd_setor_atendimento_p;
		 
	end if;
 
	/* verificar permissao agenda x pessoa x perfil usuario */
 
	if (ie_permissao_w = 'N') then 
		select	CASE WHEN count(*)=0 THEN 'N'  ELSE 'S' END  
		into STRICT	ie_permissao_w 
		from	med_permissao 
		where	cd_agenda		= cd_agenda_p 
		and	cd_pessoa_fisica	= cd_pessoa_fisica_p 
		and	cd_perfil		= cd_perfil_p 
		and	coalesce(cd_setor_atendimento::text, '') = '';
		 
	end if;
 
	/* verificar permissao agenda x pessoa x setor usuario */
 
	if (ie_permissao_w = 'N') then 
		select	CASE WHEN count(*)=0 THEN 'N'  ELSE 'S' END  
		into STRICT	ie_permissao_w 
		from	med_permissao 
		where	cd_agenda		= cd_agenda_p 
		and	cd_pessoa_fisica	= cd_pessoa_fisica_p 
		and	coalesce(cd_perfil::text, '') = '' 
		and	cd_setor_atendimento	= cd_setor_atendimento_p;
		 
	end if;
 
	/* verificar permissao agenda x perfil x setor usuario */
 
	if (ie_permissao_w = 'N') then 
		select	CASE WHEN count(*)=0 THEN 'N'  ELSE 'S' END  
		into STRICT	ie_permissao_w 
		from	med_permissao 
		where	cd_agenda		= cd_agenda_p 
		and	coalesce(cd_pessoa_fisica::text, '') = '' 
		and	cd_perfil		= cd_perfil_p 
		and	cd_setor_atendimento	= cd_setor_atendimento_p;
		 
	end if;
 
end if;
 
return ie_permissao_w;
 
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION obter_se_usuario_perm_agenda (cd_agenda_p bigint, cd_pessoa_fisica_p text, cd_perfil_p bigint, cd_setor_atendimento_p bigint) FROM PUBLIC;

