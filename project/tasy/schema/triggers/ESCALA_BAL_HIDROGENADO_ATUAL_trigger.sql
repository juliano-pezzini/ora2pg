-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS escala_bal_hidrogenado_atual ON escala_bal_hidrogenado CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_escala_bal_hidrogenado_atual() RETURNS trigger AS $BODY$
declare
    EXEC_W                    varchar(300);
    QT_NITRO_INGERIDO_W       double precision;
    QT_NITRO_URI_URE_W        double precision;
    QT_NITRO_URI_NAO_URE_W    double precision;
    QT_NITRO_EXCRETADO_W      double precision;
    QT_SCORE_W                double precision;
    ds_erro_w   varchar(2000);
    ds_parametro_w  varchar(2000);
BEGIN
  BEGIN
    if (wheb_usuario_pck.get_ie_executar_trigger = 'S') then
        BEGIN
            EXEC_W := 'BEGIN CALCULA_BAL_HIDROGENADO_MD(:1, :2, :3, :4, :5, :6, :7, :8, :9, :10, :11, :12, :13); END;';

            EXECUTE EXEC_W USING  IN NEW.QT_PROT_INGERIDAS,
                                            IN NEW.QT_PROT_INFUNDIDAS,
                                            IN NEW.QT_UREIA_24H, 
                                            IN NEW.QT_NITROGENIO_URINARIO_24H,
                                            IN NEW.QT_NITRO_FECAL,
                                            IN NEW.QT_NITRO_PELE,
                                            IN NEW.QT_NITRO_SONDA,
                                            IN NEW.QT_NITRO_FISTULA,
                                            OUT QT_NITRO_INGERIDO_W,
                                            OUT QT_NITRO_URI_URE_W,
                                            OUT QT_NITRO_URI_NAO_URE_W,
                                            OUT QT_NITRO_EXCRETADO_W,
                                            OUT QT_SCORE_W;
        exception
            when others then
                QT_NITRO_INGERIDO_W       := null;
                QT_NITRO_URI_URE_W        := null;
                QT_NITRO_URI_NAO_URE_W    := null;
                QT_NITRO_EXCRETADO_W      := null;
                QT_SCORE_W                := null;

                ds_erro_w := sqlerrm;
                ds_parametro_w := ':new.nr_atendimento: ' || NEW.nr_atendimento || ' - :new.cd_profissional: ' || NEW.cd_profissional || ' - :new.ie_situacao: ' || NEW.ie_situacao;
                ds_parametro_w := ds_parametro_w || ' - :new.QT_PROT_INGERIDAS: ' || NEW.QT_PROT_INGERIDAS || ' - :new.QT_PROT_INFUNDIDAS: ' || NEW.QT_PROT_INFUNDIDAS || ' - :new.QT_UREIA_24H: ' || NEW.QT_UREIA_24H || ' - :new.QT_NITROGENIO_URINARIO_24H: ' || NEW.QT_NITROGENIO_URINARIO_24H;
                ds_parametro_w := ds_parametro_w || ' - :new.QT_NITRO_FECAL: ' || NEW.QT_NITRO_FECAL || ' - :new.QT_NITRO_PELE: ' || NEW.QT_NITRO_PELE || ' - :new.QT_NITRO_SONDA: ' || NEW.QT_NITRO_SONDA || ' - :new.QT_NITRO_FISTULA: ' || NEW.QT_NITRO_FISTULA;
                ds_parametro_w := ds_parametro_w || ' - QT_NITRO_INGERIDO_W: ' || QT_NITRO_INGERIDO_W || ' - QT_NITRO_URI_URE_W: ' || QT_NITRO_URI_URE_W || ' - QT_NITRO_URI_NAO_URE_W: ' || QT_NITRO_URI_NAO_URE_W || ' - QT_NITRO_EXCRETADO_W: ' || QT_NITRO_EXCRETADO_W || ' - QT_SCORE_W: ' || QT_SCORE_W;
                CALL gravar_log_medical_device('ESCALA_BAL_HIDROGENADO_ATUAL', 'CALCULA_BAL_HIDROGENADO_MD', ds_parametro_w, ds_erro_w, wheb_usuario_pck.get_nm_usuario, 'N');
        end;

        NEW.QT_NITRO_INGERIDO		:= 	QT_NITRO_INGERIDO_W;
        NEW.QT_NITRO_URI_URE		:=	QT_NITRO_URI_URE_W;
        NEW.QT_NITRO_URI_NAO_URE 	:= 	QT_NITRO_URI_NAO_URE_W;
        NEW.QT_NITRO_EXCRETADO		:= 	QT_NITRO_EXCRETADO_W;
        NEW.QT_SCORE		   	    := 	QT_SCORE_W;
    end if;
  END;
RETURN NEW;
end;
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_escala_bal_hidrogenado_atual() FROM PUBLIC;

CREATE TRIGGER escala_bal_hidrogenado_atual
	BEFORE INSERT OR UPDATE ON escala_bal_hidrogenado FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_escala_bal_hidrogenado_atual();

