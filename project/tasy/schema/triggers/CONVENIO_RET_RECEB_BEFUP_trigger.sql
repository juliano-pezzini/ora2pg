-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS convenio_ret_receb_befup ON convenio_ret_receb CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_convenio_ret_receb_befup() RETURNS trigger AS $BODY$
declare

ds_callstack	convenio_ret_receb_log.ds_callstack%type;
nm_user_const	CONSTANT varchar(15) := 'NOTINFORMED';

BEGIN
if (wheb_usuario_pck.get_ie_executar_trigger = 'S') then

	if	TG_OP = 'INSERT' then
		
		ds_callstack := substr(wheb_mensagem_pck.get_texto(455610)|| ' - ' || wheb_mensagem_pck.get_texto(802987) || ' : ' || substr(dbms_utility.format_call_stack,1,3980),1,4000);
		
		
	elsif	TG_OP = 'UPDATE' then
		
		
		ds_callstack := substr(wheb_mensagem_pck.get_texto(455610)|| ' - ' || wheb_mensagem_pck.get_texto(245155) || ' : ' || substr(dbms_utility.format_call_stack,1,3980),1,4000);
		
	end if;
	
	
	insert into convenio_ret_receb_log(NR_SEQUENCIA,
		NR_SEQ_RECEB,
		NR_SEQ_RETORNO,
		VL_VINCULACAO,
		DT_ATUALIZACAO,
		NM_USUARIO,
		NR_SEQ_TRANS_FIN,
		NR_LOTE_CONTABIL,
		DS_OBSERVACAO,
		DS_CALLSTACK)
	values (nextval('convenio_ret_receb_log_seq'),
		NEW.NR_SEQ_RECEB,
		NEW.NR_SEQ_RETORNO,
		NEW.VL_VINCULACAO,
		LOCALTIMESTAMP,
		COALESCE(wheb_usuario_pck.get_nm_usuario,nm_user_const),
		NEW.NR_SEQ_TRANS_FIN,
		NEW.NR_LOTE_CONTABIL,
		NEW.DS_OBSERVACAO,
		DS_CALLSTACK);

end if;
RETURN NEW;
END
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_convenio_ret_receb_befup() FROM PUBLIC;

CREATE TRIGGER convenio_ret_receb_befup
	BEFORE INSERT OR UPDATE ON convenio_ret_receb FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_convenio_ret_receb_befup();

