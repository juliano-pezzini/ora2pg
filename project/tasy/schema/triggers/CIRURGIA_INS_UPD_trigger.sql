-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS cirurgia_ins_upd ON cirurgia CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_cirurgia_ins_upd() RETURNS trigger AS $BODY$
declare
BEGIN
    if (wheb_usuario_pck.get_ie_executar_trigger = 'S') then
        BEGIN
            if (coalesce((pkg_i18n.get_user_locale), 'pt_BR') = 'de_AT') then
                BEGIN
                    if ((TG_OP = 'INSERT' and (pepo_obter_se_regra_doc(NEW.nr_seq_proc_interno, NEW.cd_estabelecimento) = 'S')) or (TG_OP = 'UPDATE' AND NEW.nr_seq_proc_interno IS DISTINCT FROM OLD.nr_seq_proc_interno)) then
                        BEGIN
                            CALL pepo_gerar_doc_status(
                                NEW.nr_cirurgia,
                                NEW.cd_estabelecimento,
                                NEW.nr_seq_proc_interno,
                                1,
                                NEW.nm_usuario,
                                NEW.nr_seq_pepo
                            );
                        end;
                    end if;
                end;
            end if;
        end;
    end if;
RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_cirurgia_ins_upd() FROM PUBLIC;

CREATE TRIGGER cirurgia_ins_upd
	AFTER INSERT OR UPDATE ON cirurgia FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_cirurgia_ins_upd();

