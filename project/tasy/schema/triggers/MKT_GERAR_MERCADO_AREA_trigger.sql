-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS mkt_gerar_mercado_area ON mkt_produto_area CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_mkt_gerar_mercado_area() RETURNS trigger AS $BODY$
DECLARE
	WRK_NR_SEQ_MERCADO double precision;

	C_MERCADO_PRODUTO CURSOR FOR
		SELECT NR_SEQ_MERCADO FROM MKT_PRODUTO_MERCADO
		WHERE NR_SEQ_PRODUTO = NEW.NR_SEQ_PRODUTO;

   BEGIN
     OPEN C_MERCADO_PRODUTO;
		LOOP
			FETCH C_MERCADO_PRODUTO INTO WRK_NR_SEQ_MERCADO;
			EXIT WHEN NOT FOUND; /* apply on C_MERCADO_PRODUTO */

			INSERT INTO MKT_AREA_MERCADO(NR_SEQUENCIA,
										DT_ATUALIZACAO,
										NM_USUARIO,
										DT_ATUALIZACAO_NREC,
										NM_USUARIO_NREC,
										NR_SEQ_AREA,
										NR_SEQ_MERCADO ) VALUES (nextval('mkt_area_mercado_seq'),
						LOCALTIMESTAMP,
						WHEB_USUARIO_PCK.GET_NM_USUARIO,
						LOCALTIMESTAMP,
						WHEB_USUARIO_PCK.GET_NM_USUARIO,
						NEW.NR_SEQUENCIA,
						WRK_NR_SEQ_MERCADO
						);

		END LOOP;
   RETURN NEW;
END
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_mkt_gerar_mercado_area() FROM PUBLIC;

CREATE TRIGGER mkt_gerar_mercado_area
	AFTER INSERT ON mkt_produto_area FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_mkt_gerar_mercado_area();

