-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS pls_referencia_bo_insert ON pls_referencia_bo CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_pls_referencia_bo_insert() RETURNS trigger AS $BODY$
declare
    pragma autonomous_transaction;
    total_records_w pls_referencia_bo.nr_seq_bo%type;
BEGIN
  BEGIN
    if (wheb_usuario_pck.get_ie_executar_trigger = 'S') then
        BEGIN
            select
                sum(1) 
            into STRICT    total_records_w 
            from    pls_referencia_bo 
            where   nr_seq_bo = NEW.nr_seq_bo
                    and ((nr_seq_requisicao = NEW.nr_seq_requisicao and NEW.nr_seq_guia is null) 
                          or (nr_seq_guia = NEW.nr_seq_guia and NEW.nr_seq_requisicao is null));
        exception
            when no_data_found then
                total_records_w := 0;
        end;

        if (total_records_w >0) then
            CALL wheb_mensagem_pck.exibir_mensagem_abort(1200224);
        end if;
    end if;
  END;
RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_pls_referencia_bo_insert() FROM PUBLIC;

CREATE TRIGGER pls_referencia_bo_insert
	AFTER INSERT ON pls_referencia_bo FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_pls_referencia_bo_insert();

