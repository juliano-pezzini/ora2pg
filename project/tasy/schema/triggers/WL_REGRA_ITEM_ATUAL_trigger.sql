-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS wl_regra_item_atual ON wl_regra_item CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_wl_regra_item_atual() RETURNS trigger AS $BODY$
declare
ie_regra_item_w		char(1);

BEGIN

						
select	(CASE WHEN max(ri.nr_sequencia) IS NOT NULL THEN 'S' ELSE 'N' END)
into STRICT	ie_regra_item_w
from	wl_regra_item ri,
	wl_regra_worklist rw,
	wl_item	it
where	rw.nr_sequencia = ri.nr_seq_regra
and	it.nr_sequencia = rw.nr_seq_item
and	ri.nr_seq_regra = NEW.nr_seq_regra
and	it.cd_categoria = 'MT';

if (ie_regra_item_w = 'S') then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(1014493,'DS_CATEGORIA=' || obter_desc_expressao(857157));
end if;

RETURN NEW;
end;
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_wl_regra_item_atual() FROM PUBLIC;

CREATE TRIGGER wl_regra_item_atual
	BEFORE INSERT ON wl_regra_item FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_wl_regra_item_atual();

