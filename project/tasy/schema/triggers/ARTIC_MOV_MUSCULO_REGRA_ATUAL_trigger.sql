-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS artic_mov_musculo_regra_atual ON artic_mov_musculo_regra CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_artic_mov_musculo_regra_atual() RETURNS trigger AS $BODY$
DECLARE

qt_idade_max_w	bigint;

BEGIN

qt_idade_max_w	:= somente_numero(obter_valor_param_usuario(2468, 1, obter_perfil_ativo,NEW.nm_usuario,wheb_usuario_pck.get_cd_estabelecimento));

if (qt_idade_max_w > 0) and (wheb_usuario_pck.get_ie_executar_trigger	= 'S') then

	if (qt_idade_max_w < NEW.QT_IDADE_MAX) and (NEW.QT_IDADE_MIN < qt_idade_max_w) then
		-- A idade máxima para pacientes infantis deve ser de até '||qt_idade_max_w||' anos.'||CHR(13)||' Parâmetro [1] da função Escala Modificada de Ashworth.','A');
		CALL Wheb_mensagem_pck.exibir_mensagem_abort(264595,	'QT_IDADE_MAX_W='||to_char(QT_IDADE_MAX_W));
	end if;

	if (NEW.QT_IDADE_MIN is not null) and (NEW.QT_IDADE_MAX is not null) and (qt_idade_max_w between NEW.QT_IDADE_MIN and NEW.QT_IDADE_MAX) then
		NEW.IE_FORMA_CALCULO := 'Kg';
	else
		NEW.IE_FORMA_CALCULO := 'F';
	end if;
end if;
RETURN NEW;
END
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_artic_mov_musculo_regra_atual() FROM PUBLIC;

CREATE TRIGGER artic_mov_musculo_regra_atual
	BEFORE INSERT OR UPDATE ON artic_mov_musculo_regra FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_artic_mov_musculo_regra_atual();

