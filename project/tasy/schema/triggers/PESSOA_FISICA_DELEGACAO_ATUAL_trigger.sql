-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS pessoa_fisica_delegacao_atual ON pessoa_fisica_delegacao CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_pessoa_fisica_delegacao_atual() RETURNS trigger AS $BODY$
DECLARE
 
ds_log_w	varchar(4000);
ds_enter_w	varchar(255);
 
BEGIN 
ds_enter_w	:= chr(13) || chr(10);
ds_log_w 	:= wheb_mensagem_pck.get_texto(796350) || ds_enter_w || ds_enter_w;-- Alterado delegação abaixo. 
if (NEW.ie_objetivo <> OLD.ie_objetivo) then 
	ds_log_w := substr(ds_log_w ||	wheb_mensagem_pck.get_texto(796352) || obter_valor_dominio(2106,OLD.ie_objetivo) || ds_enter_w || --'OBJETIVO ANTES: ' 
				wheb_mensagem_pck.get_texto(796357) || obter_valor_dominio(2106,NEW.ie_objetivo) || ds_enter_w || ds_enter_w,1,4000); -- 'OBJETIVO ATUAL: ' 
end if;
 
if (NEW.cd_pessoa_fisica <> OLD.cd_pessoa_fisica) then 
	ds_log_w := substr(ds_log_w ||	wheb_mensagem_pck.get_texto(796358) || OLD.cd_pessoa_fisica || ' - ' || obter_nome_pf(OLD.cd_pessoa_fisica) || ds_enter_w || --PESSOA FÍSICA ANTES:  
				wheb_mensagem_pck.get_texto(796363) || NEW.cd_pessoa_fisica || ' - ' || obter_nome_pf(NEW.cd_pessoa_fisica) || ds_enter_w || ds_enter_w,1,4000);--'PESSOA FÍSICA ATUAL: ' 
end if;
 
if (NEW.cd_pessoa_substituta <> OLD.cd_pessoa_substituta) then 
	ds_log_w := substr(ds_log_w ||	wheb_mensagem_pck.get_texto(796442) || OLD.cd_pessoa_substituta || ' - ' || obter_nome_pf(OLD.cd_pessoa_substituta) || ds_enter_w || --PESSOA SUBST. ANTES: 
				wheb_mensagem_pck.get_texto(796443) || NEW.cd_pessoa_substituta || ' - ' || obter_nome_pf(NEW.cd_pessoa_substituta) || ds_enter_w || ds_enter_w,1,4000);--PESSOA SUBST. ATUAL: 
end if;
 
if (NEW.dt_limite <> OLD.dt_limite) then 
	ds_log_w := substr(ds_log_w ||	wheb_mensagem_pck.get_texto(796444) || OLD.dt_limite || ds_enter_w || --'DT. LIMITE ANTES: ' 
				wheb_mensagem_pck.get_texto(796445) || NEW.dt_limite || ds_enter_w || ds_enter_w,1,4000);--'DT. LIMITE ATUAL: ' 
end if;
 
insert into pessoa_fisica_deleg_log( 
	nr_sequencia, 
	dt_atualizacao, 
	nm_usuario, 
	dt_atualizacao_nrec, 
	nm_usuario_nrec, 
	ds_titulo, 
	ds_log, 
	cd_pessoa_substituida, 
	cd_pessoa_delegada) 
values (	nextval('pessoa_fisica_deleg_log_seq'), 
	LOCALTIMESTAMP, 
	NEW.nm_usuario, 
	LOCALTIMESTAMP, 
	NEW.nm_usuario, 
	wheb_mensagem_pck.get_texto(796446),--'Alteração delegação', 
	ds_log_w, 
	NEW.cd_pessoa_fisica, 
	NEW.cd_pessoa_substituta);
RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_pessoa_fisica_delegacao_atual() FROM PUBLIC;

CREATE TRIGGER pessoa_fisica_delegacao_atual
	BEFORE UPDATE ON pessoa_fisica_delegacao FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_pessoa_fisica_delegacao_atual();

