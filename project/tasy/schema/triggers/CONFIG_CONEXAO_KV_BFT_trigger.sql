-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS config_conexao_kv_bft ON config_conexao_kv CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_config_conexao_kv_bft() RETURNS trigger AS $BODY$
declare ds_senha_p varchar(255) := NEW.ds_senha;
BEGIN
	if (wheb_usuario_pck.get_ie_executar_trigger = 'S') then
		IF (NEW.ds_senha is not null
            and coalesce(OLD.ds_senha, 'null') <> coalesce(NEW.ds_senha, 'null')) then
                NEW.ds_senha := wheb_seguranca.encrypt(ds_senha_p);
		end if;
	end if;
RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_config_conexao_kv_bft() FROM PUBLIC;

CREATE TRIGGER config_conexao_kv_bft
	BEFORE INSERT OR UPDATE ON config_conexao_kv FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_config_conexao_kv_bft();

