-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS pls_pagamento_item_atual ON pls_pagamento_item CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_pls_pagamento_item_atual() RETURNS trigger AS $BODY$
declare
ds_programa_w varchar(4000);

BEGIN
-- Problema de performance por efetuar várias vezes selects da v$session
null;

/*select 	substr(max(program), 1, 255)
into	ds_programa_w
from	v$session
where	audsid = (SELECT USERENV('sessionid') FROM dual)
and	username = (SELECT username FROM v$session WHERE audsid = (SELECT USERENV('sessionid') FROM dual));

if	(updating) and (upper(ds_programa_w) not like '%TASY%')then

	insert into pls_pag_item_log
		(	nr_sequencia,
			ds_log,
			dt_atualizacao,
			dt_atualizacao_nrec,
			nm_usuario,
			nm_usuario_nrec,
			nr_seq_pag_item,
			vl_item_new,
			vl_item_old)
		select	pls_pag_item_log_seq.nextval,
			'Alteração efetuada via update utilizando o programa ' || ds_programa_w,
			sysdate,
			sysdate,
			:new.nm_usuario,
			:new.nm_usuario,
			:new.nr_sequencia,
			:new.vl_item,
			:old.vl_item
		from	dual;
end if;*/
RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_pls_pagamento_item_atual() FROM PUBLIC;

CREATE TRIGGER pls_pagamento_item_atual
	AFTER INSERT OR UPDATE ON pls_pagamento_item FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_pls_pagamento_item_atual();

