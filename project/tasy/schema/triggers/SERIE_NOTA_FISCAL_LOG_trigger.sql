-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS serie_nota_fiscal_log ON serie_nota_fiscal CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_serie_nota_fiscal_log() RETURNS trigger AS $BODY$
declare

ds_log_w	varchar(4000);

BEGIN

if (TG_OP = 'INSERT') then
	ds_log_w := 'Operacao: INSERT' || chr(13);
elsif (TG_OP = 'UPDATE') then
	ds_log_w := 'Operacao: UPDATE' || chr(13);
elsif (TG_OP = 'DELETE') then
	ds_log_w := 'Operacao: DELETE' || chr(13);
end if;

ds_log_w := ds_log_w || 'NR_ULTIMA_NF new: ' || NEW.NR_ULTIMA_NF || ' NR_ULTIMA_NF old: ' || OLD.NR_ULTIMA_NF || chr(13) ||
		'CD_SERIE_NF new: ' || NEW.CD_SERIE_NF || ' CD_SERIE_NF old: ' || OLD.CD_SERIE_NF || chr(13) ||
		'CD_ESTABELECIMENTO new: ' || NEW.CD_ESTABELECIMENTO || ' CD_ESTABELECIMENTO old: ' || OLD.CD_ESTABELECIMENTO || chr(13) ||
		'IE_COMPL_PAGO new: ' || NEW.IE_COMPL_PAGO || ' IE_COMPL_PAGO old: ' || OLD.IE_COMPL_PAGO || chr(13) ||
		'IE_NUMERO_NOTA new: ' || NEW.IE_NUMERO_NOTA || ' IE_NUMERO_NOTA old: ' || OLD.IE_NUMERO_NOTA || chr(13) ||
		'IE_SITUACAO new: ' || NEW.IE_SITUACAO || ' IE_SITUACAO old: ' || OLD.IE_SITUACAO || chr(13) ||
		'DT_ATUALIZACAO new: ' || NEW.DT_ATUALIZACAO || ' DT_ATUALIZACAO old: ' || OLD.DT_ATUALIZACAO || chr(13) ||
		'Usuario: ' || wheb_usuario_pck.get_nm_usuario || chr(13) ||
		'Local: ' || dbms_utility.format_call_stack || chr(13);
		

CALL gravar_log_tasy(2809, ds_log_w ,'Tasy');

IF TG_OP = 'DELETE' THEN
	RETURN OLD;
ELSE
	RETURN NEW;
END IF;

end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_serie_nota_fiscal_log() FROM PUBLIC;

CREATE TRIGGER serie_nota_fiscal_log
	BEFORE INSERT OR UPDATE OR DELETE ON serie_nota_fiscal FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_serie_nota_fiscal_log();

