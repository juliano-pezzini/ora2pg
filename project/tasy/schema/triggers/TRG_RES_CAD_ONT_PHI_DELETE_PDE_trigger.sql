-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS trg_res_cad_ont_phi_delete_pde ON res_cadastro_ontologia_phi CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_trg_res_cad_ont_phi_delete_pde() RETURNS trigger AS $BODY$
DECLARE
  X RECORD;
BEGIN
  BEGIN
  IF (wheb_usuario_pck.get_ie_executar_trigger = 'S') THEN
    FOR X IN (SELECT PA.NR_SEQUENCIA
                FROM PDE_ATTRIBUTE PA
               WHERE PA.NR_SEQ_RES_CAD_ONT = OLD.NR_SEQUENCIA
               ORDER BY PA.NR_SEQUENCIA DESC) LOOP
      CALL PDE.DELETE_ATTRIBUTE(X.NR_SEQUENCIA);
    END LOOP;
  END IF;
EXCEPTION
  WHEN OTHERS THEN
    CALL PDE.GRAVA_LOG_ERRO('TRG_RES_CAD_ONT_PHI_DELETE_PDE',
                       'NR_SEQUENCIA: ' || OLD.NR_SEQUENCIA ||
                       ', NM_TABELA: ' || OLD.NM_TABELA ||
                       ', NM_ATRIBUTO: ' || OLD.NM_ATRIBUTO,
                       SQLSTATE,
                       SQLERRM);
  END;
RETURN OLD;
END
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_trg_res_cad_ont_phi_delete_pde() FROM PUBLIC;

CREATE TRIGGER trg_res_cad_ont_phi_delete_pde
	BEFORE DELETE ON res_cadastro_ontologia_phi FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_trg_res_cad_ont_phi_delete_pde();

