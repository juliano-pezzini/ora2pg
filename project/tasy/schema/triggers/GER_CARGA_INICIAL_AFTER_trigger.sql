-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS ger_carga_inicial_after ON ger_carga_inicial CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_ger_carga_inicial_after() RETURNS trigger AS $BODY$
declare

c01 CURSOR FOR
SELECT	a.*
from	ger_tipo_carga_arq a
where	a.nr_seq_tipo_carga = NEW.nr_seq_tipo_carga
order by ie_ordem;

c01_w	c01%rowtype;

BEGIN

if (NEW.nr_seq_tipo_carga <> OLD.nr_seq_tipo_carga) or (NEW.nr_seq_tipo_carga is not null and OLD.nr_seq_tipo_carga is null) then

	if (TG_OP = 'UPDATE') then
		delete from ger_carga_arq
		where	nr_seq_carga	= NEW.nr_sequencia;
	end if;

	open C01;
	loop
	fetch C01 into
		c01_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */

		insert into ger_carga_arq(nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			nr_seq_tipo_arq,
			nr_seq_carga,
			ie_obrigatorio)
		values (nextval('ger_carga_arq_seq'),
			LOCALTIMESTAMP,
			NEW.nm_usuario,
			c01_w.nr_sequencia,
			NEW.nr_sequencia,
			c01_w.ie_obrigatorio);
	end loop;
	close C01;
end if;

RETURN NEW;
end;
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_ger_carga_inicial_after() FROM PUBLIC;

CREATE TRIGGER ger_carga_inicial_after
	AFTER INSERT OR UPDATE ON ger_carga_inicial FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_ger_carga_inicial_after();

