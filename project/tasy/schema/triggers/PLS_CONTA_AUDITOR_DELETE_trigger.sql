-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS pls_conta_auditor_delete ON pls_conta_auditor CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_pls_conta_auditor_delete() RETURNS trigger AS $BODY$
declare
ds_log_call_w		varchar(1500);
ds_observacao_w		varchar(4000);

BEGIN

	ds_log_call_w := substr(pls_obter_detalhe_exec(false),1,1500);
	ds_observacao_w :=	'Análise: '||OLD.nr_seq_analise||chr(13)||chr(10)||
				'Grupo membro méd.: '||OLD.nr_seq_grupo_membro_med||chr(13)||chr(10)||
				'Grupo membro enf.: '||OLD.nr_seq_grupo_membro_enf;
	
	insert into plsprco_cta(	nr_sequencia, dt_atualizacao, nm_usuario,
					dt_atualizacao_nrec, nm_usuario_nrec, nm_tabela,
					ds_log, ds_log_call, ds_funcao_ativa, nr_seq_conta,
					ie_aplicacao_tasy, nm_maquina, ie_opcao )
			values (	nextval('plsprco_cta_seq'), LOCALTIMESTAMP, substr(coalesce(wheb_usuario_pck.get_nm_usuario,'Usuário não identificado '),1,14),
					LOCALTIMESTAMP, substr(coalesce(wheb_usuario_pck.get_nm_usuario,'Usuário não identificado '),1,14), 'PLS_CONTA_AUDITOR',
					ds_observacao_w, ds_log_call_w, obter_funcao_ativa, OLD.nr_seq_conta,
					pls_se_aplicacao_tasy, wheb_usuario_pck.get_machine, '0');

RETURN OLD;
end;
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_pls_conta_auditor_delete() FROM PUBLIC;

CREATE TRIGGER pls_conta_auditor_delete
	BEFORE DELETE ON pls_conta_auditor FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_pls_conta_auditor_delete();

