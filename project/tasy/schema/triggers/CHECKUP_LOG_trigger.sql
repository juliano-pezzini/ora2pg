-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS checkup_log ON checkup CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_checkup_log() RETURNS trigger AS $BODY$
DECLARE

ds_old_values_w		varchar(4000) := '';
ds_new_values_w		varchar(4000) := '';
nm_atributo_w		varchar(50);
ds_label_w			varchar(50);
ie_tipo_atributo_w	varchar(10);
ie_obs_mudou_w		varchar(1) := 'N';
ie_tipo_log_w		varchar(10);


nm_usuario_w		varchar(50);
cd_pessoa_fisica_w	varchar(10);
nr_sequencia_w		bigint;
nr_atendimento_w	bigint;
dt_previsto_w		timestamp;
dt_atualizacao_w    timestamp := LOCALTIMESTAMP;

c01 CURSOR FOR
	SELECT NM_ATRIBUTO,
		CASE WHEN CD_EXP_LABEL IS NULL THEN  NM_ATRIBUTO  ELSE OBTER_DESC_EXPRESSAO(CD_EXP_LABEL) END  DS_LABEL, 
		IE_TIPO_ATRIBUTO
	from tabela_atributo 
	where nm_tabela = 'CHECKUP'
	  and ie_tipo_atributo not in ('FUNCTION', 'VISUAL')
	order by nm_atributo;

BEGIN

if (wheb_usuario_pck.get_ie_executar_trigger = 'S') then

if (Obter_Valor_Param_Usuario(996, 70, wheb_usuario_pck.get_cd_perfil, wheb_usuario_pck.get_nm_usuario, wheb_usuario_pck.get_cd_estabelecimento) = 'S') then
	if TG_OP = 'UPDATE' then
		open c01;
		loop
		fetch c01 into
			nm_atributo_w,
			ds_label_w,
			ie_tipo_atributo_w;
		EXIT WHEN NOT FOUND; /* apply on c01 */
			
			if (TG_OP = 'UPDATE' AND NEW.nm_atributo_w IS DISTINCT FROM OLD.nm_atributo_w) then

				if (nm_atributo_w = 'DS_OBSERVACAO') then
					ie_obs_mudou_w := 'S';
				end if;
				
				if (nm_atributo_w = 'NM_USUARIO_ORIGINAL') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.NM_USUARIO_ORIGINAL, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.NM_USUARIO_ORIGINAL, 1, 4000);
				elsif (nm_atributo_w = 'NM_USUARIO_CANCEL') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.NM_USUARIO_CANCEL, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.NM_USUARIO_CANCEL, 1, 4000);
				elsif (nm_atributo_w = 'NM_CONTATO_CANCEL') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.NM_CONTATO_CANCEL, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.NM_CONTATO_CANCEL, 1, 4000);
				elsif (nm_atributo_w = 'NR_SEQUENCIA') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.NR_SEQUENCIA, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.NR_SEQUENCIA, 1, 4000);
				elsif (nm_atributo_w = 'DT_ATUALIZACAO') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || to_char(NEW.DT_ATUALIZACAO, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || to_char(OLD.DT_ATUALIZACAO, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				elsif (nm_atributo_w = 'NM_USUARIO') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.NM_USUARIO, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.NM_USUARIO, 1, 4000);
				elsif (nm_atributo_w = 'CD_PESSOA_FISICA') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.CD_PESSOA_FISICA, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.CD_PESSOA_FISICA, 1, 4000);
				elsif (nm_atributo_w = 'NR_ATENDIMENTO') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.NR_ATENDIMENTO, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.NR_ATENDIMENTO, 1, 4000);
				elsif (nm_atributo_w = 'CD_ESTABELECIMENTO') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.CD_ESTABELECIMENTO, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.CD_ESTABELECIMENTO, 1, 4000);
				elsif (nm_atributo_w = 'CD_SETOR_ATENDIMENTO') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.CD_SETOR_ATENDIMENTO, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.CD_SETOR_ATENDIMENTO, 1, 4000);
				elsif (nm_atributo_w = 'DT_PREVISTO') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || to_char(NEW.DT_PREVISTO, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || to_char(OLD.DT_PREVISTO, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				elsif (nm_atributo_w = 'DT_CONFIRMACAO') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || to_char(NEW.DT_CONFIRMACAO, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || to_char(OLD.DT_CONFIRMACAO, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				elsif (nm_atributo_w = 'NM_USUARIO_CONF') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.NM_USUARIO_CONF, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.NM_USUARIO_CONF, 1, 4000);
				elsif (nm_atributo_w = 'NM_CONTATO_CONF') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.NM_CONTATO_CONF, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.NM_CONTATO_CONF, 1, 4000);
				elsif (nm_atributo_w = 'NR_PRESCRICAO') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.NR_PRESCRICAO, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.NR_PRESCRICAO, 1, 4000);
				elsif (nm_atributo_w = 'DT_INICIO_REAL') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || to_char(NEW.DT_INICIO_REAL, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || to_char(OLD.DT_INICIO_REAL, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				elsif (nm_atributo_w = 'DT_FIM_REAL') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || to_char(NEW.DT_FIM_REAL, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || to_char(OLD.DT_FIM_REAL, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				elsif (nm_atributo_w = 'DT_ATUALIZACAO_NREC') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || to_char(NEW.DT_ATUALIZACAO_NREC, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || to_char(OLD.DT_ATUALIZACAO_NREC, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				elsif (nm_atributo_w = 'NM_USUARIO_NREC') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.NM_USUARIO_NREC, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.NM_USUARIO_NREC, 1, 4000);
				elsif (nm_atributo_w = 'DT_CANCELAMENTO') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || to_char(NEW.DT_CANCELAMENTO, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || to_char(OLD.DT_CANCELAMENTO, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				elsif (nm_atributo_w = 'DT_FIM_INTERNO') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || to_char(NEW.DT_FIM_INTERNO, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || to_char(OLD.DT_FIM_INTERNO, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				elsif (nm_atributo_w = 'DT_GERADO_AVAL') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || to_char(NEW.DT_GERADO_AVAL, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || to_char(OLD.DT_GERADO_AVAL, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				elsif (nm_atributo_w = 'DT_ENVIO_COMUNIC') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || to_char(NEW.DT_ENVIO_COMUNIC, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || to_char(OLD.DT_ENVIO_COMUNIC, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				elsif (nm_atributo_w = 'NR_SEQ_MOTIVO_CANCEL') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.NR_SEQ_MOTIVO_CANCEL, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.NR_SEQ_MOTIVO_CANCEL, 1, 4000);
				elsif (nm_atributo_w = 'DT_RESPOSTA_COMUNIC') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || to_char(NEW.DT_RESPOSTA_COMUNIC, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || to_char(OLD.DT_RESPOSTA_COMUNIC, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				elsif (nm_atributo_w = 'CD_CONVENIO') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.CD_CONVENIO, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.CD_CONVENIO, 1, 4000);
				elsif (nm_atributo_w = 'CD_CATEGORIA') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.CD_CATEGORIA, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.CD_CATEGORIA, 1, 4000);
				elsif (nm_atributo_w = 'CD_PLANO') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.CD_PLANO, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.CD_PLANO, 1, 4000);
				elsif (nm_atributo_w = 'CD_EMPRESA_REF') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.CD_EMPRESA_REF, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.CD_EMPRESA_REF, 1, 4000);
				elsif (nm_atributo_w = 'IE_ENCAIXE') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.IE_ENCAIXE, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.IE_ENCAIXE, 1, 4000);
				elsif (nm_atributo_w = 'NR_SEQ_PRIORIDADE') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.NR_SEQ_PRIORIDADE, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.NR_SEQ_PRIORIDADE, 1, 4000);
				elsif (nm_atributo_w = 'NR_SEQ_TIPO_CHECKUP') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.NR_SEQ_TIPO_CHECKUP, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.NR_SEQ_TIPO_CHECKUP, 1, 4000);
				elsif (nm_atributo_w = 'IE_AUTORIZADO') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.IE_AUTORIZADO, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.IE_AUTORIZADO, 1, 4000);
				elsif (nm_atributo_w = 'NR_TELEFONE') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.NR_TELEFONE, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.NR_TELEFONE, 1, 4000);
				elsif (nm_atributo_w = 'DT_AGENDAMENTO') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || to_char(NEW.DT_AGENDAMENTO, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || to_char(OLD.DT_AGENDAMENTO, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				elsif (nm_atributo_w = 'IE_STATUS_AGENDA') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.IE_STATUS_AGENDA, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.IE_STATUS_AGENDA, 1, 4000);
				elsif (nm_atributo_w = 'DT_VALIDADE_CARTEIRA') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || to_char(NEW.DT_VALIDADE_CARTEIRA, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || to_char(OLD.DT_VALIDADE_CARTEIRA, 'DD/MM/YYYY hh24:mi:ss') , 1, 4000);
				elsif (nm_atributo_w = 'CD_USUARIO_CONVENIO') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.CD_USUARIO_CONVENIO, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.CD_USUARIO_CONVENIO, 1, 4000);
				elsif (nm_atributo_w = 'NR_SEQ_PAC_SENHA_FILA') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.NR_SEQ_PAC_SENHA_FILA, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.NR_SEQ_PAC_SENHA_FILA, 1, 4000);
				elsif (nm_atributo_w = 'NR_DDI') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.NR_DDI, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.NR_DDI, 1, 4000);
				elsif (nm_atributo_w = 'IE_TRANSFERENCIA') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.IE_TRANSFERENCIA, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.IE_TRANSFERENCIA, 1, 4000);
				elsif (nm_atributo_w = 'IE_EXCLUSIVO') then
				  ds_new_values_w := substr(ds_new_values_w || ' | '|| ds_label_w || ': ' || NEW.IE_EXCLUSIVO, 1, 4000);
				  ds_old_values_w := substr(ds_old_values_w || ' | '|| ds_label_w || ': ' || OLD.IE_EXCLUSIVO, 1, 4000);
				end if;

			end if;

		end loop;
		close c01;
		if (coalesce(length(ds_old_values_w), 0) > 0 or coalesce(length(ds_new_values_w), 0) > 0) then

			ds_old_values_w := substr(ds_old_values_w, 4, 4000);
			ds_new_values_w := substr(ds_new_values_w, 4, 4000);

			insert into log_checkup(
				nr_sequencia,
				dt_log,
				nm_usuario,
				nm_usuario_nrec,
				cd_pessoa_fisica,
				ie_tipo_log,
				nm_tabela,
				nr_seq_tabela,
				ds_log_anterior,
				ds_log_novo,
				ds_obs_anterior,
				ds_obs_novo,
				cd_estabelecimento,
				cd_setor_atendimento,
				dt_atualizacao,
				dt_atualizacao_nrec)
			values (
				nextval('log_checkup_seq'),
				dt_atualizacao_w,
				NEW.nm_usuario,
				NEW.nm_usuario,
				NEW.cd_pessoa_fisica,
				'UPDATE',
				'CHECKUP',
				NEW.nr_sequencia,
				ds_old_values_w,
				ds_new_values_w,
				CASE WHEN ie_obs_mudou_w='S' THEN  OLD.DS_OBSERVACAO  ELSE null END ,
				CASE WHEN ie_obs_mudou_w='S' THEN  NEW.DS_OBSERVACAO  ELSE null END ,
				obter_estabelecimento_ativo,
				obter_setor_ativo,
				dt_atualizacao_w,
				dt_atualizacao_w);
		end if;

	else
		if TG_OP = 'INSERT' then
			ie_tipo_log_w := 'INSERT';
			nm_usuario_w := NEW.nm_usuario;
			cd_pessoa_fisica_w := NEW.cd_pessoa_fisica;
			nr_sequencia_w := NEW.nr_sequencia;
			nr_atendimento_w := NEW.nr_atendimento;
			dt_previsto_w := NEW.dt_previsto;
		elsif TG_OP = 'DELETE' then
			ie_tipo_log_w := 'DELETE';
			nm_usuario_w := OLD.nm_usuario;
			cd_pessoa_fisica_w := OLD.cd_pessoa_fisica;
			nr_sequencia_w := OLD.nr_sequencia;
			nr_atendimento_w := OLD.nr_atendimento;
			dt_previsto_w := OLD.dt_previsto;
		end if;

		select CASE WHEN CD_EXP_LABEL IS NULL THEN  NM_ATRIBUTO  ELSE OBTER_DESC_EXPRESSAO(CD_EXP_LABEL) END  DS_LABEL
		into STRICT ds_label_w
		from tabela_atributo
		where nm_tabela = 'CHECKUP'
			and nm_atributo = 'NR_ATENDIMENTO';

		ds_new_values_w := ds_label_w || ': ' || nr_atendimento_w;
			
		
		select CASE WHEN CD_EXP_LABEL IS NULL THEN  NM_ATRIBUTO  ELSE OBTER_DESC_EXPRESSAO(CD_EXP_LABEL) END  DS_LABEL
		into STRICT ds_label_w
		from tabela_atributo
		where nm_tabela = 'CHECKUP'
		  and nm_atributo = 'DT_PREVISTO';

		ds_new_values_w := ds_new_values_w || ' | ' || ds_label_w || ': ' || to_char(dt_previsto_w, 'DD/MM/YYYY hh24:mi:ss');
		
		insert into log_checkup(
			nr_sequencia,
			dt_log,
			nm_usuario,
			nm_usuario_nrec,
			cd_pessoa_fisica,
			ie_tipo_log,
			nm_tabela,
			nr_seq_tabela,
			ds_log_anterior,
			ds_log_novo,
			DS_OBS_anterior,
			DS_OBS_novo,
			cd_estabelecimento,
			cd_setor_atendimento,
			dt_atualizacao,
			dt_atualizacao_nrec)
		values (
			nextval('log_checkup_seq'),
			dt_atualizacao_w,
			nm_usuario_w,
			nm_usuario_w,
			cd_pessoa_fisica_w,
			ie_tipo_log_w,
			'CHECKUP',
			nr_sequencia_w,
			null,
			ds_new_values_w,
			null,
			null,
			obter_estabelecimento_ativo,
			obter_setor_ativo,
			dt_atualizacao_w,
			dt_atualizacao_w);

	end if;
end if;
end if;
IF TG_OP = 'DELETE' THEN
	RETURN OLD;
ELSE
	RETURN NEW;
END IF;

END
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_checkup_log() FROM PUBLIC;

CREATE TRIGGER checkup_log
	AFTER INSERT OR UPDATE OR DELETE ON checkup FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_checkup_log();

