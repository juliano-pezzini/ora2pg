-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS escala_escala_crib_ii_atual ON escala_crib_ii CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_escala_escala_crib_ii_atual() RETURNS trigger AS $BODY$
DECLARE
    qt_reg_w         smallint;
    qt_resultado_w   bigint := 0;
    qt_resultado_ww  double precision := 0;
    qt_total_w       double precision := 0;
    qt_temp_w        bigint := 0;
    qt_base_w        bigint := 0;
    pr_score_w       double precision := 0;
    sql_w            varchar(600);
BEGIN
  BEGIN
    IF ( wheb_usuario_pck.get_ie_executar_trigger = 'N' ) THEN
        GOTO final;
    END IF;


    BEGIN
        sql_w := 'begin OBTER_PONT_TOT_ESCALA_CRIB_MD(:1, :2, :3, :4, :5, :6, :7, :8, :9, :10); end;';
        EXECUTE sql_w
            USING IN NEW.qt_temperatura, IN NEW.qt_base, IN NEW.ie_sexo, IN NEW.ie_idade_gest, IN NEW.qt_peso_rn, OUT qt_temp_w,
            OUT qt_resultado_ww, OUT qt_resultado_w, OUT qt_base_w, OUT NEW.qt_score;

    EXCEPTION
        WHEN OTHERS THEN
            NEW.qt_score := NULL;
    END;


      BEGIN
        sql_w := 'CALL obter_perc_tot_escala_crib_md (:1, :2, :3, :4) INTO :pr_score_p';
        EXECUTE sql_w
            USING IN qt_temp_w, IN qt_resultado_ww, qt_resultado_w, IN qt_base_w, OUT pr_score_w;
    EXCEPTION
        WHEN OTHERS THEN
            pr_score_w := NULL;
    END;

    NEW.pr_score := pr_score_w;



    << final >> qt_reg_w := 0;
  END;
RETURN NEW;
END
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_escala_escala_crib_ii_atual() FROM PUBLIC;

CREATE TRIGGER escala_escala_crib_ii_atual
	BEFORE INSERT OR UPDATE ON escala_crib_ii FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_escala_escala_crib_ii_atual();

