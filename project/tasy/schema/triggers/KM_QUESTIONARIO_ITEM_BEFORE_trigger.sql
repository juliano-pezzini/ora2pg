-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS km_questionario_item_before ON km_questionario_item CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_km_questionario_item_before() RETURNS trigger AS $BODY$
declare

ds_variavel_w	varchar(4000);

BEGIN

if (wheb_usuario_pck.get_ie_executar_trigger = 'S')  then
	BEGIN
	if (phi_is_base_philips = 'S') then
		BEGIN
		if (coalesce(OLD.cd_exp_item, -1) <> coalesce(NEW.cd_exp_item, -1)) then
			BEGIN
			NEW.nr_seq_item_origem := null;
			end;
		elsif	((OLD.cd_exp_item is null and NEW.cd_exp_item is null) and
			coalesce(OLD.ds_item, 'X') <> coalesce(NEW.ds_item, 'X')) then
			BEGIN
			NEW.nr_seq_item_origem := null;
			end;
		end if;
		end;
	end if;
	end;
end if;

RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_km_questionario_item_before() FROM PUBLIC;

CREATE TRIGGER km_questionario_item_before
	BEFORE UPDATE ON km_questionario_item FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_km_questionario_item_before();

