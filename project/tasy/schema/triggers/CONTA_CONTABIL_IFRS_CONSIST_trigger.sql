-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS conta_contabil_ifrs_consist ON conta_contabil_ifrs CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_conta_contabil_ifrs_consist() RETURNS trigger AS $BODY$
declare
BEGIN
if (wheb_usuario_pck.get_ie_executar_trigger = 'S') then
    if ((trunc(LOCALTIMESTAMP) between trunc(NEW.dt_inicio_vigencia) and trunc(NEW.dt_fim_vigencia)) or (NEW.dt_inicio_vigencia is null and NEW.dt_fim_vigencia is null)) then
        NEW.ie_situacao := 'A';
    elsif ((trunc(LOCALTIMESTAMP) >= trunc(NEW.dt_inicio_vigencia) and NEW.dt_fim_vigencia is null) or (trunc(LOCALTIMESTAMP) <= trunc(NEW.dt_fim_vigencia) and NEW.dt_inicio_vigencia is null)) then
        NEW.ie_situacao := 'A';
    else
        NEW.ie_situacao := 'I';
    end if;
end if;

RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_conta_contabil_ifrs_consist() FROM PUBLIC;

CREATE TRIGGER conta_contabil_ifrs_consist
	BEFORE INSERT OR UPDATE ON conta_contabil_ifrs FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_conta_contabil_ifrs_consist();

