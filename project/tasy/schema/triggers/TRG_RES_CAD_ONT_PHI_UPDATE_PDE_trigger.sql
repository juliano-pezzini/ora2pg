-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS trg_res_cad_ont_phi_update_pde ON res_cadastro_ontologia_phi CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_trg_res_cad_ont_phi_update_pde() RETURNS trigger AS $BODY$
BEGIN
  BEGIN
  IF (wheb_usuario_pck.get_ie_executar_trigger = 'S') THEN
    UPDATE PDE_ATTRIBUTE PA
       SET PA.CD_ONTOLOGIA  = NEW.CD_VALOR_ONTOLOGIA,
           PA.CD_ONTOLOGIA2 = NEW.CD_VALOR_ONTOLOGIA2,
           PA.CD_ONTOLOGIA3 = NEW.CD_VALOR_ONTOLOGIA3,
           PA.CD_ONTOLOGIA4 = NEW.CD_VALOR_ONTOLOGIA4,
           PA.CD_ONTOLOGIA5 = NEW.CD_VALOR_ONTOLOGIA5,
           PA.CD_ONTOLOGIA6 = NEW.CD_VALOR_ONTOLOGIA6,
           PA.CD_ONTOLOGIA7 = NEW.CD_VALOR_ONTOLOGIA7
     WHERE PA.NR_SEQ_RES_CAD_ONT = NEW.NR_SEQUENCIA;
  END IF;
EXCEPTION
  WHEN OTHERS THEN
    CALL PDE.GRAVA_LOG_ERRO('TRG_RES_CAD_ONT_PHI_UPDATE_PDE',
                       'NR_SEQUENCIA: ' || NEW.NR_SEQUENCIA ||
                       ', NM_TABELA: ' || NEW.NM_TABELA ||
                       ', NM_ATRIBUTO: ' || NEW.NM_ATRIBUTO,
                       SQLSTATE,
                       SQLERRM);
  END;
RETURN NEW;
END
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_trg_res_cad_ont_phi_update_pde() FROM PUBLIC;

CREATE TRIGGER trg_res_cad_ont_phi_update_pde
	AFTER UPDATE OF cd_valor_ontologia,cd_valor_ontologia2,cd_valor_ontologia3,cd_valor_ontologia4,cd_valor_ontologia5,cd_valor_ontologia6,cd_valor_ontologia7 ON res_cadastro_ontologia_phi FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_trg_res_cad_ont_phi_update_pde();

