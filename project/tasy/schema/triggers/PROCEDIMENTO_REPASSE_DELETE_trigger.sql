-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS procedimento_repasse_delete ON procedimento_repasse CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_procedimento_repasse_delete() RETURNS trigger AS $BODY$
declare

ie_status_w	varchar(255);

BEGIN
if (wheb_usuario_pck.get_ie_executar_trigger	= 'S')  then
	if (OLD.nr_repasse_terceiro is not null) then

		select 	ie_status
		into STRICT 	ie_status_w
		from 	repasse_terceiro
		where 	nr_repasse_terceiro = OLD.nr_repasse_terceiro;

		if (ie_status_w = 'F') then
			/* Este procedimento já está vinculado à um repasse!
			Não é possível excluir este procedimento.
			Repasse: #@NR_REPASSE_TERCEIRO#@ */
			CALL wheb_mensagem_pck.exibir_mensagem_abort(266950, 'NR_REPASSE_TERCEIRO=' || OLD.nr_repasse_terceiro);
		end if;
	end if;
end if;
RETURN OLD;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_procedimento_repasse_delete() FROM PUBLIC;

CREATE TRIGGER procedimento_repasse_delete
	BEFORE DELETE ON procedimento_repasse FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_procedimento_repasse_delete();

