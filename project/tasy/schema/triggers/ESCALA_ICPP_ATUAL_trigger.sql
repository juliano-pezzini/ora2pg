-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS escala_icpp_atual ON escala_icpp CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_escala_icpp_atual() RETURNS trigger AS $BODY$
declare

BEGIN
NEW.qt_pontos := 0;

-- Participação do acompanhante
if (NEW.IE_PART_ACOMP = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 1;
elsif (NEW.IE_PART_ACOMP2 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 2;
elsif (NEW.IE_PART_ACOMP3 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 3;
elsif (NEW.IE_PART_ACOMP4 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 4;
end if;

-- Rede de apoio e suporte familiar
if (NEW.IE_APOIO_FAM = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 1;
elsif (NEW.IE_APOIO_FAM2 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 2;
elsif (NEW.IE_APOIO_FAM3 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 3;
elsif (NEW.IE_APOIO_FAM4 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 4;
end if;

-- Atividade
if (NEW.IE_ATIVIDADE = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 1;
elsif (NEW.IE_ATIVIDADE2 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 2;
elsif (NEW.IE_ATIVIDADE3 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 3;
elsif (NEW.IE_ATIVIDADE4 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 4;
end if;

-- Oxigenação
if (NEW.IE_OXIGENACAO = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 1;
elsif (NEW.IE_OXIGENACAO2 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 2;
elsif (NEW.IE_OXIGENACAO3 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 3;
elsif (NEW.IE_OXIGENACAO4 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 4;
end if;

-- Mobilidade e deambulação
if (NEW.IE_MOB_DEAM = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 1;
elsif (NEW.IE_MOB_DEAM2 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 2;
elsif (NEW.IE_MOB_DEAM3 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 3;
elsif (NEW.IE_MOB_DEAM4 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 4;
end if;

-- Alimentação e  hidratação
if (NEW.IE_ALIM_HID = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 1;
elsif (NEW.IE_ALIM_HID2 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 2;
elsif (NEW.IE_ALIM_HID3 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 3;
elsif (NEW.IE_ALIM_HID4 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 4;
end if;

-- Eliminações
if (NEW.IE_ELIMINICACAO = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 1;
elsif (NEW.IE_ELIMINICACAO2 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 2;
elsif (NEW.IE_ELIMINICACAO3 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 3;
elsif (NEW.IE_ELIMINICACAO4 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 4;
end if;

-- Higiene e cuidado corporal
if (NEW.IE_HIG_CORP = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 1;
elsif (NEW.IE_HIG_CORP2 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 2;
elsif (NEW.IE_HIG_CORP3 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 3;
elsif (NEW.IE_HIG_CORP4 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 4;
end if;

-- Intervalo de aferição de controles
if (NEW.IE_INT_CONTROLE = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 1;
elsif (NEW.IE_INT_CONTROLE2 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 2;
elsif (NEW.IE_INT_CONTROLE3 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 3;
elsif (NEW.IE_INT_CONTROLE4 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 4;
end if;

-- Terapêutica medicamentosa
if (NEW.IE_TERAP_MED = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 1;
elsif (NEW.IE_TERAP_MED2 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 2;
elsif (NEW.IE_TERAP_MED3 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 3;
elsif (NEW.IE_TERAP_MED4 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 4;
end if;

-- Integridade cutâneo mucosa
if (NEW.IE_INTEGRIDADE = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 1;
elsif (NEW.IE_INTEGRIDADE2 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 2;
elsif (NEW.IE_INTEGRIDADE3 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 3;
elsif (NEW.IE_INTEGRIDADE4 = 'S') then
	NEW.qt_pontos := NEW.qt_pontos + 4;
end if;

RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_escala_icpp_atual() FROM PUBLIC;

CREATE TRIGGER escala_icpp_atual
	BEFORE INSERT OR UPDATE ON escala_icpp FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_escala_icpp_atual();

