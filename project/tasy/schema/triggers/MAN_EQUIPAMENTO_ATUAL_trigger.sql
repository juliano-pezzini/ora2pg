-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS man_equipamento_atual ON man_equipamento CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_man_equipamento_atual() RETURNS trigger AS $BODY$
DECLARE

BEGIN
if (OLD.nm_usuario is not null) then
	insert into man_equipamento_alteracao(
			nr_sequencia,
			ds_equipamento,
			nr_seq_local,
			nr_seq_tipo_equip,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_planej,
			nr_seq_trab,
			ie_situacao,
			cd_imobilizado,
			cd_impacto,
			cd_estab_contabil,
			cd_imobilizado_ext,
			cd_centro_custo,
			ie_voltagem,
			dt_ano_fabricacao,
			ds_marca,
			ds_modelo,
			nr_serie,
			qt_peso,
			nr_seq_fabricante,
			nr_seq_superior,
			cd_nacionalidade,
			nr_seq_categoria,
			nr_seq_status,
			cd_fornecedor,
			dt_aquisicao,
			vl_aquisicao,
			cd_moeda,
			vl_custo_sem_utilizacao,
			ie_controle_setor,
			dt_inicio_garantia,
			dt_fim_garantia,
			nr_doc_garantia,
			nr_seq_contador,
			ie_rotina_seguranca,
			ds_padrao_os,
			ie_disponibilidade,
			ie_propriedade,
			ds_observacao,
			cd_cgc_terc,
			ie_parado,
			cd_pessoa_terceiro,
			ie_calibracao,
			ds_endereco,
			ie_tensao_dc,
			ie_tensao_ac,
			nr_seq_equipamento,
			ie_prioridade,
			qt_corrente_ac,
			qt_potencia_ac,
			qt_corrente_dc,
			qt_potencia_dc,
			nr_seq_marca,
			nr_seq_modelo,
			qt_largura,
			qt_comprimento,
			qt_altura,
			ie_tensao_dc_saida,
			ie_tensao_ac_saida,
			qt_corrente_ac_saida,
			qt_corrente_dc_saida,
			qt_potencia_ac_saida,
			qt_potencia_dc_saida,
			ds_observacao_tensao)
		values (	nextval('man_equipamento_alteracao_seq'),
			OLD.ds_equipamento,
			OLD.nr_seq_local,
			OLD.nr_seq_tipo_equip,
			LOCALTIMESTAMP,
			OLD.nm_usuario,
			OLD.dt_atualizacao_nrec,
			OLD.nm_usuario_nrec,
			OLD.nr_seq_planej,
			OLD.nr_seq_trab,
			OLD.ie_situacao,
			OLD.cd_imobilizado,
			OLD.cd_impacto,
			OLD.cd_estab_contabil,
			OLD.cd_imobilizado_ext,
			OLD.cd_centro_custo,
			OLD.ie_voltagem,
			OLD.dt_ano_fabricacao,
			OLD.ds_marca,
			OLD.ds_modelo,
			OLD.nr_serie,
			OLD.qt_peso,
			OLD.nr_seq_fabricante,
			OLD.nr_seq_superior,
			OLD.cd_nacionalidade,
			OLD.nr_seq_categoria,
			OLD.nr_seq_status,
			OLD.cd_fornecedor,
			OLD.dt_aquisicao,
			OLD.vl_aquisicao,
			OLD.cd_moeda,
			OLD.vl_custo_sem_utilizacao,
			OLD.ie_controle_setor,
			OLD.dt_inicio_garantia,
			OLD.dt_fim_garantia,
			OLD.nr_doc_garantia,
			OLD.nr_seq_contador,
			OLD.ie_rotina_seguranca,
			OLD.ds_padrao_os,
			OLD.ie_disponibilidade,
			OLD.ie_propriedade,
			OLD.ds_observacao,
			OLD.cd_cgc_terc,
			OLD.ie_parado,
			OLD.cd_pessoa_terceiro,
			OLD.ie_calibracao,
			OLD.ds_endereco,
			OLD.ie_tensao_dc,
			OLD.ie_tensao_ac,
			OLD.nr_sequencia,
			OLD.ie_prioridade,
			OLD.qt_corrente_ac,
			OLD.qt_potencia_ac,
			OLD.qt_corrente_dc,
			OLD.qt_potencia_dc,
			OLD.nr_seq_marca,
			OLD.nr_seq_modelo,
			OLD.qt_largura,
			OLD.qt_comprimento,
			OLD.qt_altura,
			OLD.ie_tensao_dc_saida,
			OLD.ie_tensao_ac_saida,
			OLD.qt_corrente_ac_saida,
			OLD.qt_corrente_dc_saida,
			OLD.qt_potencia_ac_saida,
			OLD.qt_potencia_dc_saida,
			OLD.ds_observacao_tensao);
end if;

RETURN NEW;
END
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_man_equipamento_atual() FROM PUBLIC;

CREATE TRIGGER man_equipamento_atual
	AFTER INSERT OR UPDATE ON man_equipamento FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_man_equipamento_atual();

