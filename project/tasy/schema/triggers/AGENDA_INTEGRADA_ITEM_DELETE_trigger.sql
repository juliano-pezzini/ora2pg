-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS agenda_integrada_item_delete ON agenda_integrada_item CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_agenda_integrada_item_delete() RETURNS trigger AS $BODY$
DECLARE

qt_reg_w	smallint;

BEGIN
select coalesce(max(1), 0)
into STRICT qt_reg_w
from ageint_Exame_associado
where	nr_Seq_ageint_item	= OLD.nr_sequencia;

if (qt_reg_w = 1) then
	delete	FROM ageint_Exame_associado
	where	nr_Seq_ageint_item	= OLD.nr_sequencia;
end if;

select coalesce(max(1), 0)
into STRICT qt_reg_w
from ageint_exame_adic_item
where	nr_seq_item	= OLD.nr_sequencia;

if (qt_reg_w = 1) then
	delete	FROM ageint_exame_adic_item
	where	nr_seq_item	= OLD.nr_sequencia;
end if;

delete from agendamento_coletivo
where 	nr_seq_ag_integrada = OLD.nr_seq_agenda_int
and     nr_seq_agenda_int = OLD.nr_sequencia;

RETURN OLD;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_agenda_integrada_item_delete() FROM PUBLIC;

CREATE TRIGGER agenda_integrada_item_delete
	BEFORE DELETE ON agenda_integrada_item FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_agenda_integrada_item_delete();

