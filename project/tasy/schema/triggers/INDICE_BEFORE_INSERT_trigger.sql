-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS indice_before_insert ON indice CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_indice_before_insert() RETURNS trigger AS $BODY$
DECLARE
ds_user_w varchar(100);
BEGIN
select max(USERNAME)
 into STRICT ds_user_w
 from v$session
 where  audsid = (SELECT userenv('sessionid') );
if (ds_user_w = 'TASY') then

if (NEW.ie_classificacao is null) then

	if (NEW.ie_tipo in ('PK','UK')) or (NEW.nm_indice like '%_FK') or (NEW.nm_indice like '%_FK%_I%') then

		NEW.ie_classificacao := 'IR';

	elsif (NEW.ie_tipo = 'IU') or (NEW.nm_indice like '%_I') or (NEW.nm_indice like '%_I_') or (NEW.nm_indice like '%_I__') or
		(NEW.ie_tipo = 'I' AND NEW.nm_indice like '%_UK') then

		NEW.ie_classificacao := 'IS';

	end	if;

end	if;
end	if;
RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_indice_before_insert() FROM PUBLIC;

CREATE TRIGGER indice_before_insert
	BEFORE INSERT ON indice FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_indice_before_insert();

