-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS lote_ent_rec_item_upd_ins ON lote_ent_reconvocado_item CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_lote_ent_rec_item_upd_ins() RETURNS trigger AS $BODY$
declare

break varchar(2):= chr(13) || chr(10);

BEGIN

    if NEW.ie_tipo_busca is null then

        CALL gravar_log_lab_pragma(
            cd_log_p => 55,
             ds_log_p => dbms_utility.format_call_stack || break || break ||
                 'nr_sequencia : '           || coalesce(to_char(NEW.nr_sequencia), 'null') || break ||
                 'dt_atualizacao : '         || coalesce(to_char(NEW.dt_atualizacao, 'ddmmyyyy hh24miss'), 'null') || break ||
                 'nm_usuario : '             || coalesce(to_char(NEW.nm_usuario), 'null') || break ||
                 'dt_atualizacao_nrec : '    || coalesce(to_char(NEW.dt_atualizacao_nrec, 'ddmmyyyy hh24miss'), 'null') || break ||
                 'nm_usuario_nrec : '        || coalesce(to_char(NEW.nm_usuario_nrec), 'null') || break ||
                 'nr_seq_reconvocado : '     || coalesce(to_char(NEW.nr_seq_reconvocado), 'null') || break ||
                 'nr_seq_exame : '           || coalesce(to_char(NEW.nr_seq_exame), 'null') || break ||
                 'cd_material_exame : '      || coalesce(to_char(NEW.cd_material_exame), 'null') || break ||
                 'nr_prescricao : '          || coalesce(to_char(NEW.nr_prescricao), 'null') || break ||
                 'nr_seq_prescr : '          || coalesce(to_char(NEW.nr_seq_prescr), 'null') || break ||
                 'dt_prevista : '            || coalesce(to_char(NEW.dt_prevista, 'ddmmyyyy hh24miss'), 'null') || break ||
                 'ie_tipo_busca : '          || coalesce(to_char(NEW.ie_tipo_busca), 'null') || break ||
                 'nr_seq_status_reconv : '   || coalesce(to_char(NEW.nr_seq_status_reconv), 'null') || break ||
                 'ie_urgencia : '            || coalesce(to_char(NEW.ie_urgencia), 'null'),
            nm_usuario_p => coalesce(NEW.nm_usuario, wheb_usuario_pck.get_nm_usuario()),
            nr_prescricao_p => coalesce(NEW.nr_prescricao, 55),
            ds_integracao_p => coalesce(NEW.nr_seq_prescr, 55)
        );

        -- Nao foi possivel identificar o tipo de busca, por favor contate o suporte tecnico.

        CALL wheb_mensagem_pck.exibir_mensagem_abort(1108405);

    end if;

RETURN NEW;
end;
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_lote_ent_rec_item_upd_ins() FROM PUBLIC;

CREATE TRIGGER lote_ent_rec_item_upd_ins
	BEFORE INSERT OR UPDATE ON lote_ent_reconvocado_item FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_lote_ent_rec_item_upd_ins();

