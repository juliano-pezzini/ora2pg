-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS pls_prestador_plano_atual ON pls_prestador_plano CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_pls_prestador_plano_atual() RETURNS trigger AS $BODY$
declare
cd_estabelecimento_plano_w      pls_plano.cd_estabelecimento%type;
cd_estabelecimento_prestador_w  pls_prestador.cd_estabelecimento%type;

BEGIN
if (NEW.nr_seq_plano is not null) then
	select	max(a.cd_estabelecimento)
	into STRICT	cd_estabelecimento_plano_w
	from	pls_plano a
	where	a.nr_sequencia = NEW.nr_seq_plano;
end if;

if (NEW.nr_seq_prestador is not null) then
	select  max(b.cd_estabelecimento)
	into STRICT    cd_estabelecimento_prestador_w
	from    pls_prestador b
	where   b.nr_sequencia = NEW.nr_seq_prestador;
end if;

if (cd_estabelecimento_plano_w != cd_estabelecimento_prestador_w) then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(1063764);
end if;
	
RETURN NEW;
end;
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_pls_prestador_plano_atual() FROM PUBLIC;

CREATE TRIGGER pls_prestador_plano_atual
	BEFORE INSERT OR UPDATE ON pls_prestador_plano FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_pls_prestador_plano_atual();

