-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS lib_material_paciente_insert ON lib_material_paciente CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_lib_material_paciente_insert() RETURNS trigger AS $BODY$
declare
nr_sequencia_w	bigint;
 
BEGIN 
 
select	nextval('lib_material_paciente_hist_seq') 
into STRICT	nr_sequencia_w
;
 
insert into lib_material_paciente_hist( 
	nr_sequencia, 
	dt_atualizacao, 
	nm_usuario, 
	cd_pessoa_fisica, 
	cd_material, 
	dt_acao, 
	cd_pessoa_acao, 
	ie_tipo_acao, 
	qt_dias_tratamento, 
	dt_inicio_validade) 
values ( 
	nr_sequencia_w, 
	LOCALTIMESTAMP, 
	NEW.nm_usuario, 
	NEW.cd_pessoa_fisica, 
	NEW.cd_material, 
	LOCALTIMESTAMP, 
	substr(obter_dados_usuario_opcao(NEW.nm_usuario,'C'),1,100), 
	'I', 
	NEW.qt_dias_tratamento, 
	NEW.dt_inicio_validade);
RETURN NEW;
END
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_lib_material_paciente_insert() FROM PUBLIC;

CREATE TRIGGER lib_material_paciente_insert
	AFTER INSERT ON lib_material_paciente FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_lib_material_paciente_insert();

