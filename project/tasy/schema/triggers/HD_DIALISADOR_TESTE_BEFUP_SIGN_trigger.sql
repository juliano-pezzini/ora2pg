-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS hd_dialisador_teste_befup_sign ON hd_dialisador_teste CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_hd_dialisador_teste_befup_sign() RETURNS trigger AS $BODY$
declare
nr_seq_assinatura_w	hd_assinatura_digital.nr_sequencia%type;

BEGIN

select 	max(nr_sequencia)
into STRICT	nr_seq_assinatura_w
from 	hd_assinatura_digital
where 	nr_seq_dial_teste = NEW.nr_sequencia
and 	ie_opcao = 'TI'
and	dt_liberacao is not null;

if (nr_seq_assinatura_w is not null)
	and (OLD.nr_sequencia			<> NEW.nr_sequencia
		or OLD.dt_atualizacao_nrec             <> NEW.dt_atualizacao_nrec
		or OLD.nm_usuario_nrec                 <> NEW.nm_usuario_nrec
		or OLD.nr_teste                        <> NEW.nr_teste
		or OLD.dt_teste                        <> NEW.dt_teste
		or OLD.ie_resultado                    <> NEW.ie_resultado
		or OLD.cd_pf_teste                     <> NEW.cd_pf_teste
		or OLD.nr_seq_dialise                  <> NEW.nr_seq_dialise
		or OLD.nr_seq_dialisador               <> NEW.nr_seq_dialisador
		or OLD.nr_seq_dialise_dialisador       <> NEW.nr_seq_dialise_dialisador
		or OLD.cd_estabelecimento              <> NEW.cd_estabelecimento
		or OLD.nr_seq_unid_dialise             <> NEW.nr_seq_unid_dialise
		or OLD.ie_pos_dialise                  <> NEW.ie_pos_dialise
		or (OLD.nr_sequencia			is null		and	NEW.nr_sequencia		is not null)
		or (OLD.dt_atualizacao_nrec		is null		and	NEW.dt_atualizacao_nrec	is not null)
		or (OLD.nm_usuario_nrec		is null		and	NEW.nm_usuario_nrec		is not null)
		or (OLD.nr_teste			is null		and	NEW.nr_teste			is not null)
		or (OLD.dt_teste			is null		and	NEW.dt_teste			is not null)
		or (OLD.ie_resultado			is null		and	NEW.ie_resultado		is not null)
		or (OLD.cd_pf_teste			is null		and	NEW.cd_pf_teste		is not null)
		or (OLD.nr_seq_dialise			is null		and	NEW.nr_seq_dialise		is not null)
		or (OLD.nr_seq_dialisador		is null		and	NEW.nr_seq_dialisador		is not null)
		or (OLD.nr_seq_dialise_dialisador	is null		and	NEW.nr_seq_dialise_dialisador	is not null)
		or (OLD.cd_estabelecimento		is null		and	NEW.cd_estabelecimento		is not null)
		or (OLD.nr_seq_unid_dialise		is null		and	NEW.nr_seq_unid_dialise	is not null)
		or (OLD.ie_pos_dialise			is null		and	NEW.ie_pos_dialise		is not null)
		or (OLD.dt_atualizacao_nrec		is not null	and	NEW.dt_atualizacao_nrec	is null)
		or (OLD.nm_usuario_nrec		is not null	and	NEW.nm_usuario_nrec		is null)
		or (OLD.nr_teste			is not null	and	NEW.nr_teste			is null)
		or (OLD.dt_teste			is not null	and	NEW.dt_teste			is null)
		or (OLD.ie_resultado			is not null	and	NEW.ie_resultado		is null)
		or (OLD.cd_pf_teste			is not null	and	NEW.cd_pf_teste		is null)
		or (OLD.nr_seq_dialise			is not null	and	NEW.nr_seq_dialise		is null)
		or (OLD.nr_seq_dialisador		is not null	and	NEW.nr_seq_dialisador		is null)
		or (OLD.nr_seq_dialise_dialisador	is not null	and	NEW.nr_seq_dialise_dialisador	is null)
		or (OLD.cd_estabelecimento		is not null	and	NEW.cd_estabelecimento		is null)
		or (OLD.nr_seq_unid_dialise		is not null	and	NEW.nr_seq_unid_dialise	is null)
		or (OLD.ie_pos_dialise			is not null	and	NEW.ie_pos_dialise		is null)) then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(364485);
end if;

select 	max(nr_sequencia)
into STRICT	nr_seq_assinatura_w
from 	hd_assinatura_digital
where 	nr_seq_dial_teste = NEW.nr_sequencia
and 	ie_opcao = 'TII'
and	dt_liberacao is not null;

if (nr_seq_assinatura_w is not null)
	and (OLD.nr_sequencia			<> NEW.nr_sequencia
		or OLD.dt_atualizacao_nrec             <> NEW.dt_atualizacao_nrec
		or OLD.nm_usuario_nrec                 <> NEW.nm_usuario_nrec
		or OLD.nr_teste                        <> NEW.nr_teste
		or OLD.dt_teste                        <> NEW.dt_teste
		or OLD.ie_resultado                    <> NEW.ie_resultado
		or OLD.cd_pf_teste                     <> NEW.cd_pf_teste
		or OLD.nr_seq_dialise                  <> NEW.nr_seq_dialise
		or OLD.nr_seq_dialisador               <> NEW.nr_seq_dialisador
		or OLD.nr_seq_dialise_dialisador       <> NEW.nr_seq_dialise_dialisador
		or OLD.cd_estabelecimento              <> NEW.cd_estabelecimento
		or OLD.nr_seq_unid_dialise             <> NEW.nr_seq_unid_dialise
		or OLD.ie_pos_dialise                  <> NEW.ie_pos_dialise
		or (OLD.nr_sequencia			is null		and	NEW.nr_sequencia		is not null)
		or (OLD.dt_atualizacao_nrec		is null		and	NEW.dt_atualizacao_nrec	is not null)
		or (OLD.nm_usuario_nrec		is null		and	NEW.nm_usuario_nrec		is not null)
		or (OLD.nr_teste			is null		and	NEW.nr_teste			is not null)
		or (OLD.dt_teste			is null		and	NEW.dt_teste			is not null)
		or (OLD.ie_resultado			is null		and	NEW.ie_resultado		is not null)
		or (OLD.cd_pf_teste			is null		and	NEW.cd_pf_teste		is not null)
		or (OLD.nr_seq_dialise			is null		and	NEW.nr_seq_dialise		is not null)
		or (OLD.nr_seq_dialisador		is null		and	NEW.nr_seq_dialisador		is not null)
		or (OLD.nr_seq_dialise_dialisador	is null		and	NEW.nr_seq_dialise_dialisador	is not null)
		or (OLD.cd_estabelecimento		is null		and	NEW.cd_estabelecimento		is not null)
		or (OLD.nr_seq_unid_dialise		is null		and	NEW.nr_seq_unid_dialise	is not null)
		or (OLD.ie_pos_dialise			is null		and	NEW.ie_pos_dialise		is not null)
		or (OLD.dt_atualizacao_nrec		is not null	and	NEW.dt_atualizacao_nrec	is null)
		or (OLD.nm_usuario_nrec		is not null	and	NEW.nm_usuario_nrec		is null)
		or (OLD.nr_teste			is not null	and	NEW.nr_teste			is null)
		or (OLD.dt_teste			is not null	and	NEW.dt_teste			is null)
		or (OLD.ie_resultado			is not null	and	NEW.ie_resultado		is null)
		or (OLD.cd_pf_teste			is not null	and	NEW.cd_pf_teste		is null)
		or (OLD.nr_seq_dialise			is not null	and	NEW.nr_seq_dialise		is null)
		or (OLD.nr_seq_dialisador		is not null	and	NEW.nr_seq_dialisador		is null)
		or (OLD.nr_seq_dialise_dialisador	is not null	and	NEW.nr_seq_dialise_dialisador	is null)
		or (OLD.cd_estabelecimento		is not null	and	NEW.cd_estabelecimento		is null)
		or (OLD.nr_seq_unid_dialise		is not null	and	NEW.nr_seq_unid_dialise	is null)
		or (OLD.ie_pos_dialise			is not null	and	NEW.ie_pos_dialise		is null)) then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(364485);
end if;

RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_hd_dialisador_teste_befup_sign() FROM PUBLIC;

CREATE TRIGGER hd_dialisador_teste_befup_sign
	BEFORE UPDATE ON hd_dialisador_teste FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_hd_dialisador_teste_befup_sign();

