-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS exame_lab_material_delete ON exame_lab_material CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_exame_lab_material_delete() RETURNS trigger AS $BODY$
declare
cd_material_exame_w	varchar(20);
ie_deleta_w		bigint;

BEGIN

select cd_material_exame
into STRICT	cd_material_exame_w
from material_exame_lab
where nr_sequencia = OLD.nr_seq_material;

select count(*)
into STRICT ie_deleta_w
from prescr_procedimento
where nr_seq_exame		= OLD.nr_seq_exame
  and cd_material_exame	= cd_material_exame_w;

if (ie_deleta_w > 0) then
	/*Este material já foi utilizado em prescrição, não pode se excluído.' || chr(10) ||
						'Para não ser mais utilizado inative-o.');*/
	CALL Wheb_mensagem_pck.exibir_mensagem_abort(261631);
end if;

RETURN OLD;
END
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_exame_lab_material_delete() FROM PUBLIC;

CREATE TRIGGER exame_lab_material_delete
	BEFORE DELETE ON exame_lab_material FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_exame_lab_material_delete();

