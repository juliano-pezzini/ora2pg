-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS w_agenda_quimio_atual ON w_agenda_quimio CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_w_agenda_quimio_atual() RETURNS trigger AS $BODY$
declare

hr_quebra_turno_w		varchar(05);
hr_quebra_turno_not_w		varchar(05);
cd_turno_w			bigint := 0;

BEGIN

/*select	max(nvl(hr_quebra_turno, '12')),
	max(hr_quebra_noturno)
into	hr_quebra_turno_w,
	hr_quebra_turno_not_w
from	qt_local
where	nr_sequencia = :new.nr_seq_local;

:new.cd_turno := 0;

if	((to_number(to_char(:new.dt_horario, 'hh24')) > somente_numero(hr_quebra_turno_w)) or
	(to_number(to_char(:new.dt_horario, 'hh24')) = somente_numero(hr_quebra_turno_w))) then
	cd_turno_w	:= 1;
else
	cd_turno_w	:= 0;
end if;

if	(hr_quebra_turno_not_w is not null) and
	(to_number(to_char(:new.dt_horario, 'hh24')) >= somente_numero(hr_quebra_turno_not_w)) then
	cd_turno_w	:= 3;
end if;

if	(:new.cd_turno	<> cd_turno_w) then
	:new.cd_turno	:= cd_turno_w;
end if;*/
cd_turno_w	:= 0;

RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_w_agenda_quimio_atual() FROM PUBLIC;

CREATE TRIGGER w_agenda_quimio_atual
	BEFORE INSERT OR UPDATE ON w_agenda_quimio FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_w_agenda_quimio_atual();

