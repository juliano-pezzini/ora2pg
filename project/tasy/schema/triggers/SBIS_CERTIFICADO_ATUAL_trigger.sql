-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS sbis_certificado_atual ON sbis_certificado CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_sbis_certificado_atual() RETURNS trigger AS $BODY$
DECLARE

dt_default_w   timestamp  := LOCALTIMESTAMP + interval '10 days';

BEGIN

if (coalesce(OLD.DT_CERTIFICADO,dt_default_w) <> coalesce(NEW.DT_CERTIFICADO, dt_default_w) and (NEW.DT_CERTIFICADO is not null)) then
	NEW.dt_certificado_utc    := obter_data_utc(NEW.DT_certificado, 'HV');	
end if;	

RETURN NEW;
END;
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_sbis_certificado_atual() FROM PUBLIC;

CREATE TRIGGER sbis_certificado_atual
	BEFORE INSERT OR UPDATE ON sbis_certificado FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_sbis_certificado_atual();

