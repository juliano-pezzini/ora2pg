-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS escala_tev_hsl_atual ON escala_tev CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_escala_tev_hsl_atual() RETURNS trigger AS $BODY$
declare
qt_reg_w		bigint  := 0;
quebra_w		varchar(20)	:= Chr(13)||chr(10);
qt_imc_w		double precision;
ie_padrao_tev_w		varchar(10)	:= 'D';
qt_contra_prof_mec_w	bigint	:= 0;
qt_Nadroparina_w	varchar(50);
qt_contra_ind_relat_w	bigint	:= 0;
ie_condicao_w		varchar(1);

ie_cir_alto_risco_w		varchar(1);
ie_cir_pequeno_porte_w		varchar(1);
ie_cir_grande_medio_porte_w	varchar(1);
qt_absoluta_w			bigint := 0;
qt_relativa_w			bigint := 0;
qt_questao_5_w			bigint;

ie_artroplastia_joelho_w	varchar(1);
ie_artroplastia_quadril_w	varchar(1);
ie_fratura_quadril_w		varchar(1);
ie_oncol_curativa_w		varchar(1);
ie_trauma_medular_w		varchar(1);
ie_politrauma_w	 		varchar(1);

ds_texto_w			varchar(4000);
ds_motivo_w			varchar(255);

pragma autonomous_transaction;
	
	procedure	Inserir_Descricao_Idade is
	BEGIN

	if (NEW.qt_idade	< 40) then
		NEW.ds_resultado:= NEW.ds_resultado||Wheb_mensagem_pck.get_texto(308168)||quebra_w||Wheb_mensagem_pck.get_texto(308169);
							
							/*:new.ds_resultado||'Pacientes com idade menor de 40 anos e sem mobilidade reduzida nao necessitam rotineiramente de quimioprofilaxia ou metodos fisicos para prevencao de TEV.'||quebra_w||
							'Sua avaliacao de risco e individualizada, recomendando-se incentivo a deambulacao e reavaliacao posterior, caso permaneca internado.';*/

							
	end if;
	end;

	procedure inserir_texto_tipo_cirur is
	
	BEGIN
	ds_texto_w := null;
	
	if	((ie_artroplastia_quadril_w = 'S') or (ie_artroplastia_joelho_w = 'S')) then
		if (NEW.IE_PLAQUETOPENIA_HEPARINA	= 'S') then
			ds_texto_w := ds_texto_w ||  Wheb_mensagem_pck.get_texto(308170) /*'Opcao em artroplastia quadril/joelho:'*/
 || quebra_w || quebra_w ||Wheb_mensagem_pck.get_texto(308171) /*'Rivaroxabana VO 10 mg 1 X ao dia .'*/ || quebra_w || quebra_w;
		else
			ds_texto_w := ds_texto_w ||  Wheb_mensagem_pck.get_texto(308170) /*'Opcao em artroplastia quadril/joelho:'*/
 || quebra_w || quebra_w || Wheb_mensagem_pck.get_texto(308172) || ' ' /*'Dabigatrana VO 220 mg 1 X ao dia (110 mg na primeira dose, iniciando 1 a 4 h apos a cirurgia) '*/ ||
							Wheb_mensagem_pck.get_texto(308175)/*'ou Rivaroxabana VO 10 mg 1 X ao dia (iniciando 6 a 8 h apos a cirurgia).'*/
 || quebra_w || quebra_w;
		end if;
	end if;
	
	if (ie_cir_grande_medio_porte_w = 'S') then
		ds_texto_w	:= ds_texto_w || Wheb_mensagem_pck.get_texto(308177) /*'O uso desta quimioprofilaxia deve ser mantido por 7 a 10 dias.'*/
 || quebra_w;
	end if;
	
	if (ie_fratura_quadril_w = 'S') then
		ds_texto_w	:= ds_texto_w || Wheb_mensagem_pck.get_texto(308178) /*'O uso desta quimioprofilaxia deve ser mantido por 4 a 5 semanas.'*/
 || quebra_w;
	end if;
	
	if (ie_oncol_curativa_w = 'S') then
		ds_texto_w	:= ds_texto_w || Wheb_mensagem_pck.get_texto(308180) /*'O uso desta quimioprofilaxia deve ser mantido por 3 a 4 semanas.'*/
 || quebra_w;
	end if;
		
	if	((ie_trauma_medular_w = 'S') or (ie_politrauma_w = 'S')) then
		ds_texto_w	:= ds_texto_w || Wheb_mensagem_pck.get_texto(308181) /*'O uso desta quimioprofilaxia deve ser mantido ate a recuperacao do paciente.'*/
 || quebra_w;
	end if;

	if (ie_artroplastia_quadril_w = 'S') then
		ds_texto_w	:= ds_texto_w || Wheb_mensagem_pck.get_texto(308178) /*'O uso desta quimioprofilaxia deve ser mantido por 4 a 5 semanas.'*/
 || quebra_w;
	end if;
	
	if (ie_artroplastia_joelho_w = 'S') then
		ds_texto_w	:= ds_texto_w || Wheb_mensagem_pck.get_texto(308184) /*'O uso desta quimioprofilaxia deve ser mantido por pelo menos 10 dias.'*/
 || quebra_w;
	end if;
	
	NEW.ds_resultado	:= NEW.ds_resultado || ds_texto_w;
	
	end;	
	
	procedure inserir_texto_adic_cir is
	
	BEGIN
	ds_texto_w := 	quebra_w || quebra_w ||	Wheb_mensagem_pck.get_texto(308188);	
			
			/*'Pacientes provenientes do centro cirurgico com cateter peridural podem receber profilaxia medicamentosa,'||
			' desde que o cateter tenha sido posicionado ha pelo menos 2 horas. Para a retirada do cateter,'||
			' deve-se aguardar pelo menos 12 horas desde a ultima dose da medicacao e pelo menos 2 horas apos sua retirada,'||
			' para se administrar a proxima dose, respeitando o horario de administracao de cada medicacao.';*/

	
	NEW.ds_resultado	:= NEW.ds_resultado || ds_texto_w;
	end;
	
	procedure Inserir_Medicacao is

	BEGIN

	if (NEW.ie_risco	= 'A') then
		if (NEW.qt_peso	< 70) then
			qt_Nadroparina_w	:= '3.800';
		else
			qt_Nadroparina_w	:= '5.700';
		end if;
		NEW.ds_resultado	:= NEW.ds_resultado||quebra_w||quebra_w||Wheb_mensagem_pck.get_texto(308190)||' '||quebra_w||
								Wheb_mensagem_pck.get_texto(308192)||' '||quebra_w||
								Wheb_mensagem_pck.get_texto(308193)||' '||qt_Nadroparina_w||' '||Wheb_mensagem_pck.get_texto(308194)||quebra_w||
								Wheb_mensagem_pck.get_texto(308196)|| quebra_w || quebra_w||
								obter_desc_expressao(891564);	
		
						/*:new.ds_resultado||quebra_w||quebra_w||'Enoxaparina 40 mg SC 1 X ao dia ou '||quebra_w||
						'Dalteparina 5.000 UI SC 1 X ao dia ou '||quebra_w||
						'Nadroparina '||qt_Nadroparina_w||' UI SC 1 X ao dia ou'||quebra_w||
						'Heparina nao fracionada(HNF) 5.000 UI SC 3 X ao dia.';*/


	elsif (NEW.ie_risco	= 'M') then
		
		NEW.ds_resultado	:= NEW.ds_resultado||quebra_w||quebra_w||Wheb_mensagem_pck.get_texto(308197)||quebra_w||
							Wheb_mensagem_pck.get_texto(308198)||quebra_w||
							Wheb_mensagem_pck.get_texto(308199)||quebra_w||
							Wheb_mensagem_pck.get_texto(308200);
		
						/*:new.ds_resultado||quebra_w||quebra_w||'Enoxaparina 20 mg SC 1 vez ao dia ou'||quebra_w||
						'Dalteparina 2500 UI SC 1 vez ao dia ou'||quebra_w||
						'Nadroparina 1900-3800 UI SC 1 vez ao dia ou'||quebra_w||
						'Heparina nao fracionada (HNF) 5000 UI SC de 12/12 horas.';*/

		
	end if;
	
	if (NEW.ie_risco in ('A','M')) then
		NEW.ds_resultado	:= NEW.ds_resultado||quebra_w||quebra_w||Wheb_mensagem_pck.get_texto(308201); --'O uso desta quimioprofilaxia deve ser mantido por 6 a 14 dias ou enquanto persistir o risco.';
	end if;
	end;


	procedure Inserir_Contra_Indicacao is

	BEGIN

	if (NEW.IE_PLAQUETOPENIA_HEPARINA	= 'S') then
		NEW.ie_risco := 'A';
		NEW.IE_QUIMIOPROFILAXIA := 'A';
		NEW.IE_PROFILAXIA_MEC   := 'S';
		
		
		NEW.ds_resultado := 	Wheb_mensagem_pck.get_texto(308209)|| quebra_w || quebra_w ||
					Wheb_mensagem_pck.get_texto(308210) || quebra_w ||quebra_w||
					Wheb_mensagem_pck.get_texto(308211) || quebra_w || quebra_w||
					Wheb_mensagem_pck.get_texto(308213) ||' '||quebra_w || quebra_w||
					Wheb_mensagem_pck.get_texto(308214) || ' ';
					
					/*'Como o paciente apresenta contra-indicacao absoluta ao uso de heparinas, '||
		'recomendam-se metodos fisicos como meia elastica de compressao gradual (MECG), '||
		'dispositivos mecanicos de compressao pneumatica intermitente (CPI) ou bomba plantar (BP).'|| quebra_w || quebra_w ||
					'Optando-se pela quimioprofilaxia recomenda-se:' || quebra_w ||quebra_w||
					'Fondaparina (Arixtra) 2,5 mg SC 1 x ao dia.' || quebra_w || quebra_w||
					'Opcao para casos de artroplastia de quadril e joelho: '||quebra_w || quebra_w||
					'Rivaroxabana (Xarelto) 10 mg VO 1 x ao dia. ';*/

		
		--inserir_texto_adic_cir;

	elsif (NEW.IE_INSUF_RENAL	= 'S') then
		NEW.ie_risco := 'A';
		NEW.IE_QUIMIOPROFILAXIA := 'A';
		NEW.IE_PROFILAXIA_MEC   := 'S';
		NEW.ds_resultado := Wheb_mensagem_pck.get_texto(308216) || quebra_w || quebra_w ||
					obter_desc_expressao(891552) || quebra_w || quebra_w ||
					Wheb_mensagem_pck.get_texto(308218) || quebra_w ||quebra_w||
					Wheb_mensagem_pck.get_texto(308219) || quebra_w || quebra_w||
					Wheb_mensagem_pck.get_texto(308201) || quebra_w || quebra_w;
					
					/*'Como o paciente apresenta contra-indicacao relativa ao uso de ' || 
					'quimioprofilaxia para TEV, considerar o risco/beneficio de sua ' || 
					'introducao ou utilizar metodos fisicos como meia elastica de ' || 
					'compressao gradual (MECG), dispositivos mecanicos de compressao ' ||
					'pneumatica intermitente (CPI) ou bomba plantar (BP).' || quebra_w || quebra_w ||
					'Os metodos de profilaxia mecanica sugeridos devem ser mantidos por 18 horas, pelo menos, ao longo do dia.' ||quebra_w ||quebra_w
					'Optando-se pelo uso da heparina recomenda-se:' || quebra_w ||quebra_w||
					'Heparina nao fracionada HNF 5000 UI 2x ao dia e controle do TTPA.' || quebra_w || quebra_w||
					'O uso desta quimioprofilaxia deve ser mantido por 6 a 14 dias ou enquanto persistir o risco.' || quebra_w || quebra_w;*/

		
		--inserir_texto_tipo_cirur;

		--inserir_texto_adic_cir;

	elsif (ie_condicao_w	= 'S') and (qt_contra_prof_mec_w	= 0)then
		NEW.IE_QUIMIOPROFILAXIA := 'N';
		NEW.IE_PROFILAXIA_MEC    := 'S';	
		NEW.ds_resultado	:= 	Wheb_mensagem_pck.get_texto(308223);
		
		                /*'Como o paciente apresenta contra-indicacao absoluta ao uso de quimioprofilaxia para TEV, '||
						'recomendam-se metodos fisicos como meia elastica de compressao gradual (MECG), '||
						'dispositivos mecanicos de compressao pneumatica intermitente (CPI) ou bomba plantar (BP).';*/


	elsif (qt_contra_ind_relat_w	> 0) and (ie_condicao_w	= 'N') and (qt_contra_prof_mec_w	= 0) then
		NEW.IE_QUIMIOPROFILAXIA := 'A';
		NEW.IE_PROFILAXIA_MEC    := 'S';	
		NEW.ds_resultado	:= 	Wheb_mensagem_pck.get_texto(308216) || quebra_w || quebra_w || obter_desc_expressao(891552);
		
						/*'Como o paciente apresenta contra-indicacao relativa ao uso de quimioprofilaxia para TEV, '||
						'considerar o risco/beneficio de sua introducao ou utilizar metodos fisicos como meia elastica de compressao gradual (MECG), '||
						'dispositivos mecanicos de compressao pneumatica intermitente (CPI) ou bomba plantar (BP).';
						'Os metodos de profilaxia mecanica sugeridos devem ser mantidos por 18 horas, pelo menos, ao longo do dia.' ||quebra_w ||quebra_w*/

						
						
		NEW.ds_resultado	:= NEW.ds_resultado||quebra_w||quebra_w||Wheb_mensagem_pck.get_texto(308238); --'Optando-se pela quimioprofilaxia:'; -- edilson 
		Inserir_Medicacao; -- edilson
	elsif (qt_contra_ind_relat_w	> 0) and --Edilson
		(ie_condicao_w	= 'N'	) and (qt_contra_prof_mec_w	> 0) then
		NEW.IE_QUIMIOPROFILAXIA := 'A';
		NEW.IE_PROFILAXIA_MEC   := 'A';
		NEW.ds_resultado	:= Wheb_mensagem_pck.get_texto(308232) || ' ';
		
						/*'Como este paciente apresenta contra-indicacao relativa para o uso de quimioprofilaxia e para metodos fisicos, '||
						'deve-se avaliar individualmente o risco/beneficio de sua aplicacao ou nao. ';*/


		NEW.ds_resultado	:= NEW.ds_resultado ||quebra_w||quebra_w|| Wheb_mensagem_pck.get_texto(308234) || ' ' /*'Optando-se pela profilaxia mecanica: '*/||quebra_w;
		NEW.ds_resultado	:= NEW.ds_resultado	||Wheb_mensagem_pck.get_texto(308236) || ' ' /*'Recomendam-se metodos fisicos como meia elastica de compressao gradual (MECG), '*/||
						Wheb_mensagem_pck.get_texto(308237) || ' ' || /*'dispositivos mecanicos de compressao ';*/
						quebra_w || quebra_w || obter_desc_expressao(891552); /*'Os metodos de profilaxia mecanica sugeridos devem ser mantidos por 18 horas, pelo menos, ao longo do dia.' */

		NEW.ds_resultado	:= NEW.ds_resultado||quebra_w||quebra_w||Wheb_mensagem_pck.get_texto(308238); /*'Optando-se pela quimioprofilaxia:';*/
 -- edilson 
		Inserir_Medicacao; -- edilson
	
	elsif (ie_condicao_w	= 'S') and (qt_contra_prof_mec_w > 0) then
		NEW.IE_QUIMIOPROFILAXIA := 'N';
		NEW.IE_PROFILAXIA_MEC   := 'A';
		NEW.ds_resultado	:= Wheb_mensagem_pck.get_texto(308239);
						
						/*'Como este paciente apresenta contra-indicacao absoluta para o uso de quimioprofilaxia e relativa para metodos fisicos, '||
						'a quimioprofilaxia nao deve ser utilizada e deve-se avaliar individualmente o risco/beneficio da profilaxia mecanica. ';*/

--		:new.ds_resultado	:= :new.ds_resultado||quebra_w||quebra_w||'Optando-se pela quimioprofilaxia a recomendacao e:';

--		Inserir_Medicacao;


		NEW.ds_resultado	:= NEW.ds_resultado ||quebra_w||quebra_w|| Wheb_mensagem_pck.get_texto(308234) || ' ' /*'Optando-se pela profilaxia mecanica: '*/||quebra_w;
		NEW.ds_resultado	:= NEW.ds_resultado	||Wheb_mensagem_pck.get_texto(308236) || ' ' /*'Recomendam-se metodos fisicos como meia elastica de compressao gradual (MECG), '*/||
						Wheb_mensagem_pck.get_texto(308246); /*'dispositivos mecanicos de compressao pneumatica intermitente (CPI) ou bomba plantar (BP).';*/

	end if;
	end;
	
	
	
	procedure inserir_resposta_cirurgia is
	
	BEGIN
	
	NEW.IE_QUIMIOPROFILAXIA := 'A';
	NEW.IE_PROFILAXIA_MEC    := 'A';
	
	if (ie_cir_pequeno_porte_w = 'S') then
		NEW.ie_risco := 'B';
		NEW.IE_PROFILAXIA_MEC := 'A';
		NEW.IE_QUIMIOPROFILAXIA := 'A';
		NEW.ds_resultado := 	Wheb_mensagem_pck.get_texto(308247);
					
					/*'Pacientes submetidos a procedimentos cirurgicos considerados de baixo risco para TEV podem ainda assim apresentar trombose, ' ||
					'particularmente aqueles mais idosos ou com fatores de risco associados, como cancer, historia previa ou familiar de TEV, ou ' ||
					'mesmo associacoes de varios fatores comuns, como tabagismo, varizes, obesidade, reposicao hormonal, etc. Nestes pacientes, a avaliacao ' ||
					'de risco deve ser individualizada, podendo-se optar pela prescricao da profilaxia.Estimular Deambulacao; Heparina nao indicada.';*/

		
	elsif (ie_cir_grande_medio_porte_w = 'S') and (NEW.qt_idade	< 40) and (qt_reg_w > 0) then
		if 	((qt_relativa_w + qt_absoluta_w) = 0) then
			if (NEW.qt_peso	< 70) then
				qt_Nadroparina_w	:= '1.900';
			else
				qt_Nadroparina_w	:= '2.850';
			end if;
			NEW.IE_QUIMIOPROFILAXIA := 'S';
			NEW.IE_PROFILAXIA_MEC    := 'A';
			NEW.ie_risco := 'M';
			NEW.ds_resultado := 	Wheb_mensagem_pck.get_texto(308248) || ' ' || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308249) || ' ' || quebra_w ||
						Wheb_mensagem_pck.get_texto(308250) || quebra_w ||
						Wheb_mensagem_pck.get_texto(308193) || ' ' ||qt_Nadroparina_w|| ' ' || Wheb_mensagem_pck.get_texto(308194) || ' ' || quebra_w ||
						Wheb_mensagem_pck.get_texto(308252) || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308177);
						
						/*'A quimioprofilaxia recomendada nesta situacao clinica e: ' || quebra_w || quebra_w ||
						'Enoxaparina 20 mg SC 1 X ao dia ou ' || quebra_w ||
						'Dalteparina 2.500 UI 1 X ao dia ou' || quebra_w ||
						'Nadroparina '||qt_Nadroparina_w||' UI SC 1 X ao dia ou ' || quebra_w ||
						'Heparina nao fracionada(HNF) 5.000 UI 2 X ao dia.' || quebra_w || quebra_w ||
						'O uso desta quimioprofilaxia deve ser mantido por 7 a 10 dias.';*/

						
						inserir_texto_adic_cir;
		elsif	((qt_relativa_w + qt_absoluta_w) > 0) and (qt_absoluta_w = 1) and (qt_questao_5_w = 0) then
			NEW.ie_risco := 'M';
			NEW.IE_QUIMIOPROFILAXIA := 'N';
			NEW.IE_PROFILAXIA_MEC    := 'S';	
			NEW.ds_resultado := 	Wheb_mensagem_pck.get_texto(308223);
			
						/*'Como o paciente apresenta contra-indicacao absoluta ao uso de quimioprofilaxia para TEV, recomendam-se metodos ' ||
						'fisicos como meia elastica de compressao gradual (MECG), ' ||
						'dispositivos mecanicos de compressao pneumatica ' ||
						'intermitente (CPI) ou bomba plantar (BP).';*/

						
		elsif	((qt_relativa_w + qt_absoluta_w) > 0) and (qt_absoluta_w > 0) and (qt_questao_5_w > 0) then
			NEW.ie_risco := 'M';
			NEW.IE_QUIMIOPROFILAXIA := 'N';
			NEW.IE_PROFILAXIA_MEC := 'A';
			NEW.ds_resultado := 	Wheb_mensagem_pck.get_texto(308257) || ' ' || quebra_w || quebra_w ||			
						Wheb_mensagem_pck.get_texto(308234) || ' ' || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308236) || ' ' || Wheb_mensagem_pck.get_texto(308246);
						
						/*'Como este paciente apresenta contra-indicacao absoluta para o ' || 
						'uso de quimioprofilaxia e relativa para metodos fisicos, deve-se ' || 
						'avaliar individualmente o risco/beneficio de sua aplicacao ou nao. ' || quebra_w || quebra_w ||			
						'Optando-se pela profilaxia mecanica: '|| quebra_w || quebra_w ||
						'Recomendam-se metodos fisicos como meia elastica de compressao ' ||
					    'gradual (MECG), dispositivos mecanicos de compressao pneumatica ' ||
						'intermitente (CPI) ou bomba plantar (BP).';*/

			
		elsif	((qt_relativa_w + qt_absoluta_w) > 0) and (qt_relativa_w > 0) and (qt_questao_5_w > 0) then
			
			if (NEW.qt_peso	< 70) then
				qt_Nadroparina_w	:= '1.900';
			else
				qt_Nadroparina_w	:= '2.850';
			end if;
			
			NEW.ie_risco := 'M';
			NEW.IE_QUIMIOPROFILAXIA := 'A';
			NEW.IE_PROFILAXIA_MEC := 'A';
			NEW.ds_resultado :=	Wheb_mensagem_pck.get_texto(308257) || ' ' || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308234) || ' ' || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308236) || ' ' ||
						Wheb_mensagem_pck.get_texto(308246) || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308238) || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308249) || ' ' || quebra_w || 
						Wheb_mensagem_pck.get_texto(308250) || quebra_w ||
						Wheb_mensagem_pck.get_texto(308193) || ' ' || qt_Nadroparina_w || ' ' || Wheb_mensagem_pck.get_texto(308261) || ' ' ||quebra_w||
						Wheb_mensagem_pck.get_texto(308252) || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308177);
						
						/*'Como este paciente apresenta contra-indicacao relativa para o uso ' || 
						'de quimioprofilaxia e para metodos fisicos, deve-se avaliar ' || 
						'individualmente o risco/beneficio de sua aplicacao ou nao. ' || quebra_w || quebra_w ||
						'Optando-se pela profilaxia mecanica: ' || quebra_w || quebra_w ||
						'Recomendam-se metodos fisicos como meia elastica de compressao gradual ' || 
						'(MECG), dispositivos mecanicos de compressao pneumatica intermitente (CPI) ' || 
						'ou bomba plantar (BP).' || quebra_w || quebra_w ||
						'Optando-se pela quimioprofilaxia:' || quebra_w || quebra_w ||
						'Enoxaparina 20 mg SC 1 X ao dia ou ' || quebra_w || 
						'Dalteparina 2.500 UI SC 1 X ao dia ou' || quebra_w ||
						'Nadroparina ' || qt_Nadroparina_w || ' SC 1 X ao dia ou '||quebra_w||
						'Heparina nao fracionada(HNF) 5.000 UI SC 2 X ao dia.' || quebra_w || quebra_w ||
						'O uso desta quimioprofilaxia deve ser mantido por 7 a 10 dias.';*/

						
						inserir_texto_adic_cir;

		elsif	((qt_relativa_w + qt_absoluta_w) > 0) and (qt_relativa_w = 1) and (qt_absoluta_w = 0) and (qt_questao_5_w = 0) then
			
			if (NEW.qt_peso	< 70) then
				qt_Nadroparina_w	:= '1.900';
			else
				qt_Nadroparina_w	:= '2.850';
			end if;
			
			NEW.ie_risco := 'M';
			NEW.IE_QUIMIOPROFILAXIA := 'A';
			NEW.IE_PROFILAXIA_MEC := 'S';
			NEW.ds_resultado :=	Wheb_mensagem_pck.get_texto(308216) || quebra_w || quebra_w ||
						obter_desc_expressao(891552) || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308238) || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308249) || ' ' ||  quebra_w ||
						Wheb_mensagem_pck.get_texto(308250) || quebra_w ||
						Wheb_mensagem_pck.get_texto(308193) || ' ' || qt_Nadroparina_w || ' ' || Wheb_mensagem_pck.get_texto(308261) || ' ' || quebra_w ||
						Wheb_mensagem_pck.get_texto(308252) || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308177);
												
						/*'Como o paciente apresenta contra-indicacao relativa ao uso ' || 
						'de quimioprofilaxia para TEV, considerar o risco/beneficio de ' || 
						'sua introducao ou utilizar metodos fisicos como meia elastica de ' || 
						'compressao gradual (MECG), dispositivos mecanicos de compressao ' || 
						'pneumatica intermitente (CPI) ou bomba plantar (BP).' || quebra_w || quebra_w ||
						891552'Os metodos de profilaxia mecanica sugeridos devem ser mantidos por 18 horas, pelo menos, ao longo do dia.' ||quebra_w ||quebra_w
						308238'Optando-se pela quimioprofilaxia:' || quebra_w || quebra_w ||
						308249'Enoxaparina 20 mg SC 1 X ao dia ou '||  quebra_w ||
						308250'Dalteparina 2.500 UI SC 1 X ao dia ou' || quebra_w ||
						308193'Nadroparina ' || qt_Nadroparina_w || 308261' SC 1 X ao dia ou '|| quebra_w ||
						308252'Heparina nao fracionada(HNF) 5.000 UI SC 2 X ao dia.' || quebra_w || quebra_w ||
						308177'O uso desta quimioprofilaxia deve ser mantido por 7 a 10 dias.';*/

						
						inserir_texto_adic_cir;

		end if;
	elsif (ie_cir_grande_medio_porte_w = 'S') and (NEW.qt_idade	< 40) and (qt_reg_w = 0) then
		NEW.ie_risco := 'B';
		NEW.IE_PROFILAXIA_MEC := 'A';
		NEW.IE_QUIMIOPROFILAXIA := 'A';
		NEW.ds_resultado := 	Wheb_mensagem_pck.get_texto(308247);
					
					/*'Pacientes submetidos a procedimentos cirurgicos considerados de baixo risco para TEV podem ainda assim apresentar trombose, ' ||
					'particularmente aqueles mais idosos ou com fatores de risco associados, como cancer, historia previa ou familiar de TEV, ou ' ||
					'mesmo associacoes de varios fatores comuns, como tabagismo, varizes, obesidade, reposicao hormonal, etc. Nestes pacientes, a avaliacao ' ||
					'de risco deve ser individualizada, podendo-se optar pela prescricao da profilaxia.';*/

					
	elsif (ie_cir_grande_medio_porte_w = 'S') and
		(NEW.qt_idade	>= 40 AND NEW.qt_idade <= 60) and (qt_reg_w = 0) then
		if 	((qt_relativa_w + qt_absoluta_w) = 0) then
			
			if (NEW.qt_peso	< 70) then
				qt_Nadroparina_w	:= '1.900';
			else
				qt_Nadroparina_w	:= '2.850';
			end if;			
			
			NEW.ie_risco := 'M';
			NEW.IE_QUIMIOPROFILAXIA := 'S';
			NEW.IE_PROFILAXIA_MEC := 'A';
			NEW.ds_resultado := Wheb_mensagem_pck.get_texto(308248) || ' ' || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308249) || ' ' || quebra_w ||
						Wheb_mensagem_pck.get_texto(308250) || ' ' || quebra_w ||
						Wheb_mensagem_pck.get_texto(308193) || ' ' || qt_Nadroparina_w || ' ' || Wheb_mensagem_pck.get_texto(308267) || ' ' || quebra_w ||
						Wheb_mensagem_pck.get_texto(308252) || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308177);					
						
						/*'A quimioprofilaxia recomendada nesta situacao clinica e: ' || quebra_w || quebra_w ||
						'Enoxaparina 20 mg SC 1 X ao dia ou ' || quebra_w || 
						'Dalteparina 2.500 UI SC 1 X ao dia ou ' || quebra_w ||
						'Nadroparina ' || qt_Nadroparina_w ||' 1 X ao dia ou ' || quebra_w ||
						'Heparina nao fracionada(HNF) 5.000 UI 2 X ao dia' || quebra_w || quebra_w ||
						'O uso desta quimioprofilaxia deve ser mantido por 7 a 10 dias.';*/

												
						inserir_texto_adic_cir;
		elsif	((qt_relativa_w + qt_absoluta_w) > 0) and (qt_absoluta_w = 1) and (qt_questao_5_w = 0) then
			NEW.ie_risco := 'M';
			NEW.IE_QUIMIOPROFILAXIA := 'N';
			NEW.IE_PROFILAXIA_MEC := 'S';
			NEW.ds_resultado := 	Wheb_mensagem_pck.get_texto(308270);
						
						/*'Como o paciente apresenta contra-indicacao absoluta ao uso ' ||
						'de quimioprofilaxia gradual (MECG), para TEV, recomendam-se ' || 
						'metodos fisicos como meia elastica de compressao, dispositivos ' || 
						'mecanicos de compressao pneumatica intermitente (CPI) ' || 
						'ou bomba plantar (BP).';*/

						
		elsif	((qt_relativa_w + qt_absoluta_w) > 0) and (qt_absoluta_w > 0) and (qt_questao_5_w > 0) then
			NEW.ie_risco := 'M';
			NEW.IE_QUIMIOPROFILAXIA := 'N';
			NEW.IE_PROFILAXIA_MEC := 'A';
			NEW.ds_resultado := 	Wheb_mensagem_pck.get_texto(308257) || ' ' || quebra_w || quebra_w ||			
						Wheb_mensagem_pck.get_texto(308234) || ' ' || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308236) || ' ' ||
						Wheb_mensagem_pck.get_texto(308275) || quebra_w ||
						Wheb_mensagem_pck.get_texto(308276);
						
						/*'Como este paciente apresenta contra-indicacao absoluta para o uso ' || 
						'de quimioprofilaxia e relativa para metodos fisicos,  deve-se ' || 
						'avaliar individualmente o risco/beneficio de sua aplicacao ou nao. ' || quebra_w || quebra_w ||			
						'Optando-se pela profilaxia mecanica: '|| quebra_w || quebra_w ||
						'Recomendam-se metodos fisicos como meia elastica de compressao gradual (MECG), ' || 
						'dispositivos mecanicos de compressao pneumatica intermitente (CPI)' || quebra_w ||
						'ou bomba plantar (BP).';*/

						
		elsif	((qt_relativa_w + qt_absoluta_w) > 0) and (qt_relativa_w > 0) and (qt_questao_5_w > 0) then
			
			if (NEW.qt_peso	< 70) then
				qt_Nadroparina_w	:= '1.900';
			else
				qt_Nadroparina_w	:= '2.850';
			end if;			
			
			NEW.ie_risco := 'M';
			NEW.IE_QUIMIOPROFILAXIA := 'A';
			NEW.IE_PROFILAXIA_MEC := 'A';
			NEW.ds_resultado :=	Wheb_mensagem_pck.get_texto(308232) || ' ' || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308234) || ' ' || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308236) || ' ' ||
						Wheb_mensagem_pck.get_texto(308246) || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308238) || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308249) || ' ' || quebra_w ||
						Wheb_mensagem_pck.get_texto(308250) || quebra_w ||
						Wheb_mensagem_pck.get_texto(308193) || ' ' || qt_Nadroparina_w || ' ' || Wheb_mensagem_pck.get_texto(308267) || ' ' || quebra_w || 
						Wheb_mensagem_pck.get_texto(308252) || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308177);
						
						/*'Como este paciente apresenta contra-indicacao relativa para o uso de ' || 
						'quimioprofilaxia e para metodos fisicos, deve-se avaliar individualmente' || 
						'o risco/beneficio de sua  aplicacao ou nao. ' || quebra_w || quebra_w ||
						'Optando-se pela profilaxia mecanica: ' || quebra_w || quebra_w ||
						'Recomendam-se metodos fisicos como meia elastica de compressao gradual (MECG), ' || 
						'dispositivos mecanicos de compressao pneumatica intermitente (CPI) ' || 
						'ou bomba plantar (BP).' || quebra_w || quebra_w ||
						'Optando-se pela quimioprofilaxia:' || quebra_w || quebra_w ||
						'Enoxaparina 20 mg SC 1 X ao dia ou ' || quebra_w ||
						'Dalteparina 2.500 UI SC 1 X ao dia ou' || quebra_w ||
						'Nadroparina ' || qt_Nadroparina_w || 308267' 1 X ao dia ou ' || quebra_w || 
						'Heparina nao fracionada(HNF) 5.000 UI 2 X ao dia.' || quebra_w || quebra_w ||
						'O uso desta quimioprofilaxia deve ser mantido por 7 a 10 dias.';*/

						
						inserir_texto_adic_cir;
		elsif	((qt_relativa_w + qt_absoluta_w) > 0) and (qt_relativa_w = 1) and (qt_absoluta_w = 0) and (qt_questao_5_w = 0) then
			
			if (NEW.qt_peso	< 70) then
				qt_Nadroparina_w	:= '1.900';
			else
				qt_Nadroparina_w	:= '2.850';
			end if;			
			
			NEW.ie_risco := 'M';
			NEW.IE_QUIMIOPROFILAXIA := 'A';
			NEW.IE_PROFILAXIA_MEC  := 'S';
			NEW.ds_resultado :=	Wheb_mensagem_pck.get_texto(308287) || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308238) || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308249) || ' ' || quebra_w ||
						Wheb_mensagem_pck.get_texto(308250) || ' ' || quebra_w ||
						Wheb_mensagem_pck.get_texto(308193) || ' ' || qt_Nadroparina_w || ' ' || Wheb_mensagem_pck.get_texto(308267) || ' ' || quebra_w || 
						Wheb_mensagem_pck.get_texto(308252) || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308177);
						
						/*'Como o paciente apresenta contra-indicacao relativa ao uso de ' || 
						'quimioprofilaxia para TEV, considerar o risco/beneficio dessa introducao ' || 
						'ou utilizar metodos fisicos como meia elastica de compressao gradual (MECG), ' || 
						'dispositivos mecanicos de compressao pneumatica intermitente (CPI) ' || 
						'ou bomba plantar (BP).'|| quebra_w || quebra_w ||
						'Optando-se pela quimioprofilaxia:' || quebra_w || quebra_w ||
						'Enoxaparina 20 mg SC 1 X ao dia ou ' || quebra_w || 
						'Dalteparina 2.500 UI SC 1 X ao dia ou ' || quebra_w ||
						'Nadroparina ' || qt_Nadroparina_w || ' 1 X ao dia ou ' || quebra_w || 
						'Heparina nao fracionada(HNF) 5.000 UI 2 X ao dia.' || quebra_w || quebra_w ||
						'O uso desta quimioprofilaxia deve ser mantido por 7 a 10 dias.';*/

						
						inserir_texto_adic_cir;
		end if;
	elsif	(((ie_cir_grande_medio_porte_w = 'S') and
		(NEW.qt_idade	>= 40 AND NEW.qt_idade <= 60) and (qt_reg_w > 0)) or
		((ie_cir_alto_risco_w = 'S') or
		(ie_cir_grande_medio_porte_w = 'S' AND NEW.qt_idade > 60))) then
		
		if	((qt_relativa_w + qt_absoluta_w) > 0) then
			
			if (NEW.IE_PLAQUETOPENIA_HEPARINA	= 'S') then
				NEW.ie_risco := 'A';
				NEW.IE_QUIMIOPROFILAXIA := 'A';
				NEW.IE_PROFILAXIA_MEC   := 'S';
				NEW.ds_resultado := 	Wheb_mensagem_pck.get_texto(308209)	|| quebra_w || quebra_w ||
										Wheb_mensagem_pck.get_texto(308210) || quebra_w ||quebra_w||
										Wheb_mensagem_pck.get_texto(308211) || quebra_w || quebra_w||
										Wheb_mensagem_pck.get_texto(308213) || ' ' ||quebra_w || quebra_w||
										Wheb_mensagem_pck.get_texto(308214) || ' ';
										
										/*'Como o paciente apresenta contra-indicacao absoluta ao uso de heparinas, '||
										'recomendam-se metodos fisicos como meia elastica de compressao gradual (MECG), '||
										'dispositivos mecanicos de compressao pneumatica intermitente (CPI) ou bomba plantar (BP).'|| quebra_w || quebra_w ||
										'Optando-se pela quimioprofilaxia recomenda-se:' || quebra_w ||quebra_w||
										'Fondaparina (Arixtra) 2,5 mg SC 1 x ao dia.' || quebra_w || quebra_w||
										'Opcao para casos de artroplastia de quadril e joelho: '||quebra_w || quebra_w||
										'Rivaroxabana (Xarelto) 10 mg VO 1 x ao dia. ';*/

				
			elsif (NEW.IE_INSUF_RENAL	= 'S') then
				NEW.ie_risco := 'A';
				NEW.IE_QUIMIOPROFILAXIA := 'A';
				NEW.IE_PROFILAXIA_MEC   := 'S';
				NEW.ds_resultado := 	Wheb_mensagem_pck.get_texto(308216) || quebra_w || quebra_w ||
										obter_desc_expressao(891552) || quebra_w || quebra_w ||
										Wheb_mensagem_pck.get_texto(308218) || ' ' || quebra_w ||quebra_w||
										Wheb_mensagem_pck.get_texto(308219) || quebra_w || quebra_w||
										Wheb_mensagem_pck.get_texto(308201) || quebra_w || quebra_w;
										
										/*'Como o paciente apresenta contra-indicacao relativa ao uso de ' || 
										'quimioprofilaxia para TEV, considerar o risco/beneficio de sua ' || 
										'introducao ou utilizar metodos fisicos como meia elastica de ' || 
										'compressao gradual (MECG), dispositivos mecanicos de compressao ' ||
										'pneumatica intermitente (CPI) ou bomba plantar (BP).' || quebra_w || quebra_w ||
										'Os metodos de profilaxia mecanica sugeridos devem ser mantidos por 18 horas, pelo menos, ao longo do dia.' ||quebra_w ||quebra_w
										'Optando-se pelo uso da heparina recomenda-se:' || quebra_w ||quebra_w||
										'Heparina nao fracionada HNF 5000 UI 2x ao dia e controle do TTPA.' || quebra_w || quebra_w||
										'O uso desta quimioprofilaxia deve ser mantido por 6 a 14 dias ou enquanto persistir o risco.' || quebra_w || quebra_w;*/

										
										
			elsif (qt_absoluta_w = 1)  and (qt_questao_5_w = 0) then
				NEW.ie_risco := 'A';
				NEW.IE_PROFILAXIA_MEC 	 := 'S';
				NEW.IE_QUIMIOPROFILAXIA := 'N';
				NEW.ds_resultado :=	Wheb_mensagem_pck.get_texto(308223);
							
							/*'Como o paciente apresenta contra-indicacao absoluta ao uso de ' || 
							'quimioprofilaxia para TEV, recomendam-se metodos fisicos como ' || 
							'meia elastica de compressao gradual (MECG), dispositivos mecanicos ' || 
							'de compressao pneumatica intermitente (CPI) ou bomba plantar (BP).';*/

			
			elsif (qt_relativa_w > 0) and (qt_absoluta_w = 0) and (qt_questao_5_w = 0) then
				
				if (NEW.qt_peso	< 70) then
					qt_Nadroparina_w	:= '3.800';
				else
					qt_Nadroparina_w	:= '5.700';
				end if;			
				
				NEW.ie_risco := 'A';
				NEW.IE_QUIMIOPROFILAXIA := 'A';
				NEW.IE_PROFILAXIA_MEC   := 'S';
				NEW.ds_resultado := 	Wheb_mensagem_pck.get_texto(308216)	|| quebra_w || quebra_w ||
							obter_desc_expressao(891552) || quebra_w || quebra_w ||
							Wheb_mensagem_pck.get_texto(308238) || quebra_w ||
							Wheb_mensagem_pck.get_texto(308190) || ' ' || quebra_w ||
							Wheb_mensagem_pck.get_texto(308192) || ' ' || quebra_w ||
							Wheb_mensagem_pck.get_texto(308193) || ' ' || qt_Nadroparina_w || ' ' || Wheb_mensagem_pck.get_texto(308267) || ' ' || quebra_w ||
							Wheb_mensagem_pck.get_texto(308196) || quebra_w || quebra_w||
								obter_desc_expressao(891564)|| quebra_w || quebra_w;
							
							/*'Como o paciente apresenta contra-indicacao relativa ao uso de ' || 
							'quimioprofilaxia para TEV, considerar o risco/beneficio de sua ' || 
							'introducao ou utilizar metodos fisicos como meia elastica de ' || 
							'compressao gradual (MECG), dispositivos mecanicos de compressao ' ||
							'pneumatica intermitente (CPI) ou bomba plantar (BP).' || quebra_w || quebra_w ||
							'Os metodos de profilaxia mecanica sugeridos devem ser mantidos por 18 horas, pelo menos, ao longo do dia.' ||quebra_w ||quebra_w
							'Optando-se pela quimioprofilaxia:' || quebra_w ||
							'Enoxaparina 40 mg SC 1 X ao dia ou ' || quebra_w || 
							'Dalteparina 5.000 UI SC 1 X ao dia ou ' || quebra_w ||
							'Nadroparina '|| qt_Nadroparina_w ||' 1 X ao dia ou ' || quebra_w ||
							'Heparina nao fracionada(HNF) 5.000 UI SC 3 X ao dia.' || quebra_w || quebra_w;*/
							
							
							inserir_texto_tipo_cirur;
							inserir_texto_adic_cir;
							
			elsif (qt_absoluta_w > 0) and (qt_questao_5_w > 0) then
				NEW.ie_risco := 'A';
				NEW.IE_PROFILAXIA_MEC := 'A';
				NEW.IE_QUIMIOPROFILAXIA := 'N';
				NEW.ds_resultado := 	Wheb_mensagem_pck.get_texto(308257) || ' ' || quebra_w || quebra_w ||
							Wheb_mensagem_pck.get_texto(308238) || ' ' || quebra_w || quebra_w ||
							Wheb_mensagem_pck.get_texto(308236) || ' ' || Wheb_mensagem_pck.get_texto(308246);
							
							/*'Como este paciente apresenta contra-indicacao absoluta para o uso de quimioprofilaxia e relativa para metodos fisicos, ' || 
							'deve-se avaliar individualmente o risco/beneficio de sua aplicacao ou nao. ' || quebra_w || quebra_w ||
							'Optando-se pela profilaxia mecanica: ' || quebra_w || quebra_w ||
							'Recomendam-se metodos fisicos como meia elastica de compressao gradual (MECG), dispositivos mecanicos de ' ||
							'compressao pneumatica intermitente (CPI) ou bomba plantar (BP).';*/

							
			elsif (qt_relativa_w > 0) and (qt_absoluta_w = 0) and (qt_questao_5_w > 0) then
				
				if (NEW.qt_peso	< 70) then
					qt_Nadroparina_w	:= '3.800';
				else
					qt_Nadroparina_w	:= '5.700';
				end if;			
				
				NEW.ie_risco := 'A';
				NEW.IE_QUIMIOPROFILAXIA := 'A';
				NEW.IE_PROFILAXIA_MEC := 'A';
				NEW.ds_resultado := 	Wheb_mensagem_pck.get_texto(308232) || quebra_w || quebra_w ||
							Wheb_mensagem_pck.get_texto(308234) || ' ' || quebra_w || quebra_w ||
							Wheb_mensagem_pck.get_texto(308236) || ' ' || Wheb_mensagem_pck.get_texto(308246) || quebra_w || quebra_w ||
							Wheb_mensagem_pck.get_texto(308238) || quebra_w ||
							Wheb_mensagem_pck.get_texto(308190) || ' ' || quebra_w ||
							Wheb_mensagem_pck.get_texto(308192) || ' ' || quebra_w ||
							Wheb_mensagem_pck.get_texto(308193) || ' ' || qt_Nadroparina_w || ' ' || Wheb_mensagem_pck.get_texto(308267) || ' ' || quebra_w || 
							Wheb_mensagem_pck.get_texto(308196) || quebra_w || quebra_w||
							obter_desc_expressao(891564)|| quebra_w || quebra_w;							
							
							/*'Como este paciente apresenta contra-indicacao relativa para o uso de ' || 
							'quimioprofilaxia e para metodos fisicos, deve-se avaliar individualmente ' || 
							'o risco/beneficio de sua aplicacao ou nao.' || quebra_w || quebra_w ||
							'Optando-se pela profilaxia mecanica: ' || quebra_w || quebra_w ||
							'Recomendam-se metodos fisicos como meia elastica de compressao gradual ' || 
							'(MECG), dispositivos mecanicos de compressao pneumatica intermitente (CPI) ' || 
							'ou bomba plantar (BP).' || quebra_w || quebra_w ||
							'Optando-se pela quimioprofilaxia:' || quebra_w ||
							'Enoxaparina 40 mg SC 1 X ao dia ou ' || quebra_w || 
							'Dalteparina 5.000 UI SC 1 X ao dia ou ' || quebra_w ||
							'Nadroparina ' || qt_Nadroparina_w ||' 1 X ao dia ou '|| quebra_w || 
							'Heparina nao fracionada(HNF) 5.000 UI SC 3 X ao dia.' || quebra_w || quebra_w;*/

							
							inserir_texto_tipo_cirur;
							inserir_texto_adic_cir;
			end if;
		else
			if (NEW.qt_peso	< 70) then
				qt_Nadroparina_w	:= '3.800';
			else
				qt_Nadroparina_w	:= '5.700';
			end if;			
			
			NEW.ie_risco := 'A';
			NEW.IE_PROFILAXIA_MEC := 'A';
			NEW.IE_QUIMIOPROFILAXIA := 'S';
			NEW.ds_resultado := 	Wheb_mensagem_pck.get_texto(308248) || quebra_w || quebra_w ||
						Wheb_mensagem_pck.get_texto(308190) || ' ' || quebra_w ||
						Wheb_mensagem_pck.get_texto(308192) || ' ' || quebra_w ||
						Wheb_mensagem_pck.get_texto(308193) || ' ' || qt_Nadroparina_w || ' ' || Wheb_mensagem_pck.get_texto(308267) || ' '  || quebra_w||
						Wheb_mensagem_pck.get_texto(308196) || quebra_w || quebra_w||
								obter_desc_expressao(891564)|| quebra_w || quebra_w;
						
						/*'A quimioprofilaxia recomendada nesta situacao clinica e:' || quebra_w || quebra_w ||
						'Enoxaparina 40 mg SC 1 X ao dia ou ' || quebra_w ||
						'Dalteparina 5.000 UI 1 X ao dia ou ' || quebra_w ||
						'Nadroparina ' || qt_Nadroparina_w || ' 1 X ao dia ou ' || quebra_w||
						'Heparina nao fracionada(HNF) 5.000 UI SC 3 X ao dia.' || quebra_w || quebra_w;*/

						
						inserir_texto_tipo_cirur;
						inserir_texto_adic_cir;
		end if;
	end if;
	
	end;

BEGIN
if (wheb_usuario_pck.get_ie_executar_trigger	<> 'N')  then

ie_padrao_tev_w	:= coalesce(NEW.ie_padrao,'D');
if (coalesce(NEW.ie_padrao,'D')	= 'HSL') then

	if (OLD.dt_liberacao is null ) and (NEW.dt_liberacao is not null) then

		if (coalesce(NEW.IE_NAO_SE_APLICA,'N') = 'S') and (NEW.NR_SEQ_MOTIVO_TEV is null) then
			
			--e necessario a selecao de um motivo pelo qual nao se aplica o protocolo de TEV.

			CALL Wheb_mensagem_pck.exibir_mensagem_abort(264633);	
			
		end if;
		
	end if;

	NEW.IE_IDADE_MAIOR	:='N';
	if (NEW.qt_idade	>= 55) then
		NEW.IE_IDADE_MAIOR	:= 'S';
	end if;

	qt_imc_w	:= dividir(NEW.qt_peso,(NEW.qt_altura_cm /100) * (NEW.qt_altura_cm /100));
	if (qt_imc_w	>=30 ) then
		NEW.IE_OBESIDADE	:= 'S';
	end if;
	NEW.IE_CONDICAO	:= 'N';
	ie_condicao_w		:= 'N';
	qt_reg_w		:= 0;
	
	if (NEW.IE_HIPERSENSIBILIDADE_HEPARINA	= 'S') then
		qt_reg_w:= qt_reg_w+1;
	end if;
	
	if (NEW.IE_PLAQUETOPENIA_HEPARINA	= 'S') then
		qt_reg_w:= qt_reg_w+1;
	end if;
	
	if (NEW.IE_SANGRAMENTO_ULCERA	= 'S') then
		qt_reg_w:= qt_reg_w+1;
	end if;
	
	if (NEW.IE_ANTICOAGULACAO	= 'S') then
		qt_reg_w:= qt_reg_w+1;
	end if;
	
	if (qt_reg_w	> 0) then
		ie_condicao_w	:= 'S';
	end if;
	
	qt_contra_ind_relat_w := 0;
	
	if (NEW.IE_COAGULOPATIA	= 'S') then
		qt_contra_ind_relat_w:= qt_contra_ind_relat_w+1;
	end if;

	if (NEW.IE_ULCERA_ATIVA	= 'S') then
		qt_contra_ind_relat_w:= qt_contra_ind_relat_w+1;
	end if;

	if (NEW.IE_HIPERTENSAO	= 'S') then
		qt_contra_ind_relat_w:= qt_contra_ind_relat_w+1;
	end if;

	if (NEW.IE_INSUF_RENAL	= 'S') then
		qt_contra_ind_relat_w:= qt_contra_ind_relat_w+1;
	end if;

	if (NEW.IE_CIRURGIA_INTRACRANIANA	= 'S') then
		qt_contra_ind_relat_w:= qt_contra_ind_relat_w+1;
	end if;

	if (NEW.IE_PUNCAO_LIQUORICA	= 'S') then
		qt_contra_ind_relat_w:= qt_contra_ind_relat_w+1;
	end if;
	
	if (qt_reg_w > 0) or (qt_contra_ind_relat_w > 0) then
		NEW.IE_CONDICAO	:= 'S';
	end if;
	
	NEW.ds_resultado	:= null;
	qt_reg_w		:= 0;


	if (NEW.IE_ESCARA	= 'S') then
		qt_contra_prof_mec_w	:= qt_contra_prof_mec_w + 1;
	end if;

	if (NEW.IE_FRATURA_EXPOSTA	= 'S') then
		qt_contra_prof_mec_w	:= qt_contra_prof_mec_w + 1;
	end if;

	if (NEW.IE_INFECCAO_MMII	= 'S') then
		qt_contra_prof_mec_w	:= qt_contra_prof_mec_w + 1;
	end if;

	if (NEW.IE_INSUF_ART_MMII	= 'S') then
		qt_contra_prof_mec_w	:= qt_contra_prof_mec_w + 1;
	end if;

	if (NEW.IE_INSUF_CARD_GRAVE	= 'S') then
		qt_contra_prof_mec_w	:= qt_contra_prof_mec_w + 1;
	end if;
	
	if (NEW.IE_CLINICO_CIRURGICO	= 'C') then
		if (NEW.IE_IDADE_MAIOR	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;		
		if (NEW.IE_ECLAMPSIA	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;			
		if (NEW.IE_HIST_FAMILIAR_TEV	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;	
		if (NEW.IE_GRAVIDEZ	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_PNEUMONIA	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;		
		if (NEW.IE_TROMBOFILIA	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;	
		if (NEW.IE_AVCI	= 'S') then
			qt_reg_w	:= qt_reg_w+1;
		end if;
		if (NEW.IE_TVP_EP_PREVIA	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;		
		if (NEW.IE_DOENCA_REUMATOL	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;	
		if (NEW.IE_ANTICONCEPCIONAIS	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;	
		if (NEW.IE_PUERPERIO	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;	
		if (NEW.IE_OBESIDADE	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;	
		if (NEW.IE_INTERNACAO_UTI	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;	
		if (NEW.IE_CAT_VENOSO_CENTRAL	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;	
		if (NEW.IE_PARALISIA_INF	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;	
		if (NEW.IE_CANCER	= 'S') then
			qt_reg_w	:= qt_reg_w+1;
		end if;	
		if (NEW.IE_INSUF_RESP	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_INSUF_ARTERIAL	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_TRH	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_ICC	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;	
		if (NEW.IE_DPOC	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_INFLA_INTESTINAL= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_VARIZES	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_INFECSAO_GRAVE	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_QUIMIOTERAPIA	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_SINDROME_NEFROTICA	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_ABORTAMENTO	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_IAM	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;	
		if (NEW.IE_TABAGISMO	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;		
		end if;
		
		
		if (NEW.IE_DOENCA_AUTOIMUNE	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		
		if (NEW.IE_TRAUMA	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;		

		if (NEW.IE_QUEIMADO	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_OUTROS	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		
		NEW.IE_FATOR_RISCO:='N';
		if (qt_reg_w	> 0) and (NEW.IE_MOBILIDADE_REDUZIDA	= 'S')then
			NEW.IE_FATOR_RISCO := 'S';
		end if;
		NEW.ie_risco	:= 'B';
		if (NEW.IE_FATOR_RISCO	= 'N') then
			NEW.ie_risco	:= 'B';
		elsif (NEW.IE_FATOR_RISCO	= 'S') then
			NEW.ie_risco	:= 'A';

			if (NEW.qt_idade	< 40) and (ie_condicao_w	= 'N') then
				NEW.ie_risco	:= 'B';
			end if;	
			if (NEW.qt_idade < 40) then
				NEW.ie_risco	:= 'B';
			end if;
		end if;
		NEW.ds_resultado	:= Null;
		
		
		
		if (NEW.ie_risco	= 'B') then
			NEW.IE_QUIMIOPROFILAXIA := 'N';
			NEW.IE_PROFILAXIA_MEC  := 'A';

			NEW.ds_resultado	:= 	Wheb_mensagem_pck.get_texto(308327) || ' ' || Wheb_mensagem_pck.get_texto(308328);
			
							/*'Nao ha indicacao de profilaxia medicamentosa ou metodos mecanicos.'||
							' Recomenda-se que o paciente tenha sua deambulacao incentivada e que seja reavaliado caso haja mudanca em seu estado,'||
							' como por exemplo, perda de mobilidade, desenvolvimento de fatores de risco para TEV,'||
							' resolucao de contra-indicacoes para profilaxia, entre outros.';*/

			/*
			if	(:new.IE_FATOR_RISCO	= 'S') and
				(:new.qt_idade	< 40) then

				:new.ds_resultado	:= Null;
				Inserir_Descricao_Idade;
			end if;
			*/

		elsif (NEW.ie_risco	= 'A') then

			if (ie_condicao_w	= 'N') and (qt_contra_ind_relat_w = 0) and -- Edilson
				(qt_contra_prof_mec_w = 0) then --Edilson
				NEW.IE_QUIMIOPROFILAXIA := 'S';
				NEW.IE_PROFILAXIA_MEC  := 'A';
				NEW.ds_resultado	:= Wheb_mensagem_pck.get_texto(308248); --'A quimioprofilaxia recomendada nesta situacao clinica e:';
				Inserir_Medicacao;

			
				--:new.ds_resultado	:= :new.ds_resultado||quebra_w||quebra_w||'Obs.: No estudo de Harenberg e cols, houve aumento na mortalidade no grupo que recebeu nadroparina, comparado com HNF (Haemostasis, 1993; 26(3):127-139';

			else
				Inserir_Contra_Indicacao;

			end if;

			Inserir_Descricao_Idade;
		end if;

	elsif (ie_padrao_tev_w	= 'HSL') and (NEW.ie_clinico_cirurgico	= 'I') then
		NEW.ie_risco	:= 'B';

		/* INICIO RESPOSTA 2 */


		ie_cir_alto_risco_w		:= NEW.ie_cir_alto_risco;
		ie_cir_pequeno_porte_w		:= NEW.ie_cir_pequeno_porte;
		ie_cir_grande_medio_porte_w	:= NEW.ie_cir_grande_medio_porte;
		
		
		ie_artroplastia_joelho_w	:= NEW.ie_artroplastia_joelho;
		ie_artroplastia_quadril_w	:= NEW.ie_artroplastia_quadril;
		ie_fratura_quadril_w		:= NEW.ie_fratura_quadril;
		ie_oncol_curativa_w		:= NEW.ie_oncol_curativa;
		ie_trauma_medular_w		:= NEW.ie_trauma_medular;
		ie_politrauma_w			:= NEW.ie_politrauma;
		/* FIM RESPOSTA 2 */


		
		/* INICIO RESPOSTA 3 */


		qt_reg_w	:= 0;
		
		if (NEW.IE_TABAGISMO	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		if (NEW.IE_TROMBOFILIA	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;	
		if (NEW.IE_AVCI	= 'S') then
			qt_reg_w	:= qt_reg_w+1;
		end if;
		if (NEW.IE_TVP_EP_PREVIA	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;		
		if (NEW.IE_DOENCA_REUMATOL	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;	
		if (NEW.IE_ANTICONCEPCIONAIS	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;	
		if (NEW.IE_PUERPERIO	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;	
		if (NEW.IE_OBESIDADE	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;	
		if (NEW.IE_INTERNACAO_UTI	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;	
		if (NEW.IE_CAT_VENOSO_CENTRAL	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;	
		if (NEW.IE_PARALISIA_INF	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;	
		if (NEW.IE_CANCER	= 'S') then
			qt_reg_w	:= qt_reg_w+1;
		end if;	
		if (NEW.IE_INSUF_RESP	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_INSUF_ARTERIAL	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_TRH	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_ICC	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;	
		if (NEW.IE_DPOC	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_INFLA_INTESTINAL= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_VARIZES	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_INFECSAO_GRAVE	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_QUIMIOTERAPIA	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_SINDROME_NEFROTICA	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_ABORTAMENTO	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_IAM	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_TRAUMA	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;	
		
		NEW.IE_FATOR_RISCO := 'N';
		if (qt_reg_w	> 0) then
			NEW.IE_FATOR_RISCO := 'S';
		end if;
		/* FIM RESPOSTA 3 */


		
		/* INICIO RESPOSTA 4 */


		qt_absoluta_w	:= 0;
		qt_relativa_w	:= 0;
		if (NEW.IE_HIPERSENSIBILIDADE_HEPARINA	= 'S')then
			qt_absoluta_w:= qt_absoluta_w + 1;
		end if;
		if (NEW.IE_PLAQUETOPENIA_HEPARINA	= 'S')then
			qt_absoluta_w:= qt_absoluta_w + 1;
		end if;
		if (NEW.IE_SANGRAMENTO_ULCERA	= 'S')then
			qt_absoluta_w:= qt_absoluta_w + 1;
		end if;
		if (NEW.IE_ANTICOAGULACAO = 'S')then
			qt_absoluta_w:= qt_absoluta_w + 1;
		end if;		
		if (NEW.IE_CIRURGIA_INTRACRANIANA	= 'S')then
			qt_relativa_w:= qt_relativa_w + 1;
		end if;
		if (NEW.IE_PUNCAO_LIQUORICA	= 'S')then
			qt_relativa_w:= qt_relativa_w + 1;
		end if;
		if (NEW.IE_COAGULOPATIA	= 'S')then
			qt_relativa_w:= qt_relativa_w + 1;
		end if;
		if (NEW.IE_HIPERTENSAO	= 'S')then
			qt_relativa_w:= qt_relativa_w + 1;
		end if;
		if (NEW.IE_INSUF_RENAL	= 'S')then
			qt_relativa_w:= qt_relativa_w + 1;
		end if;
		/* FIM RESPOSTA 4 */


		
		/* INICIO RESPOSTA 5 */


		qt_questao_5_w := 0;
		if (NEW.IE_FRATURA_EXPOSTA	= 'S')then
			qt_questao_5_w	:= qt_questao_5_w + 1;
		end if;
		if (NEW.IE_INFECCAO_MMII	= 'S')then
			qt_questao_5_w	:= qt_questao_5_w + 1;
		end if;
		if (NEW.IE_INSUF_ART_MMII	= 'S')then
			qt_questao_5_w	:= qt_questao_5_w + 1;
		end if;
		if (NEW.IE_INSUF_CARD_GRAVE	= 'S')then
			qt_questao_5_w	:= qt_questao_5_w + 1;
		end if;
		if (NEW.IE_ESCARA	= 'S')then
			qt_questao_5_w	:= qt_questao_5_w + 1;
		end if;		
		/* FIM RESPOTA 5 */
		
							
		NEW.IE_RISCO	:= 'B';
		if (NEW.IE_CIR_PEQUENO_PORTE = 'S') then
			NEW.IE_RISCO	:= 'B';
		elsif	((NEW.IE_CIR_ALTO_RISCO	= 'S') 	or
			((NEW.IE_CIR_GRANDE_MEDIO_PORTE = 'S')	and
			((NEW.qt_idade	> 60)	or
			(NEW.qt_idade	between 40 and 60  AND qt_reg_w	> 0))))	then
			NEW.IE_RISCO	:= 'A';
		elsif (NEW.IE_CIR_GRANDE_MEDIO_PORTE = 'S') and
			(NEW.qt_idade between 40 and 60 AND qt_reg_w	= 0) or
			(NEW.qt_idade	< 40 AND qt_reg_w	> 0) then
			NEW.IE_RISCO	:= 'M';
		elsif	(NEW.qt_idade	< 40 AND qt_reg_w	= 0) or (NEW.IE_CIR_PEQUENO_PORTE in ('S')) then
			NEW.IE_RISCO	:= 'B';
		end if;
		Inserir_Descricao_Idade;
		
		if (ie_condicao_w	= 'N') and (NEW.ie_risco	<> 'B') then
			NEW.IE_QUIMIOPROFILAXIA := 'S';
			NEW.IE_PROFILAXIA_MEC  := 'A';
			NEW.ds_resultado	:= 	Wheb_mensagem_pck.get_texto(308331); --'A quimioprofilaxia recomendada nesta situacao e:';
			Inserir_Medicacao;

			--:new.ds_resultado	:= :new.ds_resultado||quebra_w||quebra_w||'Obs.: No estudo de Harenberg e cols, houve aumento na mortalidade no grupo que recebeu nadroparina, comparado com HNF (Haemostasis, 1993; 26(3):127-139';

		else
			Inserir_Contra_Indicacao;
		end if;


		if (NEW.ie_risco	= 'B') then
			NEW.IE_QUIMIOPROFILAXIA := 'N';
			NEW.IE_PROFILAXIA_MEC := 'A';
			NEW.ds_resultado	:= 	Wheb_mensagem_pck.get_texto(308332); --'Nao ha indicacao de profilaxia medicamentosa ou metodos fisicos. O paciente deve ter sua deambulacao incentivada e deve ser reavaliado em 2 dias, caso permaneca internado.';
		end if;
		
		/* Inicio Cirugia */


				
		inserir_resposta_cirurgia;
		
		/* Fim cirurgia */


		
	end if;
	
end if;

if (NEW.qt_peso is null) and (ie_padrao_tev_w	= 'HSL')then
	NEW.ds_resultado := null;
end if;

if (NEW.IE_ANTICOAGULACAO	= 'S') and (ie_padrao_tev_w	= 'HSL') then
	NEW.ds_resultado	:= 	Wheb_mensagem_pck.get_texto(308334); --'Paciente em anticoagulacao. O protocolo de profilaxia de TEV nao se aplica.';
	NEW.ie_risco	:= 'N';
end if;

if (NEW.IE_ANTICOAGULACAO	= 'S') and (ie_padrao_tev_w	= 'HSL') then
	NEW.IE_NAO_SE_APLICA	:= 'S';
end if;

if (NEW.IE_NAO_SE_APLICA	= 'S') and (coalesce(NEW.IE_ANTICOAGULACAO,'N')	= 'N') and (ie_padrao_tev_w	= 'HSL') then
	NEW.ie_risco	:= 'N';
	
		NEW.ds_resultado	:= 	Wheb_mensagem_pck.get_texto(308335); --'O protocolo de profilaxia de TEV nao se aplica';
	if (NEW.NR_SEQ_MOTIVO_TEV	is not null) then
		select	max(ds_motivo)
		into STRICT	ds_motivo_w
		from	tev_motivo
		where	nr_sequencia	= NEW.NR_SEQ_MOTIVO_TEV;
		
		if (ds_motivo_w	is not null) then
			NEW.ds_resultado	:= NEW.ds_resultado||chr(13) ||'    '|| Wheb_mensagem_pck.get_texto(308336, 'DS_MOTIVO_W='||ds_motivo_w); --'Motivo: '||ds_motivo_w;
		end if;
	else
		--e necessario a selecao de um motivo pelo qual nao se aplica o protocolo de TEV.

		CALL Wheb_mensagem_pck.exibir_mensagem_abort(264633);
	end if;
	
	
end if;
end if;

RETURN NEW;
end;
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_escala_tev_hsl_atual() FROM PUBLIC;

CREATE TRIGGER escala_tev_hsl_atual
	BEFORE INSERT OR UPDATE ON escala_tev FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_escala_tev_hsl_atual();

