-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS procedimento_autorizado_insert ON procedimento_autorizado CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_procedimento_autorizado_insert() RETURNS trigger AS $BODY$
DECLARE
cd_proc_convenio_w		procedimento_autorizado.cd_procedimento_convenio%type;
cd_proc_tuss_w			procedimento_autorizado.cd_procedimento_tuss%type;
BEGIN

 if (coalesce(NEW.cd_procedimento_tuss,0) = 0) then
	cd_proc_tuss_w := null;
else
	cd_proc_tuss_w := NEW.cd_procedimento_tuss;
end if;

if (coalesce(NEW.cd_procedimento_convenio,'0') = '0') then
	cd_proc_convenio_w := null;
else
	cd_proc_convenio_w := NEW.cd_procedimento_convenio;
end if;

CALL Gerar_Autor_Integracao(	NEW.nr_sequencia,
			NEW.cd_procedimento,
			NEW.ie_origem_proced,
			cd_proc_tuss_w,
			cd_proc_convenio_w,
			NEW.qt_solicitada,
			NEW.nr_sequencia_autor,
			NEW.nm_usuario,
			'N');

RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_procedimento_autorizado_insert() FROM PUBLIC;

CREATE TRIGGER procedimento_autorizado_insert
	AFTER INSERT ON procedimento_autorizado FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_procedimento_autorizado_insert();

