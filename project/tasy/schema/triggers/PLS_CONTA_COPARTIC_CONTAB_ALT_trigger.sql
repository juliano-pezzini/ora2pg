-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS pls_conta_copartic_contab_alt ON pls_conta_copartic_contab CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_pls_conta_copartic_contab_alt() RETURNS trigger AS $BODY$
declare


BEGIN


if (NEW.ie_status_coparticipacao 	!= OLD.ie_status_coparticipacao) or (NEW.vl_coparticipacao		!= OLD.vl_coparticipacao) or (NEW.nr_seq_conta_resumo	!= OLD.nr_seq_conta_resumo) then

	insert into pls_conta_copartic_log(	ds_log, ds_log_call, ds_motivo,
						dt_atualizacao, dt_atualizacao_nrec, ie_gerar_mensalidade,
						ie_gerar_mensalidade_old, ie_status_coparticipacao, ie_status_coparticipacao_old,
						ie_status_mensalidade, ie_status_mensalidade_old, ie_tipo_registro,
						nm_maquina, nm_usuario, nm_usuario_nrec,
						nr_lote_contabil, nr_seq_conta, nr_seq_conta_copartic,
						nr_seq_conta_mat, nr_seq_conta_proc, nr_seq_copartic_contab,
						nr_seq_mensalidade_seg,nr_seq_mensalidade_seg_old, nr_seq_resumo_new,
						nr_seq_resumo_old, nr_sequencia, vl_coparticipacao,
						vl_coparticipacao_old )
			values ( 	'Alteração valores',dbms_utility.format_call_stack,null,
						LOCALTIMESTAMP,LOCALTIMESTAMP,null,
						null,NEW.ie_status_coparticipacao,OLD.ie_status_coparticipacao,
						null,null,'S',
						wheb_usuario_pck.get_machine, substr(coalesce(wheb_usuario_pck.get_nm_usuario,'Usuário não identificado '),1,14), substr(coalesce(wheb_usuario_pck.get_nm_usuario,'Usuário não identificado '),1,14),
						null, NEW.nr_seq_conta, NEW.nr_seq_conta_copartic,
						NEW.nr_seq_conta_mat,NEW.nr_seq_conta_proc,NEW.nr_sequencia,
						null,null, NEW.nr_seq_conta_resumo,
						OLD.nr_seq_conta_resumo, nextval('pls_conta_copartic_log_seq'), NEW.vl_coparticipacao,
						OLD.vl_coparticipacao);

end if;
RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_pls_conta_copartic_contab_alt() FROM PUBLIC;

CREATE TRIGGER pls_conta_copartic_contab_alt
	BEFORE UPDATE ON pls_conta_copartic_contab FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_pls_conta_copartic_contab_alt();

