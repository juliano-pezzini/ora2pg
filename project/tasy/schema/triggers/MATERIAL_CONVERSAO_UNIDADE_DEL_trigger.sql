-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS material_conversao_unidade_del ON material_conversao_unidade CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_material_conversao_unidade_del() RETURNS trigger AS $BODY$
declare
	ie_protocol_w	varchar(1);
BEGIN
	select	coalesce(max('S'),'N') ie_protocol
	into STRICT	ie_protocol_w
	from	protocolo_medic_material	a
	where	a.cd_unidade_medida		= OLD.cd_unidade_medida
	and		a.cd_material			= OLD.cd_material  LIMIT 1;

	if (ie_protocol_w = 'S') then
		--Registro de unidade de medida vinculado a medicamento em cadastro de protocolos

		CALL wheb_mensagem_pck.exibir_mensagem_abort(1086177);
	end if;
RETURN OLD;
end;
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_material_conversao_unidade_del() FROM PUBLIC;

CREATE TRIGGER material_conversao_unidade_del
	BEFORE DELETE ON material_conversao_unidade FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_material_conversao_unidade_del();

