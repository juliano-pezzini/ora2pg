-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS agenda_hc_paciente_afterpost ON agenda_hc_paciente CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_agenda_hc_paciente_afterpost() RETURNS trigger AS $BODY$
DECLARE

ie_gerar_solic_pront_w	varchar(1);

BEGIN
if (wheb_usuario_pck.get_ie_executar_trigger	= 'S')  then


	select 	max(ie_gerar_solic_pront)
	into STRICT 	ie_gerar_solic_pront_w
	from 	agenda_home_care
	where 	nr_sequencia = NEW.nr_seq_agenda;


	if (ie_gerar_solic_pront_w = 'S') and
	   ((OLD.cd_pessoa_fisica is null) or (OLD.cd_pessoa_fisica <> NEW.cd_pessoa_fisica)) then
	   CALL hc_Gerar_Solic_Pront_Agenda(NEW.cd_pessoa_fisica,
				       NEW.nr_seq_agenda,
				       NEW.nr_sequencia,
				       NEW.dt_agenda,
				       NEW.nm_usuario
				      );
	end if;
end if;
RETURN NEW;
END
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_agenda_hc_paciente_afterpost() FROM PUBLIC;

CREATE TRIGGER agenda_hc_paciente_afterpost
	AFTER INSERT OR UPDATE ON agenda_hc_paciente FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_agenda_hc_paciente_afterpost();

