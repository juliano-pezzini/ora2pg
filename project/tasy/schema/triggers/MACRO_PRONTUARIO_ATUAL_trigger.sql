-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS macro_prontuario_atual ON macro_prontuario CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_macro_prontuario_atual() RETURNS trigger AS $BODY$
declare
    nr_sequencia_rem_w bigint;
BEGIN
  BEGIN
    --wheb_usuario_pck.get_ie_executar_trigger

    BEGIN
        if (TG_OP = 'INSERT') then
            BEGIN
                $if $$tasy_local_dict=true $then
                nr_sequencia_rem_w := get_remote_sequence('seq:funcao_macro_seq');
                $else
                select nextval('funcao_macro_seq') into STRICT nr_sequencia_rem_w;
                $end

                insert into funcao_macro(nr_sequencia, ds_macro, cd_funcao, dt_atualizacao, nm_usuario, cd_exp_observacao, ie_situacao)
                values (nr_sequencia_rem_w /*funcao_macro_seq.nextval*/
, NEW.nm_macro, 6001, LOCALTIMESTAMP, 'Tasy', 557610, 'A');
            end;
        elsif (TG_OP = 'UPDATE') then
            BEGIN
                update funcao_macro
                   set ds_macro       = NEW.nm_macro,
                       dt_atualizacao = LOCALTIMESTAMP
                 where ds_macro = OLD.nm_macro
                   and nm_usuario = 'Tasy'
                   and cd_funcao = 6001;
            end;
        end if;
    exception
        when others then
            null;
    end;
  END;
RETURN NEW;
end;
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_macro_prontuario_atual() FROM PUBLIC;

CREATE TRIGGER macro_prontuario_atual
	AFTER INSERT OR UPDATE ON macro_prontuario FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_macro_prontuario_atual();

