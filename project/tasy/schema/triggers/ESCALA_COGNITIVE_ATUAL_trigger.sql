-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS escala_cognitive_atual ON escala_cognitive CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_escala_cognitive_atual() RETURNS trigger AS $BODY$
declare

qt_reg_w	   smallint;
sql_w          varchar(200);
qt_score_w     smallint := 0;


qt_age_w smallint := 0;

qt_DOB_w  smallint := 0;

qt_address_w smallint := 0;

qt_year_w smallint := 0;

qt_location_w smallint := 0;

qt_recognize_object_w smallint := 0;

qt_TIME_w smallint := 0;

qt_SECOND_WAR_w smallint := 0;

qt_prime_minister_w smallint := 0;

qt_count_down_w smallint := 0;
BEGIN
  BEGIN

if (wheb_usuario_pck.get_ie_executar_trigger	= 'N') then
	goto Final;
end if;


select CASE WHEN NEW.ie_age='S' THEN 1  ELSE 0 END ,

				CASE WHEN NEW.IE_DOB ='S' THEN 1  ELSE 0 END ,

				CASE WHEN NEW.ie_address ='S' THEN 1  ELSE 0 END ,

				CASE WHEN NEW.ie_year='S' THEN 1  ELSE 0 END ,

				CASE WHEN NEW.ie_location ='S' THEN 1  ELSE 0 END ,

				CASE WHEN NEW.ie_recognize_object ='S' THEN 1  ELSE 0 END ,

				CASE WHEN NEW.IE_TIME='S' THEN 1  ELSE 0 END ,

				CASE WHEN NEW.IE_SECOND_WAR='S' THEN 1  ELSE 0 END ,

				CASE WHEN NEW.ie_prime_minister='S' THEN 1  ELSE 0 END ,

				CASE WHEN NEW.ie_count_down='S' THEN 1  ELSE 0 END 

        into STRICT qt_age_w,

        qt_DOB_w  ,

        qt_address_w ,

        qt_year_w ,

        qt_location_w,

        qt_recognize_object_w ,

        qt_TIME_w,

        qt_SECOND_WAR_w ,

        qt_prime_minister_w ,

        qt_count_down_w 

;

  BEGIN
  sql_w := 'CALL OBTER_PONT_ESC_COGNITIVE_MD(:1, :2, :3, :4, :5, :6, :7, :8, :9, :10) INTO :qt_score_p';


  EXECUTE sql_w USING IN qt_age_w, IN qt_DOB_w, IN qt_address_w, 
                                IN qt_year_w, IN qt_location_w, IN qt_recognize_object_w,
                                IN qt_TIME_w, IN qt_SECOND_WAR_w, IN qt_prime_minister_w,
                                IN qt_count_down_w,OUT qt_score_w;
  EXCEPTION
  WHEN OTHERS THEN
    qt_score_w := null;
  END;
  NEW.qt_score	:= qt_score_w;


<<Final>>
qt_reg_w	:= 0;

  END;
RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_escala_cognitive_atual() FROM PUBLIC;

CREATE TRIGGER escala_cognitive_atual
	BEFORE INSERT OR UPDATE ON escala_cognitive FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_escala_cognitive_atual();

