-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS pls_regra_coparticipacao_atual ON pls_regra_coparticipacao CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_pls_regra_coparticipacao_atual() RETURNS trigger AS $BODY$
declare
BEGIN
if (coalesce(wheb_usuario_pck.get_ie_executar_trigger, 'S') = 'S') then
	if (TG_OP = 'UPDATE') then
		if (NEW.vl_base_max != OLD.vl_base_max) or (NEW.vl_base_max is null and OLD.vl_base_max is not null) or (NEW.vl_base_max is not null and OLD.vl_base_max is null) then
			
			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'VL_BASE_MAX', OLD.vl_base_max,
							NEW.vl_base_max, 'A');
		end if;
		
		if (NEW.vl_base_min != OLD.vl_base_min) or (NEW.vl_base_min is null and OLD.vl_base_min is not null) or (NEW.vl_base_min is not null and OLD.vl_base_min is null) then
			
			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'VL_BASE_MIN', OLD.vl_base_min,
							NEW.vl_base_min, 'A');
		end if;

		if (NEW.nr_seq_prestador != OLD.nr_seq_prestador) or (NEW.nr_seq_prestador is null and OLD.nr_seq_prestador is not null) or (NEW.nr_seq_prestador is not null and OLD.nr_seq_prestador is null) then
			
			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'NR_SEQ_PRESTADOR', OLD.nr_seq_prestador,
							NEW.nr_seq_prestador, 'A');
		end if;

		if (NEW.nr_seq_tipo_prestador != OLD.nr_seq_tipo_prestador) or (NEW.nr_seq_tipo_prestador is null and OLD.nr_seq_tipo_prestador is not null) or (NEW.nr_seq_tipo_prestador is not null and OLD.nr_seq_tipo_prestador is null) then
			
			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'NR_SEQ_TIPO_PRESTADOR', OLD.nr_seq_tipo_prestador,
							NEW.nr_seq_tipo_prestador, 'A');
		end if;	

		if (NEW.nr_seq_tipo_coparticipacao != OLD.nr_seq_tipo_coparticipacao) or (NEW.nr_seq_tipo_coparticipacao is null and OLD.nr_seq_tipo_coparticipacao is not null) or (NEW.nr_seq_tipo_coparticipacao is not null and OLD.nr_seq_tipo_coparticipacao is null) then
			
			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'NR_SEQ_TIPO_COPARTICIPACAO', OLD.nr_seq_tipo_coparticipacao,
							NEW.nr_seq_tipo_coparticipacao, 'A');
		end if;	

		if (NEW.qt_eventos_minimo != OLD.qt_eventos_minimo) or (NEW.qt_eventos_minimo is null and OLD.qt_eventos_minimo is not null) or (NEW.qt_eventos_minimo is not null and OLD.qt_eventos_minimo is null) then
			
			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'QT_EVENTOS_MINIMO', OLD.qt_eventos_minimo,
							NEW.qt_eventos_minimo, 'A');
		end if;	

		if (NEW.qt_meses_intervalo != OLD.qt_meses_intervalo) or (NEW.qt_meses_intervalo is null and OLD.qt_meses_intervalo is not null) or (NEW.qt_meses_intervalo is not null and OLD.qt_meses_intervalo is null) then
			
			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'QT_MESES_INTERVALO', OLD.qt_meses_intervalo,
							NEW.qt_meses_intervalo, 'A');
		end if;	

		if (NEW.ie_tipo_data_consistencia != OLD.ie_tipo_data_consistencia) or (NEW.ie_tipo_data_consistencia is null and OLD.ie_tipo_data_consistencia is not null) or (NEW.ie_tipo_data_consistencia is not null and OLD.ie_tipo_data_consistencia is null) then
			
			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'IE_TIPO_DATA_CONSISTENCIA', OLD.ie_tipo_data_consistencia,
							NEW.ie_tipo_data_consistencia, 'A');
		end if;	

		if (NEW.ie_incidencia_proc_mat != OLD.ie_incidencia_proc_mat) or (NEW.ie_incidencia_proc_mat is null and OLD.ie_incidencia_proc_mat is not null) or (NEW.ie_incidencia_proc_mat is not null and OLD.ie_incidencia_proc_mat is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'IE_INCIDENCIA_PROC_MAT', OLD.ie_incidencia_proc_mat,
							NEW.ie_incidencia_proc_mat, 'A');
		end if;	

		if (NEW.ie_tipo_atendimento != OLD.ie_tipo_atendimento) or (NEW.ie_tipo_atendimento is null and OLD.ie_tipo_atendimento is not null) or (NEW.ie_tipo_atendimento is not null and OLD.ie_tipo_atendimento is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'IE_TIPO_ATENDIMENTO', OLD.ie_tipo_atendimento,
							NEW.ie_tipo_atendimento, 'A');
		end if;	

		if (NEW.ie_forma_cobr_internacao != OLD.ie_forma_cobr_internacao) or (NEW.ie_forma_cobr_internacao is null and OLD.ie_forma_cobr_internacao is not null) or (NEW.ie_forma_cobr_internacao is not null and OLD.ie_forma_cobr_internacao is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'IE_FORMA_COBR_INTERNACAO', OLD.ie_forma_cobr_internacao,
							NEW.ie_forma_cobr_internacao, 'A');
		end if;	

		if (NEW.ie_prestador_cooperado != OLD.ie_prestador_cooperado) or (NEW.ie_prestador_cooperado is null and OLD.ie_prestador_cooperado is not null) or (NEW.ie_prestador_cooperado is not null and OLD.ie_prestador_cooperado is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'IE_PRESTADOR_COOPERADO', OLD.ie_prestador_cooperado,
							NEW.ie_prestador_cooperado, 'A');
		end if;	

		if (NEW.dt_inicio_vigencia != OLD.dt_inicio_vigencia) or (NEW.dt_inicio_vigencia is null and OLD.dt_inicio_vigencia is not null) or (NEW.dt_inicio_vigencia is not null and OLD.dt_inicio_vigencia is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'DT_INICIO_VIGENCIA', OLD.dt_inicio_vigencia,
							NEW.dt_inicio_vigencia, 'A');
		end if;	

		if (NEW.dt_fim_vigencia != OLD.dt_fim_vigencia) or (NEW.dt_fim_vigencia is null and OLD.dt_fim_vigencia is not null) or (NEW.dt_fim_vigencia is not null and OLD.dt_fim_vigencia is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'DT_FIM_VIGENCIA', OLD.dt_fim_vigencia,
							NEW.dt_fim_vigencia, 'A');
		end if;

		if (NEW.dt_contrato_de != OLD.dt_contrato_de) or (NEW.dt_contrato_de is null and OLD.dt_contrato_de is not null) or (NEW.dt_contrato_de is not null and OLD.dt_contrato_de is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'DT_CONTRATO_DE', OLD.dt_contrato_de,
							NEW.dt_contrato_de, 'A');
		end if;

		if (NEW.dt_contrato_ate != OLD.dt_contrato_ate) or (NEW.dt_contrato_ate is null and OLD.dt_contrato_ate is not null) or (NEW.dt_contrato_ate is not null and OLD.dt_contrato_ate is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'DT_CONTRATO_ATE', OLD.dt_contrato_ate,
							NEW.dt_contrato_ate, 'A');		
		end if;

		if (NEW.qt_idade_min != OLD.qt_idade_min) or (NEW.qt_idade_min is null and OLD.qt_idade_min is not null) or (NEW.qt_idade_min is not null and OLD.qt_idade_min is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'QT_IDADE_MIN', OLD.qt_idade_min,
							NEW.qt_idade_min, 'A');
		end if;

		if (NEW.qt_idade_max != OLD.qt_idade_max) or (NEW.qt_idade_max is null and OLD.qt_idade_max is not null) or (NEW.qt_idade_max is not null and OLD.qt_idade_max is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'QT_IDADE_MAX', OLD.qt_idade_max,
							NEW.qt_idade_max, 'A');
		end if;

		if (NEW.ie_titularidade != OLD.ie_titularidade) or (NEW.ie_titularidade is null and OLD.ie_titularidade is not null) or (NEW.ie_titularidade is not null and OLD.ie_titularidade is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'IE_TITULARIDADE', OLD.ie_titularidade,
							NEW.ie_titularidade, 'A');
		end if;

		if (NEW.ie_tipo_parentesco != OLD.ie_tipo_parentesco) or (NEW.ie_tipo_parentesco is null and OLD.ie_tipo_parentesco is not null) or (NEW.ie_tipo_parentesco is not null and OLD.ie_tipo_parentesco is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'IE_TIPO_PARENTESCO', OLD.ie_tipo_parentesco,
							NEW.ie_tipo_parentesco, 'A');
		end if;

		if (NEW.qt_ocorrencias != OLD.qt_ocorrencias) or (NEW.qt_ocorrencias is null and OLD.qt_ocorrencias is not null) or (NEW.qt_ocorrencias is not null and OLD.qt_ocorrencias is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'QT_OCORRENCIAS', OLD.qt_ocorrencias,
							NEW.qt_ocorrencias, 'A');
		end if;

		if (NEW.ie_tipo_ocorrencia != OLD.ie_tipo_ocorrencia) or (NEW.ie_tipo_ocorrencia is null and OLD.ie_tipo_ocorrencia is not null) or (NEW.ie_tipo_ocorrencia is not null and OLD.ie_tipo_ocorrencia is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'IE_TIPO_OCORRENCIA', OLD.ie_tipo_ocorrencia,
							NEW.ie_tipo_ocorrencia, 'A');
		end if;
			
		if (NEW.qt_diaria_inicial != OLD.qt_diaria_inicial) or (NEW.qt_diaria_inicial is null and OLD.qt_diaria_inicial is not null) or (NEW.qt_diaria_inicial is not null and OLD.qt_diaria_inicial is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'QT_DIARIA_INICIAL', OLD.qt_diaria_inicial,
							NEW.qt_diaria_inicial, 'A');
		end if;
			
		if (NEW.qt_diaria_final != OLD.qt_diaria_final) or (NEW.qt_diaria_final is null and OLD.qt_diaria_final is not null) or (NEW.qt_diaria_final is not null and OLD.qt_diaria_final is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'QT_DIARIA_FINAL', OLD.qt_diaria_final,
							NEW.qt_diaria_final, 'A');
		end if;

		if (NEW.qt_ocorrencia_grupo_serv != OLD.qt_ocorrencia_grupo_serv) or (NEW.qt_ocorrencia_grupo_serv is null and OLD.qt_ocorrencia_grupo_serv is not null) or (NEW.qt_ocorrencia_grupo_serv is not null and OLD.qt_ocorrencia_grupo_serv is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'QT_OCORRENCIA_GRUPO_SERV', OLD.qt_ocorrencia_grupo_serv,
							NEW.qt_ocorrencia_grupo_serv, 'A');
		end if;

		if (NEW.qt_periodo_ocor != OLD.qt_periodo_ocor) or (NEW.qt_periodo_ocor is null and OLD.qt_periodo_ocor is not null) or (NEW.qt_periodo_ocor is not null and OLD.qt_periodo_ocor is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'QT_PERIODO_OCOR', OLD.qt_periodo_ocor,
							NEW.qt_periodo_ocor, 'A');
		end if;

		if (NEW.ie_tipo_periodo_ocor != OLD.ie_tipo_periodo_ocor) or (NEW.ie_tipo_periodo_ocor is null and OLD.ie_tipo_periodo_ocor is not null) or (NEW.ie_tipo_periodo_ocor is not null and OLD.ie_tipo_periodo_ocor is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'IE_TIPO_PERIODO_OCOR', OLD.ie_tipo_periodo_ocor,
							NEW.ie_tipo_periodo_ocor, 'A');
		end if;

		if (NEW.ie_ano_calendario_outras_ocor != OLD.ie_ano_calendario_outras_ocor) or (NEW.ie_ano_calendario_outras_ocor is null and OLD.ie_ano_calendario_outras_ocor is not null) or (NEW.ie_ano_calendario_outras_ocor is not null and OLD.ie_ano_calendario_outras_ocor is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'IE_ANO_CALENDARIO_OUTRAS_OCOR', OLD.ie_ano_calendario_outras_ocor,
							NEW.ie_ano_calendario_outras_ocor, 'A');
		end if;

		if (NEW.nr_seq_grupo_serv != OLD.nr_seq_grupo_serv) or (NEW.nr_seq_grupo_serv is null and OLD.nr_seq_grupo_serv is not null) or (NEW.nr_seq_grupo_serv is not null and OLD.nr_seq_grupo_serv is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'NR_SEQ_GRUPO_SERV', OLD.nr_seq_grupo_serv,
							NEW.nr_seq_grupo_serv, 'A');
		end if;

		if (NEW.cd_procedimento != OLD.cd_procedimento) or (NEW.cd_procedimento is null and OLD.cd_procedimento is not null) or (NEW.cd_procedimento is not null and OLD.cd_procedimento is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'CD_PROCEDIMENTO', OLD.cd_procedimento,
							NEW.cd_procedimento, 'A');
		end if;

		if (NEW.ie_considera_outra_ocor_regra != OLD.ie_considera_outra_ocor_regra) or (NEW.ie_considera_outra_ocor_regra is null and OLD.ie_considera_outra_ocor_regra is not null) or (NEW.ie_considera_outra_ocor_regra is not null and OLD.ie_considera_outra_ocor_regra is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'IE_CONSIDERA_OUTRA_OCOR_REGRA', OLD.ie_considera_outra_ocor_regra,
							NEW.ie_considera_outra_ocor_regra, 'A');
		end if;

		if (NEW.ie_tipo_incidencia != OLD.ie_tipo_incidencia) or (NEW.ie_tipo_incidencia is null and OLD.ie_tipo_incidencia is not null) or (NEW.ie_tipo_incidencia is not null and OLD.ie_tipo_incidencia is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'IE_TIPO_INCIDENCIA', OLD.ie_tipo_incidencia,
							NEW.ie_tipo_incidencia, 'A');
		end if;

		if (NEW.tx_coparticipacao != OLD.tx_coparticipacao) or (NEW.tx_coparticipacao is null and OLD.tx_coparticipacao is not null) or (NEW.tx_coparticipacao is not null and OLD.tx_coparticipacao is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'TX_COPARTICIPACAO', OLD.tx_coparticipacao,
							NEW.tx_coparticipacao, 'A');
		end if;

		if (NEW.vl_maximo != OLD.vl_maximo) or (NEW.vl_maximo is null and OLD.vl_maximo is not null) or (NEW.vl_maximo is not null and OLD.vl_maximo is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'VL_MAXIMO', OLD.vl_maximo,
							NEW.vl_maximo, 'A');
		end if;

		if (NEW.vl_coparticipacao != OLD.vl_coparticipacao) or (NEW.vl_coparticipacao is null and OLD.vl_coparticipacao is not null) or (NEW.vl_coparticipacao is not null and OLD.vl_coparticipacao is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'VL_COPARTICIPACAO', OLD.vl_coparticipacao,
							NEW.vl_coparticipacao, 'A');
		end if;

		if (NEW.ie_incidencia_valor_fixo != OLD.ie_incidencia_valor_fixo) or (NEW.ie_incidencia_valor_fixo is null and OLD.ie_incidencia_valor_fixo is not null) or (NEW.ie_incidencia_valor_fixo is not null and OLD.ie_incidencia_valor_fixo is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'IE_INCIDENCIA_VALOR_FIXO', OLD.ie_incidencia_valor_fixo,
							NEW.ie_incidencia_valor_fixo, 'A');
		end if;

		if (NEW.ie_incidencia_valor_maximo != OLD.ie_incidencia_valor_maximo) or (NEW.ie_incidencia_valor_maximo is null and OLD.ie_incidencia_valor_maximo is not null) or (NEW.ie_incidencia_valor_maximo is not null and OLD.ie_incidencia_valor_maximo is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'IE_INCIDENCIA_VALOR_MAXIMO', OLD.ie_incidencia_valor_maximo,
							NEW.ie_incidencia_valor_maximo, 'A');
		end if;

		if (NEW.ie_periodo_valor_maximo != OLD.ie_periodo_valor_maximo) or (NEW.ie_periodo_valor_maximo is null and OLD.ie_periodo_valor_maximo is not null) or (NEW.ie_periodo_valor_maximo is not null and OLD.ie_periodo_valor_maximo is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'IE_PERIODO_VALOR_MAXIMO', OLD.ie_periodo_valor_maximo,
							NEW.ie_periodo_valor_maximo, 'A');
		end if;

		if (NEW.cd_sistema_anterior != OLD.cd_sistema_anterior) or (NEW.cd_sistema_anterior is null and OLD.cd_sistema_anterior is not null) or (NEW.cd_sistema_anterior is not null and OLD.cd_sistema_anterior is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'CD_SISTEMA_ANTERIOR', OLD.cd_sistema_anterior,
							NEW.cd_sistema_anterior, 'A');
		end if;

		if (NEW.ie_reajuste != OLD.ie_reajuste) or (NEW.ie_reajuste is null and OLD.ie_reajuste is not null) or (NEW.ie_reajuste is not null and OLD.ie_reajuste is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'IE_REAJUSTE', OLD.ie_reajuste,
							NEW.ie_reajuste, 'A');
		end if;

		if (NEW.nr_seq_plano != OLD.nr_seq_plano) or (NEW.nr_seq_plano is null and OLD.nr_seq_plano is not null) or (NEW.nr_seq_plano is not null and OLD.nr_seq_plano is null) then

			CALL pls_grava_log_regra_copartic(	NEW.nr_sequencia, 'NR_SEQ_PLANO', OLD.nr_seq_plano,
							NEW.nr_seq_plano, 'A');
		end if;
	elsif (TG_OP = 'DELETE') then
		CALL pls_grava_log_regra_copartic(	OLD.nr_sequencia, null, null,
						null, 'D');
	end if;
end if;

IF TG_OP = 'DELETE' THEN
	RETURN OLD;
ELSE
	RETURN NEW;
END IF;

end;
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_pls_regra_coparticipacao_atual() FROM PUBLIC;

CREATE TRIGGER pls_regra_coparticipacao_atual
	BEFORE UPDATE OR DELETE ON pls_regra_coparticipacao FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_pls_regra_coparticipacao_atual();

