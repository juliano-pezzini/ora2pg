-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS reg_caso_teste_after ON reg_caso_teste CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_reg_caso_teste_after() RETURNS trigger AS $BODY$
declare
 
qt_scope_w		bigint;
 
BEGIN 
 
if (NEW.ie_tipo_documento = 'T') then -- Verificação 
 
	select	count(1) 
	into STRICT	qt_scope_w 
	from	reg_escopo_product_req 
	where	nr_seq_product_req = NEW.nr_seq_product;
 
	if (qt_scope_w > 0) then 
		insert into reg_escopo_caso_teste( 
			nr_sequencia, 
			dt_atualizacao, 
			nm_usuario, 
			dt_atualizacao_nrec, 
			nm_usuario_nrec, 
			nr_seq_escopo, 
			nr_seq_caso_teste 
		) 
			SELECT	nextval('reg_escopo_caso_teste_seq'), 
				LOCALTIMESTAMP, 
				NEW.nm_usuario, 
				LOCALTIMESTAMP, 
				NEW.nm_usuario, 
				nr_seq_escopo, 
				NEW.nr_sequencia 
			from	reg_escopo_product_req 
			where	nr_seq_product_req = NEW.nr_seq_product;
	end if;
 
elsif (NEW.ie_tipo_documento = 'V') then -- Validação 
 
	select	count(1) 
	into STRICT	qt_scope_w 
	from	reg_escopo_customer_req 
	where	nr_customer_req = NEW.nr_seq_customer;
 
	if (qt_scope_w > 0) then 
		insert into reg_escopo_caso_teste( 
			nr_sequencia, 
			dt_atualizacao, 
			nm_usuario, 
			dt_atualizacao_nrec, 
			nm_usuario_nrec, 
			nr_seq_escopo, 
			nr_seq_caso_teste 
		) 
			SELECT	nextval('reg_escopo_caso_teste_seq'), 
				LOCALTIMESTAMP, 
				NEW.nm_usuario, 
				LOCALTIMESTAMP, 
				NEW.nm_usuario, 
				nr_seq_escopo, 
				NEW.nr_sequencia 
			from	reg_escopo_customer_req 
			where	nr_customer_req = NEW.nr_seq_customer;
	end if;
 
end if;
 
RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_reg_caso_teste_after() FROM PUBLIC;

CREATE TRIGGER reg_caso_teste_after
	AFTER INSERT ON reg_caso_teste FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_reg_caso_teste_after();

