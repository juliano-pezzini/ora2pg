-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS trg_lista_equipe_med_presc ON prescr_procedimento CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_trg_lista_equipe_med_presc() RETURNS trigger AS $BODY$
BEGIN
  IF ((TG_OP = 'UPDATE') OR (TG_OP = 'INSERT')) AND (COALESCE(NEW.IE_STATUS_EXECUCAO,'0')= '20') THEN
    CALL SP_INSERIR_EXAME_LST_MEDICA(NEW.NR_PRESCRICAO, NEW.NR_SEQUENCIA, NEW.NR_SEQ_PROC_INTERNO);
  END IF;
  IF ((TG_OP = 'UPDATE') OR (TG_OP = 'INSERT')) AND (COALESCE(NEW.IE_STATUS_EXECUCAO,'0')= '10') THEN
    DELETE FROM LISTA_EQUIPE_MED_EXEC WHERE NR_PRESCRICAO = NEW.NR_SEQUENCIA AND NR_SEQ_PRESCRICAO = NEW.NR_SEQUENCIA;
  END IF;

RETURN NEW;
END
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_trg_lista_equipe_med_presc() FROM PUBLIC;

CREATE TRIGGER trg_lista_equipe_med_presc
	BEFORE INSERT OR UPDATE ON prescr_procedimento FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_trg_lista_equipe_med_presc();

