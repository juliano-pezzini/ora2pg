-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS escala_tev_alt_atual ON escala_tev CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_escala_tev_alt_atual() RETURNS trigger AS $BODY$
declare
qt_reg_w		bigint  := 0;
quebra_w		varchar(20)	:= Chr(13)||chr(10);
qt_imc_w		double precision;
ie_padrao_tev_w		varchar(10)	:= 'D';
qt_contra_prof_mec_w	bigint	:= 0;
qt_Nadroparina_w	varchar(50);
qt_contra_ind_relat_w	bigint	:= 0;
ie_condicao_w		varchar(1);

ie_cir_alto_risco_w		varchar(1);
ie_cir_pequeno_porte_w		varchar(1);
ie_cir_grande_medio_porte_w	varchar(1);
qt_absoluta_w			bigint;
qt_relativa_w			bigint;
qt_questao_5_w			bigint;

ie_artroplastia_joelho_w	varchar(1);
ie_artroplastia_quadril_w	varchar(1);
ie_fratura_quadril_w		varchar(1);
ie_oncol_curativa_w		varchar(1);
ie_trauma_medular_w		varchar(1);
ie_politrauma_w	 		varchar(1);

ds_texto_w			varchar(4000);
ds_motivo_w			varchar(255);

pragma autonomous_transaction;



	function Obter_Texto_Tev(ie_regra_p	text)
					return text is
	ds_texto_w	varchar(4000);
	BEGIN
	select	max(ds_texto)
	into STRICT	ds_texto_w
	from	REGRA_ESCALA_TEV
	where	ie_regra	= ie_regra_p;

	ds_texto_w	:= replace(ds_texto_w,'@NADROPARINA',qt_Nadroparina_w);
	return ds_texto_w;
	end;



	procedure	Inserir_Descricao_Idade is
	BEGIN

	if (NEW.qt_idade	< 40) then
		NEW.ds_resultado:= NEW.ds_resultado||coalesce(Obter_Texto_Tev(1),obter_desc_expressao(347111) || quebra_w || obter_desc_expressao(347112));
	end if;
	end;

	procedure Inserir_Medicacao is

	BEGIN

	if (NEW.ie_risco	= 'A') then
		if (NEW.qt_peso	< 70) then
			qt_Nadroparina_w	:= '3.800';
		else
			qt_Nadroparina_w	:= '5.700';
		end if;
		NEW.ds_resultado	:= NEW.ds_resultado||quebra_w||quebra_w||coalesce(Obter_Texto_Tev(2),obter_desc_expressao(347128) || quebra_w ||
						   obter_desc_expressao(347130) || quebra_w ||
						   obter_desc_expressao(347131) || qt_Nadroparina_w ||
						   obter_desc_expressao(347132) || quebra_w ||
						   obter_desc_expressao(347134));

	elsif (NEW.ie_risco	= 'M') then

		NEW.ds_resultado	:= NEW.ds_resultado||quebra_w||quebra_w||coalesce(Obter_Texto_Tev(3),obter_desc_expressao(347135) || quebra_w ||
						obter_desc_expressao(347136) || quebra_w ||
						obter_desc_expressao(347137) || quebra_w ||
						obter_desc_expressao(347138));
	end if;

	if (NEW.ie_risco in ('A','M')) then
		NEW.ds_resultado	:= NEW.ds_resultado||quebra_w||quebra_w||coalesce(Obter_Texto_Tev(4),obter_desc_expressao(347139));
	end if;
	end;


	procedure Inserir_Contra_Indicacao is

	BEGIN

	if (ie_condicao_w	= 'S') and (qt_contra_prof_mec_w	= 0)then
		NEW.IE_QUIMIOPROFILAXIA := 'N';
		NEW.IE_PROFILAXIA_MEC    := 'S';
		NEW.ds_resultado	:= 	coalesce(Obter_Texto_Tev(5),obter_desc_expressao(347150));

	elsif (qt_contra_ind_relat_w	> 0) and (ie_condicao_w	= 'N') and (qt_contra_prof_mec_w	= 0) then
		NEW.IE_QUIMIOPROFILAXIA := 'A';
		NEW.IE_PROFILAXIA_MEC    := 'S';
		NEW.ds_resultado	:= 	coalesce(Obter_Texto_Tev(6),obter_desc_expressao(347185));
		NEW.ds_resultado	:= NEW.ds_resultado||quebra_w||quebra_w||coalesce(Obter_Texto_Tev(7),obter_desc_expressao(347161));
		Inserir_Medicacao; -- edilson
	elsif (qt_contra_ind_relat_w	> 0) and --Edilson
		(ie_condicao_w	= 'N'	) and (qt_contra_prof_mec_w	> 0) then
		NEW.IE_QUIMIOPROFILAXIA := 'A';
		NEW.IE_PROFILAXIA_MEC   := 'A';
		NEW.ds_resultado	:= coalesce(Obter_Texto_Tev(8),obter_desc_expressao(347156));

		NEW.ds_resultado	:= NEW.ds_resultado ||quebra_w||quebra_w|| coalesce(Obter_Texto_Tev(9),obter_desc_expressao(347158)) ||quebra_w;
		NEW.ds_resultado	:= NEW.ds_resultado	||coalesce(Obter_Texto_Tev(10),obter_desc_expressao(347159) || obter_desc_expressao(347160));

		NEW.ds_resultado	:= NEW.ds_resultado||quebra_w||quebra_w||coalesce(Obter_Texto_Tev(11),obter_desc_expressao(347161));
		Inserir_Medicacao; -- edilson
	elsif (ie_condicao_w	= 'S') and (qt_contra_prof_mec_w > 0) then
		NEW.IE_QUIMIOPROFILAXIA := 'N';
		NEW.IE_PROFILAXIA_MEC   := 'A';
		NEW.ds_resultado	:= coalesce(Obter_Texto_Tev(12),obter_desc_expressao(347162));
--		:new.ds_resultado	:= :new.ds_resultado||quebra_w||quebra_w||'Optando-se pela quimioprofilaxia a recomendação é:';
--		Inserir_Medicacao;
		NEW.ds_resultado	:= NEW.ds_resultado ||quebra_w||quebra_w|| coalesce(Obter_Texto_Tev(13),obter_desc_expressao(347158)) ||quebra_w;
		NEW.ds_resultado	:= NEW.ds_resultado	||coalesce(Obter_Texto_Tev(14),obter_desc_expressao(347159) || obter_desc_expressao(347167));
	end if;
	end;


	procedure inserir_texto_tipo_cirur is

	BEGIN
	ds_texto_w := null;

	if	((ie_artroplastia_quadril_w = 'S') or (ie_artroplastia_joelho_w = 'S')) then
		ds_texto_w := ds_texto_w ||  coalesce(Obter_Texto_Tev(15),obter_desc_expressao(347113) || quebra_w || quebra_w || obter_desc_expressao(347115) || obter_desc_expressao(347116) || quebra_w || quebra_w);
	end if;

	if (ie_cir_grande_medio_porte_w = 'S') then
		ds_texto_w	:= ds_texto_w || coalesce(Obter_Texto_Tev(16),obter_desc_expressao(347117) || quebra_w);
	end if;

	if (ie_fratura_quadril_w = 'S') then
		ds_texto_w	:= ds_texto_w || coalesce(Obter_Texto_Tev(17),obter_desc_expressao(347118) || quebra_w);
	end if;

	if (ie_oncol_curativa_w = 'S') then
		ds_texto_w	:= ds_texto_w || coalesce(Obter_Texto_Tev(18),obter_desc_expressao(347119) || quebra_w);
	end if;

	if	((ie_trauma_medular_w = 'S') or (ie_politrauma_w = 'S')) then
		ds_texto_w	:= ds_texto_w || coalesce(Obter_Texto_Tev(19),obter_desc_expressao(347121) || quebra_w);
	end if;

	if (ie_artroplastia_quadril_w = 'S') then
		ds_texto_w	:= ds_texto_w || coalesce(Obter_Texto_Tev(20),obter_desc_expressao(347118) || quebra_w);
	end if;

	if (ie_artroplastia_joelho_w = 'S') then
		ds_texto_w	:= ds_texto_w || coalesce(Obter_Texto_Tev(21),obter_desc_expressao(347122) || quebra_w);
	end if;

	NEW.ds_resultado	:= NEW.ds_resultado || ds_texto_w;

	end;

	procedure inserir_texto_adic_cir is

	BEGIN
	ds_texto_w := 	quebra_w || quebra_w ||
			coalesce(Obter_Texto_Tev(22),obter_desc_expressao(347125));
	NEW.ds_resultado	:= NEW.ds_resultado || ds_texto_w;
	end;

	procedure inserir_resposta_cirurgia is

	BEGIN

	NEW.IE_QUIMIOPROFILAXIA := 'A';
	NEW.IE_PROFILAXIA_MEC    := 'A';

	if (ie_cir_pequeno_porte_w = 'S') then
		NEW.ie_risco := 'B';
		NEW.IE_PROFILAXIA_MEC := 'A';
		NEW.IE_QUIMIOPROFILAXIA := 'A';
		NEW.ds_resultado := 	coalesce(Obter_Texto_Tev(23),obter_desc_expressao(347168));

	elsif (ie_cir_grande_medio_porte_w = 'S') and (NEW.qt_idade	< 40) and (qt_reg_w > 0) then
		if 	((qt_relativa_w + qt_absoluta_w) = 0) then
			if (NEW.qt_peso	< 70) then
				qt_Nadroparina_w	:= '1.900';
			else
				qt_Nadroparina_w	:= '2.850';
			end if;
			NEW.IE_QUIMIOPROFILAXIA := 'S';
			NEW.IE_PROFILAXIA_MEC    := 'N';
			NEW.ie_risco := 'M';
			NEW.ds_resultado := 	coalesce(Obter_Texto_Tev(24),obter_desc_expressao(347169) || quebra_w || quebra_w ||
						obter_desc_expressao(347135) || quebra_w ||
						obter_desc_expressao(347171) || quebra_w ||
						obter_desc_expressao(347131) || qt_Nadroparina_w || obter_desc_expressao(347132) || quebra_w ||
						obter_desc_expressao(347172) || quebra_w || quebra_w ||
						obter_desc_expressao(347117));
						inserir_texto_adic_cir;
		elsif	((qt_relativa_w + qt_absoluta_w) > 0) and (qt_absoluta_w = 1) and (qt_questao_5_w = 0) then
			NEW.ie_risco := 'M';
			NEW.IE_QUIMIOPROFILAXIA := 'N';
			NEW.IE_PROFILAXIA_MEC    := 'S';
			NEW.ds_resultado := 	coalesce(Obter_Texto_Tev(25),obter_desc_expressao(347150));
		elsif	((qt_relativa_w + qt_absoluta_w) > 0) and (qt_absoluta_w > 0) and (qt_questao_5_w > 0) then
			NEW.ie_risco := 'M';
			NEW.IE_QUIMIOPROFILAXIA := 'N';
			NEW.IE_PROFILAXIA_MEC := 'A';
			NEW.ds_resultado := 	coalesce(Obter_Texto_Tev(26),obter_desc_expressao(347173) || quebra_w || quebra_w ||
						obter_desc_expressao(347158) || quebra_w || quebra_w ||
						obter_desc_expressao(347159) || obter_desc_expressao(347167));

		elsif	((qt_relativa_w + qt_absoluta_w) > 0) and (qt_relativa_w > 0) and (qt_questao_5_w > 0) then

			if (NEW.qt_peso	< 70) then
				qt_Nadroparina_w	:= '1.900';
			else
				qt_Nadroparina_w	:= '2.850';
			end if;

			NEW.ie_risco := 'M';
			NEW.IE_QUIMIOPROFILAXIA := 'A';
			NEW.IE_PROFILAXIA_MEC := 'A';
			NEW.ds_resultado :=	coalesce(Obter_Texto_Tev(27),obter_desc_expressao(347156) || quebra_w || quebra_w ||
						obter_desc_expressao(347158) || quebra_w || quebra_w ||
						obter_desc_expressao(347159) || obter_desc_expressao(347167) || quebra_w || quebra_w ||
						obter_desc_expressao(347161) || quebra_w || quebra_w ||
						obter_desc_expressao(347135) || quebra_w ||
						obter_desc_expressao(347136) || quebra_w ||
						obter_desc_expressao(347131) || qt_Nadroparina_w || obter_desc_expressao(347176) ||quebra_w||
						obter_desc_expressao(347172) || quebra_w || quebra_w ||
						obter_desc_expressao(347117));
						inserir_texto_adic_cir;

		elsif	((qt_relativa_w + qt_absoluta_w) > 0) and (qt_relativa_w = 1) and (qt_absoluta_w = 0) and (qt_questao_5_w = 0) then

			if (NEW.qt_peso	< 70) then
				qt_Nadroparina_w	:= '1.900';
			else
				qt_Nadroparina_w	:= '2.850';
			end if;

			NEW.ie_risco := 'M';
			NEW.IE_QUIMIOPROFILAXIA := 'A';
			NEW.IE_PROFILAXIA_MEC := 'S';
			NEW.ds_resultado :=	coalesce(Obter_Texto_Tev(28),obter_desc_expressao(347185) || quebra_w || quebra_w ||
						obter_desc_expressao(347161) || quebra_w || quebra_w ||
						obter_desc_expressao(347135) ||  quebra_w ||
						obter_desc_expressao(347136) || quebra_w ||
						obter_desc_expressao(347131) || qt_Nadroparina_w || obter_desc_expressao(347176) || quebra_w ||
						obter_desc_expressao(347172) || quebra_w || quebra_w ||
						obter_desc_expressao(347117));
						inserir_texto_adic_cir;

		end if;
	elsif (ie_cir_grande_medio_porte_w = 'S') and (NEW.qt_idade	< 40) and (qt_reg_w = 0) then
		NEW.ie_risco := 'B';
		NEW.IE_PROFILAXIA_MEC := 'A';
		NEW.IE_QUIMIOPROFILAXIA := 'A';
		NEW.ds_resultado := 	coalesce(Obter_Texto_Tev(29),'Pacientes submetidos a procedimentos cirúrgicos considerados de baixo risco para TEV podem ainda assim apresentar trombose, ' ||
					'particularmente aqueles mais idosos ou com fatores de risco associados, como câncer, história prévia ou familiar de TEV, ou ' ||
					'mesmo associações de vários fatores comuns, como tabagismo, varizes, obesidade, reposição hormonal, etc. Nestes pacientes, a avaliação ' ||
					'de risco deve ser individualizada, podendo-se optar pela prescrição da profilaxia.');
	elsif (ie_cir_grande_medio_porte_w = 'S') and
		(NEW.qt_idade	>= 40 AND NEW.qt_idade <= 60) and (qt_reg_w = 0) then
		if 	((qt_relativa_w + qt_absoluta_w) = 0) then

			if (NEW.qt_peso	< 70) then
				qt_Nadroparina_w	:= '1.900';
			else
				qt_Nadroparina_w	:= '2.850';
			end if;

			NEW.ie_risco := 'M';
			NEW.IE_QUIMIOPROFILAXIA := 'S';
			NEW.IE_PROFILAXIA_MEC := 'N';
			NEW.ds_resultado := 	coalesce(Obter_Texto_Tev(30),obter_desc_expressao(347169) || quebra_w || quebra_w ||
						obter_desc_expressao(347135) || quebra_w ||
						obter_desc_expressao(347136) || quebra_w ||
						obter_desc_expressao(347131) || qt_Nadroparina_w || obter_desc_expressao(347178) || quebra_w ||
						obter_desc_expressao(347172) || quebra_w || quebra_w ||
						obter_desc_expressao(347117));
						inserir_texto_adic_cir;
		elsif	((qt_relativa_w + qt_absoluta_w) > 0) and (qt_absoluta_w = 1) and (qt_questao_5_w = 0) then
			NEW.ie_risco := 'M';
			NEW.IE_QUIMIOPROFILAXIA := 'N';
			NEW.IE_PROFILAXIA_MEC := 'S';
			NEW.ds_resultado := 	coalesce(Obter_Texto_Tev(31),obter_desc_expressao(347150));
		elsif	((qt_relativa_w + qt_absoluta_w) > 0) and (qt_absoluta_w > 0) and (qt_questao_5_w > 0) then
			NEW.ie_risco := 'M';
			NEW.IE_QUIMIOPROFILAXIA := 'N';
			NEW.IE_PROFILAXIA_MEC := 'A';
			NEW.ds_resultado := 	coalesce(Obter_Texto_Tev(32),obter_desc_expressao(347156) || quebra_w || quebra_w ||
						obter_desc_expressao(347158) || quebra_w || quebra_w ||
						obter_desc_expressao(347159) || obter_desc_expressao(347167));
		elsif	((qt_relativa_w + qt_absoluta_w) > 0) and (qt_relativa_w > 0) and (qt_questao_5_w > 0) then

			if (NEW.qt_peso	< 70) then
				qt_Nadroparina_w	:= '1.900';
			else
				qt_Nadroparina_w	:= '2.850';
			end if;

			NEW.ie_risco := 'M';
			NEW.IE_QUIMIOPROFILAXIA := 'A';
			NEW.IE_PROFILAXIA_MEC := 'A';
			NEW.ds_resultado :=	coalesce(Obter_Texto_Tev(33),obter_desc_expressao(347156) || quebra_w || quebra_w ||
						obter_desc_expressao(347158) || quebra_w || quebra_w ||
						obter_desc_expressao(347159) || 347167 || quebra_w || quebra_w ||
						obter_desc_expressao(347161) || quebra_w || quebra_w ||
						obter_desc_expressao(347135) || quebra_w ||
						obter_desc_expressao(347136) || quebra_w ||
						obter_desc_expressao(347131) || qt_Nadroparina_w || obter_desc_expressao(347178) || quebra_w ||
						obter_desc_expressao(347172) || quebra_w || quebra_w ||
						obter_desc_expressao(347117));
						inserir_texto_adic_cir;
		elsif	((qt_relativa_w + qt_absoluta_w) > 0) and (qt_relativa_w = 1) and (qt_absoluta_w = 0) and (qt_questao_5_w = 0) then

			if (NEW.qt_peso	< 70) then
				qt_Nadroparina_w	:= '1.900';
			else
				qt_Nadroparina_w	:= '2.850';
			end if;

			NEW.ie_risco := 'M';
			NEW.IE_QUIMIOPROFILAXIA := 'A';
			NEW.IE_PROFILAXIA_MEC  := 'S';
			NEW.ds_resultado :=	coalesce(Obter_Texto_Tev(34), obter_desc_expressao(347185)|| quebra_w || quebra_w ||
						obter_desc_expressao(347161) || quebra_w || quebra_w ||
						obter_desc_expressao(347135) || quebra_w ||
						obter_desc_expressao(347136) || quebra_w ||
						obter_desc_expressao(347131) || qt_Nadroparina_w || obter_desc_expressao(347178) || quebra_w ||
						obter_desc_expressao(347172) || quebra_w || quebra_w ||
						obter_desc_expressao(347117));
						inserir_texto_adic_cir;
		end if;
	elsif	(((ie_cir_grande_medio_porte_w = 'S') and
		(NEW.qt_idade	>= 40 AND NEW.qt_idade <= 60) and (qt_reg_w > 0)) or
		((ie_cir_alto_risco_w = 'S') or
		(ie_cir_grande_medio_porte_w = 'S' AND NEW.qt_idade > 60))) then
		if	((qt_relativa_w + qt_absoluta_w) > 0) then
			if (qt_absoluta_w = 1)  and (qt_questao_5_w = 0) then
				NEW.ie_risco := 'A';
				NEW.IE_PROFILAXIA_MEC 	 := 'S';
				NEW.IE_QUIMIOPROFILAXIA := 'N';
				NEW.ds_resultado :=	coalesce(Obter_Texto_Tev(35),obter_desc_expressao(347150));
			elsif (qt_relativa_w > 0) and (qt_absoluta_w = 0) and (qt_questao_5_w = 0) then

				if (NEW.qt_peso	< 70) then
					qt_Nadroparina_w	:= '3.800';
				else
					qt_Nadroparina_w	:= '5.700';
				end if;

				NEW.ie_risco := 'A';
				NEW.IE_QUIMIOPROFILAXIA := 'A';
				NEW.IE_PROFILAXIA_MEC   := 'S';
				NEW.ds_resultado := 	coalesce(Obter_Texto_Tev(36),obter_desc_expressao(347146) || quebra_w || quebra_w ||
							obter_desc_expressao(347161) || quebra_w ||
							obter_desc_expressao(347128) || quebra_w ||
							obter_desc_expressao(347130) || quebra_w ||
							obter_desc_expressao(347131) || qt_Nadroparina_w || obter_desc_expressao(347178) || quebra_w ||
							obter_desc_expressao(347134) || quebra_w || quebra_w);
							inserir_texto_tipo_cirur;
							inserir_texto_adic_cir;

			elsif (qt_absoluta_w > 0) and (qt_questao_5_w > 0) then
				NEW.ie_risco := 'A';
				NEW.IE_PROFILAXIA_MEC := 'A';
				NEW.IE_QUIMIOPROFILAXIA := 'N';
				NEW.ds_resultado := 	coalesce(Obter_Texto_Tev(37),obter_desc_expressao(347173) || quebra_w || quebra_w ||
							obter_desc_expressao(347158) || quebra_w || quebra_w ||
							obter_desc_expressao(347159) || obter_desc_expressao(347167));

			elsif (qt_relativa_w > 0) and (qt_absoluta_w = 0) and (qt_questao_5_w > 0) then

				if (NEW.qt_peso	< 70) then
					qt_Nadroparina_w	:= '3.800';
				else
					qt_Nadroparina_w	:= '5.700';
				end if;

				NEW.ie_risco := 'A';
				NEW.IE_QUIMIOPROFILAXIA := 'A';
				NEW.IE_PROFILAXIA_MEC := 'A';
				NEW.ds_resultado := 	coalesce(Obter_Texto_Tev(38),obter_desc_expressao(347156) || quebra_w || quebra_w ||
							obter_desc_expressao(347158) || quebra_w || quebra_w ||
							obter_desc_expressao(347159) || obter_desc_expressao(347167) || quebra_w || quebra_w ||
							obter_desc_expressao(347161) || quebra_w ||
							obter_desc_expressao(347128) || quebra_w ||
							obter_desc_expressao(347130) || quebra_w ||
							obter_desc_expressao(347131) || qt_Nadroparina_w || obter_desc_expressao(347178) || quebra_w ||
							obter_desc_expressao(347134) || quebra_w || quebra_w);
							inserir_texto_tipo_cirur;
							inserir_texto_adic_cir;
			end if;
		else
			if (NEW.qt_peso	< 70) then
				qt_Nadroparina_w	:= '3.800';
			else
				qt_Nadroparina_w	:= '5.700';
			end if;

			NEW.ie_risco := 'A';
			NEW.IE_PROFILAXIA_MEC := 'N';
			NEW.IE_QUIMIOPROFILAXIA := 'S';
			NEW.ds_resultado := 	coalesce(Obter_Texto_Tev(39),obter_desc_expressao(347169) || quebra_w || quebra_w ||
						obter_desc_expressao(347128) || quebra_w ||
						obter_desc_expressao(347130) || quebra_w ||
						obter_desc_expressao(347131) || qt_Nadroparina_w || obter_desc_expressao(347178) || quebra_w||
						obter_desc_expressao(347134) || quebra_w || quebra_w);
						inserir_texto_tipo_cirur;
						inserir_texto_adic_cir;
		end if;
	end if;

	end;

BEGIN

ie_padrao_tev_w	:= coalesce(NEW.ie_padrao,'D');
if (coalesce(NEW.ie_padrao,'D')	= 'ALT') then
	NEW.IE_IDADE_MAIOR	:='N';
	if (NEW.qt_idade	>= 55) then
		NEW.IE_IDADE_MAIOR	:= 'S';
	end if;

	qt_imc_w	:= dividir(NEW.qt_peso,(NEW.qt_altura_cm /100) * (NEW.qt_altura_cm /100));
	if (qt_imc_w	>=30 ) then
		NEW.IE_OBESIDADE	:= 'S';
	end if;
	NEW.IE_CONDICAO	:= 'N';
	ie_condicao_w		:= 'N';
	qt_reg_w		:= 0;

	if (NEW.IE_HIPERSENSIBILIDADE_HEPARINA	= 'S') then
		qt_reg_w:= qt_reg_w+1;
	end if;

	if (NEW.IE_PLAQUETOPENIA_HEPARINA	= 'S') then
		qt_reg_w:= qt_reg_w+1;
	end if;

	if (NEW.IE_SANGRAMENTO_ULCERA	= 'S') then
		qt_reg_w:= qt_reg_w+1;
	end if;

	if (NEW.IE_ANTICOAGULACAO	= 'S') then
		qt_reg_w:= qt_reg_w+1;
	end if;

	if (qt_reg_w	> 0) then
		ie_condicao_w	:= 'S';
	end if;

	qt_contra_ind_relat_w := 0;

	if (NEW.IE_COAGULOPATIA	= 'S') then
		qt_contra_ind_relat_w:= qt_contra_ind_relat_w+1;
	end if;

	if (NEW.IE_ULCERA_ATIVA	= 'S') then
		qt_contra_ind_relat_w:= qt_contra_ind_relat_w+1;
	end if;

	if (NEW.IE_HIPERTENSAO	= 'S') then
		qt_contra_ind_relat_w:= qt_contra_ind_relat_w+1;
	end if;

	if (NEW.IE_INSUF_RENAL	= 'S') then
		qt_contra_ind_relat_w:= qt_contra_ind_relat_w+1;
	end if;

	if (NEW.IE_CIRURGIA_INTRACRANIANA	= 'S') then
		qt_contra_ind_relat_w:= qt_contra_ind_relat_w+1;
	end if;

	if (NEW.IE_PUNCAO_LIQUORICA	= 'S') then
		qt_contra_ind_relat_w:= qt_contra_ind_relat_w+1;
	end if;

	if (qt_reg_w > 0) or (qt_contra_ind_relat_w > 0) then
		NEW.IE_CONDICAO	:= 'S';
	end if;

	NEW.ds_resultado	:= null;
	qt_reg_w		:= 0;


	if (NEW.IE_ESCARA	= 'S') then
		qt_contra_prof_mec_w	:= qt_contra_prof_mec_w + 1;
	end if;

	if (NEW.IE_FRATURA_EXPOSTA	= 'S') then
		qt_contra_prof_mec_w	:= qt_contra_prof_mec_w + 1;
	end if;

	if (NEW.IE_INFECCAO_MMII	= 'S') then
		qt_contra_prof_mec_w	:= qt_contra_prof_mec_w + 1;
	end if;

	if (NEW.IE_INSUF_ART_MMII	= 'S') then
		qt_contra_prof_mec_w	:= qt_contra_prof_mec_w + 1;
	end if;

	if (NEW.IE_INSUF_CARD_GRAVE	= 'S') then
		qt_contra_prof_mec_w	:= qt_contra_prof_mec_w + 1;
	end if;


	if (NEW.IE_CLINICO_CIRURGICO	= 'C') then
		if (NEW.IE_TROMBOFILIA	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_IDADE_MAIOR	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_ECLAMPSIA	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_AVCI	= 'S') then
			qt_reg_w	:= qt_reg_w+1;
		end if;
		if (NEW.IE_TVP_EP_PREVIA	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_DOENCA_REUMATOL	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_HIST_FAMILIAR_TEV	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_ANTICONCEPCIONAIS	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_PUERPERIO	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_OBESIDADE	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_INTERNACAO_UTI	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_CAT_VENOSO_CENTRAL	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_PARALISIA_INF	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_CANCER	= 'S') then
			qt_reg_w	:= qt_reg_w+1;
		end if;
		if (NEW.IE_GRAVIDEZ	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_INSUF_RESP	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_INSUF_ARTERIAL	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_TRH	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_ICC	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_DPOC	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_PNEUMONIA	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_INFLA_INTESTINAL= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_VARIZES	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_INFECSAO_GRAVE	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_QUIMIOTERAPIA	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_SINDROME_NEFROTICA	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_DOENCA_AUTOIMUNE	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_ABORTAMENTO	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_TRAUMA	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_IAM	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_QUEIMADO	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_OUTROS	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;

		NEW.IE_FATOR_RISCO:='N';
		if (qt_reg_w	> 0) and (NEW.IE_MOBILIDADE_REDUZIDA	= 'S')then
			NEW.IE_FATOR_RISCO := 'S';
		end if;

		NEW.ie_risco	:= 'B';
		if (NEW.IE_FATOR_RISCO	= 'N') then
			NEW.ie_risco	:= 'B';
		elsif (NEW.IE_FATOR_RISCO	= 'S') then
			NEW.ie_risco	:= 'A';

			if (NEW.qt_idade	<= 40) and (ie_condicao_w	= 'N') then
				NEW.ie_risco	:= 'B';
			end if;
			if (NEW.qt_idade < 40) then
				NEW.ie_risco	:= 'B';
			end if;
		end if;
		NEW.ds_resultado	:= Null;



		if (NEW.ie_risco	= 'B') then
			NEW.IE_QUIMIOPROFILAXIA := 'N';
			NEW.IE_PROFILAXIA_MEC  := 'N';

			NEW.ds_resultado	:= 	coalesce(Obter_Texto_Tev(40),obter_desc_expressao(347190) ||
			obter_desc_expressao(347191));

			if (NEW.IE_FATOR_RISCO	= 'S') and (NEW.qt_idade	< 40) then

				NEW.ds_resultado	:=obter_desc_expressao(347195) ||
								quebra_w ||quebra_w || '*Pacientes com menos de 40 anos, mas com fatores de risco adicionais, podem se beneficiar de profilaxia';
				--Inserir_Descricao_Idade;
				Inserir_Contra_Indicacao;
			end if;


		elsif (NEW.ie_risco	= 'A') then

			if (ie_condicao_w	= 'N') and (qt_contra_ind_relat_w = 0) and -- Edilson
				(qt_contra_prof_mec_w = 0) then --Edilson
				NEW.IE_QUIMIOPROFILAXIA := 'S';
				NEW.IE_PROFILAXIA_MEC  := 'N';
				NEW.ds_resultado	:= coalesce(Obter_Texto_Tev(41),obter_desc_expressao(347169));
				Inserir_Medicacao;


				--:new.ds_resultado	:= :new.ds_resultado||quebra_w||quebra_w||'Obs.: No estudo de Harenberg e cols, houve aumento na mortalidade no grupo que recebeu nadroparina, comparado com HNF (Haemostasis, 1993; 26(3):127-139';
			else
				Inserir_Contra_Indicacao;

			end if;

			Inserir_Descricao_Idade;
		end if;



	elsif (NEW.IE_CLINICO_CIRURGICO	= 'I')	and (ie_padrao_tev_w	= 'D'	)then


		qt_reg_w	:= 0;
		/*Altíssimo risco*/

		if (NEW.IE_TVP_EP_PREVIA	= 'S') then
			qt_reg_w	:= qt_reg_w+1;
		end if;

		if (NEW.IE_AVCI	= 'S') then
			qt_reg_w	:= qt_reg_w+1;
		end if;

		if (NEW.IE_CIRUR_ORTOPEDICA	= 'S') then
			qt_reg_w	:= qt_reg_w+1;
		end if;

		if (NEW.IE_CIRUR_CANCER	= 'S') then
			qt_reg_w	:= qt_reg_w+1;
		end if;

		if (NEW.IE_TRAUM_RAQUIMEDULARES	= 'S') then
			qt_reg_w	:= qt_reg_w+1;
		end if;

		if (NEW.IE_TROMBOFILIA	= 'S') then
			qt_reg_w	:= qt_reg_w+1;
		end if;

		NEW.IE_ALTISSIMO_RISCO	:= 'N';

		if (qt_reg_w	> 0) then
			NEW.IE_ALTISSIMO_RISCO	:= 'S';
		end if;

		qt_reg_w	:= 0;

		/*Alto risco*/

		if (NEW.IE_CANCER	= 'S') then
			qt_reg_w	:= qt_reg_w+1;
		end if;

		if (NEW.IE_TRAUMA_GRAVE	= 'S') then
			qt_reg_w	:= qt_reg_w+1;
		end if;

		if (NEW.IE_ICC	= 'S') then
			qt_reg_w	:= qt_reg_w+1;
		end if;

		if (NEW.IE_DPOC	= 'S') then
			qt_reg_w	:= qt_reg_w+1;
		end if;

		if (NEW.IE_CIRUR_GRANDE	= 'S') then
			qt_reg_w	:= qt_reg_w+1;
		end if;
		NEW.IE_ALTO_RISCO	:= 'N';
		if (qt_reg_w	= 1) then
			NEW.IE_ALTO_RISCO	:= '1';
		elsif (qt_reg_w	= 2) then
			NEW.ie_alto_risco	:= '2';
		elsif (qt_reg_w	>= 3) then
			NEW.ie_alto_risco	:= '3';
		end if;


		qt_reg_w	:= 0;

		/*Risco*/

		if (NEW.IE_INFECSAO_GRAVE	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_PARALISIA_INF	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_RESTRICAO_PROLONG	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_VARIZES	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_QUEIMADO	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_OBESIDADE	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_ANTICONCEPCIONAIS	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_ECLAMPSIA	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_PUERPERIO	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_INFLA_INTESTINAL	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;


		if (NEW.IE_INTERNACAO_UTI	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_IAM	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_CAT_VENOSO_CENTRAL	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_DOENCA_AUTOIMUNE	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_SINDROME_NEFROTICA	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_MEMBROS_IMOB	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_TRAUMA	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_QUIMIOTERAPIA	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;

		if (NEW.IE_TRH	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_OUTROS	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;


		NEW.ie_fator_risco	:= 'N';

		if (qt_reg_w	= 1) then
			NEW.ie_fator_risco	:= '1';
		elsif (qt_reg_w between 2 and 4) then
			NEW.ie_fator_risco	:= '2';
		elsif (qt_reg_w	> 5) then
			NEW.ie_fator_risco	:= '5';
		end if;


		if (NEW.IE_NENHUM_ALT_RISCO	= 'S') and (NEW.qt_idade	> 60) then
			-- Paciente com mais de 60 anos. Considera-se alto risco. #@#@'
			CALL Wheb_mensagem_pck.exibir_mensagem_abort(264632);
		end if;
		if (ie_condicao_w	<> 'N') then
			NEW.ds_resultado	:= coalesce(Obter_Texto_Tev(42),'Paciente apresenta contra-indicação ao uso de quimioprofilaxia para TEV. Os métodos mecânicos indicados neste caso são: meia elástica de compressão gradual (MECG) e compressão pneumática intermitente (CPI). Os pacientes devem ser reavaliados em 2 dias.'||quebra_w);
		end if;
		Inserir_Descricao_Idade;

		if (NEW.IE_ALTISSIMO_RISCO	= 'N') and (NEW.ie_alto_risco		= 'N') and (NEW.ie_fator_risco		= 'N') then
			NEW.ie_risco	:= 'B';
		elsif (NEW.IE_ALTISSIMO_RISCO	= 'S') or (NEW.ie_alto_risco		in ('2','3'))then
			NEW.IE_RISCO	:= 'A';
		elsif (NEW.ie_fator_risco	<> 'N')then
			NEW.ie_risco	:= 'M';
		end if;

		Inserir_Medicacao;
	elsif (ie_padrao_tev_w	= 'ALT') and (NEW.ie_clinico_cirurgico	= 'I') then
		NEW.ie_risco	:= 'B';

		/* INICIO RESPOSTA 2 */

		ie_cir_alto_risco_w		:= NEW.ie_cir_alto_risco;
		ie_cir_pequeno_porte_w		:= NEW.ie_cir_pequeno_porte;
		ie_cir_grande_medio_porte_w	:= NEW.ie_cir_grande_medio_porte;


		ie_artroplastia_joelho_w	:= NEW.ie_artroplastia_joelho;
		ie_artroplastia_quadril_w	:= NEW.ie_artroplastia_quadril;
		ie_fratura_quadril_w		:= NEW.ie_fratura_quadril;
		ie_oncol_curativa_w		:= NEW.ie_oncol_curativa;
		ie_trauma_medular_w		:= NEW.ie_trauma_medular;
		ie_politrauma_w			:= NEW.ie_politrauma;
		/* FIM RESPOSTA 2 */

		/* INICIO RESPOSTA 3 */

		qt_reg_w	:= 0;
		if (NEW.IE_ABORTAMENTO	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		if (NEW.IE_AVCI	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		/*
		if	(:new.IE_HIST_FAMILIAR_TEV	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		*/
		if (NEW.IE_TVP_EP_PREVIA	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		if (NEW.IE_CANCER	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		if (NEW.IE_TABAGISMO	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		if (NEW.IE_CAT_VENOSO_CENTRAL	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		if (NEW.IE_ANTICONCEPCIONAIS	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		if (NEW.IE_INFLA_INTESTINAL	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		if (NEW.IE_DPOC	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		/*
		if	(:new.IE_DOENCA_AUTOIMUNE	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		*/
		if (NEW.IE_IAM	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		if (NEW.IE_INFECSAO_GRAVE	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		if (NEW.IE_INSUF_ARTERIAL	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		if (NEW.IE_ICC	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		if (NEW.IE_INSUF_RESP	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		if (NEW.IE_INTERNACAO_UTI	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		if (NEW.IE_OBESIDADE	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		if (NEW.IE_PARALISIA_INF	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		/*
		if	(:new.IE_PNEUMONIA	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		*/
		if (NEW.IE_PUERPERIO	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		if (NEW.IE_QUIMIOTERAPIA	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		if (NEW.IE_SINDROME_NEFROTICA	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		if (NEW.IE_TROMBOFILIA	= 'S') then
			qt_reg_w	:= qt_reg_w	+ 1;
		end if;
		if (NEW.IE_DOENCA_REUMATOL	= 'S') then
			qt_reg_w:= qt_reg_w+1;
		end if;
		if (NEW.IE_TRH	= 'S')then
			qt_reg_w:= qt_reg_w+1;
		end if;

		NEW.IE_FATOR_RISCO := 'N';
		if (qt_reg_w	> 0) then
			NEW.IE_FATOR_RISCO := 'S';
		end if;
		/* FIM RESPOSTA 3 */

		/* INICIO RESPOSTA 4 */

		qt_absoluta_w	:= 0;
		qt_relativa_w	:= 0;
		if (NEW.IE_HIPERSENSIBILIDADE_HEPARINA	= 'S')then
			qt_absoluta_w:= qt_absoluta_w + 1;
		end if;
		if (NEW.IE_PLAQUETOPENIA_HEPARINA	= 'S')then
			qt_absoluta_w:= qt_absoluta_w + 1;
		end if;
		if (NEW.IE_SANGRAMENTO_ULCERA	= 'S')then
			qt_absoluta_w:= qt_absoluta_w + 1;
		end if;
		if (NEW.IE_ANTICOAGULACAO = 'S')then
			qt_absoluta_w:= qt_absoluta_w + 1;
		end if;
		if (NEW.IE_CIRURGIA_INTRACRANIANA	= 'S')then
			qt_relativa_w:= qt_relativa_w + 1;
		end if;
		if (NEW.IE_PUNCAO_LIQUORICA	= 'S')then
			qt_relativa_w:= qt_relativa_w + 1;
		end if;
		if (NEW.IE_COAGULOPATIA	= 'S')then
			qt_relativa_w:= qt_relativa_w + 1;
		end if;
		if (NEW.IE_HIPERTENSAO	= 'S')then
			qt_relativa_w:= qt_relativa_w + 1;
		end if;
		if (NEW.IE_INSUF_RENAL	= 'S')then
			qt_relativa_w:= qt_relativa_w + 1;
		end if;
		/* FIM RESPOSTA 4 */

		/* INICIO RESPOSTA 5 */

		qt_questao_5_w := 0;
		if (NEW.IE_FRATURA_EXPOSTA	= 'S')then
			qt_questao_5_w	:= qt_questao_5_w + 1;
		end if;
		if (NEW.IE_INFECCAO_MMII	= 'S')then
			qt_questao_5_w	:= qt_questao_5_w + 1;
		end if;
		if (NEW.IE_INSUF_ART_MMII	= 'S')then
			qt_questao_5_w	:= qt_questao_5_w + 1;
		end if;
		if (NEW.IE_INSUF_CARD_GRAVE	= 'S')then
			qt_questao_5_w	:= qt_questao_5_w + 1;
		end if;
		if (NEW.IE_ESCARA	= 'S')then
			qt_questao_5_w	:= qt_questao_5_w + 1;
		end if;
		/* FIM RESPOTA 5 */

		NEW.IE_RISCO	:= 'B';
		if (NEW.IE_CIR_PEQUENO_PORTE = 'S') then
			NEW.IE_RISCO	:= 'B';
		elsif	((NEW.IE_CIR_ALTO_RISCO	= 'S') 	or
			((NEW.IE_CIR_GRANDE_MEDIO_PORTE = 'S')	and
			((NEW.qt_idade	> 60)	or
			(NEW.qt_idade	between 40 and 60  AND qt_reg_w	> 0))))	then
			NEW.IE_RISCO	:= 'A';
		elsif (NEW.IE_CIR_GRANDE_MEDIO_PORTE = 'S') and
			(NEW.qt_idade between 40 and 60 AND qt_reg_w	= 0) or
			(NEW.qt_idade	< 40 AND qt_reg_w	> 0) then
			NEW.IE_RISCO	:= 'M';
		elsif	(NEW.qt_idade	< 40 AND qt_reg_w	= 0) or (NEW.IE_CIR_PEQUENO_PORTE in ('S')) then
			NEW.IE_RISCO	:= 'B';
		end if;
		Inserir_Descricao_Idade;

		if (ie_condicao_w	= 'N') and (NEW.ie_risco	<> 'B') then
			NEW.IE_QUIMIOPROFILAXIA := 'S';
			NEW.IE_PROFILAXIA_MEC  := 'N';
			NEW.ds_resultado	:= coalesce(Obter_Texto_Tev(43),obter_desc_expressao(347169));
			Inserir_Medicacao;

			--:new.ds_resultado	:= :new.ds_resultado||quebra_w||quebra_w||'Obs.: No estudo de Harenberg e cols, houve aumento na mortalidade no grupo que recebeu nadroparina, comparado com HNF (Haemostasis, 1993; 26(3):127-139';
		else
			Inserir_Contra_Indicacao;
		end if;


		if (NEW.ie_risco	= 'B') then
			NEW.IE_QUIMIOPROFILAXIA := 'N';
			NEW.IE_PROFILAXIA_MEC := 'N';
			NEW.ds_resultado	:= coalesce(Obter_Texto_Tev(44),obter_desc_expressao(347195));
		end if;

		/* Inicio Cirugia */

		inserir_resposta_cirurgia;

		/* Fim cirurgia */

	end if;

end if;

if (NEW.qt_peso is null) and (ie_padrao_tev_w	= 'ALT') then
	NEW.ds_resultado := null;
end if;

if (NEW.IE_ANTICOAGULACAO	= 'S') and (ie_padrao_tev_w	= 'ALT') then
	NEW.ds_resultado	:= coalesce(Obter_Texto_Tev(45),obter_desc_expressao(599583));
end if;

if (NEW.IE_ANTICOAGULACAO	= 'S') and (ie_padrao_tev_w	= 'ALT') then
	NEW.IE_NAO_SE_APLICA	:= 'S';
end if;

if (NEW.IE_NAO_SE_APLICA	= 'S') and (ie_padrao_tev_w	= 'ALT') then
	NEW.ie_risco	:= 'N';

		NEW.ds_resultado	:= coalesce(Obter_Texto_Tev(46),obter_desc_expressao(347196));
	if (NEW.NR_SEQ_MOTIVO_TEV	is not null) then
		select	max(ds_motivo)
		into STRICT	ds_motivo_w
		from	tev_motivo
		where	nr_sequencia	= NEW.NR_SEQ_MOTIVO_TEV;

		if (ds_motivo_w	is not null) then
			NEW.ds_resultado	:= NEW.ds_resultado||chr(13) ||'    '|| obter_desc_expressao(293478) || ' ' || ds_motivo_w;
		end if;
	end if;


end if;

RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_escala_tev_alt_atual() FROM PUBLIC;

CREATE TRIGGER escala_tev_alt_atual
	BEFORE INSERT OR UPDATE ON escala_tev FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_escala_tev_alt_atual();

