-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS perda_contas_receb_baixa_ins ON perda_contas_receb_baixa CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_perda_contas_receb_baixa_ins() RETURNS trigger AS $BODY$
declare

ie_tipo_consistencia_w	varchar(15);
vl_saldo_w	double precision;

BEGIN
if (wheb_usuario_pck.get_ie_executar_trigger = 'S') then
select	vl_Saldo
into STRICT	vl_saldo_w
from	perda_contas_receber
where	nr_sequencia = NEW.nr_Seq_perda;

select	max(ie_tipo_consistencia)
into STRICT	ie_tipo_consistencia_w
from	fin_tipo_baixa_perda
where	nr_sequencia = NEW.nr_Seq_tipo_baixa;

if (ie_tipo_consistencia_w in (0,1,2)) and (NEW.ie_acao = '1') and (vl_saldo_w < NEW.vl_baixa) then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(217442);
end if;
end if;
RETURN NEW;
end;
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_perda_contas_receb_baixa_ins() FROM PUBLIC;

CREATE TRIGGER perda_contas_receb_baixa_ins
	BEFORE INSERT ON perda_contas_receb_baixa FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_perda_contas_receb_baixa_ins();

