-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS agenda_update ON agenda CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_agenda_update() RETURNS trigger AS $BODY$
DECLARE

ie_medico_executor_w		varchar(1);

BEGIN
if (NEW.cd_tipo_agenda = 1) then	/* cirurgias */
	NEW.ie_medico_executor := 'N';	/* Não informa médico executor */
elsif (NEW.cd_tipo_agenda = 2) then	/* exames */
	NEW.ie_medico_executor := 'S';	/* Sim, pode informar médico executor */
elsif (NEW.cd_tipo_agenda = 3) then	/* consultas */
	NEW.ie_medico_executor := 'E';	/* Exige informação do médico executor */
end if;

if (NEW.ie_tipo_agenda_consulta	is null) then
	NEW.ie_tipo_agenda_consulta	:= 'A';
end if;

RETURN NEW;
END
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_agenda_update() FROM PUBLIC;

CREATE TRIGGER agenda_update
	BEFORE INSERT ON agenda FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_agenda_update();

