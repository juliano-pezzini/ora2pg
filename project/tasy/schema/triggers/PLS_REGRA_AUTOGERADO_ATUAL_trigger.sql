-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS pls_regra_autogerado_atual ON pls_regra_autogerado CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_pls_regra_autogerado_atual() RETURNS trigger AS $BODY$
declare
ie_primeira_condicao_OK_w	varchar(1) := 'N';
ie_segunda_codicao_OK_w		varchar(1) := 'N';

BEGIN

if (NEW.IE_PRIMEIRA_CONDICAO in ('4','5')) then
	ie_primeira_condicao_OK_w	:= 'S';
end if;

if (NEW.IE_SEGUNDA_CONDICAO in ('4', '5')) then
	ie_segunda_codicao_OK_w		:= 'S';
end if;

if (ie_primeira_condicao_OK_w <> ie_segunda_codicao_OK_w) then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(263708); -- 'Caso uma das condições seja por grupo de prestadores, ambas as condições deverão ser por grupo de prestadores!
elsif (ie_primeira_condicao_OK_w = 'S') and (ie_segunda_codicao_OK_w = 'S') and
	((NEW.NR_SEQ_GRUPO_PREST_SOLIC is null) or (NEW.NR_SEQ_GRUPO_PREST_EXEC is null))then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(263709); --Para as condições por grupo de prestadores, é necessário que os campos "Grupo de prest solic" e "Grupo de prest exec" estejam informados!
end if;

RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_pls_regra_autogerado_atual() FROM PUBLIC;

CREATE TRIGGER pls_regra_autogerado_atual
	BEFORE INSERT OR UPDATE ON pls_regra_autogerado FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_pls_regra_autogerado_atual();

