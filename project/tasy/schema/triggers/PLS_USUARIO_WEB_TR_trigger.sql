-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS pls_usuario_web_tr ON pls_usuario_web CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_pls_usuario_web_tr() RETURNS trigger AS $BODY$
declare

/*nm_machine_w			v$session.machine%type;
osuser_w			v$session.osuser%type;
ds_programa_w			varchar2(255);
ds_action_w			v$session.action%type;
nm_id_sid_w			v$session.sid%type;
nm_id_serial_w			v$session.serial#%type;*/


BEGIN

null;

/*begin
	select	max(machine),
		max(osuser),
		substr(max(program), 1, 255),
		max(action),
		max(sid),
		max(serial#)
	into	nm_machine_w,
		osuser_w,
		ds_programa_w,
		ds_action_w,
		nm_id_sid_w,
		nm_id_serial_w
	from 	v$session
	where	audsid = userenv('sessionid');
exception
when others then
	nm_machine_w		:= null;
	osuser_w		:= null;
	ds_programa_w		:= null;
	ds_action_w		:= null;
	nm_id_sid_w		:= null;
	nm_id_serial_w		:= null;
end;

insert into pls_log_execucao_temp (	nr_sequencia,
					ds,
					ds_processo,
					data,
					nm_usuario,
					nm_id_sid,
					nm_id_serial,
					ds_extra) 
				values (pls_log_execucao_temp_seq.nextval,
					'PLS_USUARIO_WEB',
					'PLS_USUARIO_WEB',
					sysdate,
					:new.nm_usuario,
					nm_id_sid_w,
					nm_id_serial_w,
					'Seq PLS_USUARIO_WEB: '		|| :new.nr_sequencia || chr(10) || chr(10) || 
					'AplicacaoTasy: '		|| pls_se_aplicacao_tasy || chr(10) ||
					'MÃ¡quina: '			|| nm_machine_w || chr(10) ||
					'Osuser: '			|| osuser_w || chr(10) ||
					'Program: '			|| ds_programa_w || chr(10) ||
					'Action: '			|| ds_action_w || chr(10) || chr(10) || 
					'Nm usuario Old: ' 		|| :old.nm_usuario || chr(10) || 
					'Nm usuario New: ' 		|| :new.nm_usuario || chr(10) || 
					'Dt atualizacao Old: ' 		|| :old.dt_atualizacao || chr(10) || 
					'Dt atualizacao New: ' 		|| :new.dt_atualizacao || chr(10) || 
					'Dt alteracao senha Old: ' 	|| :old.dt_alteracao_senha || chr(10) || 
					'Dt alteracao senha New: ' 	|| :new.dt_alteracao_senha || chr(10) || chr(10) || 
					'Nm usuario nrec Old: '		|| :old.nm_usuario_nrec || chr(10) || 
					'Nm usuario nrec New: '		|| :new.nm_usuario_nrec || chr(10) || 
					'Dt atualizacao nrec Old: ' 	|| :old.dt_atualizacao_nrec || chr(10) || 
					'Dt atualizacao nrec New: ' 	|| :new.dt_atualizacao_nrec || chr(10) || chr(10) || dbms_utility.format_call_stack);*/

RETURN NEW;
end;
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_pls_usuario_web_tr() FROM PUBLIC;

CREATE TRIGGER pls_usuario_web_tr
	BEFORE INSERT OR UPDATE ON pls_usuario_web FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_pls_usuario_web_tr();

