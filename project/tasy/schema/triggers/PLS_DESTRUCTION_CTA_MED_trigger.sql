-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS pls_destruction_cta_med ON pls_conta_exclusao CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_pls_destruction_cta_med() RETURNS trigger AS $BODY$
declare
	Ds_aplicacao		varchar(50);
	ds_log_w		varchar(1500);
	ie_aplicacao_tasy_w	varchar(1);
BEGIN 
 
if (pls_se_aplicacao_tasy = 'S') then 
	Ds_aplicacao 		:= 'Aplicacao TASY ;';
	ie_aplicacao_tasy_w	:= 'S';
else 
	Ds_aplicacao 		:= 'Banco ;';
	ie_aplicacao_tasy_w	:= 'N';
end if;
 
ds_log_w := substr(pls_obter_detalhe_exec(false),1,1500);/*substr(	' Função ativa : '|| obter_funcao_ativa || chr(13) ||chr(10)|| 
			' CallStack: '|| chr(13) || chr(10)|| dbms_utility.format_call_stack,1,1500);*/
 
			--' Função ativa : '|| obter_funcao_ativa || chr(13) ||chr(10)|| 
insert into plscexc_cta(nr_sequencia, nm_usuario, nm_usuario_nrec, 
	dt_atualizacao, dt_atualizacao_nrec, ds_funcao_ativa, 
	ds_log_call, ie_aplicacao_tasy, nm_maquina, 
	nr_seq_excl, nm_usuario_nrec_excl, nm_usuario_excl, 
	nm_maquina_excl, ie_aplicacao_tasy_excl, dt_atualizacao_nrec_excl, 
	dt_atualizacao_excl ,ds_log_call_excl, ds_log_excl, 
	ds_funcao_ativa_excL) 
values (nextval('plscexc_cta_seq'),substr(coalesce(wheb_usuario_pck.get_nm_usuario,'Usuário não identificado '),1,14),substr(coalesce(wheb_usuario_pck.get_nm_usuario,'Usuário não identificado '),1,14), 
	 LOCALTIMESTAMP, LOCALTIMESTAMP, obter_funcao_ativa, 
	 ds_log_w, ie_aplicacao_tasy_w, wheb_usuario_pck.get_machine, 
	OLD.nr_sequencia, OLD.nm_usuario_nrec,OLD.nm_usuario, 
	OLD.nm_maquina, OLD.ie_aplicacao_tasy, OLD.dt_atualizacao_nrec, 
	OLD.dt_atualizacao, OLD.ds_log_call, OLD.ds_log, 
	OLD.ds_funcao_ativa);
 
RETURN OLD;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_pls_destruction_cta_med() FROM PUBLIC;

CREATE TRIGGER pls_destruction_cta_med
	BEFORE DELETE ON pls_conta_exclusao FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_pls_destruction_cta_med();

