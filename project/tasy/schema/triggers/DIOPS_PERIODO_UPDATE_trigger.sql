-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS diops_periodo_update ON diops_periodo CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_diops_periodo_update() RETURNS trigger AS $BODY$
declare

ds_maquina_w		varchar(80);
nm_usuario_maquina_w	varchar(30);

BEGIN

ds_maquina_w		:= substr(obter_inf_sessao(0),1,80);
nm_usuario_maquina_w	:= substr(obter_inf_sessao(1),1,30);

if (NEW.ie_fluxo_caixa		<> OLD.ie_fluxo_caixa) or (NEW.ie_idade_saldo		<> OLD.ie_idade_saldo) or (NEW.ie_lucro_prejuizo		<> OLD.ie_lucro_prejuizo) or (NEW.ie_solvencia		<> OLD.ie_solvencia) or (NEW.ie_balancete_ativo	<> OLD.ie_balancete_ativo) or (NEW.ie_balancete_passivo	<> OLD.ie_balancete_passivo) or (NEW.ie_balancete_receita	<> OLD.ie_balancete_receita) or (NEW.ie_balancete_despesa	<> OLD.ie_balancete_despesa) then

	/*
	insert into logXXXX_tasy
		(dt_atualizacao, nm_usuario, cd_log, ds_log)
	values(	sysdate, :new.nm_usuario, 1227,
	' NR_SEQUENCIA= '		|| :old.nr_sequencia		||
	' MAQUINA= '			|| ds_maquina_w			||
	' OUSER= '			|| nm_usuario_maquina_w 	||
	' ie_fluxo_caixa= ' 		|| :old.ie_fluxo_caixa 		|| ' - ' || :new.ie_fluxo_caixa 	||
	' ie_idade_saldo= '		|| :old.ie_idade_saldo 		|| ' - ' || :new.ie_idade_saldo 	||
	' ie_lucro_prejuizo= '		|| :old.ie_lucro_prejuizo 	|| ' - ' || :new.ie_lucro_prejuizo 	||
	' ie_solvencia= '		|| :old.ie_solvencia 		|| ' - ' || :new.ie_solvencia 		||
	' ie_balancete_ativo= '		|| :old.ie_balancete_ativo 	|| ' - ' || :new.ie_balancete_ativo 	||
	' ie_balancete_passivo= '	|| :old.ie_balancete_passivo	|| ' - ' || :new.ie_balancete_passivo 	||
	' ie_balancete_receita= '	|| :old.ie_balancete_receita 	|| ' - ' || :new.ie_balancete_receita	||
	' ie_balancete_despesa= '	|| :old.ie_balancete_despesa 	|| ' - ' || :new.ie_balancete_despesa);
	*/
	NEW.ie_fluxo_caixa		:= OLD.ie_fluxo_caixa;
	NEW.ie_idade_saldo		:= OLD.ie_idade_saldo;
	NEW.ie_lucro_prejuizo		:= OLD.ie_lucro_prejuizo;
	NEW.ie_solvencia		:= OLD.ie_solvencia;
	NEW.ie_balancete_ativo		:= OLD.ie_balancete_ativo;
	NEW.ie_balancete_passivo	:= OLD.ie_balancete_passivo;
	NEW.ie_balancete_receita	:= OLD.ie_balancete_receita;
	NEW.ie_balancete_despesa	:= OLD.ie_balancete_despesa;
end if;

RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_diops_periodo_update() FROM PUBLIC;

CREATE TRIGGER diops_periodo_update
	BEFORE UPDATE ON diops_periodo FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_diops_periodo_update();

