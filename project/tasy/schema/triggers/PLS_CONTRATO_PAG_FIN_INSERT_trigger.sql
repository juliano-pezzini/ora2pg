-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS pls_contrato_pag_fin_insert ON pls_contrato_pagador_fin CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_pls_contrato_pag_fin_insert() RETURNS trigger AS $BODY$
declare


ie_quant_dias_w		bigint;
dt_inicio_vig_param_w	timestamp;
dt_inicio_vigencia_w	timestamp;
BEGIN
  BEGIN

/* [161] - Quantidade de dias permitidos para a data inicial de vigência da informação financeira do pagador a partir da data atual. */

BEGIN
ie_quant_dias_w := obter_valor_param_usuario(1202, 161, Obter_Perfil_Ativo, NEW.nm_usuario, 0);
exception
when others then
	ie_quant_dias_w := null;
end;

if (ie_quant_dias_w is not null ) then

	dt_inicio_vigencia_w := NEW.dt_inicio_vigencia;
	if (dt_inicio_vigencia_w is not null) then

		dt_inicio_vig_param_w :=  (trunc(LOCALTIMESTAMP) + ie_quant_dias_w);

		if (dt_inicio_vigencia_w > dt_inicio_vig_param_w ) then
			-- A data de inicio de vigência não pode ser maior que #@DATA#@, Verifique!
			CALL wheb_mensagem_pck.exibir_mensagem_abort(823237,'DATA='||dt_inicio_vig_param_w);
		end if;
	end if;
end if;

  END;
RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_pls_contrato_pag_fin_insert() FROM PUBLIC;

CREATE TRIGGER pls_contrato_pag_fin_insert
	BEFORE INSERT OR UPDATE ON pls_contrato_pagador_fin FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_pls_contrato_pag_fin_insert();

