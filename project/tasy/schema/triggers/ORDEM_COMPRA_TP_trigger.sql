-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS ordem_compra_tp ON ordem_compra CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_ordem_compra_tp() RETURNS trigger AS $BODY$
DECLARE nr_seq_w bigint;ds_s_w   varchar(1);ds_c_w   varchar(1);ds_w	   varchar(1);ie_log_w varchar(1);BEGIN BEGIN ds_s_w := to_char(OLD.NR_ORDEM_COMPRA);  ds_c_w:=null;SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_SUBGRUPO_COMPRA,1,4000), substr(NEW.NR_SEQ_SUBGRUPO_COMPRA,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_SUBGRUPO_COMPRA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.PR_DESC_FINANCEIRO,1,4000), substr(NEW.PR_DESC_FINANCEIRO,1,4000), NEW.nm_usuario, nr_seq_w, 'PR_DESC_FINANCEIRO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_SETOR_ATENDIMENTO,1,4000), substr(NEW.CD_SETOR_ATENDIMENTO,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_SETOR_ATENDIMENTO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_FORMA_PAGTO,1,4000), substr(NEW.NR_SEQ_FORMA_PAGTO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_FORMA_PAGTO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_DOCUMENTO_EXTERNO,1,4000), substr(NEW.NR_DOCUMENTO_EXTERNO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_DOCUMENTO_EXTERNO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_LEITURA,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_LEITURA,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_LEITURA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_ACEITE,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_ACEITE,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_ACEITE', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NM_USUARIO_ACEITE,1,4000), substr(NEW.NM_USUARIO_ACEITE,1,4000), NEW.nm_usuario, nr_seq_w, 'NM_USUARIO_ACEITE', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_BAIXA,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_BAIXA,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_BAIXA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_ORDEM_COMPRA,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_ORDEM_COMPRA,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_ORDEM_COMPRA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_ESTABELECIMENTO,1,4000), substr(NEW.CD_ESTABELECIMENTO,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_ESTABELECIMENTO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.DS_OBSERVACAO,1,4000), substr(NEW.DS_OBSERVACAO,1,4000), NEW.nm_usuario, nr_seq_w, 'DS_OBSERVACAO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_LIBERACAO,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_LIBERACAO,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_LIBERACAO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_ATUALIZACAO,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_ATUALIZACAO,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_ATUALIZACAO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NM_USUARIO,1,4000), substr(NEW.NM_USUARIO,1,4000), NEW.nm_usuario, nr_seq_w, 'NM_USUARIO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_MOEDA,1,4000), substr(NEW.CD_MOEDA,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_MOEDA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.IE_SITUACAO,1,4000), substr(NEW.IE_SITUACAO,1,4000), NEW.nm_usuario, nr_seq_w, 'IE_SITUACAO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_INCLUSAO,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_INCLUSAO,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_INCLUSAO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_PESSOA_SOLICITANTE,1,4000), substr(NEW.CD_PESSOA_SOLICITANTE,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_PESSOA_SOLICITANTE', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_CGC_TRANSPORTADOR,1,4000), substr(NEW.CD_CGC_TRANSPORTADOR,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_CGC_TRANSPORTADOR', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.PR_MULTA_ATRASO,1,4000), substr(NEW.PR_MULTA_ATRASO,1,4000), NEW.nm_usuario, nr_seq_w, 'PR_MULTA_ATRASO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.PR_DESCONTO,1,4000), substr(NEW.PR_DESCONTO,1,4000), NEW.nm_usuario, nr_seq_w, 'PR_DESCONTO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.PR_DESC_PGTO_ANTEC,1,4000), substr(NEW.PR_DESC_PGTO_ANTEC,1,4000), NEW.nm_usuario, nr_seq_w, 'PR_DESC_PGTO_ANTEC', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_EMISSAO,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_EMISSAO,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_EMISSAO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_MOTIVO_ALTERACAO,1,4000), substr(NEW.CD_MOTIVO_ALTERACAO,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_MOTIVO_ALTERACAO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_LOCAL_ENTREGA,1,4000), substr(NEW.CD_LOCAL_ENTREGA,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_LOCAL_ENTREGA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_ENTREGA,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_ENTREGA,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_ENTREGA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.IE_AVISO_CHEGADA,1,4000), substr(NEW.IE_AVISO_CHEGADA,1,4000), NEW.nm_usuario, nr_seq_w, 'IE_AVISO_CHEGADA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_ORDEM_COMPRA,1,4000), substr(NEW.NR_ORDEM_COMPRA,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_ORDEM_COMPRA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_CGC_FORNECEDOR,1,4000), substr(NEW.CD_CGC_FORNECEDOR,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_CGC_FORNECEDOR', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_CONDICAO_PAGAMENTO,1,4000), substr(NEW.CD_CONDICAO_PAGAMENTO,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_CONDICAO_PAGAMENTO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_PRESCRICAO,1,4000), substr(NEW.NR_PRESCRICAO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_PRESCRICAO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_ORDEM_AGRUP,1,4000), substr(NEW.NR_ORDEM_AGRUP,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_ORDEM_AGRUP', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.IE_FRETE,1,4000), substr(NEW.IE_FRETE,1,4000), NEW.nm_usuario, nr_seq_w, 'IE_FRETE', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_APROVACAO,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_APROVACAO,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_APROVACAO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_INTERNO,1,4000), substr(NEW.NR_SEQ_INTERNO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_INTERNO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.DS_PESSOA_CONTATO,1,4000), substr(NEW.DS_PESSOA_CONTATO,1,4000), NEW.nm_usuario, nr_seq_w, 'DS_PESSOA_CONTATO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.IE_SOMENTE_PAGTO,1,4000), substr(NEW.IE_SOMENTE_PAGTO,1,4000), NEW.nm_usuario, nr_seq_w, 'IE_SOMENTE_PAGTO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_REQUISICAO,1,4000), substr(NEW.NR_REQUISICAO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_REQUISICAO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_PESSOA_FISICA,1,4000), substr(NEW.CD_PESSOA_FISICA,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_PESSOA_FISICA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_COMPRADOR,1,4000), substr(NEW.CD_COMPRADOR,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_COMPRADOR', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.VL_FRETE,1,4000), substr(NEW.VL_FRETE,1,4000), NEW.nm_usuario, nr_seq_w, 'VL_FRETE', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.PR_JUROS_NEGOCIADO,1,4000), substr(NEW.PR_JUROS_NEGOCIADO,1,4000), NEW.nm_usuario, nr_seq_w, 'PR_JUROS_NEGOCIADO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_ATENDIMENTO,1,4000), substr(NEW.NR_ATENDIMENTO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_ATENDIMENTO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NM_USUARIO_IMP,1,4000), substr(NEW.NM_USUARIO_IMP,1,4000), NEW.nm_usuario, nr_seq_w, 'NM_USUARIO_IMP', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.IE_EMITE_OBS,1,4000), substr(NEW.IE_EMITE_OBS,1,4000), NEW.nm_usuario, nr_seq_w, 'IE_EMITE_OBS', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_MOTIVO_CANCEL,1,4000), substr(NEW.NR_SEQ_MOTIVO_CANCEL,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_MOTIVO_CANCEL', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.VL_DESPESA_ACESSORIA,1,4000), substr(NEW.VL_DESPESA_ACESSORIA,1,4000), NEW.nm_usuario, nr_seq_w, 'VL_DESPESA_ACESSORIA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.IE_URGENTE,1,4000), substr(NEW.IE_URGENTE,1,4000), NEW.nm_usuario, nr_seq_w, 'IE_URGENTE', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_FATURAMENTO,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_FATURAMENTO,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_FATURAMENTO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.VL_DESCONTO,1,4000), substr(NEW.VL_DESCONTO,1,4000), NEW.nm_usuario, nr_seq_w, 'VL_DESCONTO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_ESTAB_TRANSF,1,4000), substr(NEW.CD_ESTAB_TRANSF,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_ESTAB_TRANSF', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_CONVENIO,1,4000), substr(NEW.CD_CONVENIO,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_CONVENIO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.IE_TIPO_ORDEM,1,4000), substr(NEW.IE_TIPO_ORDEM,1,4000), NEW.nm_usuario, nr_seq_w, 'IE_TIPO_ORDEM', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_RESSUP_FORNEC,1,4000), substr(NEW.NR_SEQ_RESSUP_FORNEC,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_RESSUP_FORNEC', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.IE_FORMA_EXPORTAR,1,4000), substr(NEW.IE_FORMA_EXPORTAR,1,4000), NEW.nm_usuario, nr_seq_w, 'IE_FORMA_EXPORTAR', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_CIRURGIA,1,4000), substr(NEW.NR_CIRURGIA,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_CIRURGIA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_ENVIO_EMAIL,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_ENVIO_EMAIL,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_ENVIO_EMAIL', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.IE_LIBERACAO_PORTAL,1,4000), substr(NEW.IE_LIBERACAO_PORTAL,1,4000), NEW.nm_usuario, nr_seq_w, 'IE_LIBERACAO_PORTAL', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_PROCESSO_INTERNO,1,4000), substr(NEW.NR_PROCESSO_INTERNO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_PROCESSO_INTERNO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_TIPO_COMPRA,1,4000), substr(NEW.NR_SEQ_TIPO_COMPRA,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_TIPO_COMPRA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_DOCUMENTO_INTERNO,1,4000), substr(NEW.NR_DOCUMENTO_INTERNO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_DOCUMENTO_INTERNO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_MOD_COMPRA,1,4000), substr(NEW.NR_SEQ_MOD_COMPRA,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_MOD_COMPRA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_REG_LIC_COMPRA,1,4000), substr(NEW.NR_SEQ_REG_LIC_COMPRA,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_REG_LIC_COMPRA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_AGENDA_PAC,1,4000), substr(NEW.NR_SEQ_AGENDA_PAC,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_AGENDA_PAC', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_CONTROLE_EDITAL,1,4000), substr(NEW.NR_CONTROLE_EDITAL,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_CONTROLE_EDITAL', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_NF_REPASSE,1,4000), substr(NEW.NR_SEQ_NF_REPASSE,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_NF_REPASSE', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_LICITACAO,1,4000), substr(NEW.NR_SEQ_LICITACAO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_LICITACAO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_MOTIVO_URGENTE,1,4000), substr(NEW.NR_SEQ_MOTIVO_URGENTE,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_MOTIVO_URGENTE', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.DS_DADOS_IMPORTACAO,1,4000), substr(NEW.DS_DADOS_IMPORTACAO,1,4000), NEW.nm_usuario, nr_seq_w, 'DS_DADOS_IMPORTACAO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_ENVIO_INTEGRACAO_OPME,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_ENVIO_INTEGRACAO_OPME,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_ENVIO_INTEGRACAO_OPME', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_CENTRO_CUSTO,1,4000), substr(NEW.CD_CENTRO_CUSTO,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_CENTRO_CUSTO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.IE_ORIGEM_IMP,1,4000), substr(NEW.IE_ORIGEM_IMP,1,4000), NEW.nm_usuario, nr_seq_w, 'IE_ORIGEM_IMP', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_CONFIRMA_ENTREGA,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_CONFIRMA_ENTREGA,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_CONFIRMA_ENTREGA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NM_USUARIO_CONF_ENTR,1,4000), substr(NEW.NM_USUARIO_CONF_ENTR,1,4000), NEW.nm_usuario, nr_seq_w, 'NM_USUARIO_CONF_ENTR', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_ESTORNO_LIB,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_ESTORNO_LIB,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_ESTORNO_LIB', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_MOTIVO_ESTORNO_LIB,1,4000), substr(NEW.NR_SEQ_MOTIVO_ESTORNO_LIB,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_MOTIVO_ESTORNO_LIB', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NM_USUARIO_ESTORNO_LIB,1,4000), substr(NEW.NM_USUARIO_ESTORNO_LIB,1,4000), NEW.nm_usuario, nr_seq_w, 'NM_USUARIO_ESTORNO_LIB', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_LOCAL_TRANSF,1,4000), substr(NEW.CD_LOCAL_TRANSF,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_LOCAL_TRANSF', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_PROTOCOLO,1,4000), substr(NEW.NR_SEQ_PROTOCOLO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_PROTOCOLO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_ORDEM_ORIG,1,4000), substr(NEW.NR_ORDEM_ORIG,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_ORDEM_ORIG', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_ATUALIZACAO_NREC,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_ATUALIZACAO_NREC,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_ATUALIZACAO_NREC', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NM_USUARIO_NREC,1,4000), substr(NEW.NM_USUARIO_NREC,1,4000), NEW.nm_usuario, nr_seq_w, 'NM_USUARIO_NREC', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NM_USUARIO_LIB,1,4000), substr(NEW.NM_USUARIO_LIB,1,4000), NEW.nm_usuario, nr_seq_w, 'NM_USUARIO_LIB', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.VL_DESPESA_DOC,1,4000), substr(NEW.VL_DESPESA_DOC,1,4000), NEW.nm_usuario, nr_seq_w, 'VL_DESPESA_DOC', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_MOTIVO_BAIXA,1,4000), substr(NEW.NR_SEQ_MOTIVO_BAIXA,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_MOTIVO_BAIXA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_LIC,1,4000), substr(NEW.NR_SEQ_LIC,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_LIC', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_VIA_FATURA,1,4000), substr(NEW.NR_SEQ_VIA_FATURA,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_VIA_FATURA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_DECLARACAO_IMP,1,4000), substr(NEW.NR_DECLARACAO_IMP,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_DECLARACAO_IMP', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.IE_NECESSITA_ENVIAR_INT,1,4000), substr(NEW.IE_NECESSITA_ENVIAR_INT,1,4000), NEW.nm_usuario, nr_seq_w, 'IE_NECESSITA_ENVIAR_INT', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NM_USUARIO_ALTERA_INT,1,4000), substr(NEW.NM_USUARIO_ALTERA_INT,1,4000), NEW.nm_usuario, nr_seq_w, 'NM_USUARIO_ALTERA_INT', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.IE_SISTEMA_ORIGEM,1,4000), substr(NEW.IE_SISTEMA_ORIGEM,1,4000), NEW.nm_usuario, nr_seq_w, 'IE_SISTEMA_ORIGEM', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.DS_OBS_INTERNA,1,4000), substr(NEW.DS_OBS_INTERNA,1,4000), NEW.nm_usuario, nr_seq_w, 'DS_OBS_INTERNA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SOLIC_COMPRA_GERADA,1,4000), substr(NEW.NR_SOLIC_COMPRA_GERADA,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SOLIC_COMPRA_GERADA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_CONTRATO,1,4000), substr(NEW.NR_SEQ_CONTRATO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_CONTRATO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_ATEND_OPME,1,4000), substr(NEW.NR_SEQ_ATEND_OPME,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_ATEND_OPME', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_MOTIVO_SOLIC,1,4000), substr(NEW.NR_SEQ_MOTIVO_SOLIC,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_MOTIVO_SOLIC', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.VL_SEGURO,1,4000), substr(NEW.VL_SEGURO,1,4000), NEW.nm_usuario, nr_seq_w, 'VL_SEGURO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.DS_EMAIL_REGRA_PJ,1,4000), substr(NEW.DS_EMAIL_REGRA_PJ,1,4000), NEW.nm_usuario, nr_seq_w, 'DS_EMAIL_REGRA_PJ', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.DS_CONTATO_REGRA_PJ,1,4000), substr(NEW.DS_CONTATO_REGRA_PJ,1,4000), NEW.nm_usuario, nr_seq_w, 'DS_CONTATO_REGRA_PJ', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_PERFIL,1,4000), substr(NEW.CD_PERFIL,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_PERFIL', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.IE_ORCADO,1,4000), substr(NEW.IE_ORCADO,1,4000), NEW.nm_usuario, nr_seq_w, 'IE_ORCADO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_VALIDADE,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_VALIDADE,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_VALIDADE', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NM_USUARIO_APROV,1,4000), substr(NEW.NM_USUARIO_APROV,1,4000), NEW.nm_usuario, nr_seq_w, 'NM_USUARIO_APROV', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_TITULO_RECEBER,1,4000), substr(NEW.NR_TITULO_RECEBER,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_TITULO_RECEBER', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_AUTOR_CIR,1,4000), substr(NEW.NR_SEQ_AUTOR_CIR,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_AUTOR_CIR', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.VL_CONV_MOEDA,1,4000), substr(NEW.VL_CONV_MOEDA,1,4000), NEW.nm_usuario, nr_seq_w, 'VL_CONV_MOEDA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_CNPJ_SEGURADORA,1,4000), substr(NEW.CD_CNPJ_SEGURADORA,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_CNPJ_SEGURADORA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_GUIA_PLANO,1,4000), substr(NEW.NR_SEQ_GUIA_PLANO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_GUIA_PLANO', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_SETOR_ENTREGA,1,4000), substr(NEW.CD_SETOR_ENTREGA,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_SETOR_ENTREGA', ie_log_w, ds_w, 'ORDEM_COMPRA', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w;   exception when others then ds_w:= '1'; end;   END;
RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_ordem_compra_tp() FROM PUBLIC;

CREATE TRIGGER ordem_compra_tp
	AFTER UPDATE ON ordem_compra FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_ordem_compra_tp();

