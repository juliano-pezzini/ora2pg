-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS titulo_pagar_ptu_fatura ON titulo_pagar CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_titulo_pagar_ptu_fatura() RETURNS trigger AS $BODY$
declare
 
ds_aplicacao_w		varchar(255);
nr_seq_ptu_fatura_w	ptu_fatura.nr_sequencia%type;
 
BEGIN 
if (NEW.ie_origem_titulo = '16') then 
	if (pls_se_aplicacao_tasy = 'S') then 
		ds_aplicacao_w 		:= 'Aplicacao TASY ;';
	else 
		ds_aplicacao_w 		:= 'Banco ;';
	end if;
 
	insert into tasy_log_alteracao(nr_sequencia, 
		nm_tabela, 
		ds_chave_simples, 
		ds_chave_composta, 
		dt_atualizacao, 
		nm_usuario, 
		ds_descricao, 
		nr_seq_justificativa, 
		ds_justificativa) 
	values (	nextval('tasy_log_alteracao_seq'), 
		'TITULO_PAGAR', 
		NEW.nr_titulo, 
		null, 
		LOCALTIMESTAMP, 
		NEW.nm_usuario, 
		substr(	'NR_TITULO='||NEW.nr_titulo||',IE_STATUS_OLD='||OLD.ie_status||', IE_STATUS_NEW='||NEW.ie_status|| 
			', MÃ¡quina='||wheb_usuario_pck.get_machine||' - '||ds_aplicacao_w,1,255), 
		null, 
		null);
end if;
 
RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_titulo_pagar_ptu_fatura() FROM PUBLIC;

CREATE TRIGGER titulo_pagar_ptu_fatura
	BEFORE UPDATE ON titulo_pagar FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_titulo_pagar_ptu_fatura();

