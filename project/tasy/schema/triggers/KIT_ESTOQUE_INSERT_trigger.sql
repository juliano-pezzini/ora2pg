-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS kit_estoque_insert ON kit_estoque CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_kit_estoque_insert() RETURNS trigger AS $BODY$
declare
	ds_stack_w					varchar(2000);
BEGIN
  BEGIN	
	BEGIN

	ds_stack_w := substr('nm_usuario= ' || NEW.nm_usuario || ' dt_atualizacao= ' || NEW.dt_atualizacao || ' nr_sequencia= ' || NEW.nr_sequencia ||
	' nr_seq_reg_kit= ' || NEW.nr_seq_reg_kit ||' nr_seq_kit_origem= ' || NEW.nr_seq_kit_origem || ' stack=' || dbms_utility.format_call_stack,1,2000);

		if (NEW.nr_seq_reg_kit is not null)then
			CALL sup_gravar_historico_reg_kit(NEW.nm_usuario, NEW.nr_seq_reg_kit, 'P', 'I' , ds_stack_w);
        else
		
            CALL gravar_kit_estoque_hist(NEW.nr_sequencia, wheb_mensagem_pck.get_texto(100328542), ds_stack_w, 'S', NEW.nm_usuario);
            commit;
        end if;	
		
		exception
			when	others then
				null;
	end;
  END;
RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_kit_estoque_insert() FROM PUBLIC;

CREATE TRIGGER kit_estoque_insert
	AFTER INSERT ON kit_estoque FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_kit_estoque_insert();

