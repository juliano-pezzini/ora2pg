-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS escala_gmfm_atual ON escala_gmfm CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_escala_gmfm_atual() RETURNS trigger AS $BODY$
declare
qt_dimensao_a_w  	bigint := 0;
qt_dimensao_b_w  	bigint := 0;
qt_dimensao_c_w  	bigint := 0;
qt_dimensao_d_w  	bigint := 0;
qt_dimensao_e_w  	bigint := 0;
pr_dimensao_a_w		double precision := 0;
pr_dimensao_b_w		double precision := 0;
pr_dimensao_c_w		double precision := 0;
pr_dimensao_d_w		double precision := 0;
pr_dimensao_e_w		double precision := 0;
pr_total_w			double precision := 0;
pr_total_meta_w		double precision := 0;
qt_calculo_w		smallint    := 0;
qt_reg_w	     	smallint;
sql_w            	varchar(500);
BEGIN
  BEGIN

if (wheb_usuario_pck.get_ie_executar_trigger	= 'N') then
	goto Final;
end if;


--- Inicio MD 1

      BEGIN
        sql_w := 'CALL OBTER_SCORE_GMFM_DIM_A_MD(:1, :2, :3, :4, :5, :6, :7, :8, :9, :10, :11, :12, :13, :14, :15, :16, :17) INTO :qt_dimensao_a_w';
        EXECUTE sql_w
            USING IN NEW.ie_item_1, IN NEW.ie_item_2, IN NEW.ie_item_3, IN NEW.ie_item_4, IN NEW.ie_item_5, IN NEW.ie_item_6,
            IN NEW.ie_item_7, IN NEW.ie_item_8, IN NEW.ie_item_9, IN NEW.ie_item_10, IN NEW.ie_item_11, IN NEW.ie_item_12,
			IN NEW.ie_item_13, IN NEW.ie_item_14, IN NEW.ie_item_15, IN NEW.ie_item_16, IN NEW.ie_item_17, OUT qt_dimensao_a_w;

    EXCEPTION
        WHEN OTHERS THEN
            qt_dimensao_a_w := NULL;
    END;

    NEW.qt_dimensao_a := qt_dimensao_a_w;

--- Fim MD 1


--- Inicio MD 2

      BEGIN
           sql_w := 'CALL OBTER_SCORE_GMFM_DIM_B_MD(:1, :2, :3, :4, :5, :6, :7, :8, :9, :10, 
                                                 :11, :12, :13, :14, :15, :16, :17, :18,
                                                 :19, :20) INTO :qt_dimensao_b_w';
            EXECUTE sql_w
            USING IN NEW.ie_item_18, IN NEW.ie_item_19, IN NEW.ie_item_20, IN NEW.ie_item_21, IN NEW.ie_item_22, IN NEW.ie_item_23,
            IN NEW.ie_item_24, IN NEW.ie_item_25, IN NEW.ie_item_26, IN NEW.ie_item_27, IN NEW.ie_item_28, IN NEW.ie_item_29,
            IN NEW.ie_item_30, IN NEW.ie_item_31, IN NEW.ie_item_32, IN NEW.ie_item_33, IN NEW.ie_item_34, IN NEW.ie_item_35,
            IN NEW.ie_item_36, IN NEW.ie_item_37, OUT qt_dimensao_b_w;
    EXCEPTION
        WHEN OTHERS THEN
            qt_dimensao_b_w := NULL;
    END;

    NEW.qt_dimensao_b := qt_dimensao_b_w;

--- Fim MD 2


--- Inicio MD 3

    BEGIN
        sql_w := 'CALL OBTER_SCORE_GMFM_DIM_C_MD(:1, :2, :3, :4, :5, :6, :7, :8, :9, :10, :11, :12, :13, :14) INTO :qt_dimensao_c_w';

        EXECUTE sql_w
            USING IN NEW.ie_item_38, IN NEW.ie_item_39, IN NEW.ie_item_40, IN NEW.ie_item_41, IN NEW.ie_item_42, IN NEW.ie_item_43,
            IN NEW.ie_item_44, IN NEW.ie_item_45, IN NEW.ie_item_46, IN NEW.ie_item_47, IN NEW.ie_item_48, IN NEW.ie_item_49,
            IN NEW.ie_item_50, IN NEW.ie_item_51, OUT qt_dimensao_c_w;
    EXCEPTION
        WHEN OTHERS THEN
            qt_dimensao_c_w := NULL;
    END;

    NEW.qt_dimensao_c := qt_dimensao_c_w;

--- Fim MD 3


--- Inicio MD 4

      BEGIN
      sql_w := 'CALL OBTER_SCORE_GMFM_DIM_D_MD(:1, :2, :3, :4, :5, :6, :7, :8, :9, :10, :11, :12, :13) INTO :qt_dimensao_d_w';

        EXECUTE sql_w
            USING IN NEW.ie_item_52, IN NEW.ie_item_53, IN NEW.ie_item_54, IN NEW.ie_item_55, IN NEW.ie_item_56, IN NEW.ie_item_57,
            IN NEW.ie_item_58, IN NEW.ie_item_59, IN NEW.ie_item_60, IN NEW.ie_item_61, IN NEW.ie_item_62, IN NEW.ie_item_63,
            IN NEW.ie_item_64, OUT qt_dimensao_d_w;
    EXCEPTION
        WHEN OTHERS THEN
            qt_dimensao_d_w := NULL;
    END;

    NEW.qt_dimensao_d := qt_dimensao_d_w;

--- Fim MD 4


--- Inicio MD 5

     BEGIN
       sql_w := 'CALL OBTER_SCORE_GMFM_DIM_E_MD(:1, :2, :3, :4, :5, :6, :7, :8, :9, :10, :11, :12, :13, :14, :15, :16, :17,
                                                 :18, :19, :20, :21, :22, :23, :24 ) INTO :qt_dimensao_e_w';

        EXECUTE sql_w
            USING IN NEW.ie_item_65, IN NEW.ie_item_66, IN NEW.ie_item_67, IN NEW.ie_item_68, IN NEW.ie_item_69, IN NEW.ie_item_70,
            IN NEW.ie_item_71, IN NEW.ie_item_72, IN NEW.ie_item_73, IN NEW.ie_item_74, IN NEW.ie_item_75, IN NEW.ie_item_76,
            IN NEW.ie_item_77, IN NEW.ie_item_78, IN NEW.ie_item_79, IN NEW.ie_item_80, IN NEW.ie_item_81, IN NEW.ie_item_82,
            IN NEW.ie_item_83, IN NEW.ie_item_84, IN NEW.ie_item_85, IN NEW.ie_item_86, IN NEW.ie_item_87, IN NEW.ie_item_88,
            OUT qt_dimensao_e_w;
    EXCEPTION
        WHEN OTHERS THEN
            qt_dimensao_e_w := NULL;
    END;

    NEW.qt_dimensao_e := qt_dimensao_e_w;


--- Fim MD 5


--- Inicio MD 6

    BEGIN
     sql_w := 'begin OBTER_CALCULO_PERC_GMFM_MD(:1, :2, :3, :4, :5, :6, :7, :8, :9, :10); end;';

        EXECUTE sql_w
            USING IN qt_dimensao_a_w, IN qt_dimensao_b_w, IN qt_dimensao_c_w, IN qt_dimensao_d_w, IN qt_dimensao_e_w, OUT pr_dimensao_a_w,
            OUT pr_dimensao_b_w, OUT pr_dimensao_c_w, OUT pr_dimensao_d_w, OUT pr_dimensao_e_w;
    EXCEPTION
        WHEN OTHERS THEN
            pr_dimensao_a_w := NULL;
            pr_dimensao_b_w := NULL;
            pr_dimensao_c_w := NULL;
            pr_dimensao_d_w := NULL;
            pr_dimensao_e_w := NULL;
    END;
	
	NEW.pr_dimensao_a := pr_dimensao_a_w;
	NEW.pr_dimensao_b := pr_dimensao_b_w;
	NEW.pr_dimensao_c := pr_dimensao_c_w;
	NEW.pr_dimensao_d := pr_dimensao_d_w;
	NEW.pr_dimensao_e := pr_dimensao_e_w;
--- Fim MD 6


--- Inicio MD 7

   BEGIN
    sql_w := 'begin OBTER_PERC_TOTAL_GMFM_MD(:1, :2, :3, :4, :5, :6, :7, :8, :9, :10, :11, :12); end;';

        EXECUTE sql_w
            USING IN NEW.ie_meta_a, IN NEW.ie_meta_b, IN NEW.ie_meta_c, IN NEW.ie_meta_d, IN NEW.ie_meta_e, IN NEW.pr_dimensao_a,
            IN NEW.pr_dimensao_b, IN NEW.pr_dimensao_c, IN NEW.pr_dimensao_d, IN NEW.pr_dimensao_e, OUT pr_total_meta_w, OUT pr_total_w;
    EXCEPTION
        WHEN OTHERS THEN
            pr_total_w := NULL;
            pr_total_meta_w := NULL;
    END;
	NEW.pr_total := pr_total_w;
    NEW.pr_total_meta := pr_total_meta_w;

--- Fim MD 

<<Final>>
qt_reg_w	:= 0;
  END;
RETURN NEW;
END;
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_escala_gmfm_atual() FROM PUBLIC;

CREATE TRIGGER escala_gmfm_atual
	BEFORE INSERT OR UPDATE ON escala_gmfm FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_escala_gmfm_atual();

