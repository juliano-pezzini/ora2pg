-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS dankia_local_estoque_insert ON local_estoque CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_dankia_local_estoque_insert() RETURNS trigger AS $BODY$
BEGIN
if (TG_OP = 'INSERT') then
	CALL gerar_int_dankia_pck.dankia_local_estoque(NEW.cd_local_estoque,NEW.ie_tipo_local,NEW.ds_local_estoque,'I',NEW.nm_usuario);
elsif (TG_OP = 'UPDATE') then
	if (OLD.ie_tipo_local = '11') or (NEW.ie_tipo_local = '11') then
		if (coalesce(NEW.ie_tipo_local,'X') <> 'X') and (coalesce(OLD.ie_tipo_local,'X') <> coalesce(NEW.ie_tipo_local,'X')) then
			if (NEW.ie_tipo_local = '11') then
				CALL gerar_int_dankia_pck.dankia_local_estoque(OLD.cd_local_estoque,NEW.ie_tipo_local, coalesce(NEW.ds_local_estoque,OLD.ds_local_estoque),'I',NEW.nm_usuario);
			else
				CALL gerar_int_dankia_pck.dankia_local_estoque(OLD.cd_local_estoque,OLD.ie_tipo_local, OLD.ds_local_estoque,'E', NEW.nm_usuario);
			end if;
		elsif (coalesce(NEW.ie_tipo_local,'X') = 'X') and (coalesce(OLD.ie_tipo_local,'X') = '11') then
				CALL gerar_int_dankia_pck.dankia_local_estoque(OLD.cd_local_estoque,OLD.ie_tipo_local, OLD.ds_local_estoque,'E', NEW.nm_usuario);

		elsif (coalesce(NEW.ds_local_estoque,'X') <> 'X') and (coalesce(OLD.ds_local_estoque,'X') <> coalesce(NEW.ds_local_estoque,'X')) then
			CALL gerar_int_dankia_pck.dankia_local_estoque(OLD.cd_local_estoque,NEW.ie_tipo_local, NEW.ds_local_estoque,'A',NEW.nm_usuario);
		end if;
	end if;
end if;

RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_dankia_local_estoque_insert() FROM PUBLIC;

CREATE TRIGGER dankia_local_estoque_insert
	AFTER INSERT OR UPDATE ON local_estoque FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_dankia_local_estoque_insert();

