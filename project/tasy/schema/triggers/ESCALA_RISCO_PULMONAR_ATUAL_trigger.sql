-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS escala_risco_pulmonar_atual ON escala_risco_pulmonar CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_escala_risco_pulmonar_atual() RETURNS trigger AS $BODY$
DECLARE
    qt_reg_w                     smallint;
    qt_aneurisma_w               smallint;
    qt_toracica_w                smallint;
    qt_abnominal_w               smallint;
    qt_cabeca_w                  smallint;
    qt_neurocirurgia_w           smallint;
    qt_vascular_w                smallint;
    qt_anestesia_w               smallint;
    qt_emergencia_w              smallint;
    qt_transfusao_w              smallint;
    qt_idade_w                   smallint;
    qt_status_funcional_w        smallint;
    qt_diminuicao_peso_w         smallint;
    qt_dpoc_w                    smallint;
    qt_vascular_cerebral_w       smallint;
    qt_diminuicao_consciencia_w  smallint;
    qt_pontos_ureia_w            smallint;
    qt_corticoide_cronico_w      smallint;
    qt_tabagismo_w               smallint;
    qt_alcool_w                  smallint;
    qt_pontuacao_w               integer;
    sql_w                        varchar(200);
    ds_erro_w                    varchar(4000);
    ds_parametros_w              varchar(4000);
BEGIN
  BEGIN
    IF ( NEW.nr_hora IS NULL ) OR ( NEW.dt_avaliacao <> OLD.dt_avaliacao ) THEN
        BEGIN
            NEW.nr_hora := (to_char(round(NEW.dt_avaliacao, 'hh24'), 'hh24'))::numeric;

        END;
    END IF;

    IF ( wheb_usuario_pck.get_ie_executar_trigger = 'N' ) THEN
        GOTO final;
    END IF;
    BEGIN
        sql_w := 'CALL CALCULA_CIRURGIA_ANEURISMA_MD(:1) INTO :qt_aneurisma_w';
        EXECUTE sql_w
            USING IN NEW.ie_aneurisma, OUT qt_aneurisma_w;
    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := (':new.nr_atendimento: '||NEW.nr_atendimento||'-'||':new.cd_profissional: '||NEW.cd_profissional||'-'||':new.ie_situacao: '||NEW.ie_situacao||'-'||
                          ':new.ie_aneurisma: '||NEW.ie_aneurisma||'-'||'qt_aneurisma_w: '||qt_aneurisma_w);
      CALL gravar_log_medical_device('escala_risco_pulmonar_atual','CALCULA_CIRURGIA_ANEURISMA_MD'
                                 ,ds_parametros_w,substr(ds_erro_w, 4000),NEW.nm_usuario,'N');
        
            qt_aneurisma_w := NULL;
    END;

    NEW.qt_aneurisma := qt_aneurisma_w;
    sql_w := NULL;
    BEGIN
        sql_w := 'CALL CALCULA_CIRURGIA_TORACICA_MD(:1) INTO :qt_toracica_w';
        EXECUTE sql_w
            USING IN NEW.ie_toracica, OUT qt_toracica_w;
    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := (':new.nr_atendimento: '||NEW.nr_atendimento||'-'||':new.cd_profissional: '||NEW.cd_profissional||'-'||':new.ie_situacao: '||NEW.ie_situacao||'-'||
                          ':new.ie_toracica: '||NEW.ie_toracica||'-'||'qt_aneurisma_w: '||qt_aneurisma_w);
      CALL gravar_log_medical_device('escala_risco_pulmonar_atual','CALCULA_CIRURGIA_TORACICA_MD'
                                 ,ds_parametros_w,substr(ds_erro_w, 4000),NEW.nm_usuario,'N');
        
            qt_toracica_w := NULL;
    END;

    NEW.qt_toracica := qt_toracica_w;
    sql_w := NULL;
    BEGIN
        sql_w := 'CALL CALCULA_CIRURGIA_ABDOMINAL_MD(:1) INTO :qt_abnominal_w';
        EXECUTE sql_w
            USING IN NEW.ie_abnominal_alta, OUT qt_abnominal_w;
    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := (':new.nr_atendimento: '||NEW.nr_atendimento||'-'||':new.cd_profissional: '||NEW.cd_profissional||'-'||':new.ie_situacao: '||NEW.ie_situacao||'-'||
                          ':new.ie_abnominal_alta: '||NEW.ie_abnominal_alta||'-'||'qt_abnominal_w: '||qt_abnominal_w);
      CALL gravar_log_medical_device('escala_risco_pulmonar_atual','CALCULA_CIRURGIA_ABDOMINAL_MD'
                                 ,ds_parametros_w,substr(ds_erro_w, 4000),NEW.nm_usuario,'N');
        
            qt_abnominal_w := NULL;
    END;

    NEW.qt_abnominal_alta := qt_abnominal_w;
    sql_w := NULL;
    BEGIN
        sql_w := 'CALL CALCULA_CIRU_CABECA_PESCOCO_MD(:1) INTO :qt_cabeca_w';
        EXECUTE sql_w
            USING IN NEW.ie_cabeca_pescoco, OUT qt_cabeca_w;
    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := (':new.nr_atendimento: '||NEW.nr_atendimento||'-'||':new.cd_profissional: '||NEW.cd_profissional||'-'||':new.ie_situacao: '||NEW.ie_situacao||'-'||
                          ':new.ie_cabeca_pescoco: '||NEW.ie_cabeca_pescoco||'-'||'qt_cabeca_w: '||qt_cabeca_w);
      CALL gravar_log_medical_device('escala_risco_pulmonar_atual','CALCULA_CIRU_CABECA_PESCOCO_MD'
                                 ,ds_parametros_w,substr(ds_erro_w, 4000),NEW.nm_usuario,'N');

            qt_cabeca_w := NULL;
    END;

    NEW.qt_cabeca_pescoco := qt_cabeca_w;
    sql_w := NULL;
    BEGIN
        sql_w := 'CALL CALCULA_NEUROCIRURGIA_MD(:1) INTO :qt_neurocirurgia_w';
        EXECUTE sql_w
            USING IN NEW.ie_neurocirurgia, OUT qt_neurocirurgia_w;
    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := (':new.nr_atendimento: '||NEW.nr_atendimento||'-'||':new.cd_profissional: '||NEW.cd_profissional||'-'||':new.ie_situacao: '||NEW.ie_situacao||'-'||
                          ':new.ie_neurocirurgia: '||NEW.ie_neurocirurgia||'-'||'qt_neurocirurgia_w: '||qt_neurocirurgia_w);
      CALL gravar_log_medical_device('escala_risco_pulmonar_atual','CALCULA_NEUROCIRURGIA_MD'
                                 ,ds_parametros_w,substr(ds_erro_w, 4000),NEW.nm_usuario,'N');

            qt_neurocirurgia_w := NULL;
    END;

    NEW.qt_neurocirurgia := qt_neurocirurgia_w;
    sql_w := NULL;
    BEGIN
        sql_w := 'CALL CALCULA_CIRU_VASC_ARTERIAL_MD(:1) INTO :qt_vascular_w';
        EXECUTE sql_w
            USING IN NEW.ie_vascular_arterial, OUT qt_vascular_w;
    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := (':new.nr_atendimento: '||NEW.nr_atendimento||'-'||':new.cd_profissional: '||NEW.cd_profissional||'-'||':new.ie_situacao: '||NEW.ie_situacao||'-'||
                          ':new.ie_vascular_arterial: '||NEW.ie_vascular_arterial||'-'||'qt_vascular_w: '||qt_vascular_w);
      CALL gravar_log_medical_device('escala_risco_pulmonar_atual','CALCULA_CIRU_VASC_ARTERIAL_MD'
                                 ,ds_parametros_w,substr(ds_erro_w, 4000),NEW.nm_usuario,'N');

            qt_vascular_w := NULL;
    END;

    NEW.qt_vascular_arterial := qt_vascular_w;
    sql_w := NULL;
    BEGIN
        sql_w := 'CALL CALCULA_ANESTESIA_GERAL_MD(:1) INTO :qt_anestesia_w';
        EXECUTE sql_w
            USING IN NEW.ie_anestesia_geral, OUT qt_anestesia_w;
    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := (':new.nr_atendimento: '||NEW.nr_atendimento||'-'||':new.cd_profissional: '||NEW.cd_profissional||'-'||':new.ie_situacao: '||NEW.ie_situacao||'-'||
                          ':new.ie_anestesia_geral: '||NEW.ie_anestesia_geral||'-'||'qt_anestesia_w: '||qt_anestesia_w);
      CALL gravar_log_medical_device('escala_risco_pulmonar_atual','CALCULA_ANESTESIA_GERAL_MD'
                                 ,ds_parametros_w,substr(ds_erro_w, 4000),NEW.nm_usuario,'N');

            qt_anestesia_w := NULL;
    END;

    NEW.qt_anestesia_geral := qt_anestesia_w;
    sql_w := NULL;
    BEGIN
        sql_w := 'CALL CALCULA_CIRURGIA_EMERGENCIA_MD(:1) INTO :qt_emergencia_w';
        EXECUTE sql_w
            USING IN NEW.ie_emergencia, OUT qt_emergencia_w;
    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := (':new.nr_atendimento: '||NEW.nr_atendimento||'-'||':new.cd_profissional: '||NEW.cd_profissional||'-'||':new.ie_situacao: '||NEW.ie_situacao||'-'||
                          ':new.ie_emergencia: '||NEW.ie_emergencia||'-'||'qt_emergencia_w: '||qt_emergencia_w);
      CALL gravar_log_medical_device('escala_risco_pulmonar_atual','CALCULA_CIRURGIA_EMERGENCIA_MD'
                                 ,ds_parametros_w,substr(ds_erro_w, 4000),NEW.nm_usuario,'N');

            qt_emergencia_w := NULL;
    END;

    NEW.qt_emergencia := qt_emergencia_w;
    sql_w := NULL;
    BEGIN
        sql_w := 'CALL CALCULA_TRANSFUSAO_SANGUE_MD(:1) INTO :qt_transfusao_w';
        EXECUTE sql_w
            USING IN NEW.ie_transfusao, OUT qt_transfusao_w;
    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := (':new.nr_atendimento: '||NEW.nr_atendimento||'-'||':new.cd_profissional: '||NEW.cd_profissional||'-'||':new.ie_situacao: '||NEW.ie_situacao||'-'||
                          ':new.ie_transfusao: '||NEW.ie_transfusao||'-'||'qt_transfusao_w: '||qt_transfusao_w);
      CALL gravar_log_medical_device('escala_risco_pulmonar_atual','CALCULA_TRANSFUSAO_SANGUE_MD'
                                 ,ds_parametros_w,substr(ds_erro_w, 4000),NEW.nm_usuario,'N');

            qt_transfusao_w := NULL;
    END;

    NEW.qt_transfusao := qt_transfusao_w;
    sql_w := NULL;
    BEGIN
        sql_w := 'CALL CALCULA_IDADE_MD(:1) INTO :qt_idade_w';
        EXECUTE sql_w
            USING IN NEW.qt_idade, OUT qt_idade_w;
    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := (':new.nr_atendimento: '||NEW.nr_atendimento||'-'||':new.cd_profissional: '||NEW.cd_profissional||'-'||':new.ie_situacao: '||NEW.ie_situacao||'-'||
                          ':new.qt_idade: '||NEW.qt_idade||'-'||'qt_idade_w: '||qt_idade_w);
      CALL gravar_log_medical_device('escala_risco_pulmonar_atual','CALCULA_IDADE_MD'
                                 ,ds_parametros_w,substr(ds_erro_w, 4000),NEW.nm_usuario,'N');

            qt_idade_w := NULL;
    END;

    NEW.qt_pontos_idade := qt_idade_w;
    sql_w := NULL;
    BEGIN
        sql_w := 'CALL CALCULA_ESTADO_FUNCIONAL_MD(:1) INTO :qt_status_funcional_w';
        EXECUTE sql_w
            USING IN NEW.ie_status_funcional, OUT qt_status_funcional_w;
    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := (':new.nr_atendimento: '||NEW.nr_atendimento||'-'||':new.cd_profissional: '||NEW.cd_profissional||'-'||':new.ie_situacao: '||NEW.ie_situacao||'-'||
                          ':new.ie_status_funcional: '||NEW.ie_status_funcional||'-'||'qt_status_funcional_w: '||qt_status_funcional_w);
      CALL gravar_log_medical_device('escala_risco_pulmonar_atual','CALCULA_ESTADO_FUNCIONAL_MD'
                                 ,ds_parametros_w,substr(ds_erro_w, 4000),NEW.nm_usuario,'N');

            qt_status_funcional_w := NULL;
    END;

    sql_w := NULL;
    BEGIN
        sql_w := 'CALL CALCULA_DIMINUICAO_PESO_MD(:1) INTO :qt_diminuicao_peso_w';
        EXECUTE sql_w
            USING IN NEW.ie_diminuicao_peso, OUT qt_diminuicao_peso_w;
    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := (':new.nr_atendimento: '||NEW.nr_atendimento||'-'||':new.cd_profissional: '||NEW.cd_profissional||'-'||':new.ie_situacao: '||NEW.ie_situacao||'-'||
                          ':new.ie_diminuicao_peso: '||NEW.ie_diminuicao_peso||'-'||'qt_diminuicao_peso_w: '||qt_diminuicao_peso_w);
      CALL gravar_log_medical_device('escala_risco_pulmonar_atual','CALCULA_DIMINUICAO_PESO_MD'
                                 ,ds_parametros_w,substr(ds_erro_w, 4000),NEW.nm_usuario,'N');

            qt_diminuicao_peso_w := NULL;
    END;

    NEW.qt_diminuicao_peso := qt_diminuicao_peso_w;
    sql_w := NULL;
    BEGIN
        sql_w := 'CALL CALCULA_HISTORIA_DPOC_MD(:1) INTO :qt_dpoc_w';
        EXECUTE sql_w
            USING IN NEW.ie_dpoc, OUT qt_dpoc_w;
    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := (':new.nr_atendimento: '||NEW.nr_atendimento||'-'||':new.cd_profissional: '||NEW.cd_profissional||'-'||':new.ie_situacao: '||NEW.ie_situacao||'-'||
                          ':new.ie_dpoc: '||NEW.ie_dpoc||'-'||'qt_dpoc_w: '||qt_dpoc_w);
      CALL gravar_log_medical_device('escala_risco_pulmonar_atual','CALCULA_HISTORIA_DPOC_MD'
                                 ,ds_parametros_w,substr(ds_erro_w, 4000),NEW.nm_usuario,'N');

            qt_dpoc_w := NULL;
    END;

    NEW.qt_dpoc := qt_dpoc_w;
    sql_w := NULL;
    BEGIN
        sql_w := 'CALL CALCULA_VASCULAR_CEREBRAL_MD(:1) INTO :qt_vascular_cerebral_w';
        EXECUTE sql_w
            USING IN NEW.ie_acidente_vascular_cerebral, OUT qt_vascular_cerebral_w;
    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := (':new.nr_atendimento: '||NEW.nr_atendimento||'-'||':new.cd_profissional: '||NEW.cd_profissional||'-'||':new.ie_situacao: '||NEW.ie_situacao||'-'||
                          ':new.ie_acidente_vascular_cerebral: '||NEW.ie_acidente_vascular_cerebral||'-'||'qt_vascular_cerebral_w: '||qt_vascular_cerebral_w);
      CALL gravar_log_medical_device('escala_risco_pulmonar_atual','CALCULA_VASCULAR_CEREBRAL_MD'
                                 ,ds_parametros_w,substr(ds_erro_w, 4000),NEW.nm_usuario,'N');

            qt_vascular_cerebral_w := NULL;
    END;

    NEW.qt_acidente_vascular_cerebral := qt_vascular_cerebral_w;
    sql_w := NULL;
    BEGIN
        sql_w := 'CALL CALCULA_DIMIN_CONSCIENCIA_MD(:1) INTO :qt_diminuicao_consciencia_w';
        EXECUTE sql_w
            USING IN NEW.ie_diminuicao_consciencia, OUT qt_diminuicao_consciencia_w;
    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := (':new.nr_atendimento: '||NEW.nr_atendimento||'-'||':new.cd_profissional: '||NEW.cd_profissional||'-'||':new.ie_situacao: '||NEW.ie_situacao||'-'||
                          ':new.ie_diminuicao_consciencia: '||NEW.ie_diminuicao_consciencia||'-'||'qt_diminuicao_consciencia_w: '||qt_diminuicao_consciencia_w);
      CALL gravar_log_medical_device('escala_risco_pulmonar_atual','CALCULA_DIMIN_CONSCIENCIA_MD'
                                 ,ds_parametros_w,substr(ds_erro_w, 4000),NEW.nm_usuario,'N');

            qt_diminuicao_consciencia_w := NULL;
    END;

    NEW.qt_diminuicao_consciencia := qt_diminuicao_consciencia_w;
    sql_w := NULL;
    BEGIN
        sql_w := 'CALL CALCULA_UREIA_MD(:1) INTO :qt_pontos_ureia_w';
        EXECUTE sql_w
            USING IN NEW.qt_ureia, OUT qt_pontos_ureia_w;
    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := (':new.nr_atendimento: '||NEW.nr_atendimento||'-'||':new.cd_profissional: '||NEW.cd_profissional||'-'||':new.ie_situacao: '||NEW.ie_situacao||'-'||
                          ':new.qt_ureia: '||NEW.qt_ureia||'-'||'qt_pontos_ureia_w: '||qt_pontos_ureia_w);
      CALL gravar_log_medical_device('escala_risco_pulmonar_atual','CALCULA_UREIA_MD'
                                 ,ds_parametros_w,substr(ds_erro_w, 4000),NEW.nm_usuario,'N');

            qt_pontos_ureia_w := NULL;
    END;

    NEW.qt_pontos_ureia := qt_pontos_ureia_w;
    sql_w := NULL;
    BEGIN
        sql_w := 'CALL CALCULA_USO_CORTICOIDE_MD(:1) INTO :qt_corticoide_cronico_w';
        EXECUTE sql_w
            USING IN NEW.ie_corticoide_cronico, OUT qt_corticoide_cronico_w;
    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := (':new.nr_atendimento: '||NEW.nr_atendimento||'-'||':new.cd_profissional: '||NEW.cd_profissional||'-'||':new.ie_situacao: '||NEW.ie_situacao||'-'||
                          ':new.ie_corticoide_cronico: '||NEW.ie_corticoide_cronico||'-'||'qt_corticoide_cronico_w: '||qt_corticoide_cronico_w);
      CALL gravar_log_medical_device('escala_risco_pulmonar_atual','CALCULA_USO_CORTICOIDE_MD'
                                 ,ds_parametros_w,substr(ds_erro_w, 4000),NEW.nm_usuario,'N');

            qt_corticoide_cronico_w := NULL;
    END;

    NEW.qt_corticoide_cronico := qt_corticoide_cronico_w;
    sql_w := NULL;
    BEGIN
        sql_w := 'CALL CALCULA_TABAGISMO_MD(:1) INTO :qt_tabagismo_w';
        EXECUTE sql_w
            USING IN NEW.ie_tabagismo, OUT qt_tabagismo_w;
    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := (':new.nr_atendimento: '||NEW.nr_atendimento||'-'||':new.cd_profissional: '||NEW.cd_profissional||'-'||':new.ie_situacao: '||NEW.ie_situacao||'-'||
                          ':new.ie_tabagismo: '||NEW.ie_tabagismo||'-'||'qt_tabagismo_w: '||qt_tabagismo_w);
      CALL gravar_log_medical_device('escala_risco_pulmonar_atual','CALCULA_TABAGISMO_MD'
                                 ,ds_parametros_w,substr(ds_erro_w, 4000),NEW.nm_usuario,'N');

            qt_tabagismo_w := NULL;
    END;

    NEW.qt_tabagismo := qt_tabagismo_w;
    sql_w := NULL;
    BEGIN
        sql_w := 'CALL CALCULA_INGESTAO_ALCOOL_MD(:1) INTO :qt_alcool_w';
        EXECUTE sql_w
            USING IN NEW.ie_alcool, OUT qt_alcool_w;
    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := (':new.nr_atendimento: '||NEW.nr_atendimento||'-'||':new.cd_profissional: '||NEW.cd_profissional||'-'||':new.ie_situacao: '||NEW.ie_situacao||'-'||
                          ':new.ie_alcool: '||NEW.ie_alcool||'-'||'qt_alcool_w: '||qt_alcool_w);
      CALL gravar_log_medical_device('escala_risco_pulmonar_atual','CALCULA_INGESTAO_ALCOOL_MD'
                                 ,ds_parametros_w,substr(ds_erro_w, 4000),NEW.nm_usuario,'N');

            qt_alcool_w := NULL;
    END;

    NEW.qt_alcool := qt_alcool_w;
    sql_w := NULL;
    BEGIN
        sql_w := 'CALL CALCULA_TOT_RISCO_PULMONAR_MD(:1, :2, :3, :4, :5, :6, :7, :8, :9, :10, :11, :12, :13, :14, :15, :16, :17, :18, :19) INTO :qt_pontuacao_w';
        EXECUTE sql_w
            USING IN NEW.qt_aneurisma, IN NEW.qt_toracica, IN NEW.qt_abnominal_alta, IN NEW.qt_cabeca_pescoco, IN NEW.qt_neurocirurgia,
            IN NEW.qt_vascular_arterial, IN NEW.qt_anestesia_geral, IN NEW.qt_emergencia, IN NEW.qt_transfusao, IN NEW.qt_pontos_idade,
            IN qt_status_funcional_w, IN NEW.qt_diminuicao_peso, IN NEW.qt_dpoc, IN NEW.qt_acidente_vascular_cerebral, IN NEW.qt_diminuicao_consciencia,
            IN NEW.qt_pontos_ureia, IN NEW.qt_corticoide_cronico, IN NEW.qt_tabagismo, IN NEW.qt_alcool,
            OUT qt_pontuacao_w;

    EXCEPTION
        WHEN OTHERS THEN
      ds_erro_w := sqlerrm;
      ds_parametros_w := (':new.nr_atendimento: '||NEW.nr_atendimento||'-'||':new.cd_profissional: '||NEW.cd_profissional||'-'||':new.ie_situacao: '||NEW.ie_situacao||'-'||
                          ':new.qt_aneurisma: '||NEW.qt_aneurisma||'-'||':new.qt_toracica: '||NEW.qt_toracica||'-'||':new.qt_abnominal_alta: '||NEW.qt_abnominal_alta||'-'||
                          ':new.qt_cabeca_pescoco: '||NEW.qt_cabeca_pescoco||'-'||':new.qt_neurocirurgia: '||NEW.qt_neurocirurgia||'-'||':new.qt_vascular_arterial: '||NEW.qt_vascular_arterial||'-'||
                          ':new.qt_anestesia_geral: '||NEW.qt_anestesia_geral||'-'||':new.qt_emergencia: '||NEW.qt_emergencia||'-'||':new.qt_transfusao: '||NEW.qt_transfusao||'-'||
                          ':new.qt_pontos_idade: '||NEW.qt_pontos_idade||'-'||'qt_status_funcional_w: '||qt_status_funcional_w||'-'||':new.qt_diminuicao_peso: '||NEW.qt_diminuicao_peso||'-'||
                          ':new.qt_dpoc: '||NEW.qt_dpoc||'-'||':new.qt_acidente_vascular_cerebral: '||NEW.qt_acidente_vascular_cerebral||'-'||':new.qt_diminuicao_consciencia: '||NEW.qt_diminuicao_consciencia||'-'||
                          ':new.qt_pontos_ureia: '||NEW.qt_pontos_ureia||'-'||':new.qt_corticoide_cronico: '||NEW.qt_corticoide_cronico||'-'||':new.qt_tabagismo: '||NEW.qt_tabagismo||'-'||
                          ':new.qt_alcool: '||NEW.qt_alcool||'-'||'qt_pontuacao_w: '||qt_pontuacao_w);

                          
      CALL gravar_log_medical_device('escala_risco_pulmonar_atual','CALCULA_INGESTAO_ALCOOL_MD'
                                 ,ds_parametros_w,substr(ds_erro_w, 4000),NEW.nm_usuario,'N');
        
            qt_pontuacao_w := NULL;
    END;

    NEW.qt_pontos := qt_pontuacao_w;
    << final >> qt_reg_w := 0;
  END;
RETURN NEW;
END
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_escala_risco_pulmonar_atual() FROM PUBLIC;

CREATE TRIGGER escala_risco_pulmonar_atual
	BEFORE INSERT OR UPDATE ON escala_risco_pulmonar FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_escala_risco_pulmonar_atual();

