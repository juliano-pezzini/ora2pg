-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS ocup_hosp_status_insert ON ocup_hosp_status CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_ocup_hosp_status_insert() RETURNS trigger AS $BODY$
declare
nr_seq_status_w			varchar(20);

BEGIN


select	max(a.vl_dominio)
into STRICT	nr_seq_status_w
from	VALOR_DOMINIO a
where	a.cd_dominio = 4818
and 	exists (SELECT	1
		from	VALOR_DOMINIO x
		where	x.cd_dominio = 1806
		and	upper(x.ds_valor_dominio) = upper(a.ds_valor_dominio)
		and	x.vl_dominio = NEW.ie_status);

if (nr_seq_status_w is not null) then

NEW.nr_status_ocup := nr_seq_status_w;

end if;

RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_ocup_hosp_status_insert() FROM PUBLIC;

CREATE TRIGGER ocup_hosp_status_insert
	BEFORE INSERT OR UPDATE ON ocup_hosp_status FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_ocup_hosp_status_insert();

