-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS proj_agenda_befup ON proj_agenda CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_proj_agenda_befup() RETURNS trigger AS $BODY$
declare
 
nm_atributo_w	varchar(50);
ds_atributos_w	varchar(255);
ds_atributo_w	varchar(255);
cd_consultor_w	varchar(255);
 
C01 CURSOR FOR 
	SELECT	NM_ATRIBUTO 
	from	tabela_atributo 
	where	nm_tabela = 'PROJ_AGENDA' 
	and	ie_tipo_atributo <> 'FUNCTION' 
	and	nr_seq_apresent is not null 
	order by 1;
BEGIN 
ds_atributos_w := '';
	if (OLD.dt_agenda <> NEW.dt_agenda) then 
		select 	substr(OBTER_LABEL_ATRIBUTO('DT_AGENDA', 'PROJ_AGENDA', ''),1,255) 
		into STRICT	ds_atributo_w 
		;	
		 
		ds_atributos_w := ds_atributos_w || ds_atributo_w || ',';	
	end if;
 
	if (OLD.CD_CONSULTOR <> NEW.CD_CONSULTOR) then 
		select 	substr(OBTER_LABEL_ATRIBUTO('CD_CONSULTOR', 'PROJ_AGENDA', ''),1,255) 
		into STRICT	ds_atributo_w 
		;	
		 
		ds_atributos_w := ds_atributos_w || ds_atributo_w || ',';	
	end if;
 
	if (OLD.IE_DIA_TODO <> NEW.IE_DIA_TODO) then 
		select 	substr(OBTER_LABEL_ATRIBUTO('IE_DIA_TODO', 'PROJ_AGENDA', ''),1,255) 
		into STRICT	ds_atributo_w 
		;	
		 
		ds_atributos_w := ds_atributos_w || ds_atributo_w || ',';	
	end if;
	 
	if (OLD.IE_STATUS <> NEW.IE_STATUS) then 
		select 	substr(OBTER_LABEL_ATRIBUTO('IE_STATUS', 'PROJ_AGENDA', ''),1,255) 
		into STRICT	ds_atributo_w 
		;	
		 
		ds_atributos_w := ds_atributos_w || ds_atributo_w || ',';	
	end if;
	 
	if (OLD.CD_HORA_INIC <> NEW.CD_HORA_INIC) then 
		select 	substr(OBTER_LABEL_ATRIBUTO('CD_HORA_INIC', 'PROJ_AGENDA', ''),1,255) 
		into STRICT	ds_atributo_w 
		;	
		 
		ds_atributos_w := ds_atributos_w || ds_atributo_w || ',';	
	end if;
	 
	if (OLD.CD_HORA_FIM <> NEW.CD_HORA_FIM) then 
		select 	substr(OBTER_LABEL_ATRIBUTO('CD_HORA_FIM', 'PROJ_AGENDA', ''),1,255) 
		into STRICT	ds_atributo_w 
		;	
		 
		ds_atributos_w := ds_atributos_w || ds_atributo_w || ',';	
	end if;
	 
	if (OLD.NR_SEQ_CLIENTE <> NEW.NR_SEQ_CLIENTE) then 
		select 	substr(OBTER_LABEL_ATRIBUTO('NR_SEQ_CLIENTE', 'PROJ_AGENDA', ''),1,255) 
		into STRICT	ds_atributo_w 
		;	
		 
		ds_atributos_w := ds_atributos_w || ds_atributo_w || ',';	
	end if;
	 
	if (OLD.NR_SEQ_CANAL <> NEW.NR_SEQ_CANAL) then 
		select 	substr(OBTER_LABEL_ATRIBUTO('NR_SEQ_CANAL', 'PROJ_AGENDA', ''),1,255) 
		into STRICT	ds_atributo_w 
		;	
		 
		ds_atributos_w := ds_atributos_w || ds_atributo_w || ',';	
	end if;
	 
	if (OLD.NR_SEQ_PROJ <> NEW.NR_SEQ_PROJ) then 
		select 	substr(OBTER_LABEL_ATRIBUTO('NR_SEQ_PROJ', 'PROJ_AGENDA', ''),1,255) 
		into STRICT	ds_atributo_w 
		;	
		 
		ds_atributos_w := ds_atributos_w || ds_atributo_w || ',';	
	end if;
	 
	if (OLD.NR_SEQ_MOTIVO <> NEW.NR_SEQ_MOTIVO) then 
		select 	substr(OBTER_LABEL_ATRIBUTO('NR_SEQ_MOTIVO', 'PROJ_AGENDA', ''),1,255) 
		into STRICT	ds_atributo_w 
		;	
		 
		ds_atributos_w := ds_atributos_w || ds_atributo_w || ',';	
	end if;
	 
	if (OLD.DS_OBSERVACAO <> NEW.DS_OBSERVACAO) then 
		select 	substr(OBTER_LABEL_ATRIBUTO('DS_OBSERVACAO', 'PROJ_AGENDA', ''),1,255) 
		into STRICT	ds_atributo_w 
		;	
		 
		ds_atributos_w := ds_atributos_w || ds_atributo_w || ',';	
	end if;
	 
	if (OLD.DS_OBS_ESCRITORIO <> NEW.DS_OBS_ESCRITORIO) then 
		select 	substr(OBTER_LABEL_ATRIBUTO('DS_OBS_ESCRITORIO', 'PROJ_AGENDA', ''),1,255) 
		into STRICT	ds_atributo_w 
		;	
		 
		ds_atributos_w := ds_atributos_w || ds_atributo_w || ',';	
	end if;
	 
	if (OLD.DS_NOME_CURTO_CLIENTE <> NEW.DS_NOME_CURTO_CLIENTE) then 
		select 	substr(OBTER_LABEL_ATRIBUTO('DS_NOME_CURTO_CLIENTE', 'PROJ_AGENDA', ''),1,255) 
		into STRICT	ds_atributo_w 
		;	
		 
		ds_atributos_w := ds_atributos_w || ds_atributo_w || ',';	
	end if;
	 
	if (OLD.IE_AGENDA_PREVISTA <> NEW.IE_AGENDA_PREVISTA) then 
		select 	substr(OBTER_LABEL_ATRIBUTO('IE_AGENDA_PREVISTA', 'PROJ_AGENDA', ''),1,255) 
		into STRICT	ds_atributo_w 
		;	
		 
		ds_atributos_w := ds_atributos_w || ds_atributo_w || ',';	
	end if;
		 
	 
	if (ds_atributos_w is not null) then 
	CALL envia_ci_novo_proj('AA', NEW.nr_seq_proj, wheb_usuario_pck.get_nm_usuario,0,0,0, ds_atributos_w);
	end if;
RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_proj_agenda_befup() FROM PUBLIC;

CREATE TRIGGER proj_agenda_befup
	BEFORE UPDATE ON proj_agenda FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_proj_agenda_befup();

