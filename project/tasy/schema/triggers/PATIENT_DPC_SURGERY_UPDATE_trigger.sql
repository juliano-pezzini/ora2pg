-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS patient_dpc_surgery_update ON patient_dpc_surgery CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_patient_dpc_surgery_update() RETURNS trigger AS $BODY$
BEGIN
declare
cd_classification_w         	dpc_surgery.cd_classification%type;
cd_mdc_w            	 	dpc_surgery.cd_mdc%type;
nr_seq_edition_w        	dpc_surgery.nr_seq_edition%type;
cd_k_surgery_1_w        	dpc_surgery.cd_k_surgery_1%type;
cd_k_surgery_2_w        	dpc_surgery.cd_k_surgery_2%type;
cd_k_surgery_3_w        	dpc_surgery.cd_k_surgery_3%type;
cd_k_surgery_4_w        	dpc_surgery.cd_k_surgery_4%type;
cd_k_surgery_5_w        	dpc_surgery.cd_k_surgery_5%type;

BEGIN
if (NEW.nr_seq_dpc_surgery is not null) then
  select    	a.cd_classification,
		a.cd_mdc,
		a.nr_seq_edition,
		a.cd_k_surgery_1,
		a.cd_k_surgery_2,
		a.cd_k_surgery_3,
		a.cd_k_surgery_4,
		a.cd_k_surgery_5
    into STRICT     	cd_classification_w,
		cd_mdc_w,
		nr_seq_edition_w,
		cd_k_surgery_1_w,
		cd_k_surgery_2_w,
		cd_k_surgery_3_w,
		cd_k_surgery_4_w,
		cd_k_surgery_5_w
    from    dpc_surgery a
    where    a.nr_sequencia = NEW.nr_seq_dpc_surgery;
end if;
end;
RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_patient_dpc_surgery_update() FROM PUBLIC;

CREATE TRIGGER patient_dpc_surgery_update
	BEFORE INSERT OR UPDATE ON patient_dpc_surgery FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_patient_dpc_surgery_update();

