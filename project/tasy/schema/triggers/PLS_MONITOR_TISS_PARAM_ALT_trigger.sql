-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS pls_monitor_tiss_param_alt ON pls_monitor_tiss_param CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_pls_monitor_tiss_param_alt() RETURNS trigger AS $BODY$
declare

ds_observacao_w		pls_monitor_tiss_param_log.ds_observacao%type;

BEGIN

if (coalesce(wheb_usuario_pck.get_ie_executar_trigger,'S') = 'S')  then

	if (NEW.qt_conta_arquivo is null and OLD.qt_conta_arquivo is not null) or (NEW.qt_conta_arquivo is not null and OLD.qt_conta_arquivo is null) or (NEW.qt_conta_arquivo <> OLD.qt_conta_arquivo) then
		ds_observacao_w := 	ds_observacao_w 			|| pls_util_pck.enter_w ||
					'Campo: QT_CONTA_ARQUIVO '  		|| pls_util_pck.enter_w ||
					'Antes: ' || OLD.qt_conta_arquivo	|| pls_util_pck.enter_w ||
					'Novo: ' || NEW.qt_conta_arquivo 	|| pls_util_pck.enter_w;
	end if;

	if (NEW.ie_utiliza_guia_operadora is null and OLD.ie_utiliza_guia_operadora is not null) or (NEW.ie_utiliza_guia_operadora is not null and OLD.ie_utiliza_guia_operadora is null) or (NEW.ie_utiliza_guia_operadora <> OLD.ie_utiliza_guia_operadora) then
		ds_observacao_w := 	ds_observacao_w 				|| pls_util_pck.enter_w ||
					'Campo: IE_UTILIZA_GUIA_OPERADORA '		|| pls_util_pck.enter_w ||
					'Antes: ' || OLD.ie_utiliza_guia_operadora	|| pls_util_pck.enter_w ||
					'Novo: ' || NEW.ie_utiliza_guia_operadora	|| pls_util_pck.enter_w;
	end if;

	if (NEW.ie_envia_cta_inter is null and OLD.ie_envia_cta_inter is not null) or (NEW.ie_envia_cta_inter is not null and OLD.ie_envia_cta_inter is null) or (NEW.ie_envia_cta_inter <> OLD.ie_envia_cta_inter) then
		ds_observacao_w := 	ds_observacao_w 			|| pls_util_pck.enter_w ||
					'Campo: IE_ENVIA_CTA_INTER '		|| pls_util_pck.enter_w ||
					'Antes: ' || OLD.ie_envia_cta_inter	|| pls_util_pck.enter_w ||
					'Novo: ' || NEW.ie_envia_cta_inter	|| pls_util_pck.enter_w;
	end if;

	if (NEW.ie_permite_rec_glosa is null and OLD.ie_permite_rec_glosa is not null) or (NEW.ie_permite_rec_glosa is not null and OLD.ie_permite_rec_glosa is null) or (NEW.ie_permite_rec_glosa <> OLD.ie_permite_rec_glosa) then
		ds_observacao_w := 	ds_observacao_w 			|| pls_util_pck.enter_w ||
					'Campo: IE_PERMITE_REC_GLOSA '		|| pls_util_pck.enter_w ||
					'Antes: ' || OLD.ie_permite_rec_glosa 	|| pls_util_pck.enter_w ||
					'Novo: ' || NEW.ie_permite_rec_glosa	|| pls_util_pck.enter_w;
	end if;

	if (NEW.ie_origem_regra_conv_tab is null and OLD.ie_origem_regra_conv_tab is not null) or (NEW.ie_origem_regra_conv_tab is not null and OLD.ie_origem_regra_conv_tab is null) or (NEW.ie_origem_regra_conv_tab <> OLD.ie_origem_regra_conv_tab) then
		ds_observacao_w := 	ds_observacao_w 				|| pls_util_pck.enter_w ||
					'Campo: IE_ORIGEM_REGRA_CONV_TAB '		|| pls_util_pck.enter_w ||
					'Antes: ' || OLD.ie_origem_regra_conv_tab	|| pls_util_pck.enter_w ||
					'Novo: ' || NEW.ie_origem_regra_conv_tab	|| pls_util_pck.enter_w;
	end if;

	if (ds_observacao_w is not null) then
		insert	into	pls_monitor_tiss_param_log(	dt_atualizacao, dt_atualizacao_nrec, nm_usuario,
				nm_usuario_nrec, nr_seq_tiss_param, ds_observacao,
				nr_sequencia)
		values (	LOCALTIMESTAMP, LOCALTIMESTAMP, NEW.nm_usuario,
				NEW.nm_usuario, NEW.nr_sequencia, ds_observacao_w,
				nextval('pls_monitor_tiss_param_log_seq'));
	end if;
end if;

RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_pls_monitor_tiss_param_alt() FROM PUBLIC;

CREATE TRIGGER pls_monitor_tiss_param_alt
	BEFORE UPDATE ON pls_monitor_tiss_param FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_pls_monitor_tiss_param_alt();

