-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS gpt_rec_before_ins_upd ON cpoe_recomendacao CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_gpt_rec_before_ins_upd() RETURNS trigger AS $BODY$
declare
	dt_valid_prim_hor_w		timestamp;
BEGIN
  BEGIN
    if (NEW.hr_prim_horario is not null) and (NEW.hr_prim_horario <> OLD.hr_prim_horario) and (obter_funcao_ativa = 252) then
        BEGIN
            dt_valid_prim_hor_w := to_date(to_char(LOCALTIMESTAMP, 'dd/mm/yyyy') || ' ' || NEW.hr_prim_horario, 'dd/mm/yyyy hh24:mi');
        exception
            when others then
                CALL wheb_mensagem_pck.exibir_mensagem_abort(1128915, 'HR_PRIM_HORARIO='||NEW.hr_prim_horario);
        end;
    end if;
  END;
RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_gpt_rec_before_ins_upd() FROM PUBLIC;

CREATE TRIGGER gpt_rec_before_ins_upd
	BEFORE INSERT OR UPDATE ON cpoe_recomendacao FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_gpt_rec_before_ins_upd();

