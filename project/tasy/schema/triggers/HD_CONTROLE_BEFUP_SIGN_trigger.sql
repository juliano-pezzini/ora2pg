-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS hd_controle_befup_sign ON hd_controle CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_hd_controle_befup_sign() RETURNS trigger AS $BODY$
declare
nr_seq_assinatura_w	hd_assinatura_digital.nr_sequencia%type;

BEGIN

select 	max(nr_sequencia)
into STRICT	nr_seq_assinatura_w
from 	hd_assinatura_digital
where 	nr_seq_controle = NEW.nr_sequencia
and 	ie_opcao = 'NC'
and	dt_liberacao is not null;

if (nr_seq_assinatura_w is not null)
	and (OLD.nr_sequencia		<> NEW.nr_sequencia
		or OLD.dt_atualizacao		<> NEW.dt_atualizacao
		or OLD.nm_usuario		<> NEW.nm_usuario
		or OLD.dt_atualizacao_nrec	<> NEW.dt_atualizacao_nrec
		or OLD.nm_usuario_nrec		<> NEW.nm_usuario_nrec
		or OLD.nr_seq_dialise		<> NEW.nr_seq_dialise
		or OLD.dt_controle		<> NEW.dt_controle
		or OLD.qt_fluxo_sangue		<> NEW.qt_fluxo_sangue
		or OLD.qt_fluxo_dialisado	<> NEW.qt_fluxo_dialisado
		or OLD.qt_pa_trans_menbrana	<> NEW.qt_pa_trans_menbrana
		or OLD.qt_pa_venosa		<> NEW.qt_pa_venosa
		or OLD.qt_pa_arterial		<> NEW.qt_pa_arterial
		or OLD.qt_heparina		<> NEW.qt_heparina
		or OLD.qt_temperatura_axiliar	<> NEW.qt_temperatura_axiliar
		or OLD.qt_pulso		<> NEW.qt_pulso
		or OLD.qt_pa_sistolica		<> NEW.qt_pa_sistolica
		or OLD.qt_pa_diastolica	<> NEW.qt_pa_diastolica
		or OLD.qt_sangue_dial		<> NEW.qt_sangue_dial
		or OLD.nr_seq_unid_dialise	<> NEW.nr_seq_unid_dialise
		or OLD.qt_clearence		<> NEW.qt_clearence
		or OLD.qt_ktv			<> NEW.qt_ktv
		or OLD.qt_soro_reposicao	<> NEW.qt_soro_reposicao
		or OLD.qt_soro_devolucao	<> NEW.qt_soro_devolucao
		or OLD.nr_seq_tipo_soro	<> NEW.nr_seq_tipo_soro
		or OLD.qt_condutividade	<> NEW.qt_condutividade
		or OLD.qt_hgt			<> NEW.qt_hgt
		or OLD.qt_dextro		<> NEW.qt_dextro
		or OLD.qt_insulina		<> NEW.qt_insulina
		or OLD.qt_glicose_adm		<> NEW.qt_glicose_adm
		or OLD.qt_insulina_int		<> NEW.qt_insulina_int
		or (OLD.nr_sequencia		is null		and	NEW.nr_sequencia		is not null)
		or (OLD.dt_atualizacao		is null		and	NEW.dt_atualizacao		is not null)
		or (OLD.nm_usuario		is null		and	NEW.nm_usuario			is not null)
		or (OLD.dt_atualizacao_nrec	is null		and	NEW.dt_atualizacao_nrec	is not null)
		or (OLD.nm_usuario_nrec	is null		and	NEW.nm_usuario_nrec		is not null)
		or (OLD.nr_seq_dialise		is null		and	NEW.nr_seq_dialise		is not null)
		or (OLD.dt_controle		is null		and	NEW.dt_controle		is not null)
		or (OLD.qt_fluxo_sangue	is null		and	NEW.qt_fluxo_sangue		is not null)
		or (OLD.qt_fluxo_dialisado	is null		and	NEW.qt_fluxo_dialisado		is not null)
		or (OLD.qt_pa_trans_menbrana	is null		and	NEW.qt_pa_trans_menbrana	is not null)
		or (OLD.qt_pa_venosa		is null		and	NEW.qt_pa_venosa		is not null)
		or (OLD.qt_pa_arterial		is null		and	NEW.qt_pa_arterial		is not null)
		or (OLD.qt_heparina		is null		and	NEW.qt_heparina		is not null)
		or (OLD.qt_temperatura_axiliar	is null		and	NEW.qt_temperatura_axiliar	is not null)
		or (OLD.qt_pulso		is null		and	NEW.qt_pulso			is not null)
		or (OLD.qt_pa_sistolica	is null		and	NEW.qt_pa_sistolica		is not null)
		or (OLD.qt_pa_diastolica	is null		and	NEW.qt_pa_diastolica		is not null)
		or (OLD.qt_sangue_dial		is null		and	NEW.qt_sangue_dial		is not null)
		or (OLD.nr_seq_unid_dialise	is null		and	NEW.nr_seq_unid_dialise	is not null)
		or (OLD.qt_clearence 		is null		and	NEW.qt_clearence 		is not null)
		or (OLD.qt_ktv			is null		and	NEW.qt_ktv			is not null)
		or (OLD.qt_soro_reposicao	is null		and	NEW.qt_soro_reposicao		is not null)
		or (OLD.qt_soro_devolucao	is null		and	NEW.qt_soro_devolucao		is not null)
		or (OLD.nr_seq_tipo_soro	is null		and	NEW.nr_seq_tipo_soro		is not null)
		or (OLD.qt_condutividade	is null		and	NEW.qt_condutividade		is not null)
		or (OLD.qt_hgt			is null		and	NEW.qt_hgt			is not null)
		or (OLD.qt_dextro	 	is null		and	NEW.qt_dextro	 		is not null)
		or (OLD.qt_insulina   		is null		and	NEW.qt_insulina   		is not null)
		or (OLD.qt_glicose_adm  	is null		and	NEW.qt_glicose_adm  		is not null)
		or (OLD.qt_insulina_int	is null		and	NEW.qt_insulina_int		is not null)
		or (OLD.nr_sequencia		is not null	and	NEW.nr_sequencia		is null)
		or (OLD.dt_atualizacao		is not null	and	NEW.dt_atualizacao		is null)
		or (OLD.nm_usuario		is not null	and	NEW.nm_usuario			is null)
		or (OLD.dt_atualizacao_nrec	is not null	and	NEW.dt_atualizacao_nrec	is null)
		or (OLD.nm_usuario_nrec	is not null	and	NEW.nm_usuario_nrec		is null)
		or (OLD.nr_seq_dialise		is not null	and	NEW.nr_seq_dialise		is null)
		or (OLD.dt_controle		is not null	and	NEW.dt_controle		is null)
		or (OLD.qt_fluxo_sangue	is not null	and	NEW.qt_fluxo_sangue		is null)
		or (OLD.qt_fluxo_dialisado	is not null	and	NEW.qt_fluxo_dialisado		is null)
		or (OLD.qt_pa_trans_menbrana	is not null	and	NEW.qt_pa_trans_menbrana	is null)
		or (OLD.qt_pa_venosa		is not null	and	NEW.qt_pa_venosa		is null)
		or (OLD.qt_pa_arterial		is not null	and	NEW.qt_pa_arterial		is null)
		or (OLD.qt_heparina		is not null	and	NEW.qt_heparina		is null)
		or (OLD.qt_temperatura_axiliar	is not null	and	NEW.qt_temperatura_axiliar	is null)
		or (OLD.qt_pulso		is not null	and	NEW.qt_pulso			is null)
		or (OLD.qt_pa_sistolica	is not null	and	NEW.qt_pa_sistolica		is null)
		or (OLD.qt_pa_diastolica	is not null	and	NEW.qt_pa_diastolica		is null)
		or (OLD.qt_sangue_dial		is not null	and	NEW.qt_sangue_dial		is null)
		or (OLD.nr_seq_unid_dialise	is not null	and	NEW.nr_seq_unid_dialise	is null)
		or (OLD.qt_clearence 		is not null	and	NEW.qt_clearence 		is null)
		or (OLD.qt_ktv			is not null	and	NEW.qt_ktv			is null)
		or (OLD.qt_soro_reposicao	is not null	and	NEW.qt_soro_reposicao		is null)
		or (OLD.qt_soro_devolucao	is not null	and	NEW.qt_soro_devolucao		is null)
		or (OLD.nr_seq_tipo_soro	is not null	and	NEW.nr_seq_tipo_soro		is null)
		or (OLD.qt_condutividade	is not null	and	NEW.qt_condutividade		is null)
		or (OLD.qt_hgt			is not null	and	NEW.qt_hgt			is null)
		or (OLD.qt_dextro	 	is not null	and	NEW.qt_dextro	 		is null)
		or (OLD.qt_insulina   		is not null	and	NEW.qt_insulina   		is null)
		or (OLD.qt_glicose_adm  	is not null	and	NEW.qt_glicose_adm  		is null)
		or (OLD.qt_insulina_int	is not null	and	NEW.qt_insulina_int		is null)) then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(364485);
end if;

RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_hd_controle_befup_sign() FROM PUBLIC;

CREATE TRIGGER hd_controle_befup_sign
	BEFORE UPDATE ON hd_controle FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_hd_controle_befup_sign();

