-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS sus_laudo_paciente_tp ON sus_laudo_paciente CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_sus_laudo_paciente_tp() RETURNS trigger AS $BODY$
DECLARE nr_seq_w bigint;ds_s_w   varchar(1);ds_c_w   varchar(1);ds_w	   varchar(1);ie_log_w varchar(1);BEGIN BEGIN ds_s_w := to_char(OLD.NR_SEQ_INTERNO);  ds_c_w:=null; ds_w:=substr(NEW.DS_LOCALIZACAO_METASTASE,1,500);SELECT * FROM gravar_log_alteracao(substr(OLD.DS_LOCALIZACAO_METASTASE,1,4000), substr(NEW.DS_LOCALIZACAO_METASTASE,1,4000), NEW.nm_usuario, nr_seq_w, 'DS_LOCALIZACAO_METASTASE', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w;  ds_w:=substr(NEW.DS_ESTADIO_UICC,1,500);SELECT * FROM gravar_log_alteracao(substr(OLD.DS_ESTADIO_UICC,1,4000), substr(NEW.DS_ESTADIO_UICC,1,4000), NEW.nm_usuario, nr_seq_w, 'DS_ESTADIO_UICC', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w;  ds_w:=substr(NEW.DS_RESULT_PROVA,1,500);SELECT * FROM gravar_log_alteracao(substr(OLD.DS_RESULT_PROVA,1,4000), substr(NEW.DS_RESULT_PROVA,1,4000), NEW.nm_usuario, nr_seq_w, 'DS_RESULT_PROVA', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w;  ds_w:=substr(NEW.DS_CONDICAO_JUSTIFICA,1,500);SELECT * FROM gravar_log_alteracao(substr(OLD.DS_CONDICAO_JUSTIFICA,1,4000), substr(NEW.DS_CONDICAO_JUSTIFICA,1,4000), NEW.nm_usuario, nr_seq_w, 'DS_CONDICAO_JUSTIFICA', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w;  ds_w:=substr(NEW.DS_SINAL_SINTOMA,1,500);SELECT * FROM gravar_log_alteracao(substr(OLD.DS_SINAL_SINTOMA,1,4000), substr(NEW.DS_SINAL_SINTOMA,1,4000), NEW.nm_usuario, nr_seq_w, 'DS_SINAL_SINTOMA', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w;  ds_w:=substr(NEW.DS_ESTADIO_OUTRO_SIST,1,500);SELECT * FROM gravar_log_alteracao(substr(OLD.DS_ESTADIO_OUTRO_SIST,1,4000), substr(NEW.DS_ESTADIO_OUTRO_SIST,1,4000), NEW.nm_usuario, nr_seq_w, 'DS_ESTADIO_OUTRO_SIST', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_AIH,1,4000), substr(NEW.NR_AIH,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_AIH', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.IE_METASTASE,1,4000), substr(NEW.IE_METASTASE,1,4000), NEW.nm_usuario, nr_seq_w, 'IE_METASTASE', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.IE_RECIDIVADO,1,4000), substr(NEW.IE_RECIDIVADO,1,4000), NEW.nm_usuario, nr_seq_w, 'IE_RECIDIVADO', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_EMISSAO,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_EMISSAO,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_EMISSAO', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_PROCEDIMENTO_SOLIC,1,4000), substr(NEW.CD_PROCEDIMENTO_SOLIC,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_PROCEDIMENTO_SOLIC', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.QT_PROCEDIMENTO_SOLIC,1,4000), substr(NEW.QT_PROCEDIMENTO_SOLIC,1,4000), NEW.nm_usuario, nr_seq_w, 'QT_PROCEDIMENTO_SOLIC', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_MEDICO_RESPONSAVEL,1,4000), substr(NEW.CD_MEDICO_RESPONSAVEL,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_MEDICO_RESPONSAVEL', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_DIAGNOSTICO,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_DIAGNOSTICO,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_DIAGNOSTICO', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_ATENDIMENTO,1,4000), substr(NEW.NR_ATENDIMENTO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_ATENDIMENTO', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_LAUDO_SUS,1,4000), substr(NEW.NR_LAUDO_SUS,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_LAUDO_SUS', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_CID_PRINCIPAL,1,4000), substr(NEW.CD_CID_PRINCIPAL,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_CID_PRINCIPAL', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_MEDICO_REQUISITANTE,1,4000), substr(NEW.CD_MEDICO_REQUISITANTE,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_MEDICO_REQUISITANTE', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_GRAU_HISTOPAT,1,4000), substr(NEW.CD_GRAU_HISTOPAT,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_GRAU_HISTOPAT', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_DIAG_CITO_HIST,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_DIAG_CITO_HIST,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_DIAG_CITO_HIST', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.IE_LIFONODOS_REG_INVAL,1,4000), substr(NEW.IE_LIFONODOS_REG_INVAL,1,4000), NEW.nm_usuario, nr_seq_w, 'IE_LIFONODOS_REG_INVAL', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.IE_TRATAMENTO_ANT,1,4000), substr(NEW.IE_TRATAMENTO_ANT,1,4000), NEW.nm_usuario, nr_seq_w, 'IE_TRATAMENTO_ANT', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_DIAG_CITO_HIST,1,4000), substr(NEW.CD_DIAG_CITO_HIST,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_DIAG_CITO_HIST', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_INTERNO_CONTA,1,4000), substr(NEW.NR_INTERNO_CONTA,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_INTERNO_CONTA', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.QT_MESES_AUTOR_LV,1,4000), substr(NEW.QT_MESES_AUTOR_LV,1,4000), NEW.nm_usuario, nr_seq_w, 'QT_MESES_AUTOR_LV', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_CID_TOPOGRAFIA,1,4000), substr(NEW.CD_CID_TOPOGRAFIA,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_CID_TOPOGRAFIA', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_PESSOA_FISICA,1,4000), substr(NEW.CD_PESSOA_FISICA,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_PESSOA_FISICA', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_BPA,1,4000), substr(NEW.NR_BPA,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_BPA', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_PROFIS_REQUISITANTE,1,4000), substr(NEW.CD_PROFIS_REQUISITANTE,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_PROFIS_REQUISITANTE', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_CID_SECUNDARIO,1,4000), substr(NEW.CD_CID_SECUNDARIO,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_CID_SECUNDARIO', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_LOTE,1,4000), substr(NEW.NR_SEQ_LOTE,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_LOTE', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_APAC,1,4000), substr(NEW.NR_APAC,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_APAC', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_RETORNO_SECR,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_RETORNO_SECR,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_RETORNO_SECR', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_AUTORIZACAO_GERPAC,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_AUTORIZACAO_GERPAC,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_AUTORIZACAO_GERPAC', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_INICIO_VAL_APAC,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_INICIO_VAL_APAC,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_INICIO_VAL_APAC', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_FIM_VAL_APAC,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_FIM_VAL_APAC,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_FIM_VAL_APAC', ie_log_w, ds_w, 'SUS_LAUDO_PACIENTE', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w;   exception when others then ds_w:= '1'; end;   END;
RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_sus_laudo_paciente_tp() FROM PUBLIC;

CREATE TRIGGER sus_laudo_paciente_tp
	AFTER UPDATE ON sus_laudo_paciente FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_sus_laudo_paciente_tp();

