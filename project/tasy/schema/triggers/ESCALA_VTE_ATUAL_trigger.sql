-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS escala_vte_atual ON escala_vte CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_escala_vte_atual() RETURNS trigger AS $BODY$
declare

qt_pontuacao_w	bigint;

BEGIN

qt_pontuacao_w	:= 0;

if (NEW.ie_age = 1) then
qt_pontuacao_w	:= qt_pontuacao_w +1;
elsif (NEW.ie_age = 2) then
qt_pontuacao_w	:= qt_pontuacao_w +2;
elsif (NEW.ie_age = 3)then
qt_pontuacao_w	:= qt_pontuacao_w +3;
end if;

if (NEW.IE_MINOR_SURG_PLAN = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +1;
end if;

if (NEW.IE_BMI = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +1;
end if;

if (NEW.IE_PRIOR_MAJ_SUR = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +1;
end if;

if (NEW.IE_SWOLLEN_LEGS = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +1;
end if;

if (NEW.IE_VERICOSE_VEINS = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +1;
end if;

if (NEW.IE_SEPSIS = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +1;
end if;

if (NEW.IE_COPD = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +1;
end if;

if (NEW.IE_MYOCARDIAL = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +1;
end if;

if (NEW.IE_HEART_FAIL = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +1;
end if;

if (NEW.IE_HIST_IBD = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +1;
end if;

if (NEW.IE_BED_REST = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +1;
end if;

if (NEW.IE_PREGNANT = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +1;
end if;

if (NEW.IE_ABORTION = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +1;
end if;

if (NEW.IE_HARMONE = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +1;
end if;

if (NEW.IE_ANTHROSCOPIC = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +2;
end if;

if (NEW.IE_OPEN_SURGERY = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +2;
end if;

if (NEW.IE_LAPROSCOPIC_SURGERY = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +2;
end if;

if (NEW.IE_PRIOR_CANCER = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +2;
end if;

if (NEW.IE_PRESENT_CANCER = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +2;
end if;

if (NEW.IE_BED = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +2;
end if;

if (NEW.IE_PLASTER = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +2;
end if;

if (NEW.IE_VENOUS = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +2;
end if;

if (NEW.IE_VTE = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +3;
end if;

if (NEW.IE_VTE_FAMILY = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +3;
end if;

if (NEW.IE_CHEMO = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +3;
end if;

if (NEW.IE_LIEDEN = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +3;
end if;

if (NEW.IE_PROTHROMBIN = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +3;
end if;

if (NEW.IE_LUPUS = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +3;
end if;

if (NEW.IE_ELEVATED = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +3;
end if;

if (NEW.IE_SERUM = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +3;
end if;

if (NEW.IE_HEPARIN = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +3;
end if;

if (NEW.IE_CONGENITAL = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +3;
end if;

if (NEW.IE_MAJOR_SURG_6HRS = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +5;
end if;

if (NEW.IE_STROKE = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +5;
end if;

if (NEW.IE_EXTREMITY = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +5;
end if;

if (NEW.IE_FRACTURE = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +5;
end if;

if (NEW.IE_SPINAL = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +5;
end if;

if (NEW.IE_TRAUMA = 'S') then
qt_pontuacao_w	:= qt_pontuacao_w +5;
end if;

NEW.qt_vte :=   qt_pontuacao_w;

RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_escala_vte_atual() FROM PUBLIC;

CREATE TRIGGER escala_vte_atual
	BEFORE INSERT OR UPDATE ON escala_vte FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_escala_vte_atual();

