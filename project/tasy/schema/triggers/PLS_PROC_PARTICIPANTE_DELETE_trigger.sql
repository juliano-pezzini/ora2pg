-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS pls_proc_participante_delete ON pls_proc_participante CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_pls_proc_participante_delete() RETURNS trigger AS $BODY$
declare
	ds_log_call_w 	varchar(1500);
	ds_observacao_w	varchar(4000);
	ie_opcao_w	varchar(3);
BEGIN 
if (pls_se_aplicacao_tasy = 'S')then 
	ie_opcao_w := '2';
else 
	ie_opcao_w := '1';
end if;
 
ds_log_call_w := substr(pls_obter_detalhe_exec(false),1,1500);
 
ds_observacao_w := 	'Conta partic: ' || OLD.nr_sequencia || pls_util_pck.enter_w || 
			'Conta proc: ' || OLD.nr_seq_conta_proc || pls_util_pck.enter_w || 
			'Médico: ' || OLD.cd_medico || pls_util_pck.enter_w || 
			'Médico imp: ' || OLD.cd_medico_imp || pls_util_pck.enter_w || 
			'Prestador: ' || OLD.nr_seq_prestador;
 
insert into plsprco_cta( 	nr_sequencia, dt_atualizacao, nm_usuario, 
					dt_atualizacao_nrec, nm_usuario_nrec, nm_tabela, 
					ds_log, ds_log_call, ds_funcao_ativa, 
					ie_aplicacao_tasy, nm_maquina,ie_opcao, 
					nr_seq_conta_proc_partic, pls_conta_proc) 
		values ( 	nextval('plsprco_cta_seq'), LOCALTIMESTAMP, substr(coalesce(wheb_usuario_pck.get_nm_usuario,'Usuário não identificado '),1,14), 
					LOCALTIMESTAMP, substr(coalesce(wheb_usuario_pck.get_nm_usuario,'Usuário não identificado '),1,14), 'PLS_PROC_PARTICIPANTE', 
					ds_observacao_w, ds_log_call_w, obter_funcao_ativa, 
					pls_se_aplicacao_tasy, wheb_usuario_pck.get_machine, ie_opcao_w, 
					OLD.nr_sequencia, OLD.nr_seq_conta_proc);
 
RETURN OLD;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_pls_proc_participante_delete() FROM PUBLIC;

CREATE TRIGGER pls_proc_participante_delete
	BEFORE DELETE ON pls_proc_participante FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_pls_proc_participante_delete();

