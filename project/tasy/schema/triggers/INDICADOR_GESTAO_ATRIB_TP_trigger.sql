-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS indicador_gestao_atrib_tp ON indicador_gestao_atrib CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_indicador_gestao_atrib_tp() RETURNS trigger AS $BODY$
declare
ds_expressao_br_w		DIC_EXPRESSAO.ds_expressao_br%type;
cd_expressao_w		DIC_EXPRESSAO.cd_expressao%type;
nm_coluna_desc_w		varchar(50);
nm_coluna_exp_w		varchar(50);
BEGIN
  BEGIN
	BEGIN
		if (NEW.CD_EXP_DIMENSAO is not null or
			OLD.CD_EXP_DIMENSAO is not null) then

			nm_coluna_desc_w	:= 'DS_DIMENSAO';
			nm_coluna_exp_w		:= 'CD_EXP_DIMENSAO';
			cd_expressao_w		:= NEW.CD_EXP_DIMENSAO;

			ds_expressao_br_w	:= obter_desc_expressao_br(cd_expressao_w);
			NEW.DS_DIMENSAO 	:= ds_expressao_br_w;
		end if;

		if (NEW.CD_EXP_GRID is not null or
			OLD.CD_EXP_GRID is not null) then

			nm_coluna_desc_w	:= 'DS_GRID';
			nm_coluna_exp_w		:= 'CD_EXP_GRID';
			cd_expressao_w		:= NEW.CD_EXP_GRID;

			ds_expressao_br_w	:= obter_desc_expressao_br(cd_expressao_w);
			NEW.DS_GRID		:= ds_expressao_br_w;
		end if;

		if (NEW.CD_EXP_DATA is not null or
			OLD.CD_EXP_DATA is not null) then

			nm_coluna_desc_w	:= 'DS_DATA';
			nm_coluna_exp_w		:= 'CD_EXP_DATA';
			cd_expressao_w		:= NEW.CD_EXP_DATA;

			ds_expressao_br_w		:= obter_desc_expressao_br(cd_expressao_w);
			NEW.DS_DATA		:= ds_expressao_br_w;
		end if;

		if (NEW.CD_EXP_INFORMACAO is not null or
			OLD.CD_EXP_INFORMACAO is not null) then

			nm_coluna_desc_w	:= 'DS_INFORMACAO';
			nm_coluna_exp_w		:= 'CD_EXP_INFORMACAO';
			cd_expressao_w		:= NEW.CD_EXP_INFORMACAO;

			ds_expressao_br_w	:= obter_desc_expressao_br(cd_expressao_w);
			NEW.DS_INFORMACAO	:= ds_expressao_br_w;
		end if;

	exception when others then
		-- Caso a expressao nao couber no campo, avisa usu√°rio
		if (SQLSTATE = -6502) then
			CALL wheb_mensagem_pck.exibir_mensagem_abort(290787, 'CD_EXPRESSAO_P='||cd_expressao_w||
									';DS_ATRIBUTO_P='||nm_coluna_desc_w||
									';NM_ATRIBUTO_EXP_P='||nm_coluna_exp_w);
		end if;
	end;
  END;
RETURN NEW;
END
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_indicador_gestao_atrib_tp() FROM PUBLIC;

CREATE TRIGGER indicador_gestao_atrib_tp
	BEFORE INSERT OR UPDATE ON indicador_gestao_atrib FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_indicador_gestao_atrib_tp();

