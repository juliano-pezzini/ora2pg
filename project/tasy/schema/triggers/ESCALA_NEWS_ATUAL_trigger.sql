-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS escala_news_atual ON escala_news CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_escala_news_atual() RETURNS trigger AS $BODY$
declare
 
qt_reg_w bigint;
 
BEGIN 
 
NEW.qt_pontuacao := 0;
 
if (NEW.qt_freq_resp <= 8) then 
	NEW.qt_pontuacao := 3;
elsif (NEW.qt_freq_resp between 9 and 11) then 
	NEW.qt_pontuacao := 1;
elsif (NEW.qt_freq_resp between 21 and 24) then 
	NEW.qt_pontuacao := 2;
elsif (NEW.qt_freq_resp >= 25) then 
	NEW.qt_pontuacao := 3;
end if;
 
if (NEW.qt_saturacao_02 <= 91) then 
	NEW.qt_pontuacao := NEW.qt_pontuacao + 3;
elsif (NEW.qt_saturacao_02 between 92 and 93) then 
	NEW.qt_pontuacao := NEW.qt_pontuacao + 2;
elsif (NEW.qt_saturacao_02 between 94 and 95) then 
	NEW.qt_pontuacao := NEW.qt_pontuacao + 1;
end if;
 
if (coalesce(NEW.ie_o2_suplementar,'N') = 'S') then 
	NEW.qt_pontuacao := NEW.qt_pontuacao + 2;
end if;
 
if (NEW.qt_temp <= 35) then 
	NEW.qt_pontuacao := NEW.qt_pontuacao + 3;
elsif (NEW.qt_temp between 35.1 and 36) then 
	NEW.qt_pontuacao := NEW.qt_pontuacao + 1;
elsif (NEW.qt_temp between 38.1 and 39) then 
	NEW.qt_pontuacao := NEW.qt_pontuacao + 1;
elsif (NEW.qt_temp >= 39.1) then 
	NEW.qt_pontuacao := NEW.qt_pontuacao + 2;
end if;
 
if (NEW.qt_pa_sistolica <= 90) then 
	NEW.qt_pontuacao := NEW.qt_pontuacao + 3;
elsif (NEW.qt_pa_sistolica between 91 and 100) then 
	NEW.qt_pontuacao := NEW.qt_pontuacao + 2;
elsif (NEW.qt_pa_sistolica between 101 and 110) then 
	NEW.qt_pontuacao := NEW.qt_pontuacao + 1;
elsif (NEW.qt_pa_sistolica >= 220) then 
	NEW.qt_pontuacao := NEW.qt_pontuacao + 3;
end if;
 
if (NEW.qt_freq_cardiaca <= 40) then 
	NEW.qt_pontuacao := NEW.qt_pontuacao + 3;
elsif (NEW.qt_freq_cardiaca between 41 and 50) then 
	NEW.qt_pontuacao := NEW.qt_pontuacao + 1;
elsif (NEW.qt_freq_cardiaca between 91 and 110) then 
	NEW.qt_pontuacao := NEW.qt_pontuacao + 1;
elsif (NEW.qt_freq_cardiaca between 111 and 130) then 
	NEW.qt_pontuacao := NEW.qt_pontuacao + 2;
elsif (NEW.qt_freq_cardiaca >= 131) then 
	NEW.qt_pontuacao := NEW.qt_pontuacao + 3;
end if;
 
if (NEW.ie_nivel_consciencia in ('1','2','3')) then 
	NEW.qt_pontuacao := NEW.qt_pontuacao + 3;
end if;
 
RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_escala_news_atual() FROM PUBLIC;

CREATE TRIGGER escala_news_atual
	BEFORE INSERT OR UPDATE ON escala_news FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_escala_news_atual();

