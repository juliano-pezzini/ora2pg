-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS tecnica_anestesica_aft_upd ON tecnica_anestesica CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_tecnica_anestesica_aft_upd() RETURNS trigger AS $BODY$
DECLARE
/* OBS: Ao editar pelo Java/HTML (tipo CLOB), so ira sobrescrever o conteudo do campo em Delphi (tipo Varchar2) quando o conteudo do campo CLOB for igual ou inferior a 4000 contando os caracteres do RTF .
** Quando editar via Delphi, sempre ira sobrescrever o conteudo do campo usado em Java/HTML para nao haver impactos quando houver migracao de plataforma ou quando utilizado em contingencia
*/

BEGIN
if (TG_OP = 'UPDATE') then
	if ((coalesce(OLD.ds_texto_padrao_clob, 'XPTO') <> coalesce(NEW.ds_texto_padrao_clob, 'XPTO'))
		and octet_length(coalesce(NEW.ds_texto_padrao_clob, 'XPTO')) <= 4000)then /*quando alterado pelo Java ou HTML*/

		NEW.ds_texto_padrao := SUBSTR(NEW.ds_texto_padrao_clob,1,4000);
	elsif (OLD.ds_texto_padrao <> NEW.ds_texto_padrao) then /*quando alterado pelo Delphi*/

		NEW.ds_texto_padrao_clob := NEW.ds_texto_padrao;
	end if;
elsif (TG_OP = 'INSERT') then
	if ((coalesce(NEW.ds_texto_padrao_clob,'XPTO') <> 'XPTO' or NEW.ds_texto_padrao_clob is not null)
		and octet_length(NEW.ds_texto_padrao_clob) <= 4000) then /*quando alterado pelo Java ou HTML*/

		NEW.ds_texto_padrao := SUBSTR(NEW.ds_texto_padrao_clob,1,4000);
	elsif (coalesce(NEW.ds_texto_padrao,'XPTO') <> 'XPTO') then /*quando alterado pelo Delphi*/

		NEW.ds_texto_padrao_clob := NEW.ds_texto_padrao;
	end if;
end if;

RETURN NEW;
end;
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_tecnica_anestesica_aft_upd() FROM PUBLIC;

CREATE TRIGGER tecnica_anestesica_aft_upd
	BEFORE INSERT OR UPDATE ON tecnica_anestesica FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_tecnica_anestesica_aft_upd();

