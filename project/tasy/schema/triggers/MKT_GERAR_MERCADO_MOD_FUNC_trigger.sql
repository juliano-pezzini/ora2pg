-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS mkt_gerar_mercado_mod_func ON mkt_modulo_funcao CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_mkt_gerar_mercado_mod_func() RETURNS trigger AS $BODY$
DECLARE
	WRK_NR_SEQ_MERCADO double precision;

	C_MERCADO_MODULO CURSOR FOR
		SELECT NR_SEQ_MERCADO FROM MKT_MODULO_MERCADO
		WHERE NR_SEQ_MODULO = NEW.NR_SEQ_AREA_MODULO;

   BEGIN
     OPEN C_MERCADO_MODULO;
		LOOP
			FETCH C_MERCADO_MODULO INTO WRK_NR_SEQ_MERCADO;
			EXIT WHEN NOT FOUND; /* apply on C_MERCADO_MODULO */

			INSERT INTO MKT_FUNCAO_MERCADO(NR_SEQUENCIA,
										DT_ATUALIZACAO,
										NM_USUARIO,
										DT_ATUALIZACAO_NREC,
										NM_USUARIO_NREC,
										NR_SEQ_MOD_FUN,
										NR_SEQ_MERCADO )
			VALUES (nextval('mkt_funcao_mercado_seq'),
						  LOCALTIMESTAMP,
						  WHEB_USUARIO_PCK.GET_NM_USUARIO,
						  LOCALTIMESTAMP,
						  WHEB_USUARIO_PCK.GET_NM_USUARIO,
						  NEW.NR_SEQUENCIA,
						  WRK_NR_SEQ_MERCADO );
		END LOOP;
   RETURN NEW;
END
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_mkt_gerar_mercado_mod_func() FROM PUBLIC;

CREATE TRIGGER mkt_gerar_mercado_mod_func
	AFTER INSERT ON mkt_modulo_funcao FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_mkt_gerar_mercado_mod_func();

