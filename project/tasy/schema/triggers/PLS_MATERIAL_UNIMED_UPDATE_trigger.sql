-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS pls_material_unimed_update ON pls_material_unimed CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_pls_material_unimed_update() RETURNS trigger AS $BODY$
BEGIN
if (NEW.cd_cnpj <> OLD.cd_cnpj) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado o CNPJ, de ' || OLD.cd_cnpj || ', para ' || NEW.cd_cnpj || '. ',
		'CD_CNPJ',
		OLD.cd_cnpj,
		NEW.cd_cnpj);
end if;

if (NEW.cd_material <> OLD.cd_material) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado o código do material, de ' || OLD.cd_material || ', para ' || NEW.cd_material || '. ',
		'CD_MATERIAL',
		OLD.cd_material,
		NEW.cd_material);
end if;

if (NEW.cd_unidade_medida <> OLD.cd_unidade_medida) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado o código unidade de medida, de ' || OLD.cd_unidade_medida || ', para ' || NEW.cd_unidade_medida || '. ',
		'CD_UNIDADE_MEDIDA',
		OLD.cd_unidade_medida,
		NEW.cd_unidade_medida);
end if;

if (NEW.ds_apresentacao <> OLD.ds_apresentacao) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado a apresentação, de ' || OLD.ds_apresentacao || ', para ' || NEW.ds_apresentacao || '. ',
		'DS_APRESENTACAO',
		OLD.ds_apresentacao,
		NEW.ds_apresentacao);
end if;

if (NEW.ds_classe <> OLD.ds_classe) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado a classificação, de ' || OLD.ds_classe || ', para ' || NEW.ds_classe || '. ',
		'DS_CLASSE',
		OLD.ds_classe,
		NEW.ds_classe);
end if;

if (NEW.ds_classe_farmacologico <> OLD.ds_classe_farmacologico) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado a classe farmacológica, de ' || OLD.ds_classe_farmacologico || ', para ' || NEW.ds_classe_farmacologico || '. ',
		'DS_CLASSE_FARMACOLOGICO',
		OLD.ds_classe_farmacologico,
		NEW.ds_classe_farmacologico);
end if;

if (NEW.ds_especialidade <> OLD.ds_especialidade) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado a descrição da especialidade, de ' || OLD.ds_especialidade || ', para ' || NEW.ds_especialidade || '. ',
		'DS_ESPECIALIDADE',
		OLD.ds_especialidade,
		NEW.ds_especialidade);
end if;

if (NEW.ds_forma_farmaceutico <> OLD.ds_forma_farmaceutico) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado a forma farmacêutica, de ' || OLD.ds_forma_farmaceutico || ', para ' || NEW.ds_forma_farmaceutico || '. ',
		'DS_FORMA_FARMACEUTICO',
		OLD.ds_forma_farmaceutico,
		NEW.ds_forma_farmaceutico);
end if;

if (NEW.ds_grupo_farmacologico <> OLD.ds_grupo_farmacologico) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado a descrição do grupo farmacológico, de ' || OLD.ds_grupo_farmacologico || ', para ' || NEW.ds_grupo_farmacologico || '. ',
		'DS_GRUPO_FARMACOLOGICO',
		OLD.ds_grupo_farmacologico,
		NEW.ds_grupo_farmacologico);
end if;

if (NEW.ds_material <> OLD.ds_material) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado a descrição do material, de ' || OLD.ds_material || ', para ' || NEW.ds_material || '. ',
		'DS_MATERIAL',
		OLD.ds_material,
		NEW.ds_material);
end if;

if (NEW.ds_motivo_ativo_inativo <> OLD.ds_motivo_ativo_inativo) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado o motivo ativo/inativo, de ' || OLD.ds_motivo_ativo_inativo || ', para ' || NEW.ds_motivo_ativo_inativo || '. ',
		'DS_MOTIVO_ATIVO_INATIVO',
		OLD.ds_motivo_ativo_inativo,
		NEW.ds_motivo_ativo_inativo);
end if;

if (NEW.ds_principio_ativo <> OLD.ds_principio_ativo) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado a descrição do princípio ativo, de ' || OLD.ds_principio_ativo || ', para ' || NEW.ds_principio_ativo || '. ',
		'DS_PRINCIPIO_ATIVO',
		OLD.ds_principio_ativo,
		NEW.ds_principio_ativo);
end if;

if (NEW.dt_inicio_obrigatorio <> OLD.dt_inicio_obrigatorio) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado a data início obrigatório, de ' || OLD.dt_inicio_obrigatorio || ', para ' || NEW.dt_inicio_obrigatorio || '. ',
		'DT_INICIO_OBRIGATORIO',
		OLD.dt_inicio_obrigatorio,
		NEW.dt_inicio_obrigatorio);
end if;

if (NEW.dt_validade_anvisa <> OLD.dt_validade_anvisa) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado a data de válide ANVISA do material, de ' || OLD.dt_validade_anvisa || ', para ' || NEW.dt_validade_anvisa || '. ',
		'DT_VALIDADE_ANVISA',
		OLD.dt_validade_anvisa,
		NEW.dt_validade_anvisa);
end if;

if (NEW.ie_generico <> OLD.ie_generico) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado genérico, de ' || OLD.ie_generico || ', para ' || NEW.ie_generico || '. ',
		'IE_GENERICO',
		OLD.ie_generico,
		NEW.ie_generico);
end if;

if (NEW.ie_opme <> OLD.ie_opme) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado o OPME, de ' || OLD.ie_opme || ', para ' || NEW.ie_opme || '. ',
		'IE_OPME',
		OLD.ie_opme,
		NEW.ie_opme);
end if;

if (NEW.ie_origem <> OLD.ie_origem) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterada a origem, de ' || OLD.ie_origem || ', para ' || NEW.ie_origem || '. ',
		'IE_ORIGEM',
		OLD.ie_origem,
		NEW.ie_origem);
end if;

if (NEW.ie_situacao <> OLD.ie_situacao) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado a situação, de ' || OLD.ie_situacao || ', para ' || NEW.ie_situacao || '. ',
		'IE_SITUACAO',
		OLD.ie_situacao,
		NEW.ie_situacao);
end if;

if (NEW.ie_tipo <> OLD.ie_tipo) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado o tipo, de ' || OLD.ie_tipo || ', para ' || NEW.ie_tipo || '. ',
		'IE_TIPO',
		OLD.ie_tipo,
		NEW.ie_tipo);
end if;

if (NEW.nm_fabricante <> OLD.nm_fabricante) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado o nome do fabricante, de ' || OLD.nm_fabricante || ', para ' || NEW.nm_fabricante || '. ',
		'NM_FABRICANTE',
		OLD.nm_fabricante,
		NEW.nm_fabricante);
end if;

if (NEW.nm_importador <> OLD.nm_importador) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado o importador, de ' || OLD.nm_importador || ', para ' || NEW.nm_importador || '. ',
		'NM_IMPORTADOR',
		OLD.nm_importador,
		NEW.nm_importador);
end if;

if (NEW.nm_material <> OLD.nm_material) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado o nome do material, de ' || OLD.nm_material || ', para ' || NEW.nm_material || '. ',
		'NM_MATERIAL',
		OLD.nm_material,
		NEW.nm_material);
end if;

if (NEW.nr_registro_anvisa <> OLD.nr_registro_anvisa) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado o número de registro ANVISA, de ' || OLD.nr_registro_anvisa || ', para ' || NEW.nr_registro_anvisa || '. ',
		'NR_REGISTRO_ANVISA',
		OLD.nr_registro_anvisa,
		NEW.nr_registro_anvisa);
end if;

if (NEW.pr_icms <> OLD.pr_icms) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado a percentagem ICMS, de ' || OLD.pr_icms || ', para ' || NEW.pr_icms || '. ',
		'PR_ICMS',
		OLD.pr_icms,
		NEW.pr_icms);
end if;

if (NEW.vl_fabrica <> OLD.vl_fabrica) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado o valor fábrica, de ' || OLD.vl_fabrica || ', para ' || NEW.vl_fabrica || '. ',
		'VL_FABRICA',
		OLD.vl_fabrica,
		NEW.vl_fabrica);
end if;

if (NEW.vl_fator_conversao <> OLD.vl_fator_conversao) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado o fator conversão, de ' || OLD.vl_fator_conversao || ', para ' || NEW.vl_fator_conversao || '. ',
		'VL_FATOR_CONVERSAO',
		OLD.vl_fator_conversao,
		NEW.vl_fator_conversao);
end if;

if (NEW.vl_max_consumidor <> OLD.vl_max_consumidor) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado o valor máx. consumidor, de ' || OLD.vl_max_consumidor || ', para ' || NEW.vl_max_consumidor || '. ',
		'VL_MAX_CONSUMIDOR',
		OLD.vl_max_consumidor,
		NEW.vl_max_consumidor);
end if;

if (NEW.vl_pmc <> OLD.vl_pmc) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado o valor PMC, de ' || OLD.vl_pmc || ', para ' || NEW.vl_pmc || '. ',
		'VL_PMC',
		OLD.vl_pmc,
		NEW.vl_pmc);
end if;

if (NEW.cd_ref_material_fab <> OLD.cd_ref_material_fab) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado o código de referência do material no fabricante, de ' || OLD.cd_ref_material_fab || ', para ' || NEW.cd_ref_material_fab || '. ',
		'CD_REF_MATERIAL_FAB',
		OLD.cd_ref_material_fab,
		NEW.cd_ref_material_fab);
end if;

if (NEW.cd_anterior_material <> OLD.cd_anterior_material) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado o código anterior do material, de ' || OLD.cd_anterior_material || ', para ' || NEW.cd_anterior_material || '. ',
		'CD_ANTERIOR_MATERIAL',
		OLD.cd_anterior_material,
		NEW.cd_anterior_material);
end if;

if (NEW.cd_anterior_medicamento <> OLD.cd_anterior_medicamento) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado o código anterior do medicamento, de ' || OLD.cd_anterior_medicamento || ', para ' || NEW.cd_anterior_medicamento || '. ',
		'CD_ANTERIOR_MEDICAMENTO',
		OLD.cd_anterior_medicamento,
		NEW.cd_anterior_medicamento);
end if;

if (NEW.ds_unidade_medida <> OLD.ds_unidade_medida) then
	insert into	pls_material_unimed_log(nr_sequencia,
		nm_usuario,
		dt_atualizacao,
		nm_usuario_nrec,
		dt_atualizacao_nrec,
		dt_alteracao,
		nr_seq_mat_unimed,
		ds_log,
		nm_campo,
		vl_anterior,
		vl_atual)
	values (nextval('pls_material_unimed_log_seq'),
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		LOCALTIMESTAMP,
		LOCALTIMESTAMP,
		OLD.nr_sequencia,
		'Alterado a descrição unidade de medida, de ' || OLD.ds_unidade_medida || ', para ' || NEW.ds_unidade_medida || '. ',
		'DS_UNIDADE_MEDIDA',
		OLD.cd_unidade_medida,
		NEW.cd_unidade_medida);
end if;

RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_pls_material_unimed_update() FROM PUBLIC;

CREATE TRIGGER pls_material_unimed_update
	BEFORE UPDATE ON pls_material_unimed FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_pls_material_unimed_update();

