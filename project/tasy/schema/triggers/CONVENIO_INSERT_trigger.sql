-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS convenio_insert ON convenio CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_convenio_insert() RETURNS trigger AS $BODY$
DECLARE

nr_seq_convenio_estab_w		bigint;
cd_estabelecimento_w		smallint;

BEGIN

select	max(cd_estabelecimento)
into STRICT	cd_estabelecimento_w
from	Usuario
where	nm_usuario	= NEW.nm_usuario;

if (coalesce(cd_estabelecimento_w,0) > 0) then
	BEGIN

	select	nextval('convenio_estabelecimento_seq')
	into STRICT	nr_seq_convenio_estab_w
	;

	insert	into convenio_estabelecimento(nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		cd_convenio,
		cd_estabelecimento,
		ie_exige_data_ult_pagto,
		ie_exige_guia,
		ie_exige_orc_atend,
		ie_glosa_atendimento,
		ie_preco_medio_material,
		ie_agenda_consulta,
		ie_rep_cod_usuario,
		ie_exige_carteira_atend,
		ie_exige_validade_atend,
		ie_exige_plano,
		ie_separa_conta,
		ie_guia_unica_conta,
		ie_valor_contabil,
		ie_titulo_receber,
		ie_conversao_mat,
		ie_doc_convenio,
		ie_doc_retorno,
		qt_conta_protocolo,
		qt_dia_fim_conta,
		ie_exige_senha_atend,
		ie_partic_cirurgia,
		ie_exige_origem,
		cd_interno,
		cd_regional,
		ie_protocolo_conta,
		ie_gerar_nf_titulo,
		ie_cancelar_conta,
		ie_manter_zerado_edicao,
		ie_exige_fim_vigencia,
		ie_partic_resp_cred,
		ie_doc_autorizacao,
		ie_fechar_atend_adiant,
		ie_conta_fim_mes,
		ie_cgc_cih,
		ie_regra_prior_edicao,
		ie_obter_preco_mat_autor,
		ie_gerar_NF,
		ie_gera_nome_nf_convenio,
		ie_forma_geracao_nf,
		ie_titulo_sem_nf,
		ie_consiste_guia_atend,
		ie_doc_conv_part_func,
		ie_medico_cooperado,
		ie_exige_lib_bras)
	values (nr_seq_convenio_estab_w,
		LOCALTIMESTAMP,
		NEW.nm_usuario,
		NEW.cd_convenio,
		cd_estabelecimento_w,
		NEW.ie_exige_data_ult_pagto,
		NEW.ie_exige_guia,
		NEW.ie_exige_orc_atend,
		NEW.ie_glosa_atendimento,
		NEW.ie_preco_medio_material,
		NEW.ie_agenda_consulta,
		NEW.ie_rep_cod_usuario,
		NEW.ie_exige_carteira_atend,
		NEW.ie_exige_validade_atend,
		NEW.ie_exige_plano,
		NEW.ie_separa_conta,
		NEW.ie_guia_unica_conta,
		NEW.ie_valor_contabil,
		NEW.ie_titulo_receber,
		NEW.ie_conversao_mat,
		NEW.ie_doc_convenio,
		NEW.ie_doc_retorno,
		NEW.qt_conta_protocolo,
		NEW.qt_dia_fim_conta,
		NEW.ie_exige_senha_atend,
		NEW.ie_partic_cirurgia,
		NEW.ie_exige_origem,
		NEW.cd_interno,
		NEW.cd_regional,
		'T',
		'S',
		'S',
		'N',
		'N',
		'N',
		'N',
		'N',
		'N',
		'S',
		'DT',
		'N',
		'S',
		'N',
		'T',
		'S',
		'N',
		'N',
		'N',
		'N');
	end;
end if;

RETURN NEW;
END
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_convenio_insert() FROM PUBLIC;

CREATE TRIGGER convenio_insert
	AFTER INSERT ON convenio FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_convenio_insert();

