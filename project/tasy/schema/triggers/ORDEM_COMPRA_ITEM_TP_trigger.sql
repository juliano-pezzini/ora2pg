-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS ordem_compra_item_tp ON ordem_compra_item CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_ordem_compra_item_tp() RETURNS trigger AS $BODY$
DECLARE nr_seq_w bigint;ds_s_w   varchar(1);ds_c_w   varchar(1);ds_w	   varchar(1);ie_log_w varchar(1);BEGIN BEGIN ds_s_w := null;  ds_c_w:= 'NR_ORDEM_COMPRA='||to_char(OLD.NR_ORDEM_COMPRA)||'#@#@NR_ITEM_OCI='||to_char(OLD.NR_ITEM_OCI);SELECT * FROM gravar_log_alteracao(substr(OLD.VL_ULTIMA_COMPRA,1,4000), substr(NEW.VL_ULTIMA_COMPRA,1,4000), NEW.nm_usuario, nr_seq_w, 'VL_ULTIMA_COMPRA', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.VL_DIF_ULTIMA_COMPRA,1,4000), substr(NEW.VL_DIF_ULTIMA_COMPRA,1,4000), NEW.nm_usuario, nr_seq_w, 'VL_DIF_ULTIMA_COMPRA', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.PR_DIF_ULTIMA_COMPRA,1,4000), substr(NEW.PR_DIF_ULTIMA_COMPRA,1,4000), NEW.nm_usuario, nr_seq_w, 'PR_DIF_ULTIMA_COMPRA', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SERIE_MATERIAL,1,4000), substr(NEW.NR_SERIE_MATERIAL,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SERIE_MATERIAL', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_CRITERIO_RATEIO,1,4000), substr(NEW.NR_SEQ_CRITERIO_RATEIO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_CRITERIO_RATEIO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.QT_MATERIAL_ENTREGUE,1,4000), substr(NEW.QT_MATERIAL_ENTREGUE,1,4000), NEW.nm_usuario, nr_seq_w, 'QT_MATERIAL_ENTREGUE', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_LOCAL_ESTOQUE,1,4000), substr(NEW.CD_LOCAL_ESTOQUE,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_LOCAL_ESTOQUE', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.DS_OBSERVACAO,1,4000), substr(NEW.DS_OBSERVACAO,1,4000), NEW.nm_usuario, nr_seq_w, 'DS_OBSERVACAO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_MOTIVO_ALTERACAO,1,4000), substr(NEW.CD_MOTIVO_ALTERACAO,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_MOTIVO_ALTERACAO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_COT_COMPRA,1,4000), substr(NEW.NR_COT_COMPRA,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_COT_COMPRA', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_ITEM_COT_COMPRA,1,4000), substr(NEW.NR_ITEM_COT_COMPRA,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_ITEM_COT_COMPRA', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_UNIDADE_ADIC,1,4000), substr(NEW.NR_SEQ_UNIDADE_ADIC,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_UNIDADE_ADIC', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_ATUALIZACAO,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_ATUALIZACAO,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_ATUALIZACAO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_MATERIAL,1,4000), substr(NEW.CD_MATERIAL,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_MATERIAL', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.VL_ITEM_LIQUIDO,1,4000), substr(NEW.VL_ITEM_LIQUIDO,1,4000), NEW.nm_usuario, nr_seq_w, 'VL_ITEM_LIQUIDO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.DS_MARCA,1,4000), substr(NEW.DS_MARCA,1,4000), NEW.nm_usuario, nr_seq_w, 'DS_MARCA', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.QT_MATERIAL,1,4000), substr(NEW.QT_MATERIAL,1,4000), NEW.nm_usuario, nr_seq_w, 'QT_MATERIAL', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NM_USUARIO,1,4000), substr(NEW.NM_USUARIO,1,4000), NEW.nm_usuario, nr_seq_w, 'NM_USUARIO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.IE_SITUACAO,1,4000), substr(NEW.IE_SITUACAO,1,4000), NEW.nm_usuario, nr_seq_w, 'IE_SITUACAO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_PESSOA_SOLICITANTE,1,4000), substr(NEW.CD_PESSOA_SOLICITANTE,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_PESSOA_SOLICITANTE', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SOLIC_COMPRA,1,4000), substr(NEW.NR_SOLIC_COMPRA,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SOLIC_COMPRA', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_ITEM_SOLIC_COMPRA,1,4000), substr(NEW.NR_ITEM_SOLIC_COMPRA,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_ITEM_SOLIC_COMPRA', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_APROVACAO,1,4000), substr(NEW.NR_SEQ_APROVACAO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_APROVACAO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_CENTRO_CUSTO,1,4000), substr(NEW.CD_CENTRO_CUSTO,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_CENTRO_CUSTO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_ORDEM_COMPRA,1,4000), substr(NEW.NR_ORDEM_COMPRA,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_ORDEM_COMPRA', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_UNIDADE_MEDIDA_COMPRA,1,4000), substr(NEW.CD_UNIDADE_MEDIDA_COMPRA,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_UNIDADE_MEDIDA_COMPRA', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_APROVACAO,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_APROVACAO,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_APROVACAO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_CONTA_CONTABIL,1,4000), substr(NEW.CD_CONTA_CONTABIL,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_CONTA_CONTABIL', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_ITEM_OCI,1,4000), substr(NEW.NR_ITEM_OCI,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_ITEM_OCI', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.PR_DESCONTOS,1,4000), substr(NEW.PR_DESCONTOS,1,4000), NEW.nm_usuario, nr_seq_w, 'PR_DESCONTOS', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.VL_UNITARIO_MATERIAL,1,4000), substr(NEW.VL_UNITARIO_MATERIAL,1,4000), NEW.nm_usuario, nr_seq_w, 'VL_UNITARIO_MATERIAL', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.IE_GERACAO_SOLIC,1,4000), substr(NEW.IE_GERACAO_SOLIC,1,4000), NEW.nm_usuario, nr_seq_w, 'IE_GERACAO_SOLIC', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_CONTA_FINANC,1,4000), substr(NEW.NR_SEQ_CONTA_FINANC,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_CONTA_FINANC', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_PROJ_REC,1,4000), substr(NEW.NR_SEQ_PROJ_REC,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_PROJ_REC', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_LIC_ITEM,1,4000), substr(NEW.NR_SEQ_LIC_ITEM,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_LIC_ITEM', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.PR_DESC_FINANC,1,4000), substr(NEW.PR_DESC_FINANC,1,4000), NEW.nm_usuario, nr_seq_w, 'PR_DESC_FINANC', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.QT_ORIGINAL,1,4000), substr(NEW.QT_ORIGINAL,1,4000), NEW.nm_usuario, nr_seq_w, 'QT_ORIGINAL', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_REPROVACAO,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_REPROVACAO,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_REPROVACAO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_VALIDADE,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_VALIDADE,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_VALIDADE', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.DS_MATERIAL_DIRETO,1,4000), substr(NEW.DS_MATERIAL_DIRETO,1,4000), NEW.nm_usuario, nr_seq_w, 'DS_MATERIAL_DIRETO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_MARCA,1,4000), substr(NEW.NR_SEQ_MARCA,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_MARCA', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.VL_TOTAL_ITEM,1,4000), substr(NEW.VL_TOTAL_ITEM,1,4000), NEW.nm_usuario, nr_seq_w, 'VL_TOTAL_ITEM', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.VL_DESCONTO,1,4000), substr(NEW.VL_DESCONTO,1,4000), NEW.nm_usuario, nr_seq_w, 'VL_DESCONTO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_APROVACAO_ORIG,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_APROVACAO_ORIG,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_APROVACAO_ORIG', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_REPROVACAO_ORIG,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_REPROVACAO_ORIG,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_REPROVACAO_ORIG', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SOLIC_COMPRA_CANCEL,1,4000), substr(NEW.NR_SOLIC_COMPRA_CANCEL,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SOLIC_COMPRA_CANCEL', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_ORDEM_SERV,1,4000), substr(NEW.NR_SEQ_ORDEM_SERV,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_ORDEM_SERV', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_LOTE_FORNEC,1,4000), substr(NEW.NR_SEQ_LOTE_FORNEC,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_LOTE_FORNEC', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_CONTRATO,1,4000), substr(NEW.NR_CONTRATO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_CONTRATO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_PROJ_GPI,1,4000), substr(NEW.NR_SEQ_PROJ_GPI,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_PROJ_GPI', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_ETAPA_GPI,1,4000), substr(NEW.NR_SEQ_ETAPA_GPI,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_ETAPA_GPI', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_CONTA_GPI,1,4000), substr(NEW.NR_SEQ_CONTA_GPI,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_CONTA_GPI', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_FIM_GARANTIA,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_FIM_GARANTIA,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_FIM_GARANTIA', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_INICIO_GARANTIA,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_INICIO_GARANTIA,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_INICIO_GARANTIA', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_REG_LIC_ITEM,1,4000), substr(NEW.NR_SEQ_REG_LIC_ITEM,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_REG_LIC_ITEM', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_ID_INTEGRACAO,1,4000), substr(NEW.NR_ID_INTEGRACAO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_ID_INTEGRACAO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_CONTA_BCO,1,4000), substr(NEW.NR_SEQ_CONTA_BCO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_CONTA_BCO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_EMPENHO,1,4000), substr(NEW.NR_EMPENHO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_EMPENHO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_PRESCR_ITEM,1,4000), substr(NEW.NR_SEQ_PRESCR_ITEM,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_PRESCR_ITEM', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_EMPENHO,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_EMPENHO,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_EMPENHO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_ORDEM_AGRUP,1,4000), substr(NEW.NR_ORDEM_AGRUP,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_ORDEM_AGRUP', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.VL_UNIT_MAT_ORIGINAL,1,4000), substr(NEW.VL_UNIT_MAT_ORIGINAL,1,4000), NEW.nm_usuario, nr_seq_w, 'VL_UNIT_MAT_ORIGINAL', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_ORC_ITEM_GPI,1,4000), substr(NEW.NR_SEQ_ORC_ITEM_GPI,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_ORC_ITEM_GPI', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_ATENDIMENTO,1,4000), substr(NEW.NR_ATENDIMENTO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_ATENDIMENTO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.QT_DIAS_GARANTIA,1,4000), substr(NEW.QT_DIAS_GARANTIA,1,4000), NEW.nm_usuario, nr_seq_w, 'QT_DIAS_GARANTIA', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_LIB_ESTRUT_PJ,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_LIB_ESTRUT_PJ,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_LIB_ESTRUT_PJ', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.DS_JUSTIFICATIVA_LIB,1,4000), substr(NEW.DS_JUSTIFICATIVA_LIB,1,4000), NEW.nm_usuario, nr_seq_w, 'DS_JUSTIFICATIVA_LIB', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NM_USUARIO_LIB,1,4000), substr(NEW.NM_USUARIO_LIB,1,4000), NEW.nm_usuario, nr_seq_w, 'NM_USUARIO_LIB', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_DESDOBR_APROV,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_DESDOBR_APROV,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_DESDOBR_APROV', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_NATUREZA_OPERACAO,1,4000), substr(NEW.CD_NATUREZA_OPERACAO,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_NATUREZA_OPERACAO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.CD_OPERACAO_NF,1,4000), substr(NEW.CD_OPERACAO_NF,1,4000), NEW.nm_usuario, nr_seq_w, 'CD_OPERACAO_NF', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_PENDENCIA_TRANSF,1,4000), substr(NEW.NR_SEQ_PENDENCIA_TRANSF,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_PENDENCIA_TRANSF', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.IE_MOTIVO_REPROVACAO,1,4000), substr(NEW.IE_MOTIVO_REPROVACAO,1,4000), NEW.nm_usuario, nr_seq_w, 'IE_MOTIVO_REPROVACAO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.DS_JUSTIFICATIVA_REPROV,1,4000), substr(NEW.DS_JUSTIFICATIVA_REPROV,1,4000), NEW.nm_usuario, nr_seq_w, 'DS_JUSTIFICATIVA_REPROV', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_PRECO_PJ,1,4000), substr(NEW.NR_SEQ_PRECO_PJ,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_PRECO_PJ', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.DS_OBS_ITEM_FORN,1,4000), substr(NEW.DS_OBS_ITEM_FORN,1,4000), NEW.nm_usuario, nr_seq_w, 'DS_OBS_ITEM_FORN', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.DS_JUSTIF_DIVER,1,4000), substr(NEW.DS_JUSTIF_DIVER,1,4000), NEW.nm_usuario, nr_seq_w, 'DS_JUSTIF_DIVER', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_REGRA_CONTRATO,1,4000), substr(NEW.NR_SEQ_REGRA_CONTRATO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_REGRA_CONTRATO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_AGRUP,1,4000), substr(NEW.NR_SEQ_AGRUP,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_AGRUP', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.DS_LOTE,1,4000), substr(NEW.DS_LOTE,1,4000), NEW.nm_usuario, nr_seq_w, 'DS_LOTE', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_DOCUMENTO_EXTERNO,1,4000), substr(NEW.NR_DOCUMENTO_EXTERNO,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_DOCUMENTO_EXTERNO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(to_char(OLD.DT_LIB_CONFERENCIA,'dd/mm/yyyy hh24:mi:ss'), to_char(NEW.DT_LIB_CONFERENCIA,'dd/mm/yyyy hh24:mi:ss'), NEW.nm_usuario, nr_seq_w, 'DT_LIB_CONFERENCIA', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.IE_SERVICO_REALIZADO,1,4000), substr(NEW.IE_SERVICO_REALIZADO,1,4000), NEW.nm_usuario, nr_seq_w, 'IE_SERVICO_REALIZADO', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_PROC_APROV,1,4000), substr(NEW.NR_SEQ_PROC_APROV,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_PROC_APROV', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_MATPACI,1,4000), substr(NEW.NR_SEQ_MATPACI,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_MATPACI', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_ORDEM_PROD,1,4000), substr(NEW.NR_SEQ_ORDEM_PROD,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_ORDEM_PROD', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.DS_MARCA_FORNEC,1,4000), substr(NEW.DS_MARCA_FORNEC,1,4000), NEW.nm_usuario, nr_seq_w, 'DS_MARCA_FORNEC', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w; SELECT * FROM gravar_log_alteracao(substr(OLD.NR_SEQ_REG_PCS,1,4000), substr(NEW.NR_SEQ_REG_PCS,1,4000), NEW.nm_usuario, nr_seq_w, 'NR_SEQ_REG_PCS', ie_log_w, ds_w, 'ORDEM_COMPRA_ITEM', ds_s_w, ds_c_w) INTO STRICT nr_seq_w, ie_log_w;   exception when others then ds_w:= '1'; end;   END;
RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_ordem_compra_item_tp() FROM PUBLIC;

CREATE TRIGGER ordem_compra_item_tp
	AFTER UPDATE ON ordem_compra_item FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_ordem_compra_item_tp();

