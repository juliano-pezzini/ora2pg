-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS dic_objeto_filtr_grupo_atual ON dic_objeto_filtro_grupo CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_dic_objeto_filtr_grupo_atual() RETURNS trigger AS $BODY$
declare
	ds_expressao_br_w		DIC_EXPRESSAO.ds_expressao_br%type;
	cd_expressao_w			DIC_EXPRESSAO.cd_expressao%type;
	nm_coluna_desc_w		varchar(50);
	nm_coluna_exp_w			varchar(50);
BEGIN
  BEGIN
    BEGIN
	if (NEW.cd_exp_titulo is not null or
		 OLD.cd_exp_titulo is not null) then

		nm_coluna_desc_w	:= 'NM_TITULO';
		nm_coluna_exp_w		:= 'CD_EXP_TITULO';
		cd_expressao_w		:= NEW.cd_exp_titulo;
		ds_expressao_br_w	:= obter_desc_expressao_br(cd_expressao_w);
		NEW.nm_titulo		:= ds_expressao_br_w;
	end if;
	exception when others then
		-- Caso a expressao nao couber no campo, avisa usu√°rio
		if (SQLSTATE = -6502) then
			CALL wheb_mensagem_pck.exibir_mensagem_abort(290787, 'CD_EXPRESSAO_P='||cd_expressao_w||
									';DS_ATRIBUTO_P='||nm_coluna_desc_w||
									';NM_ATRIBUTO_EXP_P='||nm_coluna_exp_w);
		end if;
	end;

  END;
RETURN NEW;
END
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_dic_objeto_filtr_grupo_atual() FROM PUBLIC;

CREATE TRIGGER dic_objeto_filtr_grupo_atual
	BEFORE INSERT OR UPDATE ON dic_objeto_filtro_grupo FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_dic_objeto_filtr_grupo_atual();

