-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS contrato_regra_pagto_update ON contrato_regra_pagto CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_contrato_regra_pagto_update() RETURNS trigger AS $BODY$
DECLARE
nr_sequencia_w		bigint;

BEGIN
select nextval('contrato_regra_hist_seq')
into STRICT nr_sequencia_w;

insert into Contrato_Regra_Hist(nr_sequencia,
	nr_seq_regra,
	dt_atualizacao,
	nm_usuario,
	ie_forma,
	dt_primeiro_vencto,
	ie_tipo_valor,
	vl_pagto,
	cd_moeda,
	cd_indice_reajuste,
	ie_periodo_reajuste,
	dt_historico,
	dt_inicio_vigencia,
	dt_final_vigencia,
	qt_indice_reajuste,
	ds_ref_indice_reajuste,
	ds_regra_vencimento,
	ds_observacao)
values (nr_sequencia_w,
	OLD.nr_sequencia,
	LOCALTIMESTAMP,
	OLD.nm_usuario,
	OLD.ie_forma,
	OLD.dt_primeiro_vencto,
	OLD.ie_tipo_valor,
	OLD.vl_pagto,
	OLD.cd_moeda,
	OLD.cd_indice_reajuste,
	OLD.ie_periodo_reajuste,
	OLD.dt_atualizacao,
	OLD.dt_inicio_vigencia,
	OLD.dt_final_vigencia,
	OLD.qt_indice_reajuste,
	OLD.ds_ref_indice_reajuste,
	OLD.ds_regra_vencimento,
	OLD.ds_observacao);

RETURN NEW;
END
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_contrato_regra_pagto_update() FROM PUBLIC;

CREATE TRIGGER contrato_regra_pagto_update
	BEFORE UPDATE ON contrato_regra_pagto FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_contrato_regra_pagto_update();

