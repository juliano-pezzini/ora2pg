-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS pls_prot_conta_titulo_update ON pls_prot_conta_titulo CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_pls_prot_conta_titulo_update() RETURNS trigger AS $BODY$
declare
ds_tabela_alterada_w	varchar(255);

BEGIN

if (OLD.nr_nota_fiscal is not null) and (OLD.nr_nota_fiscal <> NEW.nr_nota_fiscal) then
	ds_tabela_alterada_w	:= ds_tabela_alterada_w || ' Nota FÃ­scal: de ' ||OLD.nr_nota_fiscal || ' para ' || NEW.nr_nota_fiscal;
end if;

if (OLD.vl_titulo is not null) and (OLD.vl_titulo <> NEW.vl_titulo) then
	ds_tabela_alterada_w	:= ds_tabela_alterada_w || ' Valor Titulo: de ' || OLD.vl_titulo || ' para ' || NEW.vl_titulo;
end if;

if (OLD.nr_seq_prestador is not null) and (OLD.nr_seq_prestador <> NEW.nr_seq_prestador) then
	ds_tabela_alterada_w	:= ds_tabela_alterada_w || ' Prestador: de ' ||OLD.nr_seq_prestador || ' para ' || NEW.nr_seq_prestador;
end if;

if (OLD.dt_pagamento is not null) and (OLD.dt_pagamento <> NEW.dt_pagamento) then
	ds_tabela_alterada_w	:= ds_tabela_alterada_w || ' Pagador: de ' ||OLD.dt_pagamento || ' para ' || NEW.dt_pagamento;
end if;

if (OLD.nr_seq_lote is not null) and (OLD.nr_seq_lote <> NEW.nr_seq_lote) then
	ds_tabela_alterada_w	:= ds_tabela_alterada_w || ' Lote: de ' || OLD.nr_seq_lote || ' para ' || NEW.nr_seq_lote;
end if;

/*if	(ds_tabela_alterada_w is not null) then
	insert into logxxxxx_tasy
		(dt_atualizacao, nm_usuario, cd_log, ds_log)
	values	(sysdate, :new.nm_usuario, 1208, ds_tabela_alterada_w);
end if;*/
RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_pls_prot_conta_titulo_update() FROM PUBLIC;

CREATE TRIGGER pls_prot_conta_titulo_update
	AFTER UPDATE ON pls_prot_conta_titulo FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_pls_prot_conta_titulo_update();

