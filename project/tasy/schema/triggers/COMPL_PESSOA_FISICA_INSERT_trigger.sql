-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

DROP TRIGGER IF EXISTS compl_pessoa_fisica_insert ON compl_pessoa_fisica CASCADE;
CREATE OR REPLACE FUNCTION trigger_fct_compl_pessoa_fisica_insert() RETURNS trigger AS $BODY$
DECLARE

BEGIN
if (wheb_usuario_pck.get_ie_executar_trigger = 'S')  then
	if (OLD.nm_usuario is not null) then
		insert into compl_pessoa_fisica_hist(	nr_sequencia,
				dt_atualizacao,
				nm_usuario,
				dt_atualizacao_nrec,
				nm_usuario_nrec,
				cd_pessoa_fisica,
				ie_tipo_complemento,
				ds_endereco,
				cd_cep,
				nr_endereco,
				ds_complemento,
				ds_bairro,
				ds_municipio,
				sg_estado,
				cd_municipio_ibge,
				nr_seq_pais,
				cd_tipo_logradouro,
				nm_contato,
				nr_telefone,
				nr_ramal,
				ds_observacao,
				ds_email,
				cd_empresa_refer,
				cd_profissao,
				nr_identidade,
				nr_cpf,
				ds_setor_trabalho,
				ds_horario_trabalho,

				ds_website,
				nr_matricula_trabalho,
				ds_fone_adic,
				ds_fax,
				nr_seq_parentesco,
				cd_pessoa_fisica_ref,
				nr_ddd_telefone,
				nr_ddi_telefone,
				nr_ddi_fax,
				nr_ddd_fax,
				nm_contato_pesquisa,
				qt_dependente,
				ds_fonetica,
				ie_nf_correio,
				cd_zona_procedencia,
				ie_obriga_email,
				nr_seq_ident_cnes,
				ie_mala_direta,
				ie_fator_rh,
				ie_tipo_sangue,
				nr_seq_local_atend_med,
				cd_pessoa_end_ref,
				nr_seq_end_ref,
				ie_empresa_pagadora,
				nr_seq_regiao,
				ie_correspondencia,
				nr_ddi_fone_adic,
				nr_ddd_fone_adic)
		values (	nextval('compl_pessoa_fisica_hist_seq'),
				LOCALTIMESTAMP,
				coalesce(NEW.nm_usuario,OLD.nm_usuario),
				LOCALTIMESTAMP,
				OLD.nm_usuario_nrec,
				OLD.cd_pessoa_fisica,
				OLD.ie_tipo_complemento,
				OLD.ds_endereco,
				OLD.cd_cep,
				OLD.nr_endereco,
				OLD.ds_complemento,
				OLD.ds_bairro,
				OLD.ds_municipio,
				OLD.sg_estado,
				OLD.cd_municipio_ibge,
				OLD.nr_seq_pais,
				OLD.cd_tipo_logradouro,
				OLD.nm_contato,
				OLD.nr_telefone,
				OLD.nr_ramal,
				OLD.ds_observacao,
				OLD.ds_email,
				OLD.cd_empresa_refer,
				OLD.cd_profissao,
				OLD.nr_identidade,
				OLD.nr_cpf,
				OLD.ds_setor_trabalho,
				OLD.ds_horario_trabalho,
				OLD.ds_website,
				OLD.nr_matricula_trabalho,
				OLD.ds_fone_adic,
				OLD.ds_fax,
				OLD.nr_seq_parentesco,
				OLD.cd_pessoa_fisica_ref,
				OLD.nr_ddd_telefone,
				OLD.nr_ddi_telefone,
				OLD.nr_ddi_fax,
				OLD.nr_ddd_fax,
				OLD.nm_contato_pesquisa,
				OLD.qt_dependente,
				OLD.ds_fonetica,
				OLD.ie_nf_correio,
				OLD.cd_zona_procedencia,
				OLD.ie_obriga_email,
				OLD.nr_seq_ident_cnes,
				OLD.ie_mala_direta,
				OLD.ie_fator_rh,
				OLD.ie_tipo_sangue,
				OLD.nr_seq_local_atend_med,
				OLD.cd_pessoa_end_ref,
				OLD.nr_seq_end_ref,
				OLD.ie_empresa_pagadora,
				OLD.nr_seq_regiao,
				OLD.ie_correspondencia,
				OLD.nr_ddi_fone_adic,
				OLD.nr_ddd_fone_adic);
	end if;
end if;

/* Projeto MXM (7077)  - Exportar cadastro pessoa fisica */

if (NEW.sg_estado is not null and NEW.ie_tipo_complemento = 1) then
	CALL gravar_agend_integracao(556,'CD_PESSOA_FISICA='||NEW.cd_pessoa_fisica||';CD_PESSOA_JURIDICA='||null||';'); --Fornecedor
	CALL gravar_agend_integracao(562,'CD_PESSOA_FISICA='||NEW.cd_pessoa_fisica||';'); --Cliente
end if;


RETURN NEW;
end
$BODY$
 LANGUAGE 'plpgsql' SECURITY DEFINER;
-- REVOKE ALL ON FUNCTION trigger_fct_compl_pessoa_fisica_insert() FROM PUBLIC;

CREATE TRIGGER compl_pessoa_fisica_insert
	AFTER INSERT OR UPDATE ON compl_pessoa_fisica FOR EACH ROW
	EXECUTE PROCEDURE trigger_fct_compl_pessoa_fisica_insert();

