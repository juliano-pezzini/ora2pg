-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW tiss_identificacao_transacao_v (ds_versao, ds_tipo_transacao, nr_sequencia, dt_transacao, nr_sequencia_autor, nr_seq_protocolo, nr_seq_med_prot, nr_seq_retorno, nr_seq_prot_situacao, nr_seq_prot_cancel, nr_protocolo_receb, nr_seq_lote_anexo, nr_seq_pedido_exame_ext, nr_seq_rec_glosa_prot_cancel, nr_seq_tiss_env_doc) AS select	'2.01.01' ds_versao,
	CASE WHEN b.ie_interno='70' THEN  'CANCELA_GUIA'  ELSE 'AUTORIZACAO_PROCEDIMENTOS' END 		ds_tipo_transacao,
	a.nr_sequencia	 	nr_sequencia,
	LOCALTIMESTAMP 		dt_transacao,
	a.nr_sequencia 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	(null)::numeric  		NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,
	null			nr_protocolo_receb,
	(null)::numeric 		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric      	nr_seq_tiss_env_doc
FROM	estagio_autorizacao b,
	autorizacao_convenio a
where	a.nr_seq_estagio	= b.nr_sequencia

union

select	'2.01.01' ds_versao,
	'ENVIO_LOTE_GUIAS' 		ds_tipo_transacao,
	nr_seq_protocolo 		nr_sequencia,
	CASE WHEN coalesce(b.ie_data_trans_xml,'E')='E' THEN			coalesce(dt_envio,LOCALTIMESTAMP)  ELSE coalesce(a.dt_mesano_referencia,LOCALTIMESTAMP) END  dt_transacao,
	(null)::numeric 		nr_sequencia_autor,
	nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	(null)::numeric  		NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,	
	null			nr_protocolo_receb,
	(null)::numeric 		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric      	nr_seq_tiss_env_doc
from	protocolo_convenio a,
	tiss_parametros_convenio b
where	a.cd_convenio		= b.cd_Convenio
and	a.cd_estabelecimento	= b.cd_estabelecimento

union

select	'2.01.01' ds_versao,
	'ENVIO_LOTE_GUIAS' 		ds_tipo_transacao,
	NR_SEQUENCIA	 		nr_sequencia,
	coalesce(dt_envio,LOCALTIMESTAMP)	dt_transacao,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	NR_SEQUENCIA			nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	(null)::numeric  		NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,	
	null			nr_protocolo_receb,
	(null)::numeric 		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric      	nr_seq_tiss_env_doc
from	med_prot_convenio

union

select	'2.01.01' ds_versao,
	'SOLIC_DEMONSTRATIVO_RETORNO'  ds_tipo_transacao,
	nr_sequencia	 		nr_sequencia,
	LOCALTIMESTAMP			dt_transacao,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	nr_sequencia			nr_seq_retorno,
	(null)::numeric  		NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,	
	null			nr_protocolo_receb,
	(null)::numeric 		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric      	nr_seq_tiss_env_doc
from	convenio_retorno

union

select	'2.01.01' ds_versao,
	'SOLIC_STATUS_PROTOCOLO' 		ds_tipo_transacao,
	nr_seq_protocolo 		nr_sequencia,
	coalesce(dt_envio,LOCALTIMESTAMP)	dt_transacao,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	nr_seq_protocolo 		NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,	
	null			nr_protocolo_receb,
	(null)::numeric 		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric      	nr_seq_tiss_env_doc
from	protocolo_convenio

union

select	'2.01.01' ds_versao,
	'CANCELA_GUIA' 		ds_tipo_transacao,
	nr_seq_protocolo 		nr_sequencia,
	coalesce(dt_envio,LOCALTIMESTAMP)	dt_transacao,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	(null)::numeric 	 	NR_SEQ_PROT_SITUACAO,
	nr_seq_protocolo 	NR_SEQ_PROT_CANCEL,
	null			nr_protocolo_receb,
	(null)::numeric 		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric      	nr_seq_tiss_env_doc
from	protocolo_convenio

union

select	'2.01.02' ds_versao,
	tiss_obter_tipo_transacao(a.nr_sequencia,b.ie_interno) ds_tipo_transacao,
	a.nr_sequencia	 	nr_sequencia,
	LOCALTIMESTAMP 		dt_transacao,
	a.nr_sequencia 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	(null)::numeric  		NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,	
	null			nr_protocolo_receb,
	(null)::numeric 		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric      	nr_seq_tiss_env_doc
from	estagio_autorizacao b,
	autorizacao_convenio a
where	a.nr_seq_estagio	= b.nr_sequencia

union

select	'2.01.02' ds_versao,
	'ENVIO_LOTE_GUIAS' 		ds_tipo_transacao,
	nr_seq_protocolo 		nr_sequencia,
	coalesce(dt_envio,LOCALTIMESTAMP)	dt_transacao,
	(null)::numeric 		nr_sequencia_autor,
	nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	(null)::numeric  		NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,	
	null			nr_protocolo_receb,
	(null)::numeric 		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric      	nr_seq_tiss_env_doc
from	protocolo_convenio

union

select	'2.01.02' ds_versao,
	'ENVIO_LOTE_GUIAS' 		ds_tipo_transacao,
	NR_SEQUENCIA	 		nr_sequencia,
	coalesce(dt_envio,LOCALTIMESTAMP)	dt_transacao,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	NR_SEQUENCIA			nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	(null)::numeric  		NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,	
	null			nr_protocolo_receb,
	(null)::numeric 		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric      	nr_seq_tiss_env_doc
from	med_prot_convenio

union

select	'2.01.02' ds_versao,
	'SOLIC_DEMONSTRATIVO_RETORNO'  ds_tipo_transacao,
	nr_sequencia	 		nr_sequencia,
	LOCALTIMESTAMP			dt_transacao,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	nr_sequencia			nr_seq_retorno,
	(null)::numeric  		NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,	
	null		nr_protocolo_receb,
	(null)::numeric 		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric      	nr_seq_tiss_env_doc
from	convenio_retorno

union

select	'2.01.02' ds_versao,
	'SOLIC_STATUS_PROTOCOLO'  ds_tipo_transacao,
	nr_seq_protocolo 	nr_sequencia,
	coalesce(dt_envio,LOCALTIMESTAMP)	dt_transacao,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	nr_seq_protocolo 	NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,	
	null			nr_protocolo_receb,
	(null)::numeric 		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric      	nr_seq_tiss_env_doc
from	protocolo_convenio

union

select	'2.01.02' ds_versao,
	'SOLIC_STATUS_PROTOCOLO' 		ds_tipo_transacao,
	nr_seq_protocolo	nr_sequencia,
	LOCALTIMESTAMP			dt_transacao,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	(null)::numeric  	NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,	
	nr_sequencia		nr_protocolo_receb,
	(null)::numeric 		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric      	nr_seq_tiss_env_doc
from	tiss_protocolo_envio_ret

union

select	'3.00.01' ds_versao,
	'ENVIO_ANEXO' 		ds_tipo_transacao,
	nr_sequencia		nr_sequencia,
	LOCALTIMESTAMP			dt_transacao,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	(null)::numeric  	NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,	
	(null)::numeric 		nr_protocolo_receb,
	nr_sequencia		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric      	nr_seq_tiss_env_doc
from	tiss_anexo_lote

union

select	'3.01.00' ds_versao,
	'ENVIO_ANEXO' 		ds_tipo_transacao,
	nr_sequencia		nr_sequencia,
	LOCALTIMESTAMP			dt_transacao,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	(null)::numeric  	NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,	
	(null)::numeric 		nr_protocolo_receb,
	nr_sequencia		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric      	nr_seq_tiss_env_doc
from	tiss_anexo_lote

union

select	'3.02.00' ds_versao,
	'ENVIO_ANEXO' 		ds_tipo_transacao,
	nr_sequencia		nr_sequencia,
	LOCALTIMESTAMP			dt_transacao,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	(null)::numeric  	NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,	
	(null)::numeric 		nr_protocolo_receb,
	nr_sequencia		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric      	nr_seq_tiss_env_doc
from	tiss_anexo_lote

union

select	'3.02.01' ds_versao,
	'ENVIO_ANEXO' 		ds_tipo_transacao,
	nr_sequencia		nr_sequencia,
	LOCALTIMESTAMP			dt_transacao,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	(null)::numeric  	NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,	
	(null)::numeric 		nr_protocolo_receb,
	nr_sequencia		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric      	nr_seq_tiss_env_doc
from	tiss_anexo_lote

union

select	'3.02.02' ds_versao,
	'ENVIO_ANEXO' 		ds_tipo_transacao,
	nr_sequencia		nr_sequencia,
	LOCALTIMESTAMP			dt_transacao,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	(null)::numeric  		NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,	
	(null)::numeric 		nr_protocolo_receb,
	nr_sequencia		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric      	nr_seq_tiss_env_doc
from	tiss_anexo_lote

union

select	'3.03.00' ds_versao,
	'ENVIO_ANEXO' 		ds_tipo_transacao,
	nr_sequencia		nr_sequencia,
	LOCALTIMESTAMP			dt_transacao,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	(null)::numeric  		NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,	
	(null)::numeric 		nr_protocolo_receb,
	nr_sequencia		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric      	nr_seq_tiss_env_doc
from	tiss_anexo_lote

union

select	'3.03.01' ds_versao,
	'ENVIO_ANEXO' 		ds_tipo_transacao,
	nr_sequencia		nr_sequencia,
	LOCALTIMESTAMP			dt_transacao,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	(null)::numeric  		NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,	
	(null)::numeric 		nr_protocolo_receb,
	nr_sequencia		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric      	nr_seq_tiss_env_doc
from	tiss_anexo_lote

union

select	'3.03.02' ds_versao,
	'ENVIO_ANEXO' 		ds_tipo_transacao,
	nr_sequencia		nr_sequencia,
	LOCALTIMESTAMP			dt_transacao,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	(null)::numeric  		NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,	
	(null)::numeric 		nr_protocolo_receb,
	nr_sequencia		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric      	nr_seq_tiss_env_doc
from	tiss_anexo_lote

union

select	'3.03.02' ds_versao,
	'SOLICITACAO_PROCEDIMENTOS' ds_tipo_transacao,
	nr_sequencia		nr_sequencia,
	DT_SOLICITACAO		dt_transacao,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	(null)::numeric  		NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,	
	(null)::numeric 		nr_protocolo_receb,
	(null)::numeric 		nr_seq_lote_anexo,
	NR_SEQUENCIA		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric      	nr_seq_tiss_env_doc
from	PEDIDO_EXAME_EXTERNO

union

select	'3.03.02' ds_versao,
	'CANCELA_GUIA' 		ds_tipo_transacao,
	nr_sequencia		nr_sequencia,
	LOCALTIMESTAMP			dt_transacao,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	(null)::numeric  		NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,	
	(null)::numeric 		nr_protocolo_receb,
	(null)::numeric 		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	nr_sequencia		nr_seq_rec_glosa_prot_cancel,
	(null)::numeric          nr_seq_tiss_env_doc
from	TISS_RECURSO_GLOSA_PROT
where 	dt_cancelamento is null

union

select	'3.03.02' ds_versao,
	'ENVIO_DOCUMENTO' 		ds_tipo_transacao,
	nr_sequencia		nr_sequencia,
	LOCALTIMESTAMP				dt_transacao,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	(null)::numeric  		NR_SEQ_PROT_SITUACAO,
	(null)::numeric  		NR_SEQ_PROT_CANCEL,	
	(null)::numeric 		nr_protocolo_receb,
	(null)::numeric 		nr_seq_lote_anexo,
	(null)::numeric 		NR_SEQ_PEDIDO_EXAME_EXT,
	(null)::numeric 		nr_seq_rec_glosa_prot_cancel,
	nr_sequencia        	nr_seq_tiss_env_doc
from	TISS_ENVIO_DOCUMENTO;

