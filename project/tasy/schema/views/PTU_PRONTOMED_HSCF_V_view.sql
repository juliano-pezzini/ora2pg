-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ptu_prontomed_hscf_v (tp_registro, nr_seq_lote, nm_hospital, dt_atual, hr_atual, nr_carteira_tit, nr_carteira_dep, nm_beneficiario, dt_nascimento, ds_endereco, nr_endereco, ds_complemento, ds_bairro, ds_municipio, sg_estado, cd_cep, nr_telefone_res, nr_telefone_com, ie_situacao, dt_situacao, ie_pessoa_fisica, ie_receber_atend, vl_repasse) AS select	1					tp_registro,
	a.nr_sequencia				nr_seq_lote,
	'SANTAMED - SERVIÇOS MÉDICOS E HOSPITALARES LTDA             ' nm_hospital,
	to_char(LOCALTIMESTAMP, 'ddmmyyyy') || ' ' 	dt_atual,
	to_char(LOCALTIMESTAMP, 'hh24mi')		hr_atual,
	null					nr_carteira_tit,
	null					nr_carteira_dep,
	null					nm_beneficiario,
	null					dt_nascimento,
	null					ds_endereco,
	null					nr_endereco,
	null					ds_complemento,
	null					ds_bairro,
	null					ds_municipio,
	null					sg_estado,
	null					cd_cep,
	null					nr_telefone_res,
	null					nr_telefone_com,
	null					ie_situacao,
	null					dt_situacao,
	null					ie_pessoa_fisica,
	null					ie_receber_atend,
	null					vl_repasse
FROM	ptu_mov_produto_lote		a

union all

select	2					tp_registro,
	f.nr_sequencia				nr_seq_lote,
	null					nm_hospital,
	null					dt_atual,
	null					hr_atual,
	substr(c.cd_titular_plano, 1, 35)	nr_carteira_tit,
	substr(c.cd_usuario_plano, 1, 35)	nr_carteira_dep,
	substr(upper(c.nm_beneficiario), 1, 45)	nm_beneficiario,
	to_char(c.dt_nascimento, 'ddmmyyyy')	dt_nascimento,
	substr(upper(a.ds_endereco), 1, 50)	ds_endereco,
      (	select	x.nr_endereco
	from	compl_pessoa_fisica	x
	where	x.cd_pessoa_fisica	= c.cd_pessoa_fisica
	and	x.ie_tipo_complemento	= 1)	nr_endereco,
	upper(a.ds_complemento)			ds_complemento,
	upper(a.ds_bairro)			ds_bairro,
	upper(a.nm_municipio)			ds_municipio,
	a.sg_uf					sg_estado,
	substr(a.cd_cep,1,2) || '.' ||
	substr(a.cd_cep,3,3) || '-' ||
	substr(a.cd_cep,6,3)			cd_cep,
	a.nr_ddd || a.nr_fone			nr_telefone_res,
	' '				 	nr_telefone_com,
	c.ie_tipo_movimento				ie_situacao,
	to_char(c.dt_repasse, 'ddmmyyyy')	dt_situacao,
	'F'					ie_pessoa_fisica,
	'S'					ie_receber_atend,
	obter_Valor_sem_virgula(c.vl_mensalidade)	vl_repasse
from	ptu_movimento_benef_compl	a,
	ptu_mov_produto_benef		c,
	ptu_mov_produto_empresa		d,
	ptu_movimentacao_produto	e,
	ptu_mov_produto_lote		f
where	a.nr_seq_beneficiario	= c.nr_sequencia
and	c.nr_seq_empresa	= d.nr_sequencia
and	d.nr_seq_mov_produto	= e.nr_sequencia
and	e.nr_seq_lote		= f.nr_sequencia
order by	nm_hospital, nm_beneficiario;

