-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW nota_interf_efph_v (tp_registro, ds_registro, cd_cnpj, nr_inscricao_estadual, cd_estabelecimento, dt_entrada_saida, ds_especie, cd_serie_nf, nr_nota_fiscal, cd_natureza_operacao, cd_operacao_nf, cd_historico, ds_observacao, cd_modelo_nf, cd_frete, cd_saida_exp, ie_situacao, cd_subcodigo_fiscal, ie_nf_entrada, ie_fora_municipio, ie_bens_terceiro, cd_atividade, tp_nf_servico, ie_doc_eletronico, nr_seq_nf, dt_emissao, nr_sequencia, sg_estado, ds_municipio_origem, cd_agrupamento, vl_contabil, vl_frete, vl_seguro, vl_despesa_acessoria, vl_descontos, vl_funrural, vl_base_icms, vl_icms_retido, cd_antecip_icms, ie_tipo_icms, vl_contabil1, vl_contabil2, vl_contabil3, vl_contabil4, vl_contabil5, vl_pis, vl_cred_ativo, vl_ressarc_trib, vl_transf_credito, vl_compl_nf, vl_nao_tributado, cd_centro_custo_debito, cd_centro_custo_credito, vl_base_irpj1, vl_aliquota_irpj1, vl_base_irpj2, vl_aliquota_irpj2, vl_base_irpj3, vl_aliquota_irpj3, vl_base_irpj4, vl_aliquota_irpj4, vl_base_irpj5, vl_aliquota_irpj5, vl_deducoes_simples, nm_pessoa, cd_cnpj_cpf, ie_tipo_inscricao, ds_endereco, ds_bairro, cd_cep, ds_municipio, cd_contabil, cd_cei_nit, nr_inscricao_municipal, nr_telefone, nm_fantasia, vl_base_calculo1, vl_aliquota1, vl_icms1, vl_base_calculo2, vl_aliquota2, vl_icms2, vl_base_calculo3, vl_aliquota3, vl_icms3, vl_base_calculo4, vl_aliquota4, vl_icms4, vl_base_calculo5, vl_aliquota5, vl_icms5, vl_isentas, vl_outras, vl_dif_aliquota, vl_aliquota_dif, cd_dif_aliquota, ie_tipo_lancamento, ie_apuracao, vl_base_calculo, pr_aliquota, vl_iss, vl_imposto_retido, vl_subst_tributo, vl_material, vl_subempreitadas, qt_total_reg, ie_via_transporte, qt_volume, ds_tipo_volume, qt_peso_bruto, qt_peso_liquido, ie_modalidade_frete, ds_placa_veiculo, ie_forma_pagto, nr_iscricao_estadual_trib, ds_servico, vl_servico, vl_base_inss, pr_aliquota_inss, vl_inss, vl_base_irpf, pr_aliquota_irpf, vl_irpf, vl_base_iss, pr_aliquota_iss, vl_base_csll, pr_aliquota_csll, vl_csll, vl_base_cofins, pr_aliquota_cofins, vl_cofins, vl_base_pis, pr_aliquota_pis, nr_item_nf) AS select	1				tp_registro,
	10				ds_registro,
	cd_cgc				cd_cnpj,
	cd_inscricao_estadual		nr_inscricao_estadual,
	cd_estabelecimento			cd_estabelecimento,
	to_date(null)			dt_entrada_saida,
	' '				ds_especie,
	'0'				cd_serie_nf,
	'0'				nr_nota_fiscal,
	0				cd_natureza_operacao,
	0				cd_operacao_nf,
	'0'				cd_historico,
	' '			 	ds_observacao,
	0				cd_modelo_nf,
	0				cd_frete,
	0				cd_saida_exp,
	' '				ie_situacao,
	0				cd_subcodigo_fiscal,
	' ' 				ie_nf_entrada,
	' '				ie_fora_municipio,
	'N'				ie_bens_terceiro,
	' '				cd_atividade,
	' '				tp_nf_servico,
	'N'				ie_doc_eletronico,
	0				nr_seq_nf,
	to_date(null)			dt_emissao,
	0				nr_sequencia,
	' '				sg_estado,
	' '				ds_municipio_origem,
	0				cd_agrupamento,
	0				vl_contabil,
	0				vl_frete,
	0				vl_seguro,
	0				vl_despesa_acessoria,
	0				vl_descontos,
	0				vl_funrural,
	0				vl_base_icms,
	0				vl_icms_retido,
	0				cd_antecip_icms,
	' '				ie_tipo_icms,
	0				vl_contabil1,
	0				vl_contabil2,
	0				vl_contabil3,
	0				vl_contabil4,
	0				vl_contabil5,
	0				vl_pis,
	0				vl_cred_ativo,
	0				vl_ressarc_trib,
	0				vl_transf_credito,
	0				vl_compl_nf,
	0				vl_nao_tributado,
	0				cd_centro_custo_debito,
	0				cd_centro_custo_credito,
	0				vl_base_irpj1,
	0				vl_aliquota_irpj1,
	0				vl_base_irpj2,
	0				vl_aliquota_irpj2,
	0				vl_base_irpj3,
	0				vl_aliquota_irpj3,
	0				vl_base_irpj4,
	0				vl_aliquota_irpj4,
	0				vl_base_irpj5,
	0				vl_aliquota_irpj5,
	0				vl_deducoes_simples,
	' '				nm_pessoa,
	' '				cd_cnpj_cpf,
	' '				ie_tipo_inscricao,
	' '				ds_endereco,
	' '				ds_bairro,
	' '				cd_cep,
	' '				ds_municipio,
	'0'				cd_contabil,
	0				cd_cei_nit,
	' '				nr_inscricao_municipal,
	' '				nr_telefone,
	' '				nm_fantasia,
	0				vl_base_calculo1,
	0				vl_aliquota1,
	0				vl_icms1,
	0				vl_base_calculo2,
	0				vl_aliquota2,
	0				vl_icms2,
	0				vl_base_calculo3,
	0				vl_aliquota3,
	0				vl_icms3,
	0				vl_base_calculo4,
	0				vl_aliquota4,
	0				vl_icms4,
	0				vl_base_calculo5,
	0				vl_aliquota5,
	0				vl_icms5,
	0				vl_isentas,
	0				vl_outras,
	0				vl_dif_aliquota,
	0				vl_aliquota_dif,
	' '				cd_dif_aliquota,
	0				ie_tipo_lancamento,
	' '				ie_apuracao,
	0				vl_base_calculo,
	0				pr_aliquota,
	0				vl_iss,
	0				vl_imposto_retido,
	0				vl_subst_tributo,
	0				vl_material,
	0				vl_subempreitadas,
	0				qt_total_reg,
	' '				ie_via_transporte,
	0				qt_volume,
	' '				ds_tipo_volume,
	0				qt_peso_bruto,
	0				qt_peso_liquido,
	1				ie_modalidade_frete,
	' '				ds_placa_veiculo,
	1				ie_forma_pagto,
	' '				nr_iscricao_estadual_trib,
	' '				ds_servico,
	0				vl_servico,
	0				vl_base_inss,
	0				pr_aliquota_inss,
	0				vl_inss,
	0				vl_base_irpf,
	0				pr_aliquota_irpf,
	0				vl_irpf,
	0				vl_base_iss,
	0				pr_aliquota_iss,
	0				vl_base_csll,
	0				pr_aliquota_csll,
	0				vl_csll,
	0				vl_base_cofins,
	0				pr_aliquota_cofins,
	0				vl_cofins,
	0				vl_base_pis,
	0				pr_aliquota_pis,
	0				nr_item_nf
FROM	estabelecimento_v
where	1=1

union

select	5				tp_registro,
	20				ds_registro,
	' '				cd_cnpj,
	' '				nr_inscricao_estadual,
	e.cd_estabelecimento,
	n.dt_entrada_saida			dt_entrada_saida,
	'026'				ds_especie,
	CASE WHEN n.cd_serie_nf='1' THEN 'IS' END 	cd_serie_nf,
	n.nr_nota_fiscal			nr_nota_fiscal,
	n.cd_natureza_operacao		cd_natureza_operacao,
	n.cd_operacao_nf			cd_operacao_nf,
	CASE WHEN n.ie_situacao='1' THEN '0094'  ELSE '0000' END 	cd_historico,
	substr(n.ds_observacao,1,25)		ds_observacao,
	0				cd_modelo_nf,
	0				cd_frete,
	0				cd_saida_exp,
	CASE WHEN n.ie_situacao='1' THEN '0'  ELSE '1' END 	ie_situacao,
	0				cd_subcodigo_fiscal,
	CASE WHEN n.cd_cgc_emitente=e.cd_cgc THEN 'S'  ELSE 'N' END  ie_nf_entrada,
	CASE WHEN upper(elimina_caracteres_especiais(substr(obter_dados_pf_pj(null, n.cd_cgc_emitente,'CI'),1,40)))='BLUMENAU' THEN 'N'  ELSE 'S' END  ie_fora_municipio,
	'N'				ie_bens_terceiro,
	e.cd_atividade_federal		cd_atividade,
	'1'				tp_nf_servico,
	'N'				ie_doc_eletronico,
	n.nr_sequencia			nr_seq_nf,
	n.dt_emissao,
	0				nr_sequencia,
	' '				sg_estado,
	' '				ds_municipio_origem,
	0				cd_agrupamento,
	0				vl_contabil,
	0				vl_frete,
	0				vl_seguro,
	0				vl_despesa_acessoria,
	0				vl_descontos,
	0				vl_funrural,
	0				vl_base_icms,
	0				vl_icms_retido,
	0				cd_antecip_icms,
	' '				ie_tipo_icms,
	0				vl_contabil1,
	0				vl_contabil2,
	0				vl_contabil3,
	0				vl_contabil4,
	0				vl_contabil5,
	0				vl_pis,
	0				vl_cred_ativo,
	0				vl_ressarc_trib,
	0				vl_transf_credito,
	0				vl_compl_nf,
	0				vl_nao_tributado,
	0				cd_centro_custo_debito,
	0				cd_centro_custo_credito,
	0				vl_base_irpj1,
	0				vl_aliquota_irpj1,
	0				vl_base_irpj2,
	0				vl_aliquota_irpj2,
	0				vl_base_irpj3,
	0				vl_aliquota_irpj3,
	0				vl_base_irpj4,
	0				vl_aliquota_irpj4,
	0				vl_base_irpj5,
	0				vl_aliquota_irpj5,
	0				vl_deducoes_simples,
	' '				nm_pessoa,
	' '				cd_cnpj_cpf,
	' '				ie_tipo_inscricao,
	' '				ds_endereco,
	' '				ds_bairro,
	' '				cd_cep,
	' '				ds_municipio,
	'0'				cd_contabil,
	0				cd_cei_nit,
	' '				nr_inscricao_municipal,
	' '				nr_telefone,
	' '				nm_fantasia,
	0				vl_base_calculo1,
	0				vl_aliquota1,
	0				vl_icms1,
	0				vl_base_calculo2,
	0				vl_aliquota2,
	0				vl_icms2,
	0				vl_base_calculo3,
	0				vl_aliquota3,
	0				vl_icms3,
	0				vl_base_calculo4,
	0				vl_aliquota4,
	0				vl_icms4,
	0				vl_base_calculo5,
	0				vl_aliquota5,
	0				vl_icms5,
	0				vl_isentas,
	0				vl_outras,
	0				vl_dif_aliquota,
	0				vl_aliquota_dif,
	' '				cd_dif_aliquota,
	0				ie_tipo_lancamento,
	' '				ie_apuracao,
	0				vl_base_calculo,
	0				pr_aliquota,
	0				vl_iss,
	0				vl_imposto_retido,
	0				vl_subst_tributo,
	0				vl_material,
	0				vl_subempreitadas,
	0				qt_total_reg,
	' '				ie_via_transporte,
	0				qt_volume,
	' '				ds_tipo_volume,
	0				qt_peso_bruto,
	0				qt_peso_liquido,
	1				ie_modalidade_frete,
	' '				ds_placa_veiculo,
	1				ie_forma_pagto,
	' '				nr_iscricao_estadual_trib,
	' '				ds_servico,
	0				vl_servico,
	0				vl_base_inss,
	0				pr_aliquota_inss,
	0				vl_inss,
	0				vl_base_irpf,
	0				pr_aliquota_irpf,
	0				vl_irpf,
	0				vl_base_iss,
	0				pr_aliquota_iss,
	0				vl_base_csll,
	0				pr_aliquota_csll,
	0				vl_csll,
	0				vl_base_cofins,
	0				pr_aliquota_cofins,
	0				vl_cofins,
	0				vl_base_pis,
	0				pr_aliquota_pis,
	0				nr_item_nf
from	estabelecimento e,
	nota_fiscal n
where	e.cd_estabelecimento = n.cd_estabelecimento
and	substr(obter_se_nota_entrada_saida(n.nr_sequencia),1,1) = 'E'

union

select	10				tp_registro,
	20				ds_registro,
	' '				cd_cnpj,
	' '				nr_inscricao_estadual,
	e.cd_estabelecimento		cd_estabelecimento,
	n.dt_entrada_saida			dt_entrada_saida,
	'NF'				ds_especie,
	CASE WHEN n.cd_serie_nf='1' THEN 'IS' END 	cd_serie_nf,
	n.nr_nota_fiscal			nr_nota_fiscal,
	n.cd_natureza_operacao		cd_natureza_operacao,
	n.cd_operacao_nf			cd_operacao_nf,
	CASE WHEN n.ie_situacao='1' THEN '0094'  ELSE '0000' END 	cd_historico,
	substr(n.ds_observacao,1,25) 		ds_observacao,
	0				cd_modelo_nf,
	0				cd_frete,
	0				cd_saida_exp,
	CASE WHEN n.ie_situacao='1' THEN '0'  ELSE '1' END  	ie_situacao,
	0				cd_subcodigo_fiscal,
	' '				ie_nf_entrada,
	' '				ie_fora_municipio,
	'N'				ie_bens_terceiro,
	' '				cd_atividade,
	'1'				tp_nf_servico,
	'N'				ie_doc_eletronico,
	n.nr_sequencia			nr_seq_nf,
	n.dt_emissao,
	0				nr_sequencia,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'UF'),1,2) sg_estado,
	substr(obter_dados_pf_pj(null,n.cd_cgc_emitente,'CI'),1,40) ds_municipio_origem,
	0				cd_agrupamento,
	0				vl_contabil,
	0				vl_frete,
	0				vl_seguro,
	0				vl_despesa_acessoria,
	0				vl_descontos,
	0				vl_funrural,
	0				vl_base_icms,
	0				vl_icms_retido,
	0				cd_antecip_icms,
	' '				ie_tipo_icms,
	0				vl_contabil1,
	0				vl_contabil2,
	0				vl_contabil3,
	0				vl_contabil4,
	0				vl_contabil5,
	0				vl_pis,
	0				vl_cred_ativo,
	0				vl_ressarc_trib,
	0				vl_transf_credito,
	0				vl_compl_nf,
	0				vl_nao_tributado,
	0				cd_centro_custo_debito,
	0				cd_centro_custo_credito,
	0				vl_base_irpj1,
	0				vl_aliquota_irpj1,
	0				vl_base_irpj2,
	0				vl_aliquota_irpj2,
	0				vl_base_irpj3,
	0				vl_aliquota_irpj3,
	0				vl_base_irpj4,
	0				vl_aliquota_irpj4,
	0				vl_base_irpj5,
	0				vl_aliquota_irpj5,
	0				vl_deducoes_simples,
	' '				nm_pessoa,
	' '				cd_cnpj_cpf,
	' '				ie_tipo_inscricao,
	' '				ds_endereco,
	' '				ds_bairro,
	' '				cd_cep,
	' '				ds_municipio,
	'0'				cd_contabil,
	0				cd_cei_nit,
	' '				nr_inscricao_municipal,
	' '				nr_telefone,
	' '				nm_fantasia,
	0				vl_base_calculo1,
	0				vl_aliquota1,
	0				vl_icms1,
	0				vl_base_calculo2,
	0				vl_aliquota2,
	0				vl_icms2,
	0				vl_base_calculo3,
	0				vl_aliquota3,
	0				vl_icms3,
	0				vl_base_calculo4,
	0				vl_aliquota4,
	0				vl_icms4,
	0				vl_base_calculo5,
	0				vl_aliquota5,
	0				vl_icms5,
	0				vl_isentas,
	0				vl_outras,
	0				vl_dif_aliquota,
	0				vl_aliquota_dif,
	' '				cd_dif_aliquota,
	0				ie_tipo_lancamento,
	' '				ie_apuracao,
	0				vl_base_calculo,
	0				pr_aliquota,
	0				vl_iss,
	0				vl_imposto_retido,
	0				vl_subst_tributo,
	0				vl_material,
	0				vl_subempreitadas,
	0				qt_total_reg,
	' '				ie_via_transporte,
	0				qt_volume,
	' '				ds_tipo_volume,
	0				qt_peso_bruto,
	0				qt_peso_liquido,
	1				ie_modalidade_frete,
	' '				ds_placa_veiculo,
	1				ie_forma_pagto,
	' '				nr_iscricao_estadual_trib,
	' '				ds_servico,
	0				vl_servico,
	0				vl_base_inss,
	0				pr_aliquota_inss,
	0				vl_inss,
	0				vl_base_irpf,
	0				pr_aliquota_irpf,
	0				vl_irpf,
	0				vl_base_iss,
	0				pr_aliquota_iss,
	0				vl_base_csll,
	0				pr_aliquota_csll,
	0				vl_csll,
	0				vl_base_cofins,
	0				pr_aliquota_cofins,
	0				vl_cofins,
	0				vl_base_pis,
	0				pr_aliquota_pis,
	0				nr_item_nf
from	estabelecimento e,
	nota_fiscal n
where	e.cd_estabelecimento = n.cd_estabelecimento
and	substr(obter_se_nota_entrada_saida(n.nr_sequencia),1,1) = 'S'

union

select	15				tp_registro,
	21				ds_registro,
	' '				cd_cnpj,
	' '				nr_inscricao_estadual,
	e.cd_estabelecimento		cd_estabelecimento,
	n.dt_entrada_saida			dt_entrada_saida,
	' '				ds_especie,
	CASE WHEN n.cd_serie_nf='1' THEN 'IS' END 	cd_serie_nf,
	n.nr_nota_fiscal			nr_nota_fiscal,
	n.cd_natureza_operacao		cd_natureza_operacao,
	n.cd_operacao_nf			cd_operacao_nf,
	'0'				cd_historico,
	substr(n.ds_observacao,1,25) 		ds_observacao,
	0				cd_modelo_nf,
	0				cd_frete,
	0				cd_saida_exp,
	CASE WHEN n.ie_situacao='1' THEN '0'  ELSE '1' END  	ie_situacao,
	0				cd_subcodigo_fiscal,
	' '				ie_nf_entrada,
	' '				ie_fora_municipio,
	'N'				ie_bens_terceiro,
	' '				cd_atividade,
	'1'				tp_nf_servico,
	'N'				ie_doc_eletronico,
	n.nr_sequencia			nr_seq_nf,
	n.dt_emissao,
	0				nr_sequencia,
	' '				sg_estado,
	' '				ds_municipio_origem,
	0				cd_agrupamento,
	n.vl_mercadoria			vl_contabil,
	n.vl_frete				vl_frete,
	n.vl_seguro			vl_seguro,
	n.vl_despesa_acessoria		vl_despesa_acessoria,
	n.vl_descontos			vl_descontos,
	0				vl_funrural,
	0				vl_base_icms,
	0				vl_icms_retido,
	0				cd_antecip_icms,
	' '				ie_tipo_icms,
	0				vl_contabil1,
	0				vl_contabil2,
	0				vl_contabil3,
	0				vl_contabil4,
	0				vl_contabil5,
	0				vl_pis,
	0				vl_cred_ativo,
	0				vl_ressarc_trib,
	0				vl_transf_credito,
	0				vl_compl_nf,
	0				vl_nao_tributado,
	0				cd_centro_custo_debito,
	0				cd_centro_custo_credito,
	0				vl_base_irpj1,
	0				vl_aliquota_irpj1,
	0				vl_base_irpj2,
	0				vl_aliquota_irpj2,
	0				vl_base_irpj3,
	0				vl_aliquota_irpj3,
	0				vl_base_irpj4,
	0				vl_aliquota_irpj4,
	0				vl_base_irpj5,
	0				vl_aliquota_irpj5,
	0				vl_deducoes_simples,
	' '				nm_pessoa,
	' '				cd_cnpj_cpf,
	' '				ie_tipo_inscricao,
	' '				ds_endereco,
	' '				ds_bairro,
	' '				cd_cep,
	' '				ds_municipio,
	'0'				cd_contabil,
	0				cd_cei_nit,
	' '				nr_inscricao_municipal,
	' '				nr_telefone,
	' '				nm_fantasia,
	0				vl_base_calculo1,
	0				vl_aliquota1,
	0				vl_icms1,
	0				vl_base_calculo2,
	0				vl_aliquota2,
	0				vl_icms2,
	0				vl_base_calculo3,
	0				vl_aliquota3,
	0				vl_icms3,
	0				vl_base_calculo4,
	0				vl_aliquota4,
	0				vl_icms4,
	0				vl_base_calculo5,
	0				vl_aliquota5,
	0				vl_icms5,
	0				vl_isentas,
	0				vl_outras,
	0				vl_dif_aliquota,
	0				vl_aliquota_dif,
	' '				cd_dif_aliquota,
	0				ie_tipo_lancamento,
	' '				ie_apuracao,
	0				vl_base_calculo,
	0				pr_aliquota,
	0				vl_iss,
	0				vl_imposto_retido,
	0				vl_subst_tributo,
	0				vl_material,
	0				vl_subempreitadas,
	0				qt_total_reg,
	' '				ie_via_transporte,
	0				qt_volume,
	' '				ds_tipo_volume,
	0				qt_peso_bruto,
	0				qt_peso_liquido,
	1				ie_modalidade_frete,
	' '				ds_placa_veiculo,
	1				ie_forma_pagto,
	' '				nr_iscricao_estadual_trib,
	' '				ds_servico,
	0				vl_servico,
	0				vl_base_inss,
	0				pr_aliquota_inss,
	0				vl_inss,
	0				vl_base_irpf,
	0				pr_aliquota_irpf,
	0				vl_irpf,
	0				vl_base_iss,
	0				pr_aliquota_iss,
	0				vl_base_csll,
	0				pr_aliquota_csll,
	0				vl_csll,
	0				vl_base_cofins,
	0				pr_aliquota_cofins,
	0				vl_cofins,
	0				vl_base_pis,
	0				pr_aliquota_pis,
	0				nr_item_nf
from	estabelecimento e,
	nota_fiscal n
where	e.cd_estabelecimento = n.cd_estabelecimento
and	substr(obter_se_nota_entrada_saida(n.nr_sequencia),1,1) = 'E'

union

select	20				tp_registro,
	21				ds_registro,
	' '				cd_cnpj,
	' '				nr_inscricao_estadual,
	e.cd_estabelecimento,
	n.dt_entrada_saida			dt_entrada_saida,
	' '				ds_especie,
	CASE WHEN n.cd_serie_nf='1' THEN 'IS' END 	cd_serie_nf,
	n.nr_nota_fiscal			nr_nota_fiscal,
	n.cd_natureza_operacao		cd_natureza_operacao,
	n.cd_operacao_nf			cd_operacao_nf,
	'0'				cd_historico,
	substr(n.ds_observacao,1,25)		ds_observacao,
	0				cd_modelo_nf,
	0				cd_frete,
	0				cd_saida_exp,
	CASE WHEN n.ie_situacao='1' THEN '0'  ELSE '1' END  	ie_situacao,
	0				cd_subcodigo_fiscal,
	CASE WHEN n.cd_cgc_emitente=e.cd_cgc THEN 'S'  ELSE 'N' END  ie_nf_entrada,
	CASE WHEN upper(substr(obter_dados_pf_pj(null,n.cd_cgc_emitente,'CI'),1,40))='BLUMENAU' THEN 'N'  ELSE 'S' END  ie_fora_municipio,
	'N'				ie_bens_terceiro,
	e.cd_atividade_federal		cd_atividade,
	'1'				tp_nf_servico,
	'N'				ie_doc_eletronico,
	n.nr_sequencia			nr_seq_nf,
	n.dt_emissao,
	0				nr_sequencia,
	' '				sg_estado,
	' '				ds_municipio_origem,
	0				cd_agrupamento,
	n.vl_mercadoria			vl_contabil,
	n.vl_frete				vl_frete,
	n.vl_seguro			vl_seguro,
	n.vl_despesa_acessoria		vl_despesa_acessoria,
	n.vl_descontos			vl_descontos,
	0				vl_funrural,
	0				vl_base_icms,
	0				vl_icms_retido,
	0				cd_antecip_icms,
	' '				ie_tipo_icms,
	0				vl_contabil1,
	0				vl_contabil2,
	0				vl_contabil3,
	0				vl_contabil4,
	0				vl_contabil5,
	0				vl_pis,
	0				vl_cred_ativo,
	0				vl_ressarc_trib,
	0				vl_transf_credito,
	0				vl_compl_nf,
	0				vl_nao_tributado,
	0				cd_centro_custo_debito,
	0				cd_centro_custo_credito,
	0				vl_base_irpj1,
	0				vl_aliquota_irpj1,
	0				vl_base_irpj2,
	0				vl_aliquota_irpj2,
	0				vl_base_irpj3,
	0				vl_aliquota_irpj3,
	0				vl_base_irpj4,
	0				vl_aliquota_irpj4,
	0				vl_base_irpj5,
	0				vl_aliquota_irpj5,
	0				vl_deducoes_simples,
	' '				nm_pessoa,
	' '				cd_cnpj_cpf,
	' '				ie_tipo_inscricao,
	' '				ds_endereco,
	' '				ds_bairro,
	' '				cd_cep,
	' '				ds_municipio,
	'0'				cd_contabil,
	0				cd_cei_nit,
	' '				nr_inscricao_municipal,
	' '				nr_telefone,
	' '				nm_fantasia,
	0				vl_base_calculo1,
	0				vl_aliquota1,
	0				vl_icms1,
	0				vl_base_calculo2,
	0				vl_aliquota2,
	0				vl_icms2,
	0				vl_base_calculo3,
	0				vl_aliquota3,
	0				vl_icms3,
	0				vl_base_calculo4,
	0				vl_aliquota4,
	0				vl_icms4,
	0				vl_base_calculo5,
	0				vl_aliquota5,
	0				vl_icms5,
	0				vl_isentas,
	0				vl_outras,
	0				vl_dif_aliquota,
	0				vl_aliquota_dif,
	' '				cd_dif_aliquota,
	0				ie_tipo_lancamento,
	' '				ie_apuracao,
	0				vl_base_calculo,
	0				pr_aliquota,
	0				vl_iss,
	0				vl_imposto_retido,
	0				vl_subst_tributo,
	0				vl_material,
	0				vl_subempreitadas,
	0				qt_total_reg,
	' '				ie_via_transporte,
	0				qt_volume,
	' '				ds_tipo_volume,
	0				qt_peso_bruto,
	0				qt_peso_liquido,
	1				ie_modalidade_frete,
	' '				ds_placa_veiculo,
	1				ie_forma_pagto,
	' '				nr_iscricao_estadual_trib,
	' '				ds_servico,
	0				vl_servico,
	0				vl_base_inss,
	0				pr_aliquota_inss,
	0				vl_inss,
	0				vl_base_irpf,
	0				pr_aliquota_irpf,
	0				vl_irpf,
	0				vl_base_iss,
	0				pr_aliquota_iss,
	0				vl_base_csll,
	0				pr_aliquota_csll,
	0				vl_csll,
	0				vl_base_cofins,
	0				pr_aliquota_cofins,
	0				vl_cofins,
	0				vl_base_pis,
	0				pr_aliquota_pis,
	0				nr_item_nf
from	estabelecimento e,
	nota_fiscal n
where	e.cd_estabelecimento = n.cd_estabelecimento
and	substr(obter_se_nota_entrada_saida(n.nr_sequencia),1,1) = 'S'

union

select	25				tp_registro,
	22				ds_registro,
	' '				cd_cnpj,
	' '				nr_inscricao_estadual,
	e.cd_estabelecimento,
	n.dt_entrada_saida			dt_entrada_saida,
	' '				ds_especie,
	CASE WHEN n.cd_serie_nf='1' THEN 'IS' END 	cd_serie_nf,
	n.nr_nota_fiscal			nr_nota_fiscal,
	n.cd_natureza_operacao		cd_natureza_operacao,
	n.cd_operacao_nf			cd_operacao_nf,
	'0'				cd_historico,
	substr(n.ds_observacao,1,25)		ds_observacao,
	0				cd_modelo_nf,
	0				cd_frete,
	0				cd_saida_exp,
	CASE WHEN n.ie_situacao='1' THEN '0'  ELSE '1' END  	ie_situacao,
	0				cd_subcodigo_fiscal,
	CASE WHEN n.cd_cgc_emitente=e.cd_cgc THEN 'S'  ELSE 'N' END  ie_nf_entrada,
	CASE WHEN upper(substr(obter_dados_pf_pj(null,n.cd_cgc_emitente,'CI'),1,40))='BLUMENAU' THEN 'N'  ELSE 'S' END  ie_fora_municipio,
	'N'				ie_bens_terceiro,
	e.cd_atividade_federal		cd_atividade,
	'1'				tp_nf_servico,
	'N'				ie_doc_eletronico,
	n.nr_sequencia			nr_seq_nf,
	n.dt_emissao,
	0				nr_sequencia,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'UF'),1,2) sg_estado,
	' '				ds_municipio_origem,
	0				cd_agrupamento,
	0				vl_contabil,
	0				vl_frete,
	0				vl_seguro,
	0				vl_despesa_acessoria,
	0				vl_descontos,
	0				vl_funrural,
	0				vl_base_icms,
	0				vl_icms_retido,
	0				cd_antecip_icms,
	' '				ie_tipo_icms,
	0				vl_contabil1,
	0				vl_contabil2,
	0				vl_contabil3,
	0				vl_contabil4,
	0				vl_contabil5,
	0				vl_pis,
	0				vl_cred_ativo,
	0				vl_ressarc_trib,
	0				vl_transf_credito,
	0				vl_compl_nf,
	0				vl_nao_tributado,
	0				cd_centro_custo_debito,
	0				cd_centro_custo_credito,
	0				vl_base_irpj1,
	0				vl_aliquota_irpj1,
	0				vl_base_irpj2,
	0				vl_aliquota_irpj2,
	0				vl_base_irpj3,
	0				vl_aliquota_irpj3,
	0				vl_base_irpj4,
	0				vl_aliquota_irpj4,
	0				vl_base_irpj5,
	0				vl_aliquota_irpj5,
	0				vl_deducoes_simples,
	substr(obter_nome_pf_pj(n.cd_pessoa_fisica, n.cd_cgc),1,80) nm_pessoa,
	CASE WHEN n.cd_pessoa_fisica IS NULL THEN  n.cd_cgc  ELSE substr(obter_dados_pf(n.cd_pessoa_fisica,'CPF'),1,11) END  cd_cnpj_cpf,
	CASE WHEN n.cd_cgc IS NULL THEN  CASE WHEN substr(obter_dados_pf(n.cd_pessoa_fisica,'CPF'),1,11) IS NULL THEN  '0'  ELSE '2' END   ELSE '1' END  ie_tipo_inscricao,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'E'),1,40) ds_endereco,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'B'),1,14) ds_bairro,
	substr(elimina_caracteres_especiais(substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'CEP'),1,9)),1,9) cd_cep,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'CI'),1,25) ds_municipio,
	CASE WHEN substr(obter_se_nota_entrada_saida(n.nr_sequencia),1,1)='S' THEN '9998'  ELSE '9999' END  cd_contabil,
	0				cd_cei_nit,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'IM'),1,14) nr_inscricao_municipal,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'T'),1,11) nr_telefone,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'F'),1,40) nm_fantasia,
	0				vl_base_calculo1,
	0				vl_aliquota1,
	0				vl_icms1,
	0				vl_base_calculo2,
	0				vl_aliquota2,
	0				vl_icms2,
	0				vl_base_calculo3,
	0				vl_aliquota3,
	0				vl_icms3,
	0				vl_base_calculo4,
	0				vl_aliquota4,
	0				vl_icms4,
	0				vl_base_calculo5,
	0				vl_aliquota5,
	0				vl_icms5,
	0				vl_isentas,
	0				vl_outras,
	0				vl_dif_aliquota,
	0				vl_aliquota_dif,
	' '				cd_dif_aliquota,
	0				ie_tipo_lancamento,
	' '				ie_apuracao,
	0				vl_base_calculo,
	0				pr_aliquota,
	0				vl_iss,
	0				vl_imposto_retido,
	0				vl_subst_tributo,
	0				vl_material,
	0				vl_subempreitadas,
	0				qt_total_reg,
	' '				ie_via_transporte,
	0				qt_volume,
	' '				ds_tipo_volume,
	0				qt_peso_bruto,
	0				qt_peso_liquido,
	1				ie_modalidade_frete,
	' '				ds_placa_veiculo,
	1				ie_forma_pagto,
	' '				nr_iscricao_estadual_trib,
	' '				ds_servico,
	0				vl_servico,
	0				vl_base_inss,
	0				pr_aliquota_inss,
	0				vl_inss,
	0				vl_base_irpf,
	0				pr_aliquota_irpf,
	0				vl_irpf,
	0				vl_base_iss,
	0				pr_aliquota_iss,
	0				vl_base_csll,
	0				pr_aliquota_csll,
	0				vl_csll,
	0				vl_base_cofins,
	0				pr_aliquota_cofins,
	0				vl_cofins,
	0				vl_base_pis,
	0				pr_aliquota_pis,
	0				nr_item_nf
from	estabelecimento e,
	nota_fiscal n
where	e.cd_estabelecimento = n.cd_estabelecimento

union

select	30				tp_registro,
	23				ds_registro,
	' '				cd_cnpj,
	' '				nr_inscricao_estadual,
	e.cd_estabelecimento,
	n.dt_entrada_saida			dt_entrada_saida,
	' '				ds_especie,
	CASE WHEN n.cd_serie_nf='1' THEN 'IS' END 	cd_serie_nf,
	n.nr_nota_fiscal			nr_nota_fiscal,
	n.cd_natureza_operacao		cd_natureza_operacao,
	n.cd_operacao_nf			cd_operacao_nf,
	'0'				cd_historico,
	substr(n.ds_observacao,1,25)		ds_observacao,
	0				cd_modelo_nf,
	0				cd_frete,
	0				cd_saida_exp,
	CASE WHEN n.ie_situacao='1' THEN '0'  ELSE '1' END 	ie_situacao,
	0				cd_subcodigo_fiscal,
	CASE WHEN n.cd_cgc_emitente=e.cd_cgc THEN 'S'  ELSE 'N' END  ie_nf_entrada,
	CASE WHEN upper(substr(obter_dados_pf_pj(null,n.cd_cgc_emitente,'CI'),1,40))='BLUMENAU' THEN 'N'  ELSE 'S' END  ie_fora_municipio,
	'N'				ie_bens_terceiro,
	e.cd_atividade_federal		cd_atividade,
	'1'				tp_nf_servico,
	'N'				ie_doc_eletronico,
	n.nr_sequencia			nr_seq_nf,
	n.dt_emissao,
	0				nr_sequencia,
	' '				sg_estado,
	' '				ds_municipio_origem,
	0				cd_agrupamento,
	0				vl_contabil,
	0				vl_frete,
	0				vl_seguro,
	0				vl_despesa_acessoria,
	0				vl_descontos,
	0				vl_funrural,
	0				vl_base_icms,
	0				vl_icms_retido,
	0				cd_antecip_icms,
	' '				ie_tipo_icms,
	0				vl_contabil1,
	0				vl_contabil2,
	0				vl_contabil3,
	0				vl_contabil4,
	0				vl_contabil5,
	0				vl_pis,
	0				vl_cred_ativo,
	0				vl_ressarc_trib,
	0				vl_transf_credito,
	0				vl_compl_nf,
	0				vl_nao_tributado,
	0				cd_centro_custo_debito,
	0				cd_centro_custo_credito,
	0				vl_base_irpj1,
	0				vl_aliquota_irpj1,
	0				vl_base_irpj2,
	0				vl_aliquota_irpj2,
	0				vl_base_irpj3,
	0				vl_aliquota_irpj3,
	0				vl_base_irpj4,
	0				vl_aliquota_irpj4,
	0				vl_base_irpj5,
	0				vl_aliquota_irpj5,
	0				vl_deducoes_simples,
	' '				nm_pessoa,
	' '				cd_cnpj_cpf,
	' '				ie_tipo_inscricao,
	' '				ds_endereco,
	' '				ds_bairro,
	' '				cd_cep,
	' '				ds_municipio,
	'0'				cd_contabil,
	0				cd_cei_nit,
	' '				nr_inscricao_municipal,
	' '				nr_telefone,
	' '				nm_fantasia,
	0				vl_base_calculo1,
	0				vl_aliquota1,
	0				vl_icms1,
	0				vl_base_calculo2,
	0				vl_aliquota2,
	0				vl_icms2,
	0				vl_base_calculo3,
	0				vl_aliquota3,
	0				vl_icms3,
	0				vl_base_calculo4,
	0				vl_aliquota4,
	0				vl_icms4,
	0				vl_base_calculo5,
	0				vl_aliquota5,
	0				vl_icms5,
	0				vl_isentas,
	n.vl_mercadoria			vl_outras,
	0				vl_dif_aliquota,
	0				vl_aliquota_dif,
	' '				cd_dif_aliquota,
	0				ie_tipo_lancamento,
	' '				ie_apuracao,
	0				vl_base_calculo,
	0				pr_aliquota,
	0				vl_iss,
	0				vl_imposto_retido,
	0				vl_subst_tributo,
	0				vl_material,
	0				vl_subempreitadas,
	0				qt_total_reg,
	' '				ie_via_transporte,
	0				qt_volume,
	' '				ds_tipo_volume,
	0				qt_peso_bruto,
	0				qt_peso_liquido,
	1				ie_modalidade_frete,
	' '				ds_placa_veiculo,
	1				ie_forma_pagto,
	' '				nr_iscricao_estadual_trib,
	' '				ds_servico,
	0				vl_servico,
	0				vl_base_inss,
	0				pr_aliquota_inss,
	0				vl_inss,
	0				vl_base_irpf,
	0				pr_aliquota_irpf,
	0				vl_irpf,
	0				vl_base_iss,
	0				pr_aliquota_iss,
	0				vl_base_csll,
	0				pr_aliquota_csll,
	0				vl_csll,
	0				vl_base_cofins,
	0				pr_aliquota_cofins,
	0				vl_cofins,
	0				vl_base_pis,
	0				pr_aliquota_pis,
	0				nr_item_nf
from	estabelecimento e,
	nota_fiscal n
where	e.cd_estabelecimento = n.cd_estabelecimento
and	substr(obter_se_nota_entrada_saida(n.nr_sequencia),1,1) = 'E'

union

select	35				tp_registro,
	23				ds_registro,
	' '				cd_cnpj,
	' '				nr_inscricao_estadual,
	e.cd_estabelecimento,
	n.dt_entrada_saida			dt_entrada_saida,
	' '				ds_especie,
	CASE WHEN n.cd_serie_nf='1' THEN 'IS' END 	cd_serie_nf,
	n.nr_nota_fiscal			nr_nota_fiscal,
	n.cd_natureza_operacao		cd_natureza_operacao,
	n.cd_operacao_nf			cd_operacao_nf,
	'0'				cd_historico,
	substr(n.ds_observacao,1,25) 		ds_observacao,
	0				cd_modelo_nf,
	0				cd_frete,
	0				cd_saida_exp,
	CASE WHEN n.ie_situacao='1' THEN '0'  ELSE '1' END  	ie_situacao,
	0				cd_subcodigo_fiscal,
	CASE WHEN n.cd_cgc_emitente=e.cd_cgc THEN 'S'  ELSE 'N' END  ie_nf_entrada,
	CASE WHEN upper(substr(obter_dados_pf_pj(null,n.cd_cgc_emitente,'CI'),1,40))='BLUMENAU' THEN 'N'  ELSE 'S' END  ie_fora_municipio,
	'N'				ie_bens_terceiro,
	e.cd_atividade_federal		cd_atividade,
	'1'				tp_nf_servico,
	'N'				ie_doc_eletronico,
	n.nr_sequencia			nr_seq_nf,
	n.dt_emissao,
	0				nr_sequencia,
	' '				sg_estado,
	' '				ds_municipio_origem,
	0				cd_agrupamento,
	0				vl_contabil,
	0				vl_frete,
	0				vl_seguro,
	0				vl_despesa_acessoria,
	0				vl_descontos,
	0				vl_funrural,
	0				vl_base_icms,
	0				vl_icms_retido,
	0				cd_antecip_icms,
	' '				ie_tipo_icms,
	0				vl_contabil1,
	0				vl_contabil2,
	0				vl_contabil3,
	0				vl_contabil4,
	0				vl_contabil5,
	0				vl_pis,
	0				vl_cred_ativo,
	0				vl_ressarc_trib,
	0				vl_transf_credito,
	0				vl_compl_nf,
	0				vl_nao_tributado,
	0				cd_centro_custo_debito,
	0				cd_centro_custo_credito,
	0				vl_base_irpj1,
	0				vl_aliquota_irpj1,
	0				vl_base_irpj2,
	0				vl_aliquota_irpj2,
	0				vl_base_irpj3,
	0				vl_aliquota_irpj3,
	0				vl_base_irpj4,
	0				vl_aliquota_irpj4,
	0				vl_base_irpj5,
	0				vl_aliquota_irpj5,
	0				vl_deducoes_simples,
	' '				nm_pessoa,
	' '				cd_cnpj_cpf,
	' '				ie_tipo_inscricao,
	' '				ds_endereco,
	' '				ds_bairro,
	' '				cd_cep,
	' '				ds_municipio,
	'0'				cd_contabil,
	0				cd_cei_nit,
	' '				nr_inscricao_municipal,
	' '				nr_telefone,
	' '				nm_fantasia,
	0				vl_base_calculo1,
	0				vl_aliquota1,
	0				vl_icms1,
	0				vl_base_calculo2,
	0				vl_aliquota2,
	0				vl_icms2,
	0				vl_base_calculo3,
	0				vl_aliquota3,
	0				vl_icms3,
	0				vl_base_calculo4,
	0				vl_aliquota4,
	0				vl_icms4,
	0				vl_base_calculo5,
	0				vl_aliquota5,
	0				vl_icms5,
	0				vl_isentas,
	n.vl_mercadoria			vl_outras,
	0				vl_dif_aliquota,
	0				vl_aliquota_dif,
	' '				cd_dif_aliquota,
	0				ie_tipo_lancamento,
	' '				ie_apuracao,
	0				vl_base_calculo,
	0				pr_aliquota,
	0				vl_iss,
	0				vl_imposto_retido,
	0				vl_subst_tributo,
	0				vl_material,
	0				vl_subempreitadas,
	0				qt_total_reg,
	' '				ie_via_transporte,
	0				qt_volume,
	' '				ds_tipo_volume,
	0				qt_peso_bruto,
	0				qt_peso_liquido,
	1				ie_modalidade_frete,
	' '				ds_placa_veiculo,
	1				ie_forma_pagto,
	' '				nr_iscricao_estadual_trib,
	' '				ds_servico,
	0				vl_servico,
	0				vl_base_inss,
	0				pr_aliquota_inss,
	0				vl_inss,
	0				vl_base_irpf,
	0				pr_aliquota_irpf,
	0				vl_irpf,
	0				vl_base_iss,
	0				pr_aliquota_iss,
	0				vl_base_csll,
	0				pr_aliquota_csll,
	0				vl_csll,
	0				vl_base_cofins,
	0				pr_aliquota_cofins,
	0				vl_cofins,
	0				vl_base_pis,
	0				pr_aliquota_pis,
	0				nr_item_nf
from	estabelecimento e,
	nota_fiscal n
where	e.cd_estabelecimento = n.cd_estabelecimento
and	substr(obter_se_nota_entrada_saida(n.nr_sequencia),1,1) = 'S'

union

select	37				tp_registro,
	26				ds_registro,
	' '				cd_cnpj,
	' '				nr_inscricao_estadual,
	n.cd_estabelecimento,
	n.dt_entrada_saida			dt_entrada_saida,
	' '				ds_especie,
	CASE WHEN n.cd_serie_nf='1' THEN 'IS' END 	cd_serie_nf,
	n.nr_nota_fiscal			nr_nota_fiscal,
	n.cd_natureza_operacao		cd_natureza_operacao,
	n.cd_operacao_nf			cd_operacao_nf,
	'0'				cd_historico,
	substr(n.ds_observacao,1,30) 		ds_observacao,
	0				cd_modelo_nf,
	0				cd_frete,
	0				cd_saida_exp,
	CASE WHEN n.ie_situacao='1' THEN '0'  ELSE '1' END  	ie_situacao,
	0				cd_subcodigo_fiscal,
	CASE WHEN n.cd_cgc_emitente=e.cd_cgc THEN 'S'  ELSE 'N' END  ie_nf_entrada,
	CASE WHEN upper(elimina_caracteres_especiais(substr(obter_dados_pf_pj(null, n.cd_cgc_emitente,'CI'),1,40)))='BLUMENAU' THEN 'N'  ELSE 'S' END  ie_fora_municipio,
	'N'				ie_bens_terceiro,
	e.cd_atividade_federal		cd_atividade,
	'1'				tp_nf_servico,
	'N'				ie_doc_eletronico,
	n.nr_sequencia			nr_seq_nf,
	n.dt_emissao,
	0				nr_sequencia,
	' '				sg_estado,
	' '				ds_municipio_origem,
	0				cd_agrupamento,
	0				vl_contabil,
	0				vl_frete,
	0				vl_seguro,
	0				vl_despesa_acessoria,
	0				vl_descontos,
	0				vl_funrural,
	0				vl_base_icms,
	0				vl_icms_retido,
	0				cd_antecip_icms,
	' '				ie_tipo_icms,
	0				vl_contabil1,
	0				vl_contabil2,
	0				vl_contabil3,
	0				vl_contabil4,
	0				vl_contabil5,
	0				vl_pis,
	0				vl_cred_ativo,
	0				vl_ressarc_trib,
	0				vl_transf_credito,
	0				vl_compl_nf,
	0				vl_nao_tributado,
	0				cd_centro_custo_debito,
	0				cd_centro_custo_credito,
	0				vl_base_irpj1,
	0				vl_aliquota_irpj1,
	0				vl_base_irpj2,
	0				vl_aliquota_irpj2,
	0				vl_base_irpj3,
	0				vl_aliquota_irpj3,
	0				vl_base_irpj4,
	0				vl_aliquota_irpj4,
	0				vl_base_irpj5,
	0				vl_aliquota_irpj5,
	0				vl_deducoes_simples,
	' '				nm_pessoa,
	' '				cd_cnpj_cpf,
	' '				ie_tipo_inscricao,
	' '				ds_endereco,
	' '				ds_bairro,
	' '				cd_cep,
	' '				ds_municipio,
	'0'				cd_contabil,
	0				cd_cei_nit,
	' '				nr_inscricao_municipal,
	' '				nr_telefone,
	' '				nm_fantasia,
	0				vl_base_calculo1,
	0				vl_aliquota1,
	0				vl_icms1,
	0				vl_base_calculo2,
	0				vl_aliquota2,
	0				vl_icms2,
	0				vl_base_calculo3,
	0				vl_aliquota3,
	0				vl_icms3,
	0				vl_base_calculo4,
	0				vl_aliquota4,
	0				vl_icms4,
	0				vl_base_calculo5,
	0				vl_aliquota5,
	0				vl_icms5,
	0				vl_isentas,
	n.vl_total_nota			vl_outras,
	0				vl_dif_aliquota,
	0				vl_aliquota_dif,
	' '				cd_dif_aliquota,
	0				ie_tipo_lancamento,
	' '				ie_apuracao,
	n.vl_mercadoria			vl_base_calculo,
	(select coalesce(max(coalesce(x.tx_tributo,0)),0)
	from	nota_fiscal_item_trib x,
		tributo t
	where	n.nr_sequencia = x.nr_sequencia
	and	t.cd_tributo = x.cd_tributo
	and	t.ie_tipo_tributo = 'ISS')	pr_aliquota,
	(select coalesce(sum(coalesce(x.vl_tributo,0)),0)
	from	nota_fiscal_item_trib x,
		tributo t
	where	n.nr_sequencia = x.nr_sequencia
	and	t.cd_tributo = x.cd_tributo
	and	t.ie_tipo_tributo = 'ISS') 	vl_iss,
	0				vl_imposto_retido,
	0				vl_subst_tributo,
	0				vl_material,
	0				vl_subempreitadas,
	0				qt_total_reg,
	' '				ie_via_transporte,
	0				qt_volume,
	' '				ds_tipo_volume,
	0				qt_peso_bruto,
	0				qt_peso_liquido,
	1				ie_modalidade_frete,
	' '				ds_placa_veiculo,
	1				ie_forma_pagto,
	' '				nr_iscricao_estadual_trib,
	' '				ds_servico,
	0				vl_servico,
	0				vl_base_inss,
	0				pr_aliquota_inss,
	0				vl_inss,
	0				vl_base_irpf,
	0				pr_aliquota_irpf,
	0				vl_irpf,
	0				vl_base_iss,
	0				pr_aliquota_iss,
	0				vl_base_csll,
	0				pr_aliquota_csll,
	0				vl_csll,
	0				vl_base_cofins,
	0				pr_aliquota_cofins,
	0				vl_cofins,
	0				vl_base_pis,
	0				pr_aliquota_pis,
	0				nr_item_nf
from	estabelecimento e,
	nota_fiscal n
where	e.cd_estabelecimento = n.cd_estabelecimento

union

select	38				tp_registro,
	30				ds_registro,
	' '				cd_cnpj,
	' '				nr_inscricao_estadual,
	e.cd_estabelecimento,
	n.dt_entrada_saida			dt_entrada_saida,
	' '				ds_especie,
	CASE WHEN n.cd_serie_nf='1' THEN 'IS' END 	cd_serie_nf,
	n.nr_nota_fiscal			nr_nota_fiscal,
	n.cd_natureza_operacao		cd_natureza_operacao,
	n.cd_operacao_nf			cd_operacao_nf,
	'0'				cd_historico,
	substr(n.ds_observacao,1,25) 		ds_observacao,
	0				cd_modelo_nf,
	0				cd_frete,
	0				cd_saida_exp,
	CASE WHEN n.ie_situacao='1' THEN '0'  ELSE '1' END 	ie_situacao,
	0				cd_subcodigo_fiscal,
	CASE WHEN n.cd_cgc_emitente=e.cd_cgc THEN 'S'  ELSE 'N' END  ie_nf_entrada,
	CASE WHEN upper(substr(obter_dados_pf_pj(null,n.cd_cgc_emitente,'CI'),1,40))='BLUMENAU' THEN 'N'  ELSE 'S' END  ie_fora_municipio,
	'N'				ie_bens_terceiro,
	e.cd_atividade_federal		cd_atividade,
	'1'				tp_nf_servico,
	'N'				ie_doc_eletronico,
	n.nr_sequencia			nr_seq_nf,
	n.dt_emissao,
	0				nr_sequencia,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'UF'),1,2) sg_estado,
	' '				ds_municipio_origem,
	0				cd_agrupamento,
	0				vl_contabil,
	0				vl_frete,
	0				vl_seguro,
	0				vl_despesa_acessoria,
	0				vl_descontos,
	0				vl_funrural,
	0				vl_base_icms,
	0				vl_icms_retido,
	0				cd_antecip_icms,
	' '				ie_tipo_icms,
	0				vl_contabil1,
	0				vl_contabil2,
	0				vl_contabil3,
	0				vl_contabil4,
	0				vl_contabil5,
	0				vl_pis,
	0				vl_cred_ativo,
	0				vl_ressarc_trib,
	0				vl_transf_credito,
	0				vl_compl_nf,
	0				vl_nao_tributado,
	0				cd_centro_custo_debito,
	0				cd_centro_custo_credito,
	0				vl_base_irpj1,
	0				vl_aliquota_irpj1,
	0				vl_base_irpj2,
	0				vl_aliquota_irpj2,
	0				vl_base_irpj3,
	0				vl_aliquota_irpj3,
	0				vl_base_irpj4,
	0				vl_aliquota_irpj4,
	0				vl_base_irpj5,
	0				vl_aliquota_irpj5,
	0				vl_deducoes_simples,
	substr(obter_nome_pf_pj(n.cd_pessoa_fisica, n.cd_cgc),1,80) nm_pessoa,
	CASE WHEN n.cd_pessoa_fisica IS NULL THEN  n.cd_cgc  ELSE substr(obter_dados_pf(n.cd_pessoa_fisica,'CPF'),1,11) END  cd_cnpj_cpf,
	CASE WHEN n.cd_cgc IS NULL THEN  CASE WHEN substr(obter_dados_pf(n.cd_pessoa_fisica,'CPF'),1,11) IS NULL THEN  '0'  ELSE '2' END   ELSE '1' END  ie_tipo_inscricao,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'E'),1,40) ds_endereco,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'B'),1,14) ds_bairro,
	substr(elimina_caracteres_especiais(substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'CEP'),1,9)),1,9) cd_cep,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'CI'),1,25) ds_municipio,
	CASE WHEN substr(obter_se_nota_entrada_saida(n.nr_sequencia),1,1)='S' THEN '9998'  ELSE '9999' END  cd_contabil,
	0				cd_cei_nit,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'IM'),1,14) nr_inscricao_municipal,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'T'),1,11) nr_telefone,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'F'),1,40) nm_fantasia,
	0				vl_base_calculo1,
	0				vl_aliquota1,
	0				vl_icms1,
	0				vl_base_calculo2,
	0				vl_aliquota2,
	0				vl_icms2,
	0				vl_base_calculo3,
	0				vl_aliquota3,
	0				vl_icms3,
	0				vl_base_calculo4,
	0				vl_aliquota4,
	0				vl_icms4,
	0				vl_base_calculo5,
	0				vl_aliquota5,
	0				vl_icms5,
	0				vl_isentas,
	0				vl_outras,
	0				vl_dif_aliquota,
	0				vl_aliquota_dif,
	' '				cd_dif_aliquota,
	0				ie_tipo_lancamento,
	' '				ie_apuracao,
	0				vl_base_calculo,
	0				pr_aliquota,
	0				vl_iss,
	0				vl_imposto_retido,
	0				vl_subst_tributo,
	0				vl_material,
	0				vl_subempreitadas,
	0				qt_total_reg,
	' '				ie_via_transporte,
	0				qt_volume,
	' '				ds_tipo_volume,
	0				qt_peso_bruto,
	0				qt_peso_liquido,
	1				ie_modalidade_frete,
	' '				ds_placa_veiculo,
	2				ie_forma_pagto,
	' '				nr_iscricao_estadual_trib,
	' '				ds_servico,
	0				vl_servico,
	0				vl_base_inss,
	0				pr_aliquota_inss,
	0				vl_inss,
	0				vl_base_irpf,
	0				pr_aliquota_irpf,
	0				vl_irpf,
	0				vl_base_iss,
	0				pr_aliquota_iss,
	0				vl_base_csll,
	0				pr_aliquota_csll,
	0				vl_csll,
	0				vl_base_cofins,
	0				pr_aliquota_cofins,
	0				vl_cofins,
	0				vl_base_pis,
	0				pr_aliquota_pis,
	0				nr_item_nf
from	estabelecimento e,
	nota_fiscal n
where	e.cd_estabelecimento = n.cd_estabelecimento

union

select	39				tp_registro,
	33				ds_registro,
	' '				cd_cnpj,
	' '				nr_inscricao_estadual,
	e.cd_estabelecimento,
	n.dt_entrada_saida			dt_entrada_saida,
	' '				ds_especie,
	CASE WHEN n.cd_serie_nf='1' THEN 'IS' END 	cd_serie_nf,
	n.nr_nota_fiscal			nr_nota_fiscal,
	n.cd_natureza_operacao		cd_natureza_operacao,
	n.cd_operacao_nf			cd_operacao_nf,
	'0'				cd_historico,
	substr(n.ds_observacao,1,25)		ds_observacao,
	0				cd_modelo_nf,
	0				cd_frete,
	0				cd_saida_exp,
	CASE WHEN n.ie_situacao='1' THEN '0'  ELSE '1' END  	ie_situacao,
	0				cd_subcodigo_fiscal,
	CASE WHEN n.cd_cgc_emitente=e.cd_cgc THEN 'S'  ELSE 'N' END  ie_nf_entrada,
	CASE WHEN upper(substr(obter_dados_pf_pj(null,n.cd_cgc_emitente,'CI'),1,40))='BLUMENAU' THEN 'N'  ELSE 'S' END  ie_fora_municipio,
	'N'				ie_bens_terceiro,
	e.cd_atividade_federal		cd_atividade,
	'1'				tp_nf_servico,
	'N'				ie_doc_eletronico,
	n.nr_sequencia			nr_seq_nf,
	n.dt_emissao,
	0				nr_sequencia,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'UF'),1,2) sg_estado,
	' '				ds_municipio_origem,
	0				cd_agrupamento,
	0				vl_contabil,
	0				vl_frete,
	0				vl_seguro,
	0				vl_despesa_acessoria,
	0				vl_descontos,
	0				vl_funrural,
	0				vl_base_icms,
	0				vl_icms_retido,
	0				cd_antecip_icms,
	' '				ie_tipo_icms,
	0				vl_contabil1,
	0				vl_contabil2,
	0				vl_contabil3,
	0				vl_contabil4,
	0				vl_contabil5,
	0				vl_pis,
	0				vl_cred_ativo,
	0				vl_ressarc_trib,
	0				vl_transf_credito,
	0				vl_compl_nf,
	0				vl_nao_tributado,
	0				cd_centro_custo_debito,
	0				cd_centro_custo_credito,
	0				vl_base_irpj1,
	0				vl_aliquota_irpj1,
	0				vl_base_irpj2,
	0				vl_aliquota_irpj2,
	0				vl_base_irpj3,
	0				vl_aliquota_irpj3,
	0				vl_base_irpj4,
	0				vl_aliquota_irpj4,
	0				vl_base_irpj5,
	0				vl_aliquota_irpj5,
	0				vl_deducoes_simples,
	substr(obter_nome_pf_pj(n.cd_pessoa_fisica, n.cd_cgc),1,80) nm_pessoa,
	CASE WHEN n.cd_pessoa_fisica IS NULL THEN  n.cd_cgc  ELSE substr(obter_dados_pf(n.cd_pessoa_fisica,'CPF'),1,11) END  cd_cnpj_cpf,
	CASE WHEN n.cd_cgc IS NULL THEN  CASE WHEN substr(obter_dados_pf(n.cd_pessoa_fisica,'CPF'),1,11) IS NULL THEN  '0'  ELSE '2' END   ELSE '1' END  ie_tipo_inscricao,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'E'),1,40) ds_endereco,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'B'),1,14) ds_bairro,
	substr(elimina_caracteres_especiais(substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'CEP'),1,9)),1,9) cd_cep,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'CI'),1,25) ds_municipio,
	CASE WHEN substr(obter_se_nota_entrada_saida(n.nr_sequencia),1,1)='S' THEN '9998'  ELSE '9999' END  cd_contabil,
	0				cd_cei_nit,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'IM'),1,14) nr_inscricao_municipal,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'T'),1,11) nr_telefone,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'F'),1,40) nm_fantasia,
	0				vl_base_calculo1,
	0				vl_aliquota1,
	0				vl_icms1,
	0				vl_base_calculo2,
	0				vl_aliquota2,
	0				vl_icms2,
	0				vl_base_calculo3,
	0				vl_aliquota3,
	0				vl_icms3,
	0				vl_base_calculo4,
	0				vl_aliquota4,
	0				vl_icms4,
	0				vl_base_calculo5,
	0				vl_aliquota5,
	0				vl_icms5,
	0				vl_isentas,
	0				vl_outras,
	0				vl_dif_aliquota,
	0				vl_aliquota_dif,
	' '				cd_dif_aliquota,
	0				ie_tipo_lancamento,
	' '				ie_apuracao,
	i.vl_total_item_nf			vl_base_calculo,
	(select coalesce(max(coalesce(x.tx_tributo,0)),0)
	from	nota_fiscal_item_trib x,
		tributo t
	where	n.nr_sequencia = x.nr_sequencia
	and	t.cd_tributo = x.cd_tributo
	and	x.nr_item_nf = i.nr_item_nf
	and	t.ie_tipo_tributo = 'ISS') 	pr_aliquota,
	(select coalesce(sum(coalesce(x.vl_tributo,0)),0)
	from	nota_fiscal_item_trib x,
		tributo t
	where	n.nr_sequencia = x.nr_sequencia
	and	t.cd_tributo = x.cd_tributo
	and	x.nr_item_nf = i.nr_item_nf
	and	t.ie_tipo_tributo = 'ISS') 	vl_iss,
	0				vl_imposto_retido,
	0				vl_subst_tributo,
	0				vl_material,
	0				vl_subempreitadas,
	0				qt_total_reg,
	' '				ie_via_transporte,
	0				qt_volume,
	' '				ds_tipo_volume,
	0				qt_peso_bruto,
	0				qt_peso_liquido,
	1				ie_modalidade_frete,
	' '				ds_placa_veiculo,
	1				ie_forma_pagto,
	' '				nr_iscricao_estadual_trib,
	coalesce(substr(obter_desc_material(i.cd_material),1,60),
	substr(obter_descricao_procedimento(i.cd_procedimento,i.ie_origem_proced),1,60)) ds_servico,
	i.vl_total_item_nf			vl_servico,
	CASE WHEN(select coalesce(max(coalesce(x.tx_tributo,0)),0)		from	nota_fiscal_item_trib x,			tributo t		where	n.nr_sequencia = x.nr_sequencia		and	t.cd_tributo = x.cd_tributo		and	x.nr_item_nf = i.nr_item_nf		and	t.ie_tipo_tributo = 'INSS')=0 THEN  0  ELSE i.vl_total_item_nf END  vl_base_inss,
	(select coalesce(max(coalesce(x.tx_tributo,0)),0)
	from	nota_fiscal_item_trib x,
		tributo t
	where	n.nr_sequencia = x.nr_sequencia
	and	t.cd_tributo = x.cd_tributo
	and	x.nr_item_nf = i.nr_item_nf
	and	t.ie_tipo_tributo = 'INSS') 	pr_aliquota_inss,
	(select coalesce(max(coalesce(x.vl_tributo,0)),0)
	from	nota_fiscal_item_trib x,
		tributo t
	where	n.nr_sequencia = x.nr_sequencia
	and	t.cd_tributo = x.cd_tributo
	and	x.nr_item_nf = i.nr_item_nf
	and	t.ie_tipo_tributo = 'INSS') 	vl_inss,
	0				vl_base_irpf,
	0				pr_aliquota_irpf,
	0				vl_irpf,
	0				vl_base_iss,
	0				pr_aliquota_iss,
	0				vl_base_csll,
	0				pr_aliquota_csll,
	0				vl_csll,
	0				vl_base_cofins,
	0				pr_aliquota_cofins,
	0				vl_cofins,
	0				vl_base_pis,
	0				pr_aliquota_pis,
	i.nr_item_nf			nr_item_nf
from	estabelecimento e,
	nota_fiscal_item i,
	nota_fiscal n
where	e.cd_estabelecimento = n.cd_estabelecimento
and	n.nr_sequencia = i.nr_sequencia

union

select	50				tp_registro,
	35				ds_registro,
	' '				cd_cnpj,
	' '				nr_inscricao_estadual,
	e.cd_estabelecimento,
	n.dt_entrada_saida			dt_entrada_saida,
	' '				ds_especie,
	CASE WHEN n.cd_serie_nf='1' THEN 'IS' END 	cd_serie_nf,
	n.nr_nota_fiscal			nr_nota_fiscal,
	n.cd_natureza_operacao		cd_natureza_operacao,
	n.cd_operacao_nf			cd_operacao_nf,
	'0'				cd_historico,
	substr(n.ds_observacao,1,25) 		ds_observacao,
	0				cd_modelo_nf,
	0				cd_frete,
	0				cd_saida_exp,
	CASE WHEN n.ie_situacao='1' THEN '0'  ELSE '1' END  	ie_situacao,
	0				cd_subcodigo_fiscal,
	CASE WHEN n.cd_cgc_emitente=e.cd_cgc THEN 'S'  ELSE 'N' END  ie_nf_entrada,
	CASE WHEN upper(substr(obter_dados_pf_pj(null,n.cd_cgc_emitente,'CI'),1,40))='BLUMENAU' THEN 'N'  ELSE 'S' END  ie_fora_municipio,
	'N'				ie_bens_terceiro,
	e.cd_atividade_federal		cd_atividade,
	'1'				tp_nf_servico,
	'N'				ie_doc_eletronico,
	n.nr_sequencia			nr_seq_nf,
	n.dt_emissao,
	0				nr_sequencia,
	substr(obter_dados_pf_pj(n.cd_pessoa_fisica, n.cd_cgc, 'UF'),1,2) sg_estado,
	' '				ds_municipio_origem,
	0				cd_agrupamento,
	0				vl_contabil,
	0				vl_frete,
	0				vl_seguro,
	0				vl_despesa_acessoria,
	0				vl_descontos,
	0				vl_funrural,
	0				vl_base_icms,
	0				vl_icms_retido,
	0				cd_antecip_icms,
	' '				ie_tipo_icms,
	0				vl_contabil1,
	0				vl_contabil2,
	0				vl_contabil3,
	0				vl_contabil4,
	0				vl_contabil5,
	(select coalesce(max(coalesce(x.vl_tributo,0)),0)
	from	nota_fiscal_trib x,
		tributo t
	where	n.nr_sequencia = x.nr_sequencia
	and	t.cd_tributo = x.cd_tributo
	and	upper(t.ds_tributo) = 'PIS') 	vl_pis,
	0				vl_cred_ativo,
	0				vl_ressarc_trib,
	0				vl_transf_credito,
	0				vl_compl_nf,
	0				vl_nao_tributado,
	0				cd_centro_custo_debito,
	0				cd_centro_custo_credito,
	0				vl_base_irpj1,
	0				vl_aliquota_irpj1,
	0				vl_base_irpj2,
	0				vl_aliquota_irpj2,
	0				vl_base_irpj3,
	0				vl_aliquota_irpj3,
	0				vl_base_irpj4,
	0				vl_aliquota_irpj4,
	0				vl_base_irpj5,
	0				vl_aliquota_irpj5,
	0				vl_deducoes_simples,
	' '				nm_pessoa,
	' '				cd_cnpj_cpf,
	' '				ie_tipo_inscricao,
	' '				ds_endereco,
	' '				ds_bairro,
	' '				cd_cep,
	' '				ds_municipio,
	'0'				cd_contabil,
	0				cd_cei_nit,
	' '				nr_inscricao_municipal,
	' '				nr_telefone,
	' '				nm_fantasia,
	0				vl_base_calculo1,
	0				vl_aliquota1,
	0				vl_icms1,
	0				vl_base_calculo2,
	0				vl_aliquota2,
	0				vl_icms2,
	0				vl_base_calculo3,
	0				vl_aliquota3,
	0				vl_icms3,
	0				vl_base_calculo4,
	0				vl_aliquota4,
	0				vl_icms4,
	0				vl_base_calculo5,
	0				vl_aliquota5,
	0				vl_icms5,
	0				vl_isentas,
	0				vl_outras,
	0				vl_dif_aliquota,
	0				vl_aliquota_dif,
	' '				cd_dif_aliquota,
	0				ie_tipo_lancamento,
	' '				ie_apuracao,
	0				vl_base_calculo,
	0				pr_aliquota,
	(select coalesce(max(coalesce(x.vl_tributo,0)),0)
	from	nota_fiscal_trib x,
		tributo t
	where	n.nr_sequencia = x.nr_sequencia
	and	t.cd_tributo = x.cd_tributo
	and	t.ie_tipo_tributo = 'ISSQN') 	vl_iss,
	0				vl_imposto_retido,
	0				vl_subst_tributo,
	0				vl_material,
	0				vl_subempreitadas,
	0				qt_total_reg,
	' '				ie_via_transporte,
	0				qt_volume,
	' '				ds_tipo_volume,
	0				qt_peso_bruto,
	0				qt_peso_liquido,
	1				ie_modalidade_frete,
	' '				ds_placa_veiculo,
	1				ie_forma_pagto,
	' '				nr_iscricao_estadual_trib,
	' '				ds_servico,
	0				vl_servico,
	CASE WHEN(select coalesce(max(coalesce(x.tx_tributo,0)),0)		from	nota_fiscal_trib x,			tributo t		where	n.nr_sequencia = x.nr_sequencia		and	t.cd_tributo = x.cd_tributo		and	t.ie_tipo_tributo = 'INSS')=0 THEN  0  ELSE n.vl_mercadoria END  vl_base_inss,
	(select coalesce(max(coalesce(x.tx_tributo,0)),0)
	from	nota_fiscal_trib x,
		tributo t
	where	n.nr_sequencia = x.nr_sequencia
	and	t.cd_tributo = x.cd_tributo
	and	t.ie_tipo_tributo = 'INSS') 	pr_aliquota_inss,
	(select coalesce(max(coalesce(x.vl_tributo,0)),0)
	from	nota_fiscal_trib x,
		tributo t
	where	n.nr_sequencia = x.nr_sequencia
	and	t.cd_tributo = x.cd_tributo
	and	t.ie_tipo_tributo = 'INSS')	vl_inss,
	CASE WHEN(select coalesce(max(coalesce(x.tx_tributo,0)),0)		from	nota_fiscal_trib x,			tributo t		where	n.nr_sequencia = x.nr_sequencia		and	t.cd_tributo = x.cd_tributo		and	t.ie_tipo_tributo = 'IR')=0 THEN  0  ELSE n.vl_mercadoria END  vl_base_irpf,
	(select coalesce(max(coalesce(x.tx_tributo,0)),0)
	from	nota_fiscal_trib x,
		tributo t
	where	n.nr_sequencia = x.nr_sequencia
	and	t.cd_tributo = x.cd_tributo
	and	t.ie_tipo_tributo = 'IR') 	pr_aliquota_irpf,
	(select coalesce(max(coalesce(x.vl_tributo,0)),0)
	from	nota_fiscal_trib x,
		tributo t
	where	n.nr_sequencia = x.nr_sequencia
	and	t.cd_tributo = x.cd_tributo
	and	t.ie_tipo_tributo = 'IR') 	vl_irpf,
	CASE WHEN(select coalesce(max(coalesce(x.tx_tributo,0)),0)		from	nota_fiscal_trib x,			tributo t		where	n.nr_sequencia = x.nr_sequencia		and	t.cd_tributo = x.cd_tributo		and	t.ie_tipo_tributo = 'ISSQN')=0 THEN  0  ELSE n.vl_mercadoria END  vl_base_iss,
	(select coalesce(max(coalesce(x.tx_tributo,0)),0)
	from	nota_fiscal_trib x,
		tributo t
	where	n.nr_sequencia = x.nr_sequencia
	and	t.cd_tributo = x.cd_tributo
	and	t.ie_tipo_tributo = 'ISSQN') pr_aliquota_iss,
	CASE WHEN(select coalesce(max(coalesce(x.tx_tributo,0)),0)		from	nota_fiscal_trib x,			tributo t		where	n.nr_sequencia = x.nr_sequencia		and	t.cd_tributo = x.cd_tributo		and	upper(t.ds_tributo) = 'CSLL')=0 THEN  0  ELSE n.vl_mercadoria END  vl_base_csll,
	(select coalesce(max(coalesce(x.tx_tributo,0)),0)
	from	nota_fiscal_trib x,
		tributo t
	where	n.nr_sequencia = x.nr_sequencia
	and	t.cd_tributo = x.cd_tributo
	and	upper(t.ds_tributo) = 'CSLL') pr_aliquota_csll,
	(select coalesce(max(coalesce(x.vl_tributo,0)),0)
	from	nota_fiscal_trib x,
		tributo t
	where	n.nr_sequencia = x.nr_sequencia
	and	t.cd_tributo = x.cd_tributo
	and	upper(t.ds_tributo) = 'CSLL') vl_csll,
	CASE WHEN(select coalesce(max(coalesce(x.tx_tributo,0)),0)		from	nota_fiscal_trib x,			tributo t		where	n.nr_sequencia = x.nr_sequencia		and	t.cd_tributo = x.cd_tributo		and	upper(t.ds_tributo) = 'COFINS')=0 THEN  0  ELSE n.vl_mercadoria END  vl_base_cofins,
	(select coalesce(max(coalesce(x.tx_tributo,0)),0)
	from	nota_fiscal_trib x,
		tributo t
	where	n.nr_sequencia = x.nr_sequencia
	and	t.cd_tributo = x.cd_tributo
	and	upper(t.ds_tributo) = 'COFINS') pr_aliquota_cofins,
	(select coalesce(max(coalesce(x.vl_tributo,0)),0)
	from	nota_fiscal_trib x,
		tributo t
	where	n.nr_sequencia = x.nr_sequencia
	and	t.cd_tributo = x.cd_tributo
	and	upper(t.ds_tributo) = 'COFINS') vl_cofins,
	CASE WHEN(select coalesce(max(coalesce(x.tx_tributo,0)),0)		from	nota_fiscal_trib x,			tributo t		where	n.nr_sequencia = x.nr_sequencia		and	t.cd_tributo = x.cd_tributo		and	upper(t.ds_tributo) = 'PIS')=0 THEN  0  ELSE n.vl_mercadoria END  vl_base_pis,
	(select coalesce(max(coalesce(x.tx_tributo,0)),0)
	from	nota_fiscal_trib x,
		tributo t
	where	n.nr_sequencia = x.nr_sequencia
	and	t.cd_tributo = x.cd_tributo
	and	upper(t.ds_tributo) = 'PIS') 	pr_aliquota_pis,
	0				nr_item_nf
from	estabelecimento e,
	nota_fiscal n
where	e.cd_estabelecimento = n.cd_estabelecimento

union

select	90				tp_registro,
	90				ds_registro,
	' '				cd_cnpj,
	' '				nr_inscricao_estadual,
	e.cd_estabelecimento,
	to_date(null)			dt_entrada_saida,
	' '				ds_especie,
	'0'				cd_serie_nf,
	'9999999'			nr_nota_fiscal,
	0				cd_natureza_operacao,
	0				cd_operacao_nf,
	'0'				cd_historico,
	' '			 	ds_observacao,
	0				cd_modelo_nf,
	0				cd_frete,
	0				cd_saida_exp,
	' '				ie_situacao,
	0				cd_subcodigo_fiscal,
	' '				ie_nf_entrada,
	' '				ie_fora_municipio,
	'N'				ie_bens_terceiro,
	e.cd_atividade_federal		cd_atividade,
	'1'				tp_nf_servico,
	'N'				ie_doc_eletronico,
	9999999				nr_seq_nf,
	to_date(null)			dt_emissao,
	0				nr_sequencia,
	' '				sg_estado,
	' '				ds_municipio_origem,
	0				cd_agrupamento,
	0				vl_contabil,
	0				vl_frete,
	0				vl_seguro,
	0				vl_despesa_acessoria,
	0				vl_descontos,
	0				vl_funrural,
	0				vl_base_icms,
	0				vl_icms_retido,
	0				cd_antecip_icms,
	' '				ie_tipo_icms,
	0				vl_contabil1,
	0				vl_contabil2,
	0				vl_contabil3,
	0				vl_contabil4,
	0				vl_contabil5,
	0				vl_pis,
	0				vl_cred_ativo,
	0				vl_ressarc_trib,
	0				vl_transf_credito,
	0				vl_compl_nf,
	0				vl_nao_tributado,
	0				cd_centro_custo_debito,
	0				cd_centro_custo_credito,
	0				vl_base_irpj1,
	0				vl_aliquota_irpj1,
	0				vl_base_irpj2,
	0				vl_aliquota_irpj2,
	0				vl_base_irpj3,
	0				vl_aliquota_irpj3,
	0				vl_base_irpj4,
	0				vl_aliquota_irpj4,
	0				vl_base_irpj5,
	0				vl_aliquota_irpj5,
	0				vl_deducoes_simples,
	' '				nm_pessoa,
	' '				cd_cnpj_cpf,
	' '				ie_tipo_inscricao,
	' '				ds_endereco,
	' '				ds_bairro,
	' '				cd_cep,
	' '				ds_municipio,
	'0'				cd_contabil,
	0				cd_cei_nit,
	' '				nr_inscricao_municipal,
	' '				nr_telefone,
	' '				nm_fantasia,
	0				vl_base_calculo1,
	0				vl_aliquota1,
	0				vl_icms1,
	0				vl_base_calculo2,
	0				vl_aliquota2,
	0				vl_icms2,
	0				vl_base_calculo3,
	0				vl_aliquota3,
	0				vl_icms3,
	0				vl_base_calculo4,
	0				vl_aliquota4,
	0				vl_icms4,
	0				vl_base_calculo5,
	0				vl_aliquota5,
	0				vl_icms5,
	0				vl_isentas,
	0				vl_outras,
	0				vl_dif_aliquota,
	0				vl_aliquota_dif,
	' '				cd_dif_aliquota,
	0				ie_tipo_lancamento,
	' '				ie_apuracao,
	0				vl_base_calculo,
	0				pr_aliquota,
	0				vl_iss,
	0				vl_imposto_retido,
	0				vl_subst_tributo,
	0				vl_material,
	0				vl_subempreitadas,
	0				qt_total_reg,
	' '				ie_via_transporte,
	0				qt_volume,
	' '				ds_tipo_volume,
	0				qt_peso_bruto,
	0				qt_peso_liquido,
	1				ie_modalidade_frete,
	' '				ds_placa_veiculo,
	1				ie_forma_pagto,
	' '				nr_iscricao_estadual_trib,
	' '				ds_servico,
	0				vl_servico,
	0				vl_base_inss,
	0				pr_aliquota_inss,
	0				vl_inss,
	0				vl_base_irpf,
	0				pr_aliquota_irpf,
	0				vl_irpf,
	0				vl_base_iss,
	0				pr_aliquota_iss,
	0				vl_base_csll,
	0				pr_aliquota_csll,
	0				vl_csll,
	0				vl_base_cofins,
	0				pr_aliquota_cofins,
	0				vl_cofins,
	0				vl_base_pis,
	0				pr_aliquota_pis,
	99999				nr_item_nf
from	estabelecimento_v e
where	1=1
;

