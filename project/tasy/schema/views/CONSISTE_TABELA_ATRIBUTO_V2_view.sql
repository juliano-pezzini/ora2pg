-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW consiste_tabela_atributo_v2 (ds_comando) AS SELECT	'ALTER TABLE ' || a.nm_tabela || ' ADD ' || a.nm_atributo || ' ' ||
        CASE WHEN a.ie_tipo_atributo='VARCHAR2' THEN a.ie_tipo_atributo||'('||a.qt_tamanho || ')' WHEN a.ie_tipo_atributo='NUMBER' THEN a.ie_tipo_atributo||'('||a.qt_tamanho ||','||a.qt_decimais ||')'  ELSE a.ie_tipo_atributo END  || ';' ds_comando
FROM	tabela_atributo a,
	tabela_sistema b
WHERE	a.nm_tabela		= b.nm_tabela
  AND	GERAR_OBJETO_APLICACAO(b.ds_aplicacao) = 'S'
  AND	a.ie_tipo_atributo	not in ('FUNCTION','VISUAL')
  AND	NOT EXISTS (	SELECT	1
	   	  	FROM	user_tab_columns c
			WHERE	UPPER(a.nm_tabela) = c.table_name
			  AND	UPPER(a.nm_atributo) = c.column_name);

