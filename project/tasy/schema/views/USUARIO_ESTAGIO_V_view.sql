-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW usuario_estagio_v (nr_sequencia, nr_seq_ordem, nm_usuario, dt_atualizacao, ds_estagio, qt_minutos_estagio, qt_dias_estagio, ds_nivel_solucao, ds_tipo_solucao, ds_motivo_ag_cliente) AS SELECT	nr_sequencia,
		nr_seq_ordem,
		nm_usuario,
		dt_atualizacao,
		ds_estagio,
		qt_minutos_estagio,
		ROUND(qt_minutos_estagio / 1440) qt_dias_estagio,
		ds_nivel_solucao,
		ds_tipo_solucao,
		ds_motivo_ag_cliente
	FROM (SELECT	a.nr_sequencia,
			a.nr_seq_ordem,
		  a.nm_usuario,
		  a.dt_atualizacao,
		  substr(obter_desc_expressao(b.cd_exp_estagio,b.ds_estagio),1,40) ds_estagio,
		  man_obter_tempo_estagio(a.nr_sequencia,a.nr_seq_ordem,'M') qt_minutos_estagio,
		  SUBSTR(obter_valor_dominio(2080, a.ie_nivel_solucao),1,40) ds_nivel_solucao,
		  substr(obter_desc_expressao(c.cd_exp_solucao, c.ds_solucao),1,80) ds_tipo_solucao,
		  SUBSTR(obter_valor_dominio(4031,a.ie_motivo_ag_cliente),1,240) ds_motivo_ag_cliente
	FROM man_estagio_processo b, man_ordem_serv_estagio a
LEFT OUTER JOIN man_tipo_solucao c ON (a.nr_seq_tipo_solucao = c.nr_sequencia)
WHERE b.nr_sequencia 		= a.nr_seq_estagio  ) alias10
	order by nr_sequencia desc;

