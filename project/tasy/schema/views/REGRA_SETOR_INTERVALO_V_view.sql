-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW regra_setor_intervalo_v (ie_tipo_item, nr_atendimento, nr_prescricao, dt_liberacao, dt_liberacao_medico, nr_seq_proc, nr_seq_pe_prescr_proc, cd_intervalo, dt_horario, dt_inicio_prescr, dt_validade_prescr, cd_procedimento, ie_origem_proced, nr_seq_proc_interno, nr_seq_pe_proc, nr_seq_prot_glic, ie_acm, ie_se_necessario, cd_setor_atendimento, dt_lib_horario, cd_pessoa_fisica, cd_setor_prescr) AS select	'P' ie_tipo_item,
		a.nr_atendimento,
		a.nr_prescricao,
		a.dt_liberacao,
		a.dt_liberacao_medico,
		b.nr_sequencia nr_seq_proc,
		null nr_seq_pe_prescr_proc,
		b.cd_intervalo,
		c.dt_horario,
		a.dt_inicio_prescr,
		a.dt_validade_prescr,
		b.cd_procedimento,
		b.ie_origem_proced,
		b.nr_seq_proc_interno,
		null nr_seq_pe_proc,
		null nr_seq_prot_glic,
		b.ie_acm,
		b.ie_se_necessario,
		b.cd_setor_atendimento,
		c.dt_lib_horario,
		a.cd_pessoa_fisica,
		a.cd_setor_atendimento cd_setor_prescr
	FROM	prescr_proc_hor c,
		prescr_procedimento b,
		prescr_medica a
	where	c.nr_prescricao = b.nr_prescricao
	and	c.nr_seq_procedimento = b.nr_sequencia
	and	b.nr_prescricao = a.nr_prescricao
	and	coalesce(a.ie_adep,'S') = 'S'
	and	b.nr_seq_solic_sangue is null
	and	b.nr_seq_derivado is null
	and	b.nr_seq_exame is null
	and	b.nr_seq_prot_glic is null
	and	coalesce(c.ie_situacao,'A') = 'A'
	group by
		'P',
		a.nr_atendimento,
		a.nr_prescricao,
		a.dt_liberacao,
		a.dt_liberacao_medico,
		b.nr_sequencia,
		b.cd_intervalo,
		c.dt_horario,
		a.dt_inicio_prescr,
		a.dt_validade_prescr,
		b.cd_procedimento,
		b.ie_origem_proced,
		b.nr_seq_proc_interno,
		b.ie_acm,
		b.ie_se_necessario,
		b.cd_setor_atendimento,
		c.dt_lib_horario,
		a.cd_pessoa_fisica,
		a.cd_setor_atendimento
	
union

	select	'G' ie_tipo_item,
		a.nr_atendimento,
		a.nr_prescricao,
		a.dt_liberacao,
		a.dt_liberacao_medico,
		b.nr_sequencia nr_seq_proc,
		null nr_seq_pe_prescr_proc,
		b.cd_intervalo,
		c.dt_horario,
		a.dt_inicio_prescr,
		a.dt_validade_prescr,
		b.cd_procedimento,
		b.ie_origem_proced,
		b.nr_seq_proc_interno,
		null nr_seq_pe_proc,
		b.nr_seq_prot_glic,
		b.ie_acm,
		b.ie_se_necessario,
		b.cd_setor_atendimento,
		c.dt_lib_horario,
		a.cd_pessoa_fisica,
		a.cd_setor_atendimento cd_setor_prescr
	from	prescr_proc_hor c,
		prescr_procedimento b,
		prescr_medica a,
		pep_protocolo_glicemia d
	where	c.nr_prescricao = b.nr_prescricao
	and	c.nr_seq_procedimento = b.nr_sequencia
	and	d.nr_sequencia	= b.nr_seq_prot_glic
	and	d.ie_tipo	= 'C'
	and	b.nr_prescricao = a.nr_prescricao
	and	coalesce(a.ie_adep,'S') = 'S'
	and	b.nr_seq_solic_sangue is null
	and	b.nr_seq_derivado is null
	and	b.nr_seq_exame is null
	and	b.nr_seq_proc_interno is not null
	and	b.nr_seq_prot_glic is not null
	and	coalesce(c.ie_situacao,'A') = 'A'
	group by
		'G',
		a.nr_atendimento,
		a.nr_prescricao,
		a.dt_liberacao,
		a.dt_liberacao_medico,
		b.nr_sequencia,
		b.cd_intervalo,
		c.dt_horario,
		a.dt_inicio_prescr,
		a.dt_validade_prescr,
		b.cd_procedimento,
		b.ie_origem_proced,
		b.nr_seq_proc_interno,
		b.ie_acm,
		b.ie_se_necessario,
		b.nr_seq_prot_glic,
		b.cd_setor_atendimento,
		c.dt_lib_horario,
		a.cd_pessoa_fisica,
		a.cd_setor_atendimento
	
union

	select	'C' ie_tipo_item,
		a.nr_atendimento,
		a.nr_prescricao,
		a.dt_liberacao,
		a.dt_liberacao_medico,
		b.nr_sequencia nr_seq_proc,
		null nr_seq_pe_prescr_proc,
		b.cd_intervalo,
		c.dt_horario,
		a.dt_inicio_prescr,
		a.dt_validade_prescr,
		b.cd_procedimento,
		b.ie_origem_proced,
		b.nr_seq_proc_interno,
		null nr_seq_pe_proc,
		null nr_seq_prot_glic,
		b.ie_acm,
		b.ie_se_necessario,
		b.cd_setor_atendimento,
		c.dt_lib_horario,
		a.cd_pessoa_fisica,
		a.cd_setor_atendimento cd_setor_prescr
	from	prescr_proc_hor c,
		prescr_procedimento b,
		prescr_medica a
	where	c.nr_prescricao = b.nr_prescricao
	and	c.nr_seq_procedimento = b.nr_sequencia
	and	b.nr_prescricao = a.nr_prescricao
	and	coalesce(a.ie_adep,'S') = 'S'
	and	b.nr_seq_solic_sangue is null
	and	b.nr_seq_derivado is null
	and	b.nr_seq_exame is null
	and	b.nr_seq_proc_interno is not null
	and	coalesce(c.ie_situacao,'A') = 'A'
	group by
		'C',
		a.nr_atendimento,
		a.nr_prescricao,
		a.dt_liberacao,
		a.dt_liberacao_medico,
		b.nr_sequencia,
		b.cd_intervalo,
		c.dt_horario,
		a.dt_inicio_prescr,
		a.dt_validade_prescr,
		b.cd_procedimento,
		b.ie_origem_proced,
		b.nr_seq_proc_interno,
		b.ie_acm,
		b.ie_se_necessario,
		b.cd_setor_atendimento,
		c.dt_lib_horario,
		a.cd_pessoa_fisica,
		a.cd_setor_atendimento
	
union

	select	'E' ie_tipo_item,
		a.nr_atendimento,
		a.nr_sequencia nr_prescricao,
		a.dt_liberacao,
		null,
		null nr_seq_proc,
		x.nr_sequencia nr_seq_pe_prescr_proc,
		x.cd_intervalo,
		c.dt_horario,
		a.dt_inicio_prescr,
		a.dt_validade_prescr,
		null cd_procedimento,
		null ie_origem_proced,
		null nr_seq_proc_interno,
		y.nr_sequencia nr_seq_pe_proc,
		null nr_seq_prot_glic,
		null ie_acm,
		x.ie_se_necessario,
		a.cd_setor_atendimento,
		c.dt_lib_horario,
		a.cd_pessoa_fisica,
		a.cd_setor_atendimento cd_setor_prescr
	FROM pe_procedimento y, pe_prescr_proc_hor c, pe_prescricao a, pe_prescr_proc x
LEFT OUTER JOIN intervalo_prescricao w ON (x.cd_intervalo = w.cd_intervalo)
WHERE y.nr_sequencia = x.nr_seq_proc and y.nr_sequencia = c.nr_seq_proc and x.nr_seq_prescr = c.nr_seq_pe_prescr and x.nr_sequencia = c.nr_seq_pe_proc and x.nr_seq_prescr = a.nr_sequencia and c.nr_seq_pe_prescr = a.nr_sequencia and a.dt_liberacao is not null and coalesce(x.ie_adep,'S') = 'S' and coalesce(c.ie_situacao,'A') = 'A' and coalesce(a.ie_situacao,'A') <> 'I' group by
		'E',
		a.nr_atendimento,
		a.nr_prescricao,
		a.dt_liberacao,
		y.ds_procedimento,
		x.nr_sequencia,
		x.cd_intervalo,
		c.dt_horario,
		x.ie_se_necessario,
		a.dt_inicio_prescr,
		a.dt_validade_prescr,
		y.nr_sequencia,
		a.cd_setor_atendimento,
		c.dt_lib_horario,
		a.cd_pessoa_fisica,
		a.cd_setor_atendimento,
		a.nr_sequencia;

