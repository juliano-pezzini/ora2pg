-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW adep_nut_v (nr_atendimento, nr_prescricao, cd_prescritor, nm_prescritor, dt_prescricao, dt_inicio_prescr, dt_validade_prescr, dt_liberacao, dt_alteracao, ie_tipo_solucao, nr_seq_solucao, ie_acm, ds_npt, ds_solucao, ie_via, ie_bi, ie_unidade_veloc, nr_etapas_adep, nr_etapas_suspensa, nr_etapas, qt_volume_suspenso, qt_volume_original, qt_velocidade_original, qt_volume_infundido, qt_volume_desprezado, qt_volume_pendente, qt_volume_etapa, qt_velocidade_atual, ie_status, ds_status, dt_status, nr_seq_evento, ie_evento, dt_evento, cd_pessoa_evento, nm_pessoa_evento, ie_evento_valido, nr_seq_assinatura_prescr) AS select	a.nr_atendimento,
	a.nr_prescricao, 
	a.cd_prescritor, 
	substr(obter_nome_pf(a.cd_prescritor),1,60) nm_prescritor, 
	a.dt_prescricao, 
	a.dt_inicio_prescr, 
	a.dt_validade_prescr, 
	a.dt_liberacao, 
	c.dt_alteracao, 
	c.ie_tipo_solucao ie_tipo_solucao, 
	b.nr_sequencia nr_seq_solucao, 
	b.ie_acm ie_acm, 
	null ds_npt, 
	substr(obter_desc_material(b.cd_material),1,240) ds_solucao, 
	--substr(obter_componentes_solucao(b.nr_prescricao,b.nr_sequencia,'N'),1,2000) ds_componentes, 
	b.ie_via_aplicacao ie_via, 
	b.ie_bomba_infusao ie_bi, 
	b.cd_unidade_medida_dose ie_unidade_veloc, 
	--b.qt_tempo_aplicacao qt_tempo_solucao, 
	obter_etapas_adep_sol(2,b.nr_prescricao,b.nr_sequencia) nr_etapas_adep, 
	0 nr_etapas_suspensa, 
	null nr_etapas, 
	--b.qt_volume qt_volume_etapa, 
	--b.qt_hora_fase qt_tempo_etapa, 
	0 qt_volume_suspenso, 
	b.qt_dose qt_volume_original, 
	b.qt_vel_infusao qt_velocidade_original, 
	obter_dados_solucao(2,b.nr_prescricao,b.nr_sequencia,'VI') qt_volume_infundido, 
	obter_dados_solucao(2,b.nr_prescricao,b.nr_sequencia,'VD') qt_volume_desprezado, 
	obter_dados_solucao(2,b.nr_prescricao,b.nr_sequencia,'VR') qt_volume_pendente, 
	b.qt_dose qt_volume_etapa, 
	coalesce(obter_dados_solucao(2,b.nr_prescricao,b.nr_sequencia,'VA'),b.qt_vel_infusao) qt_velocidade_atual, 
	b.ie_status, 
	CASE WHEN b.ie_status='N' THEN 'Normal' WHEN b.ie_status='I' THEN 'Em andamento' WHEN b.ie_status='INT' THEN 'Interrompida' WHEN b.ie_status='T' THEN 'Encerrada' WHEN b.ie_status='V' THEN 'Vencida' END  ds_status, 
	b.dt_status, 
	c.nr_sequencia nr_seq_evento, 
	c.ie_alteracao ie_evento, 
	c.dt_alteracao dt_evento, 
	c.cd_pessoa_fisica cd_pessoa_evento, 
	substr(obter_nome_pf(c.cd_pessoa_fisica),1,60) nm_pessoa_evento, 
	c.ie_evento_valido, 
	a.nr_seq_assinatura nr_seq_assinatura_prescr 
FROM	prescr_solucao_evento c, 
	prescr_material b, 
	prescr_medica a 
where	c.nr_seq_material = b.nr_sequencia 
and	c.nr_prescricao = b.nr_prescricao 
and	b.nr_prescricao = a.nr_prescricao 
and	c.ie_tipo_solucao = 2 
and	a.nr_atendimento is not null 
/* criada nova view adep_hem_v 
union 
select	a.nr_atendimento, 
	a.nr_prescricao, 
	a.cd_prescritor, 
	substr(obter_nome_pf(a.cd_prescritor),1,60) nm_prescritor, 
	a.dt_prescricao, 
	a.dt_inicio_prescr, 
	a.dt_validade_prescr, 
	a.dt_liberacao, 
	c.ie_tipo_solucao ie_tipo_solucao, 
	b.nr_sequencia nr_seq_solucao, 
	b.ie_acm ie_acm, 
	substr(obter_desc_san_derivado(b.nr_seq_derivado),1,240) ds_solucao, 
	--substr(obter_componentes_solucao(b.nr_prescricao,b.nr_sequencia,'N'),1,2000) ds_componentes, 
	'IV' ie_via, 
	'N' ie_bi, 
	b.cd_unid_med_sangue ie_unidade_veloc, 
	--b.qt_tempo_aplicacao qt_tempo_solucao, 
	obter_etapas_adep_sol(3,b.nr_prescricao,b.nr_sequencia) nr_etapas_adep, 
	b.qt_procedimento nr_etapas, 
	--b.qt_volume qt_volume_etapa, 
	--b.qt_hora_fase qt_tempo_etapa, 
	b.qt_vol_hemocomp qt_volume_original, 
	b.qt_veloc_inf_hemo qt_velocidade_original, 
	obter_dados_solucao(3,b.nr_prescricao,b.nr_sequencia,'VI') qt_volume_infundido, 
	obter_dados_solucao(3,b.nr_prescricao,b.nr_sequencia,'VD') qt_volume_desprezado, 
	obter_dados_solucao(3,b.nr_prescricao,b.nr_sequencia,'VR') qt_volume_pendente, 
	nvl(obter_dados_solucao(3,b.nr_prescricao,b.nr_sequencia,'VA'),b.qt_veloc_inf_hemo) qt_velocidade_atual, 
	b.ie_status, 
	decode(b.ie_status,'N','Normal','I','Em andamento','INT','Interrompida','T','Encerrada','V','Vencida') ds_status, 
	b.dt_status, 
	c.nr_sequencia nr_seq_evento, 
	c.ie_alteracao ie_evento, 
	c.dt_alteracao dt_evento, 
	c.cd_pessoa_fisica cd_pessoa_evento, 
	substr(obter_nome_pf(c.cd_pessoa_fisica),1,60) nm_pessoa_evento, 
	c.ie_evento_valido 
from	prescr_solucao_evento c, 
	prescr_procedimento b, 
	prescr_medica a 
where	c.nr_seq_procedimento = b.nr_sequencia 
and	c.nr_prescricao = b.nr_prescricao 
and	b.nr_prescricao = a.nr_prescricao 
and	c.ie_tipo_solucao = 3 
and	b.nr_seq_solic_sangue is not null 
and	b.nr_seq_derivado is not null 
and	a.nr_atendimento is not null 
*/
 

union
 
select	a.nr_atendimento, 
	a.nr_prescricao, 
	a.cd_prescritor, 
	substr(obter_nome_pf(a.cd_prescritor),1,60) nm_prescritor, 
	a.dt_prescricao, 
	a.dt_inicio_prescr, 
	a.dt_validade_prescr, 
	a.dt_liberacao, 
	c.dt_alteracao, 
	c.ie_tipo_solucao ie_tipo_solucao, 
	b.nr_sequencia nr_seq_solucao, 
	'N' ie_acm, 
	'NPT Adulta' ds_npt, 
	'NPT Adulta' ds_solucao, 
	--substr(obter_componentes_solucao(b.nr_prescricao,b.nr_sequencia,'N'),1,2000) ds_componentes, 
	'IV' ie_via, 
	b.ie_bomba_infusao ie_bi, 
	'ml/h' ie_unidade_veloc, 
	--b.qt_tempo_aplicacao qt_tempo_solucao, 
	obter_etapas_adep_sol(4,b.nr_prescricao,b.nr_sequencia) nr_etapas_adep, 
	0 nr_etapas_suspensa, 
	b.qt_fase_npt nr_etapas, 
	--b.qt_volume qt_volume_etapa, 
	--b.qt_hora_fase qt_tempo_etapa, 
	0 qt_volume_suspenso, 
	obter_vol_nut_pac_fase(b.nr_sequencia,0) qt_volume_original, 
	b.qt_gotejamento_npt qt_velocidade_original, 
	obter_dados_solucao(4,b.nr_prescricao,b.nr_sequencia,'VI') qt_volume_infundido, 
	obter_dados_solucao(4,b.nr_prescricao,b.nr_sequencia,'VD') qt_volume_desprezado, 
	obter_dados_solucao(4,b.nr_prescricao,b.nr_sequencia,'VR') qt_volume_pendente, 
	b.qt_volume_adep qt_volume_etapa, 
	coalesce(obter_dados_solucao(4,b.nr_prescricao,b.nr_sequencia,'VA'),b.qt_gotejamento_npt) qt_velocidade_atual, 
	b.ie_status, 
	CASE WHEN b.ie_status='N' THEN 'Normal' WHEN b.ie_status='I' THEN 'Em andamento' WHEN b.ie_status='INT' THEN 'Interrompida' WHEN b.ie_status='T' THEN 'Encerrada' WHEN b.ie_status='V' THEN 'Vencida' END  ds_status, 
	b.dt_status, 
	c.nr_sequencia nr_seq_evento, 
	c.ie_alteracao ie_evento, 
	c.dt_alteracao dt_evento, 
	c.cd_pessoa_fisica cd_pessoa_evento, 
	substr(obter_nome_pf(c.cd_pessoa_fisica),1,60) nm_pessoa_evento, 
	c.ie_evento_valido, 
	a.nr_seq_assinatura nr_seq_assinatura_prescr 
from	prescr_solucao_evento c, 
	nut_paciente b, 
	prescr_medica a 
where	c.nr_seq_nut = b.nr_sequencia 
and	c.nr_prescricao = b.nr_prescricao 
and	b.nr_prescricao = a.nr_prescricao 
and	c.ie_tipo_solucao = 4 
and	a.nr_atendimento is not null 

union
 
select	a.nr_atendimento, 
	a.nr_prescricao, 
	a.cd_prescritor, 
	substr(obter_nome_pf(a.cd_prescritor),1,60) nm_prescritor, 
	a.dt_prescricao, 
	a.dt_inicio_prescr, 
	a.dt_validade_prescr, 
	a.dt_liberacao, 
	c.dt_alteracao, 
	c.ie_tipo_solucao ie_tipo_solucao, 
	b.nr_sequencia nr_seq_solucao, 
	'N' ie_acm, 
	CASE WHEN b.ie_forma='P' THEN  'Protocolo ' || obter_desc_prot_npt(b.nr_seq_protocolo)  ELSE obter_valor_dominio(1988,b.ie_forma) END  ds_npt, 
	'NPT Neonatal' ds_solucao, 
	--substr(obter_componentes_solucao(b.nr_prescricao,b.nr_sequencia,'N'),1,2000) ds_componentes, 
	'IV' ie_via, 
	'N' ie_bi, 
	'ml/h' ie_unidade_veloc, 
	--b.qt_tempo_aplicacao qt_tempo_solucao, 
	obter_etapas_adep_sol(5,b.nr_prescricao,b.nr_sequencia) nr_etapas_adep, 
	0 nr_etapas_suspensa, 
	b.qt_fase_npt nr_etapas, 
	--b.qt_volume qt_volume_etapa, 
	--b.qt_hora_fase qt_tempo_etapa, 
	0 qt_volume_suspenso, 
	obter_volume_nut_pac_neo(b.nr_sequencia) qt_volume_original, 
	b.qt_gotejo_npt qt_velocidade_original, 
	obter_dados_solucao(5,b.nr_prescricao,b.nr_sequencia,'VI') qt_volume_infundido, 
	obter_dados_solucao(5,b.nr_prescricao,b.nr_sequencia,'VD') qt_volume_desprezado, 
	obter_dados_solucao(5,b.nr_prescricao,b.nr_sequencia,'VR') qt_volume_pendente, 
	b.qt_volume_adep qt_volume_etapa, 
	coalesce(obter_dados_solucao(5,b.nr_prescricao,b.nr_sequencia,'VA'),b.qt_gotejo_npt) qt_velocidade_atual, 
	b.ie_status, 
	CASE WHEN b.ie_status='N' THEN 'Normal' WHEN b.ie_status='I' THEN 'Em andamento' WHEN b.ie_status='INT' THEN 'Interrompida' WHEN b.ie_status='T' THEN 'Encerrada' WHEN b.ie_status='V' THEN 'Vencida' END  ds_status, 
	b.dt_status, 
	c.nr_sequencia nr_seq_evento, 
	c.ie_alteracao ie_evento, 
	c.dt_alteracao dt_evento, 
	c.cd_pessoa_fisica cd_pessoa_evento, 
	substr(obter_nome_pf(c.cd_pessoa_fisica),1,60) nm_pessoa_evento, 
	c.ie_evento_valido, 
	a.nr_seq_assinatura nr_seq_assinatura_prescr 
from	prescr_solucao_evento c, 
	nut_pac b, 
	prescr_medica a 
where	c.nr_seq_nut_neo = b.nr_sequencia 
and	c.nr_prescricao = b.nr_prescricao 
and	b.nr_prescricao = a.nr_prescricao 
and	c.ie_tipo_solucao = 5 
and	a.nr_atendimento is not null 

union
 
select	a.nr_atendimento, 
	a.nr_prescricao, 
	a.cd_prescritor, 
	substr(obter_nome_pf(a.cd_prescritor),1,60) nm_prescritor, 
	a.dt_prescricao, 
	a.dt_inicio_prescr, 
	a.dt_validade_prescr, 
	a.dt_liberacao, 
	c.dt_alteracao, 
	c.ie_tipo_solucao ie_tipo_solucao, 
	b.nr_sequencia nr_seq_solucao, 
	'N' ie_acm, 
	CASE WHEN b.ie_forma='P' THEN  'Protocolo ' || obter_desc_prot_npt(b.nr_seq_protocolo)  ELSE obter_valor_dominio(1988,b.ie_forma) END  ds_npt, 
	'NPT Adulta' ds_solucao, 
	'IV' ie_via, 
	'N' ie_bi, 
	'ml/h' ie_unidade_veloc, 
	obter_etapas_adep_sol(5,b.nr_prescricao,b.nr_sequencia) nr_etapas_adep, 
	0 nr_etapas_suspensa, 
	b.qt_fase_npt nr_etapas, 
	0 qt_volume_suspenso, 
	obter_volume_nut_pac(b.nr_sequencia) qt_volume_original, 
	b.qt_gotejo_npt qt_velocidade_original, 
	obter_dados_solucao(6,b.nr_prescricao,b.nr_sequencia,'VI') qt_volume_infundido, 
	obter_dados_solucao(6,b.nr_prescricao,b.nr_sequencia,'VD') qt_volume_desprezado, 
	obter_dados_solucao(6,b.nr_prescricao,b.nr_sequencia,'VR') qt_volume_pendente, 
	b.qt_volume_adep qt_volume_etapa, 
	coalesce(obter_dados_solucao(6,b.nr_prescricao,b.nr_sequencia,'VA'),b.qt_gotejo_npt) qt_velocidade_atual, 
	b.ie_status, 
	CASE WHEN b.ie_status='N' THEN 'Normal' WHEN b.ie_status='I' THEN 'Em andamento' WHEN b.ie_status='INT' THEN 'Interrompida' WHEN b.ie_status='T' THEN 'Encerrada' WHEN b.ie_status='V' THEN 'Vencida' END  ds_status, 
	b.dt_status, 
	c.nr_sequencia nr_seq_evento, 
	c.ie_alteracao ie_evento, 
	c.dt_alteracao dt_evento, 
	c.cd_pessoa_fisica cd_pessoa_evento, 
	substr(obter_nome_pf(c.cd_pessoa_fisica),1,60) nm_pessoa_evento, 
	c.ie_evento_valido, 
	a.nr_seq_assinatura nr_seq_assinatura_prescr 
from	prescr_solucao_evento c, 
	nut_pac b, 
	prescr_medica a 
where	c.nr_seq_nut_neo = b.nr_sequencia 
and	c.nr_prescricao = b.nr_prescricao 
and	b.nr_prescricao = a.nr_prescricao 
and	c.ie_tipo_solucao = 6 
and	a.nr_atendimento is not null;

