-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW projeto_recurso_razao_v (ds_historico, nr_documento, vl_movimento, dt_mesano_referencia, nr_seq_projeto, ie_ordem) AS select	ds_historico,
	nr_documento, 
	vl_movimento, 
	dt_mesano_referencia, 
	nr_seq_projeto, 
	ie_ordem 
FROM ( 
	select	1 ie_ordem, 
		wheb_mensagem_pck.get_Texto(402071) ds_historico, /*'Saldo anterior'*/
 
		null nr_documento, 
		vl_anterior vl_movimento, 
		trunc(dt_mesano_referencia,'mm') dt_mesano_referencia, 
		nr_seq_projeto 
	from	projeto_recurso_saldo 
	
union all
 
	select	10, 
		wheb_mensagem_pck.get_Texto(402072),/* ' Títulos a receber',*/
 
		null, 
		coalesce(sum(vl_movimento),0), 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	from	projeto_rec_saldo_razao 
	where	ie_entrada_saida = 'E' 
	group by trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	
union all
 
	select	15, 
		substr(CASE WHEN coalesce(obter_se_subprojeto_recurso(nr_seq_proj_rec_ref),'N')='N' THEN '   ' || obter_pessoa_titulo_receber(nr_documento) WHEN coalesce(obter_se_subprojeto_recurso(nr_seq_proj_rec_ref),'N')=/* - Subprojeto: */
 				'S' THEN '   ' || obter_pessoa_titulo_receber(nr_documento) || wheb_mensagem_pck.get_Texto(402073) || nr_seq_proj_rec_ref || ' - ' || Obter_desc_proj_recurso(nr_seq_proj_rec_ref) END ,1,255), 
		nr_documento, 
		coalesce(sum(vl_movimento),0), 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	from	projeto_rec_saldo_razao 
	where	ie_entrada_saida = 'E' 
	group by	nr_documento, 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto,nr_seq_proj_rec_ref 
	
union all
 
	select	20, 
		wheb_mensagem_pck.get_Texto(402074), /*' Lançamentos de crédito',*/
 
		null, 
		coalesce(sum(vl_movimento),0), 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	from	projeto_rec_saldo_razao 
	where	ie_entrada_saida = 'C' 
	group by trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	
union all
 
	select	25, 
		substr(CASE WHEN coalesce(obter_se_subprojeto_recurso(nr_seq_proj_rec_ref),'N')='N' THEN '   ' || obter_desc_conta_financ(nr_documento) WHEN coalesce(obter_se_subprojeto_recurso(nr_seq_proj_rec_ref),'N')=/* - Subprojeto: */
 				'S' THEN '   ' || obter_desc_conta_financ(nr_documento) || wheb_mensagem_pck.get_Texto(402073) || nr_seq_proj_rec_ref || ' - ' || Obter_desc_proj_recurso(nr_seq_proj_rec_ref) END ,1,255), 
		null, 
		coalesce(sum(vl_movimento),0), 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	from	projeto_rec_saldo_razao 
	where	ie_entrada_saida = 'C' 
	group by	nr_documento, 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto,nr_seq_proj_rec_ref 
	
union all
	 
	select	30, 
		wheb_mensagem_pck.get_Texto(402075), /*' Títulos à pagar',*/
 
		null, 
		coalesce(sum(vl_movimento),0), 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	from	projeto_rec_saldo_razao 
	where	ie_entrada_saida = 'S' 
	group by trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	
union all
 
	select	35, 
		substr(CASE WHEN coalesce(obter_se_subprojeto_recurso(nr_seq_proj_rec_ref),'N')='N' THEN '   ' || obter_pessoa_titulo_pagar(nr_documento) WHEN coalesce(obter_se_subprojeto_recurso(nr_seq_proj_rec_ref),'N')=/* - Subprojeto: */
 				'S' THEN '   ' || obter_pessoa_titulo_pagar(nr_documento) || wheb_mensagem_pck.get_Texto(402073) || nr_seq_proj_rec_ref || ' - ' || Obter_desc_proj_recurso(nr_seq_proj_rec_ref) END ,1,255), 
		nr_documento, 
		coalesce(sum(vl_movimento),0), 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	from	projeto_rec_saldo_razao 
	where	ie_entrada_saida = 'S' 
	group by	nr_documento, 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto,nr_seq_proj_rec_ref 
	
union all
 
	select	36, 
		substr('   ' || obter_desc_tributo(nr_documento),1,255), 
		nr_documento, 
		coalesce(sum(vl_movimento),0), 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	from	projeto_rec_saldo_razao 
	where	ie_entrada_saida in ('A','I') 
	group by	nr_documento, 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto,nr_seq_proj_rec_ref 
	
union all
 
	select	40, 
		wheb_mensagem_pck.get_Texto(402076), /*' Lançamentos de débito',*/
 
		null, 
		coalesce(sum(vl_movimento),0), 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	from	projeto_rec_saldo_razao 
	where	ie_entrada_saida = 'D' 
	group by trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	
union all
 
	select	9, 
		substr(CASE WHEN coalesce(obter_se_subprojeto_recurso(nr_seq_proj_rec_ref),'N')='N' THEN '   ' || obter_desc_conta_financ(nr_documento) WHEN coalesce(obter_se_subprojeto_recurso(nr_seq_proj_rec_ref),'N')=/* - Subprojeto: */
 				'S' THEN '   ' || obter_desc_conta_financ(nr_documento) || wheb_mensagem_pck.get_Texto(402073) || nr_seq_proj_rec_ref || ' - ' || Obter_desc_proj_recurso(nr_seq_proj_rec_ref) END ,1,255), 
		null, 
		coalesce(sum(vl_movimento),0), 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	from	projeto_rec_saldo_razao 
	where	ie_entrada_saida = 'D' 
	group by	nr_documento, 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto,nr_seq_proj_rec_ref 
	
union all
 
	select	45, 
		wheb_mensagem_pck.get_Texto(402077), /*' Valores comprometidos',*/
 
		null, 
		coalesce(sum(vl_movimento),0), 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	from	projeto_rec_saldo_razao 
	where	ie_entrada_saida in ('O','T','L') 
	group by trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	
union all
 
	select	50, 
		substr(CASE WHEN coalesce(obter_se_subprojeto_recurso(nr_seq_proj_rec_ref),'N')='N' THEN wheb_mensagem_pck.get_Texto(402080) || nr_documento WHEN coalesce(obter_se_subprojeto_recurso(nr_seq_proj_rec_ref),'N')=/*'   Ordem compra: '*/ 				'S' THEN wheb_mensagem_pck.get_Texto(402080) || nr_documento || wheb_mensagem_pck.get_Texto(402073) || nr_seq_proj_rec_ref || ' - ' || Obter_desc_proj_recurso(nr_seq_proj_rec_ref) END ,1,255), 
		nr_documento, 
		coalesce(sum(vl_movimento),0), 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	from	projeto_rec_saldo_razao 
	where	ie_entrada_saida = 'O' 
	group by	nr_documento, 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto,nr_seq_proj_rec_ref 
	
union all
 
		select	52, 
		substr(CASE WHEN coalesce(obter_se_subprojeto_recurso(nr_seq_proj_rec_ref),'N')='N' THEN wheb_mensagem_pck.get_Texto(402081) || nr_documento WHEN coalesce(obter_se_subprojeto_recurso(nr_seq_proj_rec_ref),'N')=/*'   Solicitação compra: '*/ 				'S' THEN wheb_mensagem_pck.get_Texto(402081) || nr_documento || wheb_mensagem_pck.get_Texto(402073) || nr_seq_proj_rec_ref || ' - ' || Obter_desc_proj_recurso(nr_seq_proj_rec_ref) END ,1,255), 
		nr_documento, 
		coalesce(sum(vl_movimento),0), 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	from	projeto_rec_saldo_razao 
	where	ie_entrada_saida = 'L' 
	group by	nr_documento, 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto,nr_seq_proj_rec_ref 
	
union all
 
	select	55, 
		substr(CASE WHEN coalesce(obter_se_subprojeto_recurso(nr_seq_proj_rec_ref),'N')='N' THEN wheb_mensagem_pck.get_Texto(402083) || nr_documento WHEN coalesce(obter_se_subprojeto_recurso(nr_seq_proj_rec_ref),'N')=/*'   Título à pagar: '*/ 				'S' THEN wheb_mensagem_pck.get_Texto(402083) || nr_documento || wheb_mensagem_pck.get_Texto(402073) || nr_seq_proj_rec_ref || ' - ' || Obter_desc_proj_recurso(nr_seq_proj_rec_ref) END ,1,255), 
		nr_documento, 
		coalesce(sum(vl_movimento),0), 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	from	projeto_rec_saldo_razao 
	where	ie_entrada_saida = 'T' 
	group by	nr_documento, 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto,nr_seq_proj_rec_ref 
	
union all
 
	select	56, 
		substr('   ' || obter_desc_tributo(nr_documento),1,255), 
		nr_documento, 
		coalesce(sum(vl_movimento),0), 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	from	projeto_rec_saldo_razao 
	where	ie_entrada_saida in ('G','G') 
	group by	nr_documento, 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto,nr_seq_proj_rec_ref 
	
union all
 
	select	60, 
		wheb_mensagem_pck.get_Texto(402086), /*' Transferências Entradas',*/
 
		null, 
		coalesce(sum(vl_movimento),0), 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	from	projeto_rec_saldo_razao 
	where	ie_entrada_saida = 'X' 
	group by trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	
union all
 
	select	65, 
		substr(CASE WHEN coalesce(obter_se_subprojeto_recurso(nr_seq_proj_rec_ref),'N')='N' THEN wheb_mensagem_pck.get_Texto(402087) || nr_documento WHEN coalesce(obter_se_subprojeto_recurso(nr_seq_proj_rec_ref),'N')=/*'   Entrada do projeto: '*/ 				'S' THEN wheb_mensagem_pck.get_Texto(402087) || nr_documento || wheb_mensagem_pck.get_Texto(402073) || nr_seq_proj_rec_ref || ' - ' || Obter_desc_proj_recurso(nr_seq_proj_rec_ref) END ,1,255), 
		nr_documento, 
		coalesce(sum(vl_movimento),0), 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	from	projeto_rec_saldo_razao 
	where	ie_entrada_saida = 'X' 
	group by	nr_documento, 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto,nr_seq_proj_rec_ref 
	
union all
 
	select	70, 
		wheb_mensagem_pck.get_Texto(402578), /*' Transferências Saída',*/
 
		null, 
		coalesce(sum(vl_movimento),0), 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	from	projeto_rec_saldo_razao 
	where	ie_entrada_saida = 'Y' 
	group by trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	
union all
 
	select	75, 
		substr(CASE WHEN coalesce(obter_se_subprojeto_recurso(nr_seq_proj_rec_ref),'N')='N' THEN wheb_mensagem_pck.get_Texto(402579) || nr_documento WHEN coalesce(obter_se_subprojeto_recurso(nr_seq_proj_rec_ref),'N')=/*'   Saída para o projeto: ' */ 				'S' THEN wheb_mensagem_pck.get_Texto(402579) || nr_documento || wheb_mensagem_pck.get_Texto(402073) || nr_seq_proj_rec_ref || ' - ' || Obter_desc_proj_recurso(nr_seq_proj_rec_ref) END ,1,255), 
		nr_documento, 
		coalesce(sum(vl_movimento),0), 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto 
	from	projeto_rec_saldo_razao 
	where	ie_entrada_saida = 'Y' 
	group by	nr_documento, 
		trunc(dt_referencia,'mm'), 
		nr_seq_projeto,nr_seq_proj_rec_ref 
	
union all
 
	select	80, 
		wheb_mensagem_pck.get_Texto(402580),/* 'Saldo final',*/
 
		null, 
		vl_saldo, 
		trunc(dt_mesano_referencia,'mm'), 
		nr_seq_projeto 
	from	projeto_recurso_saldo) alias171 
order by	ie_ordem;

