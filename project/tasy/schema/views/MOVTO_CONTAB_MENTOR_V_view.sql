-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW movto_contab_mentor_v (nr_lote_contabil, nr_sequencia, cd_conta_contabil, ie_debito_credito, dt_atualizacao, nm_usuario, nr_seq_trans_fin, cd_cgc, nr_seq_agrupamento, ds_historico, ds_conta_contabil, ds_centro_custo, ci_integra, ie_deb_cred_num, ds_compl_fixo, ds_historico_fixo, dt_referencia, cd_tipo_lote_contabil, vl_debito_credito, cd_centro_custo_debito, cd_centro_custo_credito, cd_conta_gerencial, cd_estab_logado, dt_movimento, cd_conta_debito, cd_conta_credito, vl_movto, cd_historico, cd_estabelecimento, cd_centro_custo, ds_compl_historico) AS select
	a.nr_lote_contabil,
	a.nr_sequencia,
	a.cd_conta_contabil,
a.ie_debito_credito,
a.dt_atualizacao,
a.nm_usuario,
a.nr_seq_trans_fin,
a.cd_cgc,
a.nr_seq_agrupamento,
substr((h.ds_historico || ' ' || a.ds_compl_historico),1,250) ds_historico,
b.ds_conta_contabil,
c.ds_centro_custo,
CASE WHEN coalesce(a.cd_centro_custo, '0')=0 THEN  'N'  ELSE 'S' END  ci_integra,
CASE WHEN a.ie_debito_credito='D' THEN  1  ELSE 2 END  ie_deb_cred_num,
substr(ds_compl_historico || lpad(' ', 350 - length(ds_compl_historico)),1,350) ds_compl_fixo,
substr((h.ds_historico || ' ' || a.ds_compl_historico) ||
	lpad(' ', 350 - length(h.ds_historico || ' ' || ds_compl_historico)),1,350) ds_historico_fixo,
x.dt_referencia,
x.cd_tipo_lote_contabil,
CASE WHEN a.ie_debito_credito='C' THEN a.vl_movimento * -1  ELSE a.vl_movimento END  vl_debito_credito,
CASE WHEN a.ie_debito_credito='D' THEN  a.cd_centro_custo  ELSE 0 END  cd_centro_custo_debito,
CASE WHEN a.ie_debito_credito='C' THEN  a.cd_centro_custo  ELSE 0 END  cd_centro_custo_credito,
CASE WHEN b.ie_centro_custo='S' THEN a.cd_centro_custo  ELSE null END  cd_conta_gerencial,
wheb_usuario_pck.get_cd_estabelecimento cd_estab_logado,
a.dt_movimento,
CASE WHEN a.ie_debito_credito='D' THEN  a.cd_conta_contabil  ELSE null END  cd_conta_debito,
CASE WHEN a.ie_debito_credito='C' THEN  a.cd_conta_contabil  ELSE null END  cd_conta_credito,
CASE WHEN b.ie_centro_custo='S' THEN CASE WHEN a.ie_debito_credito='D' THEN a.vl_movimento  ELSE a.vl_movimento * -1 END   ELSE null END  vl_movto,
h.cd_sistema_contabil cd_historico,
x.cd_estabelecimento,
a.cd_centro_custo,
a.ds_compl_historico
FROM 	lote_contabil x,
	centro_custo c,
	historico_padrao h,
	conta_contabil b,
	movimento_contabil a
where a.cd_conta_contabil 	= b.cd_conta_contabil
and a.cd_historico		= h.cd_historico
and a.nr_lote_contabil	= x.nr_lote_contabil
and a.cd_centro_custo		= c.cd_centro_custo;

