-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW paciente_dif_acomodacao_v (ds_convenio, nr_atendimento, nm_paciente, cd_pessoa_fisica, cd_unidade, ds_acomod_setor, ds_acomod_conv, ds_acomod_desej, ds_acomod_unid, dt_entrada, qt_tempo_ocupacao, ie_tipo_atendimento, ie_paciente_isolado, cd_estabelecimento_base, nr_seq_motivo_dif) AS select	e.ds_convenio,
	a.nr_atendimento,	 
	e.nm_paciente, 
	e.cd_pessoa_fisica, 
	e.cd_unidade, 
	b.ds_tipo_acomodacao ds_acomod_setor, 
	f.ds_tipo_acomodacao ds_acomod_Conv, 
 	P.ds_tipo_acomodacao ds_acomod_Desej, 
	g.ds_tipo_acomodacao ds_acomod_Unid,	 
	e.dt_entrada,	 
	(LOCALTIMESTAMP - e.dt_entrada) qt_tempo_ocupacao, 
	e.ie_tipo_atendimento, 
	coalesce(e.ie_paciente_isolado,'N') ie_paciente_isolado, 
	c.cd_estabelecimento_base, 
	x.nr_seq_motivo_dif 
FROM atend_paciente_unidade x, tipo_acomodacao g, tipo_acomodacao f, atendimento_paciente_v e, setor_atendimento c, tipo_acomodacao b, unidade_atendimento a
LEFT OUTER JOIN atendimento_acomod_pac o ON (a.nr_atendimento = o.nr_atendimento)
LEFT OUTER JOIN tipo_acomodacao p ON (o.cd_tipo_acomodacao = P.cd_tipo_acomodacao)
WHERE a.ie_situacao      = 'A' AND c.ie_situacao      = 'A' and a.ie_status_unidade   = 'P' and x.cd_tipo_acomodacao	= b.cd_tipo_acomodacao and e.cd_tipo_acomod_conv  = f.cd_tipo_acomodacao and a.cd_tipo_acomodacao  = g.cd_tipo_acomodacao and a.cd_setor_atendimento = c.cd_setor_atendimento and a.nr_atendimento    = e.nr_atendimento and x.nr_seq_interno		= obter_Atepacu_Paciente(a.nr_atendimento,'IA')   and ((b.cd_nivel_acomodacao  <> f.cd_nivel_acomodacao) or (b.cd_nivel_acomodacao  <> P.cd_nivel_acomodacao) or (b.cd_nivel_acomodacao  <> g.cd_nivel_acomodacao)) and e.dt_aceite_dif_acomod	is null and c.cd_classif_setor = 3;

