-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW repasse_terceiro_item_v (nr_repasse_terceiro, ds_repasse, cd_convenio, ds_convenio, ds_item, ds_status, ds_tipo_item, dt_item, nr_interno_conta, nr_atendimento, nr_seq_item_retorno, vl_repasse, vl_liberado, qt_item, nr_seq_item, nr_seq_terceiro, cd_item, ie_status_repasse, vl_item, dt_mesano_referencia, cd_medico_executor, cd_medico, ie_tipo_item, cd_setor_repasse, ie_status, cd_convenio_item) AS select 	a.nr_repasse_terceiro nr_repasse_terceiro,
	'Repasse Procedimento' ds_repasse,
	b.cd_convenio,
	substr(obter_nome_convenio(b.cd_convenio),1,60)  ds_convenio,
	substr(obter_desc_estrut_proc(null, null, null, b.cd_procedimento, b.ie_origem_proced),1,120) ds_item,
	substr(obter_valor_dominio(1129, a.ie_status),1,40) ds_status,
	substr(coalesce(obter_desc_tipo_procedimento(b.cd_procedimento, b.ie_origem_proced), 'N達o informado'),1,60) ds_tipo_item,
	trunc(b.dt_procedimento, 'dd') dt_item,
	b.nr_interno_conta,
	b.nr_atendimento,
	a.nr_seq_item_retorno,
	sum(a.vl_repasse) vl_repasse,
	sum(a.vl_liberado) vl_liberado,
	sum(b.qt_procedimento) qt_item,
	b.nr_sequencia nr_seq_item,
	a.nr_seq_terceiro,
	b.cd_procedimento cd_item,
	r.ie_status ie_status_repasse,
	sum(b.vl_procedimento) vl_item,
	r.dt_mesano_referencia,
	b.cd_medico_executor,
	a.cd_medico,
	'P' ie_tipo_item,
	b.cd_setor_atendimento cd_setor_repasse,
	a.ie_status ie_status,
	b.cd_convenio cd_convenio_item
FROM 	procedimento_paciente b,
	procedimento_repasse a,
	repasse_terceiro r
where r.nr_repasse_terceiro	= a.nr_repasse_terceiro
and	a.nr_seq_procedimento	= b.nr_sequencia
group by a.nr_repasse_terceiro,
	'Repasse Procedimento',
	b.cd_convenio,
	b.cd_procedimento,
	b.ie_origem_proced,
	a.ie_status,
	b.dt_procedimento,
	b.nr_interno_conta,
	b.nr_atendimento,
	a.nr_seq_item_retorno,
	b.nr_sequencia,
	a.nr_seq_terceiro,
	b.cd_procedimento,
	r.ie_status,
	r.dt_mesano_referencia,
	a.nr_sequencia,
	b.cd_medico_executor,
	a.cd_medico,
	b.cd_setor_atendimento

union all

select 	a.nr_repasse_terceiro nr_repasse_terceiro,
	'Repasse Material' ds_repasse,
	b.cd_convenio,
	substr(obter_nome_convenio(b.cd_convenio),1,60)  ds_convenio,
	substr(obter_desc_estrut_mat(null, null, null, b.cd_material),1,120) ds_item,
	substr(obter_valor_dominio(1129, a.ie_status),1,40) ds_status,
	substr(coalesce(obter_valor_dominio(29,m.ie_tipo_material), 'N達o informado'),1,60) ds_tipo_item,
	trunc(b.dt_atendimento, 'dd') dt_item,
	b.nr_interno_conta,
	b.nr_atendimento,
	a.nr_seq_item_retorno,
	sum(a.vl_repasse) vl_repasse,
	sum(a.vl_liberado) vl_liberado,
	sum(b.qt_material) qt_item,
	b.nr_sequencia nr_seq_item,
	a.nr_seq_terceiro,
	b.cd_material cd_item,
	r.ie_status ie_status_repasse,
	sum(b.vl_material) vl_item,
	r.dt_mesano_referencia,
	'' cd_medico_executor,
	'' cd_medico,
	'M' ie_tipo_item,
	b.cd_setor_atendimento cd_setor_repasse,
	a.ie_status ie_status,
	b.cd_convenio cd_convenio_item
from 	material m,
	material_atend_paciente b,
	material_repasse a,
	repasse_terceiro r
where r.nr_repasse_terceiro	= a.nr_repasse_terceiro
and	a.nr_seq_material	= b.nr_sequencia
and	m.cd_material		= b.cd_material
group by a.nr_repasse_terceiro,
	'Repasse Material',
	b.cd_convenio,
	b.cd_material,
	a.ie_status,
	m.ie_tipo_material,
	b.dt_atendimento,
	b.nr_interno_conta,
	b.nr_atendimento,
	a.nr_seq_item_retorno,
	b.nr_sequencia,
	a.nr_seq_terceiro,
	b.cd_material,
	r.ie_status,
	r.dt_mesano_referencia,
	b.cd_setor_atendimento

union all

select 	a.nr_repasse_terceiro nr_repasse_terceiro,
	'Repasse Item' ds_repasse,
	0 cd_convenio,
	'' ds_convenio,
	coalesce(a.ds_observacao, 'N達o informado') ds_item,
	'' ds_status,
	'N達o Informado' ds_tipo_item,
	trunc(LOCALTIMESTAMP, 'dd') dt_item,
	0 nr_interno_conta,
	0 nr_atendimento,
	0 nr_seq_item_retorno,
	sum(a.vl_repasse) vl_repasse,
	sum(a.vl_repasse) vl_liberado,
	0 qt_item,
	a.nr_sequencia_item nr_seq_item,
	r.nr_seq_terceiro,
	0 cd_item,
	r.ie_status ie_status_repasse,
	sum(a.vl_repasse) vl_item,
	r.dt_mesano_referencia,
	'' cd_medico_executor,
	'' cd_medico,
	'I' ie_tipo_item,
	null cd_setor_repasse,
	'' ie_status,
	a.cd_convenio cd_convenio_item
from 	repasse_terceiro_item a,
	repasse_terceiro r
where r.nr_repasse_terceiro	= a.nr_repasse_terceiro
group by a.nr_repasse_terceiro,
	'Repasse Item',
	0, '', '',
	a.ds_observacao, '',
	trunc(LOCALTIMESTAMP, 'dd'), 0, 0, 0,
	a.nr_sequencia_item,
	r.nr_seq_terceiro,
	r.ie_status,
	r.dt_mesano_referencia,
	a.cd_convenio;

