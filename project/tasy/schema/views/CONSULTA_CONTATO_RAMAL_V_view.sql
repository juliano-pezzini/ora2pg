-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW consulta_contato_ramal_v (nm_contato, nr_contato, nr_telefone_res, nr_fone_com, ds_setor_usuario, ds_setor_ramal, cd_setor_atendimento, ie_tipo, cd_pessoa_fisica, nm_usuario, nm_usuario_ref, ds_email, ds_observacao, ds_setor, ie_publico, ie_divulgacao_externa, cd_estabelecimento, nr_seq_tipo_contato) AS SELECT	coalesce(nm_contato,obter_nome_pf(cd_pessoa_fisica)) nm_contato,
	nr_telefone_celular nr_contato, 
	SUBSTR(obter_telefone_contato(nr_sequencia, 0),1,40) nr_telefone_res, 
	SUBSTR(obter_telefone_contato(nr_sequencia, 1),1,40)	 nr_fone_com, 
	obter_setor_pf_usuario(cd_pessoa_fisica) ds_setor_usuario, 
	'' ds_setor_ramal, 
	NULL cd_setor_atendimento, 
	1 ie_tipo, 
	cd_pessoa_fisica, 
	nm_usuario, 
	nm_usuario_ref, 
	ds_email, 
	SUBSTR(ds_observacao,1,155) ds_observacao, 
	SUBSTR(OBTER_DS_DESCRICAO_SETOR(cd_setor_atendimento),1,255) ds_setor, 
	coalesce(ie_publico,'N') ie_publico, 
	ie_divulgacao_externa, 
	cd_estabelecimento, 
	nr_seq_tipo_contato 
FROM  	usuario_contato 

UNION
 
SELECT 	coalesce(nm_contato,obter_nome_pf(cd_pessoa_fisica)) nm_contato, 
	cd_ramal nr_contato, 
	'', 
	'', 
	obter_setor_pf_usuario(cd_pessoa_fisica) ds_setor_usuario, 
	obter_nome_setor(cd_setor_atendimento) ds_setor_ramal, 
	cd_setor_atendimento, 
	2 ie_tipo, 
	cd_pessoa_fisica, 
	nm_usuario, 
	NULL nm_usuario_ref, 
	ds_email, 
	NULL ds_observacao, 
	SUBSTR(OBTER_DS_DESCRICAO_SETOR(cd_setor_atendimento),1,255) ds_setor, 
	'S' ie_publico, 
	'', 
	cd_estabelecimento, 
	0 nr_seq_tipo_contato 
FROM  ramal_interno;

