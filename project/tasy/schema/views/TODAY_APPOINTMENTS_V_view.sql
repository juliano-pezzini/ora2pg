-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW today_appointments_v (cd_agenda, nr_sequencia, cd_pessoa_fisica) AS WITH range AS (
  SELECT ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(LOCALTIMESTAMP) start_day,
         ESTABLISHMENT_TIMEZONE_UTILS.endOfDay(LOCALTIMESTAMP) end_day

)

-- CONSULTATION SCHEDULE
SELECT  a.cd_agenda,
        a.nr_sequencia,
        a.cd_pessoa_fisica
FROM    CONSULTA_AGECONS_HTML5_V a, range
WHERE   a.cd_tipo_agenda = 3
AND     a.dt_agenda BETWEEN range.start_day AND range.end_day

-- EXAME SCHEDULE
UNION ALL

SELECT  a.cd_agenda,
        a.nr_sequencia,
        a.cd_pessoa_fisica
FROM    CONSULTA_AGEEXAM_HTML5_V a, range
WHERE   a.cd_tipo_agenda = 2
AND     a.dt_agenda BETWEEN range.start_day AND range.end_day

-- SERVICE SCHEDULE
UNION ALL

SELECT  a.cd_agenda,
        a.nr_sequencia,
        a.cd_pessoa_fisica
FROM    CONSULTA_AGESERV_HTML5_V a, range
WHERE   a.cd_tipo_agenda = 5
AND     a.dt_agenda BETWEEN range.start_day AND range.end_day;

