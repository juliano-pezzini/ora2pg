-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_segreg_desp_grupo_ans_v (ie_tipo_doc, nr_seq_conta, nr_seq_contrato, dt_conta, nm_prestador, cd_cpf_cgc, nm_segurado, dt_protocolo, vl_glosa, ie_cobertura, ie_natureza, nr_seq_grupo_ans, dt_mes_comp_protocolo, ie_tipo_vinculo_operadora, ie_sit_protocolo, ie_tipo_segurado, ie_tipo_relacao, nr_seq_proc_mat, vl_total, vl_conta, nr_seq_apresentacao, ds_grupo, ie_tipo_grupo_ans, ie_tipo_protocolo) AS select	distinct
	0 ie_tipo_doc, 
	a.nr_seq_conta, 
	b.nr_seq_contrato, 
	to_date(substr(pls_obter_dados_conta(a.nr_seq_conta,'DA'),1,255)) dt_conta, 
	substr(obter_nome_pf_pj(i.cd_medico,null),1,150) nm_prestador, 
	obter_dados_pf(a.cd_medico_executor,'CPF') cd_cpf_cgc, 
	substr(obter_nome_pf(b.cd_pessoa_fisica),1,150) nm_segurado, 
	f.dt_protocolo, 
	coalesce(g.vl_glosa,0) vl_glosa, 
	lpad(e.ie_segmentacao,2,0) ie_cobertura, 
	CASE WHEN e.ie_tipo_contratacao='I' THEN 1  ELSE CASE WHEN e.ie_participacao='C' THEN 3  ELSE 4 END  END  ie_natureza, 
	coalesce(g.nr_seq_grupo_ans, -1) nr_seq_grupo_ans, 
	a.dt_mes_comp_protocolo, 
	b.ie_tipo_vinculo_operadora , 
	a.ie_sit_protocolo, 
	b.ie_tipo_segurado, 
	d.ie_tipo_relacao, 
	g.nr_sequencia nr_seq_proc_mat, 
	coalesce(g.vl_liberado,0) vl_total, 
	a.vl_total vl_conta, 
	coalesce(h.nr_seq_apresentacao,9999999999) nr_seq_apresentacao, 
	coalesce(h.ds_grupo,'Outras despesas') ds_grupo, 
	h.ie_tipo_grupo_ans, 
	f.ie_tipo_protocolo 
FROM pls_conta j, pls_proc_participante i, pls_plano e, pls_conta_medica_v a, pls_segurado b
LEFT OUTER JOIN pls_contrato c ON (b.nr_seq_contrato = c.nr_sequencia)
, pls_protocolo_conta f
LEFT OUTER JOIN pls_prestador d ON (f.nr_seq_prestador = d.nr_sequencia)
, pls_conta_proc g
LEFT OUTER JOIN ans_grupo_despesa h ON (g.nr_seq_grupo_ans = h.nr_sequencia)
WHERE b.nr_sequencia		= a.nr_seq_segurado  and f.nr_sequencia		= a.nr_seq_protocolo  and e.nr_sequencia		= b.nr_seq_plano and g.nr_seq_conta		= a.nr_seq_conta and g.ie_status		<> 'D'  and i.nr_seq_conta_proc	= g.nr_sequencia and j.nr_sequencia		= a.nr_seq_conta and j.ie_tipo_guia		= 5 and (exists (select 	1 	from pls_proc_participante p 
		where 	p.nr_seq_conta_proc = g.nr_sequencia 
		and 	p.nr_seq_grau_partic in (1,13))) 
 
union
 
select	distinct 
	0 ie_tipo_doc, 
	a.nr_seq_conta, 
	b.nr_seq_contrato, 
	to_date(substr(pls_obter_dados_conta(a.nr_seq_conta,'DA'),1,255)) dt_conta, 
	substr(obter_nome_pf_pj(a.cd_medico_executor,null),1,150) nm_prestador, 
	obter_dados_pf(a.cd_medico_executor,'CPF') cd_cpf_cgc, 
	substr(obter_nome_pf(b.cd_pessoa_fisica),1,150) nm_segurado, 
	f.dt_protocolo, 
	coalesce(g.vl_glosa,0) vl_glosa, 
	lpad(e.ie_segmentacao,2,0) ie_cobertura, 
	CASE WHEN e.ie_tipo_contratacao='I' THEN 1  ELSE CASE WHEN e.ie_participacao='C' THEN 3  ELSE 4 END  END  ie_natureza, 
	coalesce(g.nr_seq_grupo_ans, -1) nr_seq_grupo_ans, 
	a.dt_mes_comp_protocolo, 
	b.ie_tipo_vinculo_operadora , 
	a.ie_sit_protocolo, 
	b.ie_tipo_segurado, 
	d.ie_tipo_relacao, 
	g.nr_sequencia nr_seq_proc_mat, 
	coalesce(g.vl_liberado,0) vl_total, 
	a.vl_total vl_conta, 
	coalesce(h.nr_seq_apresentacao,9999999999) nr_seq_apresentacao, 
	coalesce(h.ds_grupo,'Outras despesas') ds_grupo, 
	h.ie_tipo_grupo_ans, 
	f.ie_tipo_protocolo 
FROM pls_conta j, pls_plano e, pls_conta_medica_v a, pls_segurado b
LEFT OUTER JOIN pls_contrato c ON (b.nr_seq_contrato = c.nr_sequencia)
, pls_protocolo_conta f
LEFT OUTER JOIN pls_prestador d ON (f.nr_seq_prestador = d.nr_sequencia)
, pls_conta_proc g
LEFT OUTER JOIN ans_grupo_despesa h ON (g.nr_seq_grupo_ans = h.nr_sequencia)
WHERE b.nr_sequencia		= a.nr_seq_segurado  and f.nr_sequencia		= a.nr_seq_protocolo  and e.nr_sequencia		= b.nr_seq_plano and g.nr_seq_conta		= a.nr_seq_conta and g.ie_status		<> 'D'  and j.nr_sequencia		= a.nr_seq_conta and not((j.ie_tipo_guia = 5) and (exists (select 	1 	from pls_proc_participante p 
						where 	p.nr_seq_conta_proc = g.nr_sequencia 
						and	p.nr_seq_grau_partic in (1,13)))) 
 
union
 
select	distinct 
	0 ie_tipo_doc, 
	a.nr_seq_conta, 
	b.nr_seq_contrato, 
	to_date(substr(pls_obter_dados_conta(a.nr_seq_conta,'DA'),1,255)) dt_conta, 
	substr(obter_nome_pf_pj(a.cd_medico_executor,null),1,150) nm_prestador, 
	obter_dados_pf(a.cd_medico_executor,'CPF') cd_cpf_cgc, 
	substr(obter_nome_pf(b.cd_pessoa_fisica),1,150) nm_segurado, 
	f.dt_protocolo, 
	coalesce( g.vl_glosa,0) vl_glosa, 
	lpad(e.ie_segmentacao,2,0) ie_cobertura, 
	CASE WHEN e.ie_tipo_contratacao='I' THEN 1  ELSE CASE WHEN e.ie_participacao='C' THEN 3  ELSE 4 END  END  ie_natureza, 
	coalesce(g.nr_seq_grupo_ans, -1) nr_seq_grupo_ans, 
	a.dt_mes_comp_protocolo, 
	b.ie_tipo_vinculo_operadora , 
	a.ie_sit_protocolo, 
	b.ie_tipo_segurado, 
	d.ie_tipo_relacao, 
	g.nr_sequencia nr_seq_proc_mat, 
	coalesce(g.vl_liberado,0) vl_total, 
	a.vl_total vl_conta, 
	coalesce(h.nr_seq_apresentacao,9999999999) nr_seq_apresentacao, 
	coalesce(h.ds_grupo,'Outras despesas') ds_grupo, 
	h.ie_tipo_grupo_ans, 
	f.ie_tipo_protocolo 
FROM pls_plano e, pls_conta_medica_v a, pls_segurado b
LEFT OUTER JOIN pls_contrato c ON (b.nr_seq_contrato = c.nr_sequencia)
, pls_protocolo_conta f
LEFT OUTER JOIN pls_prestador d ON (f.nr_seq_prestador = d.nr_sequencia)
, pls_conta_mat g
LEFT OUTER JOIN ans_grupo_despesa h ON (g.nr_seq_grupo_ans = h.nr_sequencia)
WHERE b.nr_sequencia		= a.nr_seq_segurado  and f.nr_sequencia		= a.nr_seq_protocolo  and e.nr_sequencia		= b.nr_seq_plano and g.nr_seq_conta		= a.nr_seq_conta and g.ie_status		<> 'D';

