-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW os_recebida_gerencia_v (nr_sequencia, nr_seq_gerencia, dt_ordem_servico, nr_seq_grupo_des, nr_seq_localizacao, cd_funcao, ie_plataforma) AS select	a.nr_sequencia,
	b.nr_Seq_gerencia,
	a.dt_ordem_servico,
	a.nr_seq_grupo_des,
	a.nr_seq_localizacao,
	a.cd_funcao,
	a.ie_plataforma
FROM man_ordem_servico a
LEFT OUTER JOIN grupo_desenvolvimento b ON (a.nr_seq_grupo_des = b.nr_sequencia)
WHERE b.nr_seq_gerencia	!= 25 and exists ( select 1
		from	man_estagio_processo c,
				man_ordem_serv_estagio d
		where	c.nr_sequencia = d.nr_seq_estagio
		and	d.nr_seq_ordem = a.nr_sequencia
		and (c.ie_suporte = 'S' or c.ie_desenv = 'S'))

union

select	a.nr_sequencia,
	2 nr_seq_gerencia,
	a.dt_ordem_servico,
	a.nr_seq_grupo_des,
	a.nr_seq_localizacao,
	a.cd_funcao,
	a.ie_plataforma
FROM man_ordem_servico a
LEFT OUTER JOIN grupo_desenvolvimento b ON (a.nr_seq_grupo_des = b.nr_sequencia)
WHERE 1=1  and b.nr_seq_gerencia	!= 2 and exists (
	select 	1 
	from	man_ordem_serv_ativ c,
			grupo_desenvolvimento d,
			usuario_grupo_des e
	where	a.nr_sequencia = c.nr_seq_ordem_serv
	and	d.nr_seq_gerencia = 2
	and	e.nr_seq_grupo = d.nr_sequencia
	and	c.nm_usuario_exec = e.nm_usuario_grupo);

