-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eme_view_sos_regulacao_v (cd_contrato, nr_cpf, cd_unimed, cd_empresa, cd_familia, cd_dependencia, ds_branco, nm_pessoa, ie_sexo, ie_estado_civil, dt_nascimento, dt_inclusao, dt_cancelamento, ie_tipo_pessoa, ds_endereco, ds_complemento, ds_bairro, ds_municipio, sg_estado, cd_cep, nr_telefone, nm_contato, nr_seq_cobertura) AS select	b.cd_contrato cd_contrato,
	substr(obter_cpf_pessoa_fisica(a.cd_pessoa_fisica),1,11) nr_cpf, 
	substr(campo_aspas(substr(a.cd_codigo_convenio,1,3),5),1,5) cd_unimed, 
	substr(campo_aspas(substr(a.cd_codigo_convenio,4,4),6),1,6) cd_empresa, 
	substr(campo_aspas(substr(a.cd_codigo_convenio,8,6),8),1,8) cd_familia, 
	substr(campo_aspas(substr(a.cd_codigo_convenio,14,2),4),1,4) cd_dependencia, 
	substr(campo_aspas('   ',7),1,7) ds_branco, 
	substr(campo_aspas(substr(obter_nome_pf_pj(a.cd_pessoa_fisica, a.cd_cgc),1,100),42),1,42) nm_pessoa, 
	substr(campo_aspas(coalesce(substr(obter_sexo_pf(a.cd_pessoa_fisica,'C'),1,1),' '),3),1,3) ie_sexo, 
	substr(campo_aspas(CASE WHEN obter_dados_pf(a.cd_pessoa_fisica,'EC')='1' THEN '2' WHEN obter_dados_pf(a.cd_pessoa_fisica,'EC')=2 THEN '1' WHEN obter_dados_pf(a.cd_pessoa_fisica,'EC')=3 THEN '4' WHEN obter_dados_pf(a.cd_pessoa_fisica,'EC')=4 THEN '6' WHEN obter_dados_pf(a.cd_pessoa_fisica,'EC')=5 THEN '5'  ELSE '6' END ,3),1,3) ie_estado_civil, 
	substr(campo_aspas(substr(obter_dados_pf(a.cd_pessoa_fisica,'DN'),1,20),12),1,12) dt_nascimento, 
	substr(campo_aspas(to_char(a.dt_inclusao,'dd/mm/yyyy'),12),1,12) dt_inclusao, 
	substr(campo_aspas(to_char(a.dt_cancelamento,'dd/mm/yyyy'),12),1,12) dt_cancelamento, 
	substr(campo_aspas('1',3),1,3) ie_tipo_pessoa, 
	substr(campo_aspas(substr(obter_dados_pf_pj(a.cd_pessoa_fisica, a.cd_cgc, 'EN'),1,100),42),1,42) ds_endereco, 
	substr(campo_aspas(substr(obter_dados_pf_pj(a.cd_pessoa_fisica, a.cd_cgc, 'CO'),1,100),22),1,22) ds_complemento, 
	substr(campo_aspas(substr(obter_dados_pf_pj(a.cd_pessoa_fisica, a.cd_cgc, 'B'),1,100),22),1,22) ds_bairro, 
	substr(campo_aspas(substr(obter_dados_pf_pj(a.cd_pessoa_fisica, a.cd_cgc, 'CI'),1,100),22),1,22) ds_municipio, 
	substr(campo_aspas(substr(obter_dados_pf_pj(a.cd_pessoa_fisica, a.cd_cgc, 'UF'),1,100),4),1,4) sg_estado, 
	substr(campo_aspas(substr(obter_dados_pf_pj(a.cd_pessoa_fisica, a.cd_cgc, 'CEP'),1,100),10),1,10) cd_cep, 
	substr(campo_aspas(substr(obter_dados_pf_pj(a.cd_pessoa_fisica, a.cd_cgc, 'T'),1,100),22),1,22) nr_telefone, 
	substr(campo_aspas(' ',32),1,32) nm_contato, 
	b.nr_seq_cobertura nr_seq_cobertura 
FROM	eme_tipo_cobertura c, 
	eme_contrato b, 
	eme_pf_contrato a 
where	a.nr_seq_contrato = b.nr_sequencia 
and	c.nr_sequencia = b.nr_seq_cobertura 
and	c.ie_tipo_cobertura = 'U' 
and	c.ie_pessoa_fisica = 'S' 

union
 
/* Contratos do tipo (Escolas ou Area protegida) 
desde que sejam (cobertura pessoa f√≠sica)*/
 
select	b.cd_contrato, 
	substr(obter_cpf_pessoa_fisica(b.cd_pessoa_fisica),1,11), 
	substr(campo_aspas(substr(b.cd_usuario_convenio,1,3),5),1,5), 
	substr(campo_aspas(substr(b.cd_usuario_convenio,4,4),6),1,6), 
	substr(campo_aspas(substr(b.cd_usuario_convenio,8,6),8),1,8), 
	substr(campo_aspas(substr(b.cd_usuario_convenio,14,2),4),1,4), 
	substr(campo_aspas('   ',7),1,7), 
	substr(campo_aspas(substr(obter_nome_pf_pj(b.cd_pessoa_fisica, b.cd_cgc),1,100),42),1,42), 
	substr(campo_aspas(coalesce(substr(obter_sexo_pf(b.cd_pessoa_fisica,'C'),1,1),' '),3),1,3), 
	substr(campo_aspas(CASE WHEN obter_dados_pf(b.cd_pessoa_fisica,'EC')='1' THEN '2' WHEN obter_dados_pf(b.cd_pessoa_fisica,'EC')=2 THEN '1' WHEN obter_dados_pf(b.cd_pessoa_fisica,'EC')=3 THEN '4' WHEN obter_dados_pf(b.cd_pessoa_fisica,'EC')=4 THEN '6' WHEN obter_dados_pf(b.cd_pessoa_fisica,'EC')=5 THEN '5'  ELSE '6' END ,3),1,3), 
	substr(campo_aspas(substr(obter_dados_pf(b.cd_pessoa_fisica,'DN'),1,20),12),1,12), 
	substr(campo_aspas(to_char(b.dt_contrato,'dd/mm/yyyy'),12),1,12), 
	substr(campo_aspas(to_char(b.dt_cancelamento,'dd/mm/yyyy'),12),1,12), 
	substr(campo_aspas('2',3),1,3), 
	substr(campo_aspas(substr(obter_dados_pf_pj(b.cd_pessoa_fisica, b.cd_cgc, 'EN'),1,100),42),1,42), 
	substr(campo_aspas(substr(obter_dados_pf_pj(b.cd_pessoa_fisica, b.cd_cgc, 'CO'),1,100),22),1,22), 
	substr(campo_aspas(substr(obter_dados_pf_pj(b.cd_pessoa_fisica, b.cd_cgc, 'B'),1,100),22),1,22), 
	substr(campo_aspas(substr(obter_dados_pf_pj(b.cd_pessoa_fisica, b.cd_cgc, 'CI'),1,100),22),1,22), 
	substr(campo_aspas(substr(obter_dados_pf_pj(b.cd_pessoa_fisica, b.cd_cgc, 'UF'),1,100),4),1,4), 
	substr(campo_aspas(substr(obter_dados_pf_pj(b.cd_pessoa_fisica, b.cd_cgc, 'CEP'),1,100),10),1,10), 
	substr(campo_aspas(substr(obter_dados_pf_pj(b.cd_pessoa_fisica, b.cd_cgc, 'T'),1,100),22),1,22), 
	substr(campo_aspas(' ',32),1,32), 
	b.nr_seq_cobertura 
from	eme_tipo_cobertura c, 
	eme_contrato b 
where	c.nr_sequencia = b.nr_seq_cobertura 
and	c.ie_tipo_cobertura in ('P','E') 
and	c.ie_pessoa_fisica = 'N' 

union
 
/* Contratos do tipo (Escolas) que tem como as escola dependentes do contrato 
EX: Contrato da prefeitura e com escolas de dependentes*/
 
select	b.cd_contrato cd_contrato, 
	substr(obter_cpf_pessoa_fisica(a.cd_pessoa_fisica),1,11) nr_cpf, 
	substr(campo_aspas(substr(a.cd_codigo_convenio,1,3),5),1,5) cd_unimed, 
	substr(campo_aspas(substr(a.cd_codigo_convenio,4,4),6),1,6) cd_empresa, 
	substr(campo_aspas(substr(a.cd_codigo_convenio,8,6),8),1,8) cd_familia, 
	substr(campo_aspas(substr(a.cd_codigo_convenio,14,2),4),1,4) cd_dependencia, 
	substr(campo_aspas('   ',7),1,7) ds_branco, 
	substr(campo_aspas(substr(obter_nome_pf_pj(a.cd_pessoa_fisica, a.cd_cgc),1,100),42),1,42) nm_pessoa, 
	substr(campo_aspas(coalesce(substr(obter_sexo_pf(a.cd_pessoa_fisica,'C'),1,1),' '),3),1,3) ie_sexo, 
	substr(campo_aspas(CASE WHEN obter_dados_pf(a.cd_pessoa_fisica,'EC')='1' THEN '2' WHEN obter_dados_pf(a.cd_pessoa_fisica,'EC')=2 THEN '1' WHEN obter_dados_pf(a.cd_pessoa_fisica,'EC')=3 THEN '4' WHEN obter_dados_pf(a.cd_pessoa_fisica,'EC')=4 THEN '6' WHEN obter_dados_pf(a.cd_pessoa_fisica,'EC')=5 THEN '5'  ELSE '6' END ,3),1,3) ie_estado_civil, 
	substr(campo_aspas(substr(obter_dados_pf(a.cd_pessoa_fisica,'DN'),1,20),12),1,12) dt_nascimento, 
	substr(campo_aspas(to_char(a.dt_inclusao,'dd/mm/yyyy'),12),1,12) dt_inclusao, 
	substr(campo_aspas(to_char(a.dt_cancelamento,'dd/mm/yyyy'),12),1,12) dt_cancelamento, 
	substr(campo_aspas('2',3),1,3) ie_tipo_pessoa, 
	substr(campo_aspas(substr(obter_dados_pf_pj(a.cd_pessoa_fisica, a.cd_cgc, 'EN'),1,100),42),1,42) ds_endereco, 
	substr(campo_aspas(substr(obter_dados_pf_pj(a.cd_pessoa_fisica, a.cd_cgc, 'CO'),1,100),22),1,22) ds_complemento, 
	substr(campo_aspas(substr(obter_dados_pf_pj(a.cd_pessoa_fisica, a.cd_cgc, 'B'),1,100),22),1,22) ds_bairro, 
	substr(campo_aspas(substr(obter_dados_pf_pj(a.cd_pessoa_fisica, a.cd_cgc, 'CI'),1,100),22),1,22) ds_municipio, 
	substr(campo_aspas(substr(obter_dados_pf_pj(a.cd_pessoa_fisica, a.cd_cgc, 'UF'),1,100),4),1,4) sg_estado, 
	substr(campo_aspas(substr(obter_dados_pf_pj(a.cd_pessoa_fisica, a.cd_cgc, 'CEP'),1,100),10),1,10) cd_cep, 
	substr(campo_aspas(substr(obter_dados_pf_pj(a.cd_pessoa_fisica, a.cd_cgc, 'T'),1,100),22),1,22) nr_telefone, 
	substr(campo_aspas(' ',32),1,32) nm_contato, 
	b.nr_seq_cobertura nr_seq_cobertura 
from	eme_tipo_cobertura c, 
	eme_contrato b, 
	eme_pf_contrato a 
where	a.nr_seq_contrato = b.nr_sequencia 
and	c.nr_sequencia = b.nr_seq_cobertura 
and	c.ie_tipo_cobertura = 'E' 
and	c.ie_pessoa_fisica = 'S';

