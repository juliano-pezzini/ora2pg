-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW consulta_ageserv_html5_v (cd_agenda, ds_agenda, cd_tipo_agenda, ie_agendamento_coletivo, cd_estabelecimento, ie_situacao, nr_sequencia, dt_agenda, hr_inicio, nr_minuto_duracao, ie_status_agenda, ie_classif_agenda, ds_classificacao, cd_pessoa_fisica, nm_paciente, cd_medico, nm_pessoa_fisica, cd_convenio, cd_categoria, cd_plano, cd_procedencia, ds_convenio, nr_atendimento, cd_procedimento, ie_origem_proced, nr_seq_proc_interno, ds_observacao, ds_sala, ds_complemento, ds_curta, nr_pront_ext, cd_motivo_cancelamento, ie_encaixe, cd_medico_resp, cd_especialidade, nm_usuario_origem, dt_agendamento, nm_medico_agendamento, ie_reference_letter, ie_emergency_response_required, ds_procedencia, nr_seq_status_pac) AS select	a.cd_agenda,
		a.ds_agenda,
		a.cd_tipo_agenda,	
		(select max(I.ie_agend_coletivo) FROM agenda_integrada I, agenda_integrada_item C where I.nr_sequencia = C.nr_seq_agenda_int and C.NR_SEQ_AGENDA_CONS = B.NR_SEQUENCIA) as ie_agendamento_coletivo,
		a.cd_estabelecimento,			
		a.ie_situacao,
		b.nr_sequencia,	
		b.dt_agenda,
		b.dt_agenda hr_inicio,
		b.nr_minuto_duracao,	
		b.ie_status_agenda,	
		b.ie_classif_agenda,		
		f.ds_classificacao,
		b.cd_pessoa_fisica,	
		b.nm_paciente,	
		b.cd_medico,	
		m.nm_pessoa_fisica,				
		b.cd_convenio,
		b.cd_categoria,
		b.cd_plano,
		b.cd_procedencia,	
		x.ds_convenio,
		b.nr_atendimento,
		b.cd_procedimento,
		b.ie_origem_proced,
		b.nr_seq_proc_interno,			
		b.ds_observacao,		
		q.ds_sala,		
		a.ds_complemento,
		a.ds_curta,
		C.nr_pront_ext,	
		b.cd_motivo_cancelamento,	
		b.ie_encaixe,	
		y.cd_medico_resp,			
		a.cd_especialidade,	
		b.nm_usuario_origem,
		b.dt_agendamento,
		SUBSTR(obter_nome_pf(b.cd_medico),1,255) nm_medico_agendamento,
		adic.ie_reference_letter,
		adic.ie_emergency_response_required,
		coalesce(obter_desc_procedencia(b.cd_procedencia), adic.ds_procedencia_var) ds_procedencia,
    b.nr_seq_status_pac
FROM agenda_consulta b
LEFT OUTER JOIN agenda_classif f ON (b.ie_classif_agenda = f.cd_classificacao)
LEFT OUTER JOIN pessoa_fisica c ON (b.cd_pessoa_fisica = C.cd_pessoa_fisica)
LEFT OUTER JOIN pessoa_fisica m ON (b.cd_medico = m.cd_pessoa_fisica)
LEFT OUTER JOIN convenio x ON (b.cd_convenio = x.cd_convenio)
LEFT OUTER JOIN atendimento_paciente y ON (b.nr_atendimento = y.nr_atendimento)
LEFT OUTER JOIN agenda_sala_consulta q ON (b.nr_seq_sala = q.nr_sequencia)
LEFT OUTER JOIN agenda_consulta_adic adic ON (b.nr_sequencia = adic.nr_seq_agenda)
, agenda a
LEFT OUTER JOIN pessoa_fisica p ON (a.cd_pessoa_fisica = p.cd_pessoa_fisica)
WHERE a.cd_agenda		= b.cd_agenda  and a.cd_tipo_agenda	= 5;

