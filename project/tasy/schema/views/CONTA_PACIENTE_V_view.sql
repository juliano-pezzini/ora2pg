-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW conta_paciente_v (dt_entrada_unidade, nr_atendimento, ie_proc_mat, dt_conta, dt_ent_unidade, dt_item, cd_item, cd_item_convenio, qt_item, vl_item, vl_medico, vl_anestesista, vl_filme, vl_auxiliares, vl_custo_operacional, dt_acerto_conta, dt_acerto_convenio, cd_convenio, cd_categoria, cd_setor_atendimento, ie_cobra_pf_pj, nr_interno_conta, nm_usuario, dt_atualizacao, nr_prescricao, dt_prescricao, nr_sequencia_prescricao, cd_medico_executor, cd_procedimento_princ, nr_cirurgia, ie_valor_informado, cd_situacao_glosa, tx_procedimento, ds_item, tp_item, cd_classe_item, ds_classe_item, cd_subgrupo_item, ds_subgrupo_item, cd_grupo_item, ds_grupo_item, ds_unidade, cd_motivo_exc_conta, vl_unitario, nr_doc_convenio, nr_sequencia, ie_origem_proced, nr_seq_proc_pacote, vl_original, qt_porte_anestesico, tx_hora_extra, nr_seq_protocolo, nr_seq_protocolo_sel, ie_status_acerto, ie_emite_conta, ie_emite_conta_honor, ie_responsavel_credito, vl_medico_conta, ie_tipo_guia, ie_cancelamento, nr_seq_atepacu, nr_seq_proc_princ, ds_compl_motivo_excon, ds_proc_interno, ds_proc_int_ou_orig, cd_cgc_prestador, cd_motivo_ajuste, nm_usuario_original, ie_auditoria, ds_observacao, ds_exame, cd_setor_paciente, cd_estabelecimento, cd_conta_contabil, nr_seq_grupo_rec, cd_senha, dt_mesano_referencia, cd_tipo_procedimento, nr_seq_proc_interno, nr_seq_cor_exec, cd_procedimento_tuss, cd_local_estoque, cd_responsavel) AS SELECT TO_DATE(TO_CHAR(A.DT_ENTRADA_UNIDADE, 'DD/MM/YYYY'),'DD/MM/YYYY') DT_ENTRADA_UNIDADE,
       A.NR_ATENDIMENTO,
       1 IE_PROC_MAT,
       A.DT_CONTA,
       A.DT_ENTRADA_UNIDADE   DT_ENT_UNIDADE,
       A.DT_PROCEDIMENTO      DT_ITEM,
       A.CD_PROCEDIMENTO      CD_ITEM,
       A.CD_PROCEDIMENTO_CONVENIO      CD_ITEM_CONVENIO,
       A.QT_PROCEDIMENTO      QT_ITEM,
       A.VL_PROCEDIMENTO      VL_ITEM,
       A.VL_MEDICO            VL_MEDICO,
       A.VL_ANESTESISTA       VL_ANESTESISTA,
       A.VL_MATERIAIS         VL_FILME,
       A.VL_AUXILIARES        VL_AUXILIARES,
       A.VL_CUSTO_OPERACIONAL VL_CUSTO_OPERACIONAL,
       A.DT_ACERTO_CONTA,
       A.DT_ACERTO_CONVENIO,
       A.CD_CONVENIO,
       A.CD_CATEGORIA,
       A.CD_SETOR_ATENDIMENTO,
       A.IE_COBRA_PF_PJ,
       A.NR_INTERNO_CONTA,
	 A.NM_USUARIO,
	 A.DT_ATUALIZACAO,
	 A.NR_PRESCRICAO,
	 A.DT_PRESCRICAO,
	 A.NR_SEQUENCIA_PRESCRICAO,
	 A.CD_MEDICO_EXECUTOR,
	 A.CD_PROCEDIMENTO_PRINC,
	 A.NR_CIRURGIA,
	 A.IE_VALOR_INFORMADO,
	 A.CD_SITUACAO_GLOSA,
	 A.TX_PROCEDIMENTO,
       C.DS_PROCEDIMENTO      DS_ITEM,
       C.IE_CLASSIFICACAO     TP_ITEM          /* 1-AMB  2-SERVICOS 3-DIARIAS */
,
       C.CD_GRUPO_PROC        CD_CLASSE_ITEM,
       D.DS_GRUPO_PROC        DS_CLASSE_ITEM,
       CASE WHEN C.IE_CLASSIFICACAO=1 THEN D.CD_ESPECIALIDADE  ELSE 0 END  CD_SUBGRUPO_ITEM,
       CASE WHEN C.IE_CLASSIFICACAO=1 THEN E.DS_ESPECIALIDADE WHEN C.IE_CLASSIFICACAO=2 THEN 		'Servicos'  ELSE 'Diarias' END  DS_SUBGRUPO_ITEM,
       E.CD_AREA_PROCEDIMENTO CD_GRUPO_ITEM,
       F.DS_AREA_PROCEDIMENTO DS_GRUPO_ITEM,
       'Un' DS_UNIDADE,
       A.CD_MOTIVO_EXC_CONTA,
       (A.VL_PROCEDIMENTO /
		CASE WHEN A.QT_PROCEDIMENTO=0 THEN 1  ELSE A.QT_PROCEDIMENTO END ) VL_UNITARIO,
	 A.NR_DOC_CONVENIO,
	A.NR_SEQUENCIA,
	A.IE_ORIGEM_PROCED,
	A.NR_SEQ_PROC_PACOTE,
	coalesce(G.VL_PROCEDIMENTO, 0) VL_ORIGINAL,
	A.QT_PORTE_ANESTESICO,
	A.TX_HORA_EXTRA,
	coalesce(M.NR_SEQ_PROTOCOLO,0) NR_SEQ_PROTOCOLO,
	M.NR_SEQ_PROTOCOLO NR_SEQ_PROTOCOLO_SEL,
	M.IE_STATUS_ACERTO,
	A.IE_EMITE_CONTA,
	A.IE_EMITE_CONTA_HONOR,
	A.IE_RESPONSAVEL_CREDITO,
	obter_valor_Medico_Proc(A.nr_sequencia) vl_medico_conta,
	A.ie_tipo_guia,
	M.ie_cancelamento,
	A.nr_seq_atepacu,
	A.nr_seq_proc_princ,
	A.DS_COMPL_MOTIVO_EXCON,
	substr(Obter_Desc_Proc_Interno(A.nr_seq_proc_interno),1,80) ds_proc_interno,
	coalesce(substr(Obter_Desc_Proc_Interno(A.nr_seq_proc_interno),1,80),C.DS_PROCEDIMENTO) ds_proc_int_ou_orig,
	A.cd_cgc_prestador,
	A.cd_motivo_ajuste,
	A.nm_usuario_original,
	A.ie_auditoria,
	A.ds_observacao,
	substr(obter_desc_exame(A.nr_seq_exame),1,150) ds_exame,
	A.cd_setor_paciente,
	M.cd_estabelecimento,
	A.cd_conta_contabil,
	A.nr_seq_grupo_rec,
	A.cd_senha,
	M.dt_mesano_referencia,
	C.cd_tipo_procedimento,
	A.nr_seq_proc_interno,
	A.nr_seq_cor_exec,
	A.cd_procedimento_tuss,
	null cd_local_estoque,
	M.cd_responsavel
FROM conta_paciente m, area_procedimento f, especialidade_proc e, grupo_proc d, procedimento c, procedimento_paciente a, (a
LEFT OUTER JOIN proc_paciente_valor g ON (A.NR_SEQUENCIA = G.NR_SEQ_PROCEDIMENTO AND 1 = G.IE_TIPO_VALOR)
WHERE (A.CD_PROCEDIMENTO       = C.CD_PROCEDIMENTO) AND (A.IE_ORIGEM_PROCED      = C.IE_ORIGEM_PROCED) AND (C.CD_GRUPO_PROC         = D.CD_GRUPO_PROC) AND (D.CD_ESPECIALIDADE      = E.CD_ESPECIALIDADE) AND (E.CD_AREA_PROCEDIMENTO  = F.CD_AREA_PROCEDIMENTO)   AND (A.NR_INTERNO_CONTA	  = M.NR_INTERNO_CONTA)

UNION

SELECT TO_DATE(TO_CHAR(X.DT_ENTRADA_UNIDADE, 'DD/MM/YYYY'),'DD/MM/YYYY') DT_ENTRADA_UNIDADE,
       X.NR_ATENDIMENTO,
       2 IE_PROC_MAT,
       X.DT_CONTA,
       X.DT_ENTRADA_UNIDADE   DT_ENT_UNIDADE,
       X.DT_ATENDIMENTO       DT_ITEM,
       X.CD_MATERIAL          CD_ITEM,
       X.CD_MATERIAL_CONVENIO      CD_ITEM_CONVENIO,
       X.QT_MATERIAL          QT_ITEM,
       X.VL_MATERIAL          VL_ITEM,
       0                      VL_MEDICO,
       0                      VL_ANESTESISTA,
       0                      VL_FILME,
       0                      VL_AUXILIARES,
       0                      VL_CUSTO_OPERACIONAL,
       X.DT_ACERTO_CONTA,
       X.DT_ACERTO_CONVENIO,
       X.CD_CONVENIO,
       X.CD_CATEGORIA,
       X.CD_SETOR_ATENDIMENTO,
       '' IE_COBRA_PF_PJ,
       X.NR_INTERNO_CONTA,
	 X.NM_USUARIO,
	 X.DT_ATUALIZACAO,
	 X.NR_PRESCRICAO,
	 X.DT_PRESCRICAO,
	 X.NR_SEQUENCIA_PRESCRICAO,
	 '' CD_MEDICO_EXECUTOR,
	 0 CD_PROCEDIMENTO_PRINC,
	 X.NR_CIRURGIA,
	 X.IE_VALOR_INFORMADO,
	 X.CD_SITUACAO_GLOSA,
	 0 TX_PROCEDIMENTO,
       W.DS_MATERIAL          DS_ITEM,
       CASE WHEN W.IE_TIPO_MATERIAL=1 THEN '1' WHEN W.IE_TIPO_MATERIAL=2 THEN '2' WHEN W.IE_TIPO_MATERIAL=3 THEN '2'  ELSE '5' END      TP_ITEM        /* 1-MATERIAL 2-MED.GENERICO 3-MED.COMERC. */
,
       0,
       '',
       0,
       CASE WHEN IE_TIPO_MATERIAL=1 THEN 'Materiais' WHEN IE_TIPO_MATERIAL=2 THEN 'Medicamentos' WHEN IE_TIPO_MATERIAL=3 THEN 'Medicamentos'  ELSE 'Extras' END  DS_SUBGRUPO_ITEM,
       0,
       '',
       X.CD_UNIDADE_MEDIDA DS_UNIDADE,
       X.CD_MOTIVO_EXC_CONTA,
       X.VL_UNITARIO,
	 X.NR_DOC_CONVENIO,
	X.NR_SEQUENCIA,
       0                      IE_ORIGEM_PROCED,
	X.NR_SEQ_PROC_PACOTE,
	coalesce(X.VL_TABELA_ORIGINAL, 0),
	0,
	0,
	coalesce(M.NR_SEQ_PROTOCOLO,0) NR_SEQ_PROTOCOLO,
	M.NR_SEQ_PROTOCOLO NR_SEQ_PROTOCOLO_SEL,
	M.IE_STATUS_ACERTO,
	X.IE_EMITE_CONTA,
	'' IE_EMITE_CONTA_HONOR,
	x.ie_responsavel_credito,
	0 vl_medico_conta,
	x.ie_tipo_guia,
	M.ie_cancelamento,
	x.nr_seq_atepacu,
	x.nr_seq_proc_princ,
	x.DS_COMPL_MOTIVO_EXCON,
	'',
	'',
	x.cd_cgc_prestador,
	x.cd_motivo_ajuste,
	x.nm_usuario_original,
	x.ie_auditoria,
	x.ds_observacao,
	'',
	x.cd_setor_paciente,
	M.cd_estabelecimento,
	x.cd_conta_contabil,
	x.nr_seq_grupo_rec,
	x.cd_senha,
	M.dt_mesano_referencia,
	null,
	null nr_seq_proc_interno,
	x.nr_seq_cor_exec,
	null cd_procedimento_tuss,
	x.cd_local_estoque,
	M.cd_responsavel
FROM   MATERIAL W,
       MATERIAL_ATEND_PACIENTE X,
 	 CONTA_PACIENTE M
WHERE (X.CD_MATERIAL           = W.CD_MATERIAL)
AND (X.NR_INTERNO_CONTA	  = M.NR_INTERNO_CONTA);

