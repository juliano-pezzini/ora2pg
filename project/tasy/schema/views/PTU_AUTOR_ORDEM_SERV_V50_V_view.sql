-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ptu_autor_ordem_serv_v50_v (ie_tipo_registro, nr_seq_guia, nr_seq_requisicao, cd_transacao, ie_tipo_cliente, cd_unimed_executora, cd_unimed_beneficiario, cd_unimed_solicitante, nr_seq_execucao, nr_seq_origem, nr_seq_solicitante, dt_validade, nr_versao, ds_mensagem, ie_tipo_tabela, cd_servico, ds_servico, qt_autorizado, ie_autorizado, cd_mens_espec_1, cd_mens_espec_2, cd_mens_espec_3, cd_mens_espec_4, ds_mens_espec_1, ds_mens_espec_2, ds_mens_espec_3, ds_mens_espec_4, ds_fim) AS select	1					ie_tipo_registro,	-- primeiro segmento - dados da transação
	nr_seq_guia				nr_seq_guia,
	nr_seq_requisicao			nr_seq_requisicao,
	cd_transacao				cd_transacao,
	ie_tipo_cliente				ie_tipo_cliente,
	cd_unimed_executora			cd_unimed_executora,
	cd_unimed_beneficiario			cd_unimed_beneficiario,
	cd_unimed_solicitante			cd_unimed_solicitante,
	nr_seq_execucao				nr_seq_execucao,
	nr_seq_origem				nr_seq_origem,
	nr_transacao_solicitante		nr_seq_solicitante,
	dt_validade				dt_validade,
	pls_obter_versao_scs			nr_versao,
	null					ds_mensagem,
	null					ie_tipo_tabela,
	null					cd_servico,
	null					ds_servico,
	null					qt_autorizado,
	null					ie_autorizado,
	null					cd_mens_espec_1,
	null					cd_mens_espec_2,
	null					cd_mens_espec_3,
	null					cd_mens_espec_4,
	null					ds_mens_espec_1,
	null					ds_mens_espec_2,
	null					ds_mens_espec_3,
	null					ds_mens_espec_4,
	null					ds_fim
FROM	ptu_autorizacao_ordem_serv

union

select	2					ie_tipo_registro,	-- segundo segmento - mensagem livre
	nr_seq_guia				nr_seq_guia,
	nr_seq_requisicao			nr_seq_requisicao,
	null					cd_transacao,
	null					ie_tipo_cliente,
	null					cd_unimed_executora,
	null					cd_unimed_beneficiario,
	null					cd_unimed_solicitante,
	null					nr_seq_execucao,
	null					nr_seq_origem,
	null					nr_seq_solicitante,
	null					dt_validade,
	null					nr_versao,
	substr(ds_observacao,1,999)		ds_mensagem,
	null					ie_tipo_tabela,
	null					cd_servico,
	null					ds_servico,
	null					qt_autorizado,
	null					ie_autorizado,
	null					cd_mens_espec_1,
	null					cd_mens_espec_2,
	null					cd_mens_espec_3,
	null					cd_mens_espec_4,
	null					ds_mens_espec_1,
	null					ds_mens_espec_2,
	null					ds_mens_espec_3,
	null					ds_mens_espec_4,
	null					ds_fim
from	ptu_requisicao_ordem_serv

union

select	3					ie_tipo_registro,	-- bloco de serviços
	nr_seq_guia				nr_seq_guia,
	nr_seq_requisicao			nr_seq_requisicao,
	null					cd_transacao,
	null					ie_tipo_cliente,
	null					cd_unimed_executora,
	null					cd_unimed_beneficiario,
	null					cd_unimed_solicitante,
	null					nr_seq_execucao,
	null					nr_seq_origem,
	null					nr_seq_solicitante,
	null					dt_validade,
	null					nr_versao,
	null					ds_mensagem,
	ie_tipo_tabela				ie_tipo_tabela,
	cd_servico				cd_servico,
	ds_servico				ds_servico,
	ptu_obter_qtd_env_itens_scs(qt_autorizado, null,'E') qt_autorizado,
	ie_autorizado				ie_autorizado,
	ptu_obter_inconsist_trans(nr_seq_guia,nr_seq_requisicao,null,'00804',1,null,cd_servico)	cd_mens_espec_1,
	ptu_obter_inconsist_trans(nr_seq_guia,nr_seq_requisicao,null,'00804',2,null,cd_servico)	cd_mens_espec_2,
	ptu_obter_inconsist_trans(nr_seq_guia,nr_seq_requisicao,null,'00804',3,null,cd_servico)	cd_mens_espec_3,
	ptu_obter_inconsist_trans(nr_seq_guia,nr_seq_requisicao,null,'00804',4,null,cd_servico)	cd_mens_espec_4,
	Elimina_Acentuacao(ptu_obter_desc_msg_negativa(ptu_obter_inconsist_trans(nr_seq_guia,nr_seq_requisicao,null,'00804',1,null,cd_servico))) ds_mens_espec_1,
	Elimina_Acentuacao(ptu_obter_desc_msg_negativa(ptu_obter_inconsist_trans(nr_seq_guia,nr_seq_requisicao,null,'00804',2,null,cd_servico))) ds_mens_espec_2,
	Elimina_Acentuacao(ptu_obter_desc_msg_negativa(ptu_obter_inconsist_trans(nr_seq_guia,nr_seq_requisicao,null,'00804',3,null,cd_servico))) ds_mens_espec_3,
	Elimina_Acentuacao(ptu_obter_desc_msg_negativa(ptu_obter_inconsist_trans(nr_seq_guia,nr_seq_requisicao,null,'00804',4,null,cd_servico))) ds_mens_espec_4,
	null					ds_fim
from	ptu_aut_ordem_serv_servico a,
	ptu_autorizacao_ordem_serv b
where	a.nr_seq_aut_ord_serv 	= b.nr_sequencia

union

select	4					ie_tipo_registro,	-- fim da transação
	nr_seq_guia				nr_seq_guia,
	nr_seq_requisicao			nr_seq_requisicao,
	null					cd_transacao,
	null					ie_tipo_cliente,
	null					cd_unimed_executora,
	null					cd_unimed_beneficiario,
	null					cd_unimed_solicitante,
	null					nr_seq_execucao,
	null					nr_seq_origem,
	null					nr_seq_solicitante,
	null					dt_validade,
	null					nr_versao,
	null					ds_mensagem,
	null					ie_tipo_tabela,
	null					cd_servico,
	null					ds_servico,
	null					qt_autorizado,
	null					ie_autorizado,
	null					cd_mens_espec_1,
	null					cd_mens_espec_2,
	null					cd_mens_espec_3,
	null					cd_mens_espec_4,
	null					ds_mens_espec_1,
	null					ds_mens_espec_2,
	null					ds_mens_espec_3,
	null					ds_mens_espec_4,
	'fim$'					ds_fim
from	ptu_autorizacao_ordem_serv;

