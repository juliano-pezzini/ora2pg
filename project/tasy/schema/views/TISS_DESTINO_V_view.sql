-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW tiss_destino_v (ds_versao, cd_ans, nr_sequencia_autor, nr_seq_protocolo, nr_seq_med_prot, nr_seq_retorno, nr_protocolo_receb, nr_seq_lote_anexo, nr_seq_pedido_exame_ext, nr_seq_rec_glosa_prot_cancel, nr_seq_tiss_env_doc) AS select	'2.01.01' ds_versao,
	-- campos utilizados na identificacao da transacao

	coalesce(d.cd_ans, c.cd_ans)cd_ans,
	-- campos que devem ser utilizados como filtros

	a.nr_sequencia 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	null			nr_protocolo_receb,
	null 			nr_seq_lote_anexo,
	null			nr_seq_pedido_Exame_ext,
	null			nr_seq_rec_glosa_prot_cancel,
    null            nr_seq_tiss_env_doc
FROM	pessoa_juridica c,
	convenio b,
	autorizacao_convenio a,
    convenio_estabelecimento d
where	a.cd_convenio		= b.cd_convenio
and	b.cd_cgc		= c.cd_cgc
and	d.cd_convenio 		= a.cd_convenio
and	d.cd_estabelecimento = a.cd_estabelecimento

union

select	'2.01.01' ds_versao,
	-- campos utilizados na identificacao da transacao

	coalesce(a.cd_ans, coalesce(d.cd_ans,c.cd_ans)),
	-- campos que devem ser utilizados como filtros

	(null)::numeric 	nr_sequencia_autor,
	a.nr_seq_protocolo,
	(null)::numeric 	nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	null			nr_protocolo_receb,
	null 			nr_seq_lote_anexo,
	null			nr_seq_pedido_Exame_ext,
	null			nr_seq_rec_glosa_prot_cancel,
    null            nr_seq_tiss_env_doc
from	pessoa_juridica c,
	convenio_estabelecimento d,
	convenio b,
	protocolo_convenio a
where	a.cd_convenio		= b.cd_convenio
and	b.cd_cgc		= c.cd_cgc
and	d.cd_convenio 		= b.cd_convenio
and	d.cd_estabelecimento 	= a.cd_estabelecimento

union

select	'2.01.01' ds_versao,
	-- campos utilizados na identificacao da transacao

	c.cd_ans,
	-- campos que devem ser utilizados como filtros

	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	a.nr_sequencia		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	null			nr_protocolo_receb,
	null 			nr_seq_lote_anexo,
	null			nr_seq_pedido_Exame_ext,
	null			nr_seq_rec_glosa_prot_cancel,
    null            nr_seq_tiss_env_doc
from	pessoa_juridica c,
	convenio b,
	med_prot_convenio a
where	a.cd_convenio		= b.cd_convenio
and	b.cd_cgc		= c.cd_cgc

union

select	'2.01.01' ds_versao,
	-- campos utilizados na identificacao da transacao

	coalesce(d.cd_ans, c.cd_ans)cd_ans,
	-- campos que devem ser utilizados como filtros

	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	a.nr_sequencia		nr_seq_retorno,
	null			nr_protocolo_receb,
	null 			nr_seq_lote_anexo,
	null			nr_seq_pedido_Exame_ext,
	null			nr_seq_rec_glosa_prot_cancel,
    null            nr_seq_tiss_env_doc
from	pessoa_juridica c,
	convenio b,
	convenio_retorno a,
    convenio_estabelecimento d
where	a.cd_convenio		= b.cd_convenio
and	b.cd_cgc		= c.cd_cgc
and d.cd_convenio = a.cd_convenio
and d.cd_estabelecimento = a.cd_estabelecimento

union

select	'2.01.01' ds_versao,
	coalesce(d.cd_ans, c.cd_ans)cd_ans,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	e.nr_sequencia		nr_protocolo_receb,
	null 			nr_seq_lote_anexo,
	null			nr_seq_pedido_Exame_ext,
	null			nr_seq_rec_glosa_prot_cancel,
    null            nr_seq_tiss_env_doc
from	pessoa_juridica c,
	convenio b,
	protocolo_convenio a,
	tiss_protocolo_envio_ret e,
    convenio_estabelecimento d
where	a.cd_convenio		= b.cd_convenio
and	e.nr_seq_protocolo	= a.nr_seq_protocolo
and	b.cd_cgc		= c.cd_cgc
and d.cd_convenio = a.cd_convenio
and d.cd_estabelecimento = a.cd_estabelecimento

union

select	'3.00.01' ds_versao,
	-- campos utilizados na identificacao da transacao

	coalesce(d.cd_ans, c.cd_ans)cd_ans,
	-- campos que devem ser utilizados como filtros

	(null)::numeric  	nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	null			nr_protocolo_receb,
	a.nr_sequencia		nr_seq_lote_anexo,
	null			nr_seq_pedido_Exame_ext,
	null			nr_seq_rec_glosa_prot_cancel,
    null            nr_seq_tiss_env_doc
from	pessoa_juridica c,
	convenio b,
	tiss_anexo_lote a,
    convenio_estabelecimento d
where	a.cd_convenio		= b.cd_convenio
and	b.cd_cgc		= c.cd_cgc
and d.cd_convenio = b.cd_convenio
and d.cd_estabelecimento = a.cd_estabelecimento

union

select	'3.01.00' ds_versao,
	-- campos utilizados na identificacao da transacao

	coalesce(d.cd_ans, c.cd_ans)cd_ans,
	-- campos que devem ser utilizados como filtros

	(null)::numeric  	nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	null			nr_protocolo_receb,
	a.nr_sequencia		nr_seq_lote_anexo,
	null			nr_seq_pedido_Exame_ext,
	null			nr_seq_rec_glosa_prot_cancel,
    null            nr_seq_tiss_env_doc
from	pessoa_juridica c,
	convenio b,
	tiss_anexo_lote a,
    convenio_estabelecimento d
where	a.cd_convenio		= b.cd_convenio
and	b.cd_cgc		= c.cd_cgc
and d.cd_convenio = b.cd_convenio
and d.cd_estabelecimento = a.cd_estabelecimento

union

select	'3.02.00' ds_versao,
	-- campos utilizados na identificacao da transacao

	coalesce(d.cd_ans, c.cd_ans)cd_ans,
	-- campos que devem ser utilizados como filtros

	(null)::numeric  	nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	null			nr_protocolo_receb,
	a.nr_sequencia		nr_seq_lote_anexo,
	null			nr_seq_pedido_Exame_ext,
	null			nr_seq_rec_glosa_prot_cancel,
    null            nr_seq_tiss_env_doc
from	pessoa_juridica c,
	convenio b,
	tiss_anexo_lote a,
    convenio_estabelecimento d
where	a.cd_convenio		= b.cd_convenio
and	b.cd_cgc		= c.cd_cgc
and d.cd_convenio = b.cd_convenio
and d.cd_estabelecimento = a.cd_estabelecimento

union

select	'3.02.01' ds_versao,
	-- campos utilizados na identificacao da transacao

	coalesce(d.cd_ans, c.cd_ans)cd_ans,
	-- campos que devem ser utilizados como filtros

	(null)::numeric  	nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	null			nr_protocolo_receb,
	a.nr_sequencia		nr_seq_lote_anexo,
	null			nr_seq_pedido_Exame_ext,
	null			nr_seq_rec_glosa_prot_cancel,
    null            nr_seq_tiss_env_doc
from	pessoa_juridica c,
	convenio b,
	tiss_anexo_lote a,
    convenio_estabelecimento d
where	a.cd_convenio		= b.cd_convenio
and	b.cd_cgc			= c.cd_cgc
and d.cd_convenio = b.cd_convenio
and d.cd_estabelecimento = a.cd_estabelecimento

union

select	'3.02.02' ds_versao,
	-- campos utilizados na identificacao da transacao

	coalesce(d.cd_ans, c.cd_ans)cd_ans,
	-- campos que devem ser utilizados como filtros

	(null)::numeric  		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	null			nr_protocolo_receb,
	a.nr_sequencia		nr_seq_lote_anexo,
	null			nr_seq_pedido_Exame_ext,
	null			nr_seq_rec_glosa_prot_cancel,
    null            nr_seq_tiss_env_doc
from	pessoa_juridica c,
	convenio b,
	tiss_anexo_lote a,
    convenio_estabelecimento d
where	a.cd_convenio		= b.cd_convenio
and	b.cd_cgc			= c.cd_cgc
and d.cd_convenio = b.cd_convenio
and d.cd_estabelecimento = a.cd_estabelecimento

union

select	'3.03.01' ds_versao,
	-- campos utilizados na identificacao da transacao

	coalesce(d.cd_ans, c.cd_ans)cd_ans,
	-- campos que devem ser utilizados como filtros

	(null)::numeric  		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	null			nr_protocolo_receb,
	a.nr_sequencia		nr_seq_lote_anexo,
	null			nr_seq_pedido_Exame_ext,
	null			nr_seq_rec_glosa_prot_cancel,
    null            nr_seq_tiss_env_doc
from	pessoa_juridica c,
	convenio b,
	tiss_anexo_lote a,
    convenio_estabelecimento d
where	a.cd_convenio		= b.cd_convenio
and	b.cd_cgc			= c.cd_cgc
and d.cd_convenio = b.cd_convenio
and d.cd_estabelecimento = a.cd_estabelecimento

union

select	'3.03.02' ds_versao,
	-- campos utilizados na identificacao da transacao

	coalesce(d.cd_ans, c.cd_ans)cd_ans,
	-- campos que devem ser utilizados como filtros

	(null)::numeric  		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	null			nr_protocolo_receb,
	a.nr_sequencia		nr_seq_lote_anexo,
	null			nr_seq_pedido_Exame_ext,
	null			nr_seq_rec_glosa_prot_cancel,
    null            nr_seq_tiss_env_doc
from	pessoa_juridica c,
	convenio b,
	tiss_anexo_lote a,
    convenio_estabelecimento d
where	a.cd_convenio		= b.cd_convenio
and	b.cd_cgc			= c.cd_cgc
and d.cd_convenio = b.cd_convenio
and d.cd_estabelecimento = a.cd_estabelecimento

union

select	'3.03.03' ds_versao,
	-- campos utilizados na identificacao da transacao

	coalesce(d.cd_ans, c.cd_ans)cd_ans,
	-- campos que devem ser utilizados como filtros

	(null)::numeric  		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	null			nr_protocolo_receb,
	a.nr_sequencia		nr_seq_lote_anexo,
	null			nr_seq_pedido_Exame_ext,
	null			nr_seq_rec_glosa_prot_cancel,
    null            nr_seq_tiss_env_doc
from	pessoa_juridica c,
	convenio b,
	tiss_anexo_lote a,
    convenio_estabelecimento d
where	a.cd_convenio		= b.cd_convenio
and	b.cd_cgc			= c.cd_cgc
and d.cd_convenio = b.cd_convenio
and d.cd_estabelecimento = a.cd_estabelecimento

union

select	'3.04.00' ds_versao,
	-- campos utilizados na identificacao da transacao

	coalesce(d.cd_ans, c.cd_ans)cd_ans,
	-- campos que devem ser utilizados como filtros

	(null)::numeric  		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	null			nr_protocolo_receb,
	a.nr_sequencia		nr_seq_lote_anexo,
	null			nr_seq_pedido_Exame_ext,
	null			nr_seq_rec_glosa_prot_cancel,
    null            nr_seq_tiss_env_doc
from	pessoa_juridica c,
	convenio b,
	tiss_anexo_lote a,
    convenio_estabelecimento d
where	a.cd_convenio		= b.cd_convenio
and	b.cd_cgc = c.cd_cgc
and d.cd_convenio = b.cd_convenio
and d.cd_estabelecimento = a.cd_estabelecimento

union

select	'3.03.00' ds_versao,
	-- campos utilizados na identificacao da transacao

	coalesce(d.cd_ans, c.cd_ans)cd_ans,
	-- campos que devem ser utilizados como filtros

	a.nr_sequencia 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	null			nr_protocolo_receb,
	null 			nr_seq_lote_anexo,
	null			nr_seq_pedido_Exame_ext,
	null			nr_seq_rec_glosa_prot_cancel,
    null            nr_seq_tiss_env_doc
from	pessoa_juridica c,
	convenio b,
	autorizacao_convenio a,
	convenio_estabelecimento d
where	a.cd_convenio		= b.cd_convenio
and	b.cd_cgc		= c.cd_cgc
and d.cd_convenio = b.cd_convenio
and d.cd_estabelecimento = a.cd_estabelecimento

union

select	'3.03.01' ds_versao,
	-- campos utilizados na identificacao da transacao

	coalesce(d.cd_ans, c.cd_ans)cd_ans,
	-- campos que devem ser utilizados como filtros

	a.nr_sequencia 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	null			nr_protocolo_receb,
	null 			nr_seq_lote_anexo,
	null			nr_seq_pedido_Exame_ext,
	null			nr_seq_rec_glosa_prot_cancel,
    null            nr_seq_tiss_env_doc
from	pessoa_juridica c,
	convenio b,
	autorizacao_convenio a,
	convenio_estabelecimento d
where	a.cd_convenio		= b.cd_convenio
and	b.cd_cgc		= c.cd_cgc
and d.cd_convenio = b.cd_convenio
and d.cd_estabelecimento = a.cd_estabelecimento

union

select	'3.03.02' ds_versao,
	-- campos utilizados na identificacao da transacao

	coalesce(d.cd_ans, c.cd_ans)cd_ans,
	-- campos que devem ser utilizados como filtros

	a.nr_sequencia 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	null			nr_protocolo_receb,
	null 			nr_seq_lote_anexo,
	null			nr_seq_pedido_Exame_ext,
	null			nr_seq_rec_glosa_prot_cancel,
    null            nr_seq_tiss_env_doc
from	pessoa_juridica c,
	convenio b,
	autorizacao_convenio a,
	convenio_estabelecimento d
where	a.cd_convenio		= b.cd_convenio
and	b.cd_cgc		= c.cd_cgc
and d.cd_convenio = b.cd_convenio
and d.cd_estabelecimento = a.cd_estabelecimento

union

select	'3.03.02' ds_versao,
	coalesce(g.cd_ans, c.cd_ans)cd_ans,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	null			nr_protocolo_receb,
	null 			nr_seq_lote_anexo,
	a.nr_sequencia		nr_seq_pedido_Exame_ext,
	null			nr_seq_rec_glosa_prot_cancel,
    null            nr_seq_tiss_env_doc
from	pessoa_juridica c,
	ATENDIMENTO_PACIENTE b,
	PEDIDO_EXAME_EXTERNO a,
	ATEND_CATEGORIA_CONVENIO D,
	CONVENIO E,
	CONVENIO_ESTABELECIMENTO G
where	d.cd_convenio		= e.cd_convenio
and	e.cd_cgc		= c.cd_cgc
and	b.nr_atendimento	= a.nr_atendimento
and	b.nr_atendimento	= d.nr_atendimento
and	obter_atecaco_atendimento(b.nr_atendimento) 	= d.nr_seq_interno
and g.cd_convenio = e.cd_convenio
and g.cd_estabelecimento = b.cd_estabelecimento

union

select	'3.03.02' ds_versao,
	coalesce(e.cd_ans, f.cd_ans)cd_ans,
	(null)::numeric 		nr_sequencia_autor,
	(null)::numeric 		nr_seq_protocolo,
	(null)::numeric 		nr_seq_med_prot,
	(null)::numeric 		nr_seq_retorno,
	null			nr_protocolo_receb,
	null 			nr_seq_lote_anexo,
	null			nr_seq_pedido_Exame_ext,
	a.nr_sequencia		nr_seq_rec_glosa_prot_cancel,
    null            nr_seq_tiss_env_doc
from	tiss_recurso_glosa_prot a,
	lote_audit_hist b,
	lote_auditoria c,
	convenio d,
	convenio_estabelecimento e,
	pessoa_juridica f
where	a.nr_seq_lote_hist 	= b.nr_sequencia
and	b.nr_seq_lote_audit 	= c.nr_sequencia
and	c.cd_convenio		= e.cd_convenio
and	c.cd_estabelecimento	= e.cd_estabelecimento
and	c.cd_convenio		= d.cd_convenio
and	f.cd_cgc		= d.cd_cgc

union

select	'3.03.02'   ds_versao,
	coalesce(d.cd_ans, c.cd_ans)cd_ans,
	(null)::numeric  nr_sequencia_autor,
	(null)::numeric 	nr_seq_protocolo,
	(null)::numeric 	nr_seq_med_prot,
	(null)::numeric 	nr_seq_retorno,
	null			nr_protocolo_receb,
	null 			nr_seq_lote_anexo,
	null			nr_seq_pedido_Exame_ext,
	null			nr_seq_rec_glosa_prot_cancel,
    f.nr_sequencia  nr_seq_tiss_env_doc
from	pessoa_juridica c,
	convenio b,
	autorizacao_convenio a,
	convenio_estabelecimento d,
    tiss_envio_documento f,
    autorizacao_Convenio_arq g
where   g.nr_sequencia   = f.nr_seq_autor_conv_anexo
and a.nr_sequencia       = g.nr_sequencia_autor 
and a.cd_convenio		 = b.cd_convenio
and	b.cd_cgc		     = c.cd_cgc
and d.cd_convenio        = b.cd_convenio
and d.cd_estabelecimento = a.cd_estabelecimento

union
 
select	'3.03.02'   ds_versao,
	coalesce(d.cd_ans, c.cd_ans)cd_ans,
	(null)::numeric  nr_sequencia_autor,
	(null)::numeric 	nr_seq_protocolo,
	(null)::numeric 	nr_seq_med_prot,
	(null)::numeric 	nr_seq_retorno,
	null			nr_protocolo_receb,
	null 			nr_seq_lote_anexo,
	null			nr_seq_pedido_Exame_ext,
	null			nr_seq_rec_glosa_prot_cancel,
    a.nr_sequencia  nr_seq_tiss_env_doc
from	pessoa_juridica c,
	convenio b,
	convenio_estabelecimento d,
    tiss_envio_documento a,
    protocolo_convenio e,
    protocolo_conv_anexo f
where f.nr_sequencia     = a.nr_seq_protoc_conv_anexo
and e.nr_seq_protocolo   = f.nr_seq_protocolo
and e.cd_convenio	     = b.cd_convenio
and	b.cd_cgc		     = c.cd_cgc
and	d.cd_convenio 		 = b.cd_convenio
and	d.cd_estabelecimento = e.cd_estabelecimento;

