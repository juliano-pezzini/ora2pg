-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_itens_faturados_v (cd_usuario_plano, cd_guia, ds_prestador_prot, ds_prestador_pgto, qt_item, nm_tabela, dt_proc_mat, vl_calculado, nr_identificador, cd_proc_mat, ds_proc_mat, dt_mes_competencia, nr_seq_prestador, nr_seq_prestador_exec, nr_seq_regra, cd_procedimento, ie_origem_proced, cd_material, ie_servico, nr_seq_material) AS select	n.cd_usuario_plano,
	d.cd_guia, 
	substr(pls_obter_cod_prestador(i.nr_seq_prestador,null),1,255) || ' - ' || substr(pls_obter_dados_prestador(i.nr_seq_prestador,'N'),1,255) ds_prestador_prot, 
	substr(pls_obter_dados_prestador(d.nr_seq_prestador_exec,'CD'),1,255) || ' - ' || substr(pls_obter_dados_prestador(d.nr_seq_prestador_exec,'N'),1,255) ds_prestador_pgto, 
	coalesce(e.qt_item,1) qt_item, 
	substr(pls_obter_tab_preco_proc_mat(f.nr_sequencia, null), 1, 255) nm_tabela, 
	f.dt_procedimento dt_proc_mat, 
	coalesce(e.vl_materiais,0) + coalesce(e.vl_medico,0) + coalesce(e.vl_custo_operacional,0) vl_calculado, 
	f.nr_id_analise nr_identificador, 
	f.cd_procedimento cd_proc_mat, 
	substr(pls_obter_desc_procedimento(f.cd_procedimento,f.ie_origem_proced),1,255) ds_proc_mat, 
	i.dt_mes_competencia, 
	i.nr_seq_prestador, 
	d.nr_seq_prestador_exec, 
	f.nr_seq_regra, 
	f.cd_procedimento, 
	f.ie_origem_proced, 
	null cd_material, 
	'P' ie_servico, 
	null nr_seq_material 
FROM pls_lote_faturamento x, pls_segurado_carteira n, pls_contrato_pagador m, pls_tipo_atendimento l, pls_segurado k, pls_intercambio j, pls_protocolo_conta i, pls_conta_pos_estabelecido e, pls_fatura_conta c, pls_fatura_evento b, pls_fatura a, pls_conta_proc f
LEFT OUTER JOIN pls_diagnostico_conta g ON (f.nr_sequencia = g.nr_seq_conta)
, pls_conta d
LEFT OUTER JOIN pls_prestador h ON (d.nr_seq_prestador_exec = h.nr_sequencia)
WHERE x.nr_sequencia			= a.nr_seq_lote and a.nr_sequencia 			= b.nr_seq_fatura and b.nr_sequencia 			= c.nr_seq_fatura_evento and d.nr_sequencia 			= c.nr_seq_conta and d.nr_sequencia 			= e.nr_seq_conta and f.nr_sequencia 			= e.nr_seq_conta_proc and a.nr_seq_lote 			= e.nr_seq_lote_fat   and i.nr_sequencia 			= d.nr_seq_protocolo and l.nr_sequencia 			= d.nr_seq_tipo_atendimento and j.nr_sequencia			= k.nr_seq_intercambio and m.nr_sequencia			= a.nr_seq_pagador and k.nr_sequencia 			= c.nr_seq_segurado and k.nr_sequencia			= n.nr_seq_segurado 
 
union all
 
select	n.cd_usuario_plano, 
	d.cd_guia, 
	substr(pls_obter_cod_prestador(i.nr_seq_prestador,null),1,255) || ' - ' || substr(pls_obter_dados_prestador(i.nr_seq_prestador,'N'),1,255) ds_prestador_prot, 
	substr(pls_obter_dados_prestador(d.nr_seq_prestador_exec,'CD'),1,255) || ' - ' || substr(pls_obter_dados_prestador(d.nr_seq_prestador_exec,'N'),1,255) ds_prestador_pgto, 
	coalesce(e.qt_item,1) qt_item, 
	substr(pls_obter_tab_preco_proc_mat(null, f.nr_sequencia), 1, 255)nm_tabela, 
	f.dt_liberacao dt_proc_mat, 
	coalesce(e.vl_materiais,0) + coalesce(e.vl_medico,0) + coalesce(e.vl_custo_operacional,0) vl_calculado, 
	f.nr_id_analise nr_identificador, 
	(substr(pls_obter_seq_codigo_material(f.nr_seq_material,null),1,15))::numeric  cd_proc_mat, 
	substr(pls_obter_dados_material(f.nr_seq_material,'DS'),1,255) ds_proc_mat, 
	i.dt_mes_competencia, 
	i.nr_seq_prestador, 
	d.nr_seq_prestador_exec, 
	f.nr_seq_regra, 
	null cd_procedimento, 
	null ie_origem_proced, 
	u.cd_material_ops cd_material, 
	'M' ie_servico, 
	u.nr_sequencia nr_seq_material 
FROM pls_lote_faturamento x, pls_material u, pls_segurado_carteira n, pls_contrato_pagador m, pls_tipo_atendimento l, pls_segurado k, pls_intercambio j, pls_protocolo_conta i, pls_conta_pos_estabelecido e, pls_fatura_conta c, pls_fatura_evento b, pls_fatura a, pls_conta_mat f
LEFT OUTER JOIN pls_diagnostico_conta g ON (f.nr_sequencia = g.nr_seq_conta)
, pls_conta d
LEFT OUTER JOIN pls_prestador h ON (d.nr_seq_prestador_exec = h.nr_sequencia)
WHERE x.nr_sequencia			= a.nr_seq_lote and a.nr_sequencia 			= b.nr_seq_fatura and b.nr_sequencia 			= c.nr_seq_fatura_evento and d.nr_sequencia 			= c.nr_seq_conta and d.nr_sequencia 			= e.nr_seq_conta and f.nr_sequencia 			= e.nr_seq_conta_mat and a.nr_seq_lote 			= e.nr_seq_lote_fat   and u.nr_sequencia			= f.nr_seq_material and i.nr_sequencia 			= d.nr_seq_protocolo and l.nr_sequencia 			= d.nr_seq_tipo_atendimento and j.nr_sequencia			= k.nr_seq_intercambio and m.nr_sequencia			= a.nr_seq_pagador and k.nr_sequencia 			= c.nr_seq_segurado and k.nr_sequencia			= n.nr_seq_segurado;

