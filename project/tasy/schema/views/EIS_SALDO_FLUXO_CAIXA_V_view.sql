-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_saldo_fluxo_caixa_v (cd_empresa, cd_estabelecimento, dt_referencia, vl_saldo, vl_meta, pr_meta) AS select b.cd_empresa,
	d.cd_estabelecimento,
	a.dt_referencia,
	sum(a.vl_fluxo) vl_saldo,
	sum(d.vl_meta) vl_meta,
	(dividir_sem_round(sum(d.vl_meta), sum(a.vl_fluxo)) * 100) pr_meta
FROM	eis_meta_fluxo_caixa d,
	parametro_fluxo_caixa c,
	conta_financeira b,
	fluxo_caixa a
where	a.cd_conta_financ		= b.cd_conta_financ
and	a.cd_conta_financ		= c.cd_conta_financ_saldo
and	a.cd_estabelecimento		= c.cd_estabelecimento
and	a.ie_periodo			= 'D'
and	a.ie_classif_fluxo		= 'P'
and	trunc(a.dt_referencia,'dd')	< trunc(LOCALTIMESTAMP, 'dd')
and	trunc(d.dt_referencia, 'dd') = trunc(a.dt_referencia, 'dd')
group by
	b.cd_empresa,
	d.cd_estabelecimento,
	a.dt_referencia

union

select b.cd_empresa,
	d.cd_estabelecimento,
	a.dt_referencia,
	sum(a.vl_fluxo) vl_saldo,
	sum(d.vl_meta) vl_meta,
	(dividir_sem_round(sum(d.vl_meta), sum(a.vl_fluxo)) * 100) pr_meta
from	eis_meta_fluxo_caixa d,
	parametro_fluxo_caixa c,
	conta_financeira b,
	fluxo_caixa a
where	a.cd_conta_financ		= b.cd_conta_financ
and	a.cd_conta_financ		= c.cd_conta_financ_saldo
and	a.cd_estabelecimento		= c.cd_estabelecimento
and	a.ie_periodo			= 'D'
and	a.ie_classif_fluxo		= 'R'
and	trunc(a.dt_referencia, 'dd') >= trunc(LOCALTIMESTAMP, 'dd')
and	trunc(d.dt_referencia, 'dd') = trunc(a.dt_referencia, 'dd')
group by
	b.cd_empresa,
	d.cd_estabelecimento,
	a.dt_referencia;

