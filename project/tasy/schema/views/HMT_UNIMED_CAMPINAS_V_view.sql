-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW hmt_unimed_campinas_v (cd_executante, cd_convenio, tp_local, nr_atendimento, nr_interno_conta, ie_emite_conta, cd_responsavel) AS Select substr(Obter_Valor_Conv_Estab(b.cd_convenio_parametro,b.cd_estabelecimento,'CD_REGIONAL'),1,15) cd_executante,		
	b.cd_convenio_parametro cd_convenio, 
	'21' tp_local, 
	a.nr_atendimento, 
	b.nr_interno_conta, 
	'97' ie_emite_conta, 
	CASE WHEN obter_se_medico_credenciado(b.cd_estabelecimento, a.cd_medico_resp, b.cd_convenio_parametro, null, null,null,null,null,null, a.ie_tipo_atendimento, null, null)='N' THEN  		substr(Obter_Valor_Conv_Estab(b.cd_convenio_parametro,b.cd_estabelecimento,'CD_REGIONAL'),1,15)  ELSE substr(obter_medico_convenio(b.cd_estabelecimento,a.cd_medico_resp,b.cd_convenio_parametro, null, null, null, null, 		a.dt_entrada, a.ie_tipo_atendimento, null, null),1,15) END  cd_responsavel 
FROM 	atendimento_paciente a, 
	conta_paciente b 
where 	a.nr_atendimento = b.nr_atendimento;

