-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW conta_paciente_estrutura_v (nr_atendimento, dt_acerto_conta, ie_status_acerto, dt_periodo_inicial, dt_periodo_final, dt_atualizacao, nm_usuario, cd_convenio_parametro, nr_protocolo, dt_mesano_referencia, dt_mesano_contabil, cd_convenio_calculo, cd_categoria_calculo, nr_interno_conta, nr_seq_protocolo, cd_categoria_parametro, ds_inconsistencia, dt_recalculo, cd_estabelecimento, ie_cancelamento, nr_lote_contabil, nr_seq_apresent, ie_complexidade, ie_tipo_guia, cd_autorizacao, vl_conta, vl_desconto, nr_seq_conta_origem, ie_tipo_nascimento, dt_cancelamento, cd_proc_princ, nr_conta_convenio, dt_conta_definitiva, dt_conta_protocolo, nr_seq_conta_prot, nr_seq_pq_protocolo, ds_observacao, ie_tipo_atend_tiss, nr_seq_saida_consulta, nr_seq_saida_int, nr_seq_saida_spsadt, dt_geracao_tiss, nr_lote_repasse, ie_reapresentacao_sus, nr_seq_ret_glosa, dt_prev_protocolo, nr_conta_pacote_exced, dt_alta_tiss, dt_entrada_tiss, ie_tipo_fatur_tiss, ie_tipo_consulta_tiss, cd_especialidade_conta, cd_plano_retorno_conv, ie_tipo_atend_conta, qt_dias_conta, cd_responsavel, nr_seq_estagio_conta, nm_usuario_original, nr_seq_audit_hist_glosa, vl_repasse_conta, nr_fechamento, nr_seq_tipo_fatura, nr_seq_apresentacao, nr_seq_motivo_cancel, dt_conferencia_sus, cd_medico_conta, qt_dias_periodo, dt_geracao_resumo, vl_conta_relat, ie_faec, nr_seq_apresent_sus, nr_seq_status_fat, nr_seq_status_mob, nr_seq_regra_fluxo, dt_atual_conta_conv, nr_conta_orig_desdob, pr_coseguro_hosp, pr_coseguro_honor, vl_deduzido, vl_base_conta, dt_definicao_conta, nr_seq_ordem, ie_complex_aih_orig, vl_coseguro_honor, nr_seq_tipo_cobranca, vl_coseguro_hosp, nr_nota_fiscal, nr_nota_cab, nr_adiantamento, vl_adiantamento, vl_adiant_sem_titulo, nr_seq_conta_atend, nr_seq_parcial_adm, vl_total_conta, nm_responsavel, nm_medico_conta, ds_tipo_saida_tiss, ds_tipo_saida_int_tiss, ds_estagio_conta, nm_resp_atend, ds_tipo_atend_tiss, ds_tipo_fatur_tiss) AS select	a.NR_ATENDIMENTO,a.DT_ACERTO_CONTA,a.IE_STATUS_ACERTO,a.DT_PERIODO_INICIAL,a.DT_PERIODO_FINAL,a.DT_ATUALIZACAO,a.NM_USUARIO,a.CD_CONVENIO_PARAMETRO,a.NR_PROTOCOLO,a.DT_MESANO_REFERENCIA,a.DT_MESANO_CONTABIL,a.CD_CONVENIO_CALCULO,a.CD_CATEGORIA_CALCULO,a.NR_INTERNO_CONTA,a.NR_SEQ_PROTOCOLO,a.CD_CATEGORIA_PARAMETRO,a.DS_INCONSISTENCIA,a.DT_RECALCULO,a.CD_ESTABELECIMENTO,a.IE_CANCELAMENTO,a.NR_LOTE_CONTABIL,a.NR_SEQ_APRESENT,a.IE_COMPLEXIDADE,a.IE_TIPO_GUIA,a.CD_AUTORIZACAO,a.VL_CONTA,a.VL_DESCONTO,a.NR_SEQ_CONTA_ORIGEM,a.IE_TIPO_NASCIMENTO,a.DT_CANCELAMENTO,a.CD_PROC_PRINC,a.NR_CONTA_CONVENIO,a.DT_CONTA_DEFINITIVA,a.DT_CONTA_PROTOCOLO,a.NR_SEQ_CONTA_PROT,a.NR_SEQ_PQ_PROTOCOLO,a.DS_OBSERVACAO,a.IE_TIPO_ATEND_TISS,a.NR_SEQ_SAIDA_CONSULTA,a.NR_SEQ_SAIDA_INT,a.NR_SEQ_SAIDA_SPSADT,a.DT_GERACAO_TISS,a.NR_LOTE_REPASSE,a.IE_REAPRESENTACAO_SUS,a.NR_SEQ_RET_GLOSA,a.DT_PREV_PROTOCOLO,a.NR_CONTA_PACOTE_EXCED,a.DT_ALTA_TISS,a.DT_ENTRADA_TISS,a.IE_TIPO_FATUR_TISS,a.IE_TIPO_CONSULTA_TISS,a.CD_ESPECIALIDADE_CONTA,a.CD_PLANO_RETORNO_CONV,a.IE_TIPO_ATEND_CONTA,a.QT_DIAS_CONTA,a.CD_RESPONSAVEL,a.NR_SEQ_ESTAGIO_CONTA,a.NM_USUARIO_ORIGINAL,a.NR_SEQ_AUDIT_HIST_GLOSA,a.VL_REPASSE_CONTA,a.NR_FECHAMENTO,a.NR_SEQ_TIPO_FATURA,a.NR_SEQ_APRESENTACAO,a.NR_SEQ_MOTIVO_CANCEL,a.DT_CONFERENCIA_SUS,a.CD_MEDICO_CONTA,a.QT_DIAS_PERIODO,a.DT_GERACAO_RESUMO,a.VL_CONTA_RELAT,a.IE_FAEC,a.NR_SEQ_APRESENT_SUS,a.NR_SEQ_STATUS_FAT,a.NR_SEQ_STATUS_MOB,a.NR_SEQ_REGRA_FLUXO,a.DT_ATUAL_CONTA_CONV,a.NR_CONTA_ORIG_DESDOB,a.PR_COSEGURO_HOSP,a.PR_COSEGURO_HONOR,a.VL_DEDUZIDO,a.VL_BASE_CONTA,a.DT_DEFINICAO_CONTA,a.NR_SEQ_ORDEM,a.IE_COMPLEX_AIH_ORIG,a.VL_COSEGURO_HONOR,a.NR_SEQ_TIPO_COBRANCA,a.VL_COSEGURO_HOSP,
	substr(obter_nf_conta(a.nr_interno_conta, 2),1,50) nr_nota_fiscal, 
	substr(obter_nf_conta(a.nr_interno_conta, 2),1,50) nr_nota_cab, 
	substr(obter_adiant_conta(a.nr_interno_conta),1,200) nr_adiantamento, 
	obter_vl_adiant_conta(a.nr_interno_conta, '') vl_adiantamento, 
	obter_vl_adiant_conta(a.nr_interno_conta, 'N') vl_adiant_sem_titulo, 
	obter_seq_conta_atend(a.nr_atendimento,a.nr_interno_conta) nr_seq_conta_atend, 
	obter_seq_parcial_adm(a.nr_atendimento) nr_seq_parcial_adm, 
	obter_valor_conta(a.nr_interno_conta,0) vl_total_conta, 
	substr(obter_nome_pf(a.cd_responsavel),1,200) nm_responsavel, 
	substr(obter_nome_pf(a.cd_medico_conta),1,200) nm_medico_conta, 
	substr(tiss_obter_desc_tipo_saida(a.nr_seq_saida_int),1,255) ds_tipo_saida_tiss, 
	substr(tiss_obter_desc_tipo_saida(a.nr_seq_saida_int),1,255) ds_tipo_saida_int_tiss, 
	substr(obter_estagio_conta_pac(a.nr_interno_conta,'D'),1,255) ds_estagio_conta, 
	substr(obter_resp_atend_paciente(a.nr_atendimento),1,100) nm_resp_atend, 
	substr(obter_valor_dominio(1761,a.ie_tipo_atend_tiss),1,255) ds_tipo_atend_tiss, 
	CASE WHEN a.ie_tipo_fatur_tiss='T' THEN  'Total' WHEN a.ie_tipo_fatur_tiss='P' THEN  'Parcial'  ELSE 'NÃ£o informado' END  ds_tipo_fatur_tiss 
FROM	conta_paciente a;

