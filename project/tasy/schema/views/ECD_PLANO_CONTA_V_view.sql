-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ecd_plano_conta_v (tp_registro, ds_identificador, cd_conta_contabil, cd_aglutinacao, ds_conta_contabil, ie_situacao, ie_centro_custo, ie_tipo_ecd, cd_classificacao, cd_grupo_ecd, cd_empresa, cd_centro_custo, cd_sistema_contabil, dt_inicio_vigencia, dt_fim_vigencia, cd_classif_superior, cd_classif_ecd, nr_nivel, dt_atualizacao, dt_inicio_validade, dt_fim_validade, cd_versao) AS select	1			tp_registro,
	'|I050'			ds_identificador,
	a.cd_conta_contabil	cd_conta_contabil,
	a.cd_conta_contabil	cd_aglutinacao,
	a.ds_conta_contabil	ds_conta_contabil,
	a.ie_situacao		ie_situacao,
	a.ie_centro_custo		ie_centro_custo,
	substr(CASE WHEN a.ie_tipo='T' THEN 'S'  ELSE 'A' END ,1,1) ie_tipo_ecd,
	a.cd_classificacao		cd_classificacao,
	substr(lpad(coalesce(a.ie_natureza_sped,CASE WHEN b.ie_tipo='A' THEN 1 WHEN b.ie_tipo='P' THEN 2 WHEN b.ie_tipo='R' THEN 4 WHEN b.ie_tipo='C' THEN 4 WHEN b.ie_tipo='D' THEN 4  ELSE 9 END ),2,0),1,2) cd_grupo_ecd,
	a.cd_empresa		cd_empresa,
	a.cd_centro_custo		cd_centro_custo,
	a.cd_sistema_contabil	cd_sistema_contabil,
	a.dt_inicio_vigencia		dt_inicio_vigencia,
	a.dt_fim_vigencia		dt_fim_vigencia,
	a.cd_classif_superior	cd_classif_superior,
	a.cd_classif_ecd	cd_classif_ecd,
	ctb_obter_nivel_classif_conta(a.cd_classificacao) nr_nivel,
	a.dt_atualizacao,
	null dt_inicio_validade,
	null dt_fim_validade,
	null cd_versao
FROM	ctb_grupo_conta b,
	conta_contabil a
where	a.cd_grupo		= b.cd_grupo
and	a.cd_empresa		= b.cd_empresa

union all

select	2			tp_registro,
	'|I051'			ds_identificador,
	a.cd_conta_contabil	cd_conta_contabil,
	a.cd_conta_contabil	cd_aglutinacao,
	a.ds_conta_contabil	ds_conta_contabil,
	a.ie_situacao		ie_situacao,
	a.ie_centro_custo		ie_centro_custo,
	substr(CASE WHEN a.ie_tipo='T' THEN 'S'  ELSE 'A' END ,1,1) ie_tipo_ecd,
	a.cd_classificacao		cd_classificacao,
	substr(lpad(CASE WHEN b.ie_tipo='A' THEN 1 WHEN b.ie_tipo='P' THEN 2 WHEN b.ie_tipo='R' THEN 4 WHEN b.ie_tipo='C' THEN 4 WHEN b.ie_tipo='D' THEN 4  ELSE 9 END ,2,0),1,2) cd_grupo_ecd,
	a.cd_empresa		cd_empresa,
	c.cd_centro_custo		cd_centro_custo,
	a.cd_sistema_contabil	cd_sistema_contabil,
	a.dt_inicio_vigencia		dt_inicio_vigencia,
	a.dt_fim_vigencia		dt_fim_vigencia,
	a.cd_classif_superior	cd_classif_superior,
	c.cd_classif_ecd		cd_classif_ecd,
	ctb_obter_nivel_classif_conta(a.cd_classificacao) nr_nivel,
	a.dt_atualizacao,
	c.dt_inicio_vigencia dt_inicio_validade,
	c.dt_fim_vigencia dt_fim_validade,
	c.cd_versao
from	conta_contabil_classif_ecd c,
	ctb_grupo_conta b,
	conta_contabil a
where	a.cd_grupo	= b.cd_grupo
and	a.cd_empresa	= b.cd_empresa
and	a.cd_conta_contabil	= c.cd_conta_contabil
and	a.ie_tipo	= 'A'
and	c.cd_classif_ecd is not null

union all

select	3			tp_registro,
	'|I052'			ds_identificador,
	a.cd_conta_contabil	cd_conta_contabil,
	a.cd_conta_contabil	cd_aglutinacao,
	a.ds_conta_contabil	ds_conta_contabil,
	a.ie_situacao		ie_situacao,
	a.ie_centro_custo		ie_centro_custo,
	substr(CASE WHEN a.ie_tipo='T' THEN 'S'  ELSE 'A' END ,1,1) ie_tipo_ecd,
	a.cd_classificacao		cd_classificacao,
	substr(lpad(CASE WHEN b.ie_tipo='A' THEN 1 WHEN b.ie_tipo='P' THEN 2 WHEN b.ie_tipo='R' THEN 4 WHEN b.ie_tipo='C' THEN 4 WHEN b.ie_tipo='D' THEN 4  ELSE 9 END ,2,0),1,2) cd_grupo_ecd,
	a.cd_empresa		cd_empresa,
	a.cd_centro_custo		cd_centro_custo,
	a.cd_sistema_contabil	cd_sistema_contabil,
	a.dt_inicio_vigencia		dt_inicio_vigencia,
	a.dt_fim_vigencia		dt_fim_vigencia,
	a.cd_classif_superior	cd_classif_superior,
	a.cd_classif_ecd		cd_classif_ecd,
	ctb_obter_nivel_classif_conta(a.cd_classificacao) nr_nivel,
	a.dt_atualizacao,
	null dt_inicio_validade,
	null dt_fim_validade,
	null cd_versao
from	ctb_grupo_conta b,
	conta_contabil a
where	a.cd_grupo		= b.cd_grupo
and	a.cd_empresa		= b.cd_empresa
and	a.ie_tipo		= 'A'
order by cd_classificacao, tp_registro;

