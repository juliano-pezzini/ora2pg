-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW grafico_pepo_html_v (ie_union, name, comercial_name, ie_medic_nao_inform, description, max_scale, min_scale, color, code_group, style, shape, qt_size, fill_color, point_shape, fill_position, shaded, fixed_scale, init_date, end_date, code_chart, seq_apresentacao, nr_cirurgia, nr_seq_pepo, nm_usuario, nm_tabela, nm_atributo, ie_sinal_vital, nr_seq_superior, end_of_administration, cd_material, cd_unid_medida_adm, ie_modo_adm, nr_seq_agente, ds_dosagem) AS select	distinct /* Necessary because of Blood pressure fields that will repeat the same vital sign */
		1 ie_union,
		--b.ds_sinal_vital name,
		obter_desc_expressao(e.cd_exp_grafico,null) name,
		null comercial_name,
		null ie_medic_nao_inform,
		--g.ds_unid_med_sv description,
		(select max(ds_unid_med_sv) FROM pepo_sv r where r.ie_sinal_vital = c.ie_sinal_vital) description,
		null max_scale,
		null  min_scale,
		coalesce(e.ds_cor_grafico_html,'#E5BAFF') color,
		'SV' code_group,
		coalesce(e.ie_estilo_grafico_html,'points') style,
		e.ie_desenho_grafico shape,
		e.qt_tamanho_grafico qt_size,
		CASE WHEN e.ie_transparente='S' THEN 'transparent'  ELSE coalesce(e.ds_cor_grafico_html,'#E5BAFF') END  fill_color, /* White */
		null point_shape,
		null fill_position,
		null shaded,
		null fixed_scale,
		obter_data_grafico_pepo('I',d.nr_cirurgia) init_date,
		obter_data_grafico_pepo('F',d.nr_cirurgia) end_date,
		d.nr_sequencia CODE_CHART,
		d.nr_seq_apresentacao seq_apresentacao,
		d.nr_cirurgia nr_cirurgia,
		d.nr_seq_pepo nr_seq_pepo,
		d.nm_usuario nm_usuario,
		null nm_tabela,
		--decode(g.nm_atributo,'QT_PA_SISTOLICA','QT_PA_UNICO','QT_PA_DIASTOLICA','QT_PA_UNICO','QT_PAM','QT_PA_UNICO',g.nm_atributo) nm_atributo, /* Blood pressure will have a single representation */
		null nm_atributo,
		c.ie_sinal_vital,
		null nr_seq_superior,
		null end_of_administration,
		null cd_material,
		null cd_unid_medida_adm,
		null ie_modo_adm,
		null nr_seq_agente,
		null ds_dosagem
from	pepo_config_chart_html e,
		pepo_item_grafico d,
		pepo_sinal_vital c
where	c.ie_sinal_vital		= e.ie_sinal_vital
and		d.nr_seq_sinal_vital 	= c.nr_sequencia
and		d.ie_grafico			= 'S'
and		coalesce(c.ie_situacao,'A') 	= 'A'
and		c.ie_sinal_vital NOT IN ('QTSEGMENTOST','QTFREQVENT','QTVCI','QTPIP','QTFIO2','QTNITROSO','QTOXIGINS')

union all

/* Anesthesic Agents - Medications - Hidroeletric Teraphy  */

select 	distinct
		2 ie_union,
		c.ds_agente name,
		obter_desc_material(cd_material) comercial_name,
		c.ie_medic_nao_inform,
		get_type_chart_surgery(d.nr_sequencia,b.nr_sequencia,'') description,
		null max_scale,
		null  min_scale,
		'#008C23' color,
		'AG' code_group,
		get_type_chart_surgery(d.nr_sequencia,b.nr_sequencia,'style') style,
		'circle' shape,
		(get_type_chart_surgery(d.nr_sequencia,b.nr_sequencia,'qt_size'))::numeric  qt_size,
		'#008C23' fill_color,
		null point_shape,
        null fill_position,
		'true' shaded,
		0 fixed_scale,
		obter_data_grafico_pepo('I',a.nr_cirurgia) init_date,
	    obter_data_grafico_pepo('F',a.nr_cirurgia) end_date,
		a.nr_sequencia CODE_CHART,
	    a.nr_seq_apresentacao seq_apresentacao,
		a.nr_cirurgia nr_cirurgia,
	    a.nr_seq_pepo nr_seq_pepo,
		a.nm_usuario nm_usuario,
		'CIRURGIA_AGENTE_ANESTESICO' nm_tabela,
		--'DS_AGENTE' || '_' || get_type_chart_surgery_agent(d.qt_dose,d.qt_dose_ataque,d.qt_halog_ins,d.qt_velocidade_inf,d.ie_aplic_bolus) nm_atributo,
		'DS_AGENTE' || '_' || get_type_chart_surgery(d.nr_sequencia,b.nr_sequencia,'style') nm_atributo,
		null ie_sinal_vital,
		b.nr_sequencia nr_seq_superior,
		obter_se_fim_administracao(b.nr_sequencia) end_of_administration,
		b.cd_material,
		b.cd_unid_medida_adm,
		obter_modo_medicamento_cirur(b.nr_sequencia) ie_modo_adm,
		c.nr_sequencia nr_seq_agente,
		b.ie_tipo_dosagem ds_dosagem
FROM agente_anestesico c, pepo_item_grafico a, cirurgia_agente_anestesico b
LEFT OUTER JOIN cirurgia_agente_anest_ocor d ON (b.nr_sequencia = d.nr_seq_cirur_agente)
WHERE a.nr_seq_cirur_agente = b.nr_sequencia and b.nr_seq_agente = c.nr_sequencia  and b.ie_tipo in (1,2,3) and a.ie_grafico = 'S' and coalesce(b.ie_situacao,'A') = 'A' and coalesce(d.ie_situacao,'A') = 'A' --and	1 = 2
union all

/* Blood components */

select 	distinct
		3 ie_union,
		c.ds_derivado name,
		null comercial_name,
		null ie_medic_nao_inform,
		substr(obter_volume_hemocomponente(NR_SEQ_DERIVADO,'D'),1,50) description,
		null max_scale,
		null  min_scale,
		'#A81923' color,
		'SH' code_group,
		'line' style,
		null shape,
		2 qt_size,
		'#FFF' fill_color, /* White */
		null point_shape,
        null fill_position,
		'true' shaded,
		0 fixed_scale,
		obter_data_grafico_pepo('I',a.nr_cirurgia) init_date,
	    obter_data_grafico_pepo('F',a.nr_cirurgia) end_date,
		a.nr_sequencia CODE_CHART,
		a.nr_seq_apresentacao seq_apresentacao,
		b.nr_cirurgia nr_cirurgia,
	    b.nr_seq_pepo nr_seq_pepo,
		a.nm_usuario nm_usuario,
		'CIRURGIA_AGENTE_ANESTESICO' nm_tabela,
		'DS_AGENTE_HEMO' nm_atributo,
		null ie_sinal_vital,
		b.nr_sequencia nr_seq_superior,
		obter_se_fim_administracao(b.nr_sequencia) end_of_administration,
		b.cd_material,
		b.cd_unid_medida_adm,
		'H' ie_modo_adm,
		null nr_seq_agente,
		null ds_dosagem
FROM pepo_item_grafico a, san_derivado c
LEFT OUTER JOIN cirurgia_agente_anestesico b ON (c.nr_sequencia = b.nr_seq_derivado)
WHERE a.nr_seq_cirur_agente = b.nr_sequencia  and coalesce(b.ie_situacao,'A') = 'A' and a.ie_grafico = 'S'
 
union all

/* Hidro balance - Wins and losses */

select 	distinct
		4 ie_union,
		c.ds_tipo name,
		null comercial_name,
		null ie_medic_nao_inform,
		'ml' description,
		null max_scale,
		null  min_scale,
		'#3064FF' color,
		'BH' code_group,
		'points' style,
		null shape,
		10 qt_size,
		CASE WHEN obter_tipo_perda_ganho(b.nr_seq_tipo,'C')='G' THEN '#3064FF' WHEN obter_tipo_perda_ganho(b.nr_seq_tipo,'C')='P' THEN 'transparent' END  fill_color, /* White */
		null point_shape,
        null fill_position,
		'true' shaded,
		0 fixed_scale,
		obter_data_grafico_pepo('I',a.nr_cirurgia) init_date,
	    obter_data_grafico_pepo('F',a.nr_cirurgia) end_date,
		a.nr_sequencia CODE_CHART,
		coalesce(a.nr_seq_apresentacao,0) seq_apresentacao,
		b.nr_cirurgia nr_cirurgia,
	    b.nr_seq_pepo nr_seq_pepo,
		a.nm_usuario nm_usuario,
		'ATENDIMENTO_PERDA_GANHO' nm_tabela,
		'DS_TIPO' nm_atributo,
		null ie_sinal_vital,
		b.nr_seq_tipo nr_seq_superior,
		null end_of_administration,
		null cd_material,
		null cd_unid_medida_adm,
		null ie_modo_adm,
		null nr_seq_agente,
		null ds_dosagem
FROM tipo_perda_ganho c, atendimento_perda_ganho b
LEFT OUTER JOIN pepo_item_grafico a ON (b.nr_sequencia = a.nr_seq_atend_pg)
WHERE b.nr_seq_tipo = c.nr_sequencia  and c.ie_exibir_grafico = 'S' and coalesce(b.ie_situacao,'A') = 'A' and coalesce(a.ie_grafico,'S') = 'S'
 
union all

/* Hidro balance - Hidro balance */

select 	distinct
		5 ie_union,
		obter_desc_expressao(284223,null) name,
		null comercial_name,
		null ie_medic_nao_inform,
		'ml' description,
		null max_scale,
		null  min_scale,
		'#3064FF' color,
		'BH' code_group,
		'line' style,
		null shape,
		3 qt_size,
		null fill_color, /* White */
		null point_shape,
        null fill_position,
		'true' shaded,
		0 fixed_scale,
		obter_data_grafico_pepo('I',a.nr_cirurgia) init_date,
	    obter_data_grafico_pepo('F',a.nr_cirurgia) end_date,
		a.nr_sequencia CODE_CHART,
		coalesce(a.nr_seq_apresentacao,999) seq_apresentacao,
		b.nr_cirurgia nr_cirurgia,
	    b.nr_seq_pepo nr_seq_pepo,
		a.nm_usuario nm_usuario,
		'ATENDIMENTO_PERDA_GANHO' nm_tabela,
		'BALANCO' nm_atributo,
		null ie_sinal_vital,
		null nr_seq_superior,
		null end_of_administration,
		null cd_material,
		null cd_unid_medida_adm,
		null ie_modo_adm,
		null nr_seq_agente,
		null ds_dosagem
FROM tipo_perda_ganho c, atendimento_perda_ganho b
LEFT OUTER JOIN pepo_item_grafico a ON (b.nr_sequencia = a.nr_seq_atend_pg)
WHERE b.nr_seq_tipo = c.nr_sequencia  and c.ie_exibir_grafico = 'S' and coalesce(b.ie_situacao,'A') = 'A' and coalesce(a.ie_grafico,'S') = 'S' /* Events graph - Patient */

 
union all

select 	91 ie_union,
		obter_desc_expressao(295156,null) name,
		null comercial_name,
		null ie_medic_nao_inform,
		obter_desc_expressao(295156,null) description,
		null max_scale,
		null  min_scale,
		'#8EC200' color,
		'NAV' code_group,
		'line' style,
		null shape,
		null qt_size,
		'#FFF' fill_color, /* White */
		null point_shape,
        null fill_position,
		null shaded,
		10 fixed_scale,
		obter_data_etapa_evento(nr_cirurgia,nr_seq_pepo,1) init_date,
	   obter_data_etapa_evento(nr_cirurgia,nr_seq_pepo,6) end_date,
		-1 CODE_CHART,
		1 seq_apresentacao,
		a.nr_cirurgia nr_cirurgia,
	   a.nr_seq_pepo nr_seq_pepo,
		null nm_usuario,
		'EVENTO_CIRURGIA_PACIENTE' nm_tabela,
		'DS_PACIENTE' nm_atributo,
		null ie_sinal_vital,
		null nr_seq_superior,
		null end_of_administration,
		null cd_material,
		null cd_unid_medida_adm,
		null ie_modo_adm,
		null nr_seq_agente,
		null ds_dosagem
from	cirurgia a
--where	1 = 2
/* Events graph - Anesthesia */

union all

select 	92 ie_union,
		obter_desc_expressao(283468,null) name,
		null comercial_name,
		null ie_medic_nao_inform,
		obter_desc_expressao(283468,null) description,
		null max_scale,
		null  min_scale,
		'#FACD52' color,
		'NAV' code_group,
		'line' style,
		null shape,
		null qt_size,
		'#FFF' fill_color, /* White */
		null point_shape,
        null fill_position,
		null shaded,
		10 fixed_scale,
		obter_data_etapa_evento(nr_cirurgia,nr_seq_pepo,2) init_date,
	   obter_data_etapa_evento(nr_cirurgia,nr_seq_pepo,5) end_date,
		-2 CODE_CHART,
		2 seq_apresentacao,
		a.nr_cirurgia nr_cirurgia,
	    a.nr_seq_pepo nr_seq_pepo,
		null nm_usuario,
		'EVENTO_CIRURGIA_PACIENTE' nm_tabela,
		'DS_ANESTESIA' nm_atributo,
		null ie_sinal_vital,
		null nr_seq_superior,
		null end_of_administration,
		null cd_material,
		null cd_unid_medida_adm,
		null ie_modo_adm,
		null nr_seq_agente,
		null ds_dosagem
from	cirurgia a
--where	1 = 2
union all

/* Events graph - Procedure */

select 	93 ie_union,
		obter_desc_expressao(720319,null) name,
		null comercial_name,
		null ie_medic_nao_inform,
		obter_desc_expressao(720319,null) description,
		null max_scale,
		null  min_scale,
		'#F7727B' color,
		'NAV' code_group,
		'line' style,
		null shape,
		null qt_size,
		'#FFF' fill_color, /* White */
		null point_shape,
        null fill_position,
		null shaded,
		10 fixed_scale,
		obter_data_etapa_evento(nr_cirurgia,nr_seq_pepo,3) init_date,
	   obter_data_etapa_evento(nr_cirurgia,nr_seq_pepo,4) end_date,
		-3 CODE_CHART,
		3 seq_apresentacao,
		a.nr_cirurgia nr_cirurgia,
	    a.nr_seq_pepo nr_seq_pepo,
		null nm_usuario,
		'EVENTO_CIRURGIA_PACIENTE' nm_tabela,
		'DS_PROCEDIMENTO' nm_atributo,
		null ie_sinal_vital,
		null nr_seq_superior,
		null end_of_administration,
		null cd_material,
		null cd_unid_medida_adm,
		null ie_modo_adm,
		null nr_seq_agente,
		null ds_dosagem
from	cirurgia a

union all

--Fanep
select 	91 ie_union,
		obter_desc_expressao(295156,null) name,
		null comercial_name,
		null ie_medic_nao_inform,
		obter_desc_expressao(295156,null) description,
		null max_scale,
		null  min_scale,
		'#8EC200' color,
		'NAV' code_group,
		'line' style,
		null shape,
		null qt_size,
		'#FFF' fill_color, /* White */
		null point_shape,
      null fill_position,
		null shaded,
		10 fixed_scale,
		obter_data_etapa_evento(null,nr_sequencia,1) init_date,
	   obter_data_etapa_evento(null,nr_sequencia,6) end_date,
		-1 CODE_CHART,
		1 seq_apresentacao,
		null nr_cirurgia,
	   a.nr_sequencia nr_seq_pepo,
		null nm_usuario,
		'EVENTO_CIRURGIA_PACIENTE' nm_tabela,
		'DS_PACIENTE' nm_atributo,
		null ie_sinal_vital,
		null nr_seq_superior,
		null end_of_administration,
		null cd_material,
		null cd_unid_medida_adm,
		null ie_modo_adm,
		null nr_seq_agente,
		null ds_dosagem
from	pepo_cirurgia a
where	not exists (select 1 from cirurgia b where b.nr_seq_pepo = a.nr_sequencia)
/* Events graph - Anesthesia */

union all

--Fanep
select 	92 ie_union,
		obter_desc_expressao(283468,null) name,
		null comercial_name,
		null ie_medic_nao_inform,
		obter_desc_expressao(283468,null) description,
		null max_scale,
		null  min_scale,
		'#FACD52' color,
		'NAV' code_group,
		'line' style,
		null shape,
		null qt_size,
		'#FFF' fill_color, /* White */
		null point_shape,
        null fill_position,
		null shaded,
		10 fixed_scale,
		obter_data_etapa_evento(null,nr_sequencia,2) init_date,
	   obter_data_etapa_evento(null,nr_sequencia,5) end_date,
		-2 CODE_CHART,
		2 seq_apresentacao,
		null nr_cirurgia,
	   a.nr_sequencia nr_seq_pepo,
		null nm_usuario,
		'EVENTO_CIRURGIA_PACIENTE' nm_tabela,
		'DS_ANESTESIA' nm_atributo,
		null ie_sinal_vital,
		null nr_seq_superior,
		null end_of_administration,
		null cd_material,
		null cd_unid_medida_adm,
		null ie_modo_adm,
		null nr_seq_agente,
		null ds_dosagem
from	pepo_cirurgia a
where	not exists (select 1 from cirurgia b where b.nr_seq_pepo = a.nr_sequencia)

union all

/* Events graph - Procedure */

--Fanep
select 	93 ie_union,
		obter_desc_expressao(720319,null) name,
		null comercial_name,
		null ie_medic_nao_inform,
		obter_desc_expressao(720319,null) description,
		null max_scale,
		null  min_scale,
		'#F7727B' color,
		'NAV' code_group,
		'line' style,
		null shape,
		null qt_size,
		'#FFF' fill_color, /* White */
		null point_shape,
        null fill_position,
		null shaded,
		10 fixed_scale,
		obter_data_etapa_evento(null,nr_sequencia,3) init_date,
	   obter_data_etapa_evento(null,nr_sequencia,4) end_date,
		-3 CODE_CHART,
		3 seq_apresentacao,
		null nr_cirurgia,
	   nr_sequencia nr_seq_pepo,
		null nm_usuario,
		'EVENTO_CIRURGIA_PACIENTE' nm_tabela,
		'DS_PROCEDIMENTO' nm_atributo,
		null ie_sinal_vital,
		null nr_seq_superior,
		null end_of_administration,
		null cd_material,
		null cd_unid_medida_adm,
		null ie_modo_adm,
		null nr_seq_agente,
		null ds_dosagem
from	pepo_cirurgia a
where	not exists (select 1 from cirurgia b where b.nr_seq_pepo = a.nr_sequencia);

