-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_medicar_mov_benef_ted_v (ie_titular, nm_beneficiario, ds_endereco, ds_complemento, ds_bairro, cd_cep, ds_municipio, sg_estado, nr_telefoe_res, nr_telefone_comer, ds_branco, dt_nascimento, ds_sexo, ds_estado_civil, nr_cpf, nr_identidade, cd_ant_titular, cd_ant_dependente, ie_tipo_movimentacao, dt_contratacao, nr_seq_lote, ie_info_benecamp) AS select	CASE WHEN c.nr_seq_titular IS NULL THEN '1'  ELSE '2' END  ie_titular,
	c.NM_BENEFICIARIO,
	c.DS_ENDERECO,
	c.DS_COMPLEMENTO,
	c.DS_BAIRRO,
	CASE WHEN CD_CEP IS NULL THEN ' '  ELSE substr(CD_CEP,1,2)||'.'||substr(CD_CEP,3,3)||'-'||substr(CD_CEP,6,3) END  cd_cep,
	c.DS_MUNICIPIO,
	c.SG_ESTADO,
	c.NR_TELEFONE NR_TELEFOE_RES,
	' ' NR_TELEFONE_COMER,
	' ' ds_branco,
	c.DT_NASCIMENTO,
	CASE WHEN c.IE_SEXO='M' THEN 'Masculino'  ELSE 'Feminino' END  ds_sexo,
	CASE WHEN c.IE_ESTADO_CIVIL='1' THEN 'Solteiro' WHEN c.IE_ESTADO_CIVIL='2' THEN 'Casado' WHEN c.IE_ESTADO_CIVIL='3' THEN 'Divorciado' WHEN c.IE_ESTADO_CIVIL='4' THEN 'Desquitado' WHEN c.IE_ESTADO_CIVIL='5' THEN 'Vi√∫vo' WHEN c.IE_ESTADO_CIVIL='6' THEN 'Separado' WHEN c.IE_ESTADO_CIVIL='7' THEN 'Concubinado' WHEN c.IE_ESTADO_CIVIL='9' THEN 'Outros' END  ds_estado_civil,
	CASE WHEN nr_cpf IS NULL THEN ' '  ELSE substr(nr_cpf,1,3)||'.'||substr(nr_cpf,4,3)||'.'||substr(nr_cpf,7,3)||'-'||substr(nr_cpf,10,2) END  nr_cpf,
	c.NR_IDENTIDADE,
	CASE WHEN c.CD_COD_ANTERIOR_TITULAR='' THEN c.CD_COD_ANTERIOR  ELSE c.CD_COD_ANTERIOR_TITULAR END  CD_ANT_TITULAR,
	CASE WHEN c.CD_COD_ANTERIOR_TITULAR='' THEN ''  ELSE c.CD_COD_ANTERIOR END  CD_ANT_DEPENDENTE,
	CASE WHEN c.IE_TIPO_MOVIMENTACAO='I' THEN '1' WHEN c.IE_TIPO_MOVIMENTACAO='A' THEN '2' WHEN c.IE_TIPO_MOVIMENTACAO='E' THEN '3' END  IE_TIPO_MOVIMENTACAO,
	c.DT_CONTRATACAO,
	c.nr_seq_lote,
	CASE WHEN d.nr_contrato=676 THEN 'FUN'  ELSE CASE WHEN upper(c.DS_MUNICIPIO)='CAMPINAS' THEN 'APH' WHEN upper(c.DS_MUNICIPIO)='SUMARE' THEN 'APH' WHEN upper(c.DS_MUNICIPIO)='HORTOLANDIA' THEN 'APH' WHEN upper(c.DS_MUNICIPIO)='VALINHOS' THEN 'APH' WHEN upper(c.DS_MUNICIPIO)='PAULINIA' THEN 'APH'  ELSE 'AMT' END  END  ie_info_benecamp
FROM	pls_movimentacao_benef		c,
	pls_segurado			b,
	pls_contrato			d,
	pls_plano			a
where	c.nr_seq_segurado		= b.nr_sequencia
and	b.nr_seq_contrato		= d.nr_sequencia
and	b.nr_seq_plano			= a.nr_sequencia
and	a.ie_regulamentacao		<> 'R'
and	b.cd_operadora_empresa		not in (103,1031,3,4,5,23, 24);

