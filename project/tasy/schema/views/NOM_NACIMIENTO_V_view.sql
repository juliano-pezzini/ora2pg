-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW nom_nacimiento_v (cd_estado_fed_capt, nr_folio, ie_tipo_formato, nr_seq_person_name_mae, cd_curp_mae, cd_estado_nasc_mae, cd_municipio_nasc_mae, dt_nascimento_mae, qt_idade_mae, ie_indigena, ie_fala_lingua_indigena, cd_lingua_indigena, ie_estado_civil_mae, cd_tipo_lograd_res, ds_rua_vialidade_res, nr_numero_externo_res, nr_numero_interno_res, cd_tipo_bairro_res, ds_tipo_bairro_res, cd_codigo_postal_res, cd_estado_provinci_res, cd_municipio_res, cd_localidade_area_res, nr_telefone_res, qt_gestacoes, qt_natimortos, qt_natvivos, qt_sobreviventes, ie_cond_ult_nasc, ie_vive_filho_ant, dt_nasc_filho_ant, nr_seq_nascimento, ie_pre_natal, ie_trim_prim_pre_natal, qt_consultas_otorg, ie_mae_sobrevive, nr_declaracao_obito, cd_der_nascimento_1, nr_seguro_social, cd_der_nascimento_2, ie_grau_instrucao_mae, ds_ocupacao, cd_ocupacao, ie_trab_atualmente, dt_nascimento_nasc, hr_nascimento_nasc, ie_sexo_nasc, qt_sem_ig_total, qt_altura_nasc, qt_peso_sala_parto, qt_qualif_nascido_vivo, qt_qualif_nascido, ie_vacina_bcg, ie_vacina_hepb, ie_vitamina_a, ie_vitamina_k, ie_tamis_metabolico, ie_tamis_auditivo, ie_produto, ds_doenca_acel_rn, cd_doenca_acel_rn, ds_doenca_acel2_rn, cd_doenca_acel2_rn, cd_proc_utilizado_nasc, ie_parto_forceps, ds_espec_procedimento, ie_local_nascimento, ds_estab_saude, cd_clues, cd_atend_parto, ie_otro_atend_parto, cd_tipo_lograd_nasc, ds_rua_vialidade_nasc, nr_numero_externo_nasc, nr_numero_interno_nasc, cd_tipo_bairro_nasc, ds_tipo_bairro_nasc, cd_codigo_postal_nasc, cd_estado_provinci_nasc, cd_municipio_nasc, cd_localidade_area_nasc, nr_seq_person_name_cert, cd_cert_parto, cd_outro_cert_parto, cd_prof_medico, ds_estab_saude_cert, cd_clues_unid_med, cd_tipo_lograd_cert, ds_rua_vialidade_cert, nr_numero_externo_cert, nr_numero_interno_cert, cd_tipo_bairro_cert, ds_tipo_bairro_cert, cd_codigo_postal_cert, cd_estado_provinci_cert, cd_municipio_cert, cd_localidade_area_cert, nr_telefone_cert, dt_certificado, nm_usuario_cert, dt_capt_cert, nm_usuario_modif, dt_modificacao, cd_lug_cert_nasc, cd_municipio_capt, nr_atendimento, dt_nascimento) AS select	cd_estado_fed_capt,
		lpad(coalesce(nr_folio, '         '),9,'0') nr_folio,
		ie_tipo_formato,
		nr_seq_person_name_mae,
		substr(coalesce(cd_curp_mae, 'SIN INFORMACIÓN'),1,18) cd_curp_mae,
		coalesce(cd_estado_nasc_mae,'99') cd_estado_nasc_mae,
		coalesce(CASE WHEN cd_estado_nasc_mae='99' THEN  '999' WHEN cd_estado_nasc_mae='33' THEN  '888' WHEN cd_estado_nasc_mae='34' THEN  '888' WHEN cd_estado_nasc_mae='35' THEN  '888'  ELSE cd_municipio_nasc_mae END ,'999') cd_municipio_nasc_mae,
		to_char(dt_nascimento_mae, 'dd/mm/yyyy') dt_nascimento_mae,
		coalesce(qt_idade_mae,  '99') qt_idade_mae,
		coalesce(ie_indigena,'9') ie_indigena,
		coalesce(ie_fala_lingua_indigena, '9') ie_fala_lingua_indigena,
		CASE WHEN ie_fala_lingua_indigena='2' THEN  '0000'  ELSE cd_lingua_indigena END  cd_lingua_indigena,
		coalesce(ie_estado_civil_mae, '99') ie_estado_civil_mae,
		lpad(coalesce(obter_conversao_catalogo_nom('NACIMIENTOS','TIPO_LOGRAD','A',cd_tipo_lograd_res), '99'),2,0) cd_tipo_lograd_res,
		upper(coalesce(ds_rua_vialidade_res, 'SIN INFORMACIÓN')) ds_rua_vialidade_res,
		substr(nr_numero_externo_res, 1,10) nr_numero_externo_res,
		substr(nr_numero_interno_res, 1,10) nr_numero_interno_res,
		lpad(coalesce(obter_conversao_catalogo_nom('NACIMIENTOS','TIPO_BAIRRO','A',cd_tipo_bairro_res), '99'),2,0) cd_tipo_bairro_res,
		upper(coalesce(ds_tipo_bairro_res, 'SIN INFORMACIÓN')) ds_tipo_bairro_res,
		coalesce(cd_codigo_postal_res, '99999') cd_codigo_postal_res,
		coalesce(cd_estado_provinci_res, '99') cd_estado_provinci_res,
		coalesce(CASE WHEN cd_estado_provinci_res='99' THEN  '999'  ELSE cd_municipio_res END , '999') cd_municipio_res,
		coalesce(CASE WHEN cd_estado_provinci_res='99' THEN  '9999'  ELSE CASE WHEN cd_municipio_res='999' THEN '9999'  ELSE cd_localidade_area_res END  END , '9999') cd_localidade_area_res,
		substr(coalesce(nr_telefone_res, '999999999'),1,15) nr_telefone_res,
		substr(coalesce(qt_gestacoes,'99'),1,2) qt_gestacoes,
		substr(coalesce(qt_natimortos,'99'),1,2) qt_natimortos,
		substr(coalesce(qt_natvivos,'99'),1,2) qt_natvivos,
		substr(coalesce(qt_sobreviventes,'99'),1,2) qt_sobreviventes,
		coalesce(ie_cond_ult_nasc, '9') ie_cond_ult_nasc,
		coalesce(CASE WHEN ie_cond_ult_nasc='2' THEN  '0' WHEN ie_cond_ult_nasc=3 THEN  '0'  ELSE ie_vive_filho_ant END ,'9') ie_vive_filho_ant,
		to_char(dt_nasc_filho_ant, 'dd/mm/yyyy') dt_nasc_filho_ant,
		--nvl(nr_seq_nascimento, 99) nr_seq_nascimento,

		coalesce(NR_ORDEM_NASC,'99') nr_seq_nascimento,
		coalesce(ie_pre_natal, '9') ie_pre_natal,
--		nvl2(ie_pre_natal,'0', ie_trim_prim_pre_natal) ie_trim_prim_pre_natal,

		CASE WHEN ie_pre_natal='1' THEN  ie_trim_prim_pre_natal  ELSE '0' END  ie_trim_prim_pre_natal,
		substr(qt_consultas_otorg,1,2) qt_consultas_otorg,
		coalesce(ie_mae_sobrevive,'9') ie_mae_sobrevive,
		--substr(nvl(nr_declaracao_obito, '999999999'),1,9) nr_declaracao_obito,

		CASE WHEN ie_mae_sobrevive='2' THEN substr(coalesce(nr_declaracao_obito, '999999999'),1,9)  ELSE null END  nr_declaracao_obito,
		substr(cd_der_nascimento_1,1,2) cd_der_nascimento_1,
		substr(nr_seguro_social,1,18) nr_seguro_social,
		cd_der_nascimento_2 cd_der_nascimento_2,
		coalesce(ie_grau_instrucao_mae,'99') ie_grau_instrucao_mae,
		upper(coalesce(ds_ocupacao, 'SIN INFORMACIÓN')) ds_ocupacao,
		cd_ocupacao,
		coalesce(CASE WHEN cd_ocupacao='01' THEN  '0' WHEN cd_ocupacao='04' THEN  '0'  ELSE ie_trab_atualmente END , '0') ie_trab_atualmente,
		to_char(dt_nascimento_nasc, 'dd/mm/yyyy') dt_nascimento_nasc,
		hr_nascimento_nasc,
		ie_sexo_nasc,
		qt_sem_ig_total,
		coalesce(qt_altura_nasc, '99') qt_altura_nasc,
		coalesce(qt_peso_sala_parto, '9999') qt_peso_sala_parto,
		coalesce(qt_qualif_nascido_vivo, '99') qt_qualif_nascido_vivo,
		coalesce(qt_qualif_nascido, '99') qt_qualif_nascido,
		coalesce(ie_vacina_bcg, '9') ie_vacina_bcg,
		coalesce(ie_vacina_hepb, '9') ie_vacina_hepb,
		coalesce(ie_vitamina_a, '9') ie_vitamina_a,
		coalesce(ie_vitamina_k, '9') ie_vitamina_k,
		coalesce(ie_tamis_metabolico, '0') ie_tamis_metabolico,
		coalesce(ie_tamis_auditivo, '9') ie_tamis_auditivo,
		coalesce(ie_produto, '9') ie_produto,
		upper(substr(coalesce(ds_doenca_acel_rn, 'NINGUNA APARENTE'),1,40)) ds_doenca_acel_rn,
		CASE WHEN ds_doenca_acel_rn IS NULL THEN '0000'  ELSE coalesce(cd_doenca_acel_rn,'9999') END  cd_doenca_acel_rn,
		upper(substr((CASE WHEN ds_doenca_acel_rn IS NOT NULL THEN 'NO APLICA' ELSE ds_doenca_acel2_rn END),1,40))  ds_doenca_acel2_rn,
		CASE WHEN ds_doenca_acel_rn IS NULL THEN  '7777'  ELSE coalesce(cd_doenca_acel2_rn,'9999') END  cd_doenca_acel2_rn,
		coalesce(cd_proc_utilizado_nasc,'9') cd_proc_utilizado_nasc,
		coalesce(ie_parto_forceps, '9') ie_parto_forceps,
		upper(ds_espec_procedimento) ds_espec_procedimento,
		substr(coalesce(ie_local_nascimento, '99'),1,2) ie_local_nascimento,
		upper(substr(ds_estab_saude, 1,50)) ds_estab_saude,
		substr(cd_clues,1,11) cd_clues,
		substr(cd_atend_parto,1,2) cd_atend_parto,
		substr(ie_otro_atend_parto, 1,25) ie_otro_atend_parto,
		LPAD(substr(coalesce(obter_conversao_catalogo_nom('NACIMIENTOS','TIPO_LOGRAD','A',cd_tipo_lograd_nasc),cd_tipo_lograd_nasc),1,2),2,0) cd_tipo_lograd_nasc,
		upper(substr(ds_rua_vialidade_nasc,1,80)) ds_rua_vialidade_nasc,
		substr(coalesce(nr_numero_externo_nasc, '999999999'), 1,10) nr_numero_externo_nasc,
		substr(nr_numero_interno_nasc, 1,5) nr_numero_interno_nasc,
		lpad(coalesce(obter_conversao_catalogo_nom('NACIMIENTOS','TIPO_BAIRRO','A',cd_tipo_bairro_nasc), '99'),2,0) cd_tipo_bairro_nasc,
		upper(substr(coalesce(ds_tipo_bairro_nasc, 'SIN INFORMACION'),1,60)) ds_tipo_bairro_nasc,
		substr(coalesce(cd_codigo_postal_nasc,'999999999') ,1,5) cd_codigo_postal_nasc,
		substr(cd_estado_provinci_nasc, 1, 2) cd_estado_provinci_nasc,
		substr(coalesce(obter_conversao_catalogo_nom('NACIMIENTOS','MUNICIPIO','A',cd_municipio_nasc),'999'),1,3) cd_municipio_nasc,
		substr(coalesce(obter_conversao_catalogo_nom('NACIMIENTOS','LOCALIDADE_AREA','A',cd_localidade_area_nasc), '999'),1,4) cd_localidade_area_nasc,
		nr_seq_person_name_cert,
		coalesce(cd_cert_parto, '9') cd_cert_parto,
		substr(coalesce(cd_outro_cert_parto, 'SIN INFORMACIÓN'),1,25) cd_outro_cert_parto,
		substr(coalesce(cd_prof_medico, 'SIN INFORMACIÓN'),1,20) cd_prof_medico,
		upper(substr(ds_estab_saude_cert,1,50)) ds_estab_saude_cert,
		substr(cd_clues_unid_med,1,11) cd_clues_unid_med,
		LPAD(substr(coalesce(obter_conversao_catalogo_nom('NACIMIENTOS','TIPO_LOGRAD','A',cd_tipo_lograd_cert),'99'),1,2),2,0) cd_tipo_lograd_cert,
		upper(substr(ds_rua_vialidade_cert,1,80)) ds_rua_vialidade_cert,
		substr(coalesce(nr_numero_externo_cert, '999999999'), 1,10) nr_numero_externo_cert,
		substr(nr_numero_interno_cert, 1,5) nr_numero_interno_cert,
		lpad(substr(coalesce(cd_tipo_bairro_cert, '99'),1,2),2,0) cd_tipo_bairro_cert,
		upper(substr(coalesce(ds_tipo_bairro_cert,'SIN INFORMACION'),1,60)) ds_tipo_bairro_cert,
		substr(coalesce(cd_codigo_postal_cert,'999999999'),1,5) cd_codigo_postal_cert,
		substr(cd_estado_provinci_cert,1,2) cd_estado_provinci_cert,
		substr(coalesce(cd_municipio_cert,'999'),1,3) cd_municipio_cert,
		substr(coalesce(obter_conversao_catalogo_nom('NACIMIENTOS','LOCALIDADE_AREA','A',cd_localidade_area_cert),'9999'),1,4) cd_localidade_area_cert,
		substr(nr_telefone_cert,1,12) nr_telefone_cert,
		to_char(dt_certificado, 'dd/mm/yyyy') dt_certificado,
		substr(nm_usuario_cert,1,6) nm_usuario_cert ,
		to_char(dt_capt_cert, 'dd/mm/yyyy') dt_capt_cert,
		substr(nm_usuario_modif,1,6) nm_usuario_modif,
		dt_modificacao,
		coalesce(cd_lug_cert_nasc,'9') cd_lug_cert_nasc,
		coalesce(cd_municipio_capt,'999') cd_municipio_capt,
		nr_atendimento,
		dt_nascimento_nasc dt_nascimento
FROM	nom_nascimento
where 	dt_liberacao is not null;

