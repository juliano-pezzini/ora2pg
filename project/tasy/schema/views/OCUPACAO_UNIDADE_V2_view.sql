-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ocupacao_unidade_v2 (nr_atendimento, dt_entrada, nm_medico_resp, dt_entrada_unidade, cd_unidade, cd_unidade_basica, cd_unidade_compl, nm_pessoa_fisica, nr_prontuario, cd_pessoa_fisica, cd_setor_atendimento, cd_convenio, nr_seq_apresent, classif, ds_tipo_atendimento, dt_nascimento, ie_tipo_atendimento, dt_alta) AS select	a.nr_atendimento,
	c.dt_entrada, 
	substr(obter_dados_medico(c.cd_medico_resp, 'NM'), 1, 255) nm_medico_resp, 
	a.dt_entrada_unidade, 
	a.cd_unidade_basica || ' ' || a.cd_unidade_compl cd_unidade, 
	a.cd_unidade_basica, 
	a.cd_unidade_compl, 
	SUBSTR(obter_nome_pf(d.cd_pessoa_fisica),1,100) nm_pessoa_fisica, 
	d.nr_prontuario, 
	d.cd_pessoa_fisica, 
	b.cd_setor_atendimento, 
	obter_convenio_atendimento(c.nr_atendimento) cd_convenio, 
	obter_seq_apresent_unidade(b.cd_setor_atendimento, a.cd_unidade_basica, a.cd_unidade_compl) nr_seq_apresent, 
	substr(obter_desc_classif_atend(c.nr_seq_classificacao),1,60) classif, 
	substr(obter_nome_tipo_atend(obter_tipo_atendimento(a.nr_atendimento)),1,255) ds_tipo_atendimento, 
	d.dt_nascimento dt_nascimento, 
	c.ie_tipo_atendimento, 
	c.dt_alta dt_alta 
FROM	pessoa_fisica d, 
	atendimento_paciente c, 
	setor_atendimento b, 
	atend_paciente_unidade a 
where	a.cd_setor_atendimento = b.cd_setor_atendimento 
and	b.cd_classif_setor = 2 
and	a.dt_saida_unidade is null 
and	a.nr_atendimento = c.nr_atendimento 
and	c.cd_pessoa_fisica = d.cd_pessoa_fisica;

