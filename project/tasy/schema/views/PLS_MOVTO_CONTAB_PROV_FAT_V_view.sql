-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_movto_contab_prov_fat_v (ie_origem_pos_estab, nr_seq_atualizacao, ds_status, ie_status, nr_seq_conta_proc, nr_seq_conta_mat, nr_seq_conta_pos_estab, cd_conta_cred, cd_conta_deb, cd_classif_cred, cd_classif_deb, nr_seq_esquema, nr_sequencia, nr_seq_item_mensalidade, ds_conta_cred, ds_conta_deb, nr_seq_conta_copartic, nr_seq_taxa_adm_contab, nr_seq_conta_pos_estab_prev) AS select	'C' ie_origem_pos_estab,
	a.nr_seq_atualizacao,
	substr((select	ds_valor_dominio
		FROM 	valor_dominio_v
		where 	cd_dominio	= 5260
		and	vl_dominio	= a.ie_status),1,255) ds_status,
	a.ie_status,
	null nr_seq_conta_proc,
	null nr_seq_conta_mat,
	a.nr_seq_conta_pos_estab,
	b.cd_conta_cred_provisao cd_conta_cred,
	b.cd_conta_deb_provisao cd_conta_deb,
	b.cd_classif_cred_provisao cd_classif_cred,
	b.cd_classif_deb_provisao cd_classif_deb,
	b.nr_seq_esquema_prov nr_seq_esquema,
	a.nr_sequencia,
	a.nr_seq_item_mensalidade,
	substr((select	ds_conta_contabil
		from	conta_contabil
		where	cd_conta_contabil = b.cd_conta_cred_provisao),1,255) ds_conta_cred,
	substr((select	ds_conta_contabil
		from	conta_contabil
		where	cd_conta_contabil = b.cd_conta_deb_provisao),1,255) ds_conta_deb,
	a.nr_seq_conta_copartic,
	null nr_seq_taxa_adm_contab,
	null nr_seq_conta_pos_estab_prev
from	pls_conta_pos_estab_contab	b,
	pls_movimento_contabil		a,
	pls_atualizacao_contabil	c
where	a.nr_seq_conta_pos_estab	= b.nr_sequencia
and	a.nr_seq_atualizacao		= c.nr_sequencia
and	a.nr_seq_taxa_adm_contab is null
and	a.nr_seq_conta_pos_estab_prev is null

union all

select	'T' ie_origem_pos_estab,
	a.nr_seq_atualizacao,
	substr((select	ds_valor_dominio
		from 	valor_dominio_v
		where 	cd_dominio	= 5260
		and	vl_dominio	= a.ie_status),1,255) ds_status,
	a.ie_status,
	null nr_seq_conta_proc,
	null nr_seq_conta_mat,
	a.nr_seq_conta_pos_estab,
	b.cd_conta_cred cd_conta_cred,
	b.cd_conta_deb cd_conta_deb,
	b.cd_classif_cred cd_classif_cred,
	b.cd_classif_deb cd_classif_deb,
	b.nr_seq_esquema nr_seq_esquema,
	a.nr_sequencia,
	a.nr_seq_item_mensalidade,
	substr((select	ds_conta_contabil
		from	conta_contabil
		where	cd_conta_contabil = b.cd_conta_cred),1,255) ds_conta_cred,
	substr((select	ds_conta_contabil
		from	conta_contabil
		where	cd_conta_contabil = b.cd_conta_deb),1,255) ds_conta_deb,
	a.nr_seq_conta_copartic,
	a.nr_seq_taxa_adm_contab,
	null nr_seq_conta_pos_estab_prev
from	pls_conta_pos_taxa_contab	b,
	pls_movimento_contabil		a,
	pls_atualizacao_contabil	c
where	a.nr_seq_taxa_adm_contab	= b.nr_sequencia
and	a.nr_seq_atualizacao		= c.nr_sequencia
and	a.nr_seq_taxa_adm_contab is not null

union all

select	'C' ie_origem_pos_estab,
	a.nr_seq_atualizacao,
	substr((select	ds_valor_dominio
		from 	valor_dominio_v
		where 	cd_dominio	= 5260
		and	vl_dominio	= a.ie_status),1,255) ds_status,
	a.ie_status,
	null nr_seq_conta_proc,
	null nr_seq_conta_mat,
	a.nr_seq_conta_pos_estab,
	b.cd_conta_cred_provisao cd_conta_cred,
	b.cd_conta_deb_provisao cd_conta_deb,
	b.cd_classif_cred_provisao cd_classif_cred,
	b.cd_classif_deb_provisao cd_classif_deb,
	b.nr_seq_esquema_prov nr_seq_esquema,
	a.nr_sequencia,
	a.nr_seq_item_mensalidade,
	substr((select	ds_conta_contabil
		from	conta_contabil
		where	cd_conta_contabil = b.cd_conta_cred_provisao),1,255) ds_conta_cred,
	substr((select	ds_conta_contabil
		from	conta_contabil
		where	cd_conta_contabil = b.cd_conta_deb_provisao),1,255) ds_conta_deb,
	a.nr_seq_conta_copartic,
	null nr_seq_taxa_adm_contab,
	a.nr_seq_conta_pos_estab_prev
from	pls_conta_pos_estab_prev	b,
	pls_movimento_contabil		a,
	pls_atualizacao_contabil	c
where	a.nr_seq_conta_pos_estab_prev	= b.nr_sequencia
and	a.nr_seq_atualizacao		= c.nr_sequencia
and	a.nr_seq_taxa_adm_contab is null
and	a.nr_seq_conta_pos_estab_prev is not null;

