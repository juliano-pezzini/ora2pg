-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW exportar_cotacao_fornecedor_v (linha, nr_cot_compra, cd_cgc_fornecedor) AS select	OBTER_DESC_EXPRESSAO(286320)||';'||--nr_cot_compra
	OBTER_DESC_EXPRESSAO(286507)||';'||--dt_cot_compra
	OBTER_DESC_EXPRESSAO(285188)||';'||--cd_cgc_fornecedor
	OBTER_DESC_EXPRESSAO(297241)||';'||--ds_razao_social
	OBTER_DESC_EXPRESSAO(285658)||';'||--cd_condicao_pagamento
	OBTER_DESC_EXPRESSAO(292266)||';'||--nr_item_cot_compra
	OBTER_DESC_EXPRESSAO(874197)||';'||--cd_material
	OBTER_DESC_EXPRESSAO(303638)||';'||--ds_material
	OBTER_DESC_EXPRESSAO(300715)||';'||--cd_unidade_medida_compra
	OBTER_DESC_EXPRESSAO(297049)||';'||--qt_material
	OBTER_DESC_EXPRESSAO(292880)||';'||--ds_marca
	OBTER_DESC_EXPRESSAO(301532)||';'||--valor_unitario
	OBTER_DESC_EXPRESSAO(760838)||';'||--valor_desconto
	OBTER_DESC_EXPRESSAO(292888)||';'||--marca_fornecedor
	OBTER_DESC_EXPRESSAO(753406) /*observacao*/
 linha,
	-1 nr_cot_compra,
	null cd_cgc_fornecedor


union all
 
select	linha,
	nr_cot_compra,
	cd_cgc_fornecedor from (
	select cot.nr_cot_compra||';'||
	cot.dt_cot_compra||';'||
	cot_forn.cd_cgc_fornecedor||';'||
	pj.ds_razao_social||';'||
	cot_forn.cd_condicao_pagamento||';'||
	cot_forn_item.nr_item_cot_compra||';'||
	cot_forn_item.cd_material||';'||
	coalesce(substr(obter_desc_material(cot_forn_item.cd_material),1,255),substr(obter_material_cot_compra(cot.nr_cot_compra,cot_item.NR_ITEM_COT_COMPRA),1,255))||';'||
	cot_item.cd_unidade_medida_compra||';'||
	cot_item.qt_material||';'||
	cot_forn_item.ds_marca||';'||
	''||';'||
	''||';'||
	''||';'||
	'' linha,
	cot.nr_cot_compra,
	cot_forn.cd_cgc_fornecedor
from cot_compra cot,cot_compra_forn cot_forn,cot_compra_forn_item cot_forn_item, cot_compra_item cot_item,pessoa_juridica pj
where	cot.nr_cot_compra 			= cot_forn.nr_cot_compra
and 	cot_forn.nr_cot_compra 			= cot_forn_item.nr_cot_compra
and 	cot_forn.cd_cgc_fornecedor 		= pj.cd_cgc
and 	cot_forn_item.nr_cot_compra 		= cot_item.nr_cot_compra
and 	cot_forn_item.nr_item_cot_compra 	= cot_item.nr_item_cot_compra
and 	cot_forn_item.nr_seq_cot_forn 		= cot_forn.nr_sequencia
order by cot_forn_item.cd_cgc_fornecedor,cot_forn_item.nr_item_cot_compra) alias20;

