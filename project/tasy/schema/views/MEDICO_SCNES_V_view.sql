-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW medico_scnes_v (cpf_prof, pispasep, nome_prof, nome_mae, data_nasc, cod_mun, sexo, num_livro, num_folha, num_termo, codorgemis, data_emiss, num_ident, sigla_est, dtemiident, data_entra, ctps_number, serie, sigesctps, dtemisctps, logradouro, numero, complement, bairrodist, cod_cep, sigla_uf, codescolar, cod_certid, ind_nacio, nome_carto, cod_banco, nome_pais, num_agenc, conta_cc, cod_cns, cd_raca, nome_pai, telefone, cd_tp_logr, portaria, dt_natur, cd_pais, cod_mun_res, uf_res, co_etnia, no_email, co_pais_resid, nu_carteira_hab, dt_emis_carteira_hab, uf_carteira_hab, cnes, cod_cbo, tp_sus_nao_sus, ind_vinc, cghoraoutr, cg_horaamb, cghorahosp, conselhoid, n_registro, dt_entrada_prof, sg_uf_crm, tp_preceptor, tp_residente, nu_cnpj_det_vinc, cd_pessoa_fisica, tp_registro, dt_entrada, nm_paciente) AS select	rpad(coalesce(a.nr_cpf,' '),11,' ') cpf_prof,
	rpad(coalesce(a.nr_pis_pasep,' '),11,' ') pispasep, 
	rpad(coalesce(a.nm_pessoa_fisica,' '),60,' ') nome_prof, 
	rpad(coalesce(substr(obter_nome_mae_pf(a.cd_pessoa_fisica),1,60),' '),60,' ') nome_mae, 
	rpad(coalesce(CASE WHEN a.dt_nascimento IS NULL THEN  null  ELSE to_char(a.dt_nascimento,'dd/mm/yyyy') END ,' '),10,' ') data_nasc, 
	rpad(coalesce(CASE WHEN obter_se_pf_pj_estrangeiro(a.cd_pessoa_fisica,null)='N' THEN coalesce(a.cd_municipio_ibge ,substr(obter_municipio_ibge(coalesce(elimina_caracteres_especiais(a.nr_cep_cidade_nasc),0)),1,14)) || substr(calcula_digito('MODULO10',coalesce(a.cd_municipio_ibge ,substr(obter_municipio_ibge(coalesce(elimina_caracteres_especiais(a.nr_cep_cidade_nasc),0)),1,14))),1,1)  ELSE null END ,' '),11,' ') cod_mun, 
	rpad(coalesce(a.ie_sexo,' '),1,' ') sexo, 
	rpad(coalesce(to_char(a.nr_livro_cert_nasc),' '),8,' ') num_livro, 
	rpad(coalesce(to_char(a.nr_folha_cert_nasc),' '),4,' ') num_folha, 
	rpad(coalesce(to_char(a.nr_termo_cert_nasc),' '),8,' ') num_termo, 
	rpad(coalesce(substr(a.ds_orgao_emissor_ci,1,2),' '),2,' ') codorgemis, 
	rpad(coalesce(CASE WHEN a.dt_emissao_cert_nasc IS NULL THEN  null  ELSE to_char(a.dt_emissao_cert_nasc,'dd/mm/yyyy') END ,' '),10,' ') data_emiss, 
	rpad(coalesce(substr(a.nr_identidade,1,14),' '),14,' ') num_ident, 
	rpad(coalesce(a.sg_emissora_ci,' '),2,' ') sigla_est, 
	rpad(coalesce(CASE WHEN a.dt_emissao_ci IS NULL THEN  null  ELSE to_char(a.dt_emissao_ci,'dd/mm/yyyy') END ,' '),10,' ') dtemiident, 
	rpad(coalesce(CASE WHEN a.dt_chegada_brasil IS NULL THEN  null  ELSE to_char(a.dt_chegada_brasil,'dd/mm/yyyy') END ,' '),10,' ') data_entra, 
	rpad(coalesce(substr(a.nr_ctps,1,7),' '),7,' ') ctps_number, 
	rpad(coalesce(substr(a.nr_serie_ctps,1,5),' '),5,' ') serie, 
	rpad(coalesce(a.uf_emissora_ctps,' '),2,' ') sigesctps, 
	rpad(coalesce(CASE WHEN a.dt_emissao_ctps IS NULL THEN  null  ELSE to_char(a.dt_emissao_ctps,'dd/mm/yyyy') END ,' '),10,' ') dtemisctps, 
	rpad(coalesce(substr(obter_compl_pf(a.cd_pessoa_fisica, 2, 'EN'),1,60),' '),60,' ') logradouro, 
	rpad(coalesce(substr(obter_compl_pf(a.cd_pessoa_fisica, 2, 'NR'),1,10),' '),10,' ') numero, 
	rpad(coalesce(substr(obter_compl_pf(a.cd_pessoa_fisica, 2, 'CO'),1,60),' '),60,' ') complement, 
	rpad(coalesce(substr(obter_compl_pf(a.cd_pessoa_fisica, 2, 'B'),1,60),' '),60,' ') bairrodist, 
	rpad(coalesce(substr(obter_compl_pf(a.cd_pessoa_fisica, 2, 'CEP'),1,8),' '),8,' ') cod_cep, 
	rpad(coalesce(substr(obter_compl_pf(a.cd_pessoa_fisica, 2, 'UF'),1,2),' '),2,' ') sigla_uf, 
	rpad(coalesce(CASE WHEN a.ie_grau_instrucao=1 THEN '01' WHEN a.ie_grau_instrucao=11 THEN '01' WHEN a.ie_grau_instrucao=7 THEN '03' WHEN a.ie_grau_instrucao=2 THEN '04' WHEN a.ie_grau_instrucao=8 THEN '05' WHEN a.ie_grau_instrucao=3 THEN '06' WHEN a.ie_grau_instrucao=9 THEN '07' WHEN a.ie_grau_instrucao=4 THEN '08' WHEN a.ie_grau_instrucao=12 THEN '09' WHEN a.ie_grau_instrucao=5 THEN '10' WHEN a.ie_grau_instrucao=6 THEN '11' WHEN a.ie_grau_instrucao=10 THEN '02' WHEN a.ie_grau_instrucao=13 THEN '11' WHEN a.ie_grau_instrucao=15 THEN '06' WHEN a.ie_grau_instrucao=14 THEN ' ' END ,' '),2,' ') codescolar, 
	' ' cod_certid, 
	rpad(coalesce(CASE WHEN a.dt_naturalizacao_pf IS NULL THEN CASE WHEN obter_se_brasileiro(a.cd_pessoa_fisica)='S' THEN '1'  ELSE '2' END   ELSE '3' END ,' '),1,' ') ind_nacio, 
	rpad(' ',60,' ') nome_carto, 
	rpad(coalesce(substr(obter_dados_pf(a.cd_pessoa_fisica,'UB'),1,3),' '),3,' ') cod_banco, 
	rpad(' ',60,' ') nome_pais, 
	rpad(coalesce(substr(obter_dados_pf(a.cd_pessoa_fisica,'UA'),1,5),' '),5,' ') num_agenc, 
	rpad(coalesce(substr(obter_dados_pf(a.cd_pessoa_fisica,'UCC'),1,14),' '),14,' ') conta_cc, 
	rpad(coalesce(a.nr_cartao_nac_sus,' '),60,' ') cod_cns, 
	rpad(coalesce(sus_obter_raca_sinan(a.cd_pessoa_fisica,'C'),' '),2,' ') cd_raca, 
	rpad(coalesce(substr(obter_nome_pai_mae(a.cd_pessoa_fisica,'P'),1,60),' '),60,' ') nome_pai, 
	rpad(coalesce(substr(obter_compl_pf(a.cd_pessoa_fisica, 2, 'T'),1,60),' '),60,' ') telefone, 
	rpad(coalesce(substr(obter_compl_pf(a.cd_pessoa_fisica, 2, 'TLS'),1,3),' '),3,' ') cd_tp_logr, 
	rpad(coalesce(a.nr_portaria_nat,' '),16,' ') portaria, 
	rpad(coalesce(CASE WHEN a.dt_naturalizacao_pf IS NULL THEN  null  ELSE to_date(a.dt_naturalizacao_pf,'dd/mm/yyyy') END ,' '),10,' ') dt_natur, 
	rpad(coalesce(substr(obter_codigo_pais(a.nr_seq_pais),1,3),' '),3,' ') cd_pais, 
	rpad(coalesce(substr(obter_compl_pf(a.cd_pessoa_fisica, 1, 'CDM'),1,6),' '),6,' ') cod_mun_res, 
	rpad(coalesce(substr(obter_compl_pf(a.cd_pessoa_fisica, 1, 'UF'),1,2),' '),2,' ') uf_res, 
	rpad(coalesce(substr(sus_obter_etnia(a.cd_pessoa_fisica,'C'),1,3),' '),3,' ') co_etnia, 
	rpad(coalesce(substr(obter_compl_pf(a.cd_pessoa_fisica, 2, 'M'),1,60),' '),60,' ') no_email, 
	rpad(coalesce(substr(obter_compl_pf(a.cd_pessoa_fisica, 1, 'CPAIS'),1,3),' '),3,' ') co_pais_resid, 
	rpad(coalesce(substr(a.nr_cnh,1,15),' '),15,' ') nu_carteira_hab, 
	rpad(' ',10,' ') dt_emis_carteira_hab, 
	rpad(' ',2,' ') uf_carteira_hab, 
	--LFCES021 
	rpad(' ',31,' ') cnes, 
	rpad(' ',6,' ') cod_cbo, 
	rpad(' ',1,' ') tp_sus_nao_sus, 
	rpad(' ',6,' ') ind_vinc, 
	rpad(' ',3,' ') cghoraoutr, 
	rpad(' ',3,' ') cg_horaamb, 
	rpad(' ',3,' ') cghorahosp, 
	rpad(' ',2,' ') conselhoid, 
	rpad(' ',60,' ') n_registro, 
	rpad(' ',10,' ') dt_entrada_prof, 
	rpad(' ',2,' ') sg_uf_crm, 
	rpad(' ',1,' ') tp_preceptor, 
	rpad(' ',1,' ') tp_residente, 
	rpad(' ',14,' ') nu_cnpj_det_vinc, 
	a.cd_pessoa_fisica, 
	0 tp_registro, 
	b.dt_admissao dt_entrada, 
	a.cd_pessoa_fisica||'0' nm_paciente 
FROM 	pessoa_fisica	a, 
	medico		b 
where	a.cd_pessoa_fisica	= b.cd_pessoa_fisica 

union all
 
select	rpad(coalesce(a.nr_cpf,' '),11,' ') cpf_prof, 
	rpad(' ',11,' ') pispasep, 
	rpad(' ',60,' ') nome_prof, 
	rpad(' ',60,' ') nome_mae, 
	rpad(' ',10,' ') data_nasc, 
	rpad(' ',11,' ') cod_mun, 
	rpad(' ',1,' ') sexo, 
	rpad(' ',8,' ') num_livro, 
	rpad(' ',4,' ') num_folha, 
	rpad(' ',8,' ') num_termo, 
	rpad(' ',2,' ') codorgemis, 
	rpad(' ',10,' ') data_emiss, 
	rpad(' ',14,' ') num_ident, 
	rpad(' ',2,' ') sigla_est, 
	rpad(' ',10,' ') dtemiident, 
	rpad(' ',10,' ') data_entra, 
	rpad(' ',7,' ') ctps_number, 
	rpad(' ',5,' ') serie, 
	rpad(' ',2,' ') sigesctps, 
	rpad(' ',10,' ') dtemisctps, 
	rpad(' ',60,' ') logradouro, 
	rpad(' ',10,' ') numero, 
	rpad(' ',60,' ') complement, 
	rpad(' ',60,' ') bairrodist, 
	rpad(' ',8,' ') cod_cep, 
	rpad(' ',2,' ') sigla_uf, 
	rpad(' ',2,' ') codescolar, 
	' ' cod_certid, 
	rpad(' ',1,' ') ind_nacio, 
	rpad(' ',60,' ') nome_carto, 
	rpad(' ',3,' ') cod_banco, 
	rpad(' ',60,' ') nome_pais, 
	rpad(' ',5,' ') num_agenc, 
	rpad(' ',14,' ') conta_cc, 
	rpad(' ',60,' ') cod_cns, 
	rpad(' ',2,' ') cd_raca, 
	rpad(' ',60,' ') nome_pai, 
	rpad(' ',60,' ') telefone, 
	rpad(' ',3,' ') cd_tp_logr, 
	rpad(' ',16,' ') portaria, 
	rpad(' ',10,' ') dt_natur, 
	rpad(' ',3,' ') cd_pais, 
	rpad(' ',6,' ') cod_mun_res, 
	rpad(' ',2,' ') uf_res, 
	rpad(' ',3,' ') co_etnia, 
	rpad(' ',60,' ') no_email, 
	rpad(' ',3,' ') co_pais_resid, 
	rpad(' ',15,' ') nu_carteira_hab, 
	rpad(' ',10,' ') dt_emis_carteira_hab, 
	rpad(' ',2,' ') uf_carteira_hab, 
	--LFCES021 
	rpad(coalesce(to_char(d.cd_cnes),' '),31,' ') cnes, 
	rpad(coalesce(to_char(c.cd_cbo),' '),6,' ') cod_cbo, 
	rpad(c.ie_atende_sus,1,' ') tp_sus_nao_sus, 
	rpad(coalesce(to_char(c.ie_vinculo_medico),' '),6,' ') ind_vinc, 
	rpad(coalesce(to_char(c.qt_hora_outros),' '),3,' ') cghoraoutr, 
	rpad(coalesce(to_char(c.qt_hora_amb),' '),3,' ') cg_horaamb, 
	rpad(coalesce(to_char(c.qt_hora_esp),' '),3,' ') cghorahosp, 
	rpad(coalesce(to_char(obter_conselho_profissional(a.nr_seq_conselho,'S')),' '),2,' ') conselhoid, 
	rpad(to_char(b.nr_crm),60,' ') n_registro, 
	rpad(coalesce(CASE WHEN b.dt_atualizacao_nrec IS NULL THEN  null  ELSE to_char(b.dt_atualizacao_nrec,'dd/mm/yyyy') END ,' '),10,' ') dt_entrada_prof, 
	rpad(coalesce(b.uf_crm,' '),2,' ') sg_uf_crm, 
	rpad(CASE WHEN to_char(c.ie_vinculo_medico)=3 THEN 'N'  ELSE 'S' END ,1,' ') tp_preceptor, 
	rpad(CASE WHEN to_char(c.ie_vinculo_medico)=3 THEN 'S'  ELSE 'N' END ,1,' ') tp_residente, 
	rpad(' ',14,' ') nu_cnpj_det_vinc, 
	a.cd_pessoa_fisica, 
	1 tp_registro, 
	b.dt_admissao dt_entrada, 
	a.cd_pessoa_fisica||'1' nm_paciente 
FROM medico b, pessoa_fisica a, pessoa_fisica_cnes c
LEFT OUTER JOIN pessoa_juridica d ON (c.cd_cnpj_estabelecimento = d.cd_cgc)
WHERE a.cd_pessoa_fisica	= b.cd_pessoa_fisica and a.cd_pessoa_fisica	= c.cd_pessoa_fisica  order by 
	cd_pessoa_fisica, 
	tp_registro;

