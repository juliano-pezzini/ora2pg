-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW export_psm_xml ("ns3:behoerdennr", "ns3:aktiverolle", "ns3:client", "ns3:workflowinforequest", "ns3:sourcesystem", "ns3:zeitpunkt", "ns3:organisation", "ns3:benutzer", "ns3:entitystatus", typ, vollername, staatscode, staatsname, postleitzahl, gemeinde, gemeindekennziffer, strassenname, orientierungsnummer, wohnsitzqualitaet, adressregistereintrag, "ns3:code", geschlecht, geburtsdatum, geburtsort, geburtsstaat, "ns2:geburtsgkz", "ns2:geburtsstaatcode", mothervorname, motherfamilienname, motherfamilienstand, mothergeburtsdatum, mothergeburtsort, motherstaatsnamede, "ns3:bekenntnis", "ns3:bekenntnisbezeichnug", motherpostleitzahl, motherortschaft, motherstrassenname, motherorientierungsnummer, motherwohnsitzqualitaet, motheradressregistereintrag, fathervorname, fatherfamilienname, fathergeburtsdatum, fathergeburtsort, staatsnamede, fatherpostleitzahl, fatherortschaft, fatherstrassenname, fatherorientierungsnummer, fatherwohnsitzqualitaet, fatheradressregistereintrag, "ns3:anonymgeburt", "ns3:mehrlingsgeburt", "ns3:mehrlingsgeburtvon", "ns3:mehrlingsgeburtbis", anonymousstaatscode, anonymousstaatsname, anonymouspostleitzahl, anonymousgemeinde, anonymousgemeindekennziffer, anonymousstrassenname, anonymousorientierungsnummer, anonymouswohnsitzqualitaet, anonymousadressregistereintrag, "ns3:zeit", "ns3:anzeigegeburtmedencoded", nr_atendimento) AS SELECT
    mdb.nr_customer_number        						ns3:BehoerdenNr,
    mdb.ds_role                 						ns3:AktiveRolle,
    mdb.ds_client               						ns3:Client,
    '?'                                                 ns3:WorkflowInfoRequest,
    mdb.ds_system               						ns3:SourceSystem,
    '' 					    							ns3:Zeitpunkt,
    '' 				    								ns3:Organisation,
    mdb.ds_user                 						ns3:Benutzer,
    mdb.ie_entity_status        						ns3:EntityStatus,
    mdb.nm_indicator_type       						typ,
    mdb.nm_hospital_name        						vollerName,
    mdb.cd_country_code         						staatscode,
    mdb.ds_state                						staatsname,
    mdb.cd_postal_code          						postleitzahl,
    mdb.ds_city                 						gemeinde,
    mdb.cd_community_code       						gemeindekennziffer,
    mdb.ds_street_name          						strassenname,
    mdb.nr_street_number        						orientierungsnummer,
    mdb.ds_locality             						wohnsitzqualitaet,
    ''                                                  AdressRegisterEintrag,
    mdb.cd_clinic_code          						ns3:Code,
    psm.ie_sexo                 						geschlecht,
    psm.dt_child_dob            						geburtsdatum,
    psm.nm_child_pob            						geburtsort,
    mdb.ds_state										geburtsstaat,            
    mdb.cd_community_code								ns2:GeburtsGKZ,           
    mdb.cd_country_code									ns2:Geburtsstaatcode,     

    (select PERSON_NAME_OF_FML(nr_seq_person_name, 'FN') FROM pessoa_fisica where cd_pessoa_fisica = cd_mother_ref) "motherVorname",
    (select PERSON_NAME_OF_FML(nr_seq_person_name, 'LN') from pessoa_fisica where cd_pessoa_fisica = cd_mother_ref) "motherFamilienname",
    (select OBTER_VALOR_DOMINIO_IDIOMA(10284,psm.IE_MOTHER_MARITAL_STATUS,5) )      "motherFamilienstand",
    psm.dt_mother_dob           						"motherGeburtsdatum",
    psm.nm_mother_pob           						"motherGeburtsort",
    psm.ds_mother_nationality   						"motherStaatsnamede",
    obter_dados_pf(cd_mother_ref, 'R') 					"ns3:Bekenntnis",           
    obter_dados_pf(cd_mother_ref, 'R') 					"ns3:BekenntnisBezeichnug", 
    obter_dados_pf_pj(cd_mother_ref, null,'CEP') 		"motherPostleitzahl",
    obter_dados_pf_pj(cd_mother_ref, null,'DSM') 		"motherOrtschaft",
    obter_dados_pf_pj(cd_mother_ref, null,'ESC') 		"motherStrassenname",
    obter_dados_pf_pj(cd_mother_ref, null,'NREND') 		"motherOrientierungsnummer",            
    'H' 		                                        "motherWohnsitzqualitaet",
    '' 		                                            "motherAdressregistereintrag",          

    (select PERSON_NAME_OF_FML(nr_seq_person_name, 'FN') from pessoa_fisica where cd_pessoa_fisica = cd_father_ref) "fatherVorname",
    (select PERSON_NAME_OF_FML(nr_seq_person_name, 'LN') from pessoa_fisica where cd_pessoa_fisica = cd_father_ref) "fatherFamilienname",
    psm.dt_father_dob           						"fatherGeburtsdatum",
    psm.nm_father_pob           						"fatherGeburtsort",
    psm.ds_father_nationality   						"StaatsnameDE",
    obter_dados_pf_pj(cd_father_ref, null,'CEP') 		"fatherPostleitzahl",
    obter_dados_pf_pj(cd_father_ref, null,'DSM') 		"fatherOrtschaft",
    obter_dados_pf_pj(cd_father_ref, null,'ESC') 		"fatherStrassenname",
    obter_dados_pf_pj(cd_father_ref, null,'NREND') 		"fatherOrientierungsnummer",
    'H' 		                                        "fatherWohnsitzqualitaet",
    '' 		                                            "fatherAdressregistereintrag",      
    'E' 												"ns3:Anonymgeburt",
    'N' 												"ns3:Mehrlingsgeburt",
    '0' 												"ns3:MehrlingsgeburtVon",
    '0' 												"ns3:MehrlingsgeburtBis",
    mdb.cd_country_code									"anonymousStaatscode",     
    mdb.ds_state    									"anonymousStaatsname",
    mdb.cd_postal_code									"anonymousPostleitzahl",
    mdb.ds_city 										"anonymousGemeinde",
    mdb.cd_community_code 								"anonymousGemeindekennziffer",
    mdb.ds_street_name 									"anonymousStrassenname",
    mdb.nr_street_number 								"anonymousOrientierungsnummer",
    'H' 												"anonymousWohnsitzqualitaet",
    '' 									    			"anonymousAdressRegisterEintrag",   
    coalesce(to_char( DT_CHILD_DOB, 'HH24:MI:SS' ), '')		"ns3:Zeit",                           
    '' 												    "ns3:AnzeigeGeburtMedEncoded",
    psm.nr_atendimento 
FROM
    epc_psm_data           psm
    INNER JOIN atendimento_paciente   ap ON psm.nr_atendimento = ap.nr_atendimento
    INNER JOIN master_data_birth      mdb ON mdb.cd_estabelecimento = ap.cd_estabelecimento;

