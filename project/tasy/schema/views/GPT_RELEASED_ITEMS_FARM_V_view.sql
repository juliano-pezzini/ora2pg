-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW gpt_released_items_farm_v (nr_prescricao, nr_seq_cpoe, ie_item_type, table_name, nr_atendimento, cd_pessoa_fisica, inactivate, cd_funcao_origem) AS select distinct
	   nr_prescricao,
	   nr_seq_cpoe,
	   ie_item_type,
	   table_name,
	   nr_atendimento,
	   cd_pessoa_fisica,
	   dt_suspensao inactivate,
	   cd_funcao_origem
FROM (
select distinct --MEDICINE
	   b.nr_prescricao,
	   a.nr_seq_mat_cpoe nr_seq_cpoe,
	   'M' ie_item_type,
	   'CPOE_MATERIAL' table_name,
	   b.nr_atendimento,
	   b.cd_pessoa_fisica,
	   b.dt_suspensao,
	   b.cd_funcao_origem
from   prescr_material a,
	   prescr_medica b,
	   cpoe_material c
where  b.nr_prescricao = a.nr_prescricao
and	   b.nr_atendimento = c.nr_atendimento
and    c.nr_sequencia = a.nr_seq_mat_cpoe
and	   a.ie_agrupador = 1
and    coalesce(c.ie_controle_tempo,'N') = 'N'
and    coalesce(c.ie_material,'N') = 'N'
and    a.nr_seq_mat_cpoe is not null
and	   b.cd_funcao_origem not in (924,950)
and	   b.dt_liberacao is not null -- Nurse submitted
and    b.dt_liberacao_farmacia is not null -- Pharmacy submitted
and    (b.dt_suspensao is null AND c.dt_suspensao is null)

union all

select distinct --MATERIAL
	   b.nr_prescricao,
	   a.nr_seq_mat_cpoe nr_seq_cpoe,
	   'MAT' ie_item_type,
	   'CPOE_MATERIAL' table_name,
	   b.nr_atendimento,
	   b.cd_pessoa_fisica,
	   b.dt_suspensao,
	   b.cd_funcao_origem
from   prescr_material a,
	   prescr_medica b,
	   cpoe_material c
where  b.nr_prescricao = a.nr_prescricao
and	   b.nr_atendimento = c.nr_atendimento
and    c.nr_sequencia = a.nr_seq_mat_cpoe
and	   a.ie_agrupador = 2
and    a.nr_seq_mat_cpoe is not null
and	   b.cd_funcao_origem not in (924,950)
and	   b.dt_liberacao is not null -- Nurse submitted
and    b.dt_liberacao_farmacia is not null -- Pharmacy submitted
and    (b.dt_suspensao is null AND c.dt_suspensao is null)

union all

select distinct  --INFUSION
	   b.nr_prescricao,
	   a.nr_seq_mat_cpoe nr_seq_cpoe,
	   'SOL' ie_item_type,
	   'CPOE_MATERIAL' table_name,
	   b.nr_atendimento,
	   b.cd_pessoa_fisica,
	   b.dt_suspensao,
	   b.cd_funcao_origem
from   prescr_material a,
	   prescr_medica b,
	   cpoe_material c,
	   prescr_solucao d
where  b.nr_prescricao = a.nr_prescricao
and    d.nr_prescricao = a.nr_prescricao
and	   b.nr_atendimento = c.nr_atendimento
and    c.nr_sequencia = a.nr_seq_mat_cpoe
and	   ie_agrupador = 4
and    coalesce(c.ie_controle_tempo,'N') = 'S'
and    a.nr_seq_mat_cpoe is not null
and	   b.cd_funcao_origem not in (924,950)
and	   b.dt_liberacao is not null -- Nurse submitted
and    b.dt_liberacao_farmacia is not null -- Pharmacy submitted
and    (b.dt_suspensao is null AND c.dt_suspensao is null)

union all

select distinct --PROCEDURE
	   b.nr_prescricao,
	   a.nr_seq_proc_cpoe nr_seq_cpoe,
	   'P' ie_item_type,
	   'CPOE_PROCEDIMENTO' table_name,
	   b.nr_atendimento,
	   b.cd_pessoa_fisica,
	   b.dt_suspensao,
	   b.cd_funcao_origem
from   prescr_procedimento a,
	   prescr_medica b,
	   cpoe_procedimento c
where  b.nr_prescricao = a.nr_prescricao
and	   b.nr_atendimento = c.nr_atendimento
and    c.nr_sequencia = a.nr_seq_proc_cpoe
and    a.nr_seq_proc_cpoe is not null
and	   b.cd_funcao_origem not in (924,950)
and	   b.dt_liberacao is not null -- Nurse submitted
and    b.dt_liberacao_farmacia is not null -- Pharmacy submitted
and    (b.dt_suspensao is null AND c.dt_suspensao is null)

union all

select distinct --HEMOTHERAPY
	   b.nr_prescricao,
	   a.nr_seq_hemo_cpoe nr_seq_cpoe,
	   'HM' ie_item_type,
	   'CPOE_HEMOTERAPIA' table_name,
	   b.nr_atendimento,
	   b.cd_pessoa_fisica,
	   b.dt_suspensao,
	   b.cd_funcao_origem
from   prescr_solic_bco_sangue a,
	   prescr_medica b,
	   cpoe_hemoterapia c
where  b.nr_prescricao = a.nr_prescricao
and	   b.nr_atendimento = c.nr_atendimento
and    c.nr_sequencia = a.nr_seq_hemo_cpoe
and    a.nr_seq_hemo_cpoe is not null
and	   b.cd_funcao_origem not in (924,950)
and	   b.dt_liberacao is not null -- Nurse submitted
and    b.dt_liberacao_farmacia is not null -- Pharmacy submitted
and    (b.dt_suspensao is null AND c.dt_suspensao is null)

union all

select distinct --PATH_ANATOMY
	   b.nr_prescricao,
	   a.nr_seq_proc_cpoe nr_seq_cpoe,
	   'AP' ie_item_type,
	   'CPOE_ANATOMIA_PATOLOGICA' table_name,
	   b.nr_atendimento,
	   b.cd_pessoa_fisica,
	   b.dt_suspensao,
	   b.cd_funcao_origem
from   prescr_procedimento a,
	   prescr_medica b,
	   cpoe_anatomia_patologica c
where  b.nr_prescricao = a.nr_prescricao
and	   b.nr_atendimento = c.nr_atendimento
and    c.nr_sequencia = a.nr_seq_proc_cpoe
and    a.ie_tipo_proced = 'AP'
and    a.nr_seq_proc_cpoe is not null
and	   b.cd_funcao_origem not in (924,950)
and	   b.dt_liberacao is not null -- Nurse submitted
and    b.dt_liberacao_farmacia is not null -- Pharmacy submitted
and    (b.dt_suspensao is null AND c.dt_suspensao is null)

union all

select distinct --GAS_THERAPY
	   b.nr_prescricao,
	   a.nr_seq_gas_cpoe nr_seq_cpoe,
	   'O' ie_item_type,
	   'CPOE_GASOTERAPIA' table_name,
	   b.nr_atendimento,
	   b.cd_pessoa_fisica,
	   b.dt_suspensao,
	   b.cd_funcao_origem
from   prescr_gasoterapia a,
	   prescr_medica b,
	   cpoe_gasoterapia c
where  b.nr_prescricao = a.nr_prescricao
and	   b.nr_atendimento = c.nr_atendimento
and    c.nr_sequencia = a.nr_seq_gas_cpoe
and    a.nr_seq_gas_cpoe is not null
and	   b.cd_funcao_origem not in (924,950)
and	   b.dt_liberacao is not null -- Nurse submitted
and    b.dt_liberacao_farmacia is not null -- Pharmacy submitted
and    (b.dt_suspensao is null AND c.dt_suspensao is null)

union all

select distinct --RECOMMENDATION
	   b.nr_prescricao,
	   a.nr_seq_rec_cpoe nr_seq_cpoe,
	   'R' ie_item_type,
	   'CPOE_RECOMENDACAO' table_name,
	   b.nr_atendimento,
	   b.cd_pessoa_fisica,
	   b.dt_suspensao,
	   b.cd_funcao_origem
from   prescr_recomendacao a,
	   prescr_medica b,
	   cpoe_recomendacao c
where  b.nr_prescricao = a.nr_prescricao
and	   b.nr_atendimento = c.nr_atendimento
and    c.nr_sequencia = a.nr_seq_rec_cpoe
and    a.nr_seq_rec_cpoe is not null
and	   b.cd_funcao_origem not in (924,950)
and	   b.dt_liberacao is not null -- Nurse submitted
and    b.dt_liberacao_farmacia is not null -- Pharmacy submitted
and    (b.dt_suspensao is null AND c.dt_suspensao is null)

union all

select distinct --ORAL_NUTRITION
	   b.nr_prescricao,
	   a.nr_seq_dieta_cpoe nr_seq_cpoe,
	   'D' ie_item_type,
	   'CPOE_DIETA' table_name,
	   b.nr_atendimento,
	   b.cd_pessoa_fisica,
	   b.dt_suspensao,
	   b.cd_funcao_origem
from   prescr_dieta a,
	   prescr_medica b,
	   cpoe_dieta c
where  b.nr_prescricao = a.nr_prescricao
and	   b.nr_atendimento = c.nr_atendimento
and    c.nr_sequencia = a.nr_seq_dieta_cpoe
and    a.nr_seq_dieta_cpoe is not null
and	   b.cd_funcao_origem not in (924,950)
and	   b.dt_liberacao is not null -- Nurse submitted
and    b.dt_liberacao_farmacia is not null -- Pharmacy submitted
and    (b.dt_suspensao is null AND c.dt_suspensao is null)

union all

select distinct --FAST_NUTRITION
	   b.nr_prescricao,
	   a.nr_seq_dieta_cpoe nr_seq_cpoe,
	   'J' ie_item_type,
	   'CPOE_DIETA' table_name,
	   b.nr_atendimento,
	   b.cd_pessoa_fisica,
	   b.dt_suspensao,
	   b.cd_funcao_origem
from   rep_jejum a,
	   prescr_medica b,
	   cpoe_dieta c
where  b.nr_prescricao = a.nr_prescricao
and	   b.nr_atendimento = c.nr_atendimento
and    c.nr_sequencia = a.nr_seq_dieta_cpoe
and    a.nr_seq_dieta_cpoe is not null
and	   b.cd_funcao_origem not in (924,950)
and	   b.dt_liberacao is not null -- Nurse submitted
and    b.dt_liberacao_farmacia is not null -- Pharmacy submitted
and    (b.dt_suspensao is null AND c.dt_suspensao is null)

union all

select distinct --ENTERAL_NUTRITION
	   b.nr_prescricao,
	   a.nr_seq_dieta_cpoe nr_seq_cpoe,
	   'SNE' ie_item_type,
	   'CPOE_DIETA' table_name,
	   b.nr_atendimento,
	   b.cd_pessoa_fisica,
	   b.dt_suspensao,
	   b.cd_funcao_origem
from   prescr_material a,
	   prescr_medica b,
	   cpoe_dieta c
where  b.nr_prescricao = a.nr_prescricao
and	   b.nr_atendimento = c.nr_atendimento
and    c.nr_sequencia = a.nr_seq_dieta_cpoe
and	   a.ie_agrupador = 8
and    a.nr_seq_dieta_cpoe is not null
and	   b.cd_funcao_origem not in (924,950)
and	   b.dt_liberacao is not null -- Nurse submitted
and    b.dt_liberacao_farmacia is not null -- Pharmacy submitted
and    (b.dt_suspensao is null AND c.dt_suspensao is null)

union all

select distinct --SUPL_NUTRITION
	   b.nr_prescricao,
	   a.nr_seq_dieta_cpoe nr_seq_cpoe,
	   'S' ie_item_type,
	   'CPOE_DIETA' table_name,
	   b.nr_atendimento,
	   b.cd_pessoa_fisica,
	   b.dt_suspensao,
	   b.cd_funcao_origem
from   prescr_material a,
	   prescr_medica b,
	   cpoe_dieta c
where  b.nr_prescricao = a.nr_prescricao
and	   b.nr_atendimento = c.nr_atendimento
and    c.nr_sequencia = a.nr_seq_dieta_cpoe
and	   a.ie_agrupador = 12
and    a.nr_seq_dieta_cpoe is not null
and	   b.cd_funcao_origem not in (924,950)
and	   b.dt_liberacao is not null -- Nurse submitted
and    b.dt_liberacao_farmacia is not null -- Pharmacy submitted
and    (b.dt_suspensao is null AND c.dt_suspensao is null)

union all

select distinct --MILK_NUTRITION
	   b.nr_prescricao,
	   a.nr_seq_dieta_cpoe nr_seq_cpoe,
	   'LD' ie_item_type,
	   'CPOE_DIETA' table_name,
	   b.nr_atendimento,
	   b.cd_pessoa_fisica,
	   b.dt_suspensao,
	   b.cd_funcao_origem
from   prescr_leite_deriv a,
	   prescr_medica b,
	   cpoe_dieta c
where  b.nr_prescricao = a.nr_prescricao
and	   b.nr_atendimento = c.nr_atendimento
and    c.nr_sequencia = a.nr_seq_dieta_cpoe
--and	   ie_agrupador = 16

and    a.nr_seq_dieta_cpoe is not null
and	   b.cd_funcao_origem not in (924,950)
and	   b.dt_liberacao is not null -- Nurse submitted
and    b.dt_liberacao_farmacia is not null -- Pharmacy submitted
and    (b.dt_suspensao is null AND c.dt_suspensao is null)

union all

select distinct --NPT_A_NUTRITION
	   b.nr_prescricao,
	   a.nr_seq_npt_cpoe nr_seq_cpoe,
	   'NPTA' ie_item_type,
	   'CPOE_DIETA' table_name,
	   b.nr_atendimento,
	   b.cd_pessoa_fisica,
	   b.dt_suspensao,
	   b.cd_funcao_origem
from   nut_pac a,
	   prescr_medica b,
	   cpoe_dieta c
where  b.nr_prescricao = a.nr_prescricao
and    b.nr_atendimento = c.nr_atendimento
and    c.nr_sequencia = a.nr_seq_npt_cpoe
and    c.ie_tipo_dieta = 'P'
and    a.nr_seq_npt_cpoe is not null
and	   b.cd_funcao_origem not in (924,950)
and	   b.dt_liberacao is not null -- Nurse submitted
and    b.dt_liberacao_farmacia is not null -- Pharmacy submitted
and    (b.dt_suspensao is null AND c.dt_suspensao is null)

union all

select distinct --NPT_I_NUTRITION
	   b.nr_prescricao,
	   a.nr_seq_npt_cpoe nr_seq_cpoe,
	   'NPTI' ie_item_type,
	   'CPOE_DIETA' table_name,
	   b.nr_atendimento,
	   b.cd_pessoa_fisica,
	   b.dt_suspensao,
	   b.cd_funcao_origem
from   nut_pac a,
	   prescr_medica b,
	   cpoe_dieta c
where  b.nr_prescricao = a.nr_prescricao
and    b.nr_atendimento = c.nr_atendimento
and    c.nr_sequencia = a.nr_seq_npt_cpoe
and    c.ie_tipo_dieta = 'I'
and    a.nr_seq_npt_cpoe is not null
and	   b.cd_funcao_origem not in (924,950)
and	   b.dt_liberacao is not null -- Nurse submitted
and    b.dt_liberacao_farmacia is not null -- Pharmacy submitted
and    (b.dt_suspensao is null AND c.dt_suspensao is null)

union all

select distinct --DIALYSIS
	   b.nr_prescricao,
	   a.nr_seq_dialise_cpoe nr_seq_cpoe,
	   'DI' ie_item_type,
	   'CPOE_DIALISE' table_name,
	   b.nr_atendimento,
	   b.cd_pessoa_fisica,
	   b.dt_suspensao,
	   b.cd_funcao_origem
from   hd_prescricao a,
	   prescr_medica b,
	   cpoe_dialise c
where  b.nr_prescricao = a.nr_prescricao
and	   b.nr_atendimento = c.nr_atendimento
and    c.nr_sequencia = a.nr_seq_dialise_cpoe
and    c.ie_tipo_dialise = 'DI'
and    a.nr_seq_dialise_cpoe is not null
and	   b.cd_funcao_origem not in (924,950)
and	   b.dt_liberacao is not null -- Nurse submitted
and    b.dt_liberacao_farmacia is not null -- Pharmacy submitted
and    (b.dt_suspensao is null AND c.dt_suspensao is null)

union all

select distinct --PERITONEAL_DIAL
	   b.nr_prescricao,
	   a.nr_seq_dialise_cpoe nr_seq_cpoe,
	   'DP' ie_item_type,
	   'CPOE_DIALISE' table_name,
	   b.nr_atendimento,
	   b.cd_pessoa_fisica,
	   b.dt_suspensao,
	   b.cd_funcao_origem
from   hd_prescricao a,
	   prescr_medica b,
	   cpoe_dialise c
where  b.nr_prescricao = a.nr_prescricao
and	   b.nr_atendimento = c.nr_atendimento
and    c.nr_sequencia = a.nr_seq_dialise_cpoe
and    c.ie_tipo_dialise = 'DP'
and    a.nr_seq_dialise_cpoe is not null
and	   b.cd_funcao_origem not in (924,950)
and	   b.dt_liberacao is not null -- Nurse submitted
and    b.dt_liberacao_farmacia is not null -- Pharmacy submitted
and    (b.dt_suspensao is null AND c.dt_suspensao is null)
) alias37;

