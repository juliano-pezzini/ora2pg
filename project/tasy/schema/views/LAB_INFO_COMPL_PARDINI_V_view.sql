-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW lab_info_compl_pardini_v (volumediurese_p, tempodiurese_p, cd_estabelecimento, qt_peso, qt_altura_cm, ds_campo, nr_prescricao, nr_seq_lote_externo, nr_seq_exame, nr_seq_material, tempo_amostra, peso_amostra, generico, ie_novo_pardini, ie_generico) AS select  distinct
	t.VolumeDiurese_p,
	t.TempoDiurese_p,
	t.cD_estabelecimento,
	t.qt_peso,
	t.qt_altura_cm,
	t.ds_campo,
	t.nr_prescricao,
	t.nr_seq_lote_externo,
	t.nr_seq_exame,
	t.nr_seq_material,
	t.tempo_amostra,
	t.peso_amostra,
	t.generico,
	z.ie_integ_hist_saude ie_novo_pardini,
  t.ie_generico
FROM(
select 	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1) END  VolumeDiurese_p,	
	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2) END  TempoDiurese_p,
	e.nr_sequencia nr_seq_proc_material,
	d.cd_estabelecimento,
	d.qt_peso,
	d.qt_altura_cm,
	'VolumeDiurese' ds_campo,
	a.nr_prescricao,
	a.nr_seq_lote_externo,
	a.nr_seq_exame,
	b.nr_sequencia nr_seq_material,
	(e.qt_tempo|| ':'|| e.qt_minuto ) tempo_amostra,
	e.qt_peso peso_amostra,
	null generico,
  null ie_generico
from   	prescr_procedimento a,
	exame_laboratorio c,
	material_exame_lab b,
	exame_lab_material f,
	prescr_medica	d,
	prescr_proc_material e
where  	f.nr_Seq_material = b.nr_sequencia
AND	f.nr_Seq_exame =  a.nr_seq_exame
and	b.nr_sequencia = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
and	a.nr_prescricao	= d.nr_prescricao
and	c.nr_seq_exame = a.nr_seq_exame
and	e.nr_seq_material = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
AND	e.nr_prescricao  =  a.nr_prescricao
and	CASE WHEN e.nr_Seq_grupo=0 THEN c.nr_seq_grupo  ELSE e.nr_Seq_grupo END 	  = c.nr_seq_grupo
and	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1) END  is not null	
and	f.qt_coleta > 1

union all

SELECT 	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1) END  VolumeDiurese_p,	
	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2) END  TempoDiurese_p,
	0 nr_seq_proc_material,
	d.cd_estabelecimento,
	d.qt_peso,
	d.qt_altura_cm,
	'VolumeDiurese' ds_campo,
	a.nr_prescricao,
	a.nr_seq_lote_externo,
	a.nr_seq_exame,
	b.nr_sequencia nr_seq_material,
	('00' || ':'||'00' ) tempo_amostra,
	0 peso_amostra,
	null generico,
  null ie_generico
FROM   	prescr_procedimento a,
	exame_laboratorio c,
	material_exame_lab b,
	exame_lab_material f,
	prescr_medica	d
WHERE  	b.nr_sequencia = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
AND	f.nr_seq_exame	= c.nr_seq_exame
AND	f.nr_seq_material = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
AND	a.nr_prescricao	= d.nr_prescricao
AND	c.nr_seq_exame = a.nr_seq_exame
AND	coalesce(f.qt_coleta,0)  <= 1
and	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1) END  is not null

union all

select 	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1) END  VolumeDiurese_p,	
	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2) END  TempoDiurese_p,
	e.nr_sequencia nr_seq_proc_material,
	d.cd_estabelecimento,
	d.qt_peso,
	d.qt_altura_cm,
	'TempoDiurese' ds_campo,
	a.nr_prescricao,
	a.nr_seq_lote_externo,
	a.nr_seq_exame,
	b.nr_sequencia nr_seq_material,
	(e.qt_tempo|| ':'|| e.qt_minuto ) tempo_amostra,
	e.qt_peso peso_amostra,
	null generico,
  null ie_generico
from   	prescr_procedimento a,
	exame_laboratorio c,
	material_exame_lab b,
	exame_lab_material f,
	prescr_medica	d,
	prescr_proc_material e
where  	f.nr_Seq_material = b.nr_sequencia
AND	f.nr_Seq_exame =  a.nr_seq_exame
and	b.nr_sequencia = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
and	a.nr_prescricao	= d.nr_prescricao
and	c.nr_seq_exame = a.nr_seq_exame
and	e.nr_seq_material = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
AND	e.nr_prescricao  =  a.nr_prescricao
and	CASE WHEN e.nr_Seq_grupo=0 THEN c.nr_seq_grupo  ELSE e.nr_Seq_grupo END 	  = c.nr_seq_grupo
and	f.qt_coleta > 1
and	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2) END is not null

union all

SELECT CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1) END  VolumeDiurese_p,	
	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2) END  TempoDiurese_p,
	0 nr_seq_proc_material,
	d.cd_estabelecimento,
	d.qt_peso,
	d.qt_altura_cm,
	'TempoDiurese' ds_campo,
	a.nr_prescricao,
	a.nr_seq_lote_externo,
	a.nr_seq_exame,
	b.nr_sequencia nr_seq_material,
	('00' || ':'||'00' ) tempo_amostra,
	0 peso_amostra,
	null generico,
  null ie_generico
FROM   	prescr_procedimento a,
	exame_laboratorio c,
	material_exame_lab b,
	exame_lab_material f,
	prescr_medica	d
WHERE  	b.nr_sequencia = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
AND	f.nr_seq_exame	= c.nr_seq_exame
AND	f.nr_seq_material = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
AND	a.nr_prescricao	= d.nr_prescricao
AND	c.nr_seq_exame = a.nr_seq_exame
AND	coalesce(f.qt_coleta,0)  <= 1
and	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2) END is not null

union all

select 
	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1) END  VolumeDiurese_p,	
	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2) END  TempoDiurese_p,
	e.nr_sequencia nr_seq_proc_material,
	d.cd_estabelecimento,
	d.qt_peso,
	d.qt_altura_cm,
	'Peso' ds_campo,
	a.nr_prescricao,
	a.nr_seq_lote_externo,
	a.nr_seq_exame,
	b.nr_sequencia nr_seq_material,
	(e.qt_tempo|| ':'|| e.qt_minuto ) tempo_amostra,
	e.qt_peso peso_amostra,
	null generico,
  null ie_generico
from   	prescr_procedimento a,
	exame_laboratorio c,
	material_exame_lab b,
	exame_lab_material f,
	prescr_medica	d,
	prescr_proc_material e
where  	f.nr_Seq_material = b.nr_sequencia
AND	f.nr_Seq_exame =  a.nr_seq_exame
and	b.nr_sequencia = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
and	a.nr_prescricao	= d.nr_prescricao
and	c.nr_seq_exame = a.nr_seq_exame
and	e.nr_seq_material = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
AND	e.nr_prescricao  =  a.nr_prescricao
and	CASE WHEN e.nr_Seq_grupo=0 THEN c.nr_seq_grupo  ELSE e.nr_Seq_grupo END 	  = c.nr_seq_grupo
and	f.qt_coleta > 1
and	d.qt_peso is not null

union all

SELECT 	
	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1) END  VolumeDiurese_p,	
	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2) END  TempoDiurese_p,
	0 nr_seq_proc_material,
	d.cd_estabelecimento,
	d.qt_peso,
	d.qt_altura_cm,
	'Peso' ds_campo,
	a.nr_prescricao,
	a.nr_seq_lote_externo,
	a.nr_seq_exame,
	b.nr_sequencia nr_seq_material,
	('00' || ':'||'00' ) tempo_amostra,
	0 peso_amostra,
	null generico,
  null ie_generico
FROM   	prescr_procedimento a,
	exame_laboratorio c,
	material_exame_lab b,
	exame_lab_material f,
	prescr_medica	d
WHERE  	b.nr_sequencia = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
AND	f.nr_seq_exame	= c.nr_seq_exame
AND	f.nr_seq_material = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
AND	a.nr_prescricao	= d.nr_prescricao
AND	c.nr_seq_exame = a.nr_seq_exame
AND	coalesce(f.qt_coleta,0)  <= 1
and	d.qt_peso is not null

union all

select 	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1) END  VolumeDiurese_p,	
	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2) END  TempoDiurese_p,
	e.nr_sequencia nr_seq_proc_material,
	d.cd_estabelecimento,
	d.qt_peso,
	d.qt_altura_cm,
	'Altura' ds_campo,
	a.nr_prescricao,
	a.nr_seq_lote_externo,
	a.nr_seq_exame,
	b.nr_sequencia nr_seq_material,
	(e.qt_tempo|| ':'|| e.qt_minuto ) tempo_amostra,
	e.qt_peso peso_amostra,
	null generico,
  null ie_generico
from   	prescr_procedimento a,
	exame_laboratorio c,
	material_exame_lab b,
	exame_lab_material f,
	prescr_medica	d,
	prescr_proc_material e
where  	f.nr_Seq_material = b.nr_sequencia
AND	f.nr_Seq_exame =  a.nr_seq_exame
and	b.nr_sequencia = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
and	a.nr_prescricao	= d.nr_prescricao
and	c.nr_seq_exame = a.nr_seq_exame
and	e.nr_seq_material = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
AND	e.nr_prescricao  =  a.nr_prescricao
and	CASE WHEN e.nr_Seq_grupo=0 THEN c.nr_seq_grupo  ELSE e.nr_Seq_grupo END 	  = c.nr_seq_grupo
and	f.qt_coleta > 1
and	d.qt_altura_cm is not null

union all

SELECT CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1) END  VolumeDiurese_p,	
	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2) END  TempoDiurese_p,
	0 nr_seq_proc_material,
	d.cd_estabelecimento,
	d.qt_peso,
	d.qt_altura_cm,
	'Altura' ds_campo,
	a.nr_prescricao,
	a.nr_seq_lote_externo,
	a.nr_seq_exame,
	b.nr_sequencia nr_seq_material,
	('00' || ':'||'00' ) tempo_amostra,
	0 peso_amostra,
	null generico,
  null ie_generico
FROM   	prescr_procedimento a,
	exame_laboratorio c,
	material_exame_lab b,
	exame_lab_material f,
	prescr_medica	d
WHERE  	b.nr_sequencia = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
AND	f.nr_seq_exame	= c.nr_seq_exame
AND	f.nr_seq_material = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
AND	a.nr_prescricao	= d.nr_prescricao
AND	c.nr_seq_exame = a.nr_seq_exame
AND	coalesce(f.qt_coleta,0)  <= 1
and	d.qt_altura_cm is not null

union all

select 	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1) END  VolumeDiurese_p,	
	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2) END  TempoDiurese_p,
	e.nr_sequencia nr_seq_proc_material,
	d.cd_estabelecimento,
	d.qt_peso,
	d.qt_altura_cm,
	'TempoAmostra' ds_campo,
	a.nr_prescricao,
	a.nr_seq_lote_externo,
	a.nr_seq_exame,
	b.nr_sequencia nr_seq_material,
	(e.qt_tempo|| ':'|| e.qt_minuto ) tempo_amostra,
	e.qt_peso peso_amostra,
	null generico,
  null ie_generico
from   	prescr_procedimento a,
	exame_laboratorio c,
	material_exame_lab b,
	exame_lab_material f,
	prescr_medica	d,
	prescr_proc_material e
where  	f.nr_Seq_material = b.nr_sequencia
AND	f.nr_Seq_exame =  a.nr_seq_exame
and	b.nr_sequencia = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
and	a.nr_prescricao	= d.nr_prescricao
and	c.nr_seq_exame = a.nr_seq_exame
and	e.nr_seq_material = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
AND	e.nr_prescricao  =  a.nr_prescricao
and	CASE WHEN e.nr_Seq_grupo=0 THEN c.nr_seq_grupo  ELSE e.nr_Seq_grupo END  = c.nr_seq_grupo
and	f.qt_coleta > 1
and (e.qt_tempo is not null or e.qt_minuto is not null)

union all

select 	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1) END  VolumeDiurese_p,	
	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2) END  TempoDiurese_p,
	0 nr_seq_proc_material,
	d.cd_estabelecimento,
	d.qt_peso,
	d.qt_altura_cm,
	'TempoAmostra' ds_campo,
	a.nr_prescricao,
	a.nr_seq_lote_externo,
	a.nr_seq_exame,
	b.nr_sequencia nr_seq_material,
  ('00' || ':'||'00' ) tempo_amostra,
  0 peso_amostra,
  null generico,
  null ie_generico
from   	prescr_procedimento a,
	exame_laboratorio c,
	material_exame_lab b,
	exame_lab_material f,
	prescr_medica	d
WHERE  	b.nr_sequencia = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
AND	f.nr_seq_exame	= c.nr_seq_exame
AND	f.nr_seq_material = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
AND	a.nr_prescricao	= d.nr_prescricao
AND	c.nr_seq_exame = a.nr_seq_exame
AND	coalesce(f.qt_coleta,0)  <= 1

union all

select 	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1) END  VolumeDiurese_p,	
	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2) END  TempoDiurese_p,
	e.nr_sequencia nr_seq_proc_material,
	d.cd_estabelecimento,
	d.qt_peso,
	d.qt_altura_cm,
	'PesoAmostra' ds_campo,
	a.nr_prescricao,
	a.nr_seq_lote_externo,
	a.nr_seq_exame,
	b.nr_sequencia nr_seq_material,
	(e.qt_tempo|| ':'|| e.qt_minuto ) tempo_amostra,
	e.qt_peso peso_amostra, 
	null generico,
  null ie_generico
from   	prescr_procedimento a,
	exame_laboratorio c,
	material_exame_lab b,
	exame_lab_material f,
	prescr_medica	d,
	prescr_proc_material e
where  	f.nr_Seq_material = b.nr_sequencia
AND	f.nr_Seq_exame =  a.nr_seq_exame
and	b.nr_sequencia = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
and	a.nr_prescricao	= d.nr_prescricao
and	c.nr_seq_exame = a.nr_seq_exame
and	e.nr_seq_material = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
AND	e.nr_prescricao  =  a.nr_prescricao
and	CASE WHEN e.nr_Seq_grupo=0 THEN c.nr_seq_grupo  ELSE e.nr_Seq_grupo END 	  = c.nr_seq_grupo
and	f.qt_coleta > 1
and	e.qt_peso is not null

union all

select 	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,1) END  VolumeDiurese_p,	
	CASE WHEN lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2)=0 THEN null  ELSE lab_obter_dados_amostra(a.nr_prescricao,b.nr_sequencia,c.nr_seq_grupo,2) END  TempoDiurese_p,
	0 nr_seq_proc_material,
	d.cd_estabelecimento,
	d.qt_peso,
	d.qt_altura_cm,
	'PesoAmostra' ds_campo,
	a.nr_prescricao,
	a.nr_seq_lote_externo,
	a.nr_seq_exame,
	b.nr_sequencia nr_seq_material,
  ('00' || ':'||'00' ) tempo_amostra,
  0 peso_amostra,
  null generico,
  null ie_generico
from   	prescr_procedimento a,
	exame_laboratorio c,
	material_exame_lab b,
	exame_lab_material f,
	prescr_medica	d
WHERE  	b.nr_sequencia = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
AND	f.nr_seq_exame	= c.nr_seq_exame
AND	f.nr_seq_material = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
AND	a.nr_prescricao	= d.nr_prescricao
AND	c.nr_seq_exame = a.nr_seq_exame
AND	coalesce(f.qt_coleta,0)  <= 1

union all

select 	null VolumeDiurese_p,	
	null TempoDiurese_p,
	e.nr_sequencia nr_seq_proc_material,
	d.cd_estabelecimento,
	null qt_peso,
	null qt_altura_cm,
	h.ds_tag ds_campo,
	a.nr_prescricao,
	a.nr_seq_lote_externo,
	a.nr_seq_exame,
	b.nr_sequencia nr_seq_material,
	null tempo_amostra,
	null peso_amostra,
	g.ds_valor generico,
  'S' ie_generico
from   	prescr_procedimento a,
	exame_laboratorio c,
	material_exame_lab b,
	exame_lab_material f,
	prescr_medica	d,
	prescr_proc_material e,
	lab_comple_pardini g,
	lab_tipo_comple_pardini h
where  	f.nr_Seq_material = b.nr_sequencia
AND	f.nr_Seq_exame =  a.nr_seq_exame
and	b.nr_sequencia = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
and	a.nr_prescricao	= d.nr_prescricao
and	c.nr_seq_exame = a.nr_seq_exame
and	e.nr_seq_material = Obter_Mat_Exame_Lab_prescr(a.nr_prescricao, a.nr_sequencia, 1)
AND	e.nr_prescricao  =  a.nr_prescricao
and	CASE WHEN e.nr_Seq_grupo=0 THEN c.nr_seq_grupo  ELSE e.nr_Seq_grupo END 	  = c.nr_seq_grupo
and g.nr_prescricao  =  a.nr_prescricao
and g.nr_seq_prescr = a.nr_sequencia	
and g.ds_valor is not null
and g.nr_tipo_comple_pardini = h.nr_sequencia
 ) t,
 lab_parametro z
 where   t.cd_estabelecimento = z.cd_estabelecimento;

