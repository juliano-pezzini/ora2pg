-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_prescricao_v (nr_sequencia, cd_estabelecimento, ie_periodo, dt_referencia, dt_atualizacao, nm_usuario, cd_setor_atendimento, cd_medico, qt_paciente, qt_prescricao, qt_prescr_em_tempo, qt_prescricao_atendida, qt_prescr_medico, qt_prescr_nao_medico, cd_setor_usuario, cd_cargo_prescritor, dt_atualizacao_nrec, nm_usuario_nrec, ie_tipo_atendimento, nm_usuario_original, nr_seq_forma_chegada, ie_motivo_prescricao, qt_prescr_fora_tempo, ie_inconsistencia_farm, ie_analisada_farm, ds_setor_usuario, ds_setor_atendimento, nm_medico, ds_data_refer, nr_paciente, nr_prescricao, nr_prescr_em_tempo, nr_prescr_fora_tempo, nr_prescr_tempo, nr_prescricao_atendida, nr_prescr_medico, nr_prescr_nao_medico, nr_total_prescr, ds_tipo_atendimento, cd_empresa, nm_pf_original, ds_tipo_evolucao, ie_tipo_evolucao, ds_motivo_prescricao, ds_agrupamento, nr_seq_agrupamento) AS SELECT	a.NR_SEQUENCIA,a.CD_ESTABELECIMENTO,a.IE_PERIODO,a.DT_REFERENCIA,a.DT_ATUALIZACAO,a.NM_USUARIO,a.CD_SETOR_ATENDIMENTO,a.CD_MEDICO,a.QT_PACIENTE,a.QT_PRESCRICAO,a.QT_PRESCR_EM_TEMPO,a.QT_PRESCRICAO_ATENDIDA,a.QT_PRESCR_MEDICO,a.QT_PRESCR_NAO_MEDICO,a.CD_SETOR_USUARIO,a.CD_CARGO_PRESCRITOR,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC,a.IE_TIPO_ATENDIMENTO,a.NM_USUARIO_ORIGINAL,a.NR_SEQ_FORMA_CHEGADA,a.IE_MOTIVO_PRESCRICAO,a.QT_PRESCR_FORA_TEMPO,a.IE_INCONSISTENCIA_FARM,a.IE_ANALISADA_FARM,
	SUBSTR(obter_nome_setor(a.cd_setor_usuario),1,200) ds_setor_usuario, 
	SUBSTR(obter_nome_setor(a.cd_setor_atendimento),1,200) ds_setor_atendimento, 
	SUBSTR(obter_nome_pessoa_fisica(a.cd_medico, NULL),1,200) nm_medico, 
	TO_CHAR(a.dt_referencia, 'dd/mm/yyyy') ds_data_refer, 
	a.qt_paciente nr_paciente, 
	a.QT_PRESCRICAO nr_PRESCRICAO, 
	a.QT_PRESCR_EM_TEMPO nr_PRESCR_EM_TEMPO, 
	a.QT_PRESCR_FORA_TEMPO nr_PRESCR_FORA_TEMPO, 
	(a.QT_PRESCR_EM_TEMPO + a.QT_PRESCR_FORA_TEMPO) nr_prescr_tempo, 
	a.QT_PRESCRICAO_ATENDIDA nr_PRESCRICAO_ATENDIDA, 
	a.QT_PRESCR_MEDICO NR_PRESCR_MEDICO, 
	a.QT_PRESCR_NAO_MEDICO nr_PRESCR_NAO_MEDICO, 
	(a.QT_PRESCR_MEDICO + a.QT_PRESCR_NAO_MEDICO) nr_total_prescr, 
	SUBSTR(obter_nome_tipo_atend(ie_tipo_atendimento),1,100) ds_tipo_atendimento, 
	obter_empresa_estab(a.cd_estabelecimento) cd_empresa, 
	SUBSTR(obter_nome_usuario(nm_usuario_original),1,100) nm_pf_original, 
	SUBSTR(obter_valor_dominio(72,ie_tipo_evolucao),1,100) ds_tipo_evolucao, 
	ie_tipo_evolucao, 
	SUBSTR(obter_valor_dominio(136,ie_motivo_prescricao),1,100) DS_MOTIVO_PRESCRICAO, 
	SUBSTR(Obter_desc_agrupamento_setor(a.cd_setor_atendimento),1,120) ds_agrupamento, 
	SUBSTR(Obter_agrup_setor(a.cd_setor_atendimento,'C'),1,50) nr_seq_agrupamento 
FROM	usuario b, 
	eis_prescricao a 
WHERE	a.nm_usuario_original = b.nm_usuario;

