-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW unimed_nacional_renaux_v (tp_registro, nr_seq, tp_reg, cd_uni_des, cd_uni_ori, dt_geracao, nr_comp, nr_fatura, dt_vem_fat, dt_emi_fat, vl_tot_fat, vl_tot_fat_liq, ds_reservado, vl_ajuste_fat, nr_ver_tra, nr_lote, nr_nota, tp_nota, cd_uni, id_benef, nm_benef, dt_atend, cd_excecao, tp_consulta, id_ambula, cd_cid, tp_paciente, cd_uni_hosp, cd_hosp, nm_hosp, tp_acomodacao, dt_internacao, dt_alta, ft_mult_amb, tp_admissao, tp_saida, cd_cgc_hospital, tp_internacao, tp_nascimento, cd_uni_pre, cd_prest, nm_prest, cd_cgc_cpf_prest, tp_particip, dt_servico, tp_tabela, cd_servico, qt_cobrada, vl_serv_cob, vl_co_cob, vl_filme_cob, cd_porte_ane, cd_uni_aut, nr_autoriz, cd_uni_pre_req, cd_pre_req, cd_via_acesso, vl_adic_ser, vl_adic_co, vl_adic_filme, cd_espec, qt_tot_r502, qt_tot_r503, qt_tot_r504, qt_tot_r505, qt_not_exc, qt_not_amb, qt_tot_ser, vl_tot_serv, nr_seq_protocolo, nr_interno_conta, ie_tipo_prest, id_rec_proprio, tp_pessoa, id_pacote, cd_ato, ie_fat_mult_serv, nr_seq_nota, hr_realiz) AS select		
	1						tp_registro, 
	1						nr_seq, 
	501						tp_reg, 
	coalesce(somente_numero(substr(a.cd_interno,1,4)),0)	cd_uni_des, 
	0						cd_uni_ori, 
	a.dt_remessa					dt_geracao, 
	b.dt_mesano_referencia			nr_comp, 
	a.nr_seq_protocolo				nr_fatura, 
	a.dt_vencimento				dt_vem_fat, 
	a.dt_remessa					dt_emi_fat, 
	c.vl_total_conta				vl_tot_fat, 
	c.vl_total_conta				vl_tot_fat_liq, 
	' '						ds_reservado, 
	0						vl_ajuste_fat, 
	07						nr_ver_tra, 
	(coalesce(somente_numero(substr(a.cd_interno,1,4)),0) || to_char(a.nr_seq_protocolo))::numeric  nr_lote, 
	' '						nr_nota, 
	0						tp_nota, 
	0						cd_uni, 
	''					id_benef, 
	''						nm_benef, 
	LOCALTIMESTAMP					dt_atend, 
	0						cd_excecao, 
	0						tp_consulta, 
	''						id_ambula, 
	''						cd_cid, 
	''						tp_paciente, 
	0						cd_uni_hosp, 
	' '						cd_hosp, 
	''						nm_hosp, 
	''						tp_acomodacao, 
	LOCALTIMESTAMP					dt_internacao, 
	LOCALTIMESTAMP					dt_alta, 
	0						ft_mult_amb, 
	''						tp_admissao, 
	''						tp_saida, 
	''						cd_cgc_hospital, 
	0						tp_internacao, 
	0						tp_nascimento, 
	0						cd_uni_pre, 
	0						cd_prest, 
	''						nm_prest, 
	0						cd_cgc_cpf_prest, 
	''						tp_particip, 
	LOCALTIMESTAMP					dt_servico, 
	0						tp_tabela, 
	0						cd_servico, 
	0						qt_cobrada, 
	0						vl_serv_cob, 
	0						vl_co_cob, 
	0						vl_filme_cob, 
	''						cd_porte_ane, 
	0						cd_uni_aut, 
	0						nr_autoriz, 
	0						cd_uni_pre_req, 
	0						cd_pre_req, 
	0						cd_via_acesso, 
	0						vl_adic_ser, 
	0						vl_adic_co, 
	0						vl_adic_filme, 
	0						cd_espec, 
	0						qt_tot_r502, 
	0						qt_tot_r503, 
	0						qt_tot_r504, 
	0						qt_tot_r505, 
	0						qt_not_exc, 
	0						qt_not_amb, 
	0						qt_tot_ser, 
	0						vl_tot_serv, 
	a.nr_seq_protocolo				nr_seq_protocolo, 
	0						nr_interno_conta, 
	0						ie_tipo_prest, 
	' '						id_rec_proprio, 
	' '						tp_pessoa, 
	' '						id_pacote, 
	'1'						cd_ato, 
	0						ie_fat_mult_serv, 
	0						nr_seq_nota, 
	' '						hr_realiz	 
FROM w_interf_conta_trailler c, 
	protocolo_convenio b, 
	w_interf_conta_header a 
where	a.nr_seq_protocolo	= b.nr_seq_protocolo 
and	a.nr_seq_protocolo	= c.nr_seq_protocolo 

union all
 
/* Nota		*/
 
select		 
	2						tp_registro, 
	1						nr_seq, 
	502						tp_reg, 
	0						cd_uni_des, 
	0						cd_uni_ori, 
	LOCALTIMESTAMP					dt_geracao, 
	LOCALTIMESTAMP					nr_comp, 
	0						nr_fatura, 
	LOCALTIMESTAMP					dt_vem_fat, 
	LOCALTIMESTAMP					dt_emi_fat, 
	0						vl_tot_fat, 
	0						vl_tot_fat_liq, 
	' '						ds_reservado, 
	0						vl_ajuste_fat, 
	0						nr_ver_tra, 
	(coalesce(somente_numero(substr(b.cd_interno,1,4)),0) || to_char(a.nr_seq_protocolo))::numeric  nr_lote, 
	substr(coalesce(upper(Elimina_Caracteres_Especiais(obter_doc_convenio_proc(a.nr_interno_conta))), 
		upper(Elimina_Caracteres_Especiais(a.nr_doc_convenio))),1,11) 	nr_nota, 
	CASE WHEN a.ie_tipo_atendimento=3 THEN 1 WHEN a.ie_tipo_atendimento=7 THEN 2  ELSE 5 END  	tp_nota, 
	coalesce(somente_numero(substr(a.cd_usuario_convenio,1,4)),0) 	 
							cd_uni, 
	substr(a.cd_usuario_convenio,4,13)		id_benef, 
	substr(a.nm_paciente,1,25)			nm_benef, 
	a.dt_entrada					dt_atend, 
	0						cd_excecao, 
	CASE WHEN a.ie_carater_inter='1' THEN 0  ELSE 1 END 		tp_consulta, 
	CASE WHEN a.ie_tipo_atendimento=3 THEN '1'  ELSE '2' END 	id_ambula, 
	substr(a.cd_cid_principal,1,6)		cd_cid, 
	'1'						tp_paciente, 
	0						cd_uni_hosp, 
	' '						cd_hosp, 
	''						nm_hosp, 
	''						tp_acomodacao, 
	LOCALTIMESTAMP					dt_internacao, 
	LOCALTIMESTAMP					dt_alta, 
	0						ft_mult_amb, 
	''						tp_admissao, 
	''						tp_saida, 
	''						cd_cgc_hospital, 
	0						tp_internacao, 
	0						tp_nascimento, 
	0						cd_uni_pre, 
	0						cd_prest, 
	''						nm_prest, 
	0						cd_cgc_cpf_prest, 
	''						tp_particip, 
	LOCALTIMESTAMP					dt_servico, 
	0						tp_tabela, 
	0						cd_servico, 
	0						qt_cobrada, 
	0						vl_serv_cob, 
	0						vl_co_cob, 
	0						vl_filme_cob, 
	''						cd_porte_ane, 
	0						cd_uni_aut, 
	0						nr_autoriz, 
	0						cd_uni_pre_req, 
	0						cd_pre_req, 
	0						cd_via_acesso, 
	0						vl_adic_ser, 
	0						vl_adic_co, 
	0						vl_adic_filme, 
	0						cd_espec, 
	0						qt_tot_r502, 
	0						qt_tot_r503, 
	0						qt_tot_r504, 
	0						qt_tot_r505, 
	0						qt_not_exc, 
	0						qt_not_amb, 
	0						qt_tot_ser, 
	0						vl_tot_serv, 
	a.nr_seq_protocolo				nr_seq_protocolo, 
	a.nr_interno_conta				nr_interno_conta, 
	0						ie_tipo_prest, 
	' '						id_rec_proprio, 
	' '						tp_pessoa, 
	' '						id_pacote, 
	'1'						cd_ato, 
	0						ie_fat_mult_serv, 
	0						nr_seq_nota, 
	' '						hr_realiz	 
from 	conta_paciente x, 
	w_interf_conta_header b, 
 	w_interf_conta_cab a 
where	a.nr_seq_protocolo	= b.nr_seq_protocolo 
and	a.nr_interno_conta	= x.nr_interno_conta 

union all
 
/* Hospital 	*/
 
select 
	3						tp_registro, 
	1						nr_seq, 
	503						tp_reg, 
	0						cd_uni_des, 
	0						cd_uni_ori, 
	LOCALTIMESTAMP					dt_geracao, 
	LOCALTIMESTAMP					nr_comp, 
	0						nr_fatura, 
	LOCALTIMESTAMP					dt_vem_fat, 
	LOCALTIMESTAMP					dt_emi_fat, 
	0						vl_tot_fat, 
	0						vl_tot_fat_liq, 
	' '						ds_reservado, 
	0						vl_ajuste_fat, 
	0						nr_ver_tra, 
	(coalesce(somente_numero(substr(b.cd_interno,1,4)),0) || to_char(a.nr_seq_protocolo))::numeric  nr_lote, 
	substr(coalesce(upper(Elimina_Caracteres_Especiais( 
		obter_doc_convenio_proc(a.nr_interno_conta))), 
		upper(Elimina_Caracteres_Especiais(a.nr_doc_convenio))),1,11)	nr_nota, 
	0						tp_nota, 
	0						cd_uni, 
	''						id_benef, 
	''						nm_benef, 
	LOCALTIMESTAMP					dt_atend, 
	0						cd_excecao, 
	0						tp_consulta, 
	''						id_ambula, 
	''						cd_cid, 
	''						tp_paciente, 
	coalesce(somente_numero(substr(b.cd_interno,1,4)),0)	cd_uni_hosp, 
	' '						cd_hosp, 
	substr(b.nm_hospital,1,25)			nm_hosp, 
	to_char(a.cd_tipo_acomodacao)		tp_acomodacao, 
	a.dt_entrada					dt_internacao, 
	a.dt_alta					dt_alta, 
	0						ft_mult_amb, 
	a.ie_carater_sus				tp_admissao, 
	to_char(a.cd_motivo_alta)			tp_saida, 
	b.cd_cgc_hospital				cd_cgc_hospital, 
	a.ie_clinica					tp_internacao, 
	0						tp_nascimento, 
	0						cd_uni_pre, 
	0						cd_prest, 
	''						nm_prest, 
	0						cd_cgc_cpf_prest, 
	''						tp_particip, 
	LOCALTIMESTAMP					dt_servico, 
	0						tp_tabela, 
	0						cd_servico, 
	0						qt_cobrada, 
	0						vl_serv_cob, 
	0						vl_co_cob, 
	0						vl_filme_cob, 
	''						cd_porte_ane, 
	0						cd_uni_aut, 
	0						nr_autoriz, 
	0						cd_uni_pre_req, 
	0						cd_pre_req, 
	0						cd_via_acesso, 
	0						vl_adic_ser, 
	0						vl_adic_co, 
	0						vl_adic_filme, 
	0						cd_espec, 
	0						qt_tot_r502, 
	0						qt_tot_r503, 
	0						qt_tot_r504, 
	0						qt_tot_r505, 
	0						qt_not_exc, 
	0						qt_not_amb, 
	0						qt_tot_ser, 
	0						vl_tot_serv, 
	a.nr_seq_protocolo				nr_seq_protocolo, 
	a.nr_interno_conta				nr_interno_conta, 
	0						ie_tipo_prest, 
	' '						id_rec_proprio, 
	' '						tp_pessoa, 
	' '						id_pacote, 
	'1'						cd_ato, 
	0						ie_fat_mult_serv, 
	0						nr_seq_nota, 
	' '						hr_realiz	 
from 	conta_paciente x, 
	w_interf_conta_header b, 
 	w_interf_conta_cab a 
where	a.nr_seq_protocolo	= b.nr_seq_protocolo 
and	a.ie_tipo_atendimento	= '1' 
and	a.nr_interno_conta	= x.nr_interno_conta 

union all
 
/* Servico,AMB,taxas */
 
select 
	4						tp_registro, 
	1						nr_seq, 
	504						tp_reg, 
	0						cd_uni_des, 
	0						cd_uni_ori, 
	LOCALTIMESTAMP					dt_geracao, 
	LOCALTIMESTAMP					nr_comp, 
	0						nr_fatura, 
	LOCALTIMESTAMP					dt_vem_fat, 
	LOCALTIMESTAMP					dt_emi_fat, 
	0						vl_tot_fat, 
	0						vl_tot_fat_liq, 
	' '						ds_reservado, 
	0						vl_ajuste_fat, 
	0						nr_ver_tra, 
	(coalesce(somente_numero(substr(b.cd_interno,1,4)),0) || to_char(a.nr_seq_protocolo))::numeric  nr_lote, 
	substr(coalesce(upper(Elimina_Caracteres_Especiais( 
		obter_doc_convenio_proc(a.nr_interno_conta))), 
		upper(Elimina_Caracteres_Especiais( 
		a.nr_doc_convenio))),1,11) 		nr_nota, 
	0						tp_nota, 
	0						cd_uni, 
	''						id_benef, 
	''						nm_benef, 
	LOCALTIMESTAMP					dt_atend, 
	0						cd_excecao, 
	0						tp_consulta, 
	''						id_ambula, 
	''						cd_cid, 
	''						tp_paciente, 
	0						cd_uni_hosp, 
	' '						cd_hosp, 
	''						nm_hosp, 
	''						tp_acomodacao, 
	LOCALTIMESTAMP					dt_internacao, 
	LOCALTIMESTAMP					dt_alta, 
	0						ft_mult_amb, 
	''						tp_admissao, 
	''						tp_saida, 
	''						cd_cgc_hospital, 
	0						tp_internacao, 
	0						tp_nascimento, 
	coalesce(somente_numero(substr(b.cd_interno,1,4)),0)	cd_uni_pre, 
	coalesce(somente_numero(substr(CASE WHEN c.ie_responsavel_credito='M' THEN c.cd_medico_exec_conv  ELSE '00010013' END ,1,8)),0)	cd_prest, 
	substr(CASE WHEN c.ie_responsavel_credito='M' THEN c.nm_medico_executor  ELSE b.nm_hospital END ,1,40)			nm_prest, 
	CASE WHEN c.ie_responsavel_credito='M' THEN coalesce(somente_numero(c.nr_cpf_executor),0)  ELSE somente_numero(coalesce(c.cd_cgc_prestador,c.cd_cgc_hospital)) END  
							cd_cgc_cpf_prest, 
	to_char(coalesce(c.cd_funcao_executor,0))	tp_particip, 
	trunc(c.dt_item)				dt_servico, 
	0						tp_tabela, 
	somente_numero(c.cd_item_convenio)		cd_servico, 
	sum(c.qt_item)				qt_cobrada, 
	sum(c.vl_total_item)				vl_serv_cob, 
	sum(c.vl_custo_oper)				vl_co_cob, 
	sum(c.vl_filme)				vl_filme_cob, 
	substr(to_char(c.nr_porte_anestesico),1,1)cd_porte_ane, 
	('0' || to_char(substr(a.cd_usuario_convenio,1,3)))::numeric   cd_uni_aut, 
	somente_numero(substr(coalesce(upper(Elimina_Caracteres_Especiais( 
		obter_doc_convenio_proc(a.nr_interno_conta))), 
			upper(Elimina_Caracteres_Especiais( 
			a.nr_doc_convenio))),1,9)) 	nr_autoriz, 
	('0' || to_char(substr(a.cd_usuario_convenio,1,3)))::numeric   cd_uni_pre_req, 
	(a.cd_medico_resp)::numeric            cd_pre_req, 
	CASE WHEN coalesce(c.pr_via_acesso,100)=100 THEN 0 WHEN coalesce(c.pr_via_acesso,100)=50 THEN 1 WHEN coalesce(c.pr_via_acesso,100)=70 THEN 2  ELSE 0 END 	 
							cd_via_acesso, 
	0						vl_adic_ser, 
	0						vl_adic_co, 
	0						vl_adic_filme, 
	c.cd_especialidade				cd_espec, 
	0						qt_tot_r502, 
	0						qt_tot_r503, 
	0						qt_tot_r504, 
	0						qt_tot_r505, 
	0						qt_not_exc, 
	0						qt_not_amb, 
	0						qt_tot_ser, 
	0						vl_tot_serv, 
	a.nr_seq_protocolo				nr_seq_protocolo, 
	a.nr_interno_conta				nr_interno_conta, 
	CASE WHEN c.ie_responsavel_credito='M' THEN 1  ELSE 2 END 	ie_tipo_prest, 
	CASE WHEN c.ie_responsavel_credito='M' THEN 'S' WHEN c.ie_responsavel_credito='H' THEN 'S' WHEN c.ie_responsavel_credito='RM' THEN 'N'  ELSE 'S' END  
							id_rec_proprio, 
	CASE WHEN c.ie_responsavel_credito='M' THEN 'F'  ELSE 'J' END 	tp_pessoa, 
	CASE WHEN c.nr_seq_proc_pacote IS NULL THEN 'N'  ELSE 'S' END 	id_pacote, 
	'1'						cd_ato, 
	1						ie_fat_mult_serv, 
	0						nr_seq_nota, 
	to_char(c.dt_item,'hh24:mi:ss')		hr_realiz	 
from  w_interf_conta_header b, 
 	w_interf_conta_cab a, 
	w_interf_conta_item c 
where	a.nr_seq_protocolo	= b.nr_seq_protocolo 
and	a.nr_interno_conta	= c.nr_interno_conta 
and	c.vl_total_item		<> 0 
and	c.ie_tipo_item		<> 2 
group	by 
	(coalesce(somente_numero(substr(b.cd_interno,1,4)),0) || to_char(a.nr_seq_protocolo))::numeric , 
	('0' || to_char(substr(a.cd_usuario_convenio,1,3)))::numeric , 
	('0' || to_char(substr(a.cd_usuario_convenio,1,3)))::numeric , 
	(a.cd_medico_resp)::numeric , 
	to_char(c.dt_item,'hh24:mi:ss'), 
	substr(coalesce(upper(Elimina_Caracteres_Especiais( 
		obter_doc_convenio_proc(a.nr_interno_conta))), 
		upper(Elimina_Caracteres_Especiais( 
		a.nr_doc_convenio))),1,11), 
	coalesce(somente_numero(substr(b.cd_interno,1,4)),0), 
	coalesce(somente_numero(substr(CASE WHEN c.ie_responsavel_credito='M' THEN c.cd_medico_exec_conv  ELSE '00010013' END ,1,8)),0), 
	substr(CASE WHEN c.ie_responsavel_credito='M' THEN c.nm_medico_executor  ELSE b.nm_hospital END ,1,40), 
	CASE WHEN c.ie_responsavel_credito='M' THEN coalesce(somente_numero(c.nr_cpf_executor),0)  ELSE somente_numero(coalesce(c.cd_cgc_prestador,c.cd_cgc_hospital)) END , 
	to_char(coalesce(c.cd_funcao_executor,0)), 
	trunc(c.dt_item), 
	somente_numero(c.cd_item_convenio), 
	substr(to_char(c.nr_porte_anestesico),1,1), 
	somente_numero(substr(coalesce(upper(Elimina_Caracteres_Especiais( 
		obter_doc_convenio_proc(a.nr_interno_conta))), 
			upper(Elimina_Caracteres_Especiais( 
			a.nr_doc_convenio))),1,9)), 
	CASE WHEN coalesce(c.pr_via_acesso,100)=100 THEN 0 WHEN coalesce(c.pr_via_acesso,100)=50 THEN 1 WHEN coalesce(c.pr_via_acesso,100)=70 THEN 2  ELSE 0 END , 
	c.cd_especialidade, 
	a.nr_seq_protocolo, 
	a.nr_interno_conta, 
	CASE WHEN c.ie_responsavel_credito='M' THEN 1  ELSE 2 END , 
	CASE WHEN c.ie_responsavel_credito='M' THEN 'S' WHEN c.ie_responsavel_credito='H' THEN 'S' WHEN c.ie_responsavel_credito='RM' THEN 'N'  ELSE 'S' END , 
	CASE WHEN c.ie_responsavel_credito='M' THEN 'F'  ELSE 'J' END , 
	CASE WHEN c.nr_seq_proc_pacote IS NULL THEN 'N'  ELSE 'S' END  

union all
 
/* Medicamentos,materiais 	*/
 
select 
	4						tp_registro, 
	1						nr_seq, 
	504						tp_reg, 
	0						cd_uni_des, 
	0						cd_uni_ori, 
	LOCALTIMESTAMP					dt_geracao, 
	LOCALTIMESTAMP					nr_comp, 
	0						nr_fatura, 
	LOCALTIMESTAMP					dt_vem_fat, 
	LOCALTIMESTAMP					dt_emi_fat, 
	0						vl_tot_fat, 
	0						vl_tot_fat_liq, 
	' '						ds_reservado, 
	0						vl_ajuste_fat, 
	0						nr_ver_tra, 
	(coalesce(somente_numero(substr(b.cd_interno,1,4)),0) || to_char(a.nr_seq_protocolo))::numeric  nr_lote, 
	substr(coalesce(upper(Elimina_Caracteres_Especiais( 
		obter_doc_convenio_proc(a.nr_interno_conta))), 
		upper(Elimina_Caracteres_Especiais( 
		a.nr_doc_convenio))),1,11) 		nr_nota, 
	0						tp_nota, 
	0						cd_uni, 
	''						id_benef, 
	''						nm_benef, 
	LOCALTIMESTAMP					dt_atend, 
	0						cd_excecao, 
	0						tp_consulta, 
	''						id_ambula, 
	''						cd_cid, 
	''						tp_paciente, 
	0						cd_uni_hosp, 
	' '						cd_hosp, 
	''						nm_hosp, 
	''						tp_acomodacao, 
	LOCALTIMESTAMP					dt_internacao, 
	LOCALTIMESTAMP					dt_alta, 
	0						ft_mult_amb, 
	''						tp_admissao, 
	''						tp_saida, 
	''						cd_cgc_hospital, 
	0						tp_internacao, 
	0						tp_nascimento, 
	coalesce(somente_numero(substr(b.cd_interno,1,4)),0)	cd_uni_pre, 
	coalesce(somente_numero(substr(CASE WHEN c.ie_responsavel_credito='M' THEN c.cd_medico_exec_conv  ELSE '00010013' END ,1,8)),0)	cd_prest, 
	substr(b.nm_hospital,1,40)			nm_prest, 
	somente_numero(coalesce(c.cd_cgc_prestador,c.cd_cgc_hospital)) 
							cd_cgc_cpf_prest, 
	'0'						tp_particip, 
	trunc(c.dt_item)				dt_servico, 
	0						tp_tabela, 
	somente_numero(c.cd_item_convenio)		cd_servico, 
	sum(c.qt_item)				qt_cobrada, 
	sum(c.vl_total_item)				vl_serv_cob, 
	0						vl_co_cob, 
	0						vl_filme_cob, 
	' '						cd_porte_ane, 
	0						cd_uni_aut, 
	somente_numero(substr(coalesce(upper(Elimina_Caracteres_Especiais( 
		obter_doc_convenio_proc(a.nr_interno_conta))), 
			upper(Elimina_Caracteres_Especiais( 
			a.nr_doc_convenio))),1,9)) 	nr_autoriz, 
	0						cd_uni_pre_req, 
	0						cd_pre_req, 
	0						cd_via_acesso, 
	0						vl_adic_ser, 
	0						vl_adic_co, 
	0						vl_adic_filme, 
	0						cd_espec, 
	0						qt_tot_r502, 
	0						qt_tot_r503, 
	0						qt_tot_r504, 
	0						qt_tot_r505, 
	0						qt_not_exc, 
	0						qt_not_amb, 
	0						qt_tot_ser, 
	0						vl_tot_serv, 
	a.nr_seq_protocolo				nr_seq_protocolo, 
	a.nr_interno_conta				nr_interno_conta, 
	2						ie_tipo_prest, 
	'S'						id_rec_proprio, 
	'J'						tp_pessoa, 
	CASE WHEN c.nr_seq_proc_pacote IS NULL THEN 'N'  ELSE 'S' END 	id_pacote, 
	'1'						cd_ato, 
	1						ie_fat_mult_serv, 
	0						nr_seq_nota, 
	'00:00:00'					hr_realiz	 
from  w_interf_conta_header b, 
 	w_interf_conta_cab a, 
	w_interf_conta_item c 
where	a.nr_seq_protocolo	= b.nr_seq_protocolo 
and	a.nr_interno_conta	= c.nr_interno_conta 
and	c.vl_total_item		<> 0 
and	c.ie_tipo_item		= 2 
group	by 
	(coalesce(somente_numero(substr(b.cd_interno,1,4)),0) || to_char(a.nr_seq_protocolo))::numeric , 
	substr(coalesce(upper(Elimina_Caracteres_Especiais( 
		obter_doc_convenio_proc(a.nr_interno_conta))), 
		upper(Elimina_Caracteres_Especiais( 
		a.nr_doc_convenio))),1,11), 
	coalesce(somente_numero(substr(b.cd_interno,1,4)),0), 
	substr(b.nm_hospital,1,40), 
	somente_numero(coalesce(c.cd_cgc_prestador,c.cd_cgc_hospital)), 
	trunc(c.dt_item), 
	coalesce(somente_numero(substr(CASE WHEN c.ie_responsavel_credito='M' THEN c.cd_medico_exec_conv  ELSE '00010013' END ,1,8)),0), 
	somente_numero(c.cd_item_convenio), 
	somente_numero(substr(coalesce(upper(Elimina_Caracteres_Especiais( 
		obter_doc_convenio_proc(a.nr_interno_conta))), 
			upper(Elimina_Caracteres_Especiais( 
			a.nr_doc_convenio))),1,9)), 
	a.nr_seq_protocolo, 
	a.nr_interno_conta, 
	CASE WHEN c.nr_seq_proc_pacote IS NULL THEN 'N'  ELSE 'S' END  

union all
 
/* Trailler 	*/
 
select		 
	7						tp_registro, 
	1						nr_seq, 
	509						tp_reg, 
	0						cd_uni_des, 
	0						cd_uni_ori, 
	LOCALTIMESTAMP					dt_geracao, 
	LOCALTIMESTAMP					nr_comp, 
	0						nr_fatura, 
	LOCALTIMESTAMP					dt_vem_fat, 
	LOCALTIMESTAMP					dt_emi_fat, 
	0						vl_tot_fat, 
	0						vl_tot_fat_liq, 
	' '						ds_reservado, 
	0						vl_ajuste_fat, 
	0						nr_ver_tra, 
	0						nr_lote, 
	'99999999999'					nr_nota, 
	0						tp_nota, 
	0						cd_uni, 
	''						id_benef, 
	''						nm_benef, 
	LOCALTIMESTAMP					dt_atend, 
	0						cd_excecao, 
	0						tp_consulta, 
	''						id_ambula, 
	''						cd_cid, 
	''						tp_paciente, 
	0						cd_uni_hosp, 
	' '						cd_hosp, 
	''						nm_hosp, 
	''						tp_acomodacao, 
	LOCALTIMESTAMP					dt_internacao, 
	LOCALTIMESTAMP					dt_alta, 
	0						ft_mult_amb, 
	''						tp_admissao, 
	''						tp_saida, 
	''						cd_cgc_hospital, 
	0						tp_internacao, 
	0						tp_nascimento, 
	0						cd_uni_pre, 
	0						cd_prest, 
	''						nm_prest, 
	0						cd_cgc_cpf_prest, 
	''						tp_particip, 
	LOCALTIMESTAMP					dt_servico, 
	0						tp_tabela, 
	0						cd_servico, 
	0						qt_cobrada, 
	0						vl_serv_cob, 
	0						vl_co_cob, 
	0						vl_filme_cob, 
	''						cd_porte_ane, 
	0						cd_uni_aut, 
	0						nr_autoriz, 
	0						cd_uni_pre_req, 
	0						cd_pre_req, 
	0						cd_via_acesso, 
	0						vl_adic_ser, 
	0						vl_adic_co, 
	0						vl_adic_filme, 
	0						cd_espec, 
	0						qt_tot_r502, 
	0						qt_tot_r503, 
	0						qt_tot_r504, 
	0						qt_tot_r505, 
	0						qt_not_exc, 
	0						qt_not_amb, 
	0						qt_tot_ser, 
	0						vl_tot_serv, 
	a.nr_seq_protocolo				nr_seq_protocolo, 
	9999999999					nr_interno_conta, 
	0						ie_tipo_prest, 
	' '						id_rec_proprio, 
	' '						tp_pessoa, 
	' '						id_pacote, 
	'1'						cd_ato, 
	0						ie_fat_mult_serv, 
	0						nr_seq_nota, 
	' '						hr_realiz	 
from w_interf_conta_trailler a;

