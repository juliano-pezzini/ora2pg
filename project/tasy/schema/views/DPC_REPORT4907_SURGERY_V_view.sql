-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW dpc_report4907_surgery_v (nr_sequencia, name_surgery, times_surgery, number_side, dt_surgery, anesthesia, name_surgery2, times_surgery2, number_side2, dt_surgery2, anesthesia2, name_surgery3, times_surgery3, number_side3, dt_surgery3, anesthesia3, name_surgery4, times_surgery4, number_side4, dt_surgery4, anesthesia4, name_surgery5, times_surgery5, number_side5, dt_surgery5, anesthesia5) AS select
	  coalesce(a.nr_sequencia, 0) nr_sequencia,	
	  (select max(b.ds_surgery_1) FROM 
                dpc_surgery b,
                patient_dpc_surgery c
                where  a.nr_seq_patient_dpc = c.nr_seq_patient_dpc
                and b.nr_sequencia = c.nr_seq_dpc_surgery) name_surgery,
	  coalesce((select
	   case 
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'CD_TIMES_SURGERY','N') = '1' then 'First time'
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'CD_TIMES_SURGERY','N') = '2' then 'Reoperation'
	   end 
	  ), ' ') times_surgery,
	  coalesce((select
	   case 
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'SI_SURGERY_SIDE','N') = '0' then 'None'   
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'SI_SURGERY_SIDE','N') = '1' then 'Right side'
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'SI_SURGERY_SIDE','N') = '2' then 'Left side'
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'SI_SURGERY_SIDE','N') = '3' then 'Bilaterally'
	   end 
	  ), ' ') number_side,   
	  dpc_pkg.get_value_report4907(a.nr_sequencia,'DT_SURGERY','Y') dt_surgery,       
	  coalesce(obter_valor_dominio_idioma(9613,dpc_pkg.get_value_report4907(a.nr_sequencia,'CD_ANESTHESIA','N'), 10),' ') anesthesia,
	  (select max(b.ds_surgery_2) from 
                dpc_surgery b,
                patient_dpc_surgery c
                where  a.nr_seq_patient_dpc = c.nr_seq_patient_dpc
                and b.nr_sequencia = c.nr_seq_dpc_surgery) name_surgery2,
	  coalesce((select
	   case 
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'CD_TIMES_SURGERY2','N') = '1' then 'First time'
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'CD_TIMES_SURGERY2','N') = '2' then 'Reoperation'
	   end 
	  ), ' ') times_surgery2,
	  coalesce((select
	   case 
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'SI_SURGERY_SIDE2','N') = '0' then 'None'   
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'SI_SURGERY_SIDE2','N') = '1' then 'Right side'
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'SI_SURGERY_SIDE2','N') = '2' then 'Left side'
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'SI_SURGERY_SIDE2','N') = '3' then 'Bilaterally'
	   end 
	  ), ' ') number_side2,   
	  dpc_pkg.get_value_report4907(a.nr_sequencia,'DT_SURGERY2','Y') dt_surgery2,       
	  coalesce(obter_valor_dominio_idioma(9613,dpc_pkg.get_value_report4907(a.nr_sequencia,'CD_ANESTHESIA2','N'), 10),' ') anesthesia2,
	  (select max(b.ds_surgery_3) from 
                dpc_surgery b,
                patient_dpc_surgery c
                where  a.nr_seq_patient_dpc = c.nr_seq_patient_dpc
                and b.nr_sequencia = c.nr_seq_dpc_surgery) name_surgery3,
	  coalesce((select
	   case 
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'CD_TIMES_SURGERY3','N') = '1' then 'First time'
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'CD_TIMES_SURGERY3','N') = '2' then 'Reoperation'
	   end 
	  ), ' ') times_surgery3,
	  coalesce((select
	   case 
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'SI_SURGERY_SIDE3','N') = '0' then 'None'   
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'SI_SURGERY_SIDE3','N') = '1' then 'Right side'
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'SI_SURGERY_SIDE3','N') = '2' then 'Left side'
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'SI_SURGERY_SIDE3','N') = '3' then 'Bilaterally'
	   end 
	  ), ' ') number_side3,   
	  dpc_pkg.get_value_report4907(a.nr_sequencia,'DT_SURGERY3','Y') dt_surgery3,       
	  coalesce(obter_valor_dominio_idioma(9613,dpc_pkg.get_value_report4907(a.nr_sequencia,'CD_ANESTHESIA3','N'), 10),' ') anesthesia3,
	  (select max(b.ds_surgery_4) from 
                dpc_surgery b,
                patient_dpc_surgery c
                where  a.nr_seq_patient_dpc = c.nr_seq_patient_dpc
                and b.nr_sequencia = c.nr_seq_dpc_surgery) name_surgery4,
	  coalesce((select
	   case 
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'CD_TIMES_SURGERY4','N') = '1' then 'First time'
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'CD_TIMES_SURGERY4','N') = '2' then 'Reoperation'
	   end 
	  ), ' ') times_surgery4,
	  coalesce((select
	   case 
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'SI_SURGERY_SIDE4','N') = '0' then 'None'   
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'SI_SURGERY_SIDE4','N') = '1' then 'Right side'
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'SI_SURGERY_SIDE4','N') = '2' then 'Left side'
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'SI_SURGERY_SIDE4','N') = '3' then 'Bilaterally'
	   end 
	  ), ' ') number_side4,   
	  dpc_pkg.get_value_report4907(a.nr_sequencia,'DT_SURGERY4','Y') dt_surgery4,       
	  coalesce(obter_valor_dominio_idioma(9613,dpc_pkg.get_value_report4907(a.nr_sequencia,'CD_ANESTHESIA4','N'), 10),' ') anesthesia4,
	  (select max(b.ds_surgery_5) from 
                dpc_surgery b,
                patient_dpc_surgery c
                where  a.nr_seq_patient_dpc = c.nr_seq_patient_dpc
                and b.nr_sequencia = c.nr_seq_dpc_surgery) name_surgery5,
	  coalesce((select
	   case 
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'CD_TIMES_SURGERY5','N') = '1' then 'First time'
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'CD_TIMES_SURGERY5','N') = '2' then 'Reoperation'
	   end 
	  ), ' ') times_surgery5,
	  coalesce((select
	   case 
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'SI_SURGERY_SIDE5','N') = '0' then 'None'   
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'SI_SURGERY_SIDE5','N') = '1' then 'Right side'
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'SI_SURGERY_SIDE5','N') = '2' then 'Left side'
		  when dpc_pkg.get_value_report4907(a.nr_sequencia,'SI_SURGERY_SIDE5','N') = '3' then 'Bilaterally'
	   end 
	  ), ' ') number_side5,   
	  dpc_pkg.get_value_report4907(a.nr_sequencia,'DT_SURGERY5','Y') dt_surgery5,       
	  coalesce(obter_valor_dominio_idioma(9613,dpc_pkg.get_value_report4907(a.nr_sequencia,'CD_ANESTHESIA5','N'), 10),' ') anesthesia5
from patient_dpc_questionnaire a;

