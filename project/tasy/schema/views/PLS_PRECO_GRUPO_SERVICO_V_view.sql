-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_preco_grupo_servico_v (ie_estrutura, cd_procedimento, ie_origem_proced, nr_seq_grupo, nr_prioridade) AS select	ps.ie_estrutura,
	a.cd_procedimento,
	a.ie_origem_proced,
	ps.nr_seq_grupo,
	5 nr_prioridade
FROM	pls_preco_grupo_servico gs,
	pls_preco_servico ps,
	procedimento a
where	gs.nr_sequencia		= ps.nr_seq_grupo
and	gs.ie_situacao 		= 'A'
and	ps.cd_procedimento	= a.cd_procedimento
and	ps.ie_origem_proced	= a.ie_origem_proced

union all

select	ps.ie_estrutura,
	p.cd_procedimento,
	p.ie_origem_proced,
	ps.nr_seq_grupo,
	4 nr_prioridade
from	procedimento		p,
	pls_preco_grupo_servico gs,
	pls_preco_servico	ps
where	gs.nr_sequencia		= ps.nr_seq_grupo
and	ps.cd_grupo_proc	= p.cd_grupo_proc
and	gs.ie_situacao 		= 'A'

union all

select	ps.ie_estrutura,
	p.cd_procedimento,
	p.ie_origem_proced,
	ps.nr_seq_grupo,
	3 nr_prioridade
from	procedimento		p,
	pls_preco_grupo_servico gs,
	pls_preco_servico 	ps,
	grupo_proc		gp
where	gs.nr_sequencia		= ps.nr_seq_grupo
and	ps.cd_especialidade     = gp.cd_especialidade
and	gp.cd_grupo_proc	= p.cd_grupo_proc
and	gs.ie_situacao 		= 'A'

union all

select	ps.ie_estrutura,
	p.cd_procedimento,
	p.ie_origem_proced,
	ps.nr_seq_grupo,
	2 nr_prioridade
from	procedimento		p,
	pls_preco_grupo_servico gs,
	pls_preco_servico 	ps,
	grupo_proc		gp,
	especialidade_proc	ep
where	gs.nr_sequencia		= ps.nr_seq_grupo
and	gp.cd_grupo_proc	= p.cd_grupo_proc
and	gp.cd_especialidade	= ep.cd_especialidade
and	ps.cd_area_procedimento	= ep.cd_area_procedimento
and	gs.ie_situacao 		= 'A'

union all

/* Para os casos onde a regra Ã© vazia, tem que ligar com todos os procedimentos */

select	ps.ie_estrutura,
	a.cd_procedimento,
	a.ie_origem_proced,
	ps.nr_seq_grupo,
	1 nr_prioridade
from	pls_preco_grupo_servico gs,
	procedimento a,
	pls_preco_servico ps
where	gs.nr_sequencia		= ps.nr_seq_grupo
and	gs.ie_situacao 		= 'A'
and	ps.cd_procedimento is null
and	ps.cd_especialidade is null
and	ps.cd_area_procedimento is null
and	ps.cd_grupo_proc is null;

