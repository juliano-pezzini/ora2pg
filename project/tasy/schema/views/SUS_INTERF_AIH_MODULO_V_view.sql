-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW sus_interf_aih_modulo_v (tp_registro, nr_cns, nr_cpf, nm_paciente, ie_sexo, dt_nascimento, nm_mae, ds_logradouro, nr_endereco, ds_complemento, ds_bairro, cd_cep, cd_municipio, nm_responsavel, nr_seq_cor_pele, nr_prontuario, dt_emissao, cd_cid, cd_proced_solic, cd_proced_autor, cd_estab_solic, cd_estab_exec, nr_cpf_solicitante, cd_carater_internacao, cd_especialidade, nr_aih, cd_orgao_emissor, dt_autorizacao, nr_cpf_autorizador, nr_laudo, nr_seq_laudo, nr_lote) AS select	1 tp_registro,
	substr(a.nr_cartao_nac_sus,1,15) nr_cns, 
	substr(obter_cpf_pessoa_fisica(a.cd_pessoa_fisica),1,11) nr_cpf, 
	upper(substr(a.nm_pessoa_fisica,1,60)) nm_paciente,	 
	upper(a.ie_sexo) ie_sexo, 
	a.dt_nascimento dt_nascimento, 
	upper(substr(obter_compl_pf(a.cd_pessoa_fisica,5,'N'),1,60)) nm_mae, 
	upper(substr(obter_compl_pf(a.cd_pessoa_fisica,1,'EN'),1,50)) ds_logradouro, 
	substr(obter_compl_pf(a.cd_pessoa_fisica,1,'NR'),1,5) nr_endereco, 
	upper(substr(obter_compl_pf(a.cd_pessoa_fisica,1,'CO'),1,50)) ds_complemento, 
	upper(substr(obter_compl_pf(a.cd_pessoa_fisica,1,'B'),1,50)) ds_bairro, 
	substr(obter_compl_pf(a.cd_pessoa_fisica,1,'CEP'),1,8) cd_cep, 
	substr(obter_compl_pf(a.cd_pessoa_fisica,1,'CDM'),1,10) cd_municipio, 
	upper(substr(obter_compl_pf(a.cd_pessoa_fisica,3,'N'),1,60)) nm_responsavel, 
	lpad(coalesce(substr(sus_obter_cor_pele(a.cd_pessoa_fisica,'C'),1,2),'99'),2,'0') nr_seq_cor_pele, 
	obter_prontuario_paciente(a.cd_pessoa_fisica) nr_prontuario, 
	c.dt_emissao, 
	c.cd_cid_principal cd_cid, 
	lpad(c.cd_procedimento_solic,10,0) cd_proced_solic, 
	lpad(c.cd_procedimento_solic,10,0) cd_proced_autor, 
	obter_cnes_estab(b.cd_estabelecimento) cd_estab_solic, 
	obter_cnes_estab(b.cd_estabelecimento) cd_estab_exec, 
	substr(obter_cpf_pessoa_fisica(c.cd_medico_requisitante),1,11) nr_cpf_solicitante, 
	lpad(b.ie_carater_inter_sus,2,'0') cd_carater_internacao, 
	lpad(substr(sus_obter_especialidade_proced(c.cd_procedimento_solic ,c.ie_origem_proced,'C'),1,2),2,'0') cd_especialidade, 
	c.nr_aih, 
	substr(sus_obter_orgao_emissor_aih(b.nr_atendimento),1,10) cd_orgao_emissor, 
	c.dt_liberacao dt_autorizacao, 
	substr(obter_cpf_pessoa_fisica(c.cd_medico_responsavel ),1,11) nr_cpf_autorizador, 
	lpad(c.nr_seq_interno,15,0) nr_laudo, 
	lpad(c.nr_seq_interno,15,0) nr_seq_laudo, 
	e.nr_sequencia nr_lote 
FROM	pessoa_fisica		a, 
	atendimento_paciente	b, 
	sus_lote_autor		e, 
	sus_laudo_paciente	c 
where	a.cd_pessoa_fisica	= b.cd_pessoa_fisica 
and 	b.nr_atendimento  	= c.nr_atendimento 
and 	e.nr_sequencia 	= c.nr_seq_lote;

