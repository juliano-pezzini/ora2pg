-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ul_trans_financ_v (ds_tipo, cd_conta_financ, dt_transacao, ds_transacao, vl_transacao, ds_conta_financ) AS select	'Transações de Caixa' ds_tipo,
	b.cd_conta_financ,
	a.dt_transacao,
	b.ds_transacao,
	coalesce(a.vl_transacao,0) vl_transacao,
	CASE WHEN substr(obter_ds_conta_financ(b.cd_conta_financ, 'N'),1,100)='Conta Inválida' THEN  ''  ELSE substr(obter_ds_conta_financ(b.cd_conta_financ,'N'),1,100) END  ds_conta_financ
FROM	transacao_financeira b,
	movto_trans_financ a
where a.nr_seq_trans_financ	= b.nr_sequencia
  and a.nr_seq_saldo_caixa is not null
  and a.nr_seq_titulo_pagar is null
  and a.nr_seq_titulo_receber is null
  and a.nr_bordero is null

union all

select	'Transações de Caixa' ds_tipo,
	b.cd_conta_financ,
	a.dt_transacao,
	b.ds_transacao,
	(dividir_sem_round(coalesce(d.vl_classificacao,0), coalesce(CASE WHEN e.ie_aumenta_diminui='A' THEN coalesce((e.vl_anterior + e.vl_alteracao),0) WHEN e.ie_aumenta_diminui='D' THEN  coalesce((e.vl_anterior - e.vl_alteracao),0) END , coalesce(c.vl_titulo,0))) * coalesce(a.vl_transacao,0)) vl_transacao,
	CASE WHEN substr(obter_ds_conta_financ(d.cd_conta_financ, 'N'),1,100)='Conta Inválida' THEN  ''  ELSE substr(obter_ds_conta_financ(d.cd_conta_financ,'N'),1,100) END  ds_conta_financ
FROM titulo_receber_classif d, transacao_financeira b, movto_trans_financ a, titulo_receber c
LEFT OUTER JOIN alteracao_valor e ON (c.nr_titulo = e.nr_titulo)
WHERE a.nr_seq_trans_financ	= b.nr_sequencia and c.nr_titulo		= d.nr_titulo  and c.nr_titulo		= a.nr_seq_titulo_receber and a.nr_seq_saldo_caixa is not null

union all

select	'Transações de Caixa' ds_tipo,
	b.cd_conta_financ,
	a.dt_transacao,
	b.ds_transacao,
	(dividir_sem_round(coalesce(d.vl_titulo,0), coalesce(c.vl_titulo,0)) * coalesce(a.vl_transacao,0)) vl_transacao,
	CASE WHEN substr(obter_ds_conta_financ(d.nr_seq_conta_financ, 'N'), 1,100)='Conta Inválida' THEN  ''  ELSE substr(obter_ds_conta_financ(d.nr_seq_conta_financ,'N'),1,100) END  ds_conta_financ
from	titulo_pagar_classif d,
	titulo_pagar c,
	transacao_financeira b,
	movto_trans_financ a
where a.nr_seq_trans_financ	= b.nr_sequencia
  and c.nr_titulo		= d.nr_titulo
  and c.nr_titulo		= a.nr_seq_titulo_pagar
  and a.nr_seq_saldo_caixa is not null

union all

select	'Transações de Caixa' ds_tipo,
	b.cd_conta_financ,
	a.dt_transacao,
	b.ds_transacao,
	coalesce(a.vl_transacao,0),
	CASE WHEN substr(obter_ds_conta_financ(d.nr_seq_conta_financ, 'N'), 1,100)='Conta Inválida' THEN  ''  ELSE substr(obter_ds_conta_financ(d.nr_seq_conta_financ,'N'),1,100) END  ds_conta_financ
from	titulo_pagar_classif d,
	titulo_pagar c,
	bordero_pagamento e,
	transacao_financeira b,
	movto_trans_financ a
where a.nr_seq_trans_financ	= b.nr_sequencia
  and c.nr_titulo		= d.nr_titulo
  and a.nr_bordero		= e.nr_bordero
  and e.nr_bordero		= c.nr_bordero
  and c.nr_titulo		= d.nr_titulo
  and a.nr_seq_saldo_caixa is not null

union all

select	'Transações de Banco' ds_tipo,
	b.cd_conta_financ,
	a.dt_transacao,
	b.ds_transacao,
	coalesce(a.vl_transacao,0) vl_transacao,
	CASE WHEN substr(obter_ds_conta_financ(b.cd_conta_financ, 'N'),1,100)='Conta Inválida' THEN  ''  ELSE substr(obter_ds_conta_financ(b.cd_conta_financ,'N'),1,100) END  ds_conta_financ
from	transacao_financeira b,
	movto_trans_financ a
where a.nr_seq_trans_financ	= b.nr_sequencia
  and a.nr_seq_saldo_banco is not null
  and a.nr_seq_titulo_pagar is null
  and a.nr_seq_titulo_receber is null
  and a.nr_bordero is null

union all

select	'Transações de Banco' ds_tipo,
	b.cd_conta_financ,
	a.dt_transacao,
	b.ds_transacao,
	(dividir_sem_round(coalesce(d.vl_classificacao,0), coalesce(CASE WHEN e.ie_aumenta_diminui='A' THEN coalesce((e.vl_anterior + e.vl_alteracao),0) WHEN e.ie_aumenta_diminui='D' THEN  coalesce((e.vl_anterior - e.vl_alteracao),0) END , coalesce(c.vl_titulo,0))) * coalesce(a.vl_transacao,0)) vl_transacao,
	CASE WHEN substr(obter_ds_conta_financ(d.cd_conta_financ, 'N'),1,100)='Conta Inválida' THEN  ''  ELSE substr(obter_ds_conta_financ(d.cd_conta_financ,'N'),1,100) END  ds_conta_financ
FROM titulo_receber_classif d, transacao_financeira b, movto_trans_financ a, titulo_receber c
LEFT OUTER JOIN alteracao_valor e ON (c.nr_titulo = e.nr_titulo)
WHERE a.nr_seq_trans_financ	= b.nr_sequencia and c.nr_titulo		= d.nr_titulo  and c.nr_titulo		= a.nr_seq_titulo_receber and a.nr_seq_saldo_banco is not null
 
union all

select	'Transações de Banco' ds_tipo,
	b.cd_conta_financ,
	a.dt_transacao,
	b.ds_transacao,
	(dividir_sem_round(coalesce(d.vl_titulo,0), coalesce(c.vl_titulo,0)) * coalesce(a.vl_transacao,0)) vl_transacao,
	CASE WHEN substr(obter_ds_conta_financ(d.nr_seq_conta_financ, 'N'), 1,100)='Conta Inválida' THEN  ''  ELSE substr(obter_ds_conta_financ(d.nr_seq_conta_financ,'N'),1,100) END  ds_conta_financ
from	titulo_pagar_classif d,
	titulo_pagar c,
	transacao_financeira b,
	movto_trans_financ a
where a.nr_seq_trans_financ	= b.nr_sequencia
  and c.nr_titulo		= d.nr_titulo
  and c.nr_titulo		= a.nr_seq_titulo_pagar
  and a.nr_seq_saldo_banco is not null

union all

select	'Transações de Banco' ds_tipo,
	b.cd_conta_financ,
	a.dt_transacao,
	b.ds_transacao,
	CASE WHEN somente_positivo(a.vl_transacao)=0 THEN (dividir_sem_round(coalesce(d.vl_titulo,0), coalesce(c.vl_titulo,0)) * coalesce(c.vl_bordero,0))*-1  ELSE (dividir_sem_round(coalesce(d.vl_titulo,0), coalesce(c.vl_titulo,0)) * coalesce(c.vl_bordero,0)) END  vl_transacao,
	CASE WHEN substr(obter_ds_conta_financ(d.nr_seq_conta_financ, 'N'), 1,100)='Conta Inválida' THEN  ''  ELSE substr(obter_ds_conta_financ(d.nr_seq_conta_financ,'N'),1,100) END  ds_conta_financ
from	titulo_pagar_classif d,
	titulo_pagar c,
	bordero_pagamento e,
	transacao_financeira b,
	movto_trans_financ a
where a.nr_seq_trans_financ	= b.nr_sequencia
  and c.nr_titulo	= d.nr_titulo
  and a.nr_bordero	= e.nr_bordero
  and e.nr_bordero	= c.nr_bordero
  and c.nr_titulo	= d.nr_titulo
  and a.nr_seq_saldo_banco is not null
order by ds_tipo, dt_transacao, ds_transacao, cd_conta_financ;

