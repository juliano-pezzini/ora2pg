-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW san_producao_inutilizacao_v (ie_interno_externo, ie_avaliacao_final, cd_estabelecimento, nr_sangue, ds_derivado, sg_sigla, nm_pessoa_fisica, ie_tipo_sangue, ie_fator_rh, ds_tipo_doacao, nr_seq_doacao, dt_doacao, nr_bolsa, nr_sequencia, dt_producao, dt_vencimento, nm_usuario, dt_atualizacao, nr_seq_transfusao, nr_seq_inutil, nr_seq_emp_saida, nr_seq_propaci, cd_pf_realizou, ie_irradiado, ie_lavado, ie_filtrado, ie_aliquotado, nr_seq_derivado, nr_sec_saude, nm_usuario_lib, dt_liberacao, nm_iniciais, qt_volume, qt_vol_transf, nr_seq_reserva, dt_emprestimo, nr_seq_apresent, cd_barras, dt_inicio, dt_fim, dt_utilizacao, dt_termino_util, nr_transfusao_controle, ie_aferese, cd_barras_integracao, dt_fim_producao, dt_recebimento, dt_liberacao_bolsa, dt_fim_prod_emprestimo, dt_inicio_prod_emprestimo, nr_seq_emp_ent, cd_barras_doacao, dt_conf_transf, nm_usuario_conf_trans, ie_pai_reproduzido, dt_inicio_infusao, nm_usuario_ini_infusao, dt_fim_infusao, nm_usuario_fim_infusao, ie_local_inutilizacao, cd_doador, cd_responsavel, cd_pessoa_fisica, ie_realiza_nat, ie_reproduzido, cd_estab_atual, cd_estab_producao, ie_encaminhado, dt_entrada_estoque, nr_seq_entidade, nr_seq_tipo, dt_inutilizacao, nm_usuario_inut, nr_lote_bolsa, ds_justificativa) AS select	'I' ie_interno_externo,
	a.ie_avaliacao_final, 
	a.cd_estabelecimento, 
	d.nr_sangue, 
	e.ds_derivado, 
	e.sg_sigla, 
	b.nm_pessoa_fisica, 
	b.ie_tipo_sangue, 
	b.ie_fator_rh, 
	c.ds_tipo_doacao, 
	a.nr_sequencia nr_seq_doacao, 
	a.dt_doacao, 
	a.nr_bolsa, 
	d.nr_sequencia, 
	d.dt_producao, 
	d.dt_vencimento, 
	d.nm_usuario, 
	d.dt_atualizacao, 
	d.nr_seq_transfusao, 
	d.nr_seq_inutil, 
	d.nr_seq_emp_saida, 
	d.nr_seq_propaci, 
	d.cd_pf_realizou, 
	d.ie_irradiado, 
	d.ie_lavado, 
	d.ie_filtrado, 
	d.ie_aliquotado, 
	d.nr_seq_derivado, 
	d.nr_sec_saude, 
	d.nm_usuario_lib, 
	d.dt_liberacao, 
	substr(obter_iniciais_nome(a.cd_pessoa_fisica,null),1,50) nm_iniciais, 
	d.qt_volume, 
	d.qt_vol_transf, 
	d.nr_seq_reserva, 
	null dt_emprestimo, 
	coalesce(e.nr_seq_apresent,'9999') nr_seq_apresent, 
	d.cd_barras, 
	h.dt_inicio, 
	h.dt_fim, 
	d.dt_utilizacao, 
	d.dt_termino_util, 
	d.nr_transfusao_controle, 
	d.ie_aferese, 
	a.cd_barras_integracao, 
	d.dt_fim_producao, 
	d.dt_recebimento, 
	a.dt_liberacao dt_liberacao_bolsa, 
	d.dt_fim_prod_emprestimo, 
	d.dt_inicio_prod_emprestimo, 
	d.nr_seq_emp_ent, 
	a.cd_barras cd_barras_doacao, 
	d.dt_conf_transf, 
	d.nm_usuario_conf_trans, 
	coalesce(d.ie_pai_reproduzido,'N') ie_pai_reproduzido, 
	d.dt_inicio_infusao, 
	d.nm_usuario_ini_infusao, 
	d.dt_fim_infusao, 
	d.nm_usuario_fim_infusao, 
	d.ie_local_inutilizacao, 
	a.cd_pessoa_fisica cd_doador, 
	a.cd_pf_realizou cd_responsavel, 
	b.cd_pessoa_fisica, 
	a.ie_realiza_nat, 
	d.ie_reproduzido ie_reproduzido, 
	d.cd_estab_atual, 
	d.cd_estabelecimento cd_estab_producao, 
	coalesce(d.ie_encaminhado,'N') ie_encaminhado, 
	d.dt_entrada_estoque, 
	null nr_seq_entidade, 
	a.nr_seq_tipo, 
	d.dt_inutilizacao, 
	d.nm_usuario_inut, 
	a.nr_lote_bolsa, 
	d.ds_justificativa 
FROM san_derivado e, san_tipo_doacao c, pessoa_fisica b, san_doacao a, san_producao d
LEFT OUTER JOIN san_producao_lib_venc h ON (d.nr_sequencia = h.nr_seq_producao)
WHERE a.cd_pessoa_fisica	= b.cd_pessoa_fisica and a.nr_seq_tipo		= c.nr_sequencia and a.nr_sequencia		= d.nr_seq_doacao and d.nr_seq_derivado	= e.nr_sequencia  and d.nr_seq_emp_ent is null 
 
union
 
select	'E' ie_interno_externo, 
	'A', 
	a.cd_estabelecimento, 
	d.nr_sangue, 
	e.ds_derivado, 
	e.sg_sigla, 
	b.ds_entidade, 
	d.ie_tipo_sangue, 
	d.ie_fator_rh, 
	'Empr√©stimo', 
	a.nr_sequencia, 
	d.dt_producao, 
	d.nr_bolsa, 
	d.nr_sequencia, 
	d.dt_producao, 
	d.dt_vencimento, 
	d.nm_usuario, 
	d.dt_atualizacao, 
	d.nr_seq_transfusao, 
	d.nr_seq_inutil, 
	d.nr_seq_emp_saida, 
	d.nr_seq_propaci, 
	d.cd_pf_realizou, 
	d.ie_irradiado, 
	d.ie_lavado, 
	d.ie_filtrado, 
	d.ie_aliquotado, 
	d.nr_seq_derivado, 
	d.nr_sec_saude, 
	d.nm_usuario_lib, 
	d.dt_liberacao, 
	substr(d.nm_doador,1,50), 
	d.qt_volume, 
	d.qt_vol_transf, 
	d.nr_seq_reserva, 
	a.dt_emprestimo, 
	coalesce(e.nr_seq_apresent,'9999') nr_seq_apresent, 
	d.cd_barras, 
	h.dt_inicio, 
	h.dt_fim, 
	d.dt_utilizacao, 
	d.dt_termino_util, 
	d.nr_transfusao_controle, 
	d.ie_aferese, 
	null, 
	d.dt_fim_producao, 
	d.dt_recebimento, 
	a.dt_emprestimo dt_liberacao_bolsa, 
	d.dt_fim_prod_emprestimo, 
	d.dt_inicio_prod_emprestimo, 
	d.nr_seq_emp_ent, 
	null, 
	d.dt_conf_transf, 
	d.nm_usuario_conf_trans, 
	coalesce(d.ie_pai_reproduzido,'N') ie_pai_reproduzido, 
	d.dt_inicio_infusao, 
	d.nm_usuario_ini_infusao, 
	d.dt_fim_infusao, 
	d.nm_usuario_fim_infusao, 
	d.ie_local_inutilizacao, 
	null cd_doador, 
	d.cd_pf_realizou cd_responsavel, 
	null cd_pessoa_fisica, 
	null ie_realiza_nat, 
	d.ie_reproduzido , 
	d.cd_estab_atual, 
	d.cd_estabelecimento cd_estab_producao, 
	coalesce(d.ie_encaminhado,'N') ie_encaminhado, 
	d.dt_entrada_estoque, 
	a.nr_seq_entidade , 
	null, 
	d.dt_inutilizacao, 
	d.nm_usuario_inut, 
	d.nr_seq_lote, 
	d.ds_justificativa 
FROM san_derivado e, san_entidade b, san_emprestimo a, san_producao d
LEFT OUTER JOIN san_producao_lib_venc h ON (d.nr_sequencia = h.nr_seq_producao)
WHERE d.nr_seq_derivado	= e.nr_sequencia and d.nr_seq_emp_ent	= a.nr_sequencia and a.nr_seq_entidade	= b.nr_sequencia  
union
 
select	'A' ie_interno_externo, 
	'A', 
	a.cd_estabelecimento, 
	d.nr_sangue, 
	e.ds_derivado, 
	e.sg_sigla, 
	'Agrupamento', 
	d.ie_tipo_sangue, 
	d.ie_fator_rh, 
	'Agrupamento', 
	a.nr_sequencia nr_seq_agrupamento, 
	d.dt_producao, 
	'', 
	d.nr_sequencia, 
	d.dt_producao, 
	d.dt_vencimento, 
	d.nm_usuario, 
	d.dt_atualizacao, 
	d.nr_seq_transfusao, 
	d.nr_seq_inutil, 
	d.nr_seq_emp_saida, 
	d.nr_seq_propaci, 
	d.cd_pf_realizou, 
	d.ie_irradiado, 
	d.ie_lavado, 
	d.ie_filtrado, 
	d.ie_aliquotado, 
	d.nr_seq_derivado, 
	d.nr_sec_saude, 
	d.nm_usuario_lib, 
	d.dt_liberacao, 
	substr(d.nm_doador,1,50), 
	d.qt_volume, 
	d.qt_vol_transf, 
	d.nr_seq_reserva, 
	null dt_emprestimo, 
	coalesce(e.nr_seq_apresent,'9999') nr_seq_apresent, 
	d.cd_barras, 
	h.dt_inicio, 
	h.dt_fim, 
	d.dt_utilizacao, 
	d.dt_termino_util, 
	d.nr_transfusao_controle, 
	d.ie_aferese, 
	null, 
	d.dt_fim_producao, 
	d.dt_recebimento, 
	a.dt_liberacao dt_liberacao_bolsa, 
	d.dt_fim_prod_emprestimo, 
	d.dt_inicio_prod_emprestimo, 
	d.nr_seq_emp_ent, 
	null, 
	d.dt_conf_transf, 
	d.nm_usuario_conf_trans, 
	coalesce(d.ie_pai_reproduzido,'N') ie_pai_reproduzido, 
	d.dt_inicio_infusao, 
	d.nm_usuario_ini_infusao, 
	d.dt_fim_infusao, 
	d.nm_usuario_fim_infusao, 
	d.ie_local_inutilizacao, 
	null cd_doador, 
	d.cd_pf_realizou cd_responsavel, 
	null cd_pessoa_fisica, 
	null ie_realiza_nat, 
	d.ie_reproduzido, 
	d.cd_estab_atual, 
	d.cd_estabelecimento cd_estab_producao, 
	coalesce(d.ie_encaminhado,'N') ie_encaminhado, 
	d.dt_entrada_estoque, 
	null nr_seq_entidade, 
	null, 
	d.dt_inutilizacao, 
	d.nm_usuario_inut, 
	null, 
	d.ds_justificativa 
FROM san_derivado e, san_agrupamento a, san_producao d
LEFT OUTER JOIN san_producao_lib_venc h ON (d.nr_sequencia = h.nr_seq_producao)
WHERE d.nr_seq_derivado	= e.nr_sequencia and a.nr_sequencia		= d.nr_seq_agrupamento;

