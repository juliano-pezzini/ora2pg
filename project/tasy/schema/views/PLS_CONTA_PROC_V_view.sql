-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_conta_proc_v (nr_sequencia, nr_seq_conta, cd_procedimento, cd_procedimento_imp, ie_origem_proced, dt_procedimento_imp, nr_seq_preco_pacote, ie_coparticipacao, ie_co_preco_operadora, nr_seq_proc_ref, nr_seq_regra_vinculo, nr_seq_regra, nr_seq_regra_valor, nr_seq_honorario_crit, nr_seq_hon_crit_medico, ie_via_acesso, nr_seq_participante_hi, ie_tipo_liberacao, ie_via_acesso_imp, nr_seq_regra_via_acesso, ie_status_pagamento, nr_seq_regra_ctb_cred, nr_seq_regra_ctb_deb, cd_historico_glosa, cd_conta_glosa_deb, cd_conta_glosa_cred, cd_historico, cd_conta_deb, cd_conta_cred, nr_seq_tiss_tabela, ie_tecnica_utilizada, cd_tipo_tabela_imp, ds_procedimento_imp, ie_via_acesso_manual, ie_status, ie_tipo_despesa, ie_tipo_despesa_imp, nr_seq_rp_combinada, ie_tx_manual, nr_seq_regra_qtde_exec, nr_seq_regra_tipo_exec, ie_valor_informado, ie_vl_apresentado_sistema, nr_seq_grupo_serv, ie_criterio_horario, nr_auxiliares, ie_autogerado, ie_regra_qtde_execucao, ie_valor_base, cd_moeda_autogerado, nr_seq_regra_tx_proc, nr_seq_regra_tx_inter, nr_seq_autogerado, vl_ch_honorario, vl_ch_custo_oper, vl_ch_custo_filme, vl_ch_anestesista, vl_prestador, nr_seq_prest_pgto_coleta, vl_exame_coleta, vl_procedimento_ptu, vl_co_ptu, vl_material_ptu, vl_pag_medico_conta, nr_seq_prestador_pgto, nr_seq_prest_pgto_medico, ie_faturamento, vl_medico, vl_anestesista, vl_auxiliares, vl_beneficiario, nr_seq_evento, nr_seq_evento_prod, nr_seq_pacote, nr_seq_contrato, nr_protocolo_prestador, nr_seq_prot_referencia, nr_seq_periodo_pgto, dt_lib_pagamento, cd_guia_prestador, nr_seq_competencia, ie_apresentacao, ie_regime_internacao_imp, ie_tipo_internado, ie_carater_internacao_imp, ie_tipo_consulta, ie_tipo_consulta_imp, nr_seq_saida_int, nr_seq_clinica_imp, ie_internacao_obstetrica, ie_internado_imp, nr_seq_tipo_acomod_imp, nr_seq_tipo_atend_imp, nr_seq_prestador_imp, nr_seq_prestador_imp_prot, nr_seq_conselho_solic, nr_seq_conselho_exec, hr_inicio_proc, hr_inicio_proc_imp, hr_fim_proc, hr_fim_proc_imp, dt_fim_proc_sem_format, dt_fim_proc_imp_sem_format, dt_inicio_proc_sem_format, dt_inicio_proc_imp_sem_format, vl_procedimento, vl_procedimento_imp, vl_proc_unitario, dt_procedimento_imp_trunc, dt_procedimento_imp_hh, dt_procedimento_imp_min, dt_dia_semana_imp, ie_cobranca_prevista, ie_glosa, vl_unitario_imp, vl_unitario, vl_co_ptu_imp, vl_procedimento_ptu_imp, vl_material_ptu_imp, vl_calc_co_util, vl_calc_hi_util, vl_calc_mat_util, vl_materiais, vl_total_partic, vl_custo_operacional, vl_taxa_servico, vl_taxa_material, vl_taxa_co, vl_liberado, vl_medico_original, tx_item, vl_liberado_hi, vl_liberado_material, vl_liberado_co, vl_lib_taxa_servico, vl_lib_taxa_material, vl_lib_taxa_co, vl_glosa, vl_glosa_co, vl_glosa_hi, vl_glosa_material, vl_glosa_taxa_co, vl_glosa_taxa_servico, vl_glosa_taxa_material, vl_calculado_ant, vl_saldo, vl_total_procedimento, vl_taxa_co_imp, vl_taxa_servico_imp, vl_taxa_material_imp, qt_procedimento_imp, qt_procedimento, ie_via_obrigatoria, vl_participacao, tx_participacao, tx_reducao_acrescimo_imp, tx_intercambio, tx_intercambio_imp, vl_total_sem_taxa_int, vl_total_sem_taxa_int_imp, cd_area_procedimento, cd_especialidade, cd_grupo_proc, nr_seq_grupo_rec, ds_procedimento, ie_origem_conta, cd_guia_referencia, cd_guia_solic_imp, nr_seq_segurado, ie_tipo_guia, cd_medico_executor, nr_seq_grau_partic, nr_seq_grau_partic_conta, nr_seq_analise, cd_guia, nr_seq_prestador_prot, ie_status_conta, nr_seq_lote_conta, nr_seq_conta_referencia, nr_seq_protocolo, ie_status_protocolo, ie_tipo_conta, nr_seq_prestador_exec, nr_seq_prestador_exec_imp, cd_medico_executor_imp, cd_guia_imp, cd_estabelecimento, dt_atendimento_conta, cd_medico_solicitante_imp, cd_medico_solicitante, nr_seq_tipo_acomodacao, ie_internado, ie_vinc_internado, nr_seq_cbo_saude, nr_seq_cbo_saude_imp, ie_carater_internacao, nr_seq_clinica, nr_seq_tipo_atendimento, nr_seq_fatura, dt_alta_conta, dt_mes_competencia, ie_tipo_protocolo, nr_seq_congenere, dt_recebimento_fatura, dt_postagem_fatura, ie_tipo_intercambio, cd_congenere, nr_fatura, nr_nota_cobranca, nr_seq_congenere_prot, cd_pessoa_fisica_prest, nr_crm_exec, nr_seq_guia, dt_atendimento_imp, cd_cooperativa, nr_seq_prestador_solic, cd_estabelecimento_prot, nr_seq_prestador_conta, sg_estado, cd_municipio_ibge, ie_tipo_vinculo_prest_exec, cd_prestador_prot, nr_seq_clas_prest_solic, cd_prestador_solic, nr_seq_tipo_prest_solic, nr_seq_plano_conta, nr_seq_clas_prest_prot, nr_seq_clas_prest_exec, cd_prestador_exec, ie_tipo_segurado, nr_seq_tipo_prest_exec, nr_seq_tipo_prest_prot, cd_medico_solic_guia, dt_mes_competencia_trunc, ie_situacao_protocolo, ie_regime_internacao, qt_nasc_vivos_total_conta, cd_doenca_dig_conta, ie_sexo_benef, dt_nascimento_benef, ie_glosa_conta, ie_segmentacao_benef, ie_tipo_contratacao_benef, qt_idade_benef, qt_idade_benef_dia, qt_idade_benef_mes, cd_pessoa_fisica_conta, cd_cgc_conta, ie_status_guia, ie_tipo_relacao_prest_exec, ie_situacao_prest_prot, ie_situacao_prest_solic, ie_tipo_relacao_prest_prot, cd_pessoa_fisica_prest_prot, cd_cgc_prest_prot, ie_preco_pre_pos_misto, nr_seq_prestador_exec_imp_ref, nr_documento, qt_horas_atendimento_conta, dt_entrada_conta, cd_cid_principal_conta, cd_cid_principal_conta_imp, cd_cat_cid_principal_conta, cd_cat_cid_principal_conta_imp, dt_procedimento, dt_procedimento_hh, dt_procedimento_min, dt_procedimento_trunc, dt_procedimento_mes, dt_dia_semana, dt_inicio_proc, dt_inicio_proc_imp, dt_fim_proc, dt_fim_proc_imp, ie_status_pagamento_calculado, vl_co_ok, vl_hi_ok, vl_material_ok, vl_ok, vl_tx_co_ok, vl_tx_hi_ok, vl_tx_material_ok, qt_ok, dt_procedimento_real, dt_procedimento_real_trunc, dt_procedimento_real_hh, dt_procedimento_real_min, qt_dias_internacao, ie_tipo_acomodacao_ptu, ie_tipo_vinculo_prest_prot, cd_cgc_prest_exec, cd_dente, cd_face_dente, cd_regiao_boca, nr_seq_regra_acao_reemb, ie_origem_protocolo, nr_seq_nota_cobranca, ie_indicador_dorn, ie_indicador_dorn_imp, ie_acao_analise, sg_cons_prof_prest_nota_serv, nr_cons_prof_prest_nota_serv, sg_uf_cons_prest_nota_serv, cd_prest_nota_serv, dt_emissao_conta, dt_autorizacao_conta, ie_regra_data_preco_mat_exec, nr_seq_tipo_prest_exec_imp, cd_prestador_exec_imp, nr_seq_tipo_prest_prot_imp, cd_prestador_prot_imp, cd_versao_tiss, ie_tipo_internado_imp, ie_recem_nascido_imp, ie_recem_nascido, ie_alto_custo, nr_seq_prest_inter, ie_ato_cooperado, nr_seq_regra_conv, nr_seq_guia_proc, ie_status_guia_proc, nr_seq_conta_princ, tx_custo_operacional, tx_medico, nr_seq_mot_reembolso, ie_tipo_atendimento_reemb, nr_seq_regra_conta_auto, nr_seq_regra_pct_fat, ie_pacote_ptu, cd_cnes, cd_cnes_executor_imp, dt_emissao_imp, dt_atendimento_imp_dd, nr_seq_cbo_saude_solic, tp_rede_min, nr_seq_proc_princ, ie_tipo_faturamento_imp, cd_guia_ref, ie_guia_fisica, nr_lote_contabil_prov, ie_tipo_faturamento, vl_apresentado_xml, ie_estagio_complemento, nr_seq_prestador_exec_princ, dt_fim_consistencia, ie_vl_apres_sist_regra, sg_cons_prof_eqp_prio, nr_cons_prof_eqp_prio, sg_uf_cons_eqp_prio, cd_prest_eqp_prio, nr_seq_tipo_conta, ie_regime_atendimento, ie_saude_ocupacional, nr_seq_plano) AS select	/* Campos da tabela */

	a.nr_sequencia,
	a.nr_seq_conta,
	a.cd_procedimento,
	a.cd_procedimento_imp,
	a.ie_origem_proced,
	a.dt_procedimento_imp,
	a.nr_seq_preco_pacote,
	a.ie_coparticipacao,
	a.ie_co_preco_operadora,
	a.nr_seq_proc_ref,
	a.nr_seq_regra_vinculo,
	a.nr_seq_regra,
	a.nr_seq_regra_valor,
	a.nr_seq_honorario_crit,
	a.nr_seq_hon_crit_medico,
	a.ie_via_acesso,
	a.nr_seq_participante_hi,
	a.ie_tipo_liberacao,
	a.ie_via_acesso_imp,
	a.nr_seq_regra_via_acesso,
	a.ie_status_pagamento,
	a.nr_seq_regra_ctb_cred,
	a.nr_seq_regra_ctb_deb,
	a.cd_historico_glosa,
	a.cd_conta_glosa_deb,
	a.cd_conta_glosa_cred,
	a.cd_historico,
	a.cd_conta_deb,
	a.cd_conta_cred,
	a.nr_seq_tiss_tabela,
	a.ie_tecnica_utilizada,
	a.cd_tipo_tabela_imp,
	a.ds_procedimento_imp,
	coalesce(a.ie_via_acesso_manual,'N') ie_via_acesso_manual,
	a.ie_status,
	a.ie_tipo_despesa,
	a.ie_tipo_despesa_imp,
	a.nr_seq_rp_combinada,
	a.ie_tx_manual,
	a.nr_seq_regra_qtde_exec,
	a.nr_seq_regra_tipo_exec,
	coalesce(a.ie_valor_informado,'N') ie_valor_informado,
	a.ie_vl_apresentado_sistema,
	a.nr_seq_grupo_serv,
	coalesce(a.ie_criterio_horario,'N') ie_criterio_horario,
	a.nr_auxiliares,
	a.ie_autogerado,
	a.ie_regra_qtde_execucao,
	a.ie_valor_base,
	a.cd_moeda_autogerado,
	a.nr_seq_regra_tx_proc,
	a.nr_seq_regra_tx_inter,
	a.nr_seq_autogerado,
	a.vl_ch_honorario,
	a.vl_ch_custo_oper,
	a.vl_ch_custo_filme,
	a.vl_ch_anestesista,
	a.vl_prestador,
	a.nr_seq_prest_pgto_coleta,
	a.vl_exame_coleta,
	a.vl_procedimento_ptu,
	a.vl_co_ptu,
	a.vl_material_ptu,
	a.vl_pag_medico_conta,
	a.nr_seq_prestador_pgto,
	a.nr_seq_prest_pgto_medico,
	a.ie_faturamento,
	coalesce(a.vl_medico, 0) vl_medico,
	coalesce(a.vl_anestesista, 0) vl_anestesista,
	coalesce(a.vl_auxiliares, 0) vl_auxiliares,
	coalesce(a.vl_beneficiario, 0) vl_beneficiario,
	a.nr_seq_evento,
	a.nr_seq_evento_prod,
	a.nr_seq_pacote,
	d.nr_seq_contrato,
	d.nr_protocolo_prestador,
	d.nr_seq_prot_referencia,
	d.nr_seq_periodo_pgto,
	d.dt_lib_pagamento,
	d.cd_guia_prestador,
	d.nr_seq_competencia,
	d.ie_apresentacao,
	d.ie_regime_internacao_imp,
	d.ie_tipo_internado,
	d.ie_carater_internacao_imp,
	d.ie_tipo_consulta,
	d.ie_tipo_consulta_imp,
	d.nr_seq_saida_int,
	d.nr_seq_clinica_imp,
	d.ie_internacao_obstetrica,
	d.ie_internado_imp,
	d.nr_seq_tipo_acomod_imp,
	d.nr_seq_tipo_atend_imp,
	d.nr_seq_prestador_imp,
	d.nr_seq_prestador_imp_prot,
	d.nr_seq_conselho_solic,
	d.nr_seq_conselho_exec,
	to_date(to_char(a.dt_inicio_proc,'hh24:mi:ss'),'hh24:mi:ss') hr_inicio_proc,
	to_date(to_char(a.dt_inicio_proc_imp,'hh24:mi:ss'),'hh24:mi:ss') hr_inicio_proc_imp,
	to_date(to_char(a.dt_fim_proc,'hh24:mi:ss'),'hh24:mi:ss') hr_fim_proc,
	to_date(to_char(a.dt_fim_proc_imp,'hh24:mi:ss'),'hh24:mi:ss') hr_fim_proc_imp,
	a.dt_fim_proc		dt_fim_proc_sem_format,
	a.dt_fim_proc_imp	dt_fim_proc_imp_sem_format,
	a.dt_inicio_proc	dt_inicio_proc_sem_format,
	a.dt_inicio_proc_imp	dt_inicio_proc_imp_sem_format,
	coalesce(a.vl_procedimento,0) vl_procedimento,
	coalesce(a.vl_procedimento_imp,0) vl_procedimento_imp,
	coalesce(a.vl_proc_unitario, 0) vl_proc_unitario,
	trunc(a.dt_procedimento_imp,'dd') dt_procedimento_imp_trunc,
	trunc(a.dt_procedimento_imp, 'hh') dt_procedimento_imp_hh,
	trunc(a.dt_procedimento_imp, 'mi') dt_procedimento_imp_min,
	(to_char(a.dt_procedimento_imp,'d'))::numeric  dt_dia_semana_imp,
	coalesce(a.ie_cobranca_prevista,'N') ie_cobranca_prevista,
	coalesce(a.ie_glosa,'N') ie_glosa,
	coalesce(a.vl_unitario_imp, 0) vl_unitario_imp,
	coalesce(a.vl_unitario, 0) vl_unitario,
	coalesce(a.vl_co_ptu_imp, 0) vl_co_ptu_imp,
	coalesce(a.vl_procedimento_ptu_imp, 0) vl_procedimento_ptu_imp,
	coalesce(a.vl_material_ptu_imp, 0) vl_material_ptu_imp,
	coalesce(a.vl_calc_co_util, 0) vl_calc_co_util,
	coalesce(a.vl_calc_hi_util, 0) vl_calc_hi_util,         
	coalesce(a.vl_calc_mat_util, 0) vl_calc_mat_util,
	coalesce(a.vl_materiais, 0) vl_materiais,
	coalesce(a.vl_total_partic, 0) vl_total_partic,
	coalesce(a.vl_custo_operacional, 0) vl_custo_operacional,
	coalesce(a.vl_taxa_servico, 0) vl_taxa_servico,
	coalesce(a.vl_taxa_material, 0) vl_taxa_material,
	coalesce(a.vl_taxa_co, 0) vl_taxa_co,
	coalesce(a.vl_liberado, 0) vl_liberado,
	coalesce(a.vl_medico_original, 0) vl_medico_original,
	coalesce(a.tx_item, 100) tx_item,
	coalesce(a.vl_liberado_hi, 0) vl_liberado_hi,
	coalesce(a.vl_liberado_material, 0) vl_liberado_material,
	coalesce(a.vl_liberado_co, 0) vl_liberado_co,
	coalesce(a.vl_lib_taxa_servico, 0) vl_lib_taxa_servico,
	coalesce(a.vl_lib_taxa_material, 0) vl_lib_taxa_material,
	coalesce(a.vl_lib_taxa_co, 0) vl_lib_taxa_co,
	coalesce(a.vl_glosa, 0) vl_glosa,
	coalesce(a.vl_glosa_co, 0) vl_glosa_co,
	coalesce(a.vl_glosa_hi, 0) vl_glosa_hi,
	coalesce(a.vl_glosa_material, 0) vl_glosa_material,
	coalesce(a.vl_glosa_taxa_co, 0) vl_glosa_taxa_co,
	coalesce(a.vl_glosa_taxa_servico, 0) vl_glosa_taxa_servico,
	coalesce(a.vl_glosa_taxa_material, 0) vl_glosa_taxa_material,
	coalesce(a.vl_calculado_ant, 0) vl_calculado_ant,
	coalesce(a.vl_saldo, 0 ) vl_saldo,
	coalesce(a.vl_total_procedimento, 0) vl_total_procedimento,
	-- foi feito este arredondamento pelo motivo que os campos foram criados com precisao de quatro casas e o resto do nosso mundo trabalha com duas

	round((coalesce(a.vl_taxa_co_imp, 0))::numeric, 2) vl_taxa_co_imp,
	round((coalesce(a.vl_taxa_servico_imp, 0))::numeric, 2) vl_taxa_servico_imp,
	round((coalesce(a.vl_taxa_material_imp, 0))::numeric, 2) vl_taxa_material_imp,
	-- ja estes arredondamentos foram feitos porque na autorizacao/requisicao se trabalha com tres casas de precisao e na nova especificacao do TISS foi colocada apenas duas casas.

	round((coalesce(a.qt_procedimento_imp, 1))::numeric, 2) qt_procedimento_imp,
	round((coalesce(a.qt_procedimento, 0))::numeric, 2) qt_procedimento,
	coalesce(a.ie_via_obrigatoria, 'N') ie_via_obrigatoria,
	coalesce(a.vl_participacao, 0) vl_participacao,
	coalesce(a.tx_participacao, 0) tx_participacao,
	coalesce(a.tx_reducao_acrescimo_imp, 0) tx_reducao_acrescimo_imp,
	coalesce(a.tx_intercambio,0) tx_intercambio,
	coalesce(a.tx_intercambio_imp,0) tx_intercambio_imp,
	(coalesce(a.vl_calc_co_util, 0)	+         
	coalesce(a.vl_calc_hi_util, 0)	+  
	coalesce(a.vl_calc_mat_util, 0)) vl_total_sem_taxa_int,
	(coalesce(a.vl_procedimento_imp, 0) -
	(coalesce(a.vl_taxa_co_imp, 0) + 
	coalesce(a.vl_taxa_material_imp, 0) + 
	coalesce(a.vl_taxa_servico_imp, 0))) vl_total_sem_taxa_int_imp,
	(select	b.cd_area_procedimento
	 FROM	estrutura_procedimento_v	b
	 where	b.ie_origem_proced		= a.ie_origem_proced
	 and	b.cd_procedimento		= a.cd_procedimento) cd_area_procedimento,
	(select	b.cd_especialidade
	 from	estrutura_procedimento_v	b
	 where	b.ie_origem_proced		= a.ie_origem_proced
	 and	b.cd_procedimento		= a.cd_procedimento) cd_especialidade,
	(select	b.cd_grupo_proc
	 from	estrutura_procedimento_v	b
	 where	b.ie_origem_proced		= a.ie_origem_proced
	 and	b.cd_procedimento		= a.cd_procedimento) cd_grupo_proc,
	(select	c.nr_seq_grupo_rec
	 from	procedimento			c
	 where	c.ie_origem_proced		= a.ie_origem_proced
	 and	c.cd_procedimento		= a.cd_procedimento) nr_seq_grupo_rec,
	 (select c.ds_procedimento
	 from	procedimento			c
	 where	c.ie_origem_proced		= a.ie_origem_proced
	 and	c.cd_procedimento		= a.cd_procedimento) ds_procedimento,
	d.ie_origem_conta,
	d.cd_guia_referencia,
	d.cd_guia_solic_imp,
	d.nr_seq_segurado,
	d.ie_tipo_guia,
	d.cd_medico_executor,
	d.nr_seq_grau_partic,
	d.nr_seq_grau_partic_conta,
	d.nr_seq_analise,
	d.cd_guia,
	d.nr_seq_prestador_prot,
	d.ie_status	ie_status_conta,
	d.nr_seq_lote_conta,
	d.nr_seq_conta_referencia,
	d.nr_seq_protocolo,
	d.ie_status_protocolo,
	d.ie_tipo_conta,
	d.nr_seq_prestador_exec,
	d.nr_seq_prestador_exec_imp,
	d.cd_medico_executor_imp,
	d.cd_guia_imp,
	d.cd_estabelecimento,
	d.dt_atendimento dt_atendimento_conta,
	d.cd_medico_solicitante_imp,
	d.cd_medico_solicitante,
	d.nr_seq_tipo_acomodacao,
	d.ie_internado,
	d.ie_vinc_internado,
	d.nr_seq_cbo_saude,
	d.nr_seq_cbo_saude_imp,
	d.ie_carater_internacao,
	d.nr_seq_clinica,
	d.nr_seq_tipo_atendimento,
	d.nr_seq_fatura,
	d.dt_alta dt_alta_conta,
	d.dt_mes_competencia,
	d.ie_tipo_protocolo,
	d.nr_seq_congenere,
	d.dt_recebimento_fatura,
	d.dt_postagem_fatura,
	d.ie_tipo_intercambio,
	d.cd_congenere,
	d.nr_fatura,
	d.nr_nota_cobranca,
	d.nr_seq_congenere_prot,
	d.cd_pessoa_fisica_prest,
	d.nr_crm_exec,
	d.nr_seq_guia,
	d.dt_atendimento_imp,
	d.cd_cooperativa,
	d.nr_seq_prestador_solic,
	d.cd_estabelecimento_prot,
	d.nr_seq_prestador_conta,
	d.sg_estado,
	d.cd_municipio_ibge,
	d.ie_tipo_vinculo_prest_exec,
	d.cd_prestador_prot,
	d.nr_seq_clas_prest_solic,
	d.cd_prestador_solic, 
	d.nr_seq_tipo_prest_solic,
	d.nr_seq_plano_conta,
	d.nr_seq_clas_prest_prot,
	d.nr_seq_clas_prest_exec,
	d.cd_prestador_exec,
	d.ie_tipo_segurado,
	d.nr_seq_tipo_prest_exec,
	d.nr_seq_tipo_prest_prot,
	d.cd_medico_solic_guia,
	d.dt_mes_competencia_trunc,
	d.ie_situacao_protocolo,
	d.ie_regime_internacao,
	d.qt_nasc_vivos_total qt_nasc_vivos_total_conta,
	d.cd_doenca_dig cd_doenca_dig_conta,
	d.ie_sexo_benef,
	d.dt_nascimento_benef,
	d.ie_glosa ie_glosa_conta,
	d.ie_segmentacao_benef,
	d.ie_tipo_contratacao_benef,
	d.qt_idade_benef,
	d.qt_idade_benef_dia,
	d.qt_idade_benef_mes,
	d.cd_pessoa_fisica_conta,
	d.cd_cgc_conta,
	d.ie_status_guia,
	d.ie_tipo_relacao_prest_exec,
	d.ie_situacao_prest_prot,
	d.ie_situacao_prest_solic,
	d.ie_tipo_relacao_prest_prot,
	d.cd_pessoa_fisica_prest_prot,
	d.cd_cgc_prest_prot,
	d.ie_preco_pre_pos_misto,
	d.nr_seq_prestador_exec_imp_ref,
	d.nr_documento,
	d.qt_horas_atendimento qt_horas_atendimento_conta,
	d.dt_entrada dt_entrada_conta,
	d.cd_cid_principal cd_cid_principal_conta,
	d.cd_cid_principal cd_cid_principal_conta_imp,
	d.cd_cat_cid_principal  cd_cat_cid_principal_conta,
	d.cd_cat_cid_principal  cd_cat_cid_principal_conta_imp,
	-- Data de atendimento do procedimento. Este campo e alimentado via trigger. E nela que esta a regra de negocio para decidir qual e a data correta

	a.dt_procedimento_referencia dt_procedimento,
	trunc(a.dt_procedimento_referencia, 'hh') dt_procedimento_hh,
	trunc(a.dt_procedimento_referencia, 'mi') dt_procedimento_min,
	dt_procedimento_referencia_sh dt_procedimento_trunc,
	trunc(a.dt_procedimento_referencia, 'mm') dt_procedimento_mes,
	(to_char(a.dt_procedimento_referencia, 'd'))::numeric  dt_dia_semana,
	pls_manipulacao_datas_pck.obter_data_mais_hora(a.dt_procedimento_referencia, a.dt_inicio_proc) dt_inicio_proc,
	pls_manipulacao_datas_pck.obter_data_mais_hora(a.dt_procedimento_imp, a.dt_inicio_proc_imp) dt_inicio_proc_imp,
	pls_manipulacao_datas_pck.obter_data_mais_hora(a.dt_procedimento_referencia, a.dt_fim_proc) dt_fim_proc,
	pls_manipulacao_datas_pck.obter_data_mais_hora(a.dt_procedimento_imp, a.dt_fim_proc_imp) dt_fim_proc_imp,
	pls_obter_stat_pag_item(a.ie_glosa, a.vl_liberado, a.vl_glosa) ie_status_pagamento_calculado,
	pls_obter_vl_valido_item( 'P', a.nr_seq_proc_ref, a.vl_co_ptu_imp, a.vl_calc_co_util, a.vl_liberado_co,  null, null, a.ie_status, 'VL') vl_co_ok,
	pls_obter_vl_valido_item( 'P', a.nr_seq_proc_ref, a.vl_procedimento_ptu_imp, a.vl_calc_hi_util, a.vl_liberado_hi, null, null, a.ie_status, 'VL') vl_hi_ok,
	pls_obter_vl_valido_item( 'P', a.nr_seq_proc_ref, a.vl_material_ptu_imp, a.vl_calc_mat_util, a.vl_liberado_material, null, null, a.ie_status, 'VL') vl_material_ok,
	pls_obter_vl_valido_item( 'P', a.nr_seq_proc_ref, a.vl_procedimento_imp, a.vl_procedimento, a.vl_liberado, null, null, a.ie_status, 'VL') vl_ok,
	pls_obter_vl_valido_item( 'P', a.nr_seq_proc_ref, a.vl_taxa_co_imp, a.vl_taxa_co, a.vl_lib_taxa_co, null, null, a.ie_status, 'VL') vl_tx_co_ok,
	pls_obter_vl_valido_item( 'P', a.nr_seq_proc_ref, a.vl_taxa_servico_imp, a.vl_taxa_servico, a.vl_lib_taxa_servico, null, null, a.ie_status, 'VL') vl_tx_hi_ok,
	pls_obter_vl_valido_item( 'P', a.nr_seq_proc_ref, a.vl_taxa_material_imp, a.vl_taxa_material, a.vl_lib_taxa_material, null, null, a.ie_status, 'VL') vl_tx_material_ok,
	pls_obter_vl_valido_item( 'P', a.nr_seq_proc_ref, null, null, null, a.qt_procedimento_imp, a.qt_procedimento, a.ie_status,  'QT') qt_ok,
	dt_procedimento dt_procedimento_real,
	trunc(a.dt_procedimento,'dd') dt_procedimento_real_trunc,
	trunc(a.dt_procedimento, 'hh') dt_procedimento_real_hh,
	trunc(a.dt_procedimento, 'mi') dt_procedimento_real_min,
	d.qt_dias_internacao,
	d.ie_tipo_acomodacao_ptu,
	d.ie_tipo_vinculo_prest_prot,
	d.cd_cgc_prest_exec,
	a.cd_dente, 
	pls_obter_faces_dente_proc(a.nr_sequencia) cd_face_dente,
	a.cd_regiao_boca,
	a.nr_seq_regra_acao_reemb,
	d.ie_origem_protocolo,
	d.nr_seq_nota_cobranca,
	d.ie_indicador_dorn,
	d.ie_indicador_dorn_imp,
	a.ie_acao_analise,
	(select	max(b.sg_cons_prof_prest) from ptu_nota_servico b where b.nr_seq_conta_proc = a.nr_sequencia) sg_cons_prof_prest_nota_serv,
	(select	max(b.nr_cons_prof_prest) from ptu_nota_servico b where b.nr_seq_conta_proc = a.nr_sequencia) nr_cons_prof_prest_nota_serv,
	(select	max(b.sg_uf_cons_prest) from ptu_nota_servico b where b.nr_seq_conta_proc = a.nr_sequencia)   sg_uf_cons_prest_nota_serv,
	(select	max(b.cd_prestador) from ptu_nota_servico b where b.nr_seq_conta_proc = a.nr_sequencia)   cd_prest_nota_serv,
	d.dt_emissao dt_emissao_conta,
	d.dt_autorizacao dt_autorizacao_conta,
	d.ie_regra_data_preco_mat_exec,
	d.nr_seq_tipo_prest_exec_imp,
	d.cd_prestador_exec_imp,
	d.nr_seq_tipo_prest_prot_imp,
	d.cd_prestador_prot_imp,
	d.cd_versao_tiss,
	d.ie_tipo_internado_imp,
	d.ie_recem_nascido_imp,
	d.ie_recem_nascido,
	a.ie_alto_custo,
	d.nr_seq_prest_inter,
	a.ie_ato_cooperado,
	a.nr_seq_regra_conv,
	a.nr_seq_guia nr_seq_guia_proc,
	(select	max(guia.ie_status)
	from	pls_guia_plano guia
	where	guia.nr_sequencia = a.nr_seq_guia) ie_status_guia_proc,
	d.nr_seq_conta_princ,
	coalesce(a.tx_custo_operacional, 100) tx_custo_operacional,
	coalesce(a.tx_medico,100) tx_medico,
	d.nr_seq_mot_reembolso,
	d.ie_tipo_atendimento_reemb,
	d.nr_seq_regra_conta_auto,
	a.nr_seq_regra_pct_fat,
	a.ie_pacote_ptu,
	d.cd_cnes,
	d.cd_cnes_executor_imp,
	d.dt_emissao_imp_dd dt_emissao_imp,
	d.dt_atendimento_imp_dd,
	d.nr_seq_cbo_saude_solic,
	d.tp_rede_min,
	a.nr_seq_proc_princ,
	d.ie_tipo_faturamento_imp,
	d.cd_guia_ref,
	d.ie_guia_fisica,
	a.nr_lote_contabil_prov,
	d.ie_tipo_faturamento,
	a.vl_apresentado_xml,
	d.ie_estagio_complemento,
	d.nr_seq_prestador_exec_princ,
	d.dt_fim_consistencia,
	(select max(x.ie_vl_apresentado_sistema) from pls_conta_proc_regra x where x.nr_sequencia = a.nr_sequencia) ie_vl_apres_sist_regra,	
	(select max(x.sg_cons_prof_prest_nota_serv) from pls_conta_proc_regra x where x.nr_sequencia = a.nr_sequencia) sg_cons_prof_eqp_prio,
	(select max(x.nr_cons_prof_prest_nota_serv) from pls_conta_proc_regra x where x.nr_sequencia = a.nr_sequencia) nr_cons_prof_eqp_prio,
	(select max(x.sg_uf_cons_prest_nota_serv) from pls_conta_proc_regra x where x.nr_sequencia = a.nr_sequencia) sg_uf_cons_eqp_prio,
	(select max(x.cd_prest_eqp_nota_serv) from pls_conta_proc_regra x where x.nr_sequencia = a.nr_sequencia) cd_prest_eqp_prio,
	d.nr_seq_tipo_conta,
	d.ie_regime_atendimento,
	d.ie_saude_ocupacional,
	d.nr_seq_plano
from	pls_conta_proc			a,
	pls_conta_v 			d
where	d.nr_sequencia			= a.nr_seq_conta;

