-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ptu_servico_fundacao_v (nr_seq_servico, tp_registro, nr_sequencia, nr_seq_fatura, cd_unimed, nr_seq_contrato, nr_contrato_interno, cd_familia, cd_dependente, nm_beneficiario, nr_seq_guia, dt_emissao, dt_mes_fatura, dt_ano_fatura, ie_tipo_prestador, nm_prestador_exec, cd_especialidade, cd_servico, ds_servico, nm_solicitante, qt_servico, vl_carga_horaria, vl_procedimento, vl_total_servicos, vl_retencao_ir, vl_filme, cd_participacao, hr_execucao, cd_especialidade_prest, dt_internacao, dt_alta, cd_ato, cd_cid, ind_ato_cooperativo, tx_administrativa, ind_via_acesso, hr_entrada, hr_saida, cd_prestador_executor, ie_classif_hosp, nr_seq_contrato_interno, cd_sublocal, vl_um, vl_dois, vl_tres, vl_integral, nr_matricula, cd_tiss_operadora, cd_tiss_prof_exec, nr_cons_prof_exec, sg_cons_prof_exec, ie_tipo_consulta, ie_tipo_saida, cd_carater_solic, ie_ind_clinica, cd_cnes_executor, ie_tipo_atend_sadt, ie_carater_internacao, ie_tipo_internacao, ie_regime_internacao, qt_diarias_solic, ie_tipo_acomodacao, cd_motivo_saida, nr_seq_procedimento, ie_ind_faturamento, nr_guia_referencia, cd_cod_despesa, ie_tabela, nr_cpf_cnpj_executor, dt_atendimento, nr_cpf_cnpj_solic, ie_obito_mulher, ie_obito_neonatal_precoce, ie_obito_neonatal_tardio, qt_nasc_vivos, qt_nasc_vivos_termo, qt_nasc_mortos, qt_nasc_prematuro, qt_obito_prematuro, qt_obito_termo, cd_cid_obito, qt_declara_obito, ie_tipo_guia, ds_campo, ie_ano_campo, nr_seq_lote, ie_iden_guia, nr_seq_procedimento_2, cd_unimed_executora, ie_int_gestacao, ie_int_aborto, ie_int_trans_mat, ie_int_complic_puerperio, ie_int_atend_parto, ie_int_complic_neonatal, ie_int_baixo_peso, ie_int_parto_cesareo, ie_int_parto_normal) AS select	c.nr_seq_serv_pre_pagto		nr_seq_servico,
	1				tp_registro,
	1				nr_sequencia,
	null				nr_seq_fatura,
	c.cd_unimed			cd_unimed,
	h.nr_seq_contrato		nr_seq_contrato,
	h.nr_seq_contrato		nr_contrato_interno,
	h.cd_matricula_familia		cd_familia,
	i.cd_usuario_plano		cd_dependente,
	c.nm_beneficiario		nm_beneficiario,
	g.cd_guia			nr_seq_guia,
	g.dt_emissao			dt_emissao,
	null				dt_mes_fatura,
	null				dt_ano_fatura,
	d.ie_tipo_prestador		ie_tipo_prestador,
	d.nm_prestador			nm_prestador_exec,
	d.cd_especialidade		cd_especialidade,
	d.cd_procedimento		cd_servico,
	substr(ptu_obter_nome_servico(d.ie_tipo_tabela,d.cd_procedimento,d.ie_origem_proced),1,255) ds_servico,
	substr(obter_nome_medico(g.cd_medico_solicitante,'N'),1,255) nm_solicitante,
	d.qt_procedimento		qt_servico,
	0				vl_carga_horaria,
	d.vl_procedimento		vl_procedimento,
	null				vl_total_servicos,
	null				vl_retencao_ir,
	d.vl_filme			vl_filme,
	d.ie_tipo_participacao		cd_participacao,
	d.ds_hora_procedimento		hr_execucao,
	d.cd_especialidade		cd_especialidade_prest,
	a.dt_internacao			dt_internacao,
	a.dt_alta			dt_alta,
	d.cd_ato			cd_ato,
	c.cd_cid			cd_cid,
	'N'				ind_ato_cooperativo,
	d.tx_procedimento		tx_administrativa,
	d.ie_via_acesso			ind_via_acesso,
	g.dt_entrada			hr_entrada,
	g.dt_alta			hr_saida,
	d.cd_prestador			cd_prestador_executor,
	'0'				ie_classif_hosp,
	h.nr_seq_contrato		nr_seq_contrato_interno,
	0				cd_sublocal,
	0				vl_um,
	0				vl_dois,
	0				vl_tres,
	0				vl_integral,
	0				nr_matricula,
	(select	cd_cgc_outorgante x FROM pls_outorgante x where x.cd_estabelecimento = f.cd_estabelecimento) cd_tiss_operadora,
	'0'				cd_tiss_prof_exec,
	d.nr_cons_prof_prest		nr_cons_prof_exec,
	d.sg_cons_prof_prest		sg_cons_prof_exec,
	'0'				ie_tipo_consulta,
	c.ie_tipo_saida_spdat		ie_tipo_saida,
	c.ie_carater_atendimento	cd_carater_solic,
	'0'				ie_ind_clinica,
	d.cd_cnes_prest			cd_cnes_executor,
	c.ie_tipo_atendimento		ie_tipo_atend_sadt,
	g.ie_carater_internacao		ie_carater_internacao,
	a.ie_tipo_internacao		ie_tipo_internacao,
	g.ie_regime_internacao		ie_regime_internacao,
	0				qt_diarias_solic,
	a.ie_tipo_acomodacao		ie_tipo_acomodacao,
	'0'				cd_motivo_saida,
	0				nr_seq_procedimento,
	'0'				ie_ind_faturamento,
	0				nr_guia_referencia,
	'0'				cd_cod_despesa,
	'0'				ie_tabela,
	d.nr_cgc_cpf			nr_cpf_cnpj_executor,
	c.dt_atendimento		dt_atendimento,
	d.nr_cgc_cpf_req		nr_cpf_cnpj_solic,
	a.ie_obito_mulher		ie_obito_mulher,
	0				ie_obito_neonatal_precoce,
	0				ie_obito_neonatal_tardio,
	a.qt_nasc_vivos			qt_nasc_vivos,
	a.qt_nasc_vivos			qt_nasc_vivos_termo,
	a.qt_nasc_mortos		qt_nasc_mortos,
	a.qt_nasc_vivos_pre		qt_nasc_prematuro,
	a.qt_obito_precoce		qt_obito_prematuro,
	a.qt_obito_tardio		qt_obito_termo,
	a.cd_cid_obito			cd_cid_obito,
	0				qt_declara_obito,
	g.ie_tipo_guia			ie_tipo_guia,
	' '				ds_campo,
	' '				ie_ano_campo,
	' '				nr_seq_lote,
	' '				ie_iden_guia,
	' '				nr_seq_procedimento_2,
	d.cd_unimed_prestador		cd_unimed_executora,
	a.ie_int_gestacao		ie_int_gestacao,
	a.ie_int_aborto			ie_int_aborto,
	a.ie_int_transtorno		ie_int_trans_mat,
	a.ie_int_puerperio		ie_int_complic_puerperio,
	' '				ie_int_atend_parto,
	a.ie_int_neonatal		ie_int_complic_neonatal,
	a.ie_int_baixo_peso		ie_int_baixo_peso,
	a.ie_int_parto_cesarea		ie_int_parto_cesareo,
	a.ie_int_parto_normal		ie_int_parto_normal
FROM pls_segurado_carteira i, pls_segurado h, pls_conta g, ptu_servico_pre_pagto f, ptu_nota_servico d, ptu_nota_cobranca c
LEFT OUTER JOIN ptu_nota_hospitalar a ON (c.nr_sequencia = a.nr_seq_nota_cobr)
WHERE d.nr_seq_nota_cobr	= c.nr_sequencia and g.nr_seq_serv_pre_pagto	= f.nr_sequencia and g.nr_seq_segurado	= h.nr_sequencia and i.nr_seq_segurado	= h.nr_sequencia and c.nr_seq_serv_pre_pagto	= f.nr_sequencia

union all

select	max(c.nr_seq_serv_pre_pagto)	nr_seq_servico,
	2				tp_registro,
	2				nr_sequencia,
	max(c.nr_seq_serv_pre_pagto)	nr_seq_fatura,
	max(c.cd_unimed)		cd_unimed,
	0		nr_seq_contrato,
	null				nr_contrato_interno,
	0				cd_familia,
	max(c.cd_usuario_plano)		cd_dependente,
	max(c.nm_beneficiario)		nm_beneficiario,
	null				nr_seq_guia,
	max(f.dt_geracao)		dt_emissao,
	max(trunc(f.dt_geracao,'mm'))	dt_mes_fatura,
	max(trunc(f.dt_geracao,'yyyy'))	dt_ano_fatura,
	null				ie_tipo_prestador,
	null				nm_prestador_exec,
	null				cd_especialidade,
	null				cd_servico,
	null				ds_servico,
	null				nm_solicitante,
	null				qt_servico,
	null				vl_carga_horaria,
	null				vl_procedimento,
	sum(d.vl_procedimento)		vl_total_servicos,
	0				vl_retencao_ir,
	null				vl_filme,
	null				cd_participacao,
	null				hr_execucao,
	null				cd_especialidade_prest,
	null				dt_internacao,
	null				dt_alta,
	null				cd_ato,
	null				cd_cid,
	null				ind_ato_cooperativo,
	null				tx_administrativa,
	null				ind_via_acesso,
	null				hr_entrada,
	null				hr_saida,
	null				cd_prestador_executor,
	null				ie_classif_hosp,
	null				nr_seq_contrato_interno,
	null				cd_sublocal,
	null				vl_um,
	null				vl_dois,
	null				vl_tres,
	null				vl_integral,
	null				nr_matricula,
	null				cd_tiss_operadora,
	null				cd_tiss_prof_exec,
	null				nr_cons_prof_exec,
	null				sg_cons_prof_exec,
	null				ie_tipo_consulta,
	null				ie_tipo_saida,
	null				cd_carater_solic,
	null				ie_ind_clinica,
	null				cd_cnes_executor,
	null				ie_tipo_atend_sadt,
	null				ie_carater_internacao,
	null				ie_tipo_internacao,
	null				ie_regime_internacao,
	null				qt_diarias_solic,
	null				ie_tipo_acomodacao,
	null				cd_motivo_saida,
	null				nr_seq_procedimento,
	null				ie_ind_faturamento,
	null				nr_guia_referencia,
	null				cd_cod_despesa,
	null				ie_tabela,
	null				nr_cpf_cnpj_executor,
	null				dt_atendimento,
	null				nr_cpf_cnpj_solic,
	null				ie_obito_mulher,
	null				ie_obito_neonatal_precoce,
	null				ie_obito_neonatal_tardio,
	null				qt_nasc_vivos,
	null				qt_nasc_vivos_termo,
	null				qt_nasc_mortos,
	null				qt_nasc_prematuro,
	null				qt_obito_prematuro,
	null				qt_obito_termo,
	null				cd_cid_obito,
	null				qt_declara_obito,
	null				ie_tipo_guia,
	null				ds_campo,
	null				ie_ano_campo,
	null				nr_seq_lote,
	null				ie_iden_guia,
	null				nr_seq_procedimento_2,
	null				cd_unimed_executora,
	null				ie_int_gestacao,
	null				ie_int_aborto,
	null				ie_int_trans_mat,
	null				ie_int_complic_puerperio,
	null				ie_int_atend_parto,
	null				ie_int_complic_neonatal,
	null				ie_int_baixo_peso,
	null				ie_int_parto_cesareo,
	null				ie_int_parto_normal
FROM ptu_servico_pre_pagto f, ptu_nota_servico d, ptu_nota_hospitalar a
LEFT OUTER JOIN ptu_nota_cobranca c ON (a.nr_seq_nota_cobr = c.nr_sequencia)
WHERE d.nr_seq_nota_cobr	= c.nr_sequencia and c.nr_seq_serv_pre_pagto	= f.nr_sequencia;

