-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW qua_auditoria_item_relat_v (ordem, nr_seq_audit, nr_seq_item_result, nr_seq_tipo, cd_classificacao, ds_item, nr_seq_item, nr_seq_apres, ie_resultado, ds_orientacao, ds_complemento, ie_permite_na, nr_seq_apres_cap, nr_seq_apres_estrut, nr_seq_apres_item, nr_seq_audit_estrut, nr_seq_apres_subitem, nr_seq_subitem) AS select	1 ordem,
	b.nr_sequencia nr_seq_audit,
	0 nr_seq_item_result,
	a.nr_seq_tipo,
	a.cd_classificacao,
	'#' || c.ds_capitulo || '#N' ds_item,
	0 nr_seq_item,
	0 nr_seq_apres,
	'' ie_resultado,
	'' ds_orientacao,
	'' ds_complemento,
	'S' ie_permite_na,
	coalesce(c.nr_seq_apres,0) nr_seq_apres_cap,
	coalesce(a.nr_seq_apres,0) nr_seq_apres_estrut,
	0 nr_seq_apres_item,
	a.nr_sequencia nr_seq_audit_estrut,
	0 nr_seq_apres_subitem,
	0  nr_seq_subitem
FROM	qua_auditoria_cap c,
	qua_auditoria b,
	qua_auditoria_estrut a
where	a.nr_seq_tipo = b.nr_seq_tipo
and	a.nr_seq_cap = c.nr_sequencia
and	c.ie_situacao = 'A'

union

select	2 ordem,
	b.nr_sequencia nr_seq_audit,
	0 nr_seq_item_result,
	a.nr_seq_tipo,
	a.cd_classificacao,
	'#' || CASE WHEN a.nr_seq_cap IS NULL THEN a.ds_estrutura  ELSE '    ' || a.ds_estrutura END  || '#N#G' ds_item,
	0 nr_seq_item,
	0 nr_seq_apres,
	'' ie_resultado,
	'' ds_orientacao,
	'' ds_complemento,
	'S' ie_permite_na,
	coalesce(c.nr_seq_apres,0) nr_seq_apres_cap,
	coalesce(a.nr_seq_apres,0) nr_seq_apres_estrut,
	0 nr_seq_apres_item,
	a.nr_sequencia nr_seq_audit_estrut,
	0 nr_seq_apres_subitem,
	0  nr_seq_subitem
from	qua_auditoria_cap c,
	qua_auditoria b,
	qua_auditoria_estrut a
where	a.nr_seq_tipo = b.nr_seq_tipo
and	a.nr_seq_cap = c.nr_sequencia
and	c.ie_situacao = 'A'

union

select	3 ordem,
	d.nr_sequencia nr_seq_audit,
	c.nr_sequencia nr_seq_item_result,
	a.nr_seq_tipo,
	a.cd_classificacao,
	'        ' || b.nr_seq_apres || ' ' || b.ds_item ds_item,
	b.nr_sequencia nr_seq_item,
	b.nr_seq_apres,
	c.ie_resultado,
	b.ds_orientacao,
	c.ds_complemento,
	b.ie_permite_na,
	coalesce(e.nr_seq_apres,0) nr_seq_apres_cap,
	coalesce(a.nr_seq_apres,0) nr_seq_apres_estrut,
	coalesce(b.nr_seq_apres,0) nr_seq_apres_item,
	a.nr_sequencia nr_seq_audit_estrut,
	0 nr_seq_apres_subitem,
	0  nr_seq_subitem
from	qua_auditoria_cap e,
	qua_auditoria d,
	qua_auditoria_result c,
	qua_auditoria_item b,
	qua_auditoria_estrut a
where	b.nr_seq_estrutura = a.nr_sequencia
and	d.nr_sequencia = c.nr_seq_auditoria
and	a.nr_seq_cap = e.nr_sequencia
and	d.nr_seq_tipo = a.nr_seq_tipo
and	coalesce(c.nr_seq_subitem,0) = 0
and	c.nr_seq_item = b.nr_sequencia

union

select	4 ordem,
	d.nr_sequencia nr_seq_audit,
	c.nr_sequencia nr_seq_item_result,
	a.nr_seq_tipo,
	a.cd_classificacao,
	'               ' || b.nr_seq_apres || ' ' || s.ds_item ds_item,
	b.nr_sequencia nr_seq_item,
	b.nr_seq_apres,
	c.ie_resultado,
	s.ds_orientacao,
	c.ds_complemento,
	b.ie_permite_na,
	coalesce(e.nr_seq_apres,0) nr_seq_apres_cap,
	coalesce(a.nr_seq_apres,0) nr_seq_apres_estrut,
	coalesce(b.nr_seq_apres,0) nr_seq_apres_item,
	a.nr_sequencia nr_seq_audit_estrut,
	coalesce(s.nr_seq_apres,0) nr_seq_apres_subitem,
	s.nr_sequencia nr_seq_subitem
from	qua_auditoria_cap e,
	qua_auditoria d,
	qua_auditoria_result c,
	qua_auditoria_item b,
	qua_auditoria_subitem s,
	qua_auditoria_estrut a
where	b.nr_seq_estrutura = a.nr_sequencia
and	d.nr_sequencia = c.nr_seq_auditoria
and	a.nr_seq_cap = e.nr_sequencia
and	s.nr_seq_item = b.nr_sequencia
and	d.nr_seq_tipo = a.nr_seq_tipo
and	s.nr_sequencia= c.nr_seq_subitem
and	c.nr_seq_item = b.nr_sequencia;

