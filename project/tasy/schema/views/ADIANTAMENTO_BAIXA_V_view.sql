-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW adiantamento_baixa_v (nr_adiantamento, dt_baixa, ds_documento, nr_documento, nm_usuario, nr_sequencia, nr_seq_trans_fin, vl_baixa) AS select	a.nr_adiantamento,
	b.dt_recebimento dt_baixa,
	obter_desc_expressao(340284) ds_documento, --'Baixa de título a receber'
	b.nr_titulo nr_documento,
	b.nm_usuario nm_usuario,
	b.nr_sequencia nr_sequencia,
	b.nr_seq_trans_fin nr_seq_trans_fin,
	coalesce(vl_recebido,0) + coalesce(vl_rec_maior,0) + coalesce(vl_juros,0) + coalesce(vl_multa,0) vl_baixa
FROM	adiantamento a,
	titulo_receber_liq b
where	a.nr_adiantamento	= b.nr_adiantamento
and	coalesce(b.ie_lib_caixa, 'S') = 'S'

union all

select	a.nr_adiantamento,
	a.dt_devolucao dt_baixa,
	obter_desc_expressao(499989) ds_documento,  --'Devolução de adiantamento'
	a.nr_sequencia nr_documento,
	a.nm_usuario nm_usuario,
	a.nr_sequencia nr_sequencia,
	a.nr_seq_trans_fin_baixa nr_seq_trans_fin,
	coalesce(a.vl_devolucao,0) vl_baixa
from	adiantamento_dev a

union all

select	a.nr_adiantamento,
	a.dt_recebimento dt_baixa,
	obter_desc_expressao(799004) ds_documento,  --'Recebimentos do retorno convênio'
	b.nr_seq_retorno nr_documento,
	a.nm_usuario nm_usuario,
	a.nr_sequencia nr_sequencia,
	a.nr_seq_trans_fin nr_seq_trans_fin,
	coalesce(b.vl_vinculacao,0)
from	adiantamento d,
	convenio_retorno c,
	convenio_ret_receb b,
	convenio_receb a
where	b.nr_seq_receb		= a.nr_sequencia
and	b.nr_seq_retorno	= c.nr_sequencia
and	c.ie_status_retorno	<> 'F'
and	a.nr_adiantamento = d.nr_adiantamento

union all

select	a.nr_adiantamento,
	coalesce(a.dt_atualizacao_nrec, a.dt_atualizacao) dt_baixa,
	obter_desc_expressao(799004) ds_documento,  --'Recebimentos do retorno convênio'
	a.nr_seq_receb nr_documento,
	a.nm_usuario nm_usuario,
	a.nr_sequencia nr_sequencia,
	b.nr_seq_trans_fin nr_seq_trans_fin,
	coalesce(a.vl_vinculado,0) vl_baixa
from	adiantamento b,
	convenio_receb_adiant a
where	a.nr_adiantamento = b.nr_adiantamento
and (not exists (select	1
	from	convenio_retorno y,
		convenio_ret_receb x
	where	y.ie_status_retorno	= 'F'
	and	x.nr_seq_retorno	= y.nr_sequencia
	and	x.nr_seq_receb	= a.nr_seq_receb) or
	not exists (select	1
	from	titulo_receber_liq x
	where	x.nr_adiantamento	= a.nr_adiantamento))

union all

select	a.nr_adiantamento,
	a.dt_recebimento dt_baixa,
	obter_desc_expressao(799008),  --'Recebimentos vinculados ao lote de análise'
	b.nr_seq_receb nr_documento,
	a.nm_usuario nm_usuario,
	a.nr_sequencia nr_sequencia,
	a.nr_seq_trans_fin nr_seq_trans_fin,
	coalesce(b.vl_vinculado,0) vl_baixa
from	adiantamento d,
	lote_audit_hist c,
	lote_audit_hist_receb b,
	convenio_receb a
where	b.nr_seq_receb	= a.nr_sequencia
and	b.nr_seq_lote	= c.nr_sequencia
and	a.nr_adiantamento	= d.nr_adiantamento
and	c.dt_fechamento	is null;

