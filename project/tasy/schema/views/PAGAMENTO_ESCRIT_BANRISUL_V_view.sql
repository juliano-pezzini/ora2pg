-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pagamento_escrit_banrisul_v (tp_registro, cd_banco, cd_seg_registro, cd_instrucao, cd_camara, cd_banco_favorecido, cd_ocor_retorno, cd_convenio, cd_agencia, cd_remessa_retorno, cd_barras, cd_instr_alteracao, cd_pag_inss, cd_banco_dest, cd_moeda, cd_livre_barras, ds_zeros, ds_densidade, ds_endereco, ds_complemento, ds_class_registro, ds_maquina, ds_ndu, ds_nsu, ds_fator_venc, dt_credito, dt_efetivacao_credito, dt_geracao, dt_hr_geracao, dt_pagamento, dt_competencia_pag, dt_vencimento, ie_tipo_registro, ie_tipo_movimento, ie_tipo_moeda, ie_emite_aviso, ie_tipo_operacao, ie_tipo_servico, ie_forma_lancamento, ie_tipo_inscricao, ie_pagamento, ie_dig_verificador, nm_favorecido, nm_empresa, nm_banco, nm_cidade, nm_cedente, nm_contribuinte, nr_lote, nr_seq_registro, nr_seu_numero, nr_nosso_numero, nr_inscricao, nr_inscr_empresa, nr_conta_corrente, nr_conta, nr_seq_envio, nr_versao, nr_local, nr_cep, nr_seq_lote, nr_maquina, qt_lotes, qt_moeda, qt_registros, sg_uf, vl_creditar, vl_credito_efet, vl_pagamento, vl_principal, vl_atual_monetaria, vl_multa, vl_juros, vl_06, vl_07, vl_08, vl_09, vl_10, vl_11, vl_cod_barras, vl_nom_titulo, vl_desc_abatimento, vl_mora_multa, vl_tot_registro, vl_soma_valores, vl_soma_qt_moedas, nr_documento, nr_titulo, cd_favorecido, cd_banco_fornec, cd_agencia_bancaria, cd_convenio_banco, cd_conta, ds_banco, nr_registro, cd_camara_compensacao, nm_fornecedor, da_brancos, dt_pagto, vl_pagto, qt_lote_arquivo, qt_tot_reg) AS select	1				tp_registro,
	'041'				cd_banco, 
	'' cd_seg_registro, 
	'' cd_instrucao, 
	'' cd_camara, 
	'' cd_banco_favorecido, 
	0 cd_ocor_retorno, 
	coalesce(e.cd_convenio_banco,b.cd_convenio_banco)		cd_convenio, 
	b.cd_agencia_bancaria		cd_agencia, 
	CASE WHEN e.ie_remessa_retorno='R' THEN 1 WHEN e.ie_remessa_retorno='I' THEN 2  ELSE 3 END  cd_remessa_retorno, 
	0 cd_barras, 
	'' cd_instr_alteracao, 
	'0' cd_pag_inss, 
	'0' cd_banco_dest, 
	'' cd_moeda, 
	'0' cd_livre_barras, 
	'000'				ds_zeros, 
	' '				ds_densidade, 
	'' ds_endereco, 
	'' ds_complemento, 
	' ' ds_class_registro, 
	'0' ds_maquina, 
	'0' ds_ndu, 
	'0' ds_nsu, 
	'0' ds_fator_venc, 
	LOCALTIMESTAMP dt_credito, 
	LOCALTIMESTAMP dt_efetivacao_credito, 
	to_char(e.dt_remessa_retorno,'ddmmyyyy') dt_geracao, 
	to_char(LOCALTIMESTAMP,'hh24miss') dt_hr_geracao, 
	'' dt_pagamento, 
	LOCALTIMESTAMP dt_competencia_pag, 
	'' dt_vencimento, 
	'0'				ie_tipo_registro, 
	'' ie_tipo_movimento, 
	'' ie_tipo_moeda, 
	'' ie_emite_aviso, 
	'' ie_tipo_operacao, 
	'' ie_tipo_servico, 
	'0' ie_forma_lancamento, 
	'2'				ie_tipo_inscricao, 
	'0' ie_pagamento, 
	'0' ie_dig_verificador, 
	'' nm_favorecido, 
	upper(p.ds_razao_social)	nm_empresa, 
	upper(b.ds_banco)		nm_banco, 
	'' nm_cidade, 
	'0' nm_cedente, 
	'0' nm_contribuinte, 
	'0000'				nr_lote, 
	'0' nr_seq_registro, 
	'0' nr_seu_numero, 
	'0' nr_nosso_numero, 
	a.cd_cgc nr_inscricao, 
	a.cd_cgc			nr_inscr_empresa, 
	b.cd_conta			nr_conta_corrente, 
	b.cd_conta || b.ie_digito_conta nr_conta, 
	e.nr_sequencia			nr_seq_envio, 
	'020'				nr_versao, 
	'' nr_local, 
	'' nr_cep, 
	'0' nr_seq_lote, 
	'0' nr_maquina, 
	0 qt_lotes, 
	'0' qt_moeda, 
	0 qt_registros, 
	'' sg_uf, 
	0 vl_creditar, 
	0 vl_credito_efet, 
	0 vl_pagamento, 
	0 vl_principal, 
	0 vl_atual_monetaria, 
	0 vl_multa, 
	0 vl_juros, 
	0 vl_06, 
	0 vl_07, 
	0 vl_08, 
	0 vl_09, 
	0 vl_10, 
	0 vl_11, 
	'0' vl_cod_barras, 
	0 vl_nom_titulo, 
	0 vl_desc_abatimento, 
	0 vl_mora_multa, 
	0 vl_tot_registro, 
	0 vl_soma_valores, 
	0 vl_soma_qt_moedas, 
	0 nr_documento, 
	0 nr_titulo, 
	'' cd_favorecido, 
	'041' cd_banco_fornec, 
	b.cd_agencia_bancaria, 
	to_char(coalesce(e.cd_convenio_banco,b.cd_convenio_banco)) cd_convenio_banco, 
	b.cd_conta, 
	upper(b.ds_banco) ds_banco, 
	1 nr_registro, 
	' ' CD_CAMARA_COMPENSACAO, 
	'0' nm_fornecedor, 
	' ' DA_BRANCOS, 
	'' dt_pagto, 
	0 vl_pagto, 
	0 qt_lote_arquivo, 
	0 qt_tot_reg 
FROM	banco_estabelecimento_v b, 
	estabelecimento a, 
	pessoa_juridica p, 
	banco_escritural e 
where	e.cd_estabelecimento  = a.cd_estabelecimento 
and	e.cd_estabelecimento  = b.cd_estabelecimento 
and	a.cd_cgc        = p.cd_cgc 
and	e.cd_banco       = b.cd_banco 
and	e.nr_seq_conta_banco	= b.nr_sequencia 
and	b.ie_tipo_relacao    in ('EP','ECC') 

UNION
	 
/*Header Lote*/
	 
select	distinct 2 				tp_registro, 
	'041'				cd_banco, 
	'' cd_seg_registro, 
	'' cd_instrucao, 
	'' cd_camara, 
	'' cd_banco_favorecido, 
	0 cd_ocor_retorno, 
	coalesce(lpad(a.cd_convenio_banco,5,'0'),lpad(b.cd_convenio_banco,5,'0'))	cd_convenio, 
	lpad(b.cd_agencia_bancaria,5,'0')		cd_agencia, 
	0 cd_remessa_retorno, 
	0 cd_barras, 
	'' cd_instr_alteracao, 
	'0' cd_pag_inss, 
	'' cd_banco_dest, 
	'' cd_moeda, 
	'0' cd_livre_barras, 
	'' ds_zeros, 
	' ' ds_densidade, 
	upper(substr(obter_dados_pf_pj(null,e.cd_cgc,'R'),1,255)) ds_endereco, 
	j.ds_complemento		ds_complemento, 
	' '				ds_class_registro, 
	'0' ds_maquina, 
	'0' ds_ndu, 
	'0' ds_nsu, 
	'0' ds_fator_venc, 
	LOCALTIMESTAMP dt_credito, 
	LOCALTIMESTAMP dt_efetivacao_credito, 
	'' dt_geracao, 
	'' dt_hr_geracao, 
	'' dt_pagamento, 
	LOCALTIMESTAMP dt_competencia_pag, 
	'' dt_vencimento, 
	'1'				ie_tipo_registro, 
	'' ie_tipo_movimento, 
	'' ie_tipo_moeda, 
	'' ie_emite_aviso, 
	'C'				ie_tipo_operacao, 
	substr(c.ie_tipo_servico,4,2)	ie_tipo_servico, 
	CASE WHEN c.ie_tipo_pagamento='CC' THEN '01' WHEN c.ie_tipo_pagamento='CCP' THEN '01' WHEN c.ie_tipo_pagamento='TED' THEN '03' WHEN c.ie_tipo_pagamento='OP' THEN '10' WHEN c.ie_tipo_pagamento='PC' THEN '33' WHEN c.ie_tipo_pagamento='BLQ' THEN CASE WHEN c.cd_banco=041 THEN '30'  ELSE '31' END  WHEN c.ie_tipo_pagamento='DOC' THEN '03' END  ie_forma_lancamento, 
	'2'				ie_tipo_inscricao, 
	'0' ie_pagamento, 
	'0' ie_dig_verificador, 
	'' nm_favorecido, 
	upper(j.ds_razao_social)	nm_empresa, 
	'' nm_banco, 
	upper(substr(obter_dados_pf_pj(null,e.cd_cgc,'CI'),1,255)) nm_cidade, 
	'0' nm_cedente, 
	'0' nm_contribuinte, 
	CASE WHEN c.ie_tipo_pagamento='CC' THEN '0001' WHEN c.ie_tipo_pagamento='CCP' THEN '0001' WHEN c.ie_tipo_pagamento='TED' THEN '0002' WHEN c.ie_tipo_pagamento='OP' THEN '0003' WHEN c.ie_tipo_pagamento='PC' THEN '0006' WHEN c.ie_tipo_pagamento='BLQ' THEN CASE WHEN c.cd_banco=041 THEN '0004'  ELSE '0005' END  WHEN c.ie_tipo_pagamento='DOC' THEN '0002' END 	nr_lote, 
	'0' nr_seq_registro, 
	'0' nr_seu_numero, 
	'0' nr_nosso_numero, 
	e.cd_cgc nr_inscricao, 
	e.cd_cgc			nr_inscr_empresa, 
	b.cd_conta			nr_conta_corrente, 
	b.cd_conta || b.ie_digito_conta nr_conta, 
	a.nr_sequencia nr_seq_envio, 
	'020'				nr_versao, 
	upper(substr(obter_dados_pf_pj(null,e.cd_cgc,'NR'),1,255)) nr_local, 
	substr(obter_dados_pf_pj(null,e.cd_cgc,'CEP'),1,8) nr_cep, 
	'0' nr_seq_lote, 
	'0' nr_maquina, 
	0 qt_lotes, 
	'0' qt_moeda, 
	0 qt_registros, 
	upper(substr(obter_dados_pf_pj(null,e.cd_cgc,'UF'),1,2)) sg_uf, 
	0 vl_creditar, 
	0 vl_credito_efet, 
	0 vl_pagamento, 
	0 vl_principal, 
	0 vl_atual_monetaria, 
	0 vl_multa, 
	0 vl_juros, 
	0 vl_06, 
	0 vl_07, 
	0 vl_08, 
	0 vl_09, 
	0 vl_10, 
	0 vl_11, 
	'0' vl_cod_barras, 
	0 vl_nom_titulo, 
	0 vl_desc_abatimento, 
	0 vl_mora_multa, 
	0 vl_tot_registro, 
	0 vl_soma_valores, 
	0 vl_soma_qt_moedas, 
	0 nr_documento, 
	0 nr_titulo, 
	'' cd_favorecido, 
	'041' cd_banco_fornec, 
	b.cd_agencia_bancaria, 
	to_char(coalesce(a.cd_convenio_banco,b.cd_convenio_banco)) cd_convenio_banco, 
	b.cd_conta, 
	'' ds_banco, 
	2 nr_registro, 
	' ' CD_CAMARA_COMPENSACAO, 
	'0' nm_fornecedor, 
	' ' DA_BRANCOS, 
	'' dt_pagto, 
	0 vl_pagto, 
	0 qt_lote_arquivo, 
	0 qt_tot_reg 
from	pessoa_juridica j, 
	Estabelecimento e, 
	banco_estabelecimento g, 
	banco_estabelecimento_v b, 
	banco_escritural a, 
	titulo_pagar_escrit c 
where	e.cd_cgc		= j.cd_cgc 
and	a.nr_sequencia     = c.nr_seq_escrit 
and	a.nr_seq_conta_banco  = b.nr_sequencia 
and	a.cd_estabelecimento  = b.cd_estabelecimento 
and	a.cd_estabelecimento  = e.cd_estabelecimento 
AND	a.nr_seq_conta_banco	= b.nr_sequencia 
and	b.ie_tipo_relacao    in ('EP','ECC') 

UNION
 
/*Detalhe - Seg. A*/
 
select	3				tp_registro, 
	'041'				cd_banco, 
	'A' 				cd_seg_registro, 
	'00' 				cd_instrucao, 
	'' cd_camara, 
	'' cd_banco_favorecido, 
	c.cd_ocorrencia_ret		cd_ocor_retorno, 
	'0' cd_convenio, 
	b.cd_agencia_bancaria cd_agencia, 
	0 cd_remessa_retorno, 
	0 cd_barras, 
	'' cd_instr_alteracao, 
	'0' cd_pag_inss, 
	'041' 				cd_banco_dest, 
	'9' 				cd_moeda, 
	'0' 				cd_livre_barras, 
	'' ds_zeros, 
	' ' ds_densidade, 
	'' ds_endereco, 
	'' ds_complemento, 
	' ' ds_class_registro, 
	'0' ds_maquina, 
	'0' ds_ndu, 
	'0' ds_nsu, 
	'0' 				ds_fator_venc, 
	LOCALTIMESTAMP dt_credito, 
	to_date(to_char(LOCALTIMESTAMP,'ddmmyyyy'),'ddmmyyyy') dt_efetivacao_credito, 
	'' dt_geracao, 
	'' dt_hr_geracao, 
	to_char(LOCALTIMESTAMP,'ddmmyyyy') 	dt_pagamento, 
	LOCALTIMESTAMP dt_competencia_pag, 
	to_char(d.dt_vencimento_atual,'ddmmyyyy') dt_vencimento, 
	'3'				ie_tipo_registro, 
	'0' 				ie_tipo_movimento, 
	'' ie_tipo_moeda, 
	'' ie_emite_aviso, 
	'' ie_tipo_operacao, 
	'' ie_tipo_servico, 
	CASE WHEN c.ie_tipo_pagamento='CC' THEN '01' WHEN c.ie_tipo_pagamento='CCP' THEN '01' WHEN c.ie_tipo_pagamento='TED' THEN '03' WHEN c.ie_tipo_pagamento='OP' THEN '10' WHEN c.ie_tipo_pagamento='PC' THEN '33' WHEN c.ie_tipo_pagamento='BLQ' THEN CASE WHEN c.cd_banco=041 THEN '30'  ELSE '31' END  WHEN c.ie_tipo_pagamento='DOC' THEN '03' END  ie_forma_lancamento, 
	'2' 				ie_tipo_inscricao, 
	'0' ie_pagamento, 
	'0' ie_dig_verificador, 
	'' nm_favorecido, 
	'' nm_empresa, 
	'' nm_banco, 
	'' nm_cidade, 
	upper(substr(obter_pessoa_titulo_pagar(c.nr_titulo),1,255)) nm_cedente, 
	'0' nm_contribuinte, 
		CASE WHEN c.ie_tipo_pagamento='CC' THEN '0001' WHEN c.ie_tipo_pagamento='CCP' THEN '0001' WHEN c.ie_tipo_pagamento='TED' THEN '0002' WHEN c.ie_tipo_pagamento='OP' THEN '0003' WHEN c.ie_tipo_pagamento='PC' THEN '0006' WHEN c.ie_tipo_pagamento='BLQ' THEN CASE WHEN c.cd_banco=041 THEN '0004'  ELSE '0005' END  WHEN c.ie_tipo_pagamento='DOC' THEN '0002' END 	nr_lote, 
	'00001' 			nr_seq_registro, 
	'0' nr_seu_numero, 
	'0' nr_nosso_numero, 
	d.cd_favorecido nr_inscricao, 
	'' nr_inscr_empresa, 
	CASE WHEN c.ie_tipo_pagamento='CC' THEN '000' ||b.cd_conta WHEN c.ie_tipo_pagamento='CCP' THEN '000' ||b.cd_conta WHEN c.ie_tipo_pagamento='TED' THEN b.cd_conta||b.ie_digito_conta WHEN c.ie_tipo_pagamento='OP' THEN '0000000000000' END  nr_conta_corrente, 
	'' nr_conta, 
	a.nr_sequencia nr_seq_envio, 
	'' nr_versao, 
	'' nr_local, 
	'' nr_cep, 
	'0' nr_seq_lote, 
	'0' nr_maquina, 
	0 qt_lotes, 
	'0' 				qt_moeda, 
	0 qt_registros, 
	'' sg_uf, 
	0 vl_creditar, 
	0 vl_credito_efet, 
	d.vl_saldo_titulo		vl_pagamento, 
	0 vl_principal, 
	0 vl_atual_monetaria, 
	0 vl_multa, 
	0 vl_juros, 
	0 vl_06, 
	0 vl_07, 
	0 vl_08, 
	0 vl_09, 
	0 vl_10, 
	0 vl_11, 
	'0' vl_cod_barras, 
	d.vl_titulo			vl_nom_titulo, 
	0 				vl_desc_abatimento, 
	(coalesce(vl_saldo_juros,0) + coalesce(vl_saldo_multa,0)) vl_mora_multa, 
	0 vl_tot_registro, 
	0 vl_soma_valores, 
	0 vl_soma_qt_moedas, 
	c.nr_titulo nr_documento, 
	c.nr_titulo, 
	d.cd_favorecido, 
	'041' cd_banco_fornec, 
	b.cd_agencia_bancaria, 
	'0' cd_convenio_banco, 
	CASE WHEN c.ie_tipo_pagamento='CC' THEN '000' ||b.cd_conta WHEN c.ie_tipo_pagamento='CCP' THEN '000' ||b.cd_conta WHEN c.ie_tipo_pagamento='TED' THEN b.cd_conta||b.ie_digito_conta WHEN c.ie_tipo_pagamento='OP' THEN '0000000000000' END  cd_conta, 
	'' ds_banco, 
	3 nr_registro, 
	' ' CD_CAMARA_COMPENSACAO, 
	upper(substr(obter_pessoa_titulo_pagar(c.nr_titulo),1,255)) nm_fornecedor, 
	' ' DA_BRANCOS, 
	to_char(LOCALTIMESTAMP,'ddmmyyyy') dt_pagto, 
	d.vl_saldo_titulo vl_pagto, 
	0 qt_lote_arquivo, 
	0 qt_tot_reg 
from	pessoa_juridica j, 
	Estabelecimento e, 
	banco_estabelecimento_v b, 
	banco_escritural a, 
	titulo_pagar_v2 d, 
	titulo_pagar_escrit c 
where	c.nr_titulo       = d.nr_titulo 
and	e.cd_cgc		= j.cd_cgc 
and	a.nr_sequencia     = c.nr_seq_escrit 
and	a.nr_seq_conta_banco  = b.nr_sequencia 
and	a.cd_estabelecimento  = b.cd_estabelecimento 
and	a.cd_estabelecimento  = e.cd_estabelecimento 
and	b.ie_tipo_relacao    in ('EP','ECC') 
and 	c.ie_tipo_pagamento	in ('DOC','TED','CC','CCP','OP','PC') 

UNION
 
/*Detalhe - Seg. J*/
 
select	6				tp_registro, 
	'041'				cd_banco, 
	'J' 				cd_seg_registro, 
	'00' 				cd_instrucao, 
	'' cd_camara, 
	'' cd_banco_favorecido, 
	c.cd_ocorrencia_ret		cd_ocor_retorno, 
	'0' cd_convenio, 
	b.cd_agencia_bancaria cd_agencia, 
	0 cd_remessa_retorno, 
	0 cd_barras, 
	'' cd_instr_alteracao, 
	'0' cd_pag_inss, 
	substr(nr_bloqueto,1,3)		cd_banco_dest, 
	substr(nr_bloqueto,4,1)		cd_moeda, 
	substr(nr_bloqueto,20,25)	cd_livre_barras, 
	'' ds_zeros, 
	' ' ds_densidade, 
	'' ds_endereco, 
	'' ds_complemento, 
	' ' ds_class_registro, 
	'0' ds_maquina, 
	'0' ds_ndu, 
	'0' ds_nsu, 
	substr(nr_bloqueto,6,4)		ds_fator_venc, 
	LOCALTIMESTAMP dt_credito, 
	LOCALTIMESTAMP dt_efetivacao_credito, 
	'' dt_geracao, 
	'' dt_hr_geracao, 
	to_char(LOCALTIMESTAMP,'ddmmyyyy') 	dt_pagamento, 
	LOCALTIMESTAMP dt_competencia_pag, 
	to_char(d.dt_vencimento_atual,'ddmmyyyy') dt_vencimento, 
	'3'				ie_tipo_registro, 
	'0' 				ie_tipo_movimento, 
	'' ie_tipo_moeda, 
	'' ie_emite_aviso, 
	'' ie_tipo_operacao, 
	'' ie_tipo_servico, 
	CASE WHEN c.ie_tipo_pagamento='CC' THEN '01' WHEN c.ie_tipo_pagamento='CCP' THEN '01' WHEN c.ie_tipo_pagamento='TED' THEN '03' WHEN c.ie_tipo_pagamento='OP' THEN '10' WHEN c.ie_tipo_pagamento='PC' THEN '33' WHEN c.ie_tipo_pagamento='BLQ' THEN CASE WHEN c.cd_banco=041 THEN '30'  ELSE '31' END  WHEN c.ie_tipo_pagamento='DOC' THEN '03' END  ie_forma_lancamento, 
	'2' 				ie_tipo_inscricao, 
	'0' ie_pagamento, 
	substr(nr_bloqueto,5,1)		ie_dig_verificador, 
	'' nm_favorecido, 
	'' nm_empresa, 
	'' nm_banco, 
	'' nm_cidade, 
	substr(obter_pessoa_titulo_pagar(c.nr_titulo),1,255) nm_cedente, 
	'0' nm_contribuinte, 
	CASE WHEN c.ie_tipo_pagamento='CC' THEN '0001' WHEN c.ie_tipo_pagamento='CCP' THEN '0001' WHEN c.ie_tipo_pagamento='TED' THEN '0002' WHEN c.ie_tipo_pagamento='OP' THEN '0003' WHEN c.ie_tipo_pagamento='PC' THEN '0006' WHEN c.ie_tipo_pagamento='BLQ' THEN CASE WHEN c.cd_banco=041 THEN '0004'  ELSE '0005' END  WHEN c.ie_tipo_pagamento='DOC' THEN '0002' END 	nr_lote, 
	'00001' 			nr_seq_registro, 
	'0' nr_seu_numero, 
	'0' nr_nosso_numero, 
	d.cd_favorecido nr_inscricao, 
	'' nr_inscr_empresa, 
	'' nr_conta_corrente, 
	'' nr_conta, 
	a.nr_sequencia nr_seq_envio, 
	'' nr_versao, 
	'' nr_local, 
	'' nr_cep, 
	'0' nr_seq_lote, 
	'0' nr_maquina, 
	0 qt_lotes, 
	'0' 				qt_moeda, 
	0 qt_registros, 
	'' sg_uf, 
	0 vl_creditar, 
	0 vl_credito_efet, 
	d.vl_saldo_titulo		vl_pagamento, 
	0 vl_principal, 
	0 vl_atual_monetaria, 
	0 vl_multa, 
	0 vl_juros, 
	0 vl_06, 
	0 vl_07, 
	0 vl_08, 
	0 vl_09, 
	0 vl_10, 
	0 vl_11, 
	substr(nr_bloqueto,10,10)		vl_cod_barras, 
	d.vl_titulo			vl_nom_titulo, 
	0 				vl_desc_abatimento, 
	(coalesce(vl_saldo_juros,0) + coalesce(vl_saldo_multa,0)) vl_mora_multa, 
	0 vl_tot_registro, 
	0 vl_soma_valores, 
	0 vl_soma_qt_moedas, 
	c.nr_titulo nr_documento, 
	c.nr_titulo, 
	d.cd_favorecido, 
	'041' cd_banco_fornec, 
	b.cd_agencia_bancaria, 
	'0' cd_convenio_banco, 
	'' cd_conta, 
	'' ds_banco, 
	6 nr_registro, 
	' ' CD_CAMARA_COMPENSACAO, 
	substr(obter_pessoa_titulo_pagar(c.nr_titulo),1,255) nm_fornecedor, 
	' ' DA_BRANCOS, 
	to_char(LOCALTIMESTAMP,'ddmmyyyy') dt_pagto, 
	d.vl_saldo_titulo vl_pagto, 
	0 qt_lote_arquivo, 
	0 qt_tot_reg 
from	pessoa_juridica j, 
	Estabelecimento e, 
	banco_estabelecimento_v b, 
	banco_escritural a, 
	titulo_pagar_v2 d, 
	titulo_pagar_escrit c 
where	c.nr_titulo       = d.nr_titulo 
and	e.cd_cgc		= j.cd_cgc 
and	a.nr_sequencia     = c.nr_seq_escrit 
and	a.nr_seq_conta_banco  = b.nr_sequencia 
and	a.cd_estabelecimento  = b.cd_estabelecimento 
and	a.cd_estabelecimento  = e.cd_estabelecimento 
and	b.ie_tipo_relacao    in ('EP','ECC') 
and 	c.ie_tipo_pagamento	= 'BLQ' 
and 	c.cd_banco 		= 041 

UNION
 
/*Detalhe - Seg. J - Outros Bancos*/
 
select	6				tp_registro, 
	'041'				cd_banco, 
	'J' 				cd_seg_registro, 
	'00' 				cd_instrucao, 
	'' cd_camara, 
	'' cd_banco_favorecido, 
	c.cd_ocorrencia_ret		cd_ocor_retorno, 
	'0' cd_convenio, 
	b.cd_agencia_bancaria cd_agencia, 
	0 cd_remessa_retorno, 
	0 cd_barras, 
	'' cd_instr_alteracao, 
	'0' cd_pag_inss, 
	substr(nr_bloqueto,1,3)		cd_banco_dest, 
	substr(nr_bloqueto,4,1)		cd_moeda, 
	substr(nr_bloqueto,20,25)	cd_livre_barras, 
	'' ds_zeros, 
	' ' ds_densidade, 
	'' ds_endereco, 
	'' ds_complemento, 
	' ' ds_class_registro, 
	'0' ds_maquina, 
	'0' ds_ndu, 
	'0' ds_nsu, 
	substr(nr_bloqueto,6,4)		ds_fator_venc, 
	LOCALTIMESTAMP dt_credito, 
	LOCALTIMESTAMP dt_efetivacao_credito, 
	'' dt_geracao, 
	'' dt_hr_geracao, 
	to_char(LOCALTIMESTAMP,'ddmmyyyy') 	dt_pagamento, 
	LOCALTIMESTAMP dt_competencia_pag, 
	to_char(d.dt_vencimento_atual,'ddmmyyyy') dt_vencimento, 
	'3'				ie_tipo_registro, 
	'0' 				ie_tipo_movimento, 
	'' ie_tipo_moeda, 
	'' ie_emite_aviso, 
	'' ie_tipo_operacao, 
	'' ie_tipo_servico, 
	'31' ie_forma_lancamento, 
	'2' ie_tipo_inscricao, 
	'0' ie_pagamento, 
	substr(nr_bloqueto,5,1)		ie_dig_verificador, 
	'' nm_favorecido, 
	'' nm_empresa, 
	'' nm_banco, 
	'' nm_cidade, 
	substr(obter_pessoa_titulo_pagar(c.nr_titulo),1,255) nm_cedente, 
	'0' nm_contribuinte, 
	CASE WHEN c.ie_tipo_pagamento='CC' THEN '0001' WHEN c.ie_tipo_pagamento='CCP' THEN '0001' WHEN c.ie_tipo_pagamento='TED' THEN '0002' WHEN c.ie_tipo_pagamento='OP' THEN '0003' WHEN c.ie_tipo_pagamento='PC' THEN '0006' WHEN c.ie_tipo_pagamento='BLQ' THEN CASE WHEN c.cd_banco=041 THEN '0004'  ELSE '0005' END  WHEN c.ie_tipo_pagamento='DOC' THEN '0002' END 	nr_lote, 
	'00001' 			nr_seq_registro, 
	'0' nr_seu_numero, 
	'0' nr_nosso_numero, 
	d.cd_favorecido nr_inscricao, 
	'' nr_inscr_empresa, 
	'' nr_conta_corrente, 
	'' nr_conta, 
	a.nr_sequencia nr_seq_envio, 
	'' nr_versao, 
	'' nr_local, 
	'' nr_cep, 
	'0' nr_seq_lote, 
	'0' nr_maquina, 
	0 qt_lotes, 
	'0' 				qt_moeda, 
	0 qt_registros, 
	'' sg_uf, 
	0 vl_creditar, 
	0 vl_credito_efet, 
	d.vl_saldo_titulo		vl_pagamento, 
	0 vl_principal, 
	0 vl_atual_monetaria, 
	0 vl_multa, 
	0 vl_juros, 
	0 vl_06, 
	0 vl_07, 
	0 vl_08, 
	0 vl_09, 
	0 vl_10, 
	0 vl_11, 
	substr(nr_bloqueto,10,10)		vl_cod_barras, 
	d.vl_titulo			vl_nom_titulo, 
	0 				vl_desc_abatimento, 
	(coalesce(vl_saldo_juros,0) + coalesce(vl_saldo_multa,0)) vl_mora_multa, 
	0 vl_tot_registro, 
	0 vl_soma_valores, 
	0 vl_soma_qt_moedas, 
	c.nr_titulo nr_documento, 
	c.nr_titulo, 
	d.cd_favorecido, 
	'041' cd_banco_fornec, 
	b.cd_agencia_bancaria, 
	'0' cd_convenio_banco, 
	'' cd_conta, 
	'' ds_banco, 
	6 nr_registro, 
	' ' CD_CAMARA_COMPENSACAO, 
	substr(obter_pessoa_titulo_pagar(c.nr_titulo),1,255) nm_fornecedor, 
	' ' DA_BRANCOS, 
	to_char(LOCALTIMESTAMP,'ddmmyyyy') dt_pagto, 
	d.vl_saldo_titulo vl_pagto, 
	0 qt_lote_arquivo, 
	0 qt_tot_reg 
from	pessoa_juridica j, 
	Estabelecimento e, 
	banco_estabelecimento_v b, 
	banco_escritural a, 
	titulo_pagar_v2 d, 
	titulo_pagar_escrit c 
where	c.nr_titulo       = d.nr_titulo 
and	e.cd_cgc		= j.cd_cgc 
and	a.nr_sequencia     = c.nr_seq_escrit 
and	a.nr_Seq_conta_banco  = b.nr_sequencia 
and	a.cd_estabelecimento  = b.cd_estabelecimento 
and	a.cd_estabelecimento  = e.cd_estabelecimento 
and	b.ie_tipo_relacao    in ('EP','ECC') 
and 	c.ie_tipo_pagamento	= 'BLQ' 
and	c.cd_banco 		<> 041 

UNION
 
/*Trailler Lote*/
 
select	7				tp_registro, 
	'041'				cd_banco, 
	'' cd_seg_registro, 
	'' cd_instrucao, 
	'' cd_camara, 
	'' cd_banco_favorecido, 
	c.cd_ocorrencia_ret		cd_ocor_retorno, 
	'0' cd_convenio, 
	b.cd_agencia_bancaria cd_agencia, 
	0 cd_remessa_retorno, 
	0 cd_barras, 
	'' cd_instr_alteracao, 
	'0' cd_pag_inss, 
	'0' cd_banco_dest, 
	'' cd_moeda, 
	'0' cd_livre_barras, 
	'' ds_zeros, 
	' ' ds_densidade, 
	'' ds_endereco, 
	'' ds_complemento, 
	' ' ds_class_registro, 
	'0' ds_maquina, 
	'0' ds_ndu, 
	'0' ds_nsu, 
	'0' ds_fator_venc, 
	LOCALTIMESTAMP dt_credito, 
	LOCALTIMESTAMP dt_efetivacao_credito, 
	'' dt_geracao, 
	'' dt_hr_geracao, 
	'' dt_pagamento, 
	LOCALTIMESTAMP dt_competencia_pag, 
	'' dt_vencimento, 
	'5'				ie_tipo_registro, 
	'' ie_tipo_movimento, 
	'' ie_tipo_moeda, 
	'' ie_emite_aviso, 
	'' ie_tipo_operacao, 
	'' ie_tipo_servico, 
	CASE WHEN c.ie_tipo_pagamento='CC' THEN '01' WHEN c.ie_tipo_pagamento='CCP' THEN '01' WHEN c.ie_tipo_pagamento='TED' THEN '03' WHEN c.ie_tipo_pagamento='OP' THEN '10' WHEN c.ie_tipo_pagamento='PC' THEN '33' WHEN c.ie_tipo_pagamento='BLQ' THEN CASE WHEN c.cd_banco=041 THEN '30'  ELSE '31' END  WHEN c.ie_tipo_pagamento='DOC' THEN '03' END  ie_forma_lancamento, 
	'2' ie_tipo_inscricao, 
	'0' ie_pagamento, 
	'0' ie_dig_verificador, 
	'' nm_favorecido, 
	'' nm_empresa, 
	'' nm_banco, 
	'' nm_cidade, 
	'0' nm_cedente, 
	'0' nm_contribuinte, 
	CASE WHEN c.ie_tipo_pagamento='CC' THEN '0001' WHEN c.ie_tipo_pagamento='CCP' THEN '0001' WHEN c.ie_tipo_pagamento='TED' THEN '0002' WHEN c.ie_tipo_pagamento='OP' THEN '0003' WHEN c.ie_tipo_pagamento='PC' THEN '0006' WHEN c.ie_tipo_pagamento='BLQ' THEN CASE WHEN c.cd_banco=041 THEN '0004'  ELSE '0005' END  WHEN c.ie_tipo_pagamento='DOC' THEN '0002' END 	nr_lote, 
	'0' nr_seq_registro, 
	'0' nr_seu_numero, 
	'0' nr_nosso_numero, 
	e.cd_cgc nr_inscricao, 
	'' nr_inscr_empresa, 
	'' nr_conta_corrente, 
	'' nr_conta, 
	a.nr_sequencia nr_seq_envio, 
	'' nr_versao, 
	'' nr_local, 
	'' nr_cep, 
	'0' nr_seq_lote, 
	'0' nr_maquina, 
	0 qt_lotes, 
	'0' qt_moeda, 
	0 qt_registros, 
	'' sg_uf, 
	0 vl_creditar, 
	0 vl_credito_efet, 
	0 vl_pagamento, 
	0 vl_principal, 
	0 vl_atual_monetaria, 
	0 vl_multa, 
	0 vl_juros, 
	0 vl_06, 
	0 vl_07, 
	0 vl_08, 
	0 vl_09, 
	0 vl_10, 
	0 vl_11, 
	'0' vl_cod_barras, 
	0 vl_nom_titulo, 
	0 vl_desc_abatimento, 
	0 vl_mora_multa, 
	count(d.nr_titulo) + 2		vl_tot_registro, 
	sum(d.vl_titulo)		vl_soma_valores, 
	0 				vl_soma_qt_moedas, 
	0 nr_documento, 
	0 nr_titulo, 
	'' cd_favorecido, 
	'041' cd_banco_fornec, 
	b.cd_agencia_bancaria, 
	'0' cd_convenio_banco, 
	'' cd_conta, 
	'' ds_banco, 
	7 nr_registro, 
	' ' CD_CAMARA_COMPENSACAO, 
	'0' nm_fornecedor, 
	' ' DA_BRANCOS, 
	'' dt_pagto, 
	0 vl_pagto, 
	0 qt_lote_arquivo, 
	0 qt_tot_reg 
from	pessoa_juridica j, 
	Estabelecimento e, 
	banco_estabelecimento_v b, 
	banco_escritural a, 
	titulo_pagar_v2 d, 
	titulo_pagar_escrit c 
where	c.nr_titulo       = d.nr_titulo 
and	e.cd_cgc		= j.cd_cgc 
and	a.nr_sequencia     = c.nr_seq_escrit 
and	a.nr_seq_conta_banco  = b.nr_sequencia 
and	a.cd_estabelecimento  = b.cd_estabelecimento 
and	a.cd_estabelecimento  = e.cd_estabelecimento 
and	b.ie_tipo_relacao    in ('EP','ECC') 
group by a.nr_sequencia, c.cd_ocorrencia_ret, b.cd_agencia_bancaria, e.cd_cgc, CASE WHEN c.ie_tipo_pagamento='CC' THEN '01' WHEN c.ie_tipo_pagamento='CCP' THEN '01' WHEN c.ie_tipo_pagamento='TED' THEN '03' WHEN c.ie_tipo_pagamento='OP' THEN '10' WHEN c.ie_tipo_pagamento='PC' THEN '33' WHEN c.ie_tipo_pagamento='BLQ' THEN CASE WHEN c.cd_banco=041 THEN '30'  ELSE '31' END  WHEN c.ie_tipo_pagamento='DOC' THEN '03' END , CASE WHEN c.ie_tipo_pagamento='CC' THEN '0001' WHEN c.ie_tipo_pagamento='CCP' THEN '0001' WHEN c.ie_tipo_pagamento='TED' THEN '0002' WHEN c.ie_tipo_pagamento='OP' THEN '0003' WHEN c.ie_tipo_pagamento='PC' THEN '0006' WHEN c.ie_tipo_pagamento='BLQ' THEN CASE WHEN c.cd_banco=041 THEN '0004'  ELSE '0005' END  WHEN c.ie_tipo_pagamento='DOC' THEN '0002' END  

UNION
 
/*Trailler*/
 
select	9				tp_registro, 
	'041' 				cd_banco, 
	'' cd_seg_registro, 
	'' cd_instrucao, 
	'' cd_camara, 
	'' cd_banco_favorecido, 
	0 cd_ocor_retorno, 
	'0' cd_convenio, 
	b.cd_agencia_bancaria cd_agencia, 
	0 cd_remessa_retorno, 
	0 cd_barras, 
	'' cd_instr_alteracao, 
	'0' cd_pag_inss, 
	'0' cd_banco_dest, 
	'' cd_moeda, 
	'0' cd_livre_barras, 
	'000000'			ds_zeros, 
	' ' ds_densidade, 
	'' ds_endereco, 
	'' ds_complemento, 
	' ' ds_class_registro, 
	'0' ds_maquina, 
	'0' ds_ndu, 
	'0' ds_nsu, 
	'0' ds_fator_venc, 
	LOCALTIMESTAMP dt_credito, 
	LOCALTIMESTAMP dt_efetivacao_credito, 
	'' dt_geracao, 
	'' dt_hr_geracao, 
	'' dt_pagamento, 
	LOCALTIMESTAMP dt_competencia_pag, 
	'' dt_vencimento, 
	'9' ie_tipo_registro, 
	'' ie_tipo_movimento, 
	'' ie_tipo_moeda, 
	'' ie_emite_aviso, 
	'' ie_tipo_operacao, 
	'' ie_tipo_servico, 
	'999' ie_forma_lancamento, 
	'2' ie_tipo_inscricao, 
	'0' ie_pagamento, 
	'0' ie_dig_verificador, 
	'' nm_favorecido, 
	'' nm_empresa, 
	'' nm_banco, 
	'' nm_cidade, 
	'0' nm_cedente, 
	'0' nm_contribuinte, 
	'9999' nr_lote, 
	'0' nr_seq_registro, 
	'0' nr_seu_numero, 
	'0' nr_nosso_numero, 
	a.cd_cgc nr_inscricao, 
	'' nr_inscr_empresa, 
	'' nr_conta_corrente, 
	'' nr_conta, 
	e.nr_sequencia nr_seq_envio, 
	'' nr_versao, 
	'' nr_local, 
	'' nr_cep, 
	'0' nr_seq_lote, 
	'0' nr_maquina, 
	1 qt_lotes, 
	'0' qt_moeda, 
	count(c.nr_titulo) + 4	qt_registros, 
	'' sg_uf, 
	0 vl_creditar, 
	0 vl_credito_efet, 
	0 vl_pagamento, 
	0 vl_principal, 
	0 vl_atual_monetaria, 
	0 vl_multa, 
	0 vl_juros, 
	0 vl_06, 
	0 vl_07, 
	0 vl_08, 
	0 vl_09, 
	0 vl_10, 
	0 vl_11, 
	'0' vl_cod_barras, 
	0 vl_nom_titulo, 
	0 vl_desc_abatimento, 
	0 vl_mora_multa, 
	0 vl_tot_registro, 
	0 vl_soma_valores, 
	0 vl_soma_qt_moedas, 
	0 nr_documento, 
	0 nr_titulo, 
	'' cd_favorecido, 
	'041' cd_banco_fornecm, 
	b.cd_agencia_bancaria, 
	'0' cd_convenio_banco, 
	'' cd_conta, 
	'' ds_banco, 
	9 nr_registro, 
	' ' CD_CAMARA_COMPENSACAO, 
	'0' nm_fornecedor, 
	' ' DA_BRANCOS, 
	'' dt_pagto, 
	0 vl_pagto, 
	0 qt_lote_arquivo, 
	0 qt_tot_reg 
from	banco_estabelecimento_v b, 
	estabelecimento a, 
	banco_escritural e, 
	titulo_pagar_escrit c 
where	e.cd_estabelecimento  = a.cd_estabelecimento 
and	b.ie_tipo_relacao    in ('EP','ECC') 
and	b.nr_sequencia		= e.nr_seq_conta_banco 
and	e.nr_sequencia   	= c.nr_seq_escrit 
group by e.nr_sequencia, b.cd_agencia_bancaria, a.cd_cgc 
order by ie_forma_lancamento, nr_lote, tp_registro, ie_tipo_registro;

