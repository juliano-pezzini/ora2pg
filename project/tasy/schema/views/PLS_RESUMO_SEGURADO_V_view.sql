-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_resumo_segurado_v (ie_situacao, nr_seq_segurado, vl_preco_sem_desconto, vl_preco_com_desconto, nr_seq_plano, nr_seq_contrato, nr_seq_titular) AS select	distinct 'A' ie_situacao,
	a.nr_sequencia nr_seq_segurado,
	substr(pls_obter_valor_segurado(a.nr_sequencia,'VSD'),1,100) vl_preco_sem_desconto,
	substr(pls_obter_valor_segurado(a.nr_sequencia,'VCD'),1,100) vl_preco_com_desconto,
	a.nr_seq_plano,
	a.nr_seq_contrato,
	a.nr_seq_titular
FROM	pls_segurado a
where	a.dt_rescisao is null
and	a.dt_liberacao is not null

UNION

select	distinct 'I' ie_situacao,
	a.nr_sequencia nr_seq_segurado,
	substr(pls_obter_valor_segurado(a.nr_sequencia,'VSD'),1,100) vl_preco_sem_desconto,
	substr(pls_obter_valor_segurado(a.nr_sequencia,'VCD'),1,100) vl_preco_com_desconto,
	a.nr_seq_plano,
	a.nr_seq_contrato,
	a.nr_seq_titular
from	pls_segurado a
where	a.dt_rescisao is not null
and	a.dt_liberacao is not null

UNION

select	distinct 'B' ie_situacao,
	a.nr_sequencia nr_seq_segurado,
	substr(pls_obter_valor_segurado(a.nr_sequencia,'VSD'),1,100) vl_preco_sem_desconto,
	substr(pls_obter_valor_segurado(a.nr_sequencia,'VCD'),1,100) vl_preco_com_desconto,
	a.nr_seq_plano,
	a.nr_seq_contrato,
	a.nr_seq_titular
from	pls_segurado a
where	a.dt_liberacao is null;

