-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW hbo_unimed_poa_v (tp_registro, nr_seq_protocolo, cd_prestador, nr_seq_lote, nr_interno_conta, cd_serie_documento, dt_geracao, nr_documento, cd_unid_carteira, nr_carteira, dt_referencia, cd_motivo_alta, cd_cid, dt_entrada, dt_alta, dt_ano_guia, nr_guia, cd_classe_nota, cd_acomodacao, nm_beneficiario, ie_sexo, dt_nascimento, dt_validade_carteira, cd_setor_atendimento, cd_procedimento, qt_procedimento_autor, dt_procedimento, ie_urgencia, ie_adicional_urgencia, qt_procedimento, vl_procedimento, ie_tipo_nascimento, nr_seq_autorizacao, ie_tipo_percentual, ie_tipo_insumo, cd_insumo, qt_insumo, dt_insumo, qt_cobrada, vl_cobrado, cd_pacote, dt_emissao, qt_reg_nota, qt_reg_doc, qt_reg_proc, qt_reg_insumo, vl_total_lote, nr_seq_pacote, nr_lote, qt_nasc_vivos_termo, qt_nasc_mortos, qt_nasc_vivos_premat, qt_obito_nasc_precoc, qt_obito_nasc_tardio, ie_tipo_saida, ie_tipo_doenca, qt_tempo_doenca, ie_tipo_tempo_doenca, ie_acidente, cd_cid1, cd_cid2, cd_cid3, nm_prof_solicitante, ie_tipo_atendimento, ie_tipo_consulta, ds_observacoes, ie_gestacao, ie_aborto, ie_trans_gravidez, ie_compl_puerperio, ie_sala_parto, ie_compl_neonat, ie_baixo_peso, ie_parto_cesareo, ie_parto_normal, ie_obito_mulher, ie_nasc_vivos, ie_cid_obito, nr_decl_obito, ie_tipo_faturamento, cd_cobertura, nm_prest_exec, cd_tab_medica, hr_final, nm_prof_exec, ie_tec_utilizada, ie_tipo_perc, qt_pacote, nr_linha_ptu, ie_nasc_vivos2, ie_nasc_vivos3, ie_nasc_vivos4, ie_nasc_vivos5, ie_regime_internacao, ds_indic_clinica, nr_guia_prestador) AS select	/* Header */
	1 				tp_registro, 
	c.nr_seq_protocolo		nr_seq_protocolo, 
	'00101146' 			cd_prestador, 
	c.nr_seq_protocolo 		nr_seq_lote, 
	0				nr_interno_conta, 
	0				cd_serie_documento, 
	LOCALTIMESTAMP 			dt_geracao, 
	' ' 				nr_documento, 
	'0' 				cd_unid_carteira, 
	' ' 				nr_carteira, 
	LOCALTIMESTAMP 			dt_referencia, 
	0 				cd_motivo_alta, 
	' ' 				cd_cid, 
	LOCALTIMESTAMP 			dt_entrada, 
	LOCALTIMESTAMP 			dt_alta, 
	to_char(trunc(LOCALTIMESTAMP,'year'),'yyyy')	 
					dt_ano_guia, 
	0 				nr_guia, 
	'0' 				cd_classe_nota, 
	0 				cd_acomodacao, 
	' ' 				nm_beneficiario, 
	' ' 				ie_sexo, 
	LOCALTIMESTAMP 			dt_nascimento, 
	LOCALTIMESTAMP				dt_validade_carteira, 
	0 				cd_setor_atendimento, 
	0				cd_procedimento, 
	0 				qt_procedimento_autor, 
	LOCALTIMESTAMP 			dt_procedimento, 
	' ' 				ie_urgencia, 
	' '	 			ie_adicional_urgencia, 
	0 				qt_procedimento, 
	0 				vl_procedimento, 
	' ' 				ie_tipo_nascimento, 
	0 				nr_seq_autorizacao, 
	0		 		ie_tipo_percentual, 
	0 				ie_tipo_insumo, 
	0 				cd_insumo, 
	0		 		qt_insumo, 
	LOCALTIMESTAMP 			dt_insumo, 
	0 				qt_cobrada, 
	0	 			vl_cobrado, 
	0 				cd_pacote, 
	LOCALTIMESTAMP 			dt_emissao, 
	0	 			qt_reg_nota, 
 	0 				qt_reg_doc, 
 	0 				qt_reg_proc, 
	0 				qt_reg_insumo, 
	0 				vl_total_lote, 
	0				nr_seq_pacote, 
	0				nr_lote, 
	0 				qt_nasc_vivos_termo, 
	0				 qt_nasc_mortos, 
	0 				qt_nasc_vivos_premat, 
	0 				qt_obito_nasc_precoc, 
	0 				qt_obito_nasc_tardio, 
	0		 		ie_tipo_saida, 
	' '				ie_tipo_doenca, 
	0				qt_tempo_doenca, 
	' '				ie_tipo_tempo_doenca, 
	0 				ie_acidente, 
	' ' 				cd_cid1, 
	' ' 				cd_cid2, 
	' ' 				cd_cid3, 
	' '				nm_prof_solicitante, 
	'00'				ie_tipo_atendimento, 
	' '				ie_tipo_consulta, 
	' '				ds_observacoes, 
	' '				ie_gestacao, 
	' ' 				ie_aborto, 
	' '				ie_trans_gravidez, 
	' '				ie_compl_puerperio, 	 
	' '				ie_sala_parto, 
	' '				ie_compl_neonat, 
	' '				ie_baixo_peso, 
	' '				ie_parto_cesareo, 
	' ' 				ie_parto_normal, 
	' ' 				ie_obito_mulher, 
	' '				ie_nasc_vivos, 
	' '				ie_cid_obito, 
	0				nr_decl_obito, 
	' '				ie_tipo_faturamento, 
	'000'				cd_cobertura, 
	' '				nm_prest_exec, 
	'00'				cd_tab_medica, 
	LOCALTIMESTAMP				hr_final, 
	' ' 				nm_prof_exec, 
	' '				ie_tec_utilizada, 
	' ' 				ie_tipo_perc, 
	0				qt_pacote, 
	0				nr_linha_ptu, 
	' '				ie_nasc_vivos2, 
	' '				ie_nasc_vivos3, 
	' '				ie_nasc_vivos4, 
	' '				ie_nasc_vivos5, 
	0				ie_regime_internacao, 
	' '				ds_indic_clinica, 
	' '				nr_guia_prestador 
FROM	w_interf_conta_header c 

union
 
select	/* Nota */
 
	2	 			tp_registro, 
	c.nr_seq_protocolo		nr_seq_protocolo, 
	'00101146'		 	cd_prestador, 
	0 				nr_seq_lote, 
	0				nr_interno_conta, 
	0				cd_serie_documento, 
	LOCALTIMESTAMP	 			dt_geracao, 
	' ' 				nr_documento, 
	'0'	 			cd_unid_carteira, 
	' ' 				nr_carteira, 
	LOCALTIMESTAMP 			dt_referencia, 
	0	 			cd_motivo_alta, 
	' ' 				cd_cid, 
	LOCALTIMESTAMP	 			dt_entrada, 
	LOCALTIMESTAMP 			dt_alta, 
	to_char(trunc(LOCALTIMESTAMP,'year'),'yyyy')	dt_ano_guia, 
	0		 		nr_guia, 
	'0' 				cd_classe_nota, 
	0 				cd_acomodacao, 
	' '	 			nm_beneficiario, 
	' '	 			ie_sexo, 
	LOCALTIMESTAMP 			dt_nascimento, 
	LOCALTIMESTAMP				dt_validade_carteira, 
	0 				cd_setor_atendimento, 
	0				cd_procedimento, 
	0 				qt_procedimento_autor, 
	LOCALTIMESTAMP 			dt_procedimento, 
	' '	 			ie_urgencia, 
	' ' 				ie_adicional_urgencia, 
	0	 			qt_procedimento, 
	0		 		vl_procedimento, 
	' ' 				ie_tipo_nascimento, 
	0 				nr_seq_autorizacao, 
	0		 		ie_tipo_percentual, 
	0 				ie_tipo_insumo, 
	0 				cd_insumo, 
	0	 			qt_insumo, 
	LOCALTIMESTAMP 			dt_insumo, 
	0	 			qt_cobrada, 
	0		 		vl_cobrado, 
	0 				cd_pacote, 
	LOCALTIMESTAMP 			dt_emissao, 
 	0		 		qt_reg_nota, 
 	0 				qt_reg_doc, 
 	0 				qt_reg_proc, 
	0	 			qt_reg_insumo, 
	0 				vl_total_lote, 
	0				nr_seq_pacote, 
	0				nr_lote, 
	0 				qt_nasc_vivos_termo, 
	0				 qt_nasc_mortos, 
	0 				qt_nasc_vivos_premat, 
	0 				qt_obito_nasc_precoc, 
	0 				qt_obito_nasc_tardio, 
	0		 		ie_tipo_saida, 
	' '				ie_tipo_doenca, 
	0				qt_tempo_doenca, 
	' '				ie_tipo_tempo_doenca, 
	0 				ie_acidente, 
	' ' 				cd_cid1, 
	' ' 				cd_cid2, 
	' ' 				cd_cid3, 
	' '				nm_prof_solicitante, 
	'00'				ie_tipo_atendimento, 
	' '				ie_tipo_consulta, 
	' '				ds_observacoes, 
	' '				ie_gestacao, 
	' ' 				ie_aborto, 
	' '				ie_trans_gravidez, 
	' '				ie_compl_puerperio, 	 
	' '				ie_sala_parto, 
	' '				ie_compl_neonat, 
	' '				ie_baixo_peso, 
	' '				ie_parto_cesareo, 
	' ' 				ie_parto_normal, 
	' ' 				ie_obito_mulher, 
	' '				ie_nasc_vivos, 
	' '				ie_cid_obito, 
	0				nr_decl_obito, 
	' '				ie_tipo_faturamento, 
	'000'				cd_cobertura, 
	' '				nm_prest_exec, 
	'00'				cd_tab_medica, 
	LOCALTIMESTAMP				hr_final, 
	' ' 				nm_prof_exec, 
	' '				ie_tec_utilizada, 
	' ' 				ie_tipo_perc, 
	0				qt_pacote, 
	0				nr_linha_ptu, 
	' '				ie_nasc_vivos2, 
	' '				ie_nasc_vivos3, 
	' '				ie_nasc_vivos4, 
	' '				ie_nasc_vivos5, 
	0				ie_regime_internacao, 
	' '				ds_indic_clinica, 
	' '				nr_guia_prestador 
from	w_interf_conta_header c 

union
 
select	/* Documento */
 
	3	 			tp_registro, 
	b.nr_seq_protocolo		nr_seq_protocolo, 
	CASE WHEN b.ie_tipo_atendimento=3 THEN  substr(a.cd_interno,1,8)  ELSE somente_numero(substr(hdjb_obter_regra_prestador(b.ie_tipo_atendimento,d.ie_tipo_guia, b.nr_seq_protocolo, b.cd_medico_resp),1,8)) END  cd_prestador, 
	0 				nr_seq_lote, 
	b.nr_interno_conta		nr_interno_conta, 
	1				cd_serie_documento, 
	LOCALTIMESTAMP 			dt_geracao, 
	substr(b.nr_doc_convenio,1,8)	nr_documento, 
	substr(b.cd_usuario_convenio,1,4) cd_unid_carteira, 
	substr(b.cd_usuario_convenio,5,13) nr_carteira, 
	LOCALTIMESTAMP				dt_referencia, 
	b.cd_motivo_alta		cd_motivo_alta, 
	substr(b.cd_cid_principal,1,4)	cd_cid, 
	b.dt_entrada			dt_entrada, 
	b.dt_alta			dt_alta, 
	CASE WHEN d.ie_tipo_guia='E' THEN null WHEN d.ie_tipo_guia='C' THEN null WHEN d.ie_tipo_guia='A' THEN  null  ELSE to_char(trunc(b.dt_periodo_inicial,'year'),'yyyy') END  
					dt_ano_guia, 
	CASE WHEN d.ie_tipo_guia='E' THEN 00000000 WHEN d.ie_tipo_guia='A' THEN 00000000  ELSE somente_numero(substr(b.nr_doc_convenio,1,8)) END  
					nr_guia, 
	CASE WHEN b.ie_tipo_atendimento=7 THEN '02'  ELSE CASE WHEN d.ie_tipo_guia='IC' THEN '04' WHEN d.ie_tipo_guia='I' THEN '05' WHEN d.ie_tipo_guia='IO' THEN '06' WHEN d.ie_tipo_guia='AI' THEN '03'  ELSE '08' END  END  cd_classe_nota, 
	b.cd_tipo_acomodacao		cd_acomodacao,	 
	substr(b.nm_paciente,1,40)	nm_beneficiario, 
	b.ie_sexo			ie_sexo, 
	b.dt_nascimento			dt_nascimento, 
	b.dt_validade_carteira		 dt_validade_carteira, 
	coalesce(b.cd_setor_atendimento,0) 	cd_setor_atendimento, 
	0				cd_procedimento, 
	0 				qt_procedimento_autor, 
	LOCALTIMESTAMP 			dt_procedimento, 
	' '	 			ie_urgencia, 
	' ' 				ie_adicional_urgencia, 
	0 				qt_procedimento, 
	0 				vl_procedimento, 
	' '	 			ie_tipo_nascimento, 
	0				nr_seq_autorizacao, 
	0 				ie_tipo_percentual, 
	0 				ie_tipo_insumo, 
	0 				cd_insumo, 
	0 				qt_insumo, 
	LOCALTIMESTAMP 			dt_insumo, 
	0 				qt_cobrada, 
	0	 			vl_cobrado, 
	0 				cd_pacote, 
	LOCALTIMESTAMP 			dt_referencia, 
 	0 				qt_reg_nota, 
 	0 				qt_reg_doc, 
 	0 				qt_reg_proc, 
	0 				qt_reg_insumo, 
	0 				vl_total_lote, 
	0				nr_seq_pacote,	 
	somente_numero(substr(obter_dados_protocolo(a.nr_seq_protocolo,'DC'),1,8)) nr_lote, 
	(SELECT sum(qt_nasc_vivos) FROM parto WHERE NR_ATENDIMENTO = b.NR_ATENDIMENTO) qt_nasc_vivos_termo, 
	(SELECT sum(qt_nasc_mortos) FROM parto WHERE NR_ATENDIMENTO = b.NR_ATENDIMENTO) qt_nasc_mortos, 
	CASE WHEN b.ie_tipo_nascimento=3 THEN 1  ELSE 0 END  qt_nasc_vivos_premat, 
	CASE WHEN b.ie_tipo_nascimento=8 THEN 1  ELSE 0 END  qt_obito_nasc_precoc, 
	CASE WHEN b.ie_tipo_nascimento=7 THEN 1  ELSE 0 END  qt_obito_nasc_tardio, 
	b.cd_motivo_alta 		ie_tipo_saida, 
	substr(hdjb_obter_dados_tiss_diag(b.nr_atendimento, '1'),1,1) ie_tipo_doenca, 
	somente_numero(substr(hdjb_obter_dados_tiss_diag(b.nr_atendimento, '3'),1,2)) qt_tempo_doenca, 
	substr(hdjb_obter_dados_tiss_diag(b.nr_atendimento,'2'),1,1) ie_tipo_tempo_doenca, 
	0 				ie_acidente, 
	CASE WHEN b.cd_cid_secundario IS NULL THEN substr(b.cd_cid_principal,1,4)  ELSE substr(b.cd_cid_secundario,1,4) END  
					cd_cid1, 
	' ' 				cd_cid2, 
	' ' 				cd_cid3, 
	substr(d.nm_medico_solicitante,1,70) 
					nm_prof_solicitante, 
	CASE WHEN b.ie_tipo_atendimento=7 THEN  '05'  ELSE b.ie_tipo_atendimento END  ie_tipo_atendimento, 
	D.IE_TIPO_GUIA			ie_tipo_consulta, 
	' '				ds_observacoes, 
	CASE WHEN b.ie_tipo_nascimento=1 THEN 'S'  ELSE 'N' END  ie_gestacao, 
	CASE WHEN b.ie_tipo_nascimento=2 THEN 'S'  ELSE 'N' END  ie_aborto, 
	CASE WHEN b.ie_tipo_nascimento=6 THEN 'S'  ELSE 'N' END  ie_trans_gravidez, 
	'N'				ie_compl_puerperio, 	 
	'N'				ie_sala_parto, 
	'N'				ie_compl_neonat, 
	(SELECT max('S') FROM nascimento WHERE NR_ATENDIMENTO = b.NR_ATENDIMENTO and qt_peso < 2.5) 
					ie_baixo_peso, 
	(SELECT CASE WHEN ie_parto_cesaria IS NULL THEN 'N'  ELSE ie_parto_cesaria END  FROM parto WHERE NR_ATENDIMENTO = b.NR_ATENDIMENTO)	 
					ie_parto_cesareo, 
	(SELECT CASE WHEN ie_parto_normal IS NULL THEN 'N'  ELSE ie_parto_normal END  FROM parto WHERE NR_ATENDIMENTO = b.NR_ATENDIMENTO) 
					ie_parto_normal, 
	' ' 				ie_obito_mulher, 
	' '				ie_nasc_vivos, 
	' '				ie_cid_obito, 
	0				nr_decl_obito, 
	'T'				ie_tipo_faturamento, 
	'000'				cd_cobertura, 
	' '				nm_prest_exec, 
	'00'				cd_tab_medica, 
	LOCALTIMESTAMP				hr_final, 
	' ' 				nm_prof_exec, 
	' '				ie_tec_utilizada, 
	' ' 				ie_tipo_perc, 
	0				qt_pacote, 
	0				nr_linha_ptu, 
	' '				ie_nasc_vivos2, 
	' '				ie_nasc_vivos3, 
	' '				ie_nasc_vivos4, 
	' '				ie_nasc_vivos5, 
	0				ie_regime_internacao, 
	' '				ds_indic_clinica, 
	to_char(b.nr_atendimento)	nr_guia_prestador 
FROM w_interf_conta_header a, w_interf_conta_cab b
LEFT OUTER JOIN w_interf_conta_autor d ON (b.nr_interno_conta = d.nr_interno_conta)
WHERE b.nr_seq_protocolo	= a.nr_seq_protocolo  and coalesce(d.nr_sequencia,0) = 
	(select coalesce(min(y.nr_sequencia),0) 
		from w_interf_conta_autor y 
		where b.nr_interno_conta = y.nr_interno_conta) 
 
union
 
select	/*Procedimentos*/
 
	4	 			tp_registro, 
	c.nr_seq_protocolo		nr_seq_protocolo, 
	'00101146'			cd_prestador, 
	0 				nr_seq_lote, 
	d.nr_interno_conta		nr_interno_conta, 
	0				cd_serie_documento, 
	LOCALTIMESTAMP 			dt_geracao, 
	' ' 				nr_documento, 
	'0' 				cd_unid_carteira, 
	' ' 				nr_carteira, 
	LOCALTIMESTAMP 			dt_referencia, 
	0 				cd_motivo_alta, 
	' ' 				cd_cid, 
	LOCALTIMESTAMP 			dt_entrada, 
	LOCALTIMESTAMP 			dt_alta, 
	to_char(trunc(LOCALTIMESTAMP,'year'),'yyyy')	 
					dt_ano_guia, 
	0 				nr_guia, 
	'0' 				cd_classe_nota, 
	0 				cd_acomodacao, 
	' ' 				nm_beneficiario, 
	' '	 			ie_sexo, 
	LOCALTIMESTAMP 			Dt_nascimento, 
	LOCALTIMESTAMP				dt_validade_carteira, 
	0 				cd_setor_atendimento, 
	somente_numero(coalesce(d.cd_item_convenio, d.cd_item)) 
					cd_procedimento, 
	d.qt_item 			qt_procedimento_autor, 
	d.dt_item			dt_procedimento, 
	CASE WHEN c.ie_carater_inter='20' THEN 'S' WHEN c.ie_carater_inter='5' THEN 'S'  ELSE 'N' END 	 
					ie_urgencia, 
	'N' 				ie_adicional_urgencia, 
	d.qt_item			qt_procedimento, 
	d.vl_total_item			vl_procedimento, 
	c.ie_tipo_nascimento		ie_tipo_nascimento, 
	somente_numero(substr(d.cd_senha_guia,1,8))	 
					nr_seq_autorizacao, 
	CASE WHEN d.pr_funcao_participante=50 THEN 1 WHEN d.pr_funcao_participante=20 THEN 2 WHEN d.pr_funcao_participante=40 THEN 4 WHEN d.pr_funcao_participante=100 THEN 05  ELSE 00 END  
					ie_tipo_percentual, 
	0 				ie_tipo_insumo, 
	0 				cd_insumo, 
	0 				qt_insumo, 
	LOCALTIMESTAMP 			dt_insumo, 
	0 				qt_cobrada, 
	0 				vl_cobrado, 
	0 				cd_pacote, 
	LOCALTIMESTAMP 			dt_emissao, 
 	0 				qt_reg_nota,			 
 	0 				qt_reg_doc, 
 	0	 			qt_reg_proc, 
	0 				qt_reg_insumo, 
	0 				vl_total_lote, 
	0				nr_seq_pacote, 
	0				nr_lote, 
	0 				qt_nasc_vivos_termo, 
	0				 qt_nasc_mortos, 
	0 				qt_nasc_vivos_premat, 
	0 				qt_obito_nasc_precoc, 
	0 				qt_obito_nasc_tardio, 
	0		 		ie_tipo_saida, 
	' '				ie_tipo_doenca, 
	0				qt_tempo_doenca, 
	' '				ie_tipo_tempo_doenca, 
	0 				ie_acidente, 
	' ' 				cd_cid1, 
	' ' 				cd_cid2, 
	' ' 				cd_cid3, 
	' '				nm_prof_solicitante, 
	'00'				ie_tipo_atendimento, 
	' '				ie_tipo_consulta, 
	' '				ds_observacoes, 
	' '				ie_gestacao, 
	' ' 				ie_aborto, 
	' '				ie_trans_gravidez, 
	' '				ie_compl_puerperio, 	 
	' '				ie_sala_parto, 
	' '				ie_compl_neonat, 
	' '				ie_baixo_peso, 
	' '				ie_parto_cesareo, 
	' ' 				ie_parto_normal, 
	' ' 				ie_obito_mulher, 
	' '				ie_nasc_vivos, 
	' '				ie_cid_obito, 
	0				nr_decl_obito, 
	' '				ie_tipo_faturamento, 
	'000'				cd_cobertura, 
	substr(obter_dados_pf_pj(Null, CD_CGC_PRESTADOR, 'N'),1,30) 
					nm_prest_exec, 
	'00'				cd_tab_medica, 
	LOCALTIMESTAMP				hr_final, 
	substr(d.nm_medico_executor,1,70) nm_prof_exec, 
	' '				ie_tec_utilizada, 
	' ' 				ie_tipo_perc, 
	0				qt_pacote, 
	0				nr_linha_ptu, 
	' '				ie_nasc_vivos2, 
	' '				ie_nasc_vivos3, 
	' '				ie_nasc_vivos4, 
	' '				ie_nasc_vivos5, 
	0				ie_regime_internacao, 
	' '				ds_indic_clinica, 
	to_char(c.nr_atendimento)	nr_guia_prestador 
from	w_interf_conta_item d, 
	w_interf_conta_cab c	 
where  c.nr_interno_conta = d.nr_interno_conta 
and	d.nr_seq_proc_pacote is null 
and	coalesce(d.cd_grupo_gasto,0) not in (10,11,12,20) 
and 	d.ie_tipo_item = 1 

union
 
select	/* Insumos (Taxas e diarias) */
 
	5	 			tp_registro, 
	c.nr_seq_protocolo		nr_seq_protocolo, 
	'00101146'			cd_prestador, 
	0 				nr_seq_lote, 
	d.nr_interno_conta		nr_interno_conta, 
	0				cd_serie_documento, 
	LOCALTIMESTAMP 			dt_geracao, 
	' ' 				nr_documento, 
	'0' 				cd_unid_carteira, 
	' ' 				nr_carteira, 
	LOCALTIMESTAMP 			dt_referencia, 
	0 				cd_motivo_alta, 
	' ' 				cd_cid, 
	LOCALTIMESTAMP 			dt_entrada, 
	LOCALTIMESTAMP 			dt_alta, 
	to_char(trunc(LOCALTIMESTAMP,'year'),'yyyy')	dt_ano_guia, 
	0 				nr_guia, 
	'0' 				cd_classe_nota, 
	0 				cd_acomodacao, 
	' ' 				nm_beneficiario, 
	' '	 			ie_sexo, 
	LOCALTIMESTAMP 			Dt_nascimento, 
	LOCALTIMESTAMP				dt_validade_carteira, 
	0 				cd_setor_atendimento, 
	0				cd_procedimento, 
	0		 		qt_procedimento_autor, 
	LOCALTIMESTAMP				dt_procedimento, 
	' '				ie_urgencia, 
	' ' 				ie_adicional_urgencia, 
	0				qt_procedimento, 
	0 				vl_procedimento, 
	' '				ie_tipo_nascimento, 
	0				nr_seq_autorizacao, 
	0				ie_tipo_percentual, 
	CASE WHEN d.cd_item=99901013 THEN 99 WHEN d.cd_item=99901315 THEN 99  ELSE (d.cd_grupo_gasto)::numeric  END 	ie_tipo_insumo, 
	somente_numero(coalesce(d.cd_item_convenio,d.cd_item))	 
					cd_insumo, 
	d.qt_item			qt_insumo, 
	d.dt_item			dt_insumo, 
	d.qt_item			qt_cobrada, 
	d.vl_total_item			vl_cobrado, 
	0 				cd_pacote, 
	LOCALTIMESTAMP 			dt_emissao, 
 	0 				qt_reg_nota,			 
 	0 				qt_reg_doc, 
 	0	 			qt_reg_proc, 
	0 				qt_reg_insumo, 
	0 				vl_total_lote, 
	0				nr_seq_pacote, 
	0				nr_lote, 
	0 				qt_nasc_vivos_termo, 
	0				 qt_nasc_mortos, 
	0 				qt_nasc_vivos_premat, 
	0 				qt_obito_nasc_precoc, 
	0 				qt_obito_nasc_tardio, 
	0		 		ie_tipo_saida, 
	' '				ie_tipo_doenca, 
	0				qt_tempo_doenca, 
	' '				ie_tipo_tempo_doenca, 
	0 				ie_acidente, 
	' ' 				cd_cid1, 
	' ' 				cd_cid2, 
	' ' 				cd_cid3, 
	' '				nm_prof_solicitante, 
	'00'				ie_tipo_atendimento, 
	' '				ie_tipo_consulta, 
	' '				ds_observacoes, 
	' '				ie_gestacao, 
	' ' 				ie_aborto, 
	' '				ie_trans_gravidez, 
	' '				ie_compl_puerperio, 	 
	' '				ie_sala_parto, 
	' '				ie_compl_neonat, 
	' '				ie_baixo_peso, 
	' '				ie_parto_cesareo, 
	' ' 				ie_parto_normal, 
	' ' 				ie_obito_mulher, 
	' '				ie_nasc_vivos, 
	' '				ie_cid_obito, 
	0				nr_decl_obito, 
	' '				ie_tipo_faturamento, 
	'000'				cd_cobertura, 
	' '				nm_prest_exec, 
	'00'				cd_tab_medica, 
	LOCALTIMESTAMP				hr_final, 
	' ' 				nm_prof_exec, 
	' '				ie_tec_utilizada, 
	' ' 				ie_tipo_perc, 
	0				qt_pacote, 
	0				nr_linha_ptu, 
	' '				ie_nasc_vivos2, 
	' '				ie_nasc_vivos3, 
	' '				ie_nasc_vivos4, 
	' '				ie_nasc_vivos5, 
	0				ie_regime_internacao, 
	' '				ds_indic_clinica, 
	to_char(c.nr_atendimento)	nr_guia_prestador 
from	w_interf_conta_item 	d, 
	w_interf_conta_cab 	c	 
where  c.nr_interno_conta = d.nr_interno_conta 
and	d.nr_seq_proc_pacote is null 
and	coalesce(d.cd_grupo_gasto,0) in (10,11,12,20) 
and 	d.ie_tipo_item = 1 

union
 
select	/* Insumos (Materiais e Medicamentos) */
 
	5				tp_registro, 
	c.nr_seq_protocolo		nr_seq_protocolo, 
	'00101146'			cd_prestador, 
	0 				nr_seq_lote, 
	d.nr_interno_conta		nr_interno_conta, 
	0				cd_serie_documento, 
	LOCALTIMESTAMP	 			dt_geracao, 
	' ' 				nr_documento, 
	'0' 				cd_unid_carteira, 
	' ' 				nr_carteira, 
	LOCALTIMESTAMP 			dt_referencia, 
	0 				cd_motivo_alta, 
	' ' 				cd_cid, 
	LOCALTIMESTAMP	 			dt_entrada, 
	LOCALTIMESTAMP 			dt_alta, 
	to_char(trunc(LOCALTIMESTAMP,'year'),'yyyy')	dt_ano_guia, 
	0 				nr_guia, 
	'0' 				cd_classe_nota, 
	0 				cd_acomodacao, 	 
	' ' 				nm_beneficiario, 
	' ' 				ie_sexo, 
	LOCALTIMESTAMP 			dt_nascimento, 
	LOCALTIMESTAMP				dt_validade_carteira, 
	0 				cd_setor_atendimento, 
	0				cd_procedimento, 
	0 				qt_procedimento_autor, 
	LOCALTIMESTAMP 			dt_procedimento, 
	' ' 				ie_urgencia, 
	' ' 				ie_adicional_urgencia, 
	0 				qt_procedimento, 
	0 				vl_procedimento, 
	' ' 				ie_tipo_nascimento, 
	0 				nr_seq_autorizacao, 
	0 				ie_tipo_percentual, 
	(d.cd_grupo_gasto)::numeric 	ie_tipo_insumo, 
	somente_numero(coalesce(d.cd_item_convenio,d.cd_item)) 
					cd_insumo, 
	sum(d.qt_item) 			qt_insumo, 
	d.dt_item			dt_insumo, 
	sum(d.qt_item) 			qt_cobrada, 
	sum(d.vl_total_item) 		vl_cobrado, 
	0	 			cd_pacote, 
	LOCALTIMESTAMP 			dt_emissao, 
 	0 				qt_reg_nota,	 
 	0 				qt_reg_doc, 
 	0 				qt_reg_proc, 
	0 				qt_reg_insumo, 
	0 				vl_total_lote, 
	0				nr_seq_pacote, 
	0				nr_lote, 
	0 				qt_nasc_vivos_termo, 
	0				 qt_nasc_mortos, 
	0 				qt_nasc_vivos_premat, 
	0 				qt_obito_nasc_precoc, 
	0 				qt_obito_nasc_tardio, 
	0		 		ie_tipo_saida, 
	' '				ie_tipo_doenca, 
	0				qt_tempo_doenca, 
	' '				ie_tipo_tempo_doenca, 
	0 				ie_acidente, 
	' ' 				cd_cid1, 
	' ' 				cd_cid2, 
	' ' 				cd_cid3, 
	' '				nm_prof_solicitante, 
	'00'				ie_tipo_atendimento, 
	' '				ie_tipo_consulta, 
	' '				ds_observacoes, 
	' '				ie_gestacao, 
	' ' 				ie_aborto, 
	' '				ie_trans_gravidez, 
	' '				ie_compl_puerperio, 	 
	' '				ie_sala_parto, 
	' '				ie_compl_neonat, 
	' '				ie_baixo_peso, 
	' '				ie_parto_cesareo, 
	' ' 				ie_parto_normal, 
	' ' 				ie_obito_mulher, 
	' '				ie_nasc_vivos, 
	' '				ie_cid_obito, 
	0				nr_decl_obito, 
	' '				ie_tipo_faturamento, 
	'000'				cd_cobertura, 
	' '				nm_prest_exec, 
	'00'				cd_tab_medica, 
	LOCALTIMESTAMP				hr_final, 
	' ' 				nm_prof_exec, 
	' '				ie_tec_utilizada, 
	' ' 				ie_tipo_perc, 
	0				qt_pacote, 
	0				nr_linha_ptu, 
	' '				ie_nasc_vivos2, 
	' '				ie_nasc_vivos3, 
	' '				ie_nasc_vivos4, 
	' '				ie_nasc_vivos5, 
	0				ie_regime_internacao, 
	' '				ds_indic_clinica, 
	' '				nr_guia_prestador 
from	w_interf_conta_item 	d, 
	w_interf_conta_cab 	c	 
where  c.nr_interno_conta = d.nr_interno_conta 
and	d.nr_seq_proc_pacote is null 
and 	d.ie_tipo_item = 2 
group by 5, 
	c.nr_seq_protocolo, 
	'00101146', 
	d.nr_interno_conta, 
	to_char(trunc(LOCALTIMESTAMP,'year'),'yyyy'), 
	d.dt_item, 
	(d.cd_grupo_gasto)::numeric , 
	somente_numero(coalesce(d.cd_item_convenio,d.cd_item)) 
having	sum(d.qt_item) > 0 

union
 
select	/* Pacote */
 
	6 				tp_registro, 
	c.nr_seq_protocolo		nr_seq_protocolo, 
	'00101146'			cd_prestador, 
	0 				nr_seq_lote, 
	d.nr_interno_conta		nr_interno_conta, 
	0				cd_serie_documento, 
	LOCALTIMESTAMP 			dt_geracao, 
	' ' 				nr_documento, 
	'0' 				cd_unid_carteira, 
	' ' 				nr_carteira, 
	LOCALTIMESTAMP 			dt_referencia, 
	0 				cd_motivo_alta, 
	' ' 				cd_cid, 
	LOCALTIMESTAMP 			dt_entrada, 
	LOCALTIMESTAMP 			dt_alta, 
	to_char(trunc(LOCALTIMESTAMP,'year'),'yyyy')	 
					dt_ano_guia, 
	0 				nr_guia, 
	'0' 				cd_classe_nota, 
	0 				cd_acomodacao, 	 
	' ' 				nm_beneficiario, 
	' ' 				ie_sexo, 
	LOCALTIMESTAMP 			dt_nascimento, 
	LOCALTIMESTAMP				dt_validade_carteira, 
	0 				cd_setor_atendimento, 
	0				cd_procedimento, 
	0 				qt_procedimento_autor, 
	LOCALTIMESTAMP 			dt_procedimento, 
	' ' 				ie_urgencia, 
	' ' 				ie_adicional_urgencia, 
	0 				qt_procedimento, 
	0 				vl_procedimento, 
	' ' 				ie_tipo_nascimento, 
	0 				nr_seq_autorizacao, 
	0 				ie_tipo_percentual,	 
	0 				ie_tipo_insumo,	 
	0 				cd_insumo, 
	0 				qt_insumo, 
	LOCALTIMESTAMP 			dt_insumo, 
	0 				qt_cobrada, 
	0 				vl_cobrado, 
	somente_numero(coalesce(d.cd_item_convenio,d.cd_item)) 
					cd_pacote, 
	d.dt_item			dt_emissao, 
 	0 				qt_reg_nota,	 
 	0 				qt_reg_doc, 
 	0 				qt_reg_proc, 
	0 				qt_reg_insumo, 
	0 				vl_total_lote, 
	d.nr_seq_proc_pacote		nr_seq_pacote, 
	0				nr_lote, 
	0 				qt_nasc_vivos_termo, 
	0				 qt_nasc_mortos, 
	0 				qt_nasc_vivos_premat, 
	0 				qt_obito_nasc_precoc, 
	0 				qt_obito_nasc_tardio, 
	0		 		ie_tipo_saida, 
	' '				ie_tipo_doenca, 
	0				qt_tempo_doenca, 
	' '				ie_tipo_tempo_doenca, 
	0 				ie_acidente, 
	' ' 				cd_cid1, 
	' ' 				cd_cid2, 
	' ' 				cd_cid3, 
	' '				nm_prof_solicitante, 
	'00'				ie_tipo_atendimento, 
	' '				ie_tipo_consulta, 
	' '				ds_observacoes, 
	' '				ie_gestacao, 
	' ' 				ie_aborto, 
	' '				ie_trans_gravidez, 
	' '				ie_compl_puerperio, 	 
	' '				ie_sala_parto, 
	' '				ie_compl_neonat, 
	' '				ie_baixo_peso, 
	' '				ie_parto_cesareo, 
	' ' 				ie_parto_normal, 
	' ' 				ie_obito_mulher, 
	' '				ie_nasc_vivos, 
	' '				ie_cid_obito, 
	0				nr_decl_obito, 
	' '				ie_tipo_faturamento, 
	'000'				cd_cobertura, 
	' '				nm_prest_exec, 
	'00'				cd_tab_medica, 
	LOCALTIMESTAMP				hr_final, 
	' ' 				nm_prof_exec, 
	' '				ie_tec_utilizada, 
	' ' 				ie_tipo_perc, 
	d.qt_item			qt_pacote, 
	0				nr_linha_ptu, 
	' '				ie_nasc_vivos2, 
	' '				ie_nasc_vivos3, 
	' '				ie_nasc_vivos4, 
	' '				ie_nasc_vivos5, 
	0				ie_regime_internacao, 
	' '				ds_indic_clinica, 
	' '				nr_guia_prestador 
from	w_interf_conta_item 	d, 
	w_interf_conta_cab 	c	 
where  c.nr_interno_conta = d.nr_interno_conta 
and	d.nr_seq_proc_pacote is not null 

union
 
select	/* Trailler */
 
	7 				tp_registro, 
	c.nr_seq_protocolo		nr_seq_protocolo, 
	'0'	 			cd_prestador, 
	0 				nr_seq_lote, 
	9999999999				nr_interno_conta, 
	0				cd_serie_documento, 
	LOCALTIMESTAMP 			dt_geracao, 
	' ' 				nr_documento, 
	'0' 				cd_unid_carteira, 
	' ' 				nr_carteira, 
	LOCALTIMESTAMP 			dt_referencia, 
	0 				cd_motivo_alta, 
	' ' 				cd_cid, 
	LOCALTIMESTAMP 			dt_entrada, 
	LOCALTIMESTAMP 			dt_alta, 
	to_char(trunc(LOCALTIMESTAMP,'year'),'yyyy')	 
					dt_ano_guia, 
	0 				nr_guia, 
	'0' 				cd_classe_nota, 
	0 				cd_acomodacao, 
	' ' 				nm_beneficiario, 
	' ' 				ie_sexo, 
	LOCALTIMESTAMP 			dt_nascimento, 
	LOCALTIMESTAMP				dt_validade_carteira, 
	0 				cd_setor_atendimento, 
	0				cd_procedimento, 
	0 				qt_procedimento_autor, 
	LOCALTIMESTAMP 			dt_procedimento, 
	' ' 				ie_urgencia, 
	' ' 				ie_adicional_urgencia, 
	0 				qt_procedimento, 
	0 				vl_procedimento, 
	' ' 				ie_tipo_nascimento, 
	0 				nr_seq_autorizacao, 
	0 				ie_tipo_percentual, 
	0 				ie_tipo_insumo,	 
	0 				cd_insumo, 
	0 				qt_insumo, 
	LOCALTIMESTAMP 			dt_insumo, 
	0 				qt_cobrada, 
	0 				vl_cobrado, 
	0 				cd_pacote, 
	LOCALTIMESTAMP 			dt_emissao, 
 	2 				qt_reg_nota, 
 	3 				qt_reg_doc, 
 	4 				qt_reg_proc, 
	5 				qt_reg_insumo, 
	hbo_obter_total_protocolo(c.nr_seq_protocolo) vl_total_lote, 
	0				nr_seq_pacote, 
	0				nr_lote, 
	0 				qt_nasc_vivos_termo, 
	0				 qt_nasc_mortos, 
	0 				qt_nasc_vivos_premat, 
	0 				qt_obito_nasc_precoc, 
	0 				qt_obito_nasc_tardio, 
	0		 		ie_tipo_saida, 
	' '				ie_tipo_doenca, 
	0				qt_tempo_doenca, 
	' '				ie_tipo_tempo_doenca, 
	0 				ie_acidente, 
	' ' 				cd_cid1, 
	' ' 				cd_cid2, 
	' ' 				cd_cid3, 
	' '				nm_prof_solicitante, 
	'00'				ie_tipo_atendimento, 
	' '				ie_tipo_consulta, 
	' '				ds_observacoes, 
	' '				ie_gestacao, 
	' ' 				ie_aborto, 
	' '				ie_trans_gravidez, 
	' '				ie_compl_puerperio, 	 
	' '				ie_sala_parto, 
	' '				ie_compl_neonat, 
	' '				ie_baixo_peso, 
	' '				ie_parto_cesareo, 
	' ' 				ie_parto_normal, 
	' ' 				ie_obito_mulher, 
	' '				ie_nasc_vivos, 
	' '				ie_cid_obito, 
	0				nr_decl_obito, 
	' '				ie_tipo_faturamento, 
	'000'				cd_cobertura, 
	' '				nm_prest_exec, 
	'00'				cd_tab_medica, 
	LOCALTIMESTAMP				hr_final, 
	' ' 				nm_prof_exec, 
	' '				ie_tec_utilizada, 
	' ' 				ie_tipo_perc, 
	0				qt_pacote, 
	0				nr_linha_ptu, 
	' '				ie_nasc_vivos2, 
	' '				ie_nasc_vivos3, 
	' '				ie_nasc_vivos4, 
	' '				ie_nasc_vivos5, 
	0				ie_regime_internacao, 
	' '				ds_indic_clinica, 
	' '				nr_guia_prestador 
from	w_interf_conta_trailler c 
group by c.nr_seq_protocolo;

