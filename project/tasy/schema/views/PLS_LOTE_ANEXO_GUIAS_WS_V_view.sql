-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_lote_anexo_guias_ws_v (nr_seq_lote_anexo, nr_seq_lote_anexo_guia, nr_lote_prestador, dt_arquivo, cd_ans, nm_contratado, nr_seq_prestador, cd_prestador, dt_autorizacao, dt_validade_senha, cd_senha, qt_anexo_lote, ie_tipo_anexo, cd_guia_prestador, cd_guia, cd_guia_referencia, ie_status, cd_usuario_plano, ie_recem_nascido, nm_beneficiario, cd_cnes, ds_observacao, nr_seq_guia, qt_peso, qt_altura, qt_idade_benef, ie_sexo, qt_superficie_corporal, nm_profissional_solic, ds_email_prof_solic, nr_telef_prof_solic, ds_procedimento_cirurgico, dt_real_proc_cirurgico, ds_area_irradiada, dt_quimioterapia, nr_ciclo_previsto, nr_ciclo_atual, qt_intervalo_ciclo, dt_radioterapia, nr_campos, qt_dose_total, qt_dias_previsto, qt_dose_dia, dt_inicio_previsto, ds_quimioterapia, nm_social_beneficiario) AS select	a.nr_sequencia nr_seq_lote_anexo,
	b.nr_sequencia nr_seq_lote_anexo_guia,
	a.nr_lote_prestador,
	a.dt_envio_lote dt_arquivo,
	(select max(cd_ans) cd_ans FROM  pls_outorgante) cd_ans,
	pls_obter_dados_prestador(c.nr_seq_prestador,'N') nm_contratado,
	c.nr_seq_prestador,
	pls_obter_cod_prestador(c.nr_seq_prestador, null) cd_prestador,
	c.dt_autorizacao,
	c.dt_validade_senha,
	c.cd_senha,
	(select count(1) from pls_lote_anexo_guias_imp x where x.nr_seq_lote_anexo = a.nr_sequencia) qt_anexo_lote,
	b.ie_tipo_anexo,
	b.cd_guia_prestador,
	b.cd_guia,
	b.cd_guia_referencia,
	b.ie_status,
	b.cd_usuario_plano,
	b.ie_recem_nascido,
	b.nm_beneficiario,
	b.cd_cnes,
	b.ds_observacao,
	b.nr_seq_guia,
	b.qt_peso,
	b.qt_altura,
	b.qt_idade_benef,
	b.ie_sexo,
	b.qt_superficie_corporal,
	b.nm_profissional_solic,
	b.ds_email_prof_solic,
	b.nr_telef_prof_solic,
	b.ds_procedimento_cirurgico,
	b.dt_real_proc_cirurgico,
	b.ds_area_irradiada,
	b.dt_quimioterapia,
	b.nr_ciclo_previsto,
	b.nr_ciclo_atual,
	b.qt_intervalo_ciclo,
	b.dt_radioterapia,
	b.nr_campos,
	b.qt_dose_total,
	b.qt_dias_previsto,
	b.qt_dose_dia,
	b.dt_inicio_previsto,	
	b.ds_quimioterapia,
	pls_obter_dados_segurado(pls_obter_dados_carteira(null,b.cd_usuario_plano,'S'), 'NS') nm_social_beneficiario
FROM pls_lote_anexo_aut a, pls_lote_anexo_guias_aut b
LEFT OUTER JOIN pls_guia_plano c ON (b.nr_seq_guia = c.nr_sequencia)
WHERE b.nr_seq_lote_anexo = a.nr_sequencia
union

select	a.nr_sequencia nr_seq_lote_anexo,
	b.nr_sequencia nr_seq_lote_anexo_guia,
	a.nr_lote_prestador,
	a.dt_envio_lote dt_arquivo,
	(select max(cd_ans) cd_ans from  pls_outorgante) cd_ans,
	pls_obter_dados_prestador(c.nr_seq_prestador,'N') nm_contratado,
	c.nr_seq_prestador,
	pls_obter_cod_prestador(c.nr_seq_prestador, null) cd_prestador,
	c.dt_autorizacao,
	c.dt_validade_senha,
	c.cd_senha,
	(select count(1) from pls_lote_anexo_guias_imp x where x.nr_seq_lote_anexo = a.nr_sequencia) qt_anexo_lote,
	b.ie_tipo_anexo,
	b.cd_guia_prestador,
	b.cd_guia,
	b.cd_guia_referencia,
	b.ie_status,
	b.cd_usuario_plano,
	b.ie_recem_nascido,
	b.nm_beneficiario,
	b.cd_cnes,
	b.ds_observacao,
	b.nr_seq_guia,
	b.qt_peso,
	b.qt_altura,
	b.qt_idade_benef,
	b.ie_sexo,
	b.qt_superficie_corporal,
	b.nm_profissional_solic,
	b.ds_email_prof_solic,
	b.nr_telef_prof_solic,
	b.ds_procedimento_cirurgico,
	b.dt_real_proc_cirurgico,
	b.ds_area_irradiada,
	b.dt_quimioterapia,
	b.nr_ciclo_previsto,
	b.nr_ciclo_atual,
	b.qt_intervalo_ciclo,
	b.dt_radioterapia,
	b.nr_campos,
	b.qt_dose_total,
	b.qt_dias_previsto,
	b.qt_dose_dia,
	b.dt_inicio_previsto,	
	b.ds_quimioterapia,
	pls_obter_dados_segurado(pls_obter_dados_carteira(null,b.cd_usuario_plano,'S'), 'NS') nm_social_beneficiario
FROM pls_lote_anexo_aut a, pls_lote_anexo_guias_imp b
LEFT OUTER JOIN pls_guia_plano c ON (b.nr_seq_guia = c.nr_sequencia)
WHERE b.nr_seq_lote_anexo = a.nr_sequencia;

