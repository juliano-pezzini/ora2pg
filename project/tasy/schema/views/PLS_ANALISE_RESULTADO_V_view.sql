-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_analise_resultado_v (dt_competencia, vl_mensalidade, vl_faturamento, vl_taxa_intercambio, vl_conta_medica, vl_conta_receita, vl_reembolso, vl_ressarcimento_sus, vl_recurso_glosa, vl_coparticipacao, vl_comissao, vl_desp_nao_assit, vl_encargo, vl_provisao, vl_total_receita, vl_custo_assitencial, vl_total_despesa, nr_seq_contrato, nr_seq_intercambio, nr_seq_grupo_intercambio, nr_seq_segurado, nr_seq_pagador, nr_seq_plano, nr_seq_faixa_etaria, ie_tipo_segurado, ie_tipo_contrato, ie_tipo_vinculo_operadora, ie_situacao_trabalhista, ie_tipo_contratacao, ie_regulamentacao, ie_preco) AS select	trunc(b.dt_mes_competencia,'month') dt_competencia,
	coalesce(a.vl_item,0) vl_mensalidade,
	0 vl_faturamento,
	0 vl_taxa_intercambio,
	0 vl_conta_medica,
	0 vl_conta_receita,
	0 vl_reembolso,
	0 vl_ressarcimento_sus,
	0 vl_recurso_glosa,
	0 vl_coparticipacao,
	0 vl_comissao,
	0 vl_desp_nao_assit,
	0 vl_encargo,
	0 vl_provisao,
	coalesce(a.vl_item,0) vl_total_receita,
	0 vl_custo_assitencial,
	0 vl_total_despesa,
	a.nr_seq_contrato,
	a.nr_seq_intercambio,
	a.nr_seq_grupo_intercambio,
	a.nr_seq_segurado,
	a.nr_seq_pagador,
	a.nr_seq_plano,
	a.nr_seq_faixa_etaria,
	a.ie_tipo_segurado,
	a.ie_tipo_contrato,
	a.ie_tipo_vinculo_operadora,
	a.ie_situacao_trabalhista,
	a.ie_tipo_contratacao,
	a.ie_regulamentacao,
	a.ie_preco
FROM	pls_ar_lote		b,
	pls_ar_mensalidade 	a
where	b.nr_sequencia	= a.nr_seq_lote

union all

select	trunc(b.dt_mes_competencia,'month') dt_competencia,
	0 vl_mensalidade,
	coalesce(a.vl_faturado,0) vl_faturamento,
	0 vl_taxa_intercambio,
	0 vl_conta_medica,
	0 vl_conta_receita,
	0 vl_reembolso,
	0 vl_ressarcimento_sus,
	0 vl_recurso_glosa,
	0 vl_coparticipacao,
	0 vl_comissao,
	0 vl_desp_nao_assit,
	0 vl_encargo,
	0 vl_provisao,
	coalesce(a.vl_faturado,0) vl_total_receita,
	0 vl_custo_assitencial,
	0 vl_total_despesa,
	a.nr_seq_contrato,
	a.nr_seq_intercambio,
	a.nr_seq_grupo_intercambio,
	a.nr_seq_segurado,
	a.nr_seq_pagador,
	a.nr_seq_plano,
	a.nr_seq_faixa_etaria,
	a.ie_tipo_segurado,
	a.ie_tipo_contrato,
	a.ie_tipo_vinculo_operadora,
	a.ie_situacao_trabalhista,
	a.ie_tipo_contratacao,
	a.ie_regulamentacao,
	a.ie_preco
from	pls_ar_lote		b,
	pls_ar_faturamento 	a
where	b.nr_sequencia	= a.nr_seq_lote

union all

select	trunc(b.dt_mes_competencia,'month') dt_competencia,
	0 vl_mensalidade,
	0 vl_faturamento,
	coalesce(a.vl_taxa,0) vl_taxa_intercambio,
	0 vl_conta_medica,
	0 vl_conta_receita,
	0 vl_reembolso,
	0 vl_ressarcimento_sus,
	0 vl_recurso_glosa,
	0 vl_coparticipacao,
	0 vl_comissao,
	0 vl_desp_nao_assit,
	0 vl_encargo,
	0 vl_provisao,
	coalesce(a.vl_taxa,0) vl_total_receita,
	0 vl_custo_assitencial,
	0 vl_total_despesa,
	a.nr_seq_contrato,
	a.nr_seq_intercambio,
	a.nr_seq_grupo_intercambio,
	a.nr_seq_segurado,
	a.nr_seq_pagador,
	a.nr_seq_plano,
	a.nr_seq_faixa_etaria,
	a.ie_tipo_segurado,
	a.ie_tipo_contrato,
	a.ie_tipo_vinculo_operadora,
	a.ie_situacao_trabalhista,
	a.ie_tipo_contratacao,
	a.ie_regulamentacao,
	a.ie_preco
from	pls_ar_lote		b,
	pls_ar_faturamento 	a
where	b.nr_sequencia	= a.nr_seq_lote

union all

select	trunc(b.dt_mes_competencia,'month') dt_competencia,
	0 vl_mensalidade,
	0 vl_faturamento,
	0 vl_taxa_intercambio,
	coalesce(a.vl_total,0) vl_conta_medica,
	0 vl_conta_receita,
	0 vl_reembolso,
	0 vl_ressarcimento_sus,
	0 vl_recurso_glosa,
	0 vl_coparticipacao,
	0 vl_comissao,
	0 vl_desp_nao_assit,
	0 vl_encargo,
	0 vl_provisao,
	0 vl_total_receita,
	coalesce(a.vl_total,0) vl_custo_assitencial,
	0 vl_total_despesa,
	a.nr_seq_contrato,
	a.nr_seq_intercambio,
	a.nr_seq_grupo_intercambio,
	a.nr_seq_segurado,
	a.nr_seq_pagador,
	a.nr_seq_plano,
	a.nr_seq_faixa_etaria,
	a.ie_tipo_segurado,
	a.ie_tipo_contrato,
	a.ie_tipo_vinculo_operadora,
	a.ie_situacao_trabalhista,
	a.ie_tipo_contratacao,
	a.ie_regulamentacao,
	a.ie_preco
from	pls_ar_lote		b,
	pls_ar_conta 		a
where	b.nr_sequencia	= a.nr_seq_lote
and	a.ie_tipo_valor = 'C'

union all

select	trunc(b.dt_mes_competencia,'month') dt_competencia,
	0 vl_mensalidade,
	0 vl_faturamento,
	0 vl_taxa_intercambio,
	0 vl_conta_medica,
	coalesce(a.vl_total,0) vl_conta_receita,
	0 vl_reembolso,
	0 vl_ressarcimento_sus,
	0 vl_recurso_glosa,
	0 vl_coparticipacao,
	0 vl_comissao,
	0 vl_desp_nao_assit,
	0 vl_encargo,
	0 vl_provisao,
	coalesce(a.vl_total,0) *-1 vl_total_receita,
	0 vl_custo_assitencial,
	0 vl_total_despesa,
	a.nr_seq_contrato,
	a.nr_seq_intercambio,
	a.nr_seq_grupo_intercambio,
	a.nr_seq_segurado,
	a.nr_seq_pagador,
	a.nr_seq_plano,
	a.nr_seq_faixa_etaria,
	a.ie_tipo_segurado,
	a.ie_tipo_contrato,
	a.ie_tipo_vinculo_operadora,
	a.ie_situacao_trabalhista,
	a.ie_tipo_contratacao,
	a.ie_regulamentacao,
	a.ie_preco
from	pls_ar_lote		b,
	pls_ar_conta 		a
where	b.nr_sequencia	= a.nr_seq_lote
and	a.ie_tipo_valor = 'RR'

union all

select	trunc(b.dt_mes_competencia,'month') dt_competencia,
	0 vl_mensalidade,
	0 vl_faturamento,
	0 vl_taxa_intercambio,
	0 vl_conta_medica,
	0 vl_conta_receita,
	coalesce(a.vl_total,0) vl_reembolso,
	0 vl_ressarcimento_sus,
	0 vl_recurso_glosa,
	0 vl_coparticipacao,
	0 vl_comissao,
	0 vl_desp_nao_assit,
	0 vl_encargo,
	0 vl_provisao,
	0 vl_total_receita,
	coalesce(a.vl_total,0) vl_custo_assitencial,
	0 vl_total_despesa,
	a.nr_seq_contrato,
	a.nr_seq_intercambio,
	a.nr_seq_grupo_intercambio,
	a.nr_seq_segurado,
	a.nr_seq_pagador,
	a.nr_seq_plano,
	a.nr_seq_faixa_etaria,
	a.ie_tipo_segurado,
	a.ie_tipo_contrato,
	a.ie_tipo_vinculo_operadora,
	a.ie_situacao_trabalhista,
	a.ie_tipo_contratacao,
	a.ie_regulamentacao,
	a.ie_preco
from	pls_ar_lote		b,
	pls_ar_reembolso	a
where	b.nr_sequencia	= a.nr_seq_lote

union all

select	trunc(b.dt_mes_competencia,'month') dt_competencia,
	0 vl_mensalidade,
	0 vl_faturamento,
	0 vl_taxa_intercambio,
	0 vl_conta_medica,
	0 vl_conta_receita,
	0 vl_reembolso,
	coalesce(a.vl_ressarcir,0) vl_ressarcimento_sus,
	0 vl_recurso_glosa,
	0 vl_coparticipacao,
	0 vl_comissao,
	0 vl_desp_nao_assit,
	0 vl_encargo,
	0 vl_provisao,
	0 vl_total_receita,
	coalesce(a.vl_ressarcir,0) vl_custo_assitencial,
	0 vl_total_despesa,
	a.nr_seq_contrato,
	a.nr_seq_intercambio,
	a.nr_seq_grupo_intercambio,
	a.nr_seq_segurado,
	a.nr_seq_pagador,
	a.nr_seq_plano,
	a.nr_seq_faixa_etaria,
	a.ie_tipo_segurado,
	a.ie_tipo_contrato,
	a.ie_tipo_vinculo_operadora,
	a.ie_situacao_trabalhista,
	a.ie_tipo_contratacao,
	a.ie_regulamentacao,
	a.ie_preco
from	pls_ar_lote		b,
	pls_ar_ress_sus 	a
where	b.nr_sequencia	= a.nr_seq_lote

union all

select	trunc(b.dt_mes_competencia,'month') dt_competencia,
	0 vl_mensalidade,
	0 vl_faturamento,
	0 vl_taxa_intercambio,
	0 vl_conta_medica,
	0 vl_conta_receita,
	0 vl_reembolso,
	0 vl_ressarcimento_sus,
	coalesce(vl_recurso,0) vl_recurso_glosa,
	0 vl_coparticipacao,
	0 vl_comissao,
	0 vl_desp_nao_assit,
	0 vl_encargo,
	0 vl_provisao,
	0 vl_total_receita,
	coalesce(vl_recurso,0) vl_custo_assitencial,
	0 vl_total_despesa,
	a.nr_seq_contrato,
	a.nr_seq_intercambio,
	a.nr_seq_grupo_intercambio,
	a.nr_seq_segurado,
	a.nr_seq_pagador,
	a.nr_seq_plano,
	a.nr_seq_faixa_etaria,
	a.ie_tipo_segurado,
	a.ie_tipo_contrato,
	a.ie_tipo_vinculo_operadora,
	a.ie_situacao_trabalhista,
	a.ie_tipo_contratacao,
	a.ie_regulamentacao,
	a.ie_preco
from	pls_ar_lote		b,
	pls_ar_rec_glosa 	a
where	b.nr_sequencia	= a.nr_seq_lote

union all

select	trunc(b.dt_mes_competencia,'month') dt_competencia,
	0 vl_mensalidade,
	0 vl_faturamento,
	0 vl_taxa_intercambio,
	0 vl_conta_medica,
	0 vl_conta_receita,
	0 vl_reembolso,
	0 vl_ressarcimento_sus,
	coalesce(vl_contestacao,0) vl_recurso_glosa, --O valor de contestacao deve ser apresentado como recurso de glosa
	0 vl_coparticipacao,
	0 vl_comissao,
	0 vl_desp_nao_assit,
	0 vl_encargo,
	0 vl_provisao,
	0 vl_total_receita,
	coalesce(vl_contestacao,0) vl_custo_assitencial,
	0 vl_total_despesa,
	a.nr_seq_contrato,
	a.nr_seq_intercambio,
	a.nr_seq_grupo_intercambio,
	a.nr_seq_segurado,
	a.nr_seq_pagador,
	a.nr_seq_plano,
	a.nr_seq_faixa_etaria,
	a.ie_tipo_segurado,
	a.ie_tipo_contrato,
	a.ie_tipo_vinculo_operadora,
	a.ie_situacao_trabalhista,
	a.ie_tipo_contratacao,
	a.ie_regulamentacao,
	a.ie_preco
from	pls_ar_lote		b,
	pls_ar_contestacao 	a
where	b.nr_sequencia	= a.nr_seq_lote

union all

select	trunc(b.dt_mes_competencia,'month') dt_competencia,
	0 vl_mensalidade,
	0 vl_faturamento,
	0 vl_taxa_intercambio,
	0 vl_conta_medica,
	0 vl_conta_receita,
	0 vl_reembolso,
	0 vl_ressarcimento_sus,
	0 vl_recurso_glosa,
	coalesce(a.vl_coparticipacao,0) vl_coparticipacao,
	0 vl_comissao,
	0 vl_desp_nao_assit,
	0 vl_encargo,
	0 vl_provisao,
	0 vl_total_receita,
	coalesce(a.vl_coparticipacao,0)*-1 vl_custo_assitencial, --O valor do reembolso reduz o custo
	0 vl_total_despesa,
	a.nr_seq_contrato,
	a.nr_seq_intercambio,
	a.nr_seq_grupo_intercambio,
	a.nr_seq_segurado,
	a.nr_seq_pagador,
	a.nr_seq_plano,
	a.nr_seq_faixa_etaria,
	a.ie_tipo_segurado,
	a.ie_tipo_contrato,
	a.ie_tipo_vinculo_operadora,
	a.ie_situacao_trabalhista,
	a.ie_tipo_contratacao,
	a.ie_regulamentacao,
	a.ie_preco
from	pls_ar_lote		b,
	pls_ar_coparticipacao	a
where	b.nr_sequencia	= a.nr_seq_lote

union all

select	trunc(b.dt_mes_competencia,'month') dt_competencia,
	0 vl_mensalidade,
	0 vl_faturamento,
	0 vl_taxa_intercambio,
	0 vl_conta_medica,
	0 vl_conta_receita,
	0 vl_reembolso,
	0 vl_ressarcimento_sus,
	0 vl_recurso_glosa,
	0 vl_coparticipacao,
	coalesce(a.vl_comissao,0) vl_comissao,
	0 vl_desp_nao_assit,
	0 vl_encargo,
	0 vl_provisao,
	0 vl_total_receita,
	0 vl_custo_assitencial,
	coalesce(a.vl_comissao,0) vl_total_despesa,
	a.nr_seq_contrato,
	a.nr_seq_intercambio,
	a.nr_seq_grupo_intercambio,
	a.nr_seq_segurado,
	a.nr_seq_pagador,
	a.nr_seq_plano,
	a.nr_seq_faixa_etaria,
	a.ie_tipo_segurado,
	a.ie_tipo_contrato,
	a.ie_tipo_vinculo_operadora,
	a.ie_situacao_trabalhista,
	a.ie_tipo_contratacao,
	a.ie_regulamentacao,
	a.ie_preco
from	pls_ar_lote		b,
	pls_ar_comissao 	a
where	b.nr_sequencia	= a.nr_seq_lote

union all

select	trunc(b.dt_mes_competencia,'month') dt_competencia,
	0 vl_mensalidade,
	0 vl_faturamento,
	0 vl_taxa_intercambio,
	0 vl_conta_medica,
	0 vl_conta_receita,
	0 vl_reembolso,
	0 vl_ressarcimento_sus,
	0 vl_recurso_glosa,
	0 vl_coparticipacao,
	0 vl_comissao,
	CASE WHEN a.ie_tipo_despesa='1' THEN coalesce(a.vl_despesa,0)  ELSE 0 END  vl_desp_nao_assit,
	CASE WHEN a.ie_tipo_despesa='2' THEN coalesce(a.vl_despesa,0)  ELSE 0 END  vl_encargo,
	CASE WHEN a.ie_tipo_despesa='3' THEN coalesce(a.vl_despesa,0)  ELSE 0 END  vl_provisao,
	0 vl_total_receita,
	0 vl_custo_assitencial,
	coalesce(a.vl_despesa,0) vl_total_despesa,
	a.nr_seq_contrato,
	a.nr_seq_intercambio,
	a.nr_seq_grupo_intercambio,
	a.nr_seq_segurado,
	a.nr_seq_pagador,
	a.nr_seq_plano,
	a.nr_seq_faixa_etaria,
	a.ie_tipo_segurado,
	a.ie_tipo_contrato,
	a.ie_tipo_vinculo_operadora,
	a.ie_situacao_trabalhista,
	a.ie_tipo_contratacao,
	a.ie_regulamentacao,
	a.ie_preco
from	pls_ar_lote		b,
	pls_ar_despesa_contabil	a
where	b.nr_sequencia	= a.nr_seq_lote;

