-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW interf_unimed_londrina_v2 (tp_registro, cd_tipo_registro, dt_periodo_inicial, dt_periodo_final, ie_tipo_transmissao, cd_cgc_convenio, ds_convenio, ie_tipo_prestador, cd_cgc_prestador, nm_prestador, dt_geracao, cd_cnes, nr_seq_protocolo, tp_logradouro, nm_logradouro, nr_endereco_prest, ds_compl_prestador, ds_municipio, cd_municipio_ibge, uf_prestador, nr_cep_executante, nr_doc_guia, ie_tipo_atendimento, cd_usuario_convenio, dt_internacao, dt_alta, nr_cpf_medico_resp, ie_corte_prontuario, tp_saida_sadt, ie_infeccao_hosp, tp_nascimento, ie_conta_auditada, registro_auditor, cd_reg_ans, dt_emissao_guia, nr_carteira_benefic, nm_paciente, ds_plano, dt_validade_carteira, nr_cartao_nac_saude, ie_carater_inter, tp_acomodacao, tp_internacao, id_int_obstetricia_1, id_int_obstetricia_2, id_int_obstetricia_3, id_int_obstetricia_4, id_int_obstetricia_5, id_int_obstetricia_6, id_int_obstetricia_7, id_int_obstetricia_8, id_int_obstetricia_9, nr_decl_nasc_vivos, qt_nasc_vivos_termo, qt_nasc_morto, qt_nasc_vivo_prematuro, cd_obito_mulher, qt_obito_neo_precoce, qt_obito_neo_tardio, ie_regime_inter, qt_diarias_solicitadas, qt_diarias_autorizadas, dt_admissao_hosp, nm_profissional_solic, cd_conselho_regional, nr_conselho_profissional, uf_conselho, cd_prof_operadora, nr_documento, cd_cid_principal, tp_cid, ie_indicacao_acidente, nr_declaracao_obito, cd_glosa, cd_matmed_prestador, cd_servico_pago, ie_local_utilizacao, cd_servico_exec, ds_servico, ie_tipo_pagamento, ie_local_procedimento, dt_realizacao, cd_posicao, qt_executada, vl_honorario, tx_procedimento, ie_situacao_servico, cd_cgc_cpf_prestador, hr_minuto_exec_serv, ie_mesma_via, ie_outra_cirurgia, cd_tipo_serv_exec, cd_tipo_serv_pago, cd_cgc_cpf_prest_custo, cd_cgc_cpf_prest_filme, vl_total_item_custo, vl_total_item_filme, dt_realizacao_paga, hr_minutos_pagos, qt_mat_med, ie_tecnica_utilizada, cd_barra_opm, nm_profissional_exec, nr_conta, qt_itens_conta, vl_total_conta, vl_total_proced, vl_total_diarias, vl_total_taxas, vl_total_materiais, vl_total_medicamentos, vl_total_gases, qt_contas_protocolo, vl_total_protocolo, filler_n, filler_z, ie_ordem_mat_proc, ie_emite_conta, nr_seq_item) AS select 	/* CABEÇALHO GERAL */
	1 				tp_registro, 
	1				cd_tipo_registro, 
	LOCALTIMESTAMP				dt_periodo_inicial, 
	LOCALTIMESTAMP				dt_periodo_final, 
	1				ie_tipo_transmissao, 
	somente_numero(h.cd_cgc_convenio) cd_cgc_convenio, 
	substr(h.nm_convenio,1,30)	ds_convenio, 
	'J'				ie_tipo_prestador, 
	somente_numero(h.cd_cgc_hospital) cd_cgc_prestador, 
	substr(h.nm_hospital,1,40)	nm_prestador, 
	LOCALTIMESTAMP				dt_geracao, 
	substr(obter_dados_pf_pj(null,h.cd_cgc_hospital,'CNES'),1,7) 
					cd_cnes, 
	h.nr_seq_protocolo		nr_seq_protocolo, 
	' '				tp_logradouro, 
	' '				nm_logradouro, 
	' '				nr_endereco_prest, 
	' '				ds_compl_prestador, 
	' '				ds_municipio, 
	' '				cd_municipio_ibge, 
	' '				uf_prestador, 
	' '				nr_cep_executante, 
	0				nr_doc_guia, 
	0				ie_tipo_atendimento, 
	' ' 				cd_usuario_convenio, 
	LOCALTIMESTAMP				dt_internacao, 
	LOCALTIMESTAMP				dt_alta, 
	' '				nr_cpf_medico_resp, 
	'N'				ie_corte_prontuario, 
	' '				tp_saida_sadt, 
	'N'				ie_infeccao_hosp, 
	' '				tp_nascimento, 
	' '				ie_conta_auditada, 
	' '				registro_auditor, 
	' '				cd_reg_ans, 
	LOCALTIMESTAMP				dt_emissao_guia, 
	' '				nr_carteira_benefic, 
	' '				nm_paciente, 
	' '				ds_plano, 
	LOCALTIMESTAMP				dt_validade_carteira, 
	' '				nr_cartao_nac_saude, 
	' '				ie_carater_inter, 
	0				tp_acomodacao, 
	0				tp_internacao, 
	' '				ID_INT_OBSTETRICIA_1, 
	' '				ID_INT_OBSTETRICIA_2, 
	' ' 				ID_INT_OBSTETRICIA_3, 
	' ' 				ID_INT_OBSTETRICIA_4, 
	' '				ID_INT_OBSTETRICIA_5, 
	' ' 				ID_INT_OBSTETRICIA_6, 
	' ' 				ID_INT_OBSTETRICIA_7, 
	' ' 				ID_INT_OBSTETRICIA_8, 
	' ' 				ID_INT_OBSTETRICIA_9, 
	' '				nr_decl_nasc_vivos, 
	'0'				qt_nasc_vivos_termo, 
	'0'				qt_nasc_morto, 
	'0'				qt_nasc_vivo_prematuro, 
	0				cd_obito_mulher, 
	'0'				qt_obito_neo_precoce, 
	'0'				qt_obito_neo_tardio, 
	0				ie_regime_inter, 
	'0'				qt_diarias_solicitadas, 
	'0'				qt_diarias_autorizadas, 
	LOCALTIMESTAMP				dt_admissao_hosp, 
	' '				nm_profissional_solic, 
	'CRM'				cd_conselho_regional, 
	' '				nr_conselho_profissional, 
	' '				uf_conselho, 
	' '				cd_prof_operadora, 
	0				nr_documento, 
	' '				cd_cid_principal, 
	'P'				tp_cid, 
	0				ie_indicacao_acidente, 
	0				nr_declaracao_obito, 
	0				cd_glosa, 
	0				cd_matmed_prestador, 
	' '				cd_servico_pago, 
	'C'				ie_local_utilizacao, 
	' '				cd_servico_exec, 
	' '				ds_servico, 
	' '				ie_tipo_pagamento, 
	' '				ie_local_procedimento, 
	LOCALTIMESTAMP				dt_realizacao, 
	0				cd_posicao, 
	'0'				qt_executada, 
	0				vl_honorario, 
	0				tx_procedimento, 
	' '				ie_situacao_servico, 
	0				cd_cgc_cpf_prestador, 
	LOCALTIMESTAMP				hr_minuto_exec_serv, 
	' '				ie_mesma_via, 
	'N'				ie_outra_cirurgia, 
	' '				cd_tipo_serv_exec, 
	' '				cd_tipo_serv_pago, 
	0				cd_cgc_cpf_prest_custo, 
	0				cd_cgc_cpf_prest_filme, 
	0				vl_total_item_custo, 
	0				vl_total_item_filme, 
	LOCALTIMESTAMP				dt_realizacao_paga, 
	LOCALTIMESTAMP				hr_minutos_pagos, 
	'0'				qt_mat_med, 
	' '				ie_tecnica_utilizada, 
	' ' 				cd_barra_opm, 
	' '				nm_profissional_exec, 
	0				nr_conta, 
	'0'				qt_itens_conta, 
	0				vl_total_conta, 
	0				vl_total_proced, 
	0				vl_total_diarias, 
	0				vl_total_taxas, 
	0				vl_total_materiais, 
	0				vl_total_medicamentos, 
	0				vl_total_gases, 
	'0'				qt_contas_protocolo, 
	0				vl_total_protocolo, 
	rpad(0,300,0)			FILLER_N, 
	0				FILLER_Z, 
	'0'				IE_ORDEM_MAT_PROC, 
	'0'				ie_emite_conta, 
	0				nr_seq_item				 
FROM 	w_interf_conta_header 	h 

union
 
select /* CABEÇALHO DA CONTA */
 
	2				tp_registro, 
	2				cd_tipo_registro, 
	c.dt_periodo_inicial		dt_periodo_inicial, 
	c.dt_periodo_final		dt_periodo_final, 
	1				ie_tipo_transmissao, 
	0				cd_cgc_convenio, 
	''				ds_convenio, 
	''				ie_tipo_prestador, 
	0				cd_cgc_prestador, 
	''				nm_prestador, 
	LOCALTIMESTAMP				dt_geracao, 
	''				cd_cnes, 
	c.nr_seq_protocolo		nr_seq_protocolo, 
	' '				tp_logradouro, 
	' '				nm_logradouro, 
	' '				nr_endereco_prest, 
	' '				ds_compl_prestador, 
	' '				ds_municipio, 
	' '				cd_municipio_ibge, 
	' '				uf_prestador, 
	' '				nr_cep_executante, 
	somente_numero(substr(c.nr_doc_convenio,1,8)) 
					nr_doc_guia, 
	somente_numero(substr(obter_tipo_atend_tiss(c.nr_atendimento, c.nr_interno_conta),1,2)) 
					ie_tipo_atendimento, 
	substr(c.cd_usuario_convenio,1,18) cd_usuario_convenio, 
	c.dt_entrada			dt_internacao, 
	c.dt_alta			dt_alta, 
	c.nr_cpf_medico_resp		nr_cpf_medico_resp, 
	CASE WHEN c.ie_tipo_atendimento=1 THEN  substr(Obter_Corte_Prontuario(c.cd_cgc_convenio, c.dt_entrada, coalesce(c.dt_alta, LOCALTIMESTAMP)),1,1)  ELSE 'N' END  
					ie_corte_prontuario, 
	CASE WHEN c.cd_motivo_alta=5 THEN '12' WHEN c.cd_motivo_alta=7 THEN '40' WHEN c.cd_motivo_alta=1 THEN '14'  ELSE lpad(substr(c.cd_motivo_alta,2,2),2,'0') END  
					tp_saida_sadt, 
	'N'				ie_infeccao_hosp, 
	c.ie_tipo_nascimento		tp_nascimento, 
	' '				ie_conta_auditada, 
	' '				registro_auditor, 
	substr(obter_dados_pf_pj(null,c.cd_cgc_convenio,'ANS'),1,6) cd_reg_ans, 
	c.dt_entrada			dt_emissao_guia, 
	' '				nr_carteira_benefic, 
	substr(c.nm_paciente,1,70)	nm_paciente, 
	substr(obter_desc_plano(c.cd_convenio, c.cd_plano_convenio),1,40) 
					ds_plano, 
	c.dt_validade_carteira		dt_validade_carteira, 
	' '				nr_cartao_nac_saude, 
	coalesce(substr(c.ie_carater_inter,1,1),'E') ie_carater_inter, 
	c.cd_tipo_acomodacao		tp_acomodacao, 
	CASE WHEN c.ie_tipo_protocolo=30 THEN 1 WHEN c.ie_tipo_protocolo=31 THEN 2  ELSE 0 END  tp_internacao, 
	coalesce(substr(obter_dados_int_obstetrica(c.nr_atendimento,'1'),1,1),'N') ID_INT_OBSTETRICIA_1, 
	coalesce(substr(obter_dados_int_obstetrica(c.nr_atendimento,'2'),1,1),'N') ID_INT_OBSTETRICIA_2, 
	coalesce(substr(obter_dados_int_obstetrica(c.nr_atendimento,'3'),1,1),'N') ID_INT_OBSTETRICIA_3, 
	coalesce(substr(obter_dados_int_obstetrica(c.nr_atendimento,'4'),1,1),'N') ID_INT_OBSTETRICIA_4, 
	coalesce(substr(obter_dados_int_obstetrica(c.nr_atendimento,'5'),1,1),'N') ID_INT_OBSTETRICIA_5, 
	coalesce(substr(obter_dados_int_obstetrica(c.nr_atendimento,'6'),1,1),'N') ID_INT_OBSTETRICIA_6, 
	coalesce(substr(obter_dados_int_obstetrica(c.nr_atendimento,'7'),1,1),'N') ID_INT_OBSTETRICIA_7, 
	coalesce(substr(obter_dados_int_obstetrica(c.nr_atendimento,'8'),1,1),'N') ID_INT_OBSTETRICIA_8, 
	coalesce(substr(obter_dados_int_obstetrica(c.nr_atendimento,'9'),1,1),'N') ID_INT_OBSTETRICIA_9, 
	substr(OBTER_DNV_NASCIMENTO(c.nr_atendimento),1,15) 
					nr_decl_nasc_vivos, 
	'0'				qt_nasc_vivos_termo, 
	'0'				qt_nasc_morto, 
	'0'				qt_nasc_vivo_prematuro, 
	0				cd_obito_mulher, 
	'0'				qt_obito_neo_precoce, 
	'0'				qt_obito_neo_tardio, 
	CASE WHEN c.ie_tipo_atendimento=1 THEN 1  ELSE 0 END  ie_regime_inter, 
	CASE WHEN c.ie_tipo_atendimento=1 THEN '1'  ELSE '0' END  qt_diarias_solicitadas, 
	CASE WHEN c.ie_tipo_atendimento=1 THEN '1'  ELSE '0' END  qt_diarias_autorizadas, 
	c.dt_entrada			dt_admissao_hosp, 
	substr(c.nm_medico_resp,1,70)	nm_profissional_solic, 
	'CRM'				cd_conselho_regional, 
	substr(c.nr_crm_medico_resp,1,15) nr_conselho_profissional, 
	c.uf_crm_medico_resp		uf_conselho, 
	' '				cd_prof_operadora, 
	0				nr_documento, 
	' '				cd_cid_principal, 
	'P'				tp_cid, 
	0				ie_indicacao_acidente, 
	0				nr_declaracao_obito, 
	0				cd_glosa, 
	0				cd_matmed_prestador, 
	' '				cd_servico_pago, 
	'C'				ie_local_utilizacao, 
	' '				cd_servico_exec, 
	' '				ds_servico, 
	' '				ie_tipo_pagamento, 
	' '				ie_local_procedimento, 
	LOCALTIMESTAMP				dt_realizacao, 
	0				cd_posicao, 
	'0'				qt_executada, 
	0				vl_honorario, 
	0				tx_procedimento, 
	' '				ie_situacao_servico, 
	0				cd_cgc_cpf_prestador, 
	LOCALTIMESTAMP				hr_minuto_exec_serv, 
	' '				ie_mesma_via, 
	'N'				ie_outra_cirurgia, 
	' '				cd_tipo_serv_exec, 
	' '				cd_tipo_serv_pago, 
	0				cd_cgc_cpf_prest_custo, 
	0				cd_cgc_cpf_prest_filme, 
	0				vl_total_item_custo, 
	0				vl_total_item_filme, 
	LOCALTIMESTAMP				dt_realizacao_paga, 
	LOCALTIMESTAMP				hr_minutos_pagos, 
	'0'				qt_mat_med, 
	' '				ie_tecnica_utilizada, 
	' ' 				cd_barra_opm, 
	' '				nm_profissional_exec, 
	c.nr_interno_conta		nr_conta, 
	'0'				qt_itens_conta, 
	0				vl_total_conta, 
	0				vl_total_proced, 
	0				vl_total_diarias, 
	0				vl_total_taxas, 
	0				vl_total_materiais, 
	0				vl_total_medicamentos, 
	0				vl_total_gases, 
	'0'				qt_contas_protocolo, 
	0				vl_total_protocolo, 
	'0'				FILLER_N, 
	0				FILLER_Z, 
	'0'				IE_ORDEM_MAT_PROC, 
	'0'				ie_emite_conta, 
	0				nr_seq_item 
from 	w_interf_conta_cab 	c 

union
 
select	/* GUIA X CID */
 
	3 				tp_registro, 
	3				cd_tipo_registro, 
	LOCALTIMESTAMP				dt_periodo_inicial, 
	LOCALTIMESTAMP				dt_periodo_final, 
	1				ie_tipo_transmissao, 
	0 				cd_cgc_convenio, 
	' '				ds_convenio, 
	'J'				ie_tipo_prestador, 
	0 				cd_cgc_prestador, 
	' '				nm_prestador, 
	LOCALTIMESTAMP				dt_geracao, 
	' '				cd_cnes, 
	c.nr_seq_protocolo		nr_seq_protocolo, 
	' '				tp_logradouro, 
	' '				nm_logradouro, 
	' '				nr_endereco_prest, 
	' '				ds_compl_prestador, 
	' '				ds_municipio, 
	' '				cd_municipio_ibge, 
	' '				uf_prestador, 
	' '				nr_cep_executante, 
	0				nr_doc_guia, 
	0				ie_tipo_atendimento, 
	' ' 				cd_usuario_convenio, 
	LOCALTIMESTAMP				dt_internacao, 
	LOCALTIMESTAMP				dt_alta, 
	' '				nr_cpf_medico_resp, 
	'N'				ie_corte_prontuario, 
	' '				tp_saida_sadt, 
	'N'				ie_infeccao_hosp, 
	' '				tp_nascimento, 
	' '				ie_conta_auditada, 
	' '				registro_auditor, 
	' '				cd_reg_ans, 
	LOCALTIMESTAMP				dt_emissao_guia, 
	' '				nr_carteira_benefic, 
	' '				nm_paciente, 
	' '				ds_plano, 
	LOCALTIMESTAMP				dt_validade_carteira, 
	' '				nr_cartao_nac_saude, 
	' '				ie_carater_inter, 
	0				tp_acomodacao, 
	0				tp_internacao, 
	' '				ID_INT_OBSTETRICIA_1, 
	' '				ID_INT_OBSTETRICIA_2, 
	' ' 				ID_INT_OBSTETRICIA_3, 
	' ' 				ID_INT_OBSTETRICIA_4, 
	' '				ID_INT_OBSTETRICIA_5, 
	' ' 				ID_INT_OBSTETRICIA_6, 
	' ' 				ID_INT_OBSTETRICIA_7, 
	' ' 				ID_INT_OBSTETRICIA_8, 
	' ' 				ID_INT_OBSTETRICIA_9, 
	' '				nr_decl_nasc_vivos, 
	'0'				qt_nasc_vivos_termo, 
	'0'				qt_nasc_morto, 
	'0'				qt_nasc_vivo_prematuro, 
	0				cd_obito_mulher, 
	'0'				qt_obito_neo_precoce, 
	'0'				qt_obito_neo_tardio, 
	0				ie_regime_inter, 
	'0'				qt_diarias_solicitadas, 
	'0'				qt_diarias_autorizadas, 
	LOCALTIMESTAMP				dt_admissao_hosp, 
	' '				nm_profissional_solic, 
	'CRM'				cd_conselho_regional, 
	' '				nr_conselho_profissional, 
	' '				uf_conselho, 
	' '				cd_prof_operadora, 
	somente_numero(substr(c.nr_doc_convenio,1,8)) 
					nr_documento, 
	substr(c.cd_cid_principal,1,6)	cd_cid_principal, 
	CASE WHEN Obter_cd_Motivo_Alta_Atend(c.nr_atendimento)=141 THEN 'O' WHEN Obter_cd_Motivo_Alta_Atend(c.nr_atendimento)=140 THEN 'O'  ELSE 'P' END  tp_cid, 
	--'P'				tp_cid, 
	OBTER_ACIDENTE_TISS_ATEND(c.nr_atendimento) 
					ie_indicacao_acidente, 
	somente_numero(Obter_Declaracao_Obito(c.nr_atendimento)) nr_declaracao_obito, 
	0				cd_glosa, 
	0				cd_matmed_prestador, 
	' '				cd_servico_pago, 
	'C'				ie_local_utilizacao, 
	' '				cd_servico_exec, 
	' '				ds_servico, 
	' '				ie_tipo_pagamento, 
	' '				ie_local_procedimento, 
	LOCALTIMESTAMP				dt_realizacao, 
	0				cd_posicao, 
	'0'				qt_executada, 
	0				vl_honorario, 
	0				tx_procedimento, 
	' '				ie_situacao_servico, 
	0				cd_cgc_cpf_prestador, 
	LOCALTIMESTAMP				hr_minuto_exec_serv, 
	' '				ie_mesma_via, 
	'N'				ie_outra_cirurgia, 
	' '				cd_tipo_serv_exec, 
	' '				cd_tipo_serv_pago, 
	0				cd_cgc_cpf_prest_custo, 
	0				cd_cgc_cpf_prest_filme, 
	0				vl_total_item_custo, 
	0				vl_total_item_filme, 
	LOCALTIMESTAMP				dt_realizacao_paga, 
	LOCALTIMESTAMP				hr_minutos_pagos, 
	'0'				qt_mat_med, 
	' '				ie_tecnica_utilizada, 
	' ' 				cd_barra_opm, 
	' '				nm_profissional_exec, 
	c.nr_interno_conta		nr_conta, 
	'0'				qt_itens_conta, 
	0				vl_total_conta, 
	0				vl_total_proced, 
	0				vl_total_diarias, 
	0				vl_total_taxas, 
	0				vl_total_materiais, 
	0				vl_total_medicamentos, 
	0				vl_total_gases, 
	'0'				qt_contas_protocolo, 
	0				vl_total_protocolo, 
	rpad(0,430,0)			FILLER_N, 
	0				FILLER_Z, 
	'0'				IE_ORDEM_MAT_PROC, 
	'0'				ie_emite_conta, 
	0				nr_seq_item 
from 	w_interf_conta_cab 	c 

union
 
select	/* ITENS DA CONTA */
 
	4 				tp_registro, 
	4				cd_tipo_registro, 
	LOCALTIMESTAMP				dt_periodo_inicial, 
	LOCALTIMESTAMP				dt_periodo_final, 
	1				ie_tipo_transmissao, 
	0				cd_cgc_convenio, 
	' '				ds_convenio, 
	'J'				ie_tipo_prestador, 
	0				cd_cgc_prestador, 
	' '				nm_prestador, 
	LOCALTIMESTAMP				dt_geracao, 
	' '				cd_cnes, 
	c.nr_seq_protocolo		nr_seq_protocolo, 
	' '				tp_logradouro, 
	' '				nm_logradouro, 
	' '				nr_endereco_prest, 
	' '				ds_compl_prestador, 
	' '				ds_municipio, 
	' '				cd_municipio_ibge, 
	' '				uf_prestador, 
	' '				nr_cep_executante, 
	0				nr_doc_guia, 
	0				ie_tipo_atendimento, 
	' ' 				cd_usuario_convenio, 
	LOCALTIMESTAMP				dt_internacao, 
	LOCALTIMESTAMP				dt_alta, 
	' '				nr_cpf_medico_resp, 
	'N'				ie_corte_prontuario, 
	' '				tp_saida_sadt, 
	'N'				ie_infeccao_hosp, 
	' '				tp_nascimento, 
	' '				ie_conta_auditada, 
	' '				registro_auditor, 
	' '				cd_reg_ans, 
	LOCALTIMESTAMP				dt_emissao_guia, 
	' '				nr_carteira_benefic, 
	' '				nm_paciente, 
	' '				ds_plano, 
	LOCALTIMESTAMP				dt_validade_carteira, 
	' '				nr_cartao_nac_saude, 
	' '				ie_carater_inter, 
	0				tp_acomodacao, 
	0				tp_internacao, 
	' '				ID_INT_OBSTETRICIA_1, 
	' '				ID_INT_OBSTETRICIA_2, 
	' ' 				ID_INT_OBSTETRICIA_3, 
	' ' 				ID_INT_OBSTETRICIA_4, 
	' '				ID_INT_OBSTETRICIA_5, 
	' ' 				ID_INT_OBSTETRICIA_6, 
	' ' 				ID_INT_OBSTETRICIA_7, 
	' ' 				ID_INT_OBSTETRICIA_8, 
	' ' 				ID_INT_OBSTETRICIA_9, 
	' '				nr_decl_nasc_vivos, 
	'0'				qt_nasc_vivos_termo, 
	'0'				qt_nasc_morto, 
	'0'				qt_nasc_vivo_prematuro, 
	0				cd_obito_mulher, 
	'0'				qt_obito_neo_precoce, 
	'0'				qt_obito_neo_tardio, 
	0				ie_regime_inter, 
	'0'				qt_diarias_solicitadas, 
	'0'				qt_diarias_autorizadas, 
	LOCALTIMESTAMP				dt_admissao_hosp, 
	' '				nm_profissional_solic,	 
	CASE WHEN i.CD_ITEM=40601110 THEN 'CRM'  ELSE CASE WHEN obter_se_medico_conveniado(Obter_estab_atend(c.nr_atendimento),i.cd_medico_executor, 	c.cd_convenio, null, null,null,null,null,null, null, null)='N' THEN 'CRM'  ELSE '  ' END  END  cd_conselho_regional,	 
	CASE WHEN i.CD_ITEM=40601110 THEN substr(i.nr_crm_executor,1,15)  ELSE CASE WHEN obter_se_medico_conveniado(Obter_estab_atend(c.nr_atendimento),i.cd_medico_executor, 	c.cd_convenio, null, null,null,null,null,null, null, null)='N' THEN substr(i.nr_crm_executor,1,15)  ELSE ' ' END  END 	nr_conselho_profissional,	 
	CASE WHEN i.CD_ITEM=40601110 THEN i.uf_crm_executor  ELSE CASE WHEN obter_se_medico_conveniado(Obter_estab_atend(c.nr_atendimento),i.cd_medico_executor, 	c.cd_convenio, null, null,null,null,null,null, null, null)='N' THEN i.uf_crm_executor  ELSE ' ' END  END 		uf_conselho, 
	' '				cd_prof_operadora, 
	somente_numero(substr(c.nr_doc_convenio,1,8)) nr_documento, 
	' '				cd_cid_principal, 
	'P'				tp_cid, 
	0				ie_indicacao_acidente, 
	0				nr_declaracao_obito,	 
	0				cd_glosa, 
	0				cd_matmed_prestador, 
	substr(i.cd_item_convenio,1,8)	cd_servico_pago, 
	CASE WHEN i.CD_SETOR_ATENDIMENTO=15 THEN 'C'  ELSE 'S' END 				ie_local_utilizacao, 
	substr(i.cd_item_convenio,1,8)	cd_servico_exec, 
	substr(i.ds_item,1,50)		ds_servico, 
	'P' ie_tipo_pagamento, 
	CASE WHEN c.ie_tipo_atendimento=1 THEN 'I'  ELSE 'A' END  ie_local_procedimento, 
	i.dt_item			dt_realizacao, 
	CASE WHEN i.cd_funcao_executor=5 THEN 5 WHEN i.cd_funcao_executor=8 THEN 5 WHEN i.cd_funcao_executor=2 THEN 0 WHEN i.cd_funcao_executor=15 THEN 1 WHEN i.cd_funcao_executor=11 THEN 4 WHEN i.cd_funcao_executor=4 THEN 2 WHEN i.cd_funcao_executor=9 THEN 3 WHEN i.cd_funcao_executor=1 THEN 0  ELSE 8 END 		cd_posicao, 
	replace(replace(Campo_Mascara_virgula(i.qt_item),'.',''),',','.') qt_executada, 
	CASE WHEN i.ie_tipo_item=1 THEN i.vl_honorario  ELSE 0 END 			vl_honorario, 
	i.pr_faturado			tx_procedimento, 
	CASE WHEN i.ie_emite_conta='74' THEN 'T' WHEN i.ie_emite_conta='122' THEN 'L'  ELSE 'C' END  ie_situacao_servico, 
	somente_numero(CASE WHEN i.ie_tipo_item=1 THEN  i.cd_cgc_cpf_resp_cred  ELSE i.cd_cgc_prestador END )		cd_cgc_cpf_prestador, 
	i.dt_item			hr_minuto_exec_serv, 
	' '				ie_mesma_via, 
	'N'				ie_outra_cirurgia, 
	coalesce(Obter_Conversao_Externa(null,'INTERF_UNIMED_LONDRINA_V2','CD_TIPO_SERV_EXEC',ie_emite_conta),'HOS') cd_tipo_serv_exec,	 
	coalesce(Obter_Conversao_Externa(null,'INTERF_UNIMED_LONDRINA_V2','CD_TIPO_SERV_EXEC',ie_emite_conta),'HOS') cd_tipo_serv_pago, 
	CASE WHEN coalesce(vl_custo_oper,0)=0 THEN 0  ELSE i.cd_cgc_prestador END 		cd_cgc_cpf_prest_custo, 
	CASE WHEN coalesce(vl_filme,0)=0 THEN 0  ELSE somente_numero(i.cd_cgc_prestador) END 		cd_cgc_cpf_prest_filme, 
	i.vl_custo_oper			vl_total_item_custo, 
	i.vl_filme			vl_total_item_filme, 
	i.dt_item			dt_realizacao_paga, 
	i.dt_item			hr_minutos_pagos, 
	replace(replace(Campo_Mascara_virgula(i.qt_item),'.',''),',','.') qt_mat_med, 
	CASE WHEN i.CD_ITEM=40601110 THEN substr(obter_tecnica_utilizada_tiss(i.nr_seq_item),1,1)  ELSE CASE WHEN obter_se_medico_conveniado(Obter_estab_atend(c.nr_atendimento),i.cd_medico_executor, 	c.cd_convenio, null, null,null,null,null,null, null, null)='N' THEN substr(obter_tecnica_utilizada_tiss(i.nr_seq_item),1,1)  ELSE ' ' END  END 	ie_tecnica_utilizada,	' ' 				cd_barra_opm, 
	CASE WHEN i.CD_ITEM=40601110 THEN substr(i.nm_medico_executor,1,70)  ELSE CASE WHEN obter_se_medico_conveniado(Obter_estab_atend(c.nr_atendimento),i.cd_medico_executor, 	c.cd_convenio, null, null,null,null,null,null, null, null)='N' THEN substr(i.nm_medico_executor,1,70)  ELSE ' ' END  END  nm_profissional_exec, 
	c.nr_interno_conta		nr_conta, 
	'0'				qt_itens_conta, 
	0				vl_total_conta, 
	0				vl_total_proced, 
	0				vl_total_diarias, 
	0				vl_total_taxas, 
	0				vl_total_materiais, 
	0				vl_total_medicamentos, 
	0				vl_total_gases, 
	'0'				qt_contas_protocolo, 
	0				vl_total_protocolo, 
	rpad(0,318,0)			FILLER_N, 
	0				FILLER_Z, 
	substr(Obter_Desc_Estrut_Conta(somente_numero(i.ie_emite_conta)),1,80) ie_ordem_mat_proc, 
	i.ie_emite_conta, 
	i.nr_seq_item 
from 	w_interf_conta_cab	c, 
	w_interf_conta_item	i 
where 	c.nr_interno_conta = i.nr_interno_conta 

union
 
select 	/* TOTAL DA CONTA */
 
	5 				tp_registro, 
	5				cd_tipo_registro, 
	LOCALTIMESTAMP				dt_periodo_inicial, 
	LOCALTIMESTAMP				dt_periodo_final, 
	1				ie_tipo_transmissao, 
	0				cd_cgc_convenio, 
	' '				ds_convenio, 
	'J'				ie_tipo_prestador, 
	0				cd_cgc_prestador, 
	' '				nm_prestador, 
	LOCALTIMESTAMP				dt_geracao, 
	' '				cd_cnes, 
	t.nr_seq_protocolo		nr_seq_protocolo, 
	' '				tp_logradouro, 
	' '				nm_logradouro, 
	' '				nr_endereco_prest, 
	' '				ds_compl_prestador, 
	' '				ds_municipio, 
	' '				cd_municipio_ibge, 
	' '				uf_prestador, 
	' '				nr_cep_executante, 
	0				nr_doc_guia, 
	0				ie_tipo_atendimento, 
	' ' 				cd_usuario_convenio, 
	LOCALTIMESTAMP				dt_internacao, 
	LOCALTIMESTAMP				dt_alta, 
	' '				nr_cpf_medico_resp, 
	'N'				ie_corte_prontuario, 
	' '				tp_saida_sadt, 
	'N'				ie_infeccao_hosp, 
	' '				tp_nascimento, 
	' '				ie_conta_auditada, 
	' '				registro_auditor, 
	' '				cd_reg_ans, 
	LOCALTIMESTAMP				dt_emissao_guia, 
	' '				nr_carteira_benefic, 
	' '				nm_paciente, 
	' '				ds_plano, 
	LOCALTIMESTAMP				dt_validade_carteira, 
	' '				nr_cartao_nac_saude, 
	' '				ie_carater_inter, 
	0				tp_acomodacao, 
	0				tp_internacao, 
	' '				ID_INT_OBSTETRICIA_1, 
	' '				ID_INT_OBSTETRICIA_2, 
	' ' 				ID_INT_OBSTETRICIA_3, 
	' ' 				ID_INT_OBSTETRICIA_4, 
	' '				ID_INT_OBSTETRICIA_5, 
	' ' 				ID_INT_OBSTETRICIA_6, 
	' ' 				ID_INT_OBSTETRICIA_7, 
	' ' 				ID_INT_OBSTETRICIA_8, 
	' ' 				ID_INT_OBSTETRICIA_9, 
	' '				nr_decl_nasc_vivos, 
	'0'				qt_nasc_vivos_termo, 
	'0'				qt_nasc_morto, 
	'0'				qt_nasc_vivo_prematuro, 
	0				cd_obito_mulher, 
	'0'				qt_obito_neo_precoce, 
	'0'				qt_obito_neo_tardio, 
	0				ie_regime_inter, 
	'0'				qt_diarias_solicitadas, 
	'0'				qt_diarias_autorizadas, 
	LOCALTIMESTAMP				dt_admissao_hosp, 
	' '				nm_profissional_solic, 
	'CRM'				cd_conselho_regional, 
	' '				nr_conselho_profissional, 
	' '				uf_conselho, 
	' '				cd_prof_operadora, 
	0				nr_documento, 
	' '				cd_cid_principal, 
	'P'				tp_cid, 
	0				ie_indicacao_acidente, 
	0				nr_declaracao_obito, 
	0				cd_glosa, 
	0				cd_matmed_prestador, 
	' '				cd_servico_pago, 
	'C'				ie_local_utilizacao, 
	' '				cd_servico_exec, 
	' '				ds_servico, 
	' '				ie_tipo_pagamento, 
	' '				ie_local_procedimento, 
	LOCALTIMESTAMP				dt_realizacao, 
	0				cd_posicao, 
	'0'				qt_executada, 
	0				vl_honorario, 
	0				tx_procedimento, 
	' '				ie_situacao_servico, 
	0				cd_cgc_cpf_prestador, 
	LOCALTIMESTAMP				hr_minuto_exec_serv, 
	' '				ie_mesma_via, 
	'N'				ie_outra_cirurgia, 
	' '				cd_tipo_serv_exec, 
	' '				cd_tipo_serv_pago, 
	0				cd_cgc_cpf_prest_custo, 
	0				cd_cgc_cpf_prest_filme, 
	0				vl_total_item_custo, 
	0				vl_total_item_filme, 
	LOCALTIMESTAMP				dt_realizacao_paga, 
	LOCALTIMESTAMP				hr_minutos_pagos, 
	'0'				qt_mat_med, 
	' '				ie_tecnica_utilizada, 
	' ' 				cd_barra_opm, 
	' '				nm_profissional_exec, 
	t.nr_interno_conta		nr_conta, 
	replace(to_char(t.qt_item_conta),',','.') qt_itens_conta, 
	t.vl_total_conta		vl_total_conta, 
	t.vl_procedimento		vl_total_proced, 
	t.vl_diarias			vl_total_diarias, 
	t.vl_taxas			vl_total_taxas, 
	t.vl_materiais			vl_total_materiais, 
	t.vl_medicamentos		vl_total_medicamentos, 
	t.vl_sadt			vl_total_gases, 
	'0'				qt_contas_protocolo, 
	0				vl_total_protocolo, 
	rpad(0,395,0)			FILLER_N, 
	0				FILLER_Z, 
	''				IE_ORDEM_MAT_PROC, 
	'0'				ie_emite_conta, 
	0				nr_seq_item 
from 	w_interf_conta_total		t 

union
 
select	/* TRAILLER DA REMESSA */
 
	7 				tp_registro, 
	7				cd_tipo_registro, 
	LOCALTIMESTAMP				dt_periodo_inicial, 
	LOCALTIMESTAMP				dt_periodo_final, 
	1				ie_tipo_transmissao, 
	0				cd_cgc_convenio, 
	' '				ds_convenio, 
	'J'				ie_tipo_prestador, 
	0				cd_cgc_prestador, 
	' '				nm_prestador, 
	LOCALTIMESTAMP				dt_geracao, 
	' '				cd_cnes, 
	t.nr_seq_protocolo		nr_seq_protocolo, 
	' '				tp_logradouro, 
	' '				nm_logradouro, 
	' '				nr_endereco_prest, 
	' '				ds_compl_prestador, 
	' '				ds_municipio, 
	' '				cd_municipio_ibge, 
	' '				uf_prestador, 
	' '				nr_cep_executante, 
	0				nr_doc_guia, 
	0				ie_tipo_atendimento, 
	' ' 				cd_usuario_convenio, 
	LOCALTIMESTAMP				dt_internacao, 
	LOCALTIMESTAMP				dt_alta, 
	' '				nr_cpf_medico_resp, 
	'N'				ie_corte_prontuario, 
	' '				tp_saida_sadt, 
	'N'				ie_infeccao_hosp, 
	' '				tp_nascimento, 
	' '				ie_conta_auditada, 
	' '				registro_auditor, 
	' '				cd_reg_ans, 
	LOCALTIMESTAMP				dt_emissao_guia, 
	' '				nr_carteira_benefic, 
	' '				nm_paciente, 
	' '				ds_plano, 
	LOCALTIMESTAMP				dt_validade_carteira, 
	' '				nr_cartao_nac_saude, 
	' '				ie_carater_inter, 
	0				tp_acomodacao, 
	0				tp_internacao, 
	' '				ID_INT_OBSTETRICIA_1, 
	' '				ID_INT_OBSTETRICIA_2, 
	' ' 				ID_INT_OBSTETRICIA_3, 
	' ' 				ID_INT_OBSTETRICIA_4, 
	' '				ID_INT_OBSTETRICIA_5, 
	' ' 				ID_INT_OBSTETRICIA_6, 
	' ' 				ID_INT_OBSTETRICIA_7, 
	' ' 				ID_INT_OBSTETRICIA_8, 
	' ' 				ID_INT_OBSTETRICIA_9, 
	' '				nr_decl_nasc_vivos, 
	'0'				qt_nasc_vivos_termo, 
	'0'				qt_nasc_morto, 
	'0'				qt_nasc_vivo_prematuro, 
	0				cd_obito_mulher, 
	'0'				qt_obito_neo_precoce, 
	'0'				qt_obito_neo_tardio, 
	0				ie_regime_inter, 
	'0'				qt_diarias_solicitadas, 
	'0'				qt_diarias_autorizadas, 
	LOCALTIMESTAMP				dt_admissao_hosp, 
	' '				nm_profissional_solic, 
	'CRM'				cd_conselho_regional, 
	' '				nr_conselho_profissional, 
	' '				uf_conselho, 
	' '				cd_prof_operadora, 
	0				nr_documento, 
	' '				cd_cid_principal, 
	'P'				tp_cid, 
	0				ie_indicacao_acidente, 
	0				nr_declaracao_obito, 
	0				cd_glosa, 
	0				cd_matmed_prestador, 
	' '				cd_servico_pago, 
	'C'				ie_local_utilizacao, 
	' '				cd_servico_exec, 
	' '				ds_servico, 
	' '				ie_tipo_pagamento, 
	' '				ie_local_procedimento, 
	LOCALTIMESTAMP				dt_realizacao, 
	0				cd_posicao, 
	'0'				qt_executada, 
	0				vl_honorario, 
	0				tx_procedimento, 
	' '				ie_situacao_servico, 
	0				cd_cgc_cpf_prestador, 
	LOCALTIMESTAMP				hr_minuto_exec_serv, 
	' '				ie_mesma_via, 
	'N'				ie_outra_cirurgia, 
	' '				cd_tipo_serv_exec, 
	' '				cd_tipo_serv_pago, 
	0				cd_cgc_cpf_prest_custo, 
	0				cd_cgc_cpf_prest_filme, 
	0				vl_total_item_custo, 
	0				vl_total_item_filme, 
	LOCALTIMESTAMP				dt_realizacao_paga, 
	LOCALTIMESTAMP				hr_minutos_pagos, 
	'0'				qt_mat_med, 
	' '				ie_tecnica_utilizada, 
	' ' 				cd_barra_opm, 
	' '				nm_profissional_exec, 
	999999999			nr_conta, 
	'0'				qt_itens_conta, 
	0				vl_total_conta, 
	0				vl_total_proced, 
	0				vl_total_diarias, 
	0				vl_total_taxas, 
	0				vl_total_materiais, 
	0				vl_total_medicamentos, 
	0				vl_total_gases, 
	replace(to_char(t.qt_total_conta),',','.') qt_contas_protocolo, 
	t.vl_total_conta		vl_total_protocolo, 
	rpad(0,648,0)			FILLER_N, 
	0				FILLER_Z, 
	''				IE_ORDEM_MAT_PROC, 
	'0'				ie_emite_conta, 
	0				nr_seq_item 
from 	w_interf_conta_trailler		t 
where 	1 = 1;

