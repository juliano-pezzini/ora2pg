-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW adep_pend_v2 (nr_seq_apresent, ie_tipo_item, ds_tipo_item, ds_tipo_item_plural, ie_laboratorio, cd_estabelecimento, nr_atendimento, nr_prescricao, cd_prescritor, nm_prescritor, dt_prescricao, dt_inicio_prescr, dt_validade_prescr, dt_liberacao, dt_lib_horario, cd_setor_prescr, ie_setor_processo_gedipa, nr_seq_item, ie_acm_sn, ie_di, cd_item, ie_origem_proced, nr_seq_proc_interno, ds_item, nr_agrupamento, cd_intervalo, ds_diluente, ds_topografia, ie_assoc_adep, nr_seq_area_prep, nr_seq_lote, nr_seq_processo, nr_seq_horario, dt_horario, qt_pend, cd_um, qt_dose, cd_unidade_medida_dose, ie_via, cd_pessoa_evento, nm_pessoa_evento, dt_liberacao_medico, ie_urgencia, cd_local_estoque, nr_seq_superior, ie_item_superior, ds_justificativa, nr_sequencia_proc, cd_local_estoque_mat, cd_local_estoque_aux, cd_setor_aux, ie_conferencia, ie_higienizacao, ie_preparo, ie_dose_especial) AS select	1 nr_seq_apresent,
	'D' ie_tipo_item,
	'Dieta oral' ds_tipo_item,
	'Dietas orais' ds_tipo_item_plural,
	'N' ie_laboratorio,
	a.cd_estabelecimento,
	a.nr_atendimento,
	a.nr_prescricao,
	a.cd_prescritor,
	p.nm_pessoa_fisica nm_prescritor,
	a.dt_prescricao,
	a.dt_inicio_prescr,
	a.dt_validade_prescr,
	a.dt_liberacao,
	c.dt_lib_horario,
	a.cd_setor_atendimento cd_setor_prescr,
	substr(obter_se_setor_processo_gedipa(a.cd_setor_atendimento),1,1) ie_setor_processo_gedipa,
	-1 nr_seq_item,
	null ie_acm_sn,
	null ie_di,
	c.cd_refeicao cd_item,
	(null)::numeric  ie_origem_proced,
	(null)::numeric  nr_seq_proc_interno,
	substr(obter_valor_dominio(99,c.cd_refeicao),1,240) ds_item,
	(null)::numeric  nr_agrupamento,
	'' cd_intervalo,
	null ds_diluente,
	null ds_topografia,
	'N' ie_assoc_adep,
	(null)::numeric  nr_seq_area_prep,
	(null)::numeric  nr_seq_lote,
	(null)::numeric  nr_seq_processo,
	c.nr_sequencia nr_seq_horario,
	c.dt_horario,
	1 qt_pend,
	'' cd_um,
	1 qt_dose,
	'' cd_unidade_medida_dose,
	'' ie_via,
	'' cd_pessoa_evento,
	'' nm_pessoa_evento,
	a.dt_liberacao_medico,
	'' ie_urgencia,
	obter_local_estoque_setor(a.cd_setor_atendimento, a.cd_estabelecimento) cd_local_estoque,
	(null)::numeric  nr_seq_superior,
	null ie_item_superior,
	null ds_justificativa,
	null nr_sequencia_proc,
	null cd_local_estoque_mat,
	obter_local_estoque_setor(Obter_Unidade_Atendimento(a.nr_atendimento,'IAA','CS'), a.cd_estabelecimento) cd_local_estoque_aux,
	Obter_Unidade_Atendimento(a.nr_atendimento,'IAA','CS') cd_setor_aux,
	null ie_conferencia,
	null ie_higienizacao,
	null ie_preparo,
	null IE_DOSE_ESPECIAL
FROM	pessoa_fisica p,
	prescr_dieta_hor c,
	prescr_medica a
where	c.nr_prescricao = a.nr_prescricao
and	a.cd_prescritor	= p.cd_pessoa_fisica
and	c.dt_fim_horario is null
and	c.dt_suspensao is null
and	not exists (	select	1
			from	prescr_dieta x
			where	x.nr_prescricao = c.nr_prescricao
			and	x.nr_sequencia	= c.nr_seq_dieta
			and	x.dt_suspensao is not null)
and	coalesce(c.ie_situacao,'A') = 'A'
and	coalesce(a.ie_adep,'S') = 'S'
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S'
and a.dt_inicio_prescr between LOCALTIMESTAMP - interval '2 days' and LOCALTIMESTAMP + interval '2 days'

union

select	2 nr_seq_apresent,
	'S' ie_tipo_item,
	'Suplemento oral' ds_tipo_item,
	'Suplementos orais' ds_tipo_item_plural,
	'N' ie_laboratorio,
	a.cd_estabelecimento,
	a.nr_atendimento,
	a.nr_prescricao,
	a.cd_prescritor,
	p.nm_pessoa_fisica nm_prescritor,
	a.dt_prescricao,
	a.dt_inicio_prescr,
	a.dt_validade_prescr,
	a.dt_liberacao,
	c.dt_lib_horario,
	a.cd_setor_atendimento cd_setor_prescr,
	substr(obter_se_setor_processo_gedipa(a.cd_setor_atendimento),1,1) ie_setor_processo_gedipa,
	b.nr_sequencia nr_seq_item,
	CASE WHEN coalesce(b.ie_acm,'N')='S' THEN  'S'  ELSE CASE WHEN coalesce(b.ie_se_necessario,'N')='S' THEN  'S'  ELSE 'N' END  END  ie_acm_sn,
	coalesce(b.ie_bomba_infusao,'N') ie_di,
	to_char(b.cd_material) cd_item,
	(null)::numeric  ie_origem_proced,
	(null)::numeric  nr_seq_proc_interno,
	m.ds_material ds_item,
	(null)::numeric  nr_agrupamento,
	b.cd_intervalo cd_intervalo,
	null ds_diluente,
	null ds_topografia,
	'N' ie_assoc_adep,
	(c.nr_seq_area_prep)::numeric  nr_seq_area_prep,
	c.nr_seq_lote nr_seq_lote,
	c.nr_seq_processo nr_seq_processo,
	c.nr_sequencia nr_seq_horario,
	c.dt_horario,
	c.qt_dispensar_hor qt_pend,
	c.cd_unidade_medida cd_um,
	c.qt_dose,
	c.cd_unidade_medida_dose,
	b.ie_via_aplicacao ie_via,
	'' cd_pessoa_evento,
	'' nm_pessoa_evento,
	a.dt_liberacao_medico,
	b.ie_urgencia,
	obter_local_estoque_setor(a.cd_setor_atendimento, a.cd_estabelecimento) cd_local_estoque,
	c.nr_seq_superior,
	b.ie_item_superior,
	b.ds_justificativa,
	null nr_sequencia_proc,
	null cd_local_estoque_mat,
	obter_local_estoque_setor(Obter_Unidade_Atendimento(a.nr_atendimento,'IAA','CS'), a.cd_estabelecimento) cd_local_estoque_aux,
	Obter_Unidade_Atendimento(a.nr_atendimento,'IAA','CS') cd_setor_aux,
	coalesce(b.ie_conferencia,'S') ie_conferencia,
	coalesce(b.ie_higienizacao,'S') ie_higienizacao,
	coalesce(b.ie_preparo,'S') ie_preparo,
	c.IE_DOSE_ESPECIAL IE_DOSE_ESPECIAL
from	pessoa_fisica p,
	material m,
	prescr_mat_hor c,
	prescr_material b,
	prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
and	b.cd_material	= m.cd_material
and	a.cd_prescritor	= p.cd_pessoa_fisica
and	b.nr_seq_recomendacao is null
and	c.dt_fim_horario is null
and	c.dt_suspensao is null
and	coalesce(c.ie_situacao,'A') = 'A'
and	coalesce(c.ie_horario_especial,'N') <> 'S'
and	b.ie_agrupador = 12
and	coalesce(a.ie_adep,'S') = 'S'
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S'
and 	a.dt_inicio_prescr between LOCALTIMESTAMP - interval '2 days' and LOCALTIMESTAMP + interval '2 days'

union

select	3 nr_seq_apresent,
	'M' ie_tipo_item,
	'Medicamento' ds_tipo_item,
	'Medicamentos' ds_tipo_item_plural,
	'N' ie_laboratorio,
	a.cd_estabelecimento,
	a.nr_atendimento,
	a.nr_prescricao,
	a.cd_prescritor,
	p.nm_pessoa_fisica nm_prescritor,
	a.dt_prescricao,
	a.dt_inicio_prescr,
	a.dt_validade_prescr,
	coalesce(a.dt_liberacao,b.dt_lib_material),
	c.dt_lib_horario,
	a.cd_setor_atendimento cd_setor_prescr,
	substr(obter_se_setor_processo_gedipa(a.cd_setor_atendimento),1,1) ie_setor_processo_gedipa,
	b.nr_sequencia nr_seq_item,
	CASE WHEN coalesce(b.ie_acm,'N')='S' THEN  'S'  ELSE CASE WHEN coalesce(b.ie_se_necessario,'N')='S' THEN  'S'  ELSE 'N' END  END  ie_acm_sn,
	coalesce(b.ie_bomba_infusao,'N') ie_di,
	to_char(b.cd_material) cd_item,
	(null)::numeric  ie_origem_proced,
	(null)::numeric  nr_seq_proc_interno,
	m.ds_material ds_item,
	b.nr_agrupamento nr_agrupamento,
	b.cd_intervalo cd_intervalo,
	substr(obter_diluicao_medic_adep(c.nr_sequencia),1,240) ds_diluente,
	null ds_topografia,
	'N' ie_assoc_adep,
	(c.nr_seq_area_prep)::numeric  nr_seq_area_prep,
	c.nr_seq_lote nr_seq_lote,
	c.nr_seq_processo nr_seq_processo,
	c.nr_sequencia nr_seq_horario,
	c.dt_horario,
	c.qt_dispensar_hor qt_pend,
	c.cd_unidade_medida cd_um,
	c.qt_dose,
	c.cd_unidade_medida_dose,
	b.ie_via_aplicacao ie_via,
	'' cd_pessoa_evento,
	'' nm_pessoa_evento,
	coalesce(a.dt_liberacao_medico,b.dt_lib_material),
	b.ie_urgencia,
	obter_local_estoque_setor(a.cd_setor_atendimento, a.cd_estabelecimento) cd_local_estoque,
	c.nr_seq_superior,
	b.ie_item_superior,
	b.ds_justificativa,
	null nr_sequencia_proc,
	b.cd_local_estoque cd_local_estoque_mat,
	obter_local_estoque_setor(Obter_Unidade_Atendimento(a.nr_atendimento,'IAA','CS'), a.cd_estabelecimento) cd_local_estoque_aux,
	Obter_Unidade_Atendimento(a.nr_atendimento,'IAA','CS') cd_setor_aux,
	coalesce(b.ie_conferencia,'S') ie_conferencia,
	coalesce(b.ie_higienizacao,'S') ie_higienizacao,
	coalesce(b.ie_preparo,'S') ie_preparo,
	c.IE_DOSE_ESPECIAL IE_DOSE_ESPECIAL
from	pessoa_fisica p,
	material m,
	prescr_mat_hor c,
	prescr_material b,
	prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
and	b.cd_material	= m.cd_material
and	a.cd_prescritor	= p.cd_pessoa_fisica
--and	b.nr_seq_recomendacao is null
and	c.dt_fim_horario is null
and	c.dt_suspensao is null
and	a.dt_suspensao is null
and	coalesce(c.ie_situacao,'A') = 'A'
and	coalesce(c.ie_adep,'S') = 'S'
and	coalesce(c.ie_horario_especial,'N') <> 'S'
and	coalesce(b.ie_administrar,'S') <> 'N'
and	b.ie_agrupador = 1
and	c.dt_recusa is null
and	((obter_se_gerar_item_adep('M',b.nr_prescricao,b.nr_sequencia,b.nr_agrupamento,'N') = 'S') or (b.nr_seq_recomendacao is not null))
and	coalesce(a.ie_adep,'S') = 'S'
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S'
and 	a.dt_inicio_prescr between LOCALTIMESTAMP - interval '2 days' and LOCALTIMESTAMP + interval '2 days'

union

select	4 nr_seq_apresent,
	'MAT' ie_tipo_item,
	'Material' ds_tipo_item,
	'Materiais' ds_tipo_item_plural,
	'N' ie_laboratorio,
	a.cd_estabelecimento,
	a.nr_atendimento,
	a.nr_prescricao,
	a.cd_prescritor,
	p.nm_pessoa_fisica nm_prescritor,
	a.dt_prescricao,
	a.dt_inicio_prescr,
	a.dt_validade_prescr,
	a.dt_liberacao,
	c.dt_lib_horario,
	a.cd_setor_atendimento cd_setor_prescr,
	substr(obter_se_setor_processo_gedipa(a.cd_setor_atendimento),1,1) ie_setor_processo_gedipa,
	b.nr_sequencia nr_seq_item,
	CASE WHEN coalesce(b.ie_acm,'N')='S' THEN  'S'  ELSE CASE WHEN coalesce(b.ie_se_necessario,'N')='S' THEN  'S'  ELSE 'N' END  END  ie_acm_sn,
	coalesce(b.ie_bomba_infusao,'N') ie_di,
	to_char(b.cd_material) cd_item,
	(null)::numeric  ie_origem_proced,
	(null)::numeric  nr_seq_proc_interno,
	m.ds_material ds_item,
	(null)::numeric  nr_agrupamento,
	b.cd_intervalo cd_intervalo,
	null ds_diluente,
	null ds_topografia,
	'N' ie_assoc_adep,
	(c.nr_seq_area_prep)::numeric  nr_seq_area_prep,
	c.nr_seq_lote nr_seq_lote,
	c.nr_seq_processo nr_seq_processo,
	c.nr_sequencia nr_seq_horario,
	c.dt_horario,
	c.qt_dispensar_hor qt_pend,
	c.cd_unidade_medida cd_um,
	c.qt_dose,
	c.cd_unidade_medida_dose,
	b.ie_via_aplicacao ie_via,
	'' cd_pessoa_evento,
	'' nm_pessoa_evento,
	a.dt_liberacao_medico,
	b.ie_urgencia,
	obter_local_estoque_setor(a.cd_setor_atendimento, a.cd_estabelecimento) cd_local_estoque,
	c.nr_seq_superior,
	b.ie_item_superior,
	b.ds_justificativa,
	null nr_sequencia_proc,
	b.cd_local_estoque cd_local_estoque_mat,
	obter_local_estoque_setor(Obter_Unidade_Atendimento(a.nr_atendimento,'IAA','CS'), a.cd_estabelecimento) cd_local_estoque_aux,
	Obter_Unidade_Atendimento(a.nr_atendimento,'IAA','CS') cd_setor_aux,
	coalesce(b.ie_conferencia,'S') ie_conferencia,
	coalesce(b.ie_higienizacao,'S') ie_higienizacao,
	coalesce(b.ie_preparo,'S') ie_preparo,
	c.IE_DOSE_ESPECIAL IE_DOSE_ESPECIAL
from	pessoa_fisica p,
	material m,
	prescr_mat_hor c,
	prescr_material b,
	prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
and	b.cd_material	= m.cd_material
and	a.cd_prescritor	= p.cd_pessoa_fisica
and	b.nr_seq_recomendacao is null
and	c.dt_fim_horario is null
and	c.dt_suspensao is null
and	coalesce(c.ie_situacao,'A') = 'A'
and	coalesce(c.ie_adep,'S') = 'S'
and	coalesce(b.ie_administrar,'S') <> 'N'
and	coalesce(c.ie_horario_especial,'N') <> 'S'
and	b.ie_agrupador = 2
and	coalesce(a.ie_adep,'S') = 'S'
and	obter_se_material_adep(a.cd_estabelecimento,b.cd_material) = 'S'
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S'
and 	a.dt_inicio_prescr between LOCALTIMESTAMP - interval '2 days' and LOCALTIMESTAMP + interval '2 days'

union

select	8 nr_seq_apresent,
	'ME' ie_tipo_item,
	'Medicamento' ds_tipo_item,
	'Medicamentos' ds_tipo_item_plural,
	'N' ie_laboratorio,
	a.cd_estabelecimento,
	a.nr_atendimento,
	a.nr_prescricao,
	a.cd_prescritor,
	p.nm_pessoa_fisica nm_prescritor,
	a.dt_prescricao,
	a.dt_inicio_prescr,
	a.dt_validade_prescr,
	a.dt_liberacao,
	c.dt_lib_horario,
	a.cd_setor_atendimento cd_setor_prescr,
	substr(obter_se_setor_processo_gedipa(a.cd_setor_atendimento),1,1) ie_setor_processo_gedipa,
	b.nr_sequencia nr_seq_item,
	CASE WHEN coalesce(b.ie_acm,'N')='S' THEN  'S'  ELSE CASE WHEN coalesce(b.ie_se_necessario,'N')='S' THEN  'S'  ELSE 'N' END  END  ie_acm_sn,
	coalesce(b.ie_bomba_infusao,'N') ie_di,
	to_char(b.cd_material) cd_item,
	(null)::numeric  ie_origem_proced,
	(null)::numeric  nr_seq_proc_interno,
	m.ds_material ds_item,
	b.nr_agrupamento nr_agrupamento,
	b.cd_intervalo cd_intervalo,
	substr(obter_diluicao_medic_adep(c.nr_sequencia),1,240) ds_diluente,
	null ds_topografia,
	'N' ie_assoc_adep,
	(c.nr_seq_area_prep)::numeric  nr_seq_area_prep,
	c.nr_seq_lote nr_seq_lote,
	c.nr_seq_processo nr_seq_processo,
	c.nr_sequencia nr_seq_horario,
	c.dt_horario,
	c.qt_dispensar_hor qt_pend,
	c.cd_unidade_medida cd_um,
	c.qt_dose,
	c.cd_unidade_medida_dose,
	b.ie_via_aplicacao ie_via,
	'' cd_pessoa_evento,
	'' nm_pessoa_evento,
	a.dt_liberacao_medico,
	b.ie_urgencia,
	obter_local_estoque_setor(a.cd_setor_atendimento, a.cd_estabelecimento) cd_local_estoque,
	c.nr_seq_superior,
	b.ie_item_superior,
	b.ds_justificativa,
	null nr_sequencia_proc,
	b.cd_local_estoque cd_local_estoque_mat,
	obter_local_estoque_setor(Obter_Unidade_Atendimento(a.nr_atendimento,'IAA','CS'), a.cd_estabelecimento) cd_local_estoque_aux,
	Obter_Unidade_Atendimento(a.nr_atendimento,'IAA','CS') cd_setor_aux,
	coalesce(b.ie_conferencia,'S') ie_conferencia,
	coalesce(b.ie_higienizacao,'S') ie_higienizacao,
	coalesce(b.ie_preparo,'S') ie_preparo,
	c.IE_DOSE_ESPECIAL IE_DOSE_ESPECIAL
from	pessoa_fisica p,
	material m,
	prescr_mat_hor c,
	prescr_material b,
	prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
and	b.cd_material	= m.cd_material
and	a.cd_prescritor	= p.cd_pessoa_fisica
and	b.nr_seq_recomendacao is null
and	c.dt_fim_horario is null
and	c.dt_suspensao is null
and	coalesce(c.ie_situacao,'A') = 'A'
and	coalesce(c.ie_adep,'S') = 'S'
and	coalesce(c.ie_horario_especial,'N') <> 'S'
and	b.ie_agrupador = 14
and	c.dt_recusa is null
and	obter_se_gerar_item_adep('M',b.nr_prescricao,b.nr_sequencia,b.nr_agrupamento,'N') = 'S'
and	coalesce(a.ie_adep,'S') = 'S'
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S'
and 	a.dt_inicio_prescr between LOCALTIMESTAMP - interval '2 days' and LOCALTIMESTAMP + interval '2 days'

union

select	9 nr_seq_apresent,
	'MAP' ie_tipo_item,
	'Medicamento' ds_tipo_item,
	'Medicamentos' ds_tipo_item_plural,
	'N' ie_laboratorio,
	a.cd_estabelecimento,
	a.nr_atendimento,
	a.nr_prescricao,
	a.cd_prescritor,
	p.nm_pessoa_fisica nm_prescritor,
	a.dt_prescricao,
	a.dt_inicio_prescr,
	a.dt_validade_prescr,
	a.dt_liberacao,
	c.dt_lib_horario,
	a.cd_setor_atendimento cd_setor_prescr,
	substr(obter_se_setor_processo_gedipa(a.cd_setor_atendimento),1,1) ie_setor_processo_gedipa,
	b.nr_sequencia nr_seq_item,
	CASE WHEN coalesce(b.ie_acm,'N')='S' THEN  'S'  ELSE CASE WHEN coalesce(b.ie_se_necessario,'N')='S' THEN  'S'  ELSE 'N' END  END  ie_acm_sn,
	coalesce(b.ie_bomba_infusao,'N') ie_di,
	to_char(b.cd_material) cd_item,
	(null)::numeric  ie_origem_proced,
	(null)::numeric  nr_seq_proc_interno,
	m.ds_material ds_item,
	b.nr_agrupamento nr_agrupamento,
	b.cd_intervalo cd_intervalo,
	substr(obter_diluicao_medic_adep(c.nr_sequencia),1,240) ds_diluente,
	null ds_topografia,
	'N' ie_assoc_adep,
	(c.nr_seq_area_prep)::numeric  nr_seq_area_prep,
	c.nr_seq_lote nr_seq_lote,
	c.nr_seq_processo nr_seq_processo,
	c.nr_sequencia nr_seq_horario,
	c.dt_horario,
	c.qt_dispensar_hor qt_pend,
	c.cd_unidade_medida cd_um,
	c.qt_dose,
	c.cd_unidade_medida_dose,
	b.ie_via_aplicacao ie_via,
	'' cd_pessoa_evento,
	'' nm_pessoa_evento,
	a.dt_liberacao_medico,
	b.ie_urgencia,
	obter_local_estoque_setor(a.cd_setor_atendimento, a.cd_estabelecimento) cd_local_estoque,
	c.nr_seq_superior,
	b.ie_item_superior,
	b.ds_justificativa,
	b.nr_sequencia_proc,
	b.cd_local_estoque cd_local_estoque_mat,
	obter_local_estoque_setor(Obter_Unidade_Atendimento(a.nr_atendimento,'IAA','CS'), a.cd_estabelecimento) cd_local_estoque_aux,
	Obter_Unidade_Atendimento(a.nr_atendimento,'IAA','CS') cd_setor_aux,
	coalesce(b.ie_conferencia,'S') ie_conferencia,
	coalesce(b.ie_higienizacao,'S') ie_higienizacao,
	coalesce(b.ie_preparo,'S') ie_preparo,
	c.IE_DOSE_ESPECIAL IE_DOSE_ESPECIAL
from	pessoa_fisica p,
	material m,
	prescr_mat_hor c,
	prescr_material b,
	prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
and	b.cd_material	= m.cd_material
and	a.cd_prescritor	= p.cd_pessoa_fisica
and	b.nr_seq_recomendacao is null
and	c.dt_fim_horario is null
and	c.dt_suspensao is null
and	coalesce(c.ie_situacao,'A') = 'A'
and	coalesce(c.ie_adep,'S') = 'S'
and	coalesce(c.ie_horario_especial,'N') <> 'S'
and	b.ie_agrupador = 5
and	c.dt_recusa is null
--and	obter_se_gerar_item_adep('M',b.nr_prescricao,b.nr_sequencia,b.nr_agrupamento) = 'S'
and	coalesce(a.ie_adep,'S') = 'S'
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S'
and 	a.dt_inicio_prescr between LOCALTIMESTAMP - interval '2 days' and LOCALTIMESTAMP + interval '2 days'

union

select	10 nr_seq_apresent,
	'NE' ie_tipo_item,
	'Suporte Nutricional Enteral' ds_tipo_item,
	'Suporte Nutricional Enteral' ds_tipo_item_plural,
	'N' ie_laboratorio,
	a.cd_estabelecimento,
	a.nr_atendimento,
	a.nr_prescricao,
	a.cd_prescritor,
	p.nm_pessoa_fisica nm_prescritor,
	a.dt_prescricao,
	a.dt_inicio_prescr,
	a.dt_validade_prescr,
	a.dt_liberacao,
	c.dt_lib_horario,
	a.cd_setor_atendimento cd_setor_prescr,
	substr(obter_se_setor_processo_gedipa(a.cd_setor_atendimento),1,1) ie_setor_processo_gedipa,
	b.nr_sequencia nr_seq_item,
	CASE WHEN coalesce(b.ie_acm,'N')='S' THEN  'S'  ELSE CASE WHEN coalesce(b.ie_se_necessario,'N')='S' THEN  'S'  ELSE 'N' END  END  ie_acm_sn,
	coalesce(b.ie_bomba_infusao,'N') ie_di,
	to_char(b.cd_material) cd_item,
	(null)::numeric  ie_origem_proced,
	(null)::numeric  nr_seq_proc_interno,
	m.ds_material ds_item,
	(null)::numeric  nr_agrupamento,
	b.cd_intervalo cd_intervalo,
	null ds_diluente,
	null ds_topografia,
	'N' ie_assoc_adep,
	(c.nr_seq_area_prep)::numeric  nr_seq_area_prep,
	c.nr_seq_lote nr_seq_lote,
	c.nr_seq_processo nr_seq_processo,
	c.nr_sequencia nr_seq_horario,
	c.dt_horario,
	c.qt_dispensar_hor qt_pend,
	c.cd_unidade_medida cd_um,
	c.qt_dose,
	c.cd_unidade_medida_dose,
	b.ie_via_aplicacao ie_via,
	'' cd_pessoa_evento,
	'' nm_pessoa_evento,
	a.dt_liberacao_medico,
	b.ie_urgencia,
	obter_local_estoque_setor(a.cd_setor_atendimento, a.cd_estabelecimento) cd_local_estoque,
	c.nr_seq_superior,
	b.ie_item_superior,
	b.ds_justificativa,
	null nr_sequencia_proc,
	null cd_local_estoque_mat,
	obter_local_estoque_setor(Obter_Unidade_Atendimento(a.nr_atendimento,'IAA','CS'), a.cd_estabelecimento) cd_local_estoque_aux,
	Obter_Unidade_Atendimento(a.nr_atendimento,'IAA','CS') cd_setor_aux,
	coalesce(b.ie_conferencia,'S') ie_conferencia,
	coalesce(b.ie_higienizacao,'S') ie_higienizacao,
	coalesce(b.ie_preparo,'S') ie_preparo,
	c.IE_DOSE_ESPECIAL IE_DOSE_ESPECIAL
from	pessoa_fisica p,
	material m,
	prescr_mat_hor c,
	prescr_material b,
	prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
and	b.cd_material	= m.cd_material
and	a.cd_prescritor	= p.cd_pessoa_fisica
and	b.nr_seq_recomendacao is null
and	c.dt_fim_horario is null
and	c.dt_suspensao is null
and	coalesce(c.ie_situacao,'A') = 'A'
and	coalesce(c.ie_horario_especial,'N') <> 'S'
and	b.ie_agrupador = 8
and	coalesce(a.ie_adep,'S') = 'S'
--and	nvl(b.ie_status,'N') = 'N'
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S'
and 	a.dt_inicio_prescr between LOCALTIMESTAMP - interval '2 days' and LOCALTIMESTAMP + interval '2 days'

union

select	13 nr_seq_apresent,
	'NAN' ie_tipo_item,
	'NPT Adulta' ds_tipo_item,
	'NPT Adulta' ds_tipo_item_plural,
	'N' ie_laboratorio,
	a.cd_estabelecimento,
	a.nr_atendimento,
	a.nr_prescricao,
	a.cd_prescritor,
	p.nm_pessoa_fisica nm_prescritor,
	a.dt_prescricao,
	a.dt_inicio_prescr,
	a.dt_validade_prescr,
	coalesce(a.dt_liberacao,b.dt_lib_material),
	c.dt_lib_horario,
	a.cd_setor_atendimento cd_setor_prescr,
	substr(obter_se_setor_processo_gedipa(a.cd_setor_atendimento),1,1) ie_setor_processo_gedipa,
	b.nr_sequencia nr_seq_item,
	CASE WHEN coalesce(b.ie_acm,'N')='S' THEN  'S'  ELSE CASE WHEN coalesce(b.ie_se_necessario,'N')='S' THEN  'S'  ELSE 'N' END  END  ie_acm_sn,
	coalesce(b.ie_bomba_infusao,'N') ie_di,
	to_char(b.cd_material) cd_item,
	(null)::numeric  ie_origem_proced,
	(null)::numeric  nr_seq_proc_interno,
	m.ds_material ds_item,
	b.nr_agrupamento nr_agrupamento,
	b.cd_intervalo cd_intervalo,
	substr(obter_diluicao_medic_adep(c.nr_sequencia),1,240) ds_diluente,
	null ds_topografia,
	'N' ie_assoc_adep,
	(c.nr_seq_area_prep)::numeric  nr_seq_area_prep,
	c.nr_seq_lote nr_seq_lote,
	c.nr_seq_processo nr_seq_processo,
	c.nr_sequencia nr_seq_horario,
	c.dt_horario,
	c.qt_dispensar_hor qt_pend,
	c.cd_unidade_medida cd_um,
	c.qt_dose,
	c.cd_unidade_medida_dose,
	b.ie_via_aplicacao ie_via,
	'' cd_pessoa_evento,
	'' nm_pessoa_evento,
	coalesce(a.dt_liberacao_medico,b.dt_lib_material),
	b.ie_urgencia,
	obter_local_estoque_setor(a.cd_setor_atendimento, a.cd_estabelecimento) cd_local_estoque,
	c.nr_seq_superior,
	b.ie_item_superior,
	b.ds_justificativa,
	null nr_sequencia_proc,
	b.cd_local_estoque cd_local_estoque_mat,
	obter_local_estoque_setor(Obter_Unidade_Atendimento(a.nr_atendimento,'IAA','CS'), a.cd_estabelecimento) cd_local_estoque_aux,
	Obter_Unidade_Atendimento(a.nr_atendimento,'IAA','CS') cd_setor_aux,
	coalesce(b.ie_conferencia,'S') ie_conferencia,
	coalesce(b.ie_higienizacao,'S') ie_higienizacao,
	coalesce(b.ie_preparo,'S') ie_preparo,
	c.IE_DOSE_ESPECIAL IE_DOSE_ESPECIAL
from	pessoa_fisica p,
	material m,
	prescr_mat_hor c,
	prescr_material b,
	prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
and	b.cd_material	= m.cd_material
and	a.cd_prescritor	= p.cd_pessoa_fisica
and	b.nr_seq_recomendacao is null
and	c.dt_fim_horario is null
and	c.dt_suspensao is null
and	coalesce(c.ie_situacao,'A') = 'A'
and	coalesce(c.ie_adep,'S') = 'S'
and	coalesce(c.ie_horario_especial,'N') <> 'S'
and	b.ie_agrupador = 11
and	obter_se_gerar_item_adep('M',b.nr_prescricao,b.nr_sequencia,b.nr_agrupamento,'N') = 'S'
and	coalesce(a.ie_adep,'S') = 'S'
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S'
and 	a.dt_inicio_prescr between LOCALTIMESTAMP - interval '2 days' and LOCALTIMESTAMP + interval '2 days'

union

select	14 nr_seq_apresent,
	'LD' ie_tipo_item,
	'Leite Derivados' ds_tipo_item,
	'Leite Derivados' ds_tipo_item_plural,
	'N' ie_laboratorio,
	a.cd_estabelecimento,
	a.nr_atendimento,
	a.nr_prescricao,
	a.cd_prescritor,
	p.nm_pessoa_fisica nm_prescritor,
	a.dt_prescricao,
	a.dt_inicio_prescr,
	a.dt_validade_prescr,
	coalesce(a.dt_liberacao,b.dt_lib_material),
	c.dt_lib_horario,
	a.cd_setor_atendimento cd_setor_prescr,
	substr(obter_se_setor_processo_gedipa(a.cd_setor_atendimento),1,1) ie_setor_processo_gedipa,
	b.nr_sequencia nr_seq_item,
	CASE WHEN coalesce(b.ie_acm,'N')='S' THEN  'S'  ELSE CASE WHEN coalesce(b.ie_se_necessario,'N')='S' THEN  'S'  ELSE 'N' END  END  ie_acm_sn,
	coalesce(b.ie_bomba_infusao,'N') ie_di,
	to_char(b.cd_material) cd_item,
	(null)::numeric  ie_origem_proced,
	(null)::numeric  nr_seq_proc_interno,
	m.ds_material ds_item,
	b.nr_agrupamento nr_agrupamento,
	b.cd_intervalo cd_intervalo,
	substr(obter_diluicao_medic_adep(c.nr_sequencia),1,240) ds_diluente,
	null ds_topografia,
	'N' ie_assoc_adep,
	(c.nr_seq_area_prep)::numeric  nr_seq_area_prep,
	c.nr_seq_lote nr_seq_lote,
	c.nr_seq_processo nr_seq_processo,
	c.nr_sequencia nr_seq_horario,
	c.dt_horario,
	c.qt_dispensar_hor qt_pend,
	c.cd_unidade_medida cd_um,
	c.qt_dose,
	c.cd_unidade_medida_dose,
	b.ie_via_aplicacao ie_via,
	'' cd_pessoa_evento,
	'' nm_pessoa_evento,
	coalesce(a.dt_liberacao_medico,b.dt_lib_material),
	b.ie_urgencia,
	obter_local_estoque_setor(a.cd_setor_atendimento, a.cd_estabelecimento) cd_local_estoque,
	c.nr_seq_superior,
	b.ie_item_superior,
	b.ds_justificativa,
	null nr_sequencia_proc,
	b.cd_local_estoque cd_local_estoque_mat,
	obter_local_estoque_setor(Obter_Unidade_Atendimento(a.nr_atendimento,'IAA','CS'), a.cd_estabelecimento) cd_local_estoque_aux,
	Obter_Unidade_Atendimento(a.nr_atendimento,'IAA','CS') cd_setor_aux,
	coalesce(b.ie_conferencia,'S') ie_conferencia,
	coalesce(b.ie_higienizacao,'S') ie_higienizacao,
	coalesce(b.ie_preparo,'S') ie_preparo,
	c.IE_DOSE_ESPECIAL IE_DOSE_ESPECIAL
from	pessoa_fisica p,
	material m,
	prescr_mat_hor c,
	prescr_material b,
	prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
and	b.cd_material	= m.cd_material
and	a.cd_prescritor	= p.cd_pessoa_fisica
and	b.nr_seq_recomendacao is null
and	c.dt_fim_horario is null
and	c.dt_suspensao is null
and	coalesce(c.ie_situacao,'A') = 'A'
and	coalesce(c.ie_adep,'S') = 'S'
and	coalesce(c.ie_horario_especial,'N') <> 'S'
and	b.ie_agrupador in (16,17)
and	coalesce(a.ie_adep,'S') = 'S'
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S'
and 	a.dt_inicio_prescr between LOCALTIMESTAMP - interval '2 days' and LOCALTIMESTAMP + interval '2 days';

