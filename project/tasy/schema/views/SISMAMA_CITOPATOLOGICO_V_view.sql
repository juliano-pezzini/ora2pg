-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW sismama_citopatologico_v (nr_seq_protocolo, c_cnes, c_exame, c_id_nome, c_id_nomemae, c_id_apel, d_id_dtnasc, c_id_ident, c_id_emis, c_id_ufide, c_id_cic, c_id_esco, c_id_endereco, c_id_numero, c_id_complem, c_id_bairro, c_id_uf, c_ibge, c_id_cep, c_id_refe, c_id_fone, c_id_sus, c_us_uf, c_us_ibge, c_us_cnes, c_us_nome, c_pron, c_anm_achou, c_anm_achou_md, c_anm_achou_me, c_anm_grav, c_anm_tcanc, c_cli_desc, c_cli_nodu, c_cli_local, c_cli_ttum, c_cli_tsol, c_cli_matmam, c_cli_matdpc, c_cli_nlam, c_res_loc, c_res_numl, c_res_adeq, c_res_insap, c_res_benig, c_res_bem_out, c_res_mali_ind, c_res_mali_ind_out, c_res_pos_mali, c_res_mali_out, c_res_sus_mali, c_res_sus_out, c_res_der_papi, c_observ, d_col_us, d_recebe, d_libera, c_pat_cns, c_pat_cic, c_id_sexo, c_id_racacor) AS select	b.nr_seq_protocolo,
	substr(obter_cnes_estab(a.cd_estabelecimento),1,7) c_cnes, 
	' ' c_exame, 
	upper(substr(obter_nome_pf(c.cd_pessoa_fisica),1,70)) c_id_nome, 
	upper(substr(obter_compl_pf(c.cd_pessoa_fisica,5,'N'),1,60)) c_id_nomemae, 
	' ' c_id_apel, 
	obter_dados_pf(c.cd_pessoa_fisica,'DN') d_id_dtnasc, 
	substr(obter_dados_pf(c.cd_pessoa_fisica,'RG'),1,12) c_id_ident, 
	substr(obter_dados_pf(c.cd_pessoa_fisica,'O'),1,5) c_id_emis, 
	' ' c_id_ufide, 
	substr(obter_dados_pf(c.cd_pessoa_fisica,'CPF'),1,11) c_id_cic, 
	CASE WHEN obter_dados_pf(c.cd_pessoa_fisica,'GI')='Analfabeto' THEN '1' WHEN obter_dados_pf(c.cd_pessoa_fisica,'GI')='Primeiro Grau Incompleto' THEN '2' WHEN obter_dados_pf(c.cd_pessoa_fisica,'GI')='Primeiro Grau' THEN '3' WHEN obter_dados_pf(c.cd_pessoa_fisica,'GI')='Segundo Grau' THEN '4' WHEN obter_dados_pf(c.cd_pessoa_fisica,'GI')='Superior' THEN '5'  ELSE '0' END  c_id_esco, 
	upper(substr(obter_compl_pf(c.cd_pessoa_fisica,1,'EN'),1,35)) c_id_endereco, 
	substr(obter_compl_pf(c.cd_pessoa_fisica,1,'NR'),1,6) c_id_numero, 
	upper(substr(obter_compl_pf(c.cd_pessoa_fisica,1,'CO'),1,15)) c_id_complem, 
	upper(substr(obter_compl_pf(c.cd_pessoa_fisica,1,'B'),1,15)) c_id_bairro, 
	upper(substr(obter_compl_pf(c.cd_pessoa_fisica,1,'UF'),1,2)) c_id_uf, 
	substr(obter_compl_pf(c.cd_pessoa_fisica,1,'CDM'),1,7) c_ibge, 
	substr(obter_compl_pf(c.cd_pessoa_fisica,1,'CEP'),1,8) c_id_cep, 
	' ' c_id_refe, 
	substr(obter_compl_pf(c.cd_pessoa_fisica,1,'T'),1,11) c_id_fone, 
	substr(obter_dados_pf(c.cd_pessoa_fisica,'CNS'),1,11) c_id_sus, 
	substr(obter_compl_pj(obter_cgc_estabelecimento(a.cd_estabelecimento),2,'UF'),1,2) c_us_uf, 
	substr(obter_compl_pj(obter_cgc_estabelecimento(a.cd_estabelecimento),2,'IBGE'),1,7) c_us_ibge, 
	substr(obter_cnes_estab(a.cd_estabelecimento),1,7) c_us_cnes, 
	substr(obter_nome_pf_pj(null,obter_cgc_estabelecimento(a.cd_estabelecimento)),1,40) c_us_nome, 
	obter_prontuario_paciente(c.cd_pessoa_fisica) c_pron, 
	CASE WHEN d.ie_nodulo='D' THEN '3' WHEN d.ie_nodulo='E' THEN '3' WHEN d.ie_nodulo='A' THEN '3' WHEN d.ie_nodulo='N' THEN '1'  ELSE 'O' END  c_anm_achou, 
	CASE WHEN d.ie_nodulo='D' THEN '3'  ELSE 'O' END  c_anm_achou_md, 
	CASE WHEN d.ie_nodulo='E' THEN '3'  ELSE 'O' END  c_anm_achou_me, 
	CASE WHEN d.ie_gravida_amamentando='N' THEN '1' WHEN d.ie_gravida_amamentando='S' THEN '3' WHEN d.ie_gravida_amamentando='X' THEN '2'  ELSE '0' END  c_anm_grav, 
	CASE WHEN d.ie_risco_cancer='N' THEN '1' WHEN d.ie_risco_cancer='S' THEN '3' WHEN d.ie_risco_cancer='X' THEN '2'  ELSE '0' END  c_anm_tcanc, 
	CASE WHEN e.ie_descarga_papilar='C' THEN '1' WHEN e.ie_descarga_papilar='H' THEN '2'  ELSE '0' END  c_cli_desc, 
	CASE WHEN e.ie_nodulo='S' THEN '1' WHEN e.ie_nodulo='C' THEN '2' WHEN e.ie_nodulo='SC' THEN '3'  ELSE '0' END  c_cli_nodu, 
	CASE WHEN e.ie_localizacao='PA' THEN '10' WHEN e.ie_localizacao='QII' THEN '4' WHEN e.ie_localizacao='QIM' THEN '3' WHEN e.ie_localizacao='QSL' THEN '2' WHEN e.ie_localizacao='QSM' THEN '1' WHEN e.ie_localizacao='RRA' THEN '9' WHEN e.ie_localizacao='UQinf' THEN '8' WHEN e.ie_localizacao='UQLat' THEN '5' WHEN e.ie_localizacao='UQMed' THEN '7' WHEN e.ie_localizacao='UQSup' THEN '6'  ELSE '0' END  c_cli_local, 
	CASE WHEN e.ie_tumor_residual='S' THEN '3' WHEN e.ie_tumor_residual='N' THEN '1'  ELSE '0' END  c_cli_ttum, 
	CASE WHEN e.ie_tumor_solido='S' THEN '3' WHEN e.ie_tumor_solido='N' THEN '1'  ELSE '0' END  c_cli_tsol, 
	CASE WHEN e.ie_material_enviado='MD' THEN '1' WHEN e.ie_material_enviado='ME' THEN '2'  ELSE '0' END  c_cli_matmam, 
	CASE WHEN e.ie_tipo_material_enviado='DE' THEN '1' WHEN e.ie_tipo_material_enviado='PU' THEN '2' WHEN e.ie_tipo_material_enviado='CO' THEN '3'  ELSE '0' END  c_cli_matdpc, 
	to_char(e.qt_laminas_enviadas) c_cli_nlam, 
	CASE WHEN f.ie_localizacao='MD' THEN '1' WHEN f.ie_localizacao='ME' THEN '2'  ELSE '0' END  c_res_loc, 
	to_char(f.nr_material_recebido) c_res_numl, 
	CASE WHEN f.ie_adequabilidade='S' THEN '1' WHEN f.ie_adequabilidade='I' THEN '2'  ELSE '0' END  c_res_adeq, 
	substr(f.ds_insatisfatorio,1,40) c_res_insap, 
	coalesce(to_char(f.ie_processos),'0') c_res_benig, 
	substr(f.ds_outros_processos,1,40) c_res_bem_out, 
	coalesce(to_char(f.ie_padrao_cito_malignidade),'0') c_res_mali_ind, 
	substr(f.ds_outros_cito_malig,1,40) c_res_mali_ind_out, 
	CASE WHEN f.ie_padrao_positivo=1 THEN '1' WHEN f.ie_padrao_positivo=2 THEN '2' WHEN f.ie_padrao_positivo=3 THEN '3'  ELSE '0' END  c_res_pos_mali, 
	substr(f.ds_outros_positivo,1,40) c_res_mali_out, 
	CASE WHEN f.ie_padrao_suspeito=1 THEN '1' WHEN f.ie_padrao_suspeito=2 THEN '2'  ELSE '0' END  c_res_sus_mali, 
	substr(f.ds_outros_suspeito,1,40) c_res_sus_out, 
	CASE WHEN f.ie_padrao_amostra=1 THEN '1' WHEN f.ie_padrao_amostra=2 THEN '2' WHEN f.ie_padrao_amostra=3 THEN '3' WHEN f.ie_padrao_amostra=4 THEN '4' WHEN f.ie_padrao_amostra=5 THEN '5' WHEN f.ie_padrao_amostra=6 THEN '7'  ELSE '0' END  c_res_der_papi, 
	substr(f.ds_observacao,1,100) c_observ, 
	e.dt_coleta d_col_us, 
	f.dt_recebimento d_recebe, 
	f.dt_liberacao d_libera, 
	substr(obter_dados_pf(a.cd_profissional,'CNS'),1,15) c_pat_cns, 
	substr(obter_dados_pf(a.cd_profissional,'CPF'),1,11) c_pat_cic, 
	CASE WHEN Obter_Sexo_PF(c.cd_pessoa_fisica,'C')='F' THEN '2' WHEN Obter_Sexo_PF(c.cd_pessoa_fisica,'C')='M' THEN '1'  ELSE '0' END  c_id_sexo, 
	CASE WHEN obter_dados_pf(c.cd_pessoa_fisica,'CP')='Amarela' THEN '04' WHEN obter_dados_pf(c.cd_pessoa_fisica,'CP')='Branca' THEN '01' WHEN obter_dados_pf(c.cd_pessoa_fisica,'CP')='Indio' THEN '05' WHEN obter_dados_pf(c.cd_pessoa_fisica,'CP')='Negra' THEN '02' WHEN obter_dados_pf(c.cd_pessoa_fisica,'CP')='Parda' THEN '03' WHEN obter_dados_pf(c.cd_pessoa_fisica,'CP')='Sem informação' THEN '99' END  c_id_racacor 
FROM	sismama_cit_resultados f, 
	sismama_cit_exame_clinico e, 
	sismama_cit_anamnese d, 
	atendimento_paciente c, 
	conta_paciente b, 
	sismama_atendimento a 
where	a.nr_atendimento = b.nr_atendimento 
and	b.nr_atendimento = c.nr_atendimento 
and	a.nr_sequencia = d.nr_seq_sismama 
and	a.nr_sequencia = e.nr_seq_sismama 
and	a.nr_sequencia = f.nr_seq_sismama;

