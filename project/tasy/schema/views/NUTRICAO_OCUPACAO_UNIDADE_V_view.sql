-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW nutricao_ocupacao_unidade_v (nr_atendimento, cd_setor_atendimento) AS select 	a.nr_atendimento,
    	a.cd_setor_atendimento 
FROM atend_paciente_unidade u, valor_dominio g, pessoa_fisica e, atendimento_paciente b
LEFT OUTER JOIN medico d ON (b.cd_medico_resp = d.cd_pessoa_fisica)
, unidade_atendimento a
LEFT OUTER JOIN pessoa_fisica f ON (a.cd_paciente_reserva = f.cd_pessoa_fisica)
WHERE a.nr_atendimento   = b.nr_atendimento and b.cd_pessoa_fisica  = e.cd_pessoa_fisica and u.nr_atendimento   = b.nr_atendimento and u.nr_Seq_interno = (	select 	max(x.nr_seq_interno) 
				from 	atend_paciente_unidade x 
				where 	x.nr_Atendimento = a.nr_Atendimento 
				and	a.cd_Setor_atendimento	= x.cd_setor_Atendimento 
				and 	a.cd_unidade_basica	 = x.cd_unidade_basica 
				and 	a.cd_unidade_compl	= x.cd_unidade_Compl)  and a.ie_situacao     = 'A' and a.ie_status_unidade  = 'P'    
union
 
select a.nr_atendimento_acomp, 
	a.cd_setor_atendimento 
FROM atend_paciente_unidade u, valor_dominio g, pessoa_fisica f, pessoa_fisica e, unidade_atendimento a, atendimento_paciente b
LEFT OUTER JOIN medico d ON (b.cd_medico_resp = d.cd_pessoa_fisica)
WHERE a.nr_atendimento_acomp= b.nr_atendimento and b.cd_pessoa_fisica  = e.cd_pessoa_fisica and u.nr_atendimento   = b.nr_atendimento  and a.ie_situacao     = 'A' and a.ie_status_unidade  = 'M' and a.cd_paciente_reserva = f.cd_pessoa_fisica   and u.nr_seq_interno = Obter_Atepacu_paciente(b.nr_atendimento, 'IAA') 
 
union
 
select a.nr_atendimento, 
    a.cd_setor_atendimento 
from 	valor_dominio b, 
	pessoa_fisica f, 
	unidade_atendimento a 
where a.cd_paciente_reserva = f.cd_pessoa_fisica 
 and a.ie_situacao     = 'A' 
 and a.ie_status_unidade  in ('R','H','G','A','E','C','O') 
 and b.cd_dominio 		= 82 
 and b.vl_dominio		= a.ie_status_unidade 

union
 
select a.nr_atendimento, 
    a.cd_setor_atendimento 
from valor_dominio b, 
	unidade_atendimento a 
where a.ie_situacao     = 'A' 
 and a.ie_status_unidade in ('R','L', 'H', 'G', 'A','O','E','C') 
 and a.cd_paciente_reserva is null 
 and b.cd_dominio 		= 82 
 and b.vl_dominio		= a.ie_status_unidade 

union
 
select a.nr_atendimento, 
    a.cd_setor_atendimento 
FROM motivo_interdicao_leito b, unidade_atendimento a 
WHERE a.ie_status_unidade in ('I','S')  and a.ie_situacao = 'A';

