-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW nom_morte_fetal_v (nr_atendimento, nr_atendimento_mae, nr_folio, nr_folio_control, ie_sexo_prod, qt_idade_prod, qt_peso_prod, qt_fetos, ie_pre_natal, qt_consultas, ie_risco_gravidez, ie_tipo_nascimento, qt_textura_pele, ie_necropcia, nr_dia_nascimento, nr_mes_nascimento, nr_ano_nascimento, nr_hora_nascimento, nr_min_nascimento, cd_tipo_vialidad_estab, ds_endereco_prod, ds_bairro_prod, nr_interior_estab, nr_exterior_estab, cd_tipo_asentamiento_estab, cd_asentamiento_estab, cd_codigo_postal_estab, cd_localidade_prod, cd_municipio_prod, cd_estado_prod, ie_tipo_inst_saude_prod, ds_estab_saude, cd_pro_clues, cd_atend_parto_mf, ie_embarazo_esp_assis, qt_abortos_esp, qt_abortos_prov, qt_abortos_terap, ie_tipo_parto_prod, ie_parto_normal, ie_parto_cesaria, ie_parto_forceps, ds_espec_parto, ie_agressao, ie_parentesco_agressor, ds_anomalia1, cd_anomalia1, ds_anomalia2, cd_anomalia2, cd_cie10_causa_basica, nm_usuario_registro, dt_registro, nm_usuario_modificacao, dt_modificacao, ie_tipo_certif_obt, cd_estado_capt_cert, madnombre, madapepater, madapemater, cd_curp_mae, cd_nacionalidade_mae, ds_nacionalidade_mae, nr_seq_lingua_indig_mae, qt_idade_mae, ie_estado_civil_mae, cd_tipo_vialidad_mae, ds_endereco_mae, ds_bairro_mae, nr_exterior_mae, nr_interior_mae, cd_tipo_asentamiento_mae, cd_asentamiento_mae, cd_codigo_postal_mae, cd_localidade_mae, cd_municipio_mae, cd_estado_mae, nr_telefone_mae, cd_cargo_mae, ie_trabalha_mae, qt_gestacoes, qt_filhos_vivos, qt_natimortos, qt_sobreviventes, ie_grau_instrucao, cd_der_fetal, nr_spss_madre, ie_sobrevive_mae, nr_folio_def_mae, nr_seq_indic_cesarea, tipoprocedimientoexpparto_tpr, ds_espec_parto_field, nr_seq_person_name_mae, cd_cie10_causa_a, ds_cie10_causa_a, ie_tipo_resp_causa_a, cd_cie10_causa_b, ds_cie10_causa_b, ie_tipo_resp_causa_b, cd_cie10_causa_c, ds_cie10_causa_c, ie_tipo_resp_causa_c, cd_cie10_causa_d, ds_cie10_causa_d, ie_tipo_resp_causa_d, cd_cie10_causa_e, ds_cie10_causa_e, ie_tipo_resp_causa_e, cd_cie10_causa_f, ds_cie10_causa_f, ie_tipo_resp_causa_f, nr_seq_person_name_inf, pro_apecertinf, pro_apemcertinf, cd_grau_parentesco_inf, cd_cert_parto_mf_inf, ds_espc_cert, ds_codigo_prof_certif, nr_seq_person_name_cert, cernombcertifi, pro_apecertifi, pro_apemcertifi, cd_tipo_vialidad_cert, ds_endereco_certif, nr_exterior_cert, nr_interior_cert, cd_tipo_asentamiento_cert, cd_asentamiento_cert, cd_codigo_postal_cert, ds_bairro_certif, cd_localidade_certif, cd_municipio_certif, cd_estado_certif, nr_telefone_certif, ie_assinou_cert_obito, nr_dia_certificacao, nr_mes_certificacao, nr_ano_certificacao, dt_obito) AS SELECT	a.nr_atendimento,
	a.nr_atendimento_mae,
	a.NR_FOLIO,
	a.NR_FOLIO_CONTROL,
	a.IE_SEXO_PROD,
	coalesce(a.QT_IDADE_PROD, '88') QT_IDADE_PROD,
	coalesce(a.QT_PESO_PROD,'999') QT_PESO_PROD,
	a.QT_FETOS,		
	a.IE_PRE_NATAL,
	CASE WHEN a.QT_CONSULTAS='0' THEN  '00'  ELSE a.QT_CONSULTAS END  QT_CONSULTAS,
	a.IE_RISCO_GRAVIDEZ,
	a.IE_TIPO_NASCIMENTO,
	a.QT_TEXTURA_PELE,
	a.IE_NECROPCIA,
	coalesce(a.NR_DIA_NASCIMENTO, '99') NR_DIA_NASCIMENTO,
	coalesce(a.NR_MES_NASCIMENTO, '99') NR_MES_NASCIMENTO,
	coalesce(a.NR_ANO_NASCIMENTO, '9999') NR_ANO_NASCIMENTO,
	coalesce(a.NR_HORA_NASCIMENTO, '99') NR_HORA_NASCIMENTO,
	coalesce(a.NR_MIN_NASCIMENTO, '99') NR_MIN_NASCIMENTO,
	lpad(coalesce(obter_conversao_catalogo_nom('MUERTES_FETALES','TIPO_LOGRAD','A',a.CD_TIPO_VIALIDAD_ESTAB),'99'),2,'0') CD_TIPO_VIALIDAD_ESTAB,
	substr(Upper(Elimina_Acentuacao(a.DS_ENDERECO_PROD)),1,50) DS_ENDERECO_PROD,
	substr(Upper(Elimina_Acentuacao(a.DS_BAIRRO_PROD)),1,50) DS_BAIRRO_PROD,
	a.NR_INTERIOR_ESTAB,
	a.NR_EXTERIOR_ESTAB,
	lpad(coalesce(obter_conversao_catalogo_nom('MUERTES_FETALES','TIPO_BAIRRO','A',a.CD_TIPO_ASENTAMIENTO_ESTAB),'99'),2,'0') CD_TIPO_ASENTAMIENTO_ESTAB,
	a.CD_ASENTAMIENTO_ESTAB,
	a.CD_CODIGO_POSTAL_ESTAB,
	lpad(coalesce(obter_conversao_catalogo_nom('MUERTES_FETALES','LOCALIDADE_AREA','A',a.CD_LOCALIDADE_PROD),''),4,'0') CD_LOCALIDADE_PROD,
	lpad(coalesce(obter_conversao_catalogo_nom('MUERTES_FETALES','MUNICIPIO','A',a.CD_MUNICIPIO_PROD),''),3,'0') CD_MUNICIPIO_PROD,
	lpad(coalesce(obter_conversao_catalogo_nom('MUERTES_FETALES','ESTADO_PROVINCI','A',a.CD_ESTADO_PROD),''),2,'0') CD_ESTADO_PROD,
	a.IE_TIPO_INST_SAUDE_PROD,
	upper(substr(DS_ESTAB_SAUDE,1,150)) DS_ESTAB_SAUDE,
	substr(a.CD_PRO_CLUES,1,11) CD_PRO_CLUES,
	coalesce(a.CD_ATEND_PARTO_MF,'9') CD_ATEND_PARTO_MF,
	a.IE_EMBARAZO_ESP_ASSIS,
	a.QT_ABORTOS_ESP QT_ABORTOS_ESP,
	a.QT_ABORTOS_PROV QT_ABORTOS_PROV,
	a.QT_ABORTOS_TERAP QT_ABORTOS_TERAP,
	CASE WHEN a.IE_TIPO_PARTO_PROD='0' THEN '1'  ELSE '2' END  IE_TIPO_PARTO_PROD,
	a.IE_PARTO_NORMAL IE_PARTO_NORMAL,
	a.IE_PARTO_CESARIA IE_PARTO_CESARIA,
	a.IE_PARTO_FORCEPS IE_PARTO_FORCEPS,
	upper(substr(Elimina_Acentuacao(a.DS_ESPEC_PARTO),1,50)) DS_ESPEC_PARTO,
	a.IE_AGRESSAO IE_AGRESSAO,
	coalesce(a.IE_PARENTESCO_AGRESSOR,'99') IE_PARENTESCO_AGRESSOR,
	upper(coalesce(DS_ANOMALIA1, 'NINGUNA APARENTE')) DS_ANOMALIA1, 
	coalesce(CD_ANOMALIA1, '0000') CD_ANOMALIA1,
	upper(coalesce(DS_ANOMALIA2, 'NINGUNA APARENTE')) DS_ANOMALIA2, 
	coalesce(CD_ANOMALIA2, '0000') CD_ANOMALIA2,
 	a.CD_CIE10_CAUSA_BASICA CD_CIE10_CAUSA_BASICA,	
	substr(a.NM_USUARIO_REGISTRO, 1, 10) NM_USUARIO_REGISTRO,
	coalesce(a.DT_REGISTRO,LOCALTIMESTAMP) DT_REGISTRO,
	substr(a.NM_USUARIO_MODIFICACAO, 1, 10) NM_USUARIO_MODIFICACAO,
	coalesce(a.DT_MODIFICACAO,LOCALTIMESTAMP) DT_MODIFICACAO,
	coalesce(a.IE_TIPO_CERTIF_OBT,'0') IE_TIPO_CERTIF_OBT,
	lpad(coalesce(obter_conversao_catalogo_nom('MUERTES_FETALES','ESTADO_PROVINCI','A',a.CD_ESTADO_CAPT_CERT),''),2,'0') CD_ESTADO_CAPT_CERT,
	upper(coalesce(b.ds_given_name,'SE IGNORA')) MADNOMBRE,
	upper(coalesce(b.ds_family_name,'SE IGNORA')) MADAPEPATER,
	upper(coalesce(b.ds_component_name_1,'SE IGNORA')) MADAPEMATER,	
	coalesce(a.CD_CURP_MAE,'NO ESPECIFICADO') CD_CURP_MAE,
	coalesce(a.CD_NACIONALIDADE_MAE,'9') CD_NACIONALIDADE_MAE,
	upper(a.DS_NACIONALIDADE_MAE) DS_NACIONALIDADE_MAE,
	(CASE WHEN a.NR_SEQ_LINGUA_INDIG_MAE IS NOT NULL THEN '1' ELSE '9' END) NR_SEQ_LINGUA_INDIG_MAE,
	a.QT_IDADE_MAE QT_IDADE_MAE,
	a.IE_ESTADO_CIVIL_MAE IE_ESTADO_CIVIL_MAE,
	lpad(coalesce(obter_conversao_catalogo_nom('MUERTES_FETALES','TIPO_LOGRAD','A',a.CD_TIPO_VIALIDAD_MAE),'99'),2,'0') CD_TIPO_VIALIDAD_MAE,
	upper(CASE WHEN coalesce(a.DS_ENDERECO_MAE,'NO ESPECIFICADO')='NO ESPECIFICADO' THEN 'NO ESPECIFICADO'  ELSE a.DS_ENDERECO_MAE END ) DS_ENDERECO_MAE,
	upper(coalesce(UPPER(Elimina_Acentuacao(a.DS_BAIRRO_MAE)),'NO ESPECIFICADO')) DS_BAIRRO_MAE,
	coalesce(a.NR_EXTERIOR_MAE, 'SE IGNORA') NR_EXTERIOR_MAE,
	coalesce(a.NR_INTERIOR_MAE, 'SE IGNORA') NR_INTERIOR_MAE,
	lpad(coalesce(obter_conversao_catalogo_nom('MUERTES_FETALES','TIPO_BAIRRO','A',a.CD_TIPO_ASENTAMIENTO_MAE), '46'),2,'0') CD_TIPO_ASENTAMIENTO_MAE,
	a.CD_ASENTAMIENTO_MAE,
	a.CD_CODIGO_POSTAL_MAE,
	coalesce(obter_conversao_catalogo_nom('MUERTES_FETALES','LOCALIDADE_AREA','A',a.CD_LOCALIDADE_MAE),'') CD_LOCALIDADE_MAE,
	coalesce(obter_conversao_catalogo_nom('MUERTES_FETALES','MUNICIPIO','A',a.CD_MUNICIPIO_MAE),'') CD_MUNICIPIO_MAE,
	coalesce(obter_conversao_catalogo_nom('MUERTES_FETALES','ESTADO_PROVINCI','A',a.CD_ESTADO_MAE),'') CD_ESTADO_MAE,
	(CASE WHEN a.NR_DDI_FONE_MAE='99' THEN  ''  ELSE a.NR_DDI_FONE_MAE END  || a.NR_TELEFONE_MAE) NR_TELEFONE_MAE,
	coalesce(a.CD_CARGO_MAE,'98') CD_CARGO_MAE,
	a.IE_TRABALHA_MAE,
	a.QT_GESTACOES,
	LPAD(coalesce(a.QT_FILHOS_VIVOS,'00'),2,'0') QT_FILHOS_VIVOS,
	LPAD(coalesce(a.QT_NATIMORTOS,'00'),2,'0') QT_NATIMORTOS,
	a.QT_SOBREVIVENTES,
	coalesce(a.IE_GRAU_INSTRUCAO,'99') IE_GRAU_INSTRUCAO,
	coalesce(a.CD_DER_FETAL,'00') CD_DER_FETAL,
	coalesce(a.NR_SPSS_MADRE,'NO ESPECIFICADO') NR_SPSS_MADRE,
	coalesce(a.IE_SOBREVIVE_MAE,'') IE_SOBREVIVE_MAE,
	coalesce(a.NR_FOLIO_DEF_MAE,'999999999') NR_FOLIO_DEF_MAE,
	CASE WHEN a.NR_SEQ_INDIC_CESAREA=17 THEN  '1' WHEN a.NR_SEQ_INDIC_CESAREA=18 THEN  '2' WHEN a.NR_SEQ_INDIC_CESAREA=19 THEN  '3' WHEN a.NR_SEQ_INDIC_CESAREA=20 THEN  '9'  ELSE '8' END  NR_SEQ_INDIC_CESAREA,
	case when IE_PARTO_NORMAL <> '' then  '5'
		else case when IE_PARTO_CESARIA <> '' then '1'
			else case when IE_PARTO_FORCEPS <> '' then '2'
				else '9'
			end 
		end
	end as TIPOPROCEDIMIENTOEXPPARTO_TPR,
	case when(IE_PARTO_NORMAL <> '' or IE_PARTO_CESARIA <> '' or IE_PARTO_FORCEPS <> '') then  'NO APLICA'
		else upper(DS_ESPEC_PARTO)
	end as DS_ESPEC_PARTO_FIELD,
	a.nr_seq_person_name_mae,
	CD_CIE10_CAUSA_A,
	upper(coalesce(DS_CIE10_CAUSA_A, '')) DS_CIE10_CAUSA_A, 	
	coalesce(IE_TIPO_RESP_CAUSA_A, '0') IE_TIPO_RESP_CAUSA_A, 
	CD_CIE10_CAUSA_B,
	upper(coalesce(DS_CIE10_CAUSA_B, '')) DS_CIE10_CAUSA_B, 
	coalesce(IE_TIPO_RESP_CAUSA_B, '0') IE_TIPO_RESP_CAUSA_B, 
	CD_CIE10_CAUSA_C,
	upper(coalesce(DS_CIE10_CAUSA_C, ''))  DS_CIE10_CAUSA_C,
	coalesce(IE_TIPO_RESP_CAUSA_C, '0') IE_TIPO_RESP_CAUSA_C,
	CD_CIE10_CAUSA_D,
	upper(coalesce(DS_CIE10_CAUSA_D, ''))  DS_CIE10_CAUSA_D,
	coalesce(IE_TIPO_RESP_CAUSA_D, '0')  IE_TIPO_RESP_CAUSA_D,
	CD_CIE10_CAUSA_E,
	upper(coalesce(DS_CIE10_CAUSA_E, ''))   DS_CIE10_CAUSA_E,
	coalesce(IE_TIPO_RESP_CAUSA_E, '0')  IE_TIPO_RESP_CAUSA_E,
	CD_CIE10_CAUSA_F,
	upper(coalesce(DS_CIE10_CAUSA_F, ''))  DS_CIE10_CAUSA_F,
	coalesce(IE_TIPO_RESP_CAUSA_F, '0')   IE_TIPO_RESP_CAUSA_F,	
	upper(coalesce(z.ds_given_name,'NO ESPECIFICADO')) NR_SEQ_PERSON_NAME_INF,
	upper(coalesce(z.ds_family_name,'NO ESPECIFICADO')) PRO_APECERTINF,
	upper(coalesce(z.ds_component_name_1,'NO ESPECIFICADO')) PRO_APEMCERTINF,
	lpad(coalesce(a.CD_GRAU_PARENTESCO_INF, '99'),2,'0') CD_GRAU_PARENTESCO_INF,
	coalesce(a.CD_CERT_PARTO_MF_INF,'') CD_CERT_PARTO_MF_INF,
	upper(a.DS_ESPC_CERT) DS_ESPC_CERT,
	coalesce(case when length(a.DS_CODIGO_PROF_CERTIF) < 7 then lpad(a.DS_CODIGO_PROF_CERTIF, 7, '0') else substr(a.DS_CODIGO_PROF_CERTIF, 1, 14) end, '0000000') DS_CODIGO_PROF_CERTIF,
	upper(coalesce(w.ds_given_name,'NO ESPECIFICADO')) NR_SEQ_PERSON_NAME_CERT,
	upper(coalesce(w.ds_given_name,'NO ESPECIFICADO')) CERNOMBCERTIFI,
	upper(coalesce(w.ds_family_name,'NO ESPECIFICADO')) PRO_APECERTIFI,
	upper(coalesce(w.ds_component_name_1,'NO ESPECIFICADO')) PRO_APEMCERTIFI,
	lpad(coalesce(obter_conversao_catalogo_nom('MUERTES_FETALES','TIPO_LOGRAD','A',a.CD_TIPO_VIALIDAD_CERT),'99'),2,'0') CD_TIPO_VIALIDAD_CERT,
	upper(CASE WHEN coalesce(a.DS_ENDERECO_CERTIF,'NO ESPECIFICADO')='NO ESPECIFICADO' THEN 'NO ESPECIFICADO'  ELSE a.DS_ENDERECO_CERTIF END ) DS_ENDERECO_CERTIF,
	a.NR_EXTERIOR_CERT,
	a.NR_INTERIOR_CERT,
	lpad(coalesce(obter_conversao_catalogo_nom('MUERTES_FETALES','TIPO_BAIRRO','A',a.CD_TIPO_ASENTAMIENTO_CERT),'99'),2,'0') CD_TIPO_ASENTAMIENTO_CERT,
	a.CD_ASENTAMIENTO_CERT,
	a.CD_CODIGO_POSTAL_CERT,
	upper(coalesce(a.DS_BAIRRO_CERTIF,'NO ESPECIFICADO')) DS_BAIRRO_CERTIF,
	coalesce(obter_conversao_catalogo_nom('MUERTES_FETALES','LOCALIDADE_AREA','A',a.CD_LOCALIDADE_CERTIF),'') CD_LOCALIDADE_CERTIF,
	coalesce(obter_conversao_catalogo_nom('MUERTES_FETALES','MUNICIPIO','A',a.CD_MUNICIPIO_CERTIF),'') CD_MUNICIPIO_CERTIF,
	coalesce(obter_conversao_catalogo_nom('MUERTES_FETALES','ESTADO_PROVINCI','A',a.CD_ESTADO_CERTIF),'') CD_ESTADO_CERTIF,
	coalesce(a.NR_TELEFONE_CERTIF,'8888888888') NR_TELEFONE_CERTIF,
	coalesce(a.IE_ASSINOU_CERT_OBITO,'1') IE_ASSINOU_CERT_OBITO,
	coalesce(a.NR_DIA_CERTIFICACAO,'99') NR_DIA_CERTIFICACAO,
	coalesce(a.NR_MES_CERTIFICACAO,'99') NR_MES_CERTIFICACAO,
	coalesce(a.NR_ANO_CERTIFICACAO,'9999') NR_ANO_CERTIFICACAO,
	DT_OBITO DT_OBITO
FROM guia_morte_fetal_noms a
LEFT OUTER JOIN person_name b ON (a.nr_seq_person_name_mae = b.nr_sequencia)
LEFT OUTER JOIN person_name w ON (a.nr_seq_person_name_cert = w.nr_sequencia AND 'main' = w.ds_type)
LEFT OUTER JOIN person_name z ON (a.nr_seq_person_name_inf = z.nr_sequencia AND 'main' = z.ds_type)
WHERE b.ds_type = 'main'   and a.dt_liberacao is not null;

