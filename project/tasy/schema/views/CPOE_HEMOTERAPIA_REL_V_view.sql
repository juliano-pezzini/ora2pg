-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW cpoe_hemoterapia_rel_v (ds_hemocomponente, dt_programada, ds_fim, dt_lib_suspensao, dt_inicio, dt_fim, nr_sequencia, nr_atendimento, ds_indicacao, ds_justificativa, ds_observacao, nm_medicamento1, nm_reconstituicao1, nm_diluicao1, ds_observacao_mat1, nm_medicamento2, nm_reconstituicao2, nm_diluicao2, ds_observacao_mat2, nm_medicamento3, nm_reconstituicao3, nm_diluicao3, ds_observacao_mat3, nm_medicamento4, nm_reconstituicao4, nm_diluicao4, ds_observacao_mat4, nm_medicamento5, nm_reconstituicao5, nm_diluicao5, ds_observacao_mat5, ds_horarios, dt_liberacao_enf, nm_usuario_nrec) AS select	substr(cpoe_obter_hemo_rel(ie_tipo_hemoterap, nr_seq_derivado, a.cd_procedimento),1,255)  ||' '|| cpoe_obter_comp_hemo_rel(ie_tipo_hemoterap,cd_intervalo,qt_procedimento, qt_hora_min_infusao, a.ie_via_aplicacao, ie_reserva, ie_tipo, a.qt_vol_hemocomp,a.ie_aliquotado, a.ie_filtrado, a.ie_irradiado, a.ie_lavado, a.ie_fenotipado)  ds_hemocomponente,
		dt_programada,
		CASE WHEN a.dt_fim='' THEN obter_desc_expressao(689989, '')  ELSE to_char(a.dt_fim,'dd/mm/yyyy hh:mi:ss') END  ds_fim,
		coalesce(a.dt_lib_suspensao,null) dt_lib_suspensao,
		dt_inicio,
		dt_fim,
		nr_sequencia,
		nr_atendimento,
		CASE WHEN nr_seq_indicacao1 IS NULL THEN CASE WHEN nr_seq_indicacao2 IS NULL THEN null  ELSE obter_desc_expressao(291834, '') END   ELSE obter_desc_expressao(291834, '') END  || ': ' ||  substr(obter_indicacao_clinica_hem(nr_seq_indicacao1),1,255) ||' , ' ||  substr(obter_indicacao_clinica_hem(nr_seq_indicacao2),1,255) ds_indicacao,
		CASE WHEN ds_justificativa IS NULL THEN null  ELSE substr(substr(obter_desc_expressao(341044, ''),1,70) || ' ' ||  substr(ds_justificativa,1,3900),1,4000) END  ds_justificativa,
		CASE WHEN ds_observacao IS NULL THEN null  ELSE substr(obter_desc_expressao(329252, ''),1,255) || ' ' || substr(ds_observacao,1,3500) END  ds_observacao,
		CASE WHEN a.cd_mat_hem1 IS NULL THEN  null  ELSE substr(obter_desc_material(cd_mat_hem1),1,255) ||' '|| cpoe_obter_comp_mat_rel('P', null, qt_dose_hem1, cd_unid_medida_dose_hem1, ie_adm_mat_hem1, null, null, cd_interv_hem1 , ie_via_mat_hem1, null, null) END  nm_medicamento1,
		CASE WHEN a.cd_mat_recons1 IS NULL THEN  null  ELSE substr(obter_desc_material(cd_mat_recons1),1,255) ||' '|| cpoe_obter_comp_mat_rel('P', null, qt_dose_rec1, cd_unid_med_rec1, null, null, null, null , null, null, null) END  nm_reconstituicao1,
		CASE WHEN a.cd_mat_dil1 IS NULL THEN  null  ELSE substr(obter_desc_material(cd_mat_dil1),1,255) ||' '|| cpoe_obter_comp_mat_rel('P', null, qt_dose_dil1, cd_unid_med_dose_dil1, null, null, null, null , null, null, null) END  nm_diluicao1,
		CASE WHEN a.ds_observacao_mat1 IS NULL THEN  null  ELSE substr(obter_desc_expressao(329252, ''),1,255) || ' ' || substr(ds_observacao_mat1,1,3500) END  ds_observacao_mat1,
		CASE WHEN a.cd_mat_hem2 IS NULL THEN  null  ELSE substr(obter_desc_material(cd_mat_hem2),1,255) ||' '|| cpoe_obter_comp_mat_rel('P', null, qt_dose_hem2, cd_unid_medida_dose_hem2, ie_adm_mat_hem2, null, null, cd_interv_hem2 , ie_via_mat_hem2, null, null) END  nm_medicamento2,
		CASE WHEN a.cd_mat_recons2 IS NULL THEN  null  ELSE substr(obter_desc_material(cd_mat_recons2),1,255) ||' '|| cpoe_obter_comp_mat_rel('P', null, qt_dose_rec2, cd_unid_med_rec2, null, null, null, null , null, null, null) END  nm_reconstituicao2,
		CASE WHEN a.cd_mat_dil2 IS NULL THEN  null  ELSE substr(obter_desc_material(cd_mat_dil2),1,255) ||' '|| cpoe_obter_comp_mat_rel('P', null, qt_dose_dil2, cd_unid_med_dose_dil2, null, null, null, null , null, null, null) END  nm_diluicao2,
		CASE WHEN a.ds_observacao_mat2 IS NULL THEN  null  ELSE substr(obter_desc_expressao(329252, ''),1,255) || ' ' || substr(ds_observacao_mat2,1,3500) END  ds_observacao_mat2,
		CASE WHEN a.cd_mat_hem3 IS NULL THEN  null  ELSE substr(obter_desc_material(cd_mat_hem3),1,255) ||' '|| cpoe_obter_comp_mat_rel('P', null, qt_dose_hem3, cd_unid_medida_dose_hem3, ie_adm_mat_hem3, null, null, cd_interv_hem3 , ie_via_mat_hem3, null, null) END  nm_medicamento3,
		CASE WHEN a.cd_mat_recons3 IS NULL THEN  null  ELSE substr(obter_desc_material(cd_mat_recons3),1,255) ||' '|| cpoe_obter_comp_mat_rel('P', null, qt_dose_rec3, cd_unid_med_rec3, null, null, null, null , null, null, null) END  nm_reconstituicao3,
		CASE WHEN a.cd_mat_dil3 IS NULL THEN  null  ELSE substr(obter_desc_material(cd_mat_dil3),1,255) ||' '|| cpoe_obter_comp_mat_rel('P', null, qt_dose_dil3, cd_unid_med_dose_dil3, null, null, null, null , null, null, null) END  nm_diluicao3,
		CASE WHEN a.ds_observacao_mat3 IS NULL THEN  null  ELSE substr(obter_desc_expressao(329252, ''),1,255) || ' ' || substr(ds_observacao_mat3,1,3500) END  ds_observacao_mat3,
		CASE WHEN a.cd_mat_hem4 IS NULL THEN  null  ELSE substr(obter_desc_material(cd_mat_hem4),1,255) ||' '|| cpoe_obter_comp_mat_rel('P', null, qt_dose_hem4, cd_unid_medida_dose_hem4, ie_adm_mat_hem4, null, null, cd_interv_hem4 , ie_via_mat_hem4, null, null) END  nm_medicamento4,
		CASE WHEN a.cd_mat_recons4 IS NULL THEN  null  ELSE substr(obter_desc_material(cd_mat_recons4),1,255) ||' '|| cpoe_obter_comp_mat_rel('P', null, qt_dose_rec4, cd_unid_med_rec4, null, null, null, null , null, null, null) END  nm_reconstituicao4,
		CASE WHEN a.cd_mat_dil4 IS NULL THEN  null  ELSE substr(obter_desc_material(cd_mat_dil4),1,255) ||' '|| cpoe_obter_comp_mat_rel('P', null, qt_dose_dil4, cd_unid_med_dose_dil4, null, null, null, null , null, null, null) END  nm_diluicao4,
		CASE WHEN a.ds_observacao_mat4 IS NULL THEN  null  ELSE substr(obter_desc_expressao(329252, ''),1,255) || ' ' || substr(ds_observacao_mat4,1,3500) END  ds_observacao_mat4,
		CASE WHEN a.cd_mat_hem5 IS NULL THEN  null  ELSE substr(obter_desc_material(cd_mat_hem5),1,255) ||' '|| cpoe_obter_comp_mat_rel('P', null, qt_dose_hem5, cd_unid_medida_dose_hem5, ie_adm_mat_hem5, null, null, cd_interv_hem5 , ie_via_mat_hem5, null, null) END  nm_medicamento5,
		CASE WHEN a.cd_mat_recons5 IS NULL THEN  null  ELSE substr(obter_desc_material(cd_mat_recons5),1,255) ||' '|| cpoe_obter_comp_mat_rel('P', null, qt_dose_rec5, cd_unid_med_rec5, null, null, null, null , null, null, null) END  nm_reconstituicao5,
		CASE WHEN a.cd_mat_dil5 IS NULL THEN  null  ELSE substr(obter_desc_material(cd_mat_dil5),1,255) ||' '|| cpoe_obter_comp_mat_rel('P', null, qt_dose_dil5, cd_unid_med_dose_dil5, null, null, null, null , null, null, null) END  nm_diluicao5,
		CASE WHEN a.ds_observacao_mat5 IS NULL THEN  null  ELSE substr(obter_desc_expressao(329252, ''),1,255) || ' ' || substr(ds_observacao_mat5,1,3500) END  ds_observacao_mat5,
		a.ds_horarios,
		a.dt_liberacao_enf,
		a.nm_usuario_nrec
FROM  	cpoe_hemoterapia a;

