-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW titulo_pagar_v2 (ie_favorecido, ie_tipo_favorecido, nr_titulo, cd_favorecido, dt_emissao, dt_vencimento_original, dt_vencimento_atual, vl_titulo, vl_saldo_titulo, vl_saldo_juros, vl_saldo_multa, nr_documento, dt_liquidacao, ie_tipo_titulo, nr_bloqueto, cd_banco_favorecido, cd_agencia_favorecido, nr_conta_favorecido, ie_dig_agencia_favorecido, ie_dig_conta_favorecido, nm_favorecido, ds_endereco, ds_bairro, ds_cidade, ds_estado, cd_cep, nr_ddd_telefone, nr_telefone, nr_ramal, dt_limite_antecipacao, nr_nosso_numero, nr_seq_rpa, nr_endereco, cd_pessoa_pf_pj) AS select /*+ INDEX (PESJURI_PK B) INDEX TITPAGA_PESJURI_FK_I) */    '1' ie_favorecido, 
	 '2' ie_tipo_favorecido, 
    a.nr_titulo, 
    a.cd_cgc cd_favorecido, 
    a.dt_emissao, 
    a.dt_vencimento_original, 
    a.dt_vencimento_atual, 
    a.vl_titulo, 
    a.vl_saldo_titulo, 
    a.vl_saldo_juros, 
    a.vl_saldo_multa, 
    a.nr_documento, 
    a.dt_liquidacao, 
    a.ie_tipo_titulo, 
	 a.nr_bloqueto, 
	 obter_conta_pessoa(a.cd_cgc,'J','B') cd_banco_favorecido, 
	 obter_conta_pessoa(a.cd_cgc,'J','A') cd_agencia_favorecido, 
	 obter_conta_pessoa(a.cd_cgc,'J','C') nr_conta_favorecido, 
	 obter_conta_pessoa(a.cd_cgc,'J','AD') ie_dig_agencia_favorecido, 
	 obter_conta_pessoa(a.cd_cgc,'J','CD') ie_dig_conta_favorecido, 
    b.ds_razao_social nm_favorecido, 
	 b.ds_endereco, 
	 b.ds_bairro, 
	 b.ds_municipio ds_cidade, 
	 b.sg_estado ds_estado, 
	 b.cd_cep, 
	 0000 nr_ddd_telefone, 
	 b.nr_telefone, 
	 (obter_dados_pf_pj_estab(a.cd_estabelecimento, null, a.cd_cgc, 'ENR'))::numeric  nr_ramal, 
	 a.dt_limite_antecipacao, 
	 a.nr_nosso_numero, 
	 nr_seq_rpa, 
	somente_numero(b.nr_endereco) nr_endereco, 
	b.cd_cgc cd_pessoa_pf_pj 
FROM 	pessoa_juridica b, 
	titulo_pagar a   
where a.ie_situacao = 'A' 
 and a.cd_cgc = b.cd_cgc 

union
 
select /*+ INDEX (PESFISI_PK B) INDEX TITPAGA_PESFISI_FK_I) */ 
   '2' ie_favorecido, 
	 '1' ie_tipo_favorecido, 
    a.nr_titulo, 
    b.nr_cpf cd_favorecido, 
    a.dt_emissao, 
    a.dt_vencimento_original, 
    a.dt_vencimento_atual, 
    a.vl_titulo, 
    a.vl_saldo_titulo, 
    a.vl_saldo_juros, 
    a.vl_saldo_multa, 
    a.nr_documento, 
    a.dt_liquidacao, 
    a.ie_tipo_titulo, 
	 a.nr_bloqueto, 
	 obter_conta_pessoa(b.cd_pessoa_fisica,'F','B') cd_banco_favorecido, 
	 obter_conta_pessoa(b.cd_pessoa_fisica,'F','A') cd_agencia_favorecido, 
	 obter_conta_pessoa(b.cd_pessoa_fisica,'F','C') nr_conta_favorecido, 
	 obter_conta_pessoa(b.cd_pessoa_fisica,'F','AD') ie_dig_agencia_favorecido, 
	 obter_conta_pessoa(b.cd_pessoa_fisica,'F','CD') ie_dig_conta_favorecido, 
    substr(obter_nome_pf(b.cd_pessoa_fisica),1,255) nm_favorecido, 
	 c.ds_endereco, 
	 c.ds_bairro, 
	 c.ds_municipio ds_cidade, 
	 c.sg_estado ds_estado, 
	 c.cd_cep, 
	 0000 nr_ddd_telefone, 
	 c.nr_telefone, 
	 c.nr_ramal nr_ramal, 
	 a.dt_limite_antecipacao, 
	 a.nr_nosso_numero, 
	 a.nr_seq_rpa, 
	c.nr_endereco, 
	b.cd_pessoa_fisica cd_pessoa_pf_pj 
FROM titulo_pagar a, pessoa_fisica b
LEFT OUTER JOIN compl_pessoa_fisica c ON (b.cd_pessoa_fisica = c.cd_pessoa_fisica)
WHERE a.ie_situacao = 'A' and a.cd_pessoa_fisica = b.cd_pessoa_fisica;

