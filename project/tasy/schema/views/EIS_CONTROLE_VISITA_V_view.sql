-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_controle_visita_v (qt_ocorrencia, cd_pessoa_fisica, ie_dia_semana, ie_hora, nr_atendimento, dt_entrada, ds_tipo_pessoa, nr_seq_tipo, ds_setor_atendimento, cd_setor_atendimento, ds_pernoite, ie_sexo_visitante, ds_faixa_etaria, cd_idade, ds_dia_semana, ie_clinica, ds_clinica, ds_hora, cd_hora, qt_minutos_visita, ds_acomp_autor, nm_pessoa_usuario, cd_estabelecimento, cd_empresa) AS select	1 qt_ocorrencia,
	a.cd_pessoa_fisica, 
	CASE WHEN obter_dia_semana(a.dt_entrada)='Domingo' THEN 1 WHEN obter_dia_semana(a.dt_entrada)='Segunda-Feira' THEN 2 WHEN obter_dia_semana(a.dt_entrada)='Terça-Feira' THEN 3 WHEN obter_dia_semana(a.dt_entrada)='Quarta-Feira' THEN 4 WHEN obter_dia_semana(a.dt_entrada)='Quinta-Feira' THEN 5 WHEN obter_dia_semana(a.dt_entrada)='Sexta-Feira' THEN 6 WHEN obter_dia_semana(a.dt_entrada)='Sábado' THEN 7 END  ie_dia_semana, 
	eis_obter_ds_hora(lpad(to_char(a.dt_entrada,'hh24'),2,'0') || ':00') ie_hora, 
	a.nr_atendimento, 
	a.dt_entrada, 
	substr(obter_descricao_padrao('VISITANTE','DS_VISITANTE',NR_SEQ_TIPO),1,60) ds_tipo_pessoa, 
	nr_seq_tipo, 
	substr(obter_nome_setor(Obter_Setor_Atendimento(a.nr_atendimento)),1,50) ds_setor_atendimento, 
	substr(Obter_Setor_Atendimento(a.nr_atendimento),1,50) cd_setor_atendimento, 
	eis_obter_se_visita_pernoite(a.nr_sequencia) ds_pernoite, 
	substr(OBTER_SEXO_PF(a.cd_pessoa_fisica,'D'),1,20) ie_sexo_visitante, 
	eis_obter_faixa_etaria(campo_numerico(obter_dados_pf(a.cd_pessoa_fisica,'I'))) ds_faixa_etaria, 
	campo_numerico(obter_dados_pf(a.cd_pessoa_fisica,'I')) cd_idade, 
	obter_dia_semana(a.dt_entrada) ds_dia_semana, 
	ie_clinica, 
	obter_valor_dominio(17,ie_clinica) ds_clinica, 
	lpad(to_char(a.dt_entrada,'hh24'),2,'0') || ':00' ds_hora, 
	campo_numerico(to_char(a.dt_entrada,'hh24')) cd_hora, 
	obter_minutos_espera(a.dt_entrada,coalesce(a.dt_saida,LOCALTIMESTAMP)) qt_minutos_visita, 
	substr(eis_obter_pernoite_autoriz(a.nr_sequencia),1,50) ds_acomp_autor, 
	substr(OBTER_NOME_USUARIO(coalesce(a.NM_USUARIO_NREC,a.NM_USUARIO)),1,255) nm_pessoa_usuario, 
	b.cd_estabelecimento, 
	substr(OBTER_EMPRESA_ESTAB(b.cd_estabelecimento),1,10) cd_empresa 
FROM	atendimento_paciente b, 
	atendimento_visita a 
where	b.nr_atendimento	=	a.nr_atendimento;

