-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW auditoria_conta_paciente_v (ie_proc_mat, nr_interno_conta, nr_atendimento, nr_seq_auditoria, nm_paciente, qt_item, vl_item, cd_item, nr_prescricao, ds_item, dt_item, cd_convenio_parametro, cd_categoria_parametro, ie_emite_conta, ds_emite_conta) AS select	1 ie_proc_mat,
	c.nr_interno_conta nr_interno_conta, 
	c.nr_atendimento, 
	a.nr_seq_auditoria, 
	substr(obter_paciente_conta(c.nr_interno_conta,'D'),1,200) nm_paciente, 
	p.qt_procedimento qt_item, 
	p.vl_procedimento vl_item, 
	p.cd_procedimento cd_item, 
	p.nr_prescricao nr_prescricao, 
	substr(Obter_Descricao_Procedimento(p.cd_procedimento,p.ie_origem_proced),1,200) ds_item, 
	p.dt_procedimento dt_item, 
	c.cd_convenio_parametro, 
	c.cd_categoria_parametro, 
	p.ie_emite_conta, 
	substr(obter_desc_estrut_conta(somente_numero(p.ie_emite_conta)),1,120) ds_emite_conta 
FROM	conta_paciente c, 
	procedimento_paciente p, 
	auditoria_propaci a 
where	c.nr_interno_conta 	= p.nr_interno_conta 
and	a.nr_seq_propaci	= p.nr_sequencia 
and	p.cd_motivo_Exc_conta is null 

union all
 
select	2 ie_proc_mat, 
	c.nr_interno_conta nr_interno_conta, 
	c.nr_atendimento, 
	a.nr_seq_auditoria, 
	substr(obter_paciente_conta(c.nr_interno_conta,'D'),1,200) nm_paciente, 
	m.qt_material qt_item, 
	m.vl_material vl_item, 
	m.cd_material cd_item, 
	m.nr_prescricao nr_prescricao, 
	substr(Obter_Desc_Material(m.cd_material),1,200) ds_item, 
	m.dt_atendimento dt_item, 
	c.cd_convenio_parametro, 
	c.cd_categoria_parametro, 
	m.ie_emite_conta, 
	substr(obter_desc_estrut_conta(somente_numero(m.ie_emite_conta)),1,120) ds_emite_conta 
from	conta_paciente c, 
	material_atend_paciente m, 
	auditoria_matpaci a 
where	c.nr_interno_conta 	= m.nr_interno_conta 
and	a.nr_seq_matpaci 	= m.nr_sequencia 
and	m.cd_motivo_Exc_conta is null;

