-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW obter_cpoe_pos_alta_nivel_2 (ds, nr_order_unit, dt_prev_execucao, ie_tipo_item, nr_sequencia, nr_seq_cpoe_rp, nr_atendimento, dt_suspensao) AS SELECT DISTINCT(CASE WHEN cp.DT_SUSPENSAO IS NOT NULL THEN  obter_desc_expressao_idioma(782908, null, wheb_usuario_pck.get_nr_seq_idioma) || ' ' ELSE '' END) || cpoe_obter_desc_dieta_simp(cp.nr_sequencia) DS,
                cou.nr_order_unit NR_ORDER_UNIT,
                TO_DATE(cp.DT_INICIO) dt_prev_execucao,
                'N' IE_TIPO_ITEM,
                cp.nr_sequencia nr_sequencia,
                NULL nr_seq_cpoe_rp,
				cp.nr_atendimento,
				cp.DT_SUSPENSAO
FROM CPOE_DIETA cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE cp.dt_liberacao IS NOT NULL
AND	((cp.dt_fim > LOCALTIMESTAMP) or (cp.dt_fim is null))

UNION ALL

/* Medicine */

SELECT DISTINCT ((CASE WHEN cp.DT_SUSPENSAO IS NOT NULL THEN  obter_desc_expressao_idioma(782908, null, wheb_usuario_pck.get_nr_seq_idioma) || ' ' ELSE '' END) || get_cpoe_rp_description(rp.nr_sequencia, 'F')) DS,
                cou.nr_order_unit NR_ORDER_UNIT,
                TO_DATE(cp.DT_INICIO) dt_prev_execucao,
                'M' IE_TIPO_ITEM,
                NULL nr_sequencia,
                cp.nr_seq_cpoe_rp nr_seq_cpoe_rp,
				cp.nr_atendimento,
				cp.DT_SUSPENSAO
FROM CPOE_MATERIAL cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
JOIN CPOE_RP rp ON cp.nr_seq_cpoe_rp = rp.nr_sequencia
WHERE coalesce(ie_material, 'N') = 'N'
AND cp.dt_liberacao IS NOT NULL
AND	((cp.dt_fim > LOCALTIMESTAMP) or (cp.dt_fim is null))

UNION ALL
 
/* Procedure */

SELECT DISTINCT ((CASE WHEN cp.DT_SUSPENSAO IS NOT NULL THEN  obter_desc_expressao_idioma(782908, null, wheb_usuario_pck.get_nr_seq_idioma) || ' ' ELSE '' END) || Obter_Desc_Proc_Interno(cp.NR_SEQ_PROC_INTERNO) || ' - ' || Obter_desc_intervalo(cp.cd_intervalo)) DS,
                cou.nr_order_unit NR_ORDER_UNIT,
                TO_DATE(cp.dt_prev_execucao) dt_prev_execucao,
                'P' IE_TIPO_ITEM,
                cp.nr_sequencia nr_sequencia,
                NULL nr_seq_cpoe_rp,
				cp.nr_atendimento,
				cp.DT_SUSPENSAO
FROM CPOE_PROCEDIMENTO cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE cp.dt_liberacao IS NOT NULL
AND	((cp.dt_fim > LOCALTIMESTAMP) or (cp.dt_fim is null))


UNION ALL
 
/* Gastherapy */

SELECT DISTINCT(CASE WHEN cp.DT_SUSPENSAO IS NOT NULL THEN  obter_desc_expressao_idioma(782908, null, wheb_usuario_pck.get_nr_seq_idioma) || ' ' ELSE '' END) || Obter_Desc_Gas(cp.nr_seq_gas) DS,
                cou.nr_order_unit NR_ORDER_UNIT,
                TO_DATE(cp.DT_INICIO) dt_prev_execucao,
                'G' IE_TIPO_ITEM,
                cp.nr_sequencia nr_sequencia,
                NULL nr_seq_cpoe_rp,
				cp.nr_atendimento,
				cp.DT_SUSPENSAO
FROM CPOE_GASOTERAPIA cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE cp.dt_liberacao IS NOT NULL
AND	((cp.dt_fim > LOCALTIMESTAMP) or (cp.dt_fim is null))

UNION ALL
 
/* Interventions and Recommendations */

SELECT DISTINCT(CASE WHEN cp.DT_SUSPENSAO IS NOT NULL THEN  obter_desc_expressao_idioma(782908, null, wheb_usuario_pck.get_nr_seq_idioma) || ' ' ELSE '' END) || obter_desc_recomendacao(cd_recomendacao) DS,
                cou.nr_order_unit NR_ORDER_UNIT,
                TO_DATE(cp.DT_INICIO) dt_prev_execucao,
                'R' IE_TIPO_ITEM,
                cp.nr_sequencia nr_sequencia,
                NULL nr_seq_cpoe_rp,
				cp.nr_atendimento,
				cp.DT_SUSPENSAO
FROM CPOE_RECOMENDACAO cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE cp.dt_liberacao IS NOT NULL
AND	((cp.dt_fim > LOCALTIMESTAMP) or (cp.dt_fim is null))

UNION ALL
 
/* Blood and Blood Products */

SELECT DISTINCT substr((CASE WHEN cp.DT_SUSPENSAO IS NOT NULL THEN  obter_desc_expressao_idioma(782908, null, wheb_usuario_pck.get_nr_seq_idioma) || ' ' ELSE '' END) || obter_desc_prescr_proc(cp.cd_procedimento, cp.ie_origem_proced, cp.nr_seq_proc_interno), 1, 255) DS,
                cou.nr_order_unit NR_ORDER_UNIT,
                TO_DATE(cp.DT_INICIO) dt_prev_execucao,
                'H' IE_TIPO_ITEM,
                cp.nr_sequencia nr_sequencia,
                NULL nr_seq_cpoe_rp,
				cp.nr_atendimento,
				cp.DT_SUSPENSAO
FROM CPOE_HEMOTERAPIA cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE cp.dt_liberacao IS NOT NULL
AND	((cp.dt_fim > LOCALTIMESTAMP) or (cp.dt_fim is null))

UNION ALL
 
/* Dialisys */

SELECT DISTINCT substr((CASE WHEN cp.DT_SUSPENSAO IS NOT NULL THEN  obter_desc_expressao_idioma(782908, null, wheb_usuario_pck.get_nr_seq_idioma) || ' ' ELSE '' END) || CPOE_obter_desc_dialise_simp(ie_tipo_dialise, ie_hemodialise, ie_tipo_peritoneal), 1, 255) DS,
                cou.nr_order_unit NR_ORDER_UNIT,
                TO_DATE(cp.DT_INICIO) dt_prev_execucao,
                'D' IE_TIPO_ITEM,
                cp.nr_sequencia nr_sequencia,
                NULL nr_seq_cpoe_rp,
				cp.nr_atendimento,
				cp.DT_SUSPENSAO
FROM CPOE_DIALISE cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE cp.dt_liberacao IS NOT NULL
AND	((cp.dt_fim > LOCALTIMESTAMP) or (cp.dt_fim is null))

UNION ALL

/* Nursing interventions */

SELECT DISTINCT substr((CASE WHEN cp.DT_SUSPENSAO IS NOT NULL THEN  obter_desc_expressao_idioma(782908, null, wheb_usuario_pck.get_nr_seq_idioma) || ' ' ELSE '' END) || Obter_desc_intervencoes(nr_seq_proc) || ' - ' || obter_desc_intervalo_prescr(cd_intervalo), 1, 255) DS,
                cou.nr_order_unit NR_ORDER_UNIT,
                TO_DATE(cp.DT_INICIO) dt_prev_execucao,
                'I' IE_TIPO_ITEM,
                cp.nr_sequencia nr_sequencia,
                NULL nr_seq_cpoe_rp,
				cp.nr_atendimento,
				cp.DT_SUSPENSAO
FROM CPOE_INTERVENCAO cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE cp.dt_liberacao IS NOT NULL
AND	((cp.dt_fim > LOCALTIMESTAMP) or (cp.dt_fim is null))

UNION ALL

/* Materials */

SELECT DISTINCT substr((CASE WHEN cp.DT_SUSPENSAO IS NOT NULL THEN  obter_desc_expressao_idioma(782908, null, wheb_usuario_pck.get_nr_seq_idioma) || ' ' ELSE '' END) || obter_desc_material(cd_material), 1, 255) DS,
                cou.nr_order_unit NR_ORDER_UNIT,
                TO_DATE(cp.DT_INICIO) dt_prev_execucao,
                'MA' IE_TIPO_ITEM,
                cp.nr_sequencia nr_sequencia,
                NULL nr_seq_cpoe_rp,
				cp.nr_atendimento,
				cp.DT_SUSPENSAO
FROM CPOE_MATERIAL cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia 
WHERE coalesce(ie_material, 'N') = 'S'
AND cp.dt_liberacao IS NOT NULL
AND	((cp.dt_fim > LOCALTIMESTAMP) or (cp.dt_fim is null))

UNION ALL

/* Pathologic Anatomy */

SELECT DISTINCT ((CASE WHEN cp.DT_SUSPENSAO IS NOT NULL THEN  obter_desc_expressao_idioma(782908, null, wheb_usuario_pck.get_nr_seq_idioma) || ' ' ELSE '' END) || Obter_Desc_Proc_Interno(cp.NR_SEQ_PROC_INTERNO)) DS,
                cou.nr_order_unit NR_ORDER_UNIT,
                TO_DATE(cp.DT_INICIO) dt_prev_execucao,
                'AP' IE_TIPO_ITEM,
                cp.nr_sequencia nr_sequencia,
                NULL nr_seq_cpoe_rp,
				cp.nr_atendimento,
				cp.DT_SUSPENSAO
FROM CPOE_ANATOMIA_PATOLOGICA cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia 
WHERE cp.dt_liberacao IS NOT NULL
AND	((cp.dt_fim > LOCALTIMESTAMP) or (cp.dt_fim is null));

