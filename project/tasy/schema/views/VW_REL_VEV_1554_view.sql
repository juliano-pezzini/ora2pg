-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW vw_rel_vev_1554 (nr_sequencia_3, nr_sequencia, cd_pessoa_fisica, cd_classificacao, nr_seq_superior, nr_seq_cronograma, nr_seq_proj, cd_funcao_etapa, cont, status_dev, cd_analista, analista, cd_analista_oper, analista_oper, cd_analista_neg, analista_neg, cd_dev_lead, dev_lead, classificacao, priori, librd, ds_atividade, ie_size, size, qt_hora_prev, pr_etapa, nr_seq_ordenacao, ie_ordem, c_tcd, c_ad_001, c_ad_002, c_ad_003, c_ad_004, c_ad_005, ad_001, ad_002, ad_003, ad_004, ad_005, ex_tcd, ex_001, ex_002, ex_003, ex_004, ex_005, os_dev, os_dev_tec, os_test, os_test_vs, os_enc, os_enc_tec, os_total, os_dev_t, os_test_t, os_test_vs_t, os_enc_t, os_total_t, os_reprov_t, tester, dt_ini_ad_001, dt_ini_ad_002, dt_ini_ad_003, dt_ini_ad_004, dt_ini_ad_005, dt_fim_ad_001, dt_fim_ad_002, dt_fim_ad_003, dt_fim_ad_004, dt_fim_ad_005) AS WITH SUB_TABLE_EQUIPE AS (
SELECT MIN(PCEE.NR_SEQUENCIA) NR_SEQ_EQUIPE_ETAPA_CRON, 
    PCEE.NR_SEQ_ETAPA_CRON, 
    PC.NR_SEQ_PROJ 
 FROM PROJ_CRON_ETAPA_EQUIPE PCEE, 
    PROJ_CRON_ETAPA PCE, 
    PROJ_CRONOGRAMA PC 
 WHERE PCEE.NR_SEQ_ETAPA_CRON = PCE.NR_SEQUENCIA 
  AND PCE.NR_SEQ_CRONOGRAMA = PC.NR_SEQUENCIA 
 GROUP BY PC.NR_SEQ_PROJ, PCEE.NR_SEQ_ETAPA_CRON), 
SUB_TABLE_TESTER AS ( 
SELECT PCEE.NR_SEQ_ETAPA_CRON, 
    PF.CD_PESSOA_FISICA, 
    PF.NM_PESSOA_FISICA 
 FROM PROJ_CRON_ETAPA_EQUIPE PCEE, 
   SUB_TABLE_EQUIPE STE, 
   PESSOA_FISICA PF 
 WHERE STE.NR_SEQ_EQUIPE_ETAPA_CRON = PCEE.NR_SEQUENCIA 
  AND STE.NR_SEQ_ETAPA_CRON    = PCEE.NR_SEQ_ETAPA_CRON 
  AND PCEE.CD_PROGRAMADOR     = PF.CD_PESSOA_FISICA 
 GROUP BY PCEE.NR_SEQ_ETAPA_CRON, 
    PF.CD_PESSOA_FISICA, 
    PF.NM_PESSOA_FISICA) 
SELECT A.NR_SEQUENCIA NR_SEQUENCIA_3, 
    A.NR_SEQUENCIA, 
    T.CD_PESSOA_FISICA, 
    A.CD_CLASSIFICACAO, 
    A.NR_SEQ_SUPERIOR, 
    A.NR_SEQ_CRONOGRAMA, 
    PC.NR_SEQ_PROJ, 
    OBTER_CD_FUNC_ETAPA_PROJ(A.NR_SEQUENCIA) CD_FUNCAO_ETAPA, 
    CASE WHEN CTB_OBTER_NIVEL_CLASSIF_CONTA(A.CD_CLASSIFICACAO)=2 THEN  1  ELSE 0 END  CONT, 
    (SELECT OBTER_NOME_STATUS_FUNC_HTML5(SUB_FH.IE_STATUS) FROM FUNCOES_HTML5 SUB_FH WHERE SUB_FH.CD_FUNCAO = OBTER_CD_FUNC_ETAPA_PROJ(A.NR_SEQUENCIA)) STATUS_DEV, 
    OBTER_CD_RECURSO_FUNC_HTML5(OBTER_CD_FUNC_ETAPA_PROJ(A.NR_SEQUENCIA), 'ASHTML') CD_ANALISTA,  
    OBTER_NM_RECURSO_FUNC_HTML5(OBTER_CD_FUNC_ETAPA_PROJ(A.NR_SEQUENCIA), 'ASHTML') ANALISTA,  
    OBTER_CD_RECURSO_FUNC_HTML5(OBTER_CD_FUNC_ETAPA_PROJ(A.NR_SEQUENCIA), 'ASOPER') CD_ANALISTA_OPER,    
    OBTER_NM_RECURSO_FUNC_HTML5(OBTER_CD_FUNC_ETAPA_PROJ(A.NR_SEQUENCIA), 'ASOPER') ANALISTA_OPER, 
    OBTER_CD_RECURSO_FUNC_HTML5(OBTER_CD_FUNC_ETAPA_PROJ(A.NR_SEQUENCIA), 'AN') CD_ANALISTA_NEG,   
    OBTER_NM_RECURSO_FUNC_HTML5(OBTER_CD_FUNC_ETAPA_PROJ(A.NR_SEQUENCIA), 'AN') ANALISTA_NEG, 
    OBTER_CD_RECURSO_FUNC_HTML5(OBTER_CD_FUNC_ETAPA_PROJ(A.NR_SEQUENCIA), 'DL') CD_DEV_LEAD,  
    OBTER_NM_RECURSO_FUNC_HTML5(OBTER_CD_FUNC_ETAPA_PROJ(A.NR_SEQUENCIA), 'DL') DEV_LEAD, 
    coalesce(SUBSTR(A.CD_CLASSIFICACAO, 0, position('.' in A.CD_CLASSIFICACAO)), A.CD_CLASSIFICACAO) CLASSIFICACAO, 
    '# # # ' || CASE WHEN OBTER_PRIORIDADE_ETAPA_PROJ(OBTER_OS_STATUS_GERAL_PROJ(A.NR_SEQUENCIA))='A' THEN  '#V'  ELSE '#T' END  PRIORI, 
    '# # # ' || CASE WHEN OBTER_QTD_HIST_OS_TIPO(OBTER_OS_STATUS_GERAL_PROJ(A.NR_SEQUENCIA), 161)=0 THEN  '#T'  ELSE '#Y' END  LIBRD, 
    CASE WHEN A.IE_FASE='' THEN '' || SUBSTR(PROJ_OBTER_DESC_ESTRUTURA_CRON(A.NR_SEQUENCIA) || ' - ' || A.NR_SEQUENCIA,1,255) || '' || '' || ''  ELSE SUBSTR(PROJ_OBTER_DESC_ESTRUTURA_CRON(A.NR_SEQUENCIA),1,255) END  DS_ATIVIDADE, 
    SUBSTR(DS_ETAPA,0,2) IE_SIZE, 
    CASE WHEN trim(both SUBSTR(DS_ETAPA,0,2)) = 'XS' THEN 'Extra Small' 
      WHEN trim(both SUBSTR(DS_ETAPA,0,2)) = 'S' THEN 'Small' 
      WHEN trim(both SUBSTR(DS_ETAPA,0,2)) = 'M' THEN 'Medium' 
      WHEN trim(both SUBSTR(DS_ETAPA,0,2)) = 'L' THEN 'Large' 
      WHEN trim(both SUBSTR(DS_ETAPA,0,2)) = 'XL' THEN 'Extra Large' 
    END "SIZE", 
    coalesce(A.QT_HORA_PREV,0) QT_HORA_PREV, 
    A.PR_ETAPA, NR_SEQ_ORDENACAO, 
    1 IE_ORDEM, 
    '# # # ' || CASE WHEN OBTER_STATUS_TESTE_PROJ(OBTER_OS_TCD_PROJ(A.NR_SEQUENCIA))='E' THEN  '#G' WHEN OBTER_STATUS_TESTE_PROJ(OBTER_OS_TCD_PROJ(A.NR_SEQUENCIA))='I' THEN  '#A'  ELSE '#T' END  C_TCD, 
    '# # # ' || CASE WHEN OBTER_STATUS_TESTE_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '1'))='E' THEN  '#G' WHEN OBTER_STATUS_TESTE_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '1'))='I' THEN  '#A'  ELSE '#T' END  C_AD_001, 
    '# # # ' || CASE WHEN OBTER_STATUS_TESTE_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '2'))='E' THEN  '#G' WHEN OBTER_STATUS_TESTE_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '2'))='I' THEN  '#A'  ELSE '#T' END  C_AD_002, 
    '# # # ' || CASE WHEN OBTER_STATUS_TESTE_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '3'))='E' THEN  '#G' WHEN OBTER_STATUS_TESTE_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '3'))='I' THEN  '#A'  ELSE '#T' END  C_AD_003, 
    '# # # ' || CASE WHEN OBTER_STATUS_TESTE_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '4'))='E' THEN  '#G' WHEN OBTER_STATUS_TESTE_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '4'))='I' THEN  '#A'  ELSE '#T' END  C_AD_004, 
    '# # # ' || CASE WHEN OBTER_STATUS_TESTE_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '5'))='E' THEN  '#G' WHEN OBTER_STATUS_TESTE_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '5'))='I' THEN  '#A'  ELSE '#T' END  C_AD_005, 
    OBTER_PERCENT_ATIV_OS_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '1'), 155) || '%' AD_001, 
    OBTER_PERCENT_ATIV_OS_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '2'), 155) || '%' AD_002, 
    OBTER_PERCENT_ATIV_OS_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '3'), 155) || '%' AD_003, 
    OBTER_PERCENT_ATIV_OS_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '4'), 155) || '%' AD_004, 
    OBTER_PERCENT_ATIV_OS_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '5'), 155) || '%' AD_005, 
    OBTER_PERCENT_ATIV_OS_PROJ(OBTER_OS_TCD_PROJ(A.NR_SEQUENCIA), 159) || '%' EX_TCD, 
    OBTER_PERCENT_ATIV_OS_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '1'), 159) || '%' EX_001, 
    OBTER_PERCENT_ATIV_OS_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '2'), 159) || '%' EX_002, 
    OBTER_PERCENT_ATIV_OS_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '3'), 159) || '%' EX_003, 
    OBTER_PERCENT_ATIV_OS_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '4'), 159) || '%' EX_004, 
    OBTER_PERCENT_ATIV_OS_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '5'), 159) || '%' EX_005, 
    OBTER_TOTAL_OS_SETOR_PROJ(A.NR_SEQUENCIA, 'D', 246, 'E') OS_DEV, 
    OBTER_TOTAL_OS_SETOR_PROJ(A.NR_SEQUENCIA, 'D', 246, 'I') OS_DEV_TEC, 
    OBTER_TOTAL_OS_SETOR_PROJ(A.NR_SEQUENCIA, 'V', 246, 'E') OS_TEST, 
    OBTER_TOTAL_OS_SETOR_PROJ(A.NR_SEQUENCIA, 'VS', 246, 'E') OS_TEST_VS, 
    OBTER_TOTAL_OS_SETOR_PROJ(A.NR_SEQUENCIA, 'E', 246, 'E') OS_ENC, 
    OBTER_TOTAL_OS_SETOR_PROJ(A.NR_SEQUENCIA, 'E', 246, 'I') OS_ENC_TEC, 
    OBTER_TOTAL_OS_SETOR_PROJ(A.NR_SEQUENCIA, 'T', 246, 'E') OS_TOTAL, 
    OBTER_TOTAL_OS_SETOR_PROJ(A.NR_SEQUENCIA, 'D', -999, 'E') OS_DEV_T, 
    OBTER_TOTAL_OS_SETOR_PROJ(A.NR_SEQUENCIA, 'V', -999, 'E') OS_TEST_T, 
    OBTER_TOTAL_OS_SETOR_PROJ(A.NR_SEQUENCIA, 'VS', -999, 'E') OS_TEST_VS_T, 
    OBTER_TOTAL_OS_SETOR_PROJ(A.NR_SEQUENCIA, 'E', -999, 'E') OS_ENC_T, 
    OBTER_TOTAL_OS_SETOR_PROJ(A.NR_SEQUENCIA, 'T', -999, 'E') OS_TOTAL_T, 
    OBTER_TOTAL_OS_SETOR_PROJ(A.NR_SEQUENCIA, 'RP', -999, 'E') OS_REPROV_T, 
    OBTER_NOME_SOBRENOME_PESSOA(T.CD_PESSOA_FISICA, 'P') || ' ' || OBTER_NOME_SOBRENOME_PESSOA(T.CD_PESSOA_FISICA, 'S') TESTER, 
    OBTER_DT_INI_FIM_TESTE_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '1'), 'I') DT_INI_AD_001, 
    OBTER_DT_INI_FIM_TESTE_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '2'), 'I') DT_INI_AD_002, 
    OBTER_DT_INI_FIM_TESTE_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '3'), 'I') DT_INI_AD_003, 
    OBTER_DT_INI_FIM_TESTE_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '4'), 'I') DT_INI_AD_004, 
    OBTER_DT_INI_FIM_TESTE_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '5'), 'I') DT_INI_AD_005, 
    OBTER_DT_INI_FIM_TESTE_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '1'), 'E') DT_FIM_AD_001, 
    OBTER_DT_INI_FIM_TESTE_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '2'), 'E') DT_FIM_AD_002, 
    OBTER_DT_INI_FIM_TESTE_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '3'), 'E') DT_FIM_AD_003, 
    OBTER_DT_INI_FIM_TESTE_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '4'), 'E') DT_FIM_AD_004, 
    OBTER_DT_INI_FIM_TESTE_PROJ(OBTER_OS_ADERENCIA_PROJ(A.NR_SEQUENCIA, '5'), 'E') DT_FIM_AD_005 
 FROM proj_cronograma pc, proj_cron_etapa a
LEFT OUTER JOIN sub_table_tester t ON (A.NR_SEQUENCIA = T.NR_SEQ_ETAPA_CRON)
WHERE A.NR_SEQ_CRONOGRAMA = PC.NR_SEQUENCIA;

