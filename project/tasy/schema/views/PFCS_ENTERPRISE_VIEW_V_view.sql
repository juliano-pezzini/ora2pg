-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pfcs_enterprise_view_v (ds_content, vl_pfcs, vl_target, vl_aux, cd_estabelecimento, nr_seq_indicator, cd_unit_classification, cd_type, ie_std_deviation) AS SELECT pfcs_get_indicator_name(100) DS_CONTENT, --> Overall Capacity
    concat(pfcs_get_percentage_value(sum(p.vl_indicator_help), sum(p.vl_indicator)),'%') VL_PFCS,
    (pfcs_get_percentage_value(sum(p.vl_indicator_help), sum(p.vl_indicator)))::numeric  VL_TARGET,
    sum(p.vl_indicator) VL_AUX,
    p.nr_seq_operational_level CD_ESTABELECIMENTO,
    p.NR_SEQ_INDICATOR,
    null CD_UNIT_CLASSIFICATION,
    'CAP' CD_TYPE,
    'N' IE_STD_DEVIATION
FROM pfcs_panel p
WHERE p.nr_seq_indicator = 100
    and p.ie_situation = 'A'
    and pfcs_pck_utils.get_ie_hospital_occupancy(p.cd_reference_value) = 'S'
group by p.nr_seq_indicator, p.nr_seq_operational_level

UNION ALL

SELECT pfcs_get_indicator_name(101) DS_CONTENT, --> Census
    (sum(p.vl_indicator_help) || '/' || sum(p.vl_indicator)) VL_PFCS,
    (sum(p.vl_indicator_help))::numeric  VL_TARGET,
    null VL_AUX,
    p.nr_seq_operational_level CD_ESTABELECIMENTO,
    101 NR_SEQ_INDICATOR,
    null CD_UNIT_CLASSIFICATION,
    'CEN' CD_TYPE,
    'N' IE_STD_DEVIATION
FROM pfcs_panel p
WHERE p.nr_seq_indicator = 100
    and p.ie_situation = 'A'
    and pfcs_pck_utils.get_ie_hospital_occupancy(p.cd_reference_value) = 'S'
group by p.nr_seq_indicator, p.nr_seq_operational_level

UNION ALL

SELECT pfcs_get_indicator_name(102) DS_CONTENT, --> Available Beds
    to_char(sum(p.vl_indicator)) VL_PFCS,
    (sum(p.vl_indicator))::numeric  VL_TARGET,
    sum(vl_indicator_help) VL_AUX,
    p.nr_seq_operational_level CD_ESTABELECIMENTO,
    p.NR_SEQ_INDICATOR,
    null CD_UNIT_CLASSIFICATION,
    'AVB' CD_TYPE,
    'N' IE_STD_DEVIATION
FROM pfcs_panel p
WHERE p.nr_seq_indicator = 102
    and p.ie_situation = 'A'
    and pfcs_pck_utils.get_ie_hospital_occupancy(p.cd_reference_value) = 'S'
group by p.nr_seq_indicator, p.nr_seq_operational_level

UNION ALL

SELECT pfcs_get_indicator_name(111) DS_CONTENT, --> Blocked Beds
    to_char(sum(p.vl_indicator)) VL_PFCS,
    (sum(p.vl_indicator))::numeric  VL_TARGET,
    NULL VL_AUX,
    p.nr_seq_operational_level CD_ESTABELECIMENTO,
    p.NR_SEQ_INDICATOR,
    null CD_UNIT_CLASSIFICATION,
    null CD_TYPE,
    null IE_STD_DEVIATION
FROM pfcs_panel p
WHERE p.nr_seq_indicator = 111
    and p.ie_situation = 'A'
    and pfcs_pck_utils.get_ie_hospital_occupancy(p.cd_reference_value) = 'S'
group by p.nr_seq_indicator, p.nr_seq_operational_level

UNION ALL

SELECT pfcs_get_indicator_name(103) DS_CONTENT, --> Available ICU Beds
    to_char(sum(p.vl_indicator)) VL_PFCS,
    (sum(p.vl_indicator))::numeric  VL_TARGET,
    sum(vl_indicator_help) VL_AUX,
    p.nr_seq_operational_level CD_ESTABELECIMENTO,
    103 NR_SEQ_INDICATOR,
    '4' CD_UNIT_CLASSIFICATION,
    'AVB' CD_TYPE,
    'N' IE_STD_DEVIATION
FROM pfcs_panel p
WHERE p.nr_seq_indicator = 102
    and p.ie_situation = 'A'
    and p.cd_reference_aux = '4'
group by p.nr_seq_indicator, p.nr_seq_operational_level

UNION ALL

SELECT	obter_desc_expressao(1055486) DS_CONTENT,  --> Monitors Available
		to_char(sum(coalesce(p.vl_indicator,0))) VL_PFCS,
		(sum(coalesce(p.vl_indicator,0)))::numeric  VL_TARGET,
		NULL VL_AUX,
		p.cd_estabelecimento CD_ESTABELECIMENTO,
		104 NR_SEQ_INDICATOR,
        null CD_UNIT_CLASSIFICATION,
        null CD_TYPE,
        null IE_STD_DEVIATION
FROM ( SELECT	sum(coalesce(vl_indicator,0)) vl_indicator,
					e.cd_estabelecimento
			FROM	pfcs_panel p,
					estabelecimento e,
					empresa em
			WHERE	e.cd_empresa = em.cd_empresa
			  and 	p.nr_seq_operational_level = e.cd_estabelecimento
			  and	e.ie_situacao = 'A'
			  and	em.ie_situacao = 'A'
			  and	e.nm_usuario_nrec = 'PFCS'
			  and	nr_seq_indicator = 104
         group by	e.CD_ESTABELECIMENTO

union all

           SELECT	0 vl_indicator,
					e.cd_estabelecimento
			FROM	pfcs_panel p,
					estabelecimento e,
					empresa em
			WHERE	e.cd_empresa = em.cd_empresa
			  and	p.nr_seq_operational_level = e.cd_estabelecimento
			  and	e.ie_situacao = 'A'
			  and	em.ie_situacao = 'A'
			  and	e.nm_usuario_nrec = 'PFCS'
         group by	e.CD_ESTABELECIMENTO
    )  p
group by 104, p.cd_estabelecimento

UNION ALL

SELECT pfcs_get_indicator_name(105) DS_CONTENT, --> Admissions (last 24h)
    to_char(sum(p.vl_indicator)) VL_PFCS,
    (sum(p.vl_indicator))::numeric  VL_TARGET,
    NULL VL_AUX,
    p.nr_seq_operational_level CD_ESTABELECIMENTO,
    p.NR_SEQ_INDICATOR,
    null CD_UNIT_CLASSIFICATION,
    null CD_TYPE,
    null IE_STD_DEVIATION
FROM pfcs_panel p
WHERE nr_seq_indicator = 105
    and p.ie_situation = 'A'
group by p.nr_seq_indicator, p.nr_seq_operational_level

UNION ALL

SELECT pfcs_get_indicator_name(106) DS_CONTENT, --> Discharges (last 24h)
    to_char(sum(p.vl_indicator)) VL_PFCS,
    (sum(p.vl_indicator))::numeric  VL_TARGET,
    NULL VL_AUX,
    p.nr_seq_operational_level CD_ESTABELECIMENTO,
    p.NR_SEQ_INDICATOR,
    null CD_UNIT_CLASSIFICATION,
    null CD_TYPE,
    null IE_STD_DEVIATION
FROM pfcs_panel p
WHERE p.nr_seq_indicator = 106
    and p.ie_situation = 'A'
group by p.nr_seq_indicator, p.nr_seq_operational_level

UNION ALL

SELECT 	obter_desc_expressao(960928) DS_CONTENT, --> ED Census
    (sum(p.vl_indicator_help) || '/' || sum(p.vl_indicator)) VL_PFCS,
    (sum(p.vl_indicator_help))::numeric  VL_TARGET,
    null VL_AUX,
    p.nr_seq_operational_level CD_ESTABELECIMENTO,
    107 NR_SEQ_INDICATOR,
    '1' CD_UNIT_CLASSIFICATION,
    'CEN' CD_TYPE,
    'N' IE_STD_DEVIATION
FROM pfcs_panel p
WHERE p.nr_seq_indicator = 114
    and p.ie_situation = 'A'
group by p.nr_seq_indicator, p.nr_seq_operational_level

UNION ALL

SELECT 	obter_desc_expressao(1038652) DS_CONTENT, --> ED Wait Time
    to_char(get_time_by_minutes( sum(coalesce(a.VL_INDICATOR_AUX,0)) ) ) VL_PFCS,
    sum(coalesce(a.VL_INDICATOR_AUX,0)) VL_TARGET,
    null VL_AUX,
    a.nr_seq_operational_level CD_ESTABELECIMENTO,
    108 NR_SEQ_INDICATOR,
    null CD_UNIT_CLASSIFICATION,
    null CD_TYPE,
    null IE_STD_DEVIATION
FROM pfcs_panel a
WHERE a.nr_seq_indicator = 163
    and a.ie_situation = 'A'
group by a.nr_seq_indicator, a.nr_seq_operational_level

UNION ALL

SELECT  pfcs_pck_indicators.get_name(385) DS_CONTENT, --> Performed/Scheduled
		(max(a.vl_indicator_help) || '/' || max(a.vl_indicator)) VL_PFCS,
		sum(coalesce(a.vl_indicator_help,0)) VL_TARGET,
		null VL_AUX,
		a.nr_seq_operational_level CD_ESTABELECIMENTO,
		385 NR_SEQ_INDICATOR,
		null CD_UNIT_CLASSIFICATION,
		null CD_TYPE,
		null IE_STD_DEVIATION
FROM pfcs_panel a
WHERE a.nr_seq_indicator = 323
    and a.ie_situation = 'A'
group by a.nr_seq_indicator, a.nr_seq_operational_level

UNION ALL

SELECT 	pfcs_pck_indicators.get_name(374) DS_CONTENT, --> Not approved
    to_char(coalesce(max(a.vl_indicator),0)) VL_PFCS,
    sum(coalesce(a.vl_indicator,0)) VL_TARGET,
    null VL_AUX,
    a.nr_seq_operational_level CD_ESTABELECIMENTO,
    374 NR_SEQ_INDICATOR,
    null CD_UNIT_CLASSIFICATION,
    null CD_TYPE,
    null IE_STD_DEVIATION
FROM pfcs_panel a
WHERE a.nr_seq_indicator = 326
    and a.ie_situation = 'A'
group by a.nr_seq_indicator, a.nr_seq_operational_level

UNION ALL

SELECT 	pfcs_pck_indicators.get_name(318) DS_CONTENT, --> Slots available
    get_time_by_minutes(max(a.vl_indicator)) VL_PFCS,
    sum(coalesce(a.vl_indicator,0)) VL_TARGET,
    null VL_AUX,
    a.nr_seq_operational_level CD_ESTABELECIMENTO,
	318 NR_SEQ_INDICATOR,
    null CD_UNIT_CLASSIFICATION,
    null CD_TYPE,
    null IE_STD_DEVIATION
FROM pfcs_panel a
WHERE a.nr_seq_indicator = 318
    and a.ie_situation = 'A'
group by a.nr_seq_indicator, a.nr_seq_operational_level

UNION ALL

SELECT 	pfcs_pck_indicators.get_name(375) DS_CONTENT, --> Emergency surgery
    to_char(coalesce(max(a.vl_indicator),0)) VL_PFCS,
    sum(coalesce(a.vl_indicator,0)) VL_TARGET,
    null VL_AUX,
    a.nr_seq_operational_level CD_ESTABELECIMENTO,
	375 NR_SEQ_INDICATOR,
    null CD_UNIT_CLASSIFICATION,
    null CD_TYPE,
    null IE_STD_DEVIATION
FROM pfcs_panel a
WHERE a.nr_seq_indicator = 338
    and a.ie_situation = 'A'
group by a.nr_seq_indicator, a.nr_seq_operational_level

UNION ALL

SELECT 	pfcs_pck_indicators.get_name(376) DS_CONTENT, --> Canceled
    to_char(coalesce(max(a.vl_indicator),0)) VL_PFCS,
    sum(coalesce(a.vl_indicator,0)) VL_TARGET,
    null VL_AUX,
    a.nr_seq_operational_level CD_ESTABELECIMENTO,
    376 NR_SEQ_INDICATOR,
    null CD_UNIT_CLASSIFICATION,
    null CD_TYPE,
    null IE_STD_DEVIATION
FROM pfcs_panel a
WHERE a.nr_seq_indicator = 325
    and a.ie_situation = 'A'
group by a.nr_seq_indicator, a.nr_seq_operational_level

UNION ALL

SELECT 	pfcs_pck_indicators.get_name(335) DS_CONTENT, --> Upcoming surgeries
    to_char(coalesce(max(a.vl_indicator),0)) VL_PFCS,
    sum(coalesce(a.vl_indicator,0)) VL_TARGET,
    null VL_AUX,
    a.nr_seq_operational_level CD_ESTABELECIMENTO,
    335 NR_SEQ_INDICATOR,
    null CD_UNIT_CLASSIFICATION,
    null CD_TYPE,
    null IE_STD_DEVIATION
FROM pfcs_panel a
WHERE a.nr_seq_indicator = 335
    and a.ie_situation = 'A'
group by a.nr_seq_indicator, a.nr_seq_operational_level

UNION ALL

SELECT pfcs_pck_indicators.get_name(345) DS_CONTENT, --> OR Overall Capacity
    concat(pfcs_get_percentage_value(sum(p.vl_indicator_help), sum(p.vl_indicator)),'%') VL_PFCS,
    (pfcs_get_percentage_value(sum(p.vl_indicator_help), sum(p.vl_indicator)))::numeric  VL_TARGET,
    null VL_AUX,
    p.nr_seq_operational_level CD_ESTABELECIMENTO,
    p.NR_SEQ_INDICATOR,
    null CD_UNIT_CLASSIFICATION,
    null CD_TYPE,
    'N' IE_STD_DEVIATION
FROM pfcs_panel p
WHERE p.nr_seq_indicator = 345
    and p.ie_situation = 'A'
group by p.nr_seq_indicator, p.nr_seq_operational_level;

