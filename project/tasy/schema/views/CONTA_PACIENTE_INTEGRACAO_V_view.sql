-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW conta_paciente_integracao_v (nr_atendimento, nr_interno_conta, cd_convenio, cd_categoria, nr_prescricao, nr_sequencia_prescricao, nr_seq_exame, cd_procedimento, qt_procedimento, dt_procedimento, dt_conta, vl_procedimento, vl_unitario, ds_procedimento, cd_tipo_procedimento, ds_procedimento_lab, cd_setor_atendimento, ds_setor_atendimento, nr_sequencia, nr_seq_proc_pacote, cd_cgc_prestador, nr_doc_convenio, cd_motivo_exc_conta, cd_edicao_amb, nm_paciente) AS select	a.nr_atendimento,
	a.nr_interno_conta,
	a.cd_convenio,
	a.cd_categoria,
	a.nr_prescricao,
	a.nr_sequencia_prescricao,
	a.nr_seq_exame,
	a.cd_procedimento,
	a.qt_procedimento,
	a.dt_procedimento,
	a.dt_conta,
	a.vl_procedimento,
	(a.vl_procedimento / a.qt_procedimento) vl_unitario,
	substr(b.ds_procedimento,0,180) ds_procedimento,
	b.cd_tipo_procedimento,
	substr(obter_desc_exame_lab(a.nr_seq_exame,null,a.cd_procedimento,a.ie_origem_proced),0,180) ds_procedimento_lab,
	c.cd_setor_atendimento,
	c.ds_setor_atendimento,
	a.nr_sequencia,
	a.nr_seq_proc_pacote,
	a.cd_cgc_prestador,
	a.nr_doc_convenio,
	a.cd_motivo_exc_conta,
	a.cd_edicao_amb,
	substr(obter_pessoa_atendimento(a.nr_atendimento,'N'),1,60) nm_paciente
FROM 	setor_atendimento c,
	procedimento b,
	procedimento_paciente a
where a.cd_procedimento		= b.cd_procedimento
  and a.ie_origem_proced	= b.ie_origem_proced
  and a.cd_setor_atendimento	= c.cd_setor_atendimento
  and a.nr_prescricao is not null;

