-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW atendimento_ps_ocup_v (nr_atendimento, dt_entrada, dt_alta, dt_alta_interno, cd_pessoa_fisica, nm_pessoa_fisica, nr_prontuario, nm_guerra, cd_medico_resp, cd_estabelecimento, ds_sintoma_paciente, cd_setor_atendimento, cd_unidade_basica, cd_unidade_compl, cd_unidade, ds_setor_atendimento, dt_nascimento, nr_telefone, dt_chamada_paciente, cd_medico_chamado, cd_classif_setor, ie_clinica, nr_seq_classificacao, ds_obs_alta, cd_tipo_acomodacao, nr_atend_original, nr_seq_queixa, nr_seq_triagem, ds_senha_qmatic, nr_seq_local_pa, cd_procedencia, cd_motivo_alta, cd_convenio, cd_religiao, ie_permite_visita, ie_tipo_atendimento, dt_saida_unidade, dt_inicio_atendimento, dt_atend_medico, dt_fim_consulta, dt_fim_triagem, nr_seq_tipo_acidente, dt_impressao, dt_saida_prev_loc_pa, nr_atend_alta, dt_fim_conta, nm_usuario_alta, classif, ds_tipo_atendimento) AS select	/* +index(a ATEPACI_I2) */
	a.nr_atendimento, 
	a.dt_entrada, 
	a.dt_alta, 
	a.dt_alta_interno, 
	a.cd_pessoa_fisica, 
	SUBSTR(obter_nome_pf(p.cd_pessoa_fisica),1,100) nm_pessoa_fisica, 
	p.nr_prontuario, 
	substr(obter_nome_medico(cd_medico_resp,'G'),1,60) nm_guerra, 
	a.cd_medico_resp, 
	a.cd_estabelecimento, 
	a.ds_sintoma_paciente, 
	b.cd_setor_atendimento, 
	b.cd_unidade_basica, 
	b.cd_unidade_compl, 
	b.cd_unidade_basica || ' ' ||b.cd_unidade_compl cd_unidade, 
	s.ds_setor_atendimento, 
	p.dt_nascimento, 
	p.nr_telefone_celular nr_telefone, 
	a.dt_chamada_paciente, 
	a.cd_medico_chamado, 
	s.cd_classif_setor, 
	a.ie_clinica, 
	a.nr_seq_classificacao, 
	a.ds_obs_alta, 
	b.cd_tipo_acomodacao, 
	a.nr_atend_original, 
	a.nr_seq_queixa, 
	a.nr_seq_triagem, 
	a.ds_senha_qmatic, 
	a.nr_seq_local_pa, 
	a.cd_procedencia, 
	a.cd_motivo_alta, 
	obter_convenio_atendimento(a.nr_atendimento) cd_convenio, 
	p.cd_religiao, 
	a.ie_permite_visita, 
	a.ie_tipo_atendimento, 
	b.dt_saida_unidade, 
	a.dt_inicio_atendimento, 
	a.dt_atend_medico, 
	a.dt_fim_consulta, 
	a.dt_fim_triagem, 
	a.nr_seq_tipo_acidente, 
	a.dt_impressao, 
	a.dt_saida_prev_loc_pa, 
	a.nr_atend_alta, 
	a.dt_fim_conta, 
	a.nm_usuario_alta, 
	substr(obter_desc_classif_atend(a.nr_seq_classificacao),1,60) classif, 
	substr(OBTER_NOME_TIPO_ATEND(a.ie_tipo_atendimento),1,255) ds_tipo_atendimento 
FROM	pessoa_fisica p, 
	setor_atendimento s, 
	atend_paciente_unidade b, 
	atendimento_paciente a 
where	a.nr_atendimento = b.nr_atendimento 
and	to_char(b.nr_seq_interno) 	= to_char(obter_atepacu_paciente(a.nr_atendimento, 'A')) 
and	b.cd_setor_atendimento		= s.cd_setor_atendimento 
and	a.cd_pessoa_fisica		= p.cd_pessoa_fisica 
and	a.nr_atendimento	> 0 /* Rafael em 07/10/2006 OS 41178 */
 
and	exists (select 1 
	from	setor_atendimento x, 
		atend_paciente_unidade y 
	where	a.nr_atendimento = y.nr_atendimento 
	and	y.cd_setor_atendimento	= x.cd_setor_atendimento 
	and	x.cd_classif_setor	= 1  LIMIT 1);

