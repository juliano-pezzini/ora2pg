-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW proj_estrutura_etapa_v (cd_etapa, ds_etapa, etapa_superior_1, ds_etapa_superior_1, etapa_superior_2, ds_etapa_superior_2, etapa_superior_3, ds_etapa_superior_3, etapa_superior_4, ds_etapa_superior_4, etapa_superior_5, ds_etapa_superior_5, etapa_superior_6, ds_etapa_superior_6, etapa_superior_7, ds_etapa_superior_7, etapa_superior_8, ds_etapa_superior_8, etapa_superior_9, ds_etapa_superior_9, etapa_superior_10, ds_etapa_superior_10, cd_etapa_principal, ds_etapa_principal, ds_caminho_completo, cd_primeiro_responsavel_etapa, ds_primeiro_responsavel_etapa) AS SELECT CD_ETAPA,
    trim(both OBTER_DESC_ATIVIDADE_CRON(CD_ETAPA)) DS_ETAPA, 
    ETAPA_SUPERIOR_1, 
    trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_1)) DS_ETAPA_SUPERIOR_1, 
    ETAPA_SUPERIOR_2, 
    trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_2)) DS_ETAPA_SUPERIOR_2, 
    ETAPA_SUPERIOR_3, 
    trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_3)) DS_ETAPA_SUPERIOR_3, 
    ETAPA_SUPERIOR_4, 
    trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_4)) DS_ETAPA_SUPERIOR_4, 
    ETAPA_SUPERIOR_5, 
    trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_5)) DS_ETAPA_SUPERIOR_5, 
    ETAPA_SUPERIOR_6, 
    trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_6)) DS_ETAPA_SUPERIOR_6, 
    ETAPA_SUPERIOR_7, 
    trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_7)) DS_ETAPA_SUPERIOR_7, 
    ETAPA_SUPERIOR_8, 
    trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_8)) DS_ETAPA_SUPERIOR_8, 
    ETAPA_SUPERIOR_9, 
    trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_9)) DS_ETAPA_SUPERIOR_9, 
    ETAPA_SUPERIOR_10, 
    trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_10)) DS_ETAPA_SUPERIOR_10, 
    CASE WHEN(ETAPA_SUPERIOR_10 <> 0) THEN ETAPA_SUPERIOR_9 
      WHEN (ETAPA_SUPERIOR_10 = 0 AND ETAPA_SUPERIOR_9 <> 0) THEN ETAPA_SUPERIOR_8 
      WHEN (ETAPA_SUPERIOR_9 = 0 AND ETAPA_SUPERIOR_8 <> 0) THEN ETAPA_SUPERIOR_7 
      WHEN (ETAPA_SUPERIOR_8 = 0 AND ETAPA_SUPERIOR_7 <> 0) THEN ETAPA_SUPERIOR_6 
      WHEN (ETAPA_SUPERIOR_7 = 0 AND ETAPA_SUPERIOR_6 <> 0) THEN ETAPA_SUPERIOR_5 
      WHEN (ETAPA_SUPERIOR_6 = 0 AND ETAPA_SUPERIOR_5 <> 0) THEN ETAPA_SUPERIOR_4 
      WHEN (ETAPA_SUPERIOR_5 = 0 AND ETAPA_SUPERIOR_4 <> 0) THEN ETAPA_SUPERIOR_3 
      WHEN (ETAPA_SUPERIOR_4 = 0 AND ETAPA_SUPERIOR_3 <> 0) THEN ETAPA_SUPERIOR_2 
      WHEN (ETAPA_SUPERIOR_3 = 0 AND ETAPA_SUPERIOR_2 <> 0) THEN ETAPA_SUPERIOR_1 
    END CD_ETAPA_PRINCIPAL, 
    CASE WHEN(ETAPA_SUPERIOR_10 <> 0) THEN trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_9)) 
      WHEN (ETAPA_SUPERIOR_10 = 0 AND ETAPA_SUPERIOR_9 <> 0) THEN trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_8)) 
      WHEN (ETAPA_SUPERIOR_9 = 0 AND ETAPA_SUPERIOR_8 <> 0) THEN trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_7)) 
      WHEN (ETAPA_SUPERIOR_8 = 0 AND ETAPA_SUPERIOR_7 <> 0) THEN trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_6)) 
      WHEN (ETAPA_SUPERIOR_7 = 0 AND ETAPA_SUPERIOR_6 <> 0) THEN trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_5)) 
      WHEN (ETAPA_SUPERIOR_6 = 0 AND ETAPA_SUPERIOR_5 <> 0) THEN trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_4)) 
      WHEN (ETAPA_SUPERIOR_5 = 0 AND ETAPA_SUPERIOR_4 <> 0) THEN trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_3)) 
      WHEN (ETAPA_SUPERIOR_4 = 0 AND ETAPA_SUPERIOR_3 <> 0) THEN trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_2)) 
      WHEN (ETAPA_SUPERIOR_3 = 0 AND ETAPA_SUPERIOR_2 <> 0) THEN trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_1)) 
    END DS_ETAPA_PRINCIPAL, 
    CASE WHEN(ETAPA_SUPERIOR_10 <> 0) THEN trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_9)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_8)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_7)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_6)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_5)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_4)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_3)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_2)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_1)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(CD_ETAPA)) 
      WHEN (ETAPA_SUPERIOR_10 = 0 AND ETAPA_SUPERIOR_9 <> 0) THEN trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_8)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_7)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_6)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_5)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_4)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_3)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_2)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_1)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(CD_ETAPA)) 
      WHEN (ETAPA_SUPERIOR_9 = 0 AND ETAPA_SUPERIOR_8 <> 0) THEN trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_7)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_6)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_5)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_4)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_3)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_2)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_1)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(CD_ETAPA)) 
      WHEN (ETAPA_SUPERIOR_8 = 0 AND ETAPA_SUPERIOR_7 <> 0) THEN trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_6)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_5)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_4)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_3)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_2)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_1)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(CD_ETAPA)) 
      WHEN (ETAPA_SUPERIOR_7 = 0 AND ETAPA_SUPERIOR_6 <> 0) THEN trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_5)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_4)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_3)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_2)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_1)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(CD_ETAPA)) 
      WHEN (ETAPA_SUPERIOR_6 = 0 AND ETAPA_SUPERIOR_5 <> 0) THEN trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_4)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_3)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_2)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_1)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(CD_ETAPA)) 
      WHEN (ETAPA_SUPERIOR_5 = 0 AND ETAPA_SUPERIOR_4 <> 0) THEN trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_3)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_2)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_1)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(CD_ETAPA)) 
      WHEN (ETAPA_SUPERIOR_4 = 0 AND ETAPA_SUPERIOR_3 <> 0) THEN trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_2)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_1)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(CD_ETAPA)) 
      WHEN (ETAPA_SUPERIOR_3 = 0 AND ETAPA_SUPERIOR_2 <> 0) THEN trim(both OBTER_DESC_ATIVIDADE_CRON(ETAPA_SUPERIOR_1)) || ' > ' || trim(both OBTER_DESC_ATIVIDADE_CRON(CD_ETAPA)) 
    END DS_CAMINHO_COMPLETO, 
    CD_PRIMEIRO_RESPONSAVEL_ETAPA, 
    OBTER_NOME_SOBRENOME_PESSOA(CD_PRIMEIRO_RESPONSAVEL_ETAPA, 'P') || ' ' || OBTER_NOME_SOBRENOME_PESSOA(CD_PRIMEIRO_RESPONSAVEL_ETAPA, 'S') DS_PRIMEIRO_RESPONSAVEL_ETAPA 
 FROM (SELECT coalesce(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(PCE.NR_SEQUENCIA)))))))))),0) ETAPA_SUPERIOR_10, 
        coalesce(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(PCE.NR_SEQUENCIA))))))))),0) ETAPA_SUPERIOR_9, 
        coalesce(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(PCE.NR_SEQUENCIA)))))))),0) ETAPA_SUPERIOR_8, 
        coalesce(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(PCE.NR_SEQUENCIA))))))),0) ETAPA_SUPERIOR_7, 
        coalesce(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(PCE.NR_SEQUENCIA)))))),0) ETAPA_SUPERIOR_6, 
        coalesce(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(PCE.NR_SEQUENCIA))))),0) ETAPA_SUPERIOR_5, 
        coalesce(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(PCE.NR_SEQUENCIA)))),0) ETAPA_SUPERIOR_4, 
        coalesce(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(PCE.NR_SEQUENCIA))),0) ETAPA_SUPERIOR_3, 
        coalesce(OBTER_ETAPA_SUPERIOR(OBTER_ETAPA_SUPERIOR(PCE.NR_SEQUENCIA)),0) ETAPA_SUPERIOR_2, 
        coalesce(OBTER_ETAPA_SUPERIOR(PCE.NR_SEQUENCIA),0) ETAPA_SUPERIOR_1, 
        PCE.NR_SEQUENCIA CD_ETAPA, 
        (SELECT MIN(S.CD_PROGRAMADOR) FROM PROJ_CRON_ETAPA_EQUIPE S WHERE S.NR_SEQ_ETAPA_CRON = PCE.NR_SEQUENCIA) CD_PRIMEIRO_RESPONSAVEL_ETAPA 
     FROM PROJ_CRON_ETAPA PCE, 
        PROJ_CRONOGRAMA PC 
     WHERE PCE.NR_SEQ_CRONOGRAMA = PC.NR_SEQUENCIA) alias244;

