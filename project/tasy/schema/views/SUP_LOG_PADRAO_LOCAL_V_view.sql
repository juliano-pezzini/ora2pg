-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW sup_log_padrao_local_v (nm_tabela, nr_seq_log, ds_historico, cd_local_estoque, cd_material, dt_atualizacao, nm_usuario) AS select	nm_tabela,
	nr_sequencia nr_seq_log,
	substr('Local: ' || obter_desc_local_estoque(somente_numero(substr(substr(ds_chave_composta,18,255),1,position('#' in substr(ds_chave_composta,18,255))-1))) || ' - Material: ' || somente_numero(substr(ds_chave_composta,position('CD_MATERIAL' in ds_chave_composta)+12,255)) || ' - ' || obter_desc_material(somente_numero(substr(ds_chave_composta,position('CD_MATERIAL' in ds_chave_composta)+12,255))),1,255)  ds_historico,
	somente_numero(substr(substr(ds_chave_composta,18,255),1,position('#' in substr(ds_chave_composta,18,255))-1)) cd_local_estoque,
	somente_numero(substr(ds_chave_composta,position('CD_MATERIAL' in ds_chave_composta)+12,255)) cd_material,
	dt_atualizacao,
	nm_usuario
FROM	tasy_log_alteracao a
where	nm_tabela = 'PADRAO_ESTOQUE_LOCAL'

union all

select	a.nm_tabela,
	a.nr_sequencia nr_seq_log,
	substr('Seq: ' || somente_numero(a.ds_chave_simples) || ' - Local: ' || obter_desc_local_estoque(b.cd_local_estoque) || ' - Material: ' || b.cd_material || ' - '||obter_desc_material(b.cd_material),1,255) ds_historico,
	b.cd_local_estoque,
	b.cd_material,
	a.dt_atualizacao,
	a.nm_usuario
FROM tasy_log_alteracao a, somente_numero(a
LEFT OUTER JOIN loc_estoque_estrut_materiais b ON (somente_numero(a.ds_chave_simples) = b.nr_sequencia)
WHERE a.nm_tabela = 'LOC_ESTOQUE_ESTRUT_MATERIAIS'
union all

select	a.nm_tabela,
	a.nr_sequencia nr_seq_log,
	substr('Local: ' || obter_desc_local_estoque(b.cd_local_estoque),1,255) ds_historico,
	b.cd_local_estoque,
	null cd_material,
	a.dt_atualizacao,
	a.nm_usuario
FROM tasy_log_alteracao a, somente_numero(a
LEFT OUTER JOIN local_estoque_crit_inv b ON (somente_numero(a.ds_chave_simples) = b.nr_sequencia)
WHERE nm_tabela = 'LOCAL_ESTOQUE_CRIT_INV'  
union all

select	a.nm_tabela,
	a.nr_sequencia nr_seq_log,
	substr('Local: ' || obter_desc_local_estoque(b.cd_local_estoque) || ' - Material: ' || b.cd_material || ' - '||obter_desc_material(b.cd_material),1,255) ds_historico,
	b.cd_local_estoque,
	b.cd_material,
	a.dt_atualizacao,
	a.nm_usuario
FROM tasy_log_alteracao a, somente_numero(a
LEFT OUTER JOIN localizacao_estoque_local b ON (somente_numero(a.ds_chave_simples) = b.nr_sequencia)
WHERE nm_tabela = 'LOCALIZACAO_ESTOQUE_LOCAL'  
union all

select	a.nm_tabela,
	a.nr_sequencia nr_seq_log,
	substr('Local: ' || obter_desc_local_estoque(b.cd_local_estoque) || ' - Material: ' || b.cd_material || ' - '||obter_desc_material(b.cd_material),1,255) ds_historico,
	b.cd_local_estoque,
	b.cd_material,
	a.dt_atualizacao,
	a.nm_usuario
FROM tasy_log_alteracao a, somente_numero(a
LEFT OUTER JOIN regra_ressup_estab b ON (somente_numero(a.ds_chave_simples) = b.nr_sequencia)
WHERE nm_tabela = 'REGRA_RESSUP_ESTAB';

