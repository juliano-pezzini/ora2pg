-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW titulo_pagar_v (nr_titulo, cd_estabelecimento, dt_atualizacao, nm_usuario, dt_emissao, dt_vencimento_original, dt_vencimento_atual, vl_titulo, vl_saldo_titulo, vl_saldo_juros, vl_saldo_multa, cd_moeda, tx_juros, tx_multa, cd_tipo_taxa_juro, cd_tipo_taxa_multa, tx_desc_antecipacao, dt_limite_antecipacao, vl_dia_antecipacao, cd_tipo_taxa_antecipacao, ie_situacao, ie_origem_titulo, ie_tipo_titulo, nr_seq_nota_fiscal, cd_pessoa_fisica, cd_cgc, nr_documento, nr_bloqueto, dt_liquidacao, nr_lote_contabil, ds_observacao_titulo, nr_bordero, vl_bordero, vl_juros_bordero, vl_multa_bordero, vl_desconto_bordero, ie_desconto_dia, nr_titulo_original, nr_parcelas, nr_total_parcelas, dt_contabil, vl_ir, nr_seq_trans_fin_baixa, dt_liberacao, nm_usuario_lib, nr_seq_rpa, nr_repasse_terceiro, nr_nosso_numero, vl_imposto_munic, vl_inss, nr_seq_trans_fin_contab, nr_seq_tributo, vl_out_desp_bordero, ds_compl_contab, dt_inclusao, nm_usuario_orig, dt_integracao_externa, ie_status_tributo, nr_lote_transf_trib, nr_adiant_pago, nr_seq_contrato, cd_tributo, cd_variacao, ie_periodicidade, cd_estab_financeiro, nr_titulo_externo, vl_bloq_associado, vl_bloq_juros, vl_bloq_desc, ie_pls, nr_seq_prot_conta, cd_tipo_baixa_neg, cd_darf, cd_banco_portador, vl_outros_acrescimos, nr_seq_reembolso, nr_seq_lote_res_pls, nr_adiant_rec, nr_seq_adiant_dev, nr_titulo_transf, ie_bloqueto, nr_seq_proj_rec, nr_seq_processo, nr_seq_taxa_saude, nr_seq_lote_audit, nr_seq_provisao, nr_seq_distribuicao, nr_seq_proj_gpi, nr_seq_etapa_gpi, nr_seq_lote_audit_hist, nr_seq_nota_credito, nr_seq_lote_empresa, nr_seq_classe, nr_seq_bordero_nc, nr_seq_pls_pag_prest, nr_seq_conta_gpi, nr_seq_pls_lote_camara, nr_conta, vl_outras_ded_bordero, dt_ultima_devolucao, nr_seq_lote_enc_contas, nr_bloqueto_leitura, nr_seq_ctb_tributo, nr_seq_tit_rec_trib, nr_titulo_dest, nr_seq_trib_presu, nr_seq_segurado_mens, ie_status, nr_seq_pls_lote_contest, nr_seq_pls_lote_disc, ie_tipo_pagamento, nr_seq_grupo_prod, nr_seq_conta_bco, ds_beneficiario, ds_tipo_taxa_juro, ds_tipo_taxa_multa, ds_tipo_titulo, ds_situacao, ds_tributo, ds_estabelecimento, ie_status_nvl, vl_outras_despesas, nr_seq_tf_curto_prazo, vl_liquido_bordero, ds_origem, cd_conta_contabil, nr_ordem_compra_nf, vl_total_nota, cd_operacao_nf) AS SELECT 	a.NR_TITULO,
	a.CD_ESTABELECIMENTO,
	a.DT_ATUALIZACAO,
	a.NM_USUARIO,
	a.DT_EMISSAO,
	a.DT_VENCIMENTO_ORIGINAL,
	a.DT_VENCIMENTO_ATUAL,
	a.VL_TITULO,
	a.VL_SALDO_TITULO,
	a.VL_SALDO_JUROS,
	a.VL_SALDO_MULTA,
	a.CD_MOEDA,
	a.TX_JUROS,
	a.TX_MULTA,
	a.CD_TIPO_TAXA_JURO,
	a.CD_TIPO_TAXA_MULTA,
	a.TX_DESC_ANTECIPACAO,
	a.DT_LIMITE_ANTECIPACAO,
	a.VL_DIA_ANTECIPACAO,
	a.CD_TIPO_TAXA_ANTECIPACAO,
	a.IE_SITUACAO,
	a.IE_ORIGEM_TITULO,
	a.IE_TIPO_TITULO,
	a.NR_SEQ_NOTA_FISCAL,
	a.CD_PESSOA_FISICA,
	a.CD_CGC,
	TO_CHAR(a.NR_DOCUMENTO) NR_DOCUMENTO,
	a.NR_BLOQUETO,
	a.DT_LIQUIDACAO,
	a.NR_LOTE_CONTABIL,
	a.DS_OBSERVACAO_TITULO,
	a.NR_BORDERO,
	a.VL_BORDERO,
	a.VL_JUROS_BORDERO,
	a.VL_MULTA_BORDERO,
	a.VL_DESCONTO_BORDERO,
	a.IE_DESCONTO_DIA,
	a.NR_TITULO_ORIGINAL,
	a.NR_PARCELAS,
	a.NR_TOTAL_PARCELAS,
	a.DT_CONTABIL,
	a.VL_IR,
	a.NR_SEQ_TRANS_FIN_BAIXA,
	a.DT_LIBERACAO,
	a.NM_USUARIO_LIB,
	a.NR_SEQ_RPA,
	a.NR_REPASSE_TERCEIRO,
	a.NR_NOSSO_NUMERO,
	a.VL_IMPOSTO_MUNIC,
	a.VL_INSS,
	a.NR_SEQ_TRANS_FIN_CONTAB,
	a.NR_SEQ_TRIBUTO,
	a.VL_OUT_DESP_BORDERO,
	a.DS_COMPL_CONTAB,
	a.DT_INCLUSAO,
	a.NM_USUARIO_ORIG,
	a.DT_INTEGRACAO_EXTERNA,
	a.IE_STATUS_TRIBUTO,
	a.NR_LOTE_TRANSF_TRIB,
	a.NR_ADIANT_PAGO,
	a.NR_SEQ_CONTRATO,
	a.CD_TRIBUTO,
	a.CD_VARIACAO,
	a.IE_PERIODICIDADE,
	a.CD_ESTAB_FINANCEIRO,
	a.NR_TITULO_EXTERNO,
	a.VL_BLOQ_ASSOCIADO,
	a.VL_BLOQ_JUROS,
	a.VL_BLOQ_DESC,
	a.IE_PLS,
	a.NR_SEQ_PROT_CONTA,
	a.CD_TIPO_BAIXA_NEG,
	a.CD_DARF,
	a.CD_BANCO_PORTADOR,
	a.VL_OUTROS_ACRESCIMOS,
	a.NR_SEQ_REEMBOLSO,
	a.NR_SEQ_LOTE_RES_PLS,
	a.NR_ADIANT_REC,
	a.NR_SEQ_ADIANT_DEV,
	a.NR_TITULO_TRANSF,
	a.IE_BLOQUETO,
	a.NR_SEQ_PROJ_REC,
	a.NR_SEQ_PROCESSO,
	a.NR_SEQ_TAXA_SAUDE,
	a.NR_SEQ_LOTE_AUDIT,
	a.NR_SEQ_PROVISAO,
	a.NR_SEQ_DISTRIBUICAO,
	a.NR_SEQ_PROJ_GPI,
	a.NR_SEQ_ETAPA_GPI,
	a.NR_SEQ_LOTE_AUDIT_HIST,
	a.NR_SEQ_NOTA_CREDITO,
	a.NR_SEQ_LOTE_EMPRESA,
	a.NR_SEQ_CLASSE,
	a.NR_SEQ_BORDERO_NC,
	a.NR_SEQ_PLS_PAG_PREST,
	a.NR_SEQ_CONTA_GPI,
	a.NR_SEQ_PLS_LOTE_CAMARA,
	a.NR_CONTA,
	a.VL_OUTRAS_DED_BORDERO,
	a.DT_ULTIMA_DEVOLUCAO,
	a.NR_SEQ_LOTE_ENC_CONTAS,
	a.NR_BLOQUETO_LEITURA,
	a.NR_SEQ_CTB_TRIBUTO,
	a.NR_SEQ_TIT_REC_TRIB,
	a.NR_TITULO_DEST,
	a.NR_SEQ_TRIB_PRESU,
	a.NR_SEQ_SEGURADO_MENS,
	a.IE_STATUS,
	a.NR_SEQ_PLS_LOTE_CONTEST,
	a.NR_SEQ_PLS_LOTE_DISC,
	a.IE_TIPO_PAGAMENTO,
	a.NR_SEQ_GRUPO_PROD,
        	a.NR_SEQ_CONTA_BCO,
	substr(CASE WHEN a.cd_pessoa_fisica IS NULL THEN  obter_dados_pf_pj(a.cd_pessoa_fisica, a.cd_cgc, 'N')  ELSE obter_nome_pf(a.cd_pessoa_fisica) END ,1,255) ds_beneficiario,
	SUBSTR(obter_desc_tipo_taxa(a.cd_tipo_taxa_juro),1,255) ds_tipo_taxa_juro,
	SUBSTR(obter_desc_tipo_taxa(a.cd_tipo_taxa_multa),1,255) ds_tipo_taxa_multa,
	SUBSTR(obter_valor_dominio(502, a.ie_tipo_titulo),1,200) ds_tipo_titulo,
	SUBSTR(obter_valor_dominio(501, a.ie_situacao),1,200) ds_situacao,
	SUBSTR(obter_tributo_titulo_pagar(a.nr_seq_tributo,0),1,40) ds_tributo,
	SUBSTR(obter_nome_estabelecimento(a.cd_estabelecimento),1,255) ds_estabelecimento,
	coalesce(a.ie_status,'D') ie_status_nvl,
	a.vl_outras_despesas,
	a.nr_seq_tf_curto_prazo,
	coalesce(a.vl_bordero, 0) - coalesce(a.vl_desconto_bordero, 0) + coalesce(a.vl_juros_bordero, 0) + coalesce(a.vl_multa_bordero, 0) + coalesce(a.vl_out_desp_bordero, 0) vl_liquido_bordero,
	SUBSTR(obter_valor_dominio(500,a.ie_origem_titulo),1,255) ds_origem,
	a.cd_conta_contabil,
	CASE WHEN a.nr_seq_nota_fiscal IS NULL THEN null  ELSE (select max(x.nr_ordem_compra) FROM nota_fiscal x where x.nr_sequencia = a.nr_seq_nota_fiscal) END  nr_ordem_compra_nf,
	CASE WHEN a.nr_seq_nota_fiscal IS NULL THEN null  ELSE (select max(x.vl_total_nota) from nota_fiscal x where x.nr_sequencia = a.nr_seq_nota_fiscal) END  vl_total_nota,
	CASE WHEN a.nr_seq_nota_fiscal IS NULL THEN null  ELSE (select max(x.cd_operacao_nf) from nota_fiscal x where x.nr_sequencia = a.nr_seq_nota_fiscal) END  cd_operacao_nf
FROM titulo_pagar a;

