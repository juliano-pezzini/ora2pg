-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW interface_conta_item_v (ie_proc_mat, tp_item, nr_atendimento, dt_entrada_unidade, cd_item_aux, cd_item, dt_item, dt_conta, qt_item, vl_item, vl_medico, vl_anestesista, vl_filme, vl_auxiliares, vl_custo_operacional, dt_acerto_conta, dt_acerto_convenio, cd_convenio, cd_categoria, cd_setor_atendimento, ds_item, ds_unidade, cd_motivo_exc_conta, vl_unitario) AS SELECT 1 IE_PROC_MAT,
	C.IE_CLASSIFICACAO     TP_ITEM          /* 1-AMB  2-SERVICOS 3-DIARIAS */
,
	A.NR_ATENDIMENTO,
	A.DT_ENTRADA_UNIDADE,
	A.CD_PROCEDIMENTO  CD_ITEM_AUX,
	A.CD_PROCEDIMENTO_CONVENIO  CD_ITEM,
	A.DT_PROCEDIMENTO  DT_ITEM,
	A.DT_CONTA,
	A.QT_PROCEDIMENTO      QT_ITEM,
	A.VL_PROCEDIMENTO      VL_ITEM,
	A.VL_MEDICO            VL_MEDICO,
	A.VL_ANESTESISTA       VL_ANESTESISTA,
	A.VL_MATERIAIS         VL_FILME,
	A.VL_AUXILIARES        VL_AUXILIARES,
	A.VL_CUSTO_OPERACIONAL VL_CUSTO_OPERACIONAL,
	A.DT_ACERTO_CONTA,
	A.DT_ACERTO_CONVENIO,
	A.CD_CONVENIO,
	A.CD_CATEGORIA,
	A.CD_SETOR_ATENDIMENTO,
	C.DS_PROCEDIMENTO      DS_ITEM,
	'Un' DS_UNIDADE,
	A.CD_MOTIVO_EXC_CONTA,
	(A.VL_PROCEDIMENTO / 	CASE WHEN A.QT_PROCEDIMENTO=0 THEN 1  ELSE A.QT_PROCEDIMENTO END ) VL_UNITARIO
FROM PROCEDIMENTO C,
	PROCEDIMENTO_PACIENTE A
WHERE (A.CD_PROCEDIMENTO       = C.CD_PROCEDIMENTO)
  AND (A.IE_ORIGEM_PROCED      = C.IE_ORIGEM_PROCED)

UNION

SELECT 2 IE_PROC_MAT,
	CASE WHEN W.IE_TIPO_MATERIAL=1 THEN '1'  ELSE '2' END      TP_ITEM        /* 1-MATERIAL 2-	MED.GENERICO 3-MED.COMERC. */
,
	X.NR_ATENDIMENTO,
	X.DT_ENTRADA_UNIDADE,
	X.CD_MATERIAL CD_ITEM_AUX,
	X.CD_MATERIAL_CONVENIO CD_ITEM,
	X.DT_ATENDIMENTO       DT_ITEM,
	X.DT_CONTA,
	X.QT_MATERIAL          QT_ITEM,
	X.VL_MATERIAL          VL_ITEM,
	0                      VL_MEDICO,
	0                      VL_ANESTESISTA,
	0                      VL_FILME,
	0                      VL_AUXILIARES,
	0                      VL_CUSTO_OPERACIONAL,
	X.DT_ACERTO_CONTA,
	X.DT_ACERTO_CONVENIO,
	X.CD_CONVENIO,
	X.CD_CATEGORIA,
	X.CD_SETOR_ATENDIMENTO,
	W.DS_MATERIAL          DS_ITEM,
	W.CD_UNIDADE_MEDIDA_CONSUMO DS_UNIDADE,
	X.CD_MOTIVO_EXC_CONTA,
	X.VL_UNITARIO
FROM MATERIAL W,
	MATERIAL_ATEND_PACIENTE X
WHERE (X.CD_MATERIAL           = W.CD_MATERIAL);

