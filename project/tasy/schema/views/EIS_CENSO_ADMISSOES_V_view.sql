-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_censo_admissoes_v (cd_estabelecimento, ie_tipo_atendimento, dt_referencia, ds_tipo_atendimento, ie_periodo, qt_admissao, nr_admissoes, pr_percentual, vl_meta_parcial) AS select	a.cd_estabelecimento,
	a.ie_tipo_atendimento,
	a.dt_referencia,
	substr(obter_valor_dominio(12, a.ie_tipo_atendimento),1,200) ds_tipo_atendimento,
	a.ie_periodo,
	b.qt_admissao,
	sum(a.nr_admissoes) nr_admissoes,
	(dividir((sum(a.nr_admissoes) - b.qt_admissao) , b.qt_admissao) * 100) pr_percentual,
	(dividir(b.qt_admissao,obter_qt_dias_mes(LOCALTIMESTAMP)) * TO_CHAR(LOCALTIMESTAMP,'dd')) vl_meta_parcial
FROM	eis_ocupacao_hospitalar a,
	eis_meta_admissao_atend b
where	a.ie_tipo_atendimento = b.ie_tipo_atendimento
and	a.dt_referencia = trunc(b.dt_referencia,'month')
group	by a.ie_tipo_atendimento,
	a.dt_referencia,
	a.cd_estabelecimento,
	a.ie_periodo,
	b.qt_admissao;

