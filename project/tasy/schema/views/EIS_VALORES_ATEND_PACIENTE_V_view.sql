-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_valores_atend_paciente_v (dt_referencia, cd_estabelecimento, dt_entrada, nr_atendimento, cd_setor_atendimento, ie_tipo, dt_conta, cd_procedimento, qt_procedimento, vl_procedimento, vl_medico, vl_anestesista, vl_materiais, vl_auxiliares, vl_custo_operacional, vl_material, dt_acerto_conta, nr_interno_conta, dt_acerto_convenio, cd_convenio, cd_categoria, nr_doc_convenio, cd_medico, nm_medico, ie_cobra_pf_pj, cd_acao, cd_motivo_exc_conta, dt_procedimento, cd_proced, cd_conta_contabil, nr_lote_contabil, ds_setor_atendimento, ds_procedimento, ds_conta_paciente, ds_convenio) AS select	trunc(coalesce(dt_mesano_referencia,LOCALTIMESTAMP),'month') dt_referencia,
	cd_estabelecimento, 
	to_date(to_char(a.dt_entrada_unidade, 'dd/mm/yyyy'),'dd/mm/yyyy') dt_entrada, 
   	a.nr_atendimento, 
	a.cd_setor_atendimento, 
    	1 ie_tipo, 
    	a.dt_conta, 
    	a.cd_procedimento, 
    	a.qt_procedimento, 
    	a.vl_procedimento , 
    	a.vl_medico, 
    	a.vl_anestesista, 
    	a.vl_materiais, 
    	a.vl_auxiliares, 
    	a.vl_custo_operacional, 
	0 vl_material, 
    	a.dt_acerto_conta, 
	a.nr_interno_conta, 
    	a.dt_acerto_convenio, 
    	a.cd_convenio, 
    	a.cd_categoria, 
    	a.nr_doc_convenio, 
    	a.cd_medico_executor cd_medico, 
	substr(obter_nome_medico(a.cd_medico_executor,'N'),1,100) nm_medico, 
    	a.ie_cobra_pf_pj, 
    	a.cd_acao, 
    	a.cd_motivo_exc_conta, 
    	a.dt_procedimento, 
    	a.cd_procedimento cd_proced, 
	a.cd_conta_contabil, 
	a.nr_lote_contabil, 
	obter_nome_setor(cd_setor_atendimento) ds_setor_atendimento, 
	obter_descricao_procedimento(cd_procedimento,ie_origem_proced) ds_procedimento, 
	b.nr_interno_conta || ' - '||obter_pessoa_atendimento(b.nr_atendimento,'N') ds_conta_paciente, 
	obter_nome_convenio(cd_convenio) ds_convenio 
FROM	procedimento_paciente a, 
	conta_paciente b 
where	a.nr_interno_conta = b.nr_interno_conta 

union all
 
select 	trunc(coalesce(dt_mesano_referencia,LOCALTIMESTAMP),'month'), 
	cd_estabelecimento, 
	to_date(to_char(a.dt_entrada_unidade, 'dd/mm/yyyy'),'dd/mm/yyyy'), 
    	a.nr_atendimento, 
	a.cd_setor_atendimento, 
    	2 tipo, 
    	a.dt_conta, 
    	a.cd_material codigo, 
    	a.qt_material quantidade, 
    	0, 
    	0, 
    	0, 
    	0, 
    	0, 
	0, 
	a.vl_material, 
    	a.dt_acerto_conta, 
	a.nr_interno_conta, 
    	a.dt_acerto_convenio, 
    	a.cd_convenio, 
    	a.cd_categoria, 
    	a.nr_doc_convenio, 
    	null cd_medico, 
	null nm_medico, 
    	null cobra_pf_pj, 
    	a.cd_acao, 
    	a.cd_motivo_exc_conta, 
    	a.dt_atendimento dt_execucao, 
    	a.cd_proced_referencia codigo_ref, 
	a.cd_conta_contabil, 
	a.nr_lote_contabil, 
	obter_nome_setor(cd_setor_atendimento) ds_setor_atendimento, 
	null, 
	b.nr_interno_conta || ' - '||obter_pessoa_atendimento(b.nr_atendimento,'N') ds_conta_paciente, 
	obter_nome_convenio(cd_convenio) ds_convenio 
from	material_atend_paciente a, 
	conta_paciente b 
where	a.nr_interno_conta = b.nr_interno_conta;

