-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_fluxo_caixa_v (cd_empresa, cd_estabelecimento, ie_periodo, dt_referencia, vl_saldo, cd_conta_financ, ds_conta_financ) AS select	b.cd_empresa,
	a.cd_estabelecimento,
	a.ie_periodo,
	a.dt_referencia,
	sum(a.vl_fluxo) vl_saldo,
	b.cd_conta_financ,
	b.ds_conta_financ
FROM	conta_financeira b,
	fluxo_caixa a
where	a.cd_conta_financ		= b.cd_conta_financ
and	a.ie_classif_fluxo		= 'P'
and	trunc(a.dt_referencia,'dd')	< trunc(LOCALTIMESTAMP, 'dd')
group by
	b.cd_empresa,
	a.cd_estabelecimento,
	a.ie_periodo,
	a.dt_referencia,
	b.cd_conta_financ,
	b.ds_conta_financ

union

select	b.cd_empresa,
	a.cd_estabelecimento,
	a.ie_periodo,
	a.dt_referencia,
	sum(a.vl_fluxo) vl_saldo,
	b.cd_conta_financ,
	b.ds_conta_financ
from	conta_financeira b,
	fluxo_caixa a
where	a.cd_conta_financ		= b.cd_conta_financ
and	a.ie_classif_fluxo		= 'R'
and	trunc(a.dt_referencia, 'dd')	>= trunc(LOCALTIMESTAMP, 'dd')
group by
	b.cd_empresa,
	a.cd_estabelecimento,
	a.ie_periodo,
	a.dt_referencia,
	b.cd_conta_financ,
	b.ds_conta_financ;

