-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_qua_nao_conformidade_v (nr_seq_nao_conform, cd_estabelecimento, dt_abertura, ie_status, nr_seq_tipo, ds_tipo_nc, ds_setor_atendimento, cd_setor_atendimento, ds_setor_resp, cd_setor_resp, ds_setor_eficacia, cd_setor_eficacia, usuario_abertura, usuario_responsavel, nr_seq_evento, cd_pf_referencia, nm_pessoa_referencia, nr_seq_classificacao, ds_classificacao, nr_seq_tipo_disp_item, ds_tipo_disp_item, ie_dano_paciente, ds_dano_paciente, nr_seq_subtipo, ds_subtipo_nc, nr_seq_tipo_causa, nr_seq_tipo_causa_especific, ds_tipo_causa, ds_tipo_causa_especific, ie_eficacia, nr_ano, cd_ano) AS select	a.nr_sequencia nr_seq_nao_conform,
        a.cd_estabelecimento,
        a.dt_abertura,
        a.ie_status,
        a.nr_seq_tipo,
        t.ds_tipo_nc,
        substr(obter_nome_setor(a.cd_setor_atendimento),1,100) ds_setor_atendimento,
        a.cd_setor_atendimento,
        substr(obter_nome_setor(a.cd_setor_resp),1,100) ds_setor_resp,
        a.cd_setor_resp,
        substr(obter_nome_setor(a.cd_setor_eficacia),1,100) ds_setor_eficacia,
        a.cd_setor_eficacia,
        substr(obter_usuario_pessoa(a.cd_pf_abertura),1,100) usuario_abertura,
        substr(obter_usuario_pessoa(a.cd_pf_resp_ocorrencia),1,100) usuario_responsavel,
        a.nr_seq_evento,
        a.cd_pf_referencia,
        substr(obter_nome_pf(a.cd_pf_referencia),1,255) nm_pessoa_referencia,
        a.nr_seq_classificacao,
        substr(obter_descricao_padrao('QUA_NC_CLASSIFICACAO','DS_CLASSIFICACAO',a.nr_seq_classificacao),1,255) ds_classificacao,
        a.nr_seq_tipo_disp_item,
        substr(obter_descricao_padrao('QUA_NC_TIPO_DISP_ITEM','DS_TIPO_DISPOSICAO',a.nr_seq_tipo_disp_item),1,255) ds_tipo_disp_item,
        coalesce(a.ie_dano_paciente,'N') ie_dano_paciente,
        CASE WHEN coalesce(a.ie_dano_paciente,'N')='N' THEN 'Nao' WHEN coalesce(a.ie_dano_paciente,'N')='S' THEN 'Sim' END  ds_dano_paciente,
        a.nr_seq_subtipo,
        s.ds_subtipo ds_subtipo_nc,
        c.nr_seq_tipo_causa,
        c.nr_seq_tipo_causa_especific,
        substr(obter_tipo_causa(c.nr_seq_tipo_causa),1,60) ds_tipo_causa,
        substr(obter_descricao_padrao('QUA_TIPO_CAUSA_ESPECIFIC','DS_ESPECIFICACAO',c.nr_seq_tipo_causa_especific),1,255) ds_tipo_causa_especific,
        substr(obter_eficacia_qua_nao_conform(a.nr_sequencia), 1, 255) ie_eficacia,
        to_char(a.dt_abertura, 'YYYY') nr_ano,
        to_char(a.dt_abertura, 'YYYY') cd_ano
FROM qua_tipo_nao_conform t, qua_nao_conformidade a
LEFT OUTER JOIN qua_subtipo_nao_conform s ON (a.nr_seq_subtipo = s.nr_sequencia)
LEFT OUTER JOIN qua_nao_conform_causa c ON (a.nr_sequencia = c.nr_seq_nao_conform)
WHERE t.nr_sequencia	= a.nr_seq_tipo;

