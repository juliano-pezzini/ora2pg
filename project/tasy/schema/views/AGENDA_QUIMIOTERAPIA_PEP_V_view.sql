-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW agenda_quimioterapia_pep_v (nr_sequencia, dt_atualizacao, nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec, cd_pessoa_fisica, nr_seq_prof, nr_seq_local, nr_seq_atendimento, dt_agenda, nr_minuto_duracao, ie_status_agenda, ie_tipo_pend_agenda, dt_aguardando, dt_em_quimio, dt_executada, dt_cancelada, nr_atendimento, nr_seq_mot_reagendamento, ie_tipo_agendamento, ds_observacao, cd_estabelecimento, cd_medico_resp, nr_seq_atend_sim, nr_seq_ageint_item, nr_seq_agenda_cons, nr_seq_mot_cancelamento, dt_falta, nm_usuario_cancel, ds_motivo_status, nr_seq_pend_agenda, ie_anestesia, ie_encaixe, nr_seq_mot_falta, ie_reserva, nm_usuario_confirm_forc, dt_suspenso, nr_seq_medicacao, cd_protocolo, dt_confirmacao, dt_em_preparo, dt_medic_liberado, nr_seq_pac_senha_fila, ie_alocado, nr_seq_paciente, nm_pessoa_fisica, ds_local, ds_protocolo_medic, ie_intercorrencia, nr_duracao_real, nm_medico_resp, ds_motivo_cancelamento, nr_ciclo, ds_dia_ciclo, ds_observacao_grid, ds_motivo_falta, ds_classif_protocolo, ds_cor_classif_protocolo, ds_cor_fonte_autor, ds_cor_fundo_autor, ds_estagio_autor, ds_prim_observacao, dt_suspensao, hr_chegada, hr_fim, hr_inicio, nr_prontuario_f) AS select   a.NR_SEQUENCIA,a.DT_ATUALIZACAO,a.NM_USUARIO,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC,a.CD_PESSOA_FISICA,a.NR_SEQ_PROF,a.NR_SEQ_LOCAL,a.NR_SEQ_ATENDIMENTO,a.DT_AGENDA,a.NR_MINUTO_DURACAO,a.IE_STATUS_AGENDA,a.IE_TIPO_PEND_AGENDA,a.DT_AGUARDANDO,a.DT_EM_QUIMIO,a.DT_EXECUTADA,a.DT_CANCELADA,a.NR_ATENDIMENTO,a.NR_SEQ_MOT_REAGENDAMENTO,a.IE_TIPO_AGENDAMENTO,a.DS_OBSERVACAO,a.CD_ESTABELECIMENTO,a.CD_MEDICO_RESP,a.NR_SEQ_ATEND_SIM,a.NR_SEQ_AGEINT_ITEM,a.NR_SEQ_AGENDA_CONS,a.NR_SEQ_MOT_CANCELAMENTO,a.DT_FALTA,a.NM_USUARIO_CANCEL,a.DS_MOTIVO_STATUS,a.NR_SEQ_PEND_AGENDA,a.IE_ANESTESIA,a.IE_ENCAIXE,a.NR_SEQ_MOT_FALTA,a.IE_RESERVA,a.NM_USUARIO_CONFIRM_FORC,a.DT_SUSPENSO,a.NR_SEQ_MEDICACAO,a.CD_PROTOCOLO,a.DT_CONFIRMACAO,a.DT_EM_PREPARO,a.DT_MEDIC_LIBERADO,a.NR_SEQ_PAC_SENHA_FILA,a.IE_ALOCADO,
         	 substr(Qt_Obter_Seq_Pac_Seq_Atend(nr_seq_atendimento, nm_usuario),1,20) NR_SEQ_PACIENTE,
	 substr(obter_nome_pf(cd_pessoa_fisica),1,60) NM_PESSOA_FISICA,
	 substr(OBTER_DESC_LOCAL_QT(nr_seq_local,'L'),1,255) DS_LOCAL,
	 substr(coalesce(obter_desc_prot_medic(qt_obter_seq_pac_seq_atend(nr_seq_atendimento, nm_usuario)),
		    qt_obter_dados_pendencia(nr_seq_pend_agenda, 'DPM', null)), 1, 255) DS_PROTOCOLO_MEDIC,
	 substr(Qt_Obter_Se_Possui_Intercor(nr_sequencia),1,20) IE_INTERCORRENCIA,
	 Obter_Min_Entre_Datas(dt_em_quimio, dt_executada,1) NR_DURACAO_REAL,
	 substr(obter_nome_medico(cd_medico_resp,'N'),1,255) NM_MEDICO_RESP,
	 substr(qt_obter_desc_motivo_canc(nr_seq_mot_cancelamento),1,255) DS_MOTIVO_CANCELAMENTO,
	 substr(qt_obter_dados_pac_atend(nr_seq_atendimento,'C'),1,50) NR_CICLO,
	 substr(qt_obter_dados_pac_atend(nr_seq_atendimento,'DC'),1,50) DS_DIA_CICLO,
	 substr(ds_observacao,1,255) DS_OBSERVACAO_GRID,
	 substr(qt_obter_desc_motivo_falta(nr_seq_mot_falta),1,255) DS_MOTIVO_FALTA,
	 substr(qt_obter_dados_pendencia(nr_seq_pend_agenda, 'CLP', null),1,255) DS_CLASSIF_PROTOCOLO,
	 substr(Qt_Obter_Dados_Pendencia(nr_seq_pend_agenda,'COR', nm_usuario),1,20) DS_COR_CLASSIF_PROTOCOLO,
	 substr(qt_obter_cor_estagio_autor(nr_seq_atendimento,'F'),1,15) DS_COR_FONTE_AUTOR,
	 substr(qt_obter_cor_estagio_autor(nr_seq_atendimento,'B'),1,15) DS_COR_FUNDO_AUTOR,
	 substr(qt_obter_cor_estagio_autor(nr_seq_atendimento,'W'),1,15) DS_ESTAGIO_AUTOR,
	 SUBSTR(obter_prim_observacao(NR_SEQUENCIA,IE_TIPO_PEND_AGENDA,'Q'),1,200) DS_PRIM_OBSERVACAO,
	 qt_obter_dt_suspensao(nr_seq_atendimento) DT_SUSPENSAO,
	 TO_CHAR(dt_aguardando,'hh24:mi') HR_CHEGADA,
	 TO_CHAR(coalesce(a.DT_EXECUTADA, DT_AGENDA) + (nr_minuto_duracao / 1440), 'hh24:mi') HR_FIM,
	 TO_CHAR(coalesce(a.DT_EXECUTADA, DT_AGENDA), 'hh24:mi:ss')	HR_INICIO,	
	 Obter_Prontuario_Paciente(cd_pessoa_fisica) NR_PRONTUARIO_F
FROM     	agenda_quimio a;

