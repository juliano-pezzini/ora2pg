-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eme_dependente_v (nr_seq_contrato, nr_seq_pessoa, cd_contrato, nm_contrato, cd_cgc, dt_cancelamento, cd_pessoa_fisica, dt_contrato, cd_codigo_convenio, ds_tipo_servico, ds_contratado, nm_dependente, ds_cobertura, cd_convenio, cd_categoria, cd_tipo_acomodacao) AS SELECT	A.NR_SEQUENCIA NR_SEQ_CONTRATO,
	C.NR_SEQUENCIA NR_SEQ_PESSOA, 
	A.CD_CONTRATO, 
	A.NM_CONTRATO, 
	A.CD_CGC, 
	A.dt_cancelamento, 
	C.cd_pessoa_fisica, 
	TO_CHAR(A.DT_CONTRATO,'DD/MM/YYYY') DT_CONTRATO, 
	C.CD_CODIGO_CONVENIO, 
	E.DS_TIPO_SERVICO, 
	SUBSTR(OBTER_NOME_PF_PJ(A.CD_PESSOA_FISICA,A.CD_CGC),1,100) DS_CONTRATADO, 
	SUBSTR(OBTER_NOME_PF_PJ(C.CD_PESSOA_FISICA, C.CD_CGC),1,60) NM_DEPENDENTE, 
	SUBSTR(OBTER_TIPO_COBERTURA(A.NR_SEQUENCIA),1,60) DS_COBERTURA, 
	A.cd_convenio, 
	A.cd_categoria, 
	A.cd_tipo_acomodacao 
FROM	EME_TIPO_COBERTURA D, 
	EME_TIPO_SERVICO E, 
	EME_CONTRATO A, 
	EME_PF_CONTRATO C 
WHERE	C.NR_SEQ_CONTRATO = A.NR_SEQUENCIA 
AND	A.NR_SEQ_COBERTURA = D.NR_SEQUENCIA 
AND	C.NR_SEQ_TIPO_SERVICO = E.NR_SEQUENCIA 
AND	D.IE_PESSOA_FISICA = 'S' 
AND	A.DT_CANCELAMENTO is null 
and	C.dt_cancelamento is null 
ORDER BY 1;

