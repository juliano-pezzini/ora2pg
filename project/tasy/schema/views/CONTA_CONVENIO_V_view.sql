-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW conta_convenio_v (nr_atendimento, nr_interno_conta, nr_seq_protocolo, cd_convenio, dt_item, cd_item, vl_item, qt_item) AS SELECT A.NR_ATENDIMENTO,
	 A.NR_INTERNO_CONTA,
	 A.NR_SEQ_PROTOCOLO,
	 A.CD_CONVENIO_PARAMETRO CD_CONVENIO,
	 TO_CHAR(B.DT_PROCEDIMENTO,'DD/MM/YYYY') DT_ITEM,
	 B.CD_PROCEDIMENTO_CONVENIO CD_ITEM,
	 SUM(B.VL_PROCEDIMENTO) VL_ITEM,
	 SUM(B.QT_PROCEDIMENTO) QT_ITEM
FROM	CONTA_PACIENTE A,
	PROCEDIMENTO_PACIENTE B
WHERE	A.NR_INTERNO_CONTA	= B.NR_INTERNO_CONTA
GROUP BY 	A.NR_ATENDIMENTO,
	 	A.NR_INTERNO_CONTA,
	 	A.NR_SEQ_PROTOCOLO,
		A.CD_CONVENIO_PARAMETRO,
	 	TO_CHAR(B.DT_PROCEDIMENTO,'DD/MM/YYYY'),
	 	B.CD_PROCEDIMENTO_CONVENIO

UNION

SELECT A.NR_ATENDIMENTO,
	 A.NR_INTERNO_CONTA,
	 A.NR_SEQ_PROTOCOLO,
	 A.CD_CONVENIO_PARAMETRO CD_CONVENIO,
	 TO_CHAR(B.DT_ATENDIMENTO,'DD/MM/YYYY') DT_ITEM,
	 B.CD_MATERIAL_CONVENIO CD_ITEM,
	 SUM(B.VL_MATERIAL) VL_ITEM,
	 SUM(B.QT_MATERIAL) QT_ITEM
FROM	CONTA_PACIENTE A,
	MATERIAL_ATEND_PACIENTE B
WHERE	A.NR_INTERNO_CONTA	= B.NR_INTERNO_CONTA
GROUP BY 	A.NR_ATENDIMENTO,
	 	A.NR_INTERNO_CONTA,
	 	A.NR_SEQ_PROTOCOLO,
		A.CD_CONVENIO_PARAMETRO,
	 	TO_CHAR(B.DT_ATENDIMENTO,'DD/MM/YYYY'),
	 	B.CD_MATERIAL_CONVENIO;

