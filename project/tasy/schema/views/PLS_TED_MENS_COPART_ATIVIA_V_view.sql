-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_ted_mens_copart_ativia_v (nm_pessoa_fisica, cd_usuario_plano, nr_nota_fiscal, cd_plano, nm_fantasia, dt_contratacao, nr_cpf, cd_procedimento, ds_procedimento, vl_coparticipacao, cd_sub_servico, dt_cancelamento, nr_seq_lote_ted) AS select	a.nm_pessoa_fisica,
	e.cd_usuario_plano, 
	' ' nr_nota_fiscal, 
	g.nr_sequencia cd_plano, 
	g.nm_fantasia, 
	b.dt_contratacao, 
	a.nr_cpf, 
	coalesce(substr(f.cd_procedimento_internacao,1,255),coalesce(substr(pls_obter_dados_conta_proc(f.nr_seq_conta_proc,'C'),1,255),substr(pls_obter_dados_conta_mat(f.nr_seq_conta_mat,'C'),1,255))) cd_procedimento, 
	coalesce(substr(obter_desc_procedimento(f.cd_procedimento_internacao, f.ie_origem_proced_internacao),1,255),coalesce(substr(pls_obter_dados_conta_proc(f.nr_seq_conta_proc,'D'),1,255),substr(pls_obter_dados_conta_mat(f.nr_seq_conta_mat,'D'),1,255))) ds_procedimento, 
	f.VL_COPARTICIPACAO, 
	CASE WHEN h.ie_tipo_guia='3' THEN '1' WHEN h.ie_tipo_guia='4' THEN '2' WHEN h.ie_tipo_guia='5' THEN '3' END  cd_sub_servico, 
	' ' DT_CANCELAMENTO, 
	d.NR_SEQ_LOTE_TED 
FROM	pls_conta			h, 
	pls_plano			g, 
	pls_conta_coparticipacao	f, 
	pls_segurado_carteira		e, 
	PLS_MENSALIDADE_TED		d, 
	pls_mensalidade_segurado	c, 
	pls_segurado			b, 
	pessoa_fisica			a 
where	d.nr_seq_mensalidade		= c.nr_seq_mensalidade 
and	c.nr_seq_segurado		= b.nr_sequencia 
and	a.cd_pessoa_fisica		= b.cd_pessoa_fisica 
and	e.nr_seq_segurado		= b.nr_sequencia 
and	f.NR_SEQ_MENSALIDADE_SEG	= c.nr_sequencia 
and	f.nr_seq_conta			= h.nr_sequencia 
and	b.nr_seq_plano			= g.nr_sequencia;

