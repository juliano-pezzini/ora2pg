-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_tiss_contas_medicas_v (ds_versao, ds_tipo_transacao, dt_transacao, hr_transacao, cd_ans, cd_interno, nr_seq_pls_guia_plano, nr_seq_pls_prot_situacao, nr_seq_pls_protocolo, nr_seq_prot_retorno, ds_tipo_xml, ie_tipo) AS select	distinct
	'2.02.01' ds_versao,
	'RESPOSTA_SOLICITACAO' ds_tipo_transacao,
	coalesce(a.dt_emissao, LOCALTIMESTAMP) dt_transacao,
	coalesce(a.dt_emissao, LOCALTIMESTAMP) hr_transacao,
	b.cd_ans,
	a.cd_medico_solicitante cd_interno,
	a.nr_sequencia nr_seq_pls_guia_plano,
	null nr_seq_pls_prot_situacao,
	null nr_seq_pls_protocolo,
	null nr_seq_prot_retorno,
	'RESPOSTA' ds_tipo_xml,
	'1' ie_tipo
FROM pls_guia_plano a, pls_plano c
LEFT OUTER JOIN pls_outorgante b ON (c.nr_seq_outorgante = b.nr_sequencia)
WHERE a.nr_seq_plano		= c.nr_sequencia and ie_status 		in ('1','2','3') and a.dt_cancelamento 	is null

union

select	distinct
	'2.02.01' ds_versao,
	'PROTOCOLO_RECEBIMENTO' ds_tipo_transacao,
	coalesce(a.dt_mes_competencia, LOCALTIMESTAMP) dt_transacao,
	coalesce(a.dt_mes_competencia, LOCALTIMESTAMP) hr_transacao,
	b.cd_ans,
	null cd_interno,
	null nr_seq_pls_guia_plano,
	null nr_seq_pls_prot_situacao,
	a.nr_sequencia nr_seq_pls_protocolo,
	null nr_seq_prot_retorno,
	null ds_tipo_xml,
	'2' ie_tipo
from	pls_protocolo_conta a,
	pls_outorgante b
where	a.nr_seq_outorgante	= b.nr_sequencia

union

select	distinct
	'2.02.01' ds_versao,
	'STATUS_AUTORIZACAO' ds_tipo_transacao,
	coalesce(a.dt_emissao, LOCALTIMESTAMP) dt_transacao,
	coalesce(a.dt_emissao, LOCALTIMESTAMP) hr_transacao,
	b.cd_ans,
	a.cd_medico_solicitante cd_interno,
	a.nr_sequencia nr_seq_pls_guia_plano,
	null nr_seq_pls_prot_situacao,
	null nr_seq_pls_protocolo,
	null nr_seq_prot_retorno,
	'STATUS' ds_tipo_xml,
	'3' ie_tipo
FROM pls_guia_plano a, pls_plano c
LEFT OUTER JOIN pls_outorgante b ON (c.nr_seq_outorgante = b.nr_sequencia)
WHERE a.nr_seq_plano		= c.nr_sequencia
 
union

select	distinct
	'2.02.01' ds_versao,
	'CANCELA_GUIA' ds_tipo_transacao,
	coalesce(a.dt_emissao, LOCALTIMESTAMP) dt_transacao,
	coalesce(a.dt_emissao, LOCALTIMESTAMP) hr_transacao,
	b.cd_ans,
	a.cd_medico_solicitante cd_interno,
	a.nr_sequencia nr_seq_pls_guia_plano,
	null nr_seq_pls_prot_situacao,
	null nr_seq_pls_protocolo,
	null nr_seq_prot_retorno,
	null ds_tipo_xml,
	'4' ie_tipo
from	pls_outorgante b,
	pls_plano c,
	pls_guia_plano a
where	c.nr_seq_outorgante 	= b.nr_sequencia
and	a.nr_seq_plano		= c.nr_sequencia
and	a.dt_cancelamento 	is not null

union

select	distinct
	'2.02.01' ds_versao,
	'SITUACAO_PROTOCOLO' ds_tipo_transacao,
	coalesce(a.dt_mes_competencia, LOCALTIMESTAMP) dt_transacao,
	coalesce(a.dt_mes_competencia, LOCALTIMESTAMP) hr_transacao,
	b.cd_ans,
	null cd_interno,
	null nr_seq_pls_guia_plano,
	a.nr_sequencia nr_seq_pls_prot_situacao,
	null nr_seq_pls_protocolo,
	null nr_seq_prot_retorno,
	null ds_tipo_xml,
	'5' ie_tipo
from	pls_protocolo_conta a,
	pls_prestador c,
	pls_outorgante b
where	a.nr_seq_prestador	= c.nr_sequencia
and	a.nr_seq_outorgante	= b.nr_sequencia

union

select	distinct
	'2.02.01' ds_versao,
	'SITUACAO_PROTOCOLO' ds_tipo_transacao,
	coalesce(a.dt_mes_competencia, LOCALTIMESTAMP) dt_transacao,
	coalesce(a.dt_mes_competencia, LOCALTIMESTAMP) hr_transacao,
	b.cd_ans,
	null cd_interno,
	null nr_seq_pls_guia_plano,
	a.nr_sequencia nr_seq_pls_prot_situacao,
	null nr_seq_pls_protocolo,
	null nr_seq_prot_retorno,
	null ds_tipo_xml,
	'6' ie_tipo
from	pls_protocolo_conta a,
	pls_prestador c,
	pls_outorgante b
where	a.nr_seq_prestador_imp	= c.nr_sequencia
and	a.nr_seq_outorgante	= b.nr_sequencia
and	coalesce(a.nr_seq_prestador_imp,0) = 0

union

select	distinct
	'2.02.01' ds_versao,
	'DEMONSTRATIVO_PAGAMENTO' ds_tipo_transacao,
	coalesce(a.dt_mes_competencia, LOCALTIMESTAMP) dt_transacao,
	coalesce(a.dt_mes_competencia, LOCALTIMESTAMP) hr_transacao,
	b.cd_ans,
	null cd_interno,
	null nr_seq_pls_guia_plano,
	null nr_seq_pls_prot_situacao,
	null nr_seq_pls_protocolo,
	a.nr_sequencia nr_seq_prot_retorno,
	null ds_tipo_xml,
	'7' ie_tipo
from	pls_protocolo_conta a,
	pls_prestador c,
	pls_outorgante b
where	a.nr_seq_prestador	= c.nr_sequencia
and	a.nr_seq_outorgante	= b.nr_sequencia

union

select	distinct
	'2.02.01' ds_versao,
	'DEMONSTRATIVO_ANALISE_CONTA' ds_tipo_transacao,
	coalesce(a.dt_mes_competencia, LOCALTIMESTAMP) dt_transacao,
	coalesce(a.dt_mes_competencia, LOCALTIMESTAMP) hr_transacao,
	b.cd_ans,
	null cd_interno,
	null nr_seq_pls_guia_plano,
	null nr_seq_pls_prot_situacao,
	null nr_seq_pls_protocolo,
	a.nr_sequencia nr_seq_prot_retorno,
	null ds_tipo_xml,
	'8' ie_tipo
from	pls_protocolo_conta a,
	pls_prestador c,
	pls_outorgante b
where	a.nr_seq_prestador	= c.nr_sequencia
and	a.nr_seq_outorgante	= b.nr_sequencia;

