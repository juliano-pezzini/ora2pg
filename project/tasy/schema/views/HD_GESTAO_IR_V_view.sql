-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW hd_gestao_ir_v (nm_pessoa_fisica, ds_escala, nr_seq_turno, ds_turno, ie_dialise, ie_finalizada, ie_cancelada, ie_instalado, ie_dial_liberado, ds_dial_liberado, dt_chegada, dt_saida, ds_unid_dialise, nr_seq_unid_dialise, qt_duracao, nr_seq_dialise_atual, nr_seq_dialise_ultima, ie_tipo_dializador, nr_seq_dialisador_atual, nr_dialise_atual, nr_atendimento, ds_anticoagulacao, ds_dialisato, ds_hematocrito, ds_sexo, qt_idade, qt_peso_ideal, qt_altura, ie_pode_pesar, nr_seq_maquina, nr_seq_ponto_acesso, nr_dialise_atend, ds_imagem, ds_classificacao, nr_seq_classif, cd_pessoa_fisica, ds_status_tx, ie_status_tx, qt_peso_pre, qt_pa_pre_sist, qt_pa_pre_diast, qt_pa_sist_pre_pe, qt_pa_diast_pre_deitado, nr_ultima_prescr, dt_ultima_prescr, ie_tipo_dialise, dt_dialise_retro, ie_paciente_agudo, nr_seq_unidade_atual, cd_convenio, cd_estabelecimento, cd_estagio_hipertensao, ds_motivo_fim, ds_observacao, dt_atualizacao, dt_atualizacao_nrec, dt_fim, dt_inicio, dt_inicio_tratamento, ie_diabetico, ie_hipertenso, ie_paciente_chegou, ie_paciente_transito, ie_situacao, nm_usuario, nm_usuario_nrec, ds_setor_sessao, ds_ponto_sessao, ds_tratamento, ds_acesso, ie_externo) AS SELECT	SUBSTR(obter_nome_pf(CD_PESSOA_FISICA),1,60) nm_pessoa_fisica,
		SUBSTR(hd_obter_escala_prc(CD_PESSOA_FISICA,'D'),1,200) ds_escala,
		(select hd_obter_turno_prc(CD_PESSOA_FISICA, 'C') ) nr_seq_turno,
		SUBSTR(hd_obter_turno_prc(CD_PESSOA_FISICA, 'D'),1,200) ds_turno,
		SUBSTR(hd_obter_se_em_dialise(cd_pessoa_fisica,'E'),1,1) ie_dialise,
		SUBSTR(hd_obter_se_em_dialise(cd_pessoa_fisica,'F'),1,1) ie_finalizada,
		SUBSTR(hd_obter_se_em_dialise(cd_pessoa_fisica,'C'),1,1) ie_cancelada,
		SUBSTR(hd_obter_se_em_dialise(cd_pessoa_fisica,'I'),1,1) ie_instalado,
		SUBSTR(hd_obter_se_dial_liberado(cd_pessoa_fisica),1,1) ie_dial_liberado,
		CASE WHEN hd_obter_se_dial_liberado(cd_pessoa_fisica)='S' THEN  obter_desc_expressao(719927)  ELSE obter_desc_expressao(327114) END  ds_dial_liberado,
		TO_DATE(hd_obter_chegada_paciente(cd_pessoa_fisica,'N'), 'dd/mm/yyyy hh24:mi:ss') dt_chegada,
		TO_DATE(hd_obter_saida_pac(cd_pessoa_fisica), 'dd/mm/yyyy hh24:mi:ss') dt_saida,
		SUBSTR(hd_obter_desc_unid_dialise(a.nr_seq_unidade_atual),1,200) ds_unid_dialise,
		SUBSTR(a.nr_seq_unidade_atual,1,200) nr_seq_unid_dialise,
		SUBSTR(hd_obter_dados_prescr_dialise(cd_pessoa_fisica, 'DR'),1,50) qt_duracao,
		hd_obter_hemodialise_atual(cd_pessoa_fisica, 'A') nr_seq_dialise_atual,
		hd_obter_hemodialise_atual(cd_pessoa_fisica, 'U') nr_seq_dialise_ultima,
    (select max(c.ie_tipo) from hd_dializador c where c.nr_sequencia = hd_obter_dados_dialise(hd_obter_hemodialise_atual(a.cd_pessoa_fisica, 'U'),'DA')) ie_tipo_dializador,
    SUBSTR(hd_obter_dados_dialise(hd_obter_hemodialise_atual(cd_pessoa_fisica, 'U'),'DA'),1,200) nr_seq_dialisador_atual,
		SUBSTR(hd_obter_dados_dialise(hd_obter_hemodialise_atual(cd_pessoa_fisica, 'U'),'SP'),1,200) nr_dialise_atual,
		SUBSTR(hd_obter_atend_hd_Dialise(cd_pessoa_fisica,hd_obter_hemodialise_atual(cd_pessoa_fisica, 'U')),1,30) nr_atendimento,
		SUBSTR(hd_obter_protocolo_tipo_sol(cd_pessoa_fisica, 'C'),1,255) ds_anticoagulacao,
		SUBSTR(hd_obter_protocolo_tipo_sol(cd_pessoa_fisica, 'A'),1,255) ds_dialisato,
		SUBSTR(obter_ult_resultado_lab_gir(cd_pessoa_fisica, hd_obter_exame_ht_estab(cd_estabelecimento)),1,255) ds_hematocrito,
		SUBSTR(obter_sexo_pf(cd_pessoa_fisica, 'D'),1,100) ds_sexo, SUBSTR(obter_idade_pf(cd_pessoa_fisica, LOCALTIMESTAMP, 'A'),1,5) qt_idade,
		qt_peso_ideal,
		SUBSTR(obter_dados_pf(cd_pessoa_fisica, 'AL'),1,5) qt_altura, coalesce(a.ie_pode_pesar,'N') ie_pode_pesar,
		nr_seq_maquina,
		nr_seq_ponto_acesso, 
		SUBSTR(Obter_dialise_atend(hd_obter_hemodialise_atual(cd_pessoa_fisica, 'A'),hd_obter_atend_hd_Dialise(cd_pessoa_fisica,hd_obter_hemodialise_atual(cd_pessoa_fisica, 'U'))),1,255) NR_DIALISE_ATEND,
		'' ds_imagem,
		SUBSTR(hd_obter_classif_sor_pac(a.cd_pessoa_fisica,'D'),1,100) ds_classificacao,
		hd_obter_classif_sor_pac(a.cd_pessoa_fisica,'C') nr_seq_classif,
		a.cd_pessoa_fisica,
		SUBSTR(hd_obter_status_tx(a.cd_pessoa_fisica,'D'),1,80) ds_status_tx,
		SUBSTR(hd_obter_status_tx(a.cd_pessoa_fisica,'C'),1,80) ie_status_tx,
		SUBSTR(hd_obter_dados_dialise(hd_obter_hemodialise_atual(cd_pessoa_fisica, 'U'),'PP'),1,200) qt_peso_pre,
		SUBSTR(hd_obter_dados_dialise(hd_obter_hemodialise_atual(cd_pessoa_fisica, 'U'),'PSD'),1,200) qt_pa_pre_sist,
		SUBSTR(hd_obter_dados_dialise(hd_obter_hemodialise_atual(cd_pessoa_fisica, 'U'),'PDP'),1,200) qt_pa_pre_diast,
		SUBSTR(hd_obter_dados_dialise(hd_obter_hemodialise_atual(cd_pessoa_fisica, 'U'),'PSP'),1,200) qt_pa_sist_pre_pe,
		SUBSTR(hd_obter_dados_dialise(hd_obter_hemodialise_atual(cd_pessoa_fisica, 'U'),'PDD'),1,200) qt_pa_diast_pre_deitado,
		SUBSTR(hd_obter_ultima_prescr(cd_pessoa_fisica, cd_estabelecimento),1,255) nr_ultima_prescr,
		to_date(hd_obter_dt_ultima_prescr(cd_pessoa_fisica, cd_estabelecimento),'dd/mm/yyyy hh24:mi:ss') dt_ultima_prescr,
		SUBSTR(hd_obter_dados_dialise(hd_obter_hemodialise_atual(cd_pessoa_fisica, 'U'),'TD'),1,200) ie_tipo_dialise,
		hd_obter_dt_dia_retro_html5(hd_obter_hemodialise_atual(cd_pessoa_fisica, 'U')) dt_dialise_retro,
		CASE WHEN a.ie_paciente_agudo='S' THEN  obter_desc_expressao(719927)  ELSE obter_desc_expressao(327114) END  ie_paciente_agudo,
		a.nr_seq_unidade_atual,
		CD_CONVENIO,
		CD_ESTABELECIMENTO,
		CD_ESTAGIO_HIPERTENSAO,		
		DS_MOTIVO_FIM,
		DS_OBSERVACAO,
		DT_ATUALIZACAO,
		DT_ATUALIZACAO_NREC,
		DT_FIM,
		DT_INICIO,
		DT_INICIO_TRATAMENTO,
		IE_DIABETICO,
		IE_HIPERTENSO,		
		IE_PACIENTE_CHEGOU,
		IE_PACIENTE_TRANSITO,		
		IE_SITUACAO,
		NM_USUARIO,
		NM_USUARIO_NREC,
		hd_obter_local_sessao_pac(a.cd_pessoa_fisica,'DS',LOCALTIMESTAMP) ds_setor_sessao,
		hd_obter_local_sessao_pac(a.cd_pessoa_fisica,'DP',LOCALTIMESTAMP) ds_ponto_sessao,
		substr(hd_obter_tratamento(cd_pessoa_fisica),1,60) ds_tratamento,
		substr(HD_Obter_Acesso_PRC(cd_pessoa_fisica,'D'),1,60) ds_acesso,
		coalesce((SELECT 'S'
			   FROM HD_PACIENTE_INT_EXT pa
				WHERE pa.cd_pessoa_fisica = a.cd_pessoa_fisica
				and	dt_retorno is null  LIMIT 1),'N') IE_EXTERNO
FROM    hd_pac_renal_cronico a;

