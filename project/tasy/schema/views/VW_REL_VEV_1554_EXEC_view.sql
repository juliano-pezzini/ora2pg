-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW vw_rel_vev_1554_exec (nr_sequencia, nr_seq_proj, cd_pessoa_fisica, function, tester, analyst, status_dev, ie_size, librd, size, effort, tempo_prev_ct, tempo_prev_exec, tempo_extra, tempo_reteste, tempo_desenv, tempo_tech, tempo_internacionalizacao, tempo_defeitos, ex_defeitos, os_dev_t, os_test_t, os_enc_t, os_total_t, qt_horas_ct, qt_horas_round1, qt_horas_round2, qt_horas_round3, qt_horas_smoke, c_tcd, c_ad_001, c_ad_002, c_ad_003, c_ad_004, c_ad_005, nr_seq_ordenacao, ie_ordem, classificacao, priori, ex_tcd, tempo_tcd, dt_ini_ad_001, dt_fim_ad_001, ex_001, ad_001, tempo_ad_001, tempo_reteste_001, atraso_ad_001, dt_fim_prev_ad_001, dt_ini_ad_002, dt_fim_ad_002, ex_002, ad_002, tempo_ad_002, tempo_reteste_002, atraso_ad_002, dt_fim_prev_ad_002, dt_ini_ad_003, dt_fim_ad_003, ex_003, ad_003, tempo_ad_003, tempo_reteste_003, atraso_ad_003, dt_fim_prev_ad_003, dt_ini_ad_004, dt_fim_ad_004, ex_004, ad_004, tempo_ad_004, tempo_reteste_004, atraso_ad_004, dt_fim_prev_ad_004, dt_ini_ad_005, dt_fim_ad_005, ex_005, ad_005, tempo_ad_005, tempo_reteste_005, atraso_ad_005, dt_fim_prev_ad_005) AS SELECT
 VW.NR_SEQUENCIA, 
 VW.NR_SEQ_PROJ, 
 VW.CD_PESSOA_FISICA, 
 trim(both VW.DS_ATIVIDADE) FUNCTION, 
 VW.TESTER, 
 VW.ANALISTA ANALYST, 
 VW.STATUS_DEV, 
 VW.IE_SIZE, 
 VW.LIBRD, 
 IE_SIZE || ' - ' || SIZE SIZE, 
 OBTER_DIAS_TESTE_PROJ(IE_SIZE) || ' day(s)' EFFORT, 
 (OBTER_DIAS_CT_PROJ(IE_SIZE) * 7) TEMPO_PREV_CT, 
 (OBTER_DIAS_TESTE_PROJ(IE_SIZE) * 7) TEMPO_PREV_EXEC, 
 ROUND((RETORNA_TEMPO_EXEC_OS(OBTER_OS_STATUS_GERAL_PROJ(VW.NR_SEQUENCIA))/60),0) TEMPO_EXTRA, 
 ROUND((OBTER_TEMPO_EXEC_DEFEITO_PROJ(VW.NR_SEQUENCIA,12,'0')/60), 0) TEMPO_RETESTE, 
 ROUND(((OBTER_TEMPO_EXEC_DEFEITO_PROJ(VW.NR_SEQUENCIA,2,'0')+ 
     OBTER_TEMPO_EXEC_DEFEITO_PROJ(VW.NR_SEQUENCIA,33,'0'))/60), 0)TEMPO_DESENV, 
 ROUND((OBTER_TEMPO_EXEC_DEFEITO_PROJ(VW.NR_SEQUENCIA,7,'0')/60), 0) TEMPO_TECH, 
 ROUND((OBTER_TEMPO_EXEC_DEFEITO_PROJ(VW.NR_SEQUENCIA,35,'0')/60), 0) TEMPO_INTERNACIONALIZACAO, 
 ROUND((OBTER_TEMPO_EXEC_DEFEITO_PROJ(VW.NR_SEQUENCIA,-1,'0')/60), 0) TEMPO_DEFEITOS, 
 CASE WHEN(OS_TOTAL_T <> 0) THEN round((OS_ENC_T*100/OS_TOTAL_T)::numeric, 0) 
   ELSE 0 
 END EX_DEFEITOS, 
 OS_DEV_T, 
 OS_TEST_T, 
 OS_ENC_T, 
 OS_TOTAL_T, 
 FHV.QT_HORAS_CT, 
 FHV.QT_HORAS_ROUND1, 
 FHV.QT_HORAS_ROUND2, 
 FHV.QT_HORAS_ROUND3, 
 FHV.QT_HORAS_SMOKE, 
 C_TCD, 
 C_AD_001, 
 C_AD_002, 
 C_AD_003, 
 C_AD_004, 
 C_AD_005, 
 --ORDERBY FIELDS--- 
 NR_SEQ_ORDENACAO, 
 IE_ORDEM, 
 CLASSIFICACAO, 
 PRIORI, 
 ------------------ 
 EX_TCD, 
 ROUND((RETORNA_TEMPO_EXEC_OS(OBTER_OS_TCD_PROJ(VW.NR_SEQUENCIA))/60),2) TEMPO_TCD, 
 DT_INI_AD_001, 
 DT_FIM_AD_001, 
 EX_001, 
 AD_001, 
 ROUND((RETORNA_TEMPO_EXEC_OS(OBTER_OS_ADERENCIA_PROJ(VW.NR_SEQUENCIA, '1'))/60),0) TEMPO_AD_001, 
 ROUND((OBTER_TEMPO_EXEC_DEFEITO_PROJ(VW.NR_SEQUENCIA,1)/60),0) TEMPO_RETESTE_001, 
 CASE WHEN(STATUS_DEV IN ('Revision', 'Verification') AND DT_FIM_AD_001 IS NULL) THEN OBTER_ATRASO_TESTE_PROJ(DT_INI_AD_001, IE_SIZE) ELSE 0 END ATRASO_AD_001, 
 CASE WHEN(STATUS_DEV IN ('Revision', 'Verification') AND DT_FIM_AD_001 IS NULL) THEN OBTER_DT_FIM_TESTE_PREV_PROJ(DT_INI_AD_001, IE_SIZE) ELSE NULL END DT_FIM_PREV_AD_001, 
 DT_INI_AD_002, 
 DT_FIM_AD_002, 
 EX_002, 
 AD_002, 
 ROUND((RETORNA_TEMPO_EXEC_OS(OBTER_OS_ADERENCIA_PROJ(VW.NR_SEQUENCIA, '2'))/60),0) TEMPO_AD_002, 
 ROUND((OBTER_TEMPO_EXEC_DEFEITO_PROJ(VW.NR_SEQUENCIA,2)/60),0) TEMPO_RETESTE_002, 
 CASE WHEN(STATUS_DEV IN ('Revision', 'Verification') AND DT_FIM_AD_002 IS NULL) THEN OBTER_ATRASO_TESTE_PROJ(DT_INI_AD_002, IE_SIZE) ELSE 0 END ATRASO_AD_002, 
 CASE WHEN(STATUS_DEV IN ('Revision', 'Verification') AND DT_FIM_AD_002 IS NULL) THEN OBTER_DT_FIM_TESTE_PREV_PROJ(DT_INI_AD_002, IE_SIZE) ELSE NULL END DT_FIM_PREV_AD_002, 
 DT_INI_AD_003, 
 DT_FIM_AD_003, 
 EX_003, 
 AD_003, 
 ROUND((RETORNA_TEMPO_EXEC_OS(OBTER_OS_ADERENCIA_PROJ(VW.NR_SEQUENCIA, '3'))/60),0) TEMPO_AD_003, 
 ROUND((OBTER_TEMPO_EXEC_DEFEITO_PROJ(VW.NR_SEQUENCIA,3)/60),0) TEMPO_RETESTE_003, 
 CASE WHEN(STATUS_DEV IN ('Revision', 'Verification') AND DT_FIM_AD_003 IS NULL) THEN OBTER_ATRASO_TESTE_PROJ(DT_INI_AD_003, IE_SIZE) ELSE 0 END ATRASO_AD_003, 
 CASE WHEN(STATUS_DEV IN ('Revision', 'Verification') AND DT_FIM_AD_003 IS NULL) THEN OBTER_DT_FIM_TESTE_PREV_PROJ(DT_INI_AD_003, IE_SIZE) ELSE NULL END DT_FIM_PREV_AD_003, 
 DT_INI_AD_004, 
 DT_FIM_AD_004, 
 EX_004, 
 AD_004, 
 ROUND((RETORNA_TEMPO_EXEC_OS(OBTER_OS_ADERENCIA_PROJ(VW.NR_SEQUENCIA, '4'))/60),0) TEMPO_AD_004, 
 ROUND((OBTER_TEMPO_EXEC_DEFEITO_PROJ(VW.NR_SEQUENCIA,4)/60),0) TEMPO_RETESTE_004, 
 CASE WHEN(STATUS_DEV IN ('Revision', 'Verification') AND DT_FIM_AD_004 IS NULL) THEN OBTER_ATRASO_TESTE_PROJ(DT_INI_AD_004, IE_SIZE) ELSE 0 END ATRASO_AD_004, 
 CASE WHEN(STATUS_DEV IN ('Revision', 'Verification') AND DT_FIM_AD_004 IS NULL) THEN OBTER_DT_FIM_TESTE_PREV_PROJ(DT_INI_AD_004, IE_SIZE) ELSE NULL END DT_FIM_PREV_AD_004, 
 DT_INI_AD_005, 
 DT_FIM_AD_005, 
 EX_005, 
 AD_005, 
 ROUND((RETORNA_TEMPO_EXEC_OS(OBTER_OS_ADERENCIA_PROJ(VW.NR_SEQUENCIA, '5'))/60),0) TEMPO_AD_005, 
 ROUND((OBTER_TEMPO_EXEC_DEFEITO_PROJ(VW.NR_SEQUENCIA,5)/60),0) TEMPO_RETESTE_005, 
 CASE WHEN(STATUS_DEV IN ('Revision', 'Verification') AND DT_FIM_AD_005 IS NULL) THEN OBTER_ATRASO_TESTE_PROJ(DT_INI_AD_005, IE_SIZE) ELSE 0 END ATRASO_AD_005, 
 CASE WHEN(STATUS_DEV IN ('Revision', 'Verification') AND DT_FIM_AD_005 IS NULL) THEN OBTER_DT_FIM_TESTE_PREV_PROJ(DT_INI_AD_005, IE_SIZE) ELSE NULL END DT_FIM_PREV_AD_005 
 FROM vw_rel_vev_1554 vw
LEFT OUTER JOIN funcoes_html5 fh ON (VW.CD_FUNCAO_ETAPA = FH.CD_FUNCAO)
LEFT OUTER JOIN funcoes_html5_verif fhv ON (FH.NR_SEQUENCIA = FHV.NR_SEQ_FUNCAO);

