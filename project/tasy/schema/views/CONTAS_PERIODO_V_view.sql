-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW contas_periodo_v (nm_usuario, dt_atualizacao, nr_atendimento, nr_interno_conta, dt_acerto_conta, dt_mesano_referencia, dt_mesano_contabil, cd_procedimento, qt_procedimento, vl_procedimento, nr_procedimentos, cd_material, qt_material, vl_material, nr_materiais, ie_status_acerto) AS SELECT C.NM_USUARIO,
       C.DT_ATUALIZACAO,
       C.NR_ATENDIMENTO,
       C.NR_INTERNO_CONTA,
       C.DT_ACERTO_CONTA,
       C.DT_MESANO_REFERENCIA,
       C.DT_MESANO_CONTABIL,
       P.CD_PROCEDIMENTO,
       P.QT_PROCEDIMENTO,
       P.VL_PROCEDIMENTO,
       1 nr_procedimentos,
       0 CD_MATERIAL,
       0 QT_MATERIAL,
       0 VL_MATERIAL,
       0 nr_materiais,
	 C.ie_status_acerto
FROM conta_paciente c
LEFT OUTER JOIN procedimento_paciente p ON (C.NR_INTERNO_CONTA = P.NR_INTERNO_CONTA)
WHERE coalesce(P.nr_seq_proc_pacote,0) <> P.nr_sequencia

UNION ALL

SELECT A.NM_USUARIO,
       A.DT_ATUALIZACAO,
       A.NR_ATENDIMENTO,
       A.NR_INTERNO_CONTA,
       A.DT_ACERTO_CONTA,
       A.DT_MESANO_REFERENCIA,
       A.DT_MESANO_CONTABIL,
       0 CD_PROCEDIMENTO,
       0 QT_PROCEDIMENTO,
       0 VL_PROCEDIMENTO,
       0,
       M.CD_MATERIAL,
       M.QT_MATERIAL,
       M.VL_MATERIAL,
       1,
	 a.ie_status_acerto
FROM conta_paciente a
LEFT OUTER JOIN material_atend_paciente m ON (A.NR_INTERNO_CONTA = M.NR_INTERNO_CONTA)
WHERE coalesce(m.nr_seq_proc_pacote,0) <> m.nr_sequencia;

