-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW interf_tractebel_v (ie_tipo_registro, nr_seq_protocolo, cd_cpf_cnpj, cd_beneficiario, nm_beneficiario, nr_documento, dt_atendimento, ie_tipo_prestador, nm_prestador, ds_especialidade, cd_servico, ds_servico, nm_solicitante, qt_procedimento, vl_chs, vl_real, vl_real_filme, vl_real_uco, hr_procedimento, dt_internacao, dt_alta, ie_tipo_ato, cd_cid, ie_via_acesso, hr_entrada_hosp, hr_saida_hosp, ie_tipo_participacao, cd_dente, cd_face_dente) AS SELECT
	1 ie_tipo_registro,
	a.nr_seq_protocolo,
	a.nr_cpf_paciente cd_cpf_cnpj,
	a.cd_paciente cd_beneficiario,
	a.nm_paciente nm_beneficiario,
	a.nr_interno_conta nr_documento,
	a.dt_entrada dt_atendimento,
	substr(obter_interf_tipo_prestador(b.cd_medico_executor, b.cd_cgc_prestador, b.cd_setor_atendimento, c.cd_cgc_hospital),1,2) ie_tipo_prestador,
	upper(c.nm_hospital) nm_prestador,
	substr(obter_desc_espec_medica(b.cd_especialidade),1,20) ds_especialidade,
	b.cd_item cd_servico,
	b.ds_item ds_servico,
	a.nm_medico_resp nm_solicitante,
	sum(b.qt_item) qt_procedimento,
	sum(b.vl_unitario_ch) vl_chs,
	sum(b.vl_total_item) vl_real,
	sum(b.vl_filme) vl_real_filme,
	sum(b.vl_custo_oper) vl_real_uco,
	to_char(b.dt_item,'hh24mi') hr_procedimento,
	a.dt_entrada dt_internacao,
	a.dt_alta dt_alta,
	CASE WHEN a.ie_tipo_atendimento=1 THEN  'I' WHEN a.ie_tipo_atendimento=7 THEN  'E' END  ie_tipo_ato,
	a.cd_cid_principal cd_cid,
	b.ie_via_acesso ie_via_acesso,
	to_char(a.dt_entrada,'hh24mi') hr_entrada_hosp,
	to_char(a.dt_alta,'hh24mi') hr_saida_hosp,
	CASE WHEN b.cd_funcao_executor=1 THEN  'C' WHEN b.cd_funcao_executor=0 THEN  'M' WHEN b.cd_funcao_executor=9 THEN  'P' WHEN b.cd_funcao_executor=10 THEN  'S' WHEN b.cd_funcao_executor=11 THEN  'T' WHEN b.cd_funcao_executor=3 THEN  'A' WHEN b.cd_funcao_executor=5 THEN  'I' END  ie_tipo_participacao,
	' ' cd_dente,
	' ' cd_face_dente
FROM	w_interf_conta_header c,
	w_interf_conta_item b,
	w_interf_conta_cab a
where	a.nr_interno_conta	= b.nr_interno_conta
and	a.nr_seq_protocolo	= b.nr_seq_protocolo
and	a.nr_seq_protocolo	= c.nr_seq_protocolo
group by
		a.nr_seq_protocolo,
		a.nr_cpf_paciente,
		a.cd_paciente,
		a.nm_paciente,
		a.nr_interno_conta,
		a.dt_entrada,
		substr(obter_interf_tipo_prestador(b.cd_medico_executor, b.cd_cgc_prestador, b.cd_setor_atendimento, c.cd_cgc_hospital),1,2),
		upper(c.nm_hospital),
		substr(obter_desc_espec_medica(b.cd_especialidade),1,20),
		b.cd_item,
		b.ds_item,
		a.nm_medico_resp,
		to_char(b.dt_item,'hh24mi'),
		a.dt_entrada,
		a.dt_alta,
		CASE WHEN a.ie_tipo_atendimento=1 THEN  'I' WHEN a.ie_tipo_atendimento=7 THEN  'E' END ,
		a.cd_cid_principal,
		b.ie_via_acesso,
		to_char(a.dt_entrada,'hh24mi'),
		to_char(a.dt_alta,'hh24mi'),
		CASE WHEN b.cd_funcao_executor=1 THEN  'C' WHEN b.cd_funcao_executor=0 THEN  'M' WHEN b.cd_funcao_executor=9 THEN  'P' WHEN b.cd_funcao_executor=10 THEN  'S' WHEN b.cd_funcao_executor=11 THEN  'T' WHEN b.cd_funcao_executor=3 THEN  'A' WHEN b.cd_funcao_executor=5 THEN  'I' END;

