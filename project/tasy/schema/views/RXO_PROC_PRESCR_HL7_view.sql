-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW rxo_proc_prescr_hl7 (cd_identifier, ds_identifier, qt_item, cd_unidade, cd_intervalo, ds_intervalo, qt_velocidade, ds_unid_tempo, nr_prescricao, nr_seq_recomend, nr_seq_proc, nr_seq_bco, nr_seq_nut_pac, nr_seq_nut_p, nr_seq_enteral, nr_seq_oxig, nr_seq_gaso) AS select  to_char(a.cd_recomendacao) cd_identifier,
	substr(Obter_Desc_Tipo_Recomendacao(a.cd_recomendacao),1,240) ds_identifier,
	'0' qt_item,
	'0' cd_unidade,
	a.cd_intervalo cd_intervalo,
	obter_desc_intervalo(a.cd_intervalo) ds_intervalo,
	null qt_velocidade,
	null ds_unid_tempo,
	a.nr_prescricao,
	a.nr_sequencia nr_seq_recomend,
	0 nr_seq_proc,
	0 nr_seq_bco,
	0 nr_seq_nut_pac,
	0 nr_seq_nut_p,
	0 nr_seq_enteral,
	0 nr_seq_oxig,
	0 nr_seq_gaso
FROM    	prescr_recomendacao a,
        	prescr_medica b
where   	a.nr_prescricao = b.nr_prescricao

union

select  	to_char(a.cd_procedimento) cd_identifier,
	substr(Obter_Desc_Prescr_Proc(a.CD_PROCEDIMENTO,a.IE_ORIGEM_PROCED, a.nr_seq_proc_interno),1,240) ds_identifier,
	subst_virgula_ponto_adic_zero(coalesce(to_char(a.qt_procedimento),0)) qt_item,
	'0' cd_unidade,
	a.cd_intervalo cd_intervalo,
	obter_desc_intervalo(a.cd_intervalo) ds_intervalo,
	null qt_velocidade,
	null ds_unid_tempo,
	a.nr_prescricao,
	0 nr_seq_recomend,
	a.nr_sequencia nr_seq_proc,
	0 nr_seq_bco,
	0 nr_seq_nut_pac,
	0 nr_seq_nut_p,
	0 nr_seq_enteral,
	0 nr_seq_oxig,
	0 nr_seq_gaso
from    	prescr_procedimento a,
        	prescr_medica b
where   	a.nr_prescricao = b.nr_prescricao
and	a.ie_tipo_proced <> 'G'

union

select  	to_char(c.nr_seq_derivado) cd_identifier,
	substr(Obter_Desc_San_Derivado(c.nr_seq_derivado),1,50) ds_identifier,
	subst_virgula_ponto_adic_zero(coalesce(to_char(c.qt_procedimento),0)) qt_item,
	coalesce(c.ie_unid_med_hemo,'0') cd_unidade,
	c.cd_intervalo cd_intervalo,
	obter_desc_intervalo(c.cd_intervalo) ds_intervalo,
	c.qt_veloc_inf_hemo qt_velocidade,
	CASE WHEN c.qt_veloc_inf_hemo IS NULL THEN null WHEN c.qt_veloc_inf_hemo=0 THEN null  ELSE 'gotas/min' END  ds_unid_tempo,
	a.nr_prescricao,
	0 nr_seq_recomend,
	0 nr_seq_proc,
	a.nr_sequencia nr_seq_bco,
	0 nr_seq_nut_pac,
	0 nr_seq_nut_p,
	0 nr_seq_enteral,
	0 nr_seq_oxig,
	0 nr_seq_gaso
from    	prescr_solic_bco_sangue a,
        	prescr_medica b,
	prescr_procedimento c
where   	a.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = c.nr_prescricao
and	c.nr_seq_solic_sangue = a.nr_sequencia

union

select  	to_char(a.nr_sequencia) cd_identifier,
	'Dieta parenteral adulta' ds_identifier,
	subst_virgula_ponto_adic_zero(to_char(a.qt_kcal_total)) qt_item,
	'kcal' cd_unidade,
	'0' cd_intervalo,
	null ds_intervalo,
	a.qt_gotejamento_npt qt_velocidade,
	CASE WHEN a.qt_gotejamento_npt IS NULL THEN null WHEN a.qt_gotejamento_npt=0 THEN null  ELSE 'ml/h' END  ds_unid_tempo,
	a.nr_prescricao,
	0 nr_seq_recomend,
	0 nr_seq_proc,
	0 nr_seq_bco,
	a.nr_sequencia nr_seq_nut_pac,
	0 nr_seq_nut_p,
	0 nr_seq_enteral,
	0 nr_seq_oxig,
	0 nr_seq_gaso
from	nut_paciente a,
        	prescr_medica b
where   	a.nr_prescricao = b.nr_prescricao

union

select  	to_char(a.nr_sequencia) cd_identifier,
	'Dieta parenteral neonatal' ds_identifier,
	subst_virgula_ponto_adic_zero(coalesce(to_char(a.qt_kcal_total),'0')) qt_item,
	'kcal' cd_unidade,
	null cd_intervalo,
	null ds_intervalo,
	a.qt_gotejo_npt qt_velocidade,
	CASE WHEN a.qt_gotejo_npt IS NULL THEN null WHEN a.qt_gotejo_npt=0 THEN null  ELSE 'ml/h' END  ds_unid_tempo,
	a.nr_prescricao,
	0 nr_seq_recomend,
	0 nr_seq_proc,
	0 nr_seq_bco,
	0 nr_seq_nut_pac,
	a.nr_sequencia nr_seq_nut_p,
	0 nr_seq_enteral,
	0 nr_seq_oxig,
	0 nr_seq_gaso
from    	nut_pac a,
        	prescr_medica b
where   	a.nr_prescricao = b.nr_prescricao

union

select  	to_char(b.cd_material) cd_identifier,
	substr(obter_desc_material(b.cd_material),1,80) ds_identifier,
	subst_virgula_ponto_adic_zero(coalesce(to_char(b.qt_dose),'0')) qt_item,
	coalesce(b.cd_unidade_medida_dose,'0') cd_unidade,
	b.cd_intervalo,
	obter_desc_intervalo(b.cd_intervalo) ds_intervalo,
	b.qt_vel_infusao qt_velocidade,
	CASE WHEN b.qt_vel_infusao IS NULL THEN null WHEN b.qt_vel_infusao=0 THEN null  ELSE 'ml/h' END  ds_unid_tempo,
	a.nr_prescricao,
	0 nr_seq_recomend,
	0 nr_seq_proc,
	0 nr_seq_bco,
	0 nr_seq_nut_pac,
	0 nr_seq_nut_p,
	b.nr_sequencia nr_seq_enteral,
	0 nr_seq_oxig,
	0 nr_seq_gaso
from 	prescr_medica a,
	prescr_material b
where 	a.nr_prescricao = b.nr_prescricao
and 	ie_agrupador = 8

union

select  	to_char(b.cd_procedimento) cd_identifier,
	substr(Obter_Desc_Prescr_Proc(b.CD_PROCEDIMENTO,b.IE_ORIGEM_PROCED, b.nr_seq_proc_interno),1,240) ds_identifier,
	subst_virgula_ponto_adic_zero(coalesce(to_char(b.qt_procedimento),'0')) qt_item,
	'0' cd_unidade,
	b.cd_intervalo,
	obter_desc_intervalo(b.cd_intervalo) ds_intervalo,
	b.qt_fluxo_oxigenio qt_velocidade,
	CASE WHEN b.qt_fluxo_oxigenio IS NULL THEN null WHEN b.qt_fluxo_oxigenio=0 THEN null  ELSE 'litros/min' END  ds_unid_tempo,
	a.nr_prescricao,
	0 nr_seq_recomend,
	0 nr_seq_proc,
	0 nr_seq_bco,
	0 nr_seq_nut_pac,
	0 nr_seq_nut_p,
	0 nr_seq_enteral,
	b.nr_sequencia nr_seq_oxig,
	0 nr_seq_gaso
from 	prescr_medica a,
	prescr_procedimento b
where 	a.nr_prescricao = b.nr_prescricao
and 	b.ie_tipo_proced = 'G'

union

select  	b.ie_respiracao cd_identifier,
	obter_valor_dominio(1299,b.ie_respiracao) ds_identifier,
	subst_virgula_ponto_adic_zero(coalesce(to_char(b.qt_gasoterapia),'0')) qt_item,
	coalesce(b.ie_unidade_medida,'0') cd_unidade,
	b.ie_modo_adm cd_intervalo,
	obter_valor_dominio(1568,b.ie_modo_adm) ds_intervalo,
	null qt_velocidade,
	null ds_unid_tempo,
	a.nr_prescricao,
	0 nr_seq_recomend,
	0 nr_seq_proc,
	0 nr_seq_bco,
	0 nr_seq_nut_pac,
	0 nr_seq_nut_p,
	0 nr_seq_enteral,
	0 nr_seq_oxig,
	b.nr_sequencia nr_seq_gaso
from 	prescr_medica a,
	prescr_gasoterapia b
where 	a.nr_prescricao = b.nr_prescricao;

