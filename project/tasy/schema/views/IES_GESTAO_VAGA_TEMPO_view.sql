-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ies_gestao_vaga_tempo (nr_atendimento, cd_paciente, ds_paciente, ie_tipo_vaga, ds_tipo_vaga, ie_solicitacao, ds_solicitacao, cd_setor_atual, ds_setor_atual, cd_especialidade, ds_especialidade, nr_seq_prioridade, ds_prioridade, cd_cid_principal, ds_cid_principal, dt_solicitacao, dt_atualizacao, dt_final, int_solic, cd_estabelecimento, ie_status) AS SELECT NR_ATENDIMENTO,
  CD_PACIENTE,
  DS_PACIENTE,
  IE_TIPO_VAGA,
  DS_TIPO_VAGA,
  IE_SOLICITACAO,
  DS_SOLICITACAO,
  CD_SETOR_ATUAL,
  DS_SETOR_ATUAL,
  CD_ESPECIALIDADE,
  DS_ESPECIALIDADE,
  NR_SEQ_PRIORIDADE,
  DS_PRIORIDADE,
  CD_CID_PRINCIPAL,
  DS_CID_PRINCIPAL,
  DT_SOLICITACAO,
  DT_ATUALIZACAO,
  DT_FINAL,
  OBTER_TEMPO_ENTRE_DATAS(DT_SOLICITACAO, DT_FINAL, 'H') INT_SOLIC,
  CD_ESTABELECIMENTO,
  IE_STATUS
FROM (
  SELECT GV.NR_ATENDIMENTO NR_ATENDIMENTO,
    GV.CD_PESSOA_FISICA CD_PACIENTE,
    OBTER_NOME_PF(GV.CD_PESSOA_FISICA) DS_PACIENTE,
    GV.IE_TIPO_VAGA IE_TIPO_VAGA,
    OBTER_VALOR_DOMINIO(1410,GV.IE_TIPO_VAGA) DS_TIPO_VAGA,
    GV.IE_SOLICITACAO IE_SOLICITACAO,
    OBTER_VALOR_DOMINIO(1407,GV.IE_SOLICITACAO) DS_SOLICITACAO,
    GV.CD_ESPECIALIDADE CD_ESPECIALIDADE,
    OBTER_DESC_ESPEC_MEDICA(GV.CD_ESPECIALIDADE) DS_ESPECIALIDADE,
    GV.CD_SETOR_ATUAL CD_SETOR_ATUAL,
    OBTER_NOME_SETOR(GV.CD_SETOR_ATUAL) DS_SETOR_ATUAL,
    GV.NR_SEQ_PRIORIDADE NR_SEQ_PRIORIDADE,
    OBTER_DESC_PRIORIDADE_REG(GV.NR_SEQ_PRIORIDADE) DS_PRIORIDADE,
    GV.CD_CID_PRINCIPAL CD_CID_PRINCIPAL,
    OBTER_DESC_CID(GV.CD_CID_PRINCIPAL) DS_CID_PRINCIPAL,
    GV.DT_SOLICITACAO DT_SOLICITACAO,
    GV.DT_ATUALIZACAO DT_ATUALIZACAO,
    DT_FINAL_INDICADOR_GEST_VAGA(GV.NR_SEQUENCIA) DT_FINAL,
    GV.CD_ESTABELECIMENTO CD_ESTABELECIMENTO,
	GV.IE_STATUS IE_STATUS
  FROM GESTAO_VAGA GV
) CALC_TEMPO;

