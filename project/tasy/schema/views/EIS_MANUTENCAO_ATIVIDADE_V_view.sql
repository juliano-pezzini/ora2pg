-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_manutencao_atividade_v (nr_seq_ordem_serv, dt_execucao, dt_referencia, nm_usuario_ativ, nr_seq_funcao, ds_funcao, nr_grupo_planej, ds_grupo_planej, nr_grupo_trabalho, ds_grupo_trabalho, cd_estabelecimento, qt_encerrada, qt_total, qt_min_ativ, cd_dimensao, ds_usuario_ativ) AS select	a.nr_sequencia nr_seq_ordem_serv,
	trunc(a.dt_ordem_servico) dt_execucao,
	trunc(a.dt_ordem_servico,'mm') dt_referencia,
	b.nm_usuario_exec nm_usuario_ativ,
	0 nr_seq_funcao,
	'' ds_funcao,
	a.nr_grupo_planej,
	'' ds_grupo_planej,
	a.nr_grupo_trabalho,
	'' ds_grupo_trabalho,
	c.cd_estabelecimento,
	0 qt_encerrada,
	1 qt_total,
	0 qt_min_ativ,
	1 cd_dimensao,
	substr(obter_nome_usuario(b.nm_usuario_exec),1,100) ds_usuario_ativ
FROM	man_equipamento d,
	man_localizacao c,
	man_ordem_serv_ativ b,
	man_ordem_servico a
where	c.nr_sequencia = a.nr_seq_localizacao
and	d.nr_sequencia = a.nr_seq_equipamento
and	a.nr_sequencia = b.nr_seq_ordem_serv
group by a.nr_sequencia,
	a.dt_ordem_servico,
	a.nr_grupo_planej,
	a.nr_grupo_trabalho,
	b.nm_usuario_exec,
	c.cd_estabelecimento

union

select	a.nr_sequencia nr_seq_ordem_serv,
	trunc(a.dt_fim_real) dt_execucao,
	trunc(a.dt_fim_real,'mm') dt_referencia,
	b.nm_usuario_exec nm_usuario_ativ,
	0 nr_seq_funcao,
	'' ds_funcao,
	a.nr_grupo_planej,
	'' ds_grupo_planej,
	a.nr_grupo_trabalho,
	'' ds_grupo_trabalho,
	c.cd_estabelecimento,
	1 qt_encerrada,
	0 qt_total,
	0 qt_min_ativ,
	1 cd_dimensao,
	substr(obter_nome_usuario(b.nm_usuario_exec),1,100) ds_usuario_ativ
from	man_equipamento d,
	man_localizacao c,
	man_ordem_serv_ativ b,
	man_ordem_servico a
where	c.nr_sequencia = a.nr_seq_localizacao
and	d.nr_sequencia = a.nr_seq_equipamento
and	a.ie_status_ordem = 3
and	a.dt_fim_real is not null
and	a.nr_sequencia = b.nr_seq_ordem_serv
group by a.nr_sequencia,
	a.dt_fim_real,
	a.nr_grupo_planej,
	a.nr_grupo_trabalho,
	b.nm_usuario_exec,
	c.cd_estabelecimento

union

select	a.nr_sequencia nr_seq_ordem_serv,
	trunc(b.dt_atividade) dt_execucao,
	trunc(b.dt_atividade,'mm') dt_referencia,
	b.nm_usuario_exec nm_usuario_ativ,
	0 nr_seq_funcao,
	'' ds_funcao,
	a.nr_grupo_planej,
	'' ds_grupo_planej,
	a.nr_grupo_trabalho,
	'' ds_grupo_trabalho,
	c.cd_estabelecimento,
	0 qt_encerrada,
	0 qt_total,
	sum(b.qt_minuto) qt_min_ativ,
	1 cd_dimensao,
	substr(obter_nome_usuario(b.nm_usuario_exec),1,100) ds_usuario_ativ
from	man_equipamento d,
	man_localizacao c,
	man_ordem_serv_ativ b,
	man_ordem_servico a
where	c.nr_sequencia = a.nr_seq_localizacao
and	d.nr_sequencia = a.nr_seq_equipamento
and	a.nr_sequencia = b.nr_seq_ordem_serv
group by a.nr_sequencia,
	b.dt_atividade,
	a.nr_grupo_planej,
	a.nr_grupo_trabalho,
	b.nm_usuario_exec,
	c.cd_estabelecimento

union

select	a.nr_sequencia nr_seq_ordem_serv,
	trunc(a.dt_ordem_servico) dt_execucao,
	trunc(a.dt_ordem_servico,'mm') dt_referencia,
	'' nm_usuario_ativ,
	b.nr_seq_funcao,
	substr(obter_desc_tipo_funcao(b.nr_seq_funcao),1,80) ds_funcao,
	a.nr_grupo_planej,
	'' ds_grupo_planej,
	a.nr_grupo_trabalho,
	'' ds_grupo_trabalho,
	c.cd_estabelecimento,
	0 qt_encerrada,
	1 qt_total,
	0 qt_min_ativ,
	2 cd_dimensao,
	'' ds_usuario_ativ
from	man_equipamento d,
	man_localizacao c,
	man_ordem_serv_ativ b,
	man_ordem_servico a
where	c.nr_sequencia = a.nr_seq_localizacao
and	d.nr_sequencia = a.nr_seq_equipamento
and	a.nr_sequencia = b.nr_seq_ordem_serv
group by a.nr_sequencia,
	a.dt_ordem_servico,
	a.nr_grupo_planej,
	a.nr_grupo_trabalho,
	b.nr_seq_funcao,
	c.cd_estabelecimento

union

select	a.nr_sequencia nr_seq_ordem_serv,
	trunc(a.dt_fim_real) dt_execucao,
	trunc(a.dt_fim_real,'mm') dt_referencia,
	'' nm_usuario_ativ,
	b.nr_seq_funcao,
	substr(obter_desc_tipo_funcao(b.nr_seq_funcao),1,80) ds_funcao,
	a.nr_grupo_planej,
	'' ds_grupo_planej,
	a.nr_grupo_trabalho,
	'' ds_grupo_trabalho,
	c.cd_estabelecimento,
	1 qt_encerrada,
	0 qt_total,
	0 qt_min_ativ,
	2 cd_dimensao,
	'' ds_usuario_ativ
from	man_equipamento d,
	man_localizacao c,
	man_ordem_serv_ativ b,
	man_ordem_servico a
where	c.nr_sequencia = a.nr_seq_localizacao
and	d.nr_sequencia = a.nr_seq_equipamento
and	a.ie_status_ordem = 3
and	a.dt_fim_real is not null
and	a.nr_sequencia = b.nr_seq_ordem_serv
group by a.nr_sequencia,
	a.dt_fim_real,
	a.nr_grupo_planej,
	a.nr_grupo_trabalho,
	b.nr_seq_funcao,
	c.cd_estabelecimento

union

select	a.nr_sequencia nr_seq_ordem_serv,
	trunc(b.dt_atividade) dt_execucao,
	trunc(b.dt_atividade,'mm') dt_referencia,
	'' nm_usuario_ativ,
	b.nr_seq_funcao,
	substr(obter_desc_tipo_funcao(b.nr_seq_funcao),1,80) ds_funcao,
	a.nr_grupo_planej,
	'' ds_grupo_planej,
	a.nr_grupo_trabalho,
	'' ds_grupo_trabalho,
	c.cd_estabelecimento,
	0 qt_encerrada,
	0 qt_total,
	sum(b.qt_minuto) qt_min_ativ,
	2 cd_dimensao,
	'' ds_usuario_ativ
from	man_equipamento d,
	man_localizacao c,
	man_ordem_serv_ativ b,
	man_ordem_servico a
where	c.nr_sequencia = a.nr_seq_localizacao
and	d.nr_sequencia = a.nr_seq_equipamento
and	a.nr_sequencia = b.nr_seq_ordem_serv
group by a.nr_sequencia,
	b.dt_atividade,
	a.nr_grupo_planej,
	a.nr_grupo_trabalho,
	b.nr_seq_funcao,
	c.cd_estabelecimento

union

select	a.nr_sequencia nr_seq_ordem_serv,
	trunc(a.dt_ordem_servico) dt_execucao,
	trunc(a.dt_ordem_servico,'mm') dt_referencia,
	'' nm_usuario_ativ,
	0 nr_seq_funcao,
	'' ds_funcao,
	a.nr_grupo_planej,
	substr(obter_desc_grupo_planej(a.nr_grupo_planej),1,50) ds_grupo_planej,
	a.nr_grupo_trabalho,
	substr(obter_desc_grupo_trab(a.nr_grupo_trabalho),1,50) ds_grupo_trabalho,
	c.cd_estabelecimento,
	0 qt_encerrada,
	1 qt_total,
	0 qt_min_ativ,
	3 cd_dimensao,
	'' ds_usuario_ativ
from	man_equipamento d,
	man_localizacao c,
	man_ordem_serv_ativ b,
	man_ordem_servico a
where	c.nr_sequencia = a.nr_seq_localizacao
and	d.nr_sequencia = a.nr_seq_equipamento
and	a.nr_sequencia = b.nr_seq_ordem_serv
group by a.nr_sequencia,
	a.dt_ordem_servico,
	a.nr_grupo_planej,
	a.nr_grupo_trabalho,
	c.cd_estabelecimento

union

select	a.nr_sequencia nr_seq_ordem_serv,
	trunc(a.dt_fim_real) dt_execucao,
	trunc(a.dt_fim_real,'mm') dt_referencia,
	'' nm_usuario_ativ,
	0 nr_seq_funcao,
	'' ds_funcao,
	a.nr_grupo_planej,
	substr(obter_desc_grupo_planej(a.nr_grupo_planej),1,50) ds_grupo_planej,
	a.nr_grupo_trabalho,
	substr(obter_desc_grupo_trab(a.nr_grupo_trabalho),1,50) ds_grupo_trabalho,
	c.cd_estabelecimento,
	1 qt_encerrada,
	0 qt_total,
	0 qt_min_ativ,
	3 cd_dimensao,
	'' ds_usuario_ativ
from	man_equipamento d,
	man_localizacao c,
	man_ordem_serv_ativ b,
	man_ordem_servico a
where	c.nr_sequencia = a.nr_seq_localizacao
and	d.nr_sequencia = a.nr_seq_equipamento
and	a.ie_status_ordem = 3
and	a.dt_fim_real is not null
and	a.nr_sequencia = b.nr_seq_ordem_serv
group by a.nr_sequencia,
	a.dt_fim_real,
	a.nr_grupo_planej,
	a.nr_grupo_trabalho,
	c.cd_estabelecimento

union

select	a.nr_sequencia nr_seq_ordem_serv,
	trunc(b.dt_atividade) dt_execucao,
	trunc(b.dt_atividade,'mm') dt_referencia,
	'' nm_usuario_ativ,
	0 nr_seq_funcao,
	'' ds_funcao,
	a.nr_grupo_planej,
	substr(obter_desc_grupo_planej(a.nr_grupo_planej),1,50) ds_grupo_planej,
	a.nr_grupo_trabalho,
	substr(obter_desc_grupo_trab(a.nr_grupo_trabalho),1,50) ds_grupo_trabalho,
	c.cd_estabelecimento,
	0 qt_encerrada,
	0 qt_total,
	sum(b.qt_minuto) qt_min_ativ,
	3 cd_dimensao,
	'' ds_usuario_ativ
from	man_equipamento d,
	man_localizacao c,
	man_ordem_serv_ativ b,
	man_ordem_servico a
where	c.nr_sequencia = a.nr_seq_localizacao
and	d.nr_sequencia = a.nr_seq_equipamento
and	a.nr_sequencia = b.nr_seq_ordem_serv
group by a.nr_sequencia,
	b.dt_atividade,
	a.nr_grupo_planej,
	a.nr_grupo_trabalho,
	c.cd_estabelecimento;

