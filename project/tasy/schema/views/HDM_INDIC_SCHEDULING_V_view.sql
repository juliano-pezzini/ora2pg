-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW hdm_indic_scheduling_v (nr_day_of_week, nr_day, si_holiday, si_weekend, dt_day, ds_day_of_week, nr_year, nr_month, nr_semester, nr_quarter, dt_month, nr_seq_patient_group, si_sex, ds_sex, nm_age_range, ds_participant, si_participant, nr_seq_dm_program, nr_seq_program, nm_program, nm_program_module, nr_seq_campaign, nm_campaign, nr_seq_dm_group, nm_group, nm_group_class, nr_seq_turma, nm_episode_place, si_form, ds_form, si_type, ds_type, si_cancelled, ds_cancelled, si_confirmed, ds_confirmed, si_reason_cancel, ds_reason_cancel, si_status, ds_status, nm_responsability, nm_professional, nm_team, nr_seq_fact, ds_unique, nr_min_duration, qt_absence, qt_min_by_fact, qt_abs_by_fact, nr_dif_person, nr_seq_agendamento) AS SELECT	/* Dados dia */

	c.nr_day_of_week,
	c.nr_day,
	c.si_holiday,
	c.si_weekend,
	c.dt_complete_date dt_day,
	c.ds_day_of_week,
	/* Dados mÃªs */


	b.nr_year,
	b.nr_month,
	b.nr_semester,
	b.nr_quarter,  
	b.dt_complete_date dt_month,
	/* Dados grupo paciente */
 
	a.nr_seq_patient_group,
	d.si_sex,
	d.ds_sex,
	d.nm_age_range,
	d.ds_participant,
	d.si_participant,
	/* Dados programa */


	e.nr_sequencia nr_seq_dm_program,
	e.nr_seq_program nr_seq_program, 
	e.nm_program,
	e.nm_program_module nm_program_module, 
	/* Dados campanha */


	g.nr_sequencia nr_seq_campaign,
	g.nm_campaign, 
	/* Dados grupo atividade */


	i.nr_sequencia nr_seq_dm_group,
	i.nm_group, 
	i.nm_class nm_group_class, 
	i.nr_seq_turma,
	/* Dados detalhes agendamento */


	k.nm_place nm_episode_place,
	k.si_form,
	k.ds_form,
	k.si_type,
	k.ds_type,
	k.si_cancelled, 
	k.ds_cancelled, 
	k.si_confirmed, 
	k.ds_confirmed, 
	k.si_reason_cancel, 
	k.ds_reason_cancel, 
	k.si_status,
	k.ds_status, 
	/* Dados profissional*/


	p.nm_responsability,
	p.nm_professional,
	p.nm_team,
	/* Dados fato */


	a.nr_sequencia nr_seq_fact,
	a.ds_unique,
	a.nr_min_duration,
	a.qt_absence,
	(a.nr_min_duration / COUNT(1) OVER (PARTITION BY a.nr_sequencia)) qt_min_by_fact,
	(a.qt_absence / COUNT(1) OVER (PARTITION BY a.nr_sequencia)) qt_abs_by_fact,
	a.nr_dif_person,
	a.nr_seq_agendamento
FROM hdm_indic_ft_appoint_pf q, hdm_indic_dm_professional p, hdm_indic_dm_app_details k, hdm_indic_ft_appoint_ag j, hdm_indic_dm_activ_group i, hdm_indic_ft_appoint_cp h, hdm_indic_dm_campaign g, hdm_indic_ft_appoint_pr f, hdm_indic_dm_program e, hdm_indic_dm_patient_group d, hdm_indic_dm_day c, hdm_indic_dm_month b, pessoa_fisica pf
LEFT OUTER JOIN hdm_indic_ft_appoint a ON (pf.cd_pessoa_fisica = a.nr_dif_person)
WHERE 1 = 1 AND f.nr_seq_dimension = e.nr_sequencia AND h.nr_seq_dimension = g.nr_sequencia AND j.nr_seq_dimension = i.nr_sequencia AND q.nr_seq_dimension = p.nr_sequencia AND a.nr_sequencia = f.nr_seq_fact AND a.nr_sequencia = h.nr_seq_fact AND a.nr_sequencia = j.nr_seq_fact AND a.nr_sequencia = q.nr_seq_fact AND a.nr_seq_app_detail = k.nr_sequencia AND a.nr_seq_patient_group = d.nr_sequencia AND b.nr_sequencia = a.nr_seq_month AND c.nr_sequencia = a.nr_seq_day;

