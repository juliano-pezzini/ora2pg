-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW cih_hig_maos_indicadores_vhtml (nr_sequencia_higienizacao, ie_momento, ds_ie_momento, ie_categoria_profissional, ds_categoria_profissional, cd_profissional, nm_profissional, ie_sexo, ds_ie_sexo, ie_higienizou, dt_observacao, dt_mes_observacao, cd_observador_pf, nm_observador, nr_sequencia_material, ds_material, ie_tecnica, ie_turno, ds_ie_turno, cd_setor_atendimento, ds_setor_atendimento, nm_usuario, nr_seq_profissional, ds_profissional) AS SELECT
     X.NR_SEQUENCIA AS NR_SEQUENCIA_HIGIENIZACAO,
       IE_MOMENTO AS IE_MOMENTO,
       coalesce(SUBSTR(OBTER_VALOR_DOMINIO(7445, IE_MOMENTO), 1, 255),WHEB_MENSAGEM_PCK.GET_TEXTO(793967)) AS DS_IE_MOMENTO,
       X.IE_TIPO_EVOLUCAO AS IE_CATEGORIA_PROFISSIONAL,
       coalesce(SUBSTR(OBTER_VALOR_DOMINIO(72, X.IE_TIPO_EVOLUCAO), 1, 255),WHEB_MENSAGEM_PCK.GET_TEXTO(793967)) AS DS_CATEGORIA_PROFISSIONAL,
       CD_PROFISSIONAL AS CD_PROFISSIONAL,
       coalesce(SUBSTR(OBTER_NOME_PF(CD_PROFISSIONAL),1,255), WHEB_MENSAGEM_PCK.GET_TEXTO(793967)) AS NM_PROFISSIONAL,
       IE_SEXO AS IE_SEXO,
       coalesce(SUBSTR(OBTER_VALOR_DOMINIO(4, IE_SEXO), 1, 255),WHEB_MENSAGEM_PCK.GET_TEXTO(793967)) AS DS_IE_SEXO,
       CASE WHEN IE_HIGIENIZOU='S' THEN  WHEB_MENSAGEM_PCK.GET_TEXTO(793968) WHEN IE_HIGIENIZOU='N' THEN  WHEB_MENSAGEM_PCK.GET_TEXTO(793969)  ELSE WHEB_MENSAGEM_PCK.GET_TEXTO(793967) END  AS IE_HIGIENIZOU,
       DT_OBSERVACAO AS DT_OBSERVACAO,
       EXTRACT(MONTH FROM DT_OBSERVACAO) AS DT_MES_OBSERVACAO,
       CD_OBSERVADOR_PF AS CD_OBSERVADOR_PF,
       SUBSTR(OBTER_NOME_PF(CD_OBSERVADOR_PF), 1, 255) AS NM_OBSERVADOR,
       NR_SEQ_MATERIAL AS NR_SEQUENCIA_MATERIAL,
       coalesce(SUBSTR(OBTER_MATERIAL_HIGIENIZACAO(NR_SEQ_MATERIAL),1,255),WHEB_MENSAGEM_PCK.GET_TEXTO(793967)) AS DS_MATERIAL,
       CASE WHEN SUBSTR(cih_obter_se_tecnica(Y.nr_sequencia),1,255)='S' THEN  WHEB_MENSAGEM_PCK.GET_TEXTO(793968) WHEN SUBSTR(cih_obter_se_tecnica(Y.nr_sequencia),1,255)='N' THEN  WHEB_MENSAGEM_PCK.GET_TEXTO(793969)  ELSE WHEB_MENSAGEM_PCK.GET_TEXTO(793967) END  AS IE_TECNICA,
       IE_TURNO AS IE_TURNO,
       SUBSTR(OBTER_VALOR_DOMINIO(5874, IE_TURNO), 1, 255) AS DS_IE_TURNO,
       CD_SETOR_ATENDIMENTO AS CD_SETOR_ATENDIMENTO,
       SUBSTR(OBTER_NOME_SETOR(CD_SETOR_ATENDIMENTO), 1, 255) AS DS_SETOR_ATENDIMENTO,
 X.NM_USUARIO,
 NR_SEQ_PROFISSIONAL AS NR_SEQ_PROFISSIONAL,
 coalesce(SUBSTR(OBTER_DESC_CIH_PROFISSIONAL(NR_SEQ_PROFISSIONAL), 1, 255), WHEB_MENSAGEM_PCK.GET_TEXTO(793967)) AS DS_PROFISSIONAL
FROM CIH_HIGIENIZACAO_MAOS X
LEFT  JOIN CIH_DADOS_HIG_MAOS Y ON Y.NR_SEQ_HIG_MAO = X.NR_SEQUENCIA
WHERE X.DT_LIBERACAO IS NOT NULL
  AND X.DT_INATIVACAO IS NULL
  AND (X.NR_SEQ_CLASSIFICACAO IS NULL OR X.NR_SEQ_CLASSIFICACAO = 9999)
 AND  coalesce(CD_ESTABELECIMENTO,to_char(wheb_usuario_pck.get_cd_estabelecimento)) = to_char(wheb_usuario_pck.get_cd_estabelecimento);

