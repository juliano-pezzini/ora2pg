-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW integr_gerdau_trib_nf_ent_v (tp_registro, dt_emissao, cd_estabelecimento, vl_registro) AS select	3	tp_registro,
	n.dt_emissao,
	n.cd_estabelecimento,
	'GG    '								||
	'FOB   '								||
	'FOB   '								||
	'L' || rpad(i.nr_sequencia, 7, ' ')						||
	lpad(i.nr_item_nf, 6, 0)						||
	CASE WHEN obter_tipo_tributo(t.cd_tributo)='ICMS' THEN  '1 ' WHEN obter_tipo_tributo(t.cd_tributo)='ICMSST' THEN  '3 ' WHEN obter_tipo_tributo(t.cd_tributo)='IPI' THEN  '2 ' WHEN obter_tipo_tributo(t.cd_tributo)='ISS' THEN  '8 ' WHEN obter_tipo_tributo(t.cd_tributo)='PIS' THEN  '9 ' WHEN obter_tipo_tributo(t.cd_tributo)='COFINS' THEN  '10' WHEN obter_tipo_tributo(t.cd_tributo)='II' THEN  '57' END 	||
	CASE WHEN t.vl_tributo=0 THEN  '2 '  ELSE '1 ' END 						||
	lpad(replace(campo_mascara(coalesce(t.vl_base_calculo,0),2),'.',''),15, 0)		||
	lpad(replace(campo_mascara(coalesce(t.tx_tributo,0),2),'.',''),6, 0)			||
	lpad(replace(campo_mascara(coalesce(t.vl_tributo,0),2),'.',''),15, 0)			||
	coalesce(f.ie_origem_mercadoria, 0)						||
	CASE WHEN f.ie_tributacao_icms=41 THEN  'A' WHEN f.ie_tributacao_icms=51 THEN  'B'  ELSE substr(f.ie_tributacao_icms, 1, 1) END 	||
	rpad(' ', 18, ' ')							||
	'00000000'							||
	'*'								vl_registro
FROM 	nota_fiscal_item i,
	nota_fiscal n,
	nota_fiscal_item_trib t,
	material_fiscal f
where	i.nr_sequencia	= t.nr_sequencia
and	i.cd_material	= f.cd_material
and	i.nr_sequencia 	= n.nr_sequencia
and	obter_se_nota_entrada_saida(i.nr_sequencia) = 'E';

