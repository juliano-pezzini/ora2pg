-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW html5_atendimento_ps_v (nr_atendimento, dt_entrada, dt_alta, dt_alta_interno, cd_pessoa_fisica, nm_pessoa_fisica, nr_prontuario, cd_medico_resp, cd_estabelecimento, ds_sintoma_paciente, cd_setor_atendimento, cd_unidade_basica, cd_unidade_compl, ds_unidade, ds_setor_atendimento, dt_nascimento, dt_lib_medico, cd_medico_chamado, cd_classif_setor, ie_clinica, nr_seq_classificacao, ds_obs_alta, cd_tipo_acomodacao, nr_atend_original, nr_seq_queixa, nr_seq_triagem, nr_seq_triagem_prioridade, ds_senha_qmatic, nr_seq_local_pa, cd_procedencia, cd_motivo_alta, cd_convenio, cd_categoria, cd_religiao, ie_permite_visita, ie_tipo_atendimento, dt_saida_unidade, nr_doc_convenio, dt_atend_medico, dt_fim_triagem, nr_seq_tipo_acidente, dt_medicacao, dt_fim_consulta, dt_inicio_atendimento, dt_chamada_paciente, dt_liberacao_enfermagem, dt_reavaliacao_medica, dt_fim_reavaliacao, dt_inicio_observacao, dt_fim_observacao, dt_chamada_reavaliacao, dt_saida_prev_loc_pa, nr_atend_alta, dt_fim_conta, nm_usuario_alta, dt_saida_real, dt_chamada_enfermagem, ie_paciente_isolado, ie_clinica_ant, dt_previsto_alta, dt_entrada_real, cd_pessoa_responsavel, dt_inicio_reavaliacao, dt_alta_medico, ie_carater_inter_sus, dt_entrada_unidade, cd_medico_referido, ie_probabilidade_alta, cd_motivo_alta_medica, nm_usuario_saida, ie_chamado, dt_cancelamento, nm_usuario, nr_seq_informacao, ds_informacao, dt_chamada_medic, dt_classif_risco, dt_chegada_medic, nm_usuario_triagem, ie_arvore_pep, nr_seq_interno, nm_medico, ds_queixa, ie_prioridade, ds_cor, ds_triagem, ds_convenio, ds_breve_local, cd_cid_principal, ie_sexo, qt_idade, hr_medicacao, hr_checagem_adep, hr_lib_medico, hr_inicio_consulta, hr_fim_consulta, hr_enfermagem, hr_fim_enfermagem, hr_chamado, hr_liberacao_enfermagem, hr_reavaliacao_medica, ie_status_pa, ds_triagem_prioridade, ie_prioridade_classif, ie_prior_classif_atend) AS SELECT	
	a.nr_atendimento,  
	a.dt_entrada,  
	a.dt_alta,  
	a.dt_alta_interno,  
	a.cd_pessoa_fisica,  
	substr(obter_nome_pf(p.cd_pessoa_fisica),1,60) nm_pessoa_fisica,  
	p.nr_prontuario,  
	a.cd_medico_resp,  
	a.cd_estabelecimento,  
	a.ds_sintoma_paciente,  
	b.cd_setor_atendimento,  
	b.cd_unidade_basica,  
	b.cd_unidade_compl,  
	b.cd_unidade_basica || ' ' ||b.cd_unidade_compl ds_unidade,  
	s.ds_setor_atendimento,  
	p.dt_nascimento,  
	a.dt_lib_medico,  
	a.cd_medico_chamado, 
	s.cd_classif_setor,  
	a.ie_clinica,  
	a.nr_seq_classificacao,  
	a.ds_obs_alta,  
	b.cd_tipo_acomodacao,  
	a.nr_atend_original,  
	a.nr_seq_queixa,  
	a.nr_seq_triagem, 
	a.nr_seq_triagem_PRIORIDADE,  
	a.ds_senha_qmatic,  
	a.nr_seq_local_pa,  
	a.cd_procedencia,  
	a.cd_motivo_alta,  
	c.cd_convenio cd_convenio,  
	c.cd_categoria cd_categoria, 
	p.cd_religiao,  
	a.ie_permite_visita,  
	a.ie_tipo_atendimento,  
	b.dt_saida_unidade,  
	c.nr_doc_convenio,  
	a.dt_atend_medico,  
	a.dt_fim_triagem,  
	a.nr_seq_tipo_acidente,  
	a.dt_medicacao, 
	a.dt_fim_consulta,  
	a.dt_inicio_atendimento	,  
	a.dt_chamada_paciente,  
	a.dt_liberacao_enfermagem,  
	a.dt_reavaliacao_medica, 
	a.dt_fim_reavaliacao,  
	a.dt_inicio_observacao,  
	a.dt_fim_observacao, 
	a.dt_chamada_reavaliacao, 
	a.dt_saida_prev_loc_pa,  
	a.nr_atend_alta,  
	a.dt_fim_conta,  
	a.nm_usuario_alta,  
	a.dt_saida_real,  
	a.dt_chamada_enfermagem,  
	a.IE_PACIENTE_ISOLADO,  
	a.ie_clinica_ant,  
	a.dt_previsto_alta,  
	b.dt_entrada_real,  
	a.cd_pessoa_responsavel, 
	a.dt_inicio_reavaliacao, 
	a.dt_alta_medico dt_alta_medico,  
	a.ie_carater_inter_sus,  
	b.dt_entrada_unidade,  
	a.cd_medico_referido,  
	a.ie_probabilidade_alta,  
	a.cd_motivo_alta_medica,  
	a.nm_usuario_saida,  
	a.ie_chamado,  
	a.dt_cancelamento,  
	a.nm_usuario,  
	a.nr_seq_informacao,  
	a.ds_informacao,  
	a.dt_chamada_medic,  
	a.dt_classif_risco, 
	a.dt_chegada_medic,  
	a.nm_usuario_triagem, 
	s.ie_arvore_pep, 
	b.nr_seq_interno, 
	SUBSTR(obter_nome_medico(cd_medico_resp,'N'),1,60) nm_medico, 
	SUBSTR(Obter_Queixas_Atendimento(a.nr_atendimento,a.nr_seq_queixa),1,255) ds_queixa,  
	obter_prioridade_tcr(a.nr_seq_triagem) ie_prioridade, 
	SUBSTR(obter_cor_tcr(a.nr_seq_triagem),1,15) ds_cor,  
	substr(obter_desc_triagem(a.nr_seq_triagem),1,80) ds_triagem, 
	SUBSTR(Obter_Nome_Convenio(c.cd_convenio),1,50) ds_convenio, 
	SUBSTR(obter_desc_abrev_local_pa(nr_seq_local_pa),1,255) ds_breve_local, 
	substr(OBTER_DESC_CID(OBTER_CID_ATENDIMENTO(a.NR_ATENDIMENTO,'P')),1,255) CD_CID_PRINCIPAL, 
	p.ie_sexo, 
	SUBSTR(obter_idade(p.dt_nascimento, LOCALTIMESTAMP, 'S'),1,15) qt_idade, 
	tO_CHAR(a.dt_medicacao,'hh24:mi') hr_medicacao,  
	TO_CHAR(a.DT_CHECAGEM_ADEP,'hh24:mi') hr_checagem_adep,  
	TO_CHAR(a.dt_lib_medico,'hh24:mi') hr_lib_medico,  
	TO_CHAR(a.dt_atend_medico,'hh24:mi') hr_inicio_consulta,  
	TO_CHAR(a.dt_fim_consulta,'hh24:mi') hr_fim_consulta,  
	TO_CHAR(a.dt_inicio_atendimento,'hh24:mi') hr_enfermagem,  
	TO_CHAR(a.dt_fim_triagem,'hh24:mi') hr_fim_enfermagem,  
	TO_CHAR(a.dt_chamada_paciente,'hh24:mi') hr_chamado,  
	TO_CHAR(a.dt_liberacao_enfermagem,'hh24:mi') hr_liberacao_enfermagem,  
	TO_CHAR(a.dt_reavaliacao_medica,'hh24:mi') hr_reavaliacao_medica, 
	SUBSTR(HTML5_OBTER_STATUS_ATEND_PA(	a.nr_Atendimento,a.dt_alta, 
	a.dt_medicacao, 
	a.dt_lib_medico, 
	a.dt_atend_medico, 
	a.dt_fim_consulta, 
	a.dt_inicio_atendimento	, 
	a.dt_fim_triagem, 
	a.dt_chamada_paciente, 
	a.dt_liberacao_enfermagem, 
	a.dt_reavaliacao_medica, 
	a.nr_atend_alta, 
	a.cd_estabelecimento, 
	a.dt_fim_reavaliacao, 
	a.dt_inicio_observacao, 
	a.dt_fim_observacao, 
	a.dt_chamada_reavaliacao, 
	a.dt_inicio_reavaliacao),1,10) ie_status_pa, 
	SUBSTR(obter_dados_tcp(a.nr_seq_triagem_prioridade,'DESC'),1,60) ds_triagem_prioridade,  
	(obter_dados_tcp(a.nr_seq_triagem_prioridade,'SEQ'))::numeric  ie_prioridade_classif, 
	obter_prioridade_classif_atend(a.nr_seq_classificacao) ie_prior_classif_atend 
FROM	setor_atendimento s,  
	pessoa_fisica p,  
	atend_categoria_convenio c,  
	atend_paciente_unidade b,  
	atendimento_paciente a  
WHERE	a.nr_atendimento 	= b.nr_atendimento  
AND	b.nr_seq_interno 	= obter_atepacu_paciente(a.nr_atendimento, 'A')  
AND	a.nr_Atendimento 	= c.nr_atendimento  
AND	c.nr_seq_interno	= obter_atecaco_atendimento(a.nr_atendimento)  
AND	b.cd_setor_atendimento		= s.cd_setor_atendimento  
AND	a.cd_pessoa_fisica		= p.cd_pessoa_fisica  
AND	a.nr_atendimento	> 0 /* Rafael em 07/10/2006 OS 41178 */
  
AND	EXISTS (SELECT 1  
		FROM	setor_atendimento x,  
			atend_paciente_unidade y  
		WHERE	a.nr_atendimento = y.nr_atendimento  
		AND	y.cd_setor_atendimento	= x.cd_setor_atendimento  
		AND	x.cd_classif_setor	= '1');

