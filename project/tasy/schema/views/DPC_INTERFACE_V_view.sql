-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW dpc_interface_v (si_type, nr_seq_patient_dpc, dt_entrada_dpc, dt_start_dcp, cd_dpc, si_category, si_out_come, si_inpatient_route, si_exit_point, si_normal_urgent, si_ambulance, dt_alta_dpc, qt_pregnancy_age_weeks, qt_birth_weight_grams, si_jcs, vl_burn_index, vl_gaf_score, si_pneumonia_state, vl_rankin_scale, si_stroke_onset, si_psychosomatic_disorder, si_cause_of_death, si_admission_reason, ds_doenca_cid, si_main, si_for_hospitalization, si_second_most_expensive, si_comorbidity_before, si_after_admission, si_sub_disease, si_most_expensive_disease, cd_doenca, cd_k_surgery_1, cd_k_surgery_2, cd_k_surgery_3, cd_k_surgery_4, cd_k_surgery_5, dt_surgery, dt_surgery2, dt_surgery3, dt_surgery4, dt_surgery5, cd_times_surgery, cd_times_surgery2, cd_times_surgery3, cd_times_surgery4, cd_times_surgery5, cd_external_part, cd_external_part2, cd_external_part3, cd_external_part4, cd_external_part5, cd_anesthesia, cd_anesthesia2, cd_anesthesia3, cd_anesthesia4, cd_anesthesia5, cd_treatment_1, dt_treatment_1, cd_treatment_2, dt_treatment_2) AS select  0 si_type,
		a.nr_sequencia nr_seq_patient_dpc,
		to_char(b.dt_entrada, 'YYYYMMDD') dt_entrada_dpc,
		null dt_start_dcp,
		c.cd_dpc,
		a.si_category,
		a.si_out_come,
		a.si_inpatient_route,
		a.si_exit_point,
		a.si_normal_urgent,
		a.si_ambulance,
		null dt_alta_dpc,
		0 qt_pregnancy_age_weeks,
		0 qt_birth_weight_grams,
		0 si_jcs,
		'' vl_burn_index,
		0 vl_gaf_score,
		'' si_pneumonia_state,
		0 vl_rankin_scale,
		0 si_stroke_onset,
		null si_psychosomatic_disorder,
		null si_cause_of_death,
		null si_admission_reason,
		'' ds_doenca_cid,
		'' si_main,
    	'' si_for_hospitalization,
    	'' si_second_most_expensive,
    	'' si_comorbidity_before,
    	'' si_after_admission,
    	'' si_sub_disease,
    	'' si_most_expensive_disease,
    	'' cd_doenca,
		'' cd_k_surgery_1,
		'' cd_k_surgery_2,
		'' cd_k_surgery_3,
		'' cd_k_surgery_4,
		'' cd_k_surgery_5,
		'' dt_surgery,
		'' dt_surgery2,
		'' dt_surgery3,
		'' dt_surgery4,
		'' dt_surgery5,
		'' cd_times_surgery,
		'' cd_times_surgery2,
		'' cd_times_surgery3,
		'' cd_times_surgery4,
		'' cd_times_surgery5,
		'' cd_external_part,
		'' cd_external_part2,
		'' cd_external_part3,
		'' cd_external_part4,
		'' cd_external_part5,
		'' cd_anesthesia,
		'' cd_anesthesia2,
		'' cd_anesthesia3,
		'' cd_anesthesia4,
		'' cd_anesthesia5,
		'' cd_treatment_1,
		'' dt_treatment_1,
		'' cd_treatment_2,
		'' dt_treatment_2
FROM	patient_dpc a,
		atendimento_paciente b,
		dpc_score c
where	a.nr_atendimento = b.nr_atendimento
and     a.nr_seq_dpc_score = c.nr_sequencia

union all

/*DPC General condition*/

select	1 si_type,
		b.nr_seq_patient_dpc,
		'' dt_entrada_dpc,
		'' dt_start_dpc,
		'' cd_dpc,
		'' si_category,
		'' si_out_come,
		'' si_inpatient_route,
		'' si_exit_point,
		'' si_normal_urgent,
		'' si_ambulance,
		'' dt_alta_dpc,
		b.qt_pregnancy_age_weeks,
		b.qt_birth_weight_grams,
		b.si_jcs,
		b.vl_burn_index,
		b.vl_gaf_score,
		b.si_pneumonia_state,
		b.vl_rankin_scale,
		b.si_stroke_onset,
		null si_psychosomatic_disorder,
		null si_cause_of_death,
		null si_admission_reason,
		'' ds_doenca_cid,
		'' si_main,
    	'' si_for_hospitalization,
    	'' si_second_most_expensive,
    	'' si_comorbidity_before,
    	'' si_after_admission,
    	'' si_sub_disease,
    	'' si_most_expensive_disease,
    	'' cd_doenca,
		'' cd_k_surgery_1,
		'' cd_k_surgery_2,
		'' cd_k_surgery_3,
		'' cd_k_surgery_4,
		'' cd_k_surgery_5,
		'' dt_surgery,
		'' dt_surgery2,
		'' dt_surgery3,
		'' dt_surgery4,
		'' dt_surgery5,
		'' cd_times_surgery,
		'' cd_times_surgery2,
		'' cd_times_surgery3,
		'' cd_times_surgery4,
		'' cd_times_surgery5,
		'' cd_external_part,
		'' cd_external_part2,
		'' cd_external_part3,
		'' cd_external_part4,
		'' cd_external_part5,
		'' cd_anesthesia,
		'' cd_anesthesia2,
		'' cd_anesthesia3,
		'' cd_anesthesia4,
		'' cd_anesthesia5,
		'' cd_treatment_1,
		'' dt_treatment_1,
		'' cd_treatment_2,
		'' dt_treatment_2
from	patient_dpc a,
		patient_dpc_general_cond b
where	b.nr_seq_patient_dpc = a.nr_sequencia

union all

/*Diagnosis information*/

select	2 si_type,
		b.nr_seq_patient_dpc,
		'' dt_entrada_dpc,
		'' dt_start_dpc,
		'' cd_dpc,
		'' si_category,
		'' si_out_come,
		'' si_inpatient_route,
		'' si_exit_point,
		'' si_normal_urgent,
		'' si_ambulance,
		'' dt_alta_dpc,
		0 qt_pregnancy_age_weeks,
		0 qt_birth_weight_grams,
		0 si_jcs,
		'' vl_burn_index,
		0 vl_gaf_score,
		'' si_pneumonia_state,
		0 vl_rankin_scale,
		0 si_stroke_onset,
		CASE WHEN b.si_psychosomatic_disorder='Y' THEN  1  ELSE '' END  si_psychosomatic_disorder,
		CASE WHEN b.si_cause_of_death='Y' THEN  1  ELSE '' END  si_cause_of_death,
		lpad(a.si_admission_reason, 2,'0') si_admission_reason,
		'' ds_doenca_cid,
		b.si_main,
    	b.si_for_hospitalization,
    	b.si_second_most_expensive,
    	b.si_comorbidity_before,
    	b.si_after_admission,
    	b.si_sub_disease,
    	'N' si_most_expensive_disease,
    	c.cd_doenca,
		'' cd_k_surgery_1,
		'' cd_k_surgery_2,
		'' cd_k_surgery_3,
		'' cd_k_surgery_4,
		'' cd_k_surgery_5,
		'' dt_surgery,
		'' dt_surgery2,
		'' dt_surgery3,
		'' dt_surgery4,
		'' dt_surgery5,
		'' cd_times_surgery,
		'' cd_times_surgery2,
		'' cd_times_surgery3,
		'' cd_times_surgery4,
		'' cd_times_surgery5,
		'' cd_external_part,
		'' cd_external_part2,
		'' cd_external_part3,
		'' cd_external_part4,
		'' cd_external_part5,
		'' cd_anesthesia,
		'' cd_anesthesia2,
		'' cd_anesthesia3,
		'' cd_anesthesia4,
		'' cd_anesthesia5,
		'' cd_treatment_1,
		'' dt_treatment_1,
		'' cd_treatment_2,
		'' dt_treatment_2
from	patient_dpc a,
		patient_dpc_diagnosis b,
		diagnostico_doenca c
where	b.nr_seq_patient_dpc = a.nr_sequencia
and		c.nr_seq_interno = b.nr_seq_diagnosis

union all

select	2 si_type,
		b.nr_seq_patient_dpc,
		'' dt_entrada_dpc,
		'' dt_start_dpc,
		'' cd_dpc,
		'' si_category,
		'' si_out_come,
		'' si_inpatient_route,
		'' si_exit_point,
		'' si_normal_urgent,
		'' si_ambulance,
		'' dt_alta_dpc,
		0 qt_pregnancy_age_weeks,
		0 qt_birth_weight_grams,
		0 si_jcs,
		'' vl_burn_index,
		0 vl_gaf_score,
		'' si_pneumonia_state,
		0 vl_rankin_scale,
		0 si_stroke_onset,
		null si_psychosomatic_disorder,
		null si_cause_of_death,
		null si_admission_reason,
		'' ds_doenca_cid,
		'N' si_main,
    	'N' si_for_hospitalization,
    	'N' si_second_most_expensive,
    	'N' si_comorbidity_before,
    	'N' si_after_admission,
    	'N' si_sub_disease,
    	'Y' si_most_expensive_disease,
    	c.cd_doenca,
		'' cd_k_surgery_1,
		'' cd_k_surgery_2,
		'' cd_k_surgery_3,
		'' cd_k_surgery_4,
		'' cd_k_surgery_5,
		'' dt_surgery,
		'' dt_surgery2,
		'' dt_surgery3,
		'' dt_surgery4,
		'' dt_surgery5,
		'' cd_times_surgery,
		'' cd_times_surgery2,
		'' cd_times_surgery3,
		'' cd_times_surgery4,
		'' cd_times_surgery5,
		'' cd_external_part,
		'' cd_external_part2,
		'' cd_external_part3,
		'' cd_external_part4,
		'' cd_external_part5,
		'' cd_anesthesia,
		'' cd_anesthesia2,
		'' cd_anesthesia3,
		'' cd_anesthesia4,
		'' cd_anesthesia5,
		'' cd_treatment_1,
		'' dt_treatment_1,
		'' cd_treatment_2,
		'' dt_treatment_2
from	patient_dpc a,
		patient_dpc_diagnosis b,
		diagnostico_doenca c
where	b.nr_seq_patient_dpc = a.nr_sequencia
and		c.nr_seq_interno = b.nr_seq_diagnosis

union all

/*Surgery information*/

select	3 si_type,
		b.nr_seq_patient_dpc,
		'' dt_entrada_dpc,
		'' dt_start_dpc,
		'' cd_dpc,
		'' si_category,
		'' si_out_come,
		'' si_inpatient_route,
		'' si_exit_point,
		'' si_normal_urgent,
		'' si_ambulance,
		'' dt_alta_dpc,
		0 qt_pregnancy_age_weeks,
		0 qt_birth_weight_grams,
		0 si_jcs,
		'' vl_burn_index,
		0 vl_gaf_score,
		'' si_pneumonia_state,
		0 vl_rankin_scale,
		0 si_stroke_onset,
		null si_psychosomatic_disorder,
		null si_cause_of_death,
		null si_admission_reason,
		'' ds_doenca_cid,
		'N' si_main,
    	'N' si_for_hospitalization,
    	'N' si_second_most_expensive,
    	'N' si_comorbidity_before,
    	'N' si_after_admission,
    	'N' si_sub_disease,
    	'Y' si_most_expensive_disease,
    	'' cd_doenca,
		c.cd_k_surgery_1,
		c.cd_k_surgery_2,
		c.cd_k_surgery_3,
		c.cd_k_surgery_4,
		c.cd_k_surgery_5,
		to_char(b.dt_surgery, 'YYYYMMDD') dt_surgery,
		to_char(b.dt_surgery2, 'YYYYMMDD') dt_surgery2,
		to_char(b.dt_surgery3, 'YYYYMMDD') dt_surgery3,
		to_char(b.dt_surgery4, 'YYYYMMDD') dt_surgery4,
		to_char(b.dt_surgery5, 'YYYYMMDD') dt_surgery5,
		b.cd_times_surgery,
		b.cd_times_surgery2,
		b.cd_times_surgery3,
		b.cd_times_surgery4,
		b.cd_times_surgery5,
		b.cd_external_part,
		b.cd_external_part2,
		b.cd_external_part3,
		b.cd_external_part4,
		b.cd_external_part5,
		b.cd_anesthesia,
		b.cd_anesthesia2,
		b.cd_anesthesia3,
		b.cd_anesthesia4,
		b.cd_anesthesia5,
		'' cd_treatment_1,
		'' dt_treatment_1,
		'' cd_treatment_2,
		'' dt_treatment_2
from    patient_dpc a,
        patient_dpc_surgery b,
        dpc_surgery c
where 	b.nr_seq_patient_dpc = a.nr_sequencia
and		c.nr_sequencia = b.nr_seq_patient_dpc
and 	a.ie_situacao = 'A'

union all

/*Treatment information*/

select	4 si_type,
		b.nr_seq_patient_dpc,
		'' dt_entrada_dpc,
		'' dt_start_dpc,
		'' cd_dpc,
		'' si_category,
		'' si_out_come,
		'' si_inpatient_route,
		'' si_exit_point,
		'' si_normal_urgent,
		'' si_ambulance,
		'' dt_alta_dpc,
		0 qt_pregnancy_age_weeks,
		0 qt_birth_weight_grams,
		0 si_jcs,
		'' vl_burn_index,
		0 vl_gaf_score,
		'' si_pneumonia_state,
		0 vl_rankin_scale,
		0 si_stroke_onset,
		null si_psychosomatic_disorder,
		null si_cause_of_death,
		null si_admission_reason,
		'' ds_doenca_cid,
		'N' si_main,
    	'N' si_for_hospitalization,
    	'N' si_second_most_expensive,
    	'N' si_comorbidity_before,
    	'N' si_after_admission,
    	'N' si_sub_disease,
    	'Y' si_most_expensive_disease,
    	'' cd_doenca,
		'' cd_k_surgery_1,
		'' cd_k_surgery_2,
		'' cd_k_surgery_3,
		'' cd_k_surgery_4,
		'' cd_k_surgery_5,
		'' dt_surgery,
		'' dt_surgery2,
		'' dt_surgery3,
		'' dt_surgery4,
		'' dt_surgery5,
		'' cd_times_surgery,
		'' cd_times_surgery2,
		'' cd_times_surgery3,
		'' cd_times_surgery4,
		'' cd_times_surgery5,
		'' cd_external_part,
		'' cd_external_part2,
		'' cd_external_part3,
		'' cd_external_part4,
		'' cd_external_part5,
		'' cd_anesthesia,
		'' cd_anesthesia2,
		'' cd_anesthesia3,
		'' cd_anesthesia4,
		'' cd_anesthesia5,
		(	select 	max(x.cd_treatment_1)
			From 	dpc_treatment x
            Where 	x.nr_sequencia = b.nr_seq_dpc_treat_1
			and		nr_seq_patient_dpc = a.nr_sequencia
		) cd_treatment_1,
		to_char(b.dt_treatment_1, 'YYYYMMDD') dt_treatment_1,
		(	select 	max(x.cd_treatment_2)
			From 	dpc_treatment x
            Where 	x.nr_sequencia = b.nr_seq_dpc_treat_2
			and		nr_seq_patient_dpc = a.nr_sequencia
		) cd_treatment_2,
		to_char(b.dt_treatment_2, 'YYYYMMDD') dt_treatment_2
from	patient_dpc a,
		patient_dpc_treatment b;

