-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW solic_compra_exp_v (tp_registro, nr_solic_compra, dt_solicitacao_compra, cd_pessoa_solicitante, nm_pessoa_solicitante, cd_conta_contabil, cd_centro_custo, ds_observacao_solic, cd_estabelecimento, nr_item_solic_compra, cd_material, cd_unidade_medida_compra, qt_material, dt_solic_item, nr_seq_aprovacao, dt_autorizacao_item, ds_descr_compl_item, ds_observacao_item, nr_item_solic_compra_entr, qt_entrega_solicitada, dt_entrega_solicitada, nr_seq_motivo_cancel, ie_forma_exportar) AS select	1 tp_registro,
	s.nr_solic_compra		nr_solic_compra, 
	s.dt_solicitacao_compra 	dt_solicitacao_compra, 
	s.cd_pessoa_solicitante	cd_pessoa_solicitante, 
	substr(obter_nome_pf(s.cd_pessoa_solicitante),1,60) nm_pessoa_solicitante, 
	s.cd_conta_contabil		cd_conta_contabil, 
	s.cd_centro_custo		cd_centro_custo, 
	s.ds_observacao		ds_observacao_solic, 
	s.cd_estabelecimento		cd_estabelecimento, 
	0				nr_item_solic_compra, 
	0				cd_material, 
	'0'				cd_unidade_medida_compra, 
	0				qt_material, 
	to_date(null)			dt_solic_item, 
	0				nr_seq_aprovacao, 
	to_date(null)			dt_autorizacao_item, 
	''				ds_descr_compl_item, 
	''				ds_observacao_item, 
	0				nr_item_solic_compra_entr, 
	0				qt_entrega_solicitada, 
	to_date(null)			dt_entrega_solicitada, 
	s.nr_seq_motivo_cancel, 
	s.ie_forma_exportar 
FROM	solic_compra s 
where	s.dt_autorizacao is not null 

union
 
select	3 tp_registro, 
	s.nr_solic_compra		nr_solic_compra, 
	s.dt_solicitacao_compra	dt_solicitacao_compra, 
	'0'				cd_pessoa_solicitante, 
	''				nm_pessoa_solicitante, 
	''				cd_conta_contabil, 
	0				cd_centro_custo, 
	''				ds_observacao_solic, 
	s.cd_estabelecimento		cd_estabelecimento, 
	i.nr_item_solic_compra	nr_item_solic_compra, 
	i.cd_material			cd_material, 
	i.cd_unidade_medida_compra	cd_unidade_medida_compra, 
	i.qt_material			qt_material, 
	i.dt_solic_item		dt_solic_item, 
	i.nr_seq_aprovacao		nr_seq_aprovacao, 
	i.dt_autorizacao		dt_autorizacao_item, 
	i.ds_material_direto		ds_descr_compl_item, 
	i.ds_observacao		ds_observacao_item, 
	0				nr_item_solic_compra_entr, 
	0				qt_entrega_solicitada, 
	to_date(null)			dt_entrega_solicitada, 
	s.nr_seq_motivo_cancel, 
	s.ie_forma_exportar 
from	solic_compra_item i, 
	solic_compra s	 
where	s.nr_solic_compra = i.nr_solic_compra 
and	s.dt_autorizacao is not null 
and	i.dt_reprovacao is null 

union
 
select	5 tp_registro, 
	s.nr_solic_compra		nr_solic_compra, 
	s.dt_solicitacao_compra	dt_solicitacao_compra, 
	'0'				cd_pessoa_solicitante, 
	''				nm_pessoa_solicitante, 
	''				cd_conta_contabil, 
	0				cd_centro_custo, 
	''				ds_observacao_solic, 
	s.cd_estabelecimento		cd_estabelecimento, 
	i.nr_item_solic_compra	nr_item_solic_compra, 
	0				cd_material, 
	'0'				cd_unidade_medida_compra, 
	0				qt_material, 
	to_date(null)			dt_solic_item, 
	0				nr_seq_aprovacao, 
	to_date(null)			dt_autorizacao_item, 
	''				ds_descr_compl_item, 
	''				ds_observacao_item, 
	d.nr_item_solic_compra_entr	nr_item_solic_compra_entr, 
	d.qt_entrega_solicitada	qt_entrega_solicitada, 
	d.dt_entrega_solicitada	dt_entrega_solicitada, 
	s.nr_seq_motivo_cancel, 
	s.ie_forma_exportar 
from	solic_compra_item_entrega d, 
	solic_compra_item i, 
	solic_compra s 
where	s.nr_solic_compra 		= i.nr_solic_compra 
and	d.nr_item_solic_compra	= i.nr_item_solic_compra 
and	s.dt_autorizacao is not null 
and	i.dt_reprovacao is null 
and	s.nr_solic_compra 		= d.nr_solic_compra;

