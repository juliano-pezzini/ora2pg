-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW atendimento_paciente_v2 (nr_atendimento, nr_atend_original, dt_entrada, cd_pessoa_fisica, ie_tipo_atendimento, cd_medico_resp, dt_alta, ie_clinica, cd_estabelecimento, ie_tipo_convenio, cd_setor_atendimento, cd_convenio, cd_categoria, cd_usuario_convenio, nr_doc_convenio, nr_guia_atend, dt_inicio_vigencia, dt_final_vigencia, cd_plano_convenio, dt_nascimento, cd_cid_principal, ds_senha, nr_dia_internado, ds_obs_alta, nr_seq_forma_chegada, nr_cartao_nac_sus, ie_tipo_guia, nr_seq_classificacao, nr_seq_queixa, ie_tipo_atend_tiss, nr_seq_origem, dt_cancelamento, dt_saida_real, nm_usuario_saida, nr_seq_grau_parentesco, cd_motivo_alta) AS SELECT C.NR_ATENDIMENTO,
	A.NR_ATEND_ORIGINAL,
	A.DT_ENTRADA,
	A.CD_PESSOA_FISICA,
	A.IE_TIPO_ATENDIMENTO,
	A.CD_MEDICO_RESP,
	A.DT_ALTA,
	A.IE_CLINICA,
	A.CD_ESTABELECIMENTO,
	A.IE_TIPO_CONVENIO,
	B.CD_SETOR_ATENDIMENTO,
	C.CD_CONVENIO,
	C.CD_CATEGORIA,
	C.CD_USUARIO_CONVENIO,
	C.NR_DOC_CONVENIO,
	C.NR_DOC_CONVENIO NR_GUIA_ATEND,
	C.DT_INICIO_VIGENCIA,
	C.DT_FINAL_VIGENCIA,
	C.CD_PLANO_CONVENIO,
	P.DT_NASCIMENTO,
	substr(OBTER_CID_ATENDIMENTO(A.NR_ATENDIMENTO,'P'),1,10) CD_CID_PRINCIPAL,
	CASE WHEN coalesce(pkg_i18n.get_user_locale, 'pt_BR')='pt_BR' THEN  A.ds_senha  ELSE null END  ds_senha,
	trunc(coalesce(A.DT_ALTA, LOCALTIMESTAMP) - A.DT_ENTRADA) NR_DIA_INTERNADO,
	ds_obs_alta,
	A.nr_seq_forma_chegada,
	P.nr_cartao_nac_sus,
	C.ie_tipo_guia,
	A.nr_seq_classificacao,
	A.NR_SEQ_QUEIXA,
	A.ie_tipo_atend_tiss,
	C.nr_seq_origem,
	A.dt_cancelamento,
	A.dt_saida_real,
	A.nm_usuario_saida,
	A.nr_seq_grau_parentesco,
	A.cd_motivo_alta
FROM convenio v, categoria_convenio t, setor_atendimento s, pessoa_fisica p, pessoa_fisica m, atend_paciente_unidade b, atend_categoria_convenio c
LEFT OUTER JOIN convenio_origem_usuario k ON (C.NR_SEQ_ORIGEM = K.NR_SEQUENCIA)
, atendimento_paciente a
LEFT OUTER JOIN motivo_alta d ON (A.CD_MOTIVO_ALTA = D.CD_MOTIVO_ALTA)
LEFT OUTER JOIN medico n ON (A.CD_MEDICO_RESP = N.CD_PESSOA_FISICA)
WHERE (A.NR_ATENDIMENTO = B.NR_ATENDIMENTO) AND (B.NR_SEQ_INTERNO = OBTER_ATEPACU_PACIENTE(A.NR_ATENDIMENTO, 'A')) AND (A.NR_ATENDIMENTO = C.NR_ATENDIMENTO) AND (C.NR_SEQ_INTERNO = OBTER_ATECACO_ATENDIMENTO(A.NR_ATENDIMENTO))  AND (B.CD_SETOR_ATENDIMENTO	= S.CD_SETOR_ATENDIMENTO) AND (C.CD_CONVENIO		= V.CD_CONVENIO) and (A.CD_MEDICO_RESP	= M.CD_PESSOA_FISICA)  AND (A.CD_PESSOA_FISICA	= P.CD_PESSOA_FISICA)  AND (C.CD_CONVENIO		= T.CD_CONVENIO) AND (C.CD_CATEGORIA		= T.CD_CATEGORIA);

