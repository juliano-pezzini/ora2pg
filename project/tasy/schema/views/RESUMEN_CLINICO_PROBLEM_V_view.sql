-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW resumen_clinico_problem_v (ie_tipo_atendimento_cod, ie_tipo_atendimento_nome, dt_entrada, dt_alta, nr_crm, nm_primeiro_nome, nm_sobrenome_pai, nm_sobrenome_mae, ie_classif_alta_cod, ie_classif_alta_nome, nr_atendimento, cd_pessoa_fisica) AS SELECT	CASE WHEN AP.IE_TIPO_ATENDIMENTO=3 THEN 'EMER' WHEN AP.IE_TIPO_ATENDIMENTO=7 THEN 'FLD' WHEN AP.IE_TIPO_ATENDIMENTO=8 THEN 'AMB' WHEN AP.IE_TIPO_ATENDIMENTO=1 THEN 'IMP' WHEN AP.IE_TIPO_ATENDIMENTO=10 THEN 'ACUTE' WHEN AP.IE_TIPO_ATENDIMENTO=11 THEN 'HH' WHEN AP.IE_TIPO_ATENDIMENTO=12 THEN 'SS' WHEN AP.IE_TIPO_ATENDIMENTO=14 THEN 'VR' END  IE_TIPO_ATENDIMENTO_COD,
		CASE WHEN AP.IE_TIPO_ATENDIMENTO=3 THEN 'Urgencias' WHEN AP.IE_TIPO_ATENDIMENTO=7 THEN 'Fuera del establecimiento de salud' WHEN AP.IE_TIPO_ATENDIMENTO=8 THEN 'Ambulatorio' WHEN AP.IE_TIPO_ATENDIMENTO=1 THEN 'Hospitalización' WHEN AP.IE_TIPO_ATENDIMENTO=10 THEN 'Cuidados intensivos / Hospitalización aguda' WHEN AP.IE_TIPO_ATENDIMENTO=11 THEN 'Cuidados caseros' WHEN AP.IE_TIPO_ATENDIMENTO=12 THEN 'Corta Estancia' WHEN AP.IE_TIPO_ATENDIMENTO=14 THEN 'Virtual (Telesalud)' END  IE_TIPO_ATENDIMENTO_NOME,
		AP.DT_ENTRADA DT_ENTRADA,
		AP.DT_ALTA DT_ALTA,
		M.NR_CRM NR_CRM,
		z.DS_GIVEN_NAME NM_PRIMEIRO_NOME,
  		z.DS_COMPONENT_NAME_1 NM_SOBRENOME_PAI,
  		z.DS_COMPONENT_NAME_2 NM_SOBRENOME_MAE,
		CASE WHEN MA.IE_CLASSIF_ALTA=1 THEN 5 WHEN MA.IE_CLASSIF_ALTA=3 THEN 4 WHEN MA.IE_CLASSIF_ALTA=2 THEN 3 WHEN MA.IE_CLASSIF_ALTA=5 THEN 2 WHEN MA.IE_CLASSIF_ALTA=6 THEN 1 WHEN MA.IE_CLASSIF_ALTA=7 THEN 6 END  IE_CLASSIF_ALTA_COD,
		CASE WHEN MA.IE_CLASSIF_ALTA=1 THEN 'Defunción' WHEN MA.IE_CLASSIF_ALTA=3 THEN 'Pase a otro hospital' WHEN MA.IE_CLASSIF_ALTA=2 THEN 'Voluntario' WHEN MA.IE_CLASSIF_ALTA=5 THEN 'Mejoría' WHEN MA.IE_CLASSIF_ALTA=6 THEN 'Curación' WHEN MA.IE_CLASSIF_ALTA=7 THEN 'Otro motivo' END  IE_CLASSIF_ALTA_NOME,
		a.nr_atendimento nr_atendimento,
		PF_P.CD_PESSOA_FISICA CD_PESSOA_FISICA
FROM medico m, lista_problema_pac_incid a, atendimento_paciente ap
LEFT OUTER JOIN motivo_alta ma ON (AP.CD_MOTIVO_ALTA = MA.CD_MOTIVO_ALTA)
, pessoa_fisica pf_p
LEFT OUTER JOIN table(pkg_name_utils.search_names_legacy('', 'main')) z ON (PF_P.NR_SEQ_PERSON_NAME = z.NR_SEQUENCIA)
WHERE a.nr_atendimento = AP.nr_atendimento AND PF_P.CD_PESSOA_FISICA = AP.CD_PESSOA_FISICA AND AP.CD_MEDICO_RESP = M.CD_PESSOA_FISICA   AND a.nr_seq_problema IN (	SELECT 	x.nr_sequencia
								FROM    lISTA_PROBLEMA_PAC x
								WHERE   x.nr_atendimento = a.nr_atendimento)

UNION

SELECT	CASE WHEN AP.IE_TIPO_ATENDIMENTO=3 THEN 'EMER' WHEN AP.IE_TIPO_ATENDIMENTO=7 THEN 'FLD' WHEN AP.IE_TIPO_ATENDIMENTO=8 THEN 'AMB' WHEN AP.IE_TIPO_ATENDIMENTO=1 THEN 'IMP' WHEN AP.IE_TIPO_ATENDIMENTO=10 THEN 'ACUTE' WHEN AP.IE_TIPO_ATENDIMENTO=11 THEN 'HH' WHEN AP.IE_TIPO_ATENDIMENTO=12 THEN 'SS' WHEN AP.IE_TIPO_ATENDIMENTO=14 THEN 'VR' END  IE_TIPO_ATENDIMENTO_COD,
		CASE WHEN AP.IE_TIPO_ATENDIMENTO=3 THEN 'Urgencias' WHEN AP.IE_TIPO_ATENDIMENTO=7 THEN 'Fuera del establecimiento de salud' WHEN AP.IE_TIPO_ATENDIMENTO=8 THEN 'Ambulatorio' WHEN AP.IE_TIPO_ATENDIMENTO=1 THEN 'Hospitalización' WHEN AP.IE_TIPO_ATENDIMENTO=10 THEN 'Cuidados intensivos / Hospitalización aguda' WHEN AP.IE_TIPO_ATENDIMENTO=11 THEN 'Cuidados caseros' WHEN AP.IE_TIPO_ATENDIMENTO=12 THEN 'Corta Estancia' WHEN AP.IE_TIPO_ATENDIMENTO=14 THEN 'Virtual (Telesalud)' END  IE_TIPO_ATENDIMENTO_NOME,
		AP.DT_ENTRADA DT_ENTRADA,
		AP.DT_ALTA DT_ALTA,
		M.NR_CRM NR_CRM,
		z.DS_GIVEN_NAME NM_PRIMEIRO_NOME,
  		z.DS_COMPONENT_NAME_1 NM_SOBRENOME_PAI,
  		z.DS_COMPONENT_NAME_2 NM_SOBRENOME_MAE,
		CASE WHEN MA.IE_CLASSIF_ALTA=1 THEN 5 WHEN MA.IE_CLASSIF_ALTA=3 THEN 4 WHEN MA.IE_CLASSIF_ALTA=2 THEN 3 WHEN MA.IE_CLASSIF_ALTA=5 THEN 2 WHEN MA.IE_CLASSIF_ALTA=6 THEN 1 WHEN MA.IE_CLASSIF_ALTA=7 THEN 6 END  IE_CLASSIF_ALTA_COD,
		CASE WHEN MA.IE_CLASSIF_ALTA=1 THEN 'Defunción' WHEN MA.IE_CLASSIF_ALTA=3 THEN 'Pase a otro hospital' WHEN MA.IE_CLASSIF_ALTA=2 THEN 'Voluntario' WHEN MA.IE_CLASSIF_ALTA=5 THEN 'Mejoría' WHEN MA.IE_CLASSIF_ALTA=6 THEN 'Curación' WHEN MA.IE_CLASSIF_ALTA=7 THEN 'Otro motivo' END  IE_CLASSIF_ALTA_NOME,
		a.nr_atendimento nr_atendimento,
		PF_P.CD_PESSOA_FISICA CD_PESSOA_FISICA
FROM medico m, lista_problema_pac a, atendimento_paciente ap
LEFT OUTER JOIN motivo_alta ma ON (AP.CD_MOTIVO_ALTA = MA.CD_MOTIVO_ALTA)
, pessoa_fisica pf_p
LEFT OUTER JOIN table(pkg_name_utils.search_names_legacy('', 'main')) z ON (PF_P.NR_SEQ_PERSON_NAME = z.NR_SEQUENCIA)
WHERE a.nr_atendimento = AP.nr_atendimento AND PF_P.CD_PESSOA_FISICA = AP.CD_PESSOA_FISICA AND AP.CD_MEDICO_RESP = M.CD_PESSOA_FISICA;

