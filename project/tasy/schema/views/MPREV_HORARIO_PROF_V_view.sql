-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW mprev_horario_prof_v (cd_agenda, horario, ie_segunda, ie_terca, ie_quarta, ie_quinta, ie_sexta, ie_sabado, ie_domingo) AS select	cd_agenda,
	horario,
	max(CASE WHEN ie_dia_semana='2' THEN ie_entrada_saida WHEN ie_dia_semana='9' THEN ie_entrada_saida  ELSE null END ) IE_SEGUNDA,
	max(CASE WHEN ie_dia_semana='3' THEN ie_entrada_saida WHEN ie_dia_semana='9' THEN ie_entrada_saida  ELSE null END ) IE_TERCA,
	max(CASE WHEN ie_dia_semana='4' THEN ie_entrada_saida WHEN ie_dia_semana='9' THEN ie_entrada_saida  ELSE null END ) IE_QUARTA,
	max(CASE WHEN ie_dia_semana='5' THEN ie_entrada_saida WHEN ie_dia_semana='9' THEN ie_entrada_saida  ELSE null END ) IE_QUINTA,
	max(CASE WHEN ie_dia_semana='6' THEN ie_entrada_saida WHEN ie_dia_semana='9' THEN ie_entrada_saida  ELSE null END ) IE_SEXTA,
	max(CASE WHEN ie_dia_semana='7' THEN ie_entrada_saida WHEN ie_dia_semana='9' THEN ie_entrada_saida  ELSE null END ) IE_SABADO,
	max(CASE WHEN ie_dia_semana='1' THEN ie_entrada_saida WHEN ie_dia_semana='9' THEN ie_entrada_saida  ELSE null END ) IE_DOMINGO
FROM (
/* Hora entrada */

select	a.cd_agenda,
	to_char(a.hr_inicial,'hh24:mi') horario,
	a.ie_dia_semana,
	'Entrada' ie_entrada_saida
from	agenda_turno a

union all

/* Hora início intervalo */

select	a.cd_agenda,
	to_char(a.hr_inicial_intervalo,'hh24:mi') horario,
	a.ie_dia_semana,
	'Início Intervalo' ie_entrada_saida
from	agenda_turno a
where	a.hr_inicial_intervalo is not null

union all

/* Hora fim intervalo */

select	a.cd_agenda,
	to_char(a.hr_final_intervalo,'hh24:mi') horario,
	a.ie_dia_semana,
	'Fim Intervalo' ie_entrada_saida
from	agenda_turno a
where	a.hr_final_intervalo is not null

union all

/* Hora saída */

select	a.cd_agenda,
	to_char(a.hr_final,'hh24:mi') horario,
	a.ie_dia_semana,
	'Saída' ie_entrada_saida
from	agenda_turno a
) alias11
group by
	cd_agenda,
	horario;

