-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW atend_obito_cirurgico_v (nr_atendimento, cd_faixa_etaria, ds_faixa_etaria, ie_sexo, ds_carater_atend, cd_carater_internacao, dt_obito, qt_atend) AS SELECT distinct a.nr_atendimento,
		  obter_faixa_etaria_pac(a.cd_pessoa_fisica, 'C') cd_FAIXA_ETARIA,
		  OBTER_FAIXA_ETARIA_PAC(a.cd_pessoa_fisica, 'D') ds_faixa_etaria,
		  Obter_Sexo_PF(a.cd_pessoa_fisica, 'C') ie_sexo,
		  d.ds_carater_internacao ds_carater_atend,
		  d.CD_CARATER_INTERNACAO CD_CARATER_INTERNACAO,
		  a.dt_alta dt_obito,
		  1 QT_ATEND
FROM cirurgia c, motivo_alta b, sus_carater_internacao d
LEFT OUTER JOIN atendimento_paciente a ON (d.CD_CARATER_INTERNACAO = a.IE_CARATER_INTER_SUS)
WHERE a.CD_MOTIVO_ALTA = b.CD_MOTIVO_ALTA AND C.nr_atendimento = a.nr_atendimento  AND b.IE_OBITO = 'S' AND pkg_date_utils.get_diffdate(C.dt_inicio_real, a.dt_alta, 'DAY') < 8 AND pkg_date_utils.get_diffdate(C.dt_inicio_real, a.dt_alta, 'DAY') >= 0 GROUP BY a.nr_atendimento,
	obter_faixa_etaria_pac(a.cd_pessoa_fisica, 'C'),
	  	 OBTER_FAIXA_ETARIA_PAC(a.cd_pessoa_fisica, 'D'),
	  	 Obter_Sexo_PF(a.cd_pessoa_fisica, 'C'),
		 d.ds_carater_internacao,
		 d.CD_CARATER_INTERNACAO,
		 a.dt_alta;

