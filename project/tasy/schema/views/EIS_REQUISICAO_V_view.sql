-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_requisicao_v (cd_estabelecimento, nr_requisicao, dt_solicitacao_requisicao, cd_pessoa_requisitante, nm_pessoa_requisitante, cd_operacao_estoque, ds_operacao_estoque, cd_local_estoque, ds_local_estoque, cd_centro_custo, ds_centro_custo, cd_local_estoque_destino, ds_local_estoque_destino, cd_setor_atendimento, ds_setor_atendimento, cd_material, ds_material, cd_conta_contabil, ds_conta_contabil, cd_motivo_baixa, ds_motivo_baixa, qt_material_requisitada, vl_material, cd_grupo_material, ds_grupo_material, cd_subgrupo_material, ds_subgrupo_material, cd_classe_material, ds_classe_material, dt_liberacao, dt_baixa, dt_recebimento, nm_usuario_atendente, nm_usuario_recebedor, cd_setor_entrega, ds_setor_entrega) AS select	b.cd_estabelecimento,
	b.nr_requisicao, 
	b.dt_solicitacao_requisicao, 
	b.cd_pessoa_requisitante, 
	substr(obter_nome_pf_pj(b.cd_pessoa_requisitante, null),1,80) nm_pessoa_requisitante, 
	b.cd_operacao_estoque, 
	substr(obter_desc_operacao_estoque(b.cd_operacao_estoque),1,80) ds_operacao_estoque, 
	b.cd_local_estoque, 
	substr(obter_desc_local_estoque(b.cd_local_estoque),1,80) ds_local_estoque, 
	b.cd_centro_custo, 
	substr(obter_desc_centro_custo(b.cd_centro_custo),1,80) ds_centro_custo, 
	b.cd_local_estoque_destino, 
	substr(obter_desc_local_estoque(b.cd_local_estoque_destino),1,80) ds_local_estoque_destino, 
	b.cd_setor_atendimento, 
	substr(obter_nome_setor(b.cd_setor_atendimento),1,80) ds_setor_atendimento, 
	a.cd_material, 
	substr(obter_desc_material(a.cd_material),1,80) ds_material, 
	a.cd_conta_contabil, 
	substr(obter_desc_conta_contabil(a.cd_conta_contabil),1,80) ds_conta_contabil, 
	a.cd_motivo_baixa, 
	substr(obter_desc_motivo_baixa_req(a.cd_motivo_baixa),1,80) ds_motivo_baixa, 
	a.qt_material_requisitada, 
	(a.qt_estoque * obter_custo_medio_material(b.cd_estabelecimento, trunc(b.dt_solicitacao_requisicao,'mm'), a.cd_material)) vl_material, 
	c.cd_grupo_material, 
	c.ds_grupo_material, 
	c.cd_subgrupo_material, 
	c.ds_subgrupo_material, 
	c.cd_classe_material, 
	c.ds_classe_material, 
	trunc(b.dt_liberacao,'dd') dt_liberacao, 
	trunc(b.dt_baixa,'dd') dt_baixa, 
	trunc(b.dt_recebimento,'dd') dt_recebimento, 
	substr(obter_nome_pf_pj(a.cd_pessoa_atende,null),1,80) nm_usuario_atendente, 
	substr(obter_nome_usuario(b.nm_usuario_recebedor),1,255) nm_usuario_recebedor, 
	b.cd_setor_entrega, 
	obter_nome_setor(b.cd_setor_entrega) ds_setor_entrega 
FROM	estrutura_material_v c, 
	item_requisicao_material a, 
	requisicao_material b 
where	a.nr_requisicao = b.nr_requisicao 
and	a.cd_material = c.cd_material 
and	b.dt_liberacao is not null 
order by b.nr_requisicao;

