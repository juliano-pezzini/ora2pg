-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_cirurgia_v (dt_referencia, cd_estabelecimento, cd_convenio, cd_medico_cirurgiao, cd_medico_anestesista, cd_tipo_anestesia, cd_procedimento, ie_origem_proced, cd_especialidade, cd_setor_atendimento, cd_unidade, ie_sexo_paciente, ie_faixa_etaria, qt_hora_duracao, ie_status_cirurgia, ie_periodo, qt_ocorrencia, qt_min_duracao, vl_faturado, vl_custo, qt_min_anestesista, qt_min_medico, qt_min_enfermagem, qt_min_exturbacao, qt_min_higienizacao, ie_carater_cirurgia, hr_cirurgia, ie_tipo_atendimento, cd_municipio_convenio, ie_video, cd_tipo_cirurgia, vl_resultado, ie_porte, dt_inicio_prevista, dt_inicio_real, qt_min_duracao_prev, nr_seq_motivo_atraso, nr_seq_proced_niss, nr_seq_proc_interno, ie_asa_estado_paciente, nr_seq_via, ie_clinica, ie_porte_preco, ie_sangue, cd_municipio_ibge, cd_procedencia, cd_convenio_glosa, cd_tipo_acomodacao, nr_seq_interrupcao, cd_convenio_atendimento, ds_sala_setor, ie_status_agenda, cd_motivo_cancelamento, cd_categoria, nr_atendimento, ie_reoperacao, ie_prescr_pepo, ie_agente_pepo, ie_porte_anestesico, ds_hora_duracao, ds_hora_cirurgia, vl_margem, vl_fat_medio, qt_tempo_medio, ds_convenio, nm_cirurgiao, nm_anestesista, ds_tipo_anestesia, ds_setor_cirurgia, ds_especialidade, ds_especialidade_proc, ds_procedimento, ds_status_cirurgia, ds_carater_cirurgia, ds_tipo_atendimento, ds_tipo_cirurgia, ds_municipio, cd_tipo_convenio, ds_tipo_convenio, cd_tip_anestesia, ds_setor_unidade, ds_porte, ds_turno, ds_atraso, ds_duracao, ds_motivo_atraso, qt_realizada, qt_cancelada, nm_estabelecimento, ds_dia_semana, ie_dia_semana, cd_empresa, ie_finalizada, ds_finalizada, ds_proced_niss, ds_complexidade, ds_asa, ds_proc_interno, ds_motivo_cancelamento, cd_proc_origem, ds_clinica, ds_via_acesso, ds_sangue, ds_procedencia, ds_convenio_glosa, ds_municipio_ibge, ds_tipo_acomodacao, ds_motivo_interrupcao, ds_grupo_interrupcao, ds_convenio_atendimento, cd_especialidade_proc, ds_status_agenda, ds_categoria, nr_seq_coordenadoria, ds_coordenadoria, ds_agrup_setor, ie_porte_anest) AS select	a.DT_REFERENCIA,a.CD_ESTABELECIMENTO,a.CD_CONVENIO,a.CD_MEDICO_CIRURGIAO,a.CD_MEDICO_ANESTESISTA,a.CD_TIPO_ANESTESIA,a.CD_PROCEDIMENTO,a.IE_ORIGEM_PROCED,a.CD_ESPECIALIDADE,a.CD_SETOR_ATENDIMENTO,a.CD_UNIDADE,a.IE_SEXO_PACIENTE,a.IE_FAIXA_ETARIA,a.QT_HORA_DURACAO,a.IE_STATUS_CIRURGIA,a.IE_PERIODO,a.QT_OCORRENCIA,a.QT_MIN_DURACAO,a.VL_FATURADO,a.VL_CUSTO,a.QT_MIN_ANESTESISTA,a.QT_MIN_MEDICO,a.QT_MIN_ENFERMAGEM,a.QT_MIN_EXTURBACAO,a.QT_MIN_HIGIENIZACAO,a.IE_CARATER_CIRURGIA,a.HR_CIRURGIA,a.IE_TIPO_ATENDIMENTO,a.CD_MUNICIPIO_CONVENIO,a.IE_VIDEO,a.CD_TIPO_CIRURGIA,a.VL_RESULTADO,a.IE_PORTE,a.DT_INICIO_PREVISTA,a.DT_INICIO_REAL,a.QT_MIN_DURACAO_PREV,a.NR_SEQ_MOTIVO_ATRASO,a.NR_SEQ_PROCED_NISS,a.NR_SEQ_PROC_INTERNO,a.IE_ASA_ESTADO_PACIENTE,a.NR_SEQ_VIA,a.IE_CLINICA,a.IE_PORTE_PRECO,a.IE_SANGUE,a.CD_MUNICIPIO_IBGE,a.CD_PROCEDENCIA,a.CD_CONVENIO_GLOSA,a.CD_TIPO_ACOMODACAO,a.NR_SEQ_INTERRUPCAO,a.CD_CONVENIO_ATENDIMENTO,a.DS_SALA_SETOR,a.IE_STATUS_AGENDA,a.CD_MOTIVO_CANCELAMENTO,a.CD_CATEGORIA,a.NR_ATENDIMENTO,a.IE_REOPERACAO,a.IE_PRESCR_PEPO,a.IE_AGENTE_PEPO,a.IE_PORTE_ANESTESICO,
	qt_hora_duracao ds_hora_duracao, 
	upper(hr_cirurgia) ds_hora_cirurgia, 
	(a.vl_faturado - a.vl_custo) vl_margem, 
	dividir(a.vl_faturado, a.qt_ocorrencia) vl_fat_medio, 
	dividir(a.qt_min_duracao, a.qt_ocorrencia) qt_tempo_medio, 
	substr(obter_nome_convenio(a.cd_convenio),1,200) ds_convenio, 
	substr(obter_nome_pessoa_fisica(a.cd_medico_cirurgiao, null),1,200) nm_cirurgiao, 
	substr(obter_nome_pessoa_fisica(a.cd_medico_anestesista, null),1,200) nm_anestesista, 
	substr(obter_valor_dominio(36, a.cd_tipo_anestesia),1,200) ds_tipo_anestesia, 
	substr(obter_nome_setor(a.cd_setor_atendimento),1,200) ds_setor_cirurgia, 
	substr(obter_desc_espec_medica(a.cd_especialidade),1,200) ds_especialidade, 
	substr(obter_desc_especialidade_proc(Obter_Especialidade_Proced(cd_procedimento, ie_origem_proced)),1,200) ds_especialidade_proc, 
	substr(obter_desc_estrut_proc(null, null, null, a.cd_procedimento, a.ie_origem_proced),1,200) || ' ('||a.cd_procedimento || ')' ds_procedimento, 
	substr(obter_valor_dominio(65, a.ie_status_cirurgia),1,200) ds_status_cirurgia, 
	substr(obter_valor_dominio(1016, a.ie_carater_cirurgia),1,12) ds_carater_cirurgia, 
	substr(obter_valor_dominio(12, a.ie_tipo_atendimento),1,200) ds_tipo_atendimento, 
	substr(obter_descricao_padrao('CIH_TIPO_CIRURGIA', 'DS_TIPO_CIRURGIA', cd_tipo_cirurgia),1,200) ds_tipo_cirurgia, 
	substr(obter_desc_cep_loc(CD_MUNICIPIO_CONVENIO),1,55) ds_municipio, 
	obter_tipo_convenio(cd_convenio) cd_tipo_convenio, 
	substr(obter_desc_tipo_convenio(cd_convenio),1,200) ds_tipo_convenio, 
	somente_numero(a.cd_tipo_anestesia) cd_tip_anestesia, 
	upper(substr(obter_nome_setor(a.cd_setor_atendimento),1,200) || CASE WHEN cd_unidade IS NULL THEN null  ELSE ' - ' END  || CD_UNIDADE) ds_setor_unidade, 
	substr(obter_valor_dominio(1901, a.ie_porte),1,12) ds_porte, 
	substr(obter_turno_cirurgia(dt_inicio_real,cd_estabelecimento,'D'),1,15) ds_turno, 
	substr(eis_cir_obter_intervalo_min(obter_minutos_espera(dt_inicio_prevista,dt_inicio_real)),1,50) ds_atraso, 
	substr(eis_se_ultra_dur_prev(qt_min_duracao_prev,qt_min_duracao),1,255) ds_duracao, 
	substr(obter_descricao_padrao('CIR_MOTIVO_ATRASO', 'DS_MOTIVO', nr_seq_motivo_atraso),1,200) ds_motivo_atraso, 
	CASE WHEN ie_status_cirurgia=2 THEN 1  ELSE 0 END  qt_realizada, 
	CASE WHEN ie_status_cirurgia=3 THEN 1  ELSE 0 END  qt_cancelada, 
	substr(obter_nome_estabelecimento(a.cd_estabelecimento),1,200) nm_estabelecimento, 
	substr(obter_dia_semana(coalesce(dt_inicio_real, dt_inicio_prevista)),1,30) ds_dia_semana, 
	to_char(coalesce(dt_inicio_real, dt_inicio_prevista),'d') ie_dia_semana, 
	obter_empresa_estab(a.cd_estabelecimento) cd_empresa, 
	CASE WHEN coalesce(qt_min_duracao,0)=0 THEN 'N'  ELSE 'S' END  ie_finalizada, 
	substr(obter_valor_dominio(6,CASE WHEN coalesce(qt_min_duracao,0)=0 THEN 'N'  ELSE 'S' END ),1,5) ds_finalizada, 
	substr(obter_desc_proced_niss(a.nr_seq_proced_niss),1,255) ds_proced_niss, 
	substr(coalesce(sus_obter_complexidade_proced(a.cd_procedimento, a.ie_origem_proced, 'D'), Obter_Desc_Expressao(327119)),1,255) ds_complexidade, 
	substr(coalesce(obter_valor_dominio(1287,a.ie_asa_estado_paciente),Obter_Desc_Expressao(327119)),1,100) ds_asa, 
	to_char(nr_seq_proc_interno) || ' - ' || substr(OBTER_DESC_PROC_INTERNO(nr_seq_proc_interno),1,255) ds_proc_interno, 
	--substr(Obter_Valor_Dominio(1011,cd_motivo_cancelamento),1,255) ds_motivo_cancelamento, 
	substr(obter_dados_motivo_cancel(cd_motivo_cancelamento,'D'),1,255) ds_motivo_cancelamento, 
	to_char(a.cd_procedimento) || to_char(a.ie_origem_proced) cd_proc_origem, 
	substr(obter_valor_dominio(17, a.ie_clinica),1,255) ds_clinica, 
	substr(eis_obter_desc_via_acesso_cir(a.nr_seq_via),1,255) ds_via_acesso, 
	SUBSTR(obter_valor_dominio(6, a.ie_sangue),1,10) ds_sangue, 
	SUBSTR(Obter_Desc_Procedencia(cd_procedencia),1,100) ds_procedencia, 
	substr(obter_nome_convenio(a.cd_convenio_glosa),1,200) ds_convenio_glosa, 
	substr(obter_desc_municipio_ibge(cd_municipio_ibge),1,255) ds_municipio_ibge, 
	substr(obter_desc_tipo_acomod(a.cd_tipo_acomodacao),1,255) ds_tipo_acomodacao, 
	substr(Obter_dados_interr_cirurgia(a.nr_seq_interrupcao,'M'),1,255) ds_motivo_interrupcao, 
	substr(Obter_dados_interr_cirurgia(a.nr_seq_interrupcao,'G'),1,255) ds_grupo_interrupcao, 
	SUBSTR(Obter_Nome_Convenio(a.cd_convenio_atendimento),1,220) ds_convenio_atendimento, 
	Obter_Especialidade_Proced(cd_procedimento, ie_origem_proced) cd_especialidade_proc, 
	substr(obter_valor_dominio(83, a.ie_status_agenda),1,200) ds_status_agenda, 
	substr(obter_categoria_convenio(a.cd_convenio,a.cd_categoria)||' - '|| OBTER_DESC_CONVENIO(cd_convenio),1,255) ds_categoria, 
	substr(obter_dados_sus_municipio(cd_municipio_ibge,'NC'),1,10) nr_seq_coordenadoria, 
	substr(obter_dados_sus_municipio(cd_municipio_ibge,'DC'),1,255) ds_coordenadoria, 
	substr(obter_desc_agrup_setor(obter_agrupamento_setor(cd_setor_atendimento)),1,255) ds_agrup_setor, 
	substr(IE_PORTE_ANESTESICO,1,15) IE_PORTE_ANEST 
FROM	eis_cirurgia a;

