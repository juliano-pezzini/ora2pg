-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW cus_resultado_natureza_v (dt_mes_referencia, cd_empresa, cd_estabelecimento, cd_natureza_gasto, nr_seq_ng, nr_seq_gng, cd_grupo_natureza_gasto, ds_grupo_natureza_gasto, ds_natureza_gasto, cd_centro_controle, ds_centro_controle, vl_mes, ie_orcado_real) AS select	c.dt_mes_referencia,
	c.cd_empresa,
	a.cd_estabelecimento,
	a.cd_natureza_gasto,
	a.nr_seq_ng,
	b.nr_seq_gng,
	b.cd_grupo_natureza_gasto,
	substr(cus_obter_desc_gng(b.nr_seq_gng),1,100) ds_grupo_natureza_gasto,
	substr(cus_obter_desc_natur_gasto(a.nr_seq_ng),1, 255) ds_natureza_gasto,
	a.cd_centro_controle,
	substr(obter_desc_centro_controle(a.cd_centro_controle,a.cd_estabelecimento),1,100) ds_centro_controle,
	coalesce(sum(a.vl_mes),0) vl_mes,
	c.ie_orcado_real
FROM	tabela_custo c,
	natureza_gasto b,
	resultado_centro_controle a
where	a.nr_seq_ng = b.nr_sequencia
and	a.nr_seq_tabela = c.nr_sequencia
and	a.cd_estabelecimento = coalesce(c.cd_estabelecimento, a.cd_estabelecimento)
group by	c.dt_mes_referencia,
		c.cd_empresa,
		a.cd_estabelecimento,
		a.cd_natureza_gasto,
		b.cd_grupo_natureza_gasto,
		a.nr_seq_ng,
		b.nr_seq_gng,
		a.cd_centro_controle,
		substr(obter_desc_centro_controle(a.cd_centro_controle,a.cd_estabelecimento),1,100),
		c.ie_orcado_real;

