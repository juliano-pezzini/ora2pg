-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW cih_cultura_medic_v (nr_atendimento, dt_alta, dt_alta_interno, nr_ficha_ocorrencia, nr_seq_cultura, dt_coleta, cd_procedimento, cd_medicamento, ie_resultado_cultura, cd_amostra_cultura, ds_amostra_cultura, cd_microorganismo, ds_microorganismo, ds_medicamento, cd_topografia, ds_topografia, cd_clinica, ds_clinica, nr_ocor, nr_nt, nr_resistente, nr_sensivel, nr_intermediario, nr_ih, nr_ic, nr_outras, cd_estabelecimento, dt_ficha, nr_seq_grupo, cd_setor_atendimento) AS select F.NR_ATENDIMENTO,
	  F.DT_ALTA,
	 F.DT_ALTA_INTERNO,
	 A.NR_FICHA_OCORRENCIA,
	A.NR_SEQ_CULTURA,
	A.DT_COLETA,
	A.CD_PROCEDIMENTO,
	B.CD_MEDICAMENTO,
	B.IE_RESULTADO_CULTURA,
	H.CD_AMOSTRA_CULTURA,
	H.DS_AMOSTRA_CULTURA,
 	D.CD_MICROORGANISMO,
	D.DS_MICROORGANISMO,
	C.DS_MEDICAMENTO,
	G.CD_TOPOGRAFIA,
	G.DS_TOPOGRAFIA,
	E.CD_CLINICA,
	E.DS_CLINICA,
	1 NR_OCOR,
	CASE WHEN B.IE_RESULTADO_CULTURA=1 THEN 1  ELSE 0 END  NR_NT,
	CASE WHEN B.IE_RESULTADO_CULTURA=2 THEN 1  ELSE 0 END  NR_RESISTENTE,
	CASE WHEN B.IE_RESULTADO_CULTURA=3 THEN 1  ELSE 0 END  NR_SENSIVEL,
	CASE WHEN B.IE_RESULTADO_CULTURA=4 THEN 1  ELSE 0 END  NR_INTERMEDIARIO,
	CASE WHEN A.CD_CASO_INFECCAO=1 THEN  1  ELSE 0 END  NR_IH,
	CASE WHEN A.CD_CASO_INFECCAO=2 THEN  1  ELSE 0 END  NR_IC,
	CASE WHEN A.CD_CASO_INFECCAO=1 THEN  0 WHEN A.CD_CASO_INFECCAO=2 THEN  0 WHEN A.CD_CASO_INFECCAO=3 THEN  0  ELSE 1 END  NR_OUTRAS,
	F.CD_ESTABELECIMENTO,
	F.dt_ficha DT_FICHA,
	D.nr_seq_grupo NR_SEQ_GRUPO,
	A.cd_setor_atendimento
FROM cih_amostra_cultura h, cih_topografia g, cih_ficha_ocorrencia_v f, cih_clinica e, cih_medicamento c, cih_cultura_medic b, cih_cultura a
LEFT OUTER JOIN cih_microorganismo d ON (A.CD_MICROORGANISMO = D.CD_MICROORGANISMO)
WHERE A.NR_FICHA_OCORRENCIA = F.NR_FICHA_OCORRENCIA and A.NR_FICHA_OCORRENCIA = B.NR_FICHA_OCORRENCIA and A.NR_SEQ_CULTURA      = B.NR_SEQ_CULTURA  and B.CD_MEDICAMENTO      = C.CD_MEDICAMENTO and A.CD_TOPOGRAFIA	    = G.CD_TOPOGRAFIA and F.CD_CLINICA_INT	    = E.CD_CLINICA and A.CD_AMOSTRA_CULTURA  = H.CD_AMOSTRA_CULTURA;

