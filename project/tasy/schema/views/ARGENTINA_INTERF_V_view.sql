-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW argentina_interf_v (tp_registro, nr_fatura, nr_matricula_e, nr_matricula_e_1, cd_senha_guia, cd_senha_guia_1, nr_afiliado, nr_afiliado_1, dt_convenio, dt_convenio_1, hr_convenio, qt_item, qt_item_1, cd_convenio, cd_item, ds_item, vl_procedimento, vl_sadt, vl_total, cd_cid_principal, cd_interno, cd_tipo_convenio, cd_delegacao_emissora, cd_tipo_guia, vl_total_conta, cd_tipo_matricula_p, nr_matricula_p, cd_letra_provincia_p, cd_tipo_matricula_e, cd_letra_provincia_e, campo_branco, campo_zero, nr_seq_protocolo, nr_interno_conta, cd_item_convenio, vl_honorario, vl_custo_oper, vl_total_item) AS SELECT	1 TP_REGISTRO,
        LPAD(coalesce(( select substr(x.NR_NFE_IMP,1, 4)
        FROM    nota_fiscal x
        where   x.nr_seq_protocolo = c.nr_seq_protocolo  LIMIT 1), 'FFFF'), 4, 0) ||
        LPAD(coalesce(( select substr(x.NR_NFE_IMP,length(x.NR_NFE_IMP)-8, length(x.NR_NFE_IMP))
        from    nota_fiscal x
        where   x.nr_seq_protocolo = c.nr_seq_protocolo  LIMIT 1), 'FFFFFFFFF'), 9, 0) NR_FATURA,
        LPAD(coalesce(B.NR_CRM_EXECUTOR, 0), 7, 0) NR_MATRICULA_E,
        LPAD(coalesce(B.NR_CRM_EXECUTOR, 0), 10, 0) NR_MATRICULA_E_1,
        LPAD((select max(y.cd_senha) from W_INTERF_CONTA_AUTOR y
	      where y.cd_convenio = B.cd_convenio
	      and y.nr_atendimento = A.nr_atendimento
	      and y.nr_interno_conta = a.nr_interno_conta
	      and y.ie_origem_guia = 'U'), 6, 0) CD_SENHA_GUIA,
        LPAD((select max(y.cd_senha) from W_INTERF_CONTA_AUTOR y
	      where y.cd_convenio = B.cd_convenio
	      and y.nr_atendimento = A.nr_atendimento
	      and y.nr_interno_conta = a.nr_interno_conta
	      and y.ie_origem_guia = 'U'), 6, 0) CD_SENHA_GUIA_1,
        LPAD(A.CD_USUARIO_CONVENIO, 9, 0) NR_AFILIADO,
        LPAD(A.CD_USUARIO_CONVENIO, 11, 0) NR_AFILIADO_1,
        RPAD(TO_CHAR(B.DT_ITEM, 'DDMMYYYY'), 8, ' ') DT_CONVENIO,
        RPAD(TO_CHAR(B.DT_ITEM, 'DDMMYY'), 6, ' ') DT_CONVENIO_1,
        RPAD(TO_CHAR(B.DT_ITEM, 'HH24:MI'), 5, ' ') HR_CONVENIO,
        LPAD(B.QT_ITEM, 8, 0) QT_ITEM,
        LPAD(B.QT_ITEM, 3, 0) QT_ITEM_1,
        LPAD(A.CD_USUARIO_CONVENIO, 6, 0) CD_CONVENIO,
        LPAD(B.CD_ITEM, 6, 0) CD_ITEM,
        RPAD(B.DS_ITEM, 40, ' ') DS_ITEM,
        LPAD(C.VL_HONORARIOS, 10, 0) VL_PROCEDIMENTO,
        LPAD(C.VL_SADT, 10, 0) VL_SADT,
        LPAD(C.VL_PROCEDIMENTO, 10, 0) VL_TOTAL,
        RPAD(OBTER_DESC_CID(A.CD_CID_PRINCIPAL), 40, ' ') CD_CID_PRINCIPAL,
	LPAD(A.CD_INTERNO, 6, 0) CD_INTERNO,
	CASE WHEN A.IE_TIPO_ATENDIMENTO = 1 and A.IE_CLINICA = 2 THEN 3
                WHEN A.IE_TIPO_ATENDIMENTO = 1 and A.IE_CLINICA != 2 THEN 2
                WHEN A.IE_TIPO_ATENDIMENTO != 1 THEN 1
        ELSE 1
        END CD_TIPO_CONVENIO,
		'00' CD_DELEGACAO_EMISSORA,
		0 CD_TIPO_GUIA,
		LPAD(B.VL_TOTAL_ITEM, 15, 0) VL_TOTAL_CONTA,
		   LPAD(CASE WHEN( select max(IE_NACIONAL)                     from CRM_ESTADO x                     where x.NR_CRM = B.NR_CRM_REQUISITANTE)='S' THEN 'N'  ELSE 'P' END , 1, 0) CD_TIPO_MATRICULA_P,
		LPAD(B.NR_CRM_REQUISITANTE, 10, 0) NR_MATRICULA_P,
		'S' CD_LETRA_PROVINCIA_P,
        LPAD(CASE WHEN( select max(IE_NACIONAL)                     from CRM_ESTADO x                     where x.NR_CRM = B.NR_CRM_EXECUTOR)='S' THEN 'N'  ELSE 'P' END , 1, 0) CD_TIPO_MATRICULA_E,
		'S' CD_LETRA_PROVINCIA_E,
		' ' CAMPO_BRANCO,
		0 CAMPO_ZERO,
		A.NR_SEQ_PROTOCOLO,
		A.NR_INTERNO_CONTA,
		B.CD_ITEM_CONVENIO,
		B.VL_HONORARIO,
		B.VL_CUSTO_OPER,
		B.VL_TOTAL_ITEM
FROM		W_INTERF_CONTA_CAB A,
		W_INTERF_CONTA_ITEM B,
		W_INTERF_CONTA_TOTAL C
WHERE 	A.NR_INTERNO_CONTA	= B.NR_INTERNO_CONTA
AND 	A.NR_INTERNO_CONTA	= C.NR_INTERNO_CONTA;

