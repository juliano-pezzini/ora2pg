-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_tuberculose_hanseniase_v (nr_atendimento, cd_pessoa_fisica, dt_referencia, nr_seq_area, ds_area, qt_atend_tuberculose, qt_atend_hanseniase, qt_pf_tuberculose, qt_pf_hanseniase) AS select	distinct a.nr_atendimento,
			a.cd_pessoa_fisica,
			a.dt_entrada dt_referencia,
			obter_area_pf(a.cd_pessoa_fisica) nr_seq_area,
			substr(obter_desc_area_domicilio(obter_area_pf(a.cd_pessoa_fisica)),1,255) ds_area,
			(select 	count(*)
				FROM	atendimento_paciente z,
						LISTA_PROBLEMA_PAC x
				where 	z.nr_atendimento = x.nr_atendimento
				and		z.ie_nivel_atencao = 'P'
				and		x.ie_tipo_diagnostico = 2
				and		x.dt_liberacao is not null
				and		x.dt_inativacao is null
				and		obter_area_pf(z.cd_pessoa_fisica) = obter_area_pf(a.cd_pessoa_fisica)
				and 	obter_categoria_cid(x.cd_doenca) in ('A15', 'A16', 'A17', 'A18', 'A19')) qt_atend_tuberculose,
			(select 	count(*)
				from	atendimento_paciente z,
						LISTA_PROBLEMA_PAC x
				where 	z.nr_atendimento = x.nr_atendimento
				and		z.ie_nivel_atencao = 'P'
				and		x.ie_tipo_diagnostico = 2
				and		x.dt_liberacao is not null
				and		x.dt_inativacao is null
				and		obter_area_pf(z.cd_pessoa_fisica) = obter_area_pf(a.cd_pessoa_fisica)
				and 	obter_categoria_cid(x.cd_doenca) in ('A30')) qt_atend_hanseniase,
			(select 	count(distinct z.cd_pessoa_fisica)
				from	atendimento_paciente z,
						LISTA_PROBLEMA_PAC x
				where 	z.nr_atendimento = x.nr_atendimento
				and		z.ie_nivel_atencao = 'P'
				and		x.ie_tipo_diagnostico = 2
				and		x.dt_liberacao is not null
				and		x.dt_inativacao is null
				and		obter_area_pf(z.cd_pessoa_fisica) = obter_area_pf(a.cd_pessoa_fisica)
				and 	obter_categoria_cid(x.cd_doenca) in ('A15', 'A16', 'A17', 'A18', 'A19')) qt_pf_tuberculose,
			(select 	count(distinct z.cd_pessoa_fisica)
				from	atendimento_paciente z,
						LISTA_PROBLEMA_PAC x
				where 	z.nr_atendimento = x.nr_atendimento
				and		z.ie_nivel_atencao = 'P'
				and		x.ie_tipo_diagnostico = 2
				and		x.dt_liberacao is not null
				and		x.dt_inativacao is null
				and		obter_area_pf(z.cd_pessoa_fisica) = obter_area_pf(a.cd_pessoa_fisica)
				and 	obter_categoria_cid(x.cd_doenca) in ('A30')) qt_pf_hanseniase
	from	atendimento_paciente a,
			LISTA_PROBLEMA_PAC b
	where	a.nr_atendimento = b.nr_atendimento
	and		a.ie_nivel_atencao = 'P'
	and		b.ie_tipo_diagnostico = 2
	and		b.dt_liberacao is not null
	and		b.dt_inativacao is null
	and		obter_categoria_cid(b.cd_doenca) in ('A15', 'A16', 'A17', 'A18', 'A19', 'A30');

