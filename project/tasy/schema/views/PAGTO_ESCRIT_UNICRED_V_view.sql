-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pagto_escrit_unicred_v (tp_registro, dt_movimento, qt_registro, vl_tot_escrit, vl_escritural, ie_tipo_lanc, nr_conta, nr_documento, nr_seq_envio) AS select	1 tp_registro,
	LOCALTIMESTAMP dt_movimento,
	count(*) qt_registro,
	sum(c.vl_escritural) vl_tot_escrit,
	0 vl_escritural,
	'871' ie_tipo_lanc,
	'' nr_conta,
	null nr_documento,
	e.nr_sequencia nr_seq_envio
FROM	banco_estabelecimento_v b,
	banco_escritural e,
	titulo_pagar_escrit c
where	b.nr_sequencia		= e.nr_seq_conta_banco
and	c.nr_seq_escrit		= e.nr_sequencia
and	b.ie_tipo_relacao       in ('EP','ECC')
group by e.nr_sequencia

union

select	2 tp_registro,
	LOCALTIMESTAMP dt_movimento,
	0 qt_registro,
	0 vl_tot_escrit,
	c.vl_escritural,
	'871' ie_tipo_lanc,
	substr(c.nr_conta,1,5) ||'-' || c.ie_digito_conta nr_conta,
	c.nr_titulo nr_documento,
	e.nr_sequencia nr_seq_envio
from	banco_estabelecimento_v b,
	banco_escritural e,
	titulo_pagar_escrit c
where	b.nr_sequencia		= e.nr_seq_conta_banco
and	c.nr_seq_escrit		= e.nr_sequencia
and	b.ie_tipo_relacao       in ('EP','ECC');

