-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW nota_fiscal_item_v2 (nr_sequencia, nr_ordem_compra, cd_material, qt_item_nf, qt_item_estoque, vl_total_item_nf, vl_unitario_item_nf, vl_desconto, vl_desc_financ, vl_desconto_rateio, vl_liquido, vl_rateio, cd_unidade_medida_estoque, cd_unidade_medida_compra, cd_centro_custo, tx_tributo, vl_tributo, vl_total_nota, cd_conta_contabil, ds_conta_contabil, cd_local_estoque, ds_local_estoque, ds_complemento, nr_item_oci, ds_marca, dt_prevista_entrega) AS select /*+ index (i notfiit_pk) */	i.nr_sequencia,
	i.nr_ordem_compra,
	i.cd_material,
	i.qt_item_nf,
	i.qt_item_estoque,
	i.vl_total_item_nf,
	i.vl_unitario_item_nf,
	i.vl_desconto,
	i.vl_desc_financ,
	i.vl_desconto_rateio,
	i.vl_liquido,
	(i.vl_seguro + i.vl_frete + i.vl_despesa_acessoria) vl_rateio,
	i.cd_unidade_medida_estoque,
	i.cd_unidade_medida_compra,
	i.cd_centro_custo,
	t.tx_tributo,
	t.vl_tributo,
	(coalesce(i.vl_seguro,0) + coalesce(i.vl_frete,0) + coalesce(i.vl_despesa_acessoria,0) +
	coalesce(i.vl_total_item_nf,0) + coalesce(t.vl_tributo,0)  -
	coalesce(i.vl_desconto,0) - coalesce(i.vl_desconto_rateio,0)) vl_total_nota,
	i.cd_conta_contabil,
	substr(obter_desc_conta_contabil(i.cd_conta_contabil),1,255) ds_conta_contabil,
	i.cd_local_estoque,
	substr(obter_desc_local_estoque(i.cd_local_estoque),1,100) ds_local_estoque,
	i.ds_complemento,
	i.nr_item_oci,
	substr(obter_desc_marca(nr_seq_marca),1,255) ds_marca,
	dt_entrega_ordem dt_prevista_entrega
FROM nota_fiscal_item i
LEFT OUTER JOIN nota_fiscal_item_trib t ON (i.nr_sequencia = t.nr_sequencia AND i.nr_item_nf = t.nr_item_nf AND 6 = t.cd_tributo);

