-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW adep_medic_pend_v (ie_tipo_item, dt_horario, nr_atendimento, cd_item) AS select	'M' ie_tipo_item,
		c.dt_horario,
		a.nr_atendimento,
		b.cd_material cd_item
FROM	pessoa_fisica p,
		material m,
		prescr_mat_hor c,
		prescr_material b,
		prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
and	b.cd_material	= m.cd_material
and	a.cd_prescritor	= p.cd_pessoa_fisica
and	c.dt_fim_horario is null
and	c.dt_suspensao is null
and	a.dt_suspensao is null
and	b.dt_suspensao is null
and	b.ie_agrupador = 1
and	c.dt_recusa is null
and	coalesce(c.ie_situacao,'A') = 'A'
and	coalesce(c.ie_adep,'S') = 'S'
and	coalesce(c.ie_horario_especial,'N') <> 'S'
and	coalesce(b.ie_administrar,'S') <> 'N'
and	obter_se_gerar_item_adep('M',b.nr_prescricao,b.nr_sequencia,b.nr_agrupamento,'N') = 'S'
and	coalesce(a.ie_adep,'S') = 'S'
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S'

union all

select	'ME' ie_tipo_item,
		c.dt_horario,
		a.nr_atendimento,
		b.cd_material cd_item
from	pessoa_fisica p,
		material m,
		prescr_mat_hor c,
		prescr_material b,
		prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
and	b.cd_material	= m.cd_material
and	a.cd_prescritor	= p.cd_pessoa_fisica
and	c.dt_fim_horario is null
and	c.dt_suspensao is null
and	b.ie_agrupador = 14
and	c.dt_recusa is null
and	coalesce(c.ie_situacao,'A') = 'A'
and	coalesce(c.ie_adep,'S') = 'S'
and	coalesce(c.ie_horario_especial,'N') <> 'S'
and	obter_se_gerar_item_adep('M',b.nr_prescricao,b.nr_sequencia,b.nr_agrupamento,'N') = 'S'
and	coalesce(a.ie_adep,'S') = 'S'
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S'

union all

select	'MAP' ie_tipo_item,
		c.dt_horario,
		a.nr_atendimento,
		b.cd_material cd_item
from	pessoa_fisica p,
		material m,
		prescr_mat_hor c,
		prescr_material b,
		prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
and	b.cd_material	= m.cd_material
and	a.cd_prescritor	= p.cd_pessoa_fisica
and	c.dt_fim_horario is null
and	c.dt_suspensao is null
and	b.ie_agrupador = 5
and	c.dt_recusa is null
and	coalesce(c.ie_situacao,'A') = 'A'
and	coalesce(c.ie_adep,'S') = 'S'
and	coalesce(c.ie_horario_especial,'N') <> 'S'
and	coalesce(a.ie_adep,'S') = 'S'
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S';

