-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW v_w_pan_leito (cd_setor_atendimento, cd_unidade_basica, cd_unidade_compl, ie_adaptado, ie_temporario, ie_backup, ie_sexo, cd_exp_status, cd_exp_adaptado, cd_exp_temporario, cd_exp_backup, cd_exp_sexo, ie_concluido, nr_seq_interno, ie_status_unidade, cd_perfil, nr_seq_texto_adaptado, nr_seq_texto_temporario, nr_seq_texto_backup, ie_sem_acomodacao, ds_status, ds_sexo, nr_seq_texto_sexo, ds_unidade_atend, ie_emprestado, dt_atualizacao, ds_unidade_acompanhante, nr_seq_apresentacao) AS SELECT 	a.CD_SETOR_ATENDIMENTO,
		a.CD_UNIDADE_BASICA,
		a.CD_UNIDADE_COMPL,
		a.IE_ADAPTADO,
		a.IE_TEMPORARIO,
		a.IE_BACKUP,
		a.IE_SEXO,
		a.CD_EXP_STATUS,
		a.CD_EXP_ADAPTADO,
		a.CD_EXP_TEMPORARIO,
		a.CD_EXP_BACKUP,
		a.CD_EXP_SEXO,
		a.IE_CONCLUIDO,
		a.NR_SEQ_INTERNO,
		a.IE_STATUS_UNIDADE,
		a.CD_PERFIL,
		a.NR_SEQ_TEXTO_ADAPTADO,
		a.NR_SEQ_TEXTO_TEMPORARIO,
		a.NR_SEQ_TEXTO_BACKUP,
		a.IE_SEM_ACOMODACAO,
		a.DS_STATUS,
		a.DS_SEXO,
		a.NR_SEQ_TEXTO_SEXO,
		a.DS_UNIDADE_ATEND,
		a.IE_EMPRESTADO,
		a.DT_ATUALIZACAO,
	( 
		SELECT a.cd_unidade_basica||' '||a.cd_unidade_compl FROM	unidade_atendimento b WHERE b.cd_unidade_basica = a.cd_unidade_basica  AND	b.cd_setor_atendimento = a.cd_setor_atendimento and b.ie_status_unidade = 'M' AND	b.nr_atendimento_acomp = (SELECT max(d.nr_atendimento) FROM	w_pan_paciente d WHERE d.ie_concluido = 'S' AND	d.nr_seq_interno = a.nr_seq_interno) AND	b.nr_seq_interno = (SELECT max(c.nr_seq_interno) FROM	unidade_atendimento c WHERE c.cd_unidade_basica = b.cd_unidade_basica and c.cd_setor_atendimento = b.cd_setor_atendimento AND	c.ie_status_unidade = 'M'  AND	c.nr_atendimento_acomp = (SELECT max(d.nr_atendimento) FROM	w_pan_paciente d WHERE d.ie_concluido = 'S' AND	d.nr_seq_interno = a.nr_seq_interno))  AND	b.dt_atualizacao = (SELECT max(c.dt_atualizacao) FROM	unidade_atendimento c  WHERE c.cd_unidade_basica = b.cd_unidade_basica  AND	c.cd_setor_atendimento = b.cd_setor_atendimento  AND	c.ie_status_unidade = 'M'  AND	c.nr_atendimento_acomp = (SELECT max(d.nr_atendimento) FROM	w_pan_paciente d WHERE d.ie_concluido = 'S' AND	d.nr_seq_interno = a.nr_seq_interno))
	) ds_unidade_acompanhante,
  
	(SELECT NR_SEQ_APRESENT FROM	unidade_atendimento b WHERE b.nr_seq_interno = a.nr_seq_interno ) nr_seq_apresentacao
	FROM 
		w_pan_leito a
	WHERE 
		a.ie_concluido = 'S';

