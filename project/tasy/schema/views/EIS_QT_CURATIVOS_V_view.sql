-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_qt_curativos_v (cd_pessoa_fisica, dt_mes_entrada, cd_setor_atendimento, ds_setor_atendimento, ie_tipo_atendimento, ds_tipo_atendimento, ie_clinica, ds_clinica) AS SELECT 	
  b.cd_pessoa_fisica, 
	TRUNC(a.dt_curativo, 'mm') dt_mes_entrada, 
	SUBSTR(coalesce(obter_unidade_Atendimento(c.nr_atendimento,'A','CS'),b.cd_setor_atendimento),1,100) cd_setor_Atendimento, 
	SUBSTR(coalesce(obter_unidade_Atendimento(c.nr_atendimento,'A','S'),obter_nome_setor(b.cd_setor_atendimento)),1,255) ds_setor_atendimento, 
	c.ie_tipo_atendimento, 
	SUBSTR(obter_Valor_dominio(12, c.ie_tipo_atendimento),1,150) ds_tipo_atendimento, 
	b.ie_clinica, 
	SUBSTR(obter_valor_dominio(17,b.ie_clinica),1,80) ds_clinica 
FROM  	cur_curativo a, 
	cur_ferida b, 
	atendimento_paciente c 
WHERE 	b.nr_sequencia = a.nr_seq_ferida 
AND		a.nr_sequencia = (SELECT MAX(ZZ.nr_Sequencia) 
					  	 FROM	 cur_curativo ZZ, 
						 		 cur_ferida XX 
						 WHERE	 ZZ.nr_seq_ferida = XX.nr_sequencia 
						 AND	 XX.cd_pessoa_fisica = b.cd_pessoa_fisica) 
AND		c.nr_atendimento = (SELECT MAX(ap.nr_atendimento)						  		  
						  FROM  atendimento_paciente ap 
							WHERE ap.cd_pessoa_fisica = b.cd_pessoa_fisica) 
AND	a.ie_situacao = 'A';

