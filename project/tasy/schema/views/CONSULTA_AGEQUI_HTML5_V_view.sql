-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW consulta_agequi_html5_v (cd_agenda, ds_agenda, cd_tipo_agenda, cd_estabelecimento, nr_sequencia, dt_agenda, hr_inicio, nr_minuto_duracao, ie_status_agenda, ds_status_agenda, cd_pessoa_fisica, nm_paciente, cd_medico, cd_convenio, cd_categoria, cd_plano, ds_convenio, nr_atendimento, ds_tipo_pendencia, nr_pront_ext, ie_encaixe, cd_medico_resp, nm_usuario_origem, dt_agendamento, nm_medico_agendamento, nr_seq_status_pac) AS select	a.nr_sequencia cd_agenda,
	a.ds_local ds_agenda,
	9 cd_tipo_agenda,	
	a.cd_estabelecimento,	
	b.nr_sequencia,
	b.dt_agenda,
	b.dt_agenda hr_inicio,	
	b.nr_minuto_duracao,	
	b.ie_status_agenda,	
	substr(obter_valor_dominio(3192,b.ie_status_agenda),1,255) ds_status_agenda,
	b.cd_pessoa_fisica,	
	c.nm_pessoa_fisica nm_paciente,	
	e.cd_medico_resp cd_medico,	
	f.cd_convenio,
	f.cd_categoria,
	f.cd_plano,	
	k.ds_convenio ds_convenio,
	d.nr_atendimento,				
	substr(obter_valor_dominio(3117,b.ie_tipo_pend_agenda),1,255) ds_tipo_pendencia,
	c.nr_pront_ext,			
	b.ie_encaixe,
	y.cd_medico_resp,	
	b.nm_usuario_nrec nm_usuario_origem,
	b.dt_atualizacao_nrec dt_agendamento,
	'' nm_medico_agendamento,
  null nr_seq_status_pac
FROM paciente_setor e, qt_local a, paciente_setor_convenio f
LEFT OUTER JOIN convenio k ON (f.cd_convenio = k.cd_convenio)
, agenda_quimio b
LEFT OUTER JOIN paciente_atendimento d ON (b.nr_seq_atendimento = d.nr_seq_atendimento)
LEFT OUTER JOIN pessoa_fisica c ON (b.cd_pessoa_fisica = c.cd_pessoa_fisica)
LEFT OUTER JOIN paciente_setor_convenio f ON (d.nr_seq_paciente = f.nr_seq_paciente)
LEFT OUTER JOIN atendimento_paciente y ON (d.nr_atendimento = y.nr_atendimento)
WHERE a.nr_sequencia		= b.nr_seq_local    and e.nr_seq_paciente	= d.nr_seq_paciente   and b.nr_seq_atendimento is not null

union

select	a.nr_sequencia cd_agenda,
	a.ds_local ds_agenda,
	9 cd_tipo_agenda,	
	a.cd_estabelecimento,				
	b.nr_sequencia,
	b.dt_agenda,
	b.dt_agenda hr_inicio,	
	b.nr_minuto_duracao,
	b.ie_status_agenda,	
	substr(obter_valor_dominio(3192,b.ie_status_agenda),1,255) ds_status_agenda,
	b.cd_pessoa_fisica,	
	'' nm_paciente,	
	'' cd_medico,					
	d.cd_convenio,
	d.cd_categoria,
	d.cd_plano,
	k.ds_convenio ds_convenio,
	null nr_atendimento,		
	substr(obter_valor_dominio(3117,b.ie_tipo_pend_agenda),1,255) ds_tipo_pendencia,
	c.nr_pront_ext,			
	b.ie_encaixe,
	null cd_medico_resp,	
	b.nm_usuario_nrec nm_usuario_origem,
	b.dt_atualizacao_nrec dt_agendamento,
	'' nm_medico_agendamento,
  null nr_seq_status_pac
FROM convenio k, agenda_integrada_item e, agenda_integrada d, qt_local a, agenda_quimio b
LEFT OUTER JOIN pessoa_fisica c ON (b.cd_pessoa_fisica = c.cd_pessoa_fisica)
WHERE a.nr_sequencia		= b.nr_seq_local and e.nr_seq_agequi	= b.nr_Sequencia and d.nr_sequencia = e.nr_seq_agenda_int  and d.cd_convenio	= k.cd_convenio and b.nr_seq_atendimento is null
 
union

select	a.nr_sequencia cd_agenda,
	a.ds_local ds_agenda,
	9 cd_tipo_agenda,
	a.cd_estabelecimento,
	b.nr_sequencia,
	b.dt_agenda,
	b.dt_agenda hr_inicio,
	b.nr_minuto_duracao,
	b.ie_status_agenda,
	substr(obter_valor_dominio(3192,b.ie_status_agenda),1,255) ds_status_agenda,
	b.cd_pessoa_fisica,
	c.nm_pessoa_fisica nm_paciente,
	e.cd_medico_resp cd_medico,
	f.cd_convenio,
	f.cd_categoria,
	f.cd_plano,
	k.ds_convenio ds_convenio,
	d.nr_atendimento,
	substr(obter_valor_dominio(3117,b.ie_tipo_pend_agenda),1,255) ds_tipo_pendencia,
	c.nr_pront_ext,
	b.ie_encaixe,
	y.cd_medico_resp,
	b.nm_usuario_nrec nm_usuario_origem,
	b.dt_atualizacao_nrec dt_agendamento,
	'' nm_medico_agendamento,
  null nr_seq_status_pac
FROM paciente_setor_convenio f
LEFT OUTER JOIN convenio k ON (f.cd_convenio = k.cd_convenio)
, agenda_quimio b
LEFT OUTER JOIN qt_local a ON (b.nr_seq_local = a.nr_sequencia)
LEFT OUTER JOIN paciente_atendimento d ON (b.nr_seq_atendimento = d.nr_seq_atendimento)
LEFT OUTER JOIN pessoa_fisica c ON (b.cd_pessoa_fisica = c.cd_pessoa_fisica)
LEFT OUTER JOIN paciente_setor_convenio f ON (d.nr_seq_paciente = f.nr_seq_paciente)
LEFT OUTER JOIN paciente_setor e ON (d.nr_seq_paciente = e.nr_seq_paciente)
LEFT OUTER JOIN atendimento_paciente y ON (d.nr_atendimento = y.nr_atendimento)
WHERE b.nr_seq_atendimento is null and obter_valor_param_usuario(970, 29, wheb_usuario_pck.get_cd_perfil, wheb_usuario_pck.get_nm_usuario, wheb_usuario_pck.get_cd_estabelecimento) = 'S';

