-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW tre_eis_gestao_recurso_glosa_v (ds_item, ds_motivo_glosa, dt_lote, vl_glosa_aceita, vl_reapresentacao, vl_glosa_total, cd_item, cd_motivo_glosa, cd_convenio, ds_convenio, ie_acao_glosa, ds_acao_glosa, nr_atendimento, nm_paciente) AS SELECT  substr(obter_dados_lote_audit_item(a.nr_sequencia,'IT'),1,255) ds_item,
        substr(obter_desc_motivo_glosa(a.cd_motivo_glosa),1,255) ds_motivo_glosa,
        b.dt_lote,
        Sum(a.VL_GLOSA) vl_glosa_aceita,
        Sum(a.vl_amenor) vl_reapresentacao,
        Sum(a.VL_GLOSA_INFORMADA) vl_glosa_total,
        obter_dados_propaci('CP',nr_seq_propaci) cd_item,
        a.cd_motivo_glosa,
        b.cd_convenio,
        obter_desc_convenio(b.cd_convenio) ds_convenio,
        a.ie_acao_glosa,
        obter_valor_dominio(1405,a.ie_acao_glosa) ds_acao_glosa,
        OBTER_ATENDIMENTO_CONTA(c.NR_INTERNO_CONTA) NR_ATENDIMENTO,
        SUBSTR(OBTER_PESSOA_CONTA(c.NR_INTERNO_CONTA,'D'),1,60) NM_PACIENTE
FROM    LOTE_AUDIT_HIST_ITEM a,
        lote_auditoria b,
        LOTE_AUDIT_HIST_GUIA c,
        lote_audit_hist d
WHERE   a.nr_seq_lote = b.nr_sequencia
AND     c.nr_seq_lote_hist = d.nr_sequencia
AND     d.nr_seq_lote_audit = b.nr_sequencia
GROUP BY  obter_dados_lote_audit_item(a.nr_sequencia,'IT'),
          obter_desc_motivo_glosa(a.cd_motivo_glosa),
          b.dt_lote,
          obter_dados_propaci('CP',nr_seq_propaci),
          a.cd_motivo_glosa,
          obter_desc_convenio(b.cd_convenio),
          b.cd_convenio,
          a.ie_acao_glosa,
          obter_valor_dominio('1405',a.ie_acao_glosa),
          c.NR_INTERNO_CONTA;

