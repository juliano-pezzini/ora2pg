-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pacientes_grupo_v (nr_seq_grupo, cd_unidade, nm_pessoa_fisica, ds_idade, nr_atendimento, nm_guerra, dt_entrada, ds_convenio, ds_anotacao, ds_diagnostico, cd_pessoa_fisica) AS select		a.nr_seq_grupo,
			(b.cd_unidade_basica || ' ' || b.cd_unidade_compl) cd_unidade, 
			e.nm_pessoa_fisica, 
			substr(obter_idade(e.dt_nascimento, LOCALTIMESTAMP, 'S'),1,100) ds_idade, 
			c.nr_atendimento, 
			f.nm_guerra, 
			c.dt_entrada, 
			substr(obter_conv_ocupacao(c.nr_atendimento),1,40) ds_convenio, 
			substr(obter_anotacao_pendente(c.nr_atendimento),1,255) ds_anotacao, 
			substr(obter_diagnostico_atendimento(c.nr_atendimento),1,240) ds_diagnostico, 
			a.cd_pessoa_fisica 
FROM atend_paciente_unidade g, pessoa_fisica e, pac_grupo d, pac_grupo_atend a, atendimento_paciente c
LEFT OUTER JOIN unidade_atendimento b ON (c.nr_atendimento = b.nr_atendimento)
LEFT OUTER JOIN medico f ON (c.cd_pessoa_fisica = f.cd_pessoa_fisica)
WHERE g.nr_atendimento   	 = c.nr_atendimento and a.nr_seq_grupo 	 		 =	d.nr_sequencia and c.cd_pessoa_fisica 		 = e.cd_pessoa_fisica  and ((coalesce(d.IE_ALTA,'S') 	 = 'S') or (c.dt_alta is null)) and a.nr_atendimento   	 = b.nr_atendimento and a.dt_entrada is null and a.dt_saida is null 
 
union
 
select		a.nr_seq_grupo, 
			(e.cd_unidade_basica || ' ' || e.cd_unidade_compl) cd_unidade, 
			f.nm_pessoa_fisica, 
			substr(obter_idade(f.dt_nascimento, LOCALTIMESTAMP, 'S'),1,100) ds_idade, 
			c.nr_atendimento, 
			g.nm_guerra, 
			c.dt_entrada, 
			substr(obter_conv_ocupacao(c.nr_atendimento),1,40) ds_convenio, 
			substr(obter_anotacao_pendente(c.nr_atendimento),1,255) ds_anotacao, 
			substr(obter_diagnostico_atendimento(c.nr_atendimento),1,240) ds_diagnostico, 
			a.cd_pessoa_fisica 	 
FROM pessoa_fisica f, pac_grupo d, atend_paciente_unidade b, pac_grupo_atend a, atendimento_paciente c
LEFT OUTER JOIN unidade_atendimento e ON (c.nr_atendimento = e.nr_atendimento)
LEFT OUTER JOIN medico g ON (c.cd_medico_resp = g.cd_pessoa_fisica)
WHERE a.nr_seq_grupo 			= d.nr_sequencia and b.nr_atendimento   	= c.nr_atendimento and c.cd_pessoa_fisica 		= f.cd_pessoa_fisica and a.nr_atendimento 		= b.nr_atendimento  and b.nr_seq_interno 		= Obter_Atepacu_paciente(c.nr_atendimento,'A') and ((coalesce(d.IE_ALTA,'S') = 'S') or (c.dt_alta is null)) and a.dt_entrada is not null and a.dt_saida is null 
 
union
 
select 	a.nr_seq_grupo, 
			(b.cd_unidade_basica || ' ' || b.cd_unidade_compl) cd_unidade, 
			e.nm_pessoa_fisica, 
			substr(obter_idade(e.dt_nascimento, LOCALTIMESTAMP, 'S'),1,100) ds_idade, 
			a.nr_atendimento, 
			f.nm_guerra, 
			c.dt_entrada, 
			substr(obter_conv_ocupacao(c.nr_atendimento),1,40) ds_convenio, 
			substr(obter_anotacao_pendente(c.nr_atendimento),1,255) ds_anotacao, 
			substr(obter_diagnostico_atendimento(c.nr_atendimento),1,240) ds_diagnostico, 
			a.cd_pessoa_fisica 
FROM pessoa_fisica e, pac_grupo d, pac_grupo_atend a, atendimento_paciente c
LEFT OUTER JOIN unidade_atendimento b ON (c.nr_atendimento = b.nr_atendimento)
LEFT OUTER JOIN medico f ON (c.cd_medico_resp = f.cd_pessoa_fisica)
WHERE a.nr_seq_grupo 		= d.nr_sequencia and ((coalesce(d.IE_ALTA,'S') 	= 'S') or (c.dt_alta is null)) and a.cd_pessoa_fisica 		= c.cd_pessoa_fisica  and c.cd_pessoa_fisica 		 = e.cd_pessoa_fisica and a.dt_entrada is null and a.dt_saida is null and a.nr_atendimento is null and c.dt_alta is null 
 
union
 
select		a.nr_seq_grupo, 
			(f.cd_unidade_basica || ' ' || f.cd_unidade_compl) cd_unidade, 
			e.nm_pessoa_fisica, 
			substr(obter_idade(e.dt_nascimento, LOCALTIMESTAMP, 'S'),1,100) ds_idade, 
			a.nr_atendimento, 
			g.nm_guerra, 
			c.dt_entrada,	 
			substr(obter_conv_ocupacao(c.nr_atendimento),1,40) ds_convenio, 
			substr(obter_anotacao_pendente(c.nr_atendimento),1,255) ds_anotacao, 
			substr(obter_diagnostico_atendimento(c.nr_atendimento),1,240) ds_diagnostico, 
			a.cd_pessoa_fisica 
FROM pessoa_fisica e, pac_grupo d, atend_paciente_unidade b, pac_grupo_atend a, atendimento_paciente c
LEFT OUTER JOIN unidade_atendimento f ON (c.nr_atendimento = f.nr_atendimento)
LEFT OUTER JOIN medico g ON (c.cd_medico_resp = g.cd_pessoa_fisica)
WHERE b.nr_atendimento    = c.nr_atendimento and a.nr_seq_grupo = d.nr_sequencia and ((coalesce(d.IE_ALTA,'S') = 'S') or (c.dt_alta is null)) and a.cd_pessoa_fisica = c.cd_pessoa_fisica  and b.nr_seq_interno = Obter_Atepacu_paciente(c.nr_atendimento,'A') and a.dt_entrada is not null and a.dt_saida is null and c.dt_alta is null and a.nr_atendimento is null and c.cd_pessoa_fisica 		 = e.cd_pessoa_fisica;

