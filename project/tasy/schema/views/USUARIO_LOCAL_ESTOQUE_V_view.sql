-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW usuario_local_estoque_v (nm_usuario, ie_local_adicional, cd_local_estoque, ds_local_estoque, cd_estabelecimento, ie_tipo_local, ie_permite_emprestimo) AS select	distinct
	a.nm_usuario,
	'N' ie_local_adicional,
	l.cd_local_estoque,
	l.ds_local_estoque,
	l.cd_estabelecimento,
	l.ie_tipo_local,
	coalesce(l.ie_permite_emprestimo,'S') ie_permite_emprestimo
FROM	usuario_setor_v a,
	setor_atendimento s,
	local_estoque l
where	a.cd_setor_atendimento	= s.cd_setor_atendimento
and	s.cd_local_estoque		= l.cd_local_estoque
and	l.ie_situacao		= 'A'

union all

select	distinct
	a.nm_usuario,
	'S' ie_local_adicional,
	l.cd_local_estoque,
	l.ds_local_estoque,
	l.cd_estabelecimento,
	l.ie_tipo_local,
	coalesce(l.ie_permite_emprestimo,'S') ie_permite_emprestimo
from	usuario_setor_v a,
	setor_atendimento s,
	local_estoque l,
	setor_local x
where	a.cd_setor_atendimento	= s.cd_setor_atendimento
and	x.cd_local_estoque		= l.cd_local_estoque
and	x.cd_setor_atendimento	= a.cd_setor_atendimento
and (l.ie_situacao		= 'A')
and (substr(obter_se_lib_local_setor_estab(s.cd_estabelecimento),1,1) = 'S');

