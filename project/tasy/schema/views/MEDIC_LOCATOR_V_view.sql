-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW medic_locator_v (cd_pessoa_fisica, ds_fonetica, ds_fonetica_cns, nr_crm, nm_guerra, ie_corpo_clinico, cd_especialidade, ie_corpo_assist, nm_usuario, dt_atualizacao, ds_especialidade, ds_vinculo, ie_vinculo_medico, nr_cpf, ds_categoria_medico, nr_seq_categoria, nr_seq_conselho, uf_crm, ds_conselho, nm_pessoa_fisica_sem_acento, nm_social, cd_setor_atendimento, nr_bsnr) AS SELECT  DISTINCT
        	a.cd_pessoa_fisica,
        	a.ds_fonetica,
          a.ds_fonetica_cns,
        	b.nr_crm,
        	b.nm_guerra,
        	b.ie_corpo_clinico,
          c.cd_especialidade,
        	b.ie_corpo_assist,
        	a.nm_usuario,
        	a.dt_atualizacao,
        	SUBSTR(obter_especialidades_medico(a.cd_pessoa_fisica),1,255) ds_especialidade,
        	SUBSTR(obter_valor_dominio(3,b.ie_vinculo_medico),1,120) ds_vinculo,
        	b.ie_vinculo_medico,
        	a.nr_cpf,
        	SUBSTR(obter_desc_categ_medico(b.nr_seq_categoria),1,80) ds_categoria_medico,
        	b.nr_seq_categoria,                
        	a.nr_seq_conselho,
        	SUBSTR(coalesce(b.uf_crm,obter_compl_pf(a.cd_pessoa_fisica,1,'UF')),1,2) uf_crm,
        	SUBSTR(obter_Conselho_Profissional(a.nr_seq_conselho,'S'),1,255) ds_conselho,
          a.nm_pessoa_fisica_sem_acento,
          a.nm_social,
          b.cd_setor_atendimento,
          d.nr_bsnr
FROM pessoa_fisica a, medico b
LEFT OUTER JOIN medico_especialidade c ON (b.cd_pessoa_fisica = c.cd_pessoa_fisica)
LEFT OUTER JOIN medico_espec_bsnr d ON (c.cd_pessoa_fisica = d.cd_pessoa_fisica AND c.cd_especialidade = d.cd_especialidade)
WHERE a.cd_pessoa_fisica = b.cd_pessoa_fisica    AND (obter_se_medico_estab3(b.cd_pessoa_fisica, wheb_usuario_pck.get_cd_estabelecimento) = 'S') AND b.ie_situacao = 'A';

