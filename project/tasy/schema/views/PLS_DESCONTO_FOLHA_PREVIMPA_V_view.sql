-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_desconto_folha_previmpa_v (tp_registro, cd_matricula_reparticao, vl_pago, dt_competencia, nr_seq_cobranca) AS select	1				TP_REGISTRO,
	c.cd_matricula			CD_MATRICULA_REPARTICAO, 
	obter_Valor_sem_virgula(a.vl_cobranca)	VL_PAGO, 
	d.dt_remessa_retorno		DT_COMPETENCIA, 
	a.nr_seq_cobranca		NR_SEQ_COBRANCA 
FROM	titulo_receber_cobr		a, 
	pls_mensalidade			b, 
	pls_contrato_pagador_fin	c, 
	cobranca_escritural		d, 
	pls_desc_empresa_regra		e 
where	substr(obter_dados_titulo_receber(a.nr_titulo, 'ME'),1,255) = b.nr_sequencia 
and	b.nr_seq_pagador = c.nr_seq_pagador 
and	LOCALTIMESTAMP	between coalesce(c.dt_inicio_vigencia,LOCALTIMESTAMP) and coalesce(c.dt_fim_vigencia,LOCALTIMESTAMP) 
and	a.nr_seq_cobranca = d.nr_sequencia 
and	e.nr_seq_empresa = d.nr_seq_empresa 
group by	d.dt_remessa_retorno, 
		a.nr_seq_cobranca, 
		c.cd_matricula, 
		a.vl_cobranca 

union
 
select	2				TP_REGISTRO, 
	c.cd_matricula			CD_MATRICULA_REPARTICAO, 
	obter_Valor_sem_virgula(a.vl_cobranca)	VL_PAGO, 
	d.dt_remessa_retorno		DT_COMPETENCIA, 
	a.nr_seq_cobranca		NR_SEQ_COBRANCA 
from	titulo_receber_cobr		a, 
	pls_mensalidade			b, 
	pls_contrato_pagador_fin	c, 
	cobranca_escritural		d, 
	pls_desc_empresa_regra		e 
where	substr(obter_dados_titulo_receber(a.nr_titulo, 'ME'),1,255) = b.nr_sequencia 
and	b.nr_seq_pagador = c.nr_seq_pagador 
and	LOCALTIMESTAMP	between coalesce(c.dt_inicio_vigencia,LOCALTIMESTAMP) and coalesce(c.dt_fim_vigencia,LOCALTIMESTAMP) 
and	a.nr_seq_cobranca = d.nr_sequencia 
and	e.nr_seq_empresa = d.nr_seq_empresa;

