-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eme_usuarios_v (cd_codigo_convenio, cd_unimed, cd_empresa, cd_familia, cd_dependencia, cd_convenio, ds_convenio, ds_categoria, ds_branco, nr_cpf, nr_identidade, nm_pessoa_fisica, ie_sexo, ie_estado_civil, dt_nascimento, dt_inclusao, dt_cancelamento, ie_tipo_pessoa, ie_tipo_dependente, ds_endereco, nr_endereco, ds_complemento, ds_bairro, ds_municipio, sg_estado, cd_cep, nr_telefone, ds_email, nm_contato) AS select	b.cd_codigo_convenio,
	substr(b.cd_codigo_convenio,1,3) cd_unimed, 
	substr(b.cd_codigo_convenio,4,4) cd_empresa, 
	substr(b.cd_codigo_convenio,8,6) cd_familia, 
	substr(b.cd_codigo_convenio,14,2) cd_dependencia, 
	a.cd_convenio, 
	f.ds_convenio, 
	g.ds_categoria, 
	'' ds_branco, 
	d.nr_cpf, 
	d.nr_identidade, 
	d.nm_pessoa_fisica, 
	d.ie_sexo, 
	CASE WHEN d.ie_estado_civil=1 THEN '2' WHEN d.ie_estado_civil=2 THEN '1' WHEN d.ie_estado_civil=3 THEN '4' WHEN d.ie_estado_civil=4 THEN '6' WHEN d.ie_estado_civil=5 THEN '5'  ELSE '6' END  ie_estado_civil, 
	d.dt_nascimento, 
	b.dt_inclusao, 
	b.dt_cancelamento, 
	CASE WHEN a.cd_pessoa_fisica IS NULL THEN 1  ELSE 0 END  ie_tipo_pessoa,		 
	CASE WHEN b.cd_pessoa_fisica=b.cd_pf_titular THEN 'T'  ELSE 'D' END  ie_tipo_dependente, 
	e.ds_endereco, 
	e.nr_endereco, 
	e.ds_complemento, 
	e.ds_bairro, 
	e.ds_municipio, 
	e.sg_estado, 
	e.cd_cep, 
	e.nr_telefone, 
	e.ds_email, 
	e.nm_contato 
FROM compl_pessoa_fisica e, pessoa_fisica d, eme_pf_contrato b, eme_contrato_v a
LEFT OUTER JOIN convenio f ON (a.cd_convenio = f.cd_convenio)
LEFT OUTER JOIN categoria_convenio g ON (a.cd_categoria = g.cd_categoria AND a.cd_convenio = g.cd_convenio)
WHERE b.nr_seq_contrato	= a.nr_sequencia and b.cd_pessoa_fisica	= d.cd_pessoa_fisica and d.cd_pessoa_fisica	= e.cd_pessoa_fisica    and e.ie_tipo_complemento	= 1;

