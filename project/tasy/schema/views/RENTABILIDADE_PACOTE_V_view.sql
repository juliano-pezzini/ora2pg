-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW rentabilidade_pacote_v (nr_atendimento, nr_interno_conta, nr_seq_proc_pacote, cd_convenio, cd_setor_atendimento, ie_proc_mat, cd_item, ds_item, dt_item, qt_item, vl_item, vl_original, ds_convenio, ds_setor_atendimento, cd_paciente, ie_tipo_atendimento, nm_paciente, nr_seq_protocolo, dt_mesano_referencia, cd_proced_pacote, ds_proced_pacote, ie_origem_proced, cd_estabelecimento, nm_medico_executor, cd_medico_executor, cd_especialidade, dt_alta, nr_sequencia, cd_categoria, dt_entrada, ie_emite_conta, nr_seq_proc_interno, nr_seq_exame, vl_custo_operacional, vl_medico, vl_filme, ie_origem_proc_item, ie_cancelamento) AS select		a.nr_atendimento,
		a.nr_interno_conta, 
		a.nr_seq_proc_pacote, 
		a.cd_convenio, 
		a.cd_setor_atendimento, 
		a.ie_proc_mat, 
		a.cd_item, 
		a.ds_item, 
		a.dt_item, 
		a.qt_item, 
		a.vl_item, 
		a.vl_original, 
		b.ds_convenio, 
		c.ds_setor_atendimento, 
		d.cd_pessoa_fisica cd_paciente, 
		d.ie_tipo_atendimento, 
		e.nm_pessoa_fisica nm_paciente, 
		a.nr_seq_protocolo, 
		a.dt_mesano_protocolo dt_mesano_referencia, 
		i.cd_proced_pacote, 
		j.ds_procedimento ds_proced_pacote, 
		j.ie_origem_proced, 
		d.cd_estabelecimento, 
		substr(obter_nome_pessoa_fisica(obter_dados_propaci('ME',h.NR_SEQ_PROCEDIMENTO),''),1,100) nm_medico_executor, 
		obter_dados_propaci('ME',h.NR_SEQ_PROCEDIMENTO) cd_medico_executor, 
		a.cd_especialidade, 
		d.dt_alta, 
		a.nr_sequencia, 
		a.cd_categoria, 
		d.dt_entrada, 
		a.ie_emite_conta, 
		a.nr_seq_proc_interno, 
		a.nr_seq_exame, 
		a.vl_custo_operacional, 
		a.vl_medico, 
		a.vl_filme, 
		a.ie_origem_proced ie_origem_proc_item, 
		a.ie_cancelamento 
FROM		setor_atendimento c, 
		convenio b, 
		pacote i, 
		pessoa_fisica e, 
		procedimento j, 
		atendimento_paciente d, 
		atendimento_pacote h, 
		protocolo_convenio_item_v a 
where		a.cd_convenio			= b.cd_convenio 
and		a.cd_setor_atendimento		= c.cd_setor_atendimento 
and		a.nr_atendimento		= d.nr_atendimento 
and		d.cd_pessoa_fisica		= e.cd_pessoa_fisica 
and		a.nr_seq_proc_pacote		= h.nr_seq_procedimento 
and		h.nr_seq_pacote			= i.nr_seq_pacote 
and		i.cd_proced_pacote		= j.cd_procedimento 
and		i.ie_origem_proced		= j.ie_origem_proced 
and (a.nr_seq_proc_pacote is null 
 or       a.nr_seq_proc_pacote <> a.nr_sequencia);

