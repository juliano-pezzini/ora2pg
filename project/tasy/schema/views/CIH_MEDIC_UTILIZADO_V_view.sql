-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW cih_medic_utilizado_v (nr_ficha_ocorrencia, dt_inicial_utilizacao, dt_final_utilizacao, cd_medicamento, vl_medicamento, ds_medicamento, nr_seq_medicamento, cd_clinica, cd_clinica_int, cd_medico, cd_tipo_evolucao, nr_indicacoes, ie_tipo_utilizacao, nr_indic_prof, nr_indic_terap, nr_dias, nr_dias_prof, nr_dias_terap, nr_indic_retardou_sim, nr_indic_retardou_nao, nr_atendimento, dt_alta, dt_alta_interno, cd_estabelecimento) AS select	c.nr_ficha_ocorrencia,
	a.dt_inicial_utilizacao,
	a.dt_final_utilizacao,
	a.cd_medicamento,
	a.vl_medicamento,
	b.ds_medicamento,
	a.nr_seq_medicamento,
	a.cd_clinica,
	c.cd_clinica_int,
	c.cd_medico,
	c.cd_tipo_evolucao,
	1 nr_indicacoes,
	a.ie_tipo_utilizacao,
	coalesce(CASE WHEN ie_tipo_utilizacao='1' THEN 1  ELSE 0 END ,0) nr_indic_prof,
	coalesce(CASE WHEN ie_tipo_utilizacao='2' THEN 1  ELSE 0 END ,0) nr_indic_terap,
	coalesce((a.dt_final_utilizacao - a.dt_inicial_utilizacao) + 1,0) nr_dias,
	coalesce(CASE WHEN ie_tipo_utilizacao='1' THEN (a.dt_final_utilizacao - a.dt_inicial_utilizacao) + 1  ELSE 0 END ,0) nr_dias_prof,
	coalesce(CASE WHEN ie_tipo_utilizacao='2' THEN (a.dt_final_utilizacao - a.dt_inicial_utilizacao) + 1  ELSE 0 END ,0) nr_dias_Terap,
	coalesce(CASE WHEN ie_retardou_alta='1' THEN 1  ELSE 0 END ,0) nr_indic_Retardou_sim,
	coalesce(CASE WHEN ie_retardou_alta='2' THEN 1  ELSE 0 END ,0) nr_indic_Retardou_nao,
	c.nr_atendimento,
	c.dt_alta,
	c.dt_alta_interno,
	c.cd_estabelecimento
FROM	cih_medicamento b,
	cih_medic_utilizado a,
	cih_ficha_ocorrencia_v c
where	a.cd_medicamento      = b.cd_medicamento
and	c.nr_ficha_ocorrencia = a.nr_ficha_ocorrencia;

