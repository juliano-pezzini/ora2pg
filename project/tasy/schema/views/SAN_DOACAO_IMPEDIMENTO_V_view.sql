-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW san_doacao_impedimento_v (nr_seq_doacao, nr_sequencia, ds_impedimento, ds_observacao, ie_resposta, ie_resposta_padrao, ie_definitivo, nr_inaptidao_temp, dt_ocorrencia, ie_resposta_correta, ie_pergunta, ds_cor_fundo) AS select  0 nr_seq_doacao,
        a.nr_sequencia,
        a.ds_impedimento,
        ' ' ds_observacao,
        coalesce(ie_resposta_correta,'N') ie_resposta,
	null ie_resposta_padrao,
	a.ie_definitivo,
	a.nr_inaptidao_temp,
  	null dt_ocorrencia,
	coalesce(ie_resposta_correta,'N') ie_resposta_correta,
	coalesce(a.ie_pergunta,'N') ie_pergunta,
	a.ds_cor_fundo ds_cor_fundo
FROM 	san_impedimento a
where 	a.ie_questionario = 'S'
and	coalesce(a.ie_situacao, 'A') = 'A'

union

select  b.nr_seq_doacao,
        a.nr_sequencia,
        a.ds_impedimento,
        b.ds_observacao,
        CASE WHEN coalesce(ie_resposta_correta,'N')='N' THEN 'S'  ELSE 'N' END  ie_resposta,
	'S' ie_resposta_padrao,
	a.ie_definitivo,
	a.nr_inaptidao_temp,
	b.dt_ocorrencia,
	coalesce(ie_resposta_correta,'N') ie_resposta_correta,
	coalesce(a.ie_pergunta,'N') ie_pergunta,
	a.ds_cor_fundo ds_cor_fundo
from 	san_impedimento a,
	san_doacao_impedimento b
where 	a.nr_sequencia = b.nr_seq_impedimento
and 	a.ie_questionario = 'S'
and	coalesce(a.ie_situacao, 'A') = 'A'

union

SELECT  b.nr_seq_doacao,
        a.nr_sequencia,
        a.ds_impedimento,
        b.ds_observacao,
        b.ie_resposta,
	b.ie_resposta ie_resposta_padrao,
	a.ie_definitivo,
	a.nr_inaptidao_temp,
	b.dt_ocorrencia dt_ocorrencia,
	coalesce(ie_resposta_correta,'N') ie_resposta_correta,
	coalesce(a.ie_pergunta,'N') ie_pergunta,
	a.ds_cor_fundo ds_cor_fundo
FROM 	san_impedimento a,
     	san_doacao_questionario b
WHERE   a.nr_sequencia = b.nr_seq_pergunta
AND 	a.ie_questionario = 'S'
and	coalesce(a.ie_situacao, 'A') = 'A'

union

SELECT  b.nr_seq_doacao,
        a.nr_sequencia,
        a.ds_impedimento,
        b.ds_observacao,
        b.ie_resposta,
		b.ie_resposta ie_resposta_padrao,
		a.ie_definitivo,
		a.nr_inaptidao_temp,
		b.dt_ocorrencia dt_ocorrencia,
		coalesce(ie_resposta_correta,'N') ie_resposta_correta,
		coalesce(a.ie_pergunta,'N') ie_pergunta,
		a.ds_cor_fundo ds_cor_fundo
FROM 	san_impedimento a,
     	san_questionario b
WHERE   a.nr_sequencia = b.nr_seq_impedimento
AND 	a.ie_questionario = 'S'
and	coalesce(a.ie_situacao, 'A') = 'A';

