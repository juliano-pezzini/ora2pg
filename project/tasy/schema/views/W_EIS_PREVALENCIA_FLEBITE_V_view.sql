-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW w_eis_prevalencia_flebite_v (cd_setor_atendimento, ds_setor_atendimento, dt_evento, cd_empresa, cd_estabelecimento, ie_origem, ds_unidade, ie_faixa_etaria, nr_a, nr_seq_item, ds_fator) AS select	distinct
	b.cd_setor_atendimento, 
	substr(obter_nome_setor(b.cd_setor_atendimento),1,255) ds_Setor_Atendimento,	 
	b.dt_evento, 
	f.cd_empresa, 
	a.cd_estabelecimento,	 
	e.ie_origem, 
	obter_unidade_atendimento(b.nr_atendimento,'A','U') ds_unidade, 
	substr(obter_idade(obter_data_nascto_pf(b.cd_pessoa_fisica),LOCALTIMESTAMP,'E'),1,10) ie_faixa_etaria,	 
	b.nr_atendimento nr_a, 
	c.nr_seq_item, 
	substr(obter_desc_resultados_flebite(null,c.nr_seq_item,null,'FR'),1,255) ds_fator 
FROM estabelecimento f, qua_evento_flebite e, eif_escala d, qua_evento_paciente b, atendimento_paciente a, escala_eif g
LEFT OUTER JOIN escala_eif_item c ON (g.nr_sequencia = c.nr_seq_escala)
WHERE e.nr_seq_evento = b.nr_sequencia and a.nr_atendimento = g.nr_atendimento and d.nr_sequencia = g.nr_seq_escala and g.dt_inativacao is null and upper(d.ds_escala) like upper('%risco%flebite%') and b.dt_inativacao is null and a.nr_atendimento = b.nr_atendimento and a.cd_estabelecimento = f.cd_estabelecimento  and c.ie_resultado <> 'N' and trunc(e.dt_atualizacao_nrec) = trunc(g.dt_avaliacao) and e.ie_origem = '1';

