-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_matmed_result_v (ds_material, ds_unidade_medida, cd_unidade_medida_estoque, pr_margem_compra, pr_margem_estoque, pr_margem_convenio, ds_material_comercial, ie_curva_abc, qt_cons_medio, vl_margem, cd_classe_material, cd_subgrupo_material, cd_grupo_material, ie_consignado, ds_convenio, ds_material_generico, ds_tipo_material, ie_tipo_material, ds_classe_material, ds_subgrupo_material, ds_grupo_material, cd_material_generico, cd_material_comercial, dt_referencia, cd_estabelecimento, cd_material, dt_atualizacao, nm_usuario, qt_faturada, vl_medio_fatur, vl_custo_medio, vl_custo_compra, qt_consumo, ie_orig_estoque, vl_preco_convenio, cd_convenio, dt_atualizacao_nrec, nm_usuario_nrec) AS select	b.ds_material,
		substr(obter_dados_material_estab(a.cd_material,a.cd_estabelecimento,'UME'),1,30) ds_unidade_medida,
		substr(obter_dados_material_estab(a.cd_material,a.cd_estabelecimento,'UME'),1,30) cd_unidade_medida_estoque,
		obter_margem(a.vl_custo_compra, a.vl_medio_fatur, 'P') pr_margem_compra,
		obter_margem(a.vl_custo_medio, a.vl_medio_fatur, 'P') pr_margem_estoque,
		obter_margem(a.vl_custo_medio, a.vl_preco_convenio, 'P') pr_margem_convenio,
		substr(obter_mat_comercial(a.cd_material,'D'),1,100) ds_material_comercial,
		substr(obter_curva_abc(a.cd_material, '', a.dt_referencia),1,10) ie_curva_abc,
		obter_mat_estabelecimento(a.cd_estabelecimento, 0, a.cd_material, 'CM') qt_cons_medio,
		dividir(a.vl_custo_medio, vl_medio_fatur) vl_margem,
		c.cd_classe_material,
		d.cd_subgrupo_material,
		e.cd_grupo_material,
		b.ie_consignado,
		substr(obter_nome_convenio(a.cd_convenio),1,200) ds_convenio,
		substr(obter_desc_material(b.cd_material_generico),1,200) ds_material_generico,
		substr(obter_valor_dominio(29,b.ie_tipo_material),1,200) ds_tipo_material,
		b.ie_tipo_material,
		c.ds_classe_material,
		d.ds_subgrupo_material,
		e.ds_grupo_material,
		b.cd_material_generico,
		(obter_mat_comercial(a.cd_material,'C'))::numeric   cd_material_comercial,
		a.DT_REFERENCIA,a.CD_ESTABELECIMENTO,a.CD_MATERIAL,a.DT_ATUALIZACAO,a.NM_USUARIO,a.QT_FATURADA,a.VL_MEDIO_FATUR,a.VL_CUSTO_MEDIO,a.VL_CUSTO_COMPRA,a.QT_CONSUMO,a.IE_ORIG_ESTOQUE,a.VL_PRECO_CONVENIO,a.CD_CONVENIO,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC
	FROM	grupo_material e,
		subgrupo_material d,
		classe_material c,
		material b,
		eis_matmed_result a
	where	a.cd_material	= b.cd_material
	and	b.cd_classe_material		= c.cd_classe_material
	and	c.cd_subgrupo_material	= d.cd_subgrupo_material
	and	d.cd_grupo_material		= e.cd_grupo_material
	and	a.ie_orig_estoque		= 'E';

