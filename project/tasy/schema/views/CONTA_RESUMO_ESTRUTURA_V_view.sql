-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW conta_resumo_estrutura_v (nr_interno_conta, ie_emite_conta, vl_liquido, vl_desconto, vl_original, vl_original_medico, vl_adiantamento, vl_adiant_conta, vl_saldo_adiant, vl_saldo_adiant_conta, vl_saldo_conta, vl_saldo_conta_ad, vl_saldo_conta_ad_s, qt_item, qt_item_convenio, qt_item_pacote, vl_medico, vl_liquido_sem_medico) AS select 	a.nr_interno_conta,
 	'200' ie_emite_conta, 
 	sum(vl_liquido) vl_liquido, 
 	sum(vl_desconto) vl_desconto, 
 	sum(vl_original) vl_original, 
 	sum(vl_original_medico) vl_original_medico, 
	coalesce(max(Obter_Vl_Adiant_Conta(a.nr_interno_conta, 'S')),0) vl_adiantamento, 
	coalesce(max(Obter_Vl_Adiant_Conta(a.nr_interno_conta, 'N')),0) vl_adiant_conta, 
	coalesce(max(Obter_Vl_Saldo_Adiant_Conta(a.nr_interno_conta, 'S')),0) vl_Saldo_adiant, 
	coalesce(max(Obter_Vl_Saldo_Adiant_Conta(a.nr_interno_conta, 'N')),0) vl_Saldo_adiant_conta, 
	sum(vl_liquido) - coalesce(max(Obter_Vl_Adiant_Conta(a.nr_interno_conta, 'S')),0) vl_saldo_conta, 
	sum(vl_liquido) - coalesce(max(Obter_Vl_Adiant_Conta(a.nr_interno_conta, 'N')),0) vl_saldo_conta_ad, 
	sum(vl_liquido) - coalesce(max(Obter_Vl_Saldo_Adiant_Conta(a.nr_interno_conta, 'N')),0) vl_saldo_conta_ad_s, 
	sum(qt_item) qt_item, 
	sum(qt_item_convenio) qt_item_convenio, 
	obter_qtd_pacote_conta(a.nr_interno_conta) qt_item_pacote, 
	sum(a.vl_medico) vl_medico, 
	sum(vl_liquido) - sum(a.vl_medico) vl_liquido_sem_medico 
FROM 	Conta_Resumo_v a 
group by a.nr_interno_conta;

