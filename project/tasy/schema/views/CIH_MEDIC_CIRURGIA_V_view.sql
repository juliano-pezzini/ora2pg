-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW cih_medic_cirurgia_v (nr_ficha_ocorrencia, dt_inicial_utilizacao, cd_medicamento, ds_medicamento, cd_clinica, nr_seq_cirurgia, cd_medico_cirurgiao, cd_topografia, cd_caso_infeccao, nr_indicacoes, nr_indic_limpa, nr_indic_potencial, nr_indic_contaminada, nr_indic_infectada, nr_indic_sem_duracao, nr_indic_menos_duas_horas, nr_indic_mais_duas_horas, dt_alta, dt_alta_interno, cd_estabelecimento) AS select a.nr_ficha_ocorrencia,
       a.dt_inicial_utilizacao,
       a.cd_medicamento,
       b.ds_medicamento,
       a.cd_clinica,
       c.nr_seq_cirurgia,
       c.cd_medico_cirurgiao,
       d.cd_topografia,
       d.cd_caso_infeccao,
       1 nr_indicacoes,
       CASE WHEN c.cd_tipo_cirurgia='1' THEN 1  ELSE 0 END  nr_indic_Limpa,
       CASE WHEN c.cd_tipo_cirurgia='2' THEN 1  ELSE 0 END  nr_indic_Potencial,
       CASE WHEN c.cd_tipo_cirurgia='3' THEN 1  ELSE 0 END  nr_indic_Contaminada,
       CASE WHEN c.cd_tipo_cirurgia='4' THEN 1  ELSE 0 END  nr_indic_Infectada,
       CASE WHEN c.ie_duracao_cirurgia='1' THEN 1  ELSE 0 END  nr_indic_sem_duracao,
       CASE WHEN c.ie_duracao_cirurgia='2' THEN 1  ELSE 0 END  nr_indic_Menos_duas_horas,
       CASE WHEN c.ie_duracao_cirurgia='3' THEN 1  ELSE 0 END  nr_indic_Mais_duas_horas,
       f.dt_alta,
       f.dt_alta_interno,
	   f.cd_estabelecimento
FROM cih_medicamento b,
     cih_cirurgia c,
     cih_ficha_ocorrencia_v f,
     cih_local_infeccao d,
     cih_medic_utilizado a
where a.cd_medicamento      = b.cd_medicamento
  and a.nr_ficha_ocorrencia = c.nr_ficha_ocorrencia
  and a.nr_ficha_ocorrencia = d.nr_ficha_ocorrencia
  and a.nr_ficha_ocorrencia = f.nr_ficha_ocorrencia;

