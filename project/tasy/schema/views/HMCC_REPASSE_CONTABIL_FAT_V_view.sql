-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW hmcc_repasse_contabil_fat_v (ds_repasse, ds_status, ds_terceiro, vl_repasse, vl_liberado, dt_mesano_referencia, ie_tipo_item, nr_seq_terceiro, dt_mesano_referencia_r) AS SELECT  DS_REPASSE,
	DS_STATUS,
	DS_TERCEIRO,
	VL_REPASSE,
        VL_LIBERADO,
	DT_MESANO_REFERENCIA,
	IE_TIPO_ITEM,
        NR_SEQ_TERCEIRO,
        DT_MESANO_REFERENCIA_R
FROM (
-- PAGOS
select 	'Repasse Procedimento' ds_repasse,
        substr(obter_valor_dominio(1129, a.ie_status),1,40) ds_status,
	substr(obter_nome_terceiro(a.nr_seq_terceiro),1,255)ds_terceiro,
	sum(a.vl_repasse) vl_repasse,
	sum(a.vl_liberado) vl_liberado,
        t.DT_MESANO_REFERENCIA,
        r.DT_MESANO_REFERENCIA DT_MESANO_REFERENCIA_R,
        a.NR_SEQ_TERCEIRO,
	'P' ie_tipo_item
from 	procedimento_paciente b,
	procedimento_repasse a,
        conta_paciente t,
        repasse_terceiro r
where 	a.nr_seq_procedimento	= b.nr_sequencia
and   	a.nr_repasse_terceiro     = r.nr_repasse_terceiro
and    	b.nr_interno_conta      = t.nr_interno_conta
group by 'Repasse Procedimento',
	 a.ie_status,
         t.DT_MESANO_REFERENCIA,
	 a.nr_seq_terceiro,
	 r.DT_MESANO_REFERENCIA

union all

select 	'Repasse Material' ds_repasse,
	substr(obter_valor_dominio(1129, a.ie_status),1,40) ds_status,
	substr(obter_nome_terceiro(a.nr_seq_terceiro),1,255)ds_terceiro,
	sum(a.vl_repasse) vl_repasse,
	sum(a.vl_liberado) vl_liberado,
        t.DT_MESANO_REFERENCIA,
        r.DT_MESANO_REFERENCIA DT_MESANO_REFERENCIA_R,
        a.NR_SEQ_TERCEIRO,
        'M' ie_tipo_item
from 	material m,
	material_atend_paciente b,
	material_repasse a,
        conta_paciente t,
        repasse_terceiro r
where   a.nr_seq_material	= b.nr_sequencia
and	a.nr_repasse_terceiro     = r.nr_repasse_terceiro
and	m.cd_material		= b.cd_material
and	b.nr_interno_conta      = t.nr_interno_conta
group by 'Repasse Material',
         a.ie_status,
         t.DT_MESANO_REFERENCIA,
	 a.nr_seq_terceiro,
	 r.DT_MESANO_REFERENCIA

union all

select 'Repasse Item' ds_repasse,
	'Não Informado' ds_tipo_item,
	substr(obter_nome_terceiro(a.nr_seq_terceiro),1,255)ds_terceiro,
	sum(a.vl_repasse) vl_repasse,
	sum(a.vl_repasse) vl_liberado,
        a.DT_LANCAMENTO DT_MESANO_REFERENCIA,
 	r.DT_MESANO_REFERENCIA DT_MESANO_REFERENCIA_R,
        a.NR_SEQ_TERCEIRO,
        'I' ie_tipo_item
from 	repasse_terceiro_item a,
        repasse_terceiro r
where   a.nr_repasse_terceiro     = r.nr_repasse_terceiro
group by a.nr_seq_terceiro,
	 r.DT_MESANO_REFERENCIA,
         a.DT_LANCAMENTO

UNION ALL

--PENTENTES
select 'Repasse Item Pendente' ds_repasse,
	'Não Informado' ds_tipo_item,
	substr(obter_nome_terceiro(a.nr_seq_terceiro),1,255)ds_terceiro,
	sum(a.vl_repasse) vl_repasse,
	sum(a.vl_repasse) vl_liberado,
        a.DT_LANCAMENTO DT_MESANO_REFERENCIA,
 	LOCALTIMESTAMP DT_MESANO_REFERENCIA_R,
        a.NR_SEQ_TERCEIRO,
        'I' ie_tipo_item
from 	repasse_terceiro_item a
where   a.nr_repasse_terceiro is null
group by a.nr_seq_terceiro,
         a.DT_LANCAMENTO

union all

select 	'Repasse Procedimento' ds_repasse,
        substr(obter_valor_dominio(1129, a.ie_status),1,40) ds_status,
	substr(obter_nome_terceiro(a.nr_seq_terceiro),1,255)ds_terceiro,
	sum(a.vl_repasse) vl_repasse,
	sum(a.vl_liberado) vl_liberado,
        t.DT_MESANO_REFERENCIA,
 	LOCALTIMESTAMP DT_MESANO_REFERENCIA_R,
        a.NR_SEQ_TERCEIRO,
	'P' ie_tipo_item
from 	procedimento_paciente b,
	procedimento_repasse a,
        conta_paciente t
where 	a.nr_seq_procedimento	= b.nr_sequencia
and     a.nr_repasse_terceiro  is null
and    	b.nr_interno_conta      = t.nr_interno_conta
group by 'Repasse Procedimento',
	 a.ie_status,
         t.DT_MESANO_REFERENCIA,
	 a.nr_seq_terceiro

union all

select 	'Repasse Material' ds_repasse,
	substr(obter_valor_dominio(1129, a.ie_status),1,40) ds_status,
	substr(obter_nome_terceiro(a.nr_seq_terceiro),1,255)ds_terceiro,
	sum(a.vl_repasse) vl_repasse,
	sum(a.vl_liberado) vl_liberado,
        t.DT_MESANO_REFERENCIA,
	 LOCALTIMESTAMP DT_MESANO_REFERENCIA_R,
        a.NR_SEQ_TERCEIRO,
        'M' ie_tipo_item
from 	material m,
	material_atend_paciente b,
	material_repasse a,
        conta_paciente t
where   a.nr_seq_material	= b.nr_sequencia
and	m.cd_material		= b.cd_material
and    	b.nr_interno_conta      = t.nr_interno_conta
and     a.nr_repasse_terceiro  is null
group by 'Repasse Material',
         a.ie_status,
         t.DT_MESANO_REFERENCIA,
	 a.nr_seq_terceiro
) alias32;

