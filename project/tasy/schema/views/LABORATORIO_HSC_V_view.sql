-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW laboratorio_hsc_v (ie_tipo_linha, nm_paciente, dt_nascimento, ds_idade, ds_idade_aux, ie_sexo, ie_parametros, ie_rack, ie_repeticao, dt_coleta, ie_prioridade, cd_material, cd_exame, ie_filler, cd_equipamento, nr_prescricao) AS select	10 ie_tipo_linha,
	g.nm_pessoa_fisica nm_paciente,
	g.dt_nascimento,
	obter_idade(g.dt_nascimento, f.dt_prescricao, 'A') ds_idade,
        0 ds_idade_aux,
	g.ie_sexo,
	' ' ie_parametros,
	' ' ie_rack,
	'N' ie_repeticao,
	coalesce(b.dt_atualizacao, f.dt_prescricao) dt_coleta,
	CASE WHEN a.ie_urgencia='S' THEN  'U'  ELSE 'R' END  ie_prioridade,
	coalesce(d.cd_material_integracao, d.cd_material_exame) cd_material,
	coalesce(e.cd_exame_equip, coalesce(c.cd_exame_integracao, cd_exame)) cd_exame,
	' ' ie_filler,
	e.cd_equipamento,
	a.nr_prescricao
FROM pessoa_fisica g, prescr_medica f, lab_exame_equip e, material_exame_lab d, exame_laboratorio c, prescr_procedimento a
LEFT OUTER JOIN prescr_proc_etapa b ON (a.nr_prescricao = b.nr_prescricao AND a.nr_sequencia = b.nr_seq_prescricao AND 20 = b.ie_etapa)
WHERE a.nr_seq_exame	= c.nr_seq_exame and a.cd_material_exame = d.cd_material_exame and a.nr_seq_exame	= e.nr_seq_exame and e.ie_padrao	= 'S' and a.nr_prescricao	= f.nr_prescricao and f.cd_pessoa_fisica = g.cd_pessoa_fisica and a.dt_integracao is null;

