-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW cobranca_paciente_conta_v (dt_atualizacao, nr_seq_lote, nr_interno_conta, nr_atendimento, vl_total_conta, nr_titulo, ie_tipo_guia, ds_convenio, nm_paciente, ds_categoria, nm_medico, ds_etapa, ds_motivo_dev, ds_classificacao, nr_nota_fiscal, dt_entrada, ds_tipo_atendimento, ds_estabelecimento, nm_usuario_nota, nr_nfe, ds_classificao_pessoa, ds_po) AS select	c.dt_atualizacao,
	c.nr_seq_lote, 
	c.nr_interno_conta, 
	c.nr_atendimento, 
	c.vl_total_conta, 
	c.nr_titulo, 
	c.ie_tipo_guia, 
	substr(obter_nome_convenio(c.cd_convenio),1,255) ds_convenio, 
	substr(obter_nome_paciente(c.nr_atendimento),1,255) nm_paciente, 
	substr(obter_categoria_convenio(c.cd_convenio, c.cd_categoria_convenio),1,255) ds_categoria, 
	substr((select obter_nome_medico(x.cd_medico_resp,'n') FROM atendimento_paciente x where x.nr_atendimento = c.nr_atendimento),1,255) nm_medico, 
	substr(obter_descricao_padrao('FATUR_ETAPA', 'DS_ETAPA', c.nr_seq_etapa),1,255) ds_etapa, 
	substr(obter_descricao_padrao('FATUR_MOTIVO_DEVOL', 'DS_MOTIVO_DEVOLUCAO', c.nr_seq_motivo_dev),1,255) ds_motivo_dev, 
	substr(obter_dados_atendimento(c.nr_atendimento, 'CLP'),1,255) ds_classificacao, 
	substr(obter_nf_conta(c.nr_interno_conta, 2),1,255) nr_nota_fiscal, 
	substr((select to_char(y.dt_entrada,'dd/mm/yyyy hh24:mi:ss') from conta_paciente x, atendimento_paciente y where x.nr_atendimento = y.nr_atendimento and x.nr_atendimento = c.nr_atendimento and x.nr_interno_conta = c.nr_interno_conta),1,255) dt_entrada, 
	substr(obter_valor_dominio(12,obter_dados_conta_paciente(c.nr_interno_conta,'TAC')),1,255) ds_tipo_atendimento, 
	substr(obter_nome_estabelecimento(c.cd_estabelecimento),1,255) ds_estabelecimento, 
	substr((select x.nm_usuario_nrec from nota_fiscal x where x.nr_interno_conta = c.nr_interno_conta),1,255) nm_usuario_nota, 
	substr((select x.nr_nfe_imp from nota_fiscal x where x.nr_interno_conta = c.nr_interno_conta),1,255) nr_nfe, 
	substr(obter_lista_dados_classif_hsl(obter_pessoa_conta(c.nr_interno_conta,'C'),'D'),1,255) ds_classificao_pessoa, 
	substr(obter_dias_pos_operatorio(c.nr_atendimento),1,255) ds_po 
from	cobranca_paciente_lote a, 
	cobranca_paciente_conta c, 
	estabelecimento d 
where	c.nr_seq_lote = a.nr_sequencia 
and	a.cd_estabelecimento = d.cd_estabelecimento;

