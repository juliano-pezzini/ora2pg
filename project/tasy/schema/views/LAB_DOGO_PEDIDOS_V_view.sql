-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW lab_dogo_pedidos_v (pedido, data_pedido, prescricao, codigo_paciente, data_atendimento, convenio, nome_do_convenio, plano, nome_do_plano, crm_medico, uf_crm_medico, idade_usuario, nr_guia, matricula_paciente, validade, documento, cpf_paciente, nome_paciente, data_nascimento, sexo, logradouro, endereco, bairro, cidade, uf_paciente, cep_paciente, fone_paciente, email_paciente, nm_mae_paciente, codigo_local, local_paciente, codigo_quarto, quarto, numero_atendimento, cid, data_alta, senha) AS select	distinct a.nr_prescricao pedido,
		a.dt_prescricao data_pedido, 
		a.nr_prescricao Prescricao, 
		e.cd_pessoa_fisica codigo_paciente, 
		b.dt_entrada data_atendimento, 
		c.cd_convenio Convenio, 
		substr(obter_nome_convenio(c.cd_convenio),1,100) Nome_do_Convenio, 
		c.cd_plano_convenio Plano, 
		substr(obter_desc_plano_conv(c.cd_convenio,c.cd_plano_convenio),1,100) nome_do_Plano, 
		d.nr_crm Crm_medico, 
		d.uf_crm uf_crm_medico, 
		obter_idade_pf(a.cd_pessoa_fisica,LOCALTIMESTAMP,'AMD2') idade_usuario, 
		c.nr_doc_convenio nr_guia, 
		c.cd_usuario_convenio matricula_paciente, 
		c.dt_validade_carteira validade, 
		e.nr_identidade documento, 
		e.nr_cpf cpf_paciente, 
		e.nm_pessoa_fisica nome_paciente, 
		e.dt_nascimento data_nascimento, 
		e.ie_sexo sexo, 
		obter_compl_pf(e.cd_pessoa_fisica,1,'TLS') logradouro, 
		obter_compl_pf(e.cd_pessoa_fisica,1,'EN') endereco, 
		obter_compl_pf(e.cd_pessoa_fisica,1,'B') bairro, 
		obter_compl_pf(e.cd_pessoa_fisica,1,'CI') cidade, 
		obter_compl_pf(e.cd_pessoa_fisica,1,'UF') uf_paciente, 
		obter_compl_pf(e.cd_pessoa_fisica,1,'CEP') cep_paciente, 
		obter_compl_pf(e.cd_pessoa_fisica,1,'T') fone_paciente, 
		obter_compl_pf(e.cd_pessoa_fisica,1,'M') email_paciente, 
		obter_compl_pf(e.cd_pessoa_fisica,5,'N') nm_mae_paciente, 
		obter_compl_pf(e.cd_pessoa_fisica,1,'DDT') codigo_local, 
		f.cd_setor_atendimento local_paciente, 
		f.cd_unidade_basica codigo_quarto,	 
		substr(obter_desc_tipo_acomod(c.cd_tipo_acomodacao),1,30) quarto, 
		a.nr_atendimento numero_atendimento, 
		g.cd_doenca cid, 
		b.dt_alta data_alta, 
		b.ds_senha senha 
FROM	prescr_medica a, 
	atendimento_paciente b, 
	atend_categoria_convenio c, 
	medico d, 
	pessoa_fisica e, 
	atend_paciente_unidade f, 
	diagnostico_doenca g, 
	prescr_procedimento h 
where	a.nr_prescricao	= h.nr_prescricao 
and	a.nr_atendimento = b.nr_atendimento 
and	b.nr_atendimento = c.nr_atendimento 
and	a.cd_medico	 = d.cd_pessoa_fisica 
and	h.cd_setor_atendimento = 39 
and	b.ie_tipo_atendimento	= 3 
and	h.nr_seq_exame is not null 
and	a.cd_pessoa_fisica	= e.cd_pessoa_fisica 
and	b.nr_atendimento	= f.nr_atendimento 
and	b.nr_atendimento	= g.nr_atendimento;

