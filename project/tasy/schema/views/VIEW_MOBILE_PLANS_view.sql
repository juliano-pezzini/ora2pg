-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW view_mobile_plans (nr_sequencia, ds_plano) AS select	a.nr_sequencia nr_sequencia,
	substr(pls_obter_dados_produto(nr_sequencia,'C'),1,255) ds_plano
FROM	pls_plano	a
where	a.ie_situacao in ('A', 'S')
and	a.ie_tipo_operacao = 'B'
and	a.dt_liberacao is not null
and	a.dt_cancelamento is null
and (NULL is null or exists (select 1 from  pls_tipo_guia_med_atend x  where  x.nr_seq_plano = a.nr_sequencia and x.nr_seq_tipo_guia   IS NULL))
and	exists (	select	1
		from	pls_web_param_guia_medico
		where	ie_forma_apres_desc_plano = 'NF')

union

select	a.nr_sequencia,
	substr(pls_obter_dados_produto(nr_sequencia,'C'),1,255) ds_plano
from	pls_plano	a
where	a.ie_situacao in ('A', 'S')
and	a.ie_tipo_operacao = 'B'
and	a.dt_liberacao is not null
and	a.dt_cancelamento is null
and (NULL is null or exists (select 1 from  pls_tipo_guia_med_atend x  where  x.nr_seq_plano = a.nr_sequencia and x.nr_seq_tipo_guia   IS NULL))
and	exists (	select	1
		from	pls_web_param_guia_medico
		where (ie_forma_apres_desc_plano = 'DS') or (ie_forma_apres_desc_plano is null))
order by ds_plano;

