-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_item_pacote_v (ie_tipo_item, ie_origem_item, cd_item, ds_item, qt_item, vl_negociado, cd_procedimento, ie_origem_proced) AS SELECT	'Procedimento'										ie_tipo_item,
	c.ie_origem_proced									ie_origem_item,
	c.cd_procedimento									cd_item,
	SUBSTR(obter_descricao_procedimento(c.cd_procedimento,c.ie_origem_proced),1,255)	ds_item,
	qt_procedimento										qt_item,
	vl_negociado										vl_negociado,
	c.cd_procedimento,
	c.ie_origem_proced
FROM	pls_pacote		a,
	pls_pacote_composicao b,
	pls_pacote_procedimento	c
WHERE	a.nr_sequencia = b.nr_seq_pacote
AND	b.nr_sequencia = c.nr_seq_composicao
AND	c.ie_situacao	= 'A'
AND	a.ie_situacao	= 'A'
AND	coalesce(c.ie_estrutura,'S')	= 'S'

UNION ALL

SELECT	'Material',
	NULL,
	c.nr_seq_material,
	SUBSTR(pls_obter_desc_material(c.nr_seq_material),1,255),
	qt_material,
	vl_negociado,
	a.cd_procedimento,
	a.ie_origem_proced
FROM	pls_pacote		a,
	pls_pacote_composicao	b,
	pls_pacote_material	c
WHERE	a.nr_sequencia = b.nr_seq_pacote
and	b.nr_sequencia = c.nr_seq_composicao
AND	c.ie_situacao	= 'A'
AND	a.ie_situacao	= 'A';

