-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW custo_padrao_comp_v (nr_sequencia, nr_ficha_tecnica, nr_seq_componente, dt_alteracao, cd_estabelecimento, ie_situacao, ie_tipo_componente, cd_material, cd_procedimento, ie_origem_proced, cd_centro_controle, qt_fixa, qt_variavel, pr_quebra_variavel, ds_material, ds_procedimento, ds_grupo_natureza_gasto, ds_centro_controle, ds_tipo_componente_ficha, ds_componente, cd_unidade_medida, cd_tabela_custo, cd_tipo_gasto, cd_grupo_natureza_gasto, vl_custo_unitario, vl_custo_componente, ie_situacao_calculo, cd_grupo_proc, cd_especialidade, cd_area_procedimento, nr_seq_gng, dt_inicio_vigencia, dt_fim_vigencia, dt_mes_referencia, nr_seq_tabela) AS select /* +ordered */
	a.nr_sequencia,
	b.nr_ficha_tecnica,
	b.nr_seq_componente,
	b.dt_alteracao,
	b.cd_estabelecimento,
	b.ie_situacao,
	b.ie_tipo_componente,
	b.cd_material,
	b.cd_procedimento,
	b.ie_origem_proced,
	b.cd_centro_controle,
	b.qt_fixa,
	b.qt_variavel,
	b.pr_quebra_variavel,
	m.ds_material,
	p.ds_procedimento,
	g.ds_grupo_natureza_gasto,
	c.ds_centro_controle,
	t.ds_tipo_componente_ficha,
	substr(cus_obter_componente_ficha(	a.cd_estabelecimento,
						a.nr_ficha_tecnica,
						a.nr_seq_componente,
						2),1,255) ds_componente,
	CASE WHEN b.ie_tipo_componente='1' THEN  substr(obter_dados_material_estab(m.cd_material,b.cd_estabelecimento,'UMS'),1,30) WHEN b.ie_tipo_componente=2 THEN                'UN' WHEN b.ie_tipo_componente=3 THEN  c.cd_unidade_medida  ELSE '' END  cd_unidade_medida,
	a.cd_tabela_custo,
	a.cd_tipo_gasto,
	a.cd_grupo_natureza_gasto,
	a.vl_custo_unitario,
	a.vl_custo_componente,
	a.ie_situacao_calculo,
	p.cd_grupo_proc,
	(substr(obter_especialidade_proced(p.cd_procedimento,p.ie_origem_proced),1,15))::numeric  cd_especialidade,
	(substr(obter_area_procedimento(p.cd_procedimento,p.ie_origem_proced),1,15))::numeric  cd_area_procedimento,
	g.nr_sequencia nr_seq_gng,
	b.dt_inicio_vigencia,
	b.dt_fim_vigencia,
	x.dt_mes_referencia,
	x.nr_sequencia nr_seq_tabela
FROM tabela_custo x, tipo_componente_ficha_v t, custo_padrao_comp a
LEFT OUTER JOIN grupo_natureza_gasto g ON (a.nr_seq_gng = g.nr_sequencia)
, ficha_tecnica_componente b
LEFT OUTER JOIN material m ON (b.cd_material = m.cd_material)
LEFT OUTER JOIN procedimento p ON (b.cd_procedimento = p.cd_procedimento AND b.ie_origem_proced = p.ie_origem_proced)
LEFT OUTER JOIN centro_controle c ON (b.cd_centro_controle = c.cd_centro_controle AND b.cd_estabelecimento = c.cd_estabelecimento)
WHERE a.nr_ficha_tecnica	= b.nr_ficha_tecnica and a.nr_seq_componente	= b.nr_seq_componente and b.ie_tipo_componente	= t.cd_tipo_componente_ficha and x.cd_tabela_custo	= a.cd_tabela_custo and x.nr_sequencia		= a.nr_seq_tabela;

