-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW risco_cirurgico_card_v (dt_registro, nm_profissional, cd_pessoa_fisica, nr_atendimento, nr_sequencia, nr_seq_apae, ds_escala, ie_escala) AS select	b.dt_atualizacao_nrec dt_registro,
		obter_pf_usuario(a.nm_usuario_nrec, 'D') nm_profissional,
		b.cd_pessoa_fisica,
		b.nr_atendimento,
		a.nr_sequencia,
		b.nr_sequencia nr_seq_apae,
		obter_desc_expressao(283796) ds_escala,
		'ASA' ie_escala
FROM	asa_apae a,
		aval_pre_anestesica b
where	b.nr_sequencia = a.nr_seq_aval_pre
and		b.dt_liberacao is not null
and		b.dt_inativacao is null

union

select	a.dt_avaliacao dt_registro,
		coalesce(obter_nome_pessoa_fisica(a.cd_profissional, null),obter_pf_usuario(a.nm_usuario_nrec, 'D')) nm_profissional,
		b.cd_pessoa_fisica,
		a.nr_atendimento,
		a.nr_sequencia,
		b.nr_sequencia nr_seq_apae,
		obter_desc_expressao(315163) ds_escala,
		'PPOSSUM' ie_escala
from	escala_possum a,
		aval_pre_anestesica b
where	b.nr_sequencia = a.nr_seq_apae
and		a.dt_liberacao is not null
and		b.dt_liberacao is not null
and		a.dt_inativacao is  null
and		b.dt_inativacao is  null

union

select	a.dt_avaliacao,
		coalesce(obter_nome_pessoa_fisica(a.cd_profissional, null),obter_pf_usuario(a.nm_usuario_nrec, 'D')) nm_profissional,
		b.cd_pessoa_fisica,
		a.nr_atendimento,
		a.nr_sequencia,
		b.nr_sequencia nr_seq_apae,
		obter_desc_expressao(314039) ds_escala,
		'LEE' ie_escala
from	escala_lee a,
		aval_pre_anestesica b
where	b.nr_sequencia = a.nr_seq_aval_pre
and		a.dt_liberacao is not null
and		b.dt_liberacao is not null
and		a.dt_inativacao is  null
and		b.dt_inativacao is  null

union

select	a.dt_avaliacao,
		coalesce(obter_nome_pessoa_fisica(a.cd_profissional, null),obter_pf_usuario(a.nm_usuario_nrec, 'D')) nm_profissional,
		b.cd_pessoa_fisica,
		a.nr_atendimento,
		a.nr_sequencia,
		b.nr_sequencia nr_seq_apae,
		obter_desc_expressao(315154) ds_escala,
		'RISCO_PULMONAR' ie_escala
from	escala_risco_pulmonar a,
		aval_pre_anestesica b
where	b.nr_sequencia = a.nr_seq_aval_pre
and		a.dt_liberacao is not null
and		b.dt_liberacao is not null
and		a.dt_inativacao is  null
and		b.dt_inativacao is  null

union

select	a.dt_avaliacao,
		coalesce(obter_nome_pessoa_fisica(a.cd_profissional, null),obter_pf_usuario(a.nm_usuario_nrec, 'D')) nm_profissional,
		b.cd_pessoa_fisica,
		a.nr_atendimento,
		a.nr_sequencia,
		b.nr_sequencia nr_seq_apae,
		obter_desc_expressao(314041) ds_escala,
		'INSUF_RENAL' ie_escala
from	escala_risco_insuf_renal a,
		aval_pre_anestesica b
where	b.nr_sequencia = a.nr_seq_aval_pre
and		a.dt_liberacao is not null
and		b.dt_liberacao is not null
and		a.dt_inativacao is  null
and		b.dt_inativacao is  null

union

select	a.dt_avaliacao,
		coalesce(obter_nome_pessoa_fisica(a.cd_profissional, null),obter_pf_usuario(a.nm_usuario_nrec, 'D')) nm_profissional,
		b.cd_pessoa_fisica,
		a.nr_atendimento,
		a.nr_sequencia,
		b.nr_sequencia nr_seq_apae,
		obter_desc_expressao(316784) ds_escala,
		'CHILD_PUGH' ie_escala
from	escala_child_pugh a,
		aval_pre_anestesica b
where	b.nr_sequencia = a.nr_seq_aval_pre
and		a.dt_liberacao is not null
and		b.dt_liberacao is not null
and		a.dt_inativacao is  null
and		b.dt_inativacao is  null

union

select	a.dt_avaliacao,
		coalesce(obter_nome_pessoa_fisica(a.cd_profissional, null),obter_pf_usuario(a.nm_usuario_nrec, 'D')) nm_profissional,
		b.cd_pessoa_fisica,
		a.nr_atendimento,
		a.nr_sequencia,
		b.nr_sequencia nr_seq_apae,
		obter_desc_expressao(287386) ds_escala,
		'DELIIRIUM' ie_escala
from	escala_risco_delirium a,
		aval_pre_anestesica b
where	b.nr_sequencia = a.nr_seq_aval_pre
and		a.dt_liberacao is not null
and		b.dt_liberacao is not null
and		a.dt_inativacao is  null
and		b.dt_inativacao is  null

union

select	a.dt_avaliacao,
		coalesce(obter_nome_pessoa_fisica(a.cd_profissional, null),obter_pf_usuario(a.nm_usuario_nrec, 'D')) nm_profissional,
		obter_dados_atendimento(a.nr_atendimento, 'CP') cd_pessoa_fisica,
		a.nr_atendimento,
		a.nr_sequencia,
		null nr_seq_apae,
		obter_desc_expressao(802423) ds_escala,
		'HELIOS' ie_escala
from	escala_helios a
where	a.dt_liberacao is not null
and		a.dt_inativacao is  null

union

select	a.dt_avaliacao,
		coalesce(obter_nome_pessoa_fisica(a.cd_profissional, null),obter_pf_usuario(a.nm_usuario_nrec, 'D')) nm_profissional,
		a.cd_pessoa_fisica,
		a.nr_atendimento,
		a.nr_sequencia,
		b.nr_sequencia nr_seq_apae,
		obter_desc_expressao(313996) ds_escala,
		'CLEREANCE' ie_escala
from	pac_clereance_creatinina a,
		aval_pre_anestesica b
where	b.nr_sequencia = a.nr_seq_apae
and		a.dt_liberacao is not null
and		b.dt_liberacao is not null
and		a.dt_inativacao is  null
and		b.dt_inativacao is  null

union

select	a.dt_avaliacao,
		coalesce(obter_nome_pessoa_fisica(a.cd_profissional, null),obter_pf_usuario(a.nm_usuario_nrec, 'D')) nm_profissional,
		obter_dados_atendimento(a.nr_atendimento, 'CP') cd_pessoa_fisica,
		a.nr_atendimento,
		a.nr_sequencia,
		null nr_seq_apae,
		obter_desc_expressao(313969) ds_escala,
		'FLEX_II' ie_escala
from	escala_eif_ii a
where	a.dt_liberacao is not null
and		a.dt_inativacao is  null;

