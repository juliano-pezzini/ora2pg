-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW cpoe_itens_v (nr_sequencia, ds_item, ie_tipo_item, nr_atendimento, cd_pessoa_fisica, hr_prim_horario, dt_inicio, ie_tipo_item_cpoe, dt_suspensao, cd_material, nm_usuario, dt_liberacao, ie_administracao, nr_seq_cpoe_order_unit, nr_seq_cpoe_rp) AS select	nr_sequencia,
		substr(obter_desc_dieta(cd_dieta),1,255) ds_item,
		'D' ie_tipo_item,
		nr_atendimento,
		cd_pessoa_fisica,
		hr_prim_horario,
		dt_inicio,
		'N' ie_tipo_item_cpoe,
		CASE WHEN dt_lib_suspensao IS NULL THEN  null  ELSE dt_suspensao END  dt_suspensao,
		null cd_material,
		nm_usuario,
		dt_liberacao,
		ie_administracao,
		nr_seq_cpoe_order_unit,
		null nr_seq_cpoe_rp
FROM	cpoe_dieta
where	cpoe_reg_valido_ativacao(CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE cpoe_obter_data_maior(dt_suspensao,dt_fim) END , dt_inicio, LOCALTIMESTAMP) = 'S'
and	dt_liberacao is not null
and	ie_tipo_dieta	= 'O'

union all

select	nr_sequencia,
		substr(obter_desc_material(cd_material),1,255) ds_item,
		'SNE' ie_tipo_item,
		nr_atendimento,
		cd_pessoa_fisica,
		hr_prim_horario,
		dt_inicio,
		'N' ie_tipo_item_cpoe,
		CASE WHEN dt_lib_suspensao IS NULL THEN  null  ELSE dt_suspensao END  dt_suspensao,
		cd_material,
		nm_usuario,
		dt_liberacao,
		ie_administracao,
		nr_seq_cpoe_order_unit,
		null nr_seq_cpoe_rp
from	cpoe_dieta
where	cpoe_reg_valido_ativacao(CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE cpoe_obter_data_maior(dt_suspensao,dt_fim) END , dt_inicio, LOCALTIMESTAMP) = 'S'
and	dt_liberacao is not null
and	ie_tipo_dieta	= 'E'

union all

select	nr_sequencia,
		substr(obter_desc_material(cd_material),1,255) ds_item,
		'S' ie_tipo_item,
		nr_atendimento,
		cd_pessoa_fisica,
		hr_prim_horario,
		dt_inicio,
		'N' ie_tipo_item_cpoe,
		CASE WHEN dt_lib_suspensao IS NULL THEN  null  ELSE dt_suspensao END  dt_suspensao,
		cd_material,
		nm_usuario,
		dt_liberacao,
		ie_administracao,
		nr_seq_cpoe_order_unit,
		null nr_seq_cpoe_rp
from	cpoe_dieta
where	cpoe_reg_valido_ativacao(CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE cpoe_obter_data_maior(dt_suspensao,dt_fim) END , dt_inicio, LOCALTIMESTAMP) = 'S'
and	dt_liberacao is not null
and	ie_tipo_dieta	= 'S'

union all

select	nr_sequencia,
		substr(Obter_desc_tipo_jejum(nr_seq_tipo),1,255) ds_item,
		'J' ie_tipo_item,
		nr_atendimento,
		cd_pessoa_fisica,
		hr_prim_horario,
		dt_inicio,
		'N' ie_tipo_item_cpoe,
		CASE WHEN dt_lib_suspensao IS NULL THEN  null  ELSE dt_suspensao END  dt_suspensao,
		null cd_material,
		nm_usuario,
		dt_liberacao,
		ie_administracao,
		nr_seq_cpoe_order_unit,
		null nr_seq_cpoe_rp
from	cpoe_dieta
where	cpoe_reg_valido_ativacao(CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE cpoe_obter_data_maior(dt_suspensao,dt_fim) END , dt_inicio, LOCALTIMESTAMP) = 'S'
and	dt_liberacao is not null
and	ie_tipo_dieta	= 'J'

union all

select	nr_sequencia,
		substr(obter_desc_material(CD_MAT_PROD1),1,255) ds_item,
		'LD' ie_tipo_item,
		nr_atendimento,
		cd_pessoa_fisica,
		hr_prim_horario,
		dt_inicio,
		'N' ie_tipo_item_cpoe,
		CASE WHEN dt_lib_suspensao IS NULL THEN  null  ELSE dt_suspensao END  dt_suspensao,
		CD_MAT_PROD1 cd_material,
		nm_usuario,
		dt_liberacao,
		ie_administracao,
		nr_seq_cpoe_order_unit,
		null nr_seq_cpoe_rp
from	cpoe_dieta
where	cpoe_reg_valido_ativacao(CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE cpoe_obter_data_maior(dt_suspensao,dt_fim) END , dt_inicio, LOCALTIMESTAMP) = 'S'
and	dt_liberacao is not null
and	ie_tipo_dieta	= 'L'

union all

select	nr_sequencia,
		'NPT '||substr(obter_desc_prot_npt(nr_seq_protocolo),1,255) ds_item,
		'NA' ie_tipo_item,
		nr_atendimento,
		cd_pessoa_fisica,
		hr_prim_horario,
		dt_inicio,
		'N' ie_tipo_item_cpoe,
		CASE WHEN dt_lib_suspensao IS NULL THEN  null  ELSE dt_suspensao END  dt_suspensao,
		null cd_material,
		nm_usuario,
		dt_liberacao,
		ie_administracao,
		nr_seq_cpoe_order_unit,
		null nr_seq_cpoe_rp
from	cpoe_dieta
where	cpoe_reg_valido_ativacao(CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE cpoe_obter_data_maior(dt_suspensao,dt_fim) END , dt_inicio, LOCALTIMESTAMP) = 'S'
and	dt_liberacao is not null
and	ie_tipo_dieta	= 'P'

union all

select	nr_sequencia,
		'NPT '||substr(obter_desc_prot_npt(nr_seq_protocolo),1,255) ds_item,
		'NP' ie_tipo_item,
		nr_atendimento,
		cd_pessoa_fisica,
		hr_prim_horario,
		dt_inicio,
		'N' ie_tipo_item_cpoe,
		CASE WHEN dt_lib_suspensao IS NULL THEN  null  ELSE dt_suspensao END  dt_suspensao,
		null cd_material,
		nm_usuario,
		dt_liberacao,
		ie_administracao,
		nr_seq_cpoe_order_unit,
		null nr_seq_cpoe_rp
from	cpoe_dieta
where	cpoe_reg_valido_ativacao(CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE cpoe_obter_data_maior(dt_suspensao,dt_fim) END , dt_inicio, LOCALTIMESTAMP) = 'S'
and	dt_liberacao is not null
and	ie_tipo_dieta	= 'I'

union all

select	nr_sequencia,
		substr(obter_desc_material(cd_material),1,255) ds_item,
		'M' ie_tipo_item,
		nr_atendimento,
		cd_pessoa_fisica,
		hr_prim_horario,
		dt_inicio,
		'M' ie_tipo_item_cpoe,
		CASE WHEN dt_lib_suspensao IS NULL THEN  null  ELSE dt_suspensao END  dt_suspensao,
		cd_material,
		nm_usuario,
		dt_liberacao,
		ie_administracao,
		nr_seq_cpoe_order_unit,
		nr_seq_cpoe_rp
from	cpoe_material
where	cpoe_reg_valido_ativacao(CASE WHEN dt_lib_suspensao IS NULL THEN  coalesce(dt_fim_cih,dt_fim)  ELSE cpoe_obter_data_maior(dt_suspensao,dt_fim) END  ,dt_inicio, LOCALTIMESTAMP) = 'S'
and	dt_liberacao is not null
and	ie_controle_tempo = 'N'
and	coalesce(ie_material,'N') = 'N'

union all

select	nr_sequencia,
		substr(obter_desc_material(cd_material),1,255) ds_item,
		'SOL' ie_tipo_item,
		nr_atendimento,
		cd_pessoa_fisica,
		hr_prim_horario,
		dt_inicio,
		'M' ie_tipo_item_cpoe,
		CASE WHEN dt_lib_suspensao IS NULL THEN  null  ELSE dt_suspensao END  dt_suspensao,
		cd_material,
		nm_usuario,
		dt_liberacao,
		ie_administracao,
		nr_seq_cpoe_order_unit,
		nr_seq_cpoe_rp
from	cpoe_material
where	cpoe_reg_valido_ativacao(CASE WHEN dt_lib_suspensao IS NULL THEN  coalesce(dt_fim_cih,dt_fim)  ELSE cpoe_obter_data_maior(dt_suspensao,dt_fim) END  ,dt_inicio, LOCALTIMESTAMP) = 'S'
and	dt_liberacao is not null
and	ie_controle_tempo = 'S'
and	coalesce(ie_material,'N') = 'N'

union all

select	nr_sequencia,
		substr(obter_desc_material(cd_material),1,255) ds_item,
		'MAT' ie_tipo_item,
		nr_atendimento,
		cd_pessoa_fisica,
		hr_prim_horario,
		dt_inicio,
		'MA' ie_tipo_item_cpoe,
		CASE WHEN dt_lib_suspensao IS NULL THEN  null  ELSE dt_suspensao END  dt_suspensao,
		cd_material,
		nm_usuario,
		dt_liberacao,
		ie_administracao,
		nr_seq_cpoe_order_unit,
		null nr_seq_cpoe_rp
from	cpoe_material
where	cpoe_reg_valido_ativacao(CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE cpoe_obter_data_maior(dt_suspensao,dt_fim) END , dt_inicio, LOCALTIMESTAMP) = 'S'
and	dt_liberacao is not null
and	coalesce(ie_material,'N') = 'S'

union all

select	nr_sequencia,
		substr(obter_desc_proc_interno(nr_seq_proc_interno),1,255) ds_item,
		'P' ie_tipo_item,
		nr_atendimento,
		cd_pessoa_fisica,
		hr_prim_horario,
		dt_inicio,
		'P' ie_tipo_item_cpoe,
		CASE WHEN dt_lib_suspensao IS NULL THEN  null  ELSE dt_suspensao END  dt_suspensao,
		null cd_material,
		nm_usuario,
		dt_liberacao,
		ie_administracao,
		nr_seq_cpoe_order_unit,
		null nr_seq_cpoe_rp
from	cpoe_procedimento
where	cpoe_reg_valido_ativacao(CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE cpoe_obter_data_maior(dt_suspensao,dt_fim) END , dt_inicio, LOCALTIMESTAMP) = 'S'
and		dt_liberacao is not null

union all

select	nr_sequencia,
		substr(obter_desc_gas(nr_seq_gas),1,255) ds_item,
		'O' ie_tipo_item,
		nr_atendimento,
		cd_pessoa_fisica,
		hr_prim_horario,
		dt_inicio,
		'G' ie_tipo_item_cpoe,
		CASE WHEN dt_lib_suspensao IS NULL THEN  null  ELSE dt_suspensao END  dt_suspensao,
		null cd_material,
		nm_usuario,
		dt_liberacao,
		ie_administracao,
		nr_seq_cpoe_order_unit,
		null nr_seq_cpoe_rp
from	cpoe_gasoterapia
where	cpoe_reg_valido_ativacao(CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE cpoe_obter_data_maior(dt_suspensao,dt_fim) END , dt_inicio, LOCALTIMESTAMP) = 'S'
and	dt_liberacao is not null

union all

select	nr_sequencia,
		substr(obter_desc_recomendacao(cd_recomendacao),1,255) ds_item,
		'R' ie_tipo_item,
		nr_atendimento,
		cd_pessoa_fisica,
		hr_prim_horario,
		dt_inicio,
		'R' ie_tipo_item_cpoe,
		CASE WHEN dt_lib_suspensao IS NULL THEN  null  ELSE dt_suspensao END  dt_suspensao,
		null cd_material,
		nm_usuario,
		dt_liberacao,
		ie_administracao,
		nr_seq_cpoe_order_unit,
		null nr_seq_cpoe_rp
from	cpoe_recomendacao
where	cpoe_reg_valido_ativacao(CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE cpoe_obter_data_maior(dt_suspensao,dt_fim) END , dt_inicio, LOCALTIMESTAMP) = 'S'
and	dt_liberacao is not null

union all

select	nr_sequencia,
		substr(cpoe_obter_desc_info_hemote(NR_SEQUENCIA),1,255) ds_item,
		'HM' ie_tipo_item,
		nr_atendimento,
		cd_pessoa_fisica,
		to_char(dt_inicio,'hh:24:mi') hr_prim_horario,
		dt_inicio,
		'H' ie_tipo_item_cpoe,
		CASE WHEN dt_lib_suspensao IS NULL THEN  null  ELSE dt_suspensao END  dt_suspensao,
		null cd_material,
		nm_usuario,
		dt_liberacao,
		null ie_administracao,
		nr_seq_cpoe_order_unit,
		null nr_seq_cpoe_rp
from	cpoe_hemoterapia
where	cpoe_reg_valido_ativacao(CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE cpoe_obter_data_maior(dt_suspensao,dt_fim) END , dt_inicio, LOCALTIMESTAMP) = 'S'
and	dt_liberacao is not null

union all

select	nr_sequencia,
		substr(CPOE_Obter_desc_dialise( ie_tipo_dialise, nr_seq_protocolo, dt_lib_suspensao, dt_suspensao, qt_fluxo_sangue, qt_hora_min_sessao, 'N', ie_hemodialise, ie_tipo_peritoneal, qt_volume_ciclo, qt_hora_min_duracao, ie_categoria),1,255) ds_item,
		'DI' ie_tipo_item,
		nr_atendimento,
		cd_pessoa_fisica,
		to_char(dt_inicio,'hh:24:mi') hr_prim_horario,
		dt_inicio,
		'D' ie_tipo_item_cpoe,
		CASE WHEN dt_lib_suspensao IS NULL THEN  null  ELSE dt_suspensao END  dt_suspensao,
		null cd_material,
		nm_usuario,
		dt_liberacao,
		ie_administracao,
		nr_seq_cpoe_order_unit,
		null nr_seq_cpoe_rp
from	cpoe_dialise
where	cpoe_reg_valido_ativacao(CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE cpoe_obter_data_maior(dt_suspensao,dt_fim) END , dt_inicio, LOCALTIMESTAMP) = 'S'
and		dt_liberacao is not null;

