-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW hmod_eis_score_eca (nr_sequencia, qt_atendimento, dt_atualizacao, nr_atendimento, dt_alta, ds_gradacao, ie_clinica, cd_pessoa_fisica, cd_medico_resp, cd_usuario, ds_clinica, ds_setor_usuario, nm_pessoa_fisica, ds_espec_medico, nm_medico, nm_usuario) AS select  max(a.nr_sequencia)nr_sequencia,
 count(*)QT_ATENDIMENTO,
 a.dt_atualizacao,
 a.nr_atendimento,
 b.dt_alta,
 c.ds_gradacao,
 b.ie_clinica,
 b.cd_pessoa_fisica,
 b.cd_medico_resp,
 a.cd_pessoa_fisica cd_usuario,
 substr(obter_valor_dominio(17,b.ie_clinica),1,15)ds_clinica,
substr(obter_nome_setor(obter_setor_usuario(a.nm_usuario)),1,60) ds_setor_usuario,
 substr(obter_nome_pf_pj(b.cd_pessoa_fisica,null),1,30)nm_pessoa_fisica,
 substr(obter_especialidades_medico(b.cd_medico_resp),1,20)ds_espec_medico,
 substr(obter_nome_pf_pj(b.cd_medico_resp,null),1,30)nm_medico,
 substr(obter_nome_pf_pj(a.cd_pessoa_fisica,null),1,30)nm_usuario
FROM   gca_atendimento a,
 atendimento_paciente b,
 gca_gradacao c
where  a.nr_atendimento = b.nr_atendimento
and a.nr_seq_gradacao = c.nr_Sequencia
group by a.nr_atendimento,
 c.ds_gradacao,
 b.ie_clinica,
 b.cd_pessoa_fisica,
 b.cd_medico_resp,
 a.dt_atualizacao,
 b.dt_alta,
 a.cd_pessoa_fisica,
 a.nm_usuario
;

