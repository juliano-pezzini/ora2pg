-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_movimen_dados_portal_web_v (cd_usuario_plano, nm_pessoa_fisica, nr_identidade, nr_cpf, dt_nascimento, ds_grau_parentesco, cd_matricula_est, ds_sexo, ds_estado_civil, dt_solicitacao, nm_mae, ds_endereco, ds_bairro, ds_municipio, sg_estado, ds_informacao, nr_contrato, ie_tipo_movimentacao, ie_titularidade, nr_seq_contrato) AS select	substr(pls_obter_dados_segurado(pls_obter_dados_inclusao(b.nr_sequencia,'S'),'C'),1,255) cd_usuario_plano,
	b.nm_pessoa_fisica, 
	b.NR_IDENTIDADE, 
	b.NR_CPF, 
	b.DT_NASCIMENTO, 
	substr(CASE WHEN b.nr_seq_titular_contrato IS NULL THEN CASE WHEN b.nr_seq_titular_solic IS NULL THEN 'Titular'  ELSE obter_desc_parentesco(nr_seq_parentesco) END   ELSE obter_desc_parentesco(nr_seq_parentesco) END ,1,255) ds_grau_parentesco, 
	b.CD_MATRICULA_EST, 
	CASE WHEN b.ie_sexo='F' THEN 'Feminino' WHEN b.ie_sexo='M' THEN 'Masculino'  ELSE 'Não informado' END  ds_sexo, 
	substr(obter_valor_dominio(5,IE_ESTADO_CIVIL),1,255) ds_estado_civil, 
	b.dt_solicitacao, 
	b.NM_MAE, 
	b.DS_ENDERECO, 
	b.DS_BAIRRO, 
	substr(obter_desc_municipio_ibge(cd_municipio_ibge),1,255) ds_municipio, 
	b.SG_ESTADO, 
	'Inclusão' ds_informacao, 
	a.nr_contrato, 
	'I' ie_tipo_movimentacao, 
	CASE WHEN b.nr_seq_titular_contrato IS NULL THEN 'T' WHEN b.nr_seq_titular_contrato=b.nr_seq_titular_solic THEN null WHEN b.nr_seq_titular_contrato='T' THEN 'D' END  ie_titularidade, 
	a.nr_sequencia nr_seq_contrato 
FROM	pls_inclusao_beneficiario	b, 
	pls_contrato			a 
where	a.nr_sequencia			= b.nr_seq_contrato 
and  	b.ie_processo	= 'W' 
and	b.ie_status	= 'C' 

union all
 
select	f.cd_usuario_plano, 
	a.nm_pessoa_fisica, 
	a.NR_IDENTIDADE, 
	a.NR_CPF, 
	a.DT_NASCIMENTO, 
	substr(CASE WHEN b.nr_seq_titular IS NULL THEN 'Titular'  ELSE obter_desc_parentesco(b.nr_seq_parentesco) END ,1,255) ds_grau_parentesco, 
	b.CD_MATRICULA_ESTIPULANTE, 
	CASE WHEN a.ie_sexo='F' THEN 'Feminino' WHEN a.ie_sexo='M' THEN 'Masculino'  ELSE 'Não informado' END  ds_sexo, 
	substr(obter_valor_dominio(5,a.IE_ESTADO_CIVIL),1,255) ds_estado_civil, 
	d.dt_solicitacao, 
	substr(OBTER_NOME_MAE_PF(a.cd_pessoa_fisica),1,255) nm_mae, 
	c.DS_ENDERECO, 
	c.DS_BAIRRO, 
	substr(obter_desc_municipio_ibge(c.cd_municipio_ibge),1,255) ds_municipio, 
	c.SG_ESTADO, 
	'Exclusão - '|| substr(pls_obter_desc_motivo_cancel(d.nr_seq_motivo_rescisao),1,255) ds_informacao, 
	e.nr_contrato, 
	'E' ie_tipo_movimentacao, 
	CASE WHEN b.nr_seq_titular IS NULL THEN 'T'  ELSE 'D' END  ie_titularidade, 
	e.nr_sequencia nr_seq_contrato 
from	pessoa_fisica		a, 
	pls_segurado		b, 
	compl_pessoa_fisica	c, 
	pls_rescisao_contrato	d, 
	pls_contrato		e, 
	pls_segurado_carteira	f 
where	a.cd_pessoa_fisica	= b.cd_pessoa_fisica 
and	a.cd_pessoa_fisica	= c.cd_pessoa_fisica 
and	d.nr_seq_segurado	= b.nr_sequencia 
and	b.nr_seq_contrato	= e.nr_sequencia 
and	f.nr_seq_segurado	= b.nr_sequencia 
and	c.ie_tipo_complemento	= 1 
and	d.IE_PROCESSO		= 'W' 

union all
 
select	f.cd_usuario_plano, 
	a.nm_pessoa_fisica, 
	a.NR_IDENTIDADE, 
	a.NR_CPF, 
	a.DT_NASCIMENTO, 
	substr(CASE WHEN b.nr_seq_titular IS NULL THEN 'Titular'  ELSE obter_desc_parentesco(b.nr_seq_parentesco) END ,1,255) ds_grau_parentesco, 
	b.CD_MATRICULA_ESTIPULANTE, 
	CASE WHEN a.ie_sexo='F' THEN 'Feminino' WHEN a.ie_sexo='M' THEN 'Masculino'  ELSE 'Não informado' END  ds_sexo, 
	substr(obter_valor_dominio(5,a.IE_ESTADO_CIVIL),1,255) ds_estado_civil, 
	d.DT_ATUALIZACAO_NREC, 
	substr(OBTER_NOME_MAE_PF(a.cd_pessoa_fisica),1,255) nm_mae, 
	c.DS_ENDERECO, 
	c.DS_BAIRRO, 
	substr(obter_desc_municipio_ibge(c.cd_municipio_ibge),1,255) ds_municipio, 
	c.SG_ESTADO, 
	'Repasse ' ds_informacao, 
	e.nr_contrato, 
	'R' ie_tipo_movimentacao, 
	CASE WHEN b.nr_seq_titular IS NULL THEN 'T'  ELSE 'D' END  ie_titularidade, 
	e.nr_sequencia nr_seq_contrato 
from	pessoa_fisica		a, 
	pls_segurado		b, 
	compl_pessoa_fisica	c, 
	pls_segurado_repasse	d, 
	pls_contrato		e, 
	pls_segurado_carteira	f 
where	a.cd_pessoa_fisica	= b.cd_pessoa_fisica 
and	a.cd_pessoa_fisica	= c.cd_pessoa_fisica 
and	d.nr_seq_segurado	= b.nr_sequencia 
and	b.nr_seq_contrato	= e.nr_sequencia 
and	f.nr_seq_segurado	= b.nr_sequencia 
and	c.ie_tipo_complemento	= 1 
and	d.IE_ORIGEM_SOLICITACAO	= 'P' 

union all
 
select g.cd_usuario_plano, 
	c.nm_pessoa_fisica, 
	c.NR_IDENTIDADE, 
	c.NR_CPF, 
	c.DT_NASCIMENTO, 
	substr(CASE WHEN d.nr_seq_titular IS NULL THEN 'Titular'  ELSE obter_desc_parentesco(d.nr_seq_parentesco) END ,1,255) ds_grau_parentesco, 
	d.CD_MATRICULA_ESTIPULANTE, 
	CASE WHEN c.ie_sexo='F' THEN 'Feminino' WHEN c.ie_sexo='M' THEN 'Masculino'  ELSE 'Não informado' END  ds_sexo, 
	substr(obter_valor_dominio(5,c.IE_ESTADO_CIVIL),1,255) ds_estado_civil, 
	b.DT_ATUALIZACAO_NREC, 
	substr(OBTER_NOME_MAE_PF(c.cd_pessoa_fisica),1,255) nm_mae, 
	e.DS_ENDERECO, 
	e.DS_BAIRRO, 
	substr(obter_desc_municipio_ibge(e.cd_municipio_ibge),1,255) ds_municipio, 
	e.SG_ESTADO, 
	'Alteração dos dados cadastrais do beneficiário' ds_informacao, 
	f.nr_contrato, 
	'A' ie_tipo_movimentacao, 
	CASE WHEN d.nr_seq_titular IS NULL THEN 'T'  ELSE 'D' END  ie_titularidade, 
	f.nr_sequencia nr_seq_contrato 
from  pessoa_fisica		c, 
	pls_segurado		d, 
	compl_pessoa_fisica	e, 
	pls_segurado_carteira	g, 
	pls_contrato		f, 
	tasy_solic_alteracao	b, 
	tasy_solic_alt_campo	a 
where  c.cd_pessoa_fisica	= d.cd_pessoa_fisica 
and	c.cd_pessoa_fisica	= e.cd_pessoa_fisica 
and	substr(pls_obter_pessoa_chave_comp(a.nr_sequencia,'P'),1,255) = c.cd_pessoa_fisica 
and	g.nr_seq_segurado	= d.nr_sequencia 
and	a.nr_seq_solicitacao	= b.nr_sequencia 
and	d.nr_seq_contrato	= f.nr_sequencia 
and	coalesce(b.ie_processo,'W') = 'W' 
and	b.ie_tipo_solicitacao = 'B' 

union all
 
select	f.cd_usuario_plano, 
	a.nm_pessoa_fisica, 
	a.NR_IDENTIDADE, 
	a.NR_CPF, 
	a.DT_NASCIMENTO, 
	substr(CASE WHEN b.nr_seq_titular IS NULL THEN 'Titular'  ELSE obter_desc_parentesco(b.nr_seq_parentesco) END ,1,255) ds_grau_parentesco, 
	b.CD_MATRICULA_ESTIPULANTE, 
	CASE WHEN a.ie_sexo='F' THEN 'Feminino' WHEN a.ie_sexo='M' THEN 'Masculino'  ELSE 'Não informado' END  ds_sexo, 
	substr(obter_valor_dominio(5,a.IE_ESTADO_CIVIL),1,255) ds_estado_civil, 
	f.DT_SOLICITACAO, 
	substr(OBTER_NOME_MAE_PF(a.cd_pessoa_fisica),1,255) nm_mae, 
	c.DS_ENDERECO, 
	c.DS_BAIRRO, 
	substr(obter_desc_municipio_ibge(c.cd_municipio_ibge),1,255) ds_municipio, 
	c.SG_ESTADO, 
	'Solicitação nova via do cartão ' ds_informacao, 
	e.nr_contrato, 
	'A' ie_tipo_movimentacao, 
	CASE WHEN b.nr_seq_titular IS NULL THEN 'T'  ELSE 'D' END  ie_titularidade, 
	e.nr_sequencia nr_seq_contrato 
from	pessoa_fisica		a, 
	pls_segurado		b, 
	compl_pessoa_fisica	c, 
	pls_contrato		e, 
	pls_segurado_carteira	f 
where	a.cd_pessoa_fisica	= b.cd_pessoa_fisica 
and	a.cd_pessoa_fisica	= c.cd_pessoa_fisica 
and	b.nr_seq_contrato	= e.nr_sequencia 
and	f.nr_seq_segurado	= b.nr_sequencia 
and	c.ie_tipo_complemento	= 1 
and	f.IE_PROCESSO	= 'W' 

union all
 
select	f.cd_usuario_plano, 
	a.nm_pessoa_fisica, 
	a.NR_IDENTIDADE, 
	a.NR_CPF, 
	a.DT_NASCIMENTO, 
	substr(CASE WHEN b.nr_seq_titular IS NULL THEN 'Titular'  ELSE obter_desc_parentesco(b.nr_seq_parentesco) END ,1,255) ds_grau_parentesco, 
	b.CD_MATRICULA_ESTIPULANTE, 
	CASE WHEN a.ie_sexo='F' THEN 'Feminino' WHEN a.ie_sexo='M' THEN 'Masculino'  ELSE 'Não informado' END  ds_sexo, 
	substr(obter_valor_dominio(5,a.IE_ESTADO_CIVIL),1,255) ds_estado_civil, 
	d.DT_SOLICITACAO, 
	substr(OBTER_NOME_MAE_PF(a.cd_pessoa_fisica),1,255) nm_mae, 
	c.DS_ENDERECO, 
	c.DS_BAIRRO, 
	substr(obter_desc_municipio_ibge(c.cd_municipio_ibge),1,255) ds_municipio, 
	c.SG_ESTADO, 
	obter_valor_dominio(7300,d.IE_TIPO_SOLICITACAO) ds_informacao, 
	e.nr_contrato, 
	'R' ie_tipo_movimentacao, 
	CASE WHEN b.nr_seq_titular IS NULL THEN 'T'  ELSE 'D' END  ie_titularidade, 
	e.nr_sequencia nr_seq_contrato 
from	pessoa_fisica		a, 
	pls_segurado		b, 
	compl_pessoa_fisica	c, 
	pls_segurado_solic_alt	d, 
	pls_contrato		e, 
	pls_segurado_carteira	f 
where	a.cd_pessoa_fisica	= b.cd_pessoa_fisica 
and	a.cd_pessoa_fisica	= c.cd_pessoa_fisica 
and	d.nr_seq_segurado	= b.nr_sequencia 
and	b.nr_seq_contrato	= e.nr_sequencia 
and	f.nr_seq_segurado	= b.nr_sequencia 
and	c.ie_tipo_complemento	= 1 
and	d.IE_ORIGEM_SOLICITACAO	= 'P';

