-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_saude_mulher_v (nr_sequencia, dt_atualizacao, nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec, cd_pessoa_fisica, nr_seq_area, nr_seq_microarea, nr_atendimento, ie_pac_gravida, ie_sexo, qt_atend_pre_natal, dt_referencia, qt_vacina, ds_area, qt_gravida, qt_gravida_regiao, qt_mulher, qt_total_atend_pre, qt_vacina_dia) AS select	a.NR_SEQUENCIA,a.DT_ATUALIZACAO,a.NM_USUARIO,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC,a.CD_PESSOA_FISICA,a.NR_SEQ_AREA,a.NR_SEQ_MICROAREA,a.NR_ATENDIMENTO,a.IE_PAC_GRAVIDA,a.IE_SEXO,a.QT_ATEND_PRE_NATAL,a.DT_REFERENCIA,a.QT_VACINA,
			substr(obter_desc_area_domicilio(nr_seq_area),1,255) ds_area,
			(select count(*) FROM eis_saude_mulher x where ie_pac_gravida = 'S') qt_gravida,
			(select count(*) from eis_saude_mulher x where ie_pac_gravida = 'S' and x.nr_seq_area = a.nr_seq_area) qt_gravida_regiao,
			(select count(*) from eis_saude_mulher x where x.ie_sexo = 'F' and x.nr_seq_area = a.nr_seq_area) qt_mulher,
			(select sum(qt_atend_pre_natal) from eis_saude_mulher x where x.nr_seq_area = a.nr_seq_area) qt_total_atend_pre,
			(select count(*) from eis_saude_mulher  x where x.qt_vacina = 0 and x.nr_seq_area = a.nr_seq_area) qt_vacina_dia
	from	eis_saude_mulher a;

