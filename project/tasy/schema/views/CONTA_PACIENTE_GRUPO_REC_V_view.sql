-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW conta_paciente_grupo_rec_v (cd_estabelecimento, nr_sequencia, nr_interno_conta, nr_atendimento, nr_seq_grupo_rec, cd_material, cd_procedimento, ie_origem_proced, dt_item, vl_item, vl_conta_fechada, vl_conta_aberta, cd_convenio, ie_clinica, dt_mesano_referencia, ie_tipo_atendimento) AS select	c.cd_estabelecimento,
	a.nr_sequencia,
	c.nr_interno_conta,
	c.nr_atendimento,
	a.nr_seq_grupo_rec,
	0 cd_material,
	a.cd_procedimento cd_procedimento,
	a.ie_origem_proced,
	a.dt_procedimento dt_item,
	a.vl_procedimento vl_item,
	CASE WHEN c.ie_status_acerto=2 THEN  a.vl_procedimento  ELSE 0 END  vl_conta_fechada,
	CASE WHEN c.ie_status_acerto=1 THEN  a.vl_procedimento  ELSE 0 END  vl_conta_aberta,
	c.cd_convenio_parametro cd_convenio,
	b.ie_clinica,
	c.dt_mesano_referencia,
	b.ie_tipo_atendimento
FROM	procedimento_paciente a,
	conta_paciente c,
	atendimento_paciente b
where	c.nr_interno_conta	= a.nr_interno_conta
and	c.nr_atendimento	= b.nr_atendimento

union all

select	c.cd_estabelecimento,
	a.nr_sequencia,
	c.nr_interno_conta,
	c.nr_atendimento,
	a.nr_seq_grupo_rec,
	a.cd_material,
	0 cd_procedimento,
	0 ie_origem_proced,
	a.dt_atendimento dt_item,
	a.vl_material vl_item,
	CASE WHEN c.ie_status_acerto=2 THEN  a.vl_material  ELSE 0 END  vl_conta_fechada,
	CASE WHEN c.ie_status_acerto=1 THEN  a.vl_material  ELSE 0 END  vl_conta_aberta,
	c.cd_convenio_parametro cd_convenio,
	b.ie_clinica,
	c.dt_mesano_referencia,
	b.ie_tipo_atendimento
from	material_atend_paciente a,
	conta_paciente c,
	atendimento_paciente b
where	c.nr_interno_conta	= a.nr_interno_conta
and	c.nr_atendimento	= b.nr_atendimento;

