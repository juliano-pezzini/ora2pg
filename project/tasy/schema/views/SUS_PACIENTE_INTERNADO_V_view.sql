-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW sus_paciente_internado_v (nr_atendimento, nr_atend_original, dt_entrada, cd_pessoa_fisica, cd_procedencia, ie_tipo_atendimento, ie_tipo_convenio, cd_medico_resp, dt_alta, cd_motivo_alta, ie_permite_visita, ie_clinica, dt_entrada_unidade, dt_saida_unidade, cd_setor_atendimento, cd_unidade_basica, cd_unidade_compl, ds_unidade, cd_tipo_acomod_unid, cd_convenio, cd_categoria, cd_usuario_convenio, cd_empresa, cd_tipo_acomod_conv, nr_doc_convenio, ds_setor_atendimento, ds_convenio, ds_categoria, nm_medico, nm_paciente, nr_prontuario, dt_nascimento, cd_religiao, cd_classif_setor, dt_previsto_alta, qt_dia_internacao, ie_carater_inter_sus, dt_alta_convenio, nr_seq_indicacao, cd_estabelecimento, nr_seq_tipo_acidente) AS SELECT /*+ ORDERED */    A.NR_ATENDIMENTO, 
	 A.NR_ATEND_ORIGINAL, 
    A.DT_ENTRADA, 
    A.CD_PESSOA_FISICA, 
    A.CD_PROCEDENCIA, 
    A.IE_TIPO_ATENDIMENTO, 
    A.IE_TIPO_CONVENIO, 
    A.CD_MEDICO_RESP, 
    A.DT_ALTA, 
	 A.CD_MOTIVO_ALTA, 
	 A.IE_PERMITE_VISITA, 
	 A.IE_CLINICA, 
    B.DT_ENTRADA_UNIDADE, 
    B.DT_SAIDA_UNIDADE, 
    B.CD_SETOR_ATENDIMENTO, 
    B.CD_UNIDADE_BASICA, 
    B.CD_UNIDADE_COMPL, 
   (B.CD_UNIDADE_BASICA || ' '|| B.CD_UNIDADE_COMPL) DS_UNIDADE, 
    B.CD_TIPO_ACOMODACAO CD_TIPO_ACOMOD_UNID, 
    C.CD_CONVENIO, 
    C.CD_CATEGORIA, 
    C.CD_USUARIO_CONVENIO, 
    C.CD_EMPRESA, 
    C.CD_TIPO_ACOMODACAO CD_TIPO_ACOMOD_CONV, 
    C.NR_DOC_CONVENIO, 
    S.DS_SETOR_ATENDIMENTO, 
    V.DS_CONVENIO, 
    T.DS_CATEGORIA, 
    M.NM_PESSOA_FISICA NM_MEDICO, 
    P.NM_PESSOA_FISICA NM_PACIENTE, 
    P.NR_PRONTUARIO, 
    P.DT_NASCIMENTO, 
    P.CD_RELIGIAO, 
    S.CD_CLASSIF_SETOR, 
 	 A.DT_PREVISTO_ALTA, 
	 C.QT_DIA_INTERNACAO, 
	A.IE_CARATER_INTER_SUS, 
	(A.DT_ENTRADA + QT_DIA_INTERNACAO) DT_ALTA_CONVENIO, 
	A.nr_seq_indicacao, 
	A.CD_ESTABELECIMENTO, 
	A.NR_SEQ_TIPO_ACIDENTE 
FROM  ATENDIMENTO_PACIENTE A, 
    ATEND_PACIENTE_UNIDADE B, 
    ATEND_CATEGORIA_CONVENIO C, 
    CATEGORIA_CONVENIO T, 
    SETOR_ATENDIMENTO S, 
    PESSOA_FISICA M, 
    PESSOA_FISICA P,    
    CONVENIO V 
WHERE (A.NR_ATENDIMENTO = B.NR_ATENDIMENTO) 
 AND (B.DT_ENTRADA_UNIDADE = 
	   (SELECT /*+ INDEX(X ATEPACU_I2) */ 
          MAX(X.DT_ENTRADA_UNIDADE) 
	    FROM SETOR_ATENDIMENTO Y, 
         ATEND_PACIENTE_UNIDADE X 
	    WHERE X.NR_ATENDIMENTO = A.NR_ATENDIMENTO 
        AND X.CD_SETOR_ATENDIMENTO = Y.CD_SETOR_ATENDIMENTO 
        AND Y.CD_CLASSIF_SETOR IN (3,4,8) 
        AND X.DT_ENTRADA_UNIDADE >= A.DT_ENTRADA)) 
 AND (A.NR_ATENDIMENTO = C.NR_ATENDIMENTO) 
 AND C.nr_SEQ_INTERNO = OBTER_ATECACO_ATENDIMENTO(A.NR_ATENDIMENTO) 
 AND (S.CD_CLASSIF_SETOR IN (3,4,8)) 
 AND (C.CD_CONVENIO      = V.CD_CONVENIO) 
 and (A.CD_MEDICO_RESP    = M.CD_PESSOA_FISICA) 
 AND (A.CD_PESSOA_FISICA   = P.CD_PESSOA_FISICA) 
 AND (C.CD_CONVENIO      = T.CD_CONVENIO) 
 AND (C.CD_CATEGORIA     = T.CD_CATEGORIA);

