-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW exame_laboratorio_v (ie_exame_pseudo, nr_seq_exame, nr_seq_superior, cd_exame, nm_exame, ie_solicitacao, cd_procedimento, ie_origem_proced, ds_procedimento, cd_barra_exame) AS select 	1 ie_exame_pseudo,
	a.nr_seq_exame,
       	a.nr_seq_superior,
       	a.cd_exame,
       	a.nm_exame,
	a.ie_solicitacao,
	a.cd_procedimento,
	a.ie_origem_proced,
       	b.ds_procedimento,
	'77' || to_char(a.nr_seq_exame, 'FM00000000') cd_barra_exame
FROM 	procedimento b,
	exame_laboratorio a
where a.cd_procedimento  = b.cd_procedimento
  and a.ie_origem_proced = b.ie_origem_proced
  and coalesce(a.ie_situacao,'A') = 'A'

union

select 	2 ie_exame_pseudo,
	a.nr_seq_exame,
	a.nr_seq_superior,
       	a.cd_exame,
       	c.ds_pseudo nm_exame,
	a.ie_solicitacao,
	a.cd_procedimento,
	a.ie_origem_proced,
       	b.ds_procedimento,
	'77' || to_char(a.nr_seq_exame, 'FM00000000') cd_barra_exame
from 	exame_laboratorio a,
     	procedimento b,
     	exame_lab_pseudo c
where 	a.nr_seq_exame     = c.nr_seq_exame
  and 	a.cd_procedimento  = b.cd_procedimento
  and 	a.ie_origem_proced = b.ie_origem_proced
  and        coalesce(a.ie_situacao,'A') = 'A'

union

select 	1 ie_exame_pseudo, /* Bruna - 18/12/2007 - OS76341, inclui tratamento para trazer de acordo com a regra do convÃªnio */
	a.nr_seq_exame,
       	a.nr_seq_superior,
       	a.cd_exame,
       	a.nm_exame,
	a.ie_solicitacao,
	c.cd_procedimento,
	c.ie_origem_proced,
       	b.ds_procedimento,
	'77' || to_char(a.nr_seq_exame, 'FM00000000') cd_barra_exame
from 	procedimento b,
	exame_lab_convenio c,
	exame_laboratorio a
where 	a.cd_procedimento  = b.cd_procedimento
  and 	a.nr_seq_exame = c.nr_seq_exame
  and 	a.ie_origem_proced = b.ie_origem_proced
  and coalesce(a.ie_situacao,'A') = 'A';

