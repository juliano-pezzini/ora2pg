-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW fis_efd_cad_registro_v (nivel, ds_registro_apres, nr_sequencia, cd_registro, ds_registro, nr_seq_apres, dt_atualizacao, nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec, nr_seq_reg_superior, ie_situacao, ie_tipo, ie_arquivo) AS WITH RECURSIVE cte AS (
select	1 nivel,(lpad(' ', 3* (1-1)) || ds_registro) ds_registro_apres,a.NR_SEQUENCIA,a.CD_REGISTRO,a.DS_REGISTRO,a.NR_SEQ_APRES,a.DT_ATUALIZACAO,a.NM_USUARIO,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC,a.NR_SEQ_REG_SUPERIOR,a.IE_SITUACAO,a.IE_TIPO,a.IE_ARQUIVO
FROM	fis_efd_cad_registro a WHERE a.nr_seq_reg_superior is null
  UNION ALL
select	(c.level+1) nivel,(lpad(' ', 3* ((c.level+1)-1)) || ds_registro) ds_registro_apres,a.NR_SEQUENCIA,a.CD_REGISTRO,a.DS_REGISTRO,a.NR_SEQ_APRES,a.DT_ATUALIZACAO,a.NM_USUARIO,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC,a.NR_SEQ_REG_SUPERIOR,a.IE_SITUACAO,a.IE_TIPO,a.IE_ARQUIVO
FROM	fis_efd_cad_registro a JOIN cte c ON (c.prior nr_sequencia = a.nr_seq_reg_superior)

) SELECT * FROM cte;


