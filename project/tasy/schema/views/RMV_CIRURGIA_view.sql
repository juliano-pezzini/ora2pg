-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW rmv_cirurgia (codcoligada, prontuario, paciente, codespecialidade, tipocirugia, tipoferida, datahorainicio, datahoratermino, asa, crmanestesista, tipoanestesia, codcirurgia, datainiciocirurgia, tempoferidaaberta, nmmedicoanestesista, nmmedicocirurgiao, dstipoanestesia, cdtipoanestesia, nmmedicocirurgiaaux) AS select	'1' codcoligada,
	substr(to_char(a.nr_prontuario),1,9) prontuario, 
	substr(a.nm_pessoa_fisica,1,50) paciente, 
	substr(to_char(OBTER_ESPECIALIDADE_MEDICO(b.cd_medico_cirurgiao,'C')),1,50) codespecialidade, 
	b.ie_carater_cirurgia tipocirugia, 
	substr(OBTER_DESCRICAO_PADRAO('CIH_TIPO_CIRURGIA','DS_TIPO_CIRURGIA',b.cd_tipo_cirurgia),1,1) tipoferida, 
	b.dt_inicio_prevista datahorainicio, 
	coalesce(b.dt_termino,b.dt_inicio_prevista) datahoratermino, 
	to_char(CASE WHEN b.ie_asa_estado_paciente='I' THEN 1 WHEN b.ie_asa_estado_paciente='II' THEN 2 WHEN b.ie_asa_estado_paciente='III' THEN 3 WHEN b.ie_asa_estado_paciente='IV' THEN 4 WHEN b.ie_asa_estado_paciente='V' THEN 5 WHEN b.ie_asa_estado_paciente='VI' THEN 6  ELSE null END ) asa, 
	substr(OBTER_CRM_MEDICO(b.cd_medico_anestesista),1,20) crmanestesista, 
	CASE WHEN substr(OBTER_VALOR_DOMINIO(36,b.cd_tipo_anestesia),1,1)='G' THEN 'G' WHEN substr(OBTER_VALOR_DOMINIO(36,b.cd_tipo_anestesia),1,1)='B' THEN 'B' WHEN substr(OBTER_VALOR_DOMINIO(36,b.cd_tipo_anestesia),1,1)='L' THEN 'L'  ELSE null END  tipoanestesia, 
	substr(to_char(b.nr_cirurgia),1,50) codcirurgia, 
	coalesce(b.dt_inicio_real,b.dt_inicio_prevista) datainiciocirurgia, 
	coalesce(b.dt_inicio_real,b.dt_inicio_prevista) - dt_termino tempoferidaaberta, 
	substr(obter_nome_medico(CD_MEDICO_ANESTESISTA,'N'),1,200) nmmedicoanestesista, 
	substr(obter_nome_medico(CD_MEDICO_CIRURGIAO,'N'),1,200) nmmedicocirurgiao, 
	substr(OBTER_VALOR_DOMINIO(36,b.cd_tipo_anestesia),1,80) dstipoanestesia, 
	b.cd_tipo_anestesia cdtipoanestesia, 
	substr(obter_nome_pf((	select max(cd_pessoa_fisica) 
				FROM  cirurgia_participante x, 
					funcao_medico y 
				where  x.ie_funcao = y.cd_funcao 
				and	y.ie_medico = 'S' 
				and  	y.ie_auxiliar = 'S' 
				and	x.nr_cirurgia = b.nr_cirurgia)),1,80) nmmedicocirurgiaaux 
from	pessoa_fisica a, 
	cirurgia b 
where	a.cd_pessoa_fisica = b.cd_pessoa_fisica;

