-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_carencia_sca_v (nr_seq_segurado, nr_seq_carencia, ds_carencia, qt_dias, dt_inicio_vigencia, dt_fim_vigencia, ds_plano, nr_seq_plano, nr_sequencia, ds_vinculo) AS select	a.nr_sequencia nr_seq_segurado,
	e.nr_sequencia nr_seq_carencia,
	e.ds_carencia,
	d.qt_dias,
	coalesce(d.dt_inicio_vigencia,b.dt_inicio_vigencia) dt_inicio_vigencia,
	CASE WHEN d.dt_fim_vigencia IS NULL THEN coalesce(d.dt_inicio_vigencia,b.dt_inicio_vigencia) + d.qt_dias  ELSE d.dt_fim_vigencia END  dt_fim_vigencia,
	c.ds_plano,
	c.nr_sequencia nr_seq_plano,
	d.nr_sequencia,
	'SCA' ds_vinculo
FROM	pls_segurado		a,
	pls_tipo_carencia	e,
	pls_carencia		d,
	pls_sca_vinculo		b,
	pls_plano		c
where	d.nr_seq_tipo_carencia	= e.nr_sequencia
and	b.nr_seq_segurado	= a.nr_sequencia
and	b.nr_seq_plano		= c.nr_sequencia
and	d.nr_seq_plano		= c.nr_sequencia
and	not exists (	select	1
				from	pls_carencia	x
				where	x.nr_seq_segurado		= a.nr_sequencia
				and	x.nr_seq_tipo_carencia		= e.nr_sequencia
				and	x.ie_origem_carencia_benef	= 'S')
/*aaschlote 29/04/2011 OS - 310688*/

union

select	a.nr_sequencia nr_seq_segurado,
	e.nr_sequencia nr_seq_carencia,
	e.ds_carencia,
	d.qt_dias,
	coalesce(d.dt_inicio_vigencia,b.dt_inicio_vigencia) dt_inicio_vigencia,
	CASE WHEN d.dt_fim_vigencia IS NULL THEN coalesce(d.dt_inicio_vigencia,b.dt_inicio_vigencia) + d.qt_dias  ELSE d.dt_fim_vigencia END  dt_fim_vigencia,
	c.ds_plano,
	c.nr_sequencia nr_seq_plano,
	d.nr_sequencia,
	'Benefici√°rio' ds_vinculo
from	pls_segurado		a,
	pls_sca_vinculo		b,
	pls_plano		c,
	pls_carencia		d,
	pls_tipo_carencia	e
where	b.nr_seq_segurado	= a.nr_sequencia
and	b.nr_seq_plano		= c.nr_sequencia
and	d.nr_seq_segurado	= a.nr_sequencia
and	d.nr_seq_tipo_carencia	= e.nr_sequencia
and	d.ie_origem_carencia_benef = 'S'
and     exists (	select	1
			from	pls_carencia    x
			where	x.nr_seq_plano   = c.nr_sequencia
			and	x.nr_seq_tipo_carencia  = d.nr_seq_tipo_carencia);

