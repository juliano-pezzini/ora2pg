-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW nota_interf_unimed_v (cd_cgc_emitente, nr_nota_fiscal, cd_serie_nf, cd_atividade, dt_emissao, vl_total_mercadoria, vl_total_nota, vl_deducao, ie_situacao, ie_subst_tribut, cpf_cnpj_solicitante, nm_solicitante, ds_cidade_solicitante, cd_operacao_nf) AS select	a.cd_cgc_emitente,
	a.nr_nota_fiscal,
	a.cd_serie_nf,
	5611 cd_atividade,
	a.dt_atualizacao_estoque dt_emissao,
	substr(campo_mascara(a.vl_mercadoria,2),1,20) vl_total_mercadoria,
	substr(campo_mascara(a.vl_total_nota,2),1,20) vl_total_nota,
	substr(campo_mascara(0,2),1,20) vl_deducao,
	CASE WHEN a.ie_situacao=1 THEN 'N'  ELSE 'C' END  ie_situacao,
	'N' ie_subst_tribut,
	' ' cpf_cnpj_solicitante,
	' ' nm_solicitante,
	';' ds_cidade_solicitante,
	a.cd_operacao_nf
FROM operacao_nota c, nota_fiscal a
LEFT OUTER JOIN conta_paciente b ON (a.nr_interno_conta = b.nr_interno_conta)
WHERE a.ie_situacao IN (1, 3, 9) and a.cd_operacao_nf   = c.cd_operacao_nf and a.dt_atualizacao_estoque is not null and c.ie_operacao_fiscal = 'S';

