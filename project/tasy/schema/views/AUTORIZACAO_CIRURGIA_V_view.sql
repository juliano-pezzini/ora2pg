-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW autorizacao_cirurgia_v (nr_sequencia, dt_atualizacao, nm_usuario, dt_pedido, nm_usuario_pedido, cd_requisitante, ds_justificativa, ds_observacao, nr_seq_agenda, nr_atendimento, dt_autorizacao, nm_autorizante, nm_usuario_autorizacao, cd_procedimento, ie_origem_proced, dt_previsao, ds_motivo_negativa, dt_liberacao, dt_fim_cotacao, nr_prescricao, nr_doc_convenio, cd_estabelecimento, cd_comprador, cd_senha, dt_liberacao_autor, nr_seq_agenda_consulta, ie_estagio_autor, nr_seq_autor_conv, nm_usuario_lib, dt_cancelamento, nm_usuario_cancel, cd_pessoa_fisica, nr_seq_classif, nr_seq_proc_interno, ds_convenio, nm_requisitante, nm_paciente, cd_usuario_convenio, cd_convenio, cd_pessoa_fisica_agenda, ds_sala, cd_usuario_conv, ds_observacao_agenda) AS select	a.NR_SEQUENCIA,a.DT_ATUALIZACAO,a.NM_USUARIO,a.DT_PEDIDO,a.NM_USUARIO_PEDIDO,a.CD_REQUISITANTE,a.DS_JUSTIFICATIVA,a.DS_OBSERVACAO,a.NR_SEQ_AGENDA,a.NR_ATENDIMENTO,a.DT_AUTORIZACAO,a.NM_AUTORIZANTE,a.NM_USUARIO_AUTORIZACAO,a.CD_PROCEDIMENTO,a.IE_ORIGEM_PROCED,a.DT_PREVISAO,a.DS_MOTIVO_NEGATIVA,a.DT_LIBERACAO,a.DT_FIM_COTACAO,a.NR_PRESCRICAO,a.NR_DOC_CONVENIO,a.CD_ESTABELECIMENTO,a.CD_COMPRADOR,a.CD_SENHA,a.DT_LIBERACAO_AUTOR,a.NR_SEQ_AGENDA_CONSULTA,a.IE_ESTAGIO_AUTOR,a.NR_SEQ_AUTOR_CONV,a.NM_USUARIO_LIB,a.DT_CANCELAMENTO,a.NM_USUARIO_CANCEL,a.CD_PESSOA_FISICA,a.NR_SEQ_CLASSIF,a.NR_SEQ_PROC_INTERNO,
	substr(obter_nome_convenio(b.cd_convenio),1,255) ds_convenio,
	substr(obter_nome_pessoa_fisica(a.cd_requisitante,null),1,255) nm_requisitante,
	substr(coalesce(b.nm_paciente, obter_nome_pessoa_fisica(b.cd_pessoa_fisica,null)),1,255) nm_paciente,
	b.cd_usuario_convenio,
	b.cd_convenio,
	b.cd_pessoa_fisica cd_pessoa_fisica_agenda,
	substr(Obter_Nome_Agenda(b.cd_agenda),1,150) ds_sala,
	substr(b.cd_usuario_convenio,1,150) cd_usuario_conv,
	substr(b.ds_observacao,1,255) ds_observacao_agenda
FROM 	agenda_paciente b,
	autorizacao_cirurgia a
where	a.nr_seq_agenda		= b.nr_sequencia
  and	a.nr_seq_agenda		is not null

union

select	a.NR_SEQUENCIA,a.DT_ATUALIZACAO,a.NM_USUARIO,a.DT_PEDIDO,a.NM_USUARIO_PEDIDO,a.CD_REQUISITANTE,a.DS_JUSTIFICATIVA,a.DS_OBSERVACAO,a.NR_SEQ_AGENDA,a.NR_ATENDIMENTO,a.DT_AUTORIZACAO,a.NM_AUTORIZANTE,a.NM_USUARIO_AUTORIZACAO,a.CD_PROCEDIMENTO,a.IE_ORIGEM_PROCED,a.DT_PREVISAO,a.DS_MOTIVO_NEGATIVA,a.DT_LIBERACAO,a.DT_FIM_COTACAO,a.NR_PRESCRICAO,a.NR_DOC_CONVENIO,a.CD_ESTABELECIMENTO,a.CD_COMPRADOR,a.CD_SENHA,a.DT_LIBERACAO_AUTOR,a.NR_SEQ_AGENDA_CONSULTA,a.IE_ESTAGIO_AUTOR,a.NR_SEQ_AUTOR_CONV,a.NM_USUARIO_LIB,a.DT_CANCELAMENTO,a.NM_USUARIO_CANCEL,a.CD_PESSOA_FISICA,a.NR_SEQ_CLASSIF,a.NR_SEQ_PROC_INTERNO,
	substr(obter_nome_convenio(obter_convenio_atendimento(b.nr_atendimento)),1,255) ds_convenio,
	substr(obter_nome_pessoa_fisica(a.cd_requisitante,null),1,255) nm_requisitante,
	substr(obter_nome_pessoa_fisica(b.cd_pessoa_fisica,null),1,255) nm_paciente,
	'0',
	obter_convenio_atendimento(b.nr_atendimento) cd_convenio,
	b.cd_pessoa_fisica cd_pessoa_fisica_agenda,
	null ds_sala,
	substr(obter_codigo_usuario_conv(a.nr_atendimento),1,150) cd_usuario_conv,
	null ds_observacao_agenda
from 	atendimento_paciente b,
	autorizacao_cirurgia a
where	a.nr_atendimento	= b.nr_atendimento
  and	a.nr_atendimento	is not null
  and  a.nr_seq_agenda	is null

union

select	a.NR_SEQUENCIA,a.DT_ATUALIZACAO,a.NM_USUARIO,a.DT_PEDIDO,a.NM_USUARIO_PEDIDO,a.CD_REQUISITANTE,a.DS_JUSTIFICATIVA,a.DS_OBSERVACAO,a.NR_SEQ_AGENDA,a.NR_ATENDIMENTO,a.DT_AUTORIZACAO,a.NM_AUTORIZANTE,a.NM_USUARIO_AUTORIZACAO,a.CD_PROCEDIMENTO,a.IE_ORIGEM_PROCED,a.DT_PREVISAO,a.DS_MOTIVO_NEGATIVA,a.DT_LIBERACAO,a.DT_FIM_COTACAO,a.NR_PRESCRICAO,a.NR_DOC_CONVENIO,a.CD_ESTABELECIMENTO,a.CD_COMPRADOR,a.CD_SENHA,a.DT_LIBERACAO_AUTOR,a.NR_SEQ_AGENDA_CONSULTA,a.IE_ESTAGIO_AUTOR,a.NR_SEQ_AUTOR_CONV,a.NM_USUARIO_LIB,a.DT_CANCELAMENTO,a.NM_USUARIO_CANCEL,a.CD_PESSOA_FISICA,a.NR_SEQ_CLASSIF,a.NR_SEQ_PROC_INTERNO,
	substr(obter_nome_convenio(Obter_dados_autor_convenio(a.nr_seq_autor_conv,'C')),1,255) ds_convenio,
	substr(obter_nome_pessoa_fisica(a.cd_requisitante,null),1,255) nm_requisitante,
	substr(obter_nome_pessoa_fisica(a.cd_pessoa_fisica,null),1,255) nm_paciente,
	'0',
	(coalesce(Obter_dados_autor_convenio(a.nr_seq_autor_conv,'C'),0))::numeric  cd_convenio,
	null cd_pessoa_fisica_agenda,
	null ds_sala,
	obter_dados_autor_cirurgia(a.nr_sequencia,'CU') cd_usuario_conv,
	null ds_observacao_agenda
from 	autorizacao_cirurgia a
where	a.cd_pessoa_fisica	is not null
and	a.nr_atendimento	is null
and 	a.nr_seq_agenda	is null;

