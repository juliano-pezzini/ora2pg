-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW muerte_fetal_validador_v (dt_obito, nr_atendimento_filho, nr_atendimento_mae, fetcausacom, fetcausa, fetcausa_desc, fettipcausa, fetcausab, fetcausab_desc, fetcausac, fetcausac_desc, fetcausad, fetcausad_desc, fetcausae, fetcausae_desc, fetcausaf, fetcausaf_desc, usuar_cre, fetfec_cre, usuar_mod, fetfec_mod, idtipohojacertificado, edo, cernombinfor, pro_apecertinf, pro_apemcertinf, defparentinfor, cercertifi, cercedcertifi, cernombcertifi, pro_apecertifi, pro_apemcertifi, cerdomcertifi, pro_certcol, pro_certloc, pro_certmun, pro_certent, pro_certtel, pro_certfirm, cerdia_def, cermes_def, cerano_def, fetfolio, prodsexo, prodedad, prodpeso, prodcantidad, prodatepren, pro_conrecib, prodtipemb, prodeffet, pro_estpiel, proddia, prodmes, prodanio, prodhora, prodmin, proddom_ocur, pro_domcol, prodloc_ocur, prodmpo_ocur, prodent_ocur, prodsitio, fethospit, pro_clues, prodatenmed, qt_abortos_esp, qt_abortos_prov, qt_abortos_terap, prodtippart, ie_parto_normal, ie_parto_cesaria, ie_parto_forceps, prod_otroexp, pro_cauviole, pro_parenagre, madnombre, madapepater, madapemater, pro_curpmadre, pro_nacmadre, pro_lindmadre, madedad, madedo_civ, maddom_hab, pro_madcol, madloc_hab, maddmpo_hab, madent_hab, madocupaci, pro_trabact, madnacvivos, madnacmuertos, madescolar, madderecho, madafiliac, madcondic, madcerdef, cd_pessoa_juridica, cd_pessoa_fisica, cd_pessoa_fisica_medico, cd_pessoa_fisica_mae, cd_cgc_convenio) AS SELECT	b.dt_obito, a.nr_atendimento NR_ATENDIMENTO_FILHO,
	a.nr_atendimento_mae NR_ATENDIMENTO_MAE,--901257
	b.cd_cid_direta FETCAUSACOM,
	coalesce(b.cd_cid_basica,b.cd_cid_direta) FETCAUSA,
	RPAD(coalesce(UPPER(obter_desc_cid(coalesce(b.cd_cid_basica,b.cd_cid_direta))),'NE'),100) FETCAUSA_DESC,
	coalesce(b.ie_tipo_mort_fetal,'0') FETTIPCAUSA,
	b.cd_cid_adic_1 FETCAUSAB,
	RPAD(coalesce(UPPER(obter_desc_cid(b.cd_cid_adic_1)),'NE'),100) FETCAUSAB_DESC,
	b.cd_cid_adic_2 FETCAUSAC,
	RPAD(coalesce(UPPER(obter_desc_cid(b.cd_cid_adic_2)),'NE'),100) FETCAUSAC_DESC,
	b.cd_cid_adic_3 FETCAUSAD,
	RPAD(coalesce(UPPER(obter_desc_cid(b.cd_cid_adic_3)),'NE'),100) FETCAUSAD_DESC,
	b.cd_cid_basica FETCAUSAE,
	RPAD(coalesce(UPPER(obter_desc_cid(b.cd_cid_basica)),'NE'),100) FETCAUSAE_DESC,
	b.cd_cid_adic_4 FETCAUSAF,
	RPAD(coalesce(UPPER(obter_desc_cid(b.cd_cid_adic_4)),'NE'),100) FETCAUSAF_DESC,
	coalesce(b.nm_usuario,'TASY') USUAR_CRE,
	coalesce(b.dt_atualizacao,LOCALTIMESTAMP) FETFEC_CRE,
	coalesce(b.nm_usuario,'TASY') USUAR_MOD,
	coalesce(b.dt_atualizacao,LOCALTIMESTAMP) FETFEC_MOD,
	coalesce(b.ie_tipo_certif_obt,'8') IDTIPOHOJACERTIFICADO,
	LPAD(coalesce(obter_dados_cat_clues(d.cd_internacional,'CD_ESTADO'),'99'),2,'0') EDO,--903851
	cpf.nm_contato CERNOMBINFOR,
	RPAD(coalesce(y.ds_component_name_1,'NO ESPECIFICADO'),30) PRO_APECERTINF,
	RPAD(coalesce(y.ds_family_name,'NO ESPECIFICADO'),30) PRO_APEMCERTINF,
	LPAD((SELECT x.cd_grau_parentesco_mx FROM cat_grau_parentesco x WHERE x.nr_sequencia = (SELECT p.cd_parentesco_mx FROM grau_parentesco p WHERE p.nr_sequencia = cpf.nr_seq_parentesco)),2,'0') DEFPARENTINFOR,
	coalesce(obter_dados_cat_cert_parto(b.ie_emissor,'CD_CERT_PARTO_MF'),'8') CERCERTIFI,
	RPAD(coalesce(medico.ds_codigo_prof,'0000000'),15) CERCEDCERTIFI,
	RPAD(coalesce(w.ds_given_name,'NO ESPECIFICADO'),30) CERNOMBCERTIFI,
	RPAD(coalesce(w.ds_family_name,'NO ESPECIFICADO'),30) PRO_APECERTIFI,
	RPAD(coalesce(w.ds_component_name_1,'NO ESPECIFICADO'),30) PRO_APEMCERTIFI,
	coalesce(UPPER(Elimina_Acentuacao(coalesce(get_info_end_endereco(medico_compl.nr_seq_pessoa_endereco,'RUA_VIALIDADE','D') || ' - ' || coalesce(get_info_end_endereco(medico_compl.nr_seq_pessoa_endereco,'NUMERO','D'),get_info_end_endereco(medico_compl.nr_seq_pessoa_endereco,'COMPLEMENTO','D')), medico_compl.ds_endereco ||' - ' || coalesce(medico_compl.nr_endereco, medico_compl.ds_compl_end)))),'NO ESPECIFICADO') CERDOMCERTIFI,
	coalesce(UPPER(Elimina_Acentuacao(coalesce(get_info_end_endereco(medico_compl.nr_seq_pessoa_endereco,'BAIRRO_VILA','D'), medico_compl.DS_BAIRRO))),'NO ESPECIFICADO') PRO_CERTCOL,
	coalesce(coalesce(get_info_end_endereco(cpf.nr_seq_pessoa_endereco,'LOCALIDADE','C'), obter_dados_cat_localidade(cpf.nr_seq_localizacao_mx,'CD_CAT_LOCALIDADE')),'9999') PRO_CERTLOC,
	coalesce(coalesce(get_info_end_endereco(cpf.nr_seq_pessoa_endereco,'MUNICIPIO','C'), obter_dados_cat_localidade(cpf.nr_seq_localizacao_mx,'CD_CAT_MUNICIPIO')),'999') PRO_CERTMUN,
	coalesce(coalesce(get_info_end_endereco(cpf.nr_seq_pessoa_endereco,'ESTADO_PROVINCI','C'), obter_dados_cat_localidade(cpf.nr_seq_localizacao_mx,'CD_EFE')),'99') PRO_CERTENT,
	medico_compl.nr_telefone PRO_CERTTEL,
	CASE WHEN b.dt_liberacao IS NULL THEN '2'  ELSE '1' END  PRO_CERTFIRM,
	coalesce(TO_CHAR(b.dt_liberacao,'dd'),'99') CERDIA_DEF,
	coalesce(TO_CHAR(b.dt_liberacao,'mm'),'99') CERMES_DEF,
	coalesce(TO_CHAR(b.dt_liberacao,'yyyy'),'9999') CERANO_DEF,--900083
	nasc.nr_dfm FETFOLIO,
	CASE WHEN coalesce(nasc.ie_sexo,'X')='F' THEN '2' WHEN coalesce(nasc.ie_sexo,'X')='M' THEN '1'  ELSE '0' END  PRODSEXO,
	LPAD(coalesce(coalesce(obter_idade_gest_parto(nasc.nr_atendimento),nasc.qt_sem_ig_total),'99'),2,'0') PRODEDAD,
	RPAD(coalesce(nasc.qt_peso_sala_parto,'9999'),4) PRODPESO,
	CASE WHEN coalesce(par.qt_feto,'1')='1' THEN '1' WHEN coalesce(par.qt_feto,'1')='2' THEN '2'  ELSE '3' END  PRODCANTIDAD,
	CASE WHEN coalesce(par.ie_pre_natal,'N')='S' THEN '1'  ELSE '2' END  PRODATEPREN,
	LPAD(coalesce(par.qt_consultas,'99'),2,'0') PRO_CONRECIB,
	CASE WHEN coalesce(coalesce(ag.ie_risco_gravidez,par.ie_risco_gestacao),'X')='N' THEN '1' WHEN coalesce(coalesce(ag.ie_risco_gravidez,par.ie_risco_gestacao),'X')='B' THEN '1'  ELSE '2' END  PRODTIPEMB,
	nasc.ie_tipo_nascimento PRODEFFET,
	CASE WHEN coalesce(ec.qt_textura_pele,'99')='0' THEN '1' WHEN coalesce(ec.qt_textura_pele,'99')='5' THEN '1' WHEN coalesce(ec.qt_textura_pele,'99')='10' THEN '1'  ELSE '2' END  PRO_ESTPIEL,
	TO_CHAR(coalesce(nasc.dt_nascimento,LOCALTIMESTAMP),'dd') PRODDIA,
	TO_CHAR(coalesce(nasc.dt_nascimento,LOCALTIMESTAMP),'mm') PRODMES,
	TO_CHAR(coalesce(nasc.dt_nascimento,LOCALTIMESTAMP),'yyyy') PRODANIO,
	TO_CHAR(coalesce(nasc.dt_nascimento,LOCALTIMESTAMP),'HH24') PRODHORA,
	TO_CHAR(coalesce(nasc.dt_nascimento,LOCALTIMESTAMP),'MI') PRODMIN,
	RPAD(UPPER(Elimina_Acentuacao(coalesce(d.ds_endereco||' - '||d.nr_endereco,'F8'))),50) PRODDOM_OCUR,
	RPAD(UPPER(Elimina_Acentuacao(coalesce(d.ds_bairro,'F8'))),50) PRO_DOMCOL,
	LPAD(coalesce(obter_dados_cat_clues(d.cd_internacional,'CD_LOCALIDADE'),'9999'),4,'0') PRODLOC_OCUR,
	LPAD(coalesce(obter_dados_cat_clues(d.cd_internacional,'CD_MUNICIPIO'),'999'),3,'0') PRODMPO_OCUR,
	LPAD(coalesce(obter_dados_cat_clues(d.cd_internacional,'CD_ESTADO'),'99'),2,'0') PRODENT_OCUR,
	coalesce(d.ie_tipo_inst_saude,'99') PRODSITIO,
	RPAD(coalesce(obter_dados_cat_clues(d.cd_internacional,'DS_ESTAB_SAUDE'),'NE'),150) FETHOSPIT,
	RPAD(coalesce(obter_dados_cat_clues(d.cd_internacional,'CD_CLUES'),'9999'),11) PRO_CLUES,
	coalesce(obter_dados_cat_prof_parto(par.nr_seq_prof_parto,'CD_ATEND_PARTO_MF'),'9') PRODATENMED,
	hsm.qt_abortos_esp,
	hsm.qt_abortos_prov,
	hsm.qt_abortos_terap,
	CASE WHEN(SELECT COUNT(1) FROM PARTO_EVENTOS z WHERE z.nr_atendimento = par.nr_atendimento)='0' THEN '1'  ELSE '2' END  PRODTIPPART,
	par.ie_parto_normal,
	par.ie_parto_cesaria,
	par.ie_parto_forceps,
	RPAD(Elimina_Acentuacao(nasc.ds_observacao),50) PROD_OTROEXP,
	CASE WHEN hsm.ie_parentesco_agressor IS NULL THEN '2'  ELSE '1' END  PRO_CAUVIOLE,
	coalesce(hsm.ie_parentesco_agressor,'88') PRO_PARENAGRE,--901222
	RPAD(coalesce(z.ds_given_name,'SE IGNORA'),40) MADNOMBRE,
	RPAD(coalesce(z.ds_family_name,'SE IGNORA'),20) MADAPEPATER,
	RPAD(coalesce(z.ds_component_name_1,'SE IGNORA'),20) MADAPEMATER,
	RPAD(coalesce(mae.cd_curp,'NO ESPECIFICADO'),18) PRO_CURPMADRE,
	CASE WHEN(SELECT coalesce(x.ie_brasileiro,'N') FROM nacionalidade x WHERE x.cd_nacionalidade = mae.cd_nacionalidade)='S' THEN '1'  ELSE '2' END  PRO_NACMADRE,
	CASE WHEN mae.nr_seq_lingua_indigena IS NULL THEN '2'  ELSE '1' END  PRO_LINDMADRE,
	LPAD(obter_idade(mae.dt_nascimento,LOCALTIMESTAMP,'A'),2,'0') MADEDAD,
	CASE WHEN coalesce(mae.ie_estado_civil,'9')='1' THEN '1' WHEN coalesce(mae.ie_estado_civil,'9')='2' THEN '5' WHEN coalesce(mae.ie_estado_civil,'9')='3' THEN '3' WHEN coalesce(mae.ie_estado_civil,'9')='4' THEN '6' WHEN coalesce(mae.ie_estado_civil,'9')='5' THEN '2' WHEN coalesce(mae.ie_estado_civil,'9')='6' THEN '6' WHEN coalesce(mae.ie_estado_civil,'9')='7' THEN '4'  ELSE '9' END  MADEDO_CIV,
	cpfm.nr_endereco MADDOM_HAB,
	cpfm.ds_bairro PRO_MADCOL,
	RPAD(coalesce(obter_dados_cat_localidade(cpfm.nr_seq_localizacao_mx,'CD_CAT_LOCALIDADE'),'9999'),4) MADLOC_HAB,
	RPAD(coalesce(obter_dados_cat_localidade(cpfm.nr_seq_localizacao_mx,'CD_CAT_MUNICIPIO'),'999'),3) MADDMPO_HAB,
	RPAD(coalesce(obter_dados_cat_localidade(cpfm.nr_seq_localizacao_mx,'CD_EFE'),'99'),2) MADENT_HAB,
	RPAD(coalesce((SELECT coalesce(w.cd_externo,'99') FROM cargo w WHERE w.cd_cargo = mae.cd_cargo),'0'),2) MADOCUPACI,
	CASE WHEN mae.cd_cargo IS NULL THEN '9'  ELSE '1' END  PRO_TRABACT,
	LPAD(coalesce(par.qt_filhos_vivos,'00'),2,'0') MADNACVIVOS,
	LPAD(coalesce(par.qt_natimortos,'00'),2,'0') MADNACMUERTOS,
	coalesce(CASE WHEN mae.ie_grau_instrucao='1' THEN '01' WHEN mae.ie_grau_instrucao='2' THEN '02' WHEN mae.ie_grau_instrucao='3' THEN '05' WHEN mae.ie_grau_instrucao='4' THEN '06' WHEN mae.ie_grau_instrucao='5' THEN '10' WHEN mae.ie_grau_instrucao='6' THEN '10' WHEN mae.ie_grau_instrucao='7' THEN '02' WHEN mae.ie_grau_instrucao='8' THEN '04' WHEN mae.ie_grau_instrucao='9' THEN '11' WHEN mae.ie_grau_instrucao='10' THEN '12' WHEN mae.ie_grau_instrucao='11' THEN '01' WHEN mae.ie_grau_instrucao='12' THEN '10' WHEN mae.ie_grau_instrucao='13' THEN '10' WHEN mae.ie_grau_instrucao='14' THEN '00' WHEN mae.ie_grau_instrucao='15' THEN '07'  ELSE '99' END ,'99') MADESCOLAR,
	RPAD(coalesce(obter_dados_cat_derecho(co.cd_tipo_convenio_mx,'CD_DER_FETAL'),'99'),2) MADDERECHO,
	RPAD(coalesce(mae.nr_spss,'000000000'),18) MADAFILIAC,
	CASE WHEN dom.nr_declaracao IS NULL THEN '1'  ELSE '2' END  MADCONDIC,
	coalesce(dom.nr_declaracao,'000000000') MADCERDEF,
	d.cd_cgc CD_PESSOA_JURIDICA,
	cpf.CD_PESSOA_FISICA CD_PESSOA_FISICA,
	medico.CD_PESSOA_FISICA CD_PESSOA_FISICA_MEDICO,
	mae.CD_PESSOA_FISICA cd_pessoa_fisica_mae,
	OBTER_DESC_CONVENIO(CO.CD_CONVENIO) CD_CGC_CONVENIO
FROM pessoa_juridica d, compl_pessoa_fisica cpfm, estabelecimento c, declaracao_obito b, atendimento_paciente a, atendimento_paciente am
LEFT OUTER JOIN nascimento nasc ON (am.nr_atendimento = nasc.nr_atendimento)
LEFT OUTER JOIN parto par ON (am.nr_atendimento = par.nr_atendimento)
LEFT OUTER JOIN atendimento_gravidez ag ON (am.nr_atendimento = ag.nr_atendimento)
LEFT OUTER JOIN escala_capurro ec ON (am.nr_atendimento = ec.nr_atendimento)
LEFT OUTER JOIN historico_saude_mulher hsm ON (am.cd_pessoa_fisica = hsm.cd_pessoa_fisica)
LEFT OUTER JOIN atend_categoria_convenio acc ON (am.nr_atendimento = acc.nr_atendimento)
LEFT OUTER JOIN declaracao_obito dom ON (am.nr_atendimento = dom.nr_atendimento)
LEFT OUTER JOIN convenio co ON (acc.cd_convenio = co.cd_convenio)
, pessoa_fisica pf
LEFT OUTER JOIN compl_pessoa_fisica cpf ON (pf.cd_pessoa_fisica = cpf.cd_pessoa_fisica)
LEFT OUTER JOIN person_name y ON (pf.nr_seq_person_name = y.nr_sequencia AND 'main' = y.ds_type)
, pessoa_fisica medico
LEFT OUTER JOIN compl_pessoa_fisica medico_compl ON (medico.cd_pessoa_fisica = medico_compl.cd_pessoa_fisica AND 2 = medico_compl.ie_tipo_complemento)
LEFT OUTER JOIN person_name w ON (medico.nr_seq_person_name = w.nr_sequencia AND 'main' = w.ds_type)
, pessoa_fisica mae
LEFT OUTER JOIN person_name z ON (mae.nr_seq_person_name = z.nr_sequencia AND 'main' = z.ds_type)
WHERE a.nr_atendimento_mae 	IS NOT NULL AND a.nr_atendimento	= b.nr_atendimento AND b.ie_situacao		= 'A' AND a.cd_estabelecimento	= c.cd_estabelecimento AND c.cd_cgc 		= d.cd_cgc AND a.cd_pessoa_fisica		= pf.cd_pessoa_fisica  AND cpf.ie_tipo_complemento 		= 3  AND b.cd_medico			= medico.cd_pessoa_fisica    AND a.nr_atendimento_mae = am.nr_atendimento     AND am.cd_pessoa_fisica = mae.cd_pessoa_fisica  AND mae.cd_pessoa_fisica 	= cpfm.cd_pessoa_fisica AND cpfm.ie_tipo_complemento 	= 1;

