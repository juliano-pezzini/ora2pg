-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_prestador_mat_v (nr_prioridade, nr_seq_material, ie_liberado, nr_seq_prestador, nr_seq_prest_fornec, ie_tipo_atendimento, dt_inicio_vigencia, dt_fim_vigencia, nr_seq_tipo_prestador, nr_seq_estrutura, nr_seq_grupo_material, nr_seq_fornecedor) AS select	0			nr_prioridade,
	b.nr_sequencia		nr_seq_material,
	a.ie_liberar		ie_liberado,
	a.nr_seq_prestador	nr_seq_prestador,
	a.nr_seq_prest_fornec	nr_seq_prest_fornec,
	-- Tratar o campo ie_iternado da regra para que os valores sejam compatíveis com o tipo de atendimento
	-- da conta, Se for N (Ambos) retorna T (Todos), se for A(Ambulatorial) retorna A(Ambulatorial) e se for S(Internado) retorna I(Internado)
	CASE WHEN a.ie_internado='N' THEN  'T' WHEN a.ie_internado='A' THEN  'A' WHEN a.ie_internado='S' THEN  'I' END  	ie_tipo_atendimento,
	a.dt_inicio_vigencia	dt_inicio_vigencia,
	a.dt_fim_vigencia	dt_fim_vigencia,
	a.nr_seq_tipo_prestador	nr_seq_tipo_prestador,
	null			nr_seq_estrutura,
	null			nr_seq_grupo_material,
	null			nr_seq_fornecedor
FROM	pls_prestador_mat	a,
	pls_material		b
where	a.nr_seq_material	is null
and	a.nr_seq_fornec_mat	is null
and	a.nr_seq_grupo_material	is null
and	a.nr_seq_estrutura_mat	is null

union all

select	1			nr_prioridade,
	b.nr_seq_material	nr_seq_material,
	a.ie_liberar		ie_liberado,
	a.nr_seq_prestador	nr_seq_prestador,
	a.nr_seq_prest_fornec	nr_seq_prest_fornec,
	-- Tratar o campo ie_iternado da regra para que os valores sejam compatíveis com o tipo de atendimento
	-- da conta, Se for N (Ambos) retorna T (Todos), se for A(Ambulatorial) retorna A(Ambulatorial) e se for S(Internado) retorna I(Internado)
	CASE WHEN a.ie_internado='N' THEN  'T' WHEN a.ie_internado='A' THEN  'A' WHEN a.ie_internado='S' THEN  'I' END  	ie_tipo_atendimento,
	a.dt_inicio_vigencia	dt_inicio_vigencia,
	a.dt_fim_vigencia	dt_fim_vigencia,
	a.nr_seq_tipo_prestador	nr_seq_tipo_prestador,
	null			nr_seq_estrutura,
	null			nr_seq_grupo_material,
	a.nr_seq_fornec_mat	nr_seq_fornecedor
from	pls_prestador_mat	a,
	pls_material_fornec	b
where	a.nr_seq_fornec_mat	is not null
and	b.nr_seq_fornecedor	= a.nr_seq_fornec_mat

union all

select	2			nr_prioridade,
	b.nr_seq_material	nr_seq_material,
	a.ie_liberar		ie_liberado,
	a.nr_seq_prestador	nr_seq_prestador,
	a.nr_seq_prest_fornec	nr_seq_prest_fornec,
	-- Tratar o campo ie_iternado da regra para que os valores sejam compatíveis com o tipo de atendimento
	-- da conta, Se for N (Ambos) retorna T (Todos), se for A(Ambulatorial) retorna A(Ambulatorial) e se for S(Internado) retorna I(Internado)
	CASE WHEN a.ie_internado='N' THEN  'T' WHEN a.ie_internado='A' THEN  'A' WHEN a.ie_internado='S' THEN  'I' END  	ie_tipo_atendimento,
	a.dt_inicio_vigencia	dt_inicio_vigencia,
	a.dt_fim_vigencia	dt_fim_vigencia,
	a.nr_seq_tipo_prestador	nr_seq_tipo_prestador,
	b.nr_seq_estrut_mat	nr_seq_estrutura,
	null			nr_seq_grupo_material,
	null			nr_seq_fornecedor
from	pls_prestador_mat		a,
	pls_estrutura_material_tm	b
where	a.nr_seq_estrutura_mat	is not null
and	b.nr_seq_estrutura	= a.nr_seq_estrutura_mat

union all

select	3			nr_prioridade,
	b.nr_seq_material	nr_seq_material,
	a.ie_liberar		ie_liberado,
	a.nr_seq_prestador	nr_seq_prestador,
	a.nr_seq_prest_fornec	nr_seq_prest_fornec,
	-- Tratar o campo ie_iternado da regra para que os valores sejam compatíveis com o tipo de atendimento
	-- da conta, Se for N (Ambos) retorna T (Todos), se for A(Ambulatorial) retorna A(Ambulatorial) e se for S(Internado) retorna I(Internado)
	CASE WHEN a.ie_internado='N' THEN  'T' WHEN a.ie_internado='A' THEN  'A' WHEN a.ie_internado='S' THEN  'I' END  	ie_tipo_atendimento,
	a.dt_inicio_vigencia	dt_inicio_vigencia,
	a.dt_fim_vigencia	dt_fim_vigencia,
	a.nr_seq_tipo_prestador	nr_seq_tipo_prestador,
	null			nr_seq_estrutura,
	a.nr_seq_grupo_material	nr_seq_grupo_material,
	null			nr_seq_fornecedor
from	pls_prestador_mat	a,
	pls_preco_material	b
where	a.nr_seq_grupo_material	is not null
and	b.nr_seq_grupo		= a.nr_seq_grupo_material

union all

select	4			nr_prioridade,
	a.nr_seq_material	nr_seq_material,
	a.ie_liberar		ie_liberado,
	a.nr_seq_prestador	nr_seq_prestador,
	a.nr_seq_prest_fornec	nr_seq_prest_fornec,
	-- Tratar o campo ie_iternado da regra para que os valores sejam compatíveis com o tipo de atendimento
	-- da conta, Se for N (Ambos) retorna T (Todos), se for A(Ambulatorial) retorna A(Ambulatorial) e se for S(Internado) retorna I(Internado)
	CASE WHEN a.ie_internado='N' THEN  'T' WHEN a.ie_internado='A' THEN  'A' WHEN a.ie_internado='S' THEN  'I' END  	ie_tipo_atendimento,
	a.dt_inicio_vigencia	dt_inicio_vigencia,
	a.dt_fim_vigencia	dt_fim_vigencia,
	a.nr_seq_tipo_prestador	nr_seq_tipo_prestador,
	null			nr_seq_estrutura,
	null			nr_seq_grupo_material,
	null			nr_seq_fornecedor
from	pls_prestador_mat	a
where	a.nr_seq_material	is not null;

