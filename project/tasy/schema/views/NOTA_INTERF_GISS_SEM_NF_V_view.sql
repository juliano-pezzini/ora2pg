-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW nota_interf_giss_sem_nf_v (nr_titulo, dt_emissao, cd_tipo_documento, vl_documento, ie_pf_pj, ie_prestador_municipio, ds_razao_social, nr_inscricao_municipal, cd_cpf_cnpj, ie_prestador_isento, nr_inscricao_estadual, cd_cep, ds_tipo_logradouro, ds_titulo_logradouro, ds_endereco, ds_complemento, nr_endereco, ds_bairro, sg_estado, ds_municipio, ds_local_prest_servico, cd_atividade_serv, cd_estabelecimento) AS select	t.nr_titulo,
	t.dt_emissao, 
	'N'			cd_tipo_documento, 
	t.vl_titulo			vl_documento, 
	CASE WHEN coalesce(t.cd_pessoa_fisica,'0')='0' THEN '2'  ELSE '1' END  ie_pf_pj,	 
	'S' ie_prestador_municipio, 
	substr(obter_nome_pf_pj(t.cd_pessoa_fisica, t.cd_cgc),1,80) ds_razao_social, 
	somente_numero(coalesce(substr(obter_dados_pf_pj(t.cd_pessoa_fisica, t.cd_cgc, 'IM'),1,20), '00000000000000000000')) nr_inscricao_municipal, 
	coalesce(t.cd_pessoa_fisica, t.cd_cgc) cd_cpf_cnpj, 
	'S' ie_prestador_isento, 
	somente_numero(coalesce(substr(obter_dados_pf_pj(t.cd_pessoa_fisica, t.cd_cgc, 'IE'),1,20), '00000000000000000000')) nr_inscricao_estadual, 
	substr(somente_numero(obter_dados_pf_pj(t.cd_pessoa_fisica, t.cd_cgc, 'CEP')),1,8) cd_cep, 
	' ' ds_tipo_logradouro, 
	' ' ds_titulo_logradouro, 
	substr(obter_dados_pf_pj(t.cd_pessoa_fisica, t.cd_cgc, 'EN'),1,50) ds_endereco, 
	substr(obter_dados_pf_pj(t.cd_pessoa_fisica, t.cd_cgc, 'CO'),1,40) ds_complemento, 
	substr(obter_dados_pf_pj(t.cd_pessoa_fisica, t.cd_cgc, 'NR'),1,10) nr_endereco, 
	substr(obter_dados_pf_pj(t.cd_pessoa_fisica, t.cd_cgc, 'B'),1,50) ds_bairro, 
	substr(obter_dados_pf_pj(t.cd_pessoa_fisica, t.cd_cgc, 'UF'),1,2) sg_estado, 
	substr(obter_dados_pf_pj(t.cd_pessoa_fisica, t.cd_cgc, 'CI'),1,50) ds_municipio, 
	'D' ds_local_prest_servico, 
	403 cd_atividade_serv, 
	t.cd_estabelecimento 
FROM	repasse_terceiro a, 
	repasse_terceiro_venc b, 
	titulo_pagar t 
where	a.nr_repasse_terceiro 	= b.nr_repasse_terceiro 
and	b.nr_titulo			= t.nr_titulo;

