-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_conta_proc_ocor_v (cd_area_procedimento, cd_especialidade, ie_tipo_conta, nr_seq_prestador_exec, nr_seq_prestador_exec_imp, nr_seq_segurado, cd_medico_executor, cd_medico_executor_imp, cd_guia_referencia, cd_guia_solic_imp, cd_guia_imp, cd_guia_prestador, cd_grupo_proc, cd_procedimento, cd_procedimento_imp, dt_dia_semana, dt_dia_semana_imp, dt_fim_proc, dt_fim_proc_imp, dt_inicio_proc, dt_inicio_proc_imp, dt_fim_proc_sem_format, dt_fim_proc_imp_sem_format, dt_inicio_proc_sem_format, dt_inicio_proc_imp_sem_format, dt_procedimento, dt_procedimento_hh, dt_procedimento_min, dt_procedimento_imp, dt_procedimento_imp_trunc, dt_procedimento_imp_hh, dt_procedimento_imp_min, dt_procedimento_trunc, hr_fim_proc, hr_fim_proc_imp, hr_inicio_proc, hr_inicio_proc_imp, ie_origem_proced, ie_tipo_despesa, ie_tipo_despesa_imp, nr_seq_conta, nr_seq_grupo_rec, nr_sequencia, nr_seq_conta_proc, nr_auxiliares, vl_procedimento, vl_procedimento_imp, nr_seq_preco_pacote, ie_origem_conta, vl_calc_co_util, vl_calc_hi_util, vl_calc_mat_util, vl_procedimento_ptu_imp, vl_material_ptu_imp, vl_co_ptu_imp, ie_coparticipacao, qt_procedimento_imp, qt_procedimento, ie_co_preco_operadora, vl_custo_operacional, ie_status, nr_seq_proc_ref, nr_seq_regra, nr_seq_regra_valor, vl_materiais, vl_total_partic, nr_seq_honorario_crit, nr_seq_hon_crit_medico, nr_seq_regra_vinculo, vl_liberado, tx_intercambio, tx_intercambio_imp, nr_seq_participante_hi, vl_ok, qt_ok, cd_congenere, nr_fatura, nr_nota_cobranca, nr_seq_congenere, nr_seq_fatura, dt_atendimento_conta, dt_postagem_fatura, dt_recebimento_fatura, dt_atendimento_imp, cd_cooperativa, ie_tipo_intercambio, nr_seq_guia, nr_seq_regra_tx_inter, ie_status_guia, nr_seq_prestador_exec_imp_ref, ie_via_acesso, ie_via_acesso_imp, dt_procedimento_real, dt_procedimento_real_trunc, dt_procedimento_real_hh, dt_procedimento_real_min, cd_estabelecimento, nr_seq_lote_conta, nr_seq_protocolo, ie_apresentacao, ie_tipo_guia, ie_regime_internacao, ie_regime_internacao_imp, ie_tipo_internado, ie_carater_internacao, ie_carater_internacao_imp, ie_tipo_consulta, ie_tipo_consulta_imp, nr_seq_saida_int, nr_seq_clinica, nr_seq_clinica_imp, ie_internacao_obstetrica, ie_internado, ie_internado_imp, ie_vinc_internado, nr_seq_tipo_acomodacao, nr_seq_tipo_acomod_imp, nr_seq_tipo_atend_imp, nr_seq_tipo_atendimento, nr_seq_prestador_imp, nr_seq_prestador_conta, nr_seq_prestador_imp_prot, nr_seq_prestador_prot, cd_medico_solicitante_imp, cd_medico_solicitante, nr_seq_conselho_solic, nr_seq_grau_partic_conta, nr_seq_conselho_exec, nr_seq_prestador_pgto, nr_seq_prest_pgto_medico, cd_cid_principal_conta, cd_cid_principal_conta_imp, cd_cat_cid_principal_conta, cd_cat_cid_principal_conta_imp, nr_seq_cbo_saude, nr_seq_cbo_saude_imp, nr_seq_nota_cobranca, ie_indicador_dorn, ie_indicador_dorn_imp, ie_via_obrigatoria, nr_seq_regra_via_acesso, ie_acao_analise, vl_taxa_servico_imp, vl_taxa_servico, vl_taxa_co, vl_taxa_co_imp, vl_taxa_material, vl_taxa_material_imp, nr_seq_analise, vl_co_ok, vl_hi_ok, vl_material_ok, vl_tx_co_ok, vl_tx_hi_ok, vl_tx_material_ok, vl_total_sem_taxa_int, vl_total_sem_taxa_int_imp, nr_seq_plano, cd_prestador_prot, cd_prestador_exec, cd_prestador_prot_imp, cd_prestador_exec_imp, nr_seq_tipo_prest_prot, nr_seq_tipo_prest_exec, nr_seq_tipo_prest_exec_imp, nr_seq_tipo_prest_prot_imp, cd_versao_tiss, ie_recem_nascido_imp, ie_recem_nascido, ie_alto_custo, nr_seq_guia_proc, ie_status_guia_proc, ie_pacote_ptu, ie_glosa, nr_seq_grau_partic_imp, tp_rede_min, nr_seq_prest_inter, ie_tipo_faturamento_imp, ie_situacao_protocolo, nr_seq_cbo_saude_solic, cd_guia_ref, cd_guia, ie_guia_fisica, ie_tipo_faturamento, cd_pessoa_fisica_prest, nr_seq_grau_part_participantes, nr_seq_prestador_exec_princ, ie_regime_atendimento, ie_saude_ocupacional, sg_cons_prof_prest_nota_serv, nr_cons_prof_prest_nota_serv, sg_uf_cons_prest_nota_serv, cd_prest_nota_serv) AS select	a.cd_area_procedimento,
	a.cd_especialidade,
	a.ie_tipo_conta,
	a.nr_seq_prestador_exec,
	a.nr_seq_prestador_exec_imp,
	a.nr_seq_segurado,
	a.cd_medico_executor,
	a.cd_medico_executor_imp,
	a.cd_guia_referencia,
	a.cd_guia_solic_imp,
	a.cd_guia_imp,
	a.cd_guia_prestador,
	a.cd_grupo_proc,
	a.cd_procedimento,
	a.cd_procedimento_imp,
	a.dt_dia_semana,
	a.dt_dia_semana_imp,
	a.dt_fim_proc,
	a.dt_fim_proc_imp,
	a.dt_inicio_proc,
	a.dt_inicio_proc_imp,
	a.dt_fim_proc_sem_format,
	a.dt_fim_proc_imp_sem_format,
	a.dt_inicio_proc_sem_format,
	a.dt_inicio_proc_imp_sem_format,
	a.dt_procedimento,
	a.dt_procedimento_hh,
	a.dt_procedimento_min,
	a.dt_procedimento_imp,
	a.dt_procedimento_imp_trunc,
	a.dt_procedimento_imp_hh,
	a.dt_procedimento_imp_min,
	a.dt_procedimento_trunc,
	a.hr_fim_proc,
	a.hr_fim_proc_imp,
	a.hr_inicio_proc,
	a.hr_inicio_proc_imp,
	a.ie_origem_proced,
	a.ie_tipo_despesa,
	a.ie_tipo_despesa_imp,
	a.nr_seq_conta,
	a.nr_seq_grupo_rec,
	a.nr_sequencia,
	a.nr_sequencia nr_seq_conta_proc,
	a.nr_auxiliares,
	a.vl_procedimento,
	a.vl_procedimento_imp,
	a.nr_seq_preco_pacote,
	a.ie_origem_conta,
	a.vl_calc_co_util,
	a.vl_calc_hi_util,
	a.vl_calc_mat_util,
	a.vl_procedimento_ptu_imp,
	a.vl_material_ptu_imp,
	a.vl_co_ptu_imp,
	a.ie_coparticipacao,
	a.qt_procedimento_imp,
	a.qt_procedimento,
	a.ie_co_preco_operadora,
	a.vl_custo_operacional,
	a.ie_status,
	a.nr_seq_proc_ref,
	a.nr_seq_regra,
	a.nr_seq_regra_valor,
	a.vl_materiais,
	a.vl_total_partic,
	a.nr_seq_honorario_crit,
	a.nr_seq_hon_crit_medico,
	a.nr_seq_regra_vinculo,
	a.vl_liberado,
	a.tx_intercambio,
	a.tx_intercambio_imp,
	a.nr_seq_participante_hi,
	a.vl_ok,
	a.qt_ok,
	a.cd_congenere,
	a.nr_fatura,
	a.nr_nota_cobranca,
	a.nr_seq_congenere,
	a.nr_seq_fatura,
	a.dt_atendimento_conta,
	a.dt_postagem_fatura,
	a.dt_recebimento_fatura,
	a.dt_atendimento_imp,
	a.cd_cooperativa,
	a.ie_tipo_intercambio,
	a.nr_seq_guia,
	a.nr_seq_regra_tx_inter,
	a.ie_status_guia,
	a.nr_seq_prestador_exec_imp_ref,
	a.ie_via_acesso,
	a.ie_via_acesso_imp,
	a.dt_procedimento_real,
	trunc(a.dt_procedimento_real,'dd') dt_procedimento_real_trunc,
	trunc(a.dt_procedimento_real, 'hh') dt_procedimento_real_hh,
	trunc(a.dt_procedimento_real, 'mi') dt_procedimento_real_min,
	a.cd_estabelecimento,
	a.nr_seq_lote_conta,
	a.nr_seq_protocolo,
	a.ie_apresentacao,
	a.ie_tipo_guia,
	a.ie_regime_internacao,
	a.ie_regime_internacao_imp,
	a.ie_tipo_internado,
	a.ie_carater_internacao,
	a.ie_carater_internacao_imp,
	a.ie_tipo_consulta,
	a.ie_tipo_consulta_imp,
	a.nr_seq_saida_int,
	a.nr_seq_clinica,
	a.nr_seq_clinica_imp,
	a.ie_internacao_obstetrica,
	a.ie_internado,
	a.ie_internado_imp,
	a.ie_vinc_internado,
	a.nr_seq_tipo_acomodacao,
	a.nr_seq_tipo_acomod_imp,
	a.nr_seq_tipo_atend_imp,
	a.nr_seq_tipo_atendimento,
	a.nr_seq_prestador_imp,
	a.nr_seq_prestador_conta,
	a.nr_seq_prestador_imp_prot,
	a.nr_seq_prestador_prot,
	a.cd_medico_solicitante_imp,
	a.cd_medico_solicitante,
	a.nr_seq_conselho_solic,
	a.nr_seq_grau_partic_conta,
	a.nr_seq_conselho_exec,
	a.nr_seq_prestador_pgto,
	a.nr_seq_prest_pgto_medico,
	a.cd_cid_principal_conta,
	a.cd_cid_principal_conta_imp,
	a.cd_cat_cid_principal_conta,
	a.cd_cat_cid_principal_conta_imp,
	a.nr_seq_cbo_saude,
	a.nr_seq_cbo_saude_imp,
	a.nr_seq_nota_cobranca,
	a.ie_indicador_dorn,
	a.ie_indicador_dorn_imp,
	a.ie_via_obrigatoria,
	a.nr_seq_regra_via_acesso,
	a.ie_acao_analise,
	a.vl_taxa_servico_imp,
	a.vl_taxa_servico,
	a.vl_taxa_co,
	a.vl_taxa_co_imp,
	a.vl_taxa_material,
	a.vl_taxa_material_imp,
	a.nr_seq_analise,
	a.vl_co_ok,
	a.vl_hi_ok,
	a.vl_material_ok,
	a.vl_tx_co_ok,
	a.vl_tx_hi_ok,
	a.vl_tx_material_ok,
	a.vl_total_sem_taxa_int,
	a.vl_total_sem_taxa_int_imp,
	a.nr_seq_plano_conta nr_seq_plano,
	a.cd_prestador_prot,
	a.cd_prestador_exec,
	a.cd_prestador_prot_imp,
	a.cd_prestador_exec_imp,
	a.nr_seq_tipo_prest_prot,
	a.nr_seq_tipo_prest_exec,
	a.nr_seq_tipo_prest_exec_imp,
	a.nr_seq_tipo_prest_prot_imp,
	a.cd_versao_tiss,
	a.ie_recem_nascido_imp,
	a.ie_recem_nascido,
	a.ie_alto_custo,
	a.nr_seq_guia_proc,
	a.ie_status_guia_proc,
	a.ie_pacote_ptu,
	a.ie_glosa,
	pls_obter_dados_gerar_conta(a.nr_seq_conta, 'G') nr_seq_grau_partic_imp,
	a.tp_rede_min,
	a.nr_seq_prest_inter,
	a.ie_tipo_faturamento_imp,
	a.ie_situacao_protocolo,
	a.nr_seq_cbo_saude_solic,
	a.cd_guia_ref,
	a.cd_guia,
	a.ie_guia_fisica,
	a.ie_tipo_faturamento,
	a.cd_pessoa_fisica_prest,
	(select max(nr_seq_grau_partic) FROM pls_proc_participante x where nr_seq_conta_proc = a.nr_sequencia) nr_seq_grau_part_participantes,
	a.nr_seq_prestador_exec_princ,
	a.ie_regime_atendimento,
	a.ie_saude_ocupacional,
	coalesce( a.sg_cons_prof_prest_nota_serv, a.sg_cons_prof_eqp_prio) sg_cons_prof_prest_nota_serv,
	coalesce( a.nr_cons_prof_prest_nota_serv, a.nr_cons_prof_eqp_prio) nr_cons_prof_prest_nota_serv,
	coalesce( a.sg_uf_cons_prest_nota_serv, a.sg_uf_cons_eqp_prio) sg_uf_cons_prest_nota_serv,
	coalesce( a.cd_prest_nota_serv, a.cd_prest_eqp_prio) cd_prest_nota_serv
from	pls_conta_proc_v a

where	ie_status in ('A', 'C', 'L', 'P', 'S', 'U')
and	ie_status_conta in ('A', 'F', 'L', 'P', 'U');

