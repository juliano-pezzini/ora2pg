-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW convenio_paciente_validador_v (cd_receiver, cd_sender, ds_estab_saude_receiver, ds_dom_saude_receiver, cd_postal_receiver, cd_estado_receiver, cd_municipio_receiver, cd_localidade_receiver, cd_cgc_receiver, ds_razao_social_receiver, cd_internacional_receiver, ds_oid_sender, ds_estab_saude_sender, ds_dom_saude_sender, cd_postal_sender, cd_estado_sender, cd_municipio_sender, cd_localidade_sender, cd_cgc_sender, ds_razao_social_sender, cd_internacional_sender, cd_curp, nm_primeiro_nome, nm_sobrenome_pai, nm_sobrenome_mae, dt_nascimento, edonac, ie_sexo, cd_nacionalidade, defent_hab, defdel_hab, defloc_hab, folioprograma, cvedependencia, ds_estab_saude, ds_oid, nr_tipo_beneficiario, cd_clues_receiver, cd_estabelecimento_cos, cd_clues_sender, cd_pessoa_fisica, nr_atendimento, cd_clues_pja, cd_convenio_coc, dt_entrada) AS select  pjr.cd_cgc cd_receiver,
	pjs.cd_cgc cd_sender,
	coalesce(ccr.ds_estab_saude, pjr.ds_razao_social) ds_estab_saude_receiver,
	coalesce(ccr.ds_dom_saude, pjr.ds_endereco) ds_dom_saude_receiver,
	ccr.cd_postal cd_postal_receiver,
	ccr.cd_estado cd_estado_receiver,
	ccr.cd_municipio cd_municipio_receiver,
	ccr.cd_localidade cd_localidade_receiver,
	pjr.cd_cgc cd_cgc_receiver,
	pjr.ds_razao_social ds_razao_social_receiver,
	pjr.cd_internacional cd_internacional_receiver, --992060
	cos.ds_oid ds_oid_sender,
	coalesce(ccs.ds_estab_saude, pjs.ds_razao_social) ds_estab_saude_sender,
	coalesce(ccs.ds_dom_saude, pjs.ds_endereco) ds_dom_saude_sender,
	ccs.cd_postal cd_postal_sender,
	ccs.cd_estado cd_estado_sender,
	ccs.cd_municipio cd_municipio_sender,
	ccs.cd_localidade cd_localidade_sender,
	pjs.cd_cgc cd_cgc_sender,
	pjs.ds_razao_social ds_razao_social_sender,
	pjs.cd_internacional cd_internacional_sender, --990798
	pf.cd_curp cd_curp,
	z.ds_given_name nm_primeiro_nome,
	z.ds_family_name nm_sobrenome_pai,
	z.ds_component_name_1 nm_sobrenome_mae,
	dt_nascimento dt_nascimento,
	coalesce(pf.sg_estado_nasc,'ne') edonac,
	pf.ie_sexo ie_sexo,
	pf.cd_nacionalidade cd_nacionalidade,
	obter_dados_cat_localidade(cpf.nr_seq_localizacao_mx,'CD_EFE') DEFENT_HAB,
	obter_dados_cat_localidade(cpf.nr_seq_localizacao_mx,'CD_CAT_MUNICIPIO') DEFDEL_HAB,
	obter_dados_cat_localidade(cpf.nr_seq_localizacao_mx,'CD_CAT_LOCALIDADE') DEFLOC_HAB,
	acc.cd_usuario_convenio folioprograma,
	pja.cd_internacional cvedependencia,
	cca.ds_estab_saude ds_estab_saude,
	coc.ds_oid ds_oid,
	coc.nr_tipo_beneficiario nr_tipo_beneficiario,
	pjr.cd_cgc cd_clues_receiver,
	es.cd_estabelecimento cd_estabelecimento_cos,
	pjs.cd_cgc cd_clues_sender,
	pf.cd_pessoa_fisica cd_pessoa_fisica,
	ap.nr_atendimento nr_atendimento,
	pja.cd_cgc cd_clues_pja,
	obter_desc_convenio(acc.cd_convenio) cd_convenio_coc,
	ap.dt_entrada dt_entrada
FROM estabelecimento ea, atendimento_paciente ap
LEFT OUTER JOIN atend_categoria_convenio acc ON (ap.nr_atendimento = acc.nr_atendimento)
LEFT OUTER JOIN cadastro_oid_convenio coc ON (acc.cd_convenio = coc.cd_convenio)
, pessoa_juridica pjr
LEFT OUTER JOIN cat_clues ccr ON (pjr.cd_internacional = ccr.cd_clues)
, pessoa_juridica pjs
LEFT OUTER JOIN cat_clues ccs ON (pjs.cd_internacional = ccs.cd_clues)
LEFT OUTER JOIN estabelecimento es ON (pjs.cd_cgc = es.cd_cgc)
LEFT OUTER JOIN cadastro_oid cos ON (es.cd_estabelecimento = cos.cd_estabelecimento)
, pessoa_fisica pf
LEFT OUTER JOIN compl_pessoa_fisica cpf ON (pf.cd_pessoa_fisica = cpf.cd_pessoa_fisica AND 1 = cpf.ie_tipo_complemento)
LEFT OUTER JOIN person_name z ON (pf.nr_seq_person_name = z.nr_sequencia AND 'main' = z.ds_type)
, pessoa_juridica pja
LEFT OUTER JOIN cat_clues cca ON (pja.cd_internacional = cca.cd_clues)
WHERE ap.cd_pessoa_fisica = pf.cd_pessoa_fisica   and ap.cd_estabelecimento = ea.cd_estabelecimento and ea.cd_cgc = pja.cd_cgc;

