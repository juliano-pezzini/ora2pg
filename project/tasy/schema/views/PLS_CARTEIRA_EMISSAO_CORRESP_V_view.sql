-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_carteira_emissao_corresp_v (nr_seq_segurado, cd_usuario_plano, cd_pessoa_fisica, nm_pessoa_fisica, nr_seq_lote, nr_seq_titular) AS select	d.nr_sequencia nr_seq_segurado,
	c.cd_usuario_plano,
	e.cd_pessoa_fisica,
	e.nm_pessoa_fisica,
	a.nr_sequencia nr_seq_lote,
	d.nr_seq_titular
FROM	pessoa_fisica		e,
	pls_segurado		d,
	pls_segurado_carteira	c,
	pls_carteira_emissao	b,
	pls_lote_carteira	a
where	d.cd_pessoa_fisica	= e.cd_pessoa_fisica
and	c.nr_seq_segurado	= d.nr_sequencia
and	b.nr_seq_seg_carteira	= c.nr_sequencia
and	b.nr_seq_lote		= a.nr_sequencia
and	d.nr_seq_titular is null

union all

select	d.nr_sequencia nr_seq_segurado,
	c.cd_usuario_plano,
	e.cd_pessoa_fisica,
	e.nm_pessoa_fisica,
	a.nr_sequencia nr_seq_lote,
	d.nr_seq_titular
from	pessoa_fisica		e,
	pls_segurado		d,
	pls_segurado_carteira	c,
	pls_carteira_emissao	b,
	pls_lote_carteira	a
where	d.cd_pessoa_fisica	= e.cd_pessoa_fisica
and	c.nr_seq_segurado	= d.nr_sequencia
and	b.nr_seq_seg_carteira	= c.nr_sequencia
and	b.nr_seq_lote		= a.nr_sequencia
and	d.nr_seq_titular is not null
and	not exists (select	1
			from	pls_carteira_emissao	x,
				pls_segurado_carteira	y,
				pls_segurado		z
			where	x.nr_seq_seg_carteira	= y.nr_sequencia
			and	y.nr_seq_segurado	= z.nr_sequencia
			and	z.nr_sequencia		= d.nr_seq_titular
			and	x.nr_seq_lote		= a.nr_sequencia);

