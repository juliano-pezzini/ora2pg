-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_analise_item_v (tp_categoria, qt_itens, vl_apresentado, vl_liberado, qt_pendente, nr_seq_analise, tp) AS select	'Procedimentos' tp_categoria,
	(select count(1)
	FROM	pls_conta_proc_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '1'
	and	p.ie_status	not in ('D','M')) qt_itens,
	(select sum(p.vl_procedimento_imp)
	from	pls_conta_proc_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '1'
	and	p.ie_status	not in ('D','M')) vl_apresentado,
	(select sum(p.vl_liberado)
	from	pls_conta_proc_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '1'
	and	p.ie_status	not in ('D','M')) vl_liberado,
	(select count(1)
	from	pls_conta_proc_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '1'
	and	p.ie_status	not in ('D','M','L','S')) qt_pendente,
	nr_sequencia	nr_seq_analise,
	1 tp
from	pls_analise_conta	a

union all

select	'Taxas' tp_categoria,
	(select count(1)
	from	pls_conta_proc_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '2'
	and	p.ie_status	not in ('D','M')) qt_itens,
	(select sum(p.vl_procedimento_imp)
	from	pls_conta_proc_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '2'
	and	p.ie_status	not in ('D','M')) vl_apresentado,
	(select sum(p.vl_liberado)
	from	pls_conta_proc_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '2'
	and	p.ie_status	not in ('D','M')) vl_liberado,
	(select count(1)
	from	pls_conta_proc_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '2'
	and	p.ie_status	not in ('D','M','L','S')) qt_pendente,
	nr_sequencia	nr_seq_analise,
	2 tp
from	pls_analise_conta	a

union all

select	'Di√°rias' tp_categoria,
	(select count(1)
	from	pls_conta_proc_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '3'
	and	p.ie_status	not in ('D','M')) qt_itens,
	(select sum(p.vl_procedimento_imp)
	from	pls_conta_proc_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '3'
	and	p.ie_status	not in ('D','M')) vl_apresentado,
	(select sum(p.vl_liberado)
	from	pls_conta_proc_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '3'
	and	p.ie_status	not in ('D','M')) vl_liberado,
	(select count(1)
	from	pls_conta_proc_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '3'
	and	p.ie_status	not in ('D','M','L','S')) qt_pendente,
	nr_sequencia	nr_seq_analise,
	3 tp
from	pls_analise_conta	a

union all

select	'Pacote' tp_categoria,
	(select count(1)
	from	pls_conta_proc_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '4'
	and	p.ie_status	not in ('D','M')) qt_itens,
	(select sum(p.vl_procedimento_imp)
	from	pls_conta_proc_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '4'
	and	p.ie_status	not in ('D','M')) vl_apresentado,
	(select sum(p.vl_liberado)
	from	pls_conta_proc_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '4'
	and	p.ie_status	not in ('D','M')) vl_liberado,
	(select count(1)
	from	pls_conta_proc_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '4'
	and	p.ie_status	not in ('D','M','L','S')) qt_pendente,
	nr_sequencia	nr_seq_analise,
	4 tp
from	pls_analise_conta	a

union all

select	'Materiais' tp_categoria,
	(select count(1)
	from	pls_conta_mat_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '3'
	and	p.ie_status	not in ('D','M')) qt_itens,
	(select sum(p.vl_material_imp)
	from	pls_conta_mat_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '3'
	and	p.ie_status	not in ('D','M')) vl_apresentado,
	(select sum(p.vl_liberado)
	from	pls_conta_mat_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '3'
	and	p.ie_status	not in ('D','M')) vl_liberado,
	(select count(1)
	from	pls_conta_mat_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '3'
	and	p.ie_status	not in ('D','M','L','S')) qt_pendente,
	nr_sequencia	nr_seq_analise,
	5 tp
from	pls_analise_conta	a

union all

select	'Medicamentos' tp_categoria,
	(select count(1)
	from	pls_conta_mat_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '2'
	and	p.ie_status	not in ('D','M')) qt_itens,
	(select sum(p.vl_material_imp)
	from	pls_conta_mat_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '2'
	and	p.ie_status	not in ('D','M')) vl_apresentado,
	(select sum(p.vl_liberado)
	from	pls_conta_mat_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '2'
	and	p.ie_status	not in ('D','M')) vl_liberado,
	(select count(1)
	from	pls_conta_mat_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '2'
	and	p.ie_status	not in ('D','M','L','S')) qt_pendente,
	nr_sequencia	nr_seq_analise,
	6 tp
from	pls_analise_conta	a

union all

select	'OPME' tp_categoria,
	(select count(1)
	from	pls_conta_mat_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '7'
	and	p.ie_status	not in ('D','M')) qt_itens,
	(select sum(p.vl_material_imp)
	from	pls_conta_mat_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '7'
	and	p.ie_status	not in ('D','M')) vl_apresentado,
	(select sum(p.vl_liberado)
	from	pls_conta_mat_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '7'
	and	p.ie_status	not in ('D','M')) vl_liberado,
	(select count(1)
	from	pls_conta_mat_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '7'
	and	p.ie_status	not in ('D','M','L','S')) qt_pendente,
	nr_sequencia	nr_seq_analise,
	7 tp
from	pls_analise_conta	a

union all

select	'Gases medicinais' tp_categoria,
	(select count(1)
	from	pls_conta_mat_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '1'
	and	p.ie_status	not in ('D','M')) qt_itens,
	(select sum(p.vl_material_imp)
	from	pls_conta_mat_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '1'
	and	p.ie_status	not in ('D','M')) vl_apresentado,
	(select sum(p.vl_liberado)
	from	pls_conta_mat_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '1'
	and	p.ie_status	not in ('D','M')) vl_liberado,
	(select count(1)
	from	pls_conta_mat_v p
	where 	p.nr_seq_analise	= a.nr_sequencia
	and	p.ie_tipo_despesa = '1'
	and	p.ie_status	not in ('D','M','L','S')) qt_pendente,
	nr_sequencia	nr_seq_analise,
	8 tp
from	pls_analise_conta	a;

