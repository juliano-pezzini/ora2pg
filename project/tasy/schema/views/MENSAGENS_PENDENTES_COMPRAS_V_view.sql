-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW mensagens_pendentes_compras_v (nr_sequencia, cd_estabelecimento, dt_atualizacao, nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec, nr_documento, ie_tipo_documento, ie_tipo_mensagem, dt_cancelamento, ds_email_origem, nm_usuario_origem, nr_seq_aprovacao, nr_seq_proc_aprov, ds_assunto, ds_mensagem, ie_cancelado) AS select	NR_SEQUENCIA,CD_ESTABELECIMENTO,DT_ATUALIZACAO,NM_USUARIO,DT_ATUALIZACAO_NREC,NM_USUARIO_NREC,NR_DOCUMENTO,IE_TIPO_DOCUMENTO,IE_TIPO_MENSAGEM,DT_CANCELAMENTO,DS_EMAIL_ORIGEM,NM_USUARIO_ORIGEM,NR_SEQ_APROVACAO,NR_SEQ_PROC_APROV,DS_ASSUNTO,DS_MENSAGEM,IE_CANCELADO
FROM	envio_email_compra_agrup a
where	coalesce(ie_cancelado,'N') = 'N'
and	exists (select	1
		from	email_compra_agrup_dest x
		where	x.nr_seq_envio = a.nr_sequencia
		and	coalesce(x.ie_enviado,'N') = 'N');

