-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW aih_paciente_internado_v (nr_atendimento, nr_atend_original, dt_entrada, cd_pessoa_fisica, cd_procedencia, ie_tipo_atendimento, ie_tipo_convenio, cd_medico_resp, dt_alta, cd_motivo_alta, ie_permite_visita, ie_clinica, nr_seq_classificacao, dt_entrada_unidade, dt_saida_unidade, cd_setor_atendimento, cd_unidade_basica, cd_unidade_compl, ds_unidade, cd_tipo_acomod_unid, cd_convenio, cd_categoria, cd_usuario_convenio, cd_empresa, cd_tipo_acomod_conv, nr_doc_convenio, ds_setor_atendimento, ds_convenio, ds_categoria, nm_medico, nm_paciente, nr_prontuario, dt_nascimento, cd_religiao, cd_classif_setor, dt_previsto_alta, qt_dia_internacao, ie_carater_inter_sus, dt_alta_convenio, nr_seq_indicacao, cd_estabelecimento, nr_seq_tipo_acidente) AS select /*+ ORDERED */	a.nr_atendimento, 
	a.nr_atend_original, 
	a.dt_entrada, 
	a.cd_pessoa_fisica, 
	a.cd_procedencia, 
	a.ie_tipo_atendimento, 
	a.ie_tipo_convenio, 
	a.cd_medico_resp, 
	a.dt_alta, 
	a.cd_motivo_alta, 
	a.ie_permite_visita, 
	a.ie_clinica, 
	a.nr_seq_classificacao, 
	b.dt_entrada_unidade, 
	b.dt_saida_unidade, 
	b.cd_setor_atendimento, 
	b.cd_unidade_basica, 
	b.cd_unidade_compl, 
	(b.cd_unidade_basica || ' '|| b.cd_unidade_compl) ds_unidade, 
	b.cd_tipo_acomodacao cd_tipo_acomod_unid, 
	c.cd_convenio, 
	c.cd_categoria, 
	c.cd_usuario_convenio, 
	c.cd_empresa, 
	c.cd_tipo_acomodacao cd_tipo_acomod_conv, 
	c.nr_doc_convenio, 
	s.ds_setor_atendimento, 
	v.ds_convenio, 
	t.ds_categoria, 
	m.nm_pessoa_fisica nm_medico, 
	p.nm_pessoa_fisica nm_paciente, 
	p.nr_prontuario, 
	p.dt_nascimento, 
	p.cd_religiao, 
	s.cd_classif_setor, 
	a.dt_previsto_alta, 
	c.qt_dia_internacao, 
	a.ie_carater_inter_sus, 
	(a.dt_entrada + qt_dia_internacao) dt_alta_convenio, 
	a.nr_seq_indicacao, 
	a.cd_estabelecimento, 
	a.nr_seq_tipo_acidente 
FROM	atendimento_paciente a, 
	atend_paciente_unidade b, 
	atend_categoria_convenio c, 
	categoria_convenio t, 
	setor_atendimento s, 
	pessoa_fisica m, 
	pessoa_fisica p,    
	convenio v 
where (a.nr_atendimento 	= b.nr_atendimento) 
and	(b.dt_entrada_unidade = 
		(select /*+ INDEX(X ATEPACU_I2) */ 
			max(x.dt_entrada_unidade) 
		from	setor_atendimento y, 
			atend_paciente_unidade x 
		where	x.nr_atendimento = a.nr_atendimento 
		and	x.cd_setor_atendimento = y.cd_setor_atendimento 
		and	y.cd_classif_setor in (1,2,3,4,8) 
		and	x.dt_entrada_unidade >= a.dt_entrada)) 
and (a.nr_atendimento 	= c.nr_atendimento) 
and 	(c.dt_inicio_vigencia = 
	(select	max(w.dt_inicio_vigencia) dt_primeira_vigencia 
	from 	atend_categoria_convenio w 
	where 	w.nr_atendimento = a.nr_atendimento)) 
and (b.cd_setor_atendimento = s.cd_setor_atendimento) 
and (s.cd_classif_setor in (1,2,3,4,8)) 
and (c.cd_convenio	= v.cd_convenio) 
and (a.cd_medico_resp	= m.cd_pessoa_fisica) 
and (a.cd_pessoa_fisica	= p.cd_pessoa_fisica) 
and (c.cd_convenio	= t.cd_convenio) 
and (c.cd_categoria	= t.cd_categoria);

