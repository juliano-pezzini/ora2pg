-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW w_eis_escala_prm_taxa_risco_v (cd_setor_atendimento, ds_setor_atendimento, cd_material, dt_evento, cd_empresa, cd_estabelecimento, nr_atendimento, ds_unidade, nr_seq_ficha) AS select distinct
	e.cd_setor_atendimento, 
	substr(obter_nome_setor(e.cd_setor_atendimento),1,255) ds_Setor_Atendimento,	 
	c.cd_material, 
	b.dt_evento, 
	f.cd_empresa, 
	a.cd_estabelecimento,	 
	b.nr_atendimento, 
	obter_unidade_atendimento(b.nr_atendimento,'A','U') ds_unidade, 
	c.nr_seq_ficha 
FROM	qua_evento_paciente b, 
	PRM_FICHA_OCORRENCIA e, 
	PRM_FICHA_MATERIAL c, 
	estabelecimento f, 
	atendimento_paciente a 
where	a.nr_atendimento 	= b.nr_atendimento 
and	b.dt_inativacao is null 
and	a.cd_estabelecimento 	= f.cd_estabelecimento 
and	e.nr_seq_evento 	= b.nr_sequencia	 
and	e.nr_sequencia		= c.nr_seq_ficha 
and	CASE WHEN(obter_se_material_risco_PRM(e.nr_sequencia))='S' THEN 'S'  ELSE 'N' END  <> 'N';

