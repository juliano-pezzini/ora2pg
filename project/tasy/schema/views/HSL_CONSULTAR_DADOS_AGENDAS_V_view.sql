-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW hsl_consultar_dados_agendas_v (nm_pessoa, dt_nasc_pessoa, nr_rg_pessoa, nr_cpf_pessoa, ds_end_pessoa, ds_bairro_pessoa, ds_munic_pessoa, ds_estado_pessoa, ds_pais_pessoa, ds_mun_ibge_pessoa, cd_cep_pessoa, nr_telefone_pessoa, ds_fax_pessoa, nr_cel_pessoa, ds_fone_adic_pessoa, nm_pessoa_resp, ie_grau_parentesco, ie_tipo_parentesco, nm_contato_resp, nr_identidade_resp, nr_cpf_resp, nr_tel_resp, nr_tel_adic_resp, ds_end_resp, nr_telefone_resp, dt_nasc_resp, ds_setor_atend, cd_estabelecimento, dt_agenda, ie_tipo_complemento, cd_setor_atendimento) AS select	distinct
	a.nm_pessoa_fisica nm_pessoa, 
	a.dt_nascimento dt_nasc_pessoa, 
	a.nr_identidade nr_rg_pessoa, 
	a.nr_cpf nr_cpf_pessoa, 
	b.ds_endereco ds_end_pessoa, 
	b.ds_bairro ds_bairro_pessoa, 
	b.ds_municipio ds_munic_pessoa, 
	b.sg_estado ds_estado_pessoa, 
	(	select	distinct	 
			x.nm_pais 
		FROM	pais x 
		where	x.nr_sequencia		= b.nr_seq_pais 
	) ds_pais_pessoa, 
	(	select	distinct 
			x.ds_municipio 
		from	sus_municipio x 
		where	x.cd_municipio_ibge	= b.cd_municipio_ibge 
	) ds_mun_ibge_pessoa, 
	b.cd_cep cd_cep_pessoa, 
	b.nr_telefone nr_telefone_pessoa, 
	b.ds_fax ds_fax_pessoa, 
	a.nr_telefone_celular nr_cel_pessoa, 
	b.ds_fone_adic ds_fone_adic_pessoa, 
	(	select	distinct 
			substr(x.nm_pessoa_fisica, 1,80) 
		from	pessoa_fisica x 
		where	x.cd_pessoa_fisica = d.cd_pessoa_responsavel 
	) nm_pessoa_resp, 
	(	select	distinct 
			substr(x.ds_valor_dominio,1,20) 
		from	valor_dominio x 
		where	x.cd_dominio 	= 2077 
		and	x.vl_dominio	= d.ie_responsavel	 
	) ie_grau_parentesco, 
	d.nr_seq_grau_parentesco ie_tipo_parentesco, 
	(	select	distinct 
			x.nm_contato 
		from	compl_pessoa_fisica x 
		where	x.ie_tipo_complemento	= 3 
		and	x.cd_pessoa_fisica	= a.cd_pessoa_fisica 
	) nm_contato_resp, 
	(	select	distinct 
			x.nr_identidade 
		from	compl_pessoa_fisica x 
		where	x.ie_tipo_complemento	= 3 
		and	x.cd_pessoa_fisica	= a.cd_pessoa_fisica 
	) nr_identidade_resp, 
	(	select	distinct 
			x.nr_cpf 
		from	compl_pessoa_fisica x 
		where	x.ie_tipo_complemento	= 3 
		and	x.cd_pessoa_fisica	= a.cd_pessoa_fisica 
	) nr_cpf_resp, 
	(	select	distinct 
			x.nr_telefone 
		from	compl_pessoa_fisica x 
		where	x.ie_tipo_complemento	= 3 
		and	x.cd_pessoa_fisica	= a.cd_pessoa_fisica 
	) nr_tel_resp, 
	(	select	distinct 
			x.ds_fone_adic 
		from	compl_pessoa_fisica x 
		where	x.ie_tipo_complemento	= 3 
		and	x.cd_pessoa_fisica	= a.cd_pessoa_fisica 
	) nr_tel_adic_resp, 
	(	select	distinct 
			substr('Cep: '||z.cd_cep||' - '||'Rua: '||z.ds_endereco,1,150) 
		from	compl_pessoa_fisica z 
		where	z.cd_pessoa_fisica	= a.cd_pessoa_fisica 
		and	z.ie_tipo_complemento	= 3 
	) ds_end_resp, 
	(	select	distinct 
			substr(x.nr_telefone,1,15) 
		from	compl_pessoa_fisica x 
		where	x.ie_tipo_complemento	= 3 
		and	x.cd_pessoa_fisica	= a.cd_pessoa_fisica 
	) nr_telefone_resp, 
	(	select	distinct 
			x.dt_nascimento 
		from	pessoa_fisica x 
		where	x.cd_pessoa_fisica	= d.cd_pessoa_responsavel 
	) dt_nasc_resp, 
	substr(f.ds_setor_atendimento,1,100) ds_setor_atend, 
	e.cd_estabelecimento cd_estabelecimento, 
	c.dt_agendamento dt_agenda, 
	b.ie_tipo_complemento, 
	c.cd_setor_atendimento cd_setor_atendimento 
FROM agenda e, compl_pessoa_fisica b, pessoa_fisica a, agenda_consulta c
LEFT OUTER JOIN atendimento_paciente d ON (c.nr_atendimento = d.nr_atendimento)
LEFT OUTER JOIN setor_atendimento f ON (c.cd_setor_atendimento = f.cd_setor_atendimento)
WHERE a.cd_pessoa_fisica	= b.cd_pessoa_fisica and a.cd_pessoa_fisica	= c.cd_pessoa_fisica  and c.cd_agenda		= e.cd_agenda  and b.ie_tipo_complemento	= 1 and e.cd_tipo_agenda	in (3,5) and e.ie_situacao		= 'A' and c.ie_status_agenda	not in ('C', 'L', 'B', 'F', 'I', 'II') 
 
union all
 
select	distinct 
	a.nm_pessoa_fisica nm_pessoa, 
	a.dt_nascimento dt_nasc_pessoa, 
	a.nr_identidade nr_rg_pessoa, 
	a.nr_cpf nr_cpf_pessoa, 
	b.ds_endereco ds_end_pessoa, 
	b.ds_bairro ds_bairro_pessoa, 
	b.ds_municipio ds_munic_pessoa, 
	b.sg_estado ds_estado_pessoa, 
	(	select	distinct	 
			x.nm_pais 
		from	pais x 
		where	x.nr_sequencia		= b.nr_seq_pais 
		and	b.ie_tipo_complemento	= 1 
	) ds_pais_pessoa, 
	(	select	distinct 
			x.ds_municipio 
		from	sus_municipio x 
		where	x.cd_municipio_ibge	= b.cd_municipio_ibge 
		and	b.ie_tipo_complemento	= 1 
	) ds_mun_ibge_pessoa, 
	b.cd_cep cd_cep_pessoa, 
	b.nr_telefone nr_telefone_pessoa, 
	b.ds_fax ds_fax_pessoa, 
	a.nr_telefone_celular nr_cel_pessoa, 
	b.ds_fone_adic ds_fone_adic_pessoa, 
	(	select	distinct 
			substr(x.nm_pessoa_fisica, 1,80) 
		from	pessoa_fisica x 
		where	x.cd_pessoa_fisica = d.cd_pessoa_responsavel 
	) nm_pessoa_resp, 
	(	select	distinct 
			substr(x.ds_valor_dominio,1,20) 
		from	valor_dominio x 
		where	x.cd_dominio 	= 2077 
		and	x.vl_dominio	= d.ie_responsavel	 
	) ie_grau_parentesco, 
	d.nr_seq_grau_parentesco ie_tipo_parentesco, 
	(	select	distinct 
			x.nm_contato 
		from	compl_pessoa_fisica x 
		where	x.ie_tipo_complemento	= 3 
		and	x.cd_pessoa_fisica	= a.cd_pessoa_fisica 
	) nm_contato_resp, 
	(	select	distinct 
			x.nr_identidade 
		from	compl_pessoa_fisica x 
		where	x.ie_tipo_complemento	= 3 
		and	x.cd_pessoa_fisica	= a.cd_pessoa_fisica 
	) nr_identidade_resp, 
	(	select	distinct 
			x.nr_cpf 
		from	compl_pessoa_fisica x 
		where	x.ie_tipo_complemento	= 3 
		and	x.cd_pessoa_fisica	= a.cd_pessoa_fisica 
	) nr_cpf_resp, 
	(	select	distinct 
			x.nr_telefone 
		from	compl_pessoa_fisica x 
		where	x.ie_tipo_complemento	= 3 
		and	x.cd_pessoa_fisica	= a.cd_pessoa_fisica 
	) nr_tel_resp, 
	(	select	distinct 
			x.ds_fone_adic 
		from	compl_pessoa_fisica x 
		where	x.ie_tipo_complemento	= 3 
		and	x.cd_pessoa_fisica	= a.cd_pessoa_fisica 
	) nr_tel_adic_resp, 
	(	select	distinct 
			substr('Cep: '||z.cd_cep||' - '||'Rua: '||z.ds_endereco,1,150) 
		from	compl_pessoa_fisica z 
		where	z.cd_pessoa_fisica	= a.cd_pessoa_fisica 
		and	z.ie_tipo_complemento	= 3 
	) ds_end_resp, 
	(	select	distinct 
			substr(x.nr_telefone,1,15) 
		from	compl_pessoa_fisica x 
		where	x.ie_tipo_complemento	= 3 
		and	x.cd_pessoa_fisica	= a.cd_pessoa_fisica 
	) nr_telefone_resp, 
	(	select	distinct 
			x.dt_nascimento 
		from	pessoa_fisica x 
		where	x.cd_pessoa_fisica	= d.cd_pessoa_responsavel 
	) dt_nasc_resp, 
	substr(f.ds_setor_atendimento,1,100) ds_setor_atend, 
	e.cd_estabelecimento cd_estabelecimento, 
	c.dt_agendamento dt_agenda, 
	b.ie_tipo_complemento, 
	c.cd_setor_atendimento cd_setor_atendimento 
FROM agenda e, compl_pessoa_fisica b, pessoa_fisica a, agenda_paciente c
LEFT OUTER JOIN atendimento_paciente d ON (c.nr_atendimento = d.nr_atendimento)
LEFT OUTER JOIN setor_atendimento f ON (c.cd_setor_atendimento = f.cd_setor_atendimento)
WHERE a.cd_pessoa_fisica	= b.cd_pessoa_fisica and a.cd_pessoa_fisica	= c.cd_pessoa_fisica  and c.cd_agenda		= e.cd_agenda  and b.ie_tipo_complemento	= 1 and e.cd_tipo_agenda	= 2 and e.ie_situacao		= 'A';

