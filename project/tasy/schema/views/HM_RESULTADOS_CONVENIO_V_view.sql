-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW hm_resultados_convenio_v (ie_tipo_reg, cdsoc, dtexm, cdatd_exm, nrest_exm, dtreal_exm, dsdet_rest_exm, qtvolume, qtdensidade, qtph, dccor, dcdeposito, dccheiro, dcreacao, dcaspecto, cdpres_proteinas, cdpres_bilirrubina, cdpres_hemoglobina, cdpres_nitrito, cdpres_acetona, cdpres_glicose, cdpres_urobilinogenio, dcpiocito, dcemacia, dccilindro, dcepitelio, dcflora_bacteriana, dccristais, dcmuco, cdresult_exm, cdsangue_fezes, qtres_hemacias, qtres_hemoglobina, qtres_hematocrito, qtres_vcm, qtres_hcm, qtres_chcm, qtcont_global, qtmielocito, qtmetamielocito, qtbastonete, qtsegmentado, qteosinofilo, qtbasofilo, qtmonocito, qtlinfocito, qtlinfocito_reativo, qtplasmocito, qtplaqueta, nr_seq_lote_externo) AS select 	1 ie_tipo_reg,
	d.CD_INTERNO_LAB	Cdsoc,
	a.dt_prescricao		Dtexm,
	cd_exame		cdatd_exm,
	obter_valor_ds_resultado_exame(b.nr_seq_exame,b.nr_sequencia,b.nr_prescricao,'V')	Nrest_exm,
	obter_data_aprov_lab(b.nr_prescricao, b.nr_sequencia) Dtreal_exm,
	obter_valor_ds_resultado_exame(b.nr_seq_exame,b.nr_sequencia,b.nr_prescricao,'D')		Dsdet_rest_exm,
	0 qtvolume,
	null qtdensidade,
	null qtPH,
	null dccor,
	' '  dcdeposito,
	' '  dccheiro,
	' '  dcreacao,
	' '  dcaspecto,
	null cdpres_proteinas,
	null cdpres_bilirrubina,
	null cdpres_hemoglobina,
	null cdpres_nitrito,
	null cdpres_acetona,
	null cdpres_glicose,
	' ' cdpres_urobilinogenio,
	' ' Dcpiocito,
	null Dcemacia,
	null Dccilindro,
	null Dcepitelio,
	null Dcflora_bacteriana,
	null Dccristais,
	null Dcmuco,
	null Cdresult_exm,
	null Cdsangue_fezes,
	null qtres_hemacias,
	null qtres_hemoglobina,
	null qtres_hematocrito,
	null qtres_VCM,
	null qtres_HCM,
	null qtres_CHCM,
	null qtcont_global,
	null qtmielocito,
	null qtmetamielocito,
	null qtbastonete,
	null qtsegmentado,
	null qteosinofilo,
	null qtbasofilo,
	null qtmonocito,
	null qtlinfocito,
	0 qtlinfocito_reativo,
	0 qtplasmocito,
	'0' qtplaqueta,
	b.nr_seq_lote_externo
FROM 	prescr_medica a,
	pessoa_juridica_estab d,
	lab_lote_externo f,
	exame_laboratorio c,
	prescr_procedimento b
where	a.nr_prescricao =  b.nr_prescricao
and	b.nr_seq_lote_externo = f.nr_sequencia
and	b.nr_seq_exame = c.nr_seq_exame
and	f.cd_cgc	= d.cd_cgc
and	d.cd_estabelecimento = a.cd_estabelecimento
and 	cd_exame in ('CFRAC', 'CRES', 'URES', 'PARA', 'GLIS', 'SOFP', 'VDRL','PLAQ')

union all

select 	2 ie_tipo_reg,
	d.CD_INTERNO_LAB	Cdsoc,
	a.dt_prescricao		Dtexm,
	cd_exame		cdatd_exm,
	obter_valor_ds_resultado_exame(b.nr_seq_exame,b.nr_sequencia,b.nr_prescricao,'V') Nrest_exm,
	obter_data_aprov_lab(b.nr_prescricao, b.nr_sequencia) Dtreal_exm,
	obter_valor_ds_resultado_exame(b.nr_seq_exame,b.nr_sequencia,b.nr_prescricao,'D') Dsdet_rest_exm,
	0 qtvolume,
	obter_valor_ds_resultado_exame(75,b.nr_sequencia,b.nr_prescricao,'V') qtdensidade,
	obter_valor_ds_resultado_exame(220,b.nr_sequencia,b.nr_prescricao,'V') qtPH,
	obter_valor_ds_resultado_exame(65,b.nr_sequencia,b.nr_prescricao,'D') dccor,
	null dcdeposito,
	null dccheiro,
	null dcreacao,
	substr(obter_valor_ds_resultado_exame(849,b.nr_sequencia,b.nr_prescricao,'D'),1,1) dcaspecto,
	substr(obter_valor_ds_resultado_exame(681,b.nr_sequencia,b.nr_prescricao,'D'),1,1) cdpres_proteinas,
	substr(obter_valor_ds_resultado_exame(684,b.nr_sequencia,b.nr_prescricao,'D'),1,1) cdpres_bilirrubina,
	substr(obter_valor_ds_resultado_exame(685,b.nr_sequencia,b.nr_prescricao,'D'),1,1) cdpres_hemoglobina,
	substr(obter_valor_ds_resultado_exame(686,b.nr_sequencia,b.nr_prescricao,'D'),1,1) cdpres_nitrito,
	substr(obter_valor_ds_resultado_exame(683,b.nr_sequencia,b.nr_prescricao,'D'),1,1) cdpres_acetona,
	substr(obter_valor_ds_resultado_exame(682,b.nr_sequencia,b.nr_prescricao,'D'),1,1) cdpres_glicose,
	null cdpres_urobilinogenio,
	null Dcpiocito,
	null Dcemacia,
	null Dccilindro,
	null Dcepitelio,
	null Dcflora_bacteriana,
	null Dccristais,
	null Dcmuco,
	null Cdresult_exm,
	null Cdsangue_fezes,
	null qtres_hemacias,
	null qtres_hemoglobina,
	null qtres_hematocrito,
	null qtres_VCM,
	null qtres_HCM,
	null qtres_CHCM,
	null qtcont_global,
	null qtmielocito,
	null qtmetamielocito,
	null qtbastonete,
	null qtsegmentado,
	null qteosinofilo,
	null qtbasofilo,
	null qtmonocito,
	null qtlinfocito,
	0 qtlinfocito_reativo,
	0 qtplasmocito,
	'0' qtplaqueta,
	b.nr_seq_lote_externo
from 	prescr_medica a,
	pessoa_juridica_estab d,
	lab_lote_externo f,
	exame_laboratorio c,
	prescr_procedimento b
where	a.nr_prescricao =  b.nr_prescricao
and	b.nr_seq_lote_externo = f.nr_sequencia
and	b.nr_seq_exame = c.nr_seq_exame
and	f.cd_cgc	= d.cd_cgc
and	d.cd_estabelecimento = a.cd_estabelecimento
and 	cd_exame = 'RURN'

union all

select 	3 ie_tipo_reg,
	d.CD_INTERNO_LAB	Cdsoc,
	a.dt_prescricao		Dtexm,
	cd_exame		cdatd_exm,
	obter_valor_ds_resultado_exame(b.nr_seq_exame,b.nr_sequencia,b.nr_prescricao,'V')	Nrest_exm,
	obter_data_aprov_lab(b.nr_prescricao, b.nr_sequencia) Dtreal_exm,
	obter_valor_ds_resultado_exame(b.nr_seq_exame,b.nr_sequencia,b.nr_prescricao,'D')	Dsdet_rest_exm,
	0 qtvolume,
	null qtdensidade,
	null qtPH,
	null dccor,
	null dcdeposito,
	null dccheiro,
	null dcreacao,
	null dcaspecto,
	null cdpres_proteinas,
	null cdpres_bilirrubina,
	null cdpres_hemoglobina,
	null cdpres_nitrito,
	null cdpres_acetona,
	null cdpres_glicose,
	null cdpres_urobilinogenio,
	null Dcpiocito,
	obter_valor_ds_resultado_exame(689,b.nr_sequencia,b.nr_prescricao,'D') Dcemacia,
	obter_valor_ds_resultado_exame(693,b.nr_sequencia,b.nr_prescricao,'D') Dccilindro,
	obter_valor_ds_resultado_exame(690,b.nr_sequencia,b.nr_prescricao,'D') Dcepitelio,
	obter_valor_ds_resultado_exame(692,b.nr_sequencia,b.nr_prescricao,'D') Dcflora_bacteriana,
	obter_valor_ds_resultado_exame(694,b.nr_sequencia,b.nr_prescricao,'D') Dccristais,
	obter_valor_ds_resultado_exame(691,b.nr_sequencia,b.nr_prescricao,'D') Dcmuco,
	null Cdresult_exm,
	null Cdsangue_fezes,
	null qtres_hemacias,
	null qtres_hemoglobina,
	null qtres_hematocrito,
	null qtres_VCM,
	null qtres_HCM,
	null qtres_CHCM,
	null qtcont_global,
	null qtmielocito,
	null qtmetamielocito,
	null qtbastonete,
	null qtsegmentado,
	null qteosinofilo,
	null qtbasofilo,
	null qtmonocito,
	null qtlinfocito,
	0 qtlinfocito_reativo,
	0 qtplasmocito,
	'0' qtplaqueta,
	b.nr_seq_lote_externo
from 	prescr_medica a,
	pessoa_juridica_estab d,
	lab_lote_externo f,
	exame_laboratorio c,
	prescr_procedimento b
where	a.nr_prescricao =  b.nr_prescricao
and	b.nr_seq_lote_externo = f.nr_sequencia
and	b.nr_seq_exame = c.nr_seq_exame
and	f.cd_cgc	= d.cd_cgc
and	d.cd_estabelecimento = a.cd_estabelecimento
and 	cd_exame = 'RURN'

union all

select 	4 ie_tipo_reg,
	d.CD_INTERNO_LAB	Cdsoc,
	a.dt_prescricao		Dtexm,
	cd_exame		cdatd_exm,
	obter_valor_ds_resultado_exame(b.nr_seq_exame,b.nr_sequencia,b.nr_prescricao,'V')	Nrest_exm,
	obter_data_aprov_lab(b.nr_prescricao, b.nr_sequencia) Dtreal_exm,
	obter_valor_ds_resultado_exame(b.nr_seq_exame,b.nr_sequencia,b.nr_prescricao,'D')		Dsdet_rest_exm,
	0 qtvolume,
	null qtdensidade,
	null qtPH,
	null dccor,
	null dcdeposito,
	null dccheiro,
	null dcreacao,
	null dcaspecto,
	null cdpres_proteinas,
	null cdpres_bilirrubina,
	null cdpres_hemoglobina,
	null cdpres_nitrito,
	null cdpres_acetona,
	null cdpres_glicose,
	null cdpres_urobilinogenio,
	null Dcpiocito,
	null Dcemacia,
	null Dccilindro,
	null Dcepitelio,
	null Dcflora_bacteriana,
	null Dccristais,
	null Dcmuco,
	substr(obter_valor_ds_resultado_exame(592,b.nr_sequencia,b.nr_prescricao,'D'),1,1) Cdresult_exm,
	substr(obter_valor_ds_resultado_exame(215,b.nr_sequencia,b.nr_prescricao,'D'),1,1) Cdsangue_fezes,
	null qtres_hemacias,
	null qtres_hemoglobina,
	null qtres_hematocrito,
	null qtres_VCM,
	null qtres_HCM,
	null qtres_CHCM,
	null qtcont_global,
	null qtmielocito,
	null qtmetamielocito,
	null qtbastonete,
	null qtsegmentado,
	null qteosinofilo,
	null qtbasofilo,
	null qtmonocito,
	null qtlinfocito,
	0 qtlinfocito_reativo,
	0 qtplasmocito,
	'0' qtplaqueta,
	b.nr_seq_lote_externo
from 	prescr_medica a,
	pessoa_juridica_estab d,
	lab_lote_externo f,
	exame_laboratorio c,
	prescr_procedimento b
where	a.nr_prescricao =  b.nr_prescricao
and	b.nr_seq_lote_externo = f.nr_sequencia
and	b.nr_seq_exame = c.nr_seq_exame
and	f.cd_cgc	= d.cd_cgc
and	d.cd_estabelecimento = a.cd_estabelecimento
and 	cd_exame = 'PSAE'

union all

select 	5 ie_tipo_reg,
	d.CD_INTERNO_LAB	Cdsoc,
	a.dt_prescricao		Dtexm,
	cd_exame		cdatd_exm,
	obter_valor_ds_resultado_exame(b.nr_seq_exame,b.nr_sequencia,b.nr_prescricao,'V')	Nrest_exm,
	obter_data_aprov_lab(b.nr_prescricao, b.nr_sequencia) Dtreal_exm,
	obter_valor_ds_resultado_exame(b.nr_seq_exame,b.nr_sequencia,b.nr_prescricao,'D')		Dsdet_rest_exm,
	0 qtvolume,
	null qtdensidade,
	null qtPH,
	null dccor,
	null dcdeposito,
	null dccheiro,
	null dcreacao,
	null dcaspecto,
	null cdpres_proteinas,
	null cdpres_bilirrubina,
	null cdpres_hemoglobina,
	null cdpres_nitrito,
	null cdpres_acetona,
	null cdpres_glicose,
	null cdpres_urobilinogenio,
	null Dcpiocito,
	null Dcemacia,
	null Dccilindro,
	null Dcepitelio,
	null Dcflora_bacteriana,
	null Dccristais,
	null Dcmuco,
	null Cdresult_exm,
	null Cdsangue_fezes,
	obter_valor_ds_resultado_exame(224,b.nr_sequencia,b.nr_prescricao,'V') qtres_hemacias,
	obter_valor_ds_resultado_exame(225,b.nr_sequencia,b.nr_prescricao,'V') qtres_hemoglobina,
	obter_valor_ds_resultado_exame(226,b.nr_sequencia,b.nr_prescricao,'V') qtres_hematocrito,
	obter_valor_ds_resultado_exame(227,b.nr_sequencia,b.nr_prescricao,'V') qtres_VCM,
	obter_valor_ds_resultado_exame(228,b.nr_sequencia,b.nr_prescricao,'V') qtres_HCM,
	obter_valor_ds_resultado_exame(229,b.nr_sequencia,b.nr_prescricao,'V') qtres_CHCM,
	obter_valor_ds_resultado_exame(700,b.nr_sequencia,b.nr_prescricao,'V') qtcont_global,
	obter_valor_ds_resultado_exame(702,b.nr_sequencia,b.nr_prescricao,'V') qtmielocito,
	obter_valor_ds_resultado_exame(706,b.nr_sequencia,b.nr_prescricao,'V') qtmetamielocito,
	obter_valor_ds_resultado_exame(707,b.nr_sequencia,b.nr_prescricao,'V') qtbastonete,
	obter_valor_ds_resultado_exame(708,b.nr_sequencia,b.nr_prescricao,'V') qtsegmentado,
	obter_valor_ds_resultado_exame(709,b.nr_sequencia,b.nr_prescricao,'V') qteosinofilo,
	obter_valor_ds_resultado_exame(710,b.nr_sequencia,b.nr_prescricao,'V') qtbasofilo,
	obter_valor_ds_resultado_exame(711,b.nr_sequencia,b.nr_prescricao,'V') qtmonocito,
	obter_valor_ds_resultado_exame(712,b.nr_sequencia,b.nr_prescricao,'V') qtlinfocito,
	0 qtlinfocito_reativo,
	0 qtplasmocito,
	obter_valor_ds_resultado_exame(744,b.nr_sequencia,b.nr_prescricao,'V') qtplaqueta,
	b.nr_seq_lote_externo
from 	prescr_medica a,
	pessoa_juridica_estab d,
	lab_lote_externo f,
	exame_laboratorio c,
	prescr_procedimento b
where	a.nr_prescricao =  b.nr_prescricao
and	b.nr_seq_lote_externo = f.nr_sequencia
and	b.nr_seq_exame = c.nr_seq_exame
and	f.cd_cgc	= d.cd_cgc
and	d.cd_estabelecimento = a.cd_estabelecimento
and 	cd_exame = 'HCOM';

