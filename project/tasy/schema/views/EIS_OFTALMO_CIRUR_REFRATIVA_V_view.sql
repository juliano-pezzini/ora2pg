-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_oftalmo_cirur_refrativa_v (nr_cirurgia, ie_tipo_cirurgia, ds_cirurgia, nr_sequencia, dt_referencia, nr_atendimento, nm_profissional, cd_profissional, ds_convenio, cd_convenio, ds_idade, cd_idade, ie_faixa_etaria, ie_wfo, ie_fcat, ie_dpcat, ie_wave_front, ie_topolyzer, ie_oculyzer, nm_medico_cirurgiao, cd_medico_cirurgiao) AS SELECT nr_cirurgia,
    IE_TIPO_CIRURGIA, 
    SUBSTR(obter_valor_dominio(3882, ie_tipo_cirurgia),1,200) ds_cirurgia, 
    nr_sequencia, 
    dt_registro dt_referencia, 
    SUBSTR(OBTER_DADOS_CIRURGIA(nr_cirurgia,'AT'),1,255) nr_atendimento, 
    SUBSTR(obter_nome_pf(cd_profissional),1,255) nm_profissional, 
    cd_profissional, 
    SUBSTR(OBTER_DESC_CONVENIO(OBTER_CD_CONVENIO_CIRURGIA(nr_cirurgia)),1,255) ds_convenio, 
    SUBSTR(OBTER_CD_CONVENIO_CIRURGIA(nr_cirurgia),1,255) cd_convenio, 
    SUBSTR(OBTER_IDADE(OBTER_DADOS_PF(OBTER_PESSOA_FISICA_CIRURGIA(nr_cirurgia),'DN'),LOCALTIMESTAMP,'A'),1,255) ds_idade, 
    SUBSTR(OBTER_IDADE(OBTER_DADOS_PF(OBTER_PESSOA_FISICA_CIRURGIA(nr_cirurgia),'DN'),LOCALTIMESTAMP,'A'),1,255) cd_idade, 
    trim(both SUBSTR(OBTER_IDADE(OBTER_DADOS_PF(OBTER_PESSOA_FISICA_CIRURGIA(nr_cirurgia),'DN'),LOCALTIMESTAMP,'E'),1,255)) ie_faixa_etaria, 
    coalesce(IE_WFO,'N') IE_WFO, 
    coalesce(IE_FCAT,'N') IE_FCAT, 
    coalesce(IE_DPCAT,'N') IE_DPCAT, 
    coalesce(IE_WAVE_FRONT,'N') IE_WAVE_FRONT, 
    coalesce(IE_TOPOLYZER,'N') IE_TOPOLYZER, 
    coalesce(IE_OCULYZER,'N') IE_OCULYZER, 
    SUBSTR(OBTER_MEDICO_CIRURGIA(nr_cirurgia,'D'),1,255) nm_medico_cirurgiao, 
    SUBSTR(OBTER_MEDICO_CIRURGIA(nr_cirurgia,'C'),1,255) cd_medico_cirurgiao 
FROM OFT_CIRURGIA_REFRATIVA 
WHERE IE_SITUACAO = 'A';

