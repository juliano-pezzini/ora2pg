-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW qt_hist_pac_agendados_v (ds_tipo_agenda, ds_agenda, dt_ordenacao, cd_tipo_agenda, ds_item, ds_convenio, nr_minuto_duracao, nr_atendimento, ds_idade, nr_telefone, ds_plano, ds_categoria, cd_usuario_convenio, nr_seq_exame, nr_seq_cons, nr_seq_radio, nr_seq_quimio, ds_status, cd_convenio_exame, cd_convenio_consulta, cd_pessoa_fisica_exame, cd_pessoa_fisica_consulta, dt_agenda_exame, dt_agenda_consulta, ie_status_agenda_exame, ie_status_agenda_consulta, ds_obs_final, ie_encaixe, nr_seq_ageint, cd_estabelecimento, nr_seq_agenda, nr_seq_item, nr_reserva, ie_duplicado_estab, nr_seq_mot_reagendamento) AS SELECT 	CASE WHEN a.cd_tipo_agenda=1 THEN 'Cirúrgica'  ELSE 'Exame' END  ds_tipo_agenda,
	a.ds_agenda ds_Agenda, 
	b.hr_inicio dt_ordenacao, 
	a.cd_tipo_Agenda, 
	SUBSTR(obter_desc_prescr_proc(b.cd_procedimento, b.ie_origem_proced,b.nr_seq_proc_interno),1,255) ds_item, 
	--SUBSTR(obter_nome_convenio(b.cd_convenio),1,255) ds_convenio, 
	d.ds_convenio ds_convenio, 
	b.nr_minuto_duracao nr_minuto_duracao, 
	b.nr_atendimento nr_atendimento, 
	SUBSTR(qt_obter_idade_pac_agenda(a.cd_tipo_Agenda,b.nr_sequencia),1,30) ds_idade, 
	substr(b.nr_telefone,1,60) nr_telefone, 
	SUBSTR(obter_desc_plano(b.cd_convenio,b.cd_plano),1,255) ds_plano, 
	SUBSTR(obter_categoria_convenio(b.cd_convenio, 	b.cd_categoria),1,255) ds_categoria, 
	b.cd_usuario_convenio cd_usuario_convenio, 
	coalesce(b.nr_sequencia,0) nr_seq_exame, 
	0 nr_seq_cons, 
	null nr_seq_radio, 
	null nr_seq_quimio, 
	--SUBSTR(obter_valor_dominio(83, b.ie_status_agenda),1,110) ds_status, 
	c.ds_Valor_dominio ds_status, 
	b.cd_convenio cd_convenio_exame, 
	null cd_convenio_consulta, 
	b.cd_pessoa_fisica cd_pessoa_fisica_exame, 
	'' cd_pessoa_fisica_consulta, 
	b.dt_agenda dt_agenda_exame, 
	null dt_agenda_consulta, 
	b.ie_status_agenda ie_status_agenda_exame, 
	'' ie_status_agenda_consulta, 
	substr(Ageint_Obter_Obs_Final(b.nr_sequencia, null, null),1,255) ds_obs_final, 
	b.ie_encaixe, 
	e.nr_seq_agenda_int nr_seq_ageint, 
	a.cd_estabelecimento, 
	coalesce(b.nr_sequencia,0) nr_seq_agenda, 
	0 nr_seq_item, 
	b.nr_reserva nr_reserva, 
	coalesce(e.ie_duplicado_estab,'N') ie_duplicado_estab, 
	0 nr_seq_mot_reagendamento 
FROM valor_dominio c, agenda a, agenda_paciente b
LEFT OUTER JOIN agenda_integrada_item e ON (b.nr_sequencia = e.nr_seq_agenda_Exame)
LEFT OUTER JOIN convenio d ON (b.cd_convenio = d.cd_convenio)
WHERE a.cd_agenda 		= b.cd_agenda and a.cd_tipo_agenda = 2  and c.cd_dominio		= 83 and c.vl_dominio		= b.ie_status_agenda  
union
 
SELECT 	CASE WHEN a.cd_tipo_agenda=5 THEN 'Serviço'  ELSE 'Consulta' END  ds_tipo_agenda, 
	--NVL(SUBSTR(obter_nome_pf(a.cd_pessoa_fisica),1,60),SUBSTR(Obter_Desc_Espec_medica(a.cd_Especialidade),1,255)) ds_Agenda, 
	CASE WHEN a.cd_tipo_agenda=5 THEN a.ds_agenda  ELSE substr(obter_nome_medico_combo_agcons(a.cd_estabelecimento, a.cd_agenda, a.cd_tipo_agenda, coalesce(a.ie_ordenacao,'N')),1,255) END  ds_Agenda, 
	c.dt_agenda dt_ordenacao, 
	a.cd_tipo_Agenda, 
	coalesce(SUBSTR(obter_nome_pf(a.cd_pessoa_fisica),1,60), SUBSTR(Obter_Desc_Espec_medica(a.cd_Especialidade),1,255)) ds_item, 
	--SUBSTR(obter_nome_convenio(c.cd_convenio),1,255) ds_convenio, 
	d.ds_convenio ds_convenio, 
	c.nr_minuto_duracao nr_minuto_duracao, 
	c.nr_atendimento nr_atendimento, 
	SUBSTR(qt_obter_idade_pac_agenda(a.cd_tipo_Agenda,c.nr_sequencia),1,30) ds_idade, 
	substr(c.nr_telefone,1,60) nr_telefone, 
	SUBSTR(obter_desc_plano(c.cd_convenio,c.cd_plano),1,255) ds_plano, 
	SUBSTR(obter_categoria_convenio(c.cd_convenio, 	c.cd_categoria),1,255) ds_categoria, 
	c.cd_usuario_convenio cd_usuario_convenio, 
	0 nr_seq_exame, 
	coalesce(c.nr_sequencia,0) nr_seq_cons, 
	null nr_seq_radio, 
	null nr_seq_quimio, 
	--SUBSTR(obter_valor_dominio(83, c.ie_status_agenda),1,110) ds_status, 
	b.ds_valor_dominio ds_status, 
	null cd_convenio_exame, 
	c.cd_convenio cd_convenio_consulta, 
	'' cd_pessoa_fisica_exame, 
	c.cd_pessoa_fisica cd_pessoa_fisica_consulta, 
	null dt_agenda_exame, 
	c.dt_agenda dt_agenda_consulta, 
	null ie_status_agenda_exame, 
	c.ie_status_agenda ie_status_agenda_consulta, 
	substr(Ageint_Obter_Obs_Final(null, c.nr_sequencia, null),1,255) ds_obs_final, 
	c.ie_encaixe, 
	e.nr_seq_agenda_int nr_seq_ageint, 
	a.cd_estabelecimento, 
	coalesce(c.nr_sequencia,0) nr_seq_agenda, 
	0 nr_seq_item, 
	c.nr_reserva nr_reserva, 
	coalesce(e.ie_duplicado_estab,'N') ie_duplicado_estab, 
	0 nr_seq_mot_reagendamento 
FROM valor_dominio b, agenda a, agenda_consulta c
LEFT OUTER JOIN agenda_integrada_item e ON (c.nr_sequencia = e.nr_seq_agenda_cons)
LEFT OUTER JOIN convenio d ON (c.cd_convenio = d.cd_convenio)
WHERE a.cd_agenda 		= c.cd_agenda  and a.cd_tipo_agenda in (3,4,5) and b.cd_dominio		= 83 and b.vl_dominio		= c.ie_status_agenda  
UNION
 
SELECT	'Radioterapia' ds_tipo_agenda, 
	SUBSTR(rxt_obter_desc_equipamento(b.nr_seq_equipamento),1,250) ds_agenda, 
	b.dt_agenda dt_ordenacao, 
	10 cd_tipo_agenda, 
	SUBSTR(rxt_obter_desc_trat_agenda(b.nr_seq_tratamento),1,240) ds_item, 
	substr(obter_dados_atendimento(b.nr_atendimento,'NC'),1,255) ds_convenio, 
	b.nr_minuto_duracao, 
	b.nr_atendimento, 
	substr(obter_idade_pf(b.cd_pessoa_fisica,b.dt_agenda,'A'),1,30) ds_idade, 
	substr(obter_compl_pf(b.cd_pessoa_fisica,1,'T'),1,60) nr_telefone, 
	substr(obter_dados_categ_conv(b.nr_atendimento,'DP'),1,255) ds_plano, 
	substr(obter_dados_categ_conv(b.nr_atendimento,'DC'),1,255) ds_categoria, 
	substr(obter_dados_categ_conv(b.nr_atendimento,'U'),1,110) cd_usuario_convenio, 
	null nr_seq_exame, 
	null nr_seq_cons, 
	b.nr_sequencia nr_seq_radio, 
	NULL nr_seq_quimio, 
	SUBSTR(obter_valor_dominio(2217, b.ie_status_agenda),1,110) ds_status, 
	(obter_dados_atendimento(b.nr_atendimento,'CC'))::numeric  cd_convenio_exame, 
	NULL cd_convenio_consulta, 
	b.cd_pessoa_fisica cd_pessoa_fisica_exame, 
	NULL cd_pessoa_fisica_consulta, 
	b.dt_agenda dt_agenda_exame, 
	NULL dt_agenda_consulta, 
	b.ie_status_agenda ie_status_agenda_exame, 
	NULL ie_status_agenda_consulta, 
	'' ds_obs_final, 
	'' ie_encaixe, 
	null nr_seq_ageint, 
	null cd_estabelecimento, 
	0 nr_seq_agenda, 
	0 nr_seq_item, 
	null nr_reserva, 
	'N' ie_duplicado_estab, 
	0 nr_seq_mot_reagendamento 
FROM	rxt_agenda b 

UNION
 
SELECT	'Quimioterapia' ds_tipo_agenda, 
	substr(obter_descricao_padrao('QT_LOCAL','DS_LOCAL',c.nr_seq_local),1,60) ds_agenda, 
	c.dt_agenda dt_ordenacao, 
	11 cd_tipo_agenda, 
	substr(obter_desc_prot_medic(e.nr_seq_paciente),1,255) ds_item, 
	substr(obter_nome_convenio(f.cd_convenio),1,255) ds_convenio, 
	c.nr_minuto_duracao, 
	c.nr_atendimento, 
	substr(obter_idade_pf(c.cd_pessoa_fisica,c.dt_agenda,'A'),1,30) ds_idade, 
	substr(obter_compl_pf(c.cd_pessoa_fisica,1,'T'),1,60) nr_telefone, 
	substr(obter_desc_plano_conv(f.cd_convenio, f.cd_plano),1,255) ds_plano, 
	substr(obter_categoria_convenio(f.cd_convenio, f.cd_categoria),1,255) ds_categoria, 
	f.cd_usuario_convenio cd_usuario_convenio, 
	null nr_seq_exame, 
	null nr_seq_cons, 
	NULL nr_seq_radio, 
	c.nr_sequencia nr_seq_quimio, 
	SUBSTR(obter_valor_dominio(3192,c.ie_status_agenda),1,110) ds_status, 
	f.cd_convenio cd_convenio_exame, 
	NULL cd_convenio_consulta, 
	c.cd_pessoa_fisica cd_pessoa_fisica_exame, 
	NULL cd_pessoa_fisica_consulta, 
	c.dt_agenda dt_agenda_exame, 
	NULL dt_agenda_consulta, 
	c.ie_status_agenda ie_status_agenda_exame, 
	NULL ie_status_agenda_consulta, 
	'' ds_obs_final, 
	c.ie_encaixe, 
	null nr_seq_ageint, 
	e.cd_estabelecimento, 
	0 nr_seq_agenda, 
	0 nr_seq_item, 
	null nr_reserva, 
	'N' ie_duplicado_estab, 
	c.nr_seq_mot_reagendamento nr_seq_mot_reagendamento 
FROM paciente_atendimento d, agenda_quimio c, paciente_setor e
LEFT OUTER JOIN paciente_setor_convenio f ON (e.nr_seq_paciente = f.nr_seq_paciente)
WHERE c.nr_seq_atendimento = d.nr_seq_atendimento AND d.nr_seq_paciente = e.nr_seq_paciente  
union
 
SELECT	'Quimioterapia' ds_tipo_agenda, 
	substr(obter_descricao_padrao('QT_LOCAL','DS_LOCAL',c.nr_seq_local),1,60) ds_agenda, 
	c.dt_agenda dt_ordenacao, 
	11 cd_tipo_agenda, 
	substr(qt_obter_desc_tipo_agenda(b.ie_tipo_pend_agenda),1,255) ds_item, 
	substr(obter_nome_convenio(a.cd_convenio),1,255) ds_convenio, 
	c.nr_minuto_duracao, 
	c.nr_atendimento, 
	substr(obter_idade_pf(c.cd_pessoa_fisica,c.dt_agenda,'A'),1,30) ds_idade, 
	substr(obter_compl_pf(c.cd_pessoa_fisica,1,'T'),1,60) nr_telefone, 
	substr(obter_desc_plano_conv(a.cd_convenio, a.cd_plano),1,255) ds_plano, 
	substr(obter_categoria_convenio(a.cd_convenio, a.cd_categoria),1,255) ds_categoria, 
	a.cd_usuario_convenio cd_usuario_convenio, 
	null nr_seq_exame, 
	null nr_seq_cons, 
	NULL nr_seq_radio, 
	c.nr_sequencia nr_seq_quimio, 
	SUBSTR(obter_valor_dominio(3192,c.ie_status_agenda),1,110) ds_status, 
	a.cd_convenio cd_convenio_exame, 
	NULL cd_convenio_consulta, 
	c.cd_pessoa_fisica cd_pessoa_fisica_exame, 
	NULL cd_pessoa_fisica_consulta, 
	c.dt_agenda dt_agenda_exame, 
	NULL dt_agenda_consulta, 
	c.ie_status_agenda ie_status_agenda_exame, 
	NULL ie_status_agenda_consulta, 
	'' ds_obs_final, 
	c.ie_encaixe, 
	null nr_seq_ageint, 
	a.cd_estabelecimento, 
	0 nr_seq_agenda, 
	b.nr_sequencia nr_seq_item, 
	null nr_reserva, 
	coalesce(b.ie_duplicado_estab,'N') ie_duplicado_estab, 
	c.nr_seq_mot_reagendamento nr_seq_mot_reagendamento 
FROM	agenda_quimio c, agenda_integrada_item b, agenda_integrada a 
where	c.nr_seq_ageint_item = b.nr_sequencia 
and	b.nr_seq_agenda_int = a.nr_sequencia;

