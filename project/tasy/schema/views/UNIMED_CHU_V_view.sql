-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW unimed_chu_v (tp_registro, ie_tipo_prestador, cd_prestador, nm_prestador, nr_lote, dt_geracao, cd_tipo_documento, nr_documento, nr_cep, cd_tipo_prestador, nr_crm, dt_inicio_internacao, dt_alta, ie_padrao_internacao, cd_unimed_usuario, cd_contrato_usuario, cd_familia_usuario, ie_dependencia_usuario, ie_digito_ver_usuario, dt_exec_servico, hr_exec_servico, cd_cid, ie_detalhe_cid, cd_dig_verif_cid, cd_seq_doc_servico, cd_amb_lpm, cd_dig_verif_servico, qt_servico_executado, ie_porte_cirurgico, ie_partic_executante, cd_local_atendimento, vl_servico, cd_moeda_servico, vl_filme, cd_moeda_filme, nr_autorizacao, cd_fator_plano, ie_tipo_prest_executante, cd_prest_executante, ie_situacao_guia, nm_usuario, hr_saida_paciente, nr_seq_protocolo, nr_atendimento, nr_interno_conta, qt_doc_enviados, qt_serv_relacionados, qt_total_servicos_real, qt_total_cobrado_ch, qt_total_filme, cd_campo_quebra, pr_faturado) AS select	0					tp_registro,
		4					ie_tipo_prestador, 
		127					cd_prestador, 
		substr(a.nm_hospital,1,40)	nm_prestador, 
		a.nr_seq_protocolo		nr_lote, 
		a.dt_remessa			dt_geracao, 
		0					cd_tipo_documento, 
		''					nr_documento, 
		''					nr_cep, 
		1					cd_tipo_prestador, 
		''					nr_crm, 
		LOCALTIMESTAMP				dt_inicio_internacao, 
		LOCALTIMESTAMP				dt_alta, 
		0					ie_padrao_internacao, 
		''					cd_unimed_usuario, 
		''					cd_contrato_usuario, 
		''					cd_familia_usuario, 
		''					ie_dependencia_usuario, 
		''					ie_digito_ver_usuario, 
		''					dt_exec_servico, 
		''					hr_exec_servico, 
		''					cd_cid, 
		''					ie_detalhe_cid, 
		''					cd_dig_verif_cid, 
		0					cd_seq_doc_servico, 
		''					cd_amb_lpm, 
		''					cd_dig_verif_servico, 
		0					qt_servico_executado, 
		''					ie_porte_cirurgico, 
		''					ie_partic_executante, 
		0					cd_local_atendimento, 
		0					vl_servico, 
		6					cd_moeda_servico, 
		0					vl_filme, 
		6					cd_moeda_filme, 
		''					nr_autorizacao, 
		0					cd_fator_plano, 
		0					ie_tipo_prest_executante, 
		0					cd_prest_executante, 
		''					ie_situacao_guia, 
		''					nm_usuario, 
		''					hr_saida_paciente, 
		a.nr_seq_protocolo		nr_seq_protocolo, 
		0					nr_atendimento, 
		0					nr_interno_conta, 
		0					qt_doc_enviados, 
		0					qt_serv_relacionados, 
		0					qt_total_servicos_real, 
		0					qt_total_cobrado_ch, 
		0					qt_total_filme, 
		0					cd_campo_quebra, 
		0					pr_faturado 
FROM 	w_interf_conta_header a 

union all
 
select	1					tp_registro, 
		4					ie_tipo_prestador, 
		127					cd_prestador, 
		''					nm_prestador, 
		0					nr_lote, 
		LOCALTIMESTAMP				dt_geracao, 
		CASE WHEN a.ie_tipo_atendimento=1 THEN 2 WHEN a.ie_tipo_atendimento=3 THEN 6 WHEN a.ie_tipo_atendimento=7 THEN 9  ELSE 2 END  
							cd_tipo_documento, 
		b.nr_doc_convenio			nr_documento, 
		''					nr_cep, 
		1					cd_tipo_prestador, 
		CASE WHEN b.nr_crm_executor IS NULL THEN a.nr_crm_medico_resp  ELSE b.nr_crm_executor END  nr_crm, 
		a.dt_entrada			dt_inicio_internacao, 
		CASE WHEN a.ie_tipo_atendimento=7 THEN a.dt_entrada  ELSE a.dt_alta END  dt_alta, 
		CASE WHEN obter_atepacu_paciente(b.nr_atendimento,'PI')=0 THEN 0  ELSE a.cd_tipo_acomodacao END  
							ie_padrao_internacao, 
		CASE WHEN b.cd_convenio=10 THEN  '027'  ELSE substr(a.cd_usuario_convenio,1,3) END  
			 				cd_unimed_usuario, 
		CASE WHEN b.cd_convenio=10 THEN  '9999'  ELSE substr(a.cd_usuario_convenio,4,4) END  
							cd_contrato_usuario, 
		CASE WHEN b.cd_convenio=10 THEN  '000000'  ELSE substr(a.cd_usuario_convenio,8,6) END  
							cd_familia_usuario, 
		CASE WHEN b.cd_convenio=10 THEN  '00'  ELSE substr(a.cd_usuario_convenio,14,2) END  
							ie_dependencia_usuario, 
		CASE WHEN b.cd_convenio=10 THEN  '0'  ELSE substr(a.cd_usuario_convenio,16,1) END  
							ie_digito_ver_usuario, 
		to_char(a.dt_entrada,'ddmmyyyy')	dt_exec_servico, 
		to_char(a.dt_entrada,'hh24mi')	hr_exec_servico, 
		a.cd_cid_principal		cd_cid, 
		''					ie_detalhe_cid, 
		''					cd_dig_verif_cid, 
		0					cd_seq_doc_servico, 
		CASE WHEN coalesce(b.cd_item_convenio,b.cd_item)='10014' THEN '1001' WHEN coalesce(b.cd_item_convenio,b.cd_item)='10022' THEN '1002' WHEN coalesce(b.cd_item_convenio,b.cd_item)='1007' THEN '1007'  ELSE substr(coalesce(b.cd_item_convenio,b.cd_item),1,7) END  cd_amb_lpm, 
		'0' cd_dig_verif_servico, 
		sum(b.qt_item)				qt_servico_executado, 
		to_char(b.nr_porte_anestesico)	ie_porte_cirurgico, 
		to_char(b.cd_funcao_executor)		ie_partic_executante, 
		CASE WHEN b.cd_cgc_prestador='86897113000157' THEN 9 WHEN b.cd_cgc_prestador='82606450000197' THEN 9 WHEN b.cd_cgc_prestador='03049264000128' THEN 9 WHEN b.cd_cgc_prestador='06243625000160' THEN 9  ELSE CASE WHEN b.ie_responsavel_credito='M' THEN 9  ELSE 8 END  END  
							cd_local_atendimento, 
		sum(CASE WHEN b.cd_convenio=10 THEN CASE WHEN coalesce(b.cd_item_convenio,b.cd_item)='1007' THEN  			b.vl_honorario WHEN coalesce(b.cd_item_convenio,b.cd_item)='8004357' THEN b.vl_honorario WHEN coalesce(b.cd_item_convenio,b.cd_item)='8004352' THEN b.vl_honorario  ELSE (b.vl_total_item - coalesce(b.vl_filme,0)) END   ELSE (b.vl_total_item - coalesce(b.vl_filme,0)) END ) vl_servico, 
		6					cd_moeda_servico, 
		sum(b.vl_filme)				vl_filme, 
		6					cd_moeda_filme, 
		b.nr_doc_convenio			nr_autorizacao, 
		coalesce(x.tx_procedimento,100) 	cd_fator_plano, 
		CASE WHEN b.cd_cgc_prestador='86897113000157' THEN 25 WHEN b.cd_cgc_prestador='82606450000197' THEN 19 WHEN b.cd_cgc_prestador='03049264000128' THEN 25 WHEN b.cd_cgc_prestador='06243625000160' THEN 25  ELSE CASE WHEN b.ie_responsavel_credito='M' THEN 1  ELSE CASE WHEN a.ie_tipo_atendimento=7 THEN 3  ELSE CASE WHEN b.cd_setor_atendimento=14 THEN 6 WHEN b.cd_setor_atendimento=15 THEN 6 WHEN b.cd_setor_atendimento=49 THEN 6 WHEN b.cd_setor_atendimento=50 THEN 6 WHEN b.cd_setor_atendimento=58 THEN 6 WHEN b.cd_setor_atendimento=59 THEN 6 WHEN b.cd_setor_atendimento=16 THEN 26 WHEN b.cd_setor_atendimento=18 THEN 24 WHEN b.cd_setor_atendimento=67 THEN 21  ELSE 4 END  END  END  END  
							ie_tipo_prest_executante, 
		CASE WHEN b.cd_cgc_prestador='86897113000157' THEN 01 WHEN b.cd_cgc_prestador='82606450000197' THEN 201 WHEN b.cd_cgc_prestador='03049264000128' THEN 02 WHEN b.cd_cgc_prestador='06243625000160' THEN 3  ELSE CASE WHEN b.ie_responsavel_credito='M' THEN somente_numero(b.nr_crm_executor)  ELSE CASE WHEN b.cd_setor_atendimento=16 THEN 01 WHEN b.cd_setor_atendimento=18 THEN 01 WHEN b.cd_setor_atendimento=67 THEN 316  ELSE 127 END  END  END  
							cd_prest_executante, 
		''					ie_situacao_guia, 
		substr(a.nm_paciente,1,25)	nm_usuario, 
		to_char(a.dt_alta,'hh24mi')	hr_saida_paciente, 
		a.nr_seq_protocolo		nr_seq_protocolo, 
		a.nr_atendimento			nr_atendimento, 
		a.nr_interno_conta		nr_interno_conta, 
		0					qt_doc_enviados, 
		0					qt_serv_relacionados, 
		0					qt_total_servicos_real, 
		0					qt_total_cobrado_ch, 
		0					qt_total_filme, 
		a.nr_interno_conta 		cd_campo_quebra, 
		coalesce(x.tx_procedimento,100)	pr_faturado 
FROM w_interf_conta_cab a, w_interf_conta_item b
LEFT OUTER JOIN procedimento_paciente x ON (b.nr_interno_conta = x.nr_interno_conta AND b.nr_seq_item = x.nr_sequencia)
WHERE b.nr_interno_conta		= a.nr_interno_conta and b.ie_tipo_item			= 1   group by 
		CASE WHEN a.ie_tipo_atendimento=1 THEN 2 WHEN a.ie_tipo_atendimento=3 THEN 6 WHEN a.ie_tipo_atendimento=7 THEN 9  ELSE 2 END , 
		b.nr_doc_convenio, 
		CASE WHEN b.nr_crm_executor IS NULL THEN a.nr_crm_medico_resp  ELSE b.nr_crm_executor END , 
		a.dt_entrada, 
		CASE WHEN a.ie_tipo_atendimento=7 THEN a.dt_entrada  ELSE a.dt_alta END , 
		CASE WHEN obter_atepacu_paciente(b.nr_atendimento,'PI')=0 THEN 0  ELSE a.cd_tipo_acomodacao END , 
		CASE WHEN b.cd_convenio=10 THEN  '027'  ELSE substr(a.cd_usuario_convenio,1,3) END , 
		CASE WHEN b.cd_convenio=10 THEN  '9999'  ELSE substr(a.cd_usuario_convenio,4,4) END , 
		CASE WHEN b.cd_convenio=10 THEN  '000000'  ELSE substr(a.cd_usuario_convenio,8,6) END , 
		CASE WHEN b.cd_convenio=10 THEN  '00'  ELSE substr(a.cd_usuario_convenio,14,2) END , 
		CASE WHEN b.cd_convenio=10 THEN  '0'  ELSE substr(a.cd_usuario_convenio,16,1) END , 
		to_char(a.dt_entrada,'ddmmyyyy'), 
		to_char(a.dt_entrada,'hh24mi'), 
		a.cd_cid_principal, 
		CASE WHEN coalesce(b.cd_item_convenio,b.cd_item)='10014' THEN '1001' WHEN coalesce(b.cd_item_convenio,b.cd_item)='10022' THEN '1002' WHEN coalesce(b.cd_item_convenio,b.cd_item)='1007' THEN '1007'  ELSE substr(coalesce(b.cd_item_convenio,b.cd_item),1,7) END , 
		to_char(b.nr_porte_anestesico), 
		to_char(b.cd_funcao_executor), 
		CASE WHEN b.cd_cgc_prestador='86897113000157' THEN 9 WHEN b.cd_cgc_prestador='82606450000197' THEN 9 WHEN b.cd_cgc_prestador='03049264000128' THEN 9 WHEN b.cd_cgc_prestador='06243625000160' THEN 9  ELSE CASE WHEN b.ie_responsavel_credito='M' THEN 9  ELSE 8 END  END , 
		b.nr_doc_convenio, 
		coalesce(x.tx_procedimento,100), 
		CASE WHEN b.cd_cgc_prestador='86897113000157' THEN 25 WHEN b.cd_cgc_prestador='82606450000197' THEN 19 WHEN b.cd_cgc_prestador='03049264000128' THEN 25 WHEN b.cd_cgc_prestador='06243625000160' THEN 25  ELSE CASE WHEN b.ie_responsavel_credito='M' THEN 1  ELSE CASE WHEN a.ie_tipo_atendimento=7 THEN 3  ELSE CASE WHEN b.cd_setor_atendimento=14 THEN 6 WHEN b.cd_setor_atendimento=15 THEN 6 WHEN b.cd_setor_atendimento=49 THEN 6 WHEN b.cd_setor_atendimento=50 THEN 6 WHEN b.cd_setor_atendimento=58 THEN 6 WHEN b.cd_setor_atendimento=59 THEN 6 WHEN b.cd_setor_atendimento=16 THEN 26 WHEN b.cd_setor_atendimento=18 THEN 24 WHEN b.cd_setor_atendimento=67 THEN 21  ELSE 4 END  END  END  END , 
		CASE WHEN b.cd_cgc_prestador='86897113000157' THEN 01 WHEN b.cd_cgc_prestador='82606450000197' THEN 201 WHEN b.cd_cgc_prestador='03049264000128' THEN 02 WHEN b.cd_cgc_prestador='06243625000160' THEN 03  ELSE CASE WHEN b.ie_responsavel_credito='M' THEN somente_numero(b.nr_crm_executor)  ELSE CASE WHEN b.cd_setor_atendimento=16 THEN 01 WHEN b.cd_setor_atendimento=18 THEN 01 WHEN b.cd_setor_atendimento=67 THEN 316  ELSE 127 END  END  END , 
		substr(a.nm_paciente,1,25), 
		to_char(a.dt_alta,'hh24mi'), 
		a.nr_seq_protocolo, 
		a.nr_atendimento, 
		a.nr_interno_conta 
	having 
		sum(b.qt_item) > 0 

union all
 
select	1					tp_registro, 
		4					ie_tipo_prestador, 
		127					cd_prestador, 
		''					nm_prestador, 
		0					nr_lote, 
		LOCALTIMESTAMP				dt_geracao, 
		CASE WHEN a.ie_tipo_atendimento=1 THEN 2 WHEN a.ie_tipo_atendimento=3 THEN 6 WHEN a.ie_tipo_atendimento=7 THEN 9  ELSE 2 END  
							cd_tipo_documento, 
		b.nr_doc_convenio			nr_documento, 
		''					nr_cep, 
		1					cd_tipo_prestador, 
		CASE WHEN b.nr_crm_executor IS NULL THEN a.nr_crm_medico_resp  ELSE b.nr_crm_executor END  nr_crm, 
		a.dt_entrada			dt_inicio_internacao, 
		CASE WHEN a.ie_tipo_atendimento=7 THEN a.dt_entrada  ELSE a.dt_alta END  dt_alta, 
		CASE WHEN obter_atepacu_paciente(b.nr_atendimento,'PI')=0 THEN 0  ELSE a.cd_tipo_acomodacao END  
							ie_padrao_internacao, 
		CASE WHEN b.cd_convenio=10 THEN  '027'  ELSE substr(a.cd_usuario_convenio,1,3) END  
			 				cd_unimed_usuario, 
		CASE WHEN b.cd_convenio=10 THEN  '9999'  ELSE substr(a.cd_usuario_convenio,4,4) END  
							cd_contrato_usuario, 
		CASE WHEN b.cd_convenio=10 THEN  '000000'  ELSE substr(a.cd_usuario_convenio,8,6) END  
							cd_familia_usuario, 
		CASE WHEN b.cd_convenio=10 THEN  '00'  ELSE substr(a.cd_usuario_convenio,14,2) END  
							ie_dependencia_usuario, 
		CASE WHEN b.cd_convenio=10 THEN  '0'  ELSE substr(a.cd_usuario_convenio,16,1) END  
							ie_digito_ver_usuario, 
		to_char(a.dt_entrada,'ddmmyyyy')	dt_exec_servico, 
		to_char(a.dt_entrada,'hh24mi')	hr_exec_servico, 
		a.cd_cid_principal		cd_cid, 
		''					ie_detalhe_cid, 
		''					cd_dig_verif_cid, 
		0					cd_seq_doc_servico, 
		CASE WHEN coalesce(b.cd_item_convenio,b.cd_item)='10014' THEN '1001' WHEN coalesce(b.cd_item_convenio,b.cd_item)='10022' THEN '1002' WHEN coalesce(b.cd_item_convenio,b.cd_item)='1007' THEN '1007'  ELSE substr(coalesce(b.cd_item_convenio,b.cd_item),1,7) END  cd_amb_lpm, 
		'0' cd_dig_verif_servico, 
		sum(b.qt_item)				qt_servico_executado, 
		to_char(b.nr_porte_anestesico)	ie_porte_cirurgico, 
		to_char(b.cd_funcao_executor)		ie_partic_executante, 
		8					cd_local_atendimento, 
		sum(b.vl_custo_oper)		vl_servico, 
		6					cd_moeda_servico, 
		0					vl_filme, 
		6					cd_moeda_filme, 
		b.nr_doc_convenio			nr_autorizacao, 
		CASE WHEN a.cd_categoria_convenio='1' THEN 100  ELSE 200 END  
							cd_fator_plano, 
		CASE WHEN b.cd_setor_atendimento=18 THEN 24  ELSE 06 END 					ie_tipo_prest_executante, 
		CASE WHEN b.cd_setor_atendimento=18 THEN 01  ELSE 127 END 					cd_prest_executante, 
		''					ie_situacao_guia, 
		substr(a.nm_paciente,1,25)	nm_usuario, 
		to_char(a.dt_alta,'hh24mi')	hr_saida_paciente, 
		a.nr_seq_protocolo		nr_seq_protocolo, 
		a.nr_atendimento			nr_atendimento, 
		a.nr_interno_conta		nr_interno_conta, 
		0					qt_doc_enviados, 
		0					qt_serv_relacionados, 
		0					qt_total_servicos_real, 
		0					qt_total_cobrado_ch, 
		0					qt_total_filme, 
		a.nr_interno_conta 		cd_campo_quebra, 
		100					pr_faturado 
from		w_interf_conta_item b, 
		w_interf_conta_cab a 
where		b.nr_interno_conta		= a.nr_interno_conta 
and		b.ie_tipo_item			= 1 
and		b.cd_convenio			= 10 
and		coalesce(b.cd_item_convenio,b.cd_item) in ('1007','8004357','8004352') 
group by 
		CASE WHEN a.ie_tipo_atendimento=1 THEN 2 WHEN a.ie_tipo_atendimento=3 THEN 6 WHEN a.ie_tipo_atendimento=7 THEN 9  ELSE 2 END , 
		b.nr_doc_convenio, 
		CASE WHEN b.nr_crm_executor IS NULL THEN a.nr_crm_medico_resp  ELSE b.nr_crm_executor END , 
		a.dt_entrada, 
		CASE WHEN a.ie_tipo_atendimento=7 THEN a.dt_entrada  ELSE a.dt_alta END , 
		CASE WHEN obter_atepacu_paciente(b.nr_atendimento,'PI')=0 THEN 0  ELSE a.cd_tipo_acomodacao END , 
		CASE WHEN b.cd_convenio=10 THEN  '027'  ELSE substr(a.cd_usuario_convenio,1,3) END , 
		CASE WHEN b.cd_convenio=10 THEN  '9999'  ELSE substr(a.cd_usuario_convenio,4,4) END , 
		CASE WHEN b.cd_convenio=10 THEN  '000000'  ELSE substr(a.cd_usuario_convenio,8,6) END , 
		CASE WHEN b.cd_convenio=10 THEN  '00'  ELSE substr(a.cd_usuario_convenio,14,2) END , 
		CASE WHEN b.cd_convenio=10 THEN  '0'  ELSE substr(a.cd_usuario_convenio,16,1) END , 
		to_char(a.dt_entrada,'ddmmyyyy'), 
		to_char(a.dt_entrada,'hh24mi'), 
		a.cd_cid_principal, 
		CASE WHEN coalesce(b.cd_item_convenio,b.cd_item)='10014' THEN '1001' WHEN coalesce(b.cd_item_convenio,b.cd_item)='10022' THEN '1002' WHEN coalesce(b.cd_item_convenio,b.cd_item)='1007' THEN '1007'  ELSE substr(coalesce(b.cd_item_convenio,b.cd_item),1,7) END , 
		to_char(b.nr_porte_anestesico), 
		to_char(b.cd_funcao_executor), 
  CASE WHEN b.cd_setor_atendimento=18 THEN 24  ELSE 06 END , 
  CASE WHEN b.cd_setor_atendimento=18 THEN 01  ELSE 127 END , 
		b.nr_doc_convenio, 
		CASE WHEN a.cd_categoria_convenio='1' THEN 100  ELSE 200 END , 
		substr(a.nm_paciente,1,25), 
		to_char(a.dt_alta,'hh24mi'), 
		a.nr_seq_protocolo, 
		a.nr_atendimento, 
		a.nr_interno_conta 
	having 
		sum(b.qt_item) > 0 

union all
 
select	1					tp_registro, 
		4					ie_tipo_prestador, 
		127					cd_prestador, 
		''					nm_prestador, 
		0					nr_lote, 
		LOCALTIMESTAMP				dt_geracao, 
		CASE WHEN a.ie_tipo_atendimento=1 THEN 2 WHEN a.ie_tipo_atendimento=3 THEN 6 WHEN a.ie_tipo_atendimento=7 THEN 9  ELSE 2 END  
							cd_tipo_documento, 
		b.nr_doc_convenio			nr_documento, 
		''					nr_cep, 
		1					cd_tipo_prestador, 
		CASE WHEN b.nr_crm_executor IS NULL THEN a.nr_crm_medico_resp  ELSE b.nr_crm_executor END  nr_crm, 
		a.dt_entrada			dt_inicio_internacao, 
		CASE WHEN a.ie_tipo_atendimento=7 THEN a.dt_entrada  ELSE a.dt_alta END  dt_alta, 
		CASE WHEN obter_atepacu_paciente(b.nr_atendimento,'PI')=0 THEN 0  ELSE a.cd_tipo_acomodacao END  
							ie_padrao_internacao, 
		CASE WHEN b.cd_convenio=10 THEN  '027'  ELSE substr(a.cd_usuario_convenio,1,3) END  
			 				cd_unimed_usuario, 
		CASE WHEN b.cd_convenio=10 THEN  '9999'  ELSE substr(a.cd_usuario_convenio,4,4) END  
							cd_contrato_usuario, 
		CASE WHEN b.cd_convenio=10 THEN  '000000'  ELSE substr(a.cd_usuario_convenio,8,6) END  
							cd_familia_usuario, 
		CASE WHEN b.cd_convenio=10 THEN  '00'  ELSE substr(a.cd_usuario_convenio,14,2) END  
							ie_dependencia_usuario, 
		CASE WHEN b.cd_convenio=10 THEN  '0'  ELSE substr(a.cd_usuario_convenio,16,1) END  
							ie_digito_ver_usuario, 
		to_char(a.dt_entrada,'ddmmyyyy') 
							dt_exec_servico, 
		to_char(a.dt_entrada,'hh24mi') 
							hr_exec_servico, 
		null					cd_cid, 
		''					ie_detalhe_cid, 
		''					cd_dig_verif_cid, 
		0					cd_seq_doc_servico, 
		substr(coalesce(b.cd_item_convenio,b.cd_item),1,7) cd_amb_lpm, 
		'0'					cd_dig_verif_servico, 
		1					qt_servico_executado, 
		''					ie_porte_cirurgico, 
		''					ie_partic_executante, 
		8					cd_local_atendimento, 
		sum(b.vl_total_item)		vl_servico, 
		6					cd_moeda_servico, 
		0					vl_filme, 
		6					cd_moeda_filme, 
		b.nr_doc_convenio			nr_autorizacao, 
		CASE WHEN a.cd_categoria_convenio='1' THEN 100  ELSE 200 END  
							cd_fator_plano, 
		CASE WHEN b.cd_cgc_prestador='86897113000157' THEN 25 WHEN b.cd_cgc_prestador='82606450000197' THEN 19 WHEN b.cd_cgc_prestador='03049264000128' THEN 25 WHEN b.cd_cgc_prestador='06243625000160' THEN 25  ELSE CASE WHEN b.ie_responsavel_credito='M' THEN 1  ELSE CASE WHEN a.ie_tipo_atendimento=7 THEN 3  ELSE CASE WHEN b.cd_setor_atendimento=14 THEN 6 WHEN b.cd_setor_atendimento=15 THEN 6 WHEN b.cd_setor_atendimento=49 THEN 6 WHEN b.cd_setor_atendimento=50 THEN 6 WHEN b.cd_setor_atendimento=58 THEN 6 WHEN b.cd_setor_atendimento=59 THEN 6 WHEN b.cd_setor_atendimento=16 THEN 26 WHEN b.cd_setor_atendimento=18 THEN 24 WHEN b.cd_setor_atendimento=67 THEN 21  ELSE 4 END  END  END  END  
							ie_tipo_prest_executante, 
		CASE WHEN b.cd_setor_atendimento=16 THEN 01 WHEN b.cd_setor_atendimento=18 THEN 01 WHEN b.cd_setor_atendimento=67 THEN 316  ELSE 127 END  
							cd_prest_executante, 
		''					ie_situacao_guia, 
		substr(a.nm_paciente,1,25)	nm_usuario, 
		to_char(a.dt_alta,'hh24mi')	hr_saida_paciente, 
		a.nr_seq_protocolo		nr_seq_protocolo, 
		a.nr_atendimento			nr_atendimento, 
		a.nr_interno_conta		nr_interno_conta, 
		0					qt_doc_enviados, 
		0					qt_serv_relacionados, 
		0					qt_total_servicos_real, 
		0					qt_total_cobrado_ch, 
		0					qt_total_filme, 
		a.nr_interno_conta		cd_campo_quebra, 
		100					pr_faturado 
from		w_interf_conta_item b, 
		w_interf_conta_cab a 
where		b.nr_interno_conta		= a.nr_interno_conta 
and		b.ie_tipo_item			= 2 
group by 
		4, 
		127, 
		CASE WHEN a.ie_tipo_atendimento=1 THEN 2 WHEN a.ie_tipo_atendimento=3 THEN 6 WHEN a.ie_tipo_atendimento=7 THEN 9  ELSE 2 END , 
		b.nr_doc_convenio, 
		CASE WHEN b.nr_crm_executor IS NULL THEN a.nr_crm_medico_resp  ELSE b.nr_crm_executor END , 
		a.dt_entrada, 
		CASE WHEN a.ie_tipo_atendimento=7 THEN a.dt_entrada  ELSE a.dt_alta END , 
		CASE WHEN obter_atepacu_paciente(b.nr_atendimento,'PI')=0 THEN 0  ELSE a.cd_tipo_acomodacao END , 
		CASE WHEN b.cd_convenio=10 THEN  '027'  ELSE substr(a.cd_usuario_convenio,1,3) END , 
		CASE WHEN b.cd_convenio=10 THEN  '9999'  ELSE substr(a.cd_usuario_convenio,4,4) END , 
		CASE WHEN b.cd_convenio=10 THEN  '000000'  ELSE substr(a.cd_usuario_convenio,8,6) END , 
		CASE WHEN b.cd_convenio=10 THEN  '00'  ELSE substr(a.cd_usuario_convenio,14,2) END , 
		CASE WHEN b.cd_convenio=10 THEN  '0'  ELSE substr(a.cd_usuario_convenio,16,1) END , 
		to_char(a.dt_entrada,'ddmmyyyy'), 
		to_char(a.dt_entrada,'hh24mi'), 
		substr(coalesce(b.cd_item_convenio,b.cd_item),1,7), 
		'0', 
		a.cd_tipo_acomodacao, 
		b.nr_doc_convenio, 
		CASE WHEN a.cd_categoria_convenio='1' THEN 100  ELSE 200 END , 
		CASE WHEN b.cd_cgc_prestador='86897113000157' THEN 25 WHEN b.cd_cgc_prestador='82606450000197' THEN 19 WHEN b.cd_cgc_prestador='03049264000128' THEN 25 WHEN b.cd_cgc_prestador='06243625000160' THEN 25  ELSE CASE WHEN b.ie_responsavel_credito='M' THEN 1  ELSE CASE WHEN a.ie_tipo_atendimento=7 THEN 3  ELSE CASE WHEN b.cd_setor_atendimento=14 THEN 6 WHEN b.cd_setor_atendimento=15 THEN 6 WHEN b.cd_setor_atendimento=49 THEN 6 WHEN b.cd_setor_atendimento=50 THEN 6 WHEN b.cd_setor_atendimento=58 THEN 6 WHEN b.cd_setor_atendimento=59 THEN 6 WHEN b.cd_setor_atendimento=16 THEN 26 WHEN b.cd_setor_atendimento=18 THEN 24 WHEN b.cd_setor_atendimento=67 THEN 21  ELSE 4 END  END  END  END , 
		CASE WHEN b.cd_setor_atendimento=16 THEN 01 WHEN b.cd_setor_atendimento=18 THEN 01 WHEN b.cd_setor_atendimento=67 THEN 316  ELSE 127 END , 
		substr(a.nm_paciente,1,25), 
		to_char(a.dt_alta,'hh24mi'), 
		a.nr_seq_protocolo, 
		a.nr_atendimento, 
		a.nr_interno_conta 
	having 
		sum(b.vl_total_item) > 0 

union all
 
select	9					tp_registro, 
		4					ie_tipo_prestador, 
		127					cd_prestador, 
		''					nm_prestador, 
		0					nr_lote, 
		LOCALTIMESTAMP				dt_geracao, 
		0					cd_tipo_documento, 
		''					nr_documento, 
		''					nr_cep, 
		1					cd_tipo_prestador, 
		''					nr_crm, 
		LOCALTIMESTAMP				dt_inicio_internacao, 
		LOCALTIMESTAMP				dt_alta, 
		0					ie_padrao_internacao, 
		''					cd_unimed_usuario, 
		''					cd_contrato_usuario, 
		''					cd_familia_usuario, 
		''					ie_dependencia_usuario, 
		''					ie_digito_ver_usuario, 
		''					dt_exec_servico, 
		''					hr_exec_servico, 
		''					cd_cid, 
		''					ie_detalhe_cid, 
		''					cd_dig_verif_cid, 
		0					cd_seq_doc_servico, 
		''					cd_amb_lpm, 
		''					cd_dig_verif_servico, 
		0					qt_servico_executado, 
		''					ie_porte_cirurgico, 
		''					ie_partic_executante, 
		0					cd_local_atendimento, 
		0					vl_servico, 
		0					cd_moeda_servico, 
		0					vl_filme, 
		0					cd_moeda_filme, 
		''					nr_autorizacao, 
		0					cd_fator_plano, 
		0					ie_tipo_prest_executante, 
		0					cd_prest_executante, 
		''					ie_situacao_guia, 
		''					nm_usuario, 
		''					hr_saida_paciente, 
		x.nr_seq_protocolo		nr_seq_protocolo, 
		0					nr_atendimento, 
		0					nr_interno_conta, 
		x.qt_total_conta			qt_doc_enviados, 
		0					qt_serv_relacionados, 
		sum(b.vl_total_item)		qt_total_servicos_real, 
		0					qt_total_cobrado_ch, 
		sum(b.vl_filme)			qt_total_filme, 
		0					cd_campo_quebra, 
		0					pr_faturado 
from 	w_interf_conta_trailler x, 
		w_interf_conta_item b 
where		x.nr_seq_protocolo	= b.nr_seq_protocolo 
group by 
		x.nr_seq_protocolo, 
		x.qt_total_conta;

