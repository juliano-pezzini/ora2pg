-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW cpoe_material_mat_add_v (nr_sequencia, nr_atendimento, ie_tipo_item, cd_material, cd_unidade_medida, qt_dose, nr_ocorrencia, ie_via_aplicacao, qt_solucao, dt_inicio, dt_fim, nm_usuario, dt_liberacao, ds_horarios, ds_dose_diferenciada) AS select	nr_sequencia,
		nr_atendimento,
		'MCOMP1' ie_tipo_item,
		cd_mat_comp1 cd_material,
		cd_unid_med_dose_comp1 cd_unidade_medida,
		qt_dose_comp1 qt_dose,
		nr_ocorrencia,
		ie_via_aplicacao,
		coalesce(obter_conversao_ml(cd_mat_comp1,qt_dose_comp1,cd_unid_med_dose_comp1),0) qt_solucao,
		dt_inicio,
		CASE WHEN dt_lib_suspensao IS NULL THEN  coalesce(dt_fim_cih,dt_fim)  ELSE coalesce(dt_suspensao,dt_fim) END  dt_fim,
		nm_usuario nm_usuario,
		dt_liberacao dt_liberacao,
		ds_horarios,
		ds_dose_diferenciada_comp1 ds_dose_diferenciada
FROM	cpoe_material
where	((CASE WHEN dt_lib_suspensao IS NULL THEN  coalesce(dt_fim_cih,dt_fim)  ELSE coalesce(dt_suspensao,dt_fim) END  is null) or (CASE WHEN dt_lib_suspensao IS NULL THEN  coalesce(dt_fim_cih,dt_fim)  ELSE coalesce(dt_suspensao,dt_fim) END  >= trunc(LOCALTIMESTAMP,'mi')))
and		cd_mat_comp1 is not null

union all

select	nr_sequencia,
		nr_atendimento,
		'MCOMP2',
		cd_mat_comp2,
		cd_unid_med_dose_comp2,
		qt_dose_comp2,
		nr_ocorrencia,
		ie_via_aplicacao,
		coalesce(obter_conversao_ml(cd_mat_comp2,qt_dose_comp2,cd_unid_med_dose_comp2),0),
		dt_inicio,
		CASE WHEN dt_lib_suspensao IS NULL THEN  coalesce(dt_fim_cih,dt_fim)  ELSE coalesce(dt_suspensao,dt_fim) END  dt_fim,
		nm_usuario,
		dt_liberacao,
		ds_horarios,
		ds_dose_diferenciada_comp2 ds_dose_diferenciada
from	cpoe_material
where	((CASE WHEN dt_lib_suspensao IS NULL THEN  coalesce(dt_fim_cih,dt_fim)  ELSE coalesce(dt_suspensao,dt_fim) END  is null) or (CASE WHEN dt_lib_suspensao IS NULL THEN  coalesce(dt_fim_cih,dt_fim)  ELSE coalesce(dt_suspensao,dt_fim) END  >= trunc(LOCALTIMESTAMP,'mi')))
and		cd_mat_comp2 is not null

union all

select	nr_sequencia,
		nr_atendimento,
		'MCOMP3',
		cd_mat_comp3,
		cd_unid_med_dose_comp3,
		qt_dose_comp3,
		nr_ocorrencia,
		ie_via_aplicacao,
		coalesce(obter_conversao_ml(cd_mat_comp3,qt_dose_comp3,cd_unid_med_dose_comp3),0),
		dt_inicio,
		CASE WHEN dt_lib_suspensao IS NULL THEN  coalesce(dt_fim_cih,dt_fim)  ELSE coalesce(dt_suspensao,dt_fim) END  dt_fim,
		nm_usuario,
		dt_liberacao,
		ds_horarios,
		ds_dose_diferenciada_comp3 ds_dose_diferenciada
from	cpoe_material
where	((CASE WHEN dt_lib_suspensao IS NULL THEN  coalesce(dt_fim_cih,dt_fim)  ELSE coalesce(dt_suspensao,dt_fim) END  is null) or (CASE WHEN dt_lib_suspensao IS NULL THEN  coalesce(dt_fim_cih,dt_fim)  ELSE coalesce(dt_suspensao,dt_fim) END ) >= trunc(LOCALTIMESTAMP,'mi'))
and		cd_mat_comp3 is not null

union all

select	nr_sequencia,
		nr_atendimento,
		'MCOMP4' ie_tipo_item,
		cd_mat_comp4 cd_material,
		cd_unid_med_dose_comp4 cd_unidade_medida,
		qt_dose_comp4 qt_dose,
		nr_ocorrencia,
		ie_via_aplicacao,
		coalesce(obter_conversao_ml(cd_mat_comp4,qt_dose_comp4,cd_unid_med_dose_comp4),0) qt_solucao,
		dt_inicio,
		CASE WHEN dt_lib_suspensao IS NULL THEN  coalesce(dt_fim_cih,dt_fim)  ELSE coalesce(dt_suspensao,dt_fim) END  dt_fim,
		nm_usuario nm_usuario,
		dt_liberacao dt_liberacao,
		ds_horarios,
		ds_dose_diferenciada_comp4 ds_dose_diferenciada
from	cpoe_material
where	((CASE WHEN dt_lib_suspensao IS NULL THEN  coalesce(dt_fim_cih,dt_fim)  ELSE coalesce(dt_suspensao,dt_fim) END  is null) or (CASE WHEN dt_lib_suspensao IS NULL THEN  coalesce(dt_fim_cih,dt_fim)  ELSE coalesce(dt_suspensao,dt_fim) END  >= trunc(LOCALTIMESTAMP,'mi')))
and		cd_mat_comp4 is not null

union all

select	nr_sequencia,
		nr_atendimento,
		'MCOMP5' ie_tipo_item,
		cd_mat_comp5 cd_material,
		cd_unid_med_dose_comp5 cd_unidade_medida,
		qt_dose_comp5 qt_dose,
		nr_ocorrencia,
		ie_via_aplicacao,
		coalesce(obter_conversao_ml(cd_mat_comp5,qt_dose_comp5,cd_unid_med_dose_comp5),0) qt_solucao,
		dt_inicio,
		CASE WHEN dt_lib_suspensao IS NULL THEN  coalesce(dt_fim_cih,dt_fim)  ELSE coalesce(dt_suspensao,dt_fim) END  dt_fim,
		nm_usuario nm_usuario,
		dt_liberacao dt_liberacao,
		ds_horarios,
		ds_dose_diferenciada_comp5 ds_dose_diferenciada
from	cpoe_material
where	((CASE WHEN dt_lib_suspensao IS NULL THEN  coalesce(dt_fim_cih,dt_fim)  ELSE coalesce(dt_suspensao,dt_fim) END  is null) or (CASE WHEN dt_lib_suspensao IS NULL THEN  coalesce(dt_fim_cih,dt_fim)  ELSE coalesce(dt_suspensao,dt_fim) END  >= trunc(LOCALTIMESTAMP,'mi')))
and		cd_mat_comp5 is not null

union all

select	nr_sequencia,
		nr_atendimento,
		'MCOMP6' ie_tipo_item,
		cd_mat_comp6 cd_material,
		cd_unid_med_dose_comp6 cd_unidade_medida,
		qt_dose_comp6 qt_dose,
		nr_ocorrencia,
		ie_via_aplicacao,
		coalesce(obter_conversao_ml(cd_mat_comp6,qt_dose_comp6,cd_unid_med_dose_comp6),0) qt_solucao,
		dt_inicio,
		CASE WHEN dt_lib_suspensao IS NULL THEN  coalesce(dt_fim_cih,dt_fim)  ELSE coalesce(dt_suspensao,dt_fim) END  dt_fim,
		nm_usuario nm_usuario,
		dt_liberacao dt_liberacao,
		ds_horarios,
		ds_dose_diferenciada_comp6 ds_dose_diferenciada
from	cpoe_material
where	((CASE WHEN dt_lib_suspensao IS NULL THEN  coalesce(dt_fim_cih,dt_fim)  ELSE coalesce(dt_suspensao,dt_fim) END  is null) or (CASE WHEN dt_lib_suspensao IS NULL THEN  coalesce(dt_fim_cih,dt_fim)  ELSE coalesce(dt_suspensao,dt_fim) END  >= trunc(LOCALTIMESTAMP,'mi')))
and		cd_mat_comp6 is not null;

