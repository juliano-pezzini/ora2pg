-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_cirurgia_painel_v (hr_cirurgia, cd_medico_cirurgiao, dt_referencia, cd_estabelecimento, ds_status_cirurgia, qt_ocorrencia, vl_faturado, vl_fat_medio, ie_periodo, cd_convenio, cd_procedimento, cd_medico_anestesista, cd_tipo_anestesia, cd_especialidade, cd_setor_atendimento, cd_unidade, ie_sexo_paciente, ie_faixa_etaria, ie_status_cirurgia, ie_carater_cirurgia, ds_especialidade) AS select	hr_cirurgia,
	cd_medico_cirurgiao,
	dt_referencia,
	cd_estabelecimento,
	substr(obter_valor_dominio(65, a.ie_status_cirurgia),1,200) ds_status_cirurgia,
	qt_ocorrencia,
	vl_faturado,
	((vl_faturado) / sum(qt_ocorrencia)) vl_fat_medio,
	ie_periodo,
	cd_convenio,
	cd_procedimento,
	CD_MEDICO_ANESTESISTA,
	CD_TIPO_ANESTESIA,
	CD_ESPECIALIDADE,
	CD_SETOR_ATENDIMENTO,
	CD_UNIDADE,
	IE_SEXO_PACIENTE,
	IE_FAIXA_ETARIA,
	IE_STATUS_CIRURGIA,
	IE_CARATER_CIRURGIA,
	coalesce(OBTER_DESC_ESPEC_PROC(CD_ESPECIALIDADE),'Não informada') ds_especialidade
FROM	eis_cirurgia a
group by dt_referencia,
	cd_estabelecimento,
	substr(obter_valor_dominio(65, a.ie_status_cirurgia),1,200),
	qt_ocorrencia,
	vl_faturado,
	hr_cirurgia,
	cd_medico_cirurgiao,
	ie_periodo,
	cd_convenio,
	cd_procedimento,
	CD_MEDICO_ANESTESISTA,
	CD_TIPO_ANESTESIA,
	CD_ESPECIALIDADE,
	CD_SETOR_ATENDIMENTO,
	CD_UNIDADE,
	IE_SEXO_PACIENTE,
	IE_FAIXA_ETARIA,
	IE_STATUS_CIRURGIA,
	IE_CARATER_CIRURGIA,
	coalesce(OBTER_DESC_ESPEC_PROC(CD_ESPECIALIDADE),'Não informada');

