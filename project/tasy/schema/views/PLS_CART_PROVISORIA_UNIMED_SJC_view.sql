-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_cart_provisoria_unimed_sjc (tp_registro, cd_usuario, nm_usuario, dt_val_carteira, dt_repasse, ds_contrante, mens_front_1, tp_plano, forma_pagto, ds_lugar_atend, carencia_1, carencia_2, carencia_3, carencia_4, carencia_5, carencia_6, carencia_7, carencia_8, carencia_9, carencia_10, carencia_11, carencia_12, carencia_13, ds_mensagem_cart, nr_telefone, nr_seq_lote) AS select	3															tp_registro,
	' '															cd_usuario, 
	' '															nm_usuario, 
	null															dt_val_carteira, 
	null															dt_repasse, 
	' '															ds_contrante, 
	' '															mens_front_1, 
	' '															tp_plano, 
	' '															forma_pagto, 
	' '															ds_lugar_atend, 
	' '															carencia_1, 
	' '															carencia_2, 
	' '															carencia_3, 
	' '															carencia_4, 
	' '															carencia_5, 
	' '															carencia_6, 
	' '															carencia_7, 
	' '															carencia_8, 
	' '															carencia_9, 
	' '															carencia_10, 
	' '															carencia_11, 
	' '															carencia_12, 
	' '															carencia_13, 
	' '															ds_mensagem_cart, 
	' '															nr_telefone, 
	a.nr_sequencia														nr_seq_lote 
FROM	pls_lote_carteira	a 
where	a.ie_tipo_lote		= 'E' 

union
 
select	4															tp_registro, 
	substr(c.cd_usuario_plano,1,1) ||' ' || substr(c.cd_usuario_plano,2,3) ||' '|| substr(c.cd_usuario_plano,5,12) || ' '|| substr(c.cd_usuario_plano,17,1) cd_usuario, 
	g.nm_pessoa_fisica					 								nm_usuario, 
	c.dt_validade_carteira													dt_val_carteira, 
	e.dt_repasse														dt_repasse, 
	substr(obter_nome_pf_pj(f.cd_pf_estipulante,f.cd_cgc_estipulante),1,255)						ds_contrante, 
	replace(substr(c.ds_mensagem_carteira,1,25),chr(13),'')									mens_front_1, 
	CASE WHEN UPPER(pls_obter_dados_cart_unimed(d.nr_sequencia, h.nr_sequencia,'DA',0))='APARTAMENTO' THEN 'APT' WHEN UPPER(pls_obter_dados_cart_unimed(d.nr_sequencia, h.nr_sequencia,'DA',0))='ENFERMARIA' THEN 'ENF' END  tp_plano, 
	CASE WHEN h.ie_preco='1' THEN 'PRE' WHEN h.ie_preco='3' THEN 'CO' WHEN h.ie_preco='4' THEN 'MI' END 										forma_pagto, 
	UPPER(substr(pls_obter_dados_cooperativa(e.nr_seq_congenere,'RS'),1,30))						ds_lugar_atend, 
	UPPER(pls_obter_dados_cart_unimed(d.nr_sequencia, h.nr_sequencia,'CAS',1))						carencia_1, 
	UPPER(pls_obter_dados_cart_unimed(d.nr_sequencia, h.nr_sequencia,'CAS',2))						carencia_2, 
	UPPER(pls_obter_dados_cart_unimed(d.nr_sequencia, h.nr_sequencia,'CAS',3))						carencia_3, 
	UPPER(pls_obter_dados_cart_unimed(d.nr_sequencia, h.nr_sequencia,'CAS',4))						carencia_4, 
	UPPER(pls_obter_dados_cart_unimed(d.nr_sequencia, h.nr_sequencia,'CAS',5))						carencia_5, 
	UPPER(pls_obter_dados_cart_unimed(d.nr_sequencia, h.nr_sequencia,'CAS',6))						carencia_6, 
	UPPER(pls_obter_dados_cart_unimed(d.nr_sequencia, h.nr_sequencia,'CAS',7))						carencia_7, 
	UPPER(pls_obter_dados_cart_unimed(d.nr_sequencia, h.nr_sequencia,'CAS',8))						carencia_8, 
	UPPER(pls_obter_dados_cart_unimed(d.nr_sequencia, h.nr_sequencia,'CAS',9))						carencia_9, 
	UPPER(pls_obter_dados_cart_unimed(d.nr_sequencia, h.nr_sequencia,'CAS',10))						carencia_10, 
	UPPER(pls_obter_dados_cart_unimed(d.nr_sequencia, h.nr_sequencia,'CAS',11))						carencia_11, 
	UPPER(pls_obter_dados_cart_unimed(d.nr_sequencia, h.nr_sequencia,'CAS',12))						carencia_12, 
	UPPER(pls_obter_dados_cart_unimed(d.nr_sequencia, h.nr_sequencia,'CAS',13))						carencia_13, 
	'Benefici√°rio repassado para a ' || UPPER(substr(pls_obter_dados_cooperativa(e.nr_seq_congenere,'RS'),1,40))		ds_mensagem_cart, 
	'Tel.: ' || substr(pls_obter_dados_cooperativa(e.nr_seq_congenere,'T'),1,20)						nr_telefone, 
	a.nr_sequencia														nr_seq_lote 
from	pls_lote_carteira			a, 
	pls_carteira_emissao			b, 
	pls_segurado_carteira			c, 
	pls_segurado				d, 
	pls_segurado_repasse			e, 
	pls_contrato				f, 
	pessoa_fisica				g, 
	pls_plano				h 
where	b.nr_seq_lote				= a.nr_sequencia 
and	b.nr_seq_seg_carteira			= c.nr_sequencia 
and	c.nr_seq_segurado			= d.nr_sequencia 
and	d.nr_seq_contrato			= f.nr_sequencia 
and	d.cd_pessoa_fisica			= g.cd_pessoa_fisica 
and	e.nr_seq_segurado			= d.nr_sequencia 
and	d.nr_seq_plano				= h.nr_sequencia;

