-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW dashboard_pmo_cron_etapa_v (nr_seq_proj, cd_classificacao, ds_atividade, dt_inicio_prev, dt_inicio_real, dt_fim_prev, dt_fim_real, qt_hora_prev, qt_hora_real, pr_prev, pr_real, ie_tipo_cron, nr_seq_cro_etapa, ie_fase, ie_status_resumo) AS select   t.NR_SEQ_PROJ,t.CD_CLASSIFICACAO,t.DS_ATIVIDADE,t.DT_INICIO_PREV,t.DT_INICIO_REAL,t.DT_FIM_PREV,t.DT_FIM_REAL,t.QT_HORA_PREV,t.QT_HORA_REAL,t.PR_PREV,t.PR_REAL,t.IE_TIPO_CRON,t.NR_SEQ_CRO_ETAPA,t.IE_FASE,
         obter_status_dashboard_pmo( null,
                                     null,
                                     t.dt_inicio_prev,
                                     t.dt_inicio_real,
                                     t.dt_fim_prev,
                                     t.dt_fim_real,
                                     t.pr_prev,
                                     t.pr_real ) ie_status_resumo
FROM ( select	c.nr_seq_proj,
					e.cd_classificacao,
					trim(both e.ds_atividade) ds_atividade,
					e.dt_inicio_prev,
					e.dt_inicio_real,
					e.dt_fim_prev,
					e.dt_fim_real,
					e.qt_hora_prev,
					e.qt_hora_real,
					coalesce(e.pr_previsto,0) pr_prev,
					coalesce(e.pr_etapa,0) pr_real,
					c.ie_tipo_cronograma  ie_tipo_cron,
					e.nr_sequencia nr_seq_cro_etapa,
					e.ie_fase
           from     proj_projeto p,
                    proj_cronograma c,
                    proj_cron_etapa e
           where    p.nr_sequencia  = c.nr_seq_proj
           and      c.nr_sequencia  = e.nr_seq_cronograma
           and      c.ie_situacao   = 'A'
	   and 	    c.dt_aprovacao is not null
           order by e.cd_classificacao
          ) t;

