-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_com_prospect_v (nr_sequencia, cd_empresa, dt_atualizacao, nm_usuario, cd_cnpj, ie_situacao, ie_natureza, ie_fase_venda, ie_status_neg, ie_classificacao, ie_tipo, qt_leito, qt_leito_uti, vl_fat_anual, ie_resp_atend, ie_recebe_visita, ie_referencia, dt_atualizacao_nrec, nm_usuario_nrec, nr_seq_forma_conhec, dt_revisao_prevista, nr_seq_ativ, qt_consultores, dt_oficializacao_uso, ie_resp_coordenacao, qt_mes_estimado, ie_hosp_escola, ds_natureza, ds_tipo, nm_cliente, sg_estado, ds_estado, nm_guerra, dt_inicio, dt_abertura, vl_tempo) AS select	a.NR_SEQUENCIA,
	a.CD_EMPRESA, 
	a.DT_ATUALIZACAO, 
	a.NM_USUARIO, 
	a.CD_CNPJ, 
	a.IE_SITUACAO, 
	a.IE_NATUREZA, 
	a.IE_FASE_VENDA, 
	a.IE_STATUS_NEG, 
	a.IE_CLASSIFICACAO, 
	a.IE_TIPO, 
	a.QT_LEITO, 
	a.QT_LEITO_UTI, 
	a.VL_FAT_ANUAL, 
	a.IE_RESP_ATEND, 
	a.IE_RECEBE_VISITA, 
	a.IE_REFERENCIA, 
	a.DT_ATUALIZACAO_NREC, 
	a.NM_USUARIO_NREC, 
	a.NR_SEQ_FORMA_CONHEC, 
	a.DT_REVISAO_PREVISTA, 
	a.NR_SEQ_ATIV, 
	a.QT_CONSULTORES, 
	a.DT_OFICIALIZACAO_USO, 
	a.IE_RESP_COORDENACAO, 
	a.QT_MES_ESTIMADO, 
	a.IE_HOSP_ESCOLA, 
	substr(obter_valor_dominio(1082,a.ie_natureza),1,254) ds_natureza, 
	substr(obter_valor_dominio(1316,a.ie_tipo),1,254) ds_tipo, 
	substr(obter_dados_pf_pj(null,a.cd_cnpj,'N'),1,254) nm_cliente, 
	obter_dados_pf_pj(null, a.cd_cnpj, 'UF') sg_estado, 
	substr(obter_valor_dominio(50,obter_dados_pf_pj(null, a.cd_cnpj, 'UF')),1,254) ds_estado, 
	b.nm_guerra, 
	d.dt_inicio, 
	min(e.dt_historico) dt_abertura, 
	(trunc(min(e.dt_historico),'dd') - trunc(d.dt_inicio,'dd')) vl_tempo 
FROM com_cliente_hist e, com_canal_cliente c, com_canal b, com_cliente a
LEFT OUTER JOIN contrato d ON (a.cd_cnpj = d.cd_cgc_contratado)
WHERE 1=1 and c.nr_seq_cliente	= a.nr_sequencia and b.nr_sequencia		= c.nr_seq_canal  and a.nr_sequencia		= e.nr_seq_cliente and c.ie_tipo_atuacao	= 'V' and c.dt_fim_atuacao is null group by a.NR_SEQUENCIA, 
	a.CD_EMPRESA, 
	a.DT_ATUALIZACAO, 
	a.NM_USUARIO, 
	a.CD_CNPJ, 
	a.IE_SITUACAO, 
	a.IE_NATUREZA, 
	a.IE_FASE_VENDA, 
	a.IE_STATUS_NEG, 
	a.IE_CLASSIFICACAO, 
	a.IE_TIPO, 
	a.QT_LEITO, 
	a.QT_LEITO_UTI, 
	a.VL_FAT_ANUAL, 
	a.IE_RESP_ATEND, 
	a.IE_RECEBE_VISITA, 
	a.IE_REFERENCIA, 
	a.DT_ATUALIZACAO_NREC, 
	a.NM_USUARIO_NREC, 
	a.NR_SEQ_FORMA_CONHEC, 
	a.DT_REVISAO_PREVISTA, 
	a.NR_SEQ_ATIV, 
	a.QT_CONSULTORES, 
	a.DT_OFICIALIZACAO_USO, 
	a.IE_RESP_COORDENACAO, 
	a.QT_MES_ESTIMADO, 
	a.IE_HOSP_ESCOLA, 
	b.nm_guerra, 
	d.dt_inicio;

