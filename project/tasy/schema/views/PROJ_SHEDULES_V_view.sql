-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW proj_shedules_v (ds_produto, ds_status, nr_seq_grupo_des, nr_seq_macro, qt_total_horas, pr_projeto, ds_grupo_des, ds_projeto, nr_seq_apresent, dt_inicio_prev, dt_fim_prev, ie_data_alterada, ds_semana_00, ds_semana_01, ds_semana_02, ds_semana_03, ds_semana_04, ds_semana_05, ds_semana_06, ds_semana_07, ds_semana_08, ds_semana_09, ds_semana_10, ds_semana_11, ds_semana_12, ds_semana_13, ds_semana_14, ds_semana_15, ds_semana_16, ds_semana_17, ds_semana_18, ds_semana_19, ds_semana_20, ds_semana_21, ds_semana_22, ds_semana_23, nr_seq_gerencia, ie_status) AS select	substr(obter_valor_dominio(3717,coalesce(p.ie_tipo_produto,'TP')),1,100) ds_produto,
			substr(e.ds_status_externo,1,80) ds_status,
			p.NR_SEQ_GRUPO_DES,
			0 nr_seq_macro,
			campo_mascara_virgula_casas((select sum(v.qt_total_horas) FROM proj_cronograma v where v.nr_seq_proj = p.nr_sequencia and v.ie_cobrado = 'S'), 0) qt_total_horas,
			campo_mascara_virgula_casas(proj_obter_perc_con_cron(p.nr_sequencia), 0) pr_projeto,
			coalesce(z.ds_classificacao_externo, z.ds_classificacao) ds_grupo_des,
			coalesce(p.ds_informacao_externa,p.ds_titulo)ds_projeto,
			CASE WHEN p.ie_status='I' THEN  1 WHEN p.ie_status='P' THEN  2 WHEN p.ie_status='E' THEN  3 WHEN p.ie_status='F' THEN  4 WHEN p.ie_status='T' THEN  5 END  nr_seq_apresent,
			to_char(p.dt_inicio_prev,'dd/mm/yy') dt_inicio_prev,
			to_char(p.dt_fim_prev,'dd/mm/yy') dt_fim_prev,
			CASE WHEN p.dt_fim_prev_orig IS NULL THEN  ''  ELSE CASE WHEN p.dt_fim_prev_orig=p.dt_fim_prev THEN  ''  ELSE '*' END  END  ie_data_alterada,
			CASE WHEN w.ds_semana_00='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_00,
			CASE WHEN w.ds_semana_01='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_01,
			CASE WHEN w.ds_semana_02='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_02,
			CASE WHEN w.ds_semana_03='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_03,
			CASE WHEN w.ds_semana_04='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_04,
			CASE WHEN w.ds_semana_05='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_05,
			CASE WHEN w.ds_semana_06='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_06,
			CASE WHEN w.ds_semana_07='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_07,
			CASE WHEN w.ds_semana_08='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_08,
			CASE WHEN w.ds_semana_09='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_09,
			CASE WHEN w.ds_semana_10='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_10,
			CASE WHEN w.ds_semana_11='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_11,
			CASE WHEN w.ds_semana_12='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_12,
			CASE WHEN w.ds_semana_13='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_13,
			CASE WHEN w.ds_semana_14='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_14,
			CASE WHEN w.ds_semana_15='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_15,
			CASE WHEN w.ds_semana_16='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_16,
			CASE WHEN w.ds_semana_17='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_17,
			CASE WHEN w.ds_semana_18='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_18,
			CASE WHEN w.ds_semana_19='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_19,
			CASE WHEN w.ds_semana_20='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_20,
			CASE WHEN w.ds_semana_21='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_21,
			CASE WHEN w.ds_semana_22='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_22,
			CASE WHEN w.ds_semana_23='S' THEN '# # # ' || CASE WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='S' THEN '#A' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='P' THEN '#Y' WHEN coalesce(p.IE_PLANEJ_ESTRATEG,'E')='E' THEN CASE WHEN p.ie_status_gant=1 THEN  '#G' WHEN p.ie_status_gant=2 THEN  '#Y'  ELSE '#V' END  END   ELSE '# # # #T' END  ds_semana_23,
			p.nr_seq_gerencia,
			p.ie_status
	from	proj_classif z,
			proj_status_externo e,
			proj_projeto p,
			w_alocacao_recurso w
	where	e.ie_status = p.ie_status
	and		p.nr_sequencia = w.nr_seq_projeto
	and		p.nr_seq_classif = z.nr_sequencia
	and		p.ie_status not in ('F','F')
	and		p.nr_seq_classif <> '15';

