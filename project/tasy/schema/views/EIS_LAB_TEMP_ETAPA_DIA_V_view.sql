-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_lab_temp_etapa_dia_v (nr_sequencia, dt_atualizacao, nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec, nr_seq_grupo, nr_seq_exame, cd_setor_entrega, ie_tipo_atendimento, cd_medico, ie_etapa, dt_referencia, nm_exame, nr_prescricao, cd_setor_solicitacao, dt_prescricao, nr_seq_prescr, cd_setor_prescricao, nr_min_mapa, nr_min_coleta, nr_min_distribuicao, nr_min_digitacao, nr_min_aprovacao, nr_min_coleta_aprov, nr_min_lib_aprov, nr_min_lib_coleta, nr_min_lib_digitacao, dt_coleta, nr_min_prev_coleta, nr_min_prev_aprovacao, ie_urgencia, dt_aprovacao, nr_min_lib_exame, nm_usuario_etapa, cd_pessoa_fisica, ds_grupo_exame, nm_medico, ds_tipo_atendimento, ds_setor_entrega, ds_setor_prescricao, qt_mapa, qt_coleta, qt_distribuicao, qt_digitacao, qt_aprovado, qt_liberado, qt_entregue, qt_dt_coleta, nr_minuto_mapa, nr_minuto_coleta, nr_minuto_distribuicao, nr_minuto_digitacao, nr_minuto_aprovacao, nr_minuto_coleta_aprov, nr_minuto_lib_aprov, nr_minuto_lib_coleta, nr_minuto_lib_digitacao, nr_minuto_prev_aprovacao, nr_minuto_prev_coleta, ds_urgencia, nr_minuto_lib_exame) AS select	a.NR_SEQUENCIA,a.DT_ATUALIZACAO,a.NM_USUARIO,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC,a.NR_SEQ_GRUPO,a.NR_SEQ_EXAME,a.CD_SETOR_ENTREGA,a.IE_TIPO_ATENDIMENTO,a.CD_MEDICO,a.IE_ETAPA,a.DT_REFERENCIA,a.NM_EXAME,a.NR_PRESCRICAO,a.CD_SETOR_SOLICITACAO,a.DT_PRESCRICAO,a.NR_SEQ_PRESCR,a.CD_SETOR_PRESCRICAO,a.NR_MIN_MAPA,a.NR_MIN_COLETA,a.NR_MIN_DISTRIBUICAO,a.NR_MIN_DIGITACAO,a.NR_MIN_APROVACAO,a.NR_MIN_COLETA_APROV,a.NR_MIN_LIB_APROV,a.NR_MIN_LIB_COLETA,a.NR_MIN_LIB_DIGITACAO,a.DT_COLETA,a.NR_MIN_PREV_COLETA,a.NR_MIN_PREV_APROVACAO,a.IE_URGENCIA,a.DT_APROVACAO,a.NR_MIN_LIB_EXAME,a.NM_USUARIO_ETAPA,a.CD_PESSOA_FISICA,
	substr(obter_desc_grupo_exame_lab(a.nr_seq_grupo),1,30) ds_grupo_exame, 
	substr(obter_nome_medico(a.cd_medico,'N'),1,255) nm_medico, 
	substr(obter_valor_dominio(12, a.ie_tipo_atendimento),1,200) ds_tipo_atendimento, 
	substr(obter_nome_setor(a.cd_setor_entrega),1,100) ds_setor_entrega, 
	substr(obter_nome_setor(a.cd_setor_prescricao),1,100) ds_setor_prescricao, 
	CASE WHEN a.ie_etapa=15 THEN 1  ELSE 0 END  qt_mapa, 
	CASE WHEN a.ie_etapa=20 THEN 1  ELSE 0 END  qt_coleta, 
	CASE WHEN a.ie_etapa=25 THEN 1  ELSE 0 END  qt_distribuicao, 
	CASE WHEN a.ie_etapa=30 THEN 1  ELSE 0 END  qt_digitacao, 
	CASE WHEN a.ie_etapa=35 THEN 1  ELSE 0 END  qt_aprovado, 
	CASE WHEN a.ie_etapa=40 THEN 1  ELSE 0 END  qt_liberado,	 
	CASE WHEN a.ie_etapa=45 THEN 1  ELSE 0 END  qt_entregue, 
	CASE WHEN a.dt_coleta IS NULL THEN 0  ELSE 1 END  qt_dt_coleta, 
	CASE WHEN a.ie_etapa=15 THEN nr_min_mapa  ELSE 0 END  nr_minuto_mapa, 
	CASE WHEN a.ie_etapa=20 THEN nr_min_coleta  ELSE 0 END  nr_minuto_coleta, 
	CASE WHEN a.ie_etapa=25 THEN nr_min_distribuicao  ELSE 0 END  nr_minuto_distribuicao, 
	CASE WHEN a.ie_etapa=30 THEN nr_min_digitacao  ELSE 0 END  nr_minuto_digitacao, 
	CASE WHEN a.ie_etapa=35 THEN nr_min_aprovacao  ELSE 0 END  nr_minuto_aprovacao, 
	CASE WHEN a.ie_etapa=35 THEN nr_min_coleta_aprov  ELSE 0 END  nr_minuto_coleta_aprov, 
	CASE WHEN a.ie_etapa=35 THEN nr_min_lib_aprov  ELSE 0 END  nr_minuto_lib_aprov, 
	CASE WHEN a.ie_etapa=20 THEN nr_min_lib_coleta  ELSE 0 END  nr_minuto_lib_coleta, 
	CASE WHEN a.ie_etapa=30 THEN nr_min_lib_digitacao  ELSE 0 END  nr_minuto_lib_digitacao, 
	CASE WHEN a.ie_etapa=35 THEN nr_min_prev_aprovacao  ELSE 0 END  nr_minuto_prev_aprovacao, 
	CASE WHEN a.ie_etapa=20 THEN nr_min_prev_coleta  ELSE 0 END  nr_minuto_prev_coleta, 
	substr(CASE WHEN a.ie_urgencia='S' THEN 'Sim'  ELSE 'NÃ£o' END ,1,5) ds_urgencia, 
	CASE WHEN a.ie_etapa=40 THEN nr_min_lib_exame  ELSE 0 END  nr_minuto_lib_exame 
FROM	eis_lab_qt_exame_etapa a 
where	a.ie_etapa in (15,20,25,30,35,40);

