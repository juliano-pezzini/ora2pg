-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW gestao_exame_v (nr_prescricao, nr_atendimento, nr_seq_interno, nr_seq_propaci, nr_seq_laudo, nr_interno_conta, ds_status_execucao, nm_medico_prev_exec, nm_medico_executor, nm_medico_laudo, ds_autorizacao, ds_procedimento, ds_motivo_parada, ds_setor_atendimento, ds_motivo_baixa, ds_setor_paciente, ds_arquivo, ie_laudo_ant, ds_laudo_ant, dt_ditado, ds_procedencia, dt_inicio, dt_inicio_agenda_atend, ds_lado_proced, ie_mat_med, ds_mat_med, ie_mat_med_setor, ds_mat_med_setor, ds_tipo_atend, ds_idade, dt_nascimento, ds_convenio, cd_usuario_convenio, ds_local, ie_obs_proced, ds_obs_proced, qt_prescrito, qt_liberado, qt_exame, ds_status_agenda, ds_exame_lab, ds_material_exame, nm_funcionario_executor, ds_motivo_ant, nr_acesso_dicom, nm_usuario_ditado, ds_email_medico_prescr, nm_anestesista, ds_contraste, ds_intervalo, nm_profissional_previsto, ds_tipo_isolamento_cih, ds_cor_isolamento_cih, ie_exame_cancelado, ds_proced_conta, cd_proced_conta, nm_medico, ie_solic_externa, ie_atend_alerta, possui_hist, ds_solic_externa, ds_atend_alerta, ds_possui_hist, dt_impressao_imagem, ie_solicitacao_exame, ds_solicitacao_exame, dt_alta, nr_crm_prescrito, nm_usu_lib_pat, dt_usu_lib_pat, ie_subamostra_exec, ds_subamostra_exec, ds_setor_local, nr_reserva, nr_transfusao, ds_peca_principal, nr_seq_locate, dt_prescricao, ie_recem_nato, ds_recem_nato, cd_medico, dt_liberacao_medico, nm_usuario_original, nm_usuario, dt_liberacao, cd_pessoa_fisica, cd_setor_atendimento, nr_controle, cd_estabelecimento, qt_peso, cd_medico_executor, dt_procedimento, nm_usuario_exec, dt_liberacao_laudo, nm_usuario_laudo, dt_laudo, nm_usuario_aprovacao, nm_usuario_seg_aprov, dt_impressao, nr_prescr, ie_status, dt_nasc, qt_vol_hemo, qt_procedimento, nr_prontuario, ds_breve_local, nr_seq_proced, ds_dado_clinico, cd_categoria, ds_material_especial, ds_localizacao_laudo, ds_exame_anterior, ds_forma_entrega_laudo, ie_imagem_entregue, ds_imagem_entregue, dt_cancelamento, ds_local_paciente, nm_medico_laudo_reg, ie_pago, ds_motivo_atraso, ds_obs_agenda, nr_doc_convenio, dt_entrega, ie_possui_evento, ds_contraste_conta, qt_filme, nm_pessoa_receb_img, nr_prioridade_triagem, ds_profissional_pref, ds_status_sr, dt_status_sr, ds_cor_status_sr, dt_agenda_integrada, ds_cor_entrega_laudo, ds_categoria_convenio, ie_prescr_lib, nr_seq_pepo, ds_senha_pac_fila, dt_solicit_antecip, cd_setor_pac, nm_pessoa_fisica, nr_sequencia, nr_int_conta, ds_motivo_neg_antecip, ie_prioridade, ie_prioridade_classif, ds_prioridade_classif, cor_prioridade_classif, ie_paciente_isolado, dt_entrada, ie_tipo_atendimento, dt_atend_medico, dt_fim_consulta, ie_carater_inter_sus, ds_senha_qmatic, nr_seq_local_pa, hr_fim_enfermagem, nr_seq_classificacao, hr_inicio_consulta, ie_status_pa, ie_clinica, dt_fim_triagem, ie_sem_prioridade, ds_triagem, ds_prioridade, ds_cor_prioridade, ds_classif_urgencia, ds_cor_urgencia, ie_prior_classif_atend, ds_clinica, ds_senha_aut, ds_obs_antecip_result, ie_antecip_negada, cd_procedimento, ie_origem_proced, dt_emissao_setor_atend, dt_resultado, dt_prev_execucao, cd_convenio, nr_seq_proc_interno, ie_lado, ie_autorizacao, ie_amostra, ds_amostra, ds_observacao, dt_baixa, nm_usuario_baixa_esp, nr_seq_lab, ie_executar_leito, ds_executar_leito, dt_inicio_exame, dt_antecipa_result, ds_antecipa_result, cd_motivo_baixa, nr_ocorrencia, nr_seq_exame, dt_lib_imagem, nm_usuario_antecipacao, ds_obs_antecip, qt_prescr_proced, cd_profissional, ie_aliquotado, ie_filtrado, ie_irradiado, ie_lavado, ds_aliquotado, ds_filtrado, ds_irradiado, ds_lavado, dt_chamada_exame, ds_urgencia, ie_status_execucao, ie_tipo_proced, nr_seq_status_pato, ie_proced_bloqueado, ds_proced_bloqueado, ds_observacao_bloqueio, ie_exige_liberacao, dt_reprovacao, ds_justificativa_rep, ds_rotina, qt_frasco_env, qt_frasco_rec, ds_motivo_revisao, dt_chegada_paciente, dt_inicio_preparo, nr_seq_proced_regra, ie_aprovacao_execucao, ds_aprovacao_execucao, ie_prev_execucao_alt, ds_prev_execucao_alt, dt_aprovacao_execucao, ie_existe_frasco, ds_existe_frasco, nr_seq_motivo_just, dt_recebimento_frasco, ie_anestesia, ds_anestesia, dt_fim_preparo, ds_observacao_canc_exame, dt_fim_exame, nr_seq_motivo_atraso, ds_integracao, dt_integracao, ds_resumo_clinico, ds_justificativa, ie_urgencia, cd_equipamento, ie_imagem_pacs, nr_seq_topografia, dt_suspensao, ds_motivo_susp, nm_usuario_susp, ds_cor_fonte_urgencia, ds_cor_local_pa, nm_medico_prev_laudo, nr_seq_apresent, nm_profissional_resp, ds_condicao, ds_status_patologia, ie_status_patologia, ds_protocolo, qt_idade, ie_entrega_biometrica, nm_paciente, ds_status_historico, nm_social, dt_retirada, nm_pac_laudo, ie_tumor, cd_tipo_procedimento, ds_tipo_situacao, ie_bloqueado, ie_negrito, ie_italico, ds_cor, nm_usuario_situacao, ds_imunohistoquimica, ds_imunohistoquimica_desc, dt_laudo_cancelamento, cd_prioridade, ds_tmp_para_execucao, status_recuperacao, dt_fim_recuperacao, dt_inicio_recuperacao, ds_solicitacao, ds_alergia, ds_deficiencia, ds_agenda) AS SELECT a.nr_prescricao,
       a.nr_atendimento,
       a.nr_seq_interno,
       a.nr_seq_propaci,
       a.nr_seq_laudo,
       a.nr_interno_conta,
       substr(a.ds_status_execucao, 1, 80) ds_status_execucao,
       substr(a.nm_medico_prev_exec, 1, 60) nm_medico_prev_exec,
       substr(a.nm_medico_executor, 1, 60) nm_medico_executor,
       substr(a.nm_medico_laudo, 1, 60) nm_medico_laudo,
       substr(a.ds_autorizacao, 1, 20) ds_autorizacao,
       a.ds_procedimento,
       substr(a.ds_motivo_parada, 1, 80) ds_motivo_parada,
       substr(a.ds_setor_atendimento, 1, 60) ds_setor_atendimento,
       substr(a.ds_motivo_baixa, 1, 60) ds_motivo_baixa,
       substr(a.ds_setor_paciente, 1, 60) ds_setor_paciente,
       substr(a.ds_arquivo, 1, 80) ds_arquivo,
       substr(a.ie_laudo_ant, 1, 1) ie_laudo_ant,
       CASE WHEN substr(a.ie_laudo_ant, 1, 1)='S' THEN              substr(obter_desc_expressao(327113), 1, 5) WHEN substr(a.ie_laudo_ant, 1, 1)='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_laudo_ant,
       a.dt_ditado,
       substr(a.ds_procedencia, 1, 40) ds_procedencia,
       a.dt_inicio,
       a.dt_inicio_agenda_atend,
       a.ds_lado_proced,
       a.ie_mat_med ie_mat_med,
       CASE WHEN a.ie_mat_med='S' THEN               substr(obter_desc_expressao(327113), 1, 5) WHEN a.ie_mat_med='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_mat_med,
       a.ie_mat_med_setor ie_mat_med_setor,
       CASE WHEN a.ie_mat_med_setor='S' THEN               substr(obter_desc_expressao(327113), 1, 5) WHEN a.ie_mat_med_setor='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_mat_med_setor,
       a.ds_tipo_atend,
       a.ds_idade,
       a.dt_nascimento,
       a.ds_convenio,
       a.cd_usuario_convenio,
       a.ds_local,
       substr(a.ie_obs_proced, 1, 255) ie_obs_proced,
       CASE WHEN substr(a.ie_obs_proced, 1, 1)='S' THEN               substr(obter_desc_expressao(327113), 1, 5) WHEN substr(a.ie_obs_proced, 1, 1)='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_obs_proced,
       a.qt_prescrito,
       a.qt_liberado,
       a.qt_exame,
       a.ds_status_agenda,
       a.ds_exame_lab,
       a.ds_material_exame,
       a.nm_funcionario_executor,
       a.ds_motivo_ant,
       a.nr_acesso_dicom,
       a.nm_usuario_ditado,
       a.ds_email_medico_prescr,
       a.nm_anestesista,
       a.ds_contraste,
       a.ds_intervalo,
       a.nm_profissional_previsto,
       a.ds_tipo_isolamento_cih,
       a.ds_cor_isolamento_cih,
       a.ie_exame_cancelado,
       a.ds_proced_conta,
       a.cd_proced_conta,
       a.nm_medico,
       a.ie_solic_externa ie_solic_externa,
       a.ie_atend_alerta ie_atend_alerta,
       a.ie_possui_hist possui_hist,
       CASE WHEN a.ie_solic_externa='S' THEN               substr(obter_desc_expressao(327113), 1, 5) WHEN a.ie_solic_externa='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_solic_externa,
       CASE WHEN a.ie_atend_alerta='S' THEN               substr(obter_desc_expressao(327113), 1, 5) WHEN a.ie_atend_alerta='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_atend_alerta,
       CASE WHEN a.ie_possui_hist='S' THEN               substr(obter_desc_expressao(327113), 1, 5) WHEN a.ie_possui_hist='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_possui_hist,
       a.dt_impressao_imagem,
       a.ie_solicitacao_exame ie_solicitacao_exame,
       CASE WHEN a.ie_solicitacao_exame='S' THEN               substr(obter_desc_expressao(327113), 1, 5) WHEN a.ie_solicitacao_exame='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_solicitacao_exame,
       a.dt_alta,
       a.nr_crm_prescrito,
       a.nm_usu_lib_pat,
       a.dt_usu_lib_pat,
       a.ie_subamostra_exec ie_subamostra_exec,
       CASE WHEN a.ie_subamostra_exec='S' THEN               substr(obter_desc_expressao(327113), 1, 5) WHEN a.ie_subamostra_exec='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_subamostra_exec,
       a.ds_setor_local,
       a.nr_reserva,
       a.nr_transfusao,
       a.ds_peca_principal,
       a.nr_seq_locate,
       a.dt_prescricao,
       a.ie_recem_nato ie_recem_nato,
       CASE WHEN a.ie_recem_nato='S' THEN               substr(obter_desc_expressao(327113), 1, 5) WHEN a.ie_recem_nato='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_recem_nato,
       a.cd_medico_prescricao cd_medico,
       a.dt_liberacao_medico,
       a.nm_usuario_origin_prescr nm_usuario_original,
       a.nm_usuario_prescr_medica nm_usuario,
       a.dt_liberacao_prescricao dt_liberacao,
       a.cd_pessoa_fisica_prescr_medica cd_pessoa_fisica,
       a.cd_setor_atendimento,
       a.nr_controle,
       a.cd_estabelecimento_prescricao cd_estabelecimento,
       a.qt_peso,
       a.cd_medico_executor,
       a.dt_procedimento,
       a.nm_usuario_original nm_usuario_exec,
       a.dt_liberacao_laudo,
       a.nm_usuario_laudo,
       a.dt_laudo,
       substr(a.nm_usuario_aprovacao, 1, 15) nm_usuario_aprovacao,
       substr(a.nm_usuario_seg_aprov, 1, 15) nm_usuario_seg_aprov,
       a.dt_impressao,
       a.nr_prescricao nr_prescr,
       a.ie_status_execucao ie_status,
       a.dt_nascimento dt_nasc,
       a.qt_vol_hemocomp qt_vol_hemo,
       a.qt_procedimento,
       substr(obter_prontuario_pf(f.cd_estabelecimento, p.cd_pessoa_fisica),1,20) nr_prontuario,
       a.ds_breve_local,
       a.nr_seq_proced,
       a.ds_dado_clinico,
       a.cd_categoria,
       a.ds_material_especial,
       a.ds_localizacao_laudo,
       a.ds_exame_anterior,
       a.ds_forma_entrega_laudo,
       a.ie_imagem_entregue ie_imagem_entregue,
       CASE WHEN a.ie_imagem_entregue='S' THEN               substr(obter_desc_expressao(327113), 1, 5) WHEN a.ie_imagem_entregue='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_imagem_entregue,
       a.dt_cancelamento,
       a.ds_local_paciente,
       a.nm_medico_laudo_reg,
       a.ie_pago,
       substr(a.ds_motivo_atraso, 1, 255) ds_motivo_atraso,
       substr(a.ds_obs_agenda, 1, 200) ds_obs_agenda,
       a.nr_doc_convenio,
       CASE WHEN substr(OBTER_ANTECIPA_EXAME(a.cd_estabelecimento_prescricao),                     1,                     1)='S' THEN               coalesce(c.dt_antecipa_result, a.dt_entrega)  ELSE a.dt_entrega END  dt_entrega,
       a.ie_possui_evento,
       a.ds_contraste_conta,
       a.qt_filme,
       a.nm_pessoa_receb_img,
       a.nr_prioridade_triagem,
       a.ds_profissional_pref,
       a.ds_status_sr,
       a.dt_status_sr,
       a.ds_cor_status_sr,
       a.dt_agenda_integrada,
       a.ds_cor_entrega_laudo,
       a.ds_categoria_convenio,
       CASE WHEN a.dt_liberacao_medico IS NULL THEN               CASE WHEN a.dt_liberacao_medico IS NULL THEN  'N'  ELSE 'S' END   ELSE 'S' END  ie_prescr_lib,
       a.nr_seq_pepo,
       a.ds_senha_pac_fila,
       a.dt_solicit_antecip,
       a.cd_setor_pac,
       p.nm_pessoa_fisica,
       a.nr_seq_laudo nr_sequencia,
       a.nr_interno_conta nr_int_conta,
       substr(a.nr_seq_mot_anteci_result, 1, 120) ds_motivo_neg_antecip,
       a.ie_prioridade,
       a.ie_prioridade_classif,
       a.ds_prioridade_classif,
       a.cor_prioridade_classif,
       coalesce(f.ie_paciente_isolado, 'N') ie_paciente_isolado,
       f.dt_entrada,
       f.ie_tipo_atendimento,
       f.dt_atend_medico,
       f.dt_fim_consulta,
       f.ie_carater_inter_sus,
       f.ds_senha_qmatic,
       f.nr_seq_local_pa,
       TO_CHAR(f.dt_fim_triagem, 'hh24:mi') hr_fim_enfermagem,
       f.nr_seq_classificacao,
       TO_CHAR(f.dt_atend_medico, 'hh24:mi') hr_inicio_consulta,
       f.ie_status_pa,
       f.ie_clinica,
       f.dt_fim_triagem,
       CASE WHEN a.ie_prioridade=999 THEN  0  ELSE a.ie_prioridade END  ie_sem_prioridade,
       a.ds_triagem,
       a.ds_prioridade,
       a.ds_cor_prioridade,
       a.ds_classif_urgencia,
       a.ds_cor_urgencia,
       a.ie_prior_classif_atend,
       a.ds_clinica,
       coalesce(a.ds_senha, c.cd_senha) ds_senha_aut,
       c.ds_obs_antecip_result,
       CASE WHEN c.dt_neg_atencip_result IS NULL THEN  'N'  ELSE 'S' END  ie_antecip_negada,
       c.cd_procedimento,
       c.ie_origem_proced,
       c.dt_emissao_setor_atend,
       c.dt_resultado,
       c.dt_prev_execucao,
       c.cd_convenio,
       c.nr_seq_proc_interno,
       c.ie_lado,
       c.ie_autorizacao,
       c.ie_amostra,
       CASE WHEN c.ie_amostra='S' THEN               substr(obter_desc_expressao(327113), 1, 5) WHEN c.ie_amostra='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_amostra,
       substr(c.ds_observacao, 1, 255) ds_observacao,
       c.dt_baixa,
       c.nm_usuario_baixa_esp,
       c.nr_seq_lab,
       coalesce(c.ie_executar_leito, 'N') ie_executar_leito,
       CASE WHEN coalesce(c.ie_executar_leito, 'N')='S' THEN               substr(obter_desc_expressao(327113), 1, 5) WHEN coalesce(c.ie_executar_leito, 'N')='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_executar_leito,
       c.dt_inicio_exame,
       c.dt_antecipa_result,
       coalesce(TO_CHAR(c.dt_antecipa_result, 'DD/MM/YYYY HH24:MI:SS'),
           CASE WHEN c.nm_usuario_antecipacao IS NULL THEN                   ''  ELSE substr(obter_desc_expressao(325566),1,20) END ) ds_antecipa_result,
       c.cd_motivo_baixa,
       c.nr_ocorrencia,
       c.nr_seq_exame,
       c.dt_lib_imagem,
       c.nm_usuario_antecipacao,
       substr(c.ds_observacao_antecipacao, 1, 255) DS_OBS_ANTECIP,
       c.qt_procedimento qt_prescr_proced,
       c.cd_profissional,
       c.ie_aliquotado ie_aliquotado,
       c.ie_filtrado ie_filtrado,
       c.ie_irradiado ie_irradiado,
       c.ie_lavado ie_lavado,
       CASE WHEN c.ie_aliquotado='S' THEN               substr(obter_desc_expressao(327113), 1, 5) WHEN c.ie_aliquotado='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_aliquotado,
       CASE WHEN c.ie_filtrado='S' THEN               substr(obter_desc_expressao(327113), 1, 5) WHEN c.ie_filtrado='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_filtrado,
       CASE WHEN c.ie_irradiado='S' THEN               substr(obter_desc_expressao(327113), 1, 5) WHEN c.ie_irradiado='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_irradiado,
       CASE WHEN c.ie_lavado='S' THEN               substr(obter_desc_expressao(327113), 1, 5) WHEN c.ie_lavado='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_lavado,
       c.dt_chamada_exame,
       CASE WHEN c.ie_urgencia='S' THEN               substr(obter_desc_expressao(556023), 1, 8) END  ds_urgencia,
       c.ie_status_execucao,
       c.ie_tipo_proced,
       c.nr_seq_status_pato,
       coalesce(c.ie_proced_bloqueado, 'N') ie_proced_bloqueado,
       CASE WHEN coalesce(c.ie_proced_bloqueado, 'N')='S' THEN               substr(obter_desc_expressao(327113), 1, 5) WHEN coalesce(c.ie_proced_bloqueado, 'N')='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_proced_bloqueado,
       substr(c.ds_observacao_bloqueio, 1, 255) ds_observacao_bloqueio,
       c.ie_exige_liberacao,
       c.dt_reprovacao,
       substr(c.ds_justificativa_reprov, 1, 255) ds_justificativa_rep,
       substr(c.ds_rotina, 1, 80) ds_rotina,
       TO_CHAR(c.qt_frasco_env) qt_frasco_env,
       TO_CHAR(c.qt_frasco_rec) qt_frasco_rec,
       c.ds_motivo_revisao,
       c.dt_chegada_paciente,
       c.dt_inicio_preparo,
       c.nr_seq_proced nr_seq_proced_regra,
       coalesce(c.ie_aprovacao_execucao, 'N') ie_aprovacao_execucao,
       CASE WHEN coalesce(c.ie_aprovacao_execucao, 'N')='S' THEN               substr(obter_desc_expressao(327113), 1, 5) WHEN coalesce(c.ie_aprovacao_execucao, 'N')='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_aprovacao_execucao,
       coalesce(c.ie_prev_execucao_alt, 'N') ie_prev_execucao_alt,
       CASE WHEN coalesce(c.ie_prev_execucao_alt, 'N')='S' THEN               substr(obter_desc_expressao(327113), 1, 5) WHEN coalesce(c.ie_prev_execucao_alt, 'N')='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_prev_execucao_alt,
       c.dt_aprovacao_execucao,
       CASE WHEN coalesce(c.qt_frasco_rec, 0)=0 THEN  'N'  ELSE 'S' END  ie_existe_frasco,
       CASE WHEN coalesce(c.qt_frasco_rec, 0)=0 THEN               substr(obter_desc_expressao(327114), 1, 5)  ELSE substr(obter_desc_expressao(327113), 1, 5) END  ds_existe_frasco,
       c.nr_seq_motivo_just,
       c.dt_recebimento_frasco,
       c.ie_anestesia ie_anestesia,
       CASE WHEN c.ie_anestesia='S' THEN               substr(obter_desc_expressao(327113), 1, 5) WHEN c.ie_anestesia='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_anestesia,
       c.dt_fim_preparo,
       substr(c.ds_observacao_canc_exame, 1, 255) ds_observacao_canc_exame,
       c.dt_fim_exame,
       c.nr_seq_motivo_atraso,
       c.ds_integracao,
       c.dt_integracao,
       substr(c.ds_resumo_clinico, 1, 255) ds_resumo_clinico,
       substr(c.ds_justificativa, 1, 255) ds_justificativa,
       c.ie_urgencia,
       c.cd_equipamento,
       CASE WHEN c.ie_imagem_pacs='S' THEN  'S'  ELSE '' END  ie_imagem_pacs,
       c.nr_seq_topografia,
       c.dt_suspensao,
       c.ds_motivo_susp,
       c.nm_usuario_susp,
       a.ds_cor_fonte_urgencia,
       substr(obter_cor_nr_seq_local_pa(a.nr_atendimento), 1, 100) ds_cor_local_pa,
       substr(obter_nome_pessoa_fisica(a.cd_medico_prev_laudo, null),
              1,
              100) nm_medico_prev_laudo,
       CASE WHEN coalesce(substr(OBTER_PARAMETRO_FUNCAO(427, 340, obter_usuario_ativo),1,10), 0)=0 THEN               0  ELSE (coalesce(substr(obter_seq_apres_pa(substr(obter_status_atend_pa_nova(f.nr_atendimento,                                                                                 f.dt_alta,                                                                                 f.dt_medicacao,                                                                                 f.dt_lib_medico,                                                                                 f.dt_atend_medico,                                                                                 f.dt_fim_consulta,                                                                                 f.dt_inicio_atendimento,                                                                                 f.dt_fim_triagem,                                                                                 f.dt_chamada_paciente,                                                                                 f.dt_liberacao_enfermagem,                                                                                 f.dt_reavaliacao_medica,                                                                                 f.nr_atend_alta,                                                                                 f.cd_estabelecimento,                                                                                 f.dt_fim_reavaliacao,                                                                                 f.dt_inicio_observacao,                                                                                 f.dt_fim_observacao),                                                      1,                                                      10),                                               f.cd_estabelecimento), 1,10),                            0))::numeric  END  nr_seq_apresent,
       substr(obter_nome_pf(c.cd_profissional_resp), 1, 100) nm_profissional_resp,
       substr(obter_desc_condicao_exame(c.nr_seq_condicao), 1, 255) ds_condicao,
       substr(obter_desc_status_patologia(c.nr_seq_status_pato), 1, 150) ds_status_patologia,
       substr(obter_desc_status_pato_dom(c.nr_seq_status_pato, 'C'), 1, 80) ie_status_patologia,
       substr(obter_desc_protocolo(c.cd_protocolo), 1, 255) ds_protocolo,
       substr(obter_idade(p.dt_nascimento, LOCALTIMESTAMP, 'A'), 1, 15) qt_idade,
       substr(obter_se_entrega_biometrica(a.nr_prescricao, a.nr_seq_proced),
              1,
              2) ie_entrega_biometrica,
       substr(obter_nome_prescricao(a.nr_prescricao, 'RND'), 1, 150) nm_paciente,
       substr(obter_max_prescr_hist_status(a.nr_prescricao, a.nr_seq_proced),
              1,
              60) ds_status_historico,
       substr(p.nm_social, 1, 200) nm_social,
       substr(lab_obter_dt_retirada_laudo(a.nr_seq_laudo), 1, 30) dt_retirada,
       substr(elimina_caracteres_especiais(p.nm_pessoa_fisica), 1, 15) nm_pac_laudo,
       substr(obter_valor_dominio(8390, a.ie_tumor), 1, 255) ie_tumor,
       proc.cd_tipo_procedimento,
       sit.ds_tipo_situacao,
       sit.ie_bloqueado,
       sit.ie_negrito,
       sit.ie_italico,
       sit.ds_cor,
       compl.nm_usuario_situacao,
       substr(a.ds_imunohistoquimica, 1, 2) as ds_imunohistoquimica,
       CASE WHEN substr(a.ds_imunohistoquimica, 1, 2)='S' THEN               substr(obter_desc_expressao(327113), 1, 5) WHEN substr(a.ds_imunohistoquimica, 1, 2)='N' THEN               substr(obter_desc_expressao(327114), 1, 5) END  ds_imunohistoquimica_desc,
       a.dt_laudo_cancelamento,
       a.cd_prioridade,
       a.ds_tmp_para_execucao,
       substr(obter_paciente_recuperacao(p.cd_pessoa_fisica,
                                         f.nr_atendimento),
              1,
              100) status_recuperacao,
       dt_fim_recuperacao,
       dt_inicio_recuperacao,
       substr(obter_solicitacao(f.ie_tipo_atendimento), 1, 10) as DS_SOLICITACAO,
       substr(obter_alergias(p.cd_pessoa_fisica), 1, 20) ds_alergia,
       substr(obter_deficiencia_paciente(p.cd_pessoa_fisica), 1, 20) ds_deficiencia,
       a.ds_agenda
  FROM procedimento proc, pessoa_fisica p, prescr_procedimento c
LEFT OUTER JOIN prescr_procedimento_compl compl ON (c.nr_seq_proc_compl = compl.nr_sequencia)
LEFT OUTER JOIN situacao_procedimento sit ON (compl.nr_seq_situacao_proc = sit.nr_sequencia)
, w_gestao_exame a
LEFT OUTER JOIN atendimento_paciente f ON (a.nr_atendimento = f.nr_atendimento)
LEFT OUTER JOIN recuperacao_paciente rp ON (a.nr_atendimento = rp.nr_atendimento AND a.cd_pessoa_fisica_prescr_medica = rp.cd_pessoa_fisica)
WHERE a.nr_seq_interno = c.nr_seq_interno  AND a.cd_pessoa_fisica_prescr_medica = p.cd_pessoa_fisica AND c.cd_procedimento = proc.cd_procedimento AND c.ie_origem_proced = proc.ie_origem_proced;

