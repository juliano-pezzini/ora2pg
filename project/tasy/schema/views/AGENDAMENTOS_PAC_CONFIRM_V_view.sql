-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW agendamentos_pac_confirm_v (cd, ds, cd_pessoa_fisica, dt_agenda) AS SELECT   a.nr_sequencia cd,
         SUBSTR(TO_CHAR(a.hr_inicio,'hh24:mi') ||' '|| OBTER_TEXTO_TASY(690048,NULL)||' '|| SUBSTR(obter_nome_agenda(a.cd_agenda),1,50) || ' - ' || OBTER_TEXTO_TASY(690050,NULL) ||' '|| SUBSTR(obter_exame_agenda(a.cd_procedimento,a.ie_origem_proced,a.nr_seq_proc_interno),1,240),1,400) AS ds,
		a.cd_pessoa_Fisica,
		a.dt_agenda
FROM     agenda_paciente a,
	 agenda b
WHERE    a.cd_agenda = b.cd_agenda
AND	 b.cd_tipo_agenda IN (1,2)
and	a.dt_confirmacao is null
AND      a.ie_status_agenda        = 'N'

UNION

SELECT   a.nr_sequencia cd,
         SUBSTR(TO_CHAR(a.dt_agenda,'hh24:mi') ||' '||OBTER_TEXTO_TASY(690048,NULL)||' '|| SUBSTR(coalesce(obter_nome_medico_combo_agcons(b.cd_estabelecimento, a.cd_agenda, 3, 'N'),b.ds_agenda),1,50) ||CASE WHEN b.cd_tipo_agenda=3 THEN  ' - '||OBTER_TEXTO_TASY(690054,NULL) WHEN b.cd_tipo_agenda=5 THEN  ' - '||OBTER_TEXTO_TASY(690053,NULL) END ,1,400) AS ds,
		 a.cd_pessoa_Fisica,
		a.dt_agenda
FROM	   agenda_consulta a,
	   agenda b
WHERE      a.cd_agenda = b.cd_agenda
AND	   b.cd_tipo_agenda IN (3,4,5)
and	a.dt_confirmacao is null
AND	   a.ie_status_agenda        = 'N'
ORDER BY 2;

