-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW audc_dados_beneficiario_v (nr_sequencia, cd_pessoa_fisica, nm_pessoa_fisica, nm_social, dt_nascimento, ie_sexo, qt_idade, ds_plano, nm_fantasia, ds_acomodacao, ds_contratacao, ds_abrangencia, ds_sexo, dt_validade_carteira, cd_cartao_beneficiario, cd_estabelecimento) AS select  a.nr_sequencia,
	c.cd_pessoa_fisica,
        c.nm_pessoa_fisica,
	c.nm_social,
        c.dt_nascimento,
        c.ie_sexo,
        obter_idade(c.dt_nascimento, LOCALTIMESTAMP, 'A') qt_idade,
	d.ds_plano,
        d.nm_fantasia,	
        pls_obter_acomodacoes_plano(d.nr_sequencia) ds_acomodacao,
        obter_valor_dominio(1666, d.ie_tipo_contratacao) ds_contratacao,
        obter_valor_dominio(1667, d.ie_abrangencia) ds_abrangencia,
	obter_valor_dominio(4,c.ie_sexo) ds_sexo,
        b.dt_validade_carteira,
        coalesce(b.cd_usuario_plano,b.nr_cartao_intercambio) cd_cartao_beneficiario,
	c.cd_estabelecimento	
FROM    pls_segurado a,
        pls_segurado_carteira b,
        pessoa_fisica c,
        pls_plano d
where   a.cd_pessoa_fisica = c.cd_pessoa_fisica
and     b.nr_seq_segurado = a.nr_sequencia
and     a.nr_seq_plano = d.nr_sequencia;

