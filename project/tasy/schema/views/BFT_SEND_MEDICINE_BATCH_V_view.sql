-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW bft_send_medicine_batch_v (material_description, material_code, amount_hourly_dispensation, measure_unit_hr_dispensation, time_dispensation, batch_code, total_amount_dispensation, prescription_release_date, prescription_number, amount_dose, measure_unit_dose, hours_dispensation, amount_dispensation, description_time_dispensation, material_sequence, prescription_start_date, prescription_end_date) AS select  substr(obter_desc_material(a.cd_material),1,60) material_description,
        a.cd_material material_code,
        a.qt_dispensar_hor amount_hourly_dispensation,
        a.cd_unidade_medida measure_unit_hr_dispensation,
        a.dt_horario time_dispensation,
        a.nr_seq_lote batch_code,
        a.qt_dispensar total_amount_dispensation,
        coalesce(b.dt_liberacao_farmacia,b.dt_liberacao) prescription_release_date ,
        b.nr_prescricao prescription_number,
        a.qt_dose amount_dose,
        a.cd_unidade_medida_dose measure_unit_dose,     
        a.ds_horario hours_dispensation,       
        a.qt_dispensar amount_dispensation,
        a.ds_turno description_time_dispensation,                       
        a.nr_seq_material material_sequence,
        b.dt_inicio_prescr prescription_start_date,
        b.dt_validade_prescr prescription_end_date
FROM    prescr_mat_hor a ,
        prescr_medica b
where   a.nr_seq_lote is not null
and     a.nr_prescricao = b.nr_prescricao
order by dt_horario;

