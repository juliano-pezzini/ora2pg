-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pagamento_escrit_brasil_hdh_v (tp_registro, nr_inscricao, cd_agencia, ie_dig_agencia, cd_conta, ie_dig_conta, ds_dac_agencia, nm_empresa, ds_banco, dt_arquivo, nr_seq_envio, ie_tipo_fornecedor, cd_cgc_fornecedor, cd_agencia_bancaria, nr_conta_forneced, ie_dig_conta_forneced, nm_hospital, ds_endereco, nr_endereco, ds_cidade, cd_cep, ds_estado, cd_banco_fornecedor, cd_agencia_fornecedor, cd_agencia_conta, nm_fornecedor, nr_documento, dt_vencimento, vl_saldo_titulo, nr_inscricao_fornec, qt_registros, ie_cod_barras, vl_titulo, vl_desconto, vl_acrescimo, dt_pagto, vl_pagto, vl_total_pagto, qt_lotes_arquivo, qt_total_registros, ie_registro, ie_forma_pagto, ie_ordem) AS select	0 tp_registro,
	a.cd_cgc nr_inscricao, 
	somente_numero(g.cd_agencia_bancaria) cd_agencia, 
	to_char(calcula_digito('Modulo11',g.cd_agencia_bancaria)) ie_dig_agencia, 
	g.cd_conta, 
	substr(g.ie_digito_conta,1,1) ie_dig_conta, 
	substr(g.ie_digito_conta,2,1) ds_dac_agencia, 
	upper(p.ds_razao_social) nm_empresa, 
	upper(g.ds_banco) ds_banco, 
	to_char(LOCALTIMESTAMP, 'ddmmyyyyhh24miss') dt_arquivo, 
	e.nr_sequencia nr_seq_envio, 
	'0' ie_tipo_fornecedor, 
	'0' cd_cgc_fornecedor, 
	'0' cd_agencia_bancaria, 
	'0' nr_conta_forneced, 
	'0' ie_dig_conta_forneced, 
	'' nm_hospital, 
	'' ds_endereco,	 
	'0' nr_endereco, 
	'' ds_cidade, 
	'0' cd_cep, 
	'' ds_estado, 
	0 cd_banco_fornecedor, 
	0 cd_agencia_fornecedor, 
	'' cd_agencia_conta, 
	'' nm_fornecedor, 
	0 nr_documento, 
	LOCALTIMESTAMP dt_vencimento, 
	0 vl_saldo_titulo, 
	'0' nr_inscricao_fornec, 
	0 qt_registros, 
	'' ie_cod_barras, 
	0 vl_titulo, 
	0 vl_desconto, 
	0 vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	0 vl_pagto, 
	0 vl_total_pagto, 
	0 qt_lotes_arquivo, 
	0 qt_total_registros, 
	'0' ie_registro, 
	0 ie_forma_pagto, 
	1 ie_ordem 
FROM	estabelecimento a, 
	banco_estabelecimento_v g, 
	pessoa_juridica p, 
	banco_escritural e 
where	e.cd_estabelecimento  	= a.cd_estabelecimento 
 and	a.cd_cgc		= p.cd_cgc 
 and	g.nr_sequencia		= e.nr_seq_conta_banco 
 and	g.ie_tipo_relacao   	in ('EP','ECC') 

union
 
/* Header do Lote Documento - Banco do Brasil*/
 
select	distinct 1 tp_registro, 
	'0' nr_inscricao, 
	0 cd_agencia, 
	to_char(calcula_digito('Modulo11',b.cd_agencia_bancaria)) ie_dig_agencia, 
	'0' cd_conta, 
	'' ie_dig_conta, 
	'' ds_dac_agencia, 
	'' nm_empresa, 
	'' ds_banco, 
	'' dt_arquivo, 
	a.nr_sequencia nr_seq_envio, 
	'2' ie_tipo_fornecedor, 
	e.cd_cgc cd_cgc_fornecedor, 
	'0' cd_agencia_bancaria, 
 	b.cd_conta nr_conta_forneced, 
	substr(b.ie_digito_conta,1,1) ie_dig_conta_forneced, 
	upper(j.ds_razao_social) nm_hospital, 
	upper(j.ds_endereco) ds_endereco, 
	j.nr_endereco, 
	j.ds_municipio, 
	j.cd_cep, 
	j.sg_estado ds_estado, 
	c.cd_banco cd_banco_fornecedor, 
 	somente_numero(b.cd_agencia_bancaria) cd_agencia_fornecedor, 
	'' cd_agencia_conta, 
	upper(j.ds_razao_social) nm_fornecedor, 
	0 nr_documento, 
	LOCALTIMESTAMP dt_vencimento, 
	0 vl_saldo_titulo, 
	'0' nr_inscricao_fornec, 
	0 qt_registros, 
	'' ie_cod_barras, 
	0 vl_titulo, 
	0 vl_desconto, 
	0 vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	0 vl_pagto, 
	0 vl_total_pagto, 
	0 qt_lotes_arquivo, 
	0 qt_total_registros, 
	'1' ie_registro, 
	30 ie_forma_pagto, 
	2 ie_ordem 
from	pessoa_juridica j, 
	Estabelecimento e, 
	banco_estabelecimento b, 
	banco_escritural a, 
	titulo_pagar_v2 d, 
	titulo_pagar_escrit c 
where	c.nr_titulo       = d.nr_titulo 
and	e.cd_cgc		= j.cd_cgc 
and	a.nr_sequencia     = c.nr_seq_escrit 
and	a.nr_seq_conta_banco	= b.nr_sequencia 
and	a.cd_estabelecimento  = e.cd_estabelecimento 
and	b.ie_tipo_relacao    in ('EP','ECC') 
and 	c.ie_tipo_pagamento		= 'DOC' 
and	c.cd_banco		= 001 

Union
 
/* Detalhe Documento - Banco do Brasil */
 
select	2 tp_registro, 
	'0' nr_inscricao, 
	0 cd_agencia, 
	'' ie_dig_agencia, 
	'0' cd_conta, 
	'' ie_dig_conta, 
	'' ds_dac_agencia, 
	'' nm_empresa, 
	'' ds_banco, 
	'' dt_arquivo, 
	a.nr_sequencia nr_seq_envio, 
	'0' ie_tipo_fornecedor, 
	d.cd_favorecido cd_cgc_fornecedor, 
	'0' cd_agencia_bancaria, 
	'0' nr_conta_forneced, 
	'0' ie_dig_conta_forneced, 
	'' nm_hospital, 
	'' ds_endereco, 
	'0' nr_endereco, 
	'' ds_cidade, 
	'0' cd_cep, 
	'' ds_estado, 
	c.cd_banco cd_banco_fornecedor, 
	somente_numero(c.cd_agencia_bancaria) cd_agencia_fornecedor, 
	'0' || c.cd_agencia_bancaria || '0000000' || c.nr_conta cd_agencia_conta, 
	d.nm_favorecido nm_fornecedor, 
	d.nr_titulo nr_documento, 
	d.dt_vencimento_atual dt_vencimento, 
	d.vl_saldo_titulo, 
	e.cd_cgc nr_inscricao_fornec, 
	0 qt_registros, 
	'' ie_cod_barras, 
	0 vl_titulo, 
	0 vl_desconto, 
	0 vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	0 vl_pagto, 
	0 vl_total_pagto, 
	0 qt_lotes_arquivo, 
	0 qt_total_registros, 
	'3' ie_registro, 
	0 ie_forma_pagto, 
	3 ie_ordem 
from	pessoa_juridica j, 
	Estabelecimento e, 
	banco_estabelecimento b, 
	banco_escritural a, 
	titulo_pagar_v2 d, 
	titulo_pagar_escrit c 
where	c.nr_titulo       = d.nr_titulo 
and	e.cd_cgc		= j.cd_cgc 
and	a.nr_sequencia     = c.nr_seq_escrit 
and	a.nr_seq_conta_banco	= b.nr_sequencia 
and	a.cd_estabelecimento  = e.cd_estabelecimento 
and	b.ie_tipo_relacao    in ('EP','ECC') 
and 	c.ie_tipo_pagamento		= 'DOC' 
and	c.cd_banco		= 001 

Union
 
/* Trailler do Lote Documento - Banco do Brasil */
 
select	3 tp_registro, 
	'0' nr_inscricao, 
	0 cd_agencia, 
	'' ie_dig_agencia, 
	'0' cd_conta, 
	'' ie_dig_conta, 
	'' ds_dac_agencia, 
	'' nm_empresa, 
	'' ds_banco, 
	'' dt_arquivo, 
	e.nr_sequencia nr_seq_envio, 
	'0' ie_tipo_fornecedor, 
	'0' cd_cgc_fornecedor, 
	'0' cd_agencia_bancaria, 
	'0' nr_conta_forneced, 
	'0' ie_dig_conta_forneced, 
	'' nm_hospital, 
	'' ds_endereco, 
	'0' nr_endereco, 
	'' ds_cidade, 
	'0' cd_cep, 
	'' ds_estado, 
	0 cd_banco_fornecedor, 
	0 cd_agencia_fornecedor, 
	'' cd_agencia_conta, 
	'' nm_fornecedor, 
	0 nr_documento, 
	LOCALTIMESTAMP dt_vencimento, 
	0 vl_saldo_titulo, 
	'0' nr_inscricao_fornec, 
	(count(*) + 2) qt_registros, 
	'' ie_cod_barras, 
	0 vl_titulo, 
	0 vl_desconto, 
	0 vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	0 vl_pagto, 
	sum(c.vl_escritural - c.vl_desconto + c.vl_acrescimo) vl_total_pagto, 
	0 qt_lotes_arquivo, 
	0 qt_total_registros, 
	'5' ie_registro, 
	0 ie_forma_pagto, 
	4 ie_ordem 
from	banco_estabelecimento b, 
	estabelecimento a,    
	banco_escritural e, 
	titulo_pagar_escrit c 
where	e.nr_sequencia		= c.nr_seq_escrit 
and	e.nr_seq_conta_banco	= b.nr_sequencia 
and	e.cd_estabelecimento  	= a.cd_estabelecimento 
and	b.ie_tipo_relacao   	in ('EP','ECC') 
and 	c.ie_tipo_pagamento		= 'DOC' 
and	c.cd_banco		= 001 
group by e.nr_sequencia 

union
 
/* Header do Lote Documento - Outros Bancos*/
 
select	distinct 1 tp_registro, 
	'0' nr_inscricao, 
	0 cd_agencia, 
	to_char(calcula_digito('Modulo11',b.cd_agencia_bancaria)) ie_dig_agencia, 
	'0' cd_conta, 
	'' ie_dig_conta, 
	'' ds_dac_agencia, 
	'' nm_empresa, 
	'' ds_banco, 
	'' dt_arquivo, 
	a.nr_sequencia nr_seq_envio, 
	'2' ie_tipo_fornecedor, 
	e.cd_cgc cd_cgc_fornecedor, 
	'0' cd_agencia_bancaria, 
 	b.cd_conta nr_conta_forneced, 
	substr(b.ie_digito_conta,1,1) ie_dig_conta_forneced, 
	upper(j.ds_razao_social) nm_hospital, 
	upper(j.ds_endereco) ds_endereco, 
	j.nr_endereco, 
	j.ds_municipio, 
	j.cd_cep, 
	j.sg_estado ds_estado, 
	c.cd_banco cd_banco_fornecedor, 
 	somente_numero(b.cd_agencia_bancaria) cd_agencia_fornecedor, 
	'' cd_agencia_conta, 
	upper(j.ds_razao_social) nm_fornecedor, 
	0 nr_documento, 
	LOCALTIMESTAMP dt_vencimento, 
	0 vl_saldo_titulo, 
	'0' nr_inscricao_fornec, 
	0 qt_registros, 
	'' ie_cod_barras, 
	0 vl_titulo, 
	0 vl_desconto, 
	0 vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	0 vl_pagto, 
	0 vl_total_pagto, 
	0 qt_lotes_arquivo, 
	0 qt_total_registros, 
	'1' ie_registro, 
	31 ie_forma_pagto, 
	5 ie_ordem 
from	pessoa_juridica j, 
	Estabelecimento e, 
	banco_estabelecimento b, 
	banco_escritural a, 
	titulo_pagar_v2 d, 
	titulo_pagar_escrit c 
where	c.nr_titulo       = d.nr_titulo 
and	e.cd_cgc		= j.cd_cgc 
and	a.nr_sequencia     = c.nr_seq_escrit 
and	a.nr_seq_conta_banco	= b.nr_sequencia 
and	a.cd_estabelecimento  = e.cd_estabelecimento 
and	b.ie_tipo_relacao    in ('EP','ECC') 
and 	c.ie_tipo_pagamento		= 'DOC' 
and	c.cd_banco		<> 001 

Union
 
/* Detalhe Documento - Outros Bancos */
 
select	2 tp_registro, 
	'0' nr_inscricao, 
	0 cd_agencia, 
	'' ie_dig_agencia, 
	'0' cd_conta, 
	'' ie_dig_conta, 
	'' ds_dac_agencia, 
	'' nm_empresa, 
	'' ds_banco, 
	'' dt_arquivo, 
	a.nr_sequencia nr_seq_envio, 
	'0' ie_tipo_fornecedor, 
	d.cd_favorecido cd_cgc_fornecedor, 
	'0' cd_agencia_bancaria, 
	'0' nr_conta_forneced, 
	'0' ie_dig_conta_forneced, 
	'' nm_hospital, 
	'' ds_endereco, 
	'0' nr_endereco, 
	'' ds_cidade, 
	'0' cd_cep, 
	'' ds_estado, 
	c.cd_banco cd_banco_fornecedor, 
	somente_numero(c.cd_agencia_bancaria) cd_agencia_fornecedor, 
	'0' || c.cd_agencia_bancaria || '0000000' || c.nr_conta cd_agencia_conta, 
	d.nm_favorecido nm_fornecedor, 
	d.nr_titulo nr_documento, 
	d.dt_vencimento_atual dt_vencimento, 
	d.vl_saldo_titulo, 
	e.cd_cgc nr_inscricao_fornec, 
	0 qt_registros, 
	'' ie_cod_barras, 
	0 vl_titulo, 
	0 vl_desconto, 
	0 vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	0 vl_pagto, 
	0 vl_total_pagto, 
	0 qt_lotes_arquivo, 
	0 qt_total_registros, 
	'3' ie_registro, 
	0 ie_forma_pagto, 
	6 ie_ordem 
from	pessoa_juridica j, 
	Estabelecimento e, 
	banco_estabelecimento b, 
	banco_escritural a, 
	titulo_pagar_v2 d, 
	titulo_pagar_escrit c 
where	c.nr_titulo       = d.nr_titulo 
and	e.cd_cgc		= j.cd_cgc 
and	a.nr_sequencia     = c.nr_seq_escrit 
and	a.nr_seq_conta_banco	= b.nr_sequencia 
and	a.cd_estabelecimento  = e.cd_estabelecimento 
and	b.ie_tipo_relacao    in ('EP','ECC') 
and 	c.ie_tipo_pagamento		= 'DOC' 
and	c.cd_banco		<> 001 

Union
 
/* Trailler do Lote Documento - Outros Bancos*/
 
select	3 tp_registro, 
	'0' nr_inscricao, 
	0 cd_agencia, 
	'' ie_dig_agencia, 
	'0' cd_conta, 
	'' ie_dig_conta, 
	'' ds_dac_agencia, 
	'' nm_empresa, 
	'' ds_banco, 
	'' dt_arquivo, 
	e.nr_sequencia nr_seq_envio, 
	'0' ie_tipo_fornecedor, 
	'0' cd_cgc_fornecedor, 
	'0' cd_agencia_bancaria, 
	'0' nr_conta_forneced, 
	'0' ie_dig_conta_forneced, 
	'' nm_hospital, 
	'' ds_endereco, 
	'0' nr_endereco, 
	'' ds_cidade, 
	'0' cd_cep, 
	'' ds_estado, 
	0 cd_banco_fornecedor, 
	0 cd_agencia_fornecedor, 
	'' cd_agencia_conta, 
	'' nm_fornecedor, 
	0 nr_documento, 
	LOCALTIMESTAMP dt_vencimento, 
	0 vl_saldo_titulo, 
	'0' nr_inscricao_fornec, 
	(count(*) + 2) qt_registros, 
	'' ie_cod_barras, 
	0 vl_titulo, 
	0 vl_desconto, 
	0 vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	0 vl_pagto, 
	sum(c.vl_escritural - c.vl_desconto + c.vl_acrescimo) vl_total_pagto, 
	0 qt_lotes_arquivo, 
	0 qt_total_registros, 
	'5' ie_registro, 
	0 ie_forma_pagto, 
	7 ie_ordem 
from	banco_estabelecimento b, 
	estabelecimento a, 	 
	titulo_pagar_v2 d,   
	banco_escritural e, 
	titulo_pagar_escrit c 
where	e.nr_sequencia			= c.nr_seq_escrit 
and	c.nr_titulo			= d.nr_titulo 
and	e.nr_seq_conta_banco		= b.nr_sequencia 
and	e.cd_estabelecimento  	= a.cd_estabelecimento 
and	b.ie_tipo_relacao 	  	in ('EP','ECC') 
and 	c.ie_tipo_pagamento		= 'DOC' 
and	c.cd_banco 			<> 001 
group by e.nr_sequencia 

union
 
/* Header do Lote Bloquetos*/
 
select	distinct 4 tp_registro, 
	'0' nr_inscricao, 
	0 cd_agencia, 
	to_char(calcula_digito('Modulo11',b.cd_agencia_bancaria)) ie_dig_agencia, 
	'0' cd_conta, 
	'' ie_dig_conta, 
	'' ds_dac_agencia, 
	'' nm_empresa, 
	'' ds_banco, 
	'' dt_arquivo, 
	a.nr_sequencia nr_seq_envio, 
	'2' ie_tipo_fornecedor, 
	e.cd_cgc cd_cgc_fornecedor, 
	'0' cd_agencia_bancaria, 
 	b.cd_conta nr_conta_forneced, 
	substr(b.ie_digito_conta,1,1) ie_dig_conta_forneced, 
	upper(j.ds_razao_social) nm_hospital, 
	upper(j.ds_endereco) ds_endereco, 
	j.nr_endereco, 
	j.ds_municipio, 
	j.cd_cep, 
	j.sg_estado ds_estado, 
	c.cd_banco cd_banco_fornecedor, 
 	somente_numero(b.cd_agencia_bancaria) cd_agencia_fornecedor, 
	'' cd_agencia_conta, 
	upper(j.ds_razao_social) nm_fornecedor, 
	0 nr_documento, 
	LOCALTIMESTAMP dt_vencimento, 
	0 vl_saldo_titulo, 
	'0' nr_inscricao_fornec, 
	0 qt_registros, 
	'' ie_cod_barras, 
	0 vl_titulo, 
	0 vl_desconto, 
	0 vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	0 vl_pagto, 
	0 vl_total_pagto, 
	0 qt_lotes_arquivo, 
	0 qt_total_registros, 
	'1' ie_registro, 
	30 ie_forma_pagto, 
	8 ie_ordem 
from	pessoa_juridica j, 
	Estabelecimento e, 
	banco_estabelecimento b, 
	banco_escritural a, 
	titulo_pagar_escrit c 
where	e.cd_cgc		= j.cd_cgc 
and	a.nr_sequencia     = c.nr_seq_escrit 
and	a.nr_seq_conta_banco	= b.nr_sequencia 
and	a.cd_estabelecimento  = e.cd_estabelecimento 
and	b.ie_tipo_relacao    in ('EP','ECC') 
and 	c.ie_tipo_pagamento		= 'BLQ' 
and	c.cd_banco 		= 001 

Union
 
/* Detalhe Bloquetos */
 
select	5 tp_registro, 
	'0' nr_inscricao, 
	0 cd_agencia, 
	'' ie_dig_agencia, 
	'0' cd_conta, 
	'' ie_dig_conta, 
	'' ds_dac_agencia, 
	'' nm_empresa, 
	'' ds_banco, 
	'' dt_arquivo, 
	a.nr_sequencia nr_seq_envio, 
	d.ie_tipo_favorecido ie_tipo_fornecedor, 
	d.cd_favorecido cd_cgc_fornecedor, 
	'0' cd_agencia_bancaria, 
	c.nr_conta nr_conta_forneced, 
	'0' ie_dig_conta_forneced, 
	'' nm_hospital, 
	'' ds_endereco, 
	'0' nr_endereco, 
	'' ds_cidade, 
	'0' cd_cep, 
	'' ds_estado, 
	c.cd_banco cd_banco_fornecedor, 
	somente_numero(c.cd_agencia_bancaria) cd_agencia_fornecedor, 
	'0' || c.cd_agencia_bancaria || '0000000' || c.nr_conta cd_agencia_conta, 
	d.nm_favorecido nm_fornecedor, 
	0 nr_documento, 
	d.dt_vencimento_atual dt_vencimento, 
	d.vl_saldo_titulo vl_saldo_titulo, 
	'0' nr_inscricao_fornec, 
	0 qt_registros, 
	d.nr_bloqueto ie_cod_barras, 
	d.vl_titulo, 
	c.vl_desconto, 
	c.vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	d.vl_saldo_titulo vl_pagto, 
	0 vl_total_pagto, 
	0 qt_lotes_arquivo, 
	0 qt_total_registros, 
	'3' ie_registro, 
	0 ie_forma_pagto, 
	9 ie_ordem 
from	Estabelecimento e, 
	banco_estabelecimento b, 
	banco_escritural a, 
	titulo_pagar_v2 d,	 
	titulo_pagar_escrit c 
where	c.nr_titulo		= d.nr_titulo 
and	a.nr_sequencia		= c.nr_seq_escrit 
and	a.nr_seq_conta_banco	= b.nr_sequencia 
and	a.cd_estabelecimento	= e.cd_estabelecimento 
and 	b.ie_tipo_relacao	in ('EP','ECC') 
and 	c.ie_tipo_pagamento	= 'BLQ' 
and	c.cd_banco 		= 001 

Union
 
/* Trailler do Lote Bloquetos*/
 
select	6 tp_registro, 
	'0' nr_inscricao, 
	0 cd_agencia, 
	'' ie_dig_agencia, 
	'0' cd_conta, 
	'' ie_dig_conta, 
	'' ds_dac_agencia, 
	'' nm_empresa, 
	'' ds_banco, 
	'' dt_arquivo, 
	e.nr_sequencia nr_seq_envio, 
	'0' ie_tipo_fornecedor, 
	'0' cd_cgc_fornecedor, 
	'0' cd_agencia_bancaria, 
	'0' nr_conta_forneced, 
	'0' ie_dig_conta_forneced, 
	'' nm_hospital, 
	'' ds_endereco, 
	'0' nr_endereco, 
	'' ds_cidade, 
	'0' cd_cep, 
	'' ds_estado, 
	0 cd_banco_fornecedor, 
	0 cd_agencia_fornecedor, 
	'' cd_agencia_conta, 
	'' nm_fornecedor, 
	0 nr_documento, 
	LOCALTIMESTAMP dt_vencimento, 
	0 vl_saldo_titulo, 
	'0' nr_inscricao_fornec, 
	(count(*) + 2) qt_registros, 
	'' ie_cod_barras, 
	sum(d.vl_titulo) vl_titulo, 
	sum(c.vl_desconto) vl_desconto, 
	sum(c.vl_acrescimo) vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	sum(c.vl_liquidacao) vl_pagto, 
	sum(c.vl_escritural - c.vl_desconto + c.vl_acrescimo) vl_total_pagto, 
	COUNT(*) qt_lotes_arquivo, 
	COUNT(*) qt_total_registros, 
	'5' ie_registro, 
	0 ie_forma_pagto, 
	10 ie_ordem 
from	banco_estabelecimento b, 
	titulo_pagar_v2 d,	 
	estabelecimento a,    
	banco_escritural e, 
	titulo_pagar_escrit c 
where	e.nr_sequencia			= c.nr_seq_escrit 
and	c.nr_titulo			= d.nr_titulo 
and	e.nr_seq_conta_banco		= b.nr_sequencia 
and	e.cd_estabelecimento  	= a.cd_estabelecimento 
and	b.ie_tipo_relacao    	in ('EP','ECC') 
and 	c.ie_tipo_pagamento		= 'BLQ' 
and	c.cd_banco 			= 001 
group by e.nr_sequencia 

union
 
/* Header do Lote Bloquetos - Outros Bancos */
 
select	distinct 4 tp_registro, 
	'0' nr_inscricao, 
	0 cd_agencia, 
	to_char(calcula_digito('Modulo11',b.cd_agencia_bancaria)) ie_dig_agencia, 
	'0' cd_conta, 
	'' ie_dig_conta, 
	'' ds_dac_agencia, 
	'' nm_empresa, 
	'' ds_banco, 
	'' dt_arquivo, 
	a.nr_sequencia nr_seq_envio, 
	'2' ie_tipo_fornecedor, 
	e.cd_cgc cd_cgc_fornecedor, 
	'0' cd_agencia_bancaria, 
 	b.cd_conta nr_conta_forneced, 
	substr(b.ie_digito_conta,1,1) ie_dig_conta_forneced, 
	upper(j.ds_razao_social) nm_hospital, 
	upper(j.ds_endereco) ds_endereco, 
	j.nr_endereco, 
	j.ds_municipio, 
	j.cd_cep, 
	j.sg_estado ds_estado, 
	c.cd_banco cd_banco_fornecedor, 
 	somente_numero(b.cd_agencia_bancaria) cd_agencia_fornecedor, 
	'' cd_agencia_conta, 
	upper(j.ds_razao_social) nm_fornecedor, 
	0 nr_documento, 
	LOCALTIMESTAMP dt_vencimento, 
	0 vl_saldo_titulo, 
	'0' nr_inscricao_fornec, 
	0 qt_registros, 
	'' ie_cod_barras, 
	0 vl_titulo, 
	0 vl_desconto, 
	0 vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	0 vl_pagto, 
	0 vl_total_pagto, 
	0 qt_lotes_arquivo, 
	0 qt_total_registros, 
	'1' ie_registro, 
	31 ie_forma_pagto, 
	11 ie_ordem 
from	pessoa_juridica j, 
	Estabelecimento e, 
	banco_estabelecimento b, 
	banco_escritural a, 
	titulo_pagar_escrit c 
where	e.cd_cgc		= j.cd_cgc 
and	a.nr_sequencia     = c.nr_seq_escrit 
and	a.nr_seq_conta_banco	= b.nr_sequencia 
and	a.cd_estabelecimento  = e.cd_estabelecimento 
and	b.ie_tipo_relacao    in ('EP','ECC') 
and 	c.ie_tipo_pagamento		= 'BLQ' 
and	c.cd_banco 			<> 001 

Union
 
/* Detalhe Bloquetos - Outros Bancos */
 
select	5 tp_registro, 
	'0' nr_inscricao, 
	0 cd_agencia, 
	'' ie_dig_agencia, 
	'0' cd_conta, 
	'' ie_dig_conta, 
	'' ds_dac_agencia, 
	'' nm_empresa, 
	'' ds_banco, 
	'' dt_arquivo, 
	a.nr_sequencia nr_seq_envio, 
	d.ie_tipo_favorecido ie_tipo_fornecedor, 
	d.cd_favorecido cd_cgc_fornecedor, 
	'0' cd_agencia_bancaria, 
	c.nr_conta nr_conta_forneced, 
	'0' ie_dig_conta_forneced, 
	'' nm_hospital, 
	'' ds_endereco, 
	'0' nr_endereco, 
	'' ds_cidade, 
	'0' cd_cep, 
	'' ds_estado, 
	c.cd_banco cd_banco_fornecedor, 
	somente_numero(c.cd_agencia_bancaria) cd_agencia_fornecedor, 
	'0' || c.cd_agencia_bancaria || '0000000' || c.nr_conta cd_agencia_conta, 
	d.nm_favorecido nm_fornecedor, 
	0 nr_documento, 
	d.dt_vencimento_atual dt_vencimento, 
	d.vl_saldo_titulo vl_saldo_titulo, 
	'0' nr_inscricao_fornec, 
	0 qt_registros, 
	d.nr_bloqueto ie_cod_barras, 
	d.vl_titulo, 
	c.vl_desconto, 
	c.vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	d.vl_saldo_titulo vl_pagto, 
	0 vl_total_pagto, 
	0 qt_lotes_arquivo, 
	0 qt_total_registros, 
	'3' ie_registro, 
	0 ie_forma_pagto, 
	12 ie_ordem 
from	Estabelecimento e, 
	banco_estabelecimento b, 
	banco_escritural a, 
	titulo_pagar_v2 d,	 
	titulo_pagar_escrit c 
where	c.nr_titulo		= d.nr_titulo 
and	a.nr_sequencia		= c.nr_seq_escrit 
and	a.nr_seq_conta_banco	= b.nr_sequencia 
and	a.cd_estabelecimento	= e.cd_estabelecimento 
and 	b.ie_tipo_relacao	in ('EP','ECC') 
and 	c.ie_tipo_pagamento	= 'BLQ' 
and	c.cd_banco 		<> 001 

Union
 
/* Trailler do Lote Bloquetos - Outros Bancos */
 
select	6 tp_registro, 
	'0' nr_inscricao, 
	0 cd_agencia, 
	'' ie_dig_agencia, 
	'0' cd_conta, 
	'' ie_dig_conta, 
	'' ds_dac_agencia, 
	'' nm_empresa, 
	'' ds_banco, 
	'' dt_arquivo, 
	e.nr_sequencia nr_seq_envio, 
	'0' ie_tipo_fornecedor, 
	'0' cd_cgc_fornecedor, 
	'0' cd_agencia_bancaria, 
	'0' nr_conta_forneced, 
	'0' ie_dig_conta_forneced, 
	'' nm_hospital, 
	'' ds_endereco, 
	'0' nr_endereco, 
	'' ds_cidade, 
	'0' cd_cep, 
	'' ds_estado, 
	0 cd_banco_fornecedor, 
	0 cd_agencia_fornecedor, 
	'' cd_agencia_conta, 
	'' nm_fornecedor, 
	0 nr_documento, 
	LOCALTIMESTAMP dt_vencimento, 
	0 vl_saldo_titulo, 
	'0' nr_inscricao_fornec, 
	(count(*) + 2) qt_registros, 
	'' ie_cod_barras, 
	sum(d.vl_titulo) vl_titulo, 
	sum(c.vl_desconto) vl_desconto, 
	sum(c.vl_acrescimo) vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	sum(c.vl_liquidacao) vl_pagto, 
	sum(c.vl_escritural - c.vl_desconto + c.vl_acrescimo) vl_total_pagto, 
	COUNT(*) qt_lotes_arquivo, 
	COUNT(*) qt_total_registros, 
	'5' ie_registro, 
	0 ie_forma_pagto, 
	13 ie_ordem 
from	banco_estabelecimento b, 
	titulo_pagar_v2 d,	 
	estabelecimento a,    
	banco_escritural e, 
	titulo_pagar_escrit c 
where	e.nr_sequencia			= c.nr_seq_escrit 
and	c.nr_titulo			= d.nr_titulo 
and	e.nr_seq_conta_banco		= b.nr_sequencia 
and	e.cd_estabelecimento  	= a.cd_estabelecimento 
and	b.ie_tipo_relacao    	in ('EP','ECC') 
and 	c.ie_tipo_pagamento		= 'BLQ' 
and	c.cd_banco 			<> 001 
group by e.nr_sequencia 

union
 
/* Trailler do Arquivo*/
 
select	7 tp_registro, 
	'0' nr_inscricao, 
	0 cd_agencia, 
	'' ie_dig_agencia, 
	'0' cd_conta, 
	'' ie_dig_conta, 
	'' ds_dac_agencia, 
	'' nm_empresa, 
	'' ds_banco, 
	'' dt_arquivo, 
	e.nr_sequencia nr_seq_envio, 
	'0' ie_tipo_fornecedor, 
	'0' cd_cgc_fornecedor, 
	'0' cd_agencia_bancaria, 
	'0' nr_conta_forneced, 
	'0' ie_dig_conta_forneced, 
	'' nm_hospital, 
	'' ds_endereco, 
	'0' nr_endereco, 
	'' ds_cidade, 
	'0' cd_cep, 
	'' ds_estado, 
	0 cd_banco_fornecedor, 
	0 cd_agencia_fornecedor, 
	'' cd_agencia_conta, 
	'' nm_fornecedor, 
	0 nr_documento, 
	LOCALTIMESTAMP dt_vencimento, 
	0 vl_saldo_titulo, 
	'0' nr_inscricao_fornec, 
	0 qt_registros, 
	'' ie_cod_barras, 
	0 vl_titulo, 
	0 vl_desconto, 
	0 vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	0 vl_pagto, 
	0 vl_total_pagto, 
	1 qt_lotes_arquivo, 
	(count(*) + 4) qt_total_registros, 
	'9' ie_registro, 
	0 ie_forma_pagto, 
	14 ie_ordem 
from	banco_estabelecimento b, 
	estabelecimento a,    
	banco_escritural e, 
	titulo_pagar_escrit c 
where	e.nr_sequencia		= c.nr_seq_escrit 
and	e.cd_banco       	= b.cd_banco 
and	e.cd_estabelecimento  	= b.cd_estabelecimento 
and	e.cd_estabelecimento  	= a.cd_estabelecimento 
and	b.ie_tipo_relacao    	in ('EP','ECC') 
group by e.nr_sequencia 
order by ie_ordem;

