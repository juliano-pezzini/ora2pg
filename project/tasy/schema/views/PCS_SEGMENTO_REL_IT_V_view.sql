-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pcs_segmento_rel_it_v (tp_registro, nr_sequencia, dt_atualizacao, nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec, nr_seq_relatorio, nr_seq_segmento, cd_estabelecimento, cd_material, ds_segmento, nr_ordem_compra, dt_emissao_oc, cd_cgc_fornec_oc, ie_aprovacao_oc, cd_pessoa_fisica_oc, qt_prevista_entrega_oc, dt_entrega_prevista_oc, cd_comprador_oc, qt_consumo_dia_ant, qt_consumo_7_dias, qt_consumo_15_dias, qt_consumo_30_dias, qt_consumo_60_dias, qt_consumo_90_dias, qt_consumo_120_dias, qt_consumo_150_dias, qt_consumo_180_dias, qt_maior_media_cons_3_meses, qt_cobertura_almox, qt_cobertura_farmacia, qt_saldo_almox, qt_saldo_farmacia, qt_saldo_farm_cc, qt_saldo_total, vl_estoque, vl_custo_medio, qt_ordem_total, qt_compra_melhor, qt_dia_compra, qt_dia_ressup_forn, qt_dia_frequencia, qt_estoque_minimo, qt_eseg, cd_empresa, ds_estabelecimento, ds_material, ds_fornecedor_oc, ds_comprador_oc, ds_empresa, cd_empr_filtro, cd_estab_filtro, cd_mat_filtro, dt_geracao, dt_inicio_falta, ds_falta_solucionada, ds_motivo_falta, ds_mat_substituto, qt_saldo_externo, ie_consistencia, ds_modalidade, vl_fatur_minimo, cd_cnpj_contratado, ds_cnpj_contratado, ds_comprador_regra, nr_solic_compra, qt_pendente_oc, ds_grupo_segmento, nr_documento, tp_documento, qt_pendente, ds_saldos, ds_grupo_material) AS select	0 tp_registro,
	'Sequencia' nr_sequencia,          
	'Data atualização' dt_atualizacao, 
	'Usuario' nm_usuario, 
	'Data' dt_atualizacao_nrec, 
	'Usuario' nm_usuario_nrec, 
	'Seq rel' nr_seq_relatorio, 
	'Seq seg' nr_seq_segmento, 
	'Cod estab' cd_estabelecimento, 
	'Material' cd_material, 
	'Segmento' ds_segmento, 
	'Ordem compra' nr_ordem_compra, 
	'Dt. emissão' dt_emissao_oc, 
	'Fornecedor' cd_cgc_fornec_oc, 
	'OC Aprovada' ie_aprovacao_oc, 
	'Pessoa fisica' cd_pessoa_fisica_oc, 
	'Qt. pedido' qt_prevista_entrega_oc, 
	'Dt. entrega' dt_entrega_prevista_oc, 
	'Comprador' cd_comprador_oc, 
	'CDA' qt_consumo_dia_ant, 
	'CD07' qt_consumo_7_dias, 
	'CD15' qt_consumo_15_dias, 
	'CD30' qt_consumo_30_dias, 
	'CD60' qt_consumo_60_dias, 
	'CD90' qt_consumo_90_dias, 
	'CD120' qt_consumo_120_dias, 
	'CD150' qt_consumo_150_dias, 
	'CD180' qt_consumo_180_dias, 
	'Maior consumo 3M' qt_maior_media_cons_3_meses, 
	'Cobertura almox.' qt_cobertura_almox, 
	'Cobertura farmácias' qt_cobertura_farmacia, 
	'Saldo almox.' qt_saldo_almox, 
	'Saldo farmácias' qt_saldo_farmacia, 
	'Saldo farm. CC' qt_saldo_farm_cc, 
	'Total unidade' qt_saldo_total, 
	'Estoque total R$' vl_estoque, 
	'Custo médio' vl_custo_medio, 
	'Ordens total' qt_ordem_total, 
	'Unidade compra' qt_compra_melhor, 
	'Politica' qt_dia_compra, 
	'Lead time' qt_dia_ressup_forn, 
	'Frequência' qt_dia_frequencia, 
	'Est. mínimo' qt_estoque_minimo, 
	'Eseg' qt_eseg, 
	'Cod Empresa' cd_empresa, 
	'Estabelecimento' ds_estabelecimento, 
	'Descrição' ds_material, 
	'Fornecedor OC'ds_fornecedor_oc, 
	'Comprador OC'	ds_comprador_oc, 
	'Empresa' ds_empresa, 
	0 cd_empr_filtro, 
	0 cd_estab_filtro, 
	0 cd_mat_filtro, 
	trunc(LOCALTIMESTAMP,'dd') dt_geracao, 
	'Dt. início falta' dt_inicio_falta, 
	'Falta solucionada' ds_falta_solucionada, 
	'Motivo falta' ds_motivo_falta, 
	'Materiais substitutos' ds_mat_substituto, 
	'Saldo local externo' qt_saldo_externo, 
	'X' ie_consistencia, 
	'Modalidade' ds_modalidade, 
	'Valor faturamento mínimo' vl_fatur_minimo, 
	'CNPJ' cd_cnpj_contratado, 
	'Razão social' ds_cnpj_contratado, 
	'Comprador regra' ds_comprador_regra, 
	'Solic. Compra' nr_solic_compra, 
	'Qt. Pendente OC' qt_pendente_oc, 
	'Grupamento' ds_grupo_segmento, 
	'Nr. documento' nr_documento, 
	'Tipo documento' tp_documento, 
	'Qt. pendente' qt_pendente, 
	'Saldos' ds_saldos, 
	'Grupo material' ds_grupo_material 
FROM 	pcs_seg_compras_rel_item a, 
	pcs_segmento_compras_rel b 
where	a.nr_seq_relatorio = b.nr_Sequencia  

union
 
select 1 tp_registro, 
	to_char(a.nr_sequencia) nr_sequencia,          
	to_char(a.dt_atualizacao,'dd/mm/yyyy') dt_atualizacao, 
	to_char(a.nm_usuario) nm_usuario, 
	to_char(a.dt_atualizacao_nrec,'dd/mm/yyyy') dt_atualizacao_nrec, 
	to_char(a.nm_usuario_nrec) nm_usuario_nrec, 
	to_char(a.nr_seq_relatorio) nr_seq_relatorio, 
	to_char(a.nr_seq_segmento) nr_seq_segmento, 
	to_char(a.cd_estabelecimento) cd_estabelecimento, 
	to_char(a.cd_material) cd_material, 
	to_char(a.ds_segmento) ds_segmento, 
	to_char(a.nr_ordem_compra) nr_ordem_compra, 
	to_char(a.dt_emissao_oc,'dd/mm/yyyy') dt_emissao_oc, 
	to_char(a.cd_cgc_fornec_oc) cd_cgc_fornec_oc, 
	to_char(a.ie_aprovacao_oc) ie_aprovacao_oc, 
	to_char(a.cd_pessoa_fisica_oc) cd_pessoa_fisica_oc, 
	to_char(a.qt_prevista_entrega_oc) qt_prevista_entrega_oc, 
	to_char(a.dt_entrega_prevista_oc) dt_entrega_prevista_oc, 
	to_char(a.cd_comprador_oc) cd_comprador_oc, 
	to_char(a.qt_consumo_dia_ant) qt_consumo_dia_ant, 
	to_char(a.qt_consumo_7_dias) qt_consumo_7_dias, 
	to_char(a.qt_consumo_15_dias) qt_consumo_15_dias, 
	to_char(a.qt_consumo_30_dias) qt_consumo_30_dias, 
	to_char(a.qt_consumo_60_dias) qt_consumo_60_dias, 
	to_char(a.qt_consumo_90_dias) qt_consumo_90_dias, 
	to_char(a.qt_consumo_120_dias) qt_consumo_120_dias, 
	to_char(a.qt_consumo_150_dias) qt_consumo_150_dias, 
	to_char(a.qt_consumo_180_dias) qt_consumo_180_dias, 
	to_char(a.qt_maior_media_cons_3_meses) qt_maior_media_cons_3_meses, 
	to_char(a.qt_cobertura_almox) qt_cobertura_almox, 
	to_char(a.qt_cobertura_farmacia) qt_cobertura_farmacia, 
	to_char(a.qt_saldo_almox) qt_saldo_almox, 
	to_char(a.qt_saldo_farmacia) qt_saldo_farmacia, 
	to_char(a.qt_saldo_farm_cc) qt_saldo_farm_cc, 
	to_char(a.qt_saldo_total) qt_saldo_total, 
	to_char(a.vl_estoque) vl_estoque, 
	to_char(a.vl_custo_medio) vl_custo_medio, 
	to_char(a.qt_ordem_total) qt_ordem_total, 
	to_char(a.qt_compra_melhor) qt_compra_melhor, 
	to_char(a.qt_dia_compra) qt_dia_compra, 
	to_char(a.qt_dia_ressup_forn) qt_dia_ressup_forn, 
	to_char(a.qt_dia_frequencia) qt_dia_frequencia, 
	to_char(a.qt_estoque_minimo) qt_estoque_minimo, 
	to_char(a.qt_eseg) qt_eseg, 
	to_char(a.cd_empresa) cd_empresa, 
	substr(obter_nome_estabelecimento(a.cd_estabelecimento) || ' - ' || a.cd_estabelecimento,1,255) ds_estabelecimento, 
	substr(obter_desc_material(a.cd_material),1,255) ds_material, 
	substr(obter_nome_pf_pj(a.cd_pessoa_fisica_oc,a.cd_cgc_fornec_oc),1,255) ds_fornecedor_oc, 
	substr(obter_nome_pf(a.cd_comprador_oc),1,255) ds_comprador_oc, 
	substr(obter_nome_empresa(a.cd_empresa),1,255) ds_empresa, 
	a.cd_empresa cd_empr_filtro, 
	a.cd_estabelecimento cd_estab_filtro, 
	a.cd_material cd_mat_filtro, 
	trunc(b.dt_geracao,'dd') dt_geracao, 
	to_char(a.dt_inicio_falta,'dd/mm/yyyy hh24:mi:ss') dt_inicio_falta, 
	CASE WHEN ie_falta_solucionada='N' THEN 'Não'  ELSE '' END  ds_falta_solucionada,	 
	ds_motivo_falta, 
	substr(ds_mat_substituto,1,4000) ds_mat_substituto, 
	to_char(qt_saldo_externo) qt_saldo_externo, 
	a.ie_consistencia, 
	ds_modalidade, 
	to_char(vl_fatur_minimo) vl_fatur_minimo, 
	to_char(cd_cnpj_contratado) cd_cnpj_contratado, 
	substr(obter_nome_pf_pj(null,cd_cnpj_contratado),1,255) ds_cnpj_contratado, 
	substr(obter_nome_pf(cd_comprador_regra),1,255) ds_comprador_regra, 
	to_char(a.nr_solic_compra) nr_solic_compra, 
	to_char(a.qt_pendente_oc) qt_pendente_oc, 
	a.ds_grupamento ds_grupo_segmento, 
	to_char(nr_documento) nr_documento, 
	to_char(tp_documento) tp_documento, 
	to_char(a.qt_pendente) qt_pendente,	 
	pcs_obter_saldo_locais(a.nr_seq_relatorio,a.nr_sequencia,'S') ds_saldos, 
	substr(obter_desc_grupo_mat(a.cd_grupo_material),1,255) ds_grupo_material 
from 	pcs_seg_compras_rel_item a, 
	pcs_segmento_compras_rel b 
where	a.nr_seq_relatorio = b.nr_Sequencia LIMIT 1;

