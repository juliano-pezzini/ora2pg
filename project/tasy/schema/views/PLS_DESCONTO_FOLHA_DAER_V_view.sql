-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_desconto_folha_daer_v (lfp01tip, lfp02csg, lfp03ano, lfp04mes, lfp05vrb, lfp06mtr, lfp07val, lfp08ref, lfp09par, nr_seq_cobranca) AS select	1				LFP01TIP,
	520				LFP02CSG,
	to_char(d.dt_remessa_retorno,'yyyy')	LFP03ANO,
	to_char(d.dt_remessa_retorno,'mm')	LFP04MES,
	0				LFP05VRB,
	(	select	count(*)
		FROM	titulo_receber_cobr		t,
			pls_mensalidade			u,
			pls_contrato_pagador_fin	v,
			cobranca_escritural		x,
			titulo_receber			z
		where	z.nr_seq_mensalidade = u.nr_sequencia
		and	t.nr_titulo	= z.nr_titulo
		and	u.nr_seq_pagador = v.nr_seq_pagador
		and	LOCALTIMESTAMP	between coalesce(v.dt_inicio_vigencia,LOCALTIMESTAMP) and coalesce(v.dt_fim_vigencia,LOCALTIMESTAMP)
		and	t.nr_seq_cobranca = x.nr_sequencia
		and	x.nr_sequencia	= a.nr_seq_cobranca) LFP06MTR,
	replace(to_char(sum(a.vl_cobranca),'99999999999.99'),' ','') LFP07VAL, /* 999,999,999,990.99 */
	'0.00'				LFP08REF,
	0				LFP09PAR,
	a.nr_seq_cobranca		NR_SEQ_COBRANCA
from	titulo_receber_cobr		a,
	cobranca_escritural		d,
	titulo_receber			e,
	pls_mensalidade			b,
	pls_contrato_pagador_fin	c
where	a.nr_seq_cobranca	= d.nr_sequencia
and	a.nr_titulo		= e.nr_titulo
and	e.nr_seq_mensalidade	= b.nr_sequencia
and	b.nr_seq_pagador	= c.nr_seq_pagador
and	LOCALTIMESTAMP	between coalesce(c.dt_inicio_vigencia,LOCALTIMESTAMP) and coalesce(c.dt_fim_vigencia,LOCALTIMESTAMP)
group by	d.dt_remessa_retorno,
		a.nr_seq_cobranca

union

select	2				LFP01TIP,
	520				LFP02CSG,
	to_char(d.dt_remessa_retorno,'yyyy')	LFP03ANO,
	to_char(d.dt_remessa_retorno,'mm')	LFP04MES,
	520				LFP05VRB,
	(c.cd_matricula)::numeric 	LFP06MTR,
	replace(to_char(a.vl_cobranca,'99999999999.99'),' ','')	LFP07VAL,
	'0.00'				LFP08REF,
	1				LFP09PAR,
	a.nr_seq_cobranca		NR_SEQ_COBRANCA
from	titulo_receber_cobr		a,
	cobranca_escritural		d,
	titulo_receber			e,
	pls_mensalidade			b,
	pls_contrato_pagador_fin	c
where	a.nr_seq_cobranca	= d.nr_sequencia
and	a.nr_titulo		= e.nr_titulo
and	e.nr_seq_mensalidade	= b.nr_sequencia
and	b.nr_seq_pagador	= c.nr_seq_pagador
and	LOCALTIMESTAMP	between coalesce(c.dt_inicio_vigencia,LOCALTIMESTAMP) and coalesce(c.dt_fim_vigencia,LOCALTIMESTAMP);

