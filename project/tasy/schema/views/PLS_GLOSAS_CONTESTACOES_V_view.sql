-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_glosas_contestacoes_v (nr_seq_conta, dt_emissao, cd_usuario_plano, nr_prestador_solic, nr_prestador_exec, cd_procedimento, dt_procedimento, qt_procedimento_imp, vl_procedimento, ds_inconsis, ds_observacao, ie_via_acesso, nr_seq_questionamento, cd_grau_partic, ie_tipo_acordo, dt_envio_arquivo, nr_seq_protocolo) AS select	b.nr_sequencia nr_seq_conta,
	b.dt_emissao, 
	' '||pls_obter_dados_segurado(b.nr_seq_segurado, 'C') cd_usuario_plano,		 
	coalesce(to_char(b.nr_seq_prestador), nr_seq_prestador_imp) nr_prestador_solic, 
	b.nr_seq_prestador_exec_imp_ref	nr_prestador_exec, 
	d.cd_procedimento, 
	d.dt_procedimento, 
	d.qt_procedimento_imp, 
	d.vl_liberado vl_procedimento, 
	'  '||pls_obter_dados_insconsitencia(c.nr_seq_inconsistencia, 'C')||' - '||pls_obter_dados_insconsitencia(c.nr_seq_inconsistencia, 'D') ds_inconsis, 
	c.ds_observacao, 
	d.ie_via_acesso, 
	null nr_seq_questionamento, 
	pls_obter_cd_tiss_participacao(b.nr_seq_grau_partic) cd_grau_partic, 
	'' ie_tipo_acordo, 
	e.dt_envio_arquivo dt_envio_arquivo, 
	b.nr_seq_protocolo 
FROM	ptu_fatura a, 
	pls_conta b, 
	ptu_intercambio_consist	c, 
	pls_conta_proc	d, 
	ptu_camara_contestacao e 
where	a.nr_seq_protocolo = b.nr_seq_protocolo 
and	c.nr_seq_conta = b.nr_sequencia 
and	d.nr_seq_conta = b.nr_sequencia 
and	e.nr_fatura = a.nr_fatura 

union
 
select	b.nr_sequencia nr_seq_conta, 
	b.dt_emissao, 
	' '||pls_obter_dados_segurado(b.nr_seq_segurado, 'C') cd_usuario_plano, 
	coalesce(to_char(b.nr_seq_prestador), nr_seq_prestador_imp) nr_prestador_solic, 
	b.nr_seq_prestador_exec_imp_ref	nr_prestador_exec, 
	d.cd_procedimento, 
	d.dt_procedimento, 
	d.qt_procedimento_imp, 
	d.vl_liberado vl_procedimento, 
	' ' ds_inconsis, 
	' ' ds_observacao, 
	d.ie_via_acesso, 
	pls_obter_cd_questionamento(c.nr_seq_mot_questionamento) nr_seq_questionamento, 
	pls_obter_cd_tiss_participacao(b.nr_seq_grau_partic) cd_grau_partic, 
	c.ie_tipo_acordo ||' - '||obter_valor_dominio(3677, c.ie_tipo_acordo) ie_tipo_acordo, 
	e.dt_envio_arquivo dt_envio_arquivo, 
	b.nr_seq_protocolo 
from	ptu_fatura a, 
	pls_conta b, 
	ptu_questionamento	c, 
	pls_conta_proc	d, 
	ptu_camara_contestacao e 
where	a.nr_seq_protocolo = b.nr_seq_protocolo 
and	c.nr_seq_conta = b.nr_sequencia 
and	d.nr_seq_conta = b.nr_sequencia 
and	c.nr_seq_contestacao = e.nr_sequencia 
and	pls_obter_cd_questionamento(c.nr_seq_mot_questionamento) <> 99 

union
 
select	b.nr_sequencia nr_seq_conta, 
	b.dt_emissao, 
	' '||pls_obter_dados_segurado(b.nr_seq_segurado, 'C') cd_usuario_plano, 
	coalesce(to_char(b.nr_seq_prestador), nr_seq_prestador_imp) nr_prestador_solic, 
	coalesce(b.nr_seq_prestador_exec, b.nr_seq_prestador_exec_imp_ref)	nr_prestador_exec, 
	d.cd_procedimento, 
	d.dt_procedimento, 
	d.qt_procedimento, 
	d.vl_liberado vl_procedimento, 
	substr(tiss_obter_motivo_glosa(c.nr_seq_motivo_glosa,'C')||' - '||tiss_obter_motivo_glosa(c.nr_seq_motivo_glosa,'D'),1,255) ds_inconsis, 
	substr(c.ds_observacao,1,255) ds_observacao, 
	d.ie_via_acesso, 
	null nr_seq_questionamento, 
	pls_obter_cd_tiss_participacao(b.nr_seq_grau_partic) cd_grau_partic, 
	'' ie_tipo_acordo, 
	null dt_envio_arquivo, 
	b.nr_seq_protocolo 
from	pls_conta b, 
	pls_conta_proc	d, 
	pls_conta_glosa c 
where	d.nr_seq_conta 	  = b.nr_sequencia 
and	c.nr_seq_conta_proc  = d.nr_sequencia 

union
 
select	b.nr_sequencia nr_seq_conta, 
	b.dt_emissao, 
	' '||pls_obter_dados_segurado(b.nr_seq_segurado, 'C') cd_usuario_plano, 
	coalesce(to_char(b.nr_seq_prestador), nr_seq_prestador_imp) nr_prestador_solic, 
	coalesce(b.nr_seq_prestador_exec, b.nr_seq_prestador_exec_imp_ref)	nr_prestador_exec, 
	d.cd_procedimento, 
	d.dt_procedimento, 
	d.qt_procedimento, 
	d.vl_liberado vl_procedimento, 
	substr(tiss_obter_motivo_glosa(c.nr_seq_motivo_glosa,'C')||' - '||tiss_obter_motivo_glosa(c.nr_seq_motivo_glosa,'D'),1,255) ds_inconsis, 
	substr(c.ds_observacao,1,255) ds_observacao, 
	d.ie_via_acesso, 
	null nr_seq_questionamento, 
	pls_obter_cd_tiss_participacao(b.nr_seq_grau_partic) cd_grau_partic, 
	'' ie_tipo_acordo, 
	null dt_envio_arquivo, 
	b.nr_seq_protocolo 
from	pls_conta b, 
	pls_conta_proc	d, 
	pls_conta_glosa c 
where	d.nr_seq_conta 	  = b.nr_sequencia 
and	c.nr_seq_conta  = b.nr_sequencia;

