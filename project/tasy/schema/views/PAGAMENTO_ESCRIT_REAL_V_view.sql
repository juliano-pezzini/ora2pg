-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pagamento_escrit_real_v (tp_registro, cd_agencia_bancaria, cd_conta, nm_conveniado, dt_remessa, dt_movimentacao, nr_seq_envio, cd_empresa, cd_ag_convenio_pgto, cd_conta_conv_pgto, ie_tipo_documento, nr_titulo_cliente, dt_pagamento, vl_pagamento, ie_tipo_fornec, cd_fornecedor, cd_banco_fornecedor, cd_agencia_fornecedor, cd_conta_fornec, nm_fornecedor, nm_logradouro_fornec, nm_bairro_fornec, cd_cep_fornec, nm_cidade_fornec, nm_estado_fornec, nr_documento, nr_titulo, cd_ag_convenio_bloq, cd_conta_conv_bloq, ie_cod_barras, nr_documento_bloq, vl_escritural) AS select 	0 TP_REGISTRO,
	b.CD_AGENCIA_BANCARIA, 
	b.CD_CONTA, 
	p.DS_RAZAO_SOCIAL NM_CONVENIADO, 
	e.DT_REMESSA_RETORNO DT_REMESSA, 
	e.DT_REMESSA_RETORNO DT_MOVIMENTACAO, 
	e.NR_SEQUENCIA NR_SEQ_ENVIO, 
	a.CD_EMPRESA, 
	'' CD_AG_CONVENIO_PGTO, 
	'' CD_CONTA_CONV_PGTO, 
	'DUP' IE_TIPO_DOCUMENTO, 
	0 NR_TITULO_CLIENTE, 
	LOCALTIMESTAMP DT_PAGAMENTO, 
	0 VL_PAGAMENTO, 
	'' IE_TIPO_FORNEC, 
	'' CD_FORNECEDOR, 
	'' CD_BANCO_FORNECEDOR, 
	'' CD_AGENCIA_FORNECEDOR, 
	'' CD_CONTA_FORNEC, 
	'' NM_FORNECEDOR, 
	'' NM_LOGRADOURO_FORNEC, 
	'' NM_BAIRRO_FORNEC, 
	'' CD_CEP_FORNEC, 
	'' NM_CIDADE_FORNEC, 
	'' NM_ESTADO_FORNEC, 
	0 NR_DOCUMENTO, 
	0 NR_TITULO, 
	'' CD_AG_CONVENIO_BLOQ, 
	'' CD_CONTA_CONV_BLOQ, 
	'' IE_COD_BARRAS, 
	0 NR_DOCUMENTO_BLOQ, 
	0 VL_ESCRITURAL 
FROM banco_estabelecimento b, 
   estabelecimento a, 
   pessoa_juridica p, 
   banco_escritural e 
where e.cd_estabelecimento 	= a.cd_estabelecimento 
 and e.cd_estabelecimento 	= b.cd_estabelecimento 
 and a.cd_cgc 			= p.cd_cgc 
 and e.cd_banco		= b.cd_banco 
 and b.ie_tipo_relacao		= 'EP' 

union
 
/* Somente para BLOQuetos */
 
select 	1 TP_REGISTRO, 
	'' CD_AGENCIA_BANCARIA, 
	'' CD_CONTA, 
	'' NM_CONVENIADO, 
	LOCALTIMESTAMP DT_REMESSA, 
	LOCALTIMESTAMP DT_MOVIMENTACAO, 
	0 NR_SEQ_ENVIO, 
	0 CD_EMPRESA,					 
	b.CD_AGENCIA_BANCARIA CD_AG_CONVENIO_PGTO, 
	b.CD_CONTA CD_CONTA_CONV_PGTO, 
	'DUP' IE_TIPO_DOCUMENTO, 
	c.NR_TITULO NR_TITULO_CLIENTE, 
	d.DT_VENCIMENTO_ATUAL DT_PAGAMENTO, 
	d.VL_SALDO_TITULO VL_PAGAMENTO, 
	d.IE_FAVORECIDO IE_TIPO_FORNEC, 
	d.CD_FAVORECIDO CD_FORNECEDOR, 
	d.CD_BANCO_FAVORECIDO CD_BANCO_FORNECEDOR, 
	d.CD_AGENCIA_FAVORECIDO CD_AGENCIA_FORNECEDOR, 
	d.NR_CONTA_FAVORECIDO CD_CONTA_FORNEC, 
	d.NM_FAVORECIDO NM_FORNECEDOR, 
	d.DS_ENDERECO NM_LOGRADOURO_FORNEC, 
	d.DS_BAIRRO NM_BAIRRO_FORNEC, 
	d.CD_CEP CD_CEP_FORNEC, 
	d.DS_CIDADE NM_CIDADE_FORNEC, 
	d.DS_ESTADO NM_ESTADO_FORNEC, 
	d.NR_DOCUMENTO, 
	d.NR_TITULO, 
	'' CD_AG_CONVENIO_BLOQ, 
	'' CD_CONTA_CONV_BLOQ, 
	'' IE_COD_BARRAS, 
	0 NR_DOCUMENTO_BLOQ, 
	0 VL_ESCRITURAL 
from	Estabelecimento e, 
   	banco_estabelecimento b, 
   	banco_escritural a, 
	titulo_pagar_v2 d, 
   	titulo_pagar_escrit c 
where c.nr_titulo     	= d.nr_titulo 
 and a.nr_sequencia    	= c.nr_seq_escrit 
 and a.cd_banco     	= b.cd_banco 
 and a.cd_estabelecimento 	= b.cd_estabelecimento 
 and a.cd_estabelecimento 	= e.cd_estabelecimento 
 and b.ie_tipo_relacao		= 'EP' 
 and c.ie_tipo_pagamento	= 'BLQ' 

union
 
/* Pagamento de bloqueto de cobran√ßa */
 
select 	1 TP_REGISTRO, 
	'' CD_AGENCIA_BANCARIA, 
	'' CD_CONTA, 
	'' NM_CONVENIADO, 
	LOCALTIMESTAMP DT_REMESSA, 
	LOCALTIMESTAMP DT_MOVIMENTACAO, 
	0 NR_SEQ_ENVIO, 
	0 CD_EMPRESA, 
	'' CD_AG_CONVENIO_PGTO, 
	'' CD_CONTA_CONV_PGTO, 
	'DUP' IE_TIPO_DOCUMENTO, 
	0 NR_TITULO_CLIENTE, 
	LOCALTIMESTAMP DT_PAGAMENTO, 
	0 VL_PAGAMENTO, 
	'' IE_TIPO_FORNEC, 
	'' CD_FORNECEDOR, 
	'' CD_BANCO_FORNECEDOR, 
	'' CD_AGENCIA_FORNECEDOR, 
	'' CD_CONTA_FORNEC, 
	'' NM_FORNECEDOR, 
	'' NM_LOGRADOURO_FORNEC, 
	'' NM_BAIRRO_FORNEC, 
	'' CD_CEP_FORNEC, 
	'' NM_CIDADE_FORNEC, 
	'' NM_ESTADO_FORNEC, 
	0 NR_DOCUMENTO, 
	0 NR_TITULO, 
	b.CD_AGENCIA_BANCARIA CD_AG_CONVENIO_BLOQ, 
	b.CD_CONTA CD_CONTA_CONV_BLOQ, 
	d.NR_BLOQUETO IE_COD_BARRAS, 
	d.NR_DOCUMENTO NR_DOCUMENTO_BLOQ, 
	0 VL_ESCRITURAL 
from	Estabelecimento e, 
   	banco_estabelecimento b, 
   	banco_escritural a, 
	titulo_pagar_v2 d, 
   	titulo_pagar_escrit c 
where c.nr_titulo     	= d.nr_titulo 
 and a.nr_sequencia    	= c.nr_seq_escrit 
 and a.cd_banco     	= b.cd_banco 
 and a.cd_estabelecimento 	= b.cd_estabelecimento 
 and a.cd_estabelecimento 	= e.cd_estabelecimento 
 and b.ie_tipo_relacao		= 'EP' 
 and c.ie_tipo_pagamento	= 'CC' 

union
 
/* Trailler */
 
 select 9 TP_REGISTRO, 
	'' CD_AGENCIA_BANCARIA, 
	'' CD_CONTA, 
	'' NM_CONVENIADO, 
	LOCALTIMESTAMP DT_REMESSA, 
	LOCALTIMESTAMP DT_MOVIMENTACAO, 
	0 NR_SEQ_ENVIO, 
	0 CD_EMPRESA, 
	'' CD_AG_CONVENIO_PGTO, 
	'' CD_CONTA_CONV_PGTO, 
	'DUP' IE_TIPO_DOCUMENTO, 
	0 NR_TITULO_CLIENTE, 
	LOCALTIMESTAMP DT_PAGAMENTO, 
	0 VL_PAGAMENTO, 
	'' IE_TIPO_FORNEC, 
	'' CD_FORNECEDOR, 
	'' CD_BANCO_FORNECEDOR, 
	'' CD_AGENCIA_FORNECEDOR, 
	'' CD_CONTA_FORNEC, 
	'' NM_FORNECEDOR, 
	'' NM_LOGRADOURO_FORNEC, 
	'' NM_BAIRRO_FORNEC, 
	'' CD_CEP_FORNEC, 
	'' NM_CIDADE_FORNEC, 
	'' NM_ESTADO_FORNEC, 
	0 NR_DOCUMENTO, 
	0 NR_TITULO, 
	'' CD_AG_CONVENIO_BLOQ, 
	'' CD_CONTA_CONV_BLOQ, 
	'' IE_COD_BARRAS, 
	0 NR_DOCUMENTO_BLOQ, 
	SUM(VL_ESCRITURAL) 
 from	banco_estabelecimento b, 
	estabelecimento a,	 
	banco_escritural e, 
	titulo_pagar_escrit c 
 where e.nr_sequencia			= c.nr_seq_escrit 
  and e.cd_banco 			= b.cd_banco 
  and e.cd_estabelecimento 		= b.cd_estabelecimento 
  and e.cd_estabelecimento 		= a.cd_estabelecimento 
  and b.ie_tipo_relacao		= 'EP' 
group by e.nr_sequencia;

