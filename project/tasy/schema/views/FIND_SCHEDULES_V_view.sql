-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW find_schedules_v (nr_sequencia_ai, nr_sequencia, cd_agenda, dt_agenda, cd_estabelecimento, cd_pessoa_fisica, ds_type) AS select	a.nr_sequencia nr_sequencia_ai,
	c.nr_sequencia nr_sequencia,
	c.cd_agenda,
	c.hr_inicio dt_agenda,
	a.cd_estabelecimento,
	a.cd_pessoa_fisica,
	'IP' ds_type
FROM	agenda_integrada a,
	agenda_integrada_item b,
	agenda_paciente c
where	a.cd_pessoa_fisica	is not null
and	c.nr_sequencia		= b.nr_seq_agenda_exame
and	a.nr_sequencia		= b.nr_seq_agenda_int
and	c.ie_status_agenda	= 'N'
and	coalesce(a.cd_estabelecimento, coalesce(obter_estabelecimento_ativo,1))	= coalesce(obter_estabelecimento_ativo,1)
and	c.hr_inicio		>= trunc(LOCALTIMESTAMP)
and	c.dt_confirmacao	is null

union

select	a.nr_sequencia nr_sequencia_ai,
	c.nr_sequencia nr_sequencia,
	c.cd_agenda,
	c.dt_agenda,
	a.cd_estabelecimento,
	a.cd_pessoa_fisica,
	'IC' ds_type
from	agenda_integrada a,
	agenda_integrada_item b,
	agenda_consulta c
where	a.cd_pessoa_fisica	is not null
and	c.nr_sequencia		= b.nr_seq_agenda_cons
and	a.nr_sequencia		= b.nr_seq_agenda_int
and	c.ie_status_agenda	= 'N'
and	coalesce(a.cd_estabelecimento, coalesce(obter_estabelecimento_ativo,1))	= coalesce(obter_estabelecimento_ativo,1)
and	c.dt_agenda		>= trunc(LOCALTIMESTAMP)
and	c.dt_confirmacao	is null

union

select	0 nr_sequencia_ai,
	a.nr_sequencia nr_sequencia,
	a.cd_agenda,
	a.dt_agenda,
	b.cd_estabelecimento,
	a.cd_pessoa_fisica,
	'C' ds_type
from	agenda_consulta a,
	agenda b
where	a.cd_pessoa_fisica	is not null
and	a.cd_agenda        	= b.cd_agenda
and	a.ie_status_agenda 	= 'N'
and	coalesce(b.cd_estabelecimento, coalesce(obter_estabelecimento_ativo,1))       = coalesce(obter_estabelecimento_ativo,1)
and	a.dt_agenda       	>= trunc(LOCALTIMESTAMP)
and	a.dt_confirmacao 	is null;

