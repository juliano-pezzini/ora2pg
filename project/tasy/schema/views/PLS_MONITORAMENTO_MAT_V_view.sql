-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_monitoramento_mat_v (cd_grupo_proc, cd_material, cd_tabela_ref, qt_pago, vl_pago, qt_apresentado, vl_apresentado, vl_pago_fornecedor, nr_seq_guia_monitor, ie_tipo_despesa, nr_seq_pacote, cd_cgc_fornecedor, nr_seq_monitor_tiss_mat, vl_coparticipacao, cd_unidade_medida) AS select 	a.cd_grupo_proc,
	null cd_material,
	max(a.cd_tabela_ref) cd_tabela_ref,
	sum(a.qt_liberado) qt_pago,
	sum(a.vl_liberado) vl_pago,
	sum(qt_material) qt_apresentado,
	sum(vl_material) vl_apresentado,
	sum(vl_pago_fornecedor) vl_pago_fornecedor,
	a.nr_seq_guia_monitor,
	null ie_tipo_despesa,
	nr_seq_pacote,
	null cd_cgc_fornecedor,
	-1 nr_seq_monitor_tiss_mat,
	sum(a.vl_coparticipacao) vl_coparticipacao,
        null cd_unidade_medida
FROM pls_monitor_tiss_mat a
where a.cd_grupo_proc is not null
group by a.cd_grupo_proc,
	null, 
	a.nr_seq_guia_monitor, 
	nr_seq_pacote, 
	null,
        null

union

select 	null cd_grupo_proc,
	a.cd_material,
	a.cd_tabela_ref,
	sum(a.qt_liberado) qt_pago,
	sum(a.vl_liberado) vl_pago,
	sum(a.qt_material) qt_apresentado,
	sum(a.vl_material) vl_apresentado,
	sum(a.vl_pago_fornecedor),
	a.nr_seq_guia_monitor,
	null ie_tipo_despesa,
	nr_seq_pacote,
	cd_cgc_fornecedor,
	-2 nr_seq_monitor_tiss_mat,
	sum(a.vl_coparticipacao) vl_coparticipacao,
        cd_unidade_medida 
from 	pls_monitor_tiss_mat a
where 	a.cd_grupo_proc is null
group by a.cd_material,
	a.cd_tabela_ref,
	a.nr_seq_guia_monitor,
	nr_seq_pacote,
	cd_cgc_fornecedor,
        cd_unidade_medida;

