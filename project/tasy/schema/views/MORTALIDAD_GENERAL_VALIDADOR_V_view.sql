-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW mortalidad_general_validador_v (dt_liberacao, nr_atendimento, cd_pessoa_fisica, cedocapt, deffolio, deffolioco, defnombre, defapepater, defapemater, defcurp, defsexo, defnacion, leng_indig, defpesokg, defpesom, deftalla_mt, deftalla_cm, deffech_nac, idade_anos, idade_meses, idade_dias, deffol_cn, defedo_civ, defdom_hab, defcol_hab, defent_hab, defdel_hab, defloc_hab, defescolar, defocupaci, deftrabaja, defderecho, defafil_dh, defderecho2, defsitio, defunimed, defclues, defdom_def, defcol_def, defent_def, defdel_def, defloc_def, defjur_def, deffech_def, defhora, defatencio, defnecrops, descausa1, cvetpo_c1, tiempo_c1, causa1, descausa2, cvetpo_c2, tiempo_c2, causa2, descausa3, cvetpo_c3, tiempo_c3, causa3, descausa4, cvetpo_c4, tiempo_c4, causa4, descausa5, cvetpo_c5, tiempo_c5, causa5, descausa6, cvetpo_c6, tiempo_c6, causa6, defcausabas, defdurante, deftpo_emb, defcom_emb, defpresunt, defdesempe, deflug_ocu, defvio_fam, defactamp, defdesc_les, defdom_acc, defcol_acc, defent_acc, defdel_acc, defloc_acc, defnombinfor, defpatinfor, defmatinfor, defparentinfor, defcertifi, defcedcertifi, defnombcertif, defpatcerti, defmatcerti, deftel_cert, defdomcertifi, deffirmocert, deffech_cer, defoficial, deflibronum, defnactarc, defent_reg, defdel_reg, defloc_reg, deffech_reg, defusu_cre, deffec_cre, defnivcapt_cre, definstcapt_cre, defedocapt_cre, defjurcapt_cre, defmpocapt_cre, defcluescapt_cre, defusu_mod, deffec_mod, defnivcapt, definstcapt, defedocapt, defjurcapt, defmpocapt, defcluescapt, deftipform, defverepi, defvermat, defextemporaneo, defrectifica, defmodificabe, defmodificabf, defprimera_am, nm_usuario, cd_pessoa_juridica, cd_medico, cd_convenio, cd_pessoa_fisica_ref) AS SELECT	b.dt_liberacao, a.nr_atendimento,
	a.cd_pessoa_fisica,
	LPAD(coalesce(obter_dados_cat_clues(m.cd_internacional,'CD_ESTADO'),'99'),2,'0') CEDOCAPT,
	TO_CHAR(b.dt_obito,'YY')||LPAD(b.nr_declaracao,7,'0') DEFFOLIO,
	LPAD(b.nr_declaracao,9,'0') DEFFOLIOCO,
	RPAD(coalesce(z.ds_given_name,'SE IGNORA'),40) DEFNOMBRE,
	RPAD(coalesce(z.ds_family_name,'SE IGNORA'),20) DEFAPEPATER,
	RPAD(coalesce(z.ds_component_name_1,'SE IGNORA'),20) DEFAPEMATER,
	RPAD(coalesce(pf.cd_curp,'NO ESPECIFICADO'),18) DEFCURP,
	CASE WHEN coalesce(pf.ie_sexo,'9')='M' THEN '1' WHEN coalesce(pf.ie_sexo,'9')='F' THEN '2' END  DEFSEXO,
	coalesce((SELECT CASE WHEN x.ie_brasileiro='S' THEN '1'  ELSE '2' END  FROM nacionalidade x WHERE x.cd_nacionalidade = pf.cd_nacionalidade),'0') DEFNACION,
	CASE WHEN pf.nr_seq_lingua_indigena IS NULL THEN '2'  ELSE '1' END  LENG_INDIG,
	obter_sinal_vital(a.nr_atendimento, 'PESO') DEFPESOKG,
	obter_sinal_vital(a.nr_atendimento, 'PESO') DEFPESOM,
	obter_sinal_vital(a.nr_atendimento, 'ALTURA') DEFTALLA_MT,
	obter_sinal_vital(a.nr_atendimento, 'ALTURA') DEFTALLA_CM,
	coalesce(TO_CHAR(pf.dt_nascimento,'dd/mm/yyyy'),'99/99/9999') DEFFECH_NAC,
	SUBSTR(obter_idade_pf(a.cd_pessoa_fisica,b.dt_obito,'A'),1,3) IDADE_ANOS,
	SUBSTR(obter_idade_pf(a.cd_pessoa_fisica,b.dt_obito,'M'),1,3) IDADE_MESES,
	SUBSTR(obter_idade_pf(a.cd_pessoa_fisica,b.dt_obito,'DIA'),1,3) IDADE_DIAS,
	SUBSTR(coalesce(coalesce(pf.nr_cert_nasc,(SELECT MAX(y.nr_dnv) FROM atendimento_paciente x, nascimento y WHERE x.nr_atendimento = y.nr_atendimento AND x.cd_pessoa_fisica = a.cd_pessoa_fisica)),'888888888'),1,9) DEFFOL_CN,
	CASE WHEN coalesce(pf.ie_estado_civil,'9')='1' THEN '1' WHEN coalesce(pf.ie_estado_civil,'9')='2' THEN '5' WHEN coalesce(pf.ie_estado_civil,'9')='3' THEN '3' WHEN coalesce(pf.ie_estado_civil,'9')='4' THEN '6' WHEN coalesce(pf.ie_estado_civil,'9')='5' THEN '2' WHEN coalesce(pf.ie_estado_civil,'9')='6' THEN '6' WHEN coalesce(pf.ie_estado_civil,'9')='7' THEN '4'  ELSE '9' END  DEFEDO_CIV,
	SUBSTR(UPPER(Elimina_Acentuacao(get_info_end_endereco(cpf.nr_seq_pessoa_endereco,'RUA_VIALIDADE','D') || ' ' || get_info_end_endereco(cpf.nr_seq_pessoa_endereco,'NUMERO','D'))),1,80) DEFDOM_HAB,
	SUBSTR(UPPER(Elimina_Acentuacao(coalesce(get_info_end_endereco(cpf.nr_seq_pessoa_endereco,'BAIRRO_VILA','D'), cpf.ds_bairro))),1,60) DEFCOL_HAB,
	LPAD(coalesce(coalesce(get_info_end_endereco(cpf.nr_seq_pessoa_endereco,'ESTADO_PROVINCI','C'), obter_dados_cat_localidade(cpf.nr_seq_localizacao_mx,'CD_EFE')),'0'),2,'0') DEFENT_HAB,
	LPAD(coalesce(coalesce(get_info_end_endereco(cpf.nr_seq_pessoa_endereco,'MUNICIPIO','C'), obter_dados_cat_localidade(cpf.nr_seq_localizacao_mx,'CD_CAT_MUNICIPIO')),'0'),3,'0') DEFDEL_HAB,
	LPAD(coalesce(coalesce(get_info_end_endereco(cpf.nr_seq_pessoa_endereco,'LOCALIDADE_AREA','C'), obter_dados_cat_localidade(cpf.nr_seq_localizacao_mx,'CD_CAT_LOCALIDADE')),'0'),4,'0') DEFLOC_HAB,
	coalesce(CASE WHEN pf.ie_grau_instrucao='1' THEN '01' WHEN pf.ie_grau_instrucao='2' THEN '03' WHEN pf.ie_grau_instrucao='3' THEN '05' WHEN pf.ie_grau_instrucao='4' THEN '06' WHEN pf.ie_grau_instrucao='5' THEN '10' WHEN pf.ie_grau_instrucao='6' THEN '10' WHEN pf.ie_grau_instrucao='7' THEN '02' WHEN pf.ie_grau_instrucao='8' THEN '04' WHEN pf.ie_grau_instrucao='9' THEN '11' WHEN pf.ie_grau_instrucao='10' THEN '12' WHEN pf.ie_grau_instrucao='11' THEN '01' WHEN pf.ie_grau_instrucao='12' THEN '10' WHEN pf.ie_grau_instrucao='13' THEN '10' WHEN pf.ie_grau_instrucao='14' THEN '00' WHEN pf.ie_grau_instrucao='15' THEN '07'  ELSE '99' END ,'99') DEFESCOLAR,
	RPAD(coalesce((SELECT coalesce(w.cd_externo,'99') FROM cargo w WHERE w.cd_cargo = pf.cd_cargo),'00'),2) DEFOCUPACI,
	CASE WHEN pf.cd_cargo IS NULL THEN '2'  ELSE '1' END  DEFTRABAJA,
	(SELECT coalesce(obter_dados_cat_derecho(cd_tipo_convenio_mx,'CD_DERECHOHABIENCIA'),'99') FROM convenio WHERE cd_convenio = (SELECT cd_convenio FROM atend_categoria_convenio WHERE nr_seq_interno = (SELECT MIN(nr_seq_interno) FROM atend_categoria_convenio WHERE nr_atendimento = a.nr_atendimento))) DEFDERECHO,
	coalesce((SELECT nr_doc_convenio FROM atend_categoria_convenio WHERE nr_seq_interno = (SELECT MIN(nr_seq_interno) FROM atend_categoria_convenio WHERE nr_atendimento = a.nr_atendimento)),'NO APLICA') DEFAFIL_DH,
	(SELECT coalesce(obter_dados_cat_derecho(cd_tipo_convenio_mx,'CD_DERECHOHABIENCIA'),'00') FROM convenio WHERE cd_convenio = (SELECT cd_convenio FROM	atend_categoria_convenio WHERE nr_seq_interno = (SELECT MAX(nr_seq_interno) FROM atend_categoria_convenio WHERE nr_atendimento = a.nr_atendimento))) DEFDERECHO2,
	coalesce(b.nr_seq_local_obito,'99') DEFSITIO,
	RPAD(coalesce(obter_dados_cat_clues(m.cd_internacional,'DS_ESTAB_SAUDE'),'NO APLICA'),50) DEFUNIMED,
	m.cd_internacional DEFCLUES,
	SUBSTR(UPPER(Elimina_Acentuacao(m.ds_endereco||' '||m.nr_endereco)),1,80) DEFDOM_DEF,
	SUBSTR(UPPER(Elimina_Acentuacao(m.ds_bairro)),1,60) DEFCOL_DEF,
	LPAD(obter_dados_cat_clues(m.cd_internacional,'CD_ESTADO'),2,'0') DEFENT_DEF,
	LPAD(obter_dados_cat_clues(m.cd_internacional,'CD_MUNICIPIO'),3,'0') DEFDEL_DEF,
	LPAD(obter_dados_cat_clues(m.cd_internacional,'CD_LOCALIDADE'),4,'0') DEFLOC_DEF,
	LPAD(obter_dados_cat_clues(m.cd_internacional,'CD_JURISDICAO'),2,'0') DEFJUR_DEF,
	b.dt_obito DEFFECH_DEF,
	coalesce(TO_CHAR(b.dt_obito,'hh24:mi'),'99:99') DEFHORA,
	CASE WHEN b.ie_recebeu_atendimento='S' THEN '1'  ELSE '2' END  DEFATENCIO,
	CASE WHEN (SELECT coalesce(ie_autopsia,'N') FROM sinan_conclusao WHERE nr_seq_notificacao = (SELECT max(nr_sequencia) FROM notificacao_sinan WHERE nr_atendimento = a.nr_atendimento))='S' THEN '1'  ELSE '2' END  DEFNECROPS,
	RPAD(UPPER(obter_desc_cid(b.cd_cid_direta)),100) DESCAUSA1,
        CASE WHEN(SELECT max(z.ie_unidade_tempo) FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_direta = z.cd_doenca)='D' THEN '1' WHEN(SELECT max(z.ie_unidade_tempo) FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_direta = z.cd_doenca)='M' THEN '2' WHEN(SELECT max(z.ie_unidade_tempo) FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_direta = z.cd_doenca)='A' THEN '3'  ELSE '9' END  CVETPO_C1,
        coalesce((SELECT max(z.qt_tempo) FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_direta = z.cd_doenca),'999') TIEMPO_C1,
        RPAD(b.cd_cid_direta,4) CAUSA1, RPAD(UPPER(obter_desc_cid(b.cd_cid_adic_1)),100) DESCAUSA2,
        CASE WHEN(SELECT z.ie_unidade_tempo FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_adic_1 = z.cd_doenca)='D' THEN '1' WHEN(SELECT z.ie_unidade_tempo FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_adic_1 = z.cd_doenca)='M' THEN '2' WHEN(SELECT z.ie_unidade_tempo FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_adic_1 = z.cd_doenca)='A' THEN '3'  ELSE '9' END  CVETPO_C2,
        coalesce((SELECT coalesce(z.qt_tempo,'999') FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_adic_1 = z.cd_doenca),'999') TIEMPO_C2,
        RPAD(b.cd_cid_adic_1,4) CAUSA2, RPAD(UPPER(obter_desc_cid(b.cd_cid_adic_2)),100) DESCAUSA3,
        CASE WHEN(SELECT z.ie_unidade_tempo FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_adic_2 = z.cd_doenca)='D' THEN '1' WHEN(SELECT z.ie_unidade_tempo FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_adic_2 = z.cd_doenca)='M' THEN '2' WHEN(SELECT z.ie_unidade_tempo FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_adic_2 = z.cd_doenca)='A' THEN '3'  ELSE '9' END  CVETPO_C3,
        coalesce((SELECT coalesce(z.qt_tempo,'999') FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_adic_2 = z.cd_doenca),'999') TIEMPO_C3,
        RPAD(b.cd_cid_adic_2,4) CAUSA3,
        RPAD(UPPER(obter_desc_cid(b.cd_cid_adic_3)),100) DESCAUSA4,
        CASE WHEN(SELECT z.ie_unidade_tempo FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_adic_3 = z.cd_doenca)='D' THEN '1' WHEN(SELECT z.ie_unidade_tempo FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_adic_3 = z.cd_doenca)='M' THEN '2' WHEN(SELECT z.ie_unidade_tempo FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_adic_3 = z.cd_doenca)='A' THEN '3'  ELSE '9' END  CVETPO_C4,
        coalesce((SELECT coalesce(z.qt_tempo,'999') FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_adic_3 = z.cd_doenca),'999') TIEMPO_C4,
        RPAD(b.cd_cid_adic_3,4) CAUSA4,
        RPAD(UPPER(obter_desc_cid(b.cd_cid_basica)),100) DESCAUSA5,
        CASE WHEN(SELECT z.ie_unidade_tempo FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_basica = z.cd_doenca)='D' THEN '1' WHEN(SELECT z.ie_unidade_tempo FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_basica = z.cd_doenca)='M' THEN '2' WHEN(SELECT z.ie_unidade_tempo FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_basica = z.cd_doenca)='A' THEN '3'  ELSE '9' END  CVETPO_C5,
        coalesce((SELECT coalesce(z.qt_tempo,'999') FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_basica = z.cd_doenca),'999') TIEMPO_C5,
        RPAD(b.cd_cid_basica,4) CAUSA5,
        RPAD(UPPER(obter_desc_cid(b.cd_cid_adic_4)),100) DESCAUSA6,
        CASE WHEN(SELECT z.ie_unidade_tempo FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_adic_4 = z.cd_doenca)='D' THEN '1' WHEN(SELECT z.ie_unidade_tempo FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_adic_4 = z.cd_doenca)='M' THEN '2' WHEN(SELECT z.ie_unidade_tempo FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_adic_4 = z.cd_doenca)='A' THEN '3'  ELSE '9' END  CVETPO_C6,
        coalesce((SELECT coalesce(z.qt_tempo,'999') FROM diagnostico_doenca z WHERE z.nr_atendimento = a.nr_atendimento AND b.cd_cid_adic_4 = z.cd_doenca),'999') TIEMPO_C6,
        RPAD(b.cd_cid_adic_4,4) CAUSA6,
        RPAD(b.cd_cid_basica,4) DEFCAUSABAS,
        obter_inf_cat_embarazo(a.nr_atendimento) DEFDURANTE,
        CASE WHEN obter_cid_causa_morte_mx(a.nr_atendimento,'P')='S' THEN '1'  ELSE '2' END  DEFTPO_EMB,
        CASE WHEN obter_cid_causa_morte_mx(a.nr_atendimento,'S')='S' THEN '1'  ELSE '2' END  DEFCOM_EMB,
        coalesce((SELECT ie_tipo_acidente FROM causa_morte WHERE nr_sequencia = b.nr_seq_causa_morte),'8') DEFPRESUNT,
        CASE WHEN coalesce(b.IE_OBITO_TRABALHO,'N')='S' THEN '1'  ELSE '2' END  DEFDESEMPE,
        coalesce(obter_dados_cat_lugar_acc(a.cd_lugar_acc,'CD_LUGAR_ACC_MG'),'88') DEFLUG_OCU, --
		coalesce((SELECT (CASE WHEN(x.ie_vinculo_conjuge = '1') THEN '01'
			WHEN(x.ie_vinculo_filho = '1') THEN '02'
			WHEN(x.ie_vinculo_ex_conjuge = '1') THEN '03'
			WHEN(x.ie_vinculo_pai = '1') OR (x.ie_vinculo_mae = '1') THEN '04'
			WHEN(x.ie_vinculo_irmao = '1') THEN '05'
			WHEN(x.IE_VINCULO_PADASTRO = '1') OR (x.IE_VINCULO_MADASTRA = '1') OR (x.IE_VINCULO_NAMORADO = '1') OR (x.IE_VINCULO_EX_NAMORADO = '1') THEN '11'
			WHEN(x.IE_VINCULO_AMIGOS = '1') OR (x.IE_VINCULO_DESCONHECIDO = '1') OR (x.IE_VINCULO_CUIDADOR = '1') OR (x.IE_VINCULO_CHEFE = '1') OR (x.IE_VINCULO_INSTITUCIONAL = '1') OR (x.IE_VINCULO_POLICIAL = '1') THEN '12'
			ELSE '99' END)
		FROM sinan_dados_agressao x, notificacao_sinan z
		WHERE x.nr_seq_notificacao = z.nr_sequencia
		AND z.nr_seq_doenca_compulsoria = 109
		AND z.nr_atendimento = a.nr_atendimento),'88') DEFVIO_FAM,
	coalesce((SELECT TO_CHAR(x.nr_notificacao) FROM notificacao_sinan x, notificacao_sinan z WHERE x.nr_sequencia = z.nr_sequencia AND z.nr_seq_doenca_compulsoria = 109 AND z.nr_atendimento = a.nr_atendimento),'NO APLICA') DEFACTAMP,
	SUBSTR(coalesce((SELECT MAX(W.DS_DIAGNOSTICO) FROM DIAGNOSTICO_DOENCA W WHERE A.NR_ATENDIMENTO = W.NR_ATENDIMENTO AND UPPER(trim(both W.CD_DOENCA)) = UPPER(trim(both b.cd_cid_direta)) AND DT_INATIVACAO IS NULL),'NO APLICA'),1,150) DEFDESC_LES,
	SUBSTR(coalesce((SELECT UPPER(Elimina_Acentuacao(x.ds_endereco)) FROM notificacao_sinan z
LEFT OUTER JOIN sinan_dados_ocorrencia x ON (z.nr_sequencia = x.nr_seq_notificacao)
WHERE z.nr_seq_doenca_compulsoria = 109 AND z.nr_atendimento = a.nr_atendimento ),'NO APLICA'),1,80) DEFDOM_ACC,
	SUBSTR(coalesce((SELECT UPPER(Elimina_Acentuacao(x.ds_bairro)) FROM notificacao_sinan z
LEFT OUTER JOIN sinan_dados_ocorrencia x ON (z.nr_sequencia = x.nr_seq_notificacao)
WHERE z.nr_seq_doenca_compulsoria = 109 AND z.nr_atendimento = a.nr_atendimento ),'NO APLICA'),1,60) DEFCOL_ACC,
	LPAD(coalesce((SELECT MAX(x.nr_seq_entidade) FROM cih_doenca_compulsoria w, notificacao_sinan z
LEFT OUTER JOIN sinan_dados_ocorrencia x ON (z.nr_sequencia = x.nr_seq_notificacao)
WHERE z.nr_seq_doenca_compulsoria = w.nr_sequencia AND w.ie_tipo_doenca = 'V' AND z.nr_atendimento = a.nr_atendimento ),'88'),2,'0') DEFENT_ACC,
	LPAD(coalesce((SELECT MAX(x.nr_seq_municipio) FROM cih_doenca_compulsoria w, notificacao_sinan z
LEFT OUTER JOIN sinan_dados_ocorrencia x ON (z.nr_sequencia = x.nr_seq_notificacao)
WHERE z.nr_seq_doenca_compulsoria = w.nr_sequencia AND w.ie_tipo_doenca = 'V' AND z.nr_atendimento = a.nr_atendimento ),'888'),3,'0') DEFDEL_ACC,
	LPAD(coalesce((SELECT MAX(x.nr_seq_localidade) FROM cih_doenca_compulsoria w, notificacao_sinan z
LEFT OUTER JOIN sinan_dados_ocorrencia x ON (z.nr_sequencia = x.nr_seq_notificacao)
WHERE z.nr_seq_doenca_compulsoria = w.nr_sequencia AND w.ie_tipo_doenca = 'V' AND z.nr_atendimento = a.nr_atendimento ),'8888'),4,'0') DEFLOC_ACC,
	RPAD(coalesce(p.ds_given_name,'SIN INFORMACION'),40) DEFNOMBINFOR,
	RPAD(coalesce(p.ds_family_name,'SIN INFORMACION'),20) DEFPATINFOR,
	RPAD(coalesce(p.ds_component_name_1,'SIN INFORMACION'),20) DEFMATINFOR,
	LPAD((SELECT x.cd_grau_parentesco_mx FROM cat_grau_parentesco x WHERE x.nr_sequencia = (SELECT p.cd_parentesco_mx FROM grau_parentesco p WHERE p.nr_sequencia = b.nr_seq_parentesco)),2,'0') DEFPARENTINFOR, --
	coalesce(obter_dados_cat_cert_parto(b.ie_emissor,'CD_CERT_PARTO_MF'),'8') DEFCERTIFI,
	SUBSTR(coalesce(obter_crm_medico(b.cd_medico),'8888888'),1,7) DEFCEDCERTIFI,
	RPAD(coalesce(x.ds_given_name,'SIN INFORMACION'),40) DEFNOMBCERTIF,
	RPAD(coalesce(x.ds_family_name,'SIN INFORMACION'),20)DEFPATCERTI,
	RPAD(coalesce(x.ds_component_name_1,'SIN INFORMACION'),20) DEFMATCERTI,
	coalesce(cpfm.nr_telefone,'9999999999')DEFTEL_CERT,
	RPAD(coalesce(UPPER(Elimina_Acentuacao(cpfm.ds_endereco||' '||cpfm.nr_endereco)),'NO ESPECIFICADO'),80) DEFDOMCERTIFI,
	CASE WHEN coalesce(me.IE_COBRA_PF_PJ,'N')='S' THEN '1'  ELSE '2' END  DEFFIRMOCERT,
	TO_CHAR(b.dt_liberacao,'dd/mm/yyyy') DEFFECH_CER,
	LPAD(b.nr_declaracao,10,'0') DEFOFICIAL,
	LPAD(b.nr_declaracao,10,'0') DEFLIBRONUM,
	LPAD(b.nr_declaracao,10,'0') DEFNACTARC,
	LPAD(coalesce(obter_dados_cat_clues(m.cd_internacional,'CD_ESTADO'),'99'),2,'0') DEFENT_REG,
	LPAD(coalesce(obter_dados_cat_clues(m.cd_internacional,'CD_MUNICIPIO'),'999'),3,'0') DEFDEL_REG,
	LPAD(coalesce(obter_dados_cat_clues(m.cd_internacional,'CD_LOCALIDADE'),'9999'),4,'0') DEFLOC_REG,
	TO_CHAR(b.dt_atualizacao,'dd/mm/yyyy') DEFFECH_REG,
	coalesce(CASE WHEN obter_inform_adic_usuario_mx(wheb_usuario_pck.get_nm_usuario,'IE_NIVEL_USUARIO_SEED')=1 THEN 'EDO' WHEN obter_inform_adic_usuario_mx(wheb_usuario_pck.get_nm_usuario,'IE_NIVEL_USUARIO_SEED')=2 THEN 'JURIS' WHEN obter_inform_adic_usuario_mx(wheb_usuario_pck.get_nm_usuario,'IE_NIVEL_USUARIO_SEED')=3 THEN  'UNME' WHEN obter_inform_adic_usuario_mx(wheb_usuario_pck.get_nm_usuario,'IE_NIVEL_USUARIO_SEED')=4 THEN  'SEMEF'  ELSE 'SEED' END , 'SEED') DEFUSU_CRE,
	TO_CHAR(b.dt_atualizacao,'dd/mm/yyyy') DEFFEC_CRE,
	coalesce(obter_inform_adic_usuario_mx(wheb_usuario_pck.get_nm_usuario,'IE_NIVEL_USUARIO_SEED'),'0') DEFNIVCAPT_CRE,
	coalesce(obter_dados_cat_sitios(b.nr_seq_local_obito,'CD_SITIO'),'99') DEFINSTCAPT_CRE,
	LPAD(coalesce(obter_dados_cat_clues(m.cd_internacional,'CD_ESTADO'),'99'),2,'0') DEFEDOCAPT_CRE,
	coalesce(obter_inform_adic_usuario_mx(wheb_usuario_pck.get_nm_usuario,'NR_SEQ_JURISDICAO'),'88') DEFJURCAPT_CRE,
	LPAD(coalesce(obter_dados_cat_clues(m.cd_internacional,'CD_MUNICIPIO'),'999'),3,'0') DEFMPOCAPT_CRE,
	m.cd_internacional DEFCLUESCAPT_CRE,
	obter_inform_adic_usuario_mx(wheb_usuario_pck.get_nm_usuario,'IE_NIVEL_USUARIO_SEED') DEFUSU_MOD,
	TO_CHAR(b.dt_atualizacao,'dd/mm/yyyy') DEFFEC_MOD,
	obter_inform_adic_usuario_mx(wheb_usuario_pck.get_nm_usuario,'IE_NIVEL_USUARIO_SEED') DEFNIVCAPT,
	coalesce(obter_dados_cat_sitios(b.nr_seq_local_obito,'CD_SITIO'),'99') DEFINSTCAPT,
	LPAD(coalesce(obter_dados_cat_clues(m.cd_internacional,'CD_ESTADO'),'99'),2,'0') DEFEDOCAPT,
	LPAD(coalesce(obter_dados_cat_clues(m.cd_internacional,'CD_JURISDICAO'),'99'),2,'0') DEFJURCAPT,
	LPAD(coalesce(obter_dados_cat_clues(m.cd_internacional,'CD_MUNICIPIO'),'999'),3,'0') DEFMPOCAPT,
	m.cd_internacional DEFCLUESCAPT,
	coalesce(b.ie_tipo_certif_obt,'1') DEFTIPFORM,
	CASE WHEN(SELECT COUNT(1) FROM cih_doenca_compulsoria x WHERE x.cd_doenca_cid = b.cd_cid_direta AND x.ie_tipo_doenca IS NOT NULL)='0' THEN '0'  ELSE '1' END  DEFVEREPI,
	CASE WHEN obter_cid_causa_morte_mx(a.nr_atendimento,'P')='N' THEN CASE WHEN obter_cid_causa_morte_mx(a.nr_atendimento,'S')='N' THEN '0'  ELSE '1' END   ELSE '1' END  DEFVERMAT,
	TO_CHAR(b.dt_liberacao,'dd') DEFEXTEMPORANEO,
	'0' DEFRECTIFICA,
	'0' DEFMODIFICABE,
	'0' DEFMODIFICABF,
	'0' DEFPRIMERA_AM,
	a.NM_USUARIO,
	m.cd_cgc CD_PESSOA_JURIDICA,
	b.CD_MEDICO CD_MEDICO,
	OBTER_NOME_CONVENIO(Obter_Convenio_Atendimento(b.nr_atendimento)) CD_CONVENIO,
	cpfr.cd_pessoa_fisica_ref CD_PESSOA_FISICA_REF
FROM estabelecimento n, pessoa_juridica m, compl_pessoa_fisica cpf, atendimento_paciente a, declaracao_obito b
LEFT OUTER JOIN medico me ON (b.cd_medico = me.cd_pessoa_fisica)
LEFT OUTER JOIN person_name p ON (b.nr_seq_person_name = p.nr_sequencia AND 'main' = p.ds_type)
, pessoa_fisica pf
LEFT OUTER JOIN person_name z ON (pf.nr_seq_person_name = z.nr_sequencia AND 'main' = z.ds_type)
, compl_pessoa_fisica cpfr
LEFT OUTER JOIN pessoa_fisica pfr ON (cpfr.cd_pessoa_fisica_ref = pfr.cd_pessoa_fisica)
LEFT OUTER JOIN person_name y ON (pfr.nr_seq_person_name = y.nr_sequencia AND 'main' = y.ds_type)
, pessoa_fisica pfm
LEFT OUTER JOIN compl_pessoa_fisica cpfm ON (pfm.cd_pessoa_fisica = cpfm.cd_pessoa_fisica AND 2 = cpfm.ie_tipo_complemento)
LEFT OUTER JOIN person_name x ON (pfm.nr_seq_person_name = x.nr_sequencia AND 'main' = x.ds_type)
WHERE a.nr_atendimento = b.nr_atendimento AND b.ie_situacao = 'A' AND b.nr_sequencia IS NOT NULL AND a.cd_pessoa_fisica	= pf.cd_pessoa_fisica AND pf.cd_pessoa_fisica	= cpf.cd_pessoa_fisica AND cpf.ie_tipo_complemento	= 1 AND pf.cd_pessoa_fisica	= cpfr.cd_pessoa_fisica  AND a.cd_estabelecimento	= n.cd_estabelecimento AND n.cd_cgc 		= m.cd_cgc    AND b.cd_medico		= pfm.cd_pessoa_fisica;

