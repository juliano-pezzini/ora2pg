-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pagamento_escrit_real_v2 (tp_registro, ie_registro, nr_inscricao, cd_agencia, nr_conta, nm_empresa, nm_banco, dt_geracao, nr_seq_envio, cd_convenio_banco, tp_inscricao, cd_cgc_fornecedor, cd_agencia_bancaria, nr_conta_forneced, nm_hospital, ds_endereco, ds_cidade, cd_cep, sg_estado, ds_bairro, cd_banco_fornecedor, cd_agencia_fornecedor, nr_conta_fornecedor, nm_fornecedor, nr_documento, dt_vencimento, vl_previsto_pagto, nr_inscricao_fornec, qt_registros, cd_barras, vl_titulo, vl_desconto, vl_acrescimo, dt_pagto, vl_pagto, nr_titulo, vl_total_pagto, qt_lotes_arquivo, qt_total_registros) AS select	0						tp_registro,
	1 ie_registro, 
	a.cd_cgc					nr_inscricao, 
	b.cd_agencia_bancaria				cd_agencia, 
	b.cd_conta					nr_conta, 
	upper(p.ds_razao_social)			nm_empresa, 
	g.ds_banco					nm_banco, 
	e.dt_remessa_retorno				dt_geracao, 
	e.nr_sequencia					nr_seq_envio, 
	b.cd_agencia_bancaria || b.cd_conta || 'PG'cd_convenio_banco, 
	'0' tp_inscricao, 
	'0' cd_cgc_fornecedor, 
	'0' cd_agencia_bancaria, 
	'0' nr_conta_forneced, 
	'' nm_hospital, 
	'' ds_endereco, 
	'' ds_cidade, 
	'0' cd_cep, 
	'' sg_estado, 
	'' ds_bairro, 
	0 cd_banco_fornecedor, 
	'0' cd_agencia_fornecedor, 
	'' nr_conta_fornecedor, 
	'' nm_fornecedor, 
	0 nr_documento, 
	LOCALTIMESTAMP dt_vencimento, 
	0 vl_previsto_pagto, 
	'0' nr_inscricao_fornec, 
	0 qt_registros, 
	'' cd_barras, 
	0 vl_titulo, 
	0 vl_desconto, 
	0 vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	0 vl_pagto, 
	0 nr_titulo, 
	0 vl_total_pagto, 
	0 qt_lotes_arquivo, 
	0 qt_total_registros 
FROM	banco_estabelecimento b, 
	Titulo_pagar_v2 d, 
	estabelecimento a, 
	banco_estabelecimento_v g, 
	pessoa_juridica p, 
	banco_escritural e 
where	e.cd_estabelecimento  = a.cd_estabelecimento 
and  e.cd_estabelecimento  = b.cd_estabelecimento 
and  a.cd_cgc        = p.cd_cgc 
and  e.cd_banco       = b.cd_banco 
and  g.cd_banco       = b.cd_banco 
and  b.ie_tipo_relacao    in ('EP','ECC') 

union
 
/* Header do Lote Conta Corrente*/
 
select	distinct 1 tp_registro, 
	2 ie_registro, 
	'0' nr_inscricao, 
	'' cd_agencia, 
	'0' nr_conta, 
	'' nm_empresa, 
	'' nm_banco, 
	LOCALTIMESTAMP dt_geracao, 
	a.nr_sequencia						nr_seq_envio, 
	b.cd_agencia_bancaria || b.cd_conta || 'PG'cd_convenio_banco, 
	'2'							tp_inscricao, 
	e.cd_cgc						cd_cgc_fornecedor, 
	b.cd_agencia_bancaria					cd_agencia_bancaria, 
	b.cd_conta						nr_conta_forneced, 
	upper(j.ds_razao_social) 				nm_hospital, 
	upper(j.ds_endereco)					ds_endereco, 
	j.ds_municipio						ds_cidade, 
	j.cd_cep						cd_cep, 
	j.sg_estado						sg_estado, 
	'' ds_bairro, 
	0 cd_banco_fornecedor, 
	'0' cd_agencia_fornecedor, 
	'' nr_conta_fornecedor, 
	'' nm_fornecedor, 
	0 nr_documento, 
	LOCALTIMESTAMP dt_vencimento, 
	0 vl_previsto_pagto, 
	'0' nr_inscricao_fornec, 
	0 qt_registros, 
	'' cd_barras, 
	0 vl_titulo, 
	0 vl_desconto, 
	0 vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	0 vl_pagto, 
	0 nr_titulo, 
	0 vl_total_pagto, 
	0 qt_lotes_arquivo, 
	0 qt_total_registros 
from	pessoa_juridica j, 
	Estabelecimento e, 
	banco_estabelecimento b, 
	banco_escritural a, 
	titulo_pagar_v2 d, 
	titulo_pagar_escrit c 
where	c.nr_titulo       = d.nr_titulo 
and	e.cd_cgc		= j.cd_cgc 
and	a.nr_sequencia     = c.nr_seq_escrit 
and	a.cd_banco       = b.cd_banco 
and	a.cd_estabelecimento  = b.cd_estabelecimento 
and	a.cd_estabelecimento  = e.cd_estabelecimento 
and	b.ie_tipo_relacao    in ('EP','ECC') 
and 	c.ie_tipo_pagamento		= 'DOC' 

Union
 
/* Detalhe Conta Corrente */
 
select	2 tp_registro, 
	3 ie_registro, 
	'0' nr_inscricao, 
	'' cd_agencia, 
	'0' nr_conta, 
	'' nm_empresa, 
	'' nm_banco, 
	LOCALTIMESTAMP dt_geracao, 
	a.nr_sequencia						nr_seq_envio, 
	'0' cd_convenio_banco, 
	'0' tp_inscricao, 
	d.cd_favorecido cd_cgc_fornecedor, 
	'0' cd_agencia_bancaria, 
	'0' nr_conta_forneced, 
	'' nm_hospital, 
	'' ds_endereco, 
	'' ds_cidade, 
	'0' cd_cep, 
	'' sg_estado, 
	'' ds_bairro, 
	c.cd_banco						cd_banco_fornecedor, 
	c.cd_agencia_bancaria					cd_agencia_fornecedor, 
	c.nr_conta						nr_conta_fornecedor, 
	d.nm_favorecido						nm_fornecedor, 
	d.nr_titulo						nr_documento, 
	d.dt_vencimento_atual					dt_vencimento, 
	d.vl_saldo_titulo					vl_previsto_pagto, 
	e.cd_cgc nr_inscricao_fornec, 
	0 qt_registros, 
	'' cd_barras, 
	0 vl_titulo, 
	0 vl_desconto, 
	0 vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	0 vl_pagto, 
	c.nr_titulo						nr_titulo, 
	0 vl_total_pagto, 
	0 qt_lotes_arquivo, 
	0 qt_total_registros 
from	Estabelecimento e, 
	banco_estabelecimento b, 
	banco_escritural a, 
	titulo_pagar_v2 d,	 
	titulo_pagar_escrit c 
where	c.nr_titulo		= d.nr_titulo 
and	a.nr_sequencia	= c.nr_seq_escrit 
and	a.cd_banco		= b.cd_banco 
and	a.cd_estabelecimento	= b.cd_estabelecimento 
and	a.cd_estabelecimento	= e.cd_estabelecimento 
and 	b.ie_tipo_relacao	in ('EP','ECC') 
and 	c.ie_tipo_pagamento	= 'DOC' 

Union
 
/* Complemento Conta Corrente */
 
select	3 tp_registro, 
	3 ie_registro, 
	'0' nr_inscricao, 
	'' cd_agencia, 
	'0' nr_conta, 
	'' nm_empresa, 
	'' nm_banco, 
	LOCALTIMESTAMP dt_geracao, 
	e.nr_sequencia						nr_seq_envio, 
	'0' cd_convenio_banco, 
	d.ie_tipo_favorecido 					tp_inscricao, 
	d.cd_favorecido						cd_cgc_fornecedor, 
	'0' cd_agencia_bancaria, 
	'0' nr_conta_forneced, 
	'' nm_hospital, 
	upper(d.ds_endereco)					ds_endereco, 
	d.ds_cidade						ds_cidade, 
	d.cd_cep						cd_cep, 
	d.ds_estado						sg_estado, 
	d.ds_bairro						ds_bairro, 
	0 cd_banco_fornecedor, 
	'0' cd_agencia_fornecedor, 
	'' nr_conta_fornecedor, 
	'' nm_fornecedor, 
	d.nr_documento						nr_documento, 
	d.dt_vencimento_atual					dt_vencimento, 
	0 vl_previsto_pagto, 
	'0' nr_inscricao_fornec, 
	0 qt_registros, 
	'' cd_barras, 
	d.vl_titulo						vl_titulo, 
	c.vl_desconto						vl_desconto, 
	c.vl_acrescimo						vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	0 vl_pagto, 
	c.nr_titulo						nr_titulo, 
	0 vl_total_pagto, 
	0 qt_lotes_arquivo, 
	0 qt_total_registros 
from	banco_estabelecimento b, 
	titulo_pagar_v2 d, 
	estabelecimento a, 
	banco_escritural e, 
	titulo_pagar_escrit c 
where	e.nr_sequencia		= c.nr_seq_escrit 
and	e.cd_banco       	= b.cd_banco 
and	c.nr_titulo			= d.nr_titulo 
and	e.cd_estabelecimento  	= b.cd_estabelecimento 
and	e.cd_estabelecimento  	= a.cd_estabelecimento 
and	b.ie_tipo_relacao    	in ('EP','ECC') 
and 	c.ie_tipo_pagamento		= 'DOC' 

union
 
/* Trailler do Lote Conta Corrente*/
 
select	4 tp_registro, 
	4 ie_registro, 
	'0' nr_inscricao, 
	'' cd_agencia, 
	'0' nr_conta, 
	'' nm_empresa, 
	'' nm_banco, 
	LOCALTIMESTAMP dt_geracao, 
	e.nr_sequencia						nr_seq_envio, 
	'0' cd_convenio_banco, 
	'0' tp_inscricao, 
	'0' cd_cgc_fornecedor, 
	'0' cd_agencia_bancaria, 
	'0' nr_conta_forneced, 
	'' nm_hospital, 
	'' ds_endereco, 
	'' ds_cidade, 
	'0' cd_cep, 
	'' sg_estado, 
	'' ds_bairro, 
	0 cd_banco_fornecedor, 
	'0' cd_agencia_fornecedor, 
	'' nr_conta_fornecedor, 
	'' nm_fornecedor, 
	0 nr_documento, 
	LOCALTIMESTAMP dt_vencimento, 
	0 vl_previsto_pagto, 
	'0' nr_inscricao_fornec, 
	(count(*)+count(*)+2)						qt_registros, 
	'' cd_barras, 
	0 vl_titulo, 
	0 vl_desconto, 
	0 vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	0 vl_pagto, 
	0 nr_titulo, 
	sum(c.vl_escritural - c.vl_desconto + c.vl_acrescimo)	vl_total_pagto, 
	0 qt_lotes_arquivo, 
	0 qt_total_registros 
from	banco_estabelecimento b, 
	estabelecimento a,    
	banco_escritural e, 
	titulo_pagar_escrit c 
where	e.nr_sequencia		= c.nr_seq_escrit 
and	e.cd_banco       	= b.cd_banco 
and	e.cd_estabelecimento  	= b.cd_estabelecimento 
and	e.cd_estabelecimento  	= a.cd_estabelecimento 
and	b.ie_tipo_relacao   	in ('EP','ECC') 
and 	c.ie_tipo_pagamento		= 'DOC' 
group by e.nr_sequencia 

union
 
/* Header do Lote Bloquetos*/
 
select	5 tp_registro, 
	5 ie_registro, 
	'0' nr_inscricao, 
	'' cd_agencia, 
	'0' nr_conta, 
	'' nm_empresa, 
	'' nm_banco, 
	LOCALTIMESTAMP dt_geracao, 
	a.nr_sequencia						nr_seq_envio, 
	b.cd_agencia_bancaria || b.cd_conta || 'PG' cd_convenio_banco, 
	'2'							tp_inscricao, 
	e.cd_cgc						cd_cgc_fornecedor, 
	b.cd_agencia_bancaria					cd_agencia_bancaria, 
	b.cd_conta						nr_conta_forneced, 
	'' nm_hospital, 
	upper(j.ds_endereco)					ds_endereco, 
	j.ds_municipio						ds_cidade, 
	j.cd_cep						cd_cep, 
	j.sg_estado						sg_estado, 
	'' ds_bairro, 
	0 cd_banco_fornecedor, 
	'' cd_agencia_fornecedor, 
	'' nr_conta_fornecedor, 
	upper(j.ds_razao_social)				nm_fornecedor, 
	0 nr_documento, 
	LOCALTIMESTAMP dt_vencimento, 
	0 vl_previsto_pagto, 
	'0' nr_inscricao_fornec, 
	0 qt_registros, 
	'' cd_barras, 
	0 vl_titulo, 
	0 vl_desconto, 
	0 vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	0 vl_pagto, 
	0 nr_titulo, 
	0 vl_total_pagto, 
	0 qt_lotes_arquivo, 
	0 qt_total_registros 
from	pessoa_juridica j, 
	Estabelecimento e, 
	banco_estabelecimento b, 
	banco_escritural a, 
	titulo_pagar_v2 d, 
	titulo_pagar_escrit c 
where	c.nr_titulo       	= d.nr_titulo 
and	e.cd_cgc			= j.cd_cgc 
and	a.nr_sequencia     	= c.nr_seq_escrit 
and	a.cd_banco       	= b.cd_banco 
and	a.cd_estabelecimento  	= b.cd_estabelecimento 
and	a.cd_estabelecimento  	= e.cd_estabelecimento 
and	b.ie_tipo_relacao    	in ('EP','ECC') 
and 	c.ie_tipo_pagamento		= 'BLQ' 

Union
 
/* Detalhe Bloquetos */
 
select	6 tp_registro, 
	6 ie_registro, 
	'0' nr_inscricao, 
	'' cd_agencia, 
	'0' nr_conta, 
	'' nm_empresa, 
	'' nm_banco, 
	LOCALTIMESTAMP dt_geracao, 
	a.nr_sequencia						nr_seq_envio, 
	'0' cd_convenio_banco, 
	d.ie_tipo_favorecido tp_inscricao, 
	d.cd_favorecido cd_cgc_fornecedor, 
	c.cd_agencia_bancaria cd_agencia_bancaria, 
	c.nr_conta nr_conta_forneced, 
	'' nm_hospital, 
	'' ds_endereco, 
	'' ds_cidade, 
	'0' cd_cep, 
	'' sg_estado, 
	'' ds_bairro, 
	c.cd_banco cd_banco_fornecedor, 
	c.cd_agencia_bancaria cd_agencia_fornecedor, 
	c.nr_conta nr_conta_fornecedor, 
	d.nm_favorecido						nm_fornecedor, 
	0 nr_documento, 
	LOCALTIMESTAMP							dt_vencimento, 
	d.vl_saldo_titulo vl_previsto_pagto, 
	'0' nr_inscricao_fornec, 
	0 qt_registros, 
	d.nr_bloqueto						cd_barras, 
	d.vl_titulo						vl_titulo, 
	c.vl_desconto						vl_desconto, 
	c.vl_acrescimo, 
	c.dt_liquidacao						dt_pagto, 
	c.vl_liquidacao						vl_pagto, 
	c.nr_titulo						nr_titulo, 
	0 vl_total_pagto, 
	0 qt_lotes_arquivo, 
	0 qt_total_registros 
from	Estabelecimento e, 
	banco_estabelecimento b, 
	banco_escritural a, 
	titulo_pagar_v2 d,	 
	titulo_pagar_escrit c 
where	c.nr_titulo		= d.nr_titulo 
and	a.nr_sequencia	= c.nr_seq_escrit 
and	a.cd_banco		= b.cd_banco 
and	a.cd_estabelecimento	= b.cd_estabelecimento 
and	a.cd_estabelecimento	= e.cd_estabelecimento 
and 	b.ie_tipo_relacao	in ('EP','ECC') 
and 	c.ie_tipo_pagamento	= 'BLQ' 

Union
 
/* Trailler do Lote Bloquetos*/
 
select	7 tp_registro, 
	7 ie_registro, 
	'0' nr_inscricao, 
	'' cd_agencia, 
	'0' nr_conta, 
	'' nm_empresa, 
	'' nm_banco, 
	LOCALTIMESTAMP dt_geracao, 
	e.nr_sequencia						nr_seq_envio, 
	'0' cd_convenio_banco, 
	'0' tp_inscricao, 
	'0' cd_cgc_fornecedor, 
	'0' cd_agencia_bancaria, 
	'0' nr_conta_forneced, 
	'' nm_hospital, 
	'' ds_endereco, 
	'' ds_cidade, 
	'0' cd_cep, 
	'' sg_estado, 
	'' ds_bairro, 
	0 cd_banco_fornecedor, 
	'0' cd_agencia_fornecedor, 
	'' nr_conta_fornecedor, 
	'' nm_fornecedor, 
	0 nr_documento, 
	LOCALTIMESTAMP dt_vencimento, 
	0 vl_previsto_pagto, 
	'0' nr_inscricao_fornec, 
	(count(*)+count(*)+2)					qt_registros, 
	'' cd_barras, 
	sum(d.vl_titulo) vl_titulo, 
	sum(c.vl_desconto) vl_desconto, 
	sum(c.vl_acrescimo) vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	sum(c.vl_liquidacao) vl_pagto, 
	0 nr_titulo, 
	sum(c.vl_escritural - c.vl_desconto + c.vl_acrescimo)	vl_total_pagto, 
	COUNT(*) qt_lotes_arquivo, 
	(count(*)+count(*)+4) qt_total_registros 
from	banco_estabelecimento b, 
	titulo_pagar_v2 d, 
	estabelecimento a, 
	banco_escritural e, 
	titulo_pagar_escrit c 
where	e.nr_sequencia		= c.nr_seq_escrit 
and	e.cd_banco       	= b.cd_banco 
and	c.nr_titulo			= d.nr_titulo 
and	e.cd_estabelecimento  	= b.cd_estabelecimento 
and	e.cd_estabelecimento  	= a.cd_estabelecimento 
and	b.ie_tipo_relacao    	in ('EP','ECC') 
and 	c.ie_tipo_pagamento		= 'BLQ' 
group by e.nr_sequencia 

union
 
/* Trailler do Arquivo*/
 
select	8 tp_registro, 
	8 ie_registro, 
	'0' nr_inscricao, 
	'' cd_agencia, 
	'0' nr_conta, 
	'' nm_empresa, 
	'' nm_banco, 
	LOCALTIMESTAMP dt_geracao, 
	e.nr_sequencia					nr_seq_envio, 
	'0' cd_convenio_banco, 
	'0' tp_inscricao, 
	'0' cd_cgc_fornecedor, 
	'0' cd_agencia_bancaria, 
	'0' nr_conta_forneced, 
	'' nm_hospital, 
	'' ds_endereco, 
	'' ds_cidade, 
	'0' cd_cep, 
	'' sg_estado, 
	'' ds_bairro, 
	0 cd_banco_fornecedor, 
	'0' cd_agencia_fornecedor, 
	'' nr_conta_fornecedor, 
	'' nm_fornecedor, 
	0 nr_documento, 
	LOCALTIMESTAMP dt_vencimento, 
	0 vl_previsto_pagto, 
	'0' nr_inscricao_fornec, 
	0 qt_registros, 
	'' cd_barras, 
	0 vl_titulo, 
	0 vl_desconto, 
	0 vl_acrescimo, 
	LOCALTIMESTAMP dt_pagto, 
	0 vl_pagto, 
	0 nr_titulo, 
	0 vl_total_pagto, 
	count(*) 					qt_lotes_arquivo, 
	(count(*)+count(*)+4)		qt_total_registros 
from	banco_estabelecimento b, 
	estabelecimento a,    
	banco_escritural e, 
	titulo_pagar_escrit c 
where	e.nr_sequencia		= c.nr_seq_escrit 
and	e.cd_banco       	= b.cd_banco 
and	e.cd_estabelecimento  	= b.cd_estabelecimento 
and	e.cd_estabelecimento  	= a.cd_estabelecimento 
and	b.ie_tipo_relacao    	in ('EP','ECC') 
group by e.nr_sequencia;

