-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW localizador_pes_fis_novo_v (cd_pessoa_fisica, nm_pessoa_fisica_sem_acento, nm_pessoa_fisica, nr_prontuario, dt_nascimento, ds_apelido, cd_funcionario, dt_nasc_grid, ie_funcionario, ie_func_grid, ie_func_assistencial, ds_setor_atendimento, ie_func_assist_grid, dt_ultima_alta, nm_social, ie_medico, nr_cpf) AS select  a.cd_pessoa_fisica,
 a.nm_pessoa_fisica_sem_acento,
 a.nm_pessoa_fisica,
 CASE WHEN obter_valor_param_usuario(0, 120, obter_perfil_ativo, wheb_usuario_pck.get_nm_usuario, wheb_usuario_pck.get_cd_estabelecimento)='ESTAB' THEN  b.nr_prontuario  ELSE a.nr_prontuario END  nr_prontuario,
 a.dt_nascimento,
 a.ds_apelido,
 a.cd_funcionario,
 to_char(a.dt_nascimento,'dd/mm/yyyy') dt_nasc_grid,
 coalesce(a.ie_funcionario,'N') ie_funcionario,
 coalesce(a.ie_funcionario,'N') ie_func_grid,
 substr(Obter_se_func_assistencial(a.cd_pessoa_fisica),1,10) ie_func_assistencial,
 substr(Obter_PESSOA_FISICA_LOC_TRAB(a.cd_pessoa_fisica),1,200) ds_setor_atendimento,
 substr(Obter_se_func_assistencial(a.cd_pessoa_fisica),1,10) ie_func_assist_grid,
 to_date(obter_dados_ultimo_atend(a.cd_pessoa_fisica,null,1,'DA'),'dd/mm/yyyy hh24:mi:ss') dt_ultima_alta,
 a.nm_social,
 Obter_se_pf_Medico(a.cd_pessoa_fisica) ie_medico,
 a.nr_cpf
FROM  pessoa_fisica a left join pessoa_fisica_pront_estab b ON (a.cd_pessoa_fisica = b.cd_pessoa_fisica
and wheb_usuario_pck.get_cd_estabelecimento = b.cd_estabelecimento);

