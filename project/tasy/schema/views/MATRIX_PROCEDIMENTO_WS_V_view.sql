-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW matrix_procedimento_ws_v (numero_atendimento, sequencia_exame, codigo_exame, quantidade, cd_solicitante, ie_suspenso, ds_lado, dt_prev_execucao) AS SELECT	b.nr_prescricao numero_Atendimento,
	c.nr_sequencia sequencia_Exame,
	SUBSTR(e.cd_exame_equip,1,20) codigo_exame,
	coalesce(c.QT_PECA_AP, c.qt_procedimento) quantidade,
	b.cd_medico cd_solicitante,
	c.ie_suspenso,
	CASE WHEN coalesce(d.ie_anatomia_patologica,'N')='N' THEN  g.ds_material_exame  ELSE CASE WHEN c.ie_lado='N' THEN 'N/A'  ELSE SUBSTR(obter_valor_dominio(1372, c.ie_lado),1,10) END  END  ds_lado,
	TO_CHAR(c.dt_prev_execucao, 'dd/mm/yyyy hh24:mi:ss') dt_prev_execucao
FROM  	atendimento_paciente a,
	prescr_medica b,
	prescr_procedimento c,
	exame_laboratorio d,
	lab_exame_equip e,
	equipamento_lab f,
	material_exame_lab g
WHERE	a.nr_atendimento = b.nr_atendimento
AND	b.nr_prescricao = c.nr_prescricao
AND	c.nr_seq_Exame = d.nr_seq_exame
AND       	c.cd_material_exame = g.cd_material_exame
AND	d.nr_seq_exame = e.nr_seq_exame
AND	e.cd_equipamento = f.cd_equipamento
AND	f.ds_sigla = 'MATRIX'
AND 	e.nr_seq_material IS NULL

UNION

SELECT	b.nr_prescricao numero_Atendimento,
	c.nr_sequencia sequencia_Exame,
	SUBSTR(e.cd_exame_equip,1,20) codigo_exame,
	c.qt_procedimento quantidade,
	b.cd_medico cd_solicitante,
	c.ie_suspenso,
	CASE WHEN coalesce(d.ie_anatomia_patologica,'N')='N' THEN  g.ds_material_exame  ELSE CASE WHEN c.ie_lado='N' THEN 'N/A'  ELSE SUBSTR(obter_valor_dominio(1372, c.ie_lado),1,10) END  END  ds_lado,
	TO_CHAR(c.dt_prev_execucao, 'dd/mm/yyyy hh24:mi:ss') dt_prev_execucao
FROM  	atendimento_paciente a,
	prescr_medica b,
	prescr_procedimento c,
	exame_laboratorio d,
	lab_exame_equip e,
	equipamento_lab f,
	material_exame_lab g
WHERE	a.nr_atendimento = b.nr_atendimento
AND	b.nr_prescricao = c.nr_prescricao
AND	c.nr_seq_Exame = d.nr_seq_exame
AND 	c.cd_material_exame = g.cd_material_exame
AND	d.nr_seq_exame = e.nr_seq_exame
AND	e.cd_equipamento = f.cd_equipamento
AND 	e.nr_seq_material = g.nr_sequencia
AND	f.ds_sigla = 'MATRIX'
AND 	e.nr_seq_material IS NOT NULL;

