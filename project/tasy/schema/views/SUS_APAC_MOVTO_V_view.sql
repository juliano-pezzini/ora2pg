-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW sus_apac_movto_v (nr_sequencia, nr_apac, nr_atendimento, dt_competencia, cd_unidade, cd_proc_principal, ie_origem_proc_princ, dt_inicio_validade, dt_fim_validade, dt_emissao, ie_tipo_apac, cd_motivo_cobranca, dt_ocorrencia, cd_medico_resp, cd_tratamento, cd_varia_atrib, dt_atualizacao, nm_usuario, nr_cartao_nac_sus, dt_inicio_tratamento, cd_cid_principal, cd_cid_secundario, ie_indicado_tx, ie_inscrito_tx, dt_inscricao_tx, qt_tx_realizado, dt_primeiro_tx, dt_segundo_tx, dt_terceiro_tx, qt_creatinina, qt_ureia_pre, qt_ureia_pos, ie_hepatite_c, ie_hbsag, ie_hiv, ie_hla, cd_cid_topografia, cd_cid_morfologia, ie_metastase, ie_finalidade, dt_diagnostico, cd_estagio, dt_pri_tratamento, dt_seg_tratamento, dt_ter_tratamento, cd_cid_pri_radiacao, cd_cid_seg_radiacao, cd_cid_ter_radiacao, qt_campo_planejado, qt_meses_prev, ie_resultado_exame, nr_aih_tx, dt_transplante, cd_proc_tx, ie_origem_proc_tx, dt_consistencia, nm_usuario_cons, ds_inconsistencia, nr_interno_conta, cd_nacionalidade, ie_status_apac, cd_setor_atendimento, cd_procedimento, cd_atividade_prof, qt_procedimento, cd_cgc_fornecedor, nr_nota_fiscal, nr_seq_propaci, vl_procedimento, vl_medico, vl_materiais, vl_custo_operacional, vl_anestesista, ds_proc_principal, ds_procedimento, dt_entrada, dt_alta, nm_paciente, nm_medico_resp, nr_seq_protocolo) AS select
	a.NR_SEQUENCIA,a.NR_APAC,a.NR_ATENDIMENTO,a.DT_COMPETENCIA,a.CD_UNIDADE,a.CD_PROC_PRINCIPAL,a.IE_ORIGEM_PROC_PRINC,a.DT_INICIO_VALIDADE,a.DT_FIM_VALIDADE,a.DT_EMISSAO,a.IE_TIPO_APAC,a.CD_MOTIVO_COBRANCA,a.DT_OCORRENCIA,a.CD_MEDICO_RESP,a.CD_TRATAMENTO,a.CD_VARIA_ATRIB,a.DT_ATUALIZACAO,a.NM_USUARIO,a.NR_CARTAO_NAC_SUS,a.DT_INICIO_TRATAMENTO,a.CD_CID_PRINCIPAL,a.CD_CID_SECUNDARIO,a.IE_INDICADO_TX,a.IE_INSCRITO_TX,a.DT_INSCRICAO_TX,a.QT_TX_REALIZADO,a.DT_PRIMEIRO_TX,a.DT_SEGUNDO_TX,a.DT_TERCEIRO_TX,a.QT_CREATININA,a.QT_UREIA_PRE,a.QT_UREIA_POS,a.IE_HEPATITE_C,a.IE_HBSAG,a.IE_HIV,a.IE_HLA,a.CD_CID_TOPOGRAFIA,a.CD_CID_MORFOLOGIA,a.IE_METASTASE,a.IE_FINALIDADE,a.DT_DIAGNOSTICO,a.CD_ESTAGIO,a.DT_PRI_TRATAMENTO,a.DT_SEG_TRATAMENTO,a.DT_TER_TRATAMENTO,a.CD_CID_PRI_RADIACAO,a.CD_CID_SEG_RADIACAO,a.CD_CID_TER_RADIACAO,a.QT_CAMPO_PLANEJADO,a.QT_MESES_PREV,a.IE_RESULTADO_EXAME,a.NR_AIH_TX,a.DT_TRANSPLANTE,a.CD_PROC_TX,a.IE_ORIGEM_PROC_TX,a.DT_CONSISTENCIA,a.NM_USUARIO_CONS,a.DS_INCONSISTENCIA,a.NR_INTERNO_CONTA,a.CD_NACIONALIDADE,a.IE_STATUS_APAC,a.CD_SETOR_ATENDIMENTO, 
	b.cd_procedimento, 
	b.cd_atividade_prof, 
	c.qt_procedimento, 
	b.cd_cgc_fornecedor, 
	b.nr_nota_fiscal, 
	b.nr_seq_propaci, 
	c.vl_procedimento, 
	c.vl_medico, 
	c.vl_materiais, 
	c.vl_custo_operacional, 
	c.vl_anestesista, 
	substr(obter_descricao_procedimento(a.cd_proc_principal, 
			a.ie_origem_proc_princ),1,80) ds_proc_principal, 
	substr(obter_descricao_procedimento(c.cd_procedimento, 
			c.ie_origem_proced),1,80) ds_procedimento, 
	d.dt_entrada, 
	d.dt_alta, 
	d.nm_paciente, 
	e.nm_pessoa_fisica nm_medico_resp, 
	f.nr_seq_protocolo 
FROM pessoa_fisica e, atendimento_paciente_v d, procedimento_paciente c, sus_apac_proc b, sus_apac_movto a
LEFT OUTER JOIN conta_paciente f ON (a.nr_interno_conta = f.nr_interno_conta)
WHERE a.nr_sequencia		= b.nr_seq_apac and b.nr_seq_propaci		= c.nr_sequencia and b.ie_origem_proced	= 3 and a.nr_atendimento		= d.nr_atendimento and a.cd_medico_resp		= e.cd_pessoa_fisica  and c.cd_motivo_exc_conta	is null;

