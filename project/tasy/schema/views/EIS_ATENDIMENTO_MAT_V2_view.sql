-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_atendimento_mat_v2 (ie_periodo, dt_referencia, dt_atualizacao, nm_usuario, cd_estabelecimento, ie_ocorrencia, ie_tipo_operacao, cd_setor_solicitante, ie_origem_inf, ie_urgente, ie_tipo_material, cd_classe_material, cd_grupo_material, cd_subgrupo_material, hr_atendimento, qt_itens, qt_minutos, cd_medico, cd_motivo_baixa, cd_centro_custo, cd_local_estoque, cd_local_destino, cd_pessoa_atendente, ds_grupo_material, ds_horario, cd_centro_setor, ds_centro_setor, nm_paciente, cd_material, qt_atendido, nm_usuario_atend, cd_unidade_medida_estoque, ds_unid_medida_estoque, ie_padronizado, cd_operacao_estoque, ds_operacao_estoque, nm_atendente) AS select	a.ie_periodo,
	a.dt_referencia, 
	a.dt_atualizacao, 
	a.nm_usuario, 
	a.cd_estabelecimento, 
	a.ie_ocorrencia, 
	a.ie_tipo_operacao, 
	a.cd_setor_solicitante, 
	a.ie_origem_inf, 
	a.ie_urgente, 
	a.ie_tipo_material, 
	a.cd_classe_material, 
	a.cd_grupo_material, 
	a.cd_subgrupo_material, 
	a.hr_atendimento, 
	a.qt_itens, 
	a.qt_minutos, 
	a.cd_medico, 
	a.cd_motivo_baixa, 
	a.cd_centro_custo, 
	a.cd_local_estoque, 
	a.cd_local_destino, 
	a.cd_pessoa_atendente, 
	obter_desc_grupo_mat(a.cd_grupo_material) ds_grupo_material, 
	to_char(a.hr_atendimento, '00') ds_horario, 
	b.cd_centro_custo cd_centro_setor, 
	substr(coalesce(obter_desc_centro_custo(b.cd_centro_custo), 'NÃ£o informado'),1,200) ds_centro_setor, 
	substr(obter_nome_pf(a.cd_pessoa_fisica),1,200) nm_paciente, 
	a.cd_material, 
	a.qt_atendido, 
	a.nm_usuario_atend, 
	a.cd_unidade_medida_estoque, 
	substr(obter_desc_unid_med(a.cd_unidade_medida_estoque),1,100) ds_unid_medida_estoque, 
	substr(obter_se_material_padronizado(a.cd_estabelecimento, a.cd_material),1,1) ie_padronizado, 
	a.cd_operacao_estoque, 
	substr(obter_desc_operacao_estoque(a.cd_operacao_estoque),1,255) ds_operacao_estoque, 
	substr(obter_nome_pf(a.cd_pessoa_atendente),1,255) nm_atendente 
FROM eis_atendimento_mat a
LEFT OUTER JOIN setor_atendimento b ON (a.cd_setor_solicitante = b.cd_setor_atendimento);

