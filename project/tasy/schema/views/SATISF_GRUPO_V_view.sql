-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW satisf_grupo_v (ds_grupo, nr_seq_gerencia, nr_seq_grupo_des, nr_seq_grupo_sup, qt_satisf, dt_fim_real, cd_opcao) AS select  b.ds_grupo ds_grupo,
	b.nr_seq_gerencia nr_seq_gerencia,
	b.nr_sequencia nr_seq_grupo_des,
	0 nr_seq_grupo_sup,
	count(*) qt_satisf,
	z.dt_fim_real,
	2 cd_opcao
FROM (	select	distinct a.nr_sequencia,
			a.nr_seq_grupo_des,
			a.dt_fim_real
		from	man_ordem_servico a
		where  	a.ie_grau_satisfacao in ('R','P')
		and     a.nr_seq_grupo_des is not null
		and 	a.nr_seq_gerencia_insatisf is not null
		and exists (	select 	1
				from 	grupo_desenvolvimento
				where 	nr_seq_gerencia = a.nr_seq_gerencia_insatisf	)	) z,
	grupo_desenvolvimento b
where   z.nr_seq_grupo_des = b.nr_sequencia
group by b.ds_grupo, b.nr_seq_gerencia, b.nr_sequencia, z.dt_fim_real

union all

/*select  b.ds_grupo ds_grupo,
	b.nr_seq_gerencia_sup nr_seq_gerencia,
	0 nr_seq_grupo_des,
	b.nr_sequencia nr_seq_grupo_sup,
	count(*) qt_satisf,
	z.dt_fim_real,
	1 cd_opcao
from    (	select 	distinct a.nr_sequencia,
			a.nr_seq_grupo_sup,
			a.dt_fim_real
		from 	man_ordem_servico a
		where   a.ie_grau_satisfacao in ('R','P')
		and  	a.ie_classificacao in ('D')
		and     a.nr_seq_grupo_sup is not null
		and 	a.nr_seq_gerencia_insatisf is null	) z,
	grupo_suporte b
where 	z.nr_seq_grupo_sup = b.nr_sequencia
group by b.ds_grupo, b.nr_seq_gerencia_sup, b.nr_sequencia, z.dt_fim_real
union all*/
select  b.ds_grupo ds_grupo,
	b.nr_seq_gerencia_sup nr_seq_gerencia,
	0 nr_seq_grupo_des,
	b.nr_sequencia nr_seq_grupo_sup,
	count(*) qt_satisf,
	z.dt_fim_real,
	2 cd_opcao
from (	select	distinct a.nr_sequencia,
			a.nr_seq_grupo_sup,
			a.dt_fim_real
		from	man_ordem_servico a
		where  	a.ie_grau_satisfacao in ('R','P')
		and     a.nr_seq_grupo_sup is not null
		and 	a.nr_seq_gerencia_insatisf is not null
		and exists (	select 	1
				from 	grupo_suporte
				where 	nr_seq_gerencia_sup = a.nr_seq_gerencia_insatisf	)	) z,
	grupo_suporte b
where   z.nr_seq_grupo_sup = b.nr_sequencia
group by b.ds_grupo, b.nr_seq_gerencia_sup, b.nr_sequencia, z.dt_fim_real;

