-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW usuario_nivel_sup_v (nr_sequencia, dt_atualizacao, nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec, nm_usuario_sup, dt_referencia, nr_seq_nivel, ds_nivel, qt_media_nivel, qt_media_menor, qt_media_maior) AS select	a.NR_SEQUENCIA,a.DT_ATUALIZACAO,a.NM_USUARIO,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC,a.NM_USUARIO_SUP,a.DT_REFERENCIA,a.NR_SEQ_NIVEL,
	b.ds_nivel,
	b.qt_media_nivel,
	(b.qt_media_nivel - (b.qt_media_nivel * 0.10)) qt_media_menor,
	(b.qt_media_nivel + (b.qt_media_nivel * 0.10)) qt_media_maior
FROM 	nivel_grupo_sup b,
	usuario_nivel_sup a
where 	a.nr_seq_nivel = b.nr_sequencia
and 	a.dt_referencia = (	select	max(c.dt_referencia)
				from    usuario_nivel_sup c
				where   c.nm_usuario_sup = a.nm_usuario_sup
			);

