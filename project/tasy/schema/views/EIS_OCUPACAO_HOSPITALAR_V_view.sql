-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_ocupacao_hospitalar_v (dt_referencia, cd_setor_atendimento, cd_unidade_basica, cd_unidade_compl, cd_unidade, ie_situacao, nr_pacientes, nr_obitos, nr_admissoes, nr_altas, ie_clinica, cd_convenio, cd_tipo_acomodacao, ds_situacao, ds_convenio, ds_tipo_acomodacao, ds_clinica, nm_paciente) AS SELECT 	A.DT_REFERENCIA,
 		A.CD_SETOR_ATENDIMENTO,
 		A.CD_UNIDADE_BASICA,
 		A.CD_UNIDADE_COMPL,
 		A.CD_UNIDADE_BASICA || ' ' || A.CD_UNIDADE_COMPL cd_unidade,
  		A.IE_SITUACAO,
 		A.NR_PACIENTES,
 		A.NR_OBITOS,
 		A.NR_ADMISSOES,
 		A.NR_ALTAS,
 		A.IE_CLINICA,
 		A.CD_CONVENIO,
 		A.CD_TIPO_ACOMODACAO,
        	C.DS_VALOR_DOMINIO ds_situacao,
        	V.DS_CONVENIO,
        	T.DS_TIPO_ACOMODACAO,
        	D.ds_valor_dominio ds_clinica,
        	P.nm_pessoa_fisica nm_paciente
 FROM 	VALOR_DOMINIO C,
      	CONVENIO V,
      	TIPO_ACOMODACAO T,
      	VALOR_DOMINIO D,
      	PESSOA_FISICA P,
      	EIS_OCUPACAO_HOSPITALAR A
 WHERE 	A.IE_SITUACAO           = C.VL_DOMINIO
      AND A.CD_PESSOA_FISICA   = P.CD_PESSOA_FISICA
      AND C.CD_DOMINIO         = 82
      AND A.CD_CONVENIO        = V.CD_CONVENIO
      AND A.CD_TIPO_ACOMODACAO = T.CD_TIPO_ACOMODACAO
      AND A.IE_CLINICA         = D.VL_DOMINIO
      AND D.CD_DOMINIO         = 17
	AND A.IE_PERIODO 		 = 'D'

UNION

 SELECT	A.DT_REFERENCIA,
 		A.CD_SETOR_ATENDIMENTO,
 		A.CD_UNIDADE_BASICA,
 		A.CD_UNIDADE_COMPL,
 		A.CD_UNIDADE_BASICA || ' ' || A.CD_UNIDADE_COMPL cd_unidade,
 		A.IE_SITUACAO,
 		A.NR_PACIENTES,
 		A.NR_OBITOS,
 		A.NR_ADMISSOES,
 		A.NR_ALTAS,
 		A.IE_CLINICA,
 		A.CD_CONVENIO,
 		A.CD_TIPO_ACOMODACAO,
        	C.DS_VALOR_DOMINIO ds_situacao,
		null,
        	null,
        	null,
		null
 FROM 	VALOR_DOMINIO C,
      	EIS_OCUPACAO_HOSPITALAR A
 WHERE 	A.IE_SITUACAO           = C.VL_DOMINIO
   AND	A.IE_PERIODO 		= 'D'
   AND 	C.CD_DOMINIO         	= 82
   AND 	A.IE_SITUACAO 		= 'L';

