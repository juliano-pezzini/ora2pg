-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW oft_agenda_consulta_v (nr_seq_oftalmo, nr_sequencia, nr_seq_consulta, cd_pessoa_fisica, ds_classif_agenda_tasy, nr_minuto_duracao, ds_status_agenda, ds_convenio, nr_telefone_contato, nm_pessoa_contato, nr_atendimento, dt_confirmacao, ds_confirmacao, nm_usuario_origem, dt_entrada_tasy, qt_min_espera_tasy, ds_obs_agenda, dt_consulta, dt_chegada, ie_status_agenda, nm_usuario_acesso, nm_paciente, ie_encaixe, dt_agenda, nr_seq_status_pac, nr_seq_preferencia, dt_aguardando, dt_atendido, cd_agenda, cd_agenda_agenda, cd_pessoa_fisica_agenda, cd_turno, ds_clinica, ie_status_atendimento, dt_entrada, dt_alta, dt_inicio_consulta) AS select
	a.nr_seq_oftalmo,
	a.nr_sequencia,
	a.nr_seq_consulta,
	a.cd_pessoa_fisica,
	substr(obter_classif_agenda_consulta(ie_classif_agenda),1,40) ds_classif_agenda_tasy,
	a.nr_minuto_duracao,
	substr(obter_valor_dominio(83,a.ie_status_agenda),1,100) ds_status_agenda,
	obter_nome_convenio(a.cd_convenio) ds_convenio,
	coalesce(a.nr_telefone, b.nr_telefone_celular) nr_telefone_contato,
	a.nm_pessoa_contato,
	a.nr_atendimento,
	a.dt_confirmacao,
	a.ds_confirmacao,
	a.nm_usuario_origem,
	OBTER_DATA_ENTRADA(a.nr_atendimento) dt_entrada_tasy,
	Obter_Tempo_Espera_Atend(a.nr_atendimento) qt_min_espera_tasy,
	substr(a.ds_observacao,1,255) ds_obs_agenda,
	a.dt_consulta,
	a.dt_chegada,
	a.ie_status_agenda,
	a.nm_usuario_acesso,
	a.nm_paciente,
	a.ie_encaixe,
	a.dt_agenda,
	a.nr_seq_status_pac,
	a.nr_seq_preferencia,
	a.dt_aguardando,
	a.dt_atendido,
	a.cd_agenda,
	x.cd_agenda,
	x.cd_pessoa_fisica cd_pessoa_fisica_agenda,
	a.cd_turno,
	SUBSTR(obter_valor_dominio(17,c.ie_clinica),1,100) ds_clinica,
	c.ie_status_atendimento,
	c.dt_entrada,
	c.dt_alta,
   d.dt_inicio_consulta
FROM agenda x, agenda_consulta a
LEFT OUTER JOIN pessoa_fisica b ON (a.cd_pessoa_fisica = b.cd_pessoa_fisica)
LEFT OUTER JOIN atendimento_paciente c ON (a.nr_atendimento = c.nr_atendimento)
LEFT OUTER JOIN oft_consulta d ON (a.nr_seq_oftalmo = d.nr_sequencia)
WHERE a.cd_agenda				= x.cd_agenda;

