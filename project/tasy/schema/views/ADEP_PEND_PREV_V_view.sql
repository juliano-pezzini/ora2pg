-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW adep_pend_prev_v (nr_seq_apresent, ie_tipo_item, ds_tipo_item, ds_tipo_item_plural, cd_estabelecimento, nr_atendimento, nr_prescricao, dt_lib_horario, cd_setor_prescr, nr_seq_horario, dt_horario, dt_validade_prescr, dt_inicio_prescr, ie_origem_proced, nr_seq_proc_interno, cd_item, ds_item, ie_dose_especial) AS select	1 nr_seq_apresent,
		'D' ie_tipo_item,
		'Dieta oral' ds_tipo_item,
		'Dietas orais' ds_tipo_item_plural,
		a.cd_estabelecimento,
		a.nr_atendimento,
		a.nr_prescricao,
		c.dt_lib_horario,
		a.cd_setor_atendimento cd_setor_prescr,
		c.nr_sequencia nr_seq_horario,
		c.dt_horario,
		a.dt_validade_prescr,
		a.dt_inicio_prescr,
		null ie_origem_proced,
		null nr_seq_proc_interno,
		c.cd_refeicao cd_item,
		substr(obter_valor_dominio(99,c.cd_refeicao),1,240) ds_item,
		'N' ie_dose_especial
FROM	prescr_dieta_hor c,
		prescr_medica a
where	c.nr_prescricao = a.nr_prescricao
and		a.cd_prescritor is not null
and		a.dt_prescricao > LOCALTIMESTAMP - interval '500 days'
and		c.dt_horario > LOCALTIMESTAMP - interval '500 days'
and		coalesce(c.dt_fim_horario,c.dt_suspensao) is null
and		a.dt_liberacao is not null
and		not exists (	select	1
						from	prescr_dieta x
						where	x.nr_prescricao = c.nr_prescricao
						and		x.nr_sequencia	= c.nr_seq_dieta
						and		x.dt_suspensao is not null)
and		coalesce(c.ie_situacao,'A') = 'A'
and		coalesce(a.ie_adep,'S') = 'S'
and		c.dt_lib_horario is not null

union all

select	2 nr_seq_apresent,
		'S' ie_tipo_item,
		'Suplemento oral' ds_tipo_item,
		'Suplementos orais' ds_tipo_item_plural,
		a.cd_estabelecimento,
		a.nr_atendimento,
		a.nr_prescricao,
		c.dt_lib_horario,
		a.cd_setor_atendimento cd_setor_prescr,
		c.nr_sequencia nr_seq_horario,
		c.dt_horario,
		a.dt_validade_prescr,
		a.dt_inicio_prescr,
		null ie_origem_proced,
		null nr_seq_proc_interno,
		to_char(b.cd_material) cd_item,
		substr(obter_desc_material(b.cd_material),1,180) ds_item,
		'N' ie_dose_especial
from	prescr_mat_hor c,
		prescr_material b,
		prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and		c.nr_prescricao = b.nr_prescricao
and		b.nr_prescricao = a.nr_prescricao
and		a.cd_prescritor is not null
and		a.dt_prescricao > LOCALTIMESTAMP - interval '500 days'
and		c.dt_horario > LOCALTIMESTAMP - interval '500 days'
and		coalesce(c.dt_fim_horario,c.dt_suspensao) is null
and		coalesce(c.ie_situacao,'A') = 'A'
and		coalesce(c.ie_horario_especial,'N') = 'N'
and		b.ie_agrupador = 12
and		coalesce(a.ie_adep,'S') = 'S'
and		c.dt_lib_horario is not null

union all

select	3 nr_seq_apresent,
		'M' ie_tipo_item,
		'Medicamento' ds_tipo_item,
		'Medicamentos' ds_tipo_item_plural,
		a.cd_estabelecimento,
		a.nr_atendimento,
		a.nr_prescricao,
		c.dt_lib_horario,
		a.cd_setor_atendimento cd_setor_prescr,
		c.nr_sequencia nr_seq_horario,
		c.dt_horario,
		a.dt_validade_prescr,
		a.dt_inicio_prescr,
		null ie_origem_proced,
		null nr_seq_proc_interno,
		to_char(b.cd_material) cd_item,
		substr(obter_desc_material(b.cd_material),1,180) ds_item,
		coalesce(c.ie_dose_especial,'N') ie_dose_especial
from	prescr_mat_hor c,
		prescr_material b,
		prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and		c.nr_prescricao = b.nr_prescricao
and		b.nr_prescricao = a.nr_prescricao
and		a.cd_prescritor is not null
and		a.dt_prescricao > LOCALTIMESTAMP - interval '500 days'
and		c.dt_horario > LOCALTIMESTAMP - interval '500 days'
and		coalesce(c.dt_fim_horario,c.dt_suspensao,c.dt_recusa) is null
and		coalesce(c.ie_situacao,'A') = 'A'
and		coalesce(c.ie_adep,'S') = 'S'
and		coalesce(c.ie_horario_especial,'N') = 'N'
and		b.ie_agrupador = 1
and		obter_se_gerar_item_adep('M',b.nr_prescricao,b.nr_sequencia,b.nr_agrupamento,'N') = 'S'
and		coalesce(a.ie_adep,'S') = 'S'
and		c.dt_lib_horario is not null
and		coalesce(b.ie_administrar,'S') <> 'N'
and		not exists (	select	1
						from	prescr_material x
						where	x.nr_prescricao = c.nr_prescricao
						and		x.nr_sequencia	= c.nr_seq_material
						and		x.dt_suspensao is not null)

union all

select	4 nr_seq_apresent,
		'MAT' ie_tipo_item,
		'Material' ds_tipo_item,
		'Materiais' ds_tipo_item_plural,
		a.cd_estabelecimento,
		a.nr_atendimento,
		a.nr_prescricao,
		c.dt_lib_horario,
		a.cd_setor_atendimento cd_setor_prescr,
		c.nr_sequencia nr_seq_horario,
		c.dt_horario,
		a.dt_validade_prescr,
		a.dt_inicio_prescr,
		null ie_origem_proced,
		null nr_seq_proc_interno,
		to_char(b.cd_material) cd_item,
		substr(obter_desc_material(b.cd_material),1,180) ds_item,
		'N' ie_dose_especial
from	prescr_mat_hor c,
		prescr_material b,
		prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and		c.nr_prescricao = b.nr_prescricao
and		b.nr_prescricao = a.nr_prescricao
and		a.cd_prescritor is not null
and		a.dt_prescricao > LOCALTIMESTAMP - interval '500 days'
and		c.dt_horario > LOCALTIMESTAMP - interval '500 days'
and		coalesce(c.dt_fim_horario,c.dt_suspensao,c.dt_recusa) is null
and		coalesce(c.ie_situacao,'A') = 'A'
and		coalesce(c.ie_adep,'S') = 'S'
and		coalesce(c.ie_horario_especial,'N') = 'N'
and		b.ie_agrupador = 2
and		coalesce(a.ie_adep,'S') = 'S'
and		obter_se_material_adep(a.cd_estabelecimento,b.cd_material) = 'S'
and		c.dt_lib_horario is not null

union all

select	CASE WHEN b.nr_seq_exame IS NULL THEN  5  ELSE 8 END  nr_seq_apresent,
		CASE WHEN b.nr_seq_exame IS NULL THEN  'P'  ELSE 'L' END  ie_tipo_item,
		CASE WHEN b.nr_seq_exame IS NULL THEN  'Procedimento'  ELSE 'Coleta' END  ds_tipo_item,
		CASE WHEN b.nr_seq_exame IS NULL THEN  'Procedimentos'  ELSE 'Coletas' END  ds_tipo_item_plural,
		a.cd_estabelecimento,
		a.nr_atendimento,
		a.nr_prescricao,
		c.dt_lib_horario,
		a.cd_setor_atendimento cd_setor_prescr,
		c.nr_sequencia nr_seq_horario,
		c.dt_horario,
		a.dt_validade_prescr,
		a.dt_inicio_prescr,		
		b.ie_origem_proced,
		b.nr_seq_proc_interno,
		to_char(b.cd_procedimento) cd_item,
		CASE WHEN b.nr_seq_exame IS NULL THEN  substr(obter_desc_prescr_proc(b.cd_procedimento, b.ie_origem_proced, b.nr_seq_proc_interno),1,240)  ELSE substr(obter_desc_exame(b.nr_seq_exame),1,240) END  ds_item,
		'N' ie_dose_especial
from	prescr_proc_hor c,
		prescr_procedimento b,
		prescr_medica a
where	c.nr_seq_procedimento = b.nr_sequencia
and		c.nr_prescricao = b.nr_prescricao
and		b.nr_prescricao = a.nr_prescricao
and		a.cd_prescritor is not null
and		a.dt_prescricao > LOCALTIMESTAMP - interval '500 days'
and		c.dt_horario > LOCALTIMESTAMP - interval '500 days'
and		coalesce(c.dt_fim_horario,c.dt_suspensao) is null
and		coalesce(c.ie_situacao,'A') = 'A'
and		coalesce(c.ie_horario_especial,'N') = 'N'
and		coalesce(b.nr_seq_solic_sangue,b.nr_seq_derivado,b.nr_seq_prot_glic) is null
and		((b.nr_seq_proc_interno is null) or (obter_ctrl_glic_proc(b.nr_seq_proc_interno) = 'NC'))
and		coalesce(a.ie_adep,'S') = 'S'
and		c.dt_lib_horario is not null

union all

select	6 nr_seq_apresent,
		'R' ie_tipo_item,
		'Recomendação' ds_tipo_item,
		'Recomendações' ds_tipo_item_plural,
		a.cd_estabelecimento,
		a.nr_atendimento,
		a.nr_prescricao,
		c.dt_lib_horario,
		a.cd_setor_atendimento cd_setor_prescr,
		c.nr_sequencia nr_seq_horario,
		c.dt_horario,
		a.dt_validade_prescr,
		a.dt_inicio_prescr,
		null ie_origem_proced,
		null nr_seq_proc_interno,
		coalesce(to_char(b.cd_recomendacao), b.ds_recomendacao) cd_item,
		substr(obter_rec_prescricao(b.nr_sequencia, b.nr_prescricao),1,240) ds_item,
		'N' ie_dose_especial		
FROM prescr_rec_hor c, prescr_medica a, prescr_recomendacao b
LEFT OUTER JOIN tipo_recomendacao y ON (b.cd_recomendacao = y.cd_tipo_recomendacao)
WHERE c.nr_seq_recomendacao = b.nr_sequencia and c.nr_prescricao = b.nr_prescricao  and b.nr_prescricao = a.nr_prescricao and a.cd_prescritor is not null and a.dt_prescricao > LOCALTIMESTAMP - interval '500 days' and c.dt_horario > LOCALTIMESTAMP - interval '500 days' and coalesce(c.dt_fim_horario,c.dt_suspensao) is null and coalesce(c.ie_situacao,'A') = 'A' and coalesce(c.ie_horario_especial,'N') = 'N' and coalesce(a.ie_adep,'S') = 'S' and c.dt_lib_horario is not null and coalesce(y.ie_adep,'S') = 'S' and coalesce(a.dt_liberacao, a.dt_liberacao_medico) is not null

union all

select	7 nr_seq_apresent,
		'E' ie_tipo_item,
		'SAE' ds_tipo_item,
		'SAE' ds_tipo_item_plural,
		null cd_estabelecimento,
		a.nr_atendimento,
		a.nr_sequencia,
		c.dt_lib_horario,
		a.cd_setor_atendimento cd_setor_prescr,
		c.nr_sequencia nr_seq_horario,
		c.dt_horario,
		a.dt_validade_prescr,
		a.dt_inicio_prescr,
		null ie_origem_proced,
		null nr_seq_proc_interno,
		to_char(b.nr_seq_proc) cd_item,substr(obter_desc_intervencoes(b.nr_seq_proc),1,200)||CASE WHEN b.ie_lado IS NULL THEN ''  ELSE ' Lado: '||obter_valor_dominio(1372,b.ie_lado) END  ds_item,
		'N' ie_dose_especial
from	pe_prescr_proc_hor c,
		pe_prescr_proc b,
		pe_prescricao a
where	c.nr_seq_pe_proc = b.nr_sequencia
and		c.nr_seq_pe_prescr = b.nr_seq_prescr
and		b.nr_seq_prescr = a.nr_sequencia
and		a.cd_prescritor is not null
and		a.dt_prescricao > LOCALTIMESTAMP - interval '500 days'
and		c.dt_horario > LOCALTIMESTAMP - interval '500 days'
and		coalesce(c.dt_fim_horario,c.dt_suspensao) is null
and		coalesce(c.ie_situacao,'A') = 'A'
and		coalesce(c.ie_horario_especial,'N') = 'N'
and		coalesce(b.ie_adep,'N') in ('S','M')
and		coalesce(a.ie_situacao, 'A') = 'A'

union all

select	8 nr_seq_apresent,
		'ME' ie_tipo_item,
		'Medicamento' ds_tipo_item,
		'Medicamentos' ds_tipo_item_plural,
		a.cd_estabelecimento,
		a.nr_atendimento,
		a.nr_prescricao,
		c.dt_lib_horario,
		a.cd_setor_atendimento cd_setor_prescr,
		c.nr_sequencia nr_seq_horario,
		c.dt_horario,
		a.dt_validade_prescr,
		a.dt_inicio_prescr,
		null ie_origem_proced,
		null nr_seq_proc_interno,
		to_char(b.cd_material) cd_item,
		substr(obter_desc_material(b.cd_material),1,180) ds_item,
		'N' ie_dose_especial
from	prescr_mat_hor c,
		prescr_material b,
		prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and		c.nr_prescricao = b.nr_prescricao
and		b.nr_prescricao = a.nr_prescricao
and		a.cd_prescritor is not null
and		a.dt_prescricao > LOCALTIMESTAMP - interval '500 days'
and		c.dt_horario > LOCALTIMESTAMP - interval '500 days'
and		coalesce(c.dt_fim_horario,c.dt_suspensao) is null
and		coalesce(c.ie_situacao,'A') = 'A'
and		coalesce(c.ie_adep,'S') = 'S'
and		coalesce(c.ie_horario_especial,'N') = 'N'
and		b.ie_agrupador = 14
and		obter_se_gerar_item_adep('M',b.nr_prescricao,b.nr_sequencia,b.nr_agrupamento,'N') = 'S'
and		coalesce(a.ie_adep,'S') = 'S'
and		c.dt_lib_horario is not null
and		not exists (	select	1
						from	prescr_material x
						where	x.nr_prescricao = c.nr_prescricao
						and		x.nr_sequencia	= c.nr_seq_material
						and		x.dt_suspensao is not null)

union all

select	11 nr_seq_apresent,
		'CIG' ie_tipo_item, 
		'Controle intensivo da glicemia' ds_tipo_item,
		'Controle intensivo da glicemia' ds_tipo_item_plural,
		a.cd_estabelecimento,
		a.nr_atendimento,
		a.nr_prescricao,
		c.dt_lib_horario,
		a.cd_setor_atendimento cd_setor_prescr,
		c.nr_sequencia nr_seq_horario,
		c.dt_horario,
		a.dt_validade_prescr,
		a.dt_inicio_prescr,
		c.ie_origem_proced,
		c.nr_seq_proc_interno,
		to_char(b.cd_Procedimento) cd_item,
		CASE WHEN b.nr_seq_prot_glic IS NULL THEN  substr(obter_desc_prescr_proc(b.cd_procedimento, b.ie_origem_proced, b.nr_seq_proc_interno),1,240)  ELSE substr(obter_nome_prot_glic(b.nr_seq_prot_glic),1,200) END  ds_item,
		'N' ie_dose_especial
from	prescr_proc_hor c,
		prescr_procedimento b,
		prescr_medica a
where	c.nr_seq_procedimento = b.nr_sequencia
and		c.nr_prescricao = b.nr_prescricao
and		b.nr_prescricao = a.nr_prescricao
and		a.cd_prescritor is not null
and		a.dt_prescricao > LOCALTIMESTAMP - interval '500 days'
and		c.dt_horario > LOCALTIMESTAMP - interval '500 days'
and		coalesce(c.dt_fim_horario,c.dt_suspensao) is null
and		coalesce(c.ie_situacao,'A') = 'A'
and		coalesce(c.ie_horario_especial,'N') = 'N'
and		coalesce(b.nr_seq_solic_sangue,b.nr_seq_derivado) is null
and		b.nr_seq_prot_glic is not null
and		((b.nr_seq_proc_interno is not null) and (obter_ctrl_glic_proc(b.nr_seq_proc_interno) = 'CIG'))
and		coalesce(a.ie_adep,'S') = 'S'
and		c.dt_lib_horario is not null

union

select	12 nr_seq_apresent,
		'CCG' ie_tipo_item, 
		'Controle convencional da glicemia' ds_tipo_item,
		'Controle convencional da glicemia' ds_tipo_item_plural,
		a.cd_estabelecimento,
		a.nr_atendimento,
		a.nr_prescricao,
		c.dt_lib_horario,
		a.cd_setor_atendimento cd_setor_prescr,
		c.nr_sequencia nr_seq_horario,
		c.dt_horario,
		a.dt_validade_prescr,
		a.dt_inicio_prescr,
		c.ie_origem_proced,
		c.nr_seq_proc_interno,
		to_char(b.cd_Procedimento) cd_item,
		CASE WHEN b.nr_seq_prot_glic IS NULL THEN  substr(obter_desc_prescr_proc(b.cd_procedimento, b.ie_origem_proced, b.nr_seq_proc_interno),1,240)  ELSE substr(obter_nome_prot_glic(b.nr_seq_prot_glic),1,200) END  ds_item,
		'N' ie_dose_especial
from	prescr_proc_hor c,
		prescr_procedimento b,
		prescr_medica a
where	c.nr_seq_procedimento = b.nr_sequencia
and		c.nr_prescricao = b.nr_prescricao
and		b.nr_prescricao = a.nr_prescricao
and		a.cd_prescritor is not null
and		a.dt_prescricao > LOCALTIMESTAMP - interval '500 days'
and		c.dt_horario > LOCALTIMESTAMP - interval '500 days'
and		coalesce(c.dt_fim_horario,c.dt_suspensao) is null
and		coalesce(c.ie_situacao,'A') = 'A'
and		coalesce(c.ie_horario_especial,'N') = 'N'
and		coalesce(b.nr_seq_solic_sangue,b.nr_seq_derivado) is null
and		b.nr_seq_prot_glic is not null
and		((b.nr_seq_proc_interno is not null) and (obter_ctrl_glic_proc(b.nr_seq_proc_interno) = 'CCG'))
and		coalesce(a.ie_adep,'S') = 'S'
and		c.dt_lib_horario is not null

union

select	13 nr_seq_apresent,
		'NAN' ie_tipo_item,
		'NPT Adulta' ds_tipo_item,
		'NPT Adulta' ds_tipo_item_plural,
		a.cd_estabelecimento,
		a.nr_atendimento,
		a.nr_prescricao,
		null dt_lib_horario,
		a.cd_setor_atendimento cd_setor_prescr,
		null nr_seq_horario,
		c.dt_horario,
		a.dt_validade_prescr,
		a.dt_inicio_prescr,
		null ie_origem_proced,
		null nr_seq_proc_interno,
		null cd_item,
		'NPT Adulta' ds_item,
		'N' ie_dose_especial
from	prescr_medica a,
		nut_paciente b,
		nut_paciente_hor c
where 	b.nr_prescricao = a.nr_prescricao
and		b.nr_sequencia	= c.nr_seq_nut_pac
and		a.cd_prescritor is not null
and		a.dt_prescricao > LOCALTIMESTAMP - interval '10 days'
and		c.dt_horario > LOCALTIMESTAMP - interval '10 days'
and		coalesce(c.dt_fim_horario,c.dt_suspensao) is null 
and		coalesce(c.ie_status,'N') = 'N'
and		coalesce(c.ie_horario_especial,'N') = 'N'
and		coalesce(a.ie_adep,'S') = 'S'
and		b.ie_npt_adulta = 'S'

union

select	13 nr_seq_apresent,
		'NAN' ie_tipo_item,
		'NPT Adulta' ds_tipo_item,
		'NPT Adulta' ds_tipo_item_plural,
		a.cd_estabelecimento,
		a.nr_atendimento,
		a.nr_prescricao,
		null dt_lib_horario,
		a.cd_setor_atendimento cd_setor_prescr,
		null nr_seq_horario,
		c.dt_horario,
		a.dt_validade_prescr,
		a.dt_inicio_prescr,
		null ie_origem_proced,
		null nr_seq_proc_interno,
		null cd_item,
		'NPT Adulta Protocolo' ds_item,
		'N' ie_dose_especial
from	prescr_medica a,
		nut_pac b,
		nut_paciente_hor c
where 	b.nr_prescricao = a.nr_prescricao
and		b.nr_sequencia	= c.nr_seq_nut_protocolo
and		a.cd_prescritor is not null
and		a.dt_prescricao > LOCALTIMESTAMP - interval '10 days'
and		c.dt_horario > LOCALTIMESTAMP - interval '10 days'
and		coalesce(c.dt_fim_horario,c.dt_suspensao) is null 
and		coalesce(c.ie_status,'N') = 'N'
and		coalesce(c.ie_horario_especial,'N') = 'N'
and		coalesce(a.ie_adep,'S') = 'S'
and		b.ie_npt_adulta = 'S'

union

select	13 nr_seq_apresent,
		'NAN' ie_tipo_item,
		'NPT Pediátrica' ds_tipo_item,
		'NPT Pediátrica' ds_tipo_item_plural,
		a.cd_estabelecimento,
		a.nr_atendimento,
		a.nr_prescricao,
		null dt_lib_horario,
		a.cd_setor_atendimento cd_setor_prescr,
		null nr_seq_horario,
		c.dt_horario,
		a.dt_validade_prescr,
		a.dt_inicio_prescr,
		null ie_origem_proced,
		null nr_seq_proc_interno,
		null cd_item,
		'NPT Pediátrica' ds_item,
		'N' ie_dose_especial
from	prescr_medica a,
		nut_pac b,
		nut_paciente_hor c
where 	b.nr_prescricao = a.nr_prescricao
and		b.nr_sequencia	= c.nr_seq_nut_protocolo
and		a.cd_prescritor is not null
and		a.dt_prescricao > LOCALTIMESTAMP - interval '10 days'
and		c.dt_horario > LOCALTIMESTAMP - interval '10 days'
and		coalesce(c.dt_fim_horario,c.dt_suspensao) is null 
and		coalesce(c.ie_status,'N') = 'N'
and		coalesce(c.ie_horario_especial,'N') = 'N'
and		coalesce(a.ie_adep,'S') = 'S'
and		b.ie_npt_adulta = 'P'
and		coalesce(b.ie_status,'N') = 'N'

union

select	13 nr_seq_apresent,
		'NAN' ie_tipo_item,
		'NPT Neonatal' ds_tipo_item,
		'NPT Neonatal' ds_tipo_item_plural,
		a.cd_estabelecimento,
		a.nr_atendimento,
		a.nr_prescricao,
		null dt_lib_horario,
		a.cd_setor_atendimento cd_setor_prescr,
		null nr_seq_horario,
		c.dt_horario,
		a.dt_validade_prescr,
		a.dt_inicio_prescr,
		null ie_origem_proced,
		null nr_seq_proc_interno,
		null cd_item,
		'NPT Neonatal' ds_item,
		'N' ie_dose_especial
from	prescr_medica a,
		nut_pac b,
		nut_paciente_hor c
where 	b.nr_prescricao = a.nr_prescricao
and		b.nr_sequencia	= c.nr_seq_nut_protocolo
and		a.cd_prescritor is not null
and		a.dt_prescricao > LOCALTIMESTAMP - interval '10 days'
and		c.dt_horario > LOCALTIMESTAMP - interval '10 days'
and		coalesce(c.dt_fim_horario,c.dt_suspensao) is null
and		coalesce(c.ie_status,'N') = 'N'
and		coalesce(c.ie_horario_especial,'N') = 'N'
and		coalesce(a.ie_adep,'S') = 'S'
and		b.ie_npt_adulta = 'N'
and		coalesce(b.ie_status,'N') = 'N'

union

select	14 nr_seq_apresent,
		'O' ie_tipo_item,
		'Gasoterapia' ds_tipo_item,
		'Gasoterapias' ds_tipo_item_plural,
		a.cd_estabelecimento,
		a.nr_atendimento,
		a.nr_prescricao,
		c.dt_lib_horario,
		a.cd_setor_atendimento cd_setor_prescr,
		c.nr_sequencia nr_seq_horario,
		c.dt_horario,
		a.dt_validade_prescr,
		a.dt_inicio_prescr,
		null ie_origem_proced,
		null nr_seq_proc_interno,
		to_char(b.nr_seq_gas) cd_item,
		substr(obter_desc_gas(b.nr_seq_gas),1,180) ds_item,
		'N' ie_dose_especial
from	prescr_gasoterapia_hor c,
		prescr_gasoterapia b,
		prescr_medica a
where	c.nr_seq_gasoterapia = b.nr_sequencia
and		c.nr_prescricao = b.nr_prescricao
and		b.nr_prescricao = a.nr_prescricao
and		a.cd_prescritor is not null
and		a.dt_prescricao > LOCALTIMESTAMP - interval '500 days'
and		c.dt_horario > LOCALTIMESTAMP - interval '500 days'
and		coalesce(c.dt_fim_horario,c.dt_suspensao) is null
and		coalesce(c.ie_horario_especial,'N') = 'N'
and		coalesce(substr(Obter_Status_Gasoterapia(b.nr_sequencia, 'C'),1,80),'N') = 'N'
and		coalesce(a.ie_adep,'S') = 'S'
and		c.dt_lib_horario is not null;

