-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW statement_symptom_details_v (ie_type_admission, dt_hospitalization, dt_creation, cd_current_medical_department, ds_current_medical_department, cd_current_ward, ds_current_ward, cd_patient_id, nm_patient_name, ie_sex, qt_age, ds_type_admission, ds_medical_department_doc, ds_ward_doc, nm_attending_doctor, ie_status, ds_status, nr_document, nr_atendimento) AS SELECT	1 ie_type_admission, /*Inpatient*/
        b.dt_entrada dt_hospitalization,
	obter_data_evolucao(get_data_doc_detail_symptom(b.nr_atendimento,'SEQ')) dt_creation,
	obter_departamento_atual_atend(a.nr_atendimento) cd_Current_medical_department,
	SUBSTR(OBTER_NOME_DEPARTAMENTO_MEDICO(obter_departamento_atual_atend(a.nr_atendimento)),1,255) ds_Current_medical_department,
	Obter_Setor_Atendimento(b.nr_atendimento) cd_Current_ward,
        SUBSTR(OBTER_NOME_SETOR(Obter_Setor_Atendimento(b.nr_atendimento)),1,255) ds_Current_ward,
	b.cd_pessoa_fisica cd_Patient_Id,
        a.nm_pessoa_fisica nm_Patient_name,
	Obter_Sexo_PF(b.cd_pessoa_fisica,'D') ie_Sex,
	obter_dados_pf(b.cd_pessoa_fisica, 'I') qt_age,	
	obter_valor_dominio(12,obter_tipo_atendimento(a.nr_atendimento)) ds_type_admission,
	substr(get_data_doc_detail_symptom(b.nr_atendimento,'DSD'),1,255) ds_Medical_department_doc,
	substr(get_data_doc_detail_symptom(b.nr_atendimento,'DSW'),1,255) ds_Ward_Doc,
	substr(get_data_doc_detail_symptom(b.nr_atendimento,'NMAD'),1,255) nm_Attending_doctor,
	substr(get_data_doc_detail_symptom(b.nr_atendimento,'IEST'),1,255) ie_Status,
	substr(get_data_doc_detail_symptom(b.nr_atendimento,'DSST'),1,255) ds_Status,
	substr(get_data_doc_detail_symptom(b.nr_atendimento,'SEQ'),1,255) nr_Document,
	b.nr_atendimento
FROM	setor_atendimento s,
	pep_ocupacao_unidade_v a,
	atendimento_paciente b
WHERE	a.cd_setor_atendimento = s.cd_setor_atendimento
AND	a.nr_atendimento = b.nr_atendimento 
AND	a.nr_atendimento is not null
AND	b.ie_tipo_atendimento in (1,3,10,12,14)

union all

SELECT	8 ie_type_admission, /*Outpatient*/
	b.dt_entrada dt_hospitalization,
	obter_data_evolucao(get_data_doc_detail_symptom(b.nr_atendimento,'SEQ')) dt_creation,
	obter_departamento_atual_atend(a.nr_atendimento) cd_Current_medical_department,
	SUBSTR(OBTER_NOME_DEPARTAMENTO_MEDICO(obter_departamento_atual_atend(a.nr_atendimento)),1,255) ds_Current_medical_department,	
	Obter_Setor_Atendimento(b.nr_atendimento) cd_Current_ward,
        SUBSTR(OBTER_NOME_SETOR(Obter_Setor_Atendimento(b.nr_atendimento)),1,255) ds_Current_ward,
	b.cd_pessoa_fisica cd_Patient_Id,
        substr(obter_nome_pf(b.cd_pessoa_fisica),1,255) nm_Patient_name,
	Obter_Sexo_PF(b.cd_pessoa_fisica,'D') ie_Sex,
	obter_dados_pf(b.cd_pessoa_fisica, 'I') qt_age,	
	obter_valor_dominio(12,obter_tipo_atendimento(a.nr_atendimento)) ds_type_admission,
	substr(get_data_doc_detail_symptom(b.nr_atendimento,'DSD'),1,255) ds_Medical_department_doc,
	substr(get_data_doc_detail_symptom(b.nr_atendimento,'DSW'),1,255) ds_Ward_Doc,
	substr(get_data_doc_detail_symptom(b.nr_atendimento,'NMAD'),1,255) nm_Attending_doctor,
	substr(get_data_doc_detail_symptom(b.nr_atendimento,'IEST'),1,255) ie_Status,
	substr(get_data_doc_detail_symptom(b.nr_atendimento,'DSST'),1,255) ds_Status,
	substr(get_data_doc_detail_symptom(b.nr_atendimento,'SEQ'),1,255) nr_Document,
	b.nr_atendimento
FROM	setor_atendimento s,
	atend_paciente_unidade a,
	atendimento_paciente b
WHERE	a.cd_setor_atendimento = s.cd_setor_atendimento 
AND	b.nr_atendimento = a.nr_atendimento 
AND	b.dt_alta is null
AND	b.ie_tipo_atendimento in (8,7,11)
AND	a.dt_saida_unidade is null
AND	b.dt_entrada >= (LOCALTIMESTAMP - '2')
AND	coalesce(s.ie_situacao,'A') = 'A'
order by ie_type_admission,ds_Current_medical_department,cd_Current_ward,nm_Patient_name;

