-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW tiss_origem_v (ds_versao, cd_interno, nr_sequencia_autor, nr_seq_protocolo, nr_atendimento, cd_medico_executor, nr_seq_med_prot, nr_cpf) AS select	'2.01.01' ds_versao,
	substr(Obter_Valor_Conv_Estab(b.cd_convenio, Obter_dados_autor_convenio(a.nr_sequencia, 'E'), 'CD_INTERNO'),1,15) cd_interno, 
	a.nr_sequencia 		nr_sequencia_autor, 
	0 nr_seq_protocolo, 
	a.nr_atendimento, 
	'0' 			cd_medico_executor, 
	0			nr_seq_med_prot, 
	''			nr_cpf 
FROM	convenio b, 
	autorizacao_convenio a 
where	a.cd_convenio		= b.cd_convenio 

union
 
select	'2.01.01' ds_versao, 
	substr(Obter_Valor_Conv_Estab(b.cd_convenio, a.cd_estabelecimento, 'CD_INTERNO'),1,15) cd_interno, 
	0	 		nr_sequencia_autor, 
	a.nr_seq_protocolo, 
	0			nr_atendimento, 
	'0' cd_medico_executor, 
	0			nr_seq_med_prot, 
	''			nr_cpf 
from	convenio b, 
	protocolo_convenio a 
where	a.cd_convenio		= b.cd_convenio 

union
 
select	'2.01.01' ds_versao, 
	null 		cd_interno, 
	0	 	nr_sequencia_autor, 
	0		nr_seq_protocolo, 
	0		nr_atendimento, 
	'0' 		cd_medico_executor, 
	a.nr_sequencia	nr_seq_med_prot, 
	b.nr_cpf 
from	pessoa_fisica b, 
	med_prot_convenio a 
where	a.cd_medico	= b.cd_pessoa_fisica;

