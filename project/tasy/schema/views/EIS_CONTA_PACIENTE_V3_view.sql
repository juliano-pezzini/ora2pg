-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_conta_paciente_v3 (nr_sequencia, nr_interno_conta, dt_referencia, ie_tipo_atendimento, cd_convenio, dt_atualizacao, vl_medico, vl_medico_fora_conta, vl_material, vl_diaria, vl_sadt_fora_conta, vl_custo, vl_custo_variavel, vl_imposto, vl_procedimento, vl_item, vl_receita, vl_repasse_terceiro, vl_desconto, cd_procedimento, ie_origem_proced, cd_proc_pacote, ie_orig_proc_pacote, vl_original, cd_medico, cd_especialidade, qt_dia_internacao, vl_custo_dir_apoio, vl_custo_mao_obra, vl_custo_direto, vl_custo_indireto, vl_despesa, vl_glosa, vl_desc_financ, vl_custo_sadt, vl_repasse_calc, ie_clinica_alta, vl_custo_hm, ie_status_protocolo, vl_consignado, vl_nao_consignado, dt_receita, cd_setor_atendimento, nr_seq_exame, nr_cirurgia, ie_clinica, ie_complexidade_sus, vl_custo_excluido, ie_proc_mat, nr_seq_grupo_rec, cd_estrutura_conta, vl_glosado, vl_amenor, vl_adicional, vl_custo_mat, ds_agenda_cir, cd_agenda_cir, ie_carater_cirurgia, cd_conta_contabil, cd_centro_custo_setor, dt_entrada, dt_alta, cd_pessoa_fisica, cd_plano_convenio, cd_estab_atend, cd_grupo, ds_grupo, cd_subgrupo, ds_subgrupo, cd_forma_organizacao, ds_forma_organizacao, ie_complexidade, cd_convenio_atend, cd_especialidade_atend, ie_tipo_convenio, ds_tipo_convenio, ds_setor_atendimento, cd_estabelecimento, vl_faturado, ds_clinica, cd_tipo_procedimento, ds_tipo_procedimento, ie_pacote, nr_seq_protocolo, ie_protocolo, ds_categoria, cd_categoria_convenio) AS select	a.NR_SEQUENCIA,a.NR_INTERNO_CONTA,a.DT_REFERENCIA,a.IE_TIPO_ATENDIMENTO,a.CD_CONVENIO,a.DT_ATUALIZACAO,a.VL_MEDICO,a.VL_MEDICO_FORA_CONTA,a.VL_MATERIAL,a.VL_DIARIA,a.VL_SADT_FORA_CONTA,a.VL_CUSTO,a.VL_CUSTO_VARIAVEL,a.VL_IMPOSTO,a.VL_PROCEDIMENTO,a.VL_ITEM,a.VL_RECEITA,a.VL_REPASSE_TERCEIRO,a.VL_DESCONTO,a.CD_PROCEDIMENTO,a.IE_ORIGEM_PROCED,a.CD_PROC_PACOTE,a.IE_ORIG_PROC_PACOTE,a.VL_ORIGINAL,a.CD_MEDICO,a.CD_ESPECIALIDADE,a.QT_DIA_INTERNACAO,a.VL_CUSTO_DIR_APOIO,a.VL_CUSTO_MAO_OBRA,a.VL_CUSTO_DIRETO,a.VL_CUSTO_INDIRETO,a.VL_DESPESA,a.VL_GLOSA,a.VL_DESC_FINANC,a.VL_CUSTO_SADT,a.VL_REPASSE_CALC,a.IE_CLINICA_ALTA,a.VL_CUSTO_HM,a.IE_STATUS_PROTOCOLO,a.VL_CONSIGNADO,a.VL_NAO_CONSIGNADO,a.DT_RECEITA,a.CD_SETOR_ATENDIMENTO,a.NR_SEQ_EXAME,a.NR_CIRURGIA,a.IE_CLINICA,a.IE_COMPLEXIDADE_SUS,a.VL_CUSTO_EXCLUIDO,a.IE_PROC_MAT,a.NR_SEQ_GRUPO_REC,a.CD_ESTRUTURA_CONTA,a.VL_GLOSADO,a.VL_AMENOR,a.VL_ADICIONAL,a.VL_CUSTO_MAT,a.DS_AGENDA_CIR,a.CD_AGENDA_CIR,a.IE_CARATER_CIRURGIA,a.CD_CONTA_CONTABIL,a.CD_CENTRO_CUSTO_SETOR,a.DT_ENTRADA,a.DT_ALTA,a.CD_PESSOA_FISICA,a.CD_PLANO_CONVENIO,a.CD_ESTAB_ATEND,a.CD_GRUPO,a.DS_GRUPO,a.CD_SUBGRUPO,a.DS_SUBGRUPO,a.CD_FORMA_ORGANIZACAO,a.DS_FORMA_ORGANIZACAO,a.IE_COMPLEXIDADE,a.CD_CONVENIO_ATEND,a.CD_ESPECIALIDADE_ATEND,
	b.ie_tipo_convenio,
	obter_valor_dominio(11, b.ie_tipo_convenio) ds_tipo_convenio,
	substr(obter_nome_setor(a.cd_setor_atendimento),1,100) ds_setor_atendimento,
	e.cd_estabelecimento cd_estabelecimento,
	(a.vl_receita + a.vl_repasse_terceiro) vl_faturado,
	substr(obter_valor_dominio(17, a.ie_clinica),1,200) ds_clinica,
	c.cd_tipo_procedimento,
	obter_valor_dominio(95, c.cd_tipo_procedimento) ds_tipo_procedimento,
	CASE WHEN a.cd_proc_pacote IS NULL THEN  'N'  ELSE 'S' END  ie_pacote,
	e.nr_seq_protocolo,
	--obter_status_conta_protocolo(e.nr_interno_conta,e.ie_status_acerto,e.nr_seq_protocolo) ie_protocolo,
	CASE WHEN coalesce(a.ie_status_protocolo,9)=2 THEN '10' WHEN coalesce(a.ie_status_protocolo,9)=1 THEN '8' WHEN coalesce(a.ie_status_protocolo,9)=3 THEN '9'  ELSE CASE WHEN ie_status_acerto=2 THEN '6'  ELSE CASE WHEN a.dt_alta IS NULL THEN '2'  ELSE '4' END  END  END  ie_protocolo,
	substr(b.ds_convenio || ' - ' || obter_categoria_convenio(a.cd_convenio, cd_categoria_parametro),1,200) ds_categoria,
	a.cd_convenio ||'_'||cd_categoria_parametro cd_categoria_convenio
FROM conta_paciente e, eis_conta_paciente a
LEFT OUTER JOIN convenio b ON (a.cd_convenio = b.cd_convenio)
LEFT OUTER JOIN procedimento c ON (a.cd_procedimento = c.cd_procedimento AND a.ie_origem_proced = c.ie_origem_proced)
WHERE a.nr_interno_conta	= e.nr_interno_conta;

