-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW tasysapiens_v (tp_registro, ie_agrupador, nr_sequencia, cd_centro_custo, dt_movimento, cd_conta_debito, cd_conta_credito, vl_movimento, cd_historico, ds_compl_historico, cd_conta_contabil_cc, pr_rateio, cd_tipo_lote_contabil) AS select	tp_registro,
	ie_agrupador,
	nr_sequencia,
	lpad(cd_centro_custo, 9, '0') cd_centro_custo,
	dt_movimento,
	somente_numero(cd_conta_debito) cd_conta_debito,
	somente_numero(cd_conta_credito) cd_conta_credito,
	vl_movimento,
	cd_historico,
	ds_compl_historico,
	somente_numero(cd_conta_contabil_cc) cd_conta_contabil_cc,
	pr_rateio,
	cd_tipo_lote_contabil cd_tipo_lote_contabil
FROM (
	select	coalesce(nr_seq_agrupamento, 0) ie_agrupador, 1 ie_ordem, 0 tp_registro, dt_movimento, cd_conta_debito, '' cd_conta_credito, vl_movimento, cd_historico,
			0 cd_centro_custo, ds_compl_historico, nr_sequencia, '' cd_conta_contabil_cc, 0 pr_rateio,b.cd_tipo_lote_contabil
	from	ctb_movimento a,
		lote_contabil b
	where	a.cd_conta_debito is not null
	and	a.nr_lote_contabil =b.nr_lote_contabil
	
union all

	select	coalesce(nr_seq_agrupamento, 0) ie_agrupador, 2 ie_ordem, 0 tp_registro, dt_movimento, '' cd_conta_debito, cd_conta_credito, vl_movimento, cd_historico,
			0 cd_centro_custo, ds_compl_historico, nr_sequencia, '' cd_conta_contabil_cc, 0 pr_rateio,b.cd_tipo_lote_contabil
	from	ctb_movimento a,
			lote_contabil b
	where		a.cd_conta_credito is not null
	and		a.nr_lote_contabil =b.nr_lote_contabil
	
union all

	select	coalesce(nr_seq_agrupamento, 0) ie_agrupador, 3 ie_ordem, 1 tp_registro,
		dt_movimento, cd_conta_debito, 		cd_conta_credito, b.vl_movimento,cd_historico, b.cd_centro_custo,
		ds_compl_historico,a.nr_sequencia,CASE WHEN coalesce(cd_conta_debito,'0')='0' THEN cd_conta_credito  ELSE cd_conta_debito END  cd_conta_contabil_cc,
		b.pr_rateio pr_rateio,c.cd_tipo_lote_contabil
	from	ctb_movimento a,
		ctb_movto_centro_custo b,
		lote_contabil c
	where	a.nr_sequencia = b.nr_seq_movimento
	and		a.nr_lote_contabil=c.nr_lote_contabil) alias8
order by coalesce(ie_agrupador, 0), nr_sequencia, ie_ordem, cd_centro_custo;

