-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_ops_copartic_v (nr_seq_conta, dt_mes_competencia, dt_mes_competencia_param, cd_estabelecimento, ds_tipo_beneficiario, ds_tipo_pessoa, ds_abrangencia, vl_coparticipacao) AS select	nr_seq_conta,
	pkg_date_formaters.to_varchar(pkg_date_utils.start_of(b.dt_mes_competencia,'MONTH'),'shortDate',wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck.get_nm_usuario) dt_mes_competencia,
	b.dt_mes_competencia	dt_mes_competencia_param,
	a.cd_estabelecimento,
	substr(obter_valor_dominio(2406,s.ie_tipo_segurado),1,30) ds_tipo_beneficiario,
	substr(CASE WHEN coalesce(c.cd_cgc_estipulante,'X')='X' THEN 'PJ'  ELSE 'PF' END ,1,30) ds_tipo_pessoa,
	substr(obter_valor_dominio(1667,p.ie_abrangencia),1,30) ds_abrangencia,
	sum(vl_coparticipacao) vl_coparticipacao
FROM	pls_ar_coparticipacao a,
	pls_ar_lote b,
	pls_segurado s,
	pls_contrato c,
	pls_plano p
where	a.nr_seq_lote = b.nr_sequencia
and	s.nr_sequencia = a.nr_seq_segurado
and	c.nr_sequencia = a.nr_seq_contrato
and	p.nr_sequencia = a.nr_seq_plano
group by nr_seq_conta, b.dt_mes_competencia, a.cd_estabelecimento, s.ie_tipo_segurado, c.cd_cgc_estipulante, p.ie_abrangencia;

