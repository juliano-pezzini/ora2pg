-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_ocorrencia_estrutura_v (ie_estrutura, cd_procedimento, ie_origem_proced, nr_seq_material, nr_seq_estrutura, nr_prioridade) AS select	ei.ie_estrutura,
	a.cd_procedimento,
	a.ie_origem_proced,
	null nr_seq_material,
	ei.nr_seq_estrutura,
	4 nr_prioridade
FROM	pls_ocorrencia_estrutura	oe,
	pls_ocorrencia_estrut_item	ei,
	procedimento 			a
where	oe.ie_situacao 		= 'A'
and	ei.nr_seq_estrutura	= oe.nr_sequencia
and	ei.ie_origem_proced	is not null
and	ei.cd_procedimento	is not null
and	a.ie_origem_proced	= ei.ie_origem_proced
and	a.cd_procedimento	= ei.cd_procedimento

union all

select	ei.ie_estrutura,
	p.cd_procedimento,
	p.ie_origem_proced,
	null nr_seq_material,
	ei.nr_seq_estrutura,
	3 nr_prioridade
from	pls_ocorrencia_estrutura	oe,
	pls_ocorrencia_estrut_item	ei,
	estrutura_procedimento_v	p
where	oe.ie_situacao 		= 'A'
and	ei.nr_seq_estrutura	= oe.nr_sequencia
and	ei.cd_grupo_proc	is not null
and	p.cd_grupo_proc		= ei.cd_grupo_proc

union all

select	ei.ie_estrutura,
	p.cd_procedimento,
	p.ie_origem_proced,
	null nr_seq_material,
	ei.nr_seq_estrutura,
	2 nr_prioridade
from	pls_ocorrencia_estrutura 	oe,
	pls_ocorrencia_estrut_item 	ei,
	estrutura_procedimento_v	p
where	oe.ie_situacao 		= 'A'
and	ei.nr_seq_estrutura	= oe.nr_sequencia
and	ei.cd_especialidade	is not null
and	p.cd_especialidade	= ei.cd_especialidade

union all

select	ei.ie_estrutura,
	p.cd_procedimento,
	p.ie_origem_proced,
	null nr_seq_material,
	ei.nr_seq_estrutura,
	1 nr_prioridade
from	pls_ocorrencia_estrutura	oe,
	pls_ocorrencia_estrut_item 	ei,
	estrutura_procedimento_v	p
where	oe.ie_situacao 		= 'A'
and	ei.nr_seq_estrutura	= oe.nr_sequencia
and	ei.cd_area_procedimento	is not null
and	p.cd_area_procedimento	= ei.cd_area_procedimento

union all

/* Para os casos onde a regra Ã© vazia, tem que ligar com todos os procedimentos */

select	ei.ie_estrutura,
	a.cd_procedimento,
	a.ie_origem_proced,
	null nr_seq_material,
	ei.nr_seq_estrutura,
	0 nr_prioridade
from	pls_ocorrencia_estrutura	oe,
	pls_ocorrencia_estrut_item	ei,
	procedimento			a
where	oe.ie_situacao 		= 'A'
and	ei.nr_seq_estrutura	= oe.nr_sequencia
and	ei.cd_procedimento 	is null
and	ei.cd_especialidade 	is null
and	ei.cd_area_procedimento is null
and	ei.cd_grupo_proc 	is null
and	ei.nr_seq_estrut_mat	is null
and	ei.nr_seq_material	is null

union all

select	ei.ie_estrutura,
	null cd_procedimento,
	null ie_origem_proced,
	m.nr_sequencia nr_seq_material,
	ei.nr_seq_estrutura,
	201 nr_prioridade
from	pls_ocorrencia_estrutura	oe,
	pls_ocorrencia_estrut_item	ei,
	pls_material			m
where	oe.ie_situacao 		= 'A'
and	ei.nr_seq_estrutura	= oe.nr_sequencia
and	ei.nr_seq_material	is not null
and	m.nr_sequencia		= ei.nr_seq_material

union all

select	ei.ie_estrutura,
	null cd_procedimento,
	null ie_origem_proced,
	m.nr_seq_material nr_seq_material,
	ei.nr_seq_estrutura,
	200 nr_prioridade
from	pls_ocorrencia_estrutura	oe,
	pls_ocorrencia_estrut_item	ei,
	pls_estrutura_material_tm	m
where	oe.ie_situacao 		= 'A'
and	ei.nr_seq_estrutura	= oe.nr_sequencia
and	ei.nr_seq_estrut_mat	is not null
and	m.nr_seq_estrutura	= ei.nr_seq_estrut_mat

union all

select	ei.ie_estrutura,
	null cd_procedimento,
	null ie_origem_proced,
	m.nr_sequencia nr_seq_material,
	ei.nr_seq_estrutura,
	199 nr_prioridade
from	pls_ocorrencia_estrutura	oe,
	pls_ocorrencia_estrut_item	ei,
	pls_material			m
where	oe.ie_situacao 		= 'A'
and	ei.nr_seq_estrutura	= oe.nr_sequencia
and	ei.cd_procedimento 	is null
and	ei.cd_especialidade 	is null
and	ei.cd_area_procedimento is null
and	ei.cd_grupo_proc 	is null
and	ei.nr_seq_estrut_mat	is null
and	ei.nr_seq_material	is null;

