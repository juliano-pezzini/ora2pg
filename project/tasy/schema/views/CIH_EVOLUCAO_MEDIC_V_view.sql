-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW cih_evolucao_medic_v (nr_altas, nr_dias_int, nr_dias_utilizacao, cd_tipo_evolucao, ds_tipo_evolucao, dt_alta) AS select     count(distinct a.nr_ficha_ocorrencia) nr_altas,
	sum((trunc(a.dt_alta) - trunc(a.dt_entrada)) + 1) nr_dias_int,
	sum(0) nr_dias_utilizacao,
	a.cd_tipo_evolucao,
	b.ds_tipo_evolucao,
	a.dt_alta
FROM       cih_tipo_evolucao b,
   cih_ficha_ocorrencia_v a
where      a.cd_tipo_evolucao = b.cd_tipo_evolucao
group by a.dt_alta,
	a.cd_tipo_evolucao,
	b.ds_tipo_evolucao

UNION

select sum(0) nr_altas,
	sum(0) nr_dias_int,
	sum((trunc(d.dt_final_utilizacao) - trunc(d.dt_inicial_utilizacao)) + 1) nr_dias_utilizacao,
	c.cd_tipo_evolucao,
	e.ds_tipo_evolucao,
	c.dt_alta
from       cih_tipo_evolucao e,
   cih_medic_utilizado d,
   cih_ficha_ocorrencia_v c
where      c.nr_ficha_ocorrencia = d.nr_ficha_ocorrencia
  and      c.cd_tipo_evolucao = e.cd_tipo_evolucao
group by c.dt_alta,
	c.cd_tipo_evolucao,
	e.ds_tipo_evolucao;

