-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW item_aprovacao_pendente_v (ie_tipo, ds_tipo, nr_sequencia, nr_seq_item, cd_material, cd_unidade_medida_compra, vl_material, qt_material, ie_situacao, qt_entregue, pr_descontos, cd_local_estoque, ds_material_direto, nr_seq_aprovacao, dt_aprovacao, dt_aprovacao_orig, dt_desdobr_aprov, dt_reprovacao_orig, ds_material, vl_total, cd_centro_custo, cd_conta_contabil, nm_usuario, dt_atualizacao, ie_geracao, ds_observacao, ie_padronizado, ie_consignado, nm_solicitante, dt_liberacao_solic, ds_condicao_pagamento, nm_fornecedor, ds_diferenca, vl_ultima_compra, dt_ultima_compra, qt_ultima_compra, cd_unidade_ultima_compra, ds_fornec_ultima_compra, ds_centro_custo, vl_custo_medio, vl_custo_total, vl_preco_venda, ie_forma_compra, vl_margem, qt_fornecedor, qt_fornecedor_preco, ds_processo_aprov, vl_total_compra, vl_tot_qt_ult_compra, qt_estoque, cd_conta_contabil_item, ie_tipo_servico, dt_baixa, vl_tributos) AS select	'O' ie_tipo,
	wheb_mensagem_pck.get_texto(320223) ds_tipo,
	o.nr_ordem_compra nr_sequencia,
	o.nr_item_oci nr_seq_item,
	o.cd_material,
	o.cd_unidade_medida_compra,
	o.vl_unitario_material vl_material,
	obter_qt_pend_ordem_entrega(o.nr_ordem_compra, o.nr_item_oci) qt_material,
	o.ie_situacao,
	o.qt_material_entregue qt_entregue,
	o.pr_descontos,
	o.cd_local_estoque,
	substr(o.ds_material_direto,1,255) ds_material_direto,
	o.nr_seq_aprovacao,
	o.dt_aprovacao,
	o.dt_aprovacao_orig,
	o.dt_desdobr_aprov,
	o.dt_reprovacao_orig,
	m.ds_material,
	(o.qt_material * o.vl_unitario_material) vl_total,
	o.cd_centro_custo,
	o.cd_conta_contabil,
	o.nm_usuario,
	o.dt_atualizacao,
	o.ie_geracao_solic ie_geracao,
	o.ds_observacao,obter_se_material_padronizado(p.cd_estabelecimento,o.cd_material) ie_padronizado,
	CASE WHEN m.ie_consignado='0' THEN  'N'  ELSE 'S' END  ie_consignado,
	substr(obter_nome_pessoa_fisica(coalesce(o.cd_pessoa_solicitante,p.cd_pessoa_solicitante), null),1,200) nm_solicitante,
	s.dt_liberacao dt_liberacao_solic,
	c.ds_condicao_pagamento,
	substr(obter_nome_pf_pj(p.cd_pessoa_fisica, p.cd_cgc_fornecedor),1,80) nm_fornecedor,
	substr(obter_diferenca_ordem_solic(o.nr_ordem_compra, o.nr_item_oci),1,255) ds_diferenca,
	(obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_liberacao, 9999, 'VU'))::numeric  vl_ultima_compra,
	substr(obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_liberacao, 9999, 'DT'),1,255) dt_ultima_compra,	
	(obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_liberacao, 9999, 'QT'))::numeric  qt_ultima_compra,
	substr(obter_dados_ultima_compra(p.cd_estabelecimento, o.cd_material, 'UC'),1,5) cd_unidade_ultima_compra,
	substr(obter_nome_pf_pj(null, obter_fornecedor_ultima_compra(o.cd_material, p.cd_estabelecimento)),1,80) ds_fornec_ultima_compra,
	substr(obter_desc_centro_custo(o.cd_centro_custo),1,100) ds_centro_custo,
	obter_custo_medio_material(p.cd_estabelecimento, trunc(LOCALTIMESTAMP,'mm'), o.cd_material) vl_custo_medio,
	(obter_custo_medio_material(p.cd_estabelecimento, trunc(LOCALTIMESTAMP,'mm'), o.cd_material) * o.qt_material) vl_custo_total,
	0 vl_preco_venda,lic_obter_tipo_forma_compra(obter_forma_compra_ordem(o.nr_ordem_compra)) ie_forma_compra,
	0 vl_margem,
	obter_qt_forn_cot_item(o.nr_cot_compra, o.nr_item_cot_compra, 0) qt_fornecedor,
	obter_qt_forn_cot_item(o.nr_cot_compra, o.nr_item_cot_compra, 1) qt_fornecedor_preco,
	substr(obter_processo_aprov_compra(o.nr_seq_aprovacao),1,150) ds_processo_aprov,
	((obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_liberacao, 9999, 'VUQT'))::numeric ) vl_total_compra,
	((obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_liberacao, 9999, 'VU'))::numeric  * o.qt_material) vl_tot_qt_ult_compra,
	obter_saldo_disp_estoque(p.cd_estabelecimento, o.cd_material, null, trunc(LOCALTIMESTAMP,'mm')) qt_estoque,
	o.cd_conta_contabil cd_conta_contabil_item,
	null ie_tipo_servico,
	null dt_baixa,
	obter_vl_trib_oci(o.nr_ordem_compra, o.nr_item_oci) vl_tributos
FROM ordem_compra p, material m, condicao_pagamento c, ordem_compra_item o
LEFT OUTER JOIN solic_compra s ON (o.nr_solic_compra = s.nr_solic_compra)
WHERE m.cd_material      = o.cd_material and o.nr_ordem_compra  = p.nr_ordem_compra  and obter_qt_pend_ordem_entrega(o.nr_ordem_compra, o.nr_item_oci) > 0 and p.cd_condicao_pagamento = c.cd_condicao_pagamento
 
union

select	'S' ie_tipo,
	wheb_mensagem_pck.get_texto(320224) ds_tipo,
	o.nr_solic_compra nr_sequencia,
	o.nr_item_solic_compra nr_seq_item,
	o.cd_material,
	o.cd_unidade_medida_compra,
	coalesce(o.vl_unit_previsto,0) vl_material,
	o.qt_material,
	o.ie_situacao,
	0 qt_entregue,
	0 pr_descontos,
	p.cd_local_estoque,
	substr(o.ds_material_direto,1,255) ds_material_direto,
	o.nr_seq_aprovacao,
	o.dt_autorizacao dt_aprovacao,
	null dt_aprovacao_orig,
	o.dt_desdobr_aprov,
	null dt_reprovacao_orig,
	m.ds_material,
	(o.qt_material * coalesce(o.vl_unit_previsto,0)) vl_total,
	p.cd_centro_custo,
	p.cd_conta_contabil,
	p.nm_usuario,
	o.dt_atualizacao,
	o.ie_geracao,
	o.ds_observacao,obter_se_material_padronizado(p.cd_estabelecimento,o.cd_material) ie_padronizado,
	CASE WHEN m.ie_consignado='0' THEN  'N'  ELSE 'S' END  ie_consignado,
	substr(obter_nome_pessoa_fisica(p.cd_pessoa_solicitante, null),1,200) nm_solicitante,
	p.dt_liberacao dt_liberacao_solic,
	'',
	'',
	'',
	(obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_liberacao, 9999, 'VU'))::numeric  vl_ultima_compra,
	substr(obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_liberacao, 9999, 'DT'),1,255) dt_ultima_compra,
	(obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_liberacao, 9999, 'QT'))::numeric  qt_ultima_compra,
	substr(obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_liberacao, 9999, 'UC'),1,5) cd_unidade_ultima_compra,
	substr(obter_nome_pf_pj(null, obter_fornecedor_ultima_compra(o.cd_material, p.cd_estabelecimento)),1,80) ds_fornec_ultima_compra,
	substr(obter_desc_centro_custo(p.cd_centro_custo),1,100) ds_centro_custo,
	obter_custo_medio_item_solic(o.nr_solic_compra,o.nr_item_solic_compra) vl_custo_medio,
	(obter_custo_medio_item_solic(o.nr_solic_compra,o.nr_item_solic_compra) * qt_material) vl_custo_total,
	0 vl_preco_venda,  lic_obter_tipo_forma_compra(lic_obter_forma_compra_solic(o.nr_solic_compra)) ie_forma_compra,
	0 vl_margem,
	0 qt_fornecedor,
	0 qt_fornecedor_preco,
	substr(obter_processo_aprov_compra(o.nr_seq_aprovacao),1,150) ds_processo_aprov,
	((obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_liberacao, 9999, 'VUQT'))::numeric ) vl_total_compra,
	((obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_liberacao, 9999, 'VU'))::numeric  * (o.qt_material)) vl_tot_qt_ult_compra,
	obter_saldo_disp_estoque(p.cd_estabelecimento, o.cd_material, null, trunc(LOCALTIMESTAMP,'mm')) qt_estoque,
	o.cd_conta_contabil cd_conta_contabil_item,
	p.ie_tipo_servico,
	null dt_baixa,
	null vl_tributos
from	solic_compra_item o,
	solic_compra p,
	material m
where	m.cd_material = o.cd_material
and	o.nr_solic_compra = p.nr_solic_compra

union

select	'R' ie_tipo,
	wheb_mensagem_pck.get_texto(320225) ds_tipo,
	o.nr_requisicao nr_sequencia,
	o.nr_sequencia nr_seq_item,
	o.cd_material,
	o.cd_unidade_medida,
	coalesce(o.vl_unit_previsto,0) vl_material,
	o.qt_material_requisitada,
	'A',
	0 qt_entregue,
	0 pr_descontos,
	p.cd_local_estoque,
	'' ds_material_direto,
	o.nr_seq_aprovacao,
	o.dt_aprovacao dt_aprovacao,
	null dt_aprovacao_orig,
	o.dt_desdobr_aprov,
	null dt_reprovacao_orig,
	m.ds_material,
	(o.qt_material_requisitada * coalesce(o.vl_unit_previsto,0)) vl_total,
	p.cd_centro_custo,
	null,
	p.nm_usuario,
	o.dt_atualizacao,
	o.ie_geracao,
	o.ds_observacao,obter_se_material_padronizado(p.cd_estabelecimento,o.cd_material) ie_padronizado,
	CASE WHEN m.ie_consignado='0' THEN  'N'  ELSE 'S' END  ie_consignado,
	substr(obter_nome_pessoa_fisica(p.cd_pessoa_requisitante, null),1,200) nm_solicitante,
	p.dt_liberacao dt_liberacao_solic,
	'',
	'',
	'',
	(obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_liberacao, 9999, 'VU'))::numeric  vl_ultima_compra,
	substr(obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_liberacao, 9999, 'DT'),1,255) dt_ultima_compra,
	(obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_liberacao, 9999, 'QT'))::numeric  qt_ultima_compra,
	substr(obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_liberacao, 9999, 'UC'),1,5) cd_unidade_ultima_compra,
	substr(obter_nome_pf_pj(null, obter_fornecedor_ultima_compra(o.cd_material, p.cd_estabelecimento)),1,80) ds_fornec_ultima_compra,
	substr(obter_desc_centro_custo(p.cd_centro_custo),1,100) ds_centro_custo,
	obter_custo_medio_material(p.cd_estabelecimento, trunc(LOCALTIMESTAMP,'mm'), o.cd_material) vl_custo_medio,
	(obter_custo_medio_material(p.cd_estabelecimento, trunc(LOCALTIMESTAMP,'mm'), o.cd_material) * o.qt_material_requisitada) vl_custo_total,
	0 vl_preco_venda, null ie_forma_compra,
	0 vl_margem,
	0 qt_fornecedor,
	0 qt_fornecedor_preco,
	substr(obter_processo_aprov_compra(o.nr_seq_aprovacao),1,150) ds_processo_aprov,
	((obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_liberacao, 9999, 'VUQT'))::numeric ) vl_total_compra,
	((obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_liberacao, 9999, 'VU'))::numeric  * (o.qt_material_requisitada)) vl_tot_qt_ult_compra,
	obter_saldo_disp_estoque(p.cd_estabelecimento, o.cd_material, null, trunc(LOCALTIMESTAMP,'mm')) qt_estoque,
	null,
	null,
	null dt_baixa,
	null vl_tributos
from	item_requisicao_material o,
	requisicao_material p,
	material m
where	m.cd_material = o.cd_material
and	o.nr_requisicao = p.nr_requisicao

union

select	'N' ie_tipo,
	wheb_mensagem_pck.get_texto(320227) ds_tipo,
	o.nr_sequencia nr_sequencia,
	o.nr_item_nf nr_seq_item,
	o.cd_material,
	o.cd_unidade_medida_compra,
	coalesce(o.vl_unitario_item_nf,0) vl_material,
	o.qt_item_nf,
	'A',
	0 qt_entregue,
	o.pr_desconto,
	o.cd_local_estoque,
	'' ds_material_direto,
	o.nr_seq_aprovacao,
	o.dt_aprovacao dt_aprovacao,
	null dt_aprovacao_orig,
	null dt_desdobr_aprov,
	null dt_reprovacao_orig,
	m.ds_material,
	(o.qt_item_nf * coalesce(o.vl_unitario_item_nf,0)) vl_total,
	o.cd_centro_custo,
	o.cd_conta_contabil,
	p.nm_usuario,
	o.dt_atualizacao,
	null ie_geracao,
	o.ds_observacao,obter_se_material_padronizado(p.cd_estabelecimento,o.cd_material) ie_padronizado,
	CASE WHEN m.ie_consignado='0' THEN  'N'  ELSE 'S' END  ie_consignado,
	'' nm_solicitante,
	p.dt_liberacao dt_liberacao_solic,
	substr(obter_desc_cond_pagto(p.cd_condicao_pagamento),1,100),
	substr(obter_nome_pf_pj(p.cd_pessoa_fisica, p.cd_cgc_emitente),1,80) nm_fornecedor,
	'',
	(obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_emissao, 9999, 'VU'))::numeric  vl_ultima_compra,
	substr(obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_emissao, 9999, 'DT'),1,255) dt_ultima_compra,
	(obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_emissao, 9999, 'QT'))::numeric  qt_ultima_compra,
	substr(obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_emissao, 9999, 'UC'),1,5) cd_unidade_ultima_compra,
	substr(obter_nome_pf_pj(null, obter_fornecedor_ultima_compra(o.cd_material, p.cd_estabelecimento)),1,80) ds_fornec_ultima_compra,
	substr(obter_desc_centro_custo(o.cd_centro_custo),1,100) ds_centro_custo,
	obter_custo_medio_material(p.cd_estabelecimento, trunc(LOCALTIMESTAMP,'mm'), o.cd_material) vl_custo_medio,
	(obter_custo_medio_material(p.cd_estabelecimento, trunc(LOCALTIMESTAMP,'mm'), o.cd_material) * o.qt_item_nf) vl_custo_total,
	0 vl_preco_venda, null ie_forma_compra,
	0 vl_margem,
	0 qt_fornecedor,
	0 qt_fornecedor_preco,
	substr(obter_processo_aprov_compra(o.nr_seq_aprovacao),1,150) ds_processo_aprov,
	((obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_emissao, 9999, 'VUQT'))::numeric ) vl_total_compra,
	((obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_emissao, 9999, 'VU'))::numeric  * (o.qt_item_nf)) vl_tot_qt_ult_compra,
	obter_saldo_disp_estoque(p.cd_estabelecimento, o.cd_material, null, trunc(LOCALTIMESTAMP,'mm')) qt_estoque,
	o.cd_conta_contabil cd_conta_contabil_item,
	null,
	null dt_baixa,
	null vl_tributos
from	nota_fiscal_item o,
	nota_fiscal p,
	material m
where	m.cd_material = o.cd_material
and	o.nr_sequencia = p.nr_sequencia

union

select	'C' ie_tipo,
	wheb_mensagem_pck.get_texto(320226) ds_tipo,
	o.nr_cot_compra nr_sequencia,
	o.nr_item_cot_compra nr_seq_item,
	m.cd_material,
	o.cd_unidade_medida_compra,
	coalesce(r.vl_unitario_material,0) vl_material,
	r.qt_material,
	'A',
	0 qt_entregue,
	r.pr_desconto,
	(obter_dados_solic_item_cot(o.nr_cot_compra, o.nr_item_cot_compra, 'L'))::numeric  cd_local_estoque,
	o.ds_material_direto_w,
	o.nr_seq_aprovacao,
	o.dt_aprovacao dt_aprovacao,
	null dt_aprovacao_orig,
	o.dt_desdobr_aprov,
	null dt_reprovacao_orig,
	m.ds_material,
	coalesce(r.vl_preco_liquido,0) vl_total,
	(obter_dados_solic_item_cot(o.nr_cot_compra, o.nr_item_cot_compra, 'C'))::numeric  cd_centro_custo,
	substr(obter_conta_cont_item_cot(o.nr_cot_compra, o.nr_item_cot_compra),1,100),
	p.nm_usuario,
	o.dt_atualizacao,
	null ie_geracao,
	null, obter_se_material_padronizado(p.cd_estabelecimento,m.cd_material) ie_padronizado,
	CASE WHEN m.ie_consignado='0' THEN  'N'  ELSE 'S' END  ie_consignado,
	substr(coalesce(obter_dados_solic_compra(o.nr_solic_compra,'1'),obter_nome_pessoa_fisica(p.cd_pessoa_solicitante, null)),1,200) nm_solicitante,
	p.dt_calculo_cotacao dt_liberacao_solic,
	substr(obter_desc_cond_pagto(f.cd_condicao_pagamento),1,100),
	substr(obter_nome_pf_pj(f.cd_pessoa_fisica, f.cd_cgc_fornecedor),1,100),
	'',
	(obter_dados_ult_compra_data(p.cd_estabelecimento, m.cd_material, null, p.dt_cot_compra, 9999, 'VU'))::numeric  vl_ultima_compra,
	substr(obter_dados_ult_compra_data(p.cd_estabelecimento, m.cd_material, null, p.dt_cot_compra, 9999, 'DT'),1,255) dt_ultima_compra,
	(obter_dados_ult_compra_data(p.cd_estabelecimento, m.cd_material, null, p.dt_cot_compra, 9999, 'QT'))::numeric  qt_ultima_compra,
	substr(obter_dados_ult_compra_data(p.cd_estabelecimento, m.cd_material, null, p.dt_cot_compra, 9999, 'UC'),1,5) cd_unidade_ultima_compra,
	substr(obter_nome_pf_pj(null, obter_fornecedor_ultima_compra(m.cd_material, p.cd_estabelecimento)),1,80) ds_fornec_ultima_compra,
	substr(obter_desc_centro_custo(obter_dados_solic_item_cot(o.nr_cot_compra, o.nr_item_cot_compra, 'C')),1,100) ds_centro_custo,
	obter_custo_medio_material(p.cd_estabelecimento, trunc(LOCALTIMESTAMP,'mm'), m.cd_material) vl_custo_medio,
	(obter_custo_medio_material(p.cd_estabelecimento, trunc(LOCALTIMESTAMP,'mm'), m.cd_material) * o.qt_material) vl_custo_total,
	0 vl_preco_venda, lic_obter_tipo_forma_compra(obter_forma_compra_cotacao(o.nr_cot_compra)) ie_forma_compra,
	0 vl_margem,
	obter_qt_forn_cot_item(o.nr_cot_compra, o.nr_item_cot_compra, 0) qt_fornecedor,
	obter_qt_forn_cot_item(o.nr_cot_compra, o.nr_item_cot_compra, 1) qt_fornecedor_preco,
	substr(obter_processo_aprov_compra(o.nr_seq_aprovacao),1,150) ds_processo_aprov,
	((obter_dados_ult_compra_data(p.cd_estabelecimento, m.cd_material, null, p.dt_cot_compra, 9999, 'VUQT'))::numeric ) vl_total_compra,
	((obter_dados_ult_compra_data(p.cd_estabelecimento, m.cd_material, null, p.dt_cot_compra, 9999, 'VU'))::numeric  * (o.qt_material)) vl_tot_qt_ult_compra,
	obter_saldo_disp_estoque(p.cd_estabelecimento, m.cd_material, null, trunc(LOCALTIMESTAMP,'mm')) qt_estoque,
	null,
	null,
	null dt_baixa,
	null vl_tributos
from	cot_compra_item o,
	cot_compra p,
	material m,
	cot_compra_resumo r,
	cot_compra_forn f,
	cot_compra_forn_item i
where	m.cd_material = i.cd_material
and	o.nr_cot_compra = p.nr_cot_compra
and	o.nr_cot_compra = r.nr_cot_compra
and	o.nr_item_cot_compra = r.nr_item_cot_compra
and	p.nr_cot_compra = f.nr_cot_compra
and	r.nr_seq_cot_forn = f.nr_sequencia
and	i.nr_sequencia = r.nr_seq_cot_item_forn

union

select	'L' ie_tipo,
	wheb_mensagem_pck.get_texto(149965) ds_tipo,
	o.nr_seq_licitacao nr_sequencia,
	o.nr_seq_lic_item nr_seq_item,
	o.cd_material,
	o.cd_unid_medida,
	o.vl_maximo_edital vl_material,
	o.qt_item,
	'A',
	null qt_entregue,
	null,
	null,
	null,
	o.nr_seq_aprovacao,
	o.dt_aprovacao,
	null,
	o.dt_desdobr_aprov,
	null,
	m.ds_material,
	(o.qt_item * o.vl_maximo_edital) vl_total,
	null,
	null,
	o.nm_usuario,
	o.dt_atualizacao,
	null,
	substr(DS_ADICIONAL,1,255), obter_se_material_padronizado(p.cd_estabelecimento,o.cd_material) ie_padronizado,
	CASE WHEN m.ie_consignado='0' THEN  'N'  ELSE 'S' END  ie_consignado,
	null nm_solicitante,
	p.dt_lib_aprovacao,
	null,
	null,
	null,
	(obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_emissao, 9999, 'VU'))::numeric  vl_ultima_compra,
	substr(obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_emissao, 9999, 'DT'),1,255) dt_ultima_compra,
	(obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_emissao, 9999, 'QT'))::numeric  qt_ultima_compra,
	substr(obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_emissao, 9999, 'UC'),1,5) cd_unidade_ultima_compra,
	substr(obter_nome_pf_pj(null, obter_fornecedor_ultima_compra(o.cd_material, p.cd_estabelecimento)),1,80) ds_fornec_ultima_compra,
	null,
	obter_custo_medio_material(p.cd_estabelecimento, trunc(LOCALTIMESTAMP,'mm'), o.cd_material) vl_custo_medio,
	(obter_custo_medio_material(p.cd_estabelecimento, trunc(LOCALTIMESTAMP,'mm'), o.cd_material) * o.qt_item) vl_custo_total,
	0 vl_preco_venda,null,
	0 vl_margem,
	null,
	null,
	substr(obter_processo_aprov_compra(o.nr_seq_aprovacao),1,150) ds_processo_aprov,
	((obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_emissao, 9999, 'VUQT'))::numeric ) vl_total_compra,
	((obter_dados_ult_compra_data(p.cd_estabelecimento, o.cd_material, null, p.dt_emissao, 9999, 'VU'))::numeric  * o.qt_item) vl_tot_qt_ult_compra,
	obter_saldo_disp_estoque(p.cd_estabelecimento, o.cd_material, null, trunc(LOCALTIMESTAMP,'mm')) qt_estoque,
	null,
	null ie_tipo_servico,
	null dt_baixa,
	null vl_tributos
from	reg_licitacao p,  
	reg_lic_item o,
	material m
where	m.cd_material      = o.cd_material
and	o.nr_seq_licitacao  = p.nr_sequencia

union

select	'G' ie_tipo,
	wheb_mensagem_pck.get_texto(1172274) ds_tipo,
	o.nr_sequencia nr_sequencia,
	o.nr_sequencia nr_seq_item,
	null cd_material,
	null cd_unid_medida,
	coalesce(o.vl_total_contrato,0) vl_material,
	0 qt_item,
	'A' ie_situacao,
	null qt_entregue,
	null pr_descontos,
	null cd_local_estoque,
	null ds_material_direto,
	o.nr_seq_aprovacao,
	o.dt_aprovacao,
	null dt_aprovacao_orig,
	o.dt_desdobr_aprov,
	null dt_reprovacao_orig,
	null ds_material,
	coalesce(o.vl_total_contrato,0) vl_total,
	null cd_centro_custo,
	null cd_conta_contabil,
	o.nm_usuario,
	o.dt_atualizacao,
	null ie_geracao,
	o.ds_observacao,
	null ie_padronizado,
	null ie_consignado,
	substr(obter_dados_processo_compra(o.nr_seq_aprovacao,'NS'),1,255) nm_solicitante,
	o.dt_liberacao dt_liberacao_solic,
	null ds_condicao_pagamento,
	substr(CASE WHEN o.cd_cgc_contratado IS NULL THEN obter_nome_pf(o.cd_pessoa_contratada)  ELSE obter_razao_social(o.cd_cgc_contratado) END ,1,255) nm_fornecedor,
	null ds_diferenca,
	0 vl_ultima_compra,
	null dt_ultima_compra,
	0 qt_ultima_compra,
	null cd_unidade_ultima_compra,
	null ds_fornec_ultima_compra,
	null ds_centro_custo,
	coalesce(o.vl_total_contrato,0) vl_custo_medio,
	coalesce(o.vl_total_contrato,0) vl_custo_total,
	0 vl_preco_venda,
	null ie_forma_compra,
	0 vl_margem,
	null qt_fornecedor,
	null qt_fornecedor_preco,
	substr(obter_processo_aprov_compra(o.nr_seq_aprovacao),1,150) ds_processo_aprov,
	coalesce(o.vl_total_contrato,0) vl_total_compra,
	0 vl_tot_qt_ult_compra,
	0 qt_estoque,
	null cd_conta_contabil_item,
	null ie_tipo_servico,
	null dt_baixa,
	0 vl_tributos
from	contrato o

union

select	'E' ie_tipo,
	wheb_mensagem_pck.get_texto(1206356) ds_tipo,
	o.nr_sequencia nr_sequencia,
	o.nr_sequencia nr_seq_item,
	null cd_material,
	null cd_unid_medida,
	coalesce(o.vl_projeto,0) vl_material,
	0 qt_item,
	'A' ie_situacao,
	null qt_entregue,
	null pr_descontos,
	null cd_local_estoque,
	null ds_material_direto,
	o.nr_seq_aprovacao,
	o.dt_aprovacao,
	null dt_aprovacao_orig,
	o.dt_desdobr_aprov,
	null dt_reprovacao_orig,
	null ds_material,
	coalesce(o.vl_projeto,0) vl_total,
	o.cd_centro_custo,
	null cd_conta_contabil,
	o.nm_usuario,
	o.dt_atualizacao,
	null ie_geracao,
	o.ds_observacao,
	null ie_padronizado,
	null ie_consignado,
	substr(obter_dados_processo_compra(o.nr_seq_aprovacao,'NS'),1,255) nm_solicitante,
	o.dt_liberacao dt_liberacao_solic,
	null ds_condicao_pagamento,
	null nm_fornecedor,
	null ds_diferenca,
	0 vl_ultima_compra,
	null dt_ultima_compra,
	0 qt_ultima_compra,
	null cd_unidade_ultima_compra,
	null ds_fornec_ultima_compra,
	substr(obter_desc_centro_custo(o.cd_centro_custo),1,100) ds_centro_custo,
	coalesce(o.vl_projeto,0) vl_custo_medio,
	coalesce(o.vl_projeto,0) vl_custo_total,
	0 vl_preco_venda,
	null ie_forma_compra,
	0 vl_margem,
	null qt_fornecedor,
	null qt_fornecedor_preco,
	substr(obter_processo_aprov_compra(o.nr_seq_aprovacao),1,150) ds_processo_aprov,
	coalesce(o.vl_projeto,0) vl_total_compra,
	0 vl_tot_qt_ult_compra,
	0 qt_estoque,
	null cd_conta_contabil_item,
	null ie_tipo_servico,
	null dt_baixa,
	0 vl_tributos
from	projeto_recurso o;

