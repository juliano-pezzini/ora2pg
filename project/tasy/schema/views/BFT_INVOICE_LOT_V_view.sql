-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW bft_invoice_lot_v (nr_sequence, cd_gtr, nr_municipaly_registration, nr_seq_transmission) AS SELECT 	l.nr_sequencia 									NR_SEQUENCE,
	lpad(a.cd_cgc_emitente, 14, '0') 						CD_GTR,
	coalesce(substr(obter_dados_pf_pj('', a.cd_cgc_emitente, 'IM'), 1, 30), '99999') 	NR_MUNICIPALY_REGISTRATION,
	t.nr_sequencia 									NR_SEQ_TRANSMISSION
FROM 	nota_fiscal a,
	nota_fiscal_lote_nfe l,
	nfe_transmissao_nf n,
	nfe_transmissao t,
	estabelecimento_v e
WHERE 	l.nr_seq_transmissao = t.nr_sequencia
	AND t.nr_sequencia = n.nr_seq_transmissao
	AND a.nr_sequencia = n.nr_seq_nota_fiscal
	AND a.cd_estabelecimento = e.cd_estabelecimento;

