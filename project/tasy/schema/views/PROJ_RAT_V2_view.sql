-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW proj_rat_v2 (nr_sequencia, nr_seq_cliente, dt_atualizacao, nm_usuario, cd_executor, dt_inicio, dt_final, dt_liberacao, nm_usuario_lib, dt_aprovacao, nm_usuario_aprov, qt_total_hora, vl_hora_cobrar, qt_hora_cobrar, vl_cobrar_cliente, vl_hora_pagar, qt_hora_pagar, vl_pagar, nr_titulo_rec, nr_titulo_pagar, nr_seq_nf, nr_ordem_compra, dt_prev_nf, ie_status_cobrar, ie_paga_rat, dt_atualizacao_nrec, nm_usuario_nrec, dt_receb_rat, nm_usuario_receb, nr_seq_canal, qt_dia_exec, qt_dia_reg, ie_funcao_exec, nr_seq_proj, vl_imposto, vl_adicional_clt, vl_custo_inst, vl_fixo_consultor, dt_rec_fin, dt_aprov_fin, nr_seq_fech_mes, ie_status_rat, ie_regime_contr, nr_seq_cronograma, ie_faturado, ds_cliente, nm_consultor, dt_ordem_compra, dt_nf_cobrar, dt_nf_pagar, nr_nf_oc) AS select a.NR_SEQUENCIA,a.NR_SEQ_CLIENTE,a.DT_ATUALIZACAO,a.NM_USUARIO,a.CD_EXECUTOR,a.DT_INICIO,a.DT_FINAL,a.DT_LIBERACAO,a.NM_USUARIO_LIB,a.DT_APROVACAO,a.NM_USUARIO_APROV,a.QT_TOTAL_HORA,a.VL_HORA_COBRAR,a.QT_HORA_COBRAR,a.VL_COBRAR_CLIENTE,a.VL_HORA_PAGAR,a.QT_HORA_PAGAR,a.VL_PAGAR,a.NR_TITULO_REC,a.NR_TITULO_PAGAR,a.NR_SEQ_NF,a.NR_ORDEM_COMPRA,a.DT_PREV_NF,a.IE_STATUS_COBRAR,a.IE_PAGA_RAT,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC,a.DT_RECEB_RAT,a.NM_USUARIO_RECEB,a.NR_SEQ_CANAL,a.QT_DIA_EXEC,a.QT_DIA_REG,a.IE_FUNCAO_EXEC,a.NR_SEQ_PROJ,a.VL_IMPOSTO,a.VL_ADICIONAL_CLT,a.VL_CUSTO_INST,a.VL_FIXO_CONSULTOR,a.DT_REC_FIN,a.DT_APROV_FIN,a.NR_SEQ_FECH_MES,a.IE_STATUS_RAT,a.IE_REGIME_CONTR,a.NR_SEQ_CRONOGRAMA,a.IE_FATURADO,
	(select substr(max(x.ds_razao_social),1,1254) FROM pessoa_juridica x where x.cd_cgc =  (select max(y.cd_cnpj) from com_cliente y where y.nr_sequencia = a.nr_seq_cliente)) ds_cliente,
	(select max(x.nm_pessoa_fisica) from pessoa_fisica x	where x.cd_pessoa_fisica = a.cd_executor) nm_consultor,
	(select max(dt_ordem_compra) from ordem_compra b where b.nr_ordem_compra = a.nr_ordem_compra) dt_ordem_compra,
	(select max(dt_emissao) from nota_fiscal b where b.nr_sequencia = a.nr_seq_nf) dt_nf_cobrar,
	(select max(b.dt_emissao) from nota_fiscal b, nota_fiscal_item c where b.nr_sequencia = c.nr_sequencia and c.nr_ordem_compra = a.nr_ordem_compra) dt_nf_pagar,
	(select max(b.nr_nota_fiscal) from nota_fiscal b, nota_fiscal_item c where b.nr_sequencia = c.nr_sequencia and c.nr_ordem_compra = a.nr_ordem_compra) nr_nf_oc
from proj_Rat a;

