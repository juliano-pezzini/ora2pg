-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW sip_recurso_glosa_mat_v (nr_seq_rec_protocolo, nr_seq_rec_conta, nr_seq_rec_mat, nr_seq_protocolo, nr_seq_conta, nr_seq_conta_mat, vl_liberado, dt_mes_competencia) AS select	a.nr_sequencia nr_seq_rec_protocolo,
	b.nr_sequencia nr_seq_rec_conta,
	c.nr_sequencia nr_seq_rec_mat,
	b.nr_seq_protocolo,
	b.nr_seq_conta,
	c.nr_seq_conta_mat,
	c.vl_acatado vl_liberado,
	a.dt_liberacao_pag dt_mes_competencia
FROM	pls_rec_glosa_protocolo a,
	pls_rec_glosa_conta	b,
	pls_rec_glosa_mat 	c
where	-- somente busca protocolos aguardando liberação, liberados ou pagos.
	a.ie_status		in ('3','5', '6')
and	b.nr_seq_protocolo	= a.nr_sequencia
-- só entra conta de recurso já fechado.
and	b.ie_status		= '2'
and	c.nr_seq_conta_rec	= b.nr_sequencia
-- só entra item parcialmente aceito ou aceito
and	c.ie_status		in ('2', '3')
-- somente os que tenham gerado pagamento
and	c.vl_acatado		> 0;

