-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW escala_must_v (nr_sequencia, dt_atualizacao, nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec, cd_profissional, dt_liberacao, nr_atendimento, dt_avaliacao, qt_peso_habitual, qt_peso_atual, qt_perc_perda_peso, qt_altura_cm, qt_imc, qt_pontuacao, ie_reducao_alimentar, cd_perfil_ativo, ie_situacao, dt_inativacao, nm_usuario_inativacao, ds_justificativa, nr_hora, cd_setor_atendimento, ds_leito) AS select  e.NR_SEQUENCIA,e.DT_ATUALIZACAO,e.NM_USUARIO,e.DT_ATUALIZACAO_NREC,e.NM_USUARIO_NREC,e.CD_PROFISSIONAL,e.DT_LIBERACAO,e.NR_ATENDIMENTO,e.DT_AVALIACAO,e.QT_PESO_HABITUAL,e.QT_PESO_ATUAL,e.QT_PERC_PERDA_PESO,e.QT_ALTURA_CM,e.QT_IMC,e.QT_PONTUACAO,e.IE_REDUCAO_ALIMENTAR,e.CD_PERFIL_ATIVO,e.IE_SITUACAO,e.DT_INATIVACAO,e.NM_USUARIO_INATIVACAO,e.DS_JUSTIFICATIVA,e.NR_HORA,
        (select coalesce(min(a.cd_setor_atendimento),0)
         FROM   atend_paciente_unidade a
         where  a.nr_atendimento     = e.nr_atendimento
         and    a.nr_seq_interno  =   (select   coalesce(min(b.nr_seq_interno),0)
                                      from      Setor_Atendimento y,
                                                atend_paciente_unidade b
                                      where     b.nr_atendimento   = e.nr_atendimento
                                      and       b.cd_setor_atendimento  = y.cd_setor_atendimento
                                      and       coalesce(b.dt_saida_unidade, b.dt_entrada_unidade + 9999) >= e.dt_liberacao
                                      and       y.cd_setor_atendimento in (119, 103, 2, 3, 4, 47, 5)))cd_setor_atendimento,
        (select coalesce(min(a.cd_unidade_basica||' '||a.cd_unidade_compl),0)
         from   atend_paciente_unidade a
         where  a.nr_atendimento     = e.nr_atendimento
         and    a.nr_seq_interno  =   (select   coalesce(min(b.nr_seq_interno),0)
                                      from      Setor_Atendimento y,
                                                atend_paciente_unidade b
                                      where     b.nr_atendimento   = e.nr_atendimento
                                      and       b.cd_setor_atendimento  = y.cd_setor_atendimento
                                      and       coalesce(b.dt_saida_unidade, b.dt_entrada_unidade + 9999) >= e.dt_liberacao
                                      and       y.cd_setor_atendimento in (119, 103, 2, 3, 4, 47, 5)))ds_leito
from    escala_must e;

