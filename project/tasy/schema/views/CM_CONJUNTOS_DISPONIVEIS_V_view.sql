-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW cm_conjuntos_disponiveis_v (nr_sequencia, nm_conjunto, nm_conj_sem_acento, cd_setor_atendimento, cd_estabelecimento, ie_estoque) AS select	nr_sequencia,
	nm_conjunto,
	elimina_acentos(nm_conjunto) nm_conj_sem_acento,
	cd_setor_atendimento,
	cd_estabelecimento,
	CASE WHEN(select	count(*)		FROM	cm_conjunto_cont x		where	x.ie_status_conjunto = 3		and	x.dt_origem between(LOCALTIMESTAMP - interval '30 days') and LOCALTIMESTAMP		and	x.nr_seq_conjunto = a.nr_sequencia		and 	not exists (select 1 from cm_requisicao_conj y where y.nr_seq_conj_real = x.nr_sequencia))=0 THEN 'N'  ELSE 'S' END  ie_estoque
from	cm_conjunto a
where	ie_situacao = 'A'
and	(coalesce(a.ie_requisicao,'S') = 'S'
or	((select coalesce(b.ie_requisicao,'N')
	from cm_classif_conjunto b
	where b.nr_sequencia = a.nr_seq_classif) = 'S'));

