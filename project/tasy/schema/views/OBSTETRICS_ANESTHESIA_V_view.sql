-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW obstetrics_anesthesia_v (cd_tipo_anestesia, anesthesia, assessment_date, nr_atendimento, csection_births, establishment) AS SELECT
        cd_tipo_anestesia,
        obter_valor_dominio(36, cd_tipo_anestesia) anesthesia,
        p.dt_inicio_parto assessment_date,
        p.nr_atendimento,
        (SELECT COUNT(*) FROM nascimento n WHERE nr_seq_typ_del IN (6, 7, 8, 9, 10, 11)
            AND n.nr_atendimento = p.nr_Atendimento) csection_births,
        obter_nome_estabelecimento(obter_estab_atend(nr_atendimento)) establishment
    FROM parto p
    WHERE EXISTS (SELECT 1
                    FROM atendimento_paciente ap
              INNER JOIN classif_especial_paciente ce ON ce.nr_sequencia = ap.nr_seq_classif_esp
                   WHERE UPPER(ce.ds_classificacao) LIKE( 'E%' ) AND ap.nr_atendimento = p.nr_atendimento)
            AND cd_tipo_anestesia IN (3, 2, 1, 10)

UNION

    SELECT
        '',
        obter_desc_expressao(1013891) anesthesia,
        p.dt_inicio_parto assessment_date,
        p.nr_atendimento,
        0 csection_births,
        obter_nome_estabelecimento(obter_estab_atend(nr_atendimento)) establishment
    FROM parto p
    WHERE p.ie_parto_analgesia <> 'N'
      AND EXISTS (SELECT 1
                      FROM atendimento_paciente ap
                INNER JOIN classif_especial_paciente ce ON ce.nr_sequencia = ap.nr_seq_classif_esp
                     WHERE UPPER(ce.ds_classificacao) LIKE( 'E%' ) AND ap.nr_atendimento = p.nr_atendimento);

