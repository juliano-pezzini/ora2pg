-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW total_conta_convenio_v (ie_tipo_total, nr_atendimento, nr_interno_conta, nr_seq_protocolo, cd_convenio, vl_total_item, qt_total_item, qt_item, qt_conta) AS SELECT 1 IE_TIPO_TOTAL,
	 NR_ATENDIMENTO,
	 NR_INTERNO_CONTA,
	 NR_SEQ_PROTOCOLO,
	 CD_CONVENIO,
	 SUM(VL_ITEM) VL_TOTAL_ITEM,
	 SUM(QT_ITEM) QT_TOTAL_ITEM,
	 COUNT(*) QT_ITEM,
	 COUNT(DISTINCT(NR_INTERNO_CONTA)) QT_CONTA
FROM	CONTA_CONVENIO_V
GROUP BY 	1,
		NR_ATENDIMENTO,
	 	NR_INTERNO_CONTA,
	 	NR_SEQ_PROTOCOLO,
		CD_CONVENIO

union

SELECT 2 IE_TIPO_TOTAL,
	 0 NR_ATENDIMENTO,
	 0 NR_INTERNO_CONTA,
	 NR_SEQ_PROTOCOLO,
	 CD_CONVENIO,
	 SUM(VL_ITEM) VL_TOTAL_ITEM,
	 SUM(QT_ITEM) QT_TOTAL_ITEM,
	 COUNT(*) QT_ITEM,
	 COUNT(DISTINCT(NR_INTERNO_CONTA)) QT_CONTA
FROM	CONTA_CONVENIO_V
GROUP BY 	2,0,0,
	 	NR_SEQ_PROTOCOLO,
		CD_CONVENIO;

