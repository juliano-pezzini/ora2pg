-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_pagamento_benef_v (cd_prestador, ds_conteudo) AS select	c.cd_prestador,
	case	when(a.dt_rescisao <= (last_day(LOCALTIMESTAMP))) then
                    'E'
        else
                    'I'
	end||';'||
	b.nr_cpf||';'||
	substr(pls_obter_dados_segurado(a.nr_sequencia, 'C'), 1, 4)||';'||
	lpad(substr(pls_obter_dados_segurado(a.nr_sequencia, 'C'), 5, 4), 6, '0')||';'||
	lpad(a.cd_matricula_familia, 6, '0')||';'||
	'Titular'||';'||
	rpad(b.nm_pessoa_fisica, 70, ' ')||';'||
	substr(pls_convert_masc_cart_usuario(g.cd_usuario_plano, c.cd_estabelecimento), 2, 20)||';'||
	to_char(b.dt_nascimento, 'DD/MM/YYYY')||';'||
	b.ie_sexo||';'||
	'Solteiro'||';'||
	b.nr_identidade||';'||
	b.ds_orgao_emissor_ci||';'||
	to_char(b.dt_emissao_ci, 'DD/MM/YYYY')||';'||
	lpad(b.nr_pis_pasep, 11, '0')||';'||
	(	select 	rpad(x.nm_contato, 70, ' ')
		FROM	compl_pessoa_fisica x
		where	x.cd_pessoa_fisica = b.cd_pessoa_fisica
		and	x.ie_tipo_complemento = 5)||';'||
	rpad(d.ds_endereco, 40, ' ')||';'||
	rpad(d.nr_endereco, 6, ' ')||';'||
	rpad(d.ds_bairro, 20, ' ')||';'||
	lpad(d.cd_municipio_ibge, 20, '0')||';'||
	lpad(d.cd_cep, 8, ' ')||';'||
	null||';'||
	null||';'||
	'1'||';'||
	lpad(pls_obter_dados_segurado(a.nr_sequencia, 'CC'), 5, '0')||';'||
	case 	when(f.ie_preco = 1)then
	'1'
	when(f.ie_preco = 2 or f.ie_preco = 3)then
	'2'
	end||';'||
	to_char(a.dt_contratacao, 'DD/MM/YYYY')||';'||
	null||';'||
	to_char(a.dt_rescisao, 'DD/MM/YYYY')||';'||
	(	select	cd_motivo_cancelamento
		from 	   pls_motivo_cancelamento x
		where	x.nr_sequencia = a.nr_seq_motivo_cancelamento) ds_conteudo
from    pls_segurado a,
	pessoa_fisica b,
	pls_prestador c,
	compl_pessoa_fisica d,
	pls_conta_medica_resumo e,
	pls_plano f,
	pls_conta_v g
where   a.cd_pessoa_fisica  = b.cd_pessoa_fisica
	and	  a.cd_pessoa_fisica  = d.cd_pessoa_fisica
	and	  b.cd_pessoa_fisica  = d.cd_pessoa_fisica
	and     a.nr_sequencia      = e.nr_seq_segurado
	and     c.nr_sequencia      = e.nr_seq_prestador_pgto
	and	  f.nr_sequencia	    = a.nr_seq_plano
	and	  g.nr_sequencia	    = e.nr_seq_conta
	and	  d.ie_tipo_complemento = 1
group by
	c.cd_prestador,
	a.dt_rescisao,
	b.nr_cpf,
	a.nr_sequencia,
	a.cd_matricula_familia,
	b.nm_pessoa_fisica,
	g.cd_usuario_plano,
	c.cd_estabelecimento,
	b.dt_nascimento,
	b.ie_sexo,
	b.nr_identidade,
	b.ds_orgao_emissor_ci,
	b.dt_emissao_ci,
	b.cd_pessoa_fisica,
	b.nr_pis_pasep,
	d.nm_contato,
	d.ds_endereco,
	d.nr_endereco,
	d.ds_bairro,
	d.cd_municipio_ibge,
	d.cd_cep,
	f.ie_preco,
	a.dt_contratacao,
	a.dt_rescisao,
	a.nr_seq_motivo_cancelamento;

