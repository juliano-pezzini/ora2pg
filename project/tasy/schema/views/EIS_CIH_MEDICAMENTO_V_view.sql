-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_cih_medicamento_v (ie_origem_inf, dt_ficha, dt_alta, cd_medicamento, ds_medicamento, qt_todos, qt_nao_infec, qt_infectados, qt_ih, qt_ic, cd_empresa) AS select	distinct
	1 ie_origem_inf, 
	a.dt_ficha, 
	null dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	count(distinct a.nr_ficha_ocorrencia) qt_todos, 
	0 qt_nao_infec, 
	0 qt_infectados, 
	0 qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE a.dt_cancelamento is null group by a.dt_ficha, 
	e.cd_medicamento, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	1 ie_origem_inf, /* Profilático Não infectado */
 
	a.dt_ficha, 
	null dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	count(distinct a.nr_ficha_ocorrencia) qt_nao_infec, 
	0 qt_infectados, 
	0 qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
WHERE cd_topografia is null and a.dt_cancelamento is null group by a.dt_ficha, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	1 ie_origem_inf, /* Profilático Infectado */
 
	a.dt_ficha, 
	null dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	0 qt_nao_infec, 
	count(distinct a.nr_ficha_ocorrencia) qt_infectados, 
	0 qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE cd_topografia is not null and a.dt_cancelamento is null group by a.dt_ficha, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	1 ie_origem_inf, /* Profilático Infectado IH */
 
	a.dt_ficha, 
	null dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	0 qt_nao_infec, 
	0 qt_infectados, 
	count(distinct a.nr_ficha_ocorrencia) qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM cih_caso_infeccao d, cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE b.cd_caso_infeccao	= 	d.cd_caso_infeccao and coalesce(d.ie_tipo_caso, b.cd_caso_infeccao) = 1 and cd_topografia is not null and a.dt_cancelamento is null group by a.dt_ficha, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	1 ie_origem_inf, /* Profilático Infectado IC */
 
	a.dt_ficha, 
	null dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	0 qt_nao_infec, 
	0 qt_infectados, 
	0 qt_ih, 
	count(distinct a.nr_ficha_ocorrencia) qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM cih_caso_infeccao d, cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE b.cd_caso_infeccao	= 	d.cd_caso_infeccao and coalesce(d.ie_tipo_caso, b.cd_caso_infeccao) = 2 and cd_topografia is not null and a.dt_cancelamento is null group by a.dt_ficha, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento))	 

union
 
select	distinct 
	1 ie_origem_inf,	 /* Profilático Todos */
 
	null dt_ficha, 
	g.dt_alta dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	count(distinct a.nr_ficha_ocorrencia) qt_todos, 
	0 qt_nao_infec, 
	0 qt_infectados, 
	0 qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM atendimento_paciente g, cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE a.nr_atendimento    =  	g.nr_atendimento   and a.dt_cancelamento is null group by g.dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	1 ie_origem_inf, /* Profilático Não infectado */
 
	null dt_ficha, 
	g.dt_alta dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	count(distinct a.nr_ficha_ocorrencia) qt_nao_infec, 
	0 qt_infectados, 
	0 qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM atendimento_paciente g, cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE a.nr_atendimento    =  	g.nr_atendimento   and cd_topografia is null and a.dt_cancelamento is null group by g.dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	1 ie_origem_inf, /* Profilático Infectado */
 
	null dt_ficha, 
	g.dt_alta dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	0 qt_nao_infec, 
	count(distinct a.nr_ficha_ocorrencia) qt_infectados, 
	0 qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM atendimento_paciente g, cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE a.nr_atendimento    =  	g.nr_atendimento   and cd_topografia is not null and a.dt_cancelamento is null group by g.dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	1 ie_origem_inf, /* Profilático Infectado IH*/
 
	null dt_ficha, 
	g.dt_alta dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	0 qt_nao_infec, 
	0 qt_infectados, 
	count(distinct a.nr_ficha_ocorrencia) qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM atendimento_paciente g, cih_caso_infeccao d, cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE a.nr_atendimento    =  	g.nr_atendimento   and b.cd_caso_infeccao	= 	d.cd_caso_infeccao and coalesce(d.ie_tipo_caso, b.cd_caso_infeccao) = 1 and cd_topografia is not null and a.dt_cancelamento is null group by g.dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	1 ie_origem_inf, /* Profilático Infectado IC*/
 
	null dt_ficha, 
	g.dt_alta dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	0 qt_nao_infec, 
	0 qt_infectados, 
	0 qt_ih, 
	count(distinct a.nr_ficha_ocorrencia) qt_ic,	 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM atendimento_paciente g, cih_caso_infeccao d, cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE a.nr_atendimento    =  	g.nr_atendimento   and b.cd_caso_infeccao	= 	d.cd_caso_infeccao and coalesce(d.ie_tipo_caso, b.cd_caso_infeccao) = 2 and cd_topografia is not null and a.dt_cancelamento is null group by g.dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	distinct 	/* Profilático Todos */
 
	2 ie_origem_inf, 
	a.dt_ficha, 
	null dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	count(distinct a.nr_ficha_ocorrencia) qt_todos, 
	0 qt_nao_infec, 
	0 qt_infectados, 
	0 qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE ie_tipo_utilizacao	= 1 and a.dt_cancelamento is null group by a.dt_ficha, 
	e.cd_medicamento, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	2 ie_origem_inf, /* Profilático Não infectado */
 
	a.dt_ficha, 
	null dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	count(distinct a.nr_ficha_ocorrencia) qt_nao_infec, 
	0 qt_infectados, 
	0 qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
WHERE ie_tipo_utilizacao	= 1 and cd_topografia is null and a.dt_cancelamento is null group by a.dt_ficha, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	2 ie_origem_inf, /* Profilático Infectado */
 
	a.dt_ficha, 
	null dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	0 qt_nao_infec, 
	count(distinct a.nr_ficha_ocorrencia) qt_infectados, 
	0 qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE cd_topografia is not null and ie_tipo_utilizacao	= 1 and a.dt_cancelamento is null group by a.dt_ficha, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	2 ie_origem_inf, /* Profilático Infectado IH */
 
	a.dt_ficha, 
	null dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	0 qt_nao_infec, 
	0 qt_infectados, 
	count(distinct a.nr_ficha_ocorrencia) qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM cih_caso_infeccao d, cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE b.cd_caso_infeccao	= 	d.cd_caso_infeccao and coalesce(d.ie_tipo_caso, b.cd_caso_infeccao) = 1 and cd_topografia is not null and ie_tipo_utilizacao	= 1 and a.dt_cancelamento is null group by a.dt_ficha, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	2 ie_origem_inf, /* Profilático Infectado IC */
 
	a.dt_ficha, 
	null dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	0 qt_nao_infec, 
	0 qt_infectados, 
	0 qt_ih, 
	count(distinct a.nr_ficha_ocorrencia) qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM cih_caso_infeccao d, cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE b.cd_caso_infeccao	= 	d.cd_caso_infeccao and coalesce(d.ie_tipo_caso, b.cd_caso_infeccao) = 2 and cd_topografia is not null and ie_tipo_utilizacao	= 1 and a.dt_cancelamento is null group by a.dt_ficha, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento))	 

union
 
select	distinct 	/* Profilático Todos */
 
	2 ie_origem_inf, 
	null dt_ficha, 
	g.dt_alta dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	count(distinct a.nr_ficha_ocorrencia) qt_todos, 
	0 qt_nao_infec, 
	0 qt_infectados, 
	0 qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM atendimento_paciente g, cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE a.nr_atendimento    =  	g.nr_atendimento   and ie_tipo_utilizacao	= 1 and a.dt_cancelamento is null group by g.dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	2 ie_origem_inf, /* Profilático Não infectado */
 
	null dt_ficha, 
	g.dt_alta dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	count(distinct a.nr_ficha_ocorrencia) qt_nao_infec, 
	0 qt_infectados, 
	0 qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM atendimento_paciente g, cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE a.nr_atendimento    =  	g.nr_atendimento   and cd_topografia is null and a.dt_cancelamento is null and ie_tipo_utilizacao	= 1 group by g.dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	2 ie_origem_inf, /* Profilático Infectado */
 
	null dt_ficha, 
	g.dt_alta dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	0 qt_nao_infec, 
	count(distinct a.nr_ficha_ocorrencia) qt_infectados, 
	0 qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM atendimento_paciente g, cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE a.nr_atendimento    =  	g.nr_atendimento   and cd_topografia is not null and ie_tipo_utilizacao	= 1 and a.dt_cancelamento is null group by g.dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	2 ie_origem_inf, /* Profilático Infectado IH*/
 
	null dt_ficha, 
	g.dt_alta dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	0 qt_nao_infec, 
	0 qt_infectados, 
	count(distinct a.nr_ficha_ocorrencia) qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM atendimento_paciente g, cih_caso_infeccao d, cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE a.nr_atendimento    =  	g.nr_atendimento   and b.cd_caso_infeccao	= 	d.cd_caso_infeccao and coalesce(d.ie_tipo_caso, b.cd_caso_infeccao) = 1 and cd_topografia is not null and a.dt_cancelamento is null and ie_tipo_utilizacao	= 1 group by g.dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	2 ie_origem_inf, /* Profilático Infectado IC*/
 
	null dt_ficha, 
	g.dt_alta dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	0 qt_nao_infec, 
	0 qt_infectados, 
	0 qt_ih, 
	count(distinct a.nr_ficha_ocorrencia) qt_ic,	 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM atendimento_paciente g, cih_caso_infeccao d, cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE a.nr_atendimento    =  	g.nr_atendimento   and b.cd_caso_infeccao	= 	d.cd_caso_infeccao and coalesce(d.ie_tipo_caso, b.cd_caso_infeccao) = 2 and cd_topografia is not null and a.dt_cancelamento is null and ie_tipo_utilizacao	= 1 group by g.dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento))
union
 
select	distinct 	/* Terapeutico Todos */
 
	3 ie_origem_inf, 
	a.dt_ficha, 
	null dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	count(distinct a.nr_ficha_ocorrencia) qt_todos, 
	0 qt_nao_infec, 
	0 qt_infectados, 
	0 qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE ie_tipo_utilizacao	= 2 and a.dt_cancelamento is null group by a.dt_ficha, 
	e.cd_medicamento, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	3 ie_origem_inf, /* Terapeutico Não infectado */
 
	a.dt_ficha, 
	null dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	count(distinct a.nr_ficha_ocorrencia) qt_nao_infec, 
	0 qt_infectados, 
	0 qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
WHERE a.dt_cancelamento is null and ie_tipo_utilizacao	= 2 and cd_topografia is null group by a.dt_ficha, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	3 ie_origem_inf, /* Terapeutico Infectado */
 
	a.dt_ficha, 
	null dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	0 qt_nao_infec, 
	count(distinct a.nr_ficha_ocorrencia) qt_infectados, 
	0 qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE a.dt_cancelamento is null and cd_topografia is not null and ie_tipo_utilizacao	= 2 group by a.dt_ficha, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	3 ie_origem_inf, /* Terapeutico Infectado IH */
 
	a.dt_ficha, 
	null dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	0 qt_nao_infec, 
	0 qt_infectados, 
	count(distinct a.nr_ficha_ocorrencia) qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM cih_caso_infeccao d, cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE b.cd_caso_infeccao	= 	d.cd_caso_infeccao and a.dt_cancelamento is null and coalesce(d.ie_tipo_caso, b.cd_caso_infeccao) = 1 and cd_topografia is not null and ie_tipo_utilizacao	= 2 group by a.dt_ficha, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	3 ie_origem_inf, /* Terapeutico Infectado IC */
 
	a.dt_ficha, 
	null dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	0 qt_nao_infec, 
	0 qt_infectados, 
	0 qt_ih, 
	count(distinct a.nr_ficha_ocorrencia) qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM cih_caso_infeccao d, cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE b.cd_caso_infeccao	= 	d.cd_caso_infeccao and coalesce(d.ie_tipo_caso, b.cd_caso_infeccao) = 2 and cd_topografia is not null and a.dt_cancelamento is null and ie_tipo_utilizacao	= 2 group by a.dt_ficha, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento))	 

union
 
select	distinct 	/* Terapeutico Todos */
 
	3 ie_origem_inf, 
	null dt_ficha, 
	g.dt_alta dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	count(distinct a.nr_ficha_ocorrencia) qt_todos, 
	0 qt_nao_infec, 
	0 qt_infectados, 
	0 qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM atendimento_paciente g, cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE a.nr_atendimento    =  	g.nr_atendimento   and ie_tipo_utilizacao	= 2 and a.dt_cancelamento is null group by g.dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	3 ie_origem_inf, /* Terapeutico Não infectado */
 
	null dt_ficha, 
	g.dt_alta dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	count(distinct a.nr_ficha_ocorrencia) qt_nao_infec, 
	0 qt_infectados, 
	0 qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM atendimento_paciente g, cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE a.nr_atendimento    =  	g.nr_atendimento   and cd_topografia is null and a.dt_cancelamento is null and ie_tipo_utilizacao	= 2 group by g.dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	3 ie_origem_inf, /* Terapeutico Infectado */
 
	null dt_ficha, 
	g.dt_alta dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	0 qt_nao_infec, 
	count(distinct a.nr_ficha_ocorrencia) qt_infectados, 
	0 qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM atendimento_paciente g, cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE a.nr_atendimento    =  	g.nr_atendimento   and cd_topografia is not null and a.dt_cancelamento is null and ie_tipo_utilizacao	= 2 group by g.dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	3 ie_origem_inf, /* Terapeutico Infectado IH*/
 
	null dt_ficha, 
	g.dt_alta dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	0 qt_nao_infec, 
	0 qt_infectados, 
	count(distinct a.nr_ficha_ocorrencia) qt_ih, 
	0 qt_ic, 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM atendimento_paciente g, cih_caso_infeccao d, cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE a.nr_atendimento    =  	g.nr_atendimento   and b.cd_caso_infeccao	= 	d.cd_caso_infeccao and coalesce(d.ie_tipo_caso, b.cd_caso_infeccao) = 1 and cd_topografia is not null and a.dt_cancelamento is null and ie_tipo_utilizacao	= 2 group by g.dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) 

union
 
select	3 ie_origem_inf, /* Terapeutico Infectado IC*/
 
	null dt_ficha, 
	g.dt_alta dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60) ds_medicamento, 
	0 qt_todos, 
	0 qt_nao_infec, 
	0 qt_infectados, 
	0 qt_ih, 
	count(distinct a.nr_ficha_ocorrencia) qt_ic,	 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento)) cd_empresa 
FROM atendimento_paciente g, cih_caso_infeccao d, cih_ficha_ocorrencia a
LEFT OUTER JOIN cih_local_infeccao b ON (a.nr_ficha_ocorrencia = b.nr_ficha_ocorrencia)
LEFT OUTER JOIN cih_medic_utilizado e ON (a.nr_ficha_ocorrencia = e.nr_ficha_ocorrencia)
WHERE a.nr_atendimento    =  	g.nr_atendimento   and b.cd_caso_infeccao	= 	d.cd_caso_infeccao and coalesce(d.ie_tipo_caso, b.cd_caso_infeccao) = 2 and cd_topografia is not null and a.dt_cancelamento is null and ie_tipo_utilizacao	= 2 group by g.dt_alta, 
	e.cd_medicamento, 
	substr(obter_desc_medic_cih(e.cd_medicamento),1,60), 
	obter_empresa_estab(obter_estab_atend(a.nr_atendimento));

