-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW wkp_card_scoring_results_v (nr_case, lkf_group_code, lkf_group_description, cd_diagnosis, ds_diagnosis, nr_record_id, ie_record_type, dt_admission, length_of_stay, points, cd_billing_node, qt_performance_points, qt_low_dur_serv, qt_low_dur_day, qt_upper_dur, qt_duration_points, qt_add_points_intensive, qt_add_points_multiple, qt_points_specific_area, qt_stay_min, qt_stay_average, qt_stay_max, qt_length_stay) AS SELECT
    a.NR_CASE,
    a.CD_BILLING_GROUP LKF_GROUP_CODE,
    'Description LKF ' LKF_GROUP_DESCRIPTION,
    a.CD_DIAGNOSIS,
    OBTER_DESC_CID(a.CD_DIAGNOSIS) DS_DIAGNOSIS,
    a.NR_RECORD_ID,
    a.IE_RECORD_TYPE,
    a.DT_ADMISSION,
    OBTER_DIAS_INTERNACAO(OBTER_ATENDIMENTO_EPISODIO(b.NR_SEQUENCIA)) LENGTH_OF_STAY,
    a.QT_TOTAL_POINTS as POINTS,
        a.CD_BILLING_NODE as CD_BILLING_NODE,
        a.QT_PERFORMANCE_POINTS as QT_PERFORMANCE_POINTS,
        a.QT_LOW_DUR_SERV as QT_LOW_DUR_SERV,
        a.QT_LOW_DUR_DAY as QT_LOW_DUR_DAY,
        a.QT_UPPER_DUR as QT_UPPER_DUR,
        a.QT_DURATION_POINTS as QT_DURATION_POINTS,
        a.QT_ADD_POINTS_INTENSIVE as QT_ADD_POINTS_INTENSIVE,
        a.QT_ADD_POINTS_MULTIPLE as QT_ADD_POINTS_MULTIPLE,
        a.QT_POINTS_SPECIFIC_AREA as QT_POINTS_SPECIFIC_AREA,
        a.QT_STAY_MIN as QT_STAY_MIN,
        a.QT_STAY_AVERAGE as QT_STAY_AVERAGE,
        a.QT_STAY_MAX as QT_STAY_MAX,
        a.QT_LENGTH_STAY as QT_LENGTH_STAY
FROM
    SCORING_DATA a, EPISODIO_PACIENTE b
    WHERE a.NR_CASE = b.NR_SEQUENCIA;

