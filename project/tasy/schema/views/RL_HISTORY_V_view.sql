-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW rl_history_v (ds_table, ds_delivery_class, nr_sequencia, dt_atualizacao, dt_atualizacao_nrec, nm_usuario, nm_usuario_nrec, dt_history, ds_referring_hosp, ds_referred_hosp, ie_type, ds_type, nm_recorded_by, ie_status, nr_atendimento, cd_referred_department, cd_medical_department, ds_medical_department, ds_status, ie_delivery_classification, nr_seq_rl_ref_from_hosp, nr_seq_rl_ref_to_hosp, nr_seq_rl_rep_from_hosp, nr_seq_rl_rep_to_hosp, ds_response_classification) AS SELECT 1 DS_TABLE,
       obter_valor_dominio_idioma(10221, h.ie_delivery_classification, wheb_usuario_pck.get_nr_seq_idioma) ds_delivery_class,
       h.nr_sequencia,
       h.dt_atualizacao,
       h.dt_atualizacao_nrec,
       h.nm_usuario,
       h.nm_usuario_nrec,
       h.dt_history,
       h.ds_referring_hosp,
       h.ds_referred_hosp,
       h.ie_type,
       obter_valor_dominio_idioma(10219, h.ie_type, wheb_usuario_pck.get_nr_seq_idioma) ds_type,
       h.nm_recorded_by,
       h.ie_status,
	   r.nr_atendimento,
       r.cd_referred_department,
       r.cd_medical_department,
       (select ds_departamento FROM departamento_medico where cd_departamento = coalesce(r.cd_medical_department, r.cd_referred_department)) ds_medical_department,
       obter_valor_dominio_idioma(10311, h.ie_status, wheb_usuario_pck.get_nr_seq_idioma) ds_status,
       h.ie_delivery_classification,
       h.nr_seq_rl_ref_from_hosp,
       h.nr_seq_rl_ref_to_hosp,
       h.nr_seq_rl_rep_from_hosp,
       h.nr_seq_rl_rep_to_hosp,
       NULL AS ds_response_classification
FROM rl_history h
JOIN RL_REF_FROM_HOSPITAL r ON r.nr_sequencia = h.nr_seq_rl_ref_from_hosp

UNION ALL

SELECT 2 DS_TABLE,
       obter_valor_dominio_idioma(10221, h.ie_delivery_classification, wheb_usuario_pck.get_nr_seq_idioma) ds_delivery_class,
       h.nr_sequencia,
       h.dt_atualizacao,
       h.dt_atualizacao_nrec,
       h.nm_usuario,
       h.nm_usuario_nrec,
       h.dt_history,
       h.ds_referring_hosp,
       h.ds_referred_hosp,
       h.ie_type,
       obter_valor_dominio_idioma(10219, h.ie_type, wheb_usuario_pck.get_nr_seq_idioma) ds_type,
       h.nm_recorded_by,
       h.ie_status,
	   r.nr_atendimento,
       r.cd_referred_department,
       r.cd_medical_department,
       (select ds_departamento from departamento_medico where cd_departamento = coalesce(r.cd_medical_department, r.cd_referred_department)) ds_medical_department,
       obter_valor_dominio_idioma(10311, h.ie_status, wheb_usuario_pck.get_nr_seq_idioma) ds_status,
       h.ie_delivery_classification,
       h.nr_seq_rl_ref_from_hosp,
       h.nr_seq_rl_ref_to_hosp,
       h.nr_seq_rl_rep_from_hosp,
       h.nr_seq_rl_rep_to_hosp,
       NULL AS ds_response_classification
FROM rl_history h
JOIN RL_REF_TO_HOSPITAL r ON r.nr_sequencia = h.NR_SEQ_RL_REF_TO_HOSP

UNION ALL

SELECT 3 DS_TABLE,
       obter_valor_dominio_idioma(10221, h.ie_delivery_classification, wheb_usuario_pck.get_nr_seq_idioma) AS ds_delivery_class,
       h.nr_sequencia,
       h.dt_atualizacao,
       h.dt_atualizacao_nrec,
       h.nm_usuario,
       h.nm_usuario_nrec,
       h.dt_history,
       h.ds_referring_hosp,
       h.ds_referred_hosp,
       h.ie_type,
       obter_valor_dominio_idioma(10219, h.ie_type, wheb_usuario_pck.get_nr_seq_idioma) ds_type,
       h.nm_recorded_by,
       h.ie_status,
	   r.nr_atendimento,
       r.cd_referred_department,
       r.cd_medical_department,
       (select ds_departamento from departamento_medico where cd_departamento = coalesce(r.cd_medical_department, r.cd_referred_department)) ds_medical_department,
       obter_valor_dominio_idioma(10311, h.ie_status, wheb_usuario_pck.get_nr_seq_idioma) ds_status,
       h.ie_delivery_classification,
       h.nr_seq_rl_ref_from_hosp,
       h.nr_seq_rl_ref_to_hosp,
       h.nr_seq_rl_rep_from_hosp,
       h.nr_seq_rl_rep_to_hosp,
       NULL AS ds_response_classification
FROM rl_history h
JOIN RL_REP_FROM_HOSPITAL r ON r.nr_sequencia = h.NR_SEQ_RL_REP_FROM_HOSP

UNION ALL

SELECT 4 DS_TABLE,
       obter_valor_dominio_idioma(10221, h.ie_delivery_classification, wheb_usuario_pck.get_nr_seq_idioma) AS ds_delivery_class,
       h.nr_sequencia,
       h.dt_atualizacao,
       h.dt_atualizacao_nrec,
       h.nm_usuario,
       h.nm_usuario_nrec,
       h.dt_history,
       h.ds_referring_hosp,
       h.ds_referred_hosp,
       h.ie_type,
       obter_valor_dominio_idioma(10219, h.ie_type, wheb_usuario_pck.get_nr_seq_idioma) ds_type,
       h.nm_recorded_by,
       h.ie_status,
	   r.nr_atendimento,
       r.cd_referred_department,
       r.cd_medical_department,
       (select ds_departamento from departamento_medico where cd_departamento = coalesce(r.cd_medical_department, r.cd_referred_department)) ds_medical_department,
       obter_valor_dominio_idioma(10311, h.ie_status, wheb_usuario_pck.get_nr_seq_idioma) ds_status,
       h.ie_delivery_classification,
       h.nr_seq_rl_ref_from_hosp,
       h.nr_seq_rl_ref_to_hosp,
       h.nr_seq_rl_rep_from_hosp,
       h.nr_seq_rl_rep_to_hosp,
       h.ds_response_classification
FROM rl_history h
JOIN RL_REP_TO_HOSPITAL r ON r.nr_sequencia = h.NR_SEQ_RL_REP_TO_HOSP
ORDER BY nr_sequencia DESC;

