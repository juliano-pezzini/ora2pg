-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW cpoe_material_rel_v (nm_medicamento, ds_com_medicamento, dt_suspensao, ie_baixado_por_alta, ds_alto_risco, ds_do_paciente, ds_componente, dt_inicio, ds_fim, nr_sequencia_p, ds_tempo_adm, dt_liberacao, nm_usuario, dt_fim, ie_administracao, ie_duracao, nm_usuario_susp, dt_lib_suspensao, cd_material, ie_controle_tempo, ie_tipo_solucao, ie_via_aplicacao, nr_atendimento, qt_dose_terapeutica, cd_unid_medic_terap, ds_justificativa, ds_observacao, cd_mat_comp1, qt_dose_comp1, cd_unid_med_dose_comp1, ds_dose_diferenciada_comp1, cd_mat_comp2, qt_dose_comp2, cd_unid_med_dose_comp2, ds_dose_diferenciada_comp2, cd_mat_comp3, qt_dose_comp3, cd_unid_med_dose_comp3, ds_dose_diferenciada_comp3, cd_mat_comp4, qt_dose_comp4, cd_unid_med_dose_comp4, ds_dose_diferenciada_comp4, cd_mat_comp5, qt_dose_comp5, cd_unid_med_dose_comp5, ds_dose_diferenciada_comp5, cd_mat_comp6, qt_dose_comp6, cd_unid_med_dose_comp6, ds_dose_diferenciada_comp6, cd_mat_recons, qt_dose_recons, cd_unid_med_dose_recons, ds_dose_diferenciada_rec, cd_mat_dil, qt_dose_dil, cd_unid_med_dose_dil, ds_dose_diferenciada_dil, cd_mat_red, qt_dose_red, cd_unid_med_dose_red, ds_dose_diferenciada_red, nm_usuario_nrec, dt_liberacao_enf, ds_horarios) AS select	substr(cpoe_obter_desc_material_rel(a.cd_material, a.nr_seq_hemoterapia),1,255) nm_medicamento,
		substr(cpoe_obter_desc_comp_rel(null, a.nr_seq_hemoterapia,ie_via_aplicacao, qt_dose, cd_unidade_medida, cd_intervalo, ds_dose_diferenciada,ie_administracao,ie_urgencia,nr_seq_adicional, nr_seq_ataque),1,255) ds_com_medicamento,
		a.dt_suspensao,
		a.ie_baixado_por_alta,
		SUBSTR(CASE WHEN obter_se_medicam_alto_risco(a.cd_material)='S' THEN '('||wheb_mensagem_pck.get_texto(391170, null)||')'  ELSE null END ,1,255) ds_alto_risco,
		SUBSTR(CASE WHEN coalesce(a.ie_medicacao_paciente,'N')='S' THEN '('||wheb_mensagem_pck.get_texto(779513, null)||')'  ELSE null END ,1,255) ds_do_paciente,
		cpoe_obter_comp_mat_rel(ie_controle_tempo, ie_tipo_solucao, qt_dose, cd_unidade_medida,ie_administracao,ie_ref_calculo,ie_bomba_infusao,null,a.ie_via_aplicacao,hr_min_aplicacao,qt_solucao,
			 ie_aplic_bolus, ie_aplic_lenta, qt_dose_ataque, qt_dose_adicional, nr_seq_procedimento, ds_dose_diferenciada,qt_dosagem,ie_tipo_dosagem,qt_volume,nr_sequencia, qt_hora_fase, ie_urgencia, qt_dose_terapeutica, cd_unid_medic_terap) ds_componente,
		to_date(to_char(cpoe_obter_data_hora_form(a.dt_inicio, a.hr_prim_horario), 'dd/mm/yyyy hh24:mi:ss'), 'dd/mm/yyyy hh24:mi:ss') dt_inicio,
		CASE WHEN a.dt_fim='' THEN obter_desc_expressao(689989, '')  ELSE to_char(a.dt_fim,'dd/mm/yyyy hh24:mi:ss') END  ds_fim,
		nr_sequencia nr_sequencia_p,
		to_date(substr(cpoe_obter_proxima_adm_grid(nr_sequencia, 'M', nm_usuario, nr_atendimento, ie_administracao, cd_intervalo, coalesce(dt_prox_geracao, LOCALTIMESTAMP),dt_inicio, hr_prim_horario, dt_fim, 'prescr_material',  'nr_seq_mat_cpoe', 'prescr_mat_hor', 'nr_seq_material') ,7,100), 'dd/mm/yyyy hh24:mi') || ' ' ||
		substr(cpoe_obter_proxima_adm_grid(nr_sequencia, 'M', nm_usuario, nr_atendimento, ie_administracao, cd_intervalo,coalesce(dt_prox_geracao, LOCALTIMESTAMP), dt_inicio, hr_prim_horario, dt_fim, 'prescr_material',  'nr_seq_mat_cpoe', 'prescr_mat_hor', 'nr_seq_material') ,1,5) ds_tempo_adm,
		a.dt_liberacao,
		a.nm_usuario,
		CASE WHEN dt_lib_suspensao IS NULL THEN  coalesce(dt_fim_cih,dt_fim)  ELSE dt_fim END  dt_fim,
		a.ie_administracao,
		a.ie_duracao,
		a.nm_usuario_susp,
		coalesce(a.dt_lib_suspensao,null) dt_lib_suspensao,
		a.cd_material,
		a.ie_controle_tempo,
		a.ie_tipo_solucao,
		a.ie_via_aplicacao,
		a.nr_atendimento,
		qt_dose_terapeutica,
		cd_unid_medic_terap,
		ds_justificativa,
		ds_observacao,
		a.cd_mat_comp1,
		a.qt_dose_comp1,
		a.cd_unid_med_dose_comp1,
		a.ds_dose_diferenciada_comp1,
		a.cd_mat_comp2,
		a.qt_dose_comp2,
		a.cd_unid_med_dose_comp2,
		a.ds_dose_diferenciada_comp2,
		a.cd_mat_comp3,
		a.qt_dose_comp3,
		a.cd_unid_med_dose_comp3,
		a.ds_dose_diferenciada_comp3,
		a.cd_mat_comp4,
		a.qt_dose_comp4,
		a.cd_unid_med_dose_comp4,
		a.ds_dose_diferenciada_comp4,
		a.cd_mat_comp5,
		a.qt_dose_comp5,
		a.cd_unid_med_dose_comp5,
		a.ds_dose_diferenciada_comp5,
		a.cd_mat_comp6,
		a.qt_dose_comp6,
		a.cd_unid_med_dose_comp6,
		a.ds_dose_diferenciada_comp6,
		a.cd_mat_recons,
		a.qt_dose_recons,
		a.cd_unid_med_dose_recons,
		a.ds_dose_diferenciada_rec,
		a.cd_mat_dil,
		a.qt_dose_dil,
		a.cd_unid_med_dose_dil,
		a.ds_dose_diferenciada_dil,
		a.cd_mat_red,
		a.qt_dose_red,
		a.cd_unid_med_dose_red,
		a.ds_dose_diferenciada_red,
		a.nm_usuario_nrec,
		a.dt_liberacao_enf,
		a.ds_horarios
FROM 	cpoe_material a
where 	a.ie_controle_tempo = 'N'
and (coalesce(cpoe_obter_se_assoc_adm_adep(nr_seq_procedimento,cd_material),'S') = 'S' OR nr_seq_procedimento IS NULL);

