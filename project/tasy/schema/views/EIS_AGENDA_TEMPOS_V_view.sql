-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_agenda_tempos_v (dt_referencia, cd_estabelecimento, cd_tipo_agenda, cd_agenda, ie_status_agenda, hr_inicio, cd_motivo_canc, cd_medico, cd_convenio, qt_min_duracao, qt_agenda, ie_carater_cirurgia, cd_setor_atendimento, nm_usuario_agenda, ds_cod_proced, ds_procedimento_princ, cd_proc_princ, ie_origem_proc_princ, ds_cod_proc_adic, ds_procedimento_adic, cd_proc_adic, ie_origem_proc_adic, ds_classif_agenda, ie_classif_agenda, ds_setor_execucao, cd_setor_execucao, ds_inicio, ds_agenda, ds_convenio, ds_motivo_cancelamento, nm_medico, ds_status, ds_tipo_agenda, nm_medico_agenda, ds_carater_cirurgia, ds_setor_atendimento, cd_tipo_convenio, ds_tipo_convenio, ds_sala, ds_classificacao, nr_seq_classif_agenda, ie_tipo_proc_agenda, nr_seq_sala, nm_usuario_original, ds_tipo_indicacao, nr_seq_indicacao, ds_min_espera, ds_min_consulta, ds_proc_interno, ds_proced_princ_int, ds_proced_adic_int, ds_lado, ie_lado, ds_estabelecimento, ds_especialidade, qt_cancelada, qt_executada, cd_empresa, ds_curta, ds_complemento, qt_atendimento, cd_procedencia, ds_procedencia, ds_complexidade, dt_chegada, dt_atendimento, dt_atendido, dt_em_exame, dt_executada) AS select	a.DT_REFERENCIA     ,
	a.CD_ESTABELECIMENTO   , 
	a.CD_TIPO_AGENDA     , 
	a.CD_AGENDA       , 
	a.IE_STATUS_AGENDA    , 
	a.HR_INICIO       , 
	a.CD_MOTIVO_CANC     , 
	a.CD_MEDICO       , 
	a.CD_CONVENIO      , 
	a.QT_MIN_DURACAO     , 
	a.QT_AGENDA       , 
	a.IE_CARATER_CIRURGIA  , 
	a.CD_SETOR_ATENDIMENTO, 
	a.NM_USUARIO_AGENDA  , 
	a.CD_PROC_PRINC||' - '||substr(Obter_Descricao_Procedimento(a.CD_PROC_PRINC,a.IE_ORIGEM_PROC_PRINC),1,50) ds_cod_proced,	 
	substr(Obter_Descricao_Procedimento(a.CD_PROC_PRINC,a.IE_ORIGEM_PROC_PRINC),1,150) ds_procedimento_princ, 
	a.CD_PROC_PRINC     , 
	a.IE_ORIGEM_PROC_PRINC, 
	a.CD_PROC_ADIC||' - '||substr(Obter_Descricao_Procedimento(a.CD_PROC_ADIC,a.IE_ORIGEM_PROC_ADIC),1,50) ds_cod_proc_adic, 
	substr(Obter_Descricao_Procedimento(a.CD_PROC_ADIC,a.IE_ORIGEM_PROC_ADIC),1,150) ds_procedimento_adic, 
	a.CD_PROC_ADIC     ,  
	a.IE_ORIGEM_PROC_ADIC  , 
	substr(obter_desc_clas_agenda_cons(a.IE_CLASSIF_AGENDA),1,150) ds_classif_agenda, 
	a.IE_CLASSIF_AGENDA   , 
	substr(OBTER_NOME_SETOR(a.CD_SETOR_EXECUCAO),1,150) ds_setor_execucao, 
	a.CD_SETOR_EXECUCAO   , 
	a.hr_inicio ds_inicio, 
	obter_descricao_padrao('AGENDA','DS_AGENDA',a.CD_AGENDA) ds_agenda, 
	obter_nome_convenio(a.cd_convenio) ds_convenio, 
	substr(obter_motivo_canc_agecons(cd_motivo_canc,'D'),1,255) ds_motivo_cancelamento, 
/*	obter_valor_dominio(1011, a.cd_motivo_canc) ds_motivo_cancelamento,*/
 
	obter_nome_pessoa_fisica(a.cd_medico, null) nm_medico, 
	obter_valor_dominio(83, a.ie_status_agenda) ds_status, 
	obter_valor_dominio(34, a.cd_tipo_agenda) ds_tipo_agenda, 
	obter_nome_pf(b.cd_pessoa_fisica) nm_medico_agenda, 
	substr(obter_valor_dominio(1016, a.ie_carater_cirurgia),1,15) ds_carater_cirurgia, 
	obter_nome_setor(cd_setor_atendimento) ds_setor_atendimento, 
	Obter_Tipo_Convenio(a.CD_CONVENIO) cd_tipo_convenio, 
	SUBSTR(obter_valor_dominio(11, Obter_Tipo_Convenio(a.CD_CONVENIO)),1,100) ds_tipo_convenio, 
	substr(Obter_Desc_Sala_Consulta(nr_seq_sala),1,150) ds_sala, 
	substr(obter_desc_classif_agenda_pac(nr_seq_classif_agenda),1,80) ds_classificacao, 
	a.nr_seq_classif_agenda, 
	ie_tipo_proc_agenda, 
	a.NR_SEQ_SALA, 
	a.nm_usuario_original, 
	substr(obter_descricao_padrao('TIPO_INDICACAO', 'DS_INDICACAO', a.NR_SEQ_INDICACAO),1,100) ds_tipo_indicacao, 
	a.NR_SEQ_INDICACAO, 
	obter_intervalo_minutos(qt_aguardando) ds_min_espera, 
	obter_intervalo_minutos(qt_consulta) ds_min_consulta, 
	substr(obter_desc_proc_interno(nr_seq_proc_interno),1,200) ds_proc_interno, 
	substr(obter_desc_int_proc(cd_proc_princ, ie_origem_proc_princ),1,200) ds_proced_princ_int, 
	substr(obter_desc_int_proc(cd_proc_adic, ie_origem_proc_adic),1,200) ds_proced_adic_int, 
	substr(obter_valor_dominio(1372, ie_lado),1,200) ds_lado, 
	ie_lado, 
	substr(obter_nome_estabelecimento(a.cd_estabelecimento),1,80) ds_estabelecimento, 
	substr(obter_especialidade_medico(a.cd_medico,'D'),1,80) ds_especialidade, 
	CASE WHEN ie_status_agenda='C' THEN 1  ELSE 0 END  qt_cancelada, 
	CASE WHEN ie_status_agenda='E' THEN 1  ELSE 0 END  qt_executada, 
	obter_empresa_estab(a.cd_estabelecimento) cd_empresa, 
	b.ds_curta, 
	b.ds_complemento, 
	a.qt_atendimento, 
	a.cd_procedencia, 
	substr(coalesce(obter_desc_procedencia(a.cd_procedencia),'N達o Informada'),1,100) ds_procedencia, 
	substr(coalesce(sus_obter_complexidade_proced(a.cd_proc_princ, a.ie_origem_proc_princ, 'D'), 'N達o informado'),1,255) ds_complexidade, 
	a.dt_chegada, 
	a.dt_atendimento, 
	a.dt_atendido, 
	a.dt_em_exame, 
	a.dt_executada 
FROM	agenda b, 
	eis_agenda a 
where	a.cd_agenda	= b.cd_agenda 
and	a.CD_PROC_ADIC	is null 

union
 
select	a.DT_REFERENCIA     , 
	a.CD_ESTABELECIMENTO   , 
	a.CD_TIPO_AGENDA     , 
	a.CD_AGENDA       , 
	a.IE_STATUS_AGENDA    , 
	a.HR_INICIO       , 
	a.CD_MOTIVO_CANC     , 
	a.CD_MEDICO       , 
	a.CD_CONVENIO      , 
	a.QT_MIN_DURACAO     , 
	1 QT_AGENDA       , 
	a.IE_CARATER_CIRURGIA  , 
	a.CD_SETOR_ATENDIMENTO, 
	a.NM_USUARIO_AGENDA  , 
	a.CD_PROC_PRINC||' - '||substr(Obter_Descricao_Procedimento(a.CD_PROC_PRINC,a.IE_ORIGEM_PROC_PRINC),1,50) ds_cod_proced, 
	substr(Obter_Descricao_Procedimento(a.CD_PROC_PRINC,a.IE_ORIGEM_PROC_PRINC),1,150) ds_procedimento_princ, 
	a.CD_PROC_PRINC     , 
	a.IE_ORIGEM_PROC_PRINC, 
	a.CD_PROC_ADIC||' - '||substr(Obter_Descricao_Procedimento(a.CD_PROC_ADIC,a.IE_ORIGEM_PROC_ADIC),1,50) ds_cod_proc_adic, 
	substr(Obter_Descricao_Procedimento(a.CD_PROC_ADIC,a.IE_ORIGEM_PROC_ADIC),1,150) ds_procedimento_adic, 
	a.CD_PROC_ADIC     ,  
	a.IE_ORIGEM_PROC_ADIC  , 
	substr(obter_desc_clas_agenda_cons(a.IE_CLASSIF_AGENDA),1,150) ds_classif_agenda, 
	a.IE_CLASSIF_AGENDA   , 
	substr(OBTER_NOME_SETOR(a.CD_SETOR_EXECUCAO),1,150) ds_setor_execucao, 
	a.CD_SETOR_EXECUCAO   , 
	a.hr_inicio ds_inicio, 
	obter_descricao_padrao('AGENDA','DS_AGENDA',a.CD_AGENDA) ds_agenda, 
	obter_nome_convenio(a.cd_convenio) ds_convenio, 
	substr(obter_motivo_canc_agecons(cd_motivo_canc,'D'),1,255) ds_motivo_cancelamento, 
/*	obter_valor_dominio(1011, a.cd_motivo_canc) ds_motivo_cancelamento,*/
 
	obter_nome_pessoa_fisica(a.cd_medico, null) nm_medico, 
	obter_valor_dominio(83, a.ie_status_agenda) ds_status, 
	obter_valor_dominio(34, a.cd_tipo_agenda) ds_tipo_agenda, 
	obter_nome_pf(b.cd_pessoa_fisica) nm_medico_agenda, 
	substr(obter_valor_dominio(1016, a.ie_carater_cirurgia),1,15) ds_carater_cirurgia, 
	obter_nome_setor(cd_setor_atendimento) ds_setor_atendimento, 
	Obter_Tipo_Convenio(a.CD_CONVENIO) cd_tipo_convenio, 
	SUBSTR(obter_valor_dominio(11, Obter_Tipo_Convenio(a.CD_CONVENIO)),1,100) ds_tipo_convenio, 
	substr(Obter_Desc_Sala_Consulta(nr_seq_sala),1,150) ds_sala, 
	substr(obter_desc_classif_agenda_pac(nr_seq_classif_agenda),1,80) ds_classificacao, 
	a.nr_seq_classif_agenda, 
	ie_tipo_proc_agenda, 
	a.NR_SEQ_SALA, 
	a.nm_usuario_original, 
	substr(obter_descricao_padrao('TIPO_INDICACAO', 'DS_INDICACAO', a.NR_SEQ_INDICACAO),1,100) ds_tipo_indicacao, 
	a.NR_SEQ_INDICACAO, 
	obter_intervalo_minutos(qt_aguardando) ds_min_espera, 
	obter_intervalo_minutos(qt_consulta) ds_min_consulta, 
	substr(obter_desc_proc_interno(nr_seq_proc_interno),1,200) ds_proc_interno, 
	substr(obter_desc_int_proc(cd_proc_princ, ie_origem_proc_princ),1,200) ds_proced_princ_int, 
	substr(obter_desc_int_proc(cd_proc_adic, ie_origem_proc_adic),1,200) ds_proced_adic_int, 
	substr(obter_valor_dominio(1372, ie_lado),1,200) ds_lado, 
	ie_lado, 
	substr(obter_nome_estabelecimento(a.cd_estabelecimento),1,80) ds_estabelecimento, 
	substr(obter_especialidade_medico(a.cd_medico,'D'),1,80) ds_especialidade, 
	CASE WHEN ie_status_agenda='C' THEN 1  ELSE 0 END  qt_cancelada, 
	CASE WHEN ie_status_agenda='E' THEN 1  ELSE 0 END  qt_executada, 
	obter_empresa_estab(a.cd_estabelecimento) cd_empresa, 
	b.ds_curta, 
	b.ds_complemento, 
	a.qt_atendimento, 
	a.cd_procedencia, 
	substr(coalesce(obter_desc_procedencia(a.cd_procedencia),'N達o Informada'),1,100) ds_procedencia, 
	substr(coalesce(sus_obter_complexidade_proced(a.cd_proc_adic, a.ie_origem_proc_adic, 'D'), 'N達o informado'),1,255) ds_complexidade, 
	a.dt_chegada, 
	a.dt_atendimento, 
	a.dt_atendido, 
	a.dt_em_exame, 
	a.dt_executada 
from	agenda b, 
	eis_agenda a 
where	a.cd_agenda	= b.cd_agenda 
and	a.CD_PROC_ADIC	is not null;

