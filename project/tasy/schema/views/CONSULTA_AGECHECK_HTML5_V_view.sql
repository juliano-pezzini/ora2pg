-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW consulta_agecheck_html5_v (cd_agenda, cd_tipo_agenda, ds_tipo_agenda, cd_estabelecimento, cd_medico_agenda, nm_medico_agenda, ie_situacao, nr_sequencia, dt_agenda, hr_inicio, dt_previsto, hr_hora, ie_status_atendimento, ie_status_agenda, dt_cancelamento, ie_classif_agenda, cd_pessoa_fisica, nm_paciente_pf, nm_paciente, nm_cliente, cd_medico, cd_medico_exec, nr_atendimento, cd_procedimento, ie_origem_proced, nr_seq_proc_interno, nr_telefone, qt_min_espera_tasy, cd_turno, dt_confirmacao, cd_setor_atendimento, cd_setor_agenda, nr_pront_ext, cd_medico_resp, ie_anestesia, cd_especialidade, dt_agendamento, nm_medico_agendamento, nr_seq_status_pac) AS select	null cd_agenda,	
	11 cd_tipo_agenda,
	'Check-up' ds_tipo_agenda,
	a.cd_estabelecimento,	
	'' cd_medico_agenda,
	'' nm_medico_agenda,
	'' ie_situacao,
	a.nr_sequencia,	
	trunc(a.dt_previsto,'dd') dt_agenda,
	a.dt_previsto hr_inicio,	
	a.dt_previsto,
	to_char(a.dt_previsto,'hh24:mi') hr_hora,		
	substr(y.ie_status_atendimento,1,1) ie_status_atendimento,
	CASE WHEN a.dt_cancelamento IS NULL THEN  'Y'  ELSE 'C' END  ie_status_agenda,	
	a.dt_cancelamento,	
	null ie_classif_agenda,	
	b.cd_pessoa_fisica,
	substr(b.nm_pessoa_fisica,1,60) nm_paciente_pf,
	b.nm_pessoa_fisica nm_paciente,
	substr(b.nm_pessoa_fisica,1,60) nm_cliente,
	null cd_medico,	
	'' cd_medico_exec,				
	a.nr_atendimento,
	null cd_procedimento,
	null ie_origem_proced,
	null nr_seq_proc_interno,	
	null nr_telefone,	
	round((coalesce(y.dt_alta, LOCALTIMESTAMP) - y.dt_entrada) * 1440) qt_min_espera_tasy,	
	'' cd_turno,
	null dt_confirmacao,
	null cd_setor_atendimento,
	a.cd_setor_Atendimento cd_setor_agenda,		
	--substr(obter_dados_categ_conv(a.nr_atendimento,'U'),1,50) cd_usuario_convenio,		

	b.nr_pront_ext,				
	y.cd_medico_resp,	
	'' ie_anestesia,
	null cd_especialidade,	
	a.dt_agendamento dt_agendamento,
	'' nm_medico_agendamento,
  null nr_seq_status_pac
FROM pessoa_fisica b, checkup a
LEFT OUTER JOIN atendimento_paciente y ON (a.nr_atendimento = y.nr_atendimento)
WHERE a.cd_pessoa_fisica	= b.cd_pessoa_fisica;

