-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ea_hist_paciente_unidade_v (dt_inicio, dt_fim, nr_atendimento, dt_entrada, nm_paciente, ie_status_unidade, ds_status_unidade, cd_motivo_interdicao, ds_motiv_interditado, cd_motivo_manutencao, ds_motiv_manutencao, ds_motivo_reserva, ie_situacao, ie_temporario, nr_seq_unidade, nm_usuario_nrec, nm_usuario, nr_seq_interno, cd_unidade_basica, cd_unidade_compl, cd_setor_atendimento, ds_setor_atendimento, nm_unid_basic_setor, nm_unid_compl_setor) AS SELECT --Dados Hist√≥rico
	x.dt_historico dt_inicio,
	x.dt_fim_historico dt_fim,
	x.nr_atendimento,
	c.dt_entrada,
	SUBSTR(obter_nome_pf(c.cd_pessoa_fisica),1,100) nm_paciente,
	x.ie_status_unidade,
	SUBSTR(obter_valor_dominio(82,x.ie_status_unidade),1,200) ds_status_unidade,
	x.cd_motivo_interdicao,
	SUBSTR(obter_desc_mot_inter(x.cd_motivo_interdicao),1,200) ds_motiv_interditado,
	x.cd_motivo_manutencao,
	SUBSTR(obter_desc_mot_manut(x.cd_motivo_manutencao),1,255) ds_motiv_manutencao,
	x.ds_motivo_reserva,
	x.ie_situacao,
	x.ie_temporario,
	x.nr_seq_unidade,
	x.nm_usuario_nrec,
	x.nm_usuario,
	--Dados Unidade/Quarto
	a.nr_seq_interno,
	a.cd_unidade_basica,
	a.cd_unidade_compl,
	--Dados Setor
	b.cd_setor_atendimento,
	b.ds_setor_atendimento,
	b.nm_unidade_basica nm_unid_basic_setor,
	b.nm_unidade_compl nm_unid_compl_setor
FROM setor_atendimento b, unidade_atendimento a, unidade_atend_hist x
LEFT OUTER JOIN atendimento_paciente c ON (x.nr_atendimento = c.nr_atendimento)
WHERE 1 = 1 AND a.cd_setor_atendimento = b.cd_setor_atendimento  AND x.nr_seq_unidade = a.nr_seq_interno ORDER BY SUBSTR(obter_nome_pf(c.cd_pessoa_fisica),1,100);

