-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW reg_validation_report_v (ds_version, crs_id, ds_crs, ds_title, ct_validation_id, ds_tc, ds_titulo, nr_seq_cr, nr_seq_tc, ds_titulo_formatado, ds_pre_condicao, nr_seq_pend, nr_seq_pend_item, nr_seq_cycle, pr_aderencia, ds_funcionalidade, ds_item_description, nr_ordenacao, ds_evidence_path, ds_item_result, dt_execution, ie_severity, ds_severity, ds_result, ds_os_falha, ds_ultimo_ciclo) AS SELECT  p.DS_VERSION ,
        v.Crs_Id ,
        v.Crs_Id
        ||' - '
        ||v.Ds_Customer_Requirement DS_CRS ,
        v.Ds_Crs_Title ds_title ,
        v.Ct_Validation_Id ,
        v.ds_tc ,
        v.ds_titulo ,
        v.Nr_Customer_Requirement nr_seq_cr ,
        v.Nr_Seq_Caso_Teste nr_seq_tc ,
        v.Ds_Titulo_Formatado ,
        v.Ds_Pre_Condicao ,
        p.nr_sequencia nr_seq_pend ,
        i.nr_sequencia nr_seq_pend_item ,
        i.Nr_Seq_Cycle ,
        null pr_aderencia ,
        v.ds_funcionalidade ,
        i.Ds_Item_Description ,
        v.Nr_Ordenacao ,
        i.Ds_Evidence_Path ,
        i.Ds_Item_Result ,
        i.Dt_Execution ,
        i.Ie_Severity ,
        CASE WHEN i.Ie_Severity=1 THEN 'S5' WHEN i.Ie_Severity=2 THEN 'S4' WHEN i.Ie_Severity=3 THEN 'S3' WHEN i.Ie_Severity=4 THEN 'S4' WHEN i.Ie_Severity=5 THEN 'S5' END  ds_severity ,
        CASE WHEN i.IE_RESULT='P' THEN 'Passed' WHEN i.IE_RESULT='F' THEN 'Failed' WHEN i.IE_RESULT='B' THEN 'Blocked' END  ds_result ,
        OBTER_OS_REG_VALIDATION_ITEM(o.Nr_Seq_Validation_Item) ds_os_falha ,
        null DS_ULTIMO_CICLO
FROM reg_test_case_validation_v v, reg_validation_pendencies p, reg_validation_pend_item i
LEFT OUTER JOIN reg_validation_so_pend o ON (i.Nr_Sequencia = o.Nr_Seq_Validation_Item)
WHERE v.Nr_Seq_Caso_Teste = p.Nr_Seq_Tc AND p.Nr_Sequencia = i.Nr_Seq_Pend_Tc AND i.Nr_Seq_Pend_Item = v.Nr_Seq_Acao_Teste;

