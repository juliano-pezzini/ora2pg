-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW controle_cobertutas_vacinais_v (ds_material, ds_vacina, ds_lote, dt_validade_lote, ie_situacao, qt_estoque, ds_local_estoque, dt_cancelamento, dt_vacina, dt_proxima_dose, dt_vacina_filtro, qt_total_vacina, qt_total_sit_ativo, qt_total_sit_inativo) AS SELECT UPPER(trim(both D.DS_MATERIAL)) DS_MATERIAL,
 
	UPPER(trim(both B.DS_VACINA)) DS_VACINA, 
 
	A.DS_LOTE, 
 
	A.DT_VALIDADE_LOTE, 
 
	A.IE_SITUACAO, 
 
	E.QT_ESTOQUE, 
 
	UPPER(trim(both F.DS_LOCAL_ESTOQUE)) DS_LOCAL_ESTOQUE, 
 
	A.DT_CANCELAMENTO, 
 
	A.DT_VACINA, 
 
	A.DT_PROXIMA_DOSE, 
 
	A.DT_VACINA DT_VACINA_FILTRO, 
 
	1 QT_TOTAL_VACINA, 
 
	CASE WHEN A.IE_SITUACAO='A' THEN  1  ELSE 0 END  QT_TOTAL_SIT_ATIVO, 
	CASE WHEN A.IE_SITUACAO='A' THEN  0  ELSE 1 END  QT_TOTAL_SIT_INATIVO 
FROM PACIENTE_VACINA A 
	INNER JOIN VACINA B 
	ON A.NR_SEQ_VACINA = B.NR_SEQUENCIA 
	LEFT JOIN VACINA_PACIENTE_MATERIAL C 
	ON A.NR_SEQUENCIA   = C.NR_SEQ_VACINA 
	LEFT JOIN MATERIAL D 
	ON C.CD_MATERIAL = D.CD_MATERIAL 
	LEFT JOIN SALDO_ESTOQUE E 
	ON D.CD_MATERIAL = E.CD_MATERIAL 
	LEFT JOIN LOCAL_ESTOQUE F 
	ON E.CD_LOCAL_ESTOQUE = F.CD_LOCAL_ESTOQUE;

