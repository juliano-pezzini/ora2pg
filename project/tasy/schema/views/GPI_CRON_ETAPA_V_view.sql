-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW gpi_cron_etapa_v (nivel, nm_atividade, nr_sequencia, nr_seq_estrutura, dt_atualizacao, nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec, nr_seq_apres, nm_etapa, ds_objetivo, dt_inicio_prev, dt_fim_prev, dt_inicio_real, dt_fim_real, qt_hora_prev, qt_hora_real, pr_etapa, nr_seq_cronograma, nr_seq_superior, nr_grupo_trabalho, nr_seq_tipo_etapa) AS WITH RECURSIVE cte AS (
select	1 nivel,(lpad(' ', 3* (1-1)) || nm_etapa) nm_atividade,a.NR_SEQUENCIA,a.NR_SEQ_ESTRUTURA,a.DT_ATUALIZACAO,a.NM_USUARIO,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC,a.NR_SEQ_APRES,a.NM_ETAPA,a.DS_OBJETIVO,a.DT_INICIO_PREV,a.DT_FIM_PREV,a.DT_INICIO_REAL,a.DT_FIM_REAL,a.QT_HORA_PREV,a.QT_HORA_REAL,a.PR_ETAPA,a.NR_SEQ_CRONOGRAMA,a.NR_SEQ_SUPERIOR,a.NR_GRUPO_TRABALHO,a.NR_SEQ_TIPO_ETAPA
FROM	gpi_cron_etapa a WHERE a.nr_seq_superior is null
  UNION ALL
select	(c.level+1) nivel,(lpad(' ', 3* ((c.level+1)-1)) || nm_etapa) nm_atividade,a.NR_SEQUENCIA,a.NR_SEQ_ESTRUTURA,a.DT_ATUALIZACAO,a.NM_USUARIO,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC,a.NR_SEQ_APRES,a.NM_ETAPA,a.DS_OBJETIVO,a.DT_INICIO_PREV,a.DT_FIM_PREV,a.DT_INICIO_REAL,a.DT_FIM_REAL,a.QT_HORA_PREV,a.QT_HORA_REAL,a.PR_ETAPA,a.NR_SEQ_CRONOGRAMA,a.NR_SEQ_SUPERIOR,a.NR_GRUPO_TRABALHO,a.NR_SEQ_TIPO_ETAPA
FROM	gpi_cron_etapa a JOIN cte c ON (c.prior nr_sequencia = a.nr_seq_superior)

) SELECT * FROM cte;


