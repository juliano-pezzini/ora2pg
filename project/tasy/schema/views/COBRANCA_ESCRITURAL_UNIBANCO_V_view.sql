-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW cobranca_escritural_unibanco_v (tp_registro, nr_seq_envio, ie_tipo_mensagem, cd_agencia_banco, cd_conta_banco, nm_empresa, nr_banco, nm_banco, dt_gravacao, ie_mensagem, cd_cgc_empresa, cd_agencia_bancaria, cd_conta, id_titulo_empresa, nr_nosso_numero, ie_mensagem_bloqueto, cd_moeda, cd_carteira, ie_tipo_transacao, nr_seu_numero, dt_vencimento, vl_titulo, cd_banco_cobranca, cd_agencia_cobranca, ie_especie, ie_aceite, dt_emissao, ie_instrucao1, ie_instrucao2, vl_juros_mora, dt_desconto, vl_desconto, vl_abatimento, nr_inscricao_sacado, cd_inscr_sacado, nm_sacado, ds_endereco_sacado, ds_complemento, ds_bairro, cd_cep, ds_cidade, sg_estado, nm_avalista, nr_dia_prazo) AS select	0 				tp_registro,
	a.nr_sequencia			nr_seq_envio, 
	' '				ie_tipo_mensagem, 
	(	select	somente_numero(x.cd_agencia_bancaria) 
		FROM	banco_estabelecimento_v x 
		where	x.nr_sequencia	= a.nr_seq_conta_banco) cd_agencia_banco, 
	(	select	somente_numero(x.cd_conta || x.ie_digito_conta) 
		from	banco_estabelecimento_v x 
		where	x.nr_sequencia	= a.nr_seq_conta_banco) cd_conta_banco, 
	substr(upper(elimina_acentuacao(obter_nome_pf_pj(null, b.cd_cgc))),1,30) nm_empresa, 
	a.cd_banco			nr_banco, 
	substr(upper(elimina_acentuacao(obter_nome_banco(a.cd_banco))),1,8) nm_banco, 
	a.dt_remessa_retorno		dt_gravacao, 
	' '				ie_mensagem, 
	0				cd_cgc_empresa, 
	0				cd_agencia_bancaria, 
	0				cd_conta, 
	0				id_titulo_empresa, 
	74101128537			nr_nosso_numero, 
	' '				ie_mensagem_bloqueto, 
	' '				cd_moeda, 
	4				cd_carteira, 
	0				ie_tipo_transacao, 
	' '				nr_seu_numero, 
	LOCALTIMESTAMP				dt_vencimento, 
	0				vl_titulo, 
	0				cd_banco_cobranca, 
	0				cd_agencia_cobranca, 
	0				ie_especie, 
	' '				ie_aceite, 
	LOCALTIMESTAMP				dt_emissao, 
	0				ie_instrucao1, 
	0				ie_instrucao2, 
	0				vl_juros_mora, 
	LOCALTIMESTAMP				dt_desconto, 
	0				vl_desconto, 
	0				vl_abatimento, 
	0				nr_inscricao_sacado, 
	0				cd_inscr_sacado, 
	' '				nm_sacado, 
	' '				ds_endereco_sacado, 
	' '				ds_complemento, 
	' '				ds_bairro, 
	' '				cd_cep, 
	' '				ds_cidade, 
	' '				sg_estado, 
	' '				nm_avalista, 
	0				nr_dia_prazo 
from	estabelecimento b, 
	banco_estabelecimento c, 
	cobranca_escritural a 
where	a.cd_estabelecimento	= b.cd_estabelecimento 
and	a.nr_seq_conta_banco	= c.nr_sequencia 

union all
 
select	1				tp_registro, 
	a.nr_sequencia			nr_seq_envio, 
	' '				ie_tipo_mensagem, 
	0				cd_agencia_banco, 
	0				cd_conta_banco, 
	' '				nm_empresa, 
	0				nr_banco, 
	' '				nm_banco, 
	LOCALTIMESTAMP				dt_gravacao, 
	' '				ie_mensagem, 
	somente_numero(b.cd_cgc_cpf)	cd_cgc_empresa, 
	(	select	somente_numero(x.cd_agencia_bancaria) 
		from	banco_estabelecimento_v x 
		where	x.nr_sequencia	= a.nr_seq_conta_banco) cd_agencia_bancaria, 
	(	select	somente_numero(x.cd_conta || x.ie_digito_conta) 
		from	banco_estabelecimento_v x 
		where	x.nr_sequencia	= a.nr_seq_conta_banco) cd_conta, 
	b.nr_titulo			id_titulo_empresa, 
	74101128537			 nr_nosso_numero, 
	' '				ie_mensagem_bloqueto, 
	' '				cd_moeda, 
	4				 cd_carteira, 
	somente_numero(coalesce(c.cd_ocorrencia,1)) ie_tipo_transacao, 
	' '				nr_seu_numero, 
	coalesce(b.dt_pagamento_previsto, b.dt_vencimento) dt_vencimento, 
	coalesce(b.vl_titulo,0)		vl_titulo, 
	a.cd_banco			cd_banco_cobranca, 
	(	select	somente_numero(x.cd_agencia_bancaria) 
		from	banco_estabelecimento_v x 
		where	x.nr_sequencia	= a.nr_seq_conta_banco) cd_agencia_cobranca, 
	99				ie_especie, 
	'N'				ie_aceite, 
	b.dt_emissao			dt_emissao, 
	0				ie_instrucao1, 
	0				ie_instrucao2, 
	0				vl_juros_mora, 
	LOCALTIMESTAMP				dt_desconto, 
	coalesce(c.vl_desconto,0)		vl_desconto, 
	0				vl_abatimento, 
	CASE WHEN b.cd_cgc IS NULL THEN  1  ELSE 2 END 	nr_inscricao_sacado, 
	somente_numero(b.cd_cgc_cpf)	cd_inscr_sacado, 
	substr(upper(elimina_acentuacao(b.nm_pessoa)),1,30) nm_sacado, 
	substr(upper(elimina_acentuacao(obter_dados_pf_pj(b.cd_pessoa_fisica, b.cd_cgc, 'EN') || ',' || obter_dados_pf_pj(b.cd_pessoa_fisica, b.cd_cgc, 'NR'))),1,30) ds_endereco_sacado, 
	substr(upper(elimina_acentuacao(obter_dados_pf_pj(b.cd_pessoa_fisica, b.cd_cgc, 'CO'))),1,10) ds_complemento, 
	substr(upper(elimina_acentuacao(obter_dados_pf_pj(b.cd_pessoa_fisica, b.cd_cgc, 'B'))),1,12) ds_bairro, 
	substr(upper(elimina_acentuacao(obter_dados_pf_pj(b.cd_pessoa_fisica, b.cd_cgc, 'CEP'))),1,8) cd_cep, 
	substr(upper(elimina_acentuacao(obter_dados_pf_pj(b.cd_pessoa_fisica, b.cd_cgc, 'CI'))),1,15) ds_cidade, 
	substr(upper(elimina_acentuacao(obter_dados_pf_pj(b.cd_pessoa_fisica, b.cd_cgc, 'UF'))),1,2) sg_estado, 
	' '				nm_avalista, 
	0				nr_dia_prazo 
from	titulo_receber_v b, 
	titulo_receber_cobr c, 
	cobranca_escritural a 
where	a.nr_sequencia		= c.nr_seq_cobranca 
and	c.nr_titulo		= b.nr_titulo 

union all
 
select	9				tp_registro, 
	a.nr_sequencia			nr_seq_envio, 
	' '				ie_tipo_mensagem, 
	0				cd_agencia_banco, 
	0				cd_conta_banco, 
	' '				nm_empresa, 
	0				nr_banco, 
	' '				nm_banco, 
	LOCALTIMESTAMP				dt_gravacao, 
	' '				ie_mensagem, 
	0				cd_cgc_empresa, 
	0				cd_agencia_bancaria, 
	0				cd_conta, 
	0				id_titulo_empresa, 
	74101128537			nr_nosso_numero, 
	' '				ie_mensagem_bloqueto, 
	' '				cd_moeda, 
	4				cd_carteira, 
	0				ie_tipo_transacao, 
	' '				nr_seu_numero, 
	LOCALTIMESTAMP				dt_vencimento, 
	0				vl_titulo, 
	0				cd_banco_cobranca, 
	0				cd_agencia_cobranca, 
	0				ie_especie, 
	' '				ie_aceite, 
	LOCALTIMESTAMP				dt_emissao, 
	0				ie_instrucao1, 
	0				ie_instrucao2, 
	0				vl_juros_mora, 
	LOCALTIMESTAMP				dt_desconto, 
	0				vl_desconto, 
	0				vl_abatimento, 
	0				nr_inscricao_sacado, 
	0				cd_inscr_sacado, 
	' '				nm_sacado, 
	' '				ds_endereco_sacado, 
	' '				ds_complemento, 
	' '				ds_bairro, 
	' '				cd_cep, 
	' '				ds_cidade, 
	' '				sg_estado, 
	' '				nm_avalista, 
	0				nr_dia_prazo 
from	cobranca_escritural a;

