-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW epimed_complicacoes_dia_v (complication_value, enable_value, visit_id, complicationdate, complication_id, complication_code, updatetimestamp, updatetimestampfilter, cd_multi_empresa, recordid) AS SELECT (case when a.qt_executada < 1 then '0' else '1' end)complication_value,
    CASE WHEN a.qt_executada >= 1 then '1' else '0' END enable_value,
    a.nr_atendimento visit_id,
    to_char(a.dt_atualizacao, 'YYYY-MM-DD"T"HH24:MI:SS."000"') complicationdate,
    (select max(t.nr_sequencia) FROM material_atend_paciente t where t.nr_atendimento = x.nr_atendimento group by x.nr_atendimento ) complication_id,
    'B01' complication_code,  -- Codigo para enviar para EPIMED
    to_char(LOCALTIMESTAMP + interval '1 days'/24/60/60,'YYYY-MM-DD"T"HH24:MI:SS."000"') updatetimestamp,
    to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
    X.CD_ESTABELECIMENTO CD_MULTI_EMPRESA,
    (a.NR_SEQUENCIA||2) RECORDID
FROM	 material b,	
  prescr_material p,
  material_atend_paciente a,
  prescr_medica x
WHERE  x.nr_prescricao   = p.nr_prescricao
and  a.cd_material    = b.cd_material
and  x.nr_atendimento   in ( select distinct v.nr_atendimento from epimed_internados_v v)
and p.cd_material in (select y.cd_material  from material y
where obter_dados_material(y.cd_material,'CSUB') = 13 and y.ie_situacao = 'A')  
and A.CD_SETOR_ATENDIMENTO in (select h.cd_setor_atendimento  
    from SETOR_ATENDIMENTO h where h.IE_EPIMED = 'S' and h.ie_situacao = 'A')
and		(((select abs(coalesce(max(j.nr_min_mov_epimed),0)) from parametro_Atendimento j) = 0) or
		(a.dt_entrada_unidade >= LOCALTIMESTAMP - (select abs(coalesce(max(j.nr_min_mov_epimed),0)) from parametro_Atendimento j)/1440))
and  a.nr_prescricao   = p.nr_prescricao
and  a.nr_sequencia_prescricao  = p.nr_sequencia

union all

--Ventilacao Mecanica
select 
distinct(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12053 /*Ventilacao Mecanica*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end)complication_value,
(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12053 /*Ventilacao Mecanica*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end) enable_value,
a.nr_atendimento visit_id,
to_char(a.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') complicationdate,
a.nr_sequencia complication_id,
'A02' complication_code, -- Codigo para enviar para EPIMED
to_char(LOCALTIMESTAMP + interval '2 days'/24/60/60,'YYYY-MM-DD"T"HH24:MI:SS."000"') updatetimestamp,
to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
A.CD_ESTABELECIMENTO CD_MULTI_EMPRESA,
(a.NR_SEQUENCIA||b.NR_SEQ_ITEM) RECORDID
from MED_AVALIACAO_PACIENTE a, med_avaliacao_result b
where a.nr_sequencia = b.nr_seq_avaliacao
and a.nr_seq_tipo_avaliacao = 355 -- cod da avaliacao
AND b.NR_SEQ_ITEM = 12053
and a.dt_liberacao is not NULL
and a.nr_sequencia = (select max(t.nr_seq_avaliacao) from med_avaliacao_result t WHERE t.qt_resultado = 1
AND t.NR_SEQ_ITEM = 12053 AND a.NR_SEQUENCIA = t.NR_SEQ_AVALIACAO)
and obter_setor_atual_paciente(a.NR_ATENDIMENTO) in (select cd_setor_atendimento 
            from SETOR_ATENDIMENTO where IE_EPIMED = 'S' and ie_situacao = 'A')

union all

--Ventilacoo Nao-Invasiva
select 
distinct(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12054 /*Ventilacao Nao-Invasiva*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
 AND a.IE_SITUACAO = 'A' then '1' else '0' end)complication_value,
(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12054 /*Ventilacao Nao-Invasiva*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
 AND a.IE_SITUACAO = 'A' then '1' else '0' end) enable_value,
a.nr_atendimento visit_id,
to_char(a.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') complicationdate,
a.nr_sequencia complication_id,
'A03' complication_code, -- Codigo para enviar para EPIMED
to_char(LOCALTIMESTAMP + interval '3 days'/24/60/60,'YYYY-MM-DD"T"HH24:MI:SS."000"') updatetimestamp,
to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
A.CD_ESTABELECIMENTO CD_MULTI_EMPRESA,
(a.NR_SEQUENCIA||b.NR_SEQ_ITEM) RECORDID
from MED_AVALIACAO_PACIENTE a, med_avaliacao_result b
where a.nr_sequencia = b.nr_seq_avaliacao
and a.nr_seq_tipo_avaliacao = 355 -- cod da avaliacao
AND b.NR_SEQ_ITEM = 12054
and a.dt_liberacao is not null
and obter_setor_atual_paciente(a.NR_ATENDIMENTO) in (select cd_setor_atendimento 
            from SETOR_ATENDIMENTO where IE_EPIMED = 'S' and ie_situacao = 'A')

union all

--Suporte Renal
select 
distinct(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12055 /*Suporte Renal*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end)complication_value,
(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12055 /*Suporte Renal*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end) enable_value,
a.nr_atendimento visit_id,
to_char(a.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') complicationdate,
a.nr_sequencia complication_id,
'A04' complication_code, -- Codigo para enviar para EPIMED
to_char(LOCALTIMESTAMP + interval '4 days'/24/60/60,'YYYY-MM-DD"T"HH24:MI:SS."000"') updatetimestamp,
to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
A.CD_ESTABELECIMENTO CD_MULTI_EMPRESA,
(a.NR_SEQUENCIA||b.NR_SEQ_ITEM) RECORDID
from MED_AVALIACAO_PACIENTE a, med_avaliacao_result b
where a.nr_sequencia = b.nr_seq_avaliacao
and a.nr_seq_tipo_avaliacao = 355 -- cod da avaliacao
AND b.NR_SEQ_ITEM = 12055
and a.dt_liberacao is not null
and obter_setor_atual_paciente(a.NR_ATENDIMENTO) in (select cd_setor_atendimento 
            from SETOR_ATENDIMENTO where IE_EPIMED = 'S' and ie_situacao = 'A')

union all

--Insuficiencia respiratoria
select 
distinct(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12056 /*Insuficiencia respiratoria*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end)complication_value,
(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12056 /*Insuficiencia respiratoria*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end) enable_value,
a.nr_atendimento visit_id,
to_char(a.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') complicationdate,
a.nr_sequencia complication_id,
'A05' complication_code, -- Codigo para enviar para EPIMED
to_char(LOCALTIMESTAMP + interval '5 days'/24/60/60,'YYYY-MM-DD"T"HH24:MI:SS."000"') updatetimestamp,
to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
A.CD_ESTABELECIMENTO CD_MULTI_EMPRESA,
(a.NR_SEQUENCIA||b.NR_SEQ_ITEM) RECORDID
from MED_AVALIACAO_PACIENTE a, med_avaliacao_result b
where a.nr_sequencia = b.nr_seq_avaliacao
and a.nr_seq_tipo_avaliacao = 355 -- cod da avaliacao
AND b.NR_SEQ_ITEM = 12056
and a.dt_liberacao is not null
and obter_setor_atual_paciente(a.NR_ATENDIMENTO) in (select cd_setor_atendimento 
            from SETOR_ATENDIMENTO where IE_EPIMED = 'S' and ie_situacao = 'A')

union all

--Arritmia cardiaca
select 
distinct(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12057 /*Arritmia cardiaca*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end)complication_value,
(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12057 /*Arritmia cardiaca*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end) enable_value,
a.nr_atendimento visit_id,
to_char(a.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') complicationdate,
a.nr_sequencia complication_id,
'A06' complication_code, -- Codigo para enviar para EPIMED
to_char(LOCALTIMESTAMP + interval '6 days'/24/60/60,'YYYY-MM-DD"T"HH24:MI:SS."000"') updatetimestamp,
to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
A.CD_ESTABELECIMENTO CD_MULTI_EMPRESA,
(a.NR_SEQUENCIA||b.NR_SEQ_ITEM) RECORDID
from MED_AVALIACAO_PACIENTE a, med_avaliacao_result b
where a.nr_sequencia = b.nr_seq_avaliacao
and a.nr_seq_tipo_avaliacao = 355 -- cod da avaliacao
AND b.NR_SEQ_ITEM = 12057
and a.dt_liberacao is not null
and obter_setor_atual_paciente(a.NR_ATENDIMENTO) in (select cd_setor_atendimento 
            from SETOR_ATENDIMENTO where IE_EPIMED = 'S' and ie_situacao = 'A')

union all

--Insuficiencia renal aguda
select 
distinct(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12058 /*Insuficiencia renal aguda*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end)complication_value,
(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12058 /*Insuficiencia renal aguda*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end) enable_value,
a.nr_atendimento visit_id,
to_char(a.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') complicationdate,
a.nr_sequencia complication_id,
'A07' complication_code, -- Codigo para enviar para EPIMED
to_char(LOCALTIMESTAMP + interval '7 days'/24/60/60,'YYYY-MM-DD"T"HH24:MI:SS."000"') updatetimestamp,
to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
A.CD_ESTABELECIMENTO CD_MULTI_EMPRESA,
(a.NR_SEQUENCIA||b.NR_SEQ_ITEM) RECORDID
from MED_AVALIACAO_PACIENTE a, med_avaliacao_result b
where a.nr_sequencia = b.nr_seq_avaliacao
and a.nr_seq_tipo_avaliacao = 355 -- cod da avaliacao
AND b.NR_SEQ_ITEM = 12058
and a.dt_liberacao is not null
and obter_setor_atual_paciente(a.NR_ATENDIMENTO) in (select cd_setor_atendimento 
            from SETOR_ATENDIMENTO where IE_EPIMED = 'S' and ie_situacao = 'A')

union all

--Efeito massa intracraniana
select 
distinct(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12059 /*Efeito massa intracraniana*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end)complication_value,
(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12059 /*Efeito massa intracraniana*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end) enable_value,
a.nr_atendimento visit_id,
to_char(a.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') complicationdate,
a.nr_sequencia complication_id,
'A08' complication_code, -- Codigo para enviar para EPIMED
to_char(LOCALTIMESTAMP + interval '8 days'/24/60/60,'YYYY-MM-DD"T"HH24:MI:SS."000"') updatetimestamp,
to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
A.CD_ESTABELECIMENTO CD_MULTI_EMPRESA,
(a.NR_SEQUENCIA||b.NR_SEQ_ITEM) RECORDID
from MED_AVALIACAO_PACIENTE a, med_avaliacao_result b
where a.nr_sequencia = b.nr_seq_avaliacao
and a.nr_seq_tipo_avaliacao = 355 -- cod da avaliacao
AND b.NR_SEQ_ITEM = 12059
and a.dt_liberacao is not null
and obter_setor_atual_paciente(a.NR_ATENDIMENTO) in (select cd_setor_atendimento 
            from SETOR_ATENDIMENTO where IE_EPIMED = 'S' and ie_situacao = 'A')

union all

--Neutropenia
select 
distinct(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12060 /*Neutropenia*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end)complication_value,
(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12060 /*Neutropenia*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end) enable_value,
a.nr_atendimento visit_id,
to_char(a.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') complicationdate,
a.nr_sequencia complication_id,
'A09' complication_code, -- Codigo para enviar para EPIMED
to_char(LOCALTIMESTAMP + interval '9 days'/24/60/60,'YYYY-MM-DD"T"HH24:MI:SS."000"') updatetimestamp,
to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
A.CD_ESTABELECIMENTO CD_MULTI_EMPRESA,
(a.NR_SEQUENCIA||b.NR_SEQ_ITEM) RECORDID
from MED_AVALIACAO_PACIENTE a, med_avaliacao_result b
where a.nr_sequencia = b.nr_seq_avaliacao
and a.nr_seq_tipo_avaliacao = 355 -- cod da avaliacao
AND b.NR_SEQ_ITEM = 12060
and a.dt_liberacao is not null
and obter_setor_atual_paciente(a.NR_ATENDIMENTO) in (select cd_setor_atendimento 
            from SETOR_ATENDIMENTO where IE_EPIMED = 'S' and ie_situacao = 'A')

union all

--Parada Cardiorrespiratoria
select 
distinct(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12061 /*Parada Cardiorrespiratoria*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end)complication_value,
(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12061 /*Parada Cardiorrespiratoria*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end) enable_value,
a.nr_atendimento visit_id,
to_char(a.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') complicationdate,
a.nr_sequencia complication_id,
'A10' complication_code, -- Codigo para enviar para EPIMED
to_char(LOCALTIMESTAMP + interval '10 days'/24/60/60,'YYYY-MM-DD"T"HH24:MI:SS."000"') updatetimestamp,
to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
A.CD_ESTABELECIMENTO CD_MULTI_EMPRESA,
(a.NR_SEQUENCIA||b.NR_SEQ_ITEM) RECORDID
from MED_AVALIACAO_PACIENTE a, med_avaliacao_result b
where a.nr_sequencia = b.nr_seq_avaliacao
and a.nr_seq_tipo_avaliacao = 355 -- cod da avaliacao
AND b.NR_SEQ_ITEM = 12061
and a.dt_liberacao is not null
and a.nr_atendimento in ( select distinct v.nr_atendimento from epimed_internados_v v)
and obter_setor_atual_paciente(a.NR_ATENDIMENTO) in (select cd_setor_atendimento 
            from SETOR_ATENDIMENTO where IE_EPIMED = 'S' and ie_situacao = 'A')

union all

--Hemorragia Digestiva
select 
distinct(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12062 /*Hemorragia Digestiva*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end)complication_value,
(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12062 /*Hemorragia Digestiva*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end) enable_value,
a.nr_atendimento visit_id,
to_char(a.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') complicationdate,
a.nr_sequencia complication_id,
'A11' complication_code, -- Codigo para enviar para EPIMED
to_char(LOCALTIMESTAMP + interval '11 days'/24/60/60,'YYYY-MM-DD"T"HH24:MI:SS."000"') updatetimestamp,
to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
A.CD_ESTABELECIMENTO CD_MULTI_EMPRESA,
(a.NR_SEQUENCIA||b.NR_SEQ_ITEM) RECORDID
from MED_AVALIACAO_PACIENTE a, med_avaliacao_result b
where a.nr_sequencia = b.nr_seq_avaliacao
and a.nr_seq_tipo_avaliacao = 355 -- cod da avaliacao
AND b.NR_SEQ_ITEM = 12062
and a.dt_liberacao is not null
and a.nr_atendimento in ( select distinct v.nr_atendimento from epimed_internados_v v)
and obter_setor_atual_paciente(a.NR_ATENDIMENTO) in (select cd_setor_atendimento 
            from SETOR_ATENDIMENTO where IE_EPIMED = 'S' and ie_situacao = 'A')

union all

--Ventilacao Mecanica 24H
select 
distinct(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12042 /*Ventilacao Mecanica*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end)complication_value,
(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12042 /*Ventilacao Mecanica*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end)enable_value,
a.nr_atendimento visit_id,
to_char(a.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') complicationdate,
a.nr_sequencia complication_id,
'B02' complication_code, -- Codigo para enviar para EPIMED
to_char(LOCALTIMESTAMP + interval '12 days'/24/60/60,'YYYY-MM-DD"T"HH24:MI:SS."000"') updatetimestamp,
to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
A.CD_ESTABELECIMENTO CD_MULTI_EMPRESA,
(a.NR_SEQUENCIA||b.NR_SEQ_ITEM) RECORDID
from MED_AVALIACAO_PACIENTE a, med_avaliacao_result b
where a.nr_sequencia = b.nr_seq_avaliacao
and a.nr_seq_tipo_avaliacao = 354 -- cod da avaliacao
AND b.NR_SEQ_ITEM = 12042
and a.dt_liberacao is not NULL
and a.nr_sequencia = (select max(t.nr_seq_avaliacao) from med_avaliacao_result t WHERE t.qt_resultado = 1
AND t.NR_SEQ_ITEM = 12042 AND a.NR_SEQUENCIA = t.NR_SEQ_AVALIACAO) 
and obter_setor_atual_paciente(a.NR_ATENDIMENTO) in (select cd_setor_atendimento 
            from SETOR_ATENDIMENTO where IE_EPIMED = 'S' and ie_situacao = 'A')

union all

--Ventilacao Nao-Invasiva 24H
select 
distinct(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12043 /*Ventilacao Nao-Invasiva*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end)complication_value,
(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12043 /*Ventilacao Nao-Invasiva*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end) enable_value,
a.nr_atendimento visit_id,
to_char(a.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') complicationdate,
a.nr_sequencia complication_id,
'B03' complication_code, -- Codigo para enviar para EPIMED
to_char(LOCALTIMESTAMP + interval '13 days'/24/60/60,'YYYY-MM-DD"T"HH24:MI:SS."000"') updatetimestamp,
to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
A.CD_ESTABELECIMENTO CD_MULTI_EMPRESA,
(a.NR_SEQUENCIA||b.NR_SEQ_ITEM) RECORDID
from MED_AVALIACAO_PACIENTE a, med_avaliacao_result b
where a.nr_sequencia = b.nr_seq_avaliacao
and a.nr_seq_tipo_avaliacao = 354 -- cod da avaliacao
AND b.NR_SEQ_ITEM = 12043
and a.dt_liberacao is not null
and obter_setor_atual_paciente(a.NR_ATENDIMENTO) in (select cd_setor_atendimento 
            from SETOR_ATENDIMENTO where IE_EPIMED = 'S' and ie_situacao = 'A')

union all

--Suporte Renal 24H
select 
distinct(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12044 /*Suporte Renal*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end)complication_value,
(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12044 /*Suporte Renal*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end) enable_value,
a.nr_atendimento visit_id,
to_char(a.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') complicationdate,
a.nr_sequencia complication_id,
'B04' complication_code, -- Codigo para enviar para EPIMED
to_char(LOCALTIMESTAMP + interval '14 days'/24/60/60,'YYYY-MM-DD"T"HH24:MI:SS."000"') updatetimestamp,
to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
A.CD_ESTABELECIMENTO CD_MULTI_EMPRESA,
(a.NR_SEQUENCIA||b.NR_SEQ_ITEM) RECORDID
from MED_AVALIACAO_PACIENTE a, med_avaliacao_result b
where a.nr_sequencia = b.nr_seq_avaliacao
and a.nr_seq_tipo_avaliacao = 354 -- cod da avaliacao
AND b.NR_SEQ_ITEM = 12044
and a.dt_liberacao is not null
and obter_setor_atual_paciente(a.NR_ATENDIMENTO) in (select cd_setor_atendimento 
            from SETOR_ATENDIMENTO where IE_EPIMED = 'S' and ie_situacao = 'A')

union all

--Insuficiencia respiratoria 24H
select 
distinct(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12045 /*Insuficiencia respiratoria*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end)complication_value,
(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12045 /*Insuficiencia respiratoria*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end) enable_value,
a.nr_atendimento visit_id,
to_char(a.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') complicationdate,
a.nr_sequencia complication_id,
'B05' complication_code, -- Codigo para enviar para EPIMED
to_char(LOCALTIMESTAMP + interval '15 days'/24/60/60,'YYYY-MM-DD"T"HH24:MI:SS."000"') updatetimestamp,
to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
A.CD_ESTABELECIMENTO CD_MULTI_EMPRESA,
(a.NR_SEQUENCIA||b.NR_SEQ_ITEM) RECORDID
from MED_AVALIACAO_PACIENTE a, med_avaliacao_result b
where a.nr_sequencia = b.nr_seq_avaliacao
and a.nr_seq_tipo_avaliacao = 354 -- cod da avaliacao
AND b.NR_SEQ_ITEM = 12045
and a.dt_liberacao is not null
and obter_setor_atual_paciente(a.NR_ATENDIMENTO) in (select cd_setor_atendimento 
            from SETOR_ATENDIMENTO where IE_EPIMED = 'S' and ie_situacao = 'A')

union all

--Arritmia cardiaca 24H
select 
distinct(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12046 /*Arritmia cardiaca*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end)complication_value,
(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12046 /*Arritmia cardiaca*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end) enable_value,
a.nr_atendimento visit_id,
to_char(a.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') complicationdate,
a.nr_sequencia complication_id,
'B06' complication_code, -- Codigo para enviar para EPIMED
to_char(LOCALTIMESTAMP + interval '16 days'/24/60/60,'YYYY-MM-DD"T"HH24:MI:SS."000"') updatetimestamp,
to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
A.CD_ESTABELECIMENTO CD_MULTI_EMPRESA,
(a.NR_SEQUENCIA||b.NR_SEQ_ITEM) RECORDID
from MED_AVALIACAO_PACIENTE a, med_avaliacao_result b
where a.nr_sequencia = b.nr_seq_avaliacao
and a.nr_seq_tipo_avaliacao = 354 -- cod da avaliacao
AND b.NR_SEQ_ITEM = 12046
and a.dt_liberacao is not null
and obter_setor_atual_paciente(a.NR_ATENDIMENTO) in (select cd_setor_atendimento 
            from SETOR_ATENDIMENTO where IE_EPIMED = 'S' and ie_situacao = 'A')

union all

--Insuficiencia renal aguda 24H
select 
distinct(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12047 /*Insuficiencia renal aguda*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end)complication_value,
(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12047 /*Insuficiencia renal aguda*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end) enable_value,
a.nr_atendimento visit_id,
to_char(a.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') complicationdate,
a.nr_sequencia complication_id,
'B07' complication_code, -- Codigo para enviar para EPIMED
to_char(LOCALTIMESTAMP + interval '17 days'/24/60/60,'YYYY-MM-DD"T"HH24:MI:SS."000"') updatetimestamp,
to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
A.CD_ESTABELECIMENTO CD_MULTI_EMPRESA,
(a.NR_SEQUENCIA||b.NR_SEQ_ITEM) RECORDID
from MED_AVALIACAO_PACIENTE a, med_avaliacao_result b
where a.nr_sequencia = b.nr_seq_avaliacao
and a.nr_seq_tipo_avaliacao = 354 -- cod da avaliacao
AND b.NR_SEQ_ITEM = 12047
and a.dt_liberacao is not null
and obter_setor_atual_paciente(a.NR_ATENDIMENTO) in (select cd_setor_atendimento 
            from SETOR_ATENDIMENTO where IE_EPIMED = 'S' and ie_situacao = 'A')

union all

--Efeito massa intracraniana 24H
select 
distinct(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12048 /*Efeito massa intracraniana*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end)complication_value,
(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12048 /*Efeito massa intracraniana*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end) enable_value,
a.nr_atendimento visit_id,
to_char(a.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') complicationdate,
a.nr_sequencia complication_id,
'B08' complication_code, -- Codigo para enviar para EPIMED
to_char(LOCALTIMESTAMP + interval '18 days'/24/60/60,'YYYY-MM-DD"T"HH24:MI:SS."000"') updatetimestamp,
to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
A.CD_ESTABELECIMENTO CD_MULTI_EMPRESA,
(a.NR_SEQUENCIA||b.NR_SEQ_ITEM) RECORDID
from MED_AVALIACAO_PACIENTE a, med_avaliacao_result b
where a.nr_sequencia = b.nr_seq_avaliacao
and a.nr_seq_tipo_avaliacao = 354 -- cod da avaliacao
AND b.NR_SEQ_ITEM = 12048
and a.dt_liberacao is not null
and obter_setor_atual_paciente(a.NR_ATENDIMENTO) in (select cd_setor_atendimento 
            from SETOR_ATENDIMENTO where IE_EPIMED = 'S' and ie_situacao = 'A')

union all

--Neutropenia 24H
select 
distinct(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12049 /*Neutropenia*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end)complication_value,
(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12049 /*Neutropenia*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' END) enable_value,
a.nr_atendimento visit_id,
to_char(a.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') complicationdate,
a.nr_sequencia complication_id,
'B09' complication_code, -- Codigo para enviar para EPIMED
to_char(LOCALTIMESTAMP + interval '19 days'/24/60/60,'YYYY-MM-DD"T"HH24:MI:SS."000"') updatetimestamp,
to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
A.CD_ESTABELECIMENTO CD_MULTI_EMPRESA,
(a.NR_SEQUENCIA||b.NR_SEQ_ITEM) RECORDID
from MED_AVALIACAO_PACIENTE a, med_avaliacao_result b
where a.nr_sequencia = b.nr_seq_avaliacao
and a.nr_seq_tipo_avaliacao = 354 -- cod da avaliacao
AND b.NR_SEQ_ITEM = 12049
and a.dt_liberacao is not null
and obter_setor_atual_paciente(a.NR_ATENDIMENTO) in (select cd_setor_atendimento 
            from SETOR_ATENDIMENTO where IE_EPIMED = 'S' and ie_situacao = 'A')

union all

--Parada Cardiorrespiratoria 24H
select 
distinct(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12050 /*Parada Cardiorrespiratoria*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' END)complication_value,
(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12050 /*Parada Cardiorrespiratoria*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end) enable_value,
a.nr_atendimento visit_id,
to_char(a.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') complicationdate,
a.nr_sequencia complication_id,
'B10' complication_code, -- Codigo para enviar para EPIMED
to_char(LOCALTIMESTAMP + interval '20 days'/24/60/60,'YYYY-MM-DD"T"HH24:MI:SS."000"') updatetimestamp,
to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
A.CD_ESTABELECIMENTO CD_MULTI_EMPRESA,
(a.NR_SEQUENCIA||b.NR_SEQ_ITEM) RECORDID
from MED_AVALIACAO_PACIENTE a, med_avaliacao_result b
where a.nr_sequencia = b.nr_seq_avaliacao
and a.nr_seq_tipo_avaliacao = 354 -- cod da avaliacao
AND b.NR_SEQ_ITEM = 12050
and a.dt_liberacao is not null
and a.nr_atendimento in ( select distinct v.nr_atendimento from epimed_internados_v v)
and obter_setor_atual_paciente(a.NR_ATENDIMENTO) in (select cd_setor_atendimento 
            from SETOR_ATENDIMENTO where IE_EPIMED = 'S' and ie_situacao = 'A')

union all

--Hemorragia Digestiva 24H
select 
distinct(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12051 /*Hemorragia Digestiva*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end)complication_value,
(case when obter_Resultado_Avaliacao(b.nr_seq_avaliacao, 12051 /*Hemorragia Digestiva*/
,a.nr_seq_tipo_avaliacao,a.nr_atendimento) = 'Sim'
AND a.IE_SITUACAO = 'A' then '1' else '0' end) ENABLE,
a.nr_atendimento visit_id,
to_char(a.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') complicationdate,
a.nr_sequencia complication_id,
'B11' complication_code, -- Codigo para enviar para EPIMED
to_char(LOCALTIMESTAMP + interval '21 days'/24/60/60,'YYYY-MM-DD"T"HH24:MI:SS."000"') updatetimestamp,
to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
A.CD_ESTABELECIMENTO CD_MULTI_EMPRESA,
(a.NR_SEQUENCIA||b.NR_SEQ_ITEM) RECORDID
from MED_AVALIACAO_PACIENTE a, med_avaliacao_result b
where a.nr_sequencia = b.nr_seq_avaliacao
and a.nr_seq_tipo_avaliacao = 354 -- cod da avaliacao
AND b.NR_SEQ_ITEM = 12051
and a.dt_liberacao is not null
and a.nr_atendimento in ( select distinct v.nr_atendimento from epimed_internados_v v)
and obter_setor_atual_paciente(a.NR_ATENDIMENTO) in (select cd_setor_atendimento 
            from SETOR_ATENDIMENTO where IE_EPIMED = 'S' and ie_situacao = 'A');

