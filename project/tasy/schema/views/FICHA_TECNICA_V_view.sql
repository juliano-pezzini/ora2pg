-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ficha_tecnica_v (nr_ficha_tecnica, cd_estabelecimento, nm_usuario, dt_atualizacao, dt_alteracao, ie_situacao, nr_nivel_estrutura, cd_material, ie_origem_proced, cd_procedimento, qt_lote_padrao, cd_centro_controle, ie_calcula_conta, nr_seq_proc_interno, ds_observacao, ie_tipo_ficha, ie_solicita_componente, nr_seq_exame, cd_setor_atendimento, qt_alerta_estabilidade, ie_revisado, dt_atualizacao_nrec, nm_usuario_nrec, ds_material, cd_unidade_medida, ds_procedimento, ds_mat_proc) AS select	a.NR_FICHA_TECNICA,a.CD_ESTABELECIMENTO,a.NM_USUARIO,a.DT_ATUALIZACAO,a.DT_ALTERACAO,a.IE_SITUACAO,a.NR_NIVEL_ESTRUTURA,a.CD_MATERIAL,a.IE_ORIGEM_PROCED,a.CD_PROCEDIMENTO,a.QT_LOTE_PADRAO,a.CD_CENTRO_CONTROLE,a.IE_CALCULA_CONTA,a.NR_SEQ_PROC_INTERNO,a.DS_OBSERVACAO,a.IE_TIPO_FICHA,a.IE_SOLICITA_COMPONENTE,a.NR_SEQ_EXAME,a.CD_SETOR_ATENDIMENTO,a.QT_ALERTA_ESTABILIDADE,a.IE_REVISADO,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC,
	m.ds_material,
	coalesce(substr(obter_dados_material_estab(m.cd_material,a.cd_estabelecimento,'UMS'),1,30),'UN') cd_unidade_medida,
	p.ds_procedimento,
	coalesce(m.ds_material,p.ds_procedimento) ds_mat_proc
FROM ficha_tecnica a
LEFT OUTER JOIN material m ON (a.cd_material = m.cd_material)
LEFT OUTER JOIN procedimento p ON (a.cd_procedimento = p.cd_procedimento AND a.ie_origem_proced = p.ie_origem_proced);

