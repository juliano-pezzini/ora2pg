-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_diagnostico_sae_v (nr_atendimento, cd_pessoa_fisica, cd_medico_resp, ie_tipo_atendimento, ie_clinica, dt_entrada, dt_alta, cd_motivo_alta, cd_procedencia, ie_tipo_convenio, cd_estabelecimento, cd_convenio, cd_categoria, cd_plano_convenio, ds_convenio, dt_inicio_vigencia, dt_final_vigencia, cd_setor_atendimento, cd_unidade_basica, cd_unidade_compl, ds_setor_atendimento, nr_doc_convenio, cd_usuario_convenio, cd_senha, dt_validade_carteira, nr_doc_conv_principal, nr_seq_queixa, nr_seq_classificacao, ie_tipo_atend_tiss, nr_atend_original, nr_seq_origem, dt_entrada_unidade, dt_saida_unidade, dt_saida_interno, dt_alta_medico, dt_inicio_atendimento, dt_fim_triagem, nr_seq_local_pa, dt_alta_interno, cd_classif_setor, dt_cancelamento, cd_empresa, cd_unidade, nm_usuario_troca, ie_carater_inter_sus, nr_seq_triagem, nr_seq_triagem_prioridade, cd_motivo_alta_medica, nm_usuario_alta_medica, ie_nivel_atencao, dt_prescricao, nm_prescritor, nm_paciente, nr_seq_diagnostico, ds_diagnostico, ds_tipo_atendimento, ds_setor_sae, cd_setor_sae, nr_seq_diag, cd_prescritor) AS select	d.NR_ATENDIMENTO,d.CD_PESSOA_FISICA,d.CD_MEDICO_RESP,d.IE_TIPO_ATENDIMENTO,d.IE_CLINICA,d.DT_ENTRADA,d.DT_ALTA,d.CD_MOTIVO_ALTA,d.CD_PROCEDENCIA,d.IE_TIPO_CONVENIO,d.CD_ESTABELECIMENTO,d.CD_CONVENIO,d.CD_CATEGORIA,d.CD_PLANO_CONVENIO,d.DS_CONVENIO,d.DT_INICIO_VIGENCIA,d.DT_FINAL_VIGENCIA,d.CD_SETOR_ATENDIMENTO,d.CD_UNIDADE_BASICA,d.CD_UNIDADE_COMPL,d.DS_SETOR_ATENDIMENTO,d.NR_DOC_CONVENIO,d.CD_USUARIO_CONVENIO,d.CD_SENHA,d.DT_VALIDADE_CARTEIRA,d.NR_DOC_CONV_PRINCIPAL,d.NR_SEQ_QUEIXA,d.NR_SEQ_CLASSIFICACAO,d.IE_TIPO_ATEND_TISS,d.NR_ATEND_ORIGINAL,d.NR_SEQ_ORIGEM,d.DT_ENTRADA_UNIDADE,d.DT_SAIDA_UNIDADE,d.DT_SAIDA_INTERNO,d.DT_ALTA_MEDICO,d.DT_INICIO_ATENDIMENTO,d.DT_FIM_TRIAGEM,d.NR_SEQ_LOCAL_PA,d.DT_ALTA_INTERNO,d.CD_CLASSIF_SETOR,d.DT_CANCELAMENTO,d.CD_EMPRESA,d.CD_UNIDADE,d.NM_USUARIO_TROCA,d.IE_CARATER_INTER_SUS,d.NR_SEQ_TRIAGEM,d.NR_SEQ_TRIAGEM_PRIORIDADE,d.CD_MOTIVO_ALTA_MEDICA,d.NM_USUARIO_ALTA_MEDICA,d.IE_NIVEL_ATENCAO,
	a.dt_prescricao, 
	substr(obter_nome_pf(a.cd_prescritor),1,200) nm_prescritor, 
	substr(obter_nome_pf(d.cd_pessoa_fisica),1,200) nm_paciente, 
	c.nr_sequencia nr_seq_diagnostico, 
	c.ds_diagnostico, 
	substr(obter_valor_dominio(12,d.ie_tipo_atendimento),1,80) ds_tipo_atendimento, 
	substr(obter_nome_setor(a.cd_setor_atendimento),1,80) ds_setor_sae, 
	a.cd_setor_atendimento cd_setor_sae, 
	b.nr_seq_diag, 
	a.cd_prescritor 
FROM	resumo_atendimento_paciente_v d, 
	pe_prescricao a, 
	pe_prescr_diag b, 
	pe_diagnostico c 
where	d.nr_atendimento	= a.nr_atendimento 
and	a.nr_sequencia		= b.nr_seq_prescr 
and	c.nr_sequencia		= b.nr_seq_diag 
and	a.dt_inativacao is null;

