-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW custo_padrao_v (cd_estabelecimento, cd_tabela_custo, nr_ficha_tecnica, vl_custo_fixo, vl_custo_variavel, ie_situacao_calculo, vl_custo_total, dt_alteracao, ie_situacao, nr_nivel_estrutura, cd_material, cd_procedimento, ie_origem_proced, nr_seq_proc_interno, nr_seq_exame, qt_lote_padrao, ds_material, ds_proc_interno, ds_procedimento, ds_exame, ds_mat_proc, cd_mat_proc, cd_grupo_proc, cd_especialidade, cd_area_procedimento, ie_calcula_conta, ds_observacao, nr_seq_tabela) AS select /* +ordered */
	a.cd_estabelecimento,
	a.cd_tabela_custo,
	a.nr_ficha_tecnica,
	a.vl_custo_fixo,
	a.vl_custo_variavel,
	a.ie_situacao_calculo,
	(a.vl_custo_fixo + a.vl_custo_variavel) vl_custo_total,
	b.dt_alteracao,
	b.ie_situacao,
	b.nr_nivel_estrutura,
	b.cd_material,
	b.cd_procedimento,
	b.ie_origem_proced,
	b.nr_seq_proc_interno,
	b.nr_seq_exame,
	b.qt_lote_padrao,
	substr(obter_desc_material(b.cd_material),1,255) ds_material,
	substr(obter_desc_proc_interno(b.nr_seq_proc_interno),1,255) ds_proc_interno,
	substr(obter_descricao_procedimento(b.cd_procedimento, b.ie_origem_proced),1,255) ds_procedimento,
	substr(obter_desc_exame(b.nr_seq_exame),1,255) ds_exame,
	substr(cus_obter_desc_ficha_tecnica(b.nr_ficha_tecnica),1,255) ds_mat_proc,
	coalesce(CASE WHEN b.cd_material IS NULL THEN  b.cd_procedimento  ELSE b.cd_material END ,nr_seq_proc_interno) cd_mat_proc,
	(substr(obter_grupo_procedimento(b.cd_procedimento,b.ie_origem_proced,'C'),1,15))::numeric  cd_grupo_proc,
	(substr(obter_especialidade_proced(b.cd_procedimento,b.ie_origem_proced),1,15))::numeric  cd_especialidade,
	(substr(obter_area_procedimento(b.cd_procedimento,b.ie_origem_proced),1,15))::numeric  cd_area_procedimento,
	coalesce(ie_calcula_conta,'S') ie_calcula_conta,
	b.ds_observacao,
	a.nr_seq_tabela
FROM	custo_padrao a,
	ficha_tecnica b
where a.nr_ficha_tecnica	= b.nr_ficha_tecnica;

