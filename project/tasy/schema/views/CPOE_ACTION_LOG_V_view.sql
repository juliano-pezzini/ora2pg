-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW cpoe_action_log_v (ds_sigla, nr_seq_grid_cpoe, nr_sequencia, nr_seq_cpoe_anterior, ds_item, dt_liberacao, dt_lib_suspensao, dt_suspensao, nr_atendimento, dt_atualizacao_nrec, dt_fim, nm_usuario, cd_pessoa_fisica, cd_medico, ie_exige_ciencia, dt_ciencia_medico, ie_ordered_on_behalf, nm_maquina, cd_maquina_ip) AS select	'N' ds_sigla, /*Dietas*/

	1 nr_seq_grid_cpoe,
	nr_sequencia,
	nr_seq_cpoe_anterior,
	cpoe_obter_ds_dieta(ie_tipo_dieta, cd_dieta, cd_material, cd_mat_prod1, nr_seq_tipo, dt_liberacao, 'S', dt_lib_suspensao, dt_suspensao) ds_item,
	dt_liberacao,
	dt_lib_suspensao,
	dt_suspensao,
	nr_atendimento,
	dt_atualizacao_nrec,
	dt_fim,
	nm_usuario,
	cd_pessoa_fisica,
 ' ' cd_medico,
  'N' IE_EXIGE_CIENCIA,
  null DT_CIENCIA_MEDICO,
  'N' IE_ORDERED_ON_BEHALF,
  nm_maquina,
  cd_maquina_ip
FROM	cpoe_dieta
where	dt_atualizacao_nrec > (LOCALTIMESTAMP - interval '5 days')

union

select	'M' ds_sigla, /*Material*/

	2 nr_seq_grid_cpoe,
	nr_sequencia,
	nr_seq_cpoe_anterior,
	cpoe_obter_desc_info_material(cd_material, cd_mat_comp1, qt_dose_comp1, cd_unid_med_dose_comp1, cd_mat_comp2, qt_dose_comp2, cd_unid_med_dose_comp2,cd_mat_comp3, qt_dose_comp3, cd_unid_med_dose_comp3,
						cd_mat_dil,qt_dose_dil, cd_unid_med_dose_dil, cd_mat_red, qt_dose_red, cd_unid_med_dose_red, dt_liberacao, qt_dose, cd_unidade_medida, ie_via_aplicacao, cd_intervalo, dt_lib_suspensao, dt_suspensao,
						ie_administracao, nr_seq_ataque, nr_seq_procedimento, nr_seq_adicional, nr_seq_hemoterapia, ds_dose_diferenciada,
						ds_dose_diferenciada_dil, ds_dose_diferenciada_red, ds_dose_diferenciada_comp1,ds_dose_diferenciada_comp2,ds_dose_diferenciada_comp3,
						cd_mat_comp4, qt_dose_comp4, cd_unid_med_dose_comp4, ds_dose_diferenciada_comp4, cd_mat_comp5, qt_dose_comp5, cd_unid_med_dose_comp5,
						ds_dose_diferenciada_comp5, cd_mat_comp6, qt_dose_comp6, cd_unid_med_dose_comp6, ds_dose_diferenciada_comp6) ds_item,
	dt_liberacao,
	dt_lib_suspensao,
	dt_suspensao,
	nr_atendimento,
	dt_atualizacao_nrec,
	dt_fim,
	nm_usuario,
	cd_pessoa_fisica,
   cd_medico,
 IE_EXIGE_CIENCIA,
DT_CIENCIA_MEDICO,
IE_ORDERED_ON_BEHALF,
  nm_maquina,
  cd_maquina_ip
from	cpoe_material
where	dt_atualizacao_nrec > (LOCALTIMESTAMP - interval '5 days')

union

select	'G' ds_sigla, /* Gasoterapia */

	4 nr_seq_grid_cpoe,
	nr_sequencia,
	nr_seq_cpoe_anterior,
	cpoe_obter_desc_grid_gas(SUBSTR(cpoe_obter_desc_gas(nr_seq_gas,dt_liberacao),1,254), qt_gasoterapia, cpoe_obter_desc_unid_med_gas(ie_unidade_medida), SUBSTR(obter_valor_dominio(1299, ie_respiracao),1,200), SUBSTR(obter_desc_intervalo_prescr(cd_intervalo),1,255), dt_lib_suspensao, dt_suspensao) ds_item,
	dt_liberacao,
	dt_lib_suspensao,
	dt_suspensao,
	nr_atendimento,
	dt_atualizacao_nrec,
	dt_fim,
	nm_usuario,
	cd_pessoa_fisica,
  ' 'cd_medico,
  'N' IE_EXIGE_CIENCIA,
  null DT_CIENCIA_MEDICO,
  'N' IE_ORDERED_ON_BEHALF,
  nm_maquina,
  cd_maquina_ip
from	cpoe_gasoterapia
where	dt_atualizacao_nrec > (LOCALTIMESTAMP - interval '5 days')

union

select	'P' ds_sigla, /* Procedimento */

	3 nr_seq_grid_cpoe,
	nr_sequencia,
	nr_seq_cpoe_anterior,
	cpoe_obter_desc_grid_proc(SUBSTR(cpoe_obter_desc_proc_interno(nr_seq_proc_interno),1,255), cd_intervalo, qt_procedimento, cd_mat_proc1, qt_dose_mat1, cd_unid_medida_dose_mat1, ie_assoc_adep1, cd_mat_proc2, qt_dose_mat2, cd_unid_medida_dose_mat2, ie_assoc_adep2, cd_mat_proc3, qt_dose_mat3, cd_unid_medida_dose_mat3, ie_assoc_adep3, cd_mat_proc4, qt_dose_mat4, cd_unid_medida_dose_mat4, ie_assoc_adep4, cd_mat_proc5, qt_dose_mat5, cd_unid_medida_dose_mat5, ie_assoc_adep5, dt_lib_suspensao,dt_suspensao, ie_administracao, null, null, cd_mat_proc6, qt_dose_mat6, cd_unid_medida_dose_mat6, ie_assoc_adep6, cd_mat_proc7, qt_dose_mat7, cd_unid_medida_dose_mat7, ie_assoc_adep7) ds_item,
	dt_liberacao,
	dt_lib_suspensao,
	dt_suspensao,
	nr_atendimento,
	dt_atualizacao_nrec,
	dt_fim,
	nm_usuario,
	cd_pessoa_fisica,
  cd_medico,
  IE_EXIGE_CIENCIA,
  DT_CIENCIA_MEDICO,
  IE_ORDERED_ON_BEHALF,
  nm_maquina,
  cd_maquina_ip
from	cpoe_procedimento
where	dt_atualizacao_nrec > (LOCALTIMESTAMP - interval '5 days')

union

select	'R' ds_sigla,  /*Recomend	acao*/

	5 nr_seq_grid_cpoe,
	nr_sequencia,
	nr_seq_cpoe_anterior,
	cpoe_obter_desc_grid_recom(SUBSTR(cpoe_obter_desc_recomendacao(cd_recomendacao,dt_liberacao),1,255), SUBSTR(obter_desc_intervalo_prescr(cd_intervalo),1,255), dt_lib_suspensao, dt_suspensao) ds_item,
	dt_liberacao,
	dt_lib_suspensao,
	dt_suspensao,
	nr_atendimento,
	dt_atualizacao_nrec,
	dt_fim,
	nm_usuario,
	cd_pessoa_fisica,
 ' '  cd_medico,
 'N' IE_EXIGE_CIENCIA,
  null DT_CIENCIA_MEDICO,
  'N' IE_ORDERED_ON_BEHALF,
  nm_maquina,
  cd_maquina_ip
from	cpoe_recomendacao
where	dt_atualizacao_nrec > (LOCALTIMESTAMP - interval '5 days')

union

select	'H' ds_sigla,  /*Hemoterapia*/

	6 nr_seq_grid_cpoe,
	nr_sequencia,
	nr_seq_cpoe_anterior,
	cpoe_obter_ds_hemoterapia(nr_sequencia, dt_liberacao, 'S', dt_lib_suspensao, dt_suspensao, ie_tipo, qt_procedimento, ie_reserva) ds_item,
	dt_liberacao,
	dt_lib_suspensao,
	dt_suspensao,
	nr_atendimento,
	dt_atualizacao_nrec,
	dt_fim,
	nm_usuario,
	cd_pessoa_fisica,
  ' ' cd_medico,
  'N' IE_EXIGE_CIENCIA,
  null DT_CIENCIA_MEDICO,
  'N' IE_ORDERED_ON_BEHALF,
  nm_maquina,
  cd_maquina_ip
from	cpoe_hemoterapia
where	dt_atualizacao_nrec > (LOCALTIMESTAMP - interval '5 days')

union

select	'D' ds_sigla,  /*Dialise*/

	7 nr_seq_grid_cpoe,
	nr_sequencia,
	nr_seq_cpoe_anterior,
	CPOE_Obter_desc_dialise(ie_tipo_dialise, nr_seq_protocolo, dt_lib_suspensao, dt_suspensao, qt_fluxo_sangue, qt_hora_min_sessao, 'S', ie_hemodialise, ie_tipo_peritoneal, qt_volume_ciclo, qt_hora_min_duracao, ie_categoria) ds_item,
	dt_liberacao,
	dt_lib_suspensao,
	dt_suspensao,
	nr_atendimento,
	dt_atualizacao_nrec,
	dt_fim,
	nm_usuario,
	cd_pessoa_fisica,
  ' ' cd_medico,
  'N' IE_EXIGE_CIENCIA,
  null DT_CIENCIA_MEDICO,
  'N' IE_ORDERED_ON_BEHALF,
  nm_maquina,
  cd_maquina_ip
from	cpoe_dialise
where	dt_atualizacao_nrec > (LOCALTIMESTAMP - interval '5 days')

union

select	'AP' ds_sigla,  /*Anatomia pato*/

	8 nr_seq_grid_cpoe,
	nr_sequencia,
	nr_seq_cpoe_anterior,
	cpoe_obter_desc_grid_proc(substr(cpoe_obter_desc_proc_interno(nr_seq_proc_interno),1,255), null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, dt_lib_suspensao,dt_suspensao, ie_administracao) ds_item,
	dt_liberacao,
	dt_lib_suspensao,
	dt_suspensao,
	nr_atendimento,
	dt_atualizacao_nrec,
	dt_fim,
	nm_usuario,
	cd_pessoa_fisica,
  ' ' cd_medico,
  'N' IE_EXIGE_CIENCIA,
  null DT_CIENCIA_MEDICO,
  'N' IE_ORDERED_ON_BEHALF,
  nm_maquina,
  cd_maquina_ip
from	CPOE_ANATOMIA_PATOLOGICA
where	dt_atualizacao_nrec > (LOCALTIMESTAMP - interval '5 days');

