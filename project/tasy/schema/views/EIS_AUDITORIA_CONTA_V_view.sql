-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_auditoria_conta_v (nr_sequencia, cd_estabelecimento, dt_referencia, ie_proc_mat, dt_atualizacao, nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec, cd_auditor, ie_tipo_auditoria, cd_auditor_externo, cd_setor_atendimento, cd_local_estoque, nr_seq_motivo, cd_convenio, nr_interno_conta, dt_auditoria, cd_material, cd_procedimento, ie_origem_proced, qt_original, qt_ajuste, vl_original, vl_ajuste, nm_usuario_orig_item, cd_categoria, qt_ch, ie_tipo_audit_item, qt_amenor, qt_amaior, vl_amenor, vl_amaior, cd_responsavel, ie_tipo_atendimento, dt_liberacao, nm_auditor_audit, ie_contra_auditoria, ds_contra_auditoria, nm_auditor, nm_auditor_externo, ds_tipo_auditoria, ds_proc_mat, ds_setor_atendimento, ds_local_estoque, cd_empresa, ds_convenio, ds_categoria, ds_tipo_audit_item, ds_grupo_material, ds_subgrupo_material, ds_classe_material, ds_material, ds_grupo_proc, ds_especialidade, ds_area_procedimento, ds_procedimento, ds_motivo_auditoria, nr_tipo_audit, ds_classif_motivo, ds_plano, nm_responsavel, ds_tipo_atendimento) AS select	a.NR_SEQUENCIA,a.CD_ESTABELECIMENTO,a.DT_REFERENCIA,a.IE_PROC_MAT,a.DT_ATUALIZACAO,a.NM_USUARIO,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC,a.CD_AUDITOR,a.IE_TIPO_AUDITORIA,a.CD_AUDITOR_EXTERNO,a.CD_SETOR_ATENDIMENTO,a.CD_LOCAL_ESTOQUE,a.NR_SEQ_MOTIVO,a.CD_CONVENIO,a.NR_INTERNO_CONTA,a.DT_AUDITORIA,a.CD_MATERIAL,a.CD_PROCEDIMENTO,a.IE_ORIGEM_PROCED,a.QT_ORIGINAL,a.QT_AJUSTE,a.VL_ORIGINAL,a.VL_AJUSTE,a.NM_USUARIO_ORIG_ITEM,a.CD_CATEGORIA,a.QT_CH,a.IE_TIPO_AUDIT_ITEM,a.QT_AMENOR,a.QT_AMAIOR,a.VL_AMENOR,a.VL_AMAIOR,a.CD_RESPONSAVEL,a.IE_TIPO_ATENDIMENTO,a.DT_LIBERACAO,a.NM_AUDITOR_AUDIT,a.IE_CONTRA_AUDITORIA,a.DS_CONTRA_AUDITORIA,
	CASE WHEN nm_auditor_audit IS NULL THEN  substr(obter_nome_pf(cd_auditor),1,200)  ELSE nm_auditor_audit END  nm_auditor, 
	substr(obter_nome_pf(cd_auditor_externo),1,200) nm_auditor_externo, 
	CASE WHEN ie_tipo_auditoria='I' THEN 'Interna' WHEN ie_tipo_auditoria='E' THEN 'Externa' END  ds_tipo_auditoria, 
	CASE WHEN ie_proc_mat='P' THEN 'Procedimento/Serviços' WHEN ie_proc_mat='M' THEN 'Materiais/Medicamentos' END  ds_proc_mat, 
	substr(obter_nome_setor(cd_setor_atendimento), 1, 200) ds_setor_atendimento, 
	substr(obter_desc_local_estoque(cd_local_estoque),1,200) ds_local_estoque, 
	--substr(obter_empresa_estab(a.cd_estabelecimento),1,200) cd_empresa,	 
	b.cd_empresa cd_empresa, 
	substr(obter_nome_convenio(a.cd_convenio),1,200) ds_convenio, 
	substr(obter_nome_convenio(a.cd_convenio) || ' - '|| obter_categoria_convenio(a.cd_convenio,a.cd_categoria) ,1,200) ds_categoria, 
	CASE WHEN a.ie_tipo_audit_item='A' THEN 'Ajuste' WHEN a.ie_tipo_audit_item='C' THEN 'Troca conv.' WHEN a.ie_tipo_audit_item='E' THEN 'Execução' WHEN a.ie_tipo_audit_item='S' THEN 'Troca setor' WHEN a.ie_tipo_audit_item='D' THEN 'Auditado' WHEN a.ie_tipo_audit_item='X' THEN 'Excluído da conta' WHEN a.ie_tipo_audit_item='V' THEN 'Alteração valor' END  ds_tipo_audit_item, 
	substr(obter_desc_estrut_mat(obter_estrutura_material(a.cd_material,'G'),null,null,null),1,60) ds_grupo_material, 
	substr(obter_desc_estrut_mat(null,obter_estrutura_material(a.cd_material,'S'),null,null),1,60) ds_subgrupo_material, 
	substr(obter_desc_estrut_mat(null,null,obter_estrutura_material(a.cd_material,'C'),null),1,60) ds_classe_material, 
	substr(obter_desc_estrut_mat(null,null,null,a.cd_material),1,60) ds_material, 
	substr(obter_grupo_procedimento(a.cd_procedimento, a.ie_origem_proced,'D'),1,150) ds_grupo_proc, 
	substr(obter_desc_estrut_proc(null, obter_especialidade_proced(a.cd_procedimento, a.ie_origem_proced), null, null,null),1,150) ds_especialidade, 
	substr(obter_desc_estrut_proc(obter_area_procedimento(a.cd_procedimento, a.ie_origem_proced),null,null,null, null),1,150) ds_area_procedimento, 
	substr(obter_desc_estrut_proc(null, null, null, a.cd_procedimento, a.ie_origem_proced),1,200) ds_procedimento, 
	substr(obter_motivo_auditoria(a.nr_seq_motivo),1,120) ds_motivo_auditoria, 
	CASE WHEN a.ie_tipo_auditoria='I' THEN 0 WHEN a.ie_tipo_auditoria='E' THEN 1  ELSE 0 END  nr_tipo_audit, 
	substr(obter_classif_motivo_auditoria(nr_seq_motivo),1,150) ds_classif_motivo, 
	substr(Obter_Plano_Convenio_Atend(Obter_Atendimento_Conta(nr_interno_conta),'D'),1,150) ds_plano, 
	substr(obter_nome_pf(a.cd_responsavel),1,200) nm_responsavel, 
	substr(obter_nome_tipo_atend(ie_tipo_atendimento),1,30) ds_tipo_atendimento 
FROM	eis_auditoria_conta a, 
	estabelecimento	b 
where 	a.cd_estabelecimento = b.cd_estabelecimento;

