-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW tiss_dados_executante_v (ds_tipo_logradouro, ds_versao, ie_origem, ds_endereco, nr_endereco, ds_complemento, ds_municipio, sg_estado, cd_municipio_ibge, cd_cep, cd_cgc, ds_razao_social, cd_cnes, nr_atendimento, cd_interno, nr_interno_conta, nr_seq_protocolo, nm_medico_executor, uf_crm, sg_conselho, cd_cbo_saude, nr_seq_retorno, nr_cpf, ie_honorario) AS select	lpad(coalesce(m.CD_TIPO_LOGRADOURO, '081'),3,'0') ds_tipo_logradouro,
	'2.01.01' ds_versao,
	'AP' ie_origem,
	c.ds_endereco,
	c.nr_endereco,
	c.ds_complemento,
	c.ds_municipio,
	c.sg_estado,
	substr(lpad(coalesce(c.cd_municipio_ibge, OBTER_MUNICIPIO_IBGE(somente_numero(c.cd_cep))),7,'0'),1,25) cd_municipio_ibge,
	lpad(to_char(somente_numero(c.cd_cep)),8,'0') cd_cep,
	coalesce(TISS_OBTER_DADOS_PEP_FATUR(a.nr_atendimento), c.cd_cgc) cd_cgc,
	substr(coalesce(obter_nome_pf_pj(null, TISS_OBTER_DADOS_PEP_FATUR(a.nr_atendimento)), tiss_eliminar_caractere(c.ds_razao_social)),1,100) ds_razao_social,
	coalesce(b.CD_CNS,c.cd_cnes) cd_cnes,
	a.nr_atendimento,
	coalesce(TISS_OBTER_CODIGO_PRESTADOR(e.cd_convenio, b.cd_estabelecimento, null, coalesce(TISS_OBTER_DADOS_PEP_FATUR(a.nr_atendimento), c.cd_cgc), (null)::numeric , 'CI',NULL,a.ie_tipo_atendimento,d.cd_categoria), Obter_Valor_Conv_Estab(e.cd_convenio, b.cd_estabelecimento, 'CD_INTERNO')) cd_interno,
	(null)::numeric  nr_interno_conta,
	(null)::numeric  nr_seq_protocolo,
	substr(obter_nome_pf(f.cd_pessoa_fisica),1,100) nm_medico_executor,
	f.UF_CRM,
	substr(OBTER_DADOS_MEDICO(f.cd_pessoa_fisica,'SGCRM'),1,20) sg_conselho,
	substr(obter_dados_pf(f.cd_pessoa_fisica, 'CBOS'),1,20) cd_cbo_saude,
	(null)::numeric  nr_seq_retorno,
	substr(obter_dados_pf(f.cd_pessoa_fisica, 'CPF'),1,20) nr_cpf,
	'N' ie_honorario
FROM convenio e, atend_categoria_convenio d, estabelecimento b, pessoa_juridica c
LEFT OUTER JOIN cns_tipo_logradouro m ON (c.nr_seq_tipo_logradouro = m.nr_sequencia)
, atendimento_paciente a
LEFT OUTER JOIN medico f ON (a.cd_medico_atendimento = f.cd_pessoa_fisica)
WHERE a.cd_estabelecimento	= b.cd_estabelecimento and d.nr_atendimento	= a.nr_atendimento and obter_atecaco_atendimento(d.nr_atendimento) = d.nr_seq_interno and d.cd_convenio		= e.cd_convenio and coalesce(TISS_OBTER_DADOS_PEP_FATUR(a.nr_atendimento), b.cd_cgc) = c.cd_cgc
union

select	'081' ds_tipo_logradouro,
	'2.01.01' ds_versao,
	'AP' ie_origem,
	obter_compl_pf(x.cd_medico, 1, 'EN') ds_endereco,
	obter_compl_pf(x.cd_medico, 1, 'NR') nr_endereco,
	obter_compl_pf(x.cd_medico, 1, 'CO') ds_complemento,
	obter_compl_pf(x.cd_medico, 1, 'CI') ds_municipio,
	obter_compl_pf(x.cd_medico, 1, 'UF') sg_estado,
	substr(lpad(OBTER_MUNICIPIO_IBGE(somente_numero(obter_compl_pf(x.cd_medico, 1, 'CEP'))),7,'0'),1,25) cd_municipio_ibge,
	lpad(to_char(somente_numero(obter_compl_pf(x.cd_medico, 1, 'CEP'))),8,'0') cd_cep,
	substr(obter_dados_pf(x.cd_medico, 'CPF'),1,20) cd_cgc,
	substr(obter_nome_pf(x.cd_medico),1,100) ds_razao_social,
	b.CD_CNS cd_cnes,
	a.nr_atendimento,
	TISS_OBTER_CODIGO_PRESTADOR(e.cd_convenio, b.cd_estabelecimento, x.cd_medico, null, (null)::numeric , 'CI',NULL,a.ie_tipo_atendimento,d.cd_categoria,x.ie_funcao_medico) cd_interno,
	(null)::numeric  nr_interno_conta,
	(null)::numeric  nr_seq_protocolo,
	substr(obter_nome_pf(x.cd_medico),1,100) nm_medico_executor,
	f.UF_CRM,
	substr(OBTER_DADOS_MEDICO(x.cd_medico,'SGCRM'),1,20) sg_conselho,
	substr(obter_dados_pf(x.cd_medico, 'CBOS'),1,20) cd_cbo_saude,
	(null)::numeric  nr_seq_retorno,
	substr(obter_dados_pf(x.cd_medico, 'CPF'),1,20) nr_cpf,
	'S' ie_honorario
FROM pep_med_fatur x, convenio e, atend_categoria_convenio d, estabelecimento b, atendimento_paciente a
LEFT OUTER JOIN medico f ON (a.cd_medico_atendimento = f.cd_pessoa_fisica)
WHERE a.cd_estabelecimento	= b.cd_estabelecimento and x.nr_atendimento	= a.nr_atendimento and d.nr_atendimento	= a.nr_atendimento and obter_atecaco_atendimento(d.nr_atendimento) = d.nr_seq_interno and d.cd_convenio		= e.cd_convenio  
union

select	lpad(coalesce(m.CD_TIPO_LOGRADOURO, '081'),3,'0') ds_tipo_logradouro,
	'2.01.01' ds_versao,
	'PC' ie_origem,
	c.ds_endereco,
	c.nr_endereco,
	c.ds_complemento,
	c.ds_municipio,
	c.sg_estado,
	substr(lpad(coalesce(c.cd_municipio_ibge, OBTER_MUNICIPIO_IBGE(somente_numero(c.cd_cep))),7,'0'),1,25) cd_municipio_ibge,
	lpad(to_char(somente_numero(c.cd_cep)),8,'0') cd_cep,
	c.cd_cgc,
	substr(tiss_eliminar_caractere(c.ds_razao_social),1,100) ds_razao_social,
	coalesce(b.CD_CNS,c.cd_cnes) cd_cnes,
	(null)::numeric  nr_atendimento,
	coalesce(TISS_OBTER_CODIGO_PRESTADOR(e.cd_convenio, b.cd_estabelecimento, null, c.cd_cgc, (null)::numeric , 'CI',NULL,null,null), Obter_Valor_Conv_Estab(e.cd_convenio, b.cd_estabelecimento, 'CD_INTERNO')),
	(null)::numeric  nr_interno_conta,
	a.nr_seq_protocolo,
	null nm_medico_executor,
	null UF_CRM,
	null sg_conselho,
	null cd_cbo_saude,
	(null)::numeric  nr_seq_retorno,
	null nr_cpf,
	'N' ie_honorario
FROM convenio e, estabelecimento b, protocolo_convenio a, pessoa_juridica c
LEFT OUTER JOIN cns_tipo_logradouro m ON (c.nr_seq_tipo_logradouro = m.nr_sequencia)
WHERE a.cd_estabelecimento	= b.cd_estabelecimento and a.cd_convenio		= e.cd_convenio and b.cd_cgc		= c.cd_cgc  
union

select	lpad(coalesce(m.CD_TIPO_LOGRADOURO, '081'),3,'0') ds_tipo_logradouro,
	'2.01.01' ds_versao,
	'RC' ie_origem,
	c.ds_endereco,
	c.nr_endereco,
	c.ds_complemento,
	c.ds_municipio,
	c.sg_estado,
	substr(lpad(coalesce(c.cd_municipio_ibge, OBTER_MUNICIPIO_IBGE(somente_numero(c.cd_cep))),7,'0'),1,25) cd_municipio_ibge,
	lpad(to_char(somente_numero(c.cd_cep)),8,'0') cd_cep,
	c.cd_cgc,
	substr(tiss_eliminar_caractere(c.ds_razao_social),1,100) ds_razao_social,
	coalesce(b.CD_CNS,c.cd_cnes) cd_cnes,
	(null)::numeric  nr_atendimento,
	coalesce(TISS_OBTER_CODIGO_PRESTADOR(e.cd_convenio, b.cd_estabelecimento, null, c.cd_cgc, (null)::numeric , 'CI',NULL,null,null), Obter_Valor_Conv_Estab(e.cd_convenio, b.cd_estabelecimento, 'CD_INTERNO')),
	(null)::numeric  nr_interno_conta,
	(null)::numeric  nr_seq_protocolo,
	null nm_medico_executor,
	null UF_CRM,
	null sg_conselho,
	null cd_cbo_saude,
	a.nr_sequencia nr_seq_retorno,
	null nr_cpf,
	'N' ie_honorario
FROM convenio e, estabelecimento b, convenio_retorno a, pessoa_juridica c
LEFT OUTER JOIN cns_tipo_logradouro m ON (c.nr_seq_tipo_logradouro = m.nr_sequencia)
WHERE a.cd_estabelecimento	= b.cd_estabelecimento and a.cd_convenio		= e.cd_convenio and b.cd_cgc		= c.cd_cgc  
union

select	lpad(coalesce(m.CD_TIPO_LOGRADOURO, '081'),3,'0') ds_tipo_logradouro,
	'2.01.01' ds_versao,
	'CP' ie_origem,
	c.ds_endereco,
	c.nr_endereco,
	c.ds_complemento,
	c.ds_municipio,
	c.sg_estado,
	substr(lpad(coalesce(c.cd_municipio_ibge, OBTER_MUNICIPIO_IBGE(somente_numero(c.cd_cep))),7,'0'),1,25) cd_municipio_ibge,
	lpad(to_char(somente_numero(c.cd_cep)),8,'0') cd_cep,
	c.cd_cgc,
	substr(tiss_eliminar_caractere(c.ds_razao_social),1,100) ds_razao_social,
	coalesce(b.CD_CNS,c.cd_cnes) cd_cnes,
	(null)::numeric  nr_atendimento,
	coalesce(TISS_OBTER_CODIGO_PRESTADOR(e.cd_convenio, b.cd_estabelecimento, null, c.cd_cgc, (null)::numeric , 'CI',NULL,null,a.cd_categoria_parametro), Obter_Valor_Conv_Estab(e.cd_convenio, b.cd_estabelecimento, 'CD_INTERNO')),
	a.nr_interno_conta,
	(null)::numeric  nr_seq_protocolo,
	null nm_medico_executor,
	null UF_CRM,
	null sg_conselho,
	null cd_cbo_saude,
	(null)::numeric  nr_seq_retorno,
	null nr_cpf,
	'N' ie_honorario
FROM convenio e, estabelecimento b, conta_paciente a, pessoa_juridica c
LEFT OUTER JOIN cns_tipo_logradouro m ON (c.nr_seq_tipo_logradouro = m.nr_sequencia)
WHERE a.cd_estabelecimento	= b.cd_estabelecimento and a.cd_convenio_parametro	= e.cd_convenio and b.cd_cgc		= c.cd_cgc  
union

select	lpad(coalesce(m.CD_TIPO_LOGRADOURO, '081'),3,'0') ds_tipo_logradouro,
	'2.01.01' ds_versao,
	'PJ' ie_origem,
	c.ds_endereco,
	c.nr_endereco,
	c.ds_complemento,
	c.ds_municipio,
	c.sg_estado,
	substr(lpad(coalesce(c.cd_municipio_ibge, OBTER_MUNICIPIO_IBGE(somente_numero(c.cd_cep))),7,'0'),1,25) cd_municipio_ibge,
	lpad(to_char(somente_numero(c.cd_cep)),8,'0') cd_cep,
	c.cd_cgc,
	substr(tiss_eliminar_caractere(c.ds_razao_social),1,100) ds_razao_social,
	c.cd_cnes cd_cnes,
	(null)::numeric  nr_atendimento,
	null cd_interno,
	(null)::numeric  nr_interno_conta,
	(null)::numeric  nr_seq_protocolo,
	null nm_medico_executor,
	null UF_CRM,
	null sg_conselho,
	null cd_cbo_saude,
	(null)::numeric  nr_seq_retorno,
	null nr_cpf,
	'N' ie_honorario
FROM pessoa_juridica c
LEFT OUTER JOIN cns_tipo_logradouro m ON (c.nr_seq_tipo_logradouro = m.nr_sequencia                       );

