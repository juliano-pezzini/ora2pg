-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW prescr_material_pend_hora_v (nr_prescricao, dt_prescricao, nr_atendimento, nr_itens, dt_horario, dt_primeiro_horario, dt_liberacao, dt_liberacao_medico, dt_emissao_farmacia, cd_setor_atendimento, ds_setor_atendimento, cd_local_estoque, cd_local_material, ie_urgente, cd_estabelecimento, ie_lib_farm, dt_liberacao_farmacia) AS select	a.nr_prescricao,
	a.dt_prescricao,
	a.nr_atendimento,
	count(*) nr_itens,
	c.dt_horario,
	a.dt_primeiro_horario,
	a.dt_liberacao,
	a.dt_liberacao_medico,
	a.dt_emissao_farmacia,
	a.cd_setor_atendimento,
	s.ds_setor_atendimento,
	s.cd_local_estoque,
	b.cd_local_estoque cd_local_material,
	c.ie_urgente,
	a.cd_estabelecimento,
	a.ie_lib_farm,
	a.dt_liberacao_farmacia
FROM prescr_mat_hor c, prescr_material b, prescr_medica a
LEFT OUTER JOIN setor_atendimento s ON (a.cd_setor_atendimento = s.cd_setor_atendimento)
WHERE a.nr_prescricao		= b.nr_prescricao and b.nr_prescricao		= c.nr_prescricao and b.nr_sequencia		= c.nr_seq_material  and b.cd_motivo_baixa	= 0 and b.ie_medicacao_paciente	<> 'S' and b.ie_suspenso		<> 'S' and a.dt_suspensao is null and c.dt_emissao_farmacia is null and a.dt_emissao_farmacia is null and Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S' group by
	a.nr_prescricao,
	a.dt_prescricao,
	a.nr_atendimento,
	c.dt_horario,
	a.dt_primeiro_horario,
	a.dt_liberacao,
	a.dt_liberacao_medico,
	a.dt_emissao_farmacia,
	a.cd_setor_atendimento,
	s.ds_setor_atendimento,
	s.cd_local_estoque,
	b.cd_local_estoque,
	c.ie_urgente,
	a.cd_estabelecimento,
	a.ie_lib_farm,
	a.dt_liberacao_farmacia;

