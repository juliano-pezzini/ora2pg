-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_proc_participante_v (nr_sequencia, nr_seq_grau_partic, cd_grau_partic_imp, ie_status, nr_seq_conta_proc, cd_medico, nr_seq_prestador, ie_glosa, ie_status_pagamento, ie_gerada_cta_honorario, cd_guia, nr_seq_cbo_saude, cd_procedimento, ie_origem_proced, cd_procedimento_imp, dt_procedimento, dt_procedimento_imp, nr_seq_grau_partic_imp, ds_grau_partic, ds_grau_partic_imp, vl_participante, vl_calculado, vl_glosa, vl_digitado_complemento, ie_status_pagamento_calculado, cd_area_procedimento, cd_especialidade, cd_grupo_proc, nr_seq_grupo_rec, cd_prestador, nr_seq_tipo_prestador, nr_seq_lote_conta, cd_medico_imp, nr_seq_conselho, cd_versao_tiss, cd_cbo_saude_imp) AS select	-- pls_proc_participante
	a.nr_sequencia,
	a.nr_seq_grau_partic,
	a.cd_grau_partic_imp,
	a.ie_status,
	a.nr_seq_conta_proc,
	a.cd_medico,
	a.nr_seq_prestador,
	a.ie_glosa,
	a.ie_status_pagamento,
	a.ie_gerada_cta_honorario,
	a.cd_guia,
	a.nr_seq_cbo_saude,
	-- pls_conta_proc
	b.cd_procedimento,
	b.ie_origem_proced,
	b.cd_procedimento_imp,
	b.dt_procedimento,
	b.dt_procedimento_imp,
	-- functions
	(select	max(nr_sequencia)
	FROM	pls_grau_participacao x
	where	x.cd_tiss = a.cd_grau_partic_imp
	and	x.ie_situacao = 'A') nr_seq_grau_partic_imp,
	(select	x.cd_tiss || ' - ' ||  x.ds_grau_participacao
	from	pls_grau_participacao x
	where	x.nr_sequencia = a.nr_seq_grau_partic) ds_grau_partic,
	(select	max(x.cd_tiss || ' - ' ||  x.ds_grau_participacao)
	from	pls_grau_participacao x
	where	x.cd_tiss = a.cd_grau_partic_imp
	and	x.ie_situacao = 'A') ds_grau_partic_imp,
	coalesce(a.vl_participante, 0) vl_participante,
	coalesce(a.vl_calculado, 0) vl_calculado,
	coalesce(a.vl_glosa, 0) vl_glosa,
	coalesce(a.vl_digitado_complemento, 0) vl_digitado_complemento,
	pls_obter_stat_pag_item(a.ie_glosa, a.vl_participante, a.vl_glosa) ie_status_pagamento_calculado,
	b.cd_area_procedimento,
	b.cd_especialidade,
	b.cd_grupo_proc,
	b.nr_seq_grupo_rec,
	(select	x.cd_prestador
	 from	pls_prestador x
	 where	x.nr_sequencia	= a.nr_seq_prestador) cd_prestador,
	(select	x.nr_seq_tipo_prestador
	 from	pls_prestador x
	 where	x.nr_sequencia	= a.nr_seq_prestador) nr_seq_tipo_prestador,
	b.nr_seq_lote_conta,
	a.cd_medico_imp,
	a.nr_seq_conselho,
	b.cd_versao_tiss,
	a.cd_cbo_saude_imp
from	pls_proc_participante	a,
	pls_conta_proc_v	b
where	b.nr_sequencia	= a.nr_seq_conta_proc;

