-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_ops_copart_pos_nao_cobr_v (ds_preco, ds_regulamentacao, ds_tipo_contratacao, ds_segmentacao, dt_mes_competencia, cd_estabelecimento, nr_seq_conta, ds_tipo_movimento, vl_provisao) AS select	substr(obter_valor_dominio(1669,ie_preco),1,100) ds_preco,
	substr(obter_valor_dominio(2157,ie_regulamentacao),1,100) ds_regulamentacao,
	ds_tipo_contratacao,
	ds_segmentacao,
	pkg_date_utils.start_of(dt_mes_competencia, 'MONTH', 0) dt_mes_competencia,
	cd_estabelecimento,
	nr_seq_conta,
	ds_tipo_movimento,
	vl_provisao
FROM (
	select	v.ie_preco,
		v.ie_regulamentacao,
		v.ds_tipo_contratacao,
		v.ds_segmentacao,
		v.dt_mes_competencia,
		v.cd_estabelecimento,
		v.nr_seq_conta nr_seq_conta,
		v.ie_tipo_contratacao ie_tipo_contratacao,
		substr(obter_desc_expressao(644770),1,30) ds_tipo_movimento,
		v.vl_provisao
	from	pls_conta_pos_dados_contab_v 	v
	where	v.ie_tipo_movto	in ('VLB','X')
	and	coalesce(v.nr_seq_lote_fat,0) = 0
	and	coalesce(v.vl_provisao,0) <> 0
	
union all

	select	n.ie_preco,
		n.ie_regulamentacao,
		substr(obter_valor_dominio(1666, n.ie_tipo_contratacao),1,255) ds_tipo_contratacao,
		substr(obter_valor_dominio(1665, n.ie_segmentacao),1,255) ds_segmentacao,
		p.dt_mes_competencia dt_mes_competencia,
		a.cd_estabelecimento,
		a.nr_sequencia nr_seq_conta,
		n.ie_tipo_contratacao ie_tipo_contratacao,
		substr(obter_desc_expressao(826233),1,30) ds_tipo_movimento,
		c.vl_provisao vl_provisao
	from	pls_conta 			a,
		pls_conta_coparticipacao	b,
		pls_conta_copartic_contab	c,
		pls_protocolo_conta 		p,
		pls_plano			n
	where	a.nr_sequencia			= b.nr_seq_conta
	and	b.nr_sequencia			= c.nr_seq_conta_copartic
	and	a.nr_sequencia			= b.nr_seq_conta
	and	p.nr_sequencia			= a.nr_seq_protocolo
	and	n.nr_sequencia		 	= a.nr_seq_plano
	and	p.ie_tipo_protocolo		in ('C','I')
	and	b.ie_status_coparticipacao	in ('D','S')
	and 	b.ie_status_mensalidade		<> 'C'
	and	b.nr_seq_mensalidade_seg	is null
	and	a.ie_status			= 'F'
	and	coalesce(c.vl_coparticipacao,0)	> 0
	) alias19;

