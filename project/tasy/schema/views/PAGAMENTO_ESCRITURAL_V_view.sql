-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pagamento_escritural_v (tp_registro, cd_cliente, cd_agencia, nm_cliente, cd_banco, nm_banco, dt_gravacao, nr_seq_arquivo, cd_inscricao, nr_inscricao, cd_favorecido, ie_favorecido, ie_tipo_pagamento, cd_banco_destino, cd_agencia_destino, cd_camara_compensacao, nm_credito_destino, ie_correntista, nr_conta_corrente, ie_tipo_documento, nr_compromisso, nr_seq_compromisso, nr_documento, dt_vencimento, vl_compromisso, nr_conta_destino, nr_digito_destino, nm_agencia_destino, ie_tipo_servico, vl_abatimento, cd_barras, ds_mensagem, vl_acrescimo, dt_pagamento, vl_autorizado, cd_moeda, ie_lancamento_individual, nr_remessa, vl_juros_apr, vl_multa_apr, ie_tipo_doc_arrecadacao, ie_contribuinte, cd_identif_contribuinte, nm_contribuinte, dt_periodo, cd_receita_darf, vl_perc_arrecadacao, cd_referencia_darf, vl_darf, vl_inss, ie_aviso_lancto, nm_favorecido, ds_end_favorecido, ds_bairro, ds_cidade, ds_estado, cd_cep, nr_ddd_telefone, nr_telefone, nr_ramal, nr_seq_envio, nr_seq_titulo, cd_ocorrencia, cd_agencia_pagto) AS select 0 tp_registro,
    b.cd_conta cd_cliente, 
    b.cd_agencia_bancaria cd_agencia, 
    p.ds_razao_social nm_cliente, 
    b.cd_banco, 
    c.ds_banco nm_banco, 
    e.dt_remessa_retorno dt_gravacao, 
    e.nr_sequencia nr_seq_arquivo, 
    ' ' cd_inscricao, 
    '0' nr_inscricao, 
    '0' cd_favorecido, 
    ' ' ie_favorecido, 
    ' ' ie_tipo_pagamento, 
    0 cd_banco_destino, 
    '0' cd_agencia_destino, 
    0 cd_camara_compensacao, 
    ' ' nm_credito_destino, 
    ' ' ie_correntista, 
    '0' nr_conta_corrente, 
    ' ' ie_tipo_documento, 
    0 nr_compromisso, 
    ' ' nr_seq_compromisso, 
    0 nr_documento, 
    LOCALTIMESTAMP dt_vencimento, 
    0 vl_compromisso, 
    '0' nr_conta_destino, 
    '0' nr_digito_destino, 
    ' ' nm_agencia_destino, 
    '0' ie_tipo_servico, 
    0 vl_abatimento, 
    '0' cd_barras, 
    ' ' ds_mensagem, 
    0 vl_acrescimo, 
    LOCALTIMESTAMP dt_pagamento, 
    0 vl_autorizado, 
    0 cd_moeda, 
    ' ' ie_lancamento_individual, 
    ' ' nr_remessa, 
    0 vl_juros_apr, 
    0 vl_multa_apr, 
    0 ie_tipo_doc_arrecadacao, 
    0 ie_contribuinte, 
    0 cd_identif_contribuinte, 
    ' ' nm_contribuinte, 
    LOCALTIMESTAMP dt_periodo, 
    0 cd_receita_darf, 
    0 vl_perc_arrecadacao, 
    0 cd_referencia_darf, 
    0 vl_darf, 
    0 vl_inss, 
    ' ' ie_aviso_lancto, 
    ' ' nm_favorecido, 
    ' ' ds_end_favorecido, 
    ' ' ds_bairro, 
    ' ' ds_cidade, 
    ' ' ds_estado, 
    ' ' cd_cep, 
    0000 nr_ddd_telefone, 
    ' ' nr_telefone, 
    0000 nr_ramal, 
    e.nr_sequencia nr_seq_envio, 
    0 nr_seq_titulo, 
    '00' cd_ocorrencia, 
	 '0' cd_agencia_pagto 
FROM banco_estabelecimento b, 
   estabelecimento a, 
   pessoa_juridica p, 
   banco c, 
   banco_escritural e 
where e.cd_estabelecimento 	= a.cd_estabelecimento 
 and e.cd_estabelecimento 	= b.cd_estabelecimento 
 and a.cd_cgc 			= p.cd_cgc 
 and e.cd_banco 			= b.cd_banco 
 and e.cd_banco 			= c.cd_banco 
 and b.ie_tipo_relacao		= 'EP' 

union
 
select 1 tp_registro, 
    b.cd_conta cd_cliente, 
    b.cd_agencia_bancaria cd_agencia, 
    ' ' nm_cliente, 
    0 cd_banco, 
    ' ' nm_banco, 
    LOCALTIMESTAMP dt_gravacao, 
    0 nr_seq_arquivo, 
    '0' || d.ie_favorecido cd_inscricao, 
    e.cd_cgc nr_inscricao, 
    d.cd_favorecido cd_favorecido, 
    d.ie_favorecido, 
    c.ie_tipo_pagamento ie_tipo_pagamento, 
    c.cd_banco cd_banco_destino, 
    c.cd_agencia_bancaria cd_agencia_destino, 
    c.cd_camara_compensacao, 
    ' ' nm_credito_destino, 
    CASE WHEN a.cd_banco=c.cd_banco THEN  'S'   ELSE 'N' END  ie_correntista, 
    CASE WHEN a.cd_banco=c.cd_banco THEN  b.cd_conta  ELSE '0' END  nr_conta_corrente, 
    c.ie_tipo_documento ie_tipo_documento, 
    0 nr_compromisso, 
    '0' nr_seq_compromisso, 
    c.nr_titulo nr_documento, 
    d.dt_vencimento_atual dt_vencimento, 
    d.vl_saldo_titulo vl_compromisso, 
    c.nr_conta nr_conta_destino, 
    c.ie_digito_conta nr_digito_destino, 
    ' ' nm_agencia_destino, 
    c.ie_tipo_servico ie_tipo_servico, 
    d.vl_saldo_titulo vl_abatimento, 
    d.nr_bloqueto cd_barras, 
    ' ' ds_mensagem, 
    c.vl_acrescimo, 
    d.dt_vencimento_atual dt_pagamento, 
    (c.vl_escritural - c.vl_desconto + c.vl_acrescimo) vl_autorizado, 
    c.ie_moeda cd_moeda, 
    'N' ie_lancamento_individual, 
    ' ' nr_remessa, 
    0 vl_juros_apr, 
    0 vl_multa_apr, 
    0 ie_tipo_doc_arrecadacao, 
    0 ie_contribuinte, 
    0 cd_identif_contribuinte, 
    ' ' nm_contribuinte, 
    LOCALTIMESTAMP dt_periodo, 
    0 cd_receita_darf, 
    0 vl_perc_arrecadacao, 
    0 cd_referencia_darf, 
    0 vl_darf, 
    0 vl_inss, 
    ' ' ie_aviso_lancto, 
    d.nm_favorecido, 
    d.ds_endereco ds_end_favorecido, 
    d.ds_bairro, 
    d.ds_cidade,	 d.ds_estado, 
    d.cd_cep, 
    d.nr_ddd_telefone, 
    d.nr_telefone, 
    d.nr_ramal, 
    a.nr_sequencia, 
    c.nr_titulo, 
	 c.cd_ocorrencia, 
	 b.cd_agencia_bancaria cd_agencia_pagto    
from 	titulo_pagar_escrit c, 
   	titulo_pagar_v2 d, 
   	Estabelecimento e, 
   	banco_estabelecimento b, 
   	banco_escritural a 
where c.nr_titulo     	= d.nr_titulo 
 and a.nr_sequencia    	= c.nr_seq_escrit 
 and a.cd_banco     	= b.cd_banco 
 and a.cd_estabelecimento 	= b.cd_estabelecimento 
 and a.cd_estabelecimento 	= e.cd_estabelecimento 
 and b.ie_tipo_relacao		= 'EP' 
 and c.ie_tipo_pagamento	<> 'BLQ' 

union
 
select 2 tp_registro, 
    b.cd_conta cd_cliente, 
    b.cd_agencia_bancaria cd_agencia, 
    ' ' nm_cliente, 
    0 cd_banco, 
    ' ' nm_banco, 
    LOCALTIMESTAMP dt_gravacao, 
    0 nr_seq_arquivo, 
    '0' || d.ie_favorecido cd_inscricao, 
    e.cd_cgc nr_inscricao, 
    d.cd_favorecido, 
    '0' || d.ie_favorecido, 
    c.ie_tipo_pagamento ie_tipo_pagamento, 
    c.cd_banco cd_banco_destino, 
    c.cd_agencia_bancaria cd_agencia_destino, 
    c.cd_camara_compensacao, 
    ' ' nm_credito_destino, 
    CASE WHEN a.cd_banco=c.cd_banco THEN  'S'   ELSE 'N' END  ie_correntista, 
    CASE WHEN a.cd_banco=c.cd_banco THEN  b.cd_conta  ELSE '0' END  nr_conta_corrente, 
    c.ie_tipo_documento ie_tipo_documento, 
    coalesce(d.nr_documento, d.nr_titulo) nr_compromisso, 
    '0' nr_seq_compromisso, 
    c.nr_titulo nr_documento, 
    d.dt_vencimento_atual dt_vencimento, 
    c.vl_escritural vl_compromisso, 
    c.nr_conta nr_conta_destino, 
    c.ie_digito_conta nr_digito_destino, 
    ' ' nm_agencia_destino, 
    c.ie_tipo_servico ie_tipo_servico, 
    c.vl_desconto vl_abatimento, 
    d.nr_bloqueto cd_barras, 
    ' ' ds_mensagem, 
    c.vl_acrescimo, 
    d.dt_vencimento_atual dt_pagamento, 
    (c.vl_escritural - c.vl_desconto + c.vl_acrescimo) vl_autorizado, 
    c.ie_moeda cd_moeda, 
    'N' ie_lancamento_individual, 
    ' ' nr_remessa, 
    0 vl_juros_apr, 
    0 vl_multa_apr, 
    0 ie_tipo_doc_arrecadacao, 
    0 ie_contribuinte, 
    0 cd_identif_contribuinte, 
    ' ' nm_contribuinte, 
    LOCALTIMESTAMP dt_periodo, 
    0 cd_receita_darf, 
    0 vl_perc_arrecadacao, 
    0 cd_referencia_darf, 
    0 vl_darf, 
    0 vl_inss, 
    ' ' ie_aviso_lancto, 
    d.nm_favorecido, 
    d.ds_endereco ds_end_favorecido, 
    d.ds_bairro, 
    d.ds_cidade, 
    d.ds_estado, 
    d.cd_cep, 
    d.nr_ddd_telefone, 
    d.nr_telefone, 
    d.nr_ramal, 
    a.nr_sequencia, 
    c.nr_titulo, 
	 c.cd_ocorrencia, 
	 b.cd_agencia_bancaria cd_agencia_pagto    
from 	titulo_pagar_escrit c, 
   	titulo_pagar_v2 d, 
   	Estabelecimento e, 
   	banco_estabelecimento b, 
   	banco_escritural a 
where c.nr_titulo     	= d.nr_titulo 
 and a.nr_sequencia    	= c.nr_seq_escrit 
 and a.cd_banco      	= b.cd_banco 
 and d.ie_tipo_titulo  	= 1 
 and a.cd_estabelecimento 	= e.cd_estabelecimento 
 and a.cd_estabelecimento 	= b.cd_estabelecimento 
 and b.ie_tipo_relacao		= 'EP' 

union
 
select 2 tp_registro, 
    b.cd_conta cd_cliente, 
    b.cd_agencia_bancaria cd_agencia, 
    ' ' nm_cliente, 
    0 cd_banco, 
    ' ' nm_banco, 
    LOCALTIMESTAMP dt_gravacao, 
    0 nr_seq_arquivo, 
    '0' || d.ie_favorecido cd_inscricao, 
    e.cd_cgc nr_inscricao, 
    d.cd_favorecido, 
    '0' || d.ie_favorecido, 
    c.ie_tipo_pagamento ie_tipo_pagamento, 
    c.cd_banco cd_banco_destino, 
    c.cd_agencia_bancaria cd_agencia_destino, 
    c.cd_camara_compensacao, 
    ' ' nm_credito_destino, 
    CASE WHEN a.cd_banco=c.cd_banco THEN  'S'   ELSE 'N' END  ie_correntista, 
    b.cd_conta nr_conta_corrente, 
    c.ie_tipo_documento ie_tipo_documento, 
    coalesce(d.nr_documento, d.nr_titulo) nr_compromisso, 
    '0' nr_seq_compromisso, 
    c.nr_titulo nr_documento, 
    d.dt_vencimento_atual dt_vencimento, 
    c.vl_escritural vl_compromisso, 
    c.nr_conta nr_conta_destino, 
    c.ie_digito_conta nr_digito_destino, 
    ' ' nm_agencia_destino, 
    c.ie_tipo_servico ie_tipo_servico, 
    c.vl_desconto vl_abatimento, 
    d.nr_bloqueto cd_barras, 
    ' ' ds_mensagem, 
    c.vl_acrescimo, 
    d.dt_vencimento_atual dt_pagamento, 
    (c.vl_escritural - c.vl_desconto + c.vl_acrescimo) vl_autorizado, 
    ie_moeda cd_moeda, 
    'N' ie_lancamento_individual, 
    ' ' nr_remessa, 
    0 vl_juros_apr, 
    0 vl_multa_apr, 
    0 ie_tipo_doc_arrecadacao, 
    0 ie_contribuinte, 
    0 cd_identif_contribuinte, 
    ' ' nm_contribuinte, 
    LOCALTIMESTAMP dt_periodo, 
    0 cd_receita_darf, 
    0 vl_perc_arrecadacao, 
    0 cd_referencia_darf, 
    0 vl_darf, 
    0 vl_inss, 
    ' ' ie_aviso_lancto, 
    d.nm_favorecido, 
    d.ds_endereco ds_end_favorecido, 
    d.ds_bairro, 
    d.ds_cidade, 
    d.ds_estado, 
    d.cd_cep, 
    d.nr_ddd_telefone, 
    d.nr_telefone, 
    d.nr_ramal, 
    a.nr_sequencia, 
    c.nr_titulo, 
	 c.cd_ocorrencia, 
	 b.cd_agencia_bancaria cd_agencia_pagto    
FROM estabelecimento e, titulo_pagar_v2 d, banco_estabelecimento b, banco_escritural a, titulo_pagar_escrit c
LEFT OUTER JOIN agencia_bancaria f ON (c.cd_banco = f.cd_banco AND c.cd_agencia_bancaria = f.cd_agencia_bancaria)
WHERE c.nr_titulo     	= d.nr_titulo and a.nr_sequencia    	= c.nr_seq_escrit and a.cd_banco      	= b.cd_banco and d.ie_tipo_titulo   	<> 1   and a.cd_estabelecimento 	= e.cd_estabelecimento and a.cd_estabelecimento 	= b.cd_estabelecimento and b.ie_tipo_relacao		= 'EP' 
 
union
 
 select 9 tp_registro, 
    ' ' cd_cliente, 
    ' ' cd_agencia, 
    ' ' nm_cliente, 
    0 cd_banco, 
    ' ' nm_banco, 
    LOCALTIMESTAMP dt_gravacao, 
    0 nr_seq_arquivo, 
    ' ' cd_inscricao, 
    ' ' nr_inscricao, 
    ' ' cd_favorecido, 
    ' ' ie_favorecido, 
    ' ' ie_tipo_pagamento, 
    0 cd_banco_destino, 
    ' ' cd_agencia_destino, 
    0 cd_camara_compensacao, 
    ' ' nm_credito_destino, 
    ' ' ie_correntista, 
    '0' nr_conta_corrente, 
    ' ' ie_tipo_documento, 
    0 nr_compromisso, 
    ' ' nr_seq_compromisso, 
    0 nr_documento, 
    LOCALTIMESTAMP dt_vencimento, 
    0 vl_compromisso, 
    ' ' nr_conta_destino, 
    ' ' nr_digito_destino, 
    ' ' nm_agencia_destino, 
    '0' ie_tipo_servico, 
    0 vl_abatimento, 
    '0' cd_barras, 
    ' ' ds_mensagem, 
    0 vl_acrescimo, 
    LOCALTIMESTAMP dt_pagamento, 
    0 vl_autorizado, 
    0 cd_moeda, 
    ' ' ie_lancamento_individual, 
    ' ' nr_remessa, 
    0 vl_juros_apr, 
    0 vl_multa_apr, 
    0 ie_tipo_doc_arrecadacao, 
    0 ie_contribuinte, 
    0 cd_identif_contribuinte, 
    ' ' nm_contribuinte, 
    LOCALTIMESTAMP dt_periodo, 
    0 cd_receita_darf, 
    0 vl_perc_arrecadacao, 
    0 cd_referencia_darf, 
    0 vl_darf, 
    0 vl_inss, 
    ' ' ie_aviso_lancto, 
    ' ' nm_favorecido, 
    ' ' ds_end_favorecido, 
    ' ' ds_bairro, 
    ' ' ds_cidade, 
    ' ' ds_estado, 
    ' ' cd_cep, 
    0000 nr_ddd_telefone, 
    ' ' nr_telefone, 
    0000 nr_ramal, 
    e.nr_sequencia, 
    0 nr_titulo, 
	 '00' cd_ocorrencia, 
	 '0' cd_agencia_pagto    
 from banco_estabelecimento b, 
   estabelecimento a, 
   pessoa_juridica p, 
   banco c, 
   banco_escritural e 
 where e.cd_estabelecimento 		= a.cd_estabelecimento 
  and a.cd_cgc 				= p.cd_cgc 
  and e.cd_estabelecimento 		= b.cd_estabelecimento 
  and b.cd_banco 			= c.cd_banco 
  and a.cd_estabelecimento 		= b.cd_estabelecimento 
  and b.cd_banco 			= e.cd_banco 
  and b.ie_tipo_relacao		= 'EP';

