-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW conta_paciente_consiste_v (ie_proc_mat, cd_item, nr_atendimento, nr_interno_conta, cd_motivo_exc_conta, dt_conta, vl_item, vl_item_sem_imposto, vl_medico, vl_custo_operacional, vl_anestesista, vl_auxiliares, nr_doc_convenio, qt_item, vl_unitario, nr_seq_proc_pacote, nr_sequencia, ie_tipo_guia, dt_acerto_conta, cd_setor_atendimento) AS select	1 ie_proc_mat,
	a.cd_procedimento	cd_item,
        	a.nr_atendimento,
        	a.nr_interno_conta,
        	a.cd_motivo_exc_conta,
       	a.dt_conta,
       	(a.vl_procedimento + coalesce(y.vl_imposto,0)) vl_item,
       	coalesce((a.vl_procedimento),0) vl_item_sem_imposto,
        a.vl_medico,
	a.vl_custo_operacional,
	a.vl_anestesista,
	a.vl_auxiliares,
	a.nr_doc_convenio,
	a.qt_procedimento qt_item,
	(a.vl_procedimento / 
		CASE WHEN a.qt_procedimento=0 THEN 1  ELSE a.qt_procedimento END ) vl_unitario,
	a.nr_seq_proc_pacote,
	a.nr_sequencia,
	a.ie_tipo_guia,
	a.dt_acerto_conta,
	a.cd_setor_atendimento
FROM procedimento_paciente a
LEFT OUTER JOIN propaci_imposto y ON (a.nr_sequencia = y.nr_seq_propaci)
WHERE (a.nr_interno_conta is not null)  
union

select	2 ie_proc_mat,
	x.cd_material	cd_item,
	x.nr_atendimento,
        	x.nr_interno_conta,
	x.cd_motivo_exc_conta,
	x.dt_conta,
	(x.vl_material + coalesce(y.vl_imposto,0)) vl_material,
	coalesce((x.vl_material),0) vl_item_sem_imposto,
	0,
	0,
	0,
	0,
	x.nr_doc_convenio,
	x.qt_material qt_item,
	x.vl_unitario,
	x.nr_seq_proc_pacote,
	x.nr_sequencia,
	x.ie_tipo_guia,
	x.dt_acerto_conta,
	x.cd_setor_atendimento
FROM material_atend_paciente x
LEFT OUTER JOIN matpaci_imposto y ON (x.nr_sequencia = y.nr_seq_matpaci)
WHERE (x.nr_interno_conta is not null);

