-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW resumo_atendimento_paciente_v (nr_atendimento, cd_pessoa_fisica, cd_medico_resp, ie_tipo_atendimento, ie_clinica, dt_entrada, dt_alta, cd_motivo_alta, cd_procedencia, ie_tipo_convenio, cd_estabelecimento, cd_convenio, cd_categoria, cd_plano_convenio, ds_convenio, dt_inicio_vigencia, dt_final_vigencia, cd_setor_atendimento, cd_unidade_basica, cd_unidade_compl, ds_setor_atendimento, nr_doc_convenio, cd_usuario_convenio, cd_senha, dt_validade_carteira, nr_doc_conv_principal, nr_seq_queixa, nr_seq_classificacao, ie_tipo_atend_tiss, nr_atend_original, nr_seq_origem, dt_entrada_unidade, dt_saida_unidade, dt_saida_interno, dt_alta_medico, dt_inicio_atendimento, dt_fim_triagem, nr_seq_local_pa, dt_alta_interno, cd_classif_setor, dt_cancelamento, cd_empresa, cd_unidade, nm_usuario_troca, ie_carater_inter_sus, nr_seq_triagem, nr_seq_triagem_prioridade, cd_motivo_alta_medica, nm_usuario_alta_medica, ie_nivel_atencao, nr_seq_interno) AS select	a.nr_atendimento,
	a.cd_pessoa_fisica,
	a.cd_medico_resp,
	a.ie_tipo_atendimento,
	a.ie_clinica,
	a.dt_entrada,
	a.dt_alta,
	a.cd_motivo_alta,
	a.cd_procedencia,
	a.ie_tipo_convenio,
	a.cd_estabelecimento,
	b.cd_convenio,
	b.cd_categoria,
	b.cd_plano_convenio,
	d.ds_convenio,
	b.dt_inicio_vigencia,
	b.dt_final_vigencia,
	c.cd_setor_atendimento,
	c.cd_unidade_basica,
	c.cd_unidade_compl,
	e.ds_setor_atendimento,
	b.nr_doc_convenio,
	b.cd_usuario_convenio,
	b.cd_senha,
	b.DT_VALIDADE_CARTEIRA,
	b.NR_DOC_CONV_PRINCIPAL,
	a.nr_seq_queixa,
	a.nr_seq_classificacao,
	a.ie_tipo_atend_tiss,
	a.nr_atend_original,
	b.nr_seq_origem,
	c.dt_entrada_unidade,
	c.dt_saida_unidade,
	c.dt_saida_interno,
	a.dt_alta_medico,
	a.dt_inicio_atendimento,
	a.dt_fim_triagem,
	a.nr_seq_local_pa,
	a.dt_alta_interno,
	e.CD_CLASSIF_SETOR,
	a.dt_cancelamento,
	b.cd_empresa,
	c.CD_UNIDADE_BASICA || ' ' ||c.CD_UNIDADE_COMPL  cd_unidade,
	substr(OBTER_ULTIMO_USUARIO_TROCA(a.nr_atendimento),1,100) nm_usuario_troca,
	a.ie_carater_inter_sus,
	a.nr_seq_triagem,
	a.nr_seq_triagem_prioridade,
	cd_motivo_alta_medica,
	nm_usuario_alta_medica,
	a.ie_nivel_atencao,
    c.nr_seq_interno
FROM	setor_atendimento e,
	convenio d,
	atend_paciente_unidade c,
	atend_categoria_convenio b,
	atendimento_paciente a
where	a.nr_atendimento = c.nr_atendimento
and 	c.nr_seq_interno = obter_atepacu_paciente(a.nr_atendimento, 'A')
and	a.nr_atendimento	= b.nr_atendimento
and	b.nr_seq_interno	= obter_atecaco_atendimento(a.nr_atendimento)
and	c.cd_setor_atendimento	= e.cd_setor_atendimento
and	b.cd_convenio		=d.cd_convenio;

