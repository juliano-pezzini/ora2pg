-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_target_care_v (ds_setor_atendimento, nr_seq_meta, ds_meta, cd_medico_resp, nm_medico, nr_atendimento, ie_status, dt_finalizacao, qt_atingida) AS select 	distinct
		obter_nome_setor(obter_setor_atendimento(a.nr_atendimento)) ds_setor_atendimento,
		t.nr_seq_meta,
		obter_dados_tof_meta(t.nr_seq_meta, 'D') ds_meta,
		a.cd_medico_resp,
		obter_nome_medico(a.cd_medico_resp, 'N') nm_medico,
		a.nr_atendimento nr_atendimento,
		t.ie_status,
		t.dt_finalizacao,
		CASE WHEN t.ie_status='A' THEN  1  ELSE 0 END  qt_atingida
FROM 	tof_meta_atend t,
		atendimento_paciente a
where 	a.nr_atendimento = t.nr_atendimento
and		t.ie_status is not null
and		t.dt_finalizacao is not null
and     t.dt_liberacao is not null
and     t.dt_inativacao is null;

