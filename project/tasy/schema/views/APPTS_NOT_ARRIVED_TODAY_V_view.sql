-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW appts_not_arrived_today_v (nr_sequencia, cd_agenda, dt_agenda, cd_tipo_agenda, ie_status_agenda, cd_pessoa_fisica) AS WITH range AS (
  SELECT establishment_timezone_utils.startOfDay(LOCALTIMESTAMP) start_day,
         establishment_timezone_utils.endOfDay(LOCALTIMESTAMP) end_day

)

-- CONSULTATION SCHEDULE
SELECT  a.nr_sequencia,
        a.cd_agenda,
        a.dt_agenda,
        a.cd_tipo_agenda,
        a.ie_status_agenda,
        a.cd_pessoa_fisica
FROM    consulta_agecons_html5_v a, range
WHERE   a.ie_status_agenda IN ('N', 'CN')
AND     a.cd_tipo_agenda = 3
AND     a.dt_agenda BETWEEN range.start_day AND range.end_day

-- EXAME SCHEDULE
UNION ALL

SELECT  a.nr_sequencia,
        a.cd_agenda,
        a.dt_agenda,
        a.cd_tipo_agenda,
        a.ie_status_agenda,
        a.cd_pessoa_fisica
FROM    consulta_ageexam_html5_v a, range
WHERE   a.ie_status_agenda IN ('N', 'CN')
AND     a.cd_tipo_agenda = 2
AND     a.dt_agenda BETWEEN range.start_day AND range.end_day

-- SERVICE SCHEDULE
UNION ALL

SELECT  a.nr_sequencia,
        a.cd_agenda,
        a.dt_agenda,
        a.cd_tipo_agenda,
        a.ie_status_agenda,
        a.cd_pessoa_fisica
FROM    consulta_ageserv_html5_v a, range
WHERE   a.ie_status_agenda IN ('N', 'CN')
AND     a.cd_tipo_agenda = 5
AND     a.dt_agenda BETWEEN range.start_day AND range.end_day;

