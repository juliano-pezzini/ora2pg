-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW cep_compl_pf_v (cd_cep, nr_seq_loc, ds_loc, nr_seq_log, nm_log, ds_log, cd_bairro_inicial, ds_bairro, ds_uf, ds_tipo_log, cd_tipo_log, ie_cep_geral, ds_preposicao, ds_compl_log, cd_municipio_ibge, ie_codificado_log) AS SELECT	a.cd_cep,
	b.nr_sequencia nr_seq_loc,
	b.nm_localidade ds_loc,
	a.nr_sequencia nr_seq_log,
	a.nm_logradouro nm_log,
	SUBSTR(CASE WHEN coalesce(obter_parametro_usuario_js(5,116),'S')='S' THEN CASE WHEN a.ds_tipo_logradouro IS NULL THEN NULL  ELSE a.ds_tipo_logradouro || ' ' END  END  ||
		CASE WHEN coalesce(obter_parametro_usuario_js(5,116),'S')='P' THEN NULL  ELSE CASE WHEN a.ds_preposicao IS NULL THEN NULL  ELSE a.ds_preposicao || ' ' END  END  || a.nm_logradouro,1,255) ds_log,
	a.cd_bairro_inicial,
	SUBSTR(obter_desc_cep_bairro(a.cd_bairro_inicial,b.nr_sequencia),1,80) ds_bairro,
	coalesce(a.ds_uf,b.ds_uf) ds_uf,
	a.ds_tipo_logradouro ds_tipo_log,
	(SELECT MAX(x.cd_tipo_logradouro) FROM sus_tipo_logradouro x WHERE padronizar_nome(x.ds_tipo_logradouro) = padronizar_nome(a.ds_tipo_logradouro)) cd_tipo_log,
	coalesce(a.ie_cep_geral,'N') ie_cep_geral,
	a.ds_preposicao,
	a.ds_complemento ds_compl_log,
	SUBSTR(CASE WHEN obter_municipio_ibge(a.cd_cep)='0' THEN NULL  ELSE obter_municipio_ibge(a.cd_cep) END ,1,6) cd_municipio_ibge,
	coalesce(b.ie_codificado_log, 'N') ie_codificado_log
FROM	cep_loc b,
	cep_log a
WHERE	b.nr_sequencia = a.nr_seq_loc
AND	coalesce(obter_parametro_usuario_js(0,25),'N') = 'S'

UNION ALL

SELECT	a.cd_logradouro,
	NULL nr_seq_loc,
	a.nm_localidade,
	a.nr_logradouro nr_seq_log,
	a.nm_logradouro,
	SUBSTR(CASE WHEN coalesce(obter_parametro_usuario_js(5,116),'S')='S' THEN CASE WHEN obter_valor_dominio(1463,a.tp_logradouro) IS NULL THEN NULL  ELSE obter_valor_dominio(1463,a.tp_logradouro) || ' ' END  END  || a.nm_logradouro,1,255) ds_log,
	NULL cd_bairro_inicial,
	a.nm_bairro,
	a.cd_unidade_federacao,
	SUBSTR(obter_valor_dominio(1463,a.tp_logradouro),1,125) ds_tipo_log,
	(SELECT MAX(x.cd_tipo_logradouro) FROM sus_tipo_logradouro x WHERE padronizar_nome(x.ds_tipo_logradouro) = padronizar_nome(obter_valor_dominio(1463,a.tp_logradouro))) cd_tipo_log,
	'N' ie_cep_geral,
	'' ds_preposicao,
	'' ds_compl_log,
	SUBSTR(CASE WHEN obter_municipio_ibge(a.cd_logradouro)='0' THEN NULL  ELSE obter_municipio_ibge(a.cd_logradouro) END ,1,6) cd_municipio_ibge,
	'N' ie_codificado_log
FROM	cep_logradouro a
WHERE	coalesce(obter_parametro_usuario_js(0,25),'N') = 'N'

UNION ALL

SELECT	a.cd_cep,
	a.nr_sequencia nr_seq_loc,
	a.nm_localidade,
	NULL nr_seq_log,
	'' nm_log,
	'' ds_log,
	NULL cd_bairro_inicial,
	'' ds_bairro,
	a.ds_uf,
	'' ds_tipo_log,
	'' cd_tipo_log,
	(SELECT coalesce(MAX(x.ie_cep_geral),'N') FROM cep_log x WHERE x.cd_cep = a.cd_cep) ie_cep_geral,
	'' ds_preposicao,
	'' ds_compl_log,
	SUBSTR(CASE WHEN obter_municipio_ibge(a.cd_cep)='0' THEN NULL  ELSE obter_municipio_ibge(a.cd_cep) END ,1,6) cd_municipio_ibge,
	coalesce(a.ie_codificado_log, 'N') ie_codificado_log
FROM	cep_loc a
WHERE	coalesce(pkg_i18n.get_user_locale, 'pt_BR') != 'es_MX'

UNION ALL

SELECT	a.cd_cep,
	a.nr_sequencia nr_seq_loc,
	a.nm_localidade,
	NULL nr_seq_log,
	'' nm_log,
	'' ds_log,
	NULL cd_bairro_inicial,
	b.ds_bairro,
	a.ds_uf,
	'' ds_tipo_log,
	'' cd_tipo_log,
	(SELECT coalesce(MAX(x.ie_cep_geral),'S') FROM cep_log x WHERE x.cd_cep = a.cd_cep) ie_cep_geral,
	'' ds_preposicao,
	'' ds_compl_log,
	SUBSTR(CASE WHEN obter_municipio_ibge(a.cd_cep)='0' THEN NULL  ELSE obter_municipio_ibge(a.cd_cep) END ,1,6) cd_municipio_ibge,
	'N' ie_codificado_log
FROM	cep_loc a,
	cep_bairro b
WHERE	a.nr_sequencia	= b.nr_seq_loc
AND	coalesce(pkg_i18n.get_user_locale, 'pt_BR') = 'es_MX';

