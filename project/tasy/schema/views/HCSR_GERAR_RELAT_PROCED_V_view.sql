-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW hcsr_gerar_relat_proced_v (ds_convenio, qt_endoscipia, vl_endoscipia, qt_colonoscopia, vl_colonoscopia, qt_esclerose, vl_esclerose, qt_retossigmoidoscopia, vl_retossigmoidoscopia, qt_ph_metria, vl_ph_metria, qt_ligadura, vl_ligadura, qt_visita_hosp, vl_visita_hosp, qt_proc_cirurgico, vl_proc_cirurgico, vl_material, vl_taxas, vl_total_honorario, vl_total, dt_procedimento) AS select	x.ds_convenio ds_convenio,
	sum(x.qt_endoscipia) qt_endoscipia, 
	sum(x.vl_endoscipia) vl_endoscipia, 
	sum(x.qt_colonoscopia) qt_colonoscopia, 
	sum(x.vl_colonoscopia) vl_colonoscopia, 
	sum(x.qt_esclerose) qt_esclerose, 
	sum(x.vl_esclerose) vl_esclerose, 
	sum(x.qt_Retossigmoidoscopia) qt_Retossigmoidoscopia, 
	sum(x.vl_Retossigmoidoscopia) vl_Retossigmoidoscopia, 
	sum(x.qt_PH_Metria) qt_PH_Metria, 
	sum(x.vl_PH_Metria) vl_PH_Metria, 
	sum(x.qt_Ligadura) qt_Ligadura, 
	sum(x.vl_Ligadura) vl_Ligadura, 
	sum(x.qt_Visita_Hosp) qt_Visita_Hosp, 
	sum(x.vl_Visita_Hosp) vl_Visita_Hosp, 
	sum(x.qt_proc_cirurgico) qt_proc_cirurgico, 
	sum(x.vl_proc_cirurgico) vl_proc_cirurgico, 
	sum(x.vl_material) vl_material,  
	sum(x.vl_taxas) vl_taxas, 
	(sum(x.vl_endoscipia) + sum(x.vl_colonoscopia) + sum(x.vl_esclerose) + sum(x.vl_Retossigmoidoscopia) + sum(x.vl_PH_Metria) + sum(x.vl_Ligadura) + sum(x.vl_Visita_Hosp) + sum(x.vl_proc_cirurgico)) vl_total_honorario, 
	(sum(x.vl_endoscipia) + sum(x.vl_colonoscopia) + sum(x.vl_esclerose) + sum(x.vl_Retossigmoidoscopia) + sum(x.vl_PH_Metria) + sum(x.vl_Ligadura) + sum(x.vl_Visita_Hosp) + sum(x.vl_proc_cirurgico) + sum(x.vl_material) + sum(x.vl_taxas)) vl_total, 
	x.dt_procedimento 
FROM ( 
select	substr(obter_desc_convenio(a.cd_convenio),1,255) ds_convenio, 
	CASE WHEN a.nr_seq_proc_interno=476 THEN qt_procedimento  ELSE 0 END  qt_endoscipia, 
	CASE WHEN a.nr_seq_proc_interno=476 THEN vl_medico  ELSE 0 END  vl_endoscipia, 
	CASE WHEN a.nr_seq_proc_interno=592 THEN qt_procedimento  ELSE 0 END  qt_colonoscopia, 
	CASE WHEN a.nr_seq_proc_interno=592 THEN vl_medico  ELSE 0 END  vl_colonoscopia, 
	CASE WHEN a.nr_seq_proc_interno=563 THEN qt_procedimento  ELSE 0 END  qt_esclerose, 
	CASE WHEN a.nr_seq_proc_interno=563 THEN vl_medico  ELSE 0 END  vl_esclerose, 
	CASE WHEN a.nr_seq_proc_interno=521 THEN qt_procedimento  ELSE 0 END  qt_Retossigmoidoscopia, 
	CASE WHEN a.nr_seq_proc_interno=521 THEN vl_medico  ELSE 0 END  vl_Retossigmoidoscopia, 
	CASE WHEN a.nr_seq_proc_interno=412 THEN qt_procedimento WHEN a.nr_seq_proc_interno=1075 THEN qt_procedimento WHEN a.nr_seq_proc_interno=686 THEN qt_procedimento  ELSE 0 END  qt_PH_Metria, 
	CASE WHEN a.nr_seq_proc_interno=412 THEN vl_medico WHEN a.nr_seq_proc_interno=1075 THEN vl_medico WHEN a.nr_seq_proc_interno=686 THEN vl_medico  ELSE 0 END  vl_PH_Metria, 
	CASE WHEN a.nr_seq_proc_interno=924 THEN qt_procedimento WHEN a.nr_seq_proc_interno=1062 THEN qt_procedimento  ELSE 0 END  qt_Ligadura, 
	CASE WHEN a.nr_seq_proc_interno=924 THEN vl_medico WHEN a.nr_seq_proc_interno=1062 THEN vl_medico  ELSE 0 END  vl_Ligadura, 
	CASE WHEN a.nr_seq_proc_interno=34 THEN qt_procedimento  ELSE 0 END  qt_Visita_Hosp, 
	CASE WHEN a.nr_seq_proc_interno=34 THEN vl_medico  ELSE 0 END  vl_Visita_Hosp, 
	0 qt_proc_cirurgico, 
	0 vl_proc_cirurgico, 
	0 vl_material, 
	0 vl_taxas, 
	trunc(a.dt_procedimento) dt_procedimento 
from	conta_paciente c, 
	atendimento_paciente b, 
	procedimento_paciente a 
where	a.nr_interno_conta 	= c.nr_interno_conta 
and	b.nr_atendimento 	= c.nr_atendimento 
and	a.cd_motivo_exc_conta is null 
and	obter_classif_material_proced(null, a.cd_procedimento, a.ie_origem_proced) = '1' 
and (a.ie_responsavel_credito is null or (coalesce(a.vl_custo_operacional, 0) + coalesce(a.vl_materiais, 0)) > 0 or obter_se_pasta_honorario(a.ie_responsavel_credito) = 'N') 
AND	a.nr_seq_proc_interno IN (476,592,563,521,412,1075,686,924,1062,34) 
and	a.vl_medico <> 0 

union all
 
select	substr(obter_desc_convenio(a.cd_convenio),1,255) ds_convenio, --Proc. CirÃºrgico 
	0 qt_endoscipia, 
	0 vl_endoscipia, 
	0 qt_colonoscopia, 
	0 vl_colonoscopia, 
	0 qt_esclerose, 
	0 vl_esclerose, 
	0 qt_Retossigmoidoscopia, 
	0 vl_Retossigmoidoscopia, 
	0 qt_PH_Metria, 
	0 vl_PH_Metria, 
	0 qt_Ligadura, 
	0 vl_Ligadura, 
	0 qt_Visita_Hosp, 
	0 vl_Visita_Hosp, 
	a.qt_procedimento qt_proc_cirurgico, 
	a.vl_medico vl_proc_cirurgico, 
	0 vl_material, 
	0 vl_taxas, 
	trunc(a.dt_procedimento) dt_procedimento 
from	conta_paciente c, 
	atendimento_paciente b, 
	procedimento_paciente a 
where	a.nr_interno_conta 	= c.nr_interno_conta 
and	b.nr_atendimento 	= c.nr_atendimento 
and	a.cd_motivo_exc_conta is null 
and	obter_classif_material_proced(null, a.cd_procedimento, a.ie_origem_proced) = '1' 
and (a.ie_responsavel_credito is null or (coalesce(a.vl_custo_operacional, 0) + coalesce(a.vl_materiais, 0)) > 0 or obter_se_pasta_honorario(a.ie_responsavel_credito) = 'N') 
and	a.vl_medico <> 0 
and 	a.cd_setor_atendimento = 55 

union all
 
select	substr(obter_desc_convenio(a.cd_convenio),1,255) ds_convenio, --Mat. Med Exames 
	0 qt_endoscipia, 
	0 vl_endoscipia, 
	0 qt_colonoscopia, 
	0 vl_colonoscopia, 
	0 qt_esclerose, 
	0 vl_esclerose, 
	0 qt_Retossigmoidoscopia, 
	0 vl_Retossigmoidoscopia, 
	0 qt_PH_Metria, 
	0 vl_PH_Metria, 
	0 qt_Ligadura, 
	0 vl_Ligadura, 
	0 qt_Visita_Hosp, 
	0 vl_Visita_Hosp, 
	0 qt_proc_cirurgico, 
	0 vl_proc_cirurgico, 
	a.vl_material vl_material, 
	0 vl_taxas, 
	trunc(a.dt_atendimento) dt_procedimento 
from	conta_paciente c, 
	atendimento_paciente b, 
	material_atend_paciente a 
where	a.nr_interno_conta 	= c.nr_interno_conta 
and	b.nr_atendimento 	= c.nr_atendimento 
and	a.cd_motivo_exc_conta is null 
AND 	a.cd_setor_atendimento in (59,48,54,67,76,50,47,53,66,56,65,30,63,49) 

union all
 
select	substr(obter_desc_convenio(a.cd_convenio),1,255) ds_convenio,  -- Tx. Exame 
	0 qt_endoscipia, 
	0 vl_endoscipia, 
	0 qt_colonoscopia, 
	0 vl_colonoscopia, 
	0 qt_esclerose, 
	0 vl_esclerose, 
	0 qt_Retossigmoidoscopia, 
	0 vl_Retossigmoidoscopia, 
	0 qt_PH_Metria, 
	0 vl_PH_Metria, 
	0 qt_Ligadura, 
	0 vl_Ligadura, 
	0 qt_Visita_Hosp, 
	0 vl_Visita_Hosp, 
	0 qt_proc_cirurgico, 
	0 vl_proc_cirurgico, 
	0 vl_material, 
	a.vl_medico vl_taxas, 
	trunc(a.dt_procedimento) dt_procedimento 
from	conta_paciente c, 
	atendimento_paciente b, 
	procedimento_paciente a 
where	a.nr_interno_conta 	= c.nr_interno_conta 
and	b.nr_atendimento 	= c.nr_atendimento 
and	a.cd_motivo_exc_conta is null 
and	a.vl_medico <> 0 
and	obter_classif_material_proced(null, a.cd_procedimento, a.ie_origem_proced) = '2' 
AND 	a.cd_setor_atendimento in (59,48,54,67,76,50,47,53,66,56,65,30,63,49))x 
where 1 = 1 
group by ds_convenio, 
	dt_procedimento;

