-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW w_eis_game_pcr_v (setor, ds_setor_atendimento, cd_profissional, ds_unidade, dt_evento, na, dt_acionamento, dt_profissional, dt_fim, qt_minutos_resp, qt_minutos_atend, ds_categoria, ie_desfecho, qt_desfecho_sat, ds_desfecho, nr_sequencia) AS select	distinct
	c.cd_setor_atendimento setor, 
	substr(obter_nome_setor(c.cd_setor_atendimento),1,255) ds_setor_atendimento, 
	e.cd_profissional, 
	c.cd_unidade ds_unidade, 
	TRUNC(b.dt_Evento) dt_evento,	 
	b.nr_atendimento NA, 
	a.dt_acionamento_equipe	dt_acionamento, 
	e.dt_chegada	dt_profissional, 
	a.dt_encerramento	dt_fim, 
	((e.dt_chegada - a.dt_acionamento_equipe)*24*60) qt_minutos_resp, 
	dividir(((a.dt_encerramento - a.dt_acionamento_equipe)*24*60),coalesce(obter_dados_PCR(a.nr_sequencia,'P'),1)) qt_minutos_atend, 
	substr(obter_categoria_pcr(e.ie_tipo_evolucao),1,255) ds_categoria, 
	a.ie_desfecho, 
	dividir(CASE WHEN a.ie_desfecho='R' THEN 1  ELSE 0 END ,coalesce(obter_dados_PCR(a.nr_sequencia,'P'),1)) qt_desfecho_sat, 
	substr(Obter_desc_desfecho_pcr(a.ie_desfecho),1,255) ds_desfecho, 
	a.nr_sequencia	 
FROM	qua_evento_paciente b, 
	qua_tipo_evento d, 
	qua_evento f, 
	resumo_atendimento_paciente_v c, 
	qua_evento_pcr a,	 
	qua_evento_pcr_prof e 
where	b.dt_inativacao is null 
and	a.nr_seq_evento = b.nr_sequencia 
and 	e.nr_seq_pcr = a.nr_sequencia 
and	b.nr_atendimento = c.nr_atendimento 
and	d.ie_tipo_evento = 'PCR' 
and	d.nr_sequencia = f.nr_seq_tipo 
and	b.nr_Seq_evento = f.nr_sequencia 
and	a.dt_encerramento is not null;

