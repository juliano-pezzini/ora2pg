-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW hcvsp_titulo_receber_v (nr_titulo, vl_titulo, vl_saldo_titulo, vl_saldo, pr_saldo, nr_seq_nf_saida, dt_nf_emissao, dt_emissao, cd_convenio_conta, nr_seq_protocolo, ie_situacao) AS SELECT	r.nr_titulo nr_titulo,
	r.vl_titulo vl_titulo,
	r.vl_saldo_titulo vl_saldo_titulo,
	r.vl_saldo_titulo vl_saldo,
	CASE WHEN r.vl_titulo=0 THEN 0  ELSE (r.vl_saldo_titulo * 100) / r.vl_titulo END  pr_saldo,
	coalesce(coalesce(r.nr_nota_fiscal, obter_nota_conta_protocolo(r.nr_seq_protocolo, r.nr_interno_conta)),
		obter_nota_conta_prot_conv(r.nr_seq_protocolo,r.nr_interno_conta,'S')) nr_seq_nf_saida,
	coalesce(obter_dt_emissao_nf(r.nr_interno_conta), (	SELECT	MAX(j.dt_emissao)
							FROM	nota_fiscal j
							WHERE	j.nr_sequencia = r.nr_seq_nf_saida)) dt_nf_emissao,
	r.dt_emissao dt_emissao,
	CASE WHEN SUBSTR(obter_nome_convenio(r.cd_convenio_conta),1,255) IS NULL THEN 0  ELSE r.cd_convenio_conta END  cd_convenio_conta,
	r.nr_seq_protocolo nr_seq_protocolo,
	r.ie_situacao ie_situacao
FROM	titulo_receber r;

