-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_monitoramento_proc_v (cd_grupo_proc, cd_procedimento, ie_origem_proced, cd_tabela_ref, qt_pago, vl_pago, qt_apresentado, vl_apresentado, nr_seq_guia_monitor, cd_dente, cd_face_dente, cd_regiao_boca, ie_tipo_despesa, nr_seq_pacote, nr_seq_tiss_proc, vl_coparticipacao) AS select 	a.cd_grupo_proc,
	null cd_procedimento,
	null ie_origem_proced,
	max(a.cd_tabela_ref) cd_tabela_ref,
	sum(a.qt_liberado) qt_pago,
	sum(a.vl_liberado) vl_pago,
	sum(qt_procedimento) qt_apresentado,
	sum(vl_procedimento) vl_apresentado,
	a.nr_seq_guia_monitor,
	cd_dente,
	cd_face_dente,
	cd_regiao_boca,
	null ie_tipo_despesa,
	a.nr_seq_pacote,
	max(a.nr_sequencia) nr_seq_tiss_proc,
	sum(a.vl_coparticipacao) vl_coparticipacao
FROM 	pls_monitor_tiss_proc a
where 	a.cd_grupo_proc is not null
and	a.cd_dente is null
and	a.cd_face_dente is null
and	a.cd_regiao_boca is null
group by a.cd_grupo_proc,
	null,
	null,
	null,
	a.nr_seq_guia_monitor,
	nr_seq_pacote,
	cd_dente,
	cd_face_dente,
	cd_regiao_boca

union all

select 	null cd_grupo_proc,
	a.cd_procedimento,
	a.ie_origem_proced,
	a.cd_tabela_ref,
	sum(a.qt_liberado) qt_pago,
	sum(a.vl_liberado) vl_pago,
	sum(a.qt_procedimento) qt_apresentado,
	sum(a.vl_procedimento) vl_apresentado,
	a.nr_seq_guia_monitor,
	cd_dente,
	cd_face_dente,
	cd_regiao_boca,
	null ie_tipo_despesa,
	a.nr_seq_pacote,
	max(a.nr_sequencia) nr_seq_tiss_proc,
	sum(a.vl_coparticipacao)
from 	pls_monitor_tiss_proc a
where 	a.cd_grupo_proc is null
and	a.cd_tabela_ref <> '98'
group by a.cd_procedimento,
	a.ie_origem_proced,
	a.cd_tabela_ref,
	a.nr_seq_guia_monitor,
	a.nr_seq_pacote,
	cd_dente,
	cd_face_dente,
	cd_regiao_boca

union all

select 	null cd_grupo_proc,
	a.cd_procedimento,
	a.ie_origem_proced,
	a.cd_tabela_ref,
	sum(a.qt_liberado) qt_pago,
	sum(a.vl_liberado) vl_pago,
	sum(a.qt_procedimento) qt_apresentado,
	sum(a.vl_procedimento) vl_apresentado,
	a.nr_seq_guia_monitor,
	cd_dente,
	cd_face_dente,
	cd_regiao_boca,
	null ie_tipo_despesa,
	a.nr_seq_pacote,
	max(a.nr_sequencia) nr_seq_tiss_proc,
	sum(a.vl_coparticipacao)
from 	pls_monitor_tiss_proc a
where 	a.cd_grupo_proc is null
and	a.cd_tabela_ref = '98'
group by a.cd_procedimento,
	a.ie_origem_proced,
	a.cd_tabela_ref,
	a.nr_seq_guia_monitor,
	a.nr_seq_pacote,
	cd_dente,
	cd_face_dente,
	cd_regiao_boca;

