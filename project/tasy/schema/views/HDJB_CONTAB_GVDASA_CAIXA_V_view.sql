-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW hdjb_contab_gvdasa_caixa_v (tp_registro, ds_unidade, ds_origem_lote, dt_movimento, cd_conta_contabil, ie_debito_credito, vl_movimento, ds_capa_lote, ds_compl_historico, cd_estabelecimento, nr_lote_contabil, cd_historico, ds_historico) AS select	0					tp_registro,
	10					ds_unidade,
	CASE WHEN substr(ctb_obter_tipo_lote_contabil(a.nr_lote_contabil,'C'),1,10)=14 THEN  'TASYEC10_RT' WHEN substr(ctb_obter_tipo_lote_contabil(a.nr_lote_contabil,'C'),1,10)=18 THEN  'TASYEC10_CB' WHEN substr(ctb_obter_tipo_lote_contabil(a.nr_lote_contabil,'C'),1,10)=6 THEN   'TASYEC10_RE'  ELSE 'TASYCX10' END  ds_origem_lote,
	null					dt_movimento,
	0					cd_conta_contabil,
	''					ie_debito_credito,
	0					vl_movimento,
	''					ds_capa_lote,
	''					ds_compl_historico,
	a.cd_estabelecimento,
	a.nr_lote_contabil,
	0					cd_historico,
	''					ds_historico
FROM	lote_contabil a

union

select	5					tp_registro,
	0					ds_unidade,
	CASE WHEN substr(ctb_obter_tipo_lote_contabil(a.nr_lote_contabil,'C'),1,10)=14 THEN  'TASYEC10_RT' WHEN substr(ctb_obter_tipo_lote_contabil(a.nr_lote_contabil,'C'),1,10)=18 THEN  'TASYEC10_CB' WHEN substr(ctb_obter_tipo_lote_contabil(a.nr_lote_contabil,'C'),1,10)=6 THEN   'TASYEC10_RE'  ELSE 'TASYCX10' END  ds_origem_lote,
	a.dt_movimento			dt_movimento,
	somente_numero(a.cd_conta_contabil) cd_conta_contabil,
	a.ie_debito_credito			ie_debito_credito,
	sum(a.vl_movimento)			vl_movimento,
	to_char(dt_movimento,'yyyymmdd') || 'C' ds_capa_lote,
	a.ds_compl_historico ds_compl_historico,
	a.cd_estabelecimento,
	a.nr_lote_contabil,
	CASE WHEN somente_numero(a.cd_conta_contabil)=1003 THEN 		CASE WHEN a.ie_debito_credito='D' THEN  100  ELSE 101 END   ELSE a.cd_historico END  cd_historico,
	a.ds_historico ds_historico
from	ctb_movimento_v a
group by a.dt_movimento,
	 somente_numero(a.cd_conta_contabil),
	 a.ie_debito_credito,
	 a.cd_estabelecimento,
	 a.nr_lote_contabil,
	 a.ds_compl_historico,
	 a.ds_historico,
	CASE WHEN somente_numero(a.cd_conta_contabil)=1003 THEN 		CASE WHEN a.ie_debito_credito='D' THEN  100  ELSE 101 END   ELSE a.cd_historico END
;

