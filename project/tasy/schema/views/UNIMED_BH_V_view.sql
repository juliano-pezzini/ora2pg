-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW unimed_bh_v (nr_seq_protocolo, cd_convenio, tp_registro, ie_disquete, cd_tipo_registro, nr_lote, cd_prestador, nr_seq_conta, ie_tipo_prestador, cd_cgc, nm_prestador, dt_remessa, nr_seq_remessa, nr_reg_remessa, nm_paciente, ie_sexo, dt_nascimento, cd_cliente, nr_conta, nr_seq_conta_item, ie_tipo_paciente, cd_tipo_atendimento, cd_classe_atendimento, dt_item, cd_cid, nr_crm, sg_uf_crm, nm_medico_requisitante, cd_medico_requisitante, dt_requisicao, nr_guia, dt_guia, nm_responsavel_guia, cd_proced_guia, ds_proced_guia, qt_proced_guia, nr_seqproc_guia, nr_seq_item, ds_item, cd_item, qt_item, qt_gus, cd_cgc_convenio, nr_prontuario, cd_plano, cd_dependente, dt_validade_carteira, nr_identidade, cd_tipo_acomodacao, dt_entrada, dt_alta, cd_motivo_alta, tp_guia, cd_medico_convenio, ie_funcao_medico, qt_porte_anestesico, cd_grupo_gasto, ds_unidade_medida, qt_ch, vl_unitario_ch, vl_unitario, vl_item, pr_funcao_partic, ie_via_acesso, pr_via_acesso, pr_hora_extra, ie_local_medicado, cd_brasindice, cd_item_convenio, cd_procedimento_ref, cd_senha, cd_regional, nm_convenio, ds_espaco, ie_estado_civil, nr_cpf_paciente, cd_nacionalidade, cd_cid_secundario, nr_planilha, vl_tot_honorarios, vl_tot_diarias, vl_tot_taxas, vl_tot_medicamentos, vl_tot_materiais, vl_tot_sadt, vl_tot_pacote, vl_tot_ortese, vl_tot_protese, qt_tot_diarias, qt_tot_participantes, cd_proc_orig_pacote, cd_cgc_cpf_resp_cred, nr_doc_convenio, nr_crm_requisitante, ie_tipo_protocolo, ie_tipo_atendimento, cd_grupo_proc, cd_setor_atendimento) AS SELECT		a.NR_SEQ_PROTOCOLO,
		a.CD_CONVENIO CD_CONVENIO,0 TP_REGISTRO,
           	'FATOU' IE_DISQUETE,0 CD_TIPO_REGISTRO,0 NR_LOTE,a.CD_INTERNO CD_PRESTADOR,
           	0 NR_SEQ_CONTA,'J' IE_TIPO_PRESTADOR,a.cd_cgc_hospital CD_CGC,
           	a.nm_hospital			NM_PRESTADOR,
           	a.dt_remessa			DT_REMESSA,
           	a.nr_remessa			NR_SEQ_REMESSA,
           	1 NR_REG_REMESSA,'' NM_PACIENTE,'' IE_SEXO,LOCALTIMESTAMP DT_NASCIMENTO,
           	'' CD_CLIENTE,0 NR_CONTA,0 NR_SEQ_CONTA_ITEM, '' IE_TIPO_PACIENTE, 0 CD_TIPO_ATENDIMENTO,
           	'' CD_CLASSE_ATENDIMENTO,LOCALTIMESTAMP DT_ITEM,'' CD_CID,'' NR_CRM,
           	'' SG_UF_CRM, '' NM_MEDICO_REQUISITANTE,'' CD_MEDICO_REQUISITANTE,
           	LOCALTIMESTAMP DT_REQUISICAO,'' NR_GUIA,LOCALTIMESTAMP DT_GUIA,
		'' NM_RESPONSAVEL_GUIA,'' CD_PROCED_GUIA,'' DS_PROCED_GUIA,
		0 QT_PROCED_GUIA,1 NR_SEQPROC_GUIA,0 NR_SEQ_ITEM, '' DS_ITEM,
           	0 CD_ITEM,0 QT_ITEM,0 QT_GUS,a.CD_CGC_convenio CD_CGC_CONVENIO,0 NR_PRONTUARIO,
		'' CD_PLANO,0 CD_DEPENDENTE,LOCALTIMESTAMP DT_VALIDADE_CARTEIRA,
		'' NR_IDENTIDADE,0 CD_TIPO_ACOMODACAO,LOCALTIMESTAMP DT_ENTRADA,LOCALTIMESTAMP DT_ALTA,
		0 CD_MOTIVO_ALTA,'' TP_GUIA,'' CD_MEDICO_CONVENIO,'' IE_FUNCAO_MEDICO,
		'' QT_PORTE_ANESTESICO,'' CD_GRUPO_GASTO,'' DS_UNIDADE_MEDIDA,
		0 QT_CH,0 VL_UNITARIO_CH,0 VL_UNITARIO,0 VL_ITEM,0 PR_FUNCAO_PARTIC,
		0 IE_VIA_ACESSO,0 PR_VIA_ACESSO,0 PR_HORA_EXTRA,'0' IE_LOCAL_MEDICADO,
		'' CD_BRASINDICE,'' CD_ITEM_CONVENIO,0 CD_PROCEDIMENTO_REF,'' CD_SENHA,
		a.cd_regional cd_regional,a.nm_convenio nm_convenio,
		' ' ds_espaco,'' ie_estado_civil,'' nr_cpf_paciente,'' cd_nacionalidade,
           	'' cd_cid_secundario,0 nr_planilha,0 vl_tot_honorarios,0 vl_tot_diarias,
		0 vl_tot_taxas,0 vl_tot_medicamentos,0 vl_tot_materiais,0 vl_tot_sadt,
		0 vl_tot_pacote,0 vl_tot_ortese,0 vl_tot_protese,0 qt_tot_diarias,
		0 qt_tot_participantes,
		0 cd_proc_orig_pacote,
		'' cd_cgc_cpf_resp_cred,
		'' nr_doc_convenio,
		'' nr_crm_requisitante,
		IE_TIPO_PROTOCOLO,
		0 ie_tipo_atendimento,
		0 cd_grupo_proc,
		0 cd_setor_atendimento
FROM  	w_interf_conta_header a

union all

SELECT     	a.NR_SEQ_PROTOCOLO,a.CD_CONVENIO CD_CONVENIO,1 TP_REGISTRO,
           	'FATOU' IE_DISQUETE,1 CD_TIPO_REGISTRO,1 NR_LOTE,a.CD_INTERNO CD_PRESTADOR,
           	a.nr_seq_registro             NR_SEQ_CONTA,
           	''                            IE_TIPO_PRESTADOR,
           	a.cd_cgc_hospital             CD_CGC,
           	''                            NM_PRESTADOR,
           	LOCALTIMESTAMP                 	DT_REMESSA,
           	a.nr_remessa       		NR_SEQ_REMESSA,
           	0                             NR_REG_REMESSA,
           	a.nm_paciente			NM_PACIENTE,
           	a.IE_SEXO,
           	a.DT_NASCIMENTO,
           	a.cd_usuario_convenio		CD_CLIENTE,
           	a.NR_INTERNO_CONTA            NR_CONTA,
		0				NR_SEQ_CONTA_ITEM,
		a.ie_tipo_paciente		IE_TIPO_PACIENTE,
		coalesce(a.cd_setor_cirurgia,a.cd_setor_atendimento) CD_TIPO_ATENDIMENTO,
		a.cd_classe_atendimento		CD_CLASSE_ATENDIMENTO,
           	LOCALTIMESTAMP                 	DT_ITEM,
           	a.cd_cid_principal            CD_CID,
           	CASE WHEN a.ie_medico_credenciado='N' THEN a.nr_crm_medico_resp  ELSE 0 END   NR_CRM,
           	a.uf_crm_medico_resp          SG_UF_CRM,
           	a.nm_medico_resp      		NM_MEDICO_REQUISITANTE,
		CASE WHEN a.ie_medico_credenciado='S' THEN a.cd_conv_medico_resp  ELSE 0 END 	CD_MEDICO_REQUISITANTE,
           	coalesce(c.dt_autorizacao,a.dt_entrada) DT_REQUISICAO,
           	c.cd_autorizacao             NR_GUIA,
           	LOCALTIMESTAMP                 	DT_GUIA,
		''					NM_RESPONSAVEL_GUIA,
		''					CD_PROCED_GUIA,
		''					DS_PROCED_GUIA,
		0					QT_PROCED_GUIA,
		1					NR_SEQPROC_GUIA,
           	0                             NR_SEQ_ITEM,
           	''                            DS_ITEM,
           	0                             CD_ITEM,
           	0                             QT_ITEM,
           	0                             QT_GUS,
		a.cd_cgc_convenio			CD_CGC_CONVENIO,
		a.NR_PRONTUARIO			NR_PRONTUARIO,
		a.cd_plano_convenio		CD_PLANO,
		coalesce(a.cd_dependente,1)		CD_DEPENDENTE,
		a.dt_validade_carteira		DT_VALIDADE_CARTEIRA,
		a.NR_IDENTIDADE			NR_IDENTIDADE,
		a.cd_tipo_acomodacao		CD_TIPO_ACOMODACAO,
		a.DT_ENTRADA			DT_ENTRADA,
		coalesce(a.DT_ALTA,a.dt_periodo_final)	DT_ALTA,
		CASE WHEN a.ie_tipo_atendimento=1 THEN  coalesce(a.CD_MOTIVO_ALTA,2)  ELSE 0 END CD_MOTIVO_ALTA,
		c.ie_tipo_guia			TP_GUIA,
		''					CD_MEDICO_CONVENIO,
		''					IE_FUNCAO_MEDICO,
		''					QT_PORTE_ANESTESICO,
		''					CD_GRUPO_GASTO,
		''					DS_UNIDADE_MEDIDA,
		0					QT_CH,
		0					VL_UNITARIO_CH,
		0					VL_UNITARIO,
		0					VL_ITEM,
		0					PR_FUNCAO_PARTIC,
		0					IE_VIA_ACESSO,
		0					PR_VIA_ACESSO,
		0					PR_HORA_EXTRA,
		''					IE_LOCAL_MEDICADO,
		''					CD_BRASINDICE,
		''					CD_ITEM_CONVENIO,
		0					CD_PROCEDIMENTO_REF,
		''					CD_SENHA,
		''					cd_regional,
		b.ds_convenio			nm_convenio,
		' ' ds_espaco,
		a.ie_estado_civil ie_estado_civil,
		a.nr_cpf_paciente nr_cpf_paciente,
		a.cd_nacionalidade cd_nacionalidade,
           	a.cd_cid_secundario           CD_CID_SECUNDARIO,
		0 nr_planilha,0 vl_tot_honorarios,0 vl_tot_diarias,0 vl_tot_taxas,
		0 vl_tot_medicamentos,0 vl_tot_materiais,0 vl_tot_sadt,0 vl_tot_pacote,
		0 vl_tot_ortese,0 vl_tot_protese,0 qt_tot_diarias,0 qt_tot_participantes,
		0 cd_proc_orig_pacote,
		'',	'', 	'', 0,
		a.ie_tipo_atendimento,
		0 cd_grupo_proc,
		0 cd_setor_atendimento
FROM convenio b, w_interf_conta_cab a
LEFT OUTER JOIN w_interf_conta_autor c ON (a.nr_interno_conta = c.nr_interno_conta)
WHERE a.cd_convenio		= b.cd_convenio  and coalesce(c.nr_sequencia,0)		=
		(select coalesce(min(x.nr_sequencia), coalesce(c.nr_sequencia,0))
		from w_interf_conta_autor x
		where a.nr_interno_conta = x.nr_interno_conta)

union all

SELECT     	a.NR_SEQ_PROTOCOLO,a.CD_CONVENIO CD_CONVENIO,2 TP_REGISTRO,
           	'FATOU' IE_DISQUETE,2 CD_TIPO_REGISTRO,1 NR_LOTE,a.CD_INTERNO CD_PRESTADOR,
           	0                             NR_SEQ_CONTA,
           	''                            IE_TIPO_PRESTADOR,
           	a.cd_cgc_hospital             CD_CGC,
           	''                            NM_PRESTADOR,
           	LOCALTIMESTAMP                 	DT_REMESSA,
           	a.nr_remessa       		NR_SEQ_REMESSA,
           	0                             NR_REG_REMESSA,
           	a.nm_paciente			NM_PACIENTE,
           	a.IE_SEXO,
           	a.DT_NASCIMENTO,
           	a.cd_usuario_convenio		CD_CLIENTE,
           	a.NR_INTERNO_CONTA            NR_CONTA,
		0				NR_SEQ_CONTA_ITEM,
		CASE WHEN coalesce(a.NR_INTERNO_CONTA,0)=0 THEN ''  ELSE a.ie_tipo_paciente END  IE_TIPO_PACIENTE,
		coalesce(a.cd_setor_cirurgia,a.cd_setor_atendimento) CD_TIPO_ATENDIMENTO,
		a.cd_classe_atendimento		CD_CLASSE_ATENDIMENTO,
           	LOCALTIMESTAMP                 	DT_ITEM,
           	a.cd_cid_principal            CD_CID,
 --          	decode(a.ie_medico_credenciado,'N',a.nr_crm_medico_resp,0)  NR_CRM,
          	CASE WHEN a.ie_medico_credenciado='N' THEN a.nr_crm_medico_resp||calcula_digito_unimed_bh(			'Medico_Unimed',a.nr_crm_medico_resp)  ELSE 0 END   NR_CRM,
           	a.uf_crm_medico_resp          SG_UF_CRM,
           	a.nm_medico_resp      		NM_MEDICO_REQUISITANTE,
		CASE WHEN a.ie_medico_credenciado='S' THEN a.cd_conv_medico_resp  ELSE 0 END 	CD_MEDICO_REQUISITANTE,
           	coalesce(c.dt_autorizacao,a.dt_entrada) DT_REQUISICAO,
           	c.cd_autorizacao            NR_GUIA,
           	c.dt_autorizacao             	DT_GUIA,
		''					NM_RESPONSAVEL_GUIA,
		''					CD_PROCED_GUIA,
		''					DS_PROCED_GUIA,
		0					QT_PROCED_GUIA,
		1					NR_SEQPROC_GUIA,
           	0                             NR_SEQ_ITEM,
           	''                            DS_ITEM,
           	0                             CD_ITEM,
           	0                             QT_ITEM,
           	0                             QT_GUS,
		a.cd_cgc_convenio			CD_CGC_CONVENIO,
		a.NR_PRONTUARIO			NR_PRONTUARIO,
		a.cd_plano_convenio		CD_PLANO,
		coalesce(a.cd_dependente,1)		CD_DEPENDENTE,
		a.dt_validade_carteira		DT_VALIDADE_CARTEIRA,
		a.NR_IDENTIDADE			NR_IDENTIDADE,
		a.cd_tipo_acomodacao		CD_TIPO_ACOMODACAO,
		a.DT_ENTRADA			DT_ENTRADA,coalesce(a.DT_ALTA,a.dt_periodo_final)	DT_ALTA,
		coalesce(a.CD_MOTIVO_ALTA,2)			CD_MOTIVO_ALTA,
		''					TP_GUIA,
		''					CD_MEDICO_CONVENIO,
		''					IE_FUNCAO_MEDICO,
		''					QT_PORTE_ANESTESICO,
		''					CD_GRUPO_GASTO,
		''					DS_UNIDADE_MEDIDA,
		0					QT_CH,
		0					VL_UNITARIO_CH,
		0					VL_UNITARIO,
		0					VL_ITEM,
		0					PR_FUNCAO_PARTIC,
		0					IE_VIA_ACESSO,
		0					PR_VIA_ACESSO,
		0					PR_HORA_EXTRA,
		''					IE_LOCAL_MEDICADO,
		''					CD_BRASINDICE,
		''					CD_ITEM_CONVENIO,
		0					CD_PROCEDIMENTO_REF,
		c.cd_senha				CD_SENHA,
		''					cd_regional,
		''					nm_convenio,
		' ' 					ds_espaco,
		a.ie_estado_civil 		ie_estado_civil,
		a.nr_cpf_paciente 		nr_cpf_paciente,
		a.cd_nacionalidade 		cd_nacionalidade,
           	a.cd_cid_secundario           CD_CID_SECUNDARIO,
		0 nr_planilha,0 vl_tot_honorarios,0 vl_tot_diarias,0 vl_tot_taxas,
		0 vl_tot_medicamentos,0 vl_tot_materiais,0 vl_tot_sadt,0 vl_tot_pacote,
		0 vl_tot_ortese,0 vl_tot_protese,0 qt_tot_diarias,0 qt_tot_participantes,
		0 cd_proc_orig_pacote,
		'',	'',	'', 0,
		a.ie_tipo_atendimento,
		0 cd_grupo_proc,
		0 cd_setor_atendimento
FROM w_interf_conta_cab a
LEFT OUTER JOIN w_interf_conta_autor c ON (a.nr_interno_conta = c.nr_interno_conta)
WHERE c.nr_sequencia		=
		(select coalesce(min(x.nr_sequencia),c.nr_sequencia)
		from w_interf_conta_autor x
		where a.nr_interno_conta = x.nr_interno_conta)
 
union all

SELECT	a.NR_SEQ_PROTOCOLO,a.CD_CONVENIO CD_CONVENIO,4 TP_REGISTRO,
           	'FATOU' IE_DISQUETE,4 CD_TIPO_REGISTRO,1 NR_LOTE,a.CD_INTERNO CD_PRESTADOR,
           	0                             NR_SEQ_CONTA,
           	''                            IE_TIPO_PRESTADOR,
           	a.cd_cgc_hospital             CD_CGC,
           	''                            NM_PRESTADOR,
           	LOCALTIMESTAMP                 	DT_REMESSA,
           	a.nr_remessa			NR_SEQ_REMESSA,
           	0                             NR_REG_REMESSA,
           	''                            NM_PACIENTE,
           	''                            IE_SEXO,
           	LOCALTIMESTAMP                 	DT_NASCIMENTO,
           	''                            CD_CLIENTE,
           	a.nr_interno_conta            NR_CONTA,
		0				NR_SEQ_CONTA_ITEM,
           	''                            IE_TIPO_PACIENTE,
           	0                             CD_TIPO_ATENDIMENTO,
           	''                            CD_CLASSE_ATENDIMENTO,
           	max(a.DT_ITEM)              	DT_ITEM,
           	''                            CD_CID,
           	''                            NR_CRM,
           	''                            SG_UF_CRM,
           	''                            NM_MEDICO_REQUISITANTE,
           	''                            CD_MEDICO_REQUISITANTE,
           	a.dt_autorizacao			DT_REQUISICAO,
           	''                            NR_GUIA,
           	LOCALTIMESTAMP                 	DT_GUIA,
		''					NM_RESPONSAVEL_GUIA,
		''					CD_PROCED_GUIA,
		''					DS_PROCED_GUIA,
		0					QT_PROCED_GUIA,
		1					NR_SEQPROC_GUIA,
           	1                             NR_SEQ_ITEM,
           	a.ds_item				DS_ITEM,
           	a.CD_ITEM            		CD_ITEM,
           	sum(a.QT_ITEM)                QT_ITEM,
           	0                             QT_GUS,
		a.cd_cgc_convenio			CD_CGC_CONVENIO,
		0					NR_PRONTUARIO,
		''					CD_PLANO,
		0					CD_DEPENDENTE,
		LOCALTIMESTAMP				DT_VALIDADE_CARTEIRA,
		''					NR_IDENTIDADE,
		0					CD_TIPO_ACOMODACAO,
		trunc(dt_item,'dd')		DT_ENTRADA,
		LOCALTIMESTAMP				DT_ALTA,
		0					CD_MOTIVO_ALTA,
		''					TP_GUIA,
		substr(CASE WHEN coalesce(a.cd_grupo_gasto,'0')='1' THEN a.cd_medico_exec_conv WHEN coalesce(a.cd_grupo_gasto,'0')='3' THEN 		a.cd_medico_exec_conv  ELSE '' END ,1,9)||calcula_digito_unimed_bh('Medico_Unimed',substr(
		CASE WHEN coalesce(a.cd_grupo_gasto,'0')='1' THEN a.cd_medico_exec_conv WHEN coalesce(a.cd_grupo_gasto,'0')='3' THEN a.cd_medico_exec_conv  ELSE '' END ,5,5)) CD_MEDICO_CONVENIO,
	-- Alterado Wander 06/07/2004
		CASE WHEN coalesce(a.cd_grupo_gasto,'0')='1' THEN to_char(a.cd_funcao_executor) WHEN coalesce(a.cd_grupo_gasto,'0')='3' THEN to_char(a.cd_funcao_executor)  ELSE '' END  IE_FUNCAO_MEDICO,
		to_char(a.nr_PORTE_ANESTESICO) QT_PORTE_ANESTESICO,
	-- Alterado Wander 06/07/2004
		/*decode(a.cd_item,
			80018300,'6',80018319,'6',80018327,'6',
			80018297,'6',80018289,'6',80018254,'6',
			80018262,'6',80018270,'6',80018238,'6',
			80018246,'6',a.cd_grupo_gasto)  CD_GRUPO_GASTO,*/
		a.cd_grupo_gasto			CD_GRUPO_GASTO,
		a.cd_UNIDADE_MEDIDA		DS_UNIDADE_MEDIDA,
		a.qt_ch_item			QT_CH,
		a.vl_unitario_ch			VL_UNITARIO_CH,
		CASE WHEN sum(a.qt_item)=0 THEN 0  ELSE (sum(a.VL_total_ITEM) / sum(a.QT_ITEM)) END  VL_UNITARIO,
		-- sum(a.VL_total_ITEM) VL_ITEM, Edgar 24/01/2006 OS 28290, troquei pela linha de baixo
		round((sum(a.QT_ITEM) * round((dividir_sem_round(sum(a.vl_total_item),sum(a.QT_ITEM)))::numeric,4))::numeric, 4) vl_item,
		a.pr_funcao_participante	PR_FUNCAO_PARTIC,
		CASE WHEN a.cd_grupo_gasto=2 THEN a.pr_via_acesso  ELSE CASE WHEN a.cd_grupo_gasto=3 THEN a.pr_via_acesso  ELSE 0 END  END  IE_VIA_ACESSO,
	        CASE WHEN a.pr_via_acesso=100 THEN 0  ELSE a.pr_via_acesso END  PR_VIA_ACESSO,
		CASE WHEN a.pr_hora_extra=1 THEN 0 WHEN a.pr_hora_extra=0 THEN 0  ELSE (a.pr_hora_extra * 100 - 100) END  PR_HORA_EXTRA,
		a.cd_classif_setor		IE_LOCAL_MEDICADO,
		a.cd_brasindice			CD_BRASINDICE,
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  a.cd_item_convenio  ELSE a.cd_item END  cd_item_convenio,
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  a.cd_procedimento_ref  ELSE Obter_Proc_Origem_Pacote(nr_seq_proc_pacote) END  CD_PROCEDIMENTO_REF,
		''					CD_SENHA,
		''					cd_regional,
		''					nm_convenio,
		' ' ds_espaco,'' ie_estado_civil,'' nr_cpf_paciente,'' cd_nacionalidade,
           	'' cd_cid_secundario,0 nr_planilha,0 vl_tot_honorarios,0 vl_tot_diarias,
		0 vl_tot_taxas,0 vl_tot_medicamentos,0 vl_tot_materiais,0 vl_tot_sadt,
		0 vl_tot_pacote,0 vl_tot_ortese,0 vl_tot_protese,0 qt_tot_diarias,
		0 qt_tot_participantes,
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  0  ELSE Obter_Proc_Origem_Pacote(nr_seq_proc_pacote) END  cd_proc_orig_pacote,
		CD_CGC_CPF_RESP_CRED,
		--decode(CD_CGC_PRESTADOR,'17163528000184','', null, '','', '', a.nr_doc_convenio),
		--decode(CD_CGC_PRESTADOR,'17163528000184','', null, '','', '', a.nr_crm_requisitante),
		CASE WHEN CD_CGC_PRESTADOR='17163528000184' THEN  '' WHEN CD_CGC_PRESTADOR='18271916000141' THEN a.nr_doc_convenio WHEN CD_CGC_PRESTADOR='' THEN '' END , /*ALTERADA POR AILTON PARA TRATRAR CGC PRESTADOR */
		CASE WHEN CD_CGC_PRESTADOR='17163528000184' THEN  '' WHEN CD_CGC_PRESTADOR='18271916000141' THEN a.nr_crm_requisitante WHEN CD_CGC_PRESTADOR='' THEN '' END ,
		0, 0,
		CASE WHEN a.cd_item=80021000 THEN a.nr_sequencia WHEN a.cd_item=80021018 THEN a.nr_sequencia WHEN a.cd_item=80021026 THEN a.nr_sequencia WHEN a.cd_item=80021034 THEN a.nr_sequencia WHEN a.cd_item=80021042 THEN a.nr_sequencia WHEN a.cd_item=80021050 THEN a.nr_sequencia WHEN a.cd_item=80021069 THEN a.nr_sequencia WHEN a.cd_item=80021077 THEN a.nr_sequencia WHEN a.cd_item=80023002 THEN a.nr_sequencia WHEN a.cd_item=80023010 THEN a.nr_sequencia WHEN a.cd_item=80023037 THEN a.nr_sequencia WHEN a.cd_item=80023045 THEN a.nr_sequencia WHEN a.cd_item=80023053 THEN a.nr_sequencia WHEN a.cd_item=80023061 THEN a.nr_sequencia WHEN a.cd_item=80023070 THEN a.nr_sequencia WHEN a.cd_item=80031200 THEN a.nr_sequencia  ELSE 0 END  cd_grupo_proc,
		a.cd_setor_atendimento
from		w_interf_conta_item a
where coalesce(a.cd_grupo_proc,0) not in (32100000,32120001)
and (a.cd_item <> 15060012 and a.cd_item <> 15060020 and a.cd_item <> 15060055)
group by
		a.NR_SEQ_PROTOCOLO,
		a.CD_CONVENIO,
           	a.CD_INTERNO,
           	a.cd_cgc_hospital,
           	a.nr_remessa,
           	a.nr_interno_conta,
           	a.ds_item,
		a.dt_autorizacao,
           	a.CD_ITEM,
           	a.cd_cgc_convenio,
		CASE WHEN coalesce(a.cd_grupo_gasto,'0')='1' THEN a.cd_medico_exec_conv WHEN coalesce(a.cd_grupo_gasto,'0')='3' THEN a.cd_medico_exec_conv  ELSE '' END ,
		CASE WHEN coalesce(a.cd_grupo_gasto,'0')='1' THEN to_char(a.cd_funcao_executor) WHEN coalesce(a.cd_grupo_gasto,'0')='3' THEN to_char(a.cd_funcao_executor)  ELSE '' END ,
		to_char(a.nr_PORTE_ANESTESICO),
		a.cd_grupo_gasto,
		a.cd_UNIDADE_MEDIDA,
		a.qt_ch_item,
		a.vl_unitario_ch,
		a.pr_funcao_participante,
		a.pr_via_acesso,
		CASE WHEN a.pr_via_acesso=100 THEN 0  ELSE a.pr_via_acesso END ,
		CASE WHEN a.pr_hora_extra=1 THEN 0 WHEN a.pr_hora_extra=0 THEN 0  ELSE (a.pr_hora_extra * 100 - 100) END ,
		a.cd_classif_setor,
		a.cd_brasindice,
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  a.cd_item_convenio  ELSE a.cd_item END ,
		trunc(dt_item,'dd'),
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  a.cd_procedimento_ref  ELSE Obter_Proc_Origem_Pacote(nr_seq_proc_pacote) END ,
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  0  ELSE Obter_Proc_Origem_Pacote(nr_seq_proc_pacote) END ,
		CD_CGC_CPF_RESP_CRED,
		--decode(CD_CGC_PRESTADOR,'17163528000184','', null, '','', '', a.nr_doc_convenio),
		--decode(CD_CGC_PRESTADOR,'17163528000184','', null, '','', '', a.nr_crm_requisitante),
		CASE WHEN CD_CGC_PRESTADOR='17163528000184' THEN  '' WHEN CD_CGC_PRESTADOR='18271916000141' THEN a.nr_doc_convenio WHEN CD_CGC_PRESTADOR='' THEN '' END , /*ALTERADA POR AILTON PARA TRATAR CGC PRESTADOR */
		CASE WHEN CD_CGC_PRESTADOR='17163528000184' THEN  '' WHEN CD_CGC_PRESTADOR='18271916000141' THEN a.nr_crm_requisitante WHEN CD_CGC_PRESTADOR='' THEN '' END ,
		CASE WHEN cd_medico_executor IS NULL THEN 0  ELSE a.nr_sequencia END ,
		CASE WHEN a.cd_item=80021000 THEN a.nr_sequencia WHEN a.cd_item=80021018 THEN a.nr_sequencia WHEN a.cd_item=80021026 THEN a.nr_sequencia WHEN a.cd_item=80021034 THEN a.nr_sequencia WHEN a.cd_item=80021042 THEN a.nr_sequencia WHEN a.cd_item=80021050 THEN a.nr_sequencia WHEN a.cd_item=80021069 THEN a.nr_sequencia WHEN a.cd_item=80021077 THEN a.nr_sequencia WHEN a.cd_item=80023002 THEN a.nr_sequencia WHEN a.cd_item=80023010 THEN a.nr_sequencia WHEN a.cd_item=80023037 THEN a.nr_sequencia WHEN a.cd_item=80023045 THEN a.nr_sequencia WHEN a.cd_item=80023053 THEN a.nr_sequencia WHEN a.cd_item=80023061 THEN a.nr_sequencia WHEN a.cd_item=80023070 THEN a.nr_sequencia WHEN a.cd_item=80031200 THEN a.nr_sequencia  ELSE 0 END ,
		a.cd_setor_atendimento
	having(sum(a.VL_total_ITEM) > 0) or
		((avg(Campo_numerico(coalesce(a.cd_grupo_gasto,'0'))) <> 7) and (sum(a.QT_ITEM) > 0) and (avg(a.ie_tipo_item) <> 2))
/*      Alterado por marcus em 08/03/2002 a pedido do Wander - Se Material se valor zero nÃ£o enviar */

/*	having sum(a.QT_ITEM) > 0 or sum(a.VL_total_ITEM) > 0 retirado Marcus 12/11/01*/

union all

SELECT	a.NR_SEQ_PROTOCOLO,a.CD_CONVENIO CD_CONVENIO,4 TP_REGISTRO,
           	'FATOU' IE_DISQUETE,4 CD_TIPO_REGISTRO,1 NR_LOTE,a.CD_INTERNO CD_PRESTADOR,
           	0                             NR_SEQ_CONTA,
           	''                            IE_TIPO_PRESTADOR,
           	a.cd_cgc_hospital             CD_CGC,
           	''                            NM_PRESTADOR,
           	LOCALTIMESTAMP                 	DT_REMESSA,
           	a.nr_remessa			NR_SEQ_REMESSA,
           	0                             NR_REG_REMESSA,
           	''                            NM_PACIENTE,
           	''                            IE_SEXO,
           	LOCALTIMESTAMP                 	DT_NASCIMENTO,
           	''                            CD_CLIENTE,
           	a.nr_interno_conta            NR_CONTA,
		0				NR_SEQ_CONTA_ITEM,
           	''                            IE_TIPO_PACIENTE,
           	0                             CD_TIPO_ATENDIMENTO,
           	''                            CD_CLASSE_ATENDIMENTO,
           	max(a.DT_ITEM)              	DT_ITEM,
           	''                            CD_CID,
           	''                            NR_CRM,
           	''                            SG_UF_CRM,
           	''                            NM_MEDICO_REQUISITANTE,
           	''                            CD_MEDICO_REQUISITANTE,
           	a.dt_autorizacao			DT_REQUISICAO,
           	''                            NR_GUIA,
           	LOCALTIMESTAMP                 	DT_GUIA,
		''					NM_RESPONSAVEL_GUIA,
		''					CD_PROCED_GUIA,
		''					DS_PROCED_GUIA,
		0					QT_PROCED_GUIA,
		1					NR_SEQPROC_GUIA,
           	1                             NR_SEQ_ITEM,
           	a.ds_item				DS_ITEM,
           	a.CD_ITEM            		CD_ITEM,
           	sum(a.QT_ITEM)                QT_ITEM,
           	0                             QT_GUS,
		a.cd_cgc_convenio			CD_CGC_CONVENIO,
		0					NR_PRONTUARIO,
		''					CD_PLANO,
		0					CD_DEPENDENTE,
		LOCALTIMESTAMP				DT_VALIDADE_CARTEIRA,
		''					NR_IDENTIDADE,
		0					CD_TIPO_ACOMODACAO,
		trunc(dt_item,'dd')		DT_ENTRADA,
		LOCALTIMESTAMP				DT_ALTA,
		0					CD_MOTIVO_ALTA,
		''					TP_GUIA,
		CASE WHEN coalesce(a.cd_grupo_gasto,'0')='1' THEN a.cd_medico_exec_conv WHEN coalesce(a.cd_grupo_gasto,'0')='3' THEN a.cd_medico_exec_conv  ELSE '' END  CD_MEDICO_CONVENIO,
		CASE WHEN coalesce(a.cd_grupo_gasto,'0')='1' THEN to_char(a.cd_funcao_executor) WHEN coalesce(a.cd_grupo_gasto,'0')='3' THEN to_char(a.cd_funcao_executor)  ELSE '' END  IE_FUNCAO_MEDICO,
		to_char(a.nr_PORTE_ANESTESICO) QT_PORTE_ANESTESICO,
		a.cd_grupo_gasto			CD_GRUPO_GASTO,
		a.cd_UNIDADE_MEDIDA		DS_UNIDADE_MEDIDA,
		a.qt_ch_item			QT_CH,
		a.vl_unitario_ch			VL_UNITARIO_CH,
		CASE WHEN sum(a.qt_item)=0 THEN 0  ELSE (sum(a.vl_honorario) / sum(a.QT_ITEM)) END  VL_UNITARIO,
		sum(a.vl_honorario) VL_ITEM,
		a.pr_funcao_participante	PR_FUNCAO_PARTIC,
		a.pr_via_acesso		 	IE_VIA_ACESSO,
		CASE WHEN a.pr_via_acesso=100 THEN 0  ELSE a.pr_via_acesso END  PR_VIA_ACESSO,
		CASE WHEN a.pr_hora_extra=1 THEN 0 WHEN a.pr_hora_extra=0 THEN 0  ELSE (a.pr_hora_extra * 100 - 100) END  PR_HORA_EXTRA,
		a.cd_classif_setor		IE_LOCAL_MEDICADO,
		a.cd_brasindice			CD_BRASINDICE,
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  a.cd_item_convenio  ELSE a.cd_item END  cd_item_convenio,
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  a.cd_procedimento_ref  ELSE Obter_Proc_Origem_Pacote(nr_seq_proc_pacote) END  CD_PROCEDIMENTO_REF,
		''					CD_SENHA,
		''					cd_regional,
		''					nm_convenio,
		' ' ds_espaco,'' ie_estado_civil,'' nr_cpf_paciente,'' cd_nacionalidade,
           	'' cd_cid_secundario,0 nr_planilha,0 vl_tot_honorarios,0 vl_tot_diarias,
		0 vl_tot_taxas,0 vl_tot_medicamentos,0 vl_tot_materiais,0 vl_tot_sadt,
		0 vl_tot_pacote,0 vl_tot_ortese,0 vl_tot_protese,0 qt_tot_diarias,
		0 qt_tot_participantes,
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  0  ELSE Obter_Proc_Origem_Pacote(nr_seq_proc_pacote) END  cd_proc_orig_pacote,
		CD_CGC_CPF_RESP_CRED,
		--decode(CD_CGC_PRESTADOR,'17163528000184','', null, '','', '', a.nr_doc_convenio),
		--decode(CD_CGC_PRESTADOR,'17163528000184','', null, '','', '', a.nr_crm_requisitante),
		CASE WHEN CD_CGC_PRESTADOR='17163528000184' THEN  '' WHEN CD_CGC_PRESTADOR='18271916000141' THEN a.nr_doc_convenio WHEN CD_CGC_PRESTADOR='' THEN '' END , /*ALTERADA POR AILTON PARA TRATRAR CGC PRESTADOR */
		CASE WHEN CD_CGC_PRESTADOR='17163528000184' THEN  '' WHEN CD_CGC_PRESTADOR='18271916000141' THEN a.nr_crm_requisitante WHEN CD_CGC_PRESTADOR='' THEN '' END ,
		0, 0,
		CASE WHEN a.cd_item=80021000 THEN a.nr_sequencia WHEN a.cd_item=80021018 THEN a.nr_sequencia WHEN a.cd_item=80021026 THEN a.nr_sequencia WHEN a.cd_item=80021034 THEN a.nr_sequencia WHEN a.cd_item=80021042 THEN a.nr_sequencia WHEN a.cd_item=80021050 THEN a.nr_sequencia WHEN a.cd_item=80021069 THEN a.nr_sequencia WHEN a.cd_item=80021077 THEN a.nr_sequencia WHEN a.cd_item=80023002 THEN a.nr_sequencia WHEN a.cd_item=80023010 THEN a.nr_sequencia WHEN a.cd_item=80023037 THEN a.nr_sequencia WHEN a.cd_item=80023045 THEN a.nr_sequencia WHEN a.cd_item=80023053 THEN a.nr_sequencia WHEN a.cd_item=80023061 THEN a.nr_sequencia WHEN a.cd_item=80023070 THEN a.nr_sequencia WHEN a.cd_item=80031200 THEN a.nr_sequencia  ELSE 0 END  cd_grupo_proc,
		a.cd_setor_atendimento
from		w_interf_conta_item a
where		a.cd_grupo_proc in (32100000,32120001, 80017010)
group by
		a.NR_SEQ_PROTOCOLO,
		a.CD_CONVENIO,
           	a.CD_INTERNO,
           	a.cd_cgc_hospital,
           	a.nr_remessa,
           	a.nr_interno_conta,
           	a.ds_item,
		a.dt_autorizacao,
           	a.CD_ITEM,
           	a.cd_cgc_convenio,
		CASE WHEN coalesce(a.cd_grupo_gasto,'0')='1' THEN a.cd_medico_exec_conv WHEN coalesce(a.cd_grupo_gasto,'0')='3' THEN a.cd_medico_exec_conv  ELSE '' END ,
		CASE WHEN coalesce(a.cd_grupo_gasto,'0')='1' THEN to_char(a.cd_funcao_executor) WHEN coalesce(a.cd_grupo_gasto,'0')='3' THEN to_char(a.cd_funcao_executor)  ELSE '' END ,
		to_char(a.nr_PORTE_ANESTESICO),
		a.cd_grupo_gasto,
		a.cd_UNIDADE_MEDIDA,
		a.qt_ch_item,
		a.vl_unitario_ch,
		a.pr_funcao_participante,
		a.pr_via_acesso,
		CASE WHEN a.pr_via_acesso=100 THEN 0  ELSE a.pr_via_acesso END ,
		CASE WHEN a.pr_hora_extra=1 THEN 0 WHEN a.pr_hora_extra=0 THEN 0  ELSE (a.pr_hora_extra * 100 - 100) END ,
		a.cd_classif_setor,
		a.cd_brasindice,
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  a.cd_item_convenio  ELSE a.cd_item END ,
		trunc(dt_item,'dd'),
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  a.cd_procedimento_ref  ELSE Obter_Proc_Origem_Pacote(nr_seq_proc_pacote) END ,
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  0  ELSE Obter_Proc_Origem_Pacote(nr_seq_proc_pacote) END ,
		CD_CGC_CPF_RESP_CRED,
		--decode(CD_CGC_PRESTADOR,'17163528000184','', null, '','', '', a.nr_doc_convenio),
		--decode(CD_CGC_PRESTADOR,'17163528000184','', null, '','', '', a.nr_crm_requisitante),
		CASE WHEN CD_CGC_PRESTADOR='17163528000184' THEN  '' WHEN CD_CGC_PRESTADOR='18271916000141' THEN a.nr_doc_convenio WHEN CD_CGC_PRESTADOR='' THEN '' END , /*ALTERADA POR AILTON PARA TRATAR CGC PRESTADOR */
		CASE WHEN CD_CGC_PRESTADOR='17163528000184' THEN  '' WHEN CD_CGC_PRESTADOR='18271916000141' THEN a.nr_crm_requisitante WHEN CD_CGC_PRESTADOR='' THEN '' END ,
		CASE WHEN cd_medico_executor IS NULL THEN 0  ELSE a.nr_sequencia END ,
		CASE WHEN a.cd_item=80021000 THEN a.nr_sequencia WHEN a.cd_item=80021018 THEN a.nr_sequencia WHEN a.cd_item=80021026 THEN a.nr_sequencia WHEN a.cd_item=80021034 THEN a.nr_sequencia WHEN a.cd_item=80021042 THEN a.nr_sequencia WHEN a.cd_item=80021050 THEN a.nr_sequencia WHEN a.cd_item=80021069 THEN a.nr_sequencia WHEN a.cd_item=80021077 THEN a.nr_sequencia WHEN a.cd_item=80023002 THEN a.nr_sequencia WHEN a.cd_item=80023010 THEN a.nr_sequencia WHEN a.cd_item=80023037 THEN a.nr_sequencia WHEN a.cd_item=80023045 THEN a.nr_sequencia WHEN a.cd_item=80023053 THEN a.nr_sequencia WHEN a.cd_item=80023061 THEN a.nr_sequencia WHEN a.cd_item=80023070 THEN a.nr_sequencia WHEN a.cd_item=80031200 THEN a.nr_sequencia  ELSE 0 END ,
		a.cd_setor_atendimento
	having(sum(a.vl_honorario) > 0) or
		((avg(Campo_numerico(coalesce(a.cd_grupo_gasto,'0'))) <> 7) and (sum(a.QT_ITEM) > 0) and (avg(a.ie_tipo_item) <> 2))

union all

SELECT	a.NR_SEQ_PROTOCOLO,a.CD_CONVENIO CD_CONVENIO,4 TP_REGISTRO,
           	'FATOU' IE_DISQUETE,4 CD_TIPO_REGISTRO,1 NR_LOTE,b.cd_interno CD_PRESTADOR,
           	0                             NR_SEQ_CONTA,
           	''                            IE_TIPO_PRESTADOR,
           	a.cd_cgc_hospital             CD_CGC,
           	''                            NM_PRESTADOR,
           	LOCALTIMESTAMP                 	DT_REMESSA,
           	a.nr_remessa			NR_SEQ_REMESSA,
           	0                             NR_REG_REMESSA,
           	''                            NM_PACIENTE,
           	''                            IE_SEXO,
           	LOCALTIMESTAMP                 	DT_NASCIMENTO,
           	''                            CD_CLIENTE,
           	a.nr_interno_conta            NR_CONTA,
		0				NR_SEQ_CONTA_ITEM,
           	''                            IE_TIPO_PACIENTE,
           	0                             CD_TIPO_ATENDIMENTO,
           	''                            CD_CLASSE_ATENDIMENTO,
           	max(a.DT_ITEM)              	DT_ITEM,
           	''                            CD_CID,
           	''                            NR_CRM,
           	''                            SG_UF_CRM,
           	''                            NM_MEDICO_REQUISITANTE,
           	''                            CD_MEDICO_REQUISITANTE,
           	a.dt_autorizacao			DT_REQUISICAO,
           	''                            NR_GUIA,
           	LOCALTIMESTAMP                 	DT_GUIA,
		''					NM_RESPONSAVEL_GUIA,
		''					CD_PROCED_GUIA,
		''					DS_PROCED_GUIA,
		0					QT_PROCED_GUIA,
		1					NR_SEQPROC_GUIA,
           	1                             NR_SEQ_ITEM,
           	a.ds_item				DS_ITEM,
           	a.CD_ITEM            		CD_ITEM,
           	sum(a.QT_ITEM)                QT_ITEM,
           	0                             QT_GUS,
		a.cd_cgc_convenio			CD_CGC_CONVENIO,
		0					NR_PRONTUARIO,
		''					CD_PLANO,
		0					CD_DEPENDENTE,
		LOCALTIMESTAMP				DT_VALIDADE_CARTEIRA,
		''					NR_IDENTIDADE,
		0					CD_TIPO_ACOMODACAO,
		trunc(dt_item,'dd')		DT_ENTRADA,
		LOCALTIMESTAMP				DT_ALTA,
		0					CD_MOTIVO_ALTA,
		''					TP_GUIA,
		'' CD_MEDICO_CONVENIO,
		'' IE_FUNCAO_MEDICO,
		to_char(a.nr_PORTE_ANESTESICO) QT_PORTE_ANESTESICO,
		a.cd_grupo_gasto			CD_GRUPO_GASTO,
		a.cd_UNIDADE_MEDIDA		DS_UNIDADE_MEDIDA,
		a.qt_ch_item			QT_CH,
		a.vl_unitario_ch			VL_UNITARIO_CH,
		CASE WHEN sum(a.qt_item)=0 THEN 0  ELSE (sum(a.vl_custo_oper + a.vl_filme) / sum(a.QT_ITEM)) END  VL_UNITARIO,
		sum(a.vl_custo_oper + a.vl_filme) VL_ITEM,
		a.pr_funcao_participante	PR_FUNCAO_PARTIC,
		a.pr_via_acesso		 	IE_VIA_ACESSO,
		CASE WHEN a.pr_via_acesso=100 THEN 0  ELSE a.pr_via_acesso END  PR_VIA_ACESSO,
		CASE WHEN a.pr_hora_extra=1 THEN 0 WHEN a.pr_hora_extra=0 THEN 0  ELSE (a.pr_hora_extra * 100 - 100) END  PR_HORA_EXTRA,
		a.cd_classif_setor		IE_LOCAL_MEDICADO,
		a.cd_brasindice			CD_BRASINDICE,
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  a.cd_item_convenio  ELSE a.cd_item END  cd_item_convenio,
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  a.cd_procedimento_ref  ELSE Obter_Proc_Origem_Pacote(nr_seq_proc_pacote) END  CD_PROCEDIMENTO_REF,
		''					CD_SENHA,
		''					cd_regional,
		''					nm_convenio,
		' ' ds_espaco,'' ie_estado_civil,'' nr_cpf_paciente,'' cd_nacionalidade,
           	'' cd_cid_secundario,0 nr_planilha,0 vl_tot_honorarios,0 vl_tot_diarias,
		0 vl_tot_taxas,0 vl_tot_medicamentos,0 vl_tot_materiais,0 vl_tot_sadt,
		0 vl_tot_pacote,0 vl_tot_ortese,0 vl_tot_protese,0 qt_tot_diarias,
		0 qt_tot_participantes,
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  0  ELSE Obter_Proc_Origem_Pacote(nr_seq_proc_pacote) END  cd_proc_orig_pacote,
		CD_CGC_CPF_RESP_CRED,
		--decode(CD_CGC_PRESTADOR,'17163528000184','', null, '','', '', a.nr_doc_convenio),
		--decode(CD_CGC_PRESTADOR,'17163528000184','', null, '','', '', a.nr_crm_requisitante),
		CASE WHEN CD_CGC_PRESTADOR='17163528000184' THEN  '' WHEN CD_CGC_PRESTADOR='18271916000141' THEN a.nr_doc_convenio WHEN CD_CGC_PRESTADOR='' THEN '' END , /*ALTERADA POR AILTON PARA TRATRAR CGC PRESTADOR */
		CASE WHEN CD_CGC_PRESTADOR='17163528000184' THEN  '' WHEN CD_CGC_PRESTADOR='18271916000141' THEN a.nr_crm_requisitante WHEN CD_CGC_PRESTADOR='' THEN '' END ,
		0, 0,
		CASE WHEN a.cd_item=80021000 THEN a.nr_sequencia WHEN a.cd_item=80021018 THEN a.nr_sequencia WHEN a.cd_item=80021026 THEN a.nr_sequencia WHEN a.cd_item=80021034 THEN a.nr_sequencia WHEN a.cd_item=80021042 THEN a.nr_sequencia WHEN a.cd_item=80021050 THEN a.nr_sequencia WHEN a.cd_item=80021069 THEN a.nr_sequencia WHEN a.cd_item=80021077 THEN a.nr_sequencia WHEN a.cd_item=80023002 THEN a.nr_sequencia WHEN a.cd_item=80023010 THEN a.nr_sequencia WHEN a.cd_item=80023037 THEN a.nr_sequencia WHEN a.cd_item=80023045 THEN a.nr_sequencia WHEN a.cd_item=80023053 THEN a.nr_sequencia WHEN a.cd_item=80023061 THEN a.nr_sequencia WHEN a.cd_item=80023070 THEN a.nr_sequencia WHEN a.cd_item=80031200 THEN a.nr_sequencia  ELSE 0 END  cd_grupo_proc,
		a.cd_setor_atendimento
from		w_interf_conta_header b,
		w_interf_conta_item a
where a.nr_seq_protocolo = b.nr_seq_protocolo
  and a.cd_grupo_proc in (32100000,32120001)
group by
		a.NR_SEQ_PROTOCOLO,
		a.CD_CONVENIO,
           	b.cd_interno,
           	a.cd_cgc_hospital,
           	a.nr_remessa,
           	a.nr_interno_conta,
           	a.ds_item,
		a.dt_autorizacao,
           	a.CD_ITEM,
           	a.cd_cgc_convenio,
		CASE WHEN coalesce(a.cd_grupo_gasto,'0')='1' THEN a.cd_medico_exec_conv WHEN coalesce(a.cd_grupo_gasto,'0')='3' THEN a.cd_medico_exec_conv  ELSE '' END ,
		CASE WHEN coalesce(a.cd_grupo_gasto,'0')='1' THEN to_char(a.cd_funcao_executor) WHEN coalesce(a.cd_grupo_gasto,'0')='3' THEN to_char(a.cd_funcao_executor)  ELSE '' END ,
		to_char(a.nr_PORTE_ANESTESICO),
		a.cd_grupo_gasto,
		a.cd_UNIDADE_MEDIDA,
		a.qt_ch_item,
		a.vl_unitario_ch,
		a.pr_funcao_participante,
		a.pr_via_acesso,
		CASE WHEN a.pr_via_acesso=100 THEN 0  ELSE a.pr_via_acesso END ,
		CASE WHEN a.pr_hora_extra=1 THEN 0 WHEN a.pr_hora_extra=0 THEN 0  ELSE (a.pr_hora_extra * 100 - 100) END ,
		a.cd_classif_setor,
		a.cd_brasindice,
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  a.cd_item_convenio  ELSE a.cd_item END ,
		trunc(dt_item,'dd'),
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  a.cd_procedimento_ref  ELSE Obter_Proc_Origem_Pacote(nr_seq_proc_pacote) END ,
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  0  ELSE Obter_Proc_Origem_Pacote(nr_seq_proc_pacote) END ,
		CD_CGC_CPF_RESP_CRED,
		--decode(CD_CGC_PRESTADOR,'17163528000184','', null, '','', '', a.nr_doc_convenio),
		--decode(CD_CGC_PRESTADOR,'17163528000184','', null, '','', '', a.nr_crm_requisitante),
		CASE WHEN CD_CGC_PRESTADOR='17163528000184' THEN  '' WHEN CD_CGC_PRESTADOR='18271916000141' THEN a.nr_doc_convenio WHEN CD_CGC_PRESTADOR='' THEN '' END , /*ALTERADA POR AILTON PARA TRATAR CGC PRESTADOR */
		CASE WHEN CD_CGC_PRESTADOR='17163528000184' THEN  '' WHEN CD_CGC_PRESTADOR='18271916000141' THEN a.nr_crm_requisitante WHEN CD_CGC_PRESTADOR='' THEN '' END ,
		CASE WHEN cd_medico_executor IS NULL THEN 0  ELSE a.nr_sequencia END ,
		CASE WHEN a.cd_item=80021000 THEN a.nr_sequencia WHEN a.cd_item=80021018 THEN a.nr_sequencia WHEN a.cd_item=80021026 THEN a.nr_sequencia WHEN a.cd_item=80021034 THEN a.nr_sequencia WHEN a.cd_item=80021042 THEN a.nr_sequencia WHEN a.cd_item=80021050 THEN a.nr_sequencia WHEN a.cd_item=80021069 THEN a.nr_sequencia WHEN a.cd_item=80021077 THEN a.nr_sequencia WHEN a.cd_item=80023002 THEN a.nr_sequencia WHEN a.cd_item=80023010 THEN a.nr_sequencia WHEN a.cd_item=80023037 THEN a.nr_sequencia WHEN a.cd_item=80023045 THEN a.nr_sequencia WHEN a.cd_item=80023053 THEN a.nr_sequencia WHEN a.cd_item=80023061 THEN a.nr_sequencia WHEN a.cd_item=80023070 THEN a.nr_sequencia WHEN a.cd_item=80031200 THEN a.nr_sequencia  ELSE 0 END ,
		a.cd_setor_atendimento
	having(sum(a.vl_custo_oper + a.vl_filme) > 0) or
		((avg(Campo_numerico(coalesce(a.cd_grupo_gasto,'0'))) <> 7) and (sum(a.QT_ITEM) > 0) and (avg(a.ie_tipo_item) <> 2))

union all

SELECT	a.NR_SEQ_PROTOCOLO,a.CD_CONVENIO CD_CONVENIO,4 TP_REGISTRO,
           	'FATOU' IE_DISQUETE,4 CD_TIPO_REGISTRO,1 NR_LOTE,b.cd_interno CD_PRESTADOR,
           	0                             NR_SEQ_CONTA,
           	''                            IE_TIPO_PRESTADOR,
           	a.cd_cgc_hospital             CD_CGC,
           	''                            NM_PRESTADOR,
           	LOCALTIMESTAMP                 	DT_REMESSA,
           	a.nr_remessa			NR_SEQ_REMESSA,
           	0                             NR_REG_REMESSA,
           	''                            NM_PACIENTE,
           	''                            IE_SEXO,
           	LOCALTIMESTAMP                 	DT_NASCIMENTO,
           	''                            CD_CLIENTE,
           	a.nr_interno_conta            NR_CONTA,
		0				NR_SEQ_CONTA_ITEM,
           	''                            IE_TIPO_PACIENTE,
           	0                             CD_TIPO_ATENDIMENTO,
           	''                            CD_CLASSE_ATENDIMENTO,
           	max(a.DT_ITEM)              	DT_ITEM,
           	''                            CD_CID,
           	''                            NR_CRM,
           	''                            SG_UF_CRM,
           	''                            NM_MEDICO_REQUISITANTE,
           	''                            CD_MEDICO_REQUISITANTE,
           	a.dt_autorizacao			DT_REQUISICAO,
           	''                            NR_GUIA,
           	LOCALTIMESTAMP                 	DT_GUIA,
		''					NM_RESPONSAVEL_GUIA,
		''					CD_PROCED_GUIA,
		''					DS_PROCED_GUIA,
		0					QT_PROCED_GUIA,
		1					NR_SEQPROC_GUIA,
           	1                             NR_SEQ_ITEM,
           	a.ds_item				DS_ITEM,
           	a.CD_ITEM            		CD_ITEM,
           	sum(a.QT_ITEM)                QT_ITEM,
           	0                             QT_GUS,
		a.cd_cgc_convenio			CD_CGC_CONVENIO,
		0					NR_PRONTUARIO,
		''					CD_PLANO,
		0					CD_DEPENDENTE,
		LOCALTIMESTAMP				DT_VALIDADE_CARTEIRA,
		''					NR_IDENTIDADE,
		0					CD_TIPO_ACOMODACAO,
		trunc(dt_item,'dd')		DT_ENTRADA,
		LOCALTIMESTAMP				DT_ALTA,
		0					CD_MOTIVO_ALTA,
		''					TP_GUIA,
		'' CD_MEDICO_CONVENIO,
		'' IE_FUNCAO_MEDICO,
		to_char(a.nr_PORTE_ANESTESICO) QT_PORTE_ANESTESICO,
		a.cd_grupo_gasto			CD_GRUPO_GASTO,
		a.cd_UNIDADE_MEDIDA		DS_UNIDADE_MEDIDA,
		a.qt_ch_item			QT_CH,
		a.vl_unitario_ch			VL_UNITARIO_CH,
		CASE WHEN sum(a.qt_item)=0 THEN 0  ELSE (sum(a.VL_custo_oper) / sum(a.QT_ITEM)) END  VL_UNITARIO,
		sum(a.VL_custo_oper) VL_ITEM,
		a.pr_funcao_participante	PR_FUNCAO_PARTIC,
		a.pr_via_acesso		 	IE_VIA_ACESSO,
		CASE WHEN a.pr_via_acesso=100 THEN 0  ELSE a.pr_via_acesso END  PR_VIA_ACESSO,
		CASE WHEN a.pr_hora_extra=1 THEN 0 WHEN a.pr_hora_extra=0 THEN 0  ELSE (a.pr_hora_extra * 100 - 100) END  PR_HORA_EXTRA,
		a.cd_classif_setor		IE_LOCAL_MEDICADO,
		a.cd_brasindice			CD_BRASINDICE,
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  a.cd_item_convenio  ELSE a.cd_item END  cd_item_convenio,
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  a.cd_procedimento_ref  ELSE Obter_Proc_Origem_Pacote(nr_seq_proc_pacote) END  CD_PROCEDIMENTO_REF,
		''					CD_SENHA,
		''					cd_regional,
		''					nm_convenio,
		' ' ds_espaco,'' ie_estado_civil,'' nr_cpf_paciente,'' cd_nacionalidade,
           	'' cd_cid_secundario,0 nr_planilha,0 vl_tot_honorarios,0 vl_tot_diarias,
		0 vl_tot_taxas,0 vl_tot_medicamentos,0 vl_tot_materiais,0 vl_tot_sadt,
		0 vl_tot_pacote,0 vl_tot_ortese,0 vl_tot_protese,0 qt_tot_diarias,
		0 qt_tot_participantes,
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  0  ELSE Obter_Proc_Origem_Pacote(nr_seq_proc_pacote) END  cd_proc_orig_pacote,
		CD_CGC_CPF_RESP_CRED,
		--decode(CD_CGC_PRESTADOR,'17163528000184','', null, '','', '', a.nr_doc_convenio),
		--decode(CD_CGC_PRESTADOR,'17163528000184','', null, '','', '', a.nr_crm_requisitante),
		CASE WHEN CD_CGC_PRESTADOR='17163528000184' THEN  '' WHEN CD_CGC_PRESTADOR='18271916000141' THEN a.nr_doc_convenio WHEN CD_CGC_PRESTADOR='' THEN '' END , /*ALTERADA POR AILTON PARA TRATRAR CGC PRESTADOR */
		CASE WHEN CD_CGC_PRESTADOR='17163528000184' THEN  '' WHEN CD_CGC_PRESTADOR='18271916000141' THEN a.nr_crm_requisitante WHEN CD_CGC_PRESTADOR='' THEN '' END ,
		0, 0,
		CASE WHEN a.cd_item=80021000 THEN a.nr_sequencia WHEN a.cd_item=80021018 THEN a.nr_sequencia WHEN a.cd_item=80021026 THEN a.nr_sequencia WHEN a.cd_item=80021034 THEN a.nr_sequencia WHEN a.cd_item=80021042 THEN a.nr_sequencia WHEN a.cd_item=80021050 THEN a.nr_sequencia WHEN a.cd_item=80021069 THEN a.nr_sequencia WHEN a.cd_item=80021077 THEN a.nr_sequencia WHEN a.cd_item=80023002 THEN a.nr_sequencia WHEN a.cd_item=80023010 THEN a.nr_sequencia WHEN a.cd_item=80023037 THEN a.nr_sequencia WHEN a.cd_item=80023045 THEN a.nr_sequencia WHEN a.cd_item=80023053 THEN a.nr_sequencia WHEN a.cd_item=80023061 THEN a.nr_sequencia WHEN a.cd_item=80023070 THEN a.nr_sequencia WHEN a.cd_item=80031200 THEN a.nr_sequencia  ELSE 0 END  cd_grupo_proc,
		a.cd_setor_atendimento
from		w_interf_conta_header b,
		w_interf_conta_item a
where a.nr_seq_protocolo = b.nr_seq_protocolo
  and ie_responsavel_credito = 'M'
  and vl_honorario > 0
  and vl_custo_oper > 0
  and vl_honorario = vl_total_item
  and a.cd_grupo_proc not in (32100000,32120001)
group by
		a.NR_SEQ_PROTOCOLO,
		a.CD_CONVENIO,
           	b.cd_interno,
           	a.cd_cgc_hospital,
           	a.nr_remessa,
           	a.nr_interno_conta,
           	a.ds_item,
		a.dt_autorizacao,
           	a.CD_ITEM,
           	a.cd_cgc_convenio,
		CASE WHEN coalesce(a.cd_grupo_gasto,'0')='1' THEN a.cd_medico_exec_conv WHEN coalesce(a.cd_grupo_gasto,'0')='3' THEN a.cd_medico_exec_conv  ELSE '' END ,
		CASE WHEN coalesce(a.cd_grupo_gasto,'0')='1' THEN to_char(a.cd_funcao_executor) WHEN coalesce(a.cd_grupo_gasto,'0')='3' THEN to_char(a.cd_funcao_executor)  ELSE '' END ,
		to_char(a.nr_PORTE_ANESTESICO),
		a.cd_grupo_gasto,
		a.cd_UNIDADE_MEDIDA,
		a.qt_ch_item,
		a.vl_unitario_ch,
		a.pr_funcao_participante,
		a.pr_via_acesso,
		CASE WHEN a.pr_via_acesso=100 THEN 0  ELSE a.pr_via_acesso END ,
		CASE WHEN a.pr_hora_extra=1 THEN 0 WHEN a.pr_hora_extra=0 THEN 0  ELSE (a.pr_hora_extra * 100 - 100) END ,
		a.cd_classif_setor,
		a.cd_brasindice,
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  a.cd_item_convenio  ELSE a.cd_item END ,
		trunc(dt_item,'dd'),
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  a.cd_procedimento_ref  ELSE Obter_Proc_Origem_Pacote(nr_seq_proc_pacote) END ,
		CASE WHEN nr_seq_proc_pacote IS NULL THEN  0  ELSE Obter_Proc_Origem_Pacote(nr_seq_proc_pacote) END ,
		CD_CGC_CPF_RESP_CRED,
		--decode(CD_CGC_PRESTADOR,'17163528000184','', null, '','', '', a.nr_doc_convenio),
		--decode(CD_CGC_PRESTADOR,'17163528000184','', null, '','', '', a.nr_crm_requisitante),
		CASE WHEN CD_CGC_PRESTADOR='17163528000184' THEN  '' WHEN CD_CGC_PRESTADOR='18271916000141' THEN a.nr_doc_convenio WHEN CD_CGC_PRESTADOR='' THEN '' END , /*ALTERADA POR AILTON PARA TRATAR CGC PRESTADOR */
		CASE WHEN CD_CGC_PRESTADOR='17163528000184' THEN  '' WHEN CD_CGC_PRESTADOR='18271916000141' THEN a.nr_crm_requisitante WHEN CD_CGC_PRESTADOR='' THEN '' END ,
		CASE WHEN cd_medico_executor IS NULL THEN 0  ELSE a.nr_sequencia END ,
		CASE WHEN a.cd_item=80021000 THEN a.nr_sequencia WHEN a.cd_item=80021018 THEN a.nr_sequencia WHEN a.cd_item=80021026 THEN a.nr_sequencia WHEN a.cd_item=80021034 THEN a.nr_sequencia WHEN a.cd_item=80021042 THEN a.nr_sequencia WHEN a.cd_item=80021050 THEN a.nr_sequencia WHEN a.cd_item=80021069 THEN a.nr_sequencia WHEN a.cd_item=80021077 THEN a.nr_sequencia WHEN a.cd_item=80023002 THEN a.nr_sequencia WHEN a.cd_item=80023010 THEN a.nr_sequencia WHEN a.cd_item=80023037 THEN a.nr_sequencia WHEN a.cd_item=80023045 THEN a.nr_sequencia WHEN a.cd_item=80023053 THEN a.nr_sequencia WHEN a.cd_item=80023061 THEN a.nr_sequencia WHEN a.cd_item=80023070 THEN a.nr_sequencia WHEN a.cd_item=80031200 THEN a.nr_sequencia  ELSE 0 END ,
		a.cd_setor_atendimento
	having(sum(a.VL_total_ITEM) > 0) or
		((avg(Campo_numerico(coalesce(a.cd_grupo_gasto,'0'))) <> 7) and (sum(a.QT_ITEM) > 0) and (avg(a.ie_tipo_item) <> 2))

union all

SELECT     	a.NR_SEQ_PROTOCOLO,a.CD_CONVENIO CD_CONVENIO,5 TP_REGISTRO,
           	'FATOU' IE_DISQUETE,5 CD_TIPO_REGISTRO,1 NR_LOTE,a.CD_INTERNO CD_PRESTADOR,
           	0                             	NR_SEQ_CONTA,
           	''                            	IE_TIPO_PRESTADOR,
           	a.cd_cgc_hospital           	CD_CGC,
           	''                            	NM_PRESTADOR,
           	LOCALTIMESTAMP                 		DT_REMESSA,
           	a.nr_remessa				NR_SEQ_REMESSA,
           	0                             	NR_REG_REMESSA,
           	''                            	NM_PACIENTE,
           	''                            	IE_SEXO,
           	LOCALTIMESTAMP                 		DT_NASCIMENTO,
           	''                            	CD_CLIENTE,
           	a.NR_INTERNO_CONTA	      		NR_CONTA,
		w.nr_seq_registro 			NR_SEQ_CONTA_ITEM,
           	''            	            	IE_TIPO_PACIENTE,
           	0      	                    	CD_TIPO_ATENDIMENTO,
           	''	                          	CD_CLASSE_ATENDIMENTO,
           	LOCALTIMESTAMP                 		DT_ITEM,
           	''                   	      	CD_CID,
           	''              	              NR_CRM,
           	''                	            	SG_UF_CRM,
           	''                            	NM_MEDICO_REQUISITANTE,
           	''                            	CD_MEDICO_REQUISITANTE,
           	LOCALTIMESTAMP                       	DT_REQUISICAO,
           	''                            	NR_GUIA,
           	LOCALTIMESTAMP                 		DT_GUIA,
		''					NM_RESPONSAVEL_GUIA,
		''					CD_PROCED_GUIA,
		''					DS_PROCED_GUIA,
		0					QT_PROCED_GUIA,
		0					NR_SEQPROC_GUIA,
           	0                             	NR_SEQ_ITEM,
           	''                            	DS_ITEM,
           	0                          	  	CD_ITEM,
           	0                    	       QT_ITEM,
           	0                   	          	QT_GUS,
		a.cd_cgc_convenio			CD_CGC_CONVENIO,
		0					NR_PRONTUARIO,
		''					CD_PLANO,
		0					CD_DEPENDENTE,
		LOCALTIMESTAMP				DT_VALIDADE_CARTEIRA,
		''					NR_IDENTIDADE,
		0					CD_TIPO_ACOMODACAO,
		LOCALTIMESTAMP				DT_ENTRADA,
		LOCALTIMESTAMP				DT_ALTA,
		0					CD_MOTIVO_ALTA,
		''					TP_GUIA,
		''					CD_MEDICO_CONVENIO,
		''					IE_FUNCAO_MEDICO,
		''					QT_PORTE_ANESTESICO,
		''					CD_GRUPO_GASTO,
		''					DS_UNIDADE_MEDIDA,
		0					QT_CH,
		0					VL_UNITARIO_CH,
		0					VL_UNITARIO,
		sum(b.vl_total_item  +
			CASE WHEN ie_responsavel_credito='M' THEN 				CASE WHEN coalesce(vl_honorario,0)=0 THEN  0  ELSE CASE WHEN coalesce(vl_custo_oper,0)=0 THEN  0  ELSE CASE WHEN vl_honorario=vl_total_item THEN  vl_custo_oper  ELSE 0 END  END  END   ELSE 0 END ) vl_item,
		0					PR_FUNCAO_PARTIC,
		0					IE_VIA_ACESSO,
		0					PR_VIA_ACESSO,
		0					PR_HORA_EXTRA,
		''					IE_LOCAL_MEDICADO,
		''					CD_BRASINDICE,
		''					CD_ITEM_CONVENIO,
		0					CD_PROCEDIMENTO_REF,
		''					CD_SENHA,
		''					cd_regional,
		''					nm_convenio,
		' ' ds_espaco,'' ie_estado_civil,'' nr_cpf_paciente,'' cd_nacionalidade,
           	'' cd_cid_secundario,0 nr_planilha,
		sum(CASE WHEN b.cd_grupo_gasto='3' THEN 				CASE WHEN b.cd_grupo_proc=32100000 THEN b.vl_honorario WHEN b.cd_grupo_proc=32120001 THEN b.vl_honorario  ELSE b.vl_total_item END   ELSE 0 END ) vl_tot_honorarios,
		sum(CASE WHEN b.cd_grupo_gasto='6' THEN b.vl_total_item  ELSE 0 END ) vl_tot_diarias,
		sum(CASE WHEN b.cd_grupo_gasto='7' THEN b.vl_total_item  ELSE 0 END ) vl_tot_taxas,
		sum(CASE WHEN b.cd_grupo_gasto='5' THEN b.vl_total_item  ELSE 0 END ) vl_tot_medicamentos,
		sum(CASE WHEN b.cd_grupo_gasto='4' THEN b.vl_total_item  ELSE 0 END ) vl_tot_materiais,
		sum(CASE WHEN b.cd_grupo_gasto='2' THEN b.vl_total_item  ELSE 0 END  +
				CASE WHEN ie_responsavel_credito='M' THEN 					CASE WHEN coalesce(vl_honorario,0)=0 THEN  0  ELSE CASE WHEN coalesce(vl_custo_oper,0)=0 THEN  0  ELSE CASE WHEN vl_honorario=vl_total_item THEN  vl_custo_oper  ELSE 0 END  END  END   ELSE 0 END ) vl_tot_sadt,
		sum(CASE WHEN b.cd_grupo_gasto='8' THEN b.vl_total_item  ELSE 0 END ) vl_tot_pacote,
		0 vl_tot_ortese,
		0 vl_tot_protese,
		a.qt_diarias qt_tot_diarias,
		a.qt_participantes qt_tot_participantes,
		0 cd_proc_orig_pacote,
		'',	'',	'', 0, 0,
		0 cd_grupo_proc    ,
		0 cd_setor_atendimento
from		w_interf_conta_item b,
		w_interf_conta_cab w,
		w_interf_conta_total a
where		a.nr_interno_conta	= b.nr_interno_conta
and		a.nr_interno_conta	= w.nr_interno_conta
group by
		a.NR_SEQ_PROTOCOLO,
		a.CD_CONVENIO,
           	'FATOU',
		5,
		1,
		a.CD_INTERNO,
           	a.cd_cgc_hospital,
           	a.nr_remessa,
           	LOCALTIMESTAMP,
           	a.NR_INTERNO_CONTA,
		w.nr_seq_registro,
		a.cd_cgc_convenio,
		a.qt_diarias,
		a.qt_participantes

union all

SELECT     	a.NR_SEQ_PROTOCOLO,a.CD_CONVENIO CD_CONVENIO,9 TP_REGISTRO,
           	'FATOU' IE_DISQUETE,9 CD_TIPO_REGISTRO,9999 NR_LOTE,a.CD_INTERNO CD_PRESTADOR,
           	0 NR_SEQ_CONTA, '' IE_TIPO_PRESTADOR, a.cd_cgc_hospital CD_CGC,
           	'' NM_PRESTADOR,	LOCALTIMESTAMP DT_REMESSA,
           	a.nr_remessa NR_SEQ_REMESSA, 0 NR_REG_REMESSA,	'' NM_PACIENTE,
           	'' IE_SEXO,	LOCALTIMESTAMP DT_NASCIMENTO,
           	'' CD_CLIENTE, 99999999	NR_CONTA, 0 NR_SEQ_CONTA_ITEM,  '' IE_TIPO_PACIENTE,
           	0 CD_TIPO_ATENDIMENTO, '' CD_CLASSE_ATENDIMENTO,
           	LOCALTIMESTAMP DT_ITEM, '' CD_CID, '' NR_CRM,
           	'' SG_UF_CRM, ''  NM_MEDICO_REQUISITANTE,	''  CD_MEDICO_REQUISITANTE,
           	LOCALTIMESTAMP DT_REQUISICAO, 	''   NR_GUIA, LOCALTIMESTAMP DT_GUIA, '' NM_RESPONSAVEL_GUIA,
		'' CD_PROCED_GUIA, '' DS_PROCED_GUIA, 0 QT_PROCED_GUIA, 0 NR_SEQPROC_GUIA,
           	0  NR_SEQ_ITEM, '' DS_ITEM, 0  CD_ITEM, 0  QT_ITEM, a.qt_total_conta QT_GUS,
		a.cd_cgc_convenio	CD_CGC_CONVENIO, 0 NR_PRONTUARIO, '' CD_PLANO,
		0 CD_DEPENDENTE, LOCALTIMESTAMP DT_VALIDADE_CARTEIRA, '' NR_IDENTIDADE,
		0 CD_TIPO_ACOMODACAO, LOCALTIMESTAMP DT_ENTRADA,	LOCALTIMESTAMP DT_ALTA,
		0 CD_MOTIVO_ALTA, '' TP_GUIA, '' CD_MEDICO_CONVENIO, '' IE_FUNCAO_MEDICO,
		'' QT_PORTE_ANESTESICO, '' CD_GRUPO_GASTO,'' DS_UNIDADE_MEDIDA,
		0 QT_CH, 0 VL_UNITARIO_CH,0 VL_UNITARIO,
		sum(b.vl_total_item +
			CASE WHEN ie_responsavel_credito='M' THEN 				CASE WHEN coalesce(vl_honorario,0)=0 THEN  0  ELSE CASE WHEN coalesce(vl_custo_oper,0)=0 THEN  0  ELSE CASE WHEN vl_honorario=vl_total_item THEN  vl_custo_oper  ELSE 0 END  END  END   ELSE 0 END ) vl_item,
		0 PR_FUNCAO_PARTIC, 0 IE_VIA_ACESSO, 0 PR_VIA_ACESSO,	0 PR_HORA_EXTRA,
		'' IE_LOCAL_MEDICADO, '' CD_BRASINDICE, '' CD_ITEM_CONVENIO,0 CD_PROCEDIMENTO_REF,
		'' CD_SENHA,'' cd_regional, '' nm_convenio,
		' ' ds_espaco,'' ie_estado_civil,'' nr_cpf_paciente,'' cd_nacionalidade,
           	'' cd_cid_secundario,0 nr_planilha,0 vl_tot_honorarios,0 vl_tot_diarias,
		0 vl_tot_taxas,0 vl_tot_medicamentos,0 vl_tot_materiais,0 vl_tot_sadt,
		0 vl_tot_pacote,0 vl_tot_ortese,0 vl_tot_protese,0 qt_tot_diarias,
		0 qt_tot_participantes,
		0 cd_proc_orig_pacote,
		'',
		'' nr_doc_convenio,
		'' nr_crm_requisitante, 0, 0,
		0 cd_grupo_proc,
		0 cd_setor_atendimento
from		w_interf_conta_item b,
		w_interf_conta_trailler a
where		a.nr_seq_protocolo = b.nr_seq_protocolo
group by
		a.NR_SEQ_PROTOCOLO,
		a.CD_CONVENIO,
           	'FATOU',
		9,
		9999,
		a.CD_INTERNO,
           	a.cd_cgc_hospital,
           	a.nr_remessa,
		99999999,
           	LOCALTIMESTAMP,
		a.cd_cgc_convenio,
           	a.qt_total_conta;

