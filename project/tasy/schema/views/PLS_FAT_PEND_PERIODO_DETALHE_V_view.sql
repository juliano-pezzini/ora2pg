-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_fat_pend_periodo_detalhe_v (nr_dias, nr_seq_conta, nr_seq_guia, cd_guia, cd_guia_referencia, vl_fatura, nr_seq_segurado, nm_beneficiario, nr_seq_congenere, nm_operadora, dt_atendimento_referencia, ds_camara, nr_seq_camara, ds_status_conta, ie_status_conta, ie_origem_conta, ds_origem_conta, ie_tipo_guia, ds_tipo_guia, nr_seq_tipo_atendimento, ds_tipo_atendimento, ie_origem_valor_pos, ds_origem_valor_pos, nr_seq_prestador_exec, nm_prestador_exec) AS select	w.nr_dias,
	w.nr_seq_conta,
	c.nr_seq_guia,
	c.cd_guia,
	c.cd_guia_referencia,
	sum(w.vl_pos_estab) + sum(w.vl_pos_estab_taxa) vl_fatura,
	c.nr_seq_segurado,
	substr(pls_obter_dados_segurado(c.nr_seq_segurado,'N'),1,255) nm_beneficiario,
	coalesce(s.nr_seq_ops_congenere,s.nr_seq_congenere) nr_seq_congenere,
	substr(pls_obter_dados_cooperativa(coalesce(s.nr_seq_ops_congenere,s.nr_seq_congenere),'RS'),1,255) nm_operadora,
	c.dt_atendimento_referencia,
	substr(pls_obter_dados_cooperativa(s.nr_seq_congenere, 'DC'),1,255) ds_camara,
	pls_obter_dados_cooperativa(s.nr_seq_congenere, 'CC') nr_seq_camara,
	obter_valor_dominio(1961, c.ie_status) ds_status_conta,
	c.ie_status ie_status_conta,
	c.ie_origem_conta,
	obter_valor_dominio(3470, c.ie_origem_conta) ds_origem_conta,
	c.ie_tipo_guia,
	obter_valor_dominio(1746, c.ie_tipo_guia) ds_tipo_guia,
	c.nr_seq_tipo_atendimento,
	max((	select	substr(x.ds_tipo_atendimento,1,255)
		FROM	pls_tipo_atendimento	x
		where	x.nr_sequencia		= c.nr_seq_tipo_atendimento )) ds_tipo_atendimento,
	w.ie_origem_valor_pos,
	CASE WHEN w.ie_origem_valor_pos='1' THEN  'Conta' WHEN w.ie_origem_valor_pos='2' THEN  'Recurso de glosa' WHEN w.ie_origem_valor_pos='3' THEN  'Contestação' WHEN w.ie_origem_valor_pos='4' THEN  'Refaturamento' WHEN w.ie_origem_valor_pos='5' THEN  'Reembolso' END  ds_origem_valor_pos,
	c.nr_seq_prestador_exec,
	pls_obter_dados_prestador(c.nr_seq_prestador_exec, 'N') nm_prestador_exec
from  	pls_segurado		s,
	pls_conta  		c,
	w_pls_monit_fin_cta_fat	w
where  	c.nr_sequencia	= w.nr_seq_conta
and	s.nr_sequencia	= c.nr_seq_segurado
group by w.nr_dias,
	w.nr_seq_conta,
	c.nr_seq_guia,
	c.cd_guia,
	c.cd_guia_referencia,
	c.nr_seq_segurado,
	s.nr_seq_ops_congenere,
	s.nr_seq_congenere,
	c.dt_atendimento_referencia,
	c.ie_status,
	c.ie_origem_conta,
	c.ie_tipo_guia,
	c.nr_seq_tipo_atendimento,
	w.ie_origem_valor_pos,
	c.nr_seq_prestador_exec;

