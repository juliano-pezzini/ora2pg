-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW hdh_4972_v (dias, nr_titulo, nr_seq_protocolo, cd_convenio) AS SELECT	/*+ CHOOSE */ trunc(to_char(LOCALTIMESTAMP-to_date(obter_dados_protocolo(a.nr_seq_protocolo,'DT'),'dd/mm/yyyy'))) dias,
	a.nr_titulo,
	a.nr_seq_protocolo,
	coalesce(a.cd_convenio_conta, obter_convenio_tit_rec(a.nr_titulo)) cd_convenio
FROM atendimento_paciente e, atend_categoria_convenio b, titulo_receber a
LEFT OUTER JOIN nota_fiscal d ON (a.nr_SEQ_NF_SAIDA = d.NR_SEQUENCIA)
WHERE e.nr_atendimento = b.nr_atendimento and a.nr_atendimento = b.nr_atendimento  and b.cd_convenio = coalesce(a.cd_convenio_conta, obter_convenio_tit_rec(a.nr_titulo)) and b.dt_inicio_vigencia = 	(select max(k.dt_inicio_vigencia)
   				from atend_categoria_convenio k
   				where k.cd_convenio = b.cd_convenio
   				and  k.cd_categoria = b.cd_categoria
   				and k.nr_atendimento = b.nr_atendimento) AND a.ie_situacao = '1'

union

SELECT	/*+ CHOOSE */trunc(to_char(LOCALTIMESTAMP-to_date(obter_dados_protocolo(a.nr_seq_protocolo, 'DT'),'dd/mm/yyyy'))) dias,
	a.nr_titulo,
	a.nr_seq_protocolo,
	coalesce(a.cd_convenio_conta, obter_convenio_tit_rec(a.nr_titulo)) cd_convenio
FROM atendimento_paciente e, atend_categoria_convenio b, titulo_receber a
LEFT OUTER JOIN nota_fiscal d ON (a.nr_SEQ_NF_SAIDA = d.NR_SEQUENCIA)
WHERE e.nr_atendimento = b.nr_atendimento and a.nr_atendimento = b.nr_atendimento  and b.cd_convenio = coalesce(a.cd_convenio_conta, obter_convenio_tit_rec(a.nr_titulo)) and b.dt_inicio_vigencia = 	(select max(k.dt_inicio_vigencia)
    				from atend_categoria_convenio k
    				where k.cd_convenio = b.cd_convenio
    				and  k.cd_categoria = b.cd_categoria
    				and k.nr_atendimento = b.nr_atendimento) AND a.ie_situacao = '1'
 
union

SELECT	/*+ CHOOSE */ trunc(to_char(LOCALTIMESTAMP - to_date(obter_dados_protocolo(a.nr_seq_protocolo, 'DT'),'dd/mm/yyyy'))) dias,
	a.nr_titulo,
	a.nr_seq_protocolo,
	coalesce(a.cd_convenio_conta, obter_convenio_tit_rec(a.nr_titulo)) cd_convenio
FROM atendimento_paciente e, atend_categoria_convenio b, titulo_receber a
LEFT OUTER JOIN nota_fiscal d ON (a.nr_SEQ_NF_SAIDA = d.NR_SEQUENCIA)
WHERE e.nr_atendimento = b.nr_atendimento and a.nr_atendimento = b.nr_atendimento  and b.cd_convenio = coalesce(a.cd_convenio_conta, obter_convenio_tit_rec(a.nr_titulo)) and b.dt_inicio_vigencia = 	(select max(k.dt_inicio_vigencia)
    				from atend_categoria_convenio k
    				where k.cd_convenio = b.cd_convenio
    				and  k.cd_categoria = b.cd_categoria
    				and k.nr_atendimento = b.nr_atendimento) AND a.ie_situacao = '1'
 
union

SELECT	/*+ CHOOSE */  trunc(to_char(LOCALTIMESTAMP - to_date(obter_dados_protocolo(a.nr_seq_protocolo, 'DT'),'dd/mm/yyyy'))) dias,
	a.nr_titulo,
	a.nr_seq_protocolo,
	coalesce(a.cd_convenio_conta, obter_convenio_tit_rec(a.nr_titulo)) cd_convenio
FROM atendimento_paciente e, atend_categoria_convenio b, titulo_receber a
LEFT OUTER JOIN nota_fiscal d ON (a.nr_SEQ_NF_SAIDA = d.NR_SEQUENCIA)
WHERE e.nr_atendimento = b.nr_atendimento and a.nr_atendimento = b.nr_atendimento  and b.cd_convenio = coalesce(a.cd_convenio_conta, obter_convenio_tit_rec(a.nr_titulo)) and b.dt_inicio_vigencia = 	(select max(k.dt_inicio_vigencia)
    				from atend_categoria_convenio k
    				where k.cd_convenio = b.cd_convenio
    				and  k.cd_categoria = b.cd_categoria
    				and k.nr_atendimento = b.nr_atendimento) AND a.ie_situacao = '1';

