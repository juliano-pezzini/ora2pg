-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_consulta_sca_benef_v (nr_seq_segurado, nm_segurado, ds_plano_sca, nr_seq_classificacao, nr_seq_plano, nr_seq_plano_sca, dt_inclusao_sca, dt_exclusao_sca, dt_reativacao_sca, ds_origem_sca, qt_parcelas_cobranca, dt_prev_fim_cobranca, ds_classificacao_sca, nr_contrato, nr_seq_contrato) AS select	b.nr_sequencia											nr_seq_segurado,
	substr(obter_nome_pf(b.cd_pessoa_fisica),1,255)							nm_segurado,
	c.ds_plano											ds_plano_sca,
	c.nr_seq_classificacao										nr_seq_classificacao,
	c.nr_sequencia											nr_seq_plano,
	a.nr_sequencia											nr_seq_plano_sca,
	coalesce(a.dt_inicio_vigencia,b.dt_contratacao)							dt_inclusao_sca,
	a.dt_fim_vigencia										dt_exclusao_sca,
	a.dt_reativacao											dt_reativacao_sca,
	substr(CASE WHEN coalesce(a.ie_embutido_produto,'N')='N' THEN wheb_mensagem_pck.get_texto(1108818)  ELSE 'Produto' END ,1,255)	ds_origem_sca,
	c.qt_parcelas_cobranca										qt_parcelas_cobranca,
	add_months(coalesce(a.dt_inicio_vigencia,b.dt_contratacao),c.qt_parcelas_cobranca)			dt_prev_fim_cobranca,
	(select	substr(x.ds_classificacao,1,255)
		FROM	pls_sca_classificacao	x
		where	x.nr_sequencia	= c.nr_seq_classificacao)					ds_classificacao_sca,
	e.nr_contrato											nr_contrato,
	e.nr_sequencia											nr_seq_contrato
from	pls_segurado			b,
	pls_sca_vinculo			a,
	pls_contrato			e,
	pls_plano			c
where	b.nr_seq_contrato		= e.nr_sequencia
and	a.nr_seq_plano			= c.nr_sequencia
and	a.nr_seq_segurado		= b.nr_sequencia;

