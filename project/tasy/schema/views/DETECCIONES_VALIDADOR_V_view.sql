-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW detecciones_validador_v (clues, curpprestador, nombreprestador, primerapellidoprestador, segundoapellidoprestador, tipopersonal, especificatipopersonal, cedulaprofesional, servicioatencion, curppaciente, nombre, primerapellido, segundoapellido, fechanacimiento, entidadnacimiento, edad, claveedad, sexo, seconsideraindigena, spss, numeroafiliacionspss, prospera, folioprospera, imss, numeroafiliacionimss, issste, numeroafiliacionissste, otraafiliacion, numerootraafiliacion, peso, talla, tipodificultad, gradodificultad, origendificultad, migrante, fechadeteccion, diabetesmellitus, hipertensionarterial, obesidad, dislipidemias, depresion, alteracionmemoria, sintomaticorespiratorio, alcoholismo, tabaquismo, farmacos, incontinenciaurinaria, caida60ymas, riesgofractura, vih, gonorrea, itssecretoras, itsulcerativas, itstumorales, sifilis, sospechasindrometurner, violenciafamiliar, hiperplasiaprostatica, tirasembarazadassanas, tirasdeteccion, tirascontrol, reactivosantigenoprostatico, cartillavacunacion, telemedicina, dt_entrada, nr_atendimento, ds_medico, cd_cgc, ds_convenio, cd_pessoa_fisica) AS SELECT
	PJ.CD_INTERNACIONAL CLUES,
	PJ.CD_CURP CURPPRESTADOR,
	PJ.DS_RAZAO_SOCIAL NOMBREPRESTADOR,
	PJ.NM_FANTASIA PRIMERAPELLIDOPRESTADOR,
	PJ.DS_NOME_ABREV SEGUNDOAPELLIDOPRESTADOR,
	PROFISSIONAL.IE_PROFISSIONAL TIPOPERSONAL,
	CASE WHEN PROFISSIONAL.IE_PROFISSIONAL='12' THEN OBTER_DESC_EXPRESSAO(308221) END  ESPECIFICATIPOPERSONAL,
	CASE
		WHEN PROFISSIONAL.IE_PROFISSIONAL IN ('2','3','4','6','8')
		THEN coalesce(LPAD(coalesce(PF_M.DS_CODIGO_PROF, M.NR_CRM),8,0),0)
		ELSE '0'
	END AS CEDULAPROFESIONAL,
	CASE WHEN B.IE_CLINICA=2 THEN 3 WHEN B.IE_CLINICA=1 THEN 4 WHEN B.IE_CLINICA=3 THEN 5 WHEN B.IE_CLINICA=1000 THEN 6 WHEN B.IE_CLINICA=1001 THEN 7 WHEN B.IE_CLINICA=1002 THEN 8 WHEN B.IE_CLINICA=1004 THEN 9 WHEN B.IE_CLINICA=1005 THEN 13 WHEN B.IE_CLINICA=1006 THEN 14 WHEN B.IE_CLINICA=4 THEN 16 WHEN B.IE_CLINICA=1007 THEN 17 WHEN B.IE_CLINICA=1008 THEN 22 WHEN B.IE_CLINICA=1009 THEN 23 END  SERVICIOATENCION,
	--DADOS PACIENTE--
	PF_P.CD_CURP CURPPACIENTE,
	SUBSTR(UPPER(Y.DS_GIVEN_NAME),1,50) NOMBRE,
	SUBSTR(UPPER(Y.DS_FAMILY_NAME),1,50) PRIMERAPELLIDO,
	SUBSTR(UPPER(Y.DS_COMPONENT_NAME_1),1,50) SEGUNDOAPELLIDO,
	PF_P.DT_NASCIMENTO FECHANACIMIENTO,
	(SELECT MAX(CE.CD_ENTIDADE)
		FROM CAT_ENTIDADE CE, PESSOA_FISICA PF
		WHERE PF.CD_PESSOA_FISICA = PF_P.CD_PESSOA_FISICA
		AND UPPER(OBTER_VALOR_DOMINIO(50, PF.SG_ESTADO_NASC)) = UPPER(CE.DS_ENTIDADE)) ENTIDADNACIMIENTO,
	CASE
		WHEN OBTER_IDADE(PF_P.DT_NASCIMENTO, B.DT_INICIO_ATENDIMENTO, 'A') IS NOT NULL
		THEN OBTER_IDADE_IMC_NOM(B.NR_ATENDIMENTO,PF_P.DT_NASCIMENTO,B.DT_INICIO_ATENDIMENTO,'IDADE')
	END AS EDAD,
	CASE
		WHEN OBTER_IDADE(PF_P.DT_NASCIMENTO, B.DT_INICIO_ATENDIMENTO, 'A') IS NOT NULL
		THEN OBTER_IDADE_IMC_NOM(B.NR_ATENDIMENTO,PF_P.DT_NASCIMENTO,B.DT_INICIO_ATENDIMENTO,'CLAVEEDAD')
	END AS CLAVEEDAD,
	PF_P.IE_SEXO SEXO,
	PF_P.NR_SEQ_COR_PELE SECONSIDERAINDIGENA,
	-- --DERECHOHANIENCIA--
	PF_P.NR_SPSS SPSS,
	PF_P.NR_SPSS NUMEROAFILIACIONSPSS,
	CASE WHEN N.CD_TIPO_CONVENIO_MX=13 THEN  1  ELSE 0 END  PROSPERA,
	CASE WHEN N.CD_TIPO_CONVENIO_MX=13 THEN  ELIMINA_CARACTERE_ESPECIAL(SUBSTR(P.NR_DOC_CONVENIO,1,16)) END  FOLIOPROSPERA,
	CASE WHEN N.CD_TIPO_CONVENIO_MX=2 THEN  1  ELSE 0 END  IMSS,
	CASE WHEN N.CD_TIPO_CONVENIO_MX=2 THEN  SUBSTR(P.NR_DOC_CONVENIO,1,11) END  NUMEROAFILIACIONIMSS,
	CASE WHEN N.CD_TIPO_CONVENIO_MX=3 THEN  1  ELSE 0 END  ISSSTE,
	CASE WHEN N.CD_TIPO_CONVENIO_MX=3 THEN  SUBSTR(P.NR_DOC_CONVENIO,1,13) END  NUMEROAFILIACIONISSSTE,
	CASE WHEN N.CD_TIPO_CONVENIO_MX=15 THEN  1  ELSE 0 END  OTRAAFILIACION,
	CASE WHEN N.CD_TIPO_CONVENIO_MX=15 THEN  SUBSTR(P.NR_DOC_CONVENIO,1,15) END  NUMEROOTRAAFILIACION,
	---- OUTROS DADOS--
	coalesce(coalesce((SELECT	MAX(qt_peso)
			FROM	atendimento_sinal_vital
			WHERE	nr_sequencia = (SELECT	coalesce(MAX(nr_sequencia),-1)
									FROM	atendimento_sinal_vital
									WHERE	qt_peso IS NOT NULL
									AND	nr_atendimento	= B.NR_ATENDIMENTO
									AND	coalesce(ie_situacao,'A') = 'A'
									AND	coalesce(IE_RN,'N')	= 'N')), PF_P.QT_PESO), '999') PESO,
	coalesce(coalesce((SELECT	MAX(qt_altura_cm)
			FROM	atendimento_sinal_vital
			WHERE	nr_sequencia = (SELECT	coalesce(MAX(nr_sequencia),-1)
									FROM	atendimento_sinal_vital
									WHERE	qt_altura_cm IS NOT NULL
									AND	nr_atendimento	= B.NR_ATENDIMENTO
									AND	coalesce(ie_situacao,'A') = 'A'
									AND	coalesce(IE_RN,'N')	= 'N')), PF_P.QT_ALTURA_CM), '999') TALLA,
	(Select MAX(PTD.NR_SEQ_TIPO_DEF) from PF_TIPO_DEFICIENCIA PTD
        where PF_P.CD_PESSOA_FISICA = PTD.CD_PESSOA_FISICA and PTD.DT_INATIVACAO IS NULL and PTD.DT_LIBERACAO IS NOT NULL) AS TIPODIFICULTAD,
	(Select MAX(CASE WHEN PTD.NR_SEQ_TIPO_DEF=56 THEN 9  ELSE PTD.IE_GRAU_DEFICIENCIA END )
       from PF_TIPO_DEFICIENCIA PTD
       where PF_P.CD_PESSOA_FISICA = PTD.CD_PESSOA_FISICA
       and PTD.DT_INATIVACAO IS NULL and PTD.DT_LIBERACAO IS NOT NULL) AS GRADODIFICULTAD,
	-- ORIGENDIFICULTAD
	 (select MAX(CASE WHEN PTD.NR_SEQ_TIPO_DEF=56 THEN 9  ELSE PTD.NR_SEQ_CAUSA_LESAO END )
        from PF_TIPO_DEFICIENCIA PTD
        where PF_P.CD_PESSOA_FISICA = PTD.CD_PESSOA_FISICA
        and PTD.DT_INATIVACAO IS NULL and PTD.DT_LIBERACAO IS NOT NULL ) AS ORIGENDIFICULTAD,
	-1 MIGRANTE,
	coalesce(TO_CHAR((SELECT MAX(DDP.DT_DIAGNOSTICO) FROM DIAGNOSTICO_DOENCA DDP WHERE DDP.NR_ATENDIMENTO = B.NR_ATENDIMENTO AND DDP.IE_CLASSIFICACAO_DOENCA = 'P'), 'dd/mm/yyyy'), NULL) FECHADETECCION,
	CASE
		WHEN OBTER_IDADE(PF_P.DT_NASCIMENTO, B.DT_INICIO_ATENDIMENTO, 'A') >= 20 AND (SELECT MAX(DDP.CD_DOENCA) FROM DIAGNOSTICO_DOENCA DDP WHERE B.NR_ATENDIMENTO = DDP.NR_ATENDIMENTO) IS NOT NULL
		THEN
			CASE
				WHEN EXISTS (SELECT 1 FROM CID_DOENCA CC1, DIAGNOSTICO_DOENCA DDP WHERE CC1.IE_DOENCA_CRONICA_MX = 'DIABT' AND CC1.CD_DOENCA_CID LIKE DDP.CD_DOENCA AND DDP.NR_ATENDIMENTO = B.NR_ATENDIMENTO)
				THEN 0
				ELSE 1
			END
		ELSE -1
	END AS DIABETESMELLITUS,
	CASE
		WHEN OBTER_IDADE(PF_P.DT_NASCIMENTO, B.DT_INICIO_ATENDIMENTO, 'A') >= 20 AND (SELECT MAX(DDP.CD_DOENCA) FROM DIAGNOSTICO_DOENCA DDP WHERE B.NR_ATENDIMENTO = DDP.NR_ATENDIMENTO) IS NOT NULL
		THEN
			CASE
				WHEN EXISTS (SELECT 1 FROM CID_DOENCA CC1, DIAGNOSTICO_DOENCA DDP WHERE CC1.IE_DOENCA_CRONICA_MX = 'HIPAS' AND CC1.CD_DOENCA_CID LIKE DDP.CD_DOENCA AND DDP.NR_ATENDIMENTO = B.NR_ATENDIMENTO)
				THEN 0
				ELSE 1
			END
		ELSE -1
	END AS HIPERTENSIONARTERIAL,
	CASE
		WHEN OBTER_IDADE(PF_P.DT_NASCIMENTO, B.DT_INICIO_ATENDIMENTO, 'A') >= 20 AND (SELECT MAX(DDP.CD_DOENCA) FROM DIAGNOSTICO_DOENCA DDP WHERE B.NR_ATENDIMENTO = DDP.NR_ATENDIMENTO) IS NOT NULL
		THEN
			CASE
				WHEN EXISTS (SELECT 1 FROM CID_DOENCA CC1, DIAGNOSTICO_DOENCA DDP WHERE CC1.IE_DOENCA_CRONICA_MX = 'OBSDA' AND CC1.CD_DOENCA_CID LIKE DDP.CD_DOENCA AND DDP.NR_ATENDIMENTO = B.NR_ATENDIMENTO)
				THEN 0
				ELSE 1
			END
		ELSE -1
	END AS OBESIDAD,
	CASE
		WHEN OBTER_IDADE(PF_P.DT_NASCIMENTO, B.DT_INICIO_ATENDIMENTO, 'A') >= 20 AND (SELECT MAX(DDP.CD_DOENCA) FROM DIAGNOSTICO_DOENCA DDP WHERE B.NR_ATENDIMENTO = DDP.NR_ATENDIMENTO) IS NOT NULL
		THEN
			CASE
				WHEN EXISTS (SELECT 1 FROM CID_DOENCA CC1, DIAGNOSTICO_DOENCA DDP WHERE CC1.IE_DOENCA_CRONICA_MX = 'LIPDM' AND CC1.CD_DOENCA_CID LIKE DDP.CD_DOENCA AND DDP.NR_ATENDIMENTO = B.NR_ATENDIMENTO)
				THEN 0
				ELSE 1
			END
		ELSE -1
	END AS DISLIPIDEMIAS,
	CASE
		WHEN OBTER_IDADE(PF_P.DT_NASCIMENTO, B.DT_INICIO_ATENDIMENTO, 'A') >= 60 AND (SELECT MAX(DDP.CD_DOENCA) FROM DIAGNOSTICO_DOENCA DDP WHERE B.NR_ATENDIMENTO = DDP.NR_ATENDIMENTO) IS NOT NULL
		THEN
			CASE
				WHEN EXISTS (SELECT 1 FROM CID_DOENCA CC1, DIAGNOSTICO_DOENCA DDP WHERE CC1.IE_DOENCA_CRONICA_MX = 'DPRSS' AND CC1.CD_DOENCA_CID LIKE DDP.CD_DOENCA AND DDP.NR_ATENDIMENTO = B.NR_ATENDIMENTO)
				THEN 0
				ELSE 1
			END
		ELSE -1
	END AS DEPRESION,
	CASE
		WHEN OBTER_IDADE(PF_P.DT_NASCIMENTO, B.DT_INICIO_ATENDIMENTO, 'A') >= 60 AND (SELECT MAX(DDP.CD_DOENCA) FROM DIAGNOSTICO_DOENCA DDP WHERE B.NR_ATENDIMENTO = DDP.NR_ATENDIMENTO) IS NOT NULL
		THEN
			CASE
				WHEN EXISTS (SELECT 1 FROM CID_DOENCA CC1, DIAGNOSTICO_DOENCA DDP WHERE CC1.IE_DOENCA_CRONICA_MX = 'ALTME' AND CC1.CD_DOENCA_CID LIKE DDP.CD_DOENCA AND DDP.NR_ATENDIMENTO = B.NR_ATENDIMENTO)
				THEN 0
				ELSE 1
			END
		ELSE -1
	END AS ALTERACIONMEMORIA,
	coalesce((SELECT CASE WHEN DDP.IE_SINTOMATICO='S' THEN  0  ELSE 1 END  FROM CID_DOENCA CC1, DIAGNOSTICO_DOENCA DDP WHERE CC1.IE_DOENCA_CRONICA_MX = 'STRSP' AND CC1.CD_DOENCA_CID LIKE DDP.CD_DOENCA AND DDP.NR_ATENDIMENTO = B.NR_ATENDIMENTO), '-1') SINTOMATICORESPIRATORIO,
	CASE
		WHEN(SELECT MAX(DDP.CD_DOENCA) FROM DIAGNOSTICO_DOENCA DDP WHERE B.NR_ATENDIMENTO = DDP.NR_ATENDIMENTO) IS NOT NULL
		THEN
			CASE
				WHEN EXISTS (SELECT 1 FROM CID_DOENCA CC1, DIAGNOSTICO_DOENCA DDP WHERE CC1.IE_DOENCA_CRONICA_MX = 'ALCOL' AND CC1.CD_DOENCA_CID LIKE DDP.CD_DOENCA AND DDP.NR_ATENDIMENTO = B.NR_ATENDIMENTO)
				THEN 0
				ELSE 1
			END
		ELSE -1
	END AS ALCOHOLISMO,
	CASE
		WHEN(SELECT MAX(DDP.CD_DOENCA) FROM DIAGNOSTICO_DOENCA DDP WHERE B.NR_ATENDIMENTO = DDP.NR_ATENDIMENTO) IS NOT NULL
		THEN
			CASE
				WHEN EXISTS (SELECT 1 FROM CID_DOENCA CC1, DIAGNOSTICO_DOENCA DDP WHERE CC1.IE_DOENCA_CRONICA_MX = 'TABAC' AND CC1.CD_DOENCA_CID LIKE DDP.CD_DOENCA AND DDP.NR_ATENDIMENTO = B.NR_ATENDIMENTO)
				THEN 0
				ELSE 1
			END
		ELSE -1
	END AS TABAQUISMO,
	CASE
		WHEN(SELECT MAX(DDP.CD_DOENCA) FROM DIAGNOSTICO_DOENCA DDP WHERE B.NR_ATENDIMENTO = DDP.NR_ATENDIMENTO) IS NOT NULL
		THEN
			CASE
				WHEN EXISTS (SELECT 1 FROM CID_DOENCA CC1, DIAGNOSTICO_DOENCA DDP WHERE CC1.IE_DOENCA_CRONICA_MX = 'FARMA' AND CC1.CD_DOENCA_CID LIKE DDP.CD_DOENCA AND DDP.NR_ATENDIMENTO = B.NR_ATENDIMENTO)
				THEN 0
				ELSE 1
			END
		ELSE -1
	END AS FARMACOS,
	CASE
		WHEN(SELECT MAX(DDP.CD_DOENCA) FROM DIAGNOSTICO_DOENCA DDP WHERE B.NR_ATENDIMENTO = DDP.NR_ATENDIMENTO) IS NOT NULL
		THEN
			CASE
				WHEN EXISTS (SELECT 1 FROM CID_DOENCA CC1, DIAGNOSTICO_DOENCA DDP WHERE CC1.IE_DOENCA_CRONICA_MX = 'INCUR' AND CC1.CD_DOENCA_CID LIKE DDP.CD_DOENCA AND DDP.NR_ATENDIMENTO = B.NR_ATENDIMENTO)
				THEN 0
				ELSE 1
			END
		ELSE -1
	END AS INCONTINENCIAURINARIA,
	CASE
		WHEN OBTER_IDADE(PF_P.DT_NASCIMENTO, B.DT_INICIO_ATENDIMENTO, 'A') >= 60 AND (SELECT MAX(DDP.CD_DOENCA) FROM DIAGNOSTICO_DOENCA DDP WHERE B.NR_ATENDIMENTO = DDP.NR_ATENDIMENTO) IS NOT NULL
		THEN
			CASE
				WHEN EXISTS (SELECT 1 FROM CID_DOENCA CC1, DIAGNOSTICO_DOENCA DDP WHERE CC1.IE_DOENCA_CRONICA_MX = 'SINDC' AND CC1.CD_DOENCA_CID LIKE DDP.CD_DOENCA AND DDP.NR_ATENDIMENTO = B.NR_ATENDIMENTO)
				THEN 0
				ELSE 1
			END
		ELSE -1
	END AS CAIDA60YMAS,
	CASE
		WHEN OBTER_IDADE(PF_P.DT_NASCIMENTO, B.DT_INICIO_ATENDIMENTO, 'A') >= 50 AND (SELECT MAX(DDP.CD_DOENCA) FROM DIAGNOSTICO_DOENCA DDP WHERE B.NR_ATENDIMENTO = DDP.NR_ATENDIMENTO) IS NOT NULL
		THEN
			CASE
				WHEN EXISTS (SELECT 1 FROM CID_DOENCA CC1, DIAGNOSTICO_DOENCA DDP WHERE CC1.IE_DOENCA_CRONICA_MX = 'RISFO' AND CC1.CD_DOENCA_CID LIKE DDP.CD_DOENCA AND DDP.NR_ATENDIMENTO = B.NR_ATENDIMENTO)
				THEN 0
				ELSE 1
			END
		ELSE -1
	END AS RIESGOFRACTURA,
	CASE
		WHEN OBTER_IDADE(PF_P.DT_NASCIMENTO, B.DT_INICIO_ATENDIMENTO, 'A') >= 50 AND (SELECT MAX(DDP.CD_DOENCA) FROM DIAGNOSTICO_DOENCA DDP WHERE B.NR_ATENDIMENTO = DDP.NR_ATENDIMENTO) IS NOT NULL
		THEN
			CASE
				WHEN EXISTS (SELECT 1 FROM CID_DOENCA CC1, DIAGNOSTICO_DOENCA DDP WHERE CC1.IE_DOENCA_CRONICA_MX = 'HIV' AND CC1.CD_DOENCA_CID LIKE DDP.CD_DOENCA AND DDP.NR_ATENDIMENTO = B.NR_ATENDIMENTO)
				THEN 0
				ELSE 1
			END
		ELSE -1
	END AS VIH,
	CASE
		WHEN(SELECT MAX(DDP.CD_DOENCA) FROM DIAGNOSTICO_DOENCA DDP WHERE B.NR_ATENDIMENTO = DDP.NR_ATENDIMENTO) IS NOT NULL
		THEN
			CASE
				WHEN EXISTS (SELECT 1 FROM CID_DOENCA CC1, DIAGNOSTICO_DOENCA DDP WHERE CC1.IE_DOENCA_CRONICA_MX = 'GRREA' AND CC1.CD_DOENCA_CID LIKE DDP.CD_DOENCA AND DDP.NR_ATENDIMENTO = B.NR_ATENDIMENTO)
				THEN 0
				ELSE 1
			END
		ELSE -1
	END AS GONORREA,
	CASE
		WHEN(SELECT MAX(DDP.CD_DOENCA) FROM DIAGNOSTICO_DOENCA DDP WHERE B.NR_ATENDIMENTO = DDP.NR_ATENDIMENTO) IS NOT NULL
		THEN
			CASE
				WHEN EXISTS (SELECT 1 FROM CID_DOENCA CC1, DIAGNOSTICO_DOENCA DDP WHERE (CC1.CD_DOENCA IN ('A54', 'N74') OR CC1.CD_DOENCA LIKE '%A59%' OR CC1.CD_DOENCA LIKE '%A70%') AND CC1.CD_DOENCA_CID LIKE DDP.CD_DOENCA AND DDP.NR_ATENDIMENTO = B.NR_ATENDIMENTO)
				THEN 0
				ELSE 1
			END
		ELSE -1
	END AS ITSSECRETORAS,
	CASE
		WHEN(SELECT MAX(DDP.CD_DOENCA) FROM DIAGNOSTICO_DOENCA DDP WHERE B.NR_ATENDIMENTO = DDP.NR_ATENDIMENTO) IS NOT NULL
		THEN
			CASE
				WHEN EXISTS (SELECT 1 FROM CID_DOENCA CC1, DIAGNOSTICO_DOENCA DDP WHERE CC1.CD_DOENCA IN ('B081','B977')  AND CC1.CD_DOENCA_CID LIKE DDP.CD_DOENCA AND B.NR_ATENDIMENTO = DDP.NR_ATENDIMENTO)
				THEN 0
				ELSE 1
			END
		ELSE -1
	END AS ITSULCERATIVAS,
	CASE
		WHEN(SELECT MAX(DDP.CD_DOENCA) FROM DIAGNOSTICO_DOENCA DDP WHERE B.NR_ATENDIMENTO = DDP.NR_ATENDIMENTO) IS NOT NULL
		THEN
			CASE
				WHEN EXISTS (SELECT 1 FROM CID_DOENCA CC1, DIAGNOSTICO_DOENCA DDP WHERE CC1.CD_DOENCA IN ('B97.7', 'A58', 'A60') AND CC1.CD_DOENCA_CID LIKE DDP.CD_DOENCA AND DDP.NR_ATENDIMENTO = B.NR_ATENDIMENTO)
				THEN 0
				ELSE 1
			END
		ELSE -1
	END AS ITSTUMORALES,
	CASE
		WHEN(SELECT MAX(DDP.CD_DOENCA) FROM DIAGNOSTICO_DOENCA DDP WHERE B.NR_ATENDIMENTO = DDP.NR_ATENDIMENTO) IS NOT NULL
		THEN
			CASE
				WHEN EXISTS (SELECT 1 FROM CID_DOENCA CC1, DIAGNOSTICO_DOENCA DDP WHERE CC1.IE_DOENCA_CRONICA_MX = 'SIFIL' AND CC1.CD_DOENCA_CID LIKE DDP.CD_DOENCA AND DDP.NR_ATENDIMENTO = B.NR_ATENDIMENTO)
				THEN 0
				ELSE 1
			END
		ELSE -1
	END AS SIFILIS,
	CASE
		WHEN(SELECT MAX(DDP.CD_DOENCA) FROM DIAGNOSTICO_DOENCA DDP WHERE B.NR_ATENDIMENTO = DDP.NR_ATENDIMENTO) IS NOT NULL
		THEN
			CASE
				WHEN EXISTS (SELECT 1 FROM CID_DOENCA CC1, DIAGNOSTICO_DOENCA DDP WHERE CC1.IE_DOENCA_CRONICA_MX = 'SINDT' AND CC1.CD_DOENCA_CID LIKE DDP.CD_DOENCA AND DDP.NR_ATENDIMENTO = B.NR_ATENDIMENTO)
				THEN 0
				ELSE 1
			END
		ELSE -1
	END AS SOSPECHASINDROMETURNER,
	CASE
	    WHEN OBTER_IDADE(PF_P.DT_NASCIMENTO, B.DT_INICIO_ATENDIMENTO, 'A') >= 15 AND PF_P.IE_SEXO = 'F'
	    THEN
		    CASE
			   WHEN EXISTS (SELECT 1 FROM SINAN_INF_VIOLENCIA SIV, NOTIFICACAO_SINAN NF WHERE SIV.NR_SEQ_NOTIFICACAO = NF.NR_SEQUENCIA AND NF.NR_ATENDIMENTO = B.NR_ATENDIMENTO AND IE_TIPO_VIOLENCIA = 2)
			   THEN 0
			   ELSE 1
			END
		ELSE -1
	END AS VIOLENCIAFAMILIAR,
	CASE
		WHEN OBTER_IDADE(PF_P.DT_NASCIMENTO, B.DT_INICIO_ATENDIMENTO, 'A') >= 15 AND PF_P.IE_SEXO = 'M'
		THEN
			CASE
				WHEN EXISTS (SELECT 1 FROM CID_DOENCA CC1, DIAGNOSTICO_DOENCA DDP WHERE CC1.IE_DOENCA_CRONICA_MX = 'HIPPR' AND CC1.CD_DOENCA_CID LIKE DDP.CD_DOENCA AND DDP.NR_ATENDIMENTO = B.NR_ATENDIMENTO)
				THEN 0
				ELSE 1
			END
		ELSE -1
	END AS HIPERPLASIAPROSTATICA,
	0 TIRASEMBARAZADASSANAS,
	0 TIRASDETECCION,
	0 TIRASCONTROL,
	0 REACTIVOSANTIGENOPROSTATICO,
	0 CARTILLAVACUNACION,
	0 TELEMEDICINA,
	B.DT_ENTRADA DT_ENTRADA,
	B.NR_ATENDIMENTO NR_ATENDIMENTO,
	SUBSTR(OBTER_NOME_PF(PROFISSIONAL.CD_PESSOA_FISICA),1,100) DS_MEDICO,
	PJ.CD_CGC CD_CGC,
	OBTER_DESC_CONVENIO(N.CD_CONVENIO) DS_CONVENIO,
	PF_P.CD_PESSOA_FISICA CD_PESSOA_FISICA
FROM pessoa_juridica pj, pessoa_fisica pf_m, atend_categoria_convenio p, estabelecimento e, categoria_convenio cc, pessoa_fisica pf_p
LEFT OUTER JOIN sus_municipio sm ON (PF_P.CD_MUNICIPIO_IBGE = SM.CD_MUNICIPIO_IBGE)
LEFT OUTER JOIN cat_entidade ce ON (SM.NR_SEQ_ENTIDADE_MX = CE.NR_SEQUENCIA)
, medico m
LEFT OUTER JOIN atendimento_paciente b ON (M.CD_PESSOA_FISICA = B.CD_MEDICO_RESP)
LEFT OUTER JOIN atend_profissional profissional ON (B.NR_ATENDIMENTO = PROFISSIONAL.NR_ATENDIMENTO)
, convenio n
LEFT OUTER JOIN cat_derechohabiencia k ON (N.CD_TIPO_CONVENIO_MX = K.NR_SEQUENCIA)
, person_name y
LEFT OUTER JOIN pessoa_fisica pf_p ON (Y.NR_SEQUENCIA = PF_P.NR_SEQ_PERSON_NAME)
WHERE B.NR_ATENDIMENTO  	= P.NR_ATENDIMENTO AND PJ.CD_CGC 		= E.CD_CGC AND B.CD_ESTABELECIMENTO 	= E.CD_ESTABELECIMENTO AND B.CD_PESSOA_FISICA	= PF_P.CD_PESSOA_FISICA  AND PF_M.CD_PESSOA_FISICA 	= M.CD_PESSOA_FISICA   AND P.CD_CONVENIO 		= CC.CD_CONVENIO AND P.CD_CATEGORIA 		= CC.CD_CATEGORIA AND N.CD_CONVENIO 		= CC.CD_CONVENIO;

