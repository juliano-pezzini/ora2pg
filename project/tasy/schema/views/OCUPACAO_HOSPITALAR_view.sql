-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ocupacao_hospitalar (nr_atendimento, dt_entrada_unidade, cd_unidade_basica, cd_unidade_compl, cd_unidade, nm_unidade, cd_setor_atendimento, cd_tipo_acomodacao, ie_temporario, ie_situacao_unidade, ds_setor_atendimento, nm_unidade_compl, nm_unidade_basica, cd_classif_setor, cd_centro_custo, ie_ocupada) AS SELECT  A.NR_ATENDIMENTO,
        A.DT_ENTRADA_UNIDADE,
	B.CD_UNIDADE_BASICA,
	B.CD_UNIDADE_COMPL,
        B.CD_UNIDADE_BASICA ||B.CD_UNIDADE_COMPL cd_unidade,
	C.NM_UNIDADE_BASICA ||C.NM_UNIDADE_COMPL nm_unidade,
	B.CD_SETOR_ATENDIMENTO,
	B.CD_TIPO_ACOMODACAO,
	B.IE_TEMPORARIO,
	B.IE_SITUACAO IE_SITUACAO_UNIDADE,
	C.DS_SETOR_ATENDIMENTO,
	C.NM_UNIDADE_COMPL,
	C.NM_UNIDADE_BASICA,
	C.CD_CLASSIF_SETOR,
	C.CD_CENTRO_CUSTO,
        CASE WHEN A.NR_ATENDIMENTO IS NULL THEN  0  ELSE 1 END  IE_OCUPADA
FROM unidade_atendimento b
LEFT OUTER JOIN atend_paciente_unidade a ON (B.CD_UNIDADE_BASICA = A.CD_UNIDADE_BASICA AND B.CD_UNIDADE_COMPL = A.CD_UNIDADE_COMPL AND A.DT_SAIDA_UNIDADE IS NULL  )
LEFT OUTER JOIN setor_atendimento c ON (B.CD_SETOR_ATENDIMENTO = C.CD_SETOR_ATENDIMENTO);

