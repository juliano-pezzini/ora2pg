-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_ted_mensalidade_ativia_v (chave_divicom, nm_pessoa_fisica, ds_cpf_nascimento, cd_usuario_plano, nr_contrato, cd_plano, nm_fantasia, dt_contratacao, dt_nascimento, nr_cpf, ds_parentesco, qt_idade, vl_mensalidade, nr_seq_lote_ted) AS select	'020001000100000100' chave_divicom,
	a.nm_pessoa_fisica,
	a.nr_cpf||to_char(a.dt_nascimento,'yyyymmdd') ds_cpf_nascimento,
	e.cd_usuario_plano,
	f.nr_contrato,
	g.nr_sequencia cd_plano,
	g.nm_fantasia,
	b.dt_contratacao,
	a.dt_nascimento,
	a.nr_cpf,
	CASE WHEN b.nr_seq_titular IS NULL THEN 'T'  ELSE substr(obter_desc_parentesco(b.nr_seq_parentesco),1,1) END  ds_parentesco,
	c.qt_idade,
	c.vl_mensalidade,
	d.NR_SEQ_LOTE_TED
FROM	pls_plano			g,
	pls_contrato			f,
	pls_segurado_carteira		e,
	PLS_MENSALIDADE_TED		d,
	pls_mensalidade_segurado	c,
	pls_segurado			b,
	pessoa_fisica			a
where	d.nr_seq_mensalidade		= c.nr_seq_mensalidade
and	c.nr_seq_segurado		= b.nr_sequencia
and	a.cd_pessoa_fisica		= b.cd_pessoa_fisica
and	e.nr_seq_segurado		= b.nr_sequencia
and	b.nr_seq_contrato		= f.nr_sequencia
and	b.nr_seq_plano			= g.nr_sequencia;

