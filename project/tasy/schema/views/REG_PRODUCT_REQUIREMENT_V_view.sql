-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW reg_product_requirement_v (cd_versao, nr_seq_revisao, ie_tipo_revisao, dt_revisao, nr_seq_area_customer, ds_area, nr_seq_features, ds_feature, nr_customer_requirement, ds_customer_requirement, ds_crs_title, crs_id, dt_customer_req_approval, nr_seq_product_requirement, ds_product_requirement, prs_id, dt_product_req_approval, dt_product_req_updated, nm_manager_approver_prs, nm_system_analyst_prs, ds_function, ds_type_object, ds_object, ds_function_en, prs_id_order, crs_id_order, ds_prs_formatada, ie_situacao_pr) AS SELECT	to_char(coalesce(t.cd_versao, null)) cd_versao,
	t.nr_seq_revisao,
	t.ie_tipo_revisao,
	t.dt_revisao,
	t.nr_seq_area_customer,
	t.ds_area,
	t.nr_seq_features,
	t.ds_feature,
	t.nr_customer_requirement,
	t.ds_customer_requirement,
	t.ds_crs_title,
	t.crs_id,
	t.dt_customer_req_approval,
	t.nr_seq_product_requirement,
	t.ds_product_requirement,
	t.prs_id,
	t.dt_product_req_approval,
	t.dt_product_req_updated,
	t.nm_manager_approver_prs,
	t.nm_system_analyst_prs,
	t.ds_function,
	t.ds_type_object,
	t.ds_object,
	t.ds_function_en,
	t.prs_id_order,
	t.crs_id_order,
	obter_ds_formatada_regulatorio( t.prs_id
	||' - '
	|| t.ds_product_requirement, t.ie_tipo_revisao) ds_prs_formatada,
	t.ie_situacao_pr
FROM	(	SELECT	pr.cd_versao ,
			pr.nr_seq_revisao ,
			pr.ie_tipo_revisao ,
			pr.dt_revisao ,
			fc.nr_seq_area_customer ,
			ac.ds_area ,
			cr.nr_seq_features ,
			fc.ds_feature ,
			pr.nr_customer_requirement ,
			cr.nm_curto ds_customer_requirement ,
			cr.ds_title ds_crs_title ,
			'A_0_'
			||ac.nr_seq_apresentacao
			||'.'
			||fc.nr_seq_apresentacao
			||'.'
			||cr.nr_seq_apresentacao crs_id ,
			cr.dt_aprovacao dt_customer_req_approval ,
			pr.nr_sequencia nr_seq_product_requirement ,
			pr.ds_title ds_product_requirement,
			'TASY_PRS_ID_'
			||ac.nr_seq_apresentacao
			||'.'
			||fc.nr_seq_apresentacao
			||'.'
			||cr.nr_seq_apresentacao
			||'.'
			||pr.nr_sequencia prs_id ,
			'TASY_PRS_ID_'
			||adiciona_zeros_esquerda(ac.nr_seq_apresentacao,2)
			||'.'
			||adiciona_zeros_esquerda(fc.nr_seq_apresentacao,3)
			||'.'
			||adiciona_zeros_esquerda(cr.nr_seq_apresentacao,4)
			||'.'
			||adiciona_zeros_esquerda(pr.nr_sequencia,5) prs_id_order,
			'A_0_'
			||adiciona_zeros_esquerda(ac.nr_seq_apresentacao,2)
			||'.'
			||adiciona_zeros_esquerda(fc.nr_seq_apresentacao,3)
			||'.'
			||adiciona_zeros_esquerda(cr.nr_seq_apresentacao,4) crs_id_order,
			pr.dt_aprovacao dt_product_req_approval ,
			pr.dt_atualizacao dt_product_req_updated ,
			pr.nm_usuario nm_manager_approver_prs ,
			pr.nm_analista_liberou nm_system_analyst_prs ,
			obter_desc_expressao_idioma(f.cd_exp_funcao,f.ds_funcao,5)
			||' : '
			||f.cd_funcao ds_function ,
			CASE WHEN d.ie_tipo_objeto='S' THEN 'Schematics' WHEN d.ie_tipo_objeto='O' THEN  'Object dictionary' WHEN d.ie_tipo_objeto='E' THEN  'Event' WHEN d.ie_tipo_objeto='D' THEN 'Data dictionary' END  ds_type_object ,
			reg_obter_ds_object_product(d.nr_seq_objeto, d.ie_tipo_objeto) ds_object,
			obter_desc_expressao_idioma(f.cd_exp_funcao,f.ds_funcao,5) ds_function_en,
			pr.ie_situacao ie_situacao_pr
		FROM reg_funcao_pr pf, reg_features_customer fc, funcao f, reg_customer_requirement cr, reg_area_customer ac, reg_product_requirement pr
LEFT OUTER JOIN reg_product_dic d ON (pr.nr_sequencia = d.nr_seq_product_requirement)
WHERE ac.nr_sequencia = fc.nr_seq_area_customer AND fc.nr_sequencia	= cr.nr_seq_features AND cr.nr_sequencia = pr.nr_customer_requirement AND pf.nr_seq_product_req = pr.nr_sequencia AND pf.cd_funcao = f.cd_funcao  AND ((TRUNC(pr.dt_atualizacao_nrec) < TRUNC(to_date('29/12/2017'))) or (pr.ie_tipo_revisao ='I' and pr.cd_versao = 1713)) AND pr.dt_aprovacao IS NOT NULL AND pr.Ie_Situacao = 'A' AND (		( pr.Nr_Sequencia IN (124,126,139,184,204,208,3938,318,322,3940,4206,3941,466,3943,720,1576,1981,2156,6178, 17,5623,5621,5622,5624,5625,5626,6179,6180,6181,5620,5219)) -- PRs matriz de risco e n?o funcionais
				OR ( 		f.cd_funcao IN ('-6936','-3010','-2265','-2260','-2230','-2226','-2225','-2222','-2105','-2070','-2050','-2012','-2010','-2009','-2008','-2003','-1113','-1020','-1012','-1010', '-1004','-1000','-996','-993','-991','-980','-975','-970','-821','-757','-756','-711','-709','-317','-297','-296','-210','-209','-201','-148','-124','-112', '-80','-38','-25','-19','-15','-14','-9','-2025','-6','-4','-2','1','4','5','6','15','18','24','25','27','28','32','40','42','44','46','47','48','49','53','57','61', '63','67','69','75','79','85','87','89','92','100','101','104','106','108','109','123','127','132','140','143','146','147','148','175','220','221','230','232', '252','256','260','266','267','270','273','275','281','284','290','294','295','296','297','298','329','350','351','352','354','355','400','406','410','440', '450','617','697','705','718','722','723','724','725','746','791','801','802','809','810','811','813','814','815','816','820','821','830','835','851','853','854',					'855','857','858','859','860','861','865','866','867','868','869','870','871','872','873','874','875','880','895','896','899','900','903','905','907','909','911', '913','915','916','917','919','920','921','922','923','925','928','929','936','937','941','942','944','945','947','952','953','970','988','991','994','995','996', '999','1002','1003','1006','1007','1008','1009','1010','1011','1112','1113','1114','1115','1116','1120','1121','1123','1124','1125','1126','1127','1131','1132', '1133','1135','1136','1137','1141','1200','1211','1220','1227','1238','1259','1300','1301','1302','1328','1350','1351','1355','1375','1700','1750','1751','1770', '1771','1800','1801','1899','1901','1908','1950','2000','2101','2223','2314','2468','2500','2811','2815','3001','3004','3006','3008','3009','3010','3011','3013', '3016','3020','3030','3031','3032','3033','3050','3110','3111','3113','3130','3131','3333','3401','3402','4000','4001','4003','4100','4200','5500','5511','5512', '5513','5514',					'5515','5516','6000','6001','6542','7005','7006','7007','7008','7009','7011','7012','7020','7021','7022','7023','7024','7026','7027','7028','7029', '7030','7032','7041','7042','7043','7047','7048','7050','7051','7052','7053','7101','7500','7504','8009','8014','8050','8051','8055','8559','9007','9018','9021', '9025','9030','9032','9042','9044','9047','9048','9049','9051','9054','9056','9090','9091','9095','9899','9902','9907','9909','9920','9935','9960','10000','10015', '10017','10020','10021','10025','10026','10027','10040','10050','10055','10080','10091','10150','10151','10152','10153','10154','10156','10157','10158','10159', '10160','10161','10162','10200','10207','10209','10210','10250','99009','99010','99013','99018','99020','99023','99024','99056','99070','927','590','332','3112','752','8050')
						AND	cr.nr_sequencia IN ( '39','19','47','49','21','23','51','55','57','411','415','417','295','271','275','181','283','555','123','179','191','377','401','437','281', '289','495','497','169','61','63','251','253','221','225','217','211','187','389','239','291','173','501','509','503','505','513','515','527', '529','531','533','535','537','421','439','539','547','215','355','381','193','255','213','219','163','159','493','177','243','487','185','189', '379','207','209','383','483','441','161','523','481','205','433','423','349','157','371','257','367','259','155','443','385','357','75','431', '285','457','459','227','461','183','543','465','541','229','235','237','391','65','453','267','273','279','287','475','477','479','249','111', '175','195','369','373','375','245','247','549','551','553','241','359','361','363','393','395','485','365','419','455','351','445','489','491', '165','167','197','199','201','499','9','15','11','17','13','25','27','31','35','37','45','53','263','265',						'43','323','325','327','329','331', '333','335','337','339','341','297','299','301','303','307','315','319','403','405','407','409','413','343','425','427','467','429','293','399', '447','347','449','451','507','511','517','519','525','571','573','575' )
					)
			)
	 ) t;

