-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_exp_benef_mov_benecamp_v (cd_matricula_familia, nr_sequencial_familia, nm_beneficiario, dt_nascimento, ie_sexo, cd_grau_parentesco, cd_plano, dt_contratacao, ds_endereco, nr_endereco, ds_complemento, ds_bairro, ds_municipio, cd_cep, sg_estado, nr_telefone, nr_identidade, nr_cpf, ie_tipo_movimentacao, nm_mae, vl_preco_segurado, ds_branco, ds_estado_civil, nr_seq_lote) AS select	CD_MATRICULA_FAMILIA,
	NR_SEQUENCIAL_FAMILIA,
	NM_BENEFICIARIO,
	DT_NASCIMENTO,
	ie_sexo,
	(	select	max(x.CD_SISTEMA_ANTERIOR)
		FROM	GRAU_PARENTESCO x
		where	x.nr_sequencia	= NR_SEQ_PARENTESCO) CD_GRAU_PARENTESCO,
	cd_plano,
	DT_CONTRATACAO,
	DS_ENDERECO,
	nr_endereco,
	DS_COMPLEMENTO,
	DS_BAIRRO,
	DS_MUNICIPIO,
	CD_CEP,
	SG_ESTADO,
	NR_TELEFONE,
	NR_IDENTIDADE,
	nr_cpf,
	CASE WHEN IE_TIPO_MOVIMENTACAO='I' THEN 1 WHEN IE_TIPO_MOVIMENTACAO='A' THEN 2 WHEN IE_TIPO_MOVIMENTACAO='E' THEN 3 END  IE_TIPO_MOVIMENTACAO,
	nm_mae,
	(replace(replace(campo_mascara(vl_preco_segurado,2),',',''),'.',''))::numeric 		vl_preco_segurado,
	' ' ds_branco,
	CASE WHEN IE_ESTADO_CIVIL='1' THEN '03' WHEN IE_ESTADO_CIVIL='2' THEN '04' WHEN IE_ESTADO_CIVIL='3' THEN '07' WHEN IE_ESTADO_CIVIL='4' THEN '06' WHEN IE_ESTADO_CIVIL='5' THEN '05' WHEN IE_ESTADO_CIVIL='9' THEN '07' END  ds_estado_civil,
	nr_seq_lote
from	pls_movimentacao_benef;

