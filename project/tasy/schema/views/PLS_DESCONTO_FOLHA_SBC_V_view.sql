-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_desconto_folha_sbc_v (tp_registro, cd_matricula, nm_pagador, vl_contribuicao, vl_desconto, vl_descontado, dt_vencimento, nr_seq_cobranca) AS select	1				TP_REGISTRO,
	null				cd_matricula, 
	null				nm_pagador, 
	null				vl_contribuicao, 
	null				vl_desconto, 
	null				vl_descontado, 
	null				dt_vencimento, 
	a.nr_seq_cobranca		nr_seq_cobranca 
FROM	titulo_receber_cobr		a, 
	pls_mensalidade			b, 
	pls_contrato_pagador_fin	c, 
	cobranca_escritural		d, 
	titulo_receber			e 
where	e.nr_seq_mensalidade = b.nr_sequencia 
and	a.nr_titulo	= e.nr_titulo 
and	b.nr_seq_pagador = c.nr_seq_pagador 
and	LOCALTIMESTAMP	between coalesce(c.dt_inicio_vigencia,LOCALTIMESTAMP) and coalesce(c.dt_fim_vigencia,LOCALTIMESTAMP) 
and	a.nr_seq_cobranca = d.nr_sequencia 

union
 
select	2				tp_registro, 
	c.cd_matricula			cd_matricula, 
	pls_obter_dados_pagador(b.nr_seq_pagador,'N')	NM_PAGADOR, 
	Campo_Mascara_virgula(b.vl_mensalidade)	vl_contribuicao, 
	Campo_Mascara_virgula(0)		vl_desconto, 
	Campo_Mascara_virgula(a.vl_cobranca)	vl_descontado, 
	e.dt_pagamento_previsto		dt_vencimento, 
	a.nr_seq_cobranca		nr_seq_cobranca 
from	titulo_receber_cobr		a, 
	pls_mensalidade			b, 
	pls_contrato_pagador_fin	c, 
	cobranca_escritural		d, 
	titulo_receber			e 
where	e.nr_seq_mensalidade	= b.nr_sequencia 
and	a.nr_titulo		= e.nr_titulo 
and	b.nr_seq_pagador_fin	= c.nr_sequencia 
and	a.nr_seq_cobranca = d.nr_sequencia;

