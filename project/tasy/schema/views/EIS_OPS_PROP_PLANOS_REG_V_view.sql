-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_ops_prop_planos_reg_v (dt_mes_competencia, dt_mes_competencia_param, cd_estabelecimento, ie_regulamentacao, ie_tipo_segurado) AS select	pkg_date_formaters.to_varchar(z.dt_mes_competencia,'shortDate',wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck.get_nm_usuario) dt_mes_competencia,
	z.dt_mes_competencia dt_mes_competencia_param,
	s.cd_estabelecimento,
	substr(obter_valor_dominio(2157,p.ie_regulamentacao),1,255) ie_regulamentacao,
	s.ie_tipo_segurado
FROM	pls_segurado s,
	pls_plano p,
	( select   dt_mes dt_mes_competencia
	  from	   mes_v) z
where	s.nr_seq_plano = p.nr_sequencia
and	coalesce(s.dt_rescisao,z.dt_mes_competencia) >= z.dt_mes_competencia
and	s.dt_liberacao is not null
and	s.dt_contratacao <= z.dt_mes_competencia
and	p.ie_regulamentacao in ('A','P','R');

