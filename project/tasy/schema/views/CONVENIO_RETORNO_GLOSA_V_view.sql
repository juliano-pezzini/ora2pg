-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW convenio_retorno_glosa_v (ds_item, ds_setor_atendimento, cd_setor_atendimento, nm_pessoa_fisica, nr_atendimento, nr_seq_item, nr_seq_ret_item, vl_item, vl_glosa, vl_pago, cd_convenio, cd_motivo_glosa, nr_seq_conpaci_ret_hist, ds_observacao) AS select	substr(obter_descricao_procedimento(a.cd_procedimento,a.ie_origem_proced),1,100) ds_item,
	substr(obter_nome_setor(a.cd_setor_atendimento),1,100) ds_setor_atendimento, 
	a.cd_setor_atendimento cd_setor_atendimento, 
	substr(obter_pessoa_atendimento(a.nr_atendimento, 'N'),1,60) nm_pessoa_fisica, 
	a.nr_atendimento, 
	b.nr_seq_propaci nr_seq_item, 
	b.nr_seq_ret_item, 
	a.vl_procedimento vl_item, 
	b.vl_glosa, 
	(a.vl_procedimento - b.vl_glosa) vl_pago, 
	a.cd_convenio, 
	b.cd_motivo_glosa, 
	b.nr_seq_conpaci_ret_hist, 
	b.ds_observacao 
FROM	convenio_retorno_glosa b, 
	procedimento_paciente a 
where	b.nr_seq_propaci	= a.nr_sequencia 

union
 
select	substr(obter_desc_material(a.cd_material),1,100) ds_item, 
	substr(obter_nome_setor(a.cd_setor_atendimento),1,100) ds_setor_atendimento, 
	a.cd_setor_atendimento cd_setor_atendimento, 
	substr(obter_pessoa_atendimento(a.nr_atendimento, 'N'),1,60) nm_pessoa_fisica, 
	b.nr_seq_matpaci nr_seq_item, 
	a.nr_atendimento, 
	b.nr_seq_ret_item, 
	a.vl_material vl_item, 
	b.vl_glosa, 
	(a.vl_material - b.vl_glosa) vl_pago, 
	a.cd_convenio, 
	b.cd_motivo_glosa, 
	b.nr_seq_conpaci_ret_hist, 
	b.ds_observacao 
from	convenio_retorno_glosa b, 
	material_atend_paciente a 
where	b.nr_seq_matpaci	= a.nr_sequencia;

