-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW adep_hor_item_v (nr_seq_apresent, ie_tipo_item, nr_prescricao, nr_seq_item, cd_item, nr_seq_horario, dt_horario, ie_status, dt_adm, dt_susp, cd_unidade_medida, ds_intervalo, qt_dose, nr_seq_lote, nr_atendimento) AS select	1 nr_seq_apresent,
	'D' ie_tipo_item,
	a.nr_prescricao nr_prescricao,
	null nr_seq_item,
	c.cd_refeicao cd_item,
	c.nr_sequencia nr_seq_horario,
	c.dt_horario dt_horario,
	substr(obter_status_hor_prescr(c.nr_sequencia,'D'),1,1) ie_status,
	c.dt_fim_horario dt_adm,
	c.dt_suspensao dt_susp,
	'' cd_unidade_medida,
	'' ds_intervalo,
	0 qt_dose,
	null nr_seq_lote,
	a.nr_atendimento
FROM	prescr_dieta_hor c,
	prescr_medica a
where	c.nr_prescricao = a.nr_prescricao
--and	nvl(c.ie_situacao,'A') = 'A'
and	coalesce(a.ie_adep,'S') = 'S'
and	a.dt_liberacao is not null
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S'

union

select	2 nr_seq_apresent,
	'S' ie_tipo_item,
	a.nr_prescricao nr_prescricao,
	b.nr_sequencia nr_seq_item,
	to_char(b.cd_material) cd_item,
	c.nr_sequencia nr_seq_horario,
	c.dt_horario dt_horario,
	substr(obter_status_hor_prescr(c.nr_sequencia,'S'),1,1) ie_status,
	c.dt_fim_horario dt_adm,
	c.dt_suspensao dt_susp,
	b.cd_unidade_medida,
	substr(Obter_desc_intervalo(b.cd_intervalo),1,40) ds_intervalo,
	b.qt_dose,
	c.nr_seq_lote nr_seq_lote,
	a.nr_atendimento
from	prescr_mat_hor c,
	prescr_material b,
	prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
--and	nvl(c.ie_situacao,'A') = 'A'
and	b.ie_agrupador = 12
and	coalesce(c.ie_horario_especial,'N') = 'N'
and	coalesce(a.ie_adep,'S') = 'S'
and	a.dt_liberacao is not null
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S'

union

select	3 nr_seq_apresent,
	'M' ie_tipo_item,
	a.nr_prescricao nr_prescricao,
	b.nr_sequencia nr_seq_item,
	to_char(b.cd_material) cd_item,
	c.nr_sequencia nr_seq_horario,
	c.dt_horario dt_horario,
	--substr(obter_status_hor_prescr(c.nr_sequencia,'M'),1,1) ie_status,
	CASE WHEN 	c.dt_recusa IS NULL THEN 		substr(obter_status_hor_medic(c.dt_fim_horario,c.dt_suspensao,c.ie_dose_especial,c.nr_seq_processo,c.nr_seq_area_prep),1,15)  ELSE substr(obter_status_recusa_pac(c.dt_fim_horario,c.dt_suspensao),1,15) END  ie_status,
	c.dt_fim_horario dt_adm,
	c.dt_suspensao dt_susp,
	b.cd_unidade_medida,
	substr(Obter_desc_intervalo(b.cd_intervalo),1,40) ds_intervalo,
	b.qt_dose,
	c.nr_seq_lote nr_seq_lote,
	a.nr_atendimento
from	prescr_mat_hor c,
	prescr_material b,
	prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
--and	nvl(c.ie_situacao,'A') = 'A'
and	coalesce(c.ie_adep,'S') = 'S'
and	b.ie_agrupador = 1
and	coalesce(a.ie_adep,'S') = 'S'
and	coalesce(c.ie_horario_especial,'N') = 'N'
and	a.dt_liberacao is not null
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S'

union

select	4 nr_seq_apresent,
	'MAT' ie_tipo_item,
	a.nr_prescricao nr_prescricao,
	b.nr_sequencia nr_seq_item,
	to_char(b.cd_material) cd_item,
	c.nr_sequencia nr_seq_horario,
	c.dt_horario dt_horario,
	substr(obter_status_hor_prescr(c.nr_sequencia,'M'),1,1) ie_status,
	c.dt_fim_horario dt_adm,
	c.dt_suspensao dt_susp,
	b.cd_unidade_medida,
	substr(Obter_desc_intervalo(b.cd_intervalo),1,40) ds_intervalo,
	b.qt_dose,
	c.nr_seq_lote nr_seq_lote,
	a.nr_atendimento
from	prescr_mat_hor c,
	prescr_material b,
	prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
--and	nvl(c.ie_situacao,'A') = 'A'
and	coalesce(c.ie_adep,'S') = 'S'
and	b.ie_agrupador = 2
and	coalesce(a.ie_adep,'S') = 'S'
and	coalesce(c.ie_horario_especial,'N') = 'N'
and	a.dt_liberacao is not null
and	obter_se_material_adep(a.cd_estabelecimento,b.cd_material) = 'S'
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S'

union

select	CASE WHEN b.nr_seq_exame IS NULL THEN  5  ELSE 8 END  nr_seq_apresent,
	CASE WHEN obter_se_ctrl_glic_proc(b.nr_seq_proc_interno)='S' THEN  'G'  ELSE CASE WHEN b.nr_seq_exame IS NULL THEN  'P'  ELSE 'L' END  END  ie_tipo_item,
	a.nr_prescricao nr_prescricao,
	b.nr_sequencia nr_seq_item,
	to_char(b.cd_procedimento) cd_item,
	c.nr_sequencia nr_seq_horario,
	c.dt_horario dt_horario,
	substr(obter_status_hor_prescr(c.nr_sequencia,'P'),1,1) ie_status,
	c.dt_fim_horario dt_adm,
	c.dt_suspensao dt_susp,
	'' cd_unidade_medida,
	substr(Obter_desc_intervalo(b.cd_intervalo),1,40) ds_intervalo,
	0 qt_dose,
	null nr_seq_lote,
	a.nr_atendimento
from	prescr_proc_hor c,
	prescr_procedimento b,
	prescr_medica a
where	c.nr_seq_procedimento = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
--and	nvl(c.ie_situacao,'A') = 'A'
and	b.nr_seq_solic_sangue is null
and	b.nr_seq_derivado is null
--and	((b.nr_seq_proc_interno is null) or (obter_ctrl_glic_proc(b.nr_seq_proc_interno) = 'NC'))
and	coalesce(a.ie_adep,'S') = 'S'
and	coalesce(c.ie_horario_especial,'N') = 'N'
and	a.dt_liberacao is not null
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S'

union

select	6 nr_seq_apresent,
	'R' ie_tipo_item,
	a.nr_prescricao nr_prescricao,
	b.nr_sequencia nr_seq_item,
	coalesce(to_char(b.cd_recomendacao),b.ds_recomendacao) cd_item,
	c.nr_sequencia nr_seq_horario,
	c.dt_horario dt_horario,
	substr(obter_status_hor_prescr(c.nr_sequencia,'R'),1,1) ie_status,
	c.dt_fim_horario dt_adm,
	c.dt_suspensao dt_susp,
	'' cd_unidade_medida,
	substr(Obter_desc_intervalo(b.cd_intervalo),1,40) ds_intervalo,
	0 qt_dose,
	null nr_seq_lote,
	a.nr_atendimento
from	prescr_rec_hor c,
	prescr_recomendacao b,
	prescr_medica a
where	c.nr_seq_recomendacao = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
--and	nvl(c.ie_situacao,'A') = 'A'
and	coalesce(a.ie_adep,'S') = 'S'
and	coalesce(c.ie_horario_especial,'N') = 'N'
and	a.dt_liberacao is not null
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S'

union

select	7 nr_seq_apresent,
	'E' ie_tipo_item,
	a.nr_sequencia nr_prescricao,
	b.nr_sequencia nr_seq_item,
	to_char(b.nr_seq_proc) cd_item,
	c.nr_sequencia nr_seq_horario,
	c.dt_horario dt_horario,
	substr(obter_status_hor_prescr(c.nr_sequencia,'E'),1,1) ie_status,
	c.dt_fim_horario dt_adm,
	c.dt_suspensao dt_susp,
	'' cd_unidade_medida,
	substr(Obter_desc_intervalo(b.cd_intervalo),1,40) ds_intervalo,
	0 qt_dose,
	null nr_seq_lote,
	a.nr_atendimento
from	pe_prescr_proc_hor c,
	pe_prescr_proc b,
	pe_prescricao a
where	c.nr_seq_pe_proc = b.nr_sequencia
and	c.nr_seq_pe_prescr = b.nr_seq_prescr
and	b.nr_seq_prescr = a.nr_sequencia
and	coalesce(c.ie_horario_especial,'N') = 'N'
and	coalesce(b.ie_adep,'N') in ('S','M')
and	a.dt_liberacao is not null

union

select	8 nr_seq_apresent, --Material associado procedimentos
	'IA' ie_tipo_item,
	a.nr_prescricao nr_prescricao,
	b.nr_sequencia nr_seq_item,
	to_char(b.cd_material) cd_item,
	c.nr_sequencia nr_seq_horario,
	c.dt_horario dt_horario,
	substr(obter_status_hor_prescr(c.nr_sequencia,'M'),1,1) ie_status,
	c.dt_fim_horario dt_adm,
	c.dt_suspensao dt_susp,
	b.cd_unidade_medida,
	substr(Obter_desc_intervalo(b.cd_intervalo),1,40) ds_intervalo,
	b.qt_dose,
	c.nr_seq_lote nr_seq_lote,
	a.nr_atendimento
from	prescr_mat_hor c,
	prescr_material b,
	prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
and	coalesce(c.ie_adep,'S') = 'S'
and	b.ie_agrupador = 5
and	coalesce(c.ie_horario_especial,'N') = 'N'
and	coalesce(a.ie_adep,'S') = 'S'
and	a.dt_liberacao is not null
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S'

union

select	9 nr_seq_apresent, --SUporte nutricional enteral
	'SNE' ie_tipo_item,
	a.nr_prescricao nr_prescricao,
	b.nr_sequencia nr_seq_item,
	to_char(b.cd_material) cd_item,
	c.nr_sequencia nr_seq_horario,
	c.dt_horario dt_horario,
	substr(obter_status_hor_prescr(c.nr_sequencia,'M'),1,1) ie_status,
	c.dt_fim_horario dt_adm,
	c.dt_suspensao dt_susp,
	b.cd_unidade_medida,
	substr(Obter_desc_intervalo(b.cd_intervalo),1,40) ds_intervalo,
	b.qt_dose,
	c.nr_seq_lote nr_seq_lote,
	a.nr_atendimento
from	prescr_mat_hor c,
	prescr_material b,
	prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
and	coalesce(c.ie_adep,'S') = 'S'
and	b.ie_agrupador = 8
and	coalesce(c.ie_horario_especial,'N') = 'N'
and	coalesce(a.ie_adep,'S') = 'S'
and	a.dt_liberacao is not null
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S'

union

select	10 nr_seq_apresentacao, --Soluções
	'SOL' ie_tipo_item,
	a.nr_prescricao nr_prescricao,
	b.nr_sequencia nr_seq_item,
	to_char(b.cd_material) cd_item,
	c.nr_sequencia nr_seq_horario,
	c.dt_horario dt_horario,
	substr(obter_status_hor_prescr(c.nr_sequencia,'M'),1,1) ie_status,
	c.dt_fim_horario dt_adm,
	c.dt_suspensao dt_susp,
	b.cd_unidade_medida,
	substr(Obter_desc_intervalo(b.cd_intervalo),1,40) ds_intervalo,
	b.qt_dose,
	c.nr_seq_lote nr_seq_lote,
	a.nr_atendimento
from	prescr_mat_hor c,
	prescr_material b,
	prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
and	coalesce(c.ie_adep,'S') = 'S'
and	b.ie_agrupador = 4
and	coalesce(c.ie_horario_especial,'N') = 'N'
and	coalesce(a.ie_adep,'S') = 'S'
and	a.dt_liberacao is not null
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S'

union

select	12 nr_seq_apresent,
	'LD' ie_tipo_item,
	a.nr_prescricao nr_prescricao,
	b.nr_sequencia nr_seq_item,
	to_char(b.cd_material) cd_item,
	c.nr_sequencia nr_seq_horario,
	c.dt_horario dt_horario,
	substr(obter_status_hor_prescr(c.nr_sequencia,'S'),1,1) ie_status,
	c.dt_fim_horario dt_adm,
	c.dt_suspensao dt_susp,
	b.cd_unidade_medida,
	substr(Obter_desc_intervalo(b.cd_intervalo),1,40) ds_intervalo,
	b.qt_dose,
	c.nr_seq_lote nr_seq_lote,
	a.nr_atendimento
from	prescr_mat_hor c,
	prescr_material b,
	prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
--and	nvl(c.ie_situacao,'A') = 'A'
and	b.ie_agrupador = 16
and	coalesce(c.ie_horario_especial,'N') = 'N'
and	coalesce(a.ie_adep,'S') = 'S'
and	a.dt_liberacao is not null
and	Obter_se_horario_liberado(c.dt_lib_horario, c.dt_horario) = 'S';

