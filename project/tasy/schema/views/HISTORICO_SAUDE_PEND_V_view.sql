-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW historico_saude_pend_v (ie_tipo, ds_tipo, dt_registro, nr_atendimento, dt_inicio, dt_fim, nr_seq_nivel_seg, cd_pessoa_fisica, nm_paciente, nm_usuario, nm_usuario_nrec, dt_liberacao, nr_sequencia, nm_tabela, ds_historico_rotina, nm_historico_rotina) AS select	'R' ie_tipo,
		obter_desc_expressao(492992) ds_tipo, --'Reação adversa ou alérgica'
		coalesce(dt_registro,dt_atualizacao_nrec) dt_registro,
		nr_atendimento nr_atendimento,
		dt_inicio dt_inicio,
		dt_fim dt_fim,
		nr_seq_nivel_seg nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_pessoa_atendimento(nr_atendimento,'N') nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'PACIENTE_ALERGIA' nm_tabela,
		substr(coalesce(coalesce(coalesce(coalesce(obter_desc_dcb(nr_seq_dcb),substr(obter_desc_material(cd_material),1,254)),substr(obter_desc_classe_mat(cd_classe_mat),1,255)),obter_desc_ficha_tecnica(nr_seq_ficha_tecnica)),obter_desc_familia_mat(nr_seq_familia)),1,255) ds_historico_rotina,
		substr(obter_desc_historico_rotina(nr_seq_hist_rotina),1,150) nm_historico_rotina
FROM	paciente_alergia
where	dt_inativacao is null

union all

select	'DP' ie_tipo,
		obter_desc_expressao(314080) ds_tipo, --'Doenças prévias e atuais'
		coalesce(dt_registro,dt_atualizacao_nrec) dt_registro,
		nr_atendimento nr_atendimento,
		dt_inicio dt_inicio,
		dt_fim dt_fim,
		nr_seq_nivel_seg nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_pessoa_atendimento(nr_atendimento,'N') nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'PACIENTE_ANTEC_CLINICO' nm_tabela,
		ds_doenca ds_historico_rotina,
		substr(obter_desc_historico_rotina(nr_seq_hist_rotina),1,150) nm_historico_rotina
from	paciente_antec_clinico
where	dt_inativacao is null
and 	coalesce(ie_paciente, 'S') = 'S'

union all

select	'M' ie_tipo,
		OBTER_DESC_EXPRESSAO(293088) ds_tipo, --'Medicamentos em uso'
		coalesce(dt_registro,dt_atualizacao_nrec) dt_registro,
		nr_atendimento nr_atendimento,
		dt_inicio dt_inicio,
		dt_fim dt_fim,
		nr_seq_nivel_seg nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_pessoa_atendimento(nr_atendimento,'N') nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'PACIENTE_MEDIC_USO' nm_tabela,
		substr(coalesce(coalesce(obter_desc_material(cd_material),ds_medicamento),ds_medicamento),1,100) ds_historico_rotina,
		substr(obter_desc_historico_rotina(nr_seq_hist_rotina),1,150) nm_historico_rotina
from	paciente_medic_uso
where	dt_inativacao is null
and		coalesce(ie_exibir_plano_medic,'S') = 'S'

union all

select	'H' ie_tipo,
		obter_desc_expressao(291200) ds_tipo, --'Hábitos'
		coalesce(dt_registro,dt_atualizacao_nrec) dt_registro,
		nr_atendimento nr_atendimento,
		dt_inicio dt_inicio,
		dt_fim dt_fim,
		nr_seq_nivel_seg nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_pessoa_atendimento(nr_atendimento,'N') nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'PACIENTE_HABITO_VICIO' nm_tabela,
		substr(obter_desc_tipo_vicio(nr_seq_tipo),1,80) ds_historico_rotina,
		substr(obter_desc_historico_rotina(nr_seq_hist_rotina),1,150) nm_historico_rotina
from	paciente_habito_vicio
where	dt_inativacao is null

union all

select	'CE' ie_tipo,
		obter_desc_expressao(492995) ds_tipo, --'Cirurgias externas'
		dt_atualizacao_nrec dt_registro,
		nr_atendimento nr_atendimento,
		dt_inicio dt_inicio,
		dt_fim dt_fim,
		nr_seq_nivel_seg nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_pessoa_atendimento(nr_atendimento,'N') nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'HISTORICO_SAUDE_CIRURGIA' nm_tabela,
		ds_procedimento_inf ds_historico_rotina,
		substr(obter_desc_historico_rotina(nr_seq_hist_rotina),1,150) nm_historico_rotina
from	historico_saude_cirurgia
where	dt_inativacao is null

union all

select	'IN' ie_tipo,
		obter_desc_expressao(888027) ds_tipo, --'Internações'
		coalesce(dt_registro,dt_atualizacao_nrec) dt_registro,
		null nr_atendimento,
		dt_internacao dt_inicio,
		dt_alta dt_fim,
		nr_seq_nivel_seg nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_nome_pessoa_fisica(cd_pessoa_fisica, null) nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'HISTORICO_SAUDE_INTERNACAO' nm_tabela,
		ds_instituicao ds_historico_rotina,
		'' nm_historico_rotina
from	historico_saude_internacao
where	dt_inativacao is null

union all

select	'TA' ie_tipo,
		obter_desc_expressao(300463) ds_tipo, --'Tratamentos anteriores'
		coalesce(dt_registro,dt_atualizacao_nrec) dt_registro,
		null nr_atendimento,
		dt_inicio_tratamento dt_inicio,
		dt_fim_tratamento dt_fim,
		nr_seq_nivel_seg nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_nome_pessoa_fisica(cd_pessoa_fisica, null) nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'HISTORICO_SAUDE_TRATAMENTO' nm_tabela,
		substr(obter_descricao_padrao('TIPO_TRATAMENTO_SAUDE','DS_TRATAMENTO',nr_seq_tipo_tratamento),1,255) ds_historico_rotina,
		substr(obter_desc_historico_rotina(nr_seq_hist_rotina),1,150) nm_historico_rotina
from	historico_saude_tratamento
where	dt_inativacao is null

union all

select	'O' ie_tipo,
		obter_desc_expressao(294713) ds_tipo, --'Ocorrências'
		coalesce(dt_registro,dt_atualizacao_nrec) dt_registro,
		nr_atendimento nr_atendimento,
		dt_inicio dt_inicio,
		dt_fim dt_fim,
		nr_seq_nivel_seg nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_pessoa_atendimento(nr_atendimento,'N') nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'PACIENTE_OCORRENCIA' nm_tabela,
		substr(obter_desc_tipo_pac_ocorrencia(nr_seq_tipo_ocorrencia),1,100) ds_historico_rotina,
		substr(obter_desc_historico_rotina(nr_seq_hist_rotina),1,150) nm_historico_rotina
from	paciente_ocorrencia
where	dt_inativacao is null

union all

select	'RT' ie_tipo,
		obter_desc_expressao(297794) ds_tipo, --'restrições'
		dt_atualizacao_nrec dt_registro,
		null nr_atendimento,
		dt_inicio dt_inicio,
		dt_fim dt_fim,
		nr_seq_nivel_seg nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_nome_pessoa_fisica(cd_pessoa_fisica, null) nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'PACIENTE_REP_PRESCRICAO' nm_tabela,
		'' ds_historico_rotina,
		substr(obter_desc_historico_rotina(nr_seq_hist_rotina),1,150) nm_historico_rotina
from	paciente_rep_prescricao
where	dt_inativacao is null

union all

select	'HCF' ie_tipo,
		obter_desc_expressao(709477) ds_tipo, --'História clínica familiar'
		coalesce(dt_registro,dt_atualizacao_nrec) dt_registro,
		nr_atendimento nr_atendimento,
		dt_inicio dt_inicio,
		dt_fim dt_fim,
		nr_seq_nivel_seg nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_pessoa_atendimento(nr_atendimento,'N') nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'PACIENTE_ANTEC_CLINICO' nm_tabela,
		substr(Obter_desc_parentesco(nr_seq_parentesco),1,255) ds_historico_rotina,
		substr(obter_desc_historico_rotina(nr_seq_hist_rotina),1,150) nm_historico_rotina
from	paciente_antec_clinico
where	dt_inativacao is null
and 	coalesce(ie_paciente, 'S') = 'N'

union all

select	'AOP' ie_tipo,
		obter_desc_expressao(283136) ds_tipo, --'Acessório/Órtese/Prótese'
		coalesce(dt_registro,dt_atualizacao_nrec) dt_registro,
		null nr_atendimento,
		dt_inicio dt_inicio,
		dt_fim dt_fim,
		nr_seq_nivel_seg nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_nome_pessoa_fisica(cd_pessoa_fisica, null) nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'PACIENTE_ACESSORIO' nm_tabela,
		substr(obter_desc_acessorio_pac(nr_seq_acessorio),1,255) ds_historico_rotina,
		substr(obter_desc_historico_rotina(nr_seq_hist_rotina),1,150) nm_historico_rotina
from	paciente_acessorio
where	dt_inativacao is null

union all

select	'FR' ie_tipo,
		obter_desc_expressao(290020) ds_tipo, --'Fatores de risco'
		coalesce(dt_registro,dt_atualizacao_nrec) dt_registro,
		nr_atendimento nr_atendimento,
		null dt_inicio,
		dt_fim_risco dt_fim,
		null nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		coalesce(obter_pessoa_atendimento(nr_atendimento,'N'), obter_nome_pessoa_fisica(cd_pessoa_fisica, null)) nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'CIH_PAC_FAT_RISCO' nm_tabela,
		substr(obter_desc_fator_risco(nr_seq_fator_risco),1,255) ds_historico_rotina,
		substr(obter_desc_historico_rotina(nr_seq_hist_rotina),1,150) nm_historico_rotina
from	cih_pac_fat_risco
where	dt_inativacao is null

union all

select	'SEC' ie_tipo,
		obter_desc_expressao(314073) ds_tipo, --'Sócio/Econ/Cult/Out hab'
		coalesce(dt_registro,dt_atualizacao_nrec) dt_registro,
		null nr_atendimento,
		null dt_inicio,
		null dt_fim,
		null nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_nome_pessoa_fisica(cd_pessoa_fisica, null) nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'PACIENTE_HIST_SOCIAL' nm_tabela,
		substr(ds_socio_economica,1,255) ds_historico_rotina,
		'' nm_historico_rotina
from	paciente_hist_social
where	dt_inativacao is null

union all

select	'V' ie_tipo,
		obter_desc_expressao(314074) ds_tipo, --'Vacinas'
		dt_registro dt_registro,
		nr_atendimento nr_atendimento,
		null dt_inicio,
		null dt_fim,
		null nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_pessoa_atendimento(nr_atendimento,'N') nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'PACIENTE_VACINA' nm_tabela,
		substr(obter_descricao_padrao('VACINA','DS_VACINA',nr_seq_vacina),1,255) ds_historico_rotina,
		substr(obter_desc_historico_rotina(nr_seq_hist_rotina),1,150) nm_historico_rotina
from	paciente_vacina
where	dt_inativacao is null

union all

select	'NE' ie_tipo,
		obter_desc_expressao(787605) ds_tipo, --'Necessidades especiais'
		dt_atualizacao_nrec dt_registro,
		null nr_atendimento,
		null dt_inicio,
		null dt_fim,
		null nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_nome_pessoa_fisica(cd_pessoa_fisica, null) nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'PF_TIPO_DEFICIENCIA' nm_tabela,
		substr(rp_obter_desc_deficiencia(nr_seq_tipo_def),1,255) ds_historico_rotina,
		substr(obter_desc_historico_rotina(nr_seq_hist_rotina),1,150) nm_historico_rotina
from	pf_tipo_deficiencia
where	dt_inativacao is null

union all

select	'DS' ie_tipo,
		obter_desc_expressao(492118) ds_tipo, --'Declaração de saúde'
		dt_atualizacao_nrec dt_registro,
		null nr_atendimento,
		null dt_inicio,
		null dt_fim,
		null nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_nome_pessoa_fisica(cd_pessoa_fisica, null) nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'PLS_DECLARACAO_SEGURADO' nm_tabela,
		substr(CASE WHEN nr_seq_tipo_avaliacao IS NULL THEN ''  ELSE obter_desc_tipo_avaliacao(nr_seq_tipo_avaliacao)||' - ' END ||obter_desc_modelo(nr_seq_modelo),1,250) ds_historico_rotina,
		'' nm_historico_rotina
from	pls_declaracao_segurado

union all

select	'E' ie_tipo,
		obter_desc_expressao(289728) ds_tipo, --'Exames'
		dt_atualizacao_nrec dt_registro,
		null nr_atendimento,
		null dt_inicio,
		null dt_fim,
		null nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_nome_pessoa_fisica(cd_pessoa_fisica, null) nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'PACIENTE_EXAME' nm_tabela,
		substr(Obter_Valor_Dominio(3966,ie_exame_pac),1,50) ds_historico_rotina,
		substr(obter_desc_historico_rotina(nr_seq_hist_rotina),1,150) nm_historico_rotina
from	paciente_exame
where	dt_inativacao is null

union all

select	'TR' ie_tipo,
		obter_desc_expressao(300409) ds_tipo, --'Transfusão'
		coalesce(dt_registro,dt_atualizacao_nrec) dt_registro,
		null nr_atendimento,
		null dt_inicio,
		null dt_fim,
		null nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_nome_pessoa_fisica(cd_pessoa_fisica, null) nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'PACIENTE_TRANSFUSAO' nm_tabela,
		substr(obter_desc_san_derivado(nr_seq_derivado),1,255) ds_historico_rotina,
		'' nm_historico_rotina
from	paciente_transfusao
where	dt_inativacao is null

union all

select	'SM' ie_tipo,
		obter_desc_expressao(314077) ds_tipo, --'Saúde da mulher'
		coalesce(dt_registro,dt_atualizacao_nrec) dt_registro,
		null nr_atendimento,
		null dt_inicio,
		null dt_fim,
		null nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_nome_pessoa_fisica(cd_pessoa_fisica, null) nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'HISTORICO_SAUDE_MULHER' nm_tabela,
		'' ds_historico_rotina,
		'' nm_historico_rotina
from	historico_saude_mulher
where	dt_inativacao is null

union all

select	'AMP' ie_tipo,
		obter_desc_expressao(314083) ds_tipo, --'Amputações'
		dt_atualizacao_nrec dt_registro,
		null nr_atendimento,
		null dt_inicio,
		null dt_fim,
		null nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_nome_pessoa_fisica(cd_pessoa_fisica, null) nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'PACIENTE_AMPUTACAO' nm_tabela,
		obter_desc_amputacao(nr_seq_amputacao) ds_historico_rotina,
		substr(obter_desc_historico_rotina(nr_seq_hist_rotina),1,150) nm_historico_rotina
from	paciente_amputacao
where	dt_inativacao is null

union all

select	'PFL' ie_tipo,
		obter_desc_expressao(795203) ds_tipo, --'Pflegegrad'
		coalesce(dt_registro,dt_atualizacao_nrec) dt_registro,
		nr_atendimento nr_atendimento,
		null dt_inicio,
		dt_fim dt_fim,
		null nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_pessoa_atendimento(nr_atendimento,'N') nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'PACIENTE_PFLEGEGRAD' nm_tabela,
		coalesce(SUBSTR(obter_valor_dominio(8674,IE_PFLEGEGRAD),1,255), obter_desc_expressao(886693)) ds_historico_rotina,
		substr(obter_desc_historico_rotina(nr_seq_hist_rotina),1,150) nm_historico_rotina
from	paciente_pflegegrad
where	dt_inativacao is null

union all

select	'IAS' ie_tipo,
		obter_desc_expressao(887931) ds_tipo, --'Interrogatório por aparelhos e sistemas'
		coalesce(dt_registro,dt_atualizacao_nrec) dt_registro,
		nr_atendimento nr_atendimento,
		null dt_inicio,
		null dt_fim,
		null nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_pessoa_atendimento(nr_atendimento,'N') nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'INTERROGATORIO_APARELHO' nm_tabela,
		'' ds_historico_rotina,
		'' nm_historico_rotina
from	interrogatorio_aparelho
where	dt_inativacao is null

union all

select	'EF' ie_tipo,
		obter_desc_expressao(887971) ds_tipo, --'Exploração física'
		coalesce(dt_registro,dt_atualizacao_nrec) dt_registro,
		nr_atendimento nr_atendimento,
		null dt_inicio,
		null dt_fim,
		null nr_seq_nivel_seg,
		cd_pessoa_fisica cd_pessoa_fisica,
		obter_pessoa_atendimento(nr_atendimento,'N') nm_paciente,
		nm_usuario nm_usuario,
		nm_usuario nm_usuario_nrec,
		dt_liberacao dt_liberacao,
		nr_sequencia nr_sequencia,
		'EXPLORACAO_FISICA' nm_tabela,
		'' ds_historico_rotina,
		'' nm_historico_rotina
from	exploracao_fisica
where	dt_inativacao is null;

