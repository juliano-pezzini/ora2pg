-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW hepic_cirurgia_v (nr_cirurgia, dt_inicio_real, dt_termino, dt_atualizacao, cd_sala_cirurgica, cd_setor_atendimento, ds_setor_atendimento, nr_atendimento, tipo_cirurgia, cd_medico_cirurgiao, cd_tipo_anestesia, paciente, nr_prontuario, cd_paciente, diagnostico_cirurgiao, "infeccao_pré_operatória", mesmo_local_cirurgico, "complicaçoes_cirurgicas", data_diagnostico, tipo_complicacao, reabertura_ferida, ie_asa_estado_paciente, nr_min_duracao_real, ie_carater_cirurgia, endoscopica, ie_ortese_protese, evolucao, lesao_aberta, sinais_de_infeccao, via_de_acesso) AS select
	 distinct 	a.nr_cirurgia, 
				a.dt_inicio_real, 
				a.dt_termino, 
			  a.dt_atualizacao, 
			  obter_sala_cirurgia(a.nr_cirurgia) cd_sala_cirurgica, 
			  a.cd_setor_atendimento, 
				ds_setor_atendimento, 
			  a.nr_atendimento, 
				cd_tipo_cirurgia tipo_cirurgia, 
			  a.cd_medico_cirurgiao, 
				a.cd_tipo_anestesia, 
			  c.nm_pessoa_fisica paciente, 
				c.nr_prontuario, 
			  c.cd_pessoa_fisica cd_paciente, 
			  e.cd_doenca diagnostico_cirurgiao, 
			  '' infeccao_pré_operatória, 
			  '' mesmo_local_cirurgico, 
			  '' complicaçoes_cirurgicas, 
			  e.dt_diagnostico data_diagnostico, 
				'' tipo_complicacao, 
			  '' reabertura_ferida, 
			  a.ie_asa_estado_paciente, 
			  nr_min_duracao_real, 
				a.ie_carater_cirurgia, 
			  a.ie_video endoscopica, 
				ie_ortese_protese, 
				'' evolucao, 
			  '' lesao_aberta,  
				'' sinais_de_infeccao, 
				'' via_de_acesso 
		 FROM atendimento_paciente f, pessoa_fisica c, setor_atendimento b, cirurgia a
LEFT OUTER JOIN diagnostico_medico d ON (a.nr_atendimento = d.nr_atendimento)
LEFT OUTER JOIN diagnostico_doenca e ON (d.dt_diagnostico = e.dt_diagnostico AND d.nr_atendimento = e.nr_atendimento)
WHERE a.cd_setor_atendimento = b.cd_setor_atendimento AND a.nr_atendimento = f.nr_atendimento AND f.cd_pessoa_fisica = c.cd_pessoa_fisica;

