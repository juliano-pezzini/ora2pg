-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW bsc_tendencia_indicador_v (nr_seq_edicao, nr_seq_objetivo, nr_seq_classif, nr_seq_tema, nr_sequencia, nr_seq_indicador, nm_indicador, cd_ano, cd_empresa, cd_estabelecimento, cd_classificacao, qt_real0, qt_real1, qt_real2, qt_real3, qt_real4, qt_real5, qt_real6, qt_real7, qt_real8, qt_real9, qt_real10, qt_real11, qt_real12, ds_cor0, ds_cor1, ds_cor2, ds_cor3, ds_cor4, ds_cor5, ds_cor6, ds_cor7, ds_cor8, ds_cor9, ds_cor10, ds_cor11, ds_cor12, pr_var_periodo_ant, pr_var1, pr_var2, pr_var3, pr_var4, pr_var5, pr_var6, pr_var7, pr_var8, pr_var9, pr_var10, pr_var11) AS SELECT	y.nr_seq_edicao,
	y.nr_seq_objetivo,
	y.nr_seq_classif,
	y.nr_seq_tema,
	y.nr_Sequencia,
	y.nr_seq_indicador,
	y.nm_indicador,
	y.cd_ano,
	y.cd_empresa,
	y.cd_estabelecimento,
	y.cd_classificacao,
	coalesce(MAX(y.qt_real0) ,0)  qt_real0,
	coalesce(MAX(y.qt_real1) ,0)  qt_real1,
	coalesce(MAX(y.qt_real2) ,0)  qt_real2,
	coalesce(MAX(y.qt_real3) ,0)  qt_real3,
	coalesce(MAX(y.qt_real4) ,0)  qt_real4,
	coalesce(MAX(y.qt_real5) ,0)  qt_real5,
	coalesce(MAX(y.qt_real6) ,0)  qt_real6,
	coalesce(MAX(y.qt_real7) ,0)  qt_real7,
	coalesce(MAX(y.qt_real8) ,0)  qt_real8,
	coalesce(MAX(y.qt_real9) ,0)  qt_real9,
	coalesce(MAX(y.qt_real10),0)  qt_real10,
	coalesce(MAX(y.qt_real11),0)  qt_real11,
	coalesce(MAX(y.qt_real12),0)  qt_real12,
	MAX(y.ds_cor0)  	ds_cor0,
	MAX(y.ds_cor1)  	ds_cor1,
	MAX(y.ds_cor2)  	ds_cor2,
	MAX(y.ds_cor3)  	ds_cor3,
	MAX(y.ds_cor4)  	ds_cor4,
	MAX(y.ds_cor5)  	ds_cor5,
	MAX(y.ds_cor6)  	ds_cor6,
	MAX(y.ds_cor7)  	ds_cor7,
	MAX(y.ds_cor8)  	ds_cor8,
	MAX(y.ds_cor9)  	ds_cor9,
	MAX(y.ds_cor10) 	ds_cor10,
	MAX(y.ds_cor11) 	ds_cor11,
	MAX(y.ds_cor12) 	ds_cor12,
	obter_variacao_entre_valor(MAX(qt_real0),MAX(qt_real1)) pr_var_periodo_ant,
	obter_variacao_entre_valor(MAX(qt_real1),MAX(qt_real2)) pr_var1,
	obter_variacao_entre_valor(MAX(qt_real2),MAX(qt_real3)) pr_var2,
	obter_variacao_entre_valor(MAX(qt_real3),MAX(qt_real4)) pr_var3,
	obter_variacao_entre_valor(MAX(qt_real4),MAX(qt_real5)) pr_var4,
	obter_variacao_entre_valor(MAX(qt_real5),MAX(qt_real6)) pr_var5,
	obter_variacao_entre_valor(MAX(qt_real6),MAX(qt_real7)) pr_var6,
	obter_variacao_entre_valor(MAX(qt_real7),MAX(qt_real8)) pr_var7,
	obter_variacao_entre_valor(MAX(qt_real8),MAX(qt_real9)) pr_var8,
	obter_variacao_entre_valor(MAX(qt_real9),MAX(qt_real10)) pr_var9,
	obter_variacao_entre_valor(MAX(qt_real10),MAX(qt_real11)) pr_var10,
	obter_variacao_entre_valor(MAX(qt_real11),MAX(qt_real12)) pr_var11
FROM (	SELECT	d.nr_seq_edicao,
		d.nr_sequencia nr_seq_objetivo,
		d.nr_seq_classif,
		d.nr_seq_tema,
		a.nr_sequencia,
		a.nr_sequencia nr_seq_indicador,
		a.nm_indicador,
		b.cd_ano,
		b.cd_empresa,
		b.cd_estabelecimento,
		a.cd_classificacao,
		CASE WHEN b.cd_periodo=1 THEN b.qt_real  ELSE null END  qt_real1,
		CASE WHEN b.cd_periodo=0 THEN b.qt_real  ELSE null END  qt_real0,
		CASE WHEN b.cd_periodo=2 THEN b.qt_real  ELSE null END  qt_real2,
		CASE WHEN b.cd_periodo=3 THEN b.qt_real  ELSE null END  qt_real3,
		CASE WHEN b.cd_periodo=4 THEN b.qt_real  ELSE null END  qt_real4,
		CASE WHEN b.cd_periodo=5 THEN b.qt_real  ELSE null END  qt_real5,
		CASE WHEN b.cd_periodo=6 THEN b.qt_real  ELSE null END  qt_real6,
		CASE WHEN b.cd_periodo=7 THEN b.qt_real  ELSE null END  qt_real7,
		CASE WHEN b.cd_periodo=8 THEN b.qt_real  ELSE null END  qt_real8,
		CASE WHEN b.cd_periodo=9 THEN b.qt_real  ELSE null END  qt_real9,
		CASE WHEN b.cd_periodo=10 THEN b.qt_real  ELSE null END  qt_real10,
		CASE WHEN b.cd_periodo=11 THEN b.qt_real  ELSE null END  qt_real11,
		CASE WHEN b.cd_periodo=12 THEN b.qt_real  ELSE null END  qt_real12,
		CASE WHEN b.cd_periodo=0 THEN SUBSTR(bsc_obter_cor_indicador(a.nr_sequencia, b.nr_sequencia, b.cd_ano, b.cd_periodo),1,50)  ELSE '' END  ds_cor0,
		CASE WHEN b.cd_periodo=1 THEN SUBSTR(bsc_obter_cor_indicador(a.nr_sequencia, b.nr_sequencia, b.cd_ano, b.cd_periodo),1,50)  ELSE '' END  ds_cor1,
		CASE WHEN b.cd_periodo=2 THEN SUBSTR(bsc_obter_cor_indicador(a.nr_sequencia, b.nr_sequencia, b.cd_ano, b.cd_periodo),1,50)  ELSE '' END  ds_cor2,
		CASE WHEN b.cd_periodo=3 THEN SUBSTR(bsc_obter_cor_indicador(a.nr_sequencia, b.nr_sequencia, b.cd_ano, b.cd_periodo),1,50)  ELSE '' END  ds_cor3,
		CASE WHEN b.cd_periodo=4 THEN SUBSTR(bsc_obter_cor_indicador(a.nr_sequencia, b.nr_sequencia, b.cd_ano, b.cd_periodo),1,50)  ELSE '' END  ds_cor4,
		CASE WHEN b.cd_periodo=5 THEN SUBSTR(bsc_obter_cor_indicador(a.nr_sequencia, b.nr_sequencia, b.cd_ano, b.cd_periodo),1,50)  ELSE '' END  ds_cor5,
		CASE WHEN b.cd_periodo=6 THEN SUBSTR(bsc_obter_cor_indicador(a.nr_sequencia, b.nr_sequencia, b.cd_ano, b.cd_periodo),1,50)  ELSE '' END  ds_cor6,
		CASE WHEN b.cd_periodo=7 THEN SUBSTR(bsc_obter_cor_indicador(a.nr_sequencia, b.nr_sequencia, b.cd_ano, b.cd_periodo),1,50)  ELSE '' END  ds_cor7,
		CASE WHEN b.cd_periodo=8 THEN SUBSTR(bsc_obter_cor_indicador(a.nr_sequencia, b.nr_sequencia, b.cd_ano, b.cd_periodo),1,50)  ELSE '' END  ds_cor8,
		CASE WHEN b.cd_periodo=9 THEN SUBSTR(bsc_obter_cor_indicador(a.nr_sequencia, b.nr_sequencia, b.cd_ano, b.cd_periodo),1,50)  ELSE '' END  ds_cor9,
		CASE WHEN b.cd_periodo=10 THEN SUBSTR(bsc_obter_cor_indicador(a.nr_sequencia, b.nr_sequencia, b.cd_ano, b.cd_periodo),1,50)  ELSE '' END  ds_cor10,
		CASE WHEN b.cd_periodo=11 THEN SUBSTR(bsc_obter_cor_indicador(a.nr_sequencia, b.nr_sequencia, b.cd_ano, b.cd_periodo),1,50)  ELSE '' END  ds_cor11,
		CASE WHEN b.cd_periodo=12 THEN SUBSTR(bsc_obter_cor_indicador(a.nr_sequencia, b.nr_sequencia, b.cd_ano, b.cd_periodo),1,50)  ELSE '' END  ds_cor12
FROM	ple_objetivo d,
	bsc_ind_obj c,
	bsc_ind_inf b,
	bsc_indicador a
WHERE	a.nr_sequencia	= b.nr_seq_indicador
AND	a.nr_sequencia	= c.nr_seq_indicador
AND	d.nr_sequencia	= c.nr_seq_objetivo) y
GROUP BY y.nr_seq_edicao,
	y.nr_seq_objetivo,
	y.nr_seq_classif,
	y.nr_seq_tema,
	y.nr_Sequencia,
	y.nm_indicador,
	y.cd_ano,
	y.cd_empresa,
	y.cd_estabelecimento,
	y.cd_classificacao;

