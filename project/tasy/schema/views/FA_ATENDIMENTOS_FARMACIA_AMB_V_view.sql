-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW fa_atendimentos_farmacia_amb_v (nr_atendimento, nr_classificacao, cd_pessoa_fisica, cd_estabelecimento, cd_medico_atend, ie_clinica, ie_tipo_atendimento, nm_usuario_atend, dt_entrada, hr00, hr01, hr02, hr03, hr04, hr05, hr06, hr07, hr08, hr09, hr10, hr11, hr12, hr13, hr14, hr15, hr16, hr17, hr18, hr19, hr20, hr21, hr22, hr23, cd_medico_receita, ds_clinica, ds_sexo, nm_pessoa_fisica, ds_bairro, nm_medico_atend, ds_escolaridade, ds_idade_pf, ds_faixa_etaria, ds_municipio, cd_especialidade, ds_municipio_ibge, nr_class_atendimento, ds_tipo_atendimento, ds_classificacao, ds_estabelecimento, ds_especialidade_medico, ds_estado_civil, ds_hora_recep, ds_label_recep, ds_interv_15_min, i15, i30, i45, i60, ds_hora_triagem, ds_label_triagem, ds_interv_15_min_triagem, t15, t30, t45, t60, cd_convenio, nm_convenio, cd_setor_atendimento, nm_setor_atendimento, ds_status_entrega, ds_entrega_pmc, ds_pmc, ie_status_entrega, nm_medico_receita, dt_semana_atendimento, dt_mes_atendimento, nr_seq_receita_amb, dt_periodo_inicial, dt_entrega_medicacao, nr_seq, cd_estab_atual, ds_estab_atual) AS select	distinct
	a.nr_atendimento nr_atendimento, 
	a.nr_seq_classificacao nr_classificacao, 
	a.cd_pessoa_fisica, 
	a.cd_estabelecimento, 
	a.cd_medico_resp cd_medico_atend, 
	a.ie_clinica ie_clinica, 
	a.ie_tipo_atendimento ie_tipo_atendimento, 
	a.nm_usuario_atend, 
	a.dt_entrada, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='00' THEN 1  ELSE 0 END  hr00, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='01' THEN 1  ELSE 0 END  hr01, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='02' THEN 1  ELSE 0 END  hr02, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='03' THEN 1  ELSE 0 END  hr03, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='04' THEN 1  ELSE 0 END  hr04, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='05' THEN 1  ELSE 0 END  hr05, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='06' THEN 1  ELSE 0 END  hr06, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='07' THEN 1  ELSE 0 END  hr07, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='08' THEN 1  ELSE 0 END  hr08, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='09' THEN 1  ELSE 0 END  hr09, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='10' THEN 1  ELSE 0 END  hr10, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='11' THEN 1  ELSE 0 END  hr11, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='12' THEN 1  ELSE 0 END  hr12, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='13' THEN 1  ELSE 0 END  hr13, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='14' THEN 1  ELSE 0 END  hr14, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='15' THEN 1  ELSE 0 END  hr15, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='16' THEN 1  ELSE 0 END  hr16, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='17' THEN 1  ELSE 0 END  hr17, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='18' THEN 1  ELSE 0 END  hr18, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='19' THEN 1  ELSE 0 END  hr19, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='20' THEN 1  ELSE 0 END  hr20, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='21' THEN 1  ELSE 0 END  hr21, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='22' THEN 1  ELSE 0 END  hr22, 
	CASE WHEN to_char(a.dt_entrada,'hh24')='23' THEN 1  ELSE 0 END  hr23,	 
	g.cd_medico cd_medico_receita, 
	substr(obter_nome_clinica(a.ie_clinica),1,100) ds_clinica, 
	substr(obter_sexo_pf(a.cd_pessoa_fisica, 'D'),1,15) ds_sexo, 
	substr(obter_nome_pf(a.cd_pessoa_fisica),1,100) nm_pessoa_fisica, 
	substr(obter_compl_pf(a.cd_pessoa_fisica, 1, 'B'),1,100) ds_bairro, 
	substr(obter_nome_medico(a.cd_medico_resp,'N'),1,100) nm_medico_atend, 
	substr(obter_dados_pf(a.cd_pessoa_fisica, 'GI'),1,50) ds_escolaridade, 
	substr(obter_idade_pf(a.cd_pessoa_fisica,LOCALTIMESTAMP,'A'),1,3) ds_idade_pf, 
	substr(obter_faixa_etaria_pf(a.cd_pessoa_fisica),1,10) ds_faixa_etaria, 
	substr(obter_compl_pf(a.cd_pessoa_fisica, 1, 'CI'),1,100) ds_municipio, 
	substr(obter_especialidade_medico(g.cd_medico, null),1,10) cd_especialidade, 
	substr(obter_compl_pf(a.cd_pessoa_fisica, 1, 'DM'),1,100) ds_municipio_ibge, 
	substr(obter_classif_atendimento(a.nr_atendimento),1,10) nr_class_atendimento, 
	substr(obter_nome_tipo_atend(a.ie_tipo_atendimento),1,100) ds_tipo_atendimento, 
	substr(obter_desc_classif_atend(a.nr_seq_classificacao),1,100) ds_classificacao, 
	substr(obter_nome_estabelecimento(a.cd_estabelecimento),1,200) ds_estabelecimento, 
	substr(obter_especialidade_medico(a.cd_medico_resp,'D'),1,200) ds_especialidade_medico, 
	substr(obter_valor_dominio(5,obter_dados_pf(a.cd_pessoa_fisica, 'EC')),1,100) ds_estado_civil, 
	substr(fa_obter_hr_min_entrada_atend(a.dt_entrada,'HR','HR'),1,30) ds_hora_recep, 
	substr(fa_obter_hr_min_entrada_atend(a.dt_entrada,'RH','HR'),1,30) ds_label_recep,	 
	substr(fa_obter_hr_min_entrada_atend(a.dt_entrada,'DS', null),1,30) ds_interv_15_min, 
	substr(fa_obter_hr_min_entrada_atend(a.dt_entrada,'I15',null),1,1) i15, 
	substr(fa_obter_hr_min_entrada_atend(a.dt_entrada,'I30',null),1,1) i30, 
	substr(fa_obter_hr_min_entrada_atend(a.dt_entrada,'I45',null),1,1) i45, 
	substr(fa_obter_hr_min_entrada_atend(a.dt_entrada,'I60',null),1,1) i60, 
	substr(fa_obter_hr_min_entrada_atend(fa_obter_dado_paciente_entrega(null,a.cd_pessoa_fisica,'DT'),'HR','HR'),1,30) ds_hora_triagem, 
	substr(fa_obter_hr_min_entrada_atend(fa_obter_dado_paciente_entrega(null,a.cd_pessoa_fisica,'DT'),'TH','HR'),1,30) ds_label_triagem, 
	substr(fa_obter_hr_min_entrada_atend(fa_obter_dado_paciente_entrega(null,a.cd_pessoa_fisica,'DT'),'DS', null),1,30) ds_interv_15_min_triagem, 
	substr(fa_obter_hr_min_entrada_atend(fa_obter_dado_paciente_entrega(null,a.cd_pessoa_fisica,'DT'),'I15',null),1,1) t15, 
	substr(fa_obter_hr_min_entrada_atend(fa_obter_dado_paciente_entrega(null,a.cd_pessoa_fisica,'DT'),'I30',null),1,1) t30, 
	substr(fa_obter_hr_min_entrada_atend(fa_obter_dado_paciente_entrega(null,a.cd_pessoa_fisica,'DT'),'I45',null),1,1) t45, 
	substr(fa_obter_hr_min_entrada_atend(fa_obter_dado_paciente_entrega(null,a.cd_pessoa_fisica,'DT'),'I60',null),1,1) t60, 
	substr(fa_obter_dado_indicador_atendi(a.nr_atendimento,'ACC','CONV'),1,5) cd_convenio, 
	substr(fa_obter_dado_indicador_atendi(a.nr_atendimento,'ACC','NMCONV'),1,150) nm_convenio, 
	substr(fa_obter_dado_indicador_atendi(a.nr_atendimento,'APU','CD'),1,150) cd_setor_atendimento, 
	substr(fa_obter_dado_indicador_atendi(a.nr_atendimento,'APU','NM'),1,150) nm_setor_atendimento, 
	substr(fa_obter_dado_paciente_entrega(null,a.cd_pessoa_fisica,'ENTREGA'),1,100) ds_status_entrega, 
	substr(fa_obter_dado_paciente_entrega(null,a.cd_pessoa_fisica,'PMC'),1,100) ds_entrega_pmc, 
	CASE WHEN fa_obter_dado_paciente_entrega(null,a.cd_pessoa_fisica,'PMC')='S' THEN 'PMC' WHEN fa_obter_dado_paciente_entrega(null,a.cd_pessoa_fisica,'PMC')='N' THEN 'Normal' END  ds_PMC, 
	substr(fa_obter_dado_paciente_entrega(null,a.cd_pessoa_fisica,'IE_ENT'),1,2) ie_status_entrega,	 
	substr(obter_nome_medico(g.cd_medico, 'N'),1,100) nm_medico_receita, 
	substr(obter_dia_semana(LOCALTIMESTAMP),1,30) dt_semana_atendimento, 
	to_char(LOCALTIMESTAMP, 'Month') dt_mes_atendimento, 
	f.nr_seq_receita_amb, 
	f.dt_periodo_inicial, 
	f.dt_entrega_medicacao, 
	1 nr_seq, 
	somente_numero(wheb_usuario_pck.get_cd_estabelecimento) cd_estab_atual, 
	substr(obter_nome_estabelecimento(somente_numero(wheb_usuario_pck.get_cd_estabelecimento)),1,200) ds_estab_atual 
FROM	fa_receita_farmacia g, 
	fa_entrega_medicacao f, 
	fa_entrega_medicacao_item e, 
	atendimento_paciente a, 
	fa_paciente_entrega p 
where	a.nr_atendimento = p.nr_atendimento 
and	f.nr_seq_paciente_entrega = p.nr_sequencia    
and	f.nr_seq_receita_amb = g.nr_sequencia 
and	e.nr_seq_fa_entrega = f.nr_sequencia 
order by	nm_pessoa_fisica, 1;

