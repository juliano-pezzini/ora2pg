-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW scs_tre_painel_satisfacao_v (vl_media, ds_instrutor) AS select (sum(B.qt_resultado)/Count(B.nr_seq_pesquisa))/2 vl_media,
          OBTER_RESULT_SAC(B.nr_seq_pesquisa, 18054) ds_instrutor
          --OBTER_RESULT_SAC(b.nr_seq_pesquisa, 8629) ds_instrutor
FROM     SAC_PESQUISA A,
         SAC_PESQUISA_RESULT B,
         MED_ITEM_AVALIAR c
where    B.NR_SEQ_PESQUISA =  A.NR_SEQUENCIA
AND      B.NR_SEQ_ITEM = c.NR_SEQUENCIA
AND      A.NR_SEQ_TIPO_AVALIACAO=1495
and       B.nr_seq_item in (18056,18057,18058,18059,8635,18061,18062,18063,18064,18065)
--AND      A.NR_SEQ_TIPO_AVALIACAO=1035
--and b.nr_seq_item in (8631,8632,8633,8634,8635,8636,8637,8638,8639)
and  Trunc(dt_avaliacao,'month') = Trunc(LOCALTIMESTAMP,'month')
AND B.qt_resultado IS NOT null
GROUP BY  OBTER_RESULT_SAC(B.nr_seq_pesquisa, 18054)
          --OBTER_RESULT_SAC(b.nr_seq_pesquisa, 8629)
;

