-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW algorithms_wchart_v (ie_algoritmo, nr_atendimento, fld_nm_second_col_content, fld_nm_second_col_sub_info, fld_nm_chart_tooltip, fld_nm_chart_first_val, fld_nm_chart_seccond_val, fld_nm_third_col_content, fld_nm_first_col_content, fld_nm_sub_content, nr_delta_view, base_table_name, field_nr_pontuacao, field_dt_pontuacao) AS select ie_algoritmo,
       nr_atendimento,
       fld_nm_second_col_content,
       fld_nm_second_col_sub_info,
       fld_nm_chart_tooltip,
       fld_nm_chart_first_val,
       fld_nm_chart_seccond_val,
       fld_nm_third_col_content,
       fld_nm_first_col_content,
       fld_nm_sub_content,
       nr_delta_view,
       base_table_name,
       field_nr_pontuacao,
       field_dt_pontuacao
  FROM (select 1 ie_algoritmo,
               nr_atendimento,
               fld_nm_second_col_content,
               fld_nm_second_col_sub_info,
               to_char(fld_nm_chart_tooltip) fld_nm_chart_tooltip,
               fld_nm_chart_first_val,
               fld_nm_chart_seccond_val,
               fld_nm_third_col_content,
               fld_nm_first_col_content,
               fld_nm_sub_content,
               nr_delta_view,
               'automated_acuity' base_table_name,
               'nr_pontuacao' field_nr_pontuacao,
               'dt_pontuacao' field_dt_pontuacao
          from (
                 select c.nr_atendimento,
                        d.fld_nm_second_col_content,
                        d.fld_nm_second_col_sub_info,
                        d.fld_nm_chart_first_val || ' - ' || d.fld_nm_chart_seccond_val fld_nm_chart_tooltip,
                        d.fld_nm_chart_first_val,
                        d.fld_nm_chart_seccond_val,
                        d.fld_nm_third_col_content,
                        d.fld_nm_first_col_content,
                        d.fld_nm_sub_content,
                        d.nr_delta_view
                   from ( select b.nr_atendimento
                            from automated_acuity b
                           group by b.nr_atendimento
                        ) c,
                        (
                          select a.nr_sequencia,
                                 a.nr_atendimento,
                                 null fld_nm_first_col_content,
                                 substr(obter_desc_expressao_idioma(1032411,null,wheb_usuario_pck.get_nr_seq_idioma),1,255) fld_nm_second_col_content,
                                 suep_algorithms_severidade_aa(coalesce((select max(o.ie_sobrescrever) IE_SOBRESCREVER
                                                                      from automated_acuity_override o 
                                                                     where o.nr_atendimento = a.nr_atendimento 
                                                                       and o.ie_sobrescrever='S'), a.ie_tipo_cuidado),2) fld_nm_second_col_sub_info,
                                 obter_pontuacao_telehealth(a.nr_atendimento, 'automated_acuity', 'nr_media', 'dt_pontuacao', 2) fld_nm_chart_first_val,
                                 obter_pontuacao_telehealth(a.nr_atendimento, 'automated_acuity', 'nr_media', 'dt_pontuacao', 1) fld_nm_chart_seccond_val,
                                 coalesce(to_char(obter_pontuacao_telehealth(a.nr_atendimento, 'automated_acuity', 'nr_pontuacao', 'dt_pontuacao', 1)), '--') fld_nm_third_col_content,
                                 a.dt_pontuacao,
                                 suep_algorithms_severidade_aa(coalesce((select max(o.ie_sobrescrever) IE_SOBRESCREVER 
                                                                      from automated_acuity_override o
                                                                     where o.nr_atendimento = a.nr_atendimento
                                                                       and o.ie_sobrescrever='S'), a.ie_tipo_cuidado),1) fld_nm_sub_content,
                                 get_recent_delta_telehealth(a.nr_atendimento, 'automated_acuity', 'nr_delta') nr_delta_view
                            from automated_acuity a
                        ) d
                  where c.nr_atendimento = d.nr_atendimento
                    and d.dt_pontuacao   = (select max(b.dt_pontuacao)
                                              from automated_acuity b
                                             where b.nr_atendimento = c.nr_atendimento)
                    and d.nr_sequencia   = (select max(b.nr_sequencia)
                                              from automated_acuity b
                                             where b.dt_pontuacao   = d.dt_pontuacao
                                               and b.nr_atendimento = d.nr_atendimento)
               ) alias23
        
union all

        select 2 ie_algoritmo,
               nr_atendimento,
               fld_nm_second_col_content,
               fld_nm_second_col_sub_info,
               to_char(fld_nm_chart_tooltip),
               fld_nm_chart_first_val,
               fld_nm_chart_seccond_val,
               fld_nm_third_col_content,
               fld_nm_first_col_content,
               fld_nm_sub_content,
               nr_delta_view,
               'early_warning' base_table_name,
               'nr_pontuacao' field_nr_pontuacao,
               'dt_pontuacao' field_dt_pontuacao
          from (
                  select c.nr_atendimento,
                         d.fld_nm_second_col_content,
                         d.fld_nm_second_col_sub_info,
                         d.fld_nm_chart_first_val || ' - ' || d.fld_nm_chart_seccond_val fld_nm_chart_tooltip,
                         d.fld_nm_chart_first_val,
                         d.fld_nm_chart_seccond_val,
                         d.fld_nm_third_col_content,
                         d.fld_nm_first_col_content,
                         d.fld_nm_sub_content,
                         d.nr_delta_view
                    from (select b.nr_atendimento 
                            from early_warning b 
                           group by b.nr_atendimento
                         ) c,
                         ( select a.nr_sequencia,
                                  a.nr_atendimento,
                                  null fld_nm_first_col_content,
                                  substr(obter_desc_expressao_idioma(1029288,null,wheb_usuario_pck.get_nr_seq_idioma),1,255) fld_nm_second_col_content,
                                  suep_algorithms_severidade_ews(a.ie_severidade,2) fld_nm_second_col_sub_info,
                                  obter_pontuacao_telehealth(a.nr_atendimento, 'early_warning', 'nr_media', 'dt_pontuacao', 2) fld_nm_chart_first_val,
                                  obter_pontuacao_telehealth(a.nr_atendimento, 'early_warning', 'nr_media', 'dt_pontuacao', 1) fld_nm_chart_seccond_val,
                                  coalesce(to_char(obter_pontuacao_telehealth(a.nr_atendimento, 'early_warning', 'nr_pontuacao', 'dt_pontuacao', 1)), '--') fld_nm_third_col_content,
                                  a.dt_pontuacao,
                                  suep_algorithms_severidade_ews(a.ie_severidade,1) fld_nm_sub_content,
                                  get_recent_delta_telehealth(a.nr_atendimento, 'early_warning', 'nr_delta') nr_delta_view
                             from early_warning a
                         ) d
                   where c.nr_atendimento = d.nr_atendimento
                     and d.dt_pontuacao   = (select max(b.dt_pontuacao)
                                               from early_warning b
                                              where b.nr_atendimento = c.nr_atendimento)
                     and d.nr_sequencia   = (select max(b.nr_sequencia)
                                               from early_warning b
                                              where b.dt_pontuacao   = d.dt_pontuacao
                                                and b.nr_atendimento = d.nr_atendimento)
               ) alias41
        
union all

        select 3 ie_algoritmo,
               nr_atendimento,
               fld_nm_second_col_content,
               fld_nm_second_col_sub_info,
               to_char(fld_nm_chart_tooltip),
               fld_nm_chart_first_val,
               fld_nm_chart_seccond_val,
               fld_nm_third_col_content,
               fld_nm_first_col_content,
               fld_nm_sub_content,
               null nr_delta_view,
               'risk_of_death' base_table_name,
               'nr_pontuacao' field_nr_pontuacao,
               'dt_pontuacao' field_dt_pontuacao
          from ( select c.nr_atendimento,
                        d.fld_nm_first_col_content,
                        d.fld_nm_second_col_sub_info,
                        trim(both to_char(d.fld_nm_chart_first_val, '990.99')) || ' - ' || trim(both to_char(d.fld_nm_chart_seccond_val, '990.99')) fld_nm_chart_tooltip,
                        d.fld_nm_chart_first_val,
                        d.fld_nm_chart_seccond_val,
                        d.fld_nm_third_col_content,
                        d.fld_nm_second_col_content,
                        d.fld_nm_sub_content
                   from (select b.nr_atendimento
                           from risk_of_death b
                          group by b.nr_atendimento
                        ) c,
                        ( select a.nr_sequencia,
                                 a.nr_atendimento,
                                 substr(obter_desc_expressao_idioma(1032413,null,wheb_usuario_pck.get_nr_seq_idioma),1,255) fld_nm_second_col_content,
                                 substr(get_drs_category_info(a.ie_categoria, 'T'), 1, 50) fld_nm_second_col_sub_info,
                                 coalesce(trim(both to_char(obter_pontuacao_telehealth(a.nr_atendimento, 'risk_of_death', 'nr_pontuacao', 'dt_pontuacao', 1), '990.99')), '--') fld_nm_third_col_content,
                                 a.dt_pontuacao,
                                 null fld_nm_first_col_content,
                                 obter_pontuacao_telehealth(a.nr_atendimento, 'risk_of_death', 'nr_pontuacao_min', 'dt_pontuacao', 1) fld_nm_chart_first_val,
                                 obter_pontuacao_telehealth(a.nr_atendimento, 'risk_of_death', 'nr_pontuacao_max', 'dt_pontuacao', 1) fld_nm_chart_seccond_val,
                                 substr(get_drs_category_info(a.ie_categoria, 'C'), 1, 50) fld_nm_sub_content
                            from risk_of_death a
                        ) d
                  where c.nr_atendimento = d.nr_atendimento
                    and d.dt_pontuacao   = (select max(b.dt_pontuacao)
                                              from risk_of_death b
                                             where b.nr_atendimento = c.nr_atendimento)
                    and d.nr_sequencia   = (select max(b.nr_sequencia)
                                              from risk_of_death b
                                             where b.dt_pontuacao   = d.dt_pontuacao)
               ) alias65
        
union all

        select 4 ie_algoritmo,
               nr_atendimento,
               fld_nm_second_col_content,
               fld_nm_second_col_sub_info,
               to_char(fld_nm_chart_tooltip),
               fld_nm_chart_first_val,
               fld_nm_chart_seccond_val,
               fld_nm_third_col_content,
               fld_nm_first_col_content,
               fld_nm_sub_content,
               nr_delta_view,
               'escala_pews' base_table_name,
               'qt_pontuacao' field_nr_pontuacao,
               'dt_avaliacao' field_dt_pontuacao
          from ( select c.nr_atendimento,
                        d.fld_nm_first_col_content,
                        d.fld_nm_second_col_sub_info,
                        d.fld_nm_chart_first_val || ' - ' || d.fld_nm_chart_seccond_val fld_nm_chart_tooltip,
                        d.fld_nm_chart_first_val,
                        d.fld_nm_chart_seccond_val,
                        coalesce(to_char(d.fld_nm_chart_seccond_val), '--') fld_nm_third_col_content,
                        d.fld_nm_second_col_content,
                        suep_severidade_pews(d.fld_nm_chart_seccond_val) fld_nm_sub_content,
                        d.fld_nm_chart_seccond_val - d.fld_nm_chart_first_val nr_delta_view
                  from ( select b.nr_atendimento 
                           from escala_pews b
                          group by b.nr_atendimento
                       ) c,
                       ( select a.nr_sequencia,
                                a.nr_atendimento,
                                substr(obter_desc_expressao_idioma(314055, null, wheb_usuario_pck.get_nr_seq_idioma), 1, 255) fld_nm_second_col_content,
                                null fld_nm_second_col_sub_info,
                                obter_pontuacao_telehealth(a.nr_atendimento, 'escala_pews', 'qt_pontuacao', 'dt_avaliacao', 2) fld_nm_chart_first_val,
                                obter_pontuacao_telehealth(a.nr_atendimento, 'escala_pews', 'qt_pontuacao', 'dt_avaliacao', 1) fld_nm_chart_seccond_val,
                                a.qt_pontuacao,
                                null fld_nm_first_col_content,
                                a.dt_avaliacao
                           from escala_pews a
                          where a.dt_liberacao is not null
                            and a.dt_inativacao is null
                       ) d
                 where c.nr_atendimento = d.nr_atendimento
                   and d.qt_pontuacao = ( select max(b.qt_pontuacao) 
                                            from escala_pews b
                                           where b.nr_atendimento = c.nr_atendimento
                                             and b.dt_liberacao is not null
                                             and b.dt_inativacao is null)
                   and d.nr_sequencia = ( select max(b.nr_sequencia)
                                            from escala_pews b
                                           where b.qt_pontuacao = d.qt_pontuacao
                                             and b.dt_liberacao is not null
                                             and b.dt_inativacao is null)
               ) alias80
        
union all

        select 5 ie_algoritmo,
               nr_atendimento,
               fld_nm_second_col_content,
               fld_nm_second_col_sub_info,
               to_char(fld_nm_chart_tooltip),
               fld_nm_chart_first_val,
               fld_nm_chart_seccond_val,
               to_char(fld_nm_third_col_content),
               fld_nm_first_col_content,
               fld_nm_sub_content,
               nr_delta_view,
               'escala_saps' base_table_name,
               'qt_saps' field_nr_pontuacao,
               'dt_avaliacao' field_dt_pontuacao
          from ( select c.nr_atendimento,
                        d.nr_sequencia,
                        d.fld_nm_first_col_content,
                        d.fld_nm_second_col_sub_info,
                        d.fld_nm_chart_first_val || ' - ' || d.fld_nm_chart_seccond_val fld_nm_chart_tooltip,
                        d.fld_nm_chart_first_val,
                        d.fld_nm_chart_seccond_val,
                        coalesce(to_char(d.fld_nm_chart_seccond_val), '--') fld_nm_third_col_content,
                        d.fld_nm_second_col_content,
                        suep_severidade_saps(d.fld_nm_chart_seccond_val) fld_nm_sub_content,
                        d.fld_nm_chart_seccond_val - d.fld_nm_chart_first_val nr_delta_view
                   from ( select b.nr_atendimento
                            from escala_saps b
                           group by b.nr_atendimento
                        ) c,
                        ( select a.nr_sequencia,
                                 a.nr_atendimento,
                                 substr(obter_desc_expressao_idioma(1017725 , null, wheb_usuario_pck.get_nr_seq_idioma), 1, 255) fld_nm_second_col_content,
                                 null fld_nm_second_col_sub_info,
                                 obter_pontuacao_telehealth(a.nr_atendimento, 'escala_saps', 'qt_saps', 'dt_avaliacao', 2) fld_nm_chart_first_val,
                                 obter_pontuacao_telehealth(a.nr_atendimento, 'escala_saps', 'qt_saps', 'dt_avaliacao', 1) fld_nm_chart_seccond_val,
                                 a.qt_saps,
                                 null fld_nm_first_col_content
                            from escala_saps a
                           where a.dt_liberacao is not null
                             and a.dt_inativacao is null
                        ) d
                  where c.nr_atendimento = d.nr_atendimento
                    and d.qt_saps = ( select max(b.qt_saps)
                                        from escala_saps b
                                       where b.nr_atendimento = c.nr_atendimento
                                         and b.dt_liberacao is not null
                                         and b.dt_inativacao is null)
                    and d.nr_sequencia = ( select max(b.nr_sequencia)
                                             from escala_saps b
                                            where b.qt_saps = d.qt_saps
                                              and b.dt_liberacao is not null
                                              and b.dt_inativacao is null)
               ) alias96
        
union all

        select 6 ie_algoritmo,
               nr_atendimento,
               fld_nm_second_col_content,
               fld_nm_second_col_sub_info,
               to_char(fld_nm_chart_tooltip),
               fld_nm_chart_first_val,
               fld_nm_chart_seccond_val,
               to_char(fld_nm_third_col_content),
               fld_nm_first_col_content,
               null fld_nm_sub_content,
               nr_delta_view,
               'sepsis_qsofa' base_table_name,
               'nr_pontuacao' field_nr_pontuacao,
               'dt_pontuacao' field_dt_pontuacao
          from ( select c.nr_atendimento,
                        d.nr_sequencia,
                        d.fld_nm_first_col_content,
                        d.fld_nm_second_col_sub_info,
                        d.fld_nm_second_col_content,
                        null fld_nm_sub_content,
                        d.fld_nm_chart_first_val || ' - ' || d.fld_nm_chart_seccond_val fld_nm_chart_tooltip,
                        d.fld_nm_chart_first_val,
                        d.fld_nm_chart_seccond_val,
                        coalesce(to_char(d.fld_nm_chart_seccond_val), '--') fld_nm_third_col_content,
                        d.fld_nm_chart_seccond_val - d.fld_nm_chart_first_val nr_delta_view
                   from ( select b.nr_atendimento
                            from sepsis_qsofa b
                           group by b.nr_atendimento
                        ) c,
                        ( select a.nr_sequencia,
                                 a.nr_atendimento,
                                 substr(obter_desc_expressao_idioma(1038996 , null, wheb_usuario_pck.get_nr_seq_idioma), 1, 255) fld_nm_second_col_content,
                                 null fld_nm_second_col_sub_info,
                                 obter_pontuacao_telehealth(a.nr_atendimento, 'sepsis_qsofa', 'nr_pontuacao', 'dt_pontuacao', 2) fld_nm_chart_first_val,
                                 obter_pontuacao_telehealth(a.nr_atendimento, 'sepsis_qsofa', 'nr_pontuacao', 'dt_pontuacao', 1) fld_nm_chart_seccond_val,
                                 a.nr_pontuacao,
                                 null fld_nm_first_col_content
                            from sepsis_qsofa a
                        ) d
                  where c.nr_atendimento = d.nr_atendimento
                    and d.nr_sequencia = (select max(b.nr_sequencia)
                                            from sepsis_qsofa b
                                           where b.nr_atendimento = d.nr_atendimento)
               ) alias109
        
union all

        select 6 ie_algoritmo,
               nr_atendimento,
               fld_nm_second_col_content,
               fld_nm_second_col_sub_info,
               to_char(fld_nm_chart_tooltip),
               fld_nm_chart_first_val,
               fld_nm_chart_seccond_val,
               to_char(fld_nm_third_col_content),
               fld_nm_first_col_content,
               null fld_nm_sub_content,
               nr_delta_view,
               'sepsis_sirs' base_table_name,
               'nr_pontuacao' field_nr_pontuacao,
               'dt_pontuacao' field_dt_pontuacao
          from ( select c.nr_atendimento,
                        d.nr_sequencia,
                        d.fld_nm_first_col_content,
                        d.fld_nm_second_col_sub_info,
                        d.fld_nm_second_col_content,
                        null fld_nm_sub_content,
                        d.fld_nm_chart_first_val || ' - ' || d.fld_nm_chart_seccond_val fld_nm_chart_tooltip,
                        d.fld_nm_chart_first_val,
                        d.fld_nm_chart_seccond_val,
                        coalesce(to_char(d.fld_nm_chart_seccond_val), '--') fld_nm_third_col_content,
                        d.fld_nm_chart_seccond_val - d.fld_nm_chart_first_val nr_delta_view
                   from ( select b.nr_atendimento
                            from sepsis_sirs b
                           group by b.nr_atendimento
                        ) c,
                        ( select a.nr_sequencia,
                                 a.nr_atendimento,
                                 substr(obter_desc_expressao_idioma(1038999 , null, wheb_usuario_pck.get_nr_seq_idioma), 1, 255) fld_nm_second_col_content,
                                 null fld_nm_second_col_sub_info,
                                 obter_pontuacao_telehealth(a.nr_atendimento, 'sepsis_sirs', 'nr_pontuacao', 'dt_pontuacao', 2)fld_nm_chart_first_val,
                                 obter_pontuacao_telehealth(a.nr_atendimento, 'sepsis_sirs', 'nr_pontuacao', 'dt_pontuacao', 1) fld_nm_chart_seccond_val,
                                 a.nr_pontuacao,
                                 null fld_nm_first_col_content
                            from sepsis_sirs a
                        ) d
                  where c.nr_atendimento = d.nr_atendimento
                    and d.nr_sequencia = ( select max(b.nr_sequencia)
                                             from sepsis_sirs b
                                            where b.nr_atendimento = d.nr_atendimento)
               ) alias122
        
union all

        select 6 ie_algoritmo,
               nr_atendimento,
               fld_nm_second_col_content,
               fld_nm_second_col_sub_info,
               to_char(fld_nm_chart_tooltip),
               fld_nm_chart_first_val,
               fld_nm_chart_seccond_val,
               to_char(fld_nm_third_col_content),
               fld_nm_first_col_content,
               null fld_nm_sub_content,
               nr_delta_view,
               'sepsis_antimicrobial' base_table_name,
               'nr_pontuacao' field_nr_pontuacao,
               'dt_pontuacao' field_dt_pontuacao
          from ( select c.nr_atendimento,
                        d.nr_sequencia,
                        d.fld_nm_first_col_content,
                        d.fld_nm_second_col_sub_info,
                        d.fld_nm_second_col_content,
                        null fld_nm_sub_content,
                        d.fld_nm_chart_first_val || ' - ' || d.fld_nm_chart_seccond_val fld_nm_chart_tooltip,
                        d.fld_nm_chart_first_val,
                        d.fld_nm_chart_seccond_val,
                        coalesce(to_char(d.fld_nm_chart_seccond_val), '--') fld_nm_third_col_content,
                        d.fld_nm_chart_seccond_val - d.fld_nm_chart_first_val nr_delta_view
                   from ( select b.nr_atendimento
                            from sepsis_antimicrobial b
                           group by b.nr_atendimento
                        ) c,
                        ( select a.nr_sequencia,
                                 a.nr_atendimento,
                                 substr(obter_desc_expressao_idioma(1039001 , null, wheb_usuario_pck.get_nr_seq_idioma), 1, 255) fld_nm_second_col_content,
                                 null fld_nm_second_col_sub_info,
                                 obter_pontuacao_telehealth(a.nr_atendimento, 'sepsis_antimicrobial', 'nr_pontuacao', 'dt_pontuacao', 2) fld_nm_chart_first_val,
                                 obter_pontuacao_telehealth(a.nr_atendimento, 'sepsis_antimicrobial', 'nr_pontuacao', 'dt_pontuacao', 1) fld_nm_chart_seccond_val,
                                 a.nr_pontuacao,
                                 null fld_nm_first_col_content
                            from sepsis_antimicrobial a
                        ) d
                  where c.nr_atendimento = d.nr_atendimento
                    and d.nr_sequencia = (select max(b.nr_sequencia) from sepsis_antimicrobial b where b.nr_atendimento = d.nr_atendimento)
               ) alias135
        
union all

        select 6 ie_algoritmo,
               nr_atendimento,
               fld_nm_second_col_content,
               fld_nm_second_col_sub_info,
               to_char(fld_nm_chart_tooltip),
               fld_nm_chart_first_val,
               fld_nm_chart_seccond_val,
               to_char(fld_nm_third_col_content),
               fld_nm_first_col_content,
               null fld_nm_sub_content,
               nr_delta_view,
               'sepsis_culture' base_table_name,
               'nr_pontuacao' field_nr_pontuacao,
               'dt_pontuacao' field_dt_pontuacao
          from ( select c.nr_atendimento,
                        d.nr_sequencia,
                        d.fld_nm_first_col_content,
                        d.fld_nm_second_col_sub_info,
                        d.fld_nm_second_col_content,
                        null fld_nm_sub_content,
                        d.fld_nm_chart_first_val || ' - ' || d.fld_nm_chart_seccond_val fld_nm_chart_tooltip,
                        d.fld_nm_chart_first_val,
                        d.fld_nm_chart_seccond_val,
                        coalesce(to_char(d.fld_nm_chart_seccond_val), '--') fld_nm_third_col_content,
                        d.fld_nm_chart_seccond_val - d.fld_nm_chart_first_val nr_delta_view
                   from ( select b.nr_atendimento
                            from sepsis_culture b
                           group by b.nr_atendimento
                        ) c,
                        ( select a.nr_sequencia,
                                 a.nr_atendimento,
                                 substr(obter_desc_expressao_idioma(1039003 , null, wheb_usuario_pck.get_nr_seq_idioma), 1, 255) fld_nm_second_col_content,
                                 null fld_nm_second_col_sub_info,
                                 obter_pontuacao_telehealth(a.nr_atendimento, 'sepsis_culture', 'nr_pontuacao', 'dt_pontuacao', 2) fld_nm_chart_first_val,
                                 obter_pontuacao_telehealth(a.nr_atendimento, 'sepsis_culture', 'nr_pontuacao', 'dt_pontuacao', 1) fld_nm_chart_seccond_val,
                                 a.nr_pontuacao,
                                 null fld_nm_first_col_content
                            from sepsis_culture a
                        ) d
                  where c.nr_atendimento = d.nr_atendimento
                    and d.nr_sequencia = ( select max(b.nr_sequencia)
                                             from sepsis_culture b
                                            where b.nr_atendimento = d.nr_atendimento)
               ) alias148
        
union all

        select 6 ie_algoritmo,
               nr_atendimento,
               fld_nm_second_col_content,
               fld_nm_second_col_sub_info,
               to_char(fld_nm_chart_tooltip),
               fld_nm_chart_first_val,
               fld_nm_chart_seccond_val,
               to_char(fld_nm_third_col_content),
               fld_nm_first_col_content,
               null fld_nm_sub_content,
               nr_delta_view,
               'sepsis_sofa' base_table_name,
               'nr_pontuacao' field_nr_pontuacao,
               'dt_pontuacao' field_dt_pontuacao
          from ( select c.nr_atendimento,
                        d.nr_sequencia,
                        d.fld_nm_first_col_content,
                        d.fld_nm_second_col_sub_info,
                        d.fld_nm_second_col_content,
                        null fld_nm_sub_content,
                        d.fld_nm_chart_first_val || ' - ' || d.fld_nm_chart_seccond_val fld_nm_chart_tooltip,
                        d.fld_nm_chart_first_val,
                        d.fld_nm_chart_seccond_val,
                        coalesce(to_char(d.fld_nm_chart_seccond_val), '--') fld_nm_third_col_content,
                        d.fld_nm_chart_seccond_val - d.fld_nm_chart_first_val nr_delta_view
                   from ( select b.nr_atendimento
                            from sepsis_sofa b
                           group by b.nr_atendimento
                        ) c,
                        ( select a.nr_sequencia,
                                 a.nr_atendimento,
                                 substr(obter_desc_expressao_idioma(1039005 , null, wheb_usuario_pck.get_nr_seq_idioma), 1, 255) fld_nm_second_col_content,
                                 null fld_nm_second_col_sub_info,
                                 obter_pontuacao_telehealth(a.nr_atendimento, 'sepsis_sofa', 'nr_pontuacao', 'dt_pontuacao', 2) fld_nm_chart_first_val,
                                 obter_pontuacao_telehealth(a.nr_atendimento, 'sepsis_sofa', 'nr_pontuacao', 'dt_pontuacao', 1) fld_nm_chart_seccond_val,
                                 a.nr_pontuacao,
                                 null fld_nm_first_col_content
                            from sepsis_sofa a
                        ) d
                  where c.nr_atendimento = d.nr_atendimento
                    and d.nr_sequencia = ( select max(b.nr_sequencia)
                                             from sepsis_sofa b
                                            where b.nr_atendimento = d.nr_atendimento)
               ) alias161
        
union all

        select 7 ie_algoritmo,
               nr_atendimento,
               fld_nm_second_col_content,
               fld_nm_second_col_sub_info,
               to_char(fld_nm_chart_tooltip),
               fld_nm_chart_first_val,
               fld_nm_chart_seccond_val,
               to_char(fld_nm_third_col_content),
               fld_nm_first_col_content,
               null fld_nm_sub_content,
               nr_delta_view,
               'apache' base_table_name,
               'qt_apache_ii' field_nr_pontuacao,
               'dt_apache' field_dt_pontuacao
          from ( select c.nr_atendimento,
                        d.fld_nm_first_col_content,
                        d.fld_nm_second_col_sub_info,
                        d.fld_nm_chart_first_val || ' - ' || d.fld_nm_chart_seccond_val fld_nm_chart_tooltip,
                        d.fld_nm_chart_first_val,
                        d.fld_nm_chart_seccond_val,
                        coalesce(to_char(d.fld_nm_chart_seccond_val), '--') fld_nm_third_col_content,
                        d.fld_nm_second_col_content,
                        suep_severidade_pews(d.fld_nm_chart_seccond_val) fld_nm_sub_content,
                        d.fld_nm_chart_seccond_val - d.fld_nm_chart_first_val nr_delta_view
                   from ( select b.nr_atendimento
                            from apache b
                           group by b.nr_atendimento
                        ) c,
                        ( select a.nr_sequencia,
                                 a.nr_atendimento,
                                 substr(obter_desc_expressao_idioma(283578, null, wheb_usuario_pck.get_nr_seq_idioma), 1, 255) fld_nm_second_col_content,
                                 null fld_nm_second_col_sub_info,
                                 obter_pontuacao_telehealth(a.nr_atendimento, 'apache', 'qt_apache_ii', 'dt_apache', 2) fld_nm_chart_first_val,
                                 obter_pontuacao_telehealth(a.nr_atendimento, 'apache', 'qt_apache_ii', 'dt_apache', 1) fld_nm_chart_seccond_val,
                                 a.qt_apache_ii,
                                 null fld_nm_first_col_content,
                                 a.dt_apache
                            from apache a
                           where a.dt_liberacao is not null
                             and a.dt_inativacao is null
                        ) d
                  where c.nr_atendimento = d.nr_atendimento
                    and d.qt_apache_ii = ( select max(b.qt_apache_ii)
                                             from apache b
                                            where b.nr_atendimento = c.nr_atendimento
                                              and b.dt_liberacao is not null
                                              and b.dt_inativacao is null)
                    and d.nr_sequencia = ( select max(b.nr_sequencia)
                                             from apache b
                                            where b.qt_apache_ii = d.qt_apache_ii
                                              and b.dt_liberacao is not null
                                              and b.dt_inativacao is null)
               ) alias177
        
union all

        select 8 ie_algoritmo,
               nr_atendimento,
               fld_nm_second_col_content,
               fld_nm_second_col_sub_info,
               to_char(fld_nm_chart_tooltip),
               fld_nm_chart_first_val,
               fld_nm_chart_seccond_val,
               to_char(fld_nm_third_col_content),
               fld_nm_first_col_content,
               null fld_nm_sub_content,
               nr_delta_view,
               'escala_mews' base_table_name,
               'qt_pontuacao' field_nr_pontuacao,
               'dt_avaliacao' field_dt_pontuacao
          from ( select c.nr_atendimento,
                        d.fld_nm_first_col_content,
                        d.fld_nm_second_col_sub_info,
                        d.fld_nm_chart_first_val || ' - ' || d.fld_nm_chart_seccond_val fld_nm_chart_tooltip,
                        d.fld_nm_chart_first_val,
                        d.fld_nm_chart_seccond_val,
                        coalesce(to_char(d.fld_nm_chart_seccond_val), '--') fld_nm_third_col_content,
                        d.fld_nm_second_col_content,
                        null fld_nm_sub_content,
                        d.fld_nm_chart_seccond_val - d.fld_nm_chart_first_val nr_delta_view
                   from ( select b.nr_atendimento
                            from escala_mews b
                           group by b.nr_atendimento
                        ) c,
                        ( select a.nr_sequencia,
                                 a.nr_atendimento,
                                 substr(obter_desc_expressao_idioma(313971, null, wheb_usuario_pck.get_nr_seq_idioma), 1, 255) fld_nm_second_col_content,
                                 null fld_nm_second_col_sub_info,
                                 obter_pontuacao_telehealth(a.nr_atendimento, 'escala_mews', 'qt_pontuacao', 'dt_avaliacao', 2) fld_nm_chart_first_val,
                                 obter_pontuacao_telehealth(a.nr_atendimento, 'escala_mews', 'qt_pontuacao', 'dt_avaliacao', 1) fld_nm_chart_seccond_val,
                                 a.qt_pontuacao,
                                 null fld_nm_first_col_content,
                                 a.dt_avaliacao
                            from escala_mews a
                           where a.dt_liberacao is not null
                             and a.dt_inativacao is null
                        ) d
                  where c.nr_atendimento = d.nr_atendimento
                    and d.qt_pontuacao = ( select max(b.qt_pontuacao)
                                             from escala_mews b
                                            where b.nr_atendimento = c.nr_atendimento
                                              and b.dt_liberacao is not null
                                              and b.dt_inativacao is null)
                    and d.nr_sequencia = ( select max(b.nr_sequencia)
                                             from escala_mews b
                                            where b.qt_pontuacao = d.qt_pontuacao
                                              and b.dt_liberacao is not null
                                              and b.dt_inativacao is null)
               ) alias192
        
union all

        select 9 ie_algoritmo,
               nr_atendimento,
               fld_nm_second_col_content,
               fld_nm_second_col_sub_info,
               to_char(fld_nm_chart_tooltip),
               fld_nm_chart_first_val,
               fld_nm_chart_seccond_val,
               to_char(fld_nm_third_col_content),
               fld_nm_first_col_content,
               null fld_nm_sub_content,
               nr_delta_view,
               'escala_eif' base_table_name,
               'qt_pontos' field_nr_pontuacao,
               'dt_avaliacao' field_dt_pontuacao
          from ( select c.nr_atendimento,
                        d.fld_nm_first_col_content,
                        d.fld_nm_second_col_sub_info,
                        d.fld_nm_chart_first_val || ' - ' || d.fld_nm_chart_seccond_val fld_nm_chart_tooltip,
                        d.fld_nm_chart_first_val,
                        d.fld_nm_chart_seccond_val,
                        coalesce(to_char(d.fld_nm_chart_seccond_val), '--') fld_nm_third_col_content,
                        d.fld_nm_second_col_content,
                        null fld_nm_sub_content,
                        d.fld_nm_chart_seccond_val - d.fld_nm_chart_first_val nr_delta_view
                   from ( select b.nr_atendimento
                            from escala_eif b
                           group by b.nr_atendimento
                        ) c,
                        ( select a.nr_sequencia,
                                 a.nr_atendimento,
                                 substr(obter_desc_expressao_idioma(313958, null, wheb_usuario_pck.get_nr_seq_idioma), 1, 255) fld_nm_second_col_content,
                                 null fld_nm_second_col_sub_info,
                                 obter_pontuacao_score_flex(a.nr_atendimento, 'escala_eif', 'qt_pontos', a.nr_sequencia, 'dt_avaliacao', 2) fld_nm_chart_first_val,
                                 obter_pontuacao_score_flex(a.nr_atendimento, 'escala_eif', 'qt_pontos', a.nr_sequencia, 'dt_avaliacao', 1) fld_nm_chart_seccond_val,
                                 obter_resultado_escala_eif(a.nr_sequencia, 'T') as qt_pontos_d,
                                 null fld_nm_first_col_content,
                                 a.dt_avaliacao
                            from escala_eif         a
                           where a.dt_liberacao is not null
                            and a.dt_inativacao is null
                        ) d
                  where c.nr_atendimento = d.nr_atendimento				  
				  and d.qt_pontos_d = (select max(obter_resultado_escala_eif(b.nr_sequencia, 'T'))
					from escala_eif b
					where b.nr_atendimento = c.nr_atendimento
					and b.dt_liberacao is not null
					and b.dt_inativacao is null)
				  and d.nr_sequencia = (select max(b.nr_sequencia)
					from escala_eif b
					where obter_resultado_escala_eif(b.nr_sequencia, 'T')= d.qt_pontos_d
					and b.dt_liberacao is not null
					and b.dt_inativacao is null)  
               ) alias210
        
union all

        select 10 ie_algoritmo,
               nr_atendimento,
               fld_nm_second_col_content,
               fld_nm_second_col_sub_info,
               to_char(fld_nm_chart_tooltip),
               fld_nm_chart_first_val,
               fld_nm_chart_seccond_val,
               to_char(fld_nm_third_col_content),
               fld_nm_first_col_content,
               null fld_nm_sub_content,
               nr_delta_view,
               'escala_eif_ii' base_table_name,
               'qt_pontos' field_nr_pontuacao,
               'dt_avaliacao' field_dt_pontuacao
          from ( select c.nr_atendimento,
                        d.fld_nm_first_col_content,
                        d.fld_nm_second_col_sub_info,
                        d.fld_nm_chart_first_val || ' - ' || d.fld_nm_chart_seccond_val fld_nm_chart_tooltip,
                        d.fld_nm_chart_first_val,
                        d.fld_nm_chart_seccond_val,
                        coalesce(to_char(d.fld_nm_chart_seccond_val), '--') fld_nm_third_col_content,
                        d.fld_nm_second_col_content,
                        null fld_nm_sub_content,
                        d.fld_nm_chart_seccond_val - d.fld_nm_chart_first_val nr_delta_view
                  from ( select b.nr_atendimento
                           from escala_eif_ii b
                           group by b.nr_atendimento
                       ) c,
                       ( select a.nr_sequencia,
                                a.nr_atendimento,
                                substr(obter_desc_expressao_idioma(313969, null, wheb_usuario_pck.get_nr_seq_idioma), 1, 255) fld_nm_second_col_content,
                                null fld_nm_second_col_sub_info,
                                obter_pontuacao_score_flex(a.nr_atendimento, 'escala_eif_ii', 'qt_pontos', a.nr_sequencia, 'dt_avaliacao', 2) fld_nm_chart_first_val,
                                obter_pontuacao_score_flex(a.nr_atendimento, 'escala_eif_ii', 'qt_pontos', a.nr_sequencia, 'dt_avaliacao', 1) fld_nm_chart_seccond_val,
                                a.qt_pontos,
                                null fld_nm_first_col_content,
                                a.dt_avaliacao
                           from escala_eif_ii a
                          where a.dt_liberacao is not null
                            and a.dt_inativacao is null
                       ) d
                 where c.nr_atendimento = d.nr_atendimento
                   and d.qt_pontos = ( select max(b.qt_pontos)
                                         from escala_eif_ii b
                                        where b.nr_atendimento = c.nr_atendimento
                                          and b.dt_liberacao is not null
                                          and b.dt_inativacao is null)
                   and d.nr_sequencia = ( select max(b.nr_sequencia)
                                            from escala_eif_ii b
                                           where b.qt_pontos = d.qt_pontos
                                             and b.dt_liberacao is not null
                                             and b.dt_inativacao is null)
               ) alias225
        
union all

        select 11 ie_algoritmo,
               nr_atendimento,
               fld_nm_second_col_content,
               fld_nm_second_col_sub_info,
               to_char(fld_nm_chart_tooltip),
               fld_nm_chart_first_val,
               fld_nm_chart_seccond_val,
               to_char(fld_nm_third_col_content),
               fld_nm_first_col_content,
               null fld_nm_sub_content,
               nr_delta_view,
               'escala_sofa' base_table_name,
               'qt_pontuacao' field_nr_pontuacao,
               'dt_avaliacao' field_dt_pontuacao
          from ( select c.nr_atendimento,
                        d.fld_nm_first_col_content,
                        d.fld_nm_second_col_sub_info,
                        d.fld_nm_chart_first_val || ' - ' || d.fld_nm_chart_seccond_val fld_nm_chart_tooltip,
                        d.fld_nm_chart_first_val,
                        d.fld_nm_chart_seccond_val,
                        coalesce(to_char(d.fld_nm_chart_seccond_val), '--') fld_nm_third_col_content,
                        d.fld_nm_second_col_content,
                        null fld_nm_sub_content,
                        d.fld_nm_chart_seccond_val - d.fld_nm_chart_first_val nr_delta_view
                  from ( select b.nr_atendimento
                           from escala_sofa b
                          group by b.nr_atendimento
              ) c,
              ( select a.nr_sequencia,
                       a.nr_atendimento,
                       substr(obter_desc_expressao_idioma(313997, null, wheb_usuario_pck.get_nr_seq_idioma), 1, 255) fld_nm_second_col_content,
                       null fld_nm_second_col_sub_info,
                       obter_pontuacao_telehealth(a.nr_atendimento, 'escala_sofa', 'qt_pontuacao', 'dt_avaliacao', 2) fld_nm_chart_first_val,
                       obter_pontuacao_telehealth(a.nr_atendimento, 'escala_sofa', 'qt_pontuacao', 'dt_avaliacao', 1) fld_nm_chart_seccond_val,
                       a.qt_pontuacao,
                       null fld_nm_first_col_content,
                       a.dt_avaliacao
                  from escala_sofa a
                 where a.dt_liberacao is not null
                   and a.dt_inativacao is null
              ) d
        where c.nr_atendimento = d.nr_atendimento
          and d.qt_pontuacao = ( select max(b.qt_pontuacao)
                                   from escala_sofa b
                                  where b.nr_atendimento = c.nr_atendimento
                                    and b.dt_liberacao is not null
                                    and b.dt_inativacao is null)
          and d.nr_sequencia = ( select max(b.nr_sequencia)
                                   from escala_sofa b
                                  where b.qt_pontuacao = d.qt_pontuacao
                                    and b.dt_liberacao is not null
                                    and b.dt_inativacao is null)
               ) alias240
          ) alias241
 order by ie_algoritmo;

