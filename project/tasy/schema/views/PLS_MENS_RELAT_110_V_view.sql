-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_mens_relat_110_v (qt_titular, qt_dependente, ds_plano, ds_tit_dep, qt_faixa, vl_mensalidade, nr_titulo) AS select	1 qt_titular,
	0 qt_dependente,
	e.ds_plano,
	'Titular' ds_tit_dep,
	pls_obter_faixa_etaria_benef(c.nr_sequencia,'D') qt_faixa,
	--nvl(d.vl_pre_estabelecido,0) + nvl(pls_obter_valor_item_mens(d.nr_sequencia,'5'),0) + nvl(pls_obter_valor_item_mens(d.nr_sequencia,'25'),0) + nvl(pls_obter_valor_item_mens(d.nr_sequencia,'31'),0) vl_mensalidade,
	coalesce(d.vl_pre_estabelecido,0) vl_mensalidade,
	a.nr_titulo
FROM	titulo_receber			a,
	pls_mensalidade			b,
	pls_segurado			c,
	pls_mensalidade_segurado	d,
	pls_plano			e
where	a.nr_seq_mensalidade		= b.nr_sequencia
and	d.nr_seq_mensalidade		= b.nr_sequencia
and	c.nr_seq_plano			= e.nr_sequencia
and	d.nr_seq_segurado		= c.nr_sequencia
and	c.nr_seq_titular is null

union all

select	0 qt_titular,
	1 qt_dependente,
	e.ds_plano,
	'Dependente' ds_tit_dep,
	pls_obter_faixa_etaria_benef(c.nr_sequencia,'D') qt_faixa,
	--nvl(d.vl_pre_estabelecido,0) + nvl(pls_obter_valor_item_mens(d.nr_sequencia,'5'),0) + nvl(pls_obter_valor_item_mens(d.nr_sequencia,'25'),0) + nvl(pls_obter_valor_item_mens(d.nr_sequencia,'31'),0) vl_mensalidade,
	coalesce(d.vl_pre_estabelecido,0) vl_mensalidade,
	a.nr_titulo
from	titulo_receber			a,
	pls_mensalidade			b,
	pls_segurado			c,
	pls_mensalidade_segurado	d,
	pls_plano			e,
	grau_parentesco			f
where	a.nr_seq_mensalidade		= b.nr_sequencia
and	d.nr_seq_mensalidade		= b.nr_sequencia
and	c.nr_seq_plano			= e.nr_sequencia
and	d.nr_seq_segurado		= c.nr_sequencia
and	c.nr_seq_parentesco		= f.nr_sequencia
and	f.IE_TIPO_PARENTESCO		= 1
and	c.nr_seq_titular is not null

union all

select	0 qt_titular,
	1 qt_dependente,
	e.ds_plano,
	'Agregados' ds_tit_dep,
	pls_obter_faixa_etaria_benef(c.nr_sequencia,'D') qt_faixa,
	--nvl(d.vl_pre_estabelecido,0) + nvl(pls_obter_valor_item_mens(d.nr_sequencia,'5'),0) + nvl(pls_obter_valor_item_mens(d.nr_sequencia,'25'),0) + nvl(pls_obter_valor_item_mens(d.nr_sequencia,'31'),0) vl_mensalidade,
	coalesce(d.vl_pre_estabelecido,0) vl_mensalidade,
	a.nr_titulo
from	titulo_receber			a,
	pls_mensalidade			b,
	pls_segurado			c,
	pls_mensalidade_segurado	d,
	pls_plano			e,
	grau_parentesco			f
where	a.nr_seq_mensalidade		= b.nr_sequencia
and	d.nr_seq_mensalidade		= b.nr_sequencia
and	c.nr_seq_plano			= e.nr_sequencia
and	d.nr_seq_segurado		= c.nr_sequencia
and	c.nr_seq_parentesco		= f.nr_sequencia
and	f.IE_TIPO_PARENTESCO		= 2
and	c.nr_seq_titular is not null

union all

select	1 qt_titular,
	0 qt_dependente,
	e.ds_plano,
	'BABR Titular' ds_tit_dep,
	pls_obter_faixa_etaria_benef(c.nr_sequencia,'D') qt_faixa,
	coalesce((select sum(x.vl_item) from pls_mensalidade_seg_item x where x.nr_seq_mensalidade_seg = d.nr_sequencia and x.ie_tipo_item = '14'),0) vl_mensalidade,
	a.nr_titulo
from	titulo_receber			a,
	pls_mensalidade			b,
	pls_segurado			c,
	pls_mensalidade_segurado	d,
	pls_plano			e
where	a.nr_seq_mensalidade		= b.nr_sequencia
and	d.nr_seq_mensalidade		= b.nr_sequencia
and	c.nr_seq_plano			= e.nr_sequencia
and	d.nr_seq_segurado		= c.nr_sequencia
and	c.nr_seq_titular is null

union all

select	0 qt_titular,
	1 qt_dependente,
	e.ds_plano,
	'BABR Dependente' ds_tit_dep,
	pls_obter_faixa_etaria_benef(c.nr_sequencia,'D') qt_faixa,
	coalesce((select sum(x.vl_item) from pls_mensalidade_seg_item x where x.nr_seq_mensalidade_seg = d.nr_sequencia and x.ie_tipo_item = '14'),0) vl_mensalidade,
	a.nr_titulo
from	titulo_receber			a,
	pls_mensalidade			b,
	pls_segurado			c,
	pls_mensalidade_segurado	d,
	pls_plano			e
where	a.nr_seq_mensalidade		= b.nr_sequencia
and	d.nr_seq_mensalidade		= b.nr_sequencia
and	c.nr_seq_plano			= e.nr_sequencia
and	d.nr_seq_segurado		= c.nr_sequencia
and	c.nr_seq_titular is not null

union all

select	0 qt_titular,
	1 qt_dependente,
	e.ds_plano,
	'0069 Cobrança Cartão Magnético' ds_tit_dep,
	pls_obter_faixa_etaria_benef(c.nr_sequencia,'D') qt_faixa,
	coalesce((select sum(x.vl_item) from pls_mensalidade_seg_item x where x.nr_seq_mensalidade_seg = d.nr_sequencia and x.ie_tipo_item = '11'),0) vl_mensalidade,
	a.nr_titulo
from	titulo_receber			a,
	pls_mensalidade			b,
	pls_segurado			c,
	pls_mensalidade_segurado	d,
	pls_plano			e
where	a.nr_seq_mensalidade		= b.nr_sequencia
and	d.nr_seq_mensalidade		= b.nr_sequencia
and	c.nr_seq_plano			= e.nr_sequencia
and	d.nr_seq_segurado		= c.nr_sequencia

union all

select	1 qt_titular,
	0 qt_dependente,
	e.ds_plano,
	'Cadastramento Titular' ds_tit_dep,
	pls_obter_faixa_etaria_benef(c.nr_sequencia,'D') qt_faixa,
	coalesce((select sum(x.vl_item) from pls_mensalidade_seg_item x where x.nr_seq_mensalidade_seg = d.nr_sequencia and x.ie_tipo_item = '2'),0) vl_mensalidade,
	a.nr_titulo
from	titulo_receber			a,
	pls_mensalidade			b,
	pls_segurado			c,
	pls_mensalidade_segurado	d,
	pls_plano			e
where	a.nr_seq_mensalidade		= b.nr_sequencia
and	d.nr_seq_mensalidade		= b.nr_sequencia
and	c.nr_seq_plano			= e.nr_sequencia
and	d.nr_seq_segurado		= c.nr_sequencia
and	c.nr_seq_titular is null

union all

select	0 qt_titular,
	1 qt_dependente,
	e.ds_plano,
	'Cadastramento Dependente' ds_tit_dep,
	pls_obter_faixa_etaria_benef(c.nr_sequencia,'D') qt_faixa,
	coalesce((select sum(x.vl_item) from pls_mensalidade_seg_item x where x.nr_seq_mensalidade_seg = d.nr_sequencia and x.ie_tipo_item = '2'),0) vl_mensalidade,
	a.nr_titulo
from	titulo_receber			a,
	pls_mensalidade			b,
	pls_segurado			c,
	pls_mensalidade_segurado	d,
	pls_plano			e
where	a.nr_seq_mensalidade		= b.nr_sequencia
and	d.nr_seq_mensalidade		= b.nr_sequencia
and	c.nr_seq_plano			= e.nr_sequencia
and	d.nr_seq_segurado		= c.nr_sequencia
and	c.nr_seq_titular is not null

union all

select	0 qt_titular,
	1 qt_dependente,
	e.ds_plano,
	'SCA' ds_tit_dep,
	'' qt_faixa,
	f.vl_item vl_mensalidade,
	a.nr_titulo
from	titulo_receber			a,
	pls_mensalidade			b,
	pls_segurado			c,
	pls_mensalidade_segurado	d,
	pls_plano			e,
	pls_mensalidade_seg_item	F,
	pls_sca_vinculo			g
where	a.nr_seq_mensalidade		= b.nr_sequencia
and	d.nr_seq_mensalidade		= b.nr_sequencia
and	f.nr_seq_mensalidade_seg	= d.nr_sequencia
and	f.NR_SEQ_VINCULO_SCA		= g.nr_sequencia
and	g.nr_seq_plano			= e.nr_sequencia
and	d.nr_seq_segurado		= c.nr_sequencia

union all

select	0 qt_titular,
	1 qt_dependente,
	substr(pls_obter_desc_lanc_manual(e.nr_seq_motivo),1,255) ||' - '|| e.DS_OBSERVACAO,
	'X'  ds_tit_dep,
	'' qt_faixa,
	sum(c.vl_item) vl_mensalidade,
	a.nr_titulo
from	titulo_receber			a,
	pls_mensalidade			b,
	pls_mensalidade_seg_item	c,
	pls_mensalidade_segurado	d,
	PLS_LANCAMENTO_MENSALIDADE	e
where	a.nr_seq_mensalidade		= b.nr_sequencia
and	d.nr_seq_mensalidade		= b.nr_sequencia
and	c.nr_seq_mensalidade_seg	= d.nr_sequencia
and	e.nr_sequencia	= c.nr_seq_lancamento_mens
and	c.ie_tipo_mensalidade		in ('P','N')
group by e.nr_seq_motivo,a.nr_titulo,e.DS_OBSERVACAO

union all

select	0 qt_titular,
	1 qt_dependente,
	substr(pls_obter_desc_lanc_manual(e.nr_seq_motivo),1,255) ||' - '|| e.DS_OBSERVACAO,
	'X'  ds_tit_dep,
	'' qt_faixa,
	sum(c.vl_item) vl_mensalidade,
	a.nr_titulo
from	titulo_receber			a,
	pls_mensalidade			b,
	pls_mensalidade_seg_item	c,
	pls_mensalidade_segurado	d,
	PLS_LANCAMENTO_MENSALIDADE	e
where	a.nr_seq_mensalidade		= b.nr_sequencia
and	d.nr_seq_mensalidade		= b.nr_sequencia
and	c.nr_seq_mensalidade_seg	= d.nr_sequencia
and	e.nr_seq_mensalidade_item	= c.nr_sequencia
and	c.ie_tipo_mensalidade		in ('P','N')
and 	c.nr_seq_tipo_lanc not in (9 ,40)
group by e.nr_seq_motivo,a.nr_titulo,e.DS_OBSERVACAO

union all

select  0 qt_titular,
	1 qt_dependente,
	'CO PARTICIPACAO - PP - FATOR MODERADOR',
	'X'  ds_tit_dep,
	'' qt_faixa,
	sum(c.vl_item) vl_mensalidade,
	a.nr_titulo
from	titulo_receber			a,
	pls_mensalidade     	 	b,
	pls_mensalidade_seg_item  	c,
	pls_mensalidade_segurado  	d
where 	a.nr_seq_mensalidade   = b.nr_sequencia
and 	d.nr_seq_mensalidade    = b.nr_sequencia
and	c.nr_seq_mensalidade_seg  = d.nr_sequencia
and 	c.ie_tipo_item = 20
and 	c.nr_seq_tipo_lanc in (9 ,40)
group by a.nr_titulo,
	b.nr_sequencia

union all

select  1 qt_titular,
	0 qt_dependente,
	null ds_plano,
	'CO PARTICIPACAO - PP - FATOR MODERADOR' ds_tit_dep,
	'' qt_faixa,
	coalesce(b.vl_coparticipacao,0) vl_mensalidade,
	a.nr_titulo
from	titulo_receber      a,
	pls_mensalidade      b
where	a.nr_seq_mensalidade	= b.nr_sequencia
and	b.vl_coparticipacao	<> 0;

