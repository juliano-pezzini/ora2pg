-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_guia_glosa_ocorr_analise_v (ie_tipo, nr_sequencia, nr_codigo, ds_descricao_glosa_ocor, ds_grupo, ds_observacao, ds_msg_externa, ds_origem_glosa, nr_regra_ocor, nr_ocorrencia, nr_seq_auditoria, nr_seq_aud_item, nr_nivel_liberacao, ie_status, nr_seq_guia, nr_seq_guia_proc, nr_seq_guia_mat) AS select	b.ie_tipo,
	a.nr_sequencia,
	substr(tiss_obter_motivo_glosa(nr_seq_motivo_glosa,'C'),1,10) nr_codigo,
	substr(tiss_obter_motivo_glosa(nr_seq_motivo_glosa,'D'),1,255) ds_descricao_glosa_ocor,
	substr(tiss_obter_motivo_glosa(nr_seq_motivo_glosa,'DG'),1,255) ds_grupo,
	substr(ds_observacao,1,255) ds_observacao,
	substr(pls_obter_dados_msg_glosa(nr_seq_motivo_glosa,'ME'),1,255) ds_msg_externa,
	substr(CASE WHEN ie_origem='P' THEN 'Produto' WHEN ie_origem='C' THEN 'Contrato' WHEN ie_origem='B' THEN 'Benefici√°rio' WHEN ie_origem='A' THEN 'SCA'  ELSE '' END ,1,50) ds_origem_glosa,
	0 nr_regra_ocor,
	a.nr_seq_ocorrencia nr_ocorrencia,
	--decode(a.nr_seq_ocorrencia,null,'G','O') ie_vinculo
	b.nr_seq_auditoria,
	b.nr_seq_aud_item,
	b.nr_nivel_liberacao,
	b.ie_status,
       	a.nr_seq_guia,
       	a.nr_seq_guia_proc,
        	a.nr_seq_guia_mat
FROM	pls_analise_ocor_glosa_aut b,
	pls_guia_glosa	a
where	a.nr_sequencia = b.nr_seq_glosa

union

select	b.ie_tipo,
	a.nr_sequencia,
	substr(pls_obter_dados_ocorrencia(a.nr_seq_ocorrencia,'C'),1,255) nr_codigo,
	substr(pls_obter_dados_ocorrencia(a.nr_seq_ocorrencia,'D'),1,255) ds_descricao_glosa_ocor,
	'' ds_grupo,
	coalesce(substr(ds_observacao,1,255),substr(pls_obter_dados_ocorrencia(a.nr_seq_ocorrencia,'DO'),1,255)) ds_observacao,
	'' ds_msg_externa,
	'' ds_origem_glosa,
	a.nr_seq_regra nr_regra_ocor,
	a.nr_seq_ocorrencia nr_ocorrencia,
	--decode(a.nr_seq_glosa_guia,null,'O','G') ie_vinculo
	b.nr_seq_auditoria,
	b.nr_seq_aud_item,
	b.nr_nivel_liberacao,
	b.ie_status,
        	nr_seq_guia_plano       nr_seq_guia,
        	nr_seq_proc             nr_seq_guia_proc,
        	nr_seq_mat              nr_seq_guia_mat
from	pls_analise_ocor_glosa_aut b,
	pls_ocorrencia_benef	a
where	a.nr_seq_conta is null
and	a.nr_seq_requisicao is null
and	a.nr_seq_execucao is null
and	a.nr_seq_conta_pos_estab is null
and	a.nr_sequencia = b.nr_seq_ocorrencia_benef;

