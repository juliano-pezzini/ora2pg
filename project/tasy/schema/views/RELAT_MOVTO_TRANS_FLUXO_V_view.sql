-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW relat_movto_trans_fluxo_v (cd_conta_financ, dt_transacao, vl_transacao, ie_entrada_saida, ds_conta, nr_seq_conta, ie_banco_tesouraria) AS select	b.cd_conta_financ cd_conta_financ,
	a.dt_transacao dt_transacao,
	coalesce(sum(a.vl_transacao),0) vl_transacao,
	CASE WHEN d.ie_oper_fluxo='S' THEN 'E' WHEN d.ie_oper_fluxo IS NULL THEN null  ELSE 'S' END  ie_entrada_saida,
	coalesce(c.ds_interno,c.ds_conta) ds_conta,
	c.nr_sequencia nr_seq_conta,
	'B' ie_banco_tesouraria
FROM banco_estabelecimento_v c
LEFT OUTER JOIN movto_trans_financ a ON (c.nr_sequencia = a.nr_seq_banco)
LEFT OUTER JOIN transacao_financeira b ON (a.nr_seq_trans_financ = b.nr_sequencia)
LEFT OUTER JOIN conta_financeira d ON (b.cd_conta_financ = d.cd_conta_financ)
WHERE c.nr_sequencia in (select	x.nr_sequencia
				from	banco_estabelecimento x
				where	ie_situacao	= 'A'  LIMIT 11) group by
	b.cd_conta_financ,
	a.dt_transacao,
	coalesce(c.ds_interno,c.ds_conta),
	d.ie_oper_fluxo,
	c.nr_sequencia

union all

select	b.cd_conta_financ cd_conta_financ,
	a.dt_transacao dt_transacao,
	coalesce(sum(a.vl_transacao),0) vl_transacao,
	CASE WHEN c.ie_oper_fluxo='S' THEN 'E' WHEN c.ie_oper_fluxo IS NULL THEN null  ELSE 'S' END  ie_entrada_saida,
	to_char(null) ds_conta,
	(null)::numeric  nr_seq_conta,
	'T' ie_banco_tesouraria
from	conta_financeira c,
	transacao_financeira b,
	movto_trans_financ a
where	a.nr_seq_trans_financ	= b.nr_sequencia
and	b.cd_conta_financ	= c.cd_conta_financ
group by
	b.cd_conta_financ,
	a.dt_transacao,
	c.ie_oper_fluxo;

