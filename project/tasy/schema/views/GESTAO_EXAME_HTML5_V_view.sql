-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW gestao_exame_html5_v (nr_prescricao, nr_atendimento, nr_seq_interno, nr_seq_propaci, nr_seq_laudo, nr_interno_conta, ds_status_execucao, nm_medico_prev_exec, nm_medico_executor, nm_medico_laudo, ds_autorizacao, ds_procedimento, ds_motivo_parada, ds_setor_atendimento, ds_motivo_baixa, ds_setor_paciente, ds_arquivo, ie_laudo_ant, dt_ditado, ds_procedencia, dt_inicio, dt_inicio_agenda_atend, ds_lado_proced, ie_mat_med, ie_mat_med_setor, ds_tipo_atend, ds_idade, dt_nascimento, ds_convenio, cd_usuario_convenio, ds_local, ie_obs_proced, qt_prescrito, qt_liberado, qt_exame, ds_status_agenda, ds_exame_lab, ds_material_exame, nm_funcionario_executor, ds_motivo_ant, nr_acesso_dicom, nm_usuario_ditado, ds_email_medico_prescr, nm_anestesista, ds_contraste, ds_intervalo, nm_profissional_previsto, ds_tipo_isolamento_cih, ds_cor_isolamento_cih, ie_exame_cancelado, ds_proced_conta, cd_proced_conta, nm_medico, ie_solic_externa, ie_atend_alerta, possui_hist, dt_impressao_imagem, ie_solicitacao_exame, dt_alta, nr_crm_prescrito, nm_usu_lib_pat, dt_usu_lib_pat, ie_subamostra_exec, ds_setor_local, nr_reserva, nr_transfusao, ds_peca_principal, nr_seq_locate, dt_prescricao, ie_recem_nato, cd_medico, dt_liberacao_medico, nm_usuario_original, nm_usuario, dt_liberacao, cd_pessoa_fisica, cd_setor_atendimento, nr_controle, cd_estabelecimento, qt_peso, cd_procedimento, ie_origem_proced, nr_sequencia, dt_emissao_setor_atend, dt_resultado, dt_prev_execucao, cd_convenio, nr_seq_proc_interno, ie_lado, ie_autorizacao, ie_amostra, ds_observacao, ds_dado_clinico, dt_baixa, nm_usuario_baixa_esp, nr_seq_lab, ie_executar_leito, dt_inicio_exame, dt_antecipa_result, ds_antecipa_result, cd_motivo_baixa, nr_ocorrencia, nr_seq_exame, dt_lib_imagem, nm_usuario_antecipacao, ds_obs_antecip, qt_prescr_proced, cd_profissional, ie_aliquotado, ie_filtrado, ie_irradiado, ie_lavado, dt_chamada_exame, nr_seq_proced, ds_urgencia, ie_status_execucao, cd_medico_executor, dt_procedimento, nm_usuario_exec, dt_liberacao_laudo, nm_usuario_laudo, dt_laudo, nm_usuario_aprovacao, nm_usuario_seg_aprov, dt_impressao, ie_tipo_atendimento, nm_paciente, nm_pac_laudo, nr_prescr, ie_status, dt_nasc, qt_vol_hemo, ds_senha_aut, nr_int_conta, qt_procedimento, nr_prontuario, ds_breve_local, ie_tipo_proced, nr_seq_status_pato, ds_status_patologia, ie_status_patologia, ds_prioridade, ds_cor_prioridade, ie_proced_bloqueado, ds_observacao_bloqueio, ie_exige_liberacao, nr_doc_convenio, dt_entrega, ds_classif_urgencia, ds_cor_urgencia, dt_reprovacao, ds_justificativa_rep, cd_categoria, ds_rotina, ds_material_especial, ds_localizacao_laudo, qt_frasco_env, qt_frasco_rec, ds_motivo_revisao, ie_paciente_isolado, dt_cancelamento, ds_local_paciente, nm_medico_laudo_reg, dt_chegada_paciente, dt_inicio_preparo, ds_exame_anterior, nr_seq_proced_regra, nm_profissional_resp, ds_condicao, ds_forma_entrega_laudo, ie_aprovacao_execucao, ie_prev_execucao_alt, dt_aprovacao_execucao, ie_imagem_entregue, ie_existe_frasco, nr_seq_motivo_just, dt_recebimento_frasco, ds_status_historico, ie_anestesia, ds_protocolo, ie_pago, dt_fim_preparo, ds_observacao_canc_exame, dt_fim_exame, nr_seq_motivo_atraso, ds_motivo_atraso, nm_medico_prev_laudo, ds_obs_agenda, ie_possui_evento, ds_contraste_conta, qt_filme, nm_pessoa_receb_img, nr_prioridade_triagem, ds_integracao, dt_integracao, ds_resumo_clinico, ds_justificativa, ie_urgencia, ds_profissional_pref, ds_obs_antecip_result, ie_antecip_negada, ds_motivo_neg_antecip, ds_status_sr, dt_status_sr, ds_cor_status_sr, dt_agenda_integrada, cd_equipamento, ds_cor_entrega_laudo, ds_categoria_convenio, ie_prescr_lib, nr_seq_pepo, ds_senha_pac_fila, ie_imagem_pacs, dt_solicit_antecip, cd_setor_pac, nr_seq_topografia, dt_entrada, ie_prioridade, ie_prioridade_classif, nm_pessoa_fisica, nr_seq_apresent, dt_atend_medico, dt_fim_consulta, ie_sem_prioridade, ie_carater_inter_sus, ds_senha_qmatic, nr_seq_local_pa, hr_fim_enfermagem, ds_triagem, nr_seq_classificacao, hr_inicio_consulta, ie_status_pa, ie_clinica, qt_idade, ie_prior_classif_atend, dt_fim_triagem, ds_clinica, dt_suspensao, ds_motivo_susp, nm_usuario_susp) AS SELECT	a.nr_prescricao,
	a.nr_atendimento, 
	a.nr_seq_interno, 
	a.nr_seq_propaci, 
	a.nr_seq_laudo, 
	a.nr_interno_conta, 
	a.ds_status_execucao, 
	a.nm_medico_prev_exec, 
	a.nm_medico_executor, 
	a.nm_medico_laudo, 
	a.ds_autorizacao, 
	a.ds_procedimento, 
	a.ds_motivo_parada,	 
	a.ds_setor_atendimento, 
	a.ds_motivo_baixa, 
	a.ds_setor_paciente, 
	a.ds_arquivo, 
	a.ie_laudo_ant, 
	a.dt_ditado, 
	a.ds_procedencia, 
	a.dt_inicio, 
	a.dt_inicio_agenda_atend, 
	a.ds_lado_proced, 
	a.ie_mat_med, 
	a.ie_mat_med_setor, 
	a.ds_tipo_atend, 
	a.ds_idade, 
	a.dt_nascimento, 
	a.ds_convenio, 
	a.cd_usuario_convenio,	 
	a.ds_local, 
	a.ie_obs_proced, 
	a.qt_prescrito, 
	a.qt_liberado, 
	a.qt_exame, 
	a.ds_status_agenda, 
	a.ds_exame_lab, 
	a.ds_material_exame, 
	a.nm_funcionario_executor, 
	a.ds_motivo_ant, 
	a.nr_acesso_dicom, 
	a.nm_usuario_ditado, 
	a.ds_email_medico_prescr, 
	a.nm_anestesista, 
	a.ds_contraste, 
	a.ds_intervalo, 
	a.nm_profissional_previsto, 
	a.ds_tipo_isolamento_cih, 
	a.ds_cor_isolamento_cih, 
	a.ie_exame_cancelado,	 
	a.ds_proced_conta, 
	a.cd_proced_conta, 
	a.nm_medico, 
	a.ie_solic_externa, 
	a.ie_atend_alerta,	 
	a.ie_possui_hist possui_hist,  
	a.dt_impressao_imagem, 
	a.ie_solicitacao_exame, 
	a.dt_alta, 
	a.nr_crm_prescrito, 
	a.nm_usu_lib_pat, 
	a.dt_usu_lib_pat, 
	a.ie_subamostra_exec, 
	a.ds_setor_local, 
	a.nr_reserva, 
	a.nr_transfusao, 
	a.ds_peca_principal, 
	b.nr_prescricao||c.nr_sequencia nr_seq_locate, 
	b.dt_prescricao, 
	b.ie_recem_nato, 
	b.cd_medico, 
	b.dt_liberacao_medico, 
	b.nm_usuario_original, 
	b.nm_usuario, 
	b.dt_liberacao, 
	b.cd_pessoa_fisica, 
	coalesce(c.cd_setor_atendimento,coalesce(b.cd_setor_entrega, b.cd_setor_atendimento)) cd_setor_atendimento, 
	coalesce(c.nr_controle_ext,b.nr_controle) nr_controle, 
	b.cd_estabelecimento, 
	b.qt_peso, 
	c.cd_procedimento, 
	c.ie_origem_proced, 
	e.nr_sequencia, 
	c.dt_emissao_setor_atend, 
	c.dt_resultado, 
	c.dt_prev_execucao, 
	c.cd_convenio, 
	c.nr_seq_proc_interno, 
	c.ie_lado, 
	c.ie_autorizacao, 
	c.ie_amostra, 
	SUBSTR(c.ds_observacao,1,255) ds_observacao, 
	SUBSTR(c.ds_dado_clinico,1,255) ds_dado_clinico, 
	c.dt_baixa, 
	c.nm_usuario_baixa_esp, 
	c.nr_seq_lab, 
	coalesce(c.ie_executar_leito,'N') ie_executar_leito, 
	c.dt_inicio_exame, 
	c.dt_antecipa_result, 
	coalesce(TO_CHAR(c.dt_antecipa_result,'DD/MM/YYYY HH24:MI:SS'), CASE WHEN c.nm_usuario_antecipacao IS NULL THEN ''  ELSE 'Antecipação negada' END ) ds_antecipa_result, 
	c.cd_motivo_baixa, 
	c.nr_ocorrencia, 
	c.nr_seq_exame, 
	c.dt_lib_imagem, 
	c.nm_usuario_antecipacao, 
	c.ds_observacao_antecipacao DS_OBS_ANTECIP, 
	c.qt_procedimento qt_prescr_proced, 
	c.cd_profissional, 
	c.ie_aliquotado, 
	c.ie_filtrado, 
	c.ie_irradiado, 
	c.ie_lavado, 
	c.dt_chamada_exame,	 
	c.nr_sequencia nr_seq_proced, 
	CASE WHEN c.ie_urgencia='S' THEN 'Urgente' END  ds_urgencia, 
	c.ie_status_execucao, 
	d.cd_medico_executor, 
	d.dt_procedimento, 
	d.nm_usuario_original nm_usuario_exec, 
	e.dt_liberacao dt_liberacao_laudo, 
	e.nm_usuario nm_usuario_laudo, 
	e.dt_laudo, 
	e.nm_usuario_aprovacao, 
	e.nm_usuario_seg_aprov, 
	e.dt_impressao, 
	f.ie_tipo_atendimento, 
	SUBSTR(obter_nome_prescricao(b.nr_prescricao,'RND'),1,150) nm_paciente,	 
	SUBSTR(ELIMINA_CARACTERES_ESPECIAIS(p.nm_pessoa_fisica),1,15) nm_pac_laudo, 
	a.nr_prescricao nr_prescr, 
	a.ie_status_execucao ie_status,	 
	a.dt_nascimento dt_nasc, 
	a.qt_vol_hemocomp qt_vol_hemo, 
	coalesce(a.ds_senha,c.cd_senha) ds_senha_aut, 
	d.nr_interno_conta nr_int_conta, 
	d.qt_procedimento, 
	p.nr_prontuario, 
	a.ds_breve_local, 
	c.ie_tipo_Proced, 
	c.nr_seq_status_pato, 
	SUBSTR(Obter_desc_status_patologia(c.nr_seq_status_pato),1,150) ds_status_patologia, 
	SUBSTR(Obter_desc_status_pato_dom(c.nr_seq_status_pato,'C'),1,80) ie_status_patologia, 
	SUBSTR(Obter_dados_prior_proced(c.nr_seq_prioridade,'P'),1,80) ds_prioridade, 
	SUBSTR(Obter_dados_prior_proced(c.nr_seq_prioridade,'C'),1,80) ds_cor_prioridade, 
	coalesce(c.ie_proced_bloqueado,'N') ie_proced_bloqueado, 
	c.ds_observacao_bloqueio, 
	c.ie_exige_liberacao, 
	coalesce(d.nr_doc_convenio, c.nr_doc_convenio) nr_doc_convenio, 
	b.dt_entrega, 
	SUBSTR(obter_desc_triagem(f.nr_seq_triagem),1,80) ds_classif_urgencia, 
	SUBSTR(obter_cor_tcr(f.nr_seq_triagem),1,80) ds_cor_urgencia, 
	c.dt_reprovacao	, 
	SUBSTR(c.ds_justificativa_reprov,1,255) ds_justificativa_rep, 
	SUBSTR(Obter_Categoria_Atendimento(b.nr_atendimento),1,80) cd_categoria, 
	SUBSTR(c.ds_rotina,1,80) ds_rotina, 
	a.ds_material_especial, 
	a.ds_localizacao_laudo,	 
	TO_CHAR(c.qt_frasco_env) qt_frasco_env, 
	TO_CHAR(c.qt_frasco_rec) qt_frasco_rec, 
	c.ds_motivo_revisao, 
	coalesce(f.ie_paciente_isolado,'N') ie_paciente_isolado,	 
	a.dt_cancelamento, 
	a.ds_local_paciente, 
	a.nm_medico_laudo_reg, 
	c.dt_chegada_paciente, 
	c.dt_inicio_preparo, 
	SUBSTR(ds_exame_anterior,1,150) ds_exame_anterior, 
	c.nr_seq_proced nr_seq_proced_regra, 
	SUBSTR(obter_nome_pf(c.cd_profissional_resp),1,100) nm_profissional_resp, 
	SUBSTR(obter_desc_condicao_exame(c.nr_seq_condicao),1,255) ds_condicao, 
	SUBSTR(Obter_Desc_Forma_Entrega(b.nr_seq_forma_laudo),1,80) ds_forma_entrega_laudo, 
	coalesce(c.ie_aprovacao_execucao,'N') ie_aprovacao_execucao, 
	coalesce(c.ie_prev_execucao_alt, 'N') ie_prev_execucao_alt, 
	c.dt_aprovacao_execucao, 
	a.ie_imagem_entregue, 
	CASE WHEN coalesce(c.qt_frasco_rec,0)=0 THEN  'N'  ELSE 'S' END  ie_existe_frasco, 
	c.nr_seq_motivo_just,	 
	c.dt_recebimento_frasco, 
	SUBSTR(obter_max_prescr_hist_status(c.nr_prescricao, c.nr_sequencia), 1, 60) ds_status_historico, 
	c.ie_anestesia, 
	SUBSTR(obter_desc_protocolo(c.cd_protocolo),1,255) ds_protocolo, 
	a.ie_pago, 
	c.dt_fim_preparo, 
	SUBSTR(c.ds_observacao_canc_exame,1,255) ds_observacao_canc_exame, 
	c.dt_fim_exame, 
	c.nr_seq_motivo_atraso, 
	a.ds_motivo_atraso, 
	SUBSTR(obter_nome_pessoa_fisica(d.cd_medico_prev_laudo, NULL),1,100) nm_medico_prev_laudo, 
	SUBSTR(a.ds_obs_agenda,1,200) ds_obs_agenda, 
	a.ie_possui_evento, 
	a.ds_contraste_conta, 
	a.qt_filme, 
	a.nm_pessoa_receb_img, 
	a.nr_prioridade_triagem, 
	c.ds_integracao, 
	c.dt_integracao, 
	SUBSTR(c.ds_resumo_clinico,1,255) ds_resumo_clinico, 
	SUBSTR(c.ds_justificativa,1,255) ds_justificativa, 
	c.ie_urgencia, 
	a.ds_profissional_pref, 
	ds_obs_antecip_result, 
	CASE WHEN dt_neg_atencip_result IS NULL THEN 'N'  ELSE 'S' END  ie_antecip_negada, 
	substr(Obter_mot_neg_antecip(c.nr_seq_mot_anteci_result),1,254) ds_motivo_neg_antecip, 
	a.ds_status_sr, 
	a.dt_status_sr, 
	a.ds_cor_status_sr, 
	a.dt_agenda_integrada, 
	c.cd_equipamento, 
	SUBSTR(Obter_cor_Forma_Entrega(b.nr_seq_forma_laudo),1,80) ds_cor_entrega_laudo, 
	a.ds_categoria_convenio, 
	CASE WHEN dt_liberacao_medico IS NULL THEN CASE WHEN dt_liberacao_medico IS NULL THEN 'N'  ELSE 'S' END   ELSE 'S' END  ie_prescr_lib, 
	b.nr_seq_pepo, 
	a.ds_senha_pac_fila, 
	c.ie_imagem_pacs, 
	a.dt_solicit_antecip, 
	a.cd_setor_pac, 
	c.nr_seq_topografia, 
 	f.dt_entrada, 
	obter_prioridade_tcr(f.nr_seq_triagem) ie_prioridade, 
 	(obter_dados_tcp(f.nr_seq_triagem_prioridade,'SEQ'))::numeric  ie_prioridade_classif, 
 	p.nm_pessoa_fisica, 
 	(coalesce(Obter_seq_apres_pa(SUBSTR(obter_status_atend_pa_nova(f.nr_Atendimento,f.dt_alta,f.dt_medicacao,f.dt_lib_medico,f.dt_atend_medico,f.dt_fim_consulta,f.dt_inicio_atendimento,f.dt_fim_triagem,f.dt_chamada_paciente,f.dt_liberacao_enfermagem,f.dt_reavaliacao_medica,f.nr_atend_alta,f.cd_estabelecimento,f.dt_fim_reavaliacao,f.dt_inicio_observacao,f.dt_fim_observacao),1,10),f.cd_estabelecimento),0))::numeric  nr_seq_apresent, 
 	f.dt_atend_medico, 
 	f.dt_fim_consulta, 
 	CASE WHEN obter_prioridade_tcr(f.nr_seq_triagem)=999 THEN 0  ELSE obter_prioridade_tcr(f.nr_seq_triagem) END  ie_sem_prioridade, 
 	f.ie_carater_inter_sus, 
 	f.ds_senha_qmatic, 
 	f.nr_seq_local_pa, 
 	TO_CHAR(f.dt_fim_triagem,'hh24:mi') hr_fim_enfermagem, 
 	SUBSTR(coalesce(coalesce(obter_desc_triagem(f.nr_seq_triagem), obter_triagem_atendimento(f.nr_atendimento)),obter_desc_sem_triagem(f.nr_seq_triagem)),1,60) ds_triagem, 
 	f.nr_seq_classificacao, 
 	TO_CHAR(f.dt_atend_medico,'hh24:mi') hr_inicio_consulta, 
 	f.ie_status_pa, 
 	f.ie_clinica, 
 	SUBSTR(obter_idade(p.dt_nascimento, LOCALTIMESTAMP, 'A'),1,15) qt_idade, 
 	obter_prioridade_classif_atend(f.nr_seq_classificacao) ie_prior_classif_atend, 
 	f.dt_fim_triagem, 
 	substr(obter_valor_dominio(17,f.ie_clinica),1,255) ds_clinica, 
  	c.dt_suspensao, 
  	c.ds_motivo_susp, 
  	c.nm_usuario_susp 
FROM pessoa_fisica p, prescr_procedimento c, prescr_medica b, gestao_exame_w a
LEFT OUTER JOIN procedimento_paciente d ON (a.nr_seq_propaci = d.nr_sequencia)
LEFT OUTER JOIN laudo_paciente e ON (a.nr_seq_laudo = e.nr_sequencia)
LEFT OUTER JOIN atendimento_paciente f ON (a.nr_atendimento = f.nr_atendimento)
WHERE a.nr_prescricao		= b.nr_prescricao AND a.nr_seq_interno	= c.nr_seq_interno    AND b.cd_pessoa_fisica	= p.cd_pessoa_fisica;

