-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW apache_categ_diag_v (nr_sequencia, dt_atualizacao, nm_usuario, ds_categoria, qt_pontuacao, ie_tipo_categoria, nr_seq_superior, dt_atualizacao_nrec, nm_usuario_nrec, ie_classificacao, nivel, nm_categoria) AS WITH RECURSIVE cte AS (
SELECT A.NR_SEQUENCIA,A.DT_ATUALIZACAO,A.NM_USUARIO,A.DS_CATEGORIA,A.QT_PONTUACAO,A.IE_TIPO_CATEGORIA,A.NR_SEQ_SUPERIOR,A.DT_ATUALIZACAO_NREC,A.NM_USUARIO_NREC,A.IE_CLASSIFICACAO,1 NIVEL,substr(Lpad(' ',3*(1-1)) || A.DS_CATEGORIA, 1, 60) NM_CATEGORIA
 FROM APACHE_CATEG_DIAG A WHERE A.NR_SEQ_SUPERIOR IS NULL
  UNION ALL
SELECT A.NR_SEQUENCIA,A.DT_ATUALIZACAO,A.NM_USUARIO,A.DS_CATEGORIA,A.QT_PONTUACAO,A.IE_TIPO_CATEGORIA,A.NR_SEQ_SUPERIOR,A.DT_ATUALIZACAO_NREC,A.NM_USUARIO_NREC,A.IE_CLASSIFICACAO,(c.level+1) NIVEL,substr(Lpad(' ',3*((c.level+1)-1)) || A.DS_CATEGORIA, 1, 60) NM_CATEGORIA
 FROM APACHE_CATEG_DIAG A JOIN cte c ON (c.NR_SEQUENCIA = A.NR_SEQ_SUPERIOR)

) SELECT * FROM cte;


