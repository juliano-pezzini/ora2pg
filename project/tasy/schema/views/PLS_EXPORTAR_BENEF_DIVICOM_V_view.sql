-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_exportar_benef_divicom_v (nr_sequencial, ie_tipo_movimentacao, ds_chave, dt_vigencia, dt_contratacao, dt_movimentacao, dt_exclusao, nr_matricula, nm_beneficiario, cd_parentesco, ie_tipo, ie_sexo, ds_estado_civil, nr_rg, nr_cpf, nm_mae, dt_nascimento_mae, cd_plano, ds_plano, cd_usuario_plano, dt_nascimento, ds_endereco, nr_endereco, ds_complemento, ds_branco, ds_bairro, ds_municipio, sg_uf, cd_cep, nr_telefone, ds_email, ds_cargo, dt_admissao, nr_pis_pasep, nr_declaracao_nasc_vivo, nr_seq_lote, cd_cod_anterior) AS select	1									nr_sequencial,
	a.ie_tipo_movimentacao							ie_tipo_movimentacao, 
	' ' 									ds_chave, 
	' '									DT_VIGENCIA, 
	a.dt_contratacao							dt_contratacao, 
	b.dt_referencia								dt_movimentacao, 
	dt_rescisao								DT_EXCLUSAO, 
	a.cd_matricula_familia							NR_MATRICULA, 
	a.nm_beneficiario							nm_beneficiario, 
	(	select	max(x.cd_sistema_anterior) 
		FROM	grau_parentesco x 
		where	x.nr_sequencia	= a.nr_seq_parentesco) 			CD_PARENTESCO, 
	CASE WHEN a.nr_seq_titular IS NULL THEN 'T'  ELSE 'D' END 					ie_tipo, 
	a.ie_sexo								ie_sexo, 
	CASE WHEN a.ie_estado_civil='2' THEN 'C' WHEN a.ie_estado_civil='1' THEN 'S' WHEN a.ie_estado_civil='6' THEN 'P' WHEN a.ie_estado_civil='3' THEN 'D' WHEN a.ie_estado_civil='5' THEN 'V' END 	ds_estado_civil, 
	a.nr_identidade								nr_rg, 
	a.nr_cpf								nr_cpf, 
	a.nm_mae								nm_mae, 
	a.dt_nascimento_mae							dt_nascimento_mae, 
	a.cd_plano								cd_plano, 
	a.DS_PLANO								ds_plano, 
	a.CD_USUARIO_PLANO							cd_usuario_plano, 
	a.dt_nascimento								dt_nascimento, 
	a.ds_endereco								ds_endereco, 
	a.nr_endereco								nr_endereco, 
	a.ds_complemento							ds_complemento, 
	' ' 									ds_branco, 
	a.ds_bairro								ds_bairro, 
	a.ds_municipio								ds_municipio, 
	a.sg_estado								sg_uf, 
	a.cd_cep								cd_cep, 
	a.nr_telefone								nr_telefone, 
	a.DS_EMAIL								DS_EMAIL, 
	substr(OBTER_DESC_CARGO(a.cd_cargo),1,255)				DS_CARGO, 
	a.DT_ADMISSAO								DT_ADMISSAO, 
	a.NR_PIS_PASEP								NR_PIS_PASEP, 
	a.CD_DECLARACAO_NASC_VIVO						NR_DECLARACAO_NASC_VIVO, 
	b.nr_sequencia								nr_seq_lote, 
	a.CD_COD_ANTERIOR							CD_COD_ANTERIOR 
from	pls_movimentacao_benef	a, 
	pls_lote_mov_benef	b 
where	b.nr_sequencia		= a.nr_seq_lote;

