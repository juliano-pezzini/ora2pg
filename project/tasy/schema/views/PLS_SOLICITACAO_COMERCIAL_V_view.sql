-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_solicitacao_comercial_v (ie_tipo_contratacao, ds_tipo_contratacao, ie_status, ds_status, ie_origem_solicitacao, ds_forma_registro, nr_acao_origem, ds_acao_origem, nr_seq_vendedor_canal, nm_canal_venda, nr_seq_vendedor_vinculado, nm_vendedor, nr_seq_agente_motivador, ds_agente_motivador, cd_municipio_ibge, ds_municipio, dt_mesano_referencia) AS select	a.ie_tipo_contratacao,
	(	select	substr(ds_expressao,1,255) 
		FROM	valor_dominio_v 
		where	cd_dominio	= 1666 
		and	vl_dominio	= a.ie_tipo_contratacao) ds_tipo_contratacao, 
	a.ie_status, 
	coalesce((	select	substr(ds_expressao,1,255) 
		from	valor_dominio_v 
		where	cd_dominio	= 2461 
		and	vl_dominio	= a.ie_status),'X') ds_status, 
	a.ie_origem_solicitacao, 
	(	select	substr(ds_expressao,1,255) 
		from	valor_dominio_v 
		where	cd_dominio	= 2471 
		and	vl_dominio	= a.ie_origem_solicitacao) ds_forma_registro, 
	a.nr_acao_origem, 
	coalesce(pls_obter_desc_origem_solic(a.nr_acao_origem),'X') ds_acao_origem, 
	null nr_seq_vendedor_canal, 
	null nm_canal_venda, 
	null nr_seq_vendedor_vinculado, 
	null nm_vendedor, 
	a.nr_seq_agente_motivador , 
	substr((select	x.ds_agente_motivador 
		from	pls_agente_motivador x 
		where	x.nr_sequencia = a.nr_seq_agente_motivador),1,255) ds_agente_motivador, 
	a.cd_municipio_ibge, 
	(	select	initcap(lower(substr(x.ds_municipio,1,255))) 
		from	sus_municipio x 
		where	x.cd_municipio_ibge = a.cd_municipio_ibge) ds_municipio, 
	a.dt_solicitacao dt_mesano_referencia 
from	pls_solicitacao_comercial	a 

union all
 
select	null ie_tipo_contratacao, 
	null ds_tipo_contratacao, 
	null ie_status, 
	null ds_status, 
	null ie_origem_solicitacao, 
	null ds_forma_registro, 
	null nr_acao_origem, 
	null ds_acao_origem, 
	b.nr_seq_vendedor_canal, 
	substr(pls_obter_dados_vendedor(b.nr_seq_vendedor_canal,'N'),1,200) nm_canal_venda, 
	b.nr_seq_vendedor_vinculado, 
	substr(pls_obter_dados_vend_vinculado(b.nr_seq_vendedor_vinculado,'D'),1,255) nm_vendedor, 
	null nr_seq_agente_motivador , 
	null ds_agente_motivador, 
	null cd_municipio_ibge, 
	null ds_municipio, 
	a.dt_solicitacao dt_mesano_referencia 
FROM pls_solicitacao_comercial a
LEFT OUTER JOIN pls_solicitacao_vendedor b ON (a.nr_sequencia = b.nr_seq_solicitacao);

