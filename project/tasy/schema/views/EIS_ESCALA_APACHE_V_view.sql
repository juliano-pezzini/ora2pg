-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_escala_apache_v (qt_apache_ii, qt_risco_calculado, pr_risco, qt_pont_idade, cd_setor_atendimento, ds_setor_atendimento, ds_unidade, dt_avaliacao, ds_estabelecimento, cd_convenio, ds_convenio, ie_sexo, ds_sexo, cd_medico_resp, ie_faixa_etaria, cd_empresa, cd_estabelecimento, nr_atendimento, cd_paciente, ds_categoria_diag, cd_motivo_alta, ds_motivo_alta, ie_clinica, ds_clinica) AS select 	distinct
		e.qt_apache_ii, 
		qt_risco_calculado, 
		pr_risco, 
		qt_pont_idade, 
		eis_obter_setor_atend_data(a.nr_atendimento, e.dt_apache) cd_setor_atendimento, 
		obter_nome_setor(eis_obter_setor_atend_data(a.nr_atendimento, e.dt_apache) ) ds_setor_atendimento,	  
		substr(obter_unidade_atend_data(a.nr_atendimento, e.dt_apache),1,255) ds_unidade, 
		trunc(e.dt_apache) dt_avaliacao,	  
		substr(obter_nome_estabelecimento(a.cd_estabelecimento),1,80) ds_estabelecimento, 
		obter_convenio_atendimento(a.nr_atendimento) cd_convenio, 
		substr(obter_nome_convenio(obter_convenio_atendimento(a.nr_atendimento)),1,150) ds_convenio, 
		obter_sexo_pf(a.cd_pessoa_fisica,'C') ie_sexo, 
		obter_sexo_pf(a.cd_pessoa_fisica,'D') ds_sexo, 
		a.cd_medico_resp, 
		substr(obter_idade(obter_data_nascto_pf(a.cd_pessoa_fisica),LOCALTIMESTAMP,'E'),1,10) ie_faixa_etaria, 
		f.cd_empresa, 
		a.cd_estabelecimento, 
		a.nr_atendimento, 
		a.cd_pessoa_fisica cd_paciente, 
		substr(obter_desc_categ_diag_apache(e.nr_seq_cat_diag),1,255) ds_categoria_diag, 
		cd_motivo_alta, 
		substr(obter_desc_motivo_alta(cd_motivo_alta),1,255) ds_motivo_alta, 
		a.ie_clinica, 
		substr(obter_valor_dominio(17,a.ie_clinica),1,80) ds_clinica 
FROM 		apache e, 
		estabelecimento f, 
		atendimento_paciente a 
where 		a.nr_atendimento = e.nr_atendimento 
and		a.cd_estabelecimento = f.cd_estabelecimento 
and		e.dt_liberacao is not null 
and		e.dt_inativacao is null;

