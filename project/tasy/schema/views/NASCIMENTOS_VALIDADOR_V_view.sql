-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW nascimentos_validador_v (dt_nascimento, nr_atendimento, cd_pessoa_fisica, nr_seq_nascimento, cedocve, folio, tipo_formato, c_04, c_05, c_06, c_07, c_08, c_09, c_10, c_11, c_12, c_13, c_14, c_15, c_16, c_17, c_18, c_19, c_20, c_21, c_22, c_23, c_24, c_25, c_26, c_27, c_28, c_29, c_30, c_31, c_32, c_33, c_34, c_35, c_36, c_37, c_38, c_39, c_40, c_41, c_42, c_43, c_44, c_45, c_46, fech_nach, hora_nach, sexoh, gestach, tallah, pesoh, apgarh, silverman, bcg, hep_b, vit_a, vit_k, tam_met, tam_aud, producto, ie_malformacao_1, cve_cie, acelrn, ie_malformacao_2, cve_cie2, acelrn2, ie_parto_normal, ie_parto_forceps, ie_parto_cesaria, forceps, especifique, inst_nac, unimed, clues, atendio, aten_otro, tipovial_nac, calle_nac, numext_nac, numint_nac, tipoasen_nac, nomasen_nac, codpos_nac, ent_nac, mpo_nac, loc_nac, nombre_c, paternoc, maternoc, cert_por, otromedico, ced_medc, unimed_33_1, clues_33_2, tipovial_cert, calle_cert, numext_cert, numint_cert, tipoasen_cert, nomasen_cert, codpos_cert, ent_cert, mpo_cert, loc_cert, tel_cert, fech_cert, user_alta, fech_alta, user_camb, fech_camb, idcaptura, nr_atendimento_mae, cd_pessoa_juridica, cd_pessoa_fisica_mae, nr_atendimento_rn, cd_pediatra, cd_pessoa_fisica_rn) AS SELECT 	b.dt_nascimento, a.nr_atendimento,
	a.cd_pessoa_fisica,
	b.nr_sequencia NR_SEQ_NASCIMENTO,
	obter_dados_cat_clues(d.cd_internacional,'CD_ESTADO') CEDOCVE,
	b.nr_dnv FOLIO,
	(CASE WHEN((TO_CHAR(b.dt_nascimento,'yyyy'))::numeric  < 2010) THEN 'ANTERIOR'
	     WHEN((TO_CHAR(b.dt_nascimento,'yyyy'))::numeric  BETWEEN 2010 AND 2014) THEN '2010'
	     ELSE '2015'
	END) TIPO_FORMATO,
	z.ds_given_name C_04,
	z.ds_family_name C_05,
	z.ds_component_name_1 C_06,
	pf.cd_curp C_07,
	obter_dados_cat_entidade(pf.cd_pessoa_fisica,'CD_ENTIDADE') C_08,
	obter_dados_cat_municipio(pf.cd_municipio_ibge,'CD_CAT_MUNICIPIO') C_09,
	pf.dt_nascimento C_10,
	obter_idade(pf.dt_nascimento,LOCALTIMESTAMP,'A') C_11,
	CASE WHEN pf.nr_seq_cor_pele IS NULL THEN '2'  ELSE '1' END  C_12,
	CASE WHEN pf.nr_seq_lingua_indigena IS NULL THEN '2'  ELSE '1' END  C_13,
	SUBSTR(obter_dados_cat_lingua_indig(pf.nr_seq_lingua_indigena,'CD_LINGUA_INDIGENA_MF'),1,4) C_14,
	CASE WHEN pf.ie_estado_civil='1' THEN '12' WHEN pf.ie_estado_civil='2' THEN '11' WHEN pf.ie_estado_civil='3' THEN '13' WHEN pf.ie_estado_civil='4' THEN '16' WHEN pf.ie_estado_civil='5' THEN '14' WHEN pf.ie_estado_civil='6' THEN '16' WHEN pf.ie_estado_civil='7' THEN '15' WHEN pf.ie_estado_civil='9' THEN '88'  ELSE '99' END  C_15,
	LPAD(coalesce(cpf.cd_tipo_logradouro,'99'),2,'0') C_16,
	cpf.ds_endereco C_17,
	cpf.nr_endereco C_18,
	'' C_19,
	substr(coalesce(get_info_end_endereco(cpf.nr_seq_pessoa_endereco,'TIPO_BAIRRO','C'),'99'),1,2) C_20,
	substr(coalesce(get_info_end_endereco(cpf.nr_seq_pessoa_endereco,'TIPO_BAIRRO','D'),'SIN INFORMACIAâ€œN'),1,60) C_21,
	SUBSTR(trim(both coalesce(get_info_end_endereco(cpf.nr_seq_pessoa_endereco,'CODIGO_POSTAL','D'),'99999')),1,5) C_22,
	substr(coalesce(get_info_end_endereco(cpf.nr_seq_pessoa_endereco,'ESTADO_PROVINCI','C'),'99'),1,2) C_23,
	substr(coalesce(get_info_end_endereco(cpf.nr_seq_pessoa_endereco,'MUNICIPIO','C'),'999'),1,3) C_24,
	substr(coalesce(get_info_end_endereco(cpf.nr_seq_pessoa_endereco,'LOCALIDADE_AREA','C'),'9999'),1,4) C_25,
	cpf.nr_telefone C_26,
	coalesce(coalesce(ag.qt_gestacoes,hsm.qt_gestacoes),0)+1 C_27,
	coalesce(coalesce(ag.qt_filhos_mortos,hsm.qt_filhos_mortos),'99') C_28,
	coalesce(coalesce(par.qt_filhos_vivos,ag.qt_filhos_vivos),hsm.qt_filhos_vivos) C_29,
	coalesce(hsm.qt_filhos_vivos,'99') C_30,
	par.ie_cond_ult_nasc C_31,
	CASE WHEN par.ie_cond_ult_nasc='2' THEN '0' WHEN par.ie_cond_ult_nasc='3' THEN '0'  ELSE CASE WHEN par.ie_ult_filho_vivo='S' THEN '1' WHEN par.ie_ult_filho_vivo='N' THEN '2'  ELSE '9' END  END  C_32,
	'99/99/9999' C_33,
	b.nr_sequencia C_34,
	par.ie_pre_natal C_35,
	CASE WHEN par.ie_pre_natal='N' THEN '0'  ELSE (CASE	WHEN ((h.dt_prim_consulta-h.dt_ultima_menstruacao) < 90) THEN '1'					WHEN ((h.dt_prim_consulta-h.dt_ultima_menstruacao) BETWEEN 91 AND 180) THEN '2'					WHEN ((h.dt_prim_consulta-h.dt_ultima_menstruacao) BETWEEN 181 AND 270) THEN '3'					ELSE '9' END) END  C_36,
	CASE WHEN par.ie_pre_natal='N' THEN '0'  ELSE par.qt_consultas END  C_37,
	CASE WHEN dco.nr_declaracao IS NULL THEN '2'  ELSE '1' END  C_38,
	coalesce(dco.nr_declaracao,'999999999') C_39,
	obter_convenio_atend_mx(a.nr_atendimento,1,'CD_DER_NACIMIENTO') C_40,
	pf.nr_spss C_41,
	CASE WHEN coalesce(obter_convenio_atend_mx(a.nr_atendimento,1,'CD_DER_NACIMIENTO'),'01')='01' THEN '00'  ELSE obter_convenio_atend_mx(a.nr_atendimento,2,'CD_DER_NACIMIENTO') END  C_42,
	CASE WHEN pf.ie_grau_instrucao='1' THEN '01' WHEN pf.ie_grau_instrucao='2' THEN '03' WHEN pf.ie_grau_instrucao='3' THEN '05' WHEN pf.ie_grau_instrucao='4' THEN '07' WHEN pf.ie_grau_instrucao='5' THEN '10' WHEN pf.ie_grau_instrucao='6' THEN '10' WHEN pf.ie_grau_instrucao='7' THEN '02' WHEN pf.ie_grau_instrucao='8' THEN '05' WHEN pf.ie_grau_instrucao='9' THEN '06' WHEN pf.ie_grau_instrucao='10' THEN '03' WHEN pf.ie_grau_instrucao='11' THEN '01' WHEN pf.ie_grau_instrucao='12' THEN '10' WHEN pf.ie_grau_instrucao='13' THEN '10' WHEN pf.ie_grau_instrucao='14' THEN '88' WHEN pf.ie_grau_instrucao='15' THEN '08'  ELSE '99' END  C_43,
	SUBSTR(coalesce(obter_desc_cargo(pf.cd_cargo),'SIN INFORMACION'),1,40) C_44,
	CASE WHEN(SELECT w.cd_externo FROM cargo w WHERE w.cd_cargo = pf.cd_cargo)='01' THEN '0' WHEN(SELECT w.cd_externo FROM cargo w WHERE w.cd_cargo = pf.cd_cargo)='02' THEN '0' WHEN(SELECT w.cd_externo FROM cargo w WHERE w.cd_cargo = pf.cd_cargo)='03' THEN '0' WHEN(SELECT w.cd_externo FROM cargo w WHERE w.cd_cargo = pf.cd_cargo)='04' THEN '0'  ELSE (SELECT coalesce(w.cd_externo,'99') FROM cargo w WHERE w.cd_cargo = pf.cd_cargo) END  C_45,
	CASE WHEN pf.cd_cargo IS NULL THEN '2'  ELSE '1' END  C_46, --926411
	b.dt_nascimento FECH_NACH,
	b.dt_nascimento HORA_NACH,
	b.ie_sexo SEXOH,
	coalesce(b.qt_sem_ig_total, b.qt_sem_ig) GESTACH,
	b.qt_altura TALLAH,
	coalesce(b.qt_peso_sala_parto, b.qt_peso) PESOH,
	coalesce(b.qt_apgar_quinto_min,'99') APGARH,
	coalesce(es.qt_pontuacao,'99') SILVERMAN,
	CASE WHEN coalesce(vtr.ie_tipo_vacina,'N')='B' THEN '1'  ELSE '2' END  BCG,
	CASE WHEN coalesce(vtr.ie_tipo_vacina,'N')='H' THEN '1'  ELSE '2' END  HEP_B,
	CASE WHEN b.ie_vitamina_a='S' THEN '1'  ELSE '2' END  VIT_A,
	CASE WHEN b.ie_vitamina_k='S' THEN '1'  ELSE '2' END  VIT_K,
	'0' TAM_MET,
	CASE WHEN coalesce(vtr.ie_tipo_vacina,'N')='A' THEN '1'  ELSE '2' END  TAM_AUD,
	CASE WHEN coalesce(par.qt_feto,'1')='1' THEN '1' WHEN coalesce(par.qt_feto,'1')='2' THEN '2'  ELSE '3' END  PRODUCTO,
	CASE WHEN obter_inf_doenca_cid_atend(b.nr_atend_rn,1,'MAL')='ANMRN' THEN 'S'  ELSE 'N' END  IE_MALFORMACAO_1,
	coalesce(obter_inf_doenca_cid_atend(b.nr_atend_rn,1,'CD'),'0000') CVE_CIE,
	SUBSTR(coalesce(obter_inf_doenca_cid_atend(b.nr_atend_rn,1,'DS'),'NINGUNA APARENTE'),1,40) ACELRN,
	CASE WHEN obter_inf_doenca_cid_atend(b.nr_atend_rn,2,'MAL')='ANMRN' THEN 'S'  ELSE 'N' END  IE_MALFORMACAO_2,
	coalesce(obter_inf_doenca_cid_atend(b.nr_atend_rn,2,'CD'),'7777') CVE_CIE2,
	SUBSTR(coalesce(obter_inf_doenca_cid_atend(b.nr_atend_rn,2,'DS'),'NO APLICA'),1,40) ACELRN2,
	par.ie_parto_normal,
	par.ie_parto_forceps,
	par.ie_parto_cesaria,
	CASE WHEN par.ie_parto_forceps='S' THEN '1'  ELSE '2' END  FORCEPS,
	SUBSTR(par.ds_observacao,1,25) ESPECIFIQUE,
	coalesce(d.ie_tipo_inst_saude,'99') INST_NAC,
	obter_dados_cat_clues(d.cd_internacional,'DS_ESTAB_SAUDE') UNIMED,
	obter_dados_cat_clues(d.cd_internacional,'CD_CLUES') CLUES,
	obter_dados_cat_prof_parto(par.nr_seq_prof_parto,'CD_ATEND_PARTO') ATENDIO,
	SUBSTR((SELECT obter_nome_pf(x.cd_pessoa_fisica) FROM parto_participante x WHERE nr_atendimento = a.nr_atendimento),1,25) ATEN_OTRO,
	obter_dados_cat_tipo_via(d.nr_seq_tipo_logradouro,'CD_TIPO_VIA') TIPOVIAL_NAC,
	SUBSTR(d.ds_endereco||' '||d.nr_endereco||' '||d.ds_bairro,1,80) CALLE_NAC,
	SUBSTR(coalesce(d.nr_endereco,'9999999999'),1,10) NUMEXT_NAC,
	SUBSTR(d.ds_complemento,1,5) NUMINT_NAC,
	obter_dados_cat_tipo_assent(d.nr_seq_tipo_asen,'CD_TIPO_ASEN') TIPOASEN_NAC,
	obter_dados_cat_tipo_assent(d.nr_seq_tipo_asen,'NM_ASSENTAMENTO') NOMASEN_NAC,
	obter_dados_cat_clues(d.cd_internacional,'CD_POSTAL') CODPOS_NAC,
	obter_dados_cat_clues(d.cd_internacional,'CD_ESTADO') ENT_NAC,
	obter_dados_cat_clues(d.cd_internacional,'CD_MUNICIPIO') MPO_NAC,
	obter_dados_cat_clues(d.cd_internacional,'CD_LOCALIDADE') LOC_NAC,
	y.ds_given_name NOMBRE_C,
	y.ds_family_name PATERNOC,
	y.ds_component_name_1 MATERNOC,
	obter_dados_cat_cert_parto(par.nr_seq_cert_parto,'CD_CERT_PARTO') CERT_POR,
	SUBSTR(coalesce(obter_nome_pf(b.cd_pediatra),'SIN INFORMACION'),1,25) OTROMEDICO,
	SUBSTR(coalesce(b.cd_pediatra,'SIN INFORMACION'),1,20) CED_MEDC,
	SUBSTR(d.ds_razao_social,1,50) UNIMED_33_1,
	LPAD(coalesce(obter_dados_cat_clues(d.cd_internacional,'CD_CLUES'),'99999999999'),11,'0') CLUES_33_2,
	coalesce(obter_dados_cat_tipo_via(d.nr_seq_tipo_logradouro,'CD_TIPO_VIA'),'99') TIPOVIAL_CERT,
	SUBSTR(d.ds_endereco||' '||d.nr_endereco||' '||d.ds_bairro,1,80) CALLE_CERT,
	SUBSTR(coalesce(d.nr_endereco,'9999999999'),1,10) NUMEXT_CERT,
	SUBSTR(d.ds_complemento,1,5) NUMINT_CERT,
	obter_dados_cat_tipo_assent(d.nr_seq_tipo_asen,'CD_TIPO_ASEN') TIPOASEN_CERT,
	obter_dados_cat_tipo_assent(d.nr_seq_tipo_asen,'NM_ASSENTAMENTO') NOMASEN_CERT,
	obter_dados_cat_clues(d.cd_internacional,'CD_POSTAL') CODPOS_CERT,
	obter_dados_cat_clues(d.cd_internacional,'CD_ESTADO') ENT_CERT,
	obter_dados_cat_clues(d.cd_internacional,'CD_MUNICIPIO') MPO_CERT,
	obter_dados_cat_clues(d.cd_internacional,'CD_LOCALIDADE') LOC_CERT,
	SUBSTR((d.nr_ddi_telefone||d.nr_ddd_telefone||d.nr_telefone),1,12) TEL_CERT,
	TO_CHAR(b.dt_atualizacao,'dd/mm/yyyy') FECH_CERT,
	'ADMIN' USER_ALTA,
	TO_CHAR(b.dt_entrega_dnv,'dd/mm/yyyy') FECH_ALTA,
	'' USER_CAMB,
	b.dt_nascimento FECH_CAMB,
	coalesce(obter_dados_cat_lugar_cert_nac(b.nr_seq_local_cert_nasc,'CD_LUG_CERT_NASC'),'9') IDCAPTURA,
	apm.nr_atendimento_mae NR_ATENDIMENTO_MAE,
	d.cd_cgc CD_PESSOA_JURIDICA,
	pf.cd_pessoa_fisica CD_PESSOA_FISICA_MAE,
	b.nr_atendimento NR_ATENDIMENTO_RN,
	ped.cd_pessoa_fisica cd_pediatra,
	a.cd_pessoa_fisica CD_PESSOA_FISICA_RN
FROM pessoa_juridica d, compl_pessoa_fisica cpf, estabelecimento c, atendimento_paciente a
LEFT OUTER JOIN historico_saude_mulher hsm ON (a.cd_pessoa_fisica = hsm.cd_pessoa_fisica)
LEFT OUTER JOIN atendimento_gravidez ag ON (a.nr_atendimento = ag.nr_atendimento)
LEFT OUTER JOIN parto par ON (a.nr_atendimento = par.nr_atendimento)
LEFT OUTER JOIN med_pac_pre_natal h ON (a.nr_atendimento = h.nr_atendimento)
LEFT OUTER JOIN declaracao_obito dco ON (a.nr_atendimento = dco.nr_atendimento)
LEFT OUTER JOIN escala_silverman es ON (a.nr_atendimento = es.nr_atendimento)
LEFT OUTER JOIN atend_vacina_teste avt ON (a.nr_atendimento = avt.nr_atendimento)
LEFT OUTER JOIN atendimento_paciente apm ON (a.nr_atendimento = apm.nr_atendimento_mae)
LEFT OUTER JOIN vacina_teste_rn vtr ON (avt.nr_seq_teste_vacina = vtr.nr_sequencia)
, nascimento b
LEFT OUTER JOIN pessoa_fisica ped ON (b.cd_pediatra = ped.cd_pessoa_fisica)
LEFT OUTER JOIN person_name y ON (ped.nr_seq_person_name = y.nr_sequencia AND 'main' = y.ds_type)
, pessoa_fisica pf
LEFT OUTER JOIN person_name z ON (pf.nr_seq_person_name = z.nr_sequencia AND 'main' = z.ds_type)
WHERE a.nr_atendimento 	= b.nr_atendimento AND b.ie_tipo_nascimento    = 10 AND a.cd_estabelecimento	= c.cd_estabelecimento AND c.cd_cgc		= d.cd_cgc AND a.cd_pessoa_fisica	= pf.cd_pessoa_fisica AND a.cd_pessoa_fisica	= cpf.cd_pessoa_fisica;

