-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pep_result_item_prob_pact_v (dt_solicitacao, ds_item, ds_tipo, nr_sequencia, nr_seq_problema) AS SELECT b.dt_atualizacao      dt_solicitacao,
       substr(coalesce(Obter_Med_Exame_Externo(b.nr_sequencia),coalesce(b.DS_EXAME_SEM_CAD,substr(obter_descricao_procedimento(b.CD_PROCEDIMENTO,b.IE_ORIGEM_PROCED),1,240))),1,255) ds_item,
       obter_Desc_expressao(610596) ds_tipo,
       b.nr_sequencia,
       a.nr_seq_problema
FROM   soap_item_sintoma a,
       pedido_exame_externo_item b
WHERE  a.nr_seq_item_solic = b.nr_sequencia
and    a.NR_SEQ_SOLIC_EXAME is not null

union all

SELECT b.dt_atualizacao      dt_solicitacao,
       (obter_desc_material(b.cd_material)||' - ' || obter_desc_expressao(782876) ||': ' || c.dt_inicio_receita || ' - ' || obter_desc_expressao(688617) ||': ' || c.dt_validade_receita || ' - ' ||obter_desc_expressao(287753) ||': ' || c.nr_dias_receita) ,
       obter_Desc_expressao(314086) ds_tipo,
       b.nr_sequencia,
       a.nr_seq_problema
FROM   soap_item_sintoma a,
       fa_receita_farmacia_item b,
       fa_receita_farmacia c
WHERE  b.nr_seq_receita = c.nr_sequencia
and    a.NR_SEQ_MED_RECEITA = b.nr_sequencia
and    a.NR_SEQ_MED_RECEITA is not null

union all

SELECT a.dt_atualizacao      dt_solicitacao,
       CASE WHEN a.cd_medico_dest IS NULL THEN obter_desc_expressao(10651941) ||': ' ||substr(obter_desc_espec_medica(a.cd_especialidade),1,255)  ELSE obter_desc_expressao(325901) || ': ' || substr(obter_nome_pf(a.cd_medico_dest),1,255) END ,
       obter_Desc_expressao(289207) ds_tipo,
       a.nr_sequencia,
       a.nr_seq_problema
FROM   atend_encaminhamento a,
       ATEND_ENCAMINHAMENTO_PROBL b
WHERE  a.nr_sequencia = b.nr_seq_encaminhamento

union all

SELECT b.dt_procedimento      dt_solicitacao,
       Obter_Descricao_Procedimento(b.cd_procedimento,b.ie_origem_proced),
       obter_Desc_expressao(327207) ds_tipo,
       b.nr_sequencia,
       a.nr_seq_problema
FROM   soap_item_sintoma a,
       odont_procedimento b
WHERE  a.NR_SEQ_ODONT_PROC = b.nr_sequencia

union all

SELECT b.DT_ATUALIZACAO_NREC   dt_solicitacao,
       obter_desc_material(b.cd_material),
       obter_Desc_expressao(341573) ds_tipo,
       b.nr_sequencia,
       a.nr_seq_problema
FROM   prescr_item_sintoma a,
       cpoe_material b
WHERE  a.NR_SEQ_MEDIC = b.nr_sequencia
and coalesce(b.ie_material,'N') = 'N'

union all

SELECT b.DT_ATUALIZACAO_NREC   dt_solicitacao,
       cpoe_obter_desc_proc_interno(b.nr_seq_proc_interno),
       obter_Desc_expressao(614206) ds_tipo,
       b.nr_sequencia,
       a.nr_seq_problema
FROM   prescr_item_sintoma a,
       cpoe_procedimento b
WHERE  a.NR_SEQ_EXAME = b.nr_sequencia

union all

SELECT b.DT_ATUALIZACAO_NREC   dt_solicitacao,
       pep_get_ds_dieta_cpoe(b.cd_dieta, b.cd_material, b.cd_mat_prod1, b.nr_seq_tipo, b.nr_sequencia, b.ie_tipo_dieta),
       obter_Desc_expressao(294515) ds_tipo,
       b.nr_sequencia,
       a.nr_seq_problema
FROM   prescr_item_sintoma a,
       cpoe_dieta b
WHERE  a.NR_SEQ_DIETA = b.nr_sequencia

union all

SELECT b.DT_ATUALIZACAO_NREC   dt_solicitacao,
       substr(cpoe_obter_desc_recomendacao(b.cd_recomendacao,b.dt_liberacao),1,255),
       obter_Desc_expressao(297348) ds_tipo,
       b.nr_sequencia,
       a.nr_seq_problema
FROM   prescr_item_sintoma a,
       cpoe_recomendacao b
WHERE  a.nr_seq_recomendacao = b.nr_sequencia

union all

SELECT b.DT_ATUALIZACAO_NREC   dt_solicitacao,
       cpoe_obter_desc_info_hemote(b.nr_sequencia),
       obter_Desc_expressao(955702) ds_tipo,
       b.nr_sequencia,
       a.nr_seq_problema
FROM   prescr_item_sintoma a,
       cpoe_hemoterapia b
WHERE  a.nr_seq_hemoterapia = b.nr_sequencia

union all

SELECT b.DT_ATUALIZACAO_NREC   dt_solicitacao,
       CASE WHEN b.ie_tipo_dialise='DI' THEN  CASE WHEN b.ie_hemodialise='S' THEN  obter_desc_expressao(489925, '')  ELSE obter_desc_expressao(489926, '') END   ELSE initcap(obter_desc_expressao(314156, null)) END ,
       obter_Desc_expressao(287725) ds_tipo,
       b.nr_sequencia,
       a.nr_seq_problema
FROM   prescr_item_sintoma a,
       cpoe_dialise b
WHERE  a.nr_seq_dialise = b.nr_sequencia

union all

SELECT b.DT_ATUALIZACAO_NREC   dt_solicitacao,
       obter_desc_material(b.cd_material),
       obter_Desc_expressao(292949) ds_tipo,
       b.nr_sequencia,
       a.nr_seq_problema
FROM   prescr_item_sintoma a,
       cpoe_material b
WHERE  a.NR_SEQ_MEDIC = b.nr_sequencia
and    coalesce(ie_material,'N') = 'S' and  nr_seq_procedimento is null

union all

SELECT a.dt_atualizacao      dt_solicitacao,
       obter_desc_expressao(781448) ||': ' || c.nm_programa,
       obter_Desc_expressao(289207) ds_tipo,
       a.nr_sequencia,
       b.nr_seq_problema
FROM   atend_programa_saude a,
       atend_prog_saude_probl b,
       mprev_programa c
WHERE  a.nr_sequencia = b.nr_seq_prog_saude
and    c.nr_sequencia = a.nr_seq_programa_saude 
order by dt_solicitacao;

