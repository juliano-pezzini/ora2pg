-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW fis_lote_etiquetas_v (cd_cgc_fornec, ds_fornecedor, ds_lote_fornec, dt_validade, nr_sequencia, nr_digito_verif, qt_material, cd_material, ds_material, ds_generico, ds_red_material, ds_red_generico, nr_seq_marca, ds_marca, nm_fantasia, ds_red_mat_conta, nr_sequencia_nf, dt_impressao, ds_observacao) AS SELECT 	   	cd_cgc_fornec,
			obter_dados_pf_pj(null,cd_cgc_fornec,'N') ds_fornecedor,
			ds_lote_fornec,
			to_char(dt_validade, 'DD/MM/YYYY') dt_validade,
			nr_sequencia,
			nr_digito_verif,
			qt_material,
			cd_material,
			obter_dados_material(cd_material,'D') ds_material,
			CASE WHEN obter_dados_material(cd_material,'GEN') IS NULL THEN  obter_dados_material(cd_material,'D')  ELSE obter_dados_material(obter_dados_material(cd_material,'GEN'),'D') END  ds_generico,
			obter_dados_material(cd_material,'D') ds_red_material,
			CASE WHEN obter_dados_material(cd_material,'GEN') IS NULL THEN  obter_dados_material(cd_material,'DR')  ELSE obter_dados_material(obter_dados_material(cd_material,'GEN'),'DR') END  ds_red_generico,
			nr_seq_marca,
			obter_desc_marca(nr_seq_marca) ds_marca,
			substr(obter_dados_pf_pj(NULL, cd_cgc_fornec, 'F'), 1, 80) nm_fantasia,
			substr(obter_desc_redu_material(obter_dados_material_estab(cd_material, cd_estabelecimento, 'MC')), 1, 255) ds_red_mat_conta,
			nr_sequencia_nf,
			dt_impressao,
			ds_observacao
FROM		material_lote_fornec
WHERE		substr(obter_se_imprime_lote_nota(cd_material, cd_estabelecimento), 1, 1) = 'S'
and			substr(obter_se_lote_desdobrado(cd_material, cd_estabelecimento), 1, 1)  = 'N'

UNION

SELECT  DISTINCT cd_cgc_fornec,
		obter_dados_pf_pj(null,cd_cgc_fornec,'N') ds_fornecedor,
		ds_lote_fornec,
		to_char(dt_validade, 'DD/MM/YYYY') dt_validade,
		0 nr_sequencia,
		0 nr_digito_verif,
		qt_material,
		cd_material,
		obter_dados_material(cd_material,'D') ds_material,
		CASE WHEN obter_dados_material(cd_material,'GEN') IS NULL THEN  obter_dados_material(cd_material,'D')  ELSE obter_dados_material(obter_dados_material(cd_material,'GEN'),'D') END  ds_generico,
		obter_dados_material(cd_material,'D') ds_red_material,
		CASE WHEN obter_dados_material(cd_material,'GEN') IS NULL THEN  obter_dados_material(cd_material,'D')  ELSE obter_dados_material(obter_dados_material(cd_material,'GEN'),'D') END  ds_red_generico,
		nr_seq_marca,
		obter_desc_marca(nr_seq_marca) ds_marca,
		substr(obter_dados_pf_pj(NULL, cd_cgc_fornec, 'F'), 1, 80) nm_fantasia,
		substr(obter_desc_redu_material(obter_dados_material_estab(cd_material, cd_estabelecimento, 'MC')), 1, 255) ds_red_mat_conta,
		nr_sequencia_nf,
		dt_impressao,
		ds_observacao		
FROM	material_lote_fornec
WHERE	substr(obter_se_imprime_lote_nota(cd_material, cd_estabelecimento), 1, 1) = 'S'
and		substr(obter_se_lote_desdobrado(cd_material, cd_estabelecimento), 1, 1)  = 'S';

