-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ocupacao_higienizacao_v (ds_ocupacao, cd_unidade_basica, cd_unidade_compl, ie_status, ie_temporario, nr_seq_interno, cd_setor_atendimento, cd_pessoa_fisica) AS select 	coalesce(ds_ocupacao,cd_unidade_basica) ds_ocupacao,
	cd_unidade_basica, 
	cd_unidade_compl, 
	substr(sl_obter_status_unidade(a.cd_setor_atendimento,cd_unidade_basica,cd_unidade_compl,LOCALTIMESTAMP),1,5) ie_status, 
	ie_temporario, 
	nr_seq_interno, 
	a.cd_setor_atendimento, 
	b.cd_pessoa_fisica 
FROM valor_dominio g, pessoa_fisica e, atendimento_paciente b
LEFT OUTER JOIN medico d ON (b.cd_medico_resp = d.cd_pessoa_fisica)
, unidade_atendimento a
LEFT OUTER JOIN pessoa_fisica f ON (a.cd_paciente_reserva = f.cd_pessoa_fisica)
WHERE a.nr_atendimento   = b.nr_atendimento and b.cd_pessoa_fisica  = e.cd_pessoa_fisica  and a.ie_situacao     = 'A' and a.ie_status_unidade  = 'P'    
union
 
select 	coalesce(ds_ocupacao,cd_unidade_basica) ds_ocupacao, 
	cd_unidade_basica, 
	cd_unidade_compl, 
	substr(sl_obter_status_unidade(a.cd_setor_atendimento,cd_unidade_basica,cd_unidade_compl,LOCALTIMESTAMP),1,5) ie_status, 
	ie_temporario, 
	nr_seq_interno, 
	a.cd_setor_atendimento, 
	b.cd_pessoa_fisica 
FROM valor_dominio g, pessoa_fisica f, pessoa_fisica e, unidade_atendimento a, atendimento_paciente b
LEFT OUTER JOIN medico d ON (b.cd_medico_resp = d.cd_pessoa_fisica)
WHERE a.nr_atendimento_acomp= b.nr_atendimento and b.cd_pessoa_fisica  = e.cd_pessoa_fisica  and a.ie_situacao     = 'A' and a.ie_status_unidade  = 'M' and a.cd_paciente_reserva = f.cd_pessoa_fisica   
union
 
select 	coalesce(ds_ocupacao,cd_unidade_basica) ds_ocupacao, 
	cd_unidade_basica, 
	cd_unidade_compl, 
	substr(sl_obter_status_unidade(a.cd_setor_atendimento,cd_unidade_basica,cd_unidade_compl,LOCALTIMESTAMP),1,5) ie_status, 
	ie_temporario, 
	nr_seq_interno, 
	a.cd_setor_atendimento, 
	f.cd_pessoa_fisica 
from 	valor_dominio b, 
  	 pessoa_fisica f, 
	unidade_atendimento a 
where	 a.cd_paciente_reserva = f.cd_pessoa_fisica 
 and 	a.ie_situacao     = 'A' 
 and 	a.ie_status_unidade  in ('R','H','G','A','E','C') 
 and 	b.cd_dominio 		= 82 
 and 	b.vl_dominio		= a.ie_status_unidade 

union
 
select 	coalesce(ds_ocupacao,cd_unidade_basica) ds_ocupacao, 
	cd_unidade_basica, 
	cd_unidade_compl, 
	substr(sl_obter_status_unidade(a.cd_setor_atendimento,cd_unidade_basica,cd_unidade_compl,LOCALTIMESTAMP),1,5) ie_status, 
	ie_temporario, 
	nr_seq_interno, 
	a.cd_setor_atendimento, 
	null cd_pessoa_fisica 
from 	valor_dominio b, 
	unidade_atendimento a 
where	 a.ie_situacao     = 'A' 
 and 	a.ie_status_unidade in ('R','L', 'H', 'G', 'A','O','E','C') 
 and 	a.cd_paciente_reserva is null 
 and 	b.cd_dominio 		= 82 
 and 	b.vl_dominio		= a.ie_status_unidade 

union
 
select 	coalesce(ds_ocupacao,cd_unidade_basica) ds_ocupacao, 
	cd_unidade_basica, 
	cd_unidade_compl, 
	substr(sl_obter_status_unidade(a.cd_setor_atendimento,cd_unidade_basica,cd_unidade_compl,LOCALTIMESTAMP),1,5) ie_status, 
	ie_temporario, 
	nr_seq_interno, 
	a.cd_setor_atendimento, 
	null cd_pessoa_fisica 
FROM motivo_interdicao_leito b, unidade_atendimento a 
WHERE a.ie_status_unidade in ('I','S')  and a.ie_situacao = 'A';

