-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW processo_atendimento_v (nr_atendimento, cd_processo, nr_sequencia, ie_status, nr_min_prev, dt_fim_prev, dt_atualizacao, nm_usuario, dt_fim_real, cd_setor_resp, cd_pessoa_fisica_resp, cd_cgc_resp, nm_usuario_resp, cd_pessoa_resp_atraso, ds_motivo_atraso, dt_inicio_prev, nr_min_real, nr_proc_sist, nr_proc_usuario) AS select a.NR_ATENDIMENTO,a.CD_PROCESSO,a.NR_SEQUENCIA,a.IE_STATUS,a.NR_MIN_PREV,a.DT_FIM_PREV,a.DT_ATUALIZACAO,a.NM_USUARIO,a.DT_FIM_REAL,a.CD_SETOR_RESP,a.CD_PESSOA_FISICA_RESP,a.CD_CGC_RESP,a.NM_USUARIO_RESP,a.CD_PESSOA_RESP_ATRASO,a.DS_MOTIVO_ATRASO,
	   (a.dt_fim_prev - (a.nr_min_prev /1440)) dt_Inicio_prev,
	   CASE WHEN ie_status='S' THEN  nr_min_prev  ELSE Round(((a.dt_fim_real - a.dt_fim_prev) * 1440) + nr_min_prev) END  							nr_min_real,
         CASE WHEN a.ie_status='S' THEN  1  ELSE 0 END  nr_proc_Sist,
         CASE WHEN a.ie_status='S' THEN  0  ELSE 1 END  nr_proc_Usuario
FROM processo_atendimento a
where a.dt_fim_real is not null;

