-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_demonstrativo_serv_fat_v (nr_seq_lote_fat, nr_seq_fatura, dt_mesano_referencia, nr_seq_segurado, cd_usuario_plano, nm_beneficiario_conta, dt_emissao_guia, cd_proc, ds_proc, ds_grau_participacao, vl_liberado, vl_liberado_hi, vl_liberado_co, vl_liberado_material, vl_unitario, vl_administracao, vl_faturado, cd_prestador, qt_item, nr_contrato, cd_guia, nr_seq_item, nr_seq_grau_partic, dt_atendimento, vl_glosa, ie_grupo_evento, nr_seq_plano, ds_plano, ds_ato_cooperado, ie_tipo_guia) AS select	a.nr_sequencia nr_seq_lote_fat,
	b.nr_sequencia nr_seq_fatura, 
	a.dt_mesano_referencia, 
	d.nr_seq_segurado, 
	substr(pls_obter_dados_segurado(d.nr_seq_segurado, 'C'),1,255) cd_usuario_plano, 
	substr(pls_obter_dados_segurado(d.nr_seq_segurado,'N'),1,255) nm_beneficiario_conta, 
	e.dt_emissao dt_emissao_guia, 
	coalesce(substr(pls_obter_dados_conta_pos(f.nr_seq_conta_pos_estab,'CP'),1,255),substr(pls_obter_dados_conta_proc(f.nr_seq_conta_proc,'C'),1,255)) cd_proc, 
	coalesce(substr(pls_obter_dados_conta_pos(f.nr_seq_conta_pos_estab,'DP'),1,255),substr(pls_obter_dados_conta_proc(f.nr_seq_conta_proc,'D'),1,255)) ds_proc, 
	(select	x.ds_grau_participacao 
	FROM	pls_grau_participacao	x 
	where	x.nr_sequencia = e.nr_seq_grau_partic) ds_grau_participacao, 
	coalesce(g.vl_liberado,0) vl_liberado, 
	coalesce(g.vl_liberado_hi,0) vl_liberado_hi, 
	coalesce(g.vl_liberado_co,0) vl_liberado_co, 
	coalesce(g.vl_liberado_material,0) vl_liberado_material, 
	coalesce(g.vl_unitario, 0) vl_unitario, 
	coalesce(i.vl_administracao,0) vl_administracao, 
	coalesce(f.vl_faturado,0) vl_faturado, 
	substr(pls_obter_cod_prestador(e.nr_seq_prestador_exec,null),1,255) cd_prestador, 
	coalesce(g.qt_procedimento, 0) qt_item, 
	(select	x.nr_contrato 
	FROM pls_contrato_pagador y
LEFT OUTER JOIN pls_contrato x ON (y.nr_seq_contrato = x.nr_sequencia)
WHERE y.nr_sequencia		= b.nr_seq_pagador ) nr_contrato, 
	e.cd_guia, 
	f.nr_seq_conta_proc nr_seq_item, 
	e.nr_seq_grau_partic, 
	g.dt_procedimento dt_atendimento, 
	g.vl_glosa, 
	k.ie_grupo_evento, 
	h.nr_seq_plano, 
	l.ds_plano, 
	substr(obter_valor_dominio(3418,ie_ato_cooperado),1,255) ds_ato_cooperado, 
	e.ie_tipo_guia 
FROM pls_conta_pos_estabelecido i, pls_conta_proc g, pls_fatura_proc f, pls_fatura_conta d, pls_fatura_evento c, pls_fatura b, pls_lote_faturamento a, pls_segurado h
LEFT OUTER JOIN pls_plano l ON (h.nr_seq_plano = l.nr_sequencia)
, pls_conta e
LEFT OUTER JOIN pls_tipo_atendimento k ON (e.nr_seq_tipo_atendimento = k.nr_sequencia)
WHERE a.nr_sequencia = i.nr_seq_lote_fat --and	c.nr_sequencia = i.nr_seq_evento_fat 
  and g.nr_sequencia = f.nr_seq_conta_proc and d.nr_sequencia = f.nr_seq_fatura_conta and e.nr_sequencia = d.nr_seq_conta and c.nr_sequencia = d.nr_seq_fatura_evento and b.nr_sequencia = c.nr_seq_fatura and a.nr_sequencia = b.nr_seq_lote and h.nr_sequencia = e.nr_seq_segurado   
union all
 
select	a.nr_sequencia nr_seq_lote_fat, 
	b.nr_sequencia nr_seq_fatura, 
	a.dt_mesano_referencia, 
	d.nr_seq_segurado, 
	substr(pls_obter_dados_segurado(d.nr_seq_segurado, 'C'),1,255) cd_usuario_plano, 
	substr(pls_obter_dados_segurado(d.nr_seq_segurado,'N'),1,255) nm_beneficiario_conta, 
	e.dt_emissao dt_emissao_guia, 
	substr(pls_obter_dados_conta_mat(f.nr_seq_conta_mat,'C'),1,255) cd_proc, 
	substr(pls_obter_dados_conta_mat(f.nr_seq_conta_mat,'D'),1,255) ds_proc, 
	(select	x.ds_grau_participacao 
	from	pls_grau_participacao	x 
	where	x.nr_sequencia = e.nr_seq_grau_partic) ds_grau_participacao, 
	coalesce(g.vl_liberado,0) vl_liberado, 
	0 vl_liberado_hi, 
	0 vl_liberado_co, 
	0 vl_liberado_mat, 
	coalesce(g.vl_unitario, 0) vl_unitario, 
	coalesce(i.vl_administracao, 0) vl_administracao, 
	coalesce(f.vl_faturado, 0) vl_faturado, 
	substr(pls_obter_cod_prestador(e.nr_seq_prestador_exec,null),1,255) cd_prestador, 
	coalesce(g.qt_material,0) qt_item, 
	(select	x.nr_contrato 
	FROM pls_contrato_pagador y
LEFT OUTER JOIN pls_contrato x ON (y.nr_seq_contrato = x.nr_sequencia)
WHERE y.nr_sequencia		= b.nr_seq_pagador ) nr_contrato, 
	e.cd_guia, 
	f.nr_seq_conta_mat nr_seq_item, 
	e.nr_seq_grau_partic, 
	g.dt_atendimento, 
	g.vl_glosa, 
	k.ie_grupo_evento, 
	h.nr_seq_plano, 
	l.ds_plano, 
	substr(obter_valor_dominio(3418,ie_ato_cooperado),1,255) ds_ato_cooperado, 
	e.ie_tipo_guia 
FROM pls_conta_pos_estabelecido i, pls_conta_mat g, pls_fatura_mat f, pls_fatura_conta d, pls_fatura_evento c, pls_fatura b, pls_lote_faturamento a, pls_segurado h
LEFT OUTER JOIN pls_plano l ON (h.nr_seq_plano = l.nr_sequencia)
, pls_conta e
LEFT OUTER JOIN pls_tipo_atendimento k ON (e.nr_seq_tipo_atendimento = k.nr_sequencia)
WHERE a.nr_sequencia = i.nr_seq_lote_fat --and	c.nr_sequencia = i.nr_seq_evento_fat 
  and g.nr_sequencia = f.nr_seq_conta_mat and d.nr_sequencia = f.nr_seq_fatura_conta and e.nr_sequencia = d.nr_seq_conta and c.nr_sequencia = d.nr_seq_fatura_evento and b.nr_sequencia = c.nr_seq_fatura and a.nr_sequencia = b.nr_seq_lote and h.nr_sequencia = e.nr_seq_segurado;

