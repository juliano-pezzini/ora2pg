-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_aux_event_cop_co_v (ie_cursor, ie_copartic_faturar, ie_mens_item_conta, nr_seq_conta, nr_seq_conta_resumo, nr_seq_conta_proc, nr_seq_copart, nr_seq_copart_contab, nr_seq_mensalidade_seg, nr_seq_item_mens, nr_seq_mens_seg, nr_seq_mensalidade, nr_seq_lote_mens, dt_mes_competencia, nr_seq_prestador_pgto, ie_ato_cooperado, cd_conta_deb_provisao, cd_conta_cred_provisao, vl_coparticipacao, dt_mesano_referencia, nr_seq_conta_proc_mat, dt_ocorrencia, cd_material_ops, cd_procedimento, ie_origem_proced, ds_item_mat_proc, nr_seq_grupo_ans, ds_grupo_ans, vl_provisao, ie_status_coparticipacao, dt_atualizacao, ie_tipo_grupo_ans) AS select	1 ie_cursor,
	'N' ie_copartic_faturar,
	'N' ie_mens_item_conta,
	y.nr_seq_conta,
	z.nr_seq_conta_resumo,
	y.nr_seq_conta_proc,
	y.nr_sequencia nr_seq_copart,
	z.nr_sequencia nr_seq_copart_contab,
	y.nr_seq_mensalidade_seg,
	null nr_seq_item_mens,
	null nr_seq_mens_seg,
	null nr_seq_mensalidade,
	null nr_seq_lote_mens,
	z.dt_mes_competencia,
	z.nr_seq_prestador_pgto,
	z.ie_ato_cooperado,
	z.cd_conta_deb_provisao,
	z.cd_conta_cred_provisao,
	z.vl_coparticipacao,
	null dt_mesano_referencia,
	a.nr_seq_conta nr_seq_conta_proc_mat,
	a.dt_procedimento dt_ocorrencia,
	null cd_material_ops,
	a.cd_procedimento,
	a.ie_origem_proced,
	substr(obter_descricao_procedimento(a.cd_procedimento,a.ie_origem_proced),1,255) ds_item_mat_proc,
	a.nr_seq_grupo_ans,
	substr(pls_obter_dados_grupo_ans(a.nr_seq_grupo_ans,'D'),1,255) ds_grupo_ans,
	a.vl_provisao,
	y.ie_status_coparticipacao,
	null dt_atualizacao,
	k.ie_tipo_grupo_ans
FROM pls_conta_copartic_contab z, pls_conta_coparticipacao y, pls_conta_proc a
LEFT OUTER JOIN ans_grupo_despesa k ON (a.nr_seq_grupo_ans = k.nr_sequencia)
WHERE y.nr_sequencia		= z.nr_seq_conta_copartic and a.nr_sequencia		= y.nr_seq_conta_proc  and z.vl_coparticipacao <> 0 and a.ie_status not in ('D','M') and not exists (	select	1
			from	pls_conta_copartic_log	x
			where	x.nr_seq_copartic_contab	= z.nr_sequencia
			and	x.ie_tipo_registro		= 'S'
			and	1 = 2)

union all

select	2 ie_cursor,
	'N' ie_copartic_faturar,
	'N' ie_mens_item_conta,
	y.nr_seq_conta,
	z.nr_seq_conta_resumo,
	y.nr_seq_conta_proc,
	y.nr_sequencia nr_seq_copart,
	z.nr_sequencia nr_seq_copart_contab,
	y.nr_seq_mensalidade_seg,
	null nr_seq_item_mens,
	null nr_seq_mens_seg,
	null nr_seq_mensalidade,
	null nr_seq_lote_mens,
	z.dt_mes_competencia,
	z.nr_seq_prestador_pgto,
	z.ie_ato_cooperado,
	z.cd_conta_deb_provisao,
	z.cd_conta_cred_provisao,
	z.vl_coparticipacao,
	null dt_mesano_referencia,
	a.nr_seq_conta nr_seq_conta_proc_mat,
	a.dt_atendimento dt_ocorrencia,
	substr(pls_obter_dados_conta_mat(a.nr_sequencia,'O'),1,255) cd_material_ops,
	null cd_procedimento,
	null ie_origem_proced,
	substr(pls_obter_dados_conta_mat(a.nr_sequencia,'D'),1,255) ds_item_mat_proc,
	a.nr_seq_grupo_ans,
	substr(pls_obter_dados_grupo_ans(a.nr_seq_grupo_ans,'D'),1,255) ds_grupo_ans,
	a.vl_provisao,
	y.ie_status_coparticipacao,
	null dt_atualizacao,
	k.ie_tipo_grupo_ans
FROM pls_conta_copartic_contab z, pls_conta_coparticipacao y, pls_conta_mat a
LEFT OUTER JOIN ans_grupo_despesa k ON (a.nr_seq_grupo_ans = k.nr_sequencia)
WHERE y.nr_sequencia		= z.nr_seq_conta_copartic and a.nr_sequencia		= y.nr_seq_conta_mat  and z.vl_coparticipacao <> 0 and a.ie_status not in ('D','M') and not exists (	select	1
			from	pls_conta_copartic_log	x
			where	x.nr_seq_copartic_contab	= z.nr_sequencia
			and	x.ie_tipo_registro		= 'S'
			and	1 = 2)
 
union all

select	3 ie_cursor,
	'N' ie_copartic_faturar,
	'N' ie_mens_item_conta,
	y.nr_seq_conta,
	z.nr_seq_conta_resumo,
	y.nr_seq_conta_proc,
	y.nr_sequencia nr_seq_copart,
	z.nr_sequencia nr_seq_copart_contab,
	y.nr_seq_mensalidade_seg,
	null nr_seq_item_mens,
	null nr_seq_mens_seg,
	null nr_seq_mensalidade,
	null nr_seq_lote_mens,
	z.dt_mes_competencia,
	z.nr_seq_prestador_pgto,
	z.ie_ato_cooperado,
	z.cd_conta_deb_provisao,
	z.cd_conta_cred_provisao,
	coalesce(lg.vl_coparticipacao - lg.vl_coparticipacao_old,0) vl_coparticipacao,
	null dt_mesano_referencia,
	a.nr_seq_conta nr_seq_conta_proc_mat,
	a.dt_procedimento dt_ocorrencia,
	null cd_material_ops,
	a.cd_procedimento,
	a.ie_origem_proced,
	substr(obter_descricao_procedimento(a.cd_procedimento,a.ie_origem_proced),1,255) ds_item_mat_proc,
	a.nr_seq_grupo_ans,
	substr(pls_obter_dados_grupo_ans(a.nr_seq_grupo_ans,'D'),1,255) ds_grupo_ans,
	a.vl_provisao,
	y.ie_status_coparticipacao,
	lg.dt_atualizacao,
	k.ie_tipo_grupo_ans
FROM pls_conta_copartic_contab z, pls_conta_coparticipacao y, pls_conta_copartic_log lg, pls_conta_proc a
LEFT OUTER JOIN ans_grupo_despesa k ON (a.nr_seq_grupo_ans = k.nr_sequencia)
WHERE z.nr_sequencia		= lg.nr_seq_copartic_contab and y.nr_sequencia		= z.nr_seq_conta_copartic and a.nr_sequencia		= y.nr_seq_conta_proc  and z.vl_coparticipacao	<> 0 and a.ie_status not in ('D','M') and lg.ie_tipo_registro	= 'S' and 1 = 2
 
union all

select	4 ie_cursor,
	'N' ie_copartic_faturar,
	'N' ie_mens_item_conta,
	y.nr_seq_conta,
	z.nr_seq_conta_resumo,
	y.nr_seq_conta_proc,
	y.nr_sequencia nr_seq_copart,
	z.nr_sequencia nr_seq_copart_contab,
	y.nr_seq_mensalidade_seg,
	null nr_seq_item_mens,
	null nr_seq_mens_seg,
	null nr_seq_mensalidade,
	null nr_seq_lote_mens,
	z.dt_mes_competencia,
	z.nr_seq_prestador_pgto,
	z.ie_ato_cooperado,
	z.cd_conta_deb_provisao,
	z.cd_conta_cred_provisao,
	coalesce(lg.vl_coparticipacao - lg.vl_coparticipacao_old,0) vl_coparticipacao,
	null dt_mesano_referencia,
	a.nr_seq_conta nr_seq_conta_proc_mat,
	a.dt_atendimento dt_ocorrencia,
	substr(pls_obter_dados_conta_mat(a.nr_sequencia,'O'),1,255) cd_material_ops,
	null cd_procedimento,
	null ie_origem_proced,
	substr(pls_obter_dados_conta_mat(a.nr_sequencia,'D'),1,255) ds_item_mat_proc,
	a.nr_seq_grupo_ans,
	substr(pls_obter_dados_grupo_ans(a.nr_seq_grupo_ans,'D'),1,255) ds_grupo_ans,
	a.vl_provisao,
	y.ie_status_coparticipacao,
	lg.dt_atualizacao,
	k.ie_tipo_grupo_ans
FROM pls_conta_copartic_contab z, pls_conta_coparticipacao y, pls_conta_copartic_log lg, pls_conta_mat a
LEFT OUTER JOIN ans_grupo_despesa k ON (a.nr_seq_grupo_ans = k.nr_sequencia)
WHERE z.nr_sequencia		= lg.nr_seq_copartic_contab and y.nr_sequencia		= z.nr_seq_conta_copartic and a.nr_sequencia		= y.nr_seq_conta_mat  and z.vl_coparticipacao	<> 0 and a.ie_status not in ('D','M') and lg.ie_tipo_registro	= 'S' and 1 = 2
 
union all

select	5 ie_cursor,
	'S' ie_copartic_faturar,
	'N' ie_mens_item_conta,
	y.nr_seq_conta,
	z.nr_seq_conta_resumo,
	y.nr_seq_conta_proc,
	y.nr_sequencia nr_seq_copart,
	z.nr_sequencia nr_seq_copart_contab,
	y.nr_seq_mensalidade_seg,
	null nr_seq_item_mens,
	null nr_seq_mens_seg,
	null nr_seq_mensalidade,
	null nr_seq_lote_mens,
	z.dt_mes_competencia,
	z.nr_seq_prestador_pgto,
	z.ie_ato_cooperado,
	z.cd_conta_deb_provisao,
	z.cd_conta_cred_provisao,
	z.vl_coparticipacao,
	l.dt_mesano_referencia,
	a.nr_seq_conta nr_seq_conta_proc_mat,
	a.dt_procedimento dt_ocorrencia,
	null cd_material_ops,
	a.cd_procedimento,
	a.ie_origem_proced,
	substr(obter_descricao_procedimento(a.cd_procedimento,a.ie_origem_proced),1,255) ds_item_mat_proc,
	a.nr_seq_grupo_ans,
	substr(pls_obter_dados_grupo_ans(a.nr_seq_grupo_ans,'D'),1,255) ds_grupo_ans,
	a.vl_provisao,
	y.ie_status_coparticipacao,
	null dt_atualizacao,
	k.ie_tipo_grupo_ans
FROM pls_conta_copartic_contab z, pls_conta_coparticipacao y
LEFT OUTER JOIN pls_mensalidade_segurado s ON (y.nr_seq_mensalidade_seg = s.nr_sequencia)
LEFT OUTER JOIN pls_mensalidade m ON (s.nr_seq_mensalidade = m.nr_sequencia)
LEFT OUTER JOIN pls_lote_mensalidade l ON (m.nr_seq_lote = l.nr_sequencia)
, pls_conta_proc a
LEFT OUTER JOIN ans_grupo_despesa k ON (a.nr_seq_grupo_ans = k.nr_sequencia)
WHERE y.nr_sequencia			= z.nr_seq_conta_copartic and a.nr_sequencia			= y.nr_seq_conta_proc     and y.nr_seq_mensalidade_seg is not null and z.vl_coparticipacao <> 0 and a.ie_status not in ('D','M') and not exists (	select	1
			from	pls_conta_copartic_log	x
			where	x.nr_seq_copartic_contab	= z.nr_sequencia
			and	x.ie_tipo_registro		= 'S'
			and	1 = 2) and not exists (	select	1
			from	pls_mensalidade_item_conta ic
			where	ic.nr_seq_conta_copartic = y.nr_sequencia)
 
union all

select	6 ie_cursor,
	'S' ie_copartic_faturar,
	'N' ie_mens_item_conta,
	y.nr_seq_conta,
	z.nr_seq_conta_resumo,
	y.nr_seq_conta_proc,
	y.nr_sequencia nr_seq_copart,
	z.nr_sequencia nr_seq_copart_contab,
	y.nr_seq_mensalidade_seg,
	null nr_seq_item_mens,
	null nr_seq_mens_seg,
	null nr_seq_mensalidade,
	null nr_seq_lote_mens,
	z.dt_mes_competencia,
	z.nr_seq_prestador_pgto,
	z.ie_ato_cooperado,
	z.cd_conta_deb_provisao,
	z.cd_conta_cred_provisao,
	z.vl_coparticipacao,
	l.dt_mesano_referencia,
	a.nr_seq_conta nr_seq_conta_proc_mat,
	a.dt_atendimento dt_ocorrencia,
	substr(pls_obter_dados_conta_mat(a.nr_sequencia,'O'),1,255) cd_material_ops,
	null cd_procedimento,
	null ie_origem_proced,
	substr(pls_obter_dados_conta_mat(a.nr_sequencia,'D'),1,255) ds_item_mat_proc,
	a.nr_seq_grupo_ans,
	substr(pls_obter_dados_grupo_ans(a.nr_seq_grupo_ans,'D'),1,255) ds_grupo_ans,
	a.vl_provisao,
	y.ie_status_coparticipacao,
	null dt_atualizacao,
	k.ie_tipo_grupo_ans
FROM pls_conta_copartic_contab z, pls_conta_coparticipacao y
LEFT OUTER JOIN pls_mensalidade_segurado s ON (y.nr_seq_mensalidade_seg = s.nr_sequencia)
LEFT OUTER JOIN pls_mensalidade m ON (s.nr_seq_mensalidade = m.nr_sequencia)
LEFT OUTER JOIN pls_lote_mensalidade l ON (m.nr_seq_lote = l.nr_sequencia)
, pls_conta_mat a
LEFT OUTER JOIN ans_grupo_despesa k ON (a.nr_seq_grupo_ans = k.nr_sequencia)
WHERE y.nr_sequencia			= z.nr_seq_conta_copartic and a.nr_sequencia			= y.nr_seq_conta_mat     and y.nr_seq_mensalidade_seg is not null and z.vl_coparticipacao <> 0 and a.ie_status not in ('D','M') and not exists (	select	1
			from	pls_conta_copartic_log	x
			where	x.nr_seq_copartic_contab	= z.nr_sequencia
			and	x.ie_tipo_registro		= 'S'
			and	1 = 2) and not exists (	select	1
			from	pls_mensalidade_item_conta ic
			where	ic.nr_seq_conta_copartic = y.nr_sequencia)
 
union all

select	7 ie_cursor,
	'S' ie_copartic_faturar,
	'N' ie_mens_item_conta,
	y.nr_seq_conta,
	z.nr_seq_conta_resumo,
	y.nr_seq_conta_proc,
	y.nr_sequencia nr_seq_copart,
	z.nr_sequencia nr_seq_copart_contab,
	y.nr_seq_mensalidade_seg,
	null nr_seq_item_mens,
	null nr_seq_mens_seg,
	null nr_seq_mensalidade,
	null nr_seq_lote_mens,
	z.dt_mes_competencia,
	z.nr_seq_prestador_pgto,
	z.ie_ato_cooperado,
	z.cd_conta_deb_provisao,
	z.cd_conta_cred_provisao,
	coalesce(lg.vl_coparticipacao - lg.vl_coparticipacao_old,0) vl_coparticipacao,
	l.dt_mesano_referencia,
	a.nr_seq_conta nr_seq_conta_proc_mat,
	a.dt_procedimento dt_ocorrencia,
	null cd_material_ops,
	a.cd_procedimento,
	a.ie_origem_proced,
	substr(obter_descricao_procedimento(a.cd_procedimento,a.ie_origem_proced),1,255) ds_item_mat_proc,
	a.nr_seq_grupo_ans,
	substr(pls_obter_dados_grupo_ans(a.nr_seq_grupo_ans,'D'),1,255) ds_grupo_ans,
	a.vl_provisao,
	y.ie_status_coparticipacao,
	lg.dt_atualizacao,
	k.ie_tipo_grupo_ans
FROM pls_conta_copartic_contab z, pls_conta_copartic_log lg, pls_conta_coparticipacao y
LEFT OUTER JOIN pls_mensalidade_segurado s ON (y.nr_seq_mensalidade_seg = s.nr_sequencia)
LEFT OUTER JOIN pls_mensalidade m ON (s.nr_seq_mensalidade = m.nr_sequencia)
LEFT OUTER JOIN pls_lote_mensalidade l ON (m.nr_seq_lote = l.nr_sequencia)
, pls_conta_proc a
LEFT OUTER JOIN ans_grupo_despesa k ON (a.nr_seq_grupo_ans = k.nr_sequencia)
WHERE z.nr_sequencia			= lg.nr_seq_copartic_contab and y.nr_sequencia			= z.nr_seq_conta_copartic and a.nr_sequencia			= y.nr_seq_conta_proc     and y.nr_seq_mensalidade_seg is not null and z.vl_coparticipacao	<> 0 and a.ie_status not in ('D','M') and lg.ie_tipo_registro	= 'S' and 1 = 2 and not exists (	select	1
			from	pls_mensalidade_item_conta ic
			where	ic.nr_seq_conta_copartic = y.nr_sequencia)
 
union all

select	8 ie_cursor,
	'S' ie_copartic_faturar,
	'N' ie_mens_item_conta,
	y.nr_seq_conta,
	z.nr_seq_conta_resumo,
	y.nr_seq_conta_proc,
	y.nr_sequencia nr_seq_copart,
	z.nr_sequencia nr_seq_copart_contab,
	y.nr_seq_mensalidade_seg,
	null nr_seq_item_mens,
	null nr_seq_mens_seg,
	null nr_seq_mensalidade,
	null nr_seq_lote_mens,
	z.dt_mes_competencia,
	z.nr_seq_prestador_pgto,
	z.ie_ato_cooperado,
	z.cd_conta_deb_provisao,
	z.cd_conta_cred_provisao,
	coalesce(lg.vl_coparticipacao - lg.vl_coparticipacao_old,0) vl_coparticipacao,
	l.dt_mesano_referencia,
	a.nr_seq_conta nr_seq_conta_proc_mat,
	a.dt_atendimento dt_ocorrencia,
	substr(pls_obter_dados_conta_mat(a.nr_sequencia,'O'),1,255) cd_material_ops,
	null cd_procedimento,
	null ie_origem_proced,
	substr(pls_obter_dados_conta_mat(a.nr_sequencia,'D'),1,255) ds_item_mat_proc,
	a.nr_seq_grupo_ans,
	substr(pls_obter_dados_grupo_ans(a.nr_seq_grupo_ans,'D'),1,255) ds_grupo_ans,
	a.vl_provisao,
	y.ie_status_coparticipacao,
	lg.dt_atualizacao,
	k.ie_tipo_grupo_ans
FROM pls_conta_copartic_contab z, pls_conta_copartic_log lg, pls_conta_coparticipacao y
LEFT OUTER JOIN pls_mensalidade_segurado s ON (y.nr_seq_mensalidade_seg = s.nr_sequencia)
LEFT OUTER JOIN pls_mensalidade m ON (s.nr_seq_mensalidade = m.nr_sequencia)
LEFT OUTER JOIN pls_lote_mensalidade l ON (m.nr_seq_lote = l.nr_sequencia)
, pls_conta_mat a
LEFT OUTER JOIN ans_grupo_despesa k ON (a.nr_seq_grupo_ans = k.nr_sequencia)
WHERE z.nr_sequencia			= lg.nr_seq_copartic_contab and y.nr_sequencia			= z.nr_seq_conta_copartic and a.nr_sequencia			= y.nr_seq_conta_mat     and y.nr_seq_mensalidade_seg is not null and z.vl_coparticipacao	<> 0 and 1 = 2 and a.ie_status not in ('D','M') and lg.ie_tipo_registro	= 'S' and not exists (	select	1
			from	pls_mensalidade_item_conta ic
			where	ic.nr_seq_conta_copartic = y.nr_sequencia)
 
union all

select	9 ie_cursor,
	'S' ie_copartic_faturar,
	'S' ie_mens_item_conta,
	y.nr_seq_conta,
	z.nr_seq_conta_resumo,
	y.nr_seq_conta_proc,
	y.nr_sequencia nr_seq_copart,
	z.nr_sequencia nr_seq_copart_contab,
	y.nr_seq_mensalidade_seg,
	null nr_seq_item_mens,
	null nr_seq_mens_seg,
	null nr_seq_mensalidade,
	null nr_seq_lote_mens,
	z.dt_mes_competencia,
	z.nr_seq_prestador_pgto,
	z.ie_ato_cooperado,
	z.cd_conta_deb_provisao,
	z.cd_conta_cred_provisao,
	z.vl_coparticipacao,
	null dt_mesano_referencia,
	a.nr_seq_conta nr_seq_conta_proc_mat,
	a.dt_procedimento dt_ocorrencia,
	null cd_material_ops,
	a.cd_procedimento,
	a.ie_origem_proced,
	substr(obter_descricao_procedimento(a.cd_procedimento,a.ie_origem_proced),1,255) ds_item_mat_proc,
	a.nr_seq_grupo_ans,
	substr(pls_obter_dados_grupo_ans(a.nr_seq_grupo_ans,'D'),1,255) ds_grupo_ans,
	a.vl_provisao,
	y.ie_status_coparticipacao,
	null dt_atualizacao,
	k.ie_tipo_grupo_ans
FROM pls_conta_copartic_contab z, pls_conta_coparticipacao y, pls_conta_proc a
LEFT OUTER JOIN ans_grupo_despesa k ON (a.nr_seq_grupo_ans = k.nr_sequencia)
WHERE y.nr_sequencia		= z.nr_seq_conta_copartic and a.nr_sequencia		= y.nr_seq_conta_proc  and z.vl_coparticipacao <> 0 and a.ie_status not in ('D','M') and exists (	select	1
			from	pls_mensalidade_item_conta ic
			where	ic.nr_seq_conta_copartic = y.nr_sequencia)
 
union all

select	10 ie_cursor,
	'S' ie_copartic_faturar,
	'S' ie_mens_item_conta,
	y.nr_seq_conta,
	z.nr_seq_conta_resumo,
	y.nr_seq_conta_proc,
	y.nr_sequencia nr_seq_copart,
	z.nr_sequencia nr_seq_copart_contab,
	y.nr_seq_mensalidade_seg,
	null nr_seq_item_mens,
	null nr_seq_mens_seg,
	null nr_seq_mensalidade,
	null nr_seq_lote_mens,
	z.dt_mes_competencia,
	z.nr_seq_prestador_pgto,
	z.ie_ato_cooperado,
	z.cd_conta_deb_provisao,
	z.cd_conta_cred_provisao,
	z.vl_coparticipacao,
	null dt_mesano_referencia,
	a.nr_seq_conta nr_seq_conta_proc_mat,
	a.dt_atendimento dt_ocorrencia,
	substr(pls_obter_dados_conta_mat(a.nr_sequencia,'O'),1,255) cd_material_ops,
	null cd_procedimento,
	null ie_origem_proced,
	substr(pls_obter_dados_conta_mat(a.nr_sequencia,'D'),1,255) ds_item_mat_proc,
	a.nr_seq_grupo_ans,
	substr(pls_obter_dados_grupo_ans(a.nr_seq_grupo_ans,'D'),1,255) ds_grupo_ans,
	a.vl_provisao,
	y.ie_status_coparticipacao,
	null dt_atualizacao,
	k.ie_tipo_grupo_ans
FROM pls_conta_copartic_contab z, pls_conta_coparticipacao y, pls_conta_mat a
LEFT OUTER JOIN ans_grupo_despesa k ON (a.nr_seq_grupo_ans = k.nr_sequencia)
WHERE y.nr_sequencia		= z.nr_seq_conta_copartic and a.nr_sequencia		= y.nr_seq_conta_mat  and z.vl_coparticipacao <> 0 and a.ie_status not in ('D','M') and exists (	select	1
			from	pls_mensalidade_item_conta ic
			where	ic.nr_seq_conta_copartic = y.nr_sequencia);

