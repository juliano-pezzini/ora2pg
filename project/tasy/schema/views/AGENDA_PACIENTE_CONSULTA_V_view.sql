-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW agenda_paciente_consulta_v (nr_seq_oftalmo, nr_sequencia, nr_seq_consulta, cd_pessoa_fisica, ds_classif_agenda_tasy, nr_minuto_duracao, ds_status_agenda, ds_convenio, nr_telefone_contato, nm_pessoa_contato, nr_atendimento, dt_confirmacao, ds_confirmacao, nm_usuario_origem, dt_entrada_tasy, qt_min_espera_tasy, ds_obs_agenda, dt_consulta, dt_chegada, ie_status_agenda, nm_usuario_acesso, nm_paciente, ie_encaixe, dt_agenda, nr_seq_status_pac, nr_seq_preferencia, dt_aguardando, dt_atendido, cd_agenda, cd_agenda_agenda, cd_pessoa_fisica_agenda, cd_turno) AS select
	a.nr_seq_oftalmo,
	a.nr_sequencia,
	a.nr_seq_consulta,
	a.cd_pessoa_fisica,
	substr(obter_classif_agenda_consulta(ie_classif_agenda),1,40) ds_classif_agenda_tasy,
	a.nr_minuto_duracao,
	c.ds_status_agenda,
	e.ds_convenio,
	coalesce(a.nr_telefone, b.nr_telefone_celular) nr_telefone_contato,
	a.nm_pessoa_contato,
	a.nr_atendimento,
	a.dt_confirmacao,
	a.ds_confirmacao,
	a.nm_usuario_origem,
	OBTER_DATA_ENTRADA(a.nr_atendimento) dt_entrada_tasy,
	Obter_Tempo_Espera_Atend(a.nr_atendimento) qt_min_espera_tasy,
	substr(a.ds_observacao,1,255) ds_obs_agenda,
	a.dt_consulta,
	a.dt_chegada,
	a.ie_status_agenda,
	a.nm_usuario_acesso,
	a.nm_paciente,
	a.ie_encaixe,
	a.dt_agenda,
	a.nr_seq_status_pac,
	a.nr_seq_preferencia,
	a.dt_aguardando,
	a.dt_atendido,
	a.cd_agenda,
	x.cd_agenda,
	x.cd_pessoa_fisica,
	a.cd_turno
FROM agenda x, status_agenda_v c, agenda_consulta a
LEFT OUTER JOIN pessoa_fisica b ON (a.cd_pessoa_fisica = b.cd_pessoa_fisica)
LEFT OUTER JOIN status_paciente_v g ON (a.ie_status_paciente = g.cd_status_paciente)
LEFT OUTER JOIN convenio e ON (a.cd_convenio = e.cd_convenio)
LEFT OUTER JOIN med_atendimento f ON (a.nr_sequencia = f.nr_seq_agenda)
LEFT OUTER JOIN paciente_senha_fila s ON (a.nr_seq_pac_senha_fila = s.nr_sequencia)
WHERE a.ie_status_agenda	= c.cd_status_agenda and a.cd_agenda		= x.cd_agenda;

