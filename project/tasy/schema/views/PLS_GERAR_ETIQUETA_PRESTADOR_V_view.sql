-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_gerar_etiqueta_prestador_v (ds_etiqueta, nr_seq_prestador, nr_seq_tipo_prestador, cd_municipio_ibge, ie_tipo_endereco, dt_exclusao) AS select 	substr(pls_obter_dados_prestador(a.nr_sequencia,'N'),1,27) || chr(13) ||
	substr(CASE WHEN pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pf_tel_adic, 'R') IS NULL THEN  ' '  ELSE pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pf_tel_adic, 'R') || ', ' END  || 
	CASE WHEN pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pf_tel_adic, 'NE') IS NULL THEN  ' '  ELSE pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pf_tel_adic, 'NE') || chr(13) END  || 
	CASE WHEN pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pf_tel_adic, 'B') IS NULL THEN  ' '  ELSE pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pf_tel_adic, 'B') || chr(13) || 'CEP ' END  || 
	CASE WHEN pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pf_tel_adic, 'CEP') IS NULL THEN  ' '  ELSE pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pf_tel_adic, 'CEP') || ' - ' END  || 
	CASE WHEN pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pf_tel_adic, 'C') IS NULL THEN  ' '  ELSE pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pf_tel_adic, 'C') || ' - ' END  || 
	pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pf_tel_adic, 'ES'),1,255) ds_etiqueta, 
	a.nr_sequencia nr_seq_prestador, 
	a.nr_seq_tipo_prestador, 
	c.cd_municipio_ibge, 
	a.ie_tipo_endereco, 
	a.dt_exclusao 
FROM	pls_prestador a, 
	pessoa_fisica c, 
	pls_mala_direta b 
where	a.cd_pessoa_fisica	= c.cd_pessoa_fisica 
and	b.cd_pessoa_fisica	= a.cd_pessoa_fisica 
group by a.nr_sequencia, 
	a.ie_tipo_endereco, 
	a.nr_seq_compl_pf_tel_adic, 
	a.nr_seq_tipo_prestador, 
	c.cd_municipio_ibge, 
	a.dt_exclusao 

union
 
select 	substr(pls_obter_dados_prestador(a.nr_sequencia,'N'),1,27) || chr(13) || 
	substr(CASE WHEN pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pj, 'R') IS NULL THEN  ' '  ELSE pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pj, 'R') || ', ' END  || 
	CASE WHEN pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pj, 'NE') IS NULL THEN  ' '  ELSE pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pj, 'NE') || chr(13) END  || 
	CASE WHEN pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pj, 'B') IS NULL THEN  ' '  ELSE pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pj, 'B') || chr(13) || 'CEP ' END  || 
	CASE WHEN pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pj, 'CEP') IS NULL THEN  ' '  ELSE pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pj, 'CEP') || ' - ' END  || 
	CASE WHEN pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pj, 'C') IS NULL THEN  ' '  ELSE pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pj, 'C') || ' - ' END  || 
	pls_obter_dados_prest_end(a.nr_sequencia,a.ie_tipo_endereco,a.nr_seq_compl_pj, 'ES'),1,255) ds_etiqueta, 
	a.nr_sequencia nr_seq_prestador, 
	a.nr_seq_tipo_prestador, 
	c.cd_municipio_ibge, 
	a.ie_tipo_endereco, 
	a.dt_exclusao 
from	pls_prestador a, 
	pessoa_juridica c, 
	pls_mala_direta b 
where	a.cd_cgc	= c.cd_cgc 
and	b.cd_cgc	= a.cd_cgc 
group by a.nr_sequencia, 
	a.ie_tipo_endereco, 
	a.nr_seq_compl_pj, 
	a.nr_seq_tipo_prestador, 
	c.cd_municipio_ibge, 
	a.dt_exclusao;

