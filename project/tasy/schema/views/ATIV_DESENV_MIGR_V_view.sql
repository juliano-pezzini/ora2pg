-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ativ_desenv_migr_v (ie_tipo_atividade, ds_tipo_atividade, nr_seq_ordem_servico, nr_seq_atividade, nm_usuario_executor, dt_atividade, qt_tempo_atividade) AS select	1 ie_tipo_atividade,
	'Projetos do usuário' ds_tipo_atividade,
	a.nr_seq_ordem_serv nr_seq_ordem_servico,
	a.nr_sequencia nr_seq_atividade,
	a.nm_usuario_exec nm_usuario_executor,
	a.dt_atividade dt_atividade,
	a.qt_minuto qt_tempo_atividade
FROM	man_ordem_serv_ativ a
where	1 = 1
and	exists (
		select	1
		from	man_ordem_servico_exec x
		where	x.nr_seq_ordem = a.nr_seq_ordem_serv
		and	x.nm_usuario_exec = a.nm_usuario_exec)
and	exists (
		select	1
		from	proj_projeto x
		where	x.nr_seq_ordem_serv = a.nr_seq_ordem_serv)

union

select	2 ie_tipo,
	'Projetos de terceiros' ds_tipo_atividade,
	a.nr_seq_ordem_serv,
	a.nr_sequencia,
	a.nm_usuario_exec,
	a.dt_atividade,
	a.qt_minuto
from	man_ordem_serv_ativ a
where	1 = 1
and	not exists (
		select	1
		from	man_ordem_servico_exec x
		where	x.nr_seq_ordem = a.nr_seq_ordem_serv
		and	x.nm_usuario_exec = a.nm_usuario_exec)
and	exists (
		select	1
		from	proj_projeto x
		where	x.nr_seq_ordem_serv = a.nr_seq_ordem_serv)

union

select	3 ie_tipo,
	'Ordens de serviço vinculadas aos projetos do usuário' ds_tipo_atividade,
	a.nr_seq_ordem_serv,
	a.nr_sequencia,
	a.nm_usuario_exec,
	a.dt_atividade,
	a.qt_minuto
from	man_ordem_serv_ativ a
where	1 = 1
and	exists (
		select	1
		from	man_ordem_servico_exec x
		where	x.nr_seq_ordem = a.nr_seq_ordem_serv
		and	x.nm_usuario_exec = a.nm_usuario_exec)
and	exists (
		select	1
		from	proj_ordem_servico x
		where	x.nr_seq_ordem = a.nr_seq_ordem_serv)
and	not exists (
		select	1
		from	proj_projeto x
		where	x.nr_seq_ordem_serv = a.nr_seq_ordem_serv)
and	not exists (
		select	1
		from	w_migracao_ordem_servico x
		where	x.nr_seq_os_migracao = a.nr_seq_ordem_serv)

union

select	4 ie_tipo,
	'Ordens de serviço vinculadas aos projetos de terceiros' ds_tipo_atividade,
	a.nr_seq_ordem_serv,
	a.nr_sequencia,
	a.nm_usuario_exec,
	a.dt_atividade,
	a.qt_minuto
from	man_ordem_serv_ativ a
where	1 = 1
and	not exists (
		select	1
		from	man_ordem_servico_exec x
		where	x.nr_seq_ordem = a.nr_seq_ordem_serv
		and	x.nm_usuario_exec = a.nm_usuario_exec)
and	exists (
		select	1
		from	proj_ordem_servico x
		where	x.nr_seq_ordem = a.nr_seq_ordem_serv)
and	not exists (
		select	1
		from	proj_projeto x
		where	x.nr_seq_ordem_serv = a.nr_seq_ordem_serv)
and	not exists (
		select	1
		from	w_migracao_ordem_servico x
		where	x.nr_seq_os_migracao = a.nr_seq_ordem_serv)

union

select	5 ie_tipo,
	'Ordens de serviço de revisão dos projetos do usuário' ds_tipo_atividade,
	a.nr_seq_ordem_serv,
	a.nr_sequencia,
	a.nm_usuario_exec,
	a.dt_atividade,
	a.qt_minuto
from	man_ordem_serv_ativ a
where	1 = 1
and	exists (
		select	1
		from	man_ordem_servico_exec x
		where	x.nr_seq_ordem = a.nr_seq_ordem_serv
		and	x.nm_usuario_exec = a.nm_usuario_exec)
and	exists (
		select	1
		from	w_migracao_ordem_servico x
		where	x.nr_seq_os_migracao = a.nr_seq_ordem_serv)

union

select	6 ie_tipo,
	'Ordens de serviço de revisão dos projetos de terceiros' ds_tipo_atividade,
	a.nr_seq_ordem_serv,
	a.nr_sequencia,
	a.nm_usuario_exec,
	a.dt_atividade,
	a.qt_minuto
from	man_ordem_serv_ativ a
where	1 = 1
and	not exists (
		select	1
		from	man_ordem_servico_exec x
		where	x.nr_seq_ordem = a.nr_seq_ordem_serv
		and	x.nm_usuario_exec = a.nm_usuario_exec)
and	exists (
		select	1
		from	w_migracao_ordem_servico x
		where	x.nr_seq_os_migracao = a.nr_seq_ordem_serv)

union

select	7 ie_tipo,
	'Outras atividades' ds_tipo_atividade,
	0 nr_seq_ordem_serv,
	b.nr_sequencia,
	a.nm_usuario,
	b.dt_atividade,
	b.qt_minuto
from	usuario_controle a,
	usuario_atividade b
where	1 = 1
and	a.nr_sequencia = b.nr_seq_controle;

