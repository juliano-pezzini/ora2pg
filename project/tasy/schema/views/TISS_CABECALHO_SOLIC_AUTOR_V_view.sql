-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW tiss_cabecalho_solic_autor_v (ds_versao, nr_sequencia_autor, nr_seq_protocolo, nr_seq_med_prot, cd_medico_executor, nr_atendimento, nr_seq_retorno, nr_seq_prot_situacao, nr_seq_prot_cancel, nr_seq_procedimento, nr_seq_partic, cd_especialidade, ie_honorario, cd_convenio, cd_cgc_honorario, cd_cgc, cd_interno, cd_estabelecimento, nr_seq_lote_anexo, nr_seq_pedido_exame_ext, cd_interno_origem_tiss, nr_seq_rec_glosa_prot_cancel) AS select	'3.03.02' ds_versao,
	a.nr_sequencia nr_sequencia_autor,
	0 nr_seq_protocolo,
	0 nr_seq_med_prot,
	'0' cd_medico_executor,
	a.nr_atendimento,
	0 nr_seq_retorno,
	0 NR_SEQ_PROT_SITUACAO,
	0 NR_SEQ_PROT_CANCEL,
	0 nr_seq_procedimento,
	0 nr_seq_partic,
	0 CD_ESPECIALIDADE,
	'N' ie_honorario,
	a.cd_convenio,
	'X' cd_cgc_honorario,
	coalesce(a.cd_cgc_prestador, b.cd_cgc) cd_cgc,
	a.cd_prestador_tiss cd_interno,
	b.cd_estabelecimento cd_estabelecimento,
	0 nr_seq_lote_anexo,
	0 nr_seq_pedido_exame_ext,
	a.cd_interno_origem_tiss,
	0 nr_seq_rec_glosa_prot_cancel
FROM 	estabelecimento b,
	autorizacao_convenio a
where 	a.cd_estabelecimento = b.cd_estabelecimento

union all

select	'3.03.02' ds_versao,
	a.nr_sequencia nr_sequencia_autor,
	0 nr_seq_protocolo,
	0 nr_seq_med_prot,
	'0' cd_medico_executor,
	a.nr_atendimento,
	0 nr_seq_retorno,
	0 NR_SEQ_PROT_SITUACAO,
	0 NR_SEQ_PROT_CANCEL,
	0 nr_seq_procedimento,
	0 nr_seq_partic,
	0 CD_ESPECIALIDADE,
	'N' ie_honorario,
	a.cd_convenio,
	'X' cd_cgc_honorario,
	coalesce(a.cd_cgc_prestador, b.cd_cgc) cd_cgc,
	a.cd_prestador_tiss cd_interno,
	b.cd_estabelecimento cd_estabelecimento,
	0 nr_seq_lote_anexo,
	0 nr_seq_pedido_exame_ext,
	a.cd_interno_origem_tiss,
	0 nr_seq_rec_glosa_prot_cancel
from 	estabelecimento b,
	autorizacao_convenio_tiss c,
	autorizacao_convenio a
where 	a.nr_sequencia		= c.nr_sequencia_autor
and	a.nr_atendimento		is null
and	a.nr_seq_agenda		is null
and	a.nr_seq_agenda_consulta	is null
and	a.nr_seq_gestao		is null
and	a.cd_pessoa_fisica 		is not null
and 	b.cd_estabelecimento	= c.cd_estabelecimento

union all

select 	'3.03.02' ds_versao,
	0 nr_sequencia_autor,
	0 nr_seq_protocolo,
	nr_sequencia nr_seq_med_prot,
	cd_medico cd_medico_executor,
	0 nr_atendimento,
	0 nr_seq_retorno,
	0 NR_SEQ_PROT_SITUACAO,
	0 NR_SEQ_PROT_CANCEL,
	0 nr_seq_procedimento,
	0 nr_seq_partic,
	0 CD_ESPECIALIDADE,
	'N' ie_honorario,
	a.cd_convenio,
	'X' cd_cgc_honorario,
	a.cd_cgc,
	null cd_interno,
	null cd_estabelecimento,
	0 nr_seq_lote_anexo,
	0 nr_seq_pedido_exame_ext,
	null cd_interno_origem_tiss,
	0 nr_seq_rec_glosa_prot_cancel
from 	med_prot_convenio a
where 	1 = 1

union  all

select 	'3.03.02' ds_versao,
	0 nr_sequencia_autor,
	0 nr_seq_protocolo,
	0 nr_seq_med_prot,
	'0' cd_medico_executor,
	0 nr_atendimento,
	a.nr_sequencia nr_seq_retorno,
	0 NR_SEQ_PROT_SITUACAO,
	0 NR_SEQ_PROT_CANCEL,
	0 nr_seq_procedimento,
	0 nr_seq_partic,
	0 CD_ESPECIALIDADE,
	'N' ie_honorario,
	a.cd_convenio,
	'X' cd_cgc_honorario,
	b.cd_cgc,
	null cd_interno,
	b.cd_estabelecimento cd_estabelecimento,
	0 nr_seq_lote_anexo,
	0 nr_seq_pedido_exame_ext,
	null cd_interno_origem_tiss,
	0 nr_seq_rec_glosa_prot_cancel
from 	estabelecimento b,
	convenio_retorno  a
where 	a.cd_estabelecimento = b.cd_estabelecimento

union

select '3.03.02' ds_versao,
	0 nr_sequencia_autor,
	a.nr_seq_protocolo,
	0 nr_seq_med_prot,
	'0' cd_medico_executor,
	0 nr_atendimento,
	0 nr_seq_retorno,
	a.nr_seq_protocolo NR_SEQ_PROT_SITUACAO,
	0 NR_SEQ_PROT_CANCEL,
	0 nr_seq_procedimento,
	0 nr_seq_partic,
	0 CD_ESPECIALIDADE,
	'N' ie_honorario,
	a.cd_convenio,
	'X' cd_cgc_honorario,   	b.cd_cgc,
	a.cd_prestador_convenio cd_interno,
	b.cd_estabelecimento cd_estabelecimento,
	0 nr_seq_lote_anexo,
	0 nr_seq_pedido_exame_ext,
	null cd_interno_origem_tiss,
	0 nr_seq_rec_glosa_prot_cancel
from 	estabelecimento b,
	protocolo_convenio  a
where 	a.cd_estabelecimento = b.cd_estabelecimento

union 	all

select '3.03.02' ds_versao,
	0 nr_sequencia_autor,
	0 nr_seq_protocolo,
	0 nr_seq_med_prot,
	'0' cd_medico_executor,
	0 nr_atendimento,
	0 nr_seq_retorno,
	0 NR_SEQ_PROT_SITUACAO,
	a.nr_seq_protocolo NR_SEQ_PROT_CANCEL,
	0 nr_seq_procedimento,
	0 nr_seq_partic,
	0 CD_ESPECIALIDADE,
	'N' ie_honorario,
	a.cd_convenio,
	'X' cd_cgc_honorario,   	b.cd_cgc,
	a.cd_prestador_convenio cd_interno,
	b.cd_estabelecimento cd_estabelecimento,
	0 nr_seq_lote_anexo,
	0 nr_seq_pedido_exame_ext,
	null cd_interno_origem_tiss,
	0 nr_seq_rec_glosa_prot_cancel
from 	estabelecimento b,
	protocolo_convenio  a
where 	a.cd_estabelecimento = b.cd_estabelecimento

union  all

select 	'3.03.02' ds_versao,
	0 nr_sequencia_autor,
	0 nr_seq_protocolo,
	0 nr_seq_med_prot,
	'0' cd_medico_executor,
	0 nr_atendimento,
	0 nr_seq_retorno,
	0 NR_SEQ_PROT_SITUACAO,
	0 NR_SEQ_PROT_CANCEL,
	0 nr_seq_procedimento,
	0 nr_seq_partic,
	0 CD_ESPECIALIDADE,
	'N' ie_honorario,
	a.cd_convenio,
	'X' cd_cgc_honorario,
	b.cd_cgc,
	null cd_interno,
	b.cd_estabelecimento cd_estabelecimento,
	a.nr_sequencia nr_seq_lote_anexo,
	0 nr_seq_pedido_exame_ext,
	null cd_interno_origem_tiss,
	0 nr_seq_rec_glosa_prot_cancel
from 	estabelecimento b,
	tiss_anexo_lote  a
where 	a.cd_estabelecimento = b.cd_estabelecimento

union all

select	'3.03.02' ds_versao,
	0 nr_sequencia_autor,
	0 nr_seq_protocolo,
	0 nr_seq_med_prot,
	'0' cd_medico_executor,
	a.nr_atendimento,
	0 nr_seq_retorno,
	0 NR_SEQ_PROT_SITUACAO,
	0 NR_SEQ_PROT_CANCEL,
	0 nr_seq_procedimento,
	0 nr_seq_partic,
	0 CD_ESPECIALIDADE,
	'N' ie_honorario,
	c.cd_convenio,
	'X' cd_cgc_honorario,
	d.cd_cgc cd_cgc,
	e.cd_interno cd_interno,
	b.cd_estabelecimento cd_estabelecimento,
	0 nr_seq_lote_anexo,
	a.nr_sequencia nr_seq_pedido_exame_ext,
	null cd_interno_origem_tiss,
	0 nr_seq_rec_glosa_prot_cancel
from 	atendimento_paciente b,
	pedido_exame_externo a,
	atend_categoria_convenio c,
	estabelecimento d,
	convenio_estabelecimento e
where 	b.nr_atendimento 	= a.nr_atendimento
and	b.cd_estabelecimento 	= d.cd_estabelecimento
and	c.cd_convenio		= e.cd_convenio
and	d.cd_estabelecimento	= e.cd_estabelecimento
and	obter_atecaco_atendimento(a.nr_atendimento) 	= c.nr_seq_interno

union all

select 	'3.03.02' ds_versao,
	0 nr_sequencia_autor,
	0 nr_seq_protocolo,
	0 nr_seq_med_prot,
	'0' cd_medico_executor,
	0 nr_atendimento,
	0 nr_seq_retorno,
	0 NR_SEQ_PROT_SITUACAO,
	0 NR_SEQ_PROT_CANCEL,
	0 nr_seq_procedimento,
	0 nr_seq_partic,
	0 CD_ESPECIALIDADE,
	'N' ie_honorario,
	c.cd_convenio,
	'X' cd_cgc_honorario,
	e.cd_cgc cd_cgc,
	d.cd_interno cd_interno,
	e.cd_estabelecimento cd_estabelecimento,
	0 nr_seq_lote_anexo,
	0 nr_seq_pedido_exame_ext,
	null cd_interno_origem_tiss,
	a.nr_sequencia		nr_seq_rec_glosa_prot_cancel
from	tiss_recurso_glosa_prot a,
	lote_audit_hist b,
	lote_auditoria c,
	convenio_estabelecimento d,
	estabelecimento e
where	a.nr_seq_lote_hist 	= b.nr_sequencia
and	b.nr_seq_lote_audit = c.nr_sequencia
and	c.cd_estabelecimento 	= d.cd_estabelecimento
and	c.cd_convenio 		= d.cd_convenio
and	e.cd_estabelecimento	= c.cd_estabelecimento
and	a.dt_cancelamento 	is null;

