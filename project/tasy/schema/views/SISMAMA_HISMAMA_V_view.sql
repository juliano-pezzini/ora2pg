-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW sismama_hismama_v (nr_seq_protocolo, c_cnes, c_exame, c_id_nome, c_id_nomemae, c_id_apel, d_id_dtnasc, c_id_ident, c_id_emis, c_id_ufide, c_id_cic, c_id_esco, c_id_endereco, c_id_numero, c_id_complem, c_id_bairro, c_id_uf, c_ibge, c_id_cep, c_id_refe, c_id_fone, c_id_sus, c_us_uf, c_us_ibge, c_us_cnes, c_us_nome, c_pron, c_cli_tipexe, c_cli_tcanc, c_cli_grav, c_cli_tant, c_cli_tquim, c_cli_tcirur, c_cli_tcirurom, c_cli_tradio, c_cli_tradioom, c_cli_thorm, c_cli_detec, c_cli_diag_im, c_cli_mama, c_cli_loca, c_cli_tam, c_cli_linfo, c_cli_mat_proc, c_examin, c_res_procir, c_res_adeq, c_res_ins_por, c_tam_tumdom, c_dim_tumsec, c_mic_micrcalc, c_ben_hipsati, c_ben_hipcati, c_ben_lobcati, c_ben_adenos, c_ben_esdero, c_ben_fibroc, c_ben_fibroa, c_ben_solita, c_ben_multi, c_ben_florid, c_ben_mastit, c_ben_outros, c_ben_outdes, c_neo_malig, c_neo_outdes, c_his_asssec, c_his_asssesp, c_his_foca, c_his_cent, c_his_grau, c_his_vasc, c_his_perin, c_his_embo, c_his_pele, c_his_mam, c_his_musc, c_his_fasc, c_his_grad, c_his_marg, c_his_linfo, c_his_linfav, c_his_linfco, c_his_coal, c_his_extr, c_his_reces, c_his_recpr, c_his_outhis, c_his_outdes, c_his_obs, d_col_us, d_recebe, d_libera, c_pat_cns, c_pat_cic, c_id_sexo, c_id_racacor) AS select	b.nr_seq_protocolo,
	substr(obter_cnes_estab(a.cd_estabelecimento),1,7) c_cnes, 
	' ' c_exame, 
	upper(substr(obter_nome_pf(c.cd_pessoa_fisica),1,70)) c_id_nome, 
	upper(substr(obter_compl_pf(c.cd_pessoa_fisica,5,'N'),1,60)) c_id_nomemae, 
	' ' c_id_apel, 
	obter_dados_pf(c.cd_pessoa_fisica,'DN') d_id_dtnasc, 
	substr(obter_dados_pf(c.cd_pessoa_fisica,'RG'),1,12) c_id_ident, 
	substr(obter_dados_pf(c.cd_pessoa_fisica,'O'),1,5) c_id_emis, 
	' ' c_id_ufide, 
	substr(obter_dados_pf(c.cd_pessoa_fisica,'CPF'),1,11) c_id_cic, 
	CASE WHEN obter_dados_pf(c.cd_pessoa_fisica,'GI')='Analfabeto' THEN '1' WHEN obter_dados_pf(c.cd_pessoa_fisica,'GI')='Primeiro Grau Incompleto' THEN '2' WHEN obter_dados_pf(c.cd_pessoa_fisica,'GI')='Primeiro Grau' THEN '3' WHEN obter_dados_pf(c.cd_pessoa_fisica,'GI')='Segundo Grau' THEN '4' WHEN obter_dados_pf(c.cd_pessoa_fisica,'GI')='Superior' THEN '5'  ELSE '0' END  c_id_esco, 
	upper(substr(obter_compl_pf(c.cd_pessoa_fisica,1,'EN'),1,35)) c_id_endereco, 
	substr(obter_compl_pf(c.cd_pessoa_fisica,1,'NR'),1,6) c_id_numero, 
	upper(substr(obter_compl_pf(c.cd_pessoa_fisica,1,'CO'),1,15)) c_id_complem, 
	upper(substr(obter_compl_pf(c.cd_pessoa_fisica,1,'B'),1,15)) c_id_bairro, 
	upper(substr(obter_compl_pf(c.cd_pessoa_fisica,1,'UF'),1,2)) c_id_uf, 
	substr(obter_compl_pf(c.cd_pessoa_fisica,1,'CDM'),1,7) c_ibge, 
	substr(obter_compl_pf(c.cd_pessoa_fisica,1,'CEP'),1,8) c_id_cep, 
	' ' c_id_refe, 
	substr(obter_compl_pf(c.cd_pessoa_fisica,1,'T'),1,11) c_id_fone, 
	substr(obter_dados_pf(c.cd_pessoa_fisica,'CNS'),1,11) c_id_sus, 
	substr(obter_compl_pj(obter_cgc_estabelecimento(a.cd_estabelecimento),2,'UF'),1,2) c_us_uf, 
	substr(obter_compl_pj(obter_cgc_estabelecimento(a.cd_estabelecimento),2,'IBGE'),1,7) c_us_ibge, 
	substr(obter_cnes_estab(a.cd_estabelecimento),1,7) c_us_cnes, 
	substr(obter_nome_pf_pj(null,obter_cgc_estabelecimento(a.cd_estabelecimento)),1,40) c_us_nome, 
	obter_prontuario_paciente(c.cd_pessoa_fisica) c_pron, 
	e.ie_tipo_exame c_cli_tipexe, 
	CASE WHEN e.ie_risco_elevado ='N' THEN '1' WHEN e.ie_risco_elevado ='S' THEN '3' WHEN e.ie_risco_elevado ='X' THEN '2'  ELSE '0' END  c_cli_tcanc, 
	CASE WHEN e.ie_gravida_amamentando='N' THEN '1' WHEN e.ie_gravida_amamentando='S' THEN '3' WHEN e.ie_gravida_amamentando='X' THEN '2'  ELSE '0' END  c_cli_grav, 
	CASE WHEN e.ie_tratamento_anterior='N' THEN '1' WHEN e.ie_tratamento_anterior='S' THEN '3'  ELSE '0' END  c_cli_tant, 
	CASE WHEN e.ie_trat_quimioterapia='S' THEN '3'  ELSE '0' END  c_cli_tquim, 
	CASE WHEN e.ie_trat_mesma_mama='S' THEN '3'  ELSE '0' END  c_cli_tcirur, 
	CASE WHEN e.ie_trat_outra_mama ='S' THEN '3'  ELSE '0' END  c_cli_tcirurom, 
	CASE WHEN e.ie_trat_rad_mesma_mama='S' THEN '3'  ELSE '0' END  c_cli_tradio, 
	CASE WHEN e.ie_trat_rad_outra_mama='S' THEN '3'  ELSE '0' END  c_cli_tradioom, 
	CASE WHEN e.ie_trat_hormonio='S' THEN '3'  ELSE '0' END  c_cli_thorm, 
	CASE WHEN e.ie_deteccao_lesao='E' THEN '1' WHEN e.ie_deteccao_lesao='I' THEN '2'  ELSE ' ' END  c_cli_detec, 
	CASE WHEN e.ie_diagnostico_imagem='A' THEN '4' WHEN e.ie_diagnostico_imagem='D' THEN '2' WHEN e.ie_diagnostico_imagem='M' THEN '1' WHEN e.ie_diagnostico_imagem='N' THEN '3'  ELSE ' ' END  c_cli_diag_im, 
	CASE WHEN e.ie_caracteristica_lesao='MD' THEN '1' WHEN e.ie_caracteristica_lesao='ME' THEN '2'  ELSE ' ' END  c_cli_mama, 
	CASE WHEN e.ie_localizacao='PA' THEN '10' WHEN e.ie_localizacao='QII' THEN '4' WHEN e.ie_localizacao='QIM' THEN '2' WHEN e.ie_localizacao='QSL' THEN '3' WHEN e.ie_localizacao='QSM' THEN '1' WHEN e.ie_localizacao='RRA' THEN '9' WHEN e.ie_localizacao='UQinf' THEN '8' WHEN e.ie_localizacao='UQLat' THEN '5' WHEN e.ie_localizacao='UQMed' THEN '7' WHEN e.ie_localizacao='UQSup' THEN '6'  ELSE ' ' END  c_cli_loca, 
	to_char(e.ie_tamanho) c_cli_tam, 
	e.ie_linfonodo_axilar c_cli_linfo, 
	to_char(e.ie_material_enviado) c_cli_mat_proc, 
	CASE WHEN coalesce(f.nr_exame,0)=0 THEN 'N'  ELSE 'S' END  c_examin, 
	to_char(f.ie_procedimento_cirurgico) c_res_procir, 
	CASE WHEN f.ie_adequabilidade_material='S' THEN '3' WHEN f.ie_adequabilidade_material='I' THEN '1' END  c_res_adeq, 
	substr(f.ds_insatisfatorio,1,70) c_res_ins_por, 
	to_char(f.ie_dim_tumor_dominante) c_tam_tumdom, 
	to_char(f.ie_dim_tumor_secundario) c_dim_tumsec, 
	CASE WHEN d.ie_microcalcificacoes='S' THEN '3' WHEN d.ie_microcalcificacoes='N' THEN '1'  ELSE '0' END  c_mic_micrcalc, 
	CASE WHEN d.ie_hiper_ductal_sem_atipias='S' THEN '3'  ELSE '0' END  c_ben_hipsati, 
	CASE WHEN d.ie_hiper_ductal_com_atipias='S' THEN '3'  ELSE '0' END  c_ben_hipcati, 
	CASE WHEN d.ie_hiper_lobular_com_atipias='S' THEN '3'  ELSE '0' END  c_ben_lobcati, 
	CASE WHEN d.ie_adenose_soe='S' THEN '3'  ELSE '0' END  c_ben_adenos, 
	CASE WHEN d.ie_lesao_esclerosante='S' THEN '3'  ELSE '0' END  c_ben_esdero, 
	CASE WHEN d.ie_consicao_fibrocistica='S' THEN '3'  ELSE '0' END  c_ben_fibroc, 
	CASE WHEN d.ie_fibroadenoma='S' THEN '3'  ELSE '0' END  c_ben_fibroa, 
	CASE WHEN d.ie_papiloma_solitario='S' THEN '3'  ELSE '0' END  c_ben_solita, 
	CASE WHEN d.ie_papiloma_multiplo='S' THEN '3'  ELSE '0' END  c_ben_multi, 
	CASE WHEN d.ie_papilomatose_florida='S' THEN '3'  ELSE '0' END  c_ben_florid, 
	CASE WHEN d.ie_mastite='S' THEN '3'  ELSE '0' END  c_ben_mastit, 
 	CASE WHEN d.ie_outros='S' THEN '3'  ELSE '0' END  c_ben_outros, 
	substr(d.ds_outros,1,70) c_ben_outdes, 
	d.ie_neoplasico_maligno c_neo_malig, 
	substr(d.ds_outros_neoplasico,1,70) c_neo_outdes, 
	CASE WHEN d.ie_tipo_histopatologico='S' THEN '3' WHEN d.ie_tipo_histopatologico='N' THEN '1'  ELSE '0' END  c_his_asssec, 
	substr(d.ds_tipo_histopatologico,1,70) c_his_asssesp, 
	CASE WHEN d.ie_multifocalidade_tumor='N' THEN '1' WHEN d.ie_multifocalidade_tumor='S' THEN '3' WHEN d.ie_multifocalidade_tumor='X' THEN '2'  ELSE '0' END  c_his_foca, 
	CASE WHEN d.ie_multicentricidade_tumor='N' THEN '1' WHEN d.ie_multicentricidade_tumor='S' THEN '3' WHEN d.ie_multicentricidade_tumor='X' THEN '2'  ELSE '0' END  c_his_cent, 
	CASE WHEN d.ie_grau_histologico='I' THEN '1' WHEN d.ie_grau_histologico='II' THEN '2' WHEN d.ie_grau_histologico='III' THEN '3' WHEN d.ie_grau_histologico='X' THEN '4'  ELSE '0' END  c_his_grau, 
	CASE WHEN d.ie_invasao_vascular='N' THEN '1' WHEN d.ie_invasao_vascular='S' THEN '3' WHEN d.ie_invasao_vascular='X' THEN '2'  ELSE '0' END  c_his_vasc, 
	CASE WHEN d.ie_infiltracao_perineural='N' THEN '1' WHEN d.ie_infiltracao_perineural='S' THEN '3' WHEN d.ie_infiltracao_perineural='X' THEN '2'  ELSE '0' END  c_his_perin, 
	CASE WHEN d.ie_embolizacao_linfatica='N' THEN '1' WHEN d.ie_embolizacao_linfatica='S' THEN '3' WHEN d.ie_embolizacao_linfatica='X' THEN '2'  ELSE '0' END  c_his_embo, 
	CASE WHEN d.ie_pele='N' THEN '1' WHEN d.ie_pele='SC' THEN '3' WHEN d.ie_pele='SS' THEN '4' WHEN d.ie_pele='X' THEN '2'  ELSE '0' END  c_his_pele,    
	CASE WHEN d.ie_mamilo='N' THEN '1' WHEN d.ie_mamilo='S' THEN '3' WHEN d.ie_mamilo='X' THEN '2'  ELSE '0' END  c_his_mam, 
	CASE WHEN d.ie_musculo_peitoral='N' THEN '1' WHEN d.ie_musculo_peitoral='S' THEN '3' WHEN d.ie_musculo_peitoral='X' THEN '2'  ELSE '0' END  c_his_musc, 
	CASE WHEN d.ie_fascia_peitoral='N' THEN '1' WHEN d.ie_fascia_peitoral='S' THEN '3' WHEN d.ie_fascia_peitoral='X' THEN '2'  ELSE '0' END  c_his_fasc, 
	CASE WHEN d.ie_gradil_costal='N' THEN '1' WHEN d.ie_gradil_costal='S' THEN '3' WHEN d.ie_gradil_costal='X' THEN '2'  ELSE '0' END  c_his_grad, 
	CASE WHEN d.ie_margens_cirurgicas='L' THEN '1' WHEN d.ie_margens_cirurgicas='C' THEN '3'  ELSE '2' END  c_his_marg, 
	CASE WHEN d.ie_linfonodos='A' THEN '1' WHEN d.ie_linfonodos='S' THEN '2' END  c_his_linfo, 
	to_char(d.nr_lifonodo_avaliado) c_his_linfav, 
	to_char(d.ie_linfonodo_comprometido) c_his_linfco, 
	CASE WHEN d.ie_presenca_coalescencia='N' THEN '1' WHEN d.ie_presenca_coalescencia='S' THEN '3' WHEN d.ie_presenca_coalescencia='X' THEN '2'  ELSE '0' END  c_his_coal, 
	CASE WHEN d.ie_extravasamento='N' THEN '1' WHEN d.ie_extravasamento='S' THEN '3' WHEN d.ie_extravasamento='X' THEN '2'  ELSE '0' END  c_his_extr, 
	CASE WHEN d.ie_receptor_estrogeno='P' THEN '3' WHEN d.ie_receptor_estrogeno='N' THEN '1' WHEN d.ie_receptor_estrogeno='NR' THEN '2' END  c_his_reces, 
	CASE WHEN d.ie_receptor_progesterona='P' THEN '3' WHEN d.ie_receptor_progesterona='N' THEN '1' WHEN d.ie_receptor_progesterona='NR' THEN '2' END  c_his_recpr, 
	CASE WHEN d.ie_estudo_histoquimico='S' THEN '3' WHEN d.ie_estudo_histoquimico='N' THEN '1'  ELSE '0' END  c_his_outhis, 
	substr(d.ds_outros_estudos,1,70) c_his_outdes, 
	substr(d.ds_observacao,1,100) c_his_obs, 
	to_char(e.dt_coleta) d_col_us, 
	to_char(f.dt_recebimento) d_recebe,	 
	to_char(d.dt_liberacao) d_libera, 
	substr(obter_dados_pf(a.cd_profissional,'CNS'),1,15) c_pat_cns, 
	substr(obter_dados_pf(a.cd_profissional,'CPF'),1,11) c_pat_cic, 
	CASE WHEN Obter_Sexo_PF(c.cd_pessoa_fisica,'C')='F' THEN '2' WHEN Obter_Sexo_PF(c.cd_pessoa_fisica,'C')='M' THEN '1'  ELSE '0' END  c_id_sexo, 
	CASE WHEN obter_dados_pf(c.cd_pessoa_fisica,'CP')='Amarela' THEN '04' WHEN obter_dados_pf(c.cd_pessoa_fisica,'CP')='Branca' THEN '01' WHEN obter_dados_pf(c.cd_pessoa_fisica,'CP')='Indio' THEN '05' WHEN obter_dados_pf(c.cd_pessoa_fisica,'CP')='Negra' THEN '02' WHEN obter_dados_pf(c.cd_pessoa_fisica,'CP')='Parda' THEN '03' WHEN obter_dados_pf(c.cd_pessoa_fisica,'CP')='Sem informação' THEN '99' END  c_id_racacor 
FROM	sismama_his_resultado f, 
	sismama_his_dados_clinico e, 
	sismama_his_exame_micro d, 
	atendimento_paciente c, 
	conta_paciente b, 
	sismama_atendimento a 
where	a.nr_atendimento = b.nr_atendimento 
and	b.nr_atendimento = c.nr_atendimento 
and	a.nr_sequencia = d.nr_seq_sismama 
and	a.nr_sequencia = e.nr_seq_sismama 
and	a.nr_sequencia = f.nr_seq_sismama;

