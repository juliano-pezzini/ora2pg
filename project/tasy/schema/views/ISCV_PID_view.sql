-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW iscv_pid (id_number, assigning_authority, alternate_patient_id, family_name_patient, given_name_patient, middleinitialorname_patient, family_name_mother, given_name_mother, middleinitialorname_mother, date_time_of_birth, administrative_sex, race, street_address, dwellingnumber, zip_code, state_adress, country, telephone_number, business_phone_number, marital_status, cd_pessoa_fisica, city, cellphone) AS SELECT	CASE WHEN(SELECT coalesce(MAX(x.IE_UTILIZA_PRONTUARIO),'N') FROM EMPRESA_INTEGR_DADOS x WHERE x.nr_seq_empresa_integr = 4 AND coalesce(x.ie_situacao,'A') = 'A')='S' THEN obter_prontuario_pf(p.cd_estabelecimento,p.cd_pessoa_fisica)  ELSE p.cd_pessoa_fisica END  ID_NUMBER,
		coalesce((SELECT MAX(x.CD_ESTABELECIMENTO_INTEGRACAO) FROM EMPRESA_INTEGR_DADOS x WHERE NR_SEQ_EMPRESA_INTEGR = 4 AND x.CD_ESTABELECIMENTO = p.cd_estabelecimento),'Philips')  ASSIGNING_AUTHORITY,
		CASE WHEN(SELECT coalesce(MAX(x.IE_UTILIZA_PRONTUARIO),'N') FROM EMPRESA_INTEGR_DADOS x WHERE x.nr_seq_empresa_integr = 4 AND coalesce(x.ie_situacao,'A') = 'A')='S' THEN p.cd_pessoa_fisica  ELSE obter_prontuario_pf(p.cd_estabelecimento,p.cd_pessoa_fisica) END  ALTERNATE_PATIENT_ID,
		CASE WHEN coalesce(get_establishment_locale(p.cd_estabelecimento),'pt_BR')='pt_BR' THEN 		SUBSTR(ELIMINA_ACENTUACAO(obter_parte_nome_pf(p.nm_pessoa_fisica,obter_desc_expressao(325926))), 1, 64)  ELSE (SELECT MAX(x.ds_family_name)		FROM	person_name x		WHERE	p.nr_seq_person_name = x.nr_sequencia) END  Family_Name_Patient,
		CASE WHEN coalesce(get_establishment_locale(p.cd_estabelecimento),'pt_BR')='pt_BR' THEN 		SUBSTR(ELIMINA_ACENTUACAO(obter_parte_nome_pf(p.nm_pessoa_fisica,'nome')), 1, 64)  ELSE (SELECT MAX(x.ds_given_name)		FROM	person_name x		WHERE	p.nr_seq_person_name = x.nr_sequencia) END  Given_Name_Patient,
		CASE WHEN coalesce(get_establishment_locale(p.cd_estabelecimento),'pt_BR')='pt_BR' THEN 		SUBSTR(ELIMINA_ACENTUACAO(obter_parte_nome_pf(p.nm_pessoa_fisica,'restonome')), 1, 64)  ELSE (SELECT MAX(x.ds_component_name_2)		FROM	person_name x		WHERE	p.nr_seq_person_name = x.nr_sequencia) END  MiddleInitialOrName_Patient,
		CASE WHEN coalesce(get_establishment_locale(p.cd_estabelecimento),'pt_BR')='pt_BR' THEN 		SUBSTR(ELIMINA_ACENTUACAO(obter_parte_nome_pf(obter_nome_mae_pf(p.CD_PESSOA_FISICA),obter_desc_expressao(325926))), 1, 64)  ELSE (SELECT MAX(x.ds_family_name)		FROM	person_name x		WHERE	p.nr_seq_person_name = x.nr_sequencia) END  Family_Name_Mother,
		CASE WHEN coalesce(get_establishment_locale(p.cd_estabelecimento),'pt_BR')='pt_BR' THEN 		SUBSTR(ELIMINA_ACENTUACAO(obter_parte_nome_pf(obter_nome_mae_pf(p.CD_PESSOA_FISICA),'nome')), 1, 64)  ELSE (SELECT MAX(x.ds_given_name)		FROM	person_name x		WHERE	p.nr_seq_person_name = x.nr_sequencia) END  Given_Name_Mother,
		CASE WHEN coalesce(get_establishment_locale(p.cd_estabelecimento),'pt_BR')='pt_BR' THEN 		SUBSTR(ELIMINA_ACENTUACAO(obter_parte_nome_pf(obter_nome_mae_pf(p.CD_PESSOA_FISICA),'restonome')), 1, 64)  ELSE (SELECT MAX(x.ds_component_name_2)		FROM	person_name x		WHERE	p.nr_seq_person_name = x.nr_sequencia) END  MiddleInitialOrName_Mother,
		TO_CHAR(dt_nascimento,'YYYYMMDD') Date_Time_Of_Birth,
		CASE WHEN ie_sexo='M' THEN 'M' WHEN ie_sexo='F' THEN 'F'  ELSE 'U' END  Administrative_Sex,
		(SELECT	MAX(x.DS_COR_PELE)
		FROM	cor_pele x
		WHERE	p.nr_seq_cor_pele = x.nr_sequencia) Race,
		SUBSTR(ELIMINA_ACENTUACAO(SELECT (e.ds_endereco ||CASE WHEN coalesce(e.nr_endereco,e.ds_compl_end) IS NULL THEN ''  ELSE ', '||coalesce(e.nr_endereco,e.ds_compl_end) END || CASE WHEN ds_complemento IS NULL THEN  ''  ELSE ', ' || e.ds_complemento END )
		FROM	 compl_pessoa_fisica e
		WHERE	 e.cd_pessoa_fisica = p.cd_pessoa_fisica
		AND		 ie_tipo_complemento = 1),1,64) Street_Address,
		SUBSTR(ELIMINA_ACENTUACAO((SELECT	 e.nr_endereco
		FROM	 compl_pessoa_fisica e
		WHERE	 e.cd_pessoa_fisica = p.cd_pessoa_fisica
		AND		 ie_tipo_complemento = 1)),1,64) DwellingNumber,
		SUBSTR(ELIMINA_ACENTUACAO((SELECT	 e.cd_cep
		FROM	 compl_pessoa_fisica e
		WHERE	 e.cd_pessoa_fisica = p.cd_pessoa_fisica
		AND		 ie_tipo_complemento = 1)),1,64) Zip_Code,
		SUBSTR(ELIMINA_ACENTUACAO((SELECT	 SUBSTR(Obter_Valor_Dominio(50, e.sg_estado), 1, 50)
		FROM	 compl_pessoa_fisica e
		WHERE	 e.cd_pessoa_fisica = p.cd_pessoa_fisica
		AND		 ie_tipo_complemento = 1)),1,64) State_Adress,
		SUBSTR(ELIMINA_ACENTUACAO((SELECT	 MAX(f.sg_pais)
		FROM	 compl_pessoa_fisica e,
				pais f
		WHERE	 e.cd_pessoa_fisica = p.cd_pessoa_fisica
		AND		f.nr_sequencia = e.nr_seq_pais
		AND		 ie_tipo_complemento = 1)),1,64) Country,
		coalesce(obter_telefone_pf(p.cd_pessoa_fisica,13),obter_telefone_pf(p.cd_pessoa_fisica,12)) Telephone_Number,
		obter_telefone_pf(p.cd_pessoa_fisica,2) Business_Phone_Number,
		CASE WHEN ie_estado_civil=2 THEN 'M' WHEN ie_estado_civil=1 THEN 'S' WHEN ie_estado_civil=3 THEN 'D' WHEN ie_estado_civil=7 THEN 'C' WHEN ie_estado_civil=9 THEN 'O'  ELSE NULL END  Marital_Status,
		p.cd_pessoa_fisica,
		elimina_acentuacao(coalesce(obter_compl_pf(p.cd_pessoa_fisica,1,'DM'),obter_compl_pf(p.cd_pessoa_fisica,1,'DSM'))) city,
		obter_compl_pf(p.cd_pessoa_fisica,1,'CEL') cellphone
FROM 	pessoa_fisica p;

