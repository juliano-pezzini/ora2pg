-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW movto_contab_rm_v (nr_lote_contabil, nr_sequencia, cd_conta_contabil, ie_debito_credito, cd_historico, dt_movimento, vl_movimento, dt_atualizacao, nm_usuario, cd_centro_custo, ds_compl_historico, nr_seq_trans_fin, cd_cgc, nr_seq_agrupamento, nr_doc, ds_historico, ds_conta_contabil, ds_centro_custo, cd_conta_debito, cd_conta_credito, ci_integra, ie_deb_cred_num, ds_compl_fixo, ds_historico_fixo, cd_estabelecimento, dt_referencia, cd_tipo_lote_contabil, vl_debito_credito, ds_contra_partida, cd_centro_custo_debito, cd_centro_custo_credito, nr_documento, cd_conta_gerencial, vl_movto, dt_cotacao, vl_cotacao, cd_depto, cd_estab_logado) AS SELECT 	A.NR_LOTE_CONTABIL,
	A.NR_SEQUENCIA       ,
	A.CD_CONTA_CONTABIL  ,
	A.IE_DEBITO_CREDITO  ,
	H.CD_SISTEMA_CONTABIL CD_HISTORICO,
	A.DT_MOVIMENTO       ,
	A.VL_MOVIMENTO       ,
	A.DT_ATUALIZACAO     ,
	A.NM_USUARIO         ,
	A.CD_CENTRO_CUSTO    ,
	A.DS_COMPL_HISTORICO ,
	A.NR_SEQ_TRANS_FIN   ,
	A.CD_CGC             ,
	A.NR_SEQ_AGRUPAMENTO ,
	A.NR_DOCUMENTO nr_doc,
	substr((H.DS_HISTORICO || ' ' || A.DS_COMPL_HISTORICO),1,250) DS_HISTORICO,
	B.DS_CONTA_CONTABIL,
	C.DS_CENTRO_CUSTO,
	CASE WHEN A.IE_DEBITO_CREDITO='D' THEN  A.CD_CONTA_CONTABIL  ELSE null END  CD_CONTA_DEBITO,
	CASE WHEN A.IE_DEBITO_CREDITO='C' THEN  A.CD_CONTA_CONTABIL  ELSE null END  CD_CONTA_CREDITO,
	CASE WHEN coalesce(A.CD_CENTRO_CUSTO, '0')=0 THEN  'N'  ELSE 'S' END  CI_INTEGRA,
	CASE WHEN A.IE_DEBITO_CREDITO='D' THEN  1  ELSE 2 END  IE_DEB_CRED_NUM,
	substr(ds_compl_historico || lpad(' ', 350 - length(ds_compl_historico)),1,350) ds_compl_fixo,
	substr((H.DS_HISTORICO || ' ' || A.DS_COMPL_HISTORICO) ||
		lpad(' ', 350 - length(H.DS_HISTORICO || ' ' || ds_compl_historico)),1,350) ds_historico_fixo,
	X.CD_ESTABELECIMENTO,
	X.DT_REFERENCIA,
	X.CD_TIPO_LOTE_CONTABIL,
	CASE WHEN A.IE_DEBITO_CREDITO='C' THEN A.VL_MOVIMENTO * -1  ELSE A.VL_MOVIMENTO END  VL_DEBITO_CREDITO,
	'                    ' DS_CONTRA_PARTIDA,
	CASE WHEN A.IE_DEBITO_CREDITO='D' THEN  A.CD_centro_custo  ELSE 0 END  CD_centro_custo_DEBITO,
	CASE WHEN A.IE_DEBITO_CREDITO='C' THEN  A.CD_centro_custo  ELSE 0 END  CD_centro_custo_CREDITO,
	substr(somente_numero(A.DS_COMPL_HISTORICO),1,10) nr_documento,
	CASE WHEN B.ie_centro_Custo='S' THEN A.cd_centro_custo  ELSE null END  cd_conta_gerencial,
	CASE WHEN B.ie_centro_custo='S' THEN CASE WHEN A.ie_debito_credito='D' THEN A.vl_movimento  ELSE A.vl_movimento * -1 END   ELSE null END  vl_movto,
	'        ' dt_cotacao,
	0 vl_cotacao,
	'                    ' cd_depto,
	wheb_usuario_pck.get_cd_estabelecimento cd_estab_logado
FROM lote_contabil x, historico_padrao h, conta_contabil b, movimento_contabil a
LEFT OUTER JOIN centro_custo c ON (A.CD_CENTRO_CUSTO = C.CD_CENTRO_CUSTO)
WHERE A.CD_CONTA_CONTABIL 	= B.CD_CONTA_CONTABIL AND A.CD_HISTORICO		= H.CD_HISTORICO AND A.NR_LOTE_CONTABIL	= X.NR_LOTE_CONTABIL;

