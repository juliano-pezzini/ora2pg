-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_auditoria_solic_pendente_v (nr_sequencia, nr_seq_segurado, nr_seq_prestador, ie_permite_just_prestadores, dt_auditoria, dt_liberacao, tipo_guia, nm_segurado, nr_carteira, nm_medico, nr_protocolo, nr_seq_guia, nr_seq_requisicao, dt_validade, ie_origem_justificativa) AS select	a.nr_sequencia,
	a.nr_seq_segurado, 
	a.nr_seq_prestador, 
	a.ie_permite_just_prestadores, 
	to_char(a.dt_auditoria, 'dd/mm/yyyy') dt_auditoria, 
	to_char(a.dt_liberacao, 'dd/mm/yyyy') dt_liberacao, 
	substr(obter_valor_dominio(1746, a.ie_tipo_guia), 1, 255) tipo_guia, 
	(	select	x.nm_pessoa_fisica 
		FROM	pessoa_fisica x 
		where	x.cd_pessoa_fisica	= (	select	y.cd_pessoa_fisica 
							from	pls_segurado y 
							where	y.nr_sequencia = a.nr_seq_segurado)) nm_segurado, 
	(	select	max(x.cd_usuario_plano) 
		from	pls_segurado_carteira x 
		where	x.nr_seq_segurado = a.nr_seq_segurado) nr_carteira, 
	substr(obter_nome_pf(a.cd_medico_solicitante), 1, 80) nm_medico, 
	coalesce(a.nr_seq_guia, a.nr_seq_requisicao) nr_protocolo, 
	a.nr_seq_guia, 
	a.nr_seq_requisicao, 
	pls_obter_valid_req_guia_web(a.nr_seq_requisicao, a.nr_seq_guia) dt_validade, 
	'AA' ie_origem_justificativa 
from	pls_auditoria a 
where	ie_status = 'A' 

union all
 
select	a.nr_sequencia, 
	a.nr_seq_segurado, 
	a.nr_seq_prestador, 
	a.ie_permite_just_prestadores, 
	to_char(a.dt_auditoria, 'dd/mm/yyyy') dt_auditoria, 
	to_char(a.dt_liberacao, 'dd/mm/yyyy') dt_liberacao, 
	substr(obter_valor_dominio(1746, a.ie_tipo_guia), 1, 255) tipo_guia, 
	(	select	x.nm_pessoa_fisica 
		from	pessoa_fisica x 
		where	x.cd_pessoa_fisica	= (	select	y.cd_pessoa_fisica 
							from	pls_segurado y 
							where	y.nr_sequencia = a.nr_seq_segurado)) nm_segurado, 
	(	select	max(x.cd_usuario_plano) 
		from	pls_segurado_carteira x 
		where	x.nr_seq_segurado = a.nr_seq_segurado) nr_carteira, 
	substr(obter_nome_pf(a.cd_medico_solicitante), 1, 80) nm_medico, 
	coalesce(a.nr_seq_guia, a.nr_seq_requisicao) nr_protocolo, 
	a.nr_seq_guia, 
	a.nr_seq_requisicao, 
	pls_obter_valid_req_guia_web(a.nr_seq_requisicao, a.nr_seq_guia) dt_validade, 
	'AA' ie_origem_justificativa 
from	pls_auditoria a 
where	ie_status = 'AF' 

union all
 
select	a.nr_sequencia, 
	a.nr_seq_segurado, 
	a.nr_seq_prestador,	 
	a.ie_permite_just_prestadores,	 
	to_char(a.dt_auditoria, 'dd/mm/yyyy') dt_auditoria, 
	to_char(a.dt_liberacao, 'dd/mm/yyyy') dt_liberacao, 
	substr(obter_valor_dominio(1746, a.ie_tipo_guia), 1, 255) tipo_guia, 
	(	select	x.nm_pessoa_fisica 
		from	pessoa_fisica x 
		where	x.cd_pessoa_fisica	= (	select	y.cd_pessoa_fisica 
							from	pls_segurado y 
							where	y.nr_sequencia = a.nr_seq_segurado)) nm_segurado, 
	(	select	max(x.cd_usuario_plano) 
		from	pls_segurado_carteira x 
		where	x.nr_seq_segurado = a.nr_seq_segurado) nr_carteira, 
	substr(obter_nome_pf(a.cd_medico_solicitante), 1, 80) nm_medico, 
	coalesce(a.nr_seq_guia, a.nr_seq_requisicao) nr_protocolo, 
	a.nr_seq_guia, 
	a.nr_seq_requisicao, 
	pls_obter_valid_req_guia_web(a.nr_seq_requisicao, a.nr_seq_guia) dt_validade, 
	'AA' ie_origem_justificativa 
from	pls_auditoria a 
where	ie_status = 'AN' 

union all
 
select	a.nr_sequencia, 
	a.nr_seq_segurado, 
	a.nr_seq_prestador, 
	a.ie_permite_just_prestadores, 
	to_char(a.dt_auditoria, 'dd/mm/yyyy') dt_auditoria, 
	to_char(a.dt_liberacao, 'dd/mm/yyyy') dt_liberacao, 
	substr(obter_valor_dominio(1746, a.ie_tipo_guia), 1, 255) tipo_guia, 
	(	select	x.nm_pessoa_fisica 
		from	pessoa_fisica x 
		where	x.cd_pessoa_fisica	= (	select	y.cd_pessoa_fisica 
							from	pls_segurado y 
							where	y.nr_sequencia = a.nr_seq_segurado)) nm_segurado, 
	(	select	max(x.cd_usuario_plano) 
		from	pls_segurado_carteira x 
		where	x.nr_seq_segurado = a.nr_seq_segurado) nr_carteira, 
	substr(obter_nome_pf(a.cd_medico_solicitante), 1, 80) nm_medico, 
	coalesce(a.nr_seq_guia, a.nr_seq_requisicao) nr_protocolo, 
	a.nr_seq_guia, 
	a.nr_seq_requisicao, 
	pls_obter_valid_req_guia_web(a.nr_seq_requisicao, a.nr_seq_guia) dt_validade, 
	'AA' ie_origem_justificativa 
from	pls_auditoria a 
where	ie_status = 'AP' 

union all
 
select	a.nr_sequencia, 
	a.nr_seq_segurado, 
	a.nr_seq_prestador, 
	a.ie_permite_just_prestadores, 
	to_char(a.dt_auditoria, 'dd/mm/yyyy') dt_auditoria, 
	to_char(a.dt_liberacao, 'dd/mm/yyyy') dt_liberacao, 
	substr(obter_valor_dominio(1746, a.ie_tipo_guia), 1, 255) tipo_guia, 
	(	select	x.nm_pessoa_fisica 
		from	pessoa_fisica x 
		where	x.cd_pessoa_fisica	= (	select	y.cd_pessoa_fisica 
							from	pls_segurado y 
							where	y.nr_sequencia = a.nr_seq_segurado)) nm_segurado, 
	(	select	max(x.cd_usuario_plano) 
		from	pls_segurado_carteira x 
		where	x.nr_seq_segurado = a.nr_seq_segurado) nr_carteira, 
	substr(obter_nome_pf(a.cd_medico_solicitante), 1, 80) nm_medico, 
	coalesce(a.nr_seq_guia, a.nr_seq_requisicao) nr_protocolo, 
	a.nr_seq_guia, 
	a.nr_seq_requisicao, 
	pls_obter_valid_req_guia_web(a.nr_seq_requisicao, a.nr_seq_guia) dt_validade, 
	'AA' ie_origem_justificativa 
from	pls_auditoria a 
where	ie_status = 'AE' 

union all
 
select	a.nr_sequencia, 
	a.nr_seq_segurado, 
	a.nr_seq_prestador, 
	a.ie_permite_just_prestadores, 
	to_char(a.dt_auditoria, 'dd/mm/yyyy') dt_auditoria, 
	to_char(a.dt_liberacao, 'dd/mm/yyyy') dt_liberacao, 
	substr(obter_valor_dominio(1746, a.ie_tipo_guia), 1, 255) tipo_guia, 
	(	select	x.nm_pessoa_fisica 
		from	pessoa_fisica x 
		where	x.cd_pessoa_fisica	= (	select	y.cd_pessoa_fisica 
							from	pls_segurado y 
							where	y.nr_sequencia = a.nr_seq_segurado)) nm_segurado, 
	(	select	max(x.cd_usuario_plano) 
		from	pls_segurado_carteira x 
		where	x.nr_seq_segurado = a.nr_seq_segurado) nr_carteira, 
	substr(obter_nome_pf(a.cd_medico_solicitante), 1, 80) nm_medico, 
	coalesce(a.nr_seq_guia, a.nr_seq_requisicao) nr_protocolo, 
	a.nr_seq_guia, 
	a.nr_seq_requisicao, 
	pls_obter_valid_req_guia_web(a.nr_seq_requisicao, a.nr_seq_guia) dt_validade, 
	'AA' ie_origem_justificativa 
from	pls_auditoria a 
where	ie_status = 'F' 

union all
 
select	a.nr_sequencia, 
	a.nr_seq_segurado, 
	a.nr_seq_prestador, 
	a.ie_permite_just_prestadores, 
	to_char(a.dt_auditoria, 'dd/mm/yyyy') dt_auditoria, 
	to_char(a.dt_liberacao, 'dd/mm/yyyy') dt_liberacao, 
	substr(obter_valor_dominio(1746, a.ie_tipo_guia), 1, 255) tipo_guia, 
	(	select	x.nm_pessoa_fisica 
		from	pessoa_fisica x 
		where	x.cd_pessoa_fisica	= (	select	y.cd_pessoa_fisica 
							from	pls_segurado y 
							where	y.nr_sequencia = a.nr_seq_segurado)) nm_segurado, 
	(	select	max(x.cd_usuario_plano) 
		from	pls_segurado_carteira x 
		where	x.nr_seq_segurado = a.nr_seq_segurado) nr_carteira, 
	substr(obter_nome_pf(a.cd_medico_solicitante), 1, 80) nm_medico, 
	coalesce(a.nr_seq_guia, a.nr_seq_requisicao) nr_protocolo, 
	a.nr_seq_guia, 
	a.nr_seq_requisicao, 
	pls_obter_valid_req_guia_web(a.nr_seq_requisicao, a.nr_seq_guia) dt_validade, 
	'AA' ie_origem_justificativa 
from	pls_auditoria a 
where	ie_status = 'C' 

union all
 
select	a.nr_sequencia, 
	a.nr_seq_segurado, 
	a.nr_seq_prestador, 
	a.ie_permite_just_prestadores, 
	to_char(a.dt_auditoria, 'dd/mm/yyyy') dt_auditoria, 
	to_char(a.dt_liberacao, 'dd/mm/yyyy') dt_liberacao, 
	substr(obter_valor_dominio(1746, a.ie_tipo_guia), 1, 255) tipo_guia, 
	(	select	x.nm_pessoa_fisica 
		from	pessoa_fisica x 
		where	x.cd_pessoa_fisica	= (	select	y.cd_pessoa_fisica 
							from	pls_segurado y 
							where	y.nr_sequencia = a.nr_seq_segurado)) nm_segurado, 
	(	select	max(x.cd_usuario_plano) 
		from	pls_segurado_carteira x 
		where	x.nr_seq_segurado = a.nr_seq_segurado) nr_carteira, 
	substr(obter_nome_pf(a.cd_medico_solicitante), 1, 80) nm_medico, 
	coalesce(a.nr_seq_guia, a.nr_seq_requisicao) nr_protocolo, 
	a.nr_seq_guia, 
	a.nr_seq_requisicao, 
	pls_obter_valid_req_guia_web(a.nr_seq_requisicao, a.nr_seq_guia) dt_validade, 
	'AA' ie_origem_justificativa 
from	pls_auditoria a 
where	ie_status = 'ACO' 

union all
 
select	a.nr_sequencia, 
	a.nr_seq_segurado, 
	a.nr_seq_prestador, 
	a.ie_permite_just_prestadores, 
	to_char(a.dt_auditoria, 'dd/mm/yyyy') dt_auditoria, 
	to_char(a.dt_liberacao, 'dd/mm/yyyy') dt_liberacao, 
	substr(obter_valor_dominio(1746, a.ie_tipo_guia), 1, 255) tipo_guia, 
	(	select	x.nm_pessoa_fisica 
		from	pessoa_fisica x 
		where	x.cd_pessoa_fisica	= (	select	y.cd_pessoa_fisica 
							from	pls_segurado y 
							where	y.nr_sequencia = a.nr_seq_segurado)) nm_segurado, 
	(	select	max(x.cd_usuario_plano) 
		from	pls_segurado_carteira x 
		where	x.nr_seq_segurado = a.nr_seq_segurado) nr_carteira, 
	substr(obter_nome_pf(a.cd_medico_solicitante), 1, 80) nm_medico, 
	coalesce(a.nr_seq_guia, a.nr_seq_requisicao) nr_protocolo, 
	a.nr_seq_guia, 
	a.nr_seq_requisicao, 
	pls_obter_valid_req_guia_web(a.nr_seq_requisicao, a.nr_seq_guia) dt_validade, 
	'AA' ie_origem_justificativa 
from	pls_auditoria a 
where	ie_status = 'AAG';

