-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW scheduling_check_today_appts_v (nr_sequencia, cd_agenda, dt_agenda, cd_tipo_agenda, ie_status_agenda, cd_pessoa_fisica, cd_estabelecimento, nr_atendimento, hr_agenda, ds_status, ds_tipo_agenda, ds_agenda, ds_especialidade) AS SELECT  a.nr_sequencia,
        a.cd_agenda,
        a.dt_agenda,
        a.cd_tipo_agenda,
        a.ie_status_agenda,
        a.cd_pessoa_fisica,
        a.cd_estabelecimento,
        a.nr_atendimento,
        to_char(a.dt_agenda,'hh24:mi') hr_agenda,
        substr(obter_valor_dominio(83, a.ie_status_agenda),1,255) ds_status,
        (SELECT SUBSTR(obter_desc_expressao(CD_EXP_VALOR_DOMINIO),1,255)
        FROM valor_dominio WHERE cd_dominio = 2772 AND vl_dominio = 'C') DS_TIPO_AGENDA,
        SUBSTR(a.nm_pessoa_fisica,1,60) ds_agenda,
        (SUBSTR(obter_desc_espec_medica(a.cd_especialidade),1,240)) ds_especialidade
FROM    consulta_agecons_html5_v a
WHERE   a.cd_tipo_agenda = 3
AND     CASE WHEN   obter_parametro_usuario_js(970, 16)='S' THEN  CASE WHEN a.cd_estabelecimento=wheb_usuario_pck.get_cd_estabelecimento THEN  'S'  ELSE 'N' END  WHEN   obter_parametro_usuario_js(970, 16)='N' THEN  obter_se_estabelecido_usuario(wheb_usuario_pck.get_nm_usuario, a.cd_estabelecimento)  ELSE 'S' END  = 'S'
AND     a.dt_agenda BETWEEN establishment_timezone_utils.startOfDay(LOCALTIMESTAMP) AND establishment_timezone_utils.endOfDay(LOCALTIMESTAMP)
/* EXAME SCHEDULE */

UNION ALL

SELECT  a.nr_sequencia,
        a.cd_agenda,
        a.dt_agenda,
        a.cd_tipo_agenda,
        a.ie_status_agenda,
        a.cd_pessoa_fisica,
        a.cd_estabelecimento,
        a.nr_atendimento,
        to_char(a.hr_inicio,'hh24:mi') hr_agenda,
        substr(obter_valor_dominio(83, a.ie_status_agenda),1,255) ds_status,
        (SELECT SUBSTR(obter_desc_expressao(CD_EXP_VALOR_DOMINIO),1,255) FROM valor_dominio WHERE cd_dominio = 2772 AND vl_dominio = 'E') DS_TIPO_AGENDA,
        a.ds_agenda,
        (SUBSTR(obter_desc_espec_medica(a.cd_especialidade),1,240)) ds_especialidade
FROM    consulta_ageexam_html5_v a
WHERE   a.cd_tipo_agenda = 2
AND     CASE WHEN   obter_parametro_usuario_js(970, 16)='S' THEN  CASE WHEN a.cd_estabelecimento=wheb_usuario_pck.get_cd_estabelecimento THEN  'S'  ELSE 'N' END  WHEN   obter_parametro_usuario_js(970, 16)='N' THEN  obter_se_estabelecido_usuario(wheb_usuario_pck.get_nm_usuario, a.cd_estabelecimento)  ELSE 'S' END  = 'S'
AND     a.dt_agenda BETWEEN establishment_timezone_utils.startOfDay(LOCALTIMESTAMP) AND establishment_timezone_utils.endOfDay(LOCALTIMESTAMP)
/* SERVICE SCHEDULE */

UNION ALL

SELECT  a.nr_sequencia,
        a.cd_agenda,
        a.dt_agenda,
        a.cd_tipo_agenda,
        a.ie_status_agenda,
        a.cd_pessoa_fisica,
        a.cd_estabelecimento,
        a.nr_atendimento,
        to_char(a.dt_agenda,'hh24:mi') hr_agenda,
        substr(obter_valor_dominio(83, a.ie_status_agenda),1,255) ds_status,
        (SELECT SUBSTR(obter_desc_expressao(CD_EXP_VALOR_DOMINIO),1,255) FROM valor_dominio WHERE cd_dominio = 2772 AND vl_dominio = 'S') DS_TIPO_AGENDA,
        a.ds_agenda,
        (SUBSTR(obter_desc_espec_medica(a.cd_especialidade),1,240)) ds_especialidade
FROM    consulta_ageserv_html5_v a
WHERE   a.cd_tipo_agenda = 5
AND     CASE WHEN   obter_parametro_usuario_js(970, 16)='S' THEN  CASE WHEN a.cd_estabelecimento=wheb_usuario_pck.get_cd_estabelecimento THEN  'S'  ELSE 'N' END  WHEN   obter_parametro_usuario_js(970, 16)='N' THEN  obter_se_estabelecido_usuario(wheb_usuario_pck.get_nm_usuario, a.cd_estabelecimento)  ELSE 'S' END  = 'S'
AND     a.dt_agenda BETWEEN establishment_timezone_utils.startOfDay(LOCALTIMESTAMP) AND establishment_timezone_utils.endOfDay(LOCALTIMESTAMP);

