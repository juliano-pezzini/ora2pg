-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW obter_cpoe_pend_gqa_v (ds, nr_order_unit, dt_prev_execucao, ie_tipo_item, nr_atendimento, nr_seq_cpoe_tipo_pedido, nr_seq_pend_pac_acao, nr_sequencia) AS SELECT DISTINCT(obter_desc_expressao_idioma(1041291, null, wheb_usuario_pck.get_nr_seq_idioma) || ' ' || cou.nr_order_unit || ' - ' || Obter_Descricao_Dominio((7768), cou.SI_CPOE_TYPE_OF_ITEM) || ' - ' || pkg_date_formaters.to_varchar(cp.dt_inicio, 'shortDate', WHEB_USUARIO_PCK.GET_CD_ESTABELECIMENTO, WHEB_USUARIO_PCK.GET_NM_USUARIO)) DS,
                cou.nr_order_unit NR_ORDER_UNIT,
                TO_DATE(cp.dt_inicio) dt_prev_execucao,
                'N' IE_TIPO_ITEM,
                cp.nr_atendimento,
				cou.NR_SEQ_CPOE_TIPO_PEDIDO,
                cp.NR_SEQ_PEND_PAC_ACAO,
                cp.NR_SEQUENCIA
FROM CPOE_DIETA cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE cp.dt_liberacao IS NOT NULL
AND	((cp.dt_fim > LOCALTIMESTAMP) or (cp.dt_fim is null))
/*AND (cp.ie_baixado_por_alta = 'S' OR EXISTS (SELECT 1 FROM PRESCR_DIETA pd WHERE pd.nr_seq_dieta_cpoe = cp.nr_sequencia AND pd.dt_baixa IS NULL AND pd.dt_suspensao IS NULL))*/

UNION ALL

/* Medicine */

SELECT DISTINCT(obter_desc_expressao_idioma(1041291, null, wheb_usuario_pck.get_nr_seq_idioma) || ' ' || cou.nr_order_unit || ' - ' || Obter_Descricao_Dominio((7768), cou.SI_CPOE_TYPE_OF_ITEM) || ' - ' || pkg_date_formaters.to_varchar(cp.dt_inicio, 'shortDate', WHEB_USUARIO_PCK.GET_CD_ESTABELECIMENTO, WHEB_USUARIO_PCK.GET_NM_USUARIO)) DS,
                cou.nr_order_unit NR_ORDER_UNIT,
                TO_DATE(cp.DT_INICIO) dt_prev_execucao,
                'M' IE_TIPO_ITEM,
                cp.nr_atendimento,
				cou.NR_SEQ_CPOE_TIPO_PEDIDO,
                cp.NR_SEQ_PEND_PAC_ACAO,
                cp.NR_SEQUENCIA
FROM CPOE_MATERIAL cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
JOIN CPOE_RP rp ON cp.nr_seq_cpoe_rp = rp.nr_sequencia
WHERE coalesce(ie_material, 'N') = 'N'
AND cp.dt_liberacao IS NOT NULL
AND	((cp.dt_fim > LOCALTIMESTAMP) or (cp.dt_fim is null))
--AND (cp.ie_baixado_por_alta = 'S' OR EXISTS (SELECT 1 FROM PRESCR_MATERIAL pd WHERE pd.nr_seq_mat_cpoe = cp.nr_sequencia AND pd.dt_baixa IS NULL AND pd.dt_suspensao IS NULL))
UNION ALL

/* Procedure */

SELECT DISTINCT(obter_desc_expressao_idioma(1041291, null, wheb_usuario_pck.get_nr_seq_idioma) || ' ' || cou.nr_order_unit || ' - ' || Obter_Descricao_Dominio((7768), cou.SI_CPOE_TYPE_OF_ITEM) || ' - ' || pkg_date_formaters.to_varchar(cp.dt_prev_execucao, 'shortDate', WHEB_USUARIO_PCK.GET_CD_ESTABELECIMENTO, WHEB_USUARIO_PCK.GET_NM_USUARIO)) DS,
                cou.nr_order_unit NR_ORDER_UNIT,
                TO_DATE(cp.dt_prev_execucao) dt_prev_execucao,
                'P' IE_TIPO_ITEM,
                cp.nr_atendimento,
				cou.NR_SEQ_CPOE_TIPO_PEDIDO,
                cp.NR_SEQ_PEND_PAC_ACAO,
                cp.NR_SEQUENCIA
FROM CPOE_PROCEDIMENTO cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE cp.dt_liberacao IS NOT NULL
AND	((cp.dt_fim > LOCALTIMESTAMP) or (cp.dt_fim is null))
--AND (cp.ie_baixado_por_alta = 'S' OR EXISTS (SELECT 1 FROM PRESCR_PROCEDIMENTO pd WHERE pd.NR_SEQ_PROC_CPOE = cp.nr_sequencia AND pd.dt_baixa IS NULL AND pd.dt_suspensao IS NULL))
UNION ALL

/* Gastherapy */

SELECT DISTINCT(obter_desc_expressao_idioma(1041291, null, wheb_usuario_pck.get_nr_seq_idioma) || ' ' || cou.nr_order_unit || ' - ' || Obter_Descricao_Dominio((7768), cou.SI_CPOE_TYPE_OF_ITEM) || ' - ' || pkg_date_formaters.to_varchar(cp.dt_inicio, 'shortDate', WHEB_USUARIO_PCK.GET_CD_ESTABELECIMENTO, WHEB_USUARIO_PCK.GET_NM_USUARIO)) DS,
                cou.nr_order_unit NR_ORDER_UNIT,
                TO_DATE(cp.dt_inicio) dt_prev_execucao,
                'G' IE_TIPO_ITEM,
                cp.nr_atendimento,
				cou.NR_SEQ_CPOE_TIPO_PEDIDO,
                cp.NR_SEQ_PEND_PAC_ACAO,
                cp.NR_SEQUENCIA
FROM CPOE_GASOTERAPIA cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE cp.dt_liberacao IS NOT NULL
AND	((cp.dt_fim > LOCALTIMESTAMP) or (cp.dt_fim is null))

UNION ALL

/* Interventions and Recommendations */

SELECT DISTINCT(obter_desc_expressao_idioma(1041291, null, wheb_usuario_pck.get_nr_seq_idioma) || ' ' || cou.nr_order_unit || ' - ' || Obter_Descricao_Dominio((7768), cou.SI_CPOE_TYPE_OF_ITEM) || ' - ' || pkg_date_formaters.to_varchar(cp.dt_inicio, 'shortDate', WHEB_USUARIO_PCK.GET_CD_ESTABELECIMENTO, WHEB_USUARIO_PCK.GET_NM_USUARIO)) DS,
                cou.nr_order_unit NR_ORDER_UNIT,
                TO_DATE(cp.dt_inicio) dt_prev_execucao,
                'R' IE_TIPO_ITEM,
                cp.nr_atendimento,
				cou.NR_SEQ_CPOE_TIPO_PEDIDO,
                cp.NR_SEQ_PEND_PAC_ACAO,
                cp.NR_SEQUENCIA
FROM CPOE_RECOMENDACAO cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE cp.dt_liberacao IS NOT NULL
AND	((cp.dt_fim > LOCALTIMESTAMP) or (cp.dt_fim is null))

UNION ALL

/* Blood and Blood Products */

SELECT DISTINCT(obter_desc_expressao_idioma(1041291, null, wheb_usuario_pck.get_nr_seq_idioma) || ' ' || cou.nr_order_unit || ' - ' || Obter_Descricao_Dominio((7768), cou.SI_CPOE_TYPE_OF_ITEM) || ' - ' || pkg_date_formaters.to_varchar(cp.dt_inicio, 'shortDate', WHEB_USUARIO_PCK.GET_CD_ESTABELECIMENTO, WHEB_USUARIO_PCK.GET_NM_USUARIO)) DS,
                cou.nr_order_unit NR_ORDER_UNIT,
                TO_DATE(cp.dt_inicio) dt_prev_execucao,
                'H' IE_TIPO_ITEM,
                cp.nr_atendimento,
				cou.NR_SEQ_CPOE_TIPO_PEDIDO,
                cp.NR_SEQ_PEND_PAC_ACAO,
                cp.NR_SEQUENCIA
FROM CPOE_HEMOTERAPIA cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE cp.dt_liberacao IS NOT NULL
AND	((cp.dt_fim > LOCALTIMESTAMP) or (cp.dt_fim is null))

UNION ALL

/* Dialisys */

SELECT DISTINCT(obter_desc_expressao_idioma(1041291, null, wheb_usuario_pck.get_nr_seq_idioma) || ' ' || cou.nr_order_unit || ' - ' || Obter_Descricao_Dominio((7768), cou.SI_CPOE_TYPE_OF_ITEM) || ' - ' || pkg_date_formaters.to_varchar(cp.dt_inicio, 'shortDate', WHEB_USUARIO_PCK.GET_CD_ESTABELECIMENTO, WHEB_USUARIO_PCK.GET_NM_USUARIO)) DS,
                cou.nr_order_unit NR_ORDER_UNIT,
                TO_DATE(cp.dt_inicio) dt_prev_execucao,
                'D' IE_TIPO_ITEM,
                cp.nr_atendimento,
				cou.NR_SEQ_CPOE_TIPO_PEDIDO,
                cp.NR_SEQ_PEND_PAC_ACAO,
                cp.NR_SEQUENCIA
FROM CPOE_DIALISE cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE cp.dt_liberacao IS NOT NULL
AND	((cp.dt_fim > LOCALTIMESTAMP) or (cp.dt_fim is null))

UNION ALL

/* Nursing interventions */

SELECT DISTINCT(obter_desc_expressao_idioma(1041291, null, wheb_usuario_pck.get_nr_seq_idioma) || ' ' || cou.nr_order_unit || ' - ' || Obter_Descricao_Dominio((7768), cou.SI_CPOE_TYPE_OF_ITEM) || ' - ' || pkg_date_formaters.to_varchar(cp.dt_inicio, 'shortDate', WHEB_USUARIO_PCK.GET_CD_ESTABELECIMENTO, WHEB_USUARIO_PCK.GET_NM_USUARIO)) DS,
                cou.nr_order_unit NR_ORDER_UNIT,
                TO_DATE(cp.dt_inicio) dt_prev_execucao,
                'I' IE_TIPO_ITEM,
                cp.nr_atendimento,
				cou.NR_SEQ_CPOE_TIPO_PEDIDO,
                NULL NR_SEQ_PEND_PAC_ACAO,
                cp.NR_SEQUENCIA
FROM CPOE_INTERVENCAO cp
LEFT JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE cp.dt_liberacao IS NOT NULL
AND	((cp.dt_fim > LOCALTIMESTAMP) or (cp.dt_fim is null))

UNION ALL

/* Materials */

SELECT DISTINCT(obter_desc_expressao_idioma(1041291, null, wheb_usuario_pck.get_nr_seq_idioma) || ' ' || cou.nr_order_unit || ' - ' || Obter_Descricao_Dominio((7768), cou.SI_CPOE_TYPE_OF_ITEM) || ' - ' || pkg_date_formaters.to_varchar(cp.dt_inicio, 'shortDate', WHEB_USUARIO_PCK.GET_CD_ESTABELECIMENTO, WHEB_USUARIO_PCK.GET_NM_USUARIO)) DS,
                cou.nr_order_unit NR_ORDER_UNIT,
                TO_DATE(cp.DT_INICIO) dt_prev_execucao,
                'MA' IE_TIPO_ITEM,
                cp.nr_atendimento,
				cou.NR_SEQ_CPOE_TIPO_PEDIDO,
                cp.NR_SEQ_PEND_PAC_ACAO,
                cp.NR_SEQUENCIA
FROM CPOE_MATERIAL cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE coalesce(ie_material, 'N') = 'S'
AND cp.dt_liberacao IS NOT NULL
AND	((cp.dt_fim > LOCALTIMESTAMP) or (cp.dt_fim is null));

