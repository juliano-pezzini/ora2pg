-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_desempenho_amb_v (ds_esp_total, ds_esp_pre, ds_min_pre, ds_esp_consulta, ds_min_consulta, cd_setor_atendimento, ds_setor_atendimento, dt_entrada, cd_estabelecimento, dt_lib_medico, dt_aguardando, dt_inicio_atendimento, dt_fim_triagem, dt_atend_medico, dt_fim_consulta, cd_empresa) AS select	substr(obter_intervalo_minutos(obter_minutos_espera(a.dt_entrada, a.dt_lib_medico)),1,15) ds_esp_total,
	substr(obter_intervalo_minutos(obter_minutos_espera(g.dt_aguardando, a.dt_inicio_atendimento)),1,15) ds_esp_pre, 
  	substr(obter_intervalo_minutos(obter_minutos_espera(a.dt_inicio_atendimento, a.dt_fim_triagem)),1,15) ds_min_pre, 
  	substr(obter_intervalo_minutos(obter_minutos_espera(g.dt_aguardando, a.dt_atend_medico)),1,15) ds_esp_consulta, 
  	substr(obter_intervalo_minutos(obter_minutos_espera(a.dt_atend_medico, a.dt_fim_consulta)),1,15) ds_min_consulta, 
	s.cd_setor_atendimento, 
	s.ds_setor_atendimento, 
	a.dt_entrada dt_entrada, 
	a.cd_estabelecimento, 
	a.dt_lib_medico, 
	g.dt_aguardando, 
	a.dt_inicio_atendimento, 
	a.dt_fim_triagem, 
	a.dt_atend_medico, 
	a.dt_fim_consulta, 
	obter_empresa_estab(a.cd_estabelecimento) cd_empresa 
FROM	atendimento_paciente a, 
	agenda_consulta g,	 
	atend_paciente_unidade u, 
	setor_atendimento s 
where	a.nr_atendimento = g.nr_atendimento 
and	u.cd_setor_atendimento 	= s.cd_setor_atendimento 
and	u.nr_seq_interno 	= obter_atepacu_paciente(a.nr_atendimento,'P') 
and	u.nr_atendimento		= a.nr_atendimento 
and	s.cd_classif_setor 	= 1 
and	g.ie_status_agenda 	<> 'C';

