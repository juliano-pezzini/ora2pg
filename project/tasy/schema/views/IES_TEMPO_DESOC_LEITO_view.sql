-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ies_tempo_desoc_leito (nr_atendimento, ie_tipo_vaga, ds_tipo_vaga, cd_pessoa_fisica, dt_alta, dt_alta_medico, dt_saida_real, dt_cancelamento, ie_tipo_atendimento, ds_tipo_atendimento, cd_especialidade, ds_especialidade, nr_seq_tipo_acidente, ds_tipo_acidente, dt_final, tmp_espera, nr_seq_unid_atual, dt_ini_hig) AS SELECT NR_ATENDIMENTO,
  IE_TIPO_VAGA,
  DS_TIPO_VAGA,
  CD_PESSOA_FISICA,
  DT_ALTA,
  DT_ALTA_MEDICO,
  DT_SAIDA_REAL,
  DT_CANCELAMENTO,
  IE_TIPO_ATENDIMENTO,
  DS_TIPO_ATENDIMENTO,
  CD_ESPECIALIDADE,
  OBTER_DESC_ESPEC_MEDICA(CD_ESPECIALIDADE) DS_ESPECIALIDADE,
  NR_SEQ_TIPO_ACIDENTE,
  DS_TIPO_ACIDENTE,
  DT_FINAL,
  OBTER_TEMPO_ENTRE_DATAS(DT_ALTA_MEDICO, DT_FINAL, 'H') TMP_ESPERA,
  NR_SEQ_UNID_ATUAL,
  DT_INICIO_HIGIENIZACAO(NR_ATENDIMENTO, NR_SEQ_UNID_ATUAL, DT_FINAL) DT_INI_HIG
FROM (
  SELECT AP.NR_ATENDIMENTO NR_ATENDIMENTO,
    AP.IE_TIPO_VAGA IE_TIPO_VAGA,
    OBTER_VALOR_DOMINIO(1410, AP.IE_TIPO_VAGA) DS_TIPO_VAGA,
    AP.CD_PESSOA_FISICA CD_PESSOA_FISICA,
    AP.DT_ALTA DT_ALTA,
    AP.DT_ALTA_MEDICO DT_ALTA_MEDICO,
    AP.DT_SAIDA_REAL DT_SAIDA_REAL,
    AP.DT_CANCELAMENTO DT_CANCELAMENTO,
    AP.IE_TIPO_ATENDIMENTO IE_TIPO_ATENDIMENTO,
    OBTER_NOME_TIPO_ATEND(AP.IE_TIPO_ATENDIMENTO) DS_TIPO_ATENDIMENTO,
    OBTER_ESPECIALIDADE_PF(OBTER_PF_USUARIO(AP.NM_USUARIO,'C')) CD_ESPECIALIDADE,
    AP.NR_SEQ_TIPO_ACIDENTE NR_SEQ_TIPO_ACIDENTE,
    OBTER_DESC_TIPO_ACIDENTE(AP.NR_SEQ_TIPO_ACIDENTE) DS_TIPO_ACIDENTE,
    AP.CD_ESTABELECIMENTO CD_ESTABELECIMENTO,
	coalesce(DT_SAIDA_REAL, DT_ALTA) DT_FINAL,
	AP.NR_SEQ_UNID_ATUAL NR_SEQ_UNID_ATUAL
  FROM ATENDIMENTO_PACIENTE AP
) ANTEND_INDIC
WHERE CD_ESTABELECIMENTO = OBTER_ESTABELECIMENTO_ATIVO;

