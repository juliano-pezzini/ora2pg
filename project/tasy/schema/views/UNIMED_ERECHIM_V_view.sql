-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW unimed_erechim_v (tp_registro, nr_seq, tp_reg, cd_uni_des, zeros, dt_geracao, nr_comp, nr_fatura, dt_vem_fat, dt_emi_fat, vl_tot_fat, vl_tot_fat_liq, reservado, vl_ajuste_fat, nr_ver_tra, rz_soci_prst, cgc_prst, nr_lote, nr_nota, tp_nota, uni_usua, id_benef, nm_benef, dt_atend, cd_excecao, tp_consulta, id_ambula, cd_ato, cd_cid, tp_paciente, emp_usua, tp_cobranca, tp_contr, cd_uni_hosp, cd_hosp, nm_hosp, tp_acomodacao, dt_internacao, dt_alta, ft_mult_amb, tp_admissao, tp_saida, cgc_hospital, tp_internacao, tp_nascimento, de_diag, cd_uni_pre, cd_prest, nm_prest, cgc_cpf_prest, tp_particip, dt_servico, tp_tabela, cd_servico, qt_cobrada, vl_serv_cob, vl_co_cob, vl_filme_cob, cd_porte_ane, cd_uni_aut, nr_autoriz, cgc_cpf_req, vl_adic_ser, vl_adic_co, vl_adic_filme, cd_espec, qt_tot_r552, qt_tot_r553, qt_tot_r554, qt_tot_r555, qt_not_exc, qt_not_amb, qt_tot_ser, vl_tot_serv, nr_seq_protocolo, nr_interno_conta) AS select		
	1						tp_registro, 
	1						nr_seq, 
	551						tp_reg, 
	0028						cd_uni_des, 
	0						zeros, 
	a.dt_remessa					dt_geracao, 
	b.dt_mesano_referencia				nr_comp, 
	a.nr_seq_protocolo				nr_fatura, 
	a.dt_vencimento					dt_vem_fat, 
	a.dt_remessa					dt_emi_fat, 
	c.vl_total_conta				vl_tot_fat, 
	c.vl_total_conta				vl_tot_fat_liq, 
	0						reservado, 
	c.vl_total_conta				vl_ajuste_fat, 
	03						nr_ver_tra, 
	substr(a.nm_hospital,1,40)		rz_soci_prst, 
	somente_numero(a.cd_cgc_hospital)	cgc_prst, 
	0						nr_lote, 
	' '						nr_nota, 
	0						tp_nota, 
	' '						uni_usua, 
	0						id_benef, 
	''						nm_benef, 
	LOCALTIMESTAMP					dt_atend, 
	0						cd_excecao, 
	0						tp_consulta, 
	''						id_ambula, 
	' '						cd_ato, 
	''						cd_cid, 
	''						tp_paciente, 
	' '						emp_usua, 
	0						tp_cobranca, 
	0						tp_contr, 
	0						cd_uni_hosp, 
	' '						cd_hosp, 
	''						nm_hosp, 
	''						tp_acomodacao, 
	LOCALTIMESTAMP					dt_internacao, 
	LOCALTIMESTAMP					dt_alta, 
	0						ft_mult_amb, 
	''						tp_admissao, 
	''						tp_saida, 
	''						cgc_hospital, 
	0						tp_internacao, 
	0						tp_nascimento, 
	''						de_diag, 
	0						cd_uni_pre, 
	' '						cd_prest, 
	''						nm_prest, 
	0						cgc_cpf_prest, 
	''						tp_particip, 
	LOCALTIMESTAMP					dt_servico, 
	0						tp_tabela, 
	0						cd_servico, 
	0						qt_cobrada, 
	0						vl_serv_cob, 
	0						vl_co_cob, 
	0						vl_filme_cob, 
	''						cd_porte_ane, 
	0028						cd_uni_aut, 
	''						nr_autoriz, 
	0						cgc_cpf_req, 
	0						vl_adic_ser, 
	0						vl_adic_co, 
	0						vl_adic_filme, 
	0						cd_espec, 
	0						qt_tot_r552, 
	0						qt_tot_r553, 
	0						qt_tot_r554, 
	0						qt_tot_r555, 
	0						qt_not_exc, 
	0						qt_not_amb, 
	0						qt_tot_ser, 
	0						vl_tot_serv, 
	a.nr_seq_protocolo			nr_seq_protocolo, 
	0						nr_interno_conta 
FROM w_interf_conta_trailler c, 
	protocolo_convenio b, 
	w_interf_conta_header a 
where	a.nr_seq_protocolo	= b.nr_seq_protocolo 
and	a.nr_seq_protocolo	= c.nr_seq_protocolo 

union all
 
/* Nota		*/
 
select		 
	2						tp_registro, 
	1						nr_seq, 
	552						tp_reg, 
	0						cd_uni_des, 
	0						zeros, 
	LOCALTIMESTAMP					dt_geracao, 
	LOCALTIMESTAMP					nr_comp, 
	0						nr_fatura, 
	LOCALTIMESTAMP					dt_vem_fat, 
	LOCALTIMESTAMP					dt_emi_fat, 
	0						vl_tot_fat, 
	0						vl_tot_fat_liq, 
	0						reservado, 
	0						vl_ajuste_fat, 
	0						nr_ver_tra, 
	''						rz_soci_prst, 
	0						cgc_prst, 
	0						nr_lote, 
	substr(coalesce(upper(Elimina_Caracteres_Especiais(obter_doc_convenio_proc(a.nr_interno_conta))), 
			upper(Elimina_Caracteres_Especiais(a.nr_doc_convenio))),1,11) nr_nota, 
	--decode(a.ie_tipo_atendimento,3,1,7,2,5) tp_nota, 
	CASE WHEN upper(substr(Obter_Guia_Conta(a.nr_interno_conta),1,2))='IX' THEN 5 WHEN upper(substr(Obter_Guia_Conta(a.nr_interno_conta),1,2))='EX' THEN 2 WHEN upper(substr(Obter_Guia_Conta(a.nr_interno_conta),1,2))='CX' THEN 1 END  tp_nota, 
	coalesce(substr(a.cd_usuario_convenio,1,4),'0028') uni_usua, 
	somente_numero(coalesce(substr(a.cd_usuario_convenio,5,13),'0')) 
							id_benef, 
	substr(a.nm_paciente,1,25)		nm_benef, 
	a.dt_entrada				dt_atend, 
	0						cd_excecao, 
	CASE WHEN a.ie_carater_inter='1' THEN 0  ELSE 1 END 	tp_consulta, 
	CASE WHEN a.ie_tipo_atendimento=3 THEN '1'  ELSE '2' END  
							id_ambula, 
	' '						cd_ato, 
	substr(a.cd_cid_principal,1,6)	cd_cid, 
	'1'						tp_paciente, 
	substr(a.nm_empresa_referencia,1,25) emp_usua, 
	0						tp_cobranca, 
	0						tp_contr, 
	0						cd_uni_hosp, 
	' '						cd_hosp, 
	''						nm_hosp, 
	''						tp_acomodacao, 
	LOCALTIMESTAMP					dt_internacao, 
	LOCALTIMESTAMP					dt_alta, 
	0						ft_mult_amb, 
	''						tp_admissao, 
	''						tp_saida, 
	''						cgc_hospital, 
	0						tp_internacao, 
	0						tp_nascimento, 
	''						de_diag, 
	0						cd_uni_pre, 
	' '						cd_prest, 
	''						nm_prest, 
	0						cgc_cpf_prest, 
	''						tp_particip, 
	LOCALTIMESTAMP					dt_servico, 
	0						tp_tabela, 
	0						cd_servico, 
	0						qt_cobrada, 
	0						vl_serv_cob, 
	0						vl_co_cob, 
	0						vl_filme_cob, 
	''						cd_porte_ane, 
	0028						cd_uni_aut, 
	''						nr_autoriz, 
	0						cgc_cpf_req, 
	0						vl_adic_ser, 
	0						vl_adic_co, 
	0						vl_adic_filme, 
	0						cd_espec, 
	0						qt_tot_r552, 
	0						qt_tot_r553, 
	0						qt_tot_r554, 
	0						qt_tot_r555, 
	0						qt_not_exc, 
	0						qt_not_amb, 
	0						qt_tot_ser, 
	0						vl_tot_serv, 
	a.nr_seq_protocolo			nr_seq_protocolo, 
	a.nr_interno_conta				nr_interno_conta 
from 	conta_paciente x, 
	w_interf_conta_header b, 
 	w_interf_conta_cab a 
where	a.nr_seq_protocolo	= b.nr_seq_protocolo 
and	a.nr_interno_conta	= x.nr_interno_conta 

union all
 
/* Hospital 	*/
 
select 
	3						tp_registro, 
	1						nr_seq, 
	553						tp_reg, 
	0						cd_uni_des, 
	0						zeros, 
	LOCALTIMESTAMP					dt_geracao, 
	LOCALTIMESTAMP					nr_comp, 
	0						nr_fatura, 
	LOCALTIMESTAMP					dt_vem_fat, 
	LOCALTIMESTAMP					dt_emi_fat, 
	0						vl_tot_fat, 
	0						vl_tot_fat_liq, 
	0						reservado, 
	0						vl_ajuste_fat, 
	0						nr_ver_tra, 
	''						rz_soci_prst, 
	0						cgc_prst, 
	0						nr_lote, 
	substr(coalesce(upper(Elimina_Caracteres_Especiais(obter_doc_convenio_proc(a.nr_interno_conta))), 
			upper(Elimina_Caracteres_Especiais(a.nr_doc_convenio))),1,11) nr_nota, 
	0						tp_nota, 
	' '						uni_usua, 
	0						id_benef, 
	''						nm_benef, 
	LOCALTIMESTAMP					dt_atend, 
	0						cd_excecao, 
	0						tp_consulta, 
	''						id_ambula, 
	' '						cd_ato, 
	''						cd_cid, 
	''						tp_paciente, 
	' '						emp_usua, 
	0						tp_cobranca, 
	0						tp_contr, 
	0028						cd_uni_hosp, 
	' '						cd_hosp, 
	substr(b.nm_hospital,1,25)		nm_hosp, 
	to_char(a.cd_tipo_acomodacao)		tp_acomodacao, 
	a.dt_entrada				dt_internacao, 
	a.dt_alta					dt_alta, 
	0						ft_mult_amb, 
	a.ie_carater_inter			tp_admissao, 
	to_char(a.cd_motivo_alta)		tp_saida, 
	b.cd_cgc_hospital				cgc_hospital, 
	a.ie_clinica				tp_internacao, 
	0						tp_nascimento, 
	a.cd_cid_principal			de_diag, 
	0						cd_uni_pre, 
	' '						cd_prest, 
	''						nm_prest, 
	0						cgc_cpf_prest, 
	''						tp_particip, 
	LOCALTIMESTAMP					dt_servico, 
	0						tp_tabela, 
	0						cd_servico, 
	0						qt_cobrada, 
	0						vl_serv_cob, 
	0						vl_co_cob, 
	0						vl_filme_cob, 
	''						cd_porte_ane, 
	0028						cd_uni_aut, 
	''						nr_autoriz, 
	0						cgc_cpf_req, 
	0						vl_adic_ser, 
	0						vl_adic_co, 
	0						vl_adic_filme, 
	0						cd_espec, 
	0						qt_tot_r552, 
	0						qt_tot_r553, 
	0						qt_tot_r554, 
	0						qt_tot_r555, 
	0						qt_not_exc, 
	0						qt_not_amb, 
	0						qt_tot_ser, 
	0						vl_tot_serv, 
	a.nr_seq_protocolo			nr_seq_protocolo, 
	a.nr_interno_conta				nr_interno_conta 
from 	conta_paciente x, 
	w_interf_conta_header b, 
 	w_interf_conta_cab a 
where	a.nr_seq_protocolo	= b.nr_seq_protocolo 
and	a.ie_tipo_atendimento	= '1' 
and	a.nr_interno_conta	= x.nr_interno_conta 

union all
 
/* Servico,AMB,taxas */
 
select 
	4						tp_registro, 
	1						nr_seq, 
	554						tp_reg, 
	0						cd_uni_des, 
	0						zeros, 
	LOCALTIMESTAMP					dt_geracao, 
	LOCALTIMESTAMP					nr_comp, 
	0						nr_fatura, 
	LOCALTIMESTAMP					dt_vem_fat, 
	LOCALTIMESTAMP					dt_emi_fat, 
	0						vl_tot_fat, 
	0						vl_tot_fat_liq, 
	0						reservado, 
	0						vl_ajuste_fat, 
	0						nr_ver_tra, 
	''						rz_soci_prst, 
	0						cgc_prst, 
	0						nr_lote, 
	substr(coalesce(upper(Elimina_Caracteres_Especiais(obter_doc_convenio_proc(a.nr_interno_conta))), 
			upper(Elimina_Caracteres_Especiais(a.nr_doc_convenio))),1,11) nr_nota, 
	0						tp_nota, 
	' '						uni_usua, 
	0						id_benef, 
	''						nm_benef, 
	LOCALTIMESTAMP					dt_atend, 
	0						cd_excecao, 
	0						tp_consulta, 
	''						id_ambula, 
	' '						cd_ato, 
	''						cd_cid, 
	''						tp_paciente, 
	' '						emp_usua, 
	0						tp_cobranca, 
	0						tp_contr, 
	0						cd_uni_hosp, 
	' '						cd_hosp, 
	''						nm_hosp, 
	''						tp_acomodacao, 
	LOCALTIMESTAMP					dt_internacao, 
	LOCALTIMESTAMP					dt_alta, 
	0						ft_mult_amb, 
	''						tp_admissao, 
	''						tp_saida, 
	''						cgc_hospital, 
	0						tp_internacao, 
	0						tp_nascimento, 
	''						de_diag, 
	0						cd_uni_pre, 
	' '						cd_prest, 
	substr(CASE WHEN c.ie_responsavel_credito='M' THEN c.nm_medico_executor  ELSE b.nm_hospital END ,1,26)		nm_prest, 
	CASE WHEN c.ie_responsavel_credito='M' THEN coalesce(somente_numero(c.nr_cpf_executor),0)  ELSE somente_numero(coalesce(c.cd_cgc_prestador,c.cd_cgc_hospital)) END  
							cgc_cpf_prest, 
	CASE WHEN c.ie_responsavel_credito='M' THEN '3'  ELSE '1' END  
							tp_particip, 
	c.dt_item					dt_servico, 
	0						tp_tabela, 
	somente_numero(c.cd_item_convenio)	cd_servico, 
	c.qt_item					qt_cobrada, 
	c.vl_total_item					vl_serv_cob, 
	0						vl_co_cob, 
	c.vl_filme					vl_filme_cob, 
	substr(to_char(c.nr_porte_anestesico),1,1) 
							cd_porte_ane, 
	0028						cd_uni_aut, 
	substr(coalesce(upper(Elimina_Caracteres_Especiais(obter_doc_convenio_proc(a.nr_interno_conta))), 
			upper(Elimina_Caracteres_Especiais(a.nr_doc_convenio))),1,9) nr_autoriz, 
	somente_numero(substr(obter_cpf_pessoa_fisica(coalesce(obter_medico_prescricao(c.nr_prescricao,'C'), obter_dados_atendimento(c.nr_atendimento,'MR'))),1,14)) 
							cgc_cpf_req, 
	0						vl_adic_ser, 
	0						vl_adic_co, 
	0						vl_adic_filme, 
	c.cd_especialidade			cd_espec, 
	0						qt_tot_r552, 
	0						qt_tot_r553, 
	0						qt_tot_r554, 
	0						qt_tot_r555, 
	0						qt_not_exc, 
	0						qt_not_amb, 
	0						qt_tot_ser, 
	0						vl_tot_serv, 
	a.nr_seq_protocolo			nr_seq_protocolo, 
	a.nr_interno_conta				nr_interno_conta 
FROM conta_paciente x, w_interf_conta_header b, w_interf_conta_cab a, w_interf_conta_item c
LEFT OUTER JOIN funcao_medico d ON (c.cd_funcao_executor = d.cd_funcao)
WHERE a.nr_seq_protocolo	= b.nr_seq_protocolo and a.nr_interno_conta	= c.nr_interno_conta  and a.nr_interno_conta	= x.nr_interno_conta --and	c.vl_total_item		<> 0  Removido por Almir em 22/01/2008  OS124846 
  and c.ie_tipo_item		<> 2 
 
union all
 
/* Medicamentos,materiais 	*/
 
select 
	4						tp_registro, 
	1						nr_seq, 
	554						tp_reg, 
	0						cd_uni_des, 
	0						zeros, 
	LOCALTIMESTAMP					dt_geracao, 
	LOCALTIMESTAMP					nr_comp, 
	0						nr_fatura, 
	LOCALTIMESTAMP					dt_vem_fat, 
	LOCALTIMESTAMP					dt_emi_fat, 
	0						vl_tot_fat, 
	0						vl_tot_fat_liq, 
	0						reservado, 
	0						vl_ajuste_fat, 
	0						nr_ver_tra, 
	''						rz_soci_prst, 
	0						cgc_prst, 
	0						nr_lote, 
	substr(coalesce(upper(Elimina_Caracteres_Especiais(obter_doc_convenio_proc(a.nr_interno_conta))), 
			upper(Elimina_Caracteres_Especiais(a.nr_doc_convenio))),1,11)	nr_nota, 
	0						tp_nota, 
	' '						uni_usua, 
	0						id_benef, 
	''						nm_benef, 
	LOCALTIMESTAMP					dt_atend, 
	0						cd_excecao, 
	0						tp_consulta, 
	''						id_ambula, 
	' '						cd_ato, 
	''						cd_cid, 
	''						tp_paciente, 
	' '						emp_usua, 
	0						tp_cobranca, 
	0						tp_contr, 
	0						cd_uni_hosp, 
	' '						cd_hosp, 
	''						nm_hosp, 
	''						tp_acomodacao, 
	LOCALTIMESTAMP					dt_internacao, 
	LOCALTIMESTAMP					dt_alta, 
	0						ft_mult_amb, 
	''						tp_admissao, 
	''						tp_saida, 
	''						cgc_hospital, 
	0						tp_internacao, 
	0						tp_nascimento, 
	''						de_diag, 
	0						cd_uni_pre, 
	' '						cd_prest, 
	substr(b.nm_hospital,1,26)		nm_prest, 
	somente_numero(c.cd_cgc_hospital)	cgc_cpf_prest, 
	'1'						tp_particip, 
	a.dt_entrada				dt_servico, 
	0						tp_tabela, 
	somente_numero(c.cd_item_convenio)	cd_servico, 
	sum(c.qt_item)					qt_cobrada, 
	sum(c.vl_total_item)			vl_serv_cob, 
	0						vl_co_cob, 
	0						vl_filme_cob, 
	''						cd_porte_ane, 
	0028						cd_uni_aut, 
	substr(coalesce(upper(Elimina_Caracteres_Especiais(obter_doc_convenio_proc(a.nr_interno_conta))), 
			upper(Elimina_Caracteres_Especiais(a.nr_doc_convenio))),1,9) nr_autoriz, 
	somente_numero(substr(obter_cpf_pessoa_fisica(coalesce(obter_medico_prescricao(c.nr_prescricao,'C'), obter_dados_atendimento(c.nr_atendimento,'MR'))),1,14)) 
							cgc_cpf_req, 
	0						vl_adic_ser, 
	0						vl_adic_co, 
	0						vl_adic_filme, 
	0						cd_espec, 
	0						qt_tot_r552, 
	0						qt_tot_r553, 
	0						qt_tot_r554, 
	0						qt_tot_r555, 
	0						qt_not_exc, 
	0						qt_not_amb, 
	0						qt_tot_ser, 
	0						vl_tot_serv, 
	a.nr_seq_protocolo			nr_seq_protocolo, 
	a.nr_interno_conta				nr_interno_conta 
from 	w_interf_conta_item c, 
	conta_paciente x, 
	w_interf_conta_header b, 
 	w_interf_conta_cab a 
where	a.nr_seq_protocolo	= b.nr_seq_protocolo 
and	a.nr_interno_conta	= c.nr_interno_conta 
and	a.nr_interno_conta	= x.nr_interno_conta 
and	c.vl_total_item		<> 0 
and	c.ie_tipo_item		= 2 
group by 
	substr(coalesce(upper(Elimina_Caracteres_Especiais(obter_doc_convenio_proc(a.nr_interno_conta))), 
			upper(Elimina_Caracteres_Especiais(a.nr_doc_convenio))),1,11), 
	substr(b.nm_hospital,1,26), 
	somente_numero(c.cd_cgc_hospital), 
	a.dt_entrada, 
	somente_numero(c.cd_item_convenio), 
	substr(coalesce(upper(Elimina_Caracteres_Especiais(obter_doc_convenio_proc(a.nr_interno_conta))), 
			upper(Elimina_Caracteres_Especiais(a.nr_doc_convenio))),1,9), 
	a.nr_seq_protocolo, 
	a.nr_interno_conta, 
	somente_numero(substr(obter_cpf_pessoa_fisica(coalesce(obter_medico_prescricao(c.nr_prescricao,'C'), obter_dados_atendimento(c.nr_atendimento,'MR'))),1,14)) 

union all
 
/* Trailler 	*/
 
select		 
	5						tp_registro, 
	1						nr_seq, 
	559						tp_reg, 
	0						cd_uni_des, 
	0						zeros, 
	LOCALTIMESTAMP					dt_geracao, 
	LOCALTIMESTAMP					nr_comp, 
	0						nr_fatura, 
	LOCALTIMESTAMP					dt_vem_fat, 
	LOCALTIMESTAMP					dt_emi_fat, 
	0						vl_tot_fat, 
	0						vl_tot_fat_liq, 
	0						reservado, 
	0						vl_ajuste_fat, 
	0						nr_ver_tra, 
	''						rz_soci_prst, 
	0						cgc_prst, 
	0						nr_lote, 
	'99999999999'				nr_nota, 
	0						tp_nota, 
	' '						uni_usua, 
	0						id_benef, 
	''						nm_benef, 
	LOCALTIMESTAMP					dt_atend, 
	0						cd_excecao, 
	0						tp_consulta, 
	''						id_ambula, 
	' '						cd_ato, 
	''						cd_cid, 
	''						tp_paciente, 
	' '						emp_usua, 
	0						tp_cobranca, 
	0						tp_contr, 
	0						cd_uni_hosp, 
	' '						cd_hosp, 
	''						nm_hosp, 
	''						tp_acomodacao, 
	LOCALTIMESTAMP					dt_internacao, 
	LOCALTIMESTAMP					dt_alta, 
	0						ft_mult_amb, 
	''						tp_admissao, 
	''						tp_saida, 
	''						cgc_hospital, 
	0						tp_internacao, 
	0						tp_nascimento, 
	''						de_diag, 
	0						cd_uni_pre, 
	' '						cd_prest, 
	''						nm_prest, 
	0						cgc_cpf_prest, 
	''						tp_particip, 
	LOCALTIMESTAMP					dt_servico, 
	0						tp_tabela, 
	0						cd_servico, 
	0						qt_cobrada, 
	0						vl_serv_cob, 
	0						vl_co_cob, 
	0						vl_filme_cob, 
	''						cd_porte_ane, 
	0028						cd_uni_aut, 
	''						nr_autoriz, 
	0						cgc_cpf_req, 
	0						vl_adic_ser, 
	0						vl_adic_co, 
	0						vl_adic_filme, 
	0						cd_espec, 
	0						qt_tot_r552, 
	0						qt_tot_r553, 
	0						qt_tot_r554, 
	0						qt_tot_r555, 
	0						qt_not_exc, 
	0						qt_not_amb, 
	0						qt_tot_ser, 
	0						vl_tot_serv, 
	a.nr_seq_protocolo			nr_seq_protocolo, 
	9999999999					nr_interno_conta 
from w_interf_conta_trailler a;

