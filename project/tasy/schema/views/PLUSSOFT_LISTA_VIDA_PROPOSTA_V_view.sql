-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW plussoft_lista_vida_proposta_v (nr_seq_proposta, cd_beneficiario, nm_beneficiario, nr_seq_parentesco, ds_parentesco, dt_nascimento, ie_nascido_plano, nr_seq_regra_isencao, ds_regra_isencao) AS select	a.nr_seq_proposta,
		a.cd_beneficiario,
		b.nm_pessoa_fisica nm_beneficiario,
		coalesce(a.nr_seq_parentesco,41) nr_seq_parentesco,
		coalesce(c.ds_parentesco,'Titular') ds_parentesco,
		b.dt_nascimento,
		a.ie_nascido_plano,
	       (select	max(x.nr_seq_regra_padrao)
		FROM	pls_carencia		x
		where	x.nr_seq_pessoa_proposta = a.nr_sequencia) nr_seq_regra_isencao,
	       (select	max(x.ds_regra)
		from	pls_regra_carencia		x,
			pls_carencia			y
		where	x.nr_sequencia = y.nr_seq_regra_padrao
		and	y.nr_seq_pessoa_proposta = a.nr_sequencia) ds_regra_isencao
	FROM pessoa_fisica b, pls_proposta_beneficiario a
LEFT OUTER JOIN grau_parentesco c ON (a.nr_seq_parentesco = c.nr_sequencia)
WHERE a.cd_beneficiario = b.cd_pessoa_fisica  order by a.cd_beneficiario;

