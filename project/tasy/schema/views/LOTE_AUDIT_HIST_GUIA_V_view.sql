-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW lote_audit_hist_guia_v (nr_sequencia, nr_seq_hist_item, nr_seq_lote_hist, nm_paciente, cd_usuario, cd_autorizacao, cd_item, ds_item, qt_item, vl_original, vl_pago, vl_glosa_informada, vl_glosa, vl_amenor, ds_observacao) AS select	a.nr_sequencia,
	b.nr_sequencia nr_seq_hist_item, 
	a.nr_seq_lote_hist nr_seq_lote_hist, 
	obter_nome_paciente(e.nr_atendimento) nm_paciente, 
	obter_cd_usuario_conv_glosa2(e.nr_atendimento,2) cd_usuario, 
	a.cd_autorizacao, 
	c.cd_procedimento_convenio cd_item, 
	substr(obter_desc_procedimento(c.cd_procedimento,c.ie_origem_proced),1,255) ds_item, 
	b.qt_item, 
	(obter_dados_lote_audit_item(b.nr_sequencia,'VO'))::numeric  vl_original, 
	b.vl_pago, 
	b.vl_glosa_informada, 
	b.vl_glosa, 
	b.vl_amenor, 
	b.ds_observacao 
FROM	procedimento_paciente c, 
	lote_audit_hist_item b, 
	lote_audit_hist_guia a, 
	conta_paciente e 
where	b.nr_Seq_guia 		= a.nr_sequencia 
and	a.nr_interno_conta 	= e.nr_interno_conta 
and	c.nr_sequencia		= b.nr_seq_propaci 
and	nr_Seq_propaci is not null 

union
 
select	a.nr_sequencia, 
	b.nr_sequencia nr_seq_hist_item, 
	a.nr_seq_lote_hist nr_seq_lote_hist, 
	obter_nome_paciente(e.nr_atendimento) nm_paciente, 
	obter_cd_usuario_conv_glosa2(e.nr_atendimento,2) cd_usuario, 
	a.cd_autorizacao, 
	c.cd_material_convenio cd_item, 
	substr(obter_desc_material(c.cd_material),1,255) ds_item, 
	b.qt_item, 
	(obter_dados_lote_audit_item(b.nr_sequencia,'VO'))::numeric  vl_original, 
	b.vl_pago, 
	b.vl_glosa_informada, 
	b.vl_glosa, 
	b.vl_amenor, 
	b.ds_observacao 
from	material_atend_paciente c, 
	lote_audit_hist_item b, 
	lote_audit_hist_guia a, 
	conta_paciente e 
where	b.nr_Seq_guia 		= a.nr_sequencia 
and	a.nr_interno_conta 	= e.nr_interno_conta 
and	c.nr_sequencia		= b.nr_seq_matpaci 
and	nr_seq_matpaci is not null;

