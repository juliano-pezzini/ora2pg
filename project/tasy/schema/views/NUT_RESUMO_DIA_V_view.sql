-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW nut_resumo_dia_v (destino, nr_sequencia, nr_seq_card_dia, nr_atendimento, cd_setor_atendimento, dt_opcao, nr_seq_servico, dt_liberacao, ds_setor_atendimento, nr_seq_receita, nr_seq_composicao, ds_receita, qt_refeicao, nr_seq_area, nr_seq_local, ds_area_producao, cd_estabelecimento, nr_meal_size, ie_feeder) AS SELECT	'P' destino,
	c.nr_sequencia,
	g.nr_seq_card_dia nr_seq_card_dia,
	a.nr_atendimento,
	a.cd_setor_atendimento,
	a.dt_servico dt_opcao,
	a.nr_seq_servico,
	a.dt_liberacao,
	e.ds_setor_atendimento,
	b.nr_seq_receita,
	b.nr_seq_composicao,
	c.ds_receita,
	1 qt_refeicao,
	d.nr_seq_area,
	nut_obter_local_paciente nr_seq_local,
	SUBSTR(obter_descricao_padrao('NUT_AREA_PRODUCAO', 'DS_AREA_PRODUCAO', d.nr_seq_area),1,200) ds_area_producao,
	f.cd_estabelecimento,
	a.nr_meal_size,
	a.ie_feeder
FROM atendimento_paciente f, setor_atendimento e, nut_area_prod_rec d, nut_receita c, nut_atend_serv_dia a, nut_cardapio g
LEFT OUTER JOIN nut_pac_opcao_rec b ON (g.nr_sequencia = b.nr_seq_cardapio)
WHERE b.nr_seq_receita	= c.nr_sequencia AND c.nr_sequencia		= d.nr_seq_receita AND a.nr_sequencia		= b.nr_seq_servico_dia AND a.cd_setor_atendimento 	= e.cd_setor_atendimento and a.nr_atendimento 	= f.nr_atendimento  AND b.dt_liberacao IS NOT NULL

UNION

SELECT
	'R' destino,
	c.nr_sequencia,
    a.nr_sequencia nr_seq_card_dia,
	0 nr_atendimento,
	0 cd_setor_atendimento,
	a.dt_cardapio dt_opcao,
	a.nr_seq_servico,
	a.dt_liberacao,
	'Sem setor' ds_setor_atendimento,
	b.nr_seq_receita,
	b.nr_seq_composicao,
	c.ds_receita,
	a.qt_pessoa_atend qt_refeicao,
	d.nr_seq_area,
	(a.nr_seq_local)::numeric ,
	SUBSTR(obter_descricao_padrao('NUT_AREA_PRODUCAO', 'DS_AREA_PRODUCAO', d.nr_seq_area),1,200) ds_area_producao,
	a.cd_estabelecimento,
	0 nr_meal_size,
	'N' ie_feeder
FROM	nut_area_prod_rec d,
	nut_receita c,
	nut_pac_opcao_rec b,
	nut_cardapio_dia a,
    nut_local_refeicao e
WHERE b.nr_seq_receita = c.nr_sequencia
AND	c.nr_sequencia = d.nr_seq_receita
AND	a.nr_sequencia = b.nr_seq_cardapio_dia
AND e.nr_sequencia = a.nr_seq_local
AND e.ie_local_paciente = 'N'
AND	b.dt_liberacao IS NOT NULL;

