-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW resumen_clinico_pf_v (street_type_solic, street_name_solic, building_number_solic, deliv_installation_type_solic, deliv_installation_area_solic, precinct_solic, county_solic, state_solic, postal_code_solic, country_solic, street_type_atend, street_name_atend, building_number_atend, deliv_installation_type_atend, deliv_installation_area_atend, precinct_atend, county_atend, state_atend, postal_code_atend, country_atend, street_type_resp, street_name_resp, building_number_resp, deliv_installation_type_resp, deliv_installation_area_resp, precinct_resp, county_resp, state_resp, postal_code_resp, country_resp, nr_crm_solic, cd_pessoa_fisica_solic, nm_primeiro_nome_solic, nm_sobrenome_pai_solic, nm_sobrenome_mae_solic, nr_telefone_solic, ds_email_solic, nr_atendimento, cd_pessoa_fisica, cd_pessoa_fisica_2, cd_pessoa_fisica_3) AS SELECT
		stls.cd_tipo_logradouro street_type_solic,
		cpfs.ds_endereco street_name_solic,
		coalesce(cpfs.nr_endereco, cpfs.ds_compl_end) building_number_solic,
		ctas.cd_tipo_asen deliv_installation_type_solic,
		cpfs.ds_bairro deliv_installation_area_solic,
		cpfs.nr_seq_localizacao_mx precinct_solic,
		cms.cd_cat_municipio county_solic,
		ces.cd_entidade state_solic,
		cpfs.cd_cep postal_code_solic,
		cpfs.nr_seq_pais country_solic,
		stla.cd_tipo_logradouro street_type_atend,
		cpfa.ds_endereco street_name_atend,
		coalesce(cpfa.nr_endereco, cpfa.ds_compl_end) building_number_atend,
		ctaa.cd_tipo_asen deliv_installation_type_atend,
		cpfa.ds_bairro deliv_installation_area_atend,
		cpfa.nr_seq_localizacao_mx precinct_atend,
		cma.cd_cat_municipio county_atend,
		cea.cd_entidade state_atend,
		cpfa.cd_cep postal_code_atend,
		cpfa.nr_seq_pais country_atend,
		stlr.cd_tipo_logradouro street_type_resp,
		cpfr.ds_endereco street_name_resp,
		coalesce(cpfr.nr_endereco, cpfr.ds_compl_end) building_number_resp,
		ctar.cd_tipo_asen deliv_installation_type_resp,
		cpfr.ds_bairro deliv_installation_area_resp,
		cpfr.nr_seq_localizacao_mx precinct_resp,
		cmr.cd_cat_municipio county_resp,
		cer.cd_entidade state_resp,
		cpfr.cd_cep postal_code_resp,
		cpfr.nr_seq_pais country_resp,
		med.nr_crm nr_crm_solic,
		pfm.cd_pessoa_fisica cd_pessoa_fisica_solic,
		z.ds_given_name nm_primeiro_nome_solic,
		z.ds_component_name_1 nm_sobrenome_pai_solic,
		z.ds_component_name_2 nm_sobrenome_mae_solic,
		cpfm.nr_telefone nr_telefone_solic,
		cpfm.ds_email ds_email_solic,
		ap.nr_atendimento nr_atendimento,
		cpfs.cd_pessoa_fisica cd_pessoa_fisica,
		cpfa.cd_pessoa_fisica cd_pessoa_fisica_2,
		cpfr.cd_pessoa_fisica cd_pessoa_fisica_3
FROM medico med, atendimento_paciente ap, compl_pessoa_fisica cpfs
LEFT OUTER JOIN cat_tipo_assentamento ctas ON (cpfs.nr_seq_assentamento_mx = ctas.nr_sequencia)
LEFT OUTER JOIN sus_tipo_logradouro stls ON (cpfs.cd_tipo_logradouro = stls.cd_tipo_logradouro)
LEFT OUTER JOIN sus_municipio sms ON (cpfs.cd_municipio_ibge = sms.cd_municipio_ibge)
LEFT OUTER JOIN cat_municipio cms ON (sms.nr_seq_municipio_mx = cms.nr_sequencia)
LEFT OUTER JOIN cat_entidade ces ON (sms.nr_seq_entidade_mx = ces.nr_sequencia)
, compl_pessoa_fisica cpfa
LEFT OUTER JOIN cat_tipo_assentamento ctaa ON (cpfa.nr_seq_assentamento_mx = ctaa.nr_sequencia)
LEFT OUTER JOIN sus_tipo_logradouro stla ON (cpfa.cd_tipo_logradouro = stla.cd_tipo_logradouro)
LEFT OUTER JOIN sus_municipio sma ON (cpfa.cd_municipio_ibge = sma.cd_municipio_ibge)
LEFT OUTER JOIN cat_municipio cma ON (sma.nr_seq_municipio_mx = cma.nr_sequencia)
LEFT OUTER JOIN cat_entidade cea ON (sma.nr_seq_entidade_mx = cea.nr_sequencia)
, compl_pessoa_fisica cpfr
LEFT OUTER JOIN cat_tipo_assentamento ctar ON (cpfr.nr_seq_assentamento_mx = ctar.nr_sequencia)
LEFT OUTER JOIN sus_tipo_logradouro stlr ON (cpfr.cd_tipo_logradouro = stlr.cd_tipo_logradouro)
LEFT OUTER JOIN sus_municipio smr ON (cpfr.cd_municipio_ibge = smr.cd_municipio_ibge)
LEFT OUTER JOIN cat_municipio cmr ON (smr.nr_seq_municipio_mx = cmr.nr_sequencia)
LEFT OUTER JOIN cat_entidade cer ON (smr.nr_seq_entidade_mx = cer.nr_sequencia)
, pessoa_fisica pfm
LEFT OUTER JOIN table(pkg_name_utils.search_names_legacy('', 'main')) z ON (pfm.nr_seq_person_name = z.nr_sequencia)
LEFT OUTER JOIN compl_pessoa_fisica cpfm ON (pfm.cd_pessoa_fisica = cpfm.cd_pessoa_fisica AND 1 = cpfm.ie_tipo_complemento)
WHERE cpfs.ie_tipo_complemento = 1      AND cpfa.cd_pessoa_fisica = ap.cd_pessoa_fisica AND cpfa.ie_tipo_complemento = 1      AND cpfr.cd_pessoa_fisica = coalesce(ap.cd_pessoa_responsavel, (SELECT CD_PESSOA_FISICA_REF x FROM compl_pessoa_fisica x WHERE x.cd_pessoa_fisica = ap.cd_pessoa_fisica AND ie_tipo_complemento = 3))  --responsavel pessoa atendimento
  AND cpfr.ie_tipo_complemento = 1      AND med.cd_pessoa_fisica = cpfs.cd_pessoa_fisica  --pf_solic
    AND med.cd_pessoa_fisica = pfm.cd_pessoa_fisica;

