-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_os_ocorr_gerencia_v (nr_sequencia, dt_ordem_servico, nr_seq_gerencia, cd_pessoa_fisica, ds_tipo_ocorrencia, nr_seq_grupo, ds_dano_breve, ds_grupo, ie_classificacao, ds_gerencia, nr_seq_localizacao, cd_funcao, nr_seq_severidade_wheb, nr_seq_grupo_des, nr_seq_severidade, nr_seq_equipamento, ie_origem_os, ie_prioridade_cliente, ie_grau_satisfacao, nr_seq_func_item, ds_localizacao, ds_tipo_consultoria, nm_pessoa, qt_min_total_os) AS select	b.nr_sequencia,
	b.dt_ordem_servico, 
	d.nr_seq_gerencia, 
	a.cd_pessoa_fisica, 
	e.DS_TIPO_OCORRENCIA, 
	d.nr_sequencia nr_seq_grupo, 
	b.ds_dano_breve, 
	d.ds_grupo, 
	b.ie_classificacao, 
	c.ds_gerencia ds_gerencia, 
	b.nr_seq_localizacao, 
	b.cd_funcao, 
	b.nr_seq_severidade_wheb, 
	b.nr_seq_grupo_des, 
	nr_seq_severidade, 
	b.nr_seq_equipamento, 
	b.ie_origem_os, 
	b.ie_prioridade_cliente, 
	b.ie_grau_satisfacao, 
	b.nr_seq_func_item, 
	f.ds_localizacao, 
	CASE WHEN a.IE_TIPO_CONSULTORIA='I' THEN  'Consultoria Philips' WHEN a.IE_TIPO_CONSULTORIA='D' THEN  'Consultoria Canal'  ELSE 'NÃ£o informado' END  ds_TIPO_CONSULTORIA, 
	substr(obter_nome_pf(a.cd_pessoa_fisica),1,200) nm_pessoa, 
	man_obter_min_ordem_real(b.nr_sequencia) qt_min_total_os 
FROM	man_localizacao f, 
	grupo_desenvolvimento	d, 
	man_ordem_servico 	b, 
	MAN_ORDEM_SERV_OCORRENCIA a, 
	gerencia_wheb		c, 
	man_tipo_ocorrencia e 
where	a.nr_seq_ordem_serv		= b.nr_sequencia 
and	b.nr_seq_grupo_des	= d.nr_sequencia 
and	d.nr_seq_gerencia	= c.nr_sequencia 
and 	a.nr_seq_tipo_ocor 	= e.nr_sequencia 
and 	b.nr_seq_localizacao	= f.nr_sequencia 
and	d.nr_seq_gerencia	!= 25 
and	exists ( select 1 
		from	man_estagio_processo c, 
				man_ordem_serv_estagio d 
		where	c.nr_sequencia 	= d.nr_seq_estagio 
		and	d.nr_seq_ordem 		= b.nr_sequencia 
		and (c.ie_suporte 		= 'S' or c.ie_desenv = 'S'));

