-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW titulo_receber_bloq_v (nr_titulo, cd_estabelecimento, dt_atualizacao, nm_usuario, dt_emissao, dt_vencimento, dt_pagamento_previsto, vl_titulo, vl_saldo_titulo, vl_saldo_juros, vl_saldo_multa, vl_abatimento, cd_moeda, cd_portador, cd_tipo_portador, tx_juros, tx_multa, cd_tipo_taxa_juro, cd_tipo_taxa_multa, tx_desc_antecipacao, ie_situacao, ie_tipo_emissao_titulo, ie_origem_titulo, ie_tipo_titulo, ie_tipo_inclusao, cd_pessoa_fisica, nr_interno_conta, cd_cgc, cd_serie, nr_documento, nr_sequencia_doc, cd_banco, cd_agencia_bancaria, nr_bloqueto, dt_liquidacao, nr_lote_contabil, ds_observacao_titulo, nr_atendimento, nr_seq_protocolo, dt_contabil, nr_seq_conta_banco, dt_emissao_bloqueto, nr_seq_classe, nr_guia, nr_nosso_numero, dt_ref_conta, cd_convenio_conta, nr_seq_terc_conta, nr_seq_nf_saida, nr_processo_aih, cd_tipo_recebimento, nr_seq_controle_pessoa, nr_seq_trans_fin_contab, nr_seq_contrato, vl_desc_previsto, nr_seq_carteira_cobr, dt_integracao_externa, cd_estab_financeiro, nr_titulo_externo, nr_seq_mensalidade, nr_seq_mens_segurado, ie_pls, nr_seq_trans_fin_baixa, nr_nota_fiscal, nm_usuario_orig, dt_inclusao, ie_tipo_carteira, nr_seq_empresa, nr_seq_proj_rec, nr_seq_lote_empresa, nr_seq_negociacao_origem, nr_seq_pls_lote_camara, nr_seq_ptu_fatura, dt_ultima_devolucao, nr_seq_lote_enc_contas, ie_liq_inadimplencia, ie_negociado, nr_seq_guia, nr_titulo_dest, nr_seq_pag_conta_evento, vl_outras_despesas, ie_dig_nosso_numero, nr_seq_segurado_mens, nr_seq_eme_fatura, nr_seq_pls_lote_contest, nr_seq_pls_lote_disc, nr_seq_grupo_prod, nr_seq_cob_previa, nr_seq_pagador, dt_atual, ds_conta, dt_vencimento_atual, cd_moeda_banco, cd_banco_dig, nr_bloqueto_lido, nr_bloqueto_editado, cd_banco_estab, ds_banco, cd_conta, ie_digito_conta, cd_agencia_conta, cd_agencia_conta_bloq, ds_end_sacado, ds_endereco_sacado, ds_sacado, ds_nome_sacado, ds_cidade_sacado, ds_instrucao, cd_carteira, cd_agencia_dig_conta, cd_pessoa, banco, cd_agencia_conta_sicoob, nr_nosso_numero_sicoob, ds_cidade_sacado_sicred, ds_end_sacado_sicredi, ds_end_sacado_padrao) AS Select	distinct
	a.NR_TITULO,
	a.CD_ESTABELECIMENTO,
	a.DT_ATUALIZACAO,
	a.NM_USUARIO,
	a.DT_EMISSAO,
	a.DT_VENCIMENTO,
	a.DT_PAGAMENTO_PREVISTO,
	a.VL_TITULO,
	a.VL_SALDO_TITULO,
	a.VL_SALDO_JUROS,
	a.VL_SALDO_MULTA,
	a.VL_ABATIMENTO,
	a.CD_MOEDA,
	a.CD_PORTADOR,
	a.CD_TIPO_PORTADOR,
	a.TX_JUROS,
	a.TX_MULTA,
	a.CD_TIPO_TAXA_JURO,
	a.CD_TIPO_TAXA_MULTA,
	a.TX_DESC_ANTECIPACAO,
	a.IE_SITUACAO,
	a.IE_TIPO_EMISSAO_TITULO,
	a.IE_ORIGEM_TITULO,
	a.IE_TIPO_TITULO,
	a.IE_TIPO_INCLUSAO,
	a.CD_PESSOA_FISICA,
	a.NR_INTERNO_CONTA,
	a.CD_CGC,
	a.CD_SERIE,
	a.NR_DOCUMENTO,
	a.NR_SEQUENCIA_DOC,
	a.CD_BANCO,
	a.CD_AGENCIA_BANCARIA,
	a.NR_BLOQUETO,
	a.DT_LIQUIDACAO,
	a.NR_LOTE_CONTABIL,
	a.DS_OBSERVACAO_TITULO,
	a.NR_ATENDIMENTO,
	a.NR_SEQ_PROTOCOLO,
	a.DT_CONTABIL,
	a.NR_SEQ_CONTA_BANCO,
	a.DT_EMISSAO_BLOQUETO,
	a.NR_SEQ_CLASSE,
	a.NR_GUIA,
	a.NR_NOSSO_NUMERO,
	a.DT_REF_CONTA,
	a.CD_CONVENIO_CONTA,
	a.NR_SEQ_TERC_CONTA,
	a.NR_SEQ_NF_SAIDA,
	a.NR_PROCESSO_AIH,
	a.CD_TIPO_RECEBIMENTO,
	a.NR_SEQ_CONTROLE_PESSOA,
	a.NR_SEQ_TRANS_FIN_CONTAB,
	a.NR_SEQ_CONTRATO,
	a.VL_DESC_PREVISTO,
	a.NR_SEQ_CARTEIRA_COBR,
	a.DT_INTEGRACAO_EXTERNA,
	a.CD_ESTAB_FINANCEIRO,
	a.NR_TITULO_EXTERNO,
	a.NR_SEQ_MENSALIDADE,
	a.NR_SEQ_MENS_SEGURADO,
	a.IE_PLS,
	a.NR_SEQ_TRANS_FIN_BAIXA,
	a.NR_NOTA_FISCAL,
	a.NM_USUARIO_ORIG,
	a.DT_INCLUSAO,
	a.IE_TIPO_CARTEIRA,
	a.NR_SEQ_EMPRESA,
	a.NR_SEQ_PROJ_REC,
	a.NR_SEQ_LOTE_EMPRESA,
	a.NR_SEQ_NEGOCIACAO_ORIGEM,
	a.NR_SEQ_PLS_LOTE_CAMARA,
	a.NR_SEQ_PTU_FATURA,
	a.DT_ULTIMA_DEVOLUCAO,
	a.NR_SEQ_LOTE_ENC_CONTAS,
	a.IE_LIQ_INADIMPLENCIA,
	a.IE_NEGOCIADO,
	a.NR_SEQ_GUIA,
	a.NR_TITULO_DEST,
	a.NR_SEQ_PAG_CONTA_EVENTO,
	a.VL_OUTRAS_DESPESAS,
	a.IE_DIG_NOSSO_NUMERO,
	a.NR_SEQ_SEGURADO_MENS,
	a.NR_SEQ_EME_FATURA,
	a.NR_SEQ_PLS_LOTE_CONTEST,
	a.NR_SEQ_PLS_LOTE_DISC,
	a.NR_SEQ_GRUPO_PROD,
	a.NR_SEQ_COB_PREVIA,
	a.NR_SEQ_PAGADOR,
	to_char(LOCALTIMESTAMP, 'dd/mm/yyyy') dt_atual,
	h.ds_conta,
	coalesce(a.dt_pagamento_previsto, a.dt_vencimento) dt_vencimento_atual,
	d.cd_moeda_banco,
	To_char(e.cd_banco,'FM000') || '-' || calcula_digito('Modulo11', e.cd_banco) cd_banco_dig,
	substr(converte_codigo_Bloqueto('Barra_Lido', a.nr_bloqueto),1,60) nr_bloqueto_lido,
	substr(converte_codigo_Bloqueto('Barra_Editado', a.nr_bloqueto),1,80) nr_bloqueto_Editado,
	h.cd_banco cd_banco_estab,
	e.ds_banco,
	h.cd_conta,
	h.ie_digito_conta,
	h.cd_agencia_bancaria || '/00000'|| h.cd_conta || '-' || h.ie_digito_conta  cd_agencia_conta,
	h.cd_agencia_bancaria || '/00000'|| h.cd_conta_bloqueto  cd_agencia_conta_bloq,
	CASE WHEN a.cd_cgc='' THEN  g.ds_endereco ||', nº ' || coalesce(g.nr_endereco, g.ds_compl_end) || ', '||		g.ds_bairro  ELSE c.ds_endereco || ', nº ' || c.nr_endereco ||		', '||c.ds_bairro END  ds_end_sacado,
	CASE WHEN a.cd_cgc='' THEN  g.ds_endereco ||', nº ' || coalesce(g.nr_endereco, g.ds_compl_end) || ', '||		g.ds_bairro || ' - ' || g.ds_complemento  ELSE c.ds_endereco || ', nº ' || c.nr_endereco ||		', '||c.ds_bairro || ' - ' || c.ds_complemento END  ds_endereco_sacado,
	CASE WHEN a.cd_cgc='' THEN  substr(obter_nome_pf(b.cd_pessoa_fisica),1,255)||' - '||obter_cgc_cpf_editado(b.nr_cpf)  ELSE c.ds_razao_social||' - '||obter_cgc_cpf_editado(c.cd_cgc) END  ds_sacado,
	CASE WHEN a.cd_cgc='' THEN  substr(obter_nome_pf(b.cd_pessoa_fisica),1,255)  ELSE c.ds_razao_social END  ds_nome_sacado,
	CASE WHEN a.cd_cgc='' THEN  substr(g.cd_cep,1,2)||'.'||substr(g.cd_cep,3,3)||'-'||substr(g.cd_cep,6,3) || ' - ' || g.ds_municipio || ' - ' || g.sg_estado  ELSE substr(c.cd_cep,1,2)||'.'||substr(c.cd_cep,3,3)||'-'||substr(c.cd_cep,6,3) ||		' - ' || c.ds_municipio || ' - ' || c.sg_estado END  ds_cidade_sacado,
	obter_instrucao_titulo_receber(a.nr_titulo) ds_instrucao,
	h.cd_carteira,
	h.cd_agencia_bancaria ||'-'||f.ie_digito|| '/'|| h.cd_conta || '-' || h.ie_digito_conta  cd_agencia_dig_conta,
	b.cd_pessoa_fisica cd_pessoa,
	e.cd_banco banco,
	h.cd_agencia_bancaria || '/'|| h.cd_cedente cd_agencia_conta_sicoob,
	Somente_numero(substr(Obter_Nosso_Numero_Banco(h.cd_banco,a.nr_titulo),1,12)) nr_nosso_numero_sicoob,
	--decode(a.cd_cgc, '', g.ds_endereco || ', ' || g.nr_endereco || ', '|| g.ds_bairro, c.ds_endereco || ', ' || c.nr_endereco || ', '||c.ds_bairro) ds_end_sacado_sicredi
	CASE WHEN a.cd_cgc='' THEN  substr(obter_compl_pf(a.cd_pessoa_fisica,2,'CEP'),1,2) ||'.' || substr(obter_compl_pf(a.cd_pessoa_fisica,2,'CEP'),3,3) || '-' || substr(obter_compl_pf(a.cd_pessoa_fisica,2,'CEP'),6,3) ||' - '|| substr(obter_compl_pf(a.cd_pessoa_fisica,2,'DSM'),1,50)||' - '|| substr(obter_compl_pf(a.cd_pessoa_fisica,2,'UF'),1,2)  ELSE substr(c.cd_cep,1,2)||'.'||substr(c.cd_cep,3,3)||'-'||substr(c.cd_cep,6,3) ||		' - ' || c.ds_municipio || ' - ' || c.sg_estado END  ds_cidade_sacado_sicred,
	CASE WHEN a.cd_cgc='' THEN  substr(obter_compl_pf(a.cd_pessoa_fisica,2,'ES'),1,70)  ELSE c.ds_endereco || ', ' || c.nr_endereco || ', '||c.ds_bairro END  ds_end_sacado_sicredi,
	CASE WHEN a.cd_cgc='' THEN  g.ds_endereco ||', nº ' || coalesce(g.nr_endereco, g.ds_compl_end) || ' ' || g.ds_complemento || ' ' ||		   g.ds_bairro  ELSE c.ds_endereco  ||', nº ' || c.nr_endereco || ' ' || c.ds_complemento || ' ' ||		   c.ds_bairro END  ds_end_sacado_padrao
FROM agencia_bancaria f, banco e, moeda d, titulo_receber a
LEFT OUTER JOIN pessoa_fisica b ON (a.cd_pessoa_fisica = b.cd_pessoa_fisica)
LEFT OUTER JOIN compl_pessoa_fisica g ON (a.cd_pessoa_fisica = g.cd_pessoa_fisica AND 1 = g.ie_tipo_complemento)
LEFT OUTER JOIN pessoa_juridica c ON (a.cd_cgc = c.cd_cgc)
LEFT OUTER JOIN banco_estabelecimento_v h ON (a.nr_seq_conta_banco = h.nr_sequencia)
WHERE a.cd_moeda 		= d.cd_moeda and h.cd_banco		= e.cd_banco and h.cd_agencia_bancaria	= f.cd_agencia_bancaria and f.cd_banco 		= e.cd_banco;

