-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW duplicidade_v (nr_seq_apresent, nr_prescricao, ds_item, dt_liberacao, dt_order_by, ds_horario, nm_prescritor, nr_seq_horario, nr_seq_item, cd_item, ie_tipo_item, dt_horario, nr_atendimento, dt_validade_prescr, dt_liberacao_medico) AS select   1 nr_seq_apresent,
	(null)::numeric  nr_prescricao,
	SUBSTR(UPPER(ds_tipo_item),1,150) ds_item,
	null dt_liberacao,
	null dt_order_by,
	null ds_horario, /* suplemento oral */
	'' nm_prescritor,
	(null)::numeric  nr_seq_horario,
	(null)::numeric  nr_seq_item,
	null cd_item,
	ie_tipo_item,
	null dt_horario,
	nr_atendimento,
	dt_validade_prescr,
	dt_liberacao_medico
FROM	adep_pend_v
where	dt_liberacao is not null
and	ie_tipo_item = 'S'
and   	adep_obter_se_hor_duplic(nr_atendimento, nr_prescricao, cd_item, ie_origem_proced, dt_horario, 'S') = 'S'

union

select   2 nr_seq_apresent,
	nr_prescricao,
	substr('        ' || ds_item,1,150),
	dt_liberacao,
	dt_horario dt_order_by,
	null ds_horario,
   	nm_prescritor,
	nr_seq_horario,
	nr_seq_item,
	cd_item,
	ie_tipo_item,
	dt_horario,
	nr_atendimento,
	dt_validade_prescr,
	dt_liberacao_medico
from	adep_pend_v
where	dt_liberacao is not null
and	ie_tipo_item = 'S'
and   	adep_obter_se_hor_duplic(nr_atendimento, nr_prescricao, cd_item, ie_origem_proced, dt_horario, 'S') = 'S'
group by
	dt_horario,
	nr_prescricao,
	dt_liberacao,
	ds_item,
	nm_prescritor,
	nr_seq_apresent,
	nr_seq_horario,
	nr_seq_item,
	cd_item,
	ie_tipo_item,
	nr_atendimento,
	dt_validade_prescr,
	dt_liberacao_medico

union

select  3 nr_seq_apresent,
	(null)::numeric  nr_prescricao,
	SUBSTR(UPPER(ds_tipo_item),1,150) ds_item,
	null dt_liberacao,
	null dt_order_by,
	null ds_horario, /* medicamentos */
   	'' nm_prescritor,
	(null)::numeric  nr_seq_horario,
	(null)::numeric  nr_seq_item,
	null cd_item,
	ie_tipo_item,
	null dt_horario,
	nr_atendimento,
	dt_validade_prescr,
	dt_liberacao_medico
from	adep_pend_v
where	dt_liberacao is not null
and	ie_tipo_item = 'M'
and   	adep_obter_se_hor_duplic(nr_atendimento, nr_prescricao, cd_item, ie_origem_proced, dt_horario, 'M') = 'S'

union

select  4 nr_seq_apresent,
	nr_prescricao,
	SUBSTR('        ' || ds_item,1,150),
	dt_liberacao,
	dt_horario dt_order_by,
	to_char(dt_horario,'dd/mm/yyyy hh24:mi:ss') ds_horario, /* medicamentos */
	nm_prescritor,
	nr_seq_horario,
	nr_seq_item,
	cd_item,
	ie_tipo_item,
	dt_horario,
	nr_atendimento,
	dt_validade_prescr,
	dt_liberacao_medico
from	adep_pend_v
where	dt_liberacao is not null
and	ie_tipo_item = 'M'
and   	adep_obter_se_hor_duplic(nr_atendimento, nr_prescricao, cd_item, ie_origem_proced, dt_horario, 'M') = 'S'
group by
	dt_horario,
	nr_prescricao,
	dt_liberacao,
	ds_item,
	nm_prescritor,
	nr_seq_apresent,
	nr_seq_horario,
	nr_seq_item,
	cd_item,
	ie_tipo_item,
	nr_atendimento,
	dt_validade_prescr,
	dt_liberacao_medico

union

select  5 nr_seq_apresent,
	(null)::numeric  nr_prescricao,
	SUBSTR(UPPER(ds_tipo_item),1,150) ds_item,
	null dt_liberacao,
	null dt_order_by,
	'' ds_horario, /* procedimentos */
	'' nm_prescritor,
	(null)::numeric  nr_seq_horario,
	(null)::numeric  nr_seq_item,
	null cd_item,
	ie_tipo_item,
	null dt_horario,
	nr_atendimento,
	dt_validade_prescr,
	dt_liberacao_medico
from	adep_pend_v
where	ie_tipo_item = 'P'
and	dt_liberacao is not null
and   	adep_obter_se_hor_duplic(nr_atendimento, nr_prescricao, cd_item, ie_origem_proced, dt_horario, 'P') = 'S'

union

select  6 nr_seq_apresent,
	nr_prescricao,
	substr('        ' || ds_item,1,150),
	dt_liberacao,
	dt_horario dt_order_by,
	to_char(dt_horario,'dd/mm/yyyy hh24:mi:ss') ds_horario, /* procedimentos */
	nm_prescritor,
	nr_seq_horario,
	nr_seq_item,
	cd_item,
	ie_tipo_item,
	dt_horario,
	nr_atendimento,
	dt_validade_prescr,
	dt_liberacao_medico
from	adep_pend_v
where	ie_tipo_item = 'P'
and	dt_liberacao is not null
and   	adep_obter_se_hor_duplic(nr_atendimento, nr_prescricao, cd_item, ie_origem_proced, dt_horario, 'P') = 'S'
group by
	dt_horario,
	nr_prescricao,
	dt_liberacao,
	nm_prescritor,
	ds_item,
	nr_seq_apresent,
	nr_seq_horario,
	nr_seq_item,
	cd_item,
	ie_tipo_item,
	nr_atendimento,
	dt_validade_prescr,
	dt_liberacao_medico

union

select   7 nr_seq_apresent,
	(null)::numeric  nr_prescricao,
	SUBSTR(UPPER(ds_tipo_item),1,150) ds_item,
	null dt_liberacao,
	null dt_order_by,
	null ds_horario, /* recomendacoes */
	'' nm_prescritor,
	(null)::numeric  nr_seq_horario,
	(null)::numeric  nr_seq_item,
	null cd_item,
	null ie_tipo_item,
	null dt_horario,
	nr_atendimento,
	dt_validade_prescr,
	dt_liberacao_medico
from	adep_pend_v
where	dt_liberacao is not null
and	ie_tipo_item = 'R'
and   	adep_obter_se_hor_duplic(nr_atendimento, nr_prescricao, cd_item, ie_origem_proced, dt_horario, 'R') = 'S'

union

select  8 nr_seq_apresent,
   	nr_prescricao,
   	substr('        ' || ds_item,1,150),
	dt_liberacao,
	dt_horario dt_order_by,
	to_char(dt_horario,'dd/mm/yyyy hh24:mi:ss') ds_horario, /* recomendacoes */
   	nm_prescritor,
	nr_seq_horario,
	nr_seq_item,
	cd_item,
	ie_tipo_item,
	dt_horario,
	nr_atendimento,
	dt_validade_prescr,
	dt_liberacao_medico
from	adep_pend_v
where	dt_liberacao is not null
and	ie_tipo_item = 'R'
and   	adep_obter_se_hor_duplic(nr_atendimento, nr_prescricao, cd_item, ie_origem_proced, dt_horario, 'R') = 'S'
group by
	dt_horario,
	nr_prescricao,
	dt_liberacao,
	ds_item,
	nm_prescritor,
	nr_seq_apresent,
	nr_seq_horario,
	nr_seq_item,
	cd_item,
	ie_tipo_item,
	nr_atendimento,
	dt_validade_prescr,
	dt_liberacao_medico

union

select  9 nr_seq_apresent,
	(null)::numeric  nr_prescricao,
	SUBSTR(UPPER(ds_tipo_item),1,150) ds_item,
	null dt_liberacao,
	null dt_order_by,
	null ds_horario, /* sae */
	'' nm_prescritor,
	(null)::numeric  nr_seq_horario,
	(null)::numeric  nr_seq_item,
	null cd_item,
	ie_tipo_item,
	null dt_horario,
	nr_atendimento,
	dt_validade_prescr,
	dt_liberacao_medico
from	adep_pend_v
where	dt_liberacao is not null
and	ie_tipo_item = 'E'
and   	adep_obter_se_hor_duplic(nr_atendimento, nr_prescricao, cd_item, ie_origem_proced, dt_horario, 'E') = 'S'

union

select  10 nr_seq_apresent,
	nr_prescricao,
	substr('        ' || ds_item,1,150),
	dt_liberacao,
	dt_horario dt_order_by,
	to_char(dt_horario,'dd/mm/yyyy hh24:mi:ss') ds_horario, /* sae */
	nm_prescritor,
	nr_seq_horario,
	nr_seq_item,
	cd_item,
	ie_tipo_item,
	dt_horario,
	nr_atendimento,
	dt_validade_prescr,
	dt_liberacao_medico
from	adep_pend_v
where	dt_liberacao is not null
and	ie_tipo_item = 'E'
and   	adep_obter_se_hor_duplic(nr_atendimento, nr_prescricao, cd_item, ie_origem_proced, dt_horario, 'E') = 'S'
group by
	dt_horario,
	nr_prescricao,
	dt_liberacao,
	ds_item,
	nm_prescritor,
	nr_seq_apresent,
	nr_seq_horario,
	nr_seq_item,
	cd_item,
	ie_tipo_item,
	nr_atendimento,
	dt_validade_prescr,
	dt_liberacao_medico

union

select  11 nr_seq_apresent,
	(null)::numeric  nr_prescricao,
	SUBSTR(UPPER(ds_tipo_item),1,150) ds_item,
	null dt_liberacao,
	null dt_order_by,
	'' ds_horario, /* procedimentos */
	'' nm_prescritor,
	(null)::numeric  nr_seq_horario,
	(null)::numeric  nr_seq_item,
	null cd_item,
	ie_tipo_item,
	null dt_horario,
	nr_atendimento,
	dt_validade_prescr,
	dt_liberacao_medico
from	adep_pend_v
where	ie_tipo_item = 'L'
and	dt_liberacao is not null
and   	adep_obter_se_hor_duplic(nr_atendimento, nr_prescricao, cd_item, ie_origem_proced, dt_horario, 'L') = 'S'

union

select  12 nr_seq_apresent,
	nr_prescricao,
	substr('        ' || ds_item,1,150),
	dt_liberacao,
	dt_horario dt_order_by,
	to_char(dt_horario,'dd/mm/yyyy hh24:mi:ss') ds_horario, /* procedimentos */
	nm_prescritor,
	nr_seq_horario,
	nr_seq_item,
	cd_item,
	ie_tipo_item,
	dt_horario,
	nr_atendimento,
	dt_validade_prescr,
	dt_liberacao_medico
from	adep_pend_v
where	ie_tipo_item = 'L'
and	dt_liberacao is not null
and   	adep_obter_se_hor_duplic(nr_atendimento, nr_prescricao, cd_item, ie_origem_proced, dt_horario, 'L') = 'S'
group by
	dt_horario,
	nr_prescricao,
	dt_liberacao,
	nm_prescritor,
	ds_item,
	nr_seq_apresent,
	nr_seq_horario,
	nr_seq_item,
	cd_item,
	ie_tipo_item,
	nr_atendimento,
	dt_validade_prescr,
	dt_liberacao_medico
order by nr_seq_apresent, ds_item, dt_order_by, nr_prescricao;

