-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW resumen_clinico_exame_v (ds_exame, dt_prev_execucao, ds_status_lab, ds_observacao_coleta, qt_procedimento, nr_atendimento) AS SELECT
    SUBSTR(obter_desc_exame(coalesce(a.nr_seq_exame,c.nr_seq_exame)),1,200) ds_exame,
    TO_CHAR(dt_prev_execucao,'dd/mm/yyyy hh24:mi:ss') dt_prev_execucao,
	SUBSTR(obter_regra_exame_status(ie_status_atend),1,60) ds_status_lab ,
	c.DS_OBSERVACAO_COLETA DS_OBSERVACAO_COLETA,
	c.QT_PROCEDIMENTO QT_PROCEDIMENTO,
	b.NR_ATENDIMENTO NR_ATENDIMENTO
FROM prescr_medica b, prescr_procedimento c
LEFT OUTER JOIN result_laboratorio a ON (c.nr_prescricao = a.nr_prescricao AND c.nr_sequencia = a.nr_seq_prescricao)
WHERE c.nr_prescricao     = b.nr_prescricao AND (a.nr_seq_exame IS NOT NULL OR c.nr_seq_exame IS NOT NULL)

UNION

SELECT SUBSTR(c.nm_exame,1,200) ds_exame,
       TO_CHAR(dt_prev_execucao,'dd/mm/yyyy hh24:mi:ss') dt_prev_execucao,
       SUBSTR(obter_regra_exame_status(ie_status_atend),1,60) ds_status_lab,
	   b.DS_OBSERVACAO_COLETA DS_OBSERVACAO_COLETA,
	   b.QT_PROCEDIMENTO QT_PROCEDIMENTO,
	   a.NR_ATENDIMENTO NR_ATENDIMENTO
FROM exame_laboratorio c,
     prescr_procedimento b,
     prescr_medica a
WHERE b.nr_prescricao = a.nr_prescricao
  AND 	b.nr_seq_exame = c.nr_seq_exame
  AND (a.dt_liberacao IS NOT NULL OR a.dt_liberacao_medico IS NOT NULL)

UNION

SELECT SUBSTR(obter_desc_exame(coalesce(a.nr_seq_exame,c.nr_seq_exame)),1,200) ds_exame,
    TO_CHAR(dt_prev_execucao,'dd/mm/yyyy hh24:mi:ss') dt_prev_execucao,
    SUBSTR(obter_regra_exame_status(ie_status_atend),1,60) ds_status_lab ,
    c.DS_OBSERVACAO_COLETA DS_OBSERVACAO_COLETA,
	c.QT_PROCEDIMENTO QT_PROCEDIMENTO,
	b.NR_ATENDIMENTO NR_ATENDIMENTO
FROM   result_laboratorio a,
       prescr_procedimento c,
       prescr_medica b
WHERE  c.nr_prescricao     = a.nr_prescricao
  AND  c.nr_sequencia      = a.nr_seq_prescricao
  AND  c.nr_prescricao     = b.nr_prescricao
AND b.dt_suspensao IS NULL;

