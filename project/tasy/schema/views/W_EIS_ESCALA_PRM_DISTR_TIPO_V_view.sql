-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW w_eis_escala_prm_distr_tipo_v (cd_setor_atendimento, ds_setor_atendimento, dt_evento, cd_empresa, cd_estabelecimento, nr_atendimento, ds_medida_adotadas, ds_unidade, ds_alto_risco, nr_sequencia, ds_evento, qt_total) AS select	distinct
	e.cd_setor_atendimento, 
	substr(obter_nome_setor(e.cd_setor_atendimento),1,255) ds_Setor_Atendimento,	 
	b.dt_evento, 
	f.cd_empresa, 
	a.cd_estabelecimento,	 
	b.nr_atendimento,	 
	e.DS_MEDIDA_ADOTADAS, 
	obter_unidade_atendimento(b.nr_atendimento,'A','U') ds_unidade, 
	CASE WHEN(obter_se_material_risco_PRM(e.nr_sequencia))='S' THEN 'Sim'  ELSE 'NÃ£o' END  ds_alto_risco, 
	d.nr_sequencia, 
	substr(obter_dados_escala_prm(d.nr_sequencia,'E',null,null),1,255) ds_evento, 
	(obter_dados_escala_prm(null,'T',b.dt_evento,null))::numeric  qt_total 
FROM qua_evento g, estabelecimento f, qua_tipo_evento d, qua_evento_paciente b, atendimento_paciente a, prm_ficha_ocorrencia e
LEFT OUTER JOIN prm_ficha_material c ON (e.nr_sequencia = c.nr_seq_ficha)
WHERE e.nr_seq_evento = b.nr_sequencia and a.nr_atendimento = b.nr_atendimento and b.dt_inativacao is null and a.cd_estabelecimento = f.cd_estabelecimento and d.nr_Sequencia = g.nr_seq_tipo and b.nr_seq_evento = g.nr_sequencia and g.nr_seq_tipo = d.nr_Sequencia;

