-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_comercial_cliente_ind_v (ie_tipo_pessoa, ds_tipo_pessoa, ie_status, ds_status, ie_origem_solicitacao, ds_origem_solicitacao, ie_fase_venda, ds_fase_venda, ie_classificacao, ds_classificacao, nr_seq_vendedor_canal, nm_canal_venda, nr_seq_vendedor_vinculado, nm_vendedor, qt_idade, ds_municipio, dt_mesano_referencia) AS select	'PF' ie_tipo_pessoa,
	'Pessoa Física' ds_tipo_pessoa, 
	a.ie_status, 
	substr(obter_valor_dominio(2664,a.ie_status),1,255) ds_status, 
	e.ie_origem_solicitacao, 
	substr(pls_obter_dados_solicitacao(a.nr_seq_solicitacao,'O'),1,200) ds_origem_solicitacao, 
	a.ie_fase_venda, 
	substr(obter_valor_dominio(2517,a.ie_fase_venda),1,255) ds_fase_venda, 
	a.ie_classificacao, 
	substr(obter_valor_dominio(2475,a.ie_classificacao),1,255) ds_classificacao, 
	b.nr_seq_vendedor_canal, 
	substr(pls_obter_dados_vendedor(b.nr_seq_vendedor_canal,'N'),1,200) nm_canal_venda, 
	b.nr_seq_vendedor_vinculado, 
	substr(pls_obter_dados_vend_vinculado(b.nr_seq_vendedor_vinculado,'D'),1,255) nm_vendedor, 
	(substr(obter_idade_pf(c.cd_pessoa_fisica, LOCALTIMESTAMP, 'A'),1,100))::numeric  qt_idade, 
	substr(obter_compl_pf(c.cd_pessoa_fisica,1,'CI'),1,255) ds_municipio, 
	a.dt_aprovacao dt_mesano_referencia 
FROM pessoa_fisica c, pls_comercial_cliente a
LEFT OUTER JOIN pls_solicitacao_vendedor b ON (a.nr_sequencia = b.nr_seq_cliente)
LEFT OUTER JOIN pls_solicitacao_comercial e ON (a.nr_seq_solicitacao = e.nr_sequencia)
WHERE a.cd_pessoa_fisica = c.cd_pessoa_fisica  
union all
 
select	'PJ' ie_tipo_pessoa, 
	'Pessoa Jurídica' ds_tipo_pessoa, 
	a.ie_status, 
	substr(obter_valor_dominio(2664,a.ie_status),1,255) ds_status, 
	d.ie_origem_solicitacao, 
	substr(pls_obter_dados_solicitacao(a.nr_seq_solicitacao,'O'),1,200) ds_origem_solicitacao, 
	a.ie_fase_venda, 
	substr(obter_valor_dominio(2517,a.ie_fase_venda),1,255) ds_fase_venda, 
	a.ie_classificacao, 
	substr(obter_valor_dominio(2475,a.ie_classificacao),1,255) ds_classificacao, 
	b.nr_seq_vendedor_canal, 
	substr(pls_obter_dados_vendedor(b.nr_seq_vendedor_canal,'N'),1,200) nm_canal_venda, 
	b.nr_seq_vendedor_vinculado, 
	substr(pls_obter_dados_vend_vinculado(b.nr_seq_vendedor_vinculado,'D'),1,255) nm_vendedor, 
	null qt_idade, 
	c.ds_municipio, 
	a.dt_aprovacao dt_mesano_referencia 
FROM pessoa_juridica c, pls_comercial_cliente a
LEFT OUTER JOIN pls_solicitacao_vendedor b ON (a.nr_sequencia = b.nr_seq_cliente)
LEFT OUTER JOIN pls_solicitacao_comercial d ON (a.nr_seq_solicitacao = d.nr_sequencia)
WHERE a.cd_cgc = c.cd_cgc;

