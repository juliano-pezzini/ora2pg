-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_ar_dados_v (ie_preco, ie_regulamentacao, ie_situacao_trabalhista, ie_tipo_contratacao, ie_tipo_contrato, ie_tipo_segurado, ie_tipo_vinculo_operadora, ie_tipo_registro, ie_tipo_protocolo, nr_seq_congenere_repasse, nr_seq_contrato, nr_seq_faixa_etaria, nr_seq_grupo_intercambio, nr_seq_intercambio, nr_seq_lote, nr_seq_pagador, nr_seq_plano, nr_seq_segurado, nr_seq_conta, nr_seq_mens_segurado, nr_seq_copartic, nr_seq_repasse_mens, nr_seq_comi_benef, nr_seq_conta_sus, nr_seq_rec_glosa, nr_seq_discussao, nr_seq_fatura_conta, dt_contabilizacao, dt_mes_competencia, vl_antecipacao, vl_coparticipacao, vl_mensalidade, vl_pro_rata, vl_conta, vl_comissao, vl_ressarcir, vl_recurso, vl_faturado, vl_taxa, vl_reembolso, nr_sequencia, cd_estabelecimento, ds_tabela, vl_receitas, vl_despesas, vl_assist, pr_sinistralidade, pr_resultado) AS select	ie_preco,
	ie_regulamentacao,
	ie_situacao_trabalhista,
	ie_tipo_contratacao,
	ie_tipo_contrato,
	ie_tipo_segurado,
	ie_tipo_vinculo_operadora,
	ie_tipo_registro,
	ie_tipo_protocolo,
	nr_seq_congenere_repasse,
	nr_seq_contrato,
	nr_seq_faixa_etaria,
	nr_seq_grupo_intercambio,
	nr_seq_intercambio,
	nr_seq_lote,
	nr_seq_pagador,
	nr_seq_plano,
	nr_seq_segurado,
	nr_seq_conta,
	nr_seq_mens_segurado,
	nr_seq_copartic,
	nr_seq_repasse_mens,
	nr_seq_comi_benef,
	nr_seq_conta_sus,
	nr_seq_rec_glosa,
	nr_seq_discussao,
	nr_seq_fatura_conta,
	dt_contabilizacao,
	dt_mes_competencia,
	vl_antecipacao,
	vl_coparticipacao,
	vl_mensalidade,
	vl_pro_rata,
	vl_conta,
	vl_comissao,
	vl_ressarcir,
	vl_recurso,
	vl_faturado,
	vl_taxa,
	vl_reembolso,
	nr_sequencia,
	cd_estabelecimento,
	ds_tabela,
	vl_receitas,
	vl_despesas,
	vl_assist,
	dividir_sem_round(vl_assist, vl_receitas) * 100 pr_sinistralidade,
	pls_obter_perc_result(vl_receitas, vl_receitas - vl_despesas) pr_resultado
FROM	(select	ie_preco,
		ie_regulamentacao,
		ie_situacao_trabalhista,
		ie_tipo_contratacao,
		ie_tipo_contrato,
		ie_tipo_segurado,
		ie_tipo_vinculo_operadora,
		ie_tipo_registro,
		ie_tipo_protocolo,
		nr_seq_congenere_repasse,
		nr_seq_contrato,
		nr_seq_faixa_etaria,
		nr_seq_grupo_intercambio,
		nr_seq_intercambio,
		nr_seq_lote,
		nr_seq_pagador,
		nr_seq_plano,
		nr_seq_segurado,
		nr_seq_conta,
		nr_seq_mens_segurado,
		nr_seq_copartic,
		nr_seq_repasse_mens,
		nr_seq_comi_benef,
		nr_seq_conta_sus,
		nr_seq_rec_glosa,
		nr_seq_discussao,
		nr_seq_fatura_conta,
		dt_contabilizacao,
		dt_mes_competencia,
		vl_antecipacao,
		vl_coparticipacao,
		vl_mensalidade,
		vl_pro_rata,
		vl_conta,
		vl_comissao,
		vl_ressarcir,
		vl_recurso,
		vl_faturado,
		vl_taxa,
		vl_reembolso,
		nr_sequencia,
		cd_estabelecimento,
		ds_tabela,
		coalesce(vl_mensalidade,0) + coalesce(vl_faturado,0) + coalesce(vl_taxa,0) vl_receitas,
		(coalesce(vl_conta,0) + coalesce(vl_comissao,0) + coalesce(vl_ressarcir,0) + coalesce(vl_recurso,0)) - coalesce(vl_coparticipacao,0) vl_despesas,
		coalesce(vl_conta,0) + coalesce(vl_ressarcir,0) + coalesce(vl_recurso,0) vl_assist	
	from	(select	a.ie_preco,
			a.ie_regulamentacao,
			a.ie_situacao_trabalhista,
			a.ie_tipo_contratacao,
			a.ie_tipo_contrato,
			a.ie_tipo_segurado,
			a.ie_tipo_vinculo_operadora,
			a.ie_tipo_registro,
			null ie_tipo_protocolo,
			a.nr_seq_congenere_repasse,
			a.nr_seq_contrato,
			a.nr_seq_faixa_etaria,
			a.nr_seq_grupo_intercambio,
			a.nr_seq_intercambio,
			a.nr_seq_lote,
			a.nr_seq_pagador,
			a.nr_seq_plano,
			a.nr_seq_segurado,
			null nr_seq_conta,
			a.nr_seq_mens_segurado,
			null nr_seq_copartic,
			null nr_seq_repasse_mens,
			null nr_seq_comi_benef,
			null nr_seq_conta_sus,
			null nr_seq_rec_glosa,
			null nr_seq_discussao,
			null nr_seq_fatura_conta,
			a.dt_contabilizacao,
			b.dt_mes_competencia,
			a.vl_antecipacao,
			null vl_coparticipacao,
			a.vl_item vl_mensalidade,
			a.vl_pro_rata,
			null vl_conta,
			null vl_comissao,
			null vl_ressarcir,
			null vl_recurso,
			null vl_faturado,
			null vl_taxa,
			null vl_reembolso,
			a.nr_sequencia,
			a.cd_estabelecimento,
			'PLS_AR_MENSALIDADE' ds_tabela
		from	pls_ar_mensalidade	a,
			pls_ar_lote		b
		where	b.nr_sequencia = a.nr_seq_lote
		
union all

		select	a.ie_preco,
			a.ie_regulamentacao,
			a.ie_situacao_trabalhista,
			a.ie_tipo_contratacao,
			a.ie_tipo_contrato,
			a.ie_tipo_segurado,
			a.ie_tipo_vinculo_operadora,
			null ie_tipo_registro,
			a.ie_tipo_protocolo,
			a.nr_seq_congenere_repasse,
			a.nr_seq_contrato,
			a.nr_seq_faixa_etaria,
			a.nr_seq_grupo_intercambio,
			a.nr_seq_intercambio,
			a.nr_seq_lote,
			a.nr_seq_pagador,
			a.nr_seq_plano,
			a.nr_seq_segurado,
			a.nr_seq_conta,
			null nr_seq_mens_segurado,
			null nr_seq_copartic,
			null nr_seq_repasse_mens,
			null nr_seq_comi_benef,
			null nr_seq_conta_sus,
			null nr_seq_rec_glosa,
			null nr_seq_discussao,
			null nr_seq_fatura_conta,
			null dt_contabilizacao,
			b.dt_mes_competencia,
			null vl_antecipacao,
			null vl_coparticipacao,
			null vl_mensalidade,
			null vl_pro_rata,
			a.vl_total vl_conta,
			null vl_comissao,
			null vl_ressarcir,
			null vl_recurso,
			null vl_faturado,
			null vl_taxa,
			null vl_reembolso,
			a.nr_sequencia,
			a.cd_estabelecimento,
			'PLS_AR_CONTA' ds_tabela
		from	pls_ar_conta	a,
			pls_ar_lote		b
		where	b.nr_sequencia = a.nr_seq_lote
		
union all

		select	a.ie_preco,
			a.ie_regulamentacao,
			a.ie_situacao_trabalhista,
			a.ie_tipo_contratacao,
			a.ie_tipo_contrato,
			a.ie_tipo_segurado,
			a.ie_tipo_vinculo_operadora,
			null ie_tipo_registro,
			null ie_tipo_protocolo,
			a.nr_seq_congenere_repasse,
			a.nr_seq_contrato,
			a.nr_seq_faixa_etaria,
			a.nr_seq_grupo_intercambio,
			a.nr_seq_intercambio,
			a.nr_seq_lote,
			a.nr_seq_pagador,
			a.nr_seq_plano,
			a.nr_seq_segurado,
			a.nr_seq_conta,
			null nr_seq_mens_segurado,
			a.nr_seq_copartic,
			null nr_seq_repasse_mens,
			null nr_seq_comi_benef,
			null nr_seq_conta_sus,
			null nr_seq_rec_glosa,
			null nr_seq_discussao,
			null nr_seq_fatura_conta,
			null dt_contabilizacao,
			b.dt_mes_competencia,
			null vl_antecipacao,
			a.vl_coparticipacao,
			null vl_mensalidade,
			null vl_pro_rata,
			null vl_conta,
			null vl_comissao,
			null vl_ressarcir,
			null vl_recurso,
			null vl_faturado,
			null vl_taxa,
			null vl_reembolso,
			a.nr_sequencia,
			a.cd_estabelecimento,
			'PLS_AR_COPARTICIPACAO' ds_tabela
		from	pls_ar_coparticipacao	a,
			pls_ar_lote		b
		where	b.nr_sequencia = a.nr_seq_lote
		
union all

		select	a.ie_preco,
			a.ie_regulamentacao,
			a.ie_situacao_trabalhista,
			a.ie_tipo_contratacao,
			a.ie_tipo_contrato,
			a.ie_tipo_segurado,
			a.ie_tipo_vinculo_operadora,
			null ie_tipo_registro,
			null ie_tipo_protocolo,
			a.nr_seq_congenere_repasse,
			a.nr_seq_contrato,
			a.nr_seq_faixa_etaria,
			a.nr_seq_grupo_intercambio,
			a.nr_seq_intercambio,
			a.nr_seq_lote,
			a.nr_seq_pagador,
			a.nr_seq_plano,
			a.nr_seq_segurado,
			null nr_seq_conta,
			null nr_seq_mens_segurado,
			null nr_seq_copartic,
			a.nr_seq_repasse_mens,
			a.nr_seq_comi_benef,
			null nr_seq_conta_sus,
			null nr_seq_rec_glosa,
			null nr_seq_discussao,
			null nr_seq_fatura_conta,
			null dt_contabilizacao,
			b.dt_mes_competencia,
			null vl_antecipacao,
			null vl_coparticipacao,
			null vl_mensalidade,
			null vl_pro_rata,
			null vl_conta,
			a.vl_comissao,
			null vl_ressarcir,
			null vl_recurso,
			null vl_faturado,
			null vl_taxa,
			null vl_reembolso,
			a.nr_sequencia,
			a.cd_estabelecimento,
			'PLS_AR_COMISSAO' ds_tabela
		from	pls_ar_comissao	a,
			pls_ar_lote		b
		where	b.nr_sequencia = a.nr_seq_lote
		
union all

		select	a.ie_preco,
			a.ie_regulamentacao,
			a.ie_situacao_trabalhista,
			a.ie_tipo_contratacao,
			a.ie_tipo_contrato,
			a.ie_tipo_segurado,
			a.ie_tipo_vinculo_operadora,
			null ie_tipo_registro,
			null ie_tipo_protocolo,
			a.nr_seq_congenere_repasse,
			a.nr_seq_contrato,
			a.nr_seq_faixa_etaria,
			a.nr_seq_grupo_intercambio,
			a.nr_seq_intercambio,
			a.nr_seq_lote,
			a.nr_seq_pagador,
			a.nr_seq_plano,
			a.nr_seq_segurado,
			null nr_seq_conta,
			null nr_seq_mens_segurado,
			null nr_seq_copartic,
			null nr_seq_repasse_mens,
			null nr_seq_comi_benef,
			a.nr_seq_conta_sus,
			null nr_seq_rec_glosa,
			null nr_seq_discussao,
			null nr_seq_fatura_conta,
			null dt_contabilizacao,
			b.dt_mes_competencia,
			null vl_antecipacao,
			null vl_coparticipacao,
			null vl_mensalidade,
			null vl_pro_rata,
			null vl_conta,
			null vl_comissao,
			a.vl_ressarcir,
			null vl_recurso,
			null vl_faturado,
			null vl_taxa,
			null vl_reembolso,
			a.nr_sequencia,
			a.cd_estabelecimento,
			'PLS_AR_RESS_SUS' ds_tabela
		from	pls_ar_ress_sus	a,
			pls_ar_lote		b
		where	b.nr_sequencia = a.nr_seq_lote
		
union all

		select	a.ie_preco,
			a.ie_regulamentacao,
			a.ie_situacao_trabalhista,
			a.ie_tipo_contratacao,
			a.ie_tipo_contrato,
			a.ie_tipo_segurado,
			a.ie_tipo_vinculo_operadora,
			null ie_tipo_registro,
			null ie_tipo_protocolo,
			a.nr_seq_congenere_repasse,
			a.nr_seq_contrato,
			a.nr_seq_faixa_etaria,
			a.nr_seq_grupo_intercambio,
			a.nr_seq_intercambio,
			a.nr_seq_lote,
			a.nr_seq_pagador,
			a.nr_seq_plano,
			a.nr_seq_segurado,
			a.nr_seq_conta,
			null nr_seq_mens_segurado,
			null nr_seq_copartic,
			null nr_seq_repasse_mens,
			null nr_seq_comi_benef,
			null nr_seq_conta_sus,
			a.nr_seq_rec_glosa,
			null nr_seq_discussao,
			null nr_seq_fatura_conta,
			null dt_contabilizacao,
			b.dt_mes_competencia,
			null vl_antecipacao,
			null vl_coparticipacao,
			null vl_mensalidade,
			null vl_pro_rata,
			null vl_conta,
			null vl_comissao,
			null vl_ressarcir,
			a.vl_recurso,
			null vl_faturado,
			null vl_taxa,
			null vl_reembolso,
			a.nr_sequencia,
			a.cd_estabelecimento,
			'PLS_AR_REC_GLOSA' ds_tabela
		from	pls_ar_rec_glosa	a,
			pls_ar_lote		b
		where	b.nr_sequencia = a.nr_seq_lote
		
union all

		select	a.ie_preco,
			a.ie_regulamentacao,
			a.ie_situacao_trabalhista,
			a.ie_tipo_contratacao,
			a.ie_tipo_contrato,
			a.ie_tipo_segurado,
			a.ie_tipo_vinculo_operadora,
			null ie_tipo_registro,
			null ie_tipo_protocolo,
			a.nr_seq_congenere_repasse,
			a.nr_seq_contrato,
			a.nr_seq_faixa_etaria,
			a.nr_seq_grupo_intercambio,
			a.nr_seq_intercambio,
			a.nr_seq_lote,
			a.nr_seq_pagador,
			a.nr_seq_plano,
			a.nr_seq_segurado,
			a.nr_seq_conta,
			null nr_seq_mens_segurado,
			null nr_seq_copartic,
			null nr_seq_repasse_mens,
			null nr_seq_comi_benef,
			null nr_seq_conta_sus,
			null nr_seq_rec_glosa,
			a.nr_seq_discussao,
			null nr_seq_fatura_conta,
			null dt_contabilizacao,
			b.dt_mes_competencia,
			null vl_antecipacao,
			null vl_coparticipacao,
			null vl_mensalidade,
			null vl_pro_rata,
			null vl_conta,
			null vl_comissao,
			null vl_ressarcir,
			a.vl_contestacao vl_recurso,
			null vl_faturado,
			null vl_taxa,
			null vl_reembolso,
			a.nr_sequencia,
			a.cd_estabelecimento,
			'PLS_AR_CONTESTACAO' ds_tabela
		from	pls_ar_contestacao	a,
			pls_ar_lote		b
		where	b.nr_sequencia = a.nr_seq_lote
		
union all

		select	a.ie_preco,
			a.ie_regulamentacao,
			a.ie_situacao_trabalhista,
			a.ie_tipo_contratacao,
			a.ie_tipo_contrato,
			a.ie_tipo_segurado,
			a.ie_tipo_vinculo_operadora,
			null ie_tipo_registro,
			null ie_tipo_protocolo,
			a.nr_seq_congenere_repasse,
			a.nr_seq_contrato,
			a.nr_seq_faixa_etaria,
			a.nr_seq_grupo_intercambio,
			a.nr_seq_intercambio,
			a.nr_seq_lote,
			a.nr_seq_pagador,
			a.nr_seq_plano,
			a.nr_seq_segurado,
			(select	max(x.nr_seq_conta)
			from	pls_fatura_conta x
			where	x.nr_sequencia = a.nr_seq_fatura_conta) nr_seq_conta,
			null nr_seq_mens_segurado,
			null nr_seq_copartic,
			null nr_seq_repasse_mens,
			null nr_seq_comi_benef,
			null nr_seq_conta_sus,
			null nr_seq_rec_glosa,
			null nr_seq_discussao,
			a.nr_seq_fatura_conta,
			null dt_contabilizacao,
			b.dt_mes_competencia,
			null vl_antecipacao,
			null vl_coparticipacao,
			null vl_mensalidade,
			null vl_pro_rata,
			null vl_conta,
			null vl_comissao,
			null vl_ressarcir,
			null vl_recurso,
			a.vl_faturado,
			a.vl_taxa,
			null vl_reembolso,
			a.nr_sequencia,
			a.cd_estabelecimento,
			'PLS_AR_FATURAMENTO' ds_tabela
		from	pls_ar_faturamento	a,
			pls_ar_lote		b
		where	b.nr_sequencia = a.nr_seq_lote
		
union all

		select	a.ie_preco,
			a.ie_regulamentacao,
			a.ie_situacao_trabalhista,
			a.ie_tipo_contratacao,
			a.ie_tipo_contrato,
			a.ie_tipo_segurado,
			a.ie_tipo_vinculo_operadora,
			null ie_tipo_registro,
			a.ie_tipo_protocolo,
			a.nr_seq_congenere_repasse,
			a.nr_seq_contrato,
			a.nr_seq_faixa_etaria,
			a.nr_seq_grupo_intercambio,
			a.nr_seq_intercambio,
			a.nr_seq_lote,
			a.nr_seq_pagador,
			a.nr_seq_plano,
			a.nr_seq_segurado,
			a.nr_seq_conta,
			null nr_seq_mens_segurado,
			null nr_seq_copartic,
			null nr_seq_repasse_mens,
			null nr_seq_comi_benef,
			null nr_seq_conta_sus,
			null nr_seq_rec_glosa,
			null nr_seq_discussao,
			null nr_seq_fatura_conta,
			null dt_contabilizacao,
			b.dt_mes_competencia,
			null vl_antecipacao,
			null vl_coparticipacao,
			null vl_mensalidade,
			null vl_pro_rata,
			null vl_conta,
			null vl_comissao,
			null vl_ressarcir,
			null vl_recurso,
			null vl_faturado,
			null vl_taxa,
			vl_total vl_reembolso,
			a.nr_sequencia,
			a.cd_estabelecimento,
			'PLS_AR_REEMBOLSO' ds_tabela
		from	pls_ar_reembolso	a,
			pls_ar_lote		b
		where	b.nr_sequencia = a.nr_seq_lote) alias16) alias17;

