-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW san_roche_exp_v (ordernar, nr_seq_doacao, identificador, h1, h2, layout, vazio, host, h8, data_hora, p2, cd_pessoa_fisica, nm_pessoa_fisica, dt_nascimento, sexo, o2, isbt, ds_exame, o6, o12, l2, l3) AS select
        '01H' ordernar,
        null nr_seq_doacao,
        Identificador,
        H1,
        H2,
        Layout,
        Vazio,
        Host,
        H8,
        Data_Hora,
        null P2,
        null cd_pessoa_fisica,
        null nm_pessoa_fisica,
        null dt_nascimento,
        null sexo,
        null O2,
        null isbt,
        null ds_exame,
        null O6,
        null O12,
        null L2,
        null L3
        FROM (
  select
        'H' Identificador,
        '\^&' H1,
        '1' H2,
        'Omega v4^Roche Diagnostics' Layout,
        ' ' Vazio,
        'Host' Host,
        'P' H8,
        to_char(LOCALTIMESTAMP,'yyyymmddhh24miss') Data_Hora
    ) alias1

union

  select
        '02P' ordernar,
        nr_seq_doacao,
        Identificador,
        null H1,
        null H2,
        null Layout,
        Vazio,
        null Host,
        null H8,
        Data_Hora,
        P2,
        cd_pessoa_fisica,
        nm_pessoa_fisica,
        dt_nascimento,
        sexo,
        null O2,
        null isbt,
        null ds_exame,
        null O6,
        null O12,
        null L2,
        null L3
        from (
  select
        a.nr_sequencia nr_seq_doacao,
        'P' Identificador,
        null H1,
        null H2,
        null Layout,
        ' ' Vazio,
        null Host,
        to_char(LOCALTIMESTAMP,'yyyymmddhh24miss') Data_Hora,
        '1' P2,
        a.cd_pessoa_fisica,
        b.nm_pessoa_fisica,
        to_char(b.dt_nascimento, 'yyyymmdd') dt_nascimento,
        coalesce(b.ie_sexo, 'I') sexo
        FROM san_doacao a
LEFT OUTER JOIN pessoa_fisica b ON (a.cd_pessoa_fisica = b.cd_pessoa_fisica) order BY 1) alias5

union

  select
        '03O' ordernar,
        nr_seq_doacao,
        Identificador,
        null H1,
        null H2,
        null Layout,
        Vazio,
        null Host,
        null H8,
        Data_Hora,
        null P2,
        null cd_pessoa_fisica,
        null nm_pessoa_fisica,
        null dt_nascimento,
        null sexo,
        ROW_NUMBER() OVER (PARTITION BY nr_seq_doacao
                                   ORDER BY nr_seq_doacao) O2,
        isbt,
        ds_exame,
        O6,
        O12,
        null L2,
        null L3
        from (
  select
        a.nr_sequencia nr_seq_doacao,
        'O' Identificador,
        ' ' Vazio,
        to_char(LOCALTIMESTAMP,'yyyymmddhh24miss') Data_Hora,
        obter_isbt_doador(a.nr_sequencia, null, 'I') isbt,
        b.cd_exame_integracao ds_exame,
        'R' O6,
        'A' O12,
        b.nr_sequencia nr_seq_exame_int
from 	san_doacao a,
	san_exame_integracao b
where 	b.cd_tipo_integracao = '1'
order by a.nr_sequencia) alias10

union

 select
        '99L' ordernar,
        null nr_seq_doacao,
        Identificador,
        null H1,
        null H2,
        null Layout,
        null Vazio,
        null Host,
        null H8,
        null Data_Hora,
        null P2,
        null cd_pessoa_fisica,
        null nm_pessoa_fisica,
        null dt_nascimento,
        null sexo,
        null O2,
        null isbt,
        null ds_exame,
        null O6,
        null O12,
        L2,
        L3
        from (
  select
        'L' Identificador,
        '1' L2,
        'N' L3
  ) alias11
order by 1,2;

