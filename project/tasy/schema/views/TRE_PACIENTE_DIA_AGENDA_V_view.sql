-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW tre_paciente_dia_agenda_v (dt_agenda, nm_pessoa_fisica, ds_tipo_agenda, nr_atendimento, cd_tipo_agenda, nr_seq_agenda, nr_seq_inscrito, ie_status_paciente, ie_autorizacao, cd_agenda, cd_pessoa_fisica, cd_convenio, ie_tipo_atendimento, ie_classif_agenda, ie_status_agenda, cd_procedencia, ie_carater_inter_sus, cd_medico, ds_status_agenda, cd_medico_solic, cd_medico_agenda, dt_confirmacao, ds_status_ageserv, dt_alta_atend, nm_usuario_acesso, ie_pac_internado, crm_medico_externo, nm_medico_externo, dt_chegada_paciente, nr_seq_pac_dia, dt_agenda_comp, cd_estabelecimento, nr_seq_classif_ageint) AS select	to_char(dt_agenda,'HH24:Mi:SS') dt_agenda,
	substr(obter_nome_pf(a.cd_pessoa_fisica),1,254) nm_pessoa_fisica, 
	substr(obter_desc_agenda(a.cd_agenda),1,255) ds_tipo_agenda, 
	a.nr_atendimento nr_atendimento, 
	cd_tipo_agenda cd_tipo_agenda, 
	a.nr_sequencia nr_seq_agenda, 
	null nr_seq_inscrito, 
	'' ie_status_paciente, 
	a.IE_AUTORIZACAO ie_autorizacao, 
	a.cd_agenda cd_agenda, 
	a.cd_pessoa_fisica cd_pessoa_fisica, 
	a.cd_convenio	cd_convenio, 
	a.ie_tipo_atendimento ie_tipo_atendimento, 
	a.ie_classif_agenda ie_classif_agenda, 
	a.ie_status_agenda ie_status_agenda, 
	a.cd_procedencia cd_procedencia, 
	a.ie_carater_inter_sus ie_carater_inter_sus, 
	a.cd_medico cd_medico, 
	substr(obter_valor_dominio(83,IE_STATUS_AGENDA),1,254) ds_status_agenda, 
	a.cd_medico_solic cd_medico_solic, 
	substr(obter_medico_agecons(b.cd_agenda,'C'),1,10) cd_medico_agenda, 
	a.dt_confirmacao dt_confirmacao, 
	substr(obter_status_ageservico(a.nr_sequencia),1,2) DS_STATUS_AGESERV, 
	substr(obter_dados_atendimento(a.NR_ATENDIMENTO,'DA'),1,25) DT_ALTA_ATEND, 
	NM_USUARIO_ACESSO NM_USUARIO_ACESSO, 
	substr(Obter_se_pessoa_internada(a.cd_pessoa_fisica),1,1) IE_PAC_INTERNADO, 
	a.crm_medico_externo crm_medico_externo, 
	a.nm_medico_externo nm_medico_externo, 
	null dt_chegada_paciente, 
	null nr_seq_pac_dia, 
	dt_agenda dt_agenda_comp, 
	b.cd_estabelecimento, 
	obter_nr_seq_classif_ageint(a.nr_sequencia, 'C') nr_seq_classif_ageint 
FROM	agenda_consulta a, 
	agenda b 
where	(((a.nr_seq_pac_reab is not null) or (a.NR_SEQ_RP_MOD_ITEM is not null) or (a.NR_SEQ_RP_ITEM_IND is not null)) 
or	((b.cd_tipo_agenda = 3) and exists (select	1 
from	RP_PACIENTE_REABILITACAO c 
where	c.cd_pessoa_fisica = a.cd_pessoa_fisica))) 
and	a.cd_agenda = b.cd_agenda 
and	b.cd_tipo_agenda in (3,5);

