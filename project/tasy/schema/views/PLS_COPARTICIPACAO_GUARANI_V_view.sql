-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_coparticipacao_guarani_v (nr_periodo_identificacao, nm_beneficiario, nr_guia, dt_atendimento, cd_procedimento, ds_procedimento, vl_coparticipacao, nm_usuario, nr_matricula) AS select	substr(rpad(to_char(d.dt_mesano_referencia, 'YYYYMM') || substr(c.cd_usuario_plano,2,15), 21, '0'),1,21) nr_periodo_identificacao,
	substr(elimina_caractere_esp_asc(e.nm_pessoa_fisica,'S','S'),1,30) nm_beneficiario, 
	substr(g.cd_guia,1,10) nr_guia, 
	to_char(g.dt_atendimento, 'dd/mm/yyyy') dt_atendimento, 
	coalesce(substr(pls_obter_dados_conta_proc(h.nr_seq_conta_proc,'C'),1,8), substr(pls_obter_dados_conta_mat(h.nr_seq_conta_mat,'C'),1,8)) cd_procedimento, 
	elimina_caractere_esp_asc(coalesce(substr(pls_obter_dados_conta_proc(h.nr_seq_conta_proc,'D'),1,50), substr(pls_obter_dados_conta_mat(h.nr_seq_conta_mat,'D'),1,50)),'S','S') ds_procedimento, 
	lpad(replace(replace(campo_mascara_virgula(h.vl_coparticipacao),'.',''),',',''),15,'0') vl_coparticipacao, 
	a.nm_usuario, 
	lpad(substr(b.cd_matricula_estipulante,1,16),16,'0') nr_matricula 
FROM	pessoa_fisica			e, 
	pls_conta_coparticipacao	h, 
	pls_conta			g, 
	pls_mensalidade_seg_item	f, 
	pls_mensalidade_segurado	d, 
	pls_segurado_carteira		c, 
	pls_segurado			b, 
	w_pls_interface_mens		a 
where	e.cd_pessoa_fisica	= b.cd_pessoa_fisica 
and	b.nr_sequencia 		= a.nr_seq_segurado 
and	b.nr_sequencia 		= c.nr_seq_segurado 
and	b.nr_sequencia		= g.nr_seq_segurado 
and	d.nr_sequencia		= a.nr_seq_mensalidade_seg 
and	d.nr_sequencia		= f.nr_seq_mensalidade_seg 
and	g.nr_sequencia		= f.nr_seq_conta 
and	g.nr_sequencia		= h.nr_seq_conta 
and	f.ie_tipo_item 		= '3' 
order by 
	nm_beneficiario, 
	cd_procedimento;

