-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_quantidade_exames_etapa_v (ie_tipo, dt_atualizacao, count1, count2, count3, count4, count5, count6, count7, nr_seq_grupo, ds_grupo_exame, nr_seq_exame, nm_exame, cd_setor_atendimento, ie_tipo_atendimento, cd_medico) AS select 	1 ie_tipo,
		trunc(c.dt_atualizacao) dt_atualizacao, 
		1 count1, 
		0 count2, 
		0 count3, 
		0 count4, 
		0 count5, 
		0 count6, 
		0 count7, 
		b.nr_seq_grupo nr_seq_grupo, 
		substr(obter_desc_grupo_exame_lab(b.nr_seq_grupo),1,30) ds_grupo_exame, 
		0 nr_seq_exame, 
		null nm_exame, 
		substr(obter_setor_prescr_entrega(a.nr_prescricao, 'C'),1,10) cd_setor_atendimento, 
		substr(obter_tipo_atend_prescr(a.nr_prescricao), 1, 5) ie_tipo_atendimento, 
		substr(obter_medico_prescricao(a.nr_prescricao, 'C'),1,10)	cd_medico	 
FROM 	prescr_procedimento a, 
		exame_laboratorio b, 
		prescr_proc_etapa c 
where 	a.nr_seq_exame = b.nr_seq_exame 
and		a.nr_prescricao = c.nr_prescricao 
and		a.nr_sequencia = c.nr_seq_prescricao 
and 	c.ie_etapa = 15 

union all
 
select 	2 ie_tipo, 
		trunc(c.dt_atualizacao) dt_atualizacao, 
		1 count1, 
		0 count2, 
		0 count3, 
		0 count4, 
		0 count5, 
		0 count6, 
		0 count7, 
		0 nr_seq_grupo, 
		null ds_grupo_exame, 
		b.nr_seq_exame nr_seq_exame, 
		substr(b.nm_exame,1,30) nm_exame, 
		substr(obter_setor_prescr_entrega(a.nr_prescricao, 'C'),1,10) cd_setor_atendimento, 
		substr(obter_tipo_atend_prescr(a.nr_prescricao), 1, 5) ie_tipo_atendimento, 
		substr(obter_medico_prescricao(a.nr_prescricao, 'C'),1,10)	cd_medico 
from 	prescr_procedimento a, 
		exame_laboratorio b, 
		prescr_proc_etapa c 
where 	a.nr_seq_exame = b.nr_seq_exame 
and		a.nr_prescricao = c.nr_prescricao 
and		a.nr_sequencia = c.nr_seq_prescricao 
and 	c.ie_etapa = 15 

union all
 
select 	1 ie_tipo, 
		trunc(c.dt_atualizacao) dt_atualizacao, 
		0 count1, 
		1 count2, 
		0 count3, 
		0 count4, 
		0 count5, 
		0 count6, 
		0 count7, 
		b.nr_seq_grupo nr_seq_grupo, 
		substr(obter_desc_grupo_exame_lab(b.nr_seq_grupo),1,30) ds_grupo_exame, 
		0 nr_seq_exame, 
		null nm_exame, 
		substr(obter_setor_prescr_entrega(a.nr_prescricao, 'C'),1,10) cd_setor_atendimento, 
		substr(obter_tipo_atend_prescr(a.nr_prescricao), 1, 5) ie_tipo_atendimento, 
		substr(obter_medico_prescricao(a.nr_prescricao, 'C'),1,10)	cd_medico 
from 	prescr_procedimento a, 
		exame_laboratorio b, 
		prescr_proc_etapa c 
where 	a.nr_seq_exame = b.nr_seq_exame 
and		a.nr_prescricao = c.nr_prescricao 
and		a.nr_sequencia = c.nr_seq_prescricao 
and 	c.ie_etapa = 20 

union all
 
select 	2 ie_tipo, 
		trunc(c.dt_atualizacao) dt_atualizacao, 
		0 count1, 
		1 count2, 
		0 count3, 
		0 count4, 
		0 count5, 
		0 count6, 
		0 count7, 
		0 nr_seq_grupo, 
		null ds_grupo_exame, 
		b.nr_seq_exame nr_seq_exame, 
		substr(b.nm_exame,1,30) nm_exame, 
		substr(obter_setor_prescr_entrega(a.nr_prescricao, 'C'),1,10) cd_setor_atendimento, 
		substr(obter_tipo_atend_prescr(a.nr_prescricao), 1, 5) ie_tipo_atendimento, 
		substr(obter_medico_prescricao(a.nr_prescricao, 'C'),1,10)	cd_medico 
from 	prescr_procedimento a, 
		exame_laboratorio b, 
		prescr_proc_etapa c 
where 	a.nr_seq_exame = b.nr_seq_exame 
and		a.nr_prescricao = c.nr_prescricao 
and		a.nr_sequencia = c.nr_seq_prescricao 
and 	c.ie_etapa = 20 

union all
 
select 	1 ie_tipo, 
		trunc(c.dt_atualizacao) dt_atualizacao, 
		0 count1, 
		0 count2, 
		1 count3, 
		0 count4, 
		0 count5, 
		0 count6, 
		0 count7, 
		b.nr_seq_grupo nr_seq_grupo, 
		substr(obter_desc_grupo_exame_lab(b.nr_seq_grupo),1,30) ds_grupo_exame, 
		0 nr_seq_exame, 
		null nm_exame, 
		substr(obter_setor_prescr_entrega(a.nr_prescricao, 'C'),1,10) cd_setor_atendimento, 
		substr(obter_tipo_atend_prescr(a.nr_prescricao), 1, 5) ie_tipo_atendimento, 
		substr(obter_medico_prescricao(a.nr_prescricao, 'C'),1,10)	cd_medico 
from 	prescr_procedimento a, 
		exame_laboratorio b, 
		prescr_proc_etapa c 
where 	a.nr_seq_exame = b.nr_seq_exame 
and		a.nr_prescricao = c.nr_prescricao 
and		a.nr_sequencia = c.nr_seq_prescricao 
and 	c.ie_etapa = 25 

union all
 
select 	2 ie_tipo, 
		trunc(c.dt_atualizacao) dt_atualizacao, 
		0 count1, 
		0 count2, 
		1 count3, 
		0 count4, 
		0 count5, 
		0 count6, 
		0 count7, 
		0 nr_seq_grupo, 
		null ds_grupo_exame, 
		b.nr_seq_exame nr_seq_exame, 
		substr(b.nm_exame,1,30) nm_exame, 
		substr(obter_setor_prescr_entrega(a.nr_prescricao, 'C'),1,10) cd_setor_atendimento, 
		substr(obter_tipo_atend_prescr(a.nr_prescricao), 1, 5) ie_tipo_atendimento, 
		substr(obter_medico_prescricao(a.nr_prescricao, 'C'),1,10)	cd_medico 
from 	prescr_procedimento a, 
		exame_laboratorio b, 
		prescr_proc_etapa c 
where 	a.nr_seq_exame = b.nr_seq_exame 
and		a.nr_prescricao = c.nr_prescricao 
and		a.nr_sequencia = c.nr_seq_prescricao 
and 	c.ie_etapa = 25 

union all
 
select 	1 ie_tipo, 
		trunc(c.dt_atualizacao) dt_atualizacao, 
		0 count1, 
		0 count2, 
		0 count3, 
		1 count4, 
		0 count5, 
		0 count6, 
		0 count7, 
		b.nr_seq_grupo nr_seq_grupo, 
		substr(obter_desc_grupo_exame_lab(b.nr_seq_grupo),1,30) ds_grupo_exame, 
		0 nr_seq_exame, 
		null nm_exame, 
		substr(obter_setor_prescr_entrega(a.nr_prescricao, 'C'),1,10) cd_setor_atendimento, 
		substr(obter_tipo_atend_prescr(a.nr_prescricao), 1, 5) ie_tipo_atendimento, 
		substr(obter_medico_prescricao(a.nr_prescricao, 'C'),1,10)	cd_medico 
from 	prescr_procedimento a, 
		exame_laboratorio b, 
		prescr_proc_etapa c 
where 	a.nr_seq_exame = b.nr_seq_exame 
and		a.nr_prescricao = c.nr_prescricao 
and		a.nr_sequencia = c.nr_seq_prescricao 
and 	c.ie_etapa = 30 

union all
 
select 	2 ie_tipo, 
		trunc(c.dt_atualizacao) dt_atualizacao, 
		0 count1, 
		0 count2, 
		0 count3, 
		1 count4, 
		0 count5, 
		0 count6, 
		0 count7, 
		0 nr_seq_grupo, 
		null ds_grupo_exame, 
		b.nr_seq_exame nr_seq_exame, 
		substr(b.nm_exame,1,30) nm_exame, 
		substr(obter_setor_prescr_entrega(a.nr_prescricao, 'C'),1,10) cd_setor_atendimento, 
		substr(obter_tipo_atend_prescr(a.nr_prescricao), 1, 5) ie_tipo_atendimento, 
		substr(obter_medico_prescricao(a.nr_prescricao, 'C'),1,10)	cd_medico 
from 	prescr_procedimento a, 
		exame_laboratorio b, 
		prescr_proc_etapa c 
where 	a.nr_seq_exame = b.nr_seq_exame 
and		a.nr_prescricao = c.nr_prescricao 
and		a.nr_sequencia = c.nr_seq_prescricao 
and 	c.ie_etapa = 30 

union all
 
select 	1 ie_tipo, 
		trunc(c.dt_atualizacao) dt_atualizacao, 
		0 count1, 
		0 count2, 
		0 count3, 
		0 count4, 
		1 count5, 
		0 count6, 
		0 count7, 
		b.nr_seq_grupo nr_seq_grupo, 
		substr(obter_desc_grupo_exame_lab(b.nr_seq_grupo),1,30) ds_grupo_exame, 
		0 nr_seq_exame, 
		null nm_exame, 
		substr(obter_setor_prescr_entrega(a.nr_prescricao, 'C'),1,10) cd_setor_atendimento, 
		substr(obter_tipo_atend_prescr(a.nr_prescricao), 1, 5) ie_tipo_atendimento, 
		substr(obter_medico_prescricao(a.nr_prescricao, 'C'),1,10)	cd_medico 
from 	prescr_procedimento a, 
		exame_laboratorio b, 
		prescr_proc_etapa c 
where 	a.nr_seq_exame = b.nr_seq_exame 
and		a.nr_prescricao = c.nr_prescricao 
and		a.nr_sequencia = c.nr_seq_prescricao 
and 	c.ie_etapa = 35 

union all
 
select 	2 ie_tipo, 
		trunc(c.dt_atualizacao) dt_atualizacao, 
		0 count1, 
		0 count2, 
		0 count3, 
		0 count4, 
		1 count5, 
		0 count6, 
		0 count7, 
		0 nr_seq_grupo, 
		null ds_grupo_exame, 
		b.nr_seq_exame nr_seq_exame, 
		substr(b.nm_exame,1,30) nm_exame, 
		substr(obter_setor_prescr_entrega(a.nr_prescricao, 'C'),1,10) cd_setor_atendimento, 
		substr(obter_tipo_atend_prescr(a.nr_prescricao), 1, 5) ie_tipo_atendimento, 
		substr(obter_medico_prescricao(a.nr_prescricao, 'C'),1,10)	cd_medico 
from 	prescr_procedimento a, 
		exame_laboratorio b, 
		prescr_proc_etapa c 
where 	a.nr_seq_exame = b.nr_seq_exame 
and		a.nr_prescricao = c.nr_prescricao 
and		a.nr_sequencia = c.nr_seq_prescricao 
and 	c.ie_etapa = 35 

union all
 
select 	1 ie_tipo, 
		trunc(c.dt_atualizacao) dt_atualizacao, 
		0 count1, 
		0 count2, 
		0 count3, 
		0 count4, 
		0 count5, 
		1 count6, 
		0 count7, 
		b.nr_seq_grupo nr_seq_grupo, 
		substr(obter_desc_grupo_exame_lab(b.nr_seq_grupo),1,30) ds_grupo_exame, 
		0 nr_seq_exame, 
		null nm_exame, 
		substr(obter_setor_prescr_entrega(a.nr_prescricao, 'C'),1,10) cd_setor_atendimento, 
		substr(obter_tipo_atend_prescr(a.nr_prescricao), 1, 5) ie_tipo_atendimento, 
		substr(obter_medico_prescricao(a.nr_prescricao, 'C'),1,10)	cd_medico 
from 	prescr_procedimento a, 
		exame_laboratorio b, 
		prescr_proc_etapa c 
where 	a.nr_seq_exame = b.nr_seq_exame 
and		a.nr_prescricao = c.nr_prescricao 
and		a.nr_sequencia = c.nr_seq_prescricao 
and 	c.ie_etapa = 40 

union all
 
select 	2 ie_tipo, 
		trunc(c.dt_atualizacao) dt_atualizacao, 
		0 count1, 
		0 count2, 
		0 count3, 
		0 count4, 
		0 count5, 
		1 count6, 
		0 count7, 
		0 nr_seq_grupo, 
		null ds_grupo_exame, 
		b.nr_seq_exame nr_seq_exame, 
		substr(b.nm_exame,1,30) nm_exame, 
		substr(obter_setor_prescr_entrega(a.nr_prescricao, 'C'),1,10) cd_setor_atendimento, 
		substr(obter_tipo_atend_prescr(a.nr_prescricao), 1, 5) ie_tipo_atendimento, 
		substr(obter_medico_prescricao(a.nr_prescricao, 'C'),1,10)	cd_medico 
from 	prescr_procedimento a, 
		exame_laboratorio b, 
		prescr_proc_etapa c 
where 	a.nr_seq_exame = b.nr_seq_exame 
and		a.nr_prescricao = c.nr_prescricao 
and		a.nr_sequencia = c.nr_seq_prescricao 
and 	c.ie_etapa = 40 

union all
 
select 	1 ie_tipo, 
		trunc(c.dt_atualizacao) dt_atualizacao, 
		0 count1, 
		0 count2, 
		0 count3, 
		0 count4, 
		0 count5, 
		0 count6, 
		1 count7, 
		b.nr_seq_grupo nr_seq_grupo, 
		substr(obter_desc_grupo_exame_lab(b.nr_seq_grupo),1,30) ds_grupo_exame, 
		0 nr_seq_exame, 
		null nm_exame, 
		substr(obter_setor_prescr_entrega(a.nr_prescricao, 'C'),1,10) cd_setor_atendimento, 
		substr(obter_tipo_atend_prescr(a.nr_prescricao), 1, 5) ie_tipo_atendimento, 
		substr(obter_medico_prescricao(a.nr_prescricao, 'C'),1,10)	cd_medico 
from 	prescr_procedimento a, 
		exame_laboratorio b, 
		prescr_proc_etapa c 
where 	a.nr_seq_exame = b.nr_seq_exame 
and		a.nr_prescricao = c.nr_prescricao 
and		a.nr_sequencia = c.nr_seq_prescricao 
and 	c.ie_etapa = 45 

union all
 
select 	2 ie_tipo, 
		trunc(c.dt_atualizacao) dt_atualizacao, 
		0 count1, 
		0 count2, 
		0 count3, 
		0 count4, 
		0 count5, 
		0 count6, 
		1 count7, 
		0 nr_seq_grupo, 
		null ds_grupo_exame, 
		b.nr_seq_exame nr_seq_exame, 
		substr(b.nm_exame,1,30) nm_exame, 
		substr(obter_setor_prescr_entrega(a.nr_prescricao, 'C'),1,10) cd_setor_atendimento, 
		substr(obter_tipo_atend_prescr(a.nr_prescricao), 1, 5) ie_tipo_atendimento, 
		substr(obter_medico_prescricao(a.nr_prescricao, 'C'),1,10)	cd_medico 
from 	prescr_procedimento a, 
		exame_laboratorio b, 
		prescr_proc_etapa c 
where 	a.nr_seq_exame = b.nr_seq_exame 
and		a.nr_prescricao = c.nr_prescricao 
and		a.nr_sequencia = c.nr_seq_prescricao 
and 	c.ie_etapa = 45;

