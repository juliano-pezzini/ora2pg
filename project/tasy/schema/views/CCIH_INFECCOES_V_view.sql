-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ccih_infeccoes_v (nr_atendimento, dt_infeccao, nm_paciente, ds_diagnostico, ds_clinica, ds_topografia, cd_topografia, nm_guerra, espec_medico, ie_ordem_ss, cd_medico_executor, cd_clinica_medico, cd_clinica_proc, cd_tipo_cirurgia, dt_cancelamento, ds_observacao) AS select	c.nr_atendimento,
	e.dt_infeccao, 
	obter_nome_pessoa_fisica(f.cd_pessoa_fisica,'') nm_paciente, 
	coalesce(a.ds_cirurgia,c.ds_diagnostico_int) ds_diagnostico, 
	d.ds_clinica, 
	y.ds_topografia, 
	y.cd_topografia, 
	obter_nome_medico(coalesce(a.cd_medico_cirurgiao,c.cd_medico),'G') nm_guerra, 
	k.ds_clinica espec_medico, 
	d.ie_ordem_ss, 
	coalesce(a.cd_medico_cirurgiao,c.cd_medico) cd_medico_executor, 
	k.cd_clinica cd_clinica_medico, 
	d.cd_clinica cd_clinica_proc, 
	b.cd_tipo_cirurgia, 
	c.dt_cancelamento, 
	e.ds_observacao 
FROM cih_topografia y, cih_clinica k, cih_caso_infeccao g, atendimento_paciente f, cih_local_infeccao e, cih_clinica d, cih_cirurgia a
LEFT OUTER JOIN cih_tipo_cirurgia b ON (a.cd_tipo_cirurgia = b.cd_tipo_cirurgia)
, cih_ficha_ocorrencia c
LEFT OUTER JOIN cih_cirurgia a ON (c.nr_ficha_ocorrencia = a.nr_ficha_ocorrencia)
, trunc(c
LEFT OUTER JOIN trunc(a ON (trunc(c.dt_ficha) = trunc(a.dt_cirurgia))
WHERE g.cd_caso_infeccao	= e.cd_caso_infeccao and k.cd_clinica		= c.cd_clinica  and y.cd_topografia		= e.cd_topografia and d.cd_clinica		= e.cd_clinica and g.cd_caso_infeccao	= e.cd_caso_infeccao and f.nr_atendimento	= c.nr_atendimento and e.nr_ficha_ocorrencia	= c.nr_ficha_ocorrencia;

