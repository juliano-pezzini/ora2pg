-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_ops_motivos_glosa_v (dt_mes_competencia, cd_estabelecimento, nr_seq_protocolo, nr_seq_conta, nr_seq_conta_proc, nr_seq_conta_mat, nr_seq_prest_solic, nm_prestador_solic, nr_seq_prestador_exec, nm_prestador_exec, nr_seq_motivo_glosa, ds_motivo_glosa, vl_glosa) AS select	pkg_date_utils.start_of(a.dt_mes_competencia, 'MONTH', 0) dt_mes_competencia,
	b.cd_estabelecimento,
	a.nr_sequencia nr_seq_protocolo,
	b.nr_sequencia nr_seq_conta,
	c.nr_sequencia nr_seq_conta_proc,
	null nr_seq_conta_mat,
	b.nr_seq_prestador nr_seq_prest_solic,
	substr(pls_obter_dados_prestador(b.nr_seq_prestador,'N'),1,255) nm_prestador_solic,
	b.nr_seq_prestador_exec,
	substr(pls_obter_dados_prestador(b.nr_seq_prestador_exec,'N'),1,255) nm_prestador_exec,
	d.nr_seq_motivo_glosa,
	substr(tiss_obter_motivo_glosa(d.nr_seq_motivo_glosa,'D'),1,30) ds_motivo_glosa,
	c.vl_glosa
FROM	pls_protocolo_conta a,
	pls_conta b,
	pls_conta_proc c,
	pls_conta_glosa d
where	a.nr_sequencia = b.nr_seq_protocolo
and	b.nr_sequencia = c.nr_seq_conta
and	b.nr_sequencia = d.nr_seq_conta
and	c.nr_sequencia = d.nr_seq_conta_proc

union all

select	pkg_date_utils.start_of(a.dt_mes_competencia, 'MONTH', 0) dt_mes_competencia,
	b.cd_estabelecimento,
	a.nr_sequencia nr_seq_protocolo,
	b.nr_sequencia nr_seq_conta,
	null nr_seq_conta_proc,
	c.nr_sequencia nr_seq_conta_mat,
	b.nr_seq_prestador nr_seq_prest_solic,
	substr(pls_obter_dados_prestador(b.nr_seq_prestador,'N'),1,255) nm_prestador_solic,
	b.nr_seq_prestador_exec,
	substr(pls_obter_dados_prestador(b.nr_seq_prestador_exec,'N'),1,255) nm_prestador_exec,	
	d.nr_seq_motivo_glosa,
	substr(tiss_obter_motivo_glosa(d.nr_seq_motivo_glosa,'D'),1,30) ds_motivo_glosa,
	c.vl_glosa
from	pls_protocolo_conta a,
	pls_conta b,
	pls_conta_mat c,
	pls_conta_glosa d
where	a.nr_sequencia = b.nr_seq_protocolo
and	b.nr_sequencia = c.nr_seq_conta
and	b.nr_sequencia = d.nr_seq_conta
and	c.nr_sequencia = d.nr_seq_conta_mat

union all

select	pkg_date_utils.start_of(a.dt_mes_competencia, 'MONTH', 0) dt_mes_competencia,
	a.cd_estabelecimento,
	a.nr_sequencia nr_seq_protocolo,
	b.nr_sequencia nr_seq_conta,
	null nr_seq_conta_proc,
	null nr_seq_conta_mat,
	b.nr_seq_prestador nr_seq_prest_solic,
	substr(pls_obter_dados_prestador(b.nr_seq_prestador,'N'),1,255) nm_prestador_solic,
	b.nr_seq_prestador_exec,
	substr(pls_obter_dados_prestador(b.nr_seq_prestador_exec,'N'),1,255) nm_prestador_exec,
	d.nr_seq_motivo_glosa,
	substr(tiss_obter_motivo_glosa(d.nr_seq_motivo_glosa,'D'),1,30) ds_motivo_glosa,
	a.vl_glosa
from	pls_protocolo_conta a,
	pls_conta b,
	pls_conta_glosa d
where	a.nr_sequencia = b.nr_seq_protocolo
and	b.nr_sequencia = d.nr_seq_conta
and	d.nr_seq_conta_mat is null
and	d.nr_seq_conta_proc is null;

