-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW cus_agenda_integrada_v (cd_estabelecimento, dt_referencia, cd_centro_controle, qt_distribuicao) AS select	a.cd_estabelecimento,
	trunc(b.dt_agenda,'mm') dt_referencia,
	d.cd_centro_custo cd_centro_controle,
	count(*) qt_distribuicao
FROM	agenda a,
	agenda_consulta b,
	agenda_sala_consulta c,
	setor_atendimento d,
	agenda_integrada_item e
where	a.cd_agenda = b.cd_agenda
and	b.nr_seq_sala = c.nr_sequencia
and	c.cd_setor_atendimento = d.cd_setor_atendimento
and	e.nr_seq_agenda_cons = b.nr_sequencia
group by a.cd_estabelecimento,
	trunc(b.dt_agenda,'mm'),
	d.cd_centro_custo

union

select	a.cd_estabelecimento,
	trunc(b.dt_agenda,'mm') dt_referencia,
	d.cd_centro_custo cd_centro_controle,
	count(*) qt_distribuicao
from	agenda a,
	agenda_paciente b,
	agenda_sala_consulta c,
	setor_atendimento d,
	agenda_integrada_item e
where	a.cd_agenda = b.cd_agenda
and	b.nr_seq_sala = c.nr_sequencia
and	c.cd_setor_atendimento = d.cd_setor_atendimento
and	e.nr_seq_agenda_exame = b.nr_sequencia
group by a.cd_estabelecimento,
	trunc(b.dt_agenda,'mm'),
	d.cd_centro_custo
order by 2;

