-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_paciente_uti_agrup_v (nr_sequencia, dt_referencia, cd_setor_atendimento, dt_atualizacao, nm_usuario, nr_atendimento, ie_sexo, qt_idade, qt_obito, qt_cirurgia_eletiva, qt_cirurgia_urgencia, dt_entrada, dt_saida, qt_min_perm, qt_apache, pr_risco, nm_pessoa_fisica, dt_nascimento, qt_hr_perm, qt_dia_perm, ie_faixa_apache, ie_faixa_risco, ie_faixa_etaria) AS SELECT a.NR_SEQUENCIA,a.DT_REFERENCIA,a.CD_SETOR_ATENDIMENTO,a.DT_ATUALIZACAO,a.NM_USUARIO,a.NR_ATENDIMENTO,a.IE_SEXO,a.QT_IDADE,a.QT_OBITO,a.QT_CIRURGIA_ELETIVA,a.QT_CIRURGIA_URGENCIA,a.DT_ENTRADA,a.DT_SAIDA,a.QT_MIN_PERM,a.QT_APACHE,a.PR_RISCO,
	p.nm_pessoa_fisica, 
	p.dt_nascimento, 
	(qt_min_perm / 60) qt_hr_perm, 
	(qt_min_perm / 1440) qt_dia_perm, 
	CASE WHEN qt_apache IS NULL THEN  'Sem Apache'  ELSE substr(obter_faixa_eis_uti(coalesce(qt_apache,0),'A'),1,10) END  ie_faixa_apache, 
	CASE WHEN pr_risco IS NULL THEN  'Sem Faixa Risco'  ELSE substr(obter_faixa_eis_uti(coalesce(pr_risco,0),'R'),1,10) END  ie_faixa_Risco, 
	CASE WHEN qt_idade IS NULL THEN  'Sem Idade'  ELSE substr(obter_faixa_eis_uti(coalesce(qt_idade,0),'E'),1,10) END  ie_faixa_etaria 
FROM	Pessoa_fisica p, 
	Atendimento_Paciente T, 
	eis_paciente_uti_agrup a 
where	T.cd_pessoa_fisica	= p.cd_pessoa_fisica 
 and	a.nr_atendimento		= T.nr_atendimento;

