-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW envio_reglab_v (cd_tipo_registro, cd_unidade_lb, dt_envio_lb, cd_unidade, dt_envio, cd_paciente_lb, cd_barras_lb, cd_exame_lb, nr_amostra_lb, dt_solic_unidade_lb, cd_pessoa_fisica, nr_prescricao, cd_barras, nr_amostra, cd_procedimento, dt_solic_exame, nr_seq_lote) AS select   distinct
	 '10' cd_tipo_registro,
	 'COD_UNIDADE' cd_unidade_lb,
	 'DATA_ENVIO' dt_envio_lb,
	 null cd_unidade,
	 null dt_envio,
	 null cd_paciente_lb,
	 null cd_barras_lb,
	 null cd_exame_lb,
	 null nr_amostra_lb,
	 null dt_solic_unidade_lb,
	 null cd_pessoa_fisica,
	 null nr_prescricao,
	 null cd_barras,
	 null nr_amostra,
	 null cd_procedimento,
	 null dt_solic_exame,
	 a.nr_sequencia nr_seq_lote
FROM	 lab_lote_result_externo a

union all

select   distinct
	 '15' cd_tipo_registro,
	 null cd_unidade_lb,
	 null dt_envio_lb,
	 coalesce(lab_obter_setor_externo(a.cd_setor_coleta),a.cd_setor_coleta) cd_unidade,
	 to_char(LOCALTIMESTAMP,'yyyy-mm-dd') dt_envio,
 	 null cd_paciente_lb,
	 null cd_barras_lb,
	 null cd_exame_lb,
	 null nr_amostra_lb,
	 null dt_solic_unidade_lb,
	 null cd_pessoa_fisica,
	 null nr_prescricao,
	 null cd_barras,
	 null nr_amostra,
	 null cd_procedimento,
	 null dt_solic_exame,
	 a.nr_seq_lote
from	 lab_lote_result_item a

union all

select   distinct
	 '20' cd_tipo_registro,
	 null cd_unidade_lb,
	 null dt_envio_lb,
	 null cd_unidade,
	 null dt_envio,
	 'COD_PACIENTE' cd_paciente_lb,
	 'COD_BARRAS' cd_barras_lb,
	 'COD_EXAME' cd_exame_lb,
	 'NUM_AMOSTRA' nr_amostra_lb,
	 'DATA_SOLICITACAO_UNIDADE' dt_solic_unidade_lb,
	 null cd_pessoa_fisica,
	 null nr_prescricao,
	 null cd_barras,
	 null nr_amostra,
	 null cd_procedimento,
	 null dt_solic_exame,
	 a.nr_sequencia nr_seq_lote
from	 lab_lote_result_externo a

union 	 all

select	 '25' cd_tipo_registro,
	 null cd_unidade_lb,
	 null dt_envio_lb,
	 null cd_unidade,
	 null dt_envio,
	 null  cd_paciente_lb,
	 null  cd_barras_lb,
	 null  cd_exame_lb,
	 null  nr_amostra_lb,
	 null dt_solic_unidade_lb,
	 a.cd_pessoa_fisica,
	 a.nr_prescricao,
	 e.nr_prescricao cd_barras,
	 c.nr_amostra,
	 d.cd_procedimento,
	 to_char(e.dt_prescricao,'yyyy-mm-dd') dt_solic_exame,
	 a.nr_seq_lote
from     prescr_medica e,
	 prescr_procedimento d,
	 prescr_proc_material c,
	 prescr_proc_mat_item b,
	 lab_lote_result_item a
where	 d.nr_prescricao = a.nr_prescricao
and	 d.nr_sequencia  = a.nr_seq_prescr
and	 e.nr_prescricao  = a.nr_prescricao
and	 b.nr_seq_prescr_proc_mat = c.nr_sequencia
and	 a.nr_seq_prescr = b.nr_seq_prescr
and	 a.nr_prescricao = b.nr_prescricao;

