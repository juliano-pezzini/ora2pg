-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW sus_interf_aih_franca_v (ds_registro, tp_registro, cd_tipo_registro, nr_lote, nr_seq_laudo, dt_geracao, cd_prestador, ds_prestador, cd_cnpj_prestador, cd_paciente, nm_paciente, dt_nascimento, ds_uf_nasc, ie_sexo, nr_rg, nr_cpf, nm_mae, nm_pai, ds_endereco, nr_numero, ds_complemento, ds_bairro, ds_cep, ds_municipio, ds_uf_resid, nr_telefone, cd_municipio_ibge, dt_internacao, nr_prontuario, nm_medico_solic, nr_cpf_medico_solic, nr_crm_medico_solic, nm_medico_resp, nr_cpf_medico_resp, nr_crm_medico_resp, cd_procedimento_solic, ds_procedimento, dt_realizacao, ie_carater_internacao, ds_carater_internacao, cd_especialidade, ds_especialidade, dt_inicio_trat, dt_fim_trat, dt_solic_trat, nr_cartao_sus) AS select 'CABECALHO' ds_registro,
  	1 tp_registro, 
  	'A' cd_tipo_registro, 
  	c.nr_sequencia nr_lote, 
	0 nr_seq_laudo,             
  	LOCALTIMESTAMP dt_geracao, 
	obter_cnes_estab(b.cd_estabelecimento) cd_prestador, 
	upper(substr(obter_razao_social(substr(obter_cgc_estabelecimento(b.cd_estabelecimento),1,14)),1,100)) ds_prestador, 
	substr(obter_cgc_estabelecimento(b.cd_estabelecimento),1,14) cd_cnpj_prestador, 
	null cd_paciente, 
	null nm_paciente, 
	LOCALTIMESTAMP dt_nascimento, 
	null ds_uf_nasc, 
	null ie_sexo, 
	null nr_rg, 
	null nr_cpf, 
	null nm_mae, 
	null nm_pai, 
	null ds_endereco, 
	null nr_numero, 
	null ds_complemento, 
	null ds_bairro, 
	null ds_cep, 
	null ds_municipio, 
	null ds_uf_resid, 
	null nr_telefone, 
	null cd_municipio_ibge, 
	LOCALTIMESTAMP dt_internacao, 
	0 nr_prontuario, 
	null nm_medico_solic, 
	null nr_cpf_medico_solic, 
	null nr_crm_medico_solic, 
	null nm_medico_resp, 
	null nr_cpf_medico_resp, 
	null nr_crm_medico_resp, 
	0 cd_procedimento_solic, 
	null ds_procedimento, 
	LOCALTIMESTAMP dt_realizacao, 
	null ie_carater_internacao, 
	null ds_carater_internacao,	 
	0 cd_especialidade, 
	null ds_especialidade, 
	LOCALTIMESTAMP dt_inicio_trat, 
	LOCALTIMESTAMP dt_fim_trat, 
	LOCALTIMESTAMP dt_solic_trat, 
	'0' nr_cartao_sus 
FROM  	sus_lote_autor	c, 
  	sus_laudo_paciente   	a, 
  	atendimento_paciente  	b 
where  a.nr_atendimento = b.nr_atendimento 
and   c.nr_sequencia = a.nr_seq_lote 

union
 
select	'DADOS' ds_registro, 
	2 tp_registro, 
	'B' cd_tipo_registro, 
	e.nr_sequencia nr_lote, 
	c.nr_seq_interno nr_seq_laudo, 
	LOCALTIMESTAMP	dt_geracao, 
	0	cd_prestador, 
	null	ds_prestador, 
	null	cd_cnpj_prestador,	 
	a.cd_pessoa_fisica cd_paciente, 
	upper(a.nm_pessoa_fisica) nm_paciente, 
	a.dt_nascimento dt_nascimento, 
	upper(substr(obter_compl_pf(a.cd_pessoa_fisica,1,'UF'),1,2)) ds_uf_nasc, 
	upper(a.ie_sexo) ie_sexo, 
	a.nr_identidade nr_rg, 
	a.nr_cpf nr_cpf, 
	upper(substr(obter_compl_pf(a.cd_pessoa_fisica,5,'N'),1,60)) nm_mae, 
	upper(substr(obter_compl_pf(a.cd_pessoa_fisica,4,'N'),1,60)) nm_pai, 
	upper(substr(obter_compl_pf(a.cd_pessoa_fisica,1,'EN'),1,50)) ds_endereco, 
	substr(obter_compl_pf(a.cd_pessoa_fisica,1,'NR'),1,5) nr_numero, 
	upper(substr(obter_compl_pf(a.cd_pessoa_fisica,1,'CO'),1,50)) ds_complemento, 
	upper(substr(obter_compl_pf(a.cd_pessoa_fisica,1,'B'),1,50)) ds_bairro, 
	substr(obter_compl_pf(a.cd_pessoa_fisica,1,'CEP'),1,8) ds_cep, 
	upper(substr(obter_compl_pf(a.cd_pessoa_fisica,1,'CI'),1,20)) ds_municipio, 
	upper(substr(obter_compl_pf(a.cd_pessoa_fisica,1,'UF'),1,2)) ds_uf_resid, 
	substr(obter_compl_pf(a.cd_pessoa_fisica,1,'T'),1,15) nr_telefone, 
	substr(obter_compl_pf(a.cd_pessoa_fisica,1,'CDM'),1,10) cd_municipio_ibge, 
	b.dt_entrada dt_internacao, 
	obter_prontuario_paciente(a.cd_pessoa_fisica) nr_prontuario, 
	upper(substr(obter_nome_medico(c.cd_medico_requisitante,'N'),1,60)) nm_medico_solic, 
	substr(obter_cpf_pessoa_fisica(c.cd_medico_requisitante),1,11) nr_cpf_medico_solic, 
	substr(obter_crm_medico(c.cd_medico_requisitante),1,10) nr_crm_medico_solic, 
	upper(substr(obter_nome_medico(c.cd_medico_responsavel,'N'),1,60)) nm_medico_resp, 
	substr(obter_cpf_pessoa_fisica(c.cd_medico_responsavel),1,11) nr_cpf_medico_resp, 
	substr(obter_crm_medico(c.cd_medico_responsavel),1,10) nr_crm_medico_resp, 
	c.cd_procedimento_solic cd_procedimento_solic, 
	upper(substr(obter_descricao_procedimento(c.cd_procedimento_solic, c.ie_origem_proced),1,100)) ds_procedimento, 
	c.dt_emissao dt_realizacao, 
	b.ie_carater_inter_sus ie_carater_internacao, 
	upper(substr(obter_valor_dominio(802,b.ie_carater_inter_sus),1,50)) ds_carater_internacao,	 
	obter_especialidade_proced(c.cd_procedimento_solic,c.ie_origem_proced)cd_especialidade, 
	upper(substr(obter_descricao_padrao('ESPECIALIDADE_PROC','DS_ESPECIALIDADE', 
obter_especialidade_proced(c.cd_procedimento_solic,c.ie_origem_proced)),1,60)) ds_especialidade, 
	c.dt_inicio_trat dt_inicio_trat, 
	c.dt_fim_trat dt_fim_trat, 
	c.dt_emissao dt_solic_trat, 
	a.nr_cartao_nac_sus nr_cartao_sus 
from	pessoa_fisica 			a, 
	atendimento_paciente 		b, 
	sus_lote_autor     		e, 
	sus_laudo_paciente 			c 
where	a.cd_pessoa_fisica	= b.cd_pessoa_fisica 
and 	b.nr_atendimento  	= c.nr_atendimento 
and 	e.nr_sequencia 	= c.nr_seq_lote 

union
 
select 'RODAPE' ds_registro, 
  	3 tp_registro, 
  	'Z' cd_tipo_registro, 
  	a.nr_sequencia nr_lote, 
	0 nr_seq_laudo,             
  	LOCALTIMESTAMP dt_geracao, 
	0 cd_prestador, 
	null ds_prestador,		 
	null cd_cnpj_prestador, 
	null cd_paciente, 
	null nm_paciente, 
	LOCALTIMESTAMP dt_nascimento, 
	null ds_uf_nasc, 
	null ie_sexo, 
	null nr_rg, 
	null nr_cpf, 
	null nm_mae, 
	null nm_pai, 
	null ds_endereco, 
	null nr_numero, 
	null ds_complemento, 
	null ds_bairro, 
	null ds_cep, 
	null ds_municipio, 
	null ds_uf_resid, 
	null nr_telefone, 
	null cd_municipio_ibge, 
	LOCALTIMESTAMP dt_internacao, 
	0 nr_prontuario, 
	null nm_medico_solic, 
	null nr_cpf_medico_solic, 
	null nr_crm_medico_solic, 
	null nm_medico_resp, 
	null nr_cpf_medico_resp, 
	null nr_crm_medico_resp, 
	0 cd_procedimento_solic, 
	null ds_procedimento, 
	LOCALTIMESTAMP dt_realizacao, 
	null ie_carater_internacao, 
	null ds_carater_internacao,	 
	0 cd_especialidade, 
	null ds_especialidade, 
	LOCALTIMESTAMP dt_inicio_trat, 
	LOCALTIMESTAMP dt_fim_trat, 
	LOCALTIMESTAMP dt_solic_trat, 
	'0' nr_cartao_sus 
from  sus_lote_autor a;

