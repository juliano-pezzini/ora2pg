-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ocupacao_unidade_v (nr_atendimento, dt_entrada_unidade, cd_unidade, cd_unidade_basica, cd_unidade_compl, dt_entrada, nm_pessoa_fisica, cd_setor_atendimento, cd_pessoa_fisica, dt_nascimento, nr_prontuario, ie_status_unidade, ie_sexo, ds_convenio, ds_categoria, cd_paciente_reserva, nm_paciente_reserva, cd_convenio_reserva, nm_convenio_reserva, nm_usuario_reserva, nr_crm, nm_guerra, ie_classe_acomodacao, ie_sexo_paciente, ie_sexo_fixo, ds_status_unidade, ds_observacao, qt_dia_permanencia, ds_clinica, dt_inicio_higienizacao, dt_higienizacao, nr_seq_interno, dt_previsto_alta, dt_alta_medico, nm_usuario_higienizacao, nm_usuario_fim_higienizacao, nr_ramal, ie_temporario, ie_tipo_reserva, cd_tipo_acomodacao, ie_probabilidade_alta, ds_probabilidade, cd_psicologo, ds_ocupacao, nr_agrupamento, qt_peso_maximo, qt_altura_maxima, cd_convenio, qt_tempo_prev_higien, nr_seq_motivo_reserva, ie_acompanhante, ds_plano, nr_seq_apresent, dt_entrada_unid, qt_dia_perman_unid, ds_carater_int_sus, ie_radioterapia, nr_atend_alta, ie_radiacao, ie_interditado_radiacao, ds_tipo_acomodacao, cd_estabelecimento, nm_usuario_intern, nr_seq_perfil, ds_cor_perfil_pep, ds_perfil_pep, cd_motivo_alta_medica, cd_medico_resp, nr_doc_conv_principal, ie_reserva_pa, ie_necessita_isol_reserva, classif, ie_clinica, ds_unidade_atend, qt_dias_prev_interd, ie_permite_visita, cd_motivo_interdicao, dt_aguard_higienizacao, ds_motivo_pausa_leito, ie_boletim_inform, ie_leito_adapt, ie_leito_adaptado, ds_tipo_atendimento, nm_pac_reserva, dt_saida_temporaria, dt_retorno_saida_temporaria, dt_alta, ie_tipo_atendimento, nm_medico_resp_eup, cd_motivo_manutencao, nr_seq_motivo_perm, cd_departamento) AS select 	a.nr_atendimento,/*SE ALTERAR AS RESTICOES DOS SELECT NESSA VIEW, DEVE SER ALTERADO TAMBEM NA VIEW NUTRICAO_OBTER_OCUPACAO_UNIDADE_V.*/

       	a.dt_entrada_unidade,
	(a.cd_unidade_basica || ' ' || a.cd_unidade_compl) cd_unidade,
	a.cd_unidade_basica,
	a.cd_unidade_compl,
	b.dt_entrada,
	e.nm_pessoa_fisica,
	a.cd_setor_atendimento,
	e.cd_pessoa_fisica,
	e.dt_nascimento,
	(select (substr(obter_prontuario_pf(b.cd_estabelecimento,b.cd_pessoa_fisica),1,255))::numeric  ) nr_prontuario,
	CASE WHEN a.ie_status_unidade='L' THEN CASE WHEN obter_se_unidade_bloq(a.nr_seq_interno,a.nr_atendimento)='S' THEN 'R'  ELSE 'L' END   ELSE a.ie_status_unidade END  ie_status_unidade,
	e.ie_sexo,
	(select substr(obter_conv_ocupacao(a.nr_atendimento),1,40) ) ds_convenio,
	(select substr(obter_categoria_convenio(obter_convenio_atendimento(a.nr_atendimento),obter_categoria_atendimento(a.nr_atendimento)),1,40) ) ds_categoria,
	a.cd_paciente_reserva,
	CASE WHEN a.cd_paciente_reserva IS NULL THEN  null  ELSE substr(obter_nome_pf(a.cd_paciente_reserva),1,60) END  nm_paciente_reserva,
	a.cd_convenio_reserva,
	(select substr(obter_nome_convenio(a.cd_convenio_reserva),1,40) ) nm_convenio_reserva,
	nm_usuario_reserva,
	(select substr(obter_crm_medico(d.cd_pessoa_fisica), 1, 255) ) nr_crm,
	d.nm_guerra,
	a.ie_classe_acomodacao,
	a.ie_sexo_paciente,
	a.ie_sexo_fixo,
	e.nm_pessoa_fisica ds_status_unidade,
	a.ds_observacao,
	trunc(LOCALTIMESTAMP - b.dt_entrada, 0) qt_dia_permanencia,
	substr(g.DS_EXPRESSAO,1,80) ds_clinica,
	dt_inicio_higienizacao,
	dt_higienizacao,
	a.nr_seq_interno,
	b.dt_previsto_alta,	
	b.dt_alta_medico,
	a.nm_usuario_higienizacao,
	a.nm_usuario_fim_higienizacao,
	a.nr_ramal,
	a.ie_temporario,
	a.ie_tipo_reserva,
	a.cd_tipo_acomodacao,
	b.ie_probabilidade_alta,
	(select substr(obter_valor_dominio(1267,b.ie_probabilidade_alta),1,40) ) ds_probabilidade,
	b.cd_psicologo,
	a.ds_ocupacao,
	a.nr_agrupamento,
	a.qt_peso_maximo,
	a.qt_altura_maxima,
	(select obter_convenio_atendimento(a.nr_atendimento) ) cd_convenio,
	a.qt_tempo_prev_higien,
	a.nr_seq_motivo_reserva,
	'N' ie_acompanhante,
	(select substr(obter_plano_atendimento(a.nr_atendimento,'D'),1,40) ) ds_plano,
	coalesce(a.nr_seq_apresent,999) nr_seq_apresent,
	substr(obter_tempo_p_ult_setor(a.nr_atendimento, 'DT'),1,20) dt_entrada_unid,
	(select coalesce((obter_tempo_p_ult_setor(a.nr_atendimento, 'QT',a.nr_seq_interno))::numeric , 0) ) qt_dia_perman_unid ,
	(select substr(sus_obter_desc_carater_int(b.ie_carater_inter_sus),1,50) ) ds_carater_int_sus,
	coalesce(a.ie_radioterapia,'N') ie_radioterapia,
	b.nr_atend_alta,
	(select substr(obter_se_atend_radio(a.nr_atendimento),1,1) ) ie_radiacao,
	coalesce(a.ie_interditado_radiacao,'N') ie_interditado_radiacao,
	(select substr(obter_descricao_padrao('TIPO_ACOMODACAO','DS_TIPO_ACOMODACAO', a.cd_tipo_acomodacao),1,200) ) ds_tipo_acomodacao,
	b.cd_estabelecimento,
	(select substr(obter_usuario_prim_internacao(b.NM_USUARIO_INTERN,b.nr_atendimento),1,15) ) NM_USUARIO_INTERN, 
	e.nr_seq_perfil,
	(select substr(obter_cor_pep_perfil_pac(e.nr_seq_perfil),1,90) ) ds_cor_perfil_pep,
	(select substr(obter_desc_pep_perfil_pac(e.nr_seq_perfil),1,90) ) ds_perfil_pep,
	b.cd_motivo_alta_medica,
	b.cd_medico_resp,
	(select OBTER_GUIA_CONVENIO_PRINC2(b.nr_atendimento) ) NR_DOC_CONV_PRINCIPAL,
	(select obter_se_reserva_pa(a.cd_setor_atendimento,a.cd_unidade_basica,a.cd_unidade_compl) ) ie_reserva_pa,
	a.ie_necessita_isol_reserva,
	(select substr(obter_desc_classif_atend(b.nr_seq_classificacao),1,60) ) classif, 
	b.ie_clinica,
	a.ds_unidade_atend,
	a.qt_dias_prev_interd,
	b.ie_permite_visita,
	a.cd_motivo_interdicao,
	a.dt_aguard_higienizacao,
	(select substr(obter_dados_pausa_leito(a.nr_seq_interno, 'D'),1,255) ) ds_motivo_pausa_leito, 
	coalesce(b.ie_boletim_inform,'S') ie_boletim_inform,
	coalesce(a.ie_leito_adaptado, 'N') ie_leito_adapt,
	coalesce(a.ie_leito_adaptado, 'N') ie_leito_adaptado,
	(select substr(OBTER_NOME_TIPO_ATEND(b.ie_tipo_atendimento),1,255) ) ds_tipo_atendimento, 
	coalesce(a.nm_pac_reserva, substr((select obter_pessoa_atendimento(x.nr_atendimento,'N') from unidade_atendimento x where x.nr_seq_interno = a.nr_seq_unid_bloq and a.nr_seq_unid_bloq is not null),1,60)) nm_pac_reserva,
	u.dt_saida_temporaria dt_saida_temporaria,
	u.dt_retorno_saida_temporaria dt_retorno_saida_temporaria,
	b.dt_alta  dt_alta,
	b.ie_tipo_atendimento ie_tipo_atendimento,
	(select substr(Obter_Dados_Atendimento(a.nr_atendimento, 'NMR'), 1, 255) ) nm_medico_resp_eup,
	a.CD_MOTIVO_MANUTENCAO,
	u.nr_seq_motivo_perm,
	u.cd_departamento
FROM atend_paciente_unidade u, pessoa_fisica e, unidade_atendimento a, atendimento_paciente b
LEFT OUTER JOIN medico d ON (b.cd_medico_resp = d.cd_pessoa_fisica)
LEFT OUTER JOIN valor_dominio_v g ON (b.ie_clinica = g.vl_dominio AND 17 = g.cd_dominio AND 'A' = g.ie_situacao)
WHERE a.nr_atendimento      	= b.nr_atendimento and u.nr_atendimento      	= b.nr_atendimento and b.cd_pessoa_fisica    	= e.cd_pessoa_fisica and u.nr_atendimento      	= a.nr_atendimento and u.nr_Seq_interno = (	select 	max(x.nr_seq_interno) 
				from 	atend_paciente_unidade x 
				where 	x.nr_Atendimento = b.nr_Atendimento 
				and	a.cd_Setor_atendimento	= x.cd_setor_Atendimento
				and 	a.cd_unidade_basica	 = x.cd_unidade_basica
				and 	a.cd_unidade_compl	= x.cd_unidade_Compl)  and a.ie_situacao         	= 'A' and a.ie_status_unidade   	= 'P'    
union all

select  a.nr_atendimento_acomp,
	a.dt_entrada_unidade,
	(a.cd_unidade_basica ||' ' || a.cd_unidade_compl) cd_unidade,
	a.cd_unidade_basica,
	a.cd_unidade_compl,
      	b.dt_entrada,
	(select substr(obter_desc_expressao(330453) || ' ' || e.nm_pessoa_fisica,1,60) ),
	a.cd_setor_atendimento,
	e.cd_pessoa_fisica,
	e.dt_nascimento,
	(select (substr(obter_prontuario_pf(b.cd_estabelecimento,b.cd_pessoa_fisica),1,255))::numeric  ) nr_prontuario,
	(select CASE WHEN a.ie_status_unidade='L' THEN  CASE WHEN obter_se_unidade_bloq(a.nr_seq_interno,a.nr_atendimento)='S' THEN 'R'  ELSE 'L' END   ELSE a.ie_status_unidade END  ) ie_status_unidade,
	e.ie_sexo,
	(select substr(obter_conv_ocupacao(a.nr_atendimento),1,40) ) ds_convenio,
	(select substr(obter_categoria_convenio(obter_convenio_atendimento(a.nr_atendimento),obter_categoria_atendimento(a.nr_atendimento)),1,40) ) ds_categoria,
	a.cd_paciente_reserva,
	f.nm_pessoa_fisica nm_paciente_reserva,
	a.cd_convenio_reserva,
	(select substr(obter_nome_convenio(a.cd_convenio_reserva),1,40) ) nm_convenio_reserva,
	nm_usuario_reserva,
	(select substr(obter_crm_medico(d.cd_pessoa_fisica), 1, 255) ) nr_crm,
	d.nm_guerra,
	a.ie_classe_acomodacao,
	a.ie_sexo_paciente,
	a.ie_sexo_fixo,
	(select obter_desc_expressao(302516) ||' '|| e.nm_pessoa_fisica ) ds_status_unidade,
	a.ds_observacao,
	trunc(LOCALTIMESTAMP - b.dt_entrada, 0) qt_dia_permanencia,
	substr(g.DS_EXPRESSAO,1,80) ds_clinica,
	dt_inicio_higienizacao,
	dt_higienizacao,
	a.nr_seq_interno,
	b.dt_previsto_alta,
	b.dt_alta_medico,
	a.nm_usuario_higienizacao,
	a.nm_usuario_fim_higienizacao,
	a.nr_ramal,
	a.ie_temporario,
	a.ie_tipo_reserva,
	a.cd_tipo_acomodacao,
	b.ie_probabilidade_alta,
	(select substr(obter_valor_dominio(1267,b.ie_probabilidade_alta),1,40) ) ds_probabilidade,
	b.cd_psicologo,
	a.ds_ocupacao,
	a.nr_agrupamento,
	a.qt_peso_maximo,         
	a.qt_altura_maxima,
	(select obter_convenio_atendimento(a.nr_atendimento) ) cd_convenio,
	a.qt_tempo_prev_higien,
	a.nr_seq_motivo_reserva,
	'S' ie_acompanhante,
	(select substr(obter_plano_atendimento(a.nr_atendimento,'D'),1,40) ) ds_plano,
	coalesce(a.nr_seq_apresent,999) nr_seq_apresent,
	(select substr(obter_tempo_p_ult_setor(a.nr_atendimento, 'DT'),1,20) ) dt_entrada_unid,
	(select coalesce((obter_tempo_p_ult_setor(a.nr_atendimento, 'QT',a.nr_seq_interno))::numeric , 0) ) qt_dia_perman_unid,
	(select substr(sus_obter_desc_carater_int(b.ie_carater_inter_sus),1,50) ) ds_carater_int_sus,
	coalesce(a.ie_radioterapia,'N') ie_radioterapia,
	b.nr_atend_alta,
	(select substr(obter_se_atend_radio(a.nr_atendimento_acomp),1,1) ) ie_radiacao,
	coalesce(a.ie_interditado_radiacao,'N') ie_interditado_radiacao,
	(select substr(obter_descricao_padrao('TIPO_ACOMODACAO','DS_TIPO_ACOMODACAO', a.cd_tipo_acomodacao),1,200) ) ds_tipo_acomodacao,
	b.cd_estabelecimento,
	(select substr(obter_usuario_prim_internacao(b.NM_USUARIO_INTERN,b.nr_atendimento),1,15) ) NM_USUARIO_INTERN, 
	e.nr_seq_perfil,
	(select substr(obter_cor_pep_perfil_pac(e.nr_seq_perfil),1,90) ) ds_cor_perfil_pep,
	(select substr(obter_desc_pep_perfil_pac(e.nr_seq_perfil),1,90) ) ds_perfil_pep,
	b.cd_motivo_alta_medica,
	b.cd_medico_resp,
	null NR_DOC_CONV_PRINCIPAL,
	(select obter_se_reserva_pa(a.cd_setor_atendimento,a.cd_unidade_basica,a.cd_unidade_compl) ) ie_reserva_pa,
	a.ie_necessita_isol_reserva,
	(select substr(obter_desc_classif_atend(b.nr_seq_classificacao),1,60) ) classif, 
	b.ie_clinica,
	a.ds_unidade_atend,
	a.qt_dias_prev_interd,
	b.ie_permite_visita,
	a.cd_motivo_interdicao,
	a.dt_aguard_higienizacao,
	(select substr(obter_dados_pausa_leito(a.nr_seq_interno, 'D'),1,255) ) ds_motivo_pausa_leito, 
	coalesce(b.ie_boletim_inform,'S') ie_boletim_inform,
	coalesce(a.ie_leito_adaptado, 'N') ie_leito_adapt,
	coalesce(a.ie_leito_adaptado, 'N') ie_leito_adaptado,
	(select substr(OBTER_NOME_TIPO_ATEND(b.ie_tipo_atendimento),1,255) ) ds_tipo_atendimento, 
	coalesce(a.nm_pac_reserva, substr((select obter_pessoa_atendimento(x.nr_atendimento,'N') from unidade_atendimento x where x.nr_seq_interno = a.nr_seq_unid_bloq and a.nr_seq_unid_bloq is not null),1,60)) nm_pac_reserva,
	u.dt_saida_temporaria dt_saida_temporaria,
	u.dt_retorno_saida_temporaria dt_retorno_saida_temporaria,
	b.dt_alta  dt_alta,
	b.ie_tipo_atendimento ie_tipo_atendimento,
	(select substr(Obter_Dados_Atendimento(a.nr_atendimento, 'NMR'), 1, 255) ) nm_medico_resp_eup,
	a.CD_MOTIVO_MANUTENCAO,
	u.nr_seq_motivo_perm,
	u.cd_departamento
FROM atend_paciente_unidade u, valor_dominio_v g, pessoa_fisica f, pessoa_fisica e, unidade_atendimento a, atendimento_paciente b
LEFT OUTER JOIN medico d ON (b.cd_medico_resp = d.cd_pessoa_fisica)
WHERE a.nr_atendimento_acomp	= b.nr_atendimento and b.cd_pessoa_fisica    	= e.cd_pessoa_fisica and u.nr_atendimento      	= b.nr_atendimento  and a.ie_situacao         	= 'A' and a.ie_status_unidade   	= 'M' and a.cd_paciente_reserva = f.cd_pessoa_fisica    and u.nr_seq_interno 	= Obter_Atepacu_paciente(b.nr_atendimento, 'IAA')
 
union all

select  a.nr_atendimento,
        a.dt_entrada_unidade,
        a.cd_unidade_basica || ' ' ||a.cd_unidade_compl cd_unidade,
	a.cd_unidade_basica,
	a.cd_unidade_compl,       
        LOCALTIMESTAMP,
        '',
        a.cd_setor_atendimento,
        (select CASE WHEN a.ie_status_unidade='A' THEN substr(obter_pessoa_atendimento(a.nr_atendimento,'C'),1,60)  ELSE null END   ),
        LOCALTIMESTAMP,
        0,
	CASE WHEN a.ie_status_unidade='L' THEN  CASE WHEN obter_se_unidade_bloq(a.nr_seq_interno,a.nr_atendimento)='S' THEN 'R'  ELSE 'L' END   ELSE a.ie_status_unidade END  ie_status_unidade,
        '',
        '',
	'',
        a.cd_paciente_reserva,
        f.nm_pessoa_fisica nm_paciente_reserva,
	a.cd_convenio_reserva,
	(select substr(obter_nome_convenio(a.cd_convenio_reserva),1,40) ) nm_convenio_reserva,
	nm_usuario_reserva,
        '', '',
	a.ie_classe_acomodacao,
	a.ie_sexo_paciente,
	a.ie_sexo_fixo,
	substr(b.DS_EXPRESSAO,1,80) ds_status_unidade,
	a.ds_observacao,
	0, '',
	dt_inicio_higienizacao,
	dt_higienizacao,
	a.nr_seq_interno,
	null,
	null,
	a.nm_usuario_higienizacao,
	a.nm_usuario_fim_higienizacao,
	a.nr_ramal,
	a.ie_temporario,
	a.ie_tipo_reserva,
	a.cd_tipo_acomodacao,
	'','',
	'',
	a.ds_ocupacao,
	a.nr_agrupamento,
	a.qt_peso_maximo,         
	a.qt_altura_maxima,
	(select obter_convenio_atendimento(a.nr_atendimento) ) cd_convenio,
	a.qt_tempo_prev_higien,
	a.nr_seq_motivo_reserva,
	'N' ie_acompanhante,
	(select substr(obter_plano_atendimento(a.nr_atendimento,'D'),1,40) ) ds_plano,
	coalesce(a.nr_seq_apresent,999) nr_seq_apresent,
	(select substr(obter_tempo_p_ult_setor(a.nr_atendimento, 'DT'),1,20) ) dt_entrada_unid,
	(select coalesce((obter_tempo_p_ult_setor(a.nr_atendimento, 'QT',a.nr_seq_interno))::numeric , 0) ) qt_dia_perman_unid,
	null ds_carater_int_sus,
	coalesce(a.ie_radioterapia,'N') ie_radioterapia,
	null nr_atend_alta,
	(select substr(obter_se_atend_radio(a.nr_atendimento),1,1) ) ie_radiacao,
	coalesce(a.ie_interditado_radiacao,'N') ie_interditado_radiacao,
	(select substr(obter_descricao_padrao('TIPO_ACOMODACAO','DS_TIPO_ACOMODACAO', a.cd_tipo_acomodacao),1,200) ) ds_tipo_acomodacao,
	null cd_estabelecimento,
	null NM_USUARIO_INTERN, 
	f.nr_seq_perfil,
	(select substr(obter_cor_pep_perfil_pac(f.nr_seq_perfil),1,90) ) ds_cor_perfil_pep,
	(select substr(obter_desc_pep_perfil_pac(f.nr_seq_perfil),1,90) ) ds_perfil_pep,
	null,
	null,
	null NR_DOC_CONV_PRINCIPAL,
	(select obter_se_reserva_pa(a.cd_setor_atendimento,a.cd_unidade_basica,a.cd_unidade_compl) ) ie_reserva_pa,
	a.ie_necessita_isol_reserva,
	null,
	null,
	a.ds_unidade_atend,
	a.qt_dias_prev_interd,
	(select substr(Obter_Dados_Atendimento(a.nr_atendimento,'PV'),1,50) ),
	a.cd_motivo_interdicao,
	a.dt_aguard_higienizacao,
	(select substr(obter_dados_pausa_leito(a.nr_seq_interno, 'D'),1,255) ) ds_motivo_pausa_leito, 
	'S' ie_boletim_inform,
	coalesce(a.ie_leito_adaptado, 'N') ie_leito_adapt,
	coalesce(a.ie_leito_adaptado, 'N') ie_leito_adaptado,
	(select substr(OBTER_NOME_TIPO_ATEND(obter_tipo_atendimento(a.nr_atendimento)),1,255) ) ds_tipo_atendimento, 
	coalesce(a.nm_pac_reserva, substr((select obter_pessoa_atendimento(x.nr_atendimento,'N') from unidade_atendimento x where x.nr_seq_interno = a.nr_seq_unid_bloq and a.nr_seq_unid_bloq is not null),1,60)) nm_pac_reserva,
	null dt_saida_temporaria,
	null dt_retorno_saida_temporaria,
	null  dt_alta,
	null ie_tipo_atendimento,
	(select substr(Obter_Dados_Atendimento(a.nr_atendimento, 'NMR'), 1, 255) ) nm_medico_resp_eup,
	a.CD_MOTIVO_MANUTENCAO,
	null nr_seq_motivo_perm,
	null cd_departamento
from  	valor_dominio_v b,
	pessoa_fisica f,
	unidade_atendimento a
where a.cd_paciente_reserva 	= f.cd_pessoa_fisica
and 	a.ie_situacao         	= 'A'
and 	a.ie_status_unidade   	in ('R','H','G','A','E','C','O','D','U')
and 	b.cd_dominio 		= 82
and 	b.vl_dominio		= a.ie_status_unidade

union all

select  a.nr_atendimento,
        a.dt_entrada_unidade,
	a.cd_unidade_basica || ' ' || a.cd_unidade_compl cd_unidade,
	a.cd_unidade_basica,
	a.cd_unidade_compl,       
        LOCALTIMESTAMP,
        '',
        a.cd_setor_atendimento,
        CASE WHEN a.ie_status_unidade='A' THEN  substr(obter_pessoa_atendimento(a.nr_atendimento,'C'),1,60) WHEN a.ie_status_unidade='O' THEN substr(obter_pessoa_atendimento(a.nr_atendimento,'C'),1,60)  ELSE '' END ,
        LOCALTIMESTAMP,
        0,
	CASE WHEN a.ie_status_unidade='L' THEN  CASE WHEN obter_se_unidade_bloq(a.nr_seq_interno,a.nr_atendimento)='S' THEN 'R'  ELSE 'L' END   ELSE a.ie_status_unidade END  ie_status_unidade,
        'X', '','', '', '', 
	a.cd_convenio_reserva,
	(select substr(obter_nome_convenio(a.cd_convenio_reserva),1,40) ) nm_convenio_reserva,
	nm_usuario_reserva,
	'', '',
	a.ie_classe_acomodacao,
	a.ie_sexo_paciente,
	a.ie_sexo_fixo,
	substr(b.DS_EXPRESSAO,1,80) ds_status_unidade,
	a.ds_observacao, 0 , '',
	dt_inicio_higienizacao,
	dt_higienizacao,
	a.nr_seq_interno,
	null,
	null,
	a.nm_usuario_higienizacao,
	a.nm_usuario_fim_higienizacao,
	a.nr_ramal,
	a.ie_temporario,
	a.ie_tipo_reserva,
	a.cd_tipo_acomodacao,
	'','',
	'',
	a.ds_ocupacao,
	a.nr_agrupamento,
	a.qt_peso_maximo,         
	a.qt_altura_maxima,
	(select obter_convenio_atendimento(a.nr_atendimento) ) cd_convenio,
	a.qt_tempo_prev_higien,
	a.nr_seq_motivo_reserva,
	'N' ie_acompanhante,
	(select substr(obter_plano_atendimento(a.nr_atendimento,'D'),1,40) ) ds_plano,
	coalesce(a.nr_seq_apresent,999) nr_seq_apresent,
	(select substr(obter_tempo_p_ult_setor(a.nr_atendimento, 'DT'),1,20) ) dt_entrada_unid,
	(select coalesce((obter_tempo_p_ult_setor(a.nr_atendimento, 'QT',a.nr_seq_interno))::numeric , 0) ) qt_dia_perman_unid,
	null ds_carater_int_sus,
	coalesce(a.ie_radioterapia,'N') ie_radioterapia,
	null nr_atend_alta,
	(select substr(obter_se_atend_radio(a.nr_atendimento),1,1) ) ie_radiacao,
	coalesce(a.ie_interditado_radiacao,'N') ie_interditado_radiacao,
	(select substr(obter_descricao_padrao('TIPO_ACOMODACAO','DS_TIPO_ACOMODACAO', a.cd_tipo_acomodacao),1,200) ) ds_tipo_acomodacao,
	null cd_estabelecimento,
	null NM_USUARIO_INTERN,
	null nr_seq_perfil,
	null ds_cor_perfil_pep,
	null ds_perfil_pep,
	null,
	null,
	null NR_DOC_CONV_PRINCIPAL,
	(select obter_se_reserva_pa(a.cd_setor_atendimento,a.cd_unidade_basica,a.cd_unidade_compl) ) ie_reserva_pa,
	a.ie_necessita_isol_reserva,
	null,
	null,
	a.ds_unidade_atend,
	a.qt_dias_prev_interd,
	(select substr(Obter_Dados_Atendimento(a.nr_atendimento,'PV'),1,50) ),
	a.cd_motivo_interdicao,
	a.dt_aguard_higienizacao,
	(select substr(obter_dados_pausa_leito(a.nr_seq_interno, 'D'),1,255) ) ds_motivo_pausa_leito, 
	'S' ie_boletim_inform,
	coalesce(a.ie_leito_adaptado, 'N') ie_leito_adapt,
	coalesce(a.ie_leito_adaptado, 'N') ie_leito_adaptado,
	(select substr(OBTER_NOME_TIPO_ATEND(obter_tipo_atendimento(a.nr_atendimento)),1,255) ) ds_tipo_atendimento,
	coalesce(a.nm_pac_reserva, substr((select obter_pessoa_atendimento(x.nr_atendimento,'N') from unidade_atendimento x where x.nr_seq_interno = a.nr_seq_unid_bloq and a.nr_seq_unid_bloq is not null),1,60)) nm_pac_reserva,
	null dt_saida_temporaria,
	null dt_retorno_saida_temporaria,
	null  dt_alta,
	null ie_tipo_atendimento,
	(select substr(Obter_Dados_Atendimento(a.nr_atendimento, 'NMR'), 1, 255) ) nm_medico_resp_eup,
	a.CD_MOTIVO_MANUTENCAO,
	null nr_seq_motivo_perm,
	null cd_departamento
from  	valor_dominio_v b,
	unidade_atendimento a
where 	a.ie_situacao 		= 'A'
and 	a.ie_status_unidade 	in ('R','L', 'H', 'G', 'A','O','E','C','D','U')
and 	a.cd_paciente_reserva is null
and 	b.cd_dominio		= 82
and 	b.vl_dominio		= a.ie_status_unidade

union all

select  a.nr_atendimento,
        a.dt_entrada_unidade,
	a.cd_unidade_basica || ' ' || a.cd_unidade_compl cd_unidade,
	a.cd_unidade_basica,
	a.cd_unidade_compl,       
        LOCALTIMESTAMP,
        '',
        a.cd_setor_atendimento,
        '',
        LOCALTIMESTAMP,
        0,
	CASE WHEN a.ie_status_unidade='L' THEN CASE WHEN obter_se_unidade_bloq(a.nr_seq_interno,a.nr_atendimento)='S' THEN 'R'  ELSE 'L' END   ELSE a.ie_status_unidade END  ie_status_unidade,
        'X', '', '',a.cd_paciente_reserva, 
	b.ds_motivo,
	a.cd_convenio_reserva,
	(select substr(obter_nome_convenio(a.cd_convenio_reserva),1,40) ) nm_convenio_reserva,
	nm_usuario_reserva,
	'', '',
	a.ie_classe_acomodacao,
	a.ie_sexo_paciente,
	a.ie_sexo_fixo,
	(select obter_desc_expressao(307834) ) ds_status_unidade,
	a.ds_observacao, 0, '',
	dt_inicio_higienizacao,
	dt_higienizacao,
	a.nr_seq_interno,
	null,
	null,
	a.nm_usuario_higienizacao,
	a.nm_usuario_fim_higienizacao,	
	a.nr_ramal,
	a.ie_temporario,
	a.ie_tipo_reserva,
	a.cd_tipo_acomodacao,
	'','',
	'',
	a.ds_ocupacao,
	a.nr_agrupamento,
	a.qt_peso_maximo,         
	a.qt_altura_maxima,
	(select obter_convenio_atendimento(a.nr_atendimento) ) cd_convenio,
	a.qt_tempo_prev_higien,
	a.nr_seq_motivo_reserva,
	'N' ie_acompanhante,
	(select substr(obter_plano_atendimento(a.nr_atendimento,'D'),1,40) ) ds_plano,
	coalesce(a.nr_seq_apresent,999) nr_seq_apresent,
	(select substr(obter_tempo_p_ult_setor(a.nr_atendimento, 'DT'),1,20) ) dt_entrada_unid,
	(select coalesce((obter_tempo_p_ult_setor(a.nr_atendimento, 'QT',a.nr_seq_interno))::numeric , 0) ) qt_dia_perman_unid,
	null ds_carater_int_sus,
	coalesce(a.ie_radioterapia,'N') ie_radioterapia,
	null nr_atend_alta,
	(select substr(obter_se_atend_radio(a.nr_atendimento),1,1) ) ie_radiacao,
	coalesce(a.ie_interditado_radiacao,'N') ie_interditado_radiacao,
	(select substr(obter_descricao_padrao('TIPO_ACOMODACAO','DS_TIPO_ACOMODACAO', a.cd_tipo_acomodacao),1,200) ) ds_tipo_acomodacao,
	null cd_estabelecimento,
	null NM_USUARIO_INTERN,
	null nr_seq_perfil,
	null ds_cor_perfil_pep,
	null ds_perfil_pep,
	null,
	null,
	null NR_DOC_CONV_PRINCIPAL,
	(select obter_se_reserva_pa(a.cd_setor_atendimento,a.cd_unidade_basica,a.cd_unidade_compl) ) ie_reserva_pa,
	a.ie_necessita_isol_reserva,
	null,
	null,
	a.ds_unidade_atend,
	a.qt_dias_prev_interd,(select substr(Obter_Dados_Atendimento(a.nr_atendimento,'PV'),1,50)  ),
	a.cd_motivo_interdicao,
	a.dt_aguard_higienizacao,
	(select substr(obter_dados_pausa_leito(a.nr_seq_interno, 'D'),1,255) ) ds_motivo_pausa_leito, 
	'S' ie_boletim_inform,
	coalesce(a.ie_leito_adaptado, 'N') ie_leito_adapt,
	coalesce(a.ie_leito_adaptado, 'N') ie_leito_adaptado,
	(select substr(OBTER_NOME_TIPO_ATEND(obter_tipo_atendimento(a.nr_atendimento)),1,255) ) ds_tipo_atendimento, 
	coalesce(a.nm_pac_reserva, substr((select obter_pessoa_atendimento(x.nr_atendimento,'N') from unidade_atendimento x where x.nr_seq_interno = a.nr_seq_unid_bloq and a.nr_seq_unid_bloq is not null),1,60)) nm_pac_reserva,
	null dt_saida_temporaria,
	null dt_retorno_saida_temporaria,
	null  dt_alta,
	null ie_tipo_atendimento,
	(select substr(Obter_Dados_Atendimento(a.nr_atendimento, 'NMR'), 1, 255) ) nm_medico_resp_eup,
	a.CD_MOTIVO_MANUTENCAO,
	null nr_seq_motivo_perm,
	null cd_departamento
FROM motivo_interdicao_leito b, unidade_atendimento a 
WHERE a.ie_status_unidade in ('I','S')  and a.ie_situacao = 'A';

