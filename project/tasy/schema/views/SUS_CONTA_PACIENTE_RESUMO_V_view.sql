-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW sus_conta_paciente_resumo_v (nr_seq_protocolo, nr_atendimento, nr_interno_conta, nr_aih, ie_especialidade_aih, ds_especialidade_aih, vl_custo_operacional, vl_materiais, vl_medico, vl_anestesista, vl_auxiliares, vl_medicos, vl_procedimento, vl_material, vl_repasse_terceiro, vl_sadt_fora_conta, vl_medico_fora_conta, vl_hospital, vl_dif_proced, vl_diferenca, vl_sus, vl_dif_sadt, vl_dif_sus_proc) AS select	a.NR_SEQ_PROTOCOLO,a.NR_ATENDIMENTO,a.NR_INTERNO_CONTA,a.NR_AIH,a.IE_ESPECIALIDADE_AIH,a.DS_ESPECIALIDADE_AIH,a.VL_CUSTO_OPERACIONAL,a.VL_MATERIAIS,a.VL_MEDICO,a.VL_ANESTESISTA,a.VL_AUXILIARES,a.VL_MEDICOS,a.VL_PROCEDIMENTO,a.VL_MATERIAL,a.VL_REPASSE_TERCEIRO,a.VL_SADT_FORA_CONTA,a.VL_MEDICO_FORA_CONTA,a.VL_HOSPITAL,a.VL_DIF_PROCED,
	SUS_Obter_Valor(nr_interno_conta, 0) - 
	(vl_medico_fora_conta + vl_sadt_fora_conta + vl_medicos + vl_hospital) vl_diferenca, 
	SUS_Obter_Valor(nr_interno_conta, 0) vl_sus, 
	sus_obter_dif_sadt(nr_interno_conta) vl_dif_sadt, 
	SUS_Obter_Valor(nr_interno_conta, 0) - vl_procedimento - 
	sus_obter_dif_sadt(nr_interno_conta) vl_dif_sus_proc 
FROM ( 
select	a.nr_seq_protocolo, 
	a.nr_atendimento, 
	a.nr_interno_conta, 
	c.nr_aih, 
	c.ie_especialidade_aih, 
	substr(obter_valor_dominio(805,c.ie_especialidade_aih),1,50) ds_especialidade_aih, 
	sum(b.vl_custo_operacional) vl_custo_operacional, 
	sum(b.vl_materiais) vl_materiais, 
	sum(b.vl_medico) vl_medico, 
	sum(b.vl_anestesista) vl_anestesista, 
	sum(b.vl_auxiliares) vl_auxiliares, 
	sum(b.vl_medico + b.vl_anestesista + b.vl_auxiliares) vl_medicos, 
	sum(b.vl_procedimento) vl_procedimento, 
	sum(b.vl_material) vl_material, 
	sum(b.vl_repasse_terceiro) vl_repasse_terceiro, 
	sum(b.vl_sadt_fora_conta) vl_sadt_fora_conta, 
	sum(b.vl_medico_fora_conta) vl_medico_fora_conta, 
	sum(b.vl_custo_operacional + b.vl_materiais + b.vl_material) vl_hospital, 
	sum(coalesce(vl_procedimento,0) - (coalesce(vl_custo_operacional,0) + coalesce(vl_materiais,0) + 
		coalesce(b.vl_medico,0) + coalesce(b.vl_anestesista,0) + coalesce(b.vl_auxiliares,0) + 
		coalesce(vl_medico_fora_conta,0) + coalesce(vl_sadt_fora_conta,0))) vl_dif_proced 
from	procedimento d, 
	sus_aih c, 
	conta_paciente_resumo b, 
	conta_paciente a 
where	a.nr_interno_conta = b.nr_interno_conta 
 and	a.nr_interno_conta = c.nr_interno_conta 
 and	b.cd_procedimento = d.cd_procedimento 
 and	b.ie_origem_proced = d.ie_origem_proced 
group by a.nr_seq_protocolo, 
	a.nr_atendimento, 
	a.nr_interno_conta, 
	c.nr_aih, 
	c.ie_especialidade_aih, 
	substr(obter_valor_dominio(805,c.ie_especialidade_aih),1,50)) a;

