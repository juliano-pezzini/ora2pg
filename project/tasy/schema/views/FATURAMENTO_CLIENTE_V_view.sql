-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW faturamento_cliente_v (ds_pessoa, cd_cgc, ds_estado, vl_custom, vl_trein, vl_cdu, vl_manut, vl_lut, vl_sup_adicional, vl_versao, vl_impl, vl_outros, integracao, vl_total, vl_repasse, cd_estab, dt_nota, ie_status, cd_cnpj, nr_seq_nf, cd_pf, cd_grupo_proc) AS SELECT   Substr(Obter_nome_pf_pj(a.cd_pessoa_fisica,a.cd_cgc),1,60) ds_pessoa,
         Substr(Obter_cgc_cpf_editado(a.cd_cgc),1,30) cd_cgc,
         Substr(Obter_dados_nota_fiscal(a.nr_sequencia,31),1,40) ds_estado,
         CASE WHEN b.cd_procedimento=69000700 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=79000700 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=29000600 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=19000600 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=59000500 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=99000006 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=49000500 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0))  ELSE 0 END  vl_custom,
         CASE WHEN b.cd_procedimento=69000600 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=29000700 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=99000008 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=21000600 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0))  ELSE 0 END  vl_trein,
         CASE WHEN b.cd_procedimento=69000400 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=79000400 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=21000100 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=99000003 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=59000100 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=29000400 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=19000400 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=49000100 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0))  ELSE 0 END  vl_cdu,
         CASE WHEN b.cd_procedimento=6900700 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=69000100 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=79000100 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=19000200 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=21000200 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=99000002 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=59000300 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=49000700 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=19000200 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=49000300 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=2900020 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0))  ELSE 0 END  vl_manut,
         CASE WHEN b.cd_procedimento=69000500 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=79000500 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=99000005 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=19000300 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=21000400 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=21000500 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=59000200 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=49000200 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=29000300 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=69000855 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0))  ELSE 0 END  vl_lut,
         CASE WHEN b.cd_procedimento=69000750 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=21000650 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0))  ELSE 0 END  vl_sup_adicional,
         CASE WHEN b.cd_procedimento=69000101 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=79000900 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0))  ELSE 0 END  vl_versao,
         CASE WHEN b.cd_procedimento=69000200 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=69000300 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=79000200 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=79000300 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=21000300 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=99000004 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=59000400 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=29000100 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=19000100 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=49000400 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0))  ELSE 0 END   vl_impl,
         CASE WHEN b.cd_procedimento=69000800 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=69000850 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=85000900 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=79000800 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=39000004 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=79000901 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=21000600 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0))  ELSE 0 END  	vl_outros, 
         CASE WHEN b.cd_procedimento=69000701 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=29000500 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=99000007 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=49000600 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=19000500 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) WHEN b.cd_procedimento=21000670 THEN (b.vl_total_item_nf - coalesce(b.vl_desconto,0))  ELSE 0 END  integracao,
         (b.vl_total_item_nf - coalesce(b.vl_desconto,0)) vl_total, 
		(SELECT coalesce(Sum(vl_repasse),0) 
              FROM   nota_fiscal_item_rep r 
              WHERE  r.nr_seq_nf = a.nr_sequencia 
              AND    b.nr_item_nf = r.nr_seq_item_nf) 	vl_repasse,
         a.cd_estabelecimento cd_estab,
         a.dt_emissao dt_nota,
         a.ie_situacao ie_status,
         a.cd_cgc cd_cnpj,
         a.nr_sequencia nr_seq_nf,
         a.cd_pessoa_fisica cd_pf,
	 c.cd_grupo_proc
FROM     nota_fiscal_item B, 
         nota_fiscal A, 
         procedimento C 
WHERE    a.nr_sequencia = b.nr_sequencia 
AND      b.cd_procedimento IS NOT NULL 
AND      c.cd_procedimento = b.cd_procedimento 
AND      c.ie_origem_proced = b.ie_origem_proced;

