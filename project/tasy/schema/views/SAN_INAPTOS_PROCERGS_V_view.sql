-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW san_inaptos_procergs_v (nr_tipo_registro, dt_doacao, dt_impedimento, ie_avaliacao_final, cd_versao, cd_sh, ds_arquivo, dt_geracao, cd_doador, nm_doador, dt_nascimento, nm_mae, ie_sexo, nm_pai, nr_nacionalidade, nr_naturalidade, nr_raca, nr_estado_civil, nr_escolaridade, cd_ocupacao, ds_outra_ocupacao, ds_documento, nr_documento, ds_expedidor_docto, nr_cep, nr_pais, ds_tipo_logradouro, ds_logradouro, ds_numero, ds_complemento, ds_bairro, nr_municipio, nr_telefone1, nr_telefone2, ds_email, dt_triagem, nr_triagem, ie_tipo_doador, ie_tipo_doacao, ie_tipo_coleta, ie_coleta_externa, ie_auto_exclusao, ie_conclusao_triagem, dt_coleta, nr_doacao_visa, nr_doacao_sh, ie_interrupcao_coleta, ie_tipagem_direta, ie_tipagem_reversa, cd_abo_rh, cd_d_fraco, cd_hemoglobina, cd_pai, cd_coombs_direto, dt_exame, cd_exame, nr_amostra, cd_metodo, cd_resultado, cd_inaptidao, nr_sistema_sanguineo, nr_antigeno, nr_anticorpo) AS select	'00' nr_tipo_registro,
	null dt_doacao,
	null dt_impedimento,
	null ie_avaliacao_final,
	rpad(San_obter_dados_integracao('I','V'),4,' ') cd_versao,
	lpad(San_obter_dados_integracao('I','S'),6,'0') cd_sh,
	rpad(San_obter_dados_integracao('I','A'),20,' ') ds_arquivo,
	LOCALTIMESTAMP dt_geracao,
	null cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	null nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	null cd_resultado,
	null cd_inaptidao,
	null nr_sistema_sanguineo,
	null nr_antigeno,
	null nr_anticorpo	


union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '40' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	substr(obter_nome_pf(a.cd_pessoa_fisica),1,60) nm_doador,
	obter_data_nascto_pf(a.cd_pessoa_fisica) dt_nascimento,
	CASE WHEN trim(both obter_nome_mae_pf(a.cd_pessoa_fisica))='' THEN  'SEM INFORMACAO'  ELSE obter_nome_mae_pf(a.cd_pessoa_fisica) END  nm_mae,
	obter_sexo_pf(a.cd_pessoa_fisica, 'C') ie_sexo,
	obter_nome_pai_mae(a.cd_pessoa_fisica, 'P') nm_pai,
	lpad(substr((select max(x.cd_externo)
	from nacionalidade x 
	where x.cd_nacionalidade = obter_dados_pf(a.cd_pessoa_fisica,'NC')),1,5),5,0) nr_nacionalidade,
	lpad(coalesce(obter_cod_ibge_pf(a.cd_pessoa_fisica), Obter_Cod_Municipio_IBGE(c.nr_cep_cidade_nasc)),7,0) nr_naturalidade,
	-- Dominio 2610. Cadastro raca PF

	CASE WHEN sus_obter_raca_sinan(a.cd_pessoa_fisica, 'C')='3' THEN  '10' WHEN sus_obter_raca_sinan(a.cd_pessoa_fisica, 'C')='1' THEN  '20' WHEN sus_obter_raca_sinan(a.cd_pessoa_fisica, 'C')='5' THEN  '30' WHEN sus_obter_raca_sinan(a.cd_pessoa_fisica, 'C')='4' THEN  '40' WHEN sus_obter_raca_sinan(a.cd_pessoa_fisica, 'C')='2' THEN  '50' WHEN sus_obter_raca_sinan(a.cd_pessoa_fisica, 'C')='8' THEN  '99' WHEN sus_obter_raca_sinan(a.cd_pessoa_fisica, 'C')='9' THEN  '99'  ELSE '99' END  nr_raca,
	null nr_estado_civil,  --  70 = Sem Informacao
	CASE WHEN c.IE_GRAU_INSTRUCAO='1' THEN  '10' WHEN c.IE_GRAU_INSTRUCAO='11' THEN  '10' WHEN c.IE_GRAU_INSTRUCAO='2' THEN  '12' WHEN c.IE_GRAU_INSTRUCAO='7' THEN  '13' WHEN c.IE_GRAU_INSTRUCAO='8' THEN  '14' WHEN c.IE_GRAU_INSTRUCAO='3' THEN  '15' WHEN c.IE_GRAU_INSTRUCAO='9' THEN  '16' WHEN c.IE_GRAU_INSTRUCAO='4' THEN  '17' WHEN c.IE_GRAU_INSTRUCAO='5' THEN  '19' WHEN c.IE_GRAU_INSTRUCAO='6' THEN  '20' WHEN c.IE_GRAU_INSTRUCAO='14' THEN  '21'  ELSE '99' END  nr_escolaridade,
	obter_cbo_cargo(obter_cargo_PF(a.cd_pessoa_fisica, 'C')) cd_ocupacao,
	null ds_outra_ocupacao,
	CASE WHEN c.nr_identidade IS NULL THEN  	CASE WHEN c.nr_cnh IS NULL THEN  	CASE WHEN c.nr_ric IS NULL THEN  	CASE WHEN c.nr_ctps IS NULL THEN  	CASE WHEN c.nr_passaporte IS NULL THEN  	CASE WHEN c.nr_cpf IS NULL THEN  999  ELSE 160 END   ELSE 140 END   ELSE 130 END   ELSE 120 END   ELSE 110 END   ELSE 100 END  ds_documento,
	CASE WHEN c.nr_identidade IS NULL THEN  	CASE WHEN c.nr_cnh IS NULL THEN  	CASE WHEN c.nr_ric IS NULL THEN  	CASE WHEN c.nr_ctps IS NULL THEN  	CASE WHEN c.nr_passaporte IS NULL THEN  	CASE WHEN c.nr_cpf IS NULL THEN  c.nr_reg_geral_estrang  ELSE c.nr_cpf END   ELSE c.nr_passaporte END   ELSE c.nr_ctps END   ELSE c.nr_ric END   ELSE c.nr_cnh END   ELSE c.nr_identidade END  nr_documento,
	CASE WHEN c.nr_identidade IS NULL THEN  ''  ELSE c.ds_orgao_emissor_ci END  ds_expedidor_docto,
	lpad(b.cd_cep,8,0) nr_cep,
	san_obter_de_para_integracao('PAIS', b.nr_seq_pais) nr_pais,
	obter_tipo_logradouro_VGS(somente_numero(b.cd_tipo_logradouro)) ds_tipo_logradouro,
	b.ds_endereco ds_logradouro,
	coalesce(b.nr_endereco, b.ds_compl_end) ds_numero,
	b.ds_complemento,
	b.ds_bairro,
	CASE WHEN b.cd_cep IS NULL THEN null  ELSE obter_municipio_ibge(obter_somente_numero(b.cd_cep)) END  nr_municipio,
	lpad(b.NR_DDD_TELEFONE || b.nr_telefone,11,0) nr_telefone1,
	lpad(b.NR_DDD_FONE_ADIC || b.ds_fone_adic,11,0) nr_telefone2,
	b.ds_email ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	null nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	null cd_resultado,
	null cd_inaptidao,
	null nr_sistema_sanguineo,
	null nr_antigeno,
	null nr_anticorpo	
FROM pessoa_fisica c, san_doacao a
LEFT OUTER JOIN compl_pessoa_fisica b ON (a.cd_pessoa_fisica = b.cd_pessoa_fisica AND '1' = b.ie_tipo_complemento)
WHERE a.cd_pessoa_fisica	= c.cd_pessoa_fisica   and ((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))
 
union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '41' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	coalesce(a.dt_triagem,coalesce(dt_triagem_fisica,coalesce(dt_triagem_clinica,a.dt_doacao))) dt_triagem,
	a.nr_sequencia nr_triagem,
	CASE WHEN obter_san_tipo_doador(a.cd_pessoa_fisica, 'T')='P' THEN  '10'  ELSE '20' END  ie_tipo_doador,
	san_obter_de_para_integracao('TD', a.nr_seq_tipo) ie_tipo_doacao,
	CASE WHEN a.ie_tipo_coleta='1' THEN  'AF' WHEN a.ie_tipo_coleta='3' THEN  'AF' WHEN a.ie_tipo_coleta='0' THEN  'ST'  ELSE 'ST' END 	ie_tipo_coleta,
	'N' ie_coleta_externa,
	a.ie_auto_exclusao,
	CASE WHEN obter_se_possui_impedimento(a.nr_sequencia)='N' THEN  'A'  ELSE 'I' END  ie_conclusao_triagem,
	a.dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	' ' ie_tipagem_direta,
	' ' ie_tipagem_reversa,
	CASE WHEN f.ie_tipo_sangue IS NULL THEN  'IND'  ELSE CASE WHEN f.ie_fator_rh IS NULL THEN  'IND'  ELSE limpa_espacos_entre(f.ie_tipo_sangue || f.ie_fator_rh) END  END  cd_abo_rh,
	' ' cd_d_fraco,
	san_result_exame_procergs(a.nr_sequencia, '8') cd_hemoglobina,
	san_result_exame_procergs(a.nr_sequencia, '2') cd_pai,
	' ' cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	null cd_resultado,
	null cd_inaptidao,
	null nr_sistema_sanguineo,
	null nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	pessoa_fisica f
where	a.cd_pessoa_fisica = f.cd_pessoa_fisica
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '42' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	a.dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	c.dt_realizado dt_exame,
	d.cd_exame_integracao cd_exame,
	a.qt_amostra nr_amostra,
	san_obter_de_para_integracao('ME', c.nr_seq_metodo) cd_metodo,
	CASE WHEN e.cd_tipo_resultado=1356 THEN  CASE WHEN upper(c.ds_resultado)='POSITIVO' THEN  'POS' WHEN upper(c.ds_resultado)='NEGATIVO' THEN  'NEG'  ELSE 'INC' END   WHEN e.cd_tipo_resultado=1357 THEN  CASE WHEN upper(Elimina_Acentuacao(c.ds_resultado))='REAGENTE' THEN  'REA' WHEN upper(Elimina_Acentuacao(c.ds_resultado))='NAO REAGENTE' THEN  'NRE'  ELSE 'IND' END   ELSE san_obter_de_para_integracao('RES', f.nr_sequencia) END  cd_resultado,
	null cd_inaptidao,
	null nr_sistema_sanguineo,
	null nr_antigeno,
	null nr_anticorpo
FROM san_exame e, san_exame_integracao d, san_exame_lote b, san_doacao a, san_exame_realizado c
LEFT OUTER JOIN san_exame_valor f ON (c.nr_seq_exame = f.nr_seq_exame AND c.ds_resultado = f.ds_valor)
WHERE a.nr_sequencia	= b.nr_seq_doacao and b.nr_sequencia	= c.nr_seq_exame_lote and c.nr_seq_exame	= e.nr_sequencia and c.nr_seq_exame	= d.nr_seq_exame and d.cd_tipo_integracao = '4'   and c.dt_liberacao is not null and san_obter_se_exame_auxiliar(c.nr_seq_exame_lote, c.nr_seq_exame, wheb_usuario_pck.get_cd_estabelecimento, 'S') = 'S' and ((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))
 
union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '43' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	a.nr_sequencia nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	null nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	null cd_resultado,
	lpad(san_obter_de_para_integracao('IN', b.nr_seq_impedimento),4,0) cd_inaptidao,
	null nr_sistema_sanguineo,
	null nr_antigeno,
	null nr_anticorpo
FROM san_doacao a
LEFT OUTER JOIN san_doacao_impedimento b ON (a.nr_sequencia = b.nr_seq_doacao)
WHERE obter_se_possui_impedimento(nr_sequencia) = 'S' and ((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))
 
union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_d=1 THEN  'POS' WHEN b.ds_d=0 THEN  'NEG' WHEN b.ds_d IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	004 nr_sistema_sanguineo,
	001 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))	

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_c=1 THEN  'POS' WHEN b.ds_c=0 THEN  'NEG' WHEN b.ds_c IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	004 nr_sistema_sanguineo,
	002 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_c_min=1 THEN  'POS' WHEN b.ds_c_min=0 THEN  'NEG' WHEN b.ds_c_min IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	004 nr_sistema_sanguineo,
	004 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_e=1 THEN  'POS' WHEN b.ds_e=0 THEN  'NEG' WHEN b.ds_e IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	004 nr_sistema_sanguineo,
	003 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_e_min=1 THEN  'POS' WHEN b.ds_e_min=0 THEN  'NEG' WHEN b.ds_e_min IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	004 nr_sistema_sanguineo,
	005 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_f_min=1 THEN  'POS' WHEN b.ds_f_min=0 THEN  'NEG' WHEN b.ds_f_min IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	004 nr_sistema_sanguineo,
	006 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_cw=1 THEN  'POS' WHEN b.ds_cw=0 THEN  'NEG' WHEN b.ds_cw IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	004 nr_sistema_sanguineo,
	008 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_k=1 THEN  'POS' WHEN b.ds_k=0 THEN  'NEG' WHEN b.ds_k IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	006 nr_sistema_sanguineo,
	001 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_k_min=1 THEN  'POS' WHEN b.ds_k_min=0 THEN  'NEG' WHEN b.ds_k_min IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	006 nr_sistema_sanguineo,
	002 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_kpa=1 THEN  'POS' WHEN b.ds_kpa=0 THEN  'NEG' WHEN b.ds_kpa IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	006 nr_sistema_sanguineo,
	003 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_kpb=1 THEN  'POS' WHEN b.ds_kpb=0 THEN  'NEG' WHEN b.ds_kpb IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	006 nr_sistema_sanguineo,
	004 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_jsa=1 THEN  'POS' WHEN b.ds_jsa=0 THEN  'NEG' WHEN b.ds_jsa IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	006 nr_sistema_sanguineo,
	006 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_jsb=1 THEN  'POS' WHEN b.ds_jsb=0 THEN  'NEG' WHEN b.ds_jsb IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	006 nr_sistema_sanguineo,
	007 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_fya=1 THEN  'POS' WHEN b.ds_fya=0 THEN  'NEG' WHEN b.ds_fya IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	008 nr_sistema_sanguineo,
	001 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_fyb=1 THEN  'POS' WHEN b.ds_fyb=0 THEN  'NEG' WHEN b.ds_fyb IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	008 nr_sistema_sanguineo,
	002 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_jka=1 THEN  'POS' WHEN b.ds_jka=0 THEN  'NEG' WHEN b.ds_jka IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	009 nr_sistema_sanguineo,
	001 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_jkb=1 THEN  'POS' WHEN b.ds_jkb=0 THEN  'NEG' WHEN b.ds_jkb IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	009 nr_sistema_sanguineo,
	002 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_lea=1 THEN  'POS' WHEN b.ds_lea=0 THEN  'NEG' WHEN b.ds_lea IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	007 nr_sistema_sanguineo,
	001 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_leb=1 THEN  'POS' WHEN b.ds_leb=0 THEN  'NEG' WHEN b.ds_leb IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	007 nr_sistema_sanguineo,
	002 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_p1=1 THEN  'POS' WHEN b.ds_p1=0 THEN  'NEG' WHEN b.ds_p1 IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	003 nr_sistema_sanguineo,
	001 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_m=1 THEN  'POS' WHEN b.ds_m=0 THEN  'NEG' WHEN b.ds_m IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	002 nr_sistema_sanguineo,
	001 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_n=1 THEN  'POS' WHEN b.ds_n=0 THEN  'NEG' WHEN b.ds_n IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	002 nr_sistema_sanguineo,
	002 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_s=1 THEN  'POS' WHEN b.ds_s=0 THEN  'NEG' WHEN b.ds_s IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	002 nr_sistema_sanguineo,
	003 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_s_min=1 THEN  'POS' WHEN b.ds_s_min=0 THEN  'NEG' WHEN b.ds_s_min IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	002 nr_sistema_sanguineo,
	004 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_lua=1 THEN  'POS' WHEN b.ds_lua=0 THEN  'NEG' WHEN b.ds_lua IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	005 nr_sistema_sanguineo,
	001 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_lub=1 THEN  'POS' WHEN b.ds_lub=0 THEN  'NEG' WHEN b.ds_lub IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	005 nr_sistema_sanguineo,
	002 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '44' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN b.ds_dia=1 THEN  'POS' WHEN b.ds_dia=0 THEN  'NEG' WHEN b.ds_dia IS NULL THEN  'INC' END  cd_resultado,
	null cd_inaptidao,
	010 nr_sistema_sanguineo,
	001 nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	san_result_fenotipagem b
where	a.nr_sequencia = b.nr_seq_doacao
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ /*+ INDEX(SAN_EXAME_ANTICORPOS SANEXAN_SANEXRE_FK_I) */ '45' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	CASE WHEN coalesce(d.ie_resultado, 'N')='S' THEN  'POS'  ELSE CASE WHEN coalesce(d.ie_anti_nao_identificado, 'N')='S' THEN  'INC'  ELSE 'NEG' END  END  cd_resultado,
	null cd_inaptidao,
	null nr_sistema_sanguineo,
	null nr_antigeno,
	san_obter_de_para_integracao('AC', d.nr_seq_anticorpo) nr_anticorpo
from	san_doacao a,
	san_exame_lote b,
	san_exame_realizado c,
	san_exame_anticorpos d,
	san_exame e
where	a.nr_sequencia 		= b.nr_seq_doacao
and	b.nr_sequencia 		= c.nr_seq_exame_lote
and	c.nr_seq_exame_lote 	= d.nr_seq_exame_lote
and	c.nr_seq_exame 		= d.nr_seq_exame
and	c.nr_seq_exame 		= e.nr_sequencia
and	c.dt_liberacao is not null
and	e.ie_tipo_exame = 2
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	/*+ INDEX(SAN_DOACAO SANDOAC_I3) */ '46' nr_tipo_registro,
	a.dt_doacao,
	coalesce(san_obter_dt_impedimento(a.nr_sequencia), a.dt_doacao) dt_impedimento,
	a.ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	a.cd_pessoa_fisica cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	a.nr_sequencia nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	CASE WHEN f.ie_tipo_sangue IS NULL THEN  'IND'  ELSE CASE WHEN f.ie_fator_rh IS NULL THEN  'IND'  ELSE limpa_espacos_entre(f.ie_tipo_sangue || f.ie_fator_rh) END  END  cd_abo_rh,
	null cd_d_fraco,
	san_result_exame_procergs(a.nr_sequencia, '8') cd_hemoglobina,
	san_result_exame_procergs(a.nr_sequencia, '2') cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	null cd_resultado,
	null cd_inaptidao,
	null nr_sistema_sanguineo,
	null nr_antigeno,
	null nr_anticorpo
from	san_doacao a,
	pessoa_fisica f
where	a.cd_pessoa_fisica = f.cd_pessoa_fisica
and	((a.ie_avaliacao_final <> 'A') 
	or	((san_obter_se_doador_inapto(a.nr_sequencia, a.cd_pessoa_fisica) = 'S')
		and	obter_param_usuario_logado(450, 501) = 'S'))

union all

select	'99' nr_tipo_registro,
	null dt_doacao,
	null dt_impedimento,
	null ie_avaliacao_final,
	null cd_versao,
	null cd_sh,
	null ds_arquivo,
	null dt_geracao,
	null cd_doador,
	null nm_doador,
	null dt_nascimento,
	null nm_mae,
	null ie_sexo,
	null nm_pai,
	null nr_nacionalidade,
	null nr_naturalidade,
	null nr_raca,
	null nr_estado_civil,
	null nr_escolaridade,
	null cd_ocupacao,
	null ds_outra_ocupacao,
	null ds_documento,
	null nr_documento,
	null ds_expedidor_docto,
	null nr_cep,
	null nr_pais,
	null ds_tipo_logradouro,
	null ds_logradouro,
	null ds_numero,
	null ds_complemento,
	null ds_bairro,
	null nr_municipio,
	null nr_telefone1,
	null nr_telefone2,
	null ds_email,
	null dt_triagem,
	null nr_triagem,
	null ie_tipo_doador,
	null ie_tipo_doacao,
	null ie_tipo_coleta,
	null ie_coleta_externa,
	null ie_auto_exclusao,
	null ie_conclusao_triagem,
	null dt_coleta,
	null nr_doacao_visa,
	null nr_doacao_sh,
	null ie_interrupcao_coleta,
	null ie_tipagem_direta,
	null ie_tipagem_reversa,
	null cd_abo_rh,
	null cd_d_fraco,
	null cd_hemoglobina,
	null cd_pai,
	null cd_coombs_direto,
	null dt_exame,
	null cd_exame,
	null nr_amostra,
	null cd_metodo,
	null cd_resultado,
	null cd_inaptidao,
	null nr_sistema_sanguineo,
	null nr_antigeno,
	null nr_anticorpo
;

