-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_protocolo_conta_v (nr_sequencia, cd_congenere, nr_seq_congenere, dt_protocolo, dt_mes_competencia, dt_lib_pagamento, nr_seq_prot_referencia, nr_seq_periodo_pgto, nr_seq_prestador, ie_tipo_protocolo, ie_status, nr_seq_lote_conta, dt_integracao, ie_tipo_importacao, ie_origem_protocolo, dt_recebimento, cd_versao_tiss, ie_guia_fisica, nr_protocolo_prestador, qt_contas_informadas, vl_cobrado_manual, ie_situacao, cd_estabelecimento, ie_apresentacao, nr_seq_prestador_imp, dt_mes_competencia_trunc, dt_geracao_analise_lote, ie_status_lote, sg_estado, cd_municipio_ibge, ie_tipo_guia, dt_protocolo_imp, nm_usuario_nrec, dt_atualizacao_nrec, nr_seq_segurado_prot, nr_seq_mot_reembolso, ie_tipo_atendimento_reemb) AS select	a.nr_sequencia,
	pls_obter_seq_codigo_coop(a.nr_seq_congenere, null) cd_congenere,
	a.nr_seq_congenere,
	a.dt_protocolo,
	a.dt_mes_competencia,
	a.dt_lib_pagamento,
	a.nr_seq_prot_referencia,
	a.nr_seq_periodo_pgto,
	a.nr_seq_prestador,
	a.ie_tipo_protocolo,
	a.ie_status,
	a.nr_seq_lote_conta,
	a.dt_integracao,
	a.ie_tipo_importacao,
	a.ie_origem_protocolo,
	a.dt_recebimento,
	a.cd_versao_tiss,
	coalesce(a.ie_guia_fisica,'N') ie_guia_fisica,
	a.nr_protocolo_prestador,
	coalesce(a.qt_contas_informadas, 0) qt_contas_informadas,
	coalesce(a.vl_cobrado_manual, 0) vl_cobrado_manual,
	a.ie_situacao,
	a.cd_estabelecimento,
	coalesce(a.ie_apresentacao,'A') ie_apresentacao,
	a.nr_seq_prestador_imp_ref nr_seq_prestador_imp ,
	trunc(a.dt_mes_competencia,'month') dt_mes_competencia_trunc,
	(select	max(b.dt_geracao_analise)
	 FROM	pls_lote_protocolo_conta	b
	 where b.nr_sequencia = a.nr_seq_lote_conta) dt_geracao_analise_lote,
	(select	max(b.ie_status)
	 from	pls_lote_protocolo_conta	b
	 where b.nr_sequencia = a.nr_seq_lote_conta) ie_status_lote,
	 pls_obter_local_prest_prot(a.nr_seq_prestador, 'uf') sg_estado,
	 pls_obter_local_prest_prot(a.nr_seq_prestador, 'cidade_ibge') cd_municipio_ibge,
	ie_tipo_guia,
	dt_protocolo_imp,
	a.nm_usuario_nrec,
	a.dt_atualizacao_nrec,
	a.nr_seq_segurado nr_seq_segurado_prot,
	a.nr_seq_mot_reembolso,
	a.ie_tipo_atendimento ie_tipo_atendimento_reemb
from	pls_protocolo_conta		a;

