-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_receita_despesa_hscs_v (dt_mes, vl_pre_estabelecido, vl_inscricao, vl_nao_coberto, vl_custo_operacional, vl_total_beneficiario, vl_cv, vl_cf, vl_inadimp) AS select	trunc(b.dt_mesano_referencia,'month') dt_mes,
	0 vl_pre_estabelecido,
	sum(coalesce(CASE WHEN a.ie_tipo_item='2' THEN a.vl_item  ELSE 0 END ,0)) vl_inscricao,
	sum(coalesce(CASE WHEN a.ie_tipo_item='13' THEN a.vl_item  ELSE 0 END ,0)) vl_nao_coberto,
	0 vl_custo_operacional,
	0 vl_total_beneficiario,
	0 vl_cv,
	0 vl_cf,
	0 vl_inadimp
FROM	pls_mensalidade_seg_item	a,
	pls_mensalidade_segurado	b,
	pls_mensalidade			c,
	titulo_receber			d
where	a.nr_seq_mensalidade_seg = b.nr_sequencia
and	b.nr_seq_mensalidade	= c.nr_sequencia
and	c.nr_sequencia		= d.nr_seq_mensalidade
and	a.ie_tipo_item in (2,13)
group	by	trunc(b.dt_mesano_referencia,'month')

union

select	trunc(a.dt_emissao,'month') dt_mes,
	0 vl_pre_estabelecido,
	0 vl_inscricao,
	0 vl_nao_coberto,
	0 vl_custo_operacional,
	sum(a.vl_total) vl_total_beneficiario,
	0 vl_cv,
	0 vl_cf,
	0 vl_inadimp
from	pls_conta		a,
	pls_protocolo_conta	b,
	pls_plano		c
where	b.nr_sequencia	= a.nr_seq_protocolo
and	a.nr_seq_plano	= c.nr_sequencia
and	c.ie_preco in ('3','2')
group	by	trunc(a.dt_emissao,'month')

union

select	trunc(d.dt_referencia,'month') dt_mes,
	max(a.vl_referencia) vl_pre_estabelecido,
	0 vl_inscricao,
	0 vl_nao_coberto,
	0 vl_custo_operacional,
	0 vl_total_beneficiario,
	0 vl_cv,
	0 vl_cf,
	0 vl_inadimp
from 	ctb_mes_ref		d,
	ctb_demo_mes		c,
	ctb_modelo_rubrica	b,
	ctb_demo_rubrica	a
where	a.nr_seq_rubrica	= b.nr_sequencia
and	a.nr_seq_demo		= c.nr_seq_demo
and	a.nr_seq_col		= c.nr_sequencia
and	c.nr_seq_mes_ref	= d.nr_sequencia
and	b.nr_sequencia		= 147
group	by	trunc(d.dt_referencia,'month')

union

select	trunc(d.dt_referencia,'month'),
	0 vl_pre_estabelecido,
	0 vl_inscricao,
	0 vl_nao_coberto,
	max(a.vl_referencia) vl_custo_operacional,
	0 vl_total_beneficiario,
	0 vl_cv,
	0 vl_cf,
	0 vl_inadimp
from 	ctb_mes_ref		d,
	ctb_demo_mes		c,
	ctb_modelo_rubrica	b,
	ctb_demo_rubrica	a
where	a.nr_seq_rubrica	= b.nr_sequencia
and	a.nr_seq_demo		= c.nr_seq_demo
and	a.nr_seq_col		= c.nr_sequencia
and	c.nr_seq_mes_ref	= d.nr_sequencia
and	b.nr_sequencia		= 146
group	by	trunc(d.dt_referencia,'month')

union

select	trunc(d.dt_referencia,'month'),
	0 vl_pre_estabelecido,
	0 vl_inscricao,
	0 vl_nao_coberto,
	0 vl_custo_operacional,
	0 vl_total_beneficiario,
	max(a.vl_referencia) vl_cv,
	0 vl_cf,
	0 vl_inadimp
from 	ctb_mes_ref		d,
	ctb_demo_mes		c,
	ctb_modelo_rubrica	b,
	ctb_demo_rubrica	a
where	a.nr_seq_rubrica	= b.nr_sequencia
and	a.nr_seq_demo		= c.nr_seq_demo
and	a.nr_seq_col		= c.nr_sequencia
and	c.nr_seq_mes_ref	= d.nr_sequencia
and	b.nr_sequencia		= 154
group	by	trunc(d.dt_referencia,'month')

union

select	trunc(d.dt_referencia,'month'),
	0 vl_pre_estabelecido,
	0 vl_inscricao,
	0 vl_nao_coberto,
	0 vl_custo_operacional,
	0 vl_total_beneficiario,
	0 vl_cv,
	max(a.vl_referencia) vl_cf,
	0 vl_inadimp
from 	ctb_mes_ref		d,
	ctb_demo_mes		c,
	ctb_modelo_rubrica	b,
	ctb_demo_rubrica	a
where	a.nr_seq_rubrica	= b.nr_sequencia
and	a.nr_seq_demo		= c.nr_seq_demo
and	a.nr_seq_col		= c.nr_sequencia
and	c.nr_seq_mes_ref	= d.nr_sequencia
and	b.nr_sequencia		= 136
group	by	trunc(d.dt_referencia,'month')

union

select	trunc(a.dt_referencia,'month'),
	0 vl_pre_estabelecido,
	0 vl_inscricao,
	0 vl_nao_coberto,
	0 vl_custo_operacional,
	0 vl_total_beneficiario,
	0 vl_cv,
	0 vl_cf,
	sum(b.vl_titulo) vl_inadimp
from	pls_mensalidade			a,
	titulo_receber			b
where	a.nr_sequencia		= b.nr_seq_mensalidade
and	((b.dt_liquidacao is null) and (trunc(b.dt_pagamento_previsto,'dd') < LOCALTIMESTAMP))
--and	((trunc(b.dt_liquidacao,'dd') > trunc(b.dt_pagamento_previsto,'dd')) or ((b.dt_liquidacao is null) and (last_day(a.dt_referencia) > trunc(b.dt_pagamento_previsto,'dd'))))
group by	trunc(a.dt_referencia,'month');

