-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW sip_lote_item_assist_visual_v (ie_tipo_visualizacao, ds_uf, sg_uf, ds_item_sip, qt_evento, qt_beneficiario, vl_despesa, cd_classificacao_sip, nr_sequencia, nr_seq_lote, ie_tipo_contratacao, nr_seq_item_sip, nr_seq_superior, ie_segmentacao_sip, ds_segmentacao_sip) AS select	0				ie_tipo_visualizacao,
	a.sg_uf				ds_uf,
	a.sg_uf				sg_uf,
	b.ds_item			ds_item_sip,
	a.qt_evento			qt_evento,
	a.qt_beneficiario		qt_beneficiario,
	a.vl_despesa			vl_despesa,
	a.cd_classificacao_sip		cd_classificacao_sip,
	a.nr_sequencia			nr_sequencia,
	a.nr_seq_lote			nr_seq_lote,
	a.ie_tipo_contratacao		ie_tipo_contratacao,
	a.nr_seq_item_sip		nr_seq_item_sip,
	a.nr_seq_superior		nr_seq_superior,
	a.ie_segmentacao_sip		ie_segmentacao_sip,
	CASE WHEN a.ie_segmentacao_sip=1 THEN 'Ambulatorial' WHEN a.ie_segmentacao_sip=2 THEN 'Hospitalar' WHEN a.ie_segmentacao_sip=3 THEN 'Hospitalar Obstétrica' WHEN a.ie_segmentacao_sip=4 THEN 'Odontológico' END  ds_segmentacao_sip
FROM	sip_lote_item_assistencial	a,
	sip_item_assistencial		b
where	b.nr_sequencia	= a.nr_seq_item_sip

union all

select	1				ie_tipo_visualizacao,
	null				ds_uf,
	null				sg_uf,
	b.ds_item			ds_item_sip,
	coalesce(sum(a.qt_evento),0)		qt_evento,
	coalesce(sum(a.qt_beneficiario),0)	qt_beneficiario,
	coalesce(sum(a.vl_despesa),0)	vl_despesa,
	a.cd_classificacao_sip		cd_classificacao_sip,
	null				nr_sequencia,
	a.nr_seq_lote			nr_seq_lote,
	null				ie_tipo_contratacao,
	nr_seq_item_sip			nr_seq_item_sip,
	null				nr_seq_superior,
	null				ie_segmentacao_sip,
	null				ds_segmentacao_sip
from	sip_lote_item_assistencial	a,
	sip_item_assistencial		b
where	b.nr_sequencia	= a.nr_seq_item_sip
group by  a.nr_seq_item_sip, b.ds_item, a.cd_classificacao_sip, a.nr_seq_lote

union all

select	2				ie_tipo_visualizacao,
	null				ds_uf,
	null				sg_uf,
	b.ds_item			ds_item_sip,
	coalesce(sum(a.qt_evento),0)		qt_evento,
	coalesce(sum(a.qt_beneficiario),0)	qt_beneficiario,
	coalesce(sum(a.vl_despesa),0)	vl_despesa,
	a.cd_classificacao_sip		cd_classificacao_sip,
	null				nr_sequencia,
	a.nr_seq_lote			nr_seq_lote,
	a.ie_tipo_contratacao		ie_tipo_contratacao,
	a.nr_seq_item_sip		nr_seq_item_sip,
	null				nr_seq_superior,
	null				ie_segmentacao_sip,
	null				ds_segmentacao_sip
from	sip_lote_item_assistencial	a,
	sip_item_assistencial		b
where	b.nr_sequencia	= a.nr_seq_item_sip
group by  a.nr_seq_item_sip, b.ds_item, a.cd_classificacao_sip, a.nr_seq_lote, a.ie_tipo_contratacao

union all

select	3				ie_tipo_visualizacao,
	null				ds_uf,
	null				sg_uf,
	b.ds_item			ds_item_sip,
	coalesce(sum(a.qt_evento),0)		qt_evento,
	coalesce(sum(a.qt_beneficiario),0)	qt_beneficiario,
	coalesce(sum(a.vl_despesa),0)	vl_despesa,
	a.cd_classificacao_sip		cd_classificacao_sip,
	null				nr_sequencia,
	a.nr_seq_lote			nr_seq_lote,
	a.ie_tipo_contratacao		ie_tipo_contratacao,
	a.nr_seq_item_sip		nr_seq_item_sip,
	null				nr_seq_superior,
	a.ie_segmentacao_sip		ie_segmentacao_sip,
	null				ds_segmentacao_sip
from	sip_lote_item_assistencial	a,
	sip_item_assistencial		b
where	b.nr_sequencia	= a.nr_seq_item_sip
group by  a.nr_seq_item_sip, b.ds_item, a.cd_classificacao_sip, a.nr_seq_lote, a.ie_tipo_contratacao, a.ie_segmentacao_sip;

