-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ptu_camara_contestacao_v (tp_registro, nr_sequencia, cd_tipo_registro, cd_unimed_destino, cd_unimed_origem, dt_geracao, cd_unimed_cred, nr_id_quest, nr_fatura, dt_venc_fat, vl_tot_fat, vl_tot_contestacao, vl_tot_acordo, tp_arquivo, nr_ver_tra, vl_tot_pago, nr_lote, nr_id_origem, nr_nota, cd_unimed, id_benef, nm_benef, dt_atend, tp_tabela, cd_servico, vl_cobrado, vl_reconhe, vl_acordo, dt_acordo, tp_acordo, cd_motivo_ques, ds_motivo_ques, qt_tot_r522, vl_tot_cob, vl_tot_req, vl_tot_aco, nr_seq_registro, qt_cobrada, ds_servico, nr_seq_a500, vl_cobr_co, vl_reconh_co, vl_acordo_co, vl_cobr_filme, vl_reconh_filme, vl_acordo_filme, vl_cobr_adic_serv, vl_reconh_adic_serv, vl_acordo_adic_serv, vl_cobr_adic_co, vl_reconh_adic_co, vl_acordo_adic_co, vl_cobr_adic_filme, vl_reconh_adic_filme, vl_acordo_adic_filme, nr_documento, dt_venc_doc, ie_conclusao) AS select	1			tp_registro,
	1			nr_sequencia,
	'551'			cd_tipo_registro,
	cd_unimed_destino	cd_unimed_destino,
	cd_unimed_origem	cd_unimed_origem,
	dt_geracao		dt_geracao,
	cd_unimed_credora	cd_unimed_cred,
	nr_sequencia		nr_id_quest,
	to_char(nr_fatura)	nr_fatura,
	dt_venc_fatura		dt_venc_fat,
	replace(replace(campo_mascara(vl_total_fatura,2),',',''),'.','')	vl_tot_fat,
	replace(replace(campo_mascara(vl_total_contestacao,2),',',''),'.','')	vl_tot_contestacao,
	replace(replace(campo_mascara(vl_total_acordo,2),',',''),'.','')	vl_tot_acordo,
	ie_tipo_arquivo		tp_arquivo,
	nr_versao_transacao	nr_ver_tra,
	replace(replace(campo_mascara(vl_total_pago,2),',',''),'.','')		vl_tot_pago,
	null			nr_lote,
	null			nr_id_origem,
	null			nr_nota,
	null			cd_unimed,
	null			id_benef,
	null			nm_benef,
	null			dt_atend,
	null			tp_tabela,
	null			cd_servico,
	null			vl_cobrado,
	null			vl_reconhe,
	null			vl_acordo,
	null			dt_acordo,
	null			tp_acordo,
	null			cd_motivo_ques,
	null			ds_motivo_ques,
	null			qt_tot_r522,
	null			vl_tot_cob,
	null			vl_tot_req,
	null			vl_tot_aco,
	null			nr_seq_registro,
	null			qt_cobrada,
	null			ds_servico,
	null			nr_seq_a500,
	null			vl_cobr_co,
	null			vl_reconh_co,
	null			vl_acordo_co,
	null			vl_cobr_filme,
	null			vl_reconh_filme,
	null			vl_acordo_filme,
	null			vl_cobr_adic_serv,
	null			vl_reconh_adic_serv,
	null			vl_acordo_adic_serv,
	null			vl_cobr_adic_co,
	null			vl_reconh_adic_co,
	null			vl_acordo_adic_co,
	null			vl_cobr_adic_filme,
	null			vl_reconh_adic_filme,
	null			vl_acordo_adic_filme,
	nr_documento		nr_documento,
	dt_venc_doc		dt_venc_doc,
	ie_conclusao		ie_conclusao
FROM	ptu_camara_contestacao

union

select	2			tp_registro,
	2			nr_sequencia,
	'552'			cd_tipo_registro,
	null			cd_unimed_destino,
	null			cd_unimed_origem,
	null			dt_geracao,
	null			cd_unimed_cred,
	a.nr_seq_contestacao	nr_id_quest,
	null			nr_fatura,
	null			dt_venc_fat,
	null			vl_tot_fat,
	null			vl_tot_contestacao,
	null			vl_tot_acordo,
	null			tp_arquivo,
	null			nr_ver_tra,
	null			vl_tot_pago,
	a.nr_lote		nr_lote,
	a.nr_sequencia		nr_id_origem,
	a.nr_nota		nr_nota,
	a.cd_unimed		cd_unimed,
	a.cd_usuario_plano	id_benef,
	a.nm_beneficiario	nm_benef,
	a.dt_atendimento	dt_atend,
	a.ie_tipo_tabela		tp_tabela,
	a.cd_servico		cd_servico,
	replace(replace(campo_mascara(a.vl_cobrado,2),',',''),'.','')		vl_cobrado,
	replace(replace(campo_mascara(a.vl_reconhecido,2),',',''),'.','')	vl_reconhe,
	replace(replace(campo_mascara(a.vl_acordo,2),',',''),'.','')		vl_acordo,
	a.dt_acordo		dt_acordo,
	a.ie_tipo_acordo	tp_acordo,
	null			cd_motivo_ques,
	null			ds_motivo_ques,
	null			qt_tot_r522,
	null			vl_tot_cob,
	null			vl_tot_req,
	null			vl_tot_aco,
	a.nr_sequencia		nr_seq_registro,
	qt_cobrada		qt_cobrada,
	ds_servico		ds_servico,
	nr_seq_a500		nr_seq_a500,
	vl_cobr_co		vl_cobr_co,
	vl_reconh_co		vl_reconh_co,
	vl_acordo_co		vl_acordo_co,
	vl_cobr_filme		vl_cobr_filme,
	vl_reconh_filme		vl_reconh_filme,
	vl_acordo_filme		vl_acordo_filme,
	vl_cobr_adic_serv	vl_cobr_adic_serv,
	vl_reconh_adic_serv	vl_reconh_adic_serv,
	vl_acordo_adic_serv	vl_acordo_adic_serv,
	vl_cobr_adic_co		vl_cobr_adic_co,
	vl_reconh_adic_co	vl_reconh_adic_co,
	vl_acordo_adic_co	vl_acordo_adic_co,
	vl_cobr_adic_filme	vl_cobr_adic_filme,
	vl_reconh_adic_filme	vl_reconh_adic_filme,
	vl_acordo_adic_filme	vl_acordo_adic_filme,
	null			nr_documento,
	null			dt_venc_doc,
	null			ie_conclusao
from	ptu_questionamento a,
	ptu_questionamento_codigo b
where	a.nr_sequencia = b.nr_seq_registro

union

select	3			tp_registro,
	2			nr_sequencia,
	'553'			cd_tipo_registro,
	null			cd_unimed_destino,
	null			cd_unimed_origem,
	null			dt_geracao,
	null			cd_unimed_cred,
	a.nr_seq_contestacao	nr_id_quest,
	null			nr_fatura,
	null			dt_venc_fat,
	null			vl_tot_fat,
	null			vl_tot_contestacao,
	null			vl_tot_acordo,
	null			tp_arquivo,
	null			nr_ver_tra,
	null			vl_tot_pago,
	null			nr_lote,
	null			nr_id_origem,
	a.nr_nota		nr_nota,
	null			cd_unimed,
	null			id_benef,
	null			nm_benef,
	null			dt_atend,
	null			tp_tabela,
	null			cd_servico,
	null			vl_cobrado,
	null			vl_reconhe,
	null			vl_acordo,
	null			dt_acordo,
	null			tp_acordo,
	pls_obter_cd_questionamento(b.nr_seq_mot_questionamento)			cd_motivo_ques,
	substr(pls_obter_desc_contestacao(b.nr_seq_mot_questionamento,null),1,255)	ds_motivo_ques,
	null			qt_tot_r522,
	null			vl_tot_cob,
	null			vl_tot_req,
	null			vl_tot_aco,
	nr_seq_registro		nr_seq_registro,
	null			qt_cobrada,
	null			ds_servico,
	null			nr_seq_a500,
	null			vl_cobr_co,
	null			vl_reconh_co,
	null			vl_acordo_co,
	null			vl_cobr_filme,
	null			vl_reconh_filme,
	null			vl_acordo_filme,
	null			vl_cobr_adic_serv,
	null			vl_reconh_adic_serv,
	null			vl_acordo_adic_serv,
	null			vl_cobr_adic_co,
	null			vl_reconh_adic_co,
	null			vl_acordo_adic_co,
	null			vl_cobr_adic_filme,
	null			vl_reconh_adic_filme,
	null			vl_acordo_adic_filme,
	null			nr_documento,
	null			dt_venc_doc,
	null			ie_conclusao
from	ptu_questionamento a,
	ptu_questionamento_codigo b
where	a.nr_sequencia = b.nr_seq_registro

union

select	4			tp_registro,
	4			nr_sequencia,
	'559'			cd_tipo_registro,
	null			cd_unimed_destino,
	null			cd_unimed_origem,
	null			dt_geracao,
	null			cd_unimed_cred,
	nr_seq_contestacao	nr_id_quest,
	null			nr_fatura,
	null			dt_venc_fat,
	null			vl_tot_fat,
	null			vl_tot_contestacao,
	null			vl_tot_acordo,
	null			tp_arquivo,
	null			nr_ver_tra,
	null			vl_tot_pago,
	null			nr_lote,
	null			nr_id_origem,
	null			nr_nota,
	null			cd_unimed,
	null			id_benef,
	null			nm_benef,
	null			dt_atend,
	null			tp_tabela,
	null			cd_servico,
	null			vl_cobrado,
	null			vl_reconhe,
	null			vl_acordo,
	null			dt_acordo,
	null			tp_acordo,
	null			cd_motivo_ques,
	null			ds_motivo_ques,
	count(nr_sequencia)	qt_tot_r522,
	replace(replace(campo_mascara(sum(vl_cobrado),2),',',''),'.','')	vl_tot_cob,
	replace(replace(campo_mascara(sum(vl_reconhecido),2),',',''),'.','')	vl_tot_req,
	replace(replace(campo_mascara(sum(vl_acordo),2),',',''),'.','')		vl_tot_aco,
	null			nr_seq_registro,
	null			qt_cobrada,
	null			ds_servico,
	null			nr_seq_a500,
	null			vl_cobr_co,
	null			vl_reconh_co,
	null			vl_acordo_co,
	null			vl_cobr_filme,
	null			vl_reconh_filme,
	null			vl_acordo_filme,
	null			vl_cobr_adic_serv,
	null			vl_reconh_adic_serv,
	null			vl_acordo_adic_serv,
	null			vl_cobr_adic_co,
	null			vl_reconh_adic_co,
	null			vl_acordo_adic_co,
	null			vl_cobr_adic_filme,
	null			vl_reconh_adic_filme,
	null			vl_acordo_adic_filme,
	null			nr_documento,
	null			dt_venc_doc,
	null			ie_conclusao
from	ptu_questionamento
group by nr_seq_contestacao;

