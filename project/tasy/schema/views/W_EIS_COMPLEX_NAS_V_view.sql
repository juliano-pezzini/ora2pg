-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW w_eis_complex_nas_v (nr_sequencia, dt_avaliacao, setor, ds_setor_atendimento, ds_item, qt_score, qt_pontuacao, ie_sexo, ds_sexo, ie_faixa_etaria, cd_estabelecimento, ds_estabelecimento, ds_unidade, nm_paciente) AS SELECT DISTINCT
	a.nr_sequencia, 
	TRUNC(a.dt_avaliacao) dt_avaliacao, 
	obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao) setor, 
	obter_nome_setor(obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao)) ds_setor_atendimento, 
	'Monitorização e controles' ds_item, 
	coalesce(a.qt_pontuacao,0) qt_score, 
	CASE WHEN ds_item_1a='S' THEN 4.5  ELSE (CASE WHEN ds_item_1b='S' THEN 12.1  ELSE (CASE WHEN ds_item_1c='S' THEN 19.6  ELSE 0 END ) END ) END  qt_pontuacao, 
	c.ie_sexo ie_sexo, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo, 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) ie_faixa_etaria, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento, 
	Obter_Unidade_Atend_Data(a.nr_atendimento,a.dt_avaliacao) ds_unidade, 
	c.nm_pessoa_fisica nm_paciente 
FROM	escala_nas a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
WHERE	a.nr_atendimento = b.nr_atendimento 
AND	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
AND	a.dt_inativacao IS NULL 

UNION ALL
 
SELECT DISTINCT 
	a.nr_sequencia, 
	TRUNC(a.dt_avaliacao) dt_avaliacao, 
	obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao) setor, 
	obter_nome_setor(obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao)) ds_setor_atendimento, 
	'Investigações laboratoriais: bioquímicas e microbiológicas' ds_item, 
	coalesce(a.qt_pontuacao,0) qt_score, 
	CASE WHEN ds_item_2='S' THEN 4.3  ELSE 0 END  qt_pontuacao, 
	c.ie_sexo ie_sexo, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo, 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) ie_faixa_etaria, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento, 
	Obter_Unidade_Atend_Data(a.nr_atendimento,a.dt_avaliacao) ds_unidade, 
	c.nm_pessoa_fisica nm_paciente 
FROM	escala_nas a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
WHERE	a.nr_atendimento = b.nr_atendimento 
AND	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
AND	a.dt_inativacao IS NULL 

UNION ALL
 
SELECT DISTINCT 
	a.nr_sequencia, 
	TRUNC(a.dt_avaliacao) dt_avaliacao, 
	obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao) setor, 
	obter_nome_setor(obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao)) ds_setor_atendimento, 
	'Medicação, exceto drogas vasativas' ds_item, 
	coalesce(a.qt_pontuacao,0) qt_score, 
	CASE WHEN ds_item_3='S' THEN 5.6  ELSE 0 END  qt_pontuacao, 
	c.ie_sexo ie_sexo, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo, 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) ie_faixa_etaria, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento, 
	Obter_Unidade_Atend_Data(a.nr_atendimento,a.dt_avaliacao) ds_unidade, 
	c.nm_pessoa_fisica nm_paciente 
FROM	escala_nas a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
WHERE	a.nr_atendimento = b.nr_atendimento 
AND	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
AND	a.dt_inativacao IS NULL 

UNION ALL
 
SELECT DISTINCT 
	a.nr_sequencia, 
	TRUNC(a.dt_avaliacao) dt_avaliacao, 
	obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao) setor, 
	obter_nome_setor(obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao)) ds_setor_atendimento, 
	'Procedimentos de higiene' ds_item, 
	coalesce(a.qt_pontuacao,0) qt_score, 
	CASE WHEN ds_item_4a='S' THEN 4.1  ELSE (CASE WHEN ds_item_4b='S' THEN 16.5  ELSE (CASE WHEN ds_item_4c='S' THEN 20  ELSE 0 END ) END ) END  qt_pontuacao, 
	c.ie_sexo ie_sexo, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo, 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) ie_faixa_etaria, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento, 
	Obter_Unidade_Atend_Data(a.nr_atendimento,a.dt_avaliacao) ds_unidade, 
	c.nm_pessoa_fisica nm_paciente 
FROM	escala_nas a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
WHERE	a.nr_atendimento = b.nr_atendimento 
AND	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
AND	a.dt_inativacao IS NULL 

UNION ALL
 
SELECT DISTINCT 
	a.nr_sequencia, 
	TRUNC(a.dt_avaliacao) dt_avaliacao, 
	obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao) setor, 
	obter_nome_setor(obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao)) ds_setor_atendimento, 
	'Cuidados com drenos. Todos (exceto sonda gástrica)' ds_item, 
	coalesce(a.qt_pontuacao,0) qt_score, 
	CASE WHEN ds_item_5='S' THEN 1.8  ELSE 0 END  qt_pontuacao, 
	c.ie_sexo ie_sexo, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo, 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) ie_faixa_etaria, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento, 
	Obter_Unidade_Atend_Data(a.nr_atendimento,a.dt_avaliacao) ds_unidade, 
	c.nm_pessoa_fisica nm_paciente 
FROM	escala_nas a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
WHERE	a.nr_atendimento = b.nr_atendimento 
AND	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
AND	a.dt_inativacao IS NULL 

UNION ALL
 
SELECT DISTINCT 
	a.nr_sequencia, 
	TRUNC(a.dt_avaliacao) dt_avaliacao, 
	obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao) setor, 
	obter_nome_setor(obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao)) ds_setor_atendimento, 
	'Mobilização e posicionamente' ds_item, 
	coalesce(a.qt_pontuacao,0) qt_score, 
	CASE WHEN ds_item_6a='S' THEN 5.5  ELSE (CASE WHEN ds_item_6b='S' THEN 12.4  ELSE (CASE WHEN ds_item_6c='S' THEN 17  ELSE 0 END ) END ) END  qt_pontuacao, 
	c.ie_sexo ie_sexo, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo, 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) ie_faixa_etaria, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento, 
	Obter_Unidade_Atend_Data(a.nr_atendimento,a.dt_avaliacao) ds_unidade, 
	c.nm_pessoa_fisica nm_paciente 
FROM	escala_nas a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
WHERE	a.nr_atendimento = b.nr_atendimento 
AND	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
AND	a.dt_inativacao IS NULL 

UNION ALL
 
SELECT DISTINCT 
	a.nr_sequencia, 
	TRUNC(a.dt_avaliacao) dt_avaliacao, 
	obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao) setor, 
	obter_nome_setor(obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao)) ds_setor_atendimento, 
	'Suporte e cuidados aos familiares e pacientes' ds_item, 
	coalesce(a.qt_pontuacao,0) qt_score, 
	CASE WHEN ds_item_7a='S' THEN 4  ELSE (CASE WHEN ds_item_7b='S' THEN 32  ELSE 0 END ) END  qt_pontuacao, 
	c.ie_sexo ie_sexo, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo, 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) ie_faixa_etaria, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento, 
	Obter_Unidade_Atend_Data(a.nr_atendimento,a.dt_avaliacao) ds_unidade, 
	c.nm_pessoa_fisica nm_paciente 
FROM	escala_nas a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
WHERE	a.nr_atendimento = b.nr_atendimento 
AND	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
AND	a.dt_inativacao IS NULL 

UNION ALL
 
SELECT DISTINCT 
	a.nr_sequencia, 
	TRUNC(a.dt_avaliacao) dt_avaliacao, 
	obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao) setor, 
	obter_nome_setor(obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao)) ds_setor_atendimento, 
	'Tarefas administrativas e gerenciais' ds_item, 
	coalesce(a.qt_pontuacao,0) qt_score, 
	CASE WHEN ds_item_8a='S' THEN 4.2  ELSE (CASE WHEN ds_item_8b='S' THEN 23.2  ELSE (CASE WHEN ds_item_8c='S' THEN 30  ELSE 0 END ) END ) END  qt_pontuacao, 
	c.ie_sexo ie_sexo, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo, 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) ie_faixa_etaria, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento, 
	Obter_Unidade_Atend_Data(a.nr_atendimento,a.dt_avaliacao) ds_unidade, 
	c.nm_pessoa_fisica nm_paciente 
FROM	escala_nas a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
WHERE	a.nr_atendimento = b.nr_atendimento 
AND	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
AND	a.dt_inativacao IS NULL 

UNION ALL
 
SELECT DISTINCT 
	a.nr_sequencia, 
	TRUNC(a.dt_avaliacao) dt_avaliacao, 
	obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao) setor, 
	obter_nome_setor(obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao)) ds_setor_atendimento, 
	'Suporte ventilatório' ds_item, 
	coalesce(a.qt_pontuacao,0) qt_score, 
	(CASE WHEN ds_item_9='S' THEN 1.4  ELSE 0 END  + CASE WHEN ds_item_10='S' THEN 1.8  ELSE 0 END  + CASE WHEN ds_item_11='S' THEN 4.4  ELSE 0 END ) qt_pontuacao, 
	c.ie_sexo ie_sexo, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo, 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) ie_faixa_etaria, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento, 
	Obter_Unidade_Atend_Data(a.nr_atendimento,a.dt_avaliacao) ds_unidade, 
	c.nm_pessoa_fisica nm_paciente 
FROM	escala_nas a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
WHERE	a.nr_atendimento = b.nr_atendimento 
AND	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
AND	a.dt_inativacao IS NULL 

UNION ALL
 
SELECT DISTINCT 
	a.nr_sequencia, 
	TRUNC(a.dt_avaliacao) dt_avaliacao, 
	obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao) setor, 
	obter_nome_setor(obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao)) ds_setor_atendimento, 
	'Suporte cardiovascular' ds_item, 
	coalesce(a.qt_pontuacao,0) qt_score, 
	(CASE WHEN ds_item_12='S' THEN 1.2  ELSE 0 END  + CASE WHEN ds_item_13='S' THEN 2.5  ELSE 0 END  + CASE WHEN ds_item_14='S' THEN 1.7  ELSE 0 END + CASE WHEN ds_item_15='S' THEN 7.1  ELSE 0 END ) qt_pontuacao, 
	c.ie_sexo ie_sexo, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo, 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) ie_faixa_etaria, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento, 
	Obter_Unidade_Atend_Data(a.nr_atendimento,a.dt_avaliacao) ds_unidade, 
	c.nm_pessoa_fisica nm_paciente 
FROM	escala_nas a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
WHERE	a.nr_atendimento = b.nr_atendimento 
AND	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
AND	a.dt_inativacao IS NULL 

UNION ALL
 
SELECT DISTINCT 
	a.nr_sequencia, 
	TRUNC(a.dt_avaliacao) dt_avaliacao, 
	obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao) setor, 
	obter_nome_setor(obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao)) ds_setor_atendimento, 
	'Suporte renal' ds_item, 
	coalesce(a.qt_pontuacao,0) qt_score, 
	(CASE WHEN ds_item_16='S' THEN 7.7  ELSE 0 END  + CASE WHEN ds_item_17='S' THEN 7  ELSE 0 END ) qt_pontuacao, 
	c.ie_sexo ie_sexo, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo, 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) ie_faixa_etaria, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento, 
	Obter_Unidade_Atend_Data(a.nr_atendimento,a.dt_avaliacao) ds_unidade, 
	c.nm_pessoa_fisica nm_paciente 
FROM	escala_nas a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
WHERE	a.nr_atendimento = b.nr_atendimento 
AND	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
AND	a.dt_inativacao IS NULL 

UNION ALL
 
SELECT DISTINCT 
	a.nr_sequencia, 
	TRUNC(a.dt_avaliacao) dt_avaliacao, 
	obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao) setor, 
	obter_nome_setor(obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao)) ds_setor_atendimento, 
	'Suporte neurológico' ds_item, 
	coalesce(a.qt_pontuacao,0) qt_score, 
	CASE WHEN ds_item_18='S' THEN 1.6  ELSE 0 END  qt_pontuacao, 
	c.ie_sexo ie_sexo, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo, 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) ie_faixa_etaria, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento, 
	Obter_Unidade_Atend_Data(a.nr_atendimento,a.dt_avaliacao) ds_unidade, 
	c.nm_pessoa_fisica nm_paciente 
FROM	escala_nas a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
WHERE	a.nr_atendimento = b.nr_atendimento 
AND	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
AND	a.dt_inativacao IS NULL 

UNION ALL
 
SELECT DISTINCT 
	a.nr_sequencia, 
	TRUNC(a.dt_avaliacao) dt_avaliacao, 
	obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao) setor, 
	obter_nome_setor(obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao)) ds_setor_atendimento, 
	'Suporte metabólico' ds_item, 
	coalesce(a.qt_pontuacao,0) qt_score, 
	(CASE WHEN ds_item_19='S' THEN 1.3  ELSE 0 END  + CASE WHEN ds_item_20='S' THEN 2.8  ELSE 0 END  + CASE WHEN ds_item_21='S' THEN 1.3  ELSE 0 END ) qt_pontuacao, 
	c.ie_sexo ie_sexo, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo, 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) ie_faixa_etaria, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento, 
	Obter_Unidade_Atend_Data(a.nr_atendimento,a.dt_avaliacao) ds_unidade, 
	c.nm_pessoa_fisica nm_paciente 
FROM	escala_nas a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
WHERE	a.nr_atendimento = b.nr_atendimento 
AND	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
AND	a.dt_inativacao IS NULL 

UNION ALL
 
SELECT DISTINCT 
	a.nr_sequencia, 
	TRUNC(a.dt_avaliacao) dt_avaliacao, 
	obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao) setor, 
	obter_nome_setor(obter_setor_atend_data(a.nr_atendimento, a.dt_avaliacao)) ds_setor_atendimento, 
	'Intervenções especiais' ds_item, 
	coalesce(a.qt_pontuacao,0) qt_score, 
	(CASE WHEN ds_item_22='S' THEN 2.8  ELSE 0 END  + CASE WHEN ds_item_23='S' THEN 1.9  ELSE 0 END ) qt_pontuacao, 
	c.ie_sexo ie_sexo, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo, 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) ie_faixa_etaria, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento, 
	Obter_Unidade_Atend_Data(a.nr_atendimento,a.dt_avaliacao) ds_unidade, 
	c.nm_pessoa_fisica nm_paciente 
FROM	escala_nas a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
WHERE	a.nr_atendimento = b.nr_atendimento 
AND	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
AND	a.dt_inativacao IS NULL;

