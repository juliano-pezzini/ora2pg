-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ptu_nota_cobranca_item_v (vl_procedimento, vl_filme, vl_custo_operacional, vl_adic_procedimento, vl_adic_filme, vl_adic_co, qt_procedimento, nr_seq_conta, nr_seq_nota_cobr, nr_seq_fatura, nr_seq_pls_fatura) AS select	sum(vl_procedimento) vl_procedimento,
	sum(vl_filme) vl_filme,
	sum(vl_custo_operacional) vl_custo_operacional,
	sum(vl_adic_procedimento) vl_adic_procedimento,
	sum(vl_adic_filme) vl_adic_filme,
	sum(vl_adic_co) vl_adic_co,
	sum(qt_procedimento) qt_procedimento,
	nr_seq_conta,
	nr_seq_nota_cobr,
	nr_seq_fatura,
	nr_seq_pls_fatura
FROM (	select	sum(coalesce(i.vl_procedimento, 0)) vl_procedimento,
		sum(coalesce(i.vl_filme, 0)) vl_filme,
		sum(coalesce(i.vl_custo_operacional, 0)) vl_custo_operacional,
		sum(coalesce(i.vl_adic_procedimento, 0)) vl_adic_procedimento,
		sum(coalesce(i.vl_adic_filme, 0)) vl_adic_filme,
		sum(coalesce(i.vl_adic_co, 0)) vl_adic_co,
		sum(coalesce(i.qt_procedimento, 1)) qt_procedimento,
		i.nr_seq_conta,
		s.nr_seq_nota_cobr,
		c.nr_seq_fatura,
		f.nr_seq_pls_fatura,
		null nr_seq_nota_cobr_rrs
	from	ptu_nota_servico_item	i,
		ptu_nota_servico	s,
		ptu_nota_cobranca	c,
		ptu_fatura		f
	where	s.nr_sequencia		= i.nr_seq_nota_servico
	and	c.nr_sequencia		= s.nr_seq_nota_cobr
	and	f.nr_sequencia		= c.nr_seq_fatura
	and	f.ie_operacao		= 'E'
	and	f.ie_tipo_arquivo_cob	= '502' -- Serviço
	and	f.nr_seq_pls_fatura is not null
	and	i.nr_seq_conta	is not null
	and	f.ie_status	is null
	group by i.nr_seq_conta,
		s.nr_seq_nota_cobr,
		c.nr_seq_fatura,
		f.nr_seq_pls_fatura
	
union all

	select	sum(coalesce(i.vl_procedimento, 0)) vl_procedimento,
		sum(coalesce(i.vl_filme, 0)) vl_filme,
		sum(coalesce(i.vl_custo_operacional, 0)) vl_custo_operacional,
		sum(coalesce(i.vl_adic_procedimento, 0)) vl_adic_procedimento,
		sum(coalesce(i.vl_adic_filme, 0)) vl_adic_filme,
		sum(coalesce(i.vl_adic_co, 0)) vl_adic_co,
		sum(coalesce(i.qt_procedimento, 1)) qt_procedimento,
		i.nr_seq_conta,
		s.nr_seq_nota_cobr,
		c.nr_seq_fatura,
		f.nr_seq_pls_fatura,
		null nr_seq_nota_cobr_rrs
	from	ptu_nota_servico_proc	i,
		ptu_nota_servico	s,
		ptu_nota_cobranca	c,
		ptu_fatura		f
	where	s.nr_sequencia		= i.nr_seq_nota_servico
	and	c.nr_sequencia		= s.nr_seq_nota_cobr
	and	f.nr_sequencia		= c.nr_seq_fatura
	and	f.ie_operacao		= 'E'
	and	f.ie_tipo_arquivo_cob	= '502' -- Serviço
	and	f.nr_seq_pls_fatura is not null
	and	i.nr_seq_conta	is not null
	and	f.ie_status	is null
	group by i.nr_seq_conta,
		s.nr_seq_nota_cobr,
		c.nr_seq_fatura,
		f.nr_seq_pls_fatura
	
union all

	select	sum(coalesce(i.vl_procedimento, 0)) vl_procedimento,
		sum(coalesce(i.vl_filme, 0)) vl_filme,
		sum(coalesce(i.vl_custo_operacional, 0)) vl_custo_operacional,
		sum(coalesce(i.vl_adic_procedimento, 0)) vl_adic_procedimento,
		sum(coalesce(i.vl_adic_filme, 0)) vl_adic_filme,
		sum(coalesce(i.vl_adic_co, 0)) vl_adic_co,
		sum(coalesce(i.qt_procedimento, 1)) qt_procedimento,
		i.nr_seq_conta,
		s.nr_seq_nota_cobr,
		c.nr_seq_fatura,
		f.nr_seq_pls_fatura,
		null nr_seq_nota_cobr_rrs
	from	ptu_nota_servico_mat	i,
		ptu_nota_servico	s,
		ptu_nota_cobranca	c,
		ptu_fatura		f
	where	s.nr_sequencia		= i.nr_seq_nota_servico
	and	c.nr_sequencia		= s.nr_seq_nota_cobr
	and	f.nr_sequencia		= c.nr_seq_fatura
	and	f.ie_operacao		= 'E'
	and	f.ie_tipo_arquivo_cob	= '502' -- Serviço
	and	f.nr_seq_pls_fatura is not null
	and	i.nr_seq_conta	is not null
	and	f.ie_status	is null
	group by i.nr_seq_conta,
		s.nr_seq_nota_cobr,
		c.nr_seq_fatura,
		f.nr_seq_pls_fatura
	
union all

	select	sum(coalesce(i.vl_procedimento, 0)) vl_procedimento,
		sum(coalesce(i.vl_filme, 0)) vl_filme,
		sum(coalesce(i.vl_custo_operacional, 0)) vl_custo_operacional,
		sum(coalesce(i.vl_adic_procedimento, 0)) vl_adic_procedimento,
		sum(coalesce(i.vl_adic_filme, 0)) vl_adic_filme,
		sum(coalesce(i.vl_adic_co, 0)) vl_adic_co,
		sum(coalesce(i.qt_procedimento, 1)) qt_procedimento,
		i.nr_seq_conta,
		null nr_seq_nota_cobr,
		c.nr_seq_fatura,
		f.nr_seq_pls_fatura,
		s.nr_seq_nota_cobr_rrs
	from	ptu_nota_servico_item	i,
		ptu_nota_servico_rrs	s,
		ptu_nota_cobranca_rrs	c,
		ptu_fatura		f
	where	s.nr_sequencia		= i.nr_seq_nota_servico_rrs
	and	c.nr_sequencia		= s.nr_seq_nota_cobr_rrs
	and	f.nr_sequencia		= c.nr_seq_fatura
	and	f.ie_operacao		= 'E'
	and	f.ie_tipo_arquivo_cob	= '507' -- Reemboslo
	and	f.nr_seq_pls_fatura is not null
	and	i.nr_seq_conta	is not null
	and	f.ie_status	is null
	group by i.nr_seq_conta,
		s.nr_seq_nota_cobr_rrs,
		c.nr_seq_fatura,
		f.nr_seq_pls_fatura
	
union all

	select	sum(coalesce(i.vl_procedimento, 0)) vl_procedimento,
		sum(coalesce(i.vl_filme, 0)) vl_filme,
		sum(coalesce(i.vl_custo_operacional, 0)) vl_custo_operacional,
		sum(coalesce(i.vl_adic_procedimento, 0)) vl_adic_procedimento,
		sum(coalesce(i.vl_adic_filme, 0)) vl_adic_filme,
		sum(coalesce(i.vl_adic_co, 0)) vl_adic_co,
		sum(coalesce(i.qt_procedimento, 1)) qt_procedimento,
		i.nr_seq_conta,
		null nr_seq_nota_cobr,
		c.nr_seq_fatura,
		f.nr_seq_pls_fatura,
		s.nr_seq_nota_cobr_rrs
	from	ptu_nota_servico_proc	i,
		ptu_nota_servico_rrs	s,
		ptu_nota_cobranca_rrs	c,
		ptu_fatura		f
	where	s.nr_sequencia		= i.nr_seq_nota_servico_rrs
	and	c.nr_sequencia		= s.nr_seq_nota_cobr_rrs
	and	f.nr_sequencia		= c.nr_seq_fatura
	and	f.ie_operacao		= 'E'
	and	f.ie_tipo_arquivo_cob	= '507' -- Reemboslo
	and	f.nr_seq_pls_fatura is not null
	and	i.nr_seq_conta	is not null
	and	f.ie_status	is null
	group by i.nr_seq_conta,
		s.nr_seq_nota_cobr_rrs,
		c.nr_seq_fatura,
		f.nr_seq_pls_fatura
	
union all

	select	sum(coalesce(i.vl_procedimento, 0)) vl_procedimento,
		sum(coalesce(i.vl_filme, 0)) vl_filme,
		sum(coalesce(i.vl_custo_operacional, 0)) vl_custo_operacional,
		sum(coalesce(i.vl_adic_procedimento, 0)) vl_adic_procedimento,
		sum(coalesce(i.vl_adic_filme, 0)) vl_adic_filme,
		sum(coalesce(i.vl_adic_co, 0)) vl_adic_co,
		sum(coalesce(i.qt_procedimento, 1)) qt_procedimento,
		i.nr_seq_conta,
		null nr_seq_nota_cobr,
		c.nr_seq_fatura,
		f.nr_seq_pls_fatura,
		s.nr_seq_nota_cobr_rrs
	from	ptu_nota_servico_mat	i,
		ptu_nota_servico_rrs	s,
		ptu_nota_cobranca_rrs	c,
		ptu_fatura		f
	where	s.nr_sequencia		= i.nr_seq_nota_servico_rrs
	and	c.nr_sequencia		= s.nr_seq_nota_cobr_rrs
	and	f.nr_sequencia		= c.nr_seq_fatura
	and	f.ie_operacao		= 'E'
	and	f.ie_tipo_arquivo_cob	= '507' -- Reemboslo
	and	f.nr_seq_pls_fatura is not null
	and	i.nr_seq_conta	is not null
	and	f.ie_status	is null
	group by i.nr_seq_conta,
		s.nr_seq_nota_cobr_rrs,
		c.nr_seq_fatura,
		f.nr_seq_pls_fatura) alias91
group by nr_seq_conta,
	nr_seq_nota_cobr,
	nr_seq_fatura,
	nr_seq_pls_fatura;

