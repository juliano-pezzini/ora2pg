-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW conta_paciente_honorario_v2 (ie_emite_conta, nr_interno_conta_proc, nr_interno_conta, ie_cancelamento, cd_procedimento, ie_origem_proced, cd_procedimento_convenio, ds_procedimento, dt_procedimento, dt_conta, dt_conta_dia, qt_procedimento, vl_medico, vl_unitario, vl_procedimento, vl_custo_operacional, vl_proc_custo_oper, vl_medico_custo_oper, vl_total_medico_custo_oper, cd_setor_atendimento, ds_setor_atendimento, ds_classif_setor, nm_medico, qt_pto_medico, qt_pto_medico_ajust, qt_pto_auxiliares, qt_pto_anestesista, qt_pto_custo_oper, qt_pto_procedimento, nr_crm, nr_crm_dig, pr_participacao, tx_procedimento, ie_funcao_medico, ds_funcao, nr_sequencia, nr_seq_proc_pacote, ie_responsavel_credito, ds_responsavel_credito, cd_unidade_basica, cd_unidade_compl, cd_tipo_acomodacao_pac, ds_tipo_acomodacao_pac, cd_medico, dt_item, qt_porte_anestesico, pr_via_acesso, cd_procedimento_princ, nr_cpf_medico, cd_cgc_medico, cd_cgc_cpf_medico, ie_cobra_pf_pj, ie_corpo_clinico, uf_crm, ie_vinculo_medico, cd_motivo_exc_conta, cd_especialidade, cd_cgc_prestador, cd_cgc_cpf_resp_cred, cd_funcao_espec_med, nr_prescricao, dt_prescricao, nr_seq_autorizacao, nr_doc_convenio, nr_seq_protocolo, nr_atendimento, cd_convenio, dt_mesano_referencia, cd_proc_ref, cd_proc_ref_conv, ie_emite_conta_honor, ie_emite_conta_hosp, vl_filme, cd_proc_convenio, ds_proc_convenio, ie_video, pr_procedimento, pr_faturado, ie_participante, ds_especialidade, cd_medico_convenio, cd_medico_crm_convenio, ie_via_acesso, cd_tipo_procedimento, cd_grupo_proc, nr_cirurgia, qt_tempo_cirurgia, qt_tempo_anestesia, ds_tipo_anestesia, hr_conta, hr_execucao, tx_hora_extra, ds_hora_extra, nr_seq_atepacu, ds_resp_credito, cd_tipo_acomod_int, ds_tipo_acomod_int, vl_desconto, cd_prestador, qt_pto_medico_ajus, vl_medio_proc, vl_medio_medico, vl_proced_bruto, nm_medico_prescricao, cd_senha, cd_estabelecimento, vl_proced_origem, cd_proc_esp, nr_seq_proc_princ, ie_espaco, vl_bruto, cd_autorizacao, nr_doc_honor_conv, vl_ch_honorarios, ds_proc_int_conv_orig, cd_categoria_parametro, nr_seq_ajuste_proc, ds_convenio, cd_atuacao, cd_proc_princ_cirurgia, ds_proc_princ_cirurgia, dt_inicio_procedimento, nr_seq_proc_crit_hor, cd_proc_principal, ds_proc_principal, cd_categoria_locate, vl_medico_custo_mat, dt_inicio_cirurgia, dt_proc_agrupado, cd_profissional, vl_auxiliares, vl_anestesista, nm_fantasia_prest, ie_valor_informado, dt_inicio_real, dt_termino, vl_total_bruto) AS select
	-- A diferen√ßa dessa view para a conta_paciente_honorario_v eh o relacionamento com a tabela atend_paciente_unidade 
	coalesce(a.ie_emite_conta_honor, a.ie_emite_conta) ie_emite_conta, 
	a.nr_interno_conta nr_interno_conta_proc, 
	y.nr_interno_conta, 
	y.ie_cancelamento, 
	a.cd_procedimento, 
	a.ie_origem_proced, 
	a.cd_procedimento_convenio, 
	substr(b.ds_procedimento,0,100) ds_procedimento, 
	trunc(a.dt_procedimento,'DD') dt_procedimento, 
	a.dt_conta, 
	trunc(a.dt_conta,'DD') dt_conta_dia, 
	a.qt_procedimento, 
	a.vl_medico, 
	dividir(a.vl_medico, a.qt_procedimento) vl_unitario, 
	a.vl_procedimento, 
	a.vl_custo_operacional, 
	coalesce(a.vl_procedimento,0) + coalesce(a.vl_custo_operacional,0) vl_proc_custo_oper, 
	coalesce(a.vl_medico,0) + coalesce(a.vl_custo_operacional,0) vl_medico_custo_oper, 
	(coalesce(a.vl_medico,0) + coalesce(a.vl_custo_operacional,0)) * a.qt_procedimento vl_total_medico_custo_oper, 
	c.cd_setor_atendimento, 
	c.ds_setor_atendimento, 
	substr(Obter_valor_dominio(1,c.cd_classif_setor),1,30) ds_classif_setor, 
	e.nm_pessoa_fisica nm_medico, 
	coalesce(f.vl_medico,0) qt_pto_medico, 
	(coalesce(f.vl_medico,0) * a.tx_procedimento / 100) qt_pto_medico_ajust, 
	coalesce(f.vl_auxiliares,0) qt_pto_auxiliares, 
	coalesce(f.vl_anestesista,0) qt_pto_anestesista, 
	coalesce(f.vl_custo_operacional,0) qt_pto_custo_oper, 
	coalesce(f.vl_procedimento,0) qt_pto_procedimento, 
	g.nr_crm, 
	g.nr_crm || calcula_digito('Modulo11',g.nr_crm) nr_crm_dig, 
	100 pr_participacao, 
	1 tx_procedimento, 
	a.ie_funcao_medico, 
	w.ds_funcao, 
	a.nr_sequencia, 
	a.nr_seq_proc_pacote, 
	a.ie_responsavel_credito, 
	x.ds_regra ds_responsavel_credito, 
	h.cd_unidade_basica, 
	h.cd_unidade_compl, 
	h.cd_tipo_acomodacao cd_tipo_acomodacao_pac, 
	n.ds_tipo_acomodacao ds_tipo_acomodacao_pac, 
	a.cd_medico_executor cd_medico, 
	a.dt_procedimento dt_item, 
	a.qt_porte_anestesico, 
	a.tx_procedimento pr_via_acesso, 
	a.cd_procedimento_princ, 
	e.nr_cpf nr_cpf_medico, 
	g.cd_cgc cd_cgc_medico, 
	CASE WHEN g.ie_cobra_pf_pj='J' THEN g.cd_cgc  ELSE e.nr_cpf END  cd_cgc_cpf_medico, 
	g.ie_cobra_pf_pj, 
	g.ie_corpo_clinico, 
	g.uf_crm, 
	g.ie_vinculo_medico, 
	a.cd_motivo_exc_conta, 
	a.cd_especialidade, 
	a.cd_cgc_prestador, 
	CASE WHEN a.ie_responsavel_credito='M' THEN CASE WHEN g.ie_cobra_pf_pj='J' THEN g.cd_cgc  ELSE e.nr_cpf END  WHEN a.ie_responsavel_credito='H' THEN a.cd_cgc_prestador WHEN a.ie_responsavel_credito='RM' THEN a.cd_cgc_prestador  ELSE coalesce(x.cd_cgc,a.cd_cgc_prestador) END  cd_cgc_cpf_resp_cred, 
	obter_funcao_medico_convenio(a.cd_convenio,somente_numero(a.ie_funcao_medico),a.cd_especialidade) 
								cd_funcao_espec_med, 
	a.nr_prescricao, 
	a.dt_prescricao, 
	a.nr_seq_autorizacao, 
	a.nr_doc_convenio, 
	y.nr_seq_protocolo, 
	y.nr_atendimento, 
	y.cd_convenio_parametro cd_convenio, 
	y.dt_mesano_referencia, 
	substr(Obter_Proc_Ref(a.nr_seq_proc_princ,'I'),1,8) cd_proc_ref, 
	substr(Obter_Proc_Ref(a.nr_seq_proc_princ,'C'),1,20) cd_proc_ref_conv, 
	a.ie_emite_conta_honor ie_emite_conta_honor, 
	a.ie_emite_conta ie_emite_conta_hosp, 
	a.vl_materiais vl_filme, 
	coalesce(y.cd_procedimento, coalesce(a.cd_procedimento_convenio,a.cd_procedimento)) cd_proc_convenio, 
	coalesce(y.ds_procedimento, substr(b.ds_procedimento,0,100)) ds_proc_convenio, 
	a.ie_video, 
	100 pr_procedimento, 
	a.tx_procedimento pr_faturado, 
	'N' ie_participante, 
	substr(obter_desc_espec_medica(a.cd_especialidade),1,60) ds_especialidade, 
	a.cd_medico_convenio, 
	coalesce(a.cd_medico_convenio, g.nr_crm) cd_medico_crm_convenio, 
	a.ie_via_acesso, 
	b.cd_tipo_procedimento, 
	b.cd_grupo_proc, 
	a.nr_cirurgia, 
	substr(obter_dados_cirurgia(a.nr_cirurgia,'C'),1,30) qt_tempo_cirurgia, 
	substr(obter_dados_cirurgia(a.nr_cirurgia,'A'),1,30) qt_tempo_anestesia, 
	substr(obter_dados_cirurgia(a.nr_cirurgia,'T'),1,150) ds_tipo_anestesia, 
	to_char(dt_conta,'hh24:mi') hr_conta, 
	to_char(dt_procedimento,'hh24:mi') hr_execucao, 
	coalesce(a.tx_hora_extra,1) tx_hora_extra, 
	((coalesce(a.tx_hora_extra,1) * 100) - 100) ds_hora_extra, 
	a.nr_seq_atepacu, 
	CASE WHEN a.ie_responsavel_credito='M' THEN 	CASE WHEN g.ie_cobra_pf_pj='J' THEN  			substr(OBTER_NOME_PF_PJ(null,g.cd_cgc),1,80)  ELSE substr(OBTER_NOME_PF_PJ(e.cd_pessoa_fisica, null),1,80) END  WHEN a.ie_responsavel_credito='H' THEN  substr(OBTER_NOME_PF_PJ(null,a.cd_cgc_prestador),1,80) WHEN a.ie_responsavel_credito='RM' THEN substr(OBTER_NOME_PF_PJ(null,a.cd_cgc_prestador),1,80)  ELSE substr(OBTER_NOME_PF_PJ(null,coalesce(x.cd_cgc,a.cd_cgc_prestador)),1,80) END  ds_resp_credito, 
	obter_tipo_acomod_proc(a.nr_atendimento, a.nr_sequencia) cd_tipo_acomod_int, 
	substr(obter_desc_tipo_acomod(obter_tipo_acomod_proc(a.nr_atendimento, a.nr_sequencia)),1,40) ds_tipo_acomod_int, 
	coalesce(obter_desconto_matproc(a.nr_sequencia,'P'),0) vl_desconto, 
	substr(obter_medico_convenio(y.cd_estabelecimento,e.cd_pessoa_fisica,y.cd_convenio_parametro, null, null, null, 
	a.cd_setor_atendimento,a.dt_procedimento, null, a.ie_funcao_medico, null),1,15) cd_prestador, 
	(coalesce(f.vl_medico,0) * coalesce(a.tx_hora_extra,1)) qt_pto_medico_ajus, 
	dividir(a.vl_procedimento, a.qt_procedimento) vl_medio_proc, 
	dividir(a.vl_medico, a.qt_procedimento) vl_medio_Medico, 
	(a.vl_procedimento + coalesce(obter_desconto_matproc(a.nr_sequencia,'P'),0)) vl_proced_bruto, 
	substr(obter_medico_prescricao(a.nr_prescricao, 'N'),1,60) nm_medico_prescricao, 
	a.cd_senha, 
	y.cd_estabelecimento, 
	a.vl_procedimento vl_proced_origem, 
	to_char(a.cd_procedimento) || to_char(a.cd_especialidade) cd_proc_esp, 
	a.nr_seq_proc_princ, 
	' ' ie_espaco, 
	((a.vl_procedimento + coalesce(obter_desconto_matproc(a.nr_sequencia,'P'),0)) - 
			obter_valor_participante(a.nr_sequencia)) vl_bruto, 
	y.cd_autorizacao, 
	a.NR_DOC_HONOR_CONV, 
	(Obter_CH_Conv_Amb(y.cd_convenio_parametro, y.cd_categoria_parametro, y.cd_estabelecimento, a.cd_edicao_amb, a.dt_procedimento) * a.qt_procedimento) VL_CH_HONORARIOS, 
	substr(coalesce(y.ds_procedimento, coalesce(Obter_Desc_Proc_Interno(a.nr_seq_proc_interno),b.ds_procedimento)),1,80) ds_proc_int_Conv_Orig, 
	y.cd_categoria_parametro, 
	a.nr_seq_ajuste_proc, 
	substr(obter_nome_convenio(a.cd_convenio),1,40) ds_convenio, 
	substr(Obter_Conversao_Externa(obter_cgc_convenio(y.cd_convenio_Parametro), 
	'CONTA_PACIENTE_HONORARIO_V','CD_ATUACAO',obter_especialidade_medico(a.cd_medico_executor,'C')),1,40) cd_atuacao, 
	substr(Obter_proc_princ_cirurgia(a.nr_cirurgia,'C'),1,15) cd_proc_princ_cirurgia, 
	substr(Obter_proc_princ_cirurgia(a.nr_cirurgia,'D'),1,60) ds_proc_princ_cirurgia, 
	coalesce(a.dt_inicio_procedimento, a.dt_procedimento) dt_inicio_procedimento, 
	a.nr_seq_proc_crit_hor, 
	(obter_dados_propaci('CP',a.nr_seq_proc_princ))::numeric  cd_proc_principal, 
	substr(obter_dados_propaci('DS',a.nr_seq_proc_princ),1,240) ds_proc_principal, 
	y.cd_convenio_parametro||'_'||y.cd_categoria_parametro cd_categoria_locate, 
	coalesce(a.vl_medico,0) + coalesce(a.vl_custo_operacional,0) + coalesce(a.vl_materiais,0) vl_medico_custo_mat, 
	coalesce(coalesce(obter_inicio_proc_cirurgia(a.nr_cirurgia,a.cd_procedimento,a.ie_origem_proced), 
					a.dt_inicio_procedimento), a.dt_procedimento) dt_inicio_cirurgia, 
	dt_procedimento dt_proc_agrupado, 
	a.cd_pessoa_fisica cd_profissional, 
	coalesce(a.vl_auxiliares, 0) vl_auxiliares, 
	coalesce(a.vl_anestesista, 0) vl_anestesista, 
	substr(obter_dados_pf_pj(null,a.cd_cgc_prestador,'F'),1,80) nm_fantasia_prest, 
	coalesce(a.ie_valor_informado,'N') ie_valor_informado, 
	substr(obter_dados_cirurgia(a.nr_cirurgia, 'IR'),1,100) dt_inicio_real, 
	substr(obter_dados_cirurgia(a.nr_cirurgia, 'DT'),1,100) dt_termino, 
	dividir(((a.vl_procedimento + coalesce(obter_desconto_matproc(a.nr_sequencia,'P'),0)) - obter_valor_participante(a.nr_sequencia)), a.qt_procedimento) vl_total_bruto 
FROM setor_atendimento c, procedimento b, atend_paciente_unidade h
LEFT OUTER JOIN tipo_acomodacao n ON (h.cd_tipo_acomodacao = n.cd_tipo_acomodacao)
, procedimento_paciente a
LEFT OUTER JOIN pessoa_fisica e ON (a.cd_medico_executor = e.cd_pessoa_fisica)
LEFT OUTER JOIN medico g ON (a.cd_medico_executor = g.cd_pessoa_fisica)
LEFT OUTER JOIN conta_paciente y ON (a.nr_sequencia = y.nr_seq_procedimento)
LEFT OUTER JOIN proc_paciente_valor f ON (a.nr_sequencia = f.nr_seq_procedimento AND 2 = f.ie_tipo_valor)
LEFT OUTER JOIN regra_honorario x ON (a.ie_responsavel_credito = x.cd_regra)
LEFT OUTER JOIN funcao_medico w ON ((a.ie_funcao_medico)::numeric = w.cd_funcao)
WHERE a.cd_procedimento 		= b.cd_procedimento and a.ie_origem_proced 	= b.ie_origem_proced and a.cd_setor_atendimento 	= c.cd_setor_atendimento and a.nr_atendimento		= h.nr_atendimento and a.dt_entrada_unidade	= h.dt_entrada_unidade         and a.nr_interno_conta		= y.nr_interno_conta and a.cd_motivo_exc_conta	is null 
 
union
 
select 
	h.ie_emite_conta, 
	a.nr_interno_conta nr_interno_conta_proc, 
	y.nr_interno_conta, 
	y.ie_cancelamento, 
	a.cd_procedimento, 
	a.ie_origem_proced, 
	coalesce(CASE WHEN h.cd_proc_conv='0' THEN  null  ELSE h.cd_proc_conv END , a.cd_procedimento_convenio), 
	substr(b.ds_procedimento,0,100), 
	trunc(a.dt_procedimento,'DD') dt_procedimento, 
	a.dt_conta, 
	trunc(a.dt_conta,'DD') dt_conta_dia, 
	a.qt_procedimento, 
	h.vl_participante, 
	dividir(h.vl_participante, a.qt_procedimento) vl_unitario, 
	h.vl_conta, 
	0, 
	coalesce(h.vl_conta,0) vl_proc_custo_oper, 
	coalesce(h.vl_participante,0) vl_medico_custo_oper, 
	(coalesce(h.vl_participante,0)) * a.qt_procedimento vl_total_medico_custo_oper, 
	c.cd_setor_atendimento, 
	c.ds_setor_atendimento, 
	substr(Obter_valor_dominio(1,c.cd_classif_setor),1,30) ds_classif_setor, 
	e.nm_pessoa_fisica nm_medico, 
	coalesce(h.vl_original,0), 
	(coalesce(h.vl_original,0) * coalesce(h.pr_faturar,100) / 100) qt_pto_medico_ajust, 
	coalesce(f.vl_auxiliares,0), 
	coalesce(f.vl_anestesista,0), 
	coalesce(f.vl_custo_operacional,0) qt_pto_custo_oper, 
	coalesce(f.vl_procedimento,0) qt_pto_procedimento, 
	g.nr_crm, 
	g.nr_crm || calcula_digito('Modulo11',g.nr_crm) nr_crm_dig, 
	100, 
	h.pr_procedimento, 
	h.ie_funcao, 
	i.ds_funcao, 
	a.nr_sequencia, 
	a.nr_seq_proc_pacote, 
	h.ie_responsavel_credito, 
	x.ds_regra ds_responsavel_credito, 
	m.cd_unidade_basica, 
	m.cd_unidade_compl, 
	m.cd_tipo_acomodacao cd_tipo_acomodacao_pac, 
	n.ds_tipo_acomodacao ds_tipo_acomodacao_pac, 
	h.cd_pessoa_fisica cd_medico, 
	a.dt_procedimento dt_item, 
	a.qt_porte_anestesico, 
	a.tx_procedimento pr_via_acesso, 
	a.cd_procedimento_princ, 
	e.nr_cpf nr_cpf_medico, 
	g.cd_cgc cd_cgc_medico, 
	CASE WHEN g.ie_cobra_pf_pj='J' THEN g.cd_cgc  ELSE e.nr_cpf END  cd_cgc_cpf_medico, 
	g.ie_cobra_pf_pj, 
	g.ie_corpo_clinico, 
	g.uf_crm, 
	g.ie_vinculo_medico, 
	a.cd_motivo_exc_conta, 
	h.cd_especialidade, 
	a.cd_cgc_prestador, 
	CASE WHEN h.ie_responsavel_credito='M' THEN CASE WHEN g.ie_cobra_pf_pj='J' THEN g.cd_cgc  ELSE e.nr_cpf END  WHEN h.ie_responsavel_credito='H' THEN a.cd_cgc_prestador WHEN h.ie_responsavel_credito='RM' THEN a.cd_cgc_prestador  ELSE coalesce(x.cd_cgc,a.cd_cgc_prestador) END  cd_cgc_cpf_resp_cred, 
	obter_funcao_medico_convenio(a.cd_convenio,somente_numero(h.ie_funcao),h.cd_especialidade) 
								cd_funcao_espec_med, 
	a.nr_prescricao, 
	a.dt_prescricao, 
	a.nr_seq_autorizacao, 
	a.nr_doc_convenio, 
	y.nr_seq_protocolo, 
	y.nr_atendimento, 
	y.cd_convenio_parametro cd_convenio, 
	y.dt_mesano_referencia, 
	substr(Obter_Proc_Ref(a.nr_seq_proc_princ,'I'),1,8) cd_proc_ref, 
	substr(Obter_Proc_Ref(a.nr_seq_proc_princ,'C'),1,20) cd_proc_ref_conv, 
	h.ie_emite_conta ie_emite_conta_honor, 
	'' ie_emite_conta_hosp, 
	0 vl_filme, 
	coalesce(coalesce(CASE WHEN h.cd_proc_conv='0' THEN null  ELSE h.cd_proc_conv END , y.cd_procedimento), coalesce(a.cd_procedimento_convenio,a.cd_procedimento)) cd_proc_convenio, 
	coalesce(coalesce(h.ds_proc_conv, y.ds_procedimento), substr(b.ds_procedimento,0,100)) ds_proc_convenio, 
	a.ie_video, 
	(h.pr_procedimento * 100) pr_procedimento, 
	coalesce(h.pr_faturar,a.tx_procedimento) pr_faturado, 
	'S' ie_participante, 
	substr(obter_desc_espec_medica(h.cd_especialidade),1,60) ds_especialidade, 
	h.cd_medico_convenio, 
	coalesce(h.cd_medico_convenio, g.nr_crm) cd_medico_crm_convenio, 
	a.ie_via_acesso, 
	b.cd_tipo_procedimento, 
	b.cd_grupo_proc, 
	a.nr_cirurgia, 
	substr(obter_dados_cirurgia(a.nr_cirurgia,'C'),1,30) qt_tempo_cirurgia, 
	substr(obter_dados_cirurgia(a.nr_cirurgia,'A'),1,30) qt_tempo_anestesia, 
	substr(obter_dados_cirurgia(a.nr_cirurgia,'T'),1,150) ds_tipo_anestesia, 
	to_char(dt_conta,'hh24:mi') hr_conta, 
	to_char(dt_procedimento,'hh24:mi') hr_execucao, 
	coalesce(a.tx_hora_extra,1) tx_hora_extra, 
	((coalesce(a.tx_hora_extra,1) * 100) - 100) ds_hora_extra, 
	a.nr_seq_atepacu, 
	CASE WHEN a.ie_responsavel_credito='M' THEN 	CASE WHEN g.ie_cobra_pf_pj='J' THEN  			substr(OBTER_NOME_PF_PJ(null,g.cd_cgc),1,80)  ELSE substr(OBTER_NOME_PF_PJ(e.cd_pessoa_fisica, null),1,80) END  WHEN a.ie_responsavel_credito='H' THEN  substr(OBTER_NOME_PF_PJ(null,a.cd_cgc_prestador),1,80) WHEN a.ie_responsavel_credito='RM' THEN substr(OBTER_NOME_PF_PJ(null,a.cd_cgc_prestador),1,80)  ELSE substr(OBTER_NOME_PF_PJ(null,coalesce(h.cd_cgc,coalesce(x.cd_cgc,a.cd_cgc_prestador))),1,80) END  ds_resp_credito, 
	obter_tipo_acomod_proc(a.nr_atendimento, a.nr_sequencia) cd_tipo_acomod_int, 
	substr(obter_desc_tipo_acomod(obter_tipo_acomod_proc(a.nr_atendimento, a.nr_sequencia)),1,40) ds_tipo_acomod_int, 
	coalesce(obter_desconto_matproc(a.nr_sequencia,'P'),0) vl_desconto, 
	substr(obter_medico_convenio(y.cd_estabelecimento,e.cd_pessoa_fisica,y.cd_convenio_parametro, null, null, null, 
	a.cd_setor_atendimento,a.dt_procedimento, a.ie_funcao_medico, null),1,15) cd_prestador, 
	(coalesce(h.vl_original,0) * coalesce(a.tx_hora_extra,1)) qt_pto_medico_ajus, 
	0 vl_medio_proc, 
	dividir(h.vl_participante, a.qt_procedimento) vl_medio_Medico, 
	a.vl_procedimento + coalesce(obter_desconto_matproc(a.nr_sequencia,'P'),0) vl_proced_bruto, 
	substr(obter_medico_prescricao(a.nr_prescricao, 'N'),1,60) nm_medico_prescricao, 
	a.cd_senha, 
	y.cd_estabelecimento, 
	a.vl_procedimento vl_proced_origem, 
	to_char(a.cd_procedimento) || to_char(h.cd_especialidade) cd_proc_esp, 
	a.nr_seq_proc_princ, 
	' ' ie_espaco, 
	h.vl_participante vl_bruto, 
	y.cd_autorizacao, 
	h.NR_DOC_HONOR_CONV, 
	(Obter_CH_Conv_Amb(y.cd_convenio_parametro, y.cd_categoria_parametro, y.cd_estabelecimento, a.cd_edicao_amb, a.dt_procedimento) * a.qt_procedimento) VL_CH_HONORARIOS, 
	substr(coalesce(y.ds_procedimento, coalesce(Obter_Desc_Proc_Interno(a.nr_seq_proc_interno),b.ds_procedimento)),1,80) ds_proc_int_Conv_Orig, 
	y.cd_categoria_parametro, 
	a.nr_seq_ajuste_proc, 
	substr(obter_nome_convenio(a.cd_convenio),1,40) ds_convenio, 
	substr(Obter_Conversao_Externa(obter_cgc_convenio(y.cd_convenio_Parametro), 
	'CONTA_PACIENTE_HONORARIO_V','CD_ATUACAO',obter_especialidade_medico(h.cd_pessoa_fisica,'C')),1,40) cd_atuacao, 
	substr(Obter_proc_princ_cirurgia(a.nr_cirurgia,'C'),1,15) cd_proc_princ_cirurgia, 
	substr(Obter_proc_princ_cirurgia(a.nr_cirurgia,'D'),1,60) ds_proc_princ_cirurgia, 
	coalesce(a.dt_inicio_procedimento, a.dt_procedimento) dt_inicio_procedimento, 
	a.nr_seq_proc_crit_hor, 
	(obter_dados_propaci('CP',a.nr_seq_proc_princ))::numeric  cd_proc_principal, 
	substr(obter_dados_propaci('DS',a.nr_seq_proc_princ),1,240) ds_proc_principal, 
	y.cd_convenio_parametro||'_'||y.cd_categoria_parametro cd_categoria_locate, 
	coalesce(h.vl_participante,0) vl_medico_custo_mat, 
	coalesce(coalesce(obter_inicio_proc_cirurgia(a.nr_cirurgia,a.cd_procedimento,a.ie_origem_proced), 
					a.dt_inicio_procedimento), a.dt_procedimento) dt_inicio_cirurgia, 
	dt_procedimento dt_proc_agrupado, 
	a.cd_pessoa_fisica cd_profissional, 
	coalesce(a.vl_auxiliares,0) vl_auxiliares, 
	coalesce(a.vl_anestesista,0) vl_anestesista, 
	substr(obter_dados_pf_pj(null,h.CD_CGC,'F'),1,80) nm_fantasia_prest, 
	coalesce(a.ie_valor_informado,'N') ie_valor_informado, 
	substr(obter_dados_cirurgia(a.nr_cirurgia, 'IR'),1,100) dt_inicio_real, 
	substr(obter_dados_cirurgia(a.nr_cirurgia, 'DT'),1,100) dt_termino, 
	dividir(h.vl_participante, a.qt_procedimento) vl_total_bruto 
FROM setor_atendimento c, procedimento b, atend_paciente_unidade m
LEFT OUTER JOIN tipo_acomodacao n ON (m.cd_tipo_acomodacao = n.cd_tipo_acomodacao)
, procedimento_participante h
LEFT OUTER JOIN pessoa_fisica e ON (h.cd_pessoa_fisica = e.cd_pessoa_fisica)
LEFT OUTER JOIN medico g ON (h.cd_pessoa_fisica = g.cd_pessoa_fisica)
LEFT OUTER JOIN funcao_medico i ON ((h.ie_funcao)::numeric = i.cd_funcao)
LEFT OUTER JOIN regra_honorario x ON (h.ie_responsavel_credito = x.cd_regra)
, procedimento_paciente a
LEFT OUTER JOIN conta_paciente y ON (a.nr_sequencia = y.nr_seq_procedimento)
LEFT OUTER JOIN proc_paciente_valor f ON (a.nr_sequencia = f.nr_seq_procedimento AND 2 = f.ie_tipo_valor)
WHERE a.cd_procedimento 		= b.cd_procedimento and a.ie_origem_proced 	= b.ie_origem_proced and a.cd_setor_atendimento 	= c.cd_setor_atendimento and a.nr_seq_atepacu = m.nr_seq_interno --and	a.nr_atendimento	= m.nr_atendimento				 
--and	a.dt_entrada_unidade	= m.dt_entrada_unidade 
    and a.nr_sequencia 		= h.nr_sequencia      and a.nr_interno_conta		= y.nr_interno_conta and a.cd_motivo_exc_conta	is null;

