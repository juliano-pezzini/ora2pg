-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW w_resumo_migracao_v (ds_projeto, dt_resumo, nr_projeto, dt_inicio_desenv, dt_termino_prev, dt_termino_prov, nm_desenvolvedor, nr_horas_trab_desenv, nr_horas_prev_projeto, nr_horas_real_projeto, pr_uso_horas_prev_proj, hr_possiv_09, hr_real_09, pr_inic_09, pr_possiv_09, pr_real_09, pr_inic_12, hr_possiv_12, hr_real_12, pr_possiv_12, pr_real_12, pr_inic_15, hr_possiv_15, hr_real_15, pr_possiv_15, pr_real_15, pr_inic_18, hr_possiv_18, hr_real_18, pr_possiv_18, pr_real_18) AS select	coalesce(p.ds_informacao_externa, p.ds_titulo) ds_projeto,
	w.dt_resumo, 
	w.nr_seq_projeto nr_projeto, 
	p.dt_inicio_prev dt_inicio_desenv, 
	p.dt_fim_prev dt_termino_prev, 
	obter_term_prov_proj_migr_res(w.nr_seq_projeto, LOCALTIMESTAMP) dt_termino_prov, 
	substr(obter_pessoa_equipe_projeto(p.nr_sequencia, 11, 44, 'PNM'),1,60) nm_desenvolvedor, 
	obter_horas_trabalhadas_pf_os(p.nr_seq_ordem_serv, obter_pessoa_equipe_projeto(p.nr_sequencia, 11, 44, null), LOCALTIMESTAMP) nr_horas_trab_desenv, 
	coalesce(proj_obter_qt_total_horas_cron(p.nr_sequencia, 0, 'T', 'E'), 0) nr_horas_prev_projeto, 
	coalesce(proj_obter_qt_total_horas_cron(p.nr_sequencia, 0, 'R', 'E'), 0) nr_horas_real_projeto, 
	proj_obter_perc_cron(p.nr_sequencia, 'P') pr_uso_horas_prev_proj, 
	(select	x.qt_horas_prev_resumo 
	 FROM	w_resumo_migracao x 
	 where	x.nr_seq_projeto = p.nr_sequencia 
	 and	x.dt_resumo = to_date(to_char(LOCALTIMESTAMP,'dd/mm/yyyy') || ' 09:00:00', 'dd/mm/yyyy hh24:mi:ss')) hr_possiv_09, 
	(select	x.qt_horas_real_resumo 
	 from	w_resumo_migracao x 
	 where	x.nr_seq_projeto = p.nr_sequencia 
	 and	x.dt_resumo = to_date(to_char(LOCALTIMESTAMP,'dd/mm/yyyy') || ' 09:00:00', 'dd/mm/yyyy hh24:mi:ss')) hr_real_09, 
	(select	x.pr_inicial 
	 from	w_resumo_migracao x 
	 where	x.nr_seq_projeto = p.nr_sequencia 
	 and	x.dt_resumo = to_date(to_char(LOCALTIMESTAMP,'dd/mm/yyyy') || ' 09:00:00', 'dd/mm/yyyy hh24:mi:ss')) pr_inic_09, 
	(select	x.pr_previsto 
	 from	w_resumo_migracao x 
	 where	x.nr_seq_projeto = p.nr_sequencia 
	 and	x.dt_resumo = to_date(to_char(LOCALTIMESTAMP,'dd/mm/yyyy') || ' 09:00:00', 'dd/mm/yyyy hh24:mi:ss')) pr_possiv_09, 
	(select	x.pr_final 
	 from	w_resumo_migracao x 
	 where	x.nr_seq_projeto = p.nr_sequencia 
	 and	x.dt_resumo = to_date(to_char(LOCALTIMESTAMP,'dd/mm/yyyy') || ' 09:00:00', 'dd/mm/yyyy hh24:mi:ss')) pr_real_09, 
	(select	x.pr_inicial 
	 from	w_resumo_migracao x 
	 where	x.nr_seq_projeto = p.nr_sequencia 
	 and	x.dt_resumo = to_date(to_char(LOCALTIMESTAMP,'dd/mm/yyyy') || ' 12:00:00', 'dd/mm/yyyy hh24:mi:ss')) pr_inic_12,	 
	(select	x.qt_horas_prev_resumo 
	 from	w_resumo_migracao x 
	 where	x.nr_seq_projeto = p.nr_sequencia 
	 and	x.dt_resumo = to_date(to_char(LOCALTIMESTAMP,'dd/mm/yyyy') || ' 12:00:00', 'dd/mm/yyyy hh24:mi:ss')) hr_possiv_12, 
	(select	x.qt_horas_real_resumo 
	 from	w_resumo_migracao x 
	 where	x.nr_seq_projeto = p.nr_sequencia 
	 and	x.dt_resumo = to_date(to_char(LOCALTIMESTAMP,'dd/mm/yyyy') || ' 12:00:00', 'dd/mm/yyyy hh24:mi:ss')) hr_real_12, 
	(select	x.pr_previsto 
	 from	w_resumo_migracao x 
	 where	x.nr_seq_projeto = p.nr_sequencia 
	 and	x.dt_resumo = to_date(to_char(LOCALTIMESTAMP,'dd/mm/yyyy') || ' 12:00:00', 'dd/mm/yyyy hh24:mi:ss')) pr_possiv_12, 
	(select	x.pr_final 
	 from	w_resumo_migracao x 
	 where	x.nr_seq_projeto = p.nr_sequencia 
	 and	x.dt_resumo = to_date(to_char(LOCALTIMESTAMP,'dd/mm/yyyy') || ' 12:00:00', 'dd/mm/yyyy hh24:mi:ss')) pr_real_12, 
	(select	x.pr_inicial 
	 from	w_resumo_migracao x 
	 where	x.nr_seq_projeto = p.nr_sequencia 
	 and	x.dt_resumo = to_date(to_char(LOCALTIMESTAMP,'dd/mm/yyyy') || ' 15:00:00', 'dd/mm/yyyy hh24:mi:ss')) pr_inic_15,	 
	(select	x.qt_horas_prev_resumo 
	 from	w_resumo_migracao x 
	 where	x.nr_seq_projeto = p.nr_sequencia 
	 and	x.dt_resumo = to_date(to_char(LOCALTIMESTAMP,'dd/mm/yyyy') || ' 15:00:00', 'dd/mm/yyyy hh24:mi:ss')) hr_possiv_15, 
	(select	x.qt_horas_real_resumo 
	 from	w_resumo_migracao x 
	 where	x.nr_seq_projeto = p.nr_sequencia 
	 and	x.dt_resumo = to_date(to_char(LOCALTIMESTAMP,'dd/mm/yyyy') || ' 15:00:00', 'dd/mm/yyyy hh24:mi:ss')) hr_real_15, 
	(select	x.pr_previsto 
	 from	w_resumo_migracao x 
	 where	x.nr_seq_projeto = p.nr_sequencia 
	 and	x.dt_resumo = to_date(to_char(LOCALTIMESTAMP,'dd/mm/yyyy') || ' 15:00:00', 'dd/mm/yyyy hh24:mi:ss')) pr_possiv_15, 
	(select	x.pr_final 
	 from	w_resumo_migracao x 
	 where	x.nr_seq_projeto = p.nr_sequencia 
	 and	x.dt_resumo = to_date(to_char(LOCALTIMESTAMP,'dd/mm/yyyy') || ' 15:00:00', 'dd/mm/yyyy hh24:mi:ss')) pr_real_15, 
	(select	x.pr_inicial 
	 from	w_resumo_migracao x 
	 where	x.nr_seq_projeto = p.nr_sequencia 
	 and	x.dt_resumo = to_date(to_char(LOCALTIMESTAMP,'dd/mm/yyyy') || ' 18:00:00', 'dd/mm/yyyy hh24:mi:ss')) pr_inic_18,	 
	(select	x.qt_horas_prev_resumo 
	 from	w_resumo_migracao x 
	 where	x.nr_seq_projeto = p.nr_sequencia 
	 and	x.dt_resumo = to_date(to_char(LOCALTIMESTAMP,'dd/mm/yyyy') || ' 18:00:00', 'dd/mm/yyyy hh24:mi:ss')) hr_possiv_18, 
	(select	x.qt_horas_real_resumo 
	 from	w_resumo_migracao x 
	 where	x.nr_seq_projeto = p.nr_sequencia 
	 and	x.dt_resumo = to_date(to_char(LOCALTIMESTAMP,'dd/mm/yyyy') || ' 18:00:00', 'dd/mm/yyyy hh24:mi:ss')) hr_real_18, 
	(select	x.pr_previsto 
	 from	w_resumo_migracao x 
	 where	x.nr_seq_projeto = p.nr_sequencia 
	 and	x.dt_resumo = to_date(to_char(LOCALTIMESTAMP,'dd/mm/yyyy') || ' 18:00:00', 'dd/mm/yyyy hh24:mi:ss')) pr_possiv_18, 
	(select	x.pr_final 
	 from	w_resumo_migracao x 
	 where	x.nr_seq_projeto = p.nr_sequencia 
	 and	x.dt_resumo = to_date(to_char(LOCALTIMESTAMP,'dd/mm/yyyy') || ' 18:00:00', 'dd/mm/yyyy hh24:mi:ss')) pr_real_18 
from	proj_projeto p, 
	w_resumo_migracao w 
where	p.nr_sequencia = w.nr_seq_projeto;

