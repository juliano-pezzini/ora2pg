-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW valores_atendimento_v (cd_estabelecimento, nr_atendimento, nr_interno_conta, cd_convenio_parametro, ie_tipo, ds_total, vl_total, ds_convenio) AS select  a.CD_ESTABELECIMENTO,a.NR_ATENDIMENTO,a.NR_INTERNO_CONTA,a.CD_CONVENIO_PARAMETRO,a.IE_TIPO,a.DS_TOTAL,a.VL_TOTAL,
	b.ds_convenio
FROM 	convenio b,
	(select		cd_estabelecimento,
			nr_atendimento,
			nr_interno_conta,
			cd_convenio_parametro,
			1 ie_tipo,
			obter_desc_expressao(645729) ds_total,
			coalesce(sum(CASE WHEN ie_status_acerto=1 THEN  obter_valor_conta(nr_interno_conta,0)  ELSE vl_conta END ),0)  vl_total
	from    conta_paciente
	group by	cd_estabelecimento, 
			nr_atendimento,
			nr_interno_conta,
			cd_convenio_parametro,
			1, 
			obter_desc_expressao(645729)
	
union

	select		cd_estabelecimento, 
			nr_atendimento,
			nr_interno_conta,
			cd_convenio_parametro,
			2 ie_tipo,
			obter_desc_expressao(313037) ds_total,
			coalesce(sum(obter_valor_conta(nr_interno_conta,0)),0) vl_total
	from    Conta_Paciente
	where   ie_status_acerto      = 2
	group by	cd_estabelecimento, 
			nr_atendimento,
			nr_interno_conta,
			cd_convenio_parametro,
			2, 
			obter_desc_expressao(313037)
	
union

	select		cd_estabelecimento, 
			nr_atendimento,
			nr_interno_conta,
			cd_convenio_parametro,
			3 ie_tipo,
			obter_desc_expressao(727010) ds_total,
			coalesce(sum(obter_valor_conta(nr_interno_conta,0)),0) vl_total
	from    Conta_Paciente
	where   ie_status_acerto      = 1
	group by	cd_estabelecimento, 
			nr_atendimento,
			nr_interno_conta,
			cd_convenio_parametro,
			3, 
			obter_desc_expressao(727010)
	
union

	select		cd_estabelecimento, 
			nr_atendimento,
			nr_interno_conta,
			cd_convenio_parametro,
			4 ie_tipo,
			obter_desc_expressao(287476) ds_total,
			coalesce(sum(vl_desconto),0) vl_total
	from    Conta_Paciente
	group by	cd_estabelecimento, 
			nr_atendimento,
			nr_interno_conta,
			cd_convenio_parametro,
			4, 
			obter_desc_expressao(287476)
	
union

	select		cd_estabelecimento, 
			nr_atendimento,
			nr_interno_conta,
			cd_convenio,
			5 ie_tipo,
			obter_desc_expressao(1075120) ds_total,
			sum(CASE WHEN nr_seq_proc_pacote=nr_sequencia THEN  coalesce(vl_item, 0)  ELSE 0 END  - coalesce(vl_original,0)) vl_total
	from    conta_paciente_v
	where   cd_motivo_exc_conta   is null
	group by 	cd_estabelecimento, 
			nr_atendimento,
			nr_interno_conta,
			cd_convenio,
			5, 
			obter_desc_expressao(1075120), 
			cd_convenio
	
union

	select		cd_estabelecimento, 
			nr_atendimento,
			nr_interno_conta,
			cd_convenio,
			6 ie_tipo,
			obter_desc_expressao(301461) ds_total,
			sum(coalesce(vl_original,0)) vl_total
	from    conta_paciente_v
	where   cd_motivo_exc_conta   is null
	group by 	cd_estabelecimento, 
			nr_atendimento,
			nr_interno_conta,
			cd_convenio,
			6, 
			obter_desc_expressao(301461), 
			cd_convenio) a
where a.cd_convenio_parametro = b.cd_convenio;

