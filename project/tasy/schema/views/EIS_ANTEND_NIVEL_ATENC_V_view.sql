-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_antend_nivel_atenc_v (ds_sexo, ds_estado_civil, ds_bairro, ds_municipio, ds_cid, ds_obito, ds_mes, ds_ano, ds_min_atend, ds_min_espera, ds_dia_semana, ds_turno, cd_medico, dt_inicio_atendimento, ds_categoria, ds_convenio) AS select	substr(obter_valor_dominio(4, obter_dados_pf(a.cd_pessoa_fisica,'SE')),1,200) ds_sexo,
		substr(obter_valor_dominio(5, obter_dados_pf(a.cd_pessoa_fisica,'EC')),1,200) ds_estado_civil,
		substr(obter_compl_pf(a.cd_pessoa_fisica,1,'B'),1,200) ds_bairro,
		substr(obter_compl_pf(a.cd_pessoa_fisica,1,'CI'),1,200) ds_municipio,
		substr(Obter_CID10_Paciente(a.cd_pessoa_fisica, wheb_usuario_pck.get_nm_usuario) ,1,200) ds_cid,
		substr(CASE WHEN obter_se_paciente_em_obito(a.cd_pessoa_fisica)='S' THEN obter_desc_expressao(719927,'Sim')  ELSE obter_desc_expressao(327114,'NÃ£o') END ,1,200) ds_obito,
		to_char(trunc(a.dt_entrada, 'Month'), 'mm/yyyy') ds_mes,
		to_char(trunc(a.dt_entrada, 'Year'), 'yyyy') ds_ano,
		round((a.dt_saida_real - a.dt_inicio_atendimento) * 1440) ds_min_atend,
		round((a.dt_inicio_atendimento - a.dt_entrada) * 1440) ds_min_espera,
		SUBSTR(obter_valor_dominio(35,obter_cod_dia_semana(a.dt_inicio_atendimento)),1,150) ds_dia_semana,
		Obter_Turno_Atendimento(a.dt_inicio_atendimento,a.CD_ESTABELECIMENTO,'DS') ds_turno,
		c.cd_medico,
		a.dt_inicio_atendimento,
		obter_categoria_convenio_atend(a.nr_atendimento, Obter_Convenio_Atendimento(a.nr_atendimento)) ds_categoria,
		obter_nome_convenio(Obter_Convenio_Atendimento(a.nr_atendimento)) ds_convenio
FROM	atendimento_paciente a,
		med_paciente_atend b,
		med_cliente c
where	b.nr_atendimento = a.nr_atendimento
and		b.nr_seq_cliente = c.nr_sequencia;

