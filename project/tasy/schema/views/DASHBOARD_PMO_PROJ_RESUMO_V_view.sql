-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW dashboard_pmo_proj_resumo_v (nr_sequencia, ds_titulo, nr_seq_programa, nr_seq_estagio, dt_inicio_prev, dt_inicio_real, dt_fim_prev, dt_fim_real, qt_hora_prev, qt_hora_real, pr_prev, pr_prev_aprov, pr_real, pr_real_aprov, ie_status_resumo, ie_status_horas, ie_status_checkpoint, ie_status_milestone, cor_status_resumo, cor_status_horas, cor_status_milestone, cor_status_checkpoint) AS select v.NR_SEQUENCIA,v.DS_TITULO,v.NR_SEQ_PROGRAMA,v.NR_SEQ_ESTAGIO,v.DT_INICIO_PREV,v.DT_INICIO_REAL,v.DT_FIM_PREV,v.DT_FIM_REAL,v.QT_HORA_PREV,v.QT_HORA_REAL,v.PR_PREV,v.PR_PREV_APROV,v.PR_REAL,v.PR_REAL_APROV,v.IE_STATUS_RESUMO,v.IE_STATUS_HORAS,v.IE_STATUS_CHECKPOINT,v.IE_STATUS_MILESTONE,
       obter_cor_status_dashboard_pmo(v.ie_status_resumo) cor_status_resumo,
       obter_cor_status_dashboard_pmo(v.ie_status_horas) cor_status_horas,
       obter_cor_status_dashboard_pmo(v.ie_status_milestone) cor_status_milestone,
       obter_cor_status_dashboard_pmo(v.ie_status_checkpoint) cor_status_checkpoint
FROM ( select   t.*,
                  obter_status_dashboard_pmo( 'PJ',
                                              t.nr_seq_estagio,
                                              t.dt_inicio_prev,
                                              t.dt_inicio_real,
                                              t.dt_fim_prev,
                                              t.dt_fim_real,
                                              t.pr_prev,
                                              t.pr_real ) ie_status_resumo,
                  obter_status_hr_dashboard_pmo(t.qt_hora_prev, t.qt_hora_real) ie_status_horas,
                  obter_status_ckp_dashboard_pmo('PJ', t.nr_sequencia) ie_status_checkpoint,
                  obter_status_mlt_dashboard_pmo('PJ', t.nr_sequencia) ie_status_milestone
         from ( select   a.NR_SEQ_PROJETO nr_sequencia,
                             a.ds_titulo,
                             a.nr_seq_programa,
                             a.nr_seq_estagio,  
                             min(a.dt_inicio_prev) dt_inicio_prev,
                             min(a.dt_inicio_real) dt_inicio_real,
                             max(a.dt_fim_prev) dt_fim_prev,
                             obter_dt_fim_real_projeto(a.nr_seq_projeto) dt_fim_real,
                             sum(a.qt_hora_prev) qt_hora_prev,
                             sum(a.qt_hora_real) qt_hora_real,
                             obter_proj_atual_pr_previsto(a.nr_seq_projeto) pr_prev,
                             obter_proj_atual_pr_previsto(a.nr_seq_projeto,'E,P') pr_prev_aprov,
							 obter_pr_real_projeto(a.nr_seq_projeto) pr_real,
							 obter_pr_real_projeto(a.nr_seq_projeto, 'E,P','S') pr_real_aprov
                    from    proj_projeto_inf_v a
                    group by a.nr_seq_projeto,
                             a.ds_titulo,
                             a.nr_seq_programa,
                             a.nr_seq_estagio							 
                  ) t
       ) v;

