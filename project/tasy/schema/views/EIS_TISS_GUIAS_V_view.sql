-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_tiss_guias_v (ie_periodo, dt_mesano_referencia, cd_estabelecimento, cd_convenio, ds_convenio, ie_tiss_tipo_guia, ds_tiss_tipo_guia, ie_tipo_atendimento, ds_tipo_atendimento, ie_tipo_atend_conta, ds_tipo_atend_conta, vl_total, vl_servicos, vl_alugueis, vl_diarias, vl_gases, vl_materiais, vl_medicamentos, vl_opms, vl_outras_despesas, vl_taxas) AS select	'M' ie_periodo,
	a.dt_mesano_referencia,
	a.cd_estabelecimento,
	a.cd_convenio_parametro cd_convenio,
	substr(c.ds_convenio,1,255) ds_convenio,
	b.ie_tiss_tipo_guia,
	substr(obter_valor_dominio(1746,b.ie_tiss_tipo_guia),1,255) ds_tiss_tipo_guia,
	d.ie_tipo_atendimento,
	substr(obter_valor_dominio(12,d.ie_tipo_atendimento),1,255) ds_tipo_atendimento,
	a.ie_tipo_atend_conta,
	substr(obter_valor_dominio(12,a.ie_tipo_atend_conta),1,255) ds_tipo_atend_conta,
	coalesce(b.vl_total,0) vl_total,
	coalesce(b.vl_servicos,0) vl_servicos,
	coalesce(b.vl_alugueis,0) vl_alugueis,
	coalesce(b.vl_diarias,0) vl_diarias,
	coalesce(b.vl_gases,0) vl_gases,
	coalesce(b.vl_materiais,0) vl_materiais,
	coalesce(b.vl_medicamentos,0) vl_medicamentos,
	coalesce(b.vl_opms,0) vl_opms,
	coalesce(b.vl_outras_despesas,0) vl_outras_despesas,
	coalesce(b.vl_taxas,0) vl_taxas
FROM	atendimento_paciente d,
	conta_paciente a,
	protocolo_convenio e,
	tiss_conta_guia b,
	convenio c
where	a.nr_atendimento	= d.nr_atendimento
and	e.nr_seq_protocolo	= a.nr_seq_protocolo
and	e.ie_status_protocolo	= 2 --Protocolos fechados
and	e.dt_envio		is not null --E enviados
and	c.cd_convenio		= a.cd_convenio_parametro
and	a.nr_interno_conta	= b.nr_interno_conta;

