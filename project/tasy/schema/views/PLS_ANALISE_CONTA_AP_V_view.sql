-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_analise_conta_ap_v (cd_guia, nr_seq_lote_protocolo, nr_seq_prestador, nm_cooperativa, nr_seq_segurado, dt_analise, ie_status, dt_inicio_analise, ie_origem_analise, nr_sequencia, ie_tipo_guia, nr_seq_analise_ref, nr_seq_grupo_auditor, ie_origem_conta, nm_usuario, nm_usuario_nrec, dt_atualizacao, dt_atualizacao_nrec, dt_prazo_analise, cd_estabelecimento, dt_liberacao_analise, ie_pcmso, nr_seq_regra_lib, ie_pre_analise, nr_fatura, dt_final_analise) AS select	a.cd_guia,
	a.nr_seq_lote_protocolo,
	a.nr_seq_prestador,
	a.nm_cooperativa,
	a.nr_seq_segurado,
	a.dt_analise,
	a.ie_status,
	a.dt_inicio_analise,
	a.ie_origem_analise,
	a.nr_sequencia,
	a.ie_tipo_guia,
	a.nr_seq_analise_ref,
	a.nr_seq_grupo_auditor,
	a.ie_origem_conta,
	a.nm_usuario,
	a.nm_usuario_nrec,
	a.dt_atualizacao,
	a.dt_atualizacao_nrec,
	a.dt_prazo_analise,
	a.cd_estabelecimento,
	a.dt_liberacao_analise,
	a.ie_pcmso,
	a.nr_seq_regra_lib,
	a.ie_pre_analise,
	a.nr_fatura,
	a.dt_final_analise
FROM	pls_analise_conta	a
where	a.ie_origem_analise	!= 7

union all

select	x.cd_guia,
	x.nr_seq_lote_protocolo,
	x.nr_seq_prestador,
	x.nm_cooperativa,
	x.nr_seq_segurado,
	x.dt_analise,
	x.ie_status,
	x.dt_inicio_analise,
	x.ie_origem_analise,
	x.nr_sequencia,
	x.ie_tipo_guia,
	y.nr_seq_analise_ref, -- utiliza neste caso a analise referencia, da analise de discussão, para chegar a analise principal
	x.nr_seq_grupo_auditor,
	x.ie_origem_conta,
	x.nm_usuario,
	x.nm_usuario_nrec,
	x.dt_atualizacao,
	x.dt_atualizacao_nrec,
	x.dt_prazo_analise,
	x.cd_estabelecimento,
	x.dt_liberacao_analise,
	x.ie_pcmso,
	x.nr_seq_regra_lib,
	x.ie_pre_analise,
	x.nr_fatura,
	x.dt_final_analise
from	pls_analise_conta	x,
	pls_analise_conta	y
where	y.nr_sequencia		= x.nr_seq_analise_ref
-- Busca somente as analises de Discussão de contestação - Pós estabelecido
and	x.ie_origem_analise	= 7;

