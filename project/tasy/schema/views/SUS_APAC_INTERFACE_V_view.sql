-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW sus_apac_interface_v (nr_sequencia, nr_seq_protocolo, nr_atendimento, nr_interno_conta, cd_unidade, nr_apac, dt_emissao, dt_inicio_validade, dt_fim_validade, cd_tratamento, ie_tipo_apac, nr_cpf, nm_paciente, ap_ufnasc, nome_mae_pac, ds_endereco, nr_endereco, ds_complemento, cd_cep, ap_codmun, dt_nascimento, ie_sexo, ap_varia, cpf_medico, nm_medico, cd_motivo_cobranca, dt_ocorrencia, dt_competencia, nr_cartao_nac_sus, nr_cartao_nac_sus_medico, nm_diretor_ups, cd_cns_diretor, cpf_diretor_ups, cd_proc_principal) AS Select	a.nr_sequencia,
	b.nr_seq_protocolo, 
	b.nr_atendimento, 
	b.nr_interno_conta, 
	a.cd_unidade, 
	a.nr_apac, 
	to_char(a.dt_emissao,'YYYYMMDD') dt_emissao, 
	to_char(a.dt_inicio_validade,'YYYYMMDD') dt_inicio_validade, 
	to_char(a.dt_fim_validade,'YYYYMMDD') dt_fim_validade, 
	a.cd_tratamento, 
	a.ie_tipo_apac, 
	d.nr_cpf, 
	substr(obter_nome_pf_pj(c.cd_pessoa_fisica, null),1,100) nm_paciente, 
	--substr(obter_uf_localidade(d.nr_cep_cidade_nasc),1,2) ap_ufnasc, 
	substr(obter_naturalidade_pf(d.cd_pessoa_fisica,'UF'),1,2) ap_ufnasc, 
	substr(obter_compl_pf(c.cd_pessoa_fisica, 5,'N'),1,100) nome_mae_pac, 
	substr(obter_compl_pf(c.cd_pessoa_fisica, 1,'EN'),1,200) ds_endereco, 
	substr(coalesce(obter_compl_pf(c.cd_pessoa_fisica, 1,'NR'),'S/N'),1,20) nr_endereco, 
	substr(obter_compl_pf(c.cd_pessoa_fisica, 1,'CO'),1,150) ds_complemento, 
	substr(obter_compl_pf(c.cd_pessoa_fisica, 1,'CEP'),1,20) cd_cep, 
	substr(obter_compl_pf(c.cd_pessoa_fisica, 1,'CDM'),1,100) ap_codmun, 
	to_char(d.dt_nascimento,'YYYYMMDD') dt_nascimento, 
	d.ie_sexo, 
	substr(obter_campo_varia_apac(a.nr_sequencia,a.cd_varia_atrib),1,200) ap_varia, 
	substr(obter_cpf_pessoa_fisica(a.cd_medico_resp),1,30) cpf_medico, 
	substr(obter_nome_pf_pj(a.cd_medico_resp,null),1,100) nm_medico, 
	a.cd_motivo_cobranca, 
	to_char(a.dt_ocorrencia,'YYYYMMDD') dt_ocorrencia, 
	to_char(a.dt_competencia,'YYYYMMDD') dt_competencia, 
	a.nr_cartao_nac_sus, 
	substr(obter_dados_pf(a.cd_medico_resp,'CNS'),1,30) nr_cartao_nac_sus_medico, 
	substr(Apac_Obter_Diretor_Ups(a.nr_sequencia,'N'),1,60) nm_diretor_ups, 
	substr(Apac_Obter_Diretor_Ups(a.nr_sequencia,'CNS'),1,15) cd_cns_diretor, 
	substr(obter_cpf_pessoa_fisica(Apac_Obter_Diretor_Ups(a.nr_sequencia,'C')),1,11) cpf_diretor_ups, 
	cd_proc_principal 
FROM	pessoa_fisica d, 
	atendimento_paciente c, 
	conta_paciente b, 
	sus_apac_movto a 
where	a.nr_interno_conta	= b.nr_interno_conta 
and	b.nr_atendimento	= c.nr_atendimento 
and	c.cd_pessoa_fisica	= d.cd_pessoa_fisica 
order by a.nr_sequencia;

