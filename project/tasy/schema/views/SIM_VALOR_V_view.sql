-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW sim_valor_v (nr_sequencia, nr_seq_sim, nr_interno_conta, nr_seq_resumo, dt_atualizacao, nm_usuario, qt_resumo, vl_medico, vl_auxiliares, vl_custo_operacional, vl_anestesista, vl_materiais, vl_procedimento, vl_material, vl_repasse_terceiro, vl_imposto, vl_desconto, vl_custo, vl_custo_dir_apoio, vl_custo_mao_obra, vl_custo_direto, vl_custo_indireto, vl_custo_variavel, vl_despesa, vl_custo_sadt, nr_seq_regra, vl_custo_hm, dt_atualizacao_nrec, nm_usuario_nrec, nr_seq_item, vl_custo_resumo, ie_proc_mat, nr_seq_sim_pacote, qt_pacote, vl_pacote, vl_procedimento_resumo, vl_mat_resumo, qt_quantidade_resumo, cd_setor_atendimento, cd_conta_contabil, cd_especialidade, cd_estrutura_conta, nr_seq_grupo_rec, ds_item, ie_mat_proc, cd_item, ie_origem_proced) AS select	a.NR_SEQUENCIA,a.NR_SEQ_SIM,a.NR_INTERNO_CONTA,a.NR_SEQ_RESUMO,a.DT_ATUALIZACAO,a.NM_USUARIO,a.QT_RESUMO,a.VL_MEDICO,a.VL_AUXILIARES,a.VL_CUSTO_OPERACIONAL,a.VL_ANESTESISTA,a.VL_MATERIAIS,a.VL_PROCEDIMENTO,a.VL_MATERIAL,a.VL_REPASSE_TERCEIRO,a.VL_IMPOSTO,a.VL_DESCONTO,a.VL_CUSTO,a.VL_CUSTO_DIR_APOIO,a.VL_CUSTO_MAO_OBRA,a.VL_CUSTO_DIRETO,a.VL_CUSTO_INDIRETO,a.VL_CUSTO_VARIAVEL,a.VL_DESPESA,a.VL_CUSTO_SADT,a.NR_SEQ_REGRA,a.VL_CUSTO_HM,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC,a.NR_SEQ_ITEM,a.VL_CUSTO_RESUMO,a.IE_PROC_MAT,a.NR_SEQ_SIM_PACOTE,a.QT_PACOTE,a.VL_PACOTE,
	b.vl_procedimento vl_procedimento_resumo,
	b.vl_material vl_mat_resumo,
	--b.vl_custo vl_custo_resumo,        O campo vl_custo_resumo foi criado na tabela sim_valor
	b.qt_resumo qt_quantidade_resumo,
	b.cd_setor_atendimento,
	b.cd_conta_contabil,
	b.cd_especialidade,
	b.cd_estrutura_conta,
	b.nr_seq_grupo_rec,
	substr(obter_desc_proc_mat(b.cd_material, b.cd_procedimento, b.ie_origem_proced),1,240) ds_item,
	CASE WHEN b.cd_material IS NULL THEN 'P'  ELSE 'M' END  ie_mat_proc,
	coalesce(b.cd_material,b.cd_procedimento) cd_item,
	b.ie_origem_proced
FROM	conta_paciente_resumo b,
	sim_valor a
where	a.nr_seq_resumo		= b.nr_sequencia
and	a.nr_interno_conta	= b.nr_interno_conta
and 	a.nr_seq_resumo		> 0

union all

select	a.NR_SEQUENCIA,a.NR_SEQ_SIM,a.NR_INTERNO_CONTA,a.NR_SEQ_RESUMO,a.DT_ATUALIZACAO,a.NM_USUARIO,a.QT_RESUMO,a.VL_MEDICO,a.VL_AUXILIARES,a.VL_CUSTO_OPERACIONAL,a.VL_ANESTESISTA,a.VL_MATERIAIS,a.VL_PROCEDIMENTO,a.VL_MATERIAL,a.VL_REPASSE_TERCEIRO,a.VL_IMPOSTO,a.VL_DESCONTO,a.VL_CUSTO,a.VL_CUSTO_DIR_APOIO,a.VL_CUSTO_MAO_OBRA,a.VL_CUSTO_DIRETO,a.VL_CUSTO_INDIRETO,a.VL_CUSTO_VARIAVEL,a.VL_DESPESA,a.VL_CUSTO_SADT,a.NR_SEQ_REGRA,a.VL_CUSTO_HM,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC,a.NR_SEQ_ITEM,a.VL_CUSTO_RESUMO,a.IE_PROC_MAT,a.NR_SEQ_SIM_PACOTE,a.QT_PACOTE,a.VL_PACOTE,
	b.vl_procedimento vl_procedimento_resumo,
	0 vl_mat_resumo,
	--0 vl_custo_resumo,	O campo vl_custo_resumo foi criado na tabela sim_valor
	b.qt_procedimento qt_quantidade_resumo,
	b.cd_setor_atendimento,
	b.cd_conta_contabil,
	b.cd_especialidade,
	b.ie_emite_conta cd_estrutura_conta,
	b.nr_seq_grupo_rec,
	substr(obter_descricao_procedimento(b.cd_procedimento, b.ie_origem_proced),1,240) ds_item,
	a.ie_proc_mat ie_mat_proc,
	b.cd_procedimento cd_item,
	b.ie_origem_proced
from	procedimento_paciente b,
	sim_valor a
where	a.nr_seq_item		= b.nr_sequencia
and	a.nr_interno_conta	= b.nr_interno_conta
and 	a.nr_seq_resumo		= 0
and 	a.ie_proc_mat		= 'P'

union all

select	a.NR_SEQUENCIA,a.NR_SEQ_SIM,a.NR_INTERNO_CONTA,a.NR_SEQ_RESUMO,a.DT_ATUALIZACAO,a.NM_USUARIO,a.QT_RESUMO,a.VL_MEDICO,a.VL_AUXILIARES,a.VL_CUSTO_OPERACIONAL,a.VL_ANESTESISTA,a.VL_MATERIAIS,a.VL_PROCEDIMENTO,a.VL_MATERIAL,a.VL_REPASSE_TERCEIRO,a.VL_IMPOSTO,a.VL_DESCONTO,a.VL_CUSTO,a.VL_CUSTO_DIR_APOIO,a.VL_CUSTO_MAO_OBRA,a.VL_CUSTO_DIRETO,a.VL_CUSTO_INDIRETO,a.VL_CUSTO_VARIAVEL,a.VL_DESPESA,a.VL_CUSTO_SADT,a.NR_SEQ_REGRA,a.VL_CUSTO_HM,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC,a.NR_SEQ_ITEM,a.VL_CUSTO_RESUMO,a.IE_PROC_MAT,a.NR_SEQ_SIM_PACOTE,a.QT_PACOTE,a.VL_PACOTE,
	0 vl_procedimento_resumo,
	b.vl_material vl_mat_resumo,
	--0 vl_custo_resumo,		O campo vl_custo_resumo foi criado na tabela sim_valor
	b.qt_material qt_quantidade_resumo,
	b.cd_setor_atendimento,
	b.cd_conta_contabil,
	b.cd_especialidade,
	b.ie_emite_conta cd_estrutura_conta,
	b.nr_seq_grupo_rec,
	substr(obter_desc_material(b.cd_material),1,240) ds_item,
	a.ie_proc_mat ie_mat_proc,
	b.cd_material cd_item,
	null
from	material_atend_paciente b,
	sim_valor a
where	a.nr_seq_item		= b.nr_sequencia
and	a.nr_interno_conta	= b.nr_interno_conta
and 	a.nr_seq_resumo		= 0
and 	a.ie_proc_mat		= 'M';

