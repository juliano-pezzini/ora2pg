-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW cpoe_dieta_mat_add_v (nr_sequencia, nr_atendimento, ds_prod, cd_mat_prod, cd_unid_prod, qt_dose_prod, nr_ocorrencia, ie_via_leite, qt_conversao, dt_inicio, dt_fim, nm_usuario, dt_liberacao, ie_tipo_dieta, nr_seq_disp_succao, cd_intervalo, cd_pessoa_fisica, dt_lib_suspensao, ds_horarios) AS select	nr_sequencia,
		nr_atendimento,
		'DPROD1' ds_prod,
		cd_mat_prod1 cd_mat_prod,
		cd_unid_med_prod1 cd_unid_prod,
		qt_dose_prod1 qt_dose_prod,
		nr_ocorrencia,
		ie_via_leite1 ie_via_leite,
		coalesce(obter_conversao_ml(cd_mat_prod1,qt_dose_prod1,cd_unid_med_prod1),0) qt_conversao,
		dt_inicio,
		CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE coalesce(dt_suspensao,dt_fim) END  dt_fim,
		nm_usuario,
		dt_liberacao,
		ie_tipo_dieta,
		nr_seq_disp_succao,
		cd_intervalo,
		cd_pessoa_fisica,
		dt_lib_suspensao,
		ds_horarios
FROM	cpoe_dieta
where	((CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE coalesce(dt_suspensao,dt_fim) END  is null) or (CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE coalesce(dt_suspensao,dt_fim) END  >= trunc(LOCALTIMESTAMP,'mi')))
and		cd_mat_prod1 is not null

union all

select	nr_sequencia,
		nr_atendimento,
		'DPROD2',
		cd_mat_prod2,
		cd_unid_med_prod2,
		qt_dose_prod2,
		nr_ocorrencia,
		ie_via_leite2,
		coalesce(obter_conversao_ml(cd_mat_prod2,qt_dose_prod2,cd_unid_med_prod2),0) qt_conversao,
		dt_inicio,
		CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE coalesce(dt_suspensao,dt_fim) END  dt_fim,
		nm_usuario,
		dt_liberacao,
		ie_tipo_dieta,
		nr_seq_disp_succao,
		cd_intervalo,
		cd_pessoa_fisica,
		dt_lib_suspensao,
		ds_horarios
from	cpoe_dieta
where	((CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE coalesce(dt_suspensao,dt_fim) END  is null) or (CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE coalesce(dt_suspensao,dt_fim) END  >= trunc(LOCALTIMESTAMP,'mi')))
and		cd_mat_prod2 is not null

union all

select	nr_sequencia,
		nr_atendimento,
		'DPROD3',
		cd_mat_prod3,
		cd_unid_med_prod3,
		qt_dose_prod3,
		nr_ocorrencia,
		ie_via_leite3,
		coalesce(obter_conversao_ml(cd_mat_prod3,qt_dose_prod3,cd_unid_med_prod3),0) qt_conversao,
		dt_inicio,
		CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE coalesce(dt_suspensao,dt_fim) END  dt_fim,
		nm_usuario,
		dt_liberacao,
		ie_tipo_dieta,
		nr_seq_disp_succao,
		cd_intervalo,
		cd_pessoa_fisica,
		dt_lib_suspensao,
		ds_horarios
from	cpoe_dieta
where	((CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE coalesce(dt_suspensao,dt_fim) END  is null) or (CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE coalesce(dt_suspensao,dt_fim) END  >= trunc(LOCALTIMESTAMP,'mi')))
and		cd_mat_prod3 is not null

union all

select	nr_sequencia,
		nr_atendimento,
		'DPROD4',
		cd_mat_prod4,
		cd_unid_med_prod4,
		qt_dose_prod4,
		nr_ocorrencia,
		ie_via_leite4,
		coalesce(obter_conversao_ml(cd_mat_prod4,qt_dose_prod4,cd_unid_med_prod4),0) qt_conversao,
		dt_inicio,
		CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE coalesce(dt_suspensao,dt_fim) END  dt_fim,
		nm_usuario,
		dt_liberacao,
		ie_tipo_dieta,
		nr_seq_disp_succao,
		cd_intervalo,
		cd_pessoa_fisica,
		dt_lib_suspensao,
		ds_horarios
from	cpoe_dieta
where	((CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE coalesce(dt_suspensao,dt_fim) END  is null) or (CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE coalesce(dt_suspensao,dt_fim) END  >= trunc(LOCALTIMESTAMP,'mi')))
and	cd_mat_prod4 is not null

union all

select	nr_sequencia,
		nr_atendimento,
		'DPROD5',
		cd_mat_prod5,
		cd_unid_med_prod5,
		qt_dose_prod5,
		nr_ocorrencia,
		ie_via_leite5,
		coalesce(obter_conversao_ml(cd_mat_prod5,qt_dose_prod5,cd_unid_med_prod5),0) qt_conversao,
		dt_inicio,
		CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE coalesce(dt_suspensao,dt_fim) END  dt_fim,
		nm_usuario,
		dt_liberacao,
		ie_tipo_dieta,
		nr_seq_disp_succao,
		cd_intervalo,
		cd_pessoa_fisica,
		dt_lib_suspensao,
		ds_horarios
from	cpoe_dieta
where	((CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE coalesce(dt_suspensao,dt_fim) END  is null) or (CASE WHEN dt_lib_suspensao IS NULL THEN  dt_fim  ELSE coalesce(dt_suspensao,dt_fim) END  >= trunc(LOCALTIMESTAMP,'mi')))
and		cd_mat_prod5 is not null;

