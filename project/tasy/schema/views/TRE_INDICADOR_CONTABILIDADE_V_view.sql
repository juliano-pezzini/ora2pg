-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW tre_indicador_contabilidade_v (ds_estabelecimento, cd_estabelecimento, ds_tipo_lote_contabil, cd_tipo_lote_contabil, ds_status, ie_situacao, dt_referencia, nr_lote_contabil, vl_tot_debito, vl_tot_credito, vl_diferenca) AS (

SELECT  obter_nome_estabelecimento(a.cd_estabelecimento) ds_estabelecimento,
        a.cd_estabelecimento,
        substr(obter_descricao_padrao('TIPO_LOTE_CONTABIL', 'DS_TIPO_LOTE_CONTABIL',a.cd_tipo_lote_contabil),1,40) DS_TIPO_LOTE_CONTABIL,
        a.cd_tipo_lote_contabil,
        substr(obter_status_lote_contabil(nr_lote_contabil),1,20) DS_STATUS,
        a.ie_situacao,
        a.dt_referencia,
        a.nr_lote_contabil,
        Sum(a.vl_debito) vl_tot_debito,
        Sum(a.vl_credito) vl_tot_credito,
        Sum(a.vl_debito - a.vl_credito) vl_diferenca
FROM    lote_contabil a
GROUP BY  a.cd_estabelecimento,
          a.cd_tipo_lote_contabil,
          a.dt_referencia,
          obter_status_lote_contabil(nr_lote_contabil),
          a.ie_situacao,
          nr_lote_contabil
);

