-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW bft_discharge_summary_v (nr_sequencia, encounter_id, release_date, discharge_date, type_discharge_code, type_discharge, discharge_doctor_given_name, discharge_doctor_last_name, discharge_doctor_middle_name, discharge_doctor_name, discharge_doctor_speciality, provider_address, provider_code, provider_neighborhood_name, provider_home_phone_number, provider_email, provider_hpii) AS select a.nr_sequencia,
  a.nr_atendimento encounter_id,
  a.dt_liberacao release_date,
  a.dt_alta discharge_date,
  a.cd_motivo_alta type_discharge_code,
  obter_desc_motivo_alta(a.cd_motivo_alta) type_discharge,
  obter_dados_pf(a.cd_medico_resp_alta,'PNG') discharge_doctor_given_name,
  obter_dados_pf(a.cd_medico_resp_alta,'PNL') discharge_doctor_last_name,
  obter_dados_pf(a.cd_medico_resp_alta,'PNM') discharge_doctor_middle_name,
  obter_dados_pf(a.cd_medico_resp_alta,'PNC') discharge_doctor_name,
  substr(obter_especialidade_medico(cd_medico_resp_alta,'D'),1,200) discharge_doctor_speciality,
  b.ds_endereco provider_address,
  b.cd_cep provider_code,
  b.ds_bairro provider_neighborhood_name,
  b.nr_telefone provider_home_phone_number,
  b.ds_email provider_email,
  get_person_ihi(a.cd_medico_resp_alta,'P') provider_hpii
FROM atend_sumario_alta a
left outer join compl_pessoa_fisica b
on a.cd_medico_resp_alta  = b.cd_pessoa_fisica
and b.ie_tipo_complemento = 1;

