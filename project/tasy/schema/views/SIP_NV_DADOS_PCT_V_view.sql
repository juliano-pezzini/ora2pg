-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW sip_nv_dados_pct_v (nr_sequencia, cd_procedimento, ie_origem_proced, ie_tipo_despesa, nr_seq_conta_proc, nr_seq_conta, nr_seq_lote_sip, nr_seq_pacote, dt_item_referencia, nr_seq_prestador_exec, ie_tipo_guia, dt_mes_competencia, dt_item_ref_comp, cd_procedimento_pct, ie_origem_proced_pct, qt_itens_aberto) AS select	a.nr_sequencia,
	a.cd_procedimento,
	a.ie_origem_proced,
	a.ie_tipo_despesa,
	a.nr_seq_conta_proc,
	a.nr_seq_conta,
	a.nr_seq_lote_sip,
	a.nr_seq_pacote,
	a.dt_item_referencia,
	a.nr_seq_prestador_exec,
	a.ie_tipo_guia,
	a.dt_mes_competencia,
	coalesce(a.dt_item_referencia, a.dt_mes_competencia) dt_item_ref_comp,
	a.cd_procedimento_pct,
	a.ie_origem_proced_pct,
	(select	count(1)
        FROM	pls_conta_proc z
        where	z.nr_seq_proc_princ	= a.nr_seq_conta_proc
        and	z.nr_seq_preco_pacote	is not null
        and	z.ie_tipo_despesa	in ('1','2','3')) qt_itens_aberto
from	sip_nv_dados	a
where	a.ie_tipo_despesa	= '4';

