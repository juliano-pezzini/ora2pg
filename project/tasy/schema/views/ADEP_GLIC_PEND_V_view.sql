-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW adep_glic_pend_v (nr_seq_apresent, ie_tipo_item, ds_tipo_item, ds_tipo_item_plural, nr_atendimento, nr_prescricao, cd_prescritor, nm_prescritor, dt_prescricao, dt_inicio_prescr, dt_validade_prescr, dt_liberacao, nr_seq_item, ie_acm_sn, ie_di, cd_item, ds_item, ds_diluente, ds_topografia, ie_assoc_adep, nr_seq_horario, dt_horario, qt_pend, cd_um, qt_dose, cd_unidade_medida_dose, ie_via, cd_pessoa_evento, nm_pessoa_evento) AS select	8 nr_seq_apresent,
		'G' ie_tipo_item, 
		'CCG' ds_tipo_item, 
		'CCG' ds_tipo_item_plural, 
		a.nr_atendimento, 
		a.nr_prescricao, 
		a.cd_prescritor, 
		substr(obter_nome_pf(a.cd_prescritor),1,60) nm_prescritor, 
		a.dt_prescricao, 
		a.dt_inicio_prescr, 
		a.dt_validade_prescr, 
		a.dt_liberacao, 
		b.nr_sequencia nr_seq_item, 
		CASE WHEN coalesce(b.ie_acm,'N')='S' THEN  'S'  ELSE CASE WHEN coalesce(b.ie_se_necessario,'N')='S' THEN  'S'  ELSE 'N' END  END  ie_acm_sn, 
		'N' ie_di, 
		to_char(b.cd_procedimento) cd_item, 
		substr(obter_desc_prescr_proc(b.cd_procedimento, b.ie_origem_proced, b.nr_seq_proc_interno),1,240) ds_item, 
		null ds_diluente, 
		substr(obter_desc_topografia_dor(b.nr_seq_topografia),1,60) ds_topografia, 
		substr(obter_se_assoc_proc_adep(b.cd_procedimento,b.ie_origem_proced),1,1) ie_assoc_adep, 
		c.nr_sequencia nr_seq_horario, 
		c.dt_horario, 
		1 qt_pend, 
		'' cd_um, 
		1 qt_dose, 
		'' cd_unidade_medida_dose, 
		'' ie_via, 
		'' cd_pessoa_evento, 
		'' nm_pessoa_evento 
FROM	prescr_proc_hor c, 
		prescr_procedimento b, 
		prescr_medica a, 
		pep_protocolo_glicemia d 
where	c.nr_seq_procedimento = b.nr_sequencia 
and		c.nr_prescricao = b.nr_prescricao 
and		b.nr_prescricao = a.nr_prescricao 
and		b.nr_seq_prot_glic = d.nr_sequencia 
and		d.ie_tipo = 'C' 
and		coalesce(c.dt_fim_horario,c.dt_suspensao) is null 
and		coalesce(c.ie_situacao,'A') = 'A' 
and		coalesce(c.ie_horario_especial,'N') = 'N' 
and		coalesce(b.nr_seq_solic_sangue,b.nr_seq_derivado,b.nr_seq_exame) is null 
and		b.nr_seq_proc_interno is not null 
and		b.nr_seq_prot_glic is not null 
and		coalesce(a.ie_adep,'S') = 'S' 
and		c.dt_lib_horario is not null 
and		a.dt_prescricao > LOCALTIMESTAMP - interval '500 days' 
and		c.dt_horario > LOCALTIMESTAMP - interval '500 days';

