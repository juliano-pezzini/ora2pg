-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW tre_ind_gestao_recurso_glosa_v (nr_sequencia, cd_procedimento, ds_item, cd_motivo_glosa, ds_motivo_glosa, ie_acao_glosa, ds_acao_glosa, cd_convenio, ds_convenio, dt_lote, vl_glosa_total, vl_glosa_aceita, vl_reapresentacao) AS select      b.nr_sequencia,
            substr(obter_dados_lote_audit_item(a.nr_sequencia,'CP'),1,255) cd_procedimento,
            substr(obter_dados_lote_audit_item(a.nr_sequencia,'IT'),1,255) ds_item,
            a.cd_motivo_glosa,
            substr(obter_desc_motivo_glosa(a.cd_motivo_glosa),1,255) ds_motivo_glosa,
            a.ie_acao_glosa,
            obter_valor_dominio('1405',a.ie_acao_glosa) ds_acao_glosa,
    b.cd_convenio,
    obter_nome_convenio(b.cd_convenio) ds_convenio,
         b.dt_lote,
         sum(a.vl_glosa_informada) vl_glosa_total,
         sum(a.vl_glosa) vl_glosa_aceita,
         sum(a.vl_amenor) vl_reapresentacao
 FROM    LOTE_AUDIT_HIST_ITEM a,
    lote_auditoria b
 where      a.nr_seq_lote = b.nr_sequencia
 group by   obter_dados_lote_audit_item(a.nr_sequencia,'IT'),
            obter_dados_lote_audit_item(a.nr_sequencia,'CP'),
            b.dt_lote,
            obter_desc_motivo_glosa(a.cd_motivo_glosa),
            obter_valor_dominio('1405',a.ie_acao_glosa),
            b.cd_convenio,
            a.cd_motivo_glosa,
            a.ie_acao_glosa,
            b.nr_sequencia;

