-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW tiss_internacao_obstetrica_v (ds_versao, nr_atendimento, ie_gestacao, ie_aborto, ie_transtorno, ie_complicacao_puerperio, ie_complicacao_neonatal, ie_baixo_peso, ie_parto_cesaria, ie_parto_normal, qt_nasc_mortos, qt_nasc_vivos, ie_obito, ie_atend_rn_sala_parto, qt_nasc_vivos_prematuros) AS select	'2.01.01' ds_versao,
	a.nr_atendimento,
	substr(tiss_obter_dados_parto_nasc(a.nr_atendimento, 2500, 'G'),1,2) ie_gestacao,
	substr(tiss_obter_dados_parto_nasc(a.nr_atendimento, 2500, 'A'),1,2) ie_aborto,
	substr(tiss_obter_dados_parto_nasc(a.nr_atendimento, 2500, 'T'),1,2) ie_transtorno,
	substr(tiss_obter_dados_parto_nasc(a.nr_atendimento, 2500, 'P'),1,2) ie_complicacao_puerperio,
	substr(tiss_obter_dados_parto_nasc(a.nr_atendimento, 2500, 'N'),1,2) ie_complicacao_neonatal,
	substr(tiss_obter_dados_parto_nasc(a.nr_atendimento, 2500, 'B'),1,2) ie_baixo_peso,
	CASE WHEN b.ie_parto_cesaria='S' THEN  1  ELSE 0 END  ie_parto_cesaria,
	CASE WHEN b.ie_parto_normal='S' THEN  1  ELSE 0 END  ie_parto_normal,
	b.qt_nasc_mortos,
	b.qt_nasc_vivos,
	null ie_obito,
	substr(tiss_obter_dados_parto_nasc(a.nr_atendimento, 2500, 'S'),1,2) ie_atend_rn_sala_parto,
	substr(tiss_obter_dados_parto_nasc(a.nr_atendimento, 2500, 'QT'),1,5) QT_NASC_VIVOS_PREMATUROS
FROM pessoa_fisica c, atendimento_paciente a
LEFT OUTER JOIN parto b ON (a.nr_atendimento = b.nr_atendimento)
WHERE substr(tiss_obter_clinica(a.ie_clinica, a.nr_seq_classificacao),1,3) = 3 and a.ie_tipo_atendimento	= 1  and a.cd_pessoa_fisica	= c.cd_pessoa_fisica;

