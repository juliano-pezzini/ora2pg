-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW les_prestador_v (cd_pessoa_fisica, situacao, cd_prestador, uf, municipio, cd_municipio_ibge, tipo_prestador, dt_atualizacao, dt_atualizacao_nrec, nm_usuario, nm_usuario_nrec, ie_guia_medico, nr_seq_prest, nm_prestador, nm_fantasia, cd_cgc, nr_cpf, cd_sistema_ant, email_primario, email_secundario, tp_pessoa, nr_telefone, cd_condicao_pagamento) AS select null CD_PESSOA_FISICA,
  CASE WHEN pr.ie_situacao='A' THEN 'Ativo' WHEN pr.ie_situacao='I' THEN 'Inativo' END  situacao, pr.cd_prestador, pr.sg_uf_sip UF,
case
 when pr.IE_TIPO_ENDERECO = 'PJ'then PJ.DS_MUNICIPIO
else null end municipio,
case
when pr.IE_TIPO_ENDERECO = 'PJ'then PJ.Cd_Municipio_Ibge end CD_MUNICIPIO_IBGE,
(select ptp.ds_tipo_prestador FROM  pls_tipo_prestador ptp where ptp.nr_sequencia = pr.nr_seq_tipo_prestador) tipo_prestador,
pr.dt_atualizacao, pr.dt_atualizacao_nrec, pr.nm_usuario, pr.nm_usuario_nrec, pr.ie_guia_medico, pr.nr_sequencia nr_seq_prest,
pr.nm_interno nm_prestador, pj.nm_fantasia, pr.cd_cgc,  null nr_cpf, pj.CD_SISTEMA_ANT,
(SELECT pja.ds_email FROM PESSOA_JURIDICA_ESTAB pja WHERE pja.Cd_Cgc = pj.cd_cgc) email_primario,
(select  pjc.ds_email from PESSOA_JURIDICA_COMPL pjc where pjc.Cd_Cgc = pj.cd_cgc and pjc.ds_email is not null  LIMIT 1) email_secundario,
'PJ' TP_PESSOA,
pj.nr_ddd_telefone ||'-'|| pj.nr_telefone nr_telefone,
(select aa.cd_condicao_pagamento from PLS_PRESTADOR_PAGTO aa where aa.nr_seq_prestador = pr.nr_sequencia  LIMIT 1) cd_condicao_pagamento
from pls_prestador pr, pessoa_juridica pj
where --pr.ie_tipo_relacao <> 'F'
 pr.cd_cgc = pj.cd_cgc

union

select pf.CD_PESSOA_FISICA ,
 CASE WHEN pr.ie_situacao='A' THEN 'Ativo' WHEN pr.ie_situacao='I' THEN 'Inativo' END  situacao, pr.cd_prestador, pr.sg_uf_sip UF,
case
when pr.IE_TIPO_ENDERECO = 'PFC'then (select cpf.ds_municipio from COMPL_PESSOA_FISICA cpf where cpf.cd_pessoa_fisica = pf.cd_pessoa_fisica and cpf.ie_tipo_complemento = '2')
when pr.IE_TIPO_ENDERECO = 'PFR'then (select cpf.ds_municipio from COMPL_PESSOA_FISICA cpf where cpf.cd_pessoa_fisica = pf.cd_pessoa_fisica and cpf.ie_tipo_complemento = '1')
else null end municipio,
case
when pr.IE_TIPO_ENDERECO = 'PFC'then (select cpf.cd_municipio_ibge from COMPL_PESSOA_FISICA cpf where cpf.cd_pessoa_fisica = pf.cd_pessoa_fisica and cpf.ie_tipo_complemento = '2')
when pr.IE_TIPO_ENDERECO = 'PFR'then (select cpf.cd_municipio_ibge from COMPL_PESSOA_FISICA cpf where cpf.cd_pessoa_fisica = pf.cd_pessoa_fisica and cpf.ie_tipo_complemento = '1')
else null end CD_MUNICIPIO_IBGE,
(select ptp.ds_tipo_prestador from  pls_tipo_prestador ptp where ptp.nr_sequencia = pr.nr_seq_tipo_prestador) tipo_prestador,
pr.dt_atualizacao, pr.dt_atualizacao_nrec, pr.nm_usuario, pr.nm_usuario_nrec, pr.ie_guia_medico, pr.nr_sequencia nr_seq_prest,
pr.nm_interno nm_prestador, pf.NM_PESSOA_FISICA nm_fantasia, pr.cd_cgc, pf.nr_cpf, pf.cd_sistema_ant,
case
when pr.IE_TIPO_ENDERECO = 'PFC'then (select cpf.ds_email from COMPL_PESSOA_FISICA cpf where cpf.cd_pessoa_fisica = pf.cd_pessoa_fisica and cpf.ie_tipo_complemento = '2')
when pr.IE_TIPO_ENDERECO = 'PFR'then (select cpf.ds_email from COMPL_PESSOA_FISICA cpf where cpf.cd_pessoa_fisica = pf.cd_pessoa_fisica and cpf.ie_tipo_complemento = '1')
else null end email_primario,
(select cpf.ds_email from COMPL_PESSOA_FISICA cpf where cpf.cd_pessoa_fisica = pf.cd_pessoa_fisica  LIMIT 1)
   email_secundario, 'PF' TP_PESSOA,
case
when pr.IE_TIPO_ENDERECO = 'PFC'then (select cpf.nr_ddd_telefone||'-'|| cpf.nr_telefone from COMPL_PESSOA_FISICA cpf where cpf.cd_pessoa_fisica = pf.cd_pessoa_fisica and cpf.ie_tipo_complemento = '2')
when pr.IE_TIPO_ENDERECO = 'PFR'then (select cpf.nr_ddd_telefone||'-'|| cpf.nr_telefone from COMPL_PESSOA_FISICA cpf where cpf.cd_pessoa_fisica = pf.cd_pessoa_fisica and cpf.ie_tipo_complemento = '1')
else null end nr_telefone,
(select aa.cd_condicao_pagamento from PLS_PRESTADOR_PAGTO aa where aa.nr_seq_prestador = pr.nr_sequencia  LIMIT 1) cd_condicao_pagamento
from pls_prestador pr, pessoa_fisica pf
where -- pr.ie_tipo_relacao <> 'F'
   pr.CD_PESSOA_FISICA = pf.CD_PESSOA_FISICA;

