-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW total_contas_receber_v (cd_estabelecimento, nr_titulo, cd_pessoa_fisica, cd_cgc, ie_situacao, ie_tipo_titulo, ie_origem_titulo, nr_seq_classe, cd_moeda, dt_contabil, dt_emissao, dt_liquidacao, dt_vencimento, dt_pagamento_previsto, vl_titulo, vl_recebido, vl_impostos, vl_desconto, vl_saldo, vl_saldo_pj, vl_saldo_pf) AS SELECT	cd_estabelecimento,
		nr_titulo,
		cd_pessoa_fisica,
		cd_cgc,
		ie_situacao,
		ie_tipo_titulo,
		ie_origem_titulo,
		nr_seq_classe, 
		cd_moeda,
		dt_contabil,
		dt_emissao,
		dt_liquidacao,
		dt_vencimento,
		dt_pagamento_previsto,
		vl_titulo,
		obter_valores_tit_rec(nr_titulo,'R') vl_recebido,
		obter_valores_tit_rec(nr_titulo,'I') vl_impostos,
		obter_valores_tit_rec(nr_titulo,'D') vl_desconto,
		obter_saldo_tit_rec_pos_cont(nr_titulo, fim_mes(dt_pagamento_previsto)) vl_saldo,
		CASE WHEN cd_pessoa_fisica IS NULL THEN obter_saldo_tit_rec_pos_cont(nr_titulo, fim_mes(dt_pagamento_previsto))  ELSE 0 END  vl_saldo_pj,
		CASE WHEN cd_cgc IS NULL THEN obter_saldo_tit_rec_pos_cont(nr_titulo, fim_mes(dt_pagamento_previsto))  ELSE 0 END  vl_saldo_pf
FROM 	titulo_receber;

