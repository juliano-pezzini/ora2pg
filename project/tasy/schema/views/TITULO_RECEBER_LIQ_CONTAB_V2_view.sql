-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW titulo_receber_liq_contab_v2 (nr_lote_contabil, nr_titulo, vl_transacao, nr_seq_trans_fin, dt_recebimento, nr_seq_conta_banco, ds_atributo, cd_centro_custo, nr_seq_caixa_rec, nr_seq_movto_trans_fin, nr_seq_trans_caixa, nr_documento, nr_seq_baixa, cd_tipo_recebimento, nr_seq_liq_origem, nr_seq_retorno, nr_seq_ret_item, ds_observacao, ie_acao, nr_adiantamento, nr_seq_cobranca, cd_conta_contabil, ie_lote_pro_rata, nr_seq_baixa_cc, cd_moeda) AS select	a.nr_lote_contabil,
	a.nr_titulo,
	CASE WHEN a.ie_acao='I' THEN  coalesce(b.vl_recebido, a.vl_recebido)  ELSE coalesce(b.vl_recebido, a.vl_recebido) * -1 END  vl_transacao,
	a.nr_seq_trans_fin,
	a.dt_recebimento,
	a.nr_seq_conta_banco,
	'VL_RECEBIDO' ds_atributo,
	coalesce(b.cd_centro_custo, cd_centro_custo_desc) cd_centro_custo,
	a.nr_seq_caixa_rec,
	a.nr_seq_movto_trans_fin,
	a.nr_seq_trans_caixa,
	a.nr_documento,
	a.nr_sequencia nr_seq_baixa,
	a.cd_tipo_recebimento,
	a.nr_seq_liq_origem,
	a.nr_seq_retorno, -- aqui
	a.nr_seq_ret_item,
	a.ds_observacao,
	a.ie_acao,
	a.nr_adiantamento,
	a.nr_seq_cobranca,
	null cd_conta_contabil,
	null ie_lote_pro_rata,
	b.nr_sequencia nr_seq_baixa_cc,
	a.cd_moeda
FROM titulo_receber_liq a
LEFT OUTER JOIN titulo_rec_liq_cc b ON (a.nr_titulo = b.nr_titulo AND a.nr_sequencia = b.nr_seq_baixa)
WHERE coalesce(b.vl_recebido, a.vl_recebido) <> 0 and coalesce(ie_lib_caixa, 'S') = 'S'

union all

select	a.nr_lote_contabil,
	a.nr_titulo,
	CASE WHEN a.ie_acao='I' THEN  coalesce(b.vl_desconto, a.vl_descontos)  ELSE coalesce(b.vl_desconto, a.vl_descontos) * -1 END  vl_transacao,
	a.nr_seq_trans_fin,
	a.dt_recebimento,
	a.nr_seq_conta_banco,
	'VL_DESCONTOS' ds_atributo,
	coalesce(b.cd_centro_custo, cd_centro_custo_desc) cd_centro_custo,
	a.nr_seq_caixa_rec,
	a.nr_seq_movto_trans_fin,
	a.nr_seq_trans_caixa,
	a.nr_documento,
	a.nr_sequencia nr_seq_baixa,
	a.cd_tipo_recebimento,
	a.nr_seq_liq_origem,
	a.nr_seq_retorno,
	a.nr_seq_ret_item,
	a.ds_observacao,
	a.ie_acao,
	a.nr_adiantamento,
	a.nr_seq_cobranca,
	b.cd_conta_contabil,
	b.ie_lote_pro_rata,
	b.nr_sequencia nr_seq_baixa_cc,
	a.cd_moeda
FROM titulo_receber_liq a
LEFT OUTER JOIN titulo_rec_liq_cc b ON (a.nr_titulo = b.nr_titulo AND a.nr_sequencia = b.nr_seq_baixa)
WHERE coalesce(a.vl_descontos, b.vl_desconto) <> 0 and coalesce(ie_lib_caixa, 'S') = 'S' and a.nr_seq_trans_fin	is not null
 
union all

select	a.nr_lote_contabil,
	a.nr_titulo,
	CASE WHEN a.ie_acao='I' THEN  coalesce(b.vl_juros, a.vl_juros)  ELSE coalesce(b.vl_juros, a.vl_juros) * -1 END  vl_transacao,
	a.nr_seq_trans_fin,
	a.dt_recebimento,
	a.nr_seq_conta_banco,
	'VL_JUROS',
	coalesce(b.cd_centro_custo, cd_centro_custo_desc) cd_centro_custo,
	a.nr_seq_caixa_rec,
	a.nr_seq_movto_trans_fin,
	a.nr_seq_trans_caixa,
	a.nr_documento,
	a.nr_sequencia nr_seq_baixa,
	a.cd_tipo_recebimento,
	a.nr_seq_liq_origem,
	a.nr_seq_retorno,
	a.nr_seq_ret_item,
	a.ds_observacao,
	a.ie_acao,
	a.nr_adiantamento,
	a.nr_seq_cobranca,
	b.cd_conta_contabil,
	b.ie_lote_pro_rata,
	b.nr_sequencia nr_seq_baixa_cc,
	a.cd_moeda
FROM titulo_receber_liq a
LEFT OUTER JOIN titulo_rec_liq_cc b ON (a.nr_titulo = b.nr_titulo AND a.nr_sequencia = b.nr_seq_baixa)
WHERE coalesce(a.vl_juros, b.vl_juros) <> 0 and a.nr_seq_trans_fin	is not null and coalesce(ie_lib_caixa, 'S') = 'S'
 
union all

select	a.nr_lote_contabil,
	a.nr_titulo,
	CASE WHEN a.ie_acao='I' THEN  coalesce(b.vl_multa, a.vl_multa)  ELSE coalesce(b.vl_multa, a.vl_multa) * -1 END  vl_transacao,
	a.nr_seq_trans_fin,
	a.dt_recebimento,
	a.nr_seq_conta_banco,
	'VL_MULTA' ds_atributo,
	coalesce(b.cd_centro_custo, cd_centro_custo_desc) cd_centro_custo,
	a.nr_seq_caixa_rec,
	a.nr_seq_movto_trans_fin,
	a.nr_seq_trans_caixa,
	a.nr_documento,
	a.nr_sequencia nr_seq_baixa,
	a.cd_tipo_recebimento,
	a.nr_seq_liq_origem,
	a.nr_seq_retorno,
	a.nr_seq_ret_item,
	a.ds_observacao,
	a.ie_acao,
	a.nr_adiantamento,
	a.nr_seq_cobranca,
	b.cd_conta_contabil,
	b.ie_lote_pro_rata,
	b.nr_sequencia nr_seq_baixa_cc,
	a.cd_moeda
FROM titulo_receber_liq a
LEFT OUTER JOIN titulo_rec_liq_cc b ON (a.nr_titulo = b.nr_titulo AND a.nr_sequencia = b.nr_seq_baixa)
WHERE coalesce(a.vl_multa, b.vl_multa) <> 0 and coalesce(ie_lib_caixa, 'S')	= 'S' and a.nr_seq_trans_fin	is not null
 
union all

select	a.nr_lote_contabil,
	a.nr_titulo,
	CASE WHEN a.ie_acao='I' THEN  a.vl_despesa_bancaria  ELSE a.vl_despesa_bancaria * -1 END   vl_transacao,
	a.nr_seq_trans_fin,
	a.dt_recebimento,
	a.nr_seq_conta_banco,
	'VL_DESPESA_BANCARIA' ds_atributo,
	0 cd_centro_custo,
	a.nr_seq_caixa_rec,
	a.nr_seq_movto_trans_fin,
	a.nr_seq_trans_caixa,
	a.nr_documento,
	a.nr_sequencia nr_seq_baixa,
	a.cd_tipo_recebimento,
	a.nr_seq_liq_origem,
	a.nr_seq_retorno,
	a.nr_seq_ret_item,
	a.ds_observacao,
	a.ie_acao,
	a.nr_adiantamento,
	a.nr_seq_cobranca,
	null cd_conta_contabil,
	null ie_lote_pro_rata,
	0 nr_seq_baixa_cc,
	a.cd_moeda
from 	titulo_receber_liq a
where 	a.vl_despesa_bancaria	<> 0
and	coalesce(ie_lib_caixa, 'S') = 'S'

union all

select	a.nr_lote_contabil,
	a.nr_titulo,
	CASE WHEN a.ie_acao='I' THEN  a.vl_glosa  ELSE a.vl_glosa * -1 END   vl_transacao,
	a.nr_seq_trans_fin,
	a.dt_recebimento,
	a.nr_seq_conta_banco,
	'VL_GLOSA' ds_atributo,
	0 cd_centro_custo,
	a.nr_seq_caixa_rec,
	a.nr_seq_movto_trans_fin,
	a.nr_seq_trans_caixa,
	a.nr_documento,
	a.nr_sequencia nr_seq_baixa,
	a.cd_tipo_recebimento,
	a.nr_seq_liq_origem,
	a.nr_seq_retorno,
	a.nr_seq_ret_item,
	a.ds_observacao,
	a.ie_acao,
	a.nr_adiantamento,
	a.nr_seq_cobranca,
	null cd_conta_contabil,
	null ie_lote_pro_rata,
	0 nr_seq_baixa_cc,
	a.cd_moeda
from 	titulo_receber_liq a
where 	a.vl_glosa <> 0
and	coalesce(ie_lib_caixa, 'S') = 'S'

union	all

select	a.nr_lote_contabil,
	a.nr_titulo,
	CASE WHEN a.ie_acao='I' THEN  a.vl_rec_maior  ELSE a.vl_rec_maior * -1 END  vl_transacao,
	a.nr_seq_trans_fin,
	a.dt_recebimento,
	a.nr_seq_conta_banco,
	'VL_REC_MAIOR' ds_atributo,
	0 cd_centro_custo,
	a.nr_seq_caixa_rec,
	a.nr_seq_movto_trans_fin,
	a.nr_seq_trans_caixa,
	a.nr_documento,
	a.nr_sequencia nr_seq_baixa,
	a.cd_tipo_recebimento,
	a.nr_seq_liq_origem,
	a.nr_seq_retorno,
	a.nr_seq_ret_item,
	a.ds_observacao,
	a.ie_acao,
	a.nr_adiantamento,
	a.nr_seq_cobranca,
	null cd_conta_contabil,
	null ie_lote_pro_rata,
	0 nr_seq_baixa_cc,
	a.cd_moeda
from 	titulo_receber_liq a
where 	a.vl_rec_maior		<> 0
and	coalesce(ie_lib_caixa, 'S') = 'S'

union all

select	a.nr_lote_contabil,
	a.nr_titulo,
	CASE WHEN a.ie_acao='I' THEN  coalesce(b.vl_recebido, a.vl_recebido)  ELSE coalesce(b.vl_recebido, a.vl_recebido) * -1 END  vl_transacao,
	a.nr_seq_trans_fin,
	a.dt_recebimento,
	a.nr_seq_conta_banco,
	'VL_RECEBIDO_TESOURARIA' ds_atributo,
	0 cd_centro_custo,
	a.nr_seq_caixa_rec,
	a.nr_seq_movto_trans_fin,
	a.nr_seq_trans_caixa,
	a.nr_documento,
	a.nr_sequencia nr_seq_baixa,
	a.cd_tipo_recebimento,
	a.nr_seq_liq_origem,
	a.nr_seq_retorno,
	a.nr_seq_ret_item,
	a.ds_observacao,
	a.ie_acao,
	a.nr_adiantamento,
	a.nr_seq_cobranca,
	null cd_conta_contabil,
	null ie_lote_pro_rata,
	0 nr_seq_baixa_cc,
	a.cd_moeda
FROM titulo_receber_liq a
LEFT OUTER JOIN titulo_rec_liq_cc b ON (a.nr_titulo = b.nr_titulo AND a.nr_sequencia = b.nr_seq_baixa)
WHERE coalesce(b.vl_recebido, a.vl_recebido) <> 0 and coalesce(ie_lib_caixa, 'S') = 'S'
 
union all

select	a.nr_lote_contabil,
	a.nr_titulo,
	CASE WHEN a.ie_acao='I' THEN  coalesce(b.vl_recebido, a.vl_recebido)  ELSE coalesce(b.vl_recebido, a.vl_recebido) * -1 END  vl_transacao,
	a.nr_seq_trans_fin,
	a.dt_recebimento,
	a.nr_seq_conta_banco,
	'VL_RECEBIDO_CB' ds_atributo,	
        coalesce(b.cd_centro_custo, a.cd_centro_custo_desc) cd_centro_custo,
	a.nr_seq_caixa_rec,
	a.nr_seq_movto_trans_fin,
	a.nr_seq_trans_caixa,
	a.nr_documento,
	a.nr_sequencia nr_seq_baixa,
	a.cd_tipo_recebimento,
	a.nr_seq_liq_origem,
	a.nr_seq_retorno,
	a.nr_seq_ret_item,
	a.ds_observacao,
	a.ie_acao,
	a.nr_adiantamento,
	a.nr_seq_cobranca,
	null cd_conta_contabil,
	null ie_lote_pro_rata,
	b.nr_sequencia nr_seq_baixa_cc,
	a.cd_moeda
FROM titulo_receber_liq a
LEFT OUTER JOIN titulo_rec_liq_cc b ON (a.nr_titulo = b.nr_titulo AND a.nr_sequencia = b.nr_seq_baixa)
WHERE coalesce(b.vl_recebido, a.vl_recebido) <> 0 and coalesce(ie_lib_caixa, 'S') = 'S'
 
union all

select	a.nr_lote_contabil,
	a.nr_titulo,
	coalesce(b.vl_recebido + b.vl_juros + b.vl_multa + b.vl_desconto, a.vl_recebido + a.vl_juros + a.vl_multa + a.vl_descontos)  vl_transacao,
	a.nr_seq_trans_fin,
	a.dt_recebimento,
	a.nr_seq_conta_banco,
	'VL_ORIGINAL_BAIXA' ds_atributo,
	0 cd_centro_custo,
	a.nr_seq_caixa_rec,
	a.nr_seq_movto_trans_fin,
	a.nr_seq_trans_caixa,
	a.nr_documento,
	a.nr_sequencia nr_seq_baixa,
	a.cd_tipo_recebimento,
	a.nr_seq_liq_origem,
	a.nr_seq_retorno,
	a.nr_seq_ret_item,
	a.ds_observacao,
	a.ie_acao,
	a.nr_adiantamento,
	a.nr_seq_cobranca,
	null cd_conta_contabil,
	null ie_lote_pro_rata,
	b.nr_sequencia nr_seq_baixa_cc,
	a.cd_moeda
FROM titulo_receber_liq a
LEFT OUTER JOIN titulo_rec_liq_cc b ON (a.nr_titulo = b.nr_titulo AND a.nr_sequencia = b.nr_seq_baixa)
WHERE coalesce(b.vl_recebido, a.vl_recebido) <> 0 and coalesce(ie_lib_caixa, 'S') = 'S'
 
union all

select	nr_lote_contabil,
	nr_titulo,
	vl_transacao,
	nr_seq_trans_fin,
	dt_recebimento,
	nr_seq_conta_banco,
	ds_atributo,
	cd_centro_custo,
	nr_seq_caixa_rec,
	nr_seq_movto_trans_fin,
	nr_seq_trans_caixa,
	nr_documento,
	nr_seq_baixa,
	cd_tipo_recebimento,
	null nr_seq_liq_origem,
	nr_seq_retorno,
	nr_seq_ret_item,
	ds_observacao,
	ie_acao,
	null nr_adiantamento,
	null nr_seq_cobranca,
	null cd_conta_contabil,
	null ie_lote_pro_rata,
	0 nr_seq_baixa_cc,
	null cd_moeda
from	titulo_receber_liq_ctb_camb_v;

