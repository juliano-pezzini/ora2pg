-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_higienizacao_v (qt_higienizados, dt_periodo, nr_seq_servico, ds_servico, cd_executor, ds_executor, cd_setor_atendimento, ds_unidade, ds_setor, ds_horario_exec, cd_horario_exec, ds_diferenca_exec, cd_diferenca_exec, ie_prioridade, ds_status_unidade, nm_usu_aprov, ds_motivo_interdicao, ds_diferenca, cd_diferenca, ds_diferenca_hora, cd_diferenca_hora, cd_tipo_acomodacao, ds_tipo_acomodacao, cd_motivo_interdicao, ie_status_serv, ds_prioridade, cd_estabelecimento) AS select	count(*) qt_higienizados,
	trunc(b.dt_prevista) dt_periodo, 
	b.nr_seq_servico, 
	substr(obter_descricao_padrao('SL_SERVICO', 'DS_SERVICO', b.nr_seq_servico),1,80) ds_servico, 
	b.cd_executor, 
	substr(obter_nome_pessoa_fisica(b.cd_executor, null),1,100) ds_executor, 
	a.cd_setor_atendimento, 
	substr(substr(a.cd_unidade_basica || ' ' || a.cd_unidade_compl,1,100) || ' ' || substr(obter_descricao_padrao('SL_SERVICO', 'DS_SERVICO', b.nr_seq_servico),1,80),1,255) ds_unidade, 
	substr(obter_nome_setor(a.cd_setor_atendimento),1,80) ds_setor, 
	trunc(Obter_Hora_Entre_datas(b.dt_inicio, b.dt_fim)) ds_horario_exec, 
	trunc(Obter_Hora_Entre_datas(b.dt_inicio, b.dt_fim)) cd_horario_exec, 
	trunc(obter_min_entre_datas(b.dt_inicio, b.dt_fim, 1)) ds_diferenca_exec, 
	trunc(obter_min_entre_datas(b.dt_inicio, b.dt_fim, 1)) cd_diferenca_exec, 
	b.ie_prioridade, 
	substr(obter_valor_dominio(1812, ie_status_serv),1,40) ds_status_unidade, 
	substr(obter_nome_pf(cd_executor_aprov_serv),1,80) nm_usu_aprov, 
	substr(OBTER_DESC_MOT_INTER(a.cd_motivo_interdicao),1,255) ds_motivo_interdicao, 
	trunc(obter_min_entre_datas(b.dt_prevista, b.dt_aprovacao, 1)) ds_diferenca, 
	trunc(obter_min_entre_datas(b.dt_prevista, b.dt_aprovacao, 1)) cd_diferenca, 
	trunc(obter_hora_entre_datas(b.dt_prevista, b.dt_aprovacao)) ds_diferenca_hora, 
	trunc(obter_hora_entre_datas(b.dt_prevista, b.dt_aprovacao)) cd_diferenca_hora, 
	a.cd_tipo_acomodacao, 
	substr(obter_descricao_padrao('TIPO_ACOMODACAO','DS_TIPO_ACOMODACAO', a.cd_tipo_acomodacao),1,200) ds_tipo_acomodacao, 
	a.cd_motivo_interdicao, 
	ie_status_serv, 
	CASE WHEN b.ie_prioridade='S' THEN 'Sim'  ELSE 'Não' END  ds_prioridade, 
	obter_estab_unidade(a.nr_seq_interno) cd_estabelecimento 
FROM	unidade_atendimento a, 
	sl_unid_atend b 
where	b.nr_seq_unidade = a.nr_seq_interno 
group by	b.nr_seq_servico, 
	b.cd_executor, 
	a.cd_setor_atendimento, 
	substr(substr(a.cd_unidade_basica || ' ' || a.cd_unidade_compl,1,100) || ' ' || substr(obter_descricao_padrao('SL_SERVICO', 'DS_SERVICO', b.nr_seq_servico),1,80),1,255), 
	b.dt_inicio, 
	b.dt_fim, 
	b.ie_prioridade, 
	substr(obter_valor_dominio(1812, ie_status_serv),1,40), 
	substr(obter_nome_pf(cd_executor_aprov_serv),1,80), 
	substr(OBTER_DESC_MOT_INTER(a.cd_motivo_interdicao),1,255), 
	trunc(obter_min_entre_datas(b.dt_prevista, b.dt_aprovacao, 1)), 
	trunc(obter_hora_entre_datas(b.dt_prevista, b.dt_aprovacao)), 
	b.dt_prevista, 
	a.cd_tipo_acomodacao, 
	a.cd_motivo_interdicao, 
	ie_status_serv, 
	CASE WHEN b.ie_prioridade='S' THEN 'Sim'  ELSE 'Não' END , 
	obter_estab_unidade(a.nr_seq_interno);

