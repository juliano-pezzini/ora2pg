-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW san_exame_realizado_reagente_v (nr_seq_exame, nr_sequencia, dt_exame, ds_resultado, cd_pessoa_fisica, nr_atendimento, nr_seq_lote_fornec, nr_seq_reag, cd_material) AS select	c.nr_seq_exame,
	b.nr_sequencia,
	a.dt_doacao dt_exame,
	coalesce(ds_resultado, coalesce(to_char(vl_resultado), ie_resultado)) ds_resultado,
	a.cd_pessoa_fisica,
	0 nr_atendimento,
	d.nr_seq_lote_fornec,
	d.nr_sequencia nr_seq_reag,
	d.cd_material
FROM san_exame_reagente_fornec d,
     san_exame_realizado c,
     san_exame_lote b,
     san_doacao a
where d.nr_seq_exame = c.nr_seq_exame
  and d.nr_seq_exame_lote = c.nr_seq_exame_lote
  and a.nr_sequencia = b.nr_seq_doacao
  and b.nr_sequencia = c.nr_seq_exame_lote
  and somente_numero(a.nr_sangue) <> 0

union

select	c.nr_seq_exame,
	b.nr_sequencia,
	a.dt_transfusao,
	coalesce(ds_resultado, coalesce(to_char(vl_resultado), ie_resultado)) ds_resultado,
	a.cd_pessoa_fisica,
	a.nr_atendimento,
	d.nr_seq_lote_fornec,
	d.nr_sequencia,
	d.cd_material
from san_exame_reagente_fornec d,
     san_exame_realizado c,
     san_exame_lote b,
     san_transfusao a
where d.nr_seq_exame = c.nr_seq_exame
  and d.nr_seq_exame_lote = c.nr_seq_exame_lote
  and a.nr_sequencia = b.nr_seq_transfusao
  and b.nr_sequencia = c.nr_seq_exame_lote
  and b.nr_seq_producao is null

union

select	c.nr_seq_exame,
	b.nr_sequencia,
	a.dt_transfusao,
	coalesce(ds_resultado, coalesce(to_char(vl_resultado), ie_resultado)) ds_resultado,
	a.cd_pessoa_fisica,
	a.nr_atendimento,
	e.nr_seq_lote_fornec,
	e.nr_sequencia	,
	e.cd_material
from san_exame_reagente_fornec e,
     san_exame_realizado c,
     san_exame_lote b,
     san_producao d,
     san_transfusao a
where e.nr_seq_exame = c.nr_seq_exame
  and e.nr_seq_exame_lote = c.nr_seq_exame_lote
  and a.nr_sequencia = d.nr_seq_transfusao
  and d.nr_sequencia = b.nr_seq_producao
  and b.nr_sequencia = c.nr_seq_exame_lote
  and b.ie_origem = 'T'

union

select	c.nr_seq_exame,
	b.nr_sequencia,
	a.dt_cirurgia + 0.1,
	coalesce(ds_resultado, coalesce(to_char(vl_resultado), ie_resultado)) ds_resultado,
	a.cd_pessoa_fisica,
	a.nr_atendimento,
	d.nr_seq_lote_fornec,
	d.nr_sequencia,
	d.cd_material
from san_exame_reagente_fornec d,
     san_exame_realizado c,
     san_exame_lote b,
     san_reserva a
where d.nr_seq_exame = c.nr_seq_exame
  and d.nr_seq_exame_lote = c.nr_seq_exame_lote
  and a.nr_sequencia = b.nr_seq_reserva
  and b.nr_sequencia = c.nr_seq_exame_lote
  and b.nr_seq_res_prod is null
  and b.nr_seq_transfusao is null

union

select	c.nr_seq_exame,
	b.nr_sequencia,
	a.dt_cirurgia + 0.1,
	coalesce(ds_resultado, coalesce(to_char(vl_resultado), ie_resultado)) ds_resultado,
	a.cd_pessoa_fisica,
	a.nr_atendimento,
	e.nr_seq_lote_fornec,
	e.nr_sequencia,
	e.cd_material
from san_exame_reagente_fornec e,
     san_exame_realizado c,
     san_exame_lote b,
     san_reserva_prod d,
     san_reserva a
where e.nr_seq_exame = c.nr_seq_exame
  and e.nr_seq_exame_lote = c.nr_seq_exame_lote
  and a.nr_sequencia = b.nr_seq_reserva
  and b.nr_seq_res_prod = d.nr_sequencia
  and b.nr_sequencia = c.nr_seq_exame_lote;

