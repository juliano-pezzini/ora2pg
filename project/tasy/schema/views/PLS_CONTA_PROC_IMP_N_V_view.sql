-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_conta_proc_imp_n_v (cd_procedimento, ie_origem_proced, dt_procedimento, nr_sequencia, cd_guia_referencia, dt_procedimento_real, ie_tipo_despesa, sg_cons_prof_prest_nota_serv, nr_cons_prof_prest_nota_serv, sg_uf_cons_prest_nota_serv, cd_medico_executor, nr_seq_segurado, nr_seq_prestador_exec, cd_cid_principal_conta, cd_cat_cid_principal_conta, nr_seq_cbo_saude, qt_executado, nr_seq_conta, ie_tipo_guia, cd_estabelecimento, nr_seq_prestador_prot, nr_seq_tipo_atend, nr_seq_plano, dt_inicio_faturamento, ie_carater_atendimento_conv, nr_seq_tipo_prest_prot, nr_seq_tipo_prest_exec, cd_prestador_exec, dt_atendimento, ie_via_acesso_conv) AS select	/* Campos da tabela */

	a.cd_procedimento_conv cd_procedimento,
	a.ie_origem_proced_conv ie_origem_proced,
	a.dt_execucao_conv dt_procedimento,
	a.nr_sequencia,
	d.cd_guia_referencia,
	a.dt_execucao_conv dt_procedimento_real,
	a.ie_tipo_despesa_conv ie_tipo_despesa,
	(select	max(b.sg_cons_prof_prest) FROM ptu_nota_servico b where b.nr_seq_conta_proc = a.nr_sequencia) sg_cons_prof_prest_nota_serv,
	(select	max(b.nr_cons_prof_prest) from ptu_nota_servico b where b.nr_seq_conta_proc = a.nr_sequencia) nr_cons_prof_prest_nota_serv,
	(select	max(b.sg_uf_cons_prest) from ptu_nota_servico b where b.nr_seq_conta_proc = a.nr_sequencia)   sg_uf_cons_prest_nota_serv,
	d.cd_profissional_exec_conv cd_medico_executor,
	d.nr_seq_segurado_conv nr_seq_segurado,
	d.nr_seq_prest_exec_conv nr_seq_prestador_exec,
	d.cd_cid_principal cd_cid_principal_conta,
	d.cd_cat_cid_principal  cd_cat_cid_principal_conta,
	d.nr_seq_cbo_saude,
	a.qt_executado,
	d.nr_sequencia nr_seq_conta,
	d.ie_tipo_guia,
	d.cd_estabelecimento,
	d.nr_seq_prestador_prot,
	d.nr_seq_tipo_atend_conv nr_seq_tipo_atend,
	d.nr_seq_plano,
	d.dt_inicio_faturamento,
	d.ie_carater_atendimento_conv,
	d.nr_seq_tipo_prest_prot,
	d.nr_seq_tipo_prest_exec,
	d.cd_prestador_exec,
	d.dt_atendimento_conv dt_atendimento,
  a.ie_via_acesso_conv
from	pls_conta_proc_imp		a,
	pls_conta_imp_v			d
where	d.nr_sequencia			= a.nr_seq_conta;

