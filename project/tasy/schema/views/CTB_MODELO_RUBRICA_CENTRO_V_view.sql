-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ctb_modelo_rubrica_centro_v (cd_centro_custo, nr_seq_rubrica, cd_conta_contabil) AS select c.cd_centro_custo,
       a.nr_seq_rubrica,
       a.cd_conta_contabil
FROM   ctb_modelo_rubrica_conta a,
       ctb_modelo_rubrica_rest b,
       centro_custo c
where  a.nr_seq_rubrica = b.nr_seq_rubrica
and    a.cd_conta_contabil = b.cd_conta_contabil
and    b.ie_sinal = '+'
and    c.ie_tipo = 'A'
and    c.cd_estabelecimento = coalesce(b.cd_estabelecimento, c.cd_estabelecimento)
and    coalesce(c.ie_tipo_custo,'X') = coalesce(b.ie_tipo_custo, coalesce(c.ie_tipo_custo, 'X'))
and    substr(coalesce(c.cd_classificacao,'X'),1, length(coalesce(b.cd_classificacao, coalesce(c.cd_classificacao,'X')))) = coalesce(b.cd_classificacao, coalesce(c.cd_classificacao,'X'))
and not exists (
    select 1
    from   ctb_modelo_rubrica_conta d,
           ctb_modelo_rubrica_rest e,
           centro_custo f
    where  c.cd_centro_custo = f.cd_centro_custo
    and    d.nr_seq_rubrica = a.nr_seq_rubrica
    and    d.cd_conta_contabil = a.cd_conta_contabil
    and    d.nr_seq_rubrica = e.nr_seq_rubrica
    and    d.cd_conta_contabil = e.cd_conta_contabil
    and    e.ie_sinal = '-'
    and    f.ie_tipo = 'A'
    and    f.cd_estabelecimento = coalesce(e.cd_estabelecimento, f.cd_estabelecimento)
    and    coalesce(f.ie_tipo_custo,'X') = coalesce(e.ie_tipo_custo, coalesce(f.ie_tipo_custo, 'X'))
    and    substr(coalesce(f.cd_classificacao,'X'),1, length(coalesce(e.cd_classificacao, coalesce(f.cd_classificacao,'X')))) = coalesce(e.cd_classificacao, coalesce(f.cd_classificacao,'X'))
)
order by c.cd_centro_custo;

