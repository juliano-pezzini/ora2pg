-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW nota_interf_giss_pf_v (nr_nota_fiscal, cd_serie_nf, dt_emissao, ie_situacao, vl_total_nota, ds_local_prest_servico, cd_estabelecimento, cd_atividade_serv, cd_operacao_nf) AS select	a.nr_nota_fiscal,
	substr(rpad(a.cd_serie_nf,10,'.'),1,10) cd_serie_nf, 
	a.dt_emissao, 
	CASE WHEN a.ie_situacao=1 THEN  1 WHEN a.ie_situacao=2 THEN  3 WHEN a.ie_situacao=3 THEN  3 WHEN a.ie_situacao=9 THEN  2 END  ie_situacao, 
	a.vl_total_nota, 
	'D' ds_local_prest_servico, 
	a.cd_estabelecimento, 
	coalesce(obter_dados_pf_pj_estab(a.cd_estabelecimento, null, a.cd_cgc_emitente, 'ATIV'), 403) cd_atividade_serv, 
	a.cd_operacao_nf 
FROM	nota_fiscal a 
where	a.cd_pessoa_fisica is not null 
and	a.cd_cgc is null 
and (substr(obter_se_nota_entrada_saida(a.nr_sequencia),1,1) = 'S');

