-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW w_eis_distr_apos_acup_esas_v (nr_sequencia, dt_avaliacao, nr_atendimento, setor, ds_setor_atendimento, ie_sexo, ds_sexo, ie_faixa_etaria, cd_estabelecimento, ds_estabelecimento, ds_pont_dor, ds_pont_cansaco, ds_pont_nausea, ds_pont_depressao, ds_pont_ansiedade, ds_pont_sonolencia, ds_pont_inapetencia, ds_pont_estar, ds_pont_falta_ar, tipo, ds_atendimento) AS select distinct
	a.nr_sequencia, 
	a.dt_avaliacao, 
	a.nr_atendimento, 
	b.cd_setor_atendimento setor, 
	obter_nome_setor(b.cd_setor_atendimento) ds_setor_atendimento, 
	c.ie_sexo ie_sexo, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo,	 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) ie_faixa_etaria, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento,	 
	SUBSTR(('Intensidade '||a.ie_dor),1,255) ds_pont_dor, 
	SUBSTR(('Intensidade '||a.ie_cansaco),1,255) ds_pont_cansaco, 
	SUBSTR(('Intensidade '||a.ie_nausea),1,255) ds_pont_nausea, 
	SUBSTR(('Intensidade '||a.ie_depressao),1,255) ds_pont_depressao, 
	SUBSTR(('Intensidade '||a.ie_ansiedade),1,255) ds_pont_ansiedade, 
	SUBSTR(('Intensidade '||a.ie_sonolencia),1,255) ds_pont_sonolencia, 
	SUBSTR(('Intensidade '||a.ie_bom_apetite),1,255) ds_pont_inapetencia, 
	SUBSTR(('Intensidade '||a.ie_sensacao_bem_estar),1,255) ds_pont_estar, 
	SUBSTR(('Intensidade '||a.ie_falta_ar),1,255) ds_pont_falta_ar,	 
	b.ie_tipo_atendimento tipo, 
	SUBSTR(obter_valor_dominio(12,b.ie_tipo_atendimento),1,255) ds_atendimento 
FROM	escala_edmonton a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
where	a.nr_atendimento = b.nr_atendimento 
and	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
and	a.dt_inativacao is null 
and	exists ( 	select	1 
			from	pe_prescricao x, 
				pe_prescr_proc y 
			where	y.nr_seq_prescr = x.nr_sequencia 
			and	x.nr_atendimento = a.nr_atendimento 
			and	x.dt_liberacao is not null 
			and	x.dt_inativacao is null 
			and	x.nr_prescricao is not null 
			and	UPPER(obter_desc_intervencoes(y.nr_seq_proc)) like('%ACUPUNTURA%') 
			and	TRUNC(x.dt_prescricao) <= TRUNC(a.dt_avaliacao));

