-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_quimio_manip_v (ds_setor, nm_paciente, nm_manipulador, qt_manipulador, nr_sequencia, cd_setor_paciente, cd_pessoa_fisica, cd_manipulador, dt_referencia, cd_material, ds_material, cd_grupo_material, ds_grupo_material, cd_subgrupo_material, ds_subgrupo_material, cd_classe_material, ds_classe_material, cd_estabelecimento, ds_estabelecimento, cd_especialidade, ds_especialidade, cd_protocolo, nm_protocolo, ds_custo, ds_medicacao, nr_seq_medicacao, ie_primeiro_dia_ciclo, nr_seq_atendimento) AS select substr(obter_nome_setor(a.cd_setor_paciente),1,200) ds_setor,
		substr(obter_nome_pf(a.cd_pessoa_fisica),1,200) nm_paciente, 
		substr(obter_nome_pf(a.cd_manipulador),1,200) nm_manipulador, 
		count(a.cd_manipulador) qt_manipulador, 
		a.nr_sequencia, 
		a.cd_setor_paciente, 
		a.cd_pessoa_fisica, 
		a.cd_manipulador, 
		a.dt_geracao_ordem dt_referencia, 
		b.cd_material, 
		substr(obter_desc_material(b.cd_material),1,60) ds_material, 
		CD_GRUPO_MATERIAL, 
		DS_GRUPO_MATERIAL, 
		CD_SUBGRUPO_MATERIAL, 
		DS_SUBGRUPO_MATERIAL, 
		CD_CLASSE_MATERIAL, 
		DS_CLASSE_MATERIAL, 
		a.CD_ESTABELECIMENTO, 
		substr(OBTER_NOME_ESTABELECIMENTO(a.CD_ESTABELECIMENTO),1,100) DS_ESTABELECIMENTO, 
		substr(OBTER_ESPECIALIDADE_MEDICO(a.CD_MEDICO_RESP,'C'),1,5) CD_ESPECIALIDADE, 
		substr(OBTER_NOME_ESPECIALIDADE(substr(OBTER_ESPECIALIDADE_MEDICO(a.CD_MEDICO_RESP,'C'),1,5)),1,100) DS_ESPECIALIDADE, 
		h.cd_protocolo, 
		substr(obter_desc_protocolo(h.cd_protocolo),1,255) NM_PROTOCOLO, 
		substr(CASE WHEN obter_dados_material_estab(b.cd_material, wheb_usuario_pck.get_cd_estabelecimento, 'CU')='B' THEN 'Baixo' WHEN obter_dados_material_estab(b.cd_material, wheb_usuario_pck.get_cd_estabelecimento, 'CU')='M' THEN  'MÃ©dio' WHEN obter_dados_material_estab(b.cd_material, wheb_usuario_pck.get_cd_estabelecimento, 'CU')='A' THEN  'Alto' END ,1,30) ds_custo, 
		substr(obter_desc_protocolo_medic(h.NR_SEQ_MEDICACAO,h.CD_PROTOCOLO),1,50) ds_medicacao, 
		h.NR_SEQ_MEDICACAO, 
		qt_obter_se_prim_ciclo_dia(a.nr_seq_atendimento) ie_primeiro_dia_ciclo, 
		g.nr_seq_atendimento 
FROM 	paciente_setor h, 
		paciente_atendimento g, 
		estrutura_material_v c, 
		can_ordem_prod_mat b, 
		can_ordem_prod a 
where 	a.nr_sequencia = b.nr_seq_ordem 
and 	c.cd_material = b.cd_material 
and 	g.nr_seq_atendimento = a.nr_seq_atendimento 
and 	g.nr_seq_paciente = h.nr_seq_paciente 
group by obter_nome_setor(a.cd_setor_paciente), 
		obter_nome_pf(a.cd_pessoa_fisica), 
		obter_nome_pf(a.cd_manipulador), 
		a.nr_sequencia, 
		a.cd_setor_paciente, 
		a.cd_pessoa_fisica, 
		a.cd_manipulador, 
		a.dt_geracao_ordem, 
		b.cd_material, 
		obter_desc_material(b.cd_material), 
		CD_GRUPO_MATERIAL, 
		DS_GRUPO_MATERIAL, 
		CD_SUBGRUPO_MATERIAL, 
		DS_SUBGRUPO_MATERIAL, 
		CD_CLASSE_MATERIAL, 
		DS_CLASSE_MATERIAL, 
		a.CD_ESTABELECIMENTO, 
		substr(OBTER_NOME_ESTABELECIMENTO(a.CD_ESTABELECIMENTO),1,100), 
		substr(OBTER_ESPECIALIDADE_MEDICO(a.CD_MEDICO_RESP,'C'),1,5), 
		substr(OBTER_NOME_ESPECIALIDADE(substr(OBTER_ESPECIALIDADE_MEDICO(a.CD_MEDICO_RESP,'C'),1,5)),1,100), 
		h.cd_protocolo, 
		substr(obter_desc_protocolo(h.cd_protocolo),1,255), 
		obter_dados_material_estab(b.cd_material, wheb_usuario_pck.get_cd_estabelecimento, 'CU'), 
		substr(obter_desc_protocolo_medic(h.NR_SEQ_MEDICACAO,h.CD_PROTOCOLO),1,50), 
		h.NR_SEQ_MEDICACAO, 
		qt_obter_se_prim_ciclo_dia(a.nr_seq_atendimento), 
		g.nr_seq_atendimento;

