-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW rss_prod_tre_5 (ds_classif, ie_tipo_classif, ds_grupo, ds_tipo_funcao, qt_horas, qt_horas_prod, qt_horas_nao_prod, dt_atividade, nm_pessoa_usuario_exec, nr_seq_funcao, cd_grupo, nm_usuario_exec, cd_cargo, ds_cargo, cd_setor_usuario, ds_setor_usuario) AS SELECT a.ds_classif,
	   a.ie_tipo_classif,
	   a.ds_grupo,
	   a.ds_tipo_funcao,
	   a.qt_horas qt_horas,
	   a.qt_horas_prod qt_horas_prod,
	   a.qt_horas_nao_prod qt_horas_nao_prod,
	   a.dt_atividade dt_atividade,
	   SUBSTR(a.nm_pessoa_usuario_exec,1,255) nm_pessoa_usuario_exec,
	   a.nr_seq_funcao,
	   a.cd_grupo,
	   a.nm_usuario_exec,
	   a.cd_cargo,
       a.ds_cargo,
       a.cd_setor_usuario,
       a.ds_setor_usuario
FROM (SELECT  'Produtivas' ds_classif,
	 	1 ie_tipo_classif,
        c.ds_grupo,
        SUBSTR(obter_desc_tipo_funcao(a.nr_seq_funcao),1,100) ds_tipo_funcao,
        a.qt_minuto,
        ((a.qt_minuto)/60) qt_horas,
		((a.qt_minuto)/60) qt_horas_prod,
		0 qt_horas_nao_prod,
        a.dt_atividade,
        obter_nome_usuario(a.nm_usuario_exec) nm_pessoa_usuario_exec,
        a.nr_seq_funcao,
        c.nr_sequencia cd_grupo,
        a.nm_usuario_exec,
        SUBSTR(obter_dados_usuario_opcao(a.nm_usuario_exec,'R'),1,255) cd_cargo,
        SUBSTR(obter_cargo_usuario(a.nm_usuario_exec),1,255) ds_cargo,
        SUBSTR(obter_dados_usuario_opcao(a.nm_usuario_exec,'S'),1,255) cd_setor_usuario,
        SUBSTR(obter_dados_usuario_opcao(a.nm_usuario_exec,'DS'),1,255) ds_setor_usuario
FROM    man_ordem_servico_v v,
        man_ordem_serv_ativ a,
        man_tipo_funcao b,
        man_grupo_funcao c
WHERE   v.nr_sequencia    = a.nr_seq_ordem_serv
AND     a.nr_seq_funcao = b.nr_sequencia
AND     b.nr_seq_grupo_funcao = c.nr_sequencia
AND     c.nr_sequencia IN (2,4,6,11)

UNION ALL

SELECT  'Apoio' ds_classif,
		2 ie_tipo_classif,
        c.ds_grupo,
        SUBSTR(obter_desc_tipo_funcao(a.nr_seq_funcao),1,100) ds_tipo_funcao,
        a.qt_minuto,
        ((a.qt_minuto)/60) qt_horas,
		0 qt_horas_prod,
		((a.qt_minuto)/60) qt_horas_nao_prod,
        a.dt_atividade,
        obter_nome_usuario(a.nm_usuario_exec) nm_usuario_exec,
        a.nr_seq_funcao,
        c.nr_sequencia cd_grupo,
        a.nm_usuario_exec,
        SUBSTR(obter_dados_usuario_opcao(a.nm_usuario_exec,'R'),1,255) cd_cargo,
        SUBSTR(obter_cargo_usuario(a.nm_usuario_exec),1,255) ds_cargo,
        SUBSTR(obter_dados_usuario_opcao(a.nm_usuario_exec,'S'),1,255) cd_setor_usuario,
        SUBSTR(obter_dados_usuario_opcao(a.nm_usuario_exec,'DS'),1,255) ds_setor_usuario
FROM    man_ordem_servico_v v,
		man_ordem_serv_ativ a,
		man_tipo_funcao b,
		man_grupo_funcao c
WHERE  	v.nr_sequencia    = a.nr_seq_ordem_serv
AND   	a.nr_seq_funcao = b.nr_sequencia
AND     b.nr_seq_grupo_funcao = c.nr_sequencia
AND   	c.nr_sequencia IN (7,8,9)

UNION ALL

SELECT  'Treinamento - Capacitação DO Instrutor' ds_classif,
		3 ie_tipo_classif,
        c.ds_grupo,
        SUBSTR(obter_desc_tipo_funcao(a.nr_seq_funcao),1,100) ds_tipo_funcao,
        a.qt_minuto,
        ((a.qt_minuto)/60) qt_horas,
		0 qt_horas_prod,
		((a.qt_minuto)/60) qt_horas_nao_prod,
        a.dt_atividade,
        obter_nome_usuario(a.nm_usuario_exec) nm_usuario_exec,
        a.nr_seq_funcao,
        c.nr_sequencia cd_grupo,
        a.nm_usuario_exec,
        SUBSTR(obter_dados_usuario_opcao(a.nm_usuario_exec,'R'),1,255) cd_cargo,
        SUBSTR(obter_cargo_usuario(a.nm_usuario_exec),1,255) ds_cargo,
        SUBSTR(obter_dados_usuario_opcao(a.nm_usuario_exec,'S'),1,255) cd_setor_usuario,
        SUBSTR(obter_dados_usuario_opcao(a.nm_usuario_exec,'DS'),1,255) ds_setor_usuario
FROM  	man_ordem_servico_v v,
		man_ordem_serv_ativ a,
		man_tipo_funcao b,
		man_grupo_funcao c
WHERE  	v.nr_sequencia    = a.nr_seq_ordem_serv
AND  	a.nr_seq_funcao = b.nr_sequencia
AND     b.nr_seq_grupo_funcao = c.nr_sequencia
AND   	c.nr_sequencia IN (10)

UNION ALL

SELECT  'Administrativo' ds_classif,
		4 ie_tipo_classif,
        c.ds_grupo,
        SUBSTR(obter_desc_tipo_funcao(a.nr_seq_funcao),1,100) ds_tipo_funcao,
        a.qt_minuto,
        ((a.qt_minuto)/60) qt_horas,
		0 qt_horas_prod,
		((a.qt_minuto)/60) qt_horas_nao_prod,
        a.dt_atividade,
        obter_nome_usuario(a.nm_usuario_exec) nm_usuario_exec,
        a.nr_seq_funcao,
        c.nr_sequencia cd_grupo,
        a.nm_usuario_exec,
        SUBSTR(obter_dados_usuario_opcao(a.nm_usuario_exec,'R'),1,255) cd_cargo,
        SUBSTR(obter_cargo_usuario(a.nm_usuario_exec),1,255) ds_cargo,
        SUBSTR(obter_dados_usuario_opcao(a.nm_usuario_exec,'S'),1,255) cd_setor_usuario,
        SUBSTR(obter_dados_usuario_opcao(a.nm_usuario_exec,'DS'),1,255) ds_setor_usuario
FROM  	man_ordem_servico_v v,
		man_ordem_serv_ativ a,
		man_tipo_funcao b,
		man_grupo_funcao c
WHERE  	v.nr_sequencia    = a.nr_seq_ordem_serv
AND   	a.nr_seq_funcao = b.nr_sequencia
AND     b.nr_seq_grupo_funcao = c.nr_sequencia
AND   	c.nr_sequencia IN (5,13)) a;

