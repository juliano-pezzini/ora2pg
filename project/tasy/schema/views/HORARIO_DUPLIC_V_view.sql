-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW horario_duplic_v (nr_prescricao, ds_prescricao, nr_atendimento, dt_horario, cd_material, nr_seq_material, cd_procedimento, ie_origem_proced, nr_seq_proc_interno, nr_seq_procedimento, cd_recomendacao, nr_seq_recomendacao, nr_seq_proc, nr_seq_pe_prescr, nr_seq_pe_proc, ie_tipo_item, dt_validade_prescr) AS select  a.nr_prescricao,
     a.nr_prescricao || ' - ' || substr(obter_dados_prescricao(a.nr_prescricao,'D'),1,19) || ' - ' || substr(obter_usuario_prescritor(a.nr_prescricao),1,60) ds_prescricao, 
	 b.nr_atendimento, 
	 a.dt_horario, 
	 a.cd_material, 
	 a.nr_seq_material, 
	 null cd_procedimento, 
	 null ie_origem_proced, 
	 null nr_seq_proc_interno, 
	 null nr_seq_procedimento, 
	 null cd_recomendacao, 
	 null nr_seq_recomendacao, 
	 null nr_seq_proc, 
	 null nr_seq_pe_prescr, 
	 null nr_seq_pe_proc, 
	 'S' ie_tipo_item, 
	 b.dt_validade_prescr 
FROM   prescr_medica b, 
     prescr_mat_hor a 
where  b.nr_prescricao                             = a.nr_prescricao 
and   a.ie_agrupador                             = 12 
and   coalesce(a.ie_situacao,'A')                         = 'A' 
and   coalesce(b.ie_adep,'S')                           = 'S' 
and   b.dt_suspensao                             is null 
and   a.dt_suspensao                             is null 
and   obter_se_prescr_mat_susp(a.nr_prescricao,a.nr_seq_material)       = 'N' 
and	Obter_se_horario_liberado(a.dt_lib_horario, a.dt_horario) = 'S' 

union
 
select  a.nr_prescricao, 
     a.nr_prescricao || ' - ' || substr(obter_dados_prescricao(a.nr_prescricao,'D'),1,19) || ' - ' || substr(obter_usuario_prescritor(a.nr_prescricao),1,60) ds_prescricao, 
	 b.nr_atendimento, 
	 a.dt_horario, 
	 a.cd_material, 
	 a.nr_seq_material, 
	 null cd_procedimento, 
	 null ie_origem_proced, 
	 null nr_seq_proc_interno, 
	 null nr_seq_procedimento, 
	 null cd_recomendacao, 
	 null nr_seq_recomendacao, 
	 null nr_seq_proc, 
	 null nr_seq_pe_prescr, 
	 null nr_seq_pe_proc, 
	 'MAT' ie_tipo_item, 
	 b.dt_validade_prescr 
from   prescr_medica b, 
     prescr_mat_hor a 
where  b.nr_prescricao                             = a.nr_prescricao 
and   a.ie_agrupador                             = 2 
and   coalesce(a.ie_situacao,'A')                         = 'A' 
and   coalesce(b.ie_adep,'S')                           = 'S' 
and   b.dt_suspensao                             is null 
and   a.dt_suspensao                             is null 
and   obter_se_prescr_mat_susp(a.nr_prescricao,a.nr_seq_material)       = 'N' 
and	Obter_se_horario_liberado(a.dt_lib_horario, a.dt_horario) = 'S' 

union
 
select  a.nr_prescricao, 
     a.nr_prescricao || ' - ' || substr(obter_dados_prescricao(a.nr_prescricao,'D'),1,19) || ' - ' || substr(obter_usuario_prescritor(a.nr_prescricao),1,60) ds_prescricao, 
	 b.nr_atendimento, 
	 a.dt_horario, 
	 null cd_material, 
	 null nr_seq_material, 
	 a.cd_procedimento, 
	 a.ie_origem_proced, 
	 coalesce(a.nr_seq_proc_interno,0) nr_seq_proc_interno, 
	 a.nr_seq_procedimento, 
	 null cd_recomendacao, 
	 null nr_seq_recomendacao, 
	 null nr_seq_proc, 
	 null nr_seq_pe_prescr, 
	 null nr_seq_pe_proc, 
	 'P'ie_tipo_item, 
	 b.dt_validade_prescr 
from   prescr_medica b, 
     prescr_proc_hor a 
where  b.nr_prescricao                              = a.nr_prescricao 
and   coalesce(a.ie_situacao,'A')                           = 'A' 
and   coalesce(b.ie_adep,'S')                             = 'S' 
and   b.dt_suspensao                               is null 
and   a.dt_suspensao                               is null 
and   obter_se_prescr_proc_susp(a.nr_prescricao,a.nr_seq_procedimento)      = 'N' 
and	Obter_se_horario_liberado(a.dt_lib_horario, a.dt_horario) = 'S' 

union
 
select  a.nr_prescricao, 
     a.nr_prescricao || ' - ' || substr(obter_dados_prescricao(a.nr_prescricao,'D'),1,19) || ' - ' || substr(obter_usuario_prescritor(a.nr_prescricao),1,60) ds_prescricao, 
	 b.nr_atendimento, 
	 a.dt_horario, 
	 null cd_material, 
	 null nr_seq_material, 
	 a.cd_procedimento, 
	 a.ie_origem_proced, 
	 coalesce(a.nr_seq_proc_interno,0) nr_seq_proc_interno, 
	 a.nr_seq_procedimento, 
	 null cd_recomendacao, 
	 null nr_seq_recomendacao, 
	 null nr_seq_proc, 
	 null nr_seq_pe_prescr, 
	 null nr_seq_pe_proc, 
	 'G' ie_tipo_item, 
	 b.dt_validade_prescr 
from   prescr_medica b, 
     prescr_proc_hor a 
where  b.nr_prescricao                              = a.nr_prescricao 
and   coalesce(a.ie_situacao,'A')                           = 'A' 
and   coalesce(b.ie_adep,'S')                             = 'S' 
and   b.dt_suspensao                               is null 
and   a.dt_suspensao                               is null 
and   obter_se_prescr_proc_susp(a.nr_prescricao,a.nr_seq_procedimento)      = 'N' 
and	Obter_se_horario_liberado(a.dt_lib_horario, a.dt_horario) = 'S' 

union
 
select  a.nr_prescricao, 
     a.nr_prescricao || ' - ' || substr(obter_dados_prescricao(a.nr_prescricao,'D'),1,19) || ' - ' || substr(obter_usuario_prescritor(a.nr_prescricao),1,60) ds_prescricao, 
	 b.nr_atendimento, 
	 a.dt_horario, 
	 null cd_material, 
	 null nr_seq_material, 
	 a.cd_procedimento, 
	 a.ie_origem_proced, 
	 coalesce(a.nr_seq_proc_interno,0) nr_seq_proc_interno, 
	 a.nr_seq_procedimento, 
	 null cd_recomendacao, 
	 null nr_seq_recomendacao, 
	 null nr_seq_proc, 
	 null nr_seq_pe_prescr, 
	 null nr_seq_pe_proc, 
	 'C' ie_tipo_item, 
	 b.dt_validade_prescr 
from   prescr_medica b, 
     prescr_proc_hor a 
where  b.nr_prescricao                              = a.nr_prescricao 
and   coalesce(a.ie_situacao,'A')                           = 'A' 
and   coalesce(b.ie_adep,'S')                             = 'S' 
and   b.dt_suspensao                               is null 
and   a.dt_suspensao                               is null 
and   obter_se_prescr_proc_susp(a.nr_prescricao,a.nr_seq_procedimento)      = 'N' 
and	Obter_se_horario_liberado(a.dt_lib_horario, a.dt_horario) = 'S' 

union
 
select  a.nr_prescricao, 
     a.nr_prescricao || ' - ' || substr(obter_dados_prescricao(a.nr_prescricao,'D'),1,19) || ' - ' || substr(obter_usuario_prescritor(a.nr_prescricao),1,60) ds_prescricao, 
	 b.nr_atendimento, 
	 a.dt_horario, 
	 null cd_material, 
	 null nr_seq_material, 
	 a.cd_procedimento, 
	 a.ie_origem_proced, 
	 coalesce(a.nr_seq_proc_interno,0) nr_seq_proc_interno, 
	 a.nr_seq_procedimento, 
	 null cd_recomendacao, 
	 null nr_seq_recomendacao, 
	 null nr_seq_proc, 
	 null nr_seq_pe_prescr, 
	 null nr_seq_pe_proc, 
	 'I' ie_tipo_item, 
	 b.dt_validade_prescr 
from   prescr_medica b, 
     prescr_proc_hor a 
where  b.nr_prescricao                              = a.nr_prescricao 
and   coalesce(a.ie_situacao,'A')                           = 'A' 
and   coalesce(b.ie_adep,'S')                             = 'S' 
and   b.dt_suspensao                               is null 
and   a.dt_suspensao                               is null 
and   obter_se_prescr_proc_susp(a.nr_prescricao,a.nr_seq_procedimento)      = 'N' 
and	Obter_se_horario_liberado(a.dt_lib_horario, a.dt_horario) = 'S' 

union
 
select  a.nr_prescricao, 
     a.nr_prescricao || ' - ' || substr(obter_dados_prescricao(a.nr_prescricao,'D'),1,19) || ' - ' || substr(obter_usuario_prescritor(a.nr_prescricao),1,60) ds_prescricao, 
	 b.nr_atendimento, 
	 a.dt_horario, 
	 null cd_material, 
	 null nr_seq_material, 
	 a.cd_procedimento, 
	 a.ie_origem_proced, 
	 coalesce(a.nr_seq_proc_interno,0) nr_seq_proc_interno, 
	 a.nr_seq_procedimento, 
	 null cd_recomendacao, 
	 null nr_seq_recomendacao, 
	 null nr_seq_proc, 
	 null nr_seq_pe_prescr, 
	 null nr_seq_pe_proc, 
	 'O' ie_tipo_item, 
	 b.dt_validade_prescr 
from   prescr_medica b, 
     prescr_proc_hor a 
where  b.nr_prescricao                              = a.nr_prescricao 
and   coalesce(a.ie_situacao,'A')                           = 'A' 
and   coalesce(b.ie_adep,'S')                             = 'S' 
and   b.dt_suspensao                               is null 
and   a.dt_suspensao                               is null 
and   obter_se_prescr_proc_susp(a.nr_prescricao,a.nr_seq_procedimento)      = 'N' 
and	Obter_se_horario_liberado(a.dt_lib_horario, a.dt_horario) = 'S' 

union
 
select  a.nr_prescricao, 
     a.nr_prescricao || ' - ' || substr(obter_dados_prescricao(a.nr_prescricao,'D'),1,19) || ' - ' || substr(obter_usuario_prescritor(a.nr_prescricao),1,60) ds_prescricao, 
	 b.nr_atendimento, 
	 a.dt_horario, 
	 null cd_material, 
	 null nr_seq_material, 
	 null cd_procedimento, 
	 null ie_origem_proced, 
	 null nr_seq_proc_interno, 
	 null nr_seq_procedimento, 
	 coalesce(a.cd_recomendacao,c.ds_recomendacao) cd_recomendacao, 
	 a.nr_seq_recomendacao, 
	 null nr_seq_proc, 
	 null nr_seq_pe_prescr, 
	 null nr_seq_pe_proc, 
	 'R' ie_tipo_item, 
	 b.dt_validade_prescr 
from   prescr_medica b, 
     prescr_recomendacao c, 
     prescr_rec_hor a 
where  b.nr_prescricao                              = a.nr_prescricao 
and   b.nr_prescricao                              = c.nr_prescricao 
and   c.nr_prescricao                              = a.nr_prescricao 
and   c.nr_sequencia                               = a.nr_seq_recomendacao 
and   coalesce(a.ie_situacao,'A')                           = 'A' 
and   coalesce(b.ie_adep,'S')                             = 'S' 
and   b.dt_suspensao                               is null 
and   a.dt_suspensao                               is null 
and   obter_se_prescr_rec_susp(a.nr_prescricao,a.nr_seq_recomendacao)      = 'N' 
and	 Obter_se_horario_liberado(a.dt_lib_horario, a.dt_horario) = 'S' 
and   b.ie_hemodialise                              is null 

union
 
select  null nr_prescricao,	 
     a.nr_seq_pe_prescr || ' - ' || substr(obter_dados_prescr_enf(a.nr_seq_pe_prescr,'D'),1,19) || ' - ' || substr(obter_nome_pf(obter_dados_prescr_enf(a.nr_seq_pe_prescr,'P')),1,60) ds_prescricao, 
	 b.nr_atendimento, 
	 a.dt_horario, 
	 null cd_material, 
	 null nr_seq_material, 
	 null cd_procedimento, 
	 null ie_origem_proced, 
	 null nr_seq_proc_interno, 
	 null nr_seq_procedimento, 
	 null cd_recomendacao, 
	 null nr_seq_recomendacao,	 
	 a.nr_seq_proc, 
	 a.nr_seq_pe_prescr, 
	 a.nr_seq_pe_proc, 
	 'E' ie_tipo_item, 
	 b.dt_validade_prescr 
from   pe_prescricao b, 
     pe_prescr_proc_hor a 
where  b.nr_sequencia                               = a.nr_seq_pe_prescr 
and   coalesce(a.ie_situacao,'A')                           = 'A' 
and   coalesce(obter_se_item_adep_sae(a.nr_seq_pe_prescr,a.nr_seq_pe_proc),'S')    = 'S' 
and   a.dt_suspensao                               is null 
and   b.dt_inativacao is null 
and   obter_se_pe_prescr_proc_susp(a.nr_seq_pe_prescr,a.nr_seq_pe_proc)     = 'N' 

union
 
select  b.nr_prescricao, 
     b.nr_prescricao || ' - ' || substr(obter_dados_prescricao(b.nr_prescricao,'D'),1,19) || ' - ' || substr(obter_usuario_prescritor(b.nr_prescricao),1,60) ds_prescricao, 
	 b.nr_atendimento, 
	 a.dt_horario, 
	 null cd_material, 
	 null nr_seq_material, 
	 null cd_procedimento, 
	 null ie_origem_proced, 
	 null nr_seq_proc_interno, 
	 null nr_seq_procedimento, 
	 null cd_recomendacao, 
	 null nr_seq_recomendacao, 
	 null nr_seq_proc, 
	 null nr_seq_pe_prescr, 
	 null nr_seq_pe_proc, 
	 'B' ie_tipo_item, 
	 b.dt_validade_prescr 
from   prescr_medica b, 
     prescr_medica_ordem c, 
     prescr_ordem_hor a 
where  b.nr_prescricao                              = c.nr_prescricao 
and   c.nr_sequencia                               = a.nr_seq_ordem 
and   coalesce(b.ie_adep,'S')                             = 'S' 
and   b.dt_suspensao                               is null 
and   a.dt_suspensao                               is null 
and		 a.ie_horario_especial = 'N';

