-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW fluxo_caixa_v (cd_conta_financ, ds_moeda, d30012019, d31012019, d01022019, d02022019, d03022019, d04022019, d05022019, d06022019, d07022019, d08022019, d09022019, d10022019, d11022019, d12022019, d13022019, d14022019, d15022019, d16022019, d17022019, d18022019, d19022019, d20022019, d21022019, d22022019, d23022019, d24022019, d25022019, total, vl_orcado, pr_orcado_real, vl_orcado_passado) AS select cd_conta_financ, obter_ds_moeda_estrangeira(coalesce(cd_moeda,1)) ds_moeda, sum(CASE WHEN dt_referencia=to_date('30/01/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D30012019,sum(CASE WHEN dt_referencia=to_date('31/01/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D31012019,sum(CASE WHEN dt_referencia=to_date('01/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D01022019,sum(CASE WHEN dt_referencia=to_date('02/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D02022019,sum(CASE WHEN dt_referencia=to_date('03/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D03022019,sum(CASE WHEN dt_referencia=to_date('04/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D04022019,sum(CASE WHEN dt_referencia=to_date('05/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D05022019,sum(CASE WHEN dt_referencia=to_date('06/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D06022019,sum(CASE WHEN dt_referencia=to_date('07/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D07022019,sum(CASE WHEN dt_referencia=to_date('08/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D08022019,sum(CASE WHEN dt_referencia=to_date('09/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D09022019,sum(CASE WHEN dt_referencia=to_date('10/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D10022019,sum(CASE WHEN dt_referencia=to_date('11/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D11022019,sum(CASE WHEN dt_referencia=to_date('12/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D12022019,sum(CASE WHEN dt_referencia=to_date('13/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D13022019,sum(CASE WHEN dt_referencia=to_date('14/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D14022019,sum(CASE WHEN dt_referencia=to_date('15/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D15022019,sum(CASE WHEN dt_referencia=to_date('16/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D16022019,sum(CASE WHEN dt_referencia=to_date('17/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D17022019,sum(CASE WHEN dt_referencia=to_date('18/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D18022019,sum(CASE WHEN dt_referencia=to_date('19/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D19022019,sum(CASE WHEN dt_referencia=to_date('20/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D20022019,sum(CASE WHEN dt_referencia=to_date('21/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D21022019,sum(CASE WHEN dt_referencia=to_date('22/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D22022019,sum(CASE WHEN dt_referencia=to_date('23/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D23022019,sum(CASE WHEN dt_referencia=to_date('24/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D24022019,sum(CASE WHEN dt_referencia=to_date('25/02/2019','dd/mm/yyyy') THEN vl_fluxo  ELSE 0 END ) D25022019, CASE WHEN obter_se_totaliza_cf(cd_conta_financ)='S' THEN CASE WHEN obter_se_acumula_cf(cd_conta_financ)='S' THEN  obter_valor_final_fluxo(1, 'P', 'D', to_date('30/01/2019','dd/mm/yyyy') , to_date('25/02/2019','dd/mm/yyyy') , to_date('', 'dd/mm/yyyy' ), 3,                                                        cd_conta_financ)  ELSE CASE WHEN CD_CONTA_FINANC=132 THEN  obter_valor_fluxo_saldo(1, 'P', 'D', to_date('30/01/2019','dd/mm/yyyy') , to_date('25/02/2019','dd/mm/yyyy') , to_date('', 'dd/mm/yyyy' ), 2) WHEN CD_CONTA_FINANC=1 THEN  obter_valor_fluxo_saldo(1, 'P', 'D', to_date('30/01/2019','dd/mm/yyyy') , to_date('25/02/2019','dd/mm/yyyy') , to_date('', 'dd/mm/yyyy' ), 1)  ELSE sum(vl_fluxo) END  END   ELSE 0 END  Total, OBTER_VALOR_FLUXO_ORCADO( 	1,  a.cd_conta_financ, to_date('30/01/2019', 'dd/mm/yyyy'),  to_date('25/02/2019', 'dd/mm/yyyy'),1, 'S', 'D') vl_orcado ,CASE WHEN OBTER_VALOR_FLUXO_ORCADO(1,  a.cd_conta_financ, to_date('30/01/2019', 'dd/mm/yyyy'),  to_date('25/02/2019', 'dd/mm/yyyy'),1, 'S', 'D')=0 THEN  0   ELSE ((( CASE WHEN obter_se_totaliza_cf(cd_conta_financ)='S' THEN CASE WHEN obter_se_acumula_cf(cd_conta_financ)='S' THEN  obter_valor_final_fluxo(1, 'P', 'D', to_date('30/01/2019','dd/mm/yyyy') , to_date('25/02/2019','dd/mm/yyyy') , to_date('', 'dd/mm/yyyy' ), 3,                                                        cd_conta_financ)  ELSE CASE WHEN CD_CONTA_FINANC=132 THEN  obter_valor_fluxo_saldo(1, 'P', 'D', to_date('30/01/2019','dd/mm/yyyy') , to_date('25/02/2019','dd/mm/yyyy') , to_date('', 'dd/mm/yyyy' ), 2) WHEN CD_CONTA_FINANC=1 THEN  obter_valor_fluxo_saldo(1, 'P', 'D', to_date('30/01/2019','dd/mm/yyyy') , to_date('25/02/2019','dd/mm/yyyy') , to_date('', 'dd/mm/yyyy' ), 1)  ELSE sum(vl_fluxo) END  END   ELSE 0 END   - OBTER_VALOR_FLUXO_ORCADO( 	1,  a.cd_conta_financ, to_date('30/01/2019', 'dd/mm/yyyy'),  to_date('25/02/2019', 'dd/mm/yyyy'),1, 'S', 'D') ) / OBTER_VALOR_FLUXO_ORCADO( 	1,  a.cd_conta_financ, to_date('30/01/2019', 'dd/mm/yyyy'),  to_date('25/02/2019', 'dd/mm/yyyy'),1, 'S', 'D') ) * 100) END  pr_orcado_real , (OBTER_VALOR_FLUXO_ORCADO(1,  a.cd_conta_financ, to_date('30/01/2019', 'dd/mm/yyyy'),  to_date('25/02/2019', 'dd/mm/yyyy'),1, 'S', 'D') -  CASE WHEN CD_CONTA_FINANC=132 THEN  obter_valor_fluxo_saldo(1, 'P', 'D', to_date('30/01/2019','dd/mm/yyyy') , to_date('25/02/2019','dd/mm/yyyy') , to_date('', 'dd/mm/yyyy' ), 2) WHEN CD_CONTA_FINANC=1 THEN  obter_valor_fluxo_saldo(1, 'P', 'D', to_date('30/01/2019','dd/mm/yyyy') , to_date('25/02/2019','dd/mm/yyyy') , to_date('', 'dd/mm/yyyy' ), 1)  ELSE sum(vl_fluxo) END ) * (CASE WHEN substr(obter_descricao_padrao('CONTA_FINANCEIRA','IE_OPER_FLUXO',a.cd_conta_financ),1,1)='S' THEN -1 WHEN substr(obter_descricao_padrao('CONTA_FINANCEIRA','IE_OPER_FLUXO',a.cd_conta_financ),1,1)='D' THEN 1  ELSE CASE WHEN substr(obter_descricao_padrao('CONTA_FINANCEIRA','IE_VARIACAO',a.cd_conta_financ),1,1)='S' THEN -1 WHEN substr(obter_descricao_padrao('CONTA_FINANCEIRA','IE_VARIACAO',a.cd_conta_financ),1,1)='D' THEN 1  ELSE 0 END  END ) vl_orcado_passado  FROM fluxo_caixa a  where ie_classif_fluxo = 'P' and ie_periodo = 'D' and ((a.ie_classif_fluxo	= 'O' AND	(			
                            (			
                                (coalesce( 'S','E') = 'E') AND (a.cd_estabelecimento	= 1)
                            ) OR						       	
                            (						       
                                (coalesce('S','E') = 'S') AND  
                            (
                                (a.cd_estabelecimento	= 1) OR (obter_estab_financeiro(a.cd_estabelecimento) = 1)
                            )
                            ) OR (coalesce( 'S','E') = 'N')
                            )		
                        ) OR ( a.ie_classif_fluxo	<> 'O' AND cd_estabelecimento = 1 )) and ((obter_se_filtro_fluxo(a.nr_seq_conta_banco, null, null, wheb_usuario_pck.get_nm_usuario, null) ='S') or (ie_origem<>'D'))   and (dt_referencia between 	to_date('30/01/2019', 'dd/mm/yyyy') and	to_date('25/02/2019', 'dd/mm/yyyy'))  Group By cd_conta_financ, obter_ds_moeda_estrangeira(coalesce(cd_moeda,1));

