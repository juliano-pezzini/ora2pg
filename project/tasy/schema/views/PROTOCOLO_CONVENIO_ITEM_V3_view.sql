-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW protocolo_convenio_item_v3 (nr_atendimento, ie_proc_mat, dt_conta, dt_item, cd_item, cd_item_convenio, qt_item, vl_item, vl_medico, vl_anestesista, vl_filme, vl_auxiliares, vl_custo_operacional, nr_interno_conta, nr_conta_convenio, dt_acerto_conta, dt_acerto_convenio, cd_convenio, cd_categoria, cd_setor_atendimento, cd_motivo_exc_conta, ie_cobra_pf_pj, nr_seq_protocolo, cd_convenio_parametro, dt_mesano_referencia, dt_periodo_inicial, dt_periodo_final, ie_status_acerto, ie_cancelamento, cd_autorizacao, nr_sequencia, nr_prescricao, nr_sequencia_prescricao, cd_medico_executor, nr_lote_contabil, ie_funcao_medico, ie_origem_proced, ie_tipo_servico_sus, cd_setor_receita, nr_seq_proc_pacote, cd_cgc_prestador, nr_seq_apresent, ie_video, nr_seq_proc_interno, cd_estabelecimento, ie_emite_conta) AS SELECT	A.NR_ATENDIMENTO,
	1 IE_PROC_MAT,
	A.DT_CONTA,
	A.DT_PROCEDIMENTO      	DT_ITEM,
	A.CD_PROCEDIMENTO      	CD_ITEM,
	A.CD_PROCEDIMENTO_CONVENIO   CD_ITEM_CONVENIO,
	A.QT_PROCEDIMENTO      	QT_ITEM,
	A.VL_PROCEDIMENTO      	VL_ITEM,
	A.VL_MEDICO            	VL_MEDICO,
	A.VL_ANESTESISTA       	VL_ANESTESISTA,
	A.VL_MATERIAIS         	VL_FILME,
	A.VL_AUXILIARES        	VL_AUXILIARES,
	A.VL_CUSTO_OPERACIONAL 	VL_CUSTO_OPERACIONAL,
       	A.NR_INTERNO_CONTA,
	B.NR_CONTA_CONVENIO,
       	A.DT_ACERTO_CONTA,
       	A.DT_ACERTO_CONVENIO,
       	A.CD_CONVENIO,
       	A.CD_CATEGORIA,
       	A.CD_SETOR_ATENDIMENTO,
       	A.CD_MOTIVO_EXC_CONTA,
	A.IE_COBRA_PF_PJ,
	B.NR_SEQ_PROTOCOLO,
	B.CD_CONVENIO_PARAMETRO,
       	B.DT_MESANO_REFERENCIA,
       	B.DT_PERIODO_INICIAL,
       	B.DT_PERIODO_FINAL,
	B.IE_STATUS_ACERTO,
	B.IE_CANCELAMENTO,
	A.NR_DOC_CONVENIO CD_AUTORIZACAO,
	A.NR_SEQUENCIA,
	A.NR_PRESCRICAO,
	A.NR_SEQUENCIA_PRESCRICAO,
	A.CD_MEDICO_EXECUTOR	CD_MEDICO_EXECUTOR,
	A.NR_LOTE_CONTABIL,
	A.IE_FUNCAO_MEDICO IE_FUNCAO_MEDICO,
	A.IE_ORIGEM_PROCED,
	A.IE_TIPO_SERVICO_SUS,
	A.CD_SETOR_RECEITA,
	A.NR_SEQ_PROC_PACOTE,
	A.CD_CGC_PRESTADOR CD_CGC_PRESTADOR,
	B.NR_SEQ_APRESENT,
	A.ie_video,
	A.nr_seq_proc_interno,
	B.cd_estabelecimento,
	A.ie_emite_conta
FROM   	PROCEDIMENTO_PACIENTE A,
	CONTA_PACIENTE B
WHERE	A.NR_INTERNO_CONTA   	= B.NR_INTERNO_CONTA

UNION

SELECT	X.NR_ATENDIMENTO,
       	2 IE_PROC_MAT,
       	X.DT_CONTA,
       	X.DT_ATENDIMENTO       	DT_ITEM,
       	X.CD_MATERIAL          	CD_ITEM,
       	X.CD_MATERIAL_CONVENIO	CD_ITEM_CONVENIO,
       	X.QT_MATERIAL          	QT_ITEM,
       	X.VL_MATERIAL          	VL_ITEM,
       	0                      	VL_MEDICO,
       	0                      	VL_ANESTESISTA,
       	0                      	VL_FILME,
       	0                      	VL_AUXILIARES,
       	0                      	VL_CUSTO_OPERACIONAL,
       	X.NR_INTERNO_CONTA,
		Y.NR_CONTA_CONVENIO,
       	X.DT_ACERTO_CONTA,
       	X.DT_ACERTO_CONVENIO,
       	X.CD_CONVENIO,
       	X.CD_CATEGORIA,
       	X.CD_SETOR_ATENDIMENTO,
       	X.CD_MOTIVO_EXC_CONTA,
	'' IE_COBRA_PF_PJ,
	y.nr_seq_protocolo,
	Y.CD_CONVENIO_PARAMETRO,
       	Y.DT_MESANO_REFERENCIA,
       	Y.DT_PERIODO_INICIAL,
       	Y.DT_PERIODO_FINAL,
	Y.IE_STATUS_ACERTO,
	Y.IE_CANCELAMENTO,
	X.NR_DOC_CONVENIO CD_AUTORIZACAO,
	X.NR_SEQUENCIA,
	X.NR_PRESCRICAO,
	X.NR_SEQUENCIA_PRESCRICAO,
	''	CD_MEDICO_EXECUTOR,
	X.NR_LOTE_CONTABIL,
	'' IE_FUNCAO_MEDICO,
	0 IE_ORIGEM_PROCED,
	0 IE_TIPO_SERVICO_SUS,
	X.CD_SETOR_RECEITA,
	X.NR_SEQ_PROC_PACOTE,
	'' CD_CGC_PRESTADOR,
	Y.NR_SEQ_APRESENT,
	'N',
	0,
	y.cd_estabelecimento,
	x.ie_emite_conta
FROM   	MATERIAL_ATEND_PACIENTE X,
	CONTA_PACIENTE Y
WHERE 	X.NR_INTERNO_CONTA = Y.NR_INTERNO_CONTA;

