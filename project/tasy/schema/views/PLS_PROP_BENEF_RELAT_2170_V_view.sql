-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_prop_benef_relat_2170_v (nr_seq_proposta, nr_seq_plano, nr_seq_titular, nr_seq_titular_contrato, ds_endereco, nr_endereco, ds_complemento, ds_bairro, ds_municipio, sg_estado, cd_cep, ds_email, nr_telefone, nr_celular, ds_plano, nr_protocolo_ans, tx_coparticipacao, vl_maximo, ds_forma_cobranca, dt_dia_vencimento, ie_portabilidade) AS select	a.nr_sequencia nr_seq_proposta,
	f.nr_sequencia nr_seq_plano,
	b.nr_sequencia nr_seq_titular,
	0 nr_seq_titular_contrato,
	d.ds_endereco,
	d.nr_endereco,
	d.ds_complemento,
	d.ds_bairro,
	d.ds_municipio,
	d.sg_estado,
	d.cd_cep,
	d.ds_email,
	'(' || d.nr_ddd_telefone || ') ' || d.nr_telefone nr_telefone,
	'(' || c.nr_ddd_celular || ') ' || c.nr_telefone_celular nr_celular,
	f.ds_plano || ' - ' ||  pls_obter_acomodacoes_plano(f.nr_sequencia) ds_plano,
	f.nr_protocolo_ans,
	g.tx_coparticipacao,
	g.vl_maximo,
	obter_valor_dominio(1720, h.nr_seq_forma_cobranca) ds_forma_cobranca,
	h.dt_dia_vencimento,
	CASE WHEN b.nr_seq_portabilidade IS NULL THEN  wheb_mensagem_pck.get_texto(1199426)  ELSE 'Sim' END  ie_portabilidade
FROM pls_proposta_plano e, compl_pessoa_fisica d, pessoa_fisica c, pls_proposta_beneficiario b, pls_plano f
LEFT OUTER JOIN pls_regra_coparticipacao g ON (f.nr_sequencia = g.nr_seq_plano)
, pls_proposta_adesao a
LEFT OUTER JOIN pls_proposta_pagador h ON (a.nr_sequencia = h.nr_seq_proposta)
WHERE a.nr_sequencia 		= b.nr_seq_proposta and b.cd_beneficiario 	= c.cd_pessoa_fisica and c.cd_pessoa_fisica 	= d.cd_pessoa_fisica and a.nr_sequencia 		= e.nr_seq_proposta and e.nr_seq_plano 		= f.nr_sequencia   and d.ie_tipo_complemento 	= 1 and b.nr_seq_titular is null and b.nr_seq_titular_contrato is null

union

select	a.nr_sequencia nr_seq_proposta,
	f.nr_sequencia nr_seq_plano,
	0 nr_seq_titular,
	b.nr_sequencia nr_seq_titular_contrato,
	d.ds_endereco,
	d.nr_endereco,
	d.ds_complemento,
	d.ds_bairro,
	d.ds_municipio,
	d.sg_estado,
	d.cd_cep,
	d.ds_email,
	'(' || d.nr_ddd_telefone || ') ' || d.nr_telefone nr_telefone,
	'(' || c.nr_ddd_celular || ') ' || c.nr_telefone_celular nr_celular,
	f.ds_plano || ' - ' ||  pls_obter_acomodacoes_plano(f.nr_sequencia) ds_plano,
	f.nr_protocolo_ans,
	g.tx_coparticipacao,
	g.vl_maximo,
	obter_valor_dominio(1720, h.nr_seq_forma_cobranca) ds_forma_cobranca,
	h.dt_dia_vencimento,
	CASE WHEN b.nr_seq_portabilidade IS NULL THEN  wheb_mensagem_pck.get_texto(1199426)  ELSE 'Sim' END  ie_portabilidade
FROM pls_proposta_plano e, compl_pessoa_fisica d, pessoa_fisica c, pls_segurado b, pls_plano f
LEFT OUTER JOIN pls_regra_coparticipacao g ON (f.nr_Sequencia = g.nr_seq_plano)
, pls_proposta_adesao a
LEFT OUTER JOIN pls_proposta_pagador h ON (a.nr_sequencia = h.nr_seq_proposta)
WHERE b.cd_pessoa_fisica 	= c.cd_pessoa_fisica and c.cd_pessoa_fisica 	= d.cd_pessoa_fisica and a.nr_sequencia 		= e.nr_seq_proposta and e.nr_seq_plano 		= f.nr_sequencia   and d.ie_tipo_complemento 	= 1;

