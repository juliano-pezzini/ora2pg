-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW log_alteracao_prestador_v (ds_label, ds_valor_old, ds_valor_new, dt_atualizacao, nr_seq_prestador, dt_atualizacao_log) AS select	'Tipo serviço' ds_label,
	substr(obter_valor_dominio(2406,a.ds_valor_old),1,255) ds_valor_old,
	substr(obter_valor_dominio(2406,a.ds_valor_new),1,255) ds_valor_new,
	a.dt_atualizacao,
	(b.ds_chave_simples)::numeric  nr_seq_prestador,
	b.dt_atualizacao dt_atualizacao_log
FROM	tasy_log_alt_campo	a,
	tasy_log_alteracao	b
where	a.nr_seq_log_alteracao 	= b.nr_sequencia
and	b.nm_tabela 		= 'PLS_PRESTADOR'
and	a.nm_atributo 		= 'IE_TIPO_PRESTADOR'

union all

select	'Nome prestador' ds_label,
	substr(a.ds_valor_old,1,255) ds_valor_old,
	substr(a.ds_valor_new,1,255) ds_valor_new,
	a.dt_atualizacao,
	c.nr_sequencia nr_seq_prestador,
	b.dt_atualizacao dt_atualizacao_log
from	pls_prestador		c,
	tasy_log_alt_campo	a,
	tasy_log_alteracao	b
where	a.nr_seq_log_alteracao 	= b.nr_sequencia
and	((b.nm_tabela 		= 'PESSOA_JURIDICA' 	and
	a.nm_atributo 		= 'DS_RAZAO_SOCIAL' 	and
	c.cd_cgc 		= b.ds_chave_simples) 	or (b.nm_tabela 		= 'PESSOA_FISICA' 	and
	a.nm_atributo 		= 'NM_PESSOA_FISICA' 	and
	c.cd_pessoa_fisica	= b.ds_chave_simples))

union all

select	'Nome fantasia' ds_label,
	substr(a.ds_valor_old,1,255) ds_valor_old,
	substr(a.ds_valor_new,1,255) ds_valor_new,
	a.dt_atualizacao,
	c.nr_sequencia nr_seq_prestador,
	b.dt_atualizacao dt_atualizacao_log
from	pls_prestador		c,
	tasy_log_alt_campo	a,
	tasy_log_alteracao	b
where	a.nr_seq_log_alteracao 	= b.nr_sequencia
and	c.cd_cgc		= b.ds_chave_simples
and	b.nm_tabela	 	= 'PESSOA_JURIDICA'
and	a.nm_atributo	 	= 'NM_FANTASIA'

union all

select	'Especialidade' ds_label,
	substr(Obter_Desc_Espec_medica(a.ds_valor_old),1,255) ds_valor_old,
	substr(Obter_Desc_Espec_medica(a.ds_valor_new),1,255) ds_valor_new,
	a.dt_atualizacao,
	c.nr_sequencia nr_seq_prestador,
	b.dt_atualizacao dt_atualizacao_log
from	pls_prestador_med_espec d,
	pls_prestador		c,
	tasy_log_alt_campo	a,
	tasy_log_alteracao	b
where	a.nr_seq_log_alteracao 	= b.nr_sequencia
and	c.nr_sequencia		= d.nr_seq_prestador
and	d.nr_sequencia		= b.ds_chave_simples
and	b.nm_tabela 		= 'PLS_PRESTADOR_MED_ESPEC'
and	a.nm_atributo 		= 'CD_ESPECIALIDADE'

union all

select	'RQE' ds_label,
	substr(a.ds_valor_old,1,255) ds_valor_old,
	substr(a.ds_valor_new,1,255) ds_valor_new,
	a.dt_atualizacao,
	c.nr_sequencia nr_seq_prestador,
	b.dt_atualizacao dt_atualizacao_log
from	medico_especialidade	e,
	pls_prestador_med_espec d,
	pls_prestador		c,
	tasy_log_alt_campo	a,
	tasy_log_alteracao	b
where	a.nr_seq_log_alteracao 	= b.nr_sequencia
and	c.nr_sequencia		= d.nr_seq_prestador
and	c.cd_pessoa_fisica	= d.cd_pessoa_fisica
and	e.cd_especialidade	= d.cd_especialidade
and	e.nr_rqe		= a.ds_valor_new
and	b.nm_tabela 		= 'MEDICO_ESPECIALIDADE'
and	a.nm_atributo 		= 'NR_RQE'

union all

select	'Telefone' ds_label,
	substr(a.ds_valor_old,1,255) ds_valor_old,
	substr(a.ds_valor_new,1,255) ds_valor_new,
	a.dt_atualizacao,
	c.nr_sequencia nr_seq_prestador,
	b.dt_atualizacao dt_atualizacao_log
from	pessoa_juridica		d,
	pls_prestador		c,
	tasy_log_alt_campo	a,
	tasy_log_alteracao	b
where	a.nr_seq_log_alteracao 	= b.nr_sequencia
and	d.cd_cgc		= c.cd_cgc
and	d.nr_telefone		= a.ds_valor_new
and	b.nm_tabela 		= 'PESSOA_JURIDICA'
and	a.nm_atributo 		= 'NR_TELEFONE'

union all

select	'Telefone' ds_label,
	substr(a.ds_valor_old,1,255) ds_valor_old,
	substr(a.ds_valor_new,1,255) ds_valor_new,
	a.dt_atualizacao,
	c.nr_sequencia nr_seq_prestador,
	b.dt_atualizacao dt_atualizacao_log
from	COMPL_PESSOA_FISICA	d,
	pls_prestador		c,
	tasy_log_alt_campo	a,
	tasy_log_alteracao	b
where	a.nr_seq_log_alteracao 	= b.nr_sequencia
and	d.nr_sequencia		= b.ds_chave_simples
and	d.cd_pessoa_fisica	= c.cd_pessoa_fisica
and	d.nr_telefone		= a.ds_valor_new
and	b.nm_tabela 		= 'COMPL_PESSOA_FISICA'
and	a.nm_atributo 		= 'NR_TELEFONE'

union all

select	'Endereço' ds_label,
	substr(a.ds_valor_old,1,255) ds_valor_old,
	substr(a.ds_valor_new,1,255) ds_valor_new,
	a.dt_atualizacao,
	c.nr_sequencia nr_seq_prestador,
	b.dt_atualizacao dt_atualizacao_log
from	COMPL_PESSOA_FISICA	d,
	pls_prestador		c,
	tasy_log_alt_campo	a,
	tasy_log_alteracao	b
where	a.nr_seq_log_alteracao 	= b.nr_sequencia
and	d.nr_sequencia		= b.ds_chave_simples
and	d.cd_pessoa_fisica	= c.cd_pessoa_fisica
and	d.nr_telefone		= a.ds_valor_new
and	b.nm_tabela 		= 'COMPL_PESSOA_FISICA'
and	a.nm_atributo 		= 'DS_ENDERECO'

union all

select	'Endereço' ds_label,
	substr(a.ds_valor_old,1,255) ds_valor_old,
	substr(a.ds_valor_new,1,255) ds_valor_new,
	a.dt_atualizacao,
	c.nr_sequencia nr_seq_prestador,
	b.dt_atualizacao dt_atualizacao_log
from	pessoa_juridica		d,
	pls_prestador		c,
	tasy_log_alt_campo	a,
	tasy_log_alteracao	b
where	a.nr_seq_log_alteracao 	= b.nr_sequencia
and	d.cd_cgc		= c.cd_cgc
and	d.nr_telefone		= a.ds_valor_new
and	b.nm_tabela 		= 'PESSOA_JURIDICA'
and	a.nm_atributo 		= 'DS_ENDERECO'

union all

select	'Endereço' ds_label,
	substr(a.ds_valor_old,1,255) ds_valor_old,
	substr(a.ds_valor_new,1,255) ds_valor_new,
	a.dt_atualizacao,
	c.nr_sequencia nr_seq_prestador,
	b.dt_atualizacao dt_atualizacao_log
from	pessoa_juridica_compl	d,
	pls_prestador		c,
	tasy_log_alt_campo	a,
	tasy_log_alteracao	b
where	a.nr_seq_log_alteracao 	= b.nr_sequencia
and	d.nr_sequencia		= b.ds_chave_simples
and	d.cd_cgc		= c.cd_cgc
and	d.nr_telefone		= a.ds_valor_new
and	b.nm_tabela 		= 'PESSOA_JURIDICA_COMPL'
and	a.nm_atributo 		= 'DS_ENDERECO';

