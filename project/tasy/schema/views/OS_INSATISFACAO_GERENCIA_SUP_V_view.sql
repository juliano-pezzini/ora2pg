-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW os_insatisfacao_gerencia_sup_v (nr_sequencia, dt_fim_real, nr_seq_gerencia_sup, nr_seq_grupo_sup, ds_dano_breve, ie_origem_os, nr_seq_localizacao, cd_funcao, nr_seq_gerencia_insatisf, ie_situacao) AS select	a.nr_sequencia,
	a.dt_fim_real,
	coalesce(a.nr_seq_gerencia_insatisf, c.nr_seq_gerencia_sup) nr_seq_gerencia_sup,
	a.nr_seq_grupo_sup,
	a.ds_dano_breve,
	a.ie_origem_os,
	a.nr_seq_localizacao,
	a.cd_funcao,
	a.nr_seq_gerencia_insatisf,
	c.ie_situacao
FROM	gerencia_wheb g,
	man_ordem_servico a,
	man_grau_satisf_justif b,
	grupo_suporte c
where	a.nr_seq_justif_grau_satisf = b.nr_sequencia
and	a.nr_seq_grupo_sup = c.nr_sequencia
and	g.nr_sequencia = coalesce(a.nr_seq_gerencia_insatisf, c.nr_seq_gerencia_sup)
and	c.ie_situacao = 'A'
and	g.ie_area_gerencia = 'SUP'
and	a.ie_status_ordem = 3
and	coalesce(b.ie_indicador, 'S') = 'S'
and	a.ie_grau_satisfacao in ('P', 'R')
and	exists (	select	1
			from	man_ordem_serv_estagio d,
				man_estagio_processo e
			where 	d.nr_seq_estagio = e.nr_sequencia
			and	d.nr_seq_ordem = a.nr_sequencia
			and	ie_suporte = 'S'
		);

