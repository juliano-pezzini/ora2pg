-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW status_bed_all_department (cd_setor_atendimento, ds_departamento, rt_taxa_ocupacao, nu_leitos, nu_hospitalization, ds_empyt_bed, ds_empyt_bed_today, ds_pacientes_agenda_alta, ds_schdl_trnsf_out, ds_schdl_hospit_today, ds_schdl_trnsf_today, nu_hospitalization_s, ds_empyt_bed_s, ds_empyt_bed_today_s, ds_pacientes_agenda_alta_s, ds_schdl_trnsf_out_s, ds_schdl_hospit_today_s, ds_schdl_trnsf_today_s, ds_empty_bed_tomorrow, ds_schdl_discharged_tomorrow, ds_schdl_trnsf_out_tomorrow, ds_schdl_admssion_tomorrow, ds_schdl_trnsf_in_tomorrow, ds_empty_bed_tomorrow_s, ds_schdl_discharged_tomorrow_s, ds_schdl_trnsf_out_tomorrow_s, ds_schdl_admssion_tomorrow_s, ds_schdl_trnsf_in_tomorrow_s, ds_empty_beds_after_tomorrow, ds_schdl_dischrgd_da_tomorrow, ds_schdl_trnsf_ot_d1_tomorrow, ds_schdl_hospit_day_a_tomorrow, ds_schdl_trnsf_in_d1_tomorrow, ds_empty_beds_after_tomorr_s, ds_schdl_dischrgd_da_tomorr_s, ds_schdl_trnsf_ot_d1_tomorr_s, ds_schdl_hospit_day_a_tomorr_s, ds_schdl_trnsf_in_d1_tomorr_s) AS SELECT
        a.CD_SETOR_ATENDIMENTO,a.DS_DEPARTAMENTO,a.RT_TAXA_OCUPACAO,a.NU_LEITOS,a.NU_HOSPITALIZATION,a.DS_EMPYT_BED,a.DS_EMPYT_BED_TODAY,a.DS_PACIENTES_AGENDA_ALTA,a.DS_SCHDL_TRNSF_OUT,a.DS_SCHDL_HOSPIT_TODAY,a.DS_SCHDL_TRNSF_TODAY,a.NU_HOSPITALIZATION_S,a.DS_EMPYT_BED_S,a.DS_EMPYT_BED_TODAY_S,a.DS_PACIENTES_AGENDA_ALTA_S,a.DS_SCHDL_TRNSF_OUT_S,a.DS_SCHDL_HOSPIT_TODAY_S,a.DS_SCHDL_TRNSF_TODAY_S,a.DS_EMPTY_BED_TOMORROW,a.DS_SCHDL_DISCHARGED_TOMORROW,a.DS_SCHDL_TRNSF_OUT_TOMORROW,a.DS_SCHDL_ADMSSION_TOMORROW,a.DS_SCHDL_TRNSF_IN_TOMORROW,a.DS_EMPTY_BED_TOMORROW_S,a.DS_SCHDL_DISCHARGED_TOMORROW_S,a.DS_SCHDL_TRNSF_OUT_TOMORROW_S,a.DS_SCHDL_ADMSSION_TOMORROW_S,a.DS_SCHDL_TRNSF_IN_TOMORROW_S,a.DS_EMPTY_BEDS_AFTER_TOMORROW,a.DS_SCHDL_DISCHRGD_DA_TOMORROW,a.DS_SCHDL_TRNSF_OT_D1_TOMORROW,a.DS_SCHDL_HOSPIT_DAY_A_TOMORROW,a.DS_SCHDL_TRNSF_IN_D1_TOMORROW,a.DS_EMPTY_BEDS_AFTER_TOMORR_S,a.DS_SCHDL_DISCHRGD_DA_TOMORR_S,a.DS_SCHDL_TRNSF_OT_D1_TOMORR_S,a.DS_SCHDL_HOSPIT_DAY_A_TOMORR_S,a.DS_SCHDL_TRNSF_IN_D1_TOMORR_S
    FROM
        (
            WITH leito_departamento AS (
                SELECT
                    ua.cd_setor_atendimento,
                    c.cd_setor_atendimento
                    || '- '
                    || c.ds_setor_atendimento                                                                                                AS ds_setor_atendimento,
                    SUM(CASE WHEN ua.nr_atendimento IS NULL THEN  0  ELSE CASE WHEN ua.ie_status_unidade='P' THEN  1  ELSE 0 END  END )                                         AS qt_hospitalization,
                    SUM(CASE WHEN ua.ie_status_unidade='P' THEN  1  ELSE 0 END )                                                                             AS nr_unidades_atendimento,
                    SUM(CASE WHEN ua.ie_status_unidade='L' THEN  1  ELSE 0 END )                                                                             AS qt_leitos_livres,
                    COUNT(ua.ie_status_unidade)                                                                                             AS qt_leitos_total,
                    SUM(CASE WHEN ua.ie_status_unidade='L' THEN  CASE WHEN ua.ie_sexo_paciente='M' THEN  1  ELSE 0 END   ELSE 0 END )                                        AS qt_leito_livre_m,
                    SUM(CASE WHEN ua.ie_status_unidade='L' THEN  CASE WHEN ua.ie_sexo_paciente='F' THEN  1  ELSE 0 END   ELSE 0 END )                                        AS qt_leito_livre_f,
                    SUM(CASE WHEN ua.ie_status_unidade='L' THEN  CASE WHEN ua.ie_sexo_paciente='M' THEN  0  ELSE CASE WHEN ua.ie_sexo_paciente='F' THEN  0  ELSE 1 END  END   ELSE 0 END )   AS qt_leito_livre_x
                FROM
                    unidade_atendimento  ua,
                    setor_atendimento    c
                WHERE
                        ua.cd_setor_atendimento = c.cd_setor_atendimento
                    AND ua.ie_situacao = 'A'
                    AND c.ie_situacao = 'A'
                GROUP BY
                    ua.cd_setor_atendimento,
                    c.cd_setor_atendimento
                    || '- '
                    || c.ds_setor_atendimento
            ), atendimentos_previsao_alta AS (
                SELECT
                    ua.cd_setor_atendimento,
                    trunc(ap.dt_previsto_alta)                                                         AS dt_previsto_alta,
                    SUM(CASE WHEN ua.ie_sexo_paciente='M' THEN  1  ELSE 0 END )                                        AS qt_leito_alta_m,
                    SUM(CASE WHEN ua.ie_sexo_paciente='F' THEN  1  ELSE 0 END )                                        AS qt_leito_alta_f,
                    SUM(CASE WHEN ua.ie_sexo_paciente='M' THEN  0  ELSE CASE WHEN ua.ie_sexo_paciente='F' THEN  0  ELSE 1 END  END )   AS qt_leito_alta_x
                FROM
                    atendimento_paciente  ap,
                    unidade_atendimento   ua
                WHERE
                    trunc(ap.dt_previsto_alta) BETWEEN trunc(LOCALTIMESTAMP) AND trunc(LOCALTIMESTAMP + interval '2 days')
                    AND ua.nr_atendimento = ap.nr_atendimento
                GROUP BY
                    ua.cd_setor_atendimento,
                    trunc(ap.dt_previsto_alta)
            ), internacao_prog_transf_out AS (
                SELECT
                    ua.cd_setor_atendimento,
                    trunc(coalesce(g.dt_prevista, g.dt_solicitacao))                                       AS dt_trans_externa,
                    SUM(CASE WHEN ua.ie_sexo_paciente='M' THEN  1  ELSE 0 END )                                       AS qt_pacientes_m,
                    SUM(CASE WHEN ua.ie_sexo_paciente='F' THEN  1  ELSE 0 END )                                       AS qt_pacientes_f,
                    SUM(CASE WHEN ua.ie_sexo_paciente='M' THEN  0  ELSE CASE WHEN ua.ie_sexo_paciente='F' THEN  0  ELSE 1 END  END )  AS qt_pacientes_x
                FROM
                    gestao_vaga          g,
                    unidade_atendimento  ua
                WHERE
                        ua.nr_atendimento = g.nr_atendimento
                    AND ie_solicitacao = 'TE' /* transferencia externa */
                    AND trunc(coalesce(g.dt_prevista, g.dt_solicitacao)) BETWEEN trunc(LOCALTIMESTAMP) AND trunc(LOCALTIMESTAMP + interval '2 days')
                GROUP BY
                    ua.cd_setor_atendimento,
                    trunc(coalesce(g.dt_prevista, g.dt_solicitacao))
            ), internacao_hospitalizada AS (
                SELECT
                    ua.cd_setor_atendimento,
                    trunc(coalesce(g.dt_prevista, g.dt_solicitacao))                                                          AS dt_hospt,
                    SUM(CASE WHEN ua.ie_sexo_paciente='M' THEN  1  ELSE 0 END )                                                          AS qt_pacientes_m,
                    SUM(CASE WHEN ua.ie_sexo_paciente='F' THEN  1  ELSE 0 END )                                                          AS qt_pacientes_f,
                    SUM(CASE WHEN ua.ie_sexo_paciente='M' THEN  0  ELSE CASE WHEN ua.ie_sexo_paciente='F' THEN  0  ELSE 1 END  END )                     AS qt_pacientes_x
                FROM
                    gestao_vaga          g,
                    unidade_atendimento  ua
                WHERE
                        ua.nr_atendimento = g.nr_atendimento
                    AND ie_solicitacao = 'I'  /* Hospitalizacao */
                    AND trunc(coalesce(g.dt_prevista, g.dt_solicitacao)) BETWEEN trunc(LOCALTIMESTAMP) AND trunc(LOCALTIMESTAMP + interval '2 days')
                GROUP BY
                    ua.cd_setor_atendimento,
                    trunc(coalesce(g.dt_prevista, g.dt_solicitacao))
            ), internacao_prog_transf_in AS (
                SELECT
                    ua.cd_setor_atendimento,
                    trunc(coalesce(g.dt_prevista, g.dt_solicitacao))                                                          AS dt_trans_int,
                    SUM(CASE WHEN ua.ie_sexo_paciente='M' THEN  1  ELSE 0 END )                                                          AS qt_pacientes_m,
                    SUM(CASE WHEN ua.ie_sexo_paciente='F' THEN  1  ELSE 0 END )                                                          AS qt_pacientes_f,
                    SUM(CASE WHEN ua.ie_sexo_paciente='M' THEN  0  ELSE CASE WHEN ua.ie_sexo_paciente='F' THEN  0  ELSE 1 END  END )                     AS qt_pacientes_x
                FROM
                    gestao_vaga          g,
                    unidade_atendimento  ua
                WHERE
                        ua.nr_atendimento = g.nr_atendimento
                    AND ie_solicitacao = 'TI' /* Transferencia Interna */
                    AND trunc(coalesce(g.dt_prevista, g.dt_solicitacao)) BETWEEN trunc(LOCALTIMESTAMP) AND trunc(LOCALTIMESTAMP + interval '2 days')
                GROUP BY
                    ua.cd_setor_atendimento,
                    trunc(coalesce(g.dt_prevista, g.dt_solicitacao))
            )
            SELECT
                ld.cd_setor_atendimento,
                ld.ds_setor_atendimento                                                                                                    AS ds_departamento,
                to_char(round((coalesce(ld.qt_hospitalization, 0) / coalesce(ld.qt_leitos_total, 1)) * 100, 2), '990D99') || ' %'                    AS rt_taxa_ocupacao,
                lpad(coalesce(ld.qt_leitos_total, 0), 3, '0')                                                                                   AS nu_leitos,
                lpad(coalesce(ld.qt_hospitalization, 0), 3, '0')                                                                                AS nu_hospitalization,

                lpad(coalesce(ld.qt_leito_livre_m, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) ||
                lpad(coalesce(ld.qt_leito_livre_f, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(ld.qt_leito_livre_x, 0), 5, '0')                                                                                  AS ds_empyt_bed,

                lpad(obter_empyt_bed(ld.cd_setor_atendimento, 'M', LOCALTIMESTAMP), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(obter_empyt_bed(ld.cd_setor_atendimento, 'F', LOCALTIMESTAMP), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(obter_empyt_bed(ld.cd_setor_atendimento, 'x', LOCALTIMESTAMP), 5, '0')                                                       AS ds_empyt_bed_today,

                lpad(coalesce(apa0.qt_leito_alta_m, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(apa0.qt_leito_alta_f, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(apa0.qt_leito_alta_x, 0), 5, '0')                                                                                 AS ds_pacientes_agenda_alta,

                lpad(coalesce(ipto0.qt_pacientes_m, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(ipto0.qt_pacientes_f, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(ipto0.qt_pacientes_x, 0), 5, '0')                                                                                 AS ds_schdl_trnsf_out,

                lpad(coalesce(hosp0.qt_pacientes_m, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(hosp0.qt_pacientes_f, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(hosp0.qt_pacientes_x, 0), 5, '0')                                                                                 AS ds_schdl_hospit_today,

                lpad(coalesce(ipti0.qt_pacientes_m, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(ipti0.qt_pacientes_f, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(ipti0.qt_pacientes_x, 0), 5, '0')                                                                                 AS ds_schdl_trnsf_today,
                coalesce(ld.qt_hospitalization, 0)                                                                                              AS nu_hospitalization_s,

                coalesce(ld.qt_leito_livre_m, 0) + coalesce(ld.qt_leito_livre_f, 0) + coalesce(ld.qt_leito_livre_x, 0)                                    AS ds_empyt_bed_s,
                obter_empyt_bed(ld.cd_setor_atendimento, 'M', LOCALTIMESTAMP) + 
                obter_empyt_bed(ld.cd_setor_atendimento, 'F', LOCALTIMESTAMP) + 
                obter_empyt_bed(ld.cd_setor_atendimento, 'x', LOCALTIMESTAMP)                 AS ds_empyt_bed_today_s,
                coalesce(apa0.qt_leito_alta_m, 0) + coalesce(apa0.qt_leito_alta_f, 0) + coalesce(apa0.qt_leito_alta_x, 0)                                 AS ds_pacientes_agenda_alta_s,
                coalesce(ipto0.qt_pacientes_m, 0) + coalesce(ipto0.qt_pacientes_f, 0) + coalesce(ipto0.qt_pacientes_x, 0)                                 AS ds_schdl_trnsf_out_s,
                coalesce(hosp0.qt_pacientes_m, 0) + coalesce(hosp0.qt_pacientes_f, 0) + coalesce(hosp0.qt_pacientes_x, 0)                                 AS ds_schdl_hospit_today_s,
                coalesce(ipti0.qt_pacientes_m, 0) + coalesce(ipti0.qt_pacientes_f, 0) + coalesce(ipti0.qt_pacientes_x, 0)                                 AS ds_schdl_trnsf_today_s,

                lpad(obter_empyt_bed(ld.cd_setor_atendimento, 'M',  LOCALTIMESTAMP + interval '1 days'), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(obter_empyt_bed(ld.cd_setor_atendimento, 'F',  LOCALTIMESTAMP + interval '1 days'), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(obter_empyt_bed(ld.cd_setor_atendimento, 'x',  LOCALTIMESTAMP + interval '1 days'), 5, '0') AS ds_empty_bed_tomorrow,

                lpad(coalesce(apa1.qt_leito_alta_m, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(apa1.qt_leito_alta_f, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(apa1.qt_leito_alta_x, 0), 5, '0')                                                                                   AS ds_schdl_discharged_tomorrow,

                lpad(coalesce(ipto1.qt_pacientes_m, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(ipto1.qt_pacientes_f, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(ipto1.qt_pacientes_x, 0), 5, '0')                                                                                   AS ds_schdl_trnsf_out_tomorrow,

                lpad(coalesce(hosp1.qt_pacientes_m, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(hosp1.qt_pacientes_f, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(hosp1.qt_pacientes_x, 0), 5, '0')                                                                                   AS ds_schdl_admssion_tomorrow,

                lpad(coalesce(ipti1.qt_pacientes_m, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(ipti1.qt_pacientes_f, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(ipti1.qt_pacientes_x, 0), 5, '0')                                                                                   AS ds_schdl_trnsf_in_tomorrow,

                obter_empyt_bed(ld.cd_setor_atendimento,  'M',  LOCALTIMESTAMP + interval '1 days') + 
                obter_empyt_bed(ld.cd_setor_atendimento,  'F',  LOCALTIMESTAMP + interval '1 days') + 
                obter_empyt_bed(ld.cd_setor_atendimento,  'x',  LOCALTIMESTAMP + interval '1 days')               AS ds_empty_bed_tomorrow_s,

                coalesce(apa1.qt_leito_alta_m, 0) + coalesce(apa1.qt_leito_alta_f, 0) + coalesce(apa1.qt_leito_alta_x, 0)                                   AS ds_schdl_discharged_tomorrow_s,
                coalesce(ipto1.qt_pacientes_m, 0) + coalesce(ipto1.qt_pacientes_f, 0) + coalesce(ipto1.qt_pacientes_x, 0)                                   AS ds_schdl_trnsf_out_tomorrow_s,
                coalesce(hosp1.qt_pacientes_m, 0) + coalesce(hosp1.qt_pacientes_f, 0) + coalesce(hosp1.qt_pacientes_x, 0)                                   AS ds_schdl_admssion_tomorrow_s,
                coalesce(ipti1.qt_pacientes_m, 0) + coalesce(ipti1.qt_pacientes_f, 0) + coalesce(ipti1.qt_pacientes_x, 0)                                   AS ds_schdl_trnsf_in_tomorrow_s,

                lpad(obter_empyt_bed(ld.cd_setor_atendimento, 'M', LOCALTIMESTAMP + interval '2 days'), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(obter_empyt_bed(ld.cd_setor_atendimento, 'F', LOCALTIMESTAMP + interval '2 days'), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(obter_empyt_bed(ld.cd_setor_atendimento, 'x', LOCALTIMESTAMP + interval '2 days'), 5, '0') AS ds_empty_beds_after_tomorrow,

                lpad(coalesce(apa2.qt_leito_alta_m, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(apa2.qt_leito_alta_f, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(apa2.qt_leito_alta_x, 0), 5, '0')                                                                                   AS ds_schdl_dischrgd_da_tomorrow,

                lpad(coalesce(ipto2.qt_pacientes_m, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(ipto2.qt_pacientes_f, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(ipto2.qt_pacientes_x, 0), 5, '0')                                                                                   AS ds_schdl_trnsf_ot_d1_tomorrow,

                lpad(coalesce(hosp2.qt_pacientes_m, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(hosp2.qt_pacientes_f, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(hosp2.qt_pacientes_x, 0), 5, '0')                                                                                   AS ds_schdl_hospit_day_a_tomorrow,

                lpad(coalesce(ipti2.qt_pacientes_m, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(ipti2.qt_pacientes_f, 0), 5, '0') || CHR(9) || ' | ' || CHR(9) || 
                lpad(coalesce(ipti2.qt_pacientes_x, 0), 5, '0')                                                                                   AS ds_schdl_trnsf_in_d1_tomorrow,

                obter_empyt_bed( ld.cd_setor_atendimento, 'M', LOCALTIMESTAMP + interval '2 days') + 
                obter_empyt_bed( ld.cd_setor_atendimento, 'F', LOCALTIMESTAMP + interval '2 days') + 
                obter_empyt_bed( ld.cd_setor_atendimento, 'x', LOCALTIMESTAMP + interval '2 days')               AS ds_empty_beds_after_tomorr_s,

                coalesce(apa2.qt_leito_alta_m, 0) + coalesce(apa2.qt_leito_alta_f, 0) + coalesce(apa2.qt_leito_alta_x, 0)                                   AS ds_schdl_dischrgd_da_tomorr_s,
                coalesce(ipto2.qt_pacientes_m, 0) + coalesce(ipto2.qt_pacientes_f, 0) + coalesce(ipto2.qt_pacientes_x, 0)                                   AS ds_schdl_trnsf_ot_d1_tomorr_s,
                coalesce(hosp2.qt_pacientes_m, 0) + coalesce(hosp2.qt_pacientes_f, 0) + coalesce(hosp2.qt_pacientes_x, 0)                                   AS ds_schdl_hospit_day_a_tomorr_s,
                coalesce(ipti2.qt_pacientes_m, 0) + coalesce(ipti2.qt_pacientes_f, 0) + coalesce(ipti2.qt_pacientes_x, 0)                                   AS ds_schdl_trnsf_in_d1_tomorr_s
            FROM leito_departamento ld
LEFT OUTER JOIN atendimentos_previsao_alta apa0 ON (ld.cd_setor_atendimento = apa0.cd_setor_atendimento AND trunc(LOCALTIMESTAMP) = apa0.dt_previsto_alta)
LEFT OUTER JOIN internacao_prog_transf_out ipto0 ON (ld.cd_setor_atendimento = ipto0.cd_setor_atendimento AND trunc(LOCALTIMESTAMP) = ipto0.dt_trans_externa)
LEFT OUTER JOIN internacao_hospitalizada hosp0 ON (ld.cd_setor_atendimento = hosp0.cd_setor_atendimento AND trunc(LOCALTIMESTAMP) = hosp0.dt_hospt)
LEFT OUTER JOIN internacao_prog_transf_in ipti0 ON (ld.cd_setor_atendimento = ipti0.cd_setor_atendimento AND trunc(LOCALTIMESTAMP) = ipti0.dt_trans_int)
LEFT OUTER JOIN atendimentos_previsao_alta apa1 ON (ld.cd_setor_atendimento = apa1.cd_setor_atendimento AND trunc(LOCALTIMESTAMP + interval '1 days') = apa1.dt_previsto_alta)
LEFT OUTER JOIN internacao_prog_transf_out ipto1 ON (ld.cd_setor_atendimento = ipto1.cd_setor_atendimento AND trunc(LOCALTIMESTAMP + interval '1 days') = ipto1.dt_trans_externa)
LEFT OUTER JOIN internacao_hospitalizada hosp1 ON (ld.cd_setor_atendimento = hosp1.cd_setor_atendimento AND trunc(LOCALTIMESTAMP + interval '1 days') = hosp1.dt_hospt)
LEFT OUTER JOIN internacao_prog_transf_in ipti1 ON (ld.cd_setor_atendimento = ipti1.cd_setor_atendimento AND trunc(LOCALTIMESTAMP + interval '1 days') = ipti1.dt_trans_int)
LEFT OUTER JOIN atendimentos_previsao_alta apa2 ON (ld.cd_setor_atendimento = apa2.cd_setor_atendimento AND trunc(LOCALTIMESTAMP + interval '2 days') = apa2.dt_previsto_alta)
LEFT OUTER JOIN internacao_prog_transf_out ipto2 ON (ld.cd_setor_atendimento = ipto2.cd_setor_atendimento AND trunc(LOCALTIMESTAMP + interval '2 days') = ipto2.dt_trans_externa)
LEFT OUTER JOIN internacao_hospitalizada hosp2 ON (ld.cd_setor_atendimento = hosp2.cd_setor_atendimento AND trunc(LOCALTIMESTAMP + interval '2 days') = hosp2.dt_hospt)
LEFT OUTER JOIN internacao_prog_transf_in ipti2 ON (ld.cd_setor_atendimento = ipti2.cd_setor_atendimento AND trunc(LOCALTIMESTAMP + interval '2 days') = ipti2.dt_trans_int) ) a;

