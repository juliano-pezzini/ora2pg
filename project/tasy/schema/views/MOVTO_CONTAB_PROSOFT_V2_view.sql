-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW movto_contab_prosoft_v2 (tp_registro, nr_ordem, ie_modo_lancto, dt_escritura, nr_documento, nr_lote_contabil, ds_origem_lancto, qt_contas, cd_conta_debito, cd_conta_debito_terc, cd_conta_debito_custo, cd_conta_cred_acesso, cd_conta_cred_custo, cd_conta_cred_terc, vl_lancamento, ds_historico, ie_debito_credito, cd_acesso, cd_terceiro, cd_centro_custo, nr_sequencia) AS select	'LC1' tp_registro,
	1 NR_ORDEM,
	'1' IE_MODO_LANCTO,
	DT_ESCRITURA,
	nr_documento,
	nr_lote_contabil,
	' ' DS_ORIGEM_LANCTO,
	'000' QT_CONTAS,
	CASE WHEN ie_debito_credito='D' THEN  coalesce(CD_CONTA_DEBITO,21516)  ELSE 21516 END  CD_CONTA_DEBITO,
	' ' CD_CONTA_DEBITO_TERC,
	CASE WHEN  substr(coalesce(CASE WHEN ie_debito_credito='D' THEN  coalesce(CD_CONTA_DEBITO,21516)  ELSE 21516 END , CASE WHEN ie_debito_credito='C' THEN  coalesce(CD_CONTA_CRED_ACESSO,21516)  ELSE 21516 END ),1,1)='1' THEN  null WHEN  substr(coalesce(CASE WHEN ie_debito_credito='D' THEN  coalesce(CD_CONTA_DEBITO,21516)  ELSE 21516 END , CASE WHEN ie_debito_credito='C' THEN  coalesce(CD_CONTA_CRED_ACESSO,21516)  ELSE 21516 END ),1,1)='2' THEN  null  ELSE CD_CONTA_DEBITO_CUSTO END  CD_CONTA_DEBITO_CUSTO,
	CASE WHEN ie_debito_credito='C' THEN  coalesce(CD_CONTA_CRED_ACESSO,21516)  ELSE 21516 END  CD_CONTA_CRED_ACESSO,
	CASE WHEN coalesce(CASE WHEN ie_debito_credito='C' THEN  coalesce(CD_CONTA_CRED_ACESSO,21516)  ELSE null END , 21516)=21516 THEN  null  ELSE CD_CONTA_CRED_CUSTO END  CD_CONTA_CRED_CUSTO,
	' ' CD_CONTA_CRED_TERC,
	VL_LANCAMENTO,
	ds_historico,
	ie_debito_credito,
	CASE WHEN ie_debito_credito='C' THEN  coalesce(cd_acesso,21516)  ELSE null END  cd_acesso,
	' ' cd_terceiro,
	CASE WHEN  substr(coalesce(CD_CONTA_DEBITO, CD_CONTA_CRED_ACESSO),1,1)='1' THEN  null WHEN  substr(coalesce(CD_CONTA_DEBITO, CD_CONTA_CRED_ACESSO),1,1)=substr(coalesce(CD_CONTA_DEBITO, CD_CONTA_CRED_ACESSO),1,1) THEN  '2' WHEN  substr(coalesce(CD_CONTA_DEBITO, CD_CONTA_CRED_ACESSO),1,1) IS NULL THEN 		CD_CENTRO_CUSTO END  CD_CENTRO_CUSTO,
	nr_sequencia
FROM (
	SELECT	dt_movimento DT_ESCRITURA,
		nr_documento,
		nr_lote_contabil,
		CASE WHEN CD_CONTA_DEBITO=0 THEN  null  ELSE CD_CONTA_DEBITO END  CD_CONTA_DEBITO,
		CASE WHEN coalesce(cd_centro_custo,0)=0 THEN null  ELSE CD_CENTRO_CUSTO END  CD_CONTA_DEBITO_CUSTO,
		CASE WHEN CD_CONTA_CREDITO=0 THEN  null  ELSE CD_CONTA_CREDITO END  CD_CONTA_CRED_ACESSO,
		CASE WHEN coalesce(cd_centro_custo,0)=0 THEN null  ELSE CD_CENTRO_CUSTO END  CD_CONTA_CRED_CUSTO,
		vl_movimento VL_LANCAMENTO,
		DS_COMPL_HISTORICO ds_historico,
		ie_debito_credito,
		CASE WHEN CD_CONTA_CREDITO=0 THEN  null  ELSE CD_CONTA_CREDITO END  cd_acesso,
		CASE WHEN coalesce(cd_centro_custo,0)=0 THEN null  ELSE CD_CENTRO_CUSTO END  CD_CENTRO_CUSTO,
		nr_sequencia
	FROM	movimento_Contabil_v) alias24
order	by CD_CONTA_DEBITO,
	nr_sequencia
;

