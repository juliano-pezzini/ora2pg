-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pessoa_fisica_usuario_v (nm_pessoa_fisica, cd_cargo, cd_pessoa_fisica, nm_social, ds_codigo_prof, ie_situacao, ds_funcao_evolucao, ds_conselho, nr_crm, cd_setor, ds_setor, ds_email) AS select	a.nm_pessoa_fisica,
		a.cd_cargo,
	    a.CD_PESSOA_FISICA,
        a.nm_social,
        a.DS_CODIGO_PROF,
	b.ie_situacao,
	substr(obter_valor_dominio(72,b.ie_tipo_evolucao),1,80) ds_funcao_evolucao,
	substr(obter_conselho_profissional(a.nr_seq_conselho,'S'),1,60) ds_conselho,
	substr(obter_crm_medico(a.cd_pessoa_fisica),1,40) nr_crm,
	substr(obter_setor_usuario(b.nm_usuario),1,100) cd_setor,
	substr(obter_nome_setor(obter_setor_usuario(b.nm_usuario)),1,100) ds_setor,
	b.ds_email
FROM	pessoa_fisica a,
	usuario b
where	a.cd_pessoa_fisica = b.cd_pessoa_fisica

union

select	a.nm_pessoa_fisica,
		a.cd_cargo,
	    a.CD_PESSOA_FISICA,
        a.nm_social,
        a.DS_CODIGO_PROF,
	'A' ie_situacao,
	'' ds_funcao_evolucao,
	substr(obter_conselho_profissional(a.nr_seq_conselho,'S'),1,60) ds_conselho,
	substr(obter_crm_medico(a.cd_pessoa_fisica),1,40) nr_crm,
	substr(obter_setor_usuario(obter_usuario_pf(cd_pessoa_fisica)),1,255) ds_setor,
	substr(obter_nome_setor(obter_setor_usuario(obter_usuario_pf(cd_pessoa_fisica))),1,255) ds_setor,
	null ds_email
from	pessoa_fisica a
where	a.ie_funcionario = 'S'
and not exists (select 1 from usuario b
	where a.cd_pessoa_fisica = b.cd_pessoa_fisica);

