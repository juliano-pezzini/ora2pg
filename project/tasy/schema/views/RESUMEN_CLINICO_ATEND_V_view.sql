-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW resumen_clinico_atend_v (nr_atendimento, ds_agente, dt_registro, nm_medico, ds_tipo_reacao, ds_situacao, ds_observacao, dt_liberaca_pac_alerg, dt_inicio, dt_fim, cd_doenca_cid, ds_doenca_cid, ds_diagnostico, dt_liberacao, ds_problema, ds_deficiencia, oid_convenio, ds_convenio, oid_convenio_folio, cd_folio, cd_programa, ds_programa, dt_inicio_vigencia, dt_final_vigencia, dt_evolucao, ds_evolucao, ie_hipas, ie_diabt, ie_lipdm, ie_nega_doenca, ds_prognostico, ds_tipo_sangue, nr_sequencia_tab, dt_inicio_tab, dt_fim_tab, ds_quantidade_tab, nr_sequencia_alc, dt_inicio_alc, dt_fim_alc, ds_quantidade_alc, nr_sequencia_dr, dt_inicio_dr, dt_fim_dr, ds_quantidade_dr, dt_hipas, dt_diabt, dt_lipdm, cd_procedimento, ds_procedimento, ds_complemento, dt_entrada, nr_crm, nm_primeiro_nome, nm_sobrenome_pai, nm_sobrenome_mae, ds_sintoma_paciente, ds_receita, dt_liberacao_receita, altura, peso, sistolica, diastolica, freq_cardia, freq_resp, temperatura, ie_tipo_atendimento_cod, ie_tipo_atendimento_nome, dt_entrada_atend, dt_alta, nr_crm_rp, nm_primeiro_nome_rp, nm_sobrenome_pai_rp, nm_sobrenome_mae_rp, ie_classif_alta_cod, ie_classif_alta_nome, ds_oid, ds_estab_saude, ds_dom_saude, cd_postal, cd_estado, cd_municipio, cd_localidade, cd_cgc, ds_razao_social, cd_internacional, nr_alvara_sanitario, nr_telefone, ds_email, cd_clues, cd_cgc_atend, ds_razao_social_atend, cd_pessoa_fisica_tr, nr_crm_tr, nm_primeiro_nome_tr, nm_sobrenome_pai_tr, nm_sobrenome_mae_tr, nr_telefone_tr, ds_email_tr, cd_pessoa_fisica_pac, nm_primeiro_nome_pac, nm_sobrenome_pai_pac, nm_sobrenome_mae_pac, dt_nascimento_pac, qt_idade_pac, ie_sexo_pac, cd_nacionalidade_pac, ie_estado_civil_pac, cd_curp_pac, nr_telefone_pac, ds_email_pac, sg_estado_nasc_pac, cd_pessoa_fisica, cd_pessoa_fisica_medico, cd_pessoa_fisica_medico_2, cd_estabelecimento, cd_pessoa_fisica_medico_3) AS SELECT 	ap.nr_atendimento nr_atendimento,
		coalesce(
		SUBSTR(obter_estrut_princ_ativo(pa.nr_seq_ficha_tecnica,'P'),1,2000),
		SUBSTR(obter_desc_dcb(pa.nr_seq_dcb),1,80),
		SUBSTR(obter_desc_dcb_mat(pa.cd_material,'D'),1,80),
		SUBSTR(obter_desc_material(pa.cd_material),1,100),
		SUBSTR(obter_desc_classe_mat(pa.cd_classe_mat),1,60),
		pa.ds_medic_nao_cad,
		SUBSTR(obter_desc_alergeno(pa.nr_seq_tipo),1,80)) ds_agente,
		pa.dt_registro dt_registro,
		obter_nome_pf(pa.cd_profissional) nm_medico,
		SUBSTR(obter_desc_reacao_alergica(pa.nr_seq_reacao),1,100) ds_tipo_reacao,
		CASE WHEN pa.ie_estado_atual='S' THEN  obter_texto_tasy(1015134, NULL)  ELSE obter_texto_tasy(1015133, NULL) END  ds_situacao,
		pa.ds_observacao ds_observacao,
		pa.dt_liberacao dt_liberaca_pac_alerg,
		dda.dt_inicio dt_inicio,
		dda.dt_fim dt_fim,
		cda.cd_doenca_cid cd_doenca_cid,
		cda.ds_doenca_cid ds_doenca_cid,
		(SELECT DDIA.NR_SEQUENCIA FROM dda
LEFT OUTER JOIN diag_doenca_inf_adic ddia ON (dda.nr_seq_interno = DDIA.nr_seq_diag_doenca)
WHERE DDIA.DS_DIAGNOSTICO IS NOT NULL  ) ds_diagnostico,
		dda.dt_liberacao,
		coalesce(coalesce(coalesce(lpp.ds_problema, cp.ds_problema || ' ' || lpp.ds_complemento), cd.cd_doenca_cid || ' ' || cd.ds_doenca_cid), hs.ds_historico_saude) ds_problema,
		(SELECT c.ds_deficiencia FROM atendimento_paciente a, pf_tipo_deficiencia b, tipo_deficiencia c WHERE a.nr_atendimento = ap.nr_Atendimento AND a.cd_pessoa_fisica = b.cd_pessoa_fisica AND b.nr_seq_tipo_def = c.nr_sequencia) ds_deficiencia,
		'1.1.1.1.1.1.1.1.1' oid_convenio,
		co.ds_convenio ds_convenio,
		'1.1.1.1.1.1.1.1.1' oid_convenio_folio,
		acc.cd_usuario_convenio cd_folio,
		cc.cd_categoria cd_programa,
		cc.ds_categoria ds_programa,
		acc.dt_inicio_vigencia dt_inicio_vigencia,
		acc.dt_final_vigencia dt_final_vigencia,
		epa.dt_evolucao dt_evolucao,
		(SELECT EPA.CD_EVOLUCAO
		FROM 	EVOLUCAO_PACIENTE epa
		WHERE 	EPA.DS_EVOLUCAO IS NOT NULL
		AND 	epa.nr_atendimento = ap.nr_atendimento
		AND 	epa.cd_medico = pfm.cd_pessoa_fisica
		AND 	epa.cd_medico = um.cd_pessoa_fisica
		AND 	epa.cd_medico = med.cd_pessoa_fisica) ds_evolucao,
		coalesce((SELECT MAX('S')
		FROM paciente_antec_clinico b,
			cid_doenca c
		WHERE b.nr_atendimento = ap.nr_atendimento
		AND coalesce(ie_paciente, 'S') = 'N'
		AND b.dt_liberacao IS NOT NULL
		AND b.dt_inativacao IS NULL
		AND b.cd_doenca = c.cd_doenca_cid
		AND c.ie_doenca_cronica_mx = 'HIPAS'), 'NI') ie_hipas,
		coalesce((SELECT MAX('S')
		FROM paciente_antec_clinico b,
			cid_doenca c
		WHERE b.nr_atendimento = ap.nr_atendimento
		AND coalesce(ie_paciente, 'S') = 'N'
		AND b.dt_liberacao IS NOT NULL
		AND b.dt_inativacao IS NULL
		AND b.cd_doenca = c.cd_doenca_cid
		AND c.ie_doenca_cronica_mx = 'DIABT'), 'NI') ie_diabt,
		coalesce((SELECT MAX('S')
		FROM paciente_antec_clinico b,
			cid_doenca c
		WHERE b.nr_atendimento = ap.nr_atendimento
		AND coalesce(ie_paciente, 'S') = 'N'
		AND b.dt_liberacao IS NOT NULL
		AND b.dt_inativacao IS NULL
		AND b.cd_doenca = c.cd_doenca_cid
		AND c.ie_doenca_cronica_mx = 'LIPDM'), 'NI') ie_lipdm,
		coalesce((SELECT MAX(coalesce(b.ie_nega_doencas, 'N'))
		FROM paciente_antec_clinico b
		WHERE b.nr_atendimento = ap.nr_atendimento
		AND coalesce(ie_paciente, 'S') = 'N'
		AND b.dt_liberacao IS NOT NULL
		AND b.dt_inativacao IS NULL
		AND coalesce(b.ie_nega_doencas, 'N') = 'S'), 'N') ie_nega_doenca,
		(SELECT	B.DS_PROGNOSTICO FROM    LISTA_PROBLEMA_PAC a, LISTA_PROBLEMA_PAC_PROG B WHERE 	a.nr_sequencia = b.nr_seq_problema AND a.NR_ATENDIMENTO = ap.nr_atendimento) DS_PROGNOSTICO,
		(SELECT 	a.ie_tipo_sangue || a.ie_fator_rh FROM	pessoa_fisica a, 	atendimento_paciente b WHERE	b.nr_atendimento = ap.nr_atendimento AND	a.cd_pessoa_fisica = b.cd_pessoa_fisica) ds_tipo_sangue,
		phv.nr_sequencia nr_sequencia_tab,
		phv.dt_inicio dt_inicio_tab,
		phv.dt_fim dt_fim_tab,
		phv.qt_utilizacao || ' ' || SUBSTR(obter_um_habito_vicio(phv.cd_unidade_medida), 1, 100) || ' ' || SUBSTR(obter_valor_dominio(1336, phv.ie_frequencia), 1, 60) ds_quantidade_tab,
		phval.nr_sequencia nr_sequencia_alc,
		phval.dt_inicio dt_inicio_alc,
		phval.dt_fim dt_fim_alc,
		phval.qt_utilizacao || ' ' || SUBSTR(obter_um_habito_vicio(phval.cd_unidade_medida), 1, 100) || ' ' || SUBSTR(obter_valor_dominio(1336, phval.ie_frequencia), 1, 60) ds_quantidade_alc,
		phvd.nr_sequencia nr_sequencia_dr,
		phvd.dt_inicio dt_inicio_dr,
		phvd.dt_fim dt_fim_dr,
		SUBSTR(obter_desc_tipo_vicio(phvd.nr_seq_tipo),1,80) || ' - ' || phvd.qt_utilizacao || ' ' || SUBSTR(obter_um_habito_vicio(phvd.cd_unidade_medida), 1, 100) || ' ' || SUBSTR(obter_valor_dominio(1336, phvd.ie_frequencia), 1, 60) ds_quantidade_dr,
		(SELECT MIN(coalesce(dt_inicio, dt_registro))
		FROM 	paciente_antec_clinico b,
				cid_doenca c
		WHERE 	b.nr_atendimento = ap.nr_atendimento
		AND 	coalesce(ie_paciente, 'N') = 'S'
		AND 	b.dt_liberacao IS NOT NULL
		AND 	b.dt_inativacao IS NULL
		AND 	b.cd_doenca = c.cd_doenca_cid
		AND 	c.ie_doenca_cronica_mx = 'HIPAS') DT_HIPAS,
		(SELECT 	MIN(coalesce(dt_inicio, dt_registro))
       FROM 	paciente_antec_clinico b,
				cid_doenca c
		WHERE b.nr_atendimento = ap.nr_atendimento
		AND coalesce(ie_paciente, 'N') = 'S'
		AND b.dt_liberacao IS NOT NULL
		AND b.dt_inativacao IS NULL
		AND b.cd_doenca = c.cd_doenca_cid
		AND c.ie_doenca_cronica_mx = 'DIABT') DT_DIABT,
		(SELECT MIN(coalesce(dt_inicio, dt_registro))
		FROM 	paciente_antec_clinico b,
				cid_doenca c
		WHERE 	b.nr_atendimento = ap.nr_atendimento
		AND coalesce(ie_paciente, 'N') = 'S'
		AND b.dt_liberacao IS NOT NULL
		AND b.dt_inativacao IS NULL
		AND b.cd_doenca = c.cd_doenca_cid
		AND c.ie_doenca_cronica_mx = 'LIPDM') DT_LIPDM,
		CAT.CD_PROCEDIMENTO CD_PROCEDIMENTO,
		CAT.DS_PROCEDIMENTO DS_PROCEDIMENTO,
		PRO.DS_COMPLEMENTO DS_COMPLEMENTO,
		CIRUR.DT_INICIO_PREVISTA DT_ENTRADA,
		MEDC.NR_CRM NR_CRM,
		Z.DS_GIVEN_NAME NM_PRIMEIRO_NOME,
		Z.DS_COMPONENT_NAME_1 NM_SOBRENOME_PAI,
		Z.DS_COMPONENT_NAME_2 NM_SOBRENOME_MAE,
		ap.DS_SINTOMA_PACIENTE DS_SINTOMA_PACIENTE,
		(SELECT MR.NR_SEQUENCIA FROM ap
LEFT OUTER JOIN med_receita mr ON (ap.NR_ATENDIMENTO = MR.NR_ATENDIMENTO_HOSP)
WHERE MR.DS_RECEITA IS NOT NULL  ) DS_RECEITA,
		(SELECT MR.NR_SEQUENCIA FROM ap
LEFT OUTER JOIN med_receita mr ON (ap.NR_ATENDIMENTO = MR.NR_ATENDIMENTO_HOSP)
WHERE MR.DS_RECEITA IS NOT NULL AND DT_LIBERACAO IS NOT NULL  ) DT_LIBERACAO_RECEITA,
		obter_sinal_vital(ap.nr_atendimento, 'ALTURA') altura,
		obter_sinal_vital(ap.nr_atendimento, 'PESO') peso,
		obter_sinal_vital(ap.nr_atendimento, 'PAMAX') sistolica,
		obter_sinal_vital(ap.nr_atendimento, 'PAMIN') diastolica,
		obter_sinal_vital(ap.nr_atendimento, 'FC') freq_cardia,
		obter_sinal_vital(ap.nr_atendimento, 'FR') freq_resp,
		obter_sinal_vital(ap.nr_atendimento, 'Temp') temperatura,
		CASE WHEN AP.IE_TIPO_ATENDIMENTO=3 THEN 'EMER' WHEN AP.IE_TIPO_ATENDIMENTO=7 THEN 'FLD' WHEN AP.IE_TIPO_ATENDIMENTO=8 THEN 'AMB' WHEN AP.IE_TIPO_ATENDIMENTO=1 THEN 'IMP' WHEN AP.IE_TIPO_ATENDIMENTO=10 THEN 'ACUTE' WHEN AP.IE_TIPO_ATENDIMENTO=11 THEN 'HH' WHEN AP.IE_TIPO_ATENDIMENTO=12 THEN 'SS' WHEN AP.IE_TIPO_ATENDIMENTO=14 THEN 'VR' END  IE_TIPO_ATENDIMENTO_COD,
		CASE WHEN AP.IE_TIPO_ATENDIMENTO=3 THEN 'Urgencias' WHEN AP.IE_TIPO_ATENDIMENTO=7 THEN 'Fuera del establecimiento de salud' WHEN AP.IE_TIPO_ATENDIMENTO=8 THEN 'Ambulatorio' WHEN AP.IE_TIPO_ATENDIMENTO=1 THEN 'Hospitalización' WHEN AP.IE_TIPO_ATENDIMENTO=10 THEN 'Cuidados intensivos / Hospitalización aguda' WHEN AP.IE_TIPO_ATENDIMENTO=11 THEN 'Cuidados caseros' WHEN AP.IE_TIPO_ATENDIMENTO=12 THEN 'Corta Estancia' WHEN AP.IE_TIPO_ATENDIMENTO=14 THEN 'Virtual (Telesalud)' END  IE_TIPO_ATENDIMENTO_NOME,
		AP.DT_ENTRADA DT_ENTRADA_atend,
		AP.DT_ALTA DT_ALTA,
		mpr.NR_CRM NR_CRM_RP,
		y.DS_GIVEN_NAME NM_PRIMEIRO_NOME_RP,
		y.DS_COMPONENT_NAME_1 NM_SOBRENOME_PAI_RP,
		y.DS_COMPONENT_NAME_2 NM_SOBRENOME_MAE_RP,
		CASE WHEN MA.IE_CLASSIF_ALTA=1 THEN 5 WHEN MA.IE_CLASSIF_ALTA=3 THEN 4 WHEN MA.IE_CLASSIF_ALTA=2 THEN 3 WHEN MA.IE_CLASSIF_ALTA=5 THEN 2 WHEN MA.IE_CLASSIF_ALTA=6 THEN 1 WHEN MA.IE_CLASSIF_ALTA=7 THEN 6 END  IE_CLASSIF_ALTA_COD,
		CASE WHEN MA.IE_CLASSIF_ALTA=1 THEN 'Defunción' WHEN MA.IE_CLASSIF_ALTA=3 THEN 'Pase a otro hospital' WHEN MA.IE_CLASSIF_ALTA=2 THEN 'Voluntario' WHEN MA.IE_CLASSIF_ALTA=5 THEN 'Mejoría' WHEN MA.IE_CLASSIF_ALTA=6 THEN 'Curación' WHEN MA.IE_CLASSIF_ALTA=7 THEN 'Otro motivo' END  IE_CLASSIF_ALTA_NOME,
		COA.DS_OID DS_OID,
		coalesce(CCA.DS_ESTAB_SAUDE, PJA.DS_RAZAO_SOCIAL) DS_ESTAB_SAUDE,
		coalesce(CCA.DS_DOM_SAUDE, PJA.DS_ENDERECO) DS_DOM_SAUDE,
		CCA.CD_POSTAL CD_POSTAL,
		CCA.CD_ESTADO CD_ESTADO,
		CCA.CD_MUNICIPIO CD_MUNICIPIO,
		CCA.CD_LOCALIDADE CD_LOCALIDADE,
		PJA.CD_CGC CD_CGC,
		PJA.DS_RAZAO_SOCIAL DS_RAZAO_SOCIAL,
		PJA.CD_INTERNACIONAL CD_INTERNACIONAL,
		PJA.NR_ALVARA_SANITARIO NR_ALVARA_SANITARIO,
		PJA.nr_telefone nr_telefone,
		PJA.ds_email ds_email,
		PJA.cd_internacional cd_clues,
		PJA.cd_cgc cd_cgc_atend,
		PJA.ds_razao_social ds_razao_social_atend,
		pfrt.cd_pessoa_fisica CD_PESSOA_FISICA_TR,
		mrt.nr_crm nr_crm_tr,
		x.ds_given_name nm_primeiro_nome_tr,
		x.ds_component_name_1 nm_sobrenome_pai_tr,
		x.ds_component_name_2 nm_sobrenome_mae_tr,
		cpfrt.nr_telefone nr_telefone_tr,
		cpfrt.ds_email ds_email_tr,
		pfpac.cd_pessoa_fisica cd_pessoa_fisica_pac,
		w.ds_given_name nm_primeiro_nome_pac,
		w.ds_component_name_1 nm_sobrenome_pai_pac,
		w.ds_component_name_2 nm_sobrenome_mae_pac,
		pfpac.dt_nascimento dt_nascimento_pac,
		obter_idade(pfpac.dt_nascimento, LOCALTIMESTAMP, 'A') qt_idade_pac,
		CASE WHEN pfpac.ie_sexo='M' THEN  1  WHEN pfpac.ie_sexo='F' THEN  2  ELSE 3 END  ie_sexo_pac,
		pfpac.cd_nacionalidade cd_nacionalidade_pac,
		pfpac.ie_estado_civil ie_estado_civil_pac,
		pfpac.cd_curp cd_curp_pac,
		cpfpac.nr_telefone nr_telefone_pac,
		cpfpac.ds_email ds_email_pac,
		cepac.cd_entidade sg_estado_nasc_pac,
		PA.CD_PESSOA_FISICA CD_PESSOA_FISICA,
		MEDC.CD_PESSOA_FISICA CD_PESSOA_FISICA_MEDICO,
		mpr.CD_PESSOA_FISICA CD_PESSOA_FISICA_MEDICO_2,
		OBTER_NOME_ESTABELECIMENTO(AP.CD_ESTABELECIMENTO) CD_ESTABELECIMENTO,
		mrt.CD_PESSOA_FISICA CD_PESSOA_FISICA_MEDICO_3
FROM table(pkg_name_utils.search_names_legacy('', 'main')) z, table(pkg_name_utils.search_names_legacy('', 'main')) y, table(pkg_name_utils.search_names_legacy('', 'main')) x, usuario um, pessoa_juridica pja, paciente_habito_vicio phvd, paciente_habito_vicio phval, paciente_habito_vicio phv, pessoa_fisica pfrt, pessoa_fisica pfmr, pessoa_fisica pfm, pessoa_fisica pf_m, medico mrt, medico mpr, medico medc, medico med, lista_problema_pac lppm, lista_problema_pac_incid lppi, evolucao_paciente epa, estabelecimento ea, diagnostico_doenca dda, compl_pessoa_fisica cpfrt, cadastro_oid coa, convenio co, cid_doenca cda, cat_clues cca, categoria_convenio cc, atend_categoria_convenio acc, atendimento_paciente ap
LEFT OUTER JOIN paciente_alergia pa ON (ap.cd_pessoa_fisica = pa.cd_pessoa_fisica)
LEFT OUTER JOIN cirurgia cirur ON (ap.nr_atendimento = cirur.nr_atendimento)
LEFT OUTER JOIN atend_paciente_unidade apu ON (AP.NR_ATENDIMENTO = APU.NR_ATENDIMENTO)
LEFT OUTER JOIN motivo_alta ma ON (AP.CD_MOTIVO_ALTA = MA.CD_MOTIVO_ALTA)
LEFT OUTER JOIN pessoa_fisica pfrespon ON (ap.cd_pessoa_responsavel = pfrespon.cd_pessoa_fisica)
LEFT OUTER JOIN procedimento pro ON (CIRUR.CD_PROCEDIMENTO_PRINC = PRO.CD_PROCEDIMENTO)
LEFT OUTER JOIN cat_procedimento cat ON (PRO.CD_PROCIMENTO_MX = CAT.CD_PROCEDIMENTO)
LEFT OUTER JOIN table(pkg_name_utils.search_names_legacy('', 'main')) v ON (pfrespon.nr_seq_person_name = v.nr_sequencia)
LEFT OUTER JOIN compl_pessoa_fisica cpfrespon ON (pfrespon.cd_pessoa_fisica = cpfrespon.cd_pessoa_fisica AND 1 = cpfrespon.ie_tipo_complemento)
, lista_problema_pac lpp
LEFT OUTER JOIN cadastro_problema cp ON (lpp.nr_seq_cad_problema = cp.nr_sequencia)
LEFT OUTER JOIN cid_doenca cd ON (lpp.cd_doenca = cd.cd_doenca_cid)
LEFT OUTER JOIN historico_saude hs ON (lpp.nr_seq_historico = hs.nr_sequencia)
, lista_problema_pac_incid lppipr
LEFT OUTER JOIN lista_problema_pac lppz ON (lppipr.nr_seq_problema = lppz.nr_sequencia)
LEFT OUTER JOIN parecer_medico_req pmrp ON (lppipr.NR_ATENDIMENTO = pmrp.nr_atendimento)
, pessoa_fisica pfpac
LEFT OUTER JOIN table(pkg_name_utils.search_names_legacy('', 'main')) w ON (pfpac.nr_seq_person_name = w.nr_sequencia)
LEFT OUTER JOIN compl_pessoa_fisica cpfpac ON (pfpac.cd_pessoa_fisica = cpfpac.cd_pessoa_fisica AND 1 = cpfpac.ie_tipo_complemento)
LEFT OUTER JOIN sus_municipio smpac ON (pfpac.cd_municipio_ibge = smpac.cd_municipio_ibge)
LEFT OUTER JOIN cat_entidade cepac ON (smpac.nr_seq_entidade_mx = cepac.nr_sequencia)
WHERE pa.dt_inativacao IS NULL AND coalesce(ie_nega_alergias, 'N') = 'N' AND dda.nr_atendimento = ap.nr_atendimento AND dda.cd_doenca = cda.cd_doenca_cid AND dda.dt_liberacao IS NOT NULL AND lpp.nr_atendimento = ap.nr_Atendimento    AND acc.nr_atendimento = ap.nr_Atendimento AND acc.cd_convenio = co.cd_convenio AND acc.cd_convenio = cc.cd_convenio AND acc.cd_categoria = cc.cd_categoria AND epa.nr_atendimento = ap.nr_atendimento AND epa.cd_medico = pfm.cd_pessoa_fisica AND epa.cd_medico = um.cd_pessoa_fisica AND epa.cd_medico = med.cd_pessoa_fisica AND med.ie_situacao = 'A' AND um.ie_tipo_evolucao = '1' AND phv.cd_pessoa_fisica = ap.cd_pessoa_fisica AND phv.ie_classificacao = 'T' --Tabaco
  AND phv.dt_liberacao IS NOT NULL AND phv.dt_inativacao IS NULL AND coalesce(phv.ie_nega_habito, 'N') = 'N' AND phval.ie_classificacao = 'A' --Alcool
  AND phval.cd_pessoa_fisica = ap.cd_pessoa_fisica AND phval.dt_liberacao IS NOT NULL AND phval.dt_inativacao IS NULL AND coalesce(phval.ie_nega_habito, 'N') = 'N' AND phvd.ie_classificacao = 'D' --Drogas
  AND phvd.cd_pessoa_fisica = ap.cd_pessoa_fisica AND phvd.dt_liberacao IS NOT NULL AND phvd.dt_inativacao IS NULL AND coalesce(phvd.ie_nega_habito, 'N') = 'N' AND lppi.nr_atendimento = AP.nr_atendimento AND PF_M.CD_PESSOA_FISICA = AP.CD_medico_resp AND PF_M.CD_PESSOA_FISICA = MEDC.CD_PESSOA_FISICA  AND lppi.nr_seq_problema = lppm.nr_Sequencia    AND lppipr.nr_atendimento = AP.nr_atendimento AND pfmr.CD_PESSOA_FISICA = AP.CD_MEDICO_RESP AND pfmr.CD_PESSOA_FISICA = mpr.CD_PESSOA_FISICA     AND lppz.nr_atendimento = ap.nr_atendimento  AND EA.CD_CGC = PJA.CD_CGC AND PJA.CD_INTERNACIONAL = CCA.CD_CLUES AND EA.CD_ESTABELECIMENTO = COA.CD_ESTABELECIMENTO AND AP.CD_ESTABELECIMENTO = EA.CD_ESTABELECIMENTO AND pja.cd_pf_resp_tecnico = pfrt.cd_pessoa_fisica  AND pfrt.cd_pessoa_fisica = mrt.cd_pessoa_fisica AND cpfrt.cd_pessoa_fisica = pfrt.cd_pessoa_fisica  AND pfpac.cd_pessoa_fisica = ap.cd_pessoa_fisica;

