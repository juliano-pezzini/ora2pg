-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW cih_ficha_ocorrencia_v (nr_atendimento, cd_pessoa_fisica, dt_entrada, dt_alta, dt_alta_interno, nr_dias_int, nr_ficha_ocorrencia, cd_clinica_int, ds_diagnostico_int, ds_diagnostico_alta, cd_medico, cd_tipo_evolucao, ie_retardou_alta, dt_ficha, dt_cancelamento, nr_retardou_sim, nr_retardou_nao, nr_nao_opinou, cd_clinica, cd_doenca_cid, cd_estabelecimento) AS select  b.nr_atendimento,
	b.cd_pessoa_fisica,
	b.dt_entrada,
	b.dt_alta,
	b.dt_alta_interno,
	((trunc(b.dt_alta_interno )- trunc(b.dt_entrada)) + 1) nr_dias_int,
	a.nr_ficha_ocorrencia,
	a.cd_clinica cd_clinica_int,
	a.ds_diagnostico_int,
	a.ds_diagnostico_alta,
	a.cd_medico,
	a.cd_tipo_evolucao,
	a.ie_retardou_alta,
	a.dt_ficha,
	a.dt_cancelamento,
	CASE WHEN a.ie_retardou_alta=1 THEN 1  ELSE 0 END  nr_retardou_sim,
	CASE WHEN a.ie_retardou_alta=2 THEN 1  ELSE 0 END  nr_retardou_nao,
	CASE WHEN a.ie_retardou_alta=1 THEN 0 WHEN a.ie_retardou_alta=2 THEN 0  ELSE 1 END  nr_nao_opinou,
	a.cd_clinica,
	a.cd_doenca_cid,
	b.cd_estabelecimento
FROM	cih_ficha_ocorrencia a,
	atendimento_paciente b
where	1 = 1
and	a.nr_atendimento 		= b.nr_atendimento;

