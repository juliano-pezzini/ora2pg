-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW nis_relatorio_v (dt_registro, nr_atendimento, dt_liberacao, dt_inativacao, ds_registro) AS select dt_registro,
nr_atendimento,
dt_liberacao,
dt_inativacao,
 case when CD_MEDICO_SOLIC is null
        then ''
        else ' <b>Fachkraft:</b> ' || substr(obter_nome_pf(a.CD_MEDICO_SOLIC),1,40)|| '; ' end ||
		case when a.DT_INICIO is null
        then ''
        else ' <b>Startdatum:</b> ' ||  pkg_date_formaters.to_varchar(a.DT_INICIO,'timestamp',1,wheb_usuario_pck.get_cd_estabelecimento,wheb_usuario_pck.get_nm_usuario)  || '; ' end ||
		case when a.DT_TERMINO is null
        then ''
        else ' <b>Enddatum:</b> ' || pkg_date_formaters.to_varchar(a.DT_TERMINO,'timestamp',1,wheb_usuario_pck.get_cd_estabelecimento,wheb_usuario_pck.get_nm_usuario)  || '; ' end ||
		case when a.DT_FIM_ACOMPANHAMENTO is null
        then ''
        else ' <b>Ende der Komplikation: ' || pkg_date_formaters.to_varchar(a.DT_FIM_ACOMPANHAMENTO,'timestamp',1,wheb_usuario_pck.get_cd_estabelecimento,wheb_usuario_pck.get_nm_usuario)  || '; ' end ||
        chr(10)  || chr(13) || '<b>Vorsichtsmaßnahme:</b> ' || chr(13) ||
        case when a.NR_SEQ_PRECAUCAO is null
        then ''
        else ' <b>Vorsichtsmaßnahme:</b> ' || substr(obter_descricao_padrao('CIH_PRECAUCAO','DS_PRECAUCAO',a.NR_SEQ_PRECAUCAO),1,255) || '; ' end ||
        case when a.NR_SEQ_MOTIVO_ISOL is null
        then ''
        else ' <b>Grund:</b> ' || substr(obter_descricao_padrao('MOTIVO_ISOLAMENTO','DS_MOTIVO',a.NR_SEQ_MOTIVO_ISOL),1,255) || '; ' end ||
        case when a.NR_SEQ_ORIGEM is null
        then ''
        else ' <b>Ursprung der Infektion:</b> ' || substr(obter_descricao_padrao('CIH_ORIGEM_INFECCAO','DS_ORIGEM',a.NR_SEQ_ORIGEM),1,255) || '; ' end ||
        case when a.CD_TOPOGRAFIA  is null
        then ''
        else ' <b>Topografie:</b> ' || substr(obter_cih_topografia(a.cd_topografia),1,255) || '; ' end ||
		case when a.CD_TOPOGRAFIA  is null
        then ''
        else ' <b>Bemerkung:</b> ' || a.DS_OBSERVACAO || '; ' end ||
		chr(10)  || chr(13) || '<b>Mikroorganismus:</b> ' || chr(13) ||
        case when b.CD_MICROORGANISMO is null
        then ''
        else ' <b>Mikroorganismus:</b> ' || substr(obter_desc_microorganismo(b.cd_microorganismo),1,255)|| '; ' end ||
        case when b.CD_TOPOGRAFIA  is null
        then ''
        else ' <b>Topografie:</b> ' ||  substr(obter_cih_topografia(b.cd_topografia),1,255) || '; ' end ||
		chr(10)  || chr(13) || '<b>Grund:</b> ' || chr(13) ||
        case when c.NR_SEQ_MOTIVO_ISOL  is null
        then ''
        else ' <b>Grund:</b> ' || substr(obter_descricao_padrao('MOTIVO_ISOLAMENTO','DS_MOTIVO',c.NR_SEQ_MOTIVO_ISOL),1,255) || '; ' end ||
		chr(10)  || chr(13) || '<b>Samples:</b> ' || chr(13) ||
		case when d.CD_TOPOGRAFIA  is null
        then ''
        else ' <b>Topografie:</b> ' || substr(obter_cih_topografia(d.cd_topografia),1,255) || '; ' end ||
		case when d.CD_AMOSTRA_CULTURA is null
        then ''
        else ' <b>Sample:</b> ' || substr(obter_cih_amostra(d.cd_amostra_cultura),1,255)|| '; ' end
		ds_registro
 FROM atendimento_precaucao a
LEFT OUTER JOIN atend_precaucao_micro b ON (a.nr_sequencia = b.nr_seq_atend_precaucao)
LEFT OUTER JOIN atend_precaucao_motivo c ON (a.nr_sequencia = c.nr_seq_atend_precaucao)
LEFT OUTER JOIN atend_precaucao_amostra d ON (a.nr_sequencia = d.nr_seq_atend_precaucao);

