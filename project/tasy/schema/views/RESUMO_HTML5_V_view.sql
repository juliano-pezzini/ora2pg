-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW resumo_html5_v (nr_sequencia, dt_atualizacao, dt_referencia, cd_funcao, nm_funcao, qt_backlog, qt_backlog_dev, qt_backlog_tec, qt_backlog_v_v, qt_backlog_des, qt_backlog_out, ie_prioridade, ie_falta_previsao, ie_falta_previsao_grid, qt_capacidade_diaria, qt_producao_dia, qt_os_baixada_ontem, qt_os_baixada_anteontem, nr_seq_equipe_des, qt_os_analisadas, dt_prev_dev_funcao, dt_prev_analise_funcao, dt_entrega_funcao, nm_analista, qt_producao_ontem, qt_producao_anteontem, ie_os_tec_sem_prev, dt_ultima_prev_tec, qt_tempo_prev_analise, qt_tempo_prev_prog, dt_ultima_atividade) AS select	a.nr_sequencia,
	a.dt_atualizacao,
	a.dt_referencia,
	a.cd_funcao,
	obter_nome_funcao(a.cd_funcao) nm_funcao,
	a.qt_backlog_dev + a.qt_backlog_tec + a.qt_backlog_v_v + a.qt_backlog_des + a.qt_backlog_out qt_backlog,
	a.qt_backlog_dev,
	a.qt_backlog_tec,
	a.qt_backlog_v_v,
	a.qt_backlog_des,
	a.qt_backlog_out,
	a.ie_prioridade,
	a.ie_falta_previsao,
	a.ie_falta_previsao ie_falta_previsao_grid,
	a.qt_capacidade_diaria,
	a.qt_producao_dia,
	a.qt_os_baixada_ontem,
	a.qt_os_baixada_anteontem,
	a.nr_seq_equipe_des,
	a.qt_os_analisadas,
	a.dt_prev_dev_funcao,
	a.dt_prev_analise_funcao,
	null dt_entrega_funcao,
	(select	obter_nome_usuario(max(c.nm_usuario_recurso))
	FROM	resumo_html5_recurso c
	where	c.NR_SEQ_RESUMO_HTML5 = a.nr_sequencia
	and	nr_seq_funcao = 45) nm_analista,
	(select	b.qt_producao_dia || '/' || b.qt_capacidade_diaria
	from	resumo_html5 b
	where	a.cd_funcao = b.cd_funcao
	and	trunc(b.dt_referencia) = trunc(add_working_days(a.dt_referencia, -1))) qt_producao_ontem,
	(select	b.qt_producao_dia  || '/' || b.qt_capacidade_diaria
	from	resumo_html5 b
	where	a.cd_funcao = b.cd_funcao
	and	trunc(b.dt_referencia) = trunc(add_working_days(a.dt_referencia, -2))) qt_producao_anteontem,
	a.ie_os_tec_sem_prev,
	a.dt_ultima_prev_tec,
	a.qt_tempo_prev_analise,
	a.qt_tempo_prev_prog,
	(select max(p.dt_prevista)
	from	man_ordem_ativ_prev p
	where	p.NR_SEQ_ORDEM_SERV in (	select	b.nr_seq_ordem_servico
					from	resumo_html5_os b
					where	b.nr_seq_resumo_html5 = a.nr_sequencia
					and	coalesce(b.qt_prev_os_prog,0) > 0)) dt_ultima_atividade
from	resumo_html5 a;

