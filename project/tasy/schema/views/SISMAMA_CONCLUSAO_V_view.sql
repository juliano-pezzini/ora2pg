-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW sismama_conclusao_v (nr_sequencia, nr_prescricao, nr_cns_profissional, cd_profissional, nr_seq_unidade_saude, cd_pf_resp_emissao_filme, cd_responsavel, nr_cns_responsavel, dt_liberacao, ie_categoria_dir, ie_categoria_esq, ie_recomendacao_dir, ie_recomendacao_esq, ds_observacao, c_anm_nod, c_anm_nod_md, c_anm_nod_me, c_anm_parente_cancer, c_anm_exa_prof, c_anm_mamograf, c_anm_mamo_ano, d_ana_mestruac, c_ana_mest_nlemb, c_ana_menop_idade, c_ana_menop_nlemb, c_ana_nuncamest, c_ana_usahormonio, c_ana_gravida, c_ana_radio, c_ana_radio_mdir, c_ana_ano_direita, c_ana_radio_mesq, c_ana_ano_esquerda, c_ana_ano_tumor_d, c_ana_ano_tumor_e, c_ana_ano_segmen_d, c_ana_ano_segmen_e, c_ana_ano_dutect_d, c_ana_ano_dutect_e, c_ana_ano_mastec_d, c_ana_ano_mastec_e, c_ana_ano_m_pele_d, c_ana_ano_m_pele_e, c_ana_ano_esvazia_d, c_ana_ano_esvazia_e, c_ana_ano_biopsia_d, c_ana_ano_biopsia_e, c_ana_ano_recon_d, c_ana_ano_recon_e, c_ana_ano_plast_red_d, c_ana_ano_plast_red_e, c_ana_ano_plast_imp_d, c_ana_ano_plast_imp_e, c_ana_naofezcirur, d_recebe, c_cli_diag, c_cli_les_palpa, c_cli_papil_dir, c_cli_desc_dir, c_cli_nod_qse_dir, c_cli_nod_qie_dir, c_cli_nod_qsi_dir, c_cli_nod_qii_dir, c_cli_nod_uqext_dir, c_cli_nod_uqsup_dir, c_cli_nod_uqint_dir, c_cli_nod_uqinf_dir, c_cli_nod_rra_dir, c_cli_nod_pa_dir, c_cli_esp_qse_dir, c_cli_esp_qie_dir, c_cli_esp_qsi_dir, c_cli_esp_qii_dir, c_cli_esp_uqext_dir, c_cli_esp_uqsup_dir, c_cli_esp_uqint_dir, c_cli_esp_uqinf_dir, c_cli_esp_rra_dir, c_cli_esp_pa_dir, c_cli_linf_ax_dir, c_cli_linf_supra_dir, c_cli_papil_esq, c_cli_desc_esq, c_cli_nod_qse_esq, c_cli_nod_qie_esq, c_cli_nod_qsi_esq, c_cli_nod_qii_esq, c_cli_nod_uqext_esq, c_cli_nod_uqsup_esq, c_cli_nod_uqint_esq, c_cli_nod_uqinf_esq, c_cli_nod_rra_esq, c_cli_nod_pa_esq, c_cli_esp_qse_esq, c_cli_esp_qie_esq, c_cli_esp_qsi_esq, c_cli_esp_qii_esq, c_cli_esp_uqext_esq, c_cli_esp_uqsup_esq, c_cli_esp_uqint_esq, c_cli_esp_uqinf_esq, c_cli_esp_rra_esq, c_cli_esp_pa_esq, c_cli_linf_ax_esq, c_cli_linf_supra_esq, c_controle_radiol, c_rad_nodulo_dir, c_rad_microcal_dir, c_rad_assim_foc_dir, c_rad_assim_dif_dir, c_rad_area_dens_dir, c_rad_dist_arq_dir, c_rad_nodulo_esq, c_rad_microcal_esq, c_rad_assim_foc_esq, c_rad_assim_dif_esq, c_rad_area_dens_esq, c_rad_dist_arq_esq, c_lesao_diag, c_diag_nodulo_dir, c_diag_microcal_dir, c_diag_assim_foc_dir, c_diag_assim_dif_dir, c_diag_area_dens_dir, c_diag_dist_arq_dir, c_diag_nodulo_esq, c_diag_microcal_esq, c_diag_assim_foc_esq, c_diag_assim_dif_esq, c_diag_area_dens_esq, c_diag_dist_arq_esq, c_avaliacao_adj, c_mamo_rastr, d_exame) AS select 	a.nr_sequencia,
	a.nr_prescricao,
	substr(c.nr_cartao_nac_sus,1,20) nr_cns_profissional,
	a.cd_profissional,
	a.nr_seq_unidade_saude,
	a.cd_pf_resp_emissao_filme,
	b.cd_responsavel,
	substr(e.nr_cartao_nac_sus,1,20) nr_cns_responsavel,
	b.dt_liberacao,
	b.ie_categoria_dir,
	b.ie_categoria_esq,
	b.ie_recomendacao_dir,
	b.ie_recomendacao_esq,
	b.ds_observacao,
	coalesce(CASE WHEN f.ie_nodulo_caroco='N' THEN '3' END ,'0') c_anm_nod,
	coalesce(CASE WHEN f.ie_nodulo_caroco='D' THEN '3' WHEN f.ie_nodulo_caroco='A' THEN '3' END ,'0') c_anm_nod_md,
	coalesce(CASE WHEN f.ie_nodulo_caroco='E' THEN '3' WHEN f.ie_nodulo_caroco='A' THEN '3' END ,'0') c_anm_nod_me,
	CASE WHEN f.ie_risco_elevado='S' THEN '3' WHEN f.ie_risco_elevado='X' THEN '2' WHEN f.ie_risco_elevado='N' THEN '1' END  c_anm_parente_cancer,
	coalesce(CASE WHEN f.ie_mama_exam_prof='S' THEN '3' WHEN f.ie_mama_exam_prof='N' THEN '2' END ,'0') c_anm_exa_prof,
	coalesce(CASE WHEN f.ie_ultima_mamografia='S' THEN '3' WHEN f.ie_ultima_mamografia='X' THEN '2' WHEN f.ie_ultima_mamografia='N' THEN '1' END ,'0') c_anm_mamograf,
	substr(f.dt_ultima_mamografia,1,4) c_anm_mamo_ano,
	to_char(g.dt_ult_mestruacao,'yyyymmdd') d_ana_mestruac,
	coalesce(CASE WHEN g.ie_nao_lembra_ult_menstr='S' THEN '3' END ,'0') c_ana_mest_nlemb,
	coalesce(to_char(substr(g.nr_idade_menopausa,1,2)),'0') c_ana_menop_idade,
	CASE WHEN g.ie_nao_lembra_menopausa='S' THEN '3'  ELSE '0' END  c_ana_menop_nlemb,
	CASE WHEN g.ie_nunca_menstruou='S' THEN '3'  ELSE '0' END  c_ana_nuncamest,
	coalesce(CASE WHEN g.ie_remedio_menopausa='S' THEN '3' WHEN g.ie_remedio_menopausa='X' THEN '2' WHEN g.ie_remedio_menopausa='N' THEN '1' END ,'0') c_ana_usahormonio,
	coalesce(CASE WHEN g.ie_gravida='S' THEN '3' WHEN g.ie_gravida='X' THEN '2' WHEN g.ie_gravida='N' THEN '1' END ,'0') c_ana_gravida,
	CASE WHEN g.ie_radioterapia='S' THEN '3' WHEN g.ie_radioterapia='X' THEN '2' WHEN g.ie_radioterapia='N' THEN '1' END  c_ana_radio,
	CASE WHEN g.dt_radioterapia_dir='' THEN '0'  ELSE '3' END  c_ana_radio_mdir,
	substr(g.dt_radioterapia_dir,1,4) c_ana_ano_direita,
	CASE WHEN g.dt_radioterapia_esq='' THEN '0'  ELSE '3' END  c_ana_radio_mesq,
	substr(g.dt_radioterapia_esq,1,4) c_ana_ano_esquerda,
	substr(g.dt_tumorectomia_dir,1,4) c_ana_ano_tumor_d,
	substr(g.dt_tumorectomia_esq,1,4) c_ana_ano_tumor_e,
	substr(g.dt_segmentectomia_dir,1,4) c_ana_ano_segmen_d,
	substr(g.dt_segmentectomia_esq,1,4) c_ana_ano_segmen_e,
	substr(g.dt_dutectomia_dir,1,4) c_ana_ano_dutect_d,
	substr(g.dt_dutectomia_esq,1,4) c_ana_ano_dutect_e,
	substr(g.dt_mastectomia_dir,1,4) c_ana_ano_mastec_d,
	substr(g.dt_mastectomia_esq,1,4) c_ana_ano_mastec_e,
	substr(g.dt_mastectomia_pele_dir,1,4) c_ana_ano_m_pele_d,
	substr(g.dt_mastectomia_pele_esq,1,4) c_ana_ano_m_pele_e,
	substr(g.dt_esvaziamento_dir,1,4) c_ana_ano_esvazia_d,
	substr(g.dt_esvaziamento_esq,1,4) c_ana_ano_esvazia_e,
	substr(g.dt_biopsia_linf_sent_dir,1,4) c_ana_ano_biopsia_d,
	substr(g.dt_biopsia_linf_sent_esq,1,4) c_ana_ano_biopsia_e,
	substr(g.dt_reconstrucao_dir,1,4) c_ana_ano_recon_d,
	substr(g.dt_reconstrucao_esq,1,4) c_ana_ano_recon_e,
	substr(g.dt_plastic_redutora_dir,1,4) c_ana_ano_plast_red_d,
	substr(g.dt_plastic_redutora_esq,1,4) c_ana_ano_plast_red_e,
	substr(g.dt_plastic_implante_dir,1,4) c_ana_ano_plast_imp_d,
	substr(g.dt_plastic_implante_esq,1,4) c_ana_ano_plast_imp_e,
	CASE WHEN g.ie_nao_fez_cirurgia='S' THEN '3'  ELSE '0' END  c_ana_naofezcirur,
	to_char(g.dt_recebimento,'yyyymmdd') d_recebe,
	coalesce(CASE WHEN h.ie_mamografia_diag='D' THEN '1' WHEN h.ie_mamografia_diag='E' THEN '2' WHEN h.ie_mamografia_diag='A' THEN '3' END ,'0') c_cli_diag,
	CASE WHEN h.ie_achado_exame_clin='S' THEN '3'  ELSE '0' END  c_cli_les_palpa,
	CASE WHEN h.ie_lesao_pap_dir='S' THEN '3'  ELSE '0' END  c_cli_papil_dir,
	coalesce(CASE WHEN h.ie_descarga_pap_dir='C' THEN '1' WHEN h.ie_descarga_pap_dir='H' THEN '2' END ,'0') c_cli_desc_dir,
	CASE WHEN h.ie_nod_qsm_dir='S' THEN '3'  ELSE '0' END  c_cli_nod_qse_dir,
	CASE WHEN h.ie_nod_qim_dir='S' THEN '3'  ELSE '0' END  c_cli_nod_qie_dir,
	CASE WHEN h.ie_nod_qsl_dir='S' THEN '3'  ELSE '0' END  c_cli_nod_qsi_dir,
	CASE WHEN h.ie_nod_qil_dir='S' THEN '3'  ELSE '0' END  c_cli_nod_qii_dir,
	CASE WHEN h.ie_nod_uqlat_dir='S' THEN '3'  ELSE '0' END  c_cli_nod_uqext_dir,
	CASE WHEN h.ie_nod_uqsup_dir='S' THEN '3'  ELSE '0' END  c_cli_nod_uqsup_dir,
	CASE WHEN h.ie_nod_uqmed_dir='S' THEN '3'  ELSE '0' END  c_cli_nod_uqint_dir,
	CASE WHEN h.ie_nod_uqinf_dir='S' THEN '3'  ELSE '0' END  c_cli_nod_uqinf_dir,
	CASE WHEN h.ie_nod_rra_dir='S' THEN '3'  ELSE '0' END  c_cli_nod_rra_dir,
	CASE WHEN h.ie_nod_pa_dir='S' THEN '3'  ELSE '0' END  c_cli_nod_pa_dir,
	CASE WHEN h.ie_esp_qsm_dir='S' THEN '3'  ELSE '0' END  c_cli_esp_qse_dir,
	CASE WHEN h.ie_esp_qim_dir='S' THEN '3'  ELSE '0' END  c_cli_esp_qie_dir,
	CASE WHEN h.ie_esp_qsl_dir='S' THEN '3'  ELSE '0' END  c_cli_esp_qsi_dir,
	CASE WHEN h.ie_esp_qil_dir='S' THEN '3'  ELSE '0' END  c_cli_esp_qii_dir,
	CASE WHEN h.ie_esp_uqlat_dir='S' THEN '3'  ELSE '0' END  c_cli_esp_uqext_dir,
	CASE WHEN h.ie_esp_uqsup_dir='S' THEN '3'  ELSE '0' END  c_cli_esp_uqsup_dir,
	CASE WHEN h.ie_esp_uqmed_dir='S' THEN '3'  ELSE '0' END  c_cli_esp_uqint_dir,
	CASE WHEN h.ie_esp_uqinf_dir='S' THEN '3'  ELSE '0' END  c_cli_esp_uqinf_dir,
	CASE WHEN h.ie_esp_rra_dir='S' THEN '3'  ELSE '0' END  c_cli_esp_rra_dir,
	CASE WHEN h.ie_esp_pa_dir='S' THEN '3'  ELSE '0' END  c_cli_esp_pa_dir,
	CASE WHEN h.ie_linf_axilar_dir='S' THEN '3'  ELSE '0' END  c_cli_linf_ax_dir,
	CASE WHEN h.ie_linf_supraclavic_dir='S' THEN '3'  ELSE '0' END  c_cli_linf_supra_dir,
	CASE WHEN h.ie_lesao_pap_esq='S' THEN '3'  ELSE '0' END  c_cli_papil_esq,
	coalesce(CASE WHEN h.ie_descarga_pap_esq='C' THEN '1' WHEN h.ie_descarga_pap_esq='H' THEN '2' END ,'0') c_cli_desc_esq,
	CASE WHEN h.ie_nod_qsm_esq='S' THEN '3'  ELSE '0' END  c_cli_nod_qse_esq,
	CASE WHEN h.ie_nod_qim_esq='S' THEN '3'  ELSE '0' END  c_cli_nod_qie_esq,
	CASE WHEN h.ie_nod_qsl_esq='S' THEN '3'  ELSE '0' END  c_cli_nod_qsi_esq,
	CASE WHEN h.ie_nod_qil_esq='S' THEN '3'  ELSE '0' END  c_cli_nod_qii_esq,
	CASE WHEN h.ie_nod_uqlat_esq='S' THEN '3'  ELSE '0' END  c_cli_nod_uqext_esq,
	CASE WHEN h.ie_nod_uqsup_esq='S' THEN '3'  ELSE '0' END  c_cli_nod_uqsup_esq,
	CASE WHEN h.ie_nod_uqmed_esq='S' THEN '3'  ELSE '0' END  c_cli_nod_uqint_esq,
	CASE WHEN h.ie_nod_uqinf_esq='S' THEN '3'  ELSE '0' END  c_cli_nod_uqinf_esq,
	CASE WHEN h.ie_nod_rra_esq='S' THEN '3'  ELSE '0' END  c_cli_nod_rra_esq,
	CASE WHEN h.ie_nod_pa_esq='S' THEN '3'  ELSE '0' END  c_cli_nod_pa_esq,
	CASE WHEN h.ie_esp_qsm_esq='S' THEN '3'  ELSE '0' END  c_cli_esp_qse_esq,
	CASE WHEN h.ie_esp_qim_esq='S' THEN '3'  ELSE '0' END  c_cli_esp_qie_esq,
	CASE WHEN h.ie_esp_qsl_esq='S' THEN '3'  ELSE '0' END  c_cli_esp_qsi_esq,
	CASE WHEN h.ie_esp_qil_esq='S' THEN '3'  ELSE '0' END  c_cli_esp_qii_esq,
	CASE WHEN h.ie_esp_uqlat_esq='S' THEN '3'  ELSE '0' END  c_cli_esp_uqext_esq,
	CASE WHEN h.ie_esp_uqsup_esq='S' THEN '3'  ELSE '0' END  c_cli_esp_uqsup_esq,
	CASE WHEN h.ie_esp_uqmed_esq='S' THEN '3'  ELSE '0' END  c_cli_esp_uqint_esq,
	CASE WHEN h.ie_esp_uqinf_esq='S' THEN '3'  ELSE '0' END  c_cli_esp_uqinf_esq,
	CASE WHEN h.ie_esp_rra_esq='S' THEN '3'  ELSE '0' END  c_cli_esp_rra_esq,
	CASE WHEN h.ie_esp_pa_esq='S' THEN '3'  ELSE '0' END  c_cli_esp_pa_esq,
	CASE WHEN h.ie_linf_axilar_esq='S' THEN '3'  ELSE '0' END  c_cli_linf_ax_esq,
	CASE WHEN h.ie_linf_supraclavic_esq='S' THEN '3'  ELSE '0' END  c_cli_linf_supra_esq,
	CASE WHEN h.ie_controle_rad='S' THEN '3'  ELSE '0' END  c_controle_radiol,
	CASE WHEN h.ie_rad_nodulo_dir='S' THEN '3'  ELSE '0' END  c_rad_nodulo_dir,
	CASE WHEN h.ie_rad_microcalcif_dir='S' THEN '3'  ELSE '0' END  c_rad_microcal_dir,
	CASE WHEN h.ie_rad_assim_focal_dir='S' THEN '3'  ELSE '0' END  c_rad_assim_foc_dir,
	CASE WHEN h.ie_rad_assim_difusa_dir='S' THEN '3'  ELSE '0' END  c_rad_assim_dif_dir,
	CASE WHEN h.ie_rad_area_densa_dir='S' THEN '3'  ELSE '0' END  c_rad_area_dens_dir,
	CASE WHEN h.ie_rad_distorcao_focal_dir='S' THEN '3'  ELSE '0' END  c_rad_dist_arq_dir,
	CASE WHEN h.ie_rad_nodulo_esq='S' THEN '3'  ELSE '0' END  c_rad_nodulo_esq,
	CASE WHEN h.ie_rad_microcalcif_esq='S' THEN '3'  ELSE '0' END  c_rad_microcal_esq,
	CASE WHEN h.ie_rad_assim_focal_esq='S' THEN '3'  ELSE '0' END  c_rad_assim_foc_esq,
	CASE WHEN h.ie_rad_assim_difusa_esq='S' THEN '3'  ELSE '0' END  c_rad_assim_dif_esq,
	CASE WHEN h.ie_rad_area_densa_esq='S' THEN '3'  ELSE '0' END  c_rad_area_dens_esq,
	CASE WHEN h.ie_rad_distorcao_focal_esq='S' THEN '3'  ELSE '0' END  c_rad_dist_arq_esq,
	CASE WHEN h.ie_lesao_diag_cancer='S' THEN '3'  ELSE '0' END  c_lesao_diag,
	CASE WHEN h.ie_diag_nodulo_dir='S' THEN '3'  ELSE '0' END  c_diag_nodulo_dir,
	CASE WHEN h.ie_diag_microcalcif_dir='S' THEN '3'  ELSE '0' END  c_diag_microcal_dir,
	CASE WHEN h.ie_diag_assim_focal_dir='S' THEN '3'  ELSE '0' END  c_diag_assim_foc_dir,
	CASE WHEN h.ie_diag_assim_difusa_dir='S' THEN '3'  ELSE '0' END  c_diag_assim_dif_dir,
	CASE WHEN h.ie_diag_area_densa_dir='S' THEN '3'  ELSE '0' END  c_diag_area_dens_dir,
	CASE WHEN h.ie_diag_distorcao_focal_dir='S' THEN '3'  ELSE '0' END  c_diag_dist_arq_dir,
	CASE WHEN h.ie_diag_nodulo_esq='S' THEN '3'  ELSE '0' END  c_diag_nodulo_esq,
	CASE WHEN h.ie_diag_microcalcif_esq='S' THEN '3'  ELSE '0' END  c_diag_microcal_esq,
	CASE WHEN h.ie_diag_assim_focal_esq='S' THEN '3'  ELSE '0' END  c_diag_assim_foc_esq,
	CASE WHEN h.ie_diag_assim_difusa_esq='S' THEN '3'  ELSE '0' END  c_diag_assim_dif_esq,
	CASE WHEN h.ie_diag_area_densa_esq='S' THEN '3'  ELSE '0' END  c_diag_area_dens_esq,
	CASE WHEN h.ie_diag_distorcao_focal_esq='S' THEN '3'  ELSE '0' END  c_diag_dist_arq_esq,
	CASE WHEN h.ie_aval_qt_neo_adjuvante='S' THEN '3'  ELSE '0' END  c_avaliacao_adj,
	CASE WHEN h.ie_mam_rastreamento='S' THEN '3'  ELSE '0' END  c_mamo_rastr,
	to_char(h.dt_exame,'yyyymmdd') d_exame
FROM sismama_mam_ind_clinica h, sismama_anamnese_rad g, sismama_mam_anamnese f, pessoa_fisica e, sismama_mam_conclusao b, sismama_atendimento a
LEFT OUTER JOIN pessoa_fisica c ON (a.cd_profissional = c.cd_pessoa_fisica)
WHERE a.nr_sequencia = b.nr_seq_sismama and a.nr_sequencia = f.nr_seq_sismama and a.nr_sequencia = g.nr_seq_sismama and a.nr_sequencia = h.nr_seq_sismama  and b.cd_responsavel = e.cd_pessoa_fisica;

