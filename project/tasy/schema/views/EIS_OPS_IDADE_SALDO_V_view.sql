-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_ops_idade_saldo_v (nr_titulo, ds_origem_titulo, ds_tipo_pessoa, ds_periodo, dt_mes_competencia, cd_estabelecimento, vl_restricao) AS select	nr_titulo,
	ds_origem_titulo,
	ds_tipo_pessoa,
	ds_periodo,
	dt_mes dt_mes_competencia,
	cd_estabelecimento,
	vl_restricao
FROM	(
	select	nr_titulo,
		substr(obter_valor_dominio('709', ie_origem_titulo),1,255) ds_origem_titulo,
		ds_tipo_pessoa,
		case 	when qt_dias_vencido <= 30 then   substr(obter_desc_expressao(782192),1,255)
			when qt_dias_vencido <= 60 then   substr(obter_desc_expressao(490310),1,255)
			when qt_dias_vencido <= 90 then   substr(obter_desc_expressao(490311),1,255)
			when qt_dias_vencido <= 120 then  substr(obter_desc_expressao(491705),1,255)
			else substr(obter_desc_expressao(492546),1,255) end ds_periodo,
		cd_estabelecimento,
		vl_restricao,
		dt_mes
	from	(
		select	t.dt_vencimento,
			t.nr_titulo,
			ie_origem_titulo,
			substr(CASE WHEN coalesce(cd_pessoa_fisica,'X')='X' THEN  obter_desc_expressao(295845)  ELSE obter_desc_expressao(830225) END ,1,255) ds_tipo_pessoa,
			obter_saldo_titulo_receber(t.nr_titulo,pkg_date_utils.end_of(b.dt_mes, 'MONTH')) vl_restricao,
			pkg_date_utils.get_diffdate(t.dt_vencimento, pkg_date_utils.end_of(b.dt_mes, 'MONTH'), 'DAY') qt_dias_vencido,
			t.cd_estabelecimento,
			pkg_date_utils.end_of(b.dt_mes, 'MONTH') dt_mes
		from	titulo_receber	t,
			mes_v 		b
		where	t.dt_emissao	< pkg_date_utils.end_of(b.dt_mes, 'MONTH')
		and 	t.dt_contabil	<= pkg_date_utils.end_of(b.dt_mes, 'MONTH')
		and	t.ie_situacao 	<> '3'
		and	((t.dt_liquidacao is null)
		or (t.dt_liquidacao > pkg_date_utils.end_of(b.dt_mes, 'MONTH')))
		) alias27
	) alias28;

