-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW reg_tc_evidence_v (nr_seq_pr, nr_seq_tc, nr_seq_tc_item, nr_seq_tc_evidence, nr_seq_evidence_item, ds_evidence_item, ds_function, nr_seq_service_order, ie_result, ie_severidade, ie_status_ordem, nr_seq_defect, ds_version, dt_execution, nr_seq_ciclo, ds_tc_item, ds_resultado, ds_exec_result, ds_os_falha) AS select	x.nr_seq_pr,
	x.nr_seq_tc,
	y.nr_seq_tc_item,
	x.nr_sequencia nr_seq_tc_evidence,
	y.nr_sequencia nr_seq_evidence_item,
	y.ds_item_description ds_evidence_item,
	obter_desc_expressao_idioma(f.cd_exp_funcao, f.ds_funcao, 5) ds_function,
	z.nr_seq_service_order,
	CASE WHEN y.ie_result='P' THEN  'Passed' WHEN y.ie_result='B' THEN  'Blocked' WHEN y.ie_result='F' THEN  'Failed' END  ie_result,
	obter_valor_dominio_idioma(7676,	(	select	q.ie_severidade
							FROM	man_ordem_serv_analise_vv q
							where	q.nr_seq_ordem_serv = z.nr_seq_service_order
						), 5) ie_severidade,
	CASE WHEN(	select	r.ie_status_ordem			from	man_ordem_servico r			where	r.nr_sequencia = z.nr_seq_service_order		)=1 THEN  'Open' WHEN(	select	r.ie_status_ordem			from	man_ordem_servico r			where	r.nr_sequencia = z.nr_seq_service_order		)=2 THEN  'In progress' WHEN(	select	r.ie_status_ordem			from	man_ordem_servico r			where	r.nr_sequencia = z.nr_seq_service_order		)=3 THEN  'Closed' END  ie_status_ordem,
	(	select	max(t.nr_sequencia)
		from	man_doc_erro t
		where	t.nr_seq_ordem = z.nr_seq_service_order
	) nr_seq_defect,
	x.ds_version,
	y.dt_execution,
	y.nr_seq_ciclo,
	y.ds_item_description || CASE WHEN ds_funcao IS NULL THEN  ''  ELSE '(' END  || obter_desc_expressao_idioma(f.cd_exp_funcao, f.ds_funcao, 5) || CASE WHEN ds_funcao IS NULL THEN  ''  ELSE ')' END  ds_tc_item,
	y.ds_result ds_resultado,
	y.ds_exec_result,
	obter_os_reg_evidence_item(y.nr_sequencia) ds_os_falha
FROM reg_tc_pendencies x
LEFT OUTER JOIN funcao f ON (x.cd_funcao = f.cd_funcao)
, reg_tc_evidence_item y
LEFT OUTER JOIN reg_tc_so_pendencies z ON (y.nr_sequencia = z.nr_seq_ev_item)
WHERE y.nr_seq_ect = x.nr_sequencia   and exists (	select	1
			from	reg_product_requirement_v t
			where	t.nr_seq_product_requirement = x.nr_seq_pr
		);

