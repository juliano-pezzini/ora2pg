-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_discussao_item_v (ie_ordem, ie_ordem_titulo, nr_sequencia, nr_seq_conta, nr_seq_item, ds_item_despesa, cd_item, ds_tipo_despesa, nm_prestador_exec, dt_item, ie_origem_proced, ds_guia, nr_guia, nr_seq_apres, nr_seq_protocolo, ds_seq_analise, cd_material, nr_seq_guia, ie_tipo_item, cd_guia, ie_tipo_guia, nr_seq_analise, nr_seq_prestador_solic, nm_prestador_solic, nr_identificador, ds_item_despesa_order, nr_seq_item_ref, ie_tipo_despesa, ie_via_acesso, ds_via_aces, qt_apresentado, vl_total_apres, qt_contestada, vl_contestado, qt_recurso, vl_recurso, qt_aceita, vl_aceito, qt_negada, vl_negado, ie_situacao, nr_seq_disc_mat, nr_seq_disc_proc, nr_seq_discussao, ie_tipo, ds_item, nr_seq_conta_proc, nr_seq_conta_mat, nr_seq_segurado) AS select	nr_ordem ie_ordem,
	0 ie_ordem_titulo,
	null nr_sequencia,
	null nr_seq_conta,
	null nr_seq_item,
	substr(pls_obter_desc_item_desp_int(nr_ordem, 'P'),1,255) ds_item_despesa,
	null cd_item,
	null ds_tipo_despesa,
	null nm_prestador_exec,
	null dt_item,
	null ie_origem_proced,
	null ds_guia,
	coalesce(cd_guia_referencia,cd_guia) nr_guia,
	0 nr_seq_apres,
	null nr_seq_protocolo,
	null ds_seq_analise,
	null cd_material,
	null nr_seq_guia,
	null ie_tipo_item,
	null cd_guia,
	null ie_tipo_guia,
	nr_seq_analise nr_seq_analise,
	null nr_seq_prestador_solic,
	null nm_prestador_solic,
	null nr_identificador,
	null ds_item_despesa_order,
	null nr_seq_item_ref,
	null ie_tipo_despesa,
	null ie_via_acesso,
	null ds_via_aces,
	null qt_apresentado,
	null vl_total_apres,
	null qt_contestada,
	null vl_contestado,
	null qt_recurso,
	null vl_recurso,
	null qt_aceita,
	null vl_aceito,
	null qt_negada,
	null vl_negado,
	null ie_situacao,
	null nr_seq_disc_mat,
	null nr_seq_disc_proc,
	nr_seq_discussao nr_seq_discussao,
	'T' ie_tipo,
	null ds_item,
	null nr_seq_conta_proc,
	null nr_seq_conta_mat,
	null nr_seq_segurado
FROM	w_pls_discussao_item
group by ds_tipo_despesa, coalesce(cd_guia_referencia,cd_guia), nr_seq_analise, ie_tipo_despesa, nr_seq_discussao,nr_ordem

union

select	nr_ordem ie_ordem,
	1 ie_ordem_titulo,
	nr_sequencia,
	nr_seq_conta,
	nr_seq_item,
	substr('         ' ||CASE WHEN coalesce(coalesce(pls_obter_cod_mat_analise(cd_item, ds_tipo_despesa),cd_item),0)=0 THEN 				InitCap(pls_obter_desc_item_desp(ds_tipo_despesa, 'S'))||' não reconhecido.'  ELSE ds_item END ,1,255) ds_item_despesa,
	cd_item,
	ds_tipo_despesa,
	nm_prestador nm_prestador_exec,
	dt_item,
	ie_origem_proced,
	ds_tipo_guia ds_guia,
	coalesce(cd_guia_referencia,cd_guia) nr_guia,
	1 nr_seq_apres,
	nr_seq_protocolo,
	nr_seq_analise ds_seq_analise,
	substr(pls_obter_cod_mat_analise(cd_item, ds_tipo_despesa),1,20) cd_material,
	nr_seq_guia,
	ie_tipo_item,
	cd_guia,
	ie_tipo_guia,
	nr_seq_analise,
	nr_seq_prestador_solic,
	nm_prestador_solic,
	nr_identificador,
	ds_item ds_item_despesa_order,
	nr_seq_item_ref,
	ie_tipo_despesa,
	ie_via_acesso,
	ds_via_acesso ds_via_aces,
	qt_apresentado,
	vl_total_apres,
	qt_contestada,
	vl_contestado,
	qt_recurso,
	vl_recurso,
	qt_aceita,
	vl_aceito,
	qt_negada,
	vl_negado,
	ie_situacao ie_situacao,
	nr_seq_disc_mat nr_seq_disc_mat,
	nr_seq_disc_proc nr_seq_disc_proc,
	nr_seq_discussao nr_seq_discussao,
	'M' ie_tipo,
	ds_item,
	null nr_seq_conta_proc,
	nr_seq_item nr_seq_conta_mat,
	pls_obter_dados_conta(nr_seq_conta,'SEG') nr_seq_segurado
from	w_pls_discussao_item
where	ie_tipo_item <> 'R'

union

select	nr_ordem ie_ordem,
	1 ie_ordem_titulo,
	nr_sequencia,
	nr_seq_conta,
	nr_seq_item,
	substr('         ' ||CASE WHEN coalesce(coalesce(pls_obter_cod_mat_analise(cd_item, ds_tipo_despesa),cd_item),0)=0 THEN 	InitCap(pls_obter_desc_item_desp(ds_tipo_despesa, 'S'))||' não reconhecido.'  ELSE ds_item END ,1,255) ds_item_despesa,
	cd_item,
	ds_tipo_despesa,
	nm_prestador nm_prestador_exec,
	dt_item,
	ie_origem_proced,
	ds_tipo_guia ds_guia,
	coalesce(cd_guia_referencia,cd_guia) nr_guia,
	1 nr_seq_apres,
	nr_seq_protocolo,
	nr_seq_analise ds_seq_analise,
	substr(pls_obter_cod_mat_analise(cd_item, ds_tipo_despesa),1,20) cd_material,
	nr_seq_guia,
	ie_tipo_item,
	cd_guia,
	ie_tipo_guia,
	nr_seq_analise,
	nr_seq_prestador_solic,
	nm_prestador_solic,
	null nr_identificador,
	ds_item ds_item_despesa_order,
	nr_seq_item_ref,
	ie_tipo_despesa,
	ie_via_acesso,
	ds_via_acesso ds_via_aces,
	qt_apresentado,
	vl_total_apres,
	qt_contestada,
	vl_contestado,
	qt_recurso,
	vl_recurso,
	qt_aceita,
	vl_aceito,
	qt_negada,
	vl_negado,
	ie_situacao ie_situacao,
	nr_seq_disc_mat nr_seq_disc_mat,
	nr_seq_disc_proc nr_seq_disc_proc,
	nr_seq_discussao nr_seq_discussao,
	'PR' ie_tipo,
	ds_item,
	nr_seq_item nr_seq_conta_proc,
	null nr_seq_conta_mat,
	pls_obter_dados_conta(nr_seq_conta,'SEG') nr_seq_segurado
from	w_pls_discussao_item
where	ie_tipo_item = 'R'

union

select	nr_ordem ie_ordem,
	1 ie_ordem_titulo,
	nr_sequencia,
	nr_seq_conta,
	nr_seq_item,
	substr('                  ' ||nm_participante,1,255) ds_item_despesa,
	cd_item,
	ds_tipo_despesa,
	nm_prestador nm_prestador_exec,
	dt_item,
	ie_origem_proced,
	ds_tipo_guia ds_guia,
	coalesce(cd_guia_referencia,cd_guia) nr_guia,
	2 nr_seq_apres,
	nr_seq_protocolo,
	nr_seq_analise ds_seq_analise,
	substr(pls_obter_cod_mat_analise(cd_item, ds_tipo_despesa),1,20) cd_material,
	nr_seq_guia,
	ie_tipo_item,
	cd_guia,
	ie_tipo_guia,
	nr_seq_analise,
	nr_seq_prestador_solic,
	nm_prestador_solic,
	nr_identificador,
	ds_item ds_item_despesa_order,
	nr_seq_item_ref,
	ie_tipo_despesa,
	ie_via_acesso,
	ds_via_acesso ds_via_aces,
	qt_apresentado,
	vl_total_apres,
	qt_contestada,
	vl_contestado,
	qt_recurso,
	vl_recurso,
	qt_aceita,
	vl_aceito,
	qt_negada,
	vl_negado,
	ie_situacao ie_situacao,
	nr_seq_disc_mat nr_seq_disc_mat,
	nr_seq_disc_proc nr_seq_disc_proc,
	nr_seq_discussao nr_seq_discussao,
	'PA' ie_tipo,
	ds_item,
	nr_seq_item nr_seq_conta_proc,
	null nr_seq_conta_mat,
	pls_obter_dados_conta(nr_seq_conta,'SEG') nr_seq_segurado
from	w_pls_discussao_item
where	ie_tipo_item = 'R';

