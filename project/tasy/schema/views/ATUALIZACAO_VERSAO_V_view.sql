-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW atualizacao_versao_v (nr_seq_cliente, nr_sequencia, dt_atualizacao, cd_versao_anterior, cd_versao_atual, dt_inicio_f1, dt_fim_f1, dt_inicio_f2, dt_fim_f2, qt_min_f1, qt_min_f2, dt_referencia, nm_pessoa_atualizacao, dt_inicio_f1_dt, dt_fim_f1_dt, dt_inicio_f2_dt, dt_fim_f2_dt, dt_inicio_libexecusu, dt_fim_libexecusu, ie_banco, ds_banco, nm_pessoa) AS select 	nr_seq_cliente,
	nr_sequencia,
	trunc(dt_atualizacao) dt_atualizacao,
	cd_versao_anterior,
	cd_versao_atual,
	to_char((select min(dt_evento) FROM log_atualizacao b where b.nr_seq_atualizacao = a.nr_sequencia and ie_evento = '010'),'hh24:mi:ss') dt_inicio_F1,
	to_char((select min(dt_evento) from log_atualizacao b where b.nr_seq_atualizacao = a.nr_sequencia and ie_evento = '060'),'hh24:mi:ss') dt_fim_F1,
	to_char((select min(dt_evento) from log_atualizacao b where b.nr_seq_atualizacao = a.nr_sequencia and ie_evento = '100'),'hh24:mi:ss') dt_inicio_F2,
	to_char((select min(dt_evento) from log_atualizacao b where b.nr_seq_atualizacao = a.nr_sequencia and ie_evento = obter_ult_evento_atualizacao(b.nr_seq_atualizacao)),'hh24:mi:ss') dt_fim_F2,
	round((((select min(dt_evento) from log_atualizacao b where b.nr_seq_atualizacao = a.nr_sequencia and ie_evento = '060') -
	(select min(dt_evento) from log_atualizacao b where b.nr_seq_atualizacao = a.nr_sequencia and ie_evento = '010')) * 1440),2) qt_min_F1,
	round((((select min(dt_evento) from log_atualizacao b where b.nr_seq_atualizacao = a.nr_sequencia and ie_evento = obter_ult_evento_atualizacao(b.nr_seq_atualizacao)) -
	(select min(dt_evento) from log_atualizacao b where b.nr_seq_atualizacao = a.nr_sequencia and ie_evento = '100')) * 1440),2) qt_min_F2,
	dt_atualizacao dt_referencia,
	substr(obter_nome_usuario(a.nm_usuario),1,60) nm_pessoa_atualizacao,
	(select min(dt_evento) from log_atualizacao b where b.nr_seq_atualizacao = a.nr_sequencia and ie_evento = '010') dt_inicio_F1_dt,
	(select min(dt_evento) from log_atualizacao b where b.nr_seq_atualizacao = a.nr_sequencia and ie_evento = '060') dt_fim_F1_dt,
	(select min(dt_evento) from log_atualizacao b where b.nr_seq_atualizacao = a.nr_sequencia and ie_evento = '100') dt_inicio_F2_dt,
	(select min(dt_evento) from log_atualizacao b where b.nr_seq_atualizacao = a.nr_sequencia and ie_evento = obter_ult_evento_atualizacao(b.nr_seq_atualizacao)) dt_fim_F2_dt,
	(select min(dt_evento) from log_atualizacao b where b.nr_seq_atualizacao = a.nr_sequencia and ie_evento = '230') dt_inicio_LibExecUsu,
	(select max(dt_fim_evento) from log_atualizacao b where b.nr_seq_atualizacao = a.nr_sequencia and ie_evento = '230') dt_fim_LibExecUsu,
	ie_banco,
	ds_banco,
	substr(coalesce(nm_pessoa, coalesce(obter_nome_usuario(nm_usuario),nm_usuario)),1,60) nm_pessoa
from	atualizacao_versao a;

