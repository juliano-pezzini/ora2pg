-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW centro_controle_v (cd_estabelecimento, cd_centro_controle, ds_centro_controle, nm_usuario, dt_atualizacao, ie_situacao, cd_unidade_medida, ie_tipo_centro_controle, cd_centro_controle_pai, ie_centro_resultado, nm_pessoa_resp, cd_classif_result, nr_seq_unid_neg, ie_receb_distrib, ds_centro_apres, nivel) AS WITH RECURSIVE cte AS (
SELECT 	A.CD_ESTABELECIMENTO,A.CD_CENTRO_CONTROLE,A.DS_CENTRO_CONTROLE,A.NM_USUARIO,A.DT_ATUALIZACAO,A.IE_SITUACAO,A.CD_UNIDADE_MEDIDA,A.IE_TIPO_CENTRO_CONTROLE,A.CD_CENTRO_CONTROLE_PAI,A.IE_CENTRO_RESULTADO,A.NM_PESSOA_RESP,A.CD_CLASSIF_RESULT,A.NR_SEQ_UNID_NEG,A.IE_RECEB_DISTRIB,lpad(' ', 2*(1-1)) || ds_centro_controle ds_centro_apres,1 NIVEL
 FROM CENTRO_CONTROLE A WHERE A.CD_CENTRO_CONTROLE_PAI IS NULL
  UNION ALL
SELECT 	A.CD_ESTABELECIMENTO,A.CD_CENTRO_CONTROLE,A.DS_CENTRO_CONTROLE,A.NM_USUARIO,A.DT_ATUALIZACAO,A.IE_SITUACAO,A.CD_UNIDADE_MEDIDA,A.IE_TIPO_CENTRO_CONTROLE,A.CD_CENTRO_CONTROLE_PAI,A.IE_CENTRO_RESULTADO,A.NM_PESSOA_RESP,A.CD_CLASSIF_RESULT,A.NR_SEQ_UNID_NEG,A.IE_RECEB_DISTRIB,lpad(' ', 2*((c.level+1)-1)) || ds_centro_controle ds_centro_apres,(c.level+1) NIVEL
 FROM CENTRO_CONTROLE A JOIN cte c ON (c.CD_CENTRO_CONTROLE = A.CD_CENTRO_CONTROLE_PAI)

) SELECT * FROM cte;


