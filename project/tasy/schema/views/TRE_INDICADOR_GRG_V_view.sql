-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW tre_indicador_grg_v (ds_motivo_glosa, vl_glosa_aceita, vl_recurso, vl_glosa_total, dt_historico, ds_convenio, cd_estabelecimento, ds_acao_glosa, ie_acao_glosa, cd_convenio, cd_motivo_glosa, ds_item, nm_paciente) AS SELECT  substr(obter_desc_motivo_glosa(a.cd_motivo_glosa),1,255) ds_motivo_glosa,
        Sum(a.VL_GLOSA) vl_glosa_aceita,
        Sum(a.VL_AMENOR) vl_recurso,
        (Sum(a.VL_AMENOR) + Sum(a.VL_GLOSA)) VL_GLOSA_TOTAL,
        a.dt_historico,
        obter_desc_convenio(d.cd_convenio) ds_convenio,
        d.cd_estabelecimento,
        obter_valor_dominio('1405',a.IE_ACAO_GLOSA) ds_acao_glosa,
        a.ie_acao_glosa,
        d.cd_convenio,
        a.cd_motivo_glosa,
        substr(obter_dados_lote_audit_item(a.nr_sequencia,'IT'),1,255) ds_item,
        substr(obter_pessoa_conta(c.nr_interno_conta,'D'),1,60) nm_paciente
FROM    LOTE_AUDIT_HIST_ITEM a,
        LOTE_AUDIT_HIST b,
        LOTE_AUDIT_HIST_GUIA c,
        lote_auditoria d
WHERE   a.nr_seq_lote = b.nr_sequencia
AND     a.nr_seq_guia = c.nr_sequencia
AND     b.nr_seq_lote_audit = d.nr_sequencia
GROUP BY  cd_motivo_glosa,
          dt_historico,
          d.cd_convenio,
          d.cd_estabelecimento,
          a.IE_ACAO_GLOSA,
          a.nr_sequencia,
          c.nr_interno_conta;

