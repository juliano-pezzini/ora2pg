-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW exames_susp_mmed_integra_v (nr_atendimento, nr_prescricao, nr_sequencia, nr_seq_interno, nr_acess_number, cd_proced_tasy, cd_proced_integracao, cd_proced_tasy_lado, ds_procedimento, ie_lado, ie_urgencia, dt_prev_execucao, cd_setor_paciente, cd_estabelecimento, nm_pessoa_fisica, dt_prescricao, dt_liberacao, cd_software_integracao, cd_estab_terceiro, cd_setor_execucao, cd_paciente, cd_prescritor) AS select  b.nr_atendimento,
		a.nr_prescricao,
		a.nr_sequencia,
		a.nr_seq_interno,
		a.nr_acesso_dicom nr_acess_number,
		a.nr_seq_proc_interno cd_proced_tasy,
		'' cd_proced_integracao,
		(a.nr_seq_proc_interno||a.ie_lado) cd_proced_tasy_lado,
		d.ds_proc_exame ds_procedimento,
		a.ie_lado,
		coalesce(a.ie_urgencia,'N') ie_urgencia,
		a.dt_prev_execucao,
		b.cd_setor_atendimento cd_setor_paciente,
		b.cd_estabelecimento,
		c.nm_pessoa_fisica,
		b.dt_prescricao,
		coalesce(b.dt_liberacao_medico, b.dt_liberacao) dt_liberacao,
		0 cd_software_integracao,
		obter_estab_integracao(b.cd_estabelecimento, 0) cd_estab_terceiro,
		a.cd_Setor_atendimento	cd_setor_execucao,
		b.cd_pessoa_fisica cd_paciente,
		b.cd_prescritor
FROM pessoa_fisica c, prescr_medica b, prescr_procedimento a
LEFT OUTER JOIN proc_interno d ON (a.nr_seq_proc_interno = d.nr_sequencia)
WHERE a.nr_prescricao		= b.nr_prescricao and b.cd_pessoa_fisica	= c.cd_pessoa_fisica  and coalesce(b.dt_liberacao_medico, b.dt_liberacao) is not null --and		a.cd_motivo_baixa = 0
  and a.dt_integracao is not null and a.dt_integracao_suspenso is null and a.dt_suspensao is not null;

