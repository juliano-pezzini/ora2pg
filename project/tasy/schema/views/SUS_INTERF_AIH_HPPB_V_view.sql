-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW sus_interf_aih_hppb_v (tp_registro, cd_reg, nr_lote, nr_seq_laudo, dt_inicial_geracao, dt_final_geracao, cd_prestador, ds_prestador, cd_cnpj_prestador, nm_paciente, dt_nascimento, ie_sexo, ds_endereco, nr_numero, ds_complemento, ds_bairro, ds_cep, nr_telefone, cd_municipio_ibge, dt_internacao, nm_medico_solic, nr_cpf_medico_solic, cd_procedimento_solic, ie_carater_internacao, nr_cartao_sus, nr_endereco, ie_clinica, dt_encerramento, cd_cid_principal, cd_cid_secundario, ds_sinal_sintoma, ds_justificativa, ds_provas_diag, ds_ponto_ref) AS select /*'CABECALHO' */
  	1 tp_registro, 
  	'01' cd_reg, 
	c.nr_sequencia nr_lote, 
	0 nr_seq_laudo, 
	LOCALTIMESTAMP dt_inicial_geracao, 
	LOCALTIMESTAMP dt_final_geracao, 
	obter_cnes_estab(b.cd_estabelecimento) cd_prestador, 
	upper(substr(obter_razao_social(substr(obter_cgc_estabelecimento(b.cd_estabelecimento),1,14)),1,100)) ds_prestador, 
	substr(obter_cgc_estabelecimento(b.cd_estabelecimento),1,14) cd_cnpj_prestador, 
	null nm_paciente, 
	LOCALTIMESTAMP dt_nascimento, 
	null ie_sexo, 
	null ds_endereco, 
	null nr_numero, 
	null ds_complemento, 
	null ds_bairro, 
	null ds_cep, 
	null nr_telefone, 
	null cd_municipio_ibge, 
	LOCALTIMESTAMP dt_internacao, 
	null nm_medico_solic, 
	null nr_cpf_medico_solic, 
	0 cd_procedimento_solic, 
	null ie_carater_internacao, 
	'0' nr_cartao_sus, 
	null nr_endereco, 
	null ie_clinica, 
	LOCALTIMESTAMP dt_encerramento, 
	null cd_cid_principal, 
	null cd_cid_secundario, 
	null ds_sinal_sintoma, 
	null ds_justificativa, 
	' ' ds_provas_diag, 
	' ' ds_ponto_ref 
FROM  	sus_lote_autor		c, 
  	sus_laudo_paciente	a, 
  	atendimento_paciente	b 
where  a.nr_atendimento	= b.nr_atendimento 
and   c.nr_sequencia 	= a.nr_seq_lote 

union
 
select	/*'DADOS' */
 
	2 tp_registro, 
	'02' cd_reg, 
	e.nr_sequencia nr_lote, 
	c.nr_seq_interno nr_seq_laudo, 
	LOCALTIMESTAMP dt_inicial_geracao, 
	LOCALTIMESTAMP dt_final_geracao, 
	0	cd_prestador, 
	null	ds_prestador, 
	null	cd_cnpj_prestador, 
	upper(a.nm_pessoa_fisica) nm_paciente,	 
	a.dt_nascimento dt_nascimento, 
	upper(a.ie_sexo) ie_sexo, 
	upper(substr(obter_compl_pf(a.cd_pessoa_fisica,1,'EN'),1,50)) ds_endereco, 
	substr(obter_compl_pf(a.cd_pessoa_fisica,1,'NR'),1,5) nr_numero, 
	upper(substr(obter_compl_pf(a.cd_pessoa_fisica,1,'CO'),1,50)) ds_complemento, 
	upper(substr(obter_compl_pf(a.cd_pessoa_fisica,1,'B'),1,50)) ds_bairro, 
	substr(obter_compl_pf(a.cd_pessoa_fisica,1,'CEP'),1,8) ds_cep, 
	substr(obter_compl_pf(a.cd_pessoa_fisica,1,'T'),1,15) nr_telefone, 
	substr(obter_compl_pf(a.cd_pessoa_fisica,1,'CDM'),1,10) cd_municipio_ibge, 
	b.dt_entrada dt_internacao, 
	upper(substr(obter_nome_medico(c.cd_medico_requisitante,'N'),1,60)) nm_medico_solic, 
	substr(obter_cpf_pessoa_fisica(c.cd_medico_requisitante),1,11) nr_cpf_medico_solic, 
	c.cd_procedimento_solic cd_procedimento_solic, 
	b.ie_carater_inter_sus ie_carater_internacao,	 
	a.nr_cartao_nac_sus nr_cartao_sus, 
	substr(obter_compl_pf(a.cd_pessoa_fisica, 1, 'NR'),1,15) nr_endereco, 
	b.ie_clinica, 
	LOCALTIMESTAMP dt_encerramento, 
	c.cd_cid_principal, 
	c.cd_cid_secundario, 
	c.ds_sinal_sintoma, 
	c.ds_justificativa, 
	' ' ds_provas_diag, 
	' ' ds_ponto_ref 
from	pessoa_fisica		a, 
	atendimento_paciente	b, 
	sus_lote_autor		e, 
	sus_laudo_paciente	c 
where	a.cd_pessoa_fisica	= b.cd_pessoa_fisica 
and 	b.nr_atendimento  	= c.nr_atendimento 
and 	e.nr_sequencia 	= c.nr_seq_lote;

