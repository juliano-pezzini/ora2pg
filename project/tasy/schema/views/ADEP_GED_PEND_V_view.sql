-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW adep_ged_pend_v (nr_seq_apresent, ie_tipo_item, nr_seq_horario, ie_gedipa, ie_laboratorio, cd_estabelecimento, nr_atendimento, nr_prescricao, cd_prescritor, dt_prescricao, dt_validade_prescr, dt_liberacao, dt_lib_horario, cd_setor_prescr, ie_setor_processo_gedipa, nr_seq_item, ie_di, cd_item, ie_origem_proced, nr_seq_proc_interno, nr_agrupamento, cd_intervalo, ie_assoc_adep, nr_seq_lote, nr_seq_processo, dt_horario, qt_pend, cd_um, qt_dose, cd_unidade_medida_dose, ie_via, dt_liberacao_medico, ie_urgencia, cd_local_estoque, nr_seq_superior, nr_sequencia_proc, cd_local_estoque_mat, ie_conferencia, ie_higienizacao, ie_preparo, nr_seq_area_prep, ie_item_superior, ie_dose_especial) AS select	1 nr_seq_apresent,
	'D' ie_tipo_item,
	c.nr_sequencia nr_seq_horario,
	'S' ie_gedipa,
	'N' ie_laboratorio,
	a.cd_estabelecimento,
	a.nr_atendimento,
	a.nr_prescricao,
	a.cd_prescritor,
	a.dt_prescricao,
	a.dt_validade_prescr,
	a.dt_liberacao,
	c.dt_lib_horario,
	a.cd_setor_atendimento cd_setor_prescr,
 	'S' ie_setor_processo_gedipa,
	b.nr_sequencia nr_seq_item,
	null ie_di,
	c.cd_refeicao cd_item,
	null ie_origem_proced,
	null nr_seq_proc_interno,
	null nr_agrupamento,
	b.cd_intervalo cd_intervalo,
	'N' ie_assoc_adep,
	null nr_seq_lote,
	c.nr_seq_processo nr_seq_processo,
	c.dt_horario,
	1 qt_pend,
	null cd_um,
	1 qt_dose,
	null cd_unidade_medida_dose,
	b.ie_via_aplicacao ie_via,
	a.dt_liberacao_medico,
	b.ie_urgencia,
	coalesce(s.cd_local_estoque,0) cd_local_estoque,
	null nr_seq_superior,
	null nr_sequencia_proc,
	null cd_local_estoque_mat,
	null ie_conferencia,
	null ie_higienizacao,
	null ie_preparo,
	null nr_seq_area_prep,
	null ie_item_superior,
	null ie_dose_especial
FROM	setor_atendimento s,
	prescr_dieta_hor c,
	prescr_dieta b,
	prescr_medica a
where	c.nr_seq_dieta = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
and	c.dt_fim_horario is null
and	c.dt_suspensao is null
and	coalesce(c.ie_situacao,'A') = 'A'
and	coalesce(a.ie_adep,'S') = 'S'
and	c.dt_lib_horario is not null
and a.dt_inicio_prescr between LOCALTIMESTAMP - interval '2 days' and LOCALTIMESTAMP + interval '2 days'
and	c.dt_horario between LOCALTIMESTAMP - interval '43200 seconds' and LOCALTIMESTAMP + interval '2 days'
and a.dt_liberacao is not null
and	s.cd_setor_atendimento = a.cd_setor_atendimento
and	s.ie_processo_gedipa = 'S'

union all

select	2 nr_seq_apresent,
	'S' ie_tipo_item,
	c.nr_sequencia nr_seq_horario,
	coalesce(c.ie_gedipa,'S') ie_gedipa,
	'N' ie_laboratorio,
	a.cd_estabelecimento,
	a.nr_atendimento,
	a.nr_prescricao,
	a.cd_prescritor,
	a.dt_prescricao,
	a.dt_validade_prescr,
	a.dt_liberacao,
	c.dt_lib_horario,
	a.cd_setor_atendimento cd_setor_prescr,
 	'S' ie_setor_processo_gedipa,
	b.nr_sequencia nr_seq_item,
	coalesce(b.ie_bomba_infusao,'N') ie_di,
	to_char(b.cd_material) cd_item,
	(null)::numeric  ie_origem_proced,
	(null)::numeric  nr_seq_proc_interno,
	(null)::numeric  nr_agrupamento,
	b.cd_intervalo cd_intervalo,
	'N' ie_assoc_adep,
	c.nr_seq_lote nr_seq_lote,
	c.nr_seq_processo nr_seq_processo,
	c.dt_horario,
	c.qt_dispensar_hor qt_pend,
	c.cd_unidade_medida cd_um,
	c.qt_dose,
	c.cd_unidade_medida_dose,
	b.ie_via_aplicacao ie_via,
	a.dt_liberacao_medico,
	b.ie_urgencia,
	coalesce(s.cd_local_estoque,0) cd_local_estoque,
	c.nr_seq_superior,
	null nr_sequencia_proc,
	null cd_local_estoque_mat,
	coalesce(b.ie_conferencia,'S') ie_conferencia,
	coalesce(b.ie_higienizacao,'S') ie_higienizacao,
	coalesce(b.ie_preparo,'S') ie_preparo,
	c.nr_seq_area_prep nr_seq_area_prep,
	b.ie_item_superior,
	c.IE_DOSE_ESPECIAL IE_DOSE_ESPECIAL
from	setor_atendimento s,
		prescr_mat_hor c,
	prescr_material b,
	prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
and	b.nr_seq_recomendacao is null
and	c.dt_fim_horario is null
and	c.dt_suspensao is null
and	coalesce(c.ie_situacao,'A') = 'A'
and	coalesce(c.ie_horario_especial,'N') <> 'S'
and	b.ie_agrupador = 12
and	coalesce(a.ie_adep,'S') = 'S'
and	c.dt_lib_horario is not null
and 	a.dt_inicio_prescr between LOCALTIMESTAMP - interval '2 days' and LOCALTIMESTAMP + interval '2 days'
and		c.dt_horario between LOCALTIMESTAMP - interval '43200 seconds' and LOCALTIMESTAMP + interval '2 days'
and 	a.dt_liberacao is not null
and		s.cd_setor_atendimento = a.cd_setor_atendimento
and		s.ie_processo_gedipa = 'S'

union all

select	3 nr_seq_apresent,
	'M' ie_tipo_item,
	c.nr_sequencia nr_seq_horario,
	coalesce(c.ie_gedipa,'S') ie_gedipa,
	'N' ie_laboratorio,
	a.cd_estabelecimento,
	a.nr_atendimento,
	a.nr_prescricao,
	a.cd_prescritor,
	a.dt_prescricao,
	a.dt_validade_prescr,
	coalesce(a.dt_liberacao,b.dt_lib_material),
	c.dt_lib_horario,
	a.cd_setor_atendimento cd_setor_prescr,
	'S' ie_setor_processo_gedipa,
	b.nr_sequencia nr_seq_item,
	coalesce(b.ie_bomba_infusao,'N') ie_di,
	to_char(b.cd_material) cd_item,
	(null)::numeric  ie_origem_proced,
	(null)::numeric  nr_seq_proc_interno,
	b.nr_agrupamento nr_agrupamento,
	b.cd_intervalo cd_intervalo,
	'N' ie_assoc_adep,
	c.nr_seq_lote nr_seq_lote,
	c.nr_seq_processo nr_seq_processo,
	c.dt_horario,
	c.qt_dispensar_hor qt_pend,
	c.cd_unidade_medida cd_um,
	c.qt_dose,
	c.cd_unidade_medida_dose,
	b.ie_via_aplicacao ie_via,
	coalesce(a.dt_liberacao_medico,b.dt_lib_material),
	b.ie_urgencia,
	coalesce(s.cd_local_estoque,0) cd_local_estoque,
	c.nr_seq_superior,
	null nr_sequencia_proc,
	b.cd_local_estoque cd_local_estoque_mat,
	coalesce(b.ie_conferencia,'S') ie_conferencia,
	coalesce(b.ie_higienizacao,'S') ie_higienizacao,
	coalesce(b.ie_preparo,'S') ie_preparo,
	c.nr_seq_area_prep nr_seq_area_prep,
	b.ie_item_superior,
	c.IE_DOSE_ESPECIAL IE_DOSE_ESPECIAL
from	setor_atendimento s,
		prescr_mat_hor c,
	prescr_material b,
	prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
and	b.nr_seq_recomendacao is null
and	c.dt_fim_horario is null
and	c.dt_suspensao is null
and	coalesce(c.ie_situacao,'A') = 'A'
and	coalesce(c.ie_adep,'S') = 'S'
and	coalesce(c.ie_horario_especial,'N') <> 'S'
and	b.ie_agrupador in (1,11)
and	obter_se_gerar_item_adep('M',b.nr_prescricao,b.nr_sequencia,b.nr_agrupamento,'N') = 'S'
and	coalesce(a.ie_adep,'S') = 'S'
and	c.dt_lib_horario is not null
and 	a.dt_inicio_prescr between LOCALTIMESTAMP - interval '2 days' and LOCALTIMESTAMP + interval '2 days'
and		c.dt_horario between LOCALTIMESTAMP - interval '43200 seconds' and LOCALTIMESTAMP + interval '2 days'
and 	((a.dt_liberacao is not null) or (obter_se_possui_regra_gedipa(b.cd_material, null, null, null) = 'S'))
and		s.cd_setor_atendimento = a.cd_setor_atendimento
and		s.ie_processo_gedipa = 'S'

union all

select	9 nr_seq_apresent,
	'MAP' ie_tipo_item,
	c.nr_sequencia nr_seq_horario,
	coalesce(c.ie_gedipa,'S') ie_gedipa,
	'N' ie_laboratorio,
	a.cd_estabelecimento,
	a.nr_atendimento,
	a.nr_prescricao,
	a.cd_prescritor,
	a.dt_prescricao,
	a.dt_validade_prescr,
	a.dt_liberacao,
	c.dt_lib_horario,
	a.cd_setor_atendimento cd_setor_prescr,
	'S' ie_setor_processo_gedipa,
	b.nr_sequencia nr_seq_item,
	coalesce(b.ie_bomba_infusao,'N') ie_di,
	to_char(b.cd_material) cd_item,
	(null)::numeric  ie_origem_proced,
	(null)::numeric  nr_seq_proc_interno,
	b.nr_agrupamento nr_agrupamento,
	b.cd_intervalo cd_intervalo,
	'N' ie_assoc_adep,
	c.nr_seq_lote nr_seq_lote,
	c.nr_seq_processo nr_seq_processo,
	c.dt_horario,
	c.qt_dispensar_hor qt_pend,
	c.cd_unidade_medida cd_um,
	c.qt_dose,
	c.cd_unidade_medida_dose,
	b.ie_via_aplicacao ie_via,
	a.dt_liberacao_medico,
	b.ie_urgencia,
	coalesce(s.cd_local_estoque,0) cd_local_estoque,
	c.nr_seq_superior,
	b.nr_sequencia_proc,
	b.cd_local_estoque cd_local_estoque_mat,
	coalesce(b.ie_conferencia,'S') ie_conferencia,
	coalesce(b.ie_higienizacao,'S') ie_higienizacao,
	coalesce(b.ie_preparo,'S') ie_preparo,
	c.nr_seq_area_prep nr_seq_area_prep,
	b.ie_item_superior,
	c.IE_DOSE_ESPECIAL IE_DOSE_ESPECIAL
from	setor_atendimento s,
	prescr_mat_hor c,
	prescr_material b,
	prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
and	b.nr_seq_recomendacao is null
and	c.dt_fim_horario is null
and	c.dt_suspensao is null
and	coalesce(c.ie_situacao,'A') = 'A'
and	coalesce(c.ie_adep,'S') = 'S'
and	coalesce(c.ie_horario_especial,'N') <> 'S'
and	b.ie_agrupador = 5
and	coalesce(a.ie_adep,'S') = 'S'
and	c.dt_lib_horario is not null
and 	a.dt_inicio_prescr between LOCALTIMESTAMP - interval '2 days' and LOCALTIMESTAMP + interval '2 days'
and		c.dt_horario between LOCALTIMESTAMP - interval '43200 seconds' and LOCALTIMESTAMP + interval '2 days'
and 	a.dt_liberacao is not null
and		s.cd_setor_atendimento = a.cd_setor_atendimento
and		s.ie_processo_gedipa = 'S'

union all

select	10 nr_seq_apresent,
	'NE' ie_tipo_item,
	c.nr_sequencia nr_seq_horario,
	coalesce(c.ie_gedipa,'S') ie_gedipa,
	'N' ie_laboratorio,
	a.cd_estabelecimento,
	a.nr_atendimento,
	a.nr_prescricao,
	a.cd_prescritor,
	a.dt_prescricao,
	a.dt_validade_prescr,
	a.dt_liberacao,
	c.dt_lib_horario,
	a.cd_setor_atendimento cd_setor_prescr,
	'S' ie_setor_processo_gedipa,
	b.nr_sequencia nr_seq_item,
	coalesce(b.ie_bomba_infusao,'N') ie_di,
	to_char(b.cd_material) cd_item,
	(null)::numeric  ie_origem_proced,
	(null)::numeric  nr_seq_proc_interno,
	(null)::numeric  nr_agrupamento,
	b.cd_intervalo cd_intervalo,
	'N' ie_assoc_adep,
	c.nr_seq_lote nr_seq_lote,
	c.nr_seq_processo nr_seq_processo,
	c.dt_horario,
	c.qt_dispensar_hor qt_pend,
	c.cd_unidade_medida cd_um,
	c.qt_dose,
	c.cd_unidade_medida_dose,
	b.ie_via_aplicacao ie_via,
	a.dt_liberacao_medico,
	b.ie_urgencia,
	coalesce(s.cd_local_estoque,0) cd_local_estoque,
	c.nr_seq_superior,
	null nr_sequencia_proc,
	null cd_local_estoque_mat,
	coalesce(b.ie_conferencia,'S') ie_conferencia,
	coalesce(b.ie_higienizacao,'S') ie_higienizacao,
	coalesce(b.ie_preparo,'S') ie_preparo,
	c.nr_seq_area_prep nr_seq_area_prep,
	b.ie_item_superior,
	c.IE_DOSE_ESPECIAL IE_DOSE_ESPECIAL
from	setor_atendimento s,
		prescr_mat_hor c,
	prescr_material b,
	prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
and	b.nr_seq_recomendacao is null
and	c.dt_fim_horario is null
and	c.dt_suspensao is null
and	coalesce(c.ie_situacao,'A') = 'A'
and	coalesce(c.ie_horario_especial,'N') <> 'S'
and	b.ie_agrupador = 8
and	coalesce(a.ie_adep,'S') = 'S'
--and	nvl(b.ie_status,'N') = 'N'

and	c.dt_lib_horario is not null
and 	a.dt_inicio_prescr between LOCALTIMESTAMP - interval '2 days' and LOCALTIMESTAMP + interval '2 days'
and		c.dt_horario between LOCALTIMESTAMP - interval '43200 seconds' and LOCALTIMESTAMP + interval '2 days'
and 	a.dt_liberacao is not null
and		s.cd_setor_atendimento = a.cd_setor_atendimento
and		s.ie_processo_gedipa = 'S'

union all

select	14 nr_seq_apresent,
	'LD' ie_tipo_item,
	c.nr_sequencia nr_seq_horario,
	coalesce(c.ie_gedipa,'S') ie_gedipa,
	'N' ie_laboratorio,
	a.cd_estabelecimento,
	a.nr_atendimento,
	a.nr_prescricao,
	a.cd_prescritor,
	a.dt_prescricao,
	a.dt_validade_prescr,
	a.dt_liberacao,
	c.dt_lib_horario,
	a.cd_setor_atendimento cd_setor_prescr,
	'S' ie_setor_processo_gedipa,
	b.nr_sequencia nr_seq_item,
	coalesce(b.ie_bomba_infusao,'N') ie_di,
	to_char(b.cd_material) cd_item,
	(null)::numeric  ie_origem_proced,
	(null)::numeric  nr_seq_proc_interno,
	(null)::numeric  nr_agrupamento,
	b.cd_intervalo cd_intervalo,
	'N' ie_assoc_adep,
	c.nr_seq_lote nr_seq_lote,
	c.nr_seq_processo nr_seq_processo,
	c.dt_horario,
	c.qt_dispensar_hor qt_pend,
	c.cd_unidade_medida cd_um,
	c.qt_dose,
	c.cd_unidade_medida_dose,
	b.ie_via_aplicacao ie_via,
	a.dt_liberacao_medico,
	b.ie_urgencia,
	coalesce(s.cd_local_estoque,0) cd_local_estoque,
	c.nr_seq_superior,
	null nr_sequencia_proc,
	null cd_local_estoque_mat,
	coalesce(b.ie_conferencia,'S') ie_conferencia,
	coalesce(b.ie_higienizacao,'S') ie_higienizacao,
	coalesce(b.ie_preparo,'S') ie_preparo,
	c.nr_seq_area_prep nr_seq_area_prep,
	b.ie_item_superior,
	c.IE_DOSE_ESPECIAL IE_DOSE_ESPECIAL
from	setor_atendimento s,
		prescr_mat_hor c,
	prescr_material b,
	prescr_medica a
where	c.nr_seq_material = b.nr_sequencia
and	c.nr_prescricao = b.nr_prescricao
and	b.nr_prescricao = a.nr_prescricao
and	b.nr_seq_recomendacao is null
and	c.dt_fim_horario is null
and	c.dt_suspensao is null
and	coalesce(c.ie_situacao,'A') = 'A'
and	coalesce(c.ie_horario_especial,'N') <> 'S'
and	b.ie_agrupador in (16,17)
and	coalesce(a.ie_adep,'S') = 'S'
and	c.dt_lib_horario is not null
and 	a.dt_inicio_prescr between LOCALTIMESTAMP - interval '2 days' and LOCALTIMESTAMP + interval '2 days'
and		c.dt_horario between LOCALTIMESTAMP - interval '43200 seconds' and LOCALTIMESTAMP + interval '2 days'
and 	a.dt_liberacao is not null
and		s.cd_setor_atendimento = a.cd_setor_atendimento
and		s.ie_processo_gedipa = 'S';

