-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW w_eis_prev_mucosite_v (dt_avaliacao, setor, ds_setor_atendimento, nr_atendimento, cd_estabelecimento, ds_estabelecimento, qt_presenca, tox, ds_toxidade, cla, ds_classificacao) AS select distinct
	trunc(a.dt_avaliacao) dt_avaliacao, 
	obter_setor_atendimento(a.nr_atendimento) setor, 
	obter_nome_setor(obter_setor_atendimento(a.nr_atendimento)) ds_setor_atendimento,		 
	a.nr_atendimento, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento, 
	CASE WHEN a.ie_toxidade=0 THEN 0  ELSE 1 END  qt_presenca, 
	obter_max_toxidade(a.nr_atendimento,a.dt_avaliacao) tox, 
	substr(obter_valor_dominio(3979,obter_max_toxidade(a.nr_atendimento,a.dt_avaliacao)),1,255) ds_toxidade, 
	b.nr_seq_classificacao cla, 
	obter_desc_classif_atend(b.nr_seq_classificacao) ds_classificacao 
FROM	escala_mucosite a, 
	atendimento_paciente b 
where	a.nr_atendimento = b.nr_atendimento 
and	((upper(obter_desc_classif_atend(b.nr_seq_classificacao)) like '%ONCOLOGIA%') or (upper(obter_desc_classif_atend(b.nr_seq_classificacao)) like '%HEMATOLOGIA%') or (upper(obter_desc_classif_atend(b.nr_seq_classificacao)) like '%TMO%') or (upper(obter_desc_classif_atend(b.nr_seq_classificacao)) like '%MEDULA%')) 
and	a.dt_inativacao is null;

