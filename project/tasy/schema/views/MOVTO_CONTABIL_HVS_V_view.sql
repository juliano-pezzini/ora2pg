-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW movto_contabil_hvs_v (nr_lote_contabil, tp_registro, dt_emissao, dt_entrada_saida, cd_estabelecimento, ds_brancos, ds_branco_aspa, cd_conta_contabil, vl_movimento, ie_debito_credito, ds_brancos_b, ds_historico) AS select	l.nr_lote_contabil,
	0 tp_registro,
	trunc(LOCALTIMESTAMP) dt_emissao,
	trunc(LOCALTIMESTAMP) dt_entrada_saida,
	'"' || l.cd_estabelecimento || '"' cd_estabelecimento,
	' ' ds_brancos,
	substr(campo_aspas(' ', 22), 1, 22) ds_branco_aspa,
	'0' cd_conta_contabil,
	0 vl_movimento,
	' ' ie_debito_credito,
	' ' ds_brancos_b,
	' ' ds_historico
FROM	lote_contabil l

union all

select	distinct(l.nr_lote_contabil),
	1 tp_registro,
	trunc(m.dt_movimento) dt_emissao,
	trunc(m.dt_movimento) dt_entrada_saida,
	'"' || l.cd_estabelecimento || '"' cd_estabelecimento,
	' ' ds_brancos,
	substr(campo_aspas(' ', 22), 1, 22) ds_branco_aspa,
	'0' cd_conta_contabil,
	0 vl_movimento,
	' ' ie_debito_credito,
	' ' ds_brancos_b,
	substr(campo_aspas(m.ds_compl_historico, 122), 1, 122) ds_historico
from	lote_contabil l,
	movimento_contabil_v m
where	m.nr_lote_contabil = l.nr_lote_contabil

union all

select	l.nr_lote_contabil,
	2 tp_registro,
	trunc(LOCALTIMESTAMP) dt_emissao,
	trunc(LOCALTIMESTAMP) dt_entrada_saida,
	substr(campo_aspas(l.cd_estabelecimento, 22),1,22) cd_estabelecimento,
	substr(campo_aspas(' ', 22),1,22) ds_brancos,
	substr(campo_aspas(' ', 22), 1, 22) ds_branco_aspa,
	substr(campo_aspas(m.cd_conta_contabil, 22),1,22) cd_conta_contabil,
	m.vl_movimento vl_movimento,
	'"' || m.ie_debito_credito || '"' ie_debito_credito,
	substr(campo_aspas(' ', 10), 1, 10) ds_brancos_b,
	substr(campo_aspas(m.ds_compl_historico, 122), 1, 122) ds_historico
from	lote_contabil l,
	movimento_contabil_v m
where	l.nr_lote_contabil	= m.nr_lote_contabil
order by ds_historico, tp_registro, ie_debito_credito desc
;

