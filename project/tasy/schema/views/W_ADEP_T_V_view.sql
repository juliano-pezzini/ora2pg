-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW w_adep_t_v (ie_saegrupo, ie_ordem, nr_seq_ordem, nr_sequencia, ie_tipo_item, nr_prescricao, nr_seq_item, cd_item, cd_intervalo, qt_item, ie_acm_sn, ie_status_item, ds_prescrito, ds_prescricao, nr_prescricoes, ds_diluicao, ds_inf_dil, nr_dia_util, ie_diferenciado, nr_seq_proc_interno, dt_prev_term, ie_pendente_liberacao, ie_medic_controlado, ie_medicacao_paciente, nr_agrupamento, ie_prescricao_alta, nr_seq_prot_glic, ie_horario, ie_via_aplicacao, nr_seq_apres_inf, nr_etapa_sol, ds_observacao_proc, ie_obs_medico, ie_diluido, cd_motivo_baixa, ie_composto, nr_seq_registro, ie_alto_risco, ds_componentes, ie_ciencia, ie_quimio, nr_seq_grupo_interv, ie_padronizado, ie_util_hemocomponente, ie_vencida, nr_agrup_prot, cd_unidade_medida, hora1, hora2, hora3, hora4, hora5, hora6, hora7, hora8, hora9, hora10, hora11, hora12, hora13, hora14, hora15, hora16, hora17, hora18, hora19, hora20, hora21, hora22, hora23, hora24, hora25, hora26, hora27, hora28, hora29, hora30, hora31, hora32, hora33, hora34, hora35, hora36, hora37, hora38, hora39, hora40, ie_sol_custo, ie_hemodialise, ie_item_ordem, nm_usuario, ie_atrasado, ie_regra_disp, nr_seq_cpoe, ie_classif_adep, ie_risco_queda, ie_prescricao_anestesica) AS select	'R' ie_SaeGrupo,
		10 ie_ordem,
		obter_ordem_informacoes_ADEP(ie_tipo_item, 'R', ie_classif_adep) nr_seq_ordem,
		nr_sequencia,
		ie_tipo_item,      
		nr_prescricao,     
		nr_seq_item,       
		cd_item,           
		cd_intervalo,      
		qt_item,           
		ie_acm_sn,         
		ie_status_item,    
		'          '|| ds_item ds_prescrito,   
		ds_prescricao,     
		nr_prescricoes,    
		ds_diluicao,       
		replace(replace(substr(ds_diluicao,1,1000),'</b>',''),'<b>','') ds_inf_dil, 
		nr_dia_util,       
		ie_diferenciado,   
		nr_seq_proc_interno, 
		dt_prev_term,         
		ie_pendente_liberacao,
		ie_medic_controlado,  
		ie_medicacao_paciente, 
		nr_agrupamento,       
		ie_prescricao_alta,   
		nr_seq_prot_glic,     
		ie_horario,           
		--ie_tipo_item nr_seq_apres_grupo ,   

		ie_via_aplicacao,       
		nr_seq_apres_inf, 
		nr_etapa_sol, 
		substr(ds_observacao,1,255) ds_observacao_proc, 
		ie_obs_medico,
		ie_diluido, 
		cd_motivo_baixa,
		ie_composto, 
		ie_tipo_item || somente_numero(cd_item) || nr_seq_item || somente_numero(ds_prescricao) || somente_numero(nr_prescricoes) nr_seq_registro, 
		ie_alto_risco, 
		ds_componentes, 
		ie_ciencia, 
		ie_quimio,
		nr_seq_grupo_interv,
		ie_padronizado,
		ie_util_hemocomponente,
		ie_vencida,
		nr_agrup_prot,
		cd_unidade_medida,
		hora1,
		hora2,
		hora3,
		hora4,
		hora5,
		hora6,
		hora7,
		hora8,
		hora9,
		hora10,
		hora11,
		hora12,
		hora13,
		hora14,
		hora15,
		hora16,
		hora17,
		hora18,
		hora19,
		hora20,
		hora21,
		hora22,
		hora23,
		hora24,
		hora25,
		hora26,
		hora27,
		hora28,
		hora29,
		hora30,
		hora31,
		hora32,
		hora33,
		hora34,
		hora35,
		hora36,
		hora37,
		hora38,
		hora39,
		hora40,
		ie_sol_custo,
		ie_hemodialise,
		ie_item_ordem,
		nm_usuario,
		null ie_atrasado,
		ie_regra_disp,
		nr_seq_cpoe,
		ie_classif_adep,
		ie_risco_queda,
		ie_prescricao_anestesica
FROM	w_adep_t
where		ie_tipo_item not in ('H', 'XH')

union all

--Titulos

select	'N' ie_SaeGrupo,
		5 ie_ordem,
		obter_ordem_informacoes_ADEP(ie_tipo_item, 'R', ie_classif_adep) nr_seq_ordem,
		null, 
		ie_tipo_item,
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		obter_titulos_gestao_adep(ie_tipo_item, ie_classif_adep) ds_prescrito,
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		--obter_nr_seq_apres_adep(ie_tipo_item, :nr_regra) nr_seq_apres_grupo,

		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		0,
		null,
		null,
		null,
		null,
		null,
		null hora1,
		null hora2,
		null hora3,
		null hora4,
		null hora5,
		null hora6,
		null hora7,
		null hora8,
		null hora9,
		null hora10,
		null hora11,
		null hora12,
		null hora13,
		null hora14,
		null hora15,
		null hora16,
		null hora17,
		null hora18,
		null hora19,
		null hora20,
		null hora21,
		null hora22,
		null hora23,
		null hora24,
		null hora25,
		null hora26,
		null hora27,
		null hora28,
		null hora29,
		null hora30,
		null hora31,
		null hora32,
		null hora33,
		null hora34,
		null hora35,
		null hora36,
		null hora37,
		null hora38,
		null hora39,
		null hora40,
		null ie_sol_custo,
		null ie_hemodialise,
		null ie_item_ordem,
		nm_usuario,
		null ie_atrasado,
		null ie_regra_disp,
		null nr_seq_cpoe,
		null ie_classif_adep,
		null ie_risco_queda,
		null ie_prescricao_anestesica
from	w_adep_t
where	((not exists (select 1 from w_adep_t where ie_tipo_item = 'C')) or (ie_tipo_item <> 'G'))
and		ie_tipo_item not in ('H', 'XH')
group by
		ie_tipo_item,
		ie_classif_adep,
		nm_usuario

union all

--Grupos SaE

select	'S' ie_SaeGrupo,
		5 ie_ordem,
		obter_ordem_informacoes_ADEP(ie_tipo_item, 'R', ie_classif_adep) nr_seq_ordem,
		null, 
		ie_tipo_item, 
		null, 
		null, 
		null,
		null, 
		null, 
		null, 
		null, 
		substr(coalesce(obter_desc_grupo_interv(nr_seq_grupo_interv),'SAE sem grupo'),1,80) ds_prescrito,
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		--obter_nr_seq_apres_adep(ie_tipo_item, :nr_regra) nr_seq_apres_grupo,

		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		null, 
		ie_alto_risco, 
		null, 
		null, 
		null, 
		null, 
		nr_seq_grupo_interv,
		null,
		null,
		null,
		null,
		null,
		null hora1,
		null hora2,
		null hora3,
		null hora4,
		null hora5,
		null hora6,
		null hora7,
		null hora8,
		null hora9,
		null hora10,
		null hora11,
		null hora12,
		null hora13,
		null hora14,
		null hora15,
		null hora16,
		null hora17,
		null hora18,
		null hora19,
		null hora20,
		null hora21,
		null hora22,
		null hora23,
		null hora24,
		null hora25,
		null hora26,
		null hora27,
		null hora28,
		null hora29,
		null hora30,
		null hora31,
		null hora32,
		null hora33,
		null hora34,
		null hora35,
		null hora36,
		null hora37,
		null hora38,
		null hora39,
		null hora40,
		ie_sol_custo,
		ie_hemodialise,
		ie_item_ordem,
		nm_usuario,
		null ie_atrasado,
		null ie_regra_disp,
		nr_seq_cpoe,
		null ie_classif_adep,
		null ie_risco_queda,
		null ie_prescricao_anestesica
from	w_adep_t
where	ie_tipo_item = 'E'
group by
		ie_tipo_item,
		ie_classif_adep,
		nr_seq_grupo_interv,
		ie_sol_custo,
		ie_alto_risco,
		ie_hemodialise,
		ie_item_ordem,
		nm_usuario,
		ie_regra_disp,
		nr_seq_cpoe;

