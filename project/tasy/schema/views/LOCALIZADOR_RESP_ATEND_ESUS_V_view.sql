-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW localizador_resp_atend_esus_v (cd_pessoa_fisica, nm_pessoa_fisica, ds_fonetica, ds_fonetica_cns, nr_crm, nm_guerra, ie_corpo_clinico, ie_corpo_assist, nm_usuario, dt_atualizacao, ds_especialidade, cd_especialidade, ds_vinculo, ie_vinculo_medico, nr_cpf, nr_seq_conselho, ds_sigla_conselho, ds_conselho, nr_cns, nm_social) AS select	distinct a.cd_pessoa_fisica,
	a.nm_pessoa_fisica, 
	a.ds_fonetica, 
	a.ds_fonetica_cns, 
	b.nr_crm, 
	b.nm_guerra, 
	b.ie_corpo_clinico, 
	b.ie_corpo_assist, 
	a.nm_usuario, 
	a.dt_atualizacao, 
	substr(obter_especialidades_medico(a.cd_pessoa_fisica),1,255) ds_especialidade, 
	substr(obter_especialidade_medico_cod(a.cd_pessoa_fisica),1,255) cd_especialidade, 
	substr(obter_valor_dominio(3,b.ie_vinculo_medico),1,120) ds_vinculo, 
	b.ie_vinculo_medico, 
	a.nr_cpf, 
	a.nr_seq_conselho, 
	substr(Obter_Conselho_Profissional(a.nr_seq_conselho,'S'),1,100) ds_sigla_conselho, 
	substr(Obter_Conselho_Profissional(a.nr_seq_conselho,'D'),1,100) ds_conselho, 
	a.nr_cartao_nac_sus nr_cns, 
	a.nm_social 
FROM pessoa_fisica a, medico b
LEFT OUTER JOIN medico_especialidade c ON (b.cd_pessoa_fisica = c.cd_pessoa_fisica)
WHERE a.cd_pessoa_fisica = b.cd_pessoa_fisica  and b.ie_situacao = 'A' 
 
union
 
select	distinct a.cd_pessoa_fisica, 
	a.nm_pessoa_fisica, 
	a.ds_fonetica, 
	a.ds_fonetica_cns, 
	'', 
	'', 
	'N', 
	'N', 
	a.nm_usuario, 
	a.dt_atualizacao, 
	substr(obter_especialidades_medico(a.cd_pessoa_fisica),1,255) ds_especialidade, 
	substr(obter_especialidade_medico_cod(a.cd_pessoa_fisica),1,255) cd_especialidade, 
	'' ds_vinculo, 
	0, 
	a.nr_cpf, 
	a.nr_seq_conselho, 
	substr(Obter_Conselho_Profissional(a.nr_seq_conselho,'S'),1,100) ds_sigla_conselho, 
	substr(Obter_Conselho_Profissional(a.nr_seq_conselho,'D'),1,100) ds_conselho, 
	a.nr_cartao_nac_sus nr_cns, 
	a.nm_social 
from	pessoa_fisica a 
where	nr_seq_conselho is not null 
and	not exists (	select	1 
			from	medico x 
			where	x.cd_pessoa_fisica = a.cd_pessoa_fisica 
			and	coalesce(ie_situacao,'A') = 'A');

