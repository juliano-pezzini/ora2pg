-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_segurado_conta_ocor_v (nr_sequencia, nr_seq_plano, cd_convenio, cd_categoria, qt_idade_anos, qt_idade_meses, ie_local_cadastro, ie_tipo_segurado, ie_pcmso, ie_sexo, ie_preco, nr_seq_contrato, nr_contrato, nr_seq_intercambio, ie_regulamentacao, qt_idade_conta_anos, qt_idade_conta_meses, nr_seq_conta, dt_contrato, dt_primeira_utilizacao, dt_contratacao, ie_titularidade, ie_nascido_plano) AS select	a.nr_sequencia,
	a.nr_seq_plano,
	a.cd_convenio,
	a.cd_categoria,
	a.qt_idade_anos,
	a.qt_idade_meses,
	a.ie_local_cadastro,
	a.ie_tipo_segurado,
	a.ie_pcmso ie_pcmso,
	a.ie_sexo,
	a.ie_preco,
	a.nr_seq_contrato,
	a.nr_contrato,
	a.nr_seq_intercambio,
	a.ie_regulamentacao,
	(obter_idade(a.dt_nascimento, b.dt_atendimento, 'A'))::numeric  qt_idade_conta_anos,
	(obter_idade(a.dt_nascimento, b.dt_atendimento, 'M'))::numeric  qt_idade_conta_meses,
	b.nr_sequencia nr_seq_conta,
	a.dt_contrato,
	a.dt_primeira_utilizacao,
	a.dt_contratacao,
	CASE WHEN a.nr_seq_titular IS NULL THEN  'T'  ELSE 'D' END  ie_titularidade,
	a.ie_nascido_plano
FROM	pls_segurado_conta_v	a,
	pls_conta_ocor_v	b
where	b.nr_seq_segurado = a.nr_sequencia;

