-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ctb_saldo_resumo_v (nm_estabelecimento, dt_referencia, vl_ativo, vl_passivo, vl_receita, vl_despesa, vl_ativo_mais_despesa, vl_passivo_mais_receita, vl_diferenca, vl_ativo_ant, vl_passivo_ant, vl_receita_ant, vl_despesa_ant, vl_ativo_mais_despesa_ant, vl_passivo_mais_receita_ant, vl_diferenca_ant, vl_ativo_deb, vl_passivo_deb, vl_receita_deb, vl_despesa_deb, vl_ativo_mais_despesa_deb, vl_passivo_mais_receita_deb, vl_diferenca_deb, vl_ativo_cred, vl_passivo_cred, vl_receita_cred, vl_despesa_cred, vl_ativo_mais_despesa_cred, vl_passivo_mais_receita_cred, vl_diferenca_cred, nr_seq_mes_ref, cd_estabelecimento, cd_empresa) AS select	substr(obter_nome_estabelecimento(a.cd_estabelecimento),1,80) nm_estabelecimento,
	ctb_obter_mes_ref(a.nr_seq_mes_ref) dt_referencia,
	CASE WHEN c.ie_tipo='A' THEN  vl_saldo  ELSE 0 END  vl_ativo,
	CASE WHEN c.ie_tipo='P' THEN  vl_saldo  ELSE 0 END  vl_passivo,
	CASE WHEN c.ie_tipo='C' THEN  vl_saldo  ELSE 0 END  vl_receita,
	CASE WHEN c.ie_tipo='D' THEN  vl_saldo  ELSE 0 END  vl_despesa,
	(CASE WHEN c.ie_tipo='A' THEN  vl_saldo  ELSE 0 END  + CASE WHEN c.ie_tipo='D' THEN  vl_saldo  ELSE 0 END ) vl_ativo_mais_despesa,
	(CASE WHEN c.ie_tipo='P' THEN  vl_saldo  ELSE 0 END  + CASE WHEN c.ie_tipo='C' THEN  vl_saldo  ELSE 0 END ) vl_passivo_mais_receita,
	(CASE WHEN c.ie_tipo='A' THEN  vl_saldo  ELSE 0 END  + CASE WHEN c.ie_tipo='D' THEN  vl_saldo  ELSE 0 END ) -
	(CASE WHEN c.ie_tipo='P' THEN  vl_saldo  ELSE 0 END  + CASE WHEN c.ie_tipo='C' THEN  vl_saldo  ELSE 0 END ) vl_diferenca,
	CASE WHEN c.ie_tipo='A' THEN  vl_saldo_ant  ELSE 0 END  vl_ativo_ant,
	CASE WHEN c.ie_tipo='P' THEN  vl_saldo_ant  ELSE 0 END  vl_passivo_ant,
	CASE WHEN c.ie_tipo='C' THEN  vl_saldo_ant  ELSE 0 END  vl_receita_ant,
	CASE WHEN c.ie_tipo='D' THEN  vl_saldo_ant  ELSE 0 END  vl_despesa_ant,
	(CASE WHEN c.ie_tipo='A' THEN  vl_saldo_ant  ELSE 0 END  + CASE WHEN c.ie_tipo='D' THEN  vl_saldo_ant  ELSE 0 END ) vl_ativo_mais_despesa_ant,
	(CASE WHEN c.ie_tipo='P' THEN  vl_saldo_ant  ELSE 0 END  + CASE WHEN c.ie_tipo='C' THEN  vl_saldo_ant  ELSE 0 END ) vl_passivo_mais_receita_ant,
	(CASE WHEN c.ie_tipo='A' THEN  vl_saldo_ant  ELSE 0 END  + CASE WHEN c.ie_tipo='D' THEN  vl_saldo_ant  ELSE 0 END ) -
	(CASE WHEN c.ie_tipo='P' THEN  vl_saldo_ant  ELSE 0 END  + CASE WHEN c.ie_tipo='C' THEN  vl_saldo_ant  ELSE 0 END ) vl_diferenca_ant,
	CASE WHEN c.ie_tipo='A' THEN  vl_debito  ELSE 0 END  vl_ativo_deb,
	CASE WHEN c.ie_tipo='P' THEN  vl_debito  ELSE 0 END  vl_passivo_deb,
	CASE WHEN c.ie_tipo='C' THEN  vl_debito  ELSE 0 END  vl_receita_deb,
	CASE WHEN c.ie_tipo='D' THEN  vl_debito  ELSE 0 END  vl_despesa_deb,
	0 vl_ativo_mais_despesa_deb,
	0 vl_passivo_mais_receita_deb,
	0 vl_diferenca_deb,
	CASE WHEN c.ie_tipo='A' THEN  vl_credito  ELSE 0 END  vl_ativo_cred,
	CASE WHEN c.ie_tipo='P' THEN  vl_credito  ELSE 0 END  vl_passivo_cred,
	CASE WHEN c.ie_tipo='C' THEN  vl_credito  ELSE 0 END  vl_receita_cred,
	CASE WHEN c.ie_tipo='D' THEN  vl_credito  ELSE 0 END  vl_despesa_cred,
	0 vl_ativo_mais_despesa_cred,
	0 vl_passivo_mais_receita_cred,
	0 vl_diferenca_cred,
	a.nr_seq_mes_ref,
	a.cd_estabelecimento,
	a.cd_empresa
FROM	ctb_grupo_conta c,
	conta_contabil b,
	ctb_balancete_v a
where (CTB_Obter_Nivel_Classif_Conta(substr(obter_dados_conta_contabil(a.cd_conta_contabil, a.cd_estabelecimento, 'CL'),1,40)) = 1)
and	a.ie_normal_encerramento = 'N'
and	a.cd_conta_contabil = b.cd_conta_contabil
and	b.cd_grupo = c.cd_grupo
order by	ctb_obter_mes_ref(a.nr_seq_mes_ref);

