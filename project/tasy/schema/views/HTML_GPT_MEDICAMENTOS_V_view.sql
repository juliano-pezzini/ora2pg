-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW html_gpt_medicamentos_v (nr_prescricao, nr_prescr_interf_farm, nr_ordenacao, nr_prescricao_original, nr_ordenacao_item, ie_acm, ie_urgencia, nr_agrupamento, qt_hora_aplicacao, qt_min_aplicacao, ie_necessita_disp_kit, ie_medicacao_paciente, ds_dose_diferenciada, qt_dose_especial, dt_lib_material, ie_gerar_horario, hr_dose_especial, ds_horarios_grid, ie_item_superior, ds_observacao_far_grid, ie_origem_inf, nr_receita, ds_observacao_grid, nr_seq_prescr_mat, nr_seq_kit_estoque, ie_se_necessario, nm_usuario_subst, ie_via_aplicacao, cd_unidade_medida_dose, cd_intervalo, qt_vel_infusao, cd_material, ie_suspenso, qt_dose, ie_bomba_infusao, qt_solucao, ie_regra_df, nr_atendimento, dt_prescricao, nr_seq_atendimento, nr_seq_material, nr_seq_protocolo, cd_protocolo, nr_seq_inconsistencia, dt_liberacao_farmacia, nr_dia_util) AS select 	a.nr_prescricao,
         a.nr_prescr_interf_farm,
         coalesce(a.nr_prescr_interf_farm,a.nr_prescricao) nr_ordenacao,
         a.nr_prescricao_original,
         row_number() OVER () AS nr_ordenacao_item,
         b.ie_acm,
         b.ie_urgencia,
         b.nr_agrupamento,
         b.qt_hora_aplicacao,
         b.qt_min_aplicacao,
         b.ie_necessita_disp_kit,
         b.ie_medicacao_paciente,
         b.ds_dose_diferenciada,
         b.qt_dose_especial,
         b.dt_lib_material,
         b.ie_gerar_horario,
         b.hr_dose_especial,
         substr(b.ds_horarios,1,255) ds_horarios_grid,
         b.ie_item_superior,
         substr(b.ds_observacao_far,1,255) ds_observacao_far_grid,
         b.ie_origem_inf,
         b.nr_receita,
         substr(b.ds_observacao,1,255) ds_observacao_grid,
         b.nr_sequencia nr_seq_prescr_mat,
         b.nr_seq_kit_estoque,
         b.ie_se_necessario,
         CASE WHEN coalesce(b.nr_seq_substituto,0)=0 THEN  ''  ELSE b.nm_usuario END  nm_usuario_subst,
         b.ie_via_aplicacao,
         b.cd_unidade_medida_dose,
         b.cd_intervalo,
         b.qt_vel_infusao,
         b.cd_material,
         b.ie_suspenso,
         b.qt_dose,
         b.ie_bomba_infusao,
         b.qt_solucao,
         coalesce(b.ie_regra_disp,'S') ie_regra_df,
	a.nr_atendimento,
	a.dt_prescricao,
	b.nr_seq_atendimento,
	b.nr_seq_material,
	b.NR_SEQ_PROTOCOLO,
	b.cd_protocolo,
	b.nr_seq_inconsistencia,
	a.dt_liberacao_farmacia,
	b.nr_dia_util
FROM   	prescr_material b,
         prescr_medica a
where  	a.nr_prescricao = b.nr_prescricao
and	b.ie_agrupador	= 1
and	exists ( select    1
                  from	   prescr_material y,
                            prescr_medica x
                  where	   x.nr_prescricao         = y.nr_prescricao
                  and	   y.nr_seq_interf_farm	   = b.nr_sequencia
                  and	   x.nr_prescr_interf_farm = a.nr_prescricao
                  and	   y.ie_agrupador = 1 )

union all

select 	a.nr_prescricao,
         a.nr_prescr_interf_farm,
         coalesce(a.nr_prescr_interf_farm,a.nr_prescricao) nr_ordenacao,
         a.nr_prescricao_original,
         row_number() OVER () AS nr_ordenacao_item,
         b.ie_acm,
         b.ie_urgencia,
         b.nr_agrupamento,
         b.qt_hora_aplicacao,
         b.qt_min_aplicacao,
         b.ie_necessita_disp_kit,
         b.ie_medicacao_paciente,
         b.ds_dose_diferenciada,
         b.qt_dose_especial,
         b.dt_lib_material,
         b.ie_gerar_horario,
         b.hr_dose_especial,
         substr(b.ds_horarios,1,255) ds_horarios_grid,
         b.ie_item_superior,
         substr(b.ds_observacao_far,1,255) ds_observacao_far_grid,
         b.ie_origem_inf,
         b.nr_receita,
         substr(b.ds_observacao,1,255) ds_observacao_grid,
         b.nr_sequencia nr_seq_prescr_mat,
         b.nr_seq_kit_estoque,
         b.ie_se_necessario,
         CASE WHEN coalesce(b.nr_seq_substituto,0)=0 THEN  ''  ELSE b.nm_usuario END  nm_usuario_subst,
         b.ie_via_aplicacao,
         b.cd_unidade_medida_dose,
         b.cd_intervalo,
         b.qt_vel_infusao,
         b.cd_material,
         b.ie_suspenso,
         b.qt_dose,
         b.ie_bomba_infusao,
         b.qt_solucao,
         coalesce(b.ie_regra_disp,'S') ie_regra_df,
	a.nr_atendimento,
	a.dt_prescricao,
	b.nr_seq_atendimento,
	b.nr_seq_material,
	b.NR_SEQ_PROTOCOLO,
	b.cd_protocolo,
	b.nr_seq_inconsistencia,
	a.dt_liberacao_farmacia,
	b.nr_dia_util
from   	prescr_material b,
         prescr_medica a
where  	a.nr_prescricao	= b.nr_prescricao
and	b.ie_agrupador 	= 1
and	b.nr_seq_interf_farm is not null;

