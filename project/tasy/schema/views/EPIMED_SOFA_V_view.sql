-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW epimed_sofa_v (cd_multi_empresa, isenable, isdelete, update_timestamp, checklist_id, module_id, checklist_date, hospital_attendance_number, question_id, answer_id, answer_value, updatetimestampfilter) AS SELECT OBTER_ESTAB_ATENDIMENTO(A.NR_ATENDIMENTO) CD_MULTI_EMPRESA
	,CASE WHEN A.IE_SITUACAO='I' THEN  0  ELSE 1 END  ISENABLE
	,CASE WHEN A.IE_SITUACAO='I' THEN  1  ELSE 0 END  ISDELETE
	,CASE WHEN A.IE_SITUACAO='A' THEN  TO_CHAR(A.DT_ATUALIZACAO_NREC, 'YYYY-MM-DD"T"HH24:MI:SS."000"')  ELSE TO_CHAR(A.DT_INATIVACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') END  UPDATE_TIMESTAMP
	,A.NR_SEQUENCIA CHECKLIST_ID
	,'135' MODULE_ID
	,TO_CHAR(A.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') CHECKLIST_DATE
	,A.NR_ATENDIMENTO HOSPITAL_ATTENDANCE_NUMBER
	,'48' QUESTION_ID
	,(CASE
			WHEN A.QT_REL_PAO2_FIO2 >= 400
				THEN 117
			WHEN A.QT_REL_PAO2_FIO2 BETWEEN 300
					AND 399
				THEN 118
			WHEN A.QT_REL_PAO2_FIO2 BETWEEN 200
					AND 299
				THEN 119
			WHEN A.QT_REL_PAO2_FIO2 BETWEEN 100
					AND 199
				THEN 120
			ELSE 121
			END
		) ANSWER_ID
	,NULL ANSWER_VALUE
	,TO_DATE(A.DT_ATUALIZACAO) UPDATETIMESTAMPFILTER
FROM ESCALA_SOFA A
WHERE A.NR_SEQUENCIA = (
		SELECT MAX(NR_SEQUENCIA)
		FROM ESCALA_SOFA B
		WHERE A.NR_ATENDIMENTO = B.NR_ATENDIMENTO
		AND B.DT_LIBERACAO IS NOT NULL)
AND OBTER_SETOR_ATUAL_PACIENTE(A.NR_ATENDIMENTO) IN (
		SELECT CD_SETOR_ATENDIMENTO
		FROM SETOR_ATENDIMENTO
		WHERE IE_EPIMED = 'S'
		AND IE_SITUACAO = 'A')

UNION ALL

SELECT OBTER_ESTAB_ATENDIMENTO(A.NR_ATENDIMENTO) CD_MULTI_EMPRESA
	,CASE WHEN A.IE_SITUACAO='I' THEN  0  ELSE 1 END  ISENABLE
	,CASE WHEN A.IE_SITUACAO='I' THEN  1  ELSE 0 END  ISDELETE
	,CASE WHEN A.IE_SITUACAO='A' THEN  TO_CHAR(A.DT_ATUALIZACAO_NREC, 'YYYY-MM-DD"T"HH24:MI:SS."000"')  ELSE TO_CHAR(A.DT_INATIVACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') END  UPDATE_TIMESTAMP
	,A.NR_SEQUENCIA CHECKLIST_ID
	,'135' MODULE_ID
	,TO_CHAR(A.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') CHECKLIST_DATE
	,A.NR_ATENDIMENTO HOSPITAL_ATTENDANCE_NUMBER
	,'49' QUESTION_ID
	,(CASE 
			WHEN A.IE_DOPAMINA = 0
				THEN 122
			WHEN A.QT_PAM < 70
				AND A.IE_DOPAMINA = 0
				THEN 123
			WHEN A.IE_DOPAMINA = 1
				OR A.IE_DOBUTAMINA = 'S'
				THEN 124
			WHEN A.IE_DOPAMINA = 2
				OR A.IE_NORADRENALINA = 1
				THEN 125
			WHEN A.IE_DOPAMINA = 3
				OR A.IE_NORADRENALINA = 2
				THEN 126
			END
		) ANSWER_ID
	,NULL ANSWER_VALUE
	,TO_DATE(A.DT_ATUALIZACAO) UPDATETIMESTAMPFILTER
FROM ESCALA_SOFA A
WHERE A.NR_SEQUENCIA = (
		SELECT MAX(NR_SEQUENCIA)
		FROM ESCALA_SOFA B
		WHERE A.NR_ATENDIMENTO = B.NR_ATENDIMENTO
		AND B.DT_LIBERACAO IS NOT NULL)
AND OBTER_SETOR_ATUAL_PACIENTE(A.NR_ATENDIMENTO) IN (
		SELECT CD_SETOR_ATENDIMENTO
		FROM SETOR_ATENDIMENTO
		WHERE IE_EPIMED = 'S'
		AND IE_SITUACAO = 'A')

UNION ALL

SELECT OBTER_ESTAB_ATENDIMENTO(A.NR_ATENDIMENTO) CD_MULTI_EMPRESA
	,CASE WHEN A.IE_SITUACAO='I' THEN  0  ELSE 1 END  ISENABLE
	,CASE WHEN A.IE_SITUACAO='I' THEN  1  ELSE 0 END  ISDELETE
	,CASE WHEN A.IE_SITUACAO='A' THEN  TO_CHAR(A.DT_ATUALIZACAO_NREC, 'YYYY-MM-DD"T"HH24:MI:SS."000"')  ELSE TO_CHAR(A.DT_INATIVACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') END  UPDATE_TIMESTAMP
	,A.NR_SEQUENCIA CHECKLIST_ID
	,'135' MODULE_ID
	,TO_CHAR(A.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') CHECKLIST_DATE
	,A.NR_ATENDIMENTO HOSPITAL_ATTENDANCE_NUMBER
	,'50' QUESTION_ID
	,(CASE 
			WHEN A.QT_PLAQUETAS >= 150
				THEN 127
			WHEN A.QT_PLAQUETAS BETWEEN 100
					AND 149
				THEN 128
			WHEN A.QT_PLAQUETAS BETWEEN 50
					AND 99
				THEN 129
			WHEN A.QT_PLAQUETAS BETWEEN 20
					AND 49
				THEN 130
			ELSE 131
			END
		) ANSWER_ID
	,NULL ANSWER_VALUE
	,TO_DATE(A.DT_ATUALIZACAO) UPDATETIMESTAMPFILTER
FROM ESCALA_SOFA A
WHERE A.NR_SEQUENCIA = (
		SELECT MAX(NR_SEQUENCIA)
		FROM ESCALA_SOFA B
		WHERE A.NR_ATENDIMENTO = B.NR_ATENDIMENTO
		AND B.DT_LIBERACAO IS NOT NULL)
AND OBTER_SETOR_ATUAL_PACIENTE(A.NR_ATENDIMENTO) IN (
		SELECT CD_SETOR_ATENDIMENTO
		FROM SETOR_ATENDIMENTO
		WHERE IE_EPIMED = 'S'
		AND IE_SITUACAO = 'A')

UNION ALL

SELECT OBTER_ESTAB_ATENDIMENTO(A.NR_ATENDIMENTO) CD_MULTI_EMPRESA
	,CASE WHEN A.IE_SITUACAO='I' THEN  0  ELSE 1 END  ISENABLE
	,CASE WHEN A.IE_SITUACAO='I' THEN  1  ELSE 0 END  ISDELETE
	,CASE WHEN A.IE_SITUACAO='A' THEN  TO_CHAR(A.DT_ATUALIZACAO_NREC, 'YYYY-MM-DD"T"HH24:MI:SS."000"')  ELSE TO_CHAR(A.DT_INATIVACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') END  UPDATE_TIMESTAMP
	,A.NR_SEQUENCIA CHECKLIST_ID
	,'135' MODULE_ID
	,TO_CHAR(A.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') CHECKLIST_DATE
	,A.NR_ATENDIMENTO HOSPITAL_ATTENDANCE_NUMBER
	,'51' QUESTION_ID
	,(CASE 
			WHEN A.QT_CREATININA_SERICA < 1.2
				THEN 132
			WHEN A.QT_CREATININA_SERICA BETWEEN 1.2
					AND 1.9
				THEN 133
			WHEN A.QT_CREATININA_SERICA BETWEEN 2.0
					AND 3.4
				THEN 134
			WHEN A.QT_CREATININA_SERICA BETWEEN 3.5
					AND 4.9
				THEN 135
			ELSE 136
			END
		) ANSWER_ID
	,NULL ANSWER_VALUE
	,TO_DATE(A.DT_ATUALIZACAO) UPDATETIMESTAMPFILTER
FROM ESCALA_SOFA A
WHERE A.NR_SEQUENCIA = (
		SELECT MAX(NR_SEQUENCIA)
		FROM ESCALA_SOFA B
		WHERE A.NR_ATENDIMENTO = B.NR_ATENDIMENTO
		AND B.DT_LIBERACAO IS NOT NULL)
AND OBTER_SETOR_ATUAL_PACIENTE(A.NR_ATENDIMENTO) IN (
		SELECT CD_SETOR_ATENDIMENTO
		FROM SETOR_ATENDIMENTO
		WHERE IE_EPIMED = 'S'
		AND IE_SITUACAO = 'A')

UNION ALL

SELECT OBTER_ESTAB_ATENDIMENTO(A.NR_ATENDIMENTO) CD_MULTI_EMPRESA
	,CASE WHEN A.IE_SITUACAO='I' THEN  0  ELSE 1 END  ISENABLE
	,CASE WHEN A.IE_SITUACAO='I' THEN  1  ELSE 0 END  ISDELETE
	,CASE WHEN A.IE_SITUACAO='A' THEN  TO_CHAR(A.DT_ATUALIZACAO_NREC, 'YYYY-MM-DD"T"HH24:MI:SS."000"')  ELSE TO_CHAR(A.DT_INATIVACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') END  UPDATE_TIMESTAMP
	,A.NR_SEQUENCIA CHECKLIST_ID
	,'135' MODULE_ID
	,TO_CHAR(A.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') CHECKLIST_DATE
	,A.NR_ATENDIMENTO HOSPITAL_ATTENDANCE_NUMBER
	,'52' QUESTION_ID
	,(CASE 
			WHEN A.QT_BILIRRUBINA_SERICA < 1.2
				THEN 137
			WHEN A.QT_BILIRRUBINA_SERICA BETWEEN 1.2
					AND 1.9
				THEN 138
			WHEN A.QT_BILIRRUBINA_SERICA BETWEEN 2.0
					AND 5.9
				THEN 139
			WHEN A.QT_BILIRRUBINA_SERICA BETWEEN 6.0
					AND 11.9
				THEN 140
			ELSE 141
			END
		) ANSWER_ID
	,NULL ANSWER_VALUE
	,TO_DATE(A.DT_ATUALIZACAO) UPDATETIMESTAMPFILTER
FROM ESCALA_SOFA A
WHERE A.NR_SEQUENCIA = (
		SELECT MAX(NR_SEQUENCIA)
		FROM ESCALA_SOFA B
		WHERE A.NR_ATENDIMENTO = B.NR_ATENDIMENTO
		AND B.DT_LIBERACAO IS NOT NULL)
AND OBTER_SETOR_ATUAL_PACIENTE(A.NR_ATENDIMENTO) IN (
		SELECT CD_SETOR_ATENDIMENTO
		FROM SETOR_ATENDIMENTO
		WHERE IE_EPIMED = 'S'
		AND IE_SITUACAO = 'A')

UNION ALL

SELECT OBTER_ESTAB_ATENDIMENTO(A.NR_ATENDIMENTO) CD_MULTI_EMPRESA
	,CASE WHEN A.IE_SITUACAO='I' THEN  0  ELSE 1 END  ISENABLE
	,CASE WHEN A.IE_SITUACAO='I' THEN  1  ELSE 0 END  ISDELETE
	,CASE WHEN A.IE_SITUACAO='A' THEN  TO_CHAR(A.DT_ATUALIZACAO_NREC, 'YYYY-MM-DD"T"HH24:MI:SS."000"')  ELSE TO_CHAR(A.DT_INATIVACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') END  UPDATE_TIMESTAMP
	,A.NR_SEQUENCIA CHECKLIST_ID
	,'135' MODULE_ID
	,TO_CHAR(A.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') CHECKLIST_DATE
	,A.NR_ATENDIMENTO HOSPITAL_ATTENDANCE_NUMBER
	,'53' QUESTION_ID
	,(CASE 
			WHEN A.QT_GLASGOW = 15
				THEN 142
			WHEN A.QT_GLASGOW BETWEEN 13
					AND 14
				THEN 143
			WHEN A.QT_GLASGOW BETWEEN 10
					AND 12
				THEN 144
			WHEN A.QT_GLASGOW BETWEEN 6
					AND 9
				THEN 145
			ELSE 146
			END
		) ANSWER_ID
	,NULL ANSWER_VALUE
	,TO_DATE(A.DT_ATUALIZACAO) UPDATETIMESTAMPFILTER
FROM ESCALA_SOFA A
WHERE A.NR_SEQUENCIA = (
		SELECT MAX(NR_SEQUENCIA)
		FROM ESCALA_SOFA B
		WHERE A.NR_ATENDIMENTO = B.NR_ATENDIMENTO
		AND B.DT_LIBERACAO IS NOT NULL)
AND OBTER_SETOR_ATUAL_PACIENTE(A.NR_ATENDIMENTO) IN (
		SELECT CD_SETOR_ATENDIMENTO
		FROM SETOR_ATENDIMENTO
		WHERE IE_EPIMED = 'S'
		AND IE_SITUACAO = 'A')

UNION ALL

SELECT OBTER_ESTAB_ATENDIMENTO(A.NR_ATENDIMENTO) CD_MULTI_EMPRESA
	,CASE WHEN A.IE_SITUACAO='I' THEN  0  ELSE 1 END  ISENABLE
	,CASE WHEN A.IE_SITUACAO='I' THEN  1  ELSE 0 END  ISDELETE
	,CASE WHEN A.IE_SITUACAO='A' THEN  TO_CHAR(A.DT_ATUALIZACAO_NREC, 'YYYY-MM-DD"T"HH24:MI:SS."000"')  ELSE TO_CHAR(A.DT_INATIVACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') END  UPDATE_TIMESTAMP
	,A.NR_SEQUENCIA CHECKLIST_ID
	,'135' MODULE_ID
	,TO_CHAR(A.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') CHECKLIST_DATE
	,A.NR_ATENDIMENTO HOSPITAL_ATTENDANCE_NUMBER
	,'55' QUESTION_ID
	,(CASE 
			WHEN A.QT_PA_SISTOLICA <= 100
				THEN 148
			ELSE 149
			END
		) ANSWER_ID
	,NULL ANSWER_VALUE
	,TO_DATE(A.DT_ATUALIZACAO) UPDATETIMESTAMPFILTER
FROM ESCALA_SOFA A
WHERE A.NR_SEQUENCIA = (
		SELECT MAX(NR_SEQUENCIA)
		FROM ESCALA_SOFA B
		WHERE A.NR_ATENDIMENTO = B.NR_ATENDIMENTO
		AND B.DT_LIBERACAO IS NOT NULL)
AND OBTER_SETOR_ATUAL_PACIENTE(A.NR_ATENDIMENTO) IN (
		SELECT CD_SETOR_ATENDIMENTO
		FROM SETOR_ATENDIMENTO
		WHERE IE_EPIMED = 'S'
		AND IE_SITUACAO = 'A')

UNION ALL

SELECT OBTER_ESTAB_ATENDIMENTO(A.NR_ATENDIMENTO) CD_MULTI_EMPRESA
	,CASE WHEN A.IE_SITUACAO='I' THEN  0  ELSE 1 END  ISENABLE
	,CASE WHEN A.IE_SITUACAO='I' THEN  1  ELSE 0 END  ISDELETE
	,CASE WHEN A.IE_SITUACAO='A' THEN  TO_CHAR(A.DT_ATUALIZACAO_NREC, 'YYYY-MM-DD"T"HH24:MI:SS."000"')  ELSE TO_CHAR(A.DT_INATIVACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') END  UPDATE_TIMESTAMP
	,A.NR_SEQUENCIA CHECKLIST_ID
	,'135' MODULE_ID
	,TO_CHAR(A.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') CHECKLIST_DATE
	,A.NR_ATENDIMENTO HOSPITAL_ATTENDANCE_NUMBER
	,'56' QUESTION_ID
	,(CASE 
			WHEN OBTER_SINAL_VITAL(A.NR_ATENDIMENTO, 'FR') >= 22
				THEN 150
			ELSE 151
			END
		) ANSWER_ID
	,NULL ANSWER_VALUE
	,TO_DATE(A.DT_ATUALIZACAO) UPDATETIMESTAMPFILTER
FROM ESCALA_SOFA A
WHERE A.NR_SEQUENCIA = (SELECT MAX(NR_SEQUENCIA)
		FROM ESCALA_SOFA B
		WHERE A.NR_ATENDIMENTO = B.NR_ATENDIMENTO
		AND B.DT_LIBERACAO IS NOT NULL)
AND OBTER_SETOR_ATUAL_PACIENTE(A.NR_ATENDIMENTO) IN (
		SELECT CD_SETOR_ATENDIMENTO
		FROM SETOR_ATENDIMENTO
		WHERE IE_EPIMED = 'S'
		AND IE_SITUACAO = 'A')

UNION ALL

SELECT OBTER_ESTAB_ATENDIMENTO(A.NR_ATENDIMENTO) CD_MULTI_EMPRESA
	,CASE WHEN A.IE_SITUACAO='I' THEN  0  ELSE 1 END  ISENABLE
	,CASE WHEN A.IE_SITUACAO='I' THEN  1  ELSE 0 END  ISDELETE
	,CASE WHEN A.IE_SITUACAO='A' THEN  TO_CHAR(A.DT_ATUALIZACAO_NREC, 'YYYY-MM-DD"T"HH24:MI:SS."000"')  ELSE TO_CHAR(A.DT_INATIVACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') END  UPDATE_TIMESTAMP
	,A.NR_SEQUENCIA CHECKLIST_ID
	,'135' MODULE_ID
	,TO_CHAR(A.DT_AVALIACAO, 'YYYY-MM-DD"T"HH24:MI:SS."000"') CHECKLIST_DATE
	,A.NR_ATENDIMENTO HOSPITAL_ATTENDANCE_NUMBER
	,'57' QUESTION_ID
	,CASE 
		WHEN(QT_GLASGOW >= 15)
			THEN 153
		ELSE 152
		END ANSWER_ID
	,NULL ANSWER_VALUE
	,TO_DATE(A.DT_ATUALIZACAO) UPDATETIMESTAMPFILTER
FROM ESCALA_SOFA A
WHERE A.NR_SEQUENCIA = (SELECT MAX(NR_SEQUENCIA)
		FROM ESCALA_SOFA B
		WHERE A.NR_ATENDIMENTO = B.NR_ATENDIMENTO
		AND B.DT_LIBERACAO IS NOT NULL)
AND OBTER_SETOR_ATUAL_PACIENTE(A.NR_ATENDIMENTO) IN (
	SELECT CD_SETOR_ATENDIMENTO
	FROM SETOR_ATENDIMENTO
	WHERE IE_EPIMED = 'S'
	AND IE_SITUACAO = 'A');

