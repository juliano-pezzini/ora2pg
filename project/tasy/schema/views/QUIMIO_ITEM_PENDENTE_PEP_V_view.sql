-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW quimio_item_pendente_pep_v (nr_sequencia, ds_item, nr_seq_apres, nm_usuario, nr_atendimento, dt_liberacao, dt_assinatura, cd_pessoa_fisica, nr_item, nr_projeto, ds_tipo_fk, ie_processo_assinado, nr_seq_atendimento) AS select	f.nr_sequencia,
	'Anotações' ds_item,
	1 nr_seq_apres,
	c.nm_usuario,
	c.nr_atendimento,
	f.dt_liberacao,
	obter_data_assinatura_digital(f.nr_seq_assinatura) dt_assinatura,
	d.cd_pessoa_fisica,
	1 nr_item,
	51590 nr_projeto,
	'nr_sequencia' ds_tipo_fk,
	'QLAN' ie_processo_assinado,
	e.nr_seq_atendimento
FROM paciente_atend_anot f, pessoa_fisica d, pep_item_pendente c
LEFT OUTER JOIN paciente_atendimento e ON (c.nr_atendimento = e.nr_atendimento)
WHERE d.cd_pessoa_fisica	= c.cd_pessoa_fisica  and e.nr_seq_atendimento	= f.nr_seq_atendimento and c.nr_seq_anotacao	= f.nr_sequencia and c.nr_seq_anotacao	is not null and c.nr_seq_pac_medic	is null and c.nr_seq_intercorrencia	is null and f.dt_liberacao		is not null and obter_data_assinatura_digital(f.nr_seq_assinatura) is null and coalesce(c.ie_pendente_assinat_usuario,'N')	= 'N'

union

select	e.nr_seq_atendimento nr_sequencia,
	'Medicação' ds_item,
	3 nr_seq_apres,
	c.nm_usuario,
	c.nr_atendimento,
	f.dt_liberacao,
	obter_data_assinatura_digital(f.nr_seq_assinatura) dt_assinatura,
	d.cd_pessoa_fisica,
	2 nr_item,
	51648 nr_projeto,
	'nr_sequencia' ds_tipo_fk,
	'QLM' ie_processo_assinado,
	e.nr_seq_atendimento
FROM paciente_atend_medic f, pessoa_fisica d, pep_item_pendente c
LEFT OUTER JOIN paciente_atendimento e ON (c.nr_atendimento = e.nr_atendimento)
WHERE d.cd_pessoa_fisica	= c.cd_pessoa_fisica  and e.nr_seq_atendimento	= f.nr_seq_atendimento and c.nr_seq_pac_medic	= f.nr_seq_interno and c.nr_seq_anotacao	is null and c.nr_seq_intercorrencia is null and c.nr_seq_pac_medic	is not null and f.dt_liberacao		is not null and obter_data_assinatura_digital(f.nr_seq_assinatura) is null and coalesce(c.ie_pendente_assinat_usuario,'N')	= 'N'
 
union

select	f.nr_sequencia,
	'Intercorrência' ds_item,
	2 nr_seq_apres,
	c.nm_usuario,
	c.nr_atendimento,
	f.dt_liberacao,
	obter_data_assinatura_digital(f.nr_seq_assinatura) dt_assinatura,
	d.cd_pessoa_fisica,
	3 nr_item,
	51630 nr_projeto,
	'nr_sequencia' ds_tipo_fk,
	'QLI' ie_processo_assinado,
	e.nr_seq_atendimento
FROM paciente_atend_interc f, pessoa_fisica d, pep_item_pendente c
LEFT OUTER JOIN paciente_atendimento e ON (c.nr_atendimento = e.nr_atendimento)
WHERE d.cd_pessoa_fisica	= c.cd_pessoa_fisica  and e.nr_seq_atendimento	= f.nr_seq_atendimento and c.nr_seq_intercorrencia	= f.nr_sequencia and c.nr_seq_anotacao	is null and c.nr_seq_pac_medic	is null and c.nr_seq_intercorrencia is not null and f.dt_liberacao		is not null and obter_data_assinatura_digital(f.nr_seq_assinatura) is null and coalesce(c.ie_pendente_assinat_usuario,'N')	= 'N' order by
	nr_seq_apres,
	ds_item;

