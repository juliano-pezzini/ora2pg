-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW resumo_item_conta_v (ie_emite_conta, nr_interno_conta, cd_convenio, cd_resumo, ds_resumo, qt_resumo, vl_resumo, qt_convenio, vl_convenio, vl_medico) AS select	98 IE_EMITE_CONTA,
	a.nr_interno_conta, 
	a.cd_convenio, 
	Obter_Regra_Resumo_Item_Conta(a.cd_convenio, a.cd_material, null, null, 'C') cd_resumo, 
	Obter_Regra_Resumo_Item_Conta(a.cd_convenio, a.cd_material, null, null, 'D') ds_resumo, 
	sum(a.qt_material) qt_resumo, 
	sum(a.vl_material) vl_resumo, 
	sum(a.qt_material_convenio) qt_convenio, 
	sum(a.vl_material_convenio) vl_convenio, 
	0 vl_medico 
FROM	conta_paciente_material_v a 
group by a.nr_interno_conta, 
	a.cd_convenio, 
	Obter_Regra_Resumo_Item_Conta(a.cd_convenio, a.cd_material, null, null, 'C'), 
	Obter_Regra_Resumo_Item_Conta(a.cd_convenio, a.cd_material, null, null, 'D') 

union
	 
select	98, 
	a.nr_interno_conta, 
	a.cd_convenio, 
	Obter_Regra_Resumo_Item_Conta(a.cd_convenio, null, a.cd_procedimento, a.ie_origem_proced, 'C') cd_resumo, 
	Obter_Regra_Resumo_Item_Conta(a.cd_convenio, null, a.cd_procedimento, a.ie_origem_proced, 'D') ds_resumo, 
	sum(a.qt_procedimento) qt_resumo, 
	sum(a.vl_procedimento) vl_resumo, 
	sum(a.qt_proced_convenio) qt_convenio, 
	sum(a.vl_proced_convenio) vl_convenio, 
	sum(a.vl_medico) vl_medico 
from	conta_paciente_procedimento_v a 
group by a.nr_interno_conta, 
	a.cd_convenio, 
	Obter_Regra_Resumo_Item_Conta(a.cd_convenio, null, a.cd_procedimento, a.ie_origem_proced, 'C'), 
	Obter_Regra_Resumo_Item_Conta(a.cd_convenio, null, a.cd_procedimento, a.ie_origem_proced, 'D');

