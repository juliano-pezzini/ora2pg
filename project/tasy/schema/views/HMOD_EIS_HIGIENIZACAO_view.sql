-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW hmod_eis_higienizacao (ds_setor_atendimento, ds_unidade, dt_historico, ds_cid10, qt_higienizacao, qt_tempo_min, nm_usuario_higienizacao, nm_usuario, dt_fim_historico, nr_atendimento) AS select substr(obter_nome_setor(a.cd_setor_atendimento),1,100)  DS_SETOR_ATENDIMENTO,
   (cd_unidade_basica || '     ' || cd_unidade_compl) ds_unidade,
        b.dt_historico,
    substr(obter_desc_cid(cd_doenca),1,255)ds_cid10,
 COUNT(*)QT_HIGIENIZACAO,
dividir(sum(obter_min_entre_datas(b.DT_HISTORICO,b.DT_FIM_HISTORICO,1)),count(*)) QT_TEMPO_MIN,
        nm_usuario_higienizacao,
    SUBSTR(OBTER_NOME_USUARIO(NM_USUARIO_HIGIENIZACAO),1,60)NM_USUARIO,
        b.dt_fim_historico,
    c.nr_atendimento
FROM unidade_atendimento a, unidade_atend_hist b
LEFT OUTER JOIN diagnostico_doenca c ON (b.nr_atendimento = c.nr_atendimento)
WHERE a.nr_seq_interno = b.nr_seq_unidade  and b.ie_status_unidade = 'H' GROUP BY a.CD_SETOR_ATENDIMENTO,
      CD_UNIDADE_BASICA,
       CD_UNIDADE_COMPL,
      CD_DOENCA,
      DT_FIM_HISTORICO,
      DT_HISTORICO,
      NM_USUARIO_HIGIENIZACAO,
     c.NR_ATENDIMENTO
;

