-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW w_eis_complex_perroca_v (nr_sequencia, dt_avaliacao, setor, ds_setor_atendimento, ds_item, qt_pontuacao, qt_score, nr_seq_gradacao, ds_gradacao, ie_sexo, ds_sexo, ie_faixa_etaria, cd_estabelecimento, ds_estabelecimento, ds_unidade) AS select distinct
	a.nr_sequencia, 
	trunc(a.dt_avaliacao) dt_avaliacao, 
	b.cd_setor_atendimento setor, 
	obter_nome_setor(b.cd_setor_atendimento) ds_setor_atendimento, 
	substr(e.ds_item,1,255) ds_item, 
	coalesce(d.qt_pontuacao,0) qt_pontuacao, 
	coalesce(a.qt_pontuacao,0)qt_score, 
	a.nr_seq_gradacao, 
	substr(g.ds_gradacao,1,255) ds_gradacao, 
	c.ie_sexo ie_sexo, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo,	 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) ie_faixa_etaria, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento, 
	obter_unidade_atendimento(a.nr_atendimento,'A','U') ds_unidade 
FROM	gca_atendimento a,	 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c, 
	gca_atend_result d, 
	gca_item e, 
	gca_item_result f, 
	gca_gradacao g 
where	a.nr_atendimento = b.nr_atendimento 
and	a.ie_autor = 'P' 
and	d.nr_seq_avaliacao = a.nr_sequencia 
and	d.nr_seq_item = e.nr_sequencia 
and	f.nr_seq_item = e.nr_sequencia 
and	a.nr_seq_gradacao = g.nr_sequencia 
and	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
and	a.dt_inativacao is null;

