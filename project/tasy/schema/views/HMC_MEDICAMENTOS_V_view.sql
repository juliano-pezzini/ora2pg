-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW hmc_medicamentos_v (ds_horarios, ds_barra, ds_diluicao, ds_observacao, ie_via_aplicacao, nr_sequencia, nr_agrupamento, nr_sequencia_diluicao, ds_bomba, ds_dose_especial, hr_dose_especial, ie_medicacao_paciente, ds_medic_nao_padrao, nr_prescricao, nr_dia_util, ds_bolus, ds_aplicacao, ds_justificativa, ie_baixa_estoq_pac, ds_dosagem, ie_antimicrobiano, ds_antimicrobiano, ie_bomba_infusao, ie_se_necessario, nr_atendimento, dt_inicio_prescr, dt_validade_prescr) AS SELECT HMC_Obter_Horario_Imp_Presc(A.NR_PRESCRICAO,A.NR_SEQUENCIA,'M') DS_HORARIOS,
SUBSTR('/500       /500       /500       /500       /500       /500',1,((A.nr_ocorrencia * 17)-1)) ds_barra, 
CASE WHEN 'N'=OBTER_SE_ITEM_COMPOSTO(A.nr_prescricao,A.nr_sequencia,A.NR_AGRUPAMENTO) THEN OBTER_DILUICAO_MEDIC(A.NR_SEQUENCIA,A.NR_PRESCRICAO)  ELSE '' END  DS_DILUICAO, 
CASE WHEN 'N'=OBTER_SE_ITEM_COMPOSTO(A.nr_prescricao,A.nr_sequencia,A.NR_AGRUPAMENTO) THEN A.DS_OBSERVACAO  ELSE '' END  DS_OBSERVACAO, 
A.IE_VIA_APLICACAO, 
A.NR_SEQUENCIA, 
A.NR_AGRUPAMENTO, 
A.NR_SEQUENCIA_DILUICAO, 
CASE WHEN 'N'=OBTER_SE_ITEM_COMPOSTO(A.nr_prescricao,A.nr_sequencia,A.NR_AGRUPAMENTO) THEN CASE WHEN A.IE_BOMBA_INFUSAO=' ' THEN NULL  ELSE Obter_Valor_Dominio(1537,A.ie_bomba_infusao) END   ELSE '' END  DS_BOMBA, 
CASE WHEN 'N'=OBTER_SE_ITEM_COMPOSTO(A.nr_prescricao,A.nr_sequencia,A.NR_AGRUPAMENTO) THEN CASE WHEN A.QT_DOSE_ESPECIAL IS NULL THEN NULL  ELSE 'Dose Especial: '||REPLACE(converte_fracao_dose(A.CD_UNIDADE_MEDIDA_DOSE,A.QT_DOSE_ESPECIAL),'.',',')|| ' '||A.CD_UNIDADE_MEDIDA_DOSE||' àS '|| A.HR_DOSE_ESPECIAL||' h' END   ELSE '' END  DS_DOSE_ESPECIAL , 
CASE WHEN 'N'=OBTER_SE_ITEM_COMPOSTO(A.nr_prescricao,A.nr_sequencia,A.NR_AGRUPAMENTO) THEN A.HR_DOSE_ESPECIAL  ELSE '' END  HR_DOSE_ESPECIAL, 
CASE WHEN A.IE_MEDICACAO_PACIENTE='S' THEN 'S'  ELSE '' END  IE_MEDICACAO_PACIENTE, 
CASE WHEN 'N'=OBTER_SE_ITEM_COMPOSTO(A.nr_prescricao,A.nr_sequencia,A.NR_AGRUPAMENTO) THEN CASE WHEN A.IE_MEDICACAO_PACIENTE='S' THEN A.ds_medic_nao_padrao  ELSE '' END   ELSE '' END DS_MEDIC_NAO_PADRAO, 
A.NR_PRESCRICAO nr_prescricao, 
CASE WHEN A.NR_DIA_UTIL IS NULL THEN NULL  ELSE A.NR_DIA_UTIL||' º' END  NR_DIA_UTIL, 
CASE WHEN A.IE_APLIC_BOLUS='S' THEN 'em "bolus"'  ELSE NULL END  DS_BOLUS, 
CASE WHEN A.IE_APLIC_LENTA='S' THEN 'lentamente'  ELSE NULL END  DS_APLICACAO, 
CASE WHEN 'N'=OBTER_SE_ITEM_COMPOSTO(A.nr_prescricao,A.nr_sequencia,A.NR_AGRUPAMENTO) THEN A.DS_JUSTIFICATIVA  ELSE '' END  DS_JUSTIFICATIVA, 
B.IE_BAIXA_ESTOQ_PAC, 
Obter_UM_Dosagem_Prescr(A.nr_prescricao,A.nr_sequencia) ds_dosagem, 
CASE WHEN B.ie_controle_medico=0 THEN 'N'  ELSE 'S' END  ie_antimicrobiano, 
CASE WHEN 'N'=OBTER_SE_ITEM_COMPOSTO(A.nr_prescricao,A.nr_sequencia,A.NR_AGRUPAMENTO) THEN SUBSTR(Obter_desc_antimicrobiano(A.NR_PRESCRICAO,A.NR_SEQUENCIA),1,2000)  ELSE '' END  ds_antimicrobiano, 
CASE WHEN coalesce(A.IE_BOMBA_INFUSAO,'N')='N' THEN 'N'  ELSE 'S' END  IE_BOMBA_INFUSAO, 
A.ie_se_necessario,c.nr_atendimento,c.dt_inicio_prescr,c.dt_validade_prescr 
FROM MATERIAL B,PRESCR_MATERIAL A,prescr_medica c 
WHERE A.CD_MATERIAL=B.CD_MATERIAL 
AND c.nr_prescricao=A.nr_prescricao 
AND A.NR_SEQUENCIA_SOLUCAO IS NULL 
AND A.NR_SEQUENCIA_PROC IS NULL 
AND A.NR_SEQUENCIA_DILUICAO IS NULL 
AND A.NR_SEQUENCIA_DIETA IS NULL 
AND	A.IE_AGRUPADOR=1 
AND	A.cd_kit_material IS NULL 
AND	coalesce(A.IE_ADMINISTRAR,'S')='S' 
AND A.qt_dose > 50 

UNION
 
SELECT HMC_Obter_Horario_Imp_Presc(A.NR_PRESCRICAO,A.NR_SEQUENCIA,'M') DS_HORARIOS, 
'' ds_barra, 
CASE WHEN 'N'=OBTER_SE_ITEM_COMPOSTO(A.nr_prescricao,A.nr_sequencia,A.NR_AGRUPAMENTO) THEN OBTER_DILUICAO_MEDIC(A.NR_SEQUENCIA,A.NR_PRESCRICAO)  ELSE '' END  DS_DILUICAO, 
CASE WHEN 'N'=OBTER_SE_ITEM_COMPOSTO(A.nr_prescricao,A.nr_sequencia,A.NR_AGRUPAMENTO) THEN A.DS_OBSERVACAO  ELSE '' END  DS_OBSERVACAO, 
A.IE_VIA_APLICACAO, 
A.NR_AGRUPAMENTO, 
A.NR_SEQUENCIA, 
A.NR_SEQUENCIA_DILUICAO, 
CASE WHEN 'N'=OBTER_SE_ITEM_COMPOSTO(A.nr_prescricao,A.nr_sequencia,A.NR_AGRUPAMENTO) THEN CASE WHEN A.IE_BOMBA_INFUSAO=' ' THEN NULL  ELSE Obter_Valor_Dominio(1537,A.ie_bomba_infusao) END   ELSE '' END  DS_BOMBA, 
CASE WHEN 'N'=OBTER_SE_ITEM_COMPOSTO(A.nr_prescricao,A.nr_sequencia,A.NR_AGRUPAMENTO) THEN CASE WHEN A.QT_DOSE_ESPECIAL IS NULL THEN NULL  ELSE 'Dose Especial: '||REPLACE(converte_fracao_dose(A.CD_UNIDADE_MEDIDA_DOSE,A.QT_DOSE_ESPECIAL),'.',',')|| ' '||A.CD_UNIDADE_MEDIDA_DOSE||' àS '|| A.HR_DOSE_ESPECIAL||' h' END   ELSE '' END DS_DOSE_ESPECIAL , 
CASE WHEN 'N'=OBTER_SE_ITEM_COMPOSTO(A.nr_prescricao,A.nr_sequencia,A.NR_AGRUPAMENTO) THEN A.HR_DOSE_ESPECIAL  ELSE '' END  HR_DOSE_ESPECIAL, 
CASE WHEN A.IE_MEDICACAO_PACIENTE='S' THEN 'S'  ELSE '' END  IE_MEDICACAO_PACIENTE, 
CASE WHEN 'N'=OBTER_SE_ITEM_COMPOSTO(A.nr_prescricao,A.nr_sequencia,A.NR_AGRUPAMENTO) THEN CASE WHEN A.IE_MEDICACAO_PACIENTE='S' THEN A.ds_medic_nao_padrao  ELSE '' END   ELSE '' END DS_MEDIC_NAO_PADRAO, 
A.NR_PRESCRICAO nr_prescricao, 
CASE WHEN A.NR_DIA_UTIL IS NULL THEN NULL  ELSE A.NR_DIA_UTIL||' º' END  NR_DIA_UTIL, 
CASE WHEN A.IE_APLIC_BOLUS='S' THEN 'em "bolus"'  ELSE NULL END  DS_BOLUS, 
CASE WHEN A.IE_APLIC_LENTA='S' THEN 'lentamente'  ELSE NULL END  DS_APLICACAO, 
CASE WHEN 'N'=OBTER_SE_ITEM_COMPOSTO(A.nr_prescricao,A.nr_sequencia,A.NR_AGRUPAMENTO) THEN A.DS_JUSTIFICATIVA  ELSE '' END  DS_JUSTIFICATIVA, 
B.IE_BAIXA_ESTOQ_PAC, 
Obter_UM_Dosagem_Prescr(A.nr_prescricao,A.nr_sequencia) ds_dosagem, 
CASE WHEN B.ie_controle_medico=0 THEN 'N'  ELSE 'S' END  ie_antimicrobiano, 
CASE WHEN 'N'=OBTER_SE_ITEM_COMPOSTO(A.nr_prescricao,A.nr_sequencia,A.NR_AGRUPAMENTO) THEN SUBSTR(Obter_desc_antimicrobiano(A.NR_PRESCRICAO,A.NR_SEQUENCIA),1,2000)  ELSE '' END  ds_antimicrobiano, 
CASE WHEN coalesce(A.IE_BOMBA_INFUSAO,'N')='N' THEN 'N'  ELSE 'S' END  IE_BOMBA_INFUSAO,A.ie_se_necessario 
,c.nr_atendimento,c.dt_inicio_prescr,c.dt_validade_prescr 
FROM MATERIAL B,PRESCR_MATERIAL A,prescr_medica c 
WHERE A.CD_MATERIAL=B.CD_MATERIAL 
AND c.nr_prescricao=A.nr_prescricao 
AND A.NR_SEQUENCIA_SOLUCAO IS NULL 
AND A.NR_SEQUENCIA_PROC IS NULL 
AND A.NR_SEQUENCIA_DILUICAO IS NULL 
AND A.NR_SEQUENCIA_DIETA IS NULL 
AND	A.IE_AGRUPADOR=1 
AND	A.cd_kit_material IS NULL 
AND	A.qt_dose <= 50 
AND	coalesce(A.IE_ADMINISTRAR,'S') = 'S' 
ORDER BY 7;

