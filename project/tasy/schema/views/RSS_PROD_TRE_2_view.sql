-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW rss_prod_tre_2 (dt_atividade, dt_fim_atividade, qt_minuto, qt_ttmc, qt_tth, nm_usuario_exec, nm_executor, cd_cargo, ds_cargo, cd_setor_usuario, ds_setor_usuario, nr_seq_funcao, ds_funcao, nr_seq_grupo_funcao, ds_grupo_funcao, vl_percentual, nr_sequencia, nr_seq_ordem_serv) AS SELECT  a.DT_ATIVIDADE,
        a.DT_FIM_ATIVIDADE,
        a.QT_MINUTO,
        trunc((86401*(a.DT_FIM_ATIVIDADE-a.DT_ATIVIDADE))/60),
        (a.QT_MINUTO/60),
        a.NM_USUARIO_EXEC,
        substr(obter_nome_usuario(a.nm_usuario_exec),1,100),
        SubStr(obter_dados_usuario_opcao(a.nm_usuario_exec,'R'),1,255),
        SubStr(obter_cargo_usuario(a.nm_usuario_exec),1,255),
        SubStr(obter_dados_usuario_opcao(a.nm_usuario_exec,'S'),1,255),
        SubStr(obter_dados_usuario_opcao(a.nm_usuario_exec,'DS'),1,255),
        a.NR_SEQ_FUNCAO,
        substr(obter_desc_tipo_funcao(a.NR_SEQ_FUNCAO),1,100),
        b.NR_SEQ_GRUPO_FUNCAO,
        substr(obter_descricao_padrao('MAN_GRUPO_FUNCAO','DS_GRUPO',b.NR_SEQ_GRUPO_FUNCAO),1,255),
        round (((ratio_to_report(qt_minuto) over (partition by b.NR_SEQ_GRUPO_FUNCAO))*100),4),
        a.NR_SEQUENCIA,
        a.NR_SEQ_ORDEM_SERV
FROM    MAN_ORDEM_SERV_ATIV a,
        MAN_TIPO_FUNCAO b
WHERE   a.NR_SEQ_FUNCAO=b.NR_SEQUENCIA;

