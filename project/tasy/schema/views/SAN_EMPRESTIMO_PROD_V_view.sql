-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW san_emprestimo_prod_v (nr_sequencia, nr_sangue, ds_derivado, ie_tipo_sangue, ie_fator_rh, ds_tipo_doacao, dt_doacao, nm_iniciais) AS select	d.nr_sequencia,
	d.nr_sangue, 
	e.ds_derivado, 
	b.ie_tipo_sangue, 
	b.ie_fator_rh, 
	c.ds_tipo_doacao, 
	a.dt_doacao, 
	substr(obter_iniciais_nome(a.cd_pessoa_fisica,null),1,50) nm_iniciais 
FROM san_derivado e, san_tipo_doacao c, pessoa_fisica b, san_doacao a, san_producao d
LEFT OUTER JOIN san_producao_lib_venc h ON (d.nr_sequencia = h.nr_seq_producao)
WHERE a.cd_pessoa_fisica	= b.cd_pessoa_fisica and a.nr_seq_tipo		= c.nr_sequencia and a.nr_sequencia		= d.nr_seq_doacao and d.nr_seq_derivado	= e.nr_sequencia  and d.nr_seq_emp_ent is null 
 
union
 
select	d.nr_sequencia, 
	d.nr_sangue, 
	e.ds_derivado, 
	d.ie_tipo_sangue, 
	d.ie_fator_rh, 
	'Empr√©stimo', 
	d.dt_producao, 
	substr(d.nm_doador,1,50) 
FROM san_derivado e, san_entidade b, san_emprestimo a, san_producao d
LEFT OUTER JOIN san_producao_lib_venc h ON (d.nr_sequencia = h.nr_seq_producao)
WHERE d.nr_seq_derivado	= e.nr_sequencia and d.nr_seq_emp_ent	= a.nr_sequencia and a.nr_seq_entidade	= b.nr_sequencia  
union
 
select	d.nr_sequencia, 
	d.nr_sangue, 
	e.ds_derivado, 
	d.ie_tipo_sangue, 
	d.ie_fator_rh, 
	'Agrupamento', 
	d.dt_producao, 
	substr(d.nm_doador,1,50) 
FROM san_derivado e, san_agrupamento a, san_producao d
LEFT OUTER JOIN san_producao_lib_venc h ON (d.nr_sequencia = h.nr_seq_producao)
WHERE d.nr_seq_derivado	= e.nr_sequencia and a.nr_sequencia		= d.nr_seq_agrupamento;

