-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_item_pacote_nova_v (ie_tipo_item, ie_origem_item, cd_item, ds_item, qt_item, vl_negociado, cd_procedimento, ie_origem_proced, nr_seq_proc, nr_seq_prestador) AS SELECT	'Procedimento'		ie_tipo_item,
	c.ie_origem_proced 	ie_origem_item,
	c.cd_procedimento	cd_item,
	SUBSTR(obter_descricao_procedimento(c.cd_procedimento,c.ie_origem_proced),1,255) ds_item,
	c.qt_procedimento	qt_item,
	vl_negociado		vl_negociado,
	a.cd_procedimento,
	a.ie_origem_proced,
	d.nr_sequencia 		nr_seq_proc,
	c.nr_seq_prestador
FROM	pls_pacote		a,
	pls_pacote_composicao 	b,
	pls_pacote_procedimento	c,
	pls_conta_proc 		d,
	pls_pacote_tipo_acomodacao e,
	pls_conta 		f
WHERE	a.nr_sequencia = b.nr_seq_pacote
AND	b.nr_sequencia = c.nr_seq_composicao
AND	b.nr_sequencia = e.nr_seq_composicao
AND	e.nr_seq_pacote = d.nr_seq_pacote
and	d.nr_seq_conta	= f.nr_sequencia
AND	c.ie_situacao	= 'A'
AND	a.ie_situacao	= 'A'
AND	coalesce(c.ie_estrutura,'S')	= 'S'
and	(((coalesce(d.dt_procedimento,f.dt_atendimento) >= b.dt_inicio_vigencia) and b.dt_inicio_vigencia is not null) or (b.dt_inicio_vigencia is null))
and	(((coalesce(d.dt_procedimento,f.dt_atendimento) <= b.dt_fim_vigencia) and b.dt_fim_vigencia is not null) or (b.dt_fim_vigencia is null))
and	((f.nr_seq_prestador_exec	= c.nr_seq_prestador) or (c.nr_seq_prestador is null))

UNION ALL

SELECT	'Material',
	NULL,
	c.nr_seq_material,
	SUBSTR(pls_obter_desc_material(c.nr_seq_material),1,255),
	c.qt_material,
	vl_negociado,
	a.cd_procedimento,
	a.ie_origem_proced,
	d.nr_sequencia,
	c.nr_seq_prestador
FROM	pls_pacote		a,
	pls_pacote_composicao	b,
	pls_pacote_material	c,
	pls_conta_proc 		d,
	pls_pacote_tipo_acomodacao e,
	pls_conta		f
WHERE	a.nr_sequencia = b.nr_seq_pacote
AND	b.nr_sequencia = c.nr_seq_composicao
AND	b.nr_sequencia = e.nr_seq_composicao
AND	e.nr_seq_pacote = d.nr_seq_pacote
and	d.nr_seq_conta	= f.nr_sequencia
AND	c.ie_situacao	= 'A'
AND	a.ie_situacao	= 'A'
and	(((coalesce(d.dt_procedimento,f.dt_atendimento) >= b.dt_inicio_vigencia) and b.dt_inicio_vigencia is not null) or (b.dt_inicio_vigencia is null))
and	(((coalesce(d.dt_procedimento,f.dt_atendimento) <= b.dt_fim_vigencia) and b.dt_fim_vigencia is not null) or (b.dt_fim_vigencia is null))
and	((f.nr_seq_prestador_exec	= c.nr_seq_prestador) or (c.nr_seq_prestador is null));

