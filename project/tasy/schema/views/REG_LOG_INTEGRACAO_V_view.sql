-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW reg_log_integracao_v (ie_status, nr_seq_evento_retorno, nr_seq_regulacao_atendimento, nr_seq_log_ultima, nr_seq_log_int_gm, nr_seq_log_int_retorno, ds_observacao, nr_atendimento, dt_geracao, dt_liberacao, nr_sequencia, nr_seq_informacao, cd_evento, ie_tipo_evento) AS select	a.ie_status,
	max(i.nr_sequencia) nr_seq_evento_retorno,
	obter_somente_numero(obter_texto_entre_caracter(f.ds_observacao,'nr_sequencia=',';')) nr_seq_regulacao_atendimento,
	max(b.nr_sequencia) nr_seq_log_ultima,
	max(f.nr_sequencia) nr_seq_log_int_gm,
	max(i.nr_sequencia) nr_seq_log_int_retorno,
	substr(obter_texto_entre_caracter(i.ds_observacao,'[',']'),1,50) ds_observacao,
	obter_somente_numero(obter_texto_entre_caracter(f.ds_observacao,'nr_atendimento=',';')) nr_atendimento,
	a.dt_geracao,
	a.dt_liberacao,
	a.nr_sequencia,
	a.nr_seq_informacao,
	b.cd_evento,
	b.ie_tipo_evento
FROM	log_integracao a,
	log_integracao_evento b,
	log_integracao_evento f,
	log_integracao_evento i,
	valor_dominio e
where	a.nr_sequencia		= b.nr_seq_log
and	a.nr_sequencia		= i.nr_seq_log
and	a.nr_sequencia		= f.nr_seq_log
and	f.cd_evento		= 'GM' -- Geração de mensagem
and	i.ie_envio_retorno	= 'R'
and	a.nr_seq_informacao	= e.vl_dominio
and	e.cd_dominio		= 7258
group by a.ie_status, f.ds_observacao, a.dt_geracao, a.dt_liberacao, a.nr_sequencia, a.nr_seq_informacao, i.ds_observacao, b.cd_evento, b.ie_tipo_evento;

