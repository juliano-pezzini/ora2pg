-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_consulta_rescisao_inter_v (ie_todos, nr_seq_rescindido, nm_rescindido, dt_rescisao_regra, ds_motivo_solicitacao, dt_solicitacao, nm_usuario_solicitacao, ds_observacao, cd_pessoa_fisica, nr_seq_titular, dt_rescisao, ie_tipo, ds_tipo, nr_seq_motivo_rescisao, nr_seq_intercambio, cd_estabelecimento, nr_seq_rescisao_contr) AS select	'N' 								ie_todos,
	a.nr_seq_segurado 						nr_seq_rescindido,
	substr(pls_obter_dados_segurado(a.nr_seq_segurado, 'NS'),1,60)	nm_rescindido,
	a.dt_rescisao							dt_rescisao_regra,
	c.ds_motivo_cancelamento					ds_motivo_solicitacao,
	a.dt_solicitacao						dt_solicitacao,
	a.nm_usuario_solicitacao					nm_usuario_solicitacao,
	substr(a.ds_observacao,1,255) 					ds_observacao,
	b.cd_pessoa_fisica						cd_pessoa_fisica,
	b.nr_seq_titular						nr_seq_titular,
	b.dt_rescisao 							dt_rescisao,
	'B' 								ie_tipo,
	wheb_mensagem_pck.get_texto(1173999)				ds_tipo,
	a.nr_seq_motivo_rescisao					nr_seq_motivo_rescisao,
	b.nr_seq_intercambio 						nr_seq_intercambio,
	b.cd_estabelecimento 						cd_estabelecimento,
	a.nr_sequencia							nr_seq_rescisao_contr
FROM pls_intercambio d, pls_segurado b, pls_motivo_cancelamento c
LEFT OUTER JOIN pls_rescisao_contrato a ON (c.nr_sequencia = a.nr_seq_motivo_rescisao)
WHERE b.nr_seq_intercambio	= d.nr_sequencia and a.nr_seq_segurado	= b.nr_sequencia  and a.ie_situacao		= 'A'

union

select	'N' 								ie_todos,
	a.nr_seq_pagador						nr_seq_rescindido,
	substr(obter_nome_pf_pj(b.cd_pessoa_fisica, b.cd_cgc),1,200)	nm_rescindido,
	a.dt_rescisao							dt_rescisao_regra,
	c.ds_motivo_cancelamento					ds_motivo_solicitacao,
	a.dt_solicitacao						dt_solicitacao,		
	a.nm_usuario_solicitacao					nm_usuario_solicitacao,
	substr(a.ds_observacao,1,255) 					ds_observacao,
	b.cd_pessoa_fisica						cd_pessoa_fisica,
	null 								nr_seq_titular,
	b.dt_rescisao 							dt_rescisao,
	'P' 								ie_tipo,
	'Pagador' 							ds_tipo,
	a.nr_seq_motivo_rescisao					nr_seq_motivo_rescisao,
	b.nr_seq_pagador_intercambio 					nr_seq_intercambio,
	d.cd_estabelecimento						cd_estabelecimento,
	a.nr_sequencia							nr_seq_rescisao_contr
FROM pls_intercambio d, pls_contrato_pagador b, pls_motivo_cancelamento c
LEFT OUTER JOIN pls_rescisao_contrato a ON (c.nr_sequencia = a.nr_seq_motivo_rescisao)
WHERE b.nr_seq_pagador_intercambio	= d.nr_sequencia and a.nr_seq_pagador		= b.nr_sequencia  and a.ie_situacao			= 'A'
 
union

select	'N'								ie_todos,
	b.nr_sequencia							nr_seq_rescindido,
	substr(obter_nome_pf_pj(b.cd_pessoa_fisica, b.cd_cgc),1,200)	nm_rescindido,
	a.dt_rescisao							dt_rescisao_regra,
	c.ds_motivo_cancelamento					ds_motivo_solicitacao,
	a.dt_solicitacao						dt_solicitacao,
	a.nm_usuario_solicitacao					nm_usuario_solicitacao,
	substr(a.ds_observacao,1,255) 					ds_observacao,
	b.cd_pessoa_fisica						cd_pessoa_fisica,
	null 								nr_seq_titular,
	b.dt_exclusao							dt_rescisao,
	'I'								ie_tipo,
	wheb_mensagem_pck.get_texto(1174002)				ds_tipo,
	a.nr_seq_motivo_rescisao 					nr_seq_motivo_rescisao,
	b.nr_sequencia							nr_seq_intercambio,
	b.cd_estabelecimento						cd_estabelecimento,
	a.nr_sequencia							nr_seq_rescisao_contr
FROM pls_intercambio b, pls_motivo_cancelamento c
LEFT OUTER JOIN pls_rescisao_contrato a ON (c.nr_sequencia = a.nr_seq_motivo_rescisao)
WHERE a.nr_seq_intercambio	= b.nr_sequencia  and a.ie_situacao 		= 'A';

