-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW man_ordem_servico_v2 (nr_sequencia, nr_seq_localizacao, nr_seq_equipamento, cd_pessoa_solicitante, dt_ordem_servico, ie_prioridade, ie_parado, ds_dano_breve, dt_atualizacao, nm_usuario, dt_inicio_desejado, dt_conclusao_desejada, ds_dano, dt_inicio_previsto, dt_fim_previsto, dt_inicio_real, dt_fim_real, ie_status_ordem, nr_grupo_planej, nr_grupo_trabalho, nr_seq_tipo_solucao, ds_solucao, nm_usuario_exec, qt_contador, nr_seq_planej, nr_seq_tipo_contador, nr_seq_estagio, cd_projeto, nr_seq_etapa_proj, dt_reabertura, cd_funcao, nm_tabela, ie_classificacao, nr_seq_origem, nr_seq_projeto, ie_grau_satisfacao, nr_seq_indicador, nr_seq_causa_dano, ie_forma_receb, nr_seq_cliente, nr_seq_grupo_des, nr_seq_grupo_sup, nr_seq_superior, ie_eficacia, dt_prev_eficacia, cd_pf_eficacia, nr_seq_nao_conform, nr_seq_complex, dt_atualizacao_nrec, nm_usuario_nrec, ie_obriga_news, nr_seq_meta_pe, nr_seq_classif, nr_seq_nivel_valor, nm_usuario_lib_news, dt_libera_news, dt_envio_wheb, ds_contato_solicitante, ie_prioridade_desen, ie_prioridade_sup, nr_seq_risco_impl, nr_seq_motivo_cancel_acao, nr_seq_wheb, dt_validacao_pe, nr_seq_obj_bsc, dt_ordem_original, ie_prioridade_cliente, ie_classificacao_cliente, nr_seq_corresp, nr_seq_etapa_gpi, nr_seq_proj_gpi, nr_seq_classif_gestao, dt_fim_acordo, cd_pf_resp_bsc, nm_pessoa_acordo, dt_interna_acordo, dt_externa_acordo, ie_resp_teste, nr_seq_cs, dt_fim_garantia, ds_evidencia, nm_usuario_prioridade, nm_usuario_classif, dt_ult_acesso_lider, nr_seq_origem_dano, dt_impressao, qt_dia_analise_eficacia_acao, ie_os_relatorio, ie_tipo_customizacao_os, nm_usuario_encer, nr_seq_proj_cron_etapa, ie_origem_os, nr_seq_modelo, nr_seq_atend_pls, ie_tipo_ordem, nr_seq_tipo_ordem, nr_seq_evento_atend, nr_seq_tre_agenda, dt_aceite_os, ie_exclusiva, ds_just_ret_news, nr_seq_servico, cd_setor_atendimento, ds_palavra_chave, ie_envolve_treinamento, nm_solicitante, ds_equipamento, nr_seq_planej_equip, nr_seq_trab_equip, cd_impacto, nr_seq_trab, ds_localizacao, cd_setor, ds_setor_localizacao, ds_prioridade, ds_prioridade_cliente, ds_ordem, ds_situacao, cd_imobilizado, ie_propriedade, ie_terceiro, nm_usuario_exec_prev, ds_grupo_trabalho, ds_grupo_planej, ds_tipo_solucao, ds_estagio, ds_grupo_des, ds_gerencia_des, nr_seq_gerencia_des, ds_grupo_sup, ds_classificacao, ds_classificacao_cliente, ds_causa_dano, ds_funcao, dt_inicio_semana, dt_inicio_mes, dt_ano, cd_estabelecimento, ds_estab_localiz, nr_seq_tipo_equip, ds_fone_assist_tecnica, qt_minutos_previsto, ds_cidade, cd_cnpj, ds_classif_gestao, nr_seq_proj_vinc, nr_seq_proj_orig, nr_seq_proj_acomp, ds_origem_os, nr_serie, cd_imobilizado_ext, ds_gerencia_sup, nr_seq_gerencia_sup, ds_servico_catalogo, ds_tipo_servico_catalogo, ds_setor_atendimento, nr_seq_tipo_ocor, dt_liberacao, dt_aprovacao, dt_inicio_analise_qual_soft, dt_fim_analise_qual_soft, nm_usuario_analise_qual_soft, ie_escala_email_sup, nr_seq_confidencialidade, nr_seq_pend_classif_gpw, nr_versao_cliente_abertura, nr_seq_integracao, ie_ws_localizacao, nr_seq_grupo_teste, cd_controle, ie_plataforma, dt_versao_prev, ds_estagio_philips, nr_seq_pais, cd_tasy_version, nr_service_pack, ie_complaint, cd_trackwise_id, nr_seq_severidade_wheb, ie_origem, nr_seq_tp_classif, nr_seq_classif_cad) AS SELECT	a.nr_sequencia,
	a.nr_seq_localizacao,
	a.nr_seq_equipamento,
	a.cd_pessoa_solicitante,
	a.dt_ordem_servico,
	a.ie_prioridade,
	a.ie_parado,
	a.ds_dano_breve,
	a.dt_atualizacao,
	a.nm_usuario,
	a.dt_inicio_desejado,
	a.dt_conclusao_desejada,
	a.ds_dano,
	a.dt_inicio_previsto,
	a.dt_fim_previsto,
	a.dt_inicio_real,
	a.dt_fim_real,
	a.ie_status_ordem,
	a.nr_grupo_planej,
	a.nr_grupo_trabalho,
	a.nr_seq_tipo_solucao,
	a.ds_solucao,
	a.nm_usuario_exec,
	a.qt_contador,
	a.nr_seq_planej,
	a.nr_seq_tipo_contador,
	a.nr_seq_estagio,
	a.cd_projeto,
	a.nr_seq_etapa_proj,
	a.dt_reabertura,
	a.cd_funcao,
	a.nm_tabela,
	a.ie_classificacao,
	a.nr_seq_origem,
	a.nr_seq_projeto,
	a.ie_grau_satisfacao,
	a.nr_seq_indicador,
	a.nr_seq_causa_dano,
	a.ie_forma_receb,
	a.nr_seq_cliente,
	a.nr_seq_grupo_des,
	a.nr_seq_grupo_sup,
	a.nr_seq_superior,
	a.ie_eficacia,
	a.dt_prev_eficacia,
	a.cd_pf_eficacia,
	a.nr_seq_nao_conform,
	a.nr_seq_complex,
	a.dt_atualizacao_nrec,
	a.nm_usuario_nrec,
	a.ie_obriga_news,
	a.nr_seq_meta_pe,
	a.nr_seq_classif,
	a.nr_seq_nivel_valor,
	a.nm_usuario_lib_news,
	a.dt_libera_news,
	a.dt_envio_wheb,
	a.ds_contato_solicitante,
	a.ie_prioridade_desen,
	a.ie_prioridade_sup,
	a.nr_seq_risco_impl,
	a.nr_seq_motivo_cancel_acao,
	a.nr_seq_wheb,
	a.dt_validacao_pe,
	a.nr_seq_obj_bsc,
	a.dt_ordem_original,
	a.ie_prioridade_cliente,
	a.ie_classificacao_cliente,
	a.nr_seq_corresp,
	a.nr_seq_etapa_gpi,
	a.nr_seq_proj_gpi,
	a.nr_seq_classif_gestao,
	a.dt_fim_acordo,
	a.cd_pf_resp_bsc,
	a.nm_pessoa_acordo,
	a.dt_interna_acordo,
	a.dt_externa_acordo,
	a.ie_resp_teste,
	a.nr_seq_cs,
	a.dt_fim_garantia,
	a.ds_evidencia,
	a.nm_usuario_prioridade,
	a.nm_usuario_classif,
	a.dt_ult_acesso_lider,
	a.nr_seq_origem_dano,
	a.dt_impressao,
	a.qt_dia_analise_eficacia_acao,
	a.ie_os_relatorio,
	a.ie_tipo_customizacao_os,
	a.nm_usuario_encer,
	a.nr_seq_proj_cron_etapa,
	a.ie_origem_os,
	a.nr_seq_modelo,
	a.nr_seq_atend_pls,
	a.ie_tipo_ordem,
	a.nr_seq_tipo_ordem,
	a.nr_seq_evento_atend,
	a.nr_seq_tre_agenda,
	a.dt_aceite_os,
	a.ie_exclusiva,
	a.ds_just_ret_news,
	a.nr_seq_servico,
	a.cd_setor_atendimento,
	a.ds_palavra_chave,
	a.ie_envolve_treinamento,
	--SUBSTR(NVL(obter_apelido_pessoa(a.cd_pessoa_solicitante),obter_nome_pf(a.cd_pessoa_solicitante)),1,60) nm_solicitante,
	SUBSTR(man_obter_nome_apelido(a.cd_pessoa_solicitante),1,60) nm_solicitante,
	c.ds_equipamento,
	c.nr_seq_planej nr_seq_planej_equip,
	c.nr_seq_trab nr_seq_trab_equip,
	c.cd_impacto,
	coalesce(a.nr_grupo_trabalho, c.nr_seq_trab) nr_seq_trab,
	d.ds_localizacao,
	d.cd_setor,
	SUBSTR(obter_nome_setor(d.cd_setor),1,255) ds_setor_localizacao,
	SUBSTR(obter_valor_dominio(1046, a.ie_prioridade),1,20) ds_prioridade,
	SUBSTR(obter_valor_dominio(1046, a.ie_prioridade_cliente),1,20) ds_prioridade_cliente,
	SUBSTR(obter_valor_dominio(1091, a.ie_tipo_ordem),1,40) ds_ordem,
  	SUBSTR(obter_valor_dominio(1279, a.ie_status_ordem),1,20) ds_situacao,
	c.cd_imobilizado,
	c.ie_propriedade,
	d.ie_terceiro,
	SUBSTR(obter_nome_usuario_exec2(a.nr_sequencia, a.nr_seq_estagio, a.nm_usuario_exec),1,60) nm_usuario_exec_prev,
	--SUBSTR(obter_nome_usuario_exec(a.nr_sequencia),1,60) nm_usuario_exec_prev,
	SUBSTR(obter_desc_grupo_trab(a.nr_grupo_trabalho),1,60) ds_grupo_trabalho,
	SUBSTR(obter_desc_grupo_planej(a.nr_grupo_planej),1,60) ds_grupo_planej,
	SUBSTR(obter_desc_tipo_solucao(a.nr_seq_tipo_solucao),1,60) ds_tipo_solucao,
	SUBSTR(obter_desc_estagio_proc(a.nr_seq_estagio),1,60) ds_estagio,
	coalesce(SUBSTR(obter_desc_grupo_desen(a.nr_seq_grupo_des),1,60),'OS '|| a.nr_sequencia) ds_grupo_des,
	SUBSTR(Obter_Gerencia_grupo_desen(a.nr_seq_grupo_des, 'D'),1,60) ds_gerencia_des,
	somente_numero(Obter_Gerencia_grupo_desen(a.nr_seq_grupo_des, 'C')) nr_seq_gerencia_des,
	SUBSTR(obter_desc_grupo_suporte(a.nr_seq_grupo_sup),1,60) ds_grupo_sup,
	SUBSTR(obter_valor_dominio(1149, a.ie_classificacao),1,20) ds_classificacao,
	SUBSTR(obter_valor_dominio(1149, a.ie_classificacao_cliente),1,20) ds_classificacao_cliente,
	SUBSTR(man_obter_desc_causa_dano(a.nr_seq_causa_dano),1,60) ds_causa_dano,
	SUBSTR(obter_desc_funcao(a.cd_funcao),1,80) ds_funcao,
	TRUNC(dt_ordem_servico -1,'d') dt_inicio_semana,
	TRUNC(dt_ordem_servico,'month') dt_inicio_mes,
	TRUNC(dt_ordem_servico,'year') dt_ano,
	d.cd_estabelecimento,
	SUBSTR(obter_nome_estabelecimento(d.cd_estabelecimento),1,255) ds_estab_localiz,
	c.nr_seq_tipo_equip,
	SUBSTR(man_obter_fone_assist_tecnica(cd_cnpj),1,80) ds_fone_assist_tecnica,
	man_obter_min_ordem_prev(a.nr_sequencia) qt_minutos_previsto,
	SUBSTR(obter_compl_pj(d.cd_cnpj, 3, 'CI'),1,200) ds_cidade,
	d.cd_cnpj,
	SUBSTR(man_obter_dados_classif(a.nr_seq_classif_gestao,'D'),1,100) ds_classif_gestao,
	SUBSTR(proj_obter_dados_ordem_serv(a.nr_sequencia, 'PROJ'),1,10) nr_seq_proj_vinc,
	SUBSTR(proj_obter_dados_ordem_serv(a.nr_sequencia, 'PROJD'),1,10) nr_seq_proj_orig,
	SUBSTR(proj_obter_dados_ordem_serv(a.nr_sequencia, 'PROJA'),1,10) nr_seq_proj_acomp,
	SUBSTR(obter_valor_dominio(3299, a.ie_origem_os),1,20) ds_origem_os,
	c.nr_serie,
	c.cd_imobilizado_ext,
	SUBSTR(obter_gerencia_grupo_sup(a.nr_seq_grupo_sup,'D'),1,100) ds_gerencia_sup,
	somente_numero(obter_gerencia_grupo_sup(a.nr_seq_grupo_sup,'C')) nr_seq_gerencia_sup,
	SUBSTR(man_obter_dados_catal_servico(a.nr_seq_cs,'D'),1,255) ds_servico_catalogo,
	SUBSTR(man_obter_dados_catal_servico(a.nr_seq_cs,'DT'),1,255) ds_tipo_servico_catalogo,
	SUBSTR(obter_dados_setor(a.cd_setor_atendimento,'DS'),1,255) ds_setor_atendimento,
	a.nr_seq_tipo_ocor,
	a.dt_liberacao,
	a.dt_aprovacao,
	a.dt_inicio_analise_qual_soft,
	a.dt_fim_analise_qual_soft,
	a.nm_usuario_analise_qual_soft,
	a.ie_escala_email_sup,
	a.nr_seq_confidencialidade,
	a.nr_seq_pend_classif_gpw,
	a.nr_versao_cliente_abertura,
	a.nr_seq_integracao,
	coalesce(d.ie_webservice,'N') ie_ws_localizacao,
	a.nr_seq_grupo_teste,
	c.cd_controle,
	a.ie_plataforma,
	a.dt_versao_prev,
	a.ds_estagio_philips,
	obter_dados_pf_pj(null,d.cd_cnpj,'P') nr_seq_pais,
	cd_tasy_version,
	nr_service_pack,
	coalesce(a.ie_complaint, 'N') ie_complaint,
	a.cd_trackwise_id,
	a.nr_seq_severidade_wheb,
	a.ie_origem,
	a.nr_seq_tp_classif,
	a.nr_seq_classif_cad
FROM man_ordem_servico a
LEFT OUTER JOIN man_equipamento c ON (a.nr_seq_equipamento = c.nr_sequencia)
LEFT OUTER JOIN man_localizacao d ON (a.nr_seq_localizacao = d.nr_sequencia);

