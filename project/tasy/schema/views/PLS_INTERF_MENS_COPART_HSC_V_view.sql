-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_interf_mens_copart_hsc_v (tp_registro, nr_seq_subestipulante, nm_subestipulante, cd_usuario_plano_tit, nm_titular, cd_usuario_plano, nm_beneficiario, cd_guia, dt_atendimento, dt_liberacao_guia, nm_medico, qt_procedimento, cd_procedimento, ds_procedimento, vl_coparticipacao, nm_usuario) AS select	1 tp_registro,
	substr(a.nr_sequencia,1,4) nr_seq_subestipulante, 
	substr(obter_nome_pf_pj(a.cd_pessoa_fisica, a.cd_cgc),1,34) nm_subestipulante, 
	substr(CASE WHEN b.nr_seq_titular IS NULL THEN  d.cd_usuario_plano  ELSE pls_obter_dados_segurado(b.nr_seq_titular, 'C') END ,1,15) cd_usuario_plano_tit, 
	substr(CASE WHEN b.nr_seq_titular IS NULL THEN  e.nm_pessoa_fisica  ELSE pls_obter_dados_segurado(b.nr_seq_titular, 'N') END ,1,91) nm_titular, 
	substr(pls_obter_dados_segurado(b.nr_sequencia,'C'),1,15) cd_usuario_plano, 
	substr(e.nm_pessoa_fisica,1,70) nm_beneficiario, 
	substr(h.cd_guia,1,10) cd_guia, 
	h.dt_atendimento, 
	pls_obter_dados_lib_guia(h.nr_seq_guia,'DL') dt_liberacao_guia, 
	substr(obter_nome_medico(h.cd_medico_executor,'N'),1,30) nm_medico, 
    substr(pls_obter_dados_conta_proc(i.nr_seq_conta_proc,'QL'),1,10) qt_procedimento, 
	coalesce(substr(pls_obter_dados_conta_proc(i.nr_seq_conta_proc,'C'),1,8), substr(pls_obter_dados_conta_mat(i.nr_seq_conta_mat,'C'),1,8)) cd_procedimento, 
	coalesce(substr(pls_obter_dados_conta_proc(i.nr_seq_conta_proc,'D'),1,80), substr(pls_obter_dados_conta_mat(i.nr_seq_conta_mat,'D'),1,80)) ds_procedimento, 
	campo_mascara_virgula(i.vl_coparticipacao) vl_coparticipacao, 
	c.nm_usuario 
FROM pls_conta_coparticipacao i, pls_conta h, pls_mensalidade_seg_item g, pls_mensalidade_segurado f, pessoa_fisica e, pls_segurado_carteira d, w_pls_interface_mens c, pls_segurado b
LEFT OUTER JOIN pls_sub_estipulante a ON (b.nr_seq_subestipulante = a.nr_sequencia)
WHERE e.cd_pessoa_fisica	= b.cd_pessoa_fisica and b.nr_sequencia 		= c.nr_seq_segurado and b.nr_sequencia 		= d.nr_seq_segurado and b.nr_sequencia		= f.nr_seq_segurado and f.nr_sequencia		= c.nr_seq_mensalidade_seg and f.nr_sequencia		= g.nr_seq_mensalidade_seg and h.nr_sequencia		= g.nr_seq_conta and h.nr_sequencia		= i.nr_seq_conta and g.ie_tipo_item 		= '3' order by nm_beneficiario, cd_procedimento;

