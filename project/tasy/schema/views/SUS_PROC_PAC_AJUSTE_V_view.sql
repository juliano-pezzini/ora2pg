-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW sus_proc_pac_ajuste_v (dt_conta, cd_item, cd_unidade_medida, dt_acerto_conta, nr_interno_conta, qt_item, qt_real, dt_procedimento, cd_medico_executor, nm_medico, nr_atendimento, cd_setor_atendimento, cd_procedimento, ds_item, ie_auditoria, ie_origem_proced, cd_medico_req, nr_seq_proc_interno, nr_doc_convenio, ie_tecnica_utilizada, nr_cirurgia, nr_seq_exame, ie_funcao_medico, ie_via_acesso, cd_pessoa_fisica) AS select	To_Char(a.dt_conta,'dd/mm/yyyy') dt_conta,
	a.cd_procedimento cd_item,
	'' cd_unidade_medida,
	a.dt_acerto_conta,
	a.nr_interno_conta,
	sum(a.qt_procedimento) qt_item,
	sum(a.qt_procedimento) qt_real,
	max(a.dt_conta) dt_procedimento,
	a.cd_medico_executor,
	c.nm_pessoa_fisica nm_medico,
	a.nr_atendimento,
	a.cd_setor_atendimento,
	a.cd_procedimento,
	d.ds_procedimento ds_item,
	a.ie_auditoria,
	a.ie_origem_proced,
	a.cd_medico_req,
	a.nr_seq_proc_interno,
	a.nr_doc_convenio,
	a.ie_tecnica_utilizada,
	a.nr_cirurgia,
	a.nr_seq_exame,
	a.ie_funcao_medico,
	a.ie_via_acesso,
	a.cd_pessoa_fisica
FROM procedimento d, conta_paciente b, procedimento_paciente a
LEFT OUTER JOIN pessoa_fisica c ON (a.cd_medico_executor = c.cd_pessoa_fisica)
WHERE a.cd_motivo_exc_conta is null and a.nr_interno_conta = b.nr_interno_conta  and b.ie_status_acerto = 1 and d.cd_procedimento = a.cd_procedimento and d.ie_origem_proced	= a.ie_origem_proced group by	to_char(a.dt_conta,'dd/mm/yyyy'),
	a.cd_procedimento,
	a.dt_acerto_conta,
	a.nr_interno_conta,
	a.cd_medico_executor,
	c.nm_pessoa_fisica,
	a.nr_atendimento,
	a.cd_setor_atendimento,
	a.cd_procedimento,
	d.ds_procedimento,
	a.ie_auditoria,
	a.ie_origem_proced,
	a.cd_medico_req,
	a.nr_seq_proc_interno,
	a.nr_doc_convenio,
	a.ie_tecnica_utilizada,
	a.nr_cirurgia,
	a.nr_seq_exame,
	a.ie_funcao_medico,
	a.ie_via_acesso,
	a.cd_pessoa_fisica
having 	sum(a.qt_procedimento) <> 0;

