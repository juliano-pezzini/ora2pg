-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW man_lista_triagem_v (ie_tipo, ds_tipo, nr_sequencia, dt_ordem_servico, ds_dano_breve, ds_localizacao, nm_solicitante, ds_classificacao, ds_grupo_des, ds_estagio, ds_funcao, ie_classificacao, ie_status_ordem, ds_pacote, ds_dano, nr_grupo_trabalho, nr_grupo_planej, nm_exec, nr_seq_estagio, nr_seq_gerencia, nr_seq_grupo_des) AS select	'ATR' ie_tipo,
	'Atrasada' ds_tipo, 
	a.nr_sequencia nr_sequencia, 
	a.dt_ordem_servico dt_ordem_servico, 
	a.ds_dano_breve ds_dano_breve, 
	a.ds_localizacao ds_localizacao, 
	a.nm_solicitante nm_solicitante, 
	a.ds_classificacao ds_classificacao, 
	a.ds_grupo_des ds_grupo_des, 
	a.ds_estagio ds_estagio, 
	a.ds_funcao ds_funcao, 
	a.ie_classificacao ie_classificacao, 
	a.ie_status_ordem ie_status_ordem, 
	substr(des_obter_pacote_os(a.nr_sequencia,2),1,20) ds_pacote, 
	a.ds_dano ds_dano, 
	a.nr_grupo_trabalho nr_grupo_trabalho, 
	a.nr_grupo_planej nr_grupo_planej, 
	substr(obter_nome_usuario(obter_nome_usuario_exec(a.nr_sequencia)),1,40) nm_exec, 
	a.nr_seq_estagio nr_seq_estagio, 
	c.nr_seq_gerencia nr_seq_gerencia, 
	c.nr_sequencia nr_seq_grupo_des 
FROM	grupo_desenvolvimento c, 
	man_estagio_processo b, 
	man_ordem_servico_v a, 
	man_ordem_ativ_prev e 
where	a.nr_seq_estagio = b.nr_sequencia 
and	a.nr_sequencia = e.nr_seq_ordem_serv 
and	a.ie_status_ordem <> 3 
and	(a.nr_seq_grupo_des = c.nr_sequencia AND b.ie_desenv = 'S') 
and	exists (	select	 1 
		from	 man_ordem_servico_exec y 
		where	 y.nr_seq_ordem	= a.nr_sequencia 
		and	 y.dt_fim_execucao is null) 
and	not exists(	select	1 
			from	grupo_desenvolvimento y, 
				 usuario_grupo_des w, 
				man_ordem_ativ_prev x 
			where	x.nr_seq_ordem_serv	= a.nr_sequencia 
			and	y.nr_sequencia		= w.nr_seq_grupo 
			and	x.nm_usuario_prev	= w.nm_usuario_grupo 
			and	x.dt_prevista >= trunc(LOCALTIMESTAMP,'dd') 
			and	((x.dt_real is null) or (trunc(x.dt_real) = trunc(LOCALTIMESTAMP)))) 
and	exists (	select	1 
		from	grupo_desenvolvimento y, 
			usuario_grupo_des w, 
			man_ordem_ativ_prev x 
		where	x.nr_seq_ordem_serv	= a.nr_sequencia 
		and	y.nr_sequencia		= w.nr_seq_grupo 
		and	x.nm_usuario_prev	= w.nm_usuario_grupo 
		and	x.dt_prevista is not null 
		and	x.dt_prevista	< trunc(LOCALTIMESTAMP,'dd')) 

union
 
select	'SDP' ie_tipo, 
	'Sem data prevista' ds_tipo, 
	a.nr_sequencia nr_sequencia, 
	a.dt_ordem_servico dt_ordem_servico, 
	a.ds_dano_breve ds_dano_breve, 
	a.ds_localizacao ds_localizacao, 
	a.nm_solicitante nm_solicitante, 
	a.ds_classificacao ds_classificacao, 
	a.ds_grupo_des ds_grupo_des, 
	a.ds_estagio ds_estagio, 
	a.ds_funcao ds_funcao, 
	a.ie_classificacao ie_classificacao, 
	a.ie_status_ordem ie_status_ordem, 
	substr(des_obter_pacote_os(a.nr_sequencia,2),1,20) ds_pacote, 
	a.ds_dano ds_dano, 
	a.nr_grupo_trabalho nr_grupo_trabalho, 
	a.nr_grupo_planej nr_grupo_planej, 
	substr(obter_nome_usuario(obter_nome_usuario_exec(a.nr_sequencia)),1,40) nm_exec, 
	a.nr_seq_estagio nr_seq_estagio, 
	c.nr_seq_gerencia nr_seq_gerencia, 
	c.nr_sequencia nr_seq_grupo_des 
from	grupo_desenvolvimento c, 
	man_estagio_processo b, 
	man_ordem_servico_v a, 
	man_ordem_ativ_prev e 
where	a.nr_seq_estagio = b.nr_sequencia 
and	a.nr_sequencia = e.nr_seq_ordem_serv 
and	a.ie_status_ordem <> 3 
and	(a.nr_seq_grupo_des = c.nr_sequencia AND b.ie_desenv = 'S') 
and	  exists (	select	1 
		from	grupo_desenvolvimento y, 
			usuario_grupo_des w, 
			man_ordem_ativ_prev x 
		where	x.nr_seq_ordem_serv = a.nr_sequencia 
		and	y.nr_sequencia		 = a.nr_seq_grupo_des 
		and	y.nr_sequencia		 = w.nr_seq_grupo 
		and	w.nm_usuario_grupo	 = x.nm_usuario_prev 
		and	x.dt_prevista is null 
		and	x.dt_real is null) 

union
 
select	'ATR' ie_tipo, 
	'Atrasada' ds_tipo, 
	a.nr_sequencia nr_sequencia, 
	a.dt_ordem_servico dt_ordem_servico, 
	a.ds_dano_breve ds_dano_breve, 
	a.ds_localizacao ds_localizacao, 
	a.nm_solicitante nm_solicitante, 
	a.ds_classificacao ds_classificacao, 
	a.ds_grupo_des ds_grupo_des, 
	a.ds_estagio ds_estagio, 
	a.ds_funcao ds_funcao, 
	a.ie_classificacao, 
	a.ie_status_ordem, 
	substr(des_obter_pacote_os(a.nr_sequencia,2),1,20) ds_pacote, 
	a.ds_dano, 
	a.nr_grupo_trabalho, 
	a.nr_grupo_planej, 
	substr(obter_nome_usuario(obter_nome_usuario_exec(a.nr_sequencia)),1,40) nm_exec, 
	a.nr_seq_estagio, 
	c.nr_seq_gerencia_sup nr_seq_gerencia, 
	c.nr_sequencia nr_seq_grupo_des 
from	grupo_suporte c, 
	man_estagio_processo b, 
	man_ordem_servico_v a, 
	man_ordem_ativ_prev e 
where	a.nr_seq_estagio = b.nr_sequencia 
and	a.nr_sequencia = e.nr_seq_ordem_serv 
and	a.ie_status_ordem <> 3 
and	(a.nr_seq_grupo_des = c.nr_sequencia AND b.ie_suporte = 'S') 
and	exists (	select	 1 
		from	 man_ordem_servico_exec y 
		where	 y.nr_seq_ordem	= a.nr_sequencia 
		and	 y.dt_fim_execucao is null) 
and	not exists(	select	1 
			from	grupo_suporte y, 
				usuario_grupo_sup w, 
				man_ordem_ativ_prev x 
			where	x.nr_seq_ordem_serv	= a.nr_sequencia 
			and	y.nr_sequencia		= w.nr_seq_grupo 
			and	x.nm_usuario_prev	= w.nm_usuario_grupo 
			and	x.dt_prevista >= trunc(LOCALTIMESTAMP,'dd') 
			and	((x.dt_real is null) or (trunc(x.dt_real) = trunc(LOCALTIMESTAMP)))) 
and	exists (	select	1 
		from	grupo_suporte y, 
			usuario_grupo_sup w, 
			man_ordem_ativ_prev x 
		where	x.nr_seq_ordem_serv	= a.nr_sequencia 
		and	y.nr_sequencia		= w.nr_seq_grupo 
		and	x.nm_usuario_prev	= w.nm_usuario_grupo 
		and	x.dt_prevista is not null 
		and	x.dt_prevista	< trunc(LOCALTIMESTAMP,'dd')) 

union
 
select	'SDP' ie_tipo, 
	'Sem data prevista' ds_tipo, 
	a.nr_sequencia nr_sequencia, 
	a.dt_ordem_servico dt_ordem_servico, 
	a.ds_dano_breve ds_dano_breve, 
	a.ds_localizacao ds_localizacao, 
	a.nm_solicitante nm_solicitante, 
	a.ds_classificacao ds_classificacao, 
	a.ds_grupo_des ds_grupo_des, 
	a.ds_estagio ds_estagio, 
	a.ds_funcao ds_funcao, 
	a.ie_classificacao ie_classificacao, 
	a.ie_status_ordem ie_status_ordem, 
	substr(des_obter_pacote_os(a.nr_sequencia,2),1,20) ds_pacote, 
	a.ds_dano ds_dano, 
	a.nr_grupo_trabalho nr_grupo_trabalho, 
	a.nr_grupo_planej nr_grupo_planej, 
	substr(obter_nome_usuario(obter_nome_usuario_exec(a.nr_sequencia)),1,40) nm_exec, 
	a.nr_seq_estagio nr_seq_estagio, 
	c.nr_seq_gerencia_sup nr_seq_gerencia, 
	c.nr_sequencia nr_seq_grupo_des 
from	grupo_suporte c, 
	man_estagio_processo b, 
	man_ordem_servico_v a, 
	man_ordem_ativ_prev e 
where	a.nr_seq_estagio = b.nr_sequencia 
and	a.nr_sequencia = e.nr_seq_ordem_serv 
and	a.ie_status_ordem <> 3 
and	(a.nr_seq_grupo_des = c.nr_sequencia AND b.ie_suporte = 'S') 
and	  exists (	select	1 
		from	grupo_suporte y, 
			usuario_grupo_sup w, 
			man_ordem_ativ_prev x 
		where	x.nr_seq_ordem_serv = a.nr_sequencia 
		and	y.nr_sequencia		 = a.nr_seq_grupo_des 
		and	y.nr_sequencia		 = w.nr_seq_grupo 
		and	w.nm_usuario_grupo	 = x.nm_usuario_prev 
		and	x.dt_prevista is null 
		and	x.dt_real is null);

