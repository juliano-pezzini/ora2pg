-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW lista_espera_agenda_v (nr_sequencia, ie_prioridade, cd_tipo_classificacao, ds_tipo_classificacao, cd_especialidade, ds_especialidade, ds_exame_lista, cd_estabelecimento, ds_estabelecimento, cd_medico_solicitante, nm_medico_solicitante, faixa_etaria, cd_convenio, ds_convenio, dt_agendamento, dt_desejada, ds_municipio) AS SELECT
	A.NR_SEQUENCIA,
	A.IE_PRIORIDADE,
	D.NR_SEQ_TIPO_CLASSIF_PAC CD_TIPO_CLASSIFICACAO,
	UPPER(OBTER_TIPO_CLASSIFICACAO(A.NR_SEQ_AGENDA_INT)) DS_TIPO_CLASSIFICACAO,
	A.CD_ESPECIALIDADE,
	UPPER(SUBSTR(OBTER_DESC_ESPEC_MEDICA(A.CD_ESPECIALIDADE),1,50)) DS_ESPECIALIDADE,
	UPPER(trim(both SUBSTR(OBTER_EXAME_LISTA_AGENDA(A.NR_SEQUENCIA), 1, 255))) DS_EXAME_LISTA,
	C.CD_ESTABELECIMENTO,
	UPPER(C.DS_CURTA) DS_ESTABELECIMENTO,
	A.CD_MEDICO CD_MEDICO_SOLICITANTE,
	UPPER(SUBSTR(OBTER_NOME_MEDICO(A.CD_MEDICO,'NC'),1,100)) NM_MEDICO_SOLICITANTE,
	OBTER_FAIXA_ETARIA_PF(A.CD_PESSOA_FISICA) FAIXA_ETARIA,
	A.CD_CONVENIO,
	UPPER(SUBSTR(OBTER_NOME_CONVENIO(A.CD_CONVENIO), 1, 200)) DS_CONVENIO,
	A.DT_AGENDAMENTO,
	A.DT_DESEJADA,
	UPPER(trim(both SUBSTR(OBTER_MUNICIPIO_PF(A.CD_PESSOA_FISICA), 1, 255))) DS_MUNICIPIO
FROM 	AGENDA_LISTA_ESPERA A
	LEFT JOIN AGENDA B
	ON A.CD_AGENDA = B.CD_AGENDA
	LEFT JOIN ESTRUTURA_ORGANIZACIONAL C
	ON  B.CD_ESTABELECIMENTO = C.CD_ESTABELECIMENTO
	LEFT JOIN AGENDA_INTEGRADA D
	ON D.NR_SEQUENCIA = A.NR_SEQ_AGENDA_INT
ORDER BY A.IE_PRIORIDADE,
	A.DT_AGENDAMENTO;

