-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_autorizacao_convenio_v (qt_autorizacao, ds_convenio, ds_medico_solicitante, ds_procedimento, ds_estagio, dt_autorizacao, qt_horas_retorno, qt_dias_retorno, ds_tipo_autorizacao, nm_paciente, ds_classificacao, cd_estabelecimento, dt_inicio_vigencia, nm_usuario_autor) AS select	count(*) qt_autorizacao,
	substr(obter_desc_convenio(a.cd_convenio),1,255) ds_convenio, 
	substr(obter_nome_pf_pj(a.cd_medico_solicitante, null),1,255) ds_medico_solicitante, 
	substr(obter_descricao_procedimento(a.cd_procedimento_principal, a.ie_origem_proced),1,255) ds_procedimento, 
	ds_estagio, 
	a.dt_autorizacao, 
	round((obter_hora_entre_datas(a.dt_envio, a.dt_retorno))::numeric,2) qt_horas_retorno, 
	obter_dias_entre_datas(a.dt_envio, a.dt_retorno) qt_dias_retorno, 
	substr(obter_valor_dominio(1377,a.ie_tipo_autorizacao),1,150) ds_tipo_autorizacao, 
	substr(obter_nome_pessoa_fisica(c.cd_pessoa_fisica,null),1,255) nm_paciente, 
	coalesce(d.ds_classificacao,'Não Informada') ds_classificacao, 
	c.cd_estabelecimento, 
	a.dt_inicio_vigencia, 
	substr(obter_usuario_autorizador(a.nr_sequencia),1,15) nm_usuario_autor 
FROM atendimento_paciente c, estagio_autorizacao b, autorizacao_convenio a
LEFT OUTER JOIN classif_autorizacao d ON (a.nr_seq_classif = d.nr_sequencia)
WHERE a.nr_seq_estagio	= b.nr_sequencia  and a.nr_atendimento 	= c.nr_atendimento and dt_envio		is not null and dt_retorno		is not null and dt_retorno		> dt_envio group by 
	substr(obter_desc_convenio(a.cd_convenio),1,255), 
	substr(obter_nome_pf_pj(a.cd_medico_solicitante, null),1,255), 
	substr(obter_descricao_procedimento(a.cd_procedimento_principal, a.ie_origem_proced),1,255), 
	ds_estagio, 
	a.dt_autorizacao, 
	round((obter_hora_entre_datas(a.dt_envio, a.dt_retorno))::numeric,2), 
	obter_dias_entre_datas(a.dt_envio, a.dt_retorno), 
	substr(obter_valor_dominio(1377,a.ie_tipo_autorizacao),1,150), 
	substr(obter_nome_pessoa_fisica(c.cd_pessoa_fisica,null),1,255), 
	d.ds_classificacao, 
	c.cd_estabelecimento, 
	a.dt_inicio_vigencia, 
	substr(obter_usuario_autorizador(a.nr_sequencia),1,15) 

union
 
select	count(*) qt_autorizacao, 
	substr(obter_desc_convenio(a.cd_convenio),1,255) ds_convenio, 
	substr(obter_nome_pf_pj(a.cd_medico_solicitante, null),1,255) ds_medico_solicitante, 
	substr(obter_descricao_procedimento(a.cd_procedimento_principal, a.ie_origem_proced),1,255) ds_procedimento, 
	ds_estagio, 
	a.dt_autorizacao, 
	round((obter_hora_entre_datas(a.dt_envio, a.dt_retorno))::numeric,2) qt_horas_retorno, 
	OBTER_DIAS_ENTRE_DATAS(a.dt_envio, a.dt_retorno) qt_dias_retorno, 
	substr(obter_valor_dominio(1377,a.ie_tipo_autorizacao),1,150) ds_tipo_autorizacao, 
	substr(obter_nome_pessoa_fisica(d.cd_pessoa_fisica,null),1,255) nm_paciente, 
	coalesce(e.ds_classificacao,'Não Informada') ds_classificacao, 
	f.cd_estabelecimento, 
	a.dt_inicio_vigencia, 
	substr(obter_usuario_autorizador(a.nr_sequencia),1,15) nm_usuario_autor 
FROM agenda f, agenda_paciente d, estagio_autorizacao b, autorizacao_convenio a
LEFT OUTER JOIN classif_autorizacao e ON (a.nr_seq_classif = e.nr_sequencia)
WHERE a.nr_seq_estagio	= b.nr_sequencia  and a.nr_seq_agenda 	= d.nr_sequencia and d.cd_agenda		= f.cd_agenda and dt_envio		is not null and dt_retorno		is not null and dt_retorno		> dt_envio group by 
	substr(obter_desc_convenio(a.cd_convenio),1,255), 
	substr(obter_nome_pf_pj(a.cd_medico_solicitante, null),1,255), 
	substr(obter_descricao_procedimento(a.cd_procedimento_principal, a.ie_origem_proced),1,255), 
	ds_estagio, 
	a.dt_autorizacao, 
	round((obter_hora_entre_datas(a.dt_envio, a.dt_retorno))::numeric,2), 
	obter_dias_entre_datas(a.dt_envio, a.dt_retorno), 
	substr(obter_valor_dominio(1377,a.ie_tipo_autorizacao),1,150), 
	substr(obter_nome_pessoa_fisica(d.cd_pessoa_fisica,null),1,255), 
	e.ds_classificacao, 
	f.cd_estabelecimento, 
	a.dt_inicio_vigencia, 
	substr(obter_usuario_autorizador(a.nr_sequencia),1,15);

