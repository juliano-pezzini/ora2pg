-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW can_registro_hosp_cancer_v (nr_seq, nr_prontuario, nm_paciente, ie_sexo, qt_idade, ie_estado_civil, ds_estado_civil, nr_seq_cor_pele, ds_cor_pele, ds_faixa_etaria, nr_cep_cidade_nasc, ds_cidade_natal, ie_grau_instrucao, ds_grau_instrucao, ie_diag_trat_previo, ds_diag_trat_prev, cd_morfologia_tu_prim, ds_morfologia_tuprim, cd_estadio, cd_clinica_entrada, ds_clinica_entrada, cd_clinica_atendimento, ds_clinica_atendimento, cd_razao_nao_trat, ds_razao_nao_trat, nr_seq_estado_pac, ds_estado_paciente, nr_seq_base_diag, ds_base_diag, nr_seq_origem_enc, ds_origem_encaminhamento, ds_profissao, cd_municipio_ibge, ds_municipio_ibge, dt_filtro, nr_seq_morf_desc_prim, nr_seq_morf_desc_metast) AS select	1 nr_seq,
	a.nr_prontuario,
	substr(j.nm_pessoa_fisica,1,100) nm_paciente,
	j.ie_sexo,
	(substr(obter_idade_pf(j.cd_pessoa_fisica, LOCALTIMESTAMP, 'A'),1,10))::numeric  qt_idade,
	j.ie_estado_civil,
	substr(obter_valor_dominio(5,j.ie_estado_civil),1,100) ds_estado_civil,
	j.nr_seq_cor_pele,
	substr(obter_desc_cor_pele(j.nr_seq_cor_pele),1,50) ds_cor_pele,
	substr(obter_faixa_etaria_pf(j.cd_pessoa_fisica),1,10) ds_faixa_etaria,
	j.nr_cep_cidade_nasc,
	substr(obter_desc_cep_loc(j.nr_cep_cidade_nasc),1,240) ds_cidade_natal,
	j.ie_grau_instrucao,
	substr(obter_valor_dominio(10,j.ie_grau_instrucao),1,100) ds_grau_instrucao,
	a.ie_diag_trat_previo,
	i.ds_tratamento ds_diag_trat_prev,
	a.cd_morfologia_tu_prim,
	(select	max(ds_morfologia) FROM cido_morfologia where ie_situacao = 'A' and cd_morfologia = a.cd_morfologia_tu_prim) ds_morfologia_tuprim,
	a.cd_estadio,
	a.cd_clinica_entrada,
	f.ds_clinica ds_clinica_entrada,
	a.cd_clinica_atendimento,
	g.ds_clinica ds_clinica_atendimento,
	a.cd_razao_nao_trat,
	b.ds_razao ds_razao_nao_trat,
	d.nr_sequencia nr_seq_estado_pac,
	d.ds_estado ds_estado_paciente,
	e.nr_sequencia nr_seq_base_diag,
	e.ds_base_diag,
	a.nr_seq_origem_enc,
	h.ds_origem ds_origem_encaminhamento,
	substr(obter_compl_pf(j.cd_pessoa_fisica,1,'P'),1,100) ds_profissao,
	j.cd_municipio_ibge,
	substr(obter_desc_municipio_ibge(j.cd_municipio_ibge),1.100) ds_municipio_ibge,
	a.dt_preench_ficha dt_filtro,
  a.NR_SEQ_MORF_DESC_PRIM,
  a.NR_SEQ_MORF_DESC_METAST
FROM can_ficha_admissao a
LEFT OUTER JOIN pessoa_fisica j ON (a.cd_pessoa_fisica = j.cd_pessoa_fisica)
LEFT OUTER JOIN can_trat_previo i ON (a.ie_diag_trat_previo = i.nr_sequencia)
LEFT OUTER JOIN can_origem_encaminhamento h ON (a.nr_seq_origem_enc = h.nr_sequencia)
LEFT OUTER JOIN clinica_reg_hosp_cancer g ON (a.cd_clinica_atendimento = g.nr_sequencia)
LEFT OUTER JOIN clinica_reg_hosp_cancer f ON (a.cd_clinica_entrada = f.nr_sequencia)
LEFT OUTER JOIN can_base_diag e ON (a.cd_base_diag = e.nr_sequencia)
LEFT OUTER JOIN can_estado_paciente d ON (a.ie_estado_pac_fim_trat = d.nr_sequencia)
LEFT OUTER JOIN can_razao_nao_trat b ON (a.cd_razao_nao_trat = b.nr_sequencia)
WHERE 1 = 1         order by	2;

