-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_segreg_desp_grupo_diops_v (ie_tipo_doc, nr_sequencia, vl_total, vl_liberado, vl_glosa, vl_coparticipacao, ie_cobertura, nr_seq_grupo_ans, dt_mes_comp_protocolo, ie_tipo_vinculo_operadora, ie_tipo_segurado, ie_tipo_relacao, nr_seq_proc_mat, vl_conta, nr_seq_apresentacao, ds_grupo, ds_grupo_diops, ds_dados_produto, ds_tipo_prestador, ie_sit_protocolo, ie_tipo_contratacao, ie_preco, ie_regulamentacao, ie_tipo_protocolo) AS select	distinct
	0 ie_tipo_doc,
	a.nr_sequencia,
	coalesce(g.vl_liberado,0) vl_total,
	coalesce(g.vl_liberado,0) vl_liberado,
	coalesce(g.vl_glosa,0) vl_glosa,
	0 vl_coparticipacao,
	lpad(e.ie_segmentacao,2,0) ie_cobertura,
	coalesce(g.nr_seq_grupo_ans, -1) nr_seq_grupo_ans,
	f.dt_mes_competencia dt_mes_comp_protocolo,
	b.ie_tipo_vinculo_operadora,
	b.ie_tipo_segurado,
	d.ie_tipo_relacao,
	g.nr_sequencia nr_seq_proc_mat,
	a.vl_total vl_conta,
	coalesce(h.nr_seq_apresentacao,9999999999) nr_seq_apresentacao,
	coalesce(h.ds_grupo,'Outras despesas') ds_grupo,
	CASE WHEN h.ie_tipo_grupo_ans='10' THEN 'Consultas' WHEN h.ie_tipo_grupo_ans='20' THEN 'Exames' WHEN h.ie_tipo_grupo_ans='30' THEN 'Terapias' WHEN h.ie_tipo_grupo_ans='41' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='42' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='43' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='44' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='45' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='46' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='49' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='50' THEN 'Outros atendimentos' WHEN h.ie_tipo_grupo_ans='60' THEN 'Demais despesas' END  ds_grupo_diops,
	substr(obter_valor_dominio(1666,e.ie_tipo_contratacao),1,30) || '-' ||
	substr(obter_valor_dominio(1669,e.ie_preco),1,30) || '-' ||
	CASE WHEN e.ie_regulamentacao='R' THEN 'Não regulamentado'  ELSE 'Regulamentado' END  ds_dados_produto,
	CASE WHEN f.ie_tipo_protocolo='I' THEN 'Intercâmbio' WHEN f.ie_tipo_protocolo='R' THEN 'Reembolso'  ELSE (select	CASE WHEN x.ie_tipo_relacao='P' THEN 'Rede Própria'  ELSE 'Rede contratada' END 	FROM	pls_prestador x	where	x.nr_sequencia = a.nr_seq_prestador_exec) END  ds_tipo_prestador,
	f.ie_situacao ie_sit_protocolo,
	e.ie_tipo_contratacao,
	e.ie_preco,
	e.ie_regulamentacao,
	f.ie_tipo_protocolo
FROM pls_plano e, pls_conta a, pls_segurado b
LEFT OUTER JOIN pls_contrato c ON (b.nr_seq_contrato = c.nr_sequencia)
, pls_protocolo_conta f
LEFT OUTER JOIN pls_prestador d ON (f.nr_seq_prestador = d.nr_sequencia)
, pls_conta_proc g
LEFT OUTER JOIN ans_grupo_despesa h ON (g.nr_seq_grupo_ans = h.nr_sequencia)
WHERE b.nr_sequencia		= a.nr_seq_segurado  and f.nr_sequencia		= a.nr_seq_protocolo  and e.nr_sequencia		= b.nr_seq_plano and g.nr_seq_conta		= a.nr_sequencia --and	i.nr_seq_conta_proc(+)	= g.nr_sequencia
  and g.ie_status		<> 'D' --and	f.ie_tipo_protocolo	in ('C','I','R')
  and ((f.ie_tipo_protocolo = 'R') or (b.ie_tipo_segurado not in ('T','C','I','H') and
	f.ie_tipo_protocolo <> 'R') or (b.ie_tipo_segurado in ('T','C','I','H') and
	f.ie_tipo_protocolo <> 'R'))
union

select	distinct
	0 ie_tipo_doc,
	a.nr_sequencia,
	coalesce(g.vl_liberado,0) vl_total,
	coalesce(g.vl_liberado,0) vl_liberado,
	coalesce( g.vl_glosa,0) vl_glosa,
	0 vl_coparticipacao,
	lpad(e.ie_segmentacao,2,0) ie_cobertura,
	coalesce(g.nr_seq_grupo_ans, -1) nr_seq_grupo_ans,
	f.dt_mes_competencia dt_mes_comp_protocolo,
	b.ie_tipo_vinculo_operadora ,
	b.ie_tipo_segurado,
	d.ie_tipo_relacao,
	g.nr_sequencia nr_seq_proc_mat,
	a.vl_total vl_conta,
	coalesce(h.nr_seq_apresentacao,9999999999) nr_seq_apresentacao,
	coalesce(h.ds_grupo,'Outras despesas') ds_grupo,
	CASE WHEN h.ie_tipo_grupo_ans='10' THEN 'Consultas' WHEN h.ie_tipo_grupo_ans='20' THEN 'Exames' WHEN h.ie_tipo_grupo_ans='30' THEN 'Terapias' WHEN h.ie_tipo_grupo_ans='41' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='42' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='43' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='44' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='45' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='46' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='49' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='50' THEN 'Outros atendimentos' WHEN h.ie_tipo_grupo_ans='60' THEN 'Demais despesas' END  ds_grupo_diops,
	substr(obter_valor_dominio(1666,e.ie_tipo_contratacao),1,30) || '-' ||
	substr(obter_valor_dominio(1669,e.ie_preco),1,30) || '-' ||
	CASE WHEN e.ie_regulamentacao='R' THEN 'Não regulamentado'  ELSE 'Regulamentado' END  ds_dados_produto,
	CASE WHEN f.ie_tipo_protocolo='I' THEN 'Intercâmbio' WHEN f.ie_tipo_protocolo='R' THEN 'Reembolso'  ELSE (select	CASE WHEN x.ie_tipo_relacao='P' THEN 'Rede Própria'  ELSE 'Rede contratada' END 	from	pls_prestador x	where	x.nr_sequencia = a.nr_seq_prestador_exec) END  ds_tipo_prestador,
	f.ie_situacao ie_sit_protocolo,
	e.ie_tipo_contratacao,
	e.ie_preco,
	e.ie_regulamentacao,
	f.ie_tipo_protocolo
FROM pls_plano e, pls_conta a, pls_segurado b
LEFT OUTER JOIN pls_contrato c ON (b.nr_seq_contrato = c.nr_sequencia)
, pls_protocolo_conta f
LEFT OUTER JOIN pls_prestador d ON (f.nr_seq_prestador = d.nr_sequencia)
, pls_conta_mat g
LEFT OUTER JOIN ans_grupo_despesa h ON (g.nr_seq_grupo_ans = h.nr_sequencia)
WHERE b.nr_sequencia		= a.nr_seq_segurado  and f.nr_sequencia		= a.nr_seq_protocolo  and e.nr_sequencia		= b.nr_seq_plano and g.nr_seq_conta		= a.nr_sequencia --and	i.nr_seq_conta_mat(+)	= g.nr_sequencia
  and g.ie_status		<> 'D' --and	f.ie_tipo_protocolo	in ('C','I','R')
  and ((f.ie_tipo_protocolo = 'R') or (b.ie_tipo_segurado not in ('T','C','I','H') and
	f.ie_tipo_protocolo <> 'R') or (b.ie_tipo_segurado in ('T','C','I','H') and
	f.ie_tipo_protocolo <> 'R'))  
union

select	1 ie_tipo_doc,
	null,
	coalesce(i.vl_coparticipacao,0) * -1 vl_total,
	coalesce(g.vl_liberado,0) vl_liberado,
	coalesce(g.vl_glosa,0) vl_glosa,
	0 vl_coparticipacao,
	lpad(e.ie_segmentacao,2,0) ie_cobertura,
	coalesce(g.nr_seq_grupo_ans, -1) nr_seq_grupo_ans,
	b.dt_referencia,
	f.ie_tipo_vinculo_operadora,
	f.ie_tipo_segurado,
	w.ie_tipo_relacao,
	g.nr_sequencia nr_seq_proc_mat,
	k.vl_total vl_conta,
	coalesce(h.nr_seq_apresentacao,9999999999) nr_seq_apresentacao,
	coalesce(h.ds_grupo,'Outras despesas') ds_grupo,
	CASE WHEN h.ie_tipo_grupo_ans='10' THEN 'Consultas' WHEN h.ie_tipo_grupo_ans='20' THEN 'Exames' WHEN h.ie_tipo_grupo_ans='30' THEN 'Terapias' WHEN h.ie_tipo_grupo_ans='41' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='42' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='43' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='44' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='45' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='46' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='49' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='50' THEN 'Outros atendimentos' WHEN h.ie_tipo_grupo_ans='60' THEN 'Demais despesas' END  ds_grupo_diops,
	substr(obter_valor_dominio(1666,e.ie_tipo_contratacao),1,30) || '-' ||
	substr(obter_valor_dominio(1669,e.ie_preco),1,30) || '-' ||
	CASE WHEN e.ie_regulamentacao='R' THEN 'Não regulamentado'  ELSE 'Regulamentado' END  ds_dados_produto,
	CASE WHEN j.ie_tipo_protocolo='I' THEN 'Intercâmbio' WHEN j.ie_tipo_protocolo='R' THEN 'Reembolso'  ELSE (select	CASE WHEN x.ie_tipo_relacao='P' THEN 'Rede Própria'  ELSE 'Rede contratada' END 	from	pls_prestador x	where	x.nr_sequencia = k.nr_seq_prestador_exec) END  ds_tipo_prestador,
	j.ie_situacao ie_sit_protocolo,
	e.ie_tipo_contratacao,
	e.ie_preco,
	e.ie_regulamentacao,
	j.ie_tipo_protocolo
FROM pls_conta k, pls_segurado f, pls_plano e, pls_mensalidade_segurado c, pls_mensalidade b, pls_lote_mensalidade a, pls_protocolo_conta j
LEFT OUTER JOIN pls_prestador w ON (j.nr_seq_prestador = w.nr_sequencia)
, pls_conta_proc g
LEFT OUTER JOIN pls_conta_coparticipacao i ON (g.nr_sequencia = i.nr_seq_conta_proc)
LEFT OUTER JOIN ans_grupo_despesa h ON (g.nr_seq_grupo_ans = h.nr_sequencia)
WHERE c.nr_sequencia	= i.nr_seq_mensalidade_seg and b.nr_sequencia	= c.nr_seq_mensalidade and a.nr_sequencia	= b.nr_seq_lote and e.nr_sequencia	= f.nr_seq_plano and f.nr_sequencia	= c.nr_seq_segurado and k.nr_sequencia	= g.nr_seq_conta    and j.nr_sequencia	= k.nr_seq_protocolo and j.ie_tipo_protocolo	in ('C','I','R') and g.ie_status	<> 'D' and b.ie_cancelamento is null
 
union

select	1 ie_tipo_doc,
	null,
	coalesce(i.vl_coparticipacao,0) * -1,
	coalesce(g.vl_liberado,0) vl_liberado,
	coalesce(g.vl_glosa,0) vl_glosa,
	0 vl_coparticipacao,
	lpad(e.ie_segmentacao,2,0) ie_cobertura,
	coalesce(g.nr_seq_grupo_ans, -1) nr_seq_grupo_ans,
	b.dt_referencia,
	f.ie_tipo_vinculo_operadora,
	f.ie_tipo_segurado,
	w.ie_tipo_relacao,
	g.nr_sequencia nr_seq_proc_mat,
	k.vl_total vl_conta,
	coalesce(h.nr_seq_apresentacao,9999999999) nr_seq_apresentacao,
	coalesce(h.ds_grupo,'Outras despesas') ds_grupo,
	CASE WHEN h.ie_tipo_grupo_ans='10' THEN 'Consultas' WHEN h.ie_tipo_grupo_ans='20' THEN 'Exames' WHEN h.ie_tipo_grupo_ans='30' THEN 'Terapias' WHEN h.ie_tipo_grupo_ans='41' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='42' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='43' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='44' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='45' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='46' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='49' THEN 'Internação' WHEN h.ie_tipo_grupo_ans='50' THEN 'Outros atendimentos' WHEN h.ie_tipo_grupo_ans='60' THEN 'Demais despesas' END  ds_grupo_diops,
	substr(obter_valor_dominio(1666,e.ie_tipo_contratacao),1,30) || '-' ||
	substr(obter_valor_dominio(1669,e.ie_preco),1,30) || '-' ||
	CASE WHEN e.ie_regulamentacao='R' THEN 'Não regulamentado'  ELSE 'Regulamentado' END  ds_dados_produto,
	CASE WHEN j.ie_tipo_protocolo='I' THEN 'Intercâmbio' WHEN j.ie_tipo_protocolo='R' THEN 'Reembolso'  ELSE (select	CASE WHEN x.ie_tipo_relacao='P' THEN 'Rede Própria'  ELSE 'Rede contratada' END 	from	pls_prestador x	where	x.nr_sequencia = k.nr_seq_prestador_exec) END  ds_tipo_prestador,
	j.ie_situacao ie_sit_protocolo,
	e.ie_tipo_contratacao,
	e.ie_preco,
	e.ie_regulamentacao,
	j.ie_tipo_protocolo
FROM pls_conta k, pls_segurado f, pls_plano e, pls_mensalidade_segurado c, pls_mensalidade b, pls_lote_mensalidade a, pls_protocolo_conta j
LEFT OUTER JOIN pls_prestador w ON (j.nr_seq_prestador = w.nr_sequencia)
, pls_conta_mat g
LEFT OUTER JOIN pls_conta_coparticipacao i ON (g.nr_sequencia = i.nr_seq_conta_mat)
LEFT OUTER JOIN ans_grupo_despesa h ON (g.nr_seq_grupo_ans = h.nr_sequencia)
WHERE c.nr_sequencia	= i.nr_seq_mensalidade_seg and b.nr_sequencia	= c.nr_seq_mensalidade and a.nr_sequencia	= b.nr_seq_lote and e.nr_sequencia	= f.nr_seq_plano and f.nr_sequencia	= c.nr_seq_segurado and k.nr_sequencia	= g.nr_seq_conta    and j.nr_sequencia	= k.nr_seq_protocolo and j.ie_tipo_protocolo	in ('C','I','R') and g.ie_status	<> 'D' and b.ie_cancelamento is null;

