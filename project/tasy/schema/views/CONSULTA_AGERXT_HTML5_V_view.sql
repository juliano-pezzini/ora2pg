-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW consulta_agerxt_html5_v (cd_agenda, cd_tipo_agenda, nr_seq_equipamento, cd_estabelecimento, cd_estabelecimento_ap, cd_estabelecimento_equip, nr_sequencia, dt_agenda, hr_inicio, nr_minuto_duracao, ie_status_agenda, nr_seq_classif, cd_pessoa_fisica, nm_pessoa_fisica, cd_medico, nm_pessoa_fisica_medico, cd_convenio, nr_atendimento, nr_pront_ext, cd_pessoa_fisica_ap, dt_agendamento, nm_medico_agendamento, nr_seq_status_pac) AS select	b.nr_seq_equipamento cd_agenda,	
	10 cd_tipo_agenda,
	b.nr_seq_equipamento,
	coalesce(d.cd_estabelecimento, e.cd_estabelecimento) cd_estabelecimento,	
	d.cd_estabelecimento cd_estabelecimento_ap,
	e.cd_estabelecimento cd_estabelecimento_equip,			
	b.nr_sequencia,	
	b.dt_agenda,	
	b.dt_agenda hr_inicio,
	b.nr_minuto_duracao,	
	b.ie_status_agenda,	
	b.nr_seq_classif,
	coalesce(b.cd_pessoa_fisica, rxt_obter_pf_tratamento(b.nr_seq_tratamento, null)) cd_pessoa_fisica,	
	obter_nome_pf(coalesce(b.cd_pessoa_fisica, rxt_obter_pf_tratamento(b.nr_seq_tratamento, null)))  nm_pessoa_fisica, 	
	d.cd_medico_resp cd_medico,		
	m.nm_pessoa_fisica nm_pessoa_fisica_medico,					
	null cd_convenio,
	b.nr_atendimento,		
	c.nr_pront_ext,	
	d.cd_pessoa_fisica cd_pessoa_fisica_ap,
	b.dt_agendamento,
	'' nm_medico_agendamento,
  null nr_seq_status_pac
FROM rxt_equipamento e, rxt_agenda b
LEFT OUTER JOIN pessoa_fisica c ON (b.cd_pessoa_fisica = c.cd_pessoa_fisica)
LEFT OUTER JOIN atendimento_paciente d ON (b.nr_atendimento = d.nr_atendimento)
LEFT OUTER JOIN pessoa_fisica m ON (d.cd_medico_resp = m.cd_pessoa_fisica)
WHERE b.nr_Seq_equipamento = e.nr_Sequencia;

