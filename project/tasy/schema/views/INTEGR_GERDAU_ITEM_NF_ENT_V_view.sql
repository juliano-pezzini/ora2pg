-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW integr_gerdau_item_nf_ent_v (tp_registro, dt_emissao, cd_estabelecimento, vl_registro) AS select	2	tp_registro,
	t.dt_emissao,
	t.cd_estabelecimento,
	'GG    '								||
	'FOB   '								||
	'FOB   '								||
	'L' || rpad(i.nr_sequencia, 7, ' ')						||
	lpad(i.nr_item_nf, 6, 0)						||
	rpad(i.cd_material, 20, ' ')						||
	'01'								||
	rpad(i.cd_unidade_medida_compra, 4, ' ') 				||
	rpad(coalesce(n.cd_ncm,' '), 10, ' ')						||
	'      '								||
	lpad(replace(campo_mascara(coalesce(i.qt_item_nf,0),3),'.',''),13, 0)			||
	lpad(replace(campo_mascara(coalesce(i.vl_unitario_item_nf,0),6),'.',''),16, 0)		||
	'000000000000000'							||
	lpad(replace(campo_mascara(coalesce(i.vl_total_item_nf,0),2),'.',''),15, 0)		||
	'000000000000000'							||
	rpad(' ', 14, ' ')							||
	'000000000000000'							||
	rpad(b.ds_material, 40, ' ')						||
	CASE WHEN i.cd_material IS NULL THEN  '9   '  ELSE '2   ' END  					||
	rpad(' ', 68, ' ') 							||
	lpad('0', 30, '0')							||
	'PU'								||
	substr(coalesce(o.cd_cfop, 1), 1, 1)						||
	rpad(' ', 39, ' ')							||
	'N'								||
	rpad(' ', 51, ' ')							||
	rpad('0', 45, '0')							||
	substr(i.nr_item_nf, 1, 1)						||
	'0000'								||
	rpad(' ', 136, ' ')							||
	rpad('0', 24, '0')							||
	rpad(' ', 281, ' ')							||
	'*'								vl_registro
FROM nota_fiscal t, natureza_operacao o, material b, nota_fiscal_item i
LEFT OUTER JOIN material_lote_fornec m ON (i.nr_seq_lote_fornec = m.nr_sequencia)
, lista_ncm n
LEFT OUTER JOIN material_fiscal f ON (n.nr_sequencia = f.nr_seq_ncm)
WHERE i.cd_material = b.cd_material and b.cd_material = f.cd_material  and o.CD_NATUREZA_OPERACAO = i.cd_natureza_operacao and t.nr_sequencia = i.nr_sequencia  and obter_se_nota_entrada_saida(i.nr_sequencia) = 'E';

