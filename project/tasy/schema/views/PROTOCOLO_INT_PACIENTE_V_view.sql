-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW protocolo_int_paciente_v (nr_atendimento, ie_tipo_atendimento, ds_tipo_atendimento, cd_pessoa_fisica, cd_departamento, ds_departamento, dt_inicial_protocolo, dt_final_protocolo, nr_dias_protocolos) AS select      distinct
			p.nr_atendimento_origem nr_atendimento,
			a.ie_tipo_atendimento,
            coalesce(obter_descricao_dominio(12, a.ie_tipo_atendimento), obter_desc_expressao(309956)) ds_tipo_atendimento,
			p.cd_pessoa_fisica,
            obter_departamento_data(p.nr_atendimento_origem, LOCALTIMESTAMP) cd_departamento,
            (select d.ds_departamento
            FROM    departamento_medico d
            where   d.cd_departamento = obter_departamento_data(p.nr_atendimento_origem, LOCALTIMESTAMP)) ds_departamento,
            coalesce(p.dt_inicial_real, p.dt_inicial_previsto) dt_inicial_protocolo,
            coalesce(p.dt_final_real, p.dt_final_previsto) dt_final_protocolo,
            obter_dias_entre_datas(coalesce(p.dt_inicial_real, p.dt_inicial_previsto), coalesce(p.dt_final_real, p.dt_final_previsto)) nr_dias_protocolos
from        protocolo_int_paciente p,
            atendimento_paciente a
where 	    p.ie_status in ('A', 'F')
and         a.nr_atendimento = p.nr_atendimento_origem
and         obter_departamento_data(p.nr_atendimento_origem, LOCALTIMESTAMP) is not null;

