-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW titulo_pagar_bordero_v (nr_titulo, nr_bordero, vl_bordero, cd_pessoa_fisica, cd_cgc, nr_documento, vl_desconto_bordero, vl_juros_bordero, vl_multa_bordero, vl_out_desp_bordero, vl_liquido, vl_liq_com_impostos, vl_total_bordero, ds_observacao_titulo, vl_saldo_titulo, nr_seq_trans_fin_baixa, dt_liquidacao, nr_seq_nota_fiscal, nr_repasse_terceiro, ds_beneficiario, vl_titulo, cd_estabelecimento, vl_tributos, vl_sem_tributo, vl_dia_antecipacao, cd_centro_custo, ie_situacao, cd_moeda, vl_saldo_titulo_cotacao, nr_parcelas, nr_total_parcelas, vl_outras_deducoes, dt_vencimento_atual, nr_seq_trans_financ, vl_liquido_bordero, vl_bordero_estrang, vl_cotacao, vl_complemento, cd_moeda_bordero) AS select	nr_titulo,
	nr_bordero,
	vl_bordero,
	cd_pessoa_fisica,
	cd_cgc,
	nr_documento,
	coalesce(vl_desconto_bordero,0) vl_desconto_bordero,
	coalesce(vl_juros_bordero,0) vl_juros_bordero,
	coalesce(vl_multa_bordero,0) vl_multa_bordero,
	coalesce(vl_out_desp_bordero, 0) vl_out_desp_bordero,
	coalesce(vl_bordero,0) - coalesce(vl_desconto_bordero,0) + coalesce(vl_juros_bordero,0) + coalesce(a.vl_multa_bordero,0) vl_liquido,
	coalesce((obter_dados_bordero_tit_pagar(null, a.nr_bordero, a.nr_titulo, 'VLI'))::numeric ,0) vl_liq_com_impostos,
	coalesce(vl_bordero, 0) - coalesce(vl_desconto_bordero, 0) + coalesce(vl_juros_bordero, 0) + coalesce(vl_multa_bordero, 0) + coalesce(vl_out_desp_bordero, 0) vl_total_bordero,
	ds_observacao_titulo,
	vl_saldo_titulo,
	nr_seq_trans_fin_baixa,
	dt_liquidacao,
	nr_seq_nota_fiscal,
	nr_repasse_terceiro,
	substr(obter_pessoa_titulo_pagar(nr_titulo),1,200) ds_beneficiario,
	vl_titulo,
	cd_estabelecimento,
	coalesce(obter_valor_tributo_desc_pagar(nr_titulo,nr_bordero,null),0) vl_tributos,
	coalesce(vl_bordero, 0) - coalesce(vl_desconto_bordero, 0) + coalesce(vl_juros_bordero, 0) + coalesce(vl_multa_bordero, 0) + coalesce(vl_out_desp_bordero, 0) - coalesce(obter_valor_tributo_desc_pagar(nr_titulo,nr_bordero,null),0) vl_sem_tributo,
	coalesce(vl_dia_antecipacao,0) vl_dia_antecipacao,
	(null)::numeric  cd_centro_custo,
	ie_situacao,
	cd_moeda,
	CASE WHEN cd_moeda=obter_moeda_padrao(cd_estabelecimento, 'P') THEN  vl_saldo_titulo  ELSE obter_valor_cotacao_moeda(cd_moeda) * vl_saldo_titulo END  vl_saldo_titulo_cotacao,
	nr_parcelas,
	nr_total_parcelas,
	vl_outras_ded_bordero vl_outras_deducoes,
	dt_vencimento_atual,
    null nr_seq_trans_financ,
	coalesce((obter_dados_bordero_tit_pagar(null, a.nr_bordero, a.nr_titulo, 'VLI'))::numeric ,0) - coalesce(a.vl_outras_ded_bordero,0) vl_liquido_bordero,
	0 vl_bordero_estrang,
	0 vl_cotacao,
	0 vl_complemento,
	null cd_moeda_bordero
FROM	titulo_pagar a
where	nr_bordero	is not null

union all

select	a.nr_titulo,
	a.nr_bordero,
	a.vl_bordero,
	b.cd_pessoa_fisica,
	b.cd_cgc,
	b.nr_documento,
	coalesce(a.vl_desconto_bordero,0) vl_desconto_bordero,
	coalesce(a.vl_juros_bordero,0) vl_juros_bordero,
	coalesce(a.vl_multa_bordero,0) vl_multa_bordero,
	coalesce(a.vl_out_desp_bordero, 0) vl_out_desp_bordero,
	coalesce(a.vl_bordero,0) - coalesce(a.vl_desconto_bordero,0) + coalesce(a.vl_juros_bordero,0) + coalesce(a.vl_multa_bordero,0) vl_liquido,
	coalesce((obter_dados_bordero_tit_pagar(null, a.nr_bordero, a.nr_titulo, 'VLI'))::numeric ,0) vl_liq_com_impostos,
	coalesce(a.vl_bordero, 0) - coalesce(a.vl_desconto_bordero, 0) + coalesce(a.vl_juros_bordero, 0) + coalesce(a.vl_multa_bordero, 0) + coalesce(a.vl_out_desp_bordero, 0) vl_total_bordero,
	b.ds_observacao_titulo,
	b.vl_saldo_titulo,
	b.nr_seq_trans_fin_baixa,
	b.dt_liquidacao,
	b.nr_seq_nota_fiscal,
	b.nr_repasse_terceiro,
	substr(obter_pessoa_titulo_pagar(b.nr_titulo),1,200) ds_beneficiario,
	b.vl_titulo,
	b.cd_estabelecimento,
	coalesce(obter_valor_tributo_desc_pagar(b.nr_titulo,a.nr_bordero,null),0) vl_tributos,
	coalesce(a.vl_bordero, 0) - coalesce(a.vl_desconto_bordero, 0) + coalesce(a.vl_juros_bordero, 0) + coalesce(a.vl_multa_bordero, 0) + coalesce(a.vl_out_desp_bordero, 0) - coalesce(obter_valor_tributo_desc_pagar(b.nr_titulo,a.nr_bordero,null),0) vl_sem_tributo,
	coalesce(b.vl_dia_antecipacao,0) vl_dia_antecipacao,
	a.cd_centro_custo,
	b.ie_situacao,
	b.cd_moeda,
	CASE WHEN b.cd_moeda=obter_moeda_padrao(cd_estabelecimento, 'P') THEN  vl_saldo_titulo  ELSE obter_valor_cotacao_moeda(b.cd_moeda) * vl_saldo_titulo END  vl_saldo_titulo_cotacao,
	nr_parcelas,
	nr_total_parcelas,
	a.vl_outras_deducoes,
	b.dt_vencimento_atual,
    a.nr_seq_trans_financ nr_seq_trans_financ,
	coalesce((obter_dados_bordero_tit_pagar(null, a.nr_bordero, a.nr_titulo, 'VLI'))::numeric ,0) - coalesce(a.vl_outras_deducoes,0) vl_liquido_bordero,
	a.vl_bordero_estrang,
	a.vl_cotacao,
	a.vl_complemento,
	a.cd_moeda
from	titulo_pagar b,
	bordero_tit_pagar a
where	a.nr_titulo	= b.nr_titulo;

