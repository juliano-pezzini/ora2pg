-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW resumo_lote_v (nr_sequencia, cd_setor_atendimento, cd_local_estoque, dt_atend_lote, nr_seq_turno, nr_seq_classif, ie_classif_urgente, cd_estabelecimento) AS select	distinct
	a.nr_sequencia,
	a.cd_setor_atendimento,
	a.cd_local_estoque,
	a.dt_atend_lote,
	a.nr_seq_turno,
	a.nr_seq_classif,
 	h.ie_classif_urgente,
	c.cd_estabelecimento
FROM    prescr_material p,
	prescr_medica c,
	prescr_mat_hor h,
	ap_lote a,
  	regra_turno_disp_param t,
        regra_turno_disp r
where	p.nr_prescricao = h.nr_prescricao
and	p.nr_sequencia	= h.nr_seq_material
and	h.nr_prescricao	= c.nr_prescricao
and	h.nr_seq_lote	= a.nr_sequencia
and 	p.nr_prescricao = c.nr_prescricao
and 	r.nr_sequencia  = t.nr_seq_turno
and 	a.nr_seq_turno	= r.nr_sequencia
and  	a.ie_status_lote = 'G'
and	h.ie_classif_urgente <> 'A'
and	a.nr_seq_turno is not null
and 	a.nr_seq_classif is not null
and 	obter_turno_horario_prescr(c.cd_estabelecimento,a.cd_setor_atendimento,to_char(LOCALTIMESTAMP,'hh24:mi'),a.cd_local_estoque) = a.nr_seq_turno
and 	a.dt_emissao_resumo is null
and	trunc(a.dt_atend_lote,'dd') between trunc(LOCALTIMESTAMP,'dd') and trunc(LOCALTIMESTAMP + interval '1 days','dd')
and 	t.hr_inicial > t.hr_final

union all

select	distinct
	a.nr_sequencia,
	a.cd_setor_atendimento,
	a.cd_local_estoque,
	a.dt_atend_lote,
	a.nr_seq_turno,
	a.nr_seq_classif,
 	h.ie_classif_urgente,
	c.cd_estabelecimento
from    prescr_material p,
	prescr_medica c,
	prescr_mat_hor h,
	ap_lote a,
	regra_turno_disp_param t,
        regra_turno_disp r
where	p.nr_prescricao = h.nr_prescricao
and	p.nr_sequencia	= h.nr_seq_material
and	h.nr_prescricao	= c.nr_prescricao
and	h.nr_seq_lote	= a.nr_sequencia
and 	p.nr_prescricao = c.nr_prescricao
and 	r.nr_sequencia  = t.nr_seq_turno
and 	a.nr_seq_turno	= r.nr_sequencia
and  	a.ie_status_lote = 'G'
and	a.nr_seq_turno is not null
and 	a.nr_seq_classif is not null
and	h.ie_classif_urgente <> 'A'
and 	obter_turno_horario_prescr(c.cd_estabelecimento,a.cd_setor_atendimento,to_char(LOCALTIMESTAMP,'hh24:mi'), a.cd_local_estoque) = a.nr_seq_turno
and 	a.dt_emissao_resumo is null
and	trunc(a.dt_atend_lote,'dd') = trunc(LOCALTIMESTAMP,'dd')
and 	t.hr_inicial < t.hr_final
order by 1,4;

