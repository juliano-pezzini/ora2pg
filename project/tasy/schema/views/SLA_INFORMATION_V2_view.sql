-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW sla_information_v2 (ie_indicador, ds_indicador, develop_management_id, develop_management, status_sla_response, extract_date, sla_detail, philips_severity, so_number, customer, philips_classification, qt_target, sla_id) AS select	'1' ie_indicador,
			'OPENED_DEFECTS' ds_indicador,
			a.develop_management_id,
			a.develop_management,
			a.status_sla_response,
			a.extract_date,
			a.sla_detail,
			a.philips_severity,
			a.so_number,
			a.customer,
			a.philips_classification,
			coalesce(a.sla_target,0) * 100 qt_target,
			a.sla_id
FROM    	sla_informations a
where	a.status_sla_response is not null
and		a.develop_management_id <> 68
--and		sla_detail <> 'PSOTR'


union all

select 	'2' ie_indicador,
			'RECLASSIFIED_DEFECTS' ds_indicador,
			a.develop_management_id,
			a.develop_management,
			a.status_sla_response,
			a.extract_date,
			a.sla_detail,
			a.philips_severity,
			a.so_number,
			a.customer,
			a.philips_classification,
			coalesce(a.sla_target,0) * 100 qt_target,
			a.sla_id
from    	sla_informations a
where 	customer_classification <> philips_classification
and		a.develop_management_id <> 68

union all

select 	'3' ie_indicador,
			'RESPONSE_BREACHED' ds_indicador,
			a.develop_management_id,
			a.develop_management,
			a.status_sla_response,
			a.extract_date,
			a.sla_detail,
			a.philips_severity,
			a.so_number,
			a.customer,
			a.philips_classification,
			coalesce(a.sla_target,0) * 100 qt_target,
			a.sla_id
from    	sla_informations a
where	upper(a.status_sla_response) = upper('breached')
and     	((upper(a.philips_classification) = upper('defeito')) or (a.so_sla = 'S'))
and		a.develop_management_id <> 68
and	not exists (	select	1 
			from	man_ordem_serv_sla_abonada x
			where	a.so_number = x.nr_seq_ordem_servico
			and	x.ie_tipo_abono in ('A','R'))
--and		a.sla_detail <> 'PSOTR'


union all

select 	'4' ie_indicador,
			'RESOLUTION_BREACHED' ds_indicador,
			a.develop_management_id,
			a.develop_management,
			a.status_sla_response,
			a.extract_date,
			a.sla_detail,
			a.philips_severity,
			a.so_number,
			a.customer,
			a.philips_classification,
			coalesce(a.sla_target,0) * 100 qt_target,
			a.sla_id
from    	sla_informations a
where	upper(a.status_sla_resolution) = upper('breached')
and     	((upper(a.philips_classification) = upper('defeito')) or (a.so_sla = 'S'))
and		a.develop_management_id <> 68
and	not exists (	select	1 
			from	man_ordem_serv_sla_abonada x
			where	a.so_number = x.nr_seq_ordem_servico
			and	x.ie_tipo_abono in ('A','S'))
--and		a.sla_detail <> 'PSOTR'

order by	1;

