-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW info_equip_manutencao_v (cd_equipamento, ds_equipamento, qt_equipamento, qt_estoque, qt_equip_antigo, qt_descarte, ds_descarte, qt_sem_manutencao, ds_sem_manutencao, qt_danificado, ds_dano, dt_equipamento) AS select	a.cd_equipamento cd_equipamento,
			a.ds_equipamento ds_equipamento,
			a.qt_equipamento qt_equipamento,
			0 qt_estoque,
			CASE WHEN obter_info_equip_man(a.cd_equipamento, 'FG')='S' THEN  a.qt_equipamento  ELSE 0 END  qt_equip_antigo,
			CASE WHEN obter_info_equip_man(a.cd_equipamento, 'DE')='S' THEN  a.qt_equipamento  ELSE 0 END  qt_descarte,
			obter_info_equip_man(a.cd_equipamento, 'DDE') ds_descarte,
			CASE WHEN obter_info_equip_man(a.cd_equipamento, 'SM')='S' THEN  a.qt_equipamento  ELSE 0 END  qt_sem_manutencao,
			obter_info_equip_man(a.cd_equipamento, 'DSM') ds_sem_manutencao,
			CASE WHEN obter_info_equip_man(a.cd_equipamento, 'DA')='S' THEN  a.qt_equipamento  ELSE 0 END  qt_danificado,
			obter_info_equip_man(a.cd_equipamento, 'DDA') ds_dano,
			a.dt_atualizacao_nrec dt_equipamento
FROM	equipamento a
where 	a.ie_situacao  = 'A'

union

select	a.cd_equipamento cd_equipamento,
			a.ds_equipamento ds_equipamento,
			0 qt_equipamento,
			CASE WHEN obter_status_equipamento(b.nr_sequencia, a.cd_equipamento, 'S')='D' THEN a.qt_equipamento  ELSE 0 END  qt_estoque,
			0 qt_equip_antigo,
			0 qt_descarte,
			'' ds_descarte,
			0 qt_sem_manutencao,
			'' ds_sem_manutencao,
			0 qt_danificado,
			'' ds_dano,
			a.dt_atualizacao_nrec dt_equipamento
from	equipamento a,
		agenda_paciente b,
		agenda_pac_equip c
where 	a.cd_equipamento = c.cd_equipamento
and 	b.nr_sequencia = c.nr_seq_agenda
and     a.ie_situacao  = 'A';

