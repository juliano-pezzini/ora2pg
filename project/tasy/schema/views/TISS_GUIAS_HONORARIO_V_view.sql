-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW tiss_guias_honorario_v (ds_versao, cd_autorizacao, ds_carater_internacao, ds_tipo_saida, ie_tipo_atendimento, nr_interno_conta, nr_seq_protocolo, nr_atendimento, dt_entrada, ie_tipo_saida, cd_medico_executor, ie_tipo_protocolo, ds_funcao_medico, ie_tipo_atend_tiss, cd_especialidade, cd_autorizacao_tag, cd_convenio, cd_cgc_honorario, cd_autorizacao_princ, cd_tipo_acomodacao) AS select	'2.01.01' ds_versao,
	c.cd_autorizacao, 
	CASE WHEN b.ie_carater_inter_sus='1' THEN 'E'  ELSE 'U' END  DS_CARATER_INTERNACAO, 
	'A' ds_tipo_saida, 
	CASE WHEN b.ie_tipo_atendimento=1 THEN  '7' WHEN b.ie_tipo_atendimento=3 THEN  '4' WHEN b.ie_tipo_atendimento=7 THEN  '6' WHEN b.ie_tipo_atendimento=8 THEN '4' END  ie_tipo_atendimento, 
	a.nr_interno_conta, 
	a.nr_seq_protocolo, 
	a.nr_atendimento, 
	b.dt_entrada, 
	CASE WHEN coalesce(d.ie_obito,'N')='S' THEN '6'  ELSE '5' END  ie_tipo_saida, 
	e.cd_medico_executor, 
	obter_tipo_protocolo(a.nr_seq_protocolo) ie_tipo_protocolo, 
	substr(TISS_OBTER_GRAU_PARTIC(e.ie_funcao_medico),1,25) ds_funcao_medico, 
	a.ie_tipo_atend_tiss, 
	e.cd_especialidade, 
	CASE WHEN c.cd_autorizacao='Não Informada' THEN  null  ELSE c.cd_autorizacao END  CD_AUTORIZACAO_TAG, 
	a.cd_convenio_parametro cd_convenio, 
	coalesce(e.cd_cgc_honorario_tiss, e.cd_cgc_prestador) cd_cgc_honorario, 
	substr(coalesce(TISS_OBTER_GUIA_PRINCIPAL(b.nr_atendimento, a.cd_convenio_parametro), CASE WHEN c.cd_autorizacao='Não Informada' THEN  null  ELSE c.cd_autorizacao END ),1,255) cd_autorizacao_princ, 
	substr(tiss_obter_tipo_acomod(t.cd_tipo_acomodacao),1,40) cd_tipo_acomodacao 
FROM atend_categoria_convenio t, conta_paciente_guia c, conta_paciente a, procedimento_paciente e
LEFT OUTER JOIN regra_honorario g ON (e.ie_responsavel_credito = g.cd_regra)
, atendimento_paciente b
LEFT OUTER JOIN motivo_alta d ON (b.cd_motivo_alta = d.cd_motivo_alta)
WHERE a.nr_atendimento		= b.nr_atendimento and a.nr_interno_conta		= c.nr_interno_conta  and e.nr_interno_conta		= c.nr_interno_conta and e.nr_doc_convenio		= c.cd_autorizacao  and b.nr_atendimento		= t.nr_atendimento and obter_atecaco_atendimento(b.nr_atendimento) = t.nr_seq_interno and ((TISS_OBTER_GUIA_PROC(b.ie_tipo_atendimento, 
				e.cd_procedimento, 
				e.ie_origem_proced, 
				g.ie_entra_conta, 
				g.ie_repassa_medico, 
				e.ie_tiss_tipo_guia) = '6') or (TISS_OBTER_GUIA_PROC(b.ie_tipo_atendimento, 
				e.cd_procedimento, 
				e.ie_origem_proced, 
				g.ie_entra_conta, 
				g.ie_repassa_medico, 
				e.ie_tiss_tipo_guia_honor) = '6')) and coalesce(e.nr_seq_proc_pacote, e.nr_sequencia) = e.nr_sequencia and e.cd_motivo_exc_conta	is null 
group	by c.cd_autorizacao, 
	CASE WHEN b.ie_carater_inter_sus='1' THEN 'E'  ELSE 'U' END , 
	CASE WHEN b.ie_tipo_atendimento=1 THEN  '7' WHEN b.ie_tipo_atendimento=3 THEN  '4' WHEN b.ie_tipo_atendimento=7 THEN  '6' WHEN b.ie_tipo_atendimento=8 THEN '4' END , 
	a.nr_interno_conta, 
	a.nr_seq_protocolo, 
	a.nr_atendimento, 
	b.dt_entrada, 
	CASE WHEN coalesce(d.ie_obito,'N')='S' THEN '6'  ELSE '5' END , 
	e.cd_medico_executor, 
	obter_tipo_protocolo(a.nr_seq_protocolo), 
	substr(TISS_OBTER_GRAU_PARTIC(e.ie_funcao_medico),1,25), 
	a.ie_tipo_atend_tiss, 
	e.cd_especialidade, 
	CASE WHEN c.cd_autorizacao='Não Informada' THEN  null  ELSE c.cd_autorizacao END , 
	a.cd_convenio_parametro, 
	coalesce(e.cd_cgc_honorario_tiss, e.cd_cgc_prestador), 
	substr(coalesce(TISS_OBTER_GUIA_PRINCIPAL(b.nr_atendimento, a.cd_convenio_parametro), CASE WHEN c.cd_autorizacao='Não Informada' THEN  null  ELSE c.cd_autorizacao END ),1,255), 
	substr(tiss_obter_tipo_acomod(t.cd_tipo_acomodacao),1,40) 
 
union
 
select	'2.01.01' ds_versao, 
	'Não Informada' cd_autorizacao, 
	CASE WHEN b.ie_carater_inter_sus='1' THEN 'E'  ELSE 'U' END  DS_CARATER_INTERNACAO, 
	'A' ds_tipo_saida, 
	CASE WHEN b.ie_tipo_atendimento=1 THEN  '7' WHEN b.ie_tipo_atendimento=3 THEN  '4' WHEN b.ie_tipo_atendimento=7 THEN  '6' WHEN b.ie_tipo_atendimento=8 THEN '4' END  ie_tipo_atendimento, 
	a.nr_interno_conta, 
	a.nr_seq_protocolo, 
	a.nr_atendimento, 
	b.dt_entrada, 
	CASE WHEN coalesce(d.ie_obito,'N')='S' THEN '6'  ELSE '5' END  ie_tipo_saida, 
	e.cd_medico_executor, 
	obter_tipo_protocolo(a.nr_seq_protocolo) ie_tipo_protocolo, 
	substr(TISS_OBTER_GRAU_PARTIC(e.ie_funcao_medico),1,25) ds_funcao_medico, 
	a.ie_tipo_atend_tiss, 
	e.cd_especialidade, 
	null CD_AUTORIZACAO_TAG, 
	a.cd_convenio_parametro cd_convenio, 
	coalesce(e.cd_cgc_honorario_tiss, e.cd_cgc_prestador) cd_cgc_honorario, 
	substr(TISS_OBTER_GUIA_PRINCIPAL(b.nr_atendimento, a.cd_convenio_parametro),1,255) cd_autorizacao_princ, 
	substr(tiss_obter_tipo_acomod(t.cd_tipo_acomodacao),1,40) cd_tipo_acomodacao 
FROM atend_categoria_convenio t, conta_paciente a, procedimento_paciente e
LEFT OUTER JOIN regra_honorario g ON (e.ie_responsavel_credito = g.cd_regra)
, atendimento_paciente b
LEFT OUTER JOIN motivo_alta d ON (b.cd_motivo_alta = d.cd_motivo_alta)
WHERE a.nr_atendimento		= b.nr_atendimento  and a.nr_interno_conta		= e.nr_interno_conta  and b.nr_atendimento		= t.nr_atendimento and coalesce(e.nr_doc_convenio, 'Não Informada') = 'Não Informada' and obter_atecaco_atendimento(b.nr_atendimento)	= t.nr_seq_interno and ((TISS_OBTER_GUIA_PROC(b.ie_tipo_atendimento, 
				e.cd_procedimento, 
				e.ie_origem_proced, 
				g.ie_entra_conta, 
				g.ie_repassa_medico, 
				e.ie_tiss_tipo_guia) = '6') or (TISS_OBTER_GUIA_PROC(b.ie_tipo_atendimento, 
				e.cd_procedimento, 
				e.ie_origem_proced, 
				g.ie_entra_conta, 
				g.ie_repassa_medico, 
				e.ie_tiss_tipo_guia_honor) = '6')) and coalesce(e.nr_seq_proc_pacote, e.nr_sequencia) = e.nr_sequencia and e.cd_motivo_exc_conta	is null 
group 	by CASE WHEN b.ie_carater_inter_sus='1' THEN 'E'  ELSE 'U' END , 
	CASE WHEN b.ie_tipo_atendimento=1 THEN  '7' WHEN b.ie_tipo_atendimento=3 THEN  '4' WHEN b.ie_tipo_atendimento=7 THEN  '6' WHEN b.ie_tipo_atendimento=8 THEN '4' END , 
	a.nr_interno_conta, 
	a.nr_seq_protocolo, 
	a.nr_atendimento, 
	b.dt_entrada, 
	CASE WHEN coalesce(d.ie_obito,'N')='S' THEN '6'  ELSE '5' END , 
	e.cd_medico_executor, 
	obter_tipo_protocolo(a.nr_seq_protocolo), 
	substr(TISS_OBTER_GRAU_PARTIC(e.ie_funcao_medico),1,25), 
	a.ie_tipo_atend_tiss, 
	e.cd_especialidade, 
	a.cd_convenio_parametro, 
	coalesce(e.cd_cgc_honorario_tiss, e.cd_cgc_prestador), 
	substr(TISS_OBTER_GUIA_PRINCIPAL(b.nr_atendimento, a.cd_convenio_parametro),1,255), 
	substr(tiss_obter_tipo_acomod(t.cd_tipo_acomodacao),1,40) 
 
union
 
select	'2.01.01' ds_versao, 
	'Não Informada' cd_autorizacao, 
	CASE WHEN b.ie_carater_inter_sus='1' THEN 'E'  ELSE 'U' END  DS_CARATER_INTERNACAO, 
	'A' ds_tipo_saida, 
	CASE WHEN b.ie_tipo_atendimento=1 THEN  '7' WHEN b.ie_tipo_atendimento=3 THEN  '4' WHEN b.ie_tipo_atendimento=7 THEN  '6' WHEN b.ie_tipo_atendimento=8 THEN '4' END  ie_tipo_atendimento, 
	a.nr_interno_conta, 
	a.nr_seq_protocolo, 
	a.nr_atendimento, 
	b.dt_entrada, 
	CASE WHEN coalesce(d.ie_obito,'N')='S' THEN '6'  ELSE '5' END  ie_tipo_saida, 
	f.cd_pessoa_fisica cd_medico_executor, 
	obter_tipo_protocolo(a.nr_seq_protocolo) ie_tipo_protocolo, 
	substr(TISS_OBTER_GRAU_PARTIC(f.ie_funcao),1,25) ds_funcao_medico, 
	a.ie_tipo_atend_tiss, 
	f.cd_especialidade, 
	null CD_AUTORIZACAO_TAG, 
	a.cd_convenio_parametro cd_convenio, 
	coalesce(f.cd_cgc,coalesce(e.cd_cgc_honorario_tiss, e.cd_cgc_prestador)) cd_cgc_honorario, 
	substr(TISS_OBTER_GUIA_PRINCIPAL(b.nr_atendimento, a.cd_convenio_parametro),1,255) cd_autorizacao_princ, 
	substr(tiss_obter_tipo_acomod(t.cd_tipo_acomodacao),1,40) cd_tipo_acomodacao 
FROM atend_categoria_convenio t, procedimento_paciente e, conta_paciente a, procedimento_participante f
LEFT OUTER JOIN regra_honorario g ON (f.ie_responsavel_credito = g.cd_regra)
, atendimento_paciente b
LEFT OUTER JOIN motivo_alta d ON (b.cd_motivo_alta = d.cd_motivo_alta)
WHERE a.nr_atendimento		= b.nr_atendimento  and a.nr_interno_conta		= e.nr_interno_conta  and f.nr_sequencia			= e.nr_sequencia and b.nr_atendimento		= t.nr_atendimento and obter_atecaco_atendimento(b.nr_atendimento)			 = t.nr_seq_interno and coalesce(coalesce(f.nr_doc_honor_conv, e.nr_doc_convenio), 'Não Informada') = 'Não Informada' and TISS_OBTER_GUIA_PROC(b.ie_tipo_atendimento, 
				e.cd_procedimento, 
				e.ie_origem_proced, 
				g.ie_entra_conta, 
				g.ie_repassa_medico, 
				f.ie_tiss_tipo_guia) = '6' and coalesce(e.nr_seq_proc_pacote, e.nr_sequencia) = e.nr_sequencia and e.cd_motivo_exc_conta	is null 
group 	by CASE WHEN b.ie_carater_inter_sus='1' THEN 'E'  ELSE 'U' END , 
	CASE WHEN b.ie_tipo_atendimento=1 THEN  '7' WHEN b.ie_tipo_atendimento=3 THEN  '4' WHEN b.ie_tipo_atendimento=7 THEN  '6' WHEN b.ie_tipo_atendimento=8 THEN '4' END , 
	a.nr_interno_conta, 
	a.nr_seq_protocolo, 
	a.nr_atendimento, 
	b.dt_entrada, 
	CASE WHEN coalesce(d.ie_obito,'N')='S' THEN '6'  ELSE '5' END , 
	f.cd_pessoa_fisica, 
	obter_tipo_protocolo(a.nr_seq_protocolo), 
	substr(TISS_OBTER_GRAU_PARTIC(f.ie_funcao),1,25), 
	a.ie_tipo_atend_tiss, 
	f.cd_especialidade, 
	a.cd_convenio_parametro, 
	coalesce(f.cd_cgc,coalesce(e.cd_cgc_honorario_tiss, e.cd_cgc_prestador)), 
	substr(TISS_OBTER_GUIA_PRINCIPAL(b.nr_atendimento, a.cd_convenio_parametro),1,255), 
	substr(tiss_obter_tipo_acomod(t.cd_tipo_acomodacao),1,40) 
 
union
 
select	'2.01.01' ds_versao, 
	coalesce(f.NR_DOC_HONOR_CONV,c.cd_autorizacao), 
	CASE WHEN b.ie_carater_inter_sus='1' THEN 'E'  ELSE 'U' END  DS_CARATER_INTERNACAO, 
	'A' ds_tipo_saida, 
	CASE WHEN b.ie_tipo_atendimento=1 THEN  '7' WHEN b.ie_tipo_atendimento=3 THEN  '4' WHEN b.ie_tipo_atendimento=7 THEN  '6' WHEN b.ie_tipo_atendimento=8 THEN '4' END  ie_tipo_atendimento, 
	a.nr_interno_conta, 
	a.nr_seq_protocolo, 
	a.nr_atendimento, 
	b.dt_entrada, 
	CASE WHEN coalesce(d.ie_obito,'N')='S' THEN '6'  ELSE '5' END  ie_tipo_saida, 
	f.cd_pessoa_fisica cd_medico_executor, 
	obter_tipo_protocolo(a.nr_seq_protocolo) ie_tipo_protocolo, 
	substr(TISS_OBTER_GRAU_PARTIC(f.ie_funcao),1,25) ds_funcao_medico, 
	a.ie_tipo_atend_tiss, 
	f.cd_especialidade, 
	CASE WHEN coalesce(f.NR_DOC_HONOR_CONV,c.cd_autorizacao)='Não Informada' THEN  null  ELSE coalesce(f.NR_DOC_HONOR_CONV,c.cd_autorizacao) END  CD_AUTORIZACAO_TAG, 
	a.cd_convenio_parametro cd_convenio, 
	coalesce(f.cd_cgc,coalesce(e.cd_cgc_honorario_tiss, e.cd_cgc_prestador)) cd_cgc_honorario, 
	substr(coalesce(TISS_OBTER_GUIA_PRINCIPAL(b.nr_atendimento, a.cd_convenio_parametro), CASE WHEN c.cd_autorizacao='Não Informada' THEN  null  ELSE c.cd_autorizacao END ),1,255) cd_autorizacao_princ, 
	substr(tiss_obter_tipo_acomod(t.cd_tipo_acomodacao),1,40) cd_tipo_acomodacao 
FROM atend_categoria_convenio t, procedimento_paciente e, conta_paciente_guia c, conta_paciente a, procedimento_participante f
LEFT OUTER JOIN regra_honorario g ON (f.ie_responsavel_credito = g.cd_regra)
, atendimento_paciente b
LEFT OUTER JOIN motivo_alta d ON (b.cd_motivo_alta = d.cd_motivo_alta)
WHERE a.nr_atendimento		= b.nr_atendimento  and a.nr_interno_conta		= e.nr_interno_conta  and f.nr_sequencia			= e.nr_sequencia and e.nr_interno_conta		= c.nr_interno_conta and b.nr_atendimento		= t.nr_atendimento and obter_atecaco_atendimento(b.nr_atendimento)	= t.nr_seq_interno and coalesce(e.nr_doc_convenio, f.nr_doc_honor_conv)	= c.cd_autorizacao and TISS_OBTER_GUIA_PROC(b.ie_tipo_atendimento, 
				e.cd_procedimento, 
				e.ie_origem_proced, 
				g.ie_entra_conta, 
				g.ie_repassa_medico, 
				f.ie_tiss_tipo_guia) = '6' and coalesce(e.nr_seq_proc_pacote, e.nr_sequencia) = e.nr_sequencia and e.cd_motivo_exc_conta	is null 
group 	by coalesce(f.NR_DOC_HONOR_CONV, c.cd_autorizacao), 
	CASE WHEN b.ie_carater_inter_sus='1' THEN 'E'  ELSE 'U' END , 
	CASE WHEN b.ie_tipo_atendimento=1 THEN  '7' WHEN b.ie_tipo_atendimento=3 THEN  '4' WHEN b.ie_tipo_atendimento=7 THEN  '6' WHEN b.ie_tipo_atendimento=8 THEN '4' END , 
	a.nr_interno_conta, 
	a.nr_seq_protocolo, 
	a.nr_atendimento, 
	b.dt_entrada, 
	CASE WHEN coalesce(d.ie_obito,'N')='S' THEN '6'  ELSE '5' END , 
	f.cd_pessoa_fisica, 
	obter_tipo_protocolo(a.nr_seq_protocolo), 
	substr(TISS_OBTER_GRAU_PARTIC(f.ie_funcao),1,25), 
	a.ie_tipo_atend_tiss, 
	f.cd_especialidade, 
	CASE WHEN coalesce(f.NR_DOC_HONOR_CONV,c.cd_autorizacao)='Não Informada' THEN  null  ELSE coalesce(f.NR_DOC_HONOR_CONV,c.cd_autorizacao) END , 
	a.cd_convenio_parametro, 
	coalesce(f.cd_cgc,coalesce(e.cd_cgc_honorario_tiss, e.cd_cgc_prestador)), 
	substr(coalesce(TISS_OBTER_GUIA_PRINCIPAL(b.nr_atendimento, a.cd_convenio_parametro), CASE WHEN c.cd_autorizacao='Não Informada' THEN  null  ELSE c.cd_autorizacao END ),1,255), 
	substr(tiss_obter_tipo_acomod(t.cd_tipo_acomodacao),1,40);

