-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW consulta_agehdm_html5_v (cd_estabelecimento, ds_estabelecimento, cd_tipo_agenda, ds_tipo_agenda, cd_agenda, ds_agenda, dt_agenda, dt_agendamento, hr_inicio, hr_agenda, hr_horario, ie_status, ds_observacao, ds_status, nm_paciente, ds_dia_semana, nr_minuto_duracao, nr_sequencia, nr_idade, cd_pessoa_fisica, ie_tipo_data, qt_passado, qt_dia, qt_futuro, nr_seq_status_pac, ie_alerta, ds_senha_gerada, cd_participante, cd_turma, cd_captacao) AS select distinct a.cd_estabelecimento cd_estabelecimento,
		SUBSTR(obter_nome_estabelecimento(a.cd_estabelecimento),1,80) ds_estabelecimento,
		11 cd_tipo_agenda,
		'HDM' ds_tipo_agenda,
		a.cd_agenda,
		b.ds_agenda,
		a.dt_agenda, 
		a.dt_agendamento,
		a.dt_agenda hr_inicio,
		a.dt_agenda hr_agenda,
		a.dt_agenda hr_horario,
		a.ie_status_agenda ie_status,
		a.ds_observacao,
		SUBSTR(obter_valor_dominio(83, a.ie_status_agenda),1,255) ds_status,
		obter_dados_pf(c.cd_pessoa_fisica, 'PNC') nm_paciente,
		(select substr(obter_dia_semana(a.dt_agenda),1,20) ) ds_dia_semana,
		a.nr_minuto_duracao, 
		a.nr_sequencia nr_sequencia , 
		obter_idade(obter_dados_pf(c.cd_pessoa_fisica, 'DN'),LOCALTIMESTAMP,'A') nr_idade,
		c.cd_pessoa_fisica, 
		pkg_date_utils.get_DiffDate(LOCALTIMESTAMP, a.dt_agenda, 'DAY') ie_tipo_data,
		0 qt_passado,
		0 qt_dia,
		0 qt_futuro,
		a.nr_seq_status_pac,
		obter_se_contem_alertas(c.cd_pessoa_fisica) IE_ALERTA,
		obter_senha_gerada_agendas(a.CD_AGENDA, a.NR_SEQUENCIA) DS_SENHA_GERADA,
		a.nr_seq_participante cd_participante,
		a.nr_seq_turma cd_turma,
		a.nr_seq_captacao cd_captacao
from    mprev_agendamento a, 
		agenda b,
		MPREV_PARTICIPANTE c
where   1 = 1
		and a.cd_agenda = b.cd_agenda
		and a.NR_SEQ_PARTICIPANTE = c.nr_sequencia;

