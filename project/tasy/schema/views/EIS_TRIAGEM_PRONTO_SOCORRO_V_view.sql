-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_triagem_pronto_socorro_v (cd_estabelecimento, dt_referencia, hr_atendimento, cd_medico, cd_motivo_alta, ie_clinica, cd_convenio, cd_setor_atendimento, cd_procedencia, ie_tipo_atendimento, cd_especialidade, nr_pacientes, qt_minuto_espera, qt_minuto_consulta, qt_min_espera_med, qt_atend_tempo, nm_usuario_atend, cd_cid_doenca, ds_bairro, cd_pessoa_fisica, nr_seq_queixa, nr_seq_tipo_acidente, ie_carater_inter_sus, qt_min_desfecho, cd_tipo_acomodacao, cd_unidade_basica, cd_unidade_compl, qt_min_ps, nr_seq_triagem, qt_min_triagem, qt_min_atend, nm_usuario_triagem, qt_min_espera_recep, qt_min_abertura_ficha, ie_status, nr_seq_classificacao, ie_desfecho, nr_atendimento, qt_min_fim_enf, nr_seq_triagem_prioridade, qt_min_senha, cd_categoria, qt_minuto_checagem, qt_min_atend_senha, qt_min_senha_cons, qt_min_parecer, qt_min_internacao, qt_min_senha_desfecho, qt_min_classif_atend, qt_min_triagem_cons, qt_min_triagem_atend, qt_min_observacao, nr_seq_turno, nr_pacientes_obs, qt_min_atend_prescr, nr_seq_triagem_inf, ds_triagem, qt_media_min_espera, qt_media_min_consulta, qt_media_min_espera_med, qt_media_desfecho, qt_media_min_classif_atend, qt_media_min_triagem_cons, qt_media_min_triagem_atend, ds_classificacao, ds_triagem_prioridade, nr_seq_triagem_prior_inf, cd_empresa, qt_alta, qt_obito, qt_transferencia, qt_internado) AS SELECT	a.CD_ESTABELECIMENTO,a.DT_REFERENCIA,a.HR_ATENDIMENTO,a.CD_MEDICO,a.CD_MOTIVO_ALTA,a.IE_CLINICA,a.CD_CONVENIO,a.CD_SETOR_ATENDIMENTO,a.CD_PROCEDENCIA,a.IE_TIPO_ATENDIMENTO,a.CD_ESPECIALIDADE,a.NR_PACIENTES,a.QT_MINUTO_ESPERA,a.QT_MINUTO_CONSULTA,a.QT_MIN_ESPERA_MED,a.QT_ATEND_TEMPO,a.NM_USUARIO_ATEND,a.CD_CID_DOENCA,a.DS_BAIRRO,a.CD_PESSOA_FISICA,a.NR_SEQ_QUEIXA,a.NR_SEQ_TIPO_ACIDENTE,a.IE_CARATER_INTER_SUS,a.QT_MIN_DESFECHO,a.CD_TIPO_ACOMODACAO,a.CD_UNIDADE_BASICA,a.CD_UNIDADE_COMPL,a.QT_MIN_PS,a.NR_SEQ_TRIAGEM,a.QT_MIN_TRIAGEM,a.QT_MIN_ATEND,a.NM_USUARIO_TRIAGEM,a.QT_MIN_ESPERA_RECEP,a.QT_MIN_ABERTURA_FICHA,a.IE_STATUS,a.NR_SEQ_CLASSIFICACAO,a.IE_DESFECHO,a.NR_ATENDIMENTO,a.QT_MIN_FIM_ENF,a.NR_SEQ_TRIAGEM_PRIORIDADE,a.QT_MIN_SENHA,a.CD_CATEGORIA,a.QT_MINUTO_CHECAGEM,a.QT_MIN_ATEND_SENHA,a.QT_MIN_SENHA_CONS,a.QT_MIN_PARECER,a.QT_MIN_INTERNACAO,a.QT_MIN_SENHA_DESFECHO,a.QT_MIN_CLASSIF_ATEND,a.QT_MIN_TRIAGEM_CONS,a.QT_MIN_TRIAGEM_ATEND,a.QT_MIN_OBSERVACAO,a.NR_SEQ_TURNO,a.NR_PACIENTES_OBS,a.QT_MIN_ATEND_PRESCR,
	coalesce(a.nr_seq_triagem,999) nr_seq_triagem_inf, 
	SUBSTR(obter_desc_triagem(a.nr_seq_triagem),1,60) ds_triagem,	 
	dividir(a.qt_minuto_espera, a.nr_pacientes) qt_media_min_espera, 
	dividir(a.qt_minuto_consulta, a.nr_pacientes) qt_media_min_consulta, 
	dividir(a.qt_min_espera_med, a.nr_pacientes) qt_media_min_espera_med, 
	dividir(a.qt_min_desfecho, a.nr_pacientes) qt_media_desfecho, 
	dividir(a.qt_min_classif_atend, a.nr_pacientes) qt_media_min_classif_atend, 
	dividir(a.qt_min_triagem_cons, a.nr_pacientes) qt_media_min_triagem_cons, 
	dividir(a.qt_min_triagem_atend, a.nr_pacientes) qt_media_min_triagem_atend,		 
	substr(obter_desc_classif_atend(a.nr_seq_classificacao),1,255) ds_classificacao, 
	substr(obter_dados_tcp(a.nr_seq_triagem_prioridade,'DESC'),1,60) ds_triagem_prioridade,	 
	coalesce(a.nr_seq_triagem_prioridade,999) nr_seq_triagem_prior_inf, 
	SUBSTR(obter_empresa_estab(a.cd_estabelecimento),1,100) cd_empresa, 
	CASE WHEN b.dt_Alta IS NULL THEN 0  ELSE 1 END  qt_alta, 
	CASE WHEN c.dt_obito IS NULL THEN 0  ELSE 1 END  qt_obito, 
	CASE WHEN obter_se_transferencia(b.nr_atendimento)='N' THEN 0  ELSE 1 END  qt_transferencia, 
	CASE WHEN Obter_Se_Atend_Internado(b.nr_atendimento)='N' THEN 0  ELSE 1 END  qt_internado 
FROM	eis_pronto_socorro a, 
		atendimento_paciente b, 
		pessoa_fisica c 
where	a.nr_atendimento = b.nr_atendimento 
and		b.cd_pessoa_fisica = c.cd_pessoa_fisica;

