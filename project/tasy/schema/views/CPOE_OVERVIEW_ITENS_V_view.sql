-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW cpoe_overview_itens_v (nr_sequencia, ds_html, ds_item, ds_label_html, ie_tipo_item, nr_atendimento, cd_pessoa_fisica, hr_prim_horario, dt_inicio, ie_tipo_item_cpoe, dt_lib_suspensao, cd_material, nm_usuario, dt_liberacao, dt_fim, ds_horarios, qt_dose, cd_unidade_medida, ie_via_aplicacao, nr_seq_cpoe_rp, nr_seq_cpoe_order_unit, nr_seq_cpoe_tipo_pedido, ie_administracao, cd_departamento, cd_intervalo) AS select	a.nr_sequencia,
	substr(obter_desc_dados_dieta(a.cd_dieta),1,4000) ds_html,
		substr(obter_nome_dieta(a.cd_dieta),1,255) ds_item,
		cpoe_get_tag_html('D',a.nr_sequencia,a.ds_observacao) ds_label_html,
		'D' ie_tipo_item,
		a.nr_atendimento,
		a.cd_pessoa_fisica,
		a.hr_prim_horario,
		a.dt_inicio,
		'DO' ie_tipo_item_cpoe,
		a.dt_lib_suspensao,
		null cd_material,
		a.nm_usuario,
		a.dt_liberacao,
		a.dt_fim,
		padroniza_horario_prescr(a.ds_horarios, CASE WHEN substr(Obter_Se_horario_hoje(a.dt_inicio,a.dt_prim_horario,a.hr_prim_horario),1,1)='N' THEN '01/01/2000 23:59:59'  ELSE to_char(coalesce(dt_prim_horario,dt_inicio),'dd/mm/yyyy hh24:mi:ss') END ) ds_horarios,
        a.qt_dose,
		a.cd_unidade_medida_dose cd_unidade_medida,
		a.ie_via_aplicacao,	
		null nr_seq_cpoe_rp,
		a.nr_seq_cpoe_order_unit,
		(select max(x.nr_seq_cpoe_tipo_pedido) FROM cpoe_order_unit x where x.nr_sequencia = a.nr_seq_cpoe_order_unit) nr_seq_cpoe_tipo_pedido,
		a.ie_administracao,
		coalesce(b.cd_departamento_med, a.cd_departamento) cd_departamento,
	a.cd_intervalo
FROM cpoe_dieta a
LEFT OUTER JOIN cpoe_order_unit b ON (a.nr_seq_cpoe_order_unit = b.nr_sequencia)
WHERE a.dt_liberacao is not null and a.ie_tipo_dieta	= 'O'

union all

select	a.nr_sequencia,
		substr(Obter_desc_Dieta(a.CD_DIETA),1,4000) ds_html,
		substr(obter_desc_material(a.cd_material),1,255) ds_item,
		cpoe_get_tag_html('D',a.nr_sequencia,a.ds_observacao) ds_label_html,
		'D' ie_tipo_item,
		a.nr_atendimento,
		a.cd_pessoa_fisica,
		a.hr_prim_horario,
		a.dt_inicio,
		'SNE' ie_tipo_item_cpoe,
		a.dt_lib_suspensao,
		a.cd_material,
		a.nm_usuario,
		a.dt_liberacao,
		a.dt_fim,
		padroniza_horario_prescr(a.ds_horarios, CASE WHEN substr(Obter_Se_horario_hoje(a.dt_inicio,a.dt_prim_horario,a.hr_prim_horario),1,1)='N' THEN '01/01/2000 23:59:59'  ELSE to_char(coalesce(dt_prim_horario,dt_inicio),'dd/mm/yyyy hh24:mi:ss') END ) ds_horarios,
        a.qt_dose,
		a.cd_unidade_medida_dose cd_unidade_medida,
		a.ie_via_aplicacao,	
		null nr_seq_cpoe_rp,
		a.nr_seq_cpoe_order_unit,
		(select max(x.nr_seq_cpoe_tipo_pedido) from cpoe_order_unit x where x.nr_sequencia = a.nr_seq_cpoe_order_unit) nr_seq_cpoe_tipo_pedido,
		a.ie_administracao,
		coalesce(b.cd_departamento_med, a.cd_departamento) cd_departamento,
	a.cd_intervalo
FROM cpoe_dieta a
LEFT OUTER JOIN cpoe_order_unit b ON (a.nr_seq_cpoe_order_unit = b.nr_sequencia)
WHERE a.dt_liberacao is not null and a.ie_tipo_dieta	= 'E'
 
union all

select	a.nr_sequencia,
		substr(Obter_desc_Dieta(a.CD_DIETA),1,4000) ds_html,
		substr(obter_desc_material(a.cd_material),1,255) ds_item,
		cpoe_get_tag_html('D',a.nr_sequencia,a.ds_observacao) ds_label_html,
		'D' ie_tipo_item,
		a.nr_atendimento,
		a.cd_pessoa_fisica,
		a.hr_prim_horario,
		a.dt_inicio,
		'SO' ie_tipo_item_cpoe,
		a.dt_lib_suspensao,
		a.cd_material,
		a.nm_usuario,
		a.dt_liberacao,
		a.dt_fim,
		padroniza_horario_prescr(a.ds_horarios, CASE WHEN substr(Obter_Se_horario_hoje(a.dt_inicio,a.dt_prim_horario,a.hr_prim_horario),1,1)='N' THEN '01/01/2000 23:59:59'  ELSE to_char(coalesce(dt_prim_horario,dt_inicio),'dd/mm/yyyy hh24:mi:ss') END ) ds_horarios,
        a.qt_dose,
		a.cd_unidade_medida_dose cd_unidade_medida,
		a.ie_via_aplicacao,	
		null nr_seq_cpoe_rp,
		a.nr_seq_cpoe_order_unit,
		(select max(x.nr_seq_cpoe_tipo_pedido) from cpoe_order_unit x where x.nr_sequencia = a.nr_seq_cpoe_order_unit) nr_seq_cpoe_tipo_pedido,
		a.ie_administracao,
		coalesce(b.cd_departamento_med,a.cd_departamento) cd_departamento,
	a.cd_intervalo
FROM cpoe_dieta a
LEFT OUTER JOIN cpoe_order_unit b ON (a.nr_seq_cpoe_order_unit = b.nr_sequencia)
WHERE a.dt_liberacao is not null and a.ie_tipo_dieta	= 'S'
 
union all

select	a.nr_sequencia,
		substr(Obter_desc_Dieta(a.CD_DIETA),1,4000) ds_html,
		substr(Obter_desc_tipo_jejum(a.nr_seq_tipo),1,255) ds_item,
		cpoe_get_tag_html('D',a.nr_sequencia,a.ds_observacao) ds_label_html,
		'D' ie_tipo_item,
		a.nr_atendimento,
		a.cd_pessoa_fisica,
		a.hr_prim_horario,
		a.dt_inicio,
		'J' ie_tipo_item_cpoe,
		a.dt_lib_suspensao,
		null cd_material,
		a.nm_usuario,
		a.dt_liberacao,
		a.dt_fim,
		padroniza_horario_prescr(a.ds_horarios, CASE WHEN substr(Obter_Se_horario_hoje(a.dt_inicio,a.dt_prim_horario,a.hr_prim_horario),1,1)='N' THEN '01/01/2000 23:59:59'  ELSE to_char(coalesce(dt_prim_horario,dt_inicio),'dd/mm/yyyy hh24:mi:ss') END ) ds_horarios,
        a.qt_dose,
		a.cd_unidade_medida_dose cd_unidade_medida,
		a.ie_via_aplicacao,	
		null nr_seq_cpoe_rp,
		a.nr_seq_cpoe_order_unit,
		(select max(x.nr_seq_cpoe_tipo_pedido) from cpoe_order_unit x where x.nr_sequencia = a.nr_seq_cpoe_order_unit) nr_seq_cpoe_tipo_pedido,
		a.ie_administracao,
		coalesce(b.cd_departamento_med,a.cd_departamento) cd_departamento,
	a.cd_intervalo
FROM cpoe_dieta a
LEFT OUTER JOIN cpoe_order_unit b ON (a.nr_seq_cpoe_order_unit = b.nr_sequencia)
WHERE a.dt_liberacao is not null and a.ie_tipo_dieta	= 'J'
 
union all

select	a.nr_sequencia,
		substr(Obter_desc_Dieta(a.CD_DIETA),1,4000) ds_html,
		substr(obter_desc_material(a.CD_MAT_PROD1),1,255) ds_item,
		cpoe_get_tag_html('D',a.nr_sequencia,a.ds_observacao) ds_label_html,
		'LD' ie_tipo_item,
		a.nr_atendimento,
		a.cd_pessoa_fisica,
		a.hr_prim_horario,
		a.dt_inicio,
		'N' ie_tipo_item_cpoe,
		a.dt_lib_suspensao,
		a.CD_MAT_PROD1 cd_material,
		a.nm_usuario,
		a.dt_liberacao,
		a.dt_fim,
		padroniza_horario_prescr(ds_horarios, CASE WHEN substr(Obter_Se_horario_hoje(a.dt_inicio,a.dt_prim_horario,a.hr_prim_horario),1,1)='N' THEN '01/01/2000 23:59:59'  ELSE to_char(coalesce(dt_prim_horario,dt_inicio),'dd/mm/yyyy hh24:mi:ss') END ) ds_horarios,
        a.qt_dose,
		a.cd_unidade_medida_dose cd_unidade_medida,
		a.ie_via_aplicacao,	
		null nr_seq_cpoe_rp,
		a.nr_seq_cpoe_order_unit,
		(select max(x.nr_seq_cpoe_tipo_pedido) from cpoe_order_unit x where x.nr_sequencia = a.nr_seq_cpoe_order_unit) nr_seq_cpoe_tipo_pedido,
		a.ie_administracao,
		coalesce(b.cd_departamento_med,a.cd_departamento) cd_departamento,
	a.cd_intervalo
FROM cpoe_dieta a
LEFT OUTER JOIN cpoe_order_unit b ON (a.nr_seq_cpoe_order_unit = b.nr_sequencia)
WHERE a.dt_liberacao is not null and a.ie_tipo_dieta	= 'L'
 
union all

select	a.nr_sequencia,
		'NPT '||substr(obter_desc_prot_npt(a.nr_seq_protocolo),1,255) ds_html,
		'NPT '||substr(obter_desc_prot_npt(a.nr_seq_protocolo),1,255) ds_item,
		cpoe_get_tag_html('D',a.nr_sequencia,a.ds_observacao) ds_label_html,
		'NA' ie_tipo_item,
		a.nr_atendimento,
		a.cd_pessoa_fisica,
		a.hr_prim_horario,
		a.dt_inicio,
		'N' ie_tipo_item_cpoe,
		a.dt_lib_suspensao,
		null cd_material,
		a.nm_usuario,
		a.dt_liberacao,
		a.dt_fim,
		padroniza_horario_prescr(a.ds_horarios, CASE WHEN substr(Obter_Se_horario_hoje(a.dt_inicio,a.dt_prim_horario,a.hr_prim_horario),1,1)='N' THEN '01/01/2000 23:59:59'  ELSE to_char(coalesce(dt_prim_horario,dt_inicio),'dd/mm/yyyy hh24:mi:ss') END ) ds_horarios,
        a.qt_dose,
		a.cd_unidade_medida_dose cd_unidade_medida,
		a.ie_via_aplicacao,	
		null nr_seq_cpoe_rp,
		a.nr_seq_cpoe_order_unit,
		(select max(x.nr_seq_cpoe_tipo_pedido) from cpoe_order_unit x where x.nr_sequencia = a.nr_seq_cpoe_order_unit) nr_seq_cpoe_tipo_pedido,
		a.ie_administracao,
		coalesce(b.cd_departamento_med,a.cd_departamento) cd_departamento,
	a.cd_intervalo
FROM cpoe_dieta a
LEFT OUTER JOIN cpoe_order_unit b ON (a.nr_seq_cpoe_order_unit = b.nr_sequencia)
WHERE a.dt_liberacao is not null and a.ie_tipo_dieta	=  'P'
 
union all

select	a.nr_sequencia,
		'NPT '||substr(obter_desc_prot_npt(a.nr_seq_protocolo),1,255) ds_html,
		'NPT '||substr(obter_desc_prot_npt(a.nr_seq_protocolo),1,255) ds_item,
		cpoe_get_tag_html('D',a.nr_sequencia,a.ds_observacao) ds_label_html,
		'NP' ie_tipo_item,
		a.nr_atendimento,
		a.cd_pessoa_fisica,
		a.hr_prim_horario,
		a.dt_inicio,
		'N' ie_tipo_item_cpoe,
		a.dt_lib_suspensao,
		null cd_material,
		a.nm_usuario,
		a.dt_liberacao,
		a.dt_fim,
		padroniza_horario_prescr(a.ds_horarios, CASE WHEN substr(Obter_Se_horario_hoje(a.dt_inicio,a.dt_prim_horario,a.hr_prim_horario),1,1)='N' THEN '01/01/2000 23:59:59'  ELSE to_char(coalesce(dt_prim_horario,dt_inicio),'dd/mm/yyyy hh24:mi:ss') END ) ds_horarios,
        a.qt_dose,
		a.cd_unidade_medida_dose cd_unidade_medida,
		a.ie_via_aplicacao,	
		null nr_seq_cpoe_rp,
		a.nr_seq_cpoe_order_unit,
		(select max(x.nr_seq_cpoe_tipo_pedido) from cpoe_order_unit x where x.nr_sequencia = a.nr_seq_cpoe_order_unit) nr_seq_cpoe_tipo_pedido,
		a.ie_administracao,
		coalesce(b.cd_departamento_med,a.cd_departamento) cd_departamento,
	a.cd_intervalo
FROM cpoe_dieta a
LEFT OUTER JOIN cpoe_order_unit b ON (a.nr_seq_cpoe_order_unit = b.nr_sequencia)
WHERE a.dt_liberacao is not null and a.ie_tipo_dieta	= 'I'
 
union all

select	a.nr_sequencia,
	substr(CPOE_Obter_desc_info_material(
		a.cd_material,
		a.cd_mat_comp1,
		a.qt_dose_comp1,
		a.cd_unid_med_dose_comp1,
		a.cd_mat_comp2,
		a.qt_dose_comp2,
		a.cd_unid_med_dose_comp2,
		a.cd_mat_comp3,
		a.qt_dose_comp3,
		a.cd_unid_med_dose_comp3,
		a.cd_mat_dil,
		a.qt_dose_dil,
		a.cd_unid_med_dose_dil,
		a.cd_mat_red,
		a.qt_dose_red,
		a.cd_unid_med_dose_red,	
		a.dt_liberacao,
		a.qt_dose,
		a.cd_unidade_medida,
		a.ie_via_aplicacao,
		a.cd_intervalo,
		a.dt_lib_suspensao,
		a.dt_suspensao,
		a.ie_administracao,
		a.nr_seq_ataque,
		a.nr_seq_procedimento,
		a.nr_seq_adicional,
		a.nr_seq_hemoterapia,
		a.ds_dose_diferenciada,
		a.ds_dose_diferenciada_dil,
		a.ds_dose_diferenciada_red,
		a.ds_dose_diferenciada_comp1,
		a.ds_dose_diferenciada_comp2,
		a.ds_dose_diferenciada_comp3,
		a.cd_mat_comp4,
		a.qt_dose_comp4,
		a.cd_unid_med_dose_comp4,
		a.ds_dose_diferenciada_comp4,
		a.cd_mat_comp5,
		a.qt_dose_comp5,
		a.cd_unid_med_dose_comp5,
		a.ds_dose_diferenciada_comp5,
		a.cd_mat_comp6,
		a.qt_dose_comp6,
		a.cd_unid_med_dose_comp6,
		a.ds_dose_diferenciada_comp6,
		a.dt_inicio,
		a.dt_fim, 
		a.dt_fim_cih,
		a.nr_dia_util,
		a.ie_antibiotico,
		a.ie_tipo_solucao,
		a.cd_mat_comp7,
		a.qt_dose_comp7,
		a.cd_unid_med_dose_comp7,
		a.ds_dose_diferenciada_comp7,
		null,
		null,
		null,
		null,
		null,
		a.ds_solucao,
		a.ie_duracao,
		a.ie_ref_calculo,
		a.nr_etapas,
		a.ie_controle_tempo,
		a.qt_dias_solicitado,
		a.qt_dias_liberado,
		a.nr_atendimento,
		a.ie_baixado_por_alta,
		a.dt_alta_medico,
		substr(cpoe_if_item_allowed(wheb_usuario_pck.get_cd_perfil,'DR'),1,80),
		'N',
		a.nr_sequencia,
		obter_horarios_regra(a.ds_horarios),
		null,
		a.ie_reset_atb,
		a.nr_seq_cpoe_anterior,
			a.ds_calc_therap_dose,
			null,
			a.qt_final_concentration,
		a.ie_um_final_conc_pca,               
			a.qt_dose_range_min,
			a.qt_dose_range_max,
			a.ie_dose_range,
		a.ds_medic_nao_padrao,
		a.ie_medicacao_paciente,
			'S',
		null,
		LOCALTIMESTAMP),1,4000) ds_html,
	substr(obter_desc_material(a.cd_material),1,255) ds_item,
	cpoe_get_tag_html('M',a.nr_sequencia,a.ds_observacao) ds_label_html,
	'M' ie_tipo_item,
	a.nr_atendimento,
	a.cd_pessoa_fisica,
	a.hr_prim_horario,
	a.dt_inicio,
	'M' ie_tipo_item_cpoe,
	a.dt_lib_suspensao,
	a.cd_material,
	a.nm_usuario,
	a.dt_liberacao,
	a.dt_fim,
	a.ds_horarios,
    a.qt_dose,
	a.cd_unidade_medida,
	a.ie_via_aplicacao,
	a.nr_seq_cpoe_rp,
	a.nr_seq_cpoe_order_unit,
	(select max(x.nr_seq_cpoe_tipo_pedido) from cpoe_order_unit x where x.nr_sequencia = a.nr_seq_cpoe_order_unit) nr_seq_cpoe_tipo_pedido,
	a.ie_administracao,
	coalesce(b.cd_departamento_med, a.cd_departamento) cd_departamento,
	a.cd_intervalo
FROM cpoe_material a
LEFT OUTER JOIN cpoe_order_unit b ON (a.nr_seq_cpoe_order_unit = b.nr_sequencia)
WHERE a.dt_liberacao is not null and a.ie_controle_tempo = 'N' and coalesce(a.ie_material,'N') = 'N'
 
union all

select	a.nr_sequencia,
substr(CPOE_Obter_desc_info_material(
	a.cd_material,
	a.cd_mat_comp1,
	a.qt_dose_comp1,
	a.cd_unid_med_dose_comp1,
	a.cd_mat_comp2,
	a.qt_dose_comp2,
	a.cd_unid_med_dose_comp2,
	a.cd_mat_comp3,
	a.qt_dose_comp3,
	a.cd_unid_med_dose_comp3,
	a.cd_mat_dil,
	a.qt_dose_dil,
	a.cd_unid_med_dose_dil,
	a.cd_mat_red,
	a.qt_dose_red,
	a.cd_unid_med_dose_red,	
	a.dt_liberacao,
	a.qt_dose,
	a.cd_unidade_medida,
	a.ie_via_aplicacao,
	a.cd_intervalo,
	a.dt_lib_suspensao,
	a.dt_suspensao,
	a.ie_administracao,
	a.nr_seq_ataque,
	a.nr_seq_procedimento,
	a.nr_seq_adicional,
	a.nr_seq_hemoterapia,
	a.ds_dose_diferenciada,
	a.ds_dose_diferenciada_dil,
	a.ds_dose_diferenciada_red,
	a.ds_dose_diferenciada_comp1,
	a.ds_dose_diferenciada_comp2,
	a.ds_dose_diferenciada_comp3,
	a.cd_mat_comp4,
	a.qt_dose_comp4,
	a.cd_unid_med_dose_comp4,
	a.ds_dose_diferenciada_comp4,
	a.cd_mat_comp5,
	a.qt_dose_comp5,
	a.cd_unid_med_dose_comp5,
	a.ds_dose_diferenciada_comp5,
	a.cd_mat_comp6,
	a.qt_dose_comp6,
	a.cd_unid_med_dose_comp6,
	a.ds_dose_diferenciada_comp6,
	a.dt_inicio,
	a.dt_fim, 
	a.dt_fim_cih,
	a.nr_dia_util,
	a.ie_antibiotico,
	a.ie_tipo_solucao,
	a.cd_mat_comp7,
	a.qt_dose_comp7,
	a.cd_unid_med_dose_comp7,
	a.ds_dose_diferenciada_comp7,
	null,
	null,
	null,
	null,
	null,
	a.ds_solucao,
	a.ie_duracao,
	a.ie_ref_calculo,
	a.nr_etapas,
	a.ie_controle_tempo,
	a.qt_dias_solicitado,
	a.qt_dias_liberado,
	a.nr_atendimento,
	a.ie_baixado_por_alta,
	a.dt_alta_medico,
	substr(cpoe_if_item_allowed(wheb_usuario_pck.get_cd_perfil,'DR'),1,80),
	'N',
	a.nr_sequencia,
	obter_horarios_regra(ds_horarios),
	null,
	a.ie_reset_atb,
	a.nr_seq_cpoe_anterior,
                a.ds_calc_therap_dose,
                null,
                a.qt_final_concentration,
	a.ie_um_final_conc_pca,               
                a.qt_dose_range_min,
                a.qt_dose_range_max,
                a.ie_dose_range,
	a.ds_medic_nao_padrao,
	a.ie_medicacao_paciente,
                'S',
	null,
	LOCALTIMESTAMP),1,4000) ds_html,
	substr(obter_desc_material(a.cd_material),1,255) ds_item,
	cpoe_get_tag_html('SOL',a.nr_sequencia,a.ds_OBSERVACAO) ds_label_html,
	'SOL' ie_tipo_item,
	a.nr_atendimento,
	a.cd_pessoa_fisica,
	a.hr_prim_horario,
	a.dt_inicio,
	'M' ie_tipo_item_cpoe,
	a.dt_lib_suspensao,
	a.cd_material,
	a.nm_usuario,
	a.dt_liberacao,
	a.dt_fim,
	a.ds_horarios,
    a.qt_dose,
	a.cd_unidade_medida,
	a.ie_via_aplicacao,
	null nr_seq_cpoe_rp,
	a.nr_seq_cpoe_order_unit,
	(select max(x.nr_seq_cpoe_tipo_pedido) from cpoe_order_unit x where x.nr_sequencia = a.nr_seq_cpoe_order_unit) nr_seq_cpoe_tipo_pedido,
	a.ie_administracao,
	coalesce(b.cd_departamento_med,a.cd_departamento) cd_departamento,
	a.cd_intervalo
FROM cpoe_material a
LEFT OUTER JOIN cpoe_order_unit b ON (a.nr_seq_cpoe_order_unit = b.nr_sequencia)
WHERE a.dt_liberacao is not null and a.ie_controle_tempo = 'S' and coalesce(a.ie_material,'N') = 'N'
 
union all

select	a.nr_sequencia,
 substr(CPOE_Obter_desc_info_material(
	a.cd_material,
	a.cd_mat_comp1,
	a.qt_dose_comp1,
	a.cd_unid_med_dose_comp1,
	a.cd_mat_comp2,
	a.qt_dose_comp2,
	a.cd_unid_med_dose_comp2,
	a.cd_mat_comp3,
	a.qt_dose_comp3,
	a.cd_unid_med_dose_comp3,
	a.cd_mat_dil,
	a.qt_dose_dil,
	a.cd_unid_med_dose_dil,
	a.cd_mat_red,
	a.qt_dose_red,
	a.cd_unid_med_dose_red,	
	a.dt_liberacao,
	a.qt_dose,
	a.cd_unidade_medida,
	a.ie_via_aplicacao,
	a.cd_intervalo,
	a.dt_lib_suspensao,
	a.dt_suspensao,
	a.ie_administracao,
	a.nr_seq_ataque,
	a.nr_seq_procedimento,
	a.nr_seq_adicional,
	a.nr_seq_hemoterapia,
	a.ds_dose_diferenciada,
	a.ds_dose_diferenciada_dil,
	a.ds_dose_diferenciada_red,
	a.ds_dose_diferenciada_comp1,
	a.ds_dose_diferenciada_comp2,
	a.ds_dose_diferenciada_comp3,
	a.cd_mat_comp4,
	a.qt_dose_comp4,
	a.cd_unid_med_dose_comp4,
	a.ds_dose_diferenciada_comp4,
	a.cd_mat_comp5,
	a.qt_dose_comp5,
	a.cd_unid_med_dose_comp5,
	a.ds_dose_diferenciada_comp5,
	a.cd_mat_comp6,
	a.qt_dose_comp6,
	a.cd_unid_med_dose_comp6,
	a.ds_dose_diferenciada_comp6,
	a.dt_inicio,
	a.dt_fim, 
	a.dt_fim_cih,
	a.nr_dia_util,
	a.ie_antibiotico,
	a.ie_tipo_solucao,
	a.cd_mat_comp7,
	a.qt_dose_comp7,
	a.cd_unid_med_dose_comp7,
	a.ds_dose_diferenciada_comp7,
	null,
	null,
	null,
	null,
	null,
	a.ds_solucao,
	a.ie_duracao,
	a.ie_ref_calculo,
	a.nr_etapas,
	a.ie_controle_tempo,
	a.qt_dias_solicitado,
	a.qt_dias_liberado,
	a.nr_atendimento,
	a.ie_baixado_por_alta,
	a.dt_alta_medico,
	substr(cpoe_if_item_allowed(wheb_usuario_pck.get_cd_perfil,'DR'),1,80),
	'N',
	a.nr_sequencia,
	obter_horarios_regra(a.ds_horarios),
	null,
	a.ie_reset_atb,
	a.nr_seq_cpoe_anterior,
                a.ds_calc_therap_dose,
                null,
                a.qt_final_concentration,
	a.ie_um_final_conc_pca,               
               a.qt_dose_range_min,
                a.qt_dose_range_max,
               a.ie_dose_range,
	a.ds_medic_nao_padrao,
	a.ie_medicacao_paciente,
                'S',
	null,
	LOCALTIMESTAMP),1,4000) ds_html,
	substr(obter_desc_material(a.cd_material),1,255) ds_item,
	cpoe_get_tag_html('MAT',a.nr_sequencia,a.ds_observacao) ds_label_html,
	'MAT' ie_tipo_item,
	a.nr_atendimento,
	a.cd_pessoa_fisica,
	a.hr_prim_horario,
	a.dt_inicio,
	'MA' ie_tipo_item_cpoe,
	a.dt_lib_suspensao,
	a.cd_material,
	a.nm_usuario,
	a.dt_liberacao,
	a.dt_fim,
	a.ds_horarios,
    a.qt_dose,
	a.cd_unidade_medida,
	a.ie_via_aplicacao,
	null nr_seq_cpoe_rp,
	a.nr_seq_cpoe_order_unit,
	(select max(x.nr_seq_cpoe_tipo_pedido) from cpoe_order_unit x where x.nr_sequencia = a.nr_seq_cpoe_order_unit) nr_seq_cpoe_tipo_pedido,
	a.ie_administracao,
	coalesce(b.cd_departamento_med,a.cd_departamento) cd_departamento,
	a.cd_intervalo
FROM cpoe_material a
LEFT OUTER JOIN cpoe_order_unit b ON (a.nr_seq_cpoe_order_unit = b.nr_sequencia)
WHERE a.dt_liberacao is not null and coalesce(a.ie_material,'N') = 'S'
 
union all

select	a.nr_sequencia,
	substr(cpoe_obter_desc_grid_proc(
	  substr(cpoe_obter_desc_proc_interno(a.nr_seq_proc_interno),1,255), 
	  a.cd_intervalo, 
	  a.qt_procedimento, 
	  a.cd_mat_proc1, 
	  a.qt_dose_mat1, 
	  a.cd_unid_medida_dose_mat1, 
	  a.ie_assoc_adep1, 
	  a.cd_mat_proc2, 
	  a.qt_dose_mat2, 
	  a.cd_unid_medida_dose_mat2, 
	  a.ie_assoc_adep2, 
	  a.cd_mat_proc3, 
	  a.qt_dose_mat3, 
	  a.cd_unid_medida_dose_mat3, 
	  a.ie_assoc_adep3, 
	  a.cd_mat_proc4, 
	  a.qt_dose_mat4, 
	  a.cd_unid_medida_dose_mat4, 
	  a.ie_assoc_adep4, 
	  a.cd_mat_proc5, 
	  a.qt_dose_mat5, 
	  a.cd_unid_medida_dose_mat5, 
	  a.ie_assoc_adep5, 
	  a.dt_lib_suspensao,
	  a.dt_suspensao, 
	  a.ie_administracao, 
	  null, 
	  null, 
	  a.cd_mat_proc6, 
	  a.qt_dose_mat6, 
	  a.cd_unid_medida_dose_mat6, 
	  a.ie_assoc_adep6, 
	  a.cd_mat_proc7, 
	  a.qt_dose_mat7, 
	  a.cd_unid_medida_dose_mat7, 
	  a.ie_assoc_adep7, 
	  a.cd_mat_dil1, 
	  a.qt_dose_dil1, 
	  a.cd_unid_medida_dose_dil1, 
	  a.cd_mat_dil2, 
	  a.qt_dose_dil2, 
	  a.cd_unid_medida_dose_dil2, 
	  a.cd_mat_dil3, 
	  a.qt_dose_dil3, 
	  a.cd_unid_medida_dose_dil3, 
	  a.cd_mat_dil4, 
	  a.qt_dose_dil4, 
	  a.cd_unid_medida_dose_dil4, 
	  a.cd_mat_dil5, 
	  a.qt_dose_dil5, 
	  a.cd_unid_medida_dose_dil5, 
	  a.cd_mat_dil6, 
	  a.qt_dose_dil6, 
	  a.cd_unid_medida_dose_dil6, 
	  a.cd_mat_dil7, 
	  a.qt_dose_dil7, 
	  a.cd_unid_medida_dose_dil7, 
	  a.cd_mat_recons1, 
	  a.qt_dose_recons1, 
	  a.cd_unid_medida_dose_recons1, 
	  a.cd_mat_recons2, 
	  a.qt_dose_recons2, 
	  a.cd_unid_medida_dose_recons2, 
	  a.cd_mat_recons3,	
	  a.qt_dose_recons3, 
	  a.cd_unid_medida_dose_recons3, 
	  a.cd_mat_recons4, 
	  a.qt_dose_recons4, 
	  a.cd_unid_medida_dose_recons4,	
	  a.cd_mat_recons5, 
	  a.qt_dose_recons5, 
	  a.cd_unid_medida_dose_recons5, 
	  a.cd_mat_recons6, 
	  a.qt_dose_recons6, 
	  a.cd_unid_medida_dose_recons6,	
	  a.cd_mat_recons7, 
	  a.qt_dose_recons7, 
	  a.cd_unid_medida_dose_recons7,
	  a.ie_baixado_por_alta,
	  a.dt_alta_medico,
	substr(cpoe_if_item_allowed(wheb_usuario_pck.get_cd_perfil,'DR'),1,80),
	 'N',
	 null,
	 obter_horarios_regra(a.ds_horarios),
	 null,
	 a.nr_seq_prot_glic
	),1,4000) ds_html,
	substr(obter_desc_proc_interno(a.nr_seq_proc_interno),1,255) ds_item,
	cpoe_get_tag_html('P',a.nr_sequencia,a.ds_observacao) ds_label_html,
	'P' ie_tipo_item,
	a.nr_atendimento,
	a.cd_pessoa_fisica,
	a.hr_prim_horario,
	a.dt_inicio,
	'P' ie_tipo_item_cpoe,
	a.dt_lib_suspensao,
	null cd_material,
	a.nm_usuario,
	a.dt_liberacao,
	a.dt_fim,
	a.ds_horarios,
    null qt_dose,
	null cd_unidade_medida,
	null ie_via_aplicacao,
	null nr_seq_cpoe_rp,
	a.nr_seq_cpoe_order_unit,
	(select max(x.nr_seq_cpoe_tipo_pedido) from cpoe_order_unit x where x.nr_sequencia = a.nr_seq_cpoe_order_unit) nr_seq_cpoe_tipo_pedido,
	a.ie_administracao,
	coalesce(b.cd_departamento_med,a.cd_departamento) cd_departamento,
	a.cd_intervalo
FROM cpoe_procedimento a
LEFT OUTER JOIN cpoe_order_unit b ON (a.nr_seq_cpoe_order_unit = b.nr_sequencia)
WHERE a.dt_liberacao is not null
 
union all

select	a.nr_sequencia,
	substr(CPOE_OBTER_DESC_GRID_GAS(
		  substr(CPOE_Obter_Desc_Gas(a.nr_seq_gas,a.dt_liberacao),1,254), 
		  a.QT_GASOTERAPIA, 
		  CPOE_OBTER_DESC_UNID_MED_GAS(a.IE_UNIDADE_MEDIDA), 
		  substr(obter_valor_dominio(1299, a.ie_respiracao),1,200), 
		  substr(obter_desc_intervalo_prescr(a.cd_intervalo),1,255),
		  a.dt_lib_suspensao,
		  a.dt_suspensao, 
		  a.ie_administracao,
		  a.ie_baixado_por_alta,
		  a.dt_alta_medico,
		  obter_horarios_regra(a.ds_horarios),
		  a.ie_respiracao,
		  a.ie_disp_resp_esp,
		  a.cd_modalidade_vent
		) ,1,4000) ds_html,
	substr(obter_desc_gas(a.nr_seq_gas),1,255) ds_item,
	cpoe_get_tag_html('O',a.nr_sequencia,a.ds_observacao) ds_label_html,
	'G' ie_tipo_item,
	a.nr_atendimento,
	a.cd_pessoa_fisica,
	a.hr_prim_horario,
	a.dt_inicio,
	'G' ie_tipo_item_cpoe,
	a.dt_lib_suspensao,
	null cd_material,
	a.nm_usuario,
	a.dt_liberacao,
	a.dt_fim,
	Padroniza_horario_prescr(a.ds_horarios,coalesce(a.dt_prev_execucao,a.dt_inicio)) ds_horarios,
    null qt_dose,
	null cd_unidade_medida,
	null ie_via_aplicacao,
	null nr_seq_cpoe_rp,
	a.nr_seq_cpoe_order_unit,
	(select max(x.nr_seq_cpoe_tipo_pedido) from cpoe_order_unit x where x.nr_sequencia = a.nr_seq_cpoe_order_unit) nr_seq_cpoe_tipo_pedido,
	a.ie_administracao,
	coalesce(b.cd_departamento_med,a.cd_departamento) cd_departamento,
	a.cd_intervalo
FROM cpoe_gasoterapia a
LEFT OUTER JOIN cpoe_order_unit b ON (a.nr_seq_cpoe_order_unit = b.nr_sequencia)
WHERE a.dt_liberacao is not null
 
union all

select	a.nr_sequencia,
		SUBSTR(CPOE_OBTER_DESC_GRID_RECOM(
  substr(cpoe_obter_desc_recomendacao(a.cd_recomendacao,a.dt_liberacao),1,255), 
  substr(obter_desc_intervalo_prescr(a.cd_intervalo),1,255),
  a.dt_lib_suspensao,
  a.dt_suspensao, 
  a.ie_administracao, 
  a.ds_recomendacao,
  a.ie_baixado_por_alta,
  a.dt_alta_medico,
obter_horarios_regra(a.ds_horarios)
),1,4000) ds_html,
	substr(obter_desc_recomendacao(a.cd_recomendacao),1,255) ds_item,
	cpoe_get_tag_html('R',a.nr_sequencia,a.ds_observacao) ds_label_html,
	'R' ie_tipo_item,
	a.nr_atendimento,
	a.cd_pessoa_fisica,
	a.hr_prim_horario,
	a.dt_inicio,
	'R' ie_tipo_item_cpoe,
	a.dt_lib_suspensao,
	null cd_material,
	a.nm_usuario,
	a.dt_liberacao,
	a.dt_fim,
	a.ds_horarios,
    null qt_dose,
	null cd_unidade_medida,
	null ie_via_aplicacao,
	null nr_seq_cpoe_rp,
	a.nr_seq_cpoe_order_unit,
	(select max(x.nr_seq_cpoe_tipo_pedido) from cpoe_order_unit x where x.nr_sequencia = a.nr_seq_cpoe_order_unit) nr_seq_cpoe_tipo_pedido,
	a.ie_administracao,
	coalesce(b.cd_departamento_med,a.cd_departamento) cd_departamento,
	a.cd_intervalo
FROM cpoe_recomendacao a
LEFT OUTER JOIN cpoe_order_unit b ON (a.nr_seq_cpoe_order_unit = b.nr_sequencia)
WHERE a.dt_liberacao is not null
 
union all

select	a.nr_sequencia,
	substr(cpoe_obter_ds_hemoterapia(
		a.NR_SEQUENCIA, 
		a.dt_liberacao,
		'S', 
		a.dt_lib_suspensao,
		a.dt_suspensao,
		a.ie_tipo,
		a.qt_procedimento,
		a.ie_reserva,
		a.ie_baixado_por_alta,
		a.dt_alta_medico,
		'N',
		obter_horarios_regra(a.ds_horarios)), 1, 2000) ds_html,
	substr(cpoe_obter_desc_info_hemote(a.NR_SEQUENCIA),1,255) ds_item,
	cpoe_get_tag_html('HM',a.nr_sequencia,a.ds_observacao) ds_label_html,
	'HM' ie_tipo_item,
	a.nr_atendimento,
	a.cd_pessoa_fisica,
	to_char(a.dt_inicio,'hh24:mi') hr_prim_horario,
	a.dt_inicio,
	'H' ie_tipo_item_cpoe,
	a.dt_lib_suspensao,
	null cd_material,
	a.nm_usuario,
	a.dt_liberacao,
	a.dt_fim,
	a.ds_horarios,
    null qt_dose,
	null cd_unidade_medida,
	a.ie_via_aplicacao,
	null nr_seq_cpoe_rp,
	a.nr_seq_cpoe_order_unit,
	(select max(x.nr_seq_cpoe_tipo_pedido) from cpoe_order_unit x where x.nr_sequencia = a.nr_seq_cpoe_order_unit) nr_seq_cpoe_tipo_pedido,
	null ie_administracao,
	coalesce(b.cd_departamento_med,a.cd_departamento) cd_departamento,
	a.cd_intervalo
FROM cpoe_hemoterapia a
LEFT OUTER JOIN cpoe_order_unit b ON (a.nr_seq_cpoe_order_unit = b.nr_sequencia)
WHERE a.dt_liberacao is not null
 
union all

select	a.nr_sequencia,
	SUBSTR(CPOE_Obter_desc_dialise( 
  a.ie_tipo_dialise, 
  a.nr_seq_protocolo, 
  a.dt_lib_suspensao, 
  a.dt_suspensao, 
  a.qt_fluxo_sangue, 
  a.qt_hora_min_sessao, 
  'S', 
  a.ie_hemodialise, 
  a.ie_tipo_peritoneal, 
  a.qt_volume_ciclo, 
  a.qt_hora_min_duracao, 
  a.ie_categoria, 
  a.dt_atualizacao_peso,
  a.ie_baixado_por_alta,
  a.dt_alta_medico,
  'N',
  null,
  obter_horarios_regra(a.ds_horarios)
),1,4000) ds_html,
		substr(CPOE_Obter_desc_dialise( a.ie_tipo_dialise, a.nr_seq_protocolo, a.dt_lib_suspensao, a.dt_suspensao, a.qt_fluxo_sangue, a.qt_hora_min_sessao, 'N', a.ie_hemodialise, a.ie_tipo_peritoneal,a. qt_volume_ciclo, a.qt_hora_min_duracao, a.ie_categoria),1,255) ds_item,
		cpoe_get_tag_html('DI',a.nr_sequencia,a.ds_observacao) ds_label_html,
		'DI' ie_tipo_item,
		a.nr_atendimento,
		a.cd_pessoa_fisica,
		to_char(a.dt_inicio,'hh24:mi') hr_prim_horario,
		a.dt_inicio,
		'D' ie_tipo_item_cpoe,
		a.dt_lib_suspensao,
		null cd_material,
		a.nm_usuario,
		a.dt_liberacao,
		a.dt_fim,
		a.ds_horarios,
        null qt_dose,
		null cd_unidade_medida,
		null ie_via_aplicacao,
		null nr_seq_cpoe_rp,
		a.nr_seq_cpoe_order_unit,
		(select max(x.nr_seq_cpoe_tipo_pedido) from cpoe_order_unit x where x.nr_sequencia = a.nr_seq_cpoe_order_unit) nr_seq_cpoe_tipo_pedido,
		a.ie_administracao,
		coalesce(b.cd_departamento_med,a.cd_departamento) cd_departamento,
	null cd_intervalo
FROM cpoe_dialise a
LEFT OUTER JOIN cpoe_order_unit b ON (a.nr_seq_cpoe_order_unit = b.nr_sequencia)
WHERE a.dt_liberacao is not null
 
union all

select	a.nr_sequencia,
 cpoe_obter_desc_grid_proc(substr(cpoe_obter_desc_proc_interno(a.nr_seq_proc_interno),1,255), null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,
 a.dt_lib_suspensao, a.dt_suspensao, a.ie_administracao, 
 null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,
 a.ie_baixado_por_alta, a.dt_alta_medico) ds_html,
		substr(Obter_Desc_Proc_Interno(a.NR_SEQ_PROC_INTERNO),1,255) ds_item,
		cpoe_get_tag_html('AP',a.nr_sequencia,a.ds_observacao) ds_label_html,
		'AP' ie_tipo_item,
		a.nr_atendimento,
		a.cd_pessoa_fisica,
		to_char(a.dt_inicio,'hh24:mi') hr_prim_horario,
		a.dt_inicio,
		'AP' ie_tipo_item_cpoe,
		a.dt_lib_suspensao,
		null cd_material,
		a.nm_usuario,
		a.dt_liberacao,
		a.dt_fim,
		null ds_horarios,
    null qt_dose,
		null cd_unidade_medida,
		null ie_via_aplicacao,
		null nr_seq_cpoe_rp,
		a.nr_seq_cpoe_order_unit,
		(select max(x.nr_seq_cpoe_tipo_pedido) from cpoe_order_unit x where x.nr_sequencia = a.nr_seq_cpoe_order_unit) nr_seq_cpoe_tipo_pedido,
		a.ie_administracao,
		coalesce(b.cd_departamento_med,a.cd_departamento) cd_departamento,
	null cd_intervalo
FROM cpoe_anatomia_patologica a
LEFT OUTER JOIN cpoe_order_unit b ON (a.nr_seq_cpoe_order_unit = b.nr_sequencia)
WHERE a.dt_liberacao is not null;

