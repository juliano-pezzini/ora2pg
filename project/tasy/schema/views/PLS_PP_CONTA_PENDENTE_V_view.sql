-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_pp_conta_pendente_v (nr_sequencia, ie_status, cd_item, ds_item, vl_liberado, nm_segurado, cd_guia, nm_prestador_atend, nm_profissional, nm_evento, nm_pp_evento, nr_seq_conta, pr_liberado, nr_seq_regra_valor, ds_tipo_contrat, ds_estip, vl_taxa_adm, nr_seq_protocolo, nr_seq_prot_referencia, dt_competencia_pgto, ds_evento, ds_pp_evento, ds_periodo_pgto, nr_seq_regra_pgto, nr_seq_evento, nr_seq_pp_evento, nr_seq_prestador_pgto, nm_prestador_pgto, ds_tipo_pagamento) AS select	a.nr_sequencia,
	a.ie_status,
	CASE WHEN coalesce(a.cd_procedimento,0)=0 THEN a.nr_seq_material  ELSE a.cd_procedimento END  cd_item,
	substr(CASE WHEN coalesce(a.cd_procedimento,0)=0 THEN pls_obter_desc_material(a.nr_seq_material)  ELSE obter_descricao_procedimento(a.cd_procedimento,a.ie_origem_proced) END ,1,255) ds_item,
	a.vl_liberado,
	substr(pls_obter_dados_segurado(a.nr_seq_segurado, 'N'),1,80) nm_segurado,
	a.cd_guia,
	substr(pls_obter_dados_prestador(a.nr_seq_prestador_atend,'N'),1,255) nm_prestador_atend,
	substr(obter_nome_pf(a.cd_pessoa_fisica),1,60) nm_profissional,
	substr(pls_obter_nome_evento_pgto(a.nr_seq_evento),1,170) nm_evento,
	substr(pls_obter_nome_evento_pgto(a.nr_seq_pp_evento),1,170) nm_pp_evento,
	a.nr_seq_conta,
	a.pr_liberado,
	a.nr_seq_regra_valor,
	substr(obter_valor_dominio(1666,a.ie_tipo_contratacao),1,255) ds_tipo_contrat,
	substr(pls_obter_dados_segurado(a.nr_seq_segurado,'ES'),1,255) ds_estip,
	a.vl_taxa_adm,
	a.nr_seq_protocolo,
	a.nr_seq_prot_referencia,
	a.dt_competencia_pgto,
	substr(pls_obter_desc_evento(a.nr_seq_evento),1,255) ds_evento,
	substr(pls_obter_desc_evento(a.nr_seq_pp_evento),1,255) ds_pp_evento,
	substr(pls_obter_desc_periodo(a.nr_seq_periodo_pgto),1,255)  ds_periodo_pgto,
	a.nr_seq_regra_pgto,
	a.nr_seq_evento,
	a.nr_seq_pp_evento,
	a.nr_seq_prestador_pgto,
	substr(pls_obter_dados_prestador(a.nr_seq_prestador_pgto,'N'),1,255) nm_prestador_pgto,
	obter_desc_expressao(	CASE WHEN a.ie_tipo_data_pagamento='M' THEN 647483  ELSE CASE WHEN a.ie_tipo_data_pagamento='P' THEN 1040102  ELSE CASE WHEN a.ie_tipo_data_pagamento='R' THEN 343441  ELSE '' END  END  END , null) ds_tipo_pagamento
FROM	pls_conta_medica_resumo	a
where 	a.ie_situacao	= 'A'
and	a.ie_tipo_item <> 'I'
and	a.nr_seq_lote_pgto is null
and	a.nr_seq_pp_lote is null;

