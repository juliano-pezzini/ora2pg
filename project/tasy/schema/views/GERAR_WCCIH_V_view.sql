-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW gerar_wccih_v (nr_atendimento, cd_setor_atendimento, ds_setor_atendimento, nr_ficha_ocorrencia) AS select distinct
 b.nr_atendimento, 
 d.cd_setor_atendimento, 
 d.ds_setor_atendimento, 
 (select max(nr_ficha_ocorrencia) 
 FROM cih_ficha_ocorrencia f 
 where f.nr_atendimento = b.nr_atendimento) nr_ficha_ocorrencia 
from  atendimento_paciente b, 
 atend_paciente_unidade c, 
 setor_atendimento d 
where  b.nr_atendimento    = c.nr_atendimento 
and d.cd_setor_atendimento = c.cd_setor_atendimento 
and b.nr_atendimento is not null 
AND (c.NR_SEQ_INTERNO = OBTER_ATEPACU_PACIENTE(b.NR_ATENDIMENTO, 'A')) 
and d.ie_situacao = 'A' 
and d.cd_estabelecimento = 1 
and b.dt_entrada > to_date('01/01/2010','dd/mm/yyyy') 

union
 
select distinct 
 e.nr_atendimento, 
 c.cd_setor_atendimento, 
 c.ds_setor_atendimento, 
 (select max(nr_ficha_ocorrencia) 
 from cih_ficha_ocorrencia f 
 where f.nr_atendimento = b.nr_atendimento) nr_ficha_ocorrencia 
from  unidade_atendimento b, 
 setor_atendimento c, 
 atendimento_paciente e 
where  b.cd_setor_atendimento     = c.cd_setor_atendimento 
and e.nr_atendimento = b.nr_atendimento 
and b.nr_atendimento is not null 
and c.ie_situacao = 'A' 
and c.cd_estabelecimento = 1 
and e.dt_entrada > to_date('01/01/2010','dd/mm/yyyy');

