-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW lab_recoleta_exame_v (nm_exame, nr_seq_exame, ds_observacao, ds_motivo_recoleta, cd_motivo_recoleta, ie_tipo_atendimento, ds_tipo_atendimento, dt_prescricao, nr_atendimento, cd_setor_coleta, nm_usuario_recoleta, cd_material_exame, ds_material, ds_setor_coleta, cd_setor_atendimento, ds_setor_atendimento, nm_usuario_coleta_recoleta, setor_prescr, ds_setor_atend_prescr) AS SELECT	e.nm_exame,
 	e.nr_seq_exame,
	c.ds_observacao,
	l.ds_motivo_recoleta,
                l.nr_sequencia cd_motivo_recoleta,
	v.ie_tipo_atendimento,
	substr(OBTER_NOME_TIPO_ATEND(v.ie_tipo_atendimento),1,50) ds_tipo_atendimento,
	m.dt_prescricao,
	v.nr_atendimento,
	c.cd_setor_coleta,
	lab_obter_data_recoleta(c.nr_prescricao, c.nr_sequencia, c.nm_usuario, 2) nm_usuario_recoleta,
	c.cd_material_exame,
	(select MAX(ds_material_exame) FROM material_exame_lab where cd_material_exame = c.cd_material_exame)ds_material,
	substr(obter_nome_setor(c.cd_setor_coleta),1,200) ds_setor_coleta,
	c.cd_setor_atendimento,
	OBTER_DESC_SETOR_ATEND(c.cd_setor_atendimento) ds_setor_atendimento,
	lab_obter_data_recoleta(c.nr_prescricao, c.nr_sequencia, c.nm_usuario, 4) nm_usuario_coleta_recoleta,
	m.cd_setor_atendimento setor_prescr,
	OBTER_DESC_SETOR_ATEND(m.cd_setor_atendimento) ds_setor_atend_prescr
FROM  	exame_laboratorio e,
	prescr_medica m,
	atendimento_paciente v,
	prescr_procedimento c,
	lab_motivo_recoleta l
WHERE 	1=1
AND 	v.nr_atendimento = m.nr_atendimento
AND 	c.nr_prescricao = m.nr_prescricao
AND 	e.nr_seq_exame = c.nr_seq_exame
AND 	c.nr_seq_recoleta = l.nr_sequencia
AND 	c.nr_seq_recoleta IS NOT NULL;

