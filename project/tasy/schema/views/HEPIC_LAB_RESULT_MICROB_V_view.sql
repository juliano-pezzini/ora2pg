-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW hepic_lab_result_microb_v (nr_atendimento, ds_modulo, dt_admissao, nr_prescricao, nr_prontuario, ds_unidade_internacao, dt_coleta, dt_positivacao_resultado, dt_validacao_resultado, dt_validacao_final, cd_exame, cd_material, cd_metodo, cd_microrganismo, cd_medicamento, ie_resultado) AS select  a.nr_atendimento                                                    nr_atendimento,
			upper(substr(obter_valor_dominio(12, a.ie_tipo_atendimento),1,50))  ds_modulo,
			a.dt_entrada                                                        dt_admissao,
			p.nr_prescricao                                                     nr_prescricao,
			f.nr_prontuario                                                     nr_prontuario,
			s.ds_setor_atendimento                                              ds_unidade_internacao,
			i.dt_coleta                                                         dt_coleta,
			i.dt_aprovacao                                                      dt_positivacao_resultado,
			i.dt_liberacao                                                      dt_validacao_resultado,
			i.dt_liberacao                                                      dt_validacao_final,
			r.nr_seq_exame                                                      cd_exame,
			i.nr_seq_material                                                   cd_material,
			i.nr_seq_metodo                                                     cd_metodo,
			b.cd_microorganismo                                                 cd_microrganismo,
			b.cd_medicamento                                                    cd_medicamento,
			b.ie_resultado
	FROM    atendimento_paciente a,
			prescr_medica p,
			setor_atendimento s,
			prescr_procedimento r,
			pessoa_fisica f,
			exame_lab_resultado e,
			exame_lab_result_item i,
			exame_lab_result_antib b,
			exame_laboratorio l,
			lab_exame_equip x,
			equipamento_lab q
	where   a.nr_atendimento        = p.nr_atendimento
	and     a.cd_pessoa_fisica      = f.cd_pessoa_fisica
	and     r.nr_prescricao         = p.nr_prescricao
	and     e.nr_prescricao         = p.nr_prescricao
	and     e.nr_atendimento        = a.nr_atendimento
	and     e.nr_seq_resultado      = i.nr_seq_resultado
	and     p.cd_setor_atendimento  = s.cd_setor_atendimento
	and     r.nr_sequencia          = i.nr_seq_prescr
	and     r.nr_seq_exame          = l.nr_seq_exame
	and     r.nr_seq_exame          = x.nr_seq_exame
	and     x.cd_equipamento        = q.cd_equipamento
	and     b.nr_seq_resultado      = e.nr_seq_resultado
	and     b.nr_seq_result_item    = i.nr_sequencia
	and     q.ds_sigla              = 'HEPIC'
	and     l.ie_formato_resultado  = 'SM'
	and     upper(i.ds_resultado)   = 'POSITIVO'
	and     r.ie_status_atend       > 30
	and     i.dt_aprovacao          is not null
	order by
			a.nr_atendimento,
			p.nr_prescricao,
			i.nr_seq_resultado;

