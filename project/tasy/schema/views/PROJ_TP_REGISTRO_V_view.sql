-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW proj_tp_registro_v (ie_ordem, nr_seq_modulo, nr_seq_implantacao, nr_seq_roteiro, nr_seq_item, nr_seq_item_result, nr_seq_rot_cli, nr_seq_cliente, ds_item, ie_resultado, nm_responsavel, ie_parametrizado, ie_multiplicador, ie_recurso_tecnico, ie_usuario_treinado, pr_efetividade) AS select	1 ie_ordem,
	a.nr_sequencia nr_seq_modulo,
	a.nr_seq_implantacao,
	b.nr_seq_roteiro,
	null nr_seq_item,
	null nr_seq_item_result,
	b.nr_sequencia nr_seq_rot_cli,
	b.nr_seq_cliente,
	a.nm_modulo ds_item,
	null ie_resultado,
	null nm_responsavel,
	null ie_parametrizado,
	null ie_multiplicador,
	null ie_recurso_tecnico,
	null ie_usuario_treinado,
	proj_tp_mod_rot_aderencia(nr_seq_cliente,nr_seq_modulo) pr_efetividade
FROM	proj_tp_roteiro c,
	proj_tp_cli_rot b,
        modulo_implantacao a
where	b.nr_seq_roteiro = c.nr_sequencia
and	a.nr_sequencia = c.nr_seq_modulo

union

select	2,
       (proj_obter_dados_roteiro(nr_seq_roteiro,'M'))::numeric  nr_seq_modulo,
	proj_obter_dados_mod_implant(proj_obter_dados_roteiro(nr_seq_roteiro,'M'), 'S') nr_seq_implantacao,
       a.nr_seq_roteiro,
	null,
       null,
       a.nr_sequencia nr_seq_rot_cli,
       a.nr_seq_cliente,
	'   ' || substr(proj_obter_dados_roteiro(nr_seq_roteiro,'D'),1,80) ds_roteiro,
	null ie_resultado,
	null nm_responsavel,
	null ie_parametrizado,
	null ie_multiplicador,
	null ie_recurso_tecnico,
	null ie_usuario_treinado,
	proj_tp_rot_aderencia(a.nr_seq_cliente,a.nr_seq_roteiro) pr_efetividade
from	proj_tp_cli_rot a

union

select	3,
	(proj_obter_dados_roteiro(b.nr_seq_roteiro,'M'))::numeric  nr_seq_modulo,
	proj_obter_dados_mod_implant(proj_obter_dados_roteiro(nr_seq_roteiro,'M'), 'S') nr_seq_implantacao,
	b.nr_seq_roteiro,
	a.nr_seq_item,
	a.nr_sequencia nr_seq_item_result,
	a.nr_seq_rot_cli,
	b.nr_seq_cliente,
	'      ' || proj_obter_dados_rot_item(a.nr_seq_item,'D') ds_item,
	a.ie_resultado,
	a.nm_responsavel,
	a.ie_parametrizado,
	a.ie_multiplicador,
	a.ie_recurso_tecnico,
	a.ie_usuario_treinado,
	a.pr_efetividade
from	proj_tp_cli_rot b,
	proj_tp_cli_rot_item a
where	a.nr_seq_rot_cli = b.nr_sequencia;

