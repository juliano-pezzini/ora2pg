-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_consiste_acao_menu_v (bt_direito, ie_atalho, ie_ctrl, ie_shift, ie_alt, nr_seq_obj_sup, ds_inconsistencia, ds_funcao, dt_atualizacao_nrec, dt_atualizacao, nm_usuario_nrec, nm_usuario, cd_funcao) AS select  substr(obter_desc_expressao(a.cd_exp_texto, a.ds_texto),1,254) bt_direito,
        a.ie_atalho,
        a.ie_ctrl,
        a.ie_shift,
        a.ie_alt,
	a.nr_seq_obj_sup,
	'Ação com atalho do sistema operacional' ds_inconsistencia,
	substr(obter_desc_funcao(a.cd_funcao),1,254) ds_funcao,
	a.dt_atualizacao_nrec,
	a.dt_atualizacao,
	a.nm_usuario_nrec,
	a.nm_usuario,
	a.cd_funcao
FROM    dic_objeto	a,
	funcao		f
where   a.cd_funcao	= f.cd_funcao
and	f.ie_classif_produto = 'O'
and	a.ie_atalho is not null
and     a.ie_ctrl   = 'S'
and     a.ie_shift  = 'N'
and     a.ie_alt    = 'N'
and     a.ie_atalho in ('C','V','X')

union all

select  substr(obter_desc_expressao(a.cd_exp_texto, a.ds_texto),1,254) bt_direito,
        a.ie_atalho,
        a.ie_ctrl,
        a.ie_shift,
        a.ie_alt,
	a.nr_seq_obj_sup,
	'Ação com apenas Shift e letra' ds_inconsistencia,
	substr(obter_desc_funcao(a.cd_funcao),1,254) ds_funcao,
	a.dt_atualizacao_nrec,
	a.dt_atualizacao,
	a.nm_usuario_nrec,
	a.nm_usuario,
	a.cd_funcao
from    dic_objeto	a,
	funcao		f
where   a.cd_funcao	= f.cd_funcao
and	f.ie_classif_produto = 'O'
and	a.ie_atalho is not null
and     a.ie_ctrl   = 'N'
and     a.ie_shift  = 'S'
and     a.ie_alt    = 'N'
and     a.ie_atalho not in ('F1','F2','F3','F4','F5','F6','F7','F9','F10','F11','F12')

union all

select  substr(obter_desc_expressao(a.cd_exp_texto, a.ds_texto),1,254) bt_direito,
        a.ie_atalho,
	a.ie_ctrl,
	a.ie_shift,
	a.ie_alt,
	a.nr_seq_obj_sup,
	'Ação de menu duplicada' ds_inconsistencia,
	substr(obter_desc_funcao(a.cd_funcao),1,254) ds_funcao,
	a.dt_atualizacao_nrec,
	a.dt_atualizacao,
	a.nm_usuario_nrec,
	a.nm_usuario,
	a.cd_funcao
from    dic_objeto	a,
	funcao		f
where   a.cd_funcao	= f.cd_funcao
and	f.ie_classif_produto = 'O'
and (a.ie_atalho is not null
or      a.ie_ctrl   = 'S'
or      a.ie_shift  = 'S'
or      a.ie_alt    = 'S')
and     exists (select 1
                    from    dic_objeto b
		    where   b.ie_atalho = a.ie_atalho
		    and     b.ie_ctrl   = a.ie_ctrl
		    and     b.ie_shift  = a.ie_shift
		    and     b.ie_alt    = a.ie_alt
		    and     b.nr_sequencia <> a.nr_sequencia
		    and     b.nr_seq_obj_sup = a.nr_seq_obj_sup)

union all

select  substr(obter_desc_expressao(a.cd_exp_texto, a.ds_texto),1,254) bt_direito,
        a.ie_atalho,
	a.ie_ctrl,
	a.ie_shift,
	a.ie_alt,
	a.nr_seq_obj_sup,
	CASE WHEN a.ie_atalho='F4' THEN 'Atalho para Regra de atributo' WHEN a.ie_atalho='F7' THEN 'Atalho para Comunicação interna' WHEN a.ie_atalho='U' THEN 'Atalho para Log de usuário' WHEN a.ie_atalho='F' THEN 'Atalho para Acessar funções' END  ds_inconsistencia,
	substr(obter_desc_funcao(a.cd_funcao),1,254) ds_funcao,
	a.dt_atualizacao_nrec,
	a.dt_atualizacao,
	a.nm_usuario_nrec,
	a.nm_usuario,
	a.cd_funcao
from    dic_objeto	a,
	funcao		f
where   a.cd_funcao	= f.cd_funcao
and	f.ie_classif_produto = 'O'
and     a.ie_ctrl   = 'S'
and	a.ie_shift  = 'S'
and	a.ie_alt    = 'N'
and     a.ie_atalho in ('F4','F7','U','F')
order by 6,7,8,2,3,4,5;

