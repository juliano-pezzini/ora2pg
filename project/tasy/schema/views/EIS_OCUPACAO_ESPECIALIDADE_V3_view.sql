-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_ocupacao_especialidade_v3 (dt_referencia, cd_setor_atendimento, cd_convenio, cd_tipo_acomodacao, ie_clinica, cd_estabelecimento, cd_especialidade, ds_especialidade, qt_leito_livre, nr_pac_partic, nr_pac_conv, nr_pac_sus, nr_pac_outros, nr_obito_partic, nr_obito_conv, nr_obito_sus, nr_obito_outros, nr_alta_partic, nr_alta_conv, nr_alta_sus, nr_alta_outros, nr_admissao_partic, nr_admissao_conv, nr_admissao_sus, nr_admissao_outros, nr_pac_total, nr_obito_total, nr_alta_total, nr_admissao_total, qt_leito_total) AS SELECT   A.DT_REFERENCIA,
      A.CD_SETOR_ATENDIMENTO, 
      A.CD_CONVENIO, 
      A.CD_TIPO_ACOMODACAO, 
      A.IE_CLINICA, 
	  A.CD_ESTABELECIMENTO, 
	  (obter_especialidade_medico(cd_medico, 'C'))::numeric  cd_especialidade, 
      obter_especialidade_medico(cd_medico, 'D') ds_especialidade, 
      coalesce(QT_LEITO_LIVRE,0) qt_leito_livre,          
      CASE WHEN IE_TIPO_CONVENIO=1 THEN  NR_PAC_DIA  ELSE 0 END  NR_PAC_PARTIC,        
      CASE WHEN IE_TIPO_CONVENIO=2 THEN  NR_PAC_DIA  ELSE 0 END  NR_PAC_CONV,     
      CASE WHEN IE_TIPO_CONVENIO=3 THEN  NR_PAC_DIA  ELSE 0 END  NR_PAC_SUS,     
      NR_PAC_DIA NR_PAC_OUTROS, 
      CASE WHEN IE_TIPO_CONVENIO=1 THEN  NR_OBITOS  ELSE 0 END  NR_OBITO_PARTIC,         
      CASE WHEN IE_TIPO_CONVENIO=2 THEN  NR_OBITOS  ELSE 0 END  NR_OBITO_CONV,      
      CASE WHEN IE_TIPO_CONVENIO=3 THEN  NR_OBITOS  ELSE 0 END  NR_OBITO_SUS,      
      NR_OBITOS NR_OBITO_OUTROS, 
      CASE WHEN IE_TIPO_CONVENIO=1 THEN  NR_ALTAS  ELSE 0 END  NR_ALTA_PARTIC,      
      CASE WHEN IE_TIPO_CONVENIO=2 THEN  NR_ALTAS  ELSE 0 END  NR_ALTA_CONV,       
      CASE WHEN IE_TIPO_CONVENIO=3 THEN  NR_ALTAS  ELSE 0 END  NR_ALTA_SUS,       
      NR_ALTAS NR_ALTA_OUTROS, 
      CASE WHEN IE_TIPO_CONVENIO=1 THEN  NR_ADMISSOES  ELSE 0 END  NR_ADMISSAO_PARTIC,  
      CASE WHEN IE_TIPO_CONVENIO=2 THEN  NR_ADMISSOES  ELSE 0 END  NR_ADMISSAO_CONV,   
      CASE WHEN IE_TIPO_CONVENIO=3 THEN  NR_ADMISSOES  ELSE 0 END  NR_ADMISSAO_SUS, 
      NR_ADMISSOES NR_ADMISSAO_OUTROS, 
      NR_PAC_DIA NR_PAC_TOTAL, 
      NR_OBITOS NR_OBITO_TOTAL, 
      NR_ALTAS NR_ALTA_TOTAL, 
      NR_ADMISSOES NR_ADMISSAO_TOTAL, 
      (coalesce(QT_LEITO_LIVRE,0) + NR_PACIENTES) QT_LEITO_TOTAL 
FROM    EIS_CENSO_DIARIO_V2 A 
WHERE   A.IE_PERIODO  = 'D';

