-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW controle_pessoa_v (ie_tipo_pessoa, cd_pessoa, nm_pessoa, ds_contato, dt_nascimento, nr_telefone, ds_endereco, cd_cep, ds_bairro, ds_complemento, ds_municipio, sg_estado, cd_tipo_controle, cd_profissao, cd_religiao, ie_sexo, ie_estado_civil, ie_tipo_complemento, cd_classif_princ, cd_classif_sec, ie_funcionario, cd_tipo_pessoa, cd_especialidade, ds_especialidade, dt_inicio_vigencia, dt_fim_vigencia) AS select	'PF' ie_tipo_pessoa,
	a.cd_pessoa_fisica cd_pessoa,
	a.nm_pessoa_fisica nm_pessoa,
	a.nm_pessoa_fisica ds_contato,
	a.dt_nascimento,
	a.nr_telefone_celular nr_telefone,
	b.ds_endereco || ', ' || to_char(coalesce(b.nr_endereco, b.ds_compl_end)) ds_endereco,
	b.cd_cep,
	b.ds_bairro,
	b.ds_complemento,
	b.ds_municipio,
	b.sg_estado,
	d.cd_tipo_controle,
	b.cd_profissao,
	a.cd_religiao,
	a.ie_sexo,
	a.ie_estado_civil,
	b.ie_tipo_complemento,
	c.cd_classif_princ,
	c.cd_classif_sec,
	a.ie_funcionario,
	0 cd_tipo_pessoa,
	0 cd_especialidade,
	'0' ds_especialidade,
	c.dt_inicio_vigencia,
	c.dt_fim_vigencia
FROM	pessoa_fisica a,
	compl_pessoa_fisica b,
	controle_pessoa c,
	tipo_controle_pessoa d
where	a.cd_pessoa_fisica = b.cd_pessoa_fisica
and	b.cd_pessoa_fisica = c.cd_pessoa_fisica
and	d.cd_tipo_controle = c.cd_tipo_controle
and	b.nr_sequencia =
		(select min(t.nr_sequencia)
		from	compl_pessoa_fisica t
		where	t.cd_pessoa_fisica = a.cd_pessoa_fisica)

union

select	'F' ie_tipo_pessoa,
	a.cd_pessoa_fisica cd_pessoa,
	a.nm_pessoa_fisica nm_pessoa,
	a.nm_pessoa_fisica ds_contato,
	a.dt_nascimento,
	a.nr_telefone_celular nr_telefone,
	b.ds_endereco || ', ' || to_char(coalesce(b.nr_endereco, b.ds_compl_end)) ds_endereco,
	b.cd_cep,
	b.ds_bairro,
	b.ds_complemento,
	b.ds_municipio,
	b.sg_estado,
	d.cd_tipo_controle,
	b.cd_profissao,
	a.cd_religiao,
	a.ie_sexo,
	a.ie_estado_civil,
	b.ie_tipo_complemento,
	c.cd_classif_princ,
	c.cd_classif_sec,
	a.ie_funcionario,
	0 cd_tipo_pessoa,
	0 cd_especialidade,
	'0' ds_especialidade,
	c.dt_inicio_vigencia,
	c.dt_fim_vigencia
from	pessoa_fisica a,
	compl_pessoa_fisica b,
	controle_pessoa c,
	tipo_controle_pessoa d
where	a.cd_pessoa_fisica = b.cd_pessoa_fisica
and	b.cd_pessoa_fisica = c.cd_pessoa_fisica
and	d.cd_tipo_controle = c.cd_tipo_controle
and	a.ie_funcionario = 'S'
and	b.nr_sequencia =
		(select min(t.nr_sequencia)
		from	compl_pessoa_fisica t
		where	t.cd_pessoa_fisica = a.cd_pessoa_fisica)

union

select	'M' ie_tipo_pessoa,
	a.cd_pessoa_fisica cd_pessoa,
	a.nm_pessoa_fisica nm_pessoa,
	a.nm_pessoa_fisica ds_contato,
	a.dt_nascimento,
	a.nr_telefone_celular nr_telefone,
	b.ds_endereco || ', ' || to_char(coalesce(b.nr_endereco, b.ds_compl_end)) ds_endereco,
	b.cd_cep,
	b.ds_bairro,
	b.ds_complemento,
	b.ds_municipio,
	b.sg_estado,
	d.cd_tipo_controle,
	b.cd_profissao,
	a.cd_religiao,
	a.ie_sexo,
	a.ie_estado_civil,
	b.ie_tipo_complemento,
	c.cd_classif_princ,
	c.cd_classif_sec,
	a.ie_funcionario,
	0 cd_tipo_pessoa,
	l.cd_especialidade,
	l.ds_especialidade,
	c.dt_inicio_vigencia,
	c.dt_fim_vigencia
from	pessoa_fisica a,
	compl_pessoa_fisica b,
	controle_pessoa c,
	medico x,
	medico_especialidade j,
	especialidade_medica l,
	tipo_controle_pessoa d
where	a.cd_pessoa_fisica	= b.cd_pessoa_fisica
and	b.cd_pessoa_fisica	= c.cd_pessoa_fisica
and	d.cd_tipo_controle	= c.cd_tipo_controle
and	c.cd_pessoa_fisica	= j.cd_pessoa_fisica
and	j.cd_especialidade	= l.cd_especialidade
and	x.cd_pessoa_fisica	= a.cd_pessoa_fisica
and	b.nr_sequencia =
		(select min(t.nr_sequencia)
		from	compl_pessoa_fisica t
		where	t.cd_pessoa_fisica = a.cd_pessoa_fisica)

union

select	'PJ' ie_tipo_pessoa,
	x.cd_cgc cd_pessoa,
	x.ds_razao_social nm_pessoa,
	x.nm_pessoa_contato ds_contato,
	null dt_nascimento,
	x.nr_telefone,
	x.ds_endereco || ', ' || x.nr_endereco ds_endereco,
	x.cd_cep,
	x.ds_bairro,
	x.ds_complemento,
	x.ds_municipio,
	x.sg_estado,
	z.cd_tipo_controle,
	0 cd_profissao,
	0 cd_religiao,
	'0' ie_sexo,
	'0' ie_estado_civil,
	0 ie_tipo_complemento,
	y.cd_classif_princ,
	y.cd_classif_sec,
	'0' ie_funcionario,
	w.cd_tipo_pessoa,
	0 cd_especialidade,
	'0' ds_especialidade,
	y.dt_inicio_vigencia,
	y.dt_fim_vigencia
from	pessoa_juridica x,
	controle_pessoa y,
	tipo_controle_pessoa z,
	tipo_pessoa_juridica w
where	x.cd_cgc = y.cd_cgc
and	z.cd_tipo_controle = y.cd_tipo_controle
and	w.cd_tipo_pessoa = x.cd_tipo_pessoa

union

select	'C' ie_pessoa_fisica,
	to_char(x.nr_sequencia) cd_pessoa,
	w.ds_razao_social nm_pessoa,
	w.nm_pessoa_contato ds_contato,
	null dt_nascimento,
	w.nr_telefone,
	w.ds_endereco || ', ' || w.nr_endereco ds_endereco,
	w.cd_cep,
	w.ds_bairro,
	w.ds_complemento,
	w.ds_municipio,
	w.sg_estado,
	z.cd_tipo_controle,
	0 cd_profissao,
	0 cd_religiao,
	'0' ie_sexo,
	'0' ie_estado_civil,
	0 ie_tipo_complemento,
	y.cd_classif_princ,
	y.cd_classif_sec,
	'0' ie_funcionario,
	w.cd_tipo_pessoa,
	0 cd_especialidade,
	'0' ds_especialidade,
	y.dt_inicio_vigencia,
	y.dt_fim_vigencia
from	com_cliente x,
	controle_pessoa y,
	tipo_controle_pessoa z,
	pessoa_juridica w
where	y.nr_seq_com_cliente = x.nr_sequencia
and	z.cd_tipo_controle = y.cd_tipo_controle
and	w.cd_cgc = x.cd_cnpj
order by 3;

