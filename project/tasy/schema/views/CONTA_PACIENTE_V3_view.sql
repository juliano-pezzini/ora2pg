-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW conta_paciente_v3 (ie_proc_mat, vl_item, vl_medico, vl_anestesista, vl_filme, vl_auxiliares, vl_custo_operacional, tp_item, nr_seq_proc_pacote, vl_original, cd_motivo_exc_conta, nr_sequencia, nr_interno_conta, ds_item, cd_item) AS SELECT 	1 IE_PROC_MAT,
       	A.VL_PROCEDIMENTO      VL_ITEM,
       	A.VL_MEDICO            VL_MEDICO,
       	A.VL_ANESTESISTA       VL_ANESTESISTA,
       	A.VL_MATERIAIS         VL_FILME,
       	A.VL_AUXILIARES        VL_AUXILIARES,
       	A.VL_CUSTO_OPERACIONAL VL_CUSTO_OPERACIONAL,
       	C.IE_CLASSIFICACAO     TP_ITEM          /* 1-AMB  2-SERVICOS 3-DIARIAS */
,
		A.NR_SEQ_PROC_PACOTE,
		coalesce(G.VL_PROCEDIMENTO, 0) VL_ORIGINAL,
		A.CD_MOTIVO_EXC_CONTA,
		A.NR_SEQUENCIA,
		A.NR_INTERNO_CONTA,
		C.ds_procedimento ds_item,
		C.cd_procedimento cd_item
FROM procedimento c, procedimento_paciente a, (a
LEFT OUTER JOIN proc_paciente_valor g ON (A.NR_SEQUENCIA = G.NR_SEQ_PROCEDIMENTO)
WHERE (A.CD_PROCEDIMENTO       = C.CD_PROCEDIMENTO) AND (A.IE_ORIGEM_PROCED      = C.IE_ORIGEM_PROCED)
UNION

SELECT 	2 IE_PROC_MAT,
       	X.VL_MATERIAL          VL_ITEM,
       	0                      VL_MEDICO,
       	0                      VL_ANESTESISTA,
       	0                      VL_FILME,
       	0                      VL_AUXILIARES,
       	0                      VL_CUSTO_OPERACIONAL,
       	CASE WHEN W.IE_TIPO_MATERIAL=1 THEN '1' WHEN W.IE_TIPO_MATERIAL=2 THEN '2' WHEN W.IE_TIPO_MATERIAL=3 THEN '2'  ELSE '5' END      TP_ITEM        /* 1-MATERIAL 2-MED.GENERICO 3-MED.COMERC. */
,
		X.NR_SEQ_PROC_PACOTE,
		coalesce(X.VL_TABELA_ORIGINAL, 0),
		X.CD_MOTIVO_EXC_CONTA,
		X.NR_SEQUENCIA,
		X.NR_INTERNO_CONTA,
		w.ds_material ds_item,
		w.cd_material cd_item
FROM   	MATERIAL W,
       	MATERIAL_ATEND_PACIENTE X
WHERE (X.CD_MATERIAL           = W.CD_MATERIAL);

