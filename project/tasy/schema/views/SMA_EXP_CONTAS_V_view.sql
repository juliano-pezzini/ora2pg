-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW sma_exp_contas_v (ds_registo, tp_registro, nm_paciente, ds_matricula, ds_campo_1, ds_campo_2, dt_procedimento, hr_procedimento, cd_proc_princ_vinc, qt_procedimento, vl_porte, vl_ch, vl_procedimento, cd_cid, ds_observacao, dt_procedimento_2, cd_procedimento, cd_senha, ds_campo_3, ds_campo_4, ds_campo_5, ds_campo_6, ds_campo_7, ds_padrao_1, ds_campo_8, ds_padrao_2, nr_seq_protocolo) AS select	'' ds_registo,
	'01' tp_registro, 
	'' nm_paciente, 
	'' ds_matricula, 
	' ' ds_campo_1, 
	' ' ds_campo_2, 
	'' dt_procedimento, 
	'' hr_procedimento, 
	'' cd_proc_princ_vinc, 
	'' qt_procedimento, 
	'' vl_porte, 
	'' vl_ch, 
	'' vl_procedimento, 
	'' cd_cid, 
	'' ds_observacao, 
	'' dt_procedimento_2, 
	'' cd_procedimento, 
	'' cd_senha, 
	'' ds_campo_3, 
	'' ds_campo_4, 
	'' ds_campo_5, 
	'' ds_campo_6, 
	'' ds_campo_7, 
	'' ds_padrao_1, 
	'' ds_campo_8, 
	''ds_padrao_2, 
	999999 nr_seq_protocolo 
 

union all
 
select	'DADOS' ds_registo, 
	'02' tp_registro, 
	substr(obter_pessoa_atendimento(a.nr_atendimento,'N'),1,100) nm_paciente, --coluna A 
	substr(obter_matricula_usuario(a.cd_convenio_parametro, a.nr_atendimento),1,100) ds_matricula, --coluna B 
	' ' ds_campo_1, --coluna C 
	' ' ds_campo_2, --coluna D 
	to_char(b.dt_procedimento, 'dd/mm/yyyy') dt_procedimento, --coluna E 
	to_char(b.dt_procedimento, 'hh24:mi') hr_procedimento, --coluna F 
	obter_mascara_procedimento(Obter_Cod_Proc_Princ_Vinc(b.nr_seq_proc_princ)) cd_proc_princ_vinc, --coluna G 
	to_char(sum(b.qt_procedimento)) qt_procedimento, --coluna H 
	Sma_Obter_Vl_Porte(b.cd_procedimento,b.ie_origem_proced,b.cd_edicao_amb) vl_porte, --coluna I 
	to_char(obter_ch_convenio(a.cd_convenio_parametro, a.cd_categoria_parametro, a.cd_estabelecimento)) vl_ch, --coluna J 
	to_char(sum(b.vl_procedimento)) vl_procedimento, --coluna K 
	obter_mascara_cid(obter_cid_atendimento(a.nr_atendimento, 'P')) cd_cid, --coluna L 
	d.ds_observacao, --coluna M 
	to_char(b.dt_procedimento, 'dd/mm/yyyy') dt_procedimento_2, --coluna N 
	coalesce(obter_mascara_procedimento(c.cd_proc_convenio),obter_mascara_procedimento(b.cd_procedimento)) cd_procedimento, --coluna O 
	b.cd_senha, --coluna P 
	' ' ds_campo_3, --coluna Q 
	' ' ds_campo_4, --coluna R 
	' ' ds_campo_5, --coluna S 
	' ' ds_campo_6, --coluna T 
	' ' ds_campo_7, --coluna U 
	'X' ds_padrao_1, --coluna V 
	' ' ds_campo_8, --coluna W 
	'X' ds_padrao_2, --coluna X 
	a.nr_seq_protocolo 
FROM atendimento_paciente d, conta_paciente a, procedimento_paciente b
LEFT OUTER JOIN conversao_proc_convenio c ON (b.cd_convenio = c.cd_convenio AND b.cd_procedimento = c.cd_procedimento AND b.ie_origem_proced = c.ie_origem_proced)
WHERE a.nr_atendimento = d.nr_atendimento and a.nr_interno_conta = b.nr_interno_conta    and b.cd_motivo_exc_conta is null group by	substr(obter_pessoa_atendimento(a.nr_atendimento,'N'),1,100), 
	substr(obter_matricula_usuario(a.cd_convenio_parametro, a.nr_atendimento),1,100), 
	to_char(b.dt_procedimento, 'dd/mm/yyyy'), 
	to_char(b.dt_procedimento, 'hh24:mi'), 
	obter_mascara_procedimento(Obter_Cod_Proc_Princ_Vinc(b.nr_seq_proc_princ)), 
	Sma_Obter_Vl_Porte(b.cd_procedimento,b.ie_origem_proced,b.cd_edicao_amb),	 
	b.cd_procedimento, 
	b.ie_origem_proced, 
	b.cd_edicao_amb, 
	to_char(obter_ch_convenio(a.cd_convenio_parametro, a.cd_categoria_parametro, a.cd_estabelecimento)), 
	obter_mascara_cid(obter_cid_atendimento(a.nr_atendimento, 'P')), 
	d.ds_observacao, 
	to_char(b.dt_procedimento, 'dd/mm/yyyy'), 
	coalesce(obter_mascara_procedimento(c.cd_proc_convenio),obter_mascara_procedimento(b.cd_procedimento)), 
	b.cd_senha, 
	a.nr_seq_protocolo 
order by	tp_registro, 
	nm_paciente;

