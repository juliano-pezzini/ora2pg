-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW grupo_empresa_v (nm_grupo_empresa, cd_empresa, ds_nome_curto, ie_tipo_estrutura, nivel, ds_estrutura_apres, nr_seq_grupo_empresa) AS WITH RECURSIVE cte AS (
select
                ge.nm_grupo_empresa,gee.cd_empresa,emp.ds_nome_curto,gee.ie_tipo_estrutura,coalesce(gee.cd_empresa, '.') nivel,( ( lpad(' ', 10 *(1 - 1))
                    || coalesce(gee.cd_empresa, 1) )
                  || ' - '
                  || emp.ds_nome_curto ) ds_estrutura_apres,ge.nr_sequencia nr_seq_grupo_empresa
          FROM grupo_empresa ge, grupo_emp_estrutura gee
LEFT OUTER JOIN empresa emp ON (gee.cd_empresa = emp.cd_empresa) WHERE gee.nr_seq_estrutura_sup is null
  UNION ALL
select
                ge.nm_grupo_empresa,gee.cd_empresa,emp.ds_nome_curto,gee.ie_tipo_estrutura,c.nivel || 1 || coalesce(gee.cd_empresa, '.') nivel,( ( lpad(' ', 10 *((c.level+1) - 1))
                    || coalesce(gee.cd_empresa, 1) )
                  || ' - '
                  || emp.ds_nome_curto ) ds_estrutura_apres,ge.nr_sequencia nr_seq_grupo_empresa
          FROM grupo_empresa ge, grupo_emp_estrutura gee
LEFT OUTER JOIN empresa emp ON (gee.cd_empresa = emp.cd_empresa) JOIN cte c ON (c.prior nr_sequencia = ge.gee.nr_seq_estrutura_sup)

) SELECT * FROM cte WHERE ge.nr_sequencia = gee.nr_seq_grupo;


